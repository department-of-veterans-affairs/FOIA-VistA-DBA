Released XM*7.1*30 SEQ #28
Extracted from mail message
**KIDS**:XM*7.1*30^

**INSTALL NAME**
XM*7.1*30
"BLD",10,0)
XM*7.1*30^MAILMAN^0^2961029^n
"BLD",10,1,0)
^^40^40^2961029^^
"BLD",10,1,1,0)
 
"BLD",10,1,2,0)
 This MailMan patch is in response to Nois BRX-1195-11719 and E3R 7344, to
"BLD",10,1,3,0)
stop message bouncing caused by invalid subdomains.  If a message is
"BLD",10,1,4,0)
addressed to a subdomain not known to its parent domain, the message will
"BLD",10,1,5,0)
be rejected.  It will not be bounced back to FORUM, as it was previously.
"BLD",10,1,6,0)
The originator will receive a message; 'Sub-domain XXX not found.'
"BLD",10,1,7,0)
===========================================================================
"BLD",10,1,8,0)
 
"BLD",10,1,9,0)
 This patch can be installed with users on the system.
"BLD",10,1,10,0)
===========================================================================
"BLD",10,1,11,0)
 
"BLD",10,1,12,0)
INSTALLATION:
"BLD",10,1,13,0)
  1.  This routine is usually mapped on systems that allow mapping,
"BLD",10,1,14,0)
      so you will need to disable mapping for the effected routine.
"BLD",10,1,15,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",10,1,16,0)
      option will load the KIDS package onto your system.
"BLD",10,1,17,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",10,1,18,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",10,1,19,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",10,1,20,0)
      options:
"BLD",10,1,21,0)
         Verify Checksums in Transport Global
"BLD",10,1,22,0)
         Print Transport Global
"BLD",10,1,23,0)
         Compare Transport Global to Current System
"BLD",10,1,24,0)
         Backup a Transport Global
"BLD",10,1,25,0)
         Install Package(s)
"BLD",10,1,26,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",10,1,27,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",10,1,28,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",10,1,29,0)
============================================================================ 
"BLD",10,1,30,0)
  
"BLD",10,1,31,0)
 ROUTINES:
"BLD",10,1,32,0)
   The second line of the routine now looks like:
"BLD",10,1,33,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",10,1,34,0)
 
"BLD",10,1,35,0)
               Before          After
"BLD",10,1,36,0)
 Name          Checksum        Checksum        Patch List
"BLD",10,1,37,0)
 ----------------------------------------------------------
"BLD",10,1,38,0)
 XMA21A        8460688         8186870         4,30
"BLD",10,1,39,0)
 XMR           6264225         6434522         30
"BLD",10,1,40,0)
============================================================================
"BLD",10,4,0)
^9.64PA^^
"BLD",10,"KRN",0)
^9.67PA^19^12
"BLD",10,"KRN",.4,0)
.4
"BLD",10,"KRN",.401,0)
.401
"BLD",10,"KRN",.402,0)
.402
"BLD",10,"KRN",.403,0)
.403
"BLD",10,"KRN",.5,0)
.5
"BLD",10,"KRN",.84,0)
.84
"BLD",10,"KRN",3.6,0)
3.6
"BLD",10,"KRN",3.8,0)
3.8
"BLD",10,"KRN",9.2,0)
9.2
"BLD",10,"KRN",9.8,0)
9.8
"BLD",10,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10,"KRN",9.8,"NM",1,0)
XMR^^0^B11264138
"BLD",10,"KRN",9.8,"NM",2,0)
XMA21A^^0^B14044753
"BLD",10,"KRN",9.8,"NM","B","XMA21A",2)

"BLD",10,"KRN",9.8,"NM","B","XMR",1)

"BLD",10,"KRN",19,0)
19
"BLD",10,"KRN",19.1,0)
19.1
"BLD",10,"KRN","B",.4,.4)

"BLD",10,"KRN","B",.401,.401)

"BLD",10,"KRN","B",.402,.402)

"BLD",10,"KRN","B",.403,.403)

"BLD",10,"KRN","B",.5,.5)

"BLD",10,"KRN","B",.84,.84)

"BLD",10,"KRN","B",3.6,3.6)

"BLD",10,"KRN","B",3.8,3.8)

"BLD",10,"KRN","B",9.2,9.2)

"BLD",10,"KRN","B",9.8,9.8)

"BLD",10,"KRN","B",19,19)

"BLD",10,"KRN","B",19.1,19.1)

"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
30^2961029
"PKG",6,22,1,"PAH",1,1,0)
^^40^40^2961029
"PKG",6,22,1,"PAH",1,1,1,0)
 
"PKG",6,22,1,"PAH",1,1,2,0)
 This MailMan patch is in response to Nois BRX-1195-11719 and E3R 7344, to
"PKG",6,22,1,"PAH",1,1,3,0)
stop message bouncing caused by invalid subdomains.  If a message is
"PKG",6,22,1,"PAH",1,1,4,0)
addressed to a subdomain not known to its parent domain, the message will
"PKG",6,22,1,"PAH",1,1,5,0)
be rejected.  It will not be bounced back to FORUM, as it was previously.
"PKG",6,22,1,"PAH",1,1,6,0)
The originator will receive a message; 'Sub-domain XXX not found.'
"PKG",6,22,1,"PAH",1,1,7,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,8,0)
 
"PKG",6,22,1,"PAH",1,1,9,0)
 This patch can be installed with users on the system.
"PKG",6,22,1,"PAH",1,1,10,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,11,0)
 
"PKG",6,22,1,"PAH",1,1,12,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,13,0)
  1.  This routine is usually mapped on systems that allow mapping,
"PKG",6,22,1,"PAH",1,1,14,0)
      so you will need to disable mapping for the effected routine.
"PKG",6,22,1,"PAH",1,1,15,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",6,22,1,"PAH",1,1,16,0)
      option will load the KIDS package onto your system.
"PKG",6,22,1,"PAH",1,1,17,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",6,22,1,"PAH",1,1,18,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",6,22,1,"PAH",1,1,19,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",6,22,1,"PAH",1,1,20,0)
      options:
"PKG",6,22,1,"PAH",1,1,21,0)
         Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,22,0)
         Print Transport Global
"PKG",6,22,1,"PAH",1,1,23,0)
         Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,24,0)
         Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,25,0)
         Install Package(s)
"PKG",6,22,1,"PAH",1,1,26,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,27,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,28,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,29,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,30,0)
  
"PKG",6,22,1,"PAH",1,1,31,0)
 ROUTINES:
"PKG",6,22,1,"PAH",1,1,32,0)
   The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,33,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,34,0)
 
"PKG",6,22,1,"PAH",1,1,35,0)
               Before          After
"PKG",6,22,1,"PAH",1,1,36,0)
 Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,37,0)
 ----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,38,0)
 XMA21A        8460688         8186870         4,30
"PKG",6,22,1,"PAH",1,1,39,0)
 XMR           6264225         6434522         30
"PKG",6,22,1,"PAH",1,1,40,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XMA21A")
0^2^B14044753
"RTN","XMA21A",1,0)
XMA21A ;(WASH ISC)/CAP-MailMan name server (CONT) ;07/10/96  10:04
"RTN","XMA21A",2,0)
 ;;7.1;MailMan;**4,30**;Jun 02, 1994
"RTN","XMA21A",3,0)
 Q
"RTN","XMA21A",4,0)
INST ;Check domain
"RTN","XMA21A",5,0)
 S:$E(X)="<" X=$E(X,2,999) S X=$P(X,">"),X1=X,%Z=""
"RTN","XMA21A",6,0)
 F %="INFO:","I:","CC:" I X[% S %Z=%,X=$P(X,%,2)
"RTN","XMA21A",7,0)
 I "G."=$E(X,1,2)!($E(X,1,2)="g.") S XMR=$S($D(XMR):XMR,'$D(XMZ):"",$D(^XMB(3.9,XMZ,0)):^(0),1:"") I $S($D(XMDUZ):XMDUZ,1:DUZ)'=$P(XMR,U,2),$P(XMR,U,7)["P",'$D(XMCHAN) K %Z G ER^XMA21G
"RTN","XMA21A",8,0)
 S X1=X,X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),X=$P(X,"@",2)
"RTN","XMA21A",9,0)
2 I X'=^XMB("NETNAME") S X1=%Z_X1 G 3
"RTN","XMA21A",10,0)
 S Y=^XMB("NUM")
"RTN","XMA21A",11,0)
 I $P(X1,"@")'["%" S X1=%Z_X1 G LOCAL
"RTN","XMA21A",12,0)
 S X1=$TR(X1,"._+",", .")
"RTN","XMA21A",13,0)
 S Y=$P(X1,"@"),X=$P(Y,"%",$L(Y,"%")),X1=$P(Y,"%",1,$L(Y,"%")-1)_"@"_X
"RTN","XMA21A",14,0)
 G 2
"RTN","XMA21A",15,0)
3 S DIC="^DIC(4.2,",DIC(0)="ZM"_$E("E",$D(XMLOC)) D I2 Q:Y<0  S $P(Y(0),U)=$S('$D(X9):$P(X,"@",2),$L(X9):X9_"."_X,1:$P(Y,U,2)) K X9
"RTN","XMA21A",16,0)
 I $P(X1,"@")="" S XMMG="Missing recipient name" S Y=-1 Q
"RTN","XMA21A",17,0)
 I '$D(^XMB("NUM")) S XMMG="This domain not christened" S Y=-1 Q
"RTN","XMA21A",18,0)
 I +Y=^XMB("NUM") G LOCAL
"RTN","XMA21A",19,0)
 I '$D(XMDF),$P(Y(0),U,2)["C",$P(Y(0),U,2)'["S" S XMMG="MailMan access to "_$P(Y,U,2)_" closed." S Y=-1 Q
"RTN","XMA21A",20,0)
 I '$D(XMDF),$P(Y(0),U,11)'="",'$D(^XUSEC($P(Y(0),U,11),DUZ)) S XMMG="You don't hold this domain's KEY.",Y=-1 Q
"RTN","XMA21A",21,0)
 I '$D(XMDF),$P(Y(0),U,2)["N" S XMMG="NO forwarding to this domain.",Y=-1 Q
"RTN","XMA21A",22,0)
 S %=$P(Y(0),U)
"RTN","XMA21A",23,0)
 I $TR(%,"()<>@,;:\[]"_$C(34),"")'=% S XMMG="Domain name must not contain punctuation other than hyphens or dots.",Y=-1 Q
"RTN","XMA21A",24,0)
 I %'?1A.E1AN S XMMG="Domain name must begin with a letter and end with a letter or number.",Y=-1 Q
"RTN","XMA21A",25,0)
 I $G(XMZ),$$NO(XMZ) W:'$D(ZTQUEUED) *7 S XMMG="<< Messages longer than "_$$NO(XMZ)_" lines may NOT be sent across the network. >>",Y=-1 Q
"RTN","XMA21A",26,0)
 ;
"RTN","XMA21A",27,0)
 S Y1=$P(X1,"@")_"@"_%
"RTN","XMA21A",28,0)
 I $L(Y1)>104!($L($P(Y1,"@")_Y(0,0))>103) S Y=-1,XMMG="Address parsing unsuccessful !" Q
"RTN","XMA21A",29,0)
 G I:$G(XMN)
"RTN","XMA21A",30,0)
 ;Add RCPT (XMN is either zero or undefined)
"RTN","XMA21A",31,0)
 D PSP^XMA210 S ^TMP("XMY",$J,$S('$D(^DIC(4.2,"C",$P(Y1,"@",2))):Y1,1:$P(Y1,"@")_"@"_Y(0,0)))=+Y
"RTN","XMA21A",32,0)
 I '$D(XMA21G) S ^TMP("XMY0",$J,Y1)=""
"RTN","XMA21A",33,0)
 Q:$D(XMCHAN)
"RTN","XMA21A",34,0)
 ;
"RTN","XMA21A",35,0)
 ;Display for interactive users (XMCHAN not defined above)
"RTN","XMA21A",36,0)
 S XMMG="via "_$P(^DIC(4.2,+Y,0),U)_$S($P(^(0),U,2)["S":"",1:" (Queued)")
"RTN","XMA21A",37,0)
 S XMQ(+Y)="" Q
"RTN","XMA21A",38,0)
 ;Remove RCPT
"RTN","XMA21A",39,0)
I Q:'$D(^TMP("XMY",$J,Y1))  K ^TMP("XMY",$J,Y1),^TMP("XMY0",$J,Y1) W "  Deleted."
"RTN","XMA21A",40,0)
 Q
"RTN","XMA21A",41,0)
I2 S X9="",XMA21A=^XMB("NUM") I $L(X,".")>1!$D(XMCHAN) S %Z=$P(X,".",$L(X,".")) I %Z="MIL"!(%Z="DE") S DIC(0)=DIC(0)_"MXO"
"RTN","XMA21A",42,0)
 F  D ^DIC Q:$S(Y-XMA21A=0&'$L(X9):1,Y-XMA21A'=0&(Y>0):1,1:0)  D  Q:'$D(XMA21A)
"RTN","XMA21A",43,0)
 . I X=^XMB("NETNAME") D  Q
"RTN","XMA21A",44,0)
 . . S Y=-1,XMDOMLK=1  ; XMDOMLK is checked only by ^XMR.
"RTN","XMA21A",45,0)
 . . S XMMG="Sub-Domain '"_X9_"' not found."
"RTN","XMA21A",46,0)
 . . K XMA21A
"RTN","XMA21A",47,0)
 . S X9=X9_$S($L(X9):".",1:"")_$P(X,".")
"RTN","XMA21A",48,0)
 . S X=$P(X,".",2,999)
"RTN","XMA21A",49,0)
 . I X="" K XMA21A S:$E(X9)'="#" XMMG="Domain not found." Q
"RTN","XMA21A",50,0)
 . ;I $L(X9,".")>1,X'?.E1".".E,DIC(0)'["X" S DIC(0)=DIC(0)_"X" ; *** WHY?
"RTN","XMA21A",51,0)
 I '$D(XMA21A),$E(X9)="#" G I3
"RTN","XMA21A",52,0)
 Q
"RTN","XMA21A",53,0)
 ;X400 ADDRESSING
"RTN","XMA21A",54,0)
I3 S X="#" D ^DIC I Y>0 K X9 S X=X1 Q
"RTN","XMA21A",55,0)
 S XMMG="X.400 DOMAIN not found. MUST HAVE '#' as it's SYNONYM" Q
"RTN","XMA21A",56,0)
LOCAL ;Recipient is local
"RTN","XMA21A",57,0)
 ;Recipient name
"RTN","XMA21A",58,0)
 S X=$P(X1,"@")
"RTN","XMA21A",59,0)
 ;Call Local Name Server Y>0=success
"RTN","XMA21A",60,0)
 D W3 S X=$P(X1,"@")
"RTN","XMA21A",61,0)
 Q:$S(Y>0:1,".D.G.S.d.g.s."[$E(X_" ",1,2):1,X'[".":1,1:0)
"RTN","XMA21A",62,0)
 ;If not successful first time, convert first "," to "." - try again
"RTN","XMA21A",63,0)
 S X=$TR(X,"._+",", ."),XMMG=""
"RTN","XMA21A",64,0)
 G W3GO
"RTN","XMA21A",65,0)
W3 N %,XMA21AL S %=X1,XMA21AL=1 N X1 S X1=%
"RTN","XMA21A",66,0)
W3GO N XMLOCQ S XMLOCQ="QUIT" D W3^XMA21
"RTN","XMA21A",67,0)
 Q
"RTN","XMA21A",68,0)
NO(X) ;Do not allow message to be sent across network if too long
"RTN","XMA21A",69,0)
 ;according to field 8.3 of file 4.3
"RTN","XMA21A",70,0)
 I $S($D(XMCHAN):1,$D(XMDF):1,$D(^XUSEC("XMMGR",DUZ)):1,1:0) Q 0
"RTN","XMA21A",71,0)
 N % S %=$P($G(^XMB(1,1,"NETWORK-LIMIT")),U),%=$S(%:%,1:2000)
"RTN","XMA21A",72,0)
 I $P($G(^XMB(3.9,X,2,0)),U,4)>% Q %
"RTN","XMA21A",73,0)
 Q 0
"RTN","XMR")
0^1^B11264138
"RTN","XMR",1,0)
XMR ;(WASH ISC)/THM/CAP-SMTP RECEIVER [ARPANET RFC 821] ;07/10/96  10:03
"RTN","XMR",2,0)
VER ;;7.1;MailMan;**30**;Jun 02, 1994
"RTN","XMR",3,0)
 K XMSDOM,XMRDOM G ENT^XMR0
"RTN","XMR",4,0)
INT ;BEGINNING OF INTERPRETER
"RTN","XMR",5,0)
 K ^TMP("XMY",$J),^TMP("XMY0",$J) D ENT2^XMR0,R1,R2
"RTN","XMR",6,0)
I1 D INP G:ER KL G I1:XMCMD="" I XMSTATE_XMCONT'[(U_XMCMD_U) G ENT^XMR0A
"RTN","XMR",7,0)
 I $T(@XMCMD)="" D ^XMR0 G:ER KL G I1
"RTN","XMR",8,0)
 D @XMCMD G I1:XMCMD'="QUIT"&('ER) I $D(XMZ),XMZ D K^XMR1
"RTN","XMR",9,0)
KL K XMBCK,XMLIN,X,XMRXMZ,XMSG,ZTSK S:$L(XMINST) $P(^XMBS(4.2999,XMINST,3),U,1,6)="^^^^^" Q
"RTN","XMR",10,0)
I2 S XMSG="500 too many errors or fatal error, closing channel" X XMSEN G KL
"RTN","XMR",11,0)
HELO ;;HELO COMMAND
"RTN","XMR",12,0)
 G HELO^XMR0B
"RTN","XMR",13,0)
MAIL ;;START
"RTN","XMR",14,0)
 G MAIL^XMR0B
"RTN","XMR",15,0)
RCPT ;;
"RTN","XMR",16,0)
 S XMP=$P(XMP,":",2,999) I XMP="" S XMSG="501 Invalid forward path specification" X XMSEN Q
"RTN","XMR",17,0)
 D LK Q:Y<0  S XMSG="250 'RCPT' accepted "_XMMG,XMSTATE="^DATA^RCPT" X XMSEN
"RTN","XMR",18,0)
 Q
"RTN","XMR",19,0)
LOCK S XMLOCK=XMP,XMSG="250 'LOCK' accepted",XMSTATE="^RCPT",^XMB(3.9,XMZ,4)=XMLOCK X XMSEN Q
"RTN","XMR",20,0)
 ;TEXT / ASSUMES VALID RECIPIENT
"RTN","XMR",21,0)
DATA ;;
"RTN","XMR",22,0)
 S XMLIN=.002,XMHDR=1,XMSG="354 Enter data" X XMSEN Q:ER
"RTN","XMR",23,0)
D1 X XMREC Q:ER
"RTN","XMR",24,0)
 I XMRG="." G ENTQ^XMR0A
"RTN","XMR",25,0)
 I $E(XMRG)="." S XMRG=$E(XMRG,2,999)
"RTN","XMR",26,0)
 S:XMLIN>0 ^XMB(3.9,XMZ,2,XMLIN,0)=XMRG S XMLIN=XMLIN+$S(XMHDR:.001,1:1)
"RTN","XMR",27,0)
 I XMHDR,XMRG="" S XMHDR=0,XMLIN=1
"RTN","XMR",28,0)
 G D1
"RTN","XMR",29,0)
R1 S (XMBCK,XMLOCK,XMINST)="",XMSTATE="^HELO^QUIT^" K XMY,XMY0,^TMP("XMY",$J),^TMP("XMY0",$J) Q
"RTN","XMR",30,0)
R2 Q:XMBT
"RTN","XMR",31,0)
 D BUFLUSH^XML
"RTN","XMR",32,0)
 S XMSG="220 "_$S($D(^XMB("NETNAME")):^XMB("NETNAME"),1:"")_" MailMan "_$P($T(XMR+1),";",3)_" ready" W:'$D(XMNO220) 220 H 2 X XMSEN Q
"RTN","XMR",33,0)
VRFY ;;VERIFY USER EXISTS
"RTN","XMR",34,0)
 D LK Q:Y<0  S XMSG="250 <"_$P(Y,U,2)_"@"_^XMB("NETNAME")_">" X XMSEN Q
"RTN","XMR",35,0)
LK S X=$P($P(XMP,"<",2),">",1),XMN=0
"RTN","XMR",36,0)
 I $E(X)=$C(34) S X=$P(X,$C(34),2)_$P(X,$C(34),3,99)
"RTN","XMR",37,0)
 I X?1"@"1.E1":"1.E1"@"1.E S X=$P(X,":",2)
"RTN","XMR",38,0)
 K XMLOC N XMDOMLK D WHOXM^XMA21 S Y=+Y I $G(XMDOMLK)=1 S XMSG="550 "_XMMG G LQ
"RTN","XMR",39,0)
 I Y<0 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),XMSG="550 Recipient"_$S($L($P($O(^VA(200,"B",X)),X,2)):" name ambiguous.",1:" not found") G LQ
"RTN","XMR",40,0)
 I $L(XMLOCK) S ER=0 D SEC^XMAD1A Q:'ER  S XMSG="550 Recipient not authorized" G LQ
"RTN","XMR",41,0)
 I Y-.6=0 S XMSG="550 'Shared,Mail' user may not receive network mail." K ^TMP("XMY",$J,.6),^TMP("XMY0",$J,.6) G LQ
"RTN","XMR",42,0)
 Q
"RTN","XMR",43,0)
LQ X XMSEN S Y=-1 Q
"RTN","XMR",44,0)
TURN ;;
"RTN","XMR",45,0)
 D TURN^XMR1A Q
"RTN","XMR",46,0)
INP S XMTRAN="Waiting for input" D TRAN^XMC1
"RTN","XMR",47,0)
 S XMSTIME=300 X XMREC K XMSTIME Q:ER
"RTN","XMR",48,0)
 S X=XMRG D REM S XMP=$P(X," ",2,999),XMCMD=$$UP^XLFSTR($P(X," "))
"RTN","XMR",49,0)
 Q
"RTN","XMR",50,0)
REM ;STRIP TABS / EXTRA BLANKS
"RTN","XMR",51,0)
 F J=$C(9),"  " F I=1:1 Q:X'[J  S X=$P(X,J,1)_" "_$P(X,J,2,999)
"RTN","XMR",52,0)
 Q
"RTN","XMR",53,0)
QUIT ;;
"RTN","XMR",54,0)
 S XMSG="221 "_$S($D(^XMB("NETNAME")):^("NETNAME"),1:"")_" Service closing transmission channel" X XMSEN Q
"RTN","XMR",55,0)
TST S XM="",XMBT=0,XMCHAN="TEST" S:'$D(XMDUZ) XMDUZ=.5 D OPEN^XML G INT
"RTN","XMR",56,0)
TASKER ;READ MESSAGE FROM %ZTSK
"RTN","XMR",57,0)
 G RECV^XMS3
"RTN","XMR",58,0)
DECNET G DECNET^XMR0
"VER")
8.0^21.0
**END**
**END**
