$TXT Created by MULLER,RICHARD at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 04/24/03 at 10:21
=============================================================================
Run Date: JUL 21, 2003                     Designation: IVM*2*74
Package : IVM - INCOME VERIFICATION MATCH    Priority: Mandatory
Version : 2        SEQ #67                      Status: Released
                  Compliance Date: AUG 21, 2003
=============================================================================

Associated patches: (v)IVM*2*63    <<= must be installed BEFORE `IVM*2*74'
                    (v)IVM*2*77    <<= must be installed BEFORE `IVM*2*74'

Subject: FIX MT NO LONGER REQUIRED ISSUE

Category: 
  - Routine
  - Data Dictionary

Description: 
============

 Issue #1:
 When a VistA site adds multiple events (Income Tests) for a veteran 
 between the times the IVM BACKGROUND JOB [IVM BACKGROUND JOB] is run, the 
 potential exists for those events to be transmitted and populated out of 
 sequence in terms of income year at the Health Eligibility Center (HEC).
  
 EXAMPLE: Site A adds Means Tests for the following income years: 1998, 
 1999, and 2000.  The income year 2000 entry populates the IVM PATIENT
 (#301.5) File first, followed by income years 1998 and 1999.  Upon the 
 next run of the IVM BACKGROUND JOB [IVM BACKGROUND JOB] an ORU~Z07 
 (unsolicited Full Data HL7 transmission) is sent to the HEC, which 
 contains all three income years in the following order: 2000, 1998, and 
 1999.  When the HEC receives this data, it is uploaded in the order it is 
 sent in the ORU~Z07 HL7 message.  In other words, the income year 2000 
 test would upload before the previous income years data.  This is 
 problematic in terms of the determination of which income test is 
 actually primary for a particular income year and in the determination of 
 the CAD (Centralized Anniversary Date). 
  
 The TRANSMISSION STATUS (#.03) Field in the IVM PATIENT (#301.5) File is 
 maintained by the IVM software module.  If data for a patient requires 
 transmission, this field will be set to 0.  Once the data has been 
 transmitted, the field will be set to 1.
  
 The "ATR" cross-reference contains only those patients for which 
 demographic and income data need to be transmitted to the HEC.  Once the 
 data for this patient has been transmitted, the TRANSMISSION STATUS 
 (#.03) field will be changed to 1 for transmitted and the cross-reference 
 is removed.
  
 Resolution:
 An additional subscript level shall be added to the "ATR" cross-reference 
 by this patch (IVM*2.0*74). The additional subscript will contain the 
 value of the INCOME YEAR (#.02) field in the IVM PATIENT (#301.5) File.
  
 This modification is necessary in cases where multiple Means Test events 
 are transmitted within a given batch ORU~Z07 for a given patient.  In 
 some instances, the events are created out of income year sequence.  This 
 is problematic for the legacy HEC database in terms of appropriate 
 Centralized Anniversary Date (CAD) adjustment and how the primary means 
 test is determined.  
  
 The modification to the "ATR" cross-reference allows the IVM BACKGROUND 
 JOB to create the ORU~Z07 (unsolicited Full Data HL7 transmission) 
 batches to be transmitted in the IVM PATIENT (#301.5) FILE by income year 
 order from earliest to latest. 
  
 A post-install cleanup will be performed to transition the "ATR" 
 cross-reference record entries from the old format to the new format.  
 The length of time required for the cleanup to complete the conversion 
 will vary depending on the number of records in the "ATR" 
 cross-reference.  The estimated time is less than thirty minutes.
  
  
 Issue #2:
 As mentioned in Issue #1, the potential to skew the CAD as well as which 
 test may or may not be primary for a given income year exists within the 
 Income Verification Module (IVM).  Because of these anomalies, under the 
 correct circumstances the VistA system can potentially file an incoming 
 income test from the HEC in a status of 'NO LONGER REQUIRED'.  
  
 A patient requires a means test under the following conditions:
     - The Primary Eligibility is NSC or the patient is not SC 0% 
           non-compensable
     - The vet is not receiving disability retirement from the military
     - The vet is not eligible for Medicaid
     - The vet is not on a DOM ward
     - The vet has not been means tested in the past year
     - The vet is not a Purple Heart recipient
  
 Resolution:
 This patch (IVM*2*74) will introduce a flag to indicate that an Income 
 Test is resulting from an upload from the HEC via either an ORU~Z10 
 (unsolicited Income Test Data Transmission) or an ORF~Z10 (solicited 
 Income Test Data Transmission).  
  
 If any of the above conditions are not met, the Means Test status is 
 updated to 'NO LONGER REQUIRED'.  In addition to the above conditions, an 
 additional check is being added for the existence of the ORU/ORF~Z10 
 Income Test Data type HL7 transmission.  If the flag exists, the incoming 
 test from HEC will not be changed to a status of 'NO LONGER REQUIRED'.  
 The functionality to check for this flag is being implemented with patch 
 DG*5.3*495 FIX MT NO LONGER REQUIRED ISSUE.
  
  
 Issue #3:
 The IVM BACKGROUND JOB [IVM BACKGROUND JOB] processes records to be sent 
 to the HEC via an ORU~Z07 (unsolicited Full Data HL7 transmission).  It 
 identifies records to be processed using the "ATR" cross-reference 
 (mentioned in Issue #2).  A series of validations are performed to 
 eliminate records that do not meet the criteria for transmission.
  
 The SSN validation checks if the patient's Social Security Number (SSN) 
 is a pseudo SSN.  If the patient's record contains a pseudo SSN, and the 
 ELIGIBILITY STATUS (#.3611) field in the PATIENT (#2) File is not 
 VERIFIED, the record is not transmitted to the HEC.
  
 Currently the IVM BACKGROUND JOB does not change the TRANSMISSION STATUS 
 Field for these records. Each time the IVM BACKGROUND JOB process is run, 
 these records continue to be evaluated for transmission to the HEC.
  
 Resolution:
 The SSN validation check in the IVM BACKGROUND JOB will be modified.  
 When the record contains a pseudo SSN and the ELIGIBILITY STATUS is not 
 VERIFIED, the TRANSMISSION STATUS field will be set to 1 (Does not 
 require transmission to the HEC).  This will remove the patient's record 
 from the "ATR" cross-reference.
  
 The records associated with this issue will not require a cleanup to be 
 performed.  Once this patch (IVM*2.0*74) has been installed, the IVM 
 BACKGROUND JOB will automatically remove any records that meet the above 
 pseudo SSN criteria.
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch.
  
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
  
 HEH-0102-41899  No Longer Required Status
 LEB-0102-22512  Patch not working as advertised.
 MAD-0101-42975  Duplicate Primary Mt
 MAN-0902-11081  HEC RETURNING REQUIRED MEANS TEST
  
  
 Overview of NOIS Message(s):
 ---------------------------
  
 HEH-0102-41899  No Longer Required Status
 Problem:  When both the current and prior income year means tests are 
 transmitted to a facility from the HEC, VistA may file a new means test 
 entry with a NO LONGER REQUIRED status.  This new (erroneous) entry 
 becomes the 2nd PRIMARY test for that income year.  The HEC did not 
 transmit that NLR test and does not have a record of it unless the site 
 has sent a subsequent full data transmission.  VistA needs to stop 
 generating the NLR entry in this situation.
  
 Resolution:  If the upload from the HEC is either an ORU~Z10 (unsolicited 
 Income Test Data HL7 Transmission) or an ORF~Z10 (solicited Income Test 
 Data HL7 Transmission) the Income Test will not be changed to a status of 
 'NO LONGER REQUIRED'.
  
 LEB-0102-22512  Patch not working as advertised.
 Problem:  Many patients with a Cat C Means Tests are generating letters 
 to have the patient do a MT - when they come back and get entered it 
 seems to trigger the No Longer Required.
  
 Resolution:  If the upload from the HEC is either an ORU~Z10 (unsolicited 
 Income Test Data HL7 Transmission) or an ORF~Z10 (solicited Income Test 
 Data HL7 Transmission) the Income Test will not be changed to a status of 
 'NO LONGER REQUIRED'.
  
 MAD-0101-42975  Duplicate Primary Mt
 Problem:  Many patients are showing up with a Primary MT of No Longer 
 Required and Category C.
  
 Resolution:  If the upload from the HEC is either an ORU~Z10 (unsolicited 
 Income Test Data HL7 Transmission) or an ORF~Z10 (solicited Income Test 
 Data HL7 Transmission) the Income Test will not be changed to a status of 
 'NO LONGER REQUIRED'.
  
  
 MAN-0902-11081  HEC RETURNING REQUIRED MEANS TEST
 Problem:  Many patients are showing up with a Primary MT of No Longer 
 Required and Category C.
  
 Resolution:  If the upload from the HEC is either an ORU~Z10 (unsolicited 
 Income Test Data Transmission) or an ORF~Z10 (solicited Income Test Data 
 Transmission) the Income Test will not be changed to a status of 'NO 
 LONGER REQUIRED'.
  
 Test Sites:
 -----------
 Madison
 Lebanon
 Manchester 
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following menu options (File #19) and all of their descendants be 
 disabled to prevent possible conflicts while running the KIDS Install. 
 Other VISTA users will not be affected.
  
        IVM BACKGROUND JOB                     [IVM BACKGROUND JOB]
        Means Test User Menu                   [DG MEANS TEST USER MENU]
        Add a New Means Test                   [DG MEANS TEST ADD]         
        Complete a Required Means Test         [DG MEANS TEST COMPLETE]    
        Edit an Existing Means Test            [DG MEANS TEST EDIT]        
        Copay Exemption Test User Menu         [DG CO-PAY TEST USER MENU]  
        Add a Copay Exemption Test             [DG CO-PAY TEST ADD]        
        Edit an Existing Copay Exemption Test  [DG CO-PAY TEST EDIT]       
  
 Install Time - 50 minutes
  
  
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
       
        NOTE:  If the routines included in this patch are not currently in 
               your mapped routine set, please skip this step.
   
   3.   COMPONENTS SENT WITH PATCH 
        ------------------------
        The following is a list of the routines included in this patch.  
        The second line of each of these routines now looks like: 
   
           ;;2.0;INCOME VERIFICATION MATCH;**[patch list]**;21-OCT-94
   
                            CHECK^XTSUMBLD results
  
        Routine        Before Patch     After Patch         Patch List 
        -------        ------------     -----------    --------------------
        IVM2074        N/A              718595         74
        IVMCM          14433116         14359541       12,17,28,41,44
                                                       53,34,49,59,55
                                                       63,77,74
        IVMPTRN        7289690          7518053        1,9,11,12,17
                                                       28,34,74
        IVMPTRN7       1650934          1674268        9,11,24,34,74
  
         Total number of routines - 4
         
         Total number of routines modified: 3
         Total number of new routines:      1
         Total number of deleted routines:  0
   
  
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
    
   5.   Select Installation Option: 
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter IVM*2.0*74):
       
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ----------------
        **This is the step to start the installation of this KIDS patch: 
    
        a. Choose the Install Package(s) option to start the patch install.
        b. When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
           YES//' answer NO (unless otherwise indicated)
        c. When prompted 'Want to DISABLE Scheduled Options, Menu 
           Options, and Protocols? YES//' answer YES (unless otherwise
           indicated)
        d. When prompted 'Enter options you wish to mark as 'Out Of
           Order':'  Enter the following options:
   
          IVM BACKGROUND JOB                    [IVM BACKGROUND JOB]
          Means Test User Menu                  [DG MEANS TEST USER MENU]
          Add a New Means Test                  [DG MEANS TEST ADD]
          Complete a Required Means Test        [DG MEANS TEST COMPLETE]
          Edit an Existing Means Test           [DG MEANS TEST EDIT]
          Copay Exemption Test User Menu        [DG CO-PAY TEST USER MENU]
          Add a Copay Exemption Test            [DG CO-PAY TEST ADD]
          Edit an Existing Copay Exemption Test [DG CO-PAY TEST EDIT]
  
        e. When prompted 'Enter protocols you wish to mark as 'Out Of 
           Order':'  press <return>.
  
   7.    REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch
        in the mapped routine set.
      
        NOTE: This step is only necessary if you performed step 2 or 
              if you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - IVMPTRN

 Before:
   F IVMDA=0:0 S IVMDA=$O(^IVM(301.5,"ATR",0,IVMDA)) Q:'IVMDA  D
   .;
   .N EVENTS
   .; - get node, income year, dfn
   .S IVMNODE=$G(^IVM(301.5,+IVMDA,0)),IVMDT=+$P(IVMNODE,"^",2),DFN=
 +IVMNODE
   .I 'DFN!'IVMDT Q
   .;
   .Q:($$STATUS^IVMPLOG(IVMDA,.EVENTS)=1)
   .;
   .S IVMMTDT=($E(IVMDT,1,3)+1)_"1231.9999"
   .;
   .; - prepare FULL transmission
   .D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,,,,.IVMQUERY)
   ;
  
 After:
   S IVMIY=0
   F  S IVMIY=$O(^IVM(301.5,"ATR",0,IVMIY)) Q:'IVMIY  D
   .S IVMDA=0 
   .F  S IVMDA=$O(^IVM(301.5,"ATR",0,IVMIY,IVMDA)) Q:'IVMDA  D
   ..;
   ..N EVENTS
   ..; - get node, income year, dfn
   ..S IVMNODE=$G(^IVM(301.5,+IVMDA,0)),IVMDT=+$P(IVMNODE,"^",2),DFN=
 +IVMNODE
   ..I 'DFN!'IVMDT Q
   ..;
   ..Q:($$STATUS^IVMPLOG(IVMDA,.EVENTS)=1)
   ..;
   ..S IVMMTDT=($E(IVMDT,1,3)+1)_"1231.9999"
   ..;
   ..; - prepare FULL transmission
   ..D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,,,,.IVMQUERY)
   ;
  
 Before:
   ;
 END  ; - cleanup
   I $D(ZTQUEUED) S ZTREQ="@"
   K DA,DFN,DIE,DIK,DR,IVMCT,IVMDA,IVMDT,IVMGTOT,IVMINCYR,IVMINS,IVMMTDT
   K IVMNODE,IVMPAT,IVMPID,IVMQDT,IVMREC,IVMSTAT,X,%,VAFPID,IVMPREYR
   D CLEAN^IVMUFNC
   Q
   ;
  
 After:
   ;
 END  ; - cleanup
   I $D(ZTQUEUED) S ZTREQ="@"
   K DA,DFN,DIE,DIK,DR,IVMCT,IVMDA,IVMDT,IVMGTOT,IVMINCYR,IVMINS,IVMMTDT
   K IVMNODE,IVMPAT,IVMPID,IVMQDT,IVMREC,IVMSTAT,X,%,VAFPID,IVMPREYR,IVMIY
   D CLEAN^IVMUFNC
   Q
   ;

Routine Checksum:

Routine Name:
  - IVMCM

 Before:
 ORU  ; Entry point for receipt of ORU~Z10 trans (called by IVMPREC2)
   S IVMTYPE=5 ; set default to error condition
   ;
  
 After:
 ORU  ; Entry point for receipt of ORU~Z10 trans (called by IVMPREC2)
   S IVMTYPE=5,IVMZ10F=1
   ;
  
 Before:
 ENQ  ;
   K IVMDA,IVMORF,IVMSEG,IVMFLGC,IVMTYPE,IVMMTIEN,IVMMTDT,IVMDGBT,IVMMCI
   K ^TMP($J,"IVMCM"),^("IVMBULL"),DGMSGF,DGADDF,IVMCPAY,IVMBULL,DFN
   K DGMTMSG
   Q
  
 After:
 ENQ  ;
   K IVMDA,IVMORF,IVMSEG,IVMFLGC,IVMTYPE,IVMMTIEN,IVMMTDT,IVMDGBT,IVMMCI
   K ^TMP($J,"IVMCM"),^("IVMBULL"),DGMSGF,DGADDF,IVMCPAY,IVMBULL,DFN
   K DGMTMSG,IVMZ10F
   Q

Routine Checksum:

Routine Name:
  - IVMPTRN7

 Before:
   ;
   I '$D(^DPT(DFN,0)) Q 0   ; ignore corrupted nodes
   S SSN=$P(^DPT(DFN,0),U,9)
   S PFLG=($E(SSN,$L(SSN))="P") I 'PFLG Q 1
   I ($P($G(^DPT(DFN,.361)),U)="V") Q 1
   Q 0
  
  
 After:
   ;
   ; Don't process records with corrupted nodes
   I '$D(^DPT(DFN,0)) D REM Q 0
   ;
   S SSN=$P(^DPT(DFN,0),U,9)
   S PFLG=($E(SSN,$L(SSN))="P") I 'PFLG Q 1
   I ($P($G(^DPT(DFN,.361)),U)="V") Q 1
   ;
   D REM
   Q 0
   ;
  
 New:
 REM  ; Remove Psuedo SSN from Queue
   ; Set TRANSMISSION STATUS to transmission not required
   S PDATA(.03)=1 I $$UPD^DGENDBS(301.5,IVMDA,.PDATA,.ERR)
   K PDATA,ERR
   Q

Routine Checksum:

=============================================================================
User Information:                               
Entered By  : MULLER,RICHARD                 Date Entered : FEB 10, 2003
Completed By: HUA,PATRICK                   Date Completed: JUL 21, 2003
Released By : GANUS,MAUNETTE                Date Released : JUL 21, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
