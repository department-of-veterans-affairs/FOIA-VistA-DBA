Released IB*2*204 SEQ #182
Extracted from mail message
**KIDS**:IB*2.0*204^

**INSTALL NAME**
IB*2.0*204
"BLD",3973,0)
IB*2.0*204^INTEGRATED BILLING^0^3030204^y
"BLD",3973,1,0)
^^1^1^3021212^
"BLD",3973,1,1,0)
REGIONAL COUNSEL ENHANCEMENT
"BLD",3973,4,0)
^9.64PA^^
"BLD",3973,"KRN",0)
^9.67PA^8989.52^19
"BLD",3973,"KRN",.4,0)
.4
"BLD",3973,"KRN",.401,0)
.401
"BLD",3973,"KRN",.402,0)
.402
"BLD",3973,"KRN",.403,0)
.403
"BLD",3973,"KRN",.5,0)
.5
"BLD",3973,"KRN",.84,0)
.84
"BLD",3973,"KRN",3.6,0)
3.6
"BLD",3973,"KRN",3.8,0)
3.8
"BLD",3973,"KRN",9.2,0)
9.2
"BLD",3973,"KRN",9.8,0)
9.8
"BLD",3973,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",3973,"KRN",9.8,"NM",1,0)
IBJDF11^^0^B25092069
"BLD",3973,"KRN",9.8,"NM",2,0)
IBJDF12^^0^B22002756
"BLD",3973,"KRN",9.8,"NM",3,0)
IBJDF4^^0^B26795533
"BLD",3973,"KRN",9.8,"NM",4,0)
IBJDF41^^0^B64450752
"BLD",3973,"KRN",9.8,"NM",5,0)
IBJDF42^^0^B53237550
"BLD",3973,"KRN",9.8,"NM",6,0)
IBAMTV2^^0^B13543897
"BLD",3973,"KRN",9.8,"NM","B","IBAMTV2",6)

"BLD",3973,"KRN",9.8,"NM","B","IBJDF11",1)

"BLD",3973,"KRN",9.8,"NM","B","IBJDF12",2)

"BLD",3973,"KRN",9.8,"NM","B","IBJDF4",3)

"BLD",3973,"KRN",9.8,"NM","B","IBJDF41",4)

"BLD",3973,"KRN",9.8,"NM","B","IBJDF42",5)

"BLD",3973,"KRN",19,0)
19
"BLD",3973,"KRN",19.1,0)
19.1
"BLD",3973,"KRN",101,0)
101
"BLD",3973,"KRN",409.61,0)
409.61
"BLD",3973,"KRN",771,0)
771
"BLD",3973,"KRN",870,0)
870
"BLD",3973,"KRN",8989.51,0)
8989.51
"BLD",3973,"KRN",8989.52,0)
8989.52
"BLD",3973,"KRN",8994,0)
8994
"BLD",3973,"KRN","B",.4,.4)

"BLD",3973,"KRN","B",.401,.401)

"BLD",3973,"KRN","B",.402,.402)

"BLD",3973,"KRN","B",.403,.403)

"BLD",3973,"KRN","B",.5,.5)

"BLD",3973,"KRN","B",.84,.84)

"BLD",3973,"KRN","B",3.6,3.6)

"BLD",3973,"KRN","B",3.8,3.8)

"BLD",3973,"KRN","B",9.2,9.2)

"BLD",3973,"KRN","B",9.8,9.8)

"BLD",3973,"KRN","B",19,19)

"BLD",3973,"KRN","B",19.1,19.1)

"BLD",3973,"KRN","B",101,101)

"BLD",3973,"KRN","B",409.61,409.61)

"BLD",3973,"KRN","B",771,771)

"BLD",3973,"KRN","B",870,870)

"BLD",3973,"KRN","B",8989.51,8989.51)

"BLD",3973,"KRN","B",8989.52,8989.52)

"BLD",3973,"KRN","B",8994,8994)

"BLD",3973,"QUES",0)
^9.62^^
"BLD",3973,"REQB",0)
^9.611^2^2
"BLD",3973,"REQB",1,0)
IB*2.0*153^2
"BLD",3973,"REQB",2,0)
IB*2.0*159^2
"BLD",3973,"REQB","B","IB*2.0*153",1)

"BLD",3973,"REQB","B","IB*2.0*159",2)

"MBREQ")
0
"PKG",202,-1)
1^1
"PKG",202,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",202,20,0)
^9.402P^1^1
"PKG",202,20,1,0)
2^^IBAXDR
"PKG",202,20,1,1)

"PKG",202,20,"B",2,1)

"PKG",202,22,0)
^9.49I^1^1
"PKG",202,22,1,0)
2.0^2940321^2940321
"PKG",202,22,1,"PAH",1,0)
204^3030204
"PKG",202,22,1,"PAH",1,1,0)
^^1^1^3030204
"PKG",202,22,1,"PAH",1,1,1,0)
REGIONAL COUNSEL ENHANCEMENT
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","IBAMTV2")
0^6^B13543897
"RTN","IBAMTV2",1,0)
IBAMTV2 ;ALB/CPM - CREATE CHARGES FOR BILLABLE EPISODES ; 01-JUN-94
"RTN","IBAMTV2",2,0)
 ;;2.0;INTEGRATED BILLING;**15,153,204**;21-MAR-94
"RTN","IBAMTV2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTV2",4,0)
 ;
"RTN","IBAMTV2",5,0)
BLD ; Create back charges for an array of episodes.
"RTN","IBAMTV2",6,0)
 ;
"RTN","IBAMTV2",7,0)
 ; Input: IBSTART  --  First date that the patient is Means Test billable
"RTN","IBAMTV2",8,0)
 ;          IBEND  --  Last date that the patient is Means Test billable
"RTN","IBAMTV2",9,0)
 ;            DFN  --  Pointer to the patient in file #2
"RTN","IBAMTV2",10,0)
 ;
"RTN","IBAMTV2",11,0)
 ;        ^TMP("IBAMTV",$J,episode date) = 1^2^3, where
"RTN","IBAMTV2",12,0)
 ;                         1 = adm date for inpatient care
"RTN","IBAMTV2",13,0)
 ;                             visit date for outpatient care
"RTN","IBAMTV2",14,0)
 ;                         2 = disch/last bill date for inpatient care
"RTN","IBAMTV2",15,0)
 ;                             null for outpatient care
"RTN","IBAMTV2",16,0)
 ;                         3 = null for inpatient care
"RTN","IBAMTV2",17,0)
 ;                             softlink for outpatient care
"RTN","IBAMTV2",18,0)
 ;
"RTN","IBAMTV2",19,0)
 S IBJOB=9,(IBWHER,IBY,Y)=1,IBDUZ=$S($G(DUZ):DUZ,1:.5)
"RTN","IBAMTV2",20,0)
 D SITE^IBAUTL I Y<1 S IBY=Y G BLDQ
"RTN","IBAMTV2",21,0)
 D SERV^IBAUTL2 I IBY<1 G BLDQ
"RTN","IBAMTV2",22,0)
 ;
"RTN","IBAMTV2",23,0)
 ; - is there an old clock to use?
"RTN","IBAMTV2",24,0)
 S IBCLDA=$$OLDCL(DFN,+$O(^TMP("IBAMTV",$J,0)))
"RTN","IBAMTV2",25,0)
 I IBCLDA D CLDATA^IBAUTL3,DED^IBAUTL3
"RTN","IBAMTV2",26,0)
 ;
"RTN","IBAMTV2",27,0)
 ; - bill all episodes of care
"RTN","IBAMTV2",28,0)
 S IBEPDT=0 F  S IBEPDT=$O(^TMP("IBAMTV",$J,IBEPDT)) Q:'IBEPDT  S IBEPSTR=$G(^(IBEPDT)) I IBEPSTR D @$S($P(IBEPSTR,"^",2):"INPT",1:"OPT") Q:IBY<0
"RTN","IBAMTV2",29,0)
 I IBY<0 G BLDQ
"RTN","IBAMTV2",30,0)
 ;
"RTN","IBAMTV2",31,0)
 ; - close clock if over a year old
"RTN","IBAMTV2",32,0)
 I IBCLDA,$$FMDIFF^XLFDT(DT,IBCLDT)>364 K IBCLDOL D CLOCKCL^IBAUTL3
"RTN","IBAMTV2",33,0)
 ;
"RTN","IBAMTV2",34,0)
BLDQ I IBY<0 D ^IBAERR1
"RTN","IBAMTV2",35,0)
 D KILL1^IBAMTC K IBEPDT,IBEPSTR
"RTN","IBAMTV2",36,0)
 Q
"RTN","IBAMTV2",37,0)
 ;
"RTN","IBAMTV2",38,0)
 ;
"RTN","IBAMTV2",39,0)
INPT ; Bill inpatient care.
"RTN","IBAMTV2",40,0)
 S IBEVDA=0
"RTN","IBAMTV2",41,0)
 I IBCLDA S IBCLCT=$$FMDIFF^XLFDT(+IBEPSTR,IBCLDT)
"RTN","IBAMTV2",42,0)
 S IBBDT=$$FMTH^XLFDT(+IBEPSTR,1)
"RTN","IBAMTV2",43,0)
 S IBEDT=$$FMTH^XLFDT($P(IBEPSTR,"^",2),1)-1
"RTN","IBAMTV2",44,0)
 D ^IBAUTL4 G:IBY<0 INPTQ
"RTN","IBAMTV2",45,0)
 ;
"RTN","IBAMTV2",46,0)
 I $G(IBCHPDA) D UPD(IBCHPDA)
"RTN","IBAMTV2",47,0)
 I $G(IBCHCDA) D UPD(IBCHCDA)
"RTN","IBAMTV2",48,0)
 I IBCLDA D CLUPD^IBAUTL3
"RTN","IBAMTV2",49,0)
 I IBEVDA,$D(IBDT) S IBEVCLD=IBDT D @($S($$CLEV():"EVCLOSE",1:"EVUPD")_"^IBAUTL3")
"RTN","IBAMTV2",50,0)
 ;
"RTN","IBAMTV2",51,0)
INPTQ K IBCHPDA,IBCHCDA,IBCHG,IBCHFR,IBCHTO,IBCHTOTL,IBBS,IBNH,IBTRAN,IBATYP,IBDATE
"RTN","IBAMTV2",52,0)
 K IBEVDA,IBEVDT,IBEVCLD,IBEVCAL,IBEVNEW,IBEVOLD,IBTOTL,IBDESC,IBIL,IBSL
"RTN","IBAMTV2",53,0)
 Q
"RTN","IBAMTV2",54,0)
 ;
"RTN","IBAMTV2",55,0)
OPT ; Bill the Outpatient copayment.
"RTN","IBAMTV2",56,0)
 ;  Input:  IBEPSTR  --  1^2^3, where
"RTN","IBAMTV2",57,0)
 ;                        1 => visit date
"RTN","IBAMTV2",58,0)
 ;                        2 => null
"RTN","IBAMTV2",59,0)
 ;                        3 => softlink (may be null)
"RTN","IBAMTV2",60,0)
 ;              DFN  --  Pointer to the patient in file #2
"RTN","IBAMTV2",61,0)
 ;
"RTN","IBAMTV2",62,0)
 N %,IBSTOPDA,IBTYPE
"RTN","IBAMTV2",63,0)
 ;
"RTN","IBAMTV2",64,0)
 I IBCLDA,$$FMDIFF^XLFDT(+IBEPSTR,IBCLDT)>364 K IBCLDOL D CLOCKCL^IBAUTL3 G:IBY<0 OPTQ
"RTN","IBAMTV2",65,0)
 I 'IBCLDA S IBCLDT=+IBEPSTR D CLADD^IBAUTL3 G:IBY<0 OPTQ S (IBCLDAY,IBCLDOL)=0
"RTN","IBAMTV2",66,0)
 ;
"RTN","IBAMTV2",67,0)
 ; - build the charge
"RTN","IBAMTV2",68,0)
 I $P(IBEPSTR,"^",3) S IBSL="409.68:"_$P(IBEPSTR,"^",3)
"RTN","IBAMTV2",69,0)
 S IBX="O",(IBFR,IBTO,IBDT,IBEVDT)=+IBEPSTR
"RTN","IBAMTV2",70,0)
 ;
"RTN","IBAMTV2",71,0)
 ; look up the copay tier info
"RTN","IBAMTV2",72,0)
 S %=$$GETSC^IBEMTSCU(IBSL,IBEVDT) I % S IBSTOPDA=%
"RTN","IBAMTV2",73,0)
 ;  get the rate, ibtype = primary or specialty
"RTN","IBAMTV2",74,0)
 S IBTYPE=$P($G(^IBE(352.5,+$G(IBSTOPDA),0)),"^",3) G:IBTYPE=0 OPTQ
"RTN","IBAMTV2",75,0)
 ;  if the type is not defined, must be a local created sc, set it to primary
"RTN","IBAMTV2",76,0)
 I 'IBTYPE S IBTYPE=1
"RTN","IBAMTV2",77,0)
 ;
"RTN","IBAMTV2",78,0)
 ;
"RTN","IBAMTV2",79,0)
 D TYPE^IBAUTL2 G:IBY<0 OPTQ
"RTN","IBAMTV2",80,0)
 S IBUNIT=1,IBEVDA="*"
"RTN","IBAMTV2",81,0)
 D ADD^IBECEAU3 G:IBY<0 OPTQ
"RTN","IBAMTV2",82,0)
 ;
"RTN","IBAMTV2",83,0)
 ; - place charge in the 'review' status
"RTN","IBAMTV2",84,0)
 D UPD(IBN)
"RTN","IBAMTV2",85,0)
 ;
"RTN","IBAMTV2",86,0)
OPTQ K IBUNIT,IBFR,IBTO,IBSL,IBEVDA,IBX,IBDESC,IBATYP,IBCHG,IBRTED,IBN,IBBS,IBEVDT
"RTN","IBAMTV2",87,0)
 Q
"RTN","IBAMTV2",88,0)
 ;
"RTN","IBAMTV2",89,0)
 ;
"RTN","IBAMTV2",90,0)
OLDCL(DFN,IBDT) ; Can an old billing clock be used?
"RTN","IBAMTV2",91,0)
 ;  Input:     DFN  --  Pointer to the patient in file #2
"RTN","IBAMTV2",92,0)
 ;            IBDT --  Date of first potentially billable episode
"RTN","IBAMTV2",93,0)
 ; Output:       0  --  No old billing clock available
"RTN","IBAMTV2",94,0)
 ;              >0  --  Pointer to old billing clock in file #351
"RTN","IBAMTV2",95,0)
 I '$G(DFN) G OLDCLQ
"RTN","IBAMTV2",96,0)
 N IBX,IBY,IBZ,IBST S IBST=0
"RTN","IBAMTV2",97,0)
 S IBX=-(IBDT+.1) F  S IBX=$O(^IBE(351,"AIVDT",DFN,IBX)) Q:'IBX  D  Q:IBST
"RTN","IBAMTV2",98,0)
 .S IBY=0 F  S IBY=$O(^IBE(351,"AIVDT",DFN,IBX,IBY)) Q:'IBY  D  Q:IBST
"RTN","IBAMTV2",99,0)
 ..S IBZ=$G(^IBE(351,IBY,0)) Q:'IBZ!($P(IBZ,"^",4)=3)
"RTN","IBAMTV2",100,0)
 ..I $$FMDIFF^XLFDT(IBDT,$P(IBZ,"^",3))<365 S IBST=1
"RTN","IBAMTV2",101,0)
OLDCLQ Q +$G(IBY)
"RTN","IBAMTV2",102,0)
 ;
"RTN","IBAMTV2",103,0)
UPD(IBN) ; Place the charge in a review status.
"RTN","IBAMTV2",104,0)
 ;  Input:   IBN  --  Pointer to the charge in file #350
"RTN","IBAMTV2",105,0)
 S DIE="^IB(",DA=IBN,DR=".05////21" D ^DIE K DIE,DA,DR
"RTN","IBAMTV2",106,0)
 Q
"RTN","IBAMTV2",107,0)
 ;
"RTN","IBAMTV2",108,0)
CLEV() ; Should the event record be closed?
"RTN","IBAMTV2",109,0)
 ;  Input:  variables   IBEVDA  --  Pointer to event in file #350
"RTN","IBAMTV2",110,0)
 ;                       IBEND  --  Last date through which to bill
"RTN","IBAMTV2",111,0)
 ; Output:    1  --  yes, close event
"RTN","IBAMTV2",112,0)
 ;            0  --  don't close event
"RTN","IBAMTV2",113,0)
 N IBX,IBZ S IBX=0
"RTN","IBAMTV2",114,0)
 I '$G(IBEVDA)!'$G(IBEND) S IBX=1 G CLEVQ
"RTN","IBAMTV2",115,0)
 I IBEND<$$FMADD^XLFDT(DT,-1) S IBX=1 G CLEVQ
"RTN","IBAMTV2",116,0)
 S IBZ=+$P($P($G(^IB(IBEVDA,0)),"^",4),":",2),IBZ=$P($G(^DGPM(IBZ,0)),"^",14)
"RTN","IBAMTV2",117,0)
 I IBZ,$P($G(^DGPM(IBZ,0)),"^",17) S IBX=1
"RTN","IBAMTV2",118,0)
CLEVQ Q IBX
"RTN","IBJDF11")
0^1^B25092069
"RTN","IBJDF11",1,0)
IBJDF11 ;ALB/CPM - THIRD PARTY FOLLOW-UP REPORT (COMPILE) ; 09-JAN-97
"RTN","IBJDF11",2,0)
 ;;2.0;INTEGRATED BILLING;**69,80,118,128,204**;21-MAR-94
"RTN","IBJDF11",3,0)
 ;
"RTN","IBJDF11",4,0)
DQ ; - Tasked entry point.
"RTN","IBJDF11",5,0)
 K ^TMP("IBJDF1",$J) S IBQ=0
"RTN","IBJDF11",6,0)
 ;
"RTN","IBJDF11",7,0)
 ; - Collect divisions when running the job for all divisions.
"RTN","IBJDF11",8,0)
 I IBSD,VAUTD S J=0 F  S J=$O(^DG(40.8,J)) Q:'J  S VAUTD(J)=""
"RTN","IBJDF11",9,0)
 ;
"RTN","IBJDF11",10,0)
 ; - Find data required for the report.
"RTN","IBJDF11",11,0)
 S IBA=0 F  S IBA=$O(^PRCA(430,"AC",16,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF11",12,0)
 .;
"RTN","IBJDF11",13,0)
 .I IBA#100=0 S IBQ=$$STOP^IBOUTL("Third Party Follow-Up Report") Q:IBQ
"RTN","IBJDF11",14,0)
 .;
"RTN","IBJDF11",15,0)
 .S IBAR=$G(^PRCA(430,IBA,0))
"RTN","IBJDF11",16,0)
 .I $P(IBAR,U,2)'=9 Q  ;       Not an RI bill.
"RTN","IBJDF11",17,0)
 .I '$D(^DGCR(399,IBA,0)) Q  ; No corresponding claim to this AR.
"RTN","IBJDF11",18,0)
 .;
"RTN","IBJDF11",19,0)
 .; - Determine whether bill is inpatient, outpatient, or RX refill.
"RTN","IBJDF11",20,0)
 .S IBTYP=$P($G(^DGCR(399,IBA,0)),U,5),IBTYP=$S(IBTYP>2:2,1:1)
"RTN","IBJDF11",21,0)
 .S:$D(^IBA(362.4,"C",IBA)) IBTYP=3 I IBSEL'[IBTYP,IBSEL'[4 Q
"RTN","IBJDF11",22,0)
 .;
"RTN","IBJDF11",23,0)
 .; - Check the receivable age, if necessary.
"RTN","IBJDF11",24,0)
 .I IBSMN S IBARD=+$$ACT^IBJDF2(IBA) S:IBARD IBARD=$$FMDIFF^XLFDT(DT,IBARD) I IBARD<IBSMN!(IBARD>IBSMX) Q
"RTN","IBJDF11",25,0)
 .;
"RTN","IBJDF11",26,0)
 .; - Check the minimum dollar amount, if necessary.
"RTN","IBJDF11",27,0)
 .S IBWBA=+$G(^PRCA(430,IBA,7)) I IBSAM,IBWBA<IBSAM Q
"RTN","IBJDF11",28,0)
 .;
"RTN","IBJDF11",29,0)
 .; - Get division, if necessary.
"RTN","IBJDF11",30,0)
 .I 'IBSD S IBDIV=0
"RTN","IBJDF11",31,0)
 .E  S IBDIV=$$DIV^IBJDF2(IBA) I 'IBDIV S IBDIV=+$$PRIM^VASITE()
"RTN","IBJDF11",32,0)
 .I IBSD,'VAUTD Q:'$D(VAUTD(IBDIV))  ;  Not a selected division.
"RTN","IBJDF11",33,0)
 .;
"RTN","IBJDF11",34,0)
 .; - Exclude receivables referred to Regional Counsel, if necessary.
"RTN","IBJDF11",35,0)
 .S IBWRC=$G(^PRCA(430,IBA,6)) I 'IBSRC,$P(IBWRC,U,4) Q
"RTN","IBJDF11",36,0)
 .S IBWRC=$S($P(IBWRC,U,22):$P(IBWRC,U,22),1:$P(IBWRC,U,4))
"RTN","IBJDF11",37,0)
 .;
"RTN","IBJDF11",38,0)
 .; - Get the insurance carrier and exclude claim, if necessary.
"RTN","IBJDF11",39,0)
 .S IBWIN=$$INS(IBA) I IBWIN="" Q
"RTN","IBJDF11",40,0)
 .;
"RTN","IBJDF11",41,0)
 .; - Get the claim patient and exclude claim, if necessary.
"RTN","IBJDF11",42,0)
 .S IBWPT=$$PAT(IBA) I IBWPT="" Q
"RTN","IBJDF11",43,0)
 .;
"RTN","IBJDF11",44,0)
 .; - Get remaining claim information.
"RTN","IBJDF11",45,0)
 .S IBWDP=$P(IBAR,U,10),IBWBN=$P(IBAR,U)
"RTN","IBJDF11",46,0)
 .S IBBU=$G(^DGCR(399,IBA,"U")),IBWFR=+IBBU,IBWTO=$P(IBBU,U,2)
"RTN","IBJDF11",47,0)
 .S IBWSC=$$OTH($P(IBWPT,U,5),$P(IBWIN,"@@",2),IBWFR),IBWOR=$P(IBAR,U,3)
"RTN","IBJDF11",48,0)
 .S IBWSI=$P($G(^DPT(+$P(IBWPT,U,5),.312,+$P($G(^DGCR(399,IBA,"MP")),U,2),0)),U,2)
"RTN","IBJDF11",49,0)
 .;
"RTN","IBJDF11",50,0)
 .; - Set up main report index.
"RTN","IBJDF11",51,0)
 .F X=IBTYP,4 I IBSEL[X D
"RTN","IBJDF11",52,0)
 ..S ^TMP("IBJDF1",$J,IBDIV,X,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN)=$P(IBWPT,U,2)_" ("_$P(IBWPT,U,4)_")"_U_$P(IBWPT,U,3)_U_IBWSC_U_IBWFR_U_IBWTO_U_IBWOR_U_IBWBA_"~"_IBWRC_U_IBWSI
"RTN","IBJDF11",53,0)
 .;
"RTN","IBJDF11",54,0)
 .; - Add bill comment history, if necessary.
"RTN","IBJDF11",55,0)
 .I IBSH D
"RTN","IBJDF11",56,0)
 ..S X=0 F  S X=$O(^PRCA(433,"C",IBA,X)) Q:'X  D
"RTN","IBJDF11",57,0)
 ...S Y=$G(^PRCA(433,X,1))
"RTN","IBJDF11",58,0)
 ...I $P(Y,U,2)'=35,$P(Y,U,2)'=45 Q  ; Not a decrease/comment transact.
"RTN","IBJDF11",59,0)
 ...S DAT=$S(Y:+Y\1,1:+$P(Y,U,9)\1)
"RTN","IBJDF11",60,0)
 ...;
"RTN","IBJDF11",61,0)
 ...; - Append brief and transaction comments.
"RTN","IBJDF11",62,0)
 ...K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF11",63,0)
 ...S COM1(1)=$P($G(^PRCA(433,X,5)),U,2),COM1(2)=$E($P($G(^(8)),U,6),1,70)
"RTN","IBJDF11",64,0)
 ...S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF11",65,0)
 ...I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF11",66,0)
 ...;
"RTN","IBJDF11",67,0)
 ...; - Get main comments.
"RTN","IBJDF11",68,0)
 ...S X2=0 F  S X2=$O(^PRCA(433,X,7,X2)) Q:'X2  S COM($S(X1:X2+1,1:X2))=^(X2,0)
"RTN","IBJDF11",69,0)
 ...;
"RTN","IBJDF11",70,0)
 ...S X1="" F  S X1=$O(COM(X1)) Q:X1=""  F X2=IBTYP,4 I IBSEL[X2 D
"RTN","IBJDF11",71,0)
 ....S ^TMP("IBJDF1",$J,IBDIV,X2,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN,X,X1)=COM(X1)
"RTN","IBJDF11",72,0)
 ;
"RTN","IBJDF11",73,0)
 I 'IBQ D EN^IBJDF12 ; Print the report.
"RTN","IBJDF11",74,0)
 ;
"RTN","IBJDF11",75,0)
ENQ K ^TMP("IBJDF1",$J)
"RTN","IBJDF11",76,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF11",77,0)
 ;
"RTN","IBJDF11",78,0)
 D ^%ZISC
"RTN","IBJDF11",79,0)
ENQ1 K IBA,IBAR,IBARD,IBBU,IBDIV,IBQ,IBIO,IBWRC,IBWPT,IBWDP,IBWIN,IBWBN
"RTN","IBJDF11",80,0)
 K IBTYP,IBWSC,IBWSI,IBWFR,IBWTO,IBWOR,IBWBA,COM,COM1,DAT,VAUTD
"RTN","IBJDF11",81,0)
 K X,X1,X2,Y,Z
"RTN","IBJDF11",82,0)
 Q
"RTN","IBJDF11",83,0)
 ;
"RTN","IBJDF11",84,0)
INS(X) ; - Find the Insurance company and decide to include the claim.
"RTN","IBJDF11",85,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",86,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",87,0)
 ; Output: Y=Insurance Company name and pointer to file #36
"RTN","IBJDF11",88,0)
 ;
"RTN","IBJDF11",89,0)
 N Y,Z,Z1 S Y=""
"RTN","IBJDF11",90,0)
 I '$G(X) G INSQ
"RTN","IBJDF11",91,0)
 S Z=+$G(^DGCR(399,X,"MP")),Z1=$P($G(^DIC(36,Z,0)),U)
"RTN","IBJDF11",92,0)
 I $G(IBSI) G INSQ:'$D(IBSI(Z)),INSC
"RTN","IBJDF11",93,0)
 I IBSIF'="@",'Z G INSQ
"RTN","IBJDF11",94,0)
 I $D(IBSIA) G:IBSIA="ALL"&('Z) INSQ G:IBSIA="NULL"&(Z) INSQ
"RTN","IBJDF11",95,0)
 I Z1="" S Z1="UNKNOWN" G INSC
"RTN","IBJDF11",96,0)
 I $G(IBSIA)="ALL" G INSC
"RTN","IBJDF11",97,0)
 I IBSIF="@",IBSIL="zzzzz" G INSC
"RTN","IBJDF11",98,0)
 I IBSIF]Z1!(Z1]IBSIL) G INSQ
"RTN","IBJDF11",99,0)
 ;
"RTN","IBJDF11",100,0)
INSC S Y=Z1_"@@"_Z
"RTN","IBJDF11",101,0)
INSQ Q Y
"RTN","IBJDF11",102,0)
 ;
"RTN","IBJDF11",103,0)
PAT(X) ; - Find the claim patient and decide to include the claim.
"RTN","IBJDF11",104,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",105,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",106,0)
 ; Output: Y=1^2^3^4^5, where
"RTN","IBJDF11",107,0)
 ;           1 => sort key (name or last four)
"RTN","IBJDF11",108,0)
 ;           2 => patient name
"RTN","IBJDF11",109,0)
 ;           3 => patient ssn
"RTN","IBJDF11",110,0)
 ;           4 => patient age
"RTN","IBJDF11",111,0)
 ;           5 => patient pointer to file #2
"RTN","IBJDF11",112,0)
 ;
"RTN","IBJDF11",113,0)
 N AGE,DFN,DOB,KEY,Y,Z S Y=""
"RTN","IBJDF11",114,0)
 I '$G(X) G PATQ
"RTN","IBJDF11",115,0)
 S DFN=+$P($G(^DGCR(399,X,0)),U,2),Z=$G(^DPT(DFN,0))
"RTN","IBJDF11",116,0)
 S KEY=$S(IBSN="N":$P(Z,U),1:$E($P(Z,U,9),6,9))
"RTN","IBJDF11",117,0)
 ;
"RTN","IBJDF11",118,0)
 I IBSNF'="@",'DFN G PATQ
"RTN","IBJDF11",119,0)
 I $D(IBSNA) G:IBSNA="ALL"&('DFN) PATQ G:IBSNA="NULL"&(DFN) PATQ
"RTN","IBJDF11",120,0)
 I KEY="" S Y="UNK^UNK^UNK^UNK^UNK" G PATQ
"RTN","IBJDF11",121,0)
 I $G(IBSNA)="ALL" G PATC
"RTN","IBJDF11",122,0)
 I IBSNF="@",IBSNL="zzzzz" G PATC
"RTN","IBJDF11",123,0)
 I IBSNF]KEY!(KEY]IBSNL) G PATQ
"RTN","IBJDF11",124,0)
 ;
"RTN","IBJDF11",125,0)
PATC ; - Find all patient data.
"RTN","IBJDF11",126,0)
 S DOB=$P(Z,U,3)
"RTN","IBJDF11",127,0)
 S AGE=$S('DOB:"UNK",1:$E(DT,1,3)-$E(DOB,1,3)-($E(DT,4,7)<$E(DOB,4,7)))
"RTN","IBJDF11",128,0)
 S Y=KEY_U_$E($P(Z,U),1,17)_U_$P(Z,U,9)_U_AGE_U_DFN
"RTN","IBJDF11",129,0)
PATQ Q Y
"RTN","IBJDF11",130,0)
 ;
"RTN","IBJDF11",131,0)
OTH(DFN,INS,DS) ; - Find a patient's other valid insurance carrier (if any).
"RTN","IBJDF11",132,0)
 ;  Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF11",133,0)
 ;         INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF11",134,0)
 ;          DS=Date of service for validity check
"RTN","IBJDF11",135,0)
 ; Output: Valid insurance carrier (1st 13 chars.) or null
"RTN","IBJDF11",136,0)
 ;
"RTN","IBJDF11",137,0)
 N Y S Y="" I '$G(DFN)!('$G(DS)) G OTHQ
"RTN","IBJDF11",138,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D:X  Q:Y]""
"RTN","IBJDF11",139,0)
 .I $G(INS),+X=INS Q
"RTN","IBJDF11",140,0)
 .S X1=$G(^DIC(36,+X,0)) I X1="" Q
"RTN","IBJDF11",141,0)
 .I $P(X1,U,2)'="N",$$CHK^IBCNS1(X,DS) S Y=$E($P(X1,U),1,13)
"RTN","IBJDF11",142,0)
 ;
"RTN","IBJDF11",143,0)
OTHQ Q Y
"RTN","IBJDF12")
0^2^B22002756
"RTN","IBJDF12",1,0)
IBJDF12 ;ALB/CPM - THIRD PARTY FOLLOW-UP REPORT (PRINT) ; 10-JAN-97
"RTN","IBJDF12",2,0)
 ;;2.0;INTEGRATED BILLING;**69,118,128,123,204**;21-MAR-94
"RTN","IBJDF12",3,0)
 ;
"RTN","IBJDF12",4,0)
EN ; - Print the Follow-up report.
"RTN","IBJDF12",5,0)
 S IBQ=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%)
"RTN","IBJDF12",6,0)
 I 'IBSD D DET(0),PAUSE:'IBQ G ENQ
"RTN","IBJDF12",7,0)
 S IBDIV=0 F  S IBDIV=$O(VAUTD(IBDIV)) Q:'IBDIV  D DET(IBDIV),PAUSE:'IBQ Q:IBQ
"RTN","IBJDF12",8,0)
 ;
"RTN","IBJDF12",9,0)
ENQ K IBPAG,IBRUN,IBDIV,IBWIN,IBWPT,IBWDP,IBQ,IBH,IBZ,IBC,IBC1,IBC2,IBCD,%
"RTN","IBJDF12",10,0)
 Q
"RTN","IBJDF12",11,0)
 ;
"RTN","IBJDF12",12,0)
DET(IBDIV) ; - Print report for a specific division.
"RTN","IBJDF12",13,0)
 ;  Input: IBDIV=Pointer to the division in file #40.8
"RTN","IBJDF12",14,0)
 S IBPAG=0
"RTN","IBJDF12",15,0)
 I '$D(^TMP("IBJDF1",$J,IBDIV)) D  G DETQ
"RTN","IBJDF12",16,0)
 .S IBTYP=4 D HDR1 I IBQ Q
"RTN","IBJDF12",17,0)
 .W !!,"There are no active receivables "
"RTN","IBJDF12",18,0)
 .I IBSMN W IBSMN,$S(IBSMX>IBSMN:" to "_IBSMX,1:"")," days old "
"RTN","IBJDF12",19,0)
 .I IBDIV W "for this division."
"RTN","IBJDF12",20,0)
 ;
"RTN","IBJDF12",21,0)
 S IBTYP=0 F  S IBTYP=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP)) Q:'IBTYP  D  Q:IBQ
"RTN","IBJDF12",22,0)
 .D HDR1 I IBQ Q
"RTN","IBJDF12",23,0)
 .S IBWIN="" F  S IBWIN=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN)) Q:IBWIN=""  D  Q:IBQ
"RTN","IBJDF12",24,0)
 ..I $Y>(IOSL-5) D PAUSE Q:IBQ  D HDR1 Q:IBQ
"RTN","IBJDF12",25,0)
 ..D HDR2
"RTN","IBJDF12",26,0)
 ..S IBWPT="" F  S IBWPT=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT)) Q:IBWPT=""  D  Q:IBQ
"RTN","IBJDF12",27,0)
 ...S (IBH,IBWDP)="" F  S IBWDP=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT,IBWDP)) W:IBWDP="" ! Q:IBWDP=""  S IBZ=$G(^(IBWDP)) D  Q:IBQ
"RTN","IBJDF12",28,0)
 ....I $Y>(IOSL-3) D PAUSE Q:IBQ  D HDR1,HDR2 Q:IBQ  S IBH=0
"RTN","IBJDF12",29,0)
 ....W ! I 'IBH D WPAT S IBH=1
"RTN","IBJDF12",30,0)
 ....D WBIL Q:IBQ
"RTN","IBJDF12",31,0)
 ....;
"RTN","IBJDF12",32,0)
 ....; - Display bill comment history, if necessary.
"RTN","IBJDF12",33,0)
 ....I IBSH D WCOM Q:IBQ
"RTN","IBJDF12",34,0)
 ;
"RTN","IBJDF12",35,0)
DETQ Q
"RTN","IBJDF12",36,0)
 ;
"RTN","IBJDF12",37,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDF12",38,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDF12",39,0)
 ;
"RTN","IBJDF12",40,0)
PAUSE ; - Page break.
"RTN","IBJDF12",41,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDF12",42,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDF12",43,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBJDF12",44,0)
 S DIR(0)="E" D ^DIR I $D(DIRUT)!($D(DUOUT)) S IBQ=1
"RTN","IBJDF12",45,0)
 Q
"RTN","IBJDF12",46,0)
 ;
"RTN","IBJDF12",47,0)
HDR1 ; - Write the primary report header.
"RTN","IBJDF12",48,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF,*13
"RTN","IBJDF12",49,0)
 S IBPAG=IBPAG+1
"RTN","IBJDF12",50,0)
 W "Third Party Follow-Up Report"
"RTN","IBJDF12",51,0)
 I IBDIV W " for ",$P($G(^DG(40.8,IBDIV,0)),U)
"RTN","IBJDF12",52,0)
 W ?88,"Run Date: ",IBRUN,?123,"Page: ",$J(IBPAG,3)
"RTN","IBJDF12",53,0)
 W !,"All active ",$S(IBTYP=1:"INPATIENT ",IBTYP=2:"OUTPATIENT ",IBTYP=3:"RX REFILL ",1:""),"receivables "
"RTN","IBJDF12",54,0)
 I IBSMN W IBSMN,$S(IBSMX>IBSMN:" to "_IBSMX,1:"")," days old "
"RTN","IBJDF12",55,0)
 I IBSAM W "with balances of at least $",IBSAM
"RTN","IBJDF12",56,0)
 W !!?37,"Other",?51,"Date",?92,"Original",?103,"Current"
"RTN","IBJDF12",57,0)
 W !,"Patient (Age)",?24,"SSN",?37,"Carrier",?51,"Prepared",?61,"Bill No.",?73,"Bill Fr. Bill To",?94,"Amount",?103,"Balance",?114,"Subscriber ID"
"RTN","IBJDF12",58,0)
 W !,$$DASH(IOM)
"RTN","IBJDF12",59,0)
 I IBSRC W !,"Note: '(n)' or '(*)' next to balance means AR was referred to Regional Counsel"
"RTN","IBJDF12",60,0)
 W ! S IBQ=$$STOP^IBOUTL("Third Party Follow-Up Report")
"RTN","IBJDF12",61,0)
 Q
"RTN","IBJDF12",62,0)
 ;
"RTN","IBJDF12",63,0)
HDR2 ; - Write the insurance company sub-header.
"RTN","IBJDF12",64,0)
 N X,X13 W !?3,"Carrier: ",$P(IBWIN,"@@")
"RTN","IBJDF12",65,0)
 S X=$G(^DIC(36,+$P(IBWIN,"@@",2),.11)),X13=$G(^(.13))
"RTN","IBJDF12",66,0)
 I X]"" D
"RTN","IBJDF12",67,0)
 .W ", ",$P(X,U),", ",$P(X,U,4),", ",$P($G(^DIC(5,+$P(X,U,5),0)),U,2),"  ",$P(X,U,6)
"RTN","IBJDF12",68,0)
 .I $P(X13,U,2)]"" W "   Billing Phone: ",$P(X13,U,2) Q
"RTN","IBJDF12",69,0)
 .I $P(X13,U)]"" W "   Main Phone: ",$P(X13,U)
"RTN","IBJDF12",70,0)
 Q
"RTN","IBJDF12",71,0)
 ;
"RTN","IBJDF12",72,0)
WPAT ; - Write patient data.
"RTN","IBJDF12",73,0)
 W $P(IBZ,U),?24,$$SSN($P(IBZ,U,2)),?37,$P(IBZ,U,3)
"RTN","IBJDF12",74,0)
 Q
"RTN","IBJDF12",75,0)
 ;
"RTN","IBJDF12",76,0)
WBIL ; - Write bill data.
"RTN","IBJDF12",77,0)
 W ?51,$$DAT1^IBOUTL(+IBWDP),?60,$P(IBWDP,"@@",2)
"RTN","IBJDF12",78,0)
 W ?73,$$DAT1^IBOUTL($P(IBZ,U,4)),?82,$$DAT1^IBOUTL($P(IBZ,U,5))
"RTN","IBJDF12",79,0)
 W ?90,$J($P(IBZ,U,6),10,2),?100,$J(+$P(IBZ,U,7),10,2)
"RTN","IBJDF12",80,0)
 I $P($P(IBZ,U,7),"~",2) D
"RTN","IBJDF12",81,0)
 . I $P($P(IBZ,U,7),"~",2)<6 W "(",$P($P(IBZ,U,7),"~",2),")" Q
"RTN","IBJDF12",82,0)
 . W "(*)"
"RTN","IBJDF12",83,0)
 W ?114,$E($P(IBZ,U,8),1,18)
"RTN","IBJDF12",84,0)
 Q
"RTN","IBJDF12",85,0)
 ;
"RTN","IBJDF12",86,0)
WCOM ; - Write the comments
"RTN","IBJDF12",87,0)
 N CONT,DIWL,DIWR,IBC,IBC1,IBC2,X
"RTN","IBJDF12",88,0)
 ;
"RTN","IBJDF12",89,0)
 S (IBC,CONT)=0,DIWL=1,DIWR=104 K ^UTILITY($J,"W")
"RTN","IBJDF12",90,0)
 F  S IBC=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT,IBWDP,IBC)) Q:'IBC  D  Q:IBQ
"RTN","IBJDF12",91,0)
 . I $Y>(IOSL-4) D PAUSE Q:IBQ  D HDR1,HDR2 Q:IBQ  W ! D WPAT,WBIL
"RTN","IBJDF12",92,0)
 . S IBC1=""
"RTN","IBJDF12",93,0)
 . F  S IBC1=$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT,IBWDP,IBC,IBC1)) Q:IBC1=""  D  Q:IBQ
"RTN","IBJDF12",94,0)
 . . S IBC2=^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT,IBWDP,IBC,IBC1)
"RTN","IBJDF12",95,0)
 . . I $Y>(IOSL-4) D WCPB Q:IBQ
"RTN","IBJDF12",96,0)
 . . I 'IBC1 S IBCD=IBC2 D WCD Q
"RTN","IBJDF12",97,0)
 . . S X=IBC2 I $E(X)=" ",$L(X)>1 S $E(X)=""
"RTN","IBJDF12",98,0)
 . . D ^DIWP
"RTN","IBJDF12",99,0)
 . . I 'CONT,$L(IBC2)<66 D WCTXT Q
"RTN","IBJDF12",100,0)
 . . S CONT=$L(IBC2)>65
"RTN","IBJDF12",101,0)
 . . I '$O(^TMP("IBJDF1",$J,IBDIV,IBTYP,IBWIN,IBWPT,IBWDP,IBC,IBC1)) D
"RTN","IBJDF12",102,0)
 . . . D:$D(^UTILITY($J,"W")) WCTXT
"RTN","IBJDF12",103,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF12",104,0)
 Q
"RTN","IBJDF12",105,0)
 ;
"RTN","IBJDF12",106,0)
WCD ; - Write comment date.
"RTN","IBJDF12",107,0)
 W !?2,"Comment Date: ",$$DAT1^IBOUTL(IBCD)
"RTN","IBJDF12",108,0)
 Q
"RTN","IBJDF12",109,0)
 ;
"RTN","IBJDF12",110,0)
WCTXT ; - Write comment text
"RTN","IBJDF12",111,0)
 N LIN,WLIN
"RTN","IBJDF12",112,0)
 S LIN=""
"RTN","IBJDF12",113,0)
 F  S LIN=$O(^UTILITY($J,"W",1,LIN)) Q:LIN=""  D  Q:IBQ
"RTN","IBJDF12",114,0)
 . S WLIN=$G(^UTILITY($J,"W",1,LIN,0))
"RTN","IBJDF12",115,0)
 . I $Y>(IOSL-4) D WCPB Q:IBQ
"RTN","IBJDF12",116,0)
 . W:WLIN'="" ?26,WLIN,!
"RTN","IBJDF12",117,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF12",118,0)
 Q
"RTN","IBJDF12",119,0)
 ;
"RTN","IBJDF12",120,0)
WCPB ; - Page Break in the middle of Comments
"RTN","IBJDF12",121,0)
 ;
"RTN","IBJDF12",122,0)
 D PAUSE Q:IBQ  D HDR1,HDR2 Q:IBQ
"RTN","IBJDF12",123,0)
 W ! D WPAT,WBIL D WCD W:IBC1>1 ?26,"(continued)",!
"RTN","IBJDF12",124,0)
 Q 
"RTN","IBJDF12",125,0)
 ;
"RTN","IBJDF12",126,0)
SSN(X) ; - Format the SSN.
"RTN","IBJDF12",127,0)
 Q $S(X]"":$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),1:"")
"RTN","IBJDF4")
0^3^B26795533
"RTN","IBJDF4",1,0)
IBJDF4 ;ALB/RB - FIRST PARTY FOLLOW-UP REPORT;15-APR-00
"RTN","IBJDF4",2,0)
 ;;2.0;INTEGRATED BILLING;**123,204**;21-MAR-94
"RTN","IBJDF4",3,0)
 ; 
"RTN","IBJDF4",4,0)
EN ; - Option entry point.
"RTN","IBJDF4",5,0)
 S IBEXCEL=0
"RTN","IBJDF4",6,0)
 ;
"RTN","IBJDF4",7,0)
 ; - Select AR categories to print.
"RTN","IBJDF4",8,0)
 S IBPRT="Choose which type of receivables to print:"
"RTN","IBJDF4",9,0)
 K IBOPT
"RTN","IBJDF4",10,0)
 S IBOPT(1)="EMERGENCY/HUMANITARIAN"
"RTN","IBJDF4",11,0)
 S IBOPT(2)="INELIGIBLE"
"RTN","IBJDF4",12,0)
 S IBOPT(3)="C-MEANS TEST & RX COPAY"
"RTN","IBJDF4",13,0)
 S IBOPT(4)="LONG TERM CARE COPAY"
"RTN","IBJDF4",14,0)
 S IBOPT(5)="ALL OF THE ABOVE"
"RTN","IBJDF4",15,0)
 S IBSEL=$$MLTP^IBJD(IBPRT,.IBOPT,1) I 'IBSEL G ENQ
"RTN","IBJDF4",16,0)
 ;
"RTN","IBJDF4",17,0)
STA ; - Choose bill status.
"RTN","IBJDF4",18,0)
 W !!,"Run report for (A)CTIVE ARs, (S)USPENDED ARs, or (B)OTH: B// "
"RTN","IBJDF4",19,0)
 R X:DTIME G:'$T!(X["^") ENQ S:X="" X="B" S X=$E(X)
"RTN","IBJDF4",20,0)
 I "AaBbSs"'[X S IBOFF=1 D HELP^IBJDF4H G STA
"RTN","IBJDF4",21,0)
 S IBSTA=$S("Aa"[X:"A","Ss"[X:"S",1:"B")
"RTN","IBJDF4",22,0)
 W "  ",$S(IBSTA="A":"ACTIVE",IBSTA="S":"SUSPENDED",1:"BOTH")
"RTN","IBJDF4",23,0)
 ;
"RTN","IBJDF4",24,0)
 ; - Select a detailed or summary report.
"RTN","IBJDF4",25,0)
 D DS^IBJD G ENQ:IBRPT["^"
"RTN","IBJDF4",26,0)
 I IBRPT="S" D  G RC
"RTN","IBJDF4",27,0)
 . S IBSN="N",IBSNA="ALL",IBSNF="",IBSNL="zzzzz",IBSMN="A"
"RTN","IBJDF4",28,0)
 ;
"RTN","IBJDF4",29,0)
 ; - Determine sorting (By name or Last 4 SSN)
"RTN","IBJDF4",30,0)
 S IBSN=$$SNL^IBJD() G ENQ:IBSN="^"
"RTN","IBJDF4",31,0)
 ;
"RTN","IBJDF4",32,0)
 ; - Determine the range
"RTN","IBJDF4",33,0)
 S X=$$INTV^IBJD("PATIENT "_$S(IBSN="N":"NAME",1:"LAST 4")) G ENQ:X="^"
"RTN","IBJDF4",34,0)
 S IBSNF=$P(X,"^",1),IBSNL=$P(X,"^",2),IBSNA=$P(X,"^",3)
"RTN","IBJDF4",35,0)
 ;
"RTN","IBJDF4",36,0)
AGE ; - Determine if the active receivable must be within an age range.
"RTN","IBJDF4",37,0)
 W !!,"Include (A)LL ",$S(IBSTA="A":"active ",IBSTA="S":"suspended ",1:""),"ARs or those within an AGE (R)ANGE: ALL// "
"RTN","IBJDF4",38,0)
 R X:DTIME G:'$T!(X["^") ENQ S:X="" X="A" S X=$E(X)
"RTN","IBJDF4",39,0)
 I "ARar"'[X S IBOFF=9 D HELP^IBJDF4H G AGE
"RTN","IBJDF4",40,0)
 S IBSMN=$S("Rr"[X:"R",1:"A") W "  ",$S(IBSMN="R":"RANGE",1:"ALL")
"RTN","IBJDF4",41,0)
 I IBSMN="A" G AMT
"RTN","IBJDF4",42,0)
 ;
"RTN","IBJDF4",43,0)
 ; - Determine the active receivable age range.
"RTN","IBJDF4",44,0)
 S DIR(0)="NA^0:99999"
"RTN","IBJDF4",45,0)
 S DIR("A")="Enter the minimum age of the receivable: "
"RTN","IBJDF4",46,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=16 D HELP^IBJDF4H"
"RTN","IBJDF4",47,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",48,0)
 S IBSMN=+Y W "   ",IBSMN," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF4",49,0)
 ;
"RTN","IBJDF4",50,0)
 S DIR(0)="NA^"_IBSMN_":99999"
"RTN","IBJDF4",51,0)
 S DIR("A")="Enter the maximum age of the receivable: "
"RTN","IBJDF4",52,0)
 S DIR("B")=IBSMN,DIR("T")=DTIME,DIR("?")="^S IBOFF=21 D HELP^IBJDF4H"
"RTN","IBJDF4",53,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",54,0)
 S IBSMX=+Y W "   ",IBSMX," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF4",55,0)
 ;
"RTN","IBJDF4",56,0)
AMT ; - Print receivables with a minimum balance.
"RTN","IBJDF4",57,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF4",58,0)
 S DIR("A")="Print receivables with a minimum balance"
"RTN","IBJDF4",59,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=26 D HELP^IBJDF4H"
"RTN","IBJDF4",60,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",61,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSAM EXCEL
"RTN","IBJDF4",62,0)
 ;
"RTN","IBJDF4",63,0)
AMT1 ; - Determine the minimum balance amount.
"RTN","IBJDF4",64,0)
 S DIR(0)="NA^1:9999999"
"RTN","IBJDF4",65,0)
 S DIR("A")="Enter the minimum balance amount of the receivable: "
"RTN","IBJDF4",66,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=33 D HELP^IBJDF4H"
"RTN","IBJDF4",67,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",68,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF4",69,0)
 ;
"RTN","IBJDF4",70,0)
EXCEL ; - Determine whether to gather data for Excel report.
"RTN","IBJDF4",71,0)
 S IBEXCEL=$$EXCEL^IBJD() G ENQ:IBEXCEL="^"
"RTN","IBJDF4",72,0)
 I IBEXCEL S IBSH=1,IBSH1="M" G RC
"RTN","IBJDF4",73,0)
 ;
"RTN","IBJDF4",74,0)
BCH ; - Determine whether to include the bill comment history.
"RTN","IBJDF4",75,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF4",76,0)
 S DIR("A")="Include the bill comment history with each receivable"
"RTN","IBJDF4",77,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=38 D HELP^IBJDF4H"
"RTN","IBJDF4",78,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",79,0)
 S IBSH=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSH RC
"RTN","IBJDF4",80,0)
 ;
"RTN","IBJDF4",81,0)
 S DIR(0)="SA^A:ALL;M:MOST RECENT"
"RTN","IBJDF4",82,0)
 S DIR("A")="Print (A)LL comments or the (M)OST RECENT comment: "
"RTN","IBJDF4",83,0)
 S DIR("B")="ALL",DIR("T")=DTIME,DIR("?")="^S IBOFF=47 D HELP^IBJDF4H"
"RTN","IBJDF4",84,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",85,0)
 S IBSH1=Y K DIROUT,DTOUT,DUOUT,DIRUT G:IBSH1="A" RC
"RTN","IBJDF4",86,0)
 ;
"RTN","IBJDF4",87,0)
 S DIR(0)="NAO^1:999"
"RTN","IBJDF4",88,0)
 S DIR("A")="Minimum age of most recent bill comment (optional): "
"RTN","IBJDF4",89,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=54 D HELP^IBJDF4H"
"RTN","IBJDF4",90,0)
 D ^DIR K DIR G:$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",91,0)
 S IBSH2=+Y W:IBSH2 " days" K DIROUT,DTOUT,DUOUT
"RTN","IBJDF4",92,0)
 ;
"RTN","IBJDF4",93,0)
RC ; - Include receivables referred to Regional Counsel?
"RTN","IBJDF4",94,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","IBJDF4",95,0)
 S DIR("A")="Include ARs referred to Regional Counsel"
"RTN","IBJDF4",96,0)
 S DIR("?")="^S IBOFF=61 D HELP^IBJDF4H"
"RTN","IBJDF4",97,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF4",98,0)
 S IBSRC=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF4",99,0)
 ;
"RTN","IBJDF4",100,0)
DEV ; - Select a device.
"RTN","IBJDF4",101,0)
 I '$G(IBEXCEL) D
"RTN","IBJDF4",102,0)
 . W !!,"Note: This report will search through all "
"RTN","IBJDF4",103,0)
 . W $S(IBSTA="A":"active",IBSTA="S":"suspended",1:"active & suspended")," receivables."
"RTN","IBJDF4",104,0)
 . W !?6,"It is recommended that you queue it to run after normal business hours."
"RTN","IBJDF4",105,0)
 ;
"RTN","IBJDF4",106,0)
 I $G(IBEXCEL) D EXMSG^IBJD
"RTN","IBJDF4",107,0)
 ;
"RTN","IBJDF4",108,0)
 W ! S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDF4",109,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDF4",110,0)
 .S ZTRTN="DQ^IBJDF4",ZTDESC="IB - FIRST PARTY FOLLOW-UP REPORT"
"RTN","IBJDF4",111,0)
 .S ZTSAVE("IB*")="" D ^%ZTLOAD
"RTN","IBJDF4",112,0)
 .I $G(ZTSK) W !!,"This job has been queued. The task no. is ",ZTSK,"."
"RTN","IBJDF4",113,0)
 .E  W !!,"Unable to queue this job."
"RTN","IBJDF4",114,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDF4",115,0)
 ;
"RTN","IBJDF4",116,0)
 U IO
"RTN","IBJDF4",117,0)
 ;
"RTN","IBJDF4",118,0)
 ; If called by the Extraction Module, change extract status for the  5
"RTN","IBJDF4",119,0)
 ; reports: Emergency/Humanitarian, Inelible receivables, C-Means Test,
"RTN","IBJDF4",120,0)
 ;          RX Copay/SC VET and RX Copay/NSC VET
"RTN","IBJDF4",121,0)
DQ I $G(IBXTRACT) F I=12:1:16 D E^IBJDE(I,1)
"RTN","IBJDF4",122,0)
 ;
"RTN","IBJDF4",123,0)
 D ST^IBJDF41 ;   Compile and print the report.
"RTN","IBJDF4",124,0)
 ;
"RTN","IBJDF4",125,0)
ENQ K IBSEL,IBSN,IBSNF,IBSNL,IBOFF,IBSNA,IBSH,IBSH1,IBSH2,IBSAM,IBSRC,IBTEXT
"RTN","IBJDF4",126,0)
 K IBI,IBOPT,IBPRT,IBSTA,IBEXCEL,IBRPT,IBSMN,IBSMX,POP,DIROUT,DTOUT,DUOUT
"RTN","IBJDF4",127,0)
 K DIRUT,%ZIS,ZTDESC,ZTRTN,ZTSAVE,I,X,Y
"RTN","IBJDF4",128,0)
 Q
"RTN","IBJDF41")
0^4^B64450752
"RTN","IBJDF41",1,0)
IBJDF41 ;ALB/RB - FIRST PARTY FOLLOW-UP REPORT (COMPILE) ;15-APR-00
"RTN","IBJDF41",2,0)
 ;;2.0;INTEGRATED BILLING;**123,159,204**;21-MAR-94
"RTN","IBJDF41",3,0)
 ;
"RTN","IBJDF41",4,0)
ST ; - Tasked entry point.
"RTN","IBJDF41",5,0)
 K IB,IBCAT,^TMP("IBJDF4",$J) S IBQ=0
"RTN","IBJDF41",6,0)
 ;
"RTN","IBJDF41",7,0)
 ; - Set selected categories for report.
"RTN","IBJDF41",8,0)
 I IBSEL[1 S IBCAT(2)=1
"RTN","IBJDF41",9,0)
 I IBSEL[2 S IBCAT(1)=2
"RTN","IBJDF41",10,0)
 I IBSEL[3 S IBCAT(18)=3 F X=22,23 S IBCAT(X)=4
"RTN","IBJDF41",11,0)
 I IBSEL[4 F X=33:1:39 S IBCAT(X)=5
"RTN","IBJDF41",12,0)
 ;
"RTN","IBJDF41",13,0)
 ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF41",14,0)
 I $G(IBEXCEL) D PHDL
"RTN","IBJDF41",15,0)
 ;
"RTN","IBJDF41",16,0)
 ; - Find data required for report.
"RTN","IBJDF41",17,0)
 F IB=16,19,40 D  G:IBQ ENQ
"RTN","IBJDF41",18,0)
 . I IBSTA="A",IB'=16 Q  ;      Active AR's only.
"RTN","IBJDF41",19,0)
 . I IBSTA="S",IB=16 Q   ;      Suspended AR's only.
"RTN","IBJDF41",20,0)
 . I IB'=40 D 
"RTN","IBJDF41",21,0)
 . . S IBCAT=""
"RTN","IBJDF41",22,0)
 . . F  S IBCAT=$O(IBCAT(IBCAT)) Q:IBCAT=""  D
"RTN","IBJDF41",23,0)
 . . . D INIT^IBJDF43
"RTN","IBJDF41",24,0)
 . S IBA=0
"RTN","IBJDF41",25,0)
 . F  S IBA=$O(^PRCA(430,"AC",IB,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF41",26,0)
 . . D PROC
"RTN","IBJDF41",27,0)
 ;
"RTN","IBJDF41",28,0)
 I 'IBQ,'$G(IBEXCEL) D EN^IBJDF42 ; Print the report.
"RTN","IBJDF41",29,0)
 ;
"RTN","IBJDF41",30,0)
ENQ K ^TMP("IBJDF4",$J)
"RTN","IBJDF41",31,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF41",32,0)
 ;
"RTN","IBJDF41",33,0)
 D ^%ZISC
"RTN","IBJDF41",34,0)
ENQ1 K IB,IB0,IBA,IBA1,IBADM,IBAGE,IBAR,IBAR1,IBBA,IBBN,IBBU,IBC,IBCAT,IBCAT1
"RTN","IBJDF41",35,0)
 K IBELIG,IBEXCEL,IBFLG,IBAI,IBAIQ,IBIDX,IBIO,IBINT,IBN,IBPA,IBPD,IBPAT
"RTN","IBJDF41",36,0)
 K IBPT,IBQ,IBRFD,IBRFT,IBSRC,IBRP,IBVA,COM,COM1,DAT,DFN,X,X1,X2,Y,Z
"RTN","IBJDF41",37,0)
 Q
"RTN","IBJDF41",38,0)
 ;
"RTN","IBJDF41",39,0)
PROC ; - Process data for report(s).
"RTN","IBJDF41",40,0)
 I IBA#100=0 D  Q:IBQ
"RTN","IBJDF41",41,0)
 .S IBQ=$$STOP^IBOUTL("First Party Follow-Up Report")
"RTN","IBJDF41",42,0)
 S IBAR=$G(^PRCA(430,IBA,0)) I 'IBAR Q
"RTN","IBJDF41",43,0)
 S IBCAT=+$P(IBAR,U,2) I '$D(IBCAT(IBCAT)) Q   ;Get valid AR category.
"RTN","IBJDF41",44,0)
 I '$$CLMACT^IBJD(IBA,IBCAT) Q  ;               Invalid IB claim/action.
"RTN","IBJDF41",45,0)
 S IBPT=$$PAT(IBA) I IBPT="" Q  ;               Get patient info.
"RTN","IBJDF41",46,0)
 S DFN=$P(IBPT,U,2)
"RTN","IBJDF41",47,0)
 S IBAGE=$$FMDIFF^XLFDT(DT,+$P(IBAR,U,10))
"RTN","IBJDF41",48,0)
 I IBSMN,IBAGE<IBSMN!(IBAGE>IBSMX) Q  ;         AR outside age range.
"RTN","IBJDF41",49,0)
 S IBVA=$$VA^IBJD1(DFN),IBBN=$P(IBAR,U),IBPD=$P($$PYMT^IBJD1(IBA),U)
"RTN","IBJDF41",50,0)
 S IBPAT=$P(IBPT,U)_"@@"_DFN
"RTN","IBJDF41",51,0)
 ;
"RTN","IBJDF41",52,0)
 ; - Check the AR balance amounts, if necessary.
"RTN","IBJDF41",53,0)
 S (IBADM,IBBA,IBINT,IBPA)=0,IBN=$G(^PRCA(430,IBA,7))
"RTN","IBJDF41",54,0)
 F X=1:1:5 D
"RTN","IBJDF41",55,0)
 . S IBBA=IBBA+$P(IBN,U,X)
"RTN","IBJDF41",56,0)
 . S:X=1 IBPA=+IBN S:X=2 IBINT=$P(IBN,U,2) S:X=3 IBADM=$P(IBN,U,3)
"RTN","IBJDF41",57,0)
 ;
"RTN","IBJDF41",58,0)
 I '$G(IBEXCEL) D EN^IBJDF43 I IBRPT="S" Q  ;   Get summary stats.
"RTN","IBJDF41",59,0)
 ;
"RTN","IBJDF41",60,0)
 I IBSAM,IBBA<IBSAM Q
"RTN","IBJDF41",61,0)
 ;
"RTN","IBJDF41",62,0)
 ; - Check if AR was referred to R-Regional Counsel, D-DMC, or T-TOP
"RTN","IBJDF41",63,0)
 ;   and exclude, if necessary.
"RTN","IBJDF41",64,0)
 S IB0=$S(IB=40:19,1:IB),IBIDX=0,IBRFT=""
"RTN","IBJDF41",65,0)
 S IBAIQ=0,IBAI=$G(^TMP("IBJDF4",$J,IBPAT,0,"A"))
"RTN","IBJDF41",66,0)
 S IBRFD=$P($G(^PRCA(430,IBA,6)),U,4)
"RTN","IBJDF41",67,0)
 I IBRPT="D",IBRFD D  I IBAIQ Q                   ; Referred to RC
"RTN","IBJDF41",68,0)
 . S IBRFT="R" I IBAI'["R" S IBAI=IBAI_"R"
"RTN","IBJDF41",69,0)
 . I 'IBSRC S IBAIQ=1 Q
"RTN","IBJDF41",70,0)
 . D SREF("R",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",71,0)
 S IBRFD=+$G(^PRCA(430,IBA,12))
"RTN","IBJDF41",72,0)
 I IBRPT="D",IBRFD D                              ; Referred to DMC
"RTN","IBJDF41",73,0)
 . S IBRFT=IBRFT_"D" I IBAI'["D" S IBAI=IBAI_"D"
"RTN","IBJDF41",74,0)
 . D SREF("D",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",75,0)
 S IBRFD=+$G(^PRCA(430,IBA,14))
"RTN","IBJDF41",76,0)
 I IBRPT="D",IBRFD D                              ; Referred to TOP
"RTN","IBJDF41",77,0)
 . S IBRFT=IBRFT_"T" I IBAI'["T" S IBAI=IBAI_"T"
"RTN","IBJDF41",78,0)
 . D SREF("T",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",79,0)
 ;
"RTN","IBJDF41",80,0)
 ; - Check if AR is on P-Repayment plan or F-Defaulted repayment plan.
"RTN","IBJDF41",81,0)
 ;   and exclude if repayment plan is active.
"RTN","IBJDF41",82,0)
 S IBRP=$$RP(IBA)
"RTN","IBJDF41",83,0)
 I IBRP D
"RTN","IBJDF41",84,0)
 . I IBRP=2 S IBRFT=IBRFT_"F"  I IBAI'["F" S IBAI=IBAI_"F"
"RTN","IBJDF41",85,0)
 . I IBRP=1 S IBRFT=IBRFT_"P" I IBAI'["P"&(IBAI'["F") S IBAI=IBAI_"P"
"RTN","IBJDF41",86,0)
 . D SREF("P",$P(IBRP,"^",2),IB0,$S(+IBRP=2:1,1:0),.IBIDX)
"RTN","IBJDF41",87,0)
 ;
"RTN","IBJDF41",88,0)
 I IBIDX S IBFLG=1
"RTN","IBJDF41",89,0)
 ;
"RTN","IBJDF41",90,0)
 ; - Check if VA Employee
"RTN","IBJDF41",91,0)
 I $P(IBVA,"^")["*",IBAI'["V" S IBAI=IBAI_"V"
"RTN","IBJDF41",92,0)
 ;
"RTN","IBJDF41",93,0)
 I IBAI'="" S ^TMP("IBJDF4",$J,IBPAT,0,"A")=IBAI
"RTN","IBJDF41",94,0)
 ;
"RTN","IBJDF41",95,0)
 ; - Set up indexes for detail report.
"RTN","IBJDF41",96,0)
 I $G(IBEXCEL) D  Q
"RTN","IBJDF41",97,0)
 . S IBEXCEL1=$P($G(^PRCA(430.2,IBCAT,0)),U,2)_U_$P(IBPT,U,3)_U_$P(IBVA,U)_U_$P(IBPT,U,4)_U_$$DT^IBJD($P(IBPT,U,6),1)_U_$$ELIG^IBJDF42(+$P(IBPT,U,5))_U
"RTN","IBJDF41",98,0)
 . S IBEXCEL1=IBEXCEL1_$$GET1^DIQ(2,DFN,.381)_U_$$MTRX(DFN)_U_IBBN_U_$S(IB=16:"A",1:"S")_U_IBRFT_U_$$DT^IBJD($P(IBAR,U,10),1)_U_$$DT^IBJD(IBPD,1)_U_IBBA_U_IBPA_U_IBINT_U_IBADM_U
"RTN","IBJDF41",99,0)
 . I IBSH D COM
"RTN","IBJDF41",100,0)
 . S IBD=0 I DAT!IBPD S IBD=$$FMDIFF^XLFDT(DT,$S('DAT:IBPD,1:$G(DAT)))
"RTN","IBJDF41",101,0)
 . S IBEXCEL1=IBEXCEL1_U_IBD W !,IBEXCEL1 K IBD,IBEXCEL1
"RTN","IBJDF41",102,0)
 ;
"RTN","IBJDF41",103,0)
 I '($D(^TMP("IBJDF4",$J,IBPAT))#10) D
"RTN","IBJDF41",104,0)
 . S ^TMP("IBJDF4",$J,IBPAT)=$P(IBPT,U,3,5)_U_$$MTRX(DFN)_U_$P(IBPT,U,6)_"^"_$P(IBVA,"^",2)_"^"_$$ACCBAL($P(IBPT,U,7))
"RTN","IBJDF41",105,0)
 S ^TMP("IBJDF4",$J,IBPAT,IB0,IBCAT,IBBN)=IBPD_U_IBBA_U_IBPA_U_IBINT_U_IBADM_U_IBIDX
"RTN","IBJDF41",106,0)
 ;
"RTN","IBJDF41",107,0)
 I IBSH D COM
"RTN","IBJDF41",108,0)
 ;
"RTN","IBJDF41",109,0)
 Q
"RTN","IBJDF41",110,0)
 ;
"RTN","IBJDF41",111,0)
ACCBAL(DFN) ; Calculates the Account Balance for the Bill
"RTN","IBJDF41",112,0)
 ; Input: DFN - Patient/Debtor internal number
"RTN","IBJDF41",113,0)
 ; Output: BAL - Patient/Debtor Account Balance
"RTN","IBJDF41",114,0)
 ;
"RTN","IBJDF41",115,0)
 N B0,B7,BAL,BILL,I
"RTN","IBJDF41",116,0)
 S (BAL,BILL)=0
"RTN","IBJDF41",117,0)
 F  S BILL=$O(^PRCA(430,"C",DFN,BILL)) Q:BILL=""  D
"RTN","IBJDF41",118,0)
 . S B0=$G(^PRCA(430,BILL,0)) I $P(B0,"^",8)'=16 Q
"RTN","IBJDF41",119,0)
 . S B7=$G(^PRCA(430,BILL,7))
"RTN","IBJDF41",120,0)
 . F I=1:1:5 S BAL=BAL+$P(B7,"^",I)
"RTN","IBJDF41",121,0)
 Q BAL
"RTN","IBJDF41",122,0)
 ;
"RTN","IBJDF41",123,0)
PHDL ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF41",124,0)
 N X
"RTN","IBJDF41",125,0)
 S X="Cat^Patient^VA Empl.?^SSN^Dt Death^Prim.Elig.^Med.Elig.?^"
"RTN","IBJDF41",126,0)
 S X=X_"Means Tst Sts^Means Tst Dt^RX Copay Exemp.Sts^RX Copay Exemp.Dt^"
"RTN","IBJDF41",127,0)
 S X=X_"Bill #^Act/Susp^Refer. to^Dt Bill prep.^Last Pymt Dt^"
"RTN","IBJDF41",128,0)
 S X=X_"Curr.Bal.^Princ.Bal.^Int.^Admin.^Last Comm.Dt^Days Lst Comm."
"RTN","IBJDF41",129,0)
 W !,X
"RTN","IBJDF41",130,0)
 Q
"RTN","IBJDF41",131,0)
 ;
"RTN","IBJDF41",132,0)
PAT(X) ; - Find the AR patient and decide to include the AR.
"RTN","IBJDF41",133,0)
 ;    Input: X=AR pointer to file #430 and pre-set variables IBS*
"RTN","IBJDF41",134,0)
 ;   Output: Y=Sort key (name or last 4) ^ Patient pointer to file #2 
"RTN","IBJDF41",135,0)
 ;             ^ Name ^ SSN ^ Eligibilities ^ Date of death (if any)
"RTN","IBJDF41",136,0)
 ;             ^ Debtor pointer to file #340
"RTN","IBJDF41",137,0)
 N PAT,KEY,DBTR,DFN,DEATH,NAME,SSN,VAEL,VADM,X1,X2
"RTN","IBJDF41",138,0)
 S PAT="" G:'$G(X) PATQ
"RTN","IBJDF41",139,0)
 S DBTR=+$P($G(^PRCA(430,X,0)),U,9)
"RTN","IBJDF41",140,0)
 S X1=$P($G(^RCD(340,DBTR,0)),U) G:X1'["DPT" PATQ
"RTN","IBJDF41",141,0)
 S DFN=+X1 G:'DFN PATQ D DEM^VADPT
"RTN","IBJDF41",142,0)
 S NAME=VADM(1),SSN=$P(VADM(2),"^"),DEATH=VADM(6)\1
"RTN","IBJDF41",143,0)
 S KEY=$S(IBSN="N":NAME,1:$E(SSN,6,9))
"RTN","IBJDF41",144,0)
 I KEY=""!(IBSNF'="@"&('DFN)) G PATQ
"RTN","IBJDF41",145,0)
 I $D(IBSNA) G:IBSNA="ALL"&('DFN) PATQ G:IBSNA="NULL"&(DFN) PATQ
"RTN","IBJDF41",146,0)
 I $G(IBSNA)="ALL" G PATC
"RTN","IBJDF41",147,0)
 I IBSNF="@",IBSNL="zzzzz" G PATC
"RTN","IBJDF41",148,0)
 I IBSNF'=KEY,IBSNF]KEY G PATQ
"RTN","IBJDF41",149,0)
 I IBSNL'=KEY,KEY]IBSNL G PATQ
"RTN","IBJDF41",150,0)
 ;
"RTN","IBJDF41",151,0)
PATC ; - Set patient eligibilities.
"RTN","IBJDF41",152,0)
 D ELIG^VADPT S X2=+$G(VAEL(1))_";"
"RTN","IBJDF41",153,0)
 I +X2 S X1=0 F  S X1=$O(VAEL(1,X1)) Q:'X1  S X2=X2_X1_";"
"RTN","IBJDF41",154,0)
 ;
"RTN","IBJDF41",155,0)
 S PAT=KEY_U_DFN_U_$E(NAME,1,26)_U_SSN_U_X2_U_DEATH
"RTN","IBJDF41",156,0)
 S PAT=PAT_U_DBTR
"RTN","IBJDF41",157,0)
PATQ Q PAT
"RTN","IBJDF41",158,0)
 ;
"RTN","IBJDF41",159,0)
RP(X) ; - Check if claim/receivable is under a repayment plan.
"RTN","IBJDF41",160,0)
 ;    Input: X=Bill pointer to file #399/#430
"RTN","IBJDF41",161,0)
 ;   Output: 0-Not on repay plan, 1-On repay plan, 2-On defaulted plan
"RTN","IBJDF41",162,0)
 N Z
"RTN","IBJDF41",163,0)
 S Z=$$REPDATA^RCBECHGA(X,1) I Z="" Q 0
"RTN","IBJDF41",164,0)
 I '$P(Z,"^",7) Q ("1^"_$P(Z,"^"))
"RTN","IBJDF41",165,0)
 Q ("2^"_$P(Z,"^"))
"RTN","IBJDF41",166,0)
 ;
"RTN","IBJDF41",167,0)
MTRX(X) ; - Return patient's means test and/or RX copay status and most recent
"RTN","IBJDF41",168,0)
 ;   test dates for both.
"RTN","IBJDF41",169,0)
 ;    Input: X=Patient pointer to file #2 and opt. variable IBEXCEL
"RTN","IBJDF41",170,0)
 ;   Output: Y=Means test status ^ Date ^ RX copay status ^ Date 
"RTN","IBJDF41",171,0)
 N MTST,RXST,Y
"RTN","IBJDF41",172,0)
 S Y="^^^",MTST=$$LST^DGMTU(X),RXST=$$RXST^IBARXEU(X)
"RTN","IBJDF41",173,0)
 I '$G(IBEXCEL) D
"RTN","IBJDF41",174,0)
 . S $P(Y,"^",1,2)=$P(MTST,"^",3)_"^"_$$DAT1^IBOUTL($P(MTST,"^",2))
"RTN","IBJDF41",175,0)
 . S $P(Y,"^",3)=$S('RXST:"NON-EXEMPT",+RXST=1:"EXEMPT",1:"")
"RTN","IBJDF41",176,0)
 . I $P(Y,"^",3)'="" S $P(Y,"^",4)=$$DAT1^IBOUTL($P(RXST,"^",5))
"RTN","IBJDF41",177,0)
 I $G(IBEXCEL) D
"RTN","IBJDF41",178,0)
 . S $P(Y,"^",1,2)=$P(MTST,"^",4)_"^"_$$DT^IBJD($P(MTST,"^",2),1)
"RTN","IBJDF41",179,0)
 . S $P(Y,"^",3)=$S('RXST:"M",+RXST=1:"E",1:"")
"RTN","IBJDF41",180,0)
 . I $P(Y,"^",3)'="" S $P(Y,"^",4)=$$DT^IBJD($P(RXST,"^",5),1)
"RTN","IBJDF41",181,0)
 Q Y
"RTN","IBJDF41",182,0)
 ;
"RTN","IBJDF41",183,0)
SREF(RFT,DAT,STS,DEF,IDX) ; Set the "referred to" information on the 
"RTN","IBJDF41",184,0)
 ;                         temporary global ^TMP
"RTN","IBJDF41",185,0)
 ;Input: RFT: "R": RC, "D": DMC, "T": TOP, "P": REPAYMENT PLAN
"RTN","IBJDF41",186,0)
 ;       DAT: Date it was referred/established
"RTN","IBJDF41",187,0)
 ;       STS: Receivable status (16-Active,19-Suspended)
"RTN","IBJDF41",188,0)
 ;       DEF: Repayment Plan in Default? (1 - YES, 0 - NO)
"RTN","IBJDF41",189,0)
 ;       IDX: Suscript to be set in the Temporary global ^TMP
"RTN","IBJDF41",190,0)
 ;Output: IDX: Subscript set in the Temporary global ^TMP
"RTN","IBJDF41",191,0)
 ;
"RTN","IBJDF41",192,0)
 N SREF,IDX1
"RTN","IBJDF41",193,0)
 S DEF=+$G(DEF),IDX=+$G(IDX)
"RTN","IBJDF41",194,0)
 I RFT="R" S SREF="REFERRED TO RC"
"RTN","IBJDF41",195,0)
 I RFT="D" S SREF="REFERRED TO DMC"
"RTN","IBJDF41",196,0)
 I RFT="T" S SREF="REFERRED TO TOP"
"RTN","IBJDF41",197,0)
 I RFT="P" D
"RTN","IBJDF41",198,0)
 . S SREF="REPAYMENT PLAN ESTABLISHED"
"RTN","IBJDF41",199,0)
 . I $G(DEF) S SREF=SREF_" (CURRENTLY IN DEFAULT)"
"RTN","IBJDF41",200,0)
 ;
"RTN","IBJDF41",201,0)
 I 'IDX S IDX=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",STS,""),-1)+1
"RTN","IBJDF41",202,0)
 S IDX1=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,""),-1)+1
"RTN","IBJDF41",203,0)
 S ^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,IDX1)=DAT
"RTN","IBJDF41",204,0)
 S ^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,IDX1,1)=SREF
"RTN","IBJDF41",205,0)
 Q
"RTN","IBJDF41",206,0)
 ;
"RTN","IBJDF41",207,0)
COM ; - Get bill comments.
"RTN","IBJDF41",208,0)
 I 'IBIDX,'$G(IBEXCEL) D
"RTN","IBJDF41",209,0)
 . S IBFLG=0,IBIDX=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,""),-1)+1
"RTN","IBJDF41",210,0)
 ;
"RTN","IBJDF41",211,0)
 S DAT=0,IBA1=$S(IBSH1="M":9999999,1:0)
"RTN","IBJDF41",212,0)
 F  S IBA1=$S(IBSH1="M":$O(^PRCA(433,"C",IBA,IBA1),-1),1:$O(^PRCA(433,"C",IBA,IBA1))) Q:'IBA1  D  I IBSH1="M",DAT Q
"RTN","IBJDF41",213,0)
 . S IBC=$G(^PRCA(433,IBA1,1)) Q:'IBC
"RTN","IBJDF41",214,0)
 . I $G(IBSH2),$$FMDIFF^XLFDT(DT,+IBC)>IBSH2 Q  ; Comment age not minimum.
"RTN","IBJDF41",215,0)
 . I $P(IBC,U,2)'=35,$P(IBC,U,2)'=45 Q  ;   Not decrease/comment transact.
"RTN","IBJDF41",216,0)
 . S DAT=$S(IBC:+IBC\1,1:+$P(IBC,U,9)\1)
"RTN","IBJDF41",217,0)
 . I $G(IBEXCEL),IBSH1="M" S IBEXCEL1=IBEXCEL1_$$DT^IBJD(DAT,1) Q
"RTN","IBJDF41",218,0)
 . ;
"RTN","IBJDF41",219,0)
 . ; - Append brief and transaction comments.
"RTN","IBJDF41",220,0)
 . K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF41",221,0)
 . S COM1(1)=$P($G(^PRCA(433,IBA1,5)),U,2)
"RTN","IBJDF41",222,0)
 . S COM1(2)=$E($P($G(^PRCA(433,IBA1,8)),U,6),1,70)
"RTN","IBJDF41",223,0)
 . S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF41",224,0)
 . I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF41",225,0)
 . ;
"RTN","IBJDF41",226,0)
 . ; - Get main comments.
"RTN","IBJDF41",227,0)
 . S X2=0
"RTN","IBJDF41",228,0)
 . F  S X2=$O(^PRCA(433,IBA1,7,X2)) Q:'X2  D
"RTN","IBJDF41",229,0)
 . . S COM($S(X1:X2+1,1:X2))=^PRCA(433,IBA1,7,X2,0)
"RTN","IBJDF41",230,0)
 . ;
"RTN","IBJDF41",231,0)
 . I $G(IBEXCEL) Q
"RTN","IBJDF41",232,0)
 . ;
"RTN","IBJDF41",233,0)
 . S IBFLG=1,^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,IBIDX,IBA1)=$G(COM(0)),X1=0
"RTN","IBJDF41",234,0)
 . F  S X1=$O(COM(X1)) Q:X1=""  D
"RTN","IBJDF41",235,0)
 . . S ^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,IBIDX,IBA1,X1)=COM(X1)
"RTN","IBJDF41",236,0)
 ;
"RTN","IBJDF41",237,0)
 I '$G(IBEXCEL),IBFLG D
"RTN","IBJDF41",238,0)
 . S $P(^TMP("IBJDF4",$J,IBPAT,IB0,IBCAT,IBBN),"^",6)=IBIDX
"RTN","IBJDF41",239,0)
 Q
"RTN","IBJDF42")
0^5^B53237550
"RTN","IBJDF42",1,0)
IBJDF42 ;ALB/RB - FIRST PARTY FOLLOW-UP REPORT (PRINT);15-APR-00
"RTN","IBJDF42",2,0)
 ;;2.0;INTEGRATED BILLING;**123,204**;21-MAR-94
"RTN","IBJDF42",3,0)
 ;
"RTN","IBJDF42",4,0)
EN ; - Print the Follow-up report.
"RTN","IBJDF42",5,0)
 ;
"RTN","IBJDF42",6,0)
 S IBCT(1)="INELIGIBLE",IBCT(2)="EMERG/HUMAN.",IBCT(18)="C MEANS TEST"
"RTN","IBJDF42",7,0)
 S IBCT(22)="RX COPAY/SC",IBCT(23)="RX COPAY/NSC"
"RTN","IBJDF42",8,0)
 S IBCT(33)="ADHC LTC"
"RTN","IBJDF42",9,0)
 S IBCT(34)="DOM LTC"
"RTN","IBJDF42",10,0)
 S IBCT(35)="RESPITE INPT LTC"
"RTN","IBJDF42",11,0)
 S IBCT(36)="RESPITE OPT LTC"
"RTN","IBJDF42",12,0)
 S IBCT(37)="GERIATRIC INPT LTC"
"RTN","IBJDF42",13,0)
 S IBCT(38)="GERIATRIC OPT LTC"
"RTN","IBJDF42",14,0)
 S IBCT(39)="NURSING HOME LTC"
"RTN","IBJDF42",15,0)
 ;
"RTN","IBJDF42",16,0)
 S IBQ=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%) G:IBRPT="S" SUM
"RTN","IBJDF42",17,0)
 S IBPRTFLG=0 D DET D PAUSE:'IBPRTFLG I IBQ!'IBPRTFLG G ENQ
"RTN","IBJDF42",18,0)
 ;
"RTN","IBJDF42",19,0)
 D PAUSE I IBQ G ENQ
"RTN","IBJDF42",20,0)
 ;
"RTN","IBJDF42",21,0)
SUM I 'IBQ D PRT^IBJDF43 ; Print summary.
"RTN","IBJDF42",22,0)
ENQ K IB0,IBAI,IBC,IBCAT,IBCD,IBC1,IBC2,IBCT,IBCNT,IBN,IBP,IBPAG,IBQ,IBRUN,IBS
"RTN","IBJDF42",23,0)
 K IBST,IBTOT,%,DFN,IBPRTFLG
"RTN","IBJDF42",24,0)
 Q
"RTN","IBJDF42",25,0)
 ;
"RTN","IBJDF42",26,0)
DET ; - Print report for a specific category.
"RTN","IBJDF42",27,0)
 ;
"RTN","IBJDF42",28,0)
 D HDR1 G:IBQ DETQ
"RTN","IBJDF42",29,0)
 S (IBPT,IB,IBCAT,IB0)=""
"RTN","IBJDF42",30,0)
 F  S IBPT=$O(^TMP("IBJDF4",$J,IBPT)) Q:IBPT=""  D  Q:IBQ
"RTN","IBJDF42",31,0)
 . I $O(^TMP("IBJDF4",$J,IBPT,0))="" Q
"RTN","IBJDF42",32,0)
 . S IBP=$G(^TMP("IBJDF4",$J,IBPT))
"RTN","IBJDF42",33,0)
 . I $Y>(IOSL-14) D PAUSE Q:IBQ  D HDR1 Q:IBQ
"RTN","IBJDF42",34,0)
 . D WPAT
"RTN","IBJDF42",35,0)
 . F IB=16,19 D  Q:IBQ
"RTN","IBJDF42",36,0)
 . . I IBSTA="A",IB'=16 Q
"RTN","IBJDF42",37,0)
 . . I IBSTA="S",IB=16 Q
"RTN","IBJDF42",38,0)
 . . I '$D(^TMP("IBJDF4",$J,IBPT,IB)) D  Q
"RTN","IBJDF42",39,0)
 . . . I $Y>(IOSL-5) D PAUSE Q:IBQ  D HDR1,WPAT,HDR2 Q:IBQ
"RTN","IBJDF42",40,0)
 . . . W !,"-> NO "_$S(IB=16:"ACTIVE",1:"SUSPENDED")_" BILLS."
"RTN","IBJDF42",41,0)
 . . I $Y>(IOSL-9) D PAUSE Q:IBQ  D HDR1,WPAT Q:IBQ
"RTN","IBJDF42",42,0)
 . . D HDR2
"RTN","IBJDF42",43,0)
 . . K IBFLG S IBTOT="",IBCNT=0
"RTN","IBJDF42",44,0)
 . . F  S IBCAT=$O(^TMP("IBJDF4",$J,IBPT,IB,IBCAT)) Q:IBCAT=""  D  Q:IBQ
"RTN","IBJDF42",45,0)
 . . . F  S IB0=$O(^TMP("IBJDF4",$J,IBPT,IB,IBCAT,IB0)) Q:IB0=""  D  Q:IBQ
"RTN","IBJDF42",46,0)
 . . . . S IBN=$G(^TMP("IBJDF4",$J,IBPT,IB,IBCAT,IB0))
"RTN","IBJDF42",47,0)
 . . . . I $Y>(IOSL-5) D PAUSE Q:IBQ  D HDR1,WPAT,HDR2 Q:IBQ
"RTN","IBJDF42",48,0)
 . . . . D WBIL Q:IBQ
"RTN","IBJDF42",49,0)
 . . . . S IBCNT=IBCNT+1
"RTN","IBJDF42",50,0)
 . . . I 'IBQ,$O(^TMP("IBJDF4",$J,IBPT,IB,IBCAT))="" D
"RTN","IBJDF42",51,0)
 . . . . D TOT W !
"RTN","IBJDF42",52,0)
 . . ; - Display bill comment history, if selected.
"RTN","IBJDF42",53,0)
 . . S IBPRTFLG=1
"RTN","IBJDF42",54,0)
 . . D WCOM(IBPT,IB)
"RTN","IBJDF42",55,0)
 ;
"RTN","IBJDF42",56,0)
 I 'IBPRTFLG D
"RTN","IBJDF42",57,0)
 . W !!!!!!,"There are no receivables for the parameters entered."
"RTN","IBJDF42",58,0)
 ;
"RTN","IBJDF42",59,0)
DETQ Q
"RTN","IBJDF42",60,0)
 ;
"RTN","IBJDF42",61,0)
WPAT ; - Write patient data.
"RTN","IBJDF42",62,0)
 N I,X
"RTN","IBJDF42",63,0)
 S DFN=$P(IBPT,"@@",2),IBAI=$G(^TMP("IBJDF4",$J,IBPT,0,"A"))
"RTN","IBJDF42",64,0)
 W !!,"Patient Name     : ",$P(IBP,U) W:IBAI["V" " *"
"RTN","IBJDF42",65,0)
 W ?63,"SSN: ",$$SSN($P(IBP,U,2)),!,"Means Test Status: ",$P(IBP,U,4)
"RTN","IBJDF42",66,0)
 W:$P(IBP,U,5)'="" " ("_$P(IBP,U,5)_")"
"RTN","IBJDF42",67,0)
 W ?58,"Medicaid: ",$$GET1^DIQ(2,DFN,.381)
"RTN","IBJDF42",68,0)
 W !,"RX Copay Status  : ",$P(IBP,U,6)
"RTN","IBJDF42",69,0)
 W:$P(IBP,U,7)'="" " ("_$P(IBP,U,7)_")"
"RTN","IBJDF42",70,0)
 W:$P(IBP,U,8) ?53,"Date of Death: ",$$DAT1^IBOUTL($P(IBP,U,8))
"RTN","IBJDF42",71,0)
 W !,"Eligibilities    : " S X=$$ELIG($P(IBP,U,3))
"RTN","IBJDF42",72,0)
 F I=1:1 Q:X=""  W ?19,$E(X,1,61) S X=$E(X,62,999) I X'="" W !
"RTN","IBJDF42",73,0)
 S X=$$INFO(IBAI)
"RTN","IBJDF42",74,0)
 I X'="" D
"RTN","IBJDF42",75,0)
 . W !,"Additional Info  : "
"RTN","IBJDF42",76,0)
 . F I=1:1 Q:X=""  W ?19,$E(X,1,61) S X=$E(X,62,999) I X'="" W !
"RTN","IBJDF42",77,0)
 ;
"RTN","IBJDF42",78,0)
 Q
"RTN","IBJDF42",79,0)
 ;
"RTN","IBJDF42",80,0)
WBIL ; - Write bill data.
"RTN","IBJDF42",81,0)
 W ! W:'$D(IBFLG(IBCAT)) IBCT(IBCAT) W ?13,IB0
"RTN","IBJDF42",82,0)
 W:$P(IBN,"^",6) ?25,$J("("_$P(IBN,"^",6)_")",4)
"RTN","IBJDF42",83,0)
 W ?30,$$DAT1^IBOUTL(+IBN)
"RTN","IBJDF42",84,0)
 W ?39,$J($FN($P(IBN,U,2),",",2),10),?50,$J($FN($P(IBN,U,3),",",2),10)
"RTN","IBJDF42",85,0)
 W ?61,$J($FN($P(IBN,U,4),",",2),9),?71,$J($FN($P(IBN,U,5),",",2),9)
"RTN","IBJDF42",86,0)
 S $P(IBTOT,"^")=$P(IBTOT,"^")+$P(IBN,U,2)
"RTN","IBJDF42",87,0)
 S $P(IBTOT,"^",2)=$P(IBTOT,"^",2)+$P(IBN,U,3)
"RTN","IBJDF42",88,0)
 S $P(IBTOT,"^",3)=$P(IBTOT,"^",3)+$P(IBN,U,4)
"RTN","IBJDF42",89,0)
 S $P(IBTOT,"^",4)=$P(IBTOT,"^",4)+$P(IBN,U,5)
"RTN","IBJDF42",90,0)
 S IBFLG(IBCAT)=""
"RTN","IBJDF42",91,0)
 Q
"RTN","IBJDF42",92,0)
 ;
"RTN","IBJDF42",93,0)
WCOM(IBPT,IB) ; - Write bill comments.
"RTN","IBJDF42",94,0)
 N CMDT,CONT,DIWL,DIWR,IBIDX,IBTR,IBLN,IBX,X
"RTN","IBJDF42",95,0)
 ;
"RTN","IBJDF42",96,0)
 S (IBIDX,IBTR,IBLN)="",DIWL=1,DIWR=64 K ^UTILITY($J,"W")
"RTN","IBJDF42",97,0)
 F  S IBIDX=$O(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX)) Q:IBIDX=""  D  Q:IBQ
"RTN","IBJDF42",98,0)
 . I $Y>(IOSL-6) D WCPB Q:IBQ
"RTN","IBJDF42",99,0)
 . D WCD(IBIDX)
"RTN","IBJDF42",100,0)
 . F  S IBTR=$O(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX,IBTR)) Q:IBTR=""  D  Q:IBQ
"RTN","IBJDF42",101,0)
 . . S CMDT=$G(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX,IBTR))
"RTN","IBJDF42",102,0)
 . . I $Y>(IOSL-4) D WCPB Q:IBQ
"RTN","IBJDF42",103,0)
 . . S CONT=0 D WCD(,1,)
"RTN","IBJDF42",104,0)
 . . F  S IBLN=$O(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX,IBTR,IBLN)) Q:IBLN=""  D  Q:IBQ
"RTN","IBJDF42",105,0)
 . . . S IBX=$G(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX,IBTR,IBLN))
"RTN","IBJDF42",106,0)
 . . . I $E(IBX)=" ",$L(IBX)>1 S $E(IBX)=""
"RTN","IBJDF42",107,0)
 . . . S X=IBX D ^DIWP
"RTN","IBJDF42",108,0)
 . . . I 'CONT,$L(IBX)<66 D WCTX
"RTN","IBJDF42",109,0)
 . . . S CONT=$L(IBX)>65
"RTN","IBJDF42",110,0)
 . . . I '$O(^TMP("IBJDF4",$J,IBPT,0,"C",IB,IBIDX,IBTR,IBLN)) D
"RTN","IBJDF42",111,0)
 . . . . D:$D(^UTILITY($J,"W")) WCTX
"RTN","IBJDF42",112,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF42",113,0)
 Q
"RTN","IBJDF42",114,0)
 ;
"RTN","IBJDF42",115,0)
WCD(I,D,C) ; - Write the comment date.
"RTN","IBJDF42",116,0)
 ; Input: I - Index #         "(I)"
"RTN","IBJDF42",117,0)
 ;        D - Print the Date  " - MM/DD/YY"
"RTN","IBJDF42",118,0)
 ;        C - Print the Cont. "(Continued)"
"RTN","IBJDF42",119,0)
 ;
"RTN","IBJDF42",120,0)
 W:$G(I) !,"(",I,")" W:$G(D) ?3," - ",$$DAT1^IBOUTL(CMDT),": "
"RTN","IBJDF42",121,0)
 W:$G(C) "(Continued)",!
"RTN","IBJDF42",122,0)
 Q
"RTN","IBJDF42",123,0)
 ;
"RTN","IBJDF42",124,0)
WCTX ; - Write the comment text.
"RTN","IBJDF42",125,0)
 N LIN,WLIN,Z
"RTN","IBJDF42",126,0)
 S LIN=""
"RTN","IBJDF42",127,0)
 F  S LIN=$O(^UTILITY($J,"W",1,LIN)) Q:LIN=""  D  Q:IBQ
"RTN","IBJDF42",128,0)
 . S WLIN=$G(^UTILITY($J,"W",1,LIN,0)) Q:WLIN=""
"RTN","IBJDF42",129,0)
 . W ?16,WLIN
"RTN","IBJDF42",130,0)
 . I '$O(^UTILITY($J,"W",1,LIN)) W ! Q
"RTN","IBJDF42",131,0)
 . I $Y>(IOSL-4) D WCPB,WCD(IBIDX,1,1) Q
"RTN","IBJDF42",132,0)
 . W !
"RTN","IBJDF42",133,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF42",134,0)
 Q
"RTN","IBJDF42",135,0)
 ;
"RTN","IBJDF42",136,0)
WCPB ; - Page Break in the middle of the Comments
"RTN","IBJDF42",137,0)
 D PAUSE Q:IBQ  D HDR1,WPAT W !!
"RTN","IBJDF42",138,0)
 Q
"RTN","IBJDF42",139,0)
 ;
"RTN","IBJDF42",140,0)
HDR1 ; - Write the report header.
"RTN","IBJDF42",141,0)
 N X,I
"RTN","IBJDF42",142,0)
 W:'$G(IBPAG) ! I $E(IOST,1,2)="C-"!$G(IBPAG) W @IOF,*13
"RTN","IBJDF42",143,0)
 S IBPAG=$G(IBPAG)+1 W "First Party Follow-Up Report"
"RTN","IBJDF42",144,0)
 W ?34,"Run Date: ",IBRUN,?71,"Page: ",$J(IBPAG,3)
"RTN","IBJDF42",145,0)
 S X="ALL "_$S(IBSTA'="S":"ACTIVE",1:"")_$S(IBSTA="B":" AND ",1:"")
"RTN","IBJDF42",146,0)
 S X=X_$S(IBSTA'="A":"SUSPENDED",1:"")_$$TYPE(IBSEL)_" RECEIVABLES"
"RTN","IBJDF42",147,0)
 I IBSMN'="A" S X=X_" OVER "_IBSMN_" AND UNDER "_IBSMX_" DAYS OLD"
"RTN","IBJDF42",148,0)
 S X=X_" / BY "_$S(IBSN="N":"NAME",1:"LAST 4 SSN")
"RTN","IBJDF42",149,0)
 S X=X_" ("_$S($G(IBSNA)="ALL":"ALL",1:"From "_$S(IBSNF="":"FIRST",1:IBSNF)_" to "_$S(IBSNL="zzzzz":"LAST",1:IBSNL))_")"
"RTN","IBJDF42",150,0)
 S X=X_" / "_$S('IBSAM:"NO ",1:"")_"MINIMUM BALANCE"
"RTN","IBJDF42",151,0)
 S X=X_$S(IBSAM:": $"_$FN(IBSAM,",",2),1:"")
"RTN","IBJDF42",152,0)
 S X=X_" / "_$S('IBSH:"NO ",IBSH1="A":"ALL ",1:"ONLY ")_"COMMENTS"
"RTN","IBJDF42",153,0)
 S X=X_$S($G(IBSH2):" LESS THAN "_IBSH2_" DAYS OLD",1:"")
"RTN","IBJDF42",154,0)
 S X=X_" / RECEIVABLES REFERRED TO RC "_$S('IBSRC:"NOT ",1:"")_"INCLUDED"
"RTN","IBJDF42",155,0)
 F I=1:1 W !,$E(X,1,80) S X=$E(X,81,999) I X="" Q
"RTN","IBJDF42",156,0)
 ;
"RTN","IBJDF42",157,0)
 S IBQ=$$STOP^IBOUTL("First Party Follow-Up Report")
"RTN","IBJDF42",158,0)
 Q
"RTN","IBJDF42",159,0)
 ;
"RTN","IBJDF42",160,0)
TYPE(SEL) ; Returns a string with the type of receivables (description)
"RTN","IBJDF42",161,0)
 ; selected or NULL if ALL receivable type have been selected.
"RTN","IBJDF42",162,0)
 ; SEL - User input for the parameter "Type of Receivable"
"RTN","IBJDF42",163,0)
 ;
"RTN","IBJDF42",164,0)
 N TYPE,I,X
"RTN","IBJDF42",165,0)
 I SEL="1,2,3," Q ""
"RTN","IBJDF42",166,0)
 S TYPE="",X="EMERGENCY/HUMANITARIAN^INELIGIBLE^C-MEANS TEST & RX COPAY"
"RTN","IBJDF42",167,0)
 F I=2:1:($L(SEL,",")-1) D
"RTN","IBJDF42",168,0)
 . S TYPE=TYPE_$S(I=($L(SEL,",")-1)&(TYPE'=""):" AND ",1:", ")
"RTN","IBJDF42",169,0)
 . S TYPE=TYPE_$P(X,"^",+$P(SEL,",",I))
"RTN","IBJDF42",170,0)
 S $E(TYPE,1)=""
"RTN","IBJDF42",171,0)
 ;
"RTN","IBJDF42",172,0)
 Q TYPE
"RTN","IBJDF42",173,0)
 ;
"RTN","IBJDF42",174,0)
HDR2 ; - Write bill sub-header.
"RTN","IBJDF42",175,0)
 W ! I IBSTA="B" W !,$S(IB=16:"ACTIVE",1:"SUSPENDED")
"RTN","IBJDF42",176,0)
 W ! I IBSTA="B" W $S(IB=16:"======",1:"=========")
"RTN","IBJDF42",177,0)
 W:IBSH ?26,"COM" W ?30,"Last",?40,"Current",?51,"Principal"
"RTN","IBJDF42",178,0)
 W !,"Category",?13,"Bill Number",?26,"REF"
"RTN","IBJDF42",179,0)
 W ?30,"Payment",?40,"Balance",?51,"Balance",?62,"Interest",?72,"Admin."
"RTN","IBJDF42",180,0)
 W !,$$DASH(80,1)
"RTN","IBJDF42",181,0)
 Q
"RTN","IBJDF42",182,0)
 ;
"RTN","IBJDF42",183,0)
TOT ; - Write balance total for patient.
"RTN","IBJDF42",184,0)
 N I,J
"RTN","IBJDF42",185,0)
 I IBCNT>1 W ! F I=40,51,62,72 W ?I,$E("---------",1,$S(I>60:8,1:9))
"RTN","IBJDF42",186,0)
 W:IBCNT'>1 !
"RTN","IBJDF42",187,0)
 W !,"Account Balance: $"_$FN($P(IBP,"^",10),",",2)
"RTN","IBJDF42",188,0)
 I IBCNT'>1 Q
"RTN","IBJDF42",189,0)
 S J=1 F I=39,50,60,70 W ?I,$J($FN($P(IBTOT,"^",J),",",2),10) S J=J+1
"RTN","IBJDF42",190,0)
 Q
"RTN","IBJDF42",191,0)
 ;
"RTN","IBJDF42",192,0)
DASH(X,Y) ; - Return a dashed line.
"RTN","IBJDF42",193,0)
 Q $TR($J("",X)," ",$S(Y:"-",1:"="))
"RTN","IBJDF42",194,0)
 ;
"RTN","IBJDF42",195,0)
ELIG(X) ; - Return eligibility code name.
"RTN","IBJDF42",196,0)
 ; X - Eligibility codes separated by semi-collon (;)
"RTN","IBJDF42",197,0)
 ;
"RTN","IBJDF42",198,0)
 N ELIG,I
"RTN","IBJDF42",199,0)
 S ELIG="" F I=1:1:$L(X,";") D
"RTN","IBJDF42",200,0)
 . I '$P(X,";",I) Q
"RTN","IBJDF42",201,0)
 . S ELIG=ELIG_", "_$E($P($G(^DIC(8,+$P(X,";",I),0)),U),1,20)
"RTN","IBJDF42",202,0)
 S $E(ELIG,1,2)=""
"RTN","IBJDF42",203,0)
 ;
"RTN","IBJDF42",204,0)
 Q ELIG
"RTN","IBJDF42",205,0)
 ;
"RTN","IBJDF42",206,0)
INFO(X) ; - Return the patient Additional Information about the Patient Accout
"RTN","IBJDF42",207,0)
 ; X - Flags representing the observations
"RTN","IBJDF42",208,0)
 ;
"RTN","IBJDF42",209,0)
 N INFO,I
"RTN","IBJDF42",210,0)
 S INFO="" F I=1:1:$L(X) D
"RTN","IBJDF42",211,0)
 . I $E(X,I)="V" S INFO=INFO_", '*' - VA EMPLOYEE"
"RTN","IBJDF42",212,0)
 . I $E(X,I)="R" S INFO=INFO_", REFERRED TO RC"
"RTN","IBJDF42",213,0)
 . I $E(X,I)="D" S INFO=INFO_", REFERRED TO DMC"
"RTN","IBJDF42",214,0)
 . I $E(X,I)="T" S INFO=INFO_", REFERRED TO TOP"
"RTN","IBJDF42",215,0)
 . I $E(X,I)="P" S INFO=INFO_", UNDER REPAYMENT PLAN"
"RTN","IBJDF42",216,0)
 . I $E(X,I)="F" S INFO=INFO_", UNDER DEFAULTED REPAYMENT PLAN"
"RTN","IBJDF42",217,0)
 S $E(INFO,1,2)=""
"RTN","IBJDF42",218,0)
 ;
"RTN","IBJDF42",219,0)
 Q INFO
"RTN","IBJDF42",220,0)
 ;
"RTN","IBJDF42",221,0)
SSN(X) ; - Format the SSN.
"RTN","IBJDF42",222,0)
 Q $S(X]"":$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),1:"")
"RTN","IBJDF42",223,0)
 ;
"RTN","IBJDF42",224,0)
PAUSE ; - Page break.
"RTN","IBJDF42",225,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDF42",226,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDF42",227,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBJDF42",228,0)
 S DIR(0)="E" D ^DIR S:$D(DIRUT)!($D(DUOUT)) IBQ=1
"RTN","IBJDF42",229,0)
 Q
"VER")
8.0^22.0
**END**
**END**
