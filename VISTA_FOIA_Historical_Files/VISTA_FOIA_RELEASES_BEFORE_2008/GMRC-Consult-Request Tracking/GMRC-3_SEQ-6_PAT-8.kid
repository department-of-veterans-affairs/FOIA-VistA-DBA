Released GMRC*3*8 SEQ #6
Extracted from mail message
**KIDS**:GMRC*3.0*8^

**INSTALL NAME**
GMRC*3.0*8
"BLD",1690,0)
GMRC*3.0*8^CONSULT/REQUEST TRACKING^0^2990714^y
"BLD",1690,1,0)
^^1^1^2990630^
"BLD",1690,1,1,0)
See National Patch Module for complete details of enhancements.
"BLD",1690,4,0)
^9.64PA^^
"BLD",1690,"ABPKG")
n
"BLD",1690,"KRN",0)
^9.67PA^19^18
"BLD",1690,"KRN",.4,0)
.4
"BLD",1690,"KRN",.401,0)
.401
"BLD",1690,"KRN",.402,0)
.402
"BLD",1690,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",1690,"KRN",.402,"NM",1,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",1690,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",1)

"BLD",1690,"KRN",.403,0)
.403
"BLD",1690,"KRN",.5,0)
.5
"BLD",1690,"KRN",.84,0)
.84
"BLD",1690,"KRN",3.6,0)
3.6
"BLD",1690,"KRN",3.8,0)
3.8
"BLD",1690,"KRN",9.2,0)
9.2
"BLD",1690,"KRN",9.8,0)
9.8
"BLD",1690,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1690,"KRN",9.8,"NM",1,0)
GMRCSTS^^0^B34172384
"BLD",1690,"KRN",9.8,"NM",2,0)
GMRCSTS1^^0^B20713150
"BLD",1690,"KRN",9.8,"NM","B","GMRCSTS",1)

"BLD",1690,"KRN",9.8,"NM","B","GMRCSTS1",2)

"BLD",1690,"KRN",19,0)
19
"BLD",1690,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",1690,"KRN",19,"NM",1,0)
GMRCSTSU^^0
"BLD",1690,"KRN",19,"NM",2,0)
GMRC MGR^^2
"BLD",1690,"KRN",19,"NM","B","GMRC MGR",2)

"BLD",1690,"KRN",19,"NM","B","GMRCSTSU",1)

"BLD",1690,"KRN",19.1,0)
19.1
"BLD",1690,"KRN",101,0)
101
"BLD",1690,"KRN",409.61,0)
409.61
"BLD",1690,"KRN",771,0)
771
"BLD",1690,"KRN",869.2,0)
869.2
"BLD",1690,"KRN",870,0)
870
"BLD",1690,"KRN",8994,0)
8994
"BLD",1690,"KRN","B",.4,.4)

"BLD",1690,"KRN","B",.401,.401)

"BLD",1690,"KRN","B",.402,.402)

"BLD",1690,"KRN","B",.403,.403)

"BLD",1690,"KRN","B",.5,.5)

"BLD",1690,"KRN","B",.84,.84)

"BLD",1690,"KRN","B",3.6,3.6)

"BLD",1690,"KRN","B",3.8,3.8)

"BLD",1690,"KRN","B",9.2,9.2)

"BLD",1690,"KRN","B",9.8,9.8)

"BLD",1690,"KRN","B",19,19)

"BLD",1690,"KRN","B",19.1,19.1)

"BLD",1690,"KRN","B",101,101)

"BLD",1690,"KRN","B",409.61,409.61)

"BLD",1690,"KRN","B",771,771)

"BLD",1690,"KRN","B",869.2,869.2)

"BLD",1690,"KRN","B",870,870)

"BLD",1690,"KRN","B",8994,8994)

"BLD",1690,"QUES",0)
^9.62^^
"BLD",1690,"REQB",0)
^9.611^2^2
"BLD",1690,"REQB",1,0)
GMRC*3.0*4^2
"BLD",1690,"REQB",2,0)
GMRC*3.0*5^2
"BLD",1690,"REQB","B","GMRC*3.0*4",1)

"BLD",1690,"REQB","B","GMRC*3.0*5",2)

"KRN",.402,763,-1)
0^1
"KRN",.402,763,0)
GMRC SETUP REQUEST SERVICE^2990630.1022^^123.5^^^2990630
"KRN",.402,763,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,763,"DIAB",3,0,123.5,0)
1.11;"ABBREVIATED PRINT NAME (Optional)"
"KRN",.402,763,"DR",1,123.5)
.01;123.01///^S X="CONSULTS";1.11ABBREVIATED PRINT NAME (Optional)~;1.1;2;123.09;123.03;123.3;123.33;123.08;123.5;123.1;10;101;
"KRN",.402,763,"DR",2,123.51)
.01:2
"KRN",.402,763,"DR",2,123.5101)
.01;
"KRN",.402,763,"DR",2,123.52)
.01
"KRN",.402,763,"DR",2,123.53)
.01
"KRN",.402,763,"DR",2,123.55)
.01
"KRN",.402,763,"DR",2,123.555)
.01
"KRN",19,2046,-1)
2^2
"KRN",19,2046,0)
GMRC MGR^Consult Management^^M^.5^^^^^^^128
"KRN",19,2046,10,0)
^19.01PI^11^10
"KRN",19,2046,10,11,0)
7738^GU^25
"KRN",19,2046,10,11,"^")
GMRCSTSU
"KRN",19,2046,"U")
CONSULT MANAGEMENT
"KRN",19,7738,-1)
0^1
"KRN",19,7738,0)
GMRCSTSU^Group update of consult/procedure requests^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,7738,1,0)
^^16^16^2990503^
"KRN",19,7738,1,1,0)
This option will allow a search of the REQUEST/CONSULTATION (#123) file 
"KRN",19,7738,1,2,0)
for requests to a particular service within a date range. The status of
"KRN",19,7738,1,3,0)
the entries meeting the selected criteria may be updated to COMPLETE or
"KRN",19,7738,1,4,0)
DISCONTINUED. A comment of up to 256 characters may be entered once and
"KRN",19,7738,1,5,0)
attached to each of the entries. 
"KRN",19,7738,1,6,0)
 
"KRN",19,7738,1,7,0)
A report of those records to be updated may be printed without performing
"KRN",19,7738,1,8,0)
the status updates. The option also allows printing of the records along
"KRN",19,7738,1,9,0)
with the status updates.
"KRN",19,7738,1,10,0)
 
"KRN",19,7738,1,11,0)
The status of the corresponding order in CPRS will be updated to match
"KRN",19,7738,1,12,0)
that in file 123.
"KRN",19,7738,1,13,0)
 
"KRN",19,7738,1,14,0)
Only the user entered in the SPECIAL UPDATES INDIVIDUAL field #123.5 of
"KRN",19,7738,1,15,0)
the REQUEST SERVICES (#123.5) file will be allowed to perform the updates
"KRN",19,7738,1,16,0)
for the chosen service.
"KRN",19,7738,25)
GMRCSTS
"KRN",19,7738,"U")
GROUP UPDATE OF CONSULT/PROCED
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
8^2990714^1322
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^2990714
"PKG",128,22,1,"PAH",1,1,1,0)
See National Patch Module for complete details of enhancements.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRCSTS")
0^1^B34172384
"RTN","GMRCSTS",1,0)
GMRCSTS ;SLC/DLT,JFR - Group update status of consult and order;4/20/98  23:20
"RTN","GMRCSTS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8**;DEC 27, 1997
"RTN","GMRCSTS",3,0)
 N GMRCTO,GMRCDG,GMRCSVC,GMRCSVCN,GMRCEND,GMRCSTRT,GMRCSTOP,GMRCGRP
"RTN","GMRCSTS",4,0)
 N GMRCCVT,GMRCM,GMRCMT,GMRCDO,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",5,0)
 D GETSRV I 'GMRCDG D END Q
"RTN","GMRCSTS",6,0)
 D GETDTR I GMRCEND D END Q
"RTN","GMRCSTS",7,0)
 S GMRCM=$$METHOD I GMRCEND D END Q
"RTN","GMRCSTS",8,0)
 S GMRCCVT=$$UPD1 I GMRCEND D END Q
"RTN","GMRCSTS",9,0)
 D UPDCMT(.GMRCMT)
"RTN","GMRCSTS",10,0)
 D VERIFY I GMRCEND D END Q
"RTN","GMRCSTS",11,0)
 D GETENTS^GMRCSTS1(GMRCSVC,GMRCSTRT,GMRCSTOP,GMRCM)
"RTN","GMRCSTS",12,0)
 S GMRCDO=$$WHATTODO I 'GMRCDO D END Q
"RTN","GMRCSTS",13,0)
 D DEVICE I $G(GMRCEND) D END Q
"RTN","GMRCSTS",14,0)
 I $D(IO("Q")) D QUEUE,^%ZISC,END Q
"RTN","GMRCSTS",15,0)
 D PRINT^GMRCSTS1(GMRCM,GMRCCVT,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO)
"RTN","GMRCSTS",16,0)
 D END Q
"RTN","GMRCSTS",17,0)
GETSRV ;Get a service that the user is authorized to update status for
"RTN","GMRCSTS",18,0)
 D ^GMRCASV Q:'GMRCDG
"RTN","GMRCSTS",19,0)
 S GMRCSVC=+GMRCDG,GMRCSVCN=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCSTS",20,0)
 I $P($G(^GMR(123.5,+GMRCDG,0)),"^",4)=DUZ Q  ;user has special privileges
"RTN","GMRCSTS",21,0)
 ;Check for parent service authorization
"RTN","GMRCSTS",22,0)
 N AUTH,PARENT
"RTN","GMRCSTS",23,0)
 I $P(^GMR(123.5,1,0),U,4)=DUZ Q
"RTN","GMRCSTS",24,0)
 S (AUTH,PARENT)=0 F  S PARENT=$O(^GMR(123.5,"APC",+GMRCDG,PARENT)) Q:'PARENT  S:$P($G(^GMR(123.5,+PARENT,0)),U,4)=DUZ AUTH=PARENT
"RTN","GMRCSTS",25,0)
 I 'AUTH D UNAUTH S GMRCDG=0 G GETSRV
"RTN","GMRCSTS",26,0)
 Q
"RTN","GMRCSTS",27,0)
 ;
"RTN","GMRCSTS",28,0)
UNAUTH ;Unauthorized to do special update processing for service or its parent.
"RTN","GMRCSTS",29,0)
 N GMRCMSG
"RTN","GMRCSTS",30,0)
 W !
"RTN","GMRCSTS",31,0)
 S GMRCMSG="You are not defined as the SPECIAL UPDATES INDIVIDUAL for the"
"RTN","GMRCSTS",32,0)
 S GMRCMSG(1)=GMRCSVCN_" service or its parent service."
"RTN","GMRCSTS",33,0)
 S GMRCDG=0
"RTN","GMRCSTS",34,0)
 D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCSTS",35,0)
 Q
"RTN","GMRCSTS",36,0)
 ;
"RTN","GMRCSTS",37,0)
GETDTR ;Get the date range
"RTN","GMRCSTS",38,0)
 ;END=# of days (T-END) for stop default limitations
"RTN","GMRCSTS",39,0)
 ;GMRCSTRT=Start date/time
"RTN","GMRCSTS",40,0)
 ;GMRCSTOP=Stop date/time
"RTN","GMRCSTS",41,0)
 ;GMRCEND=1 if user timed out or "^"
"RTN","GMRCSTS",42,0)
 S GMRCEND=0
"RTN","GMRCSTS",43,0)
 N X1,X2,X,END
"RTN","GMRCSTS",44,0)
 S X1=$$DT^XLFDT,X2=-30 D C^%DTC S END=X K X
"RTN","GMRCSTS",45,0)
 D START Q:GMRCEND
"RTN","GMRCSTS",46,0)
 D STOP Q:GMRCEND
"RTN","GMRCSTS",47,0)
 Q
"RTN","GMRCSTS",48,0)
 ;
"RTN","GMRCSTS",49,0)
START ;Get the start date
"RTN","GMRCSTS",50,0)
 N DIR,Y,ORDER,FIRST,GMRCIEN
"RTN","GMRCSTS",51,0)
 S ORDER=$O(^GMR(123,"AC",0)),GMRCIEN=$O(^GMR(123,"AC",+ORDER,""))
"RTN","GMRCSTS",52,0)
 I +$G(GMRCIEN) D
"RTN","GMRCSTS",53,0)
 . S Y=$P($G(^GMR(123,GMRCIEN,0)),U,1)
"RTN","GMRCSTS",54,0)
 . X ^DD("DD") S FIRST=$P(Y,"@",1)
"RTN","GMRCSTS",55,0)
 . S DIR("B")=FIRST
"RTN","GMRCSTS",56,0)
 . W !!,"The first order in Consults has an entry date of "_DIR("B"),!
"RTN","GMRCSTS",57,0)
 . Q
"RTN","GMRCSTS",58,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Start Date"
"RTN","GMRCSTS",59,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","GMRCSTS",60,0)
 D ^DIR
"RTN","GMRCSTS",61,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",62,0)
 S GMRCSTRT=Y
"RTN","GMRCSTS",63,0)
 Q
"RTN","GMRCSTS",64,0)
 ;
"RTN","GMRCSTS",65,0)
STOP ;Get the stop date
"RTN","GMRCSTS",66,0)
 N DIR,Y,X
"RTN","GMRCSTS",67,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Stop Date"
"RTN","GMRCSTS",68,0)
 D ^DIR
"RTN","GMRCSTS",69,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",70,0)
 I Y<GMRCSTRT S GMRCSTOP=GMRCSTRT,GMRCSTRT=Y
"RTN","GMRCSTS",71,0)
 E  S GMRCSTOP=Y
"RTN","GMRCSTS",72,0)
 Q
"RTN","GMRCSTS",73,0)
 ;
"RTN","GMRCSTS",74,0)
METHOD() ;Get method to determine which consults to change
"RTN","GMRCSTS",75,0)
 N DIR,Y,X
"RTN","GMRCSTS",76,0)
 S DIR(0)="SM^P:Pending;A:Active;B:Both"
"RTN","GMRCSTS",77,0)
 S DIR("A")="Status(es) to search for updating"
"RTN","GMRCSTS",78,0)
 D ^DIR
"RTN","GMRCSTS",79,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1
"RTN","GMRCSTS",80,0)
 Q Y
"RTN","GMRCSTS",81,0)
 S DIR(0)="SM^S:Order Status of Pending or Active;R:Result Activity"
"RTN","GMRCSTS",82,0)
 S DIR("A")="Method to find Consults to Update"
"RTN","GMRCSTS",83,0)
 D ^DIR
"RTN","GMRCSTS",84,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",85,0)
 Q Y
"RTN","GMRCSTS",86,0)
 ;
"RTN","GMRCSTS",87,0)
VERIFY ;Verify the criteria is correct
"RTN","GMRCSTS",88,0)
 W !
"RTN","GMRCSTS",89,0)
 D UPDCRIT^GMRCSTS1(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS",90,0)
 N DIR
"RTN","GMRCSTS",91,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="NO"
"RTN","GMRCSTS",92,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",93,0)
 Q
"RTN","GMRCSTS",94,0)
UPD1() ;Determine update status
"RTN","GMRCSTS",95,0)
 N DIR,X,Y
"RTN","GMRCSTS",96,0)
 W !!,"If orders in the date range still have the selected status, this option"
"RTN","GMRCSTS",97,0)
 W !,"will change their status in consults, and update the order."
"RTN","GMRCSTS",98,0)
 W !!,"You may change the status to COMPLETE or DISCONTINUED."
"RTN","GMRCSTS",99,0)
 W !
"RTN","GMRCSTS",100,0)
 S DIR(0)="SAM^D:Discontinued;C:Complete"
"RTN","GMRCSTS",101,0)
 S DIR("A")="Change their status to: "
"RTN","GMRCSTS",102,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",103,0)
 Q $S(Y="D":"1^DC",1:"2^C")
"RTN","GMRCSTS",104,0)
 ;
"RTN","GMRCSTS",105,0)
DEVICE ; device for printout of entries to group update
"RTN","GMRCSTS",106,0)
 N %ZIS,POP
"RTN","GMRCSTS",107,0)
 W !!,"The device selected will print a list of entries from file 123 that will be"
"RTN","GMRCSTS",108,0)
 W !,"updated to ",$S(+GMRCCVT=1:"DISCONTINUED",1:"COMPLETE"),"."
"RTN","GMRCSTS",109,0)
 W !!,"If you choose to update records, the update of the consult entries will take"
"RTN","GMRCSTS",110,0)
 W !,"place upon completion of the report."
"RTN","GMRCSTS",111,0)
 W !!,"It is highly advised that a printer be selected!"
"RTN","GMRCSTS",112,0)
RETRY S %ZIS="QM",%ZIS("A")="Select device for report: ",%ZIS("B")=""
"RTN","GMRCSTS",113,0)
 D ^%ZIS I POP S GMRCEND=1 Q
"RTN","GMRCSTS",114,0)
 I $E(IOST,1,2)="C-" D  G:Y<1 RETRY
"RTN","GMRCSTS",115,0)
 . W !!,$C(7),"You have not chosen a printer!  If you do not choose a printer there will",!,"be no record of the entries that were updated."
"RTN","GMRCSTS",116,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",117,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to use this device"
"RTN","GMRCSTS",118,0)
 . S DIR("B")="NO" D ^DIR I $D(DIRUT) S GMRCEND=1
"RTN","GMRCSTS",119,0)
 Q
"RTN","GMRCSTS",120,0)
QUEUE ; send task for print and update
"RTN","GMRCSTS",121,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK
"RTN","GMRCSTS",122,0)
 S ZTRTN="PRTTSK^GMRCSTS1",ZTDESC="UPDATE OF RECORDS FILE 123"
"RTN","GMRCSTS",123,0)
 S ZTIO=ION
"RTN","GMRCSTS",124,0)
 S ZTSAVE("^TMP(""GMRCLS"",$J,")="",ZTSAVE("GMRC*")=""
"RTN","GMRCSTS",125,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task # ",ZTSK
"RTN","GMRCSTS",126,0)
 I '$G(ZTSK) W !,"Unable to queue report!  Try again later."
"RTN","GMRCSTS",127,0)
 Q
"RTN","GMRCSTS",128,0)
UPDCMT(COMMENT) ; get comment to stuff in consult activity
"RTN","GMRCSTS",129,0)
 W !
"RTN","GMRCSTS",130,0)
 N DIR,DIWF,DIWL,DIWR,I,X,Y
"RTN","GMRCSTS",131,0)
 S DIR(0)="FAO^10:245"
"RTN","GMRCSTS",132,0)
 S DIR("A",1)="A comment will be stored with each record updated"
"RTN","GMRCSTS",133,0)
 S DIR("A")="Enter text of comment: "
"RTN","GMRCSTS",134,0)
 D ^DIR
"RTN","GMRCSTS",135,0)
 I $D(DIRUT) Q
"RTN","GMRCSTS",136,0)
 K ^UTILITY($J,"W")
"RTN","GMRCSTS",137,0)
 S DIWF="|",DIWR=78,DIWL=1,X=Y D ^DIWP
"RTN","GMRCSTS",138,0)
 S I=0 F  S I=$O(^UTILITY($J,"W",1,I)) Q:'I  S COMMENT(I,0)=^(I,0)
"RTN","GMRCSTS",139,0)
 K ^UTILITY($J,"W")
"RTN","GMRCSTS",140,0)
 Q
"RTN","GMRCSTS",141,0)
WHATTODO() ;how to handle the update
"RTN","GMRCSTS",142,0)
 N DIR
"RTN","GMRCSTS",143,0)
 S DIR(0)="SO^1:Print report only;2:Print report & update records;3:Quit"
"RTN","GMRCSTS",144,0)
 S DIR("A")="Choose the method to handle the report"
"RTN","GMRCSTS",145,0)
 D ^DIR I $D(DIRUT)!(Y=3) Q 0
"RTN","GMRCSTS",146,0)
 Q +Y
"RTN","GMRCSTS",147,0)
END K ^TMP("GMRCLS",$J) Q
"RTN","GMRCSTS1")
0^2^B20713150
"RTN","GMRCSTS1",1,0)
GMRCSTS1 ;SLC/JFR - GROUP UPDATE OF CONSULTS cont'd ;4/21/99  12:00
"RTN","GMRCSTS1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8**;DEC 27, 1997
"RTN","GMRCSTS1",3,0)
PROCESS(GMRCCVT,GMRCMT) ;Update consult status by service and date range
"RTN","GMRCSTS1",4,0)
 N GMRCO,GMRCSTS,GMRCTRLC,GMRCORNP,GMRCDEV,GMRCFF,GMRCAD,ORIFN
"RTN","GMRCSTS1",5,0)
 N GMRCOM1,ORIFN
"RTN","GMRCSTS1",6,0)
 Q:'GMRCCVT
"RTN","GMRCSTS1",7,0)
 I '$D(^TMP("GMRCLS",$J)) Q  ;no entries to update
"RTN","GMRCSTS1",8,0)
 S GMRCIEN=0 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCSTS1",9,0)
 . Q:'$L($G(^GMR(123,GMRCIEN,0)))
"RTN","GMRCSTS1",10,0)
 . D AUDIT(GMRCIEN,+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",11,0)
 . D STSUPD(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",12,0)
 . D CPRSUPDT(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",13,0)
 Q
"RTN","GMRCSTS1",14,0)
PRINT(GMRCM,GMRCCVT,GMRCSVC,GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO) ;untasked print of records to update
"RTN","GMRCSTS1",15,0)
PRTTSK ; print the report then start the processing
"RTN","GMRCSTS1",16,0)
 ; GMRCM= status of records to find A:active, P:pending, B:Both
"RTN","GMRCSTS1",17,0)
 ; GMRCCVT= status to update records with  1:dc,  2:complete
"RTN","GMRCSTS1",18,0)
 ; GMRCSVC= IEN from file 123.5
"RTN","GMRCSTS1",19,0)
 ; GMRCMT= array (passed by reference) of comment to stuff in records
"RTN","GMRCSTS1",20,0)
 ; GMRCSTRT= first entry date to find/update
"RTN","GMRCSTS1",21,0)
 ; GMRCSTOP= last entry date to find/update
"RTN","GMRCSTS1",22,0)
 ; GMRCDO= 1:print only, 2:print and update records
"RTN","GMRCSTS1",23,0)
 N GMRCIEN,GMRCDFN,GMRCPG,GMRCEND
"RTN","GMRCSTS1",24,0)
 S GMRCIEN=0
"RTN","GMRCSTS1",25,0)
 U IO
"RTN","GMRCSTS1",26,0)
 D HDR(1) S GMRCPG=2
"RTN","GMRCSTS1",27,0)
 I '$D(^TMP("GMRCLS",$J)) D  D END
"RTN","GMRCSTS1",28,0)
 . W !,"No records found meeting search criteria"
"RTN","GMRCSTS1",29,0)
 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN!($G(GMRCEND))  D
"RTN","GMRCSTS1",30,0)
 . I $Y>(IOSL-5) D HDR(GMRCPG) Q:$G(GMRCEND)  S GMRCPG=GMRCPG+1
"RTN","GMRCSTS1",31,0)
 . Q:'$G(^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",32,0)
 . I $P(^GMR(123,GMRCIEN,0),U,12)=1!($P(^(0),U,12)=2) Q
"RTN","GMRCSTS1",33,0)
 . W !,GMRCIEN,?8,$$FMTE^XLFDT(+^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",34,0)
 . W ?29,$E($$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.01),1,26)
"RTN","GMRCSTS1",35,0)
 . W ?56,$$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.09)
"RTN","GMRCSTS1",36,0)
 . W ?70,$S(+^TMP("GMRCLS",$J,GMRCIEN)=5:"p",1:"a")
"RTN","GMRCSTS1",37,0)
 . W " to ",$S(+GMRCCVT=1:"dc",1:"c")
"RTN","GMRCSTS1",38,0)
 I GMRCDO=2 D PROCESS(+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",39,0)
END D ^%ZISC K ^TMP("GMRCLS",$J)
"RTN","GMRCSTS1",40,0)
 Q
"RTN","GMRCSTS1",41,0)
 ;
"RTN","GMRCSTS1",42,0)
HDR(PAGE) ; print the header for the report
"RTN","GMRCSTS1",43,0)
 I PAGE'=1,$E(IOST,1,2)["C-" N Y D  I '+Y S GMRCEND=1 Q
"RTN","GMRCSTS1",44,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTS1",45,0)
 W @IOF
"RTN","GMRCSTS1",46,0)
 W !,"Group status update of consults in file 123",?70,"Page: ",PAGE W:PAGE'=1 !
"RTN","GMRCSTS1",47,0)
 I PAGE=1 W !,?49,"Printed: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCSTS1",48,0)
 I PAGE=1 D UPDCRIT(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS1",49,0)
 W !,"Consult",?70,"Status"
"RTN","GMRCSTS1",50,0)
 W !,"Number    Requested          Patient                    SSN           Change"
"RTN","GMRCSTS1",51,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMRCSTS1",52,0)
 Q
"RTN","GMRCSTS1",53,0)
GETENTS(SERV,STRDT,STPDT,SRCH)  ;loop "AE" x-ref and dump into ^TMP
"RTN","GMRCSTS1",54,0)
 N IDT,IEN,STOPI,STRTI,STS
"RTN","GMRCSTS1",55,0)
 W !!,"Searching database for entries matching search criteria",!
"RTN","GMRCSTS1",56,0)
 S STOPI=(9999999-STPDT)-1,STRTI=(9999999-STRDT)
"RTN","GMRCSTS1",57,0)
 S STS=$S(SRCH="P":5,SRCH="A":6,1:"5^6") D  S STS=$P(STS,U,2) I STS D
"RTN","GMRCSTS1",58,0)
 . S IDT=STOPI
"RTN","GMRCSTS1",59,0)
 . F  S IDT=$O(^GMR(123,"AE",SERV,+STS,IDT)) Q:'IDT!(IDT>STRTI)  D
"RTN","GMRCSTS1",60,0)
 .. S IEN=0 F  S IEN=$O(^GMR(123,"AE",SERV,+STS,IDT,IEN)) Q:'IEN  D
"RTN","GMRCSTS1",61,0)
 ... S ^TMP("GMRCLS",$J,IEN)=+STS_U_+^GMR(123,IEN,0)
"RTN","GMRCSTS1",62,0)
 ... W "."
"RTN","GMRCSTS1",63,0)
 Q
"RTN","GMRCSTS1",64,0)
AUDIT(GMRCO,UPDSTS,GMRCOM) ;Update the processing activity of the consult
"RTN","GMRCSTS1",65,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",66,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",67,0)
 N DA,DIE,GMRCA,GMRCDT,GMRCSTS
"RTN","GMRCSTS1",68,0)
 S GMRCDT=$$NOW^XLFDT,GMRCA=$S(UPDSTS=1:6,1:10)
"RTN","GMRCSTS1",69,0)
 S GMRCSTS=$P(^GMR(123,GMRCO,0),U,12)
"RTN","GMRCSTS1",70,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCSTS1",71,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCSTS1",72,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCSTS1",73,0)
 S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCDT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCSTS1",74,0)
 D ^DIE
"RTN","GMRCSTS1",75,0)
 S ^GMR(123,+GMRCO,40,DA,1,0)="^^1^1^"_GMRCDT_"^"
"RTN","GMRCSTS1",76,0)
 I $D(GMRCOM) D
"RTN","GMRCSTS1",77,0)
 . M ^GMR(123,+GMRCO,40,DA,1)=GMRCOM
"RTN","GMRCSTS1",78,0)
 I '$D(GMRCOM) D
"RTN","GMRCSTS1",79,0)
 . N COMMENT
"RTN","GMRCSTS1",80,0)
 . S COMMENT="Status updated from "
"RTN","GMRCSTS1",81,0)
 . S COMMENT=COMMENT_$P(^ORD(100.01,+GMRCSTS,0),"^",1)
"RTN","GMRCSTS1",82,0)
 . S COMMENT=COMMENT_" to "_$S(+UPDSTS=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",83,0)
 . S COMMENT=COMMENT_" during group status update process."
"RTN","GMRCSTS1",84,0)
 . S ^GMR(123,+GMRCO,40,DA,1,1,0)=COMMENT
"RTN","GMRCSTS1",85,0)
 K DIE,GMRCA,GMRCDT
"RTN","GMRCSTS1",86,0)
 Q
"RTN","GMRCSTS1",87,0)
STSUPD(GMRCO,UPDSTS) ;change status of consult to COMPLETE or DC
"RTN","GMRCSTS1",88,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",89,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",90,0)
 N DIE,DA,DR,X
"RTN","GMRCSTS1",91,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCSTS1",92,0)
 S DR="8////^S X=+UPDSTS"
"RTN","GMRCSTS1",93,0)
 D ^DIE
"RTN","GMRCSTS1",94,0)
 Q
"RTN","GMRCSTS1",95,0)
CPRSUPDT(GMRCO,UPDSTS) ;Update CPRS order with new status
"RTN","GMRCSTS1",96,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",97,0)
 ;UPDSTS= status to update CPRS with
"RTN","GMRCSTS1",98,0)
 N GMRCDFN,CTRLCODE
"RTN","GMRCSTS1",99,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCSTS1",100,0)
 S CTRLCODE=$S(UPDSTS=1:"OD",1:"RE")
"RTN","GMRCSTS1",101,0)
 ; send HL7 message to CPRS to update order status
"RTN","GMRCSTS1",102,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,"","",CTRLCODE,DUZ,"","",1)
"RTN","GMRCSTS1",103,0)
 Q
"RTN","GMRCSTS1",104,0)
UPDCRIT(UPD,STS,SVC,CMT,START,STOP) ;print update criteria on page 1
"RTN","GMRCSTS1",105,0)
 W !,"Records will be updated for:"
"RTN","GMRCSTS1",106,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCSTS1",107,0)
 W !,"          Service: "_$$GET1^DIQ(123.5,SVC,.01)
"RTN","GMRCSTS1",108,0)
 W !,"        Beginning: "_$$FMTE^XLFDT(START)
"RTN","GMRCSTS1",109,0)
 W !,"           Ending: "_$$FMTE^XLFDT(STOP)
"RTN","GMRCSTS1",110,0)
 W !,"           Update: "_$S(STS="A":"Active",GMRCM="P":"Pending",1:"Pending and Active")_" consults"
"RTN","GMRCSTS1",111,0)
 W !,"               To: "_$S(+UPD=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",112,0)
 I $D(CMT) W !,"   Update Comment:" D
"RTN","GMRCSTS1",113,0)
 . N I S I=0 F  S I=$O(CMT(I)) Q:'I  D
"RTN","GMRCSTS1",114,0)
 .. W !,CMT(I,0)
"RTN","GMRCSTS1",115,0)
 W !,$$REPEAT^XLFSTR("-",78),!
"RTN","GMRCSTS1",116,0)
 Q
"VER")
8.0^21.0
**END**
**END**
