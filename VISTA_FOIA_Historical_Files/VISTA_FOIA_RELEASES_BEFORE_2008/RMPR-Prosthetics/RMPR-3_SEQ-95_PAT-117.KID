Released RMPR*3*117 SEQ #95
Extracted from mail message
**KIDS**:RMPR*3.0*117^

**INSTALL NAME**
RMPR*3.0*117
"BLD",5843,0)
RMPR*3.0*117^PROSTHETICS^0^3060329^y
"BLD",5843,1,0)
^^6^6^3060329^
"BLD",5843,1,1,0)
1.  Delete Field 19 (bogus entry) in File #660 which comflicts with
"BLD",5843,1,2,0)
    field 4.1 of same file, both using node 0, piece 22.
"BLD",5843,1,3,0)
 
"BLD",5843,1,4,0)
2.  Prevent dual entries in File #661.6 and #661.7 from having time 
"BLD",5843,1,5,0)
    stamp one second apart for "return-in" when piece 6 of Suspense
"BLD",5843,1,6,0)
    file #661.63) is null.
"BLD",5843,4,0)
^9.64PA^^
"BLD",5843,6.3)
6
"BLD",5843,"ABPKG")
n
"BLD",5843,"INIT")
RMPR117P
"BLD",5843,"KRN",0)
^9.67PA^8989.52^19
"BLD",5843,"KRN",.4,0)
.4
"BLD",5843,"KRN",.401,0)
.401
"BLD",5843,"KRN",.402,0)
.402
"BLD",5843,"KRN",.403,0)
.403
"BLD",5843,"KRN",.5,0)
.5
"BLD",5843,"KRN",.84,0)
.84
"BLD",5843,"KRN",3.6,0)
3.6
"BLD",5843,"KRN",3.8,0)
3.8
"BLD",5843,"KRN",9.2,0)
9.2
"BLD",5843,"KRN",9.8,0)
9.8
"BLD",5843,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",5843,"KRN",9.8,"NM",2,0)
RMPRPIYF^^0^76688255
"BLD",5843,"KRN",9.8,"NM",3,0)
RMPRPIU3^^0^23263589
"BLD",5843,"KRN",9.8,"NM",4,0)
RMPR117P^^0^85850
"BLD",5843,"KRN",9.8,"NM","B","RMPR117P",4)

"BLD",5843,"KRN",9.8,"NM","B","RMPRPIU3",3)

"BLD",5843,"KRN",9.8,"NM","B","RMPRPIYF",2)

"BLD",5843,"KRN",19,0)
19
"BLD",5843,"KRN",19.1,0)
19.1
"BLD",5843,"KRN",101,0)
101
"BLD",5843,"KRN",409.61,0)
409.61
"BLD",5843,"KRN",771,0)
771
"BLD",5843,"KRN",870,0)
870
"BLD",5843,"KRN",8989.51,0)
8989.51
"BLD",5843,"KRN",8989.52,0)
8989.52
"BLD",5843,"KRN",8994,0)
8994
"BLD",5843,"KRN","B",.4,.4)

"BLD",5843,"KRN","B",.401,.401)

"BLD",5843,"KRN","B",.402,.402)

"BLD",5843,"KRN","B",.403,.403)

"BLD",5843,"KRN","B",.5,.5)

"BLD",5843,"KRN","B",.84,.84)

"BLD",5843,"KRN","B",3.6,3.6)

"BLD",5843,"KRN","B",3.8,3.8)

"BLD",5843,"KRN","B",9.2,9.2)

"BLD",5843,"KRN","B",9.8,9.8)

"BLD",5843,"KRN","B",19,19)

"BLD",5843,"KRN","B",19.1,19.1)

"BLD",5843,"KRN","B",101,101)

"BLD",5843,"KRN","B",409.61,409.61)

"BLD",5843,"KRN","B",771,771)

"BLD",5843,"KRN","B",870,870)

"BLD",5843,"KRN","B",8989.51,8989.51)

"BLD",5843,"KRN","B",8989.52,8989.52)

"BLD",5843,"KRN","B",8994,8994)

"BLD",5843,"QUES",0)
^9.62^^
"BLD",5843,"REQB",0)
^9.611^1^1
"BLD",5843,"REQB",1,0)
RMPR*3.0*61^2
"BLD",5843,"REQB","B","RMPR*3.0*61",1)

"INIT")
RMPR117P
"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
117^3060329
"PKG",101,22,1,"PAH",1,1,0)
^^6^6^3060329
"PKG",101,22,1,"PAH",1,1,1,0)
1.  Delete Field 19 (bogus entry) in File #660 which comflicts with
"PKG",101,22,1,"PAH",1,1,2,0)
    field 4.1 of same file, both using node 0, piece 22.
"PKG",101,22,1,"PAH",1,1,3,0)
 
"PKG",101,22,1,"PAH",1,1,4,0)
2.  Prevent dual entries in File #661.6 and #661.7 from having time 
"PKG",101,22,1,"PAH",1,1,5,0)
    stamp one second apart for "return-in" when piece 6 of Suspense
"PKG",101,22,1,"PAH",1,1,6,0)
    file #661.63) is null.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RMPR117P")
0^4^B85850
"RTN","RMPR117P",1,0)
RMPR117P ;VMP/RB - DELETE FIELD# 19 FOR FILE #660 ;11/7/05
"RTN","RMPR117P",2,0)
 ;;3.0;Prosthetics;**117**;06/20/05
"RTN","RMPR117P",3,0)
 ;;
"RTN","RMPR117P",4,0)
 ;1. Post install to delete in ^DD for file #660, field 19 (if exists) 
"RTN","RMPR117P",5,0)
 ;
"RTN","RMPR117P",6,0)
FIX1 ;DELETE FIELD 19 FROM FILE #660 IF EXISTS
"RTN","RMPR117P",7,0)
 Q:'$D(^DD(660,19,0))
"RTN","RMPR117P",8,0)
 S DIK="^DD(660,",DA=19,DA(1)=660
"RTN","RMPR117P",9,0)
 D ^DIK
"RTN","RMPR117P",10,0)
 K DIK,DA
"RTN","RMPR117P",11,0)
 Q
"RTN","RMPRPIU3")
0^3^B23263589^B22550640
"RTN","RMPRPIU3",1,0)
RMPRPIU3 ;HINCIO/ODJ - PIP STOCK ISSUE TO PATIENT DELETE UILITY ;3/8/01
"RTN","RMPRPIU3",2,0)
 ;;3.0;PROSTHETICS;**61,117**;Feb 09, 1996
"RTN","RMPRPIU3",3,0)
 Q
"RTN","RMPRPIU3",4,0)
 ;
"RTN","RMPRPIU3",5,0)
 ; DEL - Delete a Stock 'Issue to Patient' Transaction
"RTN","RMPRPIU3",6,0)
 ;       Deletes the 2319 record in file 660
"RTN","RMPRPIU3",7,0)
 ;               the patient issue record in 661.63
"RTN","RMPRPIU3",8,0)
 ;       Creates a type 8 'Return In' transaction
"RTN","RMPRPIU3",9,0)
 ;       Brings back issue quantity into stock
"RTN","RMPRPIU3",10,0)
 ;       Updates running balance
"RTN","RMPRPIU3",11,0)
 ;
"RTN","RMPRPIU3",12,0)
 ; Inputs:
"RTN","RMPRPIU3",13,0)
 ;    RMPR60 - array of data fields for 660 file record...
"RTN","RMPRPIU3",14,0)
 ;             RMPR60("IEN") must be set to the ien of 660 rec.
"RTN","RMPRPIU3",15,0)
 ;                           being deleted.
"RTN","RMPRPIU3",16,0)
 ;    RMPR60("IEN") - IEN of 660 record being deleted
"RTN","RMPRPIU3",17,0)
 ;
"RTN","RMPRPIU3",18,0)
 ; Outputs:
"RTN","RMPRPIU3",19,0)
 ;    RMPRERR -  0 - no problems
"RTN","RMPRPIU3",20,0)
 ;              11 - problem reading 660 rec. to delete
"RTN","RMPRPIU3",21,0)
 ;              12 - problem reading 661.6 rec. to delete
"RTN","RMPRPIU3",22,0)
 ;              29 - problem with 660 rec. delete
"RTN","RMPRPIU3",23,0)
 ;              39 - problem with 661.6,661.63 rec. delete
"RTN","RMPRPIU3",24,0)
 ;              49 - problem with 661.6 return rec. creation
"RTN","RMPRPIU3",25,0)
 ;              59 - problem with bringing back into stock
"RTN","RMPRPIU3",26,0)
 ;
"RTN","RMPRPIU3",27,0)
DEL(RMPR60) ;
"RTN","RMPRPIU3",28,0)
 N RMPRERR,RMPRC60,RMPRC60I,RMPRC1,RMPRC1I,RMPRC6,RMPRC6I
"RTN","RMPRPIU3",29,0)
 N RMPRC5,RMPRC11,RMPRRET,RMPR7R
"RTN","RMPRPIU3",30,0)
 S RMPRERR=0
"RTN","RMPRPIU3",31,0)
 ;
"RTN","RMPRPIU3",32,0)
 ; STEP 1
"RTN","RMPRPIU3",33,0)
 ; read in existing 660 and 661.6 recs.
"RTN","RMPRPIU3",34,0)
 S RMPRC60("IEN")=RMPR60("IEN")
"RTN","RMPRPIU3",35,0)
 S RMPRERR=$$GET^RMPRPIX2(.RMPRC60,.RMPRC1) ;read in current 660 rec
"RTN","RMPRPIU3",36,0)
 I RMPRERR S RMPRERR=11 G DELX
"RTN","RMPRPIU3",37,0)
 S RMPRERR=$$ETOI^RMPRPIX2(.RMPRC60,.RMPRC1,.RMPRC60I,.RMPRC1I)
"RTN","RMPRPIU3",38,0)
 I RMPRERR S RMPRERR=11 G DELX
"RTN","RMPRPIU3",39,0)
 S RMPRC6("IEN")=RMPRC60("TRANS IEN")
"RTN","RMPRPIU3",40,0)
 S RMPRERR=$$GET^RMPRPIX6(.RMPRC6) ;read in current 661.6 rec
"RTN","RMPRPIU3",41,0)
 I RMPRERR S RMPRERR=12 G DELX
"RTN","RMPRPIU3",42,0)
 S RMPRERR=$$ETOI^RMPRPIX6(.RMPRC6,.RMPRC6I)
"RTN","RMPRPIU3",43,0)
 I RMPRERR S RMPRERR=12 G DELX
"RTN","RMPRPIU3",44,0)
 S RMPRC5("IEN")=RMPRC6I("LOCATION")
"RTN","RMPRPIU3",45,0)
 S RMPRC11("STATION")=RMPRC6I("STATION")
"RTN","RMPRPIU3",46,0)
 S RMPRC11("STATION IEN")=RMPRC6I("STATION")
"RTN","RMPRPIU3",47,0)
 S RMPRC11("HCPCS")=RMPRC6I("HCPCS")
"RTN","RMPRPIU3",48,0)
 S RMPRC11("ITEM")=RMPRC6I("ITEM")
"RTN","RMPRPIU3",49,0)
 S RMST1=RMPRC6I("STATION"),RMHC1=RMPRC6I("HCPCS")
"RTN","RMPRPIU3",50,0)
 S RMLO1=RMPRC6I("LOCATION"),RMIT1=RMPRC6I("ITEM")
"RTN","RMPRPIU3",51,0)
 ;
"RTN","RMPRPIU3",52,0)
 ; STEP 2
"RTN","RMPRPIU3",53,0)
 ; Delete the 660 record
"RTN","RMPRPIU3",54,0)
 S RMPRERR=$$DEL^RMPRPIX2(.RMPR60)
"RTN","RMPRPIU3",55,0)
 I RMPRERR S RMPRERR=29 G DELX ;err 29 if 660 delete problem
"RTN","RMPRPIU3",56,0)
 ;
"RTN","RMPRPIU3",57,0)
 ; STEP 3
"RTN","RMPRPIU3",58,0)
 ; get 661.63 information
"RTN","RMPRPIU3",59,0)
 K RMDTTIM
"RTN","RMPRPIU3",60,0)
 S RM6613I=$O(^RMPR(661.63,"B",RMPRC6("IEN"),0))
"RTN","RMPRPIU3",61,0)
 I $G(RM6613I),$D(^RMPR(661.63,RM6613I,0)) D
"RTN","RMPRPIU3",62,0)
 .S RM63DAT=$G(^RMPR(661.63,RM6613I,0))
"RTN","RMPRPIU3",63,0)
 .S RMDTTIM=$P(RM63DAT,U,6)
"RTN","RMPRPIU3",64,0)
 .Q:'$G(RMDTTIM)
"RTN","RMPRPIU3",65,0)
 .S RMPRRET("DATE&TIME")=RMDTTIM
"RTN","RMPRPIU3",66,0)
 .S RMPRRET("QUANTITY")=$P(RM63DAT,U,12)
"RTN","RMPRPIU3",67,0)
 .S RMPRRET("VALUE")=$P(RM63DAT,U,10)
"RTN","RMPRPIU3",68,0)
 .S RMPRRET("UNIT")=$P(RM63DAT,U,11)
"RTN","RMPRPIU3",69,0)
 .S RMPRRET("VENDOR")=$P(RM63DAT,U,9)
"RTN","RMPRPIU3",70,0)
 .S RMPRRET("LOCATION")=$P(RM63DAT,U,8)
"RTN","RMPRPIU3",71,0)
 ; Delete 661.63 Patient Issue record
"RTN","RMPRPIU3",72,0)
 S RMPRERR=$$DEL^RMPRPIX3(.RMPRC6)
"RTN","RMPRPIU3",73,0)
 I RMPRERR S RMPRERR=39
"RTN","RMPRPIU3",74,0)
 ;
"RTN","RMPRPIU3",75,0)
 ; STEP 4
"RTN","RMPRPIU3",76,0)
 ; Create a Return to Stock Record
"RTN","RMPRPIU3",77,0)
 S RMPRRET("SEQUENCE")=1
"RTN","RMPRPIU3",78,0)
 S RMPRRET("TRAN TYPE")=8
"RTN","RMPRPIU3",79,0)
 S RMPRRET("COMMENT")=""
"RTN","RMPRPIU3",80,0)
 S RMPRRET("USER")=$G(DUZ)
"RTN","RMPRPIU3",81,0)
 I '$D(RMPRRET("QUANTITY")) S RMPRRET("QUANTITY")=RMPRC60I("QUANTITY")
"RTN","RMPRPIU3",82,0)
 I '$D(RMPRRET("VALUE")) S RMPRRET("VALUE")=$G(RMPRC60I("COST"))
"RTN","RMPRPIU3",83,0)
 I '$D(RMPRRET("UNIT")) S RMPRRET("UNIT")=$G(RMPRC60I("UNIT"))
"RTN","RMPRPIU3",84,0)
 I '$D(RMPRRET("VENDOR")) S RMPRRET("VENDOR")=$G(RMPRC60I("VENDOR"))
"RTN","RMPRPIU3",85,0)
 I '$D(RMPRRET("LOCATION")) S RMPRRET("LOCATION")=$G(RMPRC5("IEN"))
"RTN","RMPRPIU3",86,0)
 S RMPRERR=$$CRE^RMPRPIX6(.RMPRRET,.RMPRC11)
"RTN","RMPRPIU3",87,0)
 I RMPRERR S RMPRERR=49
"RTN","RMPRPIU3",88,0)
 ;
"RTN","RMPRPIU3",89,0)
 ; STEP 5
"RTN","RMPRPIU3",90,0)
 ; Bring back into current stock
"RTN","RMPRPIU3",91,0)
 D NOW^%DTC
"RTN","RMPRPIU3",92,0)
 S RMPR7R("STATION")=RMPRC11("STATION")
"RTN","RMPRPIU3",93,0)
 S RMPR7R("HCPCS")=RMPRC11("HCPCS")
"RTN","RMPRPIU3",94,0)
 S RMPR7R("ITEM")=RMPRC11("ITEM")
"RTN","RMPRPIU3",95,0)
 S RMPR7R("LOCATION")=RMPRC5("IEN")
"RTN","RMPRPIU3",96,0)
 S RMPR7R("VENDOR")=RMPRRET("VENDOR")
"RTN","RMPRPIU3",97,0)
 S RMPR7R("DATE&TIME")=% S:$G(RMPRRET("DATE&TIME"))'="" RMPR7R("DATE&TIME")=RMPRRET("DATE&TIME")
"RTN","RMPRPIU3",98,0)
 S RMPR7R("SEQUENCE")=RMPRRET("SEQUENCE")
"RTN","RMPRPIU3",99,0)
 S RMPR7R("QUANTITY")=RMPRRET("QUANTITY")
"RTN","RMPRPIU3",100,0)
 S RMPR7R("VALUE")=RMPRRET("VALUE")
"RTN","RMPRPIU3",101,0)
 S RMPR7R("UNIT")=$G(RMPRRET("UNIT"))
"RTN","RMPRPIU3",102,0)
 I $G(RMDTTIM),$D(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM)) D  I RMPRERR S RMPRERR=71
"RTN","RMPRPIU3",103,0)
 .S RMPR7R("IEN")=$O(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM,1,0))
"RTN","RMPRPIU3",104,0)
 .I '$G(RMPR7R("IEN")) S RMPRERR=1 Q
"RTN","RMPRPIU3",105,0)
 .S RMDA7=$G(^RMPR(661.7,RMPR7R("IEN"),0))
"RTN","RMPRPIU3",106,0)
 .S RMDAVAL=$P(RMDA7,U,8),RMDAQUA=$P(RMDA7,U,7)
"RTN","RMPRPIU3",107,0)
 .S RMPR7R("QUANTITY")=RMPR7R("QUANTITY")+RMDAQUA
"RTN","RMPRPIU3",108,0)
 .S RMPR7R("VALUE")=RMPR7R("VALUE")+RMDAVAL
"RTN","RMPRPIU3",109,0)
 .S RMPRERR=0
"RTN","RMPRPIU3",110,0)
 .S RMPR7R("DATE&TIME")=RMDTTIM
"RTN","RMPRPIU3",111,0)
 .S RMPRERR=$$UPD^RMPRPIX7(.RMPR7R,.RMPRC11)
"RTN","RMPRPIU3",112,0)
 I $G(RMDTTIM),'$D(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM)) D  I RMPRERR S RMPRERR=72
"RTN","RMPRPIU3",113,0)
 .S RMPRERR=0
"RTN","RMPRPIU3",114,0)
 .S RMPR7R("DATE&TIME")=RMDTTIM
"RTN","RMPRPIU3",115,0)
 .S RMPRERR=$$CRE^RMPRPIX7(.RMPR7R,.RMPRC11)
"RTN","RMPRPIU3",116,0)
 I '$G(RMDTTIM) D  I RMPRERR S RMPRERR=73
"RTN","RMPRPIU3",117,0)
 .;create an entry
"RTN","RMPRPIU3",118,0)
 .S RMPRERR=0
"RTN","RMPRPIU3",119,0)
 .S RMPRERR=$$CRE^RMPRPIX7(.RMPR7R,.RMPRC11)
"RTN","RMPRPIU3",120,0)
 ;update 661.9
"RTN","RMPRPIU3",121,0)
 S RMPR9("STA")=RMPRC6I("STATION")
"RTN","RMPRPIU3",122,0)
 S RMPR9("HCP")=RMPRC6I("HCPCS")
"RTN","RMPRPIU3",123,0)
 S RMPR9("ITE")=RMPRC6I("ITEM")
"RTN","RMPRPIU3",124,0)
 S RMPR9("RDT")=$P(RMPRC6I("DATE&TIME"),".",1)
"RTN","RMPRPIU3",125,0)
 S RMPR9("TQTY")=RMPRC6I("QUANTITY")
"RTN","RMPRPIU3",126,0)
 S RMPR9("TCST")=RMPRC6I("VALUE")
"RTN","RMPRPIU3",127,0)
 S RMPRERR=0
"RTN","RMPRPIU3",128,0)
 S RMPRERR=$$UPCR^RMPRPIXJ(.RMPR9)
"RTN","RMPRPIU3",129,0)
 I RMPRERR S RMPRERR=59
"RTN","RMPRPIU3",130,0)
 ;
"RTN","RMPRPIU3",131,0)
 ;exit
"RTN","RMPRPIU3",132,0)
DELX Q RMPRERR
"RTN","RMPRPIYF")
0^2^B76688255^B75690546
"RTN","RMPRPIYF",1,0)
RMPRPIYF ;PHX/RFM,RVD-EDIT ISSUE FROM STOCK ;8/2/02  07:27
"RTN","RMPRPIYF",2,0)
 ;;3.0;PROSTHETICS;**61,117**;Feb 09, 1996
"RTN","RMPRPIYF",3,0)
 ; RVD #61 - phase III of PIP enhancement.
"RTN","RMPRPIYF",4,0)
 ;
"RTN","RMPRPIYF",5,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RMPRPIYF",6,0)
COST ;
"RTN","RMPRPIYF",7,0)
 S RMACNT=RMPRCOST*$P(R1(0),U,7),$P(R3("D"),U,16)=RMACNT,$P(R1(0),U,16)=RMACNT
"RTN","RMPRPIYF",8,0)
 ;
"RTN","RMPRPIYF",9,0)
DATE S:$P(R1(1),U,8) DIR("B")=$P(R1("D"),U,8) S DIR("A")="DATE OF SERVICE",DIR(0)="660,39" D ^DIR K DIR
"RTN","RMPRPIYF",10,0)
 G:X["^" CO^RMPRPIYE G:$D(DTOUT) EXIT I $P(R1(1),U,8)&(X="@") W !,"This field is mandatory!!!",! G DATE
"RTN","RMPRPIYF",11,0)
 I X="" W !,"This field is mandatory!!!",! G DATE
"RTN","RMPRPIYF",12,0)
 S $P(R1(1),U,8)=Y,Y=$P(R1(1),U,8) D DD^%DT S $P(R1("D"),U,8)=Y
"RTN","RMPRPIYF",13,0)
 ;
"RTN","RMPRPIYF",14,0)
REQ S DIR(0)="660,9" S:$P(R1(0),U,11)'="" DIR("B")=$P(R1(0),U,11) D ^DIR G:$D(DUOUT) CO^RMPRPIYE G:$D(DTOUT) EXIT
"RTN","RMPRPIYF",15,0)
 I X["^" W !,"Jumping not allowed!" G REQ
"RTN","RMPRPIYF",16,0)
 I $P(R1(0),U,11)'=""&(X="@") W !?5,"Deleted..." H 1 S $P(R1(0),U,11)="" G LOT
"RTN","RMPRPIYF",17,0)
 S $P(R1(0),U,11)=X
"RTN","RMPRPIYF",18,0)
 ;
"RTN","RMPRPIYF",19,0)
LOT K DIR S DIR(0)="660,21" S:$P(R1(0),U,24)'="" DIR("B")=$P(R1(0),U,24) D ^DIR G:$D(DUOUT) CO^RMPRPIYE
"RTN","RMPRPIYF",20,0)
 I X["^" W !,"Jumping not allowed!" G LOT
"RTN","RMPRPIYF",21,0)
 I $P(R1(0),U,24)'=""&(X="@") W !?5,"Deleted..." H 1 S $P(R1(0),U,24)="" G REMA
"RTN","RMPRPIYF",22,0)
 S $P(R1(0),U,24)=X
"RTN","RMPRPIYF",23,0)
 ;
"RTN","RMPRPIYF",24,0)
REMA K DIR S DIR(0)="660,16" S:$P(R1(0),U,18)'="" DIR("B")=$P(R1(0),U,18) D ^DIR G:$D(DUOUT) CO^RMPRPIYE G:$D(DTOUT) EXIT
"RTN","RMPRPIYF",25,0)
 I X["^" W !,"Jumping not allowed!" G REMA
"RTN","RMPRPIYF",26,0)
 I $P(R1(0),U,18)'=""&(X="@") W !?5,"Deleted..." H 1 S $P(R1(0),U,18)="" G CC
"RTN","RMPRPIYF",27,0)
 S $P(R1(0),U,18)=X
"RTN","RMPRPIYF",28,0)
CC G CO^RMPRPIYE
"RTN","RMPRPIYF",29,0)
 ;
"RTN","RMPRPIYF",30,0)
POST ;POSTS EDITED TRANSACTION TO 660
"RTN","RMPRPIYF",31,0)
 W !,"Posting...."
"RTN","RMPRPIYF",32,0)
 K RMPR60,RMDTTIM,RMPR63
"RTN","RMPRPIYF",33,0)
 S RMPR60("IEN")=RMPRIEN,RMFLG=0
"RTN","RMPRPIYF",34,0)
 ;RMPR60 -array of data fields for 660 file record.
"RTN","RMPRPIYF",35,0)
 D SET60^RMPRPIYE
"RTN","RMPRPIYF",36,0)
 ;get 661.6 & 661.63 patient issue
"RTN","RMPRPIYF",37,0)
 S (RMPR6("IEN"),RMIEN6)=$P(R1(1),U,5)
"RTN","RMPRPIYF",38,0)
 I $G(RMIEN6),$D(^RMPR(661.6,RMIEN6,0)) D
"RTN","RMPRPIYF",39,0)
 .S RMDAT6=$G(^RMPR(661.6,RMIEN6,0))
"RTN","RMPRPIYF",40,0)
 .S RMIEN63=$O(^RMPR(661.63,"B",RMIEN6,0))
"RTN","RMPRPIYF",41,0)
 .I $G(RMIEN63),$D(^RMPR(661.63,RMIEN63,0)) D
"RTN","RMPRPIYF",42,0)
 ..S RMDAT63=$G(^RMPR(661.63,RMIEN63,0)),RMPR63("IEN")=RMIEN63
"RTN","RMPRPIYF",43,0)
 ..S (RMPRRET("DATE&TIME"),RMDTTIM)=$P(RMDAT63,U,6)
"RTN","RMPRPIYF",44,0)
 ..S RMPRRET("QUANTITY")=$P(RMDAT63,U,12)
"RTN","RMPRPIYF",45,0)
 ..S RMPRRET("HCPCS")=$P(RMDAT63,U,4)
"RTN","RMPRPIYF",46,0)
 ..S RMPRRET("STATION")=$P(RMDAT63,U,7)
"RTN","RMPRPIYF",47,0)
 ..S RMPRRET("ITEM")=$P(RMDAT63,U,5)
"RTN","RMPRPIYF",48,0)
 ..S RMPRRET("VALUE")=$P(RMDAT63,U,10)
"RTN","RMPRPIYF",49,0)
 ..S RMPRRET("UNIT")=$P(RMDAT63,U,11)
"RTN","RMPRPIYF",50,0)
 ..S RMPRRET("VENDOR")=$P(RMDAT63,U,9)
"RTN","RMPRPIYF",51,0)
 ..S RMPRRET("LOCATION")=$P(RMDAT63,U,8)
"RTN","RMPRPIYF",52,0)
 ;only update 660 if no label scan and quantity the same.
"RTN","RMPRPIYF",53,0)
 I '$D(RMPR7I),($P(R1BCK(0),U,7)=RMPR60("QUANTITY")) D UP660 G PCE
"RTN","RMPRPIYF",54,0)
 ;set update flags: 1=new item/diff barcode 2=only quantity changed.
"RTN","RMPRPIYF",55,0)
 I $G(RMDTTIM),$D(RMPR7I("DATE&TIME")),RMDTTIM'=RMPR7I("DATE&TIME") S RMFLG=1
"RTN","RMPRPIYF",56,0)
 I '$G(RMDTTIM),$D(RMPR7I("DATE&TIME")) S RMFLG=1
"RTN","RMPRPIYF",57,0)
 I $P(R1BCK(0),U,7)'=RMPR60("QUANTITY"),'$G(RMFLG) S RMFLG=2
"RTN","RMPRPIYF",58,0)
 ;
"RTN","RMPRPIYF",59,0)
API ;call API for 660, 661.7, 661.6, 661.63, 661.9
"RTN","RMPRPIYF",60,0)
 ;
"RTN","RMPRPIYF",61,0)
 ;file #660, 661.6, 661.7, 661.63, 661.9
"RTN","RMPRPIYF",62,0)
 I RMFLG=1 D UPDATE
"RTN","RMPRPIYF",63,0)
 I RMFLG=2 D QUAN
"RTN","RMPRPIYF",64,0)
 D UP660
"RTN","RMPRPIYF",65,0)
 I $G(RMPRERR) W !!,"*** ERROR in 2319 UPDATE, Please notify your IRM..IEN = ",$G(RMPR60("IEN")),!! H 3
"RTN","RMPRPIYF",66,0)
 ;
"RTN","RMPRPIYF",67,0)
PCE ;update PCE data
"RTN","RMPRPIYF",68,0)
 I $D(^RMPR(660,RMPR60("IEN"),10)),$P(^RMPR(660,RMPR60("IEN"),10),U,12) D
"RTN","RMPRPIYF",69,0)
 .S RMCHK=0
"RTN","RMPRPIYF",70,0)
 .S RMCHK=$$SENDPCE^RMPRPCEA(RMPR60("IEN"))
"RTN","RMPRPIYF",71,0)
 .I RMCHK'=1 W !!,"*** ERROR in PCE UPDATE, Please notify your IRM..IEN = ",RMPR60("IEN"),!! H 3
"RTN","RMPRPIYF",72,0)
 ;
"RTN","RMPRPIYF",73,0)
 ;end posting (edit 2319)
"RTN","RMPRPIYF",74,0)
 G EXIT
"RTN","RMPRPIYF",75,0)
 ;
"RTN","RMPRPIYF",76,0)
DEL1 ;ENTRY POINT TO DELETE AN ISSUE FROM STOCK
"RTN","RMPRPIYF",77,0)
 K DIR
"RTN","RMPRPIYF",78,0)
 S DIR("A")="Are you sure you want to DELETE this entry",DIR("B")="N",DIR(0)="Y"
"RTN","RMPRPIYF",79,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) G EXIT
"RTN","RMPRPIYF",80,0)
 I Y'=1 G CO^RMPRPIYE
"RTN","RMPRPIYF",81,0)
 ;
"RTN","RMPRPIYF",82,0)
DEL2 ;call API for returning item to PIP
"RTN","RMPRPIYF",83,0)
 S (RMCHK,RMERPCE)=0
"RTN","RMPRPIYF",84,0)
 S RMI68=$P($G(^RMPR(660,RMPRIEN,10)),U,1) I RMI68>0 D  I RMERPCE W !!,"** STOCK ISSUE DELETE ABORTED",!! G EXIT
"RTN","RMPRPIYF",85,0)
 .S RMCHK=$$DEL^RMPRPCED(RMPRIEN)
"RTN","RMPRPIYF",86,0)
 .I RMCHK'=0 W !!,"*** ERROR in PCE DELETE, Please notify your IRM..660 IEN = ",RMPRIEN,!! S RMERPCE=1 H 3
"RTN","RMPRPIYF",87,0)
 S RMPR60("IEN")=RMPRIEN
"RTN","RMPRPIYF",88,0)
 S RMCHK=$$DEL^RMPRPIU3(.RMPR60)
"RTN","RMPRPIYF",89,0)
 I $G(RMCHK) W !,"*** Error in API RMPRPIU3, ERROR = ",RMCHK,!,"*** Please inform your IRM !!",! G EXIT
"RTN","RMPRPIYF",90,0)
 ;
"RTN","RMPRPIYF",91,0)
 W $C(7),!?10,"Deleted..." H 1
"RTN","RMPRPIYF",92,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPRPIYF",93,0)
 I $G(RMPRIEN),$D(^RMPR(660,RMPRIEN)) L -^RMPR(660,RMPRIEN)
"RTN","RMPRPIYF",94,0)
 K ^TMP($J) N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPIYF",95,0)
 Q
"RTN","RMPRPIYF",96,0)
 ;
"RTN","RMPRPIYF",97,0)
UP660 ;update 660
"RTN","RMPRPIYF",98,0)
 S RMPR60("IEN")=RMPRIEN
"RTN","RMPRPIYF",99,0)
 S RMPRERR=0
"RTN","RMPRPIYF",100,0)
 S RMPRERR=$$UPD^RMPRPIX2(.RMPR60,.RMPR11I)
"RTN","RMPRPIYF",101,0)
 I $G(RMPRERR) W !,"*** Error in API RMPRPIX2, ERROR = ",RMPRERR,!,"*** Please inform your IRM !!",!
"RTN","RMPRPIYF",102,0)
 Q
"RTN","RMPRPIYF",103,0)
 ;
"RTN","RMPRPIYF",104,0)
UPDATE ;update the new entries AND delete old data
"RTN","RMPRPIYF",105,0)
 S RMNEWHC=RMPR11I("HCPCS")
"RTN","RMPRPIYF",106,0)
 S RMNEWIT=RMPR11I("ITEM")
"RTN","RMPRPIYF",107,0)
 I $G(RMPR6("IEN")) S RMPR60("IEN")=RMPR6("IEN") D
"RTN","RMPRPIYF",108,0)
 .S RMPRERR=$$UPD^RMPRPIX6(.RMPR60,.RMPR11I)
"RTN","RMPRPIYF",109,0)
 .I $G(RMPR63("IEN")) S RMPRERR=$$UPALL^RMPRPIX3(.RMPR60,.RMPR63,.RMPR11I)
"RTN","RMPRPIYF",110,0)
 .I '$G(RMPR63("IEN")) S RMPRERR=$$CRE^RMPRPIX3(.RMPR60,.RMPR6,.RMPR11I)
"RTN","RMPRPIYF",111,0)
 I '$G(RMPR6("IEN")) D
"RTN","RMPRPIYF",112,0)
 .S RMPRERR=$$CRE^RMPRPIX6(.RMPR60,.RMPR11I)
"RTN","RMPRPIYF",113,0)
 .S (RMPR60("IEN6"),RMPR6("IEN"))=$G(RMPR60("IEN"))
"RTN","RMPRPIYF",114,0)
 .S RMPRERR=$$CRE^RMPRPIX3(.RMPR60,.RMPR6,.RMPR11I)
"RTN","RMPRPIYF",115,0)
 ;create a return stock record
"RTN","RMPRPIYF",116,0)
 S RMPR11I("HCPCS")=$G(RMPRRET("HCPCS"))
"RTN","RMPRPIYF",117,0)
 S RMPR11I("ITEM")=$G(RMPRRET("ITEM"))
"RTN","RMPRPIYF",118,0)
 S RMPRRET("SEQUENCE")=1
"RTN","RMPRPIYF",119,0)
 S RMPRRET("TRAN TYPE")=8
"RTN","RMPRPIYF",120,0)
 S RMPRRET("COMMENT")="STOCK ISSUE EDIT"
"RTN","RMPRPIYF",121,0)
 S RMPRRET("USER")=$G(DUZ)
"RTN","RMPRPIYF",122,0)
 I '$D(RMPRRET("QUANTITY")) S RMPRRET("QUANTITY")=RMPR60("QUANTITY")
"RTN","RMPRPIYF",123,0)
 I '$D(RMPRRET("VALUE")) S RMPRRET("VALUE")=RMPR60("COST")
"RTN","RMPRPIYF",124,0)
 I '$D(RMPRRET("UNIT")) S RMPRRET("UNIT")=RMPR60("UNIT")
"RTN","RMPRPIYF",125,0)
 I '$D(RMPRRET("VENDOR")) S RMPRRET("VENDOR")=RMPR60("VENDOR IEN")
"RTN","RMPRPIYF",126,0)
 I '$D(RMPRRET("LOCATION")) S RMPRRET("LOCATION")=$G(RMLO1)
"RTN","RMPRPIYF",127,0)
 I $D(RMPR11I) D  I $G(RMPRERR) Q
"RTN","RMPRPIYF",128,0)
 .S RMPRERR=$$CRE^RMPRPIX6(.RMPRRET,.RMPR11I)
"RTN","RMPRPIYF",129,0)
 ;return/update 661.7
"RTN","RMPRPIYF",130,0)
 D BACK Q:$G(RMPRERR)
"RTN","RMPRPIYF",131,0)
 S RMPR11I("HCPCS")=$G(RMNEWHC)
"RTN","RMPRPIYF",132,0)
 S RMPR11I("ITEM")=$G(RMNEWIT)
"RTN","RMPRPIYF",133,0)
 S RMPR7I("QUANTITY")=RMPR60("QUANTITY")
"RTN","RMPRPIYF",134,0)
 S RMPR7I("VALUE")=RMPR60("COST")
"RTN","RMPRPIYF",135,0)
 ;update or create 661.7 entry
"RTN","RMPRPIYF",136,0)
 D UP7
"RTN","RMPRPIYF",137,0)
 S RMPR9("QUANTITY")=RMPR60("QUANTITY")
"RTN","RMPRPIYF",138,0)
 S RMPR9("VALUE")=RMPR60("COST")
"RTN","RMPRPIYF",139,0)
 ;return 661.9 entry
"RTN","RMPRPIYF",140,0)
 I $D(RMDTTIM) D  D UP9
"RTN","RMPRPIYF",141,0)
 .S RMPR11I("HCPCS")=RMPRRET("HCPCS")
"RTN","RMPRPIYF",142,0)
 .S RMPR11I("ITEM")=RMPRRET("ITEM")
"RTN","RMPRPIYF",143,0)
 .S RMPR9("QUANTITY")=$P(R1BCK(0),U,7)
"RTN","RMPRPIYF",144,0)
 .S RMPR9("VALUE")=$P(R1BCK(0),U,16)
"RTN","RMPRPIYF",145,0)
 ;deduct the new HCPCS in 661.9
"RTN","RMPRPIYF",146,0)
 S RMPR11I("HCPCS")=RMNEWHC
"RTN","RMPRPIYF",147,0)
 S RMPR11I("ITEM")=RMPR60("ITEM")
"RTN","RMPRPIYF",148,0)
 S RMPR9("QUANTITY")=0-RMPR60("QUANTITY")
"RTN","RMPRPIYF",149,0)
 S RMPR9("VALUE")=0-RMPR60("COST")
"RTN","RMPRPIYF",150,0)
 D UP9
"RTN","RMPRPIYF",151,0)
 Q
"RTN","RMPRPIYF",152,0)
 ;
"RTN","RMPRPIYF",153,0)
BACK ; Bring back ITEM into current stock.
"RTN","RMPRPIYF",154,0)
 D NOW^%DTC
"RTN","RMPRPIYF",155,0)
 S (RMPR7R("STATION"),RMST1)=RMPR11I("STATION")
"RTN","RMPRPIYF",156,0)
 S (RMPR7R("HCPCS"),RMHC1)=RMPR11I("HCPCS")
"RTN","RMPRPIYF",157,0)
 S (RMPR7R("ITEM"),RMIT1)=RMPR11I("ITEM")
"RTN","RMPRPIYF",158,0)
 S (RMPR7R("LOCATION"),RMLO1)=RMPRRET("LOCATION")
"RTN","RMPRPIYF",159,0)
 S RMPR7R("VENDOR")=RMPRRET("VENDOR")
"RTN","RMPRPIYF",160,0)
 S RMPR7R("DATE&TIME")=% S:$G(RMPRRET("DATE&TIME"))'="" RMPR7R("DATE&TIME")=RMPRRET("DATE&TIME")
"RTN","RMPRPIYF",161,0)
 S RMPR7R("SEQUENCE")=1
"RTN","RMPRPIYF",162,0)
 S RMPR7R("QUANTITY")=RMPRRET("QUANTITY")
"RTN","RMPRPIYF",163,0)
 S RMPR7R("VALUE")=RMPRRET("VALUE")
"RTN","RMPRPIYF",164,0)
 S RMPR7R("UNIT")=$G(RMPRRET("UNIT"))
"RTN","RMPRPIYF",165,0)
 I $G(RMDTTIM),$D(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM)) D  I RMPRERR S RMPRERR=71 Q
"RTN","RMPRPIYF",166,0)
 .S RMPR7R("IEN")=$O(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM,1,0))
"RTN","RMPRPIYF",167,0)
 .I '$G(RMPR7R("IEN")) S RMPRERR=1 Q
"RTN","RMPRPIYF",168,0)
 .S RMDA7=$G(^RMPR(661.7,RMPR7R("IEN"),0))
"RTN","RMPRPIYF",169,0)
 .S RMDAVAL=$P(RMDA7,U,8),RMDAQUA=$P(RMDA7,U,7)
"RTN","RMPRPIYF",170,0)
 .S RMPR7R("QUANTITY")=RMPR7R("QUANTITY")+RMDAQUA
"RTN","RMPRPIYF",171,0)
 .S RMPR7R("VALUE")=RMPR7R("VALUE")+RMDAVAL
"RTN","RMPRPIYF",172,0)
 .S RMPR7R("DATE&TIME")=RMDTTIM
"RTN","RMPRPIYF",173,0)
 .S RMPRERR=$$UPD^RMPRPIX7(.RMPR7R,.RMPR11I)
"RTN","RMPRPIYF",174,0)
 I $G(RMDTTIM),'$D(^RMPR(661.7,"XSLHIDS",RMST1,RMLO1,RMHC1,RMIT1,RMDTTIM)) D
"RTN","RMPRPIYF",175,0)
 .S RMPR7R("DATE&TIME")=RMDTTIM
"RTN","RMPRPIYF",176,0)
 .S RMPRERR=$$CRE^RMPRPIX7(.RMPR7R,.RMPR11I)
"RTN","RMPRPIYF",177,0)
 I '$G(RMDTTIM) S RMPRERR=$$CRE^RMPRPIX7(.RMPR7R,.RMPR11I)
"RTN","RMPRPIYF",178,0)
 Q
"RTN","RMPRPIYF",179,0)
 ;
"RTN","RMPRPIYF",180,0)
UP6 ;now update file 661.6
"RTN","RMPRPIYF",181,0)
 S RMPR6("IEN")=$G(RMIEN6)
"RTN","RMPRPIYF",182,0)
 S RMPR6("QUANTITY")=$G(RMPR60("QUANTITY"))
"RTN","RMPRPIYF",183,0)
 S RMPR6("VALUE")=$G(RMPR60("COST"))
"RTN","RMPRPIYF",184,0)
 S RMPRERR=$$UPD^RMPRPIX6(.RMPR6,.RMPR11I)
"RTN","RMPRPIYF",185,0)
 Q
"RTN","RMPRPIYF",186,0)
 ;
"RTN","RMPRPIYF",187,0)
 ;
"RTN","RMPRPIYF",188,0)
UP63 ;update file 661.63
"RTN","RMPRPIYF",189,0)
 S RMPR6("IEN")=$G(RMIEN6)
"RTN","RMPRPIYF",190,0)
 S RMPR6("LOCATION")=$G(RMPR5("IEN"))
"RTN","RMPRPIYF",191,0)
 S RMPR6("VENDOR")=$G(RMPR60("VENDOR IEN"))
"RTN","RMPRPIYF",192,0)
 S RMPR63("IEN")=$G(RMIEN63)
"RTN","RMPRPIYF",193,0)
 S RMPRERR=$$UPD^RMPRPIX3(.RMPR60,.RMPR63,.RMPR11I)
"RTN","RMPRPIYF",194,0)
 Q
"RTN","RMPRPIYF",195,0)
 ;
"RTN","RMPRPIYF",196,0)
UP7 ;file #661.7,deduct quantity
"RTN","RMPRPIYF",197,0)
 Q:'$G(RMPR11I("STATION"))
"RTN","RMPRPIYF",198,0)
 S RMPR7I("STATION IEN")=RMPR11I("STATION")
"RTN","RMPRPIYF",199,0)
 S RMPR7I("LOCATION IEN")=$G(RMPR5("IEN"))
"RTN","RMPRPIYF",200,0)
 S RMPR7I("HCPCS")=RMPR11I("HCPCS")
"RTN","RMPRPIYF",201,0)
 S RMPR7I("ITEM")=RMPR11I("ITEM")
"RTN","RMPRPIYF",202,0)
 S:$G(RMPRRET("DATE&TIME")) RMPR7I("DATE&TIME")=RMPRRET("DATE&TIME")
"RTN","RMPRPIYF",203,0)
 S RMPR7I("ISSUED QTY")=$G(RMPR7I("QUANTITY"))
"RTN","RMPRPIYF",204,0)
 S RMPR7I("ISSUED VALUE")=$G(RMPR7I("VALUE"))
"RTN","RMPRPIYF",205,0)
 S RMPRERR=$$FIFO^RMPRPIUB(.RMPR7I)
"RTN","RMPRPIYF",206,0)
 Q
"RTN","RMPRPIYF",207,0)
UP9 ;file 661.9
"RTN","RMPRPIYF",208,0)
 D NOW^%DTC
"RTN","RMPRPIYF",209,0)
 S RMPR9("STA")=RMPR11I("STATION")
"RTN","RMPRPIYF",210,0)
 S RMPR9("HCP")=RMPR11I("HCPCS")
"RTN","RMPRPIYF",211,0)
 S RMPR9("ITE")=RMPR11I("ITEM")
"RTN","RMPRPIYF",212,0)
 S RMPR9("RDT")=$P(%,".",1)
"RTN","RMPRPIYF",213,0)
 S RMPR9("TQTY")=RMPR9("QUANTITY")
"RTN","RMPRPIYF",214,0)
 S RMPR9("TCST")=RMPR9("VALUE")
"RTN","RMPRPIYF",215,0)
 S RMPERR=$$UPCR^RMPRPIXJ(.RMPR9)
"RTN","RMPRPIYF",216,0)
 Q
"RTN","RMPRPIYF",217,0)
 ;
"RTN","RMPRPIYF",218,0)
QUAN ;only update quantity
"RTN","RMPRPIYF",219,0)
 ;quit if not in PIP
"RTN","RMPRPIYF",220,0)
 Q:'$G(RMIEN6)!'$D(RMDTTIM)!'$D(RMPRRET)
"RTN","RMPRPIYF",221,0)
 S RMPR11I("STATION")=RMPRRET("STATION")
"RTN","RMPRPIYF",222,0)
 S RMPR11I("HCPCS")=RMPRRET("HCPCS")
"RTN","RMPRPIYF",223,0)
 S RMPR11I("ITEM")=RMPRRET("ITEM")
"RTN","RMPRPIYF",224,0)
 S RMPR5("IEN")=RMPRRET("LOCATION")
"RTN","RMPRPIYF",225,0)
 D UP6,UP63
"RTN","RMPRPIYF",226,0)
 I RMPR60("QUANTITY")>($P(R1BCK(0),U,7)) D  D UP7,UP9
"RTN","RMPRPIYF",227,0)
 .S RMPR7I("QUANTITY")=RMPR60("QUANTITY")-($P(R1BCK(0),U,7))
"RTN","RMPRPIYF",228,0)
 .S RMPR7I("VALUE")=RMPR60("COST")-($P(R1BCK(0),U,16))
"RTN","RMPRPIYF",229,0)
 .S RMPR9("QUANTITY")=0-($G(RMPR60("QUANTITY"))-$P(R1BCK(0),U,7))
"RTN","RMPRPIYF",230,0)
 .S RMPR9("VALUE")=0-($G(RMPR60("COST"))-$P(R1BCK(0),U,16))
"RTN","RMPRPIYF",231,0)
 I RMPR60("QUANTITY")<($P(R1BCK(0),U,7)) D  D BACK,UP9
"RTN","RMPRPIYF",232,0)
 .S RMPR9("QUANTITY")=$P(R1BCK(0),U,7)-$G(RMPR60("QUANTITY"))
"RTN","RMPRPIYF",233,0)
 .S RMPRRET("QUANTITY")=$P(R1BCK(0),U,7)-$G(RMPR60("QUANTITY"))
"RTN","RMPRPIYF",234,0)
 .S RMPR9("VALUE")=$P(R1BCK(0),U,16)-$G(RMPR60("COST"))
"RTN","RMPRPIYF",235,0)
 .S RMPRRET("VALUE")=$P(R1BCK(0),U,16)-$G(RMPR60("COST"))
"RTN","RMPRPIYF",236,0)
 Q
"RTN","RMPRPIYF",237,0)
 ;
"RTN","RMPRPIYF",238,0)
ERR W !!,"Error encountered while posting to PIP.  Patient 10-2319 not deleted!! Please check with your Application Coordinator." H 5 G EXIT
"VER")
8.0^22.0
"BLD",5843,6)
^95
**END**
**END**
