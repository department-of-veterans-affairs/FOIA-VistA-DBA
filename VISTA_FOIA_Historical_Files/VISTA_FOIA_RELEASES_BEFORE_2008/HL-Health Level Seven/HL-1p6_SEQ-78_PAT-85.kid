Released HL*1.6*85 SEQ #78
Extracted from mail message
**KIDS**:HL*1.6*85^

**INSTALL NAME**
HL*1.6*85
"BLD",565,0)
HL*1.6*85^HEALTH LEVEL SEVEN^0^3020603^y
"BLD",565,1,0)
^^1^1^3020603^
"BLD",565,1,1,0)
Refer to the Forum patch text on patch HL*1.6*85 for patch information.
"BLD",565,4,0)
^9.64PA^^
"BLD",565,"ABPKG")
n
"BLD",565,"KRN",0)
^9.67PA^8989.52^20
"BLD",565,"KRN",.4,0)
.4
"BLD",565,"KRN",.401,0)
.401
"BLD",565,"KRN",.402,0)
.402
"BLD",565,"KRN",.403,0)
.403
"BLD",565,"KRN",.5,0)
.5
"BLD",565,"KRN",.84,0)
.84
"BLD",565,"KRN",3.6,0)
3.6
"BLD",565,"KRN",3.8,0)
3.8
"BLD",565,"KRN",9.2,0)
9.2
"BLD",565,"KRN",9.8,0)
9.8
"BLD",565,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",565,"KRN",9.8,"NM",1,0)
HLCSRPT2^^0^B76532161
"BLD",565,"KRN",9.8,"NM",2,0)
HLCSRPT4^^0^B62247863
"BLD",565,"KRN",9.8,"NM",3,0)
HLCSRPT5^^0^B11981546
"BLD",565,"KRN",9.8,"NM","B","HLCSRPT2",1)

"BLD",565,"KRN",9.8,"NM","B","HLCSRPT4",2)

"BLD",565,"KRN",9.8,"NM","B","HLCSRPT5",3)

"BLD",565,"KRN",19,0)
19
"BLD",565,"KRN",19.1,0)
19.1
"BLD",565,"KRN",101,0)
101
"BLD",565,"KRN",409.61,0)
409.61
"BLD",565,"KRN",771,0)
771
"BLD",565,"KRN",870,0)
870
"BLD",565,"KRN",8989.51,0)
8989.51
"BLD",565,"KRN",8989.52,0)
8989.52
"BLD",565,"KRN",8994,0)
8994
"BLD",565,"KRN",8994.2,0)
8994.2
"BLD",565,"KRN","B",.4,.4)

"BLD",565,"KRN","B",.401,.401)

"BLD",565,"KRN","B",.402,.402)

"BLD",565,"KRN","B",.403,.403)

"BLD",565,"KRN","B",.5,.5)

"BLD",565,"KRN","B",.84,.84)

"BLD",565,"KRN","B",3.6,3.6)

"BLD",565,"KRN","B",3.8,3.8)

"BLD",565,"KRN","B",9.2,9.2)

"BLD",565,"KRN","B",9.8,9.8)

"BLD",565,"KRN","B",19,19)

"BLD",565,"KRN","B",19.1,19.1)

"BLD",565,"KRN","B",101,101)

"BLD",565,"KRN","B",409.61,409.61)

"BLD",565,"KRN","B",771,771)

"BLD",565,"KRN","B",870,870)

"BLD",565,"KRN","B",8989.51,8989.51)

"BLD",565,"KRN","B",8989.52,8989.52)

"BLD",565,"KRN","B",8994,8994)

"BLD",565,"KRN","B",8994.2,8994.2)

"BLD",565,"QUES",0)
^9.62^^
"BLD",565,"REQB",0)
^9.611^1^1
"BLD",565,"REQB",1,0)
HL*1.6*50^0
"BLD",565,"REQB","B","HL*1.6*50",1)

"MBREQ")
0
"PKG",9,-1)
1^1
"PKG",9,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN^
"PKG",9,20,0)
^9.402P^^
"PKG",9,22,0)
^9.49I^1^1
"PKG",9,22,1,0)
1.6^2980130^2980130^6
"PKG",9,22,1,"PAH",1,0)
85^3020603^73
"PKG",9,22,1,"PAH",1,1,0)
^^1^1^3020603
"PKG",9,22,1,"PAH",1,1,1,0)
Refer to the Forum patch text on patch HL*1.6*85 for patch information.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","HLCSRPT2")
0^1^B76532161
"RTN","HLCSRPT2",1,0)
HLCSRPT2 ;ISC-SF/RAH-TRANS LOG ERROR LIST ;06/23/99  11:10 AM
"RTN","HLCSRPT2",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**50,85**;Oct 13, 1995
"RTN","HLCSRPT2",3,0)
 ;Calls to SAVEDDB^DDBR2, USAVEDDB^DDBR2, PSR^DDBR0, and WP^DDBR2 supported by IA#2540 & IA#3594
"RTN","HLCSRPT2",4,0)
 ;
"RTN","HLCSRPT2",5,0)
 Q
"RTN","HLCSRPT2",6,0)
 ;
"RTN","HLCSRPT2",7,0)
EN ; Entry point for reporting error messages.
"RTN","HLCSRPT2",8,0)
 ;
"RTN","HLCSRPT2",9,0)
 ; All NEWs below added by HL*1.6*85
"RTN","HLCSRPT2",10,0)
 N BLDOFF,BLDON,DY,ERRDTB,ERRDTE,HLCSCLNT,HLCSDTE,HLCSDTP
"RTN","HLCSRPT2",11,0)
 N HLCSEVN,HLCSEVN1,HLCSEVN2,HLCSHDR,HLCSK,HLCSLINK
"RTN","HLCSRPT2",12,0)
 N HLCSLNK,HLCSMID,HLCSMX,HLCSNREC,HLCSPTR,HLCSRNO,HLCSSRVR
"RTN","HLCSRPT2",13,0)
 N HLCSTITL,HLCSTYP,HLERR,IEN773,LAST773,LASTPDT
"RTN","HLCSRPT2",14,0)
 N LPIENS,NOREC,NUMERR,OLD773,OLDPDT,RVOFF,RVON,SPACE
"RTN","HLCSRPT2",15,0)
 N SPACE20,SPACE25,SPACE30,SPACE80,STOP,TYPEINFO,VERS22
"RTN","HLCSRPT2",16,0)
 ;
"RTN","HLCSRPT2",17,0)
 D CLEANGBL ;HL*1.6*85
"RTN","HLCSRPT2",18,0)
 ;
"RTN","HLCSRPT2",19,0)
 S (STOP,NOREC)=""
"RTN","HLCSRPT2",20,0)
 D SCREEN^HLCSRPT
"RTN","HLCSRPT2",21,0)
 S HLCSNREC=BLDON_" ===>>>  NO MATCHING RECORDS  <<<=== "_BLDOFF
"RTN","HLCSRPT2",22,0)
 S HLCSTITL="#773-IEN      Message-ID       Procd     Log-Link   Msg:Evn IO Sndg-Apl Rcvr-Apl" ;HL*1.6*85
"RTN","HLCSRPT2",23,0)
 S HLCSPTR=1,HLCSRNO=1
"RTN","HLCSRPT2",24,0)
 S VERS22=""
"RTN","HLCSRPT2",25,0)
 I 22'>+$$VERSION^XPDUTL("DI")!($$PATCH^XPDUTL("DI*21.0*32")) S VERS22="YES" ;HL*1.6*85
"RTN","HLCSRPT2",26,0)
 I VERS22'="YES" D
"RTN","HLCSRPT2",27,0)
 . S ^TMP("DDBPF1Z",$J)="D SHOWMSG^HLCSRPT2 Q"
"RTN","HLCSRPT2",28,0)
 . S HLCSTITL=HLCSTITL_" ERR"
"RTN","HLCSRPT2",29,0)
 E  S HLCSTITL=HLCSTITL_"    "
"RTN","HLCSRPT2",30,0)
 S ^TMP($J,"LIST","MESSAGE")="^TMP($J,""MESSAGE"",HLCSRNO)"
"RTN","HLCSRPT2",31,0)
 S ^TMP($J,"LIST",HLCSTITL_" ERR")="^TMP(""TLOG"",$J)" ;HL*1.6*85
"RTN","HLCSRPT2",32,0)
 ;
"RTN","HLCSRPT2",33,0)
REEN ; Internal Re-entry Point
"RTN","HLCSRPT2",34,0)
 S STOP=""
"RTN","HLCSRPT2",35,0)
 D WHATERR Q:(+$G(STOP))
"RTN","HLCSRPT2",36,0)
 QUIT:'$$SETUP^HLCSRPT4  ;-> HL*1.6*85
"RTN","HLCSRPT2",37,0)
 I TYPEINFO=2 S HLCSTITL="#773-IEN      Message-ID       Procd     Log-Link   Error-type               " ;HL*1.6*85
"RTN","HLCSRPT2",38,0)
 D ERRSRCH
"RTN","HLCSRPT2",39,0)
 I ERRDTE[9999999 S ERRDTE=$$NOW^XLFDT
"RTN","HLCSRPT2",40,0)
 I +$G(STOP) D EXIT Q
"RTN","HLCSRPT2",41,0)
 I +$G(NOREC) W !!,HLCSNREC,!! S DIR(0)="E" D ^DIR K DIR,X,Y D EXIT Q
"RTN","HLCSRPT2",42,0)
 D DISPLAY^HLCSRPT ;HL*1.6*85
"RTN","HLCSRPT2",43,0)
 D CLEANGBL ;HL*1.6*85
"RTN","HLCSRPT2",44,0)
 D EXIT
"RTN","HLCSRPT2",45,0)
 S STOP=1
"RTN","HLCSRPT2",46,0)
 Q
"RTN","HLCSRPT2",47,0)
 ;
"RTN","HLCSRPT2",48,0)
CLEANGBL ; New subroutine added by HL*1.6*85 to clean up globals
"RTN","HLCSRPT2",49,0)
 N GBL
"RTN","HLCSRPT2",50,0)
 F GBL="LIST","MESSAGE" KILL ^TMP($J,GBL)
"RTN","HLCSRPT2",51,0)
 F GBL="DDBPF1Z","DDBLST","TLOG","TMPLOG" KILL ^TMP(GBL,$J)
"RTN","HLCSRPT2",52,0)
 QUIT
"RTN","HLCSRPT2",53,0)
 ;
"RTN","HLCSRPT2",54,0)
WHATERR ; Ask for one error code; with default of all
"RTN","HLCSRPT2",55,0)
 W @IOF,! S HLCSHDR="Error Type Selection" D HLCSBAR
"RTN","HLCSRPT2",56,0)
 S X="",HLCSER="ALL"
"RTN","HLCSRPT2",57,0)
 S DIR(0)="PAO^771.7:AEO",DIR("A")="Select Error Type:  ALL//"
"RTN","HLCSRPT2",58,0)
 D ^DIR S:($D(DTOUT)!($D(DUOUT))) STOP=1
"RTN","HLCSRPT2",59,0)
 I +$G(STOP) K DIR,X,Y Q
"RTN","HLCSRPT2",60,0)
 I X="" K DIR,X,Y Q
"RTN","HLCSRPT2",61,0)
 I Y=-1 W !,X_" NOT VALID " K DIR,X,Y G WHATERR
"RTN","HLCSRPT2",62,0)
 S HLCSTER1=$P(Y,U,1),HLCSTER2=$P(Y,U,2) K DIR,X,Y
"RTN","HLCSRPT2",63,0)
 S HLCSER=1
"RTN","HLCSRPT2",64,0)
 Q
"RTN","HLCSRPT2",65,0)
 ;
"RTN","HLCSRPT2",66,0)
ERRSRCH ; Find and report the 'errored' messages (Multiple HL*1.6*85 changes start here)
"RTN","HLCSRPT2",67,0)
 ; ERRDTB,ERRDTE,NUMERR -- req
"RTN","HLCSRPT2",68,0)
 N NEXT,CT
"RTN","HLCSRPT2",69,0)
 W !!,"PLEASE WAIT, THIS CAN TAKE AWHILE..."
"RTN","HLCSRPT2",70,0)
 ;
"RTN","HLCSRPT2",71,0)
 ;HL*1.6*85 - LOADERR loads all errors, using the user-supplied 
"RTN","HLCSRPT2",72,0)
 ;            parameters, and places them in ^TMP.  Below, the code
"RTN","HLCSRPT2",73,0)
 ;            now loops thru ^TMP instead of ^HLMA (which happened
"RTN","HLCSRPT2",74,0)
 ;            in LOADERR.)
"RTN","HLCSRPT2",75,0)
 D LOADERR^HLCSRPT4
"RTN","HLCSRPT2",76,0)
 ;
"RTN","HLCSRPT2",77,0)
 ; Looping starts here...
"RTN","HLCSRPT2",78,0)
 S HLCSI=0,HLCSST=0,HLCSLN=0
"RTN","HLCSRPT2",79,0)
 F  S HLCSI=$O(^TMP("ERRLST",$J,HLCSI)) Q:HLCSI'>0  D
"RTN","HLCSRPT2",80,0)
 .  S HLCSN=HLCSI,HLCSJ=0
"RTN","HLCSRPT2",81,0)
 .  F  S HLCSJ=$O(^TMP("ERRLST",$J,HLCSI,HLCSJ)) Q:HLCSJ'>0  D
"RTN","HLCSRPT2",82,0)
 .. ;HL*1.6*85 changes end here, until noted otherwise below.
"RTN","HLCSRPT2",83,0)
 ..
"RTN","HLCSRPT2",84,0)
 .. I '$D(^HLMA(HLCSJ,0)) Q
"RTN","HLCSRPT2",85,0)
 .. S HLCSX=^HLMA(HLCSJ,0),HLCSDTE=$P(HLCSX,U,1)
"RTN","HLCSRPT2",86,0)
 .. I $D(^HLMA(HLCSJ,"S")) S HLCSDTP=$P(^HLMA(HLCSJ,"S"),U,1)
"RTN","HLCSRPT2",87,0)
 .. E  S HLCSDTP=""
"RTN","HLCSRPT2",88,0)
 .. I $D(^HLMA(HLCSJ,"P")) S HLCSY=^HLMA(HLCSJ,"P")
"RTN","HLCSRPT2",89,0)
 .. E  S HLCSY=""
"RTN","HLCSRPT2",90,0)
 .. I HLCSER=1,(HLCSTER1'=$P(HLCSY,U,4)) Q
"RTN","HLCSRPT2",91,0)
 .. S HLCSER1=$P(HLCSY,U,4),HLCSER2=HLCSER1
"RTN","HLCSRPT2",92,0)
 .. I HLCSER1'="",($D(^HL(771.7,HLCSER1,0))) S HLCSER1=$P(^HL(771.7,HLCSER1,0),U,1)
"RTN","HLCSRPT2",93,0)
 .. S HLCSERMS=$P(HLCSY,U,3)
"RTN","HLCSRPT2",94,0)
 .. S HLCSLINK=$P(HLCSX,U,7) S HLCSLNK="          "
"RTN","HLCSRPT2",95,0)
 .. I HLCSLINK'="",($D(^HLCS(870,HLCSLINK,0))) S HLCSLNK=$P(^HLCS(870,HLCSLINK,0),U,1)
"RTN","HLCSRPT2",96,0)
 .. S HLCSEVN1=$P(HLCSX,U,13) I HLCSEVN1'="",($D(^HL(771.2,HLCSEVN1,0))) S HLCSEVN1=$P(^HL(771.2,HLCSEVN1,0),U,1)
"RTN","HLCSRPT2",97,0)
 .. S HLCSEVN2=$P(HLCSX,U,14) I HLCSEVN2'="",($D(^HL(779.001,HLCSEVN2,0))) S HLCSEVN2=$P(^HL(779.001,HLCSEVN2,0),U,1)
"RTN","HLCSRPT2",98,0)
 .. I HLCSEVN1="" S HLCSEVN1=$$MSGEVN^HLCSRPT5(HLCSJ,2) ;HL*1.6*85
"RTN","HLCSRPT2",99,0)
 .. I HLCSEVN2="" S HLCSEVN2=$$MSGEVN^HLCSRPT5(HLCSJ,2) ;HL*1.6*85
"RTN","HLCSRPT2",100,0)
 .. I $L(HLCSEVN1)<3 S HLCSEVN1=HLCSEVN1_"   ",HLCSEVN1=$E(HLCSEVN1,1,3)
"RTN","HLCSRPT2",101,0)
 .. I $L(HLCSEVN2)<3 S HLCSEVN2=HLCSEVN2_"   ",HLCSEVN2=$E(HLCSEVN2,1,3)
"RTN","HLCSRPT2",102,0)
 .. S HLCSEVN=HLCSEVN1_":"_HLCSEVN2
"RTN","HLCSRPT2",103,0)
 .. D ERRRPT^HLCSRPT5 ;HL*1.6*85 - Code overrun moved
"RTN","HLCSRPT2",104,0)
 .. Q
"RTN","HLCSRPT2",105,0)
 .Q
"RTN","HLCSRPT2",106,0)
 KILL ^TMP("ERRLST",$J) ;HL*1.6*85
"RTN","HLCSRPT2",107,0)
 D TMPLOG^HLCSRPT4 ;HL*1.6*85 Reset ^TMP("TMPLOG",$J) to ^TMP("TLOG",$J)
"RTN","HLCSRPT2",108,0)
 I '$D(^TMP("TLOG",$J,1)) S NOREC=1 Q
"RTN","HLCSRPT2",109,0)
 ;HL*1.6*85 - HLCSTITL already set above ;S HLCSTITL="IEN Record #   MESSAGE ID #         Log Link   Msg:Evn IO Sndg Apl Rcvr Apl"
"RTN","HLCSRPT2",110,0)
 I '$D(VERS22) S HLCSTITL=HLCSTITL_" ERR"
"RTN","HLCSRPT2",111,0)
 E  S HLCSTITL=HLCSTITL_"    "
"RTN","HLCSRPT2",112,0)
 D TEST
"RTN","HLCSRPT2",113,0)
 Q
"RTN","HLCSRPT2",114,0)
 ;
"RTN","HLCSRPT2",115,0)
SHOWMSG ; Enable switching to specific message (used by PF1Z).
"RTN","HLCSRPT2",116,0)
 ; If FM version 22 installed, uses VERS22 code, instead.
"RTN","HLCSRPT2",117,0)
 W @IOF
"RTN","HLCSRPT2",118,0)
 S DIR(0)="F:AE",DIR("A")="Enter Record Number: "
"RTN","HLCSRPT2",119,0)
 D ^DIR Q:$D(DIRUT)
"RTN","HLCSRPT2",120,0)
 I Y=-1!(X="") Q
"RTN","HLCSRPT2",121,0)
 S HLCSRNO=X I '$D(^HLMA(HLCSRNO,0)) D  Q
"RTN","HLCSRPT2",122,0)
 . W !!,BLDON,"  ==>  NO SUCH RECORD NUMBER <== ",BLDOFF H 3
"RTN","HLCSRPT2",123,0)
 S HLCSPTR=$P(^HLMA(HLCSRNO,0),"^",1)
"RTN","HLCSRPT2",124,0)
 S XXY=HLCSRNO,XXZ=HLCSPTR D VERS22(XXY,XXZ)
"RTN","HLCSRPT2",125,0)
 D SWITCH
"RTN","HLCSRPT2",126,0)
 Q
"RTN","HLCSRPT2",127,0)
SWITCH ; Non-standard Fileman Browser calls covered by IA# 2540.
"RTN","HLCSRPT2",128,0)
 N DDBLN,DDBZ,DIC,DIR,X,Y,DIRUT,DIROUT,DUOUT,DILN
"RTN","HLCSRPT2",129,0)
 S DILN=DDBRSA(DDBRSA,"DDBSRL")-2
"RTN","HLCSRPT2",130,0)
 S:$G(DDBLST)="" DDBLST="^TMP(""DDBLST"",$J)" S DDBLN=$S($D(@DDBLST@("A",DDBSA)):^(DDBSA),1:$O(@DDBLST@(" "),-1)+1)
"RTN","HLCSRPT2",131,0)
 I $D(@DDBLST) D
"RTN","HLCSRPT2",132,0)
 .I $O(@DDBLST@(" "),-1)=1,$G(@DDBLST@(1,"DDBSA"))=DDBSA Q
"RTN","HLCSRPT2",133,0)
 .S DDBZ=$G(@DDBLST@("A",DDBSA),0)
"RTN","HLCSRPT2",134,0)
 .S Y=2
"RTN","HLCSRPT2",135,0)
 .D SAVEDDB^DDBR2(DDBLST,DDBLN),USAVEDDB^DDBR2(DDBLST,+Y)
"RTN","HLCSRPT2",136,0)
 .S DIROUT=1
"RTN","HLCSRPT2",137,0)
 N DDBLNA
"RTN","HLCSRPT2",138,0)
 I $G(DDBLNA,-1)=-1 G PS
"RTN","HLCSRPT2",139,0)
 I $G(DDBLNA(6))=DDBSA G PS  ;if current doc re-selected
"RTN","HLCSRPT2",140,0)
 I $G(DDBLNA(6))]"",$D(@DDBLST@("APSA",DDBSA)) G PS  ;on list
"RTN","HLCSRPT2",141,0)
 D:DDBLNA>0 SAVEDDB^DDBR2(DDBLST,DDBLN),WP^DDBR2(.DDBLNA)
"RTN","HLCSRPT2",142,0)
PS D PSR^DDBR0(1)
"RTN","HLCSRPT2",143,0)
 Q
"RTN","HLCSRPT2",144,0)
 ;
"RTN","HLCSRPT2",145,0)
VERS22(XXY,XXZ) ; this is modified code from SHOWMSG^HLCSRPT1.
"RTN","HLCSRPT2",146,0)
 ; Each node, ^tmp($j,"message",record_ien), invokes this code
"RTN","HLCSRPT2",147,0)
 ; to compile a 'virtual w-p document' when a message is browsed.
"RTN","HLCSRPT2",148,0)
 I $D(^HLMA(XXY,"MSH",0)) D
"RTN","HLCSRPT2",149,0)
 .S ^TMP($J,"MESSAGE",XXY,0)=^HLMA(XXY,"MSH",0)
"RTN","HLCSRPT2",150,0)
 .S YY1=$P(^HLMA(XXY,"MSH",0),U,3),YY2=$P(^HLMA(XXY,"MSH",0),U,4)
"RTN","HLCSRPT2",151,0)
 E  S ^TMP($J,"MESSAGE",XXY,0)="^^1^1" S (YY1,YY2)=1
"RTN","HLCSRPT2",152,0)
 S XLINE=^HLMA(XXY,0)
"RTN","HLCSRPT2",153,0)
 S LINE="Record #: "_XXY_"                    ",LINE=$E(LINE,1,30)
"RTN","HLCSRPT2",154,0)
 S LINE=LINE_"Message #: "_$P(XLINE,U,2)
"RTN","HLCSRPT2",155,0)
 S ^TMP($J,"MESSAGE",XXY,1,0)=LINE
"RTN","HLCSRPT2",156,0)
 S DTE=$P(XLINE,U,1) I $P($G(^HL(772,DTE,0)),U,1)'="" S DTE=$P(^HL(772,DTE,0),U,1),DTE=$E(DTE,4,7)_$E(DTE,2,3)_"."_$P(DTE,".",2)_"      "
"RTN","HLCSRPT2",157,0)
 I $D(^HLMA(XXY,"S")),$P(^HLMA(XXY,"S"),U,1)'="" S DTP=$P(^HLMA(XXY,"S"),U,1) S DTP=$E(DTP,4,7)_$E(DTP,2,3)_"."_$P(DTP,".",2)
"RTN","HLCSRPT2",158,0)
 E  S DTP=" "
"RTN","HLCSRPT2",159,0)
 S LINE="D/T Entered: "_DTE,LINE=$E(LINE,1,30)_"D/T Processed: "_DTP
"RTN","HLCSRPT2",160,0)
 S ^TMP($J,"MESSAGE",XXY,2,0)=LINE K DTE,DTP
"RTN","HLCSRPT2",161,0)
 S LINE="Logical Link: " I $P(XLINE,U,7)'="",($G(^HLCS(870,$P(XLINE,U,7),0))) S LINE=LINE_$P(^HLCS(870,$P(XLINE,U,7),0),U,1)
"RTN","HLCSRPT2",162,0)
 S LINE=LINE_"                ",LINE=$E(LINE,1,30)
"RTN","HLCSRPT2",163,0)
 S LINE=LINE_"Ack To MSG#: " I $P(XLINE,U,6)'="",$G(^HLMA($P(XLINE,U,6),0)) S LINE=LINE_$P(^HLMA($P(XLINE,U,6),0),U,2)
"RTN","HLCSRPT2",164,0)
 S ^TMP($J,"MESSAGE",XXY,3,0)=LINE
"RTN","HLCSRPT2",165,0)
 S DTS="" I $P($G(^HLMA(XXY,"P")),U,2)'="" S DTS=$P(^HLMA(XXY,"P"),U,2),DTS=$E(DTS,4,7)_$E(DTS,2,3)_"."_$P(DTS,".",2)
"RTN","HLCSRPT2",166,0)
 S LINE="D/T STATUS: "_DTS_"                 ",LINE=$E(LINE,1,30),LINE=LINE_"STATUS: "
"RTN","HLCSRPT2",167,0)
 I $P(^HLMA(XXY,"P"),U,2)'="",($G(^HL(771.6,+$P(^HLMA(XXY,"P"),U,1),0))) S LINE=LINE_$P(^HL(771.6,+$P(^HLMA(XXY,"P"),U,1),0),U,1)
"RTN","HLCSRPT2",168,0)
 S ^TMP($J,"MESSAGE",XXY,4,0)=LINE K DTS
"RTN","HLCSRPT2",169,0)
 S LINE="ERR MSG: " I $P(^HLMA(XXY,"P"),U,3)'="" S LINE=LINE_$E($P(^HLMA(XXY,"P"),U,3),1,20)
"RTN","HLCSRPT2",170,0)
 S LINE=LINE_"                      ",LINE=$E(LINE,1,30)_"ERR TYPE: "
"RTN","HLCSRPT2",171,0)
 I $P(^HLMA(XXY,"P"),U,4)'="",($D(^HL(771.7,+$P(^HLMA(XXY,"P"),U,4),0))) S LINE=LINE_$P(^HL(771.7,+$P(^HLMA(XXY,"P"),U,4),0),U,1)
"RTN","HLCSRPT2",172,0)
 S ^TMP($J,"MESSAGE",XXY,5,0)=LINE
"RTN","HLCSRPT2",173,0)
 S LINE="Sending Appl: " I $P(XLINE,U,11)'="",($D(^HL(771,$P(XLINE,U,11),0))) S LINE=LINE_$P(^HL(771,$P(XLINE,U,11),0),U,1)
"RTN","HLCSRPT2",174,0)
 S ^TMP($J,"MESSAGE",XXY,6,0)=LINE
"RTN","HLCSRPT2",175,0)
 S LINE="Receiving Appl: " I $P(XLINE,U,12)'="",($D(^HL(771,$P(XLINE,U,12),0))) S LINE=LINE_$P(^HL(771,$P(XLINE,U,12),0),U,1)
"RTN","HLCSRPT2",176,0)
 S ^TMP($J,"MESSAGE",XXY,7,0)=LINE
"RTN","HLCSRPT2",177,0)
 S LINE="Message Type: " I $P(XLINE,U,13)'="",($D(^HL(771.2,$P(XLINE,U,13),0))) S LINE=LINE_$P(^HL(771.2,$P(XLINE,U,13),0),U,1)
"RTN","HLCSRPT2",178,0)
 S LINE=LINE_"                    ",LINE=$E(LINE,1,30)_"Event Type: "
"RTN","HLCSRPT2",179,0)
 I $P(XLINE,U,14)'="",($D(^HL(779.001,$P(XLINE,U,14),0))) S LINE=LINE_$P(^HL(779.001,$P(XLINE,U,14),0),U,1)
"RTN","HLCSRPT2",180,0)
 S ^TMP($J,"MESSAGE",XXY,8,0)=LINE K LINE,XLINE
"RTN","HLCSRPT2",181,0)
 S ^TMP($J,"MESSAGE",XXY,9,0)="MESSAGE HEADER: "
"RTN","HLCSRPT2",182,0)
 S LN2=10
"RTN","HLCSRPT2",183,0)
 I $D(^HLMA(XXY,"MSH",0)) D
"RTN","HLCSRPT2",184,0)
 .S LN1=.5
"RTN","HLCSRPT2",185,0)
 .F  S LN1=$O(^HLMA(XXY,"MSH",LN1)) Q:LN1=""  D
"RTN","HLCSRPT2",186,0)
 .. S ^TMP($J,"MESSAGE",XXY,LN2,0)=^HLMA(XXY,"MSH",LN1,0)
"RTN","HLCSRPT2",187,0)
 .. S LN2=LN2+1,LN1=LN1+1
"RTN","HLCSRPT2",188,0)
 E  S ^TMP($J,"MESSAGE",XXY,LN2,0)=" No Header in MSG Admin File (#773)" S LN2=LN2+1
"RTN","HLCSRPT2",189,0)
 S LN1=.5
"RTN","HLCSRPT2",190,0)
 S ^TMP($J,"MESSAGE",XXY,LN2,0)="MESSAGE TEXT: ",LN2=LN2+1
"RTN","HLCSRPT2",191,0)
 I $D(^HL(772,XXZ,"IN",0)) D
"RTN","HLCSRPT2",192,0)
 .F  S LN1=$O(^HL(772,XXZ,"IN",LN1)) Q:(LN1="")  D
"RTN","HLCSRPT2",193,0)
 .. S ^TMP($J,"MESSAGE",XXY,LN2,0)=^HL(772,XXZ,"IN",LN1,0)
"RTN","HLCSRPT2",194,0)
 .. S LN2=LN2+1,LN1=LN1+1
"RTN","HLCSRPT2",195,0)
 ..Q
"RTN","HLCSRPT2",196,0)
 E  S ^TMP($J,"MESSAGE",XXY,LN2,0)=" No Message in MSG Text File (#772)" S LN2=LN2+1
"RTN","HLCSRPT2",197,0)
 S (YY1,YY2)=LN2-1
"RTN","HLCSRPT2",198,0)
 S Y1Y2=YY1_"^"_YY2
"RTN","HLCSRPT2",199,0)
 S $P(^TMP($J,"MESSAGE",XXY,0),U,3,4)=Y1Y2
"RTN","HLCSRPT2",200,0)
 K LN1,LN2,Y1Y2,YY1,YY2
"RTN","HLCSRPT2",201,0)
 Q
"RTN","HLCSRPT2",202,0)
 ;
"RTN","HLCSRPT2",203,0)
EXIT ;
"RTN","HLCSRPT2",204,0)
 K I,J
"RTN","HLCSRPT2",205,0)
 K HLCSER,HLCSER1,HLCSER2,HLCSI,HLCSJ,HLCSLN,HLCSN
"RTN","HLCSRPT2",206,0)
 K HLCSST,HLCSTER1,HLCSTER2,HLCSERMS,HLCSX,HLCSY
"RTN","HLCSRPT2",207,0)
 K ^TMP($J,"LIST",HLCSTITL_" ERR") ;HL*1.6*85
"RTN","HLCSRPT2",208,0)
 I VERS22'="YES" S ^TMP("DDBPF1Z",$J)="D SHOWMSG^HLCSRPT Q"
"RTN","HLCSRPT2",209,0)
 Q
"RTN","HLCSRPT2",210,0)
 ;
"RTN","HLCSRPT2",211,0)
HLCSBAR ; Center Title on Top Line of Screen
"RTN","HLCSRPT2",212,0)
 W RVON,?(80-$L(HLCSHDR)\2),HLCSHDR,$E(SPACE,$X,77),RVOFF,!
"RTN","HLCSRPT2",213,0)
 Q
"RTN","HLCSRPT2",214,0)
 ;
"RTN","HLCSRPT2",215,0)
TEST ;
"RTN","HLCSRPT2",216,0)
 S HLCSJ=$O(^TMP("TLOG",$J,0))
"RTN","HLCSRPT2",217,0)
 S HLCSJ=+$P(HLCSJ," ",1)
"RTN","HLCSRPT2",218,0)
 S ^TMP($J,"MESSAGE",HLCSJ,0)="^^1^1"
"RTN","HLCSRPT2",219,0)
 S ^TMP($J,"MESSAGE",HLCSJ,1,0)=" HEADER: "
"RTN","HLCSRPT2",220,0)
 S HLCSRNO=HLCSJ
"RTN","HLCSRPT2",221,0)
 Q
"RTN","HLCSRPT2",222,0)
 ;
"RTN","HLCSRPT4")
0^2^B62247863
"RTN","HLCSRPT4",1,0)
HLCSRPT4 ;OIFO-O/LJA - Error Listing code ;3/18/02 10:19
"RTN","HLCSRPT4",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**85**;Oct 13, 1995
"RTN","HLCSRPT4",3,0)
 ;
"RTN","HLCSRPT4",4,0)
 ; Patch HL*1.6*85 created a significant amount of code; enough
"RTN","HLCSRPT4",5,0)
 ; that this routine had to be created to hold it. 
"RTN","HLCSRPT4",6,0)
 ;
"RTN","HLCSRPT4",7,0)
LOADERR ; Find latest NUMERR statuses in ERRDTB->ERRDTE date range. ;HL*1.6*85
"RTN","HLCSRPT4",8,0)
 ;ERRDTB,ERRDTE,HLCSER,HLCSTER1,NUMERR -- req
"RTN","HLCSRPT4",9,0)
 ;
"RTN","HLCSRPT4",10,0)
 N CT,ERR,ERR4,IEN,TIME
"RTN","HLCSRPT4",11,0)
 ;
"RTN","HLCSRPT4",12,0)
 KILL ^TMP("HLERR",$J),^TMP("ERRLST",$J)
"RTN","HLCSRPT4",13,0)
 ;
"RTN","HLCSRPT4",14,0)
 S HLERR=3.9,CT=0
"RTN","HLCSRPT4",15,0)
 F  S HLERR=$O(^HLMA("AG",HLERR)) QUIT:HLERR'>0!(HLERR>7)  D
"RTN","HLCSRPT4",16,0)
 .  S IEN773=0
"RTN","HLCSRPT4",17,0)
 .  F  S IEN773=$O(^HLMA("AG",HLERR,IEN773)) Q:IEN773'>0  D
"RTN","HLCSRPT4",18,0)
 .  .  S ERR4=$P($G(^HLMA(+IEN773,"P")),U,4) QUIT:ERR4'>0  ;->
"RTN","HLCSRPT4",19,0)
 .  .  D CHKERR(ERR4,IEN773,ERRDTB,ERRDTE)
"RTN","HLCSRPT4",20,0)
 .  .  S CT=CT+1 W:'(CT#1000) "."
"RTN","HLCSRPT4",21,0)
 ;
"RTN","HLCSRPT4",22,0)
 S ERR=0
"RTN","HLCSRPT4",23,0)
 F  S ERR=$O(^TMP("HLERR",$J,ERR)) Q:ERR'>0  D
"RTN","HLCSRPT4",24,0)
 .  S TIME=0
"RTN","HLCSRPT4",25,0)
 .  F  S TIME=$O(^TMP("HLERR",$J,ERR,TIME)) Q:TIME'>0  D
"RTN","HLCSRPT4",26,0)
 .  .  S IEN=0
"RTN","HLCSRPT4",27,0)
 .  .  F  S IEN=$O(^TMP("HLERR",$J,ERR,TIME,IEN)) Q:IEN'>0  D
"RTN","HLCSRPT4",28,0)
 .  .  .  S ^TMP("ERRLST",$J,+ERR,+IEN)=""
"RTN","HLCSRPT4",29,0)
 ;
"RTN","HLCSRPT4",30,0)
 KILL ^TMP("HLERR",$J)
"RTN","HLCSRPT4",31,0)
 ;
"RTN","HLCSRPT4",32,0)
 QUIT
"RTN","HLCSRPT4",33,0)
 ;
"RTN","HLCSRPT4",34,0)
CHKERR(ERR4,IEN773,DTB,DTE) ; Should this entry be included? ;HL*1.6*85
"RTN","HLCSRPT4",35,0)
 ;NUMERR -- req
"RTN","HLCSRPT4",36,0)
 ;
"RTN","HLCSRPT4",37,0)
 N ERRNO,OLD773,OLDPDT,PROCDT
"RTN","HLCSRPT4",38,0)
 ;
"RTN","HLCSRPT4",39,0)
 ; Processing date/time check...
"RTN","HLCSRPT4",40,0)
 S PROCDT=$$PROCDT(IEN773) QUIT:PROCDT'>0  ;->
"RTN","HLCSRPT4",41,0)
 I PROCDT<DTB!(PROCDT>DTE) QUIT  ;->
"RTN","HLCSRPT4",42,0)
 ; OK.  Date check passes.  But, is it among NUMERR latest?
"RTN","HLCSRPT4",43,0)
 ;
"RTN","HLCSRPT4",44,0)
 ; How many errors recorded for error status?
"RTN","HLCSRPT4",45,0)
 S ERRNO=$G(^TMP("HLERR",$J,ERR4))
"RTN","HLCSRPT4",46,0)
 ;
"RTN","HLCSRPT4",47,0)
 ; Number of errors recorded less than # maximum per status...
"RTN","HLCSRPT4",48,0)
 I ERRNO<NUMERR D RECERR(ERR4,IEN773) QUIT  ;->
"RTN","HLCSRPT4",49,0)
 ;
"RTN","HLCSRPT4",50,0)
 ; Find oldest entry's process date/time & last 773 IEN...
"RTN","HLCSRPT4",51,0)
 S OLDPDT=$O(^TMP("HLERR",$J,ERR4,0)) QUIT:OLDPDT'>0  ;->
"RTN","HLCSRPT4",52,0)
 S OLD773=$O(^TMP("HLERR",$J,ERR4,+OLDPDT,0)) QUIT:OLD773'>0  ;->
"RTN","HLCSRPT4",53,0)
 ;
"RTN","HLCSRPT4",54,0)
 ; Now see if "this" error is newer...
"RTN","HLCSRPT4",55,0)
 QUIT:PROCDT<OLDPDT  ;->
"RTN","HLCSRPT4",56,0)
 I PROCDT=OLDPDT,IEN773<OLD773 QUIT  ;->
"RTN","HLCSRPT4",57,0)
 ;
"RTN","HLCSRPT4",58,0)
 ; Max number errors reached, but this error is newer than newest...
"RTN","HLCSRPT4",59,0)
 ;
"RTN","HLCSRPT4",60,0)
 ; Zilch oldest entry, then record "this" error...
"RTN","HLCSRPT4",61,0)
 D KILLERR(ERR4,OLDPDT,OLD773)
"RTN","HLCSRPT4",62,0)
 D RECERR(ERR4,IEN773)
"RTN","HLCSRPT4",63,0)
 ;
"RTN","HLCSRPT4",64,0)
 QUIT
"RTN","HLCSRPT4",65,0)
 ;
"RTN","HLCSRPT4",66,0)
KILLERR(ERR4,OLDPDT,OLD773) ; Remove entry and adjust counts... ;HL*1.6*85
"RTN","HLCSRPT4",67,0)
 N NUM
"RTN","HLCSRPT4",68,0)
 ;
"RTN","HLCSRPT4",69,0)
 KILL ^TMP("HLERR",$J,ERR4,OLDPDT,OLD773)
"RTN","HLCSRPT4",70,0)
 ;
"RTN","HLCSRPT4",71,0)
 I $O(^TMP("HLERR",$J,ERR4,OLDPDT,0))'>0 D
"RTN","HLCSRPT4",72,0)
 .  KILL ^TMP("HLERR",$J,ERR4,OLDPDT)
"RTN","HLCSRPT4",73,0)
 I $O(^TMP("HLERR",$J,ERR4,OLDPDT,0))>0 D
"RTN","HLCSRPT4",74,0)
 .  S NUM=$G(^TMP("HLERR",$J,ERR4,OLDPDT))-1,NUM=$S(NUM'<0:+NUM,1:0)
"RTN","HLCSRPT4",75,0)
 .  S ^TMP("HLERR",$J,ERR4,OLDPDT)=NUM
"RTN","HLCSRPT4",76,0)
 ;
"RTN","HLCSRPT4",77,0)
 I $O(^TMP("HLERR",$J,ERR4,0))'>0 D
"RTN","HLCSRPT4",78,0)
 .  KILL ^TMP("HLERR",$J,ERR4)
"RTN","HLCSRPT4",79,0)
 I $O(^TMP("HLERR",$J,ERR4,0))>0 D
"RTN","HLCSRPT4",80,0)
 .  S NUM=$G(^TMP("HLERR",$J,ERR4))-1,NUM=$S(NUM'<0:+NUM,1:0)
"RTN","HLCSRPT4",81,0)
 .  S ^TMP("HLERR",$J,ERR4)=NUM
"RTN","HLCSRPT4",82,0)
 ;
"RTN","HLCSRPT4",83,0)
 I $O(^TMP("HLERR",$J,0))'>0 D
"RTN","HLCSRPT4",84,0)
 .  KILL ^TMP("HLERR",$J)
"RTN","HLCSRPT4",85,0)
 I $O(^TMP("HLERR",$J,0))>0 D
"RTN","HLCSRPT4",86,0)
 .  S NUM=$G(^TMP("HLERR",$J))-1,NUM=$S(NUM'<0:+NUM,1:0)
"RTN","HLCSRPT4",87,0)
 .  S ^TMP("HLERR",$J)=NUM
"RTN","HLCSRPT4",88,0)
 ;
"RTN","HLCSRPT4",89,0)
 QUIT
"RTN","HLCSRPT4",90,0)
 ;
"RTN","HLCSRPT4",91,0)
RECERR(ERR4,IEN773) ; Store error in ^TMP("HLERR",$J,STATUS,IEN773) ;HL*1.6*85
"RTN","HLCSRPT4",92,0)
 S ^TMP("HLERR",$J,ERR4)=$G(^TMP("HLERR",$J,ERR4))+1
"RTN","HLCSRPT4",93,0)
 S ^TMP("HLERR",$J,ERR4,PROCDT)=$G(^TMP("HLERR",$J,ERR4,PROCDT))+1
"RTN","HLCSRPT4",94,0)
 S ^TMP("HLERR",$J,ERR4,PROCDT,IEN773)=""
"RTN","HLCSRPT4",95,0)
 QUIT
"RTN","HLCSRPT4",96,0)
 ;
"RTN","HLCSRPT4",97,0)
SETUP() ; Setup "limit" variables... ;HL*1.6*85
"RTN","HLCSRPT4",98,0)
 S TYPEINFO=$$TYPEINFO QUIT:TYPEINFO']"" "" ;->
"RTN","HLCSRPT4",99,0)
 ;
"RTN","HLCSRPT4",100,0)
 S (ERRDTB,ERRDTE,NUMERR)=""
"RTN","HLCSRPT4",101,0)
 W !!,"   If you answer NO below, you will be allowed to specify the number of"
"RTN","HLCSRPT4",102,0)
 W !,"   errors to be included in the report."
"RTN","HLCSRPT4",103,0)
 W !
"RTN","HLCSRPT4",104,0)
 S NUMERR=$$YN("Print all errors","No") QUIT:NUMERR']"" "" ;->
"RTN","HLCSRPT4",105,0)
 S NUMERR=$S(NUMERR=1:9999999,1:$$NUMERR) QUIT:NUMERR'>0 "" ;->
"RTN","HLCSRPT4",106,0)
 I NUMERR=9999999 D
"RTN","HLCSRPT4",107,0)
 .  W !!,"   All errors in the date range you specify next will be included"
"RTN","HLCSRPT4",108,0)
 .  W !,"   in the report."
"RTN","HLCSRPT4",109,0)
 I NUMERR'=9999999 D
"RTN","HLCSRPT4",110,0)
 .  W !!,"   The newest ",NUMERR," errors, for every error status, in the date range you"
"RTN","HLCSRPT4",111,0)
 .  W !,"   specify next will be included in the report."
"RTN","HLCSRPT4",112,0)
 W !!,"The first entry at your site is from ",$$FMTE^XLFDT($O(^HL(772,"B",2840000))),"."
"RTN","HLCSRPT4",113,0)
 W !
"RTN","HLCSRPT4",114,0)
S1 S ERRDTB=$$DATE("Enter START DATE/TIME",,$$FMADD^XLFDT($$DT^XLFDT,-90)) QUIT:ERRDTB'>0 "" ;->
"RTN","HLCSRPT4",115,0)
 W !
"RTN","HLCSRPT4",116,0)
 S ERRDTE=$$DATE("Enter END DATE/TIME",ERRDTB,"NOW") QUIT:ERRDTE'>0 "" ;->
"RTN","HLCSRPT4",117,0)
 I ERRDTB=ERRDTE D  G S1 ;->
"RTN","HLCSRPT4",118,0)
 .  W !!,"You cannot enter the same values for the beginning and ending times!"
"RTN","HLCSRPT4",119,0)
 .  W !
"RTN","HLCSRPT4",120,0)
 QUIT 1
"RTN","HLCSRPT4",121,0)
 ;
"RTN","HLCSRPT4",122,0)
NUMERR() ; How many errors, maximum, does user want to see ;HL*1.6*85
"RTN","HLCSRPT4",123,0)
 ; HLCSER -- req
"RTN","HLCSRPT4",124,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","HLCSRPT4",125,0)
 W !!,"Enter the maximum number errors to report for every error status."
"RTN","HLCSRPT4",126,0)
 W !
"RTN","HLCSRPT4",127,0)
 S DIR(0)="N",DIR("A")="Enter maximum number errors/status"
"RTN","HLCSRPT4",128,0)
 S DIR("B")=999
"RTN","HLCSRPT4",129,0)
 S DIR("?",1)="If you enter '1000' for the maximum number errors/status..."
"RTN","HLCSRPT4",130,0)
 S DIR("?",2)=""
"RTN","HLCSRPT4",131,0)
 I HLCSER="ALL" D
"RTN","HLCSRPT4",132,0)
 .  S DIR("?",3)="... The most recent 1000 errors for every error type will be included in the"
"RTN","HLCSRPT4",133,0)
 .  S DIR("?",4)="... report. If two different error types exist, and each error type has"
"RTN","HLCSRPT4",134,0)
 .  S DIR("?",5)="... more than 1000 entries, then 2000 errors will be reported."
"RTN","HLCSRPT4",135,0)
 .  S DIR("?")="... (I.e., 1000 errors per error type.)"
"RTN","HLCSRPT4",136,0)
 I HLCSER'="ALL" D
"RTN","HLCSRPT4",137,0)
 .  S DIR("?",3)="... The most recent 1000 errors for the error type you just selected"
"RTN","HLCSRPT4",138,0)
 .  S DIR("?")="... will be included in the report."
"RTN","HLCSRPT4",139,0)
 D ^DIR
"RTN","HLCSRPT4",140,0)
 QUIT $S(Y>0:+Y,1:"")
"RTN","HLCSRPT4",141,0)
 ;
"RTN","HLCSRPT4",142,0)
DATE(PMT,BDT,PDT) ; Entry of date for looping ;HL*1.6*85
"RTN","HLCSRPT4",143,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","HLCSRPT4",144,0)
 S BDT=$S($G(BDT)?7N.E:BDT,1:"")
"RTN","HLCSRPT4",145,0)
 S DIR(0)="DA^"_$G(BDT)_"::ET"
"RTN","HLCSRPT4",146,0)
 I $G(BDT)>0 D
"RTN","HLCSRPT4",147,0)
 .  N TXT
"RTN","HLCSRPT4",148,0)
 .  S TXT="Enter a date/time after "_$$FMTE^XLFDT(BDT)_"..."
"RTN","HLCSRPT4",149,0)
 .  S DIR("?")=TXT
"RTN","HLCSRPT4",150,0)
 S DIR("A")=PMT_": "
"RTN","HLCSRPT4",151,0)
 I $G(PDT)?7N.E S DIR("B")=$P($$FMTE^XLFDT(PDT),":",1,2)
"RTN","HLCSRPT4",152,0)
 I $G(PDT)="NOW" S DIR("B")="NOW"
"RTN","HLCSRPT4",153,0)
 D ^DIR
"RTN","HLCSRPT4",154,0)
 I Y?7N.E,$G(PMT)="NOW",$G(PDT)="NOW" QUIT 9999999.24 ;->
"RTN","HLCSRPT4",155,0)
 QUIT $S(Y>0:+Y,1:"")
"RTN","HLCSRPT4",156,0)
 ;
"RTN","HLCSRPT4",157,0)
YN(PMT,DEF,FF) ; Generic YES/NO DIR call... ;HL*1.6*85
"RTN","HLCSRPT4",158,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","HLCSRPT4",159,0)
 F X=1:1:$G(FF) W !
"RTN","HLCSRPT4",160,0)
 S DIR(0)="Y",DIR("A")=PMT
"RTN","HLCSRPT4",161,0)
 S:$G(DEF)]"" DIR("B")=DEF
"RTN","HLCSRPT4",162,0)
 D ^DIR
"RTN","HLCSRPT4",163,0)
 QUIT:$D(DIRUT)!($D(DTOUT))!($D(DUOUT)) "" ;->
"RTN","HLCSRPT4",164,0)
 QUIT $S(Y=1:1,1:0)
"RTN","HLCSRPT4",165,0)
 ;
"RTN","HLCSRPT4",166,0)
TMPLOG ; Reset ^TMP("TMPLOG") data created in ERRRPT to ^TMP("TLOG") format
"RTN","HLCSRPT4",167,0)
 ; expected by the browser.  (See DISPLAY^HLCSRPT)
"RTN","HLCSRPT4",168,0)
 ; [This subroutine created by HL*1.6*85.]
"RTN","HLCSRPT4",169,0)
 N HLCSLN,PROCDT,IEN773
"RTN","HLCSRPT4",170,0)
 S HLCSLN=0,PROCDT="zzzzz"
"RTN","HLCSRPT4",171,0)
 F  S PROCDT=$O(^TMP("TMPLOG",$J,PROCDT),-1) Q:PROCDT']""  D
"RTN","HLCSRPT4",172,0)
 .  S IEN773=":"
"RTN","HLCSRPT4",173,0)
 .  F  S IEN773=$O(^TMP("TMPLOG",$J,PROCDT,IEN773),-1) Q:IEN773'>0  D
"RTN","HLCSRPT4",174,0)
 .  .  S HLCSLN=HLCSLN+1
"RTN","HLCSRPT4",175,0)
 .  .  S ^TMP("TLOG",$J,+HLCSLN)=$G(^TMP("TMPLOG",$J,PROCDT,IEN773))
"RTN","HLCSRPT4",176,0)
 KILL ^TMP("TMPLOG",$J)
"RTN","HLCSRPT4",177,0)
 QUIT
"RTN","HLCSRPT4",178,0)
 ;
"RTN","HLCSRPT4",179,0)
OKDATE(IEN773,DTBEG,DTEND) ; Does 773 processing time fall in date range?  ;HL*1.6*85
"RTN","HLCSRPT4",180,0)
 N PROCDT
"RTN","HLCSRPT4",181,0)
 ;
"RTN","HLCSRPT4",182,0)
 ; Check what's passed in...
"RTN","HLCSRPT4",183,0)
 QUIT:'$D(^HLMA(+IEN773,0)) "" ;->
"RTN","HLCSRPT4",184,0)
 QUIT:$G(DTBEG)'?7N.E "" ;->
"RTN","HLCSRPT4",185,0)
 QUIT:$G(DTEND)'?7N.E "" ;->
"RTN","HLCSRPT4",186,0)
 ;
"RTN","HLCSRPT4",187,0)
 ; Get processing date/time...
"RTN","HLCSRPT4",188,0)
 S PROCDT=$$PROCDT(IEN773) QUIT:PROCDT'?7N.E "" ;->
"RTN","HLCSRPT4",189,0)
 ;
"RTN","HLCSRPT4",190,0)
 ; Compare dates...
"RTN","HLCSRPT4",191,0)
 I PROCDT=DTBEG!(PROCDT=DTEND) QUIT 1 ;->
"RTN","HLCSRPT4",192,0)
 QUIT:PROCDT<DTBEG "" ;->
"RTN","HLCSRPT4",193,0)
 QUIT:PROCDT>DTEND "" ;->
"RTN","HLCSRPT4",194,0)
 ;
"RTN","HLCSRPT4",195,0)
 QUIT 1
"RTN","HLCSRPT4",196,0)
 ;
"RTN","HLCSRPT4",197,0)
PROCDT(IEN773) ; Return 773'S processing date (1st), or if not available
"RTN","HLCSRPT4",198,0)
 ; return the 772 creation date/time. ;HL*1.6*85
"RTN","HLCSRPT4",199,0)
 N PROCDT
"RTN","HLCSRPT4",200,0)
 S PROCDT=$P($G(^HLMA(+IEN773,"S")),U) QUIT:PROCDT?7N.E PROCDT ;->
"RTN","HLCSRPT4",201,0)
 QUIT $P($G(^HL(772,+$G(^HLMA(+IEN773,0)),0)),U)
"RTN","HLCSRPT4",202,0)
 ;
"RTN","HLCSRPT4",203,0)
DTORTM(DTB,DTE,PDT) ; Show date or time?
"RTN","HLCSRPT4",204,0)
 QUIT $S($E(DTB,1,7)=$E(DTE,1,7):$$TM(PDT),1:$$DT(PDT))
"RTN","HLCSRPT4",205,0)
 ;
"RTN","HLCSRPT4",206,0)
TM(PDT) ; Show the 5 character hh:mm time
"RTN","HLCSRPT4",207,0)
 QUIT $E($P($$FMTE^XLFDT(+PDT),"@",2),1,5)
"RTN","HLCSRPT4",208,0)
 ;
"RTN","HLCSRPT4",209,0)
DT(PDT) ; Show the 8 character mm/dd/yy date
"RTN","HLCSRPT4",210,0)
 QUIT $E(PDT,4,5)_"/"_$E(PDT,6,7)_"/"_$E(PDT,2,3)
"RTN","HLCSRPT4",211,0)
 ;
"RTN","HLCSRPT4",212,0)
TYPEINFO() ; Display error type or application information?
"RTN","HLCSRPT4",213,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","HLCSRPT4",214,0)
 W !!,"Select the report view now.  There are two report views.  Both list the "
"RTN","HLCSRPT4",215,0)
 W !,"internal entry number from the HL7 Message Administration file (#773) entry,"
"RTN","HLCSRPT4",216,0)
 W !,"message ID, processing date or time, and logical link.  The two report views"
"RTN","HLCSRPT4",217,0)
 W !,"differ in the remainder of the information displayed on the report.  "
"RTN","HLCSRPT4",218,0)
 S DIR(0)="S^1:Display message, event, & application data;2:Display error type"
"RTN","HLCSRPT4",219,0)
 S DIR("A")="Select data to display",DIR("B")=1
"RTN","HLCSRPT4",220,0)
 S DIR("?",1)="Select the data to be displayed in the last few columns of the report after"
"RTN","HLCSRPT4",221,0)
 S DIR("?")="the IEN, message ID, processing date or time, and logical link."
"RTN","HLCSRPT4",222,0)
 D ^DIR
"RTN","HLCSRPT4",223,0)
 QUIT $S(Y>0:+Y,1:"")
"RTN","HLCSRPT4",224,0)
 ;
"RTN","HLCSRPT4",225,0)
EOR ;HLCSRPT4 - Error Listing code ;3/18/02 10:19
"RTN","HLCSRPT5")
0^3^B11981546
"RTN","HLCSRPT5",1,0)
HLCSRPT5 ;OIFO-O/LJA - Error Listing code ;3/18/02 10:19
"RTN","HLCSRPT5",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**85**;Oct 13, 1995
"RTN","HLCSRPT5",3,0)
 ;
"RTN","HLCSRPT5",4,0)
ERRRPT ; Format a report line (Moved here by HL*1.6*85 from HLCSRPT2)
"RTN","HLCSRPT5",5,0)
 N PROCDT ;HL*1.6*85
"RTN","HLCSRPT5",6,0)
 S HLCSY=""
"RTN","HLCSRPT5",7,0)
 S HLCSRNO=HLCSJ,SPACE20="                    "
"RTN","HLCSRPT5",8,0)
 I VERS22'="" D
"RTN","HLCSRPT5",9,0)
 .S HLCSRNO="$.%$CREF$^TMP($J,""MESSAGE"","_HLCSRNO_")$CREF$^"_HLCSRNO_"$.%"
"RTN","HLCSRPT5",10,0)
 .S Y=$L(HLCSJ),X=$E(SPACE20,1,13-Y) S HLCSRNO=HLCSRNO_X K X,Y ;HL*1.6*85
"RTN","HLCSRPT5",11,0)
 E  S HLCSRNO=HLCSRNO_SPACE20 S HLCSRNO=$E(HLCSRNO,1,13) ;HL*1.6*85
"RTN","HLCSRPT5",12,0)
 S HLCSY=HLCSRNO_" "
"RTN","HLCSRPT5",13,0)
 ;
"RTN","HLCSRPT5",14,0)
 ; Major HL*1.6*85 modifications begin here (to print date/time)
"RTN","HLCSRPT5",15,0)
 ; Just add Processed Date/Time to message ID field cow bird fashion
"RTN","HLCSRPT5",16,0)
 S HLCSMX=$P(HLCSX,U,2)
"RTN","HLCSRPT5",17,0)
 N PROCDT
"RTN","HLCSRPT5",18,0)
 S PROCDT=$$PROCDT(+HLCSJ)
"RTN","HLCSRPT5",19,0)
 S PROCDT=$$DTORTM(ERRDTB,ERRDTE,PROCDT)
"RTN","HLCSRPT5",20,0)
 S PROCDT=$S(PROCDT]"":PROCDT,1:" ") ; Can't be null!! (subscript error)
"RTN","HLCSRPT5",21,0)
 I $L(HLCSMX)<17 D
"RTN","HLCSRPT5",22,0)
 .  S HLCSMX=$E(HLCSMX_SPACE20,1,16)_" "_PROCDT
"RTN","HLCSRPT5",23,0)
 S HLCSMID=HLCSMX_SPACE25 S HLCSMID=$E(HLCSMID,1,25)_" "
"RTN","HLCSRPT5",24,0)
 ;End HL*1.6*85 modifications
"RTN","HLCSRPT5",25,0)
 ;
"RTN","HLCSRPT5",26,0)
 S HLCSPTR=$P(^HLMA(HLCSJ,0),"^",1)
"RTN","HLCSRPT5",27,0)
 S HLCSY=HLCSY_HLCSMID_" "
"RTN","HLCSRPT5",28,0)
 S HLCSY=HLCSY_$E(HLCSLNK_SPACE20,1,10)_" "
"RTN","HLCSRPT5",29,0)
 S HLCSY=HLCSY_HLCSEVN_" "
"RTN","HLCSRPT5",30,0)
 S HLCSTYP=$P(HLCSX,U,3) S:HLCSTYP="O" HLCSTYP="OT" S:HLCSTYP="I" HLCSTYP="IN"
"RTN","HLCSRPT5",31,0)
 S HLCSY=HLCSY_$E(HLCSTYP_SPACE20,1,2)_" "
"RTN","HLCSRPT5",32,0)
 S HLCSSRVR=$P(HLCSX,U,11) I HLCSSRVR'="",($D(^HL(771,HLCSSRVR,0))) S HLCSSRVR=$P(^HL(771,HLCSSRVR,0),U,1)
"RTN","HLCSRPT5",33,0)
 S HLCSY=HLCSY_$E(HLCSSRVR_SPACE20,1,8)_" "
"RTN","HLCSRPT5",34,0)
 S HLCSCLNT=$P(HLCSX,U,12) I HLCSCLNT'="",($D(^HL(771,HLCSCLNT,0))) S HLCSCLNT=$P(^HL(771,HLCSCLNT,0),U,1)
"RTN","HLCSRPT5",35,0)
 S HLCSY=HLCSY_$E(HLCSCLNT_SPACE20,1,8)
"RTN","HLCSRPT5",36,0)
 S HLCSER1=HLCSER1_SPACE80,HLCSER1=$E(HLCSER1,1,39)_" "
"RTN","HLCSRPT5",37,0)
 S HLCSERMS=HLCSERMS_SPACE80,HLCSERMS=$E(HLCSERMS,1,39)
"RTN","HLCSRPT5",38,0)
 S HLCSLN=HLCSLN+1
"RTN","HLCSRPT5",39,0)
 I VERS22="" S HLCSY=HLCSY_" "_HLCSER1_HLCSERMS
"RTN","HLCSRPT5",40,0)
 D INFO ;HL*1.6*85
"RTN","HLCSRPT5",41,0)
 S ^TMP("TMPLOG",$J,PROCDT,+HLCSJ)=HLCSY
"RTN","HLCSRPT5",42,0)
 I VERS22'="" S ^TMP($J,"MESSAGE",HLCSJ)="$XC$^D VERS22^HLCSRPT2("_HLCSJ_","_HLCSPTR_")$XC$^MESSAGE"
"RTN","HLCSRPT5",43,0)
 Q
"RTN","HLCSRPT5",44,0)
 ;
"RTN","HLCSRPT5",45,0)
PROCDT(IEN773) ; Return 773'S processing date (1st), or if not available
"RTN","HLCSRPT5",46,0)
 ; return the 772 creation date/time. ;HL*1.6*85
"RTN","HLCSRPT5",47,0)
 N PROCDT
"RTN","HLCSRPT5",48,0)
 S PROCDT=$P($G(^HLMA(+IEN773,"S")),U) QUIT:PROCDT?7N.E PROCDT ;->
"RTN","HLCSRPT5",49,0)
 QUIT $P($G(^HL(772,+$G(^HLMA(+IEN773,0)),0)),U)
"RTN","HLCSRPT5",50,0)
 ;
"RTN","HLCSRPT5",51,0)
DTORTM(DTB,DTE,PDT) ; Show date or time?
"RTN","HLCSRPT5",52,0)
 QUIT $S($E(DTB,1,7)=$E(DTE,1,7):$$TM(PDT),1:$$DT(PDT))
"RTN","HLCSRPT5",53,0)
 ;
"RTN","HLCSRPT5",54,0)
TM(PDT) ; Show the 5 character hh:mm time
"RTN","HLCSRPT5",55,0)
 QUIT $E($P($$FMTE^XLFDT(+PDT),"@",2),1,5)
"RTN","HLCSRPT5",56,0)
 ;
"RTN","HLCSRPT5",57,0)
DT(PDT) ; Show the 8 character mm/dd/yy date
"RTN","HLCSRPT5",58,0)
 QUIT $E(PDT,4,5)_"/"_$E(PDT,6,7)_"/"_$E(PDT,2,3)
"RTN","HLCSRPT5",59,0)
 ;
"RTN","HLCSRPT5",60,0)
INFO ; If TYPEINFO=Error Type, reset HLCSY. (Called from ERRRPT^HLCSRPT4) - HL*1.6*85
"RTN","HLCSRPT5",61,0)
 ; HLCSJ,HLCSRNO -- req
"RTN","HLCSRPT5",62,0)
 N DATA,ET,ETYPE,I7717
"RTN","HLCSRPT5",63,0)
 QUIT:TYPEINFO'=2  ;->
"RTN","HLCSRPT5",64,0)
 S DATA=$P(HLCSY,HLCSRNO_" ",2,99) QUIT:DATA']""  ;->
"RTN","HLCSRPT5",65,0)
 S I7717=$P($G(^HLMA(+HLCSJ,"P")),U,4)
"RTN","HLCSRPT5",66,0)
 S ETYPE=$P($G(^HL(771.7,+I7717,0)),U)
"RTN","HLCSRPT5",67,0)
 I ETYPE="Duplicate Message" D
"RTN","HLCSRPT5",68,0)
 .  S ET=$P(^HLMA(+HLCSJ,"P"),U,3) ; Free text
"RTN","HLCSRPT5",69,0)
 .  QUIT:ET'["Duplicate with ien"  ;->
"RTN","HLCSRPT5",70,0)
 .  S ET=$P(ET,"Duplicate with ien ",2) QUIT:ET'?1.N  ;->
"RTN","HLCSRPT5",71,0)
 .  S ETYPE="Duplicate w/# "_ET
"RTN","HLCSRPT5",72,0)
 I ETYPE="Incorrect Message Received" D
"RTN","HLCSRPT5",73,0)
 .  S ET=$P(^HLMA(+HLCSJ,"P"),U,3) ; Free text
"RTN","HLCSRPT5",74,0)
 .  QUIT:ET'["Incorrect msg. Id"  ;->
"RTN","HLCSRPT5",75,0)
 .  S ETYPE="Incorrect message ID"
"RTN","HLCSRPT5",76,0)
 S $E(DATA,39,999)=$E(ETYPE_SPACE80,1,41)
"RTN","HLCSRPT5",77,0)
 S HLCSY=HLCSRNO_" "_DATA
"RTN","HLCSRPT5",78,0)
 QUIT
"RTN","HLCSRPT5",79,0)
 ;
"RTN","HLCSRPT5",80,0)
MSGEVN(IEN773,PCE) ; Return MSG~EVN piece (PCE)...
"RTN","HLCSRPT5",81,0)
 N DEL,MSGEVN,MSH
"RTN","HLCSRPT5",82,0)
 S MSH=$G(^HLMA(+IEN773,"MSH",1,0)) QUIT:MSH']"" "   " ;->
"RTN","HLCSRPT5",83,0)
 S DEL=$E(MSH,4) QUIT:DEL']"" "   " ;->
"RTN","HLCSRPT5",84,0)
 S MSGEVN=$P(MSH,DEL,9) QUIT:MSGEVN'?1.E1"~"1.E "   " ;->
"RTN","HLCSRPT5",85,0)
 QUIT $P(MSGEVN,"~",+PCE)
"RTN","HLCSRPT5",86,0)
 ;
"RTN","HLCSRPT5",87,0)
EOR ;HLCSRPT5 - Error Listing code ;3/18/02 10:19
"VER")
8.0^22.0
**END**
**END**
