Released XU*8*71 SEQ #59
Extracted from mail message
**KIDS**:XU*8.0*71^

**INSTALL NAME**
XU*8.0*71
"BLD",24,0)
XU*8.0*71^KERNEL^0^2980218^y
"BLD",24,1,0)
^^104^104^2980317^
"BLD",24,1,1,0)
This patch includes routines that either needed change because of Y2K
"BLD",24,1,2,0)
analysis or provide new date formats for others to use.
"BLD",24,1,3,0)

"BLD",24,1,4,0)
See the Web page to see the new formats available with FMTE^XLFDT and
"BLD",24,1,5,0)
HTE^XLFDT. 
"BLD",24,1,6,0)
 http://www.vista.med.va.gov/softserv/infrastr.uct/kernel/y2k/index.html
"BLD",24,1,7,0)

"BLD",24,1,8,0)
Here is a sample,  Note the NEW values for y.  5, 6, 7 
"BLD",24,1,9,0)
$$FMTE(x[,y])
"BLD",24,1,10,0)
VA FileMan to External
"BLD",24,1,11,0)
       Return conversion to an external format of a date in VA FileMan format.
"BLD",24,1,12,0)
       arguments:  x  VA FileMan date
"BLD",24,1,13,0)
                   y  [optional] Affects output as follows:
"BLD",24,1,14,0)
               If '$D(y) then return standard VA FileMan format.
"BLD",24,1,15,0)
               If +y = 1 then return standard VA FileMan format.
"BLD",24,1,16,0)
               If +y = 2 then return MM/DD/YY@HH:MM:SS format.
"BLD",24,1,17,0)
               If +y = 3 then return DD/MM/YY@HH:MM:SS format.
"BLD",24,1,18,0)
               If +y = 4 then return YY/MM/DD@HH:MM:SS format.
"BLD",24,1,19,0)
               If +y = 5 then return MM/DD/YYYYHH:MM:SS format.
"BLD",24,1,20,0)
               If +y = 6 then return DD/MM/YYYY@HH:MM:SS format.
"BLD",24,1,21,0)
               If +y = 7 then return YYYY/MM/DD@HH:MM:SS format.
"BLD",24,1,22,0)
               If y contains "D" then Date only.
"BLD",24,1,23,0)
               If y contains "F" then output date with leading blanks.
"BLD",24,1,24,0)
               If y contains "P" then output "HH:MM:SS am/pm".
"BLD",24,1,25,0)
               If y contains "M" then output "HH:MM" only.
"BLD",24,1,26,0)
               If y contains "S" then force seconds in the output.
"BLD",24,1,27,0)
               If y contains "Z" then output date with leading zeros.
"BLD",24,1,28,0)
               
"BLD",24,1,29,0)
               W $$HTE^XLFDT("54786,40523")      --> Dec 31, 1990@11:15:23
"BLD",24,1,30,0)
               W $$HTE^XLFDT("54786,40523",2)    --> 12/31/90@11:15:23
"BLD",24,1,31,0)
               W $$FMTE^XLFDT(2940629.105744,1)  --> Jun 29, 1994@10:57:44
"BLD",24,1,32,0)
               W $$FMTE^XLFDT(2940629.105744,"2M") --> 6/29/94@10:57
"BLD",24,1,33,0)
               W $$FMTE^XLFDT(2940629.1057,"2S") --> 6/29/94@10:57:00
"BLD",24,1,34,0)
               W $$FMTE^XLFDT(2940629.1057,"4D") --> 94/6/29
"BLD",24,1,35,0)
               W $$FMTE^XLFDT(2940629.1057,"1P") --> Jun 29, 1994 10:57 am
"BLD",24,1,36,0)
               W $$FMTE^XLFDT(2940629.1057,"2P") --> 6/29/94 10:57 am
"BLD",24,1,37,0)
               W $$FMTE^XLFDT(3000229.1105,"5")  --> 2/29/2000@11:05
"BLD",24,1,38,0)
               W $$FMTE^XLFDT(3000229.1105,"5ZP") --> 02/29/2000 11:05 am
"BLD",24,1,39,0)
               W $$FMTE^XLFDT(3000229.1105,"5F") -->  2/29/2000@11:05
"BLD",24,1,40,0)
               W $$FMTE^XLFDT(3000229.1105,"6Z") --> 29/02/2000@11:05
"BLD",24,1,41,0)
               W $$FMTE^XLFDT(3000301.1105,"7")  --> 2000/3/1@11:05
"BLD",24,1,42,0)

"BLD",24,1,43,0)

"BLD",24,1,44,0)

"BLD",24,1,45,0)
                 Checksum
"BLD",24,1,46,0)
Routine         Old       New      2nd Line
"BLD",24,1,47,0)
XLFDT         2542000   4068329    **71**
"BLD",24,1,48,0)
XLFDT1        1537932   2415851    **71**
"BLD",24,1,49,0)
XLFDT2        4162412   3429255    **71**
"BLD",24,1,50,0)
XLFDT3        7128144   6320544    **71**
"BLD",24,1,51,0)
XLFDT4        1396443   1396443    **71**
"BLD",24,1,52,0)
XQDATE        1632193   1671306    **71**
"BLD",24,1,53,0)
XTER2        13615695  10464968    **71**
"BLD",24,1,54,0)
XUWORKDY      1331031    902683    **65,71**
"BLD",24,1,55,0)
ZOSVVXD       7658715   7782508    **13,65,71**
"BLD",24,1,56,0)
  
"BLD",24,1,57,0)
========================================================================= 
"BLD",24,1,58,0)
Installation:
"BLD",24,1,59,0)

"BLD",24,1,60,0)
  1.  DSM sites - Some of these routines may be mapped,
"BLD",24,1,61,0)
      so you will need to disable mapping for the effected routines.
"BLD",24,1,62,0)
      
"BLD",24,1,63,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",24,1,64,0)
      option will load the KIDS package onto your system.
"BLD",24,1,65,0)
      
"BLD",24,1,66,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",24,1,67,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",24,1,68,0)
      On the KIDS menu, under the 'Installation' menu, use the following
"BLD",24,1,69,0)
      options:
"BLD",24,1,70,0)
      
"BLD",24,1,71,0)
         Verify Checksum's in Transport Global
"BLD",24,1,72,0)
         Print Transport Global
"BLD",24,1,73,0)
         Compare Transport Global to Current System
"BLD",24,1,74,0)
         Backup a Transport Global
"BLD",24,1,75,0)
         
"BLD",24,1,76,0)
  4.  Users can remain on the system. This patch can be loaded any
"BLD",24,1,77,0)
      non-peek time.
"BLD",24,1,78,0)
      
"BLD",24,1,79,0)
  5.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",24,1,80,0)
      option:
"BLD",24,1,81,0)
         Install Package(s)  'XU*8.0*71'
"BLD",24,1,82,0)
                              =========
"BLD",24,1,83,0)
         
"BLD",24,1,84,0)
  7.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",24,1,85,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",24,1,86,0)
      
"BLD",24,1,87,0)
  8.  After installing this patch, 
"BLD",24,1,88,0)
      DSM sites - you need to move one routines from 
"BLD",24,1,89,0)
      your production account to each manager account:
"BLD",24,1,90,0)
      OpenM Sites - you don't need to move anything, skip this step.
"BLD",24,1,91,0)
      ZOSVVXD
"BLD",24,1,92,0)
      
"BLD",24,1,93,0)
      And in the manager account,  (OpenM sites remain in VAH)
"BLD",24,1,94,0)
       
"BLD",24,1,95,0)
      DSM sites:
"BLD",24,1,96,0)
      DO RELOAD^ZTMGRSET
"BLD",24,1,97,0)
      Select the System
"BLD",24,1,98,0)
      Patch number to load: 71
"BLD",24,1,99,0)
                            ==
"BLD",24,1,100,0)
                            
"BLD",24,1,101,0)
  9.  DSM Sites, after patch has installed, rebuild your map set.
"BLD",24,1,102,0)

"BLD",24,1,103,0)
=========================================================================
"BLD",24,1,104,0)

"BLD",24,4,0)
^9.64PA^^
"BLD",24,"KRN",0)
^9.67PA^19^15
"BLD",24,"KRN",.4,0)
.4
"BLD",24,"KRN",.401,0)
.401
"BLD",24,"KRN",.402,0)
.402
"BLD",24,"KRN",.403,0)
.403
"BLD",24,"KRN",.5,0)
.5
"BLD",24,"KRN",.84,0)
.84
"BLD",24,"KRN",3.6,0)
3.6
"BLD",24,"KRN",3.8,0)
3.8
"BLD",24,"KRN",9.2,0)
9.2
"BLD",24,"KRN",9.8,0)
9.8
"BLD",24,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",24,"KRN",9.8,"NM",1,0)
XLFDT^^0^B10795447
"BLD",24,"KRN",9.8,"NM",2,0)
XLFDT1^^0^B3498449
"BLD",24,"KRN",9.8,"NM",3,0)
XLFDT2^^0^B6370915
"BLD",24,"KRN",9.8,"NM",4,0)
XLFDT3^^0^B7537251
"BLD",24,"KRN",9.8,"NM",5,0)
XLFDT4^^0^B2171533
"BLD",24,"KRN",9.8,"NM",6,0)
ZOSVVXD^^0^B16831153
"BLD",24,"KRN",9.8,"NM",7,0)
XTER2^^0^B14229519
"BLD",24,"KRN",9.8,"NM",8,0)
XQDATE^^0^B2326425
"BLD",24,"KRN",9.8,"NM",9,0)
XUWORKDY^^0^B1270134
"BLD",24,"KRN",9.8,"NM","B","XLFDT",1)

"BLD",24,"KRN",9.8,"NM","B","XLFDT1",2)

"BLD",24,"KRN",9.8,"NM","B","XLFDT2",3)

"BLD",24,"KRN",9.8,"NM","B","XLFDT3",4)

"BLD",24,"KRN",9.8,"NM","B","XLFDT4",5)

"BLD",24,"KRN",9.8,"NM","B","XQDATE",8)

"BLD",24,"KRN",9.8,"NM","B","XTER2",7)

"BLD",24,"KRN",9.8,"NM","B","XUWORKDY",9)

"BLD",24,"KRN",9.8,"NM","B","ZOSVVXD",6)

"BLD",24,"KRN",19,0)
19
"BLD",24,"KRN",19.1,0)
19.1
"BLD",24,"KRN",101,0)
101
"BLD",24,"KRN",869.2,0)
869.2
"BLD",24,"KRN",8994,0)
8994
"BLD",24,"KRN","B",.4,.4)

"BLD",24,"KRN","B",.401,.401)

"BLD",24,"KRN","B",.402,.402)

"BLD",24,"KRN","B",.403,.403)

"BLD",24,"KRN","B",.5,.5)

"BLD",24,"KRN","B",.84,.84)

"BLD",24,"KRN","B",3.6,3.6)

"BLD",24,"KRN","B",3.8,3.8)

"BLD",24,"KRN","B",9.2,9.2)

"BLD",24,"KRN","B",9.8,9.8)

"BLD",24,"KRN","B",19,19)

"BLD",24,"KRN","B",19.1,19.1)

"BLD",24,"KRN","B",101,101)

"BLD",24,"KRN","B",869.2,869.2)

"BLD",24,"KRN","B",8994,8994)

"BLD",24,"QUES",0)
^9.62^^
"BLD",24,"REQB",0)
^9.611^1^1
"BLD",24,"REQB",1,0)
XU*8.0*65^2
"BLD",24,"REQB","B","XU*8.0*65",1)

"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
71^2980218
"PKG",3,22,1,"PAH",1,1,0)
^^104^104^2980317
"PKG",3,22,1,"PAH",1,1,1,0)
This patch includes routines that either needed change because of Y2K
"PKG",3,22,1,"PAH",1,1,2,0)
analysis or provide new date formats for others to use.
"PKG",3,22,1,"PAH",1,1,3,0)

"PKG",3,22,1,"PAH",1,1,4,0)
See the Web page to see the new formats available with FMTE^XLFDT and
"PKG",3,22,1,"PAH",1,1,5,0)
HTE^XLFDT. 
"PKG",3,22,1,"PAH",1,1,6,0)
 http://www.vista.med.va.gov/softserv/infrastr.uct/kernel/y2k/index.html
"PKG",3,22,1,"PAH",1,1,7,0)

"PKG",3,22,1,"PAH",1,1,8,0)
Here is a sample,  Note the NEW values for y.  5, 6, 7 
"PKG",3,22,1,"PAH",1,1,9,0)
$$FMTE(x[,y])
"PKG",3,22,1,"PAH",1,1,10,0)
VA FileMan to External
"PKG",3,22,1,"PAH",1,1,11,0)
       Return conversion to an external format of a date in VA FileMan format.
"PKG",3,22,1,"PAH",1,1,12,0)
       arguments:  x  VA FileMan date
"PKG",3,22,1,"PAH",1,1,13,0)
                   y  [optional] Affects output as follows:
"PKG",3,22,1,"PAH",1,1,14,0)
               If '$D(y) then return standard VA FileMan format.
"PKG",3,22,1,"PAH",1,1,15,0)
               If +y = 1 then return standard VA FileMan format.
"PKG",3,22,1,"PAH",1,1,16,0)
               If +y = 2 then return MM/DD/YY@HH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,17,0)
               If +y = 3 then return DD/MM/YY@HH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,18,0)
               If +y = 4 then return YY/MM/DD@HH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,19,0)
               If +y = 5 then return MM/DD/YYYYHH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,20,0)
               If +y = 6 then return DD/MM/YYYY@HH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,21,0)
               If +y = 7 then return YYYY/MM/DD@HH:MM:SS format.
"PKG",3,22,1,"PAH",1,1,22,0)
               If y contains "D" then Date only.
"PKG",3,22,1,"PAH",1,1,23,0)
               If y contains "F" then output date with leading blanks.
"PKG",3,22,1,"PAH",1,1,24,0)
               If y contains "P" then output "HH:MM:SS am/pm".
"PKG",3,22,1,"PAH",1,1,25,0)
               If y contains "M" then output "HH:MM" only.
"PKG",3,22,1,"PAH",1,1,26,0)
               If y contains "S" then force seconds in the output.
"PKG",3,22,1,"PAH",1,1,27,0)
               If y contains "Z" then output date with leading zeros.
"PKG",3,22,1,"PAH",1,1,28,0)
               
"PKG",3,22,1,"PAH",1,1,29,0)
               W $$HTE^XLFDT("54786,40523")      --> Dec 31, 1990@11:15:23
"PKG",3,22,1,"PAH",1,1,30,0)
               W $$HTE^XLFDT("54786,40523",2)    --> 12/31/90@11:15:23
"PKG",3,22,1,"PAH",1,1,31,0)
               W $$FMTE^XLFDT(2940629.105744,1)  --> Jun 29, 1994@10:57:44
"PKG",3,22,1,"PAH",1,1,32,0)
               W $$FMTE^XLFDT(2940629.105744,"2M") --> 6/29/94@10:57
"PKG",3,22,1,"PAH",1,1,33,0)
               W $$FMTE^XLFDT(2940629.1057,"2S") --> 6/29/94@10:57:00
"PKG",3,22,1,"PAH",1,1,34,0)
               W $$FMTE^XLFDT(2940629.1057,"4D") --> 94/6/29
"PKG",3,22,1,"PAH",1,1,35,0)
               W $$FMTE^XLFDT(2940629.1057,"1P") --> Jun 29, 1994 10:57 am
"PKG",3,22,1,"PAH",1,1,36,0)
               W $$FMTE^XLFDT(2940629.1057,"2P") --> 6/29/94 10:57 am
"PKG",3,22,1,"PAH",1,1,37,0)
               W $$FMTE^XLFDT(3000229.1105,"5")  --> 2/29/2000@11:05
"PKG",3,22,1,"PAH",1,1,38,0)
               W $$FMTE^XLFDT(3000229.1105,"5ZP") --> 02/29/2000 11:05 am
"PKG",3,22,1,"PAH",1,1,39,0)
               W $$FMTE^XLFDT(3000229.1105,"5F") -->  2/29/2000@11:05
"PKG",3,22,1,"PAH",1,1,40,0)
               W $$FMTE^XLFDT(3000229.1105,"6Z") --> 29/02/2000@11:05
"PKG",3,22,1,"PAH",1,1,41,0)
               W $$FMTE^XLFDT(3000301.1105,"7")  --> 2000/3/1@11:05
"PKG",3,22,1,"PAH",1,1,42,0)

"PKG",3,22,1,"PAH",1,1,43,0)

"PKG",3,22,1,"PAH",1,1,44,0)

"PKG",3,22,1,"PAH",1,1,45,0)
                 Checksum
"PKG",3,22,1,"PAH",1,1,46,0)
Routine         Old       New      2nd Line
"PKG",3,22,1,"PAH",1,1,47,0)
XLFDT         2542000   4068329    **71**
"PKG",3,22,1,"PAH",1,1,48,0)
XLFDT1        1537932   2415851    **71**
"PKG",3,22,1,"PAH",1,1,49,0)
XLFDT2        4162412   3429255    **71**
"PKG",3,22,1,"PAH",1,1,50,0)
XLFDT3        7128144   6320544    **71**
"PKG",3,22,1,"PAH",1,1,51,0)
XLFDT4        1396443   1396443    **71**
"PKG",3,22,1,"PAH",1,1,52,0)
XQDATE        1632193   1671306    **71**
"PKG",3,22,1,"PAH",1,1,53,0)
XTER2        13615695  10464968    **71**
"PKG",3,22,1,"PAH",1,1,54,0)
XUWORKDY      1331031    902683    **65,71**
"PKG",3,22,1,"PAH",1,1,55,0)
ZOSVVXD       7658715   7782508    **13,65,71**
"PKG",3,22,1,"PAH",1,1,56,0)
  
"PKG",3,22,1,"PAH",1,1,57,0)
========================================================================= 
"PKG",3,22,1,"PAH",1,1,58,0)
Installation:
"PKG",3,22,1,"PAH",1,1,59,0)

"PKG",3,22,1,"PAH",1,1,60,0)
  1.  DSM sites - Some of these routines may be mapped,
"PKG",3,22,1,"PAH",1,1,61,0)
      so you will need to disable mapping for the effected routines.
"PKG",3,22,1,"PAH",1,1,62,0)
      
"PKG",3,22,1,"PAH",1,1,63,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",3,22,1,"PAH",1,1,64,0)
      option will load the KIDS package onto your system.
"PKG",3,22,1,"PAH",1,1,65,0)
      
"PKG",3,22,1,"PAH",1,1,66,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",3,22,1,"PAH",1,1,67,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",3,22,1,"PAH",1,1,68,0)
      On the KIDS menu, under the 'Installation' menu, use the following
"PKG",3,22,1,"PAH",1,1,69,0)
      options:
"PKG",3,22,1,"PAH",1,1,70,0)
      
"PKG",3,22,1,"PAH",1,1,71,0)
         Verify Checksum's in Transport Global
"PKG",3,22,1,"PAH",1,1,72,0)
         Print Transport Global
"PKG",3,22,1,"PAH",1,1,73,0)
         Compare Transport Global to Current System
"PKG",3,22,1,"PAH",1,1,74,0)
         Backup a Transport Global
"PKG",3,22,1,"PAH",1,1,75,0)
         
"PKG",3,22,1,"PAH",1,1,76,0)
  4.  Users can remain on the system. This patch can be loaded any
"PKG",3,22,1,"PAH",1,1,77,0)
      non-peek time.
"PKG",3,22,1,"PAH",1,1,78,0)
      
"PKG",3,22,1,"PAH",1,1,79,0)
  5.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",3,22,1,"PAH",1,1,80,0)
      option:
"PKG",3,22,1,"PAH",1,1,81,0)
         Install Package(s)  'XU*8.0*71'
"PKG",3,22,1,"PAH",1,1,82,0)
                              =========
"PKG",3,22,1,"PAH",1,1,83,0)
         
"PKG",3,22,1,"PAH",1,1,84,0)
  7.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",3,22,1,"PAH",1,1,85,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",3,22,1,"PAH",1,1,86,0)
      
"PKG",3,22,1,"PAH",1,1,87,0)
  8.  After installing this patch, 
"PKG",3,22,1,"PAH",1,1,88,0)
      DSM sites - you need to move one routines from 
"PKG",3,22,1,"PAH",1,1,89,0)
      your production account to each manager account:
"PKG",3,22,1,"PAH",1,1,90,0)
      OpenM Sites - you don't need to move anything, skip this step.
"PKG",3,22,1,"PAH",1,1,91,0)
      ZOSVVXD
"PKG",3,22,1,"PAH",1,1,92,0)
      
"PKG",3,22,1,"PAH",1,1,93,0)
      And in the manager account,  (OpenM sites remain in VAH)
"PKG",3,22,1,"PAH",1,1,94,0)
       
"PKG",3,22,1,"PAH",1,1,95,0)
      DSM sites:
"PKG",3,22,1,"PAH",1,1,96,0)
      DO RELOAD^ZTMGRSET
"PKG",3,22,1,"PAH",1,1,97,0)
      Select the System
"PKG",3,22,1,"PAH",1,1,98,0)
      Patch number to load: 71
"PKG",3,22,1,"PAH",1,1,99,0)
                            ==
"PKG",3,22,1,"PAH",1,1,100,0)
                            
"PKG",3,22,1,"PAH",1,1,101,0)
  9.  DSM Sites, after patch has installed, rebuild your map set.
"PKG",3,22,1,"PAH",1,1,102,0)

"PKG",3,22,1,"PAH",1,1,103,0)
=========================================================================
"PKG",3,22,1,"PAH",1,1,104,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","XLFDT")
0^1^B10795447
"RTN","XLFDT",1,0)
XLFDT ;ISC-SF/STAFF - Date/Time Functions ;12/17/97  16:47
"RTN","XLFDT",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XLFDT",3,0)
HTFM(%H,%F) ;$H to FM
"RTN","XLFDT",4,0)
 N X,%,%T,%Y,%M,%D S:'$D(%F) %F=0 D YMD S:%T&('%F) X=X_%T Q X
"RTN","XLFDT",5,0)
 ;
"RTN","XLFDT",6,0)
YMD ;21608 = 28 feb 1900, 94657 = 28 feb 2100, 141 $H base year
"RTN","XLFDT",7,0)
 S %=(%H>21608)+(%H>94657)+%H-.1,%Y=%\365.25+141,%=%#365.25\1
"RTN","XLFDT",8,0)
 S %D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1
"RTN","XLFDT",9,0)
 S X=%Y_"00"+%M_"00"+%D,%=$P(%H,",",2)
"RTN","XLFDT",10,0)
 S %T=%#60/100+(%#3600\60)/100+(%\3600)/100
"RTN","XLFDT",11,0)
 Q
"RTN","XLFDT",12,0)
 ;
"RTN","XLFDT",13,0)
FMTH(X,%F) ;FM to $H
"RTN","XLFDT",14,0)
 N %Y,%H S:'$D(%F) %F=0 D H S:%F %H=+%H Q %H
"RTN","XLFDT",15,0)
H ;Build %H from FM
"RTN","XLFDT",16,0)
 N %,%L,%M,%D,%T I X<1410000 S %H=0,%Y=-1 Q
"RTN","XLFDT",17,0)
 S %Y=$E(X,1,3),%M=$E(X,4,5),%D=$E(X,6,7)
"RTN","XLFDT",18,0)
 S %T=$E(X_0,9,10)*60+$E(X_"000",11,12)*60+$E(X_"00000",13,14)
"RTN","XLFDT",19,0)
 ;%L = (# leap years) - (# leap years before base)
"RTN","XLFDT",20,0)
 S %L=%Y+1700 S:%M<3 %L=%L-1 S %L=(%L\4)-(%L\100)+(%L\400)-446
"RTN","XLFDT",21,0)
 S %H=$P("^31^59^90^120^151^181^212^243^273^304^334","^",%M)+%D
"RTN","XLFDT",22,0)
 S %=('%M)!('%D),%Y=%Y-141,%H=(%H+(%Y*365)+%L+%)_","_%T,%Y=$S(%:-1,1:%H+4#7)
"RTN","XLFDT",23,0)
 Q
"RTN","XLFDT",24,0)
 ;
"RTN","XLFDT",25,0)
HTE(%H,%F) ;$H to external
"RTN","XLFDT",26,0)
 Q:%H'>0 %H N Y,%T,%R S %F=$G(%F) S Y=$$HTFM(%H,0) G T2
"RTN","XLFDT",27,0)
 ;
"RTN","XLFDT",28,0)
FMTE(Y,%F) ;FM to external
"RTN","XLFDT",29,0)
 Q:'Y Y N %T,%R S %F=$G(%F)
"RTN","XLFDT",30,0)
T2 S %T="."_$E($P(Y,".",2)_"000000",1,7) D @("F"_$S(%F<1:1,%F>7:1,1:+%F\1)_"^XLFDT1") Q %R
"RTN","XLFDT",31,0)
 ;
"RTN","XLFDT",32,0)
FMTHL7(%L1) ;Convert FM date/time to HL7 format
"RTN","XLFDT",33,0)
 S:%L1>1 %L1=%L1+17000000 S:%L1#1 %L1=%L1*10000 S:%L1#1 %L1=%L1*100\1
"RTN","XLFDT",34,0)
 S %L1=%L1_$$TZ()
"RTN","XLFDT",35,0)
 Q %L1
"RTN","XLFDT",36,0)
 ;
"RTN","XLFDT",37,0)
HL7TFM(%L1,%L2) ;Convert HL7 D/T to FM.
"RTN","XLFDT",38,0)
 N %TZ,%SN,%U,%H,%M S %L2=$G(%L2)
"RTN","XLFDT",39,0)
 F %SN="+","-" I %L1[%SN D  Q
"RTN","XLFDT",40,0)
 . S %TZ=$P(%L1,%SN,2),%L1=$P(%L1,%SN) I %TZ'?4N S %TZ="" Q
"RTN","XLFDT",41,0)
 . S %TZ=%SN_%TZ
"RTN","XLFDT",42,0)
 . Q
"RTN","XLFDT",43,0)
 Q:%L1'?4.14N ""
"RTN","XLFDT",44,0)
 S %L1=$S(%L1<10000:%L1/10000,%L1>99999999:$E(%L1,1,8)-17000000_"."_$E(%L1,9,14),1:%L1-1700000)
"RTN","XLFDT",45,0)
 I (%L2["U")!(%L2["L"),%L1["." D  ;Get UCT
"RTN","XLFDT",46,0)
 . S %=$TR(%TZ,"+-","-+"),%H=$E(%,1,3),%M=$E(%,1)_$E(%,4,5) ;Reverse the sign
"RTN","XLFDT",47,0)
 . S %L1=$$FMADD(%L1,,%H,%M) Q
"RTN","XLFDT",48,0)
 I %L2["L",%L1["." D  ;Build local from UCT
"RTN","XLFDT",49,0)
 . S %=$$TZ(),%H=$E(%,1,3),%M=$E(%,1)_$E(%,4,5)
"RTN","XLFDT",50,0)
 . S %L1=$$FMADD(%L1,,%H,%M) Q
"RTN","XLFDT",51,0)
 Q %L1
"RTN","XLFDT",52,0)
 ;
"RTN","XLFDT",53,0)
DOW(X,Y) ;Day of Week
"RTN","XLFDT",54,0)
 N %Y,%M,%D,%H,%T D H I $G(Y) Q %Y
"RTN","XLFDT",55,0)
 Q $P("Sun^Mon^Tues^Wednes^Thurs^Fri^Satur","^",%Y+1)_"day"
"RTN","XLFDT",56,0)
 ;
"RTN","XLFDT",57,0)
FMDIFF(X1,X2,X3) ;FM diff in two dates in days if x3=1 seconds if x3=2.
"RTN","XLFDT",58,0)
 N %H,%Y,X S:'$D(X3) X3=1 S X=X1 D H S X1=+%H,X1(1)=$P(%H,",",2),X=X2 D H
"RTN","XLFDT",59,0)
D2 S X=(X1-%H) S:X3>1 X=X*86400+(X1(1)-$P(%H,",",2))
"RTN","XLFDT",60,0)
 I X3=3 S %=X,X="" S:%'<86400 X=(%\86400) S:%#86400 X=X_" "_(%#86400\3600)_":"_$E(%#3600\60+100,2,3)_":"_$E(%#60+100,2,3)
"RTN","XLFDT",61,0)
 Q X
"RTN","XLFDT",62,0)
 ;
"RTN","XLFDT",63,0)
HDIFF(X1,X2,X3) ;$H diff in two dates, X3 same as FMDIFF.
"RTN","XLFDT",64,0)
 N X,%H,%T S:'$D(X3) X3=1 S X1(1)=$P(X1,",",2),X1=+X1,%H=X2
"RTN","XLFDT",65,0)
 G D2
"RTN","XLFDT",66,0)
 ;
"RTN","XLFDT",67,0)
HADD(X,D,H,M,S) ;Add to $H date
"RTN","XLFDT",68,0)
 N %H,%T S %H=+X,%T=$P(X,",",2) D A2 Q %H_","_%T
"RTN","XLFDT",69,0)
A2 S %H=%H+$G(D),%T=%T+($G(H)*3600)+($G(M)*60)+$G(S)
"RTN","XLFDT",70,0)
 S:%T>86400 %H=%H+(%T\86400),%T=%T#86400 S:%T<0 %H=%H+(%T\86400)-1,%T=%T#86400
"RTN","XLFDT",71,0)
 Q
"RTN","XLFDT",72,0)
 ;
"RTN","XLFDT",73,0)
FMADD(X,D,H,M,S) ;Add to FM date
"RTN","XLFDT",74,0)
 N %H,%T S %H=$$FMTH(X,0),%T=$P(%H,",",2) D A2 Q $$HTFM(%H_","_%T)
"RTN","XLFDT",75,0)
 ;
"RTN","XLFDT",76,0)
NOW() ;Current Date/time in FM.
"RTN","XLFDT",77,0)
 Q $$HTFM($H)
"RTN","XLFDT",78,0)
 ;
"RTN","XLFDT",79,0)
DT() ;Current Date in FM.
"RTN","XLFDT",80,0)
 Q $$HTFM($H)\1
"RTN","XLFDT",81,0)
 ;
"RTN","XLFDT",82,0)
SCH(SCH,LTM,FF) ;Find the next D/T given a schedule, start time.
"RTN","XLFDT",83,0)
 Q $$DECODE^XLFDT2
"RTN","XLFDT",84,0)
 ;
"RTN","XLFDT",85,0)
WITHIN(XLSCH,XLD) ;See if D/T is within schedule
"RTN","XLFDT",86,0)
 G WITHIN^XLFDT4
"RTN","XLFDT",87,0)
 ;
"RTN","XLFDT",88,0)
SEC(%) ;Convert $H to seconds.
"RTN","XLFDT",89,0)
 I %?7.N.".".N S %=$$FMTH(%) ;Check for FM date
"RTN","XLFDT",90,0)
 Q 86400*%+$P(%,",",2)
"RTN","XLFDT",91,0)
%H(%) ;Covert from seconds to $H
"RTN","XLFDT",92,0)
 Q (%\86400)_","_(%#86400)
"RTN","XLFDT",93,0)
 ;
"RTN","XLFDT",94,0)
TZ() ;Return Time Zone from Mailman parameter file
"RTN","XLFDT",95,0)
 N %T,%S
"RTN","XLFDT",96,0)
 S %T=$P($G(^XMB(4.4,+$P($G(^XMB(1,1,0)),"^",2),0)),"^",3),%S=$S(%T["-":"-",1:"+"),%T=$TR(%T,"-+")
"RTN","XLFDT",97,0)
 Q %S_$E(100+%T,2,3)_$S(%T[".5":"30",1:"00")
"RTN","XLFDT1")
0^2^B3498449
"RTN","XLFDT1",1,0)
XLFDT1 ;ISC-SF/RWF - Date/Time Functions cont. from VA FileMan %DTC ;12/17/97  11:12
"RTN","XLFDT1",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XLFDT1",3,0)
A ;
"RTN","XLFDT1",4,0)
F1 S %R=$P($T(M)," ",$S($E(Y,4,5):$E(Y,4,5)+2,1:0))_$S($E(Y,4,5):" ",1:"")_$S($E(Y,6,7):$E(Y,6,7)_", ",1:"")_($E(Y,1,3)+1700)
"RTN","XLFDT1",5,0)
 ;
"RTN","XLFDT1",6,0)
TM N %,%S Q:%T'>0!(%F["D")
"RTN","XLFDT1",7,0)
 I %F'["P" S %R=%R_"@"_$E(%T,2,3)_":"_$E(%T,4,5)_$S(%F["M":"",$E(%T,6,7)!(%F["S"):":"_$E(%T,6,7),1:"")
"RTN","XLFDT1",8,0)
 I %F["P" D
"RTN","XLFDT1",9,0)
 . S %R=%R_" "_$S($E(%T,2,3)>12:$E(%T,2,3)-12,1:+$E(%T,2,3))_":"_$E(%T,4,5)_$S(%F["M":"",$E(%T,6,7)!(%F["S"):":"_$E(%T,6,7),1:"")
"RTN","XLFDT1",10,0)
 . S %R=%R_$S($E(%T,2,7)<120000:" am",$E(%T,2,3)=24:" am",1:" pm")
"RTN","XLFDT1",11,0)
 . Q
"RTN","XLFDT1",12,0)
 Q
"RTN","XLFDT1",13,0)
M ;; Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
"RTN","XLFDT1",14,0)
F2 S %R=$J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)_"/"_$E(Y,2,3)
"RTN","XLFDT1",15,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",16,0)
 G TM
"RTN","XLFDT1",17,0)
F3 S %R=$J(+$E(Y,6,7),2)_"/"_$J(+$E(Y,4,5),2)_"/"_$E(Y,2,3)
"RTN","XLFDT1",18,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",19,0)
 G TM
"RTN","XLFDT1",20,0)
F4 S %R=$E(Y,2,3)_"/"_$J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)
"RTN","XLFDT1",21,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",22,0)
 G TM
"RTN","XLFDT1",23,0)
F5 S %R=$J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)_"/"_($E(Y,1,3)+1700)
"RTN","XLFDT1",24,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",25,0)
 G TM
"RTN","XLFDT1",26,0)
F6 S %R=$J(+$E(Y,6,7),2)_"/"_$J(+$E(Y,4,5),2)_"/"_($E(Y,1,3)+1700)
"RTN","XLFDT1",27,0)
 ;S %R=$S($E(Y,4,5):$E(Y,4,5)_"/",1:"")_$S($E(Y,6,7):$E(Y,6,7)_"/",1:"")_(1700+$E(Y,1,3))
"RTN","XLFDT1",28,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",29,0)
 G TM
"RTN","XLFDT1",30,0)
F7 S %R=($E(Y,1,3)+1700)_"/"_$J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)
"RTN","XLFDT1",31,0)
 ;S %R=$S($E(Y,4,5):+$E(Y,4,5)_"/",1:"")_$S($E(Y,6,7):+$E(Y,6,7)_"/",1:"")_(1700+$E(Y,1,3))
"RTN","XLFDT1",32,0)
 S:%F["Z" %R=$TR(%R," ","0") S:%F'["F" %R=$TR(%R," ")
"RTN","XLFDT1",33,0)
 G TM
"RTN","XLFDT2")
0^3^B6370915
"RTN","XLFDT2",1,0)
XLFDT2 ;SEA/RDS - Library function Schedule  ;01/06/98  08:24
"RTN","XLFDT2",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XLFDT2",3,0)
 ;
"RTN","XLFDT2",4,0)
DECODE() ;SCH^XLFDT--Decode A Cycle Schedule String (Return Next Time)
"RTN","XLFDT2",5,0)
 N %1,%D,%M,%T,%Y,Y,SCHL,LTMA,LTFM
"RTN","XLFDT2",6,0)
 I $L(+LTM)>6 S LTFM=LTM,LTM=$$FMTH^XLFDT(LTM)
"RTN","XLFDT2",7,0)
A D NEXT Q:Y="" Y
"RTN","XLFDT2",8,0)
 I $G(FF),Y<$H S LTM=Y G A
"RTN","XLFDT2",9,0)
 I $G(FF),(+Y=+$H),$P(Y,",",2)'>$P($H,",",2) S LTM=Y G A
"RTN","XLFDT2",10,0)
 Q $$HTFM^XLFDT(Y)
"RTN","XLFDT2",11,0)
 ;
"RTN","XLFDT2",12,0)
NEXT ;
"RTN","XLFDT2",13,0)
 I SCH?1.4N1"S" S Y=$P(SCH,"S")+$P(LTM,",",2),Y=(Y\86400+LTM)_","_(Y#86400) Q
"RTN","XLFDT2",14,0)
 I SCH?1.4N1"H" S Y=$P(SCH,"H")*3600+$P(LTM,",",2),Y=(Y\86400+LTM)_","_(Y#86400) Q
"RTN","XLFDT2",15,0)
 I SCH?1.3N1"D" S Y=($P(SCH,"D")+LTM)_","_$P(LTM,",",2) Q
"RTN","XLFDT2",16,0)
 ;I SCH?1.3N1"D@".E S X=$P(SCH,"@",2),%DT="RS" D ^%DT Q:Y=-1  S X=Y D H^%DTC S Y=($P(SCH,"D")+LTM)_","_%T Q
"RTN","XLFDT2",17,0)
 I SCH?1.2N1"M" D MONTH Q
"RTN","XLFDT2",18,0)
 I SCH?1.2N1"M(".E1")" S SCHL=$P($P(SCH,")"),"(",2) D MONTH2^XLFDT3 Q
"RTN","XLFDT2",19,0)
 I SCH?5.7N1P.5N.1";".E D LIST Q
"RTN","XLFDT2",20,0)
 I "MTWRFSUDE"[$E(SCH),"@,"[$E(SCH,2),SCH]"" D WEEK Q
"RTN","XLFDT2",21,0)
 S Y="" Q
"RTN","XLFDT2",22,0)
 ;
"RTN","XLFDT2",23,0)
MONTH ;DECODE--Simple Month Increment (Add x Months)
"RTN","XLFDT2",24,0)
 N X,XL,XLA,%,%H,%Y,%M,%D,%T
"RTN","XLFDT2",25,0)
 S %H=LTM D YMD^XLFDT ;Break into %Y %M %D
"RTN","XLFDT2",26,0)
 ;S XLA="31^"_(%Y#4=0+28)_"^31^30^31^30^31^31^30^31^30^31"
"RTN","XLFDT2",27,0)
 ;S XL=$P(SCH,"M") F %1=0:0 Q:'XL  S %1=%1+$P(XLA,"^",%M),%M=%M+1,XL=XL-1 I %M=13 S %Y=%Y+1,%M=1,$P(XLA,"^",2)=%Y#4=0+28
"RTN","XLFDT2",28,0)
 S XL=$P(SCH,"M") F  Q:'XL  S %M=%M+1,XL=XL-1 I %M=13 S %Y=%Y+1,%M=1
"RTN","XLFDT2",29,0)
 S XLA="31^"_(%Y#4=0+28)_"^31^30^31^30^31^31^30^31^30^31"
"RTN","XLFDT2",30,0)
 I %D>$P(XLA,"^",%M) S %D=$P(XLA,"^",%M)
"RTN","XLFDT2",31,0)
 S Y=$$FMTH^XLFDT(%Y_"00"+%M_"00"+%D_"."_%T)
"RTN","XLFDT2",32,0)
 Q
"RTN","XLFDT2",33,0)
 ;
"RTN","XLFDT2",34,0)
LIST ;DECODE--Find Next Run Time In List
"RTN","XLFDT2",35,0)
 N %A,XL
"RTN","XLFDT2",36,0)
 F %1=1:1 S XL=$P(SCH,";",%1) Q:XL=""  S:$L(+XL)<7 XL=$$HTFM^XLFDT(XL) S %A(XL)=""
"RTN","XLFDT2",37,0)
 S Y=$O(%A($$NOW^XLFDT)) S:Y>0 Y=$$FMTH^XLFDT(Y)
"RTN","XLFDT2",38,0)
 Q
"RTN","XLFDT2",39,0)
 ;
"RTN","XLFDT2",40,0)
WEEK ;DECODE--List Of Day Of Week Specifications
"RTN","XLFDT2",41,0)
 N %A,%W,%Z,XL,XLT
"RTN","XLFDT2",42,0)
 S XL=$P(LTM,",",2),%T=XL#60/100+(XL#3600\60)/100+(XL\3600)/100,%W=LTM+4#7+1,%Z="0"_%T,%Y=""
"RTN","XLFDT2",43,0)
 F %1=1:1 S %Y=$P(SCH,",",%1) Q:%Y=""  D ARRAY S:%A]"" %A(%A+XLT)=""
"RTN","XLFDT2",44,0)
 S %A=$O(%A(%T)),Y="" S:%A]"" XLT=%A#1,XLT=$E(XLT_0,2,3)*60+$E(XLT_"000",4,5)*60+$E(XLT_"00000",6,7),Y=%A\1+LTM_","_XLT Q
"RTN","XLFDT2",45,0)
 ;
"RTN","XLFDT2",46,0)
ARRAY ;WEEK Subroutine--Build Incident Array
"RTN","XLFDT2",47,0)
 S XL=$E(%Y),XLT="" D TIME:$P(%Y,"@",2)]"" S:XLT="" XLT=%T
"RTN","XLFDT2",48,0)
 S %A="" S:"UMTWRFS"[XL %A=$F("UMTWRFS",XL)-1,%A=$S(%A'=%W:6-%W+%A#7+1,XLT'>%T:6-%W+%A#7+1,1:0) S:XL="D" %A=$S(%W=1:1,%W=7:2,XLT'>%T:1+(%W=6*2),1:0)
"RTN","XLFDT2",49,0)
 S:XL="E" %A=$S(%W>1&(%W<7):7-%W,XLT'>%T:7-(%W=7*6),1:0) Q
"RTN","XLFDT2",50,0)
 ;
"RTN","XLFDT2",51,0)
TIME ;ARRAY--Build Time Node For Incidents That Include Times
"RTN","XLFDT2",52,0)
 N %DT,X S %DT="RS",X="T@"_$P(%Y,"@",2) D ^%DT S XLT=$S(Y=-1:"",1:Y#1) Q
"RTN","XLFDT2",53,0)
 ;
"RTN","XLFDT3")
0^4^B7537251
"RTN","XLFDT3",1,0)
XLFDT3 ;SEA/RDS - Library Function Schedule ;12/16/97  14:09
"RTN","XLFDT3",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XLFDT3",3,0)
 ;
"RTN","XLFDT3",4,0)
MONTH2 ;DECODE--Complex Month Increment Specification
"RTN","XLFDT3",5,0)
 N %,%A,%B,%C,%D,%H,%M,%O,%Y,XL,XLW,XLX,XLF,XLFS,XLL,XLLW,XLO,XLT
"RTN","XLFDT3",6,0)
 ;S %=LTM>21608+LTM-.1,%Y=%\365.25+141,%=%#365.25\1,%D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1,
"RTN","XLFDT3",7,0)
 S %H=LTM D YMD^XLFDT
"RTN","XLFDT3",8,0)
 S LTMA="31^"_(%Y#4=0+28)_"^31^30^31^30^31^31^30^31^30^31",%=$P(LTM,",",2),%T=%#60/100+(%#3600\60)/100+(%\3600)/100
"RTN","XLFDT3",9,0)
 S XLF=LTM-%D+5#7+1,XLFS=2-XLF,XLL=$P(LTMA,"^",%M),XLLW=XLF-29+XLL S:XLLW=0 XLLW=7 S:XLLW>7 XLLW=XLLW#8+1 K %A F XLX=1:1:$L(SCHL,",") D BUILD
"RTN","XLFDT3",10,0)
 I $O(%A(%D+%T))]"" S XLO=$O(%A(%D+%T)),%1=XLO\1-%D,XLT=XLO#1,XLT=$E(XLT_0,2,3)*60+$E(XLT_"000",4,5)*60+$E(XLT_"00000",6,7),Y=LTM+%1_","_XLT Q
"RTN","XLFDT3",11,0)
 S %C=XLL-%D,XL=$P(SCH,"M")-1,%M=%M+1 S:%M=13 %Y=%Y+1,%M=1,$P(LTMA,"^",2)=%Y#4=0+28 F %C=%C:0 Q:'XL  S %C=%C+$P(LTMA,"^",%M),%M=%M+1,XL=XL-1 I %M=13 S %Y=%Y+1,%M=1,$P(LTMA,"^",2)=%Y#4=0+28
"RTN","XLFDT3",12,0)
 S LTM=LTM+%C_","_$P(LTM,",",2),XLF=LTM+5#7+1,XLFS=2-XLF,XLL=$P(LTMA,"^",%M),XLLW=XLF-29+XLL S:XLLW=0 XLLW=7 S:XLLW>7 XLLW=XLLW#8+1 K %A F XLX=1:1:$L(SCHL,",") D BUILD
"RTN","XLFDT3",13,0)
 S %O=$O(%A("")),%=%O#1,%=$E(%_0,2,3)*60+$E(%_"000",4,5)*60+$E(%_"00000",6,7),Y=%O\1+LTM_","_% Q
"RTN","XLFDT3",14,0)
 ;
"RTN","XLFDT3",15,0)
BUILD ;MONTH2--Building Array Of Run Incidents For Month
"RTN","XLFDT3",16,0)
 S %B=$P(SCHL,",",XLX),XLT="" I $P(%B,"@")?1.2N S %A=%B\1 Q:%A>XLL!'%A  D TIME:$P(%B,"@",2)]"" S:XLT="" XLT=%T S %A(%A+XLT)="" Q
"RTN","XLFDT3",17,0)
 I $P(%B,"@")?1N1U,"UMTWRFS"[$E(%B,2) S %A=XLFS+$F("UMTWRFS",$E(%B,2))-2,%A=%B-(%A>0)*7+%A\1 Q:%A>XLL!'%A  D TIME:$P(%B,"@",2)]"" S:XLT="" XLT=%T S %A(%A+XLT)="" Q
"RTN","XLFDT3",18,0)
 I $P(%B,"@")="L" S %A=XLL D TIME:$P(%B,"@",2)]"" S:XLT="" XLT=%T S %A(%A+XLT)="" Q
"RTN","XLFDT3",19,0)
 I $P(%B,"@")?1"L"1U,"UMTWRFS"[$E(%B,2) S XLW=$F("UMTWRFS",$E(%B,2))-1,%A=XLL-$S(XLLW-XLW<0:XLLW+7-XLW,1:XLLW-XLW) D TIME:$P(%B,"@",2)]"" S:XLT="" XLT=%T S %A(%A+XLT)="" Q
"RTN","XLFDT3",20,0)
 Q
"RTN","XLFDT3",21,0)
 ;
"RTN","XLFDT3",22,0)
TIME ;BUILD--Build Time Node For Incidents That Include Times
"RTN","XLFDT3",23,0)
 N %Y,%M,%D,%T,%DT,X,Y S %DT="RS",X="T@"_$P(%B,"@",2) D ^%DT S XLT=$S(Y=-1:"",1:Y#1) Q
"RTN","XLFDT3",24,0)
 ;
"RTN","XLFDT4")
0^5^B2171533
"RTN","XLFDT4",1,0)
XLFDT4 ;ISCSF/RWF - Exclude time ;7/8/94  07:58
"RTN","XLFDT4",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XLFDT4",3,0)
 Q
"RTN","XLFDT4",4,0)
WI(XLSCH,XLRD) ;Test Entry Point
"RTN","XLFDT4",5,0)
WITHIN ;EF. Called from XLFDT, Return 1 XLRD is in XLSCH, else 0.
"RTN","XLFDT4",6,0)
 ;XLSCH contact schedule, XLRD Reference date
"RTN","XLFDT4",7,0)
 N XL1,XLCT,XLDOW,XLFOK
"RTN","XLFDT4",8,0)
 S:'$D(XLRD) XLRD=$$NOW^XLFDT()
"RTN","XLFDT4",9,0)
 Q:XLSCH="ANY" 1
"RTN","XLFDT4",10,0)
 S XLCT=$E($P(XLRD,".",2)_"0000",1,4),XLDOW=$E("UMTWRFS",$$FMTH^XLFDT(XLRD)+4#7+1)
"RTN","XLFDT4",11,0)
 F XL1=1:1:$L(XLSCH,",") S XLFOK=$$CHECK(XLCT,XLDOW,$P(XLSCH,",",XL1)) Q:XLFOK
"RTN","XLFDT4",12,0)
 Q XLFOK
"RTN","XLFDT4",13,0)
CHECK(XLT,XLD,XLS) ;EF. Check one time.
"RTN","XLFDT4",14,0)
 ;XLT is reference time, XLD is reference DOW, XLS is schedule
"RTN","XLFDT4",15,0)
 N %,XLT1,XLT2,XLDP,XLTP,XLNEG,XLOK
"RTN","XLFDT4",16,0)
 I XLS?1U.E D
"RTN","XLFDT4",17,0)
 . I XLS?1U S XLDP=XLS,XLTP=""
"RTN","XLFDT4",18,0)
 . E  F I=1:1:$L(XLS) I $E(XLS,I)?1N S XLDP=$E(XLS,1,I-1),XLTP=$E(XLS,I,$L(XLS)) Q
"RTN","XLFDT4",19,0)
 . Q
"RTN","XLFDT4",20,0)
 E  S XLDP="",XLTP=XLS
"RTN","XLFDT4",21,0)
 S XLT1=$P(XLTP,"-"),XLT2=$P(XLTP,"-",2) S:XLT2="" XLT2=XLT1
"RTN","XLFDT4",22,0)
 I XLT1<XLT2 S XLNEG=0
"RTN","XLFDT4",23,0)
 E  S XLNEG=1,%=XLT1,XLT1=XLT2,XLT2=%
"RTN","XLFDT4",24,0)
 S XLOK=(XLDP="")!(XLDP="ANY")!((XLDP="D")&("SU"'[XLD))!((XLDP="E")&("SU"[XLD))!(XLDP[XLD) Q:'XLOK 0
"RTN","XLFDT4",25,0)
 S XLOK=(XLTP="")!(((XLT1'>XLT)&(XLT'>XLT2))'=XLNEG) Q:'XLOK 0
"RTN","XLFDT4",26,0)
 Q 1
"RTN","XQDATE")
0^8^B2326425
"RTN","XQDATE",1,0)
XQDATE ;SEA/MJM - Return Human Readible Date ;02/18/98  09:55
"RTN","XQDATE",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XQDATE",3,0)
 ;Input: XQD1 contains $H to be converted, defaults to now if not
"RTN","XQDATE",4,0)
 ;present.  Output: % contains date in FileMan format, %Y contains
"RTN","XQDATE",5,0)
 ;date and time in Human format (Feb. 20, 1991  5:35 PM)
"RTN","XQDATE",6,0)
 ;
"RTN","XQDATE",7,0)
 ;Modified 1/27/98 to reflect Y2K corrections.
"RTN","XQDATE",8,0)
 ;
"RTN","XQDATE",9,0)
 S U="^" I '$D(XQD1) S XQD1=$H
"RTN","XQDATE",10,0)
 S %=$$HTFM^XLFDT(XQD1)
"RTN","XQDATE",11,0)
 S %Y=$$FMTE^XLFDT(%,"1P")
"RTN","XQDATE",12,0)
 Q
"RTN","XQDATE",13,0)
 ;
"RTN","XQDATE",14,0)
 S %=XQD1>21608+XQD1-.1,XQD2=%\365.25+141,%=%#365.25\1,XQD3=%+306#(XQD2#4=0+365)#153#61#31+1,XQD4=%-XQD3\29+1,XQD5=XQD2_"00"+XQD4_"00"+XQD3
"RTN","XQDATE",15,0)
 S %=$P(XQD1,",",2),%=%#60/100+(%#3600\60)/100+(%\3600)/100,%=XQD5_$S(%:%,1:"")
"RTN","XQDATE",16,0)
 S XQD1="Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec"
"RTN","XQDATE",17,0)
 S %Y=$P(XQD1,U,XQD4),%Y=%Y_$S(%Y["May":"",1:".")_" "_XQD3_", "_(XQD2+1700)
"RTN","XQDATE",18,0)
 S XQD2=$E($P(%,".",2),1,4) I $L(XQD2)<4 F XQD5=0:0 S XQD2=XQD2_"0" Q:$L(XQD2)=4
"RTN","XQDATE",19,0)
 S XQD4=$S(XQD2>1159:"PM",1:"AM"),XQD3=$E(XQD2,1,2),XQD3=$S(XQD3>12:XQD3-12,1:XQD3),XQD2=$E(XQD2,3,4)
"RTN","XQDATE",20,0)
 S %Y=%Y_"  "_+XQD3_":"_XQD2_" "_XQD4
"RTN","XQDATE",21,0)
 K XQD1,XQD2,XQD3,XQD4,XQD5
"RTN","XQDATE",22,0)
 Q
"RTN","XTER2")
0^7^B14229519
"RTN","XTER2",1,0)
XTER2 ;ISC-SF.SEA/JLI - MODIFICATION OF %XTER FOR USE WITH VAX DSM ;03/10/98  11:18
"RTN","XTER2",2,0)
 ;;8.0;KERNEL;**71**;Jul 10, 1995
"RTN","XTER2",3,0)
RESTOR ;
"RTN","XTER2",4,0)
 X ^%ZOSF("PROGMODE") I 'Y W !,$C(7),"^R to restore environment is restricted to users in programmer mode",$C(7),! G ^XTER1
"RTN","XTER2",5,0)
 S %XTZUCI=$P(%XTJOB,U,4) X ^%ZOSF("UCI") I Y'=%XTZUCI K %XTZUCI
"RTN","XTER2",6,0)
 K (%XTZDAT,%XTZNUM,%XTZUCI)
"RTN","XTER2",7,0)
 F %XTZZZ=0:0 S %XTZZZ=$O(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV",%XTZZZ)) Q:%XTZZZ'>0  I $D(^(%XTZZZ,"D"))#2,$D(^(0))#2,$E(^(0))'="$" I $E(^(0),1,6)'="%ZT(""^",$E(^(0),1)'="^" S @(^(0))=^("D")
"RTN","XTER2",8,0)
 I '$D(%XTZUCI) W !,$C(7),"MUST BE IN SAME UCI TO RESTORE PROGRAM --- VARIABLES RESTORED",! K %XTZDAT,%XTZNUM,%XTZZZ Q
"RTN","XTER2",9,0)
 S X=$P($P($P(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZE"),",",1),"^",2),":",1) I X'="" X ^%ZOSF("TEST") I $T S XCNP=0,DIF="^TMP($J," X ^%ZOSF("LOAD") K XCNP,DIF,^TMP($J)
"RTN","XTER2",10,0)
 W !,"VARIABLES RESTORED"
"RTN","XTER2",11,0)
 K %XTZZZ,%XTZDAT,%XTZNUM,%XTZUCI
"RTN","XTER2",12,0)
 Q
"RTN","XTER2",13,0)
 ;
"RTN","XTER2",14,0)
SLIST ;
"RTN","XTER2",15,0)
 S XTSTR1=0 R !!,"Enter part of error or routine to be matched: ",XTSTR:DTIME Q:'$T!(XTSTR="")!(XTSTR="^")  D T11
"RTN","XTER2",16,0)
 D T13 F XTI=0:0 Q:XTOUT  S XTI=$O(^TMP("XTER",$J,XTI)) Q:XTI'>0  F X=0:0 S X=$O(^TMP("XTER",$J,XTI,X)) Q:X'>0  S %XTZDAT=^(X),XTSTR1=XTSTR1+1,XTD=0 S %XTYL=%XTYL-1 D:'%XTYL MORE^XTER1A Q:XTOUT  D:'%XTYL T11 W:'%XTYL ! D T10
"RTN","XTER2",17,0)
 I XTSTR1=0 W !!?10,XTSTR," not found in error log",!
"RTN","XTER2",18,0)
 K XTSTR,XTSTR1
"RTN","XTER2",19,0)
Z Q
"RTN","XTER2",20,0)
T10 I ^%ZTER(1,%XTZDAT,1,X,"ZE")["," S %XTERR=$P($P(^("ZE"),",",4),"-",4),%XTERR=$P($P(^("ZE"),",",2),"-",3)_$S(%XTERR="":"",1:"(")_%XTERR_$S(%XTERR="":"",1:")")
"RTN","XTER2",21,0)
 S %XTERR(1)=$H-%XTZDAT,%XTERR(1)="T"_$S(%XTERR(1)=0:"",1:"-"_%XTERR(1)),%XTERR(1)=$E(%XTERR(1)_"     ",1,5)_" #"
"RTN","XTER2",22,0)
 I ^%ZTER(1,%XTZDAT,1,X,"ZE")["," W !,%XTERR(1),$J(X,3),")  ","<",%XTERR,">",$P(^%ZTER(1,%XTZDAT,1,X,"ZE"),",",1)_" "
"RTN","XTER2",23,0)
 I ^%ZTER(1,%XTZDAT,1,X,"ZE")'["," W !,%XTERR(1),$J(X,3),")  ",^("ZE")
"RTN","XTER2",24,0)
 S %XTZNUM=X,%="" I $D(^%ZTER(1,%XTZDAT,1,%XTZNUM,"H")) S %H=^("H") D YMD^%DTC S %=$P(%,".",2)_"000000",%=$E(%,1,2)_":"_$E(%,3,4)_":"_$E(%,5,6)
"RTN","XTER2",25,0)
 S X=%XTZNUM W ?39,%
"RTN","XTER2",26,0)
 W "  ",$P($S('$D(^%ZTER(1,%XTZDAT,1,X,"J")):"",1:^("J")),U,4),"  ",$J($P($S('$D(^("J")):"",1:^("J")),U,5),7),"  ",$P($S('$D(^("I")):"",1:^("I")),U)
"RTN","XTER2",27,0)
 Q
"RTN","XTER2",28,0)
T11 W !!,"Date",?6,"ErrNum",?17,"$ZE",?41,"Time",?49,"UCI/VOL",?61,"$J",?69,"$I" S %XTYL=IOSL-6
"RTN","XTER2",29,0)
 Q
"RTN","XTER2",30,0)
 ;
"RTN","XTER2",31,0)
T13 K ^TMP("XTER",$J) S %XTZDAT=0 F XTI=0:0 S %XTZDAT=$O(^%ZTER(1,%XTZDAT)) Q:%XTZDAT'>0  F X=0:0 S X=$O(^%ZTER(1,%XTZDAT,1,X)) Q:X'>0  I $D(^(X,"ZE")),^("ZE")[XTSTR S ^TMP("XTER",$J,(99999-%XTZDAT),X)=%XTZDAT
"RTN","XTER2",32,0)
 Q
"RTN","XTER2",33,0)
UDD ;Convert user date
"RTN","XTER2",34,0)
 K XTDTE,XTDTH,XTERR N %XTF,%XTY,X,Y
"RTN","XTER2",35,0)
 G T:%XTZDAT?1"T".E,T:%XTZDAT?1"t".E
"RTN","XTER2",36,0)
 S %XTF=$TR(%XTZDAT,$C(32,44,45,46),"////")
"RTN","XTER2",37,0)
B S %XTY="//" D R
"RTN","XTER2",38,0)
 S X=%XTF,%DT="XP",%DT(0)="-NOW" D ^%DT K %DT I Y'>0 S XTERR=1 K XTDTE,XTDTH G K
"RTN","XTER2",39,0)
 S XTDTH=$$FMTH^XLFDT(Y),XTDTE=$$FMTE^XLFDT(Y,5)
"RTN","XTER2",40,0)
K Q
"RTN","XTER2",41,0)
E S XTERR=1 K XTDTH,XTDTE G K
"RTN","XTER2",42,0)
R Q:%XTF'[%XTY  S %XTF=$P(%XTF,%XTY,1)_"/"_$P(%XTF,%XTY,2,256) G R
"RTN","XTER2",43,0)
 ;
"RTN","XTER2",44,0)
T S %XTT=$E(%XTZDAT,2,99) I %XTT'="" G E:%XTT?7E.E,E:%XTT'?1"-"1N.N&(%XTT'?1"+"1N.N)
"RTN","XTER2",45,0)
 S XTDTH=$P($H,",",1)+%XTT G E:XTDTH<0 D UDA S XTDTH=-XTDTH G K
"RTN","XTER2",46,0)
 ;
"RTN","XTER2",47,0)
UDA ;
"RTN","XTER2",48,0)
 I '$D(XTDTH) S XTDTH=$P($H,",",1)
"RTN","XTER2",49,0)
 S XTDTE=$$HTE^XLFDT(XTDTH,5)
"RTN","XTER2",50,0)
 Q
"RTN","XUWORKDY")
0^9^B1270134
"RTN","XUWORKDY",1,0)
XUWORKDY ;SF/GJL - WORKDAYS ;02/25/98  11:34
"RTN","XUWORKDY",2,0)
 ;;8.0;KERNEL;**65,71**;Jul 10, 1995
"RTN","XUWORKDY",3,0)
 ;X,X1 are any two dates (YYYMMDD). X=Working Days Between
"RTN","XUWORKDY",4,0)
A N %A,%B,%D,%H,%I,%J,%K,%M,%Y,%Z
"RTN","XUWORKDY",5,0)
 S %A=X,%B=X1,%Z=1 I %A>%B S X=%B,%B=%A,%A=X,%Z=-1
"RTN","XUWORKDY",6,0)
 S %J=$$HDTC(%A) I %Y<0 S X="" G EXIT ;Imprecise date
"RTN","XUWORKDY",7,0)
 S %K=$$HDTC(%B) I %Y<0 S X="" G EXIT
"RTN","XUWORKDY",8,0)
 S %H=0,X=(%J+3#7>4)&(%K+3#7>4) ;I $O(^HOLIDAY(2000000))'>0 S X="" G EXIT
"RTN","XUWORKDY",9,0)
 S %Y=%A-1 F %I=1:1 S %Y=$O(^HOLIDAY(%Y)) Q:(%Y'>0)!(%Y>%B)  S %H=%H+1
"RTN","XUWORKDY",10,0)
 F %J=%J:1 S %Y=%J#7 Q:((%Y=3)!(%J=%K))  S:%Y-2 X=X+1
"RTN","XUWORKDY",11,0)
 F %K=%K:-1 S %Y=%K#7 Q:((%Y=3)!(%K=%J))  S:%Y-2 X=X+1
"RTN","XUWORKDY",12,0)
 S %I=%K-%J I '%I S %Y=%J#7 S:(%Y'=2)&(%Y'=3) X=X+1
"RTN","XUWORKDY",13,0)
 S X=(X+%I-%H-(%I\7*2))*%Z S:X X=X-%Z
"RTN","XUWORKDY",14,0)
EXIT K X1
"RTN","XUWORKDY",15,0)
 Q
"RTN","XUWORKDY",16,0)
HDTC(X) ;Taken from H^%DTC
"RTN","XUWORKDY",17,0)
 S %M=$E(X,4,5),%D=$E(X,6,7) I '%M!'%D S %Y=-1 Q
"RTN","XUWORKDY",18,0)
 N %H S %H=$$FMTH^XLFDT(X)
"RTN","XUWORKDY",19,0)
 S %Y=%H+4#7
"RTN","XUWORKDY",20,0)
 Q %H
"RTN","XUWORKDY",21,0)
EN(X,X1) ;Function entry point
"RTN","XUWORKDY",22,0)
 D A Q X
"RTN","ZOSVVXD")
0^6^B16831153
"RTN","ZOSVVXD",1,0)
%ZOSV ;SFISC/AC - View commands & special functions. ;12/16/97  14:09
"RTN","ZOSVVXD",2,0)
 ;;8.0;KERNEL;**13,65,71**;Jul 05, 1995
"RTN","ZOSVVXD",3,0)
ACTJ() ; # active jobs
"RTN","ZOSVVXD",4,0)
 Q $P($$JOBS^%SY,",",2)
"RTN","ZOSVVXD",5,0)
 ;
"RTN","ZOSVVXD",6,0)
AVJ() ; # available jobs
"RTN","ZOSVVXD",7,0)
 N Y S Y=$$JOBS^%SY Q +Y-$P(Y,",",2)
"RTN","ZOSVVXD",8,0)
 ;
"RTN","ZOSVVXD",9,0)
T0 ; start RT clock
"RTN","ZOSVVXD",10,0)
 S %ZH0=$ZH,%=$P(%ZH0,",",3) S:$E($ZV,10,12)>5.1 %=$E(%,13,23) S XRT0=+$H_","_($P(%,":")*3600+($P(%,":",2)*60)+$P(%,":",3)) Q
"RTN","ZOSVVXD",11,0)
 ;
"RTN","ZOSVVXD",12,0)
T1 ; store RT datum w/ZHDIF
"RTN","ZOSVVXD",13,0)
 S %ZH1=$ZH,%=$P(%ZH1,",",3) S:$E($ZV,10,12)>5.1 %=$E(%,13,23) S XRT1=+$H_","_($P(%,":")*3600+($P(%,":",2)*60)+$P(%,":",3))
"RTN","ZOSVVXD",14,0)
 S ^%ZRTL(3,XRTL,+XRT1,XRTN,$P(XRT1,",",2))=XRT0_"^^"_($P(%ZH1,",")-$P(%ZH0,","))_"^"_($P(%ZH1,",",7)-$P(%ZH0,",",7))_"^"_($P(%ZH1,",",8)-$P(%ZH0,",",8)) K XRT0,%ZH0,%ZH1 Q
"RTN","ZOSVVXD",15,0)
 ;
"RTN","ZOSVVXD",16,0)
PASSALL ;
"RTN","ZOSVVXD",17,0)
 S Y=$ZC(%SPAWN,"SET TERM/PASTHRU "_$I) U $I:NOTERM Q
"RTN","ZOSVVXD",18,0)
NOPASS ;
"RTN","ZOSVVXD",19,0)
 S Y=$ZC(%SPAWN,"SET TERM/NOPASTHRU "_$I) U $I:TERM="" Q
"RTN","ZOSVVXD",20,0)
 ;
"RTN","ZOSVVXD",21,0)
PRGMODE ;
"RTN","ZOSVVXD",22,0)
 W ! S ZTPAC=$S($D(^VA(200,+DUZ,.1))#10:$P(^(.1),"^",5),1:""),XUVOL=^%ZOSF("VOL")
"RTN","ZOSVVXD",23,0)
 S X="" X ^%ZOSF("EOFF") R:ZTPAC]"" !,"PAC: ",X:60 D LC^XUS X ^%ZOSF("EON") I X'=ZTPAC W "??",*7 Q
"RTN","ZOSVVXD",24,0)
 K XMB,XMTEXT,XMY S XMB="XUPROGMODE",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB
"RTN","ZOSVVXD",25,0)
 I '$$PROGMODE() D UCI S XUCI=Y,XQZ="PRGM^ZUA[MGR]",XUSLNT=1 D DO^%XUCI ZESCAPE
"RTN","ZOSVVXD",26,0)
 E  S $ECODE=",<<PROG>>,"
"RTN","ZOSVVXD",27,0)
 ;
"RTN","ZOSVVXD",28,0)
PROGMODE() ;
"RTN","ZOSVVXD",29,0)
 Q ($V($V($V(0)))#2=0)
"RTN","ZOSVVXD",30,0)
 ;
"RTN","ZOSVVXD",31,0)
UCI ;
"RTN","ZOSVVXD",32,0)
 S Y=$ZC(%UCI),Y=$P(Y,",",1)_","_$P(Y,",",4) Q
"RTN","ZOSVVXD",33,0)
 ;
"RTN","ZOSVVXD",34,0)
UCICHECK(X) ;
"RTN","ZOSVVXD",35,0)
 N %,%1,U,V,Y
"RTN","ZOSVVXD",36,0)
 I '(X?3U!(X?3U1","3U)) Q ""
"RTN","ZOSVVXD",37,0)
 S U=$ZC(%UCI),V=$P(U,",",4),U=$P(U,","),%1=$P(X,",",2),%=$P(X,",")
"RTN","ZOSVVXD",38,0)
 S Y=$ZC(%SETUCI,%,%1),Y=$S(Y:%_","_$S(%1]"":%1,1:V),1:""),V=$ZC(%SETUCI,U,V)
"RTN","ZOSVVXD",39,0)
 Q Y
"RTN","ZOSVVXD",40,0)
 ;
"RTN","ZOSVVXD",41,0)
PRIORITY ;
"RTN","ZOSVVXD",42,0)
 Q  ;Q:X>10!(X<1)  S X=(X+1)\2-1,Y=$ZC(%SETPRI,X) Q  ;Let VSM do it's thing.
"RTN","ZOSVVXD",43,0)
 ;
"RTN","ZOSVVXD",44,0)
PRIINQ() ;
"RTN","ZOSVVXD",45,0)
 Q $ZC(%GETJPI,0,"PRIB")*2+2
"RTN","ZOSVVXD",46,0)
 ;
"RTN","ZOSVVXD",47,0)
BAUD S X="UNKNOWN" Q
"RTN","ZOSVVXD",48,0)
 ;
"RTN","ZOSVVXD",49,0)
LGR() Q $ZR ;Last global ref.
"RTN","ZOSVVXD",50,0)
 ;
"RTN","ZOSVVXD",51,0)
EC() Q $ZE ;Error code
"RTN","ZOSVVXD",52,0)
 ;
"RTN","ZOSVVXD",53,0)
DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVVXD",54,0)
 S Y="%" F  S Y=$ZSORT(@Y) Q:Y=""  D  ;code from DEC
"RTN","ZOSVVXD",55,0)
 . I $D(@Y)#2 S @(X_"Y)="_Y)
"RTN","ZOSVVXD",56,0)
 . I $D(@Y)>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",57,0)
 K %X,%Y,Y Q
"RTN","ZOSVVXD",58,0)
 ;
"RTN","ZOSVVXD",59,0)
ORDER ;SAVE PARTS OF SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVVXD",60,0)
 ;PARTS INDICATED BY X1("NAMESPACE*")="" ARRAY
"RTN","ZOSVVXD",61,0)
 I $D(X1("*"))#2 D DOLRO Q
"RTN","ZOSVVXD",62,0)
 S X1="" F  S X1=$O(X1(X1)) Q:X1=""  D
"RTN","ZOSVVXD",63,0)
 . S (Y,Y1)=$P(X1,"*") I $D(@Y)=0 F  S Y=$ZSORT(@Y) Q:Y=""!(Y[Y1)
"RTN","ZOSVVXD",64,0)
 . Q:Y=""  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",65,0)
 . F  S Y=$ZSORT(@Y) Q:Y=""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",66,0)
 . Q
"RTN","ZOSVVXD",67,0)
 K %,%X,%Y,Y,Y1 Q
"RTN","ZOSVVXD",68,0)
 ;
"RTN","ZOSVVXD",69,0)
PARSIZ ;
"RTN","ZOSVVXD",70,0)
 S X=3 Q
"RTN","ZOSVVXD",71,0)
 ;
"RTN","ZOSVVXD",72,0)
NOLOG ;
"RTN","ZOSVVXD",73,0)
 S Y=0 Q
"RTN","ZOSVVXD",74,0)
 ;
"RTN","ZOSVVXD",75,0)
DEVOPN G DEVOPN^%ZOSV1
"RTN","ZOSVVXD",76,0)
DEVOK G DEVOK^%ZOSV1
"RTN","ZOSVVXD",77,0)
RES G RES^%ZOSV1
"RTN","ZOSVVXD",78,0)
 ;
"RTN","ZOSVVXD",79,0)
GETENV ;Get environment Return Y='UCI^VOL/DIR^NODE^BOX LOOKUP'
"RTN","ZOSVVXD",80,0)
 S Y=$P($ZU(0),",",1)_"^"_$P($ZU(0),",",2)_"^"_$P($ZC(%GETSYI),",",4)
"RTN","ZOSVVXD",81,0)
 S $P(Y,"^",4)=$P(Y,"^",2)_":"_$P(Y,"^",3)
"RTN","ZOSVVXD",82,0)
 Q
"RTN","ZOSVVXD",83,0)
VERSION(X) ;return OS version, X=1 - return OS
"RTN","ZOSVVXD",84,0)
 Q $S($G(X):$P($ZV," V"),1:$P($ZV," V",2))
"RTN","ZOSVVXD",85,0)
 ;
"RTN","ZOSVVXD",86,0)
SETNM(X) ;Set name, Trap dup's, Fall into SETENV
"RTN","ZOSVVXD",87,0)
 N $ETRAP S $ETRAP="S $ECODE="""" Q"
"RTN","ZOSVVXD",88,0)
SETENV ;Set environment X='PROCESS NAME^ '
"RTN","ZOSVVXD",89,0)
 S %=$ZC(%SETPRN,$P(X,"^")) Q
"RTN","ZOSVVXD",90,0)
 ;
"RTN","ZOSVVXD",91,0)
ZHDIF ;Display dif of two $ZH's
"RTN","ZOSVVXD",92,0)
 W !," CPU=",$J($P(%ZH1,",")-$P(%ZH0,","),6,2),?14," ET=",$J($P(%ZH1,",",2)-$P(%ZH0,",",2),6,1),?27," DIO=",$J($P(%ZH1,",",7)-$P(%ZH0,",",7),5),?40," BIO=",$J($P(%ZH1,",",8)-$P(%ZH0,",",8),5),! Q
"RTN","ZOSVVXD",93,0)
 ;
"RTN","ZOSVVXD",94,0)
LOGRSRC(OPT) ;record resource usage in ^XTMP("XUCP"
"RTN","ZOSVVXD",95,0)
 N %,%D,%H,%M,%Y,C,H,U,X S C=",",U="^",%=$ZH,H=$P(%,C,3) S:$E($ZV,10,12)>5.1 H=$E(H,13,23) S H=$P($H,C)_C_($P(H,":")*3600+($P(H,":",2)*60)+$P(H,":",3))
"RTN","ZOSVVXD",96,0)
 S ^XTMP("XUCP",$P($ZC(%GETSYI),C,4),$P(H,C),$J,$P(H,C,2))=$P(%,C)_U_$P(%,C,7)_U_$P(%,C,8)_U_$P(%,C,4)_U_OPT_U_$P(%,C,3)
"RTN","ZOSVVXD",97,0)
 S %H=$H I $P(%H,C,2)#1000=0 S %=(%H>21608)+(%H>94657)+%H-.1,%Y=%\365.25+141,%=%#365.25\1,%D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1,X=%Y_"00"+%M_"00"+%D,^XTMP("XUCP",0)=X+10000_U_X
"RTN","ZOSVVXD",98,0)
 Q
"RTN","ZOSVVXD",99,0)
 ;
"RTN","ZOSVVXD",100,0)
SETTRM(X) ;Turn on specified terminators.
"RTN","ZOSVVXD",101,0)
 U $I:TERM=X
"RTN","ZOSVVXD",102,0)
 Q 1
"VER")
8.0^21.0
**END**
**END**
