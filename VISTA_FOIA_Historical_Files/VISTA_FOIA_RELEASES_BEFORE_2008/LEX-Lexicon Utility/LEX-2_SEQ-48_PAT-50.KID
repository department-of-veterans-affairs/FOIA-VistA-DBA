Released LEX*2*50 SEQ #48
Extracted from mail message
**KIDS**:LEX*2.0*50^

**INSTALL NAME**
LEX*2.0*50
"BLD",5874,0)
LEX*2.0*50^LEXICON UTILITY^0^3070611^y
"BLD",5874,1,0)
^^2^2^3070529^
"BLD",5874,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",5874,1,2,0)
included in this patch.
"BLD",5874,4,0)
^9.64PA^^
"BLD",5874,"INIT")
POST^LEX2050P
"BLD",5874,"KRN",0)
^9.67PA^8989.52^19
"BLD",5874,"KRN",.4,0)
.4
"BLD",5874,"KRN",.401,0)
.401
"BLD",5874,"KRN",.402,0)
.402
"BLD",5874,"KRN",.403,0)
.403
"BLD",5874,"KRN",.5,0)
.5
"BLD",5874,"KRN",.84,0)
.84
"BLD",5874,"KRN",3.6,0)
3.6
"BLD",5874,"KRN",3.8,0)
3.8
"BLD",5874,"KRN",9.2,0)
9.2
"BLD",5874,"KRN",9.8,0)
9.8
"BLD",5874,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",5874,"KRN",9.8,"NM",1,0)
LEX2050^^0^B81370775
"BLD",5874,"KRN",9.8,"NM",2,0)
LEX2050P^^0^B3259336
"BLD",5874,"KRN",9.8,"NM",3,0)
LEXXGI^^0^B64603303
"BLD",5874,"KRN",9.8,"NM",4,0)
LEXXGI2^^0^B63740225
"BLD",5874,"KRN",9.8,"NM",5,0)
LEXXII^^0^B35261547
"BLD",5874,"KRN",9.8,"NM","B","LEX2050",1)

"BLD",5874,"KRN",9.8,"NM","B","LEX2050P",2)

"BLD",5874,"KRN",9.8,"NM","B","LEXXGI",3)

"BLD",5874,"KRN",9.8,"NM","B","LEXXGI2",4)

"BLD",5874,"KRN",9.8,"NM","B","LEXXII",5)

"BLD",5874,"KRN",19,0)
19
"BLD",5874,"KRN",19.1,0)
19.1
"BLD",5874,"KRN",101,0)
101
"BLD",5874,"KRN",409.61,0)
409.61
"BLD",5874,"KRN",771,0)
771
"BLD",5874,"KRN",870,0)
870
"BLD",5874,"KRN",8989.51,0)
8989.51
"BLD",5874,"KRN",8989.52,0)
8989.52
"BLD",5874,"KRN",8994,0)
8994
"BLD",5874,"KRN","B",.4,.4)

"BLD",5874,"KRN","B",.401,.401)

"BLD",5874,"KRN","B",.402,.402)

"BLD",5874,"KRN","B",.403,.403)

"BLD",5874,"KRN","B",.5,.5)

"BLD",5874,"KRN","B",.84,.84)

"BLD",5874,"KRN","B",3.6,3.6)

"BLD",5874,"KRN","B",3.8,3.8)

"BLD",5874,"KRN","B",9.2,9.2)

"BLD",5874,"KRN","B",9.8,9.8)

"BLD",5874,"KRN","B",19,19)

"BLD",5874,"KRN","B",19.1,19.1)

"BLD",5874,"KRN","B",101,101)

"BLD",5874,"KRN","B",409.61,409.61)

"BLD",5874,"KRN","B",771,771)

"BLD",5874,"KRN","B",870,870)

"BLD",5874,"KRN","B",8989.51,8989.51)

"BLD",5874,"KRN","B",8989.52,8989.52)

"BLD",5874,"KRN","B",8994,8994)

"BLD",5874,"PRE")
LEX2050
"BLD",5874,"QUES",0)
^9.62^^
"BLD",5874,"REQB",0)
^9.611^5^5
"BLD",5874,"REQB",1,0)
LEX*2.0*48^2
"BLD",5874,"REQB",2,0)
LEX*2.0*49^2
"BLD",5874,"REQB",3,0)
PXRM*2.0*9^2
"BLD",5874,"REQB",4,0)
ICD*18.0*28^2
"BLD",5874,"REQB",5,0)
ICPT*6.0*34^2
"BLD",5874,"REQB","B","ICD*18.0*28",4)

"BLD",5874,"REQB","B","ICPT*6.0*34",5)

"BLD",5874,"REQB","B","LEX*2.0*48",1)

"BLD",5874,"REQB","B","LEX*2.0*49",2)

"BLD",5874,"REQB","B","PXRM*2.0*9",3)

"INIT")
POST^LEX2050P
"MBREQ")
0
"PKG",574,-1)
1^1
"PKG",574,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.
"PKG",574,20,0)
^9.402P^^
"PKG",574,22,0)
^9.49I^1^1
"PKG",574,22,1,0)
2.0^2950923^2950923^520642433
"PKG",574,22,1,"PAH",1,0)
50^3070611
"PKG",574,22,1,"PAH",1,1,0)
^^2^2^3070611
"PKG",574,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",574,22,1,"PAH",1,1,2,0)
included in this patch.
"PRE")
LEX2050
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","LEX2050")
0^1^B81370775^n/a
"RTN","LEX2050",1,0)
LEX2050 ;ISL/KER - LEX*2.0*50 Env Check ;06/06/2007
"RTN","LEX2050",2,0)
 ;;2.0;LEXICON UTILITY;**50**;Sep 23, 1996
"RTN","LEX2050",3,0)
 ;              
"RTN","LEX2050",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEX2050",5,0)
 ;    XPDABORT
"RTN","LEX2050",6,0)
 ;    XPDDIQ("XPI1")
"RTN","LEX2050",7,0)
 ;    XPDDIQ("XPZ1")
"RTN","LEX2050",8,0)
 ;    XPDENV
"RTN","LEX2050",9,0)
 ;    XPDQUIT
"RTN","LEX2050",10,0)
 ;              
"RTN","LEX2050",11,0)
 ; Global Variables
"RTN","LEX2050",12,0)
 ;    ^LEXM
"RTN","LEX2050",13,0)
 ;              
"RTN","LEX2050",14,0)
 ; External References
"RTN","LEX2050",15,0)
 ;    DBIA 10015  EN^DIQ1
"RTN","LEX2050",16,0)
 ;    DBIA 10141  $$PATCH^XPDUTL
"RTN","LEX2050",17,0)
 ;    DBIA 10141  $$VERSION^XPDUTL
"RTN","LEX2050",18,0)
 ;    DBIA 10141  BMES^XPDUTL
"RTN","LEX2050",19,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","LEX2050",20,0)
 ;              
"RTN","LEX2050",21,0)
ENV ; LEX*2.0*50 Environment Check
"RTN","LEX2050",22,0)
 ;                    
"RTN","LEX2050",23,0)
 ;   General
"RTN","LEX2050",24,0)
 ;
"RTN","LEX2050",25,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXG,LEXE,LEXSTR D IMP
"RTN","LEX2050",26,0)
 K XPDDIQ("XPZ1","B"),XPDDIQ("XPI1","B") S XPDDIQ("XPZ1","B")="NO",XPDDIQ("XPI1","B")="NO"
"RTN","LEX2050",27,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2050",28,0)
 D BM(LEXSTR),M("")
"RTN","LEX2050",29,0)
 S U="^"
"RTN","LEX2050",30,0)
 ;     No user
"RTN","LEX2050",31,0)
 D:+($$UR)'>0 ET("User not defined (DUZ)")
"RTN","LEX2050",32,0)
 ;     No IO
"RTN","LEX2050",33,0)
 D:+($$SY)'>0 ET("Undefined IO variable(s)")
"RTN","LEX2050",34,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2050",35,0)
 ;                    
"RTN","LEX2050",36,0)
 ;   Load Distribution
"RTN","LEX2050",37,0)
 ;
"RTN","LEX2050",38,0)
 ;     XPDENV = 0 Environment Check during Load
"RTN","LEX2050",39,0)
 ;
"RTN","LEX2050",40,0)
 ;       Check Version (2.0)
"RTN","LEX2050",41,0)
 I $$VERSION^XPDUTL("LEX")'="2.0" D  D ABRT Q
"RTN","LEX2050",42,0)
 . D ET("Version 2.0 not found.  Please install Lexicon Utility v 2.0")
"RTN","LEX2050",43,0)
 ;
"RTN","LEX2050",44,0)
 ;       Check Required Patches
"RTN","LEX2050",45,0)
 D:'$L($G(LEXREQP)) IMP I $L(LEXREQP) D
"RTN","LEX2050",46,0)
 . N LEXPAT,LEXI,LEXPN
"RTN","LEX2050",47,0)
 . F LEXI=1:1 Q:'$L($P(LEXREQP,";",LEXI))  S LEXPAT=$P(LEXREQP,";",LEXI) D
"RTN","LEX2050",48,0)
 . . S LEXPN=$$PATCH^XPDUTL(LEXPAT) W !,"   Checking for ",LEXPAT I +LEXPN>0 H 1 W " - installed"
"RTN","LEX2050",49,0)
 . . I +LEXPN'>0 D ET((LEXPAT_" not found, please install "_LEXPAT_" before continuing"))
"RTN","LEX2050",50,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2050",51,0)
 S LEXG=$$RGBL
"RTN","LEX2050",52,0)
 I $D(LEXE)&(+LEXG=0) D ABRT Q
"RTN","LEX2050",53,0)
 I $D(LEXE)&(+LEXG<0) D ABRT Q
"RTN","LEX2050",54,0)
 I '$D(LEXFULL)&(+($G(XPDENV))'=1) D QUIT Q
"RTN","LEX2050",55,0)
 ;                    
"RTN","LEX2050",56,0)
 ;   Install Package(s)
"RTN","LEX2050",57,0)
 ;
"RTN","LEX2050",58,0)
 ;     XPDENV = 1 Environment Check during Install
"RTN","LEX2050",59,0)
 ;
"RTN","LEX2050",60,0)
 ;       Check Data "is installed" or "is translated"
"RTN","LEX2050",61,0)
 N LEXIT S LEXIT=+($$CPD) I '$D(LEXFULL)&(LEXIT) D QUIT Q
"RTN","LEX2050",62,0)
 ;       Checking Global "Write" Protection 
"RTN","LEX2050",63,0)
 D:+($G(XPDENV))=1 GBLS I $D(LEXE) D ABRT Q
"RTN","LEX2050",64,0)
 ;       Check Import Global Checksum 
"RTN","LEX2050",65,0)
 D:+($G(XPDENV))=1 CS I $D(LEXE) D ABRT Q
"RTN","LEX2050",66,0)
 ;                    
"RTN","LEX2050",67,0)
 ;   Quit, Exit or Abort
"RTN","LEX2050",68,0)
 ;
"RTN","LEX2050",69,0)
QUIT ;     Quit   Passed Environment Check
"RTN","LEX2050",70,0)
 K LEXFULL D OK
"RTN","LEX2050",71,0)
 Q
"RTN","LEX2050",72,0)
EXIT ;     Exit   Failed Environment Check
"RTN","LEX2050",73,0)
 D:$D(LEXE) ED S XPDQUIT=2 K LEXE,LEXFULL Q
"RTN","LEX2050",74,0)
ABRT ;     Abort  Failed Environment Check, KILL the distribution
"RTN","LEX2050",75,0)
 D:$D(LEXE) ED S XPDABORT=1,XPDQUIT=1,XPDQUIT("LEX*2.0*50")=1
"RTN","LEX2050",76,0)
 K LEXE,LEXFULL
"RTN","LEX2050",77,0)
 Q
"RTN","LEX2050",78,0)
 ;               
"RTN","LEX2050",79,0)
 ; Checks
"RTN","LEX2050",80,0)
 ;
"RTN","LEX2050",81,0)
GBLS ;   Check Write access on globals
"RTN","LEX2050",82,0)
 N LEXB1,LEXB2,LEXE,LEXGBL,LEXRT,LEXT,LEXF,LEXI,LEXX,LEXOK,LEXCPD,LEXS,X S LEXOK=1
"RTN","LEX2050",83,0)
 D BM("   I will now check the protection on ^LEX, ^ICPT, ^ICD and ^DIC Globals.")
"RTN","LEX2050",84,0)
 D M("   If you get an ERROR, you will need to change the protection on these")
"RTN","LEX2050",85,0)
 D M("   globals to allow read/write as indicated:")
"RTN","LEX2050",86,0)
 D BM("                        Owner     Group    World   Network")
"RTN","LEX2050",87,0)
 D M("      Cache systems      RWD       RW       RW      RWD")
"RTN","LEX2050",88,0)
 D BM("   Checking:"),M(" ")
"RTN","LEX2050",89,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2050",90,0)
 . S LEXX="" S LEXE="S LEXX=$T(GD+"_LEXI_")" X LEXE S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2050",91,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2050",92,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(19-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2050",93,0)
 . I '$D(@LEXGBL) D RGNF S LEXOK=0 D M(("      <"_LEXRT_" not found>")) Q
"RTN","LEX2050",94,0)
 . D M(("      "_LEXRT_LEXB1_LEXT_LEXB2_LEXF)) S @LEXGBL=$G(@LEXGBL) H 1
"RTN","LEX2050",95,0)
 D:LEXOK M("    --> ok") D:'LEXOK M("    ??") D M(" ")
"RTN","LEX2050",96,0)
 Q
"RTN","LEX2050",97,0)
RGBL(X) ;   Check Write access on globals
"RTN","LEX2050",98,0)
 N LEXCPD,LEXS,LEXI,LEXX,LEXEC,LEXGBL,LEXRT,LEXT,LEXF,LEXB1,LEXB2
"RTN","LEX2050",99,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2050",100,0)
 . S LEXX="" S LEXEC="S LEXX=$T(GD+"_LEXI_")" X LEXEC S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2050",101,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2050",102,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(15-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2050",103,0)
 . I '$D(@LEXGBL) S:LEXS'[LEXRT LEXS=LEXS_", "_LEXRT S X=-1 S:LEXGBL["LEXM("&(X=1) X=0
"RTN","LEX2050",104,0)
 I $L(LEXS),X'>0 D
"RTN","LEX2050",105,0)
 . S:LEXS[", " LEXS=$P(LEXS,", ",1,($L(LEXS,", ")-1))_" and "_$P(LEXS,", ",$L(LEXS,", "))
"RTN","LEX2050",106,0)
 . S:$E(LEXS,1,2)=", " LEXS=$E(LEXS,3,$L(LEXS)) S:$E(LEXS,1,7)[" and " LEXS=$P(LEXS," and ",2)
"RTN","LEX2050",107,0)
 . D:X=-1 ET(("Global"_$S(LEXS[", "!(LEXS[" and "):"s",1:"")_" "_LEXS_" either not found or incomplete."))
"RTN","LEX2050",108,0)
 . D:X=0 CM
"RTN","LEX2050",109,0)
 Q X
"RTN","LEX2050",110,0)
RGNF ;   Required global not found
"RTN","LEX2050",111,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2050",112,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)'["^LEXM") ET(""),ET("Required global "_$P($G(LEXGBL),"(",1)_" not found.")
"RTN","LEX2050",113,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)["^LEXM") CM
"RTN","LEX2050",114,0)
 Q
"RTN","LEX2050",115,0)
CHK ;   Check the Checksum
"RTN","LEX2050",116,0)
 D CS I $D(LEXE) D ED Q
"RTN","LEX2050",117,0)
 D BM("  OK"),M(" ")
"RTN","LEX2050",118,0)
 Q
"RTN","LEX2050",119,0)
CS ;   Checksum for import global
"RTN","LEX2050",120,0)
 K LEXE D BM("   Running checksum routine on the ^LEXM import global, please wait")
"RTN","LEX2050",121,0)
 N LEXCK,LEXND,LEXV S LEXCK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEX2050",122,0)
 S LEXND=+($G(^LEXM(0,"NODES"))),LEXV=+($$VC(LEXCK,LEXND))
"RTN","LEX2050",123,0)
 D M(" ") D:LEXV>0 M("     Checksum is ok"),M(" ")
"RTN","LEX2050",124,0)
 D:LEXV=0 CM D:LEXV=-1 CW D:LEXV=-2 CU D:LEXV=-3 CF
"RTN","LEX2050",125,0)
 Q
"RTN","LEX2050",126,0)
VC(X,Y) ;   Verify Checksum for import global
"RTN","LEX2050",127,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR Q:'$D(^LEXM) 0
"RTN","LEX2050",128,0)
 D IMP I $G(^LEXM(0,"BUILD"))'=$G(LEXBUILD) Q -1
"RTN","LEX2050",129,0)
 N LEXCK,LEXND,LEXCNT,LEXLC,LEXL,LEXS,LEXNC,LEXD,LEXN,LEXC,LEXGCS,LEXP,LEXT
"RTN","LEX2050",130,0)
 S LEXCK=+($G(X)),LEXND=+($G(Y))
"RTN","LEX2050",131,0)
 Q:LEXCK'>0!(LEXND'>0) -2
"RTN","LEX2050",132,0)
 S LEXL=64,(LEXCNT,LEXLC)=0,LEXS=(+(LEXND\LEXL))
"RTN","LEX2050",133,0)
 S:LEXS=0 LEXS=1 D:+($O(^LEXM(0)))>0 M("")
"RTN","LEX2050",134,0)
 S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0 W "   "
"RTN","LEX2050",135,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEX2050",136,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"
"RTN","LEX2050",137,0)
 . Q:LEXN="^LEXM(0,""NODES"")"
"RTN","LEX2050",138,0)
 . S LEXCNT=LEXCNT+1
"RTN","LEX2050",139,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEX2050",140,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD
"RTN","LEX2050",141,0)
 . F LEXP=1:1:$L(LEXT) S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEX2050",142,0)
 Q:LEXNC'=LEXND -3
"RTN","LEX2050",143,0)
 Q:LEXGCS'=LEXCK -3
"RTN","LEX2050",144,0)
 Q 1
"RTN","LEX2050",145,0)
SY(X) ;   Check System variables
"RTN","LEX2050",146,0)
 Q:'$D(IO)!('$D(IOF))!('$D(IOM))!('$D(ION))!('$D(IOSL))!('$D(IOST)) 0
"RTN","LEX2050",147,0)
 Q 1
"RTN","LEX2050",148,0)
UR(X) ;   Check User variables
"RTN","LEX2050",149,0)
 Q:'$L($G(DUZ(0))) 0
"RTN","LEX2050",150,0)
 Q:+($G(DUZ))=0!($$NOTDEF(+$G(DUZ))) 0
"RTN","LEX2050",151,0)
 Q 1
"RTN","LEX2050",152,0)
CPD(X) ;   Check Current Patched Data is installed
"RTN","LEX2050",153,0)
 N INS S INS=1
"RTN","LEX2050",154,0)
 Q 0
"RTN","LEX2050",155,0)
 ;               
"RTN","LEX2050",156,0)
 ; Error messages
"RTN","LEX2050",157,0)
 ;
"RTN","LEX2050",158,0)
CM ;   Missing ^LEXM
"RTN","LEX2050",159,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Missing import global ^LEXM.") D CO
"RTN","LEX2050",160,0)
 Q
"RTN","LEX2050",161,0)
CW ;   Wrong ^LEXM
"RTN","LEX2050",162,0)
 N LEXB,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP S LEXB=$G(^LEXM(0,"BUILD")) D ET("")
"RTN","LEX2050",163,0)
 I $L(LEXBUILD),$L(LEXB),LEXBUILD'=LEXB D  Q
"RTN","LEX2050",164,0)
 . D ET(("Incorrect import global ^LEXM found ("_LEXB_" global).")) D CKO
"RTN","LEX2050",165,0)
 D ET("Incorrect import global ^LEXM found.") D CKO
"RTN","LEX2050",166,0)
 Q
"RTN","LEX2050",167,0)
CU ;   Unable to verify
"RTN","LEX2050",168,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Unable to verify checksum for import global ^LEXM (possibly corrupt).") D CKO
"RTN","LEX2050",169,0)
 Q
"RTN","LEX2050",170,0)
CF ;   Failed checksum
"RTN","LEX2050",171,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET("") D ET("Import global ^LEXM failed checksum.") D CKO
"RTN","LEX2050",172,0)
 Q
"RTN","LEX2050",173,0)
CO ;   Obtain new global
"RTN","LEX2050",174,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2050",175,0)
 D ET(""),ET("    Please obtain a copy of the import global ^LEXM contained in the ")
"RTN","LEX2050",176,0)
 D ET(("    global host file "_LEXIGHF_" before continuing with the "_LEXBUILD))
"RTN","LEX2050",177,0)
 D ET(("    installation."))
"RTN","LEX2050",178,0)
 Q
"RTN","LEX2050",179,0)
CKO ;   Kill and Obtain new global
"RTN","LEX2050",180,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2050",181,0)
 D ET(""),ET("    Please KILL the existing import global ^LEXM from your system")
"RTN","LEX2050",182,0)
 D ET(("    and obtain a new copy of ^LEXM contained in the global host file"))
"RTN","LEX2050",183,0)
 D ET(("    "_LEXIGHF_" before continuing with the "_LEXBUILD_" installation."))
"RTN","LEX2050",184,0)
 Q
"RTN","LEX2050",185,0)
ET(X) ;   Error Text
"RTN","LEX2050",186,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)="    "_$G(X),LEXE(0)=LEXI
"RTN","LEX2050",187,0)
 Q
"RTN","LEX2050",188,0)
ED ;   Error Display
"RTN","LEX2050",189,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  D M(LEXE(LEXI))
"RTN","LEX2050",190,0)
 D M(" ") K LEXE Q
"RTN","LEX2050",191,0)
 ;                   
"RTN","LEX2050",192,0)
 ; Miscellaneous
"RTN","LEX2050",193,0)
 ;
"RTN","LEX2050",194,0)
NOTDEF(IEN) ;   Check to see if user is defined
"RTN","LEX2050",195,0)
 N DA,DR,DIQ,LEX,DIC S DA=IEN,DR=.01,DIC=200,DIQ="LEX" D EN^DIQ1 Q '$D(LEX)
"RTN","LEX2050",196,0)
OK ;   Environment is OK
"RTN","LEX2050",197,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXT
"RTN","LEX2050",198,0)
 D IMP S LEXT="  Environment "_$S($L(LEXBUILD):("for patch/build "_LEXBUILD_" "),1:"")_"is ok"
"RTN","LEX2050",199,0)
 D BM(LEXT),M(" ")
"RTN","LEX2050",200,0)
 Q
"RTN","LEX2050",201,0)
BM(X) ;   Blank Line with Message
"RTN","LEX2050",202,0)
 D BMES^XPDUTL($G(X)) Q
"RTN","LEX2050",203,0)
M(X) ;   Message
"RTN","LEX2050",204,0)
 D MES^XPDUTL($G(X)) Q
"RTN","LEX2050",205,0)
TRIM(X) ;   Trim Spaces
"RTN","LEX2050",206,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEX2050",207,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEX2050",208,0)
 Q X
"RTN","LEX2050",209,0)
IMP ;   Import names
"RTN","LEX2050",210,0)
 ;     Patch Type
"RTN","LEX2050",211,0)
 S LEXPTYPE="Code Set Remedy Ticket Fixes"
"RTN","LEX2050",212,0)
 S LEXPTYPE="Code Set Update"
"RTN","LEX2050",213,0)
 ;     Revision
"RTN","LEX2050",214,0)
 S LEXLREV=50
"RTN","LEX2050",215,0)
 ;     Required Builds
"RTN","LEX2050",216,0)
 S LEXREQP="LEX*2.0*48;LEX*2.0*49;PXRM*2.0*9;ICD*18.0*28;ICPT*6.0*34"
"RTN","LEX2050",217,0)
 ;     This Build Name
"RTN","LEX2050",218,0)
 S LEXBUILD="LEX*2.0*50"
"RTN","LEX2050",219,0)
 ;     This Build's Export Global Host Filename
"RTN","LEX2050",220,0)
 S LEXIGHF="LEX_2_50.GBL"
"RTN","LEX2050",221,0)
 ;     Fiscal Year
"RTN","LEX2050",222,0)
 S LEXFY="FY07"
"RTN","LEX2050",223,0)
 ;     Quarter
"RTN","LEX2050",224,0)
 S LEXQTR="4th"
"RTN","LEX2050",225,0)
 Q
"RTN","LEX2050",226,0)
EF ;   Exported Files
"RTN","LEX2050",227,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2050",228,0)
 ;;^LEXT(757.2);^LEXT(757.2);Lexicon Subsets/Defaults;757.2
"RTN","LEX2050",229,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2050",230,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2050",231,0)
 ;;^DIC(81.2,0);^DIC(81.2);CPT Copyright;81.2
"RTN","LEX2050",232,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2050",233,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2050",234,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2050",235,0)
 ;;^ICD(0);^ICD(;DRG Grouper;80.2
"RTN","LEX2050",236,0)
 ;;^ICM(0);^ICM(;MAJOR DIAGNOSTIC CATEGORY;80.3
"RTN","LEX2050",237,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2050",238,0)
 Q
"RTN","LEX2050",239,0)
GD ;   Global Data
"RTN","LEX2050",240,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2050",241,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2050",242,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2050",243,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2050P")
0^2^B3259336^n/a
"RTN","LEX2050P",1,0)
LEX2050P ;ISL/KER - LEX*2.0*50 Pre/Post Install ;06/06/2007
"RTN","LEX2050P",2,0)
 ;;2.0;LEXICON UTILITY;**50**;Sep 23, 1996
"RTN","LEX2050P",3,0)
 ;              
"RTN","LEX2050P",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEX2050P",5,0)
 ;    None
"RTN","LEX2050P",6,0)
 ;              
"RTN","LEX2050P",7,0)
 ; Global Variables
"RTN","LEX2050P",8,0)
 ;    ^LEXM
"RTN","LEX2050P",9,0)
 ;              
"RTN","LEX2050P",10,0)
 ; External References
"RTN","LEX2050P",11,0)
 ;    None
"RTN","LEX2050P",12,0)
 ;              
"RTN","LEX2050P",13,0)
 Q
"RTN","LEX2050P",14,0)
POST ; LEX*2.0*50 Post-Install
"RTN","LEX2050P",15,0)
 ;            
"RTN","LEX2050P",16,0)
 ; From IMP^LEX2050
"RTN","LEX2050P",17,0)
 ;            
"RTN","LEX2050P",18,0)
 ;      LEXBUILD   Build Name - LEX*2.0*nn
"RTN","LEX2050P",19,0)
 ;      LEXPTYPE   Patch Type - Remedy or Quarterly
"RTN","LEX2050P",20,0)
 ;      LEXFY      Fiscal Year - FYnn
"RTN","LEX2050P",21,0)
 ;      LEXQTR     Quarter - 1st, 2nd, 3rd, or 4th
"RTN","LEX2050P",22,0)
 ;      LEXIGHF    Name of Host File - LEX_2_nn.GBL
"RTN","LEX2050P",23,0)
 ;      LEXLREV    Revision - nn
"RTN","LEX2050P",24,0)
 ;      LEXREQP    Required Builds - build;build;build
"RTN","LEX2050P",25,0)
 ;            
"RTN","LEX2050P",26,0)
 N LEXEDT,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXB,LEXCD,LEXSTR,LEXLAST D IMP^LEX2050
"RTN","LEX2050P",27,0)
 S LEXEDT=$G(^LEXM(0,"CREATED")) D CON,LOAD
"RTN","LEX2050P",28,0)
 Q
"RTN","LEX2050P",29,0)
LOAD ; Load Data
"RTN","LEX2050P",30,0)
 ;             
"RTN","LEX2050P",31,0)
 ;      LEXSHORT   Send Short Message
"RTN","LEX2050P",32,0)
 ;      LEXMSG     Flag to send Message
"RTN","LEX2050P",33,0)
 ;            
"RTN","LEX2050P",34,0)
 N LEXSHORT,LEXMSG S LEXSHORT="",LEXMSG=""
"RTN","LEX2050P",35,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2050P",36,0)
 S U="^",LEXB=$G(^LEXM(0,"BUILD")) Q:LEXB=""  Q:LEXBUILD=""
"RTN","LEX2050P",37,0)
 D:LEXB=LEXBUILD EN^LEXXGI
"RTN","LEX2050P",38,0)
LQ ; Load Quit
"RTN","LEX2050P",39,0)
 D KLEXM
"RTN","LEX2050P",40,0)
 Q
"RTN","LEX2050P",41,0)
 ;             
"RTN","LEX2050P",42,0)
KLEXM ; Subscripted Kill of ^LEXM
"RTN","LEX2050P",43,0)
 H 2 N DA S DA=0 F  S DA=$O(^LEXM(DA)) Q:+DA=0  K ^LEXM(DA)
"RTN","LEX2050P",44,0)
 N LEX S LEX=$G(^LEXM(0,"PRO")) K ^LEXM(0)
"RTN","LEX2050P",45,0)
 Q
"RTN","LEX2050P",46,0)
 ;            
"RTN","LEX2050P",47,0)
PRE ; LEX*2.0*50 Pre-Install   (N/A for patch 50)
"RTN","LEX2050P",48,0)
 Q
"RTN","LEX2050P",49,0)
 ;            
"RTN","LEX2050P",50,0)
CON ; Conversion of data       (Remove existing KT/KU Modifiers)
"RTN","LEX2050P",51,0)
 N DA,DIK S DIK="^DIC(81.3," S DA=0 F  S DA=$O(^DIC(81.3,"B","KT",DA)) Q:+DA'>0  D ^DIK
"RTN","LEX2050P",52,0)
 S DA=0 F  S DA=$O(^DIC(81.3,"B","KU",DA)) Q:+DA'>0  D ^DIK
"RTN","LEX2050P",53,0)
 K DA,DIK K ^DIC(81.3,-1)
"RTN","LEX2050P",54,0)
 Q
"RTN","LEXXGI")
0^3^B64603303^B60750552
"RTN","LEXXGI",1,0)
LEXXGI ;ISL/KER - Global Import (Needs ^LEXM) ;06/06/2007
"RTN","LEXXGI",2,0)
 ;;2.0;LEXICON UTILITY;**4,25,26,27,28,29,46,49,50**;Sep 23, 1996
"RTN","LEXXGI",3,0)
 ;              
"RTN","LEXXGI",4,0)
 ; NEWed by Lexicon Environment Check routine LEX20nn
"RTN","LEXXGI",5,0)
 ;    LEXBUILD
"RTN","LEXXGI",6,0)
 ;    LEXFY
"RTN","LEXXGI",7,0)
 ;    LEXIGHF
"RTN","LEXXGI",8,0)
 ;    LEXLREV
"RTN","LEXXGI",9,0)
 ;    LEXPTYPE
"RTN","LEXXGI",10,0)
 ;    LEXQTR
"RTN","LEXXGI",11,0)
 ;    LEXREQP
"RTN","LEXXGI",12,0)
 ;              
"RTN","LEXXGI",13,0)
 ; NEWed by KIDS during the Install of a patch/build
"RTN","LEXXGI",14,0)
 ;    XPDNM
"RTN","LEXXGI",15,0)
 ;              
"RTN","LEXXGI",16,0)
 ; Global Variables
"RTN","LEXXGI",17,0)
 ;    ^LEXM
"RTN","LEXXGI",18,0)
 ;              
"RTN","LEXXGI",19,0)
 ; External References
"RTN","LEXXGI",20,0)
 ;    DBIA 10086  HOME^%ZIS
"RTN","LEXXGI",21,0)
 ;    DBIA 10016  ^DIM
"RTN","LEXXGI",22,0)
 ;    DBIA  2056  $$GET1^DIQ (file 200)
"RTN","LEXXGI",23,0)
 ;    DBIA 10103  $$DT^XLFDT
"RTN","LEXXGI",24,0)
 ;    DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXGI",25,0)
 ;    DBIA 10141  BMES^XPDUTL 
"RTN","LEXXGI",26,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","LEXXGI",27,0)
 ;              
"RTN","LEXXGI",28,0)
EN ; Main Entry Point for Installing LEXM in Post-Installs
"RTN","LEXXGI",29,0)
 ;                
"RTN","LEXXGI",30,0)
 ; Requires 
"RTN","LEXXGI",31,0)
 ;                
"RTN","LEXXGI",32,0)
 ;   LEXBUILD - the name of the patch/build being installed
"RTN","LEXXGI",33,0)
 ;                
"RTN","LEXXGI",34,0)
 ; Uses
"RTN","LEXXGI",35,0)
 ;                
"RTN","LEXXGI",36,0)
 ;   LEXMSG   - If this variable exist, then an install message
"RTN","LEXXGI",37,0)
 ;              message will be set to G.LEXICON
"RTN","LEXXGI",38,0)
 ;              
"RTN","LEXXGI",39,0)
 ;   LEXSHORT - If this variable exist, the install message
"RTN","LEXXGI",40,0)
 ;              will be an abbreviated message, without the 
"RTN","LEXXGI",41,0)
 ;              file totals and checksums
"RTN","LEXXGI",42,0)
 ;               
"RTN","LEXXGI",43,0)
 ;              Abbreviated Install Message
"RTN","LEXXGI",44,0)
 ;               
"RTN","LEXXGI",45,0)
 ;                Date and Time Installed
"RTN","LEXXGI",46,0)
 ;                Account where the Data was Installed
"RTN","LEXXGI",47,0)
 ;                Who Installed the Data
"RTN","LEXXGI",48,0)
 ;                The Name of the Build Installed
"RTN","LEXXGI",49,0)
 ;                The Name of the Global Host File
"RTN","LEXXGI",50,0)
 ;                Protocol Invoked
"RTN","LEXXGI",51,0)
 ;                Date and time Protocol was Invoked
"RTN","LEXXGI",52,0)
 ;                Install Start Date/Time
"RTN","LEXXGI",53,0)
 ;                Install Complete Date/Time
"RTN","LEXXGI",54,0)
 ;                Install Elapsed Time
"RTN","LEXXGI",55,0)
 ;               
"RTN","LEXXGI",56,0)
 ;              Long Install Message
"RTN","LEXXGI",57,0)
 ;               
"RTN","LEXXGI",58,0)
 ;                All of the elements above plus:
"RTN","LEXXGI",59,0)
 ;               
"RTN","LEXXGI",60,0)
 ;                   File Versions/Revisions
"RTN","LEXXGI",61,0)
 ;                   File Checksums
"RTN","LEXXGI",62,0)
 ;                   File Record Counts
"RTN","LEXXGI",63,0)
 ;              
"RTN","LEXXGI",64,0)
 ;   LEXPTYPE - Patch Type
"RTN","LEXXGI",65,0)
 ;   LEXLREV  - Revision
"RTN","LEXXGI",66,0)
 ;   LEXREQP  - Required Patches/Builds
"RTN","LEXXGI",67,0)
 ;   LEXIGHF  - The patch Export Global Host Filename
"RTN","LEXXGI",68,0)
 ;   LEXFY    - Fiscal Year
"RTN","LEXXGI",69,0)
 ;   LEXQTR   - Quarter
"RTN","LEXXGI",70,0)
 ;   LEXCRE   - Import Global Creation Date
"RTN","LEXXGI",71,0)
 ;                
"RTN","LEXXGI",72,0)
 D IMPORT D KALL^LEXXGI2
"RTN","LEXXGI",73,0)
 Q
"RTN","LEXXGI",74,0)
IMPORT ; Import Data during a Patch Installation
"RTN","LEXXGI",75,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXGI",76,0)
 S:$L($G(LEXPTYPE)) LEXPTYPE=$G(LEXPTYPE) S:$L($G(LEXLREV)) LEXLREV=$G(LEXLREV) S:$L($G(LEXREQP)) LEXREQP=$G(LEXREQP)
"RTN","LEXXGI",77,0)
 S:$L($G(LEXBUILD)) LEXBUILD=$G(LEXBUILD) S:$L($G(LEXIGHF)) LEXIGHF=$G(LEXIGHF) S:$L($G(LEXFY)) LEXFY=$G(LEXFY)
"RTN","LEXXGI",78,0)
 S:$L($G(LEXQTR)) LEXQTR=$G(LEXQTR) K LEXSCHG,LEXCHG
"RTN","LEXXGI",79,0)
 N LEXB,LEXCD,LEXSTR,LEXLAST,%,%DT,C,D,D0,D1,D2,DG,DIC,DICR,DILOCKTM,DIW,IREC,J,XMDUN,XMZ,ZTSK
"RTN","LEXXGI",80,0)
 S U="^",LEXSTR=$G(LEXPTYPE),LEXB=$G(^LEXM(0,"BUILD"))
"RTN","LEXXGI",81,0)
 S:$L($G(LEXFY))&($L($G(LEXQTR)))&($L(LEXSTR)) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEXXGI",82,0)
 S:$L(LEXB) LEXBLD=LEXB S:'$L(LEXBLD)&($L(LEXBUILD)) LEXBLD=LEXBUILD
"RTN","LEXXGI",83,0)
 I '$L(LEXB)!(LEXB'=LEXBUILD) D
"RTN","LEXXGI",84,0)
 . N X,LEXBLD I '$L(LEXB) D  Q
"RTN","LEXXGI",85,0)
 . . S X=" Invalid export global, aborting data install" W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",86,0)
 . I '$L(LEXBUILD) D  Q
"RTN","LEXXGI",87,0)
 . . S X=" Undefined KIDS Build, aborting data install" W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",88,0)
 I $L(LEXB)&(LEXB=LEXBUILD) D
"RTN","LEXXGI",89,0)
 . N LEXFI,LEXID S X="Installing Data for patch "_LEXB W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",90,0)
 . K LEXSCHG S LEXCHG=0,LEXFI=0 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI'>0  D
"RTN","LEXXGI",91,0)
 . . S LEXID=$S(LEXFI=80!(LEXFI=80.1):"ICD",LEXFI=81!(LEXFI=81.1)!(LEXFI=81.2)!(LEXFI=81.3):"CPT",$P(LEXFI,".",1)=757:"LEX",1:"UNK")
"RTN","LEXXGI",92,0)
 . . S LEXSCHG(LEXFI,0)=+($G(^LEXM(LEXFI,0))),LEXSCHG("B",LEXFI)="" S LEXSCHG("C",LEXID,LEXFI)=""
"RTN","LEXXGI",93,0)
 . S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")="",LEXCHG=1,LEXSCHG(0)=1
"RTN","LEXXGI",94,0)
 . D LOAD,NOTIFY^LEXXGI2 I +($G(DUZ))>0,$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01)) D
"RTN","LEXXGI",95,0)
 . . D HOME^%ZIS N DIFROM,LEXPRO,LEXPRON,LEXLAST S LEXPRON="LEXICAL SERVICES UPDATE",LEXPRO=$G(^LEXM(0,"PRO")) D:$D(LEXMSG) POST^LEXXFI
"RTN","LEXXGI",96,0)
 Q
"RTN","LEXXGI",97,0)
LOAD ; Load Data from ^LEXM into IC*/LEX Files
"RTN","LEXXGI",98,0)
 Q:'$L($G(LEXB))  S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXGI",99,0)
 N LEXBEG,LEXELP,LEXEND,LEXMSG,LEXOK,LEXFL
"RTN","LEXXGI",100,0)
 D:'$D(^LEXM) NF^LEXXGI2 Q:'$D(^LEXM)
"RTN","LEXXGI",101,0)
 S LEXOK=0 S:$O(^LEXM(0))>0 LEXOK=1 D:'LEXOK IG^LEXXGI2 Q:'LEXOK
"RTN","LEXXGI",102,0)
 S LEXBEG=$$HACK^LEXXGI2 D FILES S LEXEND=$$HACK^LEXXGI2,LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND)
"RTN","LEXXGI",103,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI",104,0)
 D PB^LEXXGI2("  Data Updated ")
"RTN","LEXXGI",105,0)
 D PB^LEXXGI2(("     Started:   "_$TR($$FMTE^XLFDT(LEXBEG),"@"," ")))
"RTN","LEXXGI",106,0)
 D TL^LEXXGI2(("     Finished:  "_$TR($$FMTE^XLFDT(LEXEND),"@"," ")))
"RTN","LEXXGI",107,0)
 D TL^LEXXGI2(("     Elapsed:   "_LEXELP))
"RTN","LEXXGI",108,0)
 Q
"RTN","LEXXGI",109,0)
FILES ;   Load Data for all files
"RTN","LEXXGI",110,0)
 Q:'$L($G(LEXB))  N LEXHDR,LEXBLD,LEXDAT,LEXFI,LEXFIC,LEXHDRS,LEXLOG,LEXINS
"RTN","LEXXGI",111,0)
 S (LEXFI,LEXFIC)=0,LEXHDR=0,LEXBLD=LEXB
"RTN","LEXXGI",112,0)
 S LEXDAT=$P($G(^LEXM(0,"VRRVDT")),"^",1),LEXINS=1
"RTN","LEXXGI",113,0)
 S:+LEXDAT'>0 LEXDAT=$$DT^XLFDT I LEXOK D
"RTN","LEXXGI",114,0)
 . N LEXCRE,LEXL1 S LEXL1="" S LEXCRE=$G(^LEXM(0,"CREATED")) S LEXCRE=$S(+LEXCRE>0:($$MIX^LEXXGI2($$FMTE^XLFDT(LEXCRE))),1:"")
"RTN","LEXXGI",115,0)
 . S:$L($P(LEXCRE,"@",2)) LEXCRE=$P(LEXCRE,"@",1)_" at "_$P(LEXCRE,"@",2) S LEXL1=" Updating files "
"RTN","LEXXGI",116,0)
 . S:$L($G(LEXCRE))&($L($G(LEXL1))) LEXL1=$G(LEXL1)_"using export global created "_$G(LEXCRE)
"RTN","LEXXGI",117,0)
 . D PB^LEXXGI2(LEXL1)
"RTN","LEXXGI",118,0)
 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI=0  D FILE
"RTN","LEXXGI",119,0)
 Q
"RTN","LEXXGI",120,0)
FILE ;     Load Data for one file
"RTN","LEXXGI",121,0)
 N LEXCF,LEXCHG,LEXCHGS,LEXCNT,LEXFIL,LEXI,LEXID,LEXIEN,LEXL,LEXLC
"RTN","LEXXGI",122,0)
 N LEXMUMPS,LEXNM,LEXRT,LEXS,LEXTOT,LEXTXT,LEXIGL,LEXIGI,LEXIGF,LEXIGT
"RTN","LEXXGI",123,0)
 N LEXIGD,LEXIGO,LEXBEG,LEXEND,LEXELP,LEXFB
"RTN","LEXXGI",124,0)
 S LEXFB=$G(^LEXM(+LEXFI,0,"BUILD")),LEXIGO=0,LEXBEG=$$HACK^LEXXGI2
"RTN","LEXXGI",125,0)
 S (LEXCNT,LEXLC,LEXI)=0,LEXL=68,LEXFIC=LEXFIC+1 I LEXOK D
"RTN","LEXXGI",126,0)
 . N LEXB,LEXFID,LEXNM,LEXVR,LEXRV,LEXDT,LEXL1,LEXL2 S (LEXL1,LEXL2)="",LEXFID=$P(LEXFI,".",1)
"RTN","LEXXGI",127,0)
 . Q:+LEXFID'>0  Q:$D(LEXHDRS(+LEXFID))  S LEXHDRS(LEXFID)="" S:+LEXFI=81!(+LEXFI=81.3) LEXHDRS(81)="",LEXHDRS(81.3)=""
"RTN","LEXXGI",128,0)
 . S:LEXFID=80 LEXNM="ICD-9-CM" S:LEXFID=81 LEXNM="CPT-4/HCPCS" S:LEXFID=757 LEXNM="Lexicon" S LEXB=$G(^LEXM(LEXFI,0,"BUILD"))
"RTN","LEXXGI",129,0)
 . S LEXVR=$G(^LEXM(LEXFI,0,"VR")),LEXRV=$G(^LEXM(LEXFI,0,"VRRV")),LEXDT=$$MIX^LEXXGI2($$FMTE^XLFDT($P(LEXRV,"^",2))),LEXRV=$P(LEXRV,"^",1)
"RTN","LEXXGI",130,0)
 . S LEXL1="Updating "_LEXNM S:$L(LEXB) LEXL1=LEXL1_" with patch/build "_LEXB S:$L(LEXVR) LEXL2=" To version "_LEXVR
"RTN","LEXXGI",131,0)
 . S:$L(LEXVR)&($L(LEXRV)) LEXL2=LEXL2_" revision "_LEXRV S:$L(LEXVR)&($L(LEXRV))&($L(LEXDT)) LEXL2=LEXL2_" dated "_LEXDT
"RTN","LEXXGI",132,0)
 . S:$L(LEXL1) LEXL1=" "_LEXL1 S:$L(LEXL2) LEXL2=" "_LEXL2 D BL^LEXXGI2 D:$L(LEXL1) TL^LEXXGI2(LEXL1) D:$L(LEXL2) TL^LEXXGI2(LEXL2),BL^LEXXGI2
"RTN","LEXXGI",133,0)
 S LEXTOT=+($G(^LEXM(LEXFI,0))) G:LEXTOT=0 FILEQ
"RTN","LEXXGI",134,0)
 S LEXNM=$G(^LEXM(LEXFI,0,"NM"))
"RTN","LEXXGI",135,0)
 I $L(LEXNM),$$UP^LEXXGI2(LEXNM)'["FILE" S LEXNM=LEXNM_" FILE"
"RTN","LEXXGI",136,0)
 S:$L(LEXNM) LEXNM=$$MIX^LEXXGI2(LEXNM) S LEXCHG=$G(^LEXM(LEXFI,0))
"RTN","LEXXGI",137,0)
 S LEXTXT="   "_LEXNM,LEXTXT=LEXTXT_$J("",(40-$L(LEXTXT)))_LEXFI
"RTN","LEXXGI",138,0)
 D:LEXFIC=1 PB^LEXXGI2(LEXTXT) D:LEXFIC'=1 TL^LEXXGI2(LEXTXT)
"RTN","LEXXGI",139,0)
 S LEXS=+(LEXTOT\LEXL) S:LEXS=0 LEXS=1 W:+($O(^LEXM(LEXFI,0)))>0 !,"   "
"RTN","LEXXGI",140,0)
 D UPCHG^LEXXGI2 F  S LEXI=$O(^LEXM(LEXFI,LEXI)) Q:+LEXI=0  D
"RTN","LEXXGI",141,0)
 . S LEXCNT=LEXCNT+1,LEXMUMPS=$G(^LEXM(LEXFI,LEXI))
"RTN","LEXXGI",142,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEXXGI",143,0)
 . S LEXRT=$P(LEXMUMPS,"^",2),LEXFIL=""
"RTN","LEXXGI",144,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2)),LEXFL(+($P(LEXRT,"(",2)))=""
"RTN","LEXXGI",145,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80,LEXFL(80)=""
"RTN","LEXXGI",146,0)
 . S:LEXMUMPS["^ICD0(" LEXFIL=80.1,LEXFL(80.1)=""
"RTN","LEXXGI",147,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81,LEXFL(81)=""
"RTN","LEXXGI",148,0)
 . S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3,LEXFL(81.3)=""
"RTN","LEXXGI",149,0)
 . S:LEXMUMPS["^DIC(81.2" LEXFIL=81.2,LEXFL(81.2)=""
"RTN","LEXXGI",150,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2))
"RTN","LEXXGI",151,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80 S:LEXMUMPS["^ICD0(" LEXFIL=80.1
"RTN","LEXXGI",152,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81 S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3
"RTN","LEXXGI",153,0)
 . S:+LEXFIL>0 LEXSCHG(+LEXFIL,0)=""
"RTN","LEXXGI",154,0)
 . I $L(LEXMUMPS) D
"RTN","LEXXGI",155,0)
 . . N X S X=LEXMUMPS D ^DIM Q:'$D(X)  X LEXMUMPS S LEXIGO=1
"RTN","LEXXGI",156,0)
 I +($G(LEXIGO))>0 D
"RTN","LEXXGI",157,0)
 . S LEXEND=$$HACK^LEXXGI2 S LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND) S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI",158,0)
FILEQ ;     Load Data for one file - QUIT
"RTN","LEXXGI",159,0)
 K ^LEXM(+LEXFI)
"RTN","LEXXGI",160,0)
 Q
"RTN","LEXXGI",161,0)
 ;                     
"RTN","LEXXGI",162,0)
NOTIFY ; Notify by Protocol - LEXICAL SERVICES UPDATE
"RTN","LEXXGI",163,0)
 D NOTIFY^LEXXGI2,KALL^LEXXGI2
"RTN","LEXXGI",164,0)
 Q
"RTN","LEXXGI",165,0)
SCHG ;   Save Change File Changes (for NOTIFY)
"RTN","LEXXGI",166,0)
 N FI,ID K LEXSCHG S LEXCHG=0
"RTN","LEXXGI",167,0)
 N FI S FI=0 F  S FI=$O(^LEXM(FI)) Q:+FI'>0  D
"RTN","LEXXGI",168,0)
 . S ID=$S(FI=80!(FI=80.1):"ICD",FI=81!(FI=81.1)!(FI=81.2)!(FI=81.3):"CPT",$P(FI,".",1)=757:"LEX",1:"UNK")
"RTN","LEXXGI",169,0)
 . S LEXSCHG(FI,0)=+($G(^LEXM(FI,0))),LEXSCHG("B",FI)="" S LEXSCHG("C",ID,FI)=""
"RTN","LEXXGI",170,0)
 S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")=""
"RTN","LEXXGI",171,0)
 S:$D(^LEXM(80))!($D(^LEXM(80.1)))!($D(^LEXM(81)))!($D(^LEXM(81.2)))!($D(^LEXM(81.3)))!($D(LEXSCHG("D","PRO"))) LEXCHG=1,LEXSCHG(0)=1
"RTN","LEXXGI",172,0)
 Q
"RTN","LEXXGI",173,0)
ZTQ ; Taskman Quit
"RTN","LEXXGI",174,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK
"RTN","LEXXGI",175,0)
 Q
"RTN","LEXXGI",176,0)
CHECKSUM ; Check ^LEXM Checksum
"RTN","LEXXGI",177,0)
 D CS^LEXXGI2
"RTN","LEXXGI",178,0)
 Q
"RTN","LEXXGI2")
0^4^B63740225^B40689022
"RTN","LEXXGI2",1,0)
LEXXGI2 ;ISL/KER - Global Import (Update Change File w/^LEXM) ;06/06/2007
"RTN","LEXXGI2",2,0)
 ;;2.0;LEXICON UTILITY;**25,26,28,29,46,49,50**;Sep 23, 1996
"RTN","LEXXGI2",3,0)
 ;             
"RTN","LEXXGI2",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEXXGI2",5,0)
 ;    XPDNM  NEWed by KIDS during Install
"RTN","LEXXGI2",6,0)
 ;              
"RTN","LEXXGI2",7,0)
 ; Global Variables
"RTN","LEXXGI2",8,0)
 ;    ^LEXM
"RTN","LEXXGI2",9,0)
 ;    DBIA   872  ^ORD(101
"RTN","LEXXGI2",10,0)
 ;    DBIA 10011  ^UTILITY($J
"RTN","LEXXGI2",11,0)
 ;              
"RTN","LEXXGI2",12,0)
 ; External References
"RTN","LEXXGI2",13,0)
 ;    DBIA  10011  ^DIWP
"RTN","LEXXGI2",14,0)
 ;    DBIA 10103  $$FMDIFF^XLFDT
"RTN","LEXXGI2",15,0)
 ;    DBIA 10103  $$NOW^XLFDT
"RTN","LEXXGI2",16,0)
 ;    DBIA 10141  BMES^XPDUTL 
"RTN","LEXXGI2",17,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","LEXXGI2",18,0)
 ;    DBIA 10101  EN^XQOR
"RTN","LEXXGI2",19,0)
 ;              
"RTN","LEXXGI2",20,0)
 Q
"RTN","LEXXGI2",21,0)
NOTIFY ; Notify by Protocol - LEXICAL SERVICES UPDATE
"RTN","LEXXGI2",22,0)
 ;     Uses LEXSCHG() from the Post-Install
"RTN","LEXXGI2",23,0)
 ;     Sets ^LEXM(0,"PRO")=$$NOW^XLFDT
"RTN","LEXXGI2",24,0)
 N X,LEXU,LEXT,LEXF,LEXI,LEXL,LEX1,LEX2,LEX3,LEXN,LEXP,LEXUP D:$O(LEXSCHG(0))'>0 SCHG
"RTN","LEXXGI2",25,0)
 S LEXUP="" S:$D(LEXSCHG("C","ICD"))!($D(LEXSCHG(80)))!($D(LEXSCHG(80.1))) LEXUP=$G(LEXUP)_"ICD"
"RTN","LEXXGI2",26,0)
 S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG(81)))!($D(LEXSCHG(81.3))) LEXUP=$G(LEXUP)_"/CPT"
"RTN","LEXXGI2",27,0)
 S:$E(LEXUP,1)="/" LEXUP=$E(LEXUP,2,$L(LEXUP)) S:$L(LEXUP) LEXUP=LEXUP_" "
"RTN","LEXXGI2",28,0)
 S LEXI=756.999999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="757")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI2",29,0)
 S LEXI=79.9990999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="80")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI2",30,0)
 S LEXI=80.9990999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="81")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI2",31,0)
 S:$E($G(LEXT),1,2)=", " LEXT=$E($G(LEXT),3,$L($G(LEXT))),LEXT=$$TRIM(LEXT)
"RTN","LEXXGI2",32,0)
 I $L(LEXT) D
"RTN","LEXXGI2",33,0)
 . S:$L(LEXT,", ")>1 LEXT=$P($G(LEXT),", ",1,($L($G(LEXT),", ")-1))_" and "_$P($G(LEXT),", ",$L($G(LEXT),", "))
"RTN","LEXXGI2",34,0)
 S:$P($O(LEXSCHG(756.999999)),".",1)="757" LEXF="Lexicon" S:$P($O(LEXSCHG(79.999999)),".",1)=80 LEXF=$G(LEXF)_", ICD"
"RTN","LEXXGI2",35,0)
 S:$P($O(LEXSCHG(80.999999)),".",1)=81 LEXF=$G(LEXF)_", CPT"
"RTN","LEXXGI2",36,0)
 S:$E($G(LEXF),1,2)=", " LEXF=$E($G(LEXF),3,$L($G(LEXF))),LEXF=$$TRIM(LEXF)
"RTN","LEXXGI2",37,0)
 I $L(LEXF) D
"RTN","LEXXGI2",38,0)
 . S:$L(LEXF,", ")>1 LEXF=$P($G(LEXF),", ",1,($L($G(LEXF),", ")-1))_" and "_$P($G(LEXF),", ",$L($G(LEXF),", "))
"RTN","LEXXGI2",39,0)
 . S:$L($P(LEXF,", ",1)) LEXF=$G(LEXF)_" File"_$S(LEXF[", ":"s",LEXF[" and ":"s",1:"")_" Updated"
"RTN","LEXXGI2",40,0)
 S LEXL=78-($L(LEXF)+4),LEXU="Lexical Files Updated" I $L(LEXT)&($L(LEXF))&(LEXL>30) D
"RTN","LEXXGI2",41,0)
 . S LEXU=LEXF N LEX S LEX=LEXT K LEXT S LEXT(1)=LEX D WP(.LEXT,LEXL)
"RTN","LEXXGI2",42,0)
 S LEXP=+($O(^ORD(101,"B","LEXICAL SERVICES UPDATE",0))) Q:LEXP=0  S X=LEXP_";ORD(101," D EN^XQOR S:'$D(LEXSCHG) ^LEXM(0,"PRO")=$$NOW^XLFDT
"RTN","LEXXGI2",43,0)
 Q:+($G(^LEXM(0,"PRO")))'>0
"RTN","LEXXGI2",44,0)
 I $L($G(LEXU)) D
"RTN","LEXXGI2",45,0)
 . N LEXI S LEXI=$L($G(LEXU))+3
"RTN","LEXXGI2",46,0)
 . S X=$G(LEXU) D:$O(LEXT(0))'>0 BL,TL(X),BL I $O(LEXT(0))>0 D
"RTN","LEXXGI2",47,0)
 . . D BL S X=$G(LEXU)_":  " N LEX S LEX=0 F  S LEX=$O(LEXT(LEX)) Q:+LEX'>0  D
"RTN","LEXXGI2",48,0)
 . . . N LEXX S LEXX=$$TRIM($G(LEXT(LEX))) S:$L(LEXX) X=X_LEXX D TL(X) S X="",$P(X," ",+LEXI)=" "
"RTN","LEXXGI2",49,0)
 . . D BL
"RTN","LEXXGI2",50,0)
 S X="Protocol 'LEXICAL SERVICES UPDATE' was invoked" D TL(X)
"RTN","LEXXGI2",51,0)
 S X="Subscribing applications were notified of the "_LEXUP_"update" D TL(X),BL
"RTN","LEXXGI2",52,0)
 Q
"RTN","LEXXGI2",53,0)
UPCHG ;
"RTN","LEXXGI2",54,0)
 Q:+($G(LEXFI))'>0  N LEXID S LEXID=$S($P(LEXFI,".",1)="757":"LEX",$P(LEXFI,".",1)="80":"ICD",$P(LEXFI,".",1)="81":"CPT",1:"UNK")
"RTN","LEXXGI2",55,0)
 I $D(LEXSCHG) S LEXSCHG(LEXFI,0)="",LEXSCHG("B",LEXFI)="",LEXSCHG("C",LEXID,LEXFI)=""
"RTN","LEXXGI2",56,0)
 Q
"RTN","LEXXGI2",57,0)
SCHG ; Change Array LEXSCHG (Some or all, but never nothing)
"RTN","LEXXGI2",58,0)
 N FI,ID K LEXSCHG S LEXCHG=0
"RTN","LEXXGI2",59,0)
 N FI S FI=0 F  S FI=$O(^LEXM(FI)) Q:+FI'>0  D
"RTN","LEXXGI2",60,0)
 . S ID=$S(FI=80!(FI=80.1):"ICD",FI=81!(FI=81.1)!(FI=81.2)!(FI=81.3):"CPT",$P(FI,".",1)=757:"LEX",1:"UNK")
"RTN","LEXXGI2",61,0)
 . S LEXSCHG(FI,0)=+($G(^LEXM(FI,0))),LEXSCHG("B",FI)="" S LEXSCHG("C",ID,FI)=""
"RTN","LEXXGI2",62,0)
 S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")=""
"RTN","LEXXGI2",63,0)
 S:$D(^LEXM(80))!($D(^LEXM(80.1)))!($D(^LEXM(81)))!($D(^LEXM(81.2)))!($D(^LEXM(81.3)))!($D(LEXSCHG("D","PRO"))) LEXCHG=1,LEXSCHG(0)=1
"RTN","LEXXGI2",64,0)
 D:$O(LEXSCHG(0))'>0 SALL S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")=""
"RTN","LEXXGI2",65,0)
 Q
"RTN","LEXXGI2",66,0)
SALL ;   Set All (ICD/CPT/Lexicon)
"RTN","LEXXGI2",67,0)
 D SICD,SCPT,SLEX
"RTN","LEXXGI2",68,0)
 Q
"RTN","LEXXGI2",69,0)
SICD ;   Set ICD
"RTN","LEXXGI2",70,0)
 S (LEXSCHG("80",0),LEXSCHG("B","80"),LEXSCHG("C","ICD","80"))="",(LEXSCHG("80.1",0),LEXSCHG("B","80.1"),LEXSCHG("C","ICD","80.1"))="" D SLEX
"RTN","LEXXGI2",71,0)
 Q
"RTN","LEXXGI2",72,0)
SCPT ;   Set CPT
"RTN","LEXXGI2",73,0)
 S (LEXSCHG("81",0),LEXSCHG("B","81"),LEXSCHG("C","CPT","81"))="",(LEXSCHG("81.1",0),LEXSCHG("B","81.1"),LEXSCHG("C","CPT","81.1"))=""
"RTN","LEXXGI2",74,0)
 S (LEXSCHG("81.2",0),LEXSCHG("B","81.2"),LEXSCHG("C","CPT","81.2"))="",(LEXSCHG("81.3",0),LEXSCHG("B","81.3"),LEXSCHG("C","CPT","81.3"))="" D SLEX
"RTN","LEXXGI2",75,0)
 Q
"RTN","LEXXGI2",76,0)
SLEX ;   Set Lexicon
"RTN","LEXXGI2",77,0)
 S (LEXSCHG("757",0),LEXSCHG("B","757"),LEXSCHG("C","LEX","757"))="",(LEXSCHG("757.001",0),LEXSCHG("B","757.001"),LEXSCHG("C","LEX","757.001"))=""
"RTN","LEXXGI2",78,0)
 S (LEXSCHG("757.01",0),LEXSCHG("B","757.01"),LEXSCHG("C","LEX","757.01"))="",(LEXSCHG("757.02",0),LEXSCHG("B","757.02"),LEXSCHG("C","LEX","757.02"))=""
"RTN","LEXXGI2",79,0)
 S (LEXSCHG("757.1",0),LEXSCHG("B","757.1"),LEXSCHG("C","LEX","757.1"))=""
"RTN","LEXXGI2",80,0)
 Q
"RTN","LEXXGI2",81,0)
CS ;   Checksum for import global
"RTN","LEXXGI2",82,0)
 N LEXCHK,LEXNDS,LEXVER S LEXCHK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEXXGI2",83,0)
 W !,"   Running checksum routine on the ^LEXM import global, please wait"
"RTN","LEXXGI2",84,0)
 S LEXNDS=+($G(^LEXM(0,"NODES"))),LEXVER=+($$VC(LEXCHK,LEXNDS)) W !
"RTN","LEXXGI2",85,0)
 W:LEXVER>0 !,"     Checksum is ok",! Q:LEXVER>0
"RTN","LEXXGI2",86,0)
 I LEXVER=0 W !!,"   Import global ^LEXM is missing.  Please obtain a copy of ^LEXM before",!,"   continuing." Q
"RTN","LEXXGI2",87,0)
 I LEXVER<0 D  Q
"RTN","LEXXGI2",88,0)
 . I LEXVER'=-3 W !,"   Unable to verify checksum for import global ^LEXM (possibly corrupt)"
"RTN","LEXXGI2",89,0)
 . I LEXVER=-3 W !,"   Import global ^LEXM failed checksum"
"RTN","LEXXGI2",90,0)
 . W !!,"     Please KILL the existing import global ^LEXM from your system and"
"RTN","LEXXGI2",91,0)
 . W !,"     obtain a new copy of ^LEXM before continuing with the installation."
"RTN","LEXXGI2",92,0)
 Q
"RTN","LEXXGI2",93,0)
VC(X,Y) ;   Verify Checksum for import global
"RTN","LEXXGI2",94,0)
 Q:'$D(^LEXM)!('$D(^LEXM(0)))!($O(^LEXM(0))'>0) 0  N LEXCHK,LEXNDS,LEXCNT,LEXLC,LEXL,LEXS,LEXNC,LEXD,LEXN,LEXC,LEXGCS,LEXP,LEXT
"RTN","LEXXGI2",95,0)
 S LEXCHK=+($G(X)),LEXNDS=+($G(Y)) Q:LEXCHK'>0!(LEXNDS'>0) -2  S LEXL=64,(LEXCNT,LEXLC)=0,LEXS=(+(LEXNDS\LEXL))
"RTN","LEXXGI2",96,0)
 S:LEXS=0 LEXS=1 W:+($O(^LEXM(0)))>0 ! S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0 W "   "
"RTN","LEXXGI2",97,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEXXGI2",98,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"  Q:LEXN="^LEXM(0,""NODES"")"  S LEXCNT=LEXCNT+1
"RTN","LEXXGI2",99,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEXXGI2",100,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD F LEXP=1:1:$L(LEXT) S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEXXGI2",101,0)
 Q:LEXNC'=LEXNDS -3  Q:LEXGCS'=LEXCHK -3
"RTN","LEXXGI2",102,0)
 Q 1
"RTN","LEXXGI2",103,0)
 ; Miscellaneous
"RTN","LEXXGI2",104,0)
NF ;   Import Global Not Found
"RTN","LEXXGI2",105,0)
 D PB(" Import Global ^LEXM not found, consult the installation instructions")
"RTN","LEXXGI2",106,0)
 D TL(" to install this global")
"RTN","LEXXGI2",107,0)
 Q
"RTN","LEXXGI2",108,0)
IG ;   Invalid Import Global
"RTN","LEXXGI2",109,0)
 D PB(" Invalid Import Global ^LEXM, please consult the installation")
"RTN","LEXXGI2",110,0)
 D TL(" instructions to reload this global")
"RTN","LEXXGI2",111,0)
 Q
"RTN","LEXXGI2",112,0)
BL ;   Blank Line
"RTN","LEXXGI2",113,0)
 N X S X="" W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(X) Q
"RTN","LEXXGI2",114,0)
PB(X) ;   Preceeding Blank Line
"RTN","LEXXGI2",115,0)
 S X=$G(X) Q:'$L(X)  W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) Q
"RTN","LEXXGI2",116,0)
TL(X) ;   Text Line
"RTN","LEXXGI2",117,0)
 S X=$G(X) Q:'$L(X)  W:'$D(XPDNM) !,X D:$D(XPDNM) MES^XPDUTL(X) Q
"RTN","LEXXGI2",118,0)
HACK(X) ;   Time
"RTN","LEXXGI2",119,0)
 S X=$$NOW^XLFDT Q X
"RTN","LEXXGI2",120,0)
ELAP(X1,X2) ;   Elapsed Time
"RTN","LEXXGI2",121,0)
 N X S X=$$FMDIFF^XLFDT(+($G(X2)),+($G(X1)),3)
"RTN","LEXXGI2",122,0)
 S:X="" X="00:00:00" S X=$TR(X," ","0") S X1=X Q X1
"RTN","LEXXGI2",123,0)
 Q
"RTN","LEXXGI2",124,0)
KLEXM ;   Subscripted Kill of ^LEXM - files only
"RTN","LEXXGI2",125,0)
 N LEX S LEX=0 F  S LEX=$O(^LEXM(LEX)) Q:+LEX'>0  K ^LEXM(LEX)
"RTN","LEXXGI2",126,0)
 Q
"RTN","LEXXGI2",127,0)
KALL ;   Subscripted Kill of ^LEXM - all
"RTN","LEXXGI2",128,0)
 K LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXB,LEXCD,LEXSTR,LEXLAST
"RTN","LEXXGI2",129,0)
 K %,%DT,C,D,D0,D1,D2,DG,DIC,DICR,DILOCKTM,DIW,IREC,J,XMDUN,XMZ,ZTSK N LEX
"RTN","LEXXGI2",130,0)
 S LEX=0 F  S LEX=$O(^LEXM(LEX)) Q:+LEX'>0  K ^LEXM(LEX)
"RTN","LEXXGI2",131,0)
 K ^LEXM(0)
"RTN","LEXXGI2",132,0)
 Q
"RTN","LEXXGI2",133,0)
 ;   Error Text
"RTN","LEXXGI2",134,0)
ET(X) ;     Save Text
"RTN","LEXXGI2",135,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)=$G(X),LEXE(0)=LEXI Q
"RTN","LEXXGI2",136,0)
ED ;     Display Text
"RTN","LEXXGI2",137,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  W !,LEXE(LEXI)
"RTN","LEXXGI2",138,0)
 W ! K LEXE
"RTN","LEXXGI2",139,0)
 Q
"RTN","LEXXGI2",140,0)
 ;   Case
"RTN","LEXXGI2",141,0)
MIX(X) ;     Mixed Case
"RTN","LEXXGI2",142,0)
 S X=$G(X) N LEXT,LEXI S LEXT=""
"RTN","LEXXGI2",143,0)
 F LEXI=1:1:$L(X," ") S LEXT=LEXT_" "_$$UP($E($P(X," ",LEXI),1))_$$LO($E($P(X," ",LEXI),2,$L($P(X," ",LEXI))))
"RTN","LEXXGI2",144,0)
 F  Q:$E(LEXT,1)'=" "  S LEXT=$E(LEXT,2,$L(LEXT))
"RTN","LEXXGI2",145,0)
 S:$E(LEXT,1,3)="Cpt" LEXT="CPT"_$E(LEXT,4,$L(LEXT)) S:$E(LEXT,1,3)="Icd" LEXT="ICD"_$E(LEXT,4,$L(LEXT)) S X=LEXT
"RTN","LEXXGI2",146,0)
 Q X
"RTN","LEXXGI2",147,0)
UP(X) ;     Uppercase
"RTN","LEXXGI2",148,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","LEXXGI2",149,0)
LO(X) ;     Lowercase
"RTN","LEXXGI2",150,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","LEXXGI2",151,0)
WP(LEX,L) ;   Wrap Text LEX with Length L
"RTN","LEXXGI2",152,0)
 K ^UTILITY($J,"W") N %,CT,DA,DIC,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,DTOUT,DUOUT,LENGTH,TI,X,Z,END,I
"RTN","LEXXGI2",153,0)
 S TI=0,LENGTH=+($G(L)) F  S TI=$O(LEX(TI)) Q:+TI'>0  D
"RTN","LEXXGI2",154,0)
 . N X,DIWX,DN,DTOUT,DUOUT S X=$G(LEX(TI)),DIWL=1,DIWF="C78" S:+($G(LENGTH))>0 DIWF="C"_+($G(LENGTH)) D ^DIWP
"RTN","LEXXGI2",155,0)
 K LEX S (CT,I)=0 F  S I=$O(^UTILITY($J,"W",1,I)) Q:+I=0  D
"RTN","LEXXGI2",156,0)
 . S X=$G(^UTILITY($J,"W",1,I,0)),CT=CT+1,LEX(CT)=$$TRIM(X)
"RTN","LEXXGI2",157,0)
 K ^UTILITY($J,"W")
"RTN","LEXXGI2",158,0)
 Q
"RTN","LEXXGI2",159,0)
CLR ;   Clear
"RTN","LEXXGI2",160,0)
 K %,%DT,C,CT,D,D0,D1,D2,DA,DG,DIC,DICR,DILOCKTM,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,DTOUT
"RTN","LEXXGI2",161,0)
 K DUOUT,END,FI,I,ID,IREC,J,L,LENGTH,LEX,LEX1,LEX2,LEX3,LEXB,LEXBUILD,LEXC,LEXCD,LEXCHG,LEXCHK,LEXCNT
"RTN","LEXXGI2",162,0)
 K LEXD,LEXE,LEXF,LEXFI,LEXFY,LEXGCS,LEXI,LEXID,LEXIGHF,LEXL,LEXLAST,LEXLC,LEXLREV,LEXN,LEXNC,LEXNDS,LEXP
"RTN","LEXXGI2",163,0)
 K LEXPTYPE,LEXQTR,LEXREQP,LEXS,LEXSCHG,LEXSTR,LEXT,LEXU,LEXUP,LEXVER,LEXX,TI,X,X1,X2,XMDUN,XMZ,Y,Z,ZTSK
"RTN","LEXXGI2",164,0)
 Q
"RTN","LEXXGI2",165,0)
TRIM(X) ;   Trim Spaces
"RTN","LEXXGI2",166,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEXXGI2",167,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEXXGI2",168,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","LEXXGI2",169,0)
 Q X
"RTN","LEXXII")
0^5^B35261547^B33731148
"RTN","LEXXII",1,0)
LEXXII ;ISL/KER - Lexicon Status (Install Info) ;06/06/2007
"RTN","LEXXII",2,0)
 ;;2.0;LEXICON UTILITY;**32,46,49,50**;Sep 23, 1996
"RTN","LEXXII",3,0)
 ;              
"RTN","LEXXII",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEXXII",5,0)
 ;   LEXACCT  NEWed by LEXXFI sending message
"RTN","LEXXII",6,0)
 ;   LEXID    NEWed by LEXXFI sending message
"RTN","LEXXII",7,0)
 ;   LEXCRE   NEWed by LEXXGI loading data
"RTN","LEXXII",8,0)
 ;   LEXIGHF  NEWed by Post Install routine LEX20nnP
"RTN","LEXXII",9,0)
 ;   XPDA     NEWed by KIDS during Install
"RTN","LEXXII",10,0)
 ;              
"RTN","LEXXII",11,0)
 ; Global Variables
"RTN","LEXXII",12,0)
 ;   DBIA 10096  ^%ZOSF("PROD"
"RTN","LEXXII",13,0)
 ;   DBIA 10096  ^%ZOSF("UCI"
"RTN","LEXXII",14,0)
 ;   DBIA 10060  ^VA(200
"RTN","LEXXII",15,0)
 ;   ^LEXM(0
"RTN","LEXXII",16,0)
 ;   ^TMP("LEX*",$J    SACC 2.3.2.5.1
"RTN","LEXXII",17,0)
 ;              
"RTN","LEXXII",18,0)
 ; External References
"RTN","LEXXII",19,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXII",20,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXII",21,0)
 ;   DBIA 10103  $$FMDIFF^XLFDT
"RTN","LEXXII",22,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","LEXXII",23,0)
 ;   DBIA  2051  FIND^DIC
"RTN","LEXXII",24,0)
 ;   DBIA  2056  GETS^DIQ
"RTN","LEXXII",25,0)
 ;              
"RTN","LEXXII",26,0)
EN ; Main Entry
"RTN","LEXXII",27,0)
 N LEXSUB S LEXSUB=$G(LEXID) S:LEXSUB="" LEXSUB="LEXXII" K ^TMP(LEXSUB,$J) D II
"RTN","LEXXII",28,0)
 Q
"RTN","LEXXII",29,0)
 ;                               
"RTN","LEXXII",30,0)
II ; Install Information
"RTN","LEXXII",31,0)
 N LEXT,LEXA,LEXACT,LEXB,LEXD,LEXE,LEXL,LEXU,LEXN,LEXP,LEXPROF,LEXDA H 2
"RTN","LEXXII",32,0)
 S LEXA="",LEXACT=$G(LEXACCT),LEXPRO=$G(LEXPRO),LEXPRON=$G(LEXPRON)
"RTN","LEXXII",33,0)
 S:'$L(LEXPRON) LEXPRON="LEXICAL SERVICES UPDATE" S:'$L(LEXPRO) LEXPRO=$G(^LEXM(0,"PRO")) S:+LEXPRO>0 LEXPRO=$$ED(LEXPRO)
"RTN","LEXXII",34,0)
 S LEXT="Lexicon/ICD/CPT Installation" D TL(LEXT)
"RTN","LEXXII",35,0)
 S LEXT="============================" D TL(LEXT),BL
"RTN","LEXXII",36,0)
 S LEXD=$$ASOF,LEXA=$$UCI,LEXU=$$USR,LEXN=$P(LEXU,"^",1)
"RTN","LEXXII",37,0)
 S:$L($P(LEXACT,"^",1))&($L($P(LEXACT,"^",1))) LEXA=LEXACT
"RTN","LEXXII",38,0)
 S LEXP=$P(LEXU,"^",2),LEXN=$$PM^LEXXFI7(LEXN)
"RTN","LEXXII",39,0)
 S:$L(LEXD) LEXT="  As of:       "_LEXD
"RTN","LEXXII",40,0)
 D:$L(LEXD) TL(LEXT)
"RTN","LEXXII",41,0)
 S LEXT="" S:$L(LEXA) LEXT="  In Account:  "_$S($L($P(LEXA,"^",1)):"[",1:"")_$P(LEXA,"^",1)_$S($L($P(LEXA,"^",2)):"]",1:"")
"RTN","LEXXII",42,0)
 S:$L(LEXT)&($L($P(LEXA,"^",2))) LEXT=LEXT_"  "_$P(LEXA,"^",2)
"RTN","LEXXII",43,0)
 D:$L(LEXA) TL(LEXT)
"RTN","LEXXII",44,0)
 S LEXT="" S:$L(LEXU) LEXT="  Maint By:    "
"RTN","LEXXII",45,0)
 S:$L(LEXN) LEXT=LEXT_LEXN
"RTN","LEXXII",46,0)
 S:$L(LEXP)&($L(LEXN)) LEXT=LEXT_"   "_LEXP
"RTN","LEXXII",47,0)
 D:$L(LEXT)&(LEXT'["UNKNOWN") TL(LEXT)
"RTN","LEXXII",48,0)
 S LEXT="" S:$L($G(LEXBUILD)) LEXT="  Build:       "_$G(LEXBUILD)
"RTN","LEXXII",49,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",50,0)
 S LEXT="" S:$L($G(LEXIGHF)) LEXT="  Host File:   "_$G(LEXIGHF)
"RTN","LEXXII",51,0)
 S:$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT=LEXT_" (Created "_$$ED($G(LEXCRE))_")"
"RTN","LEXXII",52,0)
 S:'$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT="  Created:     "_$$ED($G(LEXCRE))
"RTN","LEXXII",53,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",54,0)
 S LEXT="" I $L($G(LEXPRO))&($L($G(LEXPRON))) D
"RTN","LEXXII",55,0)
 . S LEXT="  Protocol:    "_LEXPRON D BL,TL(LEXT)
"RTN","LEXXII",56,0)
 . S LEXT="  Invoked:     "_LEXPRO D TL(LEXT)
"RTN","LEXXII",57,0)
 . K LEXPRO,LEXPRON,^LEXM(0,"PRO")
"RTN","LEXXII",58,0)
 S LEXB=$$SS($G(LEXBUILD)),LEXE=$P(LEXB,"^",2),LEXL=$P(LEXB,"^",3),LEXB=$P(LEXB,"^",1)
"RTN","LEXXII",59,0)
 I $P(LEXB,".",1)?7N!($P(LEXB,".",2)?7N)!($P(LEXB,".",3)[":") D
"RTN","LEXXII",60,0)
 . D BL
"RTN","LEXXII",61,0)
 . I $P(LEXB,".",1)?7N D
"RTN","LEXXII",62,0)
 . . S LEXT="" S LEXT="  Started:     "_$$ED($G(LEXB)) D TL(LEXT)
"RTN","LEXXII",63,0)
 . I $P(LEXE,".",1)?7N D
"RTN","LEXXII",64,0)
 . . S LEXT="" S LEXT="  Finished:    "_$$ED($G(LEXE)) D TL(LEXT)
"RTN","LEXXII",65,0)
 . I $L(LEXL) D
"RTN","LEXXII",66,0)
 . . S LEXT="" S LEXT="  Elapsed:     "_$$ED($G(LEXL)) D TL(LEXT)
"RTN","LEXXII",67,0)
 D BL
"RTN","LEXXII",68,0)
 Q
"RTN","LEXXII",69,0)
 ;                             
"RTN","LEXXII",70,0)
 ; Miscellaneous
"RTN","LEXXII",71,0)
UCI(X) ;   UCI where Lexicon is installed
"RTN","LEXXII",72,0)
 N LEXU,LEXP,LEXT,Y X ^%ZOSF("UCI") S LEXU=Y,LEXP="" S:LEXU=^%ZOSF("PROD")!($P(LEXU,",",1)=^%ZOSF("PROD")) LEXP=" (Production)"
"RTN","LEXXII",73,0)
 S:LEXU'=^%ZOSF("PROD")&($P(LEXU,",",1)'=^%ZOSF("PROD")) LEXP=" (Test)" S X="",$P(X,"^",1)=LEXU,$P(X,"^",2)=LEXP
"RTN","LEXXII",74,0)
 Q X
"RTN","LEXXII",75,0)
USR(LEX) ;   User/Person
"RTN","LEXXII",76,0)
 N LEXDUZ,LEXPH,LEXNM
"RTN","LEXXII",77,0)
 S LEX=+($G(DUZ)),LEXNM=$$GET1^DIQ(200,+LEX,.01) Q:'$L(LEXNM) "UNKNOWN^"
"RTN","LEXXII",78,0)
 S LEXDUZ=LEX S LEXPH=$$GET1^DIQ(200,+LEXDUZ,.132) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.131)
"RTN","LEXXII",79,0)
 S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.133) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.134)
"RTN","LEXXII",80,0)
 S LEXDUZ=$$GET1^DIQ(200,+LEX,.01),LEX=LEXDUZ_"^"_LEXPH Q LEX
"RTN","LEXXII",81,0)
SS(LEX) ;   Start/Stop Times
"RTN","LEXXII",82,0)
 N LEXDA,LEXOUT,LEXIENS,LEXB,LEXBUILD,LEXB,LEXE,LEXL
"RTN","LEXXII",83,0)
 S LEXBUILD=$G(LEX),LEXD=0 S:$L(LEXBUILD) LEXD=$$DDA(LEXBUILD)
"RTN","LEXXII",84,0)
 S LEXDA=+($G(XPDA))
"RTN","LEXXII",85,0)
 I +LEXDA>0 D
"RTN","LEXXII",86,0)
 . S LEXIENS=LEXDA_","
"RTN","LEXXII",87,0)
 . D GETS^DIQ(9.7,LEXIENS,"11;17","I","LEXOUT")
"RTN","LEXXII",88,0)
 . S LEXL=0,LEXB=$G(LEXOUT(9.7,LEXIENS,11,"I"))
"RTN","LEXXII",89,0)
 . S LEXE=$G(LEXOUT(9.7,LEXIENS,17,"I"))
"RTN","LEXXII",90,0)
 . S:+LEXE'>0 LEXE=$$NOW^XLFDT
"RTN","LEXXII",91,0)
 . S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",92,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",93,0)
 I +LEXDA=0 D
"RTN","LEXXII",94,0)
 . S LEX="" S LEXDA=+($G(LEXD)) Q:+LEXDA'>0
"RTN","LEXXII",95,0)
 . S LEXL="",LEXB=$P($G(LEXD),"^",2) Q:$P(LEXB,".",1)'?7N
"RTN","LEXXII",96,0)
 . S LEXE=$P($G(LEXD),"^",3) Q:$P(LEXE,".",1)'?7N
"RTN","LEXXII",97,0)
 . S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",98,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",99,0)
 Q LEX
"RTN","LEXXII",100,0)
DDA(LEX) ;   Get Default DA of Build LEX
"RTN","LEXXII",101,0)
 N LEXB,LEXE,LEXOUT,LEXMSG,LEXI S LEXB=$G(LEX) Q:'$L(LEXB) ""
"RTN","LEXXII",102,0)
 D FIND^DIC(9.7,,"11I;17I","BP",LEXB,,"B",,,"LEXOUT","LEXMSG")
"RTN","LEXXII",103,0)
 S LEXI=+($O(LEXOUT("DILIST"," "),-1))
"RTN","LEXXII",104,0)
 S LEXB=$G(LEXOUT("DILIST",+LEXI,0))
"RTN","LEXXII",105,0)
 S LEXI=$P(LEXB,"^",1),LEXE=$P(LEXB,"^",4),LEXB=$P(LEXB,"^",3)
"RTN","LEXXII",106,0)
 Q:+($G(LEXI))'>0 ""  Q:+($G(LEXB))'>0 ""  S:+LEXE'>0 LEXE=$$NOW^XLFDT
"RTN","LEXXII",107,0)
 S LEX=LEXI_"^"_LEXB_"^"_LEXE
"RTN","LEXXII",108,0)
 Q LEX
"RTN","LEXXII",109,0)
ASOF(LEX) ;   As of date/time
"RTN","LEXXII",110,0)
 S X=$$ED($$NOW^XLFDT) Q X
"RTN","LEXXII",111,0)
ED(LEX) ;   External Date MM/DD/YYYY TT:TT
"RTN","LEXXII",112,0)
 S LEX=$$FMTE^XLFDT($G(LEX),"1Z")
"RTN","LEXXII",113,0)
 S:LEX["@" LEX=$P(LEX,"@",1)_"  "_$P(LEX,"@",2,299) Q LEX
"RTN","LEXXII",114,0)
 Q LEX
"RTN","LEXXII",115,0)
EP(X,Y) ;   Elapsed Time (Begin, End)
"RTN","LEXXII",116,0)
 N LEXTIM,LEXBEG,LEXEND
"RTN","LEXXII",117,0)
 S LEXBEG=$G(X),LEXEND=$G(Y) Q:+LEXBEG'>0 ""  Q:+LEXEND'>0 ""
"RTN","LEXXII",118,0)
 S LEXTIM=$$FMDIFF^XLFDT(LEXEND,LEXBEG,2) Q:+LEXTIM'>0 "00:00:00"
"RTN","LEXXII",119,0)
 S LEXTIM=$$TIM(LEXTIM)
"RTN","LEXXII",120,0)
 Q LEXTIM
"RTN","LEXXII",121,0)
TIM(X) ;   Format Time Elapsed
"RTN","LEXXII",122,0)
 N LEXD,LEXH,LEXM,LEXS,LEXT,LEXV S X=+($G(X)) Q:X'>0 "00:00:00"
"RTN","LEXXII",123,0)
 S LEXD=X\86400 S LEXV=LEXD*86400 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",124,0)
 S LEXH=X\3600 S LEXV=LEXH*3600 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",125,0)
 S:$L(LEXH)<2 LEXH="0"_LEXH S:$L(LEXH)<2 LEXH="0"_LEXH
"RTN","LEXXII",126,0)
 S LEXM=X\60 S LEXV=LEXM*60 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",127,0)
 S:$L(LEXM)<2 LEXM="0"_LEXM S:$L(LEXM)<2 LEXM="0"_LEXM
"RTN","LEXXII",128,0)
 S LEXS=X S:$L(LEXS)<2 LEXS="0"_LEXS S:$L(LEXS)<2 LEXS="0"_LEXS
"RTN","LEXXII",129,0)
 S LEXT="" S:+LEXD>0 LEXT=+LEXD_" day"_$S(+LEXD>1:"s",1:"")_" "
"RTN","LEXXII",130,0)
 S LEXT=LEXT_LEXH_":"_LEXM_":"_LEXS,X=LEXT
"RTN","LEXXII",131,0)
 Q X
"RTN","LEXXII",132,0)
BL ;   Blank Line
"RTN","LEXXII",133,0)
 D TL("") Q
"RTN","LEXXII",134,0)
TL(LEXX) ;   Text Line
"RTN","LEXXII",135,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",136,0)
 I '$D(^TMP(LEXSUB,$J,1)) S ^TMP(LEXSUB,$J,1)=" ",^TMP(LEXSUB,$J,0)=1
"RTN","LEXXII",137,0)
 N LEXNX S LEXNX=$O(^TMP(LEXSUB,$J," "),-1),LEXNX=LEXNX+1
"RTN","LEXXII",138,0)
 S ^TMP(LEXSUB,$J,LEXNX)=" "_$G(LEXX),^TMP(LEXSUB,$J,0)=LEXNX
"RTN","LEXXII",139,0)
 Q
"RTN","LEXXII",140,0)
ST ;   Show Temp Array
"RTN","LEXXII",141,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",142,0)
 N LEXN,LEXC S LEXN="^TMP("""_LEXSUB_""","_$J_")",LEXC="^TMP("""_LEXSUB_""","_$J_","
"RTN","LEXXII",143,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEXXII",144,0)
 . Q:LEXN[",0)"  W !,@LEXN
"RTN","LEXXII",145,0)
 Q
"VER")
8.0^22.0
"BLD",5874,6)
^48
**END**
**END**
