Released PSX*2*63 SEQ #56
Extracted from mail message
**KIDS**:PSX*2.0*63^

**INSTALL NAME**
PSX*2.0*63
"BLD",6932,0)
PSX*2.0*63^CMOP^0^3070517^y
"BLD",6932,1,0)
^^24^24^3070517^
"BLD",6932,1,1,0)
The general purpose of this patch is to meet the requirements in support 
"BLD",6932,1,2,0)
of the Phase 4 ePharmacy enhancements. This patch is one of five to be 
"BLD",6932,1,3,0)
released.  Three patches will be released in the KIDS multi-build 
"BLD",6932,1,4,0)
distribution, BPS PSO IB BUNDLE 2.0, containing: BPS*1*5, IB*2*363,
"BLD",6932,1,5,0)
PSO*7*260.  PSX*2*63 and PSS*1*127 will be released as stand-alone 
"BLD",6932,1,6,0)
patches. The recommended order for installing the patches is to install
"BLD",6932,1,7,0)
the stand-alone patch first and multi-build must be installed afterwards.
"BLD",6932,1,8,0)
since there is a implementation dependency between the multi-build 
"BLD",6932,1,9,0)
distribution and the stand-alone patch.  For more specific instructions 
"BLD",6932,1,10,0)
please refer to the installation steps provided in each of the stand-alone
"BLD",6932,1,11,0)
patches.
"BLD",6932,1,12,0)
 
"BLD",6932,1,13,0)
The software changes distributed by this patch are exclusively for
"BLD",6932,1,14,0)
supporting the Electronic Claims Management Engine (ECME) application for
"BLD",6932,1,15,0)
the ePharmacy/ECME Enhancements project (BPS*1*4). There is no functional
"BLD",6932,1,16,0)
impact to the Consolidated Mailout Outpatient Pharmacy (CMOP) application.
"BLD",6932,1,17,0)
The change is technical in nature and is explained below:
"BLD",6932,1,18,0)
 
"BLD",6932,1,19,0)
  The PSXBPSRP routine was created to replace the BPSCEAR routine, which
"BLD",6932,1,20,0)
  was previously used by ECME to run the CMOP/ECME Activity Report [BPS 
"BLD",6932,1,21,0)
RPT
"BLD",6932,1,22,0)
  CMOP/ECME ACTIVITY] option. This option will be changed to call the 
"BLD",6932,1,23,0)
  PSXBPSRP routine instead. This call is supported by the Database
"BLD",6932,1,24,0)
  Integration Agreement #4968.
"BLD",6932,4,0)
^9.64PA^^
"BLD",6932,6.3)
8
"BLD",6932,"KRN",0)
^9.67PA^8989.52^19
"BLD",6932,"KRN",.4,0)
.4
"BLD",6932,"KRN",.401,0)
.401
"BLD",6932,"KRN",.402,0)
.402
"BLD",6932,"KRN",.403,0)
.403
"BLD",6932,"KRN",.5,0)
.5
"BLD",6932,"KRN",.84,0)
.84
"BLD",6932,"KRN",3.6,0)
3.6
"BLD",6932,"KRN",3.8,0)
3.8
"BLD",6932,"KRN",9.2,0)
9.2
"BLD",6932,"KRN",9.8,0)
9.8
"BLD",6932,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6932,"KRN",9.8,"NM",1,0)
PSXBPSRP^^0^B75301229
"BLD",6932,"KRN",9.8,"NM",2,0)
PSXBPSUT^^0^B5692316
"BLD",6932,"KRN",9.8,"NM","B","PSXBPSRP",1)

"BLD",6932,"KRN",9.8,"NM","B","PSXBPSUT",2)

"BLD",6932,"KRN",19,0)
19
"BLD",6932,"KRN",19.1,0)
19.1
"BLD",6932,"KRN",101,0)
101
"BLD",6932,"KRN",409.61,0)
409.61
"BLD",6932,"KRN",771,0)
771
"BLD",6932,"KRN",870,0)
870
"BLD",6932,"KRN",8989.51,0)
8989.51
"BLD",6932,"KRN",8989.52,0)
8989.52
"BLD",6932,"KRN",8994,0)
8994
"BLD",6932,"KRN","B",.4,.4)

"BLD",6932,"KRN","B",.401,.401)

"BLD",6932,"KRN","B",.402,.402)

"BLD",6932,"KRN","B",.403,.403)

"BLD",6932,"KRN","B",.5,.5)

"BLD",6932,"KRN","B",.84,.84)

"BLD",6932,"KRN","B",3.6,3.6)

"BLD",6932,"KRN","B",3.8,3.8)

"BLD",6932,"KRN","B",9.2,9.2)

"BLD",6932,"KRN","B",9.8,9.8)

"BLD",6932,"KRN","B",19,19)

"BLD",6932,"KRN","B",19.1,19.1)

"BLD",6932,"KRN","B",101,101)

"BLD",6932,"KRN","B",409.61,409.61)

"BLD",6932,"KRN","B",771,771)

"BLD",6932,"KRN","B",870,870)

"BLD",6932,"KRN","B",8989.51,8989.51)

"BLD",6932,"KRN","B",8989.52,8989.52)

"BLD",6932,"KRN","B",8994,8994)

"BLD",6932,"QUES",0)
^9.62^^
"BLD",6932,"REQB",0)
^9.611^1^1
"BLD",6932,"REQB",1,0)
PSX*2.0*48^2
"BLD",6932,"REQB","B","PSX*2.0*48",1)

"MBREQ")
0
"PKG",534,-1)
1^1
"PKG",534,0)
CMOP^PSX
"PKG",534,20,0)
^9.402P^^
"PKG",534,22,0)
^9.49I^1^1
"PKG",534,22,1,0)
2.0^2990901^3061113^66481
"PKG",534,22,1,"PAH",1,0)
63^3070517^100877
"PKG",534,22,1,"PAH",1,1,0)
^^24^24^3070517
"PKG",534,22,1,"PAH",1,1,1,0)
The general purpose of this patch is to meet the requirements in support 
"PKG",534,22,1,"PAH",1,1,2,0)
of the Phase 4 ePharmacy enhancements. This patch is one of five to be 
"PKG",534,22,1,"PAH",1,1,3,0)
released.  Three patches will be released in the KIDS multi-build 
"PKG",534,22,1,"PAH",1,1,4,0)
distribution, BPS PSO IB BUNDLE 2.0, containing: BPS*1*5, IB*2*363,
"PKG",534,22,1,"PAH",1,1,5,0)
PSO*7*260.  PSX*2*63 and PSS*1*127 will be released as stand-alone 
"PKG",534,22,1,"PAH",1,1,6,0)
patches. The recommended order for installing the patches is to install
"PKG",534,22,1,"PAH",1,1,7,0)
the stand-alone patch first and multi-build must be installed afterwards.
"PKG",534,22,1,"PAH",1,1,8,0)
since there is a implementation dependency between the multi-build 
"PKG",534,22,1,"PAH",1,1,9,0)
distribution and the stand-alone patch.  For more specific instructions 
"PKG",534,22,1,"PAH",1,1,10,0)
please refer to the installation steps provided in each of the stand-alone
"PKG",534,22,1,"PAH",1,1,11,0)
patches.
"PKG",534,22,1,"PAH",1,1,12,0)
 
"PKG",534,22,1,"PAH",1,1,13,0)
The software changes distributed by this patch are exclusively for
"PKG",534,22,1,"PAH",1,1,14,0)
supporting the Electronic Claims Management Engine (ECME) application for
"PKG",534,22,1,"PAH",1,1,15,0)
the ePharmacy/ECME Enhancements project (BPS*1*4). There is no functional
"PKG",534,22,1,"PAH",1,1,16,0)
impact to the Consolidated Mailout Outpatient Pharmacy (CMOP) application.
"PKG",534,22,1,"PAH",1,1,17,0)
The change is technical in nature and is explained below:
"PKG",534,22,1,"PAH",1,1,18,0)
 
"PKG",534,22,1,"PAH",1,1,19,0)
  The PSXBPSRP routine was created to replace the BPSCEAR routine, which
"PKG",534,22,1,"PAH",1,1,20,0)
  was previously used by ECME to run the CMOP/ECME Activity Report [BPS 
"PKG",534,22,1,"PAH",1,1,21,0)
RPT
"PKG",534,22,1,"PAH",1,1,22,0)
  CMOP/ECME ACTIVITY] option. This option will be changed to call the 
"PKG",534,22,1,"PAH",1,1,23,0)
  PSXBPSRP routine instead. This call is supported by the Database
"PKG",534,22,1,"PAH",1,1,24,0)
  Integration Agreement #4968.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSXBPSRP")
0^1^B75301229^n/a
"RTN","PSXBPSRP",1,0)
PSXBPSRP ;BHAM ISC/MFR - CMOP/ECME ACTIVITY REPORT ;09/01/2006
"RTN","PSXBPSRP",2,0)
 ;;2.0;CMOP;**63**;11 Apr 97;Build 8
"RTN","PSXBPSRP",3,0)
 ;External reference to ^PSRX( supported by IA #1221
"RTN","PSXBPSRP",4,0)
 ;External reference to ^PS(59 supported by IA #1976
"RTN","PSXBPSRP",5,0)
 ;External reference to ^PSOBPSUT supported by IA #4701
"RTN","PSXBPSRP",6,0)
 ;External reference to ^BPSUTIL supported by IA #4410
"RTN","PSXBPSRP",7,0)
 ;External reference to ^IBNCPDPI supported by IA #4729
"RTN","PSXBPSRP",8,0)
 ; 
"RTN","PSXBPSRP",9,0)
EN ; Entry Point
"RTN","PSXBPSRP",10,0)
 N %,%ZIS,EXCEL,STDT,TERM,ENDT,DIVDA,DIVNM,DTOUT,I,LINE,POP,VA,VAERR
"RTN","PSXBPSRP",11,0)
 N X,Y,ZTDESC,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK
"RTN","PSXBPSRP",12,0)
 ;
"RTN","PSXBPSRP",13,0)
BDT ; - Prompt to select Date Range (Return: Start Date^End Date) 
"RTN","PSXBPSRP",14,0)
 S X=$$SELDATE() I X="^" S POP=1 G EXIT
"RTN","PSXBPSRP",15,0)
 S STDT=$P(X,U),ENDT=$P(X,U,2)
"RTN","PSXBPSRP",16,0)
 ;
"RTN","PSXBPSRP",17,0)
DIV ; - Get Division(s) (Return: DIVDA and DIVNM arrays)
"RTN","PSXBPSRP",18,0)
 D SELDIV I '$D(DIVNM) S POP=1 G EXIT
"RTN","PSXBPSRP",19,0)
 ;
"RTN","PSXBPSRP",20,0)
EXC ;- Prompt for Excel Capture
"RTN","PSXBPSRP",21,0)
 S EXCEL=$$EXCEL^PSXBPSUT() I EXCEL="^" S POP=1 G EXIT
"RTN","PSXBPSRP",22,0)
 ;
"RTN","PSXBPSRP",23,0)
DEV ; - Prompt for Device
"RTN","PSXBPSRP",24,0)
 W !! S %ZIS="MQ",%ZIS("A")="Select Printer: ",%ZIS("B")=""
"RTN","PSXBPSRP",25,0)
 D ^%ZIS I POP S POP=1 G EXIT
"RTN","PSXBPSRP",26,0)
 S TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSXBPSRP",27,0)
 I '$D(IO("Q")) G START
"RTN","PSXBPSRP",28,0)
 ;
"RTN","PSXBPSRP",29,0)
QUE ; - Process queue device
"RTN","PSXBPSRP",30,0)
 S ZTSAVE("*")=""
"RTN","PSXBPSRP",31,0)
 S ZTRTN="START^PSXBPSRP"
"RTN","PSXBPSRP",32,0)
 S ZTDESC="CMOP/ECME Activity Report"
"RTN","PSXBPSRP",33,0)
 D ^%ZTLOAD
"RTN","PSXBPSRP",34,0)
 W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","PSXBPSRP",35,0)
 D HOME^%ZIS
"RTN","PSXBPSRP",36,0)
 S TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSXBPSRP",37,0)
 G EXIT
"RTN","PSXBPSRP",38,0)
 ;
"RTN","PSXBPSRP",39,0)
 ;Report Processing Tag
"RTN","PSXBPSRP",40,0)
 ;
"RTN","PSXBPSRP",41,0)
START N BPFND,STDTE,ENDTE,LINE,POP,Y
"RTN","PSXBPSRP",42,0)
 S BPFND=0,LINE="W ! F I=1:1:80 W ""="""
"RTN","PSXBPSRP",43,0)
 U IO
"RTN","PSXBPSRP",44,0)
 ;
"RTN","PSXBPSRP",45,0)
 ;Excel Display - Print Header Record
"RTN","PSXBPSRP",46,0)
 I EXCEL D PLINEX
"RTN","PSXBPSRP",47,0)
 ;
"RTN","PSXBPSRP",48,0)
 S Y=STDT X ^DD("DD") S STDTE=Y
"RTN","PSXBPSRP",49,0)
 S Y=ENDT X ^DD("DD") S ENDTE=Y
"RTN","PSXBPSRP",50,0)
 ;
"RTN","PSXBPSRP",51,0)
 ;Loop through divisions and display
"RTN","PSXBPSRP",52,0)
 S DIVDA=0 F  S DIVDA=$O(DIVDA(DIVDA)) Q:DIVDA'>0  D ONEDIV(.BPFND,STDTE,ENDTE) Q:$G(POP)
"RTN","PSXBPSRP",53,0)
 ;
"RTN","PSXBPSRP",54,0)
 ;Make sure a record was printed
"RTN","PSXBPSRP",55,0)
 I '$G(POP),BPFND=0 D
"RTN","PSXBPSRP",56,0)
 .I 'EXCEL D TITLE
"RTN","PSXBPSRP",57,0)
 .W !,"NO DATA FOUND FOR CHOSEN PARAMETERS"
"RTN","PSXBPSRP",58,0)
 .I TERM,'EXCEL D PAUSE2
"RTN","PSXBPSRP",59,0)
 ;
"RTN","PSXBPSRP",60,0)
 I '$G(POP),'EXCEL S POP=2
"RTN","PSXBPSRP",61,0)
 G EXIT
"RTN","PSXBPSRP",62,0)
 ;
"RTN","PSXBPSRP",63,0)
ONEDIV(BPFND,STDTE,ENDTE) ; - Display information for one division
"RTN","PSXBPSRP",64,0)
 N %,PSXDT,TRX,PS,Y
"RTN","PSXBPSRP",65,0)
 S PSXDT=STDT-.1
"RTN","PSXBPSRP",66,0)
 F  S PSXDT=$O(^PSX(550.2,"D",PSXDT)) Q:'PSXDT!(PSXDT>(ENDT+.24))  D  Q:$G(POP)
"RTN","PSXBPSRP",67,0)
 .S (PS,TRX)=0 F  S TRX=$O(^PSX(550.2,"D",PSXDT,TRX)) Q:'TRX  D  Q:$G(POP)
"RTN","PSXBPSRP",68,0)
 . . N TEMP,DATA
"RTN","PSXBPSRP",69,0)
 . . D GETS^DIQ(550.2,TRX,".01;1;2;3;5;6;7;8;9;10;13;14","","TEMP")
"RTN","PSXBPSRP",70,0)
 . . M DATA=TEMP(550.2,TRX_",")
"RTN","PSXBPSRP",71,0)
 . . I $G(DATA(.01))="" Q
"RTN","PSXBPSRP",72,0)
 ..I '$D(DIVNM(DATA(2))) Q
"RTN","PSXBPSRP",73,0)
 ..I DATA(2)'=DIVDA(DIVDA) Q
"RTN","PSXBPSRP",74,0)
 ..;
"RTN","PSXBPSRP",75,0)
 ..;Set flag that at least one record was found
"RTN","PSXBPSRP",76,0)
 ..S BPFND=1
"RTN","PSXBPSRP",77,0)
 ..;
"RTN","PSXBPSRP",78,0)
 ..;Display Transmission Information - Normal Display Only
"RTN","PSXBPSRP",79,0)
 ..I 'EXCEL D
"RTN","PSXBPSRP",80,0)
 ...D TITLE
"RTN","PSXBPSRP",81,0)
 ...W !!,?7,"TRANSMISSION:",?35,DATA(.01)
"RTN","PSXBPSRP",82,0)
 ...W !,?7,"STATUS:",?35,DATA(1)
"RTN","PSXBPSRP",83,0)
 ...W !,?7,"DIVISION:",?35,DATA(2)
"RTN","PSXBPSRP",84,0)
 ...W !,?7,"CMOP SYSTEM:",?35,DATA(3)
"RTN","PSXBPSRP",85,0)
 ...W !,?7,"TRANSMISSION DATE/TIME:",?35,DATA(5)
"RTN","PSXBPSRP",86,0)
 ...I DATA(6) W !,?7,"CREATED DATE/TIME:",?35,DATA(6)
"RTN","PSXBPSRP",87,0)
 ...I DATA(7) W !,?7,"RECEIVED DATE/TIME:",?35,DATA(7)
"RTN","PSXBPSRP",88,0)
 ...I DATA(8) W !,?7,"RETRANSMISSION #:",?35,DATA(8)
"RTN","PSXBPSRP",89,0)
 ...I DATA(9) W !,?7,"ORIGINAL TRANS.:",?35,DATA(9)
"RTN","PSXBPSRP",90,0)
 ...I DATA(10) W !,?7,"CLOSED DATE/TIME:",?35,DATA(10)
"RTN","PSXBPSRP",91,0)
 ...W !,?7,"TOTAL PATIENTS:",?35,DATA(13)
"RTN","PSXBPSRP",92,0)
 ...W !,?7,"TOTAL RXS:",?35,DATA(14)
"RTN","PSXBPSRP",93,0)
 ..;
"RTN","PSXBPSRP",94,0)
 ..;Display Records in Normal Format
"RTN","PSXBPSRP",95,0)
 ..I 'EXCEL D  Q
"RTN","PSXBPSRP",96,0)
 ...S PS=$$PDET(TRX) Q:$G(POP)
"RTN","PSXBPSRP",97,0)
 ...I 'PS D CHKP(3) Q:$G(POP)  D NDAT
"RTN","PSXBPSRP",98,0)
 ...I TERM,'EXCEL D PAUSE Q:$G(POP)
"RTN","PSXBPSRP",99,0)
 ..;
"RTN","PSXBPSRP",100,0)
 ..;Display Records in Excel Format
"RTN","PSXBPSRP",101,0)
 ..D PDETEX(TRX)
"RTN","PSXBPSRP",102,0)
 Q
"RTN","PSXBPSRP",103,0)
 ;
"RTN","PSXBPSRP",104,0)
 ;Display Record(s) - Normal Format
"RTN","PSXBPSRP",105,0)
PDET(TRX) N BIEN,DFN,RFL,M,N,NDCR,NDCS,RXS,PS,RDT,RXI,VA
"RTN","PSXBPSRP",106,0)
 D PLINE
"RTN","PSXBPSRP",107,0)
 S (PS,RXS)=0 F  S RXS=$O(^PSX(550.2,TRX,15,RXS)) Q:'RXS  D  Q:$G(POP)
"RTN","PSXBPSRP",108,0)
 .S RXI=+$$GET1^DIQ(550.215,RXS_","_TRX,".01","I")
"RTN","PSXBPSRP",109,0)
 .S RFL=+$$GET1^DIQ(550.215,RXS_","_TRX,".02","I")
"RTN","PSXBPSRP",110,0)
 .S DFN=+$$GET1^DIQ(550.215,RXS_","_TRX,".03","I")
"RTN","PSXBPSRP",111,0)
 .Q:$$STATUS^PSOBPSUT(RXI,RFL)=""
"RTN","PSXBPSRP",112,0)
 .D CHKP(2) Q:$G(POP)
"RTN","PSXBPSRP",113,0)
 .S PS=1 D PID^VADPT
"RTN","PSXBPSRP",114,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(RFL))," ","0")_RFL,1,4)_1
"RTN","PSXBPSRP",115,0)
 .S RDT=$S(RFL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,RFL_","_RXI_",",17,"I"))
"RTN","PSXBPSRP",116,0)
 .W !,$E($$GET1^DIQ(2,DFN,.01),1,14)_" ("_$G(VA("BID"))_")"
"RTN","PSXBPSRP",117,0)
 .W ?22,RXI_"/"_$$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI)_"/"_RFL
"RTN","PSXBPSRP",118,0)
 .S (NDCS,NDCR)="",(M,N)=0
"RTN","PSXBPSRP",119,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=RFL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","PSXBPSRP",120,0)
 .W ?45,$E(NDCS,1,13),?59,$E(NDCR,1,13),?73,$S(RDT:"DISPENS",1:"TRANSMI")
"RTN","PSXBPSRP",121,0)
 .W !,?3,$E($$GET1^DIQ(52,RXI,6),1,18),?22,$$BPSPLN^BPSUTIL(RXI,RFL)
"RTN","PSXBPSRP",122,0)
 .W ?38,$E($$STATUS^PSOBPSUT(RXI,RFL),1,7),?48,$P($$BILLINFO^IBNCPDPI(RXI,RFL),"^",1)
"RTN","PSXBPSRP",123,0)
 .W ?58,$S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")
"RTN","PSXBPSRP",124,0)
 Q PS
"RTN","PSXBPSRP",125,0)
 ;
"RTN","PSXBPSRP",126,0)
 ;Display Record(s) - Excel Format
"RTN","PSXBPSRP",127,0)
PDETEX(TRX) N BIEN,DFN,RFL,M,N,NDCR,NDCS,RXS,PS,RDT,RXI,VA
"RTN","PSXBPSRP",128,0)
 S RXS=0 F  S RXS=$O(^PSX(550.2,TRX,15,RXS)) Q:'RXS  D
"RTN","PSXBPSRP",129,0)
 .S RXI=+$$GET1^DIQ(550.215,RXS_","_TRX,".01","I")
"RTN","PSXBPSRP",130,0)
 .S RFL=+$$GET1^DIQ(550.215,RXS_","_TRX,".02","I")
"RTN","PSXBPSRP",131,0)
 .S DFN=+$$GET1^DIQ(550.215,RXS_","_TRX,".03","I")
"RTN","PSXBPSRP",132,0)
 .Q:$$STATUS^PSOBPSUT(RXI,RFL)=""
"RTN","PSXBPSRP",133,0)
 .S PS=1 D PID^VADPT
"RTN","PSXBPSRP",134,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(RFL))," ","0")_RFL,1,4)_1
"RTN","PSXBPSRP",135,0)
 .S RDT=$S(RFL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,RFL_","_RXI_",",17,"I"))
"RTN","PSXBPSRP",136,0)
 .W !,DATA(.01),U  ;Transmission
"RTN","PSXBPSRP",137,0)
 .W DATA(1),U  ;Status
"RTN","PSXBPSRP",138,0)
 .W DATA(2),U  ;Division
"RTN","PSXBPSRP",139,0)
 .W DATA(3),U  ;CMOP System
"RTN","PSXBPSRP",140,0)
 .W DATA(5),U  ;Transmission Date/Time
"RTN","PSXBPSRP",141,0)
 .W $E($$GET1^DIQ(2,DFN,.01),1,14),U  ;Name
"RTN","PSXBPSRP",142,0)
 .W "("_$G(VA("BID"))_")",U  ;Pt.ID
"RTN","PSXBPSRP",143,0)
 .W RXI,U                             ;ECME#
"RTN","PSXBPSRP",144,0)
 .W $$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI),U  ;RX#
"RTN","PSXBPSRP",145,0)
 .W RFL,U                     ;RFL#
"RTN","PSXBPSRP",146,0)
 .N NDCS,NDCR,M,N S (NDCS,NDCR)="",(M,N)=0
"RTN","PSXBPSRP",147,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=RFL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","PSXBPSRP",148,0)
 .W $E(NDCS,1,13),U          ;NDC SENT
"RTN","PSXBPSRP",149,0)
 .W $E(NDCR,1,13),U          ;NDC RECVD
"RTN","PSXBPSRP",150,0)
 .W $S(RDT:"DISPENS",1:"TRANSMI"),U  ;CMOP-STAT
"RTN","PSXBPSRP",151,0)
 .W $E($$GET1^DIQ(52,RXI,6),1,18),U  ;DRUG
"RTN","PSXBPSRP",152,0)
 .W $$BPSPLN^BPSUTIL(RXI,RFL),U ;INSURANCE
"RTN","PSXBPSRP",153,0)
 .W $E($$STATUS^PSOBPSUT(RXI,RFL),1,7),U  ;PAY-STAT
"RTN","PSXBPSRP",154,0)
 .W $P($$BILLINFO^IBNCPDPI(RXI,RFL),"^"),U  ;BILL#
"RTN","PSXBPSRP",155,0)
 .W $S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")  ;REL-DATE
"RTN","PSXBPSRP",156,0)
 Q
"RTN","PSXBPSRP",157,0)
 ;
"RTN","PSXBPSRP",158,0)
 ;- Display Header - Normal
"RTN","PSXBPSRP",159,0)
PLINE W !,"NAME",?22,"ECME#/RX#/FL#",?45,"NDC SENT",?59,"NDC RECVD",?71,"CMOP-STAT"
"RTN","PSXBPSRP",160,0)
 W !,"   DRUG",?22,"INSURANCE",?38,"PAY-STAT",?48,"BILL#",?58,"REL-DATE"
"RTN","PSXBPSRP",161,0)
 X LINE
"RTN","PSXBPSRP",162,0)
 Q
"RTN","PSXBPSRP",163,0)
 ;
"RTN","PSXBPSRP",164,0)
 ;- Display Header - Excel
"RTN","PSXBPSRP",165,0)
PLINEX W !,"TRANSMISSION",U,"STATUS",U,"DIVISION",U,"CMOP SYSTEM",U,"TRANSMISSION DATE/TIME",U
"RTN","PSXBPSRP",166,0)
 W "NAME",U,"Pt.ID",U,"ECME#",U,"RX#",U,"FL#",U,"NDC SENT",U,"NDC RECVD",U,"CMOP-STAT",U
"RTN","PSXBPSRP",167,0)
 W "DRUG",U,"INSURANCE",U,"PAY-STAT",U,"BILL#",U,"REL-DATE"
"RTN","PSXBPSRP",168,0)
 Q
"RTN","PSXBPSRP",169,0)
 ;
"RTN","PSXBPSRP",170,0)
EXIT I '$G(POP) D PAUSE2
"RTN","PSXBPSRP",171,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","PSXBPSRP",172,0)
 I $G(POP)'=1 D ^%ZISC
"RTN","PSXBPSRP",173,0)
 Q
"RTN","PSXBPSRP",174,0)
 ;
"RTN","PSXBPSRP",175,0)
 ;- Print message if no billable prescriptions
"RTN","PSXBPSRP",176,0)
NDAT W !!,"********* BATCH HAS NO ECME BILLABLE PRESCRIPTIONS *******",!
"RTN","PSXBPSRP",177,0)
 Q
"RTN","PSXBPSRP",178,0)
 ;
"RTN","PSXBPSRP",179,0)
TITLE W @IOF
"RTN","PSXBPSRP",180,0)
 W !,?25,"CMOP/ECME ACTIVITY REPORT "_$S($G(BPFND)=1:"for "_$E(DIVDA(DIVDA),1,24),1:"")
"RTN","PSXBPSRP",181,0)
 W !,"For ",STDTE,"  thru  ",$P(ENDTE,"@"),?40,"Printed: ",$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","PSXBPSRP",182,0)
 X LINE
"RTN","PSXBPSRP",183,0)
 Q
"RTN","PSXBPSRP",184,0)
 ;
"RTN","PSXBPSRP",185,0)
CHKP(BPLINES) Q:$G(EXCEL)
"RTN","PSXBPSRP",186,0)
 S BPLINES=BPLINES+1
"RTN","PSXBPSRP",187,0)
 I $G(TERM) S BPLINES=BPLINES+2
"RTN","PSXBPSRP",188,0)
 I $Y>(IOSL-BPLINES) D:$G(TERM) PAUSE Q:$G(POP)  D TITLE,PLINE Q
"RTN","PSXBPSRP",189,0)
 Q
"RTN","PSXBPSRP",190,0)
 ;
"RTN","PSXBPSRP",191,0)
 ; Enter Date Range
"RTN","PSXBPSRP",192,0)
 ;
"RTN","PSXBPSRP",193,0)
 ; Return Value -> P1^P2
"RTN","PSXBPSRP",194,0)
 ; 
"RTN","PSXBPSRP",195,0)
 ;           where P1 = From Date
"RTN","PSXBPSRP",196,0)
 ;                    = ^ Exit
"RTN","PSXBPSRP",197,0)
 ;                 P2 = To Date
"RTN","PSXBPSRP",198,0)
 ;                    = blank for Exit
"RTN","PSXBPSRP",199,0)
 ;                 
"RTN","PSXBPSRP",200,0)
SELDATE() N DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","PSXBPSRP",201,0)
 S VAL=""
"RTN","PSXBPSRP",202,0)
 S DIR(0)="DA",DIR("A")="ENTER BEGINNING TRANSMISSION DATE: "
"RTN","PSXBPSRP",203,0)
 D ^DIR
"RTN","PSXBPSRP",204,0)
 ;
"RTN","PSXBPSRP",205,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSRP",206,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","PSXBPSRP",207,0)
 ;
"RTN","PSXBPSRP",208,0)
 I VAL="" D
"RTN","PSXBPSRP",209,0)
 .S $P(VAL,U)=Y
"RTN","PSXBPSRP",210,0)
 .S DIR(0)="DA^"_VAL,DIR("A")="ENTER ENDING TRANSMISSION DATE: "
"RTN","PSXBPSRP",211,0)
 .D ^DIR
"RTN","PSXBPSRP",212,0)
 .;
"RTN","PSXBPSRP",213,0)
 .;Check for "^", timeout, or blank entry
"RTN","PSXBPSRP",214,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","PSXBPSRP",215,0)
 .;
"RTN","PSXBPSRP",216,0)
 .;Define Entry
"RTN","PSXBPSRP",217,0)
 .S $P(VAL,U,2)=Y
"RTN","PSXBPSRP",218,0)
 ;
"RTN","PSXBPSRP",219,0)
 Q VAL
"RTN","PSXBPSRP",220,0)
 ;
"RTN","PSXBPSRP",221,0)
 ;Select Divisions
"RTN","PSXBPSRP",222,0)
 ;
"RTN","PSXBPSRP",223,0)
 ; Returns Arrays -> DIVNM("names of divisions") = selection number
"RTN","PSXBPSRP",224,0)
 ;                   DIVDA("iens of divisions") = name of division
"RTN","PSXBPSRP",225,0)
SELDIV N DIR,DIV,DIVX,DIRUT,DUOUT,DTOUT,I,X,Y
"RTN","PSXBPSRP",226,0)
 W !!,"SELECTION OF DIVISION(S)",!
"RTN","PSXBPSRP",227,0)
 S DIV="" F I=1:1 S DIV=$O(^PS(59,"B",DIV)) Q:DIV=""  S DIVNM(I)=DIV,DIVNM(DIV)=I,DIVDA=$O(^PS(59,"B",DIV,0)),DIVNM(I,"I")=DIVDA
"RTN","PSXBPSRP",228,0)
 S I=I-1
"RTN","PSXBPSRP",229,0)
 K DIR S DIR(0)="S^A:ALL DIVISIONS;S:SELECT DIVISIONS"
"RTN","PSXBPSRP",230,0)
 ;
"RTN","PSXBPSRP",231,0)
 D ^DIR
"RTN","PSXBPSRP",232,0)
 ;
"RTN","PSXBPSRP",233,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSRP",234,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^") K DIVNM Q
"RTN","PSXBPSRP",235,0)
 ;
"RTN","PSXBPSRP",236,0)
 ;All Divisions
"RTN","PSXBPSRP",237,0)
 I Y="A" D ALL Q
"RTN","PSXBPSRP",238,0)
 ;
"RTN","PSXBPSRP",239,0)
 ;Select Divisions
"RTN","PSXBPSRP",240,0)
 I Y="S" D SELECT(I),ALL
"RTN","PSXBPSRP",241,0)
 Q
"RTN","PSXBPSRP",242,0)
 ;
"RTN","PSXBPSRP",243,0)
 ;Select which divisions to display
"RTN","PSXBPSRP",244,0)
SELECT(I) N C,DIR,DIVX,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PSXBPSRP",245,0)
 F C=1:1:I S DIR("A",C)=C_"    "_DIVNM(C)
"RTN","PSXBPSRP",246,0)
 S DIR(0)="LO^1:"_I,DIR("A")="Select Division(s) "
"RTN","PSXBPSRP",247,0)
 D ^DIR
"RTN","PSXBPSRP",248,0)
 ;
"RTN","PSXBPSRP",249,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSRP",250,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^")!('+Y) K DIVNM Q
"RTN","PSXBPSRP",251,0)
 ;
"RTN","PSXBPSRP",252,0)
 M DIVX=DIVNM K DIVNM
"RTN","PSXBPSRP",253,0)
 F I=1:1 S X=$P(Y,",",I) Q:'X  M DIVNM(X)=DIVX(X) S DIVNM=DIVX(X),DIVNM(DIVNM)=X
"RTN","PSXBPSRP",254,0)
 Q
"RTN","PSXBPSRP",255,0)
 ;
"RTN","PSXBPSRP",256,0)
 ;Display selected divisions
"RTN","PSXBPSRP",257,0)
ALL N DA,DIR,DIV,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PSXBPSRP",258,0)
 Q:'$D(DIVNM)
"RTN","PSXBPSRP",259,0)
 W !!,"You have selected:",! S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  W !,DIV,?5,DIVNM(DIV)
"RTN","PSXBPSRP",260,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="YES" D ^DIR
"RTN","PSXBPSRP",261,0)
 K DIR
"RTN","PSXBPSRP",262,0)
 I Y=1 S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  S DA=DIVNM(DIV,"I"),DIVDA(DA)=DIVNM(DIV) K DIVNM(DIV)
"RTN","PSXBPSRP",263,0)
 ;
"RTN","PSXBPSRP",264,0)
 ;Check for "^", timeout, or non-yes entry
"RTN","PSXBPSRP",265,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)'=1) K DIVNM
"RTN","PSXBPSRP",266,0)
 Q
"RTN","PSXBPSRP",267,0)
 ;
"RTN","PSXBPSRP",268,0)
 ;Screen Pause 2
"RTN","PSXBPSRP",269,0)
PAUSE2 Q:'$G(TERM)
"RTN","PSXBPSRP",270,0)
 N X
"RTN","PSXBPSRP",271,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","PSXBPSRP",272,0)
 R X:$G(DTIME)
"RTN","PSXBPSRP",273,0)
 U IO
"RTN","PSXBPSRP",274,0)
 Q
"RTN","PSXBPSRP",275,0)
 ;
"RTN","PSXBPSRP",276,0)
 ;Screen Pause 1
"RTN","PSXBPSRP",277,0)
 ;
"RTN","PSXBPSRP",278,0)
 ; Return variable - BPQ = 0 Continue
"RTN","PSXBPSRP",279,0)
 ;                         2 Quit
"RTN","PSXBPSRP",280,0)
PAUSE N X
"RTN","PSXBPSRP",281,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","PSXBPSRP",282,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" POP=2
"RTN","PSXBPSRP",283,0)
 U IO
"RTN","PSXBPSRP",284,0)
 Q
"RTN","PSXBPSUT")
0^2^B5692316^B699978
"RTN","PSXBPSUT",1,0)
PSXBPSUT ;BIR/MFR - BPS (ECME) Utilities ;13 Mar 2002  10:31 AM
"RTN","PSXBPSUT",2,0)
 ;;2.0;CMOP;**48,63**;11 Apr 97;Build 8
"RTN","PSXBPSUT",3,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXBPSUT",4,0)
 ;
"RTN","PSXBPSUT",5,0)
XMIT(REC) ; Checks if the prescription will be transmitted to CMOP or not
"RTN","PSXBPSUT",6,0)
 ; Input:  REC  - Pointer to SUSPENSE file (#52.5)
"RTN","PSXBPSUT",7,0)
 ; Output: XMIT - 0 - NO  /  1 - YES 
"RTN","PSXBPSUT",8,0)
 N VADM,DFN,RX,PSXOK
"RTN","PSXBPSUT",9,0)
 I '$D(^PS(52.5,REC,0)) Q 0
"RTN","PSXBPSUT",10,0)
 I $P(^PS(52.5,REC,0),"^",7)="" Q 0
"RTN","PSXBPSUT",11,0)
 S RX=$P($G(^PS(52.5,REC,0)),"^",1) I RX="" Q 0
"RTN","PSXBPSUT",12,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT I $G(VADM(6))'="" Q 0
"RTN","PSXBPSUT",13,0)
 I ($P(^PS(52.5,REC,0),"^",3)'=DFN) Q 0
"RTN","PSXBPSUT",14,0)
 S PSXOK=0 D CHKDATA^PSXMISC1 I PSXOK Q 0
"RTN","PSXBPSUT",15,0)
 Q 1
"RTN","PSXBPSUT",16,0)
 ;
"RTN","PSXBPSUT",17,0)
EXCEL() ; - Returns whether to capture data for Excel report.
"RTN","PSXBPSUT",18,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","PSXBPSUT",19,0)
 ;
"RTN","PSXBPSUT",20,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT,Y
"RTN","PSXBPSUT",21,0)
 ;
"RTN","PSXBPSUT",22,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","PSXBPSUT",23,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","PSXBPSUT",24,0)
 S DIR("?")="^D HEXC^PSXBPSUT"
"RTN","PSXBPSUT",25,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","PSXBPSUT",26,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","PSXBPSUT",27,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","PSXBPSUT",28,0)
 ;
"RTN","PSXBPSUT",29,0)
 ;Display Excel display message
"RTN","PSXBPSUT",30,0)
 I EXCEL=1 D EXMSG
"RTN","PSXBPSUT",31,0)
 ;
"RTN","PSXBPSUT",32,0)
 Q EXCEL
"RTN","PSXBPSUT",33,0)
 ;
"RTN","PSXBPSUT",34,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","PSXBPSUT",35,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","PSXBPSUT",36,0)
 W !,"                        to an Excel document"
"RTN","PSXBPSUT",37,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","PSXBPSUT",38,0)
 W !,"              '^'    -  To quit this option"
"RTN","PSXBPSUT",39,0)
 Q
"RTN","PSXBPSUT",40,0)
 ;
"RTN","PSXBPSUT",41,0)
 ;Display the message about capturing to an Excel file format
"RTN","PSXBPSUT",42,0)
 ; 
"RTN","PSXBPSUT",43,0)
EXMSG ;
"RTN","PSXBPSUT",44,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","PSXBPSUT",45,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","PSXBPSUT",46,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","PSXBPSUT",47,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","PSXBPSUT",48,0)
 W !?5,"while to run."
"RTN","PSXBPSUT",49,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","PSXBPSUT",50,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","PSXBPSUT",51,0)
 Q
"VER")
8.0^22.0
"BLD",6932,6)
^56
**END**
**END**
