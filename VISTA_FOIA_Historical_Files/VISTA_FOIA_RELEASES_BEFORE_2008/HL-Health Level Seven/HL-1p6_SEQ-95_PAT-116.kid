Released HL*1.6*116 SEQ #95
Extracted from mail message
**KIDS**:HL*1.6*116^

**INSTALL NAME**
HL*1.6*116
"BLD",819,0)
HL*1.6*116^HEALTH LEVEL SEVEN^0^3040512^y
"BLD",819,1,0)
^^1^1^3040430^
"BLD",819,1,1,0)
Please see the patch description on Forum, in the National Patch Module.
"BLD",819,4,0)
^9.64PA^^
"BLD",819,"ABPKG")
n
"BLD",819,"INID")
^y
"BLD",819,"INIT")
POST^HLP116
"BLD",819,"KRN",0)
^9.67PA^8989.52^19
"BLD",819,"KRN",.4,0)
.4
"BLD",819,"KRN",.401,0)
.401
"BLD",819,"KRN",.402,0)
.402
"BLD",819,"KRN",.403,0)
.403
"BLD",819,"KRN",.5,0)
.5
"BLD",819,"KRN",.84,0)
.84
"BLD",819,"KRN",3.6,0)
3.6
"BLD",819,"KRN",3.8,0)
3.8
"BLD",819,"KRN",9.2,0)
9.2
"BLD",819,"KRN",9.8,0)
9.8
"BLD",819,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",819,"KRN",9.8,"NM",1,0)
HLTP3^^0^B56167221
"BLD",819,"KRN",9.8,"NM",2,0)
HLTP4^^0^B28699270
"BLD",819,"KRN",9.8,"NM","B","HLTP3",1)

"BLD",819,"KRN",9.8,"NM","B","HLTP4",2)

"BLD",819,"KRN",19,0)
19
"BLD",819,"KRN",19,"NM",0)
^9.68A^^
"BLD",819,"KRN",19.1,0)
19.1
"BLD",819,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",819,"KRN",101,0)
101
"BLD",819,"KRN",409.61,0)
409.61
"BLD",819,"KRN",771,0)
771
"BLD",819,"KRN",870,0)
870
"BLD",819,"KRN",8989.51,0)
8989.51
"BLD",819,"KRN",8989.52,0)
8989.52
"BLD",819,"KRN",8994,0)
8994
"BLD",819,"KRN","B",.4,.4)

"BLD",819,"KRN","B",.401,.401)

"BLD",819,"KRN","B",.402,.402)

"BLD",819,"KRN","B",.403,.403)

"BLD",819,"KRN","B",.5,.5)

"BLD",819,"KRN","B",.84,.84)

"BLD",819,"KRN","B",3.6,3.6)

"BLD",819,"KRN","B",3.8,3.8)

"BLD",819,"KRN","B",9.2,9.2)

"BLD",819,"KRN","B",9.8,9.8)

"BLD",819,"KRN","B",19,19)

"BLD",819,"KRN","B",19.1,19.1)

"BLD",819,"KRN","B",101,101)

"BLD",819,"KRN","B",409.61,409.61)

"BLD",819,"KRN","B",771,771)

"BLD",819,"KRN","B",870,870)

"BLD",819,"KRN","B",8989.51,8989.51)

"BLD",819,"KRN","B",8989.52,8989.52)

"BLD",819,"KRN","B",8994,8994)

"BLD",819,"QUES",0)
^9.62^^
"BLD",819,"REQB",0)
^9.611^1^1
"BLD",819,"REQB",1,0)
HL*1.6*108^2
"BLD",819,"REQB","B","HL*1.6*108",1)

"INIT")
POST^HLP116
"MBREQ")
0
"PKG",9,-1)
1^1
"PKG",9,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN^
"PKG",9,20,0)
^9.402P^^
"PKG",9,22,0)
^9.49I^1^1
"PKG",9,22,1,0)
1.6^2980130^2980130^6
"PKG",9,22,1,"PAH",1,0)
116^3040512^1000061
"PKG",9,22,1,"PAH",1,1,0)
^^1^1^3040512
"PKG",9,22,1,"PAH",1,1,1,0)
Please see the patch description on Forum, in the National Patch Module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","HLP116")
0^^B410149
"RTN","HLP116",1,0)
HLP116 ;ALB/CJM - Post-Install for patch 116 ;06/03/99
"RTN","HLP116",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**116**;Oct 13, 1995
"RTN","HLP116",3,0)
 ;
"RTN","HLP116",4,0)
POST ;
"RTN","HLP116",5,0)
 N LINK,PROTOCOL,MSG
"RTN","HLP116",6,0)
 S LINK=$O(^HLCS(870,"B","IIV EC",0))
"RTN","HLP116",7,0)
 Q:'LINK
"RTN","HLP116",8,0)
 S MSG=0
"RTN","HLP116",9,0)
 F  S MSG=$O(^HLMA("AC","O",LINK,MSG)) Q:'MSG  D
"RTN","HLP116",10,0)
 .N NAME,APP
"RTN","HLP116",11,0)
 .S APP=$P($G(^HLMA(MSG,0)),"^",12)
"RTN","HLP116",12,0)
 .Q:'APP
"RTN","HLP116",13,0)
 .S NAME=$P($G(^HL(771,APP,0)),"^")
"RTN","HLP116",14,0)
 .I NAME["HEC" K ^HLMA("AC","O",LINK,MSG)
"RTN","HLP116",15,0)
 Q
"RTN","HLTP3")
0^1^B56167221
"RTN","HLTP3",1,0)
HLTP3 ;SFIRMFO/RSD - Transaction Processor for TCP ;04/02/2004  16:15
"RTN","HLTP3",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,43,57,58,59,66,69,109,115,108,116**;Oct 13, 1995
"RTN","HLTP3",3,0)
 ;
"RTN","HLTP3",4,0)
 Q
"RTN","HLTP3",5,0)
NEW(X) ;process new msg. ien in 773^msg. ien in 772
"RTN","HLTP3",6,0)
 ;HLMTIENS=ien in #773, msg header; HLMTIEN=ien in #772, msg text
"RTN","HLTP3",7,0)
 ;HLHDRO=original header;  HLHDR=response header
"RTN","HLTP3",8,0)
 ;set error trap
"RTN","HLTP3",9,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERROR^HLTP3"
"RTN","HLTP3",10,0)
 N HL,HLEID,HLEIDS,HLERR,HLHDR,HLHDRO,HLMTIEN,HLMTIENS,HLJ,HLMSA,HLQUIT,HLNODE,HLNEXT,HLRESLTA,HLDONE1,HLASTRSP
"RTN","HLTP3",11,0)
 D INIT^HLTP3A ;patch HL*1.6*109 - hltp3 routine split
"RTN","HLTP3",12,0)
 ;error with header, return commit/app reject
"RTN","HLTP3",13,0)
 I $G(HLRESLT) D  Q
"RTN","HLTP3",14,0)
 . ;set status & unlock record
"RTN","HLTP3",15,0)
 . D STATUS^HLTF0(HLMTIENS,4,,,1),EXIT
"RTN","HLTP3",16,0)
 . ;quit if no commit or app ack
"RTN","HLTP3",17,0)
 . I $G(HL("ACAT"))="NE",$G(HL("APAT"))="NE" Q
"RTN","HLTP3",18,0)
 . S X=$S($G(HL("ACAT"))="AL":"CR",1:"AR")
"RTN","HLTP3",19,0)
 . ;HLTCP=ien of acknowledgment msg. from ACK^HLTP4
"RTN","HLTP3",20,0)
 . D ACK^HLTP4(X,$P(HLRESLT,U,2)) Q:'$G(HLTCP)
"RTN","HLTP3",21,0)
 . ;update counter, msg. to send
"RTN","HLTP3",22,0)
 .; D LLCNT^HLCSTCP(HLDP,3) ;**109** done in ACK^HLTP4
"RTN","HLTP3",23,0)
 . ;write ack back over connection
"RTN","HLTP3",24,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",25,0)
 . ;update counter to sent
"RTN","HLTP3",26,0)
 . D LLCNT^HLCSTCP(HLDP,4)
"RTN","HLTP3",27,0)
 . ;update status of ack to complete
"RTN","HLTP3",28,0)
 . D STATUS^HLTF0(HLTCP,3,,,1)
"RTN","HLTP3",29,0)
 ;
"RTN","HLTP3",30,0)
 ;check for duplicate msg., use rec. app and msg. id x-ref
"RTN","HLTP3",31,0)
 I $G(HL("MID")),$G(HL("RAP")) S X=$O(^HLMA("AH",HL("RAP"),HL("MID"),0)) D  Q:'$D(HLMTIENS)
"RTN","HLTP3",32,0)
 . ;HLASTMSG=last ien received during this connection
"RTN","HLTP3",33,0)
 . ;if no duplicate, save msg. ien and quit
"RTN","HLTP3",34,0)
 . I X=HLMTIENS!'X S HLASTMSG=HLMTIENS Q
"RTN","HLTP3",35,0)
 . N MSH,OIENS
"RTN","HLTP3",36,0)
 . S (OIENS,Y)=X D  S Y=HLMTIENS D
"RTN","HLTP3",37,0)
 .. ;combine MSH into single string
"RTN","HLTP3",38,0)
 .. S MSH(Y)="",I=0 F  S I=$O(^HLMA(Y,"MSH",I)) Q:'I  S MSH(Y)=MSH(Y)_$G(^(I,0))
"RTN","HLTP3",39,0)
 . ;if MSH is not identical, then msg. are different, quit
"RTN","HLTP3",40,0)
 . I MSH(HLMTIENS)'=MSH(OIENS) S HLASTMSG=HLMTIENS Q
"RTN","HLTP3",41,0)
 . ;msg is duplicate, set status as duplicate
"RTN","HLTP3",42,0)
 . D STATUS^HLTF0(HLMTIENS,4,109,"Duplicate with ien "_OIENS,1),EXIT
"RTN","HLTP3",43,0)
 . ;msg was resent during this connection, ignore it.
"RTN","HLTP3",44,0)
 . I HLASTMSG=HLMTIENS K HLMTIENS Q
"RTN","HLTP3",45,0)
 . ;msg was resent during another connection, resend original ack and skip processing
"RTN","HLTP3",46,0)
 .;**115** L +^HLMA(OIENS):0
"RTN","HLTP3",47,0)
 .;**115** I $T L -^HLMA(OIENS) I +$G(^HLMA(OIENS,"P"))'=3,'$$ONAC(OIENS) Q
"RTN","HLTP3",48,0)
 . ;find original response and send back
"RTN","HLTP3",49,0)
 . S HLASTRSP=$O(^HLMA("AF",OIENS,OIENS))
"RTN","HLTP3",50,0)
 ;
"RTN","HLTP3",51,0)
 ;Quit if this is acknowledgment to acknowledgement message
"RTN","HLTP3",52,0)
 I $G(HL("ACK")) D  Q
"RTN","HLTP3",53,0)
 . ;Update status of original acknowledgment message to successfully
"RTN","HLTP3",54,0)
 . D STATUS^HLTF0(HL("MTIENS"),3,,,1),STATUS^HLTF0(HLMTIENS,3,,,1)
"RTN","HLTP3",55,0)
 . ;unlock record
"RTN","HLTP3",56,0)
 . D EXIT
"RTN","HLTP3",57,0)
 ;
"RTN","HLTP3",58,0)
 ;enhance ack., send commit, quit if not an ack, msg will be processed by filer
"RTN","HLTP3",59,0)
 I $G(HL("ACAT"))="AL" D  Q:'$G(HL("MTIENS"))
"RTN","HLTP3",60,0)
 . ;msg is a resend, HLASTRSP=ien of original response
"RTN","HLTP3",61,0)
 .I $G(HLASTRSP) D
"RTN","HLTP3",62,0)
 ..S HLTCP=HLASTRSP
"RTN","HLTP3",63,0)
 ..D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP3",64,0)
 . E  D  Q:'$G(HLTCP)
"RTN","HLTP3",65,0)
 ..D ACK^HLTP4("CA") ;**109** LLCNT^HLCSTCP(HLDP,3) called in ACK^HLTP4
"RTN","HLTP3",66,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",67,0)
 . D LLCNT^HLCSTCP(HLDP,4),STATUS^HLTF0(HLTCP,3,,,1):'$G(HLASTRSP)
"RTN","HLTP3",68,0)
 . S HLTCP=""
"RTN","HLTP3",69,0)
 . ;if not an ack, set status to awaiting processing **109** and put on in queue
"RTN","HLTP3",70,0)
 . I '$G(HL("MTIENS")),'$G(HLASTRSP) D STATUS^HLTF0(HLMTIENS,9),EXIT,SETINQUE^HLTP31
"RTN","HLTP3",71,0)
 ;
"RTN","HLTP3",72,0)
 ;enhance ack., no commit & no app ack
"RTN","HLTP3",73,0)
 I $G(HL("ACAT"))="NE",$G(HL("APAT"))="NE" D  Q
"RTN","HLTP3",74,0)
 . ;set status to awaiting processing, **109** and put on in queue
"RTN","HLTP3",75,0)
 . I '$G(HLASTRSP) D STATUS^HLTF0(HLMTIENS,9),EXIT,SETINQUE^HLTP31
"RTN","HLTP3",76,0)
 ;
"RTN","HLTP3",77,0)
 ;resending old response, msg is a resend
"RTN","HLTP3",78,0)
 I $G(HLASTRSP) S HLTCP=HLASTRSP G ACK
"RTN","HLTP3",79,0)
CONT ;continue processing an enhance ack msg. called from DEFACK
"RTN","HLTP3",80,0)
 ;Set special HL variables for processing rtn
"RTN","HLTP3",81,0)
 S HLQUIT=0,HLNODE="",HLNEXT="D HLNEXT^HLCSUTL"
"RTN","HLTP3",82,0)
 ;
"RTN","HLTP3",83,0)
 ; message is an acknowledgement, HLMSA=ack code^id^text
"RTN","HLTP3",84,0)
 I ($G(HLMSA)]"") D  Q
"RTN","HLTP3",85,0)
 . ;X=1 if ack ok, 0=reject of error
"RTN","HLTP3",86,0)
 . S X=$E(HLMSA,2)="A"
"RTN","HLTP3",87,0)
 . ;Update status of original subscriber message and remove it from the out-going queue
"RTN","HLTP3",88,0)
 . D STATUS^HLTF0(HL("MTIENS"),$S(X:3,1:4),"",$S(X:"",1:$P(HLMSA,HL("FS"),3)),1)
"RTN","HLTP3",89,0)
 . D DEQUE^HLCSREP($P($G(^HLMA(HL("MTIENS"),0)),"^",7),"O",HL("MTIENS"))
"RTN","HLTP3",90,0)
 . D
"RTN","HLTP3",91,0)
 .. N HLTCP ;New variable to update status in file #772.
"RTN","HLTP3",92,0)
 ..;
"RTN","HLTP3",93,0)
 ..;**108**
"RTN","HLTP3",94,0)
 .. N TEMP
"RTN","HLTP3",95,0)
 .. S TEMP=HLMTIENS
"RTN","HLTP3",96,0)
 .. N HLMTIENS
"RTN","HLTP3",97,0)
 .. S HLMTIENS=TEMP
"RTN","HLTP3",98,0)
 ..;**END 108**
"RTN","HLTP3",99,0)
 ..;
"RTN","HLTP3",100,0)
 .. D PROCACK^HLTP2(HLMTIEN,HL("EID"),.HLRESLT,.HL)
"RTN","HLTP3",101,0)
 . ;update status of incoming to complete & unlock
"RTN","HLTP3",102,0)
 . D STATUS^HLTF0(HLMTIENS,$S($G(HLRESLT):4,1:3),$S($G(HLRESLT):+$G(HLRESLT),1:""),$S($G(HLRESLT):$P(HLRESLT,U,2),1:""),1),EXIT
"RTN","HLTP3",103,0)
 ;
"RTN","HLTP3",104,0)
 ;get entry action, exit action and processing routine
"RTN","HLTP3",105,0)
 K HLHDR,HLLD0,HLLD1,HLMSA
"RTN","HLTP3",106,0)
 I HL("EIDS")="",$G(HLEIDS)]"" S HL("EIDS")=HLEIDS ;**CIRN**
"RTN","HLTP3",107,0)
 D EVENT^HLUTIL1(HL("EIDS"),"15,20,771",.HLN)
"RTN","HLTP3",108,0)
 S HLENROU=$G(HLN(20)),HLEXROU=$G(HLN(15)),HLPROU=$G(HLN(771))
"RTN","HLTP3",109,0)
 ;quit if no processing routine,update status and quit
"RTN","HLTP3",110,0)
 I HLPROU']"" S HLRESLT="10^"_$G(^HL(771.7,10,0)) D STATUS^HLTF0(HLMTIENS,3,,,1),EXIT Q
"RTN","HLTP3",111,0)
 ;HLORNOD=subscriber protocol for Fileman auditing, ien;global ref
"RTN","HLTP3",112,0)
 N HLORNODD S HLORNOD=HL("EIDS")_";ORD(101,"
"RTN","HLTP3",113,0)
 ;Execute entry action of client protocol
"RTN","HLTP3",114,0)
 X:HLENROU]"" HLENROU K HLENROU,HLDONE1
"RTN","HLTP3",115,0)
 ;
"RTN","HLTP3",116,0)
 ;Execute processing routine
"RTN","HLTP3",117,0)
 X HLPROU S HLRESLT=0 S:($D(HLERR)) HLRESLT="9^"_HLERR
"RTN","HLTP3",118,0)
 ;update status of incoming to complete & unlock
"RTN","HLTP3",119,0)
 D STATUS^HLTF0(HLMTIENS,$S(HLRESLT:4,1:3),$S(HLRESLT:+HLRESLT,1:""),$S(HLRESLT:$P(HLRESLT,U,2),1:""),1,$S($G(HLERR("SKIP_EVENT"))=1:1,1:0)),EXIT
"RTN","HLTP3",120,0)
 ;HLTCPO=link open, HLTCP=ien of acknowledgment msg. from GENACK
"RTN","HLTP3",121,0)
ACK I $G(HLTCPO),$G(HLTCP) D  Q
"RTN","HLTP3",122,0)
 . D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP3",123,0)
 . ;write ack back over open tcp link
"RTN","HLTP3",124,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",125,0)
 . ;update status of ack to complete
"RTN","HLTP3",126,0)
 . D:'$G(HLASTRSP) STATUS^HLTF0(HLTCP,3,,,1)
"RTN","HLTP3",127,0)
 . D LLCNT^HLCSTCP(HLDP,4)
"RTN","HLTP3",128,0)
 Q
"RTN","HLTP3",129,0)
 ;
"RTN","HLTP3",130,0)
DEFACK(HLDP,X) ;process the deferred application ack, called from HLCSIN
"RTN","HLTP3",131,0)
 ;HLDP=logical link, X=ien in file 773
"RTN","HLTP3",132,0)
 ;set error trap
"RTN","HLTP3",133,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERROR^HLTP3"
"RTN","HLTP3",134,0)
 N HLERR     ;patch HL*1.6*109
"RTN","HLTP3",135,0)
 Q:'$G(HLDP)!'$G(X)  Q:'$G(^HLMA(X,0))
"RTN","HLTP3",136,0)
 ;**109 START**
"RTN","HLTP3",137,0)
 ;try lock, quit if can't lock or x-ref is gone
"RTN","HLTP3",138,0)
 ;L +^HLMA(X):0 Q:'$T
"RTN","HLTP3",139,0)
 ;L +^HLMA("AC","I",HLDP,X):0 I '$T L -^HLMA(X) Q
"RTN","HLTP3",140,0)
 ;L -^HLMA("AC","I",HLDP,X)
"RTN","HLTP3",141,0)
 ;I '$D(^HLMA("AC","I",HLDP,X)) L -^HLMA(X) Q
"RTN","HLTP3",142,0)
 Q:'$D(^HLMA("AC","I",HLDP,X))
"RTN","HLTP3",143,0)
 ;**109 END**
"RTN","HLTP3",144,0)
 ;
"RTN","HLTP3",145,0)
 N HL,HLA,HLD0,HLEID,HLEIDS,HLHDR,HLHDRO,HLMTIEN,HLMTIENS,HLJ,HLMSA,HLN,HLQUIT,HLNODE,HLNEXT,HLRESLT,HLRESLTA,HLTCP,HLXX,Z,HLDONE1
"RTN","HLTP3",146,0)
 ;setup variables
"RTN","HLTP3",147,0)
 S HLMTIENS=X,X=^HLMA(HLMTIENS,0),HLMTIEN=+$P(X,U),HL("MID")=$P(X,U,2),HL("MTIENS")=$P(X,U,10),HL("LL")=$P(X,U,7),HLTCP="",HL("Q")=""""""
"RTN","HLTP3",148,0)
 S HL("EIDS")=$P(X,U,8),HL("SAP")=$P(X,U,11),HL("RAP")=$P(X,U,12),HL("MTP")=$P(X,U,13),HL("ETP")=$P(X,U,14)
"RTN","HLTP3",149,0)
 S:$P(X,U,15) HL("MTP_ETP")=$P(X,U,15)
"RTN","HLTP3",150,0)
 S:HL("SAP") HL("SAN")=$P($G(^HL(771,HL("SAP"),0)),U) S:HL("RAP") HL("RAN")=$P($G(^HL(771,HL("RAP"),0)),U)
"RTN","HLTP3",151,0)
 S:HL("MTP") HL("MTN")=$P($G(^HL(771.2,HL("MTP"),0)),U) S:HL("ETP") HL("ETN")=$P($G(^HL(779.001,HL("ETP"),0)),U)
"RTN","HLTP3",152,0)
 S:$G(HL("MTP_ETP")) HL("MTN_ETN")=$P($G(^HL(779.005,HL("MTP_ETP"),0)),U)
"RTN","HLTP3",153,0)
 S HL("EID")=$P($G(^HL(772,HLMTIEN,0)),U,10)
"RTN","HLTP3",154,0)
 M HLHDRO=^HLMA(HLMTIENS,"MSH")
"RTN","HLTP3",155,0)
 ; if no header quit
"RTN","HLTP3",156,0)
 ;**109**
"RTN","HLTP3",157,0)
 ;I '$O(HLHDRO(0)) L -^HLMA(HLMTIENS) Q
"RTN","HLTP3",158,0)
 Q:'$O(HLHDRO(0))
"RTN","HLTP3",159,0)
 ;
"RTN","HLTP3",160,0)
 S HL("FS")=$E(HLHDRO(1,0),4),HL("ECH")=$$P^HLTPCK2(.HLHDRO,2),HL("SFN")=$$P^HLTPCK2(.HLHDRO,4),HL("RFN")=$$P^HLTPCK2(.HLHDRO,6),HL("DTM")=$$P^HLTPCK2(.HLHDRO,7)
"RTN","HLTP3",161,0)
 ;
"RTN","HLTP3",162,0)
 ; patch HL*1.6*109 start
"RTN","HLTP3",163,0)
 ; quit if ien of #772 is not defined
"RTN","HLTP3",164,0)
 Q:'HLMTIEN
"RTN","HLTP3",165,0)
 ; quit if field separator is not defined
"RTN","HLTP3",166,0)
 Q:HL("FS")=""
"RTN","HLTP3",167,0)
 ; quit if this is a commit ack
"RTN","HLTP3",168,0)
 ; Q:$P(^HL(772,HLMTIEN,"IN",1,0),HL("FS"),2)["C" ; hl*1.6*108
"RTN","HLTP3",169,0)
 ; patch HL*1.6*109 end
"RTN","HLTP3",170,0)
 ;
"RTN","HLTP3",171,0)
 S X=$$P^HLTPCK2(.HLHDRO,1)
"RTN","HLTP3",172,0)
 I X="MSH" S HL("PID")=$$P^HLTPCK2(.HLHDRO,11),HL("VER")=$$P^HLTPCK2(.HLHDRO,12),HL("APAT")=$$P^HLTPCK2(.HLHDRO,16),HL("CC")=$$P^HLTPCK2(.HLHDRO,17)
"RTN","HLTP3",173,0)
 I X'="MSH" D
"RTN","HLTP3",174,0)
 . S X=$$P^HLTPCK2(.HLHDRO,9),Z=$E(HL("ECH")),HL("PID")=$P(X,Z,2),HL("VER")=$P(X,Z,4)
"RTN","HLTP3",175,0)
 . Q:$$P^HLTPCK2(.HLHDRO,10)=""
"RTN","HLTP3",176,0)
 . ;HLMSA=ack code^id^text
"RTN","HLTP3",177,0)
 . S HLMSA=$P($$P^HLTPCK2(.HLHDRO,10),$E(HL("ECH")),1),$P(HLMSA,HL("FS"),2)=$$P^HLTPCK2(.HLHDRO,12),$P(HLMSA,HL("FS"),3)=$P($$P^HLTPCK2(.HLHDRO,10),$E(HL("ECH")),2),HL("MSAID")=$P(HLMSA,HL("FS"),2)
"RTN","HLTP3",178,0)
 ;
"RTN","HLTP3",179,0)
 ; HL*1.6*108
"RTN","HLTP3",180,0)
 ; quit if this is a commit ack
"RTN","HLTP3",181,0)
 I $P($G(^HL(772,HLMTIEN,"IN",1,0)),HL("FS"),1)="MSA",$E($P($G(^HL(772,HLMTIEN,"IN",1,0)),HL("FS"),2))="C" Q
"RTN","HLTP3",182,0)
 ; ** 
"RTN","HLTP3",183,0)
 ;
"RTN","HLTP3",184,0)
 ;
"RTN","HLTP3",185,0)
 ;*** HL*1.6*116 - moves this block to ^HLTP4 ***
"RTN","HLTP3",186,0)
 ;Set up destination for 2-phase commit
"RTN","HLTP3",187,0)
 ;If facility data didn't come from 771
"RTN","HLTP3",188,0)
 ;I $G(HL("SAP")) D
"RTN","HLTP3",189,0)
 ;.N HLSF,HLINST,HLLINK,HLI
"RTN","HLTP3",190,0)
 ;.N HLDOMAIN    ; patch HL*1.6*109
"RTN","HLTP3",191,0)
 ;.S HLSF=$P(^HL(771,HL("SAP"),0),U,3)
"RTN","HLTP3",192,0)
 ;.Q:HLSF]""  ;application-defined facility
"RTN","HLTP3",193,0)
 ;. ; patch HL*1.6*109
"RTN","HLTP3",194,0)
 ;.S HLDOMAIN=$P(HL("SFN"),$E(HL("ECH")),2)
"RTN","HLTP3",195,0)
 ;.I HLDOMAIN]"" D
"RTN","HLTP3",196,0)
 ;.. D LINK^HLUTIL3(HLDOMAIN,.HLI,"D")
"RTN","HLTP3",197,0)
 ;.. S HLLINK=$O(HLI(0))
"RTN","HLTP3",198,0)
 ;.. I HLLINK S HLL("LINKS",1)="^"_HLLINK
"RTN","HLTP3",199,0)
 ;.Q:$G(HLLINK)
"RTN","HLTP3",200,0)
 ;.S HLINST=$P(HL("SFN"),$E(HL("ECH")))
"RTN","HLTP3",201,0)
 ;.Q:HLINST']""
"RTN","HLTP3",202,0)
 ;.D LINK^HLUTIL3(HLINST,.HLI,"I")
"RTN","HLTP3",203,0)
 ;.S HLLINK=$O(HLI(0))
"RTN","HLTP3",204,0)
 ;.Q:'HLLINK
"RTN","HLTP3",205,0)
 ;. ; patch HL*1.6*109 end
"RTN","HLTP3",206,0)
 ;. ;
"RTN","HLTP3",207,0)
 ;.S HLL("LINKS",1)="^"_HLLINK
"RTN","HLTP3",208,0)
 ;** end HL*1.6*116 **
"RTN","HLTP3",209,0)
 ;
"RTN","HLTP3",210,0)
 D CONT
"RTN","HLTP3",211,0)
 Q
"RTN","HLTP3",212,0)
 ;
"RTN","HLTP3",213,0)
MSA(Y) ;Y=ien in 772, returns MSA segment
"RTN","HLTP3",214,0)
 ;ack code^msg being ack id^text
"RTN","HLTP3",215,0)
 N X
"RTN","HLTP3",216,0)
 S X=$G(^HL(772,Y,"IN",1,0)),X=$S($E(X,1,3)="MSA":$E(X,5,999),1:"")
"RTN","HLTP3",217,0)
 Q X
"RTN","HLTP3",218,0)
 ;
"RTN","HLTP3",219,0)
ERROR ;error trap
"RTN","HLTP3",220,0)
 D ^%ZTER
"RTN","HLTP3",221,0)
 I $G(HLMTIENS),$D(^HLMA(HLMTIENS,0)) D STATUS^HLTF0(HLMTIENS,4,,,1),EXIT
"RTN","HLTP3",222,0)
 ;*109* release all locks created by inbound filer
"RTN","HLTP3",223,0)
 L -^HLMA("AC","I",+$G(HLXX))
"RTN","HLTP3",224,0)
 G UNWIND^%ZTER
"RTN","HLTP3",225,0)
 ;
"RTN","HLTP3",226,0)
 ;
"RTN","HLTP3",227,0)
EXIT ;unlock
"RTN","HLTP3",228,0)
 I $G(HLMTIENS) L -^HLMA(HLMTIENS)
"RTN","HLTP3",229,0)
 Q
"RTN","HLTP3",230,0)
 ;
"RTN","HLTP3",231,0)
ONAC(IEN773) ;
"RTN","HLTP3",232,0)
 ;Returns 1 if the message is on the "AC","I" xref
"RTN","HLTP3",233,0)
 ;Returns 0 otherwise
"RTN","HLTP3",234,0)
 ;
"RTN","HLTP3",235,0)
 N LINK
"RTN","HLTP3",236,0)
 S LINK=$P($G(^HLMA(IEN773,0)),"^",17)
"RTN","HLTP3",237,0)
 Q:'LINK 0
"RTN","HLTP3",238,0)
 Q $D(^HLMA("AC","I",LINK,IEN773))
"RTN","HLTP4")
0^2^B28699270
"RTN","HLTP4",1,0)
HLTP4 ;SFIRMFO/RSD - Transaction Processor for TCP ;03/07/2000  17:41
"RTN","HLTP4",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,57,59,91,109,116**;Oct 13, 1995
"RTN","HLTP4",3,0)
GENACK ;called from HLMA1
"RTN","HLTP4",4,0)
 ;Entry point to generate an acknowledgement message
"RTN","HLTP4",5,0)
 ;for TCP
"RTN","HLTP4",6,0)
 ;INPUT:
"RTN","HLTP4",7,0)
 ;   HLMTIENS=original msg. ien #773
"RTN","HLTP4",8,0)
 ;   HLEID=original msg. event protocol
"RTN","HLTP4",9,0)
 ;   HLEIDS=original msg. subscriber protocol
"RTN","HLTP4",10,0)
 ;   HLMTIENA=ien of ack in 772, for batch only
"RTN","HLTP4",11,0)
 ;   Note:  if the HLP(...) array exists, it will be "honored" by
"RTN","HLTP4",12,0)
 ;          UPDATE^HLTF0 below. This includes the HLP("NAMESPACE")
"RTN","HLTP4",13,0)
 ;          variable. - HL*1.6*91
"RTN","HLTP4",14,0)
 ;
"RTN","HLTP4",15,0)
 ;OUTPUT: HLTCP=ien of response
"RTN","HLTP4",16,0)
 N HLDT,HLDT1,HLQ,HLOGLINK,HLMIDA,HLMTIEN,HLREC,HLSAN,HLTYPE,X
"RTN","HLTP4",17,0)
 ;Extract data from original message and store in separate variables
"RTN","HLTP4",18,0)
 ;reverse sending and receiving application from original msg.
"RTN","HLTP4",19,0)
 S X=$G(^HLMA(HLMTIENS,0)),HLREC=$P(X,U,11),HLSAN=$P(X,U,12),HLOGLINK=$G(HLTCPO)
"RTN","HLTP4",20,0)
 ;HLMTIENA defined, create msg in 773
"RTN","HLTP4",21,0)
 I $G(HLMTIENA) S HLDT=+$G(^HL(772,HLMTIENA,0)),HLMTIENA=$$MA^HLTF(HLMTIENA,.HLMIDA)
"RTN","HLTP4",22,0)
 ;create message in 772 & 773, HLMTIENA=new msg ien #773
"RTN","HLTP4",23,0)
 I '$G(HLMTIENA) D TCP^HLTF(.HLMIDA,.HLMTIENA,.HLDT)
"RTN","HLTP4",24,0)
 ;
"RTN","HLTP4",25,0)
 ;**109**
"RTN","HLTP4",26,0)
 ;lock new record
"RTN","HLTP4",27,0)
 ;F  L +^HLMA(HLMTIENA):1 Q:$T  H 1
"RTN","HLTP4",28,0)
 ;
"RTN","HLTP4",29,0)
 ;HLMTIEN=ien in 772
"RTN","HLTP4",30,0)
 S HLTCP=HLMTIENA,HLMTIEN=+^HLMA(HLMTIENA,0),HLDT1=$$HLDATE^HLFNC(HLDT),(HLTYPE,HLP("MSGTYPE"))=$E(HLARYTYP,2)
"RTN","HLTP4",31,0)
 ;
"RTN","HLTP4",32,0)
 ;**** HL*1.6*116 ****
"RTN","HLTP4",33,0)
 ;no open link, check dynamic routing of ack
"RTN","HLTP4",34,0)
 S X=$G(^ORD(101,HLEIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4)
"RTN","HLTP4",35,0)
 K HLL("LINKS")
"RTN","HLTP4",36,0)
 I 'HLOGLINK D  Q:'HLOGLINK
"RTN","HLTP4",37,0)
 . S HLOGLINK=$P(X,U,7)
"RTN","HLTP4",38,0)
 . Q:HLOGLINK
"RTN","HLTP4",39,0)
 . N DOMAIN,SFAC,MSH,FS,CS,HLI,INST
"RTN","HLTP4",40,0)
 . S MSH=$G(^HLMA(HLMTIENS,"MSH",1,0))
"RTN","HLTP4",41,0)
 . Q:'$L(MSH)
"RTN","HLTP4",42,0)
 . S FS=$E(MSH,4)
"RTN","HLTP4",43,0)
 . Q:'$L(FS)
"RTN","HLTP4",44,0)
 . S CS=$E(MSH,5)
"RTN","HLTP4",45,0)
 . Q:'$L(CS)
"RTN","HLTP4",46,0)
 . S DOMAIN=$P($P(MSH,FS,4),CS,2)
"RTN","HLTP4",47,0)
 . I $L(DOMAIN) D
"RTN","HLTP4",48,0)
 .. D LINK^HLUTIL3(DOMAIN,.HLI,"D")
"RTN","HLTP4",49,0)
 .. S HLOGLINK=$O(HLI(0))
"RTN","HLTP4",50,0)
 . Q:HLOGLINK
"RTN","HLTP4",51,0)
 . S INST=$P($P(MSH,FS,4),CS,1)
"RTN","HLTP4",52,0)
 . I $L(INST) D
"RTN","HLTP4",53,0)
 . .D LINK^HLUTIL3(INST,.HLI,"I")
"RTN","HLTP4",54,0)
 .. S HLOGLINK=$O(HLI(0))
"RTN","HLTP4",55,0)
 ;*** END HL*1.6*116 ***
"RTN","HLTP4",56,0)
 ;
"RTN","HLTP4",57,0)
 S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLTP4",58,0)
 ;HLTCPI=initial message
"RTN","HLTP4",59,0)
 S:$G(HLTCPI) HLP("HLTCPI")=HLTCPI
"RTN","HLTP4",60,0)
 ;Update zero node of Message Admin file #773
"RTN","HLTP4",61,0)
 D UPDATE^HLTF0(HLTCP,,"O",HLEIDS,HLREC,HLSAN,"I",HLMTIENS,HLOGLINK,.HLP)
"RTN","HLTP4",62,0)
 ;
"RTN","HLTP4",63,0)
 ;Update status to Being Generated
"RTN","HLTP4",64,0)
 D STATUS^HLTF0(HLTCP,8)
"RTN","HLTP4",65,0)
 ;
"RTN","HLTP4",66,0)
 ;**109**
"RTN","HLTP4",67,0)
 ;tcp link is open, don't need x-ref, msg will be sent over link
"RTN","HLTP4",68,0)
 ;I $G(HLTCPO) K ^HLMA("AC","O",HLOGLINK,HLTCP)
"RTN","HLTP4",69,0)
 ;
"RTN","HLTP4",70,0)
 ;update zero node of Message Text file #772
"RTN","HLTP4",71,0)
 D
"RTN","HLTP4",72,0)
 . N HLTCP D UPDATE^HLTF0(HLMTIEN,,"O",HLEID)
"RTN","HLTP4",73,0)
 ;
"RTN","HLTP4",74,0)
 ;Execute entry action for subscriber protocol
"RTN","HLTP4",75,0)
 I HLENROU]"" X HLENROU
"RTN","HLTP4",76,0)
 S HLQ=""""
"RTN","HLTP4",77,0)
 ;Check that local/global array exists and store in Message Text file
"RTN","HLTP4",78,0)
 ; if pre-compiled
"RTN","HLTP4",79,0)
 I HLFORMAT D  I (+$G(HLRESLTA)) D STATUS^HLTF0(HLMTIENA,4,+HLRESLTA) G ERR
"RTN","HLTP4",80,0)
 . I $E(HLARYTYP)="G" D
"RTN","HLTP4",81,0)
 .. I $O(^TMP("HLA",$J,0))']"" S HLRESLTA="8^"_$G(^HL(771.7,8,0)) Q
"RTN","HLTP4",82,0)
 .. D MERGE^HLTF1("G",HLMTIEN,"HLA")
"RTN","HLTP4",83,0)
 . I $E(HLARYTYP)="L" D
"RTN","HLTP4",84,0)
 .. I $O(HLA("HLA",0))']"" S HLRESLTA="8^"_$G(^HL(771.7,8,0)) Q
"RTN","HLTP4",85,0)
 .. D MERGE^HLTF1("L",HLMTIEN,"HLA")
"RTN","HLTP4",86,0)
 ;If array is not pre-compiled, call message generation routine
"RTN","HLTP4",87,0)
 I 'HLFORMAT N HLERR D  I $D(HLERR) S HLRESLTA="9^"_HLERR D STATUS^HLTF0(HLMTIENA,4,9,HLERR) G ERR
"RTN","HLTP4",88,0)
 .S HLP("GROUTINE")=HLP("GROUTINE")_"("_HLMIDA_","_HLMTIENA_","_HLQ_HLARYTYP_HLQ_","_HLSAN_","_$P($G(^HL(771.2,$P(HLN(770),"^",3),0)),"^")_","_$P($G(^HL(779.001,$P(HLN(770),"^",4),0)),"^")_","_HLQ_$TR($P(HLN(770),"^",6),"id","ID")_HLQ_")"
"RTN","HLTP4",89,0)
 .X HLP("GROUTINE")
"RTN","HLTP4",90,0)
 ;
"RTN","HLTP4",91,0)
 ;create header for message in 773
"RTN","HLTP4",92,0)
 I (HLTYPE="M") D HEADER^HLCSHDR1(HLTCP,HLREC,.HLRESLT)
"RTN","HLTP4",93,0)
 I (HLTYPE'="M") D BHSHDR^HLCSHDR1(HLTCP,HLREC,.HLRESLT)
"RTN","HLTP4",94,0)
 ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLTP4",95,0)
 I ($G(HLRESLT)'="") D STATUS^HLTF0(HLTCP,4,12,HLRESLT) G ERR
"RTN","HLTP4",96,0)
 ;set header, HLHDR in 773
"RTN","HLTP4",97,0)
 K HLQ S X=HLTCP_",",HLQ(773,X,200)="HLHDR"
"RTN","HLTP4",98,0)
 D FILE^HLDIE("","HLQ","","GENACK","HLTP4") ;HL*1.6*109
"RTN","HLTP4",99,0)
 ;D FILE^DIE("","HLQ")
"RTN","HLTP4",100,0)
 ;update status of 773 to PENDING TRANSMISSION
"RTN","HLTP4",101,0)
 D STATUS^HLTF0(HLTCP,1)
"RTN","HLTP4",102,0)
 ;Execute exit action for subscriber protocol
"RTN","HLTP4",103,0)
 X:HLEXROU]"" HLEXROU
"RTN","HLTP4",104,0)
 ;
"RTN","HLTP4",105,0)
 ;**109**
"RTN","HLTP4",106,0)
 ;tcp link is NOT open, need x-ref
"RTN","HLTP4",107,0)
 I '$G(HLTCPO) D ENQUE^HLCSREP(HLOGLINK,"O",HLTCP)
"RTN","HLTP4",108,0)
 ;
"RTN","HLTP4",109,0)
EXIT ;**109**
"RTN","HLTP4",110,0)
 ;L -^HLMA(HLMTIENA)
"RTN","HLTP4",111,0)
 Q
"RTN","HLTP4",112,0)
ERR D EXIT S HLTCP=""
"RTN","HLTP4",113,0)
 S:$G(HLRESLT) HLRESLTA=$G(HLRESLTA)_"^"_HLRESLT
"RTN","HLTP4",114,0)
 Q
"RTN","HLTP4",115,0)
ACK(HLTACK,HLMG) ;build response based on original msg header
"RTN","HLTP4",116,0)
 ;for Bi-directional TCP
"RTN","HLTP4",117,0)
 ;INPUT:
"RTN","HLTP4",118,0)
 ;   HLTACK=type of ack. CA,CR, or AR
"RTN","HLTP4",119,0)
 ;   HLMG=text for MSA segment
"RTN","HLTP4",120,0)
 ;   HLMTIENS=original msg. ien #773
"RTN","HLTP4",121,0)
 ;   HL(array) from original header
"RTN","HLTP4",122,0)
 ;RETURNS:  HLTCP=ien of response msg. in 773
"RTN","HLTP4",123,0)
 N HLDT,HLDT1,HLQ,HLFS,HLHDR,HLMIDA,HLMTIEN,HLMTIENA,HLP,HLREC,HLSAN,X
"RTN","HLTP4",124,0)
 ;quit if we don't have enough to make a msg.
"RTN","HLTP4",125,0)
 I $G(HL("ECH"))=""!($G(HL("FS"))="")!($G(HL("TYPE"))="") Q
"RTN","HLTP4",126,0)
 ;Extract data from original message and store in separate variables
"RTN","HLTP4",127,0)
 ;reverse sending and receiving application from original msg.
"RTN","HLTP4",128,0)
 S HLFS=HL("FS"),HLREC=$G(HL("SAN")),HLSAN=$G(HL("RAN"))
"RTN","HLTP4",129,0)
 ;create message in 772 & 773, HLMTIENA=new msg ien #773
"RTN","HLTP4",130,0)
 D TCP^HLTF(.HLMIDA,.HLMTIENA,.HLDT)
"RTN","HLTP4",131,0)
 ;lock new record
"RTN","HLTP4",132,0)
 ;**109**
"RTN","HLTP4",133,0)
 ;F  L +^HLMA(HLMTIENA):1 Q:$T  H 1
"RTN","HLTP4",134,0)
 ;
"RTN","HLTP4",135,0)
 ;HLMTIEN=ien in 772
"RTN","HLTP4",136,0)
 S HLTCP=HLMTIENA,HLMTIEN=+^HLMA(HLMTIENA,0),HLDT1=$$FMTHL7^XLFDT(HLDT)
"RTN","HLTP4",137,0)
 ;get 'msgtype'=B or M, message type and event type
"RTN","HLTP4",138,0)
 S HLP("MSGTYPE")=$E(HL("TYPE")),HLP("MTYPE")=$G(HL("MTP")),HLP("EVENT")=$G(HL("ETP")),HLP("HLTCPI")=HLMTIENS
"RTN","HLTP4",139,0)
 S:$G(HL("MTP_ETP")) HLP("MTYPE_EVENT")=$G(HL("MTP_ETP"))
"RTN","HLTP4",140,0)
 ;Update zero node of Message Admin file #773
"RTN","HLTP4",141,0)
 D UPDATE^HLTF0(HLTCP,,"O",,HLREC,HLSAN,"I",HLMTIENS,HLDP,.HLP)
"RTN","HLTP4",142,0)
 ;
"RTN","HLTP4",143,0)
 ;don't need x-ref, msg will be sent back over open tcp link
"RTN","HLTP4",144,0)
 ;**109**
"RTN","HLTP4",145,0)
 D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP4",146,0)
 ;K ^HLMA("AC","O",HLDP,HLTCP)
"RTN","HLTP4",147,0)
 ;
"RTN","HLTP4",148,0)
 ;Update status to Being Generated
"RTN","HLTP4",149,0)
 D STATUS^HLTF0(HLTCP,8)
"RTN","HLTP4",150,0)
 ;update zero node of Message Text file #772
"RTN","HLTP4",151,0)
 D
"RTN","HLTP4",152,0)
 . N HLTCP D UPDATE^HLTF0(HLMTIEN,,"O")
"RTN","HLTP4",153,0)
 ;
"RTN","HLTP4",154,0)
 ;build MSA segment
"RTN","HLTP4",155,0)
 K HLA
"RTN","HLTP4",156,0)
 S HLA("HLS",1)="MSA"_HLFS_HLTACK_HLFS_$G(HL("MID"))
"RTN","HLTP4",157,0)
 S:$G(HLMG)]"" HLA("HLS",1)=HLA("HLS",1)_HLFS_HLMG
"RTN","HLTP4",158,0)
 ;update file 772 with msg text
"RTN","HLTP4",159,0)
 D MERGE^HLTF1("L",HLMTIEN,"HLS")
"RTN","HLTP4",160,0)
 D HDR
"RTN","HLTP4",161,0)
 ;update file 773 with msg header
"RTN","HLTP4",162,0)
 K HLQ S HLQ(773,HLTCP_",",200)="HLHDR"
"RTN","HLTP4",163,0)
 D FILE^HLDIE("","HLQ","","ACK","HLTP4") ; HL*1.6*109
"RTN","HLTP4",164,0)
 ;D FILE^DIE("","HLQ")
"RTN","HLTP4",165,0)
 G EXIT
"RTN","HLTP4",166,0)
 ;
"RTN","HLTP4",167,0)
HDR ; build header for commit ack
"RTN","HLTP4",168,0)
 K HLHDR
"RTN","HLTP4",169,0)
 S HLHDR(1)=HL("TYPE")_HLFS_HL("ECH")_HLFS_HLSAN_HLFS_$G(HL("RFN"))_HLFS_HLREC_HLFS_$G(HL("SFN"))_HLFS_HLDT1_HLFS_HLFS
"RTN","HLTP4",170,0)
 I HLP("MSGTYPE")="M" S HLHDR(1)=HLHDR(1)_"ACK"_HLFS_HLMIDA_HLFS_$G(HL("PID"))_HLFS_$G(HL("VER")) Q
"RTN","HLTP4",171,0)
 ;batch
"RTN","HLTP4",172,0)
 S X=$E(HL("ECH"))
"RTN","HLTP4",173,0)
 S HLHDR(1)=HLHDR(1)_X_$G(HL("PID"))_X_"ACK"_HLFS_HLTACK_HLFS_HLMIDA_HLFS_$G(HL("MID"))
"RTN","HLTP4",174,0)
 Q
"VER")
8.0^22.0
**END**
**END**
