EMERGENCY Released GMRA*4*27 SEQ #24
Extracted from mail message
**KIDS**:GMRA*4.0*27^

**INSTALL NAME**
GMRA*4.0*27
"BLD",6283,0)
GMRA*4.0*27^ADVERSE REACTION TRACKING^0^3050712^y
"BLD",6283,1,0)
^^2^2^3050712^
"BLD",6283,1,1,0)
This patch will correct the reported problem of the allergy bulletin
"BLD",6283,1,2,0)
not being fired if the contrast media has a VA DRUG CLASS of DX109.
"BLD",6283,4,0)
^9.64PA^^
"BLD",6283,"KRN",0)
^9.67PA^8989.52^19
"BLD",6283,"KRN",.4,0)
.4
"BLD",6283,"KRN",.401,0)
.401
"BLD",6283,"KRN",.402,0)
.402
"BLD",6283,"KRN",.403,0)
.403
"BLD",6283,"KRN",.5,0)
.5
"BLD",6283,"KRN",.84,0)
.84
"BLD",6283,"KRN",3.6,0)
3.6
"BLD",6283,"KRN",3.8,0)
3.8
"BLD",6283,"KRN",9.2,0)
9.2
"BLD",6283,"KRN",9.8,0)
9.8
"BLD",6283,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6283,"KRN",9.8,"NM",1,0)
GMRARAD^^0^B19173368
"BLD",6283,"KRN",9.8,"NM",2,0)
GMRARAD1^^0^B1836385
"BLD",6283,"KRN",9.8,"NM","B","GMRARAD",1)

"BLD",6283,"KRN",9.8,"NM","B","GMRARAD1",2)

"BLD",6283,"KRN",19,0)
19
"BLD",6283,"KRN",19.1,0)
19.1
"BLD",6283,"KRN",101,0)
101
"BLD",6283,"KRN",409.61,0)
409.61
"BLD",6283,"KRN",771,0)
771
"BLD",6283,"KRN",870,0)
870
"BLD",6283,"KRN",8989.51,0)
8989.51
"BLD",6283,"KRN",8989.52,0)
8989.52
"BLD",6283,"KRN",8994,0)
8994
"BLD",6283,"KRN","B",.4,.4)

"BLD",6283,"KRN","B",.401,.401)

"BLD",6283,"KRN","B",.402,.402)

"BLD",6283,"KRN","B",.403,.403)

"BLD",6283,"KRN","B",.5,.5)

"BLD",6283,"KRN","B",.84,.84)

"BLD",6283,"KRN","B",3.6,3.6)

"BLD",6283,"KRN","B",3.8,3.8)

"BLD",6283,"KRN","B",9.2,9.2)

"BLD",6283,"KRN","B",9.8,9.8)

"BLD",6283,"KRN","B",19,19)

"BLD",6283,"KRN","B",19.1,19.1)

"BLD",6283,"KRN","B",101,101)

"BLD",6283,"KRN","B",409.61,409.61)

"BLD",6283,"KRN","B",771,771)

"BLD",6283,"KRN","B",870,870)

"BLD",6283,"KRN","B",8989.51,8989.51)

"BLD",6283,"KRN","B",8989.52,8989.52)

"BLD",6283,"KRN","B",8994,8994)

"BLD",6283,"QUES",0)
^9.62^^
"BLD",6283,"REQB",0)
^9.611^2^2
"BLD",6283,"REQB",1,0)
GMRA*4.0*13^1
"BLD",6283,"REQB",2,0)
GMRA*4.0*21^1
"BLD",6283,"REQB","B","GMRA*4.0*13",1)

"BLD",6283,"REQB","B","GMRA*4.0*21",2)

"MBREQ")
0
"PKG",478,-1)
1^1
"PKG",478,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",478,20,0)
^9.402P^^
"PKG",478,22,0)
^9.49I^1^1
"PKG",478,22,1,0)
4.0^2960328
"PKG",478,22,1,"PAH",1,0)
27^3050712
"PKG",478,22,1,"PAH",1,1,0)
^^2^2^3050712
"PKG",478,22,1,"PAH",1,1,1,0)
This patch will correct the reported problem of the allergy bulletin
"PKG",478,22,1,"PAH",1,1,2,0)
not being fired if the contrast media has a VA DRUG CLASS of DX109.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRARAD")
0^1^B19173368
"RTN","GMRARAD",1,0)
GMRARAD ;HIRMFO/RM-Radiology\ART Interface Routine ;12/8/04  08:03
"RTN","GMRARAD",2,0)
 ;;4.0;Adverse Reaction Tracking;**21,27**;Mar 29, 1996
"RTN","GMRARAD",3,0)
 ;
"RTN","GMRARAD",4,0)
RADD(DFN,OH,YN,VER) ; THIS EXTRINSIC FUNCTION WILL ADD A CONTRAST MEDIA
"RTN","GMRARAD",5,0)
 ; ALLERGY TO FILE 120.8 FOR PATIENT WITH IEN DFN.  INPUT VARIABLES:
"RTN","GMRARAD",6,0)
 ;    DFN = IEN IN FILE 2 OF PATIENT
"RTN","GMRARAD",7,0)
 ;    OH = 'o' FOR OBSERVED, 'h' FOR HISTORICAL, OR
"RTN","GMRARAD",8,0)
 ;         'p' IF THE UTILITY SHOULD PROMPT FOR OBSERVED/HISTORICAL.
"RTN","GMRARAD",9,0)
 ;    YN = 'Y' MEANS CONTRAST RXN, 'N' MEANS NO CONTRAST RXN,
"RTN","GMRARAD",10,0)
 ;         'U' MEANS UNKNOWN CONTRAST RXN, "" MEANS CONTRAST RXN DELETED
"RTN","GMRARAD",11,0)
 ;    VER (optional) = '1' MEANS DATA WILL BE AUTOVERIFIED,
"RTN","GMRARAD",12,0)
 ;                     '0' MEANS DATA WILL NOT BE VERIFIED,
"RTN","GMRARAD",13,0)
 ;                     '$D MEANS USE ART AUTOVERIFICATION CHECKS.
"RTN","GMRARAD",14,0)
 ; FUNCTION RETURNS THE IEN OF NEW 120.8 ENTRY, OR -1 IF NOT ADDED.
"RTN","GMRARAD",15,0)
 N DA,DIK,GMRA,GMRACAUS,GMRADRCL,GMRAL,GMRACLS,GMRANEW,GMRANOW,GMRAX,GMRAY,GMRAER,X,Y
"RTN","GMRARAD",16,0)
 I YN'="YES",YN'="Y" S DA=-1 G RETRA ; if no rxn, then no need to add
"RTN","GMRARAD",17,0)
 I DFN'>0 S DA=-1 G RETRA ; if bad DFN, then quit
"RTN","GMRARAD",18,0)
 S GMRACAUS="RADIOLOGICAL/CONTRAST MEDIA",GMRADRCL=$O(^PS(50.605,"B","DX100",0))_";PS(50.605," I +GMRADRCL'>0 S DA=-1 G RETRA ; is DX100 in file 50.605
"RTN","GMRARAD",19,0)
 S DA=0 F  S DA=$O(^GMR(120.8,"B",DFN,DA)) Q:DA'>0  I $$RALLG(DA) Q  ; check to see if RAD allergy present
"RTN","GMRARAD",20,0)
 I DA>0 G RETRA ; if RAD allergy present, then quit
"RTN","GMRARAD",21,0)
 I OH="p" D  ; read for OH if desired
"RTN","GMRARAD",22,0)
 .   K DIR S DIR("A")="(O)bserved or (H)istorical reaction? ",DIR(0)="SAO^O:Observed;H:Historical",DIR("?",1)="   IF THIS REACTION HAS BEEN OBSERVED, PLEASE ENTER AN O,",DIR("?")="   IF THIS REACTION IS HISTORICAL, ENTER AN H." D ^DIR
"RTN","GMRARAD",23,0)
 .   K DIR I Y="O"!(Y="H") S OH=$$LOW^XLFSTR(Y)
"RTN","GMRARAD",24,0)
 .   Q
"RTN","GMRARAD",25,0)
 I OH'="o",OH'="h" S DA=-1 G RETRA ; is OH set up right
"RTN","GMRARAD",26,0)
 S GMRANOW=$$HTFM^XLFDT($H),GMRAL=DFN_"^"_GMRACAUS_"^"_GMRADRCL_"^"_GMRANOW_"^"_$S('$G(RAAF18):DUZ,1:"")_"^"_OH_"^^^^^^1^^U^^^^^^D",GMRACLS=+GMRADRCL ; 120.8 record 0th node
"RTN","GMRARAD",27,0)
 I '$D(VER) D  ; need to check site's autoverify parameters
"RTN","GMRARAD",28,0)
 .   S GMRAY="",GMRAY(0)=GMRAL,VER=$$VFY^GMRASIGN(.GMRAY)
"RTN","GMRARAD",29,0)
 .   K GMRASITE,GMRATYPE,GMRAY
"RTN","GMRARAD",30,0)
 .   Q
"RTN","GMRARAD",31,0)
 I VER'=0,VER'=1 S DA=-1 G RETRA ; is VER set up correctly
"RTN","GMRARAD",32,0)
 S $P(GMRAL,U,16)=VER I VER S $P(GMRAL,U,17)=GMRANOW ; set up verify data in 0th node
"RTN","GMRARAD",33,0)
 S GMRANEW=$P($G(^GMR(120.8,0)),"^",3,4) ; get 120.8 0th node
"RTN","GMRARAD",34,0)
 F DA=1+GMRANEW:1 L +^GMR(120.8,DA,0):0 Q:$T&'$D(^GMR(120.8,DA,0))  L:$T&$D(^GMR(120.8,DA,0)) -^GMR(120.8,DA,0) ; find IEN for new record
"RTN","GMRARAD",35,0)
 S ^GMR(120.8,DA,0)=GMRAL ; set 0th node for new record
"RTN","GMRARAD",36,0)
 S ^GMR(120.8,DA,3,0)="^120.803PA^1^1",^GMR(120.8,DA,3,1,0)=GMRACLS ; set drug class multiple for new record
"RTN","GMRARAD",37,0)
 S ^GMR(120.8,DA,13,0)="^120.813DA^1^1",^GMR(120.8,DA,13,1,0)=$$DT^XLFDT_"^"_$G(DUZ,"") ;21 Add marked on chart when entered
"RTN","GMRARAD",38,0)
 S DIK="^GMR(120.8," D IX1^DIK L -^GMR(120.8,DA,0) ; xref new record
"RTN","GMRARAD",39,0)
 S $P(^GMR(120.8,0),"^",3,4)=DA_"^"_($P(GMRANEW,"^",2)+1) ; update 120.8 0th node
"RTN","GMRARAD",40,0)
 I '$G(RAAF18) S GMRAPA=DA,ZTSAVE("GMRAPA")="",ZTDESC="Send GMRA Bulletins For Radiology Allergy",ZTIO="",ZTRTN="QBULL^GMRARAD0",ZTDTH=$H D ^%ZTLOAD K ZTSK,GMRAPA ; send ART bulletins
"RTN","GMRARAD",41,0)
 D NKADD^GMRARAD0 ; add NKA entry if necessary
"RTN","GMRARAD",42,0)
RETRA Q DA ; exit returning entry number of new record
"RTN","GMRARAD",43,0)
 ;
"RTN","GMRARAD",44,0)
RACHK(DFN,YN) ; This function will be called from input transform on the
"RTN","GMRARAD",45,0)
 ; .05 field of file 70.  If the patient (DFN) has allergies in ART
"RTN","GMRARAD",46,0)
 ; to contrast media, and the user is changing the .05 field to
"RTN","GMRARAD",47,0)
 ; indicate NO contrast media allergy (YN), this function will prompt
"RTN","GMRARAD",48,0)
 ; the user if this change is correct.
"RTN","GMRARAD",49,0)
 ;    Input variables:  DFN=Patient IEN in file 2.
"RTN","GMRARAD",50,0)
 ;                      YN=new value of the .05 field.
"RTN","GMRARAD",51,0)
 ;    Return value:  1 if X should be killed, 0 if not
"RTN","GMRARAD",52,0)
 ;
"RTN","GMRARAD",53,0)
 N DA,DIK,DIR,FXN,GMRADA,GMRAER,GMRAX,GMRAY,X,Y
"RTN","GMRARAD",54,0)
 S FXN=0
"RTN","GMRARAD",55,0)
 I YN="N" D CHKEXAL^GMRARAD0
"RTN","GMRARAD",56,0)
 Q FXN
"RTN","GMRARAD",57,0)
RALLG(DA,ERR) ; This function will determine if entry DA in 120.8 represents
"RTN","GMRARAD",58,0)
 ; a contrast media allergy that is not entered in error.
"RTN","GMRARAD",59,0)
 ;    Input variable: DA=entry in file 120.8
"RTN","GMRARAD",60,0)
 ;                    ERR(optional)=if set to 0 do not check for E/E
"RTN","GMRARAD",61,0)
 ;    Return value: 1 if entry is contrast media allergy, 0 if not
"RTN","GMRARAD",62,0)
 ;
"RTN","GMRARAD",63,0)
 N FXN,ZERO,DRCL,DRCL1
"RTN","GMRARAD",64,0)
 S FXN=0,ZERO=$G(^GMR(120.8,DA,0)) I '$D(ERR) S ERR=1
"RTN","GMRARAD",65,0)
 I 'ERR!(ERR&'+$G(^GMR(120.8,DA,"ER"))) D
"RTN","GMRARAD",66,0)
 .F DRCL="DX100","DX101","DX102","DX103","DX104","DX105","DX106","DX107","DX108","DX109" S DRCL1=$O(^PS(50.605,"B",DRCL,0))_";PS(50.605," I $P(ZERO,U,3)=DRCL1!$D(^GMR(120.8,DA,3,"B",+DRCL1)) S FXN=1 Q
"RTN","GMRARAD",67,0)
 .I 'FXN,$P(ZERO,U,3)["GMRD(120.82"&$D(^GMRD(120.82,"D","RADIOLOGICAL/CONTRAST MEDIA",+$P(ZERO,U,3))) S FXN=1
"RTN","GMRARAD",68,0)
 .I 'FXN,$$PSCHK^GMRARAD1($P(ZERO,U,3)) S FXN=1
"RTN","GMRARAD",69,0)
 .Q
"RTN","GMRARAD",70,0)
 Q FXN
"RTN","GMRARAD",71,0)
OTHRAD(DFN,DA) ; This function will determine if another entry for patient
"RTN","GMRARAD",72,0)
 ; (DFN) exists other than entry DA that is also a Radiological
"RTN","GMRARAD",73,0)
 ; allergy.
"RTN","GMRARAD",74,0)
 ;    Input Variables:  DFN=IEN of patient,   DA=entry in 120.8
"RTN","GMRARAD",75,0)
 ;    Function Returns:  1 if another entry exists, else returns 0
"RTN","GMRARAD",76,0)
 ;
"RTN","GMRARAD",77,0)
 N FXN,GMRADA
"RTN","GMRARAD",78,0)
 S (GMRADA,FXN)=0 F  S GMRADA=$O(^GMR(120.8,"B",DFN,GMRADA)) Q:GMRADA'>0  I $$RALLG(GMRADA),GMRADA'=DA S FXN=1 Q
"RTN","GMRARAD",79,0)
 Q FXN
"RTN","GMRARAD1")
0^2^B1836385
"RTN","GMRARAD1",1,0)
GMRARAD1 ;HIRMFO/WAA-RADIOLOGY ALLERGY INTERFACE ; 10/1/92
"RTN","GMRARAD1",2,0)
 ;;4.0;Adverse Reaction Tracking;**13,27**;Mar 29, 1996
"RTN","GMRARAD1",3,0)
PSCHK(GMRAVAR) ; This function will return a 1 (true) if the variable ptr
"RTN","GMRARAD1",4,0)
 ; passed in (GMRAVAR) has a RADIOLOGICAL CONTRAST/MEDIA VA Drug
"RTN","GMRARAD1",5,0)
 ; Class associated with it.
"RTN","GMRARAD1",6,0)
 N CHK,GMRAX,GMRAY
"RTN","GMRARAD1",7,0)
 S CHK=0,GMRAX=$P(GMRAVAR,";")
"RTN","GMRARAD1",8,0)
 I $P(GMRAVAR,";",2)="PSDRUG(" S:"^DX100^DX101^DX102^DX103^DX104^DX105^DX106^DX107^DX108^DX109^"[("^"_$P($G(^PSDRUG(GMRAX,0)),U,2)_"^") CHK=1
"RTN","GMRARAD1",9,0)
 I $P(GMRAVAR,";",2)=$P($$NDFREF^GMRAOR,U,2) D:$D(@($$NDFREF^GMRAOR_GMRAX_",0)"))
"RTN","GMRARAD1",10,0)
 .N CLASS,GMRACL
"RTN","GMRARAD1",11,0)
 .S CLASS=$$CLIST^PSNAPIS(GMRAX,.GMRACL) I $O(GMRACL(0)) D  Q:CHK
"RTN","GMRARAD1",12,0)
 ..S CLASS=0 F  S CLASS=$O(GMRACL(CLASS)) Q:'CLASS  D
"RTN","GMRARAD1",13,0)
 ...I "^DX100^DX101^DX102^DX103^DX104^DX105^DX106^DX107^DX108^DX109^"[("^"_$P(GMRACL(CLASS),U,2)_"^") S CHK=1
"RTN","GMRARAD1",14,0)
 ..Q
"RTN","GMRARAD1",15,0)
 .Q
"RTN","GMRARAD1",16,0)
 Q CHK
"VER")
8.0^22.0
"BLD",6283,6)
^SEQ #24
**END**
**END**
