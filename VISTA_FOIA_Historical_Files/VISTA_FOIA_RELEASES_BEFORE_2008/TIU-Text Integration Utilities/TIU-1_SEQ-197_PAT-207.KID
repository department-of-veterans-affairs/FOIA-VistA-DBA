Released TIU*1*207 SEQ #197
Extracted from mail message
**KIDS**:TIU*1.0*207^

**INSTALL NAME**
TIU*1.0*207
"BLD",6560,0)
TIU*1.0*207^TEXT INTEGRATION UTILITIES^0^3060210^y
"BLD",6560,1,0)
^^3^3^3060210^
"BLD",6560,1,1,0)
Fix header display and prompts for TIU document display options and fix 
"BLD",6560,1,2,0)
prompt for option TIU REVIEW DS CLINICIAN.
"BLD",6560,1,3,0)
.
"BLD",6560,4,0)
^9.64PA^^
"BLD",6560,6)
1^
"BLD",6560,"KRN",0)
^9.67PA^8989.52^19
"BLD",6560,"KRN",.4,0)
.4
"BLD",6560,"KRN",.401,0)
.401
"BLD",6560,"KRN",.402,0)
.402
"BLD",6560,"KRN",.403,0)
.403
"BLD",6560,"KRN",.5,0)
.5
"BLD",6560,"KRN",.84,0)
.84
"BLD",6560,"KRN",3.6,0)
3.6
"BLD",6560,"KRN",3.8,0)
3.8
"BLD",6560,"KRN",9.2,0)
9.2
"BLD",6560,"KRN",9.8,0)
9.8
"BLD",6560,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6560,"KRN",9.8,"NM",1,0)
TIULA1^^0^26285953
"BLD",6560,"KRN",9.8,"NM",2,0)
TIUR^^0^39996639
"BLD",6560,"KRN",9.8,"NM",3,0)
TIURH^^0^4359580
"BLD",6560,"KRN",9.8,"NM","B","TIULA1",1)

"BLD",6560,"KRN",9.8,"NM","B","TIUR",2)

"BLD",6560,"KRN",9.8,"NM","B","TIURH",3)

"BLD",6560,"KRN",19,0)
19
"BLD",6560,"KRN",19.1,0)
19.1
"BLD",6560,"KRN",101,0)
101
"BLD",6560,"KRN",409.61,0)
409.61
"BLD",6560,"KRN",771,0)
771
"BLD",6560,"KRN",870,0)
870
"BLD",6560,"KRN",8989.51,0)
8989.51
"BLD",6560,"KRN",8989.52,0)
8989.52
"BLD",6560,"KRN",8994,0)
8994
"BLD",6560,"KRN","B",.4,.4)

"BLD",6560,"KRN","B",.401,.401)

"BLD",6560,"KRN","B",.402,.402)

"BLD",6560,"KRN","B",.403,.403)

"BLD",6560,"KRN","B",.5,.5)

"BLD",6560,"KRN","B",.84,.84)

"BLD",6560,"KRN","B",3.6,3.6)

"BLD",6560,"KRN","B",3.8,3.8)

"BLD",6560,"KRN","B",9.2,9.2)

"BLD",6560,"KRN","B",9.8,9.8)

"BLD",6560,"KRN","B",19,19)

"BLD",6560,"KRN","B",19.1,19.1)

"BLD",6560,"KRN","B",101,101)

"BLD",6560,"KRN","B",409.61,409.61)

"BLD",6560,"KRN","B",771,771)

"BLD",6560,"KRN","B",870,870)

"BLD",6560,"KRN","B",8989.51,8989.51)

"BLD",6560,"KRN","B",8989.52,8989.52)

"BLD",6560,"KRN","B",8994,8994)

"BLD",6560,"QUES",0)
^9.62^^
"BLD",6560,"REQB",0)
^9.611^2^2
"BLD",6560,"REQB",1,0)
TIU*1.0*112^2
"BLD",6560,"REQB",2,0)
TIU*1.0*113^2
"BLD",6560,"REQB","B","TIU*1.0*112",1)

"BLD",6560,"REQB","B","TIU*1.0*113",2)

"MBREQ")
0
"PKG",506,-1)
1^1
"PKG",506,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",506,20,0)
^9.402P^^
"PKG",506,22,0)
^9.49I^1^1
"PKG",506,22,1,0)
1.0^2970620^2970916^3316
"PKG",506,22,1,"PAH",1,0)
207^3060210^33252
"PKG",506,22,1,"PAH",1,1,0)
^^3^3^3060210
"PKG",506,22,1,"PAH",1,1,1,0)
Fix header display and prompts for TIU document display options and fix 
"PKG",506,22,1,"PAH",1,1,2,0)
prompt for option TIU REVIEW DS CLINICIAN.
"PKG",506,22,1,"PAH",1,1,3,0)
.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIULA1")
0^1^B26285953^B21656000
"RTN","TIULA1",1,0)
TIULA1 ; SLC/JER - More interactive functions ;4/18/03
"RTN","TIULA1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**75,113,207**;Jun 20, 1997
"RTN","TIULA1",3,0)
TRAVERSE(DA,RETURN,PARM,TYPE) ; Select Document Type(s)
"RTN","TIULA1",4,0)
 N C,I,XQORM,Y N:'$D(LEVEL) LEVEL S LEVEL=+$G(LEVEL)+1
"RTN","TIULA1",5,0)
 S:$G(TYPE)']"" TYPE="D"
"RTN","TIULA1",6,0)
 S XQORM=DA_";TIU(8925.1,",XQORM(0)=$S($L($G(PARM)):PARM,1:"AD")
"RTN","TIULA1",7,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- ""_$P(^TIU(8925.1,+DA,0),U,3)_"" ---""),!"
"RTN","TIULA1",8,0)
 S XQORM("B")=$G(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",1))
"RTN","TIULA1",9,0)
 S XQORM("A")="Select "_$S(XQORM(0)["D":"Document",1:$P(^TIU(8925.1,+DA,0),U,3))_$S("CD"[$P(^TIU(8925.1,+DA,0),U,4):" Component",1:" Type")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA1",10,0)
 D EN^XQORM
"RTN","TIULA1",11,0)
 M RETURN(LEVEL)=Y
"RTN","TIULA1",12,0)
 S I=0 F  S I=$O(Y(I)) Q:+I'>0  D
"RTN","TIULA1",13,0)
 . S J=+$P(Y(I),U,2)
"RTN","TIULA1",14,0)
 . I $P(^TIU(8925.1,+J,0),U,4)'=TYPE,$D(^TIU(8925.1,+J,10))'<10 D TRAVERSE(+J,.RETURN,$G(PARM))
"RTN","TIULA1",15,0)
 Q
"RTN","TIULA1",16,0)
ASKSIG() ; Prompt for ES, return encrypted data
"RTN","TIULA1",17,0)
 N ESNAME,ESTITLE,Y S Y=0
"RTN","TIULA1",18,0)
 D SIG^XUSESIG I X1']"" S:'$D(X) X=0 D BADSIG^TIULG(X) G ASKX
"RTN","TIULA1",19,0)
 S ESNAME=$P($G(^VA(200,DUZ,20)),U,2),ESTITLE=$P($G(^(20)),U,3)
"RTN","TIULA1",20,0)
 S Y=1_U_ESNAME_U_ESTITLE
"RTN","TIULA1",21,0)
ASKX Q Y
"RTN","TIULA1",22,0)
ASKSUBJ() ; Handle query by subject
"RTN","TIULA1",23,0)
 N Y
"RTN","TIULA1",24,0)
 S Y=$$READ^TIUU("FO","Where SUBJECT CONTAINS")
"RTN","TIULA1",25,0)
 Q $$UPPER^TIULS(Y)
"RTN","TIULA1",26,0)
ASKLOC() ; Handle query by location
"RTN","TIULA1",27,0)
 N Y
"RTN","TIULA1",28,0)
 S Y=$$READ^TIUU("P^44:AEMQ","Select HOSPITAL LOCATION")
"RTN","TIULA1",29,0)
 Q Y
"RTN","TIULA1",30,0)
TYPMATCH(TYPE,CURTYP) ; Check for type match
"RTN","TIULA1",31,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIULA1",32,0)
 I $L(TYPE,"!")=1,TYPE=CURTYP S TIUY=1
"RTN","TIULA1",33,0)
 E  F TIUI=1:1:$L(TYPE,"!") I $P(TYPE,"!",TIUI)=CURTYP S TIUY=1 Q
"RTN","TIULA1",34,0)
 Q TIUY
"RTN","TIULA1",35,0)
DOCLIST(CLASS,Y,PARM,DFLT) ; Get preferred documents for user
"RTN","TIULA1",36,0)
 N TIUDA,XQORM,X
"RTN","TIULA1",37,0)
 S TIUDA=+$O(^TIU(8925.98,"AC",DUZ,CLASS,0)),XQORM=TIUDA_";TIU(8925.98,"
"RTN","TIULA1",38,0)
 I +TIUDA'>0!(+$O(^XUTL("XQORM",XQORM,0))'>0) S Y=-1 Q
"RTN","TIULA1",39,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA1",40,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",XQORM,0))
"RTN","TIULA1",41,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",XQORM,DFLT)),1:"")
"RTN","TIULA1",42,0)
 S XQORM(0)=$S(+$P($G(^TIU(8925.98,+TIUDA,10,0)),U,3)=1:"F",1:PARM)
"RTN","TIULA1",43,0)
 S XQORM("B")=$S(+$P($G(^TIU(8925.98,+TIUDA,10,0)),U,3)=1:$P($G(^(0)),U,3),1:DFLT)
"RTN","TIULA1",44,0)
 I XQORM(0)'["A" S X=XQORM("B")
"RTN","TIULA1",45,0)
 S XQORM("A")=$S(CLASS=3:"",1:"Select ")_$S(CLASS=3:"TITLE",1:"Document")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA1",46,0)
 I XQORM(0)["D" D
"RTN","TIULA1",47,0)
 . N LISTNAME,PERSNAME S LISTNAME=$$PNAME^TIULC1(CLASS)
"RTN","TIULA1",48,0)
 . I $E(LISTNAME,$L(LISTNAME))="Y" D
"RTN","TIULA1",49,0)
 . . S LISTNAME=$E(LISTNAME,1,($L(LISTNAME)-1))_"IES"
"RTN","TIULA1",50,0)
 . I $E(LISTNAME,$L(LISTNAME))="y" D
"RTN","TIULA1",51,0)
 . . S LISTNAME=$E(LISTNAME,1,($L(LISTNAME)-1))_"ies"
"RTN","TIULA1",52,0)
 . S PERSNAME=$$PERSNAME^TIULC1(DUZ)
"RTN","TIULA1",53,0)
 . S LISTNAME=""""_"--- "_LISTNAME_" for "_PERSNAME_" ---"_""""
"RTN","TIULA1",54,0)
 . S XQORM("H")="W !!,$$CENTER^TIULS("_LISTNAME_"),!"
"RTN","TIULA1",55,0)
 S XQORM("S")="I $$CANPICK^TIULP(+$G(^TIU(8925.98,+DA(1),10,+DA,0)))"
"RTN","TIULA1",56,0)
 D EN^XQORM
"RTN","TIULA1",57,0)
 Q
"RTN","TIULA1",58,0)
SELCAT(Y,PARM,DFLT,TIUOVER) ; Get preferred documents for user
"RTN","TIULA1",59,0)
 N TIUI,TIUDA,CATREC,CATLOOK,CATSCRN,CATVAL,XQORM,X ;P75 newed CATVAL
"RTN","TIULA1",60,0)
 N TIUT1,TIUT2,TIUTSTR,TIUHOLD
"RTN","TIULA1",61,0)
 S TIUI=0
"RTN","TIULA1",62,0)
 S XQORM="1;TIU(8925.8,"
"RTN","TIULA1",63,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA1",64,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",XQORM,0))
"RTN","TIULA1",65,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",XQORM,DFLT)),1:"")
"RTN","TIULA1",66,0)
 S XQORM(0)=$G(PARM,"1A")
"RTN","TIULA1",67,0)
 S XQORM("B")=$G(DFLT,"AUTHOR")
"RTN","TIULA1",68,0)
 I +$G(ORVP) S XQORM("S")="I $G(^XUTL(""XQORM"",XQORM,+$O(^XUTL(""XQORM"",XQORM,""B"",DA,0)),0))'[""Patient"""
"RTN","TIULA1",69,0)
 I XQORM(0)'["A" S X=XQORM("B")
"RTN","TIULA1",70,0)
 S XQORM("A")="Select SEARCH CATEGOR"_$S(+XQORM(0)'=1:"IES",1:"Y")_": "
"RTN","TIULA1",71,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- Search Categories ---""),!"
"RTN","TIULA1",72,0)
 D EN^XQORM
"RTN","TIULA1",73,0)
 ; BEGIN TIU207
"RTN","TIULA1",74,0)
 ; FLAG IF TITLE OR ALL CATEGORIES WERE SELECTED. NEEDED IN HDR^TIURH AS ^TMP("TIUR","TIU OVERRIDE")
"RTN","TIULA1",75,0)
 S TIUT1="",TIUTSTR=""
"RTN","TIULA1",76,0)
 F  S TIUT1=$O(Y(TIUT1)) Q:TIUT1=""  D
"RTN","TIULA1",77,0)
 .I $P(Y(TIUT1),"^",3)="Title" S TIUTSTR=TIUTSTR_"TITLE"
"RTN","TIULA1",78,0)
 .I $P(Y(TIUT1),"^",3)="All Categories" S TIUTSTR=TIUTSTR_"ALL"
"RTN","TIULA1",79,0)
 I TIUTSTR["TITLE" S TIUOVER=TIUTSTR
"RTN","TIULA1",80,0)
 ; IF SPECIFIC CATEGORY AND ALL CATEGORIES WHERE SELECTED THEN REMOVE ALL CATEGORIES.
"RTN","TIULA1",81,0)
 I $O(Y(""),-1)>1,TIUTSTR["ALL" D
"RTN","TIULA1",82,0)
 .M TIUHOLD=Y K Y
"RTN","TIULA1",83,0)
 .S TIUT1="",TIUT2=1
"RTN","TIULA1",84,0)
 .F  S TIUT1=$O(TIUHOLD(TIUT1)) Q:TIUT1=""  D
"RTN","TIULA1",85,0)
 ..I $P(TIUHOLD(TIUT1),"^",3)="All Categories" Q
"RTN","TIULA1",86,0)
 ..S Y(TIUT2)=TIUHOLD(TIUT1)
"RTN","TIULA1",87,0)
 ..S Y=TIUT2
"RTN","TIULA1",88,0)
 ..S TIUT2=TIUT2+1
"RTN","TIULA1",89,0)
 ; END TIU207
"RTN","TIULA1",90,0)
 F  S TIUI=$O(Y(TIUI)) Q:+TIUI'>0  D
"RTN","TIULA1",91,0)
 . S TIUDA=+$P(Y(TIUI),U,2)
"RTN","TIULA1",92,0)
 . S CATREC=$G(^TIU(8925.8,TIUDA,0))
"RTN","TIULA1",93,0)
 . S CATSCRN=$G(^TIU(8925.8,TIUDA,1))
"RTN","TIULA1",94,0)
 . S CATLOOK=$G(^TIU(8925.8,TIUDA,2))
"RTN","TIULA1",95,0)
 . S CATVAL=-1 ;P75
"RTN","TIULA1",96,0)
 . I CATLOOK']"",+$P(CATREC,U,4) S CATVAL=$$DICLOOK(CATREC,CATSCRN)
"RTN","TIULA1",97,0)
 . I CATLOOK]"" S CATVAL=$$LOOK(CATLOOK)
"RTN","TIULA1",98,0)
 . I +CATVAL'=-1,$L(CATVAL) S Y(TIUI)=$P(CATREC,U,2)_U_CATVAL
"RTN","TIULA1",99,0)
 . E  K Y(TIUI) S Y=+$G(Y)-1
"RTN","TIULA1",100,0)
 Q
"RTN","TIULA1",101,0)
DICLOOK(CATEGORY,SCREEN) ; Call ^DIC to get category value
"RTN","TIULA1",102,0)
 N DIC,X,Y
"RTN","TIULA1",103,0)
 S DIC=+$P(CATEGORY,U,4),DIC(0)="AEMQZ"
"RTN","TIULA1",104,0)
 S DIC("A")="Select "_$P(CATEGORY,U)_": "
"RTN","TIULA1",105,0)
 I SCREEN]"" X SCREEN
"RTN","TIULA1",106,0)
 D ^DIC I +$G(DUOUT),(X="^^") S DIROUT=1
"RTN","TIULA1",107,0)
 Q Y
"RTN","TIULA1",108,0)
LOOK(LOOKUP) ; Execute LOOKUP CODE
"RTN","TIULA1",109,0)
 N X,Y
"RTN","TIULA1",110,0)
 X LOOKUP
"RTN","TIULA1",111,0)
 Q Y
"RTN","TIULA1",112,0)
GETVSIT(DFN) ; Visit selection code
"RTN","TIULA1",113,0)
 N X,Y
"RTN","TIULA1",114,0)
 I +$G(ORVP),'+$G(DFN) S DFN=+$G(ORVP)
"RTN","TIULA1",115,0)
 D MAIN^TIUVISIT(.Y,$G(DFN))
"RTN","TIULA1",116,0)
 S Y=$G(Y("VISIT"))
"RTN","TIULA1",117,0)
 I +Y,+$P(Y,U,2) S $P(Y,U,2)=$$DATE^TIULS($P(Y,U,2),"MM/DD/YY HR:MIN")
"RTN","TIULA1",118,0)
 Q Y
"RTN","TIULA1",119,0)
GETTERM(X) ; Get Lexicon term
"RTN","TIULA1",120,0)
 N DIC,USEX,Y
"RTN","TIULA1",121,0)
 S DIC=757.01,DIC(0)="AEMQZ",DIC("A")="Select PROBLEM: "
"RTN","TIULA1",122,0)
 D ^DIC
"RTN","TIULA1",123,0)
 I +Y'>0,(X]""),(X'=" "),(X'["^") D
"RTN","TIULA1",124,0)
 . S USEX=$$READ^TIUU("Y",">>>  Use "_X,"Yes")
"RTN","TIULA1",125,0)
 . I +USEX S Y=1_U_X
"RTN","TIULA1",126,0)
 Q Y
"RTN","TIULA1",127,0)
GETDIV() ; Get Institution Number and Name
"RTN","TIULA1",128,0)
 N TIUDIV,TIUSTN,Y
"RTN","TIULA1",129,0)
 S TIUDIV=$S($P($G(^DG(43,1,"GL")),U,2):$$MULTDIV,1:$$PRIM^VASITE)
"RTN","TIULA1",130,0)
 S TIUSTN=$$SITE^VASITE(,TIUDIV)
"RTN","TIULA1",131,0)
 I $P(TIUSTN,U)>0,($P(TIUSTN,U,2)]"") D
"RTN","TIULA1",132,0)
 . S Y=$P(TIUSTN,U)_U_$P(TIUSTN,U,2)
"RTN","TIULA1",133,0)
 E  D
"RTN","TIULA1",134,0)
 . S Y=-1
"RTN","TIULA1",135,0)
 Q Y
"RTN","TIULA1",136,0)
MULTDIV() ; User selects from active divisions
"RTN","TIULA1",137,0)
 N DIR,X,Y
"RTN","TIULA1",138,0)
 S DIR(0)="PA^40.8:EM"
"RTN","TIULA1",139,0)
 S DIR("A")="Select DIVISION: "
"RTN","TIULA1",140,0)
 S DIR("S")="I $$SITE^VASITE(,+Y)>0"
"RTN","TIULA1",141,0)
 D ^DIR
"RTN","TIULA1",142,0)
 Q +Y
"RTN","TIUR")
0^2^B39996639^B36847949
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,112,207**;Jun 20, 1997
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG,TIUSC207,TIU1DOC
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS S STATUS=$$STAT
"RTN","TIUR",12,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIUR",13,0)
 S TIUI=0
"RTN","TIUR",14,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR",15,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR",16,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",17,0)
 . Q:'STATIFN
"RTN","TIUR",18,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",19,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR",20,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",21,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",22,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",23,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",24,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",25,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",26,0)
 ; TIU207-If only 1 docytyp and have been to screen prompt then go back another level to avoid loop with next prompt.
"RTN","TIUR",27,0)
 I $G(TIUSC207)=1,$G(TIU1DOC)=1 D  G STATUS
"RTN","TIUR",28,0)
 .S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",29,0)
 S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",30,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",31,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",32,0)
 S TIU1DOC=+$P($G(^TIU(8925.1,+TIUCLASS,10,0)),U,3)
"RTN","TIUR",33,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",34,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",35,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",36,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",37,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",38,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",39,0)
SCREEN ;
"RTN","TIUR",40,0)
 S TIUSC207=1
"RTN","TIUR",41,0)
 N TIUNAME,TIUOVER
"RTN","TIUR",42,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",43,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR",44,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR",45,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",46,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",47,0)
 . S SCREEN="ALL"
"RTN","TIUR",48,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",49,0)
 S TIUOVER=""
"RTN","TIUR",50,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR",.TIUOVER)
"RTN","TIUR",51,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",52,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",53,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",54,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",55,0)
 D CHECKADD
"RTN","TIUR",56,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",57,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",58,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",59,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",60,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",61,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",62,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",63,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",64,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",65,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",66,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",67,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",68,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",69,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",70,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",71,0)
 ;    update video for line to be attached: --
"RTN","TIUR",72,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",73,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",74,0)
 Q
"RTN","TIUR",75,0)
STAT() ; Determine status
"RTN","TIUR",76,0)
 N TIUY
"RTN","TIUR",77,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR",78,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR",79,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR",80,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR",81,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR",82,0)
STATX Q TIUY
"RTN","TIUR",83,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",84,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",85,0)
 S (TIUI,HIT)=0
"RTN","TIUR",86,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",87,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",88,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",89,0)
 Q
"RTN","TIUR",90,0)
 ;
"RTN","TIUR",91,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",92,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",93,0)
 Q
"RTN","TIUR",94,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",95,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",96,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",97,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",98,0)
 Q
"RTN","TIUR",99,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",100,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",101,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",102,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",103,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",104,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",105,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",106,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",107,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",108,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",109,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",110,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",111,0)
 S ^TMP("TIUR",$J,"TITLE OVERRIDE")=$G(TIUOVER)
"RTN","TIUR",112,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",113,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",114,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",115,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",116,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",117,0)
 . I XREF'="ASUB" D
"RTN","TIUR",118,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",119,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",120,0)
 . I XREF="ASUB" D
"RTN","TIUR",121,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIUR",122,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",123,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",124,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",125,0)
 Q
"RTN","TIUR",126,0)
 ;
"RTN","TIUR",127,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",128,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",129,0)
 K VALMY
"RTN","TIUR",130,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",131,0)
 Q
"RTN","TIUR",132,0)
 ;
"RTN","TIUR",133,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",134,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",135,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",136,0)
 S TIURBLD=1
"RTN","TIUR",137,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",138,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",139,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",140,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",141,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",142,0)
 S TIUI=1
"RTN","TIUR",143,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",144,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",145,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",146,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",147,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",148,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",149,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",150,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",151,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",152,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",153,0)
 Q
"RTN","TIURH")
0^3^B4359580^B3848537
"RTN","TIURH",1,0)
TIURH ; SLC/JER - Review Screen Header ;5/7/03
"RTN","TIURH",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113,207**;Jun 20, 1997
"RTN","TIURH",3,0)
HDR ; Initialize header for clinician's review screen
"RTN","TIURH",4,0)
 N BY,TIUI,TIUX,SCREEN,STATUS,RANGE,TIUBY,TIUDOCS,XREF,TIUNAME
"RTN","TIURH",5,0)
 S TIUX=$G(^TMP("TIUR",$J,0)),STATUS=$P(TIUX,U,2),SCREEN=$P(TIUX,U,3,99)
"RTN","TIURH",6,0)
 S VALM("TITLE")=$S($L(STATUS,",")>1:$S(VALM("ENTITY")="Document":"Clinical",1:""),1:STATUS)
"RTN","TIURH",7,0)
 I $G(XQY0)["MY UNSIGNED" S VALM("TITLE")="MY UNSIGNED"
"RTN","TIURH",8,0)
 S:$L(VALM("TITLE")) VALM("TITLE")=VALM("TITLE")_" "
"RTN","TIURH",9,0)
 S VALM("TITLE")=VALM("TITLE")_$S($L(VALM("ENTITY")):$$NTTNM(VALM("ENTITY")),1:"Document")_"s"
"RTN","TIURH",10,0)
 I +TIUEDT>1 S RANGE=" from "_$$DATE^TIULS(TIUEDT,"MM/DD/YY")_" to "_$$DATE^TIULS(TIULDT,"MM/DD/YY")
"RTN","TIURH",11,0)
 F TIUI=1:1:$L(SCREEN,";") D
"RTN","TIURH",12,0)
 . S XREF=$P($P(SCREEN,";",TIUI),U),XREF=$O(^TIU(8925.8,"C",XREF,0))
"RTN","TIURH",13,0)
 . I $D(TIUQUIK) D
"RTN","TIURH",14,0)
 . . S TIUBY=$G(TIUBY)_$S($G(TIUBY)]"":" or ",1:"")
"RTN","TIURH",15,0)
 . E  D
"RTN","TIURH",16,0)
 . . S TIUBY=$G(TIUBY)_$S($G(TIUBY)]"":" and ",1:"")
"RTN","TIURH",17,0)
 . S TIUNAME=$P($G(^TIU(8925.8,+XREF,0)),U)
"RTN","TIURH",18,0)
 . I TIUNAME="ALL CATEGORIES",$G(^TMP("TIUR",$J,"TITLE OVERRIDE"))["TITLE" S TIUNAME="TITLE"
"RTN","TIURH",19,0)
 . S TIUBY=$G(TIUBY)_TIUNAME
"RTN","TIURH",20,0)
 . S:$P($P(SCREEN,";",TIUI),U,3)]"" TIUBY=$G(TIUBY)_" ("_$P($P(SCREEN,";",TIUI),U,3)_")"
"RTN","TIURH",21,0)
 S BY="by "_TIUBY
"RTN","TIURH",22,0)
 ; I BY'["ALL",(BY'["SUBJECT") S BY=BY_" for "_$P($P(SCREEN,U,3),";")
"RTN","TIURH",23,0)
 S VALMHDR(1)=$$CENTER^TIULS(BY_$S($L(SCREEN,";")=1:$G(RANGE),1:""))
"RTN","TIURH",24,0)
 S TIUDOCS=$J(+$G(^TMP("TIUR",$J,0)),4)_" documents"
"RTN","TIURH",25,0)
 S VALMHDR(1)=$$SETSTR^VALM1(TIUDOCS,VALMHDR(1),(IOM-$L(TIUDOCS)),$L(TIUDOCS))
"RTN","TIURH",26,0)
 ; I $L($G(RANGE)) S VALMHDR(2)=$$CENTER^TIULS(RANGE)
"RTN","TIURH",27,0)
 Q
"RTN","TIURH",28,0)
NTTNM(NAME) ; Handle plural names appropriately
"RTN","TIURH",29,0)
 I "Yy"[$E(NAME,$L(NAME)) S NAME=$E(NAME,1,($L(NAME)-1))_"ie"
"RTN","TIURH",30,0)
 I NAME="Discharge Summarie" S NAME="Disch Summarie"
"RTN","TIURH",31,0)
 Q NAME
"VER")
8.0^22.0
"BLD",6560,6)
^197
**END**
**END**
