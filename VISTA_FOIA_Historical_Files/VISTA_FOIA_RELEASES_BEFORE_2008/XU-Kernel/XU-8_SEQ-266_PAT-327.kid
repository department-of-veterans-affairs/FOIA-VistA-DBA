Released XU*8*327 SEQ #266
Extracted from mail message
**KIDS**:XU*8.0*327^

**INSTALL NAME**
XU*8.0*327
"BLD",782,0)
XU*8.0*327^KERNEL^0^3030919^y
"BLD",782,1,0)
^^2^2^3030919^^^^
"BLD",782,1,1,0)
See patch XU*8*327 in the National Patch Module on FORUM for complete
"BLD",782,1,2,0)
information on this patch.
"BLD",782,4,0)
^9.64PA^^0
"BLD",782,"INID")
^y
"BLD",782,"INIT")
POST^XU8P327
"BLD",782,"KRN",0)
^9.67PA^8989.52^19
"BLD",782,"KRN",.4,0)
.4
"BLD",782,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",782,"KRN",.401,0)
.401
"BLD",782,"KRN",.402,0)
.402
"BLD",782,"KRN",.403,0)
.403
"BLD",782,"KRN",.5,0)
.5
"BLD",782,"KRN",.84,0)
.84
"BLD",782,"KRN",3.6,0)
3.6
"BLD",782,"KRN",3.8,0)
3.8
"BLD",782,"KRN",9.2,0)
9.2
"BLD",782,"KRN",9.8,0)
9.8
"BLD",782,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",782,"KRN",9.8,"NM",1,0)
XUA4A72^^0^B15892693
"BLD",782,"KRN",9.8,"NM",2,0)
XU8P327^^0^B152557
"BLD",782,"KRN",9.8,"NM","B","XU8P327",2)

"BLD",782,"KRN",9.8,"NM","B","XUA4A72",1)

"BLD",782,"KRN",19,0)
19
"BLD",782,"KRN",19,"NM",0)
^9.68A^^
"BLD",782,"KRN",19.1,0)
19.1
"BLD",782,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",782,"KRN",101,0)
101
"BLD",782,"KRN",409.61,0)
409.61
"BLD",782,"KRN",771,0)
771
"BLD",782,"KRN",870,0)
870
"BLD",782,"KRN",8989.51,0)
8989.51
"BLD",782,"KRN",8989.52,0)
8989.52
"BLD",782,"KRN",8994,0)
8994
"BLD",782,"KRN","B",.4,.4)

"BLD",782,"KRN","B",.401,.401)

"BLD",782,"KRN","B",.402,.402)

"BLD",782,"KRN","B",.403,.403)

"BLD",782,"KRN","B",.5,.5)

"BLD",782,"KRN","B",.84,.84)

"BLD",782,"KRN","B",3.6,3.6)

"BLD",782,"KRN","B",3.8,3.8)

"BLD",782,"KRN","B",9.2,9.2)

"BLD",782,"KRN","B",9.8,9.8)

"BLD",782,"KRN","B",19,19)

"BLD",782,"KRN","B",19.1,19.1)

"BLD",782,"KRN","B",101,101)

"BLD",782,"KRN","B",409.61,409.61)

"BLD",782,"KRN","B",771,771)

"BLD",782,"KRN","B",870,870)

"BLD",782,"KRN","B",8989.51,8989.51)

"BLD",782,"KRN","B",8989.52,8989.52)

"BLD",782,"KRN","B",8994,8994)

"BLD",782,"QUES",0)
^9.62^^
"BLD",782,"REQB",0)
^9.611^1^1
"BLD",782,"REQB",1,0)
XU*8.0*300^1
"BLD",782,"REQB","B","XU*8.0*300",1)

"INIT")
POST^XU8P327
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
327^3030919
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3030919
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*327 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XU8P327")
0^2^B152557
"RTN","XU8P327",1,0)
XU8P327 ;ISC-SF/GB-DELETE BOGUS PERSON CLASS RECORDS ;09/19/2003  13:12
"RTN","XU8P327",2,0)
 ;;8.0;KERNEL;**327**;Jul 10, 1995
"RTN","XU8P327",3,0)
 Q
"RTN","XU8P327",4,0)
POST ; Delete bogus PERSON CLASS records from file 200
"RTN","XU8P327",5,0)
 ; ^VA(200,duz,"USC1",-1,0)="^^3030824"
"RTN","XU8P327",6,0)
 N I,J
"RTN","XU8P327",7,0)
 S I=0
"RTN","XU8P327",8,0)
 F  S I=$O(^VA(200,I)) Q:'I  D
"RTN","XU8P327",9,0)
 . S J=""
"RTN","XU8P327",10,0)
 . F  S J=$O(^VA(200,I,"USC1",J)) Q:J'<0  K ^(J,0)
"RTN","XU8P327",11,0)
 Q
"RTN","XUA4A72")
0^1^B15892693
"RTN","XUA4A72",1,0)
XUA4A72 ;SFISC/RWF - Person class API's ;09/18/2003  13:46
"RTN","XUA4A72",2,0)
 ;;8.0;KERNEL;**27,49,74,132,222,300,327**;Jul 10, 1995
"RTN","XUA4A72",3,0)
 ; Entry Points (DBIA 1625)
"RTN","XUA4A72",4,0)
 ; $$GET      - Returns active class, given duz and date.
"RTN","XUA4A72",5,0)
 ; $$IEN2CODE - Returns VA CODE from PERSON CLASS file, given IEN.
"RTN","XUA4A72",6,0)
 ; $$CODE2TXT - Returns HCFA text from PERSON CLASS file, given IEN
"RTN","XUA4A72",7,0)
 ;              or VA CODE.
"RTN","XUA4A72",8,0)
 Q  ;No access from top.
"RTN","XUA4A72",9,0)
GET(IEN,DATE) ;sr. Get the active class on a date
"RTN","XUA4A72",10,0)
 ;IEN of user.
"RTN","XUA4A72",11,0)
 N X1,Y1,D
"RTN","XUA4A72",12,0)
 S:$G(DATE)="" DATE=DT S D=DATE
"RTN","XUA4A72",13,0)
 ;The return is file 200 ien_^_NODE
"RTN","XUA4A72",14,0)
 S X1=$$GETUE(IEN,DATE) I X1'>0 Q X1
"RTN","XUA4A72",15,0)
 S X1=$P(X1,"^",2,99) ;or X1=^VA(200,IEN,"USC1",+X1,0)
"RTN","XUA4A72",16,0)
 S Y1=$G(^USC(8932.1,+X1,0))
"RTN","XUA4A72",17,0)
 ;IEN^Occupation^specialty^sub-specialty^Effective date^expiration date^VA Code^specialty code
"RTN","XUA4A72",18,0)
 Q +X1_U_$P(Y1,U,1,3)_U_$P(X1,U,2,3)_U_$P(Y1,U,6)_U_$P(Y1,U,9)
"RTN","XUA4A72",19,0)
 ;
"RTN","XUA4A72",20,0)
IEN2CODE(IEN) ;sr. Get the code for an IEN
"RTN","XUA4A72",21,0)
 Q $P($G(^USC(8932.1,+$G(IEN),0)),U,6)
"RTN","XUA4A72",22,0)
 ;
"RTN","XUA4A72",23,0)
IEN2DATA(IEN) ;Get person class data for an IEN
"RTN","XUA4A72",24,0)
 Q $G(^USC(8932.1,+$G(IEN),0))
"RTN","XUA4A72",25,0)
 ;
"RTN","XUA4A72",26,0)
CODE2TXT(CODE) ;sr. Convert IEN or V-code to text
"RTN","XUA4A72",27,0)
 I CODE?1"V"1.N S CODE=$$VCLK(CODE)
"RTN","XUA4A72",28,0)
 Q $P($G(^USC(8932.1,+CODE,0)),U,1,3)
"RTN","XUA4A72",29,0)
 ;
"RTN","XUA4A72",30,0)
VCLK(X) ;Lookup a V-code, Return IEN
"RTN","XUA4A72",31,0)
 Q $O(^USC(8932.1,"F",X,0))
"RTN","XUA4A72",32,0)
 ;
"RTN","XUA4A72",33,0)
GETUE(IEN,DATE) ;private, Get the user entry
"RTN","XUA4A72",34,0)
 N D,X,Y,XUOK
"RTN","XUA4A72",35,0)
 Q:'$D(^VA(200,+$G(IEN),0)) -1
"RTN","XUA4A72",36,0)
 Q:$O(^VA(200,IEN,"USC1",0))="" -1
"RTN","XUA4A72",37,0)
 S XUOK=0
"RTN","XUA4A72",38,0)
 S D=$O(^VA(200,IEN,"USC1","AD",DATE))
"RTN","XUA4A72",39,0)
 F  S D=$O(^VA(200,IEN,"USC1","AD",D),-1) Q:D=""  D  Q:XUOK
"RTN","XUA4A72",40,0)
 . S Y=""
"RTN","XUA4A72",41,0)
 . F  S Y=$O(^VA(200,IEN,"USC1","AD",D,Y),-1) Q:'Y  D  Q:XUOK
"RTN","XUA4A72",42,0)
 . . S X=$G(^VA(200,IEN,"USC1",Y,0))
"RTN","XUA4A72",43,0)
 . . I $P(X,U,2),DATE'<$P(X,U,2),DATE<$P(X,U,3)!($P(X,U,3)="") S XUOK=1
"RTN","XUA4A72",44,0)
 Q $S(XUOK:Y_U_X_U_U,1:-2)
"RTN","XUA4A72",45,0)
 ;
"RTN","XUA4A72",46,0)
REMOVE ;Allow privileged user to remove a wrong entry in the users file.
"RTN","XUA4A72",47,0)
 N XUDA,XUDA1,XUWT,%
"RTN","XUA4A72",48,0)
 S XUDA1=+$$LOOKUP^XUSER Q:XUDA1'>0
"RTN","XUA4A72",49,0)
 W !,"This user has the following Person Class enties:"
"RTN","XUA4A72",50,0)
 S XUWT=^DD(8932.1,0,"ID","WRITE")
"RTN","XUA4A72",51,0)
 F XUDA=0:0 S XUDA=$O(^VA(200,XUDA1,"USC1",XUDA)) Q:XUDA'>0  S %=+$G(^(XUDA,0)) I %>0 W !,$P(^USC(8932.1,%,0),U) X XUWT
"RTN","XUA4A72",52,0)
 S DIR(0)="Y",DIR("A")="Are you sure you want to remove ALL these entries" D ^DIR Q:$D(DIRUT)!(Y'=1)
"RTN","XUA4A72",53,0)
 F XUDA=0:0 S XUDA=$O(^VA(200,XUDA1,"USC1",XUDA)) Q:XUDA'>0  S DIK="^VA(200,DA(1),""USC1"",",DA=XUDA,DA(1)=XUDA1 D ^DIK
"RTN","XUA4A72",54,0)
 Q
"RTN","XUA4A72",55,0)
 ;
"RTN","XUA4A72",56,0)
TERM(IEN,DATE) ;Called from XUSTERM, Set the expiration date for a user being terminated.
"RTN","XUA4A72",57,0)
 N Y1
"RTN","XUA4A72",58,0)
 Q:$G(DATE)'>0
"RTN","XUA4A72",59,0)
 S Y1=$$GETUE(IEN,DATE)
"RTN","XUA4A72",60,0)
 I Y1'>0!$L($P(Y1,"^",4)) Q
"RTN","XUA4A72",61,0)
 D OLD(IEN,+Y1,DATE)
"RTN","XUA4A72",62,0)
 Q
"RTN","XUA4A72",63,0)
 ;
"RTN","XUA4A72",64,0)
SET01 ;Called from the X-ref on the .01 field
"RTN","XUA4A72",65,0)
 Q:$P(^VA(200,DA(1),"USC1",DA,0),U,2)>0
"RTN","XUA4A72",66,0)
 S $P(^VA(200,DA(1),"USC1",DA,0),U,2)=DT ;Trigger date
"RTN","XUA4A72",67,0)
 D UPDATE(200.05,2,DT)
"RTN","XUA4A72",68,0)
 ;
"RTN","XUA4A72",69,0)
SET2 ;Call from the X-ref on the Effective Date field
"RTN","XUA4A72",70,0)
 N L,REC
"RTN","XUA4A72",71,0)
 S L=$O(^VA(200,DA(1),"USC1",DA),-1) Q:L'>0
"RTN","XUA4A72",72,0)
 S REC=^VA(200,DA(1),"USC1",L,0)
"RTN","XUA4A72",73,0)
 I $P(REC,U,3)="" D OLD(DA(1),L,$$MAX^XLFMTH(X,$P(REC,U,2))) ;Inactivate the old one
"RTN","XUA4A72",74,0)
 Q
"RTN","XUA4A72",75,0)
KILL2 ;Call from the X-ref on the Effective Date field
"RTN","XUA4A72",76,0)
 N L
"RTN","XUA4A72",77,0)
 S L=$O(^VA(200,DA(1),"USC1",DA),-1) Q:L'>0
"RTN","XUA4A72",78,0)
 I $P(^VA(200,DA(1),"USC1",L,0),U,3)=X D OLD(DA(1),L,"")
"RTN","XUA4A72",79,0)
 Q
"RTN","XUA4A72",80,0)
 ;
"RTN","XUA4A72",81,0)
OLD(D0,D1,DATE) ;Inactivate the old one (Expiration Date)
"RTN","XUA4A72",82,0)
 N DA,X
"RTN","XUA4A72",83,0)
 S $P(^VA(200,D0,"USC1",D1,0),U,3)=DATE ;Inactivate the old one
"RTN","XUA4A72",84,0)
 S DA(1)=D0,DA=D1 D UPDATE(200.05,3,DATE)
"RTN","XUA4A72",85,0)
 Q
"RTN","XUA4A72",86,0)
UPDATE(DIH,DIG,DIV,DIU) ;file,field,new value,old value
"RTN","XUA4A72",87,0)
 S DIV=$G(DIV),DIU=$G(DIU),DIV(0)=DA(1),DIV(1)=DA
"RTN","XUA4A72",88,0)
 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"RTN","XUA4A72",89,0)
 Q
"RTN","XUA4A72",90,0)
DDS1 ;Called from Pre-action person class field
"RTN","XUA4A72",91,0)
 N %,XUDA,XU
"RTN","XUA4A72",92,0)
 I X]"" S %=^USC(8932.1,X,0),XU(1)=$P(%,U,1),XU(2)="  "_$P(%,U,2),XU(3)="    "_$P(%,U,3) D HLP^DDSUTL(.XU)
"RTN","XUA4A72",93,0)
 Q:DA'>0  M XUDA=DA N DA ;Hide DA
"RTN","XUA4A72",94,0)
 S %=$$GET^DDSVAL(DIE,.XUDA,3,"","I"),%=$S(%>0:1,1:0)
"RTN","XUA4A72",95,0)
 D UNED^DDSUTL(2,,,%),UNED^DDSUTL(3,,,%)
"RTN","XUA4A72",96,0)
 Q
"RTN","XUA4A72",97,0)
DDS2 ;Called from effective date on form
"RTN","XUA4A72",98,0)
 N %,XUDA M XUDA=DA N DA ;Hide DA
"RTN","XUA4A72",99,0)
 S XUDA=$O(^VA(200,XUDA(1),"USC1",XUDA),-1) Q:XUDA'>0
"RTN","XUA4A72",100,0)
 S %=$$GET^DDSVAL(DIE,.XUDA,3,"","I") Q:%&(%<X)  ;Already has value
"RTN","XUA4A72",101,0)
 D PUT^DDSVAL(DIE,.XUDA,3,X,"","I")
"RTN","XUA4A72",102,0)
 Q
"RTN","XUA4A72",103,0)
DDS3(%) ;Data validation
"RTN","XUA4A72",104,0)
 I %=2,$$GET^DDSVAL(DIE,.DA,3,"","I")]"" D
"RTN","XUA4A72",105,0)
 . S DDSERROR=1
"RTN","XUA4A72",106,0)
 . D HLP^DDSUTL("This field is uneditable because Expired Date already has data")
"RTN","XUA4A72",107,0)
 . Q
"RTN","XUA4A72",108,0)
 I %=3,DDSOLD]"",X'=DDSOLD D
"RTN","XUA4A72",109,0)
 . S DDSERROR=1
"RTN","XUA4A72",110,0)
 . D HLP^DDSUTL("You cannot change the value of this field.")
"RTN","XUA4A72",111,0)
 . Q
"RTN","XUA4A72",112,0)
 Q
"VER")
8.0^22.0
**END**
**END**
