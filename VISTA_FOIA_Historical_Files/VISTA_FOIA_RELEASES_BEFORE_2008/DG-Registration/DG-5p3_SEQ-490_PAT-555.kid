Released DG*5.3*555 SEQ #490
Extracted from mail message
**KIDS**:DG*5.3*555^

**INSTALL NAME**
DG*5.3*555
"BLD",5200,0)
DG*5.3*555^REGISTRATION^0^3031119^y
"BLD",5200,1,0)
^^1^1^3031107^
"BLD",5200,1,1,0)
This patch fixes various NOIS calls.  See NPM for details.
"BLD",5200,4,0)
^9.64PA^^
"BLD",5200,"INIT")
POST^DG53P555
"BLD",5200,"KRN",0)
^9.67PA^8989.52^19
"BLD",5200,"KRN",.4,0)
.4
"BLD",5200,"KRN",.401,0)
.401
"BLD",5200,"KRN",.402,0)
.402
"BLD",5200,"KRN",.403,0)
.403
"BLD",5200,"KRN",.5,0)
.5
"BLD",5200,"KRN",.84,0)
.84
"BLD",5200,"KRN",3.6,0)
3.6
"BLD",5200,"KRN",3.8,0)
3.8
"BLD",5200,"KRN",9.2,0)
9.2
"BLD",5200,"KRN",9.8,0)
9.8
"BLD",5200,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",5200,"KRN",9.8,"NM",1,0)
DGPMDD1^^0^B4613930
"BLD",5200,"KRN",9.8,"NM",2,0)
DGPMDD2^^0^B5983685
"BLD",5200,"KRN",9.8,"NM",3,0)
DGPREP5^^0^B29207834
"BLD",5200,"KRN",9.8,"NM",4,0)
DGRPE^^0^B42176360
"BLD",5200,"KRN",9.8,"NM",5,0)
DGPFRFA^^0^B16570169
"BLD",5200,"KRN",9.8,"NM",6,0)
DGPFRFR^^0^B16461500
"BLD",5200,"KRN",9.8,"NM",7,0)
DG53P555^^0^B1583758
"BLD",5200,"KRN",9.8,"NM",8,0)
DGMSTR2^^0^B71776841
"BLD",5200,"KRN",9.8,"NM","B","DG53P555",7)

"BLD",5200,"KRN",9.8,"NM","B","DGMSTR2",8)

"BLD",5200,"KRN",9.8,"NM","B","DGPFRFA",5)

"BLD",5200,"KRN",9.8,"NM","B","DGPFRFR",6)

"BLD",5200,"KRN",9.8,"NM","B","DGPMDD1",1)

"BLD",5200,"KRN",9.8,"NM","B","DGPMDD2",2)

"BLD",5200,"KRN",9.8,"NM","B","DGPREP5",3)

"BLD",5200,"KRN",9.8,"NM","B","DGRPE",4)

"BLD",5200,"KRN",19,0)
19
"BLD",5200,"KRN",19.1,0)
19.1
"BLD",5200,"KRN",101,0)
101
"BLD",5200,"KRN",409.61,0)
409.61
"BLD",5200,"KRN",771,0)
771
"BLD",5200,"KRN",870,0)
870
"BLD",5200,"KRN",8989.51,0)
8989.51
"BLD",5200,"KRN",8989.52,0)
8989.52
"BLD",5200,"KRN",8994,0)
8994
"BLD",5200,"KRN","B",.4,.4)

"BLD",5200,"KRN","B",.401,.401)

"BLD",5200,"KRN","B",.402,.402)

"BLD",5200,"KRN","B",.403,.403)

"BLD",5200,"KRN","B",.5,.5)

"BLD",5200,"KRN","B",.84,.84)

"BLD",5200,"KRN","B",3.6,3.6)

"BLD",5200,"KRN","B",3.8,3.8)

"BLD",5200,"KRN","B",9.2,9.2)

"BLD",5200,"KRN","B",9.8,9.8)

"BLD",5200,"KRN","B",19,19)

"BLD",5200,"KRN","B",19.1,19.1)

"BLD",5200,"KRN","B",101,101)

"BLD",5200,"KRN","B",409.61,409.61)

"BLD",5200,"KRN","B",771,771)

"BLD",5200,"KRN","B",870,870)

"BLD",5200,"KRN","B",8989.51,8989.51)

"BLD",5200,"KRN","B",8989.52,8989.52)

"BLD",5200,"KRN","B",8994,8994)

"BLD",5200,"PRE")
DG53P555
"BLD",5200,"QUES",0)
^9.62^^
"BLD",5200,"REQB",0)
^9.611^5^5
"BLD",5200,"REQB",1,0)
DG*5.3*109^1
"BLD",5200,"REQB",2,0)
DG*5.3*156^1
"BLD",5200,"REQB",3,0)
DG*5.3*425^1
"BLD",5200,"REQB",4,0)
DG*5.3*528^1
"BLD",5200,"REQB",5,0)
DG*5.3*195^1
"BLD",5200,"REQB","B","DG*5.3*109",1)

"BLD",5200,"REQB","B","DG*5.3*156",2)

"BLD",5200,"REQB","B","DG*5.3*195",5)

"BLD",5200,"REQB","B","DG*5.3*425",3)

"BLD",5200,"REQB","B","DG*5.3*528",4)

"INIT")
POST^DG53P555
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
555^3031119
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3031119
"PKG",5,22,1,"PAH",1,1,1,0)
This patch fixes various NOIS calls.  See NPM for details.
"PRE")
DG53P555
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","DG53P555")
0^7^B1583758
"RTN","DG53P555",1,0)
DG53P555 ; BAY/JAT- Patch DG*5.3*555 Install Utility Routine ; 11/7/03 11:25am
"RTN","DG53P555",2,0)
 ;;5.3;Registration;**555**;AUG 13, 1993
"RTN","DG53P555",3,0)
 ;
"RTN","DG53P555",4,0)
ENV ;Main entry point for Environment check point.
"RTN","DG53P555",5,0)
 ;
"RTN","DG53P555",6,0)
 S XPDABORT=""
"RTN","DG53P555",7,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","DG53P555",8,0)
 I XPDABORT="" K XPDABORT
"RTN","DG53P555",9,0)
 Q
"RTN","DG53P555",10,0)
PRE ;Main entry point for Pre-install items.
"RTN","DG53P555",11,0)
 Q
"RTN","DG53P555",12,0)
 ;
"RTN","DG53P555",13,0)
 ;
"RTN","DG53P555",14,0)
POST ;Main entry point for Post-install items.
"RTN","DG53P555",15,0)
 ;
"RTN","DG53P555",16,0)
 D POST1
"RTN","DG53P555",17,0)
 Q
"RTN","DG53P555",18,0)
POST1 ;remove references to field #1 in Race file (it is a
"RTN","DG53P555",19,0)
 ; partial duplicate of field #2) data dictionary
"RTN","DG53P555",20,0)
 ;
"RTN","DG53P555",21,0)
 K ^DD(10,1)
"RTN","DG53P555",22,0)
 K ^DD(10,"B","ABBREVIATION",1)
"RTN","DG53P555",23,0)
 K ^DD(10,"GL",0,2,1)
"RTN","DG53P555",24,0)
 Q
"RTN","DG53P555",25,0)
PROGCHK(XPDABORT)       ;checks for necessary programmer variables
"RTN","DG53P555",26,0)
 ;
"RTN","DG53P555",27,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DG53P555",28,0)
 . D BMES^XPDUTL("*****")
"RTN","DG53P555",29,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DG53P555",30,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","DG53P555",31,0)
 . D MES^XPDUTL("*****")
"RTN","DG53P555",32,0)
 . S XPDABORT=2
"RTN","DG53P555",33,0)
 Q
"RTN","DGMSTR2")
0^8^B71776841
"RTN","DGMSTR2",1,0)
DGMSTR2 ;ALB/SCK - MST DETAILED DEMOGRAPHIC REPORT ; 11/19/03 10:56am
"RTN","DGMSTR2",2,0)
 ;;5.3;Registration;**195,555**;Aug 13, 1993
"RTN","DGMSTR2",3,0)
 ;
"RTN","DGMSTR2",4,0)
EN ; Main entry point for report
"RTN","DGMSTR2",5,0)
 ; Variable List
"RTN","DGMSTR2",6,0)
 ;     DGBEG   - Beginning of date range (FM date)
"RTN","DGMSTR2",7,0)
 ;     DGEND   - End of date range (FM Date)
"RTN","DGMSTR2",8,0)
 ;     DGMST   - array of MST status codes
"RTN","DGMSTR2",9,0)
 ;     DGSEX   - Patient gender to filter on
"RTN","DGMSTR2",10,0)
 ;     DGPOS   - array of period of service values to filter on
"RTN","DGMSTR2",11,0)
 ;     DGDISP  - Sort report on
"RTN","DGMSTR2",12,0)
 ;     DGSDAT  - start date selection
"RTN","DGMSTR2",13,0)
 ;     DGEDAT  - end date selection
"RTN","DGMSTR2",14,0)
 ;     RPTREF  - location of report data array
"RTN","DGMSTR2",15,0)
 ;     RPTARRY - temporary location of report array
"RTN","DGMSTR2",16,0)
 ;     DGX     - temporary variable
"RTN","DGMSTR2",17,0)
 ;     MSTST   - temporary variable holding MST status
"RTN","DGMSTR2",18,0)
 ;     MSTPOS  - temporary array of selected POS's
"RTN","DGMSTR2",19,0)
 ;     MSTNAME - temporary variable, patient name
"RTN","DGMSTR2",20,0)
 ;     MSTIEN  - temporary variable, IEN in MST HISTORY File (#29.11)
"RTN","DGMSTR2",21,0)
 ;     MSTACT  - temporary array, service in country indicated
"RTN","DGMSTR2",22,0)
 ;     MSTDT   - temporary variable, MST status change date
"RTN","DGMSTR2",23,0)
 ;
"RTN","DGMSTR2",24,0)
 N DGBEG,DGEND,DGMST,DGSEX,DGPOS,DGDISP,DGSDAT,DGEDAT,DIC,Y,X,ZTSAVE
"RTN","DGMSTR2",25,0)
 ;
"RTN","DGMSTR2",26,0)
 ;; Get beginning date for report
"RTN","DGMSTR2",27,0)
 K DIRUT
"RTN","DGMSTR2",28,0)
 S DIR(0)="DAO^:"_$$DT^XLFDT_":EX",DIR("A")="Start Date: "
"RTN","DGMSTR2",29,0)
 S DIR("?")="Enter beginning date of the reports date range."
"RTN","DGMSTR2",30,0)
 D ^DIR K DIR
"RTN","DGMSTR2",31,0)
 Q:$D(DIRUT)
"RTN","DGMSTR2",32,0)
 S DGSDAT=+Y
"RTN","DGMSTR2",33,0)
 ;
"RTN","DGMSTR2",34,0)
 ;; Get ending date for report
"RTN","DGMSTR2",35,0)
 K DIRUT
"RTN","DGMSTR2",36,0)
 S DIR(0)="DAO^"_DGSDAT_":"_DT_":EX",DIR("A")="End Date: "
"RTN","DGMSTR2",37,0)
 S DIR("?")="Enter the ending date of the reports date range."
"RTN","DGMSTR2",38,0)
 D ^DIR K DIR
"RTN","DGMSTR2",39,0)
 Q:$D(DIRUT)
"RTN","DGMSTR2",40,0)
 S DGEDAT=+Y_.9999
"RTN","DGMSTR2",41,0)
 ;
"RTN","DGMSTR2",42,0)
 ; Call procedure to select MST status codes to include
"RTN","DGMSTR2",43,0)
 D GETMST(.DGMST)
"RTN","DGMSTR2",44,0)
 Q:($O(DGMST(""))="")
"RTN","DGMSTR2",45,0)
 ;
"RTN","DGMSTR2",46,0)
 ;; Select gender for report
"RTN","DGMSTR2",47,0)
 K DIRUT
"RTN","DGMSTR2",48,0)
 S DIR(0)="SAO^M:Male;F:Female;B:Both"
"RTN","DGMSTR2",49,0)
 S DIR("A")="Gender to display MST status for: ",DIR("B")="Both"
"RTN","DGMSTR2",50,0)
 S DIR("?",1)="Select the gender to include on the report, either male,"
"RTN","DGMSTR2",51,0)
 S DIR("?")="female or both."
"RTN","DGMSTR2",52,0)
 D ^DIR K DIR
"RTN","DGMSTR2",53,0)
 Q:$D(DIRUT)
"RTN","DGMSTR2",54,0)
 S DGSEX=Y
"RTN","DGMSTR2",55,0)
 ;
"RTN","DGMSTR2",56,0)
 ;; Select period of service to include
"RTN","DGMSTR2",57,0)
 N VAUTNI,VAUTSTR,VAUTVB
"RTN","DGMSTR2",58,0)
 S VAUTNI=0,VAUTSTR="Period of Service to include"
"RTN","DGMSTR2",59,0)
 S VAUTVB="DGPOS",DIC=21
"RTN","DGMSTR2",60,0)
 D FIRST^VAUTOMA
"RTN","DGMSTR2",61,0)
 ;
"RTN","DGMSTR2",62,0)
 ;; Select sort criteria
"RTN","DGMSTR2",63,0)
 K DIRUT
"RTN","DGMSTR2",64,0)
 S DIR(0)="SAO^P:Patient Name;S:Period of Service/Patient Name"
"RTN","DGMSTR2",65,0)
 S DIR("A")="Sort report by ",DIR("B")="Patient Name"
"RTN","DGMSTR2",66,0)
 S DIR("?",1)="Sort the report by either patient name, or by Period of"
"RTN","DGMSTR2",67,0)
 S DIR("?")="Service and within POS, by patient name."
"RTN","DGMSTR2",68,0)
 D ^DIR K DIR
"RTN","DGMSTR2",69,0)
 Q:$D(DIRUT)
"RTN","DGMSTR2",70,0)
 S DGDISP=Y
"RTN","DGMSTR2",71,0)
 ;
"RTN","DGMSTR2",72,0)
 ;; Set up print device using KERNEL utility
"RTN","DGMSTR2",73,0)
 N ZTSAVE
"RTN","DGMSTR2",74,0)
 F X="DGPOS","DGPOS(","DGDISP","DGSEX","DGSDAT","DGEDAT","DGMST(" D
"RTN","DGMSTR2",75,0)
 . S ZTSAVE(X)=""
"RTN","DGMSTR2",76,0)
 W !!,"This report is formatted for 132 characters, and will not format"
"RTN","DGMSTR2",77,0)
 W !,"correctly on either an 80 column terminal or printer."
"RTN","DGMSTR2",78,0)
 W !!,"This report may take a while to build and print.  In order to"
"RTN","DGMSTR2",79,0)
 W !,"free up your workstation, please queue this report to print device."
"RTN","DGMSTR2",80,0)
 D EN^XUTMDEVQ("RPT^DGMSTR2","MST Detailed Report",.ZTSAVE)
"RTN","DGMSTR2",81,0)
 D HOME^%ZIS
"RTN","DGMSTR2",82,0)
 Q
"RTN","DGMSTR2",83,0)
 ;
"RTN","DGMSTR2",84,0)
RPT ; Main entry point for printing report form KERNEL device utility
"RTN","DGMSTR2",85,0)
 N FRSTPAS
"RTN","DGMSTR2",86,0)
 S RPTREF="^TMP(""DGMST DEM"","_$J_")"
"RTN","DGMSTR2",87,0)
 K @RPTREF
"RTN","DGMSTR2",88,0)
 D BUILD(DGSDAT,DGEDAT,.DGMST,DGSEX,.DGPOS,DGDISP,RPTREF)
"RTN","DGMSTR2",89,0)
 I DGDISP["P" D PRNNAME(DGSDAT,DGEDAT,DGDISP,RPTREF,.DGMST)
"RTN","DGMSTR2",90,0)
 I DGDISP["S" D PRNPOS(DGSDAT,DGEDAT,DGDISP,RPTREF,.DGMST)
"RTN","DGMSTR2",91,0)
 K @RPTREF,RPTREF
"RTN","DGMSTR2",92,0)
 Q
"RTN","DGMSTR2",93,0)
 ;
"RTN","DGMSTR2",94,0)
BUILD(DGBEG,DGEND,DGMST,DGSEX,DGPOS,DGDISP,RPTARRY) ;
"RTN","DGMSTR2",95,0)
 ;; Build the report array using the parameters entered by the user
"RTN","DGMSTR2",96,0)
 ;
"RTN","DGMSTR2",97,0)
 N MSTDT,DFN,LINE,MSTIEN,DGX,MSTDAT,VADM,VAEL,VAPA,VA
"RTN","DGMSTR2",98,0)
 S MSTDT=DGBEG
"RTN","DGMSTR2",99,0)
 F  S MSTDT=$O(^DGMS(29.11,"B",MSTDT)) Q:'MSTDT!(MSTDT>DGEND)  D
"RTN","DGMSTR2",100,0)
 . S MSTIEN=0
"RTN","DGMSTR2",101,0)
 . F  S MSTIEN=$O(^DGMS(29.11,"B",MSTDT,MSTIEN)) Q:'MSTIEN  D
"RTN","DGMSTR2",102,0)
 .. S MSTDAT=$G(^DGMS(29.11,MSTIEN,0))
"RTN","DGMSTR2",103,0)
 .. S DGX=$P(MSTDAT,U,3)
"RTN","DGMSTR2",104,0)
 .. Q:'($D(DGMST(DGX)))
"RTN","DGMSTR2",105,0)
 .. S DFN=$P(MSTDAT,U,2)
"RTN","DGMSTR2",106,0)
 .. S DGX=$$GETSTAT^DGMSTAPI(DFN)
"RTN","DGMSTR2",107,0)
 .. Q:MSTIEN'=+DGX
"RTN","DGMSTR2",108,0)
 .. D DEM^VADPT
"RTN","DGMSTR2",109,0)
 .. I '(DGSEX["B") Q:'(DGSEX[$P(VADM(5),U))
"RTN","DGMSTR2",110,0)
 .. D ELIG^VADPT
"RTN","DGMSTR2",111,0)
 .. I 'DGPOS S DGX=$P(VAEL(2),U) Q:'($D(DGPOS(+DGX)))
"RTN","DGMSTR2",112,0)
 .. S LINE=$G(LINE)+1
"RTN","DGMSTR2",113,0)
 .. I DGDISP["P" D
"RTN","DGMSTR2",114,0)
 ... S @RPTARRY@($P(MSTDAT,U,3),VADM(1),LINE)=DFN_U_MSTIEN
"RTN","DGMSTR2",115,0)
 .. E  D
"RTN","DGMSTR2",116,0)
 ... S @RPTARRY@($P(MSTDAT,U,3),$S(VAEL(2)]"":VAEL(2),1:"UNKNOWN"),VADM(1),LINE)=DFN_U_MSTIEN
"RTN","DGMSTR2",117,0)
 .. D KVAR^VADPT
"RTN","DGMSTR2",118,0)
 Q
"RTN","DGMSTR2",119,0)
 ;
"RTN","DGMSTR2",120,0)
PRNNAME(DGBEG,DGEND,DGDSP,RPTARRY,DGMST) ;
"RTN","DGMSTR2",121,0)
 ; Print out report on patient name sort.  One level of sort in the ^TMP global
"RTN","DGMSTR2",122,0)
 N MSTST,DFN,MSTPOS,MSTNAME,MSTIEN,DGQUIT,DGNDX,MSTDAT
"RTN","DGMSTR2",123,0)
 ;
"RTN","DGMSTR2",124,0)
 S MSTST=""
"RTN","DGMSTR2",125,0)
 F  S MSTST=$O(DGMST(MSTST)) Q:'(MSTST]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",126,0)
 . I $O(@RPTARRY@(MSTST,""))="" D  Q
"RTN","DGMSTR2",127,0)
 .. S X=$$HEADER(MSTST,DGDSP,DGBEG,DGEND)  ;DG*5.3*264
"RTN","DGMSTR2",128,0)
 .. W !!?5,"No data for MST status "_MSTST_" found."
"RTN","DGMSTR2",129,0)
 . S DGQUIT=$$HEADER(MSTST,DGDSP,DGBEG,DGEND) Q:$G(DGQUIT)
"RTN","DGMSTR2",130,0)
 . S (DGNDX,MSTNAME)=""
"RTN","DGMSTR2",131,0)
 . F  S MSTNAME=$O(@RPTARRY@(MSTST,MSTNAME)) Q:'(MSTNAME]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",132,0)
 .. F  S DGNDX=$O(@RPTARRY@(MSTST,MSTNAME,DGNDX)) Q:'(DGNDX]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",133,0)
 ... S MSTDAT=$G(^(DGNDX))
"RTN","DGMSTR2",134,0)
 ... S DFN=$P(MSTDAT,U),MSTIEN=$P(MSTDAT,U,2)
"RTN","DGMSTR2",135,0)
 ... D PRNTLN1(DFN,MSTIEN)
"RTN","DGMSTR2",136,0)
 ... I $Y+5>$G(IOSL) S DGQUIT=$$HEADER(MSTST,DGDSP,DGBEG,DGEND) Q:$G(DGQUIT)
"RTN","DGMSTR2",137,0)
 Q
"RTN","DGMSTR2",138,0)
 ;
"RTN","DGMSTR2",139,0)
PRNPOS(DGBEG,DGEND,DGDSP,RPTARRY,DGMST) ;
"RTN","DGMSTR2",140,0)
 ;  Print out report on period of service sort, Two levels of sort.
"RTN","DGMSTR2",141,0)
 N MSTST,DFN,MSTPOS,MSTNAME,MSTIEN,DGQUIT,DGX,DGNDX
"RTN","DGMSTR2",142,0)
 ;
"RTN","DGMSTR2",143,0)
 I '$O(@RPTARRY@(""))="" D  Q
"RTN","DGMSTR2",144,0)
 . S X=$$HEADER(MSTST,DGDSP,DGBEG,DGEND)
"RTN","DGMSTR2",145,0)
 . W !!?5,"No data for these parameters found."
"RTN","DGMSTR2",146,0)
 ;
"RTN","DGMSTR2",147,0)
 S MSTST=""
"RTN","DGMSTR2",148,0)
 F  S MSTST=$O(DGMST(MSTST)) Q:'(MSTST]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",149,0)
 . I $O(@RPTARRY@(MSTST,""))="" D  Q
"RTN","DGMSTR2",150,0)
 .. S X=$$HEADER(MSTST,DGDSP,DGBEG,DGEND)
"RTN","DGMSTR2",151,0)
 .. W !!?5,"No data for MST status "_MSTST_" found."
"RTN","DGMSTR2",152,0)
 . S DGQUIT=$$HEADER(MSTST,DGDSP,DGBEG,DGEND) Q:$G(DGQUIT)
"RTN","DGMSTR2",153,0)
 . S MSTPOS=""
"RTN","DGMSTR2",154,0)
 . F  S MSTPOS=$O(@RPTARRY@(MSTST,MSTPOS)) Q:'(MSTPOS]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",155,0)
 .. S (MSTNAME,DGNDX)=""
"RTN","DGMSTR2",156,0)
 .. F  S MSTNAME=$O(@RPTARRY@(MSTST,MSTPOS,MSTNAME)) Q:'(MSTNAME]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",157,0)
 ... F  S DGNDX=$O(@RPTARRY@(MSTST,MSTPOS,MSTNAME,DGNDX)) Q:'(DGNDX]"")  D  Q:$G(DGQUIT)
"RTN","DGMSTR2",158,0)
 .... S MSTDAT=$G(^(DGNDX))
"RTN","DGMSTR2",159,0)
 .... S DFN=$P(MSTDAT,U),MSTIEN=$P(MSTDAT,U,2)
"RTN","DGMSTR2",160,0)
 .... D PRNTLN1(DFN,MSTIEN)
"RTN","DGMSTR2",161,0)
 .... I $Y+5>$G(IOSL) S DGQUIT=$$HEADER(MSTST,DGDSP,DGBEG,DGEND) Q:$G(DGQUIT)
"RTN","DGMSTR2",162,0)
 Q
"RTN","DGMSTR2",163,0)
 ;
"RTN","DGMSTR2",164,0)
PRNTLN1(DFN,MSTIEN) ;  Format and print data for patient passed in
"RTN","DGMSTR2",165,0)
 N MSTACT,DGX,VADM,VAEL,VAPA,VA
"RTN","DGMSTR2",166,0)
 D DEM^VADPT,ELIG^VADPT,ADD^VADPT,ACTION(DFN,.MSTACT)
"RTN","DGMSTR2",167,0)
 ;
"RTN","DGMSTR2",168,0)
 W !,VA("BID")
"RTN","DGMSTR2",169,0)
 W ?6,$E(VADM(1),1,25)
"RTN","DGMSTR2",170,0)
 W ?32,$E(VAPA(1),1,25)
"RTN","DGMSTR2",171,0)
 W ?58,$P(VADM(5),U)
"RTN","DGMSTR2",172,0)
 W ?61,$E($P(VAEL(1),U,2),1,15)
"RTN","DGMSTR2",173,0)
 W ?80,$E($P(VAEL(2),U,2),1,15)
"RTN","DGMSTR2",174,0)
 W ?100,$G(MSTACT(1))
"RTN","DGMSTR2",175,0)
 W !
"RTN","DGMSTR2",176,0)
 S DGX=$E(VAPA(4),1,$L(VAPA(4)))_$S(VAPA(6)]"":", ",1:"  ")_$P(VAPA(5),U,2)_" "_VAPA(6)
"RTN","DGMSTR2",177,0)
 W ?32,$S($G(VAPA(2))]"":$E(VAPA(2),1,25),1:DGX)
"RTN","DGMSTR2",178,0)
 W ?100,$G(MSTACT(2))
"RTN","DGMSTR2",179,0)
 W !
"RTN","DGMSTR2",180,0)
 W ?32,$S($G(VAPA(2))]"":DGX,1:VAPA(8))
"RTN","DGMSTR2",181,0)
 W ?100,$G(MSTACT(3))
"RTN","DGMSTR2",182,0)
 W !
"RTN","DGMSTR2",183,0)
 W ?32,$S($G(VAPA(2))]"":VAPA(8),1:"")
"RTN","DGMSTR2",184,0)
 W ?100,$G(MSTACT(4))
"RTN","DGMSTR2",185,0)
 ;
"RTN","DGMSTR2",186,0)
 I $G(MSTACT(5))]"" D
"RTN","DGMSTR2",187,0)
 . W !?100,$G(MSTACT(5))
"RTN","DGMSTR2",188,0)
 . I $G(MSTACT(6))]"" D
"RTN","DGMSTR2",189,0)
 .. W !?100,$G(MSTACT(6))
"RTN","DGMSTR2",190,0)
 E  W !
"RTN","DGMSTR2",191,0)
 ;
"RTN","DGMSTR2",192,0)
 D KVAR^VADPT
"RTN","DGMSTR2",193,0)
 Q
"RTN","DGMSTR2",194,0)
 ;
"RTN","DGMSTR2",195,0)
HEADER(MSTST,DGDISP,DGBEG,DGEND) ;  Print report header
"RTN","DGMSTR2",196,0)
 N LINE,STR,SDASH
"RTN","DGMSTR2",197,0)
 I $G(FRSTPAS),$E(IOST,1,2)="C-" D PAUSE^VALM1 Q:'Y 1
"RTN","DGMSTR2",198,0)
 I '$G(FRSTPAS) D
"RTN","DGMSTR2",199,0)
 . S FRSTPAS=1
"RTN","DGMSTR2",200,0)
 . W @IOF
"RTN","DGMSTR2",201,0)
 E  D
"RTN","DGMSTR2",202,0)
 . W @IOF
"RTN","DGMSTR2",203,0)
 ;
"RTN","DGMSTR2",204,0)
 S STR="MST Detailed Demographic Report"
"RTN","DGMSTR2",205,0)
 S $P(LINE," ",(IOM/2)-($L(STR)/2))=""
"RTN","DGMSTR2",206,0)
 W !,LINE_STR
"RTN","DGMSTR2",207,0)
 S STR="MST Status: "_$S(MSTST["Y":"Yes",MSTST["N":"No",MSTST["D":"Declined",1:"Unknown")
"RTN","DGMSTR2",208,0)
 K LINE S $P(LINE," ",(IOM/2)-($L(STR)/2))=""
"RTN","DGMSTR2",209,0)
 W !,LINE_STR
"RTN","DGMSTR2",210,0)
 S STR="Sorted by: "_$S(DGDISP["P":"Patient",1:"Period of Service\Patient")
"RTN","DGMSTR2",211,0)
 K LINE S $P(LINE," ",(IOM/2)-($L(STR)/2))=""
"RTN","DGMSTR2",212,0)
 W !,LINE_STR
"RTN","DGMSTR2",213,0)
 S STR="Date Range: "_$$FMTE^XLFDT(DGBEG,"D")_" - "_$$FMTE^XLFDT(DGEND,"D")
"RTN","DGMSTR2",214,0)
 K LINE S $P(LINE," ",(IOM/2)-($L(STR)/2))=""
"RTN","DGMSTR2",215,0)
 W !,LINE_STR
"RTN","DGMSTR2",216,0)
 S STR="Date printed: "_$$FMTE^XLFDT($$NOW^XLFDT,"D")
"RTN","DGMSTR2",217,0)
 K LINE S $P(LINE," ",(IOM/2)-($L(STR)/2))=""
"RTN","DGMSTR2",218,0)
 W !,LINE_STR
"RTN","DGMSTR2",219,0)
 W !!
"RTN","DGMSTR2",220,0)
 W !?32,"ADDRESS",?82,"PERIOD"
"RTN","DGMSTR2",221,0)
 W !?6,"PATIENT",?32,"AND",?63,"ELIGIBILITY",?82,"OF"
"RTN","DGMSTR2",222,0)
 W !,"SSN",?6,"NAME",?32,"PHONE",?57,"SEX",?63,"CODE",?82,"SERVICE",?100,"SERVICE IND."
"RTN","DGMSTR2",223,0)
 W !
"RTN","DGMSTR2",224,0)
 S $P(SDASH,"-",IOM+1)=""
"RTN","DGMSTR2",225,0)
 W SDASH,!
"RTN","DGMSTR2",226,0)
 Q 0
"RTN","DGMSTR2",227,0)
 ;
"RTN","DGMSTR2",228,0)
ACTION(DFN,MSTRSLT) ;  Check for service indicated fields in PATIENT File (#2) for
"RTN","DGMSTR2",229,0)
 ; patient passed in.  Return local array with all entries flaged as yes in the 
"RTN","DGMSTR2",230,0)
 ; respective fields
"RTN","DGMSTR2",231,0)
 ;   .32101  - Vietnam
"RTN","DGMSTR2",232,0)
 ;   .3221   - Lebanon
"RTN","DGMSTR2",233,0)
 ;   .3224   - Grenada
"RTN","DGMSTR2",234,0)
 ;   .3227   - Panama
"RTN","DGMSTR2",235,0)
 ;   .32201  - Persian Gulf
"RTN","DGMSTR2",236,0)
 ;   .322016 - Somalia
"RTN","DGMSTR2",237,0)
 ; Output
"RTN","DGMSTR2",238,0)
 ;    MSTRSLT(n)="VIETNAM"
"RTN","DGMSTR2",239,0)
 ;
"RTN","DGMSTR2",240,0)
 N MSTACTN,NDX,LINE
"RTN","DGMSTR2",241,0)
 S DFN=DFN_","
"RTN","DGMSTR2",242,0)
 D GETS^DIQ(2,DFN,".32101;.3221;.3224;.3227;.32201;.322016","E","MSTACTN")
"RTN","DGMSTR2",243,0)
 S NDX=""
"RTN","DGMSTR2",244,0)
 F  S NDX=$O(MSTACTN(2,DFN,NDX)) Q:'NDX  D
"RTN","DGMSTR2",245,0)
 . S:MSTACTN(2,DFN,NDX,"E")["YES" LINE=$G(LINE)+1,MSTRSLT(LINE)=$$SERVICE(NDX)
"RTN","DGMSTR2",246,0)
 ;
"RTN","DGMSTR2",247,0)
 Q
"RTN","DGMSTR2",248,0)
 ;
"RTN","DGMSTR2",249,0)
SERVICE(NDX) ; Convert field number to text value
"RTN","DGMSTR2",250,0)
 Q $S(NDX=.32101:"VIETNAM",NDX=.3221:"LEBANON",NDX=.3224:"GRENADA",NDX=.3227:"PANAMA",NDX=.32201:"PERSIAN GULF",NDX=.322016:"SOMALIA",1:"UNKNOWN")
"RTN","DGMSTR2",251,0)
 ;
"RTN","DGMSTR2",252,0)
 ;
"RTN","DGMSTR2",253,0)
GETMST(MST) ; Multiple MST status code seletion, loops until user quites
"RTN","DGMSTR2",254,0)
NEXT S DIR(0)="29.11,3AO"
"RTN","DGMSTR2",255,0)
 S DIR("A")="Select MST status code: "
"RTN","DGMSTR2",256,0)
 S DIR("?")="Select one of the current MST status codes: Y/N/D/U."
"RTN","DGMSTR2",257,0)
 D ^DIR K DIR
"RTN","DGMSTR2",258,0)
 Q:$D(DIRUT)
"RTN","DGMSTR2",259,0)
 S:'$D(MST(Y)) MST(Y)=""
"RTN","DGMSTR2",260,0)
 G NEXT
"RTN","DGMSTR2",261,0)
 Q
"RTN","DGPFRFA")
0^5^B16570169
"RTN","DGPFRFA",1,0)
DGPFRFA ;ALB/RBS - PRF FLAG ASSIGNMENT REPORT ; 10/28/03 12:03pm
"RTN","DGPFRFA",2,0)
 ;;5.3;Registration;**425,555**;Aug 13, 1993
"RTN","DGPFRFA",3,0)
 ;
"RTN","DGPFRFA",4,0)
 ;This routine will be used for selecting sort parameters to produce
"RTN","DGPFRFA",5,0)
 ; the FLAG ASSIGNMENT REPORT for Patient Record Flags.
"RTN","DGPFRFA",6,0)
 ;
"RTN","DGPFRFA",7,0)
 ;Selection options will provide the user with the ability to report
"RTN","DGPFRFA",8,0)
 ; by:
"RTN","DGPFRFA",9,0)
 ;  CATEGORY:
"RTN","DGPFRFA",10,0)
 ;    1  Category I (National)
"RTN","DGPFRFA",11,0)
 ;    2  Category II (Local)
"RTN","DGPFRFA",12,0)
 ;    3  BOTH
"RTN","DGPFRFA",13,0)
 ;  FLAG:
"RTN","DGPFRFA",14,0)
 ;    S  Single Flag
"RTN","DGPFRFA",15,0)
 ;    A  All Flags
"RTN","DGPFRFA",16,0)
 ;  BEGINING DATE:  FileMan date
"RTN","DGPFRFA",17,0)
 ;  ENDING DATE:    FileMan date
"RTN","DGPFRFA",18,0)
 ;
"RTN","DGPFRFA",19,0)
 ;-- no direct entry
"RTN","DGPFRFA",20,0)
 QUIT
"RTN","DGPFRFA",21,0)
 ;
"RTN","DGPFRFA",22,0)
EN ;Entry point
"RTN","DGPFRFA",23,0)
 ;-- user prompts for report selection sorts
"RTN","DGPFRFA",24,0)
 ;  Input: none
"RTN","DGPFRFA",25,0)
 ; Output: Report generated using user selected parameters
"RTN","DGPFRFA",26,0)
 ;
"RTN","DGPFRFA",27,0)
 N DGASK,DGRSLT,DGDIRA,DGDIRB,DGDIRO,DGDIRH
"RTN","DGPFRFA",28,0)
 N DGSORT,DGCAT,DGFIL,DGSEL,DGFIRST,DGBEG,DGEND
"RTN","DGPFRFA",29,0)
 N ZTSAVE,DGQ
"RTN","DGPFRFA",30,0)
 ;
"RTN","DGPFRFA",31,0)
 ;-- prompt for selection of a flag category
"RTN","DGPFRFA",32,0)
 S DGDIRA="Select Flag Category"
"RTN","DGPFRFA",33,0)
 S DGDIRB=""
"RTN","DGPFRFA",34,0)
 S DGDIRH="Enter one of the category selections to report on"
"RTN","DGPFRFA",35,0)
 S DGDIRO="S^1:Category I (National);2:Category II (Local);3:Both"
"RTN","DGPFRFA",36,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFA",37,0)
 Q:(DGASK<1)
"RTN","DGPFRFA",38,0)
 S DGCAT=DGASK,DGSORT("DGCAT")=DGASK_U_$S(DGCAT=1:"Category I (National)",DGCAT=2:"Category II (Local)",DGCAT=3:"Both",1:"")
"RTN","DGPFRFA",39,0)
 ;
"RTN","DGPFRFA",40,0)
 ;-- prompt for selection of a single flag or all flags
"RTN","DGPFRFA",41,0)
 S DGSEL=""
"RTN","DGPFRFA",42,0)
 ;list (A)ll flags if user selects Both Category's
"RTN","DGPFRFA",43,0)
 I DGCAT=3 D
"RTN","DGPFRFA",44,0)
 . S DGSORT("DGFLAG")="A"
"RTN","DGPFRFA",45,0)
 ;
"RTN","DGPFRFA",46,0)
 D:DGCAT'=3  ;only prompt if user selects a Category I or II
"RTN","DGPFRFA",47,0)
 . S DGDIRA="Select to report on a (S)ingle flag or (A)ll flags"
"RTN","DGPFRFA",48,0)
 . S DGDIRB="Single Flag"
"RTN","DGPFRFA",49,0)
 . S DGDIRO="S^S:Single Flag;A:All Flags"
"RTN","DGPFRFA",50,0)
 . S DGDIRH="Enter one of the flag selections to report on"
"RTN","DGPFRFA",51,0)
 . S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFA",52,0)
 . Q:(DGASK=-1)
"RTN","DGPFRFA",53,0)
 . S DGSEL=DGASK
"RTN","DGPFRFA",54,0)
 . S DGSORT("DGFLAG")=DGASK
"RTN","DGPFRFA",55,0)
 Q:(DGASK=-1)
"RTN","DGPFRFA",56,0)
 ;
"RTN","DGPFRFA",57,0)
 ;-- prompt for selection of a record flag name - only if (S)ingle
"RTN","DGPFRFA",58,0)
 D:DGSEL="S"
"RTN","DGPFRFA",59,0)
 . S DGQ=0
"RTN","DGPFRFA",60,0)
 . S DGDIRA="Select Record Flag Name",DGDIRB=""
"RTN","DGPFRFA",61,0)
 . S DGDIRO=$S(DGCAT=1:"P^26.15,.01:EMZ",1:"P^26.11,.01:EMZ")
"RTN","DGPFRFA",62,0)
 . F  D  Q:DGQ
"RTN","DGPFRFA",63,0)
 . . S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO)
"RTN","DGPFRFA",64,0)
 . . I DGASK=-1 S DGQ=1 Q
"RTN","DGPFRFA",65,0)
 . . ;set data string = pointer value (5;DGPF(26.11,) ^ external name
"RTN","DGPFRFA",66,0)
 . . S DGFIL=DGASK_$S(DGCAT=1:";DGPF(26.15,",1:";DGPF(26.11,")
"RTN","DGPFRFA",67,0)
 . . ;if (S)ingle flag selected, check for any flag assignments
"RTN","DGPFRFA",68,0)
 . . I '$$ASGNCNT^DGPFLF6(DGFIL) D  Q
"RTN","DGPFRFA",69,0)
 . . . W !?2,">>> No Patient Record Flag Assignments have been found.  Select another flag.",*7
"RTN","DGPFRFA",70,0)
 . . ;a good one to report on
"RTN","DGPFRFA",71,0)
 . . S DGSORT("DGFLAG")=DGFIL_U_$$EXTERNAL^DILFD(26.13,.02,"F",DGFIL)
"RTN","DGPFRFA",72,0)
 . . S DGQ=1
"RTN","DGPFRFA",73,0)
 ;
"RTN","DGPFRFA",74,0)
 Q:(DGASK=-1)
"RTN","DGPFRFA",75,0)
 ;
"RTN","DGPFRFA",76,0)
 ;-- prompt for beginning date
"RTN","DGPFRFA",77,0)
 S DGFIRST=$P(+$O(^DGPF(26.14,"D","")),".")    ;first assignment date
"RTN","DGPFRFA",78,0)
 I 'DGFIRST D  Q
"RTN","DGPFRFA",79,0)
 . W !?2,">>> No Patient Record Flag Assignments have been found.",*7
"RTN","DGPFRFA",80,0)
 . I $$ANSWER^DGPFUT("Enter RETURN to continue","","E")  ;pause
"RTN","DGPFRFA",81,0)
 ;
"RTN","DGPFRFA",82,0)
 S DGDIRA="Select Beginning Date"
"RTN","DGPFRFA",83,0)
 S DGDIRB=""
"RTN","DGPFRFA",84,0)
 S DGDIRH="Enter the earliest Assignment Date to include in the report"
"RTN","DGPFRFA",85,0)
 S DGDIRO="D^::EX"
"RTN","DGPFRFA",86,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFA",87,0)
 Q:(DGASK=-1)
"RTN","DGPFRFA",88,0)
 S (DGSORT("DGBEG"),DGBEG)=DGASK
"RTN","DGPFRFA",89,0)
 ;
"RTN","DGPFRFA",90,0)
 ;-- prompt for ending date
"RTN","DGPFRFA",91,0)
 S DGDIRA="Select Ending Date"
"RTN","DGPFRFA",92,0)
 S DGDIRB=""
"RTN","DGPFRFA",93,0)
 S DGDIRH="Enter the lastest Assignment Date to include in the report"
"RTN","DGPFRFA",94,0)
 S DGDIRO="D^::EX"
"RTN","DGPFRFA",95,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFA",96,0)
 Q:(DGASK=-1)
"RTN","DGPFRFA",97,0)
 S DGSORT("DGEND")=DGASK
"RTN","DGPFRFA",98,0)
 ;
"RTN","DGPFRFA",99,0)
 K DGCAT,DGFIL,DGSEL,DGDIRA,DGDIRB,DGDIRO,DGDIRH
"RTN","DGPFRFA",100,0)
 K DGASK,DGRSLT,DGFIRST,DGBEG
"RTN","DGPFRFA",101,0)
 ;
"RTN","DGPFRFA",102,0)
 ;-- prompt for device
"RTN","DGPFRFA",103,0)
 S ZTSAVE("DGSORT(")=""
"RTN","DGPFRFA",104,0)
 D EN^XUTMDEVQ("START^DGPFRFA1","Patient Record Flag Assignment Report",.ZTSAVE)
"RTN","DGPFRFA",105,0)
 D HOME^%ZIS
"RTN","DGPFRFA",106,0)
 Q
"RTN","DGPFRFR")
0^6^B16461500
"RTN","DGPFRFR",1,0)
DGPFRFR ;ALB/RBS - PRF ASSIGNMENTS DUE REVIEW REPORT ; 10/28/03 12:04pm
"RTN","DGPFRFR",2,0)
 ;;5.3;Registration;**425,555**;Aug 13, 1993
"RTN","DGPFRFR",3,0)
 ;
"RTN","DGPFRFR",4,0)
 ;This routine will be used for selecting sort parameters to produce
"RTN","DGPFRFR",5,0)
 ; the FLAGS DUE FOR REVIEW REPORT for Patient Record Flags.
"RTN","DGPFRFR",6,0)
 ;
"RTN","DGPFRFR",7,0)
 ;Selection options will provide the user with the ability to report
"RTN","DGPFRFR",8,0)
 ; by:
"RTN","DGPFRFR",9,0)
 ;  CATEGORY:
"RTN","DGPFRFR",10,0)
 ;    1  Category I (National)
"RTN","DGPFRFR",11,0)
 ;    2  Category II (Local)
"RTN","DGPFRFR",12,0)
 ;    3  BOTH
"RTN","DGPFRFR",13,0)
 ;  FLAG:
"RTN","DGPFRFR",14,0)
 ;    S  Single Flag
"RTN","DGPFRFR",15,0)
 ;    A  All Flags
"RTN","DGPFRFR",16,0)
 ;  BEGINING DATE:  FileMan date
"RTN","DGPFRFR",17,0)
 ;  ENDING DATE:    FileMan date
"RTN","DGPFRFR",18,0)
 ;
"RTN","DGPFRFR",19,0)
 ;-- no direct entry
"RTN","DGPFRFR",20,0)
 QUIT
"RTN","DGPFRFR",21,0)
 ;
"RTN","DGPFRFR",22,0)
EN ;Entry point
"RTN","DGPFRFR",23,0)
 ;-- user prompts for report selection sorts
"RTN","DGPFRFR",24,0)
 ;  Input: none
"RTN","DGPFRFR",25,0)
 ; Output: Report generated using user selected parameters
"RTN","DGPFRFR",26,0)
 ;
"RTN","DGPFRFR",27,0)
 N DGASK,DGRSLT,DGDIRA,DGDIRB,DGDIRO,DGDIRH
"RTN","DGPFRFR",28,0)
 N DGSORT,DGCAT,DGFIL,DGSEL,DGNOW,DGFIRST,DGBEG,DGEND
"RTN","DGPFRFR",29,0)
 N ZTSAVE,DGQ
"RTN","DGPFRFR",30,0)
 ;
"RTN","DGPFRFR",31,0)
 ;-- prompt for selection of a flag category
"RTN","DGPFRFR",32,0)
 S DGDIRA="Select Flag Category",DGDIRB=""
"RTN","DGPFRFR",33,0)
 S DGDIRH="Enter one of the category selections to report on"
"RTN","DGPFRFR",34,0)
 S DGDIRO="S^1:Category I (National);2:Category II (Local);3:Both"
"RTN","DGPFRFR",35,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFR",36,0)
 Q:(DGASK<1)
"RTN","DGPFRFR",37,0)
 S DGCAT=DGASK,DGSORT("DGCAT")=DGASK_U_$S(DGASK=1:"Category I (National)",DGASK=2:"Category II (Local)",DGASK=3:"Both",1:"")
"RTN","DGPFRFR",38,0)
 ;
"RTN","DGPFRFR",39,0)
 ;-- prompt for selection of a single flag or all flags
"RTN","DGPFRFR",40,0)
 S DGSEL=""
"RTN","DGPFRFR",41,0)
 ;default to (A)ll flags if user selects Both Category's
"RTN","DGPFRFR",42,0)
 I DGCAT=3 D
"RTN","DGPFRFR",43,0)
 . S DGSORT("DGFLAG")="A"
"RTN","DGPFRFR",44,0)
 ;
"RTN","DGPFRFR",45,0)
 D:DGCAT'=3  ;only prompt if user selects a Category I or II
"RTN","DGPFRFR",46,0)
 . S DGDIRA="Select to report on a (S)ingle flag or (A)ll flags"
"RTN","DGPFRFR",47,0)
 . S DGDIRB="Single Flag"
"RTN","DGPFRFR",48,0)
 . S DGDIRO="S^S:Single Flag;A:All Flags"
"RTN","DGPFRFR",49,0)
 . S DGDIRH="Enter one of the flag selections to report on"
"RTN","DGPFRFR",50,0)
 . S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFR",51,0)
 . Q:(DGASK=-1)
"RTN","DGPFRFR",52,0)
 . S DGSEL=DGASK
"RTN","DGPFRFR",53,0)
 . S DGSORT("DGFLAG")=DGASK
"RTN","DGPFRFR",54,0)
 Q:(DGASK=-1)
"RTN","DGPFRFR",55,0)
 ;
"RTN","DGPFRFR",56,0)
 ;-- prompt for selection of a record flag name - only if (S)ingle
"RTN","DGPFRFR",57,0)
 D:DGSEL="S"
"RTN","DGPFRFR",58,0)
 . S DGQ=0
"RTN","DGPFRFR",59,0)
 . S DGDIRA="Select Record Flag Name"
"RTN","DGPFRFR",60,0)
 . S DGDIRB=""
"RTN","DGPFRFR",61,0)
 . S DGDIRO=$S(DGCAT=1:"P^26.15,.01:EMZ",1:"P^26.11,.01:EMZ")
"RTN","DGPFRFR",62,0)
 . F  D  Q:DGQ
"RTN","DGPFRFR",63,0)
 . . S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO)
"RTN","DGPFRFR",64,0)
 . . I DGASK=-1 S DGQ=1 Q
"RTN","DGPFRFR",65,0)
 . . ;set data string = pointer value (5;DGPF(26.11,) ^ external name
"RTN","DGPFRFR",66,0)
 . . S DGFIL=DGASK_$S(DGCAT=1:";DGPF(26.15,",1:";DGPF(26.11,")
"RTN","DGPFRFR",67,0)
 . . ;if (S)ingle flag selected, check for any flag assignments
"RTN","DGPFRFR",68,0)
 . . I '$$ASGNCNT^DGPFLF6(DGFIL) D  Q
"RTN","DGPFRFR",69,0)
 . . . W !?2,">>> No Patient Record Flag Assignments have been found.  Select another flag.",*7
"RTN","DGPFRFR",70,0)
 . . ;a good one to report on
"RTN","DGPFRFR",71,0)
 . . S DGSORT("DGFLAG")=DGFIL_U_$$EXTERNAL^DILFD(26.13,.02,"F",DGFIL)
"RTN","DGPFRFR",72,0)
 . . S DGQ=1
"RTN","DGPFRFR",73,0)
 ;
"RTN","DGPFRFR",74,0)
 Q:(DGASK=-1)
"RTN","DGPFRFR",75,0)
 ;
"RTN","DGPFRFR",76,0)
 ;-- prompt for beginning date
"RTN","DGPFRFR",77,0)
 S DGNOW=$$DT^XLFDT()
"RTN","DGPFRFR",78,0)
 S DGFIRST=$P(+$O(^DGPF(26.13,"AFREV","")),".")  ;first review date
"RTN","DGPFRFR",79,0)
 I 'DGFIRST D  Q
"RTN","DGPFRFR",80,0)
 . W !?2,">>> No Patient Record Flag Assignments have been found.",*7
"RTN","DGPFRFR",81,0)
 . I $$ANSWER^DGPFUT("Enter RETURN to continue","","E")
"RTN","DGPFRFR",82,0)
 ;
"RTN","DGPFRFR",83,0)
 S DGDIRA="Select Beginning Date"
"RTN","DGPFRFR",84,0)
 S DGDIRB=""
"RTN","DGPFRFR",85,0)
 S DGDIRH="Enter the earliest Review Date to include in the report"
"RTN","DGPFRFR",86,0)
 S DGDIRO="D^::EX"
"RTN","DGPFRFR",87,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFR",88,0)
 Q:(DGASK=-1)
"RTN","DGPFRFR",89,0)
 S (DGSORT("DGBEG"),DGBEG)=DGASK
"RTN","DGPFRFR",90,0)
 ;
"RTN","DGPFRFR",91,0)
 ;-- prompt for ending date
"RTN","DGPFRFR",92,0)
 S DGDIRA="Select Ending Date"
"RTN","DGPFRFR",93,0)
 S DGDIRB=""
"RTN","DGPFRFR",94,0)
 S DGDIRH="Enter the latest Review Date to include in the report"
"RTN","DGPFRFR",95,0)
 S DGDIRO="D^::EX"
"RTN","DGPFRFR",96,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRFR",97,0)
 Q:(DGASK=-1)
"RTN","DGPFRFR",98,0)
 S DGSORT("DGEND")=DGASK
"RTN","DGPFRFR",99,0)
 S DGSORT("DGNOW")=DGNOW
"RTN","DGPFRFR",100,0)
 ;
"RTN","DGPFRFR",101,0)
 K DGCAT,DGFIL,DGSEL,DGDIRA,DGDIRB,DGDIRO
"RTN","DGPFRFR",102,0)
 K DGASK,DGRSLT,DGNOW,DGFIRST,DGBEG
"RTN","DGPFRFR",103,0)
 ;
"RTN","DGPFRFR",104,0)
 ;-- prompt for device
"RTN","DGPFRFR",105,0)
 S ZTSAVE("DGSORT(")=""
"RTN","DGPFRFR",106,0)
 D EN^XUTMDEVQ("START^DGPFRFR1","Flags Due For Review Report",.ZTSAVE)
"RTN","DGPFRFR",107,0)
 D HOME^%ZIS
"RTN","DGPFRFR",108,0)
 Q
"RTN","DGPMDD1")
0^1^B4613930
"RTN","DGPMDD1",1,0)
DGPMDD1 ;ALB/MRL - FILE 405 'SET' X-REFERENCES; 08 NOV 88 ; 11/5/03 1:24pm
"RTN","DGPMDD1",2,0)
 ;;5.3;Registration;**156,555**;Aug 13, 1993
"RTN","DGPMDD1",3,0)
 D FLDS^DGPMDD2 G Q:DGPMDDER I DGPMDD(2)']"" G 14:DGPMDDF=14,Q
"RTN","DGPMDD1",4,0)
 I "^1^2^3^22^"[("^"_+DGPMDDF_"^"),DGPMDD(3) S ^DGPM("ATT"_+DGPMDD(2),+DGPMDD(1),DA)="",^DGPM("APTT"_+DGPMDD(2),+DGPMDD(3),+DGPMDD(1),DA)="",^DGPM("AMV"_+DGPMDD(2),+DGPMDD(1),+DGPMDD(3),DA)="",^DGPM("ATID"_+DGPMDD(2),+DGPMDD(3),DGPMDDID,DA)=""
"RTN","DGPMDD1",5,0)
 I DGPMDD(2)=4!(DGPMDD(2)=5) G Q
"RTN","DGPMDD1",6,0)
 I "^1^3^22^"[("^"_+DGPMDDF_"^"),DGPMDD(3),DGPMDD(2)'=6 S ^DGPM("APID",+DGPMDD(3),DGPMDDID,DA)="",^DGPM("APRD",+DGPMDD(3),+DGPMDD(1),DA)=""
"RTN","DGPMDD1",7,0)
 I "^1^3^9^22^"[("^"_+DGPMDDF_"^"),DGPMDD(9),DGPMDD(14),DGPMDD(3) S ^DGPM("ATS",+DGPMDD(3),+DGPMDD(14),DGPMDDID,+DGPMDD(9),DA)=""
"RTN","DGPMDD1",8,0)
 I "^1^3^22^23^"[("^"_+DGPMDDF_"^"),DGPMDD(23) S ^DGPM("ADMMS",+DGPMDD(3),DGPMDDID,DGPMDD(23),DA)=""
"RTN","DGPMDD1",9,0)
14 I "^1^3^14^22^"[("^"_+DGPMDDF_"^"),DGPMDD(14),DGPMDD(2)'=6 S ^DGPM("APMV",+DGPMDD(3),+DGPMDD(14),DGPMDDID,DA)="",^DGPM("APCA",+DGPMDD(3),+DGPMDD(14),+DGPMDD(1),DA)=""
"RTN","DGPMDD1",10,0)
Q K DGPMDD,DGPMDDF,DGPMDDN,DGPMDDER,DGPMDDID Q
"RTN","DGPMDD1",11,0)
 ;
"RTN","DGPMDD1",12,0)
DES ;ATT - ^DGPM("ATT"_Transaction#,Date,DA)=""
"RTN","DGPMDD1",13,0)
 ;ATID - ^DGPM("ATID"_Transaction type,DFN,Inverse Date,DA)=""
"RTN","DGPMDD1",14,0)
 ;APID - ^DGPM("APID",Patient,Inverse Date,DA)=""
"RTN","DGPMDD1",15,0)
 ;APTT - ^DGPM("APTT"_Transaction#,Patient,Date,DA)=""
"RTN","DGPMDD1",16,0)
 ;APCA - ^DGPM("APCA",Patient,Corresponding Admission,Date,DA)=""
"RTN","DGPMDD1",17,0)
 ;APMV - ^DGPM("APMV",Patient,Corresponding Admit,Inverse Date,DA)=""
"RTN","DGPMDD1",18,0)
 ;APRD - ^DGPM("APRD",Patient,Date,DA)=""
"RTN","DGPMDD1",19,0)
 ;AMV - ^DGPM("AMV"_TT,Date,Patient,DA)=""
"RTN","DGPMDD1",20,0)
 ;ATS - ^DGPM("ATS",DFN,Corresponding Admission,Inverse Date,Treating Specialty,DA)
"RTN","DGPMDD1",21,0)
 ;ADMMS - ^DGPM("ADMMS",DFN,Inverse Date,DMMS Episode number,DA)
"RTN","DGPMDD2")
0^2^B5983685
"RTN","DGPMDD2",1,0)
DGPMDD2 ;ALB/MRL - FILE 405 'KILL' X-REFERENCES; 08 NOV 88 ; 11/5/03 1:25pm
"RTN","DGPMDD2",2,0)
 ;;5.3;Registration;**156,555**;Aug 13, 1993
"RTN","DGPMDD2",3,0)
 D FLDS I DGPMDDER G Q
"RTN","DGPMDD2",4,0)
 I "^1^2^3^22^"[("^"_+DGPMDDF_"^"),DGPMDD(3) K ^DGPM("ATT"_+DGPMDD(2),+DGPMDD(1),DA),^DGPM("APTT"_+DGPMDD(2),+DGPMDD(3),+DGPMDD(1),DA),^DGPM("AMV"_+DGPMDD(2),+DGPMDD(1),+DGPMDD(3),DA),^DGPM("ATID"_+DGPMDD(2),+DGPMDD(3),DGPMDDID,DA)
"RTN","DGPMDD2",5,0)
 I DGPMDD(2)=4!(DGPMDD(2)=5) G Q
"RTN","DGPMDD2",6,0)
 I "^1^3^22^"[("^"_+DGPMDDF_"^"),DGPMDD(3),DGPMDD(2)'=6 K ^DGPM("APID",+DGPMDD(3),DGPMDDID,DA),^DGPM("APRD",+DGPMDD(3),+DGPMDD(1),DA)
"RTN","DGPMDD2",7,0)
 I "^1^3^9^22^"[("^"_+DGPMDDF_"^"),DGPMDD(9),DGPMDD(14),DGPMDD(3) K ^DGPM("ATS",+DGPMDD(3),+DGPMDD(14),DGPMDDID,+DGPMDD(9),DA)
"RTN","DGPMDD2",8,0)
 I "^1^3^14^22^"[("^"_+DGPMDDF_"^"),DGPMDD(14),DGPMDD(2)'=6 K ^DGPM("APMV",+DGPMDD(3),+DGPMDD(14),DGPMDDID,DA),^DGPM("APCA",+DGPMDD(3),+DGPMDD(14),+DGPMDD(1),DA)
"RTN","DGPMDD2",9,0)
 I "1^3^22^23^"[("^"_+DGPMDDF_"^"),DGPMDD(23) K ^DGPM("ADMMS",DGPMDD(3),DGPMDDID,DGPMDD(23),DA)
"RTN","DGPMDD2",10,0)
Q K DGPMDD,DGPMDDF,DGPMDDN,DGPMDDER,DGPMDDID Q
"RTN","DGPMDD2",11,0)
 ;
"RTN","DGPMDD2",12,0)
FLDS ;Determine DGPMDD Variables based on DGPMDDF
"RTN","DGPMDD2",13,0)
 S DGPMDDER=0 I '$D(DGPMDDF) K X S DGPMDDER=1 Q
"RTN","DGPMDD2",14,0)
 K DGPMDD S DGPMDDN=^DGPM(DA,0) ;Zeroth Node
"RTN","DGPMDD2",15,0)
 F DGPMDD=1:1:14,22,23 S DGPMDD(DGPMDD)=$P(DGPMDDN,"^",DGPMDD)
"RTN","DGPMDD2",16,0)
 S DGPMDD(DGPMDDF)=X
"RTN","DGPMDD2",17,0)
 I $S(DGPMDD(22)=1:1,DGPMDD(22)=2:1,1:0) S DGPMDD(1)=DGPMDD(1)+(DGPMDD(22)/10000000) ;Append sequence number on dates for use in $O
"RTN","DGPMDD2",18,0)
 S DGPMDDID=9999999.9999999-DGPMDD(1) F DGPMDD=1,2,3,14 I DGPMDD(DGPMDD)="" Q:(DGPMDD<(DGPMDDF*100))  S DGPMDDER=1 Q
"RTN","DGPMDD2",19,0)
 Q
"RTN","DGPREP5")
0^3^B29207834
"RTN","DGPREP5",1,0)
DGPREP5 ;ALB/SCK - PreRegistration Audit field totals ; 10/10/03 3:16pm
"RTN","DGPREP5",2,0)
 ;;5.3;Registration;**109,555**;Aug 13, 1993
"RTN","DGPREP5",3,0)
 Q
"RTN","DGPREP5",4,0)
EN ;  Entry point for audit totals by user
"RTN","DGPREP5",5,0)
 N DGPBEG,DGPEND,VAUTD,DGPFLD1,DGPDSH,DGPABRT,DGPLN
"RTN","DGPREP5",6,0)
 K DIR,DIRUT
"RTN","DGPREP5",7,0)
 ;
"RTN","DGPREP5",8,0)
 S DIR(0)="DA^::EX"
"RTN","DGPREP5",9,0)
 S X1=$P($$NOW^XLFDT,".")
"RTN","DGPREP5",10,0)
 S DIR("?",1)="Enter the beginning or ending date in an acceptable format"
"RTN","DGPREP5",11,0)
 S DIR("?")="The ending date cannot be before the beginning date."
"RTN","DGPREP5",12,0)
 S DIR("B")=$$FMTE^XLFDT(X1,1)
"RTN","DGPREP5",13,0)
 S DIR("A")="Enter beginning date for report: "
"RTN","DGPREP5",14,0)
 D ^DIR
"RTN","DGPREP5",15,0)
 I $D(DIRUT) G EXIT
"RTN","DGPREP5",16,0)
 S DGPBEG=Y
"RTN","DGPREP5",17,0)
 S DIR("A")="Enter ending date for report: "
"RTN","DGPREP5",18,0)
 ;
"RTN","DGPREP5",19,0)
AGN D ^DIR
"RTN","DGPREP5",20,0)
 I $D(DIRUT) G EXIT
"RTN","DGPREP5",21,0)
 S DGPEND=Y
"RTN","DGPREP5",22,0)
 I DGPEND<DGPBEG D  G AGN
"RTN","DGPREP5",23,0)
 . W !,"The ending date for this report cannot be earlier then the beginning date"
"RTN","DGPREP5",24,0)
 ;
"RTN","DGPREP5",25,0)
 K DIR
"RTN","DGPREP5",26,0)
 ;
"RTN","DGPREP5",27,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","DGPREP5",28,0)
 I $D(IO("Q")) D  G EXIT
"RTN","DGPREP5",29,0)
 . S ZTRTN="RPT^DGPREP5",ZTDESC="DISPLAY AUDIT FILE TOTALS BY USER"
"RTN","DGPREP5",30,0)
 . S ZTSAVE("DGPBEG")="",ZTSAVE("DGPEND")=""
"RTN","DGPREP5",31,0)
 . S ZTSAVE("VAUTD(")="",ZTSAVE("VAUTD")=""
"RTN","DGPREP5",32,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"TASK #: ",ZTSK
"RTN","DGPREP5",33,0)
 . D HOME^%ZIS
"RTN","DGPREP5",34,0)
 . K IO("Q"),ZTSK,ZTDESC,ZTRTN,ZTSAVE
"RTN","DGPREP5",35,0)
 ;
"RTN","DGPREP5",36,0)
 D WAIT^DICD
"RTN","DGPREP5",37,0)
 ;
"RTN","DGPREP5",38,0)
RPT ; Call procedures to build the data arrays, and then call the print procedure
"RTN","DGPREP5",39,0)
 U IO
"RTN","DGPREP5",40,0)
 S $P(DGPDSH,"=",79)=""
"RTN","DGPREP5",41,0)
 S $P(DGPLN,"-",60)=""
"RTN","DGPREP5",42,0)
 ;
"RTN","DGPREP5",43,0)
 K ^TMP("DGPAUD",$J)
"RTN","DGPREP5",44,0)
 K ^TMP("DGPTOT",$J)
"RTN","DGPREP5",45,0)
 ;
"RTN","DGPREP5",46,0)
 D BLD2
"RTN","DGPREP5",47,0)
 D BLD3
"RTN","DGPREP5",48,0)
 ;
"RTN","DGPREP5",49,0)
 D PRNT(2)
"RTN","DGPREP5",50,0)
 G:$G(DGPABRT) EXIT
"RTN","DGPREP5",51,0)
 D PRNT(2.312)
"RTN","DGPREP5",52,0)
 G:$G(DGPABRT) EXIT
"RTN","DGPREP5",53,0)
 D TOT
"RTN","DGPREP5",54,0)
 ;
"RTN","DGPREP5",55,0)
EXIT ;  Clean up and exit
"RTN","DGPREP5",56,0)
 D:'$D(ZTQUEUED) ^%ZISC
"RTN","DGPREP5",57,0)
 K ^TMP("DGPAUD",$J),POP,ZTQUEUED
"RTN","DGPREP5",58,0)
 Q
"RTN","DGPREP5",59,0)
 ;
"RTN","DGPREP5",60,0)
BLD2 ;  Build array of audit data for the PATIENT File, #2
"RTN","DGPREP5",61,0)
 N DGPN1,DGPFLD,DGPDATA,DGPDUZ,DGPN2
"RTN","DGPREP5",62,0)
 ;
"RTN","DGPREP5",63,0)
 S DGPN1=0
"RTN","DGPREP5",64,0)
 F  S DGPN1=$O(^DD(2,DGPN1)) Q:'DGPN1  D
"RTN","DGPREP5",65,0)
 . I $G(^DD(2,DGPN1,"AUDIT"))="y" S DGPFLD(DGPN1)=""
"RTN","DGPREP5",66,0)
 ;
"RTN","DGPREP5",67,0)
 S DGPN1=DGPBEG-.1
"RTN","DGPREP5",68,0)
 S DGPE=DGPEND+.999999
"RTN","DGPREP5",69,0)
 F  S DGPN1=$O(^DIA(2,"C",DGPN1)) Q:'DGPN1!(DGPN1>DGPE)  D
"RTN","DGPREP5",70,0)
 . S DGPN2="" F  S DGPN2=$O(^DIA(2,"C",DGPN1,DGPN2)) Q:'DGPN2  D
"RTN","DGPREP5",71,0)
 .. S DGPDATA=$G(^DIA(2,DGPN2,0))
"RTN","DGPREP5",72,0)
 .. Q:$P(DGPDATA,U,3)=""
"RTN","DGPREP5",73,0)
 .. Q:'$D(DGPFLD(+$P($G(DGPDATA),U,3)))
"RTN","DGPREP5",74,0)
 .. S DGPDUZ=+$P($G(DGPDATA),U,4) Q:DGPDUZ'>0
"RTN","DGPREP5",75,0)
 .. Q:'($D(^XUSEC("DGPRE EDIT",DGPDUZ))!($D(^XUSEC("DGPRE SUPV",DGPDUZ))))
"RTN","DGPREP5",76,0)
 .. S ^TMP("DGPAUD",$J,2,+$P(DGPDATA,U,3),DGPDUZ)=+$G(^TMP("DGPAUD",$J,2,+$P(DGPDATA,U,3),DGPDUZ))+1
"RTN","DGPREP5",77,0)
 .. S ^TMP("DGPTOT",$J,DGPDUZ)=+$G(^TMP("DGPTOT",$J,DGPDUZ))+1
"RTN","DGPREP5",78,0)
 Q
"RTN","DGPREP5",79,0)
 ;
"RTN","DGPREP5",80,0)
BLD3 ;  Build array of audit data for file 2.312
"RTN","DGPREP5",81,0)
 N DGPN1,DGPE,DGPDATA,DGPDUZ,DGPN2
"RTN","DGPREP5",82,0)
 ;
"RTN","DGPREP5",83,0)
 S DGPN1=0
"RTN","DGPREP5",84,0)
 F  S DGPN1=$O(^DD(2.312,DGPN1)) Q:'DGPN1  D
"RTN","DGPREP5",85,0)
 . I $G(^DD(2.312,DGPN1,"AUDIT"))="y" S DGPFLD(".3121,"_DGPN1)=""
"RTN","DGPREP5",86,0)
 ;
"RTN","DGPREP5",87,0)
 S DGPN1=DGPBEG-.1
"RTN","DGPREP5",88,0)
 S DGPE=DGPEND+.999999
"RTN","DGPREP5",89,0)
 F  S DGPN1=$O(^DIA(2,"C",DGPN1)) Q:'DGPN1!(DGPN1>DGPE)  D
"RTN","DGPREP5",90,0)
 . S DGPN2="" F  S DGPN2=$O(^DIA(2,"C",DGPN1,DGPN2)) Q:'DGPN2  D
"RTN","DGPREP5",91,0)
 .. S DGPDATA=$G(^DIA(2,DGPN2,0))
"RTN","DGPREP5",92,0)
 .. Q:$P(DGPDATA,U,3)=""
"RTN","DGPREP5",93,0)
 .. Q:'$D(DGPFLD($P($G(DGPDATA),U,3)))
"RTN","DGPREP5",94,0)
 .. S DGPDUZ=+$P($G(DGPDATA),U,4) Q:DGPDUZ'>0
"RTN","DGPREP5",95,0)
 .. Q:'($D(^XUSEC("DGPRE EDIT",DGPDUZ))!($D(^XUSEC("DGPRE SUPV",DGPDUZ))))
"RTN","DGPREP5",96,0)
 .. S ^TMP("DGPAUD",$J,2.312,$P(DGPDATA,U,3),DGPDUZ)=+$G(^TMP("DGPAUD",$J,2.312,$P(DGPDATA,U,3),DGPDUZ))+1
"RTN","DGPREP5",97,0)
 .. S ^TMP("DGPTOT",$J,DGPDUZ)=+$G(^TMP("DGPTOT",$J,DGPDUZ))+1
"RTN","DGPREP5",98,0)
 ;
"RTN","DGPREP5",99,0)
 Q
"RTN","DGPREP5",100,0)
 ;
"RTN","DGPREP5",101,0)
PRNT(DGPDD) ;  Print the report
"RTN","DGPREP5",102,0)
 N DGPFLDX,DGPIENX,DGPTOT
"RTN","DGPREP5",103,0)
 ;
"RTN","DGPREP5",104,0)
 S X=$$NEWPGE Q:$G(DGPABRT)
"RTN","DGPREP5",105,0)
 D HDR(DGPDD)
"RTN","DGPREP5",106,0)
 I '$D(^TMP("DGPAUD",$J,DGPDD)) D  Q
"RTN","DGPREP5",107,0)
 . W !!?5,"No audit data for this date range"
"RTN","DGPREP5",108,0)
 ;
"RTN","DGPREP5",109,0)
 S DGPFLDX=""
"RTN","DGPREP5",110,0)
 F  S DGPFLDX=$O(^TMP("DGPAUD",$J,DGPDD,DGPFLDX)) Q:'DGPFLDX  D  Q:$G(DGPABRT)
"RTN","DGPREP5",111,0)
 . D HDR1(DGPDD,DGPFLDX)
"RTN","DGPREP5",112,0)
 . S DGPIENX="" F  S DGPIENX=$O(^TMP("DGPAUD",$J,DGPDD,DGPFLDX,DGPIENX)) Q:'DGPIENX  D  Q:$G(DGPABRT)
"RTN","DGPREP5",113,0)
 .. I $Y>(IOSL-8) D:$$NEWPGE HDR(DGPDD) Q:$G(DGPABRT)
"RTN","DGPREP5",114,0)
 .. W !?5,$P(^VA(200,DGPIENX,0),U),": ",?50,$J(^TMP("DGPAUD",$J,DGPDD,DGPFLDX,DGPIENX),6)
"RTN","DGPREP5",115,0)
 .. S DGPTOT=$G(DGPTOT)+$G(^TMP("DGPAUD",$J,DGPDD,DGPFLDX,DGPIENX))
"RTN","DGPREP5",116,0)
 . Q:$G(DGPABRT)
"RTN","DGPREP5",117,0)
 . W !!?5,$P(^DD(DGPDD,$S(DGPDD=2:DGPFLDX,1:$P(DGPFLDX,",",2)),0),U)_" (TOTAL): ",?50,$J(DGPTOT,6)
"RTN","DGPREP5",118,0)
 . S DGPTOT=0
"RTN","DGPREP5",119,0)
 . W !?5,DGPLN,!
"RTN","DGPREP5",120,0)
 Q
"RTN","DGPREP5",121,0)
 ;
"RTN","DGPREP5",122,0)
TOT ; Display totals by user
"RTN","DGPREP5",123,0)
 S X=$$NEWPGE Q:$G(DGPABRT)
"RTN","DGPREP5",124,0)
 D HDR(0)
"RTN","DGPREP5",125,0)
 W !!,?2,"User Totals"
"RTN","DGPREP5",126,0)
 W !?2,DGPDSH
"RTN","DGPREP5",127,0)
 S DGPIENX="",DGPTOT=0
"RTN","DGPREP5",128,0)
 F  S DGPIENX=$O(^TMP("DGPTOT",$J,DGPIENX)) Q:'DGPIENX  D  G:$G(DGPABRT) EXIT
"RTN","DGPREP5",129,0)
 . I $Y>(IOSL-8) D:$$NEWPGE HDR(0) Q:$G(DGPABRT)
"RTN","DGPREP5",130,0)
 . W !?5,$P(^VA(200,DGPIENX,0),U),?50,$J(+$G(^TMP("DGPTOT",$J,DGPIENX)),5)
"RTN","DGPREP5",131,0)
 . S DGPTOT=$G(DGPTOT)++$G(^TMP("DGPTOT",$J,DGPIENX))
"RTN","DGPREP5",132,0)
 ;
"RTN","DGPREP5",133,0)
 W !!?5,"Total Changes: ",?50,$J(DGPTOT,5)
"RTN","DGPREP5",134,0)
 ;
"RTN","DGPREP5",135,0)
 Q
"RTN","DGPREP5",136,0)
 ;
"RTN","DGPREP5",137,0)
HDR(DGPDD) ;  Page header
"RTN","DGPREP5",138,0)
 W @IOF
"RTN","DGPREP5",139,0)
 W !?2,"Pre-Registration Audit Totals"
"RTN","DGPREP5",140,0)
 W !?2,"For Period Covering "_$$FMTE^XLFDT(DGPBEG,"2D")_" to "_$$FMTE^XLFDT(DGPEND,"2D")
"RTN","DGPREP5",141,0)
 W !?2,DGPDSH
"RTN","DGPREP5",142,0)
 W !!,?2,$S(DGPDD=2:"Patient Demographic Data --",DGPDD=2.312:"Patient Insurance Data",1:"")
"RTN","DGPREP5",143,0)
 ;
"RTN","DGPREP5",144,0)
 Q
"RTN","DGPREP5",145,0)
 ;
"RTN","DGPREP5",146,0)
HDR1(DGPDD,DFLD) ;  Field header
"RTN","DGPREP5",147,0)
 I $Y>(IOSL-8) D:$$NEWPGE HDR(DGPDD) G:$G(DGPABRT) EXIT
"RTN","DGPREP5",148,0)
 W !!?5,"**** Field: ",$P(^DD(DGPDD,$S(DGPDD=2.312:$P(DFLD,",",2),1:DFLD),0),U)," ****",!
"RTN","DGPREP5",149,0)
 Q
"RTN","DGPREP5",150,0)
 ;
"RTN","DGPREP5",151,0)
NEWPGE() ;  Check for device and execute header if user does not quit
"RTN","DGPREP5",152,0)
 N DIR,DGOK
"RTN","DGPREP5",153,0)
 I IOST?1"C-".E D
"RTN","DGPREP5",154,0)
 . S DIR(0)="E" D ^DIR S DGPABRT='+$G(Y)
"RTN","DGPREP5",155,0)
 . I 'DGPABRT S DGOK=1
"RTN","DGPREP5",156,0)
 Q +$G(DGOK)
"RTN","DGRPE")
0^4^B42176360
"RTN","DGRPE",1,0)
DGRPE ;ALB/MRL - REGISTRATIONS EDITS ; 11/19/03 10:53am
"RTN","DGRPE",2,0)
 ;;5.3;Registration;**32,114,139,169,175,247,190,343,397,342,454,415,489,506,244,547,522,528,555**;Aug 13, 1993
"RTN","DGRPE",3,0)
 ;
"RTN","DGRPE",4,0)
 ;DGDR contains a string of edits; edit=screen*10+item #
"RTN","DGRPE",5,0)
 ;
"RTN","DGRPE",6,0)
 ;line tag screen*10+item*1000 = continuation line
"RTN","DGRPE",7,0)
 ;
"RTN","DGRPE",8,0)
 I DGRPS=8 D ^DGRPEIS,Q Q  ; family demographic edit...not conventional!!  :)
"RTN","DGRPE",9,0)
 I DGRPS=9 D EDIT9^DGRPEIS2,Q Q  ; income screening data ($$$)
"RTN","DGRPE",10,0)
 I DGRPS=5,DGDR["501," D
"RTN","DGRPE",11,0)
 .I $G(DGPRFLG) D PREG^IBCNBME(DFN) Q
"RTN","DGRPE",12,0)
 .D REG^IBCNBME(DFN)
"RTN","DGRPE",13,0)
 .Q
"RTN","DGRPE",14,0)
 ;-- Tricare screen #15
"RTN","DGRPE",15,0)
 I DGRPS=15 D EDIT^DGRP15,Q Q
"RTN","DGRPE",16,0)
 ;
"RTN","DGRPE",17,0)
 N DGPH,DGPHFLG
"RTN","DGRPE",18,0)
 K DR S (DA,Y)=DFN,DIE="^DPT(",DR="",DGDRS="DR",DGCT=0 G ^DGRPE1:DGRPS>6
"RTN","DGRPE",19,0)
 F I=1:1 S J=$P(DGDR,",",I) Q:J=""  F J1=J,J*1000,J*1000+1,J*1000+2 Q:'$T(@J1)  S DGDRD=$P($T(@J1),";;",2) D S
"RTN","DGRPE",20,0)
 D ^DIE
"RTN","DGRPE",21,0)
 ;check for Combat Vet status
"RTN","DGRPE",22,0)
 I $G(DGCVFLG)=1,($P($$CVEDT^DGCV(DFN),U,2)']"") D
"RTN","DGRPE",23,0)
 . W !!,"**NOTE-Change(s) made in this session deleted the veteran's Combat Vet status!"
"RTN","DGRPE",24,0)
 . S DIR(0)="EA" D ^DIR K DIR
"RTN","DGRPE",25,0)
 I $G(DGPHFLG)>0 D EDITPH1^DGRPLE()
"RTN","DGRPE",26,0)
Q K DA,DIE,DR,DGCT,DGCVFLG,DGDR,DGDRD,DGDRS,DGRPADI,I,J,J1
"RTN","DGRPE",27,0)
 Q
"RTN","DGRPE",28,0)
S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q
"RTN","DGRPE",29,0)
 S DGCT=DGCT+1,DGDRS="DR(1,2,"_DGCT_")",@DGDRS=DGDRD Q
"RTN","DGRPE",30,0)
 Q
"RTN","DGRPE",31,0)
101 ;;K DG20NAME;.01;.01///^S X=$$NCEDIT^DPTNAME(DFN,,.DG20NAME);K DG20NAME;.09;.03;
"RTN","DGRPE",32,0)
102 ;;1;
"RTN","DGRPE",33,0)
103 ;;.091;
"RTN","DGRPE",34,0)
104 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);
"RTN","DGRPE",35,0)
105 ;;.12105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1217;I X']"" W !?4,$C(7),"But I need a Start Date for this Temporary Address." S Y=.12105;.1218;.1211;I X']"" W !?4,$C(7),"But I need at least one line of a Temporary address." S Y=.12105;
"RTN","DGRPE",36,0)
111 ;;.14105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1417;I X']"" W !?4,$C(7),"But I need a Start Date." S Y=.14105;.1418;D DR111^DGRPE;.141;I '$P($$CAACT^DGRPCADD(DFN),U,2) W !?4,"But I need at least one active category." S Y=.14105;
"RTN","DGRPE",37,0)
111000 ;;K DR(2,2.141);.1411;I X']"" W !?4,$C(7),"I need at least one line of Address." S Y=.14105;.1412;S:X']"" Y=.1414;.1413;.1414;.1415;.1416;Q;.14111;@15;K DIE("NO^");
"RTN","DGRPE",38,0)
109 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);.02;D DR109^DGRPE;6;2;K DR(2,2.02),DR(2,2.06);.05;.08;K DIE("NO^");
"RTN","DGRPE",39,0)
105000 ;;.1212;S:X']"" Y=.1214;.1213:.1215;.12112;Q;.12111;.1219;@15;K DIE("NO^");
"RTN","DGRPE",40,0)
201 ;;.02;.05;.08;.092;.093;.2401:.2403;57.4//NOT APPLICABLE;
"RTN","DGRPE",41,0)
202 ;;1010.15//NO;S:X'="Y" Y="@22";S DIE("NO^")="";1010.152;I X']"" W !?4,*7,"But I need to know where you were treated most recently." S Y=1010.15;1010.151;1010.154;S:X']"" Y="@22";1010.153;@22;K DIE("NO^");
"RTN","DGRPE",42,0)
203 ;;D DR203^DGRPE;6ETHNICITY;2RACE;K DR(2,2.02),DR(2,2.06);
"RTN","DGRPE",43,0)
301 ;;.211;S:X']"" Y="@31";.212;.2125//NO;I X="Y" S DGADD=".21" D AD^DGRPE S Y=.21011;.213;S:X']"" Y=.216;.214;S:X']"" Y=.216;.215:.217;.2207;.219;.21011;@31;
"RTN","DGRPE",44,0)
302 ;;.2191;S:X']"" Y="@32";.2192;.21925//NO;I X="Y" S DGADD=".211" D AD^DGRPE S Y=.211011;
"RTN","DGRPE",45,0)
302000 ;;.2193;S:X']"" Y=.2196;.2194;S:X']"" Y=.2196;.2195:.2197;.2203;.2199;.211011;@32;
"RTN","DGRPE",46,0)
303 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@33";.3305//NO;I X="Y" S Y="@34",DGX1=1;@33;S:$D(^DPT(DFN,.22)) $P(^(.22),U,1)=$P(^(.22),U,7);.331;S:X']"" DGX1=2,Y="@34";.332;@34;
"RTN","DGRPE",47,0)
303000 ;;S:$G(DGX1) Y="@341";.333;S:X']"" Y=.336;.334;S:X']"" Y=.336;.335:.337;.2201;.339;.33011;S DGX1=2;@341;
"RTN","DGRPE",48,0)
303001 ;;S:$G(DGX1)=2 Y="@35";S DGX2=$G(^DPT(DA,.21));.331///^S X=$P(DGX2,U);.332///^S X=$P(DGX2,U,2);.333////^S X=$P(DGX2,U,3);.334///^S X=$P(DGX2,U,4);@35;
"RTN","DGRPE",49,0)
303002 ;;S:$G(DGX1)=2 Y="@351";.335///^S X=$P(DGX2,U,5);.336///^S X=$P(DGX2,U,6);.337///^S X=$P(DGX2,U,7);.338///^S X=$P(DGX2,U,8);.339///^S X=$P(DGX2,U,9);.33011///^S X=$P(DGX2,U,11);@351;K DGX1,DGX2;
"RTN","DGRPE",50,0)
304 ;;.3311;S:X']"" Y="@36";.3312;.3313;S:X']"" Y=.3316;.3314;S:X']"" Y=.3316;.3315:.3317;.2204;.3319;.331011;@36;        
"RTN","DGRPE",51,0)
305 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@37";.3405//NO;I X="Y" S DGX1=1,Y="@371";@37;S:$D(^DPT(DFN,.22)) $P(^(.22),U,2)=$P(^(.22),U,7);.341;S:X']"" DGX1=2,Y="@371";.342;@371;
"RTN","DGRPE",52,0)
305000 ;;S:$G(DGX1) Y="@38";.343;S:X']"" Y=.346;.344;S:X']"" Y=.346;.345:.347;.2202;.349;.34011;S DGX1=2;@38;
"RTN","DGRPE",53,0)
305001 ;;S:$G(DGX1)=2 Y="@381";S DGX2=$G(^DPT(DA,.21));.341///^S X=$P(DGX2,U);.342///^S X=$P(DGX2,U,2);.343///^S X=$P(DGX2,U,3);.344///^S X=$P(DGX2,U,4);@381
"RTN","DGRPE",54,0)
305002 ;;S:$G(DGX1)=2 Y="@39";.345///^S X=$P(DGX2,U,5);.346///^S X=$P(DGX2,U,6);.347///^S X=$P(DGX2,U,7);.348///^S X=$P(DGX2,U,8);.349///^S X=$P(DGX2,U,9);.34011///^S X=$P(DGX2,U,11);@39;K DGX1,DGX2;
"RTN","DGRPE",55,0)
401 ;;.07;.31115;I $S(X']"":1,X=3:1,X=9:1,1:0) S Y="@41";.3111;S:X']"" Y="@41";.3113;S:X']"" Y=.3116;.3114;S:X']"" Y=.3116;.3115:.3117;.2205;.3119;@41;
"RTN","DGRPE",56,0)
402 ;;.2514;.2515;I $S(X']"":1,X=3:1,X=9:1,1:0) S Y="@42";.251;S:X']"" Y="@42";.252;S:X']"" Y=.255;.253;S:X']"" Y=.255;.254:.256;.2206;.258;@42;
"RTN","DGRPE",57,0)
501 ;;
"RTN","DGRPE",58,0)
502 ;;.381;.382///NOW;
"RTN","DGRPE",59,0)
503 ;;.383;
"RTN","DGRPE",60,0)
601 ;;.325;S:X']"" Y="@61";.328;.326;.327;.324;.3285//NO;S:X'="Y" Y="@61";.3291;S:X']"" Y="@61";.3294;.3292;.3293;.329;.32945//NO;S:X'="Y" Y="@61";.3296;S:X']"" Y="@61";.3299;.3297;.3298;.3295;@61;
"RTN","DGRPE",61,0)
602 ;;.525//NO;S:X'="Y" Y="@62";.526:.528;@62;
"RTN","DGRPE",62,0)
603 ;;.5291//NO;S:X'="Y" Y="@63";.5292:.5294;@63;
"RTN","DGRPE",63,0)
604 ;;.32101//NO;S:X'="Y" Y="@64";.32104;.32105;@64;
"RTN","DGRPE",64,0)
605 ;;.32102//NO;S:X'="Y" Y="@65";.32107;.32109;.3211;.3213;@65;
"RTN","DGRPE",65,0)
606 ;;.32103//NO;S:X'="Y" Y="@66";.3212;.32111;@66;
"RTN","DGRPE",66,0)
607 ;;.3221//NO;S:X'="Y" Y="@67";.3222;Q;.3223;@67;
"RTN","DGRPE",67,0)
608 ;;.3224//NO;S:X'="Y" Y="@68";.3225;Q;.3226;@68;
"RTN","DGRPE",68,0)
609 ;;.3227//NO;S:X'="Y" Y="@69";.3228;Q;.3229;@69;
"RTN","DGRPE",69,0)
610 ;;.32201//NO;S:X'="Y" Y="@610";.322011;Q;.322012;@610;
"RTN","DGRPE",70,0)
611 ;;.322016//NO;S:X'="Y" Y="@611";.322017;Q;.322018;@611;
"RTN","DGRPE",71,0)
612 ;;.322013//NO;S:X'="Y" Y="@612";.322014;Q;.322015;@612;
"RTN","DGRPE",72,0)
613 ;;.362;
"RTN","DGRPE",73,0)
614 ;;.368//NO;.369//NO;I $S('$D(^DPT(DA,.36)):1,$P(^(.36),U,8)="Y"!($P(^(.36),U,9)="Y"):0,1:1) S Y="@614";.37;@614;
"RTN","DGRPE",74,0)
615 ;;.322019//NO;S:X'="Y" Y="@615";.32202;Q;.322021;@615;
"RTN","DGRPE",75,0)
616 ;;S DGPHFLG=0;.531;S:X'="Y" DGX=X,Y="@616";.532///^S X="PENDING";S Y="@6161";@616;S:DGX'="N" Y="@6162";.533///^S X="VAMC";@6161;S DGPHFLG=1;.535///^S X=$$DIV^DGRPLE();@6162;
"RTN","DGRPE",76,0)
617 ;;D REG^DGNTQ(DFN);
"RTN","DGRPE",77,0)
AD N DGZ4,DGPC
"RTN","DGRPE",78,0)
 S X=$S($D(^DPT(DA,.11)):^(.11),1:""),DGZ4=$P(X,U,12),DGPHONE=$S($D(^(.13)):$P(^(.13),U,1),1:""),Y=$S($D(^(DGADD)):^(DGADD),1:""),^(DGADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_DGPHONE_U_$P(Y,U,10)
"RTN","DGRPE",79,0)
 I DGZ4 S DGPC=$S((DGADD=.33):1,(DGADD=.34):2,(DGADD=.211):3,(DGADD=.331):4,(DGADD=.311):5,(DGADD=.25):6,(DGADD=.21):7,1:0) S:DGPC $P(^DPT(DFN,.22),U,DGPC)=DGZ4
"RTN","DGRPE",80,0)
 K DGADD,DGPHONE Q
"RTN","DGRPE",81,0)
DR109 ;Drop through (use same logic as DR203)
"RTN","DGRPE",82,0)
DR203 S DR(2,2.02)=".01RACE;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.02,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2031"";.02;@2031;"
"RTN","DGRPE",83,0)
 S DR(2,2.06)=".01ETHNICITY;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.06,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2032"";.02;@2032;"
"RTN","DGRPE",84,0)
 Q
"RTN","DGRPE",85,0)
DR111 ;Set DR string for Confidential Address categories
"RTN","DGRPE",86,0)
 S DR(2,2.141)=".01;1//YES;"
"RTN","DGRPE",87,0)
 Q
"VER")
8.0^22
**END**
**END**
