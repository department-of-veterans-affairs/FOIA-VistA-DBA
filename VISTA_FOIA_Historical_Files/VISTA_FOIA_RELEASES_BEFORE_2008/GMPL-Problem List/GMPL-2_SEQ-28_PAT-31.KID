Released GMPL*2*31 SEQ #28
Extracted from mail message
**KIDS**:GMPL*2.0*31^

**INSTALL NAME**
GMPL*2.0*31
"BLD",5975,0)
GMPL*2.0*31^PROBLEM LIST^0^3050323^y
"BLD",5975,1,0)
^^7^7^3050124^
"BLD",5975,1,1,0)
This patch will correct the problem of invalid characters (~) appearing 
"BLD",5975,1,2,0)
in the DIAGNOSIS (pointer to the ICD DIAGNOSIS file #80) in the PROBLEM 
"BLD",5975,1,3,0)
FILE (9000011). This modification will also add a check for the ICD code 
"BLD",5975,1,4,0)
not being found. (-1 being returned instead of pointer from ICD #80 file 
"BLD",5975,1,5,0)
search)
"BLD",5975,1,6,0)
 
"BLD",5975,1,7,0)
It will also add audit trail processing for changes to Problem comments.
"BLD",5975,4,0)
^9.64PA^^
"BLD",5975,"INID")
^n
"BLD",5975,"INIT")
EN^GMPL31P
"BLD",5975,"KRN",0)
^9.67PA^8989.52^19
"BLD",5975,"KRN",.4,0)
.4
"BLD",5975,"KRN",.401,0)
.401
"BLD",5975,"KRN",.402,0)
.402
"BLD",5975,"KRN",.403,0)
.403
"BLD",5975,"KRN",.5,0)
.5
"BLD",5975,"KRN",.84,0)
.84
"BLD",5975,"KRN",3.6,0)
3.6
"BLD",5975,"KRN",3.8,0)
3.8
"BLD",5975,"KRN",9.2,0)
9.2
"BLD",5975,"KRN",9.8,0)
9.8
"BLD",5975,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5975,"KRN",9.8,"NM",1,0)
GMPLSAVE^^0^B27626278
"BLD",5975,"KRN",9.8,"NM",2,0)
GMPLHIST^^0^B12712340
"BLD",5975,"KRN",9.8,"NM","B","GMPLHIST",2)

"BLD",5975,"KRN",9.8,"NM","B","GMPLSAVE",1)

"BLD",5975,"KRN",19,0)
19
"BLD",5975,"KRN",19,"NM",0)
^9.68A^^
"BLD",5975,"KRN",19.1,0)
19.1
"BLD",5975,"KRN",101,0)
101
"BLD",5975,"KRN",409.61,0)
409.61
"BLD",5975,"KRN",771,0)
771
"BLD",5975,"KRN",870,0)
870
"BLD",5975,"KRN",8989.51,0)
8989.51
"BLD",5975,"KRN",8989.52,0)
8989.52
"BLD",5975,"KRN",8994,0)
8994
"BLD",5975,"KRN","B",.4,.4)

"BLD",5975,"KRN","B",.401,.401)

"BLD",5975,"KRN","B",.402,.402)

"BLD",5975,"KRN","B",.403,.403)

"BLD",5975,"KRN","B",.5,.5)

"BLD",5975,"KRN","B",.84,.84)

"BLD",5975,"KRN","B",3.6,3.6)

"BLD",5975,"KRN","B",3.8,3.8)

"BLD",5975,"KRN","B",9.2,9.2)

"BLD",5975,"KRN","B",9.8,9.8)

"BLD",5975,"KRN","B",19,19)

"BLD",5975,"KRN","B",19.1,19.1)

"BLD",5975,"KRN","B",101,101)

"BLD",5975,"KRN","B",409.61,409.61)

"BLD",5975,"KRN","B",771,771)

"BLD",5975,"KRN","B",870,870)

"BLD",5975,"KRN","B",8989.51,8989.51)

"BLD",5975,"KRN","B",8989.52,8989.52)

"BLD",5975,"KRN","B",8994,8994)

"BLD",5975,"QUES",0)
^9.62^^
"BLD",5975,"REQB",0)
^9.611^1^1
"BLD",5975,"REQB",1,0)
GMPL*2.0*26^2
"BLD",5975,"REQB","B","GMPL*2.0*26",1)

"INIT")
EN^GMPL31P
"MBREQ")
0
"PKG",452,-1)
1^1
"PKG",452,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",452,22,0)
^9.49I^1^1
"PKG",452,22,1,0)
2.0^2940825^2961022
"PKG",452,22,1,"PAH",1,0)
31^3050323
"PKG",452,22,1,"PAH",1,1,0)
^^7^7^3050323
"PKG",452,22,1,"PAH",1,1,1,0)
This patch will correct the problem of invalid characters (~) appearing 
"PKG",452,22,1,"PAH",1,1,2,0)
in the DIAGNOSIS (pointer to the ICD DIAGNOSIS file #80) in the PROBLEM 
"PKG",452,22,1,"PAH",1,1,3,0)
FILE (9000011). This modification will also add a check for the ICD code 
"PKG",452,22,1,"PAH",1,1,4,0)
not being found. (-1 being returned instead of pointer from ICD #80 file 
"PKG",452,22,1,"PAH",1,1,5,0)
search)
"PKG",452,22,1,"PAH",1,1,6,0)
 
"PKG",452,22,1,"PAH",1,1,7,0)
It will also add audit trail processing for changes to Problem comments.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMPL31P")
0^^B20422992
"RTN","GMPL31P",1,0)
GMPL31P ;SLC/JEH -- Post Install Routine ;3/1/05  11:00
"RTN","GMPL31P",2,0)
 ;;2.0;Problem List;**31**;Aug 25, 1994
"RTN","GMPL31P",3,0)
 ;
"RTN","GMPL31P",4,0)
 ; This routine can be removed after installing patch 
"RTN","GMPL31P",5,0)
 ; GMPL*2*31 or kept and used as IRM tool
"RTN","GMPL31P",6,0)
 Q
"RTN","GMPL31P",7,0)
EN ;ENTRY POINT
"RTN","GMPL31P",8,0)
 ;
"RTN","GMPL31P",9,0)
 N IEN,TOTALWK,ADJUSTED
"RTN","GMPL31P",10,0)
 S IEN=0
"RTN","GMPL31P",11,0)
 S TOTALWK=0
"RTN","GMPL31P",12,0)
 S ADJUSTED=0
"RTN","GMPL31P",13,0)
 W !,"THE FOLLOWING PROBLEM LIST ENTRIES CONTAINED BAD ICD9 POINTERS"
"RTN","GMPL31P",14,0)
 W !,"AND HAVE BEEN MODIFIED WITH A CORRECTED POINTER",!
"RTN","GMPL31P",15,0)
 W !,"PROBLEM IEN     BAD POINTER        CORRECTED POINTER"
"RTN","GMPL31P",16,0)
 W !,"___________     ___________         _______________"
"RTN","GMPL31P",17,0)
 F  S IEN=$O(^AUPNPROB(IEN)) Q:IEN=""  D
"RTN","GMPL31P",18,0)
 .I $P($G(^AUPNPROB(IEN,0)),"^")["-1" D
"RTN","GMPL31P",19,0)
 ..W !,IEN,?16,$P(^AUPNPROB(IEN,0),"^")
"RTN","GMPL31P",20,0)
 ..S $P(^AUPNPROB(IEN,0),"^",1)=$P($$NOS^GMPLX,"^",1)
"RTN","GMPL31P",21,0)
 ..W ?36,$P(^AUPNPROB(IEN,0),"^",1)
"RTN","GMPL31P",22,0)
 ..S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",23,0)
 ..Q
"RTN","GMPL31P",24,0)
 .I $P($G(^AUPNPROB(IEN,0)),"^")["~" D
"RTN","GMPL31P",25,0)
 ..W !,IEN,?16,$P(^AUPNPROB(IEN,0),"^")
"RTN","GMPL31P",26,0)
 ..S $P(^AUPNPROB(IEN,0),"^",1)=+$P(^AUPNPROB(IEN,0),"^",1)
"RTN","GMPL31P",27,0)
 ..W ?36,$P(^AUPNPROB(IEN,0),"^",1)
"RTN","GMPL31P",28,0)
 ..S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",29,0)
 .S TOTALWK=TOTALWK+1
"RTN","GMPL31P",30,0)
 W !!,"TOTAL ITEMS WORKED = "_TOTALWK
"RTN","GMPL31P",31,0)
 W !,"TOTAL ITEMS ADJUSTED = "_ADJUSTED
"RTN","GMPL31P",32,0)
 W !!
"RTN","GMPL31P",33,0)
 D AUDTCLN
"RTN","GMPL31P",34,0)
 Q
"RTN","GMPL31P",35,0)
 ;
"RTN","GMPL31P",36,0)
AUDTCLN ;
"RTN","GMPL31P",37,0)
 N IEN,TOTALWK,ADJUSTED,HIT
"RTN","GMPL31P",38,0)
 S IEN=0
"RTN","GMPL31P",39,0)
 S TOTALWK=0
"RTN","GMPL31P",40,0)
 S ADJUSTED=0
"RTN","GMPL31P",41,0)
 W !,"THE FOLLOWING PROBLEM LIST AUDIT ENTRIES CONTAINED BAD ICD9 POINTERS"
"RTN","GMPL31P",42,0)
 W !,"AND HAVE BEEN MODIFIED WITH A CORRECTED POINTER",!
"RTN","GMPL31P",43,0)
 W !,"PROBLEM IEN     BAD POINTER        CORRECTED POINTER"
"RTN","GMPL31P",44,0)
 W !,"___________     ___________         _______________"
"RTN","GMPL31P",45,0)
 F  S IEN=$O(^GMPL(125.8,IEN)) Q:IEN=""  D
"RTN","GMPL31P",46,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",2)'=.01 Q
"RTN","GMPL31P",47,0)
 .S HIT=0
"RTN","GMPL31P",48,0)
 .; look at the 5th piece
"RTN","GMPL31P",49,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",5)["-1" D
"RTN","GMPL31P",50,0)
 ..W !,IEN,?16,$P(^GMPL(125.8,IEN,0),"^",5)
"RTN","GMPL31P",51,0)
 ..S $P(^GMPL(125.8,IEN,0),"^",5)=$P($$NOS^GMPLX,"^",1)
"RTN","GMPL31P",52,0)
 ..W ?36,$P(^GMPL(125.8,IEN,0),"^",5)
"RTN","GMPL31P",53,0)
 ..S:HIT=0 ADJUSTED=ADJUSTED+1,HIT=1
"RTN","GMPL31P",54,0)
 ..;
"RTN","GMPL31P",55,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",5)["~" D
"RTN","GMPL31P",56,0)
 ..W !,IEN,?16,$P(^GMPL(125.8,IEN,0),"^",5)
"RTN","GMPL31P",57,0)
 ..S $P(^GMPL(125.8,IEN,0),"^",5)=+$P(^GMPL(125.8,IEN,0),"^",5)
"RTN","GMPL31P",58,0)
 ..W ?36,$P(^GMPL(125.8,IEN,0),"^",5)
"RTN","GMPL31P",59,0)
 ..S:HIT=0 ADJUSTED=ADJUSTED+1,HIT=1
"RTN","GMPL31P",60,0)
 ..;
"RTN","GMPL31P",61,0)
 .; look at the 6th piece
"RTN","GMPL31P",62,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",6)["-1" D
"RTN","GMPL31P",63,0)
 ..W !,IEN,?16,$P(^GMPL(125.8,IEN,0),"^",6)
"RTN","GMPL31P",64,0)
 ..S $P(^GMPL(125.8,IEN,0),"^",6)=$P($$NOS^GMPLX,"^",1)
"RTN","GMPL31P",65,0)
 ..W ?36,$P(^GMPL(125.8,IEN,0),"^",6)
"RTN","GMPL31P",66,0)
 ..S:HIT=0 ADJUSTED=ADJUSTED+1,HIT=1
"RTN","GMPL31P",67,0)
 ..;
"RTN","GMPL31P",68,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",6)["~" D
"RTN","GMPL31P",69,0)
 ..W !,IEN,?16,$P(^GMPL(125.8,IEN,0),"^",6)
"RTN","GMPL31P",70,0)
 ..S $P(^GMPL(125.8,IEN,0),"^",6)=+$P(^GMPL(125.8,IEN,0),"^",6)
"RTN","GMPL31P",71,0)
 ..W ?36,$P(^GMPL(125.8,IEN,0),"^",6)
"RTN","GMPL31P",72,0)
 ..S:HIT=0 ADJUSTED=ADJUSTED+1,HIT=1
"RTN","GMPL31P",73,0)
 .S TOTALWK=TOTALWK+1
"RTN","GMPL31P",74,0)
 W !!,"TOTAL AUDIT ITEMS WORKED = "_TOTALWK
"RTN","GMPL31P",75,0)
 W !,"TOTAL AUDIT ITEMS ADJUSTED = "_ADJUSTED
"RTN","GMPL31P",76,0)
 W !,"AN ITEM IEN MAY APPEAR UP TO 2 TIMES ONE FOR EACH BAD PIECE"
"RTN","GMPL31P",77,0)
 W !,"AS THE FIFTH AND SIXTH PIECES ARE CHECKED"
"RTN","GMPL31P",78,0)
 Q
"RTN","GMPL31P",79,0)
 ;
"RTN","GMPL31P",80,0)
 ;
"RTN","GMPL31P",81,0)
FIND ;
"RTN","GMPL31P",82,0)
 ;find and display bad ICD9 pointers in Problem List ONLY
"RTN","GMPL31P",83,0)
 N IEN,TOTALWK,ADJUSTED
"RTN","GMPL31P",84,0)
 S IEN=0
"RTN","GMPL31P",85,0)
 S TOTALWK=0
"RTN","GMPL31P",86,0)
 S ADJUSTED=0
"RTN","GMPL31P",87,0)
 F  S IEN=$O(^AUPNPROB(IEN)) Q:IEN=""  D
"RTN","GMPL31P",88,0)
 .S TOTALWK=TOTALWK+1
"RTN","GMPL31P",89,0)
 .I $P($G(^AUPNPROB(IEN,0)),"^")["-1" W !,IEN,?10,$P(^AUPNPROB(IEN,0),"^") S ADJUSTED=ADJUSTED+1 Q
"RTN","GMPL31P",90,0)
 .I $P($G(^AUPNPROB(IEN,0)),"^")["~" W !,IEN,?10,$P(^AUPNPROB(IEN,0),"^")  S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",91,0)
 W !,"TOTAL ITEMS LOOKED AT = "_TOTALWK
"RTN","GMPL31P",92,0)
 W !,"TOTAL BAD POINTERS FOUND = "_ADJUSTED
"RTN","GMPL31P",93,0)
 Q
"RTN","GMPL31P",94,0)
 ;
"RTN","GMPL31P",95,0)
FDAUDIT ;
"RTN","GMPL31P",96,0)
 ;finnd and display bad ICD9 pointer in the Audit file
"RTN","GMPL31P",97,0)
 N IEN,TOTALWK,ADJUSTED
"RTN","GMPL31P",98,0)
 S IEN=0
"RTN","GMPL31P",99,0)
 S TOTALWK=0
"RTN","GMPL31P",100,0)
 S ADJUSTED=0
"RTN","GMPL31P",101,0)
 F  S IEN=$O(^GMPL(125.8,IEN)) Q:IEN=""  D
"RTN","GMPL31P",102,0)
 .S TOTALWK=TOTALWK+1
"RTN","GMPL31P",103,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^")["-1" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^") S ADJUSTED=ADJUSTED+1 Q
"RTN","GMPL31P",104,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^")["~" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^")  S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",105,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",5)["-1" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^",5) S ADJUSTED=ADJUSTED+1 Q
"RTN","GMPL31P",106,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",5)["~" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^",5)  S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",107,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",6)["-1" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^",6) S ADJUSTED=ADJUSTED+1 Q
"RTN","GMPL31P",108,0)
 .I $P($G(^GMPL(125.8,IEN,0)),"^",6)["~" W !,IEN,?10,$P(^GMPL(125.8,IEN,0),"^",6)  S ADJUSTED=ADJUSTED+1
"RTN","GMPL31P",109,0)
 W !,"TOTAL ITEMS LOOKED AT = "_TOTALWK
"RTN","GMPL31P",110,0)
 W !,"TOTAL BAD POINTERS FOUND = "_ADJUSTED
"RTN","GMPL31P",111,0)
 Q
"RTN","GMPLHIST")
0^2^B12712340
"RTN","GMPLHIST",1,0)
GMPLHIST ; SLC/MKB/KER -- Problem List Historical data ; 04/15/2002
"RTN","GMPLHIST",2,0)
 ;;2.0;Problem List;**7,26,31**;Aug 25, 1994
"RTN","GMPLHIST",3,0)
 ;
"RTN","GMPLHIST",4,0)
 ; External References
"RTN","GMPLHIST",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHIST",6,0)
 ;            
"RTN","GMPLHIST",7,0)
DT ; Add historical data (audit trail) to DT list
"RTN","GMPLHIST",8,0)
 ;   Called from ^GMPLDISP, requires AIFN and adds to GMPDT()
"RTN","GMPLHIST",9,0)
 N NODE,DATE,FLD,PROV,OLD,NEW,ROOT,CHNGE,REASON
"RTN","GMPLHIST",10,0)
 S NODE=$G(^GMPL(125.8,AIFN,0)) Q:NODE=""
"RTN","GMPLHIST",11,0)
 S DATE=$$EXTDT^GMPLX($P(NODE,U,3)),FLD=+$P(NODE,U,2),PROV=+$P(NODE,U,8)
"RTN","GMPLHIST",12,0)
 S:'PROV PROV=$P(NODE,U,4)
"RTN","GMPLHIST",13,0)
 S FLD=FLD_U_$$FLDNAME(+FLD),PROV=$P($G(^VA(200,PROV,0)),U)
"RTN","GMPLHIST",14,0)
 S OLD=$P(NODE,U,5),NEW=$P(NODE,U,6),LCNT=LCNT+1
"RTN","GMPLHIST",15,0)
 I +FLD=1101 D  Q
"RTN","GMPLHIST",16,0)
 . S REASON=" removed by "
"RTN","GMPLHIST",17,0)
 . S:OLD="C" REASON=" changed by "
"RTN","GMPLHIST",18,0)
 . S NODE=$G(^GMPL(125.8,AIFN,1))
"RTN","GMPLHIST",19,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": NOTE "_$$EXTDT^GMPLX($P(NODE,U,5))_REASON_PROV_":"
"RTN","GMPLHIST",20,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)="            "_$P(NODE,U,3)
"RTN","GMPLHIST",21,0)
 I +FLD=1.02 D  Q
"RTN","GMPLHIST",22,0)
 . S CHNGE=$S(NEW="H":"removed",OLD="T":"verified",1:"placed back on list")
"RTN","GMPLHIST",23,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": PROBLEM "_CHNGE_" by "_PROV
"RTN","GMPLHIST",24,0)
 S GMPDT(LCNT,0)=$J(DATE,10)_": "_$P(FLD,U,2)_" changed by "_PROV,LCNT=LCNT+1
"RTN","GMPLHIST",25,0)
 I +FLD=.12 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACTIVE",OLD="I":"INACTIVE",1:"UNKNOWN")_" to "_$S(NEW="A":"ACTIVE",NEW="I":"INACTIVE",1:"UNKNOWN") Q
"RTN","GMPLHIST",26,0)
 I (+FLD=.13)!(+FLD=1.07) S GMPDT(LCNT,0)=$J("from ",17)_$$EXTDT^GMPLX(OLD)_" to "_$$EXTDT^GMPLX(NEW) Q
"RTN","GMPLHIST",27,0)
 I +FLD=1.14 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACUTE",OLD="C":"CHRONIC",1:"UNSPECIFIED")_" to "_$S(NEW="A":"ACUTE",NEW="C":"CHRONIC",1:"UNSPECIFIED") Q
"RTN","GMPLHIST",28,0)
 I +FLD>1.09 S GMPDT(LCNT,0)=$J("from ",17)_$S(+OLD:"YES",OLD=0:"NO",1:"UNKNOWN")_" to "_$S(+NEW:"YES",NEW=0:"NO",1:"UNKNOWN") Q
"RTN","GMPLHIST",29,0)
 I "^.01^.05^1.01^1.04^1.05^1.06^1.08^"[(U_+FLD_U) D
"RTN","GMPLHIST",30,0)
 . S ROOT=$S(+FLD=.01:"ICD9(",+FLD=.05:"AUTNPOV(",+FLD=1.01:"LEX(757.01,",(+FLD=1.04)!(+FLD=1.05):"VA(200,",+FLD=1.06:"DIC(49,",+FLD=1.08:"SC(",1:"") Q:ROOT=""
"RTN","GMPLHIST",31,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD:$P(@(U_ROOT_OLD_",0)"),U),1:"UNSPECIFIED")
"RTN","GMPLHIST",32,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)=$J("to ",17)_$S(NEW:$P(@(U_ROOT_NEW_",0)"),U),1:"UNSPECIFIED")
"RTN","GMPLHIST",33,0)
 Q
"RTN","GMPLHIST",34,0)
 ;            
"RTN","GMPLHIST",35,0)
FLDNAME(NUM) ; Returns Field Name for Display
"RTN","GMPLHIST",36,0)
 N NAME,NM1,NM2,I,J S J=0,NAME="" D NUM(.NM1),ALP(.NM2) S:+($G(NM1(+NUM)))=+NUM J=+NUM
"RTN","GMPLHIST",37,0)
 S:$L($G(NM2(+J))) NAME=$G(NM2(+J))
"RTN","GMPLHIST",38,0)
 Q NAME
"RTN","GMPLHIST",39,0)
ALP(X) ; Alpha Field Names
"RTN","GMPLHIST",40,0)
 S X(.01)="DIAGNOSIS",X(.02)="PATIENT NAME",X(.03)="DATE LAST MODIFIED",X(.04)="CLASS",X(.05)="PROVIDER NARRATIVE"
"RTN","GMPLHIST",41,0)
 S X(.06)="FACILITY",X(.07)="NUMBER",X(.08)="DATE ENTERED",X(.12)="STATUS",X(.13)="DATE OF ONSET",X(1.01)="PROBLEM",X(1.02)="CONDITION"
"RTN","GMPLHIST",42,0)
 S X(1.03)="ENTERED BY",X(1.04)="RECORDING PROVIDER",X(1.05)="RESPONSIBLE PROVIDER",X(1.06)="SERVICE",X(1.07)="DATE RESOLVED"
"RTN","GMPLHIST",43,0)
 S X(1.08)="CLINIC",X(1.09)="DATE RECORDED",X(1.1)="SERVICE CONNECTED",X(1.11)="AGENT ORANGE EXP",X(1.12)="RADIATION EXP",X(1.13)="ENV CONTAMINANTS EXP"
"RTN","GMPLHIST",44,0)
 S X(1.14)="PRIORITY",X(1.15)="HEAD/NECK CANCER",X(1.16)="MIL SEXUAL TRAUMA",X(1101)="NOTE"
"RTN","GMPLHIST",45,0)
 Q
"RTN","GMPLHIST",46,0)
NUM(X) ; Numeric Field Designations
"RTN","GMPLHIST",47,0)
 N FN F FN=.01:.01:.08 S X(+FN)=+FN
"RTN","GMPLHIST",48,0)
 F FN=.12:.01:.13 S X(+FN)=+FN
"RTN","GMPLHIST",49,0)
 F FN=1.01:.01:1.16 S X(+FN)=+FN
"RTN","GMPLHIST",50,0)
 S X(1101)=1101
"RTN","GMPLHIST",51,0)
 Q
"RTN","GMPLSAVE")
0^1^B27626278
"RTN","GMPLSAVE",1,0)
GMPLSAVE ; SLC/MKB/KER -- Save Problem List data ; 04/15/2002
"RTN","GMPLSAVE",2,0)
 ;;2.0;Problem List;**26,31**;Aug 25, 1994
"RTN","GMPLSAVE",3,0)
 ;
"RTN","GMPLSAVE",4,0)
 ; External References
"RTN","GMPLSAVE",5,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLSAVE",6,0)
 ;   DBIA 10013  ^DIK
"RTN","GMPLSAVE",7,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMPLSAVE",8,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLSAVE",9,0)
 ;                   
"RTN","GMPLSAVE",10,0)
EN ; Save Changes made to Existing Problem
"RTN","GMPLSAVE",11,0)
 N FLD,NOW,CHNGE,I,NIFN,TEXT,OLDTEXT,FAC,NODE,AUDITED,DR,DA,DIE,DIK
"RTN","GMPLSAVE",12,0)
 S:'GMPORIG(.01) GMPORIG(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",13,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",14,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX ;chk for error from ICD
"RTN","GMPLSAVE",15,0)
 S:'GMPORIG(1.01) GMPORIG(1.01)="1^Unresolved"
"RTN","GMPLSAVE",16,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",17,0)
 S:'GMPFLD(.05) I=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(I,+GMPFLD(1.01))
"RTN","GMPLSAVE",18,0)
 S NOW=$$HTFM^XLFDT($H),AUDITED=0
"RTN","GMPLSAVE",19,0)
 S DR="1.02////"_$S('$D(GMPLUSER):"T",1:GMPFLD(1.02))
"RTN","GMPLSAVE",20,0)
 I GMPORIG(1.02)="T",GMPFLD(1.02)="P" D
"RTN","GMPLSAVE",21,0)
 . S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ
"RTN","GMPLSAVE",22,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",23,0)
 I $P($G(GMPORIG(.12)),U)="I",$P(GMPFLD(.12),U)="A" D REACTV S AUDITED=1
"RTN","GMPLSAVE",24,0)
 I +$G(GMPORIG(1.01))'=(+GMPFLD(1.01)) D REFORM S AUDITED=1
"RTN","GMPLSAVE",25,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",26,0)
 F FLD=.01,.05,.12,.13,1.01,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16 D
"RTN","GMPLSAVE",27,0)
 . Q:'$D(GMPFLD(FLD))  Q:$P($G(GMPORIG(FLD)),U)=$P($G(GMPFLD(FLD)),U)
"RTN","GMPLSAVE",28,0)
 . S DR=DR_";"_FLD_"////"_$S($P(GMPFLD(FLD),U)'="":$P(GMPFLD(FLD),U),1:"@")
"RTN","GMPLSAVE",29,0)
 . Q:AUDITED  S CHNGE=GMPIFN_U_FLD_U_NOW_U_DUZ_U_$P(GMPORIG(FLD),U)_U_$P(GMPFLD(FLD),U)_"^^"_+$G(GMPROV)
"RTN","GMPLSAVE",30,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",31,0)
 S DA=GMPIFN,DIE="^AUPNPROB(" D ^DIE S GMPSAVED=1
"RTN","GMPLSAVE",32,0)
NOTES ; Save Changes to Notes
"RTN","GMPLSAVE",33,0)
 F I=0:0 S I=$O(GMPORIG(10,I)) Q:I'>0  I GMPORIG(10,I)'=GMPFLD(10,I) D
"RTN","GMPLSAVE",34,0)
 . S NIFN=+GMPFLD(10,I),FAC=$P(GMPFLD(10,I),U,2),TEXT=$P(GMPFLD(10,I),U,3),OLDTEXT=$P(GMPORIG(10,I),U,3)
"RTN","GMPLSAVE",35,0)
 . S NODE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0))
"RTN","GMPLSAVE",36,0)
 . I TEXT'="" S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,3)=TEXT D
"RTN","GMPLSAVE",37,0)
 .. I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",38,0)
 .. S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^C^^Note Modified^"_+$G(GMPROV)
"RTN","GMPLSAVE",39,0)
 . I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",40,0)
 . I TEXT="" S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^A^^Deleted Note^"_+$G(GMPROV)
"RTN","GMPLSAVE",41,0)
 . D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",42,0)
 . I TEXT="" D
"RTN","GMPLSAVE",43,0)
 .. S DIK="^AUPNPROB("_GMPIFN_",11,"_FAC_",11,"
"RTN","GMPLSAVE",44,0)
 .. S DA(2)=GMPIFN,DA(1)=FAC,DA=NIFN D ^DIK
"RTN","GMPLSAVE",45,0)
 I $D(GMPFLD(10,"NEW"))>9 D NEWNOTE
"RTN","GMPLSAVE",46,0)
EXIT ; Quit Saving Changes
"RTN","GMPLSAVE",47,0)
 D:$G(GMPSAVED) DTMOD^GMPLX(GMPIFN)
"RTN","GMPLSAVE",48,0)
 Q
"RTN","GMPLSAVE",49,0)
 ;
"RTN","GMPLSAVE",50,0)
REFORM ; Audit Entry that has been Reformulated
"RTN","GMPLSAVE",51,0)
 S CHNGE=GMPIFN_"^1.01^"_NOW_U_DUZ_U_+GMPORIG(1.01)_U_+GMPFLD(1.01)_"^Reformulated^"_+$G(GMPROV)
"RTN","GMPLSAVE",52,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",53,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",54,0)
 Q
"RTN","GMPLSAVE",55,0)
 ;
"RTN","GMPLSAVE",56,0)
REACTV ; Audit Entry that has been Reactivated
"RTN","GMPLSAVE",57,0)
 S CHNGE=GMPIFN_"^.12^"_NOW_U_DUZ_"^I^A^Reactivated^"_+$G(GMPROV)
"RTN","GMPLSAVE",58,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",59,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",60,0)
 Q
"RTN","GMPLSAVE",61,0)
 ;
"RTN","GMPLSAVE",62,0)
NEW ; Save Collected Values in new Problem Entry
"RTN","GMPLSAVE",63,0)
 ;   Output   DA (left defined)
"RTN","GMPLSAVE",64,0)
 N DATA,APCDLOOK,APCDALVR,NUM,I,DIK,GMPIFN,X
"RTN","GMPLSAVE",65,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",66,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX ;chk for error from ICD
"RTN","GMPLSAVE",67,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",68,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",69,0)
 S:'GMPFLD(.05) X=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(X,+GMPFLD(1.01))
"RTN","GMPLSAVE",70,0)
 S DA=$$NEWPROB(+GMPFLD(.01),+GMPDFN) Q:DA'>0
"RTN","GMPLSAVE",71,0)
 S NUM=$$NEXTNMBR(+GMPDFN,+GMPVAMC),GMPSAVED=1 S:'NUM NUM=""
"RTN","GMPLSAVE",72,0)
 ;   Set Node 0
"RTN","GMPLSAVE",73,0)
 S DATA=^AUPNPROB(DA,0)_U_DT_"^^"_$P(GMPFLD(.05),U)_U_+GMPVAMC_U_+NUM_U_DT_"^^^^"_$P(GMPFLD(.12),U)_U_$P(GMPFLD(.13),U)
"RTN","GMPLSAVE",74,0)
 S ^AUPNPROB(DA,0)=DATA
"RTN","GMPLSAVE",75,0)
 ;   Set Node 1
"RTN","GMPLSAVE",76,0)
 S DATA=$P(GMPFLD(1.01),U) F I=1.02:.01:1.16 S DATA=DATA_U_$P($G(GMPFLD(+I)),U)
"RTN","GMPLSAVE",77,0)
 S ^AUPNPROB(DA,1)=DATA
"RTN","GMPLSAVE",78,0)
 ;   Set X-Refs
"RTN","GMPLSAVE",79,0)
 S DIK="^AUPNPROB(",(APCDLOOK,APCDALVR)=1 D IX1^DIK
"RTN","GMPLSAVE",80,0)
 I $D(GMPFLD(10,"NEW"))>9 S GMPIFN=DA D NEWNOTE
"RTN","GMPLSAVE",81,0)
 Q
"RTN","GMPLSAVE",82,0)
 ;
"RTN","GMPLSAVE",83,0)
NEWPROB(ICD,DFN) ; Creates New Problem Entry in file #9000011
"RTN","GMPLSAVE",84,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLSAVE",85,0)
 L +^AUPNPROB(0):1 I '$T D  Q -1
"RTN","GMPLSAVE",86,0)
 . W !!,"Someone else is currently editing this file."
"RTN","GMPLSAVE",87,0)
 . W !,"Please try again later.",!
"RTN","GMPLSAVE",88,0)
 S HDR=$G(^AUPNPROB(0)) Q:HDR="" -1
"RTN","GMPLSAVE",89,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",90,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(I,0))
"RTN","GMPLSAVE",91,0)
 S DA=I,^AUPNPROB(DA,0)=ICD_U_DFN
"RTN","GMPLSAVE",92,0)
 S ^AUPNPROB("B",ICD,DA)="",^AUPNPROB("AC",DFN,DA)=""
"RTN","GMPLSAVE",93,0)
 S $P(^AUPNPROB(0),U,3,4)=DA_U_(TOTAL+1) L -^AUPNPROB(0)
"RTN","GMPLSAVE",94,0)
 Q DA
"RTN","GMPLSAVE",95,0)
 ;
"RTN","GMPLSAVE",96,0)
NEWNOTE ; Creates New Note Entries for Problem
"RTN","GMPLSAVE",97,0)
 ;   Requires GMPIFN   Pointer to Problem
"RTN","GMPLSAVE",98,0)
 ;            GMPROV   Current Provider
"RTN","GMPLSAVE",99,0)
 ;            GMPVAMC  Facility
"RTN","GMPLSAVE",100,0)
 N HDR,LAST,TOTAL,I,FAC,NIFN
"RTN","GMPLSAVE",101,0)
 L +^AUPNPROB(GMPIFN,11):1 I '$T Q
"RTN","GMPLSAVE",102,0)
 S FAC=+$O(^AUPNPROB(GMPIFN,11,"B",GMPVAMC,0)) I 'FAC D
"RTN","GMPLSAVE",103,0)
 . S:'$D(^AUPNPROB(GMPIFN,11,0)) ^(0)="^9000011.11PA^^"
"RTN","GMPLSAVE",104,0)
 . S HDR=^AUPNPROB(GMPIFN,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",105,0)
 . F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,I,0))
"RTN","GMPLSAVE",106,0)
 . S ^AUPNPROB(GMPIFN,11,I,0)=GMPVAMC,^AUPNPROB(GMPIFN,11,"B",GMPVAMC,I)=""
"RTN","GMPLSAVE",107,0)
 . S FAC=I,$P(^AUPNPROB(GMPIFN,11,0),U,3,4)=FAC_U_(TOTAL+1)
"RTN","GMPLSAVE",108,0)
 I FAC'>0 G NNQ
"RTN","GMPLSAVE",109,0)
NN1 ;   Get New Note
"RTN","GMPLSAVE",110,0)
 S:'$D(^AUPNPROB(GMPIFN,11,FAC,11,0)) ^(0)="^9000011.1111IA^^"
"RTN","GMPLSAVE",111,0)
 S HDR=^AUPNPROB(GMPIFN,11,FAC,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",112,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,FAC,11,I,0))
"RTN","GMPLSAVE",113,0)
 S NIFN=I
"RTN","GMPLSAVE",114,0)
 F I=0:0 S I=$O(GMPFLD(10,"NEW",I)) Q:I'>0  D
"RTN","GMPLSAVE",115,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)=NIFN_"^^"_GMPFLD(10,"NEW",I)_"^A^"_DT_U_+$G(GMPROV)
"RTN","GMPLSAVE",116,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,"B",NIFN,NIFN)=""
"RTN","GMPLSAVE",117,0)
 . S TOTAL=TOTAL+1,LAST=NIFN,NIFN=NIFN+1
"RTN","GMPLSAVE",118,0)
 S $P(^AUPNPROB(GMPIFN,11,FAC,11,0),U,3,4)=LAST_U_TOTAL
"RTN","GMPLSAVE",119,0)
NNQ ;   Quit Getting New Notes
"RTN","GMPLSAVE",120,0)
 L -^AUPNPROB(GMPIFN,11)
"RTN","GMPLSAVE",121,0)
 Q
"RTN","GMPLSAVE",122,0)
 ;
"RTN","GMPLSAVE",123,0)
NEXTNMBR(DFN,VAMC) ; Returns Next Available Problem Number
"RTN","GMPLSAVE",124,0)
 N I,J,NUM S NUM=1,I="" I '$D(^AUPNPROB("AA",DFN,VAMC)) Q NUM
"RTN","GMPLSAVE",125,0)
 F  S I=$O(^AUPNPROB("AA",DFN,VAMC,I)) Q:I=""  S J=$E(I,2,999),NUM=+J
"RTN","GMPLSAVE",126,0)
 S NUM=NUM+1
"RTN","GMPLSAVE",127,0)
 Q NUM
"VER")
8.0^22.0
**END**
**END**
