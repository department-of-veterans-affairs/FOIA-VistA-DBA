Released PRCA*4.5*208 SEQ #190
Extracted from mail message
**KIDS**:PRCA*4.5*208^

**INSTALL NAME**
PRCA*4.5*208
"BLD",4703,0)
PRCA*4.5*208^ACCOUNTS RECEIVABLE^0^3040719^y
"BLD",4703,4,0)
^9.64PA^344.31^5
"BLD",4703,4,344,0)
344
"BLD",4703,4,344,2,0)
^9.641^344^1
"BLD",4703,4,344,2,344,0)
AR BATCH PAYMENT  (File-top level)
"BLD",4703,4,344,2,344,1,0)
^9.6411^.01^1
"BLD",4703,4,344,2,344,1,.01,0)
RECEIPT #
"BLD",4703,4,344,222)
y^n^p^^^^n^^n
"BLD",4703,4,344,224)

"BLD",4703,4,344.31,0)
344.31
"BLD",4703,4,344.31,2,0)
^9.641^344.31^1
"BLD",4703,4,344.31,2,344.31,0)
EDI THIRD PARTY EFT DETAIL  (File-top level)
"BLD",4703,4,344.31,2,344.31,1,0)
^9.6411^.16^1
"BLD",4703,4,344.31,2,344.31,1,.16,0)
MANUAL TR DOCUMENT
"BLD",4703,4,344.31,222)
y^n^p^^^^n^^n
"BLD",4703,4,344.31,224)

"BLD",4703,4,344.4,0)
344.4
"BLD",4703,4,344.4,2,0)
^9.641^344.4^1
"BLD",4703,4,344.4,2,344.4,0)
ELECTRONIC REMITTANCE ADVICE  (File-top level)
"BLD",4703,4,344.4,2,344.4,1,0)
^9.6411^.14^3
"BLD",4703,4,344.4,2,344.4,1,.07,0)
FILE DATE/TIME
"BLD",4703,4,344.4,2,344.4,1,.08,0)
RECEIPT
"BLD",4703,4,344.4,2,344.4,1,.14,0)
DETAIL POST STATUS
"BLD",4703,4,344.4,222)
y^n^p^^^^n^^n
"BLD",4703,4,344.4,224)

"BLD",4703,4,344.49,0)
344.49
"BLD",4703,4,344.49,2,0)
^9.641^344.492^4
"BLD",4703,4,344.49,2,344.491,0)
SEQUENCE #  (sub-file)
"BLD",4703,4,344.49,2,344.491,1,0)
^9.6411^.13^2
"BLD",4703,4,344.49,2,344.491,1,.13,0)
VERIFIED
"BLD",4703,4,344.49,2,344.491,1,.14,0)
BATCH #
"BLD",4703,4,344.49,2,344.4914,0)
REVIEW  (sub-file)
"BLD",4703,4,344.49,2,344.4914,1,0)
^9.6411^^
"BLD",4703,4,344.49,2,344.492,0)
USER PREFERENCE  (sub-file)
"BLD",4703,4,344.49,2,344.492,1,0)
^9.6411^^
"BLD",4703,4,344.49,2,344.493,0)
BATCH  (sub-file)
"BLD",4703,4,344.49,2,344.493,1,0)
^9.6411^^0
"BLD",4703,4,344.49,222)
y^n^p^^^^n^^n
"BLD",4703,4,344.49,224)

"BLD",4703,4,344.5,0)
344.5
"BLD",4703,4,344.5,2,0)
^9.641^344.5^1
"BLD",4703,4,344.5,2,344.5,0)
AR EDI LOCKBOX MESSAGES  (File-top level)
"BLD",4703,4,344.5,2,344.5,1,0)
^9.6411^.1^1
"BLD",4703,4,344.5,2,344.5,1,.1,0)
EXCEPTION CATEGORY
"BLD",4703,4,344.5,222)
y^n^p^^^^n^^n
"BLD",4703,4,344.5,224)

"BLD",4703,4,"APDD",344,344)

"BLD",4703,4,"APDD",344,344,.01)

"BLD",4703,4,"APDD",344.31,344.31)

"BLD",4703,4,"APDD",344.31,344.31,.16)

"BLD",4703,4,"APDD",344.4,344.4)

"BLD",4703,4,"APDD",344.4,344.4,.07)

"BLD",4703,4,"APDD",344.4,344.4,.08)

"BLD",4703,4,"APDD",344.4,344.4,.14)

"BLD",4703,4,"APDD",344.49,344.491)

"BLD",4703,4,"APDD",344.49,344.491,.13)

"BLD",4703,4,"APDD",344.49,344.491,.14)

"BLD",4703,4,"APDD",344.49,344.4914)

"BLD",4703,4,"APDD",344.49,344.492)

"BLD",4703,4,"APDD",344.49,344.493)

"BLD",4703,4,"APDD",344.5,344.5)

"BLD",4703,4,"APDD",344.5,344.5,.1)

"BLD",4703,4,"B",344,344)

"BLD",4703,4,"B",344.31,344.31)

"BLD",4703,4,"B",344.4,344.4)

"BLD",4703,4,"B",344.49,344.49)

"BLD",4703,4,"B",344.5,344.5)

"BLD",4703,"ABPKG")
n
"BLD",4703,"INIT")
RCY208PO
"BLD",4703,"KRN",0)
^9.67PA^8989.52^19
"BLD",4703,"KRN",.4,0)
.4
"BLD",4703,"KRN",.401,0)
.401
"BLD",4703,"KRN",.402,0)
.402
"BLD",4703,"KRN",.403,0)
.403
"BLD",4703,"KRN",.5,0)
.5
"BLD",4703,"KRN",.84,0)
.84
"BLD",4703,"KRN",3.6,0)
3.6
"BLD",4703,"KRN",3.8,0)
3.8
"BLD",4703,"KRN",9.2,0)
9.2
"BLD",4703,"KRN",9.8,0)
9.8
"BLD",4703,"KRN",9.8,"NM",0)
^9.68A^36^34
"BLD",4703,"KRN",9.8,"NM",1,0)
RCDPEWL6^^0^B65553725
"BLD",4703,"KRN",9.8,"NM",2,0)
RCBEADJ^^0^B63862769
"BLD",4703,"KRN",9.8,"NM",3,0)
RCDPESR1^^0^B46802741
"BLD",4703,"KRN",9.8,"NM",4,0)
RCDPESR4^^0^B67024899
"BLD",4703,"KRN",9.8,"NM",5,0)
RCDPEWL1^^0^B53355321
"BLD",4703,"KRN",9.8,"NM",6,0)
RCDPEWL^^0^B44394338
"BLD",4703,"KRN",9.8,"NM",7,0)
RCDPEWL5^^0^B56075970
"BLD",4703,"KRN",9.8,"NM",9,0)
RCDPESR2^^0^B76459663
"BLD",4703,"KRN",9.8,"NM",10,0)
RCDPESR6^^0^B26998339
"BLD",4703,"KRN",9.8,"NM",11,0)
RCDPEWL7^^0^B79914006
"BLD",4703,"KRN",9.8,"NM",12,0)
RCDPEWL0^^0^B80346740
"BLD",4703,"KRN",9.8,"NM",13,0)
RCDPEAC^^0^B66119126
"BLD",4703,"KRN",9.8,"NM",14,0)
RCDPEV^^0^B37157784
"BLD",4703,"KRN",9.8,"NM",15,0)
RCDPEWLA^^0^B49000254
"BLD",4703,"KRN",9.8,"NM",16,0)
RCDPEWL4^^0^B48723310
"BLD",4703,"KRN",9.8,"NM",17,0)
RCDPEWLB^^0^B46624897
"BLD",4703,"KRN",9.8,"NM",18,0)
RCDPEWL8^^0^B73075221
"BLD",4703,"KRN",9.8,"NM",19,0)
RCDPEWL2^^0^B84516600
"BLD",4703,"KRN",9.8,"NM",20,0)
RCDPEV0^^0^B24399353
"BLD",4703,"KRN",9.8,"NM",21,0)
RCDPEWLC^^0^B9545338
"BLD",4703,"KRN",9.8,"NM",22,0)
RCDPESR0^^0^B53919083
"BLD",4703,"KRN",9.8,"NM",23,0)
RCDPESR5^^0^B27354916
"BLD",4703,"KRN",9.8,"NM",24,0)
RCDPLPL1^^0^B25553725
"BLD",4703,"KRN",9.8,"NM",25,0)
RCDPLPLM^^0^B40847044
"BLD",4703,"KRN",9.8,"NM",26,0)
RCDPRSEA^^0^B21734319
"BLD",4703,"KRN",9.8,"NM",27,0)
RCDPE8NZ^^0^B24348262
"BLD",4703,"KRN",9.8,"NM",28,0)
RCDPESR3^^0^B57118992
"BLD",4703,"KRN",9.8,"NM",29,0)
RCDPEM2^^0^B62281734
"BLD",4703,"KRN",9.8,"NM",31,0)
RCDPEREC^^0^B37254915
"BLD",4703,"KRN",9.8,"NM",32,0)
RCDPEX^^0^B75558760
"BLD",4703,"KRN",9.8,"NM",33,0)
RCDPEX31^^0^B37980620
"BLD",4703,"KRN",9.8,"NM",34,0)
RCDPUREC^^0^B62079546
"BLD",4703,"KRN",9.8,"NM",35,0)
RCDPEM0^^0^B50875265
"BLD",4703,"KRN",9.8,"NM",36,0)
RCDPEX3^^0^B75090917
"BLD",4703,"KRN",9.8,"NM","B","RCBEADJ",2)

"BLD",4703,"KRN",9.8,"NM","B","RCDPE8NZ",27)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEAC",13)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEM0",35)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEM2",29)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEREC",31)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR0",22)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR1",3)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR2",9)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR3",28)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR4",4)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR5",23)

"BLD",4703,"KRN",9.8,"NM","B","RCDPESR6",10)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEV",14)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEV0",20)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL",6)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL0",12)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL1",5)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL2",19)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL4",16)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL5",7)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL6",1)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL7",11)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWL8",18)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWLA",15)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWLB",17)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEWLC",21)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEX",32)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEX3",36)

"BLD",4703,"KRN",9.8,"NM","B","RCDPEX31",33)

"BLD",4703,"KRN",9.8,"NM","B","RCDPLPL1",24)

"BLD",4703,"KRN",9.8,"NM","B","RCDPLPLM",25)

"BLD",4703,"KRN",9.8,"NM","B","RCDPRSEA",26)

"BLD",4703,"KRN",9.8,"NM","B","RCDPUREC",34)

"BLD",4703,"KRN",19,0)
19
"BLD",4703,"KRN",19,"NM",0)
^9.68A^13^13
"BLD",4703,"KRN",19,"NM",1,0)
RCDPE ACTIVE WITH EEOB REPORT^^0
"BLD",4703,"KRN",19,"NM",2,0)
RCDPE EDI LOCKBOX REPORTS MENU^^0
"BLD",4703,"KRN",19,"NM",3,0)
RCDPE EDI LOCKBOX ACT REPORT^^4^
"BLD",4703,"KRN",19,"NM",4,0)
RCDPE EFT AGING REPORT^^4^
"BLD",4703,"KRN",19,"NM",5,0)
RCDPE ERA AGING REPORT^^4^
"BLD",4703,"KRN",19,"NM",6,0)
RCDPE EOB TRANSFER REPORTS^^4^
"BLD",4703,"KRN",19,"NM",7,0)
RCDPE UNAPPLIED EFT DEP REPORT^^4^
"BLD",4703,"KRN",19,"NM",8,0)
RCDPE VIEW/PRINT ERA^^4^
"BLD",4703,"KRN",19,"NM",9,0)
RCDP EXTENDED CHECK/CC SEARCH^^0
"BLD",4703,"KRN",19,"NM",10,0)
RCDP LINK PAYMENT TO ACCOUNT^^0
"BLD",4703,"KRN",19,"NM",11,0)
RCDPE DEPOSIT RECON REPORT^^0
"BLD",4703,"KRN",19,"NM",12,0)
RCDPE ERA RETURNED TO PAYER^^0
"BLD",4703,"KRN",19,"NM",13,0)
RCDPE EDI LOCKBOX MENU^^2
"BLD",4703,"KRN",19,"NM","B","RCDP EXTENDED CHECK/CC SEARCH",9)

"BLD",4703,"KRN",19,"NM","B","RCDP LINK PAYMENT TO ACCOUNT",10)

"BLD",4703,"KRN",19,"NM","B","RCDPE ACTIVE WITH EEOB REPORT",1)

"BLD",4703,"KRN",19,"NM","B","RCDPE DEPOSIT RECON REPORT",11)

"BLD",4703,"KRN",19,"NM","B","RCDPE EDI LOCKBOX ACT REPORT",3)

"BLD",4703,"KRN",19,"NM","B","RCDPE EDI LOCKBOX MENU",13)

"BLD",4703,"KRN",19,"NM","B","RCDPE EDI LOCKBOX REPORTS MENU",2)

"BLD",4703,"KRN",19,"NM","B","RCDPE EFT AGING REPORT",4)

"BLD",4703,"KRN",19,"NM","B","RCDPE EOB TRANSFER REPORTS",6)

"BLD",4703,"KRN",19,"NM","B","RCDPE ERA AGING REPORT",5)

"BLD",4703,"KRN",19,"NM","B","RCDPE ERA RETURNED TO PAYER",12)

"BLD",4703,"KRN",19,"NM","B","RCDPE UNAPPLIED EFT DEP REPORT",7)

"BLD",4703,"KRN",19,"NM","B","RCDPE VIEW/PRINT ERA",8)

"BLD",4703,"KRN",19.1,0)
19.1
"BLD",4703,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",4703,"KRN",19.1,"NM",1,0)
PRCA ERA BATCH MAINT^^0
"BLD",4703,"KRN",19.1,"NM","B","PRCA ERA BATCH MAINT",1)

"BLD",4703,"KRN",101,0)
101
"BLD",4703,"KRN",101,"NM",0)
^9.68A^41^39
"BLD",4703,"KRN",101,"NM",1,0)
RCDPE ERA LIST VIEW ERA^^0
"BLD",4703,"KRN",101,"NM",2,0)
RCDPE WORKLIST ERA LIST MENU^^0
"BLD",4703,"KRN",101,"NM",3,0)
RCDPE WORKLIST ERA SELECT^^0
"BLD",4703,"KRN",101,"NM",4,0)
RCDPE WORKLIST ERA SORT^^0
"BLD",4703,"KRN",101,"NM",5,0)
VALM QUIT^^4^
"BLD",4703,"KRN",101,"NM",6,0)
RCDPE ERA LIST BATCH HIDE^^0
"BLD",4703,"KRN",101,"NM",7,0)
RCDPE EOB WORKLIST BATCH^^0
"BLD",4703,"KRN",101,"NM",8,0)
RCDPE EOB WORKLIST VERIFY^^0
"BLD",4703,"KRN",101,"NM",9,0)
RCDPE EOB WORKLIST MENU^^0
"BLD",4703,"KRN",101,"NM",11,0)
RCDPE EOB WORKLIST DIST ADJ^^4^
"BLD",4703,"KRN",101,"NM",12,0)
RCDPE EOB WORKLIST REFRESH^^4^
"BLD",4703,"KRN",101,"NM",13,0)
RCDPE VIEW/PRINT WORKLIST EOB^^4^
"BLD",4703,"KRN",101,"NM",14,0)
RCDPE VIEW/PRINT WORKLIST ERA^^4^
"BLD",4703,"KRN",101,"NM",15,0)
RCDPE EOB WORKLIST RESEARCH^^4^
"BLD",4703,"KRN",101,"NM",16,0)
RCDPE EOB WL RECEIPT VIEW^^0^
"BLD",4703,"KRN",101,"NM",17,0)
RCDPE EOB WL REVIEW^^4^
"BLD",4703,"KRN",101,"NM",19,0)
RCDP LINK PAYMENTS SEARCH CHECK^^0
"BLD",4703,"KRN",101,"NM",20,0)
RCDP LINK PAYMENTS MENU^^0
"BLD",4703,"KRN",101,"NM",21,0)
RCDP LINK PAYMENTS SEARCH CREDIT^^4^
"BLD",4703,"KRN",101,"NM",22,0)
RCDP LINK PAYMENTS TO ACCOUNT^^4^
"BLD",4703,"KRN",101,"NM",23,0)
RCDP LINK PAYMENTS ACCOUNT PROFILE^^4^
"BLD",4703,"KRN",101,"NM",24,0)
RCDP LINK PAYMENTS RECEIPT PROFILE^^4^
"BLD",4703,"KRN",101,"NM",25,0)
RCDP LINK PAYMENTS CLEAR SUSPENSE^^4^
"BLD",4703,"KRN",101,"NM",26,0)
RCDP LINK PAYMENTS SUSPENSE REPORT^^4^
"BLD",4703,"KRN",101,"NM",27,0)
RCDP FAST EXIT^^4^
"BLD",4703,"KRN",101,"NM",28,0)
RCDP LINK PAYMENTS SHOW PAYMENT^^4^
"BLD",4703,"KRN",101,"NM",29,0)
RCDPE EOB WORKLIST SPLIT LINE^^4^
"BLD",4703,"KRN",101,"NM",30,0)
RCDPE EOB WORKLIST RESEARCH MENU^^0
"BLD",4703,"KRN",101,"NM",31,0)
RCDPE EOB WORKLIST REL HOLD^^4^
"BLD",4703,"KRN",101,"NM",32,0)
RCDPE EOB WORKLIST TPJI^^4^
"BLD",4703,"KRN",101,"NM",33,0)
RCDPE EOB WORKLIST CHG MAINT^^4^
"BLD",4703,"KRN",101,"NM",34,0)
RCDPE EOB WORKLIST ON HOLD RPT^^4^
"BLD",4703,"KRN",101,"NM",35,0)
RCDPE EOB WORKLIST CL MATCH RPT^^4^
"BLD",4703,"KRN",101,"NM",36,0)
RCDPE EOB WL RESEARCH EXIT^^4^
"BLD",4703,"KRN",101,"NM",37,0)
RCDPE EOB WORKLIST BILL COMMENT^^4^
"BLD",4703,"KRN",101,"NM",38,0)
RCDPE EOB WORKLIST REESTABLISH^^4^
"BLD",4703,"KRN",101,"NM",39,0)
RCDPE EOB WORKLIST ADJUST^^4^
"BLD",4703,"KRN",101,"NM",40,0)
RCDPE EOB WORKLIST FULL ACCT PROF^^4^
"BLD",4703,"KRN",101,"NM",41,0)
RCDPE EOB WL SPLIT LINE^^0
"BLD",4703,"KRN",101,"NM","B","RCDP FAST EXIT",27)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS ACCOUNT PROFILE",23)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS CLEAR SUSPENSE",25)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS MENU",20)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS RECEIPT PROFILE",24)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS SEARCH CHECK",19)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS SEARCH CREDIT",21)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS SHOW PAYMENT",28)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS SUSPENSE REPORT",26)

"BLD",4703,"KRN",101,"NM","B","RCDP LINK PAYMENTS TO ACCOUNT",22)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WL RECEIPT VIEW",16)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WL RESEARCH EXIT",36)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WL REVIEW",17)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WL SPLIT LINE",41)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST ADJUST",39)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST BATCH",7)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST BILL COMMENT",37)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST CHG MAINT",33)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST CL MATCH RPT",35)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST DIST ADJ",11)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST FULL ACCT PROF",40)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST MENU",9)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST ON HOLD RPT",34)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST REESTABLISH",38)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST REFRESH",12)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST REL HOLD",31)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST RESEARCH",15)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST RESEARCH MENU",30)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST SPLIT LINE",29)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST TPJI",32)

"BLD",4703,"KRN",101,"NM","B","RCDPE EOB WORKLIST VERIFY",8)

"BLD",4703,"KRN",101,"NM","B","RCDPE ERA LIST BATCH HIDE",6)

"BLD",4703,"KRN",101,"NM","B","RCDPE ERA LIST VIEW ERA",1)

"BLD",4703,"KRN",101,"NM","B","RCDPE VIEW/PRINT WORKLIST EOB",13)

"BLD",4703,"KRN",101,"NM","B","RCDPE VIEW/PRINT WORKLIST ERA",14)

"BLD",4703,"KRN",101,"NM","B","RCDPE WORKLIST ERA LIST MENU",2)

"BLD",4703,"KRN",101,"NM","B","RCDPE WORKLIST ERA SELECT",3)

"BLD",4703,"KRN",101,"NM","B","RCDPE WORKLIST ERA SORT",4)

"BLD",4703,"KRN",101,"NM","B","VALM QUIT",5)

"BLD",4703,"KRN",409.61,0)
409.61
"BLD",4703,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",4703,"KRN",409.61,"NM",1,0)
RCDPE WORKLIST ERA LIST^^0
"BLD",4703,"KRN",409.61,"NM",2,0)
RCDP LINK PAYMENTS TO ACCOUNTS^^0
"BLD",4703,"KRN",409.61,"NM","B","RCDP LINK PAYMENTS TO ACCOUNTS",2)

"BLD",4703,"KRN",409.61,"NM","B","RCDPE WORKLIST ERA LIST",1)

"BLD",4703,"KRN",771,0)
771
"BLD",4703,"KRN",870,0)
870
"BLD",4703,"KRN",8989.51,0)
8989.51
"BLD",4703,"KRN",8989.52,0)
8989.52
"BLD",4703,"KRN",8994,0)
8994
"BLD",4703,"KRN","B",.4,.4)

"BLD",4703,"KRN","B",.401,.401)

"BLD",4703,"KRN","B",.402,.402)

"BLD",4703,"KRN","B",.403,.403)

"BLD",4703,"KRN","B",.5,.5)

"BLD",4703,"KRN","B",.84,.84)

"BLD",4703,"KRN","B",3.6,3.6)

"BLD",4703,"KRN","B",3.8,3.8)

"BLD",4703,"KRN","B",9.2,9.2)

"BLD",4703,"KRN","B",9.8,9.8)

"BLD",4703,"KRN","B",19,19)

"BLD",4703,"KRN","B",19.1,19.1)

"BLD",4703,"KRN","B",101,101)

"BLD",4703,"KRN","B",409.61,409.61)

"BLD",4703,"KRN","B",771,771)

"BLD",4703,"KRN","B",870,870)

"BLD",4703,"KRN","B",8989.51,8989.51)

"BLD",4703,"KRN","B",8989.52,8989.52)

"BLD",4703,"KRN","B",8994,8994)

"BLD",4703,"PRE")
RCY208EN
"BLD",4703,"QUES",0)
^9.62^^
"BLD",4703,"REQB",0)
^9.611^5^5
"BLD",4703,"REQB",1,0)
IB*2.0*265^2
"BLD",4703,"REQB",2,0)
PRCA*4.5*153^2
"BLD",4703,"REQB",3,0)
PRCA*4.5*212^2
"BLD",4703,"REQB",4,0)
PRCA*4.5*214^2
"BLD",4703,"REQB",5,0)
PRCA*4.5*216^2
"BLD",4703,"REQB","B","IB*2.0*265",1)

"BLD",4703,"REQB","B","PRCA*4.5*153",2)

"BLD",4703,"REQB","B","PRCA*4.5*212",3)

"BLD",4703,"REQB","B","PRCA*4.5*214",4)

"BLD",4703,"REQB","B","PRCA*4.5*216",5)

"FIA",344)
AR BATCH PAYMENT
"FIA",344,0)
^RCY(344,
"FIA",344,0,0)
344I
"FIA",344,0,1)
y^n^p^^^^n^^n
"FIA",344,0,10)

"FIA",344,0,11)

"FIA",344,0,"RLRO")

"FIA",344,0,"VR")
4.5^PRCA
"FIA",344,344)
1
"FIA",344,344,.01)

"FIA",344.31)
EDI THIRD PARTY EFT DETAIL
"FIA",344.31,0)
^RCY(344.31,
"FIA",344.31,0,0)
344.31PI
"FIA",344.31,0,1)
y^n^p^^^^n^^n
"FIA",344.31,0,10)

"FIA",344.31,0,11)

"FIA",344.31,0,"RLRO")

"FIA",344.31,0,"VR")
4.5^PRCA
"FIA",344.31,344.31)
1
"FIA",344.31,344.31,.16)

"FIA",344.4)
ELECTRONIC REMITTANCE ADVICE
"FIA",344.4,0)
^RCY(344.4,
"FIA",344.4,0,0)
344.4I
"FIA",344.4,0,1)
y^n^p^^^^n^^n
"FIA",344.4,0,10)

"FIA",344.4,0,11)

"FIA",344.4,0,"RLRO")

"FIA",344.4,0,"VR")
4.5^PRCA
"FIA",344.4,344.4)
1
"FIA",344.4,344.4,.07)

"FIA",344.4,344.4,.08)

"FIA",344.4,344.4,.14)

"FIA",344.49)
EDI LOCKBOX EOB WORKLIST
"FIA",344.49,0)
^RCY(344.49,
"FIA",344.49,0,0)
344.49P
"FIA",344.49,0,1)
y^n^p^^^^n^^n
"FIA",344.49,0,10)

"FIA",344.49,0,11)

"FIA",344.49,0,"RLRO")

"FIA",344.49,0,"VR")
4.5^PRCA
"FIA",344.49,344.49)
1
"FIA",344.49,344.49,2)

"FIA",344.49,344.49,3)

"FIA",344.49,344.491)
1
"FIA",344.49,344.491,.13)

"FIA",344.49,344.491,.14)

"FIA",344.49,344.491,4)

"FIA",344.49,344.4914)
0
"FIA",344.49,344.49141)
0
"FIA",344.49,344.492)
0
"FIA",344.49,344.493)
0
"FIA",344.5)
AR EDI LOCKBOX MESSAGES
"FIA",344.5,0)
^RCY(344.5,
"FIA",344.5,0,0)
344.5
"FIA",344.5,0,1)
y^n^p^^^^n^^n
"FIA",344.5,0,10)

"FIA",344.5,0,11)

"FIA",344.5,0,"RLRO")

"FIA",344.5,0,"VR")
4.5^PRCA
"FIA",344.5,344.5)
1
"FIA",344.5,344.5,.1)

"INIT")
RCY208PO
"IX",344.4,344.4,"ARCT",0)
344.4^ARCT^Cross reference by AR receipt #^R^^F^IR^I^344.4^^^^^S
"IX",344.4,344.4,"ARCT",1)
S ^RCY(344.4,"ARCT",X,DA)=""
"IX",344.4,344.4,"ARCT",2)
K ^RCY(344.4,"ARCT",X,DA)
"IX",344.4,344.4,"ARCT",2.5)
K ^RCY(344.4,"ARCT")
"IX",344.4,344.4,"ARCT",11.1,0)
^.114IA^1^1
"IX",344.4,344.4,"ARCT",11.1,1,0)
1^F^344.4^.08^^1^F
"KRN",19,9060,-1)
0^10
"KRN",19,9060,0)
RCDP LINK PAYMENT TO ACCOUNT^Link Payment To Account^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,9060,1,0)
^^1^1^2990224^
"KRN",19,9060,1,1,0)
This option will allow you to link an unmatched payment to an account.
"KRN",19,9060,25)
RCDPLPLM
"KRN",19,9060,99.1)
57981,79509
"KRN",19,9060,"U")
LINK PAYMENT TO ACCOUNT
"KRN",19,9063,-1)
0^9
"KRN",19,9063,0)
RCDP EXTENDED CHECK/CC SEARCH^Extended Check/Trace/Credit Card Search^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,9063,1,0)
^19.06^2^2^3040302^^
"KRN",19,9063,1,1,0)
This option will search all payments for a check, trace #, or credit card
"KRN",19,9063,1,2,0)
number.
"KRN",19,9063,25)
RCDPRSEA
"KRN",19,9063,"U")
EXTENDED CHECK/TRACE/CREDIT CA
"KRN",19,11070,-1)
4^4
"KRN",19,11070,0)
RCDPE EFT AGING REPORT
"KRN",19,11071,-1)
4^5
"KRN",19,11071,0)
RCDPE ERA AGING REPORT
"KRN",19,11074,-1)
4^6
"KRN",19,11074,0)
RCDPE EOB TRANSFER REPORTS
"KRN",19,11075,-1)
2^13
"KRN",19,11075,0)
RCDPE EDI LOCKBOX MENU^EDI Lockbox^^M^66476^^^^^^^
"KRN",19,11075,10,0)
^19.01IP^13^13
"KRN",19,11075,10,7,0)
11078^REP
"KRN",19,11075,10,7,"^")
RCDPE EDI LOCKBOX REPORTS MENU
"KRN",19,11075,10,13,0)
11302^RET
"KRN",19,11075,10,13,"^")
RCDPE ERA RETURNED TO PAYER
"KRN",19,11075,"U")
EDI LOCKBOX
"KRN",19,11076,-1)
4^3
"KRN",19,11076,0)
RCDPE EDI LOCKBOX ACT REPORT
"KRN",19,11077,-1)
4^7
"KRN",19,11077,0)
RCDPE UNAPPLIED EFT DEP REPORT
"KRN",19,11078,-1)
0^2
"KRN",19,11078,0)
RCDPE EDI LOCKBOX REPORTS MENU^EDI Lockbox Reports Menu^^M^^^^^^^^
"KRN",19,11078,1,0)
2^19.06^2^2^3030328^^
"KRN",19,11078,1,1,0)
This menu allows access to all the reports that can be produced for EDI
"KRN",19,11078,1,2,0)
Lockbox.
"KRN",19,11078,10,0)
^19.01IP^8^8
"KRN",19,11078,10,1,0)
11076^DA^10
"KRN",19,11078,10,1,"^")
RCDPE EDI LOCKBOX ACT REPORT
"KRN",19,11078,10,2,0)
11074^TR^20
"KRN",19,11078,10,2,"^")
RCDPE EOB TRANSFER REPORTS
"KRN",19,11078,10,3,0)
11070^EFT^30
"KRN",19,11078,10,3,"^")
RCDPE EFT AGING REPORT
"KRN",19,11078,10,4,0)
11071^ERA^40
"KRN",19,11078,10,4,"^")
RCDPE ERA AGING REPORT
"KRN",19,11078,10,5,0)
11077^UN^50
"KRN",19,11078,10,5,"^")
RCDPE UNAPPLIED EFT DEP REPORT
"KRN",19,11078,10,6,0)
11085^VP
"KRN",19,11078,10,6,"^")
RCDPE VIEW/PRINT ERA
"KRN",19,11078,10,7,0)
11217^AB
"KRN",19,11078,10,7,"^")
RCDPE ACTIVE WITH EEOB REPORT
"KRN",19,11078,10,8,0)
11295^DEP
"KRN",19,11078,10,8,"^")
RCDPE DEPOSIT RECON REPORT
"KRN",19,11078,99)
59702,55589
"KRN",19,11078,99.1)
59232,49629
"KRN",19,11078,"U")
EDI LOCKBOX REPORTS MENU
"KRN",19,11085,-1)
4^8
"KRN",19,11085,0)
RCDPE VIEW/PRINT ERA
"KRN",19,11217,-1)
0^1
"KRN",19,11217,0)
RCDPE ACTIVE WITH EEOB REPORT^Active Bills With EEOB Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,11217,1,0)
^19.06^3^3^3040127^^^^
"KRN",19,11217,1,1,0)
This option produces the ACTIVE BILLS WITH EEOBs report.  This report
"KRN",19,11217,1,2,0)
contains a list of bills by insurance company that have EEOBs on file
"KRN",19,11217,1,3,0)
and also have a balance greater than 0.
"KRN",19,11217,25)
EN^RCDPEAC
"KRN",19,11217,"U")
ACTIVE BILLS WITH EEOB REPORT
"KRN",19,11295,-1)
0^11
"KRN",19,11295,0)
RCDPE DEPOSIT RECON REPORT^EFT Deposit Reconciliation Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,11295,1,0)
^19.06^4^4^3040420^^^^
"KRN",19,11295,1,1,0)
This option produces the report of EFT deposits and their corresponding
"KRN",19,11295,1,2,0)
EFT detail records.  It allows the site to determine which CR documents
"KRN",19,11295,1,3,0)
still have dollars associated with them that have not yet been transferred
"KRN",19,11295,1,4,0)
via TR documents from 5287.4/8NZZ into the appropriate accounts.
"KRN",19,11295,25)
EN^RCDPEREC
"KRN",19,11295,"U")
EFT DEPOSIT RECONCILIATION REP
"KRN",19,11302,-1)
0^12
"KRN",19,11302,0)
RCDPE ERA RETURNED TO PAYER^Mark ERA Returned To Payer^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,11302,1,0)
^19.06^4^4^3040429^^^^
"KRN",19,11302,1,1,0)
This option allows you to mark an ERA as RETURNED TO PAYER/NOT POSTED.
"KRN",19,11302,1,2,0)
You may only select an ERA that is either unmatched or matched to paper
"KRN",19,11302,1,3,0)
check and that is UNPOSTED.  This marks the POSTED status of the ERA as
"KRN",19,11302,1,4,0)
NOT POSTED-RETURNED and the EFT MATCH STATUS to MATCHED TO PAPER CHECK.
"KRN",19,11302,25)
RETN^RCDPEM2
"KRN",19,11302,"U")
MARK ERA RETURNED TO PAYER
"KRN",19.1,424,-1)
0^1
"KRN",19.1,424,0)
PRCA ERA BATCH MAINT
"KRN",19.1,424,1,0)
^19.11^2^2^3040422^^
"KRN",19.1,424,1,1,0)
This is a key for the AR action in EDI Lockbox EOB Worklist to allow 
"KRN",19.1,424,1,2,0)
access to the Batch Maintenance options.
"KRN",101,642,-1)
4^5
"KRN",101,642,0)
VALM QUIT
"KRN",101,3110,-1)
0^20
"KRN",101,3110,0)
RCDP LINK PAYMENTS MENU^Link Payments^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3110,1,0)
^^1^1^2990201^
"KRN",101,3110,1,1,0)
This protocol is the top level menu for linking accounts to payments.
"KRN",101,3110,4)
26^^^LP
"KRN",101,3110,10,0)
^101.01PA^9^9
"KRN",101,3110,10,1,0)
3111^S1^11^^^Search Check/Trace#
"KRN",101,3110,10,1,"^")
RCDP LINK PAYMENTS SEARCH CHECK
"KRN",101,3110,10,2,0)
3112^S2^12^
"KRN",101,3110,10,2,"^")
RCDP LINK PAYMENTS SEARCH CREDIT
"KRN",101,3110,10,3,0)
3113^LP^21^^^Link Payment
"KRN",101,3110,10,3,"^")
RCDP LINK PAYMENTS TO ACCOUNT
"KRN",101,3110,10,4,0)
3115^AP^31^^^Account Profile
"KRN",101,3110,10,4,"^")
RCDP LINK PAYMENTS ACCOUNT PROFILE
"KRN",101,3110,10,5,0)
3114^RP^32^^^Receipt Profile
"KRN",101,3110,10,5,"^")
RCDP LINK PAYMENTS RECEIPT PROFILE
"KRN",101,3110,10,6,0)
3116^CS^22^
"KRN",101,3110,10,6,"^")
RCDP LINK PAYMENTS CLEAR SUSPENSE
"KRN",101,3110,10,7,0)
3117^SR^23^
"KRN",101,3110,10,7,"^")
RCDP LINK PAYMENTS SUSPENSE REPORT
"KRN",101,3110,10,8,0)
3118^EA^33^
"KRN",101,3110,10,8,"^")
RCDP FAST EXIT
"KRN",101,3110,10,9,0)
3119^SP^23^
"KRN",101,3110,10,9,"^")
RCDP LINK PAYMENTS SHOW PAYMENT
"KRN",101,3110,26)
D SHOW^VALM
"KRN",101,3110,28)
Select Action: 
"KRN",101,3110,99)
59702,55587
"KRN",101,3111,-1)
0^19
"KRN",101,3111,0)
RCDP LINK PAYMENTS SEARCH CHECK^Search Check/Trace#^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3111,1,0)
^^1^1^2990203^
"KRN",101,3111,1,1,0)
This option will look for a specific check used for a payment.
"KRN",101,3111,4)
^^^SC
"KRN",101,3111,15)

"KRN",101,3111,20)
D CHKTRACE^RCDPLPL1
"KRN",101,3111,99)
59702,55587
"KRN",101,3112,-1)
4^21
"KRN",101,3112,0)
RCDP LINK PAYMENTS SEARCH CREDIT
"KRN",101,3113,-1)
4^22
"KRN",101,3113,0)
RCDP LINK PAYMENTS TO ACCOUNT
"KRN",101,3114,-1)
4^24
"KRN",101,3114,0)
RCDP LINK PAYMENTS RECEIPT PROFILE
"KRN",101,3115,-1)
4^23
"KRN",101,3115,0)
RCDP LINK PAYMENTS ACCOUNT PROFILE
"KRN",101,3116,-1)
4^25
"KRN",101,3116,0)
RCDP LINK PAYMENTS CLEAR SUSPENSE
"KRN",101,3117,-1)
4^26
"KRN",101,3117,0)
RCDP LINK PAYMENTS SUSPENSE REPORT
"KRN",101,3118,-1)
4^27
"KRN",101,3118,0)
RCDP FAST EXIT
"KRN",101,3119,-1)
4^28
"KRN",101,3119,0)
RCDP LINK PAYMENTS SHOW PAYMENT
"KRN",101,3870,-1)
0^9
"KRN",101,3870,0)
RCDPE EOB WORKLIST MENU^EOB WORKLIST MENU^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3870,1,0)
^101.06^2^2^3030219^^^^
"KRN",101,3870,1,1,0)
This is the main menu that contains the actions that can be performed
"KRN",101,3870,1,2,0)
manually on ERAs received.
"KRN",101,3870,4)
26^4
"KRN",101,3870,10,0)
^101.01PA^17^17
"KRN",101,3870,10,4,0)
642^^100^^^Exit
"KRN",101,3870,10,4,"^")
VALM QUIT
"KRN",101,3870,10,6,0)
3879^^10^
"KRN",101,3870,10,6,"^")
RCDPE EOB WORKLIST SPLIT LINE
"KRN",101,3870,10,7,0)
3880^^30^
"KRN",101,3870,10,7,"^")
RCDPE EOB WORKLIST DIST ADJ
"KRN",101,3870,10,8,0)
3881^^60^
"KRN",101,3870,10,8,"^")
RCDPE EOB WORKLIST REFRESH
"KRN",101,3870,10,9,0)
3872^EOB^80^
"KRN",101,3870,10,9,"^")
RCDPE VIEW/PRINT WORKLIST EOB
"KRN",101,3870,10,10,0)
3882^ERA^90^
"KRN",101,3870,10,10,"^")
RCDPE VIEW/PRINT WORKLIST ERA
"KRN",101,3870,10,12,0)
3885^^70^
"KRN",101,3870,10,12,"^")
RCDPE EOB WORKLIST RESEARCH
"KRN",101,3870,10,14,0)
3889^^75^
"KRN",101,3870,10,14,"^")
RCDPE EOB WL RECEIPT VIEW
"KRN",101,3870,10,15,0)
3898^^77^
"KRN",101,3870,10,15,"^")
RCDPE EOB WL REVIEW
"KRN",101,3870,10,16,0)
3939^^78^
"KRN",101,3870,10,16,"^")
RCDPE EOB WORKLIST BATCH
"KRN",101,3870,10,17,0)
3940^^79^
"KRN",101,3870,10,17,"^")
RCDPE EOB WORKLIST VERIFY
"KRN",101,3870,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,3870,26)
D SHOW^VALM
"KRN",101,3870,28)
Select Action: 
"KRN",101,3870,99)
59702,55588
"KRN",101,3871,-1)
0^30
"KRN",101,3871,0)
RCDPE EOB WORKLIST RESEARCH MENU^Research Menu^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3871,1,0)
^^2^2^3030220^
"KRN",101,3871,1,1,0)
This is the main menu that contains the actions that can be performed to 
"KRN",101,3871,1,2,0)
research a payment/denial for a claim when reviewing an EOB.
"KRN",101,3871,4)
26^4
"KRN",101,3871,10,0)
^101.01PA^14^14
"KRN",101,3871,10,1,0)
3874^^5^
"KRN",101,3871,10,1,"^")
RCDPE EOB WORKLIST REL HOLD
"KRN",101,3871,10,2,0)
3873^^20^
"KRN",101,3871,10,2,"^")
RCDPE EOB WORKLIST TPJI
"KRN",101,3871,10,4,0)
3875^^10^
"KRN",101,3871,10,4,"^")
RCDPE EOB WORKLIST CHG MAINT
"KRN",101,3871,10,5,0)
3877^^50^
"KRN",101,3871,10,5,"^")
RCDPE EOB WORKLIST ON HOLD RPT
"KRN",101,3871,10,6,0)
3878^^60^
"KRN",101,3871,10,6,"^")
RCDPE EOB WORKLIST CL MATCH RPT
"KRN",101,3871,10,7,0)
3884^^100^
"KRN",101,3871,10,7,"^")
RCDPE EOB WL RESEARCH EXIT
"KRN",101,3871,10,8,0)
3898^^80^
"KRN",101,3871,10,8,"^")
RCDPE EOB WL REVIEW
"KRN",101,3871,10,9,0)
3872^^70^
"KRN",101,3871,10,9,"^")
RCDPE VIEW/PRINT WORKLIST EOB
"KRN",101,3871,10,11,0)
3895^^65^
"KRN",101,3871,10,11,"^")
RCDPE EOB WORKLIST BILL COMMENT
"KRN",101,3871,10,12,0)
3894^^67^
"KRN",101,3871,10,12,"^")
RCDPE EOB WORKLIST REESTABLISH
"KRN",101,3871,10,13,0)
3893^^8^
"KRN",101,3871,10,13,"^")
RCDPE EOB WORKLIST ADJUST
"KRN",101,3871,10,14,0)
3876^^9^
"KRN",101,3871,10,14,"^")
RCDPE EOB WORKLIST FULL ACCT PROF
"KRN",101,3871,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,3871,26)
D SHOW^VALM
"KRN",101,3871,28)
Select Action: 
"KRN",101,3871,99)
59702,55587
"KRN",101,3872,-1)
4^13
"KRN",101,3872,0)
RCDPE VIEW/PRINT WORKLIST EOB
"KRN",101,3873,-1)
4^32
"KRN",101,3873,0)
RCDPE EOB WORKLIST TPJI
"KRN",101,3874,-1)
4^31
"KRN",101,3874,0)
RCDPE EOB WORKLIST REL HOLD
"KRN",101,3875,-1)
4^33
"KRN",101,3875,0)
RCDPE EOB WORKLIST CHG MAINT
"KRN",101,3876,-1)
4^40
"KRN",101,3876,0)
RCDPE EOB WORKLIST FULL ACCT PROF
"KRN",101,3877,-1)
4^34
"KRN",101,3877,0)
RCDPE EOB WORKLIST ON HOLD RPT
"KRN",101,3878,-1)
4^35
"KRN",101,3878,0)
RCDPE EOB WORKLIST CL MATCH RPT
"KRN",101,3879,-1)
4^29
"KRN",101,3879,0)
RCDPE EOB WORKLIST SPLIT LINE
"KRN",101,3880,-1)
4^11
"KRN",101,3880,0)
RCDPE EOB WORKLIST DIST ADJ
"KRN",101,3881,-1)
4^12
"KRN",101,3881,0)
RCDPE EOB WORKLIST REFRESH
"KRN",101,3882,-1)
4^14
"KRN",101,3882,0)
RCDPE VIEW/PRINT WORKLIST ERA
"KRN",101,3884,-1)
4^36
"KRN",101,3884,0)
RCDPE EOB WL RESEARCH EXIT
"KRN",101,3885,-1)
4^15
"KRN",101,3885,0)
RCDPE EOB WORKLIST RESEARCH
"KRN",101,3887,-1)
0^41
"KRN",101,3887,0)
RCDPE EOB WL SPLIT LINE^File New Lines^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3887,20)
D FILESP^RCDPEWL8
"KRN",101,3887,99)
59702,55587
"KRN",101,3889,-1)
0^16
"KRN",101,3889,0)
RCDPE EOB WL RECEIPT VIEW^Look At Receipt^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3889,20)
D VRECPT^RCDPEWL4
"KRN",101,3889,99)
59702,55587
"KRN",101,3893,-1)
4^39
"KRN",101,3893,0)
RCDPE EOB WORKLIST ADJUST
"KRN",101,3894,-1)
4^38
"KRN",101,3894,0)
RCDPE EOB WORKLIST REESTABLISH
"KRN",101,3895,-1)
4^37
"KRN",101,3895,0)
RCDPE EOB WORKLIST BILL COMMENT
"KRN",101,3898,-1)
4^17
"KRN",101,3898,0)
RCDPE EOB WL REVIEW
"KRN",101,3934,-1)
0^2
"KRN",101,3934,0)
RCDPE WORKLIST ERA LIST MENU^ERA WORKLIST PICK LIST^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3934,1,0)
^101.06^2^2^3040122^^^^
"KRN",101,3934,1,1,0)
This is the main menu that contains the actions that can be performed
"KRN",101,3934,1,2,0)
manually on ERAs received.
"KRN",101,3934,4)
26^4
"KRN",101,3934,10,0)
^101.01PA^14^14
"KRN",101,3934,10,4,0)
642^^100^^^Exit
"KRN",101,3934,10,4,"^")
VALM QUIT
"KRN",101,3934,10,11,0)
3935^^10^
"KRN",101,3934,10,11,"^")
RCDPE WORKLIST ERA SELECT
"KRN",101,3934,10,12,0)
3936^^20^
"KRN",101,3934,10,12,"^")
RCDPE WORKLIST ERA SORT
"KRN",101,3934,10,13,0)
3937^^30^
"KRN",101,3934,10,13,"^")
RCDPE ERA LIST VIEW ERA
"KRN",101,3934,10,14,0)
3938^^50^
"KRN",101,3934,10,14,"^")
RCDPE ERA LIST BATCH HIDE
"KRN",101,3934,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,3934,26)
D SHOW^VALM
"KRN",101,3934,28)
Select Action: 
"KRN",101,3934,99)
59702,55587
"KRN",101,3935,-1)
0^3
"KRN",101,3935,0)
RCDPE WORKLIST ERA SELECT^Select ERA^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3935,20)
D ENTERWL^RCDPEWL7
"KRN",101,3935,99)
59702,55587
"KRN",101,3936,-1)
0^4
"KRN",101,3936,0)
RCDPE WORKLIST ERA SORT^Sort List^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3936,20)
D SORT^RCDPEWL8
"KRN",101,3936,99)
59702,55587
"KRN",101,3937,-1)
0^1
"KRN",101,3937,0)
RCDPE ERA LIST VIEW ERA^View/Print ERA^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3937,1,0)
^101.06^2^2^3030219^^^^
"KRN",101,3937,1,1,0)
This option allows the user to view the summary or summary and detail
"KRN",101,3937,1,2,0)
information for an electronic remittance advice (ERA).
"KRN",101,3937,20)
D PRERA^RCDPEWL7
"KRN",101,3937,99)
59702,55587
"KRN",101,3938,-1)
0^6
"KRN",101,3938,0)
RCDPE ERA LIST BATCH HIDE^Hide/Display Batch^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3938,1,0)
^101.06^2^2^3040210^^^^
"KRN",101,3938,1,1,0)
This action allows the user to remove from or add the batch listings for
"KRN",101,3938,1,2,0)
each ERA on the screen display.
"KRN",101,3938,20)
D BATDSP^RCDPEWL8
"KRN",101,3938,99)
59702,55587
"KRN",101,3939,-1)
0^7
"KRN",101,3939,0)
RCDPE EOB WORKLIST BATCH^Batch Maintenance^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3939,1,0)
^101.06^4^4^3040212^^^^
"KRN",101,3939,1,1,0)
This option allows the user access to the options for batch editing.  It
"KRN",101,3939,1,2,0)
cannot be used if there are no batches defined for an ERA worklist entry
"KRN",101,3939,1,3,0)
and can only be accessed if the full ERA entry (not an individual batch)
"KRN",101,3939,1,4,0)
has been selected.
"KRN",101,3939,20)
D BATED^RCDPEWL8
"KRN",101,3939,99)
59702,55588
"KRN",101,3940,-1)
0^8
"KRN",101,3940,0)
RCDPE EOB WORKLIST VERIFY^Verify^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3940,1,0)
^101.06^3^3^3040212^^^^
"KRN",101,3940,1,1,0)
This option allows the user to access the options for verifying the
"KRN",101,3940,1,2,0)
EEOBs against the data on the VistA system to insure the payments are
"KRN",101,3940,1,3,0)
being made for the correct claim.
"KRN",101,3940,20)
D VERIF^RCDPEWL8
"KRN",101,3940,99)
59702,55588
"KRN",409.61,823,-1)
0^2
"KRN",409.61,823,0)
RCDP LINK PAYMENTS TO ACCOUNTS^1^^80^5^19^1^1^Payment^RCDP LINK PAYMENTS MENU^Link Payments To Accounts^1^^1
"KRN",409.61,823,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,823,"ARRAY")
 ^TMP("RCDPLPLM",$J)
"KRN",409.61,823,"COL",0)
^409.621^8^8
"KRN",409.61,823,"COL",1,0)
RECEIPT^6^12^Receipt
"KRN",409.61,823,"COL",2,0)
TRANSACTION^19^4^Tran
"KRN",409.61,823,"COL",3,0)
UNAPPLIED NUMBER^26^13^Unapplied Dep
"KRN",409.61,823,"COL",4,0)
STATUS^41^4^Stat
"KRN",409.61,823,"COL",5,0)
PAY DATE^47^8^Pay Date
"KRN",409.61,823,"COL",6,0)
PAY TYPE^57^4^Type
"KRN",409.61,823,"COL",7,0)
PAY AMOUNT^72^8^Amt Paid
"KRN",409.61,823,"COL",8,0)
CHECK/CREDIT NUMBER^62^10^Ck/Tr/Cd#
"KRN",409.61,823,"COL","B","CHECK/CREDIT NUMBER",8)

"KRN",409.61,823,"COL","B","PAY AMOUNT",7)

"KRN",409.61,823,"COL","B","PAY DATE",5)

"KRN",409.61,823,"COL","B","PAY TYPE",6)

"KRN",409.61,823,"COL","B","RECEIPT",1)

"KRN",409.61,823,"COL","B","STATUS",4)

"KRN",409.61,823,"COL","B","TRANSACTION",2)

"KRN",409.61,823,"COL","B","UNAPPLIED NUMBER",3)

"KRN",409.61,823,"FNL")
D EXIT^RCDPLPLM
"KRN",409.61,823,"HDR")
D HDR^RCDPLPLM
"KRN",409.61,823,"INIT")
D INIT^RCDPLPLM
"KRN",409.61,1016,-1)
0^1
"KRN",409.61,1016,0)
RCDPE WORKLIST ERA LIST^1^^80^7^20^1^1^#^RCDPE WORKLIST ERA LIST MENU^ERA List - Worklist^1^^1
"KRN",409.61,1016,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,1016,"ARRAY")
 ^TMP("RCDPE-ERA_WL",$J)
"KRN",409.61,1016,"COL",0)
^409.621^6^6
"KRN",409.61,1016,"COL",1,0)
NUMBER^1^4^ #
"KRN",409.61,1016,"COL",2,0)
ERA NUMBER^6^5^ERA #
"KRN",409.61,1016,"COL",3,0)
DATE_PAID^45^11^ERA PAID DT
"KRN",409.61,1016,"COL",4,0)
TOT_PAID^58^12^TOT AMT PAID
"KRN",409.61,1016,"COL",5,0)
TRACE #^13^32^TRACE#/PAYER NAME/MATCH STATUS
"KRN",409.61,1016,"COL",6,0)
DATE_RECEIVED^73^8^DT REC'D
"KRN",409.61,1016,"COL","B","DATE_PAID",3)

"KRN",409.61,1016,"COL","B","DATE_RECEIVED",6)

"KRN",409.61,1016,"COL","B","ERA NUMBER",2)

"KRN",409.61,1016,"COL","B","NUMBER",1)

"KRN",409.61,1016,"COL","B","TOT_PAID",4)

"KRN",409.61,1016,"COL","B","TRACE #",5)

"KRN",409.61,1016,"FNL")
D FNL^RCDPEWL7
"KRN",409.61,1016,"HDR")
D HDR^RCDPEWL7
"KRN",409.61,1016,"INIT")
D INIT^RCDPEWL7
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5
"PKG",142,22,1,"PAH",1,0)
208^3040719^539
"PRE")
RCY208EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
36
"RTN","RCBEADJ")
0^2^B63862769
"RTN","RCBEADJ",1,0)
RCBEADJ ;WISC/RFJ-adjustment ;1 Mar 2001
"RTN","RCBEADJ",2,0)
 ;;4.5;Accounts Receivable;**169,172,204,173,208**;Mar 20, 1995
"RTN","RCBEADJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBEADJ",4,0)
 Q
"RTN","RCBEADJ",5,0)
 ;
"RTN","RCBEADJ",6,0)
 ;
"RTN","RCBEADJ",7,0)
DECREASE ;  menu option: create a decrease adjustment
"RTN","RCBEADJ",8,0)
 D ADJUST("DECREASE")
"RTN","RCBEADJ",9,0)
 Q
"RTN","RCBEADJ",10,0)
 ;
"RTN","RCBEADJ",11,0)
 ;
"RTN","RCBEADJ",12,0)
INCREASE ;  menu option: create an increase adjustment
"RTN","RCBEADJ",13,0)
 D ADJUST("INCREASE")
"RTN","RCBEADJ",14,0)
 Q
"RTN","RCBEADJ",15,0)
 ;
"RTN","RCBEADJ",16,0)
ADJUST(RCBETYPE,RCEDI) ;  create an adjustment
"RTN","RCBEADJ",17,0)
 ;  rcbetype = INCREASE for increase or DECREASE for decrease
"RTN","RCBEADJ",18,0)
 ;  rcedi = the ien of the bill selected via the EDI Worklist;ien of 
"RTN","RCBEADJ",19,0)
 ;          the ERA entry or null/undefined if bill should be selected
"RTN","RCBEADJ",20,0)
 N RCBILLDA
"RTN","RCBEADJ",21,0)
 F  D  Q:RCBILLDA<0!$G(RCEDI)
"RTN","RCBEADJ",22,0)
 .   K RCTRANDA,RCLIST
"RTN","RCBEADJ",23,0)
 .   ;
"RTN","RCBEADJ",24,0)
 .   ;  select a bill
"RTN","RCBEADJ",25,0)
 .   S RCBILLDA=$S('$G(RCEDI):$$GETABILL^RCBEUBIL,1:+RCEDI)
"RTN","RCBEADJ",26,0)
 .   I RCBILLDA<1 Q
"RTN","RCBEADJ",27,0)
 .   ;
"RTN","RCBEADJ",28,0)
 .   ;  adjust the bill
"RTN","RCBEADJ",29,0)
 .   D ADJBILL(RCBETYPE,RCBILLDA,$P($G(RCEDI),";",2))
"RTN","RCBEADJ",30,0)
 Q
"RTN","RCBEADJ",31,0)
 ;
"RTN","RCBEADJ",32,0)
ADJBILL(RCBETYPE,RCBILLDA,RCEDIWL) ;  adjust a bill
"RTN","RCBEADJ",33,0)
 ; RCEDIWL = ien of ERA entry if called from worklist
"RTN","RCBEADJ",34,0)
 N RCAMOUNT,RCBALANC,RCDATA7,RCLIST,RCONTADJ,RCTRANDA,TOTALCAL,TOTALSTO,I,X,Y
"RTN","RCBEADJ",35,0)
 ;  lock the bill
"RTN","RCBEADJ",36,0)
 L +^PRCA(430,RCBILLDA):5 I '$T W !,"ANOTHER USER IS CURRENTLY WORKING WITH THIS BILL." Q
"RTN","RCBEADJ",37,0)
 ;
"RTN","RCBEADJ",38,0)
 ;  show data for the bill
"RTN","RCBEADJ",39,0)
 D SHOWBILL^RCWROFF1(RCBILLDA)
"RTN","RCBEADJ",40,0)
 ;
"RTN","RCBEADJ",41,0)
 ;  check the balance of the bill
"RTN","RCBEADJ",42,0)
 W !!,"Checking the bill's balance ..."
"RTN","RCBEADJ",43,0)
 S RCBALANC=$$OUTOFBAL^RCBDBBAL(RCBILLDA)
"RTN","RCBEADJ",44,0)
 I RCBALANC="" W " IN Balance!"
"RTN","RCBEADJ",45,0)
 ;
"RTN","RCBEADJ",46,0)
 ;  out of balance, ask to fix it
"RTN","RCBEADJ",47,0)
 I RCBALANC'="" D  I RCBILLDA<1 D UNLOCK Q
"RTN","RCBEADJ",48,0)
 .   S TOTALCAL=$P(RCBALANC,"^")+$P(RCBALANC,"^",2)+$P(RCBALANC,"^",3)+$P(RCBALANC,"^",4)+$P(RCBALANC,"^",5)
"RTN","RCBEADJ",49,0)
 .   S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",50,0)
 .   S TOTALSTO=$P(RCDATA7,"^")+$P(RCDATA7,"^",2)+$P(RCDATA7,"^",3)+$P(RCDATA7,"^",4)+$P(RCDATA7,"^",5)
"RTN","RCBEADJ",51,0)
 .   W " OUT of Balance!"
"RTN","RCBEADJ",52,0)
 .   W !!,"                  BALANCE:",$J("Calculated",12),$J("Stored",12)
"RTN","RCBEADJ",53,0)
 .   W !,"                  ------- ",$J("------------",12),$J("------------",12)
"RTN","RCBEADJ",54,0)
 .   W !,"        Principal Balance:",$J($P(RCBALANC,"^",1),12,2),$J($P(RCDATA7,"^",1),12,2)
"RTN","RCBEADJ",55,0)
 .   I +$P(RCBALANC,"^",1)'=+$P(RCDATA7,"^",1) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",56,0)
 .   W !,"         Interest Balance:",$J($P(RCBALANC,"^",2),12,2),$J($P(RCDATA7,"^",2),12,2)
"RTN","RCBEADJ",57,0)
 .   I +$P(RCBALANC,"^",2)'=+$P(RCDATA7,"^",2) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",58,0)
 .   W !,"            Admin Balance:",$J($P(RCBALANC,"^",3),12,2),$J($P(RCDATA7,"^",3),12,2)
"RTN","RCBEADJ",59,0)
 .   I +$P(RCBALANC,"^",3)'=+$P(RCDATA7,"^",3) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",60,0)
 .   W !,"               MF Balance:",$J($P(RCBALANC,"^",4),12,2),$J($P(RCDATA7,"^",4),12,2)
"RTN","RCBEADJ",61,0)
 .   I +$P(RCBALANC,"^",4)'=+$P(RCDATA7,"^",4) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",62,0)
 .   W !,"               CC Balance:",$J($P(RCBALANC,"^",5),12,2),$J($P(RCDATA7,"^",5),12,2)
"RTN","RCBEADJ",63,0)
 .   I +$P(RCBALANC,"^",5)'=+$P(RCDATA7,"^",5) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",64,0)
 .   W !,"                  ------- ",$J("----------",12),$J("----------",12)
"RTN","RCBEADJ",65,0)
 .   W !,"                    TOTAL:",$J(TOTALCAL,12,2),$J(TOTALSTO,12,2)
"RTN","RCBEADJ",66,0)
 .   I +TOTALCAL'=+TOTALSTO W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",67,0)
 .   ;
"RTN","RCBEADJ",68,0)
 .   ;  ask to fix the balances
"RTN","RCBEADJ",69,0)
 .   S Y=$$ASKFIX I Y'=1 W !,"  NOTE: You must fix the Balance Discrepancy before processing an adjustment!" S RCBILLDA=0 Q
"RTN","RCBEADJ",70,0)
 .   ;
"RTN","RCBEADJ",71,0)
 .   ;  fix it
"RTN","RCBEADJ",72,0)
 .   S $P(RCDATA7,"^",1)=+$P(RCBALANC,"^",1) ; principal
"RTN","RCBEADJ",73,0)
 .   S $P(RCDATA7,"^",2)=+$P(RCBALANC,"^",2) ; interest
"RTN","RCBEADJ",74,0)
 .   S $P(RCDATA7,"^",3)=+$P(RCBALANC,"^",3) ; admin
"RTN","RCBEADJ",75,0)
 .   S $P(RCDATA7,"^",4)=+$P(RCBALANC,"^",4) ; marshal fee
"RTN","RCBEADJ",76,0)
 .   S $P(RCDATA7,"^",5)=+$P(RCBALANC,"^",5) ; court cost
"RTN","RCBEADJ",77,0)
 .   S $P(^PRCA(430,RCBILLDA,7),"^",1,5)=$P(RCDATA7,"^",1,5)
"RTN","RCBEADJ",78,0)
 .   ;
"RTN","RCBEADJ",79,0)
 .   W !,"  Balance Discrepancy FIXED!"
"RTN","RCBEADJ",80,0)
 ;
"RTN","RCBEADJ",81,0)
 ;  if the principal balance is zero, do not allow it to be adjusted
"RTN","RCBEADJ",82,0)
 ;  ask to close/cancel it
"RTN","RCBEADJ",83,0)
 I RCBETYPE="DECREASE",'$G(^PRCA(430,RCBILLDA,7)) W !!,"Note: This bill has NO PRINCIPAL BALANCE to decrease !" D INTADMIN(RCBILLDA),UNLOCK Q
"RTN","RCBEADJ",84,0)
 ;
"RTN","RCBEADJ",85,0)
 ; if entry is from EDI Lockbox worklist, display total adjusments in ERA
"RTN","RCBEADJ",86,0)
 I $G(RCEDIWL) D
"RTN","RCBEADJ",87,0)
 . N X,Y,Z,Z0,Z1
"RTN","RCBEADJ",88,0)
 . S Z0=$J(+$P($$BILL^RCJIBFN2(RCBILLDA),U,3),"",2),Y=0
"RTN","RCBEADJ",89,0)
 . S Z=0 F  S Z=$O(^TMP("RC_BILL",$J,RCBILLDA,Z)) Q:'Z  D
"RTN","RCBEADJ",90,0)
 .. S X=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,Z)),U,2)
"RTN","RCBEADJ",91,0)
 .. Q:'X
"RTN","RCBEADJ",92,0)
 .. S Y=Y+$P($G(^RCY(344.49,RCEDIWL,1,X,0)),U,6)
"RTN","RCBEADJ",93,0)
 . Q:'Y
"RTN","RCBEADJ",94,0)
 . W !,"          TOTAL PAYMENT(s) TO POST FROM THIS ERA: ",$J(Y,"",2)
"RTN","RCBEADJ",95,0)
 . W !,"EXPECTED CLAIM ADJUSTMENT IF ALL POST SUCCESSFUL: ",$J($G(^PRCA(430,RCBILLDA,7))-Y,"",2)
"RTN","RCBEADJ",96,0)
 ;
"RTN","RCBEADJ",97,0)
 ;  ask to enter adjustment amount
"RTN","RCBEADJ",98,0)
 S RCAMOUNT=$$AMOUNT(RCBILLDA,RCBETYPE)
"RTN","RCBEADJ",99,0)
 I RCAMOUNT<0 D UNLOCK Q
"RTN","RCBEADJ",100,0)
 ;
"RTN","RCBEADJ",101,0)
 ;  if decrease, make negative
"RTN","RCBEADJ",102,0)
 I RCBETYPE="DECREASE" S RCAMOUNT=-RCAMOUNT
"RTN","RCBEADJ",103,0)
 ;
"RTN","RCBEADJ",104,0)
 ;  ask if it is a contract adjustment
"RTN","RCBEADJ",105,0)
 I RCBETYPE="DECREASE","^9^28^29^30^32^"[("^"_$P($G(^PRCA(430,RCBILLDA,0)),"^",2)_"^") S RCONTADJ=$$ASKCONT I RCONTADJ<0 D UNLOCK Q
"RTN","RCBEADJ",106,0)
 ;
"RTN","RCBEADJ",107,0)
 ;  show what the new transaction will look like
"RTN","RCBEADJ",108,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",109,0)
 W !!,"If you process the transaction, the bill will look like:"
"RTN","RCBEADJ",110,0)
 W !,"Current Principal Balance: ",$J($P(RCDATA7,"^"),9,2)
"RTN","RCBEADJ",111,0)
 W !,"  NEW ",RCBETYPE," Adjustment: ",$J(RCAMOUNT,9,2)
"RTN","RCBEADJ",112,0)
 W !,"                           ---------"
"RTN","RCBEADJ",113,0)
 W !,"    NEW Principal Balance: ",$J($P(RCDATA7,"^")+RCAMOUNT,9,2)
"RTN","RCBEADJ",114,0)
 ;
"RTN","RCBEADJ",115,0)
 ;  ask to enter transaction
"RTN","RCBEADJ",116,0)
 S Y=$$ASKOK(RCBETYPE) I Y'=1 D UNLOCK Q
"RTN","RCBEADJ",117,0)
 ;
"RTN","RCBEADJ",118,0)
 ;  add adjustment
"RTN","RCBEADJ",119,0)
 S RCTRANDA=$$INCDEC^RCBEUTR1(RCBILLDA,RCAMOUNT,"","","",$G(RCONTADJ))
"RTN","RCBEADJ",120,0)
 I 'RCTRANDA W !,"  *** W A R N I N G: Adjustment NOT Processed! ***" D UNLOCK Q
"RTN","RCBEADJ",121,0)
 I RCTRANDA W !,"  Adjustment Transaction: ",RCTRANDA," has been added."
"RTN","RCBEADJ",122,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *"
"RTN","RCBEADJ",123,0)
 ;
"RTN","RCBEADJ",124,0)
 ;  ask to enter a comment
"RTN","RCBEADJ",125,0)
 W !!,"Enter a comment for the ",RCBETYPE," Adjustment:"
"RTN","RCBEADJ",126,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,"41;")
"RTN","RCBEADJ",127,0)
 ;
"RTN","RCBEADJ",128,0)
 ;  ask to exempt interest and admin charges
"RTN","RCBEADJ",129,0)
 I RCBETYPE="DECREASE" D INTADMIN(RCBILLDA)
"RTN","RCBEADJ",130,0)
 ;
"RTN","RCBEADJ",131,0)
 ;  notification of subsequent payer bulletin
"RTN","RCBEADJ",132,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7)),X=0
"RTN","RCBEADJ",133,0)
 F I=1:1:5 S X=X+$P(RCDATA7,"^",I)
"RTN","RCBEADJ",134,0)
 I RCDATA7'="",'X D
"RTN","RCBEADJ",135,0)
 .   N PRCABN,PRCAEN,PRCAMT
"RTN","RCBEADJ",136,0)
 .   S PRCABN=RCBILLDA,PRCAEN=RCTRANDA,PRCAMT=+$P($G(^PRCA(433,RCTRANDA,1)),"^",5)
"RTN","RCBEADJ",137,0)
 .   D EOB^PRCADJ
"RTN","RCBEADJ",138,0)
 ;
"RTN","RCBEADJ",139,0)
 ;  unlock and ask the next bill to adjust
"RTN","RCBEADJ",140,0)
 D UNLOCK
"RTN","RCBEADJ",141,0)
 Q
"RTN","RCBEADJ",142,0)
 ;
"RTN","RCBEADJ",143,0)
 ;
"RTN","RCBEADJ",144,0)
UNLOCK ;  unlock bill and transaction
"RTN","RCBEADJ",145,0)
 L -^PRCA(430,RCBILLDA)
"RTN","RCBEADJ",146,0)
 I $G(RCTRANDA) L -^PRCA(433,RCTRANDA)
"RTN","RCBEADJ",147,0)
 Q
"RTN","RCBEADJ",148,0)
 ;
"RTN","RCBEADJ",149,0)
 ;
"RTN","RCBEADJ",150,0)
INTADMIN(RCBILLDA) ;  ask and adjust the interest and admin
"RTN","RCBEADJ",151,0)
 N RCAMOUNT,RCTRANDA,Y
"RTN","RCBEADJ",152,0)
 ;
"RTN","RCBEADJ",153,0)
 ;  check to see if there is interest and admin charges
"RTN","RCBEADJ",154,0)
 S RCAMOUNT=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",155,0)
 I '$P(RCAMOUNT,"^",2),'$P(RCAMOUNT,"^",3),'$P(RCAMOUNT,"^",4),'$P(RCAMOUNT,"^",5) Q
"RTN","RCBEADJ",156,0)
 ;
"RTN","RCBEADJ",157,0)
 ;  only ask if there is no principal
"RTN","RCBEADJ",158,0)
 I RCAMOUNT Q
"RTN","RCBEADJ",159,0)
 ;
"RTN","RCBEADJ",160,0)
 W !!,"You have the option to automatically EXEMPT the interest"
"RTN","RCBEADJ",161,0)
 W !,"and administrative charges.  This will close the bill."
"RTN","RCBEADJ",162,0)
 S Y=$$ASKEXEMP I Y'=1 Q
"RTN","RCBEADJ",163,0)
 ;
"RTN","RCBEADJ",164,0)
 W !!,"Creating an EXEMPT transaction ..."
"RTN","RCBEADJ",165,0)
 S RCTRANDA=$$EXEMPT^RCBEUTR2(RCBILLDA,$P(RCAMOUNT,"^",2)_"^"_$P(RCAMOUNT,"^",3)_"^^"_$P(RCAMOUNT,"^",4)_"^"_$P(RCAMOUNT,"^",5))
"RTN","RCBEADJ",166,0)
 I 'RCTRANDA W !,"  *** W A R N I N G: EXEMPTION NOT Processed! ***" Q
"RTN","RCBEADJ",167,0)
 I RCTRANDA W !,"   Exempt Transaction: ",RCTRANDA," has been added."
"RTN","RCBEADJ",168,0)
 ;
"RTN","RCBEADJ",169,0)
 W !,"  Current Bill Status: ",$P($G(^PRCA(430.3,+$P($G(^PRCA(430,RCBILLDA,0)),"^",8),0)),"^")
"RTN","RCBEADJ",170,0)
 Q
"RTN","RCBEADJ",171,0)
 ;
"RTN","RCBEADJ",172,0)
ASKOK(RCBETYPE) ;  ask record decrease or increase transaction
"RTN","RCBEADJ",173,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",174,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",175,0)
 S DIR("A")="Are you sure you want to enter this "_RCBETYPE_" adjustment "
"RTN","RCBEADJ",176,0)
 W ! D ^DIR
"RTN","RCBEADJ",177,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",178,0)
 Q Y
"RTN","RCBEADJ",179,0)
 ;
"RTN","RCBEADJ",180,0)
 ;
"RTN","RCBEADJ",181,0)
ASKFIX() ;  ask to fix bill's balance
"RTN","RCBEADJ",182,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",183,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",184,0)
 S DIR("A")="  Do you want to FIX the balance discrepancy "
"RTN","RCBEADJ",185,0)
 W ! D ^DIR
"RTN","RCBEADJ",186,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",187,0)
 Q Y
"RTN","RCBEADJ",188,0)
 ;
"RTN","RCBEADJ",189,0)
 ;
"RTN","RCBEADJ",190,0)
ASKEXEMP() ;  ask to record an exempt transaction
"RTN","RCBEADJ",191,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",192,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCBEADJ",193,0)
 S DIR("A")="  Would you like to EXEMPT the interest and admin charges "
"RTN","RCBEADJ",194,0)
 D ^DIR
"RTN","RCBEADJ",195,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",196,0)
 Q Y
"RTN","RCBEADJ",197,0)
 ;
"RTN","RCBEADJ",198,0)
 ;
"RTN","RCBEADJ",199,0)
ASKCONT() ;  ask if contract adjustment
"RTN","RCBEADJ",200,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",201,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",202,0)
 S DIR("A")="  Is this a CONTRACT adjustment "
"RTN","RCBEADJ",203,0)
 W ! D ^DIR
"RTN","RCBEADJ",204,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",205,0)
 Q Y
"RTN","RCBEADJ",206,0)
 ;
"RTN","RCBEADJ",207,0)
 ;
"RTN","RCBEADJ",208,0)
ADJNUM(RCBILLDA) ;  get next adjustment number for a bill
"RTN","RCBEADJ",209,0)
 N %,ADJUST,DATA1,RCTRANDA
"RTN","RCBEADJ",210,0)
 S RCTRANDA=0
"RTN","RCBEADJ",211,0)
 F  S RCTRANDA=$O(^PRCA(433,"C",RCBILLDA,RCTRANDA)) Q:'RCTRANDA  S DATA1=$G(^PRCA(433,RCTRANDA,1)) I $P(DATA1,"^",4),$P(DATA1,"^",2)=1!($P(DATA1,"^",2)=35) S ADJUST=$P(DATA1,"^",4)+1
"RTN","RCBEADJ",212,0)
 Q ADJUST
"RTN","RCBEADJ",213,0)
 ;
"RTN","RCBEADJ",214,0)
 ;
"RTN","RCBEADJ",215,0)
AMOUNT(RCBILLDA,RCBETYPE) ;  enter the adjustment amount for a bill
"RTN","RCBEADJ",216,0)
 N DIR,DIRUT,DTOUT,DUOUT,PRINBAL,X,Y
"RTN","RCBEADJ",217,0)
 S PRINBAL=+$P($G(^PRCA(430,RCBILLDA,7)),"^")
"RTN","RCBEADJ",218,0)
 I RCBETYPE="INCREASE" S PRINBAL=99999.99
"RTN","RCBEADJ",219,0)
 W !!,"Enter the ",RCBETYPE," Adjustment AMOUNT, from .01 to ",$J(PRINBAL,0,2),"."
"RTN","RCBEADJ",220,0)
 S DIR(0)="NAO^.01:"_PRINBAL_":2"
"RTN","RCBEADJ",221,0)
 S DIR("A")="  "_RCBETYPE_" PRINCIPAL BALANCE BY: "
"RTN","RCBEADJ",222,0)
 D ^DIR
"RTN","RCBEADJ",223,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",224,0)
 Q $S(Y'="":Y,1:-1)
"RTN","RCDPE8NZ")
0^27^B24348262
"RTN","RCDPE8NZ",1,0)
RCDPE8NZ ;ALB/TMK-report of unlinked payments in 5287/8NZZ ;19 MAR 2003
"RTN","RCDPE8NZ",2,0)
 ;;4.5;Accounts Receivable;**173,212,208**;Mar 20, 1995
"RTN","RCDPE8NZ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPE8NZ",4,0)
 ;
"RTN","RCDPE8NZ",5,0)
EN N RCDPPADT,%ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,ZTSK,DIR,X,Y
"RTN","RCDPE8NZ",6,0)
 S DIR("A")="Start with Deposit Date: FIRST// ",DIR(0)="DOA^:"_DT_":AEP" W ! D ^DIR K DIR
"RTN","RCDPE8NZ",7,0)
 I $D(DUOUT)!$D(DTOUT) Q
"RTN","RCDPE8NZ",8,0)
 S RCDPPADT=+Y
"RTN","RCDPE8NZ",9,0)
 ; Ask device
"RTN","RCDPE8NZ",10,0)
 S %ZIS="QM" D ^%ZIS G:POP PRQ
"RTN","RCDPE8NZ",11,0)
 I $D(IO("Q")) D  G PRQ
"RTN","RCDPE8NZ",12,0)
 . S ZTRTN="PR^RCDPE8NZ",ZTDESC="AR - List of unlinked EFT deposit payments"
"RTN","RCDPE8NZ",13,0)
 . S ZTSAVE("RCDPPADT")=""
"RTN","RCDPE8NZ",14,0)
 . D ^%ZTLOAD
"RTN","RCDPE8NZ",15,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPE8NZ",16,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPE8NZ",17,0)
 U IO
"RTN","RCDPE8NZ",18,0)
 ;
"RTN","RCDPE8NZ",19,0)
PR ; Entrypoint for queued job
"RTN","RCDPE8NZ",20,0)
 ;
"RTN","RCDPE8NZ",21,0)
 N RCCT,RCOK,RCPG,RCEFT,RCEFT1,RCDATA,RCDATA0,RCDA,RCREC,RCSTAT,RCDT,RCTOT,RCEFTD,RCSTOP,RCRDT,X,Y,Z
"RTN","RCDPE8NZ",22,0)
 ;
"RTN","RCDPE8NZ",23,0)
 ;  get list of unlinked EFT deposit data
"RTN","RCDPE8NZ",24,0)
 K ^TMP("RCDPE8NZZ_EFT",$J) ; subscripts: dep date,EFT ien,EFT det ien
"RTN","RCDPE8NZ",25,0)
 ;  Data is FMS doc indicator^FMS doc #^FMS Doc Status
"RTN","RCDPE8NZ",26,0)
 ;    FMS doc indicator = -1:no receipt  -2:no FMS doc  1:FMS doc exists
"RTN","RCDPE8NZ",27,0)
 ;
"RTN","RCDPE8NZ",28,0)
 S (RCCT,RCSTOP)=0
"RTN","RCDPE8NZ",29,0)
 S RCEFT1="" F  S RCEFT1=$O(^RCY(344.3,"ARDEP",RCEFT1)) Q:RCEFT1=""!RCSTOP  S RCDA=0 F  S RCDA=$O(^RCY(344.3,"ARDEP",RCEFT1,RCDA)) Q:'RCDA  D  Q:RCSTOP
"RTN","RCDPE8NZ",30,0)
 . S RCDATA=$G(^RCY(344.3,RCDA,0)),RCDT=$P(RCDATA,U,7),RCTOT=0
"RTN","RCDPE8NZ",31,0)
 . Q:RCDT<RCDPPADT  ; Before date selected
"RTN","RCDPE8NZ",32,0)
 . Q:'$P(RCDATA,"^",8)  ; no payment amt
"RTN","RCDPE8NZ",33,0)
 . S RCEFT=0 F  S RCEFT=$O(^RCY(344.31,"B",RCDA,RCEFT)) Q:'RCEFT!RCSTOP  S RCDATA0=$G(^RCY(344.31,RCEFT,0)) D  Q:RCSTOP  S:RCTOT ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA)=RCTOT
"RTN","RCDPE8NZ",34,0)
 .. S RCCT=RCCT+1
"RTN","RCDPE8NZ",35,0)
 .. I '(RCCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPE8NZ",36,0)
 .. S RCREC=+$P($G(^RCY(344.4,+$P(RCDATA0,U,10),0)),U,8)
"RTN","RCDPE8NZ",37,0)
 .. S RCOK=1
"RTN","RCDPE8NZ",38,0)
 .. I 'RCREC D  Q
"RTN","RCDPE8NZ",39,0)
 ... I $P(RCDATA0,U,16)'="" Q
"RTN","RCDPE8NZ",40,0)
 ... S ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)=-1,RCTOT=RCTOT+$P(RCDATA0,U,7) S RCOK=0  ; No receipt
"RTN","RCDPE8NZ",41,0)
 .. S RCSTAT=$$FMSSTAT^RCDPUREC(RCREC)
"RTN","RCDPE8NZ",42,0)
 .. Q:$P(RCSTAT,U,2)["ACCEPTED"!($P(RCSTAT,U,2)["FINAL")!($P(RCSTAT,U,2)["ON LINE ENTRY")
"RTN","RCDPE8NZ",43,0)
 .. S RCTOT=RCTOT+$P(RCDATA0,U,7)
"RTN","RCDPE8NZ",44,0)
 .. I RCSTAT=-1 S ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)="-2^^"_$P(RCSTAT,U) Q  ; No FMS doc
"RTN","RCDPE8NZ",45,0)
 .. S ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)="1^"_$P(RCSTAT,U,1,2)
"RTN","RCDPE8NZ",46,0)
 ;
"RTN","RCDPE8NZ",47,0)
 S (RCPG,RCDT)=0,RCRDT=$$FMTE^XLFDT($$NOW^XLFDT(),2)
"RTN","RCDPE8NZ",48,0)
 F  S RCDT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",49,0)
 . I 'RCPG!(($Y+5)>IOSL) D  Q:RCSTOP
"RTN","RCDPE8NZ",50,0)
 .. D HDR(RCRDT,.RCPG,.RCSTOP)
"RTN","RCDPE8NZ",51,0)
 . E  W !
"RTN","RCDPE8NZ",52,0)
 . W ! S Z="DEPOSIT DATE: "_$$FMTE^XLFDT(RCDT,1) W ?(80-$L(Z)\2),Z,!
"RTN","RCDPE8NZ",53,0)
 . ;
"RTN","RCDPE8NZ",54,0)
 . S RCEFT1=0 F  S RCEFT1=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1)) Q:'RCEFT1  D
"RTN","RCDPE8NZ",55,0)
 .. S RCCT=RCCT+1
"RTN","RCDPE8NZ",56,0)
 .. I '(RCCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 W:$G(RCPG) !!,"TASK STOPPED BY USER!!" K ZTREQ Q
"RTN","RCDPE8NZ",57,0)
 .. S RCDATA0=$G(^RCY(344.3,RCEFT1,0))
"RTN","RCDPE8NZ",58,0)
 .. I ($Y+5)>IOSL D HDR(RCRDT,.RCPG,.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",59,0)
 .. W !,$J("",4),$E($P(RCDATA0,U,6)_$S('$$HACEFT^RCDPEU(RCEFT1):"",1:"-HAC")_$J("",10),1,10)_"  "_$E($$FMTE^XLFDT($P(RCDATA0,U,7),2)_$J("",16),1,16)_"  "_$E($J(+$P(RCDATA0,U,8),"",2)_$J("",20),1,20)
"RTN","RCDPE8NZ",60,0)
 .. W "  "_$J(+$G(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1)),"",2)
"RTN","RCDPE8NZ",61,0)
 .. ;
"RTN","RCDPE8NZ",62,0)
 .. S RCEFT=0 F  S RCEFT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1,RCEFT)) Q:'RCEFT  S RCDATA=$G(^(RCEFT)),RCEFTD=$G(^RCY(344.31,RCEFT,0)) D
"RTN","RCDPE8NZ",63,0)
 ... I ($Y+5)>IOSL D HDR(RCRDT,.RCPG,.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",64,0)
 ... W !,$J("",6)_$E($E($P(RCEFTD,U,2),1,18)_"/"_$E($P(RCEFTD,U,3),1,10)_$J("",30),1,30)_$E($P(RCEFTD,U,4)_$J("",20),1,20)_" "
"RTN","RCDPE8NZ",65,0)
 ... W $E($J(+$P(RCEFTD,U,7),"",2)_$J("",12),1,12)_" "_$S($P(RCEFTD,U,9)'="":$P($G(^RCY(344,+$P(RCEFTD,U,9),0)),U),1:"NO RECEIPT")
"RTN","RCDPE8NZ",66,0)
 ... S Z=$P(RCEFTD,U,8)
"RTN","RCDPE8NZ",67,0)
 ... W !,$J("",8)_$E($S('Z:"UNMATCHED",Z=2:"PAPER EOB",1:"MATCHED TO ERA #: "_$P(RCEFTD,U,10)_$S(Z=-1:" (TOTALS MISMATCH)",1:""))_$J("",40),1,40)_"  "
"RTN","RCDPE8NZ",68,0)
 ... W $S($P(RCDATA,U)<0:"NO FMS DOCUMENT",1:$P(RCDATA,U,2)_" - "_$P(RCDATA,U,3)),!
"RTN","RCDPE8NZ",69,0)
 ;
"RTN","RCDPE8NZ",70,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPE8NZ",71,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPE8NZ",72,0)
 G:RCSTOP PRQ
"RTN","RCDPE8NZ",73,0)
 I $E(IOST,1,2)="C-" D ASK(.RCSTOP)
"RTN","RCDPE8NZ",74,0)
 ;
"RTN","RCDPE8NZ",75,0)
PRQ K ^TMP("RCDPE8NZZ_EFT",$J)
"RTN","RCDPE8NZ",76,0)
 Q
"RTN","RCDPE8NZ",77,0)
 ;
"RTN","RCDPE8NZ",78,0)
HDR(RCRDT,RCPG,RCSTOP) ; Print header data
"RTN","RCDPE8NZ",79,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",80,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPE8NZ",81,0)
 S RCPG=RCPG+1
"RTN","RCDPE8NZ",82,0)
 W !,$S(RCDPPADT'>0:"ALL ",1:"")_"UNAPPLIED EFT PAYMENT DEPOSITS"_$S(RCDPPADT>0:" AFTER "_$$FMTE^XLFDT(RCDPPADT,2),1:""),?50,RCRDT,?70,"PAGE: ",RCPG
"RTN","RCDPE8NZ",83,0)
 W !!,"    DEPOSIT #   DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",84,0)
 W !,$E("      PAYER/ID"_$J("",36),1,36)_"TRACE #              PAYMENT AMT  RECEIPT #",!,$J("",8)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",85,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPE8NZ",86,0)
 Q
"RTN","RCDPE8NZ",87,0)
 ;
"RTN","RCDPE8NZ",88,0)
ASK(RCSTOP) ;
"RTN","RCDPE8NZ",89,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPE8NZ",90,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPE8NZ",91,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPE8NZ",92,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPE8NZ",93,0)
 Q
"RTN","RCDPE8NZ",94,0)
 ;
"RTN","RCDPEAC")
0^13^B66119126
"RTN","RCDPEAC",1,0)
RCDPEAC ;ALB/TMK - ACTIVE BILLS WITH EEOB ON FILE ;27-JAN-2004
"RTN","RCDPEAC",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEAC",3,0)
 ;
"RTN","RCDPEAC",4,0)
EN ; Entrypoint for producing the report
"RTN","RCDPEAC",5,0)
 N RCSORT,RCINS,ZTRTN,ZTDESC,ZTSAVE,ZTSK,%ZIS,POP
"RTN","RCDPEAC",6,0)
 Q:'$$SELECT(.RCINS,.RCSORT)
"RTN","RCDPEAC",7,0)
 W !
"RTN","RCDPEAC",8,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEAC",9,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEAC",10,0)
 . S ZTRTN="ENQ^RCDPEAC",ZTDESC="AR - ACTIVE BILLS WITH EEOB REPORT",ZTSAVE("RCINS")="",ZTSAVE("RCSORT")="",ZTSAVE("RCINS(")=""
"RTN","RCDPEAC",11,0)
 . D ^%ZTLOAD
"RTN","RCDPEAC",12,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEAC",13,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAC",14,0)
 U IO
"RTN","RCDPEAC",15,0)
 ;
"RTN","RCDPEAC",16,0)
ENQ ; Queued entrypoint for the report
"RTN","RCDPEAC",17,0)
 ; RCSORT and array RCINS must exist
"RTN","RCDPEAC",18,0)
 ; RCINS = "A" for all ins co, "R" for range, "S" for selected individual
"RTN","RCDPEAC",19,0)
 ;         for RCINS="R"  ("FR")=from payer name and ("TR")=to payer name
"RTN","RCDPEAC",20,0)
 ;         for RCINS="S"  ("S",INS CO IEN IN FILE 36)=""
"RTN","RCDPEAC",21,0)
 ; RCSORT = "PN" for sort by patient name followed by ;- if reverse order
"RTN","RCDPEAC",22,0)
 ;          "L4" for sort by patient SSN followed by ;- if reverse order
"RTN","RCDPEAC",23,0)
 ;
"RTN","RCDPEAC",24,0)
 N Z,Z0,RCACT,RCBILL,RCEOB,RCTOT,RCSTOP,RCNEW,RCZ,RCZ0
"RTN","RCDPEAC",25,0)
 K ^TMP($J,"RCSORT")
"RTN","RCDPEAC",26,0)
 S RCACT=+$O(^PRCA(430.3,"AC",102,0)) ; Get active status ien
"RTN","RCDPEAC",27,0)
 G:'RCACT ENOUT
"RTN","RCDPEAC",28,0)
 ;
"RTN","RCDPEAC",29,0)
 S RCBILL=0
"RTN","RCDPEAC",30,0)
 F  S RCBILL=$O(^PRCA(430,"AC",RCACT,RCBILL)) Q:RCBILL=""  I +$G(^PRCA(430,RCBILL,7))>0,$$INCLUDE(.RCINS,RCBILL),$$EEOB(RCBILL,.RCEOB) D
"RTN","RCDPEAC",31,0)
 . S (RCTOT,RCEOB)=0 F  S RCEOB=$O(RCEOB(RCEOB)) Q:'RCEOB  S RCTOT=RCTOT+$G(^IBM(361.1,RCEOB,1)),^TMP($J,"RCSORT",$$INSNM(RCBILL),$$SL1(RCSORT,RCBILL),RCBILL,+RCEOB(RCEOB),RCEOB)=""
"RTN","RCDPEAC",32,0)
 . I $O(RCEOB(0)) S ^TMP($J,"RCSORT",$$INSNM(RCBILL),$$SL1(RCSORT,RCBILL),RCBILL)=RCTOT
"RTN","RCDPEAC",33,0)
 ;
"RTN","RCDPEAC",34,0)
 S RCZ="",(RCPG,RCSTOP,RCNEW)=0
"RTN","RCDPEAC",35,0)
 F  S RCZ=$O(^TMP($J,"RCSORT",RCZ)) Q:RCZ=""!RCSTOP  S RCZ0="" S:$G(RCINS)="R"!($G(RCINS)="S") RCNEW=1 D
"RTN","RCDPEAC",36,0)
 . I RCSORT'["-" D
"RTN","RCDPEAC",37,0)
 .. S RCZ0="" F  S RCZ0=$O(^TMP($J,"RCSORT",RCZ,RCZ0)) Q:RCZ0=""!RCSTOP  D OUTPUT(RCZ,RCZ0,RCSORT,.RCSTOP,.RCINS,.RCPG,RCNEW) S RCNEW=0
"RTN","RCDPEAC",38,0)
 . I RCSORT["-" D
"RTN","RCDPEAC",39,0)
 .. S RCZ0="" F  S RCZ0=$O(^TMP($J,"RCSORT",RCZ,RCZ0),-1) Q:RCZ0=""!RCSTOP  D OUTPUT(RCZ,RCZ0,RCSORT,.RCSTOP,.RCINS,.RCPG,.RCNEW) S RCNEW=0
"RTN","RCDPEAC",40,0)
 ;
"RTN","RCDPEAC",41,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEAC",42,0)
 ;
"RTN","RCDPEAC",43,0)
ENOUT I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAC",44,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAC",45,0)
 K ^TMP($J,"RCSORT")
"RTN","RCDPEAC",46,0)
 Q
"RTN","RCDPEAC",47,0)
 ;
"RTN","RCDPEAC",48,0)
OUTPUT(RCZ,RCZ0,RCSORT,RCSTOP,RCINS,RCPG,RCNEW) ; Output the data
"RTN","RCDPEAC",49,0)
 ; RCZ, RCZ0 are the first 2 sort levels for the array
"RTN","RCDPEAC",50,0)
 ; RCINS = insurance co info array
"RTN","RCDPEAC",51,0)
 ; RCSTOP passed by ref - returned if user chooses to stop
"RTN","RCDPEAC",52,0)
 ; RCNEW = 1 if the header should be forced to print
"RTN","RCDPEAC",53,0)
 N RCZ1,RCBILL,RC399,RCPT,RC430,RC0,RCEOB,X,Y
"RTN","RCDPEAC",54,0)
 S RCBILL=0 F  S RCBILL=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL)) Q:'RCBILL!RCSTOP  S RCZ1="" F  S RCZ1=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL,RCZ1)) Q:RCZ1=""!RCSTOP  D
"RTN","RCDPEAC",55,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAC",56,0)
 . S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) S RCNEW=0
"RTN","RCDPEAC",57,0)
 . Q:RCSTOP
"RTN","RCDPEAC",58,0)
 . S RC399=$G(^DGCR(399,RCBILL,0)),RCPT=+$P(RC399,U,2),RC430=$G(^PRCA(430,RCBILL,0))
"RTN","RCDPEAC",59,0)
 . S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) Q:RCSTOP
"RTN","RCDPEAC",60,0)
 . S X=$$GET1^DIQ(430,RCBILL_",",11)
"RTN","RCDPEAC",61,0)
 . W !,$E($P(RC399,U)_$J("",8),1,8)_"  "_$E($P($G(^DPT(RCPT,0)),U)_$J("",25),1,25)_"  "_$E($P($G(^DPT(RCPT,0)),U,9)_$J("",10),1,10)_"  ",$E($$INSNM(RCBILL)_$J("",30),1,30)
"RTN","RCDPEAC",62,0)
 . W !,$J("",8)_$E($J(+$P(RC430,U,3),"",2)_$J("",13),1,13)_"  "_$E($J(+$G(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL)),"",2)_$J("",13),1,13)_"  "_$E($J(+X,"",2)_$J("",12),1,12)
"RTN","RCDPEAC",63,0)
 . I $P($G(^PRCA(430,RCBILL,6)),U,4) W "  "_$$FMTE^XLFDT($P(^PRCA(430,RCBILL,6),U,4),2)
"RTN","RCDPEAC",64,0)
 . S RCEOB=0 F  S RCEOB=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL,RCZ1,RCEOB)) Q:'RCEOB!RCSTOP  D
"RTN","RCDPEAC",65,0)
 .. S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW)
"RTN","RCDPEAC",66,0)
 .. Q:RCSTOP
"RTN","RCDPEAC",67,0)
 .. S RC0=$G(^IBM(361.1,RCEOB,0))
"RTN","RCDPEAC",68,0)
 .. S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) Q:RCSTOP
"RTN","RCDPEAC",69,0)
 .. W !,?10,$E($P(RC0,U,7)_$J("",27),1,27)_"  "_$E($$FMTE^XLFDT($P(RC0,U,5),"2D")_$J("",8),1,8)_" "_$E($$FMTE^XLFDT($P(RC0,U,6),"2D")_$J("",8),1,8)_" "_$E($S(RCZ1:$$FMTE^XLFDT(RCZ1,"2D"),1:"")_$J("",8),1,8)
"RTN","RCDPEAC",70,0)
 .. W " "_$J(+$G(^IBM(361.1,RCEOB,1)),"",2)
"RTN","RCDPEAC",71,0)
 ;
"RTN","RCDPEAC",72,0)
 Q
"RTN","RCDPEAC",73,0)
 ;
"RTN","RCDPEAC",74,0)
INCLUDE(RCINS,RCZ) ; Function returns 1 if record should be included based
"RTN","RCDPEAC",75,0)
 ; on ins co
"RTN","RCDPEAC",76,0)
 ; RCINS = array containing insurance co information
"RTN","RCDPEAC",77,0)
 ; RCZ = ien of the entry in file 430
"RTN","RCDPEAC",78,0)
 N OK,RCI,RCINM
"RTN","RCDPEAC",79,0)
 S OK=0
"RTN","RCDPEAC",80,0)
 S RCI=+$$INS(RCZ)
"RTN","RCDPEAC",81,0)
 ;
"RTN","RCDPEAC",82,0)
 I 'RCI G INCQ ; Not a third party bill
"RTN","RCDPEAC",83,0)
 ;
"RTN","RCDPEAC",84,0)
 I RCINS="A" S OK=1
"RTN","RCDPEAC",85,0)
 ;
"RTN","RCDPEAC",86,0)
 I RCINS="S"!(RCINS="R") D
"RTN","RCDPEAC",87,0)
 . I RCINS="S" S:$D(RCINS("S",RCI)) OK=1 Q
"RTN","RCDPEAC",88,0)
 . S RCINM=$$INSNM(RCZ) ; INS CO NAME
"RTN","RCDPEAC",89,0)
 . I $S(RCINM=RCINS("FR")!(RCINM]RCINS("FR")):RCINM']RCINS("TO"),1:0) S OK=1
"RTN","RCDPEAC",90,0)
 ;
"RTN","RCDPEAC",91,0)
INCQ Q OK
"RTN","RCDPEAC",92,0)
 ;
"RTN","RCDPEAC",93,0)
INSNM(RCZ) ; Returns the name of the insurance co for bill ien RCZ file 430
"RTN","RCDPEAC",94,0)
 N NM
"RTN","RCDPEAC",95,0)
 S NM=$P($G(^DIC(36,+$$INS(RCZ),0)),U)
"RTN","RCDPEAC",96,0)
 Q NM
"RTN","RCDPEAC",97,0)
 ;
"RTN","RCDPEAC",98,0)
INS(RCZ) ; Returns ien of insurance co for bill ien RCZ from file 430
"RTN","RCDPEAC",99,0)
 N RC
"RTN","RCDPEAC",100,0)
 S RC=$P($G(^PRCA(430,RCZ,0)),U,9) ;DEBTOR
"RTN","RCDPEAC",101,0)
 Q $S($P($G(^RCD(340,+RC,0)),U)'["DIC(36":"",1:+^(0))
"RTN","RCDPEAC",102,0)
 ;
"RTN","RCDPEAC",103,0)
NEWPG(RCPG,RCINS,RCNEW) ; Check for new page needed, output header
"RTN","RCDPEAC",104,0)
 ; RCINS = ins co selection criteria
"RTN","RCDPEAC",105,0)
 ; RCNEW = 1 to force new page
"RTN","RCDPEAC",106,0)
 ; Function returns 1 if user chooses to stop output
"RTN","RCDPEAC",107,0)
 I RCNEW!'RCPG!(($Y+5)>IOSL) D
"RTN","RCDPEAC",108,0)
 . D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEAC",109,0)
 . D HDR(.RCPG,.RCINS)
"RTN","RCDPEAC",110,0)
 Q RCSTOP
"RTN","RCDPEAC",111,0)
 ;
"RTN","RCDPEAC",112,0)
EEOB(RCZ,RCEOB) ; Find all non-MRA  EEOBs for bill ien RCZ
"RTN","RCDPEAC",113,0)
 ; Function returns 1 if any valid EEOBs found, 0 if none
"RTN","RCDPEAC",114,0)
 ; RCEOB(eob ien)=date posted returned for valid EEOBs found -
"RTN","RCDPEAC",115,0)
 ;                pass by reference
"RTN","RCDPEAC",116,0)
 N OK,Z
"RTN","RCDPEAC",117,0)
 K RCEOB
"RTN","RCDPEAC",118,0)
 ;
"RTN","RCDPEAC",119,0)
 S OK=0
"RTN","RCDPEAC",120,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",RCZ,Z)) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)'=1 D
"RTN","RCDPEAC",121,0)
 . N Z0,Z1,Z00
"RTN","RCDPEAC",122,0)
 . S Z0=+$O(^RCY(344.4,"ADET",Z,0)) ; ERA entry received in
"RTN","RCDPEAC",123,0)
 . S Z1=+$P($G(^RCY(344.4,Z0,0)),U,8) ; Receipt
"RTN","RCDPEAC",124,0)
 . S Z00=$P($G(^RCY(344.4,Z0,0)),U,14)
"RTN","RCDPEAC",125,0)
 . I Z1,$S(Z00=1!(Z00=2):1,1:0) S RCEOB(Z)=+$P($G(^RCY(344,Z1,0)),U,8),OK=1
"RTN","RCDPEAC",126,0)
 ;
"RTN","RCDPEAC",127,0)
 Q OK
"RTN","RCDPEAC",128,0)
 ;
"RTN","RCDPEAC",129,0)
SL1(RCSORT,RCZ) ; Function returns 1st sort level data from ien RCZ in file 430
"RTN","RCDPEAC",130,0)
 ; RCSORT = "PN" for patient name sort = "L4" for SSN last 4 sort
"RTN","RCDPEAC",131,0)
 N DAT
"RTN","RCDPEAC",132,0)
 I RCSORT="PN" S DAT=$P($G(^DPT(+$P($G(^PRCA(430,RCZ,0)),U,7),0)),U)
"RTN","RCDPEAC",133,0)
 I RCSORT="L4" S DAT=$P($G(^DPT(+$P($G(^PRCA(430,RCZ,0)),U,7),0)),U,9),DAT=$E(DAT,$L(DAT)-3,$L(DAT))
"RTN","RCDPEAC",134,0)
 Q $S($G(DAT)'="":DAT,1:" ")
"RTN","RCDPEAC",135,0)
 ;
"RTN","RCDPEAC",136,0)
SELECT(RCINS,RCSORT) ; Select insurance co and sort criteria
"RTN","RCDPEAC",137,0)
 ; Function returns values selected for RCSORT and RCINS - passed by ref
"RTN","RCDPEAC",138,0)
 N RCQUIT,DONE,DIR,X,Y
"RTN","RCDPEAC",139,0)
 S (RCQUIT,DONE)=0
"RTN","RCDPEAC",140,0)
 S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE",DIR("A")="RUN REPORT FOR (A)LL, (S)PECIFIC, OR (R)ANGE OF INSURANCE COMPANIES?: ",DIR("B")="ALL" W ! D ^DIR K DIR
"RTN","RCDPEAC",141,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",142,0)
 ;
"RTN","RCDPEAC",143,0)
 S RCINS=Y
"RTN","RCDPEAC",144,0)
 I RCINS="S" D  G:RCQUIT SELQ
"RTN","RCDPEAC",145,0)
 . W !
"RTN","RCDPEAC",146,0)
 . F  D LIST(.DIR,.RCINS) S DIR("A")="SELECT "_$S($O(RCINS("S",0)):"ANOTHER ",1:"")_"INSURANCE COMPANY"_$S($O(RCINS("S",0)):" (PRESS RETURN WHEN DONE)",1:"")_": ",DIR(0)="PAO^DIC(36,:AEMQ" D ^DIR K DIR D  Q:Y'>0
"RTN","RCDPEAC",147,0)
 .. I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",148,0)
 .. I Y>0 S RCINS("S",+Y)=""
"RTN","RCDPEAC",149,0)
 . I '$O(RCINS("S",0)) S RCQUIT=1 W !!,"NO INSURANCE COMPANIES SELECTED - NO REPORT GENERATED" S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPEAC",150,0)
 ;
"RTN","RCDPEAC",151,0)
 I RCINS="R" D  I RCQUIT W !!,"NO INSURANCE COMPANY NAME RANGE SELECTED - NO REPORT GENERATED" S DIR(0)="E" D ^DIR K DIR G SELQ
"RTN","RCDPEAC",152,0)
 . W !
"RTN","RCDPEAC",153,0)
 . S DIR("?")="ENTER 1-30 UPPERCASE CHARACTERS OF THE FIRST NAME TO INCLUDE"
"RTN","RCDPEAC",154,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="START WITH INSURANCE COMPANY NAME: " D ^DIR K DIR
"RTN","RCDPEAC",155,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",156,0)
 . S RCINS("FR")=Y
"RTN","RCDPEAC",157,0)
 . S DIR("?")="ENTER 1-30 UPPERCASE CHARACTERS OF THE LAST NAME TO INCLUDE"
"RTN","RCDPEAC",158,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="GO TO INSURANCE COMPANY NAME: ",DIR("B")=$E(RCINS("FR"),1,27)_"ZZZ"
"RTN","RCDPEAC",159,0)
 . F  W ! D ^DIR Q:$S($D(DTOUT)!$D(DUOUT):1,1:RCINS("FR")']Y)  W !,"'GO TO' NAME MUST COME AFTER 'START WITH' NAME"
"RTN","RCDPEAC",160,0)
 . K DIR
"RTN","RCDPEAC",161,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",162,0)
 . S RCINS("TO")=Y
"RTN","RCDPEAC",163,0)
 S DIR(0)="SA^P:PATIENT NAME;L:LAST 4 OF PATIENT SSN",DIR("A")="WITHIN INS CO, SORT BY (P)ATIENT NAME OR (L)AST 4 OF SSN?: ",DIR("B")="PATIENT NAME" W ! D ^DIR K DIR
"RTN","RCDPEAC",164,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",165,0)
 S RCSORT=$S(Y="P":"PN",1:"L4")
"RTN","RCDPEAC",166,0)
 S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST",DIR("A")="SORT "_$S(RCSORT="PN":"PATIENT NAME",1:"LAST 4")_" (F)IRST TO LAST OR (L)AST TO FIRST?: ",DIR("B")="FIRST TO LAST" D ^DIR K DIR
"RTN","RCDPEAC",167,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",168,0)
 I Y="L" S RCSORT=RCSORT_";-"
"RTN","RCDPEAC",169,0)
 S DONE=1
"RTN","RCDPEAC",170,0)
 ;
"RTN","RCDPEAC",171,0)
SELQ Q DONE
"RTN","RCDPEAC",172,0)
 ;
"RTN","RCDPEAC",173,0)
LIST(DIR,RCINS) ; Sets up help array for ins co selected in DIR("?")
"RTN","RCDPEAC",174,0)
 N CT,Z
"RTN","RCDPEAC",175,0)
 S CT=1
"RTN","RCDPEAC",176,0)
 I '$O(RCINS("S",0)) S DIR("?")="NO INSURANCE COMPANIES SELECTED" Q
"RTN","RCDPEAC",177,0)
 S DIR("?",1)="INSURANCE COMPANIES ALREADY SELECTED:"
"RTN","RCDPEAC",178,0)
 S Z=0 F  S Z=$O(RCINS("S",Z)) Q:'Z  S CT=CT+1,DIR("?",CT)="   "_$P($G(^DIC(36,Z,0)),U)
"RTN","RCDPEAC",179,0)
 S DIR("?")=" "
"RTN","RCDPEAC",180,0)
 Q
"RTN","RCDPEAC",181,0)
 ;
"RTN","RCDPEAC",182,0)
HDR(RCPG,RCINS) ;Print report hdr
"RTN","RCDPEAC",183,0)
 ; RCPG = last page #
"RTN","RCDPEAC",184,0)
 N Z,Z0,X
"RTN","RCDPEAC",185,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEAC",186,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEAC",187,0)
 W !,?5,"EDI LOCKBOX ACTIVE BILLS W/EEOB REPORT",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG
"RTN","RCDPEAC",188,0)
 W !!,"INSURANCE SELECTED: "_$S(RCINS="A":"ALL",RCINS="R":"RANGE FROM "_RCINS("FR")_"-"_RCINS("TO"),1:"")
"RTN","RCDPEAC",189,0)
 S Z0=""
"RTN","RCDPEAC",190,0)
 I RCINS="S" S Z=0,Z0="" F  S Z=$O(RCINS("S",Z)) Q:'Z  S X=$P($G(^DIC(36,Z,0)),U) D
"RTN","RCDPEAC",191,0)
 . I $L(Z0)+$L(X)>79 W Z0 S Z0="" W !
"RTN","RCDPEAC",192,0)
 . S Z0=Z0_$S(Z0'="":",",1:"")_X
"RTN","RCDPEAC",193,0)
 I Z0'="" W Z0
"RTN","RCDPEAC",194,0)
 W !!,"BILL #    PATIENT NAME              SSN         INS CO NAME"
"RTN","RCDPEAC",195,0)
 W !,"        AMOUNT BILLED  AMOUNT PAID    BALANCE       DT REFERRED REG COUNSEL"
"RTN","RCDPEAC",196,0)
 W !!,?10,"TRACE #"_$J("",22)_"DT REC'D DT PAID  DT POST  AMOUNT PAID"
"RTN","RCDPEAC",197,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEAC",198,0)
 Q
"RTN","RCDPEAC",199,0)
 ;
"RTN","RCDPEAC",200,0)
ASK(RCSTOP) ;
"RTN","RCDPEAC",201,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAC",202,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAC",203,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEAC",204,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAC",205,0)
 Q
"RTN","RCDPEAC",206,0)
 ;
"RTN","RCDPEM0")
0^35^B50875265
"RTN","RCDPEM0",1,0)
RCDPEM0 ;ALB/TMK - ERA MATCHING TO EFT (cont) ;05-NOV-02
"RTN","RCDPEM0",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEM0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEM0",4,0)
 Q
"RTN","RCDPEM0",5,0)
 ;
"RTN","RCDPEM0",6,0)
MATCH(RCZ,RCPROC) ; Match EFT to ERA
"RTN","RCDPEM0",7,0)
 ; RCZ = ien of file 344.31
"RTN","RCDPEM0",8,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM0",9,0)
 N RCER,RCRZ,RCMATCH,RCER,RC0,RC3444,RC34431,DIE,DA,DR,X,Y,Z,Z0
"RTN","RCDPEM0",10,0)
 ; Find ERA to match to EFT by trace, date, amt
"RTN","RCDPEM0",11,0)
 S RC34431=$G(^RCY(344.31,RCZ,0)) Q:$P(RC34431,U,8)!$O(^RCY(344,"AEFT",RCZ,0))  ; Already matched
"RTN","RCDPEM0",12,0)
 S RCRZ=0 F  S RCRZ=$O(^RCY(344.4,"ATRID",$P(RC34431,U,4),$P(RC34431,U,3),RCRZ)) Q:'RCRZ  S RC3444=$G(^RCY(344.4,RCRZ,0)) I '$O(^RCY(344.31,"AERA",RCRZ,0)),'$P(RC3444,U,9) D  Q:$D(Z(1))
"RTN","RCDPEM0",13,0)
 . S Z($S(+$P(RC34431,U,7)=+$P(RC3444,U,5):1,1:-1),RCRZ)="" ;Total match?
"RTN","RCDPEM0",14,0)
 ;
"RTN","RCDPEM0",15,0)
 S RCMATCH=+$O(Z(""),-1),RCRZ=+$O(Z(RCMATCH,0))
"RTN","RCDPEM0",16,0)
 S $P(^TMP($J,"RCDPETOT",344.31,RCZ),U)=RCMATCH
"RTN","RCDPEM0",17,0)
 ;
"RTN","RCDPEM0",18,0)
 I 'RCMATCH D  Q  ; Match failure
"RTN","RCDPEM0",19,0)
 . S ^TMP($J,"RCTOT","NO_MATCH")=$G(^TMP($J,"RCTOT","NO_MATCH"))+1
"RTN","RCDPEM0",20,0)
 ;
"RTN","RCDPEM0",21,0)
 I RCMATCH<0 D
"RTN","RCDPEM0",22,0)
 . ; Bulletin for totals don't match warning
"RTN","RCDPEM0",23,0)
 . S ^TMP($J,"RCTOT","TOTMIS")=$G(^TMP($J,"RCTOT","TOTMIS"))+1
"RTN","RCDPEM0",24,0)
 . N XMSUBJ,XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,XMZ,XMERR,RCER,RCT,RCM,RCLESS
"RTN","RCDPEM0",25,0)
 . S RCT=0
"RTN","RCDPEM0",26,0)
 . D BLD^RCDPEM1("RCER",.RCT,344.31,RC34431)
"RTN","RCDPEM0",27,0)
 . S RCT=RCT+1,RCER(RCT)=""
"RTN","RCDPEM0",28,0)
 . K RCM S RCM=RCT
"RTN","RCDPEM0",29,0)
 . S RCLESS=($P(RC34431,U,7)<$P($G(^RCY(344.4,RCRZ,0)),U,5))
"RTN","RCDPEM0",30,0)
 . S RCT=RCT+1,RCER(RCT)="  TOTALS ON ERA AND EFT DON'T MATCH.",RCT=RCT+1,RCER(RCT)="  EFT TOTAL IS "_$S(RCLESS:"LESS",1:"GREATER")_" THAN ERA AMOUNT TOTAL"
"RTN","RCDPEM0",31,0)
 . I RCLESS D
"RTN","RCDPEM0",32,0)
 .. S RCT=RCT+1,RCER(RCT)="  DECREASE ADJUSTMENT IS NEEDED BEFORE THE ERA RECEIPT CAN BE PROCESSED."
"RTN","RCDPEM0",33,0)
 . I 'RCLESS D
"RTN","RCDPEM0",34,0)
 .. S RCT=RCT+1,RCER(RCT)="  A SUSPENSE LINE IS NEEDED ON THE RECEIPT TO ACCOUNT FOR THE DIFFERENCE."
"RTN","RCDPEM0",35,0)
 . S RCT=RCT+1,RCER(RCT)="  IF YOU USE THE ERA WORKLIST SCRATCH PAD, THIS WILL BE GENERATED FOR YOU."
"RTN","RCDPEM0",36,0)
 . ;
"RTN","RCDPEM0",37,0)
 . S RCT=RCT+1,RCER(RCT)="  EFT WAS MATCHED TO ERA ENTRY #: "_RCRZ_" ($"_$J(+$P($G(^RCY(344.4,RCRZ,0)),U,5),"",2)_")."
"RTN","RCDPEM0",38,0)
 . S XMTO("I:G.RCDPE PAYMENTS")=""
"RTN","RCDPEM0",39,0)
 . S XMBODY="RCER"
"RTN","RCDPEM0",40,0)
 . S XMSUBJ="EDI LBOX TOTALS MISMATCH ON EFT-ERA MATCH"
"RTN","RCDPEM0",41,0)
 . D
"RTN","RCDPEM0",42,0)
 .. N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEM0",43,0)
 .. D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEM0",44,0)
 . ; Update log
"RTN","RCDPEM0",45,0)
 . F  S RCM=$O(RCER(RCM)) Q:'RCM  S RCT=RCT+1,RCM(RCT)=RCER(RCM)
"RTN","RCDPEM0",46,0)
 . D STORERR(344.31,RCZ,.RCM)
"RTN","RCDPEM0",47,0)
 ;
"RTN","RCDPEM0",48,0)
 I RCMATCH D
"RTN","RCDPEM0",49,0)
 . S DIE="^RCY(344.31,",DA=RCZ,DR=".08////"_RCMATCH_";.1////"_RCRZ D ^DIE
"RTN","RCDPEM0",50,0)
 . S DIE="^RCY(344.4,",DA=RCRZ,DR=".09////"_RCMATCH D ^DIE
"RTN","RCDPEM0",51,0)
 . S ^TMP($J,"RCTOT","MATCH")=$G(^TMP($J,"RCTOT","MATCH"))+1
"RTN","RCDPEM0",52,0)
 ;
"RTN","RCDPEM0",53,0)
 Q
"RTN","RCDPEM0",54,0)
 ;
"RTN","RCDPEM0",55,0)
ADDDEP(RCD,RCDDT,RCZ) ; Add deposit
"RTN","RCDPEM0",56,0)
 ; RCD = deposit #
"RTN","RCDPEM0",57,0)
 ; RCDDT = deposit date FM format
"RTN","RCDPEM0",58,0)
 ; RCZ = ien of entry in file 344.3
"RTN","RCDPEM0",59,0)
 ; Function returns IEN of new deposit entry
"RTN","RCDPEM0",60,0)
 ;
"RTN","RCDPEM0",61,0)
 N RCDEP,RC0,DIE,DR,DA,X,Y
"RTN","RCDPEM0",62,0)
 S RCDEP=+$$ADDDEPT^RCDPUDEP(RCD,RCDDT)
"RTN","RCDPEM0",63,0)
 I RCDEP D
"RTN","RCDPEM0",64,0)
 . D LOCKDEP^RCDPEM(RCDEP,1)
"RTN","RCDPEM0",65,0)
 . S RC0=$G(^RCY(344.3,RCZ,0))
"RTN","RCDPEM0",66,0)
 . S DIE="^RCY(344.1,",DA=RCDEP,DR=".04////"_+$P(RC0,U,8)_$S($P(RC0,U,4)'="":";.05////"_$P(RC0,U,4),1:"")  D ^DIE
"RTN","RCDPEM0",67,0)
 . S DIE="^RCY(344.3,",DR=".03////"_RCDEP,DA=RCZ D ^DIE
"RTN","RCDPEM0",68,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,5)=RCDEP
"RTN","RCDPEM0",69,0)
 Q RCDEP
"RTN","RCDPEM0",70,0)
 ;
"RTN","RCDPEM0",71,0)
ADDREC(RCDEP,RCZ) ; Add receipt, send CR to FUND 5287.4, Rev src cd 8NZZ
"RTN","RCDPEM0",72,0)
 ;   for total EFT amt
"RTN","RCDPEM0",73,0)
 ; RCDEP = ien of the deposit file entry
"RTN","RCDPEM0",74,0)
 ; RCZ = ien in file 344.3
"RTN","RCDPEM0",75,0)
 ; Function returns IEN of new receipt entry
"RTN","RCDPEM0",76,0)
 ;
"RTN","RCDPEM0",77,0)
 N RCER,RCTRANDA,RECTDA,RCQUIT,RCDPDATA,RCTOTCT,RC0,DIE,DA,DR,X,Y
"RTN","RCDPEM0",78,0)
 S RC0=$G(^RCY(344.3,RCZ,0))
"RTN","RCDPEM0",79,0)
 S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,3)=0
"RTN","RCDPEM0",80,0)
 ; Single receipt - multiple transactions for EFT payments
"RTN","RCDPEM0",81,0)
 S RECTDA=+$$ADDRECT^RCDPUREC($P(RC0,U,7),RCDEP,+$O(^RC(341.1,"AC",14,0)))
"RTN","RCDPEM0",82,0)
 ; Create detail lines for deposit amount, process whole receipt to send
"RTN","RCDPEM0",83,0)
 ;   CR document for deposit amount
"RTN","RCDPEM0",84,0)
 I RECTDA D
"RTN","RCDPEM0",85,0)
 . N STATUS,RC00,RCT
"RTN","RCDPEM0",86,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U)=RECTDA,^TMP($J,"RCTOT","EFT_RECPT")=$G(^TMP($J,"RCTOT","EFT_RECPT"))+1
"RTN","RCDPEM0",87,0)
 . L +^RCY(344,RECTDA)
"RTN","RCDPEM0",88,0)
 . ;  check to see if receipt has been processed (fms document)
"RTN","RCDPEM0",89,0)
 . D DIQ344^RCDPRPLM(RECTDA,"200;")
"RTN","RCDPEM0",90,0)
 . ;  code sheet already sent once, this is a retransmission, check it
"RTN","RCDPEM0",91,0)
 . I RCDPDATA(344,RECTDA,200,"E")'="" S RCQUIT=0 D  Q:RCQUIT
"RTN","RCDPEM0",92,0)
 .. S STATUS=$$STATUS^GECSSGET(RCDPDATA(344,RECTDA,200,"E"))
"RTN","RCDPEM0",93,0)
 .. ;  okay to continue if status is Error, Rejected, or not defined (-1)
"RTN","RCDPEM0",94,0)
 .. I $E(STATUS)="E"!($E(STATUS)="R")!(STATUS=-1) Q
"RTN","RCDPEM0",95,0)
 .. S RCER(1)=$$SETERR(2),RCER(2)="  Receipt already sent to FMS - No change"
"RTN","RCDPEM0",96,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",97,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",98,0)
 .. D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",99,0)
 .. L -^RCY(344,RECTDA)
"RTN","RCDPEM0",100,0)
 .. L -^RCY(344.1,RCDEP)
"RTN","RCDPEM0",101,0)
 .. S RCQUIT=1 K RCER
"RTN","RCDPEM0",102,0)
 . ;  mark receipt as processed (closed) to prevent editing
"RTN","RCDPEM0",103,0)
 . D MARKPROC^RCDPUREC(RECTDA,"")
"RTN","RCDPEM0",104,0)
 . S DIE="^RCY(344,",DR=".04////"_+$O(^RC(341.1,"AC",14,0)),DA=RECTDA D ^DIE ; Add EDI Lockbox payment type
"RTN","RCDPEM0",105,0)
 . ;
"RTN","RCDPEM0",106,0)
 . ; Add receipt line for each payer's EFT
"RTN","RCDPEM0",107,0)
 . S RCT=0 F  S RCT=$O(^RCY(344.31,"B",RCZ,RCT)) Q:'RCT  D  Q:$O(RCER(0))
"RTN","RCDPEM0",108,0)
 .. S RC00=$G(^RCY(344.31,RCT,0)),DR=""
"RTN","RCDPEM0",109,0)
 .. S RCTRANDA=$S('$P(RC00,U,14):$$ADDTRAN^RCDPURET(RECTDA),1:$P(RC00,U,14)) ; detail line
"RTN","RCDPEM0",110,0)
 .. I 'RCTRANDA D  Q
"RTN","RCDPEM0",111,0)
 ... S RCER(1)=$$SETERR(2),RCER(2)="  The receipt for the EFT deposit was not created correctly",RCER(3)="  You may have to add the detail manually to send the FMS CR doc to revenue"
"RTN","RCDPEM0",112,0)
 ... S RCER(4)="  source code 8NZZ in fund 5287.4.  Receipt # is "_$P($G(^RCY(344,RECTDA,0)),U),RCER(5)="  Trace # being processed at time of error was: "_$P(RC00,U,4)_"."
"RTN","RCDPEM0",113,0)
 ... D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",114,0)
 ... S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",115,0)
 ... D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",116,0)
 .. ;
"RTN","RCDPEM0",117,0)
 .. S DR=DR_";1.02////Auto added EDI Lockbox deposit;.06////"_$P(RC00,U,12)_";.04////"_$J(+$P(RC00,U,7),"",2)_";.14////"_RCTRANDA
"RTN","RCDPEM0",118,0)
 .. N N S N=+$O(^VA(200,"B","EDILOCKBOX,AUTOMATIC",0)) S:N=0 N=.5
"RTN","RCDPEM0",119,0)
 .. S DR=DR_";.12////"_N
"RTN","RCDPEM0",120,0)
 .. S DA(1)=RECTDA,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEM0",121,0)
 .. S:$E(DR)=";" DR=$P(DR,";",2,999) D ^DIE
"RTN","RCDPEM0",122,0)
 .. S DR=".14////"_RCTRANDA_";.09////"_RECTDA,DIE="^RCY(344.31,",DA=RCT D ^DIE
"RTN","RCDPEM0",123,0)
 .. ;
"RTN","RCDPEM0",124,0)
 . ;Post to FUND 5287.4/RSC 8NZZ
"RTN","RCDPEM0",125,0)
 . D PROCESS^RCDPURE1(RECTDA,2)
"RTN","RCDPEM0",126,0)
 . ;Save details for status report
"RTN","RCDPEM0",127,0)
 . N Z,TOT
"RTN","RCDPEM0",128,0)
 . S (TOT,Z)=0 F  S Z=$O(^RCY(344,RECTDA,1,Z)) Q:'Z  S TOT=TOT+$P($G(^RCY(344,RECTDA,1,Z,0)),U,4)
"RTN","RCDPEM0",129,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,2)=TOT
"RTN","RCDPEM0",130,0)
 . ;
"RTN","RCDPEM0",131,0)
 . I $P($G(^RCY(344,RECTDA,2)),U)="" D  ; Receipt not processed fully
"RTN","RCDPEM0",132,0)
 .. N CT,Z
"RTN","RCDPEM0",133,0)
 .. S RCER(1)=$$SETERR(2),RCER(2)="  The receipt "_$P($G(^RCY(344,RECTDA,0)),U)_" for the EFT deposit was not processed fully" S:TOT RCER(3)="  You must manually process it to create the FMS CR doc to rev src code 8NZZ"
"RTN","RCDPEM0",134,0)
 .. S Z=0,CT=+$O(RCER(" "),-1) F  S Z=$O(^TMP($J,"RCDPEMSG",Z)) Q:'Z  S CT=CT+1,RCER(CT)=$G(^TMP($J,"RCDPEMSG",Z))
"RTN","RCDPEM0",135,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",136,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",137,0)
 .. D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",138,0)
 . ;
"RTN","RCDPEM0",139,0)
 . S DIE="^RCY(344.3,",DR=".11////^S X=DT;.12////"_$J(+TOT,"",2),DA=RCZ D ^DIE
"RTN","RCDPEM0",140,0)
 . S ^TMP($J,"RCTOT","SUSPAMT")=$G(^TMP($J,"RCTOT","SUSPAMT"))+TOT
"RTN","RCDPEM0",141,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,3)="1"
"RTN","RCDPEM0",142,0)
 ;
"RTN","RCDPEM0",143,0)
 I RECTDA L -^RCY(344,RECTDA)
"RTN","RCDPEM0",144,0)
 Q RECTDA
"RTN","RCDPEM0",145,0)
 ;
"RTN","RCDPEM0",146,0)
SETERR(RCPROC) ; Set up first line of error message to be stored
"RTN","RCDPEM0",147,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM0",148,0)
 ;        =2 if called from EFT deposit creation
"RTN","RCDPEM0",149,0)
 N LINE1
"RTN","RCDPEM0",150,0)
 I RCPROC S LINE1=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" - PROCESS TO "_$S(RCPROC=1:"CREATE RECEIPT FROM ERA",1:"SEND EFT DEPOSIT TO FMS")
"RTN","RCDPEM0",151,0)
 Q LINE1
"RTN","RCDPEM0",152,0)
 ;
"RTN","RCDPEM0",153,0)
STORERR(RCFILE,RCZ,RCER) ; Store error text in word processing field
"RTN","RCDPEM0",154,0)
 ; RCFILE = 344.3 or 344.31
"RTN","RCDPEM0",155,0)
 ; RCZ = ien of the entry in file RCFILE
"RTN","RCDPEM0",156,0)
 ; RCER = array containing the error text (passed by ref)
"RTN","RCDPEM0",157,0)
 D WP^DIE(RCFILE,RCZ_",",2,"A","RCER")
"RTN","RCDPEM0",158,0)
 Q
"RTN","RCDPEM0",159,0)
 ;
"RTN","RCDPEM2")
0^29^B62281734
"RTN","RCDPEM2",1,0)
RCDPEM2 ;ALB/TMK - MANUAL ERA AND EFT MATCHING ;05-NOV-02
"RTN","RCDPEM2",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEM2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEM2",4,0)
 Q
"RTN","RCDPEM2",5,0)
MATCH1 ; Manually 'match' an ERA to an EFT
"RTN","RCDPEM2",6,0)
 N DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCERA,RCNAME,RCMATCH,RCQUIT,DUOUT,DTOUT
"RTN","RCDPEM2",7,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MATCH AN EFT DETAIL RECORD",!,"WITH AN ERA RECORD"
"RTN","RCDPEM2",8,0)
M1 S DIR("A")="SELECT THE UNMATCHED EFT TO MATCH TO AN ERA: "
"RTN","RCDPEM2",9,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8)"
"RTN","RCDPEM2",10,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",11,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",12,0)
 S RCEFT=+Y,RCEFT(0)=$G(^RCY(344.31,+Y,0))
"RTN","RCDPEM2",13,0)
 W !
"RTN","RCDPEM2",14,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",15,0)
 W !
"RTN","RCDPEM2",16,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MATCH?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",17,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",18,0)
 I Y'=1 G M1
"RTN","RCDPEM2",19,0)
M12 S DIR("A")="SELECT THE UNMATCHED ERA TO MATCH TO EFT #"_RCEFT_": "
"RTN","RCDPEM2",20,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,8)"
"RTN","RCDPEM2",21,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",22,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",23,0)
 S RCERA=+Y,RCERA(0)=$G(^RCY(344.4,+Y,0))
"RTN","RCDPEM2",24,0)
 W !
"RTN","RCDPEM2",25,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",26,0)
 W !
"RTN","RCDPEM2",27,0)
 S DIR("A")="ARE YOU SURE THIS IS THE CORRECT ERA TO MATCH TO?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",28,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",29,0)
 I Y'=1 G M12
"RTN","RCDPEM2",30,0)
 S RCMATCH=(+$P(RCERA(0),U,5)=+$P(RCEFT(0),U,7))
"RTN","RCDPEM2",31,0)
 S RCNAME=($P(RCERA(0),U,6)=$P(RCEFT(0),U,2))
"RTN","RCDPEM2",32,0)
 I 'RCMATCH!'RCNAME D  G:RCQUIT M1Q
"RTN","RCDPEM2",33,0)
 . N Z
"RTN","RCDPEM2",34,0)
 . S RCQUIT=0,Z=1
"RTN","RCDPEM2",35,0)
 . S DIR("A",1)="***WARNING***"
"RTN","RCDPEM2",36,0)
 . I 'RCNAME S Z=Z+1,DIR("A",Z)=$J("",3)_"> The payer names on these two records do not agree"
"RTN","RCDPEM2",37,0)
 . I 'RCMATCH S Z=Z+1,DIR("A",Z)=$J("",3)_"> The amount of payment on these two records do not agree"
"RTN","RCDPEM2",38,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A")="ARE YOU SURE YOU WANT TO MATCH THESE 2 RECORDS?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",39,0)
 . I $S($D(DUOUT)!$D(DTOUT):1,Y'=1:1,1:0) S RCQUIT=1 Q
"RTN","RCDPEM2",40,0)
 S DIE="^RCY(344.4,",DR=".09////1",DA=RCERA D ^DIE
"RTN","RCDPEM2",41,0)
 I '$D(Y) S DIE="^RCY(344.31,",DR=".08////1;.1////"_RCERA,DA=RCEFT D ^DIE
"RTN","RCDPEM2",42,0)
 S DIR(0)="EA",DIR("A",1)="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MATCHED TO ERA #"_RCERA,DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR K DIR
"RTN","RCDPEM2",43,0)
M1Q Q
"RTN","RCDPEM2",44,0)
 ;
"RTN","RCDPEM2",45,0)
MATCH2 ; Manually 'match' a 0-balance EFT to a paper EOB
"RTN","RCDPEM2",46,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCRCPT
"RTN","RCDPEM2",47,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE EFT DETAIL RECORD",!,"AS MATCHED TO A PAPER EOB"
"RTN","RCDPEM2",48,0)
M2 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE EFT TO MARK AS MATCHED TO PAPER EOB: "
"RTN","RCDPEM2",49,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8),'$P(^(0),U,7)"
"RTN","RCDPEM2",50,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",51,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M2Q
"RTN","RCDPEM2",52,0)
 S RCEFT=+Y
"RTN","RCDPEM2",53,0)
 W !
"RTN","RCDPEM2",54,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",55,0)
 W !
"RTN","RCDPEM2",56,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MARK AS MATCHED?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",57,0)
 I $D(DUOUT)!$D(DTOUT) G M2Q
"RTN","RCDPEM2",58,0)
 I Y'=1 G M2
"RTN","RCDPEM2",59,0)
 S DIE="^RCY(344.31,",DR=".08////2",DA=RCEFT D ^DIE
"RTN","RCDPEM2",60,0)
 S DIR(0)="EA",DIR("A")="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCHED TO PAPER EOB" D ^DIR K DIR
"RTN","RCDPEM2",61,0)
M2Q Q
"RTN","RCDPEM2",62,0)
 ;
"RTN","RCDPEM2",63,0)
MANTR ; Mark an EFT detail record as 'TR' posted manually
"RTN","RCDPEM2",64,0)
 N DA,DR,DIC,DIE,DIR,X,Y,RCEFT,DUOUT,DTOUT,RCZ0,RCTR,RCHOW
"RTN","RCDPEM2",65,0)
 ; EFT detail cannot be associated with a receipt or TR document
"RTN","RCDPEM2",66,0)
 ;
"RTN","RCDPEM2",67,0)
 W !,"*****",!," YOU SHOULD ONLY USE THIS OPTION IF YOU HAVE AN EFT DETAIL RECORD ON YOUR",!," UNAPPLIED DEPOSIT REPORT WHOSE DETAIL WAS ENTERED ON LINE VIA A TR DOCUMENT",!,"*****",!
"RTN","RCDPEM2",68,0)
 S DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,16)="""",$P(^(0),U,11)",DIC("A")="SELECT THE EFT DETAIL WHOSE 'TR' DOC WAS MANUALLY ENTERED ON LINE: ",DIC="^RCY(344.31,"
"RTN","RCDPEM2",69,0)
 W ! D ^DIC K DIC
"RTN","RCDPEM2",70,0)
 I Y'>0 G MANTRQ
"RTN","RCDPEM2",71,0)
 S RCEFT=+Y,RCZ0=$G(^RCY(344.31,RCEFT,0))
"RTN","RCDPEM2",72,0)
 S DIR(0)="FA^2:30^K:X'?1""TR"".E X",DIR("A")="ENTER THE TR DOC # THAT WAS ENTERED ON-LINE FOR THE EFT DETAIL: "
"RTN","RCDPEM2",73,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",74,0)
 I $D(DTOUT)!$D(DUOUT) G MANTRQ
"RTN","RCDPEM2",75,0)
 S RCTR=Y,DR=""
"RTN","RCDPEM2",76,0)
 ;
"RTN","RCDPEM2",77,0)
 I '$P(RCZ0,U,8) D  G:RCQUIT MANTRQ  ;Unmatched
"RTN","RCDPEM2",78,0)
 . S DIR(0)="SA^E:ELECTRONIC ERA;P:PAPER EOB",DIR("A")="WAS THE EFT DETAIL RECEIVED BY (E)RA or (P)APER EOB?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",79,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEM2",80,0)
 . S RCHOW=Y,DR=""
"RTN","RCDPEM2",81,0)
 . I RCHOW="E" D
"RTN","RCDPEM2",82,0)
 .. S DR=";.09R;.08////1"
"RTN","RCDPEM2",83,0)
 . I RCHOW="P" D
"RTN","RCDPEM2",84,0)
 .. S DR=";.08////2"
"RTN","RCDPEM2",85,0)
 ;
"RTN","RCDPEM2",86,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="THIS WILL MARK EFT DETAIL #: "_RCEFT_" AS MANUALLY POSTED",DIR("A",2)="  USING TR DOC: "_RCTR
"RTN","RCDPEM2",87,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",88,0)
 I Y'=1 D  G MANTRQ
"RTN","RCDPEM2",89,0)
 . S DIR(0)="EA",DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEM2",90,0)
 S DIE="^RCY(344.31,",DA=RCEFT,DR=".16R"_DR D ^DIE
"RTN","RCDPEM2",91,0)
 I $D(Y) D
"RTN","RCDPEM2",92,0)
 . S DIE="^RCY(344.31,",DA=RCEFT,DR=".16///@;.08///"_$S($P(RCZ0,U,8)'="":$P(RCZ0,U,8),1:"@") D ^DIE
"RTN","RCDPEM2",93,0)
 . S DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE"
"RTN","RCDPEM2",94,0)
 E  D
"RTN","RCDPEM2",95,0)
 . S DIR("A")="STATUS UPDATED FOR EFT DETAIL #: "_RCEFT_" - PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",96,0)
 S DIR(0)="EA"
"RTN","RCDPEM2",97,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",98,0)
 ;
"RTN","RCDPEM2",99,0)
MANTRQ Q
"RTN","RCDPEM2",100,0)
 ;
"RTN","RCDPEM2",101,0)
CHK() ; Function returns the ien of CHECK/MO payment type
"RTN","RCDPEM2",102,0)
 Q +$O(^RC(341.1,"AC",4,0))
"RTN","RCDPEM2",103,0)
 ;
"RTN","RCDPEM2",104,0)
POSTED ; Mark an ERA as posted when the data was previously posted using
"RTN","RCDPEM2",105,0)
 ; paper EOB information
"RTN","RCDPEM2",106,0)
 N DIC,DIE,DIR,DA,DR,X,Y
"RTN","RCDPEM2",107,0)
 ; Must be unmatched or matched to paper check, must not already have a receipt, must not be posted yet
"RTN","RCDPEM2",108,0)
 W !!,"THIS OPTION IS USED WHEN YOU HAVE POSTED AN ERA PAID WITH A PAPER CHECK",!,"BY USING THE PAPER EOB AND YOU DID NOT REFERENCE THE ERA IN THE RECEIPT",!!
"RTN","RCDPEM2",109,0)
 S DIC("S")="I ""02""[+$P(^(0),U,9),$S('$P(^(0),U,8):1,1:'$P(^(0),U,5)),$P(^(0),U,14)=0",DIC="^RCY(344.4,",DIC(0)="AEMQ"
"RTN","RCDPEM2",110,0)
 D ^DIC K DIC
"RTN","RCDPEM2",111,0)
 ;
"RTN","RCDPEM2",112,0)
 I Y'>0 G POSTEDQ
"RTN","RCDPEM2",113,0)
 ;
"RTN","RCDPEM2",114,0)
 S DIE="^RCY(344.4,",DR=".08R;.09////2;.14////2;20.03////1",DA=+Y D ^DIE
"RTN","RCDPEM2",115,0)
 I '$D(Y) D
"RTN","RCDPEM2",116,0)
 . S DIR(0)="EA",DIR("A",1)="ERA HAS BEEN MARKED AS POSTED USING PAPER EOB",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEM2",117,0)
 ;
"RTN","RCDPEM2",118,0)
POSTEDQ Q
"RTN","RCDPEM2",119,0)
 ;
"RTN","RCDPEM2",120,0)
MATCH3 ; Manually 'match' a 0-balance ERA that has no check or EFT
"RTN","RCDPEM2",121,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCERA,RCRCPT
"RTN","RCDPEM2",122,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE ERA WITH NO",!,"CHECK OR EFT AS 'MATCH-0 PAYMENT' TO REMOVE IT FROM THE ERA AGING REPORT"
"RTN","RCDPEM2",123,0)
M3 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE ERA TO MARK AS MATCHED: "
"RTN","RCDPEM2",124,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,5)"
"RTN","RCDPEM2",125,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",126,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M3Q
"RTN","RCDPEM2",127,0)
 S RCERA=+Y
"RTN","RCDPEM2",128,0)
 W !
"RTN","RCDPEM2",129,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",130,0)
 W !
"RTN","RCDPEM2",131,0)
 S DIR("A")="ARE YOU SURE THIS IS THE ERA YOU WANT TO MARK AS MATCH-0 PAYMENT?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",132,0)
 I $D(DUOUT)!$D(DTOUT) G M3Q
"RTN","RCDPEM2",133,0)
 I Y'=1 G M3
"RTN","RCDPEM2",134,0)
 S DIE="^RCY(344.4,",DR=".09////3",DA=RCERA D ^DIE
"RTN","RCDPEM2",135,0)
 S DIR(0)="EA",DIR("A")="ERA #"_RCERA_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCH-0 PAYMENT" D ^DIR K DIR
"RTN","RCDPEM2",136,0)
M3Q Q
"RTN","RCDPEM2",137,0)
 ;
"RTN","RCDPEM2",138,0)
UNMATCH ; Used to 'unmatch' an ERA matched in error
"RTN","RCDPEM2",139,0)
 N X,Y,DIR,DIC,DIE,DIK,DA,DR,RCWL,RCEFT,RCQUIT
"RTN","RCDPEM2",140,0)
 S DIC(0)="AEMQ",DIC="^RCY(344.4,",DIC("S")="I '$P(^(0),U,8),$S('$P(^(0),U,14):1,1:$P(^(0),U,9)=3),$P(^(0),U,9)" D ^DIC K DIC
"RTN","RCDPEM2",141,0)
 Q:Y'>0
"RTN","RCDPEM2",142,0)
 S RCWL=+Y,RCQUIT=0
"RTN","RCDPEM2",143,0)
 I $D(^RCY(344.49,RCWL,0)) D  Q:RCQUIT
"RTN","RCDPEM2",144,0)
 . S DIR(0)="YA",DIR("A",1)="THIS ERA ALREADY HAS A WORKLIST ENTRY AND MUST BE DELETED BEFORE IT CAN BE UNMATCHED",DIR("A")="DO YOU WANT TO DELETE THE WORKLIST ENTRY FOR THIS ERA NOW?: "
"RTN","RCDPEM2",145,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",146,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",147,0)
 . S DIK="^RCY(344.49,",DA=RCWL D ^DIK
"RTN","RCDPEM2",148,0)
 I $O(^RCY(344.31,"AERA",RCWL,0)) S RCEFT=+$O(^(0)) D  Q:RCQUIT
"RTN","RCDPEM2",149,0)
 . S DIR("A",1)="THIS ERA IS MATCHED TO EFT #"_RCEFT,DIR("A")="ARE YOU SURE YOU WANT TO UNMATCH THEM?: ",DIR(0)="YA"
"RTN","RCDPEM2",150,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",151,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",152,0)
 . S DIE="^RCY(344.31,",DR=".1///@;.08////0",DA=RCEFT D ^DIE
"RTN","RCDPEM2",153,0)
 . W !,"EFT #"_RCEFT_" IS NOW UNMATCHED",!
"RTN","RCDPEM2",154,0)
 S DIE="^RCY(344.4,",DR=".09////0;.13///@;.14////0",DA=RCWL D ^DIE
"RTN","RCDPEM2",155,0)
 S DIR("A")="ERA HAS BEEN SUCCESSFULLY UNMATCHED - PRESS RETURN TO CONTINUE "
"RTN","RCDPEM2",156,0)
 S DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEM2",157,0)
 Q
"RTN","RCDPEM2",158,0)
 ;
"RTN","RCDPEM2",159,0)
RETN ; Entrypoint for returned ERA
"RTN","RCDPEM2",160,0)
 N DIR,X,Y,DTOUT,DUOUT,DIC,RCY,DIE,DA,DR
"RTN","RCDPEM2",161,0)
 W !!,"USE THIS OPTION ONLY IF YOU HAVE A PAPER CHECK THAT HAS BEEN RETURNED TO",!,"THE PAYER WITHOUT BEING DEPOSITED AND YOU WANT TO MARK THE CORRESPONDING",!,"ERA AS NOT POSTED/RETURNED TO PAYER",!
"RTN","RCDPEM2",162,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ",DIC("S")="I $S($P(^(0),U,9)=0!($P(^(0),U,9)=2):1,1:0),'$P(^(0),U,14)" D ^DIC
"RTN","RCDPEM2",163,0)
 Q:Y'>0
"RTN","RCDPEM2",164,0)
 S RCY=+Y
"RTN","RCDPEM2",165,0)
 S DIR(0)="YA",DIR("A",1)="THIS WILL MARK THE ERA # "_+Y_" AS RETURNED TO PAYER/NOT POSTED",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",166,0)
 I $D(DTOUT)!$D(DUOUT)!Y=0 D
"RTN","RCDPEM2",167,0)
 . S DIR("A",1)="NO CHANGES MADE TO ERA # "_RCY
"RTN","RCDPEM2",168,0)
 E  D
"RTN","RCDPEM2",169,0)
 . S DIR("A",1)="ERA # "_RCY_" HAS BEEN MARKED AS RETURNED TO PAYER/NOT POSTED"
"RTN","RCDPEM2",170,0)
 . S DIE="^RCY(344.4,",DR=".14////4;.09////2",DA=RCY D ^DIE
"RTN","RCDPEM2",171,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",172,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",173,0)
 Q
"RTN","RCDPEM2",174,0)
 ;
"RTN","RCDPEREC")
0^31^B37254915
"RTN","RCDPEREC",1,0)
RCDPEREC ;ALB/TMK - RECONCILIATION REPORT FOR EDI LOCKBOX FMS DOCS  ;19-APR-2004
"RTN","RCDPEREC",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEREC",3,0)
 ;
"RTN","RCDPEREC",4,0)
EN ; Entrypoint for producing the report
"RTN","RCDPEREC",5,0)
 N RCDDT,RCSEL,ZTRTN,ZTDESC,ZTSAVE,ZTSK,%ZIS,POP,DIR,DTOUT,DUOUT
"RTN","RCDPEREC",6,0)
 S DIR(0)="DA^3000101:"_DT_":AEPX",DIR("A")="SELECT THE EFT DEPOSIT DATE TO START WITH: " W ! D ^DIR K DIR
"RTN","RCDPEREC",7,0)
 S RCDDT=$S($D(DTOUT)!$D(DUOUT):"",1:Y)
"RTN","RCDPEREC",8,0)
 Q:'RCDDT
"RTN","RCDPEREC",9,0)
 S DIR("B")="ALL"
"RTN","RCDPEREC",10,0)
 S DIR(0)="SA^A:ALL;N:NOT FULLY TRANSFERRED",DIR("A")="DO YOU WANT (A)LL DEPOSITS OR ONLY THOSE (N)OT FULLY TRANSFERRED?: " W ! D ^DIR K DIR
"RTN","RCDPEREC",11,0)
 S RCSEL=$S($D(DTOUT)!$D(DUOUT):"",1:Y)
"RTN","RCDPEREC",12,0)
 Q:RCSEL=""
"RTN","RCDPEREC",13,0)
 W !
"RTN","RCDPEREC",14,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEREC",15,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEREC",16,0)
 . S ZTRTN="ENQUE^RCDPEREC("_RCDDT_","_RCSEL_")",ZTDESC="AR - CR/TR RELATED DOCUMENTS FOR e-PAYMENTS"
"RTN","RCDPEREC",17,0)
 . D ^%ZTLOAD
"RTN","RCDPEREC",18,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEREC",19,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEREC",20,0)
 U IO
"RTN","RCDPEREC",21,0)
 D ENQUE(RCDDT,RCSEL)
"RTN","RCDPEREC",22,0)
 Q
"RTN","RCDPEREC",23,0)
 ;
"RTN","RCDPEREC",24,0)
ENQUE(RCDDT,RCSEL) ; Queued entrypoint for the report
"RTN","RCDPEREC",25,0)
 ; RCDDT = starting EFT deposit date
"RTN","RCDPEREC",26,0)
 ; RCSEL = 'A' if all deposits included ... 'N' if only those not fully
"RTN","RCDPEREC",27,0)
 ;         transferred out of 8NZZ
"RTN","RCDPEREC",28,0)
 ;
"RTN","RCDPEREC",29,0)
 N Z,Z0,RCSTOP,RCD,RCR,RCSTAT,RCDEP,RCEFT,RCEFT1,RCT,RC0,RC00,RC000,RCTOT,RCTOT1,RCTRANS
"RTN","RCDPEREC",30,0)
 K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",31,0)
 ;
"RTN","RCDPEREC",32,0)
 S RCSTOP=0,RCDDT=RCDDT-.1
"RTN","RCDPEREC",33,0)
 F  S RCDDT=$O(^RCY(344.3,"ADEP",RCDDT)) Q:'RCDDT!RCSTOP  S RCDEP=0 F  S RCDEP=$O(^RCY(344.3,"ADEP",RCDDT,RCDEP)) Q:'RCDEP  S RCEFT=0 F  S RCEFT=$O(^RCY(344.3,"ADEP",RCDDT,RCDEP,RCEFT)) Q:'RCEFT!RCSTOP  D
"RTN","RCDPEREC",34,0)
 . S RCTOT=0,RC0=$G(^RCY(344.3,RCEFT,0))
"RTN","RCDPEREC",35,0)
 . S RCD=$E(RCDDT_$J("",8),1,8)_RCDEP
"RTN","RCDPEREC",36,0)
 . S RCEFT1=0 F  S RCEFT1=$O(^RCY(344.31,"B",RCEFT,RCEFT1)) Q:'RCEFT1!RCSTOP  S RC00=$G(^RCY(344.31,RCEFT1,0)) D
"RTN","RCDPEREC",37,0)
 .. ;
"RTN","RCDPEREC",38,0)
 .. I $D(ZTQUEUED) S RCT=RCT+1 I '(RCT#100),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPEREC",39,0)
 .. ;
"RTN","RCDPEREC",40,0)
 .. I '$D(^TMP($J,"RCDEP",RCD)) S ^TMP($J,"RCDEP",RCD)=$P(RC0,U,6,11),^TMP($J,"RCDEP",RCD,0)=$S($P(RC00,U,9):$$FMSSTAT^RCDPUREC($P(RC00,U,9)),1:"NO CR DOCUMENT"),^TMP($J,"RCDEP",RCD,"EFT")=RCEFT
"RTN","RCDPEREC",41,0)
 .. S RCTRANS=+$P(RC00,U,14) S:'RCTRANS RCTRANS=1
"RTN","RCDPEREC",42,0)
 .. ;
"RTN","RCDPEREC",43,0)
 .. I '$P(RC00,U,8) S ^TMP($J,"RCDEP",RCD,RCTRANS,"RCUNM")=RCEFT1 Q  ; Not matched
"RTN","RCDPEREC",44,0)
 .. ;
"RTN","RCDPEREC",45,0)
 .. I '$O(^RCY(344,"AEFT",RCEFT1,0)) D  Q  ; No receipt
"RTN","RCDPEREC",46,0)
 ... I $P(RC00,U,16)'="" D  Q  ; EFT detail entered on-line
"RTN","RCDPEREC",47,0)
 .... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_"ENTERED ON-LINE"_U_$S($P(RC000,U,18):"ERA #"_$P($G(^RCY(344.4,+$P(RC00,U,10),0)),U),1:"PAPER EOB")_U_$P(RC00,U,16)_U_"NO RECEIPT",RCTOT=RCTOT+$P(RC00,U,7)
"RTN","RCDPEREC",48,0)
 ... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_"NO TR DOC"_U_$S($P(RC00,U,10):"ERA #"_$P($G(^RCY(344.4,+$P(RC00,U,10),0)),U),1:"PAPER EOB")_"^^NO RECEIPT"
"RTN","RCDPEREC",49,0)
 .. ;
"RTN","RCDPEREC",50,0)
 .. S RCR=0 F  S RCR=$O(^RCY(344,"AEFT",RCEFT1,RCR)) Q:'RCR  S RC000=$G(^RCY(344,RCR,0)) D
"RTN","RCDPEREC",51,0)
 ... S RCTOT=RCTOT+$$PAYTOTAL^RCDPURED(RCR)
"RTN","RCDPEREC",52,0)
 ... S RCSTAT=$$FMSSTAT^RCDPUREC(RCR) S:$P(RCSTAT,U)="" RCSTAT="NO TR DOC"
"RTN","RCDPEREC",53,0)
 ... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_$P(RCSTAT,U)_U_$S($P(RC000,U,18):"ERA #"_$P($G(^RCY(344.4,+$P(RC000,U,18),0)),U),1:"PAPER EOB")_U_$P(RCSTAT,U,2)_U_RCR
"RTN","RCDPEREC",54,0)
 . Q:RCSTOP
"RTN","RCDPEREC",55,0)
 . I RCSEL="N",+RCTOT=+$P(RC0,U,8) K ^TMP($J,"RCDEP",RCD) Q
"RTN","RCDPEREC",56,0)
 . S ^TMP($J,"RCDEP",RCD,"TOT")=RCTOT_U_$P(RC0,U,8)
"RTN","RCDPEREC",57,0)
 ;
"RTN","RCDPEREC",58,0)
 ; Output the report
"RTN","RCDPEREC",59,0)
 S RCD="",RCPG=0
"RTN","RCDPEREC",60,0)
 I RCSTOP K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",61,0)
 F  S RCD=$O(^TMP($J,"RCDEP",RCD)) Q:RCD=""!RCSTOP  D  Q:RCSTOP  D TOT(RCD,.RCSTOP,.RCPG)
"RTN","RCDPEREC",62,0)
 . S RC0=$G(^TMP($J,"RCDEP",RCD)) D EFTDEP(RCD,.RCSTOP,.RCPG) ; EFT dep
"RTN","RCDPEREC",63,0)
 . Q:RCSTOP
"RTN","RCDPEREC",64,0)
 . S RCTRANS=0 F  S RCTRANS=$O(^TMP($J,"RCDEP",RCD,RCTRANS)) Q:'RCTRANS!RCSTOP  S RC00=$G(^(RCTRANS)) D  ; EFT detail deposits
"RTN","RCDPEREC",65,0)
 .. S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",66,0)
 .. I RC00="",$D(^TMP($J,"RCDEP",RCD,RCTRANS,"RCUNM")) S Z=$G(^("RCUNM")) D  Q  ; Unmatched
"RTN","RCDPEREC",67,0)
 ... W !,?3,$J("",6),"  UNMATCHED   ",$E($P(Z,U,2)_$J("",30),1,30)_"  "_$E($P(Z,U,3)_$J("",20),1,20)
"RTN","RCDPEREC",68,0)
 ... W !,?13,$P(Z,U,4)
"RTN","RCDPEREC",69,0)
 .. ;
"RTN","RCDPEREC",70,0)
 .. I RC00="" W !,?3,"ERROR IN EFT DETAIL LINE #: ",RCTRANS Q  ; Error
"RTN","RCDPEREC",71,0)
 .. ;
"RTN","RCDPEREC",72,0)
 .. S Z=$G(^RCY(344.31,+RC00,0))
"RTN","RCDPEREC",73,0)
 .. W !,?3,$E(+RC00_$J("",6),1,6)_"  "_$E($P(RC00,U,3)_$J("",10),1,10)_"  "_$E($P(Z,U,2)_$J("",30),1,30)_"  "_$E($P(Z,U,3)_$J("",20),1,20)
"RTN","RCDPEREC",74,0)
 .. W !,?13,$E($P(Z,U,4)_$J("",30),1,30)_"  "_$E($P(RC00,U,5)_$J("",10),1,10),!,?15,$E($P(RC00,U,2)_$J("",10),1,10)_"  "_$E($P(RC00,U,4)_$J("",15),1,15)
"RTN","RCDPEREC",75,0)
 ;
"RTN","RCDPEREC",76,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEREC",77,0)
 ;
"RTN","RCDPEREC",78,0)
 I $D(ZTQUEUED) D
"RTN","RCDPEREC",79,0)
 . I $G(RCSTOP) D HDR1(0) W !,"TASK STOPPED BY USER" Q
"RTN","RCDPEREC",80,0)
 . S ZTREQ="@"
"RTN","RCDPEREC",81,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEREC",82,0)
 K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",83,0)
 Q
"RTN","RCDPEREC",84,0)
 ;
"RTN","RCDPEREC",85,0)
EFTDEP(RCD,RCSTOP,RCPG) ;
"RTN","RCDPEREC",86,0)
 ; RCD = deposit date (FM) concatenated with the deposit #
"RTN","RCDPEREC",87,0)
 N Z,Z0
"RTN","RCDPEREC",88,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPEREC",89,0)
 S Z=$G(^TMP($J,"RCDEP",RCD)),Z0=$G(^(RCD,0))
"RTN","RCDPEREC",90,0)
 S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",91,0)
 I $Y+7>IOSL W !! S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",92,0)
 W:'$P(RCPG,U,2) !!
"RTN","RCDPEREC",93,0)
 W !,$E($$FMTE^XLFDT($P(Z,U,2),"2D")_$J("",8),1,8),"  ",$E(+$G(^TMP($J,"RCDEP",RCD,"EFT"))_$J("",6),1,6),"  ",$E($P(Z,U)_$J("",6),1,6),"  ",$J($P(Z,U,3),13,2),"  ",$E($S($P(Z,U,6):$$FMTE^XLFDT($P(Z,U,6),"2D"),1:"UNPOSTED")_$J("",8),1,8)
"RTN","RCDPEREC",94,0)
 W !,?5,$E($P(Z0,U)_$J("",20),1,20),"  ",$P(Z0,U,2)
"RTN","RCDPEREC",95,0)
 Q
"RTN","RCDPEREC",96,0)
 ;
"RTN","RCDPEREC",97,0)
TOT(RCD,RCSTOP,RCPG) ; Output the total lines for the deposit
"RTN","RCDPEREC",98,0)
 S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",99,0)
 W !,$J("",26),"TOTAL AMOUNT SENT VIA 'TR' DOCUMENTS: ",$J($G(^TMP($J,"RCDEP",RCD,"TOT")),15,2)
"RTN","RCDPEREC",100,0)
 W !,$J("",26),"TOTAL AMOUNT STILL TO BE TRANSFERRED: ",$J($P($G(^TMP($J,"RCDEP",RCD,"TOT")),U,2)-$G(^TMP($J,"RCD",RCD,"TOT")),15,2)
"RTN","RCDPEREC",101,0)
 Q
"RTN","RCDPEREC",102,0)
 ;
"RTN","RCDPEREC",103,0)
NEWPG(RCPG) ; Check for new page needed, output header
"RTN","RCDPEREC",104,0)
 ; Function returns 1 if user chooses to stop output
"RTN","RCDPEREC",105,0)
 N RCX,RCZ
"RTN","RCDPEREC",106,0)
 S RCZ=0,RCX=$P(RCPG,U,2)
"RTN","RCDPEREC",107,0)
 I 'RCPG!(($Y+5)>IOSL) D
"RTN","RCDPEREC",108,0)
 . D:RCPG ASK(.RCZ) I RCZ Q
"RTN","RCDPEREC",109,0)
 . D HDR1(.RCPG)
"RTN","RCDPEREC",110,0)
 I RCX S $P(RCPG,U,2)=0
"RTN","RCDPEREC",111,0)
 Q RCZ
"RTN","RCDPEREC",112,0)
 ;
"RTN","RCDPEREC",113,0)
SELECT() ; Select first deposit #
"RTN","RCDPEREC",114,0)
 ; Function returns values selected for first deposit #
"RTN","RCDPEREC",115,0)
 ;
"RTN","RCDPEREC",116,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEREC",117,0)
 ;
"RTN","RCDPEREC",118,0)
HDR1(RCPG) ;Print report hdr
"RTN","RCDPEREC",119,0)
 ; RCPG = last page #^0/1 for top of page indicator
"RTN","RCDPEREC",120,0)
 N Z,Z0,X
"RTN","RCDPEREC",121,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEREC",122,0)
 S RCPG=$G(RCPG)+1_U_1
"RTN","RCDPEREC",123,0)
 W !,"EDI LOCKBOX FUND 5287.4/8NZZ RECONCILIATION REPORT",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",+RCPG
"RTN","RCDPEREC",124,0)
 W !!,"DEP DATE  ENTRY#  DEP #   TOTAL DEP AMT  POST DT   RECEIPT #",!,?5,"CR DOCUMENT           CR DOC STATUS"
"RTN","RCDPEREC",125,0)
 W !,?3,"EFT #   MATCHED TO  PAYER NAME                      PAYER ID            ",!,?13,"TRACE #                         RECEIPT #"
"RTN","RCDPEREC",126,0)
 W !,?15,"TR DOCUMENT           TR DOC STATUS"
"RTN","RCDPEREC",127,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEREC",128,0)
 Q
"RTN","RCDPEREC",129,0)
 ;
"RTN","RCDPEREC",130,0)
ASK(RCSTOP) ;
"RTN","RCDPEREC",131,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEREC",132,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEREC",133,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEREC",134,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEREC",135,0)
 Q
"RTN","RCDPEREC",136,0)
 ;
"RTN","RCDPESR0")
0^22^B53919083
"RTN","RCDPESR0",1,0)
RCDPESR0 ;ALB/TMK - Server auto-update utilities - EDI Lockbox ;06/03/02
"RTN","RCDPESR0",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPESR0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR0",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPESR0",5,0)
 ;
"RTN","RCDPESR0",6,0)
DISP(RCMIN,RCMOUT,RCFMT,RCFULL,RCW,RC3444) ; Format the 835 return msg
"RTN","RCDPESR0",7,0)
 ; RCMIN = the name of the array that contains the raw message data
"RTN","RCDPESR0",8,0)
 ;         The data is contained at the next level and the subscript is
"RTN","RCDPESR0",9,0)
 ;         numeric and greater than 0 or the data can be at the
"RTN","RCDPESR0",10,0)
 ;         0-node subsequent to the final subscript.
"RTN","RCDPESR0",11,0)
 ;         If the message array is a global ^TMP($J,"MSG",n), RCMIN
"RTN","RCDPESR0",12,0)
 ;         will equal "^TMP($J,""MSG"")" and the message text will be
"RTN","RCDPESR0",13,0)
 ;         in ^TMP($J,"MSG",1), ^TMP($J,"MSG",2), etc.  OR
"RTN","RCDPESR0",14,0)
 ;         the message text can be defined at TMP($J,"MSG",1,0) ^...,2,0)
"RTN","RCDPESR0",15,0)
 ;         etc.
"RTN","RCDPESR0",16,0)
 ; RCMOUT = the name of the array that should be returned.  This array
"RTN","RCDPESR0",17,0)
 ;          will follow the same convention as the input array.  The
"RTN","RCDPESR0",18,0)
 ;          array will be returned with a numeric final subscript.  If
"RTN","RCDPESR0",19,0)
 ;          RCMOUT is passed as "^TMP($J,""MSG1"")", then the display
"RTN","RCDPESR0",20,0)
 ;          lines will be returned in ^TMP($J,"MSG1",1),
"RTN","RCDPESR0",21,0)
 ;          ^TMP($J,"MSG1",2), etc.  Note the array RCMOUT is killed
"RTN","RCDPESR0",22,0)
 ;          on entry to this call
"RTN","RCDPESR0",23,0)
 ; RCFMT = 0 or null if call should return raw data, 1 to execute the
"RTN","RCDPESR0",24,0)
 ;         transforms attached to the fields
"RTN","RCDPESR0",25,0)
 ; RCFULL = the name of an array if the data should be returned in
"RTN","RCDPESR0",26,0)
 ;          this array, formatted into lines for display.  If not sent,
"RTN","RCDPESR0",27,0)
 ;          only the display data by element is returned in RCMOUT.  If
"RTN","RCDPESR0",28,0)
 ;          RCFULL is sent, the array is killed before populating it
"RTN","RCDPESR0",29,0)
 ; RCW = max # of characters per line to return in array RCFULL
"RTN","RCDPESR0",30,0)
 ; RC3444 = flag that indicates only return bill data, not header data
"RTN","RCDPESR0",31,0)
 ;
"RTN","RCDPESR0",32,0)
 N Z,Z0,Z1,RC,RCCT,RCREF,RCDATA,RCQ,R
"RTN","RCDPESR0",33,0)
 S RCCT=0,RCREF="" K @RCMOUT
"RTN","RCDPESR0",34,0)
 S Z=0 F  S Z=$O(@RCMIN@(Z)) Q:'Z  S Z0=$S($G(@RCMIN@(Z))'="":@RCMIN@(Z),1:$G(@RCMIN@(Z,0))) I Z0'="" S RCQ=0 D
"RTN","RCDPESR0",35,0)
 . F Z1=1:1:$L(Z0,U) I $P(Z0,U,Z1)'="" D  Q:RCQ
"RTN","RCDPESR0",36,0)
 .. S RCDATA=$P(Z0,U,Z1)
"RTN","RCDPESR0",37,0)
 .. I Z1=1 D  Q:RCQ
"RTN","RCDPESR0",38,0)
 ... S RC=""
"RTN","RCDPESR0",39,0)
 ... I RCDATA'="",RCDATA?.N.A D
"RTN","RCDPESR0",40,0)
 .... S RCREF=$S($E(RCDATA,1,3)'="835":$E(RCDATA,1,8),1:"835"),R=RCREF_"^RCDPESR9",RC=$P($T(@R),";;",2)
"RTN","RCDPESR0",41,0)
 ... I RC="" S RCCT=RCCT+1,@RCMOUT@(RCCT)="<<<INVALID LINE TYPE - RAW DATA IS:",RCCT=RCCT+1,@RCMOUT@(RCCT)=Z0,RCDATA=""
"RTN","RCDPESR0",42,0)
 .. Q:RCDATA=""!(RCREF="")!$S(RCREF="835":$G(RC3444),1:0)
"RTN","RCDPESR0",43,0)
 .. S RC=""
"RTN","RCDPESR0",44,0)
 .. I RCREF?.A.N D
"RTN","RCDPESR0",45,0)
 ... S R=RCREF_"+"_Z1_"^RCDPESR9",RC=$P($T(@R),";;",2)
"RTN","RCDPESR0",46,0)
 .. I RC=""!($P(RC,U)'=RCREF) S:$S(RCDATA'="":1,1:'$P(RC,U,2)) RCCT=RCCT+1,@RCMOUT@(RCCT)="NO DATA DEFINITION PC "_Z1_": "_RCDATA Q
"RTN","RCDPESR0",47,0)
 .. I RC'="" D
"RTN","RCDPESR0",48,0)
 ... N X,X1,Y
"RTN","RCDPESR0",49,0)
 ... S X1=$P(RC,U,4,99)
"RTN","RCDPESR0",50,0)
 ... I $G(RCFMT),X1'="" S X=RCDATA X X1 S RCDATA=Y ; Output transform
"RTN","RCDPESR0",51,0)
 ... Q:RCDATA=""&($P(RC,U,2))  ; Don't output if null data
"RTN","RCDPESR0",52,0)
 ... S RC=$P(RC,U,3)
"RTN","RCDPESR0",53,0)
 ... S RCCT=RCCT+1,@RCMOUT@(RCCT)=$S(Z1=1:"<<<",1:"")_RC_": "_RCDATA_$S(Z1=1:">>>",1:"")
"RTN","RCDPESR0",54,0)
 I $G(RCFULL)'="" D FMTDSP(RCMOUT,RCFULL,$G(RCW),$G(RC3444))
"RTN","RCDPESR0",55,0)
 Q
"RTN","RCDPESR0",56,0)
 ;
"RTN","RCDPESR0",57,0)
FMTDSP(RCMUN,RCMFO,RCW,RCNOH05) ; Format the display data in array named in
"RTN","RCDPESR0",58,0)
 ; RCMUN into lines up to RCW characters wide  RCMUN must be set up the
"RTN","RCDPESR0",59,0)
 ; same as the output of the DISP call above
"RTN","RCDPESR0",60,0)
 ; Returns array named in RCMFO with the last subscript being the line #
"RTN","RCDPESR0",61,0)
 ; Note @RCMFO is killed on entry to this call
"RTN","RCDPESR0",62,0)
 ; Default is 80 if RCW=0 or null
"RTN","RCDPESR0",63,0)
 ; RCNOH05 = flag that if =1, suppresses the '05' header
"RTN","RCDPESR0",64,0)
 ;
"RTN","RCDPESR0",65,0)
 N Z,RCLINE,RCCT,RCCT1,RCMID,RCD,RCSTART,RCLINE,RCDASH
"RTN","RCDPESR0",66,0)
 K @RCMFO
"RTN","RCDPESR0",67,0)
 S:'$G(RCW) RCW=80
"RTN","RCDPESR0",68,0)
 S RCDASH=" "_$TR($J("",RCW-2)," ","-")
"RTN","RCDPESR0",69,0)
 S (RCCT,RCCT1)=0,RCLINE="",RCMID=RCW\2-1
"RTN","RCDPESR0",70,0)
 S Z=0 F  S Z=$O(@RCMUN@(Z)) Q:'Z  S RCD=$G(@RCMUN@(Z)) D
"RTN","RCDPESR0",71,0)
 . I $E(RCD,1,3)="<<<" D  Q  ; New line needed ... record start
"RTN","RCDPESR0",72,0)
 .. I $L(RCLINE)>0 S RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE,RCLINE=""
"RTN","RCDPESR0",73,0)
 .. I $L(RCLINE)=0 D
"RTN","RCDPESR0",74,0)
 ... I Z>1 S RCCT=RCCT+1,@RCMFO@(RCCT)=" "
"RTN","RCDPESR0",75,0)
 ... I RCD["<<<Line Type: 05 ",'$G(RCNOH05) S RCCT1=RCCT1+1,RCCT=RCCT+1,@RCMFO@(RCCT)=RCDASH,RCCT=RCCT+1,@RCMFO@(RCCT)="****** ERA DETAIL START ******",RCCT=RCCT+1,@RCMFO@(RCCT)=RCDASH
"RTN","RCDPESR0",76,0)
 ... I $L(RCD)>RCW D  Q
"RTN","RCDPESR0",77,0)
 .... S RCSTART=1
"RTN","RCDPESR0",78,0)
 .... F  S RCCT=RCCT+1,@RCMFO@(RCCT)=$E(RCD,RCSTART,RCSTART+RCW-1),RCSTART=RCSTART+RCW Q:RCSTART>$L(RCD)
"RTN","RCDPESR0",79,0)
 ... S RCCT=RCCT+1,@RCMFO@(RCCT)=RCD
"RTN","RCDPESR0",80,0)
 . ;
"RTN","RCDPESR0",81,0)
 . I $L(RCD)>RCW D  Q  ; Split line if greater than width given
"RTN","RCDPESR0",82,0)
 .. I $L(RCLINE) S RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE
"RTN","RCDPESR0",83,0)
 .. S RCSTART=1
"RTN","RCDPESR0",84,0)
 .. F  S RCCT=RCCT+1,@RCMFO@(RCCT)=$E(RCD,RCSTART,RCSTART+RCW-1),RCSTART=RCSTART+RCW Q:RCSTART>$L(RCD)
"RTN","RCDPESR0",85,0)
 .. S RCLINE=""
"RTN","RCDPESR0",86,0)
 . I $L(RCLINE)=0 D  Q  ; Format left side of line
"RTN","RCDPESR0",87,0)
 .. S RCLINE=RCD
"RTN","RCDPESR0",88,0)
 .. ;
"RTN","RCDPESR0",89,0)
 .. I $L(RCLINE)>RCMID S RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE,RCLINE=""
"RTN","RCDPESR0",90,0)
 . ;
"RTN","RCDPESR0",91,0)
 . I (RCMID+$L(RCD)+1)>RCW D  Q  ; data too long for right side of line
"RTN","RCDPESR0",92,0)
 .. S RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE,RCLINE=""
"RTN","RCDPESR0",93,0)
 . S RCLINE=$E(RCLINE_$J("",RCMID),1,RCMID)_"  "_RCD,RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE,RCLINE=""
"RTN","RCDPESR0",94,0)
 I $L(RCLINE) S RCCT=RCCT+1,@RCMFO@(RCCT)=RCLINE
"RTN","RCDPESR0",95,0)
 Q
"RTN","RCDPESR0",96,0)
 ;
"RTN","RCDPESR0",97,0)
BULLERA(RC,RCTDA,RCXMG,RCSUBJ,RCERR,RCTYP) ; Send a bulletin for entries in 344.5
"RTN","RCDPESR0",98,0)
 ; RC = flags for data to include (one or more can can be used)
"RTN","RCDPESR0",99,0)
 ;   'D': display text   'R': raw data    'F': formatted data from raw
"RTN","RCDPESR0",100,0)
 ;        data in file 344.5
"RTN","RCDPESR0",101,0)
 ; RCTDA = ien of the entry in file 344.5
"RTN","RCDPESR0",102,0)
 ; RCXMG = mail msg # for the ERA
"RTN","RCDPESR0",103,0)
 ; RCSUBJ = subject of the bulletin 
"RTN","RCDPESR0",104,0)
 ; RCERR = error text in array or name of error global
"RTN","RCDPESR0",105,0)
 ; RCTYP = if 0:ERA  1:EEOB
"RTN","RCDPESR0",106,0)
 ;
"RTN","RCDPESR0",107,0)
 N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,XMZ,XMERR,Z,Z0,CT,RCXM,RCVAR
"RTN","RCDPESR0",108,0)
 K ^TMP("RCXM_344.5",$J)
"RTN","RCDPESR0",109,0)
 S RCERR=$G(RCERR)
"RTN","RCDPESR0",110,0)
 S RCVAR=$S($E(RCERR,1,5)="^TMP(":RCERR,1:"RCERR")
"RTN","RCDPESR0",111,0)
 S XMTO("I:G.RCDPE PAYMENTS EXCEPTIONS")="",CT=0,RCTYP=$S('$G(RCTYP):"ERA",1:"EEOB")
"RTN","RCDPESR0",112,0)
 S CT=CT+1,^TMP("RCXM_344.5",$J,CT)="The following electronic "_RCTYP_" was received at your site.",CT=CT+1,^TMP("RCXM_344.5",$J,CT)="It was received on: "_$$FMTE^XLFDT($$NOW^XLFDT(),2)_" in mail msg # "_RCXMG_"."
"RTN","RCDPESR0",113,0)
 S CT=CT+1,^TMP("RCXM_344.5",$J,CT)="This message is sent to alert you to conditions regarding this "_RCTYP_".",CT=CT+1,^TMP("RCXM_344.5",$J,CT)=" "
"RTN","RCDPESR0",114,0)
 I RC["D" D DTXT(RCTDA,.RCXM,.CT) M ^TMP("RCXM_344.5",$J)=RCXM K RCXM
"RTN","RCDPESR0",115,0)
 S Z=0 F  S Z=$O(@RCVAR@(Z)) Q:'Z  I $D(@RCVAR@(Z,"*")) S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=@RCVAR@(Z,"*")
"RTN","RCDPESR0",116,0)
 I $G(RCERR)'="",RCVAR="RCERR" S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=RCERR,CT=CT+1,^TMP("RCXM_344.5",$J,CT)=" "
"RTN","RCDPESR0",117,0)
 I $O(@RCVAR@(""))'="" D
"RTN","RCDPESR0",118,0)
 . S Z="" F  S Z=$O(@RCVAR@(Z)) Q:Z=""  D
"RTN","RCDPESR0",119,0)
 .. I $G(@RCVAR@(Z))'="" S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=@RCVAR@(Z)
"RTN","RCDPESR0",120,0)
 .. I $O(@RCVAR@(Z,0)) S Z0="" F  S Z0=$O(@RCVAR@(Z,Z0)) Q:Z0=""  I Z0'="*" S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=@RCVAR@(Z,Z0)
"RTN","RCDPESR0",121,0)
 I RC["F" D
"RTN","RCDPESR0",122,0)
 . N RCCT1
"RTN","RCDPESR0",123,0)
 . S RCCT1=0
"RTN","RCDPESR0",124,0)
 . K ^TMP($J,"PRCAZ_RAW"),^TMP($J,"PRCAZ_FMT1"),^TMP($J,"PRCAZ_FMT")
"RTN","RCDPESR0",125,0)
 . D DISP("^RCY(344.5,"_RCTDA_",2)","^TMP($J,""PRCAZ_FMT1"")",1,"^TMP($J,""PRCAZ_FMT"")",75)
"RTN","RCDPESR0",126,0)
 . S CT=CT+1,^TMP("RCXM_344.5",$J,CT)="FORMATTED DATA: "
"RTN","RCDPESR0",127,0)
 . S Z=0 F  S Z=$O(^TMP($J,"PRCAZ_FMT",Z)) Q:'Z  S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=^TMP($J,"PRCAZ_FMT",Z)
"RTN","RCDPESR0",128,0)
 . S:RC["R" CT=CT+1,^TMP("RCXM_344.5",$J,CT)=" "
"RTN","RCDPESR0",129,0)
 I RC["R" D
"RTN","RCDPESR0",130,0)
 . S CT=CT+1,^TMP("RCXM_344.5",$J,CT)="RAW DATA: "
"RTN","RCDPESR0",131,0)
 . S Z=0 F  S Z=$O(^RCY(344.5,RCTDA,2,Z)) Q:'Z  S CT=CT+1,^TMP("RCXM_344.5",$J,CT)=$G(^RCY(344.5,RCTDA,2,Z,0))
"RTN","RCDPESR0",132,0)
 S XMBODY="^TMP(""RCXM_344.5"",$J)"
"RTN","RCDPESR0",133,0)
 D
"RTN","RCDPESR0",134,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR0",135,0)
 . D SENDMSG^XMXAPI(.5,$E(RCSUBJ,1,65),XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR0",136,0)
 K ^TMP($J,"PRCAZ_RAW"),^TMP($J,"PRCAZ_FMT1"),^TMP($J,"PRCAZ_FMT"),^TMP("RCXM_344.5",$J)
"RTN","RCDPESR0",137,0)
 Q
"RTN","RCDPESR0",138,0)
 ;
"RTN","RCDPESR0",139,0)
BULLEFT(RCTDA,RCXMG,RCSUBJ,RCERR) ; Send a bulletin for 'bad' EFT entries
"RTN","RCDPESR0",140,0)
 ; RCTDA = ien of the entry in file 344.3
"RTN","RCDPESR0",141,0)
 ; RCXMG = mail msg # for the EFT
"RTN","RCDPESR0",142,0)
 ; RCSUBJ = subject of the bulletin 
"RTN","RCDPESR0",143,0)
 ; RCERR = error text in array
"RTN","RCDPESR0",144,0)
 N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,RCXM,XMZ,XMERR,Z,Z0,CT
"RTN","RCDPESR0",145,0)
 S XMTO("I:G.RCDPE PAYMENTS EXCEPTIONS")="",CT=0
"RTN","RCDPESR0",146,0)
 S CT=CT+1,RCXM(CT)="The following electronic EFT deposit was received at your site.",CT=CT+1,RCXM(CT)="It was received on: "_$$FMTE^XLFDT($$NOW^XLFDT(),2)_" in mail msg # "_RCXMG_"."
"RTN","RCDPESR0",147,0)
 S CT=CT+1,RCXM(CT)="This message is sent to alert you to conditions regarding this EFT.",CT=CT+1,RCXM(CT)=" "
"RTN","RCDPESR0",148,0)
 I $G(RCERR)'="" S CT=CT+1,RCXM(CT)=RCERR,CT=CT+1,RCXM(CT)=" "
"RTN","RCDPESR0",149,0)
 I $O(RCERR(""))'="" D
"RTN","RCDPESR0",150,0)
 . S Z="" F  S Z=$O(RCERR(Z)) Q:Z=""  D
"RTN","RCDPESR0",151,0)
 .. I $G(RCERR(Z))'="" S CT=CT+1,RCXM(CT)=RCERR(Z)
"RTN","RCDPESR0",152,0)
 .. I $O(RCERR(Z,0)) S Z0="" F  S Z0=$O(RCERR(Z,Z0)) Q:Z0=""  S CT=CT+1,RCXM(CT)=RCERR(Z,Z0)
"RTN","RCDPESR0",153,0)
 S XMBODY="RCXM"
"RTN","RCDPESR0",154,0)
 D
"RTN","RCDPESR0",155,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR0",156,0)
 . D SENDMSG^XMXAPI(.5,$E(RCSUBJ,1,65),XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR0",157,0)
 Q
"RTN","RCDPESR0",158,0)
 ;
"RTN","RCDPESR0",159,0)
DTXT(RCTDA,RCXM,RCNT) ; Add display text to array RCXM(CT)
"RTN","RCDPESR0",160,0)
 ; RCTDA = ien of entry in file 344.5
"RTN","RCDPESR0",161,0)
 ; Send RCNT and RCXM by reference for return values
"RTN","RCDPESR0",162,0)
 N RCDIQ
"RTN","RCDPESR0",163,0)
 D GETS^DIQ(344.5,RCTDA_",",1,"EN","RCDIQ")
"RTN","RCDPESR0",164,0)
 D TXTDE^RCDPEX(RCTDA,.RCDIQ,1,.RCXM,.RCNT)
"RTN","RCDPESR0",165,0)
 Q
"RTN","RCDPESR0",166,0)
 ;
"RTN","RCDPESR0",167,0)
BILLREF(RC3444,RC34441) ; Returns the bill # for the EOB in file 344.4, entry
"RTN","RCDPESR0",168,0)
 ; number RC3444 and subfile entry RC34441
"RTN","RCDPESR0",169,0)
 N RCARR
"RTN","RCDPESR0",170,0)
 D DIQ34441^RCDPEDS(RC3444,RC34441,99,"RCARR")
"RTN","RCDPESR0",171,0)
 Q $G(RCARR(344.41,RC34441,99,"E"))
"RTN","RCDPESR0",172,0)
 ;
"RTN","RCDPESR0",173,0)
GETBILL(DA) ; Called from computed field to find bill reference
"RTN","RCDPESR0",174,0)
 ;  Assumes DA(1)= ien of file 344.4,  DA = ien of file 344.41
"RTN","RCDPESR0",175,0)
 N Z,VAL
"RTN","RCDPESR0",176,0)
 S Z=$G(^RCY(344.4,DA(1),1,DA,0))
"RTN","RCDPESR0",177,0)
 I $P(Z,U,2) S VAL=$$BN1^PRCAFN(+$G(^IBM(361.1,+$P(Z,U,2),0))) ; IA 4051
"RTN","RCDPESR0",178,0)
 I $G(VAL)="" S VAL=$P(Z,U,5)
"RTN","RCDPESR0",179,0)
 Q VAL
"RTN","RCDPESR0",180,0)
 ;
"RTN","RCDPESR1")
0^3^B46802741
"RTN","RCDPESR1",1,0)
RCDPESR1 ;ALB/TMP - Server interface to AR from Austin ;06/03/02
"RTN","RCDPESR1",2,0)
 ;;4.5;Accounts Receivable;**173,214,208**;Mar 20, 1995
"RTN","RCDPESR1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR1",4,0)
 Q
"RTN","RCDPESR1",5,0)
 ;
"RTN","RCDPESR1",6,0)
PERROR(RCERR,RCEMG,RCXMZ) ; Process Errors - Send bulletin to mail group
"RTN","RCDPESR1",7,0)
 ; RCERR = Error text array
"RTN","RCDPESR1",8,0)
 ; RCEMG = name of the mail group to which these errors should be sent
"RTN","RCDPESR1",9,0)
 ; RCXMZ = internal entry # of the mailman msg
"RTN","RCDPESR1",10,0)
 ; RCTYPE = msg type, if known
"RTN","RCDPESR1",11,0)
 N CT,XMDUZ,XMSUBJ,XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,RCXM,XMZ,XMERR,Z
"RTN","RCDPESR1",12,0)
 ;
"RTN","RCDPESR1",13,0)
 S CT=0
"RTN","RCDPESR1",14,0)
 ;
"RTN","RCDPESR1",15,0)
 I $G(RCEMG)="" S CT=CT+1,RCXM(CT)=$P($T(ERROR+2),";;",2),XMTO(.5)=""
"RTN","RCDPESR1",16,0)
 ;
"RTN","RCDPESR1",17,0)
 I $D(RCEMG) D
"RTN","RCDPESR1",18,0)
 . S:RCEMG="" RCEMG="RCDPE PAYMENTS EXCEPTIONS"
"RTN","RCDPESR1",19,0)
 . S:$E(RCEMG,1,2)'="G." RCEMG="G."_RCEMG
"RTN","RCDPESR1",20,0)
 . S XMTO("I:"_RCEMG)=""
"RTN","RCDPESR1",21,0)
 ;
"RTN","RCDPESR1",22,0)
 S Z=$O(XMTO("")) I Z=.5,'$O(XMTO(.5)) S XMTO("I:G.RCDPE PAYMENTS EXCEPTIONS")=""
"RTN","RCDPESR1",23,0)
 D EMFORM(CT,.RCERR,.RCXM,RCXMZ)
"RTN","RCDPESR1",24,0)
 ;
"RTN","RCDPESR1",25,0)
 S XMDUZ=""
"RTN","RCDPESR1",26,0)
 S XMSUBJ="EDI LBOX SERVER OPTION ERROR",XMBODY="RCXM"
"RTN","RCDPESR1",27,0)
 D
"RTN","RCDPESR1",28,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR1",29,0)
 . D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR1",30,0)
 K ^TMP("RCRAW",$J)
"RTN","RCDPESR1",31,0)
 Q
"RTN","RCDPESR1",32,0)
 ;
"RTN","RCDPESR1",33,0)
EMFORM(CT,RCERR,RCXM,RCXMZ) ; Format error msgs
"RTN","RCDPESR1",34,0)
 ; INPUT:
"RTN","RCDPESR1",35,0)
 ;   CT = # of lines previously populated in error msg
"RTN","RCDPESR1",36,0)
 ;   RCERR = array of errors
"RTN","RCDPESR1",37,0)
 ;   RCXMZ = internal entry # of mailman msg
"RTN","RCDPESR1",38,0)
 ;
"RTN","RCDPESR1",39,0)
 ; OUTPUT:
"RTN","RCDPESR1",40,0)
 ;   RCXM = array containing the complete error msg text
"RTN","RCDPESR1",41,0)
 ;
"RTN","RCDPESR1",42,0)
 N TTYPE,TDATE,TTIME,Z
"RTN","RCDPESR1",43,0)
 ;
"RTN","RCDPESR1",44,0)
 S TDATE=$G(^TMP("RCERR",$J,"DATE")),TTIME=$P(TDATE,".",2)_"000000",TDATE=$$FMTE^XLFDT($P(TDATE,"."),"2D")
"RTN","RCDPESR1",45,0)
 S TTYPE=$G(^TMP("RCMSG",$J))
"RTN","RCDPESR1",46,0)
 ;
"RTN","RCDPESR1",47,0)
 S CT=CT+1
"RTN","RCDPESR1",48,0)
 S RCXM(CT)="** AN EXCEPTION HAS BEEN DETECTED FOR AN EDI LOCKBOX RETURN MESSAGE **",CT=CT+1,RCXM(CT)=" "
"RTN","RCDPESR1",49,0)
 S CT=CT+1
"RTN","RCDPESR1",50,0)
 S RCXM(CT)="             Return Message Code: "_$S(TTYPE="":$S($G(^TMP("RCERR",$J,"TYPE"))'="":^("TYPE"),1:"Cannot be determined"),1:TTYPE)
"RTN","RCDPESR1",51,0)
 ;
"RTN","RCDPESR1",52,0)
 S CT=CT+2
"RTN","RCDPESR1",53,0)
 S RCXM(CT-1)=" ",RCXM(CT)=$J("",13)_"Return Message Date: "_TDATE_"    Message Time: "_$E(TTIME,1,2)_":"_$E(TTIME,3,4)_":"_$E(TTIME,5,6),CT=CT+1
"RTN","RCDPESR1",54,0)
 ;
"RTN","RCDPESR1",55,0)
 S CT=CT+2,RCXM(CT-1)=" ",RCXM(CT)=$J("",15)_"Mailman Message #: "_$G(RCXMZ)
"RTN","RCDPESR1",56,0)
 ;
"RTN","RCDPESR1",57,0)
 I $G(RCERR)'="",RCERR?1A.E S CT=CT+2,RCXM(CT-1)=" ",RCXM(CT)=RCERR
"RTN","RCDPESR1",58,0)
 I $G(^TMP("RCERR",$J,"TEXT"))'="" S CT=CT+2,RCXM(CT)=^("TEXT"),RCXM(CT-1)=" "
"RTN","RCDPESR1",59,0)
 ;
"RTN","RCDPESR1",60,0)
 S Z="" F  S Z=$O(RCERR(Z)) Q:Z=""  S:$G(^TMP("RCERR",$J,"TEXT"))="" CT=CT+1,RCXM(CT)=" " I $G(RCERR(Z))'="",RCERR(Z)'=" " S CT=CT+1,RCXM(CT)=RCERR(Z)
"RTN","RCDPESR1",61,0)
 S Z=0 F  S Z=$O(^TMP("RCERR",$J,"MSG",Z)) Q:'Z  S CT=CT+1,RCXM(CT)=^(Z)
"RTN","RCDPESR1",62,0)
 ;
"RTN","RCDPESR1",63,0)
 Q
"RTN","RCDPESR1",64,0)
 ;
"RTN","RCDPESR1",65,0)
EXTERR(RCERR,RCE) ; Put error into error array
"RTN","RCDPESR1",66,0)
 ; Returns: (must be passed by reference)
"RTN","RCDPESR1",67,0)
 ;   RCERR = specific error encountered, returned as 4
"RTN","RCDPESR1",68,0)
 ;   RCE = error text from the word processing field update error global
"RTN","RCDPESR1",69,0)
 N RCZ,Q
"RTN","RCDPESR1",70,0)
 S RCE="",RCERR=4 ; error reported as 'record was partially stored'
"RTN","RCDPESR1",71,0)
 S RCZ=0 F  S RCZ=$O(RCE("DIERR",RCZ)) Q:'RCZ  S Q=$G(RCE("DIERR",RCZ,"TEXT",1)) I $L(Q),$L(Q)+$L(RCE)<99 S RCE=RCE_Q_";;"
"RTN","RCDPESR1",72,0)
 Q
"RTN","RCDPESR1",73,0)
 ;
"RTN","RCDPESR1",74,0)
ERRUPD(RCGBL,RCD,RCTYPE,RCERR) ; Set up global array to hold msg data
"RTN","RCDPESR1",75,0)
 ; RCGBL = name of the global or array where msg data is found
"RTN","RCDPESR1",76,0)
 ; RCD = array containing mail header data for the msg
"RTN","RCDPESR1",77,0)
 ; RCTYPE = type of msg (835ERA/835XFR/etc)
"RTN","RCDPESR1",78,0)
 ; RCERR = error array - text or reference to error tables below
"RTN","RCDPESR1",79,0)
 ;
"RTN","RCDPESR1",80,0)
 ; Returns ^TMP("RCERR",$J,"MSG" array with formatted error text
"RTN","RCDPESR1",81,0)
 ;
"RTN","RCDPESR1",82,0)
 N Z,Z0,Z1,Z2,CT,RCE
"RTN","RCDPESR1",83,0)
 ;
"RTN","RCDPESR1",84,0)
 Q:$G(RCERR)<0
"RTN","RCDPESR1",85,0)
 K ^TMP("RCERR",$J)
"RTN","RCDPESR1",86,0)
 S CT=0
"RTN","RCDPESR1",87,0)
 ;
"RTN","RCDPESR1",88,0)
 S ^TMP("RCERR",$J,"DATE")=$G(RCD("DATE"))
"RTN","RCDPESR1",89,0)
 S ^TMP("RCERR",$J,"TYPE")=$G(RCTYPE)
"RTN","RCDPESR1",90,0)
 S ^TMP("RCERR",$J,"SUBJ")=$G(RCD("SUBJ"))
"RTN","RCDPESR1",91,0)
 ;
"RTN","RCDPESR1",92,0)
 I $G(RCERR)>0,RCERR<20 D
"RTN","RCDPESR1",93,0)
 . S Z="ERROR2+"_RCERR
"RTN","RCDPESR1",94,0)
 . S RCE=$P($T(@Z),";;",2)
"RTN","RCDPESR1",95,0)
 . I RCE'="" S ^TMP("RCERR",$J,"TEXT")=RCE
"RTN","RCDPESR1",96,0)
 ;
"RTN","RCDPESR1",97,0)
 S Z="" F  S Z=$O(RCERR(Z)) Q:Z=""  S Z0="" F  S Z0=$O(RCERR(Z,Z0)) Q:Z0=""  S RCE=$G(RCERR(Z,Z0)) D
"RTN","RCDPESR1",98,0)
 . I $L(RCE) S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=$S(RCE:$P($T(ERROR+RCE),";;",2),1:RCE)
"RTN","RCDPESR1",99,0)
 . S RCTYPE=$P($G(@RCGBL@(0)),U)
"RTN","RCDPESR1",100,0)
 . S:$G(^TMP("RCERR",$J,"TYPE"))="" ^("TYPE")=RCTYPE
"RTN","RCDPESR1",101,0)
 . S Z1=""
"RTN","RCDPESR1",102,0)
 . F  S Z1=$O(@RCGBL@(1,"D",Z1)) Q:Z1=""  S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=$G(@RCGBL@(1,"D",Z1))
"RTN","RCDPESR1",103,0)
 ;
"RTN","RCDPESR1",104,0)
 I $D(@RCGBL@(2,"D")) D
"RTN","RCDPESR1",105,0)
 . S CT=CT+2,^TMP("RCERR",$J,"MSG",CT-1)=" ",^TMP("RCERR",$J,"MSG",CT)="**** RAW MESSAGE DATA ****:"
"RTN","RCDPESR1",106,0)
 . I $G(^TMP("RCMSGH",$J,0))'="" S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=^TMP("RCMSGH",$J,0)
"RTN","RCDPESR1",107,0)
 . S Z2="" F  S Z2=$O(@RCGBL@(2,"D",Z2)) Q:Z2=""  S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=$G(@RCGBL@(2,"D",Z2))
"RTN","RCDPESR1",108,0)
 E  D
"RTN","RCDPESR1",109,0)
 . Q:'$D(^TMP("RCRAW",$J))
"RTN","RCDPESR1",110,0)
 . S CT=CT+2,^TMP("RCERR",$J,"MSG",CT-1)=" ",^TMP("RCERR",$J,"MSG",CT)="**** RAW MESSAGE DATA ****:"
"RTN","RCDPESR1",111,0)
 . I $G(^TMP("RCMSGH",$J,0))'="" S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=^TMP("RCMSGH",$J,0)
"RTN","RCDPESR1",112,0)
 . S Z2="" F  S Z2=$O(^TMP("RCRAW",$J,Z2)) Q:Z2=""  S CT=CT+1,^TMP("RCERR",$J,"MSG",CT)=$G(^TMP("RCRAW",$J,Z2))
"RTN","RCDPESR1",113,0)
 ;
"RTN","RCDPESR1",114,0)
 Q
"RTN","RCDPESR1",115,0)
 ;
"RTN","RCDPESR1",116,0)
DKILL(RCXMZ) ; Delete server mail msg from postmaster mailbox
"RTN","RCDPESR1",117,0)
 ; RCXMZ = ien of mailman msg
"RTN","RCDPESR1",118,0)
 ;
"RTN","RCDPESR1",119,0)
 D ZAPSERV^XMXAPI("S.RCDPE EDI LOCKBOX SERVER",RCXMZ)
"RTN","RCDPESR1",120,0)
 Q
"RTN","RCDPESR1",121,0)
 ;
"RTN","RCDPESR1",122,0)
TEMPDEL(DA) ; Delete msg from temporary msg file
"RTN","RCDPESR1",123,0)
 ; DA = ien of the entry in file 344.5
"RTN","RCDPESR1",124,0)
 ;
"RTN","RCDPESR1",125,0)
 N DIK,Y,X
"RTN","RCDPESR1",126,0)
 S DIK="^RCY(344.5," D ^DIK
"RTN","RCDPESR1",127,0)
 L -^RCY(344.5,DA,0)
"RTN","RCDPESR1",128,0)
 Q
"RTN","RCDPESR1",129,0)
 ;
"RTN","RCDPESR1",130,0)
RESTMSG(RCD,RCARRAY,XMZ) ; Read rest of msg, store in array
"RTN","RCDPESR1",131,0)
 ; RCD = last line # already in the msg
"RTN","RCDPESR1",132,0)
 ; RCARRAY = name of the array to store the data in
"RTN","RCDPESR1",133,0)
 ; XMZ = ien of the mailman msg
"RTN","RCDPESR1",134,0)
 ;
"RTN","RCDPESR1",135,0)
 F  X XMREC Q:XMER<0  S RCD=RCD+1,@RCARRAY@(RCD)=XMRG
"RTN","RCDPESR1",136,0)
 Q
"RTN","RCDPESR1",137,0)
 ;
"RTN","RCDPESR1",138,0)
TAXERR(RCTYPE,RCINS,RCTID,RCCHG) ; Send a bulletin for a bad tax id
"RTN","RCDPESR1",139,0)
 ; RCTYPE = "ERA" for an ERA record,  "EFT" for an EFT record
"RTN","RCDPESR1",140,0)
 ; RCINS = name and id to identify the ins co
"RTN","RCDPESR1",141,0)
 ; RCTID = tax id sent in error
"RTN","RCDPESR1",142,0)
 ; RCCHG = code describing how correction was made
"RTN","RCDPESR1",143,0)
 ;         'E'=EPHRA, 'C'=Changed by looking at claim #'s
"RTN","RCDPESR1",144,0)
 ;
"RTN","RCDPESR1",145,0)
 N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,RCDXM,XMZ,XMERR,RCCT,RCDXM,RCCT
"RTN","RCDPESR1",146,0)
 S RCCT=0
"RTN","RCDPESR1",147,0)
 S RCCT=RCCT+1,RCDXM(RCCT)="An "_RCTYPE_" was received at your site "_$$FMTE^XLFDT($$NOW^XLFDT(),2)_" with an invalid tax id.",RCCT=RCCT+1,RCDXM(RCCT)=" From: "_RCINS
"RTN","RCDPESR1",148,0)
 S RCCT=RCCT+1,RCDXM(RCCT)=" The tax id sent was: "_RCTID_" and it was corrected by: "
"RTN","RCDPESR1",149,0)
 S RCCT=RCCT+1,RCDXM(RCCT)=" "_$S(RCCHG="E":"EPHRA",1:"Extracting it based on bill numbers in the ERA")
"RTN","RCDPESR1",150,0)
 S RCCT=RCCT+2,RCDXM(RCCT-1)=" ",RCDXM(RCCT)="If your site continues to receive these bulletins for this payer,",RCCT=RCCT+1,RCDXM(RCCT)="contact the payer and request they correct their tax id for your site"
"RTN","RCDPESR1",151,0)
 ;
"RTN","RCDPESR1",152,0)
 S XMTO("I:G.RCDPE PAYMENTS")="",XMBODY="RCDXM"
"RTN","RCDPESR1",153,0)
 D
"RTN","RCDPESR1",154,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR1",155,0)
 . D SENDMSG^XMXAPI(.5,"EDI LBOX ERRONEOUS TAX ID ON "_RCTYPE,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR1",156,0)
 Q
"RTN","RCDPESR1",157,0)
 ;
"RTN","RCDPESR1",158,0)
BILL(X,RCDT,RCIB) ; Returns ien of bill in X or -1 if not valid
"RTN","RCDPESR1",159,0)
 ; RCDT = the Statement from date (used for Rx bills)
"RTN","RCDPESR1",160,0)
 ; and, if passed by reference, RCIB = 1 if an insurance bill
"RTN","RCDPESR1",161,0)
 N DIC,Y
"RTN","RCDPESR1",162,0)
 S RCIB=0
"RTN","RCDPESR1",163,0)
 S X=$TR(X," "),X=$TR(X,"O","0") ; Remove spaces, change ohs to zeroes
"RTN","RCDPESR1",164,0)
 I X'["-",$E(X,1,3)?3N,$L(X)>7 S X=$E(X,1,3)_"-"_$E(X,4,$L(X))
"RTN","RCDPESR1",165,0)
 S DIC="^PRCA(430,",DIC(0)="MZ" D ^DIC
"RTN","RCDPESR1",166,0)
 ;I Y<0,X?1.7N D  ; Rx lookup - uncomment for patch 202
"RTN","RCDPESR1",167,0)
 ;. N ARRAY
"RTN","RCDPESR1",168,0)
 ;. S ARRAY("ECME")=X,ARRAY("FILLDT")=$G(RCDT)
"RTN","RCDPESR1",169,0)
 ;. S Y=$$RXBIL^IBNCPDPU(.ARRAY)
"RTN","RCDPESR1",170,0)
 ;. I Y>0 S Y(0)=$G(^PRCA(430,+Y,0))
"RTN","RCDPESR1",171,0)
 I Y>0 S RCIB=($P($G(^RCD(340,+$P(Y(0),U,9),0)),U)["DIC(36,")
"RTN","RCDPESR1",172,0)
 Q +Y
"RTN","RCDPESR1",173,0)
 ;
"RTN","RCDPESR1",174,0)
FMDT(X) ; Format date (X) in YYYYMMDD to Fileman format
"RTN","RCDPESR1",175,0)
 I $L(X)=8 D
"RTN","RCDPESR1",176,0)
 . S X=$E(X,1,4)-1700_$E(X,5,8)
"RTN","RCDPESR1",177,0)
 Q X
"RTN","RCDPESR1",178,0)
 ;
"RTN","RCDPESR1",179,0)
ERROR ; Top level error msgs for msgs
"RTN","RCDPESR1",180,0)
 ;;Invalid mailgroup designated for EDI Lockbox errors
"RTN","RCDPESR1",181,0)
 ;;Message header error
"RTN","RCDPESR1",182,0)
 ;
"RTN","RCDPESR1",183,0)
ERROR2 ; Error condition msgs for msgs
"RTN","RCDPESR1",184,0)
 ;;Message code is invalid for EDI Lockbox.
"RTN","RCDPESR1",185,0)
 ;;This message has no ending $ or 99 record.
"RTN","RCDPESR1",186,0)
 ;;Message file problem - no message stored.
"RTN","RCDPESR1",187,0)
 ;;Message file problem - message partially stored.
"RTN","RCDPESR1",188,0)
 ;;No valid claims for the site found on the ERA.
"RTN","RCDPESR1",189,0)
 ;
"RTN","RCDPESR2")
0^9^B76459663
"RTN","RCDPESR2",1,0)
RCDPESR2 ;ALB/TMK - Server auto-upd - EDI Lockbox ;06/03/02
"RTN","RCDPESR2",2,0)
 ;;4.5;Accounts Receivable;**173,216,208**;Mar 20, 1995
"RTN","RCDPESR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR2",4,0)
 ; IA 4042 calls to IBCEOB at points: DUP, ADD3611, UPD3611, ERRUPD
"RTN","RCDPESR2",5,0)
 ;
"RTN","RCDPESR2",6,0)
TASKERA(RCTDA) ; Task to upd ERA
"RTN","RCDPESR2",7,0)
 ; RCTDA = ien 344.5
"RTN","RCDPESR2",8,0)
 N ZTDTH,ZTUCI,ZTSAVE,ZTIO,ZTDESC,ZTRTN,ZTSK,DIE,DR,DA
"RTN","RCDPESR2",9,0)
 S (ZTSAVE("DT"),ZTSAVE("U"),ZTSAVE("DUZ"))="",ZTSAVE("ZTREQ")="@",ZTRTN="NEWERA^RCDPESR2("_RCTDA_",0)",ZTDTH=$H,ZTIO=""
"RTN","RCDPESR2",10,0)
 D ^%ZTLOAD
"RTN","RCDPESR2",11,0)
 Q
"RTN","RCDPESR2",12,0)
 ;
"RTN","RCDPESR2",13,0)
NEWERA(RCTDA,RCREFILE) ; Tasked entry
"RTN","RCDPESR2",14,0)
 ; Add new EOB's to IB & ERA tot rec to AR
"RTN","RCDPESR2",15,0)
 ; RCTDA = ien 344.5
"RTN","RCDPESR2",16,0)
 ; RCREFILE = 1: re-filing rec via exc proc
"RTN","RCDPESR2",17,0)
 N RCDUPERR,RCPAYER,RCRTOT,RCE,RCEC,RCERR,RCR1,RCADJ,DIE,DR,DA,Z,Q
"RTN","RCDPESR2",18,0)
 S ZTREQ="@"
"RTN","RCDPESR2",19,0)
 K ^TMP($J,"RCDPERA")
"RTN","RCDPESR2",20,0)
 L +^RCY(344.5,RCTDA):5
"RTN","RCDPESR2",21,0)
 I $D(ZTQUEUED) S DIE="^RCY(344.5,",DA=RCTDA,DR=".05////"_ZTSK_";.04////1" D ^DIE
"RTN","RCDPESR2",22,0)
 I $P($G(^RCY(344.5,RCTDA,0)),U,5),'$G(RCREFILE) S DIE="^RCY(344.5,",DA=RCTDA,DR=".1////4;.08///1" D ^DIE
"RTN","RCDPESR2",23,0)
 S RCR1=$P($G(^RCY(344.5,RCTDA,0)),U,7),RCPAYER=$P($G(^RCY(344.5,RCTDA,3)),U)
"RTN","RCDPESR2",24,0)
 S RCRTOT=$S(RCR1:RCR1,1:$$ERATOT^RCDPESR6(RCTDA,.RCERR)) ; ERA rec
"RTN","RCDPESR2",25,0)
 S RCDUPERR=$S($G(RCERR)="DUP"!($G(RCERR(1))=-2):$G(RCERR(1)),1:0) K RCERR(1)
"RTN","RCDPESR2",26,0)
 I RCRTOT,'RCR1 S DIE="^RCY(344.5,",DR=".07////"_RCRTOT,DA=RCTDA D ^DIE
"RTN","RCDPESR2",27,0)
 D:RCDUPERR'=-2 UPDEOB(RCTDA,5,$S('$G(RCREFILE):RCDUPERR,1:-1)) ; Add EOB det to IB
"RTN","RCDPESR2",28,0)
 I RCRTOT D UPDCON^RCDPESR6(RCRTOT),UPDADJ^RCDPESR6(RCRTOT),UPD3444^RCDPESR6(.RCRTOT) ; Bills added 344.41
"RTN","RCDPESR2",29,0)
 I RCRTOT,RCTDA S DIE="^RCY(344.5,",DR=".08////0;.1///@",DA=RCTDA D ^DIE
"RTN","RCDPESR2",30,0)
 I 'RCRTOT D  G QNEW
"RTN","RCDPESR2",31,0)
 . I RCDUPERR Q:'RCTDA  D  S RCTDA="" Q
"RTN","RCDPESR2",32,0)
 .. I RCDUPERR=-2 D BULLERA^RCDPESR0("D",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - DUPLICATE ERA NOT FILED "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",33,0)
 .. D TEMPDEL^RCDPESR1(RCTDA)
"RTN","RCDPESR2",34,0)
 . S RCE(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" An error occurred while storing ERA data.  ",RCE(2)="No totals data was stored for this ERA record"_$S('$G(RCREFILE):" and an",1:" on this re-file attempt.")
"RTN","RCDPESR2",35,0)
 . S RCE(3)=$S('$G(RCREFILE):"ERA transmission exception was created.",1:"")
"RTN","RCDPESR2",36,0)
 . D WP^DIE(344.5,RCTDA_",",5,"A","RCE")
"RTN","RCDPESR2",37,0)
 . S DIE="^RCY(344.5,",DA=RCTDA,DR=".07///@;.08////1;.1////1" D ^DIE
"RTN","RCDPESR2",38,0)
 . K RCERR
"RTN","RCDPESR2",39,0)
 . S RCERR(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" The ERA data could not be stored.  The AR receipt",RCERR(2)=" for this data must be created/processed manually for the bills included"
"RTN","RCDPESR2",40,0)
 . S RCERR(3)=" in this ERA."_$S('$G(RCREFILE):"",1:"  This error occurred during a refile attempt."),RCERR(4)=" "
"RTN","RCDPESR2",41,0)
 . D BULLERA^RCDPESR0("DF",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - TOTALS FILE EXCEPTION "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",42,0)
 . K RCERR
"RTN","RCDPESR2",43,0)
 I $$ADJ^RCDPEU(RCRTOT,.RCADJ) D  ;Bulletin adjs
"RTN","RCDPESR2",44,0)
 . S RCEC=$$ADJERR^RCDPESR3(.RCERR)
"RTN","RCDPESR2",45,0)
 . I RCADJ'=2 S RCEC=RCEC+1,RCERR(RCEC)=" THERE ARE ERA LEVEL ADJUSTMENT(S)",RCEC=RCEC+1,RCERR(RCEC)=" "
"RTN","RCDPESR2",46,0)
 . I RCADJ'=1 S RCEC=RCEC+1,RCERR(RCEC)=" THE FOLLOWING BILL(S) HAVE RETRACTIONS:" D
"RTN","RCDPESR2",47,0)
 .. S (Q,Z)=0 S Z=0 F  S Z=$O(RCADJ(RCRTOT,Z)) Q:'Z  S:'Q RCEC=RCEC+1,RCERR(RCEC)="  " S Q=Q+1,RCERR(RCEC)=RCERR(RCEC)_"  "_RCADJ(RCRTOT,Z) S:Q=4 Q=0
"RTN","RCDPESR2",48,0)
 .. S RCEC=RCEC+1,RCERR(RCEC)=" "
"RTN","RCDPESR2",49,0)
 . D BULLERA^RCDPESR0("D",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - ERA HAS ADJ/TAKEBACKS "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",50,0)
 ;
"RTN","RCDPESR2",51,0)
QNEW I RCTDA,'$P($G(^RCY(344.5,RCTDA,0)),U,8) D TEMPDEL^RCDPESR1(RCTDA) S RCTDA=""
"RTN","RCDPESR2",52,0)
 I RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U)'="" S DIE="^RCY(344.5,",DR=".04////0;.05///@"_$S('$G(RCR1)&$G(RCRTOT):";.07////"_RCRTOT,1:""),DA=RCTDA D ^DIE
"RTN","RCDPESR2",53,0)
 K ^TMP($J,"RCDPERA")
"RTN","RCDPESR2",54,0)
 I RCTDA L -^RCY(344.5,RCTDA)
"RTN","RCDPESR2",55,0)
 Q
"RTN","RCDPESR2",56,0)
 ;
"RTN","RCDPESR2",57,0)
UPDEOB(RCTDA,RCFILE,DUP) ;Upd 361.1 from ERA msg in 344.5 or .4
"RTN","RCDPESR2",58,0)
 ; RCTDA = ien ERA msg in 344.5 or ;subfile in 344.4
"RTN","RCDPESR2",59,0)
 ; RCFILE = 4 file 344.4, 5 if 344.5
"RTN","RCDPESR2",60,0)
 ; DUP = msg # if dup msg, but not same # or -1 if same msg #
"RTN","RCDPESR2",61,0)
 ; Returned for each bill in ERA:
"RTN","RCDPESR2",62,0)
 ;  ^TMP($J,"RCDPEOB",n)=Bill ien^AR bill #
"RTN","RCDPESR2",63,0)
 ;  ^TMP($J,"RCDPEOB",n,"EOB")=EOB ien^amt pd^ins co ptr^reversal flag^
"RTN","RCDPESR2",64,0)
 ;                             pt name on EEOB^amt billed
"RTN","RCDPESR2",65,0)
 ;  ^TMP($J,"RCDPEOB","ADJ",x)=adj rec ('02')
"RTN","RCDPESR2",66,0)
 ;
"RTN","RCDPESR2",67,0)
 ; Also: ^TMP($J,"RCDPEOB","HDR")=hdr rec from txmn
"RTN","RCDPESR2",68,0)
 ;       ^TMP($J,"RCDPEOB","CONTACT")=ERA contact rec ('01')
"RTN","RCDPESR2",69,0)
 ;
"RTN","RCDPESR2",70,0)
 N RCGBL,RC,RC0,RCCT,RCCT1,RCEOB,RCBILL,RCMNUM,RCIFN,RCIB,RCERR,RCSTAR,RCET,RCX,RCXMG,Z,Q,DA,DR,DIE,RCPAYER,RCFILED,RCEOBD,RCNOUPD
"RTN","RCDPESR2",71,0)
 K ^TMP($J,"RCDP-EOB"),^TMP("RCDPERR-EOB",$J)
"RTN","RCDPESR2",72,0)
 ;
"RTN","RCDPESR2",73,0)
 S RCPAYER="",RCFILED=1,RCNOUPD=0
"RTN","RCDPESR2",74,0)
 I RCFILE=5 D
"RTN","RCDPESR2",75,0)
 . S RCGBL="^RCY(344.5,"_RCTDA_",2)"
"RTN","RCDPESR2",76,0)
 . S RCMNUM=+$G(^RCY(344.5,RCTDA,0)),RCXMG=$P($G(^(0)),U,11)
"RTN","RCDPESR2",77,0)
 . I $G(DUP) S RCNOUPD=$S(DUP>0:+DUP,1:RCXMG)
"RTN","RCDPESR2",78,0)
 . S ^TMP($J,"RCDPEOB","HDR")=$G(^RCY(344.5,RCTDA,2,1,0))
"RTN","RCDPESR2",79,0)
 . I $P(^TMP($J,"RCDPEOB","HDR"),U)["XFR",'$P($G(^RCY(344.5,RCTDA,0)),U,14) D
"RTN","RCDPESR2",80,0)
 .. D SENDACK^RCDPESR5(RCTDA,1)
"RTN","RCDPESR2",81,0)
 .. S DR=".14////1",DIE="^RCY(344.5,",DA=RCTDA D ^DIE
"RTN","RCDPESR2",82,0)
 ;
"RTN","RCDPESR2",83,0)
 I RCFILE=4 D
"RTN","RCDPESR2",84,0)
 . S RCGBL="^RCY(344.4,"_+RCTDA_",1,"_+$P(RCTDA,";",2)_",1)"
"RTN","RCDPESR2",85,0)
 . S RCMNUM=$P($G(^RCY(344.4,+RCTDA,0)),U,12),RCXMG=$P($G(^(0)),U,12)
"RTN","RCDPESR2",86,0)
 . S ^TMP($J,"RCDPEOB","HDR")=$G(^RCY(344.4,+RCTDA,1,+$P(RCTDA,";",2),1,1,0))
"RTN","RCDPESR2",87,0)
 ;
"RTN","RCDPESR2",88,0)
 S RCPAYER=$P($G(^TMP($J,"RCDPEOB","HDR")),U,6)
"RTN","RCDPESR2",89,0)
 S RC=1,(RCCT,RCCT1,RCX)=0,RCBILL=""
"RTN","RCDPESR2",90,0)
 K ^TMP("RCERR1",$J)
"RTN","RCDPESR2",91,0)
 F  S RC=$O(@RCGBL@(RC)) Q:'RC  S RC0=$G(^(RC,0)) D
"RTN","RCDPESR2",92,0)
 . I RCFILE=5,+RC0=1 D  Q
"RTN","RCDPESR2",93,0)
 .. S ^TMP($J,"RCDPEOB","CONTACT")=RC0
"RTN","RCDPESR2",94,0)
 . ;
"RTN","RCDPESR2",95,0)
 . I RCFILE=5,+RC0=2 D  Q
"RTN","RCDPESR2",96,0)
 .. S RCX=RCX+1,^TMP($J,"RCDPEOB","ADJ",RCX)=RC0
"RTN","RCDPESR2",97,0)
 . ;
"RTN","RCDPESR2",98,0)
 . I +RC0=5 S RCCT=RCCT+1,RCCT1=0,RCBILL=$P(RC0,U,2),Z=$$BILL^RCDPESR1(RCBILL,+$P(RC0,U,9),.RCIB),Z=$S(Z>0:$S($G(RCIB):Z,1:-1),1:-1),^TMP($J,"RCDP-EOB",RCCT,0)=Z_U_RCBILL D
"RTN","RCDPESR2",99,0)
 .. S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,5)=$P(RC0,U,3)_","_$P(RC0,U,4)_" "_$P(RC0,U,5) ;Save pt nm
"RTN","RCDPESR2",100,0)
 .. I Z>0 S Q=+$P($G(^PRCA(430,Z,0)),U,9) I $P($G(^RCD(340,Q,0)),U)["DIC(36," S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,3)=+^RCD(340,Q,0) ;Save ins co
"RTN","RCDPESR2",101,0)
 . ;
"RTN","RCDPESR2",102,0)
 . I +RC0=10 D  ;Save amt pd/billed, rev flg
"RTN","RCDPESR2",103,0)
 .. S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,2)=$S(+$P(RC0,U,11):$J($P(RC0,U,11)/100,"",2),1:0),$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,6)=$J($P(RC0,U,11),"",2)
"RTN","RCDPESR2",104,0)
 .. I $P(RC0,U,6)="Y"!($P(RC0,U,7)=22) S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,4)=1
"RTN","RCDPESR2",105,0)
 . I RCBILL=$P(RC0,U,2) S RCCT1=RCCT1+1,^TMP($J,"RCDP-EOB",RCCT,RCCT1,0)=RC0
"RTN","RCDPESR2",106,0)
 ;
"RTN","RCDPESR2",107,0)
 S RCSTAR=$TR($J("",15)," ","*"),RCET=RCSTAR_"ERROR/WARNING EEOB DETAIL SEQ #"
"RTN","RCDPESR2",108,0)
 S RCCT=0 F  S RCCT=$O(^TMP($J,"RCDP-EOB",RCCT)) Q:'RCCT  S RCIFN=+$G(^(RCCT,0)),RCBILL=$P($G(^(0)),U,2),^TMP($J,"RCDPEOB",RCCT)=$G(^TMP($J,"RCDP-EOB",RCCT,0)) D
"RTN","RCDPESR2",109,0)
 . S RCEOB=-1,RCEOBD=""
"RTN","RCDPESR2",110,0)
 . I $S(RCIFN>0:$P(^PRCA(430.3,+$P($G(^PRCA(430,+RCIFN,0)),U,8),0),U,3)'=102,RCIFN'>0&($G(DUP)'>0):1,1:0) D
"RTN","RCDPESR2",111,0)
 .. S ^TMP("RCERR1",$J,RCCT)=" ",^TMP("RCERR1",$J,RCCT,1)=RCET_RCCT_RCSTAR
"RTN","RCDPESR2",112,0)
 .. S ^TMP("RCERR1",$J,RCCT,2)="Bill "_RCBILL_" is"_$S(RCIFN>0:" not in an ACTIVE status in your A/R",1:"n't valid/wasn't found so its detail wasn't stored in IB")
"RTN","RCDPESR2",113,0)
 .. S:RCFILE=5 ^TMP("RCERR1",$J,RCCT,"*")=^TMP("RCERR1",$J,RCCT,2)
"RTN","RCDPESR2",114,0)
 .. S ^TMP("RCERR1",$J,RCCT,3)="  The reported amount paid on this bill was: "_$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,2)
"RTN","RCDPESR2",115,0)
 .. I RCIFN'>0 D
"RTN","RCDPESR2",116,0)
 ... S ^TMP("RCERR1",$J,RCCT,4)="  If the bill is not for your site, it must be transferred to the",^TMP("RCERR1",$J,RCCT,5)="   correct site and manually adjusted in your AR."
"RTN","RCDPESR2",117,0)
 ... S ^TMP("RCERR1",$J,RCCT,6)="  You can perform this transfer using EDI Lockbox ERA/EEOB exception process.",^TMP("RCERR1",$J,RCCT,7)=" "
"RTN","RCDPESR2",118,0)
 .. D DISP1^RCDPESR5(RCCT,1)
"RTN","RCDPESR2",119,0)
 .. S Q=0 F  S Q=$O(^TMP($J,"RCDP-EOB",RCCT,Q)) Q:'Q  S ^TMP($J,"RCDPEOB",RCCT,Q)=$G(^TMP($J,"RCDP-EOB",RCCT,Q,0))
"RTN","RCDPESR2",120,0)
 .. S ^TMP($J,"RCDPEOB",RCCT)=^TMP($J,"RCDP-EOB",RCCT,0) M ^TMP($J,"RCDPEOB",RCCT,"ERR")=^TMP("RCERR1",$J,RCCT)
"RTN","RCDPESR2",121,0)
 .. ;
"RTN","RCDPESR2",122,0)
 .. I RCFILE=5 D  ;Store err if trans-in failed
"RTN","RCDPESR2",123,0)
 ... N RCE,RC,DIE,X,Y,DA,DR
"RTN","RCDPESR2",124,0)
 ... S RCE(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" "_$G(^TMP("RCERR1",$J,RCCT,"*"))
"RTN","RCDPESR2",125,0)
 ... S RCE(2)=" ",RCFILED=0
"RTN","RCDPESR2",126,0)
 ... D WP^DIE(344.5,RCTDA_",",5,"A","RCE")
"RTN","RCDPESR2",127,0)
 .. ;
"RTN","RCDPESR2",128,0)
 . I RCIFN>0 D
"RTN","RCDPESR2",129,0)
 .. N RCDUPEOB,RCALLDUP
"RTN","RCDPESR2",130,0)
 .. ;Chk rec exists
"RTN","RCDPESR2",131,0)
 .. S RCDUPEOB=0
"RTN","RCDPESR2",132,0)
 .. S RCEOB=$$DUP^RCDPESR3(RCMNUM,RCIFN,$P($G(^TMP($J,"RCDPEOB",RCCT,"EOB")),U,2),$P($G(^TMP($J,"RCDPEOB",RCCT,"EOB")),U,6)) ;Same msg for update?
"RTN","RCDPESR2",133,0)
 .. I RCEOB,$P(RCEOB,U,2) S RCEOB=0  ;If chksum exists, let below check it
"RTN","RCDPESR2",134,0)
 .. S ^TMP($J,"RCDP-EOB",RCCT,.5,0)="835ERA" ;Needed - checksum
"RTN","RCDPESR2",135,0)
 .. S RCALLDUP=$$DUP^IBCEOB("^TMP("_$J_",""RCDP-EOB"","_RCCT_")",RCIFN) ;IA 4042 - make sure no exact dup exists
"RTN","RCDPESR2",136,0)
 .. I $S(RCALLDUP:1,RCEOB:$G(DUP)'>0,1:0) D
"RTN","RCDPESR2",137,0)
 ... S RCDUPEOB=1
"RTN","RCDPESR2",138,0)
 ... D DUPREC^RCDPESR6(RCET,RCCT,RCSTAR,RCFILE,RCALLDUP,RCEOB,RCBILL,.RCDUPEOB)
"RTN","RCDPESR2",139,0)
 ... S:RCALLDUP RCEOBD=RCALLDUP
"RTN","RCDPESR2",140,0)
 .. ;
"RTN","RCDPESR2",141,0)
 .. ;Add new stub rec to 361.1
"RTN","RCDPESR2",142,0)
 .. I 'RCDUPEOB S RCEOB=+$$ADD3611^IBCEOB(RCMNUM,"","",RCIFN,1,"^TMP("_$J_",""RCDP-EOB"","_RCCT_")") ;IA 4042
"RTN","RCDPESR2",143,0)
 .. K ^TMP($J,"RCDP-EOB",RCCT,.5,0)
"RTN","RCDPESR2",144,0)
 .. ;
"RTN","RCDPESR2",145,0)
 .. I RCEOB<0 D:$G(DUP)'>0  Q
"RTN","RCDPESR2",146,0)
 ... S ^TMP("RCERR1",$J,RCCT)=" ",^TMP("RCERR1",$J,RCCT,1)=RCET_RCCT_RCSTAR,RCFILED=0
"RTN","RCDPESR2",147,0)
 ... S ^TMP("RCERR1",$J,RCCT,2)="Error - EEOB detail not added to IB for bill "_RCBILL,$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U)="" S:RCFILE=5 ^TMP("RCERR1",$J,RCCT,"*")=^TMP("RCERR1",$J,RCCT,2)
"RTN","RCDPESR2",148,0)
 ... D DISP1^RCDPESR5(RCCT,1)
"RTN","RCDPESR2",149,0)
 ... S Q=0 F  S Q=$O(^TMP($J,"RCDP-EOB",RCCT,Q)) Q:'Q  S ^TMP($J,"RCDPEOB",RCCT,Q)=$G(^TMP($J,"RCDP-EOB",RCCT,Q,0))
"RTN","RCDPESR2",150,0)
 ... S ^TMP($J,"RCDPEOB",RCCT)=^TMP($J,"RCDP-EOB",RCCT,0) M ^TMP($J,"RCDPEOB",RCCT,"ERR")=^TMP("RCERR1",$J,RCCT)
"RTN","RCDPESR2",151,0)
 .. ;
"RTN","RCDPESR2",152,0)
 .. ;Upd file 361.1
"RTN","RCDPESR2",153,0)
 .. ;Needs ^TMP arrays: $J,"RCDPEOB","HDR" and $J,"RCDP-EOB"
"RTN","RCDPESR2",154,0)
 .. I RCDUPEOB'<0 S RCNOUPD=0 D UPD3611^IBCEOB(RCEOB,RCCT,1) ;IA 4042
"RTN","RCDPESR2",155,0)
 .. ;errors in ^TMP("RCDPERR-EOB",$J
"RTN","RCDPESR2",156,0)
 .. I $O(^TMP("RCDPERR-EOB",$J,0)) D ERRUPD^IBCEOB(RCEOB,"RCDPERR-EOB") ;Adds error msgs to IB file 361.1 - IA 4042
"RTN","RCDPESR2",157,0)
 .. S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U)=$S('$G(RCEOBD):RCEOB,1:RCEOBD)
"RTN","RCDPESR2",158,0)
 . ;
"RTN","RCDPESR2",159,0)
 . K ^TMP("RCDPERR-EOB",$J)
"RTN","RCDPESR2",160,0)
 ;
"RTN","RCDPESR2",161,0)
 I RCNOUPD D DUPERA^RCDPESR3($G(DUP),RCNOUPD)
"RTN","RCDPESR2",162,0)
 ;
"RTN","RCDPESR2",163,0)
 I $O(^TMP("RCERR1",$J,"")) D BULLS^RCDPESR3(RCFILE,RCTDA,$S(RCNOUPD:RCNOUPD,1:$G(DUP)),$G(RCXMG))
"RTN","RCDPESR2",164,0)
 ;
"RTN","RCDPESR2",165,0)
 K ^TMP("RCDPERR-EOB",$J),^TMP($J,"RCDP-EOB"),^TMP("RCERR1",$J)
"RTN","RCDPESR2",166,0)
 D CLEAN^DILF
"RTN","RCDPESR2",167,0)
 Q
"RTN","RCDPESR2",168,0)
 ;
"RTN","RCDPESR3")
0^28^B57118992
"RTN","RCDPESR3",1,0)
RCDPESR3 ;ALB/TMK - Server auto-update utilities - EDI Lockbox ;06/06/02
"RTN","RCDPESR3",2,0)
 ;;4.5;Accounts Receivable;**173,214,208**;Mar 20, 1995
"RTN","RCDPESR3",3,0)
 Q
"RTN","RCDPESR3",4,0)
 ;
"RTN","RCDPESR3",5,0)
EFTIN(RCTXN,RCD,XMZ,RCGBL,RCEFLG) ; Adds a new EFT record to AR file 344.3
"RTN","RCDPESR3",6,0)
 ;  from Lockbox EFT msg
"RTN","RCDPESR3",7,0)
 ; RCTXN = the data on the header record of the message text
"RTN","RCDPESR3",8,0)
 ; RCD = array containing formatted mail message header data
"RTN","RCDPESR3",9,0)
 ; XMZ = the mail message number
"RTN","RCDPESR3",10,0)
 ; RCGBL = the name of the array or global where the message is stored
"RTN","RCDPESR3",11,0)
 ; RCEFLG = error flag returned if passed by reference
"RTN","RCDPESR3",12,0)
 ;
"RTN","RCDPESR3",13,0)
 N CT,RC,RC1,RCLAST,RCEFT,RCTDA,RCERR,RCTYP1,DA,DIK,RCZ,Z,Z0,DLAYGO
"RTN","RCDPESR3",14,0)
 ;
"RTN","RCDPESR3",15,0)
 ; Take data out of mail message
"RTN","RCDPESR3",16,0)
 S (RCEFLG,RCLAST)=0,CT=0,RCTYP1="835EFT"
"RTN","RCDPESR3",17,0)
 F  X XMREC Q:XMER<0  D  Q:RCLAST
"RTN","RCDPESR3",18,0)
 . I +XMRG=99,$P(XMRG,U,2)="$" S RCLAST=1 Q
"RTN","RCDPESR3",19,0)
 . S:XMRG'="" CT=CT+1,@RCGBL@(2,"D",CT)=XMRG
"RTN","RCDPESR3",20,0)
 ;
"RTN","RCDPESR3",21,0)
 I 'RCLAST,'$G(RCERR) K @RCGBL S RCERR=2 ;No $ as last character of msg
"RTN","RCDPESR3",22,0)
 ;
"RTN","RCDPESR3",23,0)
 I $G(RCERR)>0 D  G EFTQ
"RTN","RCDPESR3",24,0)
 . D ERRUPD^RCDPESR1(RCGBL,.RCD,RCTYP1,.RCERR)
"RTN","RCDPESR3",25,0)
 . S RCEFLG=1
"RTN","RCDPESR3",26,0)
 ;
"RTN","RCDPESR3",27,0)
 ; Add top-level entry to file 344.3
"RTN","RCDPESR3",28,0)
 S RCEFT=$$ADDEFT(RCTXN,XMZ,RCGBL,.RCERR)
"RTN","RCDPESR3",29,0)
 ;
"RTN","RCDPESR3",30,0)
 I $G(RCERR) D  G EFTQ ; 'BAD' EFT's
"RTN","RCDPESR3",31,0)
 . D ERRUPD^RCDPESR1(RCGBL,.RCD,RCTYP1,.RCERR)
"RTN","RCDPESR3",32,0)
 . S RCEFLG=1
"RTN","RCDPESR3",33,0)
 ;
"RTN","RCDPESR3",34,0)
 G:'RCEFT EFTQ
"RTN","RCDPESR3",35,0)
 ;
"RTN","RCDPESR3",36,0)
 ; Add the detail data to file 344.31 for this EFT record
"RTN","RCDPESR3",37,0)
 S Z=0 F  S Z=$O(^RCY(344.31,"B",RCEFT,Z)) Q:'Z  S DA=Z,DIK="^RCY(344.31," D ^DIK ; Delete any detail data already there
"RTN","RCDPESR3",38,0)
 ;
"RTN","RCDPESR3",39,0)
 S (RC,RC1,RCZ)=0
"RTN","RCDPESR3",40,0)
 F  S RCZ=$O(@RCGBL@(2,"D",RCZ)) Q:'RCZ  S Z0=$G(^(RCZ)) I Z0'="" D  Q:$G(RCERR)
"RTN","RCDPESR3",41,0)
 . I $P(Z0,U)="01" D  ; Each payer's data
"RTN","RCDPESR3",42,0)
 .. N DA,DIE,DR,X,Y,DO,DD,DIC
"RTN","RCDPESR3",43,0)
 .. S X=RCEFT
"RTN","RCDPESR3",44,0)
 .. S DIC("DR")=".11////0;.04////"_$P(Z0,U,2)_";.08////0"_$S($P(Z0,U,5)'="":";.02////"_$P(Z0,U,5),1:"")_$S($P(Z0,U,6)'="":";.03////"_$P(Z0,U,6),1:"")_";.07////"_$J(+$P(Z0,U,4)/100,"",2)_";.06////"_$S($P(Z0,U,8)'="":1,1:0)
"RTN","RCDPESR3",45,0)
 .. S DIC("DR")=DIC("DR")_";.12///"_$$FDT^RCDPESR9($P(Z0,U,3))_";.13////"_DT_$S($P(Z0,U,7)'="":";.05////"_$P(Z0,U,7),1:"")_$S($P(Z0,U,9)'="":";.15////"_$P(Z0,U,9),1:"")
"RTN","RCDPESR3",46,0)
 .. ;
"RTN","RCDPESR3",47,0)
 .. I $P(Z0,U,8)'="" D  ; tax id error
"RTN","RCDPESR3",48,0)
 ... D TAXERR^RCDPESR1("EFT",$P(Z0,U,5)_"  Payer ID: "_$P(RCTXN,U,6),$P(RCTXN,U,7),$P(RCTXN,U,8)) ; Send bad tax id bulletin
"RTN","RCDPESR3",49,0)
 .. ;
"RTN","RCDPESR3",50,0)
 .. S DIC(0)="L",DIC="^RCY(344.31,",DLAYGO=344.31 D FILE^DICN K DIC,DLAYGO,DO,DD
"RTN","RCDPESR3",51,0)
 .. I Y'>0 D  ; Error filing data
"RTN","RCDPESR3",52,0)
 ... S DIK="^RCY(344.3,",DA=RCEFT D ^DIK
"RTN","RCDPESR3",53,0)
 ... S Z=0 F  S Z=$O(^RCY(344.31,"B",RCEFT,Z)) Q:'Z  S DIK="^RCY(344.31,",DA=Z D ^DIK
"RTN","RCDPESR3",54,0)
 ... S RCEFLG=1,RCERR=3
"RTN","RCDPESR3",55,0)
 ... D ERRUPD^RCDPESR1(RCGBL,.RCD,RCTYP1,RCERR)
"RTN","RCDPESR3",56,0)
 ;
"RTN","RCDPESR3",57,0)
 I '$G(RCEFLG) D
"RTN","RCDPESR3",58,0)
 . S DIE="^RCY(344.3,",DA=RCEFT,DR=".09////"_$$CHKSUM(RCEFT) D ^DIE
"RTN","RCDPESR3",59,0)
 ;
"RTN","RCDPESR3",60,0)
EFTQ ;
"RTN","RCDPESR3",61,0)
 D CLEAN^DILF
"RTN","RCDPESR3",62,0)
 Q
"RTN","RCDPESR3",63,0)
 ;
"RTN","RCDPESR3",64,0)
ADDEFT(RCTXN,RCXMZ,RCGBL,RCERR) ; File EFT TOTAL record in file 344.3
"RTN","RCDPESR3",65,0)
 ; RCTXN = the data on the header record of the message text
"RTN","RCDPESR3",66,0)
 ; RCXMZ = the mail message number
"RTN","RCDPESR3",67,0)
 ; RCGBL = the name of the array or global where the message is stored
"RTN","RCDPESR3",68,0)
 ; Function returns the ien of the total record found/added
"RTN","RCDPESR3",69,0)
 ;    and also returns RCERR if passed by reference
"RTN","RCDPESR3",70,0)
 ;
"RTN","RCDPESR3",71,0)
 N RCTDA,RCRCPT,RCDUP,RCHAC,Z,Z0
"RTN","RCDPESR3",72,0)
 S (RCERR,RCTDA)=""
"RTN","RCDPESR3",73,0)
 ;
"RTN","RCDPESR3",74,0)
 I $E($P(RCTXN,U,6),1,3)'="469",$E($P(RCTXN,U,6),1,3)'="HAC" D  G ADDQ ; Invalid EFT deposit number
"RTN","RCDPESR3",75,0)
 . N RCDXM,RCCT
"RTN","RCDPESR3",76,0)
 . S RCCT=0
"RTN","RCDPESR3",77,0)
 . S RCCT=RCCT+1,RCDXM(RCCT)="This EFT has an invalid deposit number for EDI Lockbox and has been rejected.",RCCT=RCCT+1,RCDXM(RCCT)=" "
"RTN","RCDPESR3",78,0)
 . S RCCT=RCCT+1,RCDXM(RCCT)=" ",RCCT=RCCT+1,RCDXM(RCCT)="Here are the contents of this message:"
"RTN","RCDPESR3",79,0)
 . D DISP("EDI LBOX INVALID EFT DEPOSIT #",RCCT,.RCDXM,RCXMZ)
"RTN","RCDPESR3",80,0)
 ;
"RTN","RCDPESR3",81,0)
 ; Make sure it's not already there or if so, it has no ptr to a deposit
"RTN","RCDPESR3",82,0)
 ; or if a deposit exists, that the deposit does not yet have a receipt
"RTN","RCDPESR3",83,0)
 S RCDUP=0,RCHAC=$E($P(RCTXN,U,6),1,3)="HAC" ; This is a HAC deposit
"RTN","RCDPESR3",84,0)
 I $P(RCTXN,U,6)'="" D
"RTN","RCDPESR3",85,0)
 . S Z=0 ; Lookup deposit by deposit #
"RTN","RCDPESR3",86,0)
 . F  S Z=$O(^RCY(344.3,"C",$P(RCTXN,U,6),Z)) Q:'Z  S Z0=$G(^RCY(344.3,Z,0)) S:'$P(Z0,U,3) RCTDA=Z Q:RCTDA  D  Q
"RTN","RCDPESR3",87,0)
 .. ; Deposit found - find receipt
"RTN","RCDPESR3",88,0)
 .. I $O(^RCY(344,"AD",$P(Z0,U,3),0)) S RCDUP=Z Q
"RTN","RCDPESR3",89,0)
 .. S RCTDA=Z
"RTN","RCDPESR3",90,0)
 ;
"RTN","RCDPESR3",91,0)
 I RCDUP D  ; Send bulletin that duplicate EFT received
"RTN","RCDPESR3",92,0)
 . N RCDXM,RCCT
"RTN","RCDPESR3",93,0)
 . S RCCT=0
"RTN","RCDPESR3",94,0)
 . S RCCT=RCCT+1,RCDXM(RCCT)="This EFT appears to be a duplicate transaction and has been rejected.",RCCT=RCCT+1,RCDXM(RCCT)=" "
"RTN","RCDPESR3",95,0)
 . S RCCT=RCCT+1,RCDXM(RCCT)=" ",RCCT=RCCT+1,RCDXM(RCCT)="Here are the contents of this message:"
"RTN","RCDPESR3",96,0)
 . D DISP("EDI LBOX DUP EFT DEPOSIT RECEIVED",RCCT,.RCDXM,RCXMZ)
"RTN","RCDPESR3",97,0)
 ;
"RTN","RCDPESR3",98,0)
 I 'RCDUP D  ; Add or update the record
"RTN","RCDPESR3",99,0)
 . N RCX,RCDTTM,DIE,DIC,DLAYGO,DD,DA,DO,DR,X,Y,%DT,DINUM
"RTN","RCDPESR3",100,0)
 . ;
"RTN","RCDPESR3",101,0)
 . S X=$$FDT^RCDPESR9($P(RCTXN,U,3))_"@"_$P(RCTXN,U,4)
"RTN","RCDPESR3",102,0)
 . S %DT="XTS" D ^%DT S:Y>0 RCDTTM=Y
"RTN","RCDPESR3",103,0)
 . ;
"RTN","RCDPESR3",104,0)
 . S DIC("DR")=""
"RTN","RCDPESR3",105,0)
 . S DIC("DR")=$S(RCDTTM'="":".02////"_RCDTTM,1:"")
"RTN","RCDPESR3",106,0)
 . S DIC("DR")=DIC("DR")_$S(DIC("DR")'="":";",1:"")_".06////"_$P(RCTXN,U,6)_";.07///"_$$FDT^RCDPESR9($P(RCTXN,U,7))
"RTN","RCDPESR3",107,0)
 . S DIC("DR")=DIC("DR")_";.08////"_$$ZERO^RCDPESR9($P(RCTXN,U,8),1)_";.13////"_$$NOW^XLFDT()_";.05////"_RCXMZ_";.14////0;.12////0"
"RTN","RCDPESR3",108,0)
 . ;
"RTN","RCDPESR3",109,0)
 . I RCTDA D  ; Overwrite the data already there
"RTN","RCDPESR3",110,0)
 .. L +^RCY(344.3,RCTDA):1 I '$T S RCTDA=-1 Q
"RTN","RCDPESR3",111,0)
 .. S DIE="^RCY(344.3,",DA=RCTDA,DR=DIC("DR") K DIC D ^DIE
"RTN","RCDPESR3",112,0)
 .. L -^RCY(344.3,RCTDA)
"RTN","RCDPESR3",113,0)
 . ;
"RTN","RCDPESR3",114,0)
 . I 'RCTDA D
"RTN","RCDPESR3",115,0)
 .. S RCX=+$O(^RCY(344.3," "),-1)
"RTN","RCDPESR3",116,0)
 .. F RCX=RCX+1:1 I '$D(^RCY(344.3,RCX,0)) L +^RCY(344.3,RCX,0):1 I $T S X=RCX Q
"RTN","RCDPESR3",117,0)
 .. S DIC(0)="L",DIC="^RCY(344.3,",DLAYGO=344.3,DINUM=RCX
"RTN","RCDPESR3",118,0)
 .. D FILE^DICN K DO,DD,DLAYGO,DIC,DINUM
"RTN","RCDPESR3",119,0)
 .. L -^RCY(344.3,RCX,0)
"RTN","RCDPESR3",120,0)
 .. S RCTDA=$S(Y<0:"",1:+Y)
"RTN","RCDPESR3",121,0)
 . ;
"RTN","RCDPESR3",122,0)
 . I 'RCTDA S RCERR=3 ; Error in add of EFT record to file 344.3 
"RTN","RCDPESR3",123,0)
 ;
"RTN","RCDPESR3",124,0)
ADDQ Q $S(RCTDA>0:RCTDA,1:"")
"RTN","RCDPESR3",125,0)
 ;
"RTN","RCDPESR3",126,0)
CHKSUM(RCTDA) ; Calc the checksum for EFT record stored in RCTDA in 344.3
"RTN","RCDPESR3",127,0)
 ;
"RTN","RCDPESR3",128,0)
 N RCDPCSUM,RCDPDATA,X,Y,Z,Z0
"RTN","RCDPESR3",129,0)
 ;
"RTN","RCDPESR3",130,0)
 S (RCDPCSUM,X)=0,Z0=$G(^RCY(344.3,RCTDA,0))
"RTN","RCDPESR3",131,0)
 ; Use pcs 1-8, leaving out piece 3
"RTN","RCDPESR3",132,0)
 S RCDPDATA=$P(Z0,U,1,8),$P(RCDPDATA,U,3)=""
"RTN","RCDPESR3",133,0)
 S X=RCDPCSUM_RCDPDATA X $S($G(^%ZOSF("LPC"))'="":^("LPC"),1:"S Y=""""") S RCDPCSUM=Y
"RTN","RCDPESR3",134,0)
 ; Use detail iens and pieces 3,4,7 to complete the checksum
"RTN","RCDPESR3",135,0)
 S Z=0 F  S Z=$O(^RCY(344.31,"B",RCTDA,Z)) Q:'Z  S Z0=$G(^RCY(344.31,Z,0)),RCDPDATA=Z_U_$P(Z0,U,3,4)_U_$P(Z0,U,7),X=RCDPCSUM_RCDPDATA X $S($G(^%ZOSF("LPC"))'="":^("LPC"),1:"S Y=""""") S RCDPCSUM=Y
"RTN","RCDPESR3",136,0)
 Q RCDPCSUM
"RTN","RCDPESR3",137,0)
 ;
"RTN","RCDPESR3",138,0)
DISP(RCTIT,RCCT,RCDXM,RCXMZ) ; Sends bulletin with formatted data from message
"RTN","RCDPESR3",139,0)
 ; RCTIT = title of bulletin
"RTN","RCDPESR3",140,0)
 ; RCCT = # of lines previously populated
"RTN","RCDPESR3",141,0)
 ; RCXDM = array containing the text of the bulletin
"RTN","RCDPESR3",142,0)
 N RC,Z
"RTN","RCDPESR3",143,0)
 K ^TMP("RC1",$J),^TMP("RC",$J),^TMP("RCTEMP",$J)
"RTN","RCDPESR3",144,0)
 S RC=1,^TMP("RCTEMP",$J,RC)=$G(^TMP("RCMSGH",$J,0))
"RTN","RCDPESR3",145,0)
 S Z=0 F  S Z=$O(^TMP("RCMSG",$J,2,"D",Z)) Q:'Z  S RC=RC+1,^TMP("RCTEMP",$J,RC)=$G(^TMP("RCMSG",$J,2,"D",Z))
"RTN","RCDPESR3",146,0)
 D DISP^RCDPESR8("^TMP(""RCTEMP"",$J)","^TMP(""RC1"",$J)",1,"^TMP(""RC"",$J)",75)
"RTN","RCDPESR3",147,0)
 S Z=0 F  S Z=$O(^TMP("RC",$J,Z)) Q:'Z  S RCCT=RCCT+1,RCDXM(RCCT)=$G(^TMP("RC",$J,Z))
"RTN","RCDPESR3",148,0)
 D BULLEFT^RCDPESR0("",RCXMZ,RCTIT,.RCDXM)
"RTN","RCDPESR3",149,0)
 K ^TMP("RC1",$J),^TMP("RC",$J),^TMP("RCTEMP",$J)
"RTN","RCDPESR3",150,0)
 Q
"RTN","RCDPESR3",151,0)
 ;
"RTN","RCDPESR3",152,0)
DUP(RCM,RCIFN,RCAMT,RCAMT1) ; EOB in mail message already stored in 361.1?
"RTN","RCDPESR3",153,0)
 ; RCM = msg # EOB was received in
"RTN","RCDPESR3",154,0)
 ; RCIFN = bill ien
"RTN","RCDPESR3",155,0)
 ; RCAMT = amt pd
"RTN","RCDPESR3",156,0)
 ; RCAMT1 = amt reported billed
"RTN","RCDPESR3",157,0)
 ; Returns 0 if none found, entry #^message checksum on file if found
"RTN","RCDPESR3",158,0)
 N Z,DUP,DUP1
"RTN","RCDPESR3",159,0)
 S (DUP,DUP1,Z)=0
"RTN","RCDPESR3",160,0)
 F  S Z=$O(^IBM(361.1,"AC",RCM,Z)) Q:'Z  I +$G(^IBM(361.1,Z,0))=RCIFN D  Q:DUP
"RTN","RCDPESR3",161,0)
 . I '$P($G(^IBM(361.1,Z,100)),U,5) S DUP1=Z Q  ; Partially filed before
"RTN","RCDPESR3",162,0)
 . I +$G(^IBM(361.1,Z,1))=+RCAMT,+$P($G(^IBM(361.1,1,Z,2)),U,4)=+RCAMT1 S DUP=Z_U_+$P($G(^IBM(361.1,Z,100)),U,5) Q
"RTN","RCDPESR3",163,0)
 I 'DUP,DUP1 S DUP=DUP1_"^0"
"RTN","RCDPESR3",164,0)
 Q DUP
"RTN","RCDPESR3",165,0)
 ;
"RTN","RCDPESR3",166,0)
DUPERA(DUP,RCNOUPD) ; Msg for duplicate ERA
"RTN","RCDPESR3",167,0)
 ; RCNOUPD = # of message with duplicate data
"RTN","RCDPESR3",168,0)
 ; DUP = flag = -1 if duplicate message received in same mail msg #
"RTN","RCDPESR3",169,0)
 K ^TMP("RCERR1",$J)
"RTN","RCDPESR3",170,0)
 S ^TMP("RCERR1",$J,1)=$S(DUP>0:"This an exact duplicate of an ERA received previously in mail msg "_RCNOUPD,1:"This ERA message was already fully processed - message was ignored")
"RTN","RCDPESR3",171,0)
 Q
"RTN","RCDPESR3",172,0)
 ;
"RTN","RCDPESR3",173,0)
BULLS(RCFILE,RCTDA,DUP,RCXMSG) ; Error bulletins for ERA
"RTN","RCDPESR3",174,0)
 I RCFILE=5 D BULL1^RCDPESR5(RCTDA,"^TMP(""RCERR1"",$J)",$S($G(DUP)>0:$G(DUP),1:""))
"RTN","RCDPESR3",175,0)
 I RCFILE=4 D BULL2^RCDPESR5(RCTDA,"^TMP(""RCERR1"",$J)",RCXMSG)
"RTN","RCDPESR3",176,0)
 Q
"RTN","RCDPESR3",177,0)
 ;
"RTN","RCDPESR3",178,0)
ADJERR(RCERR) ; Set up adj error text in RCERR(n) - pass by ref
"RTN","RCDPESR3",179,0)
 ; Function returns # of lines for error text
"RTN","RCDPESR3",180,0)
 S RCERR(1)="At least 1 adjustment transaction has been found on this ERA.  Before the",RCERR(2)="   receipt for this ERA can be processed, the appropriate adjustments",RCERR(3)="   must be made using the EEOB Worklist",RCERR(4)=" "
"RTN","RCDPESR3",181,0)
 Q 4
"RTN","RCDPESR3",182,0)
 ;
"RTN","RCDPESR4")
0^4^B67024899
"RTN","RCDPESR4",1,0)
RCDPESR4 ;ALB/TMK - Server interface 835ERA processing ;06/03/02
"RTN","RCDPESR4",2,0)
 ;;4.5;Accounts Receivable;**173,216,208**;Mar 20, 1995
"RTN","RCDPESR4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR4",4,0)
 ;
"RTN","RCDPESR4",5,0)
ERAEOBIN(RCTXN,RCD,RCGBL,RCEFLG) ; Store/process 835ERA or 835XFR
"RTN","RCDPESR4",6,0)
 ;  transaction coming into the site
"RTN","RCDPESR4",7,0)
 ; RCTXN = data on the hdr record of the msg text
"RTN","RCDPESR4",8,0)
 ; RCD = array with formatted hdr data
"RTN","RCDPESR4",9,0)
 ; RCGBL = name of the array or global where the msg is stored
"RTN","RCDPESR4",10,0)
 ; RCEFLG = error flag returned if passed by REF
"RTN","RCDPESR4",11,0)
 ;
"RTN","RCDPESR4",12,0)
 N RCLAST,RCBILL,RCTDA,RCMSG,RCERR
"RTN","RCDPESR4",13,0)
 S (RCTDA,RCEFLG)=0
"RTN","RCDPESR4",14,0)
 ;
"RTN","RCDPESR4",15,0)
 L +^RCY(344.5,"AMSEQ",+$P(RCTXN,U,13))
"RTN","RCDPESR4",16,0)
 S RCMSG=$$EXTERA(RCTXN,.RCLAST,.RCBILL) ; Extract from mail msg
"RTN","RCDPESR4",17,0)
 ;
"RTN","RCDPESR4",18,0)
 ; If full msg received (99^$ record exists), file it
"RTN","RCDPESR4",19,0)
 I 'RCLAST,'$G(RCERR) D  ;No $ as last character of msg
"RTN","RCDPESR4",20,0)
 . S RCERR=2
"RTN","RCDPESR4",21,0)
 ;
"RTN","RCDPESR4",22,0)
 I RCLAST S RCTDA=+$$ADD(RCGBL,RCD("MSG#"),RCMSG,.RCBILL,.RCERR,.RCD)
"RTN","RCDPESR4",23,0)
 ;
"RTN","RCDPESR4",24,0)
 I $G(RCERR)>0 D
"RTN","RCDPESR4",25,0)
 . D ERRUPD^RCDPESR1(RCGBL,.RCD,$P(RCTXN,U),.RCERR)
"RTN","RCDPESR4",26,0)
 . I RCTDA D  ; Store exception msgs in file 344.5
"RTN","RCDPESR4",27,0)
 .. N A,C,Z
"RTN","RCDPESR4",28,0)
 .. S C=1,A(1)="Date: "_$$FMTE^XLFDT($$NOW^XLFDT(),2)
"RTN","RCDPESR4",29,0)
 .. I $G(^TMP("RCERR",$J,"TEXT"))'="" S C=C+1,A(C)=^TMP("RCERR",$J,"TEXT"),C=C+1,A(C)=" "
"RTN","RCDPESR4",30,0)
 .. S Z=0 F  S Z=$O(^TMP("RCERR",$J,"MSG",Z)) Q:'Z  S C=C+1,A(C)=^(Z)
"RTN","RCDPESR4",31,0)
 .. I $O(A(0)) D WP^DIE(344.5,RCTDA_",",5,"A","A")
"RTN","RCDPESR4",32,0)
 . S RCEFLG=1
"RTN","RCDPESR4",33,0)
 ;
"RTN","RCDPESR4",34,0)
 L -^RCY(344.5,"AMSEQ",+$P(RCTXN,U,13))
"RTN","RCDPESR4",35,0)
 I $P(RCTXN,U)'["XFR",$P(RCTXN,U,12)'="" D TAXERR^RCDPESR1("ERA",$P(RCTXN,U,6)_"  Payer ID: "_$P(RCTXN,U,7),$P(RCTXN,U,11),$P(RCTXN,U,12)) ; Send bad tax id bulletin
"RTN","RCDPESR4",36,0)
 ;
"RTN","RCDPESR4",37,0)
 Q
"RTN","RCDPESR4",38,0)
 ;
"RTN","RCDPESR4",39,0)
EXTERA(RCTXN,RCLAST,RCBILL) ;Extract 835ERA or 835XFR transaction
"RTN","RCDPESR4",40,0)
 ; INPUT:
"RTN","RCDPESR4",41,0)
 ;   RCTXN = data on 835ERA/835XFR hdr record
"RTN","RCDPESR4",42,0)
 ;   RCLAST = passed by REF and returned=1 if entire record exists
"RTN","RCDPESR4",43,0)
 ;
"RTN","RCDPESR4",44,0)
 ; OUTPUT:
"RTN","RCDPESR4",45,0)
 ;   ^TMP("RCMSG",$J,1,"D",line #)=formatted hdr data
"RTN","RCDPESR4",46,0)
 ;   ^TMP("RCMSG",$J,2,"D",line #)=raw msg data
"RTN","RCDPESR4",47,0)
 ;   if passed by ref, RCLAST = 1 if '99' record found
"RTN","RCDPESR4",48,0)
 ;   if passed by ref, RCBILL(AR bill number) is returned
"RTN","RCDPESR4",49,0)
 ;         with a 'list' of bills included in the ERA.  If an
"RTN","RCDPESR4",50,0)
 ;         entry = 1, 3rd party bill was found in file 430.
"RTN","RCDPESR4",51,0)
 ;         If the entry = 2, the 3rd party bill found was not active
"RTN","RCDPESR4",52,0)
 ; Function returns existing ien in file 344.5 for multi part ERAs
"RTN","RCDPESR4",53,0)
 ;
"RTN","RCDPESR4",54,0)
 N CT,LINE,HCT,RCH,RCMSG,RCREFORM,RCINS,RCSTAT,B
"RTN","RCDPESR4",55,0)
 S (RCLAST,HCT,RCH)=0
"RTN","RCDPESR4",56,0)
 ;
"RTN","RCDPESR4",57,0)
 ; Check if sequence control # already exists or if a new record needed
"RTN","RCDPESR4",58,0)
 S RCMSG=+$O(^RCY(344.5,"AMSEQ",+$P(RCTXN,U,13),0))
"RTN","RCDPESR4",59,0)
 S CT=0
"RTN","RCDPESR4",60,0)
 I 'RCMSG D  ; Build display data for the first sequence only
"RTN","RCDPESR4",61,0)
 . S HCT=HCT+1 S LINE(HCT)="Payer Name: "_$P(RCTXN,U,6)_"    Payer ID: "_$P(RCTXN,U,7)
"RTN","RCDPESR4",62,0)
 . S HCT=HCT+1,LINE(HCT)="Trace #: "_$P(RCTXN,U,8)
"RTN","RCDPESR4",63,0)
 . S HCT=HCT+1,LINE(HCT)="Date Paid: "_$$FDT^RCDPESR9($P(RCTXN,U,9))_"    Total Amt Paid: "_$J($P(RCTXN,U,10)/100,0,2)
"RTN","RCDPESR4",64,0)
 . I $P(RCTXN,U)["XFR",$P(RCTXN,U,16)'="" S HCT=HCT+1,LINE(HCT)="Contact Info: "_$P(RCTXN,U,16)
"RTN","RCDPESR4",65,0)
 . M ^TMP("RCMSG",$J,1,"D")=LINE
"RTN","RCDPESR4",66,0)
 . S CT=CT+1,^TMP("RCMSG",$J,2,"D",CT)=RCTXN
"RTN","RCDPESR4",67,0)
 ;
"RTN","RCDPESR4",68,0)
 S ^TMP("RCMSG",$J,0)=RCTXN
"RTN","RCDPESR4",69,0)
 S RCREFORM=""
"RTN","RCDPESR4",70,0)
 F  X XMREC Q:XMER<0  D  Q:RCLAST
"RTN","RCDPESR4",71,0)
 . I +XMRG=99,$P(XMRG,U,2)="$" S RCLAST=1 Q
"RTN","RCDPESR4",72,0)
 . I +XMRG=5,$P(XMRG,U,2)'="" D
"RTN","RCDPESR4",73,0)
 .. S RCREFORM="",RCSTAT=1
"RTN","RCDPESR4",74,0)
 .. ; Check if bill is in AR & is a 3rd party bill
"RTN","RCDPESR4",75,0)
 .. S RCBILL=$$BILL^RCDPESR1($P(XMRG,U,2),+$P(XMRG,U,9),.RCINS)
"RTN","RCDPESR4",76,0)
 .. I '$G(RCINS)!(RCBILL<0) S (RCBILL,RCSTAT)=0
"RTN","RCDPESR4",77,0)
 .. I RCBILL S B=$P($G(^PRCA(430,RCBILL,0)),U) I B'=$P(XMRG,U,2) S $P(XMRG,U,2)=B,RCREFORM=B
"RTN","RCDPESR4",78,0)
 .. I RCBILL,$P(^PRCA(430.3,+$P($G(^PRCA(430,+RCBILL,0)),U,8),0),U,3)'=102 S RCSTAT=2
"RTN","RCDPESR4",79,0)
 .. S RCBILL($P(XMRG,U,2))=RCSTAT
"RTN","RCDPESR4",80,0)
 . I RCREFORM'="",+XMRG>5 S $P(XMRG,U,2)=RCREFORM
"RTN","RCDPESR4",81,0)
 . S:XMRG'="" CT=CT+1,^TMP("RCMSG",$J,2,"D",CT)=XMRG
"RTN","RCDPESR4",82,0)
 Q RCMSG
"RTN","RCDPESR4",83,0)
 ;
"RTN","RCDPESR4",84,0)
ADD(RCGBL,RCDMSG,RCMSG,RCBILL,RCERR,RCD) ; Add msg(s) in @RCGBL to
"RTN","RCDPESR4",85,0)
 ;  file 344.5
"RTN","RCDPESR4",86,0)
 ; RCGBL = name of the global used to store the msg data
"RTN","RCDPESR4",87,0)
 ; RCDMSG = Mailman msg number the ERA arrived in.
"RTN","RCDPESR4",88,0)
 ; RCMSG = ien of the existing entry in file 344.5 for multipart ERAs
"RTN","RCDPESR4",89,0)
 ; RCBILL(AR bill number) = list of bills included, pass by REF
"RTN","RCDPESR4",90,0)
 ; RCD = array with formatted hdr data
"RTN","RCDPESR4",91,0)
 ;
"RTN","RCDPESR4",92,0)
 ;   Errors returned in RCERR and RCERR(n)
"RTN","RCDPESR4",93,0)
 ;   Function returns entry # of msg added or "" if none added
"RTN","RCDPESR4",94,0)
 ;
"RTN","RCDPESR4",95,0)
 N RCHDR,RCTYP,RCIEN
"RTN","RCDPESR4",96,0)
 S RCHDR=$G(^TMP("RCMSGH",$J,0))
"RTN","RCDPESR4",97,0)
 S RCTYP=$P(RCHDR,U)
"RTN","RCDPESR4",98,0)
 S RCIEN=$S($G(RCMSG):RCMSG,1:$$ADDTXN(RCHDR,RCDMSG)) ;File msg hdr
"RTN","RCDPESR4",99,0)
 I RCIEN'>0 S RCERR=3 ;msg hdr can't be filed
"RTN","RCDPESR4",100,0)
 I '$G(RCERR) D LOADDET(RCIEN,RCGBL,RCHDR,.RCBILL,.RCD,.RCERR)
"RTN","RCDPESR4",101,0)
 I '$G(RCERR),'$O(RCERR(0)),RCTYP["835ERA",'$P($G(^RCY(344.5,RCIEN,0)),U,8) D TASKERA^RCDPESR2(RCIEN) ;Task to upd VistA for complete 835ERA only
"RTN","RCDPESR4",102,0)
 ;
"RTN","RCDPESR4",103,0)
 Q $S($G(RCIEN)>0&'$G(RCERR):RCIEN,1:"")
"RTN","RCDPESR4",104,0)
 ;
"RTN","RCDPESR4",105,0)
ADDTXN(RCDATA,RCDMSG) ; Add a trxn for msg in RCDATA to file 344.5
"RTN","RCDPESR4",106,0)
 ; RCDATA = data on the msg hdr record
"RTN","RCDPESR4",107,0)
 ; RCDMSG = Mailman msg number the ERA arrived in
"RTN","RCDPESR4",108,0)
 ;Function returns ien of the new entry in file 344.5 or "" if an error
"RTN","RCDPESR4",109,0)
 ;
"RTN","RCDPESR4",110,0)
 N A,RCY,DLAYGO,DIC,DD,DO,DA,X,Y,Z
"RTN","RCDPESR4",111,0)
 ;
"RTN","RCDPESR4",112,0)
 S (X,A)=RCDMSG ;Use msg ID as basis for the .01 field
"RTN","RCDPESR4",113,0)
 F Z=1:1 Q:'$D(^RCY(344.5,"B",A))  S A=X_"."_Z
"RTN","RCDPESR4",114,0)
 S X=A
"RTN","RCDPESR4",115,0)
 S DIC(0)="L",DIC="^RCY(344.5,",DLAYGO=344.5
"RTN","RCDPESR4",116,0)
 S DIC("DR")=".02////"_$E($P(RCDATA,U),1,6)_";.03///^S X=""NOW"";.04////0;.06////"_$S($P(RCDATA,U)'["XFR":1,1:0)_$S($P(RCDATA,U,13)'="":";.09////"_+$P(RCDATA,U,13)_";.08////1",1:"")_";.1////2;.11////"_RCDMSG
"RTN","RCDPESR4",117,0)
 I $P(RCDATA,U,6)'="" S DIC("DR")=DIC("DR")_";3.01////"_$P(RCDATA,U,6)
"RTN","RCDPESR4",118,0)
 D FILE^DICN K DO,DD,DLAYGO,DA,DIC
"RTN","RCDPESR4",119,0)
 S RCY=+Y
"RTN","RCDPESR4",120,0)
 Q $S(RCY>0:+RCY,1:"")
"RTN","RCDPESR4",121,0)
 ;
"RTN","RCDPESR4",122,0)
LOADDET(RCTDA,RCGBL,RCHDR,RCBILL,RCD,RCERR) ; Load the rest of the text
"RTN","RCDPESR4",123,0)
 ; into the msg
"RTN","RCDPESR4",124,0)
 ; RCTDA = ien in file 344.5
"RTN","RCDPESR4",125,0)
 ; RCGBL = name of the array holding the detail msg text to be loaded
"RTN","RCDPESR4",126,0)
 ; RCHDR = data on ERA hdr record
"RTN","RCDPESR4",127,0)
 ; RCBILL(AR bill number) = list of bills included, pass by REF
"RTN","RCDPESR4",128,0)
 ; RCD = array with formatted hdr data
"RTN","RCDPESR4",129,0)
 ;
"RTN","RCDPESR4",130,0)
 ; OUTPUT: RCERR if any errors found, pass by REF
"RTN","RCDPESR4",131,0)
 ;
"RTN","RCDPESR4",132,0)
 N RCE,RCDATA,RCMSG,RCFROM,Z,Z0
"RTN","RCDPESR4",133,0)
 K ^TMP("RCTEXT",$J),^TMP("RCRAW",$J)
"RTN","RCDPESR4",134,0)
 ;
"RTN","RCDPESR4",135,0)
 M ^TMP("RCTEXT",$J)=@RCGBL@(1,"D")
"RTN","RCDPESR4",136,0)
 M ^TMP("RCRAW",$J)=@RCGBL@(2,"D")
"RTN","RCDPESR4",137,0)
 ;
"RTN","RCDPESR4",138,0)
 S RCDATA=$G(^RCY(344.5,RCTDA,0)),RCMSG=$G(RCD("MSG#")),RCFROM=$G(RCD("FROM"))
"RTN","RCDPESR4",139,0)
 ;
"RTN","RCDPESR4",140,0)
 ; For multi-part ERA, don't update if sequence already filed
"RTN","RCDPESR4",141,0)
 ; Add seq # if not already there
"RTN","RCDPESR4",142,0)
 I $P(RCHDR,U)'["XFR",$P(RCHDR,U,13) Q:$D(^RCY(344.5,RCTDA,"S","B",+$P(RCHDR,U,14)))
"RTN","RCDPESR4",143,0)
 ;
"RTN","RCDPESR4",144,0)
 D STOREM(+$G(RCTDA),"^TMP(""RCTEXT"",$J)","^TMP(""RCRAW"",$J)",.RCE)
"RTN","RCDPESR4",145,0)
 ;
"RTN","RCDPESR4",146,0)
 I $D(RCE("DIERR")) D  ; Extract error
"RTN","RCDPESR4",147,0)
 . N DIE,DA,DR,X,Y
"RTN","RCDPESR4",148,0)
 . D EXTERR^RCDPESR1(.RCERR,.RCE)
"RTN","RCDPESR4",149,0)
 . S:$L($G(RCE)) RCERR(+$O(RCERR(""),-1)+1)=RCE
"RTN","RCDPESR4",150,0)
 . I $D(^RCY(344.5,RCTDA,0)) S DIE="^RCY(344.5,",DR=".1////4",DA=RCTDA D ^DIE
"RTN","RCDPESR4",151,0)
 E  D  ; No error - store rest of data
"RTN","RCDPESR4",152,0)
 . N Z,RCT,RCCT,RCX,RCB ; Add bills included in ERA
"RTN","RCDPESR4",153,0)
 . S RCT=0,RCCT=0,RCX=$J("",4)
"RTN","RCDPESR4",154,0)
 . S Z="" F  S Z=$O(RCBILL(Z)) Q:Z=""  D
"RTN","RCDPESR4",155,0)
 .. N DO,DD,DIC,DLAYGO,X,Y
"RTN","RCDPESR4",156,0)
 .. S:RCT=4 RCCT=RCCT+1,RCB(RCCT)=RCX,RCT=0,RCX=$J("",4) S RCX=RCX_$E($S(+RCBILL(Z):"",1:"*")_Z_$J("",15),1,15),RCT=RCT+1
"RTN","RCDPESR4",157,0)
 .. S DIC(0)="L",DIC("DR")=".02////"_$S($G(RCBILL(Z)):1,1:0),X=Z,DA(1)=RCTDA,DIC="^RCY(344.5,"_DA(1)_",""B"",",DLAYGO=344.54 D FILE^DICN K DO,DD,DLAYGO,DIC
"RTN","RCDPESR4",158,0)
 .. ;
"RTN","RCDPESR4",159,0)
 . I $L(RCX)>4 S RCCT=RCCT+1,RCB(RCCT)=RCX
"RTN","RCDPESR4",160,0)
 . ; Add list of bills to display data
"RTN","RCDPESR4",161,0)
 . I $O(RCB(0)) D WP^DIE(344.5,RCTDA_",",1,"A","RCB")
"RTN","RCDPESR4",162,0)
 . ; Add seq #
"RTN","RCDPESR4",163,0)
 . S DA(1)=RCTDA,DIC="^RCY(344.5,"_DA(1)_",""S"",",DIC(0)="L",X=$P(RCHDR,U,14),DIC("DR")=".02////"_$S($P(RCHDR,U,15)="Y":1,1:0)_";.03///^S X=""NOW"";.04////"_RCMSG,X=+$P(RCHDR,U,14),DLAYGO=344.53
"RTN","RCDPESR4",164,0)
 . D FILE^DICN K DO,DD,DLAYGO,DIC
"RTN","RCDPESR4",165,0)
 . ;
"RTN","RCDPESR4",166,0)
 . I $P(RCHDR,U)["835XFR" D XFR^RCDPESR5(RCTDA,RCFROM,RCMSG,.RCD) Q
"RTN","RCDPESR4",167,0)
 . ;
"RTN","RCDPESR4",168,0)
 . ; Proceed only if not a transfer record
"RTN","RCDPESR4",169,0)
 . I $P(RCDATA,U,9)'="" D  ; Determine if all sequences received yet
"RTN","RCDPESR4",170,0)
 .. N RCOK,RCLAST
"RTN","RCDPESR4",171,0)
 .. S RCOK=1,RCLAST=0
"RTN","RCDPESR4",172,0)
 .. F Z=1:1 Q:'RCOK!RCLAST  D
"RTN","RCDPESR4",173,0)
 ... I 'RCLAST,'$D(^RCY(344.5,RCTDA,"S","B",Z)) S RCOK=0 Q
"RTN","RCDPESR4",174,0)
 ... S Z0=+$O(^RCY(344.5,RCTDA,"S","B",Z,0)),Z0=$G(^RCY(344.5,RCTDA,"S",Z0,0))
"RTN","RCDPESR4",175,0)
 ... I Z0="" S RCOK=0 Q
"RTN","RCDPESR4",176,0)
 ... I $P(Z0,U,2) S RCLAST=1 ; Last sequence received and all before it
"RTN","RCDPESR4",177,0)
 .. ;
"RTN","RCDPESR4",178,0)
 .. I RCOK D
"RTN","RCDPESR4",179,0)
 ... N DA,DIE,DR,X,Y
"RTN","RCDPESR4",180,0)
 ... S DA=RCTDA,DR=".08////0;.1///@",DIE="^RCY(344.5," D ^DIE
"RTN","RCDPESR4",181,0)
 ... I '$O(^RCY(344.5,RCTDA,"B","AV",1,0)) D  ; No valid bills found
"RTN","RCDPESR4",182,0)
 .... N RCE
"RTN","RCDPESR4",183,0)
 .... S RCE(1)="No valid bills for this site were found in this ERA"
"RTN","RCDPESR4",184,0)
 .... S RCE(2)="Review/correct the bill #'s on this ERA in your transmission exceptions"
"RTN","RCDPESR4",185,0)
 .... S RCE(3)="Please contact the Implementation Manager group to report this situation",RCE(4)=" "
"RTN","RCDPESR4",186,0)
 .... D BULLERA^RCDPESR0("D"_$S($O(^RCY(344.5,RCTDA,2,0)):"F",1:""),RCTDA,$G(RCD("MSG#")),"EDI LBOX - NO VALID BILLS ON ERA "_$E($G(RCD("PAYFROM")),1,20),.RCE,0)
"RTN","RCDPESR4",187,0)
 .... S DA=RCTDA,DR=".08////1;.1////6",DIE="^RCY(344.5," D ^DIE
"RTN","RCDPESR4",188,0)
 ;
"RTN","RCDPESR4",189,0)
 K ^TMP("RCTEXT",$J),^TMP("RCRAW",$J)
"RTN","RCDPESR4",190,0)
 Q
"RTN","RCDPESR4",191,0)
 ;
"RTN","RCDPESR4",192,0)
STOREM(RCTDA,RCDISP,RCTEXT,RCE) ;Store msg text in file 344.5
"RTN","RCDPESR4",193,0)
 ; INPUT:
"RTN","RCDPESR4",194,0)
 ;   RCTDA = ien of the entry in file 344.5
"RTN","RCDPESR4",195,0)
 ;   RCDISP = name of the array where display msg text is retrieved from
"RTN","RCDPESR4",196,0)
 ;            or "@" to delete the text from the display text field
"RTN","RCDPESR4",197,0)
 ;   RCTEXT = name of the array where raw msg text is retrieved from
"RTN","RCDPESR4",198,0)
 ;            or "@" to delete the text from the raw msg field
"RTN","RCDPESR4",199,0)
 ; OUTPUT:
"RTN","RCDPESR4",200,0)
 ;   RCE = array of errors (RCE("DIERR")) returned, pass by REF
"RTN","RCDPESR4",201,0)
 ;
"RTN","RCDPESR4",202,0)
 N RCZ,X,Y,DIE
"RTN","RCDPESR4",203,0)
 K RCE("DIERR")
"RTN","RCDPESR4",204,0)
 ;
"RTN","RCDPESR4",205,0)
 I $S($G(RCDISP)="@":1,1:$D(@RCDISP)'<10) D
"RTN","RCDPESR4",206,0)
 . F RCZ=1:1:20 D WP^DIE(344.5,RCTDA_",",1,"AK",""_RCDISP_"","RCE") Q:$S('$D(RCE("DIERR")):1,+RCE("DIERR")=1:$G(RCE("DIERR",1))'=110,1:1)  K:RCZ<20 RCE("DIERR") ; On lock error, retry up to 20 times
"RTN","RCDPESR4",207,0)
 ;
"RTN","RCDPESR4",208,0)
 I '$O(RCE("DIERR",0)),$S($G(RCTEXT)="@":1,1:$D(@RCTEXT)'<10) D
"RTN","RCDPESR4",209,0)
 . F RCZ=1:1:20 D WP^DIE(344.5,RCTDA_",",2,"AK",""_RCTEXT_"","RCE") Q:$S('$D(RCE("DIERR")):1,+RCE("DIERR")=1:$G(RCE("DIERR",1))'=110,1:1)  K:RCZ<20 RCE("DIERR") ; On lock error, retry up to 20 times
"RTN","RCDPESR4",210,0)
 Q
"RTN","RCDPESR4",211,0)
 ;
"RTN","RCDPESR5")
0^23^B27354916
"RTN","RCDPESR5",1,0)
RCDPESR5 ;ALB/TMK - Server interface 835XFR processing ;10/01/02
"RTN","RCDPESR5",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPESR5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR5",4,0)
 ;
"RTN","RCDPESR5",5,0)
XFR(RCTDA,RCFROM,RCMSG,RCD) ; Send bulletin, update 344.5 for transfer EOB into site
"RTN","RCDPESR5",6,0)
 ; RCTDA = ien in file 344.5 being updated
"RTN","RCDPESR5",7,0)
 ; RCFROM = the sender's mail address from the mail message
"RTN","RCDPESR5",8,0)
 ; RCMSG = message # the data was received in
"RTN","RCDPESR5",9,0)
 ; RCD = array containing formatted header data
"RTN","RCDPESR5",10,0)
 ;
"RTN","RCDPESR5",11,0)
 N RCCT,RCDXM,DA,DR,DIE,X,Y,Z,RCFROMNM
"RTN","RCDPESR5",12,0)
 S Z=$P($P(RCD("SUBJ"),"REF #",2),"#"),RCFROMNM=$TR($P(RCFROM,"@",2),">")
"RTN","RCDPESR5",13,0)
 I RCFROMNM="" S RCFROMNM=RCFROM
"RTN","RCDPESR5",14,0)
 S DA=RCTDA,DR=".05///@;.08////1;.1///3"_$S($P(RCFROM,"@",2)'="":";.12////"_RCFROMNM,1:"")_";.13////^S X=("_+Z_"_$C(59)_"_$P(Z,";",2)_")"_$S($G(RCD("PAYFROM"))'="":";3.01////"_RCD("PAYFROM"),1:"")
"RTN","RCDPESR5",15,0)
 S DIE="^RCY(344.5," D ^DIE
"RTN","RCDPESR5",16,0)
 ;
"RTN","RCDPESR5",17,0)
 D SENDACK(RCTDA,"") ; acknowledge receipt of transferred EOB
"RTN","RCDPESR5",18,0)
 ;
"RTN","RCDPESR5",19,0)
 S RCDXM(1)="An EEOB transmission has been received by the EDI Lockbox",RCDXM(2)="  system that was sent to you from another VistA site.  Please review"
"RTN","RCDPESR5",20,0)
 S RCDXM(3)="  it in EEOB exception processing and file the EEOB if it belongs to your",RCDXM(4)="  site or delete the message to return the EEOB to the site it was sent from."
"RTN","RCDPESR5",21,0)
 S RCDXM(5)=" ",RCDXM(6)="The message was sent by "_RCFROM
"RTN","RCDPESR5",22,0)
 S RCDXM(7)="The mail message number is "_RCMSG
"RTN","RCDPESR5",23,0)
 S RCDXM(8)=" ",RCDXM(9)="EEOB DATA INCLUDED:"
"RTN","RCDPESR5",24,0)
 S RCCT=9
"RTN","RCDPESR5",25,0)
 K ^TMP($J)
"RTN","RCDPESR5",26,0)
 D DISP^RCDPESR0("^RCY(344.5,"_RCTDA_",2)","^TMP($J,""PRCA_EXT"")",1,"^TMP($J,""PRCA_LINES"")",70)
"RTN","RCDPESR5",27,0)
 S Z=0 F  S Z=$O(^TMP($J,"PRCA_LINES",Z)) Q:'Z  S RCCT=RCCT+1,RCDXM(RCCT)=$J("",3)_$G(^TMP($J,"PRCA_LINES",Z))
"RTN","RCDPESR5",28,0)
 D BULLERA^RCDPESR0("",RCTDA,RCMSG,"EDI LBOX EEOB FROM "_$E(RCFROMNM,1,18)_" FOR "_$E($G(RCD("PAYFROM")),1,20),.RCDXM,1)
"RTN","RCDPESR5",29,0)
 K ^TMP($J)
"RTN","RCDPESR5",30,0)
 Q
"RTN","RCDPESR5",31,0)
 ;
"RTN","RCDPESR5",32,0)
SENDACK(RCTDA,RCSTAT) ; Send accept/reject msg to transf 'from' site
"RTN","RCDPESR5",33,0)
 ; RCTDA = ien of entry file 344.5
"RTN","RCDPESR5",34,0)
 ; RCSTAT = flag to indicate what happened
"RTN","RCDPESR5",35,0)
 ;   values:  "" = receipt   1 = accepted   0 = rejected
"RTN","RCDPESR5",36,0)
 ;
"RTN","RCDPESR5",37,0)
 N RC,RC0,RCDOM,RCREF,XMTO,XMBODY,XMZ
"RTN","RCDPESR5",38,0)
 ; Send a mail message to sending site for accept/reject of EOB
"RTN","RCDPESR5",39,0)
 S RC0=$G(^RCY(344.5,RCTDA,0)),RCREF=$P(RC0,U,13)
"RTN","RCDPESR5",40,0)
 S RCDOM="@"_$S($P(RC0,U,12)'="":$P(RC0,U,12),1:$$KSP^XUPARAM("WHERE")) S:RCDOM="@" RCDOM=""
"RTN","RCDPESR5",41,0)
 I RCREF,$P(RCREF,";",2) D
"RTN","RCDPESR5",42,0)
 . ; 835ACK^accept/reject flag (""/0/1)^ien file 344_;_ien file 344.41
"RTN","RCDPESR5",43,0)
 . S RC(1)="835XAK^"_RCSTAT_U_+$P(RCREF,";")_";"_+$P(RCREF,";",2)
"RTN","RCDPESR5",44,0)
 . S XMBODY="RC",XMTO("S.RCDPE EDI LOCKBOX SERVER"_RCDOM)=""
"RTN","RCDPESR5",45,0)
 . D
"RTN","RCDPESR5",46,0)
 .. N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR5",47,0)
 .. D SENDMSG^XMXAPI(.5,"TRANSFER EEOB ACKNOWLEDGEMENT",XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR5",48,0)
 Q
"RTN","RCDPESR5",49,0)
 ;
"RTN","RCDPESR5",50,0)
FILEEOB(RCTDA) ; Files trans-in EOB in IB
"RTN","RCDPESR5",51,0)
 N DIE,DA,DR,X,Y,RCE
"RTN","RCDPESR5",52,0)
 D UPDEOB^RCDPESR2(RCTDA,5)
"RTN","RCDPESR5",53,0)
 I $D(^RCY(344.5,RCTDA,0)) D
"RTN","RCDPESR5",54,0)
 . S DIE="^RCY(344.5,",DR=".04////0;.05///@;.1////5",DA=RCTDA D ^DIE
"RTN","RCDPESR5",55,0)
 Q
"RTN","RCDPESR5",56,0)
 ;
"RTN","RCDPESR5",57,0)
BULL1(RCTDA,RCERR,DUP) ; Send bulletin for EDI Lockbox EOB exceptions
"RTN","RCDPESR5",58,0)
 ; RCTDA = ien of entry in file 344.5
"RTN","RCDPESR5",59,0)
 ; RCERR = the name of the error global
"RTN","RCDPESR5",60,0)
 ; DUP = ien of existing entry in file 344.4 if ERA is duplicate
"RTN","RCDPESR5",61,0)
 ;
"RTN","RCDPESR5",62,0)
 N RCSUBJ
"RTN","RCDPESR5",63,0)
 S RCSUBJ="EDI LBOX "_$S(DUP:"ERA - DUPLICATE TRANSMISSION MSG #"_DUP,1:" EEOB - EXCEPTIONS")_" "_$E($P($G(^RCY(344.5,RCTDA,3)),U),1,20)
"RTN","RCDPESR5",64,0)
 S RCSUBJ=$E(RCSUBJ,1,65)
"RTN","RCDPESR5",65,0)
 S DUP=+$G(DUP)
"RTN","RCDPESR5",66,0)
 D BULLERA^RCDPESR0("D",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),RCSUBJ,RCERR,0)
"RTN","RCDPESR5",67,0)
 Q
"RTN","RCDPESR5",68,0)
 ;
"RTN","RCDPESR5",69,0)
BULL2(RCTDA,RCERR,RCXMG) ; Send bulletin for EOB transfer received at site
"RTN","RCDPESR5",70,0)
 ; RCTDA = ien of entry in file 344.5
"RTN","RCDPESR5",71,0)
 ; RCXMG = incoming message #
"RTN","RCDPESR5",72,0)
 ; RCERR = the name of the error global
"RTN","RCDPESR5",73,0)
 ;
"RTN","RCDPESR5",74,0)
 N RCDIQ,RCXM,RCXM1,XMBODY,XMZ,XMTO,RC,Z,Q,RCSUBJ
"RTN","RCDPESR5",75,0)
 S RCSUBJ="EDI LBOX EEOB DETAIL RE-FILE ATTEMPTED TO IB"
"RTN","RCDPESR5",76,0)
 S XMTO("I:G.RCDPE PAYMENTS")="",RC=0
"RTN","RCDPESR5",77,0)
 K ^TMP("RCERR_BULL2",$J)
"RTN","RCDPESR5",78,0)
 S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)="The following EEOB was received at your site.",RC=RC+1,^TMP("RCERR_BULL2",$J,RC)="It was received on: "_$$FMTE^XLFDT($$NOW^XLFDT(),2)_" in mail msg # "_RCXMG_"."
"RTN","RCDPESR5",79,0)
 S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)="The initial attempt to file this data in IB failed and this message",RC=RC+1,^TMP("RCERR_BULL2",$J,RC)="is the result of a subsequent attempt to file this EEOB detail data in IB"
"RTN","RCDPESR5",80,0)
 S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=" "
"RTN","RCDPESR5",81,0)
 D GETS^DIQ(344.4,+RCTDA_",","*","IEN","RCDIQ")
"RTN","RCDPESR5",82,0)
 D TXT0^RCDPEX31(+RCTDA,.RCDIQ,.RCXM,0)
"RTN","RCDPESR5",83,0)
 S Z=0 F  S Z=$O(RCXM(Z)) Q:'Z  S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=RCXM(Z)
"RTN","RCDPESR5",84,0)
 I $G(RCERR)'="",$E(RCERR,1,5)'="^TMP(" S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=RCERR,RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=" "
"RTN","RCDPESR5",85,0)
 S RCERR=$S($E(RCERR,1,5)="^TMP(":RCERR,1:"RCERR")
"RTN","RCDPESR5",86,0)
 I $O(@RCERR@(""))'="" D
"RTN","RCDPESR5",87,0)
 . S Z="" F  S Z=$O(@RCERR@(Z)) Q:Z=""  D
"RTN","RCDPESR5",88,0)
 .. I $G(@RCERR@(Z))'="" S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=@RCERR@(Z)
"RTN","RCDPESR5",89,0)
 .. I $O(@RCERR@(Z,0)) S Q="" F  S Q=$O(@RCERR@(Z,Q)) Q:Q=""  S RC=RC+1,^TMP("RCERR_BULL2",$J,RC)=@RCERR@(Z,Q)
"RTN","RCDPESR5",90,0)
 S XMBODY="^TMP(""RCERR_BULL2"","_$J_")"
"RTN","RCDPESR5",91,0)
 D
"RTN","RCDPESR5",92,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPESR5",93,0)
 . D SENDMSG^XMXAPI(.5,$E(RCSUBJ,1,65),XMBODY,.XMTO,,.XMZ)
"RTN","RCDPESR5",94,0)
 K ^TMP("RCERR_BULL2",$J)
"RTN","RCDPESR5",95,0)
 Q
"RTN","RCDPESR5",96,0)
 ;
"RTN","RCDPESR5",97,0)
DISP1(RCCT,RCNOH) ; Extract formatted EOB detail for bill
"RTN","RCDPESR5",98,0)
 ; RCCT = bill seq# within ERA transmission
"RTN","RCDPESR5",99,0)
 ; RCNOH = 1 if no header text needed on 05 rec
"RTN","RCDPESR5",100,0)
 ;
"RTN","RCDPESR5",101,0)
 ; Error array returned in ^TMP("RCERR1",$J)
"RTN","RCDPESR5",102,0)
 ;
"RTN","RCDPESR5",103,0)
 N RC1,RC2,RCCT1,Z
"RTN","RCDPESR5",104,0)
 D DISP^RCDPESR0("^TMP($J,""RCDP-EOB"","_RCCT_")","RC1",1)
"RTN","RCDPESR5",105,0)
 D FMTDSP^RCDPESR0("RC1","RC2",75,RCNOH)
"RTN","RCDPESR5",106,0)
 S Z=0,RCCT1=$O(^TMP("RCERR1",$J,RCCT," "),-1)
"RTN","RCDPESR5",107,0)
 F  S Z=$O(RC2(Z)) Q:'Z  S RCCT1=RCCT1+1,^TMP("RCERR1",$J,RCCT,RCCT1)=RC2(Z)
"RTN","RCDPESR5",108,0)
 Q
"RTN","RCDPESR5",109,0)
 ;
"RTN","RCDPESR6")
0^10^B26998339
"RTN","RCDPESR6",1,0)
RCDPESR6 ;ALB/TMK - Server auto-update file 344.4 - EDI Lockbox ;10/29/02
"RTN","RCDPESR6",2,0)
 ;;4.5;Accounts Receivable;**173,214,208**;Mar 20, 1995
"RTN","RCDPESR6",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPESR6",4,0)
 ;
"RTN","RCDPESR6",5,0)
UPD3444(RCRTOT) ; Add EOB detail to list in 344.41 for file 344.4 entry RCRTOT
"RTN","RCDPESR6",6,0)
 ; If passed by reference, RCRTOT is returned = "" if errors
"RTN","RCDPESR6",7,0)
 ;
"RTN","RCDPESR6",8,0)
 N RC,RCCT,RC1,RC2,RCEOB,DA,DR,DO,DD,DLAYGO,DIC,DIK,X,Y,Z
"RTN","RCDPESR6",9,0)
 S RC=0 F  S RC=$O(^TMP($J,"RCDPEOB",RC)) Q:'RC  S RC1=$G(^(RC)),RC2=$G(^(RC,"EOB")),RCEOB=+RC2 D  Q:'RCRTOT
"RTN","RCDPESR6",10,0)
 . ; Upd 344.41 with reference to this record if it doesn't already exist
"RTN","RCDPESR6",11,0)
 . I RCEOB>0 Q:$D(^RCY(344.4,RCRTOT,1,"AC",RCEOB,RC))
"RTN","RCDPESR6",12,0)
 . I RCEOB'>0,$S($P(RC1,U,2)'="":$D(^RCY(344.4,RCRTOT,1,"AD",$P(RC1,U,2),RC)),1:0) Q
"RTN","RCDPESR6",13,0)
 . S DA(1)=RCRTOT,X=RC,DIC="^RCY(344.4,"_DA(1)_",1,",DIC(0)="L",DLAYGO=344.41
"RTN","RCDPESR6",14,0)
 . S DIC("DR")=$S($G(RCEOB)>0:".02////"_RCEOB,1:".05////"_$P(RC1,U,2)_";.07////1")
"RTN","RCDPESR6",15,0)
 . I $P(RC2,U,2)'="" S DIC("DR")=DIC("DR")_$S($L(DIC("DR")):";",1:"")_".03///"_$P(RC2,U,2) ; amt
"RTN","RCDPESR6",16,0)
 . I $P(RC2,U,3)'="" S DIC("DR")=DIC("DR")_$S($L(DIC("DR")):";",1:"")_".04////"_$P(RC2,U,3) ; ins co
"RTN","RCDPESR6",17,0)
 . I $P(RC2,U,4) S DIC("DR")=DIC("DR")_$S($L(DIC("DR")):";",1:"")_".14////1" ; reversal
"RTN","RCDPESR6",18,0)
 . I $P(RC2,U,5)'="" S DIC("DR")=DIC("DR")_$S($L(DIC("DR")):";",1:"")_".15////^S X=$E($P(RC2,U,5),1,30)" ; Patient name
"RTN","RCDPESR6",19,0)
 . D FILE^DICN K DO,DD,DLAYGO,DIC,DIK
"RTN","RCDPESR6",20,0)
 . S RCCT=+Y
"RTN","RCDPESR6",21,0)
 . I RCCT<0 D  Q
"RTN","RCDPESR6",22,0)
 .. S DA=RCRTOT,DIK="^RCY(344.4," D ^DIK
"RTN","RCDPESR6",23,0)
 .. S RCRTOT=0
"RTN","RCDPESR6",24,0)
 . ; If there is no IB EOB record, store the raw data in 344.411
"RTN","RCDPESR6",25,0)
 . I RC1'>0!(RCEOB'>0) D
"RTN","RCDPESR6",26,0)
 .. N RCDATA,RCC,RCDA
"RTN","RCDPESR6",27,0)
 .. S RCC=2,RCDATA(1)=$G(^TMP($J,"RCDPEOB","HDR"))
"RTN","RCDPESR6",28,0)
 .. S Z=0 F  S Z=$O(^TMP($J,"RCDPEOB",RCCT,Z)) Q:'Z  S RCC=RCC+1,RCDATA(RCC)=$G(^TMP($J,"RCDPEOB",RCCT,Z))
"RTN","RCDPESR6",29,0)
 .. S RCDA(1)=RCRTOT,RCDA=RCCT
"RTN","RCDPESR6",30,0)
 .. D WP^DIE(344.41,$$IENS^DILF(.RCDA),1,"A","RCDATA")
"RTN","RCDPESR6",31,0)
 Q
"RTN","RCDPESR6",32,0)
 ;
"RTN","RCDPESR6",33,0)
ERATOT(RCTDA,RCERR) ; File ERA TOTAL rec in 344.4 from entry RCTDA in 344.5
"RTN","RCDPESR6",34,0)
 ; RCTDA = ien file 344.5
"RTN","RCDPESR6",35,0)
 ; Returns: the ien file 344.4
"RTN","RCDPESR6",36,0)
 ;          RCERR if passed by reference, with error text
"RTN","RCDPESR6",37,0)
 ;          RCERR(1)=duplicated message
"RTN","RCDPESR6",38,0)
 N RCTYPE,RCDA,RCMETH,RCTRACE,RCID,RCDT,RCAMT,RCDUP,RCZ,RCX,RCPAYER,DIE,DIK,DIC,DLAYGO,DD,DO,DR,DA,X,Y,Z0,Z1
"RTN","RCDPESR6",39,0)
 S (RCERR,RCDA)=""
"RTN","RCDPESR6",40,0)
 S RCZ=$G(^RCY(344.5,RCTDA,2,1,0))
"RTN","RCDPESR6",41,0)
 S RCTYPE=$P(RCZ,U),RCTRACE=$P(RCZ,U,8),RCID=$P(RCZ,U,7),RCPAYER=$P(RCZ,U,6),RCMETH=$P(RCZ,U,17)
"RTN","RCDPESR6",42,0)
 ; Need header record as first entry in field
"RTN","RCDPESR6",43,0)
 I RCTYPE'["835ERA" S RCERR="No header record found in message.  An EEOB exception record was created" G ERATOTQ
"RTN","RCDPESR6",44,0)
 ;
"RTN","RCDPESR6",45,0)
 S RCDT=$$FMDT^RCDPESR1($P(RCZ,U,9)),RCAMT=$J(($P(RCZ,U,10)/100),0,2)
"RTN","RCDPESR6",46,0)
 ;Elec ERA's must have a trace # and an ins co id
"RTN","RCDPESR6",47,0)
 I RCTRACE=""!(RCID="") S RCERR="Trace # or ins ID missing on ERA transaction.  An EEOB exception record was created." G ERATOTQ
"RTN","RCDPESR6",48,0)
 ; Make sure it's not already there
"RTN","RCDPESR6",49,0)
 S (RCDUP,Z1)=0
"RTN","RCDPESR6",50,0)
 F  S Z1=$O(^RCY(344.4,"ATRID",RCTRACE,RCID,Z1)) Q:'Z1  S Z0=$G(^RCY(344.4,Z1,0)) I $P(Z0,U,4)=RCDT,+$P(Z0,U,5)=+RCAMT S RCDUP=1 Q
"RTN","RCDPESR6",51,0)
 ;
"RTN","RCDPESR6",52,0)
 I RCDUP,$P(Z0,U,8) D  G ERATOTQ ; Receipt already exists - no update
"RTN","RCDPESR6",53,0)
 . S RCERR="This is a duplicate ERA and has already been posted",RCERR(1)=-2
"RTN","RCDPESR6",54,0)
 I RCDUP S RCERR="DUP",RCERR(1)=$S($P(Z0,U,12)'=$P($G(^RCY(344.5,RCTDA,0)),U,11):$P(Z0,U,12),1:-1) G ERATOTQ
"RTN","RCDPESR6",55,0)
 ;
"RTN","RCDPESR6",56,0)
 S RCX=+$O(^RCY(344.4," "),-1)
"RTN","RCDPESR6",57,0)
 S DIC(0)="L",DIC="^RCY(344.4,",DLAYGO=344.4
"RTN","RCDPESR6",58,0)
 S DIC("DR")=".02////"_RCTRACE_";.03////"_RCID_";.04////"_RCDT_";.05////"_RCAMT_";.06////"_$P(RCZ,U,6)_";.09////0;.12////"_$P($G(^RCY(344.5,RCTDA,0)),U,11)_";.07////"_$$NOW^XLFDT()_";.1////1"
"RTN","RCDPESR6",59,0)
 I RCMETH'="" S DIC("DR")=DIC("DR")_";.15////"_RCMETH
"RTN","RCDPESR6",60,0)
 F RCX=RCX+1:1 L +^RCY(344.4,RCX,0):1 I $T,'$D(^RCY(344.4,RCX,0)) S X=RCX Q
"RTN","RCDPESR6",61,0)
 D FILE^DICN K DO,DLAYGO,DD,DIC
"RTN","RCDPESR6",62,0)
 L -^RCY(344.4,RCX,0)
"RTN","RCDPESR6",63,0)
 S RCDA=$S(Y<0:"",1:+Y)
"RTN","RCDPESR6",64,0)
 I 'RCDA D
"RTN","RCDPESR6",65,0)
 . S RCERR="An error was encountered that prevented the adding of an ERA totals record.  An EEOB exception record was created."
"RTN","RCDPESR6",66,0)
 ;
"RTN","RCDPESR6",67,0)
ERATOTQ Q RCDA
"RTN","RCDPESR6",68,0)
 ;
"RTN","RCDPESR6",69,0)
UPDCON(RCRTOT) ; Add contact information to file 344.4 for an ERA
"RTN","RCDPESR6",70,0)
 N DIE,DA,DR,Z,Q,X,Y
"RTN","RCDPESR6",71,0)
 S Z=$G(^TMP($J,"RCDPEOB","CONTACT"))
"RTN","RCDPESR6",72,0)
 Q:$TR($P(Z,U,3,9),U)=""
"RTN","RCDPESR6",73,0)
 S DA=RCRTOT,DIE="^RCY(344.4,",DR=""
"RTN","RCDPESR6",74,0)
 F Q=3:1:9 S DR=DR_$S(DR'="":";3.0",1:"3.0")_(Q-2)_"///"_$S($P(Z,U,Q)="":"@",1:"/"_$P(Z,U,Q))
"RTN","RCDPESR6",75,0)
 D ^DIE
"RTN","RCDPESR6",76,0)
 Q
"RTN","RCDPESR6",77,0)
 ;
"RTN","RCDPESR6",78,0)
UPDADJ(RCRTOT) ; Add ERA level adj data to file 344.4
"RTN","RCDPESR6",79,0)
 N Z,Z0,DA,DIC,DLAYGO,DR,X,Y,DO,DD
"RTN","RCDPESR6",80,0)
 ; Remove any already there
"RTN","RCDPESR6",81,0)
 S Z=0 F  S Z=$O(^RCY(344.4,RCRTOT,2,Z)) Q:'Z  S DA(1)=RCRTOT,DA=Z D ^DIK
"RTN","RCDPESR6",82,0)
 ;
"RTN","RCDPESR6",83,0)
 S Z=0 F  S Z=$O(^TMP($J,"RCDPEOB","ADJ",Z)) Q:'Z  S Z0=$G(^(Z)) D
"RTN","RCDPESR6",84,0)
 . S DIC(0)="L",X=$P(Z0,U,3)_" ",DA(1)=RCRTOT,DIC="^RCY(344.4,"_DA(1)_",2,",DIC("DR")=$S($P(Z0,U,2)'="":".02////"_$P(Z0,U,2),1:"")
"RTN","RCDPESR6",85,0)
 . S DIC("DR")=DIC("DR")_$S(DIC("DR")'="":";",1:"")_$S($P(Z0,U,4)'="":".03////"_$J(-$P(Z0,U,4)/100,"",2),1:"")
"RTN","RCDPESR6",86,0)
 . S DIC("DR")=DIC("DR")_$S(DIC("DR")'="":";",1:"")_$S($P(Z0,U,5)'="":".04////"_$P(Z0,U,5),1:""),DLAYGO=344.42
"RTN","RCDPESR6",87,0)
 . S:$O(^RCY(344.4,RCRTOT,2,"B",X,0)) X=""""_X_""""
"RTN","RCDPESR6",88,0)
 . D FILE^DICN K DIC,DO,DD
"RTN","RCDPESR6",89,0)
 Q
"RTN","RCDPESR6",90,0)
 ;
"RTN","RCDPESR6",91,0)
DUPREC(RCET,RCCT,RCSTAR,RCFILE,RCALLDUP,RCEOB,RCBILL,RCDUPEOB) ; Overflow from RCDPESR2
"RTN","RCDPESR6",92,0)
 S ^TMP("RCERR1",$J,RCCT)=" ",^TMP("RCERR1",$J,RCCT,1)=RCET_RCCT_RCSTAR
"RTN","RCDPESR6",93,0)
 S ^TMP("RCERR1",$J,RCCT,2)="(Warning): EEOB detail already filed for "_RCBILL_" - "_$S(RCALLDUP:"Duplicate not stored",1:"EEOB updated"),^TMP("RCERR1",$J,RCCT,3)=" " S:RCFILE=5 ^TMP("RCERR1",$J,RCCT,"*")=^TMP("RCERR1",$J,RCCT,2)
"RTN","RCDPESR6",94,0)
 I RCALLDUP S RCEOB="",RCDUPEOB=-1 Q
"RTN","RCDPESR6",95,0)
 S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U)=RCEOB
"RTN","RCDPESR6",96,0)
 Q
"RTN","RCDPESR6",97,0)
 ;
"RTN","RCDPEV")
0^14^B37157784
"RTN","RCDPEV",1,0)
RCDPEV ;ALB/TMK - EDI LOCKBOX WORKLIST VERIFY PAYMENTS ;28-JAN-04
"RTN","RCDPEV",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEV",4,0)
 Q
"RTN","RCDPEV",5,0)
 ;
"RTN","RCDPEV",6,0)
AUTOVER(RCSCR) ; Entrypoint to auto-verify an ERA worklist
"RTN","RCDPEV",7,0)
 ; RCSCR = ien of the ERA worklist entry in file 344.49
"RTN","RCDPEV",8,0)
 N Z,Z0,Z00,RC399,RC430,RC3444,RC36112,X,X1,X2,X12,DA,DR,DIE
"RTN","RCDPEV",9,0)
 S Z=0 F  S Z=$O(^RCY(344.49,Z)) Q:'Z  S Z0=0 F  S Z0=$O(^RCY(344.49,Z,1,Z0)) Q:'Z0  I $P($G(^(Z0,0)),U,7) S Z00=$G(^(0)) D
"RTN","RCDPEV",10,0)
 . I $$VER(RCSCR,+$P(Z00,U,7),+$P(Z00,U,9)) S DA(1)=RCSCR,DA=Z0,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".13////1" D ^DIE
"RTN","RCDPEV",11,0)
 ;
"RTN","RCDPEV",12,0)
 Q
"RTN","RCDPEV",13,0)
 ;
"RTN","RCDPEV",14,0)
VER(RCSCR,RCBILL,RCREF,F1) ; Run verif for WL entry RCSCR in file 344.49
"RTN","RCDPEV",15,0)
 ;  RCBILL = ien of claim in file 430
"RTN","RCDPEV",16,0)
 ;  RCREF = the entry referenced in subfile file 344.41
"RTN","RCDPEV",17,0)
 ;  F1 = flag if set = 1 will return all data, regardless of if it
"RTN","RCDPEV",18,0)
 ;        matches or not.  If flag is set to 1 and data doesn't match,
"RTN","RCDPEV",19,0)
 ;        an asterisk (*) will preceed the actual data value in the
"RTN","RCDPEV",20,0)
 ;        corresponding piece
"RTN","RCDPEV",21,0)
 ; Function returns the following data:
"RTN","RCDPEV",22,0)
 ;   '^' piece 1: 1 if verfied OK   0 if not
"RTN","RCDPEV",23,0)
 ;   '^' piece 2: patient name from VistA if mismatch
"RTN","RCDPEV",24,0)
 ;   '^' piece 3: patient name from EEOB if mismatch
"RTN","RCDPEV",25,0)
 ;   '^' piece 4: amt billed from VistA if mismatch
"RTN","RCDPEV",26,0)
 ;   '^' piece 5: amt billed from EEOB if mismatch
"RTN","RCDPEV",27,0)
 ;   '^' piece 6: date of service 'from' from VistA if mismatch
"RTN","RCDPEV",28,0)
 ;   '^' piece 7: date of service 'from' from EEOB if mismatch
"RTN","RCDPEV",29,0)
 ;   '^' piece 8: date of service 'to' from VistA if mismatch
"RTN","RCDPEV",30,0)
 ;   '^' piece 9: date of service 'to' from EEOB if mismatch
"RTN","RCDPEV",31,0)
 ;   '^' piece 10: patient SSN from VistA
"RTN","RCDPEV",32,0)
 ;
"RTN","RCDPEV",33,0)
 N RESULT,SETF1,RC430,RC399,RC3444,RC36112,X,X1,X2,X12,NM,NM1,DTOK,SSN
"RTN","RCDPEV",34,0)
 S RESULT=1,SETF1=$S($G(F1):"*",1:"")
"RTN","RCDPEV",35,0)
 S RC430=$G(^PRCA(430,RCBILL,0))
"RTN","RCDPEV",36,0)
 S RC399=$G(^DGCR(399,RCBILL,0))
"RTN","RCDPEV",37,0)
 S RC3444=$G(^RCY(344.4,RCSCR,1,RCREF,0))
"RTN","RCDPEV",38,0)
 S RC36112=$G(^IBM(361.1,+$P(RC3444,U,2),2))
"RTN","RCDPEV",39,0)
 ;
"RTN","RCDPEV",40,0)
 S NM=$P($G(^DPT(+$P(RC399,U,2),0)),U),X=$E($P(NM,","),1,5) ; Name from VistA
"RTN","RCDPEV",41,0)
 S SSN=$P($G(^DPT(+$P(RC399,U,2),0)),U,9)
"RTN","RCDPEV",42,0)
 S NM1=$P(RC3444,U,15),X1=$E($P(NM1,","),1,5) ; from EEOB
"RTN","RCDPEV",43,0)
 I $G(F1),X1=X S $P(RESULT,U,2)=NM,$P(RESULT,U,3)=NM1
"RTN","RCDPEV",44,0)
 I X1'=X S $P(RESULT,U)=0,$P(RESULT,U,2)=SETF1_NM,$P(RESULT,U,3)=SETF1_NM1
"RTN","RCDPEV",45,0)
 ;
"RTN","RCDPEV",46,0)
 S X=$P(RC430,U,3) ; Amount billed from VistA
"RTN","RCDPEV",47,0)
 S X1=$P(RC36112,U,4) ; from EEOB
"RTN","RCDPEV",48,0)
 I $G(F1),+X=+X1 S $P(RESULT,U,4)=X,$P(RESULT,U,5)=X1
"RTN","RCDPEV",49,0)
 I +X'=+X1 S $P(RESULT,U)=0,$P(RESULT,U,4)=SETF1_X,$P(RESULT,U,5)=SETF1_X1
"RTN","RCDPEV",50,0)
 ;
"RTN","RCDPEV",51,0)
 S X=$P($G(^DGCR(399,+RCBILL,"U")),U) ; Date of service from VistA
"RTN","RCDPEV",52,0)
 S X2=$P($G(^DGCR(399,+RCBILL,"U")),U,2)
"RTN","RCDPEV",53,0)
 S X1=$P($G(^IBM(361.1,+$P(RC3444,U,2),1)),U,10) ; from EEOB
"RTN","RCDPEV",54,0)
 S X12=$P($G(^IBM(361.1,+$P(RC3444,U,2),1)),U,11)
"RTN","RCDPEV",55,0)
 ; if no date of service on EEOB, skip the check
"RTN","RCDPEV",56,0)
 ; Date of svc on EEOB must fall into date range for svc dates in VistA
"RTN","RCDPEV",57,0)
 S DTOK=0
"RTN","RCDPEV",58,0)
 I X1 D
"RTN","RCDPEV",59,0)
 . I X1=X S DTOK=1
"RTN","RCDPEV",60,0)
 . I 'DTOK,X1>X S:X1'>X2 DTOK=1
"RTN","RCDPEV",61,0)
 . I 'DTOK,X1<X S:X12'<X DTOK=1
"RTN","RCDPEV",62,0)
 . I 'DTOK S $P(RESULT,U)=0,$P(RESULT,U,6)=SETF1_X,$P(RESULT,U,7)=SETF1_X1,$P(RESULT,U,8)=SETF1_X2,$P(RESULT,U,9)=SETF1_X12 Q
"RTN","RCDPEV",63,0)
 I DTOK,$G(F1) S $P(RESULT,U,6)=X,$P(RESULT,U,7)=X1,$P(RESULT,U,8)=X2,$P(RESULT,U,9)=X12
"RTN","RCDPEV",64,0)
 S $P(RESULT,U,10)=SSN
"RTN","RCDPEV",65,0)
 ;
"RTN","RCDPEV",66,0)
VERQ Q RESULT
"RTN","RCDPEV",67,0)
 ;
"RTN","RCDPEV",68,0)
MVER(RCERA) ; Manually mark an EEOB as verified
"RTN","RCDPEV",69,0)
 N A,CT,DA,DIE,DR,DTOUT,DUOUT,Z,Z0,Z1,RCT,RCY,RCY0,RCZ0,RCLINE,RCYNUM,DIR,X,Y,RESULT,SPLIT,Q,Q0,DT1,DT2
"RTN","RCDPEV",70,0)
 S RCT=0,CT=1
"RTN","RCDPEV",71,0)
 F Z1=1:1 S Z=$G(^TMP("RCDPE-EOB_WLDX",$J,Z1)) Q:Z=""  Q:CT'<100  S Z0=$G(^RCY(344.49,RCERA,1,+$P(Z,U,2),0)) I Z0'="",'$P(Z0,U,13) S RCT=RCT+1 D  Q:CT'<100
"RTN","RCDPEV",72,0)
 . S CT=CT+1 I CT<100 D  Q
"RTN","RCDPEV",73,0)
 .. S:RCT=1 RCT(1)=Z1
"RTN","RCDPEV",74,0)
 .. S DIR("?",CT)="  "_$G(^TMP("RCDPE-EOB_WL",$J,+Z,0)),CT=CT+1,DIR("?",CT)=$J("",10)_$P(Z0,U,2)
"RTN","RCDPEV",75,0)
 .. S Q=+Z0
"RTN","RCDPEV",76,0)
 .. I $O(^RCY(344.49,RCERA,1,"B",Q_".9999"),-1)'=(Q_".001")
"RTN","RCDPEV",77,0)
 .. I $O(^RCY(344.49,RCERA,1,"B",Q_".9999"),-1)'=(Q_".001") S DIR("?",CT)=DIR("?",CT)_" (LINE HAS BEEN SPLIT)"
"RTN","RCDPEV",78,0)
 . K DIR("?")
"RTN","RCDPEV",79,0)
 ;
"RTN","RCDPEV",80,0)
 I 'RCT D  Q
"RTN","RCDPEV",81,0)
 . S DIR(0)="EA",DIR("A",1)="ALL EEOBS HAVE ALREADY BEEN VERIFIED IN THIS "_$S($G(^TMP("RCBATCH_SELECTED",$J)):"BATCH",1:"ERA"),DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEV",82,0)
 ;
"RTN","RCDPEV",83,0)
 I RCT<100 S DIR("?",1)="THE FOLLOWING EEOB LINE(S) "_$S($G(^TMP("RCBATCH_SELECTED",$J)):"IN THIS BATCH ",1:"")_"ARE NOT VERIFIED"
"RTN","RCDPEV",84,0)
 I RCT'<100 S DIR("?",1)="THERE ARE TOO MANY EEOB ENTRIES NOT VERIFIED TO LIST",DIR("?",2)="PRINT THE UNVERIFIED DISCREPANCY REPORT TO GET A LIST OF POSSIBLE CHOICES"
"RTN","RCDPEV",85,0)
 S DIR("?")=" "
"RTN","RCDPEV",86,0)
 S DIR(0)="NA^1:"_($O(^TMP("RCDPE-EOB_WLDX",$J,""),-1)\1),DIR("A")="SELECT AN EEOB LINE TO MARK AS VERIFIED: "
"RTN","RCDPEV",87,0)
 I RCT=1 S DIR("B")=RCT(1)
"RTN","RCDPEV",88,0)
 W ! D ^DIR K DIR
"RTN","RCDPEV",89,0)
 I $D(DUOUT)!$D(DTOUT)!(Y="") Q
"RTN","RCDPEV",90,0)
 I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEV",91,0)
 S RCY=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,Y)),U,2),RCLINE=+^(Y),RCYNUM=+Y
"RTN","RCDPEV",92,0)
 S RCY0=$G(^RCY(344.49,RCERA,1,RCY,0))
"RTN","RCDPEV",93,0)
 I $P(RCY0,U,13) D  Q
"RTN","RCDPEV",94,0)
 . S DIR(0)="EA",DIR("A",1)="THIS LINE IS ALREADY VERIFIED",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEV",95,0)
 S RCZ0=$G(^RCY(344.4,RCERA,1,+$P(RCY0,U,9),0))
"RTN","RCDPEV",96,0)
 I '$P(RCZ0,U,2) D
"RTN","RCDPEV",97,0)
 . W !!,"THIS LINE DOES NOT REFERENCE A VALID BILL"
"RTN","RCDPEV",98,0)
 E  D
"RTN","RCDPEV",99,0)
 . S RESULT=$$VER(RCERA,+$G(^IBM(361.1,+$P(RCZ0,U,2),0)),+$P(RCY0,U,9),1)
"RTN","RCDPEV",100,0)
 . F Z=2:1:9 I $E($P(RESULT,U,Z))="*" S Q=$P(RESULT,U,Z),$E(Q,1)="",$P(RESULT,U,Z)=Q
"RTN","RCDPEV",101,0)
 . S SPLIT=$O(^RCY(344.49,RCERA,1,"B",+RCY0_".9999"),-1)'=(+RCY0_".0001")
"RTN","RCDPEV",102,0)
 . S Z=$S(SPLIT:"CLAIM #'s: ",1:"  CLAIM #: ")
"RTN","RCDPEV",103,0)
 . S Z=Z_$P(RCY0,U,2)_$S('SPLIT:"",1:" (ORIGINAL ERA DATA)")
"RTN","RCDPEV",104,0)
 . I SPLIT D
"RTN","RCDPEV",105,0)
 .. S Q=+RCY0 F  S Q=$O(^RCY(344.49,RCERA,1,"B",Q)) Q:(Q\1)'=+RCY0  S Q0=+$O(^RCY(344.49,RCERA,1,"B",Q,0)),Q0=$G(^RCY(344.49,RCERA,1,Q0,0)) I $P(Q0,U,2)'="" S Z=Z_" "_$P(Q0,U,2)
"RTN","RCDPEV",106,0)
 . W !!!,Z
"RTN","RCDPEV",107,0)
 . W !,?13,"PATIENT NAME"_$J("",18)_"  SUBMITTED AMT    SVC DATE(S)"
"RTN","RCDPEV",108,0)
 . W !,?13,"------------------------------  ---------------  -----------------"
"RTN","RCDPEV",109,0)
 . S DT1=$E($S($P(RESULT,U,7):$$FMTE^XLFDT($P(RESULT,U,7),"2D"),1:"NOTFOUND")_$J("",8),1,8)
"RTN","RCDPEV",110,0)
 . S DT2=$E($S($P(RESULT,U,9):"-"_$$FMTE^XLFDT($P(RESULT,U,9),"2D"),1:"-NOTFOUND")_$J("",9),1,9)
"RTN","RCDPEV",111,0)
 . W !,"   ERA DATA: ",$E($P(RESULT,U,3)_$J("",30),1,30),"  ",$E($J($P(RESULT,U,5),"",2)_$J("",15),1,15)_"  "_DT1_DT2
"RTN","RCDPEV",112,0)
 . W !,?15,$P($G(^RCY(344,RCERA,0)),U,6)
"RTN","RCDPEV",113,0)
 . S DT1=$E($S($P(RESULT,U,6):$$FMTE^XLFDT($P(RESULT,U,6),"2D"),1:"NOTFOUND")_$J("",8),1,8)
"RTN","RCDPEV",114,0)
 . S DT2=$E($S($P(RESULT,U,8):"-"_$$FMTE^XLFDT($P(RESULT,U,8),"2D"),1:"-NOTFOUND")_$J("",9),1,9)
"RTN","RCDPEV",115,0)
 . W !,"  BILL DATA: "_$E($P(RESULT,U,2)_$J("",30),1,30)_"  "_$E($J($P(RESULT,U,4),"",2)_$J("",15),1,15)_"  "_DT1_DT2
"RTN","RCDPEV",116,0)
 . W !,?15,$P($G(^DIC(36,+$P(RCZ0,U,4),0)),U),!
"RTN","RCDPEV",117,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO MARK THIS LINE VERIFIED?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEV",118,0)
 I Y'=1 Q
"RTN","RCDPEV",119,0)
 S DA(1)=RCERA,DA=+RCY,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".13////1" D ^DIE
"RTN","RCDPEV",120,0)
 S A=$$TOPLINE^RCDPEWL1($G(^RCY(344.49,RCERA,1,+RCY,0)),RCYNUM)
"RTN","RCDPEV",121,0)
 S ^TMP("RCDPE-EOB_WL",$J,RCLINE,0)=A
"RTN","RCDPEV",122,0)
 Q
"RTN","RCDPEV",123,0)
 ;
"RTN","RCDPEV0")
0^20^B24399353
"RTN","RCDPEV0",1,0)
RCDPEV0 ;ALB/TMK - EDI LOCKBOX WORKLIST VERIFY PAYMENTS ;18-FEB-04
"RTN","RCDPEV0",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEV0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEV0",4,0)
 Q
"RTN","RCDPEV0",5,0)
 ;
"RTN","RCDPEV0",6,0)
RPT(RCSCR) ; Print/display discrepancy report
"RTN","RCDPEV0",7,0)
 D FULL^VALM1
"RTN","RCDPEV0",8,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP
"RTN","RCDPEV0",9,0)
 S %ZIS="QM" D ^%ZIS G:POP RPTQ
"RTN","RCDPEV0",10,0)
 I $D(IO("Q")) D  G RPTQ
"RTN","RCDPEV0",11,0)
 . S ZTRTN="DISRPT^RCDPEV("_RCSCR_","_+$G(^TMP("RCBATCH_SELECTED",$J))_")",ZTDESC="AR - Print ERA Discrepancy Report From Worklist"
"RTN","RCDPEV0",12,0)
 . D ^%ZTLOAD
"RTN","RCDPEV0",13,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEV0",14,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEV0",15,0)
 U IO
"RTN","RCDPEV0",16,0)
 D DISRPT(RCSCR,+$G(^TMP("RCBATCH_SELECTED",$J)))
"RTN","RCDPEV0",17,0)
RPTQ Q
"RTN","RCDPEV0",18,0)
 ;
"RTN","RCDPEV0",19,0)
DISRPT(RCSCR,RCBATCH) ; Queued job entrypoint
"RTN","RCDPEV0",20,0)
 ; RCSCR = the ien of the entry in file 344.49
"RTN","RCDPEV0",21,0)
 ; RCBATCH = the # of the batch within the ERA.  If all batches, this is null
"RTN","RCDPEV0",22,0)
 N X,Z,Z0,RC3444,RCSTOP,RCPG,RCANY,RCZ,RCZ0,RCZ1,SPLIT,SSN,AMT1,AMT2,RCBILL,RESULT,DTFR1,DTFR2,DTTO1,DTTO2
"RTN","RCDPEV0",23,0)
 S (RCSTOP,RCPG,RCANY)=0
"RTN","RCDPEV0",24,0)
 S RCZ=0 F  S RCZ=$O(^RCY(344.49,RCSCR,1,"ANV",0,RCZ)) Q:'RCZ  D  Q:RCSTOP
"RTN","RCDPEV0",25,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ W:+$G(RCPG) !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEV0",26,0)
 . S RCZ0=$G(^RCY(344.49,RCSCR,1,RCZ,0))
"RTN","RCDPEV0",27,0)
 . Q:'$D(^RCY(344.49,RCSCR,1,"ASEQ",+RCZ0,RCZ))  ; Not top level
"RTN","RCDPEV0",28,0)
 . Q:RCZ0=""
"RTN","RCDPEV0",29,0)
 . I $G(RCBATCH),$P(RCZ0,U,14)'=RCBATCH Q  ; Not in the batch
"RTN","RCDPEV0",30,0)
 . S RCANY=1
"RTN","RCDPEV0",31,0)
 . S SPLIT=(+$O(^RCY(344.49,RCSCR,1,"B",+RCZ0_".9999"),-1)'=(+RCZ0_".001"))
"RTN","RCDPEV0",32,0)
 . S RC3444=$G(^RCY(344.4,RCSCR,1,+$P(RCZ0,U,9),0))
"RTN","RCDPEV0",33,0)
 . S RCBILL=+$G(^IBM(361.1,+$P(RC3444,U,2),0))
"RTN","RCDPEV0",34,0)
 . S RESULT=$$VER^RCDPEV(RCSCR,RCBILL,+$P(RCZ0,U,9),1)
"RTN","RCDPEV0",35,0)
 . S AMT1=$S($E($P(RESULT,U,5))="*":"*",1:"")_$S($TR($P(RESULT,U,5),"*")="":"NO DATA",1:$J($TR($P(RESULT,U,5),"*"),"",2))
"RTN","RCDPEV0",36,0)
 . S AMT2=$S($E($P(RESULT,U,4))="*":"*",1:"")_$S($TR($P(RESULT,U,4),"*")="":"NO DATA",1:$J($TR($P(RESULT,U,4),"*"),"",2))
"RTN","RCDPEV0",37,0)
 . S DTFR1=$S($TR($P(RESULT,U,7),"*")="":"",1:$S($E($P(RESULT,U,7))="*":"*",1:"")_$$FMTE^XLFDT($TR($P(RESULT,U,7),"*"),"2D"))
"RTN","RCDPEV0",38,0)
 . S DTFR2=$S($TR($P(RESULT,U,6),"*")="":"",1:$S($E($P(RESULT,U,6))="*":"*",1:"")_$$FMTE^XLFDT($TR($P(RESULT,U,6),"*"),"2D"))
"RTN","RCDPEV0",39,0)
 . S DTTO1=$S($TR($P(RESULT,U,9),"*")="":"",1:$S($E($P(RESULT,U,9))="*":"*",1:"")_$$FMTE^XLFDT($TR($P(RESULT,U,9),"*"),"2D"))
"RTN","RCDPEV0",40,0)
 . S DTTO2=$S($TR($P(RESULT,U,8),"*")="":"",1:$S($E($P(RESULT,U,8))="*":"*",1:"")_$$FMTE^XLFDT($TR($P(RESULT,U,8),"*"),"2D"))
"RTN","RCDPEV0",41,0)
 . S X="EEOB Sequence #(s) on the ERA: "_$P(RCZ0,U,9)_"  "_$S($P(RC3444,U,5)'="":$P(RC3444,U,5),$P(RC3444,U,17)'="":$P(RC3444,U,17),$G(RCBILL):$P($G(^DGCR(399,+RCBILL,0)),U),1:"")
"RTN","RCDPEV0",42,0)
 . I ($Y+7)>IOSL!'RCPG D HDR(.RCPG,RCSCR,$G(RCBATCH),.RCSTOP) Q:RCSTOP
"RTN","RCDPEV0",43,0)
 . W !!,X
"RTN","RCDPEV0",44,0)
 . I ($Y+5)>IOSL D HDR(.RCPG,RCSCR,$G(RCBATCH),.RCSTOP) Q:RCSTOP
"RTN","RCDPEV0",45,0)
 . S X="VistA: ",SSN=$P(RESULT,U,10),SSN=$E($E(SSN,$L(SSN)-3,$L(SSN))_$J("",4),1,4)
"RTN","RCDPEV0",46,0)
 . S X=X_$S('RCBILL:"NOT RELATED TO A VistA BILL",1:$E($P(RESULT,U,2)_$J("",30),1,30)_" "_SSN_"  "_$E(AMT2_$J("",15),1,15)_"  "_$E($S(DTFR2="":"NO DATA",1:DTFR2)_$J("",9),1,9)_"-"_$S(DTTO2'="":DTTO2,1:"NO DATA"))
"RTN","RCDPEV0",47,0)
 . W !,X
"RTN","RCDPEV0",48,0)
 . S X="  ERA: "_$E($P(RESULT,U,3)_$J("",30),1,30)_$J("",7)_$E(AMT1_$J("",15),1,15)_"  "_$E($S(DTFR1="":"NO DATA",1:DTFR1)_$J("",9),1,9)_"-"_$S(DTTO1'="":DTTO1,1:"NO DATA")
"RTN","RCDPEV0",49,0)
 . W !,X
"RTN","RCDPEV0",50,0)
 . Q:'SPLIT
"RTN","RCDPEV0",51,0)
 . W !,?9,"<<< THIS EEOB HAS BEEN SPLIT >>>"
"RTN","RCDPEV0",52,0)
 . S RCZ1=+RCZ0 F  S RCZ1=$O(^RCY(344.49,RCSCR,1,"B",RCZ1)) Q:(RCZ1\1)'=+RCZ0!RCSTOP  D
"RTN","RCDPEV0",53,0)
 .. S Z=+$O(^RCY(344.49,RCSCR,1,"B",RCZ1,0))
"RTN","RCDPEV0",54,0)
 .. S Z0=$G(^RCY(344.49,RCSCR,1,Z,0))
"RTN","RCDPEV0",55,0)
 .. I ($Y+5)>IOSL D HDR(.RCPG,RCSCR,$G(RCBATCH),.RCSTOP) Q:RCSTOP
"RTN","RCDPEV0",56,0)
 .. W !,?15,$S($P(Z0,U,7):"",1:"BILL NOT IN VISTA: "),$P(Z0,U,2)_"  "_$J($P(Z0,U,5),"",2)
"RTN","RCDPEV0",57,0)
 . W !
"RTN","RCDPEV0",58,0)
 ;
"RTN","RCDPEV0",59,0)
 I 'RCANY D:'RCPG HDR(.RCPG,RCSCR,$G(RCBATCH),.RCSTOP) W !,"THERE ARE NO UNVERIFIED LINES WITH DISCREPANCIES IN THIS ERA"_$S($G(RCBATCH):" BATCH",1:"")
"RTN","RCDPEV0",60,0)
 I '$D(ZTQUEUED),'RCSTOP,RCPG D ASK()
"RTN","RCDPEV0",61,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEV0",62,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEV0",63,0)
 Q
"RTN","RCDPEV0",64,0)
 ;
"RTN","RCDPEV0",65,0)
HDR(RCPG,RCSCR,RCBATCH,RCSTOP) ;Print report hdr
"RTN","RCDPEV0",66,0)
 ; RCPG = last page #
"RTN","RCDPEV0",67,0)
 ; RCSCR = the entry # in file 344.49
"RTN","RCDPEV0",68,0)
 ; RCSTOP = returned as 1 if abort is detected
"RTN","RCDPEV0",69,0)
 N RCZ0
"RTN","RCDPEV0",70,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ W:+$G(RCPG) !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEV0",71,0)
 S RCZ0=$G(^RCY(344.4,RCSCR,0))
"RTN","RCDPEV0",72,0)
 I RCPG&($E(IOST,1,2)="C-") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEV0",73,0)
 W !,@IOF,*13
"RTN","RCDPEV0",74,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEV0",75,0)
 W !,"EDI LBOX WORKLIST - UNVERIFIED LINES DISCREPANCIES REPORT",?59,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!
"RTN","RCDPEV0",76,0)
 W !,"ERA #: ",RCSCR,?20,$S($O(^RCY(344.49,RCSCR,3,0)):"BATCH: "_$E($S($G(RCBATCH):+RCBATCH,1:"ALL")_$J("",11),1,11),1:$J("",18))_"TRACE #: "_$P(RCZ0,U,2)
"RTN","RCDPEV0",77,0)
 W !,"PAYER: "_$E($P(RCZ0,U,6)_$J("",30),1,30)_"  ERA DT: "_$$FMTE^XLFDT($P(RCZ0,U,4),"2D")
"RTN","RCDPEV0",78,0)
 W !!,?7,"PATIENT NAME"_$J("",25)_"SUBMITTED AMT    SVC DATE(S)"
"RTN","RCDPEV0",79,0)
 W !,"* preceding data = data has discrepancy"
"RTN","RCDPEV0",80,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEV0",81,0)
 Q
"RTN","RCDPEV0",82,0)
 ;
"RTN","RCDPEV0",83,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEV0",84,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEV0",85,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEV0",86,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEV0",87,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEV0",88,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEV0",89,0)
 Q
"RTN","RCDPEV0",90,0)
 ;
"RTN","RCDPEWL")
0^6^B44394338
"RTN","RCDPEWL",1,0)
RCDPEWL ;ALB/TMK - ELECTRONIC EOB MESSAGE WORKLIST ;06-FEB-2003
"RTN","RCDPEWL",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL",5,0)
 ;
"RTN","RCDPEWL",6,0)
EN ; Main entry point
"RTN","RCDPEWL",7,0)
 N RCFASTXT,DA,DIC,X,Y,RCERA,RCNOED
"RTN","RCDPEWL",8,0)
 D FULL^VALM1
"RTN","RCDPEWL",9,0)
 ;
"RTN","RCDPEWL",10,0)
 S DIR(0)="SA^L:LIST;S:SPECIFIC",DIR("A")="DO YOU WANT A (L)IST OF ERAs OR A (S)PECIFIC ONE?: ",DIR("B")="LIST" W ! D ^DIR K DIR
"RTN","RCDPEWL",11,0)
 G:$D(DTOUT)!$D(DUOUT) ENQ
"RTN","RCDPEWL",12,0)
 I Y="S" D  G ENQ
"RTN","RCDPEWL",13,0)
 . S DIC="^RCY(344.4,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL",14,0)
 . I Y>0 D WL^RCDPEWL7(+Y)
"RTN","RCDPEWL",15,0)
 ;
"RTN","RCDPEWL",16,0)
 D PARAMS^RCDPEWL0
"RTN","RCDPEWL",17,0)
 I '$D(^TMP("RCERA_PARAMS",$J)) G ENQ
"RTN","RCDPEWL",18,0)
 D EN^VALM("RCDPE WORKLIST ERA LIST")
"RTN","RCDPEWL",19,0)
 ;
"RTN","RCDPEWL",20,0)
ENQ Q
"RTN","RCDPEWL",21,0)
 ;
"RTN","RCDPEWL",22,0)
DISP(RCERA,RCNOED) ; Entry to worklist from receipt processing
"RTN","RCDPEWL",23,0)
 ; RCERA = ien of entry in file 344.49
"RTN","RCDPEWL",24,0)
 ; RCNOED = 1 if receipt exists/no editing allowed
"RTN","RCDPEWL",25,0)
 ;        = 2 if no edit and called from receipt processing
"RTN","RCDPEWL",26,0)
 ;
"RTN","RCDPEWL",27,0)
 N DUOUT,DTOUT,DIC,DIK,X,Y,DIR,RCQUIT,DA,DIE,DR,RCSCR,RC0,RCDAT,RCUNM
"RTN","RCDPEWL",28,0)
 ;
"RTN","RCDPEWL",29,0)
 S RCSCR("NOEDIT")=+$G(RCNOED)
"RTN","RCDPEWL",30,0)
 S RCQUIT=0,RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEWL",31,0)
 ;I $$HACERA^RCDPEU(RCERA) S DIR(0)="YA",DIR("A")="THIS ERA IS FROM CHAMPVA (HAC) - ARE YOU SURE YOU WANT TO CONTINUE?: ",DIR("B")="YES" D ^DIR K DIR G:Y'=1 DISPQ
"RTN","RCDPEWL",32,0)
 I 'RCSCR("NOEDIT"),'$O(^RCY(344.49,"B",RCERA,0)) D  G:RCQUIT DISPQ
"RTN","RCDPEWL",33,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="NO WORKLIST SCRATCH PAD ENTRY EXISTS FOR THIS ERA",DIR("A")="DO YOU WANT TO CREATE ONE NOW?: "
"RTN","RCDPEWL",34,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL",35,0)
 . I Y'=1 S RCERA=-1,RCQUIT=1 Q
"RTN","RCDPEWL",36,0)
 . ;
"RTN","RCDPEWL",37,0)
 . I $P(RC0,U,15)'="" W !!,"PAYMENT METHOD CODE REPORTED: "_$P(RC0,U,15),!
"RTN","RCDPEWL",38,0)
 . I $P(RC0,U,15)="" W !!,"NO PAYMENT METHOD CODE REPORTED",!
"RTN","RCDPEWL",39,0)
 . ;I $P(RC0,U,9)=0,$P(RC0,U,13)="",'$$HACERA^RCDPEU(RCERA) D  Q:RCQUIT
"RTN","RCDPEWL",40,0)
 . I $P(RC0,U,9)=0,$P(RC0,U,13)="" D  Q:RCQUIT
"RTN","RCDPEWL",41,0)
 .. S RCQUIT=0,RCUNM=0
"RTN","RCDPEWL",42,0)
 .. I +$P(RC0,U,5)=0,"ACH"'[(U_$P(RC0,U,15)_U) D  Q:RCQUIT!RCUNM
"RTN","RCDPEWL",43,0)
 ... S DIR("A",1)="THIS ERA HAS NO PAYMENT ASSOCIATED WITH IT AND CAN BE MARKED AS",DIR("A",2)="'MATCH-0 PAYMENT' TO REMOVE IT FROM THE ERA AGING REPORT IF NO PAPER CHECK OR",DIR("A",3)="EFT IS EXPECTED TO BE RECEIVED FOR THIS ERA"
"RTN","RCDPEWL",44,0)
 ... S DIR("?")="DO NOT RESPOND YES HERE UNLESS YOU ARE SURE THERE WILL BE NO EFT OR PAPER",DIR("?",1)=" CHECK TO BE RECEIVED FOR THIS 0-PAYMENT ERA"
"RTN","RCDPEWL",45,0)
 ... S DIR("A")="DO YOU WANT TO DO THIS?: "
"RTN","RCDPEWL",46,0)
 ... S DIR(0)="YA"
"RTN","RCDPEWL",47,0)
 ... D ^DIR K DIR
"RTN","RCDPEWL",48,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",49,0)
 ... I Y'=1 Q
"RTN","RCDPEWL",50,0)
 ... S DIE="^RCY(344.4,",DR=".09////3;.14////3",DA=RCERA D ^DIE S RCUNM=1
"RTN","RCDPEWL",51,0)
 .. I 'RCUNM D
"RTN","RCDPEWL",52,0)
 ... S DIR("A",1)="THIS ERA DOES NOT HAVE A MATCHING EFT",DIR("A")="ENTER THE NUMBER OF THE PAPER CHECK YOU RECEIVED FOR THIS ERA: ",DIR(0)="344.01,.07A"
"RTN","RCDPEWL",53,0)
 ... I $P(RC0,U,13)'="" S DIR("B")=$P(RC0,U,13)
"RTN","RCDPEWL",54,0)
 ... I $G(DIR("B"))="",$P(RC0,U,2)'="" S DIR("B")=$P(RC0,U,2)
"RTN","RCDPEWL",55,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",56,0)
 ... I $D(DTOUT)!$D(DUOUT)!(Y="") D  S RCQUIT=1 Q
"RTN","RCDPEWL",57,0)
 .... S DIR(0)="EA",DIR("A",1)="THERE MUST EITHER BE A PAPER CHECK OR AN EFT FOR THIS ERA",DIR("A")="PRESS RETURN TO CONTINUE " W !!  D ^DIR K DIR
"RTN","RCDPEWL",58,0)
 ... S RCDAT("CHECK#")=Y
"RTN","RCDPEWL",59,0)
 ... S DIR(0)="344.01,.1O",DIR("B")=$$FMTE^XLFDT($P(RC0,U,4),2)
"RTN","RCDPEWL",60,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",61,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",62,0)
 ... S RCDAT("CHECKDT")=Y
"RTN","RCDPEWL",63,0)
 ... S DIR(0)="344.01,.08O"
"RTN","RCDPEWL",64,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",65,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",66,0)
 ... S RCDAT("BANK")=Y
"RTN","RCDPEWL",67,0)
 ... S DIR("A",1)="ERA #"_RCERA_" (TRACE #:"_$P(RC0,U,2)_") MATCHED TO PAPER CHECK "_RCDAT("CHECK#"),DIR("A")="IS THIS CORRECT?: ",DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL",68,0)
 ... I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEWL",69,0)
 ... S DIE="^RCY(344.4,",DA=RCERA,DR=".13////"_RCDAT("CHECK#")_";.09////2" D ^DIE
"RTN","RCDPEWL",70,0)
 ;
"RTN","RCDPEWL",71,0)
 S RCSCR=+$O(^RCY(344.49,"B",RCERA,0))
"RTN","RCDPEWL",72,0)
 I 'RCSCR D  ; Build the entry in file 344.49
"RTN","RCDPEWL",73,0)
 . I RCSCR("NOEDIT") D  Q
"RTN","RCDPEWL",74,0)
 .. S DIR("A")="NO WORKLIST ENTRY EXISTS FOR THIS ERA - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL",75,0)
 . ;
"RTN","RCDPEWL",76,0)
 . S RCSCR=+$$ADDREC(RCERA,.RCDAT)
"RTN","RCDPEWL",77,0)
 . I RCSCR D  Q:'RCSCR
"RTN","RCDPEWL",78,0)
 .. F X=1:1:6 L +^RCY(344.4,RCSCR):5 Q:$T  I X=6 D  Q
"RTN","RCDPEWL",79,0)
 ... S DA=RCSCR,DIK="^RCY(344.49," D ^DIK S RCSCR=0
"RTN","RCDPEWL",80,0)
 ... S DIR(0)="EA",DIR("A",1)="ANOTHER USER HAS LOCKED THIS ENTRY - NEW RECORD NOT CREATED",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL",81,0)
 .. Q:'RCSCR
"RTN","RCDPEWL",82,0)
 .. D SETBATCH^RCDPEWLB(RCSCR)
"RTN","RCDPEWL",83,0)
 .. D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL",84,0)
 .. K ^TMP($J,"BATCHES")
"RTN","RCDPEWL",85,0)
 ;
"RTN","RCDPEWL",86,0)
 I RCSCR D  G:'RCSCR DISPQ
"RTN","RCDPEWL",87,0)
 . Q:'$$BAT^RCDPEWL7(RCSCR)
"RTN","RCDPEWL",88,0)
 . I 'RCSCR("NOEDIT"),'$G(^TMP("RCBATCH_SELECTED",$J)) L +^RCY(344.4,RCSCR):5 I '$T W !!,"Another user is currently editing this entry",! S DIR(0)="E" D ^DIR K DIR S RCSCR=0 Q
"RTN","RCDPEWL",89,0)
 . D EN^VALM("RCDPE EOB WORKLIST")
"RTN","RCDPEWL",90,0)
 ;
"RTN","RCDPEWL",91,0)
DISPQ L -^RCY(344.4,+$G(RCERA))
"RTN","RCDPEWL",92,0)
 Q
"RTN","RCDPEWL",93,0)
 ;
"RTN","RCDPEWL",94,0)
INIT ; -- set up initial variables
"RTN","RCDPEWL",95,0)
 N RCQUIT,RCREV,RCSORT
"RTN","RCDPEWL",96,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEWL",97,0)
 S RCQUIT=0
"RTN","RCDPEWL",98,0)
 I '$D(RCSCR) S VALMQUIT=1 Q
"RTN","RCDPEWL",99,0)
 S RCREV=+$O(^RCY(344.49,RCSCR,2,"B",DUZ,0))
"RTN","RCDPEWL",100,0)
 I $P($G(^RCY(344.49,RCSCR,2,RCREV,0)),U,2)=1 S $P(^TMP($J,"RC_SORTPARM"),U,2)=1
"RTN","RCDPEWL",101,0)
 S RCSORT=$$SELSORT^RCDPEWLA(.RCQUIT)
"RTN","RCDPEWL",102,0)
 I $G(RCQUIT) S VALMQUIT=1
"RTN","RCDPEWL",103,0)
 I '$G(RCQUIT) D BLD^RCDPEWL1(RCSORT)
"RTN","RCDPEWL",104,0)
 Q
"RTN","RCDPEWL",105,0)
 ;
"RTN","RCDPEWL",106,0)
ADDREC(RCERA,RCDAT) ; Add a record to file 344.49
"RTN","RCDPEWL",107,0)
 ; RCERA = ien of file 344.4
"RTN","RCDPEWL",108,0)
 ; RCDAT = array containing additional data to add to new entry
"RTN","RCDPEWL",109,0)
 ;
"RTN","RCDPEWL",110,0)
 N DIC,DLAYGO,X,Y,DO,DD,RCY,DINUM
"RTN","RCDPEWL",111,0)
 S RCY=0,DIC("DR")=""
"RTN","RCDPEWL",112,0)
 S DIC(0)="L",DLAYGO=344.49,(DINUM,X)=RCERA,DIC="^RCY(344.49,"
"RTN","RCDPEWL",113,0)
 I $G(RCDAT("CHECK#"))'="" S DIC("DR")=".04////"_RCDAT("CHECK#")_";"
"RTN","RCDPEWL",114,0)
 I $G(RCDAT("CHECKDT"))'="" S DIC("DR")=DIC("DR")_".05////"_RCDAT("CHECKDT")_";"
"RTN","RCDPEWL",115,0)
 I $G(RCDAT("BANK"))'="" S DIC("DR")=DIC("DR")_".06////"_RCDAT("BANK")_";"
"RTN","RCDPEWL",116,0)
 K DD,DO D FILE^DICN K DIC
"RTN","RCDPEWL",117,0)
 I Y>0 S RCY=+Y
"RTN","RCDPEWL",118,0)
 Q RCY
"RTN","RCDPEWL",119,0)
 ;
"RTN","RCDPEWL",120,0)
HDR ; Creates header lines for the selected ERA display
"RTN","RCDPEWL",121,0)
 N X,Z,RC,RCT
"RTN","RCDPEWL",122,0)
 I '$G(RCSCR) S VALMQUIT=1 Q
"RTN","RCDPEWL",123,0)
 S RC=$G(^RCY(344.4,+RCSCR,0))
"RTN","RCDPEWL",124,0)
 S VALMHDR(1)=$E("ERA Entry #: "_$P(RC,U)_$J("",31),1,31)_"Payer Name/ID: "_$P(RC,U,6)_"/"_$P(RC,U,3)
"RTN","RCDPEWL",125,0)
 S VALMHDR(2)=$E("Total Amt Pd: "_$J(+$P(RC,U,5),"",2)_$J("",31),1,31)
"RTN","RCDPEWL",126,0)
 S Z=+$O(^RCY(344.31,"AERA",+RCSCR,0))
"RTN","RCDPEWL",127,0)
 I Z S VALMHDR(2)=VALMHDR(2)_"EFT #/TRACE #: "_$P($G(^RCY(344.3,+$G(^RCY(344.31,Z,0)),0)),U)_"/"_$P(RC,U,2)
"RTN","RCDPEWL",128,0)
 I 'Z,$P(RC,U,13)'="" S VALMHDR(2)=VALMHDR(2)_"PAPER CHECK #: "_$P(RC,U,13)
"RTN","RCDPEWL",129,0)
 S RCT=2
"RTN","RCDPEWL",130,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL",131,0)
 . N Z,Z0
"RTN","RCDPEWL",132,0)
 . S Z=+$G(^TMP("RCBATCH_SELECTED",$J)),Z0=$G(^RCY(344.49,RCSCR,3,Z,0))
"RTN","RCDPEWL",133,0)
 . S RCT=RCT+1,VALMHDR(RCT)="BATCH: "_Z_"  "_$P(Z0,U,2)_"  "_$$EXTERNAL^DILFD(344.493,.03,"",$P(Z0,U,3))
"RTN","RCDPEWL",134,0)
 I $G(RCSCR("NOEDIT")) S RCT=RCT+1,VALMHDR(RCT)="*** RECEIPT ALREADY CREATED ("_$P($G(^RCY(344,+$P(RC,U,8),0)),U)_") ***"
"RTN","RCDPEWL",135,0)
 Q
"RTN","RCDPEWL",136,0)
 ;
"RTN","RCDPEWL",137,0)
FNL ; -- Clean up list
"RTN","RCDPEWL",138,0)
 K ^TMP("RCDPE-EOB_WLDX",$J),^TMP("RCDPE-EOB_WL",$J),^TMP($J,"RC_SORTPARM"),^TMP($J,"RC_BILL")
"RTN","RCDPEWL",139,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","RCDPEWL",140,0)
 K RCFASTXT
"RTN","RCDPEWL",141,0)
 Q
"RTN","RCDPEWL",142,0)
 ;
"RTN","RCDPEWL",143,0)
SEL(RCDA) ; Select entry from worklist scratch pad screen
"RTN","RCDPEWL",144,0)
 ; RCDA = array returned if selections made
"RTN","RCDPEWL",145,0)
 ;    RCDA(n)=ien of entry(s) in file 344.41 
"RTN","RCDPEWL",146,0)
 ;            where n = the line # selected  
"RTN","RCDPEWL",147,0)
 K RCDA
"RTN","RCDPEWL",148,0)
 N VALMY
"RTN","RCDPEWL",149,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL",150,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCDA(RCDA)=$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA)),U,2,5)
"RTN","RCDPEWL",151,0)
 Q
"RTN","RCDPEWL",152,0)
 ;
"RTN","RCDPEWL",153,0)
NOEDIT ; Display no edit allowed if receipt exists
"RTN","RCDPEWL",154,0)
 N DIR,X,Y
"RTN","RCDPEWL",155,0)
 S DIR(0)="EA",DIR("A",1)="THIS ACTION IS NOT AVAILABLE SINCE THE ERA ALREADY HAS A RECEIPT."
"RTN","RCDPEWL",156,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",157,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",158,0)
 Q
"RTN","RCDPEWL",159,0)
 ;
"RTN","RCDPEWL",160,0)
NOBATCH ; Display action not allowed if working at batch level not the ERA level
"RTN","RCDPEWL",161,0)
 N DIR,X,Y
"RTN","RCDPEWL",162,0)
 S DIR(0)="EA",DIR("A",1)="THIS ACTION IS NOT VALID WHEN IN A BATCH WITHIN THE ERA."
"RTN","RCDPEWL",163,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",164,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",165,0)
 Q
"RTN","RCDPEWL",166,0)
 ;
"RTN","RCDPEWL0")
0^12^B80346740
"RTN","RCDPEWL0",1,0)
RCDPEWL0 ;ALB/TMK - ELECTRONIC EOB WORKLIST ACTIONS ;26-NOV-02
"RTN","RCDPEWL0",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL0",4,0)
 Q
"RTN","RCDPEWL0",5,0)
 ;
"RTN","RCDPEWL0",6,0)
PARAMS ; Select params for ERA list
"RTN","RCDPEWL0",7,0)
 ; Return ^TMP("RCERA_PARAMS",$J) array
"RTN","RCDPEWL0",8,0)
 N DIR,X,Y,RCDFR,RCDTO,RCPAYR,RCQUIT
"RTN","RCDPEWL0",9,0)
 K ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWL0",10,0)
 S RCQUIT=0
"RTN","RCDPEWL0",11,0)
 W !!,"SELECT PARAMETERS FOR DISPLAYING THE LIST OF ERAs"
"RTN","RCDPEWL0",12,0)
 S DIR(0)="SA^U:UNPOSTED;P:POSTED;B:BOTH",DIR("B")="UNPOSTED",DIR("A")="ERA POSTING STATUS: " W ! D ^DIR K DIR
"RTN","RCDPEWL0",13,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 G PARAMSQ
"RTN","RCDPEWL0",14,0)
 S ^TMP("RCERA_PARAMS",$J,"RCPOST")=Y
"RTN","RCDPEWL0",15,0)
 S DIR(0)="SA^N:NOT MATCHED;M:MATCHED;B:BOTH",DIR("B")="BOTH",DIR("A")="ERA-EFT MATCH STATUS: " W ! D ^DIR K DIR
"RTN","RCDPEWL0",16,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 G PARAMSQ
"RTN","RCDPEWL0",17,0)
 S ^TMP("RCERA_PARAMS",$J,"RCMATCH")=Y
"RTN","RCDPEWL0",18,0)
 ;
"RTN","RCDPEWL0",19,0)
DT1 S RCDTO=DT,RCDFR=0
"RTN","RCDPEWL0",20,0)
 S RCQUIT=0,DIR(0)="YA",DIR("A")="LIMIT THE SELECTION TO A DATE RANGE WHEN THE ERA WAS RECEIVED?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL0",21,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 G PARAMSQ
"RTN","RCDPEWL0",22,0)
 I Y=1 S RCQUIT=0 D  I RCQUIT K ^TMP("RCERA_PARAMS",$J,"RCDT") G DT1
"RTN","RCDPEWL0",23,0)
 . S DIR(0)="DA",DIR("A")="EARLIEST DATE: " D ^DIR K DIR
"RTN","RCDPEWL0",24,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL0",25,0)
 . S RCDFR=Y
"RTN","RCDPEWL0",26,0)
 . S DIR(0)="DA^"_RCDFR_";"_DT,DIR("A")="LATEST DATE: " D ^DIR K DIR
"RTN","RCDPEWL0",27,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL0",28,0)
 . S RCDTO=Y
"RTN","RCDPEWL0",29,0)
 S ^TMP("RCERA_PARAMS",$J,"RCDT")=(RCDFR_U_RCDTO)
"RTN","RCDPEWL0",30,0)
 ;
"RTN","RCDPEWL0",31,0)
PAYR S RCQUIT=0,DIR(0)="SA^A:ALL;R:RANGE",DIR("A")="(A)LL PAYERS, (R)ANGE OF PAYER NAMES: ",DIR("B")="ALL" W ! D ^DIR K DIR
"RTN","RCDPEWL0",32,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 G PARAMSQ
"RTN","RCDPEWL0",33,0)
 S RCPAYR=Y,^TMP("RCERA_PARAMS",$J,"RCPAYR")=Y
"RTN","RCDPEWL0",34,0)
 I RCPAYR="A" G PARAMSQ
"RTN","RCDPEWL0",35,0)
 I RCPAYR="R" D  I RCQUIT K ^TMP("RCERA_PARAMS",$J,"RCPAYR") G PAYR
"RTN","RCDPEWL0",36,0)
 . W !,"NAMES YOU SELECT HERE WILL BE THE PAYER NAMES FROM THE ERA, NOT THE INS FILE"
"RTN","RCDPEWL0",37,0)
 . S DIR("?")="ENTER A NAME BETWEEN 1 AND 30 CHARACTERS IN UPPERCASE"
"RTN","RCDPEWL0",38,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="START WITH PAYER NAME: " W ! D ^DIR K DIR
"RTN","RCDPEWL0",39,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL0",40,0)
 . S RCPAYR("FROM")=Y,$P(^TMP("RCERA_PARAMS",$J,"RCPAYR"),U,2)=Y
"RTN","RCDPEWL0",41,0)
 . S DIR("?")="ENTER A NAME BETWEEN 1 AND 30 CHARACTERS IN UPPERCASE"
"RTN","RCDPEWL0",42,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="GO TO PAYER NAME: ",DIR("B")=$E(RCPAYR("FROM"),1,27)_"ZZZ" W ! D ^DIR K DIR
"RTN","RCDPEWL0",43,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL0",44,0)
 . S $P(^TMP("RCERA_PARAMS",$J,"RCPAYR"),U,3)=Y
"RTN","RCDPEWL0",45,0)
 W !
"RTN","RCDPEWL0",46,0)
 ;
"RTN","RCDPEWL0",47,0)
PARAMSQ I $G(RCQUIT) K ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWL0",48,0)
 Q
"RTN","RCDPEWL0",49,0)
 ;
"RTN","RCDPEWL0",50,0)
FILTER(Y) ; Returns 1 if record in entry Y in 344.4 passes
"RTN","RCDPEWL0",51,0)
 ; the edits for the worklist selection of ERAs
"RTN","RCDPEWL0",52,0)
 ; Parameters found in ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWL0",53,0)
 N OK,RCPOST,RCMATCH,RCDFR,RCDTO,RCPAYFR,RCPAYTO,RCPAYR,RC0
"RTN","RCDPEWL0",54,0)
 S OK=1,RC0=$G(^RCY(344.4,Y,0))
"RTN","RCDPEWL0",55,0)
 ;
"RTN","RCDPEWL0",56,0)
 S RCMATCH=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH")),RCPOST=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWL0",57,0)
 S RCDFR=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U),RCDTO=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U,2)
"RTN","RCDPEWL0",58,0)
 S RCPAYR=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U),RCPAYFR=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U,2),RCPAYTO=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U,3)
"RTN","RCDPEWL0",59,0)
 ;
"RTN","RCDPEWL0",60,0)
 ; If receipt exists, scratchpad must exist
"RTN","RCDPEWL0",61,0)
 ;I $P(RC0,U,8),'$D(^RCY(344.49,+Y,0)) S OK=0 G FQ
"RTN","RCDPEWL0",62,0)
 ; Post status
"RTN","RCDPEWL0",63,0)
 I $S(RCPOST="B":0,RCPOST="U":$P(RC0,U,14),1:'$P(RC0,U,14)) S OK=0 G FQ
"RTN","RCDPEWL0",64,0)
 ; Match status
"RTN","RCDPEWL0",65,0)
 I $S(RCMATCH="B":0,RCMATCH="N":$P(RC0,U,9),1:'$P(RC0,U,9)) S OK=0 G FQ
"RTN","RCDPEWL0",66,0)
 ; dt rec'd range
"RTN","RCDPEWL0",67,0)
 I $S(RCDFR=0:0,1:$P(RC0,U,7)\1<RCDFR) S OK=0 G FQ
"RTN","RCDPEWL0",68,0)
 I $S(RCDTO=DT:0,1:$P(RC0,U,7)\1>RCDTO) S OK=0 G FQ
"RTN","RCDPEWL0",69,0)
 ; Payer name
"RTN","RCDPEWL0",70,0)
 I RCPAYR'="A" D  G:'OK FQ
"RTN","RCDPEWL0",71,0)
 . N Q
"RTN","RCDPEWL0",72,0)
 . S Q=$$UPPER^RCDPEWL7($P(RC0,U,6))
"RTN","RCDPEWL0",73,0)
 . I $S(Q=RCPAYFR:1,Q=RCPAYTO:1,Q]RCPAYFR:RCPAYTO]Q,1:0) Q
"RTN","RCDPEWL0",74,0)
 . S OK=0
"RTN","RCDPEWL0",75,0)
FQ Q OK
"RTN","RCDPEWL0",76,0)
 ;
"RTN","RCDPEWL0",77,0)
SPLIT ; Split line in ERA list
"RTN","RCDPEWL0",78,0)
 N RCLINE,RCZ,RCDA,Q,Q0,Z,Z0,DIR,X,Y,CT,L,L1,RCONE,RCQUIT
"RTN","RCDPEWL0",79,0)
 D FULL^VALM1
"RTN","RCDPEWL0",80,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G SPLITQ
"RTN","RCDPEWL0",81,0)
 W !!,"SELECT THE ENTRY THAT HAS A LINE YOU NEED TO SPLIT/EDIT",!
"RTN","RCDPEWL0",82,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL0",83,0)
 S Z=+$O(RCDA(0)) G:'$G(RCDA(Z)) SPLITQ
"RTN","RCDPEWL0",84,0)
 S RCLINE=+RCDA(Z),Z0=+$O(^TMP("RCDPE-EOB_WLDX",$J,Z_".999"),-1)
"RTN","RCDPEWL0",85,0)
 S RCZ=Z F  S RCZ=$O(^TMP("RCDPE-EOB_WLDX",$J,RCZ)) Q:'RCZ!(RCZ\1'=Z)  D
"RTN","RCDPEWL0",86,0)
 . S Q=$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCZ)),U,2)
"RTN","RCDPEWL0",87,0)
 . Q:'Q
"RTN","RCDPEWL0",88,0)
 . S RCZ(RCZ)=Q
"RTN","RCDPEWL0",89,0)
 . S Q0=0 F  S Q0=$O(^RCY(344.49,RCSCR,1,Q,1,Q0)) Q:'Q0  I "01"[$P($G(^(Q0,0)),U,2) K RCZ(RCZ) Q
"RTN","RCDPEWL0",90,0)
 I '$O(RCZ(0)) D  G SPLITQ
"RTN","RCDPEWL0",91,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ENTRY HAS NO LINES AVAILABLE TO EDIT/SPLIT",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL0",92,0)
 S RCQUIT=0
"RTN","RCDPEWL0",93,0)
 I $P($G(^RCY(344.49,RCSCR,1,RCLINE,0)),U,13) D  G:RCQUIT SPLITQ
"RTN","RCDPEWL0",94,0)
 . S DIR("A",1)="WARNING!  THIS LINE HAS ALREADY BEEN VERIFIED",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: ",DIR(0)="YA",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL0",95,0)
 . I Y'=1 S RCQUIT=1
"RTN","RCDPEWL0",96,0)
 S CT=0,CT=CT+1,DIR("?",CT)="Enter the line # that you want to split or edit:",RCONE=1
"RTN","RCDPEWL0",97,0)
 S L=Z F  S L=$O(RCZ(L)) Q:'L  D
"RTN","RCDPEWL0",98,0)
 . S L1=+$G(^TMP("RCDPE-EOB_WLDX",$J,L))
"RTN","RCDPEWL0",99,0)
 . S CT=CT+1
"RTN","RCDPEWL0",100,0)
 . S DIR("?",CT)=$G(^TMP("RCDPE-EOB_WL",$J,L1,0)),CT=CT+1,DIR("?",CT)=$G(^TMP("RCDPE-EOB_WL",$J,L1+1,0)) S RCONE(1)=$S(RCONE:L,1:"") S RCONE=0
"RTN","RCDPEWL0",101,0)
 S DIR("?")=" ",Y=-1
"RTN","RCDPEWL0",102,0)
 I $G(RCONE(1)) S Y=+RCONE(1) K DIR G:'Y SPLITQ
"RTN","RCDPEWL0",103,0)
 I '$G(RCONE(1)) D  K DIR I $D(DTOUT)!$D(DUOUT)!(Y\1'=Z) G SPLITQ
"RTN","RCDPEWL0",104,0)
 . F  S DIR(0)="NAO^"_(Z+.001)_":"_Z0_":3",DIR("A")="WHICH LINE OF ENTRY "_Z_" DO YOU WANT TO SPLIT/EDIT?: " S:$G(RCONE(1))'="" DIR("B")=RCONE(1) D ^DIR Q:'Y!$D(DUOUT)!$D(DTOUT)  D  Q:Y>0
"RTN","RCDPEWL0",105,0)
 .. I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !!,"LINE "_Y_" DOES NOT EXIST - TRY AGAIN",! S Y=-1 Q
"RTN","RCDPEWL0",106,0)
 .. I '$D(RCZ(Y)) W !!,"LINE "_Y_" HAS BEEN USED IN A DISTRIBUTE ADJ ACTION AND CAN'T BE EDITED",! S Y=-1 Q
"RTN","RCDPEWL0",107,0)
 .. S Q=+$O(^RCY(344.49,RCSCR,1,"B",Y,0))
"RTN","RCDPEWL0",108,0)
 ;
"RTN","RCDPEWL0",109,0)
 K ^TMP("RCDPE_SPLIT_REBLD",$J)
"RTN","RCDPEWL0",110,0)
 D SPLIT^RCDPEWL3(RCSCR,+Y)
"RTN","RCDPEWL0",111,0)
 I $G(^TMP("RCDPE_SPLIT_REBLD",$J)) K ^TMP("RCDPE_SPLIT_REBLD",$J) D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL0",112,0)
 ;
"RTN","RCDPEWL0",113,0)
SPLITQ S VALMBCK="R"
"RTN","RCDPEWL0",114,0)
 Q
"RTN","RCDPEWL0",115,0)
 ;
"RTN","RCDPEWL0",116,0)
PRTERA ; View/prt
"RTN","RCDPEWL0",117,0)
 N DIC,X,Y,RCSCR
"RTN","RCDPEWL0",118,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL0",119,0)
 Q:Y'>0
"RTN","RCDPEWL0",120,0)
 S RCSCR=+Y
"RTN","RCDPEWL0",121,0)
 D PRERA1
"RTN","RCDPEWL0",122,0)
 Q
"RTN","RCDPEWL0",123,0)
 ;
"RTN","RCDPEWL0",124,0)
PRERA ; RCSCR is assumed to be defined
"RTN","RCDPEWL0",125,0)
 D FULL^VALM1 ; Protocol entry
"RTN","RCDPEWL0",126,0)
PRERA1 ; Option entry
"RTN","RCDPEWL0",127,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,DIR,X,Y,RCERADET
"RTN","RCDPEWL0",128,0)
 S DIR("?",1)="INCLUDING EXPANDED DETAIL WILL SIGNIFICANTLY INCREASE THE SIZE OF THIS REPORT",DIR("?",2)="IF YOU CHOOSE TO INCLUDE IT, ALL PAYMENT DETAILS FOR EACH EEOB WILL BE"
"RTN","RCDPEWL0",129,0)
 S DIR("?")="LISTED.  IF YOU WANT JUST SUMMARY DATA FOR EACH EEOB, DO NOT INCLUDE IT."
"RTN","RCDPEWL0",130,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO INCLUDE EXPANDED EEOB DETAIL?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL0",131,0)
 I $D(DUOUT)!$D(DTOUT) G PRERAQ
"RTN","RCDPEWL0",132,0)
 S RCERADET=+Y
"RTN","RCDPEWL0",133,0)
 S %ZIS="QM" D ^%ZIS G:POP PRERAQ
"RTN","RCDPEWL0",134,0)
 I $D(IO("Q")) D  G PRERAQ
"RTN","RCDPEWL0",135,0)
 . S ZTRTN="VPERA^RCDPEWL0("_RCSCR_","_RCERADET_")",ZTDESC="AR - Print ERA From Worklist"
"RTN","RCDPEWL0",136,0)
 . D ^%ZTLOAD
"RTN","RCDPEWL0",137,0)
 . W !!,$S($D(ZTSK):"Your task # "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEWL0",138,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEWL0",139,0)
 U IO
"RTN","RCDPEWL0",140,0)
 D VPERA(RCSCR,RCERADET)
"RTN","RCDPEWL0",141,0)
 Q
"RTN","RCDPEWL0",142,0)
 ;
"RTN","RCDPEWL0",143,0)
VPERA(RCSCR,RCERADET) ; Queued entry
"RTN","RCDPEWL0",144,0)
 ; RCSCR = ien of entry in file 344.4
"RTN","RCDPEWL0",145,0)
 ; RCERADET = 1 if inclusion of all EOB details from file 361.1 is
"RTN","RCDPEWL0",146,0)
 ;  desired, 0 if not
"RTN","RCDPEWL0",147,0)
 N Z,Z0,RCSTOP,RCZ,RCPG,RCDOT,RCDIQ,RCDIQ1,RCDIQ2,RCXM1,RC,RCSCR1,RC3611
"RTN","RCDPEWL0",148,0)
 K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT"),^TMP($J,"RC_SUMALL")
"RTN","RCDPEWL0",149,0)
 S (RCSTOP,RCPG)=0,RCDOT="",$P(RCDOT,".",79)=""
"RTN","RCDPEWL0",150,0)
 D GETS^DIQ(344.4,RCSCR_",","*","IEN","RCDIQ")
"RTN","RCDPEWL0",151,0)
 D TXT0^RCDPEX31(RCSCR,.RCDIQ,.RCXM1,.RC) ; Get top level 0-node captioned flds
"RTN","RCDPEWL0",152,0)
 I $O(^RCY(344.4,RCSCR,2,0)) S RC=RC+1,RCXM1(RC)="  **ERA LEVEL ADJUSTMENTS**"
"RTN","RCDPEWL0",153,0)
 S RCSCR1=0 F  S RCSCR1=$O(^RCY(344.4,RCSCR,2,RCSCR1)) Q:'RCSCR1  D
"RTN","RCDPEWL0",154,0)
 . K RCDIQ2
"RTN","RCDPEWL0",155,0)
 . D GETS^DIQ(344.42,RCSCR1_","_RCSCR_",","*","IEN","RCDIQ2")
"RTN","RCDPEWL0",156,0)
 . D TXT2^RCDPEX31(RCSCR,RCSCR1,.RCDIQ2,.RCXM1,.RC) ; Get top level ERA adjs
"RTN","RCDPEWL0",157,0)
 S RCSCR1=0 F  S RCSCR1=$O(^RCY(344.4,RCSCR,1,RCSCR1)) Q:'RCSCR1  D
"RTN","RCDPEWL0",158,0)
 . K RCDIQ1
"RTN","RCDPEWL0",159,0)
 . D GETS^DIQ(344.41,RCSCR1_","_RCSCR_",","*","IEN","RCDIQ1")
"RTN","RCDPEWL0",160,0)
 . D TXT00^RCDPEX31(RCSCR,RCSCR1,.RCDIQ1,.RCXM1,.RC)
"RTN","RCDPEWL0",161,0)
 . S RC=RC+1,RCXM1(RC-1)=$E("PATIENT: "_$$PNM4^RCDPEWL1(RCSCR,RCSCR1)_$J("",41),1,41)_"CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,RCSCR1),RCXM1(RC)=" "
"RTN","RCDPEWL0",162,0)
 . S RC3611=$P($G(^RCY(344.4,RCSCR,1,RCSCR1,0)),U,2)
"RTN","RCDPEWL0",163,0)
 . I RCERADET D  ; Include formatted txt from 361.1 or 344.411
"RTN","RCDPEWL0",164,0)
 .. I 'RC3611 D  Q  ; Formatted raw data
"RTN","RCDPEWL0",165,0)
 ... D DISP^RCDPESR0("^RCY(344.4,"_RCSCR_",1,"_RCSCR1_",1)","^TMP($J,""RC_SUMRAW"")",1,"^TMP($J,""RC_SUMOUT"")",75,1)
"RTN","RCDPEWL0",166,0)
 ..;
"RTN","RCDPEWL0",167,0)
 .. E  D  ; Detail record is in 361.1
"RTN","RCDPEWL0",168,0)
 ... K ^TMP("PRCA_EOB",$J)
"RTN","RCDPEWL0",169,0)
 ... D GETEOB^IBCECSA6(RC3611,2)
"RTN","RCDPEWL0",170,0)
 ... I $O(^IBM(361.1,RC3611,"ERR",0)) D GETERR^RCDPEDS(RC3611,+$O(^TMP("PRCA_EOB",$J,RC3611," "),-1)) ; get filing errors
"RTN","RCDPEWL0",171,0)
 ... S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,RC3611,Z)) Q:'Z  S RC=RC+1,^TMP($J,"RC_SUMOUT",RC)=$G(^TMP("PRCA_EOB",$J,RC3611,Z))
"RTN","RCDPEWL0",172,0)
 ... S RC=RC+2,^TMP($J,"RC_SUMOUT",RC-1)=" ",^TMP($J,"RC_SUMOUT",RC)=" "
"RTN","RCDPEWL0",173,0)
 ... K ^TMP("PRCA_EOB",$J)
"RTN","RCDPEWL0",174,0)
 . I $D(RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2)) D
"RTN","RCDPEWL0",175,0)
 .. S RC=RC+1,RCXM1(RC)="  **EXCEPTION RESOLUTION LOG DATA**"
"RTN","RCDPEWL0",176,0)
 .. S Z=0 F  S Z=$O(RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2,Z)) Q:'Z  S RC=RC+1,RCXM1(RC)=RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2,Z)
"RTN","RCDPEWL0",177,0)
 . S RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEWL0",178,0)
 . S Z0=+$O(^TMP($J,"RC_SUMALL"," "),-1)
"RTN","RCDPEWL0",179,0)
 . S Z=0 F  S Z=$O(RCXM1(Z)) Q:'Z  S Z0=Z0+1,^TMP($J,"RC_SUMALL",Z0)=RCXM1(Z)
"RTN","RCDPEWL0",180,0)
 . K RCXM1 S RC=0
"RTN","RCDPEWL0",181,0)
 . S Z=0 F  S Z=$O(^TMP($J,"RC_SUMOUT",Z)) Q:'Z  S Z0=Z0+1,^TMP($J,"RC_SUMALL",Z0)=$G(^TMP($J,"RC_SUMOUT",Z))
"RTN","RCDPEWL0",182,0)
 S RCSTOP=0,Z=""
"RTN","RCDPEWL0",183,0)
 F  S Z=$O(^TMP($J,"RC_SUMALL",Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEWL0",184,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEWL0",185,0)
 . I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEWL0",186,0)
 .. D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEWL0",187,0)
 .. D HDR(.RCPG)
"RTN","RCDPEWL0",188,0)
 . W !,$G(^TMP($J,"RC_SUMALL",Z))
"RTN","RCDPEWL0",189,0)
 ;
"RTN","RCDPEWL0",190,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEWL0",191,0)
 ;
"RTN","RCDPEWL0",192,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEWL0",193,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEWL0",194,0)
 ;
"RTN","RCDPEWL0",195,0)
PRERAQ K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT"),^TMP($J,"SUMALL")
"RTN","RCDPEWL0",196,0)
 S VALMBCK="R"
"RTN","RCDPEWL0",197,0)
 Q
"RTN","RCDPEWL0",198,0)
 ;
"RTN","RCDPEWL0",199,0)
HDR(RCPG) ;Report hdr
"RTN","RCDPEWL0",200,0)
 ; RCPG = last page #
"RTN","RCDPEWL0",201,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEWL0",202,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEWL0",203,0)
 W !,?5,"EDI LOCKBOX WORKLIST - ERA DETAIL",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!,$TR($J("",IOM)," ","=")
"RTN","RCDPEWL0",204,0)
 Q
"RTN","RCDPEWL0",205,0)
 ;
"RTN","RCDPEWL0",206,0)
ASK(RCSTOP) ;
"RTN","RCDPEWL0",207,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEWL0",208,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEWL0",209,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEWL0",210,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEWL0",211,0)
 Q
"RTN","RCDPEWL0",212,0)
 ;
"RTN","RCDPEWL1")
0^5^B53355321
"RTN","RCDPEWL1",1,0)
RCDPEWL1 ;ALB/TMK - ELECTRONIC EOB WORKLIST SCREEN ;26-NOV-02
"RTN","RCDPEWL1",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL1",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL1",5,0)
 ; IA for call to ^DGENA = 3812
"RTN","RCDPEWL1",6,0)
 Q
"RTN","RCDPEWL1",7,0)
 ;
"RTN","RCDPEWL1",8,0)
BLD(RCSORT) ; Build the detail display record for the WL scratch pad record
"RTN","RCDPEWL1",9,0)
 ; Assume RCSCR = ien from file 344.49
"RTN","RCDPEWL1",10,0)
 ; RCSORT = "" or 'N' for no sort  'F' for 0-pays first, 'L' for last
"RTN","RCDPEWL1",11,0)
 ;
"RTN","RCDPEWL1",12,0)
 N A,A0,B,B0,Q,Q0,Q1,QQ,V1,X,Y,Z,Z0,Z3,ZZ,ZZ1,RCT,RCZ,RCZ0,RCZZ0,RCSA,RCAZ,RCAZ0,RCSCT,RCS1,RCLI1,RCY34441,RCZERO,RCTS,RCTL
"RTN","RCDPEWL1",13,0)
 S RCSORT=$P($G(RCSORT),U),RCSORT=$S(RCSORT="":"N",1:RCSORT),RCTS=0
"RTN","RCDPEWL1",14,0)
 K ^TMP("RCDPE-EOB_WL",$J),^TMP("RCDPE-EOB_WLDX",$J),^TMP($J,"RCS"),^TMP("RC_BILL",$J)
"RTN","RCDPEWL1",15,0)
 ;
"RTN","RCDPEWL1",16,0)
 S VALMCNT=0
"RTN","RCDPEWL1",17,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,"B",Z)) Q:'Z  I Z#1=0 S ZZ=+$O(^RCY(344.49,RCSCR,1,"B",Z,0)) I ZZ D
"RTN","RCDPEWL1",18,0)
 . S RCZ=ZZ,RCZ0=$G(^RCY(344.49,RCSCR,1,ZZ,0)),RCS1=$P(RCZ0,U,6)
"RTN","RCDPEWL1",19,0)
 . Q:$S('$G(^TMP("RCBATCH_SELECTED",$J)):0,1:$P(RCZ0,U,14)'=+^TMP("RCBATCH_SELECTED",$J))  ; Must be entire ERA or match the selected batch to continue
"RTN","RCDPEWL1",20,0)
 . S RCZERO=$S($P(RCZ0,U,2)["**ADJ":"-1",RCSORT="N":1,RCSORT="F":+RCS1'=0,1:+RCS1=0)
"RTN","RCDPEWL1",21,0)
 . ;
"RTN","RCDPEWL1",22,0)
 . ; This is a top-level entry - find the sublines
"RTN","RCDPEWL1",23,0)
 . S Z0=Z F  S Z0=$O(^RCY(344.49,RCSCR,1,"B",Z0)) Q:((Z0\1)'=(Z\1))  S Z=Z0,ZZ1=+$O(^RCY(344.49,RCSCR,1,"B",Z0,0)) I ZZ1 D
"RTN","RCDPEWL1",24,0)
 .. S ^TMP($J,"RCS",RCZERO,ZZ,ZZ1)=""
"RTN","RCDPEWL1",25,0)
 . S ^TMP($J,"RCS",RCZERO,ZZ)=""
"RTN","RCDPEWL1",26,0)
 ;
"RTN","RCDPEWL1",27,0)
 S RCZERO="",RCTS=0 F  S RCZERO=$O(^TMP($J,"RCS",RCZERO)) Q:RCZERO=""  S ZZ=0 F  S ZZ=$O(^TMP($J,"RCS",RCZERO,ZZ)) Q:'ZZ  D
"RTN","RCDPEWL1",28,0)
 . N A
"RTN","RCDPEWL1",29,0)
 . S RCZ0=$G(^RCY(344.49,RCSCR,1,ZZ,0)),RCS1=$P(RCZ0,U,6),RCTS=RCTS+1,RCY34441=$G(^RCY(344.4,RCSCR,1,+$P(RCZ0,U,9),0))
"RTN","RCDPEWL1",30,0)
 . S A=$$TOPLINE(RCZ0,RCTS)
"RTN","RCDPEWL1",31,0)
 . D SET(A,RCTS,RCTS,ZZ)
"RTN","RCDPEWL1",32,0)
 . I $P(RCY34441,U,11) D
"RTN","RCDPEWL1",33,0)
 .. D SET("EEOB TRANSFERRED TO "_$E($P($G(^DIC(4,+$P(RCY34441,U,11),0)),U),1,20)_" "_$$FMTE^XLFDT($P(RCY34441,U,12),"2D")_" STATUS: "_$$EXTERNAL^DILFD(344.41,.1,"",+$P(RCY34441,U,10)),RCTS,RCTS,ZZ)
"RTN","RCDPEWL1",34,0)
 . ;
"RTN","RCDPEWL1",35,0)
 . S RCT=RCTS
"RTN","RCDPEWL1",36,0)
 . S ZZ1=0 F  S ZZ1=$O(^TMP($J,"RCS",RCZERO,ZZ,ZZ1)) Q:'ZZ1  D
"RTN","RCDPEWL1",37,0)
 .. S RCT=RCT+.001
"RTN","RCDPEWL1",38,0)
 .. S RCTL=$L(RCT)
"RTN","RCDPEWL1",39,0)
 .. S RCZZ0=$G(^RCY(344.49,RCSCR,1,ZZ1,0))
"RTN","RCDPEWL1",40,0)
 .. S V1=$S($P(RCZ0,U,2)'["**ADJ":"",$P($P(RCZ0,U,2),"ADJ",2):"***ADJUSTMENT AT ERA LEVEL",1:"*** ADJUSTMENT LINE FOR TOTALS MISMATCH")
"RTN","RCDPEWL1",41,0)
 .. S RCLI1=$S(V1="":" Claim #: "_$P(RCZZ0,U,2)_" Patient/Last 4: "_$S($P(RCZZ0,U,7):$$PNM4("","",$P(RCZZ0,U,7)),'$P($G(^RCY(344.49,RCSCR,1,ZZ1,2)),U,3):$$PNM4(+$G(^RCY(344.49,RCSCR,0)),RCZ),1:"??"),1:V1)
"RTN","RCDPEWL1",42,0)
 .. D SET($J("",4)_$P("   ^(V)",U,$P(RCZZ0,U,13)+1)_RCT_RCLI1,RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",43,0)
 .. I '$P(RCZZ0,U,7),$P(RCZ0,U,2)'["**ADJ" D SET($J("",4+RCTL)_"***CLAIM NOT FOUND IN YOUR AR ***",RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",44,0)
 .. I $P(RCZZ0,U,7) D
"RTN","RCDPEWL1",45,0)
 ... N A,RCX,Q
"RTN","RCDPEWL1",46,0)
 ... S A("OA")=$$ORI^PRCAFN(+$P(RCZZ0,U,7)),A("SDT")=$P($G(^DGCR(399,+$P(RCZZ0,U,7),"U")),U),A("DFN")=+$P($G(^(0)),U,2),A("ENRPR")=""
"RTN","RCDPEWL1",47,0)
 ... ; Find Rx copay status
"RTN","RCDPEWL1",48,0)
 ... S A("RXCP")=$S('A("SDT"):"",1:$$RXST^IBARXEU(A("DFN"),A("SDT"))),A("RXCP")=$S($P(A("RXCP"),U)'="":$P(A("RXCP"),U,2),1:"UNKNOWN") ;IA #10147
"RTN","RCDPEWL1",49,0)
 ... ; Find M/T status
"RTN","RCDPEWL1",50,0)
 ... S RCX=$$LST^DGMTU(A("DFN"),A("SDT")),A("M/T")=$P(RCX,U,4)
"RTN","RCDPEWL1",51,0)
 ... S A("M/T")=$S('RCX:"??",A("M/T")="P":"PEN",A("M/T")="C":"YES",A("M/T")="G":"GMT",A("M/T")="R":"REQ",1:"NO")
"RTN","RCDPEWL1",52,0)
 ... ;
"RTN","RCDPEWL1",53,0)
 ... S QQ="   Billed Amt: "_$J(A("OA"),"",2)_"   Amt To Post: "_$J(+$P(RCZZ0,U,3),"",2)
"RTN","RCDPEWL1",54,0)
 ... D SET($J("",4+RCTL)_"Claim Bal: "_$J(+$P($$BILL^RCJIBFN2(+$P(RCZZ0,U,7)),U,3),"",2)_QQ,RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",55,0)
 ... S ^TMP("RC_BILL",$J,$P(RCZZ0,U,7),RCT)=QQ
"RTN","RCDPEWL1",56,0)
 ... S Z3=$J("",4+RCTL)_"Svc Dt: "_$S(A("SDT")'="":$$FMTE^XLFDT(A("SDT"),2),1:"UNKNOWN")
"RTN","RCDPEWL1",57,0)
 ... S Z3=Z3_"  COB: "_$S($D(^DGCR(399,+$P(RCZZ0,U,7),"I"_($$COBN(+$P(RCZZ0,U,7))+1))):"YES",1:"NO ")
"RTN","RCDPEWL1",58,0)
 ... D SET(Z3_"  Rx Copay: "_$E(A("RXCP"),1,17)_"  Means Tst: "_A("M/T"),RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",59,0)
 .. ;
"RTN","RCDPEWL1",60,0)
 .. D SET($J("",4+RCTL)_"Payment Amt: "_$J(+$P(RCZZ0,U,5),"",2)_"   Total Adjustments: "_$J(+$P(RCZZ0,U,8),"",2)_"  Net: "_$J($P(RCZZ0,U,5)+$P(RCZZ0,U,8),"",2),RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",61,0)
 .. I $P(RCZZ0,U,10)'="" D SET($J("",9)_"Receipt Comment: "_$P(RCZZ0,U,10),RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",62,0)
 .. I $O(^RCY(344.49,RCSCR,1,ZZ1,1,0)) D
"RTN","RCDPEWL1",63,0)
 ... S Z3=""
"RTN","RCDPEWL1",64,0)
 ... D SET($J("",4+RCTL)_"ADJUSTMENTS:",RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",65,0)
 ... S RCAZ=0 F  S RCAZ=$O(^RCY(344.49,RCSCR,1,ZZ1,1,RCAZ)) Q:'RCAZ  S RCAZ0=$G(^(RCAZ,0)) D
"RTN","RCDPEWL1",66,0)
 .... S Z3=$J("",6+RCTL)_+RCAZ0_".  ",Q=$L(Z3)
"RTN","RCDPEWL1",67,0)
 .... ;
"RTN","RCDPEWL1",68,0)
 .... I $P(RCAZ0,U,2)=0 S Z3=Z3_"Distributed adj dec for retraction "_$P(RCAZ0,U,4)_": "_$P(RCAZ0,U,3)
"RTN","RCDPEWL1",69,0)
 .... I $P(RCAZ0,U,2)=1 S Z3=Z3_"Adjustment distribution to balance receipt: "_$P(RCAZ0,U,3)
"RTN","RCDPEWL1",70,0)
 .... ;
"RTN","RCDPEWL1",71,0)
 .... I $P(RCAZ0,U,2)=2!($P(RCAZ0,U,2)=4) D
"RTN","RCDPEWL1",72,0)
 ..... S Z3=Z3_"ERA payment adjusted from "_$J($P(RCZZ0,U,5)-$P(RCZZ0,U,6),"",2)_" to "_$J(+$P(RCZZ0,U,5),"",2)_"  NET: "_$J($P(RCZZ0,U,5)+$P(RCAZ0,U,3),"",2)
"RTN","RCDPEWL1",73,0)
 .... I $P(RCAZ0,U,2)=5 S Z3=Z3_"Non-specific payment (ref# "_$P(RCAZ0,U,4)_"): "_$P(RCAZ0,U,3)
"RTN","RCDPEWL1",74,0)
 .... I $P(RCAZ0,U,2)=3 S Z3=Z3_"Non-specific retraction (ref# "_$P(RCAZ0,U,4)_"): "_$P(RCAZ0,U,3)
"RTN","RCDPEWL1",75,0)
 .... D SET(Z3,RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",76,0)
 .... I $P(RCAZ0,U,9)'="" D SET($J("",Q)_$P(RCAZ0,U,9),RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",77,0)
 .. ;
"RTN","RCDPEWL1",78,0)
 .. I $P($G(^TMP($J,"RC_SORTPARM")),U,2) D
"RTN","RCDPEWL1",79,0)
 ... S A=$J("",10)_"REVIEW STATUS: ("_$S($P(RCZ0,U,11)="I":"REVIEW IN PROCESS",$P(RCZ0,U,11)=1:"REVIEWED",1:"NOT REVIEWED")
"RTN","RCDPEWL1",80,0)
 ... I $P(RCZ0,U,12) S A=A_"   SET BY: "_$E($P($G(^VA(200,$P(RCZ0,U,12),0)),U),1,20)
"RTN","RCDPEWL1",81,0)
 ... D SET(A_")",+RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",82,0)
 ... S A=0 F  S A=$O(^RCY(344.49,RCSCR,1,ZZ,4,A)) Q:'A  S A0=$G(^(A,0)) D
"RTN","RCDPEWL1",83,0)
 .... D SET($J("",12)_$$FMTE^XLFDT($P(A0,U),2)_"  "_$P($G(^VA(200,+$P(A0,U,2),0)),U)_$S($P(A0,U,4):"  LAST EDIT: "_$$FMTE^XLFDT($P(A0,U,4),2),1:""),RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",84,0)
 .... S B=0 F  S B=$O(^RCY(344.49,RCSCR,1,ZZ,4,A,1,B)) Q:'B  S B0=$G(^(B,0)) D
"RTN","RCDPEWL1",85,0)
 ..... I $L(B0)>64 D SET($J("",15)_$E(B0,1,64),RCTS,RCT,ZZ1) S B0="  "_$E(B0,65,$L(B0)) ; Split line if > 64 characters in comment line
"RTN","RCDPEWL1",86,0)
 ..... D SET($J("",15)_B0,RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",87,0)
 .. S A="",$P(A,".",79)="" D SET(A,RCTS,RCT,ZZ1)
"RTN","RCDPEWL1",88,0)
 ;
"RTN","RCDPEWL1",89,0)
 I VALMCNT=0,$G(^TMP("RCBATCH_SELECTED",$J)) D SET("THERE ARE NO EEOBs ASSIGNED TO THIS BATCH")
"RTN","RCDPEWL1",90,0)
 K ^TMP($J,"RCS")
"RTN","RCDPEWL1",91,0)
 Q
"RTN","RCDPEWL1",92,0)
 ;
"RTN","RCDPEWL1",93,0)
TOPLINE(RCZ0,RCTS) ; Function returns the top line of the EEOB display
"RTN","RCDPEWL1",94,0)
 ; RCZ0 = the 0-node of the whole number entry line for the EEOB
"RTN","RCDPEWL1",95,0)
 ; RCTS = the selectable line #
"RTN","RCDPEWL1",96,0)
 N A
"RTN","RCDPEWL1",97,0)
 S A=" "_$S($P(RCZ0,U,13):"(V)",1:"   ")_"EEOB Seq #"_$S($P(RCZ0,U,9)[",":"'s",1:"")_" On ERA: "_$S($P(RCZ0,U,9)'="":$P(RCZ0,U,9),1:"None")_"   Net Payment Amt: "_$J(+$P(RCZ0,U,6),"",2)
"RTN","RCDPEWL1",98,0)
 I $P($G(^TMP($J,"RC_SORTPARM")),U,2) S A=A_"  Reviewed?: "_$S($P(RCZ0,U,11)="":"NO",1:$$EXTERNAL^DILFD(344.491,.11,,$P(RCZ0,U,11)))
"RTN","RCDPEWL1",99,0)
 S A=$E(RCTS_$J("",4),1,4)_A
"RTN","RCDPEWL1",100,0)
 Q A
"RTN","RCDPEWL1",101,0)
 ;
"RTN","RCDPEWL1",102,0)
INIT ;
"RTN","RCDPEWL1",103,0)
 S VALMBG=$G(^TMP($J,"RC_VALMBG"))
"RTN","RCDPEWL1",104,0)
 Q
"RTN","RCDPEWL1",105,0)
 ;
"RTN","RCDPEWL1",106,0)
HDR ;
"RTN","RCDPEWL1",107,0)
 D HDR^RCDPEWL
"RTN","RCDPEWL1",108,0)
 Q
"RTN","RCDPEWL1",109,0)
 ;
"RTN","RCDPEWL1",110,0)
FNL ; -- Clean up list
"RTN","RCDPEWL1",111,0)
 K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL1",112,0)
 K RCFASTXT
"RTN","RCDPEWL1",113,0)
 Q
"RTN","RCDPEWL1",114,0)
 ;
"RTN","RCDPEWL1",115,0)
SET(X,RCSEQ,RCSEQ1,RCZ9) ; -- set arrays
"RTN","RCDPEWL1",116,0)
 ; X = the data to set into the global
"RTN","RCDPEWL1",117,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEWL1",118,0)
 ; RCSEQ1 = the sub line #
"RTN","RCDPEWL1",119,0)
 ; RCZ9 = reference to the line(s) in file 344.41 or to the subline in
"RTN","RCDPEWL1",120,0)
 ;        file 344.49 for RCSEQ having a decimal
"RTN","RCDPEWL1",121,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-EOB_WL",$J,VALMCNT,0)=X
"RTN","RCDPEWL1",122,0)
 I $G(RCSEQ) S ^TMP("RCDPE-EOB_WL",$J,"IDX",VALMCNT,RCSEQ)=""
"RTN","RCDPEWL1",123,0)
 I $G(RCSEQ1),'$D(^TMP("RCDPE-EOB_WLDX",$J,RCSEQ1)) S ^TMP("RCDPE-EOB_WLDX",$J,RCSEQ1)=VALMCNT_U_$G(RCZ9)
"RTN","RCDPEWL1",124,0)
 Q
"RTN","RCDPEWL1",125,0)
 ;
"RTN","RCDPEWL1",126,0)
PNM4(RCIFN,RCDA,RC) ; Returns either the patient name or patient name/last 4
"RTN","RCDPEWL1",127,0)
 ; RCIFN = ien of file 344.4
"RTN","RCDPEWL1",128,0)
 ; RCDA = ien of file 344.41
"RTN","RCDPEWL1",129,0)
 ; RC = the ien of file 430
"RTN","RCDPEWL1",130,0)
 N Z,Z0,Q
"RTN","RCDPEWL1",131,0)
 S Z=""
"RTN","RCDPEWL1",132,0)
 I $G(RCIFN)'="" D
"RTN","RCDPEWL1",133,0)
 . S Z0=$G(^RCY(344.4,RCIFN,1,RCDA,0)),Z=""
"RTN","RCDPEWL1",134,0)
 . I $P(Z0,U,2) S Q=+$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(Z0,U,2),0)),0)),U,2),Z=$P($G(^DPT(Q,0)),U)_"/"_$E($P($G(^(0)),U,9),6,9) ; IA 4051
"RTN","RCDPEWL1",135,0)
 . I $TR(Z,"/")="" S Z=$P(Z0,U,15)
"RTN","RCDPEWL1",136,0)
 I $G(RC)'="" D
"RTN","RCDPEWL1",137,0)
 . S Q=+$P($G(^PRCA(430,RC,0)),U,7)
"RTN","RCDPEWL1",138,0)
 . I Q S Z=$P($G(^DPT(Q,0)),U)_"/"_$E($P($G(^(0)),U,9),6,9)
"RTN","RCDPEWL1",139,0)
 Q Z
"RTN","RCDPEWL1",140,0)
 ;
"RTN","RCDPEWL1",141,0)
COBN(RC,A) ; Return seq # of selected payer
"RTN","RCDPEWL1",142,0)
 ; A = 'PST' or null to get current bill payer seq #
"RTN","RCDPEWL1",143,0)
 I $G(A)="" S A=$P($G(^DGCR(399,RC,0)),U,21) S:A="" A="P" S:"PST"'[A A="P"
"RTN","RCDPEWL1",144,0)
 I 'A S A=$F("PST",A)-1 S:A<1 A=1
"RTN","RCDPEWL1",145,0)
 Q A
"RTN","RCDPEWL1",146,0)
 ;
"RTN","RCDPEWL1",147,0)
COPAY(RCIFN)       ; Returns 1 if any not cancelled 1st party bills exist for
"RTN","RCDPEWL1",148,0)
 ; a 3rd party bill or any bills related to this 3rd party bill
"RTN","RCDPEWL1",149,0)
 ; RCIFN = the 3rd party bill #
"RTN","RCDPEWL1",150,0)
 N FIRST,RCTP0,RCTP1,RCTP2
"RTN","RCDPEWL1",151,0)
 K ^TMP("IBRBF",$J),^TMP($J,"IBRBF")
"RTN","RCDPEWL1",152,0)
 D RELBILL^IBRFN(RCIFN) ; DBIA 3124
"RTN","RCDPEWL1",153,0)
 S RCTP0=0 F  S RCTP0=$O(^TMP("IBRBF",$J,RCIFN,RCTP0)) Q:RCTP0=""  S RCTP1=$G(^(RCTP0)) D
"RTN","RCDPEWL1",154,0)
 . I $P(RCTP1,U,3) K ^TMP("IBRBF",$J,RCIFN,RCTP0) Q  ; IB cancelled
"RTN","RCDPEWL1",155,0)
 . S RCTP2=$O(^PRCA(430,"B",+$P(RCTP1,U,4),0)) I $P($G(^PRCA(430,+RCTP2,0)),U,8)=39 K ^TMP("IBRBF",$J,RCIFN,RCTP0) ; AR cancelled
"RTN","RCDPEWL1",156,0)
 S FIRST=$S($O(^TMP("IBRBF",$J,RCIFN,0)):1,1:0)
"RTN","RCDPEWL1",157,0)
 K ^TMP("IBRBF",$J),^TMP($J,"IBRBF")
"RTN","RCDPEWL1",158,0)
 Q FIRST
"RTN","RCDPEWL1",159,0)
 ;
"RTN","RCDPEWL2")
0^19^B84516600
"RTN","RCDPEWL2",1,0)
RCDPEWL2 ;ALB/TMK - ELECTRONIC EOB WORKLIST ACTIONS ;26-NOV-02
"RTN","RCDPEWL2",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL2",4,0)
 ; IA for call to OPTION^IBJTLA = 4121
"RTN","RCDPEWL2",5,0)
 ; IA for call to ASK^IBRREL = 306
"RTN","RCDPEWL2",6,0)
 ; IA call for EN1AR^IBECEA = 4047
"RTN","RCDPEWL2",7,0)
 ; IA call for MAIN^IBOHPT1 = 4048
"RTN","RCDPEWL2",8,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL2",9,0)
 Q
"RTN","RCDPEWL2",10,0)
 ;
"RTN","RCDPEWL2",11,0)
VP(RCSCR,RCDAZ) ; View/Print EOB Detail data from file 361.1
"RTN","RCDPEWL2",12,0)
 ; RCSCR = ien of entry in file 344.4
"RTN","RCDPEWL2",13,0)
 ; RCDAZ = array subscripted by a sequential # and
"RTN","RCDPEWL2",14,0)
 ;   RCDAZ(n) = one of 3 formats
"RTN","RCDPEWL2",15,0)
 ;     ERA level adjustments
"RTN","RCDPEWL2",16,0)
 ;          ADJ^the ien of the adj in 344.42
"RTN","RCDPEWL2",17,0)
 ;     EOB exists in file 361.1:
"RTN","RCDPEWL2",18,0)
 ;          ien of line in 344.41^ien of 361.1
"RTN","RCDPEWL2",19,0)
 ;     EOB doesn't exist in 361.1:
"RTN","RCDPEWL2",20,0)
 ;          ien of line in 344.41^-1
"RTN","RCDPEWL2",21,0)
 ;
"RTN","RCDPEWL2",22,0)
 N RCDA,%ZIS,ZTRTN,ZTSAVE,ZTDESC,POP
"RTN","RCDPEWL2",23,0)
 ; Ask device
"RTN","RCDPEWL2",24,0)
 S %ZIS="QM" D ^%ZIS G:POP VPQ
"RTN","RCDPEWL2",25,0)
 I $D(IO("Q")) D  G VPQ
"RTN","RCDPEWL2",26,0)
 . S ZTRTN="VPOUT^RCDPEWL2",ZTDESC="AR - Print EEOB Detail from Worklist"
"RTN","RCDPEWL2",27,0)
 . S ZTSAVE("RC*")=""
"RTN","RCDPEWL2",28,0)
 . D ^%ZTLOAD
"RTN","RCDPEWL2",29,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEWL2",30,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEWL2",31,0)
 U IO
"RTN","RCDPEWL2",32,0)
 ;
"RTN","RCDPEWL2",33,0)
VPOUT ; Entrypoint for queued job
"RTN","RCDPEWL2",34,0)
 N Z,Z0,RCSTOP,RCPG,RCREF,RC3611,RCDASH,RCDT,RC1,RC3444,RCZ,RCZ0
"RTN","RCDPEWL2",35,0)
 ;
"RTN","RCDPEWL2",36,0)
 K ^TMP("PRCA_EOB",$J),^TMP("PRCA_EOB1",$J)
"RTN","RCDPEWL2",37,0)
 S RCDT=DT,(RCSTOP,RCPG)=0,RC3444=RCSCR,RCDASH="",$P(RCDASH,"-",71)=""
"RTN","RCDPEWL2",38,0)
 I '$O(RCDAZ(0)) G VPQ
"RTN","RCDPEWL2",39,0)
 S RCZ=0 F  S RCZ=$O(RCDAZ(RCZ)) Q:'RCZ  D
"RTN","RCDPEWL2",40,0)
 . S RCREF=$P(RCDAZ(RCZ),U),RC3611=+$P(RCDAZ(RCZ),U,2)
"RTN","RCDPEWL2",41,0)
 . K ^TMP("PRCA_EOB1",$J,RC3611)
"RTN","RCDPEWL2",42,0)
 . ;
"RTN","RCDPEWL2",43,0)
 . I $E(RCREF,1,3)["ADJ" D  Q
"RTN","RCDPEWL2",44,0)
 .. ;Display ERA level adj
"RTN","RCDPEWL2",45,0)
 .. S RCZ0=$G(^RCY(344.4,RCSCR,2,RC3611,0))
"RTN","RCDPEWL2",46,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",1)="ERA LEVEL ADJUSTMENT #"_RC3611
"RTN","RCDPEWL2",47,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",2)="   ADJUSTMENT REFERENCE #: "_$P(RCZ0,U)
"RTN","RCDPEWL2",48,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",3)="   ADJUSTMENT REASON CODE: "_$P(RCZ0,U,2)
"RTN","RCDPEWL2",49,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",4)="        ADJUSTMENT AMOUNT: "_$J(+$P(RCZ0,U,3),"",2)
"RTN","RCDPEWL2",50,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",5)=RCDASH
"RTN","RCDPEWL2",51,0)
 . ;
"RTN","RCDPEWL2",52,0)
 . I $P(RCDAZ(RCZ),U,2)'>0 D  Q
"RTN","RCDPEWL2",53,0)
 .. ;Display formatted raw data - no EOB data in 361.1
"RTN","RCDPEWL2",54,0)
 .. K ^TMP($J,"RC_SUMRAW")
"RTN","RCDPEWL2",55,0)
 .. D DISP^RCDPESR0("^RCY(344.4,"_RCSCR_",1,"_+RCDAZ(RCZ)_",1)","^TMP($J,""RC_SUMRAW"")",1,"^TMP(""PRCA_EOB"",$J,0)")
"RTN","RCDPEWL2",56,0)
 .. S ^TMP("PRCA_EOB1",$J,RC3611,1)="CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,+RCDAZ(RCZ))_"*** NOT IDENTIFIED IN A/R ****"_$S($P($G(^RCY(344.4,RCSCR,1,+RCDAZ(RCZ),0)),U,14):" (REVERSAL)",1:"")
"RTN","RCDPEWL2",57,0)
 .. K ^TMP($J,"RC_SUMRAW")
"RTN","RCDPEWL2",58,0)
 .. S ^TMP("PRCA_EOB",$J,+$O(^TMP("PRCA_EOB",$J,""),-1)+1)=RCDASH
"RTN","RCDPEWL2",59,0)
 . ;
"RTN","RCDPEWL2",60,0)
 . K ^TMP("PRCA_EOB1",$J,RC3611)
"RTN","RCDPEWL2",61,0)
 . S ^TMP("PRCA_EOB1",$J,RC3611,1)="CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,+RCDAZ(RCZ))_$S($P($G(^RCY(344.4,RCSCR,1,+RCDAZ(RCZ),0)),U,14):" (REVERSAL)",1:"")
"RTN","RCDPEWL2",62,0)
 . D GETEOB^IBCECSA6(RC3611,2)
"RTN","RCDPEWL2",63,0)
 . I $O(^IBM(361.1,RC3611,"ERR",0)) D GETERR^RCDPEDS(RC3611,+$O(^TMP("PRCA_EOB",$J,RC3611," "),-1)) ; get filing errors
"RTN","RCDPEWL2",64,0)
 . S ^TMP("PRCA_EOB",$J,+$O(^TMP("PRCA_EOB",$J,""),-1)+1)=RCDASH
"RTN","RCDPEWL2",65,0)
 . ;
"RTN","RCDPEWL2",66,0)
 S RC3611="" F  S RC3611=$O(^TMP("PRCA_EOB",$J,RC3611)) Q:RC3611=""!RCSTOP  D
"RTN","RCDPEWL2",67,0)
 . S RC1=1
"RTN","RCDPEWL2",68,0)
 . S Z0=0 F  S Z0=$O(^TMP("PRCA_EOB",$J,RC3611,Z0)) Q:'Z0  D  Q:RCSTOP
"RTN","RCDPEWL2",69,0)
 .. I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEWL2",70,0)
 .. I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEWL2",71,0)
 ... D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEWL2",72,0)
 ... D RHDR(RCSCR,RCDT,.RCPG)
"RTN","RCDPEWL2",73,0)
 .. I RC1 W !!,$G(^TMP("PRCA_EOB1",$J,RC3611,1)) S RC1=0
"RTN","RCDPEWL2",74,0)
 .. W !,$G(^TMP("PRCA_EOB",$J,RC3611,Z0))
"RTN","RCDPEWL2",75,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEWL2",76,0)
 ;
"RTN","RCDPEWL2",77,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEWL2",78,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEWL2",79,0)
 ;
"RTN","RCDPEWL2",80,0)
VPQ K ^TMP("PRCA_EOB",$J),^TMP("PRCA_EOB1",$J)
"RTN","RCDPEWL2",81,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",82,0)
 Q
"RTN","RCDPEWL2",83,0)
 ;
"RTN","RCDPEWL2",84,0)
TPJI ; Jump to Third Party Joint Inquiry for the claim
"RTN","RCDPEWL2",85,0)
 D FULL^VALM1
"RTN","RCDPEWL2",86,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G TPJIQ
"RTN","RCDPEWL2",87,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",88,0)
 D OPTION^IBJTLA ; IA 4121
"RTN","RCDPEWL2",89,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",90,0)
 ;
"RTN","RCDPEWL2",91,0)
TPJIQ S VALMBCK="R"
"RTN","RCDPEWL2",92,0)
 Q
"RTN","RCDPEWL2",93,0)
 ;
"RTN","RCDPEWL2",94,0)
FAP ; Jump to Full Account Profile
"RTN","RCDPEWL2",95,0)
 D FULL^VALM1
"RTN","RCDPEWL2",96,0)
 ;
"RTN","RCDPEWL2",97,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G FAPQ
"RTN","RCDPEWL2",98,0)
 ;
"RTN","RCDPEWL2",99,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",100,0)
 D EN^PRCAAPR("ALL"),RET K DTOUT
"RTN","RCDPEWL2",101,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",102,0)
 ;
"RTN","RCDPEWL2",103,0)
FAPQ S VALMBCK="R"
"RTN","RCDPEWL2",104,0)
 Q
"RTN","RCDPEWL2",105,0)
 ;
"RTN","RCDPEWL2",106,0)
RELHOLD ; Jump to Release Hold function
"RTN","RCDPEWL2",107,0)
 N DIR,X,Y,RCDA,RCSCR
"RTN","RCDPEWL2",108,0)
 D FULL^VALM1
"RTN","RCDPEWL2",109,0)
 ;
"RTN","RCDPEWL2",110,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G RELHQ
"RTN","RCDPEWL2",111,0)
 ;
"RTN","RCDPEWL2",112,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",113,0)
 D ^IBRREL,RET ; IA = 306
"RTN","RCDPEWL2",114,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",115,0)
 ;
"RTN","RCDPEWL2",116,0)
RELHQ S VALMBCK="R"
"RTN","RCDPEWL2",117,0)
 Q
"RTN","RCDPEWL2",118,0)
 ;
"RTN","RCDPEWL2",119,0)
CMRPT ; Jump to claims matching report
"RTN","RCDPEWL2",120,0)
 N DIR,X,Y,RCIBY
"RTN","RCDPEWL2",121,0)
 D FULL^VALM1
"RTN","RCDPEWL2",122,0)
 ;
"RTN","RCDPEWL2",123,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G CMQ
"RTN","RCDPEWL2",124,0)
 ;
"RTN","RCDPEWL2",125,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",126,0)
 D ^RCDPRTP,RET
"RTN","RCDPEWL2",127,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",128,0)
 ;
"RTN","RCDPEWL2",129,0)
CMQ S VALMBCK="R"
"RTN","RCDPEWL2",130,0)
 Q
"RTN","RCDPEWL2",131,0)
 ;
"RTN","RCDPEWL2",132,0)
CHGMNT ; Jump to charge maintenance
"RTN","RCDPEWL2",133,0)
 N DIR,X,Y,RCSCR
"RTN","RCDPEWL2",134,0)
 D FULL^VALM1
"RTN","RCDPEWL2",135,0)
 ;
"RTN","RCDPEWL2",136,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G CHMQ
"RTN","RCDPEWL2",137,0)
 ;
"RTN","RCDPEWL2",138,0)
 I $D(^XUSEC("PRCA EDI LOCKBOX CHARGES",DUZ)) D
"RTN","RCDPEWL2",139,0)
 . M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",140,0)
 . D EN1AR^IBECEA ; IA 4047
"RTN","RCDPEWL2",141,0)
 . D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",142,0)
 E  D
"RTN","RCDPEWL2",143,0)
 . S DIR(0)="EA",DIR("A",1)="YOU DO NOT HAVE THE KEY NEEDED TO ACCESS THIS OPTION.",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",144,0)
 ;
"RTN","RCDPEWL2",145,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",146,0)
CHMQ Q
"RTN","RCDPEWL2",147,0)
 ;
"RTN","RCDPEWL2",148,0)
LSTHLD ; Jump to list current/on hold charges
"RTN","RCDPEWL2",149,0)
 N DIR,X,Y,RCIBY
"RTN","RCDPEWL2",150,0)
 D FULL^VALM1
"RTN","RCDPEWL2",151,0)
 ;
"RTN","RCDPEWL2",152,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G LHQ
"RTN","RCDPEWL2",153,0)
 ;
"RTN","RCDPEWL2",154,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",155,0)
 D MAIN^IBOHPT1,RET ; IA 4048
"RTN","RCDPEWL2",156,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",157,0)
 ;
"RTN","RCDPEWL2",158,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",159,0)
LHQ Q
"RTN","RCDPEWL2",160,0)
 ;
"RTN","RCDPEWL2",161,0)
REEST ; Jump to re-establish bill
"RTN","RCDPEWL2",162,0)
 N PRC
"RTN","RCDPEWL2",163,0)
 D FULL^VALM1
"RTN","RCDPEWL2",164,0)
 ;
"RTN","RCDPEWL2",165,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G REESTQ
"RTN","RCDPEWL2",166,0)
 ;
"RTN","RCDPEWL2",167,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",168,0)
 D ^PRCAWREA K DTOUT
"RTN","RCDPEWL2",169,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",170,0)
 D RET
"RTN","RCDPEWL2",171,0)
 ;
"RTN","RCDPEWL2",172,0)
REESTQ S VALMBCK="R"
"RTN","RCDPEWL2",173,0)
 Q
"RTN","RCDPEWL2",174,0)
 ;
"RTN","RCDPEWL2",175,0)
BILLCOM ; Jump to bill comment log
"RTN","RCDPEWL2",176,0)
 D FULL^VALM1
"RTN","RCDPEWL2",177,0)
 ;
"RTN","RCDPEWL2",178,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G BILLCOMQ
"RTN","RCDPEWL2",179,0)
 ;
"RTN","RCDPEWL2",180,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",181,0)
 D ^PRCACM K DTOUT
"RTN","RCDPEWL2",182,0)
 D RET
"RTN","RCDPEWL2",183,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",184,0)
 ;
"RTN","RCDPEWL2",185,0)
BILLCOMQ S VALMBCK="R"
"RTN","RCDPEWL2",186,0)
 Q
"RTN","RCDPEWL2",187,0)
 ;
"RTN","RCDPEWL2",188,0)
ASK(RCSTOP) ;
"RTN","RCDPEWL2",189,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEWL2",190,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEWL2",191,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEWL2",192,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEWL2",193,0)
 Q
"RTN","RCDPEWL2",194,0)
 ;
"RTN","RCDPEWL2",195,0)
RHDR(RCSCR,RCDT,RCPG) ;Prints EOB detail report heading
"RTN","RCDPEWL2",196,0)
 N Z
"RTN","RCDPEWL2",197,0)
 S Z=$G(^RCY(344.4,RCSCR,0))
"RTN","RCDPEWL2",198,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEWL2",199,0)
 S RCPG=RCPG+1
"RTN","RCDPEWL2",200,0)
 W !,?15,"EDI LOCKBOX EEOB DETAIL FROM WORKLIST",?55,$$FMTE^XLFDT(RCDT,2),?70,"Page: ",RCPG
"RTN","RCDPEWL2",201,0)
 W !!,$E(" ERA NUMBER: "_RCSCR_$J("",25),1,25)_$E("ERA TRACE #: "_$P(Z,U,2)_$J("",30),1,30)_"ERA DATE: "_$$FMTE^XLFDT($P(Z,U,4)),!,"INS COMPANY: "_$P(Z,U,6)_"/"_$P(Z,U,3)
"RTN","RCDPEWL2",202,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEWL2",203,0)
 Q
"RTN","RCDPEWL2",204,0)
 ;
"RTN","RCDPEWL2",205,0)
RET ; Pause before returning to list
"RTN","RCDPEWL2",206,0)
 N DIR,X,Y
"RTN","RCDPEWL2",207,0)
 S DIR(0)="EA",DIR("A")="RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL2",208,0)
 Q
"RTN","RCDPEWL2",209,0)
 ;
"RTN","RCDPEWL2",210,0)
NOWAY ; Msg for unidentified bill
"RTN","RCDPEWL2",211,0)
 N DIR,X,Y
"RTN","RCDPEWL2",212,0)
 S DIR(0)="EA",DIR("A",1)="THIS BILL IS NOT IDENTIFIED IN YOUR A/R",DIR("A")="THIS FUNCTION IS NOT AVAILABLE ... RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",213,0)
 Q
"RTN","RCDPEWL2",214,0)
 ;
"RTN","RCDPEWL2",215,0)
NOWAY1 ; Msg for ERA level Adjustment 
"RTN","RCDPEWL2",216,0)
 N DIR,X,Y
"RTN","RCDPEWL2",217,0)
 S DIR(0)="EA",DIR("A",1)="THIS IS AN ERA LEVEL ADJUSTMENT - NO DATA EXISTS FOR IT IN YOUR AR",DIR("A")="PRESS ENTER TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL2",218,0)
 Q
"RTN","RCDPEWL2",219,0)
 ;
"RTN","RCDPEWL2",220,0)
SET1(RCIBY,RCDA,RCDA1,RC3444,RCREF) ; Set up variables for receipt/ERA
"RTN","RCDPEWL2",221,0)
 S RCDA1=+RCIBY("IBEOB"),RCDA=+$P(RCIBY("IBEOB"),U,2),RC3444=+$P(RCIBY("IBEOB"),U,3),RCREF=+$P(RCIBY("IBEOB"),U,4)
"RTN","RCDPEWL2",222,0)
 Q
"RTN","RCDPEWL2",223,0)
 ;
"RTN","RCDPEWL2",224,0)
CHKFILE ; If the user leaves the split line screen without filing - double check
"RTN","RCDPEWL2",225,0)
 ; that they didn't want to file it.
"RTN","RCDPEWL2",226,0)
 N DIR,X,Y
"RTN","RCDPEWL2",227,0)
 D FULL^VALM1 W !!
"RTN","RCDPEWL2",228,0)
 I $G(^TMP("RCDPE_EOB_SPLIT_OK",$J)),$O(RCSPLIT(0)) D
"RTN","RCDPEWL2",229,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="YOU HAVE NOT FILED THESE CHANGES",DIR("A")="DO YOU WANT TO FILE THEM BEFORE YOU EXIT?: " D ^DIR K DIR
"RTN","RCDPEWL2",230,0)
 . I Y=1 D FILESP^RCDPEWL8
"RTN","RCDPEWL2",231,0)
 K ^TMP($J,"RCDPE_SPLIT_FILE")
"RTN","RCDPEWL2",232,0)
 Q
"RTN","RCDPEWL2",233,0)
 ;
"RTN","RCDPEWL2",234,0)
EDITSP ; Action that edits the split lines
"RTN","RCDPEWL2",235,0)
 ; RCLINE,RCSCR must already exist
"RTN","RCDPEWL2",236,0)
 N DA,RCEDIT,RCDONE,RCDEF,RCSAVE,RCSAVE1
"RTN","RCDPEWL2",237,0)
 D FULL^VALM1
"RTN","RCDPEWL2",238,0)
 ;
"RTN","RCDPEWL2",239,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G EDITQ
"RTN","RCDPEWL2",240,0)
 ;
"RTN","RCDPEWL2",241,0)
 D SEL(.RCEDIT)
"RTN","RCDPEWL2",242,0)
 G:'RCEDIT EDITQ
"RTN","RCDPEWL2",243,0)
 S RCDONE=0
"RTN","RCDPEWL2",244,0)
 M RCSAVE=RCSPLIT,RCSAVE1=RCDIR S RCDEF=$G(RCSPLIT(RCEDIT)),RCSPLIT=RCEDIT
"RTN","RCDPEWL2",245,0)
 D EDIT^RCDPEWL3(RCSCR,RCLINE,.RCDIR,.RCSPLIT,RCDEF,.RCDONE)
"RTN","RCDPEWL2",246,0)
 I '$D(RCSPLIT(RCSAVE)) K RCSPLIT M RCSPLIT=RCSAVE K RCDIR M RCDIR=RCSAVE1
"RTN","RCDPEWL2",247,0)
 D INIT^RCDPEWL3
"RTN","RCDPEWL2",248,0)
EDITQ S VALMBCK="R"
"RTN","RCDPEWL2",249,0)
 Q
"RTN","RCDPEWL2",250,0)
 ;
"RTN","RCDPEWL2",251,0)
PREOB ; Print/View EOB detail
"RTN","RCDPEWL2",252,0)
 N RCDA,RCDAZ,Z,Z0
"RTN","RCDPEWL2",253,0)
 D FULL^VALM1
"RTN","RCDPEWL2",254,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL2",255,0)
 S RCDA=+$O(RCDA(0)),RCDA=$G(RCDA(RCDA))
"RTN","RCDPEWL2",256,0)
 I RCDA="" G PREOBQ
"RTN","RCDPEWL2",257,0)
 S RCDA=$P($G(^RCY(344.49,RCSCR,1,+RCDA,0)),U,9)
"RTN","RCDPEWL2",258,0)
 F RCDAZ=1:1:$L(RCDA,",") S RCDAZ(RCDAZ)=$P(RCDA,",",RCDAZ)
"RTN","RCDPEWL2",259,0)
 S Z=0 F  S Z=$O(RCDAZ(Z)) Q:'Z  D
"RTN","RCDPEWL2",260,0)
 . ;
"RTN","RCDPEWL2",261,0)
 . S Z0=RCDAZ(Z)
"RTN","RCDPEWL2",262,0)
 . I $E(Z0,1,3)="ADJ" D  Q
"RTN","RCDPEWL2",263,0)
 .. I $G(^RCY(344.4,RCSCR,2,+$P(Z0,"ADJ",2),0))'="" S RCDAZ(Z)="ADJ^"_+$P(Z0,"ADJ",2)
"RTN","RCDPEWL2",264,0)
 . ;
"RTN","RCDPEWL2",265,0)
 . S Z0=$G(^RCY(344.4,RCSCR,1,+Z0,0))
"RTN","RCDPEWL2",266,0)
 . S RCDAZ(Z)=+Z0_U_$S($P(Z0,U,2):$P(Z0,U,2),1:-1) Q
"RTN","RCDPEWL2",267,0)
 ;
"RTN","RCDPEWL2",268,0)
 D VP(RCSCR,.RCDAZ)
"RTN","RCDPEWL2",269,0)
 ;
"RTN","RCDPEWL2",270,0)
PREOBQ S VALMBCK="R"
"RTN","RCDPEWL2",271,0)
 Q
"RTN","RCDPEWL2",272,0)
 ;
"RTN","RCDPEWL2",273,0)
RESEARCH ; Invoke the research menu
"RTN","RCDPEWL2",274,0)
 ;
"RTN","RCDPEWL2",275,0)
 K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEWL2",276,0)
 S ^TMP($J,"RC_VALMBG")=$G(VALMBG)
"RTN","RCDPEWL2",277,0)
 D FULL^VALM1
"RTN","RCDPEWL2",278,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G RQ
"RTN","RCDPEWL2",279,0)
 ;
"RTN","RCDPEWL2",280,0)
 D EN^VALM("RCDPE EOB RESEARCH")
"RTN","RCDPEWL2",281,0)
 ;
"RTN","RCDPEWL2",282,0)
RQ K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEWL2",283,0)
 Q
"RTN","RCDPEWL2",284,0)
 ;
"RTN","RCDPEWL2",285,0)
SEL(RCEDIT) ;
"RTN","RCDPEWL2",286,0)
 N VALMY
"RTN","RCDPEWL2",287,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL2",288,0)
 S RCEDIT=+$O(VALMY(0))
"RTN","RCDPEWL2",289,0)
 Q
"RTN","RCDPEWL2",290,0)
 ;
"RTN","RCDPEWL2",291,0)
EXIT ; Exits back to ERA menu actions from research
"RTN","RCDPEWL2",292,0)
 S VALMBCK="Q"
"RTN","RCDPEWL2",293,0)
 Q
"RTN","RCDPEWL2",294,0)
 ;
"RTN","RCDPEWL2",295,0)
WL(RCRCPT) ; Entrypoint to the ERA Worklist from Receipt Processing
"RTN","RCDPEWL2",296,0)
 ;RCRCPT = ien of entry in file 344
"RTN","RCDPEWL2",297,0)
 N DIR,X,Y,Z
"RTN","RCDPEWL2",298,0)
 D FULL^VALM1
"RTN","RCDPEWL2",299,0)
 S Z=+$O(^RCY(344.4,"AREC",RCRCPT,0))
"RTN","RCDPEWL2",300,0)
 I 'Z D  G WLQ
"RTN","RCDPEWL2",301,0)
 . S DIR("A")="THIS RECEIPT IS NOT ASSOCIATED WITH AN ERA RECORD - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL2",302,0)
 ;
"RTN","RCDPEWL2",303,0)
 I '$D(^RCY(344.49,Z,0)) D  G WLQ
"RTN","RCDPEWL2",304,0)
 . S DIR("A")="NO ERA WORKLIST SCRATCHPAD EXISTS FOR THIS ERA - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL2",305,0)
 ;
"RTN","RCDPEWL2",306,0)
 D DISP^RCDPEWL(Z,2)
"RTN","RCDPEWL2",307,0)
 ;
"RTN","RCDPEWL2",308,0)
WLQ S VALMBCK="R"
"RTN","RCDPEWL2",309,0)
 Q
"RTN","RCDPEWL2",310,0)
 ;
"RTN","RCDPEWL2",311,0)
NOTAV ; Display not available msg
"RTN","RCDPEWL2",312,0)
 N DIR,X,Y
"RTN","RCDPEWL2",313,0)
 ;
"RTN","RCDPEWL2",314,0)
 S DIR(0)="EA",DIR("A")="THIS ACTION NOT CURRENTLY AVAILABLE - PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",315,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",316,0)
 Q
"RTN","RCDPEWL2",317,0)
 ;
"RTN","RCDPEWL4")
0^16^B48723310
"RTN","RCDPEWL4",1,0)
RCDPEWL4 ;ALB/TMK - ELECTRONIC EOB WORKLIST ACTIONS ;24-FEB-03
"RTN","RCDPEWL4",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL4",4,0)
 ; RCSCR variable must be defined for this routine
"RTN","RCDPEWL4",5,0)
 Q
"RTN","RCDPEWL4",6,0)
 ;
"RTN","RCDPEWL4",7,0)
DISTADJ(RCFR,RCTO,RCAMT,RCCOM) ; Action that distributes an adjustment amount
"RTN","RCDPEWL4",8,0)
 ; against another line item's payment
"RTN","RCDPEWL4",9,0)
 ; Assumes RCSCR = ien of the entry in file 344.49
"RTN","RCDPEWL4",10,0)
 ; RCFR = ien of entry in 344.491 that has a negative net
"RTN","RCDPEWL4",11,0)
 ; RCTO = ien of entry in 344.491 that will be decremented
"RTN","RCDPEWL4",12,0)
 ; RCAMT = the amount being adjusted (positive #)
"RTN","RCDPEWL4",13,0)
 ; RCCOM = the comment to place on the decrease adjustment
"RTN","RCDPEWL4",14,0)
 ;
"RTN","RCDPEWL4",15,0)
 N RCFRX,RCREF,RCFR0,RCFR1,RCFR10,RCTO0,RCTO1,RCTO10,RCY,DIK,DA,DR,DIC,X,Y,DLAYGO,DD,DO,DIE,DIR
"RTN","RCDPEWL4",16,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL Q
"RTN","RCDPEWL4",17,0)
 S RCFR0=$G(^RCY(344.49,RCSCR,1,RCFR,0)),RCTO0=$G(^RCY(344.49,RCSCR,1,RCTO,0)),RCFRX=+$O(^RCY(344.49,RCSCR,1,"B",RCFR0\1,0)),RCFRX=$G(^RCY(344.49,RCSCR,1,RCFRX,0))
"RTN","RCDPEWL4",18,0)
 S RCREF=$P($P(RCFRX,U,2),"**ADJ",2),RCREF=$S(RCREF="":"",RCREF=0:$P(RCFRX,U,9),1:$P($G(^RCY(344.4,RCSCR,2,+RCREF,0)),U))
"RTN","RCDPEWL4",19,0)
 S RCFR1=+$O(^RCY(344.49,RCSCR,1,"B",RCFR0\1,0)),RCTO1=+$O(^RCY(344.49,RCSCR,1,"B",RCTO0\1,0))
"RTN","RCDPEWL4",20,0)
 S RCFR10=$G(^RCY(344.49,RCSCR,1,RCFR1,0)),RCTO10=$G(^RCY(344.49,RCSCR,1,RCTO1,0))
"RTN","RCDPEWL4",21,0)
 S RCFR0=$G(^RCY(344.49,RCSCR,1,RCFR,0)),RCTO0=$G(^RCY(344.49,RCSCR,1,RCTO,0))
"RTN","RCDPEWL4",22,0)
 S DA(2)=RCSCR,DA(1)=RCFR
"RTN","RCDPEWL4",23,0)
 S DIC("DR")=".02////1;.03////"_RCAMT_";.04////"_$S($P(RCTO0,U,2)'="":$P(RCTO0,U,2),RCREF'="":RCREF,1:"UNKNOWN")
"RTN","RCDPEWL4",24,0)
 S DIC("DR")=DIC("DR")_";.05////0;.06////0;.09////RETRACTED FUNDS DEDUCTED FROM OTHER PAYMENT ON THIS ERA",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL4",25,0)
 S DLAYGO=344.4911,DIC(0)="L",X=+$O(^RCY(344.49,RCSCR,1,RCFR,1,"B",""),-1)+1
"RTN","RCDPEWL4",26,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","RCDPEWL4",27,0)
 S RCY=+Y
"RTN","RCDPEWL4",28,0)
 I RCY'>0 D  Q
"RTN","RCDPEWL4",29,0)
 . S DIR(0)="EA",DIR("A",1)="PROBLEM ADDING ADJUSTMENT - NO DISTRIBUTION PERFORMED",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL4",30,0)
 ;
"RTN","RCDPEWL4",31,0)
 S DA(2)=RCSCR,DA(1)=RCTO
"RTN","RCDPEWL4",32,0)
 S DIC("DR")=".02////0;.03////"_$J(-RCAMT,"",2)
"RTN","RCDPEWL4",33,0)
 S DIC("DR")=DIC("DR")_";.04////"_$S($P(RCFR0,U,2)'="":$P(RCFR0,U,2),RCREF'="":RCREF,1:"UNKNOWN")_";.05////"_$S($P($G(^RCY(344.49,RCSCR,1,RCTO1,0)),U,2)'["**ADJ":"1;.08////0",1:0)_";.06////0"_$S(RCCOM'="":";.09////"_RCCOM,1:"")
"RTN","RCDPEWL4",34,0)
 S DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL4",35,0)
 S DLAYGO=344.4911,DIC(0)="L",X=+$O(^RCY(344.49,RCSCR,1,RCTO,1,"B",""),-1)+1
"RTN","RCDPEWL4",36,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","RCDPEWL4",37,0)
 S RCY=+Y
"RTN","RCDPEWL4",38,0)
 ;
"RTN","RCDPEWL4",39,0)
 I RCY'>0 D  Q
"RTN","RCDPEWL4",40,0)
 . N DA
"RTN","RCDPEWL4",41,0)
 . S DA(2)=RCSCR,DA(1)=RCFR,DA=RCY,DIK="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1," D ^DIK
"RTN","RCDPEWL4",42,0)
 . S DIR(0)="EA",DIR("A",1)="PROBLEM ADDING ADJUSTMENT - NO DISTRIBUTION PERFORMED",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL4",43,0)
 ;
"RTN","RCDPEWL4",44,0)
 S DA(1)=RCSCR,DA=RCFR,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCFR0,U,6)+RCAMT,"",2)_";.08////"_$J($P(RCFR0,U,8)+RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",45,0)
 S DA=RCFR1,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCFR10,U,6)+RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",46,0)
 S DA(1)=RCSCR,DA=RCTO,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCTO0,U,6)-RCAMT,"",2)_";.03////"_$J($P(RCTO0,U,3)-RCAMT,"",2)_";.08////"_$J($P(RCTO0,U,8)-RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",47,0)
 S DA(1)=RCSCR,DA=RCTO1,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCTO10,U,6)-RCAMT,"",2)_";.03////"_$J($P(RCTO10,U,3)-RCAMT,"",2)_";.08////"_$J($P(RCTO10,U,8)-RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",48,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL4",49,0)
 Q
"RTN","RCDPEWL4",50,0)
 ;
"RTN","RCDPEWL4",51,0)
NEWREC ; Create a new receipt from scratch pad entry
"RTN","RCDPEWL4",52,0)
 N Z,Z0,RCOK,RCRECTDA,RCSTOP,DIR,X,Y,RECTDA,CT,DIE,DA,DR,RCER,RCPAYTY,RCHAC,RCDEP,DIC
"RTN","RCDPEWL4",53,0)
 D FULL^VALM1
"RTN","RCDPEWL4",54,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G NEWRECQ
"RTN","RCDPEWL4",55,0)
 S (RCSTOP,RCOK)=0,VALMBCK="R"
"RTN","RCDPEWL4",56,0)
 S RECTDA=$P($G(^RCY(344.49,RCSCR,0)),U,2)
"RTN","RCDPEWL4",57,0)
 I 'RECTDA S RECTDA=$P($G(^RCY(344.4,RCSCR,0)),U,8)
"RTN","RCDPEWL4",58,0)
 I RECTDA D  G NEWRECQ
"RTN","RCDPEWL4",59,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ERA ALREADY HAS A RECEIPT - "_$P($G(^RCY(344,+$P($G(^RCY(344.49,RCSCR,0)),U,2),0)),U)_" - NO RECEIPT CREATED",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL4",60,0)
 S DIR("A",1)="THIS ACTION WILL CREATE THE RECEIPT FOR THIS ERA.  ONCE THE RECEIPT IS",DIR("A",2)=" CREATED HERE, NO MORE AUTOMATIC ADJUSTMENTS MAY BE MADE FOR THIS ERA.",DIR("A",3)=" "
"RTN","RCDPEWL4",61,0)
 S DIR("A")="ARE YOU SURE YOU ARE READY TO CREATE THIS RECEIPT?: ",DIR("B")="NO",DIR(0)="YA"
"RTN","RCDPEWL4",62,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL4",63,0)
 I Y'=1 S DIR(0)="EA",DIR("A")="NO RECEIPT CREATED - PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",64,0)
 I $$HASADJ^RCDPEWL8(RCSCR,.RCOK) D  G NEWRECQ
"RTN","RCDPEWL4",65,0)
 . S DIR(0)="EA",DIR("A",1)="AT LEAST ONE LINE ITEM WAS FOUND WITH A NEGATIVE PAYMENT AMOUNT",DIR("A")="NO RECEIPT CAN BE CREATED - PRESS RETURN TO CONTINUE " D ^DIR K DIR S RCSTOP=1
"RTN","RCDPEWL4",66,0)
 I 'RCOK S DIR(0)="EA",DIR("A")="NO RECEIPT CAN BE CREATED - NO POSTABLE LINE ITEMS WERE FOUND" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",67,0)
 ;
"RTN","RCDPEWL4",68,0)
 S RCHAC=$$HACERA^RCDPEU(RCSCR)
"RTN","RCDPEWL4",69,0)
 S RCPAYTY=$S(RCHAC:8,$P($G(^RCY(344.4,+RCSCR,0)),U,13)="":14,1:4)
"RTN","RCDPEWL4",70,0)
 S RCDEP=""
"RTN","RCDPEWL4",71,0)
 I RCPAYTY=4 D
"RTN","RCDPEWL4",72,0)
 . N RCOK1
"RTN","RCDPEWL4",73,0)
 . F  D  Q:RCOK1
"RTN","RCDPEWL4",74,0)
 .. S RCOK1=1
"RTN","RCDPEWL4",75,0)
 .. S DIC="^RCY(344.1,",DIC("S")="I $P(^(0),U,12)=1",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL4",76,0)
 .. Q:Y'>0
"RTN","RCDPEWL4",77,0)
 .. S RCDEP=+Y
"RTN","RCDPEWL4",78,0)
 .. I RCDEP,$$TOOOLD^RCDPEWLA(RCDEP) S RCOK1=0,RCDEP=""
"RTN","RCDPEWL4",79,0)
 S RECTDA=$$BLDRCPT^RCDPUREC(DT,+RCDEP_$S(RCPAYTY=4:"ERACHK",1:""),+$O(^RC(341.1,"AC",+RCPAYTY,0))) ; Note:ERA with paper check is type 4, but receipt needs to start with an 'E'
"RTN","RCDPEWL4",80,0)
 I 'RECTDA W ! S DIR(0)="EA",DIR("A",1)="A PROBLEM WAS ENCOUNTERED ADDING THE RECEIPT - NO RECEIPT ADDED",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",81,0)
 ;
"RTN","RCDPEWL4",82,0)
 D RCPTDET^RCDPEM(RCSCR,RECTDA,.RCER)
"RTN","RCDPEWL4",83,0)
 ;
"RTN","RCDPEWL4",84,0)
 S DIE="^RCY(344.49,",DA=RCSCR,DR=".02////"_RECTDA D ^DIE
"RTN","RCDPEWL4",85,0)
 S DIE="^RCY(344.4,",DA=RCSCR,DR=".08////"_RECTDA D ^DIE
"RTN","RCDPEWL4",86,0)
 S Z=+$O(^RCY(344.31,"AERA",RCSCR,0))
"RTN","RCDPEWL4",87,0)
 S DIE="^RCY(344,",DA=RECTDA,DR=".18////"_RCSCR_$S(Z:";.17////"_Z,1:"")_$S(RCPAYTY=4:";.06////"_RCDEP,1:"")_$S($P($G(^RCY(344.31,Z,0)),U,15)'="":";.16////"_$P(^RCY(344.31,Z,0),U,15),1:"") D ^DIE
"RTN","RCDPEWL4",88,0)
 ;
"RTN","RCDPEWL4",89,0)
 I $O(RCER(0)) D
"RTN","RCDPEWL4",90,0)
 . S CT=1,DIR(0)="EA",DIR("A",1)="THE FOLLOWING PROBLEMS OCCURRED WHILE ADDING THE RECEIPT: "
"RTN","RCDPEWL4",91,0)
 . S Z=0 F  S Z=$O(RCER(Z)) Q:'Z  S CT=CT+1,DIR("A",CT)=RCER(Z)
"RTN","RCDPEWL4",92,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL4",93,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL4",94,0)
 ;
"RTN","RCDPEWL4",95,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO GO TO RECEIPT PROCESSING NOW? ",DIR("A",1)=" ",DIR("A",2)="RECEIPT "_$P($G(^RCY(344,+RECTDA,0)),U)_" HAS BEEN CREATED FOR THIS ERA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL4",96,0)
 I Y=1 S RCRECTDA=RECTDA D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPEWL4",97,0)
 S RCSCR=0
"RTN","RCDPEWL4",98,0)
 S VALMBCK="Q"
"RTN","RCDPEWL4",99,0)
 ;
"RTN","RCDPEWL4",100,0)
NEWRECQ Q
"RTN","RCDPEWL4",101,0)
 ;
"RTN","RCDPEWL4",102,0)
VRECPT ; Preview receipt lines
"RTN","RCDPEWL4",103,0)
 N RCZ,RCOK,Z,Z0,DIR,X,Y
"RTN","RCDPEWL4",104,0)
 D FULL^VALM1
"RTN","RCDPEWL4",105,0)
 S VALMBCK="R"
"RTN","RCDPEWL4",106,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL Q
"RTN","RCDPEWL4",107,0)
 I $O(^RCY(344.49,RCSCR,3,0)) D  Q:'RCOK
"RTN","RCDPEWL4",108,0)
 . S RCOK=1
"RTN","RCDPEWL4",109,0)
 . S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,3,Z)) Q:'Z  I '$P($G(^(Z,0)),U,3) S RCOK=0 Q
"RTN","RCDPEWL4",110,0)
 . I 'RCOK S DIR(0)="EA",DIR("A",1)="A RECEIPT CANNOT BE PREVIEWED UNTIL ALL BATCHES FOR THIS ERA ARE MARKED AS",DIR("A",2)="'READY TO POST'",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL4",111,0)
 ;
"RTN","RCDPEWL4",112,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  I $P(Z,".",2) S Z0=$G(^(Z,0)) I $P(Z0,U,6)<0 S RCZ($P(Z0,U))=$P(Z0,U,2)_U_$P(Z0,U,6)
"RTN","RCDPEWL4",113,0)
 I $O(RCZ(""))'="" D
"RTN","RCDPEWL4",114,0)
 . W !,"THE FOLLOWING LINES HAVE A NET PAYMENT LESS THAN 0.  THESE LINES MUST HAVE",!,"THIS NEGATIVE AMOUNT DISTRIBUTED TO OTHER LINE(S) IN THE ERA BEFORE A",!,"RECEIPT CAN BE CREATED."
"RTN","RCDPEWL4",115,0)
 . S Z="" F  S Z=$O(RCZ(Z)) Q:Z=""  W !,$J("",5)_$J(Z,10)_"  "_$E($P(RCZ(Z),U)_$J("",15),1,15)_"  "_$J(+$P(RCZ(Z),U,2),"",2)
"RTN","RCDPEWL4",116,0)
 . W !
"RTN","RCDPEWL4",117,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPEWL4",118,0)
 ;
"RTN","RCDPEWL4",119,0)
 D EN^VALM("RCDPE EOB RECEIPT PREVIEW")
"RTN","RCDPEWL4",120,0)
 S VALMBCK=$S('$G(RCSCR):"Q",1:"R")
"RTN","RCDPEWL4",121,0)
 Q
"RTN","RCDPEWL4",122,0)
 ;
"RTN","RCDPEWL5")
0^7^B56075970
"RTN","RCDPEWL5",1,0)
RCDPEWL5 ;ALB/TMK - ELECTRONIC EOB WORKLIST ACTIONS ;24-FEB-03
"RTN","RCDPEWL5",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL5",4,0)
 Q
"RTN","RCDPEWL5",5,0)
 ;
"RTN","RCDPEWL5",6,0)
INIT ; Build receipt preview
"RTN","RCDPEWL5",7,0)
 N X,Z,Z1,Z10,Z0,Z2,RCZ
"RTN","RCDPEWL5",8,0)
 K ^TMP("RCDPE_EOB_PREVIEW",$J)
"RTN","RCDPEWL5",9,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEWL5",10,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL5",11,0)
 . I $P(Z0,U)\1=+Z0 S Z2=$P(Z0,U,2)
"RTN","RCDPEWL5",12,0)
 . I $P($P(Z0,U),".",2) D
"RTN","RCDPEWL5",13,0)
 .. S:$P(Z0,U,2)="" $P(Z0,U,2)=Z2
"RTN","RCDPEWL5",14,0)
 .. S RCZ=$S(+$P(Z0,U,6)=0:0,+$P(Z0,U,6)<0:-1,$P(Z0,U,7):1,1:2)
"RTN","RCDPEWL5",15,0)
 .. S RCZ(RCZ,Z)=Z0
"RTN","RCDPEWL5",16,0)
 .. S Z1=0 F  S Z1=$O(^RCY(344.49,RCSCR,1,Z,1,Z1)) Q:'Z1  S Z10=$G(^(Z1,0)) D
"RTN","RCDPEWL5",17,0)
 ... I $P(Z10,U,5)=1 S RCZ(RCZ,Z,"ADJ",Z1)="Dec adj $"_$J(0-$P(Z10,U,3),"",2)_" pending - ",RCZ(RCZ,Z,"ADJ",Z1,1)=$J("",4)_$P(Z10,U,9)
"RTN","RCDPEWL5",18,0)
 F RCZ=1,2,0,-1 D
"RTN","RCDPEWL5",19,0)
 . Q:'$D(RCZ(RCZ))
"RTN","RCDPEWL5",20,0)
 . I RCZ=1 D SET("PAYMENTS (LINES FOR RECEIPT):")
"RTN","RCDPEWL5",21,0)
 . I RCZ=0,VALMCNT>0 D SET(" ") D SET("ZERO DOLLAR PAYMENTS:")
"RTN","RCDPEWL5",22,0)
 . I RCZ=-1,VALMCNT>0 D SET(" ") D SET("LINES WITH NEGATIVE BALANCES STILL NEEDING TO BE DISTRIBUTED:")
"RTN","RCDPEWL5",23,0)
 . S Z=0 F  S Z=$O(RCZ(RCZ,Z)) Q:'Z  S Z0=RCZ(RCZ,Z) D
"RTN","RCDPEWL5",24,0)
 .. S X=""
"RTN","RCDPEWL5",25,0)
 .. S X=$$SETFLD^VALM1($P(Z0,U),X,"LINE #")
"RTN","RCDPEWL5",26,0)
 .. S X=$$SETFLD^VALM1($S($P(Z0,U,7):$$BN1^PRCAFN($P(Z0,U,7)),1:$S(RCZ=0:"",1:"[SUSPENSE]")_$S($P(Z0,U,2)["**ADJ"&'$P($P(Z0,U,2),"ADJ",2):"TOTALS MISMATCH ADJ",1:$P(Z0,U,2))),X,"ACCOUNT")
"RTN","RCDPEWL5",27,0)
 .. S X=$$SETFLD^VALM1($J(+$P(Z0,U,6),"",2),X,"AMOUNT")
"RTN","RCDPEWL5",28,0)
 .. D SET(X)
"RTN","RCDPEWL5",29,0)
 .. S Z1=0 F  S Z1=$O(RCZ(RCZ,Z,"ADJ",Z1)) Q:'Z1  D SET($J("",12)_$G(RCZ(RCZ,Z,"ADJ",Z1))) S Z2=0 F  S Z2=$O(RCZ(RCZ,Z,"ADJ",Z1,Z2)) Q:'Z2  D SET($J("",12)_$G(RCZ(RCZ,Z,"ADJ",Z1,Z2)))
"RTN","RCDPEWL5",30,0)
 Q
"RTN","RCDPEWL5",31,0)
 ;
"RTN","RCDPEWL5",32,0)
SET(X) ;
"RTN","RCDPEWL5",33,0)
 S VALMCNT=VALMCNT+1
"RTN","RCDPEWL5",34,0)
 S ^TMP("RCDPE_EOB_PREVIEW",$J,VALMCNT,0)=X
"RTN","RCDPEWL5",35,0)
 Q
"RTN","RCDPEWL5",36,0)
 ;
"RTN","RCDPEWL5",37,0)
HDR ;
"RTN","RCDPEWL5",38,0)
 D HDR^RCDPEWL
"RTN","RCDPEWL5",39,0)
 Q
"RTN","RCDPEWL5",40,0)
 ;
"RTN","RCDPEWL5",41,0)
FNL ;
"RTN","RCDPEWL5",42,0)
 K ^TMP("RCDPE_EOB_PREVIEW",$J)
"RTN","RCDPEWL5",43,0)
 Q
"RTN","RCDPEWL5",44,0)
 ;
"RTN","RCDPEWL5",45,0)
RCOMM ; Allow entry of receipt comment to be moved to line on receipt
"RTN","RCDPEWL5",46,0)
 N RCEDIT
"RTN","RCDPEWL5",47,0)
 D FULL^VALM1
"RTN","RCDPEWL5",48,0)
 ;
"RTN","RCDPEWL5",49,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G RCOMMQ
"RTN","RCDPEWL5",50,0)
 ;
"RTN","RCDPEWL5",51,0)
 D SEL^RCDPEWL2(.RCEDIT)
"RTN","RCDPEWL5",52,0)
 G:'RCEDIT RCOMMQ
"RTN","RCDPEWL5",53,0)
 ;
"RTN","RCDPEWL5",54,0)
RCOMMQ S VALMBCK="R"
"RTN","RCDPEWL5",55,0)
 Q
"RTN","RCDPEWL5",56,0)
 ;
"RTN","RCDPEWL5",57,0)
SUSPERA ; Option entrypoint to select an ERA to be posted to suspense
"RTN","RCDPEWL5",58,0)
 N DIC,X,Y,RCERA,RCSCR,DTOUT,DUOUT,DIR
"RTN","RCDPEWL5",59,0)
 S DIC(0)="AEMQ",DIC="^RCY(344.4,",DIC("S")="I '$P(^(0),U,8),'$G(^(20))"
"RTN","RCDPEWL5",60,0)
 D ^DIC K DIC
"RTN","RCDPEWL5",61,0)
 I Y'>0 Q
"RTN","RCDPEWL5",62,0)
 S RCERA=+Y
"RTN","RCDPEWL5",63,0)
 S DIR(0)="YA",DIR("B")="YES",DIR("A")="DO YOU WANT TO PRINT/VIEW THE ERA FIRST?: " W ! D ^DIR K DIR
"RTN","RCDPEWL5",64,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RCDPEWL5",65,0)
 I Y=1 S RCSCR=RCERA D PRERA^RCDPEWL0
"RTN","RCDPEWL5",66,0)
 D SUSP(RCERA,0)
"RTN","RCDPEWL5",67,0)
 Q
"RTN","RCDPEWL5",68,0)
 ;
"RTN","RCDPEWL5",69,0)
SUSP(RCERA,LM) ; Function to send receipt to suspense for ERA
"RTN","RCDPEWL5",70,0)
 ; RCERA = ien of entry in file 344.4
"RTN","RCDPEWL5",71,0)
 ; LM = flag to indicate it was called from list manager protocol
"RTN","RCDPEWL5",72,0)
 ;    =  1 if true, 0 if false
"RTN","RCDPEWL5",73,0)
 N DIR,X,Y,RC0,RCCOM,RCER,RCPAYTY,RECTDA,RCTRANDA,DIE,DA,DR,Z,DTOUT,DUOUT
"RTN","RCDPEWL5",74,0)
 S RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEWL5",75,0)
 I $G(LM) D FULL^VALM1
"RTN","RCDPEWL5",76,0)
 I $$HACERA^RCDPEU(RCERA) D  G SUSPQ
"RTN","RCDPEWL5",77,0)
 . S DIR(0)="EA",DIR("A")="THIS IS NOT A VALID ACTION FOR AN ERA FROM HAC" W ! D ^DIR K DIR
"RTN","RCDPEWL5",78,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEWL5",79,0)
 I $P(RC0,U,5) D
"RTN","RCDPEWL5",80,0)
 . S DIR("A",1)="THIS WILL CREATE A RECEIPT THAT WILL MOVE THE FUNDS ($"_$J($P(RC0,U,5),"",2)_")",DIR("A",2)="FOR THIS ENTIRE ERA TO YOUR SUSPENSE ACCOUNT",Z=3
"RTN","RCDPEWL5",81,0)
 E  D
"RTN","RCDPEWL5",82,0)
 . S DIR("A",1)="THIS WILL CREATE AND POST A RECEIPT FOR $0.00 FOR THIS ERA",Z=2
"RTN","RCDPEWL5",83,0)
 S DIR("A",Z+1)=" ",DIR("A",Z+2)="***ALL POSTINGS TO A/R FOR ANY CLAIMS IN THIS ERA MUST BE DONE MANUALLY***",DIR("A",Z+3)=" "
"RTN","RCDPEWL5",84,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: "
"RTN","RCDPEWL5",85,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL5",86,0)
 I Y'=1 D NOACT G SUSPQ
"RTN","RCDPEWL5",87,0)
 S DIR("A",1)="ENTER A 1-60 CHARACTER COMMENT TO BE PLACED ON THE RECEIPT: ",DIR("A")=">: ",DIR(0)="FA^1:60",DIR("B")="REF ERA #:"_RCERA_"  FROM "_$E($P(RC0,U,6),1,20) W ! D ^DIR K DIR
"RTN","RCDPEWL5",88,0)
 I $D(DTOUT)!$D(DUOUT) D NOACT G SUSPQ
"RTN","RCDPEWL5",89,0)
 S RCCOM=Y
"RTN","RCDPEWL5",90,0)
 S RCPAYTY=$S($P(RC0,U,13)="":14,1:4)
"RTN","RCDPEWL5",91,0)
 S RECTDA=$$BLDRCPT^RCDPUREC(DT,"",+$O(^RC(341.1,"AC",+RCPAYTY,0)))
"RTN","RCDPEWL5",92,0)
 I 'RECTDA D  G SUSPQ
"RTN","RCDPEWL5",93,0)
 . S DIR(0)="EA",DIR("A",1)="A PROBLEM WAS ENCOUNTERED ADDING THE RECEIPT",DIR("A")="NO ACTION TAKEN - RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEWL5",94,0)
 ;
"RTN","RCDPEWL5",95,0)
 S RCTRANDA=$$ADDTRAN^RCDPURET(RECTDA)
"RTN","RCDPEWL5",96,0)
 S DR=".04////"_(+$P(RC0,U,5))_$S($P(RC0,U,13)'="":";.13////"_$P(RC0,U,13),1:"")_$S(RCCOM'="":";1.02////"_RCCOM,1:"")
"RTN","RCDPEWL5",97,0)
 S DA(1)=RECTDA,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEWL5",98,0)
 D ^DIE
"RTN","RCDPEWL5",99,0)
 ;
"RTN","RCDPEWL5",100,0)
 I $D(^RCY(344.49,RCERA,0)) S DIE="^RCY(344.49,",DA=RCERA,DR=".02////"_RECTDA D ^DIE
"RTN","RCDPEWL5",101,0)
 S DIE="^RCY(344.4,",DA=RCERA,DR=".08////"_RECTDA_";20.01///^S X=""NOW"";20.02////"_DUZ D ^DIE
"RTN","RCDPEWL5",102,0)
 S Z=+$O(^RCY(344.31,"AERA",RCERA,0))
"RTN","RCDPEWL5",103,0)
 S DIE="^RCY(344,",DA=RECTDA,DR=".18////"_RCERA_$S(Z:";.17////"_Z,1:"") D ^DIE
"RTN","RCDPEWL5",104,0)
 ;
"RTN","RCDPEWL5",105,0)
 D PROCESS^RCDPURE1(RECTDA,1)
"RTN","RCDPEWL5",106,0)
 I '$P(RC0,U,5) S DIE="^RCY(344.4,",DA=RCERA,DR=".09////3;.14////1" D ^DIE
"RTN","RCDPEWL5",107,0)
 S DIR(0)="E" W ! D ^DIR K DIR
"RTN","RCDPEWL5",108,0)
 ;
"RTN","RCDPEWL5",109,0)
SUSPQ I $G(LM) S VALMBCK="R"
"RTN","RCDPEWL5",110,0)
 Q
"RTN","RCDPEWL5",111,0)
 ;
"RTN","RCDPEWL5",112,0)
REVIEW ; Enter review information on worklist and turn review display on/off
"RTN","RCDPEWL5",113,0)
 ; Assumes RCSCR = ien of the entry in file 344.49
"RTN","RCDPEWL5",114,0)
 ;
"RTN","RCDPEWL5",115,0)
 N Z,RC,RCDA,RCZ,DIC,DA,DIE,DR,X,Y,DIR,REVCHG,RCUSPREF,RCLSTREV,RCREV
"RTN","RCDPEWL5",116,0)
 D FULL^VALM1
"RTN","RCDPEWL5",117,0)
 ;
"RTN","RCDPEWL5",118,0)
 S REVCHG=""
"RTN","RCDPEWL5",119,0)
 S DIR(0)="YA",RC=+$P($G(^TMP($J,"RC_SORTPARM")),U,2)
"RTN","RCDPEWL5",120,0)
 S DIR("A",1)="REVIEW DATA DISPLAY IS CURRENTLY TURNED "_$P("OFF^ON",U,RC+1),DIR("A")="DO YOU WANT TO TURN IT "_$P("ON^OFF",U,RC+1)_"?: ",DIR("B")=$S('RC:"YES",1:"NO") W ! D ^DIR K DIR
"RTN","RCDPEWL5",121,0)
 I Y=1 S $P(^TMP($J,"RC_SORTPARM"),U,2)=((RC+1)#2),REVCHG=1
"RTN","RCDPEWL5",122,0)
 S RCUSPREF=+$O(^RCY(344.49,RCSCR,2,"B",DUZ,0))
"RTN","RCDPEWL5",123,0)
 ;
"RTN","RCDPEWL5",124,0)
 I 'RCUSPREF D  ; Add the user pref record
"RTN","RCDPEWL5",125,0)
 . S RCUSPREF=+$$ADDUSER(RCSCR,DUZ)
"RTN","RCDPEWL5",126,0)
 S RCLSTREV=+$P($G(^RCY(344.49,RCSCR,2,RCUSPREF,0)),U,2)
"RTN","RCDPEWL5",127,0)
 S DA(1)=RCSCR,DA=RCUSPREF
"RTN","RCDPEWL5",128,0)
 I DA,RCLSTREV'=$P($G(^TMP($J,"RC_SORTPARM")),U,2) D  ; Update user pref
"RTN","RCDPEWL5",129,0)
 . S DIE="^RCY(344.49,"_DA(1)_",2,",DR=".02////"_+$P($G(^TMP($J,"RC_SORTPARM")),U,2) D ^DIE
"RTN","RCDPEWL5",130,0)
 W !
"RTN","RCDPEWL5",131,0)
 I '$P(^TMP($J,"RC_SORTPARM"),U,2) G REVIEWQ
"RTN","RCDPEWL5",132,0)
 ;
"RTN","RCDPEWL5",133,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL5",134,0)
 S RCZ=+$O(RCDA(0)),RCZ=+$G(RCDA(RCZ)) G:'RCZ REVIEWQ
"RTN","RCDPEWL5",135,0)
 ;
"RTN","RCDPEWL5",136,0)
 S RCREV=0
"RTN","RCDPEWL5",137,0)
 I '$O(^RCY(344.49,RCSCR,1,"AC",DUZ,RCZ,0)) D
"RTN","RCDPEWL5",138,0)
 . S RCREV=$$NEWREV(RCSCR,RCZ,DUZ)
"RTN","RCDPEWL5",139,0)
 E  D
"RTN","RCDPEWL5",140,0)
 . N DIR,X,Y
"RTN","RCDPEWL5",141,0)
 . S DIR("A")="(A)DD or (E)DIT A REVIEW COMMENT?: ",DIR("B")="ADD",DIR(0)="SA^A:ADD;E:EDIT" W ! D ^DIR K DIR
"RTN","RCDPEWL5",142,0)
 . I $D(DUOUT)!$D(DTOUT) Q
"RTN","RCDPEWL5",143,0)
 . ;
"RTN","RCDPEWL5",144,0)
 . I Y="E" D  Q  ; Edit a review entry entered by same user
"RTN","RCDPEWL5",145,0)
 .. N DA,DR,DIE,X,Y
"RTN","RCDPEWL5",146,0)
 .. S DA(1)=RCSCR,DA=RCZ,DIC="^RCY(344.49,"_DA(1)_",1,"_DA_",4,",DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,2)=DUZ" D ^DIC
"RTN","RCDPEWL5",147,0)
 .. S RCREV=$S(Y>0:+Y,1:0)
"RTN","RCDPEWL5",148,0)
 .. I RCREV S DA(2)=RCSCR,DA(1)=RCZ,DA=RCREV,DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,",DR=".03;.04////^S X=$$NOW^XLFDT()" D ^DIE
"RTN","RCDPEWL5",149,0)
 . ;
"RTN","RCDPEWL5",150,0)
 . S RCREV=$$NEWREV(RCSCR,RCZ,DUZ)
"RTN","RCDPEWL5",151,0)
 ;
"RTN","RCDPEWL5",152,0)
 I RCREV S DIE("NO^")="",DA(1)=RCSCR,DA=RCZ,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".11R;I X=0 S Y=""@10"";.12////^S X=DUZ;S Y=""@20"";@10;.12///@;@20" D ^DIE K DIE
"RTN","RCDPEWL5",153,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL5",154,0)
 S REVCHG=""
"RTN","RCDPEWL5",155,0)
 ;
"RTN","RCDPEWL5",156,0)
REVIEWQ I $G(REVCHG) D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL5",157,0)
 S VALMBCK="R"
"RTN","RCDPEWL5",158,0)
 Q
"RTN","RCDPEWL5",159,0)
 ;
"RTN","RCDPEWL5",160,0)
NEWREV(RCSCR,RCZ,RCDUZ) ; Enter a new review comment
"RTN","RCDPEWL5",161,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWL5",162,0)
 ; RCZ = ien of the EEOB (seq #)
"RTN","RCDPEWL5",163,0)
 ; RCDUZ =DUZ of user entering the comment
"RTN","RCDPEWL5",164,0)
 ; Function returns 0 if no new comment, ien of comment if added
"RTN","RCDPEWL5",165,0)
 N DA,X,Y,DIC,DIK,DLAYGO,DO,DD,RCREV,RCNOW
"RTN","RCDPEWL5",166,0)
 S RCNOW=$$NOW^XLFDT() W !!,"REVIEW DATE/TIME: "_$$FMTE^XLFDT(RCNOW,"2")
"RTN","RCDPEWL5",167,0)
 S DA(2)=RCSCR,DA(1)=RCZ,X=RCNOW,DIC("DR")=".02////"_RCDUZ_";.03",DLAYGO=344.492,DIC(0)="L"
"RTN","RCDPEWL5",168,0)
 S DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,"
"RTN","RCDPEWL5",169,0)
 K DO,DD
"RTN","RCDPEWL5",170,0)
 D FILE^DICN K DO,DD,DIC,DLAYGO
"RTN","RCDPEWL5",171,0)
 S RCREV=+Y
"RTN","RCDPEWL5",172,0)
 I RCREV'>0 S RCREV=0 G NEWREVQ
"RTN","RCDPEWL5",173,0)
 I '$O(^RCY(344.49,DA(2),1,DA(1),4,RCREV,0)) S DIK="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,",DA=RCREV D ^DIK S RCREV=0 ; No comment - delete entry
"RTN","RCDPEWL5",174,0)
 ;
"RTN","RCDPEWL5",175,0)
NEWREVQ Q RCREV
"RTN","RCDPEWL5",176,0)
 ;
"RTN","RCDPEWL5",177,0)
NOACT ;
"RTN","RCDPEWL5",178,0)
 N DIR,X,Y
"RTN","RCDPEWL5",179,0)
 S DIR(0)="EA",DIR("A")="NO ACTION TAKEN - RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEWL5",180,0)
 Q
"RTN","RCDPEWL5",181,0)
 ;
"RTN","RCDPEWL5",182,0)
ADDUSER(RCSCR,RCDUZ) ; Add user record to user preferences multiple in file 344.49 and initialize all preferences
"RTN","RCDPEWL5",183,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWL5",184,0)
 ; RCDUZ  = the ien of the user
"RTN","RCDPEWL5",185,0)
 N DIC,DA,X,Y,DLAYGO,DO,DD
"RTN","RCDPEWL5",186,0)
 S Y=+$O(^RCY(344.49,RCSCR,2,"B",RCDUZ,0))
"RTN","RCDPEWL5",187,0)
 I Y G ADDUQ
"RTN","RCDPEWL5",188,0)
 S DLAYGO=344.492,DA(1)=RCSCR,DIC(0)="L",X=RCDUZ,DIC="^RCY(344.49,"_DA(1)_",2,",DIC("DR")=".02////0;.03////N"
"RTN","RCDPEWL5",189,0)
 D FILE^DICN K DIC,DLAYGO
"RTN","RCDPEWL5",190,0)
ADDUQ Q $S(Y>0:Y,1:0)
"RTN","RCDPEWL5",191,0)
 ;
"RTN","RCDPEWL6")
0^1^B65553725
"RTN","RCDPEWL6",1,0)
RCDPEWL6 ;ALB/TMK - ELECTRONIC EOB WORKLIST ACTIONS ;18-MAR-03
"RTN","RCDPEWL6",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWL6",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL6",4,0)
 Q
"RTN","RCDPEWL6",5,0)
 ;
"RTN","RCDPEWL6",6,0)
DISTADJ ; Distribute an adjustment that retracts a payment to other bill(s)
"RTN","RCDPEWL6",7,0)
 ; NOTE: RCSCR is assumed to be the IEN of the ERA entry in file 344.49
"RTN","RCDPEWL6",8,0)
 N RCDA,RCDA1,RCAMT,RCADJ,RCQUIT,Z,Z0,Z1,DIR,X,Y,CT,RCZ,RCZ1,RCZ2,RCADJOK,TOT,DTOUT,DUOUT
"RTN","RCDPEWL6",9,0)
 D FULL^VALM1
"RTN","RCDPEWL6",10,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G DISTQ
"RTN","RCDPEWL6",11,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G DISTQ
"RTN","RCDPEWL6",12,0)
 ;
"RTN","RCDPEWL6",13,0)
 S Z=0,RCADJOK="" F  S Z=$O(^TMP("RCDPE-EOB_WLDX",$J,Z)) Q:'Z  S Z1=+$P($G(^(Z)),U,2),Z0=$G(^RCY(344.49,RCSCR,1,Z1,0)) D
"RTN","RCDPEWL6",14,0)
 . ;(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL6",15,0)
 . I $P(Z0,U)'["." S RCADJOK=($P(Z0,U,2)["**ADJ") Q
"RTN","RCDPEWL6",16,0)
 . I '$P(Z0,U,7),'RCADJOK Q  ; Suspense item cannot be used to adjust
"RTN","RCDPEWL6",17,0)
 . I $P(Z0,U,6)<0 S RCZ(Z)=$P(Z0,U,6)_U_Z1 Q
"RTN","RCDPEWL6",18,0)
 . I $P(Z0,U,6)>0 D  Q
"RTN","RCDPEWL6",19,0)
 .. N Q,ONHLD,IBA
"RTN","RCDPEWL6",20,0)
 .. S ONHLD=0
"RTN","RCDPEWL6",21,0)
 .. I $P(Z0,U,7) I $$IB^IBRUTL(+$P(Z0,U,7),1) S Q=0 F  S Q=$O(IBA(Q)) Q:'Q  I $P($G(^IB(+IBA(Q),0)),U,5)=8 S ONHLD=1 Q
"RTN","RCDPEWL6",22,0)
 .. S RCZ1(+$P(Z0,U,6),Z)=Z1_U_ONHLD,RCZ2(Z)=Z1_U_$P(Z0,U,6)_U_ONHLD Q
"RTN","RCDPEWL6",23,0)
 ;
"RTN","RCDPEWL6",24,0)
 I $O(RCZ(0))="" D  G DISTQ
"RTN","RCDPEWL6",25,0)
 . S DIR(0)="EA",DIR("A",1)="NO LINES EXIST NEEDING ADJUSTMENT DISTRIBUTION",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",26,0)
 ;
"RTN","RCDPEWL6",27,0)
 I $O(RCZ1(0))="" D  G DISTQ
"RTN","RCDPEWL6",28,0)
 . S DIR(0)="EA",DIR("A",1)="NO VALID LINES EXIST ON THIS ERA WHERE A DISTRIBUTION CAN BE MADE",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",29,0)
 ;
"RTN","RCDPEWL6",30,0)
 S RCQUIT=0
"RTN","RCDPEWL6",31,0)
 F  S DIR(0)="NA^1:99:3",DIR("A")="SELECT A LINE THAT NEEDS AN ADJUSTMENT AMOUNT DISTRIBUTED: " D  Q:RCQUIT
"RTN","RCDPEWL6",32,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE AN ADJUSTMENT THAT CAUSED A NEGATIVE NET PAYMENT.",DIR("?",2)="IN ORDER TO BALANCE THE RECEIPT AND THE DEPOSIT, THESE AMOUNTS WILL NEED TO",DIR("?",3)="  BE DISTRIBUTED TO OTHER LINE(S)",CT=3
"RTN","RCDPEWL6",33,0)
 . S Z=0
"RTN","RCDPEWL6",34,0)
 . F  S Z=$O(RCZ(Z)) Q:'Z  S CT=CT+1,DIR("?",CT)="  "_$J(Z,8)_"  "_$J($P(RCZ(Z),U),15,2)
"RTN","RCDPEWL6",35,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",36,0)
 . I $O(RCZ(0))=$O(RCZ(""),-1) S DIR("B")=$O(RCZ(0))
"RTN","RCDPEWL6",37,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",38,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA="" Q
"RTN","RCDPEWL6",39,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",40,0)
 . I '$D(RCZ(Y)) D  Q:Y=""
"RTN","RCDPEWL6",41,0)
 .. I Y'[".",$D(RCZ(Y_".001")),$O(RCZ(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",42,0)
 .. W !,$S(Y["."!($O(RCZ(Y))\1'=(Y\1)):"THIS LINE DOESN'T NEED AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",43,0)
 .. S Y=""
"RTN","RCDPEWL6",44,0)
 . W !,"  LINE #: "_+Y_"  AMOUNT NEEDED TO DISTRIBUTE: "_$J(+RCZ(Y),"",2),!
"RTN","RCDPEWL6",45,0)
 . ; RCDA = the ien of the line in file 344.491
"RTN","RCDPEWL6",46,0)
 . ; RCDA(1) = the line #        RCDA(2) = the amount to be adjusted (+)
"RTN","RCDPEWL6",47,0)
 . S RCDA=$P(RCZ(Y),U,2),RCDA(1)=Y,RCQUIT=1,RCDA(2)=-$P(RCZ(Y),U)
"RTN","RCDPEWL6",48,0)
 ;
"RTN","RCDPEWL6",49,0)
 G:$G(RCDA)="" DISTQ
"RTN","RCDPEWL6",50,0)
 ;
"RTN","RCDPEWL6",51,0)
 S RCQUIT=0
"RTN","RCDPEWL6",52,0)
 ;
"RTN","RCDPEWL6",53,0)
 S (TOT,Z)=0 F  S Z=$O(RCZ1(Z)) Q:'Z  S TOT=TOT+Z
"RTN","RCDPEWL6",54,0)
 I TOT<RCDA(2) D  G DISTQ
"RTN","RCDPEWL6",55,0)
 . S DIR(0)="EA",DIR("A",1)="THE ERA DOES NOT HAVE ENOUGH VALID PAYMENTS TO OFFSET THIS DISTRIBUTION",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",56,0)
 ;
"RTN","RCDPEWL6",57,0)
 F  S DIR(0)="NA^1:9999:3",DIR("A")="SELECT A LINE TO DISTRIBUTE THE ADJUSTMENT AMOUNT TO: " D  Q:RCQUIT
"RTN","RCDPEWL6",58,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE A NET PAYMENT THAT CAN BE USED TO OFFSET THE",DIR("?",2)="  NEGATIVE NET PAYMENT FOR LINE "_RCDA(1)_" ("_$J(+$P(RCZ(RCDA(1)),U),"",2)_"):",CT=2
"RTN","RCDPEWL6",59,0)
 . S Z="" F  S Z=$O(RCZ1(Z),-1) Q:'Z  S Z0=0 F  S Z0=$O(RCZ1(Z,Z0)) Q:'Z0  S CT=CT+1,DIR("?",CT)="  "_$J(Z0,8)_"  "_$J(+Z,15,2)_$S($P(RCZ1(Z,Z0),U,2):" On hold exists",1:"")
"RTN","RCDPEWL6",60,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",61,0)
 . I $O(RCZ2(0))=$O(RCZ2(""),-1) S DIR("B")=$O(RCZ2(0))
"RTN","RCDPEWL6",62,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",63,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA1="" Q
"RTN","RCDPEWL6",64,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",65,0)
 . I '$D(RCZ2(Y)) D  Q:Y=""
"RTN","RCDPEWL6",66,0)
 .. I Y'[".",$D(RCZ2(Y_".001")),$O(RCZ2(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",67,0)
 .. I Y'[".",$O(RCZ2(Y))\1'=Y S Y=Y_"."
"RTN","RCDPEWL6",68,0)
 .. W !,$S(Y[".":"THIS LINE CANNOT BE USED FOR AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",69,0)
 .. S Y=""
"RTN","RCDPEWL6",70,0)
 . I $P(RCZ2(Y),U,3) W !,"Warning - on-hold exists for this claim",!
"RTN","RCDPEWL6",71,0)
 . W !,"  LINE #: "_+Y_"  LINE BALANCE: "_$J(+$P(RCZ2(Y),U,2),"",2),!
"RTN","RCDPEWL6",72,0)
 . ; RCDA1 = the ien of the line in file 344.491
"RTN","RCDPEWL6",73,0)
 . ; RCDA1(1) = the line # in the display
"RTN","RCDPEWL6",74,0)
 . S RCDA1(1)=Y,RCDA1=+$G(RCZ2(Y)),RCQUIT=1
"RTN","RCDPEWL6",75,0)
 . S Z=$O(^RCY(344.49,RCSCR,1,"B",RCDA1(1)\1,0))
"RTN","RCDPEWL6",76,0)
 . S RCADJ=0
"RTN","RCDPEWL6",77,0)
 . I $P($G(^RCY(344.49,RCSCR,1,Z,0)),U,2)["**ADJ" S RCADJ=1 W !,"THE LINE SELECTED IS AN ADDITIONAL PAYMENT LINE, NOT SPECIFIC TO A CLAIM",!,"THE AMT WILL BE DISTRIBUTED, BUT A DECREASE ADJUSTMENT WILL NOT BE PERFORMED",!
"RTN","RCDPEWL6",78,0)
 ;
"RTN","RCDPEWL6",79,0)
 G:'$G(RCDA1) DISTQ
"RTN","RCDPEWL6",80,0)
 ;
"RTN","RCDPEWL6",81,0)
 S DIR("B")=$S(RCDA(2)<$P(RCZ2(RCDA1(1)),U,2):$J(RCDA(2),"",2),1:$J($P(RCZ2(+RCDA1(1)),U,2),"",2))
"RTN","RCDPEWL6",82,0)
 S DIR(0)="NA^.01:"_DIR("B")_":2",DIR("A")="ADJUSTMENT AMOUNT TO DISTRIBUTE: "
"RTN","RCDPEWL6",83,0)
 S DIR("?",1)="THIS IS THE AMOUNT OF THE ADJUSTMENT THAT SHOULD BE APPLIED TO THIS",DIR("?")="PAYMENT LINE.  THE AMT ENTERED MUST BE BETWEEN .01 AND "_$J(DIR("B"),"",2)
"RTN","RCDPEWL6",84,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",85,0)
 ;
"RTN","RCDPEWL6",86,0)
 I $D(DUOUT)!$D(DTOUT)!'Y D  G DISTQ
"RTN","RCDPEWL6",87,0)
 . S DIR(0)="EA",DIR("A",1)="NO AMOUNT WAS ENTERED - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",88,0)
 S RCAMT=$J(Y,"",2)
"RTN","RCDPEWL6",89,0)
 ;
"RTN","RCDPEWL6",90,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",91,0)
 I $D(DUOUT)!$D(DTOUT) D  G DISTQ
"RTN","RCDPEWL6",92,0)
 . S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",93,0)
 ;
"RTN","RCDPEWL6",94,0)
 S Y=""
"RTN","RCDPEWL6",95,0)
 I 'RCADJ D  G:'$D(RCDA) DISTQ
"RTN","RCDPEWL6",96,0)
 . N Z,RCA
"RTN","RCDPEWL6",97,0)
 . S RCA=0,Z1=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA(1)\1)),U,2),Z=$G(^RCY(344.49,RCSCR,1,Z1,0)),RCA("#")=+$P($P(Z,U,2),"**ADJ",2)
"RTN","RCDPEWL6",98,0)
 . I $P(Z,U,2)["**ADJ" D
"RTN","RCDPEWL6",99,0)
 .. S RCA=1
"RTN","RCDPEWL6",100,0)
 .. S RCA("REF")=$S(RCA("#"):$P($G(^RCY(344.4,RCSCR,2,RCA("#"),0)),U),1:$P(Z,U,9))
"RTN","RCDPEWL6",101,0)
 . S Z=$S(RCA:RCA("#"),1:$G(^RCY(344.49,RCSCR,1,RCDA,0)))
"RTN","RCDPEWL6",102,0)
 . S DIR(0)="FAO^1:60",DIR("A")="  > ",DIR("A",1)="DECREASE ADJ COMMENT (1-60 CHARACTERS): "
"RTN","RCDPEWL6",103,0)
 . S DIR("B")="RETRACTED FOR "
"RTN","RCDPEWL6",104,0)
 . S DIR("B")=DIR("B")_$S(RCA:"ERA ADJ #"_Z_" Ref: "_RCA("REF"),1:"CLAIM "_$S($P(Z,U,2)'="":$P(Z,U,2),1:"UNKNOWN"))
"RTN","RCDPEWL6",105,0)
 . I $L(DIR("B"))>60 S DIR("B")=$E(DIR("B"),1,60)
"RTN","RCDPEWL6",106,0)
 . D ^DIR K DIR
"RTN","RCDPEWL6",107,0)
 . ;
"RTN","RCDPEWL6",108,0)
 . I $D(DUOUT)!$D(DTOUT) D  Q
"RTN","RCDPEWL6",109,0)
 .. K RCDA
"RTN","RCDPEWL6",110,0)
 .. S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",111,0)
 ;
"RTN","RCDPEWL6",112,0)
 D DISTADJ^RCDPEWL4(RCDA,RCDA1,RCAMT,Y)
"RTN","RCDPEWL6",113,0)
 ;
"RTN","RCDPEWL6",114,0)
DISTQ S VALMBCK="R"
"RTN","RCDPEWL6",115,0)
 Q
"RTN","RCDPEWL6",116,0)
 ;
"RTN","RCDPEWL6",117,0)
REFRESH ; Refresh the entry in file 344.49 to remove all user adjustments
"RTN","RCDPEWL6",118,0)
 N RCREDEF,RCQUIT,DIR,X,Y,Z,Z0,DA,DIK
"RTN","RCDPEWL6",119,0)
 D FULL^VALM1
"RTN","RCDPEWL6",120,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G REFQ
"RTN","RCDPEWL6",121,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G REFQ
"RTN","RCDPEWL6",122,0)
 S DIR(0)="YA"
"RTN","RCDPEWL6",123,0)
 S DIR("A",1)="THIS ACTION WILL DELETE AND REBUILD THIS EEOB WORKLIST SCRATCH PAD ENTRY",DIR("A",2)="ALL EDITS/SPLITS/DISTRIBUTE ADJUSTMENTS ENTERED FOR THIS ERA WILL BE ERASED"
"RTN","RCDPEWL6",124,0)
 S DIR("A",3)="AND ALL ENTRIES MARKED AS MANUALLY VERIFIED WILL BE UNMARKED",DIR("A",4)=" "
"RTN","RCDPEWL6",125,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO DO THIS?: "
"RTN","RCDPEWL6",126,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",127,0)
 I Y'=1 G REFQ
"RTN","RCDPEWL6",128,0)
 I $O(^RCY(344.49,RCSCR,3,0)) S RCQUIT=0 D  I RCQUIT G REFQ
"RTN","RCDPEWL6",129,0)
 . S DIR(0)="YA",DIR("A")="DO YOU WANT TO REDEFINE YOUR BATCHES TOO?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL6",130,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL6",131,0)
 . S RCREDEF=+Y
"RTN","RCDPEWL6",132,0)
 . K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",133,0)
 . S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL6",134,0)
 .. I RCREDEF S DA=Z,DA(1)=RCSCR,DIK="^RCY(344.49,"_DA(1)_",3," D ^DIK Q
"RTN","RCDPEWL6",135,0)
 .. S ^TMP($J,"BATCHES",+$P(Z0,U,6),$P(Z0,U,7))=+Z0_U_$P(Z0,U,8)
"RTN","RCDPEWL6",136,0)
 . I 'RCREDEF S ^TMP($J,"BATCHES")=+$O(^TMP($J,"BATCHES",0))
"RTN","RCDPEWL6",137,0)
 . I RCREDEF D SETBATCH^RCDPEWLB(RCSCR)
"RTN","RCDPEWL6",138,0)
 D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL6",139,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL6",140,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",141,0)
REFQ S VALMBG=1,VALMBCK="R"
"RTN","RCDPEWL6",142,0)
 Q
"RTN","RCDPEWL6",143,0)
 ;
"RTN","RCDPEWL6",144,0)
WHAT(RCSCR) ; Text for what to do if not enough funds found for dist adj
"RTN","RCDPEWL6",145,0)
 Q $S($O(^RCY(344.31,"AERA",+RCSCR,0)):"THIS ERA MUST BE MOVED TO SUSPENSE",1:"THIS ERA'S RECEIPT MUST BE ENTERED MANUALLY")
"RTN","RCDPEWL6",146,0)
 ;
"RTN","RCDPEWL6",147,0)
ADJUST ; Allow entry into increase/decrease adjustment functions
"RTN","RCDPEWL6",148,0)
 N DIR,X,Y,RCTYP,RCY,DIC
"RTN","RCDPEWL6",149,0)
 D FULL^VALM1
"RTN","RCDPEWL6",150,0)
 ;
"RTN","RCDPEWL6",151,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G ADJUSTQ
"RTN","RCDPEWL6",152,0)
 ;
"RTN","RCDPEWL6",153,0)
 S DIR(0)="SA^D:DECREASE ADJUSTMENT;I:INCREASE ADJUSTMENT",DIR("B")="DECREASE ADJUSTMENT",DIR("A")="TYPE OF ADJUSTMENT: "
"RTN","RCDPEWL6",154,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",155,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL6",156,0)
 I $D(DUOUT)!$D(DTOUT)!(Y="") G ADJUSTQ
"RTN","RCDPEWL6",157,0)
 ;
"RTN","RCDPEWL6",158,0)
 S RCTYP=$S(Y="D":"DECREASE",1:"INCREASE")
"RTN","RCDPEWL6",159,0)
 F  S RCY=$$GETABILL^RCBEUBIL Q:RCY<0!(RCY'<1)
"RTN","RCDPEWL6",160,0)
 G:RCY<1 ADJUSTQ
"RTN","RCDPEWL6",161,0)
 D ADJUST^RCBEADJ(RCTYP,RCY_";"_RCSCR)
"RTN","RCDPEWL6",162,0)
 I $D(^TMP("RC_BILL",$J,RCY)) D
"RTN","RCDPEWL6",163,0)
 . D UPDBAL(RCY)
"RTN","RCDPEWL6",164,0)
 . W !,"Claim balance is now: ",$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",165,0)
 ;
"RTN","RCDPEWL6",166,0)
ADJUSTQ D RESTMP
"RTN","RCDPEWL6",167,0)
 D RET^RCDPEWL2
"RTN","RCDPEWL6",168,0)
 S VALMBCK="R"
"RTN","RCDPEWL6",169,0)
 Q
"RTN","RCDPEWL6",170,0)
 ;
"RTN","RCDPEWL6",171,0)
RESTMP ;
"RTN","RCDPEWL6",172,0)
 I $D(^TMP("RC_SAVE_TMP",$J)) M ^TMP($J)=^TMP("RC_SAVE_TMP",$J) K ^TMP("RC_SAVE_TMP")
"RTN","RCDPEWL6",173,0)
 Q
"RTN","RCDPEWL6",174,0)
 ;
"RTN","RCDPEWL6",175,0)
UPDBAL(RCY) ; Updates the claim balance if bill exists in list
"RTN","RCDPEWL6",176,0)
 ; RCY = ien of bill in file 430
"RTN","RCDPEWL6",177,0)
 ;
"RTN","RCDPEWL6",178,0)
 N X,Y,Z,Z0,Z1
"RTN","RCDPEWL6",179,0)
 S Z0=$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",180,0)
 S Z=0 F  S Z=$O(^TMP("RC_BILL",$J,RCY,Z)) Q:'Z  D
"RTN","RCDPEWL6",181,0)
 . S X=+$G(^TMP("RCDPE-EOB_WLDX",$J,Z))
"RTN","RCDPEWL6",182,0)
 . Q:'X
"RTN","RCDPEWL6",183,0)
 . S Y=$G(^TMP("RCDPE-EOB_WL",$J,X+1,0))
"RTN","RCDPEWL6",184,0)
 . I Y["Claim Bal: " S Z1=$P(Y,"Claim Bal: ")_"Claim Bal: "_Z0_$G(^TMP("RC_BILL",$J,RCY,Z)),^TMP("RCDPE-EOB_WL",$J,X+1,0)=Z1
"RTN","RCDPEWL6",185,0)
 Q
"RTN","RCDPEWL6",186,0)
 ;
"RTN","RCDPEWL7")
0^11^B79914006
"RTN","RCDPEWL7",1,0)
RCDPEWL7 ;ALB/TMK - EDI LOCKBOX WORKLIST ERA DISPLAY SCREEN ;16-JAN-04
"RTN","RCDPEWL7",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEWL7",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL7",4,0)
 Q
"RTN","RCDPEWL7",5,0)
 ;
"RTN","RCDPEWL7",6,0)
BLD(RCSORT) ; Build list with sort criteria
"RTN","RCDPEWL7",7,0)
 ; RCSORT = the sort levels to use to display the data in ^ pieces
"RTN","RCDPEWL7",8,0)
 ;  piece 1 = the codes for the first level sort (sort code;null or -)
"RTN","RCDPEWL7",9,0)
 ;  piece 2 = the codes for the second level sort
"RTN","RCDPEWL7",10,0)
 ;     sort code is the type of data to sort by;- indicates reverse order
"RTN","RCDPEWL7",11,0)
 N Z,Z1,RCT,RCZ
"RTN","RCDPEWL7",12,0)
 S (RCT,VALMCNT)=0
"RTN","RCDPEWL7",13,0)
 I '$D(^TMP($J,"RCERA_LIST")) D
"RTN","RCDPEWL7",14,0)
 . S Z=0 F  S Z=$O(^TMP("RCDPE-ERA_WLDX",$J,Z)) Q:'Z  S RCZ=$P($G(^(Z)),U,2) D
"RTN","RCDPEWL7",15,0)
 .. I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,$P(RCSORT,U)),$$SL(RCZ,$P(RCSORT,U,2)),RCZ)=""
"RTN","RCDPEWL7",16,0)
 . K ^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCDPE-ERA_WL",$J)
"RTN","RCDPEWL7",17,0)
 ;
"RTN","RCDPEWL7",18,0)
 S Z=""
"RTN","RCDPEWL7",19,0)
 I RCSORT'["PN;-" D
"RTN","RCDPEWL7",20,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",21,0)
 ;
"RTN","RCDPEWL7",22,0)
 I $P(RCSORT,U)["PN;-" D
"RTN","RCDPEWL7",23,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z),-1) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",24,0)
 ;
"RTN","RCDPEWL7",25,0)
 I $P(RCSORT,U,2)["PN;-" D
"RTN","RCDPEWL7",26,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1),-1) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",27,0)
 ;
"RTN","RCDPEWL7",28,0)
 I '$O(^TMP($J,"RCERA_LIST",0)) D SET("No ERAs left for your selection criteria")
"RTN","RCDPEWL7",29,0)
 K ^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",30,0)
 S ^TMP("RCERA_PARAMS",$J,"SORT")=RCSORT
"RTN","RCDPEWL7",31,0)
 Q
"RTN","RCDPEWL7",32,0)
 ;
"RTN","RCDPEWL7",33,0)
EXTRACT(RCSRT1,RCSRT2,RCT) ; Extract the data
"RTN","RCDPEWL7",34,0)
 ; RCSRT1 = data value at 1st sort level
"RTN","RCDPEWL7",35,0)
 ; RCSRT2 = data value at 2nd sort level
"RTN","RCDPEWL7",36,0)
 ; RCT = running entry counter - returned if passed by ref
"RTN","RCDPEWL7",37,0)
 N FIRST,RCZ,RC0,RCEFT,RCSTAT,RCPOST,X,Z,Z0
"RTN","RCDPEWL7",38,0)
 S RCZ=0 F  S RCZ=$O(^TMP($J,"RCERA_LIST",RCSRT1,RCSRT2,RCZ)) Q:'RCZ  D
"RTN","RCDPEWL7",39,0)
 . S RCT=RCT+1,RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",40,0)
 . S RCEFT=+$O(^RCY(344.31,"AERA",RCZ,0))
"RTN","RCDPEWL7",41,0)
 . S RCSTAT=$S('RCEFT:U_$S($P(RC0,U,15)="CHK":"(CHECK PAYMENT EXPECTED)",$P(RC0,U,15)="NON":"(NO PAYMENT EXPECTED)",$P(RC0,U,9)=2:"(CHECK PAYMENT CHOSEN)",1:"N/A"),1:$$FMSSTAT^RCDPUREC(+$P($G(^RCY(344.31,RCEFT,0)),U,9)))
"RTN","RCDPEWL7",42,0)
 . S RCPOST=$S(RCEFT:"EFT RECEIPT STATUS: ",1:"")_$P(RCSTAT,U,2)
"RTN","RCDPEWL7",43,0)
 . S X=$E(RCT_$J("",4),1,4)_$S($D(^RCY(344.49,RCZ)):" ",1:"-")_$E($P(RC0,U)_$J("",5),1,5)_"  "_$E($P(RC0,U,2)_$J("",30),1,30)_"  "_$J($$FMTE^XLFDT($P(RC0,U,7),"2D"),8)_$J("",5)_$J(+$P(RC0,U,5),12,2)
"RTN","RCDPEWL7",44,0)
 . S $E(X,73,80)=$$FMTE^XLFDT($P(RC0,U,7),"2D")
"RTN","RCDPEWL7",45,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",46,0)
 . S X=$J("",12)_$E($P(RC0,U,6)_$J("",30),1,30)_"  APPROX # EEOBs: "_+$$CTEEOB^RCDPEWLB(RCZ)
"RTN","RCDPEWL7",47,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",48,0)
 . S X=$J("",12)_$E($$EXTERNAL^DILFD(344.4,.09,"",$P(RC0,U,9))_$J("",30),1,30)_"  "_RCPOST
"RTN","RCDPEWL7",49,0)
 . D SET(X,RCT)
"RTN","RCDPEWL7",50,0)
 . I $G(^TMP("RCERA_PARAMS",$J,"BATCHON")) D
"RTN","RCDPEWL7",51,0)
 .. S Z=0 F  S Z=$O(^RCY(344.49,RCZ,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="" D
"RTN","RCDPEWL7",52,0)
 ... S X=$J("",12)_$E("- BATCH #"_$P(Z0,U)_$J("",4),1,13)_" "_$E($P(Z0,U,2)_$J("",30),1,30)_"  "_$S('$P(Z0,U,3):"NOT ",1:"")_"READY TO POST"
"RTN","RCDPEWL7",53,0)
 ... D SET(X,RCT)
"RTN","RCDPEWL7",54,0)
 . D SET(" ",RCT)
"RTN","RCDPEWL7",55,0)
 S VALMSG="'-' Before the ERA # indicates no scratchpad entry yet"
"RTN","RCDPEWL7",56,0)
 ;
"RTN","RCDPEWL7",57,0)
 Q
"RTN","RCDPEWL7",58,0)
 ;
"RTN","RCDPEWL7",59,0)
SL(Y,SORT) ; Returns data for sort level from entry Y in file 344.4
"RTN","RCDPEWL7",60,0)
 ; SORT = the sort data in ';' delimited pieces
"RTN","RCDPEWL7",61,0)
 ;    pc 1 = code for sort data
"RTN","RCDPEWL7",62,0)
 ;    pc 2 = the order requested (- or null)
"RTN","RCDPEWL7",63,0)
 ;  
"RTN","RCDPEWL7",64,0)
 N RC0,DAT,SORT1,SORT2
"RTN","RCDPEWL7",65,0)
 S SORT1=$P(SORT,";"),SORT2=$P(SORT,";",2)
"RTN","RCDPEWL7",66,0)
 S RC0=$G(^RCY(344.4,Y,0)),DAT=" "
"RTN","RCDPEWL7",67,0)
 ; No sort
"RTN","RCDPEWL7",68,0)
 I SORT="" G SLQ
"RTN","RCDPEWL7",69,0)
 ; Amt paid
"RTN","RCDPEWL7",70,0)
 I SORT1="AP" D  G SLQ
"RTN","RCDPEWL7",71,0)
 . S DAT=SORT2_+$P(RC0,U,5)
"RTN","RCDPEWL7",72,0)
 ; ERA date pd
"RTN","RCDPEWL7",73,0)
 I SORT1="DP" D  G SLQ
"RTN","RCDPEWL7",74,0)
 . S DAT=SORT2_($P(RC0,U,4)\1)
"RTN","RCDPEWL7",75,0)
 ; Payer name
"RTN","RCDPEWL7",76,0)
 I SORT1="PN" D  G SLQ
"RTN","RCDPEWL7",77,0)
 . S DAT=$$UPPER($P(RC0,U,6))
"RTN","RCDPEWL7",78,0)
 ; ERA date received
"RTN","RCDPEWL7",79,0)
 I SORT1="DR" D  G SLQ
"RTN","RCDPEWL7",80,0)
 . S DAT=SORT2_($P(RC0,U,7)\1)
"RTN","RCDPEWL7",81,0)
 ;
"RTN","RCDPEWL7",82,0)
SLQ Q $S(DAT'="":DAT,1:" ")
"RTN","RCDPEWL7",83,0)
 ;
"RTN","RCDPEWL7",84,0)
INIT ; Entry point for List template to build the display of ERAs
"RTN","RCDPEWL7",85,0)
 ;
"RTN","RCDPEWL7",86,0)
 ; Parameters for selecting ERAs to be included in the list are
"RTN","RCDPEWL7",87,0)
 ; contained in the global ^TMP("RCERA_PARAMS",$J,parameter name)
"RTN","RCDPEWL7",88,0)
 ;
"RTN","RCDPEWL7",89,0)
 N RCZ,RC0,RCT,RCTT,RCQUIT,RCDTFR,RCDTTO,DTOUT,DUOUT,DIR,X,Y,Z,Z1,RCPOST,RCEFT,RCINDX
"RTN","RCDPEWL7",90,0)
 D CLEAN^VALM10
"RTN","RCDPEWL7",91,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",92,0)
 ;
"RTN","RCDPEWL7",93,0)
 S (RCT,RCTT,RCQUIT)=0
"RTN","RCDPEWL7",94,0)
 ;
"RTN","RCDPEWL7",95,0)
 S RCDTFR=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U),RCDTTO=$S($P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U,2):$P(^("RCDT"),U,2),1:DT)
"RTN","RCDPEWL7",96,0)
 ;
"RTN","RCDPEWL7",97,0)
 S RCINDX=$S(RCDTFR:RCDTFR-.00000001,1:0)
"RTN","RCDPEWL7",98,0)
 F  S RCINDX=$O(^RCY(344.4,"AFD",RCINDX)) Q:'RCINDX!(RCINDX\1>RCDTTO)!RCQUIT  S RCZ=0 F  S RCZ=$O(^RCY(344.4,"AFD",RCINDX,RCZ)) Q:'RCZ  D  Q:RCQUIT
"RTN","RCDPEWL7",99,0)
 . ;
"RTN","RCDPEWL7",100,0)
 . S RCTT=RCTT+1 I '(RCTT#5000) D  Q:RCQUIT
"RTN","RCDPEWL7",101,0)
 .. S DIR("A",1)=RCTT_" ERA RECORDS HAVE ALREADY BEEN SEARCHED USING YOUR CRITERIA",DIR("A",2)="LAST DATE SEARCHED WAS "_$$FMTE^XLFDT(RCINDX,"2D"),DIR("A")="DO YOU WANT TO CONTINUE THIS SEARCH?: "
"RTN","RCDPEWL7",102,0)
 .. S DIR("B")="NO",DIR("?")="RESPOND NO HERE AND RESTART TO SELECT A DATE RANGE TO LIMIT THE SEARCH",DIR(0)="YA" W ! D ^DIR K DIR
"RTN","RCDPEWL7",103,0)
 .. I Y=1!$D(DTOUT) W !,$S($D(DTOUT):"TIME OUT - ",1:""),"SEARCH CONTINUED",! Q
"RTN","RCDPEWL7",104,0)
 .. I $D(DUOUT)!(Y=0) S RCQUIT=1 Q
"RTN","RCDPEWL7",105,0)
 . ;
"RTN","RCDPEWL7",106,0)
 . S RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",107,0)
 . I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,"DR"),$$SL(RCZ,""),RCZ)=""
"RTN","RCDPEWL7",108,0)
 ;
"RTN","RCDPEWL7",109,0)
 ; Output the list
"RTN","RCDPEWL7",110,0)
 I 'RCQUIT D
"RTN","RCDPEWL7",111,0)
 . D:$D(^TMP($J,"RCERA_LIST")) BLD("DR^N")
"RTN","RCDPEWL7",112,0)
 . I '$O(^TMP("RCDPE-ERA_WL",$J,0)) D
"RTN","RCDPEWL7",113,0)
 .. S DIR(0)="EA",DIR("A",1)="THERE ARE NO ERAs MATCHING YOUR SELECTION CRITERIA",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR S RCQUIT=1
"RTN","RCDPEWL7",114,0)
 I RCQUIT K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST") S VALMQUIT=""
"RTN","RCDPEWL7",115,0)
 Q
"RTN","RCDPEWL7",116,0)
 ;
"RTN","RCDPEWL7",117,0)
HDR ; Header for ERA list
"RTN","RCDPEWL7",118,0)
 N X
"RTN","RCDPEWL7",119,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH"))
"RTN","RCDPEWL7",120,0)
 S VALMHDR(1)=$E("SELECTED:  MATCH STATUS: "_$S(X="N":"NOT MATCHED",X="M":"MATCHED",1:"BOTH")_$J("",38),1,38)
"RTN","RCDPEWL7",121,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWL7",122,0)
 S VALMHDR(1)=VALMHDR(1)_"  POST STATUS: "_$S(X="U":"UNPOSTED",X="P":"POSTED",1:"BOTH")
"RTN","RCDPEWL7",123,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCDT"))
"RTN","RCDPEWL7",124,0)
 S VALMHDR(2)=$J("",11)_"DATE RANGE  : "_$S($P(X,U):$$FMTE^XLFDT($P(X,U),2)_$S($P(X,U,2):"-"_$$FMTE^XLFDT($P(X,U,2),2),1:""),1:"NONE SELECTED")
"RTN","RCDPEWL7",125,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEWL7",126,0)
 S VALMHDR(3)=$J("",11)_$S($P(X,U)="A"!(X=""):"ALL PAYERS",1:"PAYERS: "_$P(X,U,2)_"-"_$P(X,U,3))
"RTN","RCDPEWL7",127,0)
 Q
"RTN","RCDPEWL7",128,0)
 ;
"RTN","RCDPEWL7",129,0)
FNL ; -- Clean up list
"RTN","RCDPEWL7",130,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCERA_PARAMS",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",131,0)
 Q
"RTN","RCDPEWL7",132,0)
 ;
"RTN","RCDPEWL7",133,0)
SET(X,RCSEQ,RCSEQ1) ; -- set arrays
"RTN","RCDPEWL7",134,0)
 ; X = the data to set into the global
"RTN","RCDPEWL7",135,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEWL7",136,0)
 ; RCSEQ1 = the ien of the entry in file 344.4
"RTN","RCDPEWL7",137,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-ERA_WL",$J,VALMCNT,0)=X
"RTN","RCDPEWL7",138,0)
 I $G(RCSEQ) S ^TMP("RCDPE-ERA_WL",$J,"IDX",VALMCNT,RCSEQ)=$G(RCSEQ1)
"RTN","RCDPEWL7",139,0)
 I $G(RCSEQ1) S ^TMP("RCDPE-ERA_WLDX",$J,RCSEQ)=VALMCNT_U_RCSEQ1
"RTN","RCDPEWL7",140,0)
 Q
"RTN","RCDPEWL7",141,0)
 ;
"RTN","RCDPEWL7",142,0)
ENTERWL ; Enter the worklist with an ERA
"RTN","RCDPEWL7",143,0)
 D WL($$SEL())
"RTN","RCDPEWL7",144,0)
 D BLD($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL7",145,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",146,0)
 Q
"RTN","RCDPEWL7",147,0)
 ;
"RTN","RCDPEWL7",148,0)
SEL() ; Select an ERA from the ERA list
"RTN","RCDPEWL7",149,0)
 N RCDA,VALMY
"RTN","RCDPEWL7",150,0)
 D FULL^VALM1
"RTN","RCDPEWL7",151,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL7",152,0)
 S RCERA=0
"RTN","RCDPEWL7",153,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCERA=+$P($G(^TMP("RCDPE-ERA_WLDX",$J,RCDA)),U,2)
"RTN","RCDPEWL7",154,0)
 ;
"RTN","RCDPEWL7",155,0)
 Q RCERA
"RTN","RCDPEWL7",156,0)
 ;
"RTN","RCDPEWL7",157,0)
WL(RCERA) ; Enter worklist
"RTN","RCDPEWL7",158,0)
 ; RCERA = ien of the ERA entry in file 344.4
"RTN","RCDPEWL7",159,0)
 N RC0,RCNOED,RCQUIT,RCSORT,DA,DIE,X,Y,DR,DIR,DTOUT,DUOUT
"RTN","RCDPEWL7",160,0)
 Q:RCERA'>0
"RTN","RCDPEWL7",161,0)
 S (RCQUIT,RCNOED)=0,RC0=$G(^RCY(344.4,RCERA,0)),RCSORT=""
"RTN","RCDPEWL7",162,0)
 I $P(RC0,U,8) D
"RTN","RCDPEWL7",163,0)
 . I '$D(^RCY(344.49,RCERA,0)) D  Q
"RTN","RCDPEWL7",164,0)
 .. S RCQUIT=1
"RTN","RCDPEWL7",165,0)
 .. W ! S DIR(0)="EA",DIR("A",1)="A SCRATCH PAD WAS NOT CREATED FOR THIS ERA BEFORE POSTING",DIR("A",2)="USE THE VIEW/PRINT ERA OPTION TO SEE ITS DETAIL",DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR K DIR Q
"RTN","RCDPEWL7",166,0)
 . ;
"RTN","RCDPEWL7",167,0)
 . S RCNOED=+$P(RC0,U,8)
"RTN","RCDPEWL7",168,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ERA ALREADY HAS A RECEIPT - YOU MAY ONLY VIEW ITS SCRATCH PAD",DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL7",169,0)
 . W ! D ^DIR K DIR W !
"RTN","RCDPEWL7",170,0)
 I 'RCQUIT D DISP^RCDPEWL(RCERA,RCNOED)
"RTN","RCDPEWL7",171,0)
 ;
"RTN","RCDPEWL7",172,0)
 I 'RCQUIT,$G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL7",173,0)
 . S DA(1)=RCERA,DA=+$G(^TMP("RCBATCH_SELECTED",$J)),DR=".05////0",DIE="^RCY(344.49,"_DA(1)_",3," D ^DIE
"RTN","RCDPEWL7",174,0)
 . L -^RCY(344.49,DA(1),3,DA,0)
"RTN","RCDPEWL7",175,0)
 . K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",176,0)
 E  D
"RTN","RCDPEWL7",177,0)
 . L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL7",178,0)
 Q
"RTN","RCDPEWL7",179,0)
 ;
"RTN","RCDPEWL7",180,0)
PRERA ; View/Print ERA from ERA list menu
"RTN","RCDPEWL7",181,0)
 N RCSCR
"RTN","RCDPEWL7",182,0)
 S RCSCR=$$SEL()
"RTN","RCDPEWL7",183,0)
 I RCSCR>0 D PRERA^RCDPEWL0
"RTN","RCDPEWL7",184,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",185,0)
 Q
"RTN","RCDPEWL7",186,0)
 ;
"RTN","RCDPEWL7",187,0)
BAT(RCERA) ; Select batch, if needed
"RTN","RCDPEWL7",188,0)
 ; Returns 1 if batch selected OK or no batch needed
"RTN","RCDPEWL7",189,0)
 ; RCERA = ien of entry in file 344.49
"RTN","RCDPEWL7",190,0)
 N RCINUSE,RCQUIT,RCADJ,RC0,RCOK,DIR,DTOUT,DUOUT,X,Y,Z
"RTN","RCDPEWL7",191,0)
 K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",192,0)
 S RCOK=1
"RTN","RCDPEWL7",193,0)
 I '$O(^RCY(344.49,RCERA,3,0)) G BATQ
"RTN","RCDPEWL7",194,0)
 S RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEWL7",195,0)
 S (RCQUIT,RCADJ)=0
"RTN","RCDPEWL7",196,0)
 I $$HASADJ^RCDPEWL8(RCERA) D
"RTN","RCDPEWL7",197,0)
 . S RCADJ=1
"RTN","RCDPEWL7",198,0)
 . S DIR("A",1)="THIS ERA HAS NEGATIVE ADJUSTMENTS THAT NEED TO BE DISTRIBUTED TO OTHER",DIR("A",2)="PAYMENTS ON THE ERA.  YOU CANNOT SELECT ANY INDIVIDUAL BATCHES UNTIL",DIR("A",3)="THE DISTRIBUTIONS ARE COMPLETE."
"RTN","RCDPEWL7",199,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE: ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL7",200,0)
 S RCINUSE=+$O(^RCY(344.49,"AINUSE",1,RCERA,0))
"RTN","RCDPEWL7",201,0)
 I RCINUSE D
"RTN","RCDPEWL7",202,0)
 . Q:RCADJ!$P(RC0,U,8)
"RTN","RCDPEWL7",203,0)
 . I '$O(^RCY(344.49,"AINUSE",0,RCERA,0)) D  Q
"RTN","RCDPEWL7",204,0)
 .. S DIR("A",1)="ALL BATCHES WITHIN THIS ERA ARE CURRENTLY IN USE - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",205,0)
 . W !!,"AT LEAST 1 BATCH WITHIN THIS ERA IS CURRENTLY IN USE",!,"AT THIS TIME, YOU CAN ONLY ACCESS INDIVIDUAL BATCHES",!
"RTN","RCDPEWL7",206,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",207,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",208,0)
 E  D
"RTN","RCDPEWL7",209,0)
 . Q:$P(RC0,U,8)!RCADJ  ; Always require the entire ERA be used
"RTN","RCDPEWL7",210,0)
 . S DIR(0)="SA^E:(E)NTIRE ERA;B:(B)ATCH",DIR("A")="DO YOU WANT THE (E)NTIRE ERA OR JUST A (B)ATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL7",211,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",212,0)
 . I Y="E" D  Q
"RTN","RCDPEWL7",213,0)
 .. S RCQUIT=1 F Z=1:1:2 L +^RCY(344.4,RCERA,0):5 I $T S RCQUIT=0 Q
"RTN","RCDPEWL7",214,0)
 .. I RCQUIT S RCOK=0,DIR(0)="EA",DIR("A",1)="ANOTHER USER IS CURRENTLY USING THIS ERA, TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR Q
"RTN","RCDPEWL7",215,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",216,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",217,0)
 ;
"RTN","RCDPEWL7",218,0)
BATQ Q RCOK
"RTN","RCDPEWL7",219,0)
 ;
"RTN","RCDPEWL7",220,0)
UPPER(X) ; Function returns X as all upper case
"RTN","RCDPEWL7",221,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCDPEWL7",222,0)
 ;
"RTN","RCDPEWL8")
0^18^B73075221
"RTN","RCDPEWL8",1,0)
RCDPEWL8 ;ALB/TMK - EDI LOCKBOX WORKLIST ERA LEVEL ;12-FEB-04
"RTN","RCDPEWL8",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEWL8",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWL8",4,0)
 Q
"RTN","RCDPEWL8",5,0)
 ;
"RTN","RCDPEWL8",6,0)
FILESP ; Action that files the split lines
"RTN","RCDPEWL8",7,0)
 ; Assumes RCDIR,RCLINE,RCSCR,RCSPLIT array defined
"RTN","RCDPEWL8",8,0)
 N RCTOT,Z,RCZ0,RCZ1,DTOUT,DUOUT,DIR,X,Y,DIE,DA,DR,DIC,DD,DO,DLAYGO,RCZ,RCZZ,RCZT
"RTN","RCDPEWL8",9,0)
 D FULL^VALM1
"RTN","RCDPEWL8",10,0)
 I '$G(^TMP("RCDPE_EOB_SPLIT_OK",$J)) D  Q
"RTN","RCDPEWL8",11,0)
 . S VALMBCK="R"
"RTN","RCDPEWL8",12,0)
 . F Z=2,3 S RCTOT(Z)=$$TOT^RCDPEWL3(Z,.RCSPLIT)
"RTN","RCDPEWL8",13,0)
 . S DIR(0)="EA"
"RTN","RCDPEWL8",14,0)
 . S DIR("A",1)="TOTAL "_$S(+RCTOT(2)'=+$P(RCDIR,U,2):"PAYMENTS",1:"ADJUSTMENTS")_$S(+RCTOT(3)=+$P(RCDIR,U,3):"",+RCTOT(2)'=+$P(RCDIR,U,2):" AND ADJUSTMENTS",1:"")_" DO NOT MATCH THE ORIGINAL AMOUNT(s):"
"RTN","RCDPEWL8",15,0)
 . S DIR("A",2)=$E("  ORIG PAY AMT: "_$J(+$P(RCDIR,U,2),"",2)_$J("",35),1,35)_" ORIG ADJ AMT: "_$J(+$P(RCDIR,U,3),"",2)
"RTN","RCDPEWL8",16,0)
 . S DIR("A",3)=$E("   AMT ENTERED: "_$J(+RCTOT(2),"",2)_$J("",35),1,35)_"  AMT ENTERED: "_$J(+RCTOT(3),"",2)
"RTN","RCDPEWL8",17,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",18,0)
 ;
"RTN","RCDPEWL8",19,0)
 S DA(1)=RCSCR
"RTN","RCDPEWL8",20,0)
 S RCZ0=+$P(RCLINE,U,2),RCZZ=+$G(^RCY(344.49,DA(1),1,RCZ0,0)),RCZZ(1)=""
"RTN","RCDPEWL8",21,0)
 S RCZ=+$O(RCSPLIT(0))
"RTN","RCDPEWL8",22,0)
 I RCZ D
"RTN","RCDPEWL8",23,0)
 . S DIE="^RCY(344.49,"_DA(1)_",1,",DA=RCZ0,RCZT=$P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3)
"RTN","RCDPEWL8",24,0)
 . S DR=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.06////"_$J(+RCZT,"",2)_";.08////"_$J($P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",25,0)
 . S DR=DR_";.07///"_$S($P(RCSPLIT(RCZ),U,5):"/"_$P(RCSPLIT(RCZ),U,5),1:"@")_";.03////"_$S(RCZT'<0:$J(+RCZT,"",2),1:"0.00")_$S($P(RCSPLIT(RCZ),U,6)'="":";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@"),1:"")
"RTN","RCDPEWL8",26,0)
 . D ^DIE,UPD^RCDPEWL3(DA(1),DA)
"RTN","RCDPEWL8",27,0)
 . I $P(RCDIR,U,3) D
"RTN","RCDPEWL8",28,0)
 .. N DA
"RTN","RCDPEWL8",29,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ0,DA=1,DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",30,0)
 .. S RCZZ(1)=$G(^RCY(344.49,DA(2),1,DA(1),1,1,0))
"RTN","RCDPEWL8",31,0)
 .. S DR=".03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":".09////"_$P(RCSPLIT(RCZ),U,4),1:"")
"RTN","RCDPEWL8",32,0)
 .. D ^DIE
"RTN","RCDPEWL8",33,0)
 F  S RCZ=$O(RCSPLIT(RCZ)) Q:'RCZ  D
"RTN","RCDPEWL8",34,0)
 . S DIC(0)="L",DLAYGO=344.491,DIC="^RCY(344.49,"_DA(1)_",1,",X=+$O(^RCY(344.49,RCSCR,1,"B",RCZZ\1+.999),-1)+.001
"RTN","RCDPEWL8",35,0)
 . S DIC("DR")=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.08////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_";.06////"_$J($P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",36,0)
 . I $P(RCSPLIT(RCZ),U,6)'="" S DIC("DR")=DIC("DR")_";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@")
"RTN","RCDPEWL8",37,0)
 . I $P(RCSPLIT(RCZ),U,5) S DIC("DR")=DIC("DR")_";.07////"_$P(RCSPLIT(RCZ),U,5)
"RTN","RCDPEWL8",38,0)
 . K DD,DO D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",39,0)
 . S RCZ1=+Y
"RTN","RCDPEWL8",40,0)
 . I Y D UPD^RCDPEWL3(RCSCR,RCZ1)
"RTN","RCDPEWL8",41,0)
 . I Y,$P(RCDIR,U,3) D
"RTN","RCDPEWL8",42,0)
 .. N DA
"RTN","RCDPEWL8",43,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ1,X=1,DIC(0)="L",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",44,0)
 .. S DIC("DR")=".02////"_$P(RCZZ(1),U,2)_";.03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":";.09////"_$P(RCSPLIT(RCZ),U,4),$P(RCZZ(1),U,9)'="":";.09////"_$P(RCZZ(1),U,9),1:"")
"RTN","RCDPEWL8",45,0)
 .. F Z=4:1:8 I $P(RCZZ(1),U,Z)'="" S DIC("DR")=DIC("DR")_";"_(Z/100)_"////"_$P(RCZZ(1),U,Z)
"RTN","RCDPEWL8",46,0)
 .. D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",47,0)
 K ^TMP($J,"RCDPE_SPLIT_FILE")
"RTN","RCDPEWL8",48,0)
 S VALMBCK="Q"
"RTN","RCDPEWL8",49,0)
 Q
"RTN","RCDPEWL8",50,0)
 ;
"RTN","RCDPEWL8",51,0)
SELBAT(RCERA,RCQUIT) ; Select a batch
"RTN","RCDPEWL8",52,0)
 ; If batch is selected, global ^TMP("RCBATCH_SELECTED",$J) is set = 
"RTN","RCDPEWL8",53,0)
 ;   batch ien selected
"RTN","RCDPEWL8",54,0)
 ; RCQUIT = 1 if selection not made
"RTN","RCDPEWL8",55,0)
 N RCBAT,DA,DIE,X,Y,DIC,DUOUT,DTOUT,DIR,DR
"RTN","RCDPEWL8",56,0)
 S RCQUIT=0
"RTN","RCDPEWL8",57,0)
 S DA(1)=RCERA,DIC(0)="AEMQ",DIC="^RCY(344.49,"_DA(1)_",3,",DIC("S")="I '$P(^(0),U,5)" D ^DIC
"RTN","RCDPEWL8",58,0)
 I Y'>0 S RCQUIT=1 Q
"RTN","RCDPEWL8",59,0)
 S RCBAT=+Y
"RTN","RCDPEWL8",60,0)
 L +^RCY(344.4,RCERA,0):5 I '$T S DIR("A",1)="ANOTHER USER HAS JUST ACCESSED THE ENTIRE ERA - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",61,0)
 L +^RCY(344.49,RCERA,3,RCBAT,0):5 I '$T!$P($G(^(0)),U,5) S DIR("A",1)="ANOTHER USER HAS JUST OPENED THIS BATCH - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)=-"EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",62,0)
 S DA=RCBAT,DA(1)=RCERA,DIE="^RCY(344.49,"_DA(1)_",3,",DR=".05////1" D ^DIE L -^RCY(344.49,RCERA,3,RCBAT,0)
"RTN","RCDPEWL8",63,0)
 I $P($G(^RCY(344.49,RCERA,3,RCBAT,0)),U,3) D
"RTN","RCDPEWL8",64,0)
 . S DIR(0)="EA",DIR("A",1)="** WARNING - THIS BATCH HAS BEEN FLAGGED AS READY TO POST",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",65,0)
 S ^TMP("RCBATCH_SELECTED",$J)=RCBAT
"RTN","RCDPEWL8",66,0)
 L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL8",67,0)
 Q
"RTN","RCDPEWL8",68,0)
 ;
"RTN","RCDPEWL8",69,0)
SORT ; Select a new sort for the list of ERAs
"RTN","RCDPEWL8",70,0)
 D FULL^VALM1
"RTN","RCDPEWL8",71,0)
 N RCSORT,DUOUT,DTOUT,DIR,X,Y,RCS1,RCS2,RCORD
"RTN","RCDPEWL8",72,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",73,0)
 S DIR("L",1)="  SELECT A FIRST LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",74,0)
 S DIR("L",3)="    A  AMOUNT PAID      E  ERA PAID DATE"
"RTN","RCDPEWL8",75,0)
 S DIR("L")="    P  PAYER NAME       D  DATE ERA RECEIVED"
"RTN","RCDPEWL8",76,0)
 S DIR(0)="S^A:AMOUNT PAID;E:ERA PAID DATE;P:PAYER NAME;D:DATE ERA RECEIVED",DIR("B")=$P($P(DIR(0),"D:",2),";")
"RTN","RCDPEWL8",77,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL8",78,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",79,0)
 S RCS1=$S(Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",80,0)
 S RCORD=$$ORD(.RCS1)
"RTN","RCDPEWL8",81,0)
 Q:'$D(RCS1)
"RTN","RCDPEWL8",82,0)
 S $P(RCSORT,U)=(RCS1_";"_RCORD)
"RTN","RCDPEWL8",83,0)
 K X
"RTN","RCDPEWL8",84,0)
 S X(1)=$S(RCS1'="AP":"A:AMOUNT PAID",1:"E:ERA PAID DATE")
"RTN","RCDPEWL8",85,0)
 S X(2)=$S(RCS1'="AP"&(RCS1'="DP"):"E:ERA PAID DATE",1:"P:PAYER NAME")
"RTN","RCDPEWL8",86,0)
 S X(3)=$S(RCS1="DR":"P:PAYER NAME",1:"D:DATE ERA RECEIVED")
"RTN","RCDPEWL8",87,0)
 S DIR(0)="S^N:NONE;"_X(1)_";"_X(2)_";"_X(3)
"RTN","RCDPEWL8",88,0)
 S DIR("B")="NONE"
"RTN","RCDPEWL8",89,0)
 S DIR("L",1)="  SELECT A SECOND LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",90,0)
 S DIR("L",3)="    N  NONE"_$J("",13)_$P(X(1),":")_"  "_$P(X(1),":",2)
"RTN","RCDPEWL8",91,0)
 S DIR("L")="    "_$E($P(X(2),":")_"  "_$P(X(2),":",2)_$J("",20),1,20)_$P(X(3),":")_"  "_$P(X(3),":",2)
"RTN","RCDPEWL8",92,0)
 K X W ! D ^DIR K DIR
"RTN","RCDPEWL8",93,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",94,0)
 S RCS2=$S(Y="N":"N",Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",95,0)
 S RCORD=$$ORD(.RCS2)
"RTN","RCDPEWL8",96,0)
 Q:'$D(RCS2)
"RTN","RCDPEWL8",97,0)
 S $P(RCSORT,U,2)=(RCS2_";"_RCORD)
"RTN","RCDPEWL8",98,0)
 K ^TMP($J,"RCERA_LIST") D BLD^RCDPEWL7(RCSORT)
"RTN","RCDPEWL8",99,0)
 Q
"RTN","RCDPEWL8",100,0)
 ;
"RTN","RCDPEWL8",101,0)
ORD(RCS) ; Select an order for the sorted field code in RCS
"RTN","RCDPEWL8",102,0)
 ; Kill RCS if nothing selected, passed by reference
"RTN","RCDPEWL8",103,0)
 ; Returns '-' if reverse order selected
"RTN","RCDPEWL8",104,0)
 N DIR,X,Y,ORD,RCQUIT
"RTN","RCDPEWL8",105,0)
 S RCQUIT=0,ORD=""
"RTN","RCDPEWL8",106,0)
 I RCS="N" G ORDQ
"RTN","RCDPEWL8",107,0)
 I RCS="PN" D  G ORDQ
"RTN","RCDPEWL8",108,0)
 . S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST"
"RTN","RCDPEWL8",109,0)
 . S DIR("B")=$P($P(DIR(0),"F:",2),";")
"RTN","RCDPEWL8",110,0)
 . S DIR("A")="  SORT (F)IRST TO LAST OR (L)AST TO FIRST?: "
"RTN","RCDPEWL8",111,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",112,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",113,0)
 . S ORD=$S(Y="F":"",1:"-")
"RTN","RCDPEWL8",114,0)
 ;
"RTN","RCDPEWL8",115,0)
 I RCS="AP" D  G ORDQ
"RTN","RCDPEWL8",116,0)
 . S DIR("A")="  SORT (L)OWEST TO HIGHEST OR (H)IGHEST TO LOWEST?: "
"RTN","RCDPEWL8",117,0)
 . S DIR(0)="SA^L:LOWEST TO HIGHEST;H:HIGHEST TO LOWEST"
"RTN","RCDPEWL8",118,0)
 . S DIR("B")=$P($P(DIR(0),"L:",2),";")
"RTN","RCDPEWL8",119,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",120,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",121,0)
 . S ORD=$S(Y="L":"",1:"-")
"RTN","RCDPEWL8",122,0)
 ;
"RTN","RCDPEWL8",123,0)
 I RCS="DP"!(RCS="DR") D  G ORDQ
"RTN","RCDPEWL8",124,0)
 . S DIR("A")="  SORT (E)ARLIEST TO LATEST OR (L)ATEST TO EARLIEST?: "
"RTN","RCDPEWL8",125,0)
 . S DIR(0)="SA^E:EARLIEST TO LATEST;L:LATEST TO EARLIEST"
"RTN","RCDPEWL8",126,0)
 . S DIR("B")=$P($P(DIR(0),"E:",2),";")
"RTN","RCDPEWL8",127,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",128,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",129,0)
 . S ORD=$S(Y="E":"",1:"-")
"RTN","RCDPEWL8",130,0)
 ;
"RTN","RCDPEWL8",131,0)
 ; Invalid sort code
"RTN","RCDPEWL8",132,0)
 S RCQUIT=1
"RTN","RCDPEWL8",133,0)
 ;
"RTN","RCDPEWL8",134,0)
ORDQ I RCQUIT K RCS
"RTN","RCDPEWL8",135,0)
 Q ORD
"RTN","RCDPEWL8",136,0)
 ;
"RTN","RCDPEWL8",137,0)
BATDSP ; Ask Display/Hide batch info on ERA list screen
"RTN","RCDPEWL8",138,0)
 N DIR,X,Y,RCZ,DUOUT,DTOUT
"RTN","RCDPEWL8",139,0)
 D FULL^VALM1
"RTN","RCDPEWL8",140,0)
 S RCZ=+$G(^TMP("RCERA_PARAMS",$J,"BATCHON"))
"RTN","RCDPEWL8",141,0)
 S DIR("A",1)="BATCH INFO DISPLAY IS CURRENTLY TURNED "_$S('RCZ:"OFF",1:"ON"),DIR("A")="DO YOU WANT TO TURN IT "_$S('RCZ:"ON",1:"OFF")_" NOW?: "
"RTN","RCDPEWL8",142,0)
 S DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL8",143,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",144,0)
 Q:$D(DUOUT)!$D(DTOUT)!'Y
"RTN","RCDPEWL8",145,0)
 S ^TMP("RCERA_PARAMS",$J,"BATCHON")=$S(RCZ:0,1:1)
"RTN","RCDPEWL8",146,0)
 D BLD^RCDPEWL7($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL8",147,0)
 Q
"RTN","RCDPEWL8",148,0)
 ;
"RTN","RCDPEWL8",149,0)
HASADJ(RCSCR,RCOK) ; Function=1 if WL entry has any adj not yet distributed
"RTN","RCDPEWL8",150,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWL8",151,0)
 ; RCOK = if passed by reference, returns 1 if ANY postable lines exist
"RTN","RCDPEWL8",152,0)
 N Z,Z0,RCSTOP
"RTN","RCDPEWL8",153,0)
 S RCSTOP=0,RCOK=0
"RTN","RCDPEWL8",154,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:RCSTOP
"RTN","RCDPEWL8",155,0)
 . I $P(Z0,U,6)>0!$O(^RCY(344.49,RCSCR,1,Z,1,0)) S RCOK=1 Q
"RTN","RCDPEWL8",156,0)
 . I $P(Z0,U,6)<0 S RCSTOP=1
"RTN","RCDPEWL8",157,0)
 Q RCSTOP
"RTN","RCDPEWL8",158,0)
 ;
"RTN","RCDPEWL8",159,0)
VERIF ; Entrypoint to verification options
"RTN","RCDPEWL8",160,0)
 N DIR,X,Y,RCQUIT,DTOUT,DUOUT
"RTN","RCDPEWL8",161,0)
 D FULL^VALM1
"RTN","RCDPEWL8",162,0)
 ;
"RTN","RCDPEWL8",163,0)
 W !!!!
"RTN","RCDPEWL8",164,0)
 S RCQUIT=0
"RTN","RCDPEWL8",165,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",166,0)
 . W !,"VERIFY EEOBs:",!,?10,"1",$J("",5),"MANUAL MARK AS VERIFIED",!,?10,"2",$J("",5),"REPORT OF UNVERIFIED WITH DISCREPANCIES",!,?10,"3",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",167,0)
 . S DIR(0)="SAO^1:MANUAL VERIFICATION;2:REPORT UNVERIFIED DISCREPANCIES;3:QUIT"
"RTN","RCDPEWL8",168,0)
 . S DIR("A")="Select Action: ",DIR("B")="QUIT" W ! D ^DIR K DIR
"RTN","RCDPEWL8",169,0)
 . I Y=3!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",170,0)
 . ;
"RTN","RCDPEWL8",171,0)
 . I Y=1 D MVER^RCDPEV(RCERA) W !! Q
"RTN","RCDPEWL8",172,0)
 . ;
"RTN","RCDPEWL8",173,0)
 . I Y=2 D RPT^RCDPEV0(RCERA) W !! Q
"RTN","RCDPEWL8",174,0)
 ;
"RTN","RCDPEWL8",175,0)
VERIFQ S VALMBCK="R"
"RTN","RCDPEWL8",176,0)
 Q
"RTN","RCDPEWL8",177,0)
 ;
"RTN","RCDPEWL8",178,0)
BATED ; Entrypoint to batch edit options
"RTN","RCDPEWL8",179,0)
 N DIC,DA,DUOUT,DTOUT,DIR,X,Y,RCQUIT
"RTN","RCDPEWL8",180,0)
 D FULL^VALM1
"RTN","RCDPEWL8",181,0)
 ;
"RTN","RCDPEWL8",182,0)
 W !!!!
"RTN","RCDPEWL8",183,0)
 S RCQUIT=0
"RTN","RCDPEWL8",184,0)
 I '$O(^RCY(344.49,RCERA,3,0)) W !,"***** THERE ARE CURRENTLY NO BATCHES DEFINED FOR THIS ERA *****",!
"RTN","RCDPEWL8",185,0)
 ; No menu if entering from a batch level
"RTN","RCDPEWL8",186,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) W !,"EDITING BATCH #"_+^TMP("RCBATCH_SELECTED",$J) D EDIT^RCDPEWLB(RCERA,+^TMP("RCBATCH_SELECTED",$J)) G BATEDQ
"RTN","RCDPEWL8",187,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",188,0)
 . I '$D(^XUSEC("PRCA ERA BATCH MAINT",DUZ)) D  Q
"RTN","RCDPEWL8",189,0)
 .. S RCQUIT=1
"RTN","RCDPEWL8",190,0)
 .. S DIR(0)="EA",DIR("A")="YOU DO NOT HAVE SECURITY ACCESS TO THIS ACTION - PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",191,0)
 . W !,"BATCH MAINTENANCE:",!,?10,"1",$J("",5),"EDIT BATCH",!,?10,"2",$J("",5),"NEW BATCH ASSIGNMENT",!,?10,"3",$J("",5),"MARK ALL READY TO POST",!,?10,"4",$J("",5),"BATCH SUMMARY REPORT",!,?10,"5",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",192,0)
 . S DIR(0)="SAO^1:EDIT BATCH;2:NEW BATCHES;3:MARK ALL;4:BATCH SUMMARY;5:QUIT"
"RTN","RCDPEWL8",193,0)
 . S DIR("A")="Select Action: ",DIR("B")="Quit" W ! D ^DIR K DIR
"RTN","RCDPEWL8",194,0)
 . I Y="5"!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",195,0)
 . ;
"RTN","RCDPEWL8",196,0)
 . I Y=1 D  W !! Q
"RTN","RCDPEWL8",197,0)
 .. I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET^RCDPEWLC Q
"RTN","RCDPEWL8",198,0)
 .. S DIR("B")="ONE",DIR(0)="SA^A:ALL;O:ONE",DIR("A")="EDIT(A)LL or (O)NE BATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL8",199,0)
 .. I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",200,0)
 .. I Y="A" D EDITALL^RCDPEWLB(RCERA) Q
"RTN","RCDPEWL8",201,0)
 .. S DA(1)=RCERA,DIC="^RCY(344.49,"_DA(1)_",3,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL8",202,0)
 .. Q:Y'>0
"RTN","RCDPEWL8",203,0)
 .. D EDIT^RCDPEWLB(RCERA,+Y)
"RTN","RCDPEWL8",204,0)
 . ;
"RTN","RCDPEWL8",205,0)
 . I Y=2 D REBATCH^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",206,0)
 . ;
"RTN","RCDPEWL8",207,0)
 . I Y=3 D MARKALL^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",208,0)
 . ;
"RTN","RCDPEWL8",209,0)
 . I Y=4 D SUMRPT^RCDPEWLC(RCERA) W !! Q
"RTN","RCDPEWL8",210,0)
 ;
"RTN","RCDPEWL8",211,0)
BATEDQ S VALMBCK="R"
"RTN","RCDPEWL8",212,0)
 Q
"RTN","RCDPEWL8",213,0)
 ;
"RTN","RCDPEWLA")
0^15^B49000254
"RTN","RCDPEWLA",1,0)
RCDPEWLA ;ALB/TMK - ELECTRONIC EOB MESSAGE WORKLIST ;06-FEB-2003
"RTN","RCDPEWLA",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEWLA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWLA",4,0)
ADDLINES(RCSCR) ; Add lines to file 344.49, delete any existing lines
"RTN","RCDPEWLA",5,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWLA",6,0)
 ;
"RTN","RCDPEWLA",7,0)
 N Z,Z0,Q,Q0,Q1,DA,DIK,X,Y,DIE,DO,DD,DR,RC0,RCA,RCA0,RCIFN,RCX,RCADJ,RCDEC,DIC,DLAYGO,RCLINE
"RTN","RCDPEWLA",8,0)
 K ^TMP($J,"RCA")
"RTN","RCDPEWLA",9,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S DA(1)=RCSCR,DA=Z,DIK="^RCY(344.49,"_DA(1)_",1," D ^DIK
"RTN","RCDPEWLA",10,0)
 ;
"RTN","RCDPEWLA",11,0)
 S RC0=$G(^RCY(344.4,RCSCR,0)) ; Entries are DINUMED
"RTN","RCDPEWLA",12,0)
 I $P(RC0,U,5)'="" S DR=".03////"_$P(RC0,U,5),DIE="^RCY(344.49,",DA=RCSCR D ^DIE
"RTN","RCDPEWLA",13,0)
 ;
"RTN","RCDPEWLA",14,0)
 S Z=0 F  S Z=$O(^RCY(344.4,+RC0,1,Z)) Q:'Z  S RCA0=$G(^(Z,0)) I RCA0'="" D  ; Sort the lines to put adjustments with the payments, check sort order
"RTN","RCDPEWLA",15,0)
 . ; for 0-pays
"RTN","RCDPEWLA",16,0)
 . I $P(RCA0,U,2) S RCIFN=+$G(^IBM(361.1,+$P(RCA0,U,2),0)),RCA=$P($G(^DGCR(399,RCIFN,0)),U) ; IA 4051
"RTN","RCDPEWLA",17,0)
 . I '$P(RCA0,U,2) S RCIFN="0;"_Z,RCA=$P(RCA0,U,5)
"RTN","RCDPEWLA",18,0)
 . I RCA="" S RCA=RCIFN
"RTN","RCDPEWLA",19,0)
 . I $D(^TMP($J,"RCA",RCA,+$P(RCA0,U,14))) D
"RTN","RCDPEWLA",20,0)
 .. F Q0=1:1:999 S Q=RCA_";"_$E(1000+Q0,2,4) I '$D(^TMP($J,"RCA",Q,+$P(RCA0,U,14))) S RCA=Q Q
"RTN","RCDPEWLA",21,0)
 . S ^TMP($J,"RCA",RCA,+$P(RCA0,U,14))=RCIFN_U_Z
"RTN","RCDPEWLA",22,0)
 ;
"RTN","RCDPEWLA",23,0)
 S Z=0 F  S Z=$O(^RCY(344.4,+RC0,2,Z)) Q:'Z  S RCA0=$G(^(Z,0)) I RCA0'="" D  ; Extract ERA level adjs
"RTN","RCDPEWLA",24,0)
 . S RCIFN=$P(RCA0,U),RCA="**ADJ"_Z
"RTN","RCDPEWLA",25,0)
 . S ^TMP($J,"RCA",RCA,1)=RCIFN_U_Z
"RTN","RCDPEWLA",26,0)
 ;
"RTN","RCDPEWLA",27,0)
 I $P(RC0,U,9)=-1 D  ; Check dec adj or additional receipt line needed
"RTN","RCDPEWLA",28,0)
 . S Z=+$O(^RCY(344.31,"AERA",RCSCR,0))
"RTN","RCDPEWLA",29,0)
 . Q:'Z
"RTN","RCDPEWLA",30,0)
 . I $P($G(^RCY(344.31,Z,0)),U,7)-$P(RC0,U,5) D  Q
"RTN","RCDPEWLA",31,0)
 .. S ^TMP($J,"RCA","**ADJ0",1)="TOTALS MISMATCH^^"_($P($G(^RCY(344.31,Z,0)),U,7)-$P(RC0,U,5))
"RTN","RCDPEWLA",32,0)
 ;
"RTN","RCDPEWLA",33,0)
 S Z="" F  S Z=$O(^TMP($J,"RCA",Z)) Q:Z=""  S Z0="" F  S Z0=$O(^TMP($J,"RCA",Z,Z0)) Q:Z0=""  D
"RTN","RCDPEWLA",34,0)
 . S Q=$P(Z,";") ; claim #
"RTN","RCDPEWLA",35,0)
 . S Q0=$S($E(Q,1,2)'="**":$G(^RCY(344.4,+RC0,1,+$P(^TMP($J,"RCA",Z,Z0),U,2),0)),Q["ADJ"&($P(Q,"ADJ",2)):$G(^RCY(344.4,+RC0,2,+$P(^TMP($J,"RCA",Z,Z0),U,2),0)),1:$G(^TMP($J,"RCA",Z,Z0)))
"RTN","RCDPEWLA",36,0)
 . ;
"RTN","RCDPEWLA",37,0)
 . S RCDEC=($P(Q0,U,3)<0) ; is this a decrease
"RTN","RCDPEWLA",38,0)
 . I Z0=0 D  Q  ; Add a payment line from the ERA
"RTN","RCDPEWLA",39,0)
 .. K DO,DD
"RTN","RCDPEWLA",40,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",41,0)
 .. S DIC("DR")=".02////"_Q_";.05////"_$P(Q0,U,3)_";.06////"_$P(Q0,U,3)_";.09////"_$P(^TMP($J,"RCA",Z,Z0),U,2)_";.13////0"
"RTN","RCDPEWLA",42,0)
 .. I $G(^TMP($J,"BATCHES")) D
"RTN","RCDPEWLA",43,0)
 ... ; Assign a batch # here
"RTN","RCDPEWLA",44,0)
 ... S DIC("DR")=DIC("DR")_";.14////"_$$GETBATCH^RCDPEWLB(Q0)
"RTN","RCDPEWLA",45,0)
 .. F X=$O(^RCY(344.49,RCSCR,1,"ASEQ"," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,"B",X)) Q
"RTN","RCDPEWLA",46,0)
 .. S RCLINE=X
"RTN","RCDPEWLA",47,0)
 .. D FILE^DICN K DIC,DO,DD
"RTN","RCDPEWLA",48,0)
 .. S ^TMP($J,"RCA",Z)=+Y
"RTN","RCDPEWLA",49,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",50,0)
 .. S DIC("DR")=".02////"_Q_";.05////"_$P(Q0,U,3)_";.06////"_$P(Q0,U,3)_$S($P(^TMP($J,"RCA",Z,Z0),U):";.07////"_$P(^TMP($J,"RCA",Z,Z0),U),1:"")
"RTN","RCDPEWLA",51,0)
 .. S X=RCLINE+.001
"RTN","RCDPEWLA",52,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",53,0)
 .. S $P(^TMP($J,"RCA",Z,0),U,3)=+Y S DA(1)=RCSCR,DA=+^TMP($J,"RCA",Z),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".13////"_+$$VER^RCDPEV(RCSCR,$P(^TMP($J,"RCA",Z,Z0),U),+$P(^TMP($J,"RCA",Z,Z0),U,2)) D ^DIE
"RTN","RCDPEWLA",54,0)
 . ;
"RTN","RCDPEWLA",55,0)
 . I Z0=1,$P($G(^TMP($J,"RCA",Z,0)),U,3) D  Q  ; rev of claim within this ERA
"RTN","RCDPEWLA",56,0)
 .. ; Add adj to line previously added for payment
"RTN","RCDPEWLA",57,0)
 .. K DO,DD
"RTN","RCDPEWLA",58,0)
 .. S DA(2)=RCSCR,DA(1)=+$P($G(^TMP($J,"RCA",Z,0)),U,3),DIC(0)="L",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,",DLAYGO=344.4911,X=+$O(^RCY(344.49,DA(2),1,DA(1),1," "),-1)+1
"RTN","RCDPEWLA",59,0)
 .. S DIC("DR")=".02////"_$S(RCDEC:2,1:4)_";.03////"_$P(Q0,U,3)_";.05////"_$S(RCDEC:"0;.08////1;.06////1",1:"3;.08////0;.06////0")_";.07////"_+Q0_";.13////0"
"RTN","RCDPEWLA",60,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",61,0)
 .. S Q1=$G(^RCY(344.49,RCSCR,1,+$P($G(^TMP($J,"RCA",Z,0)),U,3),0))
"RTN","RCDPEWLA",62,0)
 .. ; Upd net amt
"RTN","RCDPEWLA",63,0)
 .. S DA(1)=RCSCR,DA=+$P($G(^TMP($J,"RCA",Z,0)),U,3),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(Q1,U,6)+$P(Q0,U,3),"",2)_";.08////"_$J($P(Q1,U,8)+$P(Q0,U,3),"",2) D ^DIE
"RTN","RCDPEWLA",64,0)
 .. ;Upd seq ref,net in 'parent'
"RTN","RCDPEWLA",65,0)
 .. I $G(^TMP($J,"RCA",Z)) D
"RTN","RCDPEWLA",66,0)
 ... S DA(1)=RCSCR,DA=+$G(^TMP($J,"RCA",Z)),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".09////"_($P($G(^RCY(344.49,RCSCR,1,DA,0)),U,9)_","_$P(^TMP($J,"RCA",Z,Z0),U,2))_";.06////"_$J($P($G(^RCY(344.49,DA(1),1,DA,0)),U,6)+$P(Q0,U,3),"",2)
"RTN","RCDPEWLA",67,0)
 ... D ^DIE
"RTN","RCDPEWLA",68,0)
 . ;
"RTN","RCDPEWLA",69,0)
 . I Z0=1 D  Q  ; ERA level adj, no payment for claim lev adj or mismatch
"RTN","RCDPEWLA",70,0)
 .. ; Add a line
"RTN","RCDPEWLA",71,0)
 .. K DO,DD
"RTN","RCDPEWLA",72,0)
 .. S RCADJ=$S(Z["**ADJ":1,1:0)
"RTN","RCDPEWLA",73,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",74,0)
 .. S DIC("DR")=$S(Q'=0:".02////"_Q_";",1:"")_".03////0.00;.05////0.00;.13////0"
"RTN","RCDPEWLA",75,0)
 .. F X=$O(^RCY(344.49,RCSCR,1,"ASEQ"," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,"B",X)) L +^RCY(344.49,RCSCR,1,X,0):1 Q:$T
"RTN","RCDPEWLA",76,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",77,0)
 .. S RCLINE=+$P(Y,U,2),^TMP($J,"RCA",Z)=+Y
"RTN","RCDPEWLA",78,0)
 .. ;
"RTN","RCDPEWLA",79,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",80,0)
 .. S DIC("DR")=$S('RCADJ:".02///"_$P(Z,";")_";",1:"")_".03////0.00;.05////0.00;.06////0.00"_$S($P(^TMP($J,"RCA",Z,Z0),U)&'RCADJ:";.07////"_$P(^TMP($J,"RCA",Z,Z0),U),1:"")
"RTN","RCDPEWLA",81,0)
 .. S X=RCLINE+.001
"RTN","RCDPEWLA",82,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",83,0)
 .. L -^RCY(344.49,RCSCR,1,RCLINE,0)
"RTN","RCDPEWLA",84,0)
 .. S RCLINE=+Y
"RTN","RCDPEWLA",85,0)
 .. ; Add adj record
"RTN","RCDPEWLA",86,0)
 .. S DIC(0)="L",DLAYGO=344.4911,DA(2)=RCSCR,DA(1)=RCLINE,DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWLA",87,0)
 .. S DIC("DR")=".02////"_$S(RCDEC:2+RCADJ,1:4+RCADJ)_";.03////"_$P(Q0,U,3)_";.05////"_$S('RCDEC:"3;.06////0;.08////0",1:"0;.06////1;.08////1")_";.07////"_$S(RCADJ:Z_";.04////"_$P(^TMP($J,"RCA",Z,Z0),U),1:+$P(^TMP($J,"RCA",Z,Z0),U,2))
"RTN","RCDPEWLA",88,0)
 .. F RCX=$O(^RCY(344.49,RCSCR,1,RCLINE,1," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,1,RCLINE,1,X,0)) L +^RCY(344.49,RCSCR,1,RCLINE,1,RCX,0):1 Q:$T
"RTN","RCDPEWLA",89,0)
 .. S X=RCX
"RTN","RCDPEWLA",90,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",91,0)
 .. L -^RCY(344.49,RCSCR,1,RCLINE,1,RCX,0)
"RTN","RCDPEWLA",92,0)
 .. S DA(1)=RCSCR,DA=RCLINE,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$P(Q0,U,3)_";.08////"_$P(Q0,U,3) D ^DIE
"RTN","RCDPEWLA",93,0)
 .. S Q1=$G(^RCY(344.49,RCSCR,1,RCLINE,0))
"RTN","RCDPEWLA",94,0)
 .. ; Upd seq ref,adj,payment in 'parent'
"RTN","RCDPEWLA",95,0)
 .. I $G(^TMP($J,"RCA",Z)) D
"RTN","RCDPEWLA",96,0)
 ... S DA(1)=RCSCR,DA=+^TMP($J,"RCA",Z),DIE="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",97,0)
 ... S DR=".09////"_$S(RCADJ:$S($P(Z,"**ADJ",2):$P(Z,"**",2),1:"TOTALS MISMATCH"),1:$P(^TMP($J,"RCA",Z,Z0),U,2))_";.06////"_$J($P($G(^RCY(344.49,DA(1),1,DA,0)),U,6)+$P(Q0,U,3),"",2)_";.08////"_$P(Q0,U,3)
"RTN","RCDPEWLA",98,0)
 ... D ^DIE
"RTN","RCDPEWLA",99,0)
 ;
"RTN","RCDPEWLA",100,0)
 K ^TMP($J,"RCA")
"RTN","RCDPEWLA",101,0)
 Q
"RTN","RCDPEWLA",102,0)
 ;
"RTN","RCDPEWLA",103,0)
SELSORT(RCQUIT) ; Function returns selection of sort for worklist entries
"RTN","RCDPEWLA",104,0)
 ; RCQUIT returned = 1 if passed by ref and user aborts question
"RTN","RCDPEWLA",105,0)
 ; RCSCR is assumed to be the ien of the entry in file 344.49
"RTN","RCDPEWLA",106,0)
 N DIR,X,Y,DTOUT,DUOUT,RCLSTORD,RCUSPREF,DA,DIE,DR,RCY
"RTN","RCDPEWLA",107,0)
 S RCQUIT=0
"RTN","RCDPEWLA",108,0)
 S RCUSPREF=+$O(^RCY(344.49,RCSCR,2,"B",DUZ,0))
"RTN","RCDPEWLA",109,0)
 I 'RCUSPREF D  ; Add the user pref record
"RTN","RCDPEWLA",110,0)
 . S RCUSPREF=+$$ADDUSER^RCDPEWL5(RCSCR,DUZ)
"RTN","RCDPEWLA",111,0)
 S RCLSTORD=$P($G(^RCY(344.49,RCSCR,2,RCUSPREF,0)),U,3)
"RTN","RCDPEWLA",112,0)
 S DIR(0)="344.492,.03A",DIR("A")="ORDER OF PAYMENTS: ",DIR("B")=$S(RCLSTORD'="":$$EXTERNAL^DILFD(344.492,.03,"",RCLSTORD),1:$$EXTERNAL^DILFD(344.492,.03,"","N")) W ! D ^DIR K DIR
"RTN","RCDPEWLA",113,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1,Y=""
"RTN","RCDPEWLA",114,0)
 S RCY=Y
"RTN","RCDPEWLA",115,0)
 I 'RCQUIT D
"RTN","RCDPEWLA",116,0)
 . S $P(^TMP($J,"RC_SORTPARM"),U)=RCY
"RTN","RCDPEWLA",117,0)
 . S DA(1)=RCSCR,DA=RCUSPREF
"RTN","RCDPEWLA",118,0)
 . I DA,$P(^TMP($J,"RC_SORTPARM"),U)'=RCLSTORD S DIE="^RCY(344.49,"_DA(1)_",2,",DR=".03////"_$P($G(^TMP($J,"RC_SORTPARM")),U) D ^DIE ; Update user preferences
"RTN","RCDPEWLA",119,0)
 Q RCY
"RTN","RCDPEWLA",120,0)
 ;
"RTN","RCDPEWLA",121,0)
TOOOLD(RCDEP) ; Check if deposit in ien RCDPE (file 344.1) is too old to use
"RTN","RCDPEWLA",122,0)
 N RCOLD,Q,DIR,X,Y
"RTN","RCDPEWLA",123,0)
 S Q=$$FMADD^XLFDT(DT,-7),RCOLD=0
"RTN","RCDPEWLA",124,0)
 I $P($G(^RCY(344.1,RCDEP,0)),U,3)<Q D
"RTN","RCDPEWLA",125,0)
 . S DIR("A",1)="THIS DEPOSIT WAS OPENED MORE THAN ONE WEEK AGO ("_$$FMTE^XLFDT($P($G(^RCY(344.1,RCDEP,0)),U,3),2)_")",DIR("A")="ARE YOU SURE YOU WANT TO USE THIS DEPOSIT?: ",DIR("B")="NO",DIR(0)="YA" W ! D ^DIR K DIR
"RTN","RCDPEWLA",126,0)
 . I Y'=1 S RCOLD=1
"RTN","RCDPEWLA",127,0)
 Q RCOLD
"RTN","RCDPEWLA",128,0)
 ;
"RTN","RCDPEWLB")
0^17^B46624897
"RTN","RCDPEWLB",1,0)
RCDPEWLB ;ALB/TMK - EEOB WORKLIST BATCH PROCESSING ;10-FEB-2004
"RTN","RCDPEWLB",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEWLB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWLB",4,0)
 ;
"RTN","RCDPEWLB",5,0)
SETBATCH(RCERA) ; Set up batches for a worklist entry RCERA
"RTN","RCDPEWLB",6,0)
 ; Returns ^TMP($J,"BATCHES",batch criteria code,start param data)=
"RTN","RCDPEWLB",7,0)
 ;              batch #^end param data
"RTN","RCDPEWLB",8,0)
 ; Ask to split the ERA
"RTN","RCDPEWLB",9,0)
 N DIR,DUOUT,DTOUT,X,Y,Z,Z0,RCNUM,RCY,RCBAT,RCSEL,RCZ,RCNAMES,RCS
"RTN","RCDPEWLB",10,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWLB",11,0)
 S RCNUM=+$$CTEEOB(RCERA)
"RTN","RCDPEWLB",12,0)
 Q:RCNUM'>1
"RTN","RCDPEWLB",13,0)
 S DIR("A",1)="THERE ARE APPROXIMATELY "_RCNUM_" EEOBS IN THIS ERA",DIR("A")="DO YOU WANT TO SPLIT THIS ERA INTO BATCHES?: ",DIR(0)="YA",DIR("B")=$S(RCNUM>30:"YES",1:"NO") W ! D ^DIR K DIR
"RTN","RCDPEWLB",14,0)
 I Y'=1 Q
"RTN","RCDPEWLB",15,0)
 ;
"RTN","RCDPEWLB",16,0)
 S DIR("A",1)="YOU MAY USE ANY ONE OF THE FOLLOWING CRITERIA TO SPLIT THE ERA INTO BATCHES: ",DIR("A",2)=" ",DIR("A",3)=$J("",10)_"1 - BY MAX # OF EEOBs TO INCLUDE IN A BATCH"
"RTN","RCDPEWLB",17,0)
 S DIR("A",4)=$J("",10)_"2 - BY RANGES OF PATIENT LAST NAME",DIR("A",5)=$J("",10)_"3 - BY EEOB PAYMENT STATUS (FULL/PARTIAL/NO PAY)"
"RTN","RCDPEWLB",18,0)
 S DIR("A",6)=$J("",10)_"4 - BY CO-PAY AND NON-COPAY FOR THE DATE OF SERVICE",DIR("A",7)=" "
"RTN","RCDPEWLB",19,0)
 S DIR(0)="SAO^1:MAX #;2:LAST NAME;3:PAY STATUS;4:CO-PAY STATUS",DIR("A")="CRITERIA SELECTION: "
"RTN","RCDPEWLB",20,0)
 W !! D ^DIR K DIR
"RTN","RCDPEWLB",21,0)
 Q:$D(DUOUT)!$D(DTOUT)!(Y="")
"RTN","RCDPEWLB",22,0)
 S RCBAT=0,RCSEL=Y,^TMP($J,"BATCHES")=RCSEL
"RTN","RCDPEWLB",23,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO NAME YOUR OWN BATCHES?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWLB",24,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RCDPEWLB",25,0)
 S RCNAMES=+Y
"RTN","RCDPEWLB",26,0)
 I RCSEL=1 D
"RTN","RCDPEWLB",27,0)
 . W ! S DIR(0)="NA^1:"_RCNUM,DIR("A")="MAX # OF EEOBS TO INCLUDE IN A BATCH: ",DIR("?")="ENTER A NUMBER FROM 1 TO "_RCNUM D ^DIR K DIR
"RTN","RCDPEWLB",28,0)
 . I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWLB",29,0)
 . S RCY=Y
"RTN","RCDPEWLB",30,0)
 . F RCZ=1:1:RCNUM\RCY+$S(RCNUM#RCY:1,1:0) S RCS=((RCZ-1)*RCY)+1 D NEWBAT(RCERA,1,"",RCS_U_(RCS+RCY-1),.RCBAT,RCNAMES) S ^TMP($J,"BATCHES",1,RCS)=RCBAT_U_(RCS+RCY-1)
"RTN","RCDPEWLB",31,0)
 ;
"RTN","RCDPEWLB",32,0)
 I RCSEL=2 D
"RTN","RCDPEWLB",33,0)
 . N RCNMF,RCQUIT,RCDONE
"RTN","RCDPEWLB",34,0)
 . S RCNMF="A",(RCQUIT,RCDONE)=0
"RTN","RCDPEWLB",35,0)
 . F  D  Q:RCQUIT!RCDONE
"RTN","RCDPEWLB",36,0)
 .. W !!,"START FROM LAST NAME BEGINNING WITH: ",RCNMF
"RTN","RCDPEWLB",37,0)
 .. S DIR("?")="ENTER A LETTER IN UPPERCASE"
"RTN","RCDPEWLB",38,0)
 .. S DIR(0)="FA^1:1^K:X'?.U X",DIR("A")="INCLUDE THROUGH LAST NAME BEGINNING WITH: " D ^DIR K DIR
"RTN","RCDPEWLB",39,0)
 .. I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWLB",40,0)
 .. S RCY=Y,RCSEL("NAME",RCNMF)=Y_"ZZZ"
"RTN","RCDPEWLB",41,0)
 .. I $A(RCY)=90 S RCDONE=1 Q
"RTN","RCDPEWLB",42,0)
 .. S RCNMF=$A(RCY)+1,RCNMF=$C(RCNMF)
"RTN","RCDPEWLB",43,0)
 . Q:RCQUIT
"RTN","RCDPEWLB",44,0)
 . S Z="" F  S Z=$O(RCSEL("NAME",Z)) Q:Z=""  D NEWBAT(RCERA,2,"",Z_U_RCSEL("NAME",Z),.RCBAT,RCNAMES) S ^TMP($J,"BATCHES",2,Z)=RCBAT_U_RCSEL("NAME",Z)
"RTN","RCDPEWLB",45,0)
 ;
"RTN","RCDPEWLB",46,0)
 I RCSEL=3 D
"RTN","RCDPEWLB",47,0)
 . F Y=1:1:3 D NEWBAT(RCERA,3,$P("FULL PAYMENT^PARTIAL PAYMENT^NO PAYMENT",U,Y),Y,.RCBAT,RCNAMES) S ^TMP($J,"BATCHES",3,Y)=RCBAT
"RTN","RCDPEWLB",48,0)
 ;
"RTN","RCDPEWLB",49,0)
 I RCSEL=4 D
"RTN","RCDPEWLB",50,0)
 . F Y=1,2 D NEWBAT(RCERA,RCSEL,$P("CO-PAY EXISTS^NO CO-PAY EXISTS",U,Y),Y,.RCBAT,RCNAMES) S ^TMP($J,"BATCHES",4,Y)=RCBAT
"RTN","RCDPEWLB",51,0)
 ;
"RTN","RCDPEWLB",52,0)
 S DIR(0)="EA",DIR("A")=RCBAT_" BATCHES CREATED.  PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWLB",53,0)
 Q
"RTN","RCDPEWLB",54,0)
 ;
"RTN","RCDPEWLB",55,0)
NEWBAT(RCERA,RCSEL,RCDAT,RCVAL,RCBAT,RCNAMES) ; Add a new batch at the top level entry
"RTN","RCDPEWLB",56,0)
 ; RCERA = the ien of the entry in file 344.49
"RTN","RCDPEWLB",57,0)
 ; RCSEL = the # of the selection criteria selected
"RTN","RCDPEWLB",58,0)
 ; RCDAT = the default 'name' of the batch based on the criteria used
"RTN","RCDPEWLB",59,0)
 ; RCVAL = the start value^the end value
"RTN","RCDPEWLB",60,0)
 ; RCBAT = if passed by reference, returned as the next batch #
"RTN","RCDPEWLB",61,0)
 ; RCNAMES = 1 if user wants to name each batch, 0 to accept default
"RTN","RCDPEWLB",62,0)
 ;
"RTN","RCDPEWLB",63,0)
 N DA,DR,DIC,X,Y,DLAYGO,DD,DO
"RTN","RCDPEWLB",64,0)
 S RCBAT=RCBAT+1
"RTN","RCDPEWLB",65,0)
 S DA(1)=RCERA,DIC="^RCY(344.49,"_DA(1)_",3,",DLAYGO=344.493,DIC(0)="L",X=RCBAT
"RTN","RCDPEWLB",66,0)
 I $G(RCNAMES) W !!,"**BATCH #: "_RCBAT
"RTN","RCDPEWLB",67,0)
 S DIC("DR")=".03////0;.04////"_DUZ_";.05////0;.06////"_RCSEL_";.07////"_$P(RCVAL,U)_$S($P(RCVAL,U,2)'="":";.08////"_$P(RCVAL,U,2),1:"")
"RTN","RCDPEWLB",68,0)
 S DIC("DR")=DIC("DR")_";.02R//"_$S(RCNAMES:"",1:"//")_$S(RCSEL=1:"BATCH #: "_RCBAT,RCSEL=2:"LAST NAME FROM "_$P(RCVAL,U)_" - "_$P(RCVAL,U,2),1:RCDAT)
"RTN","RCDPEWLB",69,0)
 D FILE^DICN K DLAYGO,DIC,DD,DO W !
"RTN","RCDPEWLB",70,0)
 Q
"RTN","RCDPEWLB",71,0)
 ;
"RTN","RCDPEWLB",72,0)
GETBATCH(RCZ0) ; Returns the batch # to be assigned to the data in RCZ0
"RTN","RCDPEWLB",73,0)
 ; RCZ0 = 0-node of the entry in file 344.41 to be assigned to a batch
"RTN","RCDPEWLB",74,0)
 N BNUM,Z,Z0
"RTN","RCDPEWLB",75,0)
 S BNUM=""
"RTN","RCDPEWLB",76,0)
 I $G(^TMP($J,"BATCHES"))=1 D  ; Max #
"RTN","RCDPEWLB",77,0)
 . N CT
"RTN","RCDPEWLB",78,0)
 . S CT=+$G(^TMP($J,"BATCHES","CT"))+1
"RTN","RCDPEWLB",79,0)
 . S ^TMP($J,"BATCHES","CT")=CT
"RTN","RCDPEWLB",80,0)
 . S Z=+$O(^TMP($J,"BATCHES",1,CT+1),-1),BNUM=+$G(^TMP($J,"BATCHES",1,Z)) S:'BNUM BNUM=1
"RTN","RCDPEWLB",81,0)
 ;
"RTN","RCDPEWLB",82,0)
 I $G(^TMP($J,"BATCHES"))=2 D  ; last name
"RTN","RCDPEWLB",83,0)
 . S Z=$P(RCZ0,U,15)
"RTN","RCDPEWLB",84,0)
 . I $P(RCZ0,U,2) S Z0=$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(RCZ0,U,2),0)),0)),U,2),Z0=$P($G(^DPT(Z0,0)),U) I Z0'="" S Z=Z0
"RTN","RCDPEWLB",85,0)
 . S Z0=$A($E(Z))-1,Z0=$C(Z0),Z0=$O(^TMP($J,"BATCHES",2,Z0),-1)
"RTN","RCDPEWLB",86,0)
 . S BNUM=$S(Z0="":1,1:+$G(^TMP($J,"BATCHES",2,Z0))) S:'BNUM BNUM=1
"RTN","RCDPEWLB",87,0)
 ;
"RTN","RCDPEWLB",88,0)
 I $G(^TMP($J,"BATCHES"))=3 D  ; payment amount
"RTN","RCDPEWLB",89,0)
 . S Z=+$P(RCZ0,U,3)
"RTN","RCDPEWLB",90,0)
 . I Z'>0!'$P(RCZ0,U,2) S BNUM=3 Q  ; 0-PAY/ADJUSTMENT/UNKNOWN CLAIM
"RTN","RCDPEWLB",91,0)
 . I +$P($G(^IBM(361.1,+$P(RCZ0,U,2))),U,4)'>+Z S BNUM=1 Q  ; FULL PAY
"RTN","RCDPEWLB",92,0)
 . S BNUM=2 ; PARTIAL PAY
"RTN","RCDPEWLB",93,0)
 ;
"RTN","RCDPEWLB",94,0)
 I $G(^TMP($J,"BATCHES"))=4 D  ; Co-pay/not
"RTN","RCDPEWLB",95,0)
 . S BNUM=2
"RTN","RCDPEWLB",96,0)
 . Q:'$P(RCZ0,U,2)
"RTN","RCDPEWLB",97,0)
 . I $$COPAY^RCDPEWL1(+$G(^IBM(361.1,+$P(RCZ0,U,2),0))) S BNUM=1
"RTN","RCDPEWLB",98,0)
 ;
"RTN","RCDPEWLB",99,0)
 Q BNUM
"RTN","RCDPEWLB",100,0)
 ;
"RTN","RCDPEWLB",101,0)
EDIT(RCERA,RCB,ABORT) ; Edit name and posting status of an existing batch
"RTN","RCDPEWLB",102,0)
 ; RCERA = the ien of the worklist entry
"RTN","RCDPEWLB",103,0)
 ; RCB = the ien of the current batch
"RTN","RCDPEWLB",104,0)
 ; RCABORT = if passed by reference, returned as 1 if user aborts
"RTN","RCDPEWLB",105,0)
 N DA,DIE,DR,X,Y
"RTN","RCDPEWLB",106,0)
 D FULL^VALM1
"RTN","RCDPEWLB",107,0)
 S ABORT=0
"RTN","RCDPEWLB",108,0)
 S DA(1)=RCERA,DA=RCB,DIE="^RCY(344.49,"_DA(1)_",3,",DR=".02;.03" D ^DIE I $D(Y) S ABORT=1
"RTN","RCDPEWLB",109,0)
 K VALMHDR ; Used to rebuild the header
"RTN","RCDPEWLB",110,0)
 S VALMBCK="R"
"RTN","RCDPEWLB",111,0)
 Q
"RTN","RCDPEWLB",112,0)
 ;
"RTN","RCDPEWLB",113,0)
MARKALL(RCERA) ; Mark all batches as ready to post
"RTN","RCDPEWLB",114,0)
 N DIR,X,Y,Z,RCT,DA,DIE,DR
"RTN","RCDPEWLB",115,0)
 D FULL^VALM1
"RTN","RCDPEWLB",116,0)
 S VALMBCK="R"
"RTN","RCDPEWLB",117,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL S VALMBCK="R" Q
"RTN","RCDPEWLB",118,0)
 I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET^RCDPEWLC Q
"RTN","RCDPEWLB",119,0)
 S DIR(0)="YA",DIR("A",1)="THIS ACTION WILL MARK ALL BATCHES FOR THIS ERA AS READY TO POST",DIR("A")="ARE YOU SURE YOU WANT TO DO THIS?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWLB",120,0)
 S RCT=0
"RTN","RCDPEWLB",121,0)
 I Y D
"RTN","RCDPEWLB",122,0)
 . S Z=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z  I '$P($G(^(Z,0)),U,3) S RCT=RCT+1,DA(1)=RCERA,DA=Z,DIE="^RCY(344.49,"_DA(1)_",3,",DR=".03////1" D ^DIE
"RTN","RCDPEWLB",123,0)
 . W !!,RCT," BATCHES CHANGED TO READY TO POST",!,"ALL BATCHES ARE NOW READY TO POST"
"RTN","RCDPEWLB",124,0)
 . S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWLB",125,0)
 . K VALMHDR
"RTN","RCDPEWLB",126,0)
 Q
"RTN","RCDPEWLB",127,0)
 ;
"RTN","RCDPEWLB",128,0)
EDITALL(RCERA) ; Edit all batches
"RTN","RCDPEWLB",129,0)
 N Z,RCQUIT
"RTN","RCDPEWLB",130,0)
 D FULL^VALM1
"RTN","RCDPEWLB",131,0)
 S VALMBCK="R"
"RTN","RCDPEWLB",132,0)
 W !
"RTN","RCDPEWLB",133,0)
 I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET^RCDPEWLC Q
"RTN","RCDPEWLB",134,0)
 S (RCQUIT,Z)=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z  W !!,"BATCH #: "_+$G(^(Z,0)) D EDIT(RCERA,Z,.RCQUIT) Q:RCQUIT
"RTN","RCDPEWLB",135,0)
 Q
"RTN","RCDPEWLB",136,0)
 ;
"RTN","RCDPEWLB",137,0)
REBATCH(RCERA) ; Allow to recreate batches
"RTN","RCDPEWLB",138,0)
 N DIR,X,Y,Z,Z0,RCQUIT,DA,DR,DIE,DIK,RCLINE
"RTN","RCDPEWLB",139,0)
 D FULL^VALM1
"RTN","RCDPEWLB",140,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G REBQ
"RTN","RCDPEWLB",141,0)
 ;
"RTN","RCDPEWLB",142,0)
 I '$O(^RCY(344.49,RCERA,3,0)) W !!," ***** THIS ERA CURRENTLY HAS NO BATCHES DEFINED *****"
"RTN","RCDPEWLB",143,0)
 ;
"RTN","RCDPEWLB",144,0)
 S RCQUIT=0
"RTN","RCDPEWLB",145,0)
 I $O(^RCY(344.49,RCERA,3,0)) D  G:RCQUIT REBQ
"RTN","RCDPEWLB",146,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="THIS ACTION REMOVES ALL BATCH REFERENCES.  THE BATCHES CAN THEN BE REBUILT.",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: " W ! D ^DIR K DIR
"RTN","RCDPEWLB",147,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEWLB",148,0)
 . S Z=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z  S DA(1)=RCERA,DIK="^RCY(344.49,"_DA(1)_",3,",DA=Z D ^DIK
"RTN","RCDPEWLB",149,0)
 ;
"RTN","RCDPEWLB",150,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWLB",151,0)
 D SETBATCH(RCERA)
"RTN","RCDPEWLB",152,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCERA,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) I +Z0'["." D
"RTN","RCDPEWLB",153,0)
 . S RCLINE=$G(^RCY(344.4,RCERA,1,+$P(Z0,U,9),0)),DA(1)=RCERA,DIE="^RCY(344.49,"_DA(1)_",1,",DA=Z,DR=".14///"_$S(RCLINE="":"@",1:"/"_$$GETBATCH^RCDPEWLB(RCLINE)) D ^DIE
"RTN","RCDPEWLB",154,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWLB",155,0)
REBQ S VALMBCK="R"
"RTN","RCDPEWLB",156,0)
 Q
"RTN","RCDPEWLB",157,0)
 ;
"RTN","RCDPEWLB",158,0)
CTEEOB(RCERA) ; Returns the approx # of EEOBs in ERA ien RCERA (file 344.4)
"RTN","RCDPEWLB",159,0)
 N RCNUM,Z
"RTN","RCDPEWLB",160,0)
 S (RCNUM,Z)=0 F  S Z=$O(^RCY(344.4,RCERA,1,Z)) Q:'Z  I $P($G(^(Z,0)),U,3)'<0 S RCNUM=RCNUM+1
"RTN","RCDPEWLB",161,0)
 Q RCNUM
"RTN","RCDPEWLB",162,0)
 ;
"RTN","RCDPEWLC")
0^21^B9545338
"RTN","RCDPEWLC",1,0)
RCDPEWLC ;ALB/TMK - EEOB WORKLIST BATCH PROCESSING ;18-FEB-2004
"RTN","RCDPEWLC",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCDPEWLC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEWLC",4,0)
 ;
"RTN","RCDPEWLC",5,0)
SUMRPT(RCERA) ; Produce batch summary report from the ERA worklist for
"RTN","RCDPEWLC",6,0)
 ; ERA worklist entry RCERA
"RTN","RCDPEWLC",7,0)
 N POP,ZTDESC,ZTRTN,ZTQUEUED,%ZIS
"RTN","RCDPEWLC",8,0)
 D FULL^VALM1
"RTN","RCDPEWLC",9,0)
 I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET Q
"RTN","RCDPEWLC",10,0)
 ; Ask device
"RTN","RCDPEWLC",11,0)
 S %ZIS="QM" D ^%ZIS G:POP SUMRPTQ
"RTN","RCDPEWLC",12,0)
 I $D(IO("Q")) D  G SUMRPTQ
"RTN","RCDPEWLC",13,0)
 . S ZTRTN="RPTOUT^RCDPEWLC("_RCERA_")",ZTDESC="AR - EDI LOCKBOX BATCH SUMMARY REPORT"
"RTN","RCDPEWLC",14,0)
 . D ^%ZTLOAD
"RTN","RCDPEWLC",15,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEWLC",16,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEWLC",17,0)
 U IO
"RTN","RCDPEWLC",18,0)
 D RPTOUT(RCERA)
"RTN","RCDPEWLC",19,0)
SUMRPTQ Q
"RTN","RCDPEWLC",20,0)
 ;
"RTN","RCDPEWLC",21,0)
RPTOUT(RCERA) ; Queued job entrypoint
"RTN","RCDPEWLC",22,0)
 N RCPG,RCSTOP,RCT,RCHAS,Q,Z,Z0
"RTN","RCDPEWLC",23,0)
 S (RCPG,RCSTOP,RCHAS)=0
"RTN","RCDPEWLC",24,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z!RCSTOP  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWLC",25,0)
 . I 'RCPG!(($Y+5)>IOSL) D HDR(.RCPG,RCERA,.RCSTOP)
"RTN","RCDPEWLC",26,0)
 . Q:RCSTOP
"RTN","RCDPEWLC",27,0)
 . S RCHAS=1,RCT=0
"RTN","RCDPEWLC",28,0)
 . S Q=0 F  S Q=$O(^RCY(344.49,RCERA,1,"ABAT",+Z0,Q)) Q:'Q  S RCT=RCT+1
"RTN","RCDPEWLC",29,0)
 . W !,$J(+Z0,7)_"  "_$E($P(Z0,U,2)_$J("",30),1,30)_"  "_$P("NO ^YES",U,$P(Z0,U,3)+1)_$J("",13)_$P($G(^VA(200,+$P(Z0,U,4),0)),U)
"RTN","RCDPEWLC",30,0)
 . W !,$J("",9)_"# RECORDS: "_RCT_"  CRITERIA: "_$$EXTERNAL^DILFD(344.493,.06,"",$P(Z0,U,6))
"RTN","RCDPEWLC",31,0)
 . I $P(Z0,U,6)<3 W " FROM: "_$P(Z0,U,7)_" TO: "_$P(Z0,U,8)
"RTN","RCDPEWLC",32,0)
 . I $P(Z0,U,6)=3 W "  "_$P("PARTIAL^FULL^NO",U,+Z0)_" PAYMENT"
"RTN","RCDPEWLC",33,0)
 . I $P(Z0,U,6)=4 W "  "_$P("CO-PAY^NO CO-PAY",U,+Z0)
"RTN","RCDPEWLC",34,0)
 ;
"RTN","RCDPEWLC",35,0)
 I 'RCHAS D:'RCPG HDR(.RCPG,RCERA,.RCSTOP) W !,"THERE ARE NO BATCHES DEFINED FOR THIS ERA"
"RTN","RCDPEWLC",36,0)
 I '$D(ZTQUEUED),'RCSTOP,RCPG D ASK()
"RTN","RCDPEWLC",37,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEWLC",38,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEWLC",39,0)
 Q
"RTN","RCDPEWLC",40,0)
 ;
"RTN","RCDPEWLC",41,0)
NOTSET ;
"RTN","RCDPEWLC",42,0)
 N DIR,X,Y
"RTN","RCDPEWLC",43,0)
 S DIR(0)="EA",DIR("A",1)="THERE ARE NO BATCHES ASSIGNED TO THIS ERA",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWLC",44,0)
 S VALMBCK="R"
"RTN","RCDPEWLC",45,0)
 Q
"RTN","RCDPEWLC",46,0)
 ;
"RTN","RCDPEWLC",47,0)
HDR(RCPG,RCSCR,RCSTOP) ;Print report hdr
"RTN","RCDPEWLC",48,0)
 ; RCPG = last page #
"RTN","RCDPEWLC",49,0)
 ; RCSCR = the entry # in file 344.49
"RTN","RCDPEWLC",50,0)
 ; RCSTOP = returned as 1 if abort is detected
"RTN","RCDPEWLC",51,0)
 N RCZ0
"RTN","RCDPEWLC",52,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ W:+$G(RCPG) !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEWLC",53,0)
 S RCZ0=$G(^RCY(344.4,RCSCR,0))
"RTN","RCDPEWLC",54,0)
 I RCPG&($E(IOST,1,2)="C-") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEWLC",55,0)
 W !,@IOF,*13
"RTN","RCDPEWLC",56,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEWLC",57,0)
 W !,"EDI LBOX WORKLIST - BATCH SUMMARY REPORT",?59,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!
"RTN","RCDPEWLC",58,0)
 W !,"ERA #: ",$E(RCSCR_$J("",29),1,29)_"  TRACE #: "_$P(RCZ0,U,2)
"RTN","RCDPEWLC",59,0)
 W !,"PAYER: "_$E($P(RCZ0,U,6)_$J("",30),1,30)_"  ERA DT: "_$$FMTE^XLFDT($P(RCZ0,U,4),"2D")
"RTN","RCDPEWLC",60,0)
 W !!,"BATCH #  NAME"_$J("",28)_"READY TO POST?  STATUS SET BY"
"RTN","RCDPEWLC",61,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEWLC",62,0)
 Q
"RTN","RCDPEWLC",63,0)
 ;
"RTN","RCDPEWLC",64,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEWLC",65,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEWLC",66,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEWLC",67,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEWLC",68,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEWLC",69,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEWLC",70,0)
 Q
"RTN","RCDPEWLC",71,0)
 ;
"RTN","RCDPEX")
0^32^B75558760
"RTN","RCDPEX",1,0)
RCDPEX ;ALB/TMK - ELECTRONIC EOB EXCEPTION PROCESSING - FILE 344.5 ;10-OCT-02
"RTN","RCDPEX",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEX",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEX",4,0)
 Q
"RTN","RCDPEX",5,0)
 ;
"RTN","RCDPEX",6,0)
UPD ; Update (File) ERA msgs manually from EOB exception list for file 344.5
"RTN","RCDPEX",7,0)
 N RCDA,RCOK,RCTDA,ZTSK,RCTSK,RCTYP,RCU,RC0
"RTN","RCDPEX",8,0)
 D FULL^VALM1
"RTN","RCDPEX",9,0)
 D SEL(.RCDA,1)
"RTN","RCDPEX",10,0)
 S RCDA=$O(RCDA(""))
"RTN","RCDPEX",11,0)
 I RCDA="" G UPDQ
"RTN","RCDPEX",12,0)
 S RCTDA=+RCDA(RCDA)
"RTN","RCDPEX",13,0)
 I '$$LOCK(RCTDA) G UPDQ
"RTN","RCDPEX",14,0)
 S RC0=$G(^RCY(344.5,RCTDA,0))
"RTN","RCDPEX",15,0)
 ;
"RTN","RCDPEX",16,0)
 I RC0="" D  G UPDQ
"RTN","RCDPEX",17,0)
 . W !,*7,"ERA #",RCDA," is no longer in exception file" S RCOK=""
"RTN","RCDPEX",18,0)
 . D PAUSE^VALM1
"RTN","RCDPEX",19,0)
 I $P(RC0,U,5) S RCOK=1 D  G:'RCOK UPDQ
"RTN","RCDPEX",20,0)
 . N ZTSK
"RTN","RCDPEX",21,0)
 . S ZTSK=$P(RC0,U,5) D STAT^%ZTLOAD Q:ZTSK(0)=0  ;Task not scheduled
"RTN","RCDPEX",22,0)
 . I "12"[ZTSK(1) W *7,!,"This record has already been scheduled for update.  Task # is: ",$P(RC0,U,5) S RCOK="" D PAUSE^VALM1
"RTN","RCDPEX",23,0)
 ;
"RTN","RCDPEX",24,0)
 S RCTYP=$P(RC0,U,2)
"RTN","RCDPEX",25,0)
 S RCU=$S(RCTYP="835ERA":"NEWERA^RCDPESR2("_RCTDA_",1)",RCTYP="835XFR":"FILEEOB^RCDPESR5("_RCTDA_")",1:"")
"RTN","RCDPEX",26,0)
 I RCU="" W !,*7,"This message has an invalid 'type' - can't update" D PAUSE^VALM1 G UPDQ
"RTN","RCDPEX",27,0)
 S RCTSK=$$TASK(RCU,RCTDA)
"RTN","RCDPEX",28,0)
 I RCTSK W !,"File update has been tasked (#",RCTSK,")"
"RTN","RCDPEX",29,0)
 I 'RCTSK W !,*7,"File update could not be tasked.  Please try again later!!!"
"RTN","RCDPEX",30,0)
 D PAUSE^VALM1
"RTN","RCDPEX",31,0)
 ;
"RTN","RCDPEX",32,0)
 D BLD^RCDPEX1
"RTN","RCDPEX",33,0)
UPDQ I $G(RCTDA) L -^RCY(344.5,RCTDA,0)
"RTN","RCDPEX",34,0)
 S VALMBCK="R"
"RTN","RCDPEX",35,0)
 Q
"RTN","RCDPEX",36,0)
 ;
"RTN","RCDPEX",37,0)
VP ; View/Print ERA Messages - File 344.5
"RTN","RCDPEX",38,0)
 N DHD,DIC,FLDS,BY,FR,TO,DIR,Y,L,RCDA,RCTDA,RCRAW,POP
"RTN","RCDPEX",39,0)
 D FULL^VALM1,SEL(.RCDA,1)
"RTN","RCDPEX",40,0)
 S RCDA=$O(RCDA(""))
"RTN","RCDPEX",41,0)
 G:'RCDA VPQ
"RTN","RCDPEX",42,0)
 S RCTDA=$G(RCDA(RCDA))
"RTN","RCDPEX",43,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO INCLUDE DATA THE WAY IT WAS RECEIVED (RAW DATA)?: ",DIR("B")="N" D ^DIR K DIR
"RTN","RCDPEX",44,0)
 I $D(DUOUT)!$D(DTOUT) G VPQ
"RTN","RCDPEX",45,0)
 S RCRAW=+Y
"RTN","RCDPEX",46,0)
 ; Ask device
"RTN","RCDPEX",47,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC
"RTN","RCDPEX",48,0)
 S %ZIS="QM" D ^%ZIS G:POP VPQ
"RTN","RCDPEX",49,0)
 I $D(IO("Q")) D  G VPQ
"RTN","RCDPEX",50,0)
 . S ZTRTN="VPOUT^RCDPEX",ZTDESC="AR - Print EEOB Exception Message"
"RTN","RCDPEX",51,0)
 . S ZTSAVE("RCTDA")="",ZTSAVE("RCRAW")=""
"RTN","RCDPEX",52,0)
 . D ^%ZTLOAD
"RTN","RCDPEX",53,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEX",54,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEX",55,0)
 U IO
"RTN","RCDPEX",56,0)
 ;
"RTN","RCDPEX",57,0)
VPOUT ; Entrypoint for queued job
"RTN","RCDPEX",58,0)
 N Z,Z0,RCSTOP,RCPG,RCXM,RCXM1,RC,RCZ,RCTDAC
"RTN","RCDPEX",59,0)
 K ^TMP($J,"RCRAW"),^TMP($J,"RCOUT")
"RTN","RCDPEX",60,0)
 S RCTDAC=RCTDA_","
"RTN","RCDPEX",61,0)
 ;
"RTN","RCDPEX",62,0)
 D GETS^DIQ(344.5,RCTDAC,"*","IEN","RCZ")
"RTN","RCDPEX",63,0)
 D TXTDE(RCTDA,.RCZ,1,.RCXM,.RC)
"RTN","RCDPEX",64,0)
 ;
"RTN","RCDPEX",65,0)
 I $O(^RCY(344.5,RCTDA,"EX",0)) D
"RTN","RCDPEX",66,0)
 . S RC=RC+1,RCXM(RC)="**EXCEPTION MESSAGES**"
"RTN","RCDPEX",67,0)
 . D TXTDE(RCTDA,.RCZ,5,.RCXM,.RC)
"RTN","RCDPEX",68,0)
 ;
"RTN","RCDPEX",69,0)
 K ^TMP("RCSAVE",$J)
"RTN","RCDPEX",70,0)
 M ^TMP("RCSAVE",$J)=^RCY(344.5,RCTDA,2)
"RTN","RCDPEX",71,0)
 S Z=0 F  S Z=$O(^TMP("RCSAVE",$J,Z)) Q:'Z  I $P($G(^(Z,0)),U)["835" K ^(0) Q  ; Get rid of header node
"RTN","RCDPEX",72,0)
 D DISP^RCDPESR0("^TMP(""RCSAVE"",$J)","^TMP($J,""RCRAW"")",1,"^TMP($J,""RCOUT"")",75) ; Get formatted 'raw' data
"RTN","RCDPEX",73,0)
 K ^TMP("RCSAVE",$J)
"RTN","RCDPEX",74,0)
 I $G(RCRAW) D
"RTN","RCDPEX",75,0)
 . S RC=$O(^TMP($J,"RCOUT",""),-1)+1,^TMP($J,"RCOUT",RC)=" "
"RTN","RCDPEX",76,0)
 . S RC=RC+1,^TMP($J,"RCOUT",RC)="**RAW DATA**"
"RTN","RCDPEX",77,0)
 . S Z=0 F  S Z=$O(^RCY(344.5,RCTDA,2,Z)) Q:'Z  D
"RTN","RCDPEX",78,0)
 .. F Z0=1:80:$L($G(^RCY(344.5,RCTDA,2,Z,0))) S RC=RC+1,^TMP($J,"RCOUT",RC)=$E($G(^RCY(344.5,RCTDA,2,Z,0)),Z0,Z0+79)
"RTN","RCDPEX",79,0)
 ;
"RTN","RCDPEX",80,0)
 S (RCPG,RCSTOP,Z)=0
"RTN","RCDPEX",81,0)
 F  S Z=$O(RCXM(Z)) Q:'Z  S ^TMP($J,"RCOUT",Z-999)=RCXM(Z)
"RTN","RCDPEX",82,0)
 S Z=""
"RTN","RCDPEX",83,0)
 F  S Z=$O(^TMP($J,"RCOUT",Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEX",84,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEX",85,0)
 . I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEX",86,0)
 .. D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEX",87,0)
 .. D HDR(RCTDA,.RCPG)
"RTN","RCDPEX",88,0)
 . W !,$G(^TMP($J,"RCOUT",Z))
"RTN","RCDPEX",89,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEX",90,0)
 ;
"RTN","RCDPEX",91,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEX",92,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEX",93,0)
 ;
"RTN","RCDPEX",94,0)
VPQ K ^TMP($J,"RCRAW"),^TMP($J,"RCOUT")
"RTN","RCDPEX",95,0)
 S VALMBCK="R"
"RTN","RCDPEX",96,0)
 Q
"RTN","RCDPEX",97,0)
 ;
"RTN","RCDPEX",98,0)
SEL(RCDA,ONE) ; Select entry(s) from list
"RTN","RCDPEX",99,0)
 ; RCDA = array returned if selections made
"RTN","RCDPEX",100,0)
 ;    RCDA(n)=ien of bill selected in file 344.5
"RTN","RCDPEX",101,0)
 ; ONE = if set to 1, only one selection can be made at a time
"RTN","RCDPEX",102,0)
 N RC
"RTN","RCDPEX",103,0)
 K RCDA
"RTN","RCDPEX",104,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","RCDPEX",105,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RC=$G(^TMP("RCDPEX-EOBDX",$J,RCDA)),RCDA(RCDA)=+$P(RC,U,2)
"RTN","RCDPEX",106,0)
 Q
"RTN","RCDPEX",107,0)
 ;
"RTN","RCDPEX",108,0)
 ;
"RTN","RCDPEX",109,0)
DEL ; Delete messages from messages list - file 344.5
"RTN","RCDPEX",110,0)
 N RCDA,RCOK,RCTDA,RCTDAC,RCTYP,RCU,RC0,DIR,RCT,RCE,RCDIQ,RCX,Z,X,Y,XMSUBJ,XMTO,XMBODY,XMDUZ,XMZ
"RTN","RCDPEX",111,0)
 D FULL^VALM1
"RTN","RCDPEX",112,0)
 S RCTDA=0
"RTN","RCDPEX",113,0)
 D SEL(.RCDA,1)
"RTN","RCDPEX",114,0)
 S RCDA=$O(RCDA(""))
"RTN","RCDPEX",115,0)
 I RCDA="" G DELQ
"RTN","RCDPEX",116,0)
 W !
"RTN","RCDPEX",117,0)
 S DIR(0)="YA",DIR("A",1)="This action will PERMANENTLY delete an EDI Lockbox message from your system",DIR("A",2)="A bulletin will be sent to report the deletion",DIR("A",3)=" "
"RTN","RCDPEX",118,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE? ",DIR("B")="NO"
"RTN","RCDPEX",119,0)
 D ^DIR K DIR
"RTN","RCDPEX",120,0)
 G:Y'=1 DELQ
"RTN","RCDPEX",121,0)
 S RCTDA=+RCDA(RCDA),RCTDAC=RCTDA_","
"RTN","RCDPEX",122,0)
 I '$$LOCK(RCTDA) G DELQ
"RTN","RCDPEX",123,0)
 S RC0=$G(^RCY(344.5,RCTDA,0))
"RTN","RCDPEX",124,0)
 ;
"RTN","RCDPEX",125,0)
 I $P(RC0,U,5) S RCOK=1 D  G:'RCOK DELQ
"RTN","RCDPEX",126,0)
 . N ZTSK
"RTN","RCDPEX",127,0)
 . S ZTSK=$P(RC0,U,5) D STAT^%ZTLOAD Q:ZTSK(0)=0  ;Task not scheduled
"RTN","RCDPEX",128,0)
 . I "12"[ZTSK(1) W *7,!,"This message is currently scheduled for update.  Task # is: ",$P(RC0,U,11) S RCOK="" D PAUSE^VALM1
"RTN","RCDPEX",129,0)
 ;
"RTN","RCDPEX",130,0)
 S DIR(0)="YA",DIR("A",1)=" ",DIR("A",2)="",$P(DIR("A",2),"*",54)="",DIR("A",3)="* This EDI Lockbox message is about to be PERMANENTLY deleted!! *",DIR("A",4)=DIR("A",2),DIR("A",5)=" "
"RTN","RCDPEX",131,0)
 S DIR("A")="ARE YOU STILL SURE YOU WANT TO CONTINUE? ",DIR("B")="NO"
"RTN","RCDPEX",132,0)
 W ! D ^DIR W ! K DIR
"RTN","RCDPEX",133,0)
 I Y'=1 W !!,"Nothing deleted" D PAUSE^VALM1 G DELQ
"RTN","RCDPEX",134,0)
 ;
"RTN","RCDPEX",135,0)
 D GETS^DIQ(344.5,RCTDAC,"*","IEN","RCDIQ")
"RTN","RCDPEX",136,0)
 S RCE=0
"RTN","RCDPEX",137,0)
 D TXTDE(RCTDA,.RCDIQ,1,.RCX,.RCE)
"RTN","RCDPEX",138,0)
 S RCE=RCE+1,RCX(RCE)="RAW MESSAGE DATA:"
"RTN","RCDPEX",139,0)
 D TXTDE(RCTDA,.RCDIQ,2,.RCX,.RCE)
"RTN","RCDPEX",140,0)
 D DELMSG(RCTDA)
"RTN","RCDPEX",141,0)
 I $D(^RCY(344.5,RCTDA)) D  G DELQ
"RTN","RCDPEX",142,0)
 . W !,"Message not deleted - problem with delete" D PAUSE^VALM1
"RTN","RCDPEX",143,0)
 ;
"RTN","RCDPEX",144,0)
 I $P(RC0,U,2)["XFR",'$P(RC0,U,14) D
"RTN","RCDPEX",145,0)
 . S DIR(0)="YA"
"RTN","RCDPEX",146,0)
 . S DIR("A")="ARE YOU DELETING THIS BECAUSE THE EEOB DOES NOT BELONG TO YOUR SITE?: ",DIR("B")="YES",DIR("?")="IF YOU RESPOND YES TO THIS QUESTION, A REJECT MESSAGE WILL BE SENT BACK TO",DIR("?",1)=" THE SENDING SITE FOR THIS EEOB"
"RTN","RCDPEX",147,0)
 .  W ! D ^DIR K DIR
"RTN","RCDPEX",148,0)
 . Q:Y'=1
"RTN","RCDPEX",149,0)
 . D SENDACK^RCDPESR5(RCTDA,0) ; Send reject notice
"RTN","RCDPEX",150,0)
 S RCT(1)="Electronic EDI Lockbox message "_$P(RC0,U)_" has been deleted"
"RTN","RCDPEX",151,0)
 S RCT(2)=" "
"RTN","RCDPEX",152,0)
 S RCT(3)="DELETED BY: "_$P($G(^VA(200,+$G(DUZ),0)),U)_"   "_$$FMTE^XLFDT($$NOW^XLFDT,2)
"RTN","RCDPEX",153,0)
 S RCT(4)=" ",RCE=+$O(RCT(""),-1)
"RTN","RCDPEX",154,0)
 S Z=0 F  S Z=$O(RCX(Z)) Q:'Z  S RCE=RCE+1,RCT(RCE)=RCX(Z)
"RTN","RCDPEX",155,0)
 S RCE=RCE+1,RCT(RCE)=" "
"RTN","RCDPEX",156,0)
 S XMSUBJ="EDI LBOX MESSAGE DELETED",XMBODY="RCT",XMDUZ="",XMTO("G.RCDPE PAYMENTS")=""
"RTN","RCDPEX",157,0)
 D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEX",158,0)
 ;
"RTN","RCDPEX",159,0)
 W !,"A bulletin has been sent to report this deletion",!
"RTN","RCDPEX",160,0)
 D PAUSE^VALM1
"RTN","RCDPEX",161,0)
 ;
"RTN","RCDPEX",162,0)
 D BLD^RCDPEX1
"RTN","RCDPEX",163,0)
DELQ L -^RCY(344.5,RCTDA,0)
"RTN","RCDPEX",164,0)
 S VALMBCK="R"
"RTN","RCDPEX",165,0)
 Q
"RTN","RCDPEX",166,0)
 ;
"RTN","RCDPEX",167,0)
DELMSG(RCTDA) ; Delete message from temporary message holding file 344.5
"RTN","RCDPEX",168,0)
 ;
"RTN","RCDPEX",169,0)
 N DIK,DA,Y S DIK="^RCY(344.5,",DA=RCTDA D ^DIK
"RTN","RCDPEX",170,0)
 Q
"RTN","RCDPEX",171,0)
 ;
"RTN","RCDPEX",172,0)
TASK(RCRTN,RCTDA) ; Schedule the task to update data base from message
"RTN","RCDPEX",173,0)
 ; RCRTN = routine to task
"RTN","RCDPEX",174,0)
 ; RCTDA = internal entry of message in file 344.5
"RTN","RCDPEX",175,0)
 ;
"RTN","RCDPEX",176,0)
 N ZTSK,ZTDESC,ZTIO,ZTDTH,ZTSAVE,DA,DR,DIE
"RTN","RCDPEX",177,0)
 S ZTIO="",ZTDTH=$H,ZTDESC="UPDATE DATA BASE FROM EEOB EXCEPTION PROCESSING",ZTSAVE("RC*")="",ZTRTN=RCRTN
"RTN","RCDPEX",178,0)
 D ^%ZTLOAD
"RTN","RCDPEX",179,0)
 I $G(ZTSK),$G(^RCY(344.5,RCTDA,0)) D
"RTN","RCDPEX",180,0)
 . S DIE="^RCY(344.5,",DR=".05////"_ZTSK_";.04////1;.08////0",DA=RCTDA D ^DIE
"RTN","RCDPEX",181,0)
 Q $G(ZTSK)
"RTN","RCDPEX",182,0)
 ;
"RTN","RCDPEX",183,0)
LOCK(RCTDA) ; Attempt to lock message file entry RCTDA in file 344.5
"RTN","RCDPEX",184,0)
 ; Return 1 if successful, 0 if not able to lock
"RTN","RCDPEX",185,0)
 ;
"RTN","RCDPEX",186,0)
 N OK
"RTN","RCDPEX",187,0)
 S OK=1
"RTN","RCDPEX",188,0)
 L +^RCY(344.5,RCTDA,0):5
"RTN","RCDPEX",189,0)
 I '$T D
"RTN","RCDPEX",190,0)
 . I '$D(DIQUIET) W !,*7,"Another user is editing this entry ... please try again later" D PAUSE^VALM1
"RTN","RCDPEX",191,0)
 . S OK=0
"RTN","RCDPEX",192,0)
 Q OK
"RTN","RCDPEX",193,0)
 ;
"RTN","RCDPEX",194,0)
HDR(RCTDA,RCPG) ;Prints report heading
"RTN","RCDPEX",195,0)
 ; RCTDA = ien of file 344.5
"RTN","RCDPEX",196,0)
 ; RCPG = page # last printed
"RTN","RCDPEX",197,0)
 N Z
"RTN","RCDPEX",198,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEX",199,0)
 I 'RCPG D
"RTN","RCDPEX",200,0)
 . N RCX,RCZ
"RTN","RCDPEX",201,0)
 . D TXT0(RCTDA,.RCZ,.RCX,0) ; Get 0-node captioned fields
"RTN","RCDPEX",202,0)
 . S Z=0 F  S Z=$O(RCX(Z)) Q:'Z  S ^TMP($J,"RCHDR_EX",Z)=RCX(Z)
"RTN","RCDPEX",203,0)
 S RCPG=RCPG+1
"RTN","RCDPEX",204,0)
 W !,?15,"EDI LBOX - EEOB EXCEPTIONS - EEOB DETAIL",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!
"RTN","RCDPEX",205,0)
 S Z=0 F  S Z=$O(^TMP($J,"RCHDR_EX",Z)) Q:'Z  W !,$G(^(Z))
"RTN","RCDPEX",206,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEX",207,0)
 Q
"RTN","RCDPEX",208,0)
 ;
"RTN","RCDPEX",209,0)
ASK(RCSTOP) ; Ask to stop
"RTN","RCDPEX",210,0)
 ; RCSTOP: passed by ref, flag to stop processing
"RTN","RCDPEX",211,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEX",212,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEX",213,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEX",214,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEX",215,0)
 Q
"RTN","RCDPEX",216,0)
 ; ***
"RTN","RCDPEX",217,0)
 ; *** Entrypoints TXT* assume these parameter definitions ***
"RTN","RCDPEX",218,0)
 ; ***
"RTN","RCDPEX",219,0)
 ; FUNCTIONs returns RCXM1 and RCCT if passed by reference
"RTN","RCDPEX",220,0)
 ; RCTDA = ien, file 344.5
"RTN","RCDPEX",221,0)
 ; RCXM1 = the array returned with text, captioned
"RTN","RCDPEX",222,0)
 ; RCCT = # of lines already in array (optional)
"RTN","RCDPEX",223,0)
 ; RCDIQ = the array returned from GETS^DIQ
"RTN","RCDPEX",224,0)
 ; ***
"RTN","RCDPEX",225,0)
 ;
"RTN","RCDPEX",226,0)
TXT0(RCTDA,RCDIQ,RCXM1,RCCT) ; Append 0-node captioned data to array RCXM1
"RTN","RCDPEX",227,0)
 ; See above for parameter definitions
"RTN","RCDPEX",228,0)
 ;
"RTN","RCDPEX",229,0)
 N RCZ,RCTDAC,LINE,DAT,Z,Z0
"RTN","RCDPEX",230,0)
 S LINE="",RCCT=+$G(RCCT),RCTDAC=RCTDA_","
"RTN","RCDPEX",231,0)
 S Z=0 F  S Z=$O(RCDIQ(344.5,RCTDAC,Z)) Q:'Z!(Z'<1)  D
"RTN","RCDPEX",232,0)
 . S Z0=$$GET1^DID(344.5,Z,,"LABEL")
"RTN","RCDPEX",233,0)
 . S DAT=Z0_": "_$G(RCDIQ(344.5,RCTDAC,Z,"E"))
"RTN","RCDPEX",234,0)
 . I $L(DAT)>39 S:$L(LINE) RCCT=RCCT+1,RCXM1(RCCT)=LINE S RCCT=RCCT+1,RCXM1(RCCT)=DAT,LINE="" Q
"RTN","RCDPEX",235,0)
 . I $L(LINE) D  Q:LINE=""  ; Left side exists
"RTN","RCDPEX",236,0)
 .. I $L(LINE)+$L(DAT)>75 S RCCT=RCCT+1,RCXM1(RCCT)=LINE,LINE=DAT Q
"RTN","RCDPEX",237,0)
 .. S LINE=LINE_"  "_DAT,RCCT=RCCT+1,RCXM1(RCCT)=LINE,LINE=""
"RTN","RCDPEX",238,0)
 . S LINE=$E(DAT_$J("",39),1,39)
"RTN","RCDPEX",239,0)
 I $L(LINE) S RCCT=RCCT+1,RCXM1(RCCT)=LINE
"RTN","RCDPEX",240,0)
 S:RCCT RCCT=RCCT+1,RCXM1(RCCT)=" "
"RTN","RCDPEX",241,0)
 Q
"RTN","RCDPEX",242,0)
 ;
"RTN","RCDPEX",243,0)
TXTDE(RCTDA,RCDIQ,RCNODE,RCXM1,RCCT) ; Append display data to array RCXM1
"RTN","RCDPEX",244,0)
 ; See above for parameter definitions
"RTN","RCDPEX",245,0)
 ; RCNODE = the WP field # to return
"RTN","RCDPEX",246,0)
 ;
"RTN","RCDPEX",247,0)
 N RCCT1,LINE,Z,RCTDAC
"RTN","RCDPEX",248,0)
 S LINE="",RCCT=+$G(RCCT),RCCT1=RCCT
"RTN","RCDPEX",249,0)
 S RCTDAC=RCTDA_","
"RTN","RCDPEX",250,0)
 S Z=0 F  S Z=$O(RCDIQ(344.5,RCTDAC,RCNODE,Z)) Q:'Z  D
"RTN","RCDPEX",251,0)
 . S RCCT=RCCT+1,RCXM1(RCCT)=$G(RCDIQ(344.5,RCTDAC,RCNODE,Z))
"RTN","RCDPEX",252,0)
 S:RCCT'=RCCT1 RCCT=RCCT+1,RCXM1(RCCT)=" "
"RTN","RCDPEX",253,0)
 Q
"RTN","RCDPEX",254,0)
 ;
"RTN","RCDPEX3")
0^36^B75090917
"RTN","RCDPEX3",1,0)
RCDPEX3 ;ALB/TMK - ELECTRONIC EOB EXCEPTION PROCESSING - FILE 344.4 ;10-OCT-02
"RTN","RCDPEX3",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEX3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEX3",4,0)
 ; IA REF TO ^IBE(350.9 = 4049
"RTN","RCDPEX3",5,0)
 Q
"RTN","RCDPEX3",6,0)
 ;
"RTN","RCDPEX3",7,0)
VP ; View/Print ERA Msgs - File 344.4
"RTN","RCDPEX3",8,0)
 N X,Y,RCDA,RCTDA,RCALL,DIR,POP
"RTN","RCDPEX3",9,0)
 D FULL^VALM1
"RTN","RCDPEX3",10,0)
 S DIR(0)="SA^A:ALL;S:SELECTED",DIR("A")="PRINT (A)LL or (S)ELECTED RECORDS?: "
"RTN","RCDPEX3",11,0)
 S DIR("B")="ALL"
"RTN","RCDPEX3",12,0)
 D ^DIR K DIR
"RTN","RCDPEX3",13,0)
 G:$D(DUOUT)!$D(DTOUT) VPQ
"RTN","RCDPEX3",14,0)
 S RCALL=(Y="A")
"RTN","RCDPEX3",15,0)
 ;
"RTN","RCDPEX3",16,0)
 I 'RCALL D  G:'$O(RCDA("")) VPQ
"RTN","RCDPEX3",17,0)
 . D SEL(.RCDA)
"RTN","RCDPEX3",18,0)
 ;
"RTN","RCDPEX3",19,0)
 ; device
"RTN","RCDPEX3",20,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC
"RTN","RCDPEX3",21,0)
 S %ZIS="QM" D ^%ZIS G:POP VPQ
"RTN","RCDPEX3",22,0)
 I $D(IO("Q")) D  G VPQ
"RTN","RCDPEX3",23,0)
 . S ZTRTN="VPOUT^RCDPEX3",ZTDESC="AR - Print ERA/EEOB Data With Exceptions"
"RTN","RCDPEX3",24,0)
 . S ZTSAVE("RCDA")="",ZTSAVE("RCALL")="",ZTSAVE("^TMP(""RCDPEX_SUM-EOBDX"",$J,")=""
"RTN","RCDPEX3",25,0)
 . D ^%ZTLOAD
"RTN","RCDPEX3",26,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEX3",27,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEX3",28,0)
 U IO
"RTN","RCDPEX3",29,0)
 ;
"RTN","RCDPEX3",30,0)
VPOUT ; Entrypoint queued job
"RTN","RCDPEX3",31,0)
 ; RCDA, RCALL must be defined
"RTN","RCDPEX3",32,0)
 N Z,RCSTOP,RCZ,RCPG,RCDOT,RCTDA1
"RTN","RCDPEX3",33,0)
 K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT")
"RTN","RCDPEX3",34,0)
 S (RCSTOP,RCPG)=0,RCDOT="",$P(RCDOT,".",79)=""
"RTN","RCDPEX3",35,0)
 I RCALL D
"RTN","RCDPEX3",36,0)
 . S RCZ=0 F  S RCZ=$O(^TMP("RCDPEX_SUM-EOBDX",$J,RCZ)) Q:'RCZ  S RCTDA=$G(^(RCZ)),RCTDA1=+$P(RCTDA,U,3),RCTDA=+$P(RCTDA,U,2) D  Q:RCSTOP
"RTN","RCDPEX3",37,0)
 .. D PRT(RCTDA,RCTDA1,.RCPG,.RCSTOP)
"RTN","RCDPEX3",38,0)
 .. I $O(^TMP("RCDPEX_SUM-EOBDX",$J,RCZ)) D WRTSEP(RCDOT,RCPG)
"RTN","RCDPEX3",39,0)
 I 'RCALL D
"RTN","RCDPEX3",40,0)
 . S RCZ=0 F  S RCZ=$O(RCDA(RCZ)) Q:'RCZ  D
"RTN","RCDPEX3",41,0)
 .. S RCTDA1=+$P(RCDA(RCZ),U,2),RCTDA=+RCDA(RCZ) D PRT(RCTDA,RCTDA1,.RCPG,.RCSTOP) I $O(RCDA(RCZ)) D WRTSEP(RCDOT,RCPG)
"RTN","RCDPEX3",42,0)
 ;
"RTN","RCDPEX3",43,0)
 I '$D(ZTQUEUED),'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEX3",44,0)
 ;
"RTN","RCDPEX3",45,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEX3",46,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEX3",47,0)
 ;
"RTN","RCDPEX3",48,0)
VPQ K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT")
"RTN","RCDPEX3",49,0)
 S VALMBCK="R"
"RTN","RCDPEX3",50,0)
 Q
"RTN","RCDPEX3",51,0)
 ;
"RTN","RCDPEX3",52,0)
WRTSEP(RCDOT,RCPG) ; Separating lines if more records to print
"RTN","RCDPEX3",53,0)
 W !,RCDOT,!,RCDOT
"RTN","RCDPEX3",54,0)
 I (($Y+5)>IOSL) D HDR(.RCPG) Q
"RTN","RCDPEX3",55,0)
 W !!
"RTN","RCDPEX3",56,0)
 Q
"RTN","RCDPEX3",57,0)
 ;
"RTN","RCDPEX3",58,0)
PRT(RCTDA,RCTDA1,RCPG,RCSTOP) ; Print data from file 344.4 and 344.41
"RTN","RCDPEX3",59,0)
 ; RCTDA = ien file 344.4
"RTN","RCDPEX3",60,0)
 ; RCTDA1 = ien file 344.41
"RTN","RCDPEX3",61,0)
 ; RCPG = last page extracted
"RTN","RCDPEX3",62,0)
 ; RCSTOP = returned 1 if passed by ref and process stopped
"RTN","RCDPEX3",63,0)
 ;
"RTN","RCDPEX3",64,0)
 N RCDIQ,RCDIQ1,RCDIQ2,RCXM1,RC,Z
"RTN","RCDPEX3",65,0)
 D GETS^DIQ(344.4,RCTDA_",","*","IEN","RCDIQ")
"RTN","RCDPEX3",66,0)
 D TXT0^RCDPEX31(RCTDA,.RCDIQ,.RCXM1,.RC) ; Get top level 0-node captioned fields
"RTN","RCDPEX3",67,0)
 ;
"RTN","RCDPEX3",68,0)
 I $O(^RCY(344.4,RCTDA,2,0)) S RC=RC+1,RCXM1(RC)="  **ERA LEVEL ADJUSTMENTS**"
"RTN","RCDPEX3",69,0)
 S Z=0 F  S Z=$O(^RCY(344.4,RCTDA,2,Z)) Q:'Z  D
"RTN","RCDPEX3",70,0)
 . D GETS^DIQ(344.42,Z_","_RCTDA_",","*","IEN","RCDIQ2")
"RTN","RCDPEX3",71,0)
 . D TXT2^RCDPEX31(RCTDA,Z,.RCDIQ2,.RCXM1,.RC) ; Get top level ERA adjs
"RTN","RCDPEX3",72,0)
 ;
"RTN","RCDPEX3",73,0)
 D GETS^DIQ(344.41,RCTDA1_","_RCTDA_",","*","IEN","RCDIQ1")
"RTN","RCDPEX3",74,0)
 D TXT00^RCDPEX31(RCTDA,RCTDA1,.RCDIQ1,.RCXM1,.RC)
"RTN","RCDPEX3",75,0)
 D DISP^RCDPESR0("^RCY(344.4,"_RCTDA_",1,"_RCTDA1_",1)","^TMP($J,""RC_SUMRAW"")",1,"^TMP($J,""RC_SUMOUT"")",75) ; Get formatted 'raw' data
"RTN","RCDPEX3",76,0)
 ;
"RTN","RCDPEX3",77,0)
 I $D(RCDIQ1(344.41,RCTDA1_","_RCTDA_",",2)) D
"RTN","RCDPEX3",78,0)
 . S RC=RC+1,RCXM1(RC)="  **RESOLUTION LOG DATA**"
"RTN","RCDPEX3",79,0)
 . S Z=0 F  S Z=$O(RCDIQ1(344.41,RCTDA1_","_RCTDA_",",2,Z)) Q:'Z  S RC=RC+1,RCXM1(RC)=RCDIQ1(344.41,RCTDA1_","_RCTDA_",",2,Z)
"RTN","RCDPEX3",80,0)
 . S RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEX3",81,0)
 S (RCSTOP,Z)=0
"RTN","RCDPEX3",82,0)
 F  S Z=$O(RCXM1(Z)) Q:'Z  S ^TMP($J,"RC_SUMOUT",Z-999)=RCXM1(Z)
"RTN","RCDPEX3",83,0)
 S Z=""
"RTN","RCDPEX3",84,0)
 F  S Z=$O(^TMP($J,"RC_SUMOUT",Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEX3",85,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEX3",86,0)
 . I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEX3",87,0)
 .. D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEX3",88,0)
 .. D HDR(.RCPG)
"RTN","RCDPEX3",89,0)
 . W !,$G(^TMP($J,"RC_SUMOUT",Z))
"RTN","RCDPEX3",90,0)
 ;
"RTN","RCDPEX3",91,0)
 Q
"RTN","RCDPEX3",92,0)
 ;
"RTN","RCDPEX3",93,0)
XFR ; Transfer EOB(s) to other site
"RTN","RCDPEX3",94,0)
 N RC,RC0,RCCHG,RCOK,RCDOMAIN,RCDEF,RCDA,RCWHY,RCER,RCECT,RCXTO,RCALL,RCCONT,DIR,X,Y,DA,DIE,DR,POP,RCDA,RCXDA,RCXDA1,RCDUZ,XMBODY,XMTO
"RTN","RCDPEX3",95,0)
 D FULL^VALM1
"RTN","RCDPEX3",96,0)
 D SEL(.RCDA)
"RTN","RCDPEX3",97,0)
 ;
"RTN","RCDPEX3",98,0)
 G:'$O(RCDA(0)) XFRQ
"RTN","RCDPEX3",99,0)
 S DIR("S")="I +$G(^DIC(4,+Y,6))",DIR(0)="PA^4:AME",DIR("A")="TRANSFER TO WHICH SITE?: " D ^DIR K DIR
"RTN","RCDPEX3",100,0)
 I $D(DUOUT)!$D(DTOUT) G XFRQ
"RTN","RCDPEX3",101,0)
 S RCXTO=+Y,RCCHG=0
"RTN","RCDPEX3",102,0)
 ;
"RTN","RCDPEX3",103,0)
 S RCDOMAIN=$$EXTERNAL^DILFD(4,60,,+$G(^DIC(4,+RCXTO,6))),RCECT=0
"RTN","RCDPEX3",104,0)
 I RCDOMAIN="" D  G XFRQ
"RTN","RCDPEX3",105,0)
 . S DIR("A",1)="THERE IS NO VALID DOMAIN SET UP FOR THIS SITE. YOU MUST CHOOSE ANOTHER ONE.",DIR("A")="PRESS RETURN TO CONTINUE",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEX3",106,0)
 ;
"RTN","RCDPEX3",107,0)
 S RCDEF=$S($P($G(^IBE(350.9,1,2)),U,6)'="":$E("AGENT CASHIER-"_$P(^IBE(350.9,1,2),U,6),1,45),1:"")
"RTN","RCDPEX3",108,0)
 S DIR("A",1)="ENTER THE CONTACT INFORMATION FOR THE PERSON AT YOUR SITE",DIR("A",2)="   WHO MAY BE CONTACTED BY THE OTHER SITE REGARDING THIS EEOB",DIR("A")="   (1-45 CHARACTERS): "_$S(RCDEF'="":RCDEF_"// ",1:"") ; IA 4049
"RTN","RCDPEX3",109,0)
 S DIR(0)="FA"_$S(RCDEF'="":"O",1:"")_"^1:45" W ! D ^DIR K DIR
"RTN","RCDPEX3",110,0)
 I $D(DUOUT)!$D(DTOUT) G XFRQ
"RTN","RCDPEX3",111,0)
 I Y="" S Y=RCDEF
"RTN","RCDPEX3",112,0)
 S RCCONT=Y
"RTN","RCDPEX3",113,0)
 ;
"RTN","RCDPEX3",114,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO PRINT THE EEOB(s)?: ",DIR("B")="Y"
"RTN","RCDPEX3",115,0)
 D ^DIR K DIR
"RTN","RCDPEX3",116,0)
 I $D(DUOUT)!$D(DTOUT) G XFRQ
"RTN","RCDPEX3",117,0)
 I Y=1 S RCER=0 D  I RCER G XFRQ
"RTN","RCDPEX3",118,0)
 . N %ZIS,ZTRTN,ZTSAVE,ZTDESC
"RTN","RCDPEX3",119,0)
 . S %ZIS="QM" D ^%ZIS I POP S RCER=1 Q
"RTN","RCDPEX3",120,0)
 . I $D(IO("Q")) D  Q
"RTN","RCDPEX3",121,0)
 .. S RCALL=0
"RTN","RCDPEX3",122,0)
 .. S ZTRTN="VPOUT^RCDPEX3",ZTDESC="AR - Print EEOB Data Before Transfer"
"RTN","RCDPEX3",123,0)
 .. S ZTSAVE("RCDA")="",ZTSAVE("RCALL")="",ZTSAVE("^TMP(""RCDPEX_SUM-EOBDX"",$J)")=""
"RTN","RCDPEX3",124,0)
 .. D ^%ZTLOAD
"RTN","RCDPEX3",125,0)
 .. I '$D(ZTSK) S RCER=1
"RTN","RCDPEX3",126,0)
 .. K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEX3",127,0)
 . S RCALL=0
"RTN","RCDPEX3",128,0)
 . D VPOUT^RCDPEX3
"RTN","RCDPEX3",129,0)
 ;
"RTN","RCDPEX3",130,0)
 S RCWHY(1)="Transfer EEOB detail to another site"
"RTN","RCDPEX3",131,0)
 S RC=0 F  S RC=$O(RCDA(RC)) Q:'RC  D  L -^RCY(344.4,RCXDA,1,RCXDA1,0)
"RTN","RCDPEX3",132,0)
 . N RCBODY,RCAMT,RCBILL,RCX,XMZ
"RTN","RCDPEX3",133,0)
 . S RCXDA=+RCDA(RC),RCXDA1=+$P(RCDA(RC),U,2),RCWHY(2)=""
"RTN","RCDPEX3",134,0)
 . I '$$LOCK^RCDPEX31(RCXDA,RCXDA1,1) D  Q
"RTN","RCDPEX3",135,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="**Selection #"_RC_" is being edited by another user - ... please try again later"
"RTN","RCDPEX3",136,0)
 . ;
"RTN","RCDPEX3",137,0)
 . S RC0=$G(^RCY(344.4,RCXDA,1,RCXDA1,0))
"RTN","RCDPEX3",138,0)
 . M RCBODY=^RCY(344.4,RCXDA,1,RCXDA1,1)
"RTN","RCDPEX3",139,0)
 . S RCAMT=$P(RC0,U,3)*100
"RTN","RCDPEX3",140,0)
 . S RCBILL=$P(RC0,U,5)
"RTN","RCDPEX3",141,0)
 . S DIR("A",1)="ONCE THIS EEOB HAS BEEN TRANSFERRED, ITS BILL # CANNOT BE EDITED",DIR("A")="ARE YOU SURE THIS IS NOT A CLAIM FOR YOUR SITE?: ",DIR(0)="YA",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEX3",142,0)
 . Q:Y'=1
"RTN","RCDPEX3",143,0)
 . I $P(RC0,U,11) D  Q:'RCOK
"RTN","RCDPEX3",144,0)
 .. S RCOK=1
"RTN","RCDPEX3",145,0)
 .. S DIR("A",1)="WARNING: EEOB FOR #"_RC_" ("_RCBILL_") HAS ALREADY BEEN TRANSFERRED",DIR("A",2)="   TO "_$P($G(^DIC(4,+$P(RC0,U,11),0)),U)_"   ON: "_$$FMTE^XLFDT($P(RC0,U,12),2)
"RTN","RCDPEX3",146,0)
 .. S DIR("A")="ARE YOU SURE YOU WANT TO TRANSFER IT AGAIN?: "
"RTN","RCDPEX3",147,0)
 .. S DIR(0)="YA",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEX3",148,0)
 .. I Y=1 Q
"RTN","RCDPEX3",149,0)
 .. S RCOK=0
"RTN","RCDPEX3",150,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="**Selection #"_RC_" already transferred - "_RCBILL_" NOT transferred again"
"RTN","RCDPEX3",151,0)
 . K RCBODY(0)
"RTN","RCDPEX3",152,0)
 . S RCX=$G(RCBODY(1,0))
"RTN","RCDPEX3",153,0)
 . ;
"RTN","RCDPEX3",154,0)
 . I $P($G(^RCY(344.4,RCXDA,1,RCXDA1,0)),U,7)'=1 D  Q
"RTN","RCDPEX3",155,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="**Selection #"_RC_" is not available for transfer - "_RCBILL_" NOT transferred"
"RTN","RCDPEX3",156,0)
 . ;
"RTN","RCDPEX3",157,0)
 . I $P(RCX,U)'["835ERA"!'$O(RCBODY(1)) D  Q
"RTN","RCDPEX3",158,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="**Selection #"_RC_" format is not valid for transfer - "_RCBILL_" NOT transferred"
"RTN","RCDPEX3",159,0)
 . ;
"RTN","RCDPEX3",160,0)
 . S $P(RCX,U)="835XFR",$P(RCX,U,10,16)=(RCAMT_"^^^^^^"_RCCONT)
"RTN","RCDPEX3",161,0)
 . S RCBODY(1,0)=RCX
"RTN","RCDPEX3",162,0)
 . S RCBODY(+$O(RCBODY(""),-1)+1,0)="99^$"
"RTN","RCDPEX3",163,0)
 . S RCBODY(+$O(RCBODY(""),-1)+1,0)="NNNN"
"RTN","RCDPEX3",164,0)
 . S XMTO("S.RCDPE EDI LOCKBOX SERVER@"_RCDOMAIN)=""
"RTN","RCDPEX3",165,0)
 . S XMBODY="RCBODY",RCDUZ=$G(DUZ),DUZ=.5
"RTN","RCDPEX3",166,0)
 . D SENDMSG^XMXAPI(.5,"TRANSFER 3RD PARTY EEOB "_RCBILL_"(REF #"_RCXDA_";"_RCXDA1_"#)",XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEX3",167,0)
 . ;
"RTN","RCDPEX3",168,0)
 . S DUZ=RCDUZ
"RTN","RCDPEX3",169,0)
 . I $G(XMZ) D  ; Report msg #
"RTN","RCDPEX3",170,0)
 .. S RCCHG=1
"RTN","RCDPEX3",171,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="Entry #"_RC_" was successfully transferred - msg # is "_XMZ
"RTN","RCDPEX3",172,0)
 .. S DA(1)=RCXDA,DA=RCXDA1,DIE="^RCY(344.4,"_DA(1)_",1,",DR=".09////"_XMZ_";.11////"_RCXTO_";.12////"_$E($$NOW^XLFDT(),1,12) D ^DIE
"RTN","RCDPEX3",173,0)
 .. S RCWHY(2)=" Transfer to "_$P($G(^DIC(4,+RCXTO,0)),U)_" was successful"
"RTN","RCDPEX3",174,0)
 .. ;
"RTN","RCDPEX3",175,0)
 . E  D  ; error - transfer not done
"RTN","RCDPEX3",176,0)
 .. S RCECT=RCECT+1,RCER(RCECT)="**Entry #"_RC_" was NOT transferred due to a msg build error ("_RCBILL_")"
"RTN","RCDPEX3",177,0)
 .. S RCWHY(2)=" Transfer to "_$P($G(^DIC(4,+RCXTO,0)),U)_" was UNSUCCESSFUL"
"RTN","RCDPEX3",178,0)
 .. ;
"RTN","RCDPEX3",179,0)
 . D STORACT^RCDPEX31(RCXDA,RCXDA1,.RCWHY)
"RTN","RCDPEX3",180,0)
 ;
"RTN","RCDPEX3",181,0)
 I $O(RCER(0)) D
"RTN","RCDPEX3",182,0)
 . ; Write msgs
"RTN","RCDPEX3",183,0)
 . W !!,"TRANSFER OF EEOB TO "_$P($G(^DIC(4,RCXTO,0)),U)_" RESULTS: ",!
"RTN","RCDPEX3",184,0)
 . S RCECT=0 F  S RCECT=$O(RCER(RCECT)) Q:'RCECT  W !,"  ",RCER(RCECT)
"RTN","RCDPEX3",185,0)
 . W !
"RTN","RCDPEX3",186,0)
 ;
"RTN","RCDPEX3",187,0)
 D PAUSE^VALM1
"RTN","RCDPEX3",188,0)
 ;
"RTN","RCDPEX3",189,0)
XFRQ I $G(RCCHG) D BLD^RCDPEX2
"RTN","RCDPEX3",190,0)
 S VALMBCK="R"
"RTN","RCDPEX3",191,0)
 Q
"RTN","RCDPEX3",192,0)
 ;
"RTN","RCDPEX3",193,0)
SEL(RCDA,ONE) ; Select entry(s) from list
"RTN","RCDPEX3",194,0)
 ; RCDA = array returned if selections made
"RTN","RCDPEX3",195,0)
 ;    RCDA(n)=ien of bill selected file 344.4
"RTN","RCDPEX3",196,0)
 ; ONE = if set to 1, only one selection can be made at a time
"RTN","RCDPEX3",197,0)
 N RC
"RTN","RCDPEX3",198,0)
 K RCDA
"RTN","RCDPEX3",199,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","RCDPEX3",200,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RC=$G(^TMP("RCDPEX_SUM-EOBDX",$J,RCDA)),RCDA(RCDA)=+$P(RC,U,2)_U_+$P(RC,U,3)
"RTN","RCDPEX3",201,0)
 Q
"RTN","RCDPEX3",202,0)
 ;
"RTN","RCDPEX3",203,0)
HDR(RCPG) ;Print report hdr
"RTN","RCDPEX3",204,0)
 ; RCPG = last page #
"RTN","RCDPEX3",205,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEX3",206,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEX3",207,0)
 W !,?5,"EDI LOCKBOX EEOB DATA EXCEPTIONS - EEOB DETAIL",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!,$TR($J("",IOM)," ","=")
"RTN","RCDPEX3",208,0)
 Q
"RTN","RCDPEX3",209,0)
 ;
"RTN","RCDPEX3",210,0)
ASK(RCSTOP) ;
"RTN","RCDPEX3",211,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEX3",212,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEX3",213,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEX3",214,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEX3",215,0)
 Q
"RTN","RCDPEX3",216,0)
 ; ***
"RTN","RCDPEX3",217,0)
 ; *** Entrypoints TXT* assume these variable definitions ***
"RTN","RCDPEX3",218,0)
 ; ***
"RTN","RCDPEX3",219,0)
 ; FUNCTIONs returns RCXM1 and RC if passed by reference
"RTN","RCDPEX3",220,0)
 ; RCTDA = ien, file 344.4
"RTN","RCDPEX3",221,0)
 ; RCXM1 = array returned with text, captioned
"RTN","RCDPEX3",222,0)
 ; RC = # of lines already in array (optional)
"RTN","RCDPEX3",223,0)
 ; RCDIQ and RCDIQ1 = arrays returned from GETS^DIQ
"RTN","RCDPEX3",224,0)
 ; ***
"RTN","RCDPEX3",225,0)
 ;
"RTN","RCDPEX3",226,0)
UPD ; Try to update the IB EOB file from exception in 344.41
"RTN","RCDPEX3",227,0)
 D UPD^RCDPEX31 ; Moved for space
"RTN","RCDPEX3",228,0)
 Q
"RTN","RCDPEX3",229,0)
 ;
"RTN","RCDPEX31")
0^33^B37980620
"RTN","RCDPEX31",1,0)
RCDPEX31 ;ALB/TMK - ELECTRONIC EOB EXCEPTION PROCESSING - FILE 344.4 ;10-OCT-02
"RTN","RCDPEX31",2,0)
 ;;4.5;Accounts Receivable;**173,208**;Mar 20, 1995
"RTN","RCDPEX31",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEX31",4,0)
 ;
"RTN","RCDPEX31",5,0)
UPD ; Try to update the IB EOB file from exception in 344.41
"RTN","RCDPEX31",6,0)
 N RCDA,RCTDA,RCTDA1,RCWHY,Z,DA,DIE,DR
"RTN","RCDPEX31",7,0)
 D FULL^VALM1
"RTN","RCDPEX31",8,0)
 D SEL^RCDPEX3(.RCDA,1)
"RTN","RCDPEX31",9,0)
 S RCDA=$O(RCDA(0)) G:'RCDA UPDQ
"RTN","RCDPEX31",10,0)
 S RCTDA=+RCDA(RCDA),RCTDA1=+$P(RCDA(RCDA),U,2)
"RTN","RCDPEX31",11,0)
 I '$$LOCK(RCTDA,RCTDA1,0) G UPDQ
"RTN","RCDPEX31",12,0)
 I $P($G(^RCY(344.4,RCTDA,1,RCTDA1,0)),U,7)'=2 D  G UPDQ
"RTN","RCDPEX31",13,0)
 . W !,"EEOB cannot be filed in IB"_$S($P($G(^RCY(344.4,RCTDA,1,RCTDA1,0)),U,7)=1:" - the bill # is invalid",1:"")
"RTN","RCDPEX31",14,0)
 . D PAUSE^VALM1
"RTN","RCDPEX31",15,0)
 I RCTDA,RCTDA1 D UPDEOB^RCDPESR2(RCTDA_";"_RCTDA1,4)
"RTN","RCDPEX31",16,0)
 S Z=$P($G(^RCY(344.4,RCTDA,1,RCTDA1,0)),U,2)
"RTN","RCDPEX31",17,0)
 I Z D  ; Update file 344.41 record
"RTN","RCDPEX31",18,0)
 . S DA(1)=RCTDA,DA=RCTDA1,DR=".07///@;.13////1;.02////"_Z,DIE="^RCY(344.4,"_DA(1)_",1," D ^DIE
"RTN","RCDPEX31",19,0)
 W !,"EEOB DETAIL UPDATE ",$S(Z:"WAS SUCCESSFUL",1:"ENCOUNTERED ERRORS")
"RTN","RCDPEX31",20,0)
 S RCWHY(1)="Update IB with EEOB detail",RCWHY(2)="Update EEOB detail was "_$S('Z:"NOT",1:"")_" successful"
"RTN","RCDPEX31",21,0)
 D STORACT(RCTDA,RCTDA1,.RCWHY)
"RTN","RCDPEX31",22,0)
 D PAUSE^VALM1
"RTN","RCDPEX31",23,0)
 D BLD^RCDPEX2
"RTN","RCDPEX31",24,0)
 ;
"RTN","RCDPEX31",25,0)
UPDQ S VALMBCK="R"
"RTN","RCDPEX31",26,0)
 Q
"RTN","RCDPEX31",27,0)
 ;
"RTN","RCDPEX31",28,0)
DEL ; Delete exception conditions from EOB detail list - file 344.4
"RTN","RCDPEX31",29,0)
 N DIR,X,Y,Z,RCDA,RCOK,RCTDA,RCTDA1,RCWHY,DA,DR,DIE,RC0,RC00,RCDIQ,RCE,RCT,RCX,RCWHYTXT,XMDUZ,XMSUBJ,XMZ,XMER,XMBODY,XMTO,RCDIQ1,DTOUT,DUOUT
"RTN","RCDPEX31",30,0)
 D FULL^VALM1
"RTN","RCDPEX31",31,0)
 D SEL^RCDPEX3(.RCDA,1)
"RTN","RCDPEX31",32,0)
 S RCDA=$O(RCDA(""))
"RTN","RCDPEX31",33,0)
 I RCDA="" G DELQ
"RTN","RCDPEX31",34,0)
 S RCTDA=+RCDA(RCDA),RCTDA1=$P(RCDA(RCDA),U,2)
"RTN","RCDPEX31",35,0)
 I '$$LOCK(RCTDA,RCTDA1,0) G DELQ
"RTN","RCDPEX31",36,0)
 W !
"RTN","RCDPEX31",37,0)
 S DIR(0)="YA",DIR("A",1)="This action will mark this EEOB detail record so it no longer appears as an",DIR("A",2)="exception.  A bulletin will be sent to report this action",DIR("A",3)=" "
"RTN","RCDPEX31",38,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE? ",DIR("B")="NO"
"RTN","RCDPEX31",39,0)
 D ^DIR K DIR
"RTN","RCDPEX31",40,0)
 G:Y'=1 DELQ
"RTN","RCDPEX31",41,0)
 S DIR(0)="FA;3:60",DIR("A")="ENTER A REASON FOR THIS ACTION: ",DIR("?",1)="Enter the reason why this EEOB exception is being removed from the",DIR("?")=" exception list (3-60 characters are REQUIRED)"
"RTN","RCDPEX31",42,0)
 D ^DIR K DIR
"RTN","RCDPEX31",43,0)
 I $D(DUOUT)!$D(DTOUT) G DELQ
"RTN","RCDPEX31",44,0)
 S RCWHY(1)="Removal of EEOB detail entry from the exception list",RCWHY(2)="  Reason Entered: "_Y,RCWHYTXT=Y
"RTN","RCDPEX31",45,0)
 S RC0=$G(^RCY(344.4,RCTDA,0)),RC00=$G(^(1,RCTDA1,0))
"RTN","RCDPEX31",46,0)
 ;
"RTN","RCDPEX31",47,0)
 D GETS^DIQ(344.4,RCTDA_",","*","IEN","RCDIQ")
"RTN","RCDPEX31",48,0)
 D GETS^DIQ(344.41,RCTDA1_","_RCTDA_",","*","IEN","RCDIQ1")
"RTN","RCDPEX31",49,0)
 S RCE=0
"RTN","RCDPEX31",50,0)
 D TXT0(RCTDA,.RCDIQ,.RCX,.RCE)
"RTN","RCDPEX31",51,0)
 S RCE=RCE+1,RCX(RCE)="RAW MESSAGE DATA:"
"RTN","RCDPEX31",52,0)
 D TXT00(RCTDA,RCTDA1,.RCDIQ1,.RCX,.RCE)
"RTN","RCDPEX31",53,0)
 S DA=RCTDA1,DA(1)=RCTDA,DR=".07///@;.13////0",DIE="^RCY(344.4,"_DA(1)_",1," D ^DIE
"RTN","RCDPEX31",54,0)
 D STORACT(RCTDA,RCTDA1,.RCWHY)
"RTN","RCDPEX31",55,0)
 ;
"RTN","RCDPEX31",56,0)
 S RCT(1)="The electronic EEOB detail for Trace #: "_$P(RC0,U,2)_" and Seq #"_$P(RC00,U),RCT(2)=" is no longer flagged for an exception condition"
"RTN","RCDPEX31",57,0)
 S RCT(3)="PAYMENT FROM: "_$P(RC0,U,6)_" on "_$$FMTE^XLFDT($P(RC0,U,4),2)
"RTN","RCDPEX31",58,0)
 S RCT(4)=" "
"RTN","RCDPEX31",59,0)
 S RCT(5)="REASON: "_RCWHYTXT
"RTN","RCDPEX31",60,0)
 S RCT(6)="ACTION PERFORMED BY: "_$P($G(^VA(200,+$G(DUZ),0)),U)_"   "_$$FMTE^XLFDT($$NOW^XLFDT,2)
"RTN","RCDPEX31",61,0)
 S RCT(7)=" ",RCE=+$O(RCT(""),-1)
"RTN","RCDPEX31",62,0)
 S Z=0 F  S Z=$O(RCX(Z)) Q:'Z  S RCE=RCE+1,RCT(RCE)=RCX(Z)
"RTN","RCDPEX31",63,0)
 S RCE=RCE+1,RCT(RCE)=" "
"RTN","RCDPEX31",64,0)
 S XMSUBJ="EDI LBOX EEOB DETAIL EXCEPTION REMOVED",XMBODY="RCT",XMDUZ="",XMTO("G.RCDPE PAYMENTS")=""
"RTN","RCDPEX31",65,0)
 D  ;
"RTN","RCDPEX31",66,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEX31",67,0)
 . D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEX31",68,0)
 ;
"RTN","RCDPEX31",69,0)
 W !,"A bulletin has been sent to report this action",!
"RTN","RCDPEX31",70,0)
 D PAUSE^VALM1
"RTN","RCDPEX31",71,0)
 D BLD^RCDPEX2
"RTN","RCDPEX31",72,0)
 ;
"RTN","RCDPEX31",73,0)
DELQ I $G(RCTDA),$G(RCTDA1) L -^RCY(344.4,RCTDA,1,RCTDA1,0)
"RTN","RCDPEX31",74,0)
 S VALMBCK="R"
"RTN","RCDPEX31",75,0)
 Q
"RTN","RCDPEX31",76,0)
 ;
"RTN","RCDPEX31",77,0)
TXT0(RCTDA,RCDIQ,RCXM1,RC) ; Append 0-node captioned data to array RCXM1
"RTN","RCDPEX31",78,0)
 ;
"RTN","RCDPEX31",79,0)
 N LINE,DAT,Z,Z0,Z1
"RTN","RCDPEX31",80,0)
 S LINE="",RC=+$G(RC)
"RTN","RCDPEX31",81,0)
 S RC=RC+1,RCXM1(RC)="  **ERA SUMMARY DATA**"
"RTN","RCDPEX31",82,0)
 F Z=.02:.01 D  S Z1=+$O(RCDIQ(344.4,RCTDA_",",Z)) Q:Z1'<1!'Z1
"RTN","RCDPEX31",83,0)
 . I $G(RCDIQ(344.4,RCTDA_",",Z,"E"))="" Q
"RTN","RCDPEX31",84,0)
 . S Z0=$$GET1^DID(344.4,Z,,"LABEL")
"RTN","RCDPEX31",85,0)
 . S DAT=Z0_": "_$G(RCDIQ(344.4,RCTDA_",",Z,"E"))
"RTN","RCDPEX31",86,0)
 . I $L(DAT)>39 S:$L(LINE) RC=RC+1,RCXM1(RC)=LINE S RC=RC+1,RCXM1(RC)=DAT,LINE="" Q
"RTN","RCDPEX31",87,0)
 . I $L(LINE) D  Q:LINE=""  ; Left side exists
"RTN","RCDPEX31",88,0)
 .. I $L(LINE)+$L(DAT)>75 S RC=RC+1,RCXM1(RC)=LINE,LINE=DAT Q
"RTN","RCDPEX31",89,0)
 .. S LINE=LINE_"  "_DAT,RC=RC+1,RCXM1(RC)=LINE,LINE=""
"RTN","RCDPEX31",90,0)
 . S LINE=$E(DAT_$J("",39),1,39)
"RTN","RCDPEX31",91,0)
 I $L(LINE) S RC=RC+1,RCXM1(RC)=LINE
"RTN","RCDPEX31",92,0)
 S:RC RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEX31",93,0)
 Q
"RTN","RCDPEX31",94,0)
 ;
"RTN","RCDPEX31",95,0)
TXT00(RCTDA,RCTDA1,RCDIQ1,RCXM1,RC) ; Extract 0-node data for file 344.41
"RTN","RCDPEX31",96,0)
 ;
"RTN","RCDPEX31",97,0)
 N RCT,LINE,DAT,Z,Z0,Z1
"RTN","RCDPEX31",98,0)
 S LINE="",RC=+$G(RC)
"RTN","RCDPEX31",99,0)
 S RC=RC+1,RCXM1(RC)="  **EEOB DETAIL DATA**",RCT=RCTDA1_","_RCTDA_","
"RTN","RCDPEX31",100,0)
 F Z=.01:.01 D  S Z1=+$O(RCDIQ1(344.41,RCT,Z)) Q:Z1'<1!'Z1
"RTN","RCDPEX31",101,0)
 . I $G(RCDIQ1(344.41,RCT,Z,"E"))="" Q
"RTN","RCDPEX31",102,0)
 . S Z0=$$GET1^DID(344.41,Z,,"LABEL")
"RTN","RCDPEX31",103,0)
 . S DAT=Z0_": "_$G(RCDIQ1(344.41,RCT,Z,"E"))
"RTN","RCDPEX31",104,0)
 . I $L(DAT)>39 S:$L(LINE) RC=RC+1,RCXM1(RC)=LINE S RC=RC+1,RCXM1(RC)=DAT,LINE="" Q
"RTN","RCDPEX31",105,0)
 . I $L(LINE) D  Q:LINE=""  ; Left side exists
"RTN","RCDPEX31",106,0)
 .. I $L(LINE)+$L(DAT)>75 S RC=RC+1,RCXM1(RC)=LINE,LINE=DAT Q
"RTN","RCDPEX31",107,0)
 .. S LINE=LINE_"  "_DAT,RC=RC+1,RCXM1(RC)=LINE,LINE=""
"RTN","RCDPEX31",108,0)
 . S LINE=$E(DAT_$J("",39),1,39)
"RTN","RCDPEX31",109,0)
 I $L(LINE) S RC=RC+1,RCXM1(RC)=LINE
"RTN","RCDPEX31",110,0)
 S:RC RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEX31",111,0)
 Q
"RTN","RCDPEX31",112,0)
 ;
"RTN","RCDPEX31",113,0)
TXT2(RCTDA,RCTDA1,RCDIQ2,RCXM1,RC) ; Extract all data for file 344.42
"RTN","RCDPEX31",114,0)
 ;
"RTN","RCDPEX31",115,0)
 N RCT,LINE,DAT,Z,Z0
"RTN","RCDPEX31",116,0)
 S LINE="",RC=+$G(RC)
"RTN","RCDPEX31",117,0)
 S RCT=RCTDA1_","_RCTDA_","
"RTN","RCDPEX31",118,0)
 S Z=0 F  S Z=$O(RCDIQ2(344.42,RCT,Z)) Q:'Z  D
"RTN","RCDPEX31",119,0)
 . I $G(RCDIQ2(344.42,RCT,Z,"E"))="" Q
"RTN","RCDPEX31",120,0)
 . S Z0=$$GET1^DID(344.42,Z,,"LABEL")
"RTN","RCDPEX31",121,0)
 . S DAT=Z0_": "_$G(RCDIQ2(344.42,RCT,Z,"E"))
"RTN","RCDPEX31",122,0)
 . I $L(DAT)>39 S:$L(LINE) RC=RC+1,RCXM1(RC)=LINE S RC=RC+1,RCXM1(RC)=DAT,LINE="" Q
"RTN","RCDPEX31",123,0)
 . I $L(LINE) D  Q:LINE=""  ; Left side exists
"RTN","RCDPEX31",124,0)
 .. I $L(LINE)+$L(DAT)>75 S RC=RC+1,RCXM1(RC)=LINE,LINE=DAT Q
"RTN","RCDPEX31",125,0)
 .. S LINE=LINE_"  "_DAT,RC=RC+1,RCXM1(RC)=LINE,LINE=""
"RTN","RCDPEX31",126,0)
 . S LINE=$E(DAT_$J("",39),1,39)
"RTN","RCDPEX31",127,0)
 I $L(LINE) S RC=RC+1,RCXM1(RC)=LINE
"RTN","RCDPEX31",128,0)
 S:RC RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEX31",129,0)
 Q
"RTN","RCDPEX31",130,0)
 ;
"RTN","RCDPEX31",131,0)
LOCK(RCTDA,RCTDA1,RCSHH) ; Attempt to lock file entry in file 344.41
"RTN","RCDPEX31",132,0)
 ; Return 1 if successful, 0 if not able to lock
"RTN","RCDPEX31",133,0)
 ; RCSHH = 1 if there should be no direct writes
"RTN","RCDPEX31",134,0)
 ;
"RTN","RCDPEX31",135,0)
 N OK
"RTN","RCDPEX31",136,0)
 S OK=1
"RTN","RCDPEX31",137,0)
 L +^RCY(344.4,RCTDA,1,RCTDA1,0):5
"RTN","RCDPEX31",138,0)
 I '$T D
"RTN","RCDPEX31",139,0)
 . I '$D(DIQUIET),'$G(RCSHH) W !,*7,"Another user is editing this entry ... please try again later" D PAUSE^VALM1
"RTN","RCDPEX31",140,0)
 . S OK=0
"RTN","RCDPEX31",141,0)
 Q OK
"RTN","RCDPEX31",142,0)
 ;
"RTN","RCDPEX31",143,0)
STORACT(RCTDA,RCTDA1,RCWHY) ; Store the detail for the action taken for
"RTN","RCDPEX31",144,0)
 ; the exception record at ^RCY(344.4,RCTDA,1,RCTDA,0)
"RTN","RCDPEX31",145,0)
 ; RCWHY(#) = lines containing the reason/explanation for the action
"RTN","RCDPEX31",146,0)
 ;   RCWHY(1) should contain the description of the action taken
"RTN","RCDPEX31",147,0)
 ;            It will be appended to the first line of the message after
"RTN","RCDPEX31",148,0)
 ;            the date and user who made the change.
"RTN","RCDPEX31",149,0)
 ;
"RTN","RCDPEX31",150,0)
 N RCDA,RCTXT,RC,Z
"RTN","RCDPEX31",151,0)
 S RCDA(1)=RCTDA,RCDA=RCTDA1
"RTN","RCDPEX31",152,0)
 S RCTXT(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" "_$P($G(^VA(200,+DUZ,0)),U)_" "_$G(RCWHY(1))
"RTN","RCDPEX31",153,0)
 S (RC,Z)=1
"RTN","RCDPEX31",154,0)
 F  S Z=$O(RCWHY(Z)) Q:'Z  S RC=RC+1,RCTXT(RC)=" "_RCWHY(Z)
"RTN","RCDPEX31",155,0)
 D WP^DIE(344.41,$$IENS^DILF(.RCDA),2,"A","RCTXT")
"RTN","RCDPEX31",156,0)
 Q
"RTN","RCDPEX31",157,0)
 ;
"RTN","RCDPLPL1")
0^24^B25553725
"RTN","RCDPLPL1",1,0)
RCDPLPL1 ;WISC/RFJ-link payments listmanager options ;1 Jun 99
"RTN","RCDPLPL1",2,0)
 ;;4.5;Accounts Receivable;**114,148,153,208**;Mar 20, 1995
"RTN","RCDPLPL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPLPL1",4,0)
 Q
"RTN","RCDPLPL1",5,0)
 ;
"RTN","RCDPLPL1",6,0)
 ;
"RTN","RCDPLPL1",7,0)
CHKTRACE ; Ask to search by chec # or trace #
"RTN","RCDPLPL1",8,0)
 N DIR,X,Y
"RTN","RCDPLPL1",9,0)
 D FULL^VALM1
"RTN","RCDPLPL1",10,0)
 S DIR("A")="SEARCH BY (C)HECK OR (T)RACE #?: ",DIR(0)="SA^C:CHECK;T:TRACE",DIR("B")="CHECK" W ! D ^DIR K DIR
"RTN","RCDPLPL1",11,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","RCDPLPL1",12,0)
 I Y="C" D  Q
"RTN","RCDPLPL1",13,0)
 . D FINDCHEK
"RTN","RCDPLPL1",14,0)
 I Y="T" D  Q
"RTN","RCDPLPL1",15,0)
 . D FINDTRAC
"RTN","RCDPLPL1",16,0)
 Q
"RTN","RCDPLPL1",17,0)
 ;
"RTN","RCDPLPL1",18,0)
FINDCHEK ;  find a specific check used for payments
"RTN","RCDPLPL1",19,0)
 D FULL^VALM1
"RTN","RCDPLPL1",20,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",21,0)
 ;
"RTN","RCDPLPL1",22,0)
 N RCCHECK,RCTYPE
"RTN","RCDPLPL1",23,0)
 K RCFCHECK,RCFCREDT,RCFTRACE
"RTN","RCDPLPL1",24,0)
 W !
"RTN","RCDPLPL1",25,0)
 S RCCHECK=$$ASKCHEK I RCCHECK=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",26,0)
 ;
"RTN","RCDPLPL1",27,0)
 S RCTYPE=$$ASKTYPE I RCTYPE=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",28,0)
 S RCFCHECK=RCCHECK_"^"_RCTYPE
"RTN","RCDPLPL1",29,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",30,0)
 Q
"RTN","RCDPLPL1",31,0)
 ;
"RTN","RCDPLPL1",32,0)
FINDTRAC ;  find a specific trace # used for EFT/ERA payments
"RTN","RCDPLPL1",33,0)
 D FULL^VALM1
"RTN","RCDPLPL1",34,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",35,0)
 ;
"RTN","RCDPLPL1",36,0)
 N RCTRACE,RCTYPE
"RTN","RCDPLPL1",37,0)
 K RCFTRACE,RCFCREDT,RCFCHECK
"RTN","RCDPLPL1",38,0)
 W !
"RTN","RCDPLPL1",39,0)
 S RCTRACE=$$ASKTRACE I RCTRACE=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",40,0)
 ;
"RTN","RCDPLPL1",41,0)
 S RCTYPE=$$ASKTYPE I RCTYPE=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",42,0)
 S RCFTRACE=RCTRACE_"^"_RCTYPE
"RTN","RCDPLPL1",43,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",44,0)
 Q
"RTN","RCDPLPL1",45,0)
 ;
"RTN","RCDPLPL1",46,0)
 ;
"RTN","RCDPLPL1",47,0)
FINDCRED ;  find a specific credit card used for payments
"RTN","RCDPLPL1",48,0)
 D FULL^VALM1
"RTN","RCDPLPL1",49,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",50,0)
 ;
"RTN","RCDPLPL1",51,0)
 N RCCREDT,RCTYPE
"RTN","RCDPLPL1",52,0)
 K RCFCHECK,RCFCREDT,RCFTRACE
"RTN","RCDPLPL1",53,0)
 W !
"RTN","RCDPLPL1",54,0)
 S RCCREDT=$$ASKCRED I RCCREDT=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",55,0)
 ;
"RTN","RCDPLPL1",56,0)
 S RCTYPE=$$ASKTYPE I RCTYPE=-1 D INIT^RCDPLPLM Q
"RTN","RCDPLPL1",57,0)
 S RCFCREDT=RCCREDT_"^"_RCTYPE
"RTN","RCDPLPL1",58,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",59,0)
 Q
"RTN","RCDPLPL1",60,0)
 ;
"RTN","RCDPLPL1",61,0)
 ;
"RTN","RCDPLPL1",62,0)
ACCOUNT ;  account profile
"RTN","RCDPLPL1",63,0)
 D FULL^VALM1
"RTN","RCDPLPL1",64,0)
 D ACCTPROF^RCDPAPLM
"RTN","RCDPLPL1",65,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",66,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",67,0)
 ;  fast exit
"RTN","RCDPLPL1",68,0)
 I $G(RCDPFXIT) S VALMBCK="Q"
"RTN","RCDPLPL1",69,0)
 Q
"RTN","RCDPLPL1",70,0)
 ;
"RTN","RCDPLPL1",71,0)
 ;
"RTN","RCDPLPL1",72,0)
RECEIPT ;  receipt profile
"RTN","RCDPLPL1",73,0)
 D FULL^VALM1
"RTN","RCDPLPL1",74,0)
 D RECTPROF^RCDPRPLM
"RTN","RCDPLPL1",75,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",76,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",77,0)
 I $G(RCDPFXIT) S VALMBCK="Q"
"RTN","RCDPLPL1",78,0)
 Q
"RTN","RCDPLPL1",79,0)
 ;
"RTN","RCDPLPL1",80,0)
 ;
"RTN","RCDPLPL1",81,0)
CLEARSUS ;  flag a payment as being cleared from suspense
"RTN","RCDPLPL1",82,0)
 D FULL^VALM1
"RTN","RCDPLPL1",83,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",84,0)
 ;
"RTN","RCDPLPL1",85,0)
 W !!,"This option will allow you to enter the FMS Document Number used"
"RTN","RCDPLPL1",86,0)
 W !,"to clear the payment from the suspense account in FMS.  Once an"
"RTN","RCDPLPL1",87,0)
 W !,"FMS Document Number is entered, the payment will no longer appear"
"RTN","RCDPLPL1",88,0)
 W !,"on the list as Unlinked.",!
"RTN","RCDPLPL1",89,0)
 N INDEX,RCPAY,RCRECTDA,RCTRANDA
"RTN","RCDPLPL1",90,0)
 S INDEX=$$SELPAY
"RTN","RCDPLPL1",91,0)
 I INDEX D
"RTN","RCDPLPL1",92,0)
 .   S RCPAY=$G(^TMP("RCDPLPLM",$J,"IDX",INDEX,INDEX))
"RTN","RCDPLPL1",93,0)
 .   S RCRECTDA=+$P(RCPAY,"^"),RCTRANDA=+$P(RCPAY,"^",2)
"RTN","RCDPLPL1",94,0)
 I 'INDEX D
"RTN","RCDPLPL1",95,0)
 .   W ! S RCRECTDA=+$$SELRECT^RCDPUREC(0,0) I RCRECTDA<1 Q
"RTN","RCDPLPL1",96,0)
 .   S RCTRANDA=+$$SELTRAN^RCDPURET(RCRECTDA) I RCTRANDA<1 S RCTRANDA=0
"RTN","RCDPLPL1",97,0)
 I '$G(RCRECTDA)!('$G(RCTRANDA)) S VALMBCK="R" Q
"RTN","RCDPLPL1",98,0)
 ;
"RTN","RCDPLPL1",99,0)
 W !!,"                   Receipt: ",$P(^RCY(344,RCRECTDA,0),"^")
"RTN","RCDPLPL1",100,0)
 W !,"               Transaction: ",RCTRANDA
"RTN","RCDPLPL1",101,0)
 W !,"  Unapplied Deposit Number: ",$P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^",5)
"RTN","RCDPLPL1",102,0)
 D EDITFMS^RCDPURET(RCRECTDA,RCTRANDA,"")
"RTN","RCDPLPL1",103,0)
 S VALMBCK="R"
"RTN","RCDPLPL1",104,0)
 D INIT^RCDPLPLM
"RTN","RCDPLPL1",105,0)
 Q
"RTN","RCDPLPL1",106,0)
 ;
"RTN","RCDPLPL1",107,0)
 ;
"RTN","RCDPLPL1",108,0)
 ;
"RTN","RCDPLPL1",109,0)
 ;
"RTN","RCDPLPL1",110,0)
SELPAY() ;  select a payment from the form list
"RTN","RCDPLPL1",111,0)
 N VALMBG,VALMLST
"RTN","RCDPLPL1",112,0)
 ;  if no payments, quit
"RTN","RCDPLPL1",113,0)
 I '$O(^TMP("RCDPLPLM",$J,"IDX",0)) S VALMSG="There are NO payments on the form to select." Q 0
"RTN","RCDPLPL1",114,0)
 ;
"RTN","RCDPLPL1",115,0)
 ;  if only one payment, select that one automatically
"RTN","RCDPLPL1",116,0)
 I '$O(^TMP("RCDPLPLM",$J,"IDX",1)) Q 1
"RTN","RCDPLPL1",117,0)
 ;
"RTN","RCDPLPL1",118,0)
 ;  select the entry from the list
"RTN","RCDPLPL1",119,0)
 ;  if not on first screen, make sure selection begins with 1
"RTN","RCDPLPL1",120,0)
 S VALMBG=1
"RTN","RCDPLPL1",121,0)
 ;  if not on last screen, make sure selection ends with last
"RTN","RCDPLPL1",122,0)
 S VALMLST=$O(^TMP("RCDPLPLM",$J,"IDX",999999999),-1)
"RTN","RCDPLPL1",123,0)
 D EN^VALM2($G(XQORNOD(0)),"OS")
"RTN","RCDPLPL1",124,0)
 Q $O(VALMY(0))
"RTN","RCDPLPL1",125,0)
 ;
"RTN","RCDPLPL1",126,0)
 ;
"RTN","RCDPLPL1",127,0)
ASKCHEK() ;  ask the check number
"RTN","RCDPLPL1",128,0)
 N DIR,X,Y
"RTN","RCDPLPL1",129,0)
 S DIR(0)="FAO^1:15"
"RTN","RCDPLPL1",130,0)
 S DIR("A")="Enter the Check Number to Search for: "
"RTN","RCDPLPL1",131,0)
 S DIR("?")="Enter the check number from 1 to 15 characters free text."
"RTN","RCDPLPL1",132,0)
 D ^DIR
"RTN","RCDPLPL1",133,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPLPL1",134,0)
 Q $S(Y'="":Y,1:-1)
"RTN","RCDPLPL1",135,0)
 ;
"RTN","RCDPLPL1",136,0)
 ;
"RTN","RCDPLPL1",137,0)
ASKTRACE() ;  ask the e-payments trace number
"RTN","RCDPLPL1",138,0)
 N DIR,X,Y
"RTN","RCDPLPL1",139,0)
 S DIR(0)="FAO^1:30"
"RTN","RCDPLPL1",140,0)
 S DIR("A")="Enter the e-Payments Trace Number to Search for: "
"RTN","RCDPLPL1",141,0)
 S DIR("?")="Enter the trace number from 1 to 30 characters free text."
"RTN","RCDPLPL1",142,0)
 D ^DIR
"RTN","RCDPLPL1",143,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPLPL1",144,0)
 Q $S(Y'="":Y,1:-1)
"RTN","RCDPLPL1",145,0)
 ;
"RTN","RCDPLPL1",146,0)
 ;
"RTN","RCDPLPL1",147,0)
ASKCRED() ;  ask the credit card number
"RTN","RCDPLPL1",148,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPLPL1",149,0)
 S DIR(0)="NAO^0:9999999999999999"
"RTN","RCDPLPL1",150,0)
 S DIR("A")="Enter the Credit Card Number to Search for: "
"RTN","RCDPLPL1",151,0)
 S DIR("?")="Enter the check card number from 1 to 16 numbers."
"RTN","RCDPLPL1",152,0)
 D ^DIR
"RTN","RCDPLPL1",153,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPLPL1",154,0)
 Q $S(Y'="":Y,1:-1)
"RTN","RCDPLPL1",155,0)
 ;
"RTN","RCDPLPL1",156,0)
 ;
"RTN","RCDPLPL1",157,0)
ASKTYPE() ;  ask the type of match
"RTN","RCDPLPL1",158,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPLPL1",159,0)
 S DIR(0)="SAO^1:Exact Match;2:Contains;"
"RTN","RCDPLPL1",160,0)
 S DIR("A")="Type of Match: "
"RTN","RCDPLPL1",161,0)
 S DIR("B")="Contains"
"RTN","RCDPLPL1",162,0)
 D ^DIR
"RTN","RCDPLPL1",163,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPLPL1",164,0)
 Q $S(Y=1:"EQUAL TO",Y=2:"CONTAINING",1:-1)
"RTN","RCDPLPLM")
0^25^B40847044
"RTN","RCDPLPLM",1,0)
RCDPLPLM ;WISC/RFJ-link payments listmanager top routine ;1 Jun 99
"RTN","RCDPLPLM",2,0)
 ;;4.5;Accounts Receivable;**114,208**;Mar 20, 1995
"RTN","RCDPLPLM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPLPLM",4,0)
 ;
"RTN","RCDPLPLM",5,0)
 N RCFCHECK,RCFTRACE,RCFCREDT,RCDPFXIT
"RTN","RCDPLPLM",6,0)
 N %,%DT,%H,%I,RCDPPADT,X,Y
"RTN","RCDPLPLM",7,0)
 S %DT("A")="Start with Payment Date (press RETURN for FIRST): ",%DT="AEP",%DT(0)=-DT
"RTN","RCDPLPLM",8,0)
 D ^%DT I Y<0,X["^" Q
"RTN","RCDPLPLM",9,0)
 ;  if user entered a date, go back one day
"RTN","RCDPLPLM",10,0)
 I Y'<0 S RCDPPADT=$$FMADD^XLFDT(+Y,-1)
"RTN","RCDPLPLM",11,0)
 ;
"RTN","RCDPLPLM",12,0)
 D EN^VALM("RCDP LINK PAYMENTS TO ACCOUNTS")
"RTN","RCDPLPLM",13,0)
 Q
"RTN","RCDPLPLM",14,0)
 ;
"RTN","RCDPLPLM",15,0)
INIT ;  initialization for list manager list
"RTN","RCDPLPLM",16,0)
 ;  pass RCDPPADT to display payments after RCDPPADT date
"RTN","RCDPLPLM",17,0)
 ;  pass RCFCHECK, RCFTRACE and RCFCREDT to search by
"RTN","RCDPLPLM",18,0)
 ;        check/trace #/credit card #
"RTN","RCDPLPLM",19,0)
 ;  fast exit
"RTN","RCDPLPLM",20,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPLPLM",21,0)
 ;
"RTN","RCDPLPLM",22,0)
 W !!,"please wait, building list of unlinked payments..."
"RTN","RCDPLPLM",23,0)
 ;
"RTN","RCDPLPLM",24,0)
 N DATE,FMSDOC,NUMBER,RCCOUNT,RCDATA,RCLINE,RCRECTDA,RCTOTAL,RCTRANDA,RECDATA,TYPE
"RTN","RCDPLPLM",25,0)
 ;
"RTN","RCDPLPLM",26,0)
 ;  set the listmanager line number
"RTN","RCDPLPLM",27,0)
 S RCLINE=0
"RTN","RCDPLPLM",28,0)
 ;  set the lookup payment number from list
"RTN","RCDPLPLM",29,0)
 S RCCOUNT=0
"RTN","RCDPLPLM",30,0)
 ;  get list of unlinked accounts
"RTN","RCDPLPLM",31,0)
 K ^TMP("RCDPLPLM",$J)
"RTN","RCDPLPLM",32,0)
 S RCRECTDA=0 F  S RCRECTDA=$O(^RCY(344,"AN",RCRECTDA)) Q:'RCRECTDA  D
"RTN","RCDPLPLM",33,0)
 .   S RECDATA=$G(^RCY(344,RCRECTDA,0))
"RTN","RCDPLPLM",34,0)
 .   S RCTRANDA=0 F  S RCTRANDA=$O(^RCY(344,"AN",RCRECTDA,RCTRANDA)) Q:'RCTRANDA  D
"RTN","RCDPLPLM",35,0)
 .   .   S RCDATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPLPLM",36,0)
 .   .   I '$P(RCDATA,"^",4) Q  ;no payment amount
"RTN","RCDPLPLM",37,0)
 .   .   ;  fms doc id entered (field 26) to clear suspense
"RTN","RCDPLPLM",38,0)
 .   .   I $P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^",6)'="" Q
"RTN","RCDPLPLM",39,0)
 .   .   ;  unlinked
"RTN","RCDPLPLM",40,0)
 .   .   ;  get payment date
"RTN","RCDPLPLM",41,0)
 .   .   S DATE=$P(RCDATA,"^",6)
"RTN","RCDPLPLM",42,0)
 .   .   I 'DATE S DATE=$P(RCDATA,"^",10)
"RTN","RCDPLPLM",43,0)
 .   .   I 'DATE S DATE=$P(RECDATA,"^",3)
"RTN","RCDPLPLM",44,0)
 .   .   I 'DATE S DATE=0
"RTN","RCDPLPLM",45,0)
 .   .   ;  before selected payment date
"RTN","RCDPLPLM",46,0)
 .   .   I $G(RCDPPADT),DATE<RCDPPADT Q
"RTN","RCDPLPLM",47,0)
 .   .   ;
"RTN","RCDPLPLM",48,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPLPLM",49,0)
 .   .   S RCCOUNT=RCCOUNT+1
"RTN","RCDPLPLM",50,0)
 .   .   ;
"RTN","RCDPLPLM",51,0)
 .   .   ;  create an index array for bill lookup in list
"RTN","RCDPLPLM",52,0)
 .   .   S ^TMP("RCDPLPLM",$J,"IDX",RCCOUNT,RCCOUNT)=RCRECTDA_"^"_RCTRANDA
"RTN","RCDPLPLM",53,0)
 .   .   ;
"RTN","RCDPLPLM",54,0)
 .   .   D SET(RCCOUNT,RCLINE,1,80)
"RTN","RCDPLPLM",55,0)
 .   .   ;  receipt number
"RTN","RCDPLPLM",56,0)
 .   .   D SET($P(RECDATA,"^"),RCLINE,6,18)
"RTN","RCDPLPLM",57,0)
 .   .   ;  transaction number
"RTN","RCDPLPLM",58,0)
 .   .   D SET($J(RCTRANDA,5),RCLINE,18,24)
"RTN","RCDPLPLM",59,0)
 .   .   ;  unapplied deposit number
"RTN","RCDPLPLM",60,0)
 .   .   D SET($J($$GETUNAPP^RCXFMSCR(RCRECTDA,RCTRANDA,0),13),RCLINE,26,39)
"RTN","RCDPLPLM",61,0)
 .   .   ;  receipt status
"RTN","RCDPLPLM",62,0)
 .   .   D SET($E($S($P(RECDATA,"^",14):"OPEN",1:"CLOSED"),1,4),RCLINE,41,44)
"RTN","RCDPLPLM",63,0)
 .   .   ;  payment date
"RTN","RCDPLPLM",64,0)
 .   .   D SET($E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3),RCLINE,47,54)
"RTN","RCDPLPLM",65,0)
 .   .   ;  get type of payment
"RTN","RCDPLPLM",66,0)
 .   .   S TYPE=$S($P(RECDATA,U,18)&$P(RECDATA,U,17):"TRACE",1:"") ;EFT/ERA payment
"RTN","RCDPLPLM",67,0)
 .   .   I TYPE="" D
"RTN","RCDPLPLM",68,0)
 .   .   .   S TYPE=$P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^",4)
"RTN","RCDPLPLM",69,0)
 .   .   .   S TYPE=$S(TYPE=1:"CASH",TYPE=2:"CHECK",TYPE=3:"CREDIT",1:"")
"RTN","RCDPLPLM",70,0)
 .   .   I TYPE="" S TYPE=$P($G(^RC(341.1,+$P(RECDATA,"^",4),0)),"^")
"RTN","RCDPLPLM",71,0)
 .   .   D SET(TYPE,RCLINE,57,60)
"RTN","RCDPLPLM",72,0)
 .   .   ;  get check, trace, credit #, RCFCHECK RCFTRACE and RCFCREDT
"RTN","RCDPLPLM",73,0)
 .   .   ;  can be used to match a specific check, trace or credit card #
"RTN","RCDPLPLM",74,0)
 .   .   ;  the variable is in the form:
"RTN","RCDPLPLM",75,0)
 .   .   ;  RCFCHECK=number^EXACT  or  number^CONTAINS
"RTN","RCDPLPLM",76,0)
 .   .   I $G(RCFCHECK)'="",$E(TYPE,1,5)'="CHECK" Q
"RTN","RCDPLPLM",77,0)
 .   .   I $G(RCFTRACE)'="",$E(TYPE,1,5)'="TRACE" Q
"RTN","RCDPLPLM",78,0)
 .   .   I $G(RCFCREDT)'="",$E(TYPE,1,6)'="CREDIT" Q
"RTN","RCDPLPLM",79,0)
 .   .   S NUMBER=""
"RTN","RCDPLPLM",80,0)
 .   .   I $E(TYPE,1,5)="CHECK" D  Q:NUMBER=""
"RTN","RCDPLPLM",81,0)
 .   .   .   S NUMBER=$P(RCDATA,"^",7)
"RTN","RCDPLPLM",82,0)
 .   .   .   I $G(RCFCHECK)'="",NUMBER="" Q
"RTN","RCDPLPLM",83,0)
 .   .   .   I $E($P($G(RCFCHECK),"^",2))="E",NUMBER'=$P(RCFCHECK,"^") S NUMBER="" Q
"RTN","RCDPLPLM",84,0)
 .   .   .   I $E($P($G(RCFCHECK),"^",2))="C",NUMBER'[$P(RCFCHECK,"^") S NUMBER="" Q
"RTN","RCDPLPLM",85,0)
 .   .   .   I NUMBER="" S NUMBER=" "
"RTN","RCDPLPLM",86,0)
 .   .   I $E(TYPE,1,5)="TRACE" D  Q:NUMBER=""
"RTN","RCDPLPLM",87,0)
 .   .   .   S NUMBER=$P($G(^RCY(344.4,+$P(RECDATA,U,18),0)),U,2)
"RTN","RCDPLPLM",88,0)
 .   .   .   I $G(RCFTRACE)'="",NUMBER="" Q
"RTN","RCDPLPLM",89,0)
 .   .   .   I $E($P($G(RCFTRACE),"^",2))="E",NUMBER'=$P(RCFTRACE,"^") S NUMBER="" Q
"RTN","RCDPLPLM",90,0)
 .   .   .   I $E($P($G(RCFTRACE),"^",2))="C",NUMBER'[$P(RCFTRACE,"^") S NUMBER="" Q
"RTN","RCDPLPLM",91,0)
 .   .   .   I NUMBER="" S NUMBER=" "
"RTN","RCDPLPLM",92,0)
 .   .   I $E(TYPE,1,6)="CREDIT" D  Q:NUMBER=""
"RTN","RCDPLPLM",93,0)
 .   .   .   S NUMBER=$P(RCDATA,"^",11)
"RTN","RCDPLPLM",94,0)
 .   .   .   I $G(RCFCHECK)'="",NUMBER="" Q
"RTN","RCDPLPLM",95,0)
 .   .   .   I $E($P($G(RCFCREDT),"^",2))="E",NUMBER'=$P(RCFCREDT,"^") S NUMBER="" Q
"RTN","RCDPLPLM",96,0)
 .   .   .   I $E($P($G(RCFCREDT),"^",2))="C",NUMBER'[$P(RCFCREDT,"^") S NUMBER="" Q
"RTN","RCDPLPLM",97,0)
 .   .   .   I NUMBER="" S NUMBER=" "
"RTN","RCDPLPLM",98,0)
 .   .   I NUMBER="" S NUMBER=" "
"RTN","RCDPLPLM",99,0)
 .   .   S %=$L(NUMBER) I %>8 S NUMBER=$E(NUMBER,%-7,%)
"RTN","RCDPLPLM",100,0)
 .   .   ;  check/trace/credit# (last 8 chars)
"RTN","RCDPLPLM",101,0)
 .   .   D SET(NUMBER,RCLINE,62,69)
"RTN","RCDPLPLM",102,0)
 .   .   ;  amount paid
"RTN","RCDPLPLM",103,0)
 .   .   D SET($J($P(RCDATA,"^",4),10,2),RCLINE,70,80)
"RTN","RCDPLPLM",104,0)
 .   .   ;  since list manager adds spaces to line, make sure line is
"RTN","RCDPLPLM",105,0)
 .   .   ;  80 characters so the print list looks okay
"RTN","RCDPLPLM",106,0)
 .   .   S ^TMP("RCDPLPLM",$J,RCLINE,0)=$E(^TMP("RCDPLPLM",$J,RCLINE,0),1,80)
"RTN","RCDPLPLM",107,0)
 .   .   S RCTOTAL=$G(RCTOTAL)+$P(RCDATA,"^",4)
"RTN","RCDPLPLM",108,0)
 .   .   ;
"RTN","RCDPLPLM",109,0)
 .   .   ;  show line 2
"RTN","RCDPLPLM",110,0)
 .   .   ;  account lookup
"RTN","RCDPLPLM",111,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPLPLM",112,0)
 .   .   S %=$E("AcctLU: "_$P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^")_"                        ",1,24)
"RTN","RCDPLPLM",113,0)
 .   .   D SET("                 "_%,RCLINE,1,80)
"RTN","RCDPLPLM",114,0)
 .   .   ;  fms cr document
"RTN","RCDPLPLM",115,0)
 .   .   S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPLPLM",116,0)
 .   .   D SET($E("CRdoc: "_$P(FMSDOC,"^")_"               ",1,22),RCLINE,41,80)
"RTN","RCDPLPLM",117,0)
 .   .   ;  cr document status
"RTN","RCDPLPLM",118,0)
 .   .   D SET($P(FMSDOC,"^",2),RCLINE,63,68)
"RTN","RCDPLPLM",119,0)
 .   .   ;  make second line longer than 80 characters for printing
"RTN","RCDPLPLM",120,0)
 .   .   ;  this will add an extra line after each entry
"RTN","RCDPLPLM",121,0)
 .   .   D SET("    ",RCLINE,80,84)
"RTN","RCDPLPLM",122,0)
 ;
"RTN","RCDPLPLM",123,0)
 S RCLINE=RCLINE+1 D SET("----------",RCLINE,70,80)
"RTN","RCDPLPLM",124,0)
 S RCLINE=RCLINE+1 D SET("TOTAL: "_$J($G(RCTOTAL),10,2),RCLINE,63,80)
"RTN","RCDPLPLM",125,0)
 ;
"RTN","RCDPLPLM",126,0)
 ;  set valmcnt to number of lines in the list
"RTN","RCDPLPLM",127,0)
 S VALMCNT=RCLINE
"RTN","RCDPLPLM",128,0)
 D HDR
"RTN","RCDPLPLM",129,0)
 Q
"RTN","RCDPLPLM",130,0)
 ;
"RTN","RCDPLPLM",131,0)
 ;
"RTN","RCDPLPLM",132,0)
SET(STRING,LINE,COLBEG,COLEND) ;  set array
"RTN","RCDPLPLM",133,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RCDPLPLM",134,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLBEG,COLEND-COLBEG+1))
"RTN","RCDPLPLM",135,0)
 Q
"RTN","RCDPLPLM",136,0)
 ;
"RTN","RCDPLPLM",137,0)
 ;
"RTN","RCDPLPLM",138,0)
HDR ;  header code for list manager display
"RTN","RCDPLPLM",139,0)
 S VALMHDR(1)="Transactions for ALL Unapplied Payments"
"RTN","RCDPLPLM",140,0)
 I $G(RCDPPADT)>0 S Y=RCDPPADT D DD^%DT S VALMHDR(1)="Transactions for Unapplied Payments After "_Y
"RTN","RCDPLPLM",141,0)
 S VALMHDR(2)=" "
"RTN","RCDPLPLM",142,0)
 I $G(RCFCHECK)'="" S VALMHDR(2)="  List of Payments With Check Numbers "_$P(RCFCHECK,"^",2)_" "_$P(RCFCHECK,"^")
"RTN","RCDPLPLM",143,0)
 I $G(RCFTRACE)'="" S VALMHDR(2)="  List of Payments With Trace Numbers "_$P(RCFTRACE,"^",2)_" "_$P(RCFTRACE,"^")
"RTN","RCDPLPLM",144,0)
 I $G(RCFCREDT)'="" S VALMHDR(2)="  List of Payments With Credit Cards "_$P(RCFCREDT,"^",2)_" "_$P(RCFCREDT,"^")
"RTN","RCDPLPLM",145,0)
 Q
"RTN","RCDPLPLM",146,0)
 ;
"RTN","RCDPLPLM",147,0)
 ;
"RTN","RCDPLPLM",148,0)
EXIT ;  exit list manager option and clean up
"RTN","RCDPLPLM",149,0)
 K ^TMP("RCDPLPLM",$J),^TMP("RCDPLPLMUNLINK",$J)
"RTN","RCDPLPLM",150,0)
 Q
"RTN","RCDPRSEA")
0^26^B21734319
"RTN","RCDPRSEA",1,0)
RCDPRSEA ;WISC/RFJ-extended search ;1 Jun 99
"RTN","RCDPRSEA",2,0)
 ;;4.5;Accounts Receivable;**114,148,208**;Mar 20, 1995
"RTN","RCDPRSEA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRSEA",4,0)
 ;
"RTN","RCDPRSEA",5,0)
 N DATEEND,DATESTRT,RCTRACE,RCCHECK,RCCREDIT,RCSEARCH,RCTYPE,%ZIS,ZTSAVE,ZTDESC,ZTQUEUED,ZTRTN,POP
"RTN","RCDPRSEA",6,0)
 ;  search check or credit card
"RTN","RCDPRSEA",7,0)
 W !
"RTN","RCDPRSEA",8,0)
 S RCSEARCH=$$ASKSEA
"RTN","RCDPRSEA",9,0)
 I RCSEARCH<1 Q
"RTN","RCDPRSEA",10,0)
 ;
"RTN","RCDPRSEA",11,0)
 ;  check to search for
"RTN","RCDPRSEA",12,0)
 I RCSEARCH=1 S RCCHECK=$$ASKCHEK^RCDPLPL1 I RCCHECK=-1 Q
"RTN","RCDPRSEA",13,0)
 ;  credit card to search for
"RTN","RCDPRSEA",14,0)
 I RCSEARCH=2 S RCCREDIT=$$ASKCRED^RCDPLPL1 I RCCREDIT=-1 Q
"RTN","RCDPRSEA",15,0)
 ;  ask contains or equals
"RTN","RCDPRSEA",16,0)
 S RCTYPE=$$ASKTYPE^RCDPLPL1 I RCTYPE=-1 Q
"RTN","RCDPRSEA",17,0)
 S RCTYPE=$E(RCTYPE)
"RTN","RCDPRSEA",18,0)
 ;
"RTN","RCDPRSEA",19,0)
 ;  trace # to search for
"RTN","RCDPRSEA",20,0)
 I RCSEARCH=3 S RCTRACE=$$ASKTRACE^RCDPLPL1 I RCTRACE=-1 Q
"RTN","RCDPRSEA",21,0)
 ;
"RTN","RCDPRSEA",22,0)
 ;  ask receipt open dates
"RTN","RCDPRSEA",23,0)
 W !
"RTN","RCDPRSEA",24,0)
 D DATESEL^RCRJRTRA("RECEIPT Opened")
"RTN","RCDPRSEA",25,0)
 I '$G(DATESTRT)!('$G(DATEEND)) Q
"RTN","RCDPRSEA",26,0)
 ;
"RTN","RCDPRSEA",27,0)
 ;  select device
"RTN","RCDPRSEA",28,0)
 W ! S %ZIS="Q" D ^%ZIS I POP Q
"RTN","RCDPRSEA",29,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","RCDPRSEA",30,0)
 .   S ZTDESC="Extended Check/Trace#/Credit Card Search",ZTRTN="DQ^RCDPRSEA"
"RTN","RCDPRSEA",31,0)
 .   S ZTSAVE("RC*")="",ZTSAVE("DATE*")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPRSEA",32,0)
 W !!,"<*> please wait <*>"
"RTN","RCDPRSEA",33,0)
 ;
"RTN","RCDPRSEA",34,0)
DQ ;  queue starts here
"RTN","RCDPRSEA",35,0)
 N %,%I,DATA,DATEDIS1,DATEDIS2,NOW,PAGE,RCRECTDA,RCRJFLAG,RCRJLINE,RCTRANDA,SCREEN,X,Y
"RTN","RCDPRSEA",36,0)
 ;  print report
"RTN","RCDPRSEA",37,0)
 S Y=$P(DATESTRT,".") D DD^%DT S DATEDIS1=Y
"RTN","RCDPRSEA",38,0)
 S Y=$P(DATEEND,".") D DD^%DT S DATEDIS2=Y
"RTN","RCDPRSEA",39,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","RCDPRSEA",40,0)
 S PAGE=1,RCRJLINE="",$P(RCRJLINE,"-",81)=""
"RTN","RCDPRSEA",41,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCDPRSEA",42,0)
 U IO D H
"RTN","RCDPRSEA",43,0)
 S RCRECTDA=99999999999999
"RTN","RCDPRSEA",44,0)
 F  S RCRECTDA=$O(^RCY(344,RCRECTDA),-1) Q:'RCRECTDA!($G(RCRJFLAG))  D
"RTN","RCDPRSEA",45,0)
 .   S DATA=$G(^RCY(344,RCRECTDA,0))
"RTN","RCDPRSEA",46,0)
 .   I $P(DATA,"^",3)<DATESTRT Q
"RTN","RCDPRSEA",47,0)
 .   I $P($P(DATA,"^",3),".")>DATEEND Q
"RTN","RCDPRSEA",48,0)
 .   S RCTRANDA=0 F  S RCTRANDA=$O(^RCY(344,RCRECTDA,1,RCTRANDA)) Q:'RCTRANDA!($G(RCRJFLAG))  D
"RTN","RCDPRSEA",49,0)
 .   .   I SCREEN R X:0 I X["^" S RCRJFLAG=1 Q
"RTN","RCDPRSEA",50,0)
 .   .   S DATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPRSEA",51,0)
 .   .   ;  check search
"RTN","RCDPRSEA",52,0)
 .   .   I RCSEARCH=1 D  Q
"RTN","RCDPRSEA",53,0)
 .   .   .   I RCTYPE="E",$P(DATA,"^",7)'=RCCHECK Q    ;equals
"RTN","RCDPRSEA",54,0)
 .   .   .   I $P(DATA,"^",7)'[RCCHECK Q               ;contains
"RTN","RCDPRSEA",55,0)
 .   .   .   D DISPLAY
"RTN","RCDPRSEA",56,0)
 .   .   ;  trace # search
"RTN","RCDPRSEA",57,0)
 .   .   I RCSEARCH=3 D  Q
"RTN","RCDPRSEA",58,0)
 .   .   .   N RCNUM
"RTN","RCDPRSEA",59,0)
 .   .   .   S RCNUM=$$TRACE(RCRECTDA)
"RTN","RCDPRSEA",60,0)
 .   .   .   I RCTYPE="E",RCNUM'=RCTRACE Q    ;equals
"RTN","RCDPRSEA",61,0)
 .   .   .   I RCNUM'[RCTRACE Q               ;contains
"RTN","RCDPRSEA",62,0)
 .   .   .   D DISPLAY
"RTN","RCDPRSEA",63,0)
 .   .   ;  credit card search
"RTN","RCDPRSEA",64,0)
 .   .   I RCTYPE="E",$P(DATA,"^",11)'=RCCREDIT Q    ;equals
"RTN","RCDPRSEA",65,0)
 .   .   I $P(DATA,"^",11)'[RCCREDIT Q               ;contains
"RTN","RCDPRSEA",66,0)
 .   .   D DISPLAY
"RTN","RCDPRSEA",67,0)
 ;
"RTN","RCDPRSEA",68,0)
 I '$G(RCRJFLAG),SCREEN U IO(0) R !,"Press RETURN to continue:",%:DTIME
"RTN","RCDPRSEA",69,0)
 D ^%ZISC
"RTN","RCDPRSEA",70,0)
 Q
"RTN","RCDPRSEA",71,0)
 ;
"RTN","RCDPRSEA",72,0)
 ;
"RTN","RCDPRSEA",73,0)
DISPLAY ;  display the payment
"RTN","RCDPRSEA",74,0)
 I $Y>(IOSL-6) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  W @IOF D H
"RTN","RCDPRSEA",75,0)
 ;
"RTN","RCDPRSEA",76,0)
 N ACCOUNT,DATA,DATA1
"RTN","RCDPRSEA",77,0)
 S DATA=$G(^RCY(344,RCRECTDA,0)),DATA1=DATA
"RTN","RCDPRSEA",78,0)
 ;  receipt
"RTN","RCDPRSEA",79,0)
 W !,$P(DATA,"^")
"RTN","RCDPRSEA",80,0)
 ;  date opened
"RTN","RCDPRSEA",81,0)
 W ?13,$E($P(DATA,"^",3),4,5),"/",$E($P(DATA,"^",3),6,7),"/",$E($P(DATA,"^",3),2,3)
"RTN","RCDPRSEA",82,0)
 ;  transaction number
"RTN","RCDPRSEA",83,0)
 W ?24,RCTRANDA
"RTN","RCDPRSEA",84,0)
 S DATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPRSEA",85,0)
 ;  account
"RTN","RCDPRSEA",86,0)
 S ACCOUNT=$P(DATA,"^",3)
"RTN","RCDPRSEA",87,0)
 I ACCOUNT["PRCA(430," S ACCOUNT=$P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRSEA",88,0)
 I ACCOUNT["DPT(" S ACCOUNT=$P($G(^DPT(+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRSEA",89,0)
 W ?30,$E(ACCOUNT,1,24)
"RTN","RCDPRSEA",90,0)
 ;  amount
"RTN","RCDPRSEA",91,0)
 W ?54,$J($P(DATA,"^",4),8,2)
"RTN","RCDPRSEA",92,0)
 ;  check/trace/credit card number
"RTN","RCDPRSEA",93,0)
 W $J($S(RCSEARCH=1:$P(DATA,"^",7),RCSEARCH=2:$P(DATA,"^",11),1:$$TRACE(RCRECTDA)),18)
"RTN","RCDPRSEA",94,0)
 Q
"RTN","RCDPRSEA",95,0)
 ;
"RTN","RCDPRSEA",96,0)
 ;
"RTN","RCDPRSEA",97,0)
H ;  header
"RTN","RCDPRSEA",98,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","RCDPRSEA",99,0)
 W $C(13),"EXTENDED CHECK/TRACE #/CREDIT CARD SEARCH",?(80-$L(%)),%
"RTN","RCDPRSEA",100,0)
 W !,"  FOR THE DATE RANGE: ",DATEDIS1,"  TO  ",DATEDIS2
"RTN","RCDPRSEA",101,0)
 W !,"       SEARCHING FOR: "
"RTN","RCDPRSEA",102,0)
 W $S(RCSEARCH=1:"CHECK ",RCSEARCH=2:"CREDIT CARD ",1:"TRACE # ")
"RTN","RCDPRSEA",103,0)
 W $S(RCTYPE="E":"EQUALS ",1:"CONTAINS ")
"RTN","RCDPRSEA",104,0)
 W $G(RCCHECK),$G(RCTRACE),$G(RCCREDIT)
"RTN","RCDPRSEA",105,0)
 W !,"RECEIPT",?13,"OPENDATE",?24,"TRANS",?30,"ACCOUNT",?54,$J("AMOUNT",8),$J($S(RCSEARCH=1:"CHECK#",RCSEARCH=2:"CREDITCARD#",1:"TRACE#"),18)
"RTN","RCDPRSEA",106,0)
 W !,RCRJLINE
"RTN","RCDPRSEA",107,0)
 I SCREEN W !!?10,"********** PRESS ^ at anytime to STOP search **********"
"RTN","RCDPRSEA",108,0)
 Q
"RTN","RCDPRSEA",109,0)
 ;
"RTN","RCDPRSEA",110,0)
 ;
"RTN","RCDPRSEA",111,0)
TRACE(RCRECTDA) ; Returns the trace # on a receipt
"RTN","RCDPRSEA",112,0)
 N DATA
"RTN","RCDPRSEA",113,0)
 S DATA=$G(^RCY(344,RCRECTDA,0))
"RTN","RCDPRSEA",114,0)
 Q $S($P(DATA,U,18):$P($G(^RCY(344.4,+$P(DATA,"^",18),0)),U,2),$P(DATA,U,17):$P($G(^RCY(344.31,+$P(DATA,U,17),0)),U,4),1:"")
"RTN","RCDPRSEA",115,0)
 ;
"RTN","RCDPRSEA",116,0)
ASKSEA() ;  ask search field
"RTN","RCDPRSEA",117,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPRSEA",118,0)
 S DIR(0)="SAO^1:Check;2:Credit Card;3:Trace #;"
"RTN","RCDPRSEA",119,0)
 S DIR("A")="Search for Check, Trace #, or Credit Card: "
"RTN","RCDPRSEA",120,0)
 S DIR("B")="Check"
"RTN","RCDPRSEA",121,0)
 D ^DIR
"RTN","RCDPRSEA",122,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRSEA",123,0)
 Q Y
"RTN","RCDPUREC")
0^34^B62079546
"RTN","RCDPUREC",1,0)
RCDPUREC ;WISC/RFJ-receipt utilities ;1 Jun 99
"RTN","RCDPUREC",2,0)
 ;;4.5;Accounts Receivable;**114,148,169,173,208**;Mar 20, 1995
"RTN","RCDPUREC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPUREC",4,0)
 Q
"RTN","RCDPUREC",5,0)
 ;
"RTN","RCDPUREC",6,0)
 ;
"RTN","RCDPUREC",7,0)
ADDRECT(TRANDATE,RCDEPTDA,PAYTYPDA) ;  add a receipt
"RTN","RCDPUREC",8,0)
 ;
"RTN","RCDPUREC",9,0)
 ;  if deposit or payment type is missing, do not add the receipt
"RTN","RCDPUREC",10,0)
 I 'RCDEPTDA!('PAYTYPDA) Q 0
"RTN","RCDPUREC",11,0)
 ;
"RTN","RCDPUREC",12,0)
 N DA,DATA,RCDPFLAG,RECEIPT,TYPE
"RTN","RCDPUREC",13,0)
 ;  if a receipt has already been added for this transmission date
"RTN","RCDPUREC",14,0)
 ;  and deposit number, do not add a new one
"RTN","RCDPUREC",15,0)
 S DA=0 F  S DA=$O(^RCY(344,"AD",+RCDEPTDA,DA)) Q:'DA  S DATA=$G(^RCY(344,DA,0)) I $P($P(DATA,"^",3),".")=TRANDATE,$P(DATA,"^",4)=PAYTYPDA S RCDPFLAG=1 Q
"RTN","RCDPUREC",16,0)
 I $G(RCDPFLAG) Q DA
"RTN","RCDPUREC",17,0)
 ;
"RTN","RCDPUREC",18,0)
 Q $$BLDRCPT(TRANDATE,RCDEPTDA,PAYTYPDA)
"RTN","RCDPUREC",19,0)
 ;
"RTN","RCDPUREC",20,0)
BLDRCPT(TRANDATE,RCDEPTDA,PAYTYPDA) ; Build a receipt with/without deposit
"RTN","RCDPUREC",21,0)
 ;
"RTN","RCDPUREC",22,0)
 N TYPE,RECEIPT
"RTN","RCDPUREC",23,0)
 ;  build unique receipt number for date
"RTN","RCDPUREC",24,0)
 S TYPE=$E($G(^RC(341.1,PAYTYPDA,0))) I TYPE="" S TYPE="Z"
"RTN","RCDPUREC",25,0)
 I TYPE="C",$G(RCDEPTDA)["ERACHK" S RCDEPTDA=+RCDEPTDA,TYPE="E" ; ERA plus paper check EDI Lockbox receipt
"RTN","RCDPUREC",26,0)
 ;  lockbox receipt in the form of L980901A0, do not include century
"RTN","RCDPUREC",27,0)
 F  D  Q:RECEIPT'=""
"RTN","RCDPUREC",28,0)
 . S RECEIPT=$$NEXT(TYPE_$E(TRANDATE,2,7))  ;get last two digits from 00 to ZZ
"RTN","RCDPUREC",29,0)
 . L +^RCY(344,"B",RECEIPT):2 I '$T S RECEIPT=""
"RTN","RCDPUREC",30,0)
 ;
"RTN","RCDPUREC",31,0)
 ;  add it
"RTN","RCDPUREC",32,0)
 N %,%DT,D0,DA,DD,DI,DIC,DIE,DLAYGO,DO,DQ,DR,X,Y
"RTN","RCDPUREC",33,0)
 S DIC="^RCY(344,",DIC(0)="L",DLAYGO=344
"RTN","RCDPUREC",34,0)
 ;  .02 = opened by                  .03 = date opened = transmission dt
"RTN","RCDPUREC",35,0)
 ;  .04 = type of payment            .06 = deposit ticket
"RTN","RCDPUREC",36,0)
 ;  .14 = status (set to 1:open)
"RTN","RCDPUREC",37,0)
 S DIC("DR")=".02////"_DUZ_";.03///"_TRANDATE_";.04////"_PAYTYPDA_$S(RCDEPTDA:";.06////"_RCDEPTDA,1:"")_";.14////1;"
"RTN","RCDPUREC",38,0)
 S X=RECEIPT
"RTN","RCDPUREC",39,0)
 D FILE^DICN
"RTN","RCDPUREC",40,0)
 L -^RCY(344,"B",RECEIPT)
"RTN","RCDPUREC",41,0)
 I Y>0 Q +Y
"RTN","RCDPUREC",42,0)
 Q 0
"RTN","RCDPUREC",43,0)
 ;
"RTN","RCDPUREC",44,0)
 ;
"RTN","RCDPUREC",45,0)
NEXT(RECEIPT) ;  get next 2 digits in sequence 00 to ZZ for receipt
"RTN","RCDPUREC",46,0)
 ;
"RTN","RCDPUREC",47,0)
 ;  start with 00
"RTN","RCDPUREC",48,0)
 I '$D(^RCY(344,"B",RECEIPT_"00")) Q RECEIPT_"00"
"RTN","RCDPUREC",49,0)
 ;
"RTN","RCDPUREC",50,0)
 N DIGIT1,DIGIT2,LAST
"RTN","RCDPUREC",51,0)
 ;  get the last one used and increment by 1
"RTN","RCDPUREC",52,0)
 S LAST=$O(^RCY(344,"B",RECEIPT_"ZZ"),-1)  ;example L2980901ZZ
"RTN","RCDPUREC",53,0)
 S DIGIT1=$A($E(LAST,8)),DIGIT2=$A($E(LAST,9))
"RTN","RCDPUREC",54,0)
 ;  increment the ascii value of last digit
"RTN","RCDPUREC",55,0)
 S DIGIT2=DIGIT2+1
"RTN","RCDPUREC",56,0)
 ;  ascii 48=0, 57=9, 65=A, 90=Z
"RTN","RCDPUREC",57,0)
 I DIGIT2>57,DIGIT2<65 S DIGIT2=65 ;an A
"RTN","RCDPUREC",58,0)
 ;  digit2 above a Z, set digit2 to a 0 and increment digit 1
"RTN","RCDPUREC",59,0)
 I DIGIT2>90 S DIGIT2=48,DIGIT1=DIGIT1+1
"RTN","RCDPUREC",60,0)
 I DIGIT1>57,DIGIT1<65 S DIGIT1=65 ;an A
"RTN","RCDPUREC",61,0)
 ;  digit 1 is above a Z, reset and reuse the Z
"RTN","RCDPUREC",62,0)
 I DIGIT1>90 S DIGIT1=90,DIGIT2=90
"RTN","RCDPUREC",63,0)
 ;
"RTN","RCDPUREC",64,0)
 Q RECEIPT_$C(DIGIT1)_$C(DIGIT2)
"RTN","RCDPUREC",65,0)
 ;
"RTN","RCDPUREC",66,0)
 ;
"RTN","RCDPUREC",67,0)
SELRECT(ADDNEW,RCDEPTDA) ;  select a receipt
"RTN","RCDPUREC",68,0)
 ;  if $g(addnew) allow adding a new receipt
"RTN","RCDPUREC",69,0)
 ;  if $g(rcdeptda) allow selection of receipts for the deposit only
"RTN","RCDPUREC",70,0)
 ;  if $g(addnew) and $g(rcdeptda) deposit number auto set for new receipt
"RTN","RCDPUREC",71,0)
 ;  returns -1 for timeout or ^, 0 for no selection, or ien of receipt
"RTN","RCDPUREC",72,0)
 N %,%Y,C,D0,DA,DI,DIC,DIE,DIK,DG,DLAYGO,DQ,DR,DTOUT,DUOUT,RCREFLUP,X,Y,RCDE,RCLB,RC1,RC2,RCREQ,RCY
"RTN","RCDPUREC",73,0)
 S DIC="^RCY(344,",DIC(0)="QEAM",DIC("A")="Select RECEIPT: "
"RTN","RCDPUREC",74,0)
 S DIC("W")="D DICW^RCDPUREC"
"RTN","RCDPUREC",75,0)
 ;  set screen to select receipts linked to deposit and to screen out
"RTN","RCDPUREC",76,0)
 ;  selection of EDI Lockbox-type receipts unless an EFT is associated
"RTN","RCDPUREC",77,0)
 ;  with the deposit and the receipt is not associated with an ERA
"RTN","RCDPUREC",78,0)
 S RCDE=+$O(^RCY(344.3,"ARDEP",+$G(RCDEPTDA),0))
"RTN","RCDPUREC",79,0)
 I $G(RCDEPTDA) D
"RTN","RCDPUREC",80,0)
 .   S DIC("S")="N Z S Z=$G(^(0)) I $S('$$EDILBEV^RCDPEU($P(Z,U,4)):'RCDE,1:RCDE&'$P(Z,U,18)),($P(Z,U,6)=""""!($P(Z,U,6)=RCDEPTDA))"
"RTN","RCDPUREC",81,0)
 .   S DIC("A")="Select RECEIPT (for deposit "_$P(^RCY(344.1,RCDEPTDA,0),"^")_"): "
"RTN","RCDPUREC",82,0)
 ;  use special lookup on input
"RTN","RCDPUREC",83,0)
 I '$G(RCDEPTDA) S RCREFLUP=1
"RTN","RCDPUREC",84,0)
 ;  add new entries
"RTN","RCDPUREC",85,0)
 S RC1="TYPE NOT VALID FOR THIS RECEIPT",RC2=">>AN EFT REFERENCE IS REQUIRED"
"RTN","RCDPUREC",86,0)
 I $G(ADDNEW) D
"RTN","RCDPUREC",87,0)
 .   S DIC("A")="Select RECEIPT (or add a new one): "
"RTN","RCDPUREC",88,0)
 .   S DIC(0)="QEALM",DLAYGO=344
"RTN","RCDPUREC",89,0)
 .   S DIC("DR")="S RCREQ=0;.02////"_DUZ_";.03///NOW;.14////1;@4;.04"_$S(RCDE:"////"_$$LBEVENT^RCDPEU(),1:"")
"RTN","RCDPUREC",90,0)
 .   S DIC("DR")=DIC("DR")_";S RCLB=$$EDILBEV^RCDPEU(+X) S:'RCLB Y=""@6"";I $G(RCDEPTDA) S Y=$S('RCDE:""@8"",1:""@6"");W !,RC2 S RCREQ=1;.17;S Y=""@99"""
"RTN","RCDPUREC",91,0)
 .   S DIC("DR")=DIC("DR")_";@6;.06"_$S($G(RCDEPTDA):"////"_RCDEPTDA,1:"")_";S:'RCDE Y=""@99"";.17////"_+RCDE_";S Y=""@99"";@8;W *7,!,RC1 S Y=""@4"";@99"
"RTN","RCDPUREC",92,0)
 .   S DIC("DR")=DIC("DR")_";"
"RTN","RCDPUREC",93,0)
 D ^DIC
"RTN","RCDPUREC",94,0)
 S RCY=Y
"RTN","RCDPUREC",95,0)
 I RCY<0,'$G(DUOUT),'$G(DTOUT) S RCY=0
"RTN","RCDPUREC",96,0)
 I $P(RCY,U,3),$G(RCREQ) D
"RTN","RCDPUREC",97,0)
 . I '$P($G(^RCY(344,+RCY,0)),U,17) D  Q
"RTN","RCDPUREC",98,0)
 .. W !,*7,"NO EFT REFERENCED - RECEIPT NOT ADDED"
"RTN","RCDPUREC",99,0)
 .. S DA=+RCY,DIK="^RCY(344," D ^DIK
"RTN","RCDPUREC",100,0)
 .. S RCY=0
"RTN","RCDPUREC",101,0)
 . S DIE="^RCY(344.31,",DA=$P(^RCY(344,+RCY,0),U,17),DR=".08////2" D ^DIE
"RTN","RCDPUREC",102,0)
 Q +RCY
"RTN","RCDPUREC",103,0)
 ;
"RTN","RCDPUREC",104,0)
 ;
"RTN","RCDPUREC",105,0)
DICW ;  write identifier code for receipt lookup
"RTN","RCDPUREC",106,0)
 N DATA
"RTN","RCDPUREC",107,0)
 S DATA=$G(^RCY(344,Y,0)) I DATA="" Q
"RTN","RCDPUREC",108,0)
 ;  opened by
"RTN","RCDPUREC",109,0)
 W ?13,"by: ",$E($P($G(^VA(200,+$P(DATA,"^",2),0)),"^"),1,15)
"RTN","RCDPUREC",110,0)
 ;  date opened
"RTN","RCDPUREC",111,0)
 I '$P(DATA,"^",3) S $P(DATA,"^",3)="???????"
"RTN","RCDPUREC",112,0)
 W ?35," on: ",$E($P(DATA,"^",3),4,5),"/",$E($P(DATA,"^",3),6,7),"/",$E($P(DATA,"^",3),2,3)
"RTN","RCDPUREC",113,0)
 ;  type of payment
"RTN","RCDPUREC",114,0)
 W ?50," ",$E($P($G(^RC(341.1,+$P(DATA,"^",4),0)),"^"),1,18)
"RTN","RCDPUREC",115,0)
 ;  status
"RTN","RCDPUREC",116,0)
 W ?70," ",$S($P(DATA,"^",14):"OPEN",1:"CLOSED")
"RTN","RCDPUREC",117,0)
 Q
"RTN","RCDPUREC",118,0)
 ;
"RTN","RCDPUREC",119,0)
 ;
"RTN","RCDPUREC",120,0)
LOOKUP ;  special lookup on receipts, called from ^dd(344,.01,7.5)
"RTN","RCDPUREC",121,0)
 ;  if rcreflup flag not set, do not use special lookup
"RTN","RCDPUREC",122,0)
 I '$D(RCREFLUP) Q
"RTN","RCDPUREC",123,0)
 ;  user entered O.? for lookup on open receipts
"RTN","RCDPUREC",124,0)
 I X["O."!(X["o.") S DIC("S")="I $P(^(0),U,14)" S X="?" Q
"RTN","RCDPUREC",125,0)
 ;  user entered C.? for lookup on closed receipts
"RTN","RCDPUREC",126,0)
 I X["C."!(X["c.") S DIC("S")="I '$P(^(0),U,14)" S X="?" Q
"RTN","RCDPUREC",127,0)
 K DIC("S")
"RTN","RCDPUREC",128,0)
 Q
"RTN","RCDPUREC",129,0)
 ;
"RTN","RCDPUREC",130,0)
 ;
"RTN","RCDPUREC",131,0)
EDITREC(DA,DR) ;  edit the receipt (dr = string of fields to ask)
"RTN","RCDPUREC",132,0)
 N D,D0,DI,DIC,DIE,DQ,X,Y,RCDR1,RCDR2,RCDR3,DIPA,RCDA
"RTN","RCDPUREC",133,0)
 S (DIC,DIE)="^RCY(344,",RCDA=DA
"RTN","RCDPUREC",134,0)
 I $G(DR)="" N DR D
"RTN","RCDPUREC",135,0)
 . S DR=".01;.04;"_$S($P($G(^RCY(344,RCDA,0)),U,17):"",1:"I $P($G(^RCY(344,DA,0)),U,17) S Y=""@1001"";.06;@1001;")_"D LBT^RCDPUREC(.Y);.18;@99"
"RTN","RCDPUREC",136,0)
 ;
"RTN","RCDPUREC",137,0)
 I $G(DR)[".04;" D  ; Add a check to DR string for type of payment edit
"RTN","RCDPUREC",138,0)
 . D EDIT4^RCDPURE1(RCDA,DR,.RCDR1,.RCDR2,.RCDR3)
"RTN","RCDPUREC",139,0)
 . S DR=$S($E(RCDR1,$L(RCDR1))'=";":RCDR1,1:$E(RCDR1,1,$L(RCDR1)-1)),DR(1,344,1)=RCDR2,DR(1,344,2)=RCDR3
"RTN","RCDPUREC",140,0)
 ;
"RTN","RCDPUREC",141,0)
 D ^DIE
"RTN","RCDPUREC",142,0)
 I $P($G(^RCY(344,RCDA,0)),U,6),$P(^(0),U,17),$$EDILBEV^RCDPEU(+$P(^(0),U,4)) S DIE="^RCY(344,",DR=".06///@" D ^DIE ; Delete deposit if EDI LB event and EFT referenced 
"RTN","RCDPUREC",143,0)
 I $D(^RCY(344,RCDA,0)) D LASTEDIT(RCDA)
"RTN","RCDPUREC",144,0)
 Q
"RTN","RCDPUREC",145,0)
 ;
"RTN","RCDPUREC",146,0)
LBT(Y) ; Determine if Y should be set to @99 ; DR string too long
"RTN","RCDPUREC",147,0)
 ;  Assume DA,RCM3 is set
"RTN","RCDPUREC",148,0)
 N Z,Z0
"RTN","RCDPUREC",149,0)
 S Z0=$G(^RCY(344,DA,0)),Z=($P(Z0,U,4)=$$LBEVENT^RCDPEU())
"RTN","RCDPUREC",150,0)
 ; Don't allow to edit ERA reference if worklist created it
"RTN","RCDPUREC",151,0)
 I $P($G(^RCY(344.49,+$P(Z0,U,18),0)),U,2)=DA S Y="@99" Q
"RTN","RCDPUREC",152,0)
 ; only ask for ERA if not EDI lockbox and deposit # exists
"RTN","RCDPUREC",153,0)
 I $S(Z:1,1:'$P($G(^RCY(344,DA,0)),U,6)) S Y="@99" Q
"RTN","RCDPUREC",154,0)
 W !,RCM3
"RTN","RCDPUREC",155,0)
 Q
"RTN","RCDPUREC",156,0)
 ;
"RTN","RCDPUREC",157,0)
TYP(Y) ; Determine where to jump to in the 'type' edit of the template
"RTN","RCDPUREC",158,0)
 ; DR string too long
"RTN","RCDPUREC",159,0)
 ;  Assumes RCP,RCNO,RCN4,RCO4,DA defined
"RTN","RCDPUREC",160,0)
 N RCCHANGE,RCNE
"RTN","RCDPUREC",161,0)
 I $S(RCN4=RCO4&(RCN4'=14):1,RCN4'=14&(RCO4'=14):1,1:0) S Y=RCP+2 G TYPQ
"RTN","RCDPUREC",162,0)
 ; To get here, the type was changed and it either was 14 or is now 14
"RTN","RCDPUREC",163,0)
 S RCCHANGE=(RCN4'=RCO4)
"RTN","RCDPUREC",164,0)
 I RCCHANGE D  G:Y TYPQ
"RTN","RCDPUREC",165,0)
 . ; Type can't be changed if the old type was EDI Lockbox and there is
"RTN","RCDPUREC",166,0)
 . ;    an ERA detail record associated with it
"RTN","RCDPUREC",167,0)
 . I RCO4=14,$P($G(^RCY(344,DA,0)),U,18) S Y=RCP+1 Q
"RTN","RCDPUREC",168,0)
 . ; Type can't be changed to EDI Lockbox if rcpt detail already exists
"RTN","RCDPUREC",169,0)
 . I RCN4=14,$O(^RCY(344,DA,1,0)) S Y=RCP+1 Q
"RTN","RCDPUREC",170,0)
 . ; If type changed to EDI LOCKBOX, must have an EFT reference
"RTN","RCDPUREC",171,0)
 I RCN4'=14 S Y=RCP+2 G TYPQ
"RTN","RCDPUREC",172,0)
TYPQ I '$G(Y) D
"RTN","RCDPUREC",173,0)
 . ; If ERA is matched to EFT, don't allow to edit EFT
"RTN","RCDPUREC",174,0)
 . I $P($G(^RCY(344,DA,0)),U,17),$P($G(^(0)),U,18),$D(^RCY(344.31,"AERA",+$P($G(^RCY(344,DA,0)),U,18),+$P($G(^RCY(344,DA,0)),U,17))) S Y=RCP+2 Q
"RTN","RCDPUREC",175,0)
 . S RCNE=$$ASK17^RCDPUREC(DA) I 'RCNE S RCNO=1,Y=RCP+1
"RTN","RCDPUREC",176,0)
 I $G(Y) S Y="@"_Y
"RTN","RCDPUREC",177,0)
 Q
"RTN","RCDPUREC",178,0)
 ;
"RTN","RCDPUREC",179,0)
LASTEDIT(DA) ;  set when receipt last edit
"RTN","RCDPUREC",180,0)
 N %DT,D,D0,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCDPUREC",181,0)
 S (DIC,DIE)="^RCY(344,"
"RTN","RCDPUREC",182,0)
 S DR=".11////"_DUZ_";.12///NOW;"
"RTN","RCDPUREC",183,0)
 D ^DIE
"RTN","RCDPUREC",184,0)
 Q
"RTN","RCDPUREC",185,0)
 ;
"RTN","RCDPUREC",186,0)
 ;
"RTN","RCDPUREC",187,0)
MARKPROC(DA,FMSDOCNO) ;  mark receipt as processed, set receipt as closed,
"RTN","RCDPUREC",188,0)
 ;  store fms document number if passed
"RTN","RCDPUREC",189,0)
 N %DT,D,D0,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCDPUREC",190,0)
 S (DIC,DIE)="^RCY(344,"
"RTN","RCDPUREC",191,0)
 S DR=".07////"_DUZ_";.08///NOW;.14////0;"
"RTN","RCDPUREC",192,0)
 I $G(FMSDOCNO)'="" S DR=DR_"200////"_FMSDOCNO_";"
"RTN","RCDPUREC",193,0)
 D ^DIE
"RTN","RCDPUREC",194,0)
 Q
"RTN","RCDPUREC",195,0)
 ;
"RTN","RCDPUREC",196,0)
 ;
"RTN","RCDPUREC",197,0)
FMSSTAT(RCRECTDA) ;  return the fms cr document ^ status ^ if sent before lockbox
"RTN","RCDPUREC",198,0)
 N FMSDOCNO,PRELOCK,STATUS
"RTN","RCDPUREC",199,0)
 ;  get the fms document from the receipt
"RTN","RCDPUREC",200,0)
 S FMSDOCNO=$P($G(^RCY(344,RCRECTDA,2)),"^")
"RTN","RCDPUREC",201,0)
 ;  if not on receipt, it may be earlier than lockbox and on deposit
"RTN","RCDPUREC",202,0)
 I FMSDOCNO="" S FMSDOCNO=$P($G(^RCY(344.1,+$P($G(^RCY(344,RCRECTDA,0)),"^",6),2)),"^") I FMSDOCNO'="" S PRELOCK=1
"RTN","RCDPUREC",203,0)
 S STATUS=$$STATUS^GECSSGET(FMSDOCNO)
"RTN","RCDPUREC",204,0)
 I STATUS=-1 S STATUS="NOT ENTERED"
"RTN","RCDPUREC",205,0)
 ;
"RTN","RCDPUREC",206,0)
 ;  if the cr document is entered, check to see if entered on line
"RTN","RCDPUREC",207,0)
 I FMSDOCNO'="",$P($G(^RCY(344,RCRECTDA,2)),"^",2) S STATUS="ON LINE ENTRY"
"RTN","RCDPUREC",208,0)
 ;
"RTN","RCDPUREC",209,0)
 ;  if the cr document is missing, set status to not sent
"RTN","RCDPUREC",210,0)
 I FMSDOCNO="" S FMSDOCNO="NOT SENT"
"RTN","RCDPUREC",211,0)
 ;
"RTN","RCDPUREC",212,0)
 Q FMSDOCNO_"^"_STATUS_"^"_$G(PRELOCK)
"RTN","RCDPUREC",213,0)
 ;
"RTN","RCDPUREC",214,0)
ASK17(DA) ; Ask,return the EFT detail record for a receipt
"RTN","RCDPUREC",215,0)
 ; DA = the ien of the RECEIPT (file 344)
"RTN","RCDPUREC",216,0)
 N DIR,X,Y
"RTN","RCDPUREC",217,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("?",1)="Select the EFT that contained the deposited money that this receipt details",DIR("?",2)="An EFT detail record can only be associated with one receipt"
"RTN","RCDPUREC",218,0)
 S DIR("?")="This is required if the type of payment is EDI LOCKBOX"
"RTN","RCDPUREC",219,0)
 S DIR("A")="  EFT DETAIL RECORD: ",DIR("S")="I $S('$O(^RCY(344,""AEFT"",+Y,0)):1,1:$O(^(0))=DA)"
"RTN","RCDPUREC",220,0)
 S:$P($G(^RCY(344,DA,0)),U,17) DIR("B")=$P(^(0),U,17)
"RTN","RCDPUREC",221,0)
 D ^DIR K DIR
"RTN","RCDPUREC",222,0)
 I $D(DUOUT)!$D(DTOUT)!Y=""!(Y<0) Q 0
"RTN","RCDPUREC",223,0)
 Q +Y
"RTN","RCDPUREC",224,0)
 ;
"RTN","RCY208EN")
0^^B4001175
"RTN","RCY208EN",1,0)
RCY208EN ;ALB/TMK - PATCH PRCA*4.5*208 ENVIRONMENT CHECK ;26-FEB-2004
"RTN","RCY208EN",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCY208EN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCY208EN",4,0)
ENV ;
"RTN","RCY208EN",5,0)
 ;this is the environment check routine
"RTN","RCY208EN",6,0)
 I $$PATCH^XPDUTL("PRCA*4.5*175") D
"RTN","RCY208EN",7,0)
 . W "You are a test site for a CoreFLS version (patch PRCA*4.5*175) of Accounts",!
"RTN","RCY208EN",8,0)
 . W "Receivable. This patch has a conflict with the AR-CoreFLS test software.",!
"RTN","RCY208EN",9,0)
 . W "It must NOT be installed unless an accompanying update is made to the",!
"RTN","RCY208EN",10,0)
 . W "AR-CoreFLS software immediately after installation of this patch.",!!
"RTN","RCY208EN",11,0)
 . N DIR,DTOUT,DUOUT,Y
"RTN","RCY208EN",12,0)
 . S DIR(0)="YA"
"RTN","RCY208EN",13,0)
 . S DIR("A")="Do you have the corresponding update to the AR-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","RCY208EN",14,0)
 . D ^DIR
"RTN","RCY208EN",15,0)
 . I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=1 Q
"RTN","RCY208EN",16,0)
 . W !,"OK to install!"
"RTN","RCY208EN",17,0)
 Q
"RTN","RCY208EN",18,0)
 ;
"RTN","RCY208PO")
0^^B15574527
"RTN","RCY208PO",1,0)
RCY208PO ;ALB/TMK - PRCA*4.5*208 POST-INSTALL ;08-JAN-2004
"RTN","RCY208PO",2,0)
 ;;4.5;Accounts Receivable;**208**;Mar 20, 1995
"RTN","RCY208PO",3,0)
 ;
"RTN","RCY208PO",4,0)
POST ;Set up check points for post-init
"RTN","RCY208PO",5,0)
 N %
"RTN","RCY208PO",6,0)
 S %=$$NEWCP^XPDUTL("REV","REVIEW^RCY208PO")
"RTN","RCY208PO",7,0)
 S %=$$NEWCP^XPDUTL("INDX","INDEX^RCY208PO")
"RTN","RCY208PO",8,0)
 S %=$$NEWCP^XPDUTL("CLEAN","CLEANUP^RCY208PO")
"RTN","RCY208PO",9,0)
 S %=$$NEWCP^XPDUTL("END","END^RCY208PO") ; Leave as last update
"RTN","RCY208PO",10,0)
 Q
"RTN","RCY208PO",11,0)
 ;
"RTN","RCY208PO",12,0)
REVIEW N %,RCB,RCZ,RCZ0,RCY,RC,RCWP,DD,DO,DA,X,Y,DLAYGO,DIC,DIK,DIU
"RTN","RCY208PO",13,0)
 D BMES^XPDUTL("Moving review comments into new fields")
"RTN","RCY208PO",14,0)
 S RCZ=+$$PARCP^XPDUTL("REV") ; Get the last entry processed on a previous install of this patch
"RTN","RCY208PO",15,0)
 D BMES^XPDUTL("Starting at entry # "_(RCZ+1))
"RTN","RCY208PO",16,0)
 F  S RCZ=$O(^RCY(344.49,RCZ)) Q:'RCZ  S RCZ0=0 F  S RCZ0=$O(^RCY(344.49,RCZ,1,RCZ0)) Q:'RCZ0  I $D(^RCY(344.49,RCZ,1,RCZ0,3,0)) D
"RTN","RCY208PO",17,0)
 . I $O(^RCY(344.49,RCZ,1,RCZ0,3,0)) D  ; If any review data, create new entry for review
"RTN","RCY208PO",18,0)
 .. S DA(2)=RCZ,DA(1)=RCZ0,DIC(0)="L",DLAYGO=344.4914,DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,",X=$$NOW^XLFDT(),DIC("DR")=".02////.5" K DO,DD D FILE^DICN K DO,DD,DLAYGO,DIC ; Add the multiple
"RTN","RCY208PO",19,0)
 .. S RCY=+Y
"RTN","RCY208PO",20,0)
 .. ;Add comment line to indicate post-install moved text and then move the rest of the existing text after it.
"RTN","RCY208PO",21,0)
 .. K RCWP
"RTN","RCY208PO",22,0)
 .. S RCWP(1)="REVIEW COPIED HERE BY POST-INSTALL FOR e-PAYMENTS ENHANCEMENTS PATCH"
"RTN","RCY208PO",23,0)
 .. S RC=1,RCB=0 F  S RCB=$O(^RCY(344.49,RCZ,1,RCZ0,3,RCB)) Q:'RCB  S RC=RC+1,RCWP(RC)=$G(^(RCB,0))
"RTN","RCY208PO",24,0)
 .. D WP^DIE(344.4914,RCY_","_RCZ0_","_RCZ_",",.03,"","RCWP")
"RTN","RCY208PO",25,0)
 . I $D(^RCY(344.49,RCZ,1,RCZ0,3)) D WP^DIE(344.491,RCZ0_","_RCZ_",",3,"","@")
"RTN","RCY208PO",26,0)
 . S %=$$UPCP^XPDUTL("REV",RCZ) ; Store the last record processed in the file
"RTN","RCY208PO",27,0)
 ; Now delete the DD entry completely from the system
"RTN","RCY208PO",28,0)
 D BMES^XPDUTL("Deleting the old REVIEW NOTES field definition")
"RTN","RCY208PO",29,0)
 S DIU(0)="S",DIU=344.4913 D EN^DIU2
"RTN","RCY208PO",30,0)
 D COMPLETE
"RTN","RCY208PO",31,0)
 Q
"RTN","RCY208PO",32,0)
 ;
"RTN","RCY208PO",33,0)
INDEX ; Re-index the FILE DATE/TIME field (.07) in file 344.4
"RTN","RCY208PO",34,0)
 D BMES^XPDUTL("Creating new 'AFD' cross ref for field FILE DATE/TIME (#.07) in the ELECTRONIC REMITTANCE ADVICE file (#344.4)")
"RTN","RCY208PO",35,0)
 I '$D(^RCY(344.4,"AFD")) S DIK="^RCY(344.4,",DIK(1)=.07 D ENALL^DIK
"RTN","RCY208PO",36,0)
 D COMPLETE
"RTN","RCY208PO",37,0)
 Q
"RTN","RCY208PO",38,0)
CLEANUP ; Cleans up the EFTs matched to paper EOBs being unmatched
"RTN","RCY208PO",39,0)
 N Z,Z0,Z1,Z2,DIE,DA,DR,RCCT
"RTN","RCY208PO",40,0)
 D BMES^XPDUTL("Cleaning up EFTs matched to paper EOBs")
"RTN","RCY208PO",41,0)
 S Z=0 F  S Z=$O(^RCY(344.31,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCY208PO",42,0)
 . S Z1=$O(^RCY(344,"AEFT",Z,0))
"RTN","RCY208PO",43,0)
 . Q:'Z1  ; No receipt exists for the EFT detail
"RTN","RCY208PO",44,0)
 . I '$P(Z0,U,8) D  Q  ; Marked as not matched for EFT detail
"RTN","RCY208PO",45,0)
 .. S Z2=$G(^RCY(344,Z1,0)),DIE="^RCY(344,",DA=Z,DR=".08////"_$S($P(Z2,U,18):1,1:2) D ^DIE ; Update the match status of EFT detail
"RTN","RCY208PO",46,0)
 . I $P(Z0,U,8)["1",$P(Z0,U,10) D  ; EFT is matched with an ERA
"RTN","RCY208PO",47,0)
 .. S Z2=$G(^RCY(344.4,+$P(Z0,U,10),0))
"RTN","RCY208PO",48,0)
 .. I $P(Z2,U,8)'=Z1 D  ; EFT detail receipt is not the ERA's receipt
"RTN","RCY208PO",49,0)
 ... S DA=Z,DR=".1///@;.08////2",DIE="^RCY(344.31," D ^DIE
"RTN","RCY208PO",50,0)
 .. ; Now if no receipt on ERA, change it to matched to paper EOB
"RTN","RCY208PO",51,0)
 .. I '$P(Z2,U,8) S DA=+$P(Z0,U,10),DIE="^RCY(344.4,",DR=".09////4;.14////3;20.03////1" D ^DIE
"RTN","RCY208PO",52,0)
 D COMPLETE
"RTN","RCY208PO",53,0)
 D BMES^XPDUTL("Cleaning up 0-payment ERAs matched to paper check")
"RTN","RCY208PO",54,0)
 S RCCT="NO"
"RTN","RCY208PO",55,0)
 S Z=0 F  S Z=$O(^RCY(344.4,Z)) Q:'Z  S Z0=$G(^(Z,0)) I $P(Z0,U,15)="CHK",'$P(Z0,U,5),$P(Z0,U,9)=2 S DIE="^RCY(344.4,",DR=".09////3;.14////3",DA=Z D ^DIE S RCCT=RCCT+1
"RTN","RCY208PO",56,0)
 D BMES^XPDUTL(RCCT_" ERAs marked as 'MATCH - 0 PAYMENT'")
"RTN","RCY208PO",57,0)
 D COMPLETE
"RTN","RCY208PO",58,0)
 Q
"RTN","RCY208PO",59,0)
 ;
"RTN","RCY208PO",60,0)
COMPLETE ;
"RTN","RCY208PO",61,0)
 D BMES^XPDUTL("Step complete.")
"RTN","RCY208PO",62,0)
 Q
"RTN","RCY208PO",63,0)
 ;
"RTN","RCY208PO",64,0)
END ;
"RTN","RCY208PO",65,0)
 D BMES^XPDUTL("Post install complete.")
"RTN","RCY208PO",66,0)
 Q
"RTN","RCY208PO",67,0)
 ;
"UP",344.49,344.491,-1)
344.49^1
"UP",344.49,344.491,0)
344.491
"UP",344.49,344.4914,-2)
344.49^1
"UP",344.49,344.4914,-1)
344.491^4
"UP",344.49,344.4914,0)
344.4914
"UP",344.49,344.49141,-3)
344.49^1
"UP",344.49,344.49141,-2)
344.491^4
"UP",344.49,344.49141,-1)
344.4914^1
"UP",344.49,344.49141,0)
344.49141
"UP",344.49,344.492,-1)
344.49^2
"UP",344.49,344.492,0)
344.492
"UP",344.49,344.493,-1)
344.49^3
"UP",344.49,344.493,0)
344.493
"VER")
8.0^22.0
"^DD",344,344,.01,0)
RECEIPT #^RFX^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>10!($L(X)<7) X D:$D(X) DUPLCATE^RCDPURED
"^DD",344,344,.01,1,0)
^.1
"^DD",344,344,.01,1,1,0)
344^B
"^DD",344,344,.01,1,1,1)
S ^RCY(344,"B",$E(X,1,30),DA)=""
"^DD",344,344,.01,1,1,2)
K ^RCY(344,"B",$E(X,1,30),DA)
"^DD",344,344,.01,1,1,3)
Needed to look-up Batch Payment entries by RECEIPT NUMBER
"^DD",344,344,.01,1,1,"%D",0)
^^2^2^2930609^^^
"^DD",344,344,.01,1,1,"%D",1,0)
This cross-reference is used for sorting and file look-up by receipt
"^DD",344,344,.01,1,1,"%D",2,0)
#.
"^DD",344,344,.01,1,2,0)
^^TRIGGER^344.4^.08
"^DD",344,344,.01,1,2,1)
Q
"^DD",344,344,.01,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 X ^DD(344,.01,1,2,89.2) S X=$P($G(^RCY(344,+$P(Y(101),U,8),0)),U) S D0=I(0,0) S DIU=X K Y S X="" S DIH=$G(^RCY(344.4,DIV(0),0)),DIV=X I $D(^(0)) S $P(^(0),U,8)=DIV,DIH=344.4,DIG=.08 D ^DICR
"^DD",344,344,.01,1,2,3)
Do not delete
"^DD",344,344,.01,1,2,89.2)
S I(0,0)=$G(D0),Y(1)=$S($D(^RCY(344,D0,0)):^(0),1:""),D0=$P(Y(1),U,18) S:'D0!'$D(^RCY(344.4,+D0,0)) D0=-1 S DIV(0)=D0 S Y(101)=$S($D(^RCY(344.4,D0,0)):^(0),1:"")
"^DD",344,344,.01,1,2,"CREATE VALUE")
NO EFFECT
"^DD",344,344,.01,1,2,"DELETE VALUE")
@
"^DD",344,344,.01,1,2,"DT")
3040405
"^DD",344,344,.01,1,2,"FIELD")
ERA REFERENCE:RECEIPT
"^DD",344,344,.01,3)
Answer must be 7-10 characters in length.
"^DD",344,344,.01,7.5)
D LOOKUP^RCDPUREC
"^DD",344,344,.01,21,0)
^^4^4^2930927^^^^
"^DD",344,344,.01,21,1,0)
This field should reflect the field service receipt number.
"^DD",344,344,.01,21,2,0)
This field is assigned during entry of payments and will separate
"^DD",344,344,.01,21,3,0)
different types of payment (cash, check, or credit card) for a
"^DD",344,344,.01,21,4,0)
particular user for a given time-frame.
"^DD",344,344,.01,"DT")
3040405
"^DD",344.31,344.31,.16,0)
MANUAL TR DOCUMENT^F^^0;16^K:$L(X)>30!($L(X)<2)!'(X?1"TR".E) X
"^DD",344.31,344.31,.16,3)
Answer must be 2-30 characters in length.
"^DD",344.31,344.31,.16,21,0)
^.001^4^4^3040426^^
"^DD",344.31,344.31,.16,21,1,0)
This is the TR document that was entered on-line to manually post the
"^DD",344.31,344.31,.16,21,2,0)
EFT detail to the correct accounts and remove them from FUND 5287.4,
"^DD",344.31,344.31,.16,21,3,0)
revenue source code 8NZZ.  This is used when a RECEIPT was not used to
"^DD",344.31,344.31,.16,21,4,0)
automatically generate a TR document for the EFT detail record.
"^DD",344.31,344.31,.16,"DT")
3040426
"^DD",344.4,344.4,.07,0)
FILE DATE/TIME^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",344.4,344.4,.07,1,0)
^.1
"^DD",344.4,344.4,.07,1,1,0)
344.4^AFD
"^DD",344.4,344.4,.07,1,1,1)
S ^RCY(344.4,"AFD",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.07,1,1,2)
K ^RCY(344.4,"AFD",$E(X,1,30),DA)
"^DD",344.4,344.4,.07,1,1,3)
Do not delete
"^DD",344.4,344.4,.07,1,1,"%D",0)
^^1^1^3040121^
"^DD",344.4,344.4,.07,1,1,"%D",1,0)
Created to find entries to include on ERA worklist pick list.
"^DD",344.4,344.4,.07,1,1,"DT")
3040121
"^DD",344.4,344.4,.07,3)
Enter the date/time the ERA was filed in VistA.
"^DD",344.4,344.4,.07,21,0)
^^1^1^3020613^
"^DD",344.4,344.4,.07,21,1,0)
This is the date/time the ERA was filed in VistA.
"^DD",344.4,344.4,.07,"DT")
3040121
"^DD",344.4,344.4,.08,0)
RECEIPT^P344'^RCY(344,^0;8^Q
"^DD",344.4,344.4,.08,1,0)
^.1
"^DD",344.4,344.4,.08,1,1,0)
344.4^AREC
"^DD",344.4,344.4,.08,1,1,1)
S ^RCY(344.4,"AREC",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.08,1,1,2)
K ^RCY(344.4,"AREC",$E(X,1,30),DA)
"^DD",344.4,344.4,.08,1,1,3)
Do not delete
"^DD",344.4,344.4,.08,1,1,"DT")
3030326
"^DD",344.4,344.4,.08,1,2,0)
^^TRIGGER^344.49^.02
"^DD",344.4,344.4,.08,1,2,1)
Q
"^DD",344.4,344.4,.08,1,2,2)
X ^DD(344.4,.08,1,2,2.3) I X S X=DIV S I(0,0)=$G(D0),D0=D0 S:'D0!'$D(^RCY(344.49,+D0,0)) D0=-1 S DIV(0)=D0,Y(101)=$S($D(^RCY(344.49,D0,0)):^(0),1:"") S X=$P($G(^RCY(344,+$P(Y(101),U,2),0)),U),D0=I(0,0),DIU=X K Y S X="" X ^DD(344.4,.08,1,2,2.4)
"^DD",344.4,344.4,.08,1,2,2.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RCY(344.4,D0,0)):^(0),1:"") S X=$P($G(^RCY(344,+$P(Y(1),U,8),0)),U)=""
"^DD",344.4,344.4,.08,1,2,2.4)
S DIH=$G(^RCY(344.49,DIV(0),0)),DIV=X I $D(^(0)) S $P(^(0),U,2)=DIV,DIH=344.49,DIG=.02 D ^DICR
"^DD",344.4,344.4,.08,1,2,3)
Do not delete
"^DD",344.4,344.4,.08,1,2,"CREATE VALUE")
NO EFFECT
"^DD",344.4,344.4,.08,1,2,"DELETE CONDITION")
RECEIPT=""
"^DD",344.4,344.4,.08,1,2,"DELETE VALUE")
@
"^DD",344.4,344.4,.08,1,2,"DT")
3040406
"^DD",344.4,344.4,.08,1,2,"FIELD")
EDI LOCKBOX EOB WORKLIST:RECEIPT
"^DD",344.4,344.4,.08,3)
Enter the receipt that this ERA detail is contained in.
"^DD",344.4,344.4,.08,5,1,0)
344^.01^2
"^DD",344.4,344.4,.08,21,0)
^^1^1^3020613^
"^DD",344.4,344.4,.08,21,1,0)
This is the receipt created to record the detail of the ERA for AR posting.
"^DD",344.4,344.4,.08,"DT")
3040406
"^DD",344.4,344.4,.14,0)
DETAIL POST STATUS^S^0:NOT POSTED;1:POSTED;2:MANUALLY POSTED;3:POSTING NOT NEEDED;4:NOT POSTED-RETURNED;^0;14^Q
"^DD",344.4,344.4,.14,3)
Enter the code that corresponds to whether or not the ERA detail was posted and if so, if it was manually posted.
"^DD",344.4,344.4,.14,5,1,0)
344.4^.01^2
"^DD",344.4,344.4,.14,21,0)
^.001^3^3^3040429^^^
"^DD",344.4,344.4,.14,21,1,0)
This is a flag that indicates whether or not the receipt for the ERA has 
"^DD",344.4,344.4,.14,21,2,0)
been posted.  It is used to limit the choices when selecting ERAs for the 
"^DD",344.4,344.4,.14,21,3,0)
worklist function.
"^DD",344.4,344.4,.14,"DT")
3040429
"^DD",344.49,344.49,2,0)
USER PREFERENCE^344.492PA^^2;0
"^DD",344.49,344.49,2,21,0)
^.001^3^3^3040316^^
"^DD",344.49,344.49,2,21,1,0)
This is a collection of all the preferences recorded for a user so default
"^DD",344.49,344.49,2,21,2,0)
settings can be applied customized by user when the worklist entry is
"^DD",344.49,344.49,2,21,3,0)
selected.
"^DD",344.49,344.49,3,0)
BATCH^344.493I^^3;0
"^DD",344.49,344.49,3,21,0)
^.001^3^3^3040316^^
"^DD",344.49,344.49,3,21,1,0)
This multiple field holds a record for each batch defined for the ERA.
"^DD",344.49,344.49,3,21,2,0)
It will hold the number of the batch, the name of the batch and other
"^DD",344.49,344.49,3,21,3,0)
data related specifically to each batch within the ERA.
"^DD",344.49,344.49,3,"DT")
3040115
"^DD",344.49,344.491,.13,0)
VERIFIED^S^0:NO;1:YES;^0;13^Q
"^DD",344.49,344.491,.13,1,0)
^.1
"^DD",344.49,344.491,.13,1,1,0)
344.491^ANV
"^DD",344.49,344.491,.13,1,1,1)
S ^RCY(344.49,DA(1),1,"ANV",$E(X,1,30),DA)=""
"^DD",344.49,344.491,.13,1,1,2)
K ^RCY(344.49,DA(1),1,"ANV",$E(X,1,30),DA)
"^DD",344.49,344.491,.13,1,1,3)
Do not delete
"^DD",344.49,344.491,.13,1,1,"DT")
3040212
"^DD",344.49,344.491,.13,3)
Enter a 1 (YES) if the EEOB's verification data has been matched correctly to the VistA claim's data.
"^DD",344.49,344.491,.13,21,0)
^.001^3^3^3040316^^
"^DD",344.49,344.491,.13,21,1,0)
This is the flag that indicates the EEOB's verification data has been 
"^DD",344.49,344.491,.13,21,2,0)
matched correctly to the VistA claim's data, either automatically or
"^DD",344.49,344.491,.13,21,3,0)
manually to determine that the claim paid was the correct claim.
"^DD",344.49,344.491,.13,"DT")
3040212
"^DD",344.49,344.491,.14,0)
BATCH #^NJ3,0^^0;14^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",344.49,344.491,.14,1,0)
^.1
"^DD",344.49,344.491,.14,1,1,0)
344.491^ABAT
"^DD",344.49,344.491,.14,1,1,1)
S ^RCY(344.49,DA(1),1,"ABAT",$E(X,1,30),DA)=""
"^DD",344.49,344.491,.14,1,1,2)
K ^RCY(344.49,DA(1),1,"ABAT",$E(X,1,30),DA)
"^DD",344.49,344.491,.14,1,1,3)
Do not delete
"^DD",344.49,344.491,.14,1,1,"DT")
3040219
"^DD",344.49,344.491,.14,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",344.49,344.491,.14,21,0)
^.001^2^2^3040316^^
"^DD",344.49,344.491,.14,21,1,0)
This is the # assigned to this EEOB for the batch in which it will be 
"^DD",344.49,344.491,.14,21,2,0)
accessible.
"^DD",344.49,344.491,.14,"DT")
3040219
"^DD",344.49,344.491,4,0)
REVIEW^344.4914D^^4;0
"^DD",344.49,344.491,4,21,0)
^.001^2^2^3040102^^
"^DD",344.49,344.491,4,21,1,0)
This is the data relating to the notes entered by the user when reviewing
"^DD",344.49,344.491,4,21,2,0)
the EEOB.
"^DD",344.49,344.4914,0)
REVIEW SUB-FIELD^^.04^4
"^DD",344.49,344.4914,0,"DT")
3040108
"^DD",344.49,344.4914,0,"IX","B",344.4914,.01)

"^DD",344.49,344.4914,0,"NM","REVIEW")

"^DD",344.49,344.4914,0,"UP")
344.491
"^DD",344.49,344.4914,.01,0)
REVIEW DATE/TIME^D^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",344.49,344.4914,.01,1,0)
^.1
"^DD",344.49,344.4914,.01,1,1,0)
344.4914^B
"^DD",344.49,344.4914,.01,1,1,1)
S ^RCY(344.49,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",344.49,344.4914,.01,1,1,2)
K ^RCY(344.49,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)
"^DD",344.49,344.4914,.01,3)
Enter the date/time that the review was entered.
"^DD",344.49,344.4914,.01,21,0)
^.001^1^1^3040102^^
"^DD",344.49,344.4914,.01,21,1,0)
The date/time the review comment was entered.
"^DD",344.49,344.4914,.01,"DT")
3040102
"^DD",344.49,344.4914,.02,0)
REVIEWED BY^P200'^VA(200,^0;2^Q
"^DD",344.49,344.4914,.02,1,0)
^.1
"^DD",344.49,344.4914,.02,1,1,0)
344.491^AC
"^DD",344.49,344.4914,.02,1,1,1)
S ^RCY(344.49,DA(2),1,"AC",$E(X,1,30),DA(1),DA)=""
"^DD",344.49,344.4914,.02,1,1,2)
K ^RCY(344.49,DA(2),1,"AC",$E(X,1,30),DA(1),DA)
"^DD",344.49,344.4914,.02,1,1,3)
Do not delete
"^DD",344.49,344.4914,.02,1,1,"%D",0)
^^1^1^3040108^
"^DD",344.49,344.4914,.02,1,1,"%D",1,0)
This xref allows a quick lookup of one user's comments for the EEOB.
"^DD",344.49,344.4914,.02,1,1,"DT")
3040108
"^DD",344.49,344.4914,.02,3)
Enter the name of the person who entered this review.
"^DD",344.49,344.4914,.02,21,0)
^^2^2^3040102^
"^DD",344.49,344.4914,.02,21,1,0)
This is the pointer to the NEW PERSON file for the person who entered
"^DD",344.49,344.4914,.02,21,2,0)
the review comment.
"^DD",344.49,344.4914,.02,"DT")
3040108
"^DD",344.49,344.4914,.03,0)
COMMENT^344.49141^^1;0
"^DD",344.49,344.4914,.04,0)
LAST EDITED DATE/TIME^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",344.49,344.4914,.04,3)
Enter the date/time this comment was last edited.
"^DD",344.49,344.4914,.04,21,0)
^^1^1^3040108^
"^DD",344.49,344.4914,.04,21,1,0)
This is the date/time this comment was last edited.
"^DD",344.49,344.4914,.04,"DT")
3040108
"^DD",344.49,344.49141,0)
COMMENT SUB-FIELD^^.01^1
"^DD",344.49,344.49141,0,"DT")
3040106
"^DD",344.49,344.49141,0,"NM","COMMENT")

"^DD",344.49,344.49141,0,"UP")
344.4914
"^DD",344.49,344.49141,.01,0)
COMMENT^WL^^0;1^Q
"^DD",344.49,344.49141,.01,3)
Enter the review comment pertaining to this EEOB.
"^DD",344.49,344.49141,.01,21,0)
^^2^2^3040106^
"^DD",344.49,344.49141,.01,21,1,0)
The review comment as entered by the user regarding their review of this
"^DD",344.49,344.49141,.01,21,2,0)
EEOB.
"^DD",344.49,344.49141,.01,"DT")
3040106
"^DD",344.49,344.492,0)
USER PREFERENCE SUB-FIELD^^.03^3
"^DD",344.49,344.492,0,"DT")
3040102
"^DD",344.49,344.492,0,"IX","B",344.492,.01)

"^DD",344.49,344.492,0,"NM","USER PREFERENCE")

"^DD",344.49,344.492,0,"UP")
344.49
"^DD",344.49,344.492,.01,0)
CLERK^P200'^VA(200,^0;1^Q
"^DD",344.49,344.492,.01,1,0)
^.1
"^DD",344.49,344.492,.01,1,1,0)
344.492^B
"^DD",344.49,344.492,.01,1,1,1)
S ^RCY(344.49,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",344.49,344.492,.01,1,1,2)
K ^RCY(344.49,DA(1),2,"B",$E(X,1,30),DA)
"^DD",344.49,344.492,.01,3)
Enter the user for whom the preference are being stored.
"^DD",344.49,344.492,.01,21,0)
^.001^2^2^3040102^^
"^DD",344.49,344.492,.01,21,1,0)
This is the user whose preferences are being recorded for this worklist
"^DD",344.49,344.492,.01,21,2,0)
entry.
"^DD",344.49,344.492,.01,"DT")
3040102
"^DD",344.49,344.492,.02,0)
REVIEW ON?^S^0:NO;1:YES;^0;2^Q
"^DD",344.49,344.492,.02,3)
Enter a 1 (YES) if review data should be shown on entry to the worklist.
"^DD",344.49,344.492,.02,21,0)
^^2^2^3040102^
"^DD",344.49,344.492,.02,21,1,0)
This flag indicates whether or not the last time this user accessed
"^DD",344.49,344.492,.02,21,2,0)
the worklist, the review data was displayed.
"^DD",344.49,344.492,.02,"DT")
3040102
"^DD",344.49,344.492,.03,0)
LAST ORDER SELECTION^S^N:NO ORDER;F:ZERO-PAYMENTS FIRST;L:ZERO-PAYMENTS LAST;^0;3^Q
"^DD",344.49,344.492,.03,3)
Enter the code corresponding to the sort order the user last used when accessing the worklist entry.
"^DD",344.49,344.492,.03,21,0)
^^1^1^3040102^
"^DD",344.49,344.492,.03,21,1,0)
This is the sort order the user last used when accessing the worklist entry.
"^DD",344.49,344.492,.03,"DT")
3040106
"^DD",344.49,344.493,0)
BATCH SUB-FIELD^^.08^8
"^DD",344.49,344.493,0,"DT")
3040212
"^DD",344.49,344.493,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",344.49,344.493,0,"ID",.03)
D EN^DDIOL($S('$P(^(0),U,3):"NOT ",1:"")_"READY TO POST",,"?$X+2")
"^DD",344.49,344.493,0,"IX","B",344.493,.01)

"^DD",344.49,344.493,0,"IX","C",344.493,.02)

"^DD",344.49,344.493,0,"NM","BATCH")

"^DD",344.49,344.493,0,"UP")
344.49
"^DD",344.49,344.493,.01,0)
BATCH #^MNJ3,0X^^0;1^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X I $D(X) S DINUM=X
"^DD",344.49,344.493,.01,1,0)
^.1
"^DD",344.49,344.493,.01,1,1,0)
344.493^B
"^DD",344.49,344.493,.01,1,1,1)
S ^RCY(344.49,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",344.49,344.493,.01,1,1,2)
K ^RCY(344.49,DA(1),3,"B",$E(X,1,30),DA)
"^DD",344.49,344.493,.01,3)
Type a Number between 0 and 999, 0 Decimal Digits
"^DD",344.49,344.493,.01,21,0)
^.001^1^1^3040115^^
"^DD",344.49,344.493,.01,21,1,0)
This is the batch # assigned to a group of EEOBs within the ERA record.
"^DD",344.49,344.493,.01,"DT")
3040210
"^DD",344.49,344.493,.02,0)
NAME^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",344.49,344.493,.02,1,0)
^.1
"^DD",344.49,344.493,.02,1,1,0)
344.493^C
"^DD",344.49,344.493,.02,1,1,1)
S ^RCY(344.49,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",344.49,344.493,.02,1,1,2)
K ^RCY(344.49,DA(1),3,"C",$E(X,1,30),DA)
"^DD",344.49,344.493,.02,1,1,3)
Do not delete
"^DD",344.49,344.493,.02,1,1,"DT")
3040422
"^DD",344.49,344.493,.02,3)
Answer must be 1-30 characters in length.
"^DD",344.49,344.493,.02,21,0)
^^1^1^3040115^
"^DD",344.49,344.493,.02,21,1,0)
This is the name assigned to the batch.
"^DD",344.49,344.493,.02,"DT")
3040422
"^DD",344.49,344.493,.03,0)
READY FOR POSTING^SO^0:NO;1:YES;^0;3^Q
"^DD",344.49,344.493,.03,2)
S Y(0)=Y S Y=$S(Y:"",1:"NOT ")_"READY TO POST"
"^DD",344.49,344.493,.03,2.1)
S Y=$S(Y:"",1:"NOT ")_"READY TO POST"
"^DD",344.49,344.493,.03,3)
Enter 1 (YES) if all the batch's records are ready to be posted.
"^DD",344.49,344.493,.03,21,0)
^^3^3^3040115^
"^DD",344.49,344.493,.03,21,1,0)
This is a flag that indicates whether or not a user has indicated the batch
"^DD",344.49,344.493,.03,21,2,0)
is ready to be posted.  All batches must be flagged as ready before a
"^DD",344.49,344.493,.03,21,3,0)
receipt can be created from the worklist entry.
"^DD",344.49,344.493,.03,"DT")
3040212
"^DD",344.49,344.493,.04,0)
POSTING FLAG SET BY^P200'^VA(200,^0;4^Q
"^DD",344.49,344.493,.04,3)
Enter the name of the user who set the flag to 1 for batch ready to post.
"^DD",344.49,344.493,.04,21,0)
^^1^1^3040115^
"^DD",344.49,344.493,.04,21,1,0)
This is the name of the user who set the flag to 1 for batch ready to post.
"^DD",344.49,344.493,.04,"DT")
3040115
"^DD",344.49,344.493,.05,0)
BATCH IN USE^S^0:NO;1:YES;^0;5^Q
"^DD",344.49,344.493,.05,1,0)
^.1
"^DD",344.49,344.493,.05,1,1,0)
344.49^AINUSE
"^DD",344.49,344.493,.05,1,1,1)
S ^RCY(344.49,"AINUSE",$E(X,1,30),DA(1),DA)=""
"^DD",344.49,344.493,.05,1,1,2)
K ^RCY(344.49,"AINUSE",$E(X,1,30),DA(1),DA)
"^DD",344.49,344.493,.05,1,1,3)
Do not delete
"^DD",344.49,344.493,.05,1,1,"%D",0)
^^2^2^3040211^
"^DD",344.49,344.493,.05,1,1,"%D",1,0)
This xref allows for a quick check to see if any batches within the ERA
"^DD",344.49,344.493,.05,1,1,"%D",2,0)
are in use or not.
"^DD",344.49,344.493,.05,1,1,"DT")
3040211
"^DD",344.49,344.493,.05,3)
Enter 1 (YES) if the batch is currently being used.
"^DD",344.49,344.493,.05,21,0)
^^1^1^3040211^
"^DD",344.49,344.493,.05,21,1,0)
If the batch is currently being used, this field will be set to YES (1).
"^DD",344.49,344.493,.05,"DT")
3040211
"^DD",344.49,344.493,.06,0)
CRITERIA USED^S^1:MAX #;2:NAME RANGE;3:PAYMENT PART/FULL/NONE;4:COPAY/NO COPAY;^0;6^Q
"^DD",344.49,344.493,.06,3)
Enter the code for the type of criteria selected for the batches.
"^DD",344.49,344.493,.06,21,0)
^^2^2^3040212^
"^DD",344.49,344.493,.06,21,1,0)
This is the code to identify the type of criteria selected to create
"^DD",344.49,344.493,.06,21,2,0)
the batches.
"^DD",344.49,344.493,.06,"DT")
3040212
"^DD",344.49,344.493,.07,0)
START VALUE^F^^0;7^K:$L(X)>30!($L(X)<1) X
"^DD",344.49,344.493,.07,3)
Answer must be 1-30 characters in length.
"^DD",344.49,344.493,.07,21,0)
^.001^2^2^3040212^^
"^DD",344.49,344.493,.07,21,1,0)
This is the first data value to be used to determine if the EEOB should
"^DD",344.49,344.493,.07,21,2,0)
belong to this batch when assigning batch #'s to the EEOBs.
"^DD",344.49,344.493,.07,"DT")
3040212
"^DD",344.49,344.493,.08,0)
END VALUE^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",344.49,344.493,.08,3)
Answer must be 1-30 characters in length.
"^DD",344.49,344.493,.08,21,0)
^^2^2^3040212^
"^DD",344.49,344.493,.08,21,1,0)
This is the last data value to be used to determine if the EEOB should
"^DD",344.49,344.493,.08,21,2,0)
belong to this batch when assigning batch #'s to the EEOBs.
"^DD",344.49,344.493,.08,"DT")
3040212
"^DD",344.5,344.5,.1,0)
EXCEPTION CATEGORY^S^1:SUMMARY RECORD STORE ERROR;2:PARTIAL MESSAGE RECEIVED;3:EOB TRANSFERRED IN;4:TRANSMISSION STORE ERROR;5:ERROR STORING EOB TRANSFER IN;6:NO VALID CLAIMS;99:OTHER;^0;10^Q
"^DD",344.5,344.5,.1,3)
Enter the code that corresponds to the exception condition of the ERA/EEOB record
"^DD",344.5,344.5,.1,21,0)
^.001^2^2^3040102^^^^
"^DD",344.5,344.5,.1,21,1,0)
This is the specific exception that occurred to cause the ERA/EEOB record
"^DD",344.5,344.5,.1,21,2,0)
to be placed in an exception status.
"^DD",344.5,344.5,.1,"DT")
3040102
**END**
**END**
