Released XU*8*9 SEQ #9
Extracted from mail message
**KIDS**:XU*8.0*9^

**INSTALL NAME**
XU*8.0*9
"BLD",26,0)
XU*8.0*9^KERNEL^0^^n
"BLD",26,1,0)
^^3^3^2951109^
"BLD",26,1,1,0)
This  patch corrects two problemds with menu templates.  First it makes
"BLD",26,1,2,0)
the LOGIN template work correctly, and it allows the user to enter
"BLD",26,1,3,0)
ACESS CODE;VERIFY CODE;[<template name> to jump start a session.
"BLD",26,4,0)
^9.64PA^^
"BLD",26,"KRN",0)
^9.67PA^.84^13
"BLD",26,"KRN",.4,0)
.4
"BLD",26,"KRN",.401,0)
.401
"BLD",26,"KRN",.402,0)
.402
"BLD",26,"KRN",.403,0)
.403
"BLD",26,"KRN",.5,0)
.5
"BLD",26,"KRN",.84,0)
.84
"BLD",26,"KRN",3.6,0)
3.6
"BLD",26,"KRN",9.2,0)
9.2
"BLD",26,"KRN",9.8,0)
9.8
"BLD",26,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",26,"KRN",9.8,"NM",1,0)
XQ^^0^B21363869
"BLD",26,"KRN",9.8,"NM",2,0)
XQ12^^0^B35710485
"BLD",26,"KRN",9.8,"NM",3,0)
XUS1^^0^B15033558
"BLD",26,"KRN",9.8,"NM","B","XQ",1)

"BLD",26,"KRN",9.8,"NM","B","XQ12",2)

"BLD",26,"KRN",9.8,"NM","B","XUS1",3)

"BLD",26,"KRN",19,0)
19
"BLD",26,"KRN",19.1,0)
19.1
"BLD",26,"KRN",101,0)
101
"BLD",26,"KRN",8995,0)
8995
"BLD",26,"KRN","B",.4,.4)

"BLD",26,"KRN","B",.401,.401)

"BLD",26,"KRN","B",.402,.402)

"BLD",26,"KRN","B",.403,.403)

"BLD",26,"KRN","B",.5,.5)

"BLD",26,"KRN","B",.84,.84)

"BLD",26,"KRN","B",3.6,3.6)

"BLD",26,"KRN","B",9.2,9.2)

"BLD",26,"KRN","B",9.8,9.8)

"BLD",26,"KRN","B",19,19)

"BLD",26,"KRN","B",19.1,19.1)

"BLD",26,"KRN","B",101,101)

"BLD",26,"KRN","B",8995,8995)

"BLD",26,"QUES",0)
^9.62^^
"PKG",131,-1)
1^1
"PKG",131,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",131,22,0)
^9.49I^1^1
"PKG",131,22,1,0)
8.0^2950729
"PKG",131,22,1,"PAH",1,0)
9
"PKG",131,22,1,"PAH",1,1,0)
^^3^3^2951109
"PKG",131,22,1,"PAH",1,1,1,0)
This  patch corrects two problemds with menu templates.  First it makes
"PKG",131,22,1,"PAH",1,1,2,0)
the LOGIN template work correctly, and it allows the user to enter
"PKG",131,22,1,"PAH",1,1,3,0)
ACESS CODE;VERIFY CODE;[<template name> to jump start a session.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options and Options
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XQ")
0^1^B21363869
"RTN","XQ",1,0)
XQ ; SEA/MJM - Menu driver (Part 1) ;10/18/95  07:59
"RTN","XQ",2,0)
 ;;8.0;KERNEL;**9**;Jul 10, 1995
"RTN","XQ",3,0)
 D INIT^XQ12 Q:'$D(XQY)
"RTN","XQ",4,0)
 I $D(XQUR),XQUR'="",XQUR'["[" S:XQUR'[U XQUR=U_XQUR K ^VA(200,DUZ,202.1) S XQJS=0 D ^XQTOC
"RTN","XQ",5,0)
 I $D(XQUR),XQUR["[" K ^VA(200,DUZ,202.1) S XQJS=3,^XUTL("XQ",$J,"T")=1
"RTN","XQ",6,0)
 I $D(^VA(200,DUZ,202.1)),$L(^(202.1)) S XQJS=1 S %=+^(202.1) S XQUR=^DIC(19,%,"U") D ^XQTOC
"RTN","XQ",7,0)
M I '$D(XQVOL) S XQVOL=$G(^XUTL("XQ",$J,"XQVOL")) I '$L(XQVOL) D GETENV^%ZOSV S XQVOL=$P(Y,U,2)
"RTN","XQ",8,0)
 I $G(^%ZIS(14.5,"LOGON",XQVOL)) S XQNOLOG="" G H^XUS
"RTN","XQ",9,0)
 S:$S('$D(XQY0):1,'$L(XQY0):1,1:0) XQY0=^DIC(19,XQY,0) S XQT=$P(XQY0,U,4) G:XQT="" M3 K:'$D(XQJS) XQUR K X,XQNOGO,XQR,XQUIT,XQUEFLG,XQSV
"RTN","XQ",10,0)
 I $D(XQAUDIT),XQAUDIT D LOGOPT^XQ12
"RTN","XQ",11,0)
 I $P(XQY0,U,18) D CHKQUE^XQ92 I XQUEFLG S XQNOGO=""
"RTN","XQ",12,0)
 D:'$D(XQM3)&("LOQX"'[XQT) LO K XQM3 I $D(XQUIT) G KILL^XQ1
"RTN","XQ",13,0)
 G:$D(XQUR) ASK1 ;Jump start or continue
"RTN","XQ",14,0)
 I XQT'="A",$P(XQY0,U,17),$D(^DIC(19,XQY,26)),$L(^(26)) X ^(26)
"RTN","XQ",15,0)
 I XQT'="M" D:'$D(XQXFLG) ABT^XQ12 D:$P(XQXFLG,U,2) LOGRSRC^%ZOSV($P(XQY0,U))
"RTN","XQ",16,0)
 I XQT'="M" D:$L($P(XQY0,U,8)) PRIO W:'^XUTL("XQ",$J,"T") !,$P(XQY0,U,2) W:$D(DUZ("SAV")) !,"Not when testing another's menus." S %=^XUTL("XQ",$J,"T"),^("T")=%+1,^(%+1)=XQY_XQPSM_U_XQY0 G M3:XQT'?1U!$D(DUZ("SAV"))
"RTN","XQ",17,0)
 I XQT'="M" D:'$D(XQXFLG) ABT^XQ12 D:+XQXFLG ABLOG^XQ12 K %,X,XQTT G @(XQT_"^XQ1")
"RTN","XQ",18,0)
M1 ;
"RTN","XQ",19,0)
 Q:XQY<1!'$D(^XUTL("XQ",$J,"T"))  D:'$D(XQXFLG) ABT^XQ12
"RTN","XQ",20,0)
 D:'$D(XQABOLD)&(+XQXFLG) ABLOG^XQ12 K XQABOLD W ! S XQUR=0,XQTT=^XUTL("XQ",$J,"T"),XQDIC=XQY,XQAA="Select "_$S($D(DUZ("SAV")):$P(DUZ("SAV"),U,3)_"'s ",1:"")_$P(XQY0,U,2)_" Option: " S:$D(XQMM("B")) XQAA=XQAA_XQMM("B")_"//"
"RTN","XQ",21,0)
 S:$S('XQTT:1,1:+$P(^XUTL("XQ",$J,XQTT),U,1)'=XQY) ^("T")=XQTT+1,^(XQTT+1)=XQY_XQPSM_U_XQY0 I $D(DUZ("AUTO")),DUZ("AUTO"),'$D(XQMM("J")),'$D(XQMM("N")) G EN^XQ2
"RTN","XQ",22,0)
 K:'$D(XQMM("J")) XQMM("N")
"RTN","XQ",23,0)
M2 ;
"RTN","XQ",24,0)
 I '$D(XQMMF),$D(XQMM("J")) G ^XQ74
"RTN","XQ",25,0)
 Q:$D(XQALEXIT)&'$D(XQALMENU)  K XQMMF I $D(XQMM("A")) S XQAA=XQMM("A") K XQMM("A") I $D(XQMM("B")),$L(XQMM("B")) S XQAA=XQAA_XQMM("B")_"//"
"RTN","XQ",26,0)
 D DISPLAY^XQALERT,CHK^XM
"RTN","XQ",27,0)
 S:'$D(DTIME) DTIME=60
"RTN","XQ",28,0)
ASK W !,XQAA R XQUR:DTIME I '$T Q:$D(XQALEXIT)  W *7,"  Timed out...." G CON^XQTOC
"RTN","XQ",29,0)
 I $D(XQALEXIT),XQUR=""!(XQUR["^") Q
"RTN","XQ",30,0)
ASK1 I XQUR="*",$D(DUZ("SAV")) G TESTN^XUS91
"RTN","XQ",31,0)
 I $D(XQJS),XQJS,XQJS'=3 D SET^XQTOC G JUMP^XQ72 ;Continue, 3=[LOGIN
"RTN","XQ",32,0)
 I XQUR["[" G:'$D(DUZ("SAV")) ^XQT W !,"Not when testing another's menus!" S %=^XUTL("XQ",$J,"T")+1,^("T")=%,^(%)=XQY_XQPSM_U_XQY0 G M3
"RTN","XQ",33,0)
 I XQUR="" S:$D(XQMM("B")) XQUR=XQMM("B") K XQMM("B") G:$L(XQUR) D S XQABOLD=1 G M3:^XUTL("XQ",$J,"T")>1,XPRMP^XQ12
"RTN","XQ",34,0)
 I XQUR=U G M3
"RTN","XQ",35,0)
 I $E(XQUR)=$C(34),$L(XQUR)>1 S XQUR=$P(XQUR,$C(34),2) D P^XQ75 G:XQY'>0 NOFIND K XQAA S XQY=+XQY,XQCH=XQUR G JUMP^XQ72
"RTN","XQ",36,0)
 ;,XQY=-1 G:$L(XQUR) M0 S XQUR=$C(34)
"RTN","XQ",37,0)
D I XQUR["^^" G:XQUR="^^" R^XQ73 S XQRB=1 S XQUR=$P(XQUR,U,2,99)
"RTN","XQ",38,0)
 I XQUR[U S XQUR=$P(XQUR,U,2) G:'$L(XQUR) NOFIND D S^XQ75 G D:'XQY,NOFIND:XQY<0 K XQAA S XQY=+XQY,XQCH=XQUR G:$D(XQRB) ^XQ73 G JUMP^XQ72
"RTN","XQ",39,0)
D0 G:XQUR'?1"?"1AN.ANP D1 S XQSV=XQY_U_XQDIC_U_XQY0 D OPT^XQHLP S XQY=$P(XQSV,U),XQDIC=$P(XQSV,U,2),XQYO=$P(XQSV,U,3,99) K XQSV G ASK
"RTN","XQ",40,0)
D1 S XQSV=XQY_U_XQDIC_U_XQY0 G EN^XQ2:XQUR?."?"!(XQUR'?.ANP) D DIC^XQ71 G:'XQY D S:XQY>0 XQPSM=$S(XQPSM=("U"_DUZ):XQPSM_",P"_XQDIC,XQPSM[",":XQPSM,XQDIC>0:XQPSM,1:"P"_XQDIC)
"RTN","XQ",41,0)
 I XQY=-1,$O(^VA(200,DUZ,203,0))>0 S XQDIC="U"_DUZ D DIC^XQ71 G:'XQY D S:XQY>0 XQPSM=XQDIC
"RTN","XQ",42,0)
M0 I XQY=-1 S XQDIC=$O(^DIC(19,"B","XUCOMMAND",0)) S:XQDIC="" XQDIC=-1 D DIC^XQ71 G:'XQY D S:XQY>0 XQPSM="PXU" I XQY=-1 G M3:XQUR="HALT",NOFIND
"RTN","XQ",43,0)
 G:XQY=-2 NOFIND K XQAA S XQY=+XQY,XQCH=XQUR G M
"RTN","XQ",44,0)
NOFIND W:XQY=-1 "  ??" S %=^XUTL("XQ",$J,^XUTL("XQ",$J,"T")),XQY0=$P(%,U,2,999),XQY=+$P(%,U,1) K XQJS,XQR G M1
"RTN","XQ",45,0)
 ;
"RTN","XQ",46,0)
M3 I $P(XQY0,U,15),$D(^DIC(19,+XQY,15)),$L(^(15)) X ^(15)
"RTN","XQ",47,0)
 S %=^XUTL("XQ",$J,"T")-1,^("T")=% G H^XUS:'% S %=^XUTL("XQ",$J,%),XQY0=$P(%,U,2,999),XQPSM=$P(%,U,1),XQY=+XQPSM,XQPSM=$P(XQPSM,XQY,2,99),XQM3="" I +XQY<0 D RBX^XQ73
"RTN","XQ",48,0)
 G M
"RTN","XQ",49,0)
 ;
"RTN","XQ",50,0)
LO I $P(XQY0,U,4)'="A",$P(XQY0,U,14),$D(^DIC(19,+XQY,20)),$L(^(20)) X ^(20)
"RTN","XQ",51,0)
 I $D(^XUTL("XQ",$J,"P")) S X=^("P") K ^("P") X ^%ZOSF("PRIORITY")
"RTN","XQ",52,0)
 Q
"RTN","XQ",53,0)
PRIO S Y=10 X:$D(^%ZOSF("PRIINQ")) ^("PRIINQ") S ^XUTL("XQ",$J,"P")=Y,X=$P(XQY0,U,8) X ^%ZOSF("PRIORITY")
"RTN","XQ",54,0)
 Q
"RTN","XQ12")
0^2^B35710485
"RTN","XQ12",1,0)
XQ12 ; SEA/MJM - MENU MANAGER UTILITIES ;10/25/95  09:38
"RTN","XQ12",2,0)
 ;;8.0;KERNEL;**9**;Jul 10, 1995
"RTN","XQ12",3,0)
 ;
"RTN","XQ12",4,0)
DVARS ;Set up (or reset) necessary variables. From ^XQ1 and ^XQT1.
"RTN","XQ12",5,0)
 S U="^" I '$D(DUZ)#2 S DUZ=^XUTL("XQ",$J,"DUZ")
"RTN","XQ12",6,0)
 S:'$D(DUZ(0))#2 DUZ(0)="" I DUZ(0)="" S:$D(^VA(200,DUZ,0)) DUZ(0)=$P(^(0),U,4)
"RTN","XQ12",7,0)
 I '$D(DT) D ^XQDATE S DT=$P(%,".")
"RTN","XQ12",8,0)
 I '$D(DUZ("AG")),$D(^XTV(8989.3,1,0)) S DUZ("AG")=$P(^(0),U,8)
"RTN","XQ12",9,0)
 I '$D(IOS) S IOS=$S($D(^XUTL("XQ",$J,"IOS"))#2:^("IOS"),1:"")
"RTN","XQ12",10,0)
 I '$D(DTIME) S DTIME=$$DTIME^XUP(DUZ,IOS)
"RTN","XQ12",11,0)
 I '$D(DUZ("AUTO")) S I=$S($D(^VA(200,DUZ,200)):$P(^(200),U,6),1:"") S:'$L(I) I=$S($D(^%ZIS(1,$I,"XUS")):$P(^("XUS"),U,6),1:"") S:'$L(I) I=$S($D(^XTV(8989.3,1,"XUS")):$P(^("XUS"),U,6),1:"") S:'$L(I) I=1 S DUZ("AUTO")=I
"RTN","XQ12",12,0)
 Q
"RTN","XQ12",13,0)
 ;
"RTN","XQ12",14,0)
INIT ;Entry for new logon, called from the top of ^XQ and ^XQ1
"RTN","XQ12",15,0)
 K DIC,Y Q:$D(DUZ)[0  Q:'$D(^VA(200,DUZ,0))
"RTN","XQ12",16,0)
 ;S:'$D(XQY) XQY=^VA(200,DUZ,201)
"RTN","XQ12",17,0)
 I '$D(XQUSER) S XQUSER=$P($P(^VA(200,DUZ,0),U),",",2)_" "_$P($P(^(0),U),",")
"RTN","XQ12",18,0)
 ;
"RTN","XQ12",19,0)
 ;Select device tied option, primary menu, or primary window
"RTN","XQ12",20,0)
 ;
"RTN","XQ12",21,0)
 S:'$D(XQY) XQY=""
"RTN","XQ12",22,0)
 S %=$G(^VA(200,DUZ,201)),^XUTL("XQ",$J,"XQM")=+%,^("XQW")=$P(%,"^",2)
"RTN","XQ12",23,0)
 D:'$D(IO) HOME^%ZIS
"RTN","XQ12",24,0)
 I IO]"" S %=$G(^%ZIS(1,IO,201)) I %]"" S XQY=%
"RTN","XQ12",25,0)
 I XQY']"" D
"RTN","XQ12",26,0)
 .S %=$G(^VA(200,DUZ,201))
"RTN","XQ12",27,0)
 .S XQPM=$P(%,U),XQPW=$P(%,U,2),XQSD=$P(%,U,3)
"RTN","XQ12",28,0)
 .I XQPW']"" S XQY=XQPM Q
"RTN","XQ12",29,0)
 .I XQSD="M" S XQY=XQPM
"RTN","XQ12",30,0)
 .E  S XQY=XQPW
"RTN","XQ12",31,0)
 .Q
"RTN","XQ12",32,0)
 ;
"RTN","XQ12",33,0)
 D SET^XQCHK
"RTN","XQ12",34,0)
 S ^XUTL("XQ",$J,1)=XQY_"P"_XQY_"^"_XQY0,^("T")=1
"RTN","XQ12",35,0)
 S XQDIC=XQY,XQPSN="P"_XQY
"RTN","XQ12",36,0)
 ;
"RTN","XQ12",37,0)
 ;Fire LOGIN menu template if they have one and its the first login
"RTN","XQ12",38,0)
 ;of the day.  XQXFLG("LLOG") is copy of ^VA(200,DUZ,1.1) before it's
"RTN","XQ12",39,0)
 ;updated at XUS1+47
"RTN","XQ12",40,0)
 I $D(^VA(200,DUZ,19.8,"B","LOGIN")) D
"RTN","XQ12",41,0)
 .Q:'$D(XQXFLG("LLOG"))
"RTN","XQ12",42,0)
 .S XQLAST=$P($P(XQXFLG("LLOG"),U),".") ;Get last login DT
"RTN","XQ12",43,0)
 .Q:+XQLAST<1
"RTN","XQ12",44,0)
 .I XQLAST<DT S XQUR="[LOGIN",XQJS=3
"RTN","XQ12",45,0)
 .K XQLAST
"RTN","XQ12",46,0)
 .Q
"RTN","XQ12",47,0)
 K XQXFLG("LLOG")
"RTN","XQ12",48,0)
 ;
"RTN","XQ12",49,0)
UI ;Entry for TaskMan (DUZ may =  0), from ZTSK^XQ1
"RTN","XQ12",50,0)
 D DVARS I '$D(^XUTL("XQ",$J,0)) D ^XQDATE S ^XUTL("XQ",$J,0)=%_U_%Y
"RTN","XQ12",51,0)
 S:'$D(XQDIC) XQDIC="P"_XQY
"RTN","XQ12",52,0)
 S:'$D(XQPSM) XQPSM="P"_XQY
"RTN","XQ12",53,0)
 S:'$D(XQJS)&'$D(ZTQUEUED) XQY0=^DIC(19,XQY,0),^XUTL("XQ",$J,"T")=0,^("DUZ")=DUZ,^("XQM")=XQY,XQPSM="P"_XQY
"RTN","XQ12",54,0)
 S XQCY=XQY D ^XQCHK I XQCY<1 D
"RTN","XQ12",55,0)
 .S XQPRMN=1,XQL=0
"RTN","XQ12",56,0)
 .D:'$D(ZTQUEUED) MES^XQCHK,PAUSE^XQ6
"RTN","XQ12",57,0)
 .;G:'$D(ZTQUEUED) ^XUSCLEAN S XQY=-1
"RTN","XQ12",58,0)
 .S XQY=-1
"RTN","XQ12",59,0)
 .Q
"RTN","XQ12",60,0)
 S XQM3="" I $P(XQY0,U,4)'="A",$P(XQY0,U,14),$D(^DIC(19,XQY,20)),$L(^(20)) X ^(20)
"RTN","XQ12",61,0)
 I $D(XQUIT),'$D(ZTQUEUED) S XQL=0 W !!,"The variable XQUIT was encountered in the Entry Action of your Primary Menu." D PAUSE^XQ6 S XQY=-1 G ^XUSCLEAN
"RTN","XQ12",62,0)
 ;I $P(XQY0,U,17),$D(^DIC(19,XQY,26)),$L(^(26)) X ^(26)
"RTN","XQ12",63,0)
ABT ;WARNING: XQXFLG is also used by OERR test sites.
"RTN","XQ12",64,0)
 S $P(XQXFLG,U)=$S($O(^XTV(8989.3,1,"ABPKG",0))>0:1,1:0)
"RTN","XQ12",65,0)
CMP S $P(XQXFLG,U,2)=$S('$D(^XTV(8989.3,1,"XUCP")):0,1:^("XUCP")="Y")
"RTN","XQ12",66,0)
 K %,%Y,PGM,X,XQCY,XQPM,XQPW,XQSD
"RTN","XQ12",67,0)
 Q
"RTN","XQ12",68,0)
 ;
"RTN","XQ12",69,0)
LOGOPT ;Option audit
"RTN","XQ12",70,0)
 S:'$D(XQLTL) XQLTL=""
"RTN","XQ12",71,0)
 S %=$P($H,",",2),%=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100)
"RTN","XQ12",72,0)
 I XQLTL S $P(^XUSEC(19,XQLTL,0),U,5)=%,XQLTL=0
"RTN","XQ12",73,0)
 S I=1 I XQAUDIT'=1 S I=0 F J=1:2 S K1=$P(XQAUDIT,U,J),K2=$P(XQAUDIT,U,J+1) Q:'$L(K1)!I  I K1=2&(K2=XQY)!(K1=3&($E($P(XQY0,U,1),1,$L(K2))=K2)) S I=1
"RTN","XQ12",74,0)
 Q:'I  S XQLTL=% L +^XUSEC(19,0) S %=^XUSEC(19,0),XQLTL=XQLTL+(.00000001*$S(XQLTL'=$E($P(%,U,3),1,14):10,1:$E($P(%,U,3),15,16)+1)),$P(^(0),U,3,4)=XQLTL_"^"_($P(%,U,4)+1) L -^XUSEC(19,0)
"RTN","XQ12",75,0)
 D GETENV^%ZOSV S XUVOL=$P(Y,U,2),^XUSEC(19,XQLTL,0)=XQY_U_DUZ_U_$I_U_$J_"^^"_XUVOL
"RTN","XQ12",76,0)
 Q
"RTN","XQ12",77,0)
XPRMP D CHK^XM W !!,"Do you really want to ",$S(XQUR="REST":"restart",1:"halt"),"? YES// " R X:10 S:'$L(X) X="Y"
"RTN","XQ12",78,0)
 I "Yy"'[$E(X) S Y=1 S:^XUTL("XQ",$J,"T")>1 Y=^("T")-1 S ^("T")=Y,Y=^(Y),XQY0=$P(Y,U,2,99),XQPSM=$P(Y,U,1),(XQY,XQDIC)=+XQPSM,XQPSM=$P(XQPSM,XQY,2,3),XQAA="Select "_$P(XQY0,U,2)_" Option: " W ! G ASK^XQ
"RTN","XQ12",79,0)
 G REST:XQUR="REST",HALT:XQUR'="CON"
"RTN","XQ12",80,0)
 ;
"RTN","XQ12",81,0)
CON ;Continue option logic.  Enter from ASK^XQ on timeout.
"RTN","XQ12",82,0)
 W !!,"Do you want to halt and continue with this option later? YES// " R XQUR:20 S:(XQUR="")!('$T) XQUR="Y"
"RTN","XQ12",83,0)
 I "YyNn"'[$E(XQUR,1) W !!,"   If you enter 'Y' or 'RETURN' you will halt and continue here next time",!,"    you logon to the computer.",!,"   If you enter 'N' you will resume processing where you were." G CON
"RTN","XQ12",84,0)
 I "Nn"[$E(XQUR,1) W ! S XQUR=0,Y=^XUTL("XQ",$J,"T"),Y=^(Y),XQY0=$P(Y,U,2,99),XQPSM=$P(Y,U,1),(XQY,XQDIC)=+XQPSM,XQPSM=$P(XQPSM,XQY,2,3),XQAA="Select "_$P(XQY0,U,2)_" Option: " G ASK^XQ
"RTN","XQ12",85,0)
 S X=^XUTL("XQ",$J,^XUTL("XQ",$J,"T")),Y=^("XQM") I (+X'=+Y) S XQM="P"_+Y S XQPSM=$S($D(^XUTL("XQO",XQM,"^",+X)):XQM,$D(^XUTL("XQO","PXU","^",+X)):"PXU",1:"") D:XQPSM="" SS S:XQPSM'="" ^VA(200,DUZ,202.1)=+X_XQPSM
"RTN","XQ12",86,0)
 S X=$P($H,",",2),X=(X>41400&(X<46800))
"RTN","XQ12",87,0)
 W !!,$P("HMM^OK^ALL RIGHT^WELL CERTAINLY^FINE","^",$R(5)+1),"... ",$P("SEE YOU LATER^I'LL BE READY WHEN YOU ARE.^HURRY BACK!^HAVE A GOOD LUNCH BREAK!","^",$R(3)+X+1)
"RTN","XQ12",88,0)
HALT ;
"RTN","XQ12",89,0)
 G H^XUS
"RTN","XQ12",90,0)
REST S XQNOHALT=1 D ^XUSCLEAN G ^XUS
"RTN","XQ12",91,0)
 ;
"RTN","XQ12",92,0)
SS ;Search Secondaries for a particuloar option.
"RTN","XQ12",93,0)
 Q:'$D(^VA(200,DUZ,203,0))  Q:$P(^VA(200,DUZ,203,0),U,4)<1
"RTN","XQ12",94,0)
 S Y=0 F XQI=1:1 Q:XQPSM'=""  S Y=$O(^VA(200,DUZ,203,Y)) Q:Y=""  S %=^(Y,0) I $D(^XUTL("XQO","P"_%,"^",+X)) S XQPSM="U"_DUZ_",P"_%
"RTN","XQ12",95,0)
 Q
"RTN","XQ12",96,0)
ABLOG S %2=0 F %3=0:0 S %2=$O(^XTV(8989.3,1,"ABPKG",%2)) Q:%2'>0  F %=0:0 S %=$O(^XTV(8989.3,1,"ABPKG",%2,1,%)) Q:%'>0  S %1=$P(^(%,0),U) I $E(XQY0,1,$L(%1))=%1,$E(XQY0,$L(%1)+1)'="Z" D ABLOG1
"RTN","XQ12",97,0)
 K %,%1,%2,%3,%4
"RTN","XQ12",98,0)
 Q
"RTN","XQ12",99,0)
ABLOG1 F %4=0:0 S %4=$O(^XTV(8989.3,1,"ABPKG",%2,1,%,1,%4)) Q:%4'>0  S %1=$P(^(%4,0),U) I $E(XQY0,1,$L(%1))=%1 Q
"RTN","XQ12",100,0)
 I %4'>0 S:'$D(^XTV(8989.3,1,"ABOPT",0)) ^(0)="^8989.333P^" S:'$D(^(XQY)) %4=+$P(^(0),U,3),$P(^(0),U,3,4)=$S(XQY>%4:XQY,1:%4)_U_($P(^(0),U,4)+1) S ^(0)=XQY_U_($S($D(^(XQY,0)):$P(^(0),U,2),1:0)+1),%2="A"
"RTN","XQ12",101,0)
 Q
"RTN","XUS1")
0^3^B15033558
"RTN","XUS1",1,0)
XUS1 ;SF-ISC/STAFF - SIGNON ;10/25/95  09:37
"RTN","XUS1",2,0)
 ;;8.0;KERNEL;**9**;Jul 10, 1995
"RTN","XUS1",3,0)
USER ;
"RTN","XUS1",4,0)
 K XUTEXT S XUM=$$USER^XUS1A()
"RTN","XUS1",5,0)
 F I=0:0 S I=$O(XUTEXT(I)) Q:I'>0  W:$E(XUTEXT(I),1)="!" ! W $E(XUTEXT(I),2,999)
"RTN","XUS1",6,0)
 G SET:'XUM,NO^XUS:(XUM)&(XUM'=9)
"RTN","XUS1",7,0)
 W !!,?18,"You are ALREADY signed on. And may not sign-on again." S X=""
"RTN","XUS1",8,0)
 Q
"RTN","XUS1",9,0)
SET ;
"RTN","XUS1",10,0)
 S Y=$O(^VA(200,DUZ,2,0)),X=$O(^(Y)) I X>0,$D(^DIC(4,0)) S DIC="^VA(200,DUZ,2,",DIC(0)="AEMQ",DIC("P")="200.02P" D ^DIC I Y'>0 W !,*7,"You must select one." G SET
"RTN","XUS1",11,0)
 S DUZ(2)=+Y D DUZ^XUS1A
"RTN","XUS1",12,0)
 S:$P(XOPT,"^",5) XUTT=1
"RTN","XUS1",13,0)
 I '$L($P(XUSER(1),U,2)) D CVC^XUS2 G:$D(DUOUT) H^XUS S XUSER(1)=^VA(200,DUZ,.1)
"RTN","XUS1",14,0)
 I +$P(XOPT,U,15),(XUSER(1)+$P(XOPT,U,15)'>+$H) D CVC^XUS2 G:$D(DUOUT) H^XUS
"RTN","XUS1",15,0)
 D ENQ
"RTN","XUS1",16,0)
 Q
"RTN","XUS1",17,0)
ENQ ;
"RTN","XUS1",18,0)
 S XUT1="" I XUTT X XUEOFF R X:0 X ^%ZOSF("TYPE-AHEAD") W $C(27,91,99) R *X:2 I X=27 F  R X#1:2 S XUT1=XUT1_X Q:'$T!(X="c")
"RTN","XUS1",19,0)
 I XUTT,(XUT1'["[") R X:0 S XUT1="" W *5 R *X:2 R:$T XUT1:2 S X=$S(X=6:"C-WYSE 75",1:$C(X)_XUT1),XUT1=""
"RTN","XUS1",20,0)
 X XUEON I XUTT,XUT1["[" S Y=$O(^%ZIS(3.22,"B",XUT1,0)) I Y>0 S X=$P($G(^%ZIS(3.22,Y,0)),"^",2)
"RTN","XUS1",21,0)
 I X?1.ANP S DIC="^%ZIS(2,",DIC(0)="MO" D ^DIC I Y>0 S XUIOP(1)=$P(Y,U,2),$P(XUIOP,";",2)=XUIOP(1),^VA(200,DUZ,1.2)=+Y
"RTN","XUS1",22,0)
 I '$D(XUIOP(1)),$D(^VA(200,DUZ,1.2)) S X=+^(1.2) I X>0,$D(^%ZIS(2,X,0)) S $P(XUIOP,";",2)=$P(^(0),U)
"RTN","XUS1",23,0)
 Q
"RTN","XUS1",24,0)
NEXT ;
"RTN","XUS1",25,0)
 S IOP=XUIOP D ^%ZIS
"RTN","XUS1",26,0)
 S X=$G(^DISV(DUZ)) ;Add kill by session or day here
"RTN","XUS1",27,0)
 S ^DISV(DUZ)=$H
"RTN","XUS1",28,0)
 S X=%UCI,N1=XUCI I PGM["[" S X=$P(PGM,"[",2,4),PGM=$P(PGM,"[",1)
"RTN","XUS1",29,0)
 S:X["""" X=$P(X,"""",2) S:X?.E1"]"&(X'["[") X=$E(X,1,$L(X)-1) S XUM=14,XUM(0)=X
"RTN","XUS1",30,0)
 S %UCI=X I "PRODMGR"'[X,$D(^%ZOSF("UCICHECK")) X ^("UCICHECK") G NO:Y="" S:N1=Y %UCI=""
"RTN","XUS1",31,0)
 S XUM=15,XUM(0)=PGM G NO:PGM'?1AP.AN
"RTN","XUS1",32,0)
 G NO:":"_XUA_":"'[(":"_PGM_":") K ^DISV("XU",XUDEV)
"RTN","XUS1",33,0)
 S I=$S($D(^XTV(8989.3,1,19)):^(19),1:""),I1=$P(I,U),I2=$P(I,U,2) I I1]"","asu"[I1,I2,I2'>XUNOW,$P(I,U,3)'<XUNOW D AUDIT
"RTN","XUS1",34,0)
 S X=$S($D(^VA(200,DUZ,0)):$P($P(^(0),U),","),1:"Unk"),X=$E(X,1,10)_"_"_($J#10000) D SETENV^%ZOSV
"RTN","XUS1",35,0)
 S X=$P(XOPT,U,16) X:X ^%ZOSF("PRIORITY") D LOG:DUZ,KILL I %UCI]"" K ^XUTL("XQ",$J) S $P(^VA(200,DUZ,1,1),U,3)=0 G GO^%XUCI
"RTN","XUS1",36,0)
 D SAVE K ^XUTL("OR",$J),^UTILITY($J),%UCI G @(U_PGM)
"RTN","XUS1",37,0)
 ;
"RTN","XUS1",38,0)
SAVE ;
"RTN","XUS1",39,0)
 S X="DUZ" F  S X=$Q(@X) Q:X=""  I $D(@X) S ^XUTL("XQ",$J,$TR(X,""""))=@X
"RTN","XUS1",40,0)
 F X="DUZ","IO","IOBS","IOF","IOM","ION","IOS","IOSL","IOST","IOST(0)","IOT","IOXY","XQVOL" I $D(@X) S ^XUTL("XQ",$J,X)=@X
"RTN","XUS1",41,0)
 Q
"RTN","XUS1",42,0)
LOG ;
"RTN","XUS1",43,0)
 N I,DA,DIK S I=XUNOW
"RTN","XUS1",44,0)
 F I=I:.000001 L +^XUSEC(0,I):1 Q:'$D(^XUSEC(0,I))  L -^XUSEC(0,I)
"RTN","XUS1",45,0)
 S ^XUSEC(0,I,0)=DUZ_"^"_$I_"^"_$J_"^^"_$P(XUVOL,U,1)_"^^"_XUDEV_"^"_XUCI_"^"_$G(IO("ZIO"))_"^"_$P(XUENV,"^",3)
"RTN","XUS1",46,0)
 L -^XUSEC(0,I)
"RTN","XUS1",47,0)
 S $P(^XUSEC(0,0),"^",3,4)=I_"^"_(1+$P(^XUSEC(0,0),"^",4))
"RTN","XUS1",48,0)
 S XQXFLG("LLOG")=$G(^VA(200,DUZ,1.1)) ;Added for LOGIN templates - Luke
"RTN","XUS1",49,0)
 S ^XUTL("XQ",$J,0)=I,$P(^VA(200,DUZ,1.1),"^",1,3)=I_"^0^1"
"RTN","XUS1",50,0)
 S DA=I,DIK="^XUSEC(0," D IX^DIK
"RTN","XUS1",51,0)
 Q
"RTN","XUS1",52,0)
AUDIT ;
"RTN","XUS1",53,0)
 I "au"[I1 S:(I1="a")!($D(^XTV(8989.3,1,19.3,"B",DUZ))>1) XQAUDIT=1 Q
"RTN","XUS1",54,0)
 S XQAUDIT="" F I=0:0 S I=$O(^XTV(8989.3,1,19.1,"B",I)) Q:I'>0!($L(XQAUDIT)>245)  S XQAUDIT=XQAUDIT_"2^"_I_U
"RTN","XUS1",55,0)
 S I1="" F I=0:0 S I1=$O(^XTV(8989.3,1,19.2,"B",I1)) Q:I1']""!($L(XQAUDIT)>245)  S XQAUDIT=XQAUDIT_"3^"_I1_U
"RTN","XUS1",56,0)
 Q
"RTN","XUS1",57,0)
 ;
"RTN","XUS1",58,0)
DD(Y) Q $S($E(Y,4,5):$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec","^",+$E(Y,4,5))_" ",1:"")_$S($E(Y,6,7):+$E(Y,6,7)_",",1:"")_($E(Y,1,3)+1700)
"RTN","XUS1",59,0)
 Q
"RTN","XUS1",60,0)
KILL N %UCI,PGM,U,XQUR,XMCHAN G KILL1^XUSCLEAN
"RTN","XUS1",61,0)
 Q
"RTN","XUS1",62,0)
NO S X=$$NO^XUS3 G RS^XUS:'X,^XUSCLEAN
"VER")
8.0T20^21.0
**END**
**END**
