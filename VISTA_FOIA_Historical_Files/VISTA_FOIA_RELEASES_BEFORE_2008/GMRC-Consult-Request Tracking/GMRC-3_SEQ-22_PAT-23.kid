Released GMRC*3*23 SEQ #22
Extracted from mail message
**KIDS**:GMRC*3.0*23^

**INSTALL NAME**
GMRC*3.0*23
"BLD",15035,0)
GMRC*3.0*23^CONSULT/REQUEST TRACKING^0^3020110^y
"BLD",15035,1,0)
^^1^1^3010905^^^
"BLD",15035,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*23.
"BLD",15035,4,0)
^9.64PA^123.5^2
"BLD",15035,4,123,0)
123
"BLD",15035,4,123,2,0)
^9.641^123^1
"BLD",15035,4,123,2,123,0)
REQUEST/CONSULTATION  (File-top level)
"BLD",15035,4,123,2,123,1,0)
^9.6411^4^2
"BLD",15035,4,123,2,123,1,.04,0)
PATIENT LOCATION
"BLD",15035,4,123,2,123,1,4,0)
PROCEDURE/REQUEST TYPE
"BLD",15035,4,123,222)
y^y^p^^^^n
"BLD",15035,4,123.5,0)
123.5
"BLD",15035,4,123.5,2,0)
^9.641^123.51^1
"BLD",15035,4,123.5,2,123.51,0)
SUB-SERVICE  (sub-file)
"BLD",15035,4,123.5,2,123.51,1,0)
^9.6411^.01^1
"BLD",15035,4,123.5,2,123.51,1,.01,0)
SUB-SERVICE/SPECIALTY
"BLD",15035,4,123.5,222)
y^y^p^^^^n
"BLD",15035,4,"APDD",123,123)

"BLD",15035,4,"APDD",123,123,.04)

"BLD",15035,4,"APDD",123,123,4)

"BLD",15035,4,"APDD",123.5,123.51)

"BLD",15035,4,"APDD",123.5,123.51,.01)

"BLD",15035,4,"B",123,123)

"BLD",15035,4,"B",123.5,123.5)

"BLD",15035,"ABPKG")
n
"BLD",15035,"INID")
^n
"BLD",15035,"INIT")
GMRCYP23
"BLD",15035,"KRN",0)
^9.67PA^19^17
"BLD",15035,"KRN",.4,0)
.4
"BLD",15035,"KRN",.401,0)
.401
"BLD",15035,"KRN",.402,0)
.402
"BLD",15035,"KRN",.403,0)
.403
"BLD",15035,"KRN",.5,0)
.5
"BLD",15035,"KRN",.84,0)
.84
"BLD",15035,"KRN",3.6,0)
3.6
"BLD",15035,"KRN",3.8,0)
3.8
"BLD",15035,"KRN",9.2,0)
9.2
"BLD",15035,"KRN",9.8,0)
9.8
"BLD",15035,"KRN",9.8,"NM",0)
^9.68A^12^11
"BLD",15035,"KRN",9.8,"NM",2,0)
GMRCPSL1^^0^B43538144
"BLD",15035,"KRN",9.8,"NM",3,0)
GMRCPSL2^^0^B24951569
"BLD",15035,"KRN",9.8,"NM",4,0)
GMRCPSL3^^0^B52630552
"BLD",15035,"KRN",9.8,"NM",5,0)
GMRCSTLM^^0^B47813886
"BLD",15035,"KRN",9.8,"NM",6,0)
GMRCYP23^^0^B956618
"BLD",15035,"KRN",9.8,"NM",7,0)
GMRCP5B^^0^B32803050
"BLD",15035,"KRN",9.8,"NM",8,0)
GMRCART^^0^B39438414
"BLD",15035,"KRN",9.8,"NM",9,0)
GMRCSLM2^^0^B34530101
"BLD",15035,"KRN",9.8,"NM",10,0)
GMRCPC^^0^B10687921
"BLD",15035,"KRN",9.8,"NM",11,0)
GMRCMER^^0^B3524723
"BLD",15035,"KRN",9.8,"NM",12,0)
GMRCASV1^^0^B2971576
"BLD",15035,"KRN",9.8,"NM","B","GMRCART",8)

"BLD",15035,"KRN",9.8,"NM","B","GMRCASV1",12)

"BLD",15035,"KRN",9.8,"NM","B","GMRCMER",11)

"BLD",15035,"KRN",9.8,"NM","B","GMRCP5B",7)

"BLD",15035,"KRN",9.8,"NM","B","GMRCPC",10)

"BLD",15035,"KRN",9.8,"NM","B","GMRCPSL1",2)

"BLD",15035,"KRN",9.8,"NM","B","GMRCPSL2",3)

"BLD",15035,"KRN",9.8,"NM","B","GMRCPSL3",4)

"BLD",15035,"KRN",9.8,"NM","B","GMRCSLM2",9)

"BLD",15035,"KRN",9.8,"NM","B","GMRCSTLM",5)

"BLD",15035,"KRN",9.8,"NM","B","GMRCYP23",6)

"BLD",15035,"KRN",19,0)
19
"BLD",15035,"KRN",19,"NM",0)
^9.68A^10^10
"BLD",15035,"KRN",19,"NM",1,0)
GMRC PRINT COMPLETION STAT^^0^
"BLD",15035,"KRN",19,"NM",2,0)
GMRC PRINT RPT NUMBERED^^0^
"BLD",15035,"KRN",19,"NM",3,0)
GMRC PRINT BY SEARCH^^0^
"BLD",15035,"KRN",19,"NM",4,0)
GMRC REPORTS^^0
"BLD",15035,"KRN",19,"NM",5,0)
GMRC RPT PENDING CONSULTS^^0
"BLD",15035,"KRN",19,"NM",6,0)
GMRC RPT COMPLETE/PENDING^^0
"BLD",15035,"KRN",19,"NM",7,0)
GMRC RPT COMPLETE CONSULTS^^0
"BLD",15035,"KRN",19,"NM",8,0)
GMRC RPT CONSULTS BY STATUS^^0
"BLD",15035,"KRN",19,"NM",9,0)
GMRC RPT NUMBERED CONSULTS^^0
"BLD",15035,"KRN",19,"NM",10,0)
GMRC COMPLETION STATISTICS^^0
"BLD",15035,"KRN",19,"NM","B","GMRC COMPLETION STATISTICS",10)

"BLD",15035,"KRN",19,"NM","B","GMRC PRINT BY SEARCH",3)

"BLD",15035,"KRN",19,"NM","B","GMRC PRINT COMPLETION STAT",1)

"BLD",15035,"KRN",19,"NM","B","GMRC PRINT RPT NUMBERED",2)

"BLD",15035,"KRN",19,"NM","B","GMRC REPORTS",4)

"BLD",15035,"KRN",19,"NM","B","GMRC RPT COMPLETE CONSULTS",7)

"BLD",15035,"KRN",19,"NM","B","GMRC RPT COMPLETE/PENDING",6)

"BLD",15035,"KRN",19,"NM","B","GMRC RPT CONSULTS BY STATUS",8)

"BLD",15035,"KRN",19,"NM","B","GMRC RPT NUMBERED CONSULTS",9)

"BLD",15035,"KRN",19,"NM","B","GMRC RPT PENDING CONSULTS",5)

"BLD",15035,"KRN",19.1,0)
19.1
"BLD",15035,"KRN",101,0)
101
"BLD",15035,"KRN",409.61,0)
409.61
"BLD",15035,"KRN",771,0)
771
"BLD",15035,"KRN",870,0)
870
"BLD",15035,"KRN",8994,0)
8994
"BLD",15035,"KRN","B",.4,.4)

"BLD",15035,"KRN","B",.401,.401)

"BLD",15035,"KRN","B",.402,.402)

"BLD",15035,"KRN","B",.403,.403)

"BLD",15035,"KRN","B",.5,.5)

"BLD",15035,"KRN","B",.84,.84)

"BLD",15035,"KRN","B",3.6,3.6)

"BLD",15035,"KRN","B",3.8,3.8)

"BLD",15035,"KRN","B",9.2,9.2)

"BLD",15035,"KRN","B",9.8,9.8)

"BLD",15035,"KRN","B",19,19)

"BLD",15035,"KRN","B",19.1,19.1)

"BLD",15035,"KRN","B",101,101)

"BLD",15035,"KRN","B",409.61,409.61)

"BLD",15035,"KRN","B",771,771)

"BLD",15035,"KRN","B",870,870)

"BLD",15035,"KRN","B",8994,8994)

"BLD",15035,"QUES",0)
^9.62^^
"BLD",15035,"REQB",0)
^9.611^3^3
"BLD",15035,"REQB",1,0)
GMRC*3.0*21^2
"BLD",15035,"REQB",2,0)
GMRC*3.0*17^2
"BLD",15035,"REQB",3,0)
GMRC*3.0*24^2
"BLD",15035,"REQB","B","GMRC*3.0*17",2)

"BLD",15035,"REQB","B","GMRC*3.0*21",1)

"BLD",15035,"REQB","B","GMRC*3.0*24",3)

"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^y^p^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,.04)

"FIA",123,123,4)

"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5I
"FIA",123.5,0,1)
y^y^p^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,10)

"FIA",123.5,123.51)
1
"FIA",123.5,123.51,.01)

"INIT")
GMRCYP23
"KRN",19,5850,-1)
0^5
"KRN",19,5850,0)
GMRC RPT PENDING CONSULTS^Service Consults Pending Resolution^^R^^^^^^^^CONSULT/REQUEST TRACKING^^1
"KRN",19,5850,20)
S GMRCSTAT="3,4,5,6,8,9,11,99"
"KRN",19,5850,25)
EN^GMRCPC
"KRN",19,5850,"U")
SERVICE CONSULTS PENDING RESOL
"KRN",19,5851,-1)
0^4
"KRN",19,5851,0)
GMRC REPORTS^Consult Tracking Reports^^M^^^^^^^^
"KRN",19,5851,10,0)
^19.01IP^12^12
"KRN",19,5851,10,3,0)
5850^PC^5
"KRN",19,5851,10,3,"^")
GMRC RPT PENDING CONSULTS
"KRN",19,5851,10,5,0)
10198^ST^3
"KRN",19,5851,10,5,"^")
GMRC COMPLETION STATISTICS
"KRN",19,5851,10,6,0)
10975^CP
"KRN",19,5851,10,6,"^")
GMRC RPT COMPLETE/PENDING
"KRN",19,5851,10,7,0)
10976^CC
"KRN",19,5851,10,7,"^")
GMRC RPT COMPLETE CONSULTS
"KRN",19,5851,10,8,0)
10978^SC
"KRN",19,5851,10,8,"^")
GMRC RPT CONSULTS BY STATUS
"KRN",19,5851,10,9,0)
10979^NU
"KRN",19,5851,10,9,"^")
GMRC RPT NUMBERED CONSULTS
"KRN",19,5851,10,10,0)
10981^TS
"KRN",19,5851,10,10,"^")
GMRC PRINT COMPLETION STAT
"KRN",19,5851,10,11,0)
10982^PR
"KRN",19,5851,10,11,"^")
GMRC PRINT RPT NUMBERED
"KRN",19,5851,10,12,0)
11240^PL
"KRN",19,5851,10,12,"^")
GMRC PRINT BY SEARCH
"KRN",19,5851,99)
58730,43391
"KRN",19,5851,"U")
CONSULT TRACKING REPORTS
"KRN",19,10198,-1)
0^10
"KRN",19,10198,0)
GMRC COMPLETION STATISTICS^Completion Time Statistics^^R^^^^^^^^CONSULT/REQUEST TRACKING^^
"KRN",19,10198,1,0)
^19.06^5^5^3000314^^^^
"KRN",19,10198,1,1,0)
Collect and display (vis List Manager) the mean number of days that
"KRN",19,10198,1,2,0)
consults/requests take to be filled, from the time that they are
"KRN",19,10198,1,3,0)
accepted by the service to the time that they are entered as Complete
"KRN",19,10198,1,4,0)
in the computer.  Also lists the Standard Deviation and number of
"KRN",19,10198,1,5,0)
consults that were found for a date range.
"KRN",19,10198,10.1)
Completion Time Statistics
"KRN",19,10198,20)

"KRN",19,10198,25)
EN^GMRCST
"KRN",19,10198,"U")
COMPLETION TIME STATISTICS
"KRN",19,10975,-1)
0^6
"KRN",19,10975,0)
GMRC RPT COMPLETE/PENDING^Service Consults Completed or Pending Resolution^^R^^^^^^^^CONSULT/REQUEST TRACKING^^1
"KRN",19,10975,20)
S GMRCSTAT="2,3,4,5,6,8,9,11,99"
"KRN",19,10975,25)
EN^GMRCPC
"KRN",19,10975,"U")
SERVICE CONSULTS COMPLETED OR 
"KRN",19,10976,-1)
0^7
"KRN",19,10976,0)
GMRC RPT COMPLETE CONSULTS^Service Consults Completed^^R^^^^^^^^CONSULT/REQUEST TRACKING^^1
"KRN",19,10976,20)
S GMRCSTAT="2"
"KRN",19,10976,25)
EN^GMRCPC
"KRN",19,10976,"U")
SERVICE CONSULTS COMPLETED
"KRN",19,10978,-1)
0^8
"KRN",19,10978,0)
GMRC RPT CONSULTS BY STATUS^Service Consults By Status^^R^^^^^^^^CONSULT/REQUEST TRACKING^^
"KRN",19,10978,20)

"KRN",19,10978,25)
ENSTS^GMRCPC1
"KRN",19,10978,"U")
SERVICE CONSULTS BY STATUS
"KRN",19,10979,-1)
0^9
"KRN",19,10979,0)
GMRC RPT NUMBERED CONSULTS^Service Consults with Consults Numbers^^R^^^^^^^^CONSULT/REQUEST TRACKING^^1
"KRN",19,10979,20)
S GMRCCTRL=120
"KRN",19,10979,25)
ENSTS^GMRCPC1
"KRN",19,10979,"U")
SERVICE CONSULTS WITH CONSULTS
"KRN",19,10981,-1)
0^1
"KRN",19,10981,0)
GMRC PRINT COMPLETION STAT^Print Completion Time Statistics Report^^R^^^^^^^^
"KRN",19,10981,1,0)
^19.06^3^3^3001015^^^^
"KRN",19,10981,1,1,0)
Sends the Completion Time Statistics report to a device without going
"KRN",19,10981,1,2,0)
throuh the List Manager display of the report and waiting for the list to
"KRN",19,10981,1,3,0)
be built.
"KRN",19,10981,25)
PRNTONLY^GMRCST
"KRN",19,10981,"U")
PRINT COMPLETION TIME STATISTI
"KRN",19,10982,-1)
0^2
"KRN",19,10982,0)
GMRC PRINT RPT NUMBERED^Print Service Consults by Status^^R^^^^^^^^^^
"KRN",19,10982,1,0)
^19.06^3^3^3000314^^
"KRN",19,10982,1,1,0)
Sends the Service Consults By Status report to a device without going
"KRN",19,10982,1,2,0)
throuh the List Manager display of the report and waiting for the list to
"KRN",19,10982,1,3,0)
be built.
"KRN",19,10982,20)

"KRN",19,10982,25)
PRNTONLY^GMRCPC(120)
"KRN",19,10982,"U")
PRINT SERVICE CONSULTS BY STAT
"KRN",19,11240,-1)
0^3
"KRN",19,11240,0)
GMRC PRINT BY SEARCH^Print Consults by Provider, Location, or Procedure^^R^^^^^^^^
"KRN",19,11240,1,0)
^19.06^2^2^3010904^^
"KRN",19,11240,1,1,0)
This option will allow printing of Consults by searching on Provider, Location, 
"KRN",19,11240,1,2,0)
Procedure, date range, or status.
"KRN",19,11240,25)
EN^GMRCPSL1
"KRN",19,11240,99)
58686,53687
"KRN",19,11240,"U")
PRINT CONSULTS BY PROVIDER, LO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",66,-1)
1^1
"PKG",66,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",66,20,0)
^9.402P^^
"PKG",66,22,0)
^9.49I^1^1
"PKG",66,22,1,0)
3.0^2980101^2980204^64
"PKG",66,22,1,"PAH",1,0)
23^3020110^222222227
"PKG",66,22,1,"PAH",1,1,0)
^^1^1^3020110
"PKG",66,22,1,"PAH",1,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*23.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","GMRCART")
0^8^B39438414
"RTN","GMRCART",1,0)
GMRCART ;SLC/DCM,DLT - Result display logic ;1/10/02  14:24
"RTN","GMRCART",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,15,17,23**;DEC 27, 1997
"RTN","GMRCART",3,0)
 ;
"RTN","GMRCART",4,0)
 ; This routine invokes IA #2638
"RTN","GMRCART",5,0)
 ; DBIA 10060   ;NEW PERSON
"RTN","GMRCART",6,0)
 ;
"RTN","GMRCART",7,0)
RT(GMRCO) ;Result Display logic - called from GMRCA1
"RTN","GMRCART",8,0)
 N GMRCCT,GMRCTMP,GMRCSR,GMRCTUFN,GMRCSTS,GMRCMSG
"RTN","GMRCART",9,0)
 ;
"RTN","GMRCART",10,0)
 S GMRCSR=$P($G(^GMR(123,+GMRCO,0)),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCART",11,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",12,0)
 I '$$RESOLUS^GMRCAU(GMRCSTS),('+GMRCSR&('GMRCTUFN)) S GMRCMSG="No results available for review." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCART",13,0)
 ;
"RTN","GMRCART",14,0)
 W !,"Compiling Result Display..."
"RTN","GMRCART",15,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCART",16,0)
 K ^TMP("GMRCR",$J,"DT") S GMRCCT=1
"RTN","GMRCART",17,0)
 S XQORM("A")="Select Action: "
"RTN","GMRCART",18,0)
 S:$D(VALMAR) GMRCVAL=VALMAR
"RTN","GMRCART",19,0)
 S GMRCTMP="^TMP(""GMRCR"",$J,""DT"")"
"RTN","GMRCART",20,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",21,0)
 ;
"RTN","GMRCART",22,0)
 D GETRSLT(GMRCTMP)
"RTN","GMRCART",23,0)
 ;
"RTN","GMRCART",24,0)
 D EN^VALM("GMRC RESULTS DISPLAY")
"RTN","GMRCART",25,0)
 S:$D(GMRCVAL) VALMAR=GMRCVAL S:$D(LNCT) VALMCNT=LNCT
"RTN","GMRCART",26,0)
 D KILL^VALM10()
"RTN","GMRCART",27,0)
 K OREND,ORAGE,ORIO,ORDOB,ORFT,ORHI,ORIFN,ORNP,ORL,ORPD,ORPNM,ORPV,ORSEQ,ORSEX,ORWARD,ORDG
"RTN","GMRCART",28,0)
 K GMRCDVL,GMRCLCT,GMRCRPT,GMRCTUFN,GMRCVAL,MCFILE,MCPROC,GMRCX,GMRCTO,GMRCPRNM
"RTN","GMRCART",29,0)
 D END
"RTN","GMRCART",30,0)
 Q
"RTN","GMRCART",31,0)
 ;
"RTN","GMRCART",32,0)
GETRSLT(TMPGLOB,GMRCDET) ;load the results into global defined in TMPGLOB
"RTN","GMRCART",33,0)
 ;used for GUI formated results and list manager
"RTN","GMRCART",34,0)
 ;
"RTN","GMRCART",35,0)
 ;I GMRCDET=1 coming from a detailed display not results display
"RTN","GMRCART",36,0)
 ;
"RTN","GMRCART",37,0)
 N GMRCCT,GMRCCTS,SF,TAB
"RTN","GMRCART",38,0)
 S TAB="",$P(TAB," ",31)=""
"RTN","GMRCART",39,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",40,0)
 K @TMPGLOB
"RTN","GMRCART",41,0)
 S GMRCCT=1
"RTN","GMRCART",42,0)
 I $L($P(^GMR(123,GMRCO,0),"^",19)) S SF=$P(^(0),"^",19),@TMPGLOB@(GMRCCT,0)="Significant Findings: "_$S(SF="Y":"**Yes**",SF="N":"No",1:"Unknown"),GMRCCT=GMRCCT+1
"RTN","GMRCART",43,0)
 ;S @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",44,0)
 D PRINT^GMRCTIUP(GMRCO,GMRCCT,1)
"RTN","GMRCART",45,0)
 S GMRCCTS=GMRCCT ;save the line count before printing med and TIU notes
"RTN","GMRCART",46,0)
 D GETMCAR
"RTN","GMRCART",47,0)
 D GETCP
"RTN","GMRCART",48,0)
 D GETRES
"RTN","GMRCART",49,0)
 I GMRCCT=GMRCCTS D  ;check if count changed for notes or med results
"RTN","GMRCART",50,0)
 . S:+$L($G(SF)) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",51,0)
 . S @TMPGLOB@(GMRCCT,0)="No TIU results or Medicine results available for this consult"
"RTN","GMRCART",52,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCART",53,0)
 ;
"RTN","GMRCART",54,0)
 I '$D(GMRCDET) D GETCOM
"RTN","GMRCART",55,0)
 I GMRCCT>2 S @TMPGLOB@(GMRCCT,0)="",$P(@TMPGLOB@(GMRCCT,0),"=",81)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",56,0)
 Q
"RTN","GMRCART",57,0)
 ;
"RTN","GMRCART",58,0)
GETMCAR ;load the medicine results into TMPGLOB
"RTN","GMRCART",59,0)
 Q:'$O(^TMP("GMRCR",$J,"MCAR",0))
"RTN","GMRCART",60,0)
 N ND,ND1
"RTN","GMRCART",61,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"MCAR",ND)) Q:ND=""!(ND?1A.E)  D
"RTN","GMRCART",62,0)
 .S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",63,0)
 .S @TMPGLOB@(GMRCCT,0)=TAB_"Medicine Package Report",GMRCCT=GMRCCT+1
"RTN","GMRCART",64,0)
 .S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"MCAR",ND,ND1)) Q:ND1=""  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"MCAR",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",65,0)
 .Q
"RTN","GMRCART",66,0)
 K ^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCART",67,0)
 Q
"RTN","GMRCART",68,0)
 ;
"RTN","GMRCART",69,0)
GETCP ; Load up any Clin. Proc. results
"RTN","GMRCART",70,0)
 Q:'$O(^TMP("GMRCR",$J,"CP",0))
"RTN","GMRCART",71,0)
 N ND,ND1
"RTN","GMRCART",72,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"CP",ND)) Q:ND=""!(ND?1A.E)  D
"RTN","GMRCART",73,0)
 .S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",74,0)
 .S @TMPGLOB@(GMRCCT,0)=TAB_"Clinical Procedure Report",GMRCCT=GMRCCT+1
"RTN","GMRCART",75,0)
 .S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"CP",ND,ND1)) Q:ND1=""  D
"RTN","GMRCART",76,0)
 .. S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"CP",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",77,0)
 .Q
"RTN","GMRCART",78,0)
 K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCART",79,0)
 Q
"RTN","GMRCART",80,0)
 ;
"RTN","GMRCART",81,0)
GETRES ;load the TIU notes into TMPGLOB
"RTN","GMRCART",82,0)
 Q:'+$O(^TMP("GMRCR",$J,"RES",0))
"RTN","GMRCART",83,0)
 ;
"RTN","GMRCART",84,0)
 N ND,ND1
"RTN","GMRCART",85,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES",ND)) Q:(ND="")!(ND?1A.E)  D
"RTN","GMRCART",86,0)
 . I $D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) D
"RTN","GMRCART",87,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",88,0)
 . . S @TMPGLOB@(GMRCCT,0)=$E(GMRCDVL,1,80-$L(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT"))\2)_^("GMRCRPT")_$E(GMRCDVL,1,80-$L(^("GMRCRPT"))\2)
"RTN","GMRCART",89,0)
 . . S GMRCCT=GMRCCT+1
"RTN","GMRCART",90,0)
 . S:'$D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1
"RTN","GMRCART",91,0)
 . S:$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",0)) @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",92,0)
 . S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1)) Q:ND1?1A.E!(ND1="")  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",93,0)
 . I $O(^TMP("GMRCR",$J,"RES",ND,"ADD",0)) S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1)) Q:ND1=""   D
"RTN","GMRCART",94,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",95,0)
 . . S @TMPGLOB@(GMRCCT,0)=TAB_"ADDENDUM TO REPORT",GMRCCT=GMRCCT+1
"RTN","GMRCART",96,0)
 . . S ND2=0 F  S ND2=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2)) Q:ND2=""!(ND2?1A.E)  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",97,0)
 . . Q
"RTN","GMRCART",98,0)
 . Q
"RTN","GMRCART",99,0)
 K ^TMP("GMRCR",$J,"RES")
"RTN","GMRCART",100,0)
 Q
"RTN","GMRCART",101,0)
 ;
"RTN","GMRCART",102,0)
GETCOM ;Get the comments for resolution actions
"RTN","GMRCART",103,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",104,0)
 Q:'$$RESOLUS^GMRCAU(+GMRCSTS) 
"RTN","GMRCART",105,0)
 ;
"RTN","GMRCART",106,0)
 ;Loop thru actions to find the resolution type actions
"RTN","GMRCART",107,0)
 N ND,ND1,ND2
"RTN","GMRCART",108,0)
 S ND="" F  S ND=$O(^GMR(123,+GMRCO,40,"B",ND)) Q:ND=""  S ND1=$O(^GMR(123,+GMRCO,40,"B",ND,"")) D
"RTN","GMRCART",109,0)
 . ;
"RTN","GMRCART",110,0)
 . ;Check for resulting action types:complete,sig finding,dc,cancel
"RTN","GMRCART",111,0)
 . N GMRCAIEN
"RTN","GMRCART",112,0)
 . S GMRCAIEN=$P($G(^GMR(123,+GMRCO,40,ND1,0)),"^",2)
"RTN","GMRCART",113,0)
 . I '$$RESOLUA^GMRCAU(GMRCAIEN) Q
"RTN","GMRCART",114,0)
 . ;
"RTN","GMRCART",115,0)
 . ;save the action header info in case there are comments
"RTN","GMRCART",116,0)
 . N GMRCAHDR,GMRCPROV,GMRCENBY,GMRCENDT
"RTN","GMRCART",117,0)
 . D SAVEHDR
"RTN","GMRCART",118,0)
 . ;
"RTN","GMRCART",119,0)
 . ;check for comments, print header on first pass
"RTN","GMRCART",120,0)
 . S ND2=0
"RTN","GMRCART",121,0)
 . F  S ND2=$O(^GMR(123,GMRCO,40,ND1,1,ND2)) Q:ND2=""  D
"RTN","GMRCART",122,0)
 . . I +$G(GMRCAHDR) D GETHDR ;GMRCAHDR will =1 on first pass
"RTN","GMRCART",123,0)
 . . S @TMPGLOB@(GMRCCT,0)=^GMR(123,GMRCO,40,ND1,1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",124,0)
 . . Q
"RTN","GMRCART",125,0)
 . Q
"RTN","GMRCART",126,0)
 Q
"RTN","GMRCART",127,0)
 ;
"RTN","GMRCART",128,0)
SAVEHDR ;Save the action header info to print later if there are comments
"RTN","GMRCART",129,0)
 S GMRCAHDR=1 ;flag to print action header on first pass of comments
"RTN","GMRCART",130,0)
 ;save the provider, entered by and date
"RTN","GMRCART",131,0)
 S GMRCPROV=$P(^GMR(123,GMRCO,40,ND1,0),"^",4),GMRCENBY=$P(^(0),"^",5)
"RTN","GMRCART",132,0)
 S GMRCENDT=$$FMTE^XLFDT($P($G(^GMR(123,GMRCO,40,ND1,0)),"^",3))
"RTN","GMRCART",133,0)
 Q
"RTN","GMRCART",134,0)
 ;
"RTN","GMRCART",135,0)
GETHDR ;Print the comment header if the action had a comment
"RTN","GMRCART",136,0)
 S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",137,0)
 S @TMPGLOB@(GMRCCT,0)=$$CENTER^GMRCP5D("("_$P($G(^GMR(123.1,GMRCAIEN,0)),"^",8)_" Comment)"),GMRCCT=GMRCCT+1
"RTN","GMRCART",138,0)
 S @TMPGLOB@(GMRCCT,0)="      Entered by: "_$S($L(GMRCENBY):$P(^VA(200,GMRCENBY,0),"^",1),1:"")_" - "_GMRCENDT,GMRCCT=GMRCCT+1
"RTN","GMRCART",139,0)
 I +GMRCPROV S @TMPGLOB@(GMRCCT,0)="      Responsible Clinician: "_$P($G(^VA(200,GMRCPROV,0)),"^",1),GMRCCT=GMRCCT+1
"RTN","GMRCART",140,0)
 K GMRCAHDR
"RTN","GMRCART",141,0)
 Q
"RTN","GMRCART",142,0)
 ; 
"RTN","GMRCART",143,0)
END ;kill off variables and exit
"RTN","GMRCART",144,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCART",145,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCART",146,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCART",147,0)
 Q
"RTN","GMRCASV1")
0^12^B2971576
"RTN","GMRCASV1",1,0)
GMRCASV1 ;SLC/JFR - HIERARCHY MGMT cont'd ;1/10/02  14:25
"RTN","GMRCASV1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**18,15,23**;DEC 27, 1997
"RTN","GMRCASV1",3,0)
 ;
"RTN","GMRCASV1",4,0)
 ; This routine invokes IA #3252
"RTN","GMRCASV1",5,0)
 ;
"RTN","GMRCASV1",6,0)
 Q  ; don't start at the top
"RTN","GMRCASV1",7,0)
GUI(GMRCARR,GMRCSTRT,GMRCWHY,GMRCSYN,GMRCO) ;;return CSLT services for GUI
"RTN","GMRCASV1",8,0)
 ;Input:
"RTN","GMRCASV1",9,0)
 ; GMRCARR - passed in as the array to return results in
"RTN","GMRCASV1",10,0)
 ; GMRCSTRT- service to begin building from
"RTN","GMRCASV1",11,0)
 ; GMRCWHY - 0 for display, 1 for forwarding or ordering
"RTN","GMRCASV1",12,0)
 ; GMRCSYN - Boolean: 1=return synonyms, 0=do not
"RTN","GMRCASV1",13,0)
 ; GMRCO   - consult ien from file 123
"RTN","GMRCASV1",14,0)
 ;
"RTN","GMRCASV1",15,0)
 ;Output: Array formatted as follows-
"RTN","GMRCASV1",16,0)
 ;      svc ien^svc name or syn^parent^has children^svc usage
"RTN","GMRCASV1",17,0)
 ;
"RTN","GMRCASV1",18,0)
 N GMRCDG,GMRCGRP,GMRCTO
"RTN","GMRCASV1",19,0)
 N GMRCO ; remove with GMRC*3*22
"RTN","GMRCASV1",20,0)
 S GMRCDG=GMRCSTRT,GMRCTO=GMRCWHY
"RTN","GMRCASV1",21,0)
 D SERV1^GMRCASV I '$D(^TMP("GMRCSLIST",$J)) Q
"RTN","GMRCASV1",22,0)
 I '$G(GMRCSYN) M @GMRCARR=^TMP("GMRCSLIST",$J) Q  ;no synonyms needed
"RTN","GMRCASV1",23,0)
 N GMRC,GMRCSVC,GMRCS,NEXT,PIEC
"RTN","GMRCASV1",24,0)
 S GMRC=0,NEXT=$O(^TMP("GMRCSLIST",$J," "),-1)+1
"RTN","GMRCASV1",25,0)
 F  S GMRC=$O(^TMP("GMRCSLIST",$J,GMRC)) Q:'GMRC  Q:$P(^TMP("GMRCSLIST",$J,GMRC),U,5)="S"  D
"RTN","GMRCASV1",26,0)
 . I $P(^TMP("GMRCSLIST",$J,GMRC),U,5)=1 Q
"RTN","GMRCASV1",27,0)
 . S GMRCSVC=+^TMP("GMRCSLIST",$J,GMRC)
"RTN","GMRCASV1",28,0)
 . S GMRCS=0
"RTN","GMRCASV1",29,0)
 . F  S GMRCS=$O(^GMR(123.5,GMRCSVC,2,GMRCS)) Q:'GMRCS  D
"RTN","GMRCASV1",30,0)
 .. S PIEC(1)=GMRCSVC
"RTN","GMRCASV1",31,0)
 .. S PIEC(2)=$P(^GMR(123.5,GMRCSVC,0),U)
"RTN","GMRCASV1",32,0)
 .. S PIEC(2)=^GMR(123.5,GMRCSVC,2,GMRCS,0)_"  <"_PIEC(2)_">"
"RTN","GMRCASV1",33,0)
 .. S ^TMP("GMRCSLIST",$J,NEXT)=PIEC(1)_"^"_PIEC(2)_"^^^S"
"RTN","GMRCASV1",34,0)
 .. S NEXT=NEXT+1
"RTN","GMRCASV1",35,0)
 .. Q
"RTN","GMRCASV1",36,0)
 . Q
"RTN","GMRCASV1",37,0)
 M @GMRCARR=^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",38,0)
 K ^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",39,0)
 Q
"RTN","GMRCMER")
0^11^B3524723
"RTN","GMRCMER",1,0)
GMRCMER ;SLC/DCM - Print Medicine Results in List Manager Format ;1/10/02  14:26
"RTN","GMRCMER",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,15,23**;DEC 27, 1997
"RTN","GMRCMER",3,0)
 ;
"RTN","GMRCMER",4,0)
EN ; -- main entry point for GMRC ASSOCIATE RESULTS
"RTN","GMRCMER",5,0)
 D EN^VALM("GMRC ASSOCIATE RESULTS")
"RTN","GMRCMER",6,0)
 Q
"RTN","GMRCMER",7,0)
 ;
"RTN","GMRCMER",8,0)
HDRAR ; -- header code uses Detailed Display header to format VALMHDR
"RTN","GMRCMER",9,0)
 N GMRCVTIT
"RTN","GMRCMER",10,0)
 S GMRCVTIT="Procedure/Medicine Resulting"
"RTN","GMRCMER",11,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP
"RTN","GMRCMER",12,0)
 D HDR^GMRCSLDT
"RTN","GMRCMER",13,0)
 S VALMHDR(2)=$$CJ^XLFSTR("Available Medicine Results",80)
"RTN","GMRCMER",14,0)
 Q
"RTN","GMRCMER",15,0)
 ;
"RTN","GMRCMER",16,0)
HDR ;header for results display
"RTN","GMRCMER",17,0)
 D HDR^GMRCSLDT
"RTN","GMRCMER",18,0)
 Q
"RTN","GMRCMER",19,0)
 ;
"RTN","GMRCMER",20,0)
INITAR ; -- init variables and list array for ASSOCIATE RESULTS
"RTN","GMRCMER",21,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",22,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",999999),-1)
"RTN","GMRCMER",23,0)
 Q
"RTN","GMRCMER",24,0)
INIT ; -- init variables and list array for RESULTS DISPLAY
"RTN","GMRCMER",25,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",26,0)
 N LINE
"RTN","GMRCMER",27,0)
 S DSPLINE=0,VARMAR=$NA(^TMP("GMRCR",$J,"DTLIST")),LINE=1
"RTN","GMRCMER",28,0)
 F  S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA) S LINE=LINE+1
"RTN","GMRCMER",29,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DTLIST"," "),-1)
"RTN","GMRCMER",30,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCMER",31,0)
 Q
"RTN","GMRCMER",32,0)
 ;
"RTN","GMRCMER",33,0)
HELP ; -- help code for display actions
"RTN","GMRCMER",34,0)
 D HELP^GMRCSLDT
"RTN","GMRCMER",35,0)
 Q
"RTN","GMRCMER",36,0)
 ;
"RTN","GMRCMER",37,0)
EXIT ; -- exit code
"RTN","GMRCMER",38,0)
 K ^TMP("GMRCR",$J,"DT"),^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",39,0)
 S:$D(GMRCLCT) VALMCNT=GMRCLCT
"RTN","GMRCMER",40,0)
 K GLOBAL,GMRCMODE,GMRCND,GMRCSGAD,GMRCCSIG,GMRCCSDT,GMRCSIGT,GMRCSR,GMRCSIGM,GMRCCTIT,GMRCLCT,GMRCADD,GMRCADDT,GMRCSDT,GMRCSIG,GMRCTUFN,ND,ND1
"RTN","GMRCMER",41,0)
 Q
"RTN","GMRCMER",42,0)
 ;
"RTN","GMRCP5B")
0^7^B32803050
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;1/10/02  14:26
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15,24,23**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 ; Patch #23 add "SERVICE RENDERED AS:" to SF513
"RTN","GMRCP5B",5,0)
 ; This routine invokes IA #1252,#10112
"RTN","GMRCP5B",6,0)
 ; DBIA 10035      ;PATIENT FILE
"RTN","GMRCP5B",7,0)
 ; DBIA 2849       ;PROTOCOL
"RTN","GMRCP5B",8,0)
 ; DBIA 10060      ;NEW PERSON
"RTN","GMRCP5B",9,0)
 Q
"RTN","GMRCP5B",10,0)
 ;
"RTN","GMRCP5B",11,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",14,0)
 ;
"RTN","GMRCP5B",15,0)
REQUEST ;
"RTN","GMRCP5B",16,0)
 N GMRCX
"RTN","GMRCP5B",17,0)
 ;
"RTN","GMRCP5B",18,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",19,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",20,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Current Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",21,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",22,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",23,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"    Current Primary Care Team: "_GMRCX)
"RTN","GMRCP5B",24,0)
 ;
"RTN","GMRCP5B",25,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",26,0)
 ;
"RTN","GMRCP5B",27,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",28,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",29,0)
 ;
"RTN","GMRCP5B",30,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",31,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",32,0)
 E  D
"RTN","GMRCP5B",33,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",34,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",35,0)
 ;
"RTN","GMRCP5B",36,0)
 Q
"RTN","GMRCP5B",37,0)
PDIAG ;
"RTN","GMRCP5B",38,0)
 ;
"RTN","GMRCP5B",39,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",40,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",41,0)
 ;
"RTN","GMRCP5B",42,0)
 S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",43,0)
 S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",44,0)
 S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",45,0)
 S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",46,0)
 S:$L(GMRCPGR) GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",47,0)
 I '$L(GMRCPGR) S GMRCPGR=$P(GMRCX,U,2) S:$L(GMRCPGR) GMRCPGR="(Phone: "_GMRCPGR_")"
"RTN","GMRCP5B",48,0)
 ;
"RTN","GMRCP5B",49,0)
 S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",50,0)
 S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+GMRCQSTR,8)
"RTN","GMRCP5B",51,0)
 S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: ")
"RTN","GMRCP5B",54,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",58,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",59,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",60,0)
 ;
"RTN","GMRCP5B",61,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",62,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",63,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",64,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",65,0)
 D BLD("PDIAG",1,1,0,GMRCPGR)
"RTN","GMRCP5B",66,0)
 D BLD("PDIAG",1,0,35,"|SERVICE RENDERED AS:")
"RTN","GMRCP5B",67,0)
 D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",68,0)
 S GMRCINOU=$S($P(GMRCRD,U,18)="O":"OUT PATIENT",1:"INPATIENT")
"RTN","GMRCP5B",69,0)
 D BLD("PDIAG",1,1,35,"|"_GMRCINOU)
"RTN","GMRCP5B",70,0)
 D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",71,0)
 K GMRCINOU
"RTN","GMRCP5B",72,0)
 ;***************************************************************
"RTN","GMRCP5B",73,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",74,0)
 ;
"RTN","GMRCP5B",75,0)
 Q
"RTN","GMRCP5B",76,0)
 ;
"RTN","GMRCP5B",77,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",78,0)
 ;
"RTN","GMRCP5B",79,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,GMRCX,VAIN,VAPA,VAERR
"RTN","GMRCP5B",80,0)
 ;
"RTN","GMRCP5B",81,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",82,0)
 ;
"RTN","GMRCP5B",83,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",84,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",85,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",86,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",87,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",88,0)
 ;
"RTN","GMRCP5B",89,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",90,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",91,0)
 ;
"RTN","GMRCP5B",92,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",93,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",94,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",95,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",96,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",97,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",98,0)
 E  D
"RTN","GMRCP5B",99,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",100,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",101,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",102,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",103,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",104,0)
 ;
"RTN","GMRCP5B",105,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",106,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",107,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",108,0)
 ;
"RTN","GMRCP5B",109,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",110,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",111,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",112,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",113,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",114,0)
 ;
"RTN","GMRCP5B",115,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",116,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",117,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",118,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",119,0)
 ;
"RTN","GMRCP5B",120,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",121,0)
 ;
"RTN","GMRCP5B",122,0)
 F SUB=0,1 D
"RTN","GMRCP5B",123,0)
 .D BLD("FTR",SUB,1,0,$P($G(^DPT(GMRCDFN,0)),U,1)_"  "_GMRCELIG)
"RTN","GMRCP5B",124,0)
 .I 'SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5B",125,0)
 .I SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET  (Continued)")
"RTN","GMRCP5B",126,0)
 .D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",127,0)
 .D BLD("FTR",SUB,0,20,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",128,0)
 .D BLD("FTR",SUB,0,45,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",129,0)
 ;
"RTN","GMRCP5B",130,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",131,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX)) BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",132,0)
 ;
"RTN","GMRCP5B",133,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",134,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",135,0)
 ;
"RTN","GMRCP5B",136,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",137,0)
 ;
"RTN","GMRCP5B",138,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",139,0)
 ;
"RTN","GMRCP5B",140,0)
 Q
"RTN","GMRCP5B",141,0)
 ;
"RTN","GMRCP5B",142,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",143,0)
 ;
"RTN","GMRCP5B",144,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",145,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",146,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",147,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",148,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",149,0)
 ;
"RTN","GMRCP5B",150,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",151,0)
 ;
"RTN","GMRCP5B",152,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",153,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",154,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",155,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5B",156,0)
 ;
"RTN","GMRCP5B",157,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",158,0)
 ;
"RTN","GMRCP5B",159,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",160,0)
 ;
"RTN","GMRCP5B",161,0)
 ;
"RTN","GMRCP5B",162,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",163,0)
 ;
"RTN","GMRCP5B",164,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",165,0)
 N LINECNT
"RTN","GMRCP5B",166,0)
 ;
"RTN","GMRCP5B",167,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",168,0)
 ;
"RTN","GMRCP5B",169,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",170,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",171,0)
 ;
"RTN","GMRCP5B",172,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",173,0)
 Q
"RTN","GMRCP5B",174,0)
 ;
"RTN","GMRCP5B",175,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",176,0)
 ;
"RTN","GMRCP5B",177,0)
 N NEXT
"RTN","GMRCP5B",178,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",179,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",180,0)
 Q
"RTN","GMRCP5B",181,0)
 ;
"RTN","GMRCP5B",182,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",183,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",184,0)
 ;
"RTN","GMRCPC")
0^10^B10687921
"RTN","GMRCPC",1,0)
GMRCPC ;SLC/DCM,dee,MA - List Manager Routine: Collect and display consults by service and status ;1/10/02  14:26
"RTN","GMRCPC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21,23**;DEC 27, 1997
"RTN","GMRCPC",3,0)
 ; Patch #21 added clean-up KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCPC",4,0)
 ; Patch #23 added a KILL for GMRCSVNM
"RTN","GMRCPC",5,0)
EN ;GMRC List Manager Routine -- main entry point for GMRC PENDING CONSULTS
"RTN","GMRCPC",6,0)
 K GMRCSVC,GMRCSVCP
"RTN","GMRCPC",7,0)
 I $D(GMRCEACT),$L(GMRCEACT) D  I '$D(^GMR(123.5,$G(GMRCSVC),0)) D EXIT Q
"RTN","GMRCPC",8,0)
 .S GMRCSVCP=GMRCEACT
"RTN","GMRCPC",9,0)
 .S GMRCSVC=$O(^GMR(123.5,"B",GMRCSVCP,0))
"RTN","GMRCPC",10,0)
 .Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCPC",11,0)
 .;Build service array
"RTN","GMRCPC",12,0)
 .S GMRCDG=GMRCSVC
"RTN","GMRCPC",13,0)
 .D SERV1^GMRCASV
"RTN","GMRCPC",14,0)
 .S GMRCDT1="ALL"
"RTN","GMRCPC",15,0)
 .S GMRCDT2=0
"RTN","GMRCPC",16,0)
 .D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCPC",17,0)
 ;If no service ask for one
"RTN","GMRCPC",18,0)
 I '$L($G(GMRCSVC)) D EN^GMRCSTLM I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",19,0)
 ;Quit if no array of services
"RTN","GMRCPC",20,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCPC",21,0)
 ;
"RTN","GMRCPC",22,0)
 D EN^VALM("GMRC PENDING CONSULTS")
"RTN","GMRCPC",23,0)
 ;
"RTN","GMRCPC",24,0)
HDR ; -- header code
"RTN","GMRCPC",25,0)
 Q:$D(GMRCQUT)!'$D(GMRCCT)
"RTN","GMRCPC",26,0)
 S VALMHDR(1)="To Service:  "_GMRCHEAD
"RTN","GMRCPC",27,0)
 S VALMHDR(2)="From: "_$G(GMRCEDT1)_"   To: "_$G(GMRCEDT2)
"RTN","GMRCPC",28,0)
 I $G(GMRCCTRL)=1 S VALMCAP="     "_VALMCAP
"RTN","GMRCPC",29,0)
 Q
"RTN","GMRCPC",30,0)
 ;
"RTN","GMRCPC",31,0)
INIT ; -- init variables and list array
"RTN","GMRCPC",32,0)
 ;This entry is not used ENORLM^GMRCSTLM is used instead.
"RTN","GMRCPC",33,0)
 Q
"RTN","GMRCPC",34,0)
 ;
"RTN","GMRCPC",35,0)
HELP ; -- help code
"RTN","GMRCPC",36,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPC",37,0)
 Q
"RTN","GMRCPC",38,0)
 ;
"RTN","GMRCPC",39,0)
EXIT ; -- exit code
"RTN","GMRCPC",40,0)
 K CNT,CTRLCOL,GMRCCT,GMRCQUT,GMRCSVC,GMRCSVCP,VALMHDR,GMRCCOMP
"RTN","GMRCPC",41,0)
 K GMRCEDT1,GMRCEDT2,GMRCSVNM
"RTN","GMRCPC",42,0)
 K GMRCHEAD,GMRCCTRL,GMRCSTAT
"RTN","GMRCPC",43,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J),^TMP("GMRCR",$J,"CP"),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCPC",44,0)
 Q
"RTN","GMRCPC",45,0)
 ;
"RTN","GMRCPC",46,0)
EXPND ; -- expand code
"RTN","GMRCPC",47,0)
 Q
"RTN","GMRCPC",48,0)
 ;
"RTN","GMRCPC",49,0)
CWIDTH(GMRCCTRL) ;Prints a message about how wide the report is.
"RTN","GMRCPC",50,0)
 N WIDTH
"RTN","GMRCPC",51,0)
 S WIDTH=92
"RTN","GMRCPC",52,0)
 I GMRCCTRL#100\10 D
"RTN","GMRCPC",53,0)
 .I GMRCCTRL#100\10=1 S WIDTH=WIDTH+5
"RTN","GMRCPC",54,0)
 .E  S WIDTH=WIDTH+10
"RTN","GMRCPC",55,0)
 I GMRCCTRL#1000\100 S WIDTH=WIDTH-6
"RTN","GMRCPC",56,0)
 Q WIDTH
"RTN","GMRCPC",57,0)
 ;
"RTN","GMRCPC",58,0)
PWIDTH(GMRCCTRL) ;Prints a message about how wide the report is.
"RTN","GMRCPC",59,0)
 W !!,"This print out is "_$$CWIDTH(GMRCCTRL)_" columns wide."
"RTN","GMRCPC",60,0)
 Q
"RTN","GMRCPC",61,0)
 ;
"RTN","GMRCPC",62,0)
PRNTONLY(GMRCCTRL) ;Option to just send the report to a device.
"RTN","GMRCPC",63,0)
 N GMRCQUT,RETURN,GMRCDG,GMRCSTAT,VALMBCK
"RTN","GMRCPC",64,0)
 N GMRCDT1,GMRCDT2,GMRCEDT1,GMRCEDT2
"RTN","GMRCPC",65,0)
 ;Get the statuses
"RTN","GMRCPC",66,0)
 S GMRCSTAT=$$STS^GMRCPC1
"RTN","GMRCPC",67,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",68,0)
 ;Get the service and date range.
"RTN","GMRCPC",69,0)
 D EN^GMRCSTLM
"RTN","GMRCPC",70,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",71,0)
 ;Quit if no array of services
"RTN","GMRCPC",72,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCPC",73,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCPC",74,0)
 D PWIDTH(GMRCCTRL)
"RTN","GMRCPC",75,0)
 ;Get the device
"RTN","GMRCPC",76,0)
 D PRNTASK^GMRCSTU
"RTN","GMRCPC",77,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",78,0)
 ;Save some things if the report is queued
"RTN","GMRCPC",79,0)
 I $D(IO("Q")) D
"RTN","GMRCPC",80,0)
 .S ZTSAVE("GMRCSTAT")=""
"RTN","GMRCPC",81,0)
 .S ZTSAVE("GMRCCTRL")=""
"RTN","GMRCPC",82,0)
 ;Create the report if not queued
"RTN","GMRCPC",83,0)
 E  D ENOR^GMRCSTLM(.RETURN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL)
"RTN","GMRCPC",84,0)
 ;Print the report
"RTN","GMRCPC",85,0)
 D PRNTIT^GMRCSTU("CP","PRNTQ^GMRCPC","CONSULT/REQUEST PACKAGE PRINT SERVICE CONSULTS BY STATUS FROM OPTION")
"RTN","GMRCPC",86,0)
 D EXIT
"RTN","GMRCPC",87,0)
 Q
"RTN","GMRCPC",88,0)
 ;
"RTN","GMRCPC",89,0)
PRNTQ ;Print Queued report from ^TMP global then kill off ^TMP & ^XTMP
"RTN","GMRCPC",90,0)
 ;Create the report
"RTN","GMRCPC",91,0)
 N RETURN,INDEX
"RTN","GMRCPC",92,0)
 D ENOR^GMRCSTLM(.RETURN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL)
"RTN","GMRCPC",93,0)
 U IO
"RTN","GMRCPC",94,0)
 S INDEX=""
"RTN","GMRCPC",95,0)
 F  S INDEX=$O(^TMP("GMRCR",$J,TMPNAME,INDEX)) Q:INDEX=""  W ^TMP("GMRCR",$J,TMPNAME,INDEX,0),!
"RTN","GMRCPC",96,0)
 K ^TMP("GMRCR",$J,TMPNAME),^XTMP("GMRCR",J,DOLLARH,"PRINT"),J,DOLLARH
"RTN","GMRCPC",97,0)
 D ^%ZISC
"RTN","GMRCPC",98,0)
 D EXIT
"RTN","GMRCPC",99,0)
 Q
"RTN","GMRCPC",100,0)
 ;
"RTN","GMRCPSL1")
0^2^B43538144
"RTN","GMRCPSL1",1,0)
GMRCPSL1 ;SLC/MA - Special Consult Reports;9/21/01  05:25 ;1/10/02  14:26
"RTN","GMRCPSL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**23**;DEC 27, 1997
"RTN","GMRCPSL1",3,0)
 ; This is the main entry routine for the Consult Reports that
"RTN","GMRCPSL1",4,0)
 ; allow a user to search for consults by:  Provider, Location,
"RTN","GMRCPSL1",5,0)
 ; or Procedure.  Also the user may select a date range and
"RTN","GMRCPSL1",6,0)
 ; Consult status.
"RTN","GMRCPSL1",7,0)
EN ;
"RTN","GMRCPSL1",8,0)
 ; GMRCARRY = used for entering more than one search value.
"RTN","GMRCPSL1",9,0)
 ;            This array will be used by all the diff searches.
"RTN","GMRCPSL1",10,0)
 ; GMRCDT1  = Start date
"RTN","GMRCPSL1",11,0)
 ; GMRCDT2  = Stop date
"RTN","GMRCPSL1",12,0)
 ; GMRCEND  = If equal to one end routine
"RTN","GMRCPSL1",13,0)
 ; GMRCSRCH = Indicates which field to search on
"RTN","GMRCPSL1",14,0)
 ; GMRCSTAT = Indicates which CPRS status to include
"RTN","GMRCPSL1",15,0)
 ; GMRCRPT  = 80 - 132 character report & data only output
"RTN","GMRCPSL1",16,0)
 ; GMRCBRK  = Print page break between sub-totals <Y-N>
"RTN","GMRCPSL1",17,0)
 N GMRCDT1,GMRCDT2,GMRCARRY,GMRCSRCH,GMRCEND,GMRCSTAT,GMRCRPT,GMRCBRK
"RTN","GMRCPSL1",18,0)
 N GMRCQUIT
"RTN","GMRCPSL1",19,0)
 S (GMRCBRK,GMRCQUIT,GMRCEND)=0
"RTN","GMRCPSL1",20,0)
 S GMRCSRCH=$$GETSRCH                  ; Get search sequence
"RTN","GMRCPSL1",21,0)
 I GMRCSRCH=1 D                        ; Get Provider
"RTN","GMRCPSL1",22,0)
 . D GETPROV(.GMRCARRY) D
"RTN","GMRCPSL1",23,0)
 . . I '$D(GMRCARRY) D WARNING
"RTN","GMRCPSL1",24,0)
 ;
"RTN","GMRCPSL1",25,0)
 I GMRCSRCH=2 D                        ; Get Location
"RTN","GMRCPSL1",26,0)
 . D GETLOC(.GMRCARRY) D
"RTN","GMRCPSL1",27,0)
 . . I '$D(GMRCARRY) D WARNING
"RTN","GMRCPSL1",28,0)
 ;
"RTN","GMRCPSL1",29,0)
 I GMRCSRCH=3 D                        ; Get Procedure
"RTN","GMRCPSL1",30,0)
 . D GETPROC(.GMRCARRY) D
"RTN","GMRCPSL1",31,0)
 . . I '$D(GMRCARRY) D WARNING
"RTN","GMRCPSL1",32,0)
 I GMRCEND=1 K GMRCEND Q
"RTN","GMRCPSL1",33,0)
 S GMRCRPT=$$TYPERPT Q:GMRCRPT=0       ; Get type or print
"RTN","GMRCPSL1",34,0)
 I GMRCRPT'=3 S GMRCBRK=$$PAGEBRK      ; Break between sub-totals
"RTN","GMRCPSL1",35,0)
 I GMRCBRK>1 Q
"RTN","GMRCPSL1",36,0)
 D GETDATE I GMRCQUIT Q                ; Get Date
"RTN","GMRCPSL1",37,0)
 I '$D(GMRCDT2) Q
"RTN","GMRCPSL1",38,0)
 S GMRCDT2=GMRCDT2+1
"RTN","GMRCPSL1",39,0)
 ;
"RTN","GMRCPSL1",40,0)
 ;
"RTN","GMRCPSL1",41,0)
 S GMRCSTAT=$$STS^GMRCPC1 Q:'GMRCSTAT  ; Get search CPRS status
"RTN","GMRCPSL1",42,0)
 ;
"RTN","GMRCPSL1",43,0)
 I GMRCRPT=0 Q
"RTN","GMRCPSL1",44,0)
 ;
"RTN","GMRCPSL1",45,0)
 D DEVICE                              ; Get printer device
"RTN","GMRCPSL1",46,0)
 ;
"RTN","GMRCPSL1",47,0)
 ; At this point all user input has been collected
"RTN","GMRCPSL1",48,0)
 ;
"RTN","GMRCPSL1",49,0)
 I $D(IO("Q")) D QUEUE Q
"RTN","GMRCPSL1",50,0)
 ;
"RTN","GMRCPSL1",51,0)
 ; Go build ^TMP("GMRCRPT",$J) using user input variables &
"RTN","GMRCPSL1",52,0)
 ; write report
"RTN","GMRCPSL1",53,0)
 D PRINT^GMRCPSL2(GMRCSRCH,.GMRCARRY,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCRPT,GMRCBRK)  ;Report writer
"RTN","GMRCPSL1",54,0)
 KILL DIR,DIC,^TMP("GMRCRPT",$J)
"RTN","GMRCPSL1",55,0)
 Q
"RTN","GMRCPSL1",56,0)
 ;
"RTN","GMRCPSL1",57,0)
CHECK(GMRCDAT)  ;CHECK FREE TEXT INPUT 
"RTN","GMRCPSL1",58,0)
 N %DT,X,Y
"RTN","GMRCPSL1",59,0)
 I $E("ALL DATES",1,$L(GMRCDAT))=$$UP^XLFSTR(GMRCDAT) Q "ALL"
"RTN","GMRCPSL1",60,0)
 S %DT="E",X=GMRCDAT D ^%DT I Y<1 Q 0
"RTN","GMRCPSL1",61,0)
 Q +Y
"RTN","GMRCPSL1",62,0)
 I '$D(GMRCDT1) Q
"RTN","GMRCPSL1",63,0)
 I GMRCDT1="ALL" S GMRCDT1=0000000,GMRCDT2=9999999
"RTN","GMRCPSL1",64,0)
 Q
"RTN","GMRCPSL1",65,0)
DEVICE  ; device for printout of entries to group update
"RTN","GMRCPSL1",66,0)
 N %ZIS,POP
"RTN","GMRCPSL1",67,0)
 I GMRCRPT=2 D
"RTN","GMRCPSL1",68,0)
 . W !!,"You must configure your terminal so that it"
"RTN","GMRCPSL1",69,0)
 . W " will support 132 character"
"RTN","GMRCPSL1",70,0)
 . W !,"emulation and reply 132 to the right margin setting if"
"RTN","GMRCPSL1",71,0)
 . W " using HOME"
"RTN","GMRCPSL1",72,0)
 . W !,"as the device."
"RTN","GMRCPSL1",73,0)
 . W !,""
"RTN","GMRCPSL1",74,0)
 I GMRCRPT=3 D
"RTN","GMRCPSL1",75,0)
 . W !!,"OK, you have selected a TABLE output format."
"RTN","GMRCPSL1",76,0)
 . W !,"You must use your personal computer's terminal emulation"
"RTN","GMRCPSL1",77,0)
 . W !,"to capture the output:"
"RTN","GMRCPSL1",78,0)
 . W !,""
"RTN","GMRCPSL1",79,0)
 . W !,"     1.  Enter at the DEVICE: HOME// prompt "";250;99999999"
"RTN","GMRCPSL1",80,0)
 . W !,"         and do not hit the enter key."
"RTN","GMRCPSL1",81,0)
 . W !,"     2.  Open a capture file within your terminal emulation program."
"RTN","GMRCPSL1",82,0)
 . W !,"     3.  Hit enter to start the down load."
"RTN","GMRCPSL1",83,0)
 . W !,"     4.  Close the capture file when the output stops."
"RTN","GMRCPSL1",84,0)
 . W !,""
"RTN","GMRCPSL1",85,0)
RETRY ;
"RTN","GMRCPSL1",86,0)
 S %ZIS="MQ"
"RTN","GMRCPSL1",87,0)
 D ^%ZIS
"RTN","GMRCPSL1",88,0)
 I POP S GMRCEND=1 Q
"RTN","GMRCPSL1",89,0)
 Q
"RTN","GMRCPSL1",90,0)
 ;
"RTN","GMRCPSL1",91,0)
GETDATE ;Get START and STOP dates
"RTN","GMRCPSL1",92,0)
 ;GMRCDT1=Start date
"RTN","GMRCPSL1",93,0)
 ;GMRCDT2=Stop date
"RTN","GMRCPSL1",94,0)
 N DTOUT,DIR,DUOUT,DIRUT,X,Y
"RTN","GMRCPSL1",95,0)
GETDATE1 ;
"RTN","GMRCPSL1",96,0)
 S DIR(0)="FA^1:45",DIR("A")="List From Starting Date (ALL): "
"RTN","GMRCPSL1",97,0)
 S DIR("B")="T-30" D ^DIR
"RTN","GMRCPSL1",98,0)
 I $D(DUOUT)!($D(DTOUT)) S GMRCQUIT=1 Q
"RTN","GMRCPSL1",99,0)
 S GMRCDT1=$$CHECK(X)
"RTN","GMRCPSL1",100,0)
 I 'GMRCDT1,GMRCDT1'="ALL" G GETDATE1
"RTN","GMRCPSL1",101,0)
 I GMRCDT1="ALL" S GMRCDT1=0,GMRCDT2=9999999 Q
"RTN","GMRCPSL1",102,0)
 K DIR
"RTN","GMRCPSL1",103,0)
 S DIR(0)="DAO^::E",DIR("A")="List To This Ending Date: " D ^DIR
"RTN","GMRCPSL1",104,0)
 I $D(DTOUT)!($D(DUOUT)) K GMRCDT1,GMRCDT2 Q
"RTN","GMRCPSL1",105,0)
 I +Y=0 W "(NOW)" S GMRCDT2=$$DT^XLFDT Q
"RTN","GMRCPSL1",106,0)
 I +Y<GMRCDT1 S GMRCDT2=GMRCDT1,GMRCDT1=+Y
"RTN","GMRCPSL1",107,0)
 S:'$D(GMRCDT2) GMRCDT2=+Y
"RTN","GMRCPSL1",108,0)
 Q
"RTN","GMRCPSL1",109,0)
 ;
"RTN","GMRCPSL1",110,0)
 ; Get a Location
"RTN","GMRCPSL1",111,0)
GETLOC(GMRCARRY) ;
"RTN","GMRCPSL1",112,0)
 ; DBIA 10040 call DIC=44
"RTN","GMRCPSL1",113,0)
 N DIC,DIR,DIRUT,DUOUT,DTOUT,X,Y,GMRCCNTR,GMRCQLOC
"RTN","GMRCPSL1",114,0)
 S GMRCCNTR=0
"RTN","GMRCPSL1",115,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","GMRCPSL1",116,0)
 S DIR("A")="Enter 'YES' if you want all LOCATIONS"
"RTN","GMRCPSL1",117,0)
 W !,""
"RTN","GMRCPSL1",118,0)
 D ^DIR
"RTN","GMRCPSL1",119,0)
 W !,""
"RTN","GMRCPSL1",120,0)
 I Y=1 S GMRCARRY(1)="ALL"  Q
"RTN","GMRCPSL1",121,0)
 S DIC=44,DIC(0)="AEMQ",DIC("A")="ENTER LOCATION: "
"RTN","GMRCPSL1",122,0)
 F  D ^DIC Q:$D(DUOUT)!($D(DTOUT))!(Y<0)  D
"RTN","GMRCPSL1",123,0)
 .  S GMRCCNTR=GMRCCNTR+1
"RTN","GMRCPSL1",124,0)
 .  S GMRCARRY(GMRCCNTR)=Y
"RTN","GMRCPSL1",125,0)
 Q
"RTN","GMRCPSL1",126,0)
 ;
"RTN","GMRCPSL1",127,0)
 ; Get a Procedure
"RTN","GMRCPSL1",128,0)
GETPROC(GMRCARRY) ;
"RTN","GMRCPSL1",129,0)
 N DIC,DIR,DIRUT,DUOUT,DTOUT,X,Y,GMRCCNTR,GMRCQPRC
"RTN","GMRCPSL1",130,0)
 S GMRCCNTR=0
"RTN","GMRCPSL1",131,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","GMRCPSL1",132,0)
 S DIR("A")="Enter 'YES' if you want all PROCEDURES"
"RTN","GMRCPSL1",133,0)
 W !,""
"RTN","GMRCPSL1",134,0)
 D ^DIR
"RTN","GMRCPSL1",135,0)
 W !,""
"RTN","GMRCPSL1",136,0)
 I Y=1 S GMRCARRY(1)="ALL"  Q
"RTN","GMRCPSL1",137,0)
 S DIC=123.3,DIC(0)="AEMQ",DIC("A")="ENTER PROCEDURE: "
"RTN","GMRCPSL1",138,0)
 F  D ^DIC Q:$D(DUOUT)!($D(DTOUT))!(Y<0)  D
"RTN","GMRCPSL1",139,0)
 .  S GMRCCNTR=GMRCCNTR+1
"RTN","GMRCPSL1",140,0)
 .  S GMRCARRY(GMRCCNTR)=Y
"RTN","GMRCPSL1",141,0)
 Q
"RTN","GMRCPSL1",142,0)
 ;
"RTN","GMRCPSL1",143,0)
 ; Get a Provider name
"RTN","GMRCPSL1",144,0)
GETPROV(GMRCARRY) ;
"RTN","GMRCPSL1",145,0)
 ; DBIA 10060 call DIC=200
"RTN","GMRCPSL1",146,0)
 N DIC,DIRUT,DUOUT,DTOUT,X,Y,GMRCCNTR,GMRCQPRV
"RTN","GMRCPSL1",147,0)
 S GMRCCNTR=0
"RTN","GMRCPSL1",148,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","GMRCPSL1",149,0)
 S DIR("A")="Enter 'YES' if you want all PROVIDERS"
"RTN","GMRCPSL1",150,0)
 W !,""
"RTN","GMRCPSL1",151,0)
 D ^DIR
"RTN","GMRCPSL1",152,0)
 W !,""
"RTN","GMRCPSL1",153,0)
 I Y=1 S GMRCARRY(1)="ALL"  Q
"RTN","GMRCPSL1",154,0)
 S DIC=200,DIC(0)="AEMQ",DIC("A")="ENTER PROVIDER: "
"RTN","GMRCPSL1",155,0)
 F  D ^DIC Q:$D(DUOUT)!($D(DTOUT))!(Y<0)  D
"RTN","GMRCPSL1",156,0)
 .  S GMRCCNTR=GMRCCNTR+1
"RTN","GMRCPSL1",157,0)
 .  S GMRCARRY(GMRCCNTR)=Y
"RTN","GMRCPSL1",158,0)
 Q
"RTN","GMRCPSL1",159,0)
GETSRCH() ;   What search criteria should report be in???
"RTN","GMRCPSL1",160,0)
 N DIR,Y,X
"RTN","GMRCPSL1",161,0)
 S DIR("A",1)="Enter Search criteria:"
"RTN","GMRCPSL1",162,0)
 S DIR("A",2)=""
"RTN","GMRCPSL1",163,0)
 S DIR("A",3)="                  1 = Sending Provider"
"RTN","GMRCPSL1",164,0)
 S DIR("A",4)="                  2 = Location"
"RTN","GMRCPSL1",165,0)
 S DIR("A",5)="                  3 = Procedure"
"RTN","GMRCPSL1",166,0)
 S DIR("A",6)=""
"RTN","GMRCPSL1",167,0)
 S DIR("A")="Search criteria"
"RTN","GMRCPSL1",168,0)
 S DIR("B")=1
"RTN","GMRCPSL1",169,0)
 S DIR(0)="NO^1:3"
"RTN","GMRCPSL1",170,0)
 D ^DIR
"RTN","GMRCPSL1",171,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1
"RTN","GMRCPSL1",172,0)
 Q Y
"RTN","GMRCPSL1",173,0)
 ;
"RTN","GMRCPSL1",174,0)
PAGEBRK() ; Does user want page breaks between sub-totals?
"RTN","GMRCPSL1",175,0)
 N DIR
"RTN","GMRCPSL1",176,0)
 S DIR(0)="Y"
"RTN","GMRCPSL1",177,0)
 S DIR("A")="Display sort sequence & page breaks between sub-totals"
"RTN","GMRCPSL1",178,0)
 S DIR("B")="YES"
"RTN","GMRCPSL1",179,0)
 D ^DIR I $D(DIRUT) Q 2
"RTN","GMRCPSL1",180,0)
 Q +Y
"RTN","GMRCPSL1",181,0)
TYPERPT() ; Get type of report to print
"RTN","GMRCPSL1",182,0)
 N DIR
"RTN","GMRCPSL1",183,0)
 S DIR(0)="SO^1:80 column;2:132 column;3:Table Export"
"RTN","GMRCPSL1",184,0)
 S DIR("L",1)="Please select an output format from the following:"
"RTN","GMRCPSL1",185,0)
 S DIR("L",2)=""
"RTN","GMRCPSL1",186,0)
 S DIR("L",3)="1 -  80 column standard print [STANDARD]"
"RTN","GMRCPSL1",187,0)
 S DIR("L",4)="2 - 132 column standard print"
"RTN","GMRCPSL1",188,0)
 S DIR("L")="3 - Table without headers (export to another application)"
"RTN","GMRCPSL1",189,0)
 S DIR("B")=1
"RTN","GMRCPSL1",190,0)
 D ^DIR I $D(DIRUT)!(Y>3) Q 0
"RTN","GMRCPSL1",191,0)
 Q +Y
"RTN","GMRCPSL1",192,0)
 ;
"RTN","GMRCPSL1",193,0)
QUEUE   ; send task for print and update
"RTN","GMRCPSL1",194,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK
"RTN","GMRCPSL1",195,0)
 S ZTRTN="PRTTSK^GMRCPSL2",ZTDESC="PRINT OF RECORDS FILE 123"
"RTN","GMRCPSL1",196,0)
 S ZTIO=ION
"RTN","GMRCPSL1",197,0)
 S ZTSAVE("GMRC*")=""
"RTN","GMRCPSL1",198,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task # ",ZTSK
"RTN","GMRCPSL1",199,0)
 I '$G(ZTSK) W !,"Unable to queue report!  Try again later."
"RTN","GMRCPSL1",200,0)
 Q
"RTN","GMRCPSL1",201,0)
WARNING ; Let user know that they did not enter any data.
"RTN","GMRCPSL1",202,0)
 W !!,"No search criteria was entered" H 1
"RTN","GMRCPSL1",203,0)
 S GMRCEND=1
"RTN","GMRCPSL1",204,0)
 Q
"RTN","GMRCPSL2")
0^3^B24951569
"RTN","GMRCPSL2",1,0)
GMRCPSL2 ;SLC/MA - Special Consult Reports;9/21/01  05:25 ;1/10/02  14:26
"RTN","GMRCPSL2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**23**;DEC 27, 1997
"RTN","GMRCPSL2",3,0)
 ; This routine is used by GMRCPSL1 to build ^TMP("GMRCRPT",$J)
"RTN","GMRCPSL2",4,0)
 ; which will be passed to GMRCPSL3 for reporting.
"RTN","GMRCPSL2",5,0)
PRINT(GMRCSRCH,GMRCARRY,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCRPT,GMRCBRK) ; Untasked Print
"RTN","GMRCPSL2",6,0)
PRTTSK ; Print report
"RTN","GMRCPSL2",7,0)
 ; GMRCARRY = Array contains search values.
"RTN","GMRCPSL2",8,0)
 ; GMRCSRCH = Indicates which field to search on
"RTN","GMRCPSL2",9,0)
 ; GMRCDT1  = Start date
"RTN","GMRCPSL2",10,0)
 ; GMRCDT2  = Stop date
"RTN","GMRCPSL2",11,0)
 ; GMRCSTAT = CPRS status to include in report
"RTN","GMRCPSL2",12,0)
 ; SUBTOT   = Counter for different groups
"RTN","GMRCPSL2",13,0)
 ; GMRCRPT  = 80 - 132 character report & data only output
"RTN","GMRCPSL2",14,0)
 ; GMRCBRK  = Print page break between sub-totals <Y-N>
"RTN","GMRCPSL2",15,0)
 ; TOTCNTR  = Count for total records
"RTN","GMRCPSL2",16,0)
 I GMRCSRCH=1 D BLDPROV(.GMRCARRY)   ;BLD PROVIDER  ^TMP(GLOBAL)
"RTN","GMRCPSL2",17,0)
 I GMRCSRCH=2 D BLDLOC(.GMRCARRY)    ;BLD LOCATION  ^TMP(GLOBAL)
"RTN","GMRCPSL2",18,0)
 I GMRCSRCH=3 D BLDPROC(.GMRCARRY)   ;BLD PROCEDURE ^TMP(GLOBAL)
"RTN","GMRCPSL2",19,0)
 N TOTCNTR,SUBTOT S (SUBTOT,TOTCNTR)=0
"RTN","GMRCPSL2",20,0)
 I GMRCRPT=1 D REPORT80^GMRCPSL3(.SUBTOT,.TOTCNTR,GMRCSRCH,GMRCBRK)
"RTN","GMRCPSL2",21,0)
 I GMRCRPT=2 D REPORT32^GMRCPSL3(.SUBTOT,.TOTCNTR,GMRCSRCH,GMRCBRK)
"RTN","GMRCPSL2",22,0)
 I GMRCRPT=3 D DATAONLY^GMRCPSL3 Q
"RTN","GMRCPSL2",23,0)
 W !!,"SUB TOTAL= ",SUBTOT,!
"RTN","GMRCPSL2",24,0)
 W !,"TOTAL RECORDS= ",TOTCNTR
"RTN","GMRCPSL2",25,0)
 D ^%ZISC
"RTN","GMRCPSL2",26,0)
 K ^TMP("GMRCRPT",$J)
"RTN","GMRCPSL2",27,0)
 I ($E(IOST)="C") D
"RTN","GMRCPSL2",28,0)
 .N DIR
"RTN","GMRCPSL2",29,0)
 .S DIR(0)="E"
"RTN","GMRCPSL2",30,0)
 .W !
"RTN","GMRCPSL2",31,0)
 .D ^DIR K DIR
"RTN","GMRCPSL2",32,0)
 Q
"RTN","GMRCPSL2",33,0)
 ;
"RTN","GMRCPSL2",34,0)
BLDLOC(GMRCARRY) ; Build ^TMP were search was on location.
"RTN","GMRCPSL2",35,0)
 K ^TMP("GMRCRPT",$J)
"RTN","GMRCPSL2",36,0)
 N GMRCCNTR,LOCATION,GMRCSRT1,GMRCSRT2,GMRCLOC1,GMRCLOC2,IEN
"RTN","GMRCPSL2",37,0)
 S GMRCCNTR=0
"RTN","GMRCPSL2",38,0)
 ; If Location="*" get all Locations by date range
"RTN","GMRCPSL2",39,0)
 I GMRCARRY(1)["ALL" D
"RTN","GMRCPSL2",40,0)
 .  S GMRCLOC1=GMRCDT1,GMRCLOC2=GMRCDT2
"RTN","GMRCPSL2",41,0)
 .  F  S GMRCLOC1=$O(^GMR(123,"E",GMRCLOC1)) Q:GMRCLOC1>GMRCLOC2  Q:GMRCLOC1=""  D
"RTN","GMRCPSL2",42,0)
 . .  S IEN=0
"RTN","GMRCPSL2",43,0)
 . .  F  S IEN=$O(^GMR(123,"E",GMRCLOC1,IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",44,0)
 . . .  I GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D
"RTN","GMRCPSL2",45,0)
 . . . .  S LOCATION=$P(^GMR(123,IEN,0),"^",4)   ; PATIENT LOCATION
"RTN","GMRCPSL2",46,0)
 . . . .  S GMRCSRT1=$$GET1^DIQ(44,LOCATION,.01)  ; PATIENT LOCATION
"RTN","GMRCPSL2",47,0)
 . . . .  S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)   ; DATE OF REQUEST
"RTN","GMRCPSL2",48,0)
 . . . .  S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",49,0)
 ; Get location list from GMRCARRY and then go to global using location
"RTN","GMRCPSL2",50,0)
 I GMRCARRY(1)["*" Q
"RTN","GMRCPSL2",51,0)
 F  S GMRCCNTR=$O(GMRCARRY(GMRCCNTR)) Q:'GMRCCNTR  D
"RTN","GMRCPSL2",52,0)
 .  S LOCATION=$P(GMRCARRY(GMRCCNTR),"^",1)
"RTN","GMRCPSL2",53,0)
 .  N IEN S IEN=0
"RTN","GMRCPSL2",54,0)
 .  F  S IEN=$O(^GMR(123,"AL",LOCATION,IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",55,0)
 . .  I $P(^GMR(123,IEN,0),"^",7)>GMRCDT1,$P(^GMR(123,IEN,0),"^",7)<GMRCDT2,GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D
"RTN","GMRCPSL2",56,0)
 . . . S GMRCSRT1=$P(GMRCARRY(GMRCCNTR),"^",2)   ; Patient Location
"RTN","GMRCPSL2",57,0)
 . . . S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)      ; DATE OF REQUEST
"RTN","GMRCPSL2",58,0)
 . . . S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",59,0)
 Q
"RTN","GMRCPSL2",60,0)
BLDPROC(GMRCARRY) ; Build ^TMP were search was on procedure.
"RTN","GMRCPSL2",61,0)
 K ^TMP("GMRCRPT",$J)
"RTN","GMRCPSL2",62,0)
 N GMRCCNTR,PROCEDUR,GMRCSRT1,GMRCSRT2,GMRCPRC1,GMRCPRC2,IEN
"RTN","GMRCPSL2",63,0)
 S GMRCCNTR=0
"RTN","GMRCPSL2",64,0)
 ; If Procedure="*" get all Procedures by date range
"RTN","GMRCPSL2",65,0)
 I GMRCARRY(1)["ALL" D
"RTN","GMRCPSL2",66,0)
 .  S GMRCPRC1=GMRCDT1,GMRCPRC2=GMRCDT2
"RTN","GMRCPSL2",67,0)
 .  F  S GMRCPRC1=$O(^GMR(123,"E",GMRCPRC1)) Q:GMRCPRC1>GMRCPRC2  Q:GMRCPRC1=""  D
"RTN","GMRCPSL2",68,0)
 . .  S IEN=0
"RTN","GMRCPSL2",69,0)
 . .  F  S IEN=$O(^GMR(123,"E",GMRCPRC1,IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",70,0)
 . . .  I GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D        ; Ck Status
"RTN","GMRCPSL2",71,0)
 . . . .  I $P(^GMR(123,IEN,0),"^",8)>"" D              ; Ck for Proc
"RTN","GMRCPSL2",72,0)
 . . . . .  S PROCEDUR=$P($P(^GMR(123,IEN,0),"^",8),";",1)
"RTN","GMRCPSL2",73,0)
 . . . . .  S GMRCSRT1=$$GET1^DIQ(123.3,PROCEDUR,.01)   ;Procedure
"RTN","GMRCPSL2",74,0)
 . . . . .  S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)        ;Req Date
"RTN","GMRCPSL2",75,0)
 . . . . .  S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",76,0)
 ; Get each procedure from GMRCARRY and then go to global using procedure
"RTN","GMRCPSL2",77,0)
 F  S GMRCCNTR=$O(GMRCARRY(GMRCCNTR)) Q:'GMRCCNTR  D
"RTN","GMRCPSL2",78,0)
 .  S PROCEDUR=$P(GMRCARRY(GMRCCNTR),"^",1)
"RTN","GMRCPSL2",79,0)
 .  N IEN S IEN=0
"RTN","GMRCPSL2",80,0)
 .  F  S IEN=$O(^GMR(123,"AP",PROCEDUR_";GMR(123.3,",IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",81,0)
 . .  I $P(^GMR(123,IEN,0),"^",7)>GMRCDT1,$P(^GMR(123,IEN,0),"^",7)<GMRCDT2,GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D
"RTN","GMRCPSL2",82,0)
 . . . S GMRCSRT1=$P(GMRCARRY(GMRCCNTR),"^",2)   ; PROCEDURE TYPE
"RTN","GMRCPSL2",83,0)
 . . . S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)      ; DATE OF REQUEST
"RTN","GMRCPSL2",84,0)
 . . . S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",85,0)
 Q
"RTN","GMRCPSL2",86,0)
BLDPROV(GMRCARRY) ; Build ^TMP were search was on provider.
"RTN","GMRCPSL2",87,0)
 K ^TMP("GMRCRPT",$J)
"RTN","GMRCPSL2",88,0)
 N GMRCCNTR,PROVIDER,GMRCSRT1,GMRCSRT2,GMRCPRV1,GMRCPRV2,IEN
"RTN","GMRCPSL2",89,0)
 N GMRCPROV
"RTN","GMRCPSL2",90,0)
 S GMRCCNTR=0
"RTN","GMRCPSL2",91,0)
 ; If provider="*" get all providers by date range
"RTN","GMRCPSL2",92,0)
 I GMRCARRY(1)["ALL" D
"RTN","GMRCPSL2",93,0)
 .  S GMRCPRV1=GMRCDT1,GMRCPRV2=GMRCDT2
"RTN","GMRCPSL2",94,0)
 .  F  S GMRCPRV1=$O(^GMR(123,"E",GMRCPRV1)) Q:GMRCPRV1>GMRCPRV2  Q:GMRCPRV1=""  D
"RTN","GMRCPSL2",95,0)
 . .  S IEN=0
"RTN","GMRCPSL2",96,0)
 . .  F  S IEN=$O(^GMR(123,"E",GMRCPRV1,IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",97,0)
 . . .  I GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D
"RTN","GMRCPSL2",98,0)
 . . . .  S GMRCPROV=$P(^GMR(123,IEN,0),"^",14)      ; SENDING PROVIDER
"RTN","GMRCPSL2",99,0)
 . . . .  S GMRCSRT1=$$GET1^DIQ(200,GMRCPROV,.01)    ; SENDING PROVIDER
"RTN","GMRCPSL2",100,0)
 . . . .  S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)       ; DATE OF REQUEST
"RTN","GMRCPSL2",101,0)
 . . . .  S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",102,0)
 ; Get provider list from GMRCARRY and then go to global using provider
"RTN","GMRCPSL2",103,0)
 I GMRCARRY(1)["ALL" Q
"RTN","GMRCPSL2",104,0)
 F  S GMRCCNTR=$O(GMRCARRY(GMRCCNTR)) Q:'GMRCCNTR  D
"RTN","GMRCPSL2",105,0)
 .  S PROVIDER=$P(GMRCARRY(GMRCCNTR),"^",1)
"RTN","GMRCPSL2",106,0)
 .  S IEN=0
"RTN","GMRCPSL2",107,0)
 .  F  S IEN=$O(^GMR(123,"G",PROVIDER,IEN)) Q:IEN'>0  D
"RTN","GMRCPSL2",108,0)
 . .  I $P(^GMR(123,IEN,0),"^",7)>GMRCDT1,$P(^GMR(123,IEN,0),"^",7)<GMRCDT2,GMRCSTAT[$P(^GMR(123,IEN,0),"^",12) D
"RTN","GMRCPSL2",109,0)
 . . . S GMRCSRT1=$P(GMRCARRY(GMRCCNTR),"^",2)   ; SENDING PROVIDER
"RTN","GMRCPSL2",110,0)
 . . . S GMRCSRT2=$P(^GMR(123,IEN,0),"^",7)      ; DATE OF REQUEST
"RTN","GMRCPSL2",111,0)
 . . . S ^TMP("GMRCRPT",$J,GMRCSRT1,GMRCSRT2)=IEN_"|"_^GMR(123,IEN,0)
"RTN","GMRCPSL2",112,0)
 Q
"RTN","GMRCPSL3")
0^4^B52630552
"RTN","GMRCPSL3",1,0)
GMRCPSL3 ;SLC/MA - Special Consult Reports;9/21/01  05:25 ;1/10/02  14:27
"RTN","GMRCPSL3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**23**;DEC 27, 1997
"RTN","GMRCPSL3",3,0)
 ; This routine is called by GMRCPSL2 to generate reports or
"RTN","GMRCPSL3",4,0)
 ; date output.
"RTN","GMRCPSL3",5,0)
 ; DBIA 10035 call DIQ=2     ;PATIENT FILE
"RTN","GMRCPSL3",6,0)
 ; DBIA 10040 call DIQ=44    ;LOCATION FILE
"RTN","GMRCPSL3",7,0)
 ; DBIA 10060 call DIQ=200   ;NEW PERSON FILE
"RTN","GMRCPSL3",8,0)
 ; GMRCDT1  = Start date
"RTN","GMRCPSL3",9,0)
 ; GMRCDT2  = Stop date
"RTN","GMRCPSL3",10,0)
 ; GMRCBRK  = Print page break between sub-totals <Y-N>
"RTN","GMRCPSL3",11,0)
 ; TOTCNTR  = Count for total records
"RTN","GMRCPSL3",12,0)
DATAONLY ;  Write data only for user to capture
"RTN","GMRCPSL3",13,0)
 N SRT1,SRT2,IEN,DISPLINE,DATALINE
"RTN","GMRCPSL3",14,0)
 ; DATA LINE = IEN^REQ DATE^PROVIDER^LOCATION^TO SERVICE^
"RTN","GMRCPSL3",15,0)
 ;             PATIENT^SSN^STATUS^PROCEDURE
"RTN","GMRCPSL3",16,0)
 S SRT1="",SRTCOMP=""
"RTN","GMRCPSL3",17,0)
 W !,"Consult#^Req Date^Ordering Provider^Location^"
"RTN","GMRCPSL3",18,0)
 W "To Service^Patient^SSN^Status^Procedure"
"RTN","GMRCPSL3",19,0)
 W !
"RTN","GMRCPSL3",20,0)
 F  S SRT1=$O(^TMP("GMRCRPT",$J,SRT1)) Q:'$L(SRT1)  D
"RTN","GMRCPSL3",21,0)
 .  S SRT2=0
"RTN","GMRCPSL3",22,0)
 .  F  S SRT2=$O(^TMP("GMRCRPT",$J,SRT1,SRT2)) Q:'SRT2  D
"RTN","GMRCPSL3",23,0)
 . .   S DISPLINE=^TMP("GMRCRPT",$J,SRT1,SRT2)
"RTN","GMRCPSL3",24,0)
 . .   D DATAMOVE
"RTN","GMRCPSL3",25,0)
 Q
"RTN","GMRCPSL3",26,0)
DATAMOVE ; Create the DATA ONLY OUTPUT
"RTN","GMRCPSL3",27,0)
 S $P(DATALINE,"^",1)=$P(DISPLINE,"|",1)          ;IEN
"RTN","GMRCPSL3",28,0)
 S $P(DATALINE,"^",2)=$$FMTE^XLFDT($P(DISPLINE,"^",7),"D")    ;REQ Date
"RTN","GMRCPSL3",29,0)
 S $P(DATALINE,"^",3)=$$GET1^DIQ(200,$P(DISPLINE,"^",14),.01) ;PROVIDER
"RTN","GMRCPSL3",30,0)
 S $P(DATALINE,"^",4)=$$GET1^DIQ(44,$P(DISPLINE,"^",4),.01)   ;LOCATION
"RTN","GMRCPSL3",31,0)
 S $P(DATALINE,"^",5)=$$GET1^DIQ(123.5,$P(DISPLINE,"^",5),.01) ;TO SERVICE
"RTN","GMRCPSL3",32,0)
 S $P(DATALINE,"^",6)=$$GET1^DIQ(2,$P(DISPLINE,"^",2),.01)     ;PATIENT
"RTN","GMRCPSL3",33,0)
 S $P(DATALINE,"^",7)=$E($$GET1^DIQ(2,$P(DISPLINE,"^",2),.09),6,10) ;SSN
"RTN","GMRCPSL3",34,0)
 S $P(DATALINE,"^",8)=$$GET1^DIQ(100.01,$P(DISPLINE,"^",12),.1)   ;STATUS
"RTN","GMRCPSL3",35,0)
 I $P(DISPLINE,"^",8)>"" D
"RTN","GMRCPSL3",36,0)
 . S $P(DATALINE,"^",9)=$$GET1^DIQ(123.3,$P($P(DISPLINE,"^",8),";",1),.01)  ;PROCEDURE
"RTN","GMRCPSL3",37,0)
 W !,DATALINE
"RTN","GMRCPSL3",38,0)
 Q
"RTN","GMRCPSL3",39,0)
REPORT32(SUBTOT,TOTCNTR,GMRCSRCH,GMRCBRK) ; Read ^TMP("GMRCRPT",$J) and format report
"RTN","GMRCPSL3",40,0)
 ; SRT1 & SRT2 are used to $ORDER down to the IEN.  The ^TMP
"RTN","GMRCPSL3",41,0)
 ; global can be in any order but it will always have two
"RTN","GMRCPSL3",42,0)
 ; sorting parameters (PROVIDER,DATE) or (PT LOCATION,DATE)
"RTN","GMRCPSL3",43,0)
 ;                    (PROCEDURE TYPE,DATE)
"RTN","GMRCPSL3",44,0)
 ; RPTTITL = Used to very report title
"RTN","GMRCPSL3",45,0)
 ; SRTCOMP = Used to tell when to print subtotals
"RTN","GMRCPSL3",46,0)
 ; SUBTOT  = Used to count subtotals
"RTN","GMRCPSL3",47,0)
 N RPTTITL,SRTCOMP,GMRCQUIT
"RTN","GMRCPSL3",48,0)
 U IO
"RTN","GMRCPSL3",49,0)
 N IEN,SRT1,SRT2,DISPLINE,LINECNT,PAGE,RPTTITL,SUBCOMP,GMRCFRST
"RTN","GMRCPSL3",50,0)
 I GMRCSRCH=1 S RPTTITL="PROVIDER(S)"
"RTN","GMRCPSL3",51,0)
 I GMRCSRCH=2 S RPTTITL="LOCATION(S)"
"RTN","GMRCPSL3",52,0)
 I GMRCSRCH=3 S RPTTITL="PROCEDURES(S)"
"RTN","GMRCPSL3",53,0)
 S (LINECNT,PAGE,SUBTOT,GMRCQUIT)=0,GMRCFRST=1
"RTN","GMRCPSL3",54,0)
 S SRT1="",SRTCOMP=""
"RTN","GMRCPSL3",55,0)
 ;  Sorted by GMRCSRCH & date.  First sort compare is just to watch
"RTN","GMRCPSL3",56,0)
 ;  for GMRCSRCH change to print sub-totals.
"RTN","GMRCPSL3",57,0)
 F  S SRT1=$O(^TMP("GMRCRPT",$J,SRT1)) Q:'$L(SRT1)  Q:GMRCQUIT  D
"RTN","GMRCPSL3",58,0)
 .  I SRTCOMP="" S SRTCOMP=SRT1
"RTN","GMRCPSL3",59,0)
 .  I SRTCOMP'=SRT1 D
"RTN","GMRCPSL3",60,0)
 . .  W !!,"SUB TOTAL= ",SUBTOT,!
"RTN","GMRCPSL3",61,0)
 . .  S LINECNT=LINECNT+3
"RTN","GMRCPSL3",62,0)
 . .  S SUBTOT=0
"RTN","GMRCPSL3",63,0)
 . .  I GMRCBRK D PAGEBK32
"RTN","GMRCPSL3",64,0)
 .  S SRT2=0
"RTN","GMRCPSL3",65,0)
 .  F  S SRT2=$O(^TMP("GMRCRPT",$J,SRT1,SRT2)) Q:'SRT2  Q:GMRCQUIT  D
"RTN","GMRCPSL3",66,0)
 . .     S DISPLINE=^TMP("GMRCRPT",$J,SRT1,SRT2)
"RTN","GMRCPSL3",67,0)
 . .     I GMRCFRST D PAGEBK32           ;  Kick out first page header
"RTN","GMRCPSL3",68,0)
 . .     I LINECNT>IOSL D PAGEBK32
"RTN","GMRCPSL3",69,0)
 . .     I GMRCQUIT Q
"RTN","GMRCPSL3",70,0)
 . .     W !,$P(DISPLINE,"|",1)                    ;IEN
"RTN","GMRCPSL3",71,0)
 . .     W ?11,$$FMTE^XLFDT($P(DISPLINE,"^",7),"D")   ;REQ DATE
"RTN","GMRCPSL3",72,0)
 . .     I GMRCSRCH=1 D
"RTN","GMRCPSL3",73,0)
 . . .     W ?25,$E($$GET1^DIQ(200,$P(DISPLINE,"^",14),.01),1,20) ;PROVIDER
"RTN","GMRCPSL3",74,0)
 . . .     W ?48,$E($$GET1^DIQ(123.5,$P(DISPLINE,"^",5),.01),1,40)  ;TO SERVICE
"RTN","GMRCPSL3",75,0)
 . .     I GMRCSRCH=2 D
"RTN","GMRCPSL3",76,0)
 . . .     W ?25,$E($$GET1^DIQ(44,$P(DISPLINE,"^",4),.01),1,40)  ;LOCATION
"RTN","GMRCPSL3",77,0)
 . . .     W ?48,$E($$GET1^DIQ(123.5,$P(DISPLINE,"^",5),.01),1,40)  ;TO SERVICE
"RTN","GMRCPSL3",78,0)
 . .     I GMRCSRCH=3 D
"RTN","GMRCPSL3",79,0)
 . . .     W ?25,$E($$GET1^DIQ(123.3,$P($P(DISPLINE,"^",8),";",1),.01),1,20) ;PROCEDURE
"RTN","GMRCPSL3",80,0)
 . . .     W ?48,$E($$GET1^DIQ(123.5,$P(DISPLINE,"^",5),.01),1,40)  ;TO SERVICE
"RTN","GMRCPSL3",81,0)
 . .     W ?89,$E($$GET1^DIQ(2,$P(DISPLINE,"^",2),.01),1,20)       ;PATIENT
"RTN","GMRCPSL3",82,0)
 . .     W ?121,$E($$GET1^DIQ(2,$P(DISPLINE,"^",2),.09),6,9) ;SSN
"RTN","GMRCPSL3",83,0)
 . .     W ?129,$$GET1^DIQ(100.01,$P(DISPLINE,"^",12),.1) ;STATUS
"RTN","GMRCPSL3",84,0)
 . .     S LINECNT=LINECNT+1,TOTCNTR=TOTCNTR+1,SUBTOT=SUBTOT+1
"RTN","GMRCPSL3",85,0)
 Q
"RTN","GMRCPSL3",86,0)
 ;
"RTN","GMRCPSL3",87,0)
REPORT80(SUBTOT,TOTCNTR,GMRCSRCH,GMRCBRK)   ; Read ^TMP("GMRCRPT",$J) and format report
"RTN","GMRCPSL3",88,0)
 ; SRT1 & SRT2 are used to $ORDER down to the IEN.  The ^TMP
"RTN","GMRCPSL3",89,0)
 ; global can be in any order but it will always have three
"RTN","GMRCPSL3",90,0)
 ; sorting parameters (PROVIDER,DATE) or (PT LOCATION,DATE)
"RTN","GMRCPSL3",91,0)
 ;                    (PROCEDURE TYPE,DATE)
"RTN","GMRCPSL3",92,0)
 ; RPTTITL = Used to very report title
"RTN","GMRCPSL3",93,0)
 ; SRTCOMP = Used to tell when to print subtotals
"RTN","GMRCPSL3",94,0)
 ; SUBTOT  = Used to count subtotals
"RTN","GMRCPSL3",95,0)
 ; GMRCFRST= Set to one to get first report headers to print
"RTN","GMRCPSL3",96,0)
 N RPTTITL,SRTCOMP,GMRCQUIT
"RTN","GMRCPSL3",97,0)
 U IO
"RTN","GMRCPSL3",98,0)
 N IEN,SRT1,SRT2,DISPLINE,LINECNT,PAGE,RPTTITL,SUBCOMP,GMRCFRST
"RTN","GMRCPSL3",99,0)
 I GMRCSRCH=1 S RPTTITL="PROVIDER(S)"
"RTN","GMRCPSL3",100,0)
 I GMRCSRCH=2 S RPTTITL="LOCATION(S)"
"RTN","GMRCPSL3",101,0)
 I GMRCSRCH=3 S RPTTITL="PROCEDURES(S)"
"RTN","GMRCPSL3",102,0)
 S (LINECNT,PAGE,SUBTOT,GMRCQUIT)=0,GMRCFRST=1
"RTN","GMRCPSL3",103,0)
 S SRT1="",SRTCOMP=""
"RTN","GMRCPSL3",104,0)
 ;  Sorted by GMRCSRCH & date.  First sort compare is just to watch
"RTN","GMRCPSL3",105,0)
 ;  for GMRCSRCH change to print sub-totals.
"RTN","GMRCPSL3",106,0)
 F  S SRT1=$O(^TMP("GMRCRPT",$J,SRT1)) Q:'$L(SRT1)  Q:GMRCQUIT  D
"RTN","GMRCPSL3",107,0)
 .  I SRTCOMP="" S SRTCOMP=SRT1
"RTN","GMRCPSL3",108,0)
 .  I SRTCOMP'=SRT1 D
"RTN","GMRCPSL3",109,0)
 . .  I (LINECNT+3)>IOSL D PAGEBK80
"RTN","GMRCPSL3",110,0)
 . .  W !!,"SUB TOTAL= ",SUBTOT,!
"RTN","GMRCPSL3",111,0)
 . .  S LINECNT=LINECNT+3
"RTN","GMRCPSL3",112,0)
 . .  S SUBTOT=0
"RTN","GMRCPSL3",113,0)
 . .  I GMRCBRK D PAGEBK80
"RTN","GMRCPSL3",114,0)
 .  S SRT2=0
"RTN","GMRCPSL3",115,0)
 .  F  S SRT2=$O(^TMP("GMRCRPT",$J,SRT1,SRT2)) Q:'SRT2  Q:GMRCQUIT  D
"RTN","GMRCPSL3",116,0)
 . .    S DISPLINE=^TMP("GMRCRPT",$J,SRT1,SRT2)
"RTN","GMRCPSL3",117,0)
 . .    I GMRCFRST=1 D PAGEBK80          ; Kick out first page header
"RTN","GMRCPSL3",118,0)
 . .    I LINECNT>IOSL D PAGEBK80
"RTN","GMRCPSL3",119,0)
 . .    I GMRCQUIT Q
"RTN","GMRCPSL3",120,0)
 . .    W !,$P(DISPLINE,"|",1)                    ;IEN
"RTN","GMRCPSL3",121,0)
 . .    W ?9,$P($$FMTE^XLFDT($P(DISPLINE,"^",7),2),"@",1)   ;REQ DATE
"RTN","GMRCPSL3",122,0)
 . .    I GMRCSRCH=1 D
"RTN","GMRCPSL3",123,0)
 . . .    W ?18,$E($$GET1^DIQ(200,$P(DISPLINE,"^",14),.01),1,16) ;PROVIDER
"RTN","GMRCPSL3",124,0)
 . .    I GMRCSRCH=2 D
"RTN","GMRCPSL3",125,0)
 . . .    W ?18,$E($$GET1^DIQ(44,$P(DISPLINE,"^",4),.01),1,16)  ;LOCATION
"RTN","GMRCPSL3",126,0)
 . .    I GMRCSRCH=3 D
"RTN","GMRCPSL3",127,0)
 . . .    W ?18,$E($$GET1^DIQ(123.3,$P($P(DISPLINE,"^",8),";",1),.01),1,16)   ; PROCEDURE
"RTN","GMRCPSL3",128,0)
 . .    W ?35,$E($$GET1^DIQ(2,$P(DISPLINE,"^",2),.01),1,20)  ;PATIENT
"RTN","GMRCPSL3",129,0)
 . .    W ?56,$E($$GET1^DIQ(2,$P(DISPLINE,"^",2),.09),6,9) ;SSN
"RTN","GMRCPSL3",130,0)
 . .    W ?61,$E($$GET1^DIQ(123.5,$P(DISPLINE,"^",5),.01),1,15)  ;TO SERVICE
"RTN","GMRCPSL3",131,0)
 . .    W ?77,$$GET1^DIQ(100.01,$P(DISPLINE,"^",12),.1) ;STATUS
"RTN","GMRCPSL3",132,0)
 . .    S LINECNT=LINECNT+1,TOTCNTR=TOTCNTR+1,SUBTOT=SUBTOT+1
"RTN","GMRCPSL3",133,0)
 Q
"RTN","GMRCPSL3",134,0)
PAGEBK32 ;
"RTN","GMRCPSL3",135,0)
 S GMRCFRST=0
"RTN","GMRCPSL3",136,0)
 K DIR
"RTN","GMRCPSL3",137,0)
 I ($E(IOST)="C")&(IO=IO(0))&(PAGE>0) D
"RTN","GMRCPSL3",138,0)
 .S DIR(0)="E"
"RTN","GMRCPSL3",139,0)
 .W !
"RTN","GMRCPSL3",140,0)
 .D ^DIR K DIR
"RTN","GMRCPSL3",141,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)) S GMRCQUIT=1  Q
"RTN","GMRCPSL3",142,0)
 W:$D(IOF) @IOF
"RTN","GMRCPSL3",143,0)
 S PAGE=PAGE+1
"RTN","GMRCPSL3",144,0)
 I $E(IOST)="C",IO=IO(0) W @IOF
"RTN","GMRCPSL3",145,0)
 E  W !
"RTN","GMRCPSL3",146,0)
 N TEMPDATE,TEXTLEN,LINE
"RTN","GMRCPSL3",147,0)
 S TEMPDATE=$$NOW^XLFDT,TEMPDATE=$$FMTE^XLFDT(TEMPDATE,"P")
"RTN","GMRCPSL3",148,0)
 S TEMPDATE=TEMPDATE_"  Page "_PAGE
"RTN","GMRCPSL3",149,0)
 I GMRCSRCH=1,GMRCBRK D
"RTN","GMRCPSL3",150,0)
 . W !,?6,"ORDERING PROVIDER:  ",?26,SRT1
"RTN","GMRCPSL3",151,0)
 I GMRCSRCH=2,GMRCBRK D
"RTN","GMRCPSL3",152,0)
 . W !,?6,"LOCATION:  ",?12,SRT1,?45
"RTN","GMRCPSL3",153,0)
 I GMRCSRCH=3,GMRCBRK D
"RTN","GMRCPSL3",154,0)
 . W !,?6,"PROCEDURE:  ",?12,SRT1,?45
"RTN","GMRCPSL3",155,0)
 W !,"CONSULTS GENERATED BY "_RPTTITL_", FOR SPECIFIED DATE(S)"
"RTN","GMRCPSL3",156,0)
 W ?97,TEMPDATE
"RTN","GMRCPSL3",157,0)
 I GMRCDT1>0 D
"RTN","GMRCPSL3",158,0)
 . W !,"FROM: ",$$FMTE^XLFDT(GMRCDT1,"D"),"   TO: ",$$FMTE^XLFDT(GMRCDT2-1,"D")
"RTN","GMRCPSL3",159,0)
 ELSE  W !,"FROM:  ALL","   TO:  ALL"
"RTN","GMRCPSL3",160,0)
 W ?121,"LAST 4",?128,"CON"
"RTN","GMRCPSL3",161,0)
 W !!,"CONSULT #",?11,"REQUEST DATE"
"RTN","GMRCPSL3",162,0)
 I GMRCSRCH=1 W ?26,"ORDERING PROVIDER",?48,"TO SERVICE"
"RTN","GMRCPSL3",163,0)
 I GMRCSRCH=2 W ?26,"FROM LOCATION",?48,"TO SERVICE"
"RTN","GMRCPSL3",164,0)
 I GMRCSRCH=3 W ?26,"PROCEDURE",?48,"ASSOCIATED CONSULT SERVICE"
"RTN","GMRCPSL3",165,0)
 W ?89,"PATIENT NAME",?121,"SSN",?128,"STAT"
"RTN","GMRCPSL3",166,0)
 S LINE="",$P(LINE,"-",132)=""
"RTN","GMRCPSL3",167,0)
 W !,LINE
"RTN","GMRCPSL3",168,0)
 S LINECNT=$S(GMRCBRK=1:8,1:7)
"RTN","GMRCPSL3",169,0)
 S LINECNT=9
"RTN","GMRCPSL3",170,0)
 Q
"RTN","GMRCPSL3",171,0)
PAGEBK80 ;
"RTN","GMRCPSL3",172,0)
 S GMRCFRST=0
"RTN","GMRCPSL3",173,0)
 K DIR
"RTN","GMRCPSL3",174,0)
 I ($E(IOST)="C")&(IO=IO(0))&(PAGE>0) D
"RTN","GMRCPSL3",175,0)
 .S DIR(0)="E"
"RTN","GMRCPSL3",176,0)
 .W !
"RTN","GMRCPSL3",177,0)
 .D ^DIR K DIR
"RTN","GMRCPSL3",178,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)) S GMRCQUIT=1  Q
"RTN","GMRCPSL3",179,0)
 W:$D(IOF) @IOF
"RTN","GMRCPSL3",180,0)
 S PAGE=PAGE+1
"RTN","GMRCPSL3",181,0)
 I $E(IOST)="C",IO=IO(0) W @IOF
"RTN","GMRCPSL3",182,0)
 E  W !
"RTN","GMRCPSL3",183,0)
 N TEMPDATE,TEXTLEN,LINE
"RTN","GMRCPSL3",184,0)
 S TEMPDATE=$$NOW^XLFDT,TEMPDATE=$$FMTE^XLFDT(TEMPDATE,"P")
"RTN","GMRCPSL3",185,0)
 S TEMPDATE=TEMPDATE_"  Page "_PAGE
"RTN","GMRCPSL3",186,0)
 I GMRCSRCH=1,GMRCBRK D
"RTN","GMRCPSL3",187,0)
 . W !,?6,"ORDERING PROVIDER:  ",?26,SRT1,?45,TEMPDATE
"RTN","GMRCPSL3",188,0)
 I GMRCSRCH=2,GMRCBRK D
"RTN","GMRCPSL3",189,0)
 . W !,?6,"LOCATION:  ",?12,SRT1,?45,TEMPDATE
"RTN","GMRCPSL3",190,0)
 I GMRCSRCH=3,GMRCBRK D
"RTN","GMRCPSL3",191,0)
 . W !,?6,"PROCEDURE:  ",?12,SRT1,?45,TEMPDATE
"RTN","GMRCPSL3",192,0)
 I 'GMRCBRK W !,?45,TEMPDATE
"RTN","GMRCPSL3",193,0)
 W !,"CONSULTS GENERATED BY "_RPTTITL_", FOR SPECIFIED DATE(S)"
"RTN","GMRCPSL3",194,0)
 I GMRCDT1>0 D
"RTN","GMRCPSL3",195,0)
 . W !,"FROM: ",$$FMTE^XLFDT(GMRCDT1,"D"),"   TO: ",$$FMTE^XLFDT(GMRCDT2-1,"D")
"RTN","GMRCPSL3",196,0)
 ELSE  W !,"FROM:  ALL","   TO:  ALL"
"RTN","GMRCPSL3",197,0)
 W !!,"CONSULT",?9,"REQ DATE"
"RTN","GMRCPSL3",198,0)
 I GMRCSRCH=1 W ?18,"ORDERING PROVIDER"
"RTN","GMRCPSL3",199,0)
 I GMRCSRCH=2 W ?18,"LOCATION"
"RTN","GMRCPSL3",200,0)
 I GMRCSRCH=3 W ?18,"PROCEDURE"
"RTN","GMRCPSL3",201,0)
 W ?37,"PATIENT NAME",?56,"SSN",?61,"TO SERVICE",?77,"ST"
"RTN","GMRCPSL3",202,0)
 S LINE="",$P(LINE,"-",80)=""
"RTN","GMRCPSL3",203,0)
 W !,LINE
"RTN","GMRCPSL3",204,0)
 S LINECNT=9
"RTN","GMRCPSL3",205,0)
 Q
"RTN","GMRCSLM2")
0^9^B34530101
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM - LM Detailed  display and printing ;1/10/02  14:27
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,18,15,17,23**;DEC 27,1997
"RTN","GMRCSLM2",3,0)
 ;
"RTN","GMRCSLM2",4,0)
 ; This routine invokes IA #616,#639,#872,#875,#1252,#2467,#2638,#2693
"RTN","GMRCSLM2",5,0)
 ;                         #2925,#3138
"RTN","GMRCSLM2",6,0)
 ; DBIA 2638     ;ORDER STATUS
"RTN","GMRCSLM2",7,0)
 ; DBIA 2849     ;PROTOCOL
"RTN","GMRCSLM2",8,0)
 ; DBIA 10040    ;SCHEDULING
"RTN","GMRCSLM2",9,0)
 ; DBIA 10060    ;NEW PERSON
"RTN","GMRCSLM2",10,0)
 ;
"RTN","GMRCSLM2",11,0)
DT(GMRCO) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",12,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",13,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",14,0)
 ;;Pass in variable GMRCOER=2 if calling from the GUI, GMRCOER=1 if call is from CPRS consults tab
"RTN","GMRCSLM2",15,0)
 ;;Pass in variable GMRCOER=0 (or as <UNDEFINED>) if call is from consults routines
"RTN","GMRCSLM2",16,0)
 K GMRCQUT
"RTN","GMRCSLM2",17,0)
 N DFN,GMRCD,GMRCDA,ORIFN,GMRCSF S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",18,0)
 I $S('GMRCO:1,'$D(^GMR(123,+GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",19,0)
 .S GMRCMSG="The consult entry selected for the Detailed Display is unknown." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",20,0)
 .Q
"RTN","GMRCSLM2",21,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",22,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",23,0)
 S X="SDUTL3" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",24,0)
 .N PR S PR=$$OUTPTPR^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Provider:   "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 .S PR=$$OUTPTTM^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Team:       "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",26,0)
 .Q
"RTN","GMRCSLM2",27,0)
 N VAIN,VAEL
"RTN","GMRCSLM2",28,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Pat. Status:   "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",29,0)
 I $D(VAIN(4)),$L($P(VAIN(4),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 D ELIG^VADPT
"RTN","GMRCSLM2",31,0)
 I $L($P(VAEL(1),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Primary Eligibility:"_$E(TAB,1,11)_$P(VAEL(1),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",33,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Order Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",34,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",35,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Attention:"_$E(TAB,1,13)_$P($G(^VA(200,$P(GMRCO(0),"^",11),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",36,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",37,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Requesting Provider: "_$E(TAB,1,2)_$S($P(GMRCO(0),"^",14)]"":$P($G(^VA(200,$P(GMRCO(0),"^",14),0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",38,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",39,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",40,0)
 .Q
"RTN","GMRCSLM2",41,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,17)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",42,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,15)_$S($L($P(GMRCO(0),"^",9)):$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",43,0)
 S X="ORX8" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",44,0)
 .N GMRCOITM S GMRCOITM=$$OI^ORX8(ORIFN)
"RTN","GMRCSLM2",45,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Orderable Item:"_$E(TAB,1,8)_$P(GMRCOITM,U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",46,0)
 .Q
"RTN","GMRCSLM2",47,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^GMR(123.3,+GMRCPRNM,0)),"^"),1:"Consult Request")
"RTN","GMRCSLM2",48,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",49,0)
 .N GMRCLN
"RTN","GMRCSLM2",50,0)
 .S GMRCTYPE=$S($P(GMRCO(0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCSLM2",51,0)
 .S GMRCLN=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC
"RTN","GMRCSLM2",52,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCLN
"RTN","GMRCSLM2",53,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",54,0)
 .I $G(^GMR(123,+GMRCO,1)) D
"RTN","GMRCSLM2",55,0)
 .. S GMRCLN=""
"RTN","GMRCSLM2",56,0)
 .. S GMRCLN="Clinical Procedure:"_$E(TAB,1,4)
"RTN","GMRCSLM2",57,0)
 .. S GMRCLN=GMRCLN_$$GET1^DIQ(123,+GMRCO,1.01,"E")
"RTN","GMRCSLM2",58,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCLN
"RTN","GMRCSLM2",59,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",60,0)
 .Q
"RTN","GMRCSLM2",61,0)
 S GMRCD=$G(^GMR(123,+GMRCO,30)) I $L(GMRCD) D
"RTN","GMRCSLM2",62,0)
 . I $L(GMRCD)>54 D
"RTN","GMRCSLM2",63,0)
 .. N SEG,I S I=2
"RTN","GMRCSLM2",64,0)
 .. F  S SEG=$P(GMRCD," ",1,I) Q:$L(SEG)>54  S I=I+1
"RTN","GMRCSLM2",65,0)
 .. S SEG=$P(GMRCD," ",1,(I-1))
"RTN","GMRCSLM2",66,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_SEG
"RTN","GMRCSLM2",67,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",68,0)
 .. S SEG=$$REPEAT^XLFSTR(" ",22)_$E(GMRCD,$L(SEG)+1,80)
"RTN","GMRCSLM2",69,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=SEG S GMRCD=""
"RTN","GMRCSLM2",70,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",71,0)
 I GMRCD'="" D
"RTN","GMRCSLM2",72,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD
"RTN","GMRCSLM2",73,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",74,0)
 I $D(^GMR(123,+GMRCO,20,0)) D
"RTN","GMRCSLM2",75,0)
 .I $O(^GMR(123,+GMRCO,20,0)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Reason For Request:",GMRCCT=GMRCCT+1 D  Q
"RTN","GMRCSLM2",76,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,20,LN)) Q:LN=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^(LN,0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",77,0)
 ..Q
"RTN","GMRCSLM2",78,0)
 .Q
"RTN","GMRCSLM2",79,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",80,0)
 ;get status, last action, and significant findings
"RTN","GMRCSLM2",81,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",82,0)
 S GMRCA=$P(^GMR(123,+GMRCO,0),"^",13),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Last Action:"_$E(TAB,1,11)_$S(+GMRCA:$P($G(^GMR(123.1,GMRCA,0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",83,0)
 I $L($P(GMRCO(0),"^",19)) D
"RTN","GMRCSLM2",84,0)
 .S GMRCSF=$P(GMRCO(0),"^",19)
"RTN","GMRCSLM2",85,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings:  "_$S(GMRCSF="Y":"YES",GMRCSF="N":"NO",1:"Unknown")
"RTN","GMRCSLM2",86,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",87,0)
 .Q
"RTN","GMRCSLM2",88,0)
 D ACTLOG^GMRCSLM4(+GMRCO)
"RTN","GMRCSLM2",89,0)
 ;get results
"RTN","GMRCSLM2",90,0)
 D GETRSLT^GMRCART($NA(^TMP("GMRCRT",$J)),1)
"RTN","GMRCSLM2",91,0)
 N NXT S NXT=0
"RTN","GMRCSLM2",92,0)
 F  S NXT=$O(^TMP("GMRCRT",$J,NXT)) Q:'NXT  D
"RTN","GMRCSLM2",93,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$G(^TMP("GMRCRT",$J,NXT,0))
"RTN","GMRCSLM2",94,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",95,0)
 . Q
"RTN","GMRCSLM2",96,0)
 K ^TMP("GMRCRT",$J)
"RTN","GMRCSLM2",97,0)
 I $S('$D(GMRCOER):1,'GMRCOER:1,1:0),$D(VALMAR) D CLEAN^VALM10
"RTN","GMRCSLM2",98,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",99,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRC(0),GMRC(40),GMRCD,GMRCDVDL,GMRCO,GMRCAR,GMRCRB,GMRCLA,GMRCSR,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",100,0)
 I $D(GMRCOER),'GMRCOER D:$D(VALMEVL) KILL^VALM10() D:$D(VALMAR) CLEAN^VALM10
"RTN","GMRCSLM2",101,0)
 Q
"RTN","GMRCSTLM")
0^5^B47813886
"RTN","GMRCSTLM",1,0)
GMRCSTLM ;SLC/DCM,dee,MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;1/10/02  14:27
"RTN","GMRCSTLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21,23**;DEC 27, 1997
"RTN","GMRCSTLM",3,0)
 ; Patch #21 added a initialization KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",4,0)
 ; Patch #23 remove the default prompt "ALL SERVICES"
"RTN","GMRCSTLM",5,0)
 Q
"RTN","GMRCSTLM",6,0)
 ;
"RTN","GMRCSTLM",7,0)
EN ;Ask for new service and date range
"RTN","GMRCSTLM",8,0)
 K GMRCQUT
"RTN","GMRCSTLM",9,0)
 N DIROUT,DTOUT,DUOUT,DIR
"RTN","GMRCSTLM",10,0)
 ;
"RTN","GMRCSTLM",11,0)
 ;Ask for service
"RTN","GMRCSTLM",12,0)
 N Y
"RTN","GMRCSTLM",13,0)
 S DIR(0)="PO^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTLM",14,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTLM",15,0)
 D ^DIR
"RTN","GMRCSTLM",16,0)
 I Y<1 S VALMBCK="Q" Q
"RTN","GMRCSTLM",17,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTLM",18,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",19,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S VALMBCK="Q" Q 
"RTN","GMRCSTLM",20,0)
 ;
"RTN","GMRCSTLM",21,0)
 ;Ask for date range
"RTN","GMRCSTLM",22,0)
 D ^GMRCSPD
"RTN","GMRCSTLM",23,0)
 I $D(GMRCQUT) S VALMBCK="Q" G EXIT
"RTN","GMRCSTLM",24,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",25,0)
 Q
"RTN","GMRCSTLM",26,0)
 ;
"RTN","GMRCSTLM",27,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL) ;Entry point for GUI interface.
"RTN","GMRCSTLM",28,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTLM",29,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTLM",30,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTLM",31,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTLM",32,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTLM",33,0)
 ;GMRCCTRL:   0, null or not define then just the display list is 
"RTN","GMRCSTLM",34,0)
 ;                displayed
"RTN","GMRCSTLM",35,0)
 ;            1 then the list will be two pieces with the first piece 
"RTN","GMRCSTLM",36,0)
 ;                being the ien of the consult for selection in the gui
"RTN","GMRCSTLM",37,0)
 ;                and the second piece being the display text.
"RTN","GMRCSTLM",38,0)
 ;           10 then the consults will have a line number on them for
"RTN","GMRCSTLM",39,0)
 ;                selection
"RTN","GMRCSTLM",40,0)
 ;           20 then the consults will have the consult number displayed
"RTN","GMRCSTLM",41,0)
 ;          100 then use abbreviations for the statuses
"RTN","GMRCSTLM",42,0)
 ;      1, (10 or 20) and 100 can be added together to add there features
"RTN","GMRCSTLM",43,0)
 ;
"RTN","GMRCSTLM",44,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTLM",45,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTLM",46,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTLM",47,0)
 ;            1  grouper only
"RTN","GMRCSTLM",48,0)
 ;            2  tracking only
"RTN","GMRCSTLM",49,0)
 ;            9  disabled
"RTN","GMRCSTLM",50,0)
 ;
"RTN","GMRCSTLM",51,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTLM",52,0)
 K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCSTLM",53,0)
 S RETURN="^TMP(""GMRCR"",$J,""CP"")"
"RTN","GMRCSTLM",54,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",55,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTLM",56,0)
 ;Build service array
"RTN","GMRCSTLM",57,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTLM",58,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",59,0)
 ;Get external form of date range
"RTN","GMRCSTLM",60,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTLM",61,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTLM",62,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",63,0)
 G ENORSTR
"RTN","GMRCSTLM",64,0)
 ;
"RTN","GMRCSTLM",65,0)
ENORLM ;Entry point for List Manager interface.
"RTN","GMRCSTLM",66,0)
 D WAIT^DICD
"RTN","GMRCSTLM",67,0)
 ;
"RTN","GMRCSTLM",68,0)
ENORSTR ;Common part
"RTN","GMRCSTLM",69,0)
 N GMRCDA,NUMCLIN,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTLM",70,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP
"RTN","GMRCSTLM",71,0)
 N GMRCPT,CTRLTEMP,LINETEMP,GMRCLINE
"RTN","GMRCSTLM",72,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTLM",73,0)
 N GRP
"RTN","GMRCSTLM",74,0)
 ;
"RTN","GMRCSTLM",75,0)
 ; Patch #21 added the kill for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",76,0)
 K ^TMP("GMRCR",$J,"CP"),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",77,0)
 ;
"RTN","GMRCSTLM",78,0)
 S GMRCCT=0
"RTN","GMRCSTLM",79,0)
 S NUMCLIN=0
"RTN","GMRCSTLM",80,0)
 S GMRCLINE=0
"RTN","GMRCSTLM",81,0)
 S GROUPER=0
"RTN","GMRCSTLM",82,0)
 S GROUPER(0)=0
"RTN","GMRCSTLM",83,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",84,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCSTLM",85,0)
 S CTRLTEMP=$S(GMRCCTRL#2:"^",1:"")
"RTN","GMRCSTLM",86,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",28)_"Consult/Request By Status"
"RTN","GMRCSTLM",87,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",88,0)
 S TEMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTLM",89,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTLM",90,0)
 ;
"RTN","GMRCSTLM",91,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",92,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL",GMRCDT2=0
"RTN","GMRCSTLM",93,0)
 I '($D(GMRCDT2)#2) S GMRCDT2=""
"RTN","GMRCSTLM",94,0)
 I '($D(GMRCSTAT)#2) S GMRCSTAT="3,4,5,6,8,9,11,99" ;pending consults
"RTN","GMRCSTLM",95,0)
 ;
"RTN","GMRCSTLM",96,0)
CAPTION ;Set the List Mangager Caption Line
"RTN","GMRCSTLM",97,0)
 ; Does GMRCCTRL contain 10 i.e. display line numbers
"RTN","GMRCSTLM",98,0)
 ;                    or 20 i.e. display consult number
"RTN","GMRCSTLM",99,0)
 I $G(VALMAR)="^TMP(""GMRCR"",$J,""CP"")" D
"RTN","GMRCSTLM",100,0)
 .I GMRCCTRL#100\10 D
"RTN","GMRCSTLM",101,0)
 ..I GMRCCTRL#100\10=1 D
"RTN","GMRCSTLM",102,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",103,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","     St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",104,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",105,0)
 ...E  D CHGCAP^VALM("CAPTION LINE","     Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",106,0)
 ..; Do not display consult number
"RTN","GMRCSTLM",107,0)
 ..E  D
"RTN","GMRCSTLM",108,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",109,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE"," Number   St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",110,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",111,0)
 ...E  D CHGCAP^VALM("CAPTION LINE"," Number   Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",112,0)
 .E  D
"RTN","GMRCSTLM",113,0)
 ..; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",114,0)
 ..I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",115,0)
 ..; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",116,0)
 ..E  D CHGCAP^VALM("CAPTION LINE","Status      Last Action      Request Date  Patient Name      Pt Location")
"RTN","GMRCSTLM",117,0)
 ;Set screen width
"RTN","GMRCSTLM",118,0)
 S VALM("RM")=$$CWIDTH^GMRCPC(GMRCCTRL)
"RTN","GMRCSTLM",119,0)
 ;
"RTN","GMRCSTLM",120,0)
 S GMRCHEAD=$P($G(^TMP("GMRCSLIST",$J,+$O(^TMP("GMRCSLIST",$J,"")))),"^",2)
"RTN","GMRCSTLM",121,0)
 S INDEX=""
"RTN","GMRCSTLM",122,0)
SVC ;Loop on Service
"RTN","GMRCSTLM",123,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTLM",124,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTLM",125,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTLM",126,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTLM",127,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTLM",128,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTLM",129,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTLM",130,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTLM",131,0)
GROUPER .;Check if starting a new Grouper
"RTN","GMRCSTLM",132,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTLM",133,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTLM",134,0)
 ..D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL)
"RTN","GMRCSTLM",135,0)
 ..;pop grouper from stack
"RTN","GMRCSTLM",136,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTLM",137,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTLM",138,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTLM",139,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",140,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",141,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",142,0)
 ..S TEMP="GROUPER: "_GMRCSVCP
"RTN","GMRCSTLM",143,0)
 ..S:GMRCSVCG>0 TEMP=TEMP_"  in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTLM",144,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",40-(($L(TEMP)/2)+.5))_TEMP
"RTN","GMRCSTLM",145,0)
 ..;push new grouper on stack
"RTN","GMRCSTLM",146,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTLM",147,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTLM",148,0)
STAT .;Loop for one status at a time
"RTN","GMRCSTLM",149,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D ONESTAT^GMRCSTL2
"RTN","GMRCSTLM",150,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTLM",151,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTLM",152,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTLM",153,0)
 ..;  for all status for this service to all of its groupers
"RTN","GMRCSTLM",154,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTLM",155,0)
 .;
"RTN","GMRCSTLM",156,0)
PRINTST .;Print the totals for this service that are >0
"RTN","GMRCSTLM",157,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")>0 D LISTTOT^GMRCSTL1(.GMRCCT,1,GMRCSVC,GMRCSVCP,$P($G(^GMR(123.5,GMRCSVCG,0)),"^",1),GMRCCTRL)
"RTN","GMRCSTLM",158,0)
 ;
"RTN","GMRCSTLM",159,0)
 ;Done so
"RTN","GMRCSTLM",160,0)
 ;Now list the group totals for the current groups
"RTN","GMRCSTLM",161,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTLM",162,0)
 .D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL)
"RTN","GMRCSTLM",163,0)
 ;
"RTN","GMRCSTLM",164,0)
 S VALMCNT=GMRCCT
"RTN","GMRCSTLM",165,0)
 I $D(IOBM),$D(IOTM) S VALMBCK="R"
"RTN","GMRCSTLM",166,0)
EXIT Q
"RTN","GMRCSTLM",167,0)
 ;
"RTN","GMRCYP23")
0^6^B956618
"RTN","GMRCYP23",1,0)
GMRCYP23 ;SLC/MA - Post Install for patch 23 ;1/10/02  14:27
"RTN","GMRCYP23",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**23**;DEC 27, 1997
"RTN","GMRCYP23",3,0)
EN ; Main entry point for post-install
"RTN","GMRCYP23",4,0)
 ; Routine will populate the new xref (AP,AL) for global
"RTN","GMRCYP23",5,0)
 ; ^GMR(123) REQUEST/CONSULTATION
"RTN","GMRCYP23",6,0)
 ; DBIA 10013 call ENALL^DIK
"RTN","GMRCYP23",7,0)
 S DIK="^GMR(123,",DIK(1)="4^AP"  ;XREF for Procedures
"RTN","GMRCYP23",8,0)
 D ^XQDATE
"RTN","GMRCYP23",9,0)
 D BMES^XPDUTL("START OF BUILDING ""AP"" XREF @ "_%Y)
"RTN","GMRCYP23",10,0)
 D ENALL^DIK
"RTN","GMRCYP23",11,0)
 D ^XQDATE
"RTN","GMRCYP23",12,0)
 D BMES^XPDUTL("END OF BUILDING ""AP"" XREF @   "_%Y)
"RTN","GMRCYP23",13,0)
 D ^XQDATE
"RTN","GMRCYP23",14,0)
 D BMES^XPDUTL("START OF BUILDING ""AL"" XREF @ "_%Y)
"RTN","GMRCYP23",15,0)
 S DIK(1)=".04^AL"                  ;XREF for patient location
"RTN","GMRCYP23",16,0)
 D ENALL^DIK
"RTN","GMRCYP23",17,0)
 D ^XQDATE
"RTN","GMRCYP23",18,0)
 D BMES^XPDUTL("END OF BUILDING ""AL"" XREF @   "_%Y)
"RTN","GMRCYP23",19,0)
 K DIK
"RTN","GMRCYP23",20,0)
 Q
"UP",123.5,123.51,-1)
123.5^10
"UP",123.5,123.51,0)
123.51
"VER")
8.0^22.0
"^DD",123,123,.04,0)
PATIENT LOCATION^P44'^SC(^0;4^Q
"^DD",123,123,.04,1,0)
^.1
"^DD",123,123,.04,1,1,0)
123^AL
"^DD",123,123,.04,1,1,1)
S ^GMR(123,"AL",$E(X,1,30),DA)=""
"^DD",123,123,.04,1,1,2)
K ^GMR(123,"AL",$E(X,1,30),DA)
"^DD",123,123,.04,1,1,"DT")
3011015
"^DD",123,123,.04,3)
Enter the Hospital Location of this patient.
"^DD",123,123,.04,21,0)
^^2^2^2970911^^^
"^DD",123,123,.04,21,1,0)
This is the location of the patient when the consult/request order was
"^DD",123,123,.04,21,2,0)
placed.
"^DD",123,123,.04,"DT")
3011015
"^DD",123,123,4,0)
PROCEDURE/REQUEST TYPE^V^^0;8^Q
"^DD",123,123,4,1,0)
^.1
"^DD",123,123,4,1,1,0)
123^AP
"^DD",123,123,4,1,1,1)
S ^GMR(123,"AP",$E(X,1,30),DA)=""
"^DD",123,123,4,1,1,2)
K ^GMR(123,"AP",$E(X,1,30),DA)
"^DD",123,123,4,1,1,"DT")
3011015
"^DD",123,123,4,3)
Enter the type of procedure being requested (e.g., EKG, UGI, etc.).
"^DD",123,123,4,21,0)
^^1^1^3010110^
"^DD",123,123,4,21,1,0)
This is the procedure that was requested via CPRS while ordering.
"^DD",123,123,4,"DT")
3011015
"^DD",123,123,4,"V",0)
^.12P^2^2
"^DD",123,123,4,"V",1,0)
101^Enter Order Item^1^O^n^n
"^DD",123,123,4,"V",2,0)
123.3^Consult Procedure^2^PROC^n^n
"^DD",123.5,123.5,10,0)
SUB-SERVICE^123.51P^^10;0
"^DD",123.5,123.5,10,20,0)
^.3LA^^0
"^DD",123.5,123.5,10,21,0)
^.001^4^4^3010102^^^^
"^DD",123.5,123.5,10,21,1,0)
This is the set of services or specialties that may be grouped under
"^DD",123.5,123.5,10,21,2,0)
the Service/Specialty.  A member of this sub-service may also be defined
"^DD",123.5,123.5,10,21,3,0)
to have its own sub-service/specialties. There is no limit to the
"^DD",123.5,123.5,10,21,4,0)
depth of the hierarchy beneath ALL SERVICES.
"^DD",123.5,123.5,10,"DT")
3010820
"^DD",123.5,123.51,0)
SUB-SERVICE SUB-FIELD^^2^2
"^DD",123.5,123.51,0,"NM","SUB-SERVICE")

"^DD",123.5,123.51,.01,0)
SUB-SERVICE/SPECIALTY^MP123.5'X^GMR(123.5,^0;1^S Y=X I Y=DA D EN^DDIOL("A SERVICE CAN NOT BE A SUBSERVICE OF ITSELF","","!!?12") K:Y=DA X
"^DD",123.5,123.51,.01,1,0)
^.1
"^DD",123.5,123.51,.01,1,1,0)
123.51^B
"^DD",123.5,123.51,.01,1,1,1)
S ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.51,.01,1,1,2)
K ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)
"^DD",123.5,123.51,.01,1,2,0)
123.5^APC^MUMPS
"^DD",123.5,123.51,.01,1,2,1)
S ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.51,.01,1,2,2)
K ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.51,.01,1,2,"%D",0)
^.101^3^3^3000615^^^
"^DD",123.5,123.51,.01,1,2,"%D",1,0)
This cross-reference is used to find the parents of a given service. This
"^DD",123.5,123.51,.01,1,2,"%D",2,0)
helps identify AC cross-references that need to be updated when the .01
"^DD",123.5,123.51,.01,1,2,"%D",3,0)
name changes, and helps manage forwarding to services.
"^DD",123.5,123.51,.01,1,2,"DT")
2971103
"^DD",123.5,123.51,.01,1,3,0)
123.51^AC^MUMPS
"^DD",123.5,123.51,.01,1,3,1)
I $L($P($G(^GMR(123.5,X,0)),U)) S ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)=""
"^DD",123.5,123.51,.01,1,3,2)
I $L($P($G(^GMR(123.5,X,0)),U)) K ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)
"^DD",123.5,123.51,.01,1,3,"%D",0)
^^2^2^2971103^^
"^DD",123.5,123.51,.01,1,3,"%D",1,0)
This cross-reference is used to build a hierarchical listing of the
"^DD",123.5,123.51,.01,1,3,"%D",2,0)
services alphabetically.
"^DD",123.5,123.51,.01,1,3,"DT")
2971103
"^DD",123.5,123.51,.01,3)
Enter the name of the Service which is to be a SUB-service of the Parent service.
"^DD",123.5,123.51,.01,21,0)
^.001^7^7^3010102^^^^
"^DD",123.5,123.51,.01,21,1,0)
This is the menu of sub-service/specialties that are grouped under this
"^DD",123.5,123.51,.01,21,2,0)
Service.  The sub-service/specialty entries must each be defined as 
"^DD",123.5,123.51,.01,21,3,0)
entries in this file.
"^DD",123.5,123.51,.01,21,4,0)
  
"^DD",123.5,123.51,.01,21,5,0)
There is no limit on how deep the hierarchy of services may be defined.
"^DD",123.5,123.51,.01,21,6,0)
The only requirement is that the "ALL SERVICES" entry be at the top of
"^DD",123.5,123.51,.01,21,7,0)
the hierarchy.
"^DD",123.5,123.51,.01,23,0)
3^.001^3^3^3010102^^^^
"^DD",123.5,123.51,.01,23,1,0)
This file is similar to the Option File and Protocol File.  The same
"^DD",123.5,123.51,.01,23,2,0)
concepts for setting up options should be used to define the Service/
"^DD",123.5,123.51,.01,23,3,0)
Specialty entries.
"^DD",123.5,123.51,.01,"DT")
3010730
**END**
**END**
