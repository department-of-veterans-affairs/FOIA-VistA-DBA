$TXT Created by CURTIS,RICHARD L at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Frid
ay, 05/14/04 at 13:30
=============================================================================
Run Date: JUN 30, 2004                     Designation: SD*5.3*339
Package : SD - SCHEDULING                     Priority: Mandatory
Version : 5.3       SEQ #297                    Status: Released
                  Compliance Date: JUL 31, 2004
=============================================================================

Associated patches: (v)SD*5.3*144  <<= must be installed BEFORE `SD*5.3*339'
                    (v)SD*5.3*176  <<= must be installed BEFORE `SD*5.3*339'
                    (v)SD*5.3*180  <<= must be installed BEFORE `SD*5.3*339'

Subject: CPT CODES NOT PRINTING AND ERROR MESSAGE CLEANUP FOR AMB CARE

Category:
  - Routine

Description:
============

 This patch corrects errors or problems which are occurring in three
 Ambulatory Care (ACRP) reports.  First, the Outpatient Encounter
 Workload Statistics report periodically errors with a null subscript.
 Second, the Encounters by DSS ID/DSS ID by Frequency report errors
 for an illegal entry into a formal list.  Third, not all CPT codes
 are printing on the Management Report for Ambulatory Procedures.
 Finally, the Outpatient Encounter Workload Statistics report periodically
 errors with an undefined variable SDZ(2) or SDZ(4).

 ASSOCIATED E3R(s):
 ==================
 N/A

 ASSOCIATED NOIS:
 ================
 1.  HVH-0600-12477  Null subscript error - O/P Encounter Workload Statistics
                     Rep
     Duplicate:
         BOI-0101-51622    SUBSCRIPT ERROR STX+7~SCRPW8
 2.  STX-0900-71758  Illegal Entry into a Formal List
 3.  DAN-0500-42325  Management Report for Ambulatory Procedures
     Duplicate:
         SBY-0403-30866    CPT Modifier # on Amb Report
 4.  WAS-0304-20899  Code Error ^SCRPW9

 PARTICIPATING TEST SITES:
 =========================
   Salisbury, NC
   N. Chicago, IL
   Roseburg, OR
   El Paso, TX

 NOIS OVERVIEW:
 ==============
 1. HVH-0600-12477   Null subscript error - O/P Encounter Workload Statistics
                     Rep

    Problem:
    --------
    When running the Outpatient Encounter Workload Statistics Report,
    it will periodically error for a null subscript at linetag
    STX+7 in routine SCRPW8.

    Resolution:
    -----------
    This patch corrects the issue by checking if variable SDTOEE
    equals null before using it as a subscript in file 409.76.

 2. STX-0900-71758   Illegal Entry into a Formal List

    Problem:
    --------
    When running option Encounters by DSS ID/DSS ID by Frequency
    and no activities are found within the report parameters, a call
    is made to routine SCRPW40 at linetag DHDR.  However, the call
    is missing required input parameters so an Illegal Entry into a
    Formal List error occurs.

    Resolution:
    -----------
    This patch corrects this issue by adding the required input
    parameters to the call indicated above.

 3. DAN-0500-42325   Management Report for Ambulatory Procedures

    Problem:
    --------
    When running the Management Report for Ambulatory Procedures,
    it is printing the IEN for the CPT file rather than the CPT
    code because the extrinsic function is using the first piece
    of the output string (which is the IEN), instead of the second
    piece (which is the CPT code).  Additionally, the Write
    statement that follows uses an Unary Operator (plus sign),
    which converts a string to its numeric equivalent, so any
    leading zeroes will be removed.

    Resolution:
    -----------
    A new variable (KK) has been added, which will be set to the
    second piece of the output string of the extrinsic function.
    The Write statement will be changed to use this new variable
    minus the Unary Operator.


 4. WAS-0304-20899  Code Error ^SCRPW9

    Problem:
    --------
    When running the Outpatient Encounter Workload Report, it will
    occasionally error when running it for Uniques or Visits and
    it comes across one with a status of No Show.  It will error
    at DETAIL+4^SCRPW8 for undefined variable SDZ(2).
    Additionally, if the user elects to run the report for Encounters,
    selects encounter status of Checked Out and then up-arrows at the
    next prompt - Select Transmission Status, instead of Quitting as
    expected, the option will continue to the next parameter prompt.
    If the user up-arrows at the next prompt, no problem, the option
    will correctly Quit.  However, if they continue through the
    remaining prompts an error will occur at C1+2^SCRPW8 for undefined
    variable SDZ(4).

    Resolution:
    -----------
    For the first error, a new line of code will be added following
    DETAIL+3 to quit if SDZ(2) is undefined.  For the second error,
    the proper subscript will be added to array SDZ when the user
    either enters an up-arrow or times-out.

 TECHNICAL:
 ==========

 1. HVH-0600-12477   Null subscript error - O/P Encounter Workload Statistics
                     Rep
    A check is made to insure variable SDTOEE is not null before
    using it as a subscript in file 409.76.  The code at STX+7 is
    changed, as follows:

    FROM:

    S SDTOEE=$O(^SD(409.75,"B",SDTOE,0)) I SDTOEE S SDTOEE=$P($G(^SD(
    409.75,SDTOEE,0)),U,2),SDTOEE=$P($G(^SD(409.76,SDTOEE,0)),U,2) ...

    TO:

    S SDTOEE=$O(^SD(409.75,"B",SDTOE,0)) I SDTOEE S SDTOEE=$P($G(^SD(
    409.75,SDTOEE,0)),U,2) I SDTOEE S SDTOEE=$P($G(^SD(409.76,SDTOEE,
    0)),U,2) ...

 2. STX-0900-71758   Illegal Entry into a Formal List
    The required input parameters will be added to the call to routine
    SCRPW40 at START+7^SCRPW51, i.e.:

    FROM:  D DHDR^SCRPW40     TO:  D DHDR^SCRPW40(1,.SDTIT)

 3. DAN-0500-42325   CPT Codes not printing on Management Report
    A new  variable will be set to the 2nd piece of the output string
    returned by the extrinsic function at CD+2^SDAMBMR2.  Also, the
    Unary Operator will be removed form the Write statement where the
    CPT code is being printed.


 4. WAS-0304-20899   Code Error ^SCRPW9
    A new line of code will be inserted following DETAIL+3^SCRPW8, as
    follows:  Q:'$D(SDZ(2)).
    Additionally, to fix the second error the following line of code
    at DET1+4^SCRPW9 will be changed as follows:

    From:  W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ=-1 Q
      To:  W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q

 ROUTINE SUMMARY:
 ================
 The following is a list of the routine(s) included in this patch.  The
 second line of each of these routine(s) will look like:

      <tab>;;5.3;Scheduling;**[patch list]**;AUG 13, 1993

                            CHECK^XTSUMBLD results
 Routine name    Before Patch        After Patch       Patch List
 ============    ============        ===========       ==========
 SCRPW51             12788201           13899921         144,339
 SCRPW8              29681025           29850314   139,145,144,176,339
 SCRPW9              31932065           32054203         139,144,339
 SDAMBMR2            14029594           14376821   28,140,132,180,339


 INSTALLATION INSTRUCTIONS:
 ==========================

 This patch can be installed at any time.  Users do not need to be off
 the system.  Installation should take less than 10 minutes.
 If the patch is installed during the normal workday, it is recommended
 that the following menu options (File #19) and all their descendants be
 disabled to prevent possible conflicts while running the KIDS install.
 Other VISTA users will not be effected.

 1.  Choose the PackMan message containing this patch and invoke the
     INSTALL/CHECK MESSAGE PackMan option.

 2.  (DSM for open VMS sites only) Disable routine mapping on all systems
     for the routines listed in the routine summary.

     NOTE:  If the routines included in this patch are not currently in
     your mapped routine set, please skip this step.

 3.  Start up the Kernel Installation and Distribution System Menu
     [XPD MAIN]:

           Edits and Distribution ...
           Utilities ...
           Installation ...

     Select Kernel Installation & Distribution System Option: INStallation
                                                              ---

     1      Load a Distribution
     2      Verify Checksums in Transport Global
     3      Print Transport Global
     4      Compare Transport Global to Current System
     5      Backup a Transport Global
     6      Install Package(s)
            Restart Install of Package(s)
            Unload a Distribution

 4.  From this menu, you may elect to use the following options
     (when prompted for INSTALL NAME, enter SD*5.3*339):

     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with the patch.  It will NOT
         backup any other changes such as DDs or templates.

     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when the patch
         is installed.  It compares all components of the patch
         (routines, DDs, templates, etc.).

     c.  Verify Checksums in Transport Global - This option will ensure
         the integrity of the routines that are in the transport global.

 5.  Use the Install Package(s) option and select the package SD*5.3*339.

     a.  When prompted "Want KIDS to INHIBIT LOGONS during the
         install? YES//" respond NO.

     b.  When prompted "Want to DISABLE Scheduled Options, Menu
         Options, and Protocols? YES//" respond YES.

         1) When prompted "Enter options you wish to mark as "Out of
            Order":" enter the following options:

         Outpatient Encounter Workload Statistics  [SCRPW OUT ENC
           WORKLOAD STATS]
         Data Validation Menu   [SCRPW DATA VALIDATION MENU]
         Management Report for Ambulatory Procedures  [SD AMB PROC
           MANAGEMENT REPORT]

         2) When prompted "Enter protocols you wish to mark as "Out of
            Order":" just press <return>.

 6.  (DSM for open VMS sites only)  Optional - Include the routines
     distributed with this patch in the mapped routine set.

     NOTE:  This step is only necessary if you performed step 2 or if
     you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - SCRPW51


Routine Checksum:

Routine Name:
  - SCRPW8


Routine Checksum:

Routine Name:
  - SCRPW9


Routine Checksum:

Routine Name:
  - SDAMBMR2


Routine Checksum:

=============================================================================
User Information:
Entered By  : CURTIS,RICHARD                Date Entered  : JAN 09, 2004
Completed By: BAUMAN,HELENE                 Date Completed: JUN 30, 2004
Released By : FITCH,DONNA                   Date Released : JUN 30, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
