Released TIU*1*156 SEQ #137
Extracted from mail message
**KIDS**:TIU*1.0*156^

**INSTALL NAME**
TIU*1.0*156
"BLD",4144,0)
TIU*1.0*156^TEXT INTEGRATION UTILITIES^0^3030117^y
"BLD",4144,1,0)
^^2^2^3030115^
"BLD",4144,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",4144,1,2,0)
under TIU*1.0*156.
"BLD",4144,4,0)
^9.64PA^^
"BLD",4144,"ABPKG")
n
"BLD",4144,"KRN",0)
^9.67PA^8989.52^19
"BLD",4144,"KRN",.4,0)
.4
"BLD",4144,"KRN",.401,0)
.401
"BLD",4144,"KRN",.402,0)
.402
"BLD",4144,"KRN",.403,0)
.403
"BLD",4144,"KRN",.5,0)
.5
"BLD",4144,"KRN",.84,0)
.84
"BLD",4144,"KRN",3.6,0)
3.6
"BLD",4144,"KRN",3.8,0)
3.8
"BLD",4144,"KRN",9.2,0)
9.2
"BLD",4144,"KRN",9.8,0)
9.8
"BLD",4144,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4144,"KRN",9.8,"NM",1,0)
TIUCHLP^^0^B12574615
"BLD",4144,"KRN",9.8,"NM",2,0)
TIULV^^0^B29706843
"BLD",4144,"KRN",9.8,"NM",3,0)
TIULD^^0^B13137776
"BLD",4144,"KRN",9.8,"NM",4,0)
TIURS1^^0^B70406854
"BLD",4144,"KRN",9.8,"NM","B","TIUCHLP",1)

"BLD",4144,"KRN",9.8,"NM","B","TIULD",3)

"BLD",4144,"KRN",9.8,"NM","B","TIULV",2)

"BLD",4144,"KRN",9.8,"NM","B","TIURS1",4)

"BLD",4144,"KRN",19,0)
19
"BLD",4144,"KRN",19.1,0)
19.1
"BLD",4144,"KRN",101,0)
101
"BLD",4144,"KRN",409.61,0)
409.61
"BLD",4144,"KRN",771,0)
771
"BLD",4144,"KRN",870,0)
870
"BLD",4144,"KRN",8989.51,0)
8989.51
"BLD",4144,"KRN",8989.52,0)
8989.52
"BLD",4144,"KRN",8994,0)
8994
"BLD",4144,"KRN","B",.4,.4)

"BLD",4144,"KRN","B",.401,.401)

"BLD",4144,"KRN","B",.402,.402)

"BLD",4144,"KRN","B",.403,.403)

"BLD",4144,"KRN","B",.5,.5)

"BLD",4144,"KRN","B",.84,.84)

"BLD",4144,"KRN","B",3.6,3.6)

"BLD",4144,"KRN","B",3.8,3.8)

"BLD",4144,"KRN","B",9.2,9.2)

"BLD",4144,"KRN","B",9.8,9.8)

"BLD",4144,"KRN","B",19,19)

"BLD",4144,"KRN","B",19.1,19.1)

"BLD",4144,"KRN","B",101,101)

"BLD",4144,"KRN","B",409.61,409.61)

"BLD",4144,"KRN","B",771,771)

"BLD",4144,"KRN","B",870,870)

"BLD",4144,"KRN","B",8989.51,8989.51)

"BLD",4144,"KRN","B",8989.52,8989.52)

"BLD",4144,"KRN","B",8994,8994)

"BLD",4144,"QUES",0)
^9.62^^
"BLD",4144,"REQB",0)
^9.611^3^3
"BLD",4144,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",4144,"REQB",2,0)
TIU*1.0*148^2
"BLD",4144,"REQB",3,0)
TIU*1.0*142^2
"BLD",4144,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",4144,"REQB","B","TIU*1.0*142",3)

"BLD",4144,"REQB","B","TIU*1.0*148",2)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
156^3030117
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030117
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*156.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUCHLP")
0^1^B12574615
"RTN","TIUCHLP",1,0)
TIUCHLP ; SLC/SBW - Help for Clinician ;11/29/02
"RTN","TIUCHLP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,109,148,156**;Jun 20, 1997
"RTN","TIUCHLP",3,0)
MAIN ; Control branching
"RTN","TIUCHLP",4,0)
 N DIC,X,Y,TIUI,TIUROOT,TIUFPRIV S TIUFPRIV=1
"RTN","TIUCHLP",5,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUCHLP",6,0)
 S DIC=8925.1,DIC(0)="AEMQZ",DIC("A")="Select DOCUMENT TYPE: "
"RTN","TIUCHLP",7,0)
 S DIC("B")=$G(^DISV(+DUZ,"^TIU(8925.1,"))
"RTN","TIUCHLP",8,0)
 D ^DIC I +Y'>0 D
"RTN","TIUCHLP",9,0)
 . W !!,"Required information for dictation help not set up for this report type."
"RTN","TIUCHLP",10,0)
 I +Y>0 D
"RTN","TIUCHLP",11,0)
 . I $P(TIUPRM0,U,16)="D" S TIUROOT="ITEM"
"RTN","TIUCHLP",12,0)
 . E  I $P(TIUPRM0,U,16)="C" S TIUROOT="HEAD"
"RTN","TIUCHLP",13,0)
 . I $G(TIUROOT)']"" W !!,"Required information for dictation help not set up for this report type." Q
"RTN","TIUCHLP",14,0)
 . W !!,"A Dictated ",$P(Y(0),U),", requires the following:"
"RTN","TIUCHLP",15,0)
 . S TIUI=0
"RTN","TIUCHLP",16,0)
 . F  S TIUI=$O(^TIU(8925.1,+Y,TIUROOT,TIUI)) Q:+TIUI'>0  D
"RTN","TIUCHLP",17,0)
 . . I +$P($G(^TIU(8925.1,+Y,TIUROOT,TIUI,0)),U,6) W !?10,$P($G(^(0)),U,2)
"RTN","TIUCHLP",18,0)
 W !!
"RTN","TIUCHLP",19,0)
 I $$READ^TIUU("YO","Do you want to get patient data","YES") D GETPAT
"RTN","TIUCHLP",20,0)
 Q
"RTN","TIUCHLP",21,0)
GETPAT ; Gets Dictation data for a specific patient
"RTN","TIUCHLP",22,0)
 N TIU,TIUOUT,DFN,SUCCESS,TITLE
"RTN","TIUCHLP",23,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUCHLP",24,0)
 . S DFN=+$$PATIENT^TIULA
"RTN","TIUCHLP",25,0)
 . D MAIN^TIUMOVE(.TIU,DFN)
"RTN","TIUCHLP",26,0)
 . I $D(TIU) D PATDATA(.TIU)
"RTN","TIUCHLP",27,0)
 . S TIUOUT=$$READ^TIUU("Y","... OK","YES")
"RTN","TIUCHLP",28,0)
 D MAKE^TIUPEFIX(.SUCCESS,DFN,.TITLE,.TIU,$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:""))
"RTN","TIUCHLP",29,0)
 I +SUCCESS S TIUDONE=1
"RTN","TIUCHLP",30,0)
 Q
"RTN","TIUCHLP",31,0)
PATDATA(X) ; Display/validate correct patient/treatment episode
"RTN","TIUCHLP",32,0)
 N DIR,Y,TIURC
"RTN","TIUCHLP",33,0)
 W !!?1,"Patient: ",$$NAME^TIULS(X("PNM"),"LAST, FIRST MI"),?40,"SSN: ",X("SSN"),?62,"Sex: ",$P(X("SEX"),U,2),!
"RTN","TIUCHLP",34,0)
 W ?4,"Ward: ",$P(X("WARD"),U,2),?40,"Age: ",X("AGE"),!
"RTN","TIUCHLP",35,0)
 W "Att Phys: ",$P(X("AMD"),U,2),?34,"Prim Phys: ",$P(X("PMD"),U,2),!
"RTN","TIUCHLP",36,0)
 W "Adm Date: ",$$DATE^TIULS(+X("EDT"),"MM/DD/YY@HR:MIN:SEC")
"RTN","TIUCHLP",37,0)
 W:X("LDT")]"" ?35,"Dis Date: ",$$DATE^TIULS(X("LDT"),"MM/DD/YY")
"RTN","TIUCHLP",38,0)
 W !
"RTN","TIUCHLP",39,0)
 W ?2,"Adm Dx: ",X("ADDX")
"RTN","TIUCHLP",40,0)
 ; Below TIU*148
"RTN","TIUCHLP",41,0)
 I $G(X("NUMRACE"))>0 D
"RTN","TIUCHLP",42,0)
 . W !?4,"Race: " F TIURC=1:1:X("NUMRACE") W ?10,$P(X("RACE",TIURC),U,2),!
"RTN","TIUCHLP",43,0)
 I $G(X("RACENO"))=0 W !?4,"Race: ",$P($G(X("RACE")),U,2),!
"RTN","TIUCHLP",44,0)
 I $D(X("DICTDT")) D
"RTN","TIUCHLP",45,0)
 . W !,"A DISCHARGE SUMMARY is already on file:",!
"RTN","TIUCHLP",46,0)
 . W ?2,"Dict'd: ",X("DICTDT"),?41,"By: ",X("AUTHOR"),!
"RTN","TIUCHLP",47,0)
 . W ?2,"Signed: ",X("SIGDT"),?35,"Cosigned: ",X("COSDT"),!
"RTN","TIUCHLP",48,0)
 Q
"RTN","TIUCHLP",49,0)
GETPN ; Help get Fields for PN Dictation/Error Resolution
"RTN","TIUCHLP",50,0)
 N TIU,DFN,TIUY,TITLE
"RTN","TIUCHLP",51,0)
 S DFN=+$$PATIENT^TIULA Q:+DFN'>0
"RTN","TIUCHLP",52,0)
 D ENPN^TIUVSIT(.TIU,+DFN,1)
"RTN","TIUCHLP",53,0)
 I '$D(TIU) Q
"RTN","TIUCHLP",54,0)
 S TIUY=$$CHEKPN(.TIU)
"RTN","TIUCHLP",55,0)
 D MAKE^TIUPEFIX(.SUCCESS,DFN,.TITLE,.TIU,$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:""))
"RTN","TIUCHLP",56,0)
 I +SUCCESS S TIUDONE=1
"RTN","TIUCHLP",57,0)
 Q
"RTN","TIUCHLP",58,0)
CHEKPN(X,TIUBY) ; Display/validate demographic/visit information
"RTN","TIUCHLP",59,0)
 W !!,"Document Identifiers..."
"RTN","TIUCHLP",60,0)
 W !?14,"Patient Name:  ",$S($G(X("PNM"))]"":$G(X("PNM")),1:"UNKNOWN")
"RTN","TIUCHLP",61,0)
 W !?15,"Patient SSN:  ",$S($G(X("SSN"))]"":$G(X("SSN")),1:"UNKNOWN")
"RTN","TIUCHLP",62,0)
 W !?10,"Patient Location:  ",$S(+$G(X("LOC")):$P($G(X("LOC")),U,2),1:"UNKNOWN")
"RTN","TIUCHLP",63,0)
 W !?8,"Date/time of Visit:  ",$S($L($G(X("VSTR"))):$$DATE^TIULS($P(X("VSTR"),";",2),"MM/DD/YY HR:MIN"),1:"UNKNOWN")
"RTN","TIUCHLP",64,0)
 S Y=$$READ^TIUU("YO","   ...OK","YES")
"RTN","TIUCHLP",65,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) Q 0
"RTN","TIUCHLP",66,0)
 I +Y'>0 D
"RTN","TIUCHLP",67,0)
 . K X N TIUINOUT
"RTN","TIUCHLP",68,0)
 . S TIUINOUT=$$INOUT^TIUVSIT
"RTN","TIUCHLP",69,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIUCHLP",70,0)
 . I $P(TIUINOUT,U)="o" D MAIN^TIUVSIT(.X,DFN,"","","","",1,"",20,1)
"RTN","TIUCHLP",71,0)
 . I $P(TIUINOUT,U)'="o" D MAIN^TIUMOVE(.X,DFN,"","","",1,"LAST",1)
"RTN","TIUCHLP",72,0)
 . S Y=$S($D(X)>9:$$CHEKPN(.X,.TIUBY),1:0)
"RTN","TIUCHLP",73,0)
 Q Y
"RTN","TIULD")
0^3^B13137776
"RTN","TIULD",1,0)
TIULD ; SLC/JER - Admission related functions ; 1/13/03
"RTN","TIULD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,21,148,156**;Jun 20, 1997
"RTN","TIULD",3,0)
GETTIU(TIUY,TIUDA) ; Gets admission array for existing DCS
"RTN","TIULD",4,0)
 N TIUMVN,TIUPTF,TIUVSTR,TIUDTYP,TIUD0,TIUD12,TIUD14
"RTN","TIULD",5,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIULD",6,0)
 S TIUDTYP=+TIUD0,DFN=+$P(TIUD0,U,2),TIUMVN=$P(TIUD14,U)
"RTN","TIULD",7,0)
 S TIUVSTR=$P(TIUD12,U,11)_";"_$P(TIUD0,U,7)_";"_$P(TIUD0,U,13)
"RTN","TIULD",8,0)
 S TIUY("DOCTYP")=TIUDTYP_U_$$PNAME^TIULC1(TIUDTYP)
"RTN","TIULD",9,0)
 I +$G(^TIU(8925,+TIUDA,13)) S TIUY("REFDT")=+$G(^(13))
"RTN","TIULD",10,0)
 ; If the Patient Movement Pointer's broken, try to fix
"RTN","TIULD",11,0)
 I +TIUMVN,'$D(^DGPM(+TIUMVN,0)),+$G(TIUVSTR) D FIXMOVE(.TIUY,DFN,TIUVSTR,TIUDA) Q:+$G(TIUY("AD#"))
"RTN","TIULD",12,0)
 D PATVADPT^TIULV(.TIUY,DFN,TIUMVN,TIUVSTR)
"RTN","TIULD",13,0)
 Q
"RTN","TIULD",14,0)
FIXMOVE(TIUY,DFN,TIUVSTR,TIUDA) ; See if Admission has been reinstated, and fix
"RTN","TIULD",15,0)
 N TIUEDT,TIULDT,TIULOC
"RTN","TIULD",16,0)
 S TIUEDT=$P(TIUVSTR,";",2) Q:+TIUEDT'>0
"RTN","TIULD",17,0)
 S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIULOC=+TIUVSTR
"RTN","TIULD",18,0)
 Q:+TIULDT'>0!(+TIULOC'>0)
"RTN","TIULD",19,0)
 D MAIN^TIUMOVE(.TIUY,DFN,"",TIUEDT,TIULDT,1,"LAST",0,+TIULOC)
"RTN","TIULD",20,0)
 I +$G(TIU("AD#"))>0,$D(^DGPM(+$G(TIU("AD#")))) D
"RTN","TIULD",21,0)
 . N DIE,DR,DA S DA=TIUDA,DR="1401////"_+$G(TIU("AD#")),DIE="^TIU(8925,"
"RTN","TIULD",22,0)
 . D ^DIE
"RTN","TIULD",23,0)
 Q
"RTN","TIULD",24,0)
CHEKDS(X) ; Display/validate correct patient/treatment episode
"RTN","TIULD",25,0)
 N DIR,Y,TIURC S Y=0
"RTN","TIULD",26,0)
 I X("AD#")'>0!(X("EDT")="") D  G CHEKDSX
"RTN","TIULD",27,0)
 . W !!,"Movement data doesn't exist for admission, can't create "
"RTN","TIULD",28,0)
 . W "Summary",!
"RTN","TIULD",29,0)
 I +$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST")>0 S Y=1 G CHEKDSX
"RTN","TIULD",30,0)
 W !!?1,"Patient: ",$$NAME^TIULS(X("PNM"),"LAST, FIRST MI"),?40,"SSN: "
"RTN","TIULD",31,0)
 W X("SSN"),?62,"Sex: ",$S(X("SEX")]"":$P(X("SEX"),U,2),1:"UNKNOWN"),!
"RTN","TIULD",32,0)
 W ?5,"Age: ",$S(X("AGE")]"":X("AGE"),1:"UNKNOWN"),?40,"Claim #: "
"RTN","TIULD",33,0)
 W $S(X("CLAIM")]"":X("CLAIM"),1:"UNKNOWN"),!
"RTN","TIULD",34,0)
 W "Adm Date: ",$$DATE^TIULS($P(X("EDT"),U),"MM/DD/YY"),?40,"Ward: "
"RTN","TIULD",35,0)
 W $P(X("WARD"),U,2),!
"RTN","TIULD",36,0)
 W:X("LDT")]"" "Dis Date: ",$$DATE^TIULS(X("LDT"),"MM/DD/YY"),!
"RTN","TIULD",37,0)
 W ?2,"Adm Dx: ",X("ADDX")
"RTN","TIULD",38,0)
 ; Below TIU*148
"RTN","TIULD",39,0)
 I $G(X("NUMRACE"))>0 D
"RTN","TIULD",40,0)
 . W !?4,"Race: " F TIURC=1:1:X("NUMRACE") W ?10,$P(X("RACE",TIURC),U,2),!
"RTN","TIULD",41,0)
 I $G(X("RACENO"))=0 W !?4,"Race: ",$P($G(X("RACE")),U,2),!
"RTN","TIULD",42,0)
 I $D(X("DICTDT")) D
"RTN","TIULD",43,0)
 . W !,"A DISCHARGE SUMMARY is already on file:",!
"RTN","TIULD",44,0)
 . W ?2,"Dict'd: ",X("DICTDT"),?41,"By: ",X("AUTHOR"),!
"RTN","TIULD",45,0)
 . W ?2,"Signed: ",X("SIGDT"),?35,"Cosigned: ",X("COSDT"),!
"RTN","TIULD",46,0)
 . S Y=1
"RTN","TIULD",47,0)
 E  S Y=$$READ^TIUU("YO","Correct VISIT","YES")
"RTN","TIULD",48,0)
 W !
"RTN","TIULD",49,0)
CHEKDSX Q Y
"RTN","TIULD",50,0)
CHEKPN(X,TIUBY) ; Display/validate demographic/visit information
"RTN","TIULD",51,0)
 W !!,"Enter/Edit "
"RTN","TIULD",52,0)
 W $S(+$G(TIUCLASS):$S(TIUCLASS=3:"PROGRESS NOTE",TIUCLASS=+$$CLASS^TIUCNSLT:"CONSULT RESULT",1:$$PNAME^TIULC1(+TIUCLASS)),1:"PROGRESS NOTE"),"..."
"RTN","TIULD",53,0)
 W !?10,"Patient Location:  ",$S(+X("LOC"):$P(X("LOC"),U,2),1:"UNKNOWN")
"RTN","TIULD",54,0)
 W !?$S(+$G(X("AD#")):4,1:8),"Date/time of "
"RTN","TIULD",55,0)
 W $S(+$G(X("AD#")):"Admission:  ",1:"Visit:  ")
"RTN","TIULD",56,0)
 W $S(+$P($G(X("VSTR")),";",2):$$DATE^TIULS($P(X("VSTR"),";",2),"MM/DD/YY HR:MIN"),1:"UNKNOWN")
"RTN","TIULD",57,0)
 W !?9,"Date/time of Note:  "
"RTN","TIULD",58,0)
 W $S(+$G(X("REFDT"))>0:$$DATE^TIULS(X("REFDT"),"MM/DD/YY HR:MIN"),1:"NOW")
"RTN","TIULD",59,0)
 S:+$G(X("REFDT"))'>0 X("REFDT")=$$NOW^TIULC
"RTN","TIULD",60,0)
 W !?12,"Author of Note:  "
"RTN","TIULD",61,0)
 W $$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:DUZ))
"RTN","TIULD",62,0)
 S Y=$$READ^TIUU("YO","   ...OK","YES")
"RTN","TIULD",63,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) Q 0
"RTN","TIULD",64,0)
 S TIUBY=+Y
"RTN","TIULD",65,0)
 S:'+Y Y=$$READ^TIUU("YO","Correct VISIT","YES")
"RTN","TIULD",66,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) Q 0
"RTN","TIULD",67,0)
 I +Y'>0 D
"RTN","TIULD",68,0)
 . K X N TIUINOUT
"RTN","TIULD",69,0)
 . S TIUINOUT=$$INOUT^TIUVSIT
"RTN","TIULD",70,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIULD",71,0)
 . I $P(TIUINOUT,U)="o" D MAIN^TIUVSIT(.X,DFN,"","","","",1)
"RTN","TIULD",72,0)
 . I $P(TIUINOUT,U)'="o" D MAIN^TIUMOVE(.X,DFN,"","","",1,"LAST",1)
"RTN","TIULD",73,0)
 . S Y=$S($D(X)>9:$$CHEKPN(.X,.TIUBY),1:0)
"RTN","TIULD",74,0)
 Q Y
"RTN","TIULV")
0^2^B29706843
"RTN","TIULV",1,0)
TIULV ; SLC/JER - Visit/Movement related library ; 1/14/03
"RTN","TIULV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,30,55,45,52,148,156**;Jun 20, 1997
"RTN","TIULV",3,0)
PATPN(TIUY,DFN) ; Get minimum demographics for PN Print
"RTN","TIULV",4,0)
 N VADM,VAIP,VAIN,VA,VAPA
"RTN","TIULV",5,0)
 D OERR^VADPT
"RTN","TIULV",6,0)
 S TIUY("PNMP")=$E($G(VADM(1)),1,30)
"RTN","TIULV",7,0)
 S TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",8,0)
 S TIUY("DOB")="DOB:"_$$DATE^TIULS(+$G(VADM(3)),"MM/DD/CCYY")
"RTN","TIULV",9,0)
 D ADD^VADPT
"RTN","TIULV",10,0)
 I $G(VAPA(8))'="" S TIUY("PH#")="Ph:"_VAPA(8)
"RTN","TIULV",11,0)
 I $G(VAPA(8))="" S TIUY("PH#")="Ph: **UNKNOWN**"
"RTN","TIULV",12,0)
 S TIUY("INTNM")=$$NAME^VASITE ;Integration Name
"RTN","TIULV",13,0)
 S TIUY("SITE")=$P($$SITE^VASITE,U,2)
"RTN","TIULV",14,0)
 S TIUY("LOCP")="Pt Loc: "_$S(VAIN(4)]"":$P(VAIN(4),U,2)_"  "_VAIN(5),1:"OUTPATIENT")
"RTN","TIULV",15,0)
 Q
"RTN","TIULV",16,0)
 ;
"RTN","TIULV",17,0)
PATVADPT(TIUY,DFN,TIUMVN,TIUVSTR,TIUSDC) ; Extract MAS data
"RTN","TIULV",18,0)
 N VA,VADM,VAEL,VAERR,VAIP,TIUI,TIUWARD,X,Y,TIUTYPE,TIUFTS,TIUSS,VAPA
"RTN","TIULV",19,0)
 D DEM^VADPT
"RTN","TIULV",20,0)
 S TIUY("PNM")=$G(VADM(1)),TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",21,0)
 S TIUY("AGE")=$G(VADM(4)),TIUY("PID")="("_$E(TIUY("PNM"))_VA("BID")_")"
"RTN","TIULV",22,0)
 S TIUY("DOB")=$G(VADM(3))
"RTN","TIULV",23,0)
 D ADD^VADPT
"RTN","TIULV",24,0)
 I $G(VAPA(8))'="" S TIUY("PH#")=VAPA(8)
"RTN","TIULV",25,0)
 I $G(VAPA(8))="" S TIUY("PH#")="**UNKNOWN**"
"RTN","TIULV",26,0)
 S TIUY("SEX")=$G(VADM(5))
"RTN","TIULV",27,0)
 ; Below TIU*148
"RTN","TIULV",28,0)
 I +$G(VADM(12))>0 D 
"RTN","TIULV",29,0)
 . F TIUY("NUMRACE")=1:1:VADM(12) S TIUY("RACE",TIUY("NUMRACE"))=$G(VADM(12,TIUY("NUMRACE")))
"RTN","TIULV",30,0)
 S TIUY("RACENO")=+$G(VADM(12))
"RTN","TIULV",31,0)
 I +$G(VADM(12))=0 S TIUY("RACE")=$G(VADM(8))
"RTN","TIULV",32,0)
 I +$G(TIUSDC) S TIUY("STOP")=$G(TIUSDC)
"RTN","TIULV",33,0)
 I +$G(TIUD13(0)) S TIUY("REFDT")=+$G(TIUD13(0))
"RTN","TIULV",34,0)
 I +$G(TIUMVN),$D(^DGPM(+TIUMVN)) D
"RTN","TIULV",35,0)
 . ; N VLOC,VDT,TIUDIV
"RTN","TIULV",36,0)
 . N VLOC,VDT,TIUDIV
"RTN","TIULV",37,0)
 . S VAIP("E")=TIUMVN D 52^VADPT
"RTN","TIULV",38,0)
 . S TIUI=$S(+$G(VAIP(17,1)):17,1:14)
"RTN","TIULV",39,0)
 . S TIUY("CLAIM")=$G(VAEL(7)),TIUY("PMD")=$G(VAIP(TIUI,5))
"RTN","TIULV",40,0)
 . S TIUY("AMD")=$G(VAIP(18)),TIUY("TS")=$G(VAIP(TIUI,6))
"RTN","TIULV",41,0)
 . S TIUY("SVC")=+$$GET1^DIQ(45.7,+TIUY("TS"),2,"I",,"ERROR")
"RTN","TIULV",42,0)
 . S TIUY("SVC")=TIUY("SVC")_U_$$GET1^DIQ(49,+TIUY("SVC"),.01,"I",,"ERROR")
"RTN","TIULV",43,0)
 . S TIUY("WARD")=$$WARD($G(VAIP(17)))
"RTN","TIULV",44,0)
 . S (TIUY("ADDT"),TIUY("EDT"))=$G(VAIP(3))
"RTN","TIULV",45,0)
 . I +TIUY("WARD") S TIUY("LOC")=$G(^DIC(42,+TIUY("WARD"),44))
"RTN","TIULV",46,0)
 . I +$G(TIUY("LOC")) D
"RTN","TIULV",47,0)
 . . S TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",48,0)
 . S TIUY("ADDX")=$G(VAIP(9)),TIUY("LDT")=$G(VAIP(17,1))
"RTN","TIULV",49,0)
 . S TIUY("AD#")=+$G(VAIP(13)),TIUY("MTYPE")=$G(VAIP(TIUI,3))
"RTN","TIULV",50,0)
 . S TIUDIV=$P($G(^DIC(42,+TIUY("WARD"),0)),U,11)
"RTN","TIULV",51,0)
 . I +TIUDIV S TIUY("DIV")=TIUDIV_U_$P($G(^DG(40.8,+TIUDIV,0)),U)
"RTN","TIULV",52,0)
 . S VDT=+VAIP(3)
"RTN","TIULV",53,0)
 . S VLOC=$G(^DIC(42,+$P($G(VAIP(13,4)),U),44))
"RTN","TIULV",54,0)
 . S TIUY("VSTR")=VLOC_";"_+TIUY("EDT")_";H"
"RTN","TIULV",55,0)
 . S TIUY("VLOC")=VLOC_U_$P($G(^SC(VLOC,0)),U)
"RTN","TIULV",56,0)
 . S:'+$G(TIUY("LOC")) TIUY("LOC")=TIUY("VLOC")
"RTN","TIULV",57,0)
 I $G(TIUVSTR)]"" S TIUY("VSTR")=TIUVSTR D VSIT(.TIUY,TIUVSTR)
"RTN","TIULV",58,0)
 I '+$G(TIUMVN),'+$G(TIUVSTR) D CURRENT(.TIUY,DFN)
"RTN","TIULV",59,0)
 ; D CURRENT(.TIUY,DFN)
"RTN","TIULV",60,0)
 I +$$PROVIDER^TIUPXAP1($S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ),+$G(TIUY("EDT"))) D
"RTN","TIULV",61,0)
 . S TIUY("SVC")=$$PROVSVC(+$S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ))
"RTN","TIULV",62,0)
 I +$G(TIUY("VSTR")),(+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))>0) D
"RTN","TIULV",63,0)
 . N TIUVSIT S TIUVSIT=+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))
"RTN","TIULV",64,0)
 . I $P($G(^AUPNVSIT(+TIUVSIT,0)),U,5)'=DFN K ^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),TIUVSIT) Q
"RTN","TIULV",65,0)
 . S TIUY("VISIT")=+TIUVSIT_U_+$G(^AUPNVSIT(+TIUVSIT,0))
"RTN","TIULV",66,0)
 ; if pt an inpt + doc class is pn- default to current inpt loc
"RTN","TIULV",67,0)
 S TIUTYPE=$S(+$P($G(TIUTYP(1)),U,2)>0:$P($G(TIUTYP(1)),U,2),1:+$G(TIUTYP))
"RTN","TIULV",68,0)
 Q:+TIUTYPE'>0
"RTN","TIULV",69,0)
 I +$G(TIUMVN),$D(^DPT(DFN,.1)),+$$ISPN^TIULX(TIUTYPE) D
"RTN","TIULV",70,0)
 . I $D(VAIP(14,4)) S TIUY("LOC")=$G(^DIC(42,+VAIP(14,4),44))_U_$P(VAIP(14,4),U,2)
"RTN","TIULV",71,0)
 Q
"RTN","TIULV",72,0)
WARD(DA) ; Compute ward at discharge
"RTN","TIULV",73,0)
 N %,D0,DIC,DIQ,DR,MOVE,X,Y
"RTN","TIULV",74,0)
 I +DA'>0 S Y=$G(VAIP(TIUI,4)) G WARDX
"RTN","TIULV",75,0)
 S DIC="^DGPM(",DIQ(0)="IE",DIQ="MOVE(",DR=200
"RTN","TIULV",76,0)
 D EN^DIQ1
"RTN","TIULV",77,0)
 S X=$G(MOVE(405,DA,200,"E")),DIC=42,DIC(0)="X" D ^DIC
"RTN","TIULV",78,0)
 I +Y'>0 S Y=""
"RTN","TIULV",79,0)
WARDX Q Y
"RTN","TIULV",80,0)
PROVSVC(TIUSER) ; Resolve user's Service
"RTN","TIULV",81,0)
 N TIUY
"RTN","TIULV",82,0)
 S TIUY=$P($G(^VA(200,+TIUSER,5)),U)
"RTN","TIULV",83,0)
 S:+TIUY TIUY=TIUY_U_$P(^DIC(49,+TIUY,0),U)
"RTN","TIULV",84,0)
 Q TIUY
"RTN","TIULV",85,0)
VSIT(TIUY,TIUVSTR) ; Get Visit related info
"RTN","TIULV",86,0)
 N DIC,DIQ,X,Y,DA,DR,VSIT,TIUCT,VAEL,VAERR
"RTN","TIULV",87,0)
 D ELIG^VADPT
"RTN","TIULV",88,0)
 I '$D(TIUY("EDT")) D
"RTN","TIULV",89,0)
 . S TIUY("EDT")=$P(TIUVSTR,";",2)_U_$$DATE^TIULS($P(TIUVSTR,";",2),"AMTH DD, CCYY@HR:MIN")
"RTN","TIULV",90,0)
 S TIUY("LDT")=$G(TIUY("LDT"))
"RTN","TIULV",91,0)
 S TIUCT=$P(TIUVSTR,";",3)
"RTN","TIULV",92,0)
 I TIUCT]"" S TIUY("CAT")=TIUCT_U_$S(TIUCT="A":"AMBULATORY",TIUCT="I":"IN HOSPITAL",TIUCT="H":"HOSPITALIZATION",TIUCT="T":"TELEPHONE",1:"EVENT (HISTORICAL)")
"RTN","TIULV",93,0)
 I TIUCT="E",+$G(TIUVSTR)'>0 Q
"RTN","TIULV",94,0)
 S TIUY("LVL")=$G(TIUY("LVL"))
"RTN","TIULV",95,0)
 S TIUY("ELG")=$G(VAEL(1))
"RTN","TIULV",96,0)
 S TIUY("VLOC")=+$G(TIUVSTR)_U_$P($G(^SC(+$G(TIUVSTR),0)),U)
"RTN","TIULV",97,0)
 I $G(TIUY("LOC"))']"" S TIUY("LOC")=$S($L($G(TIUD12)):$P($G(TIUD12),U,5),+$G(TIUDA):+$P($G(^TIU(8925,+$G(TIUDA),12)),U,5),1:+TIUY("VLOC"))
"RTN","TIULV",98,0)
 S:$P(TIUY("LOC"),U,2)']"" TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",99,0)
 I '$D(TIUY("DIV")),+$G(TIUY("LOC")) D
"RTN","TIULV",100,0)
 . N TIUDIV,DIC,DR,DA,DIQ,X,Y
"RTN","TIULV",101,0)
 . S DIC=44,DIQ="TIUDIV",DIQ(0)="IE",DA=+TIUY("LOC"),DR="3.5" D EN^DIQ1
"RTN","TIULV",102,0)
 . I '+$G(TIUDIV(44,+DA,3.5,"I")) Q
"RTN","TIULV",103,0)
 . S TIUY("DIV")=TIUDIV(44,+DA,3.5,"I")_U_TIUDIV(44,+DA,3.5,"E")
"RTN","TIULV",104,0)
 I '$D(TIUY("DIV")),'+$G(TIUY("LOC")) D
"RTN","TIULV",105,0)
 . S TIUY("DIV")=+$O(^DG(40.8,"AD",+$G(DUZ(2)),0))
"RTN","TIULV",106,0)
 . S TIUY("DIV")=+TIUY("DIV")_U_$P($G(^DG(40.8,+$G(TIUY("DIV")),0)),U)
"RTN","TIULV",107,0)
 S TIUY("INS")=$G(TIUY("DIV"))
"RTN","TIULV",108,0)
 S TIUY("SC")=$G(TIUY("SC"))
"RTN","TIULV",109,0)
 Q
"RTN","TIULV",110,0)
CURRENT(TIUY,DFN) ; Get current INPATIENT data
"RTN","TIULV",111,0)
 N VAIN D INP^VADPT
"RTN","TIULV",112,0)
 S TIUY("AD#")=$G(VAIN(1)),TIUY("PMD")=$G(VAIN(2))
"RTN","TIULV",113,0)
 S TIUY("TS")=$G(VAIN(3)),TIUY("WARD")=$G(VAIN(4),"0^OUTPATIENT")
"RTN","TIULV",114,0)
 S TIUY("RB")=$G(VAIN(5))
"RTN","TIULV",115,0)
 I +TIUY("WARD") D
"RTN","TIULV",116,0)
 . N DIC,DIQ,DR,DA,TIUDIV,Y
"RTN","TIULV",117,0)
 . S DIC=42,DA=+TIUY("WARD"),DIQ="TIUDIV(",DIQ(0)="IE",DR=".015;44"
"RTN","TIULV",118,0)
 . D EN^DIQ1
"RTN","TIULV",119,0)
 . S TIUY("DIV")=$G(TIUDIV(42,DA,.015,"I"))_U_$G(TIUDIV(42,DA,.015,"E"))
"RTN","TIULV",120,0)
 . S TIUY("LOC")=$G(TIUDIV(42,DA,44,"I"))_U_$G(TIUDIV(42,DA,44,"E"))
"RTN","TIULV",121,0)
 S TIUY("LOC")=$G(TIUY("LOC"))
"RTN","TIULV",122,0)
 I '+$G(TIUY("DIV")) D
"RTN","TIULV",123,0)
 . N DIC,DIQ,DR,DA
"RTN","TIULV",124,0)
 . S DIC=4,DR=".01",DA=+$G(DUZ(2)),DIQ="TIUDIV1"
"RTN","TIULV",125,0)
 . D EN^DIQ1
"RTN","TIULV",126,0)
 . S TIUY("DIV")=+$G(DUZ(2))_U_TIUDIV1(4,DUZ(2),.01)
"RTN","TIULV",127,0)
 Q
"RTN","TIURS1")
0^4^B70406854
"RTN","TIURS1",1,0)
TIURS1 ; SLC/JER - Additional /es/ actions ;12/17/02
"RTN","TIURS1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,36,58,100,109,142,156**;Jun 20, 1997
"RTN","TIURS1",3,0)
 ;12/11/00 Moved ELSIG,MULTIPRN,LIST here from TIURS
"RTN","TIURS1",4,0)
ELSIG ; Sign rec
"RTN","TIURS1",5,0)
 N TIULST,TIUSLST,TIURJCT,TIUES,TIUI,X,X1,Y,TIUDAARY,TIUCHNG
"RTN","TIURS1",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS1",7,0)
 I $P(TIUPRM0,U,2)'>0 W !,"Electronic signature not yet enabled." H 3 G ELSIGX
"RTN","TIURS1",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",9,0)
 S TIUI=0 I $D(VALMY)>9 D CLEAR^VALM1
"RTN","TIURS1",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",11,0)
 . N TIU0,TIU12,TIUSTAT,TIUEVNT,TIUTYPE,TIUPOP,TIU15,TIUDPRM
"RTN","TIURS1",12,0)
 . N ASK,SIGNER,COSIGNER,XTRASGNR,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURS1",13,0)
 . S (ASK,TIUPOP)=0
"RTN","TIURS1",14,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",15,0)
 . S TIUDA=$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",16,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",17,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",18,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",19,0)
 . S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS1",20,0)
 . S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS1",21,0)
 . S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS1",22,0)
 . I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS1",23,0)
 . S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS1",24,0)
 . S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS1",25,0)
 . S TIUEVNT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS1",26,0)
 . D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS1",27,0)
 . S ASK=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS1",28,0)
 . I +ASK>0 D
"RTN","TIURS1",29,0)
 . . L +^TIU(8925,+TIUDA):1
"RTN","TIURS1",30,0)
 . . E  S ASK="0^ Another user is editing this entry."
"RTN","TIURS1",31,0)
 . I +ASK'>0,$P(ASK,U,2)]"" D  I 1
"RTN","TIURS1",32,0)
 . . D FULL^VALM1
"RTN","TIURS1",33,0)
 . . W !!,"Item #",TIUI,": ",$P(ASK,U,2),! K VALMY(TIUI)
"RTN","TIURS1",34,0)
 . . W !,"Removed from signature list.",!
"RTN","TIURS1",35,0)
 . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",36,0)
 . E  D
"RTN","TIURS1",37,0)
 . . ;If document is a clinical procedures title, check if clinical
"RTN","TIURS1",38,0)
 . . ;procedure fields are required.  If the fields are required, prompt for
"RTN","TIURS1",39,0)
 . . ;them and don't permit the user to sign unless the fields are defined.
"RTN","TIURS1",40,0)
 . . I +$$ISA^TIULX(+TIU0,+$$CLASS^TIUCP),$$REQCPF^TIULP(+$P($G(^TIU(8925,+TIUDA,14)),U,5)) D  Q:+TIUPOP
"RTN","TIURS1",41,0)
 . . . N TIUCPFLD
"RTN","TIURS1",42,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",43,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need Procedure Summary Code and Date/Time Performed..."
"RTN","TIURS1",44,0)
 . . . I $G(^TIU(8925,+TIUDA,702)),$P(^(702),U)]"",$P(^(702),U,2)]"" S TIUCPFLD=1 Q
"RTN","TIURS1",45,0)
 . . . S TIUCPFLD=$$ASKCPF^TIURS(TIUDA)
"RTN","TIURS1",46,0)
 . . . I +TIUCPFLD'>0 D
"RTN","TIURS1",47,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",48,0)
 . . . . W !!,"Item #",TIUI,": MUST have a Procedure Summary Code and Date/Time Performed",!,"before you may sign."
"RTN","TIURS1",49,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",50,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",51,0)
 . . I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,DUZ):1,+$P(TIU15,U,6):1,1:0),(+$P(TIU12,U,8)'>0) D  Q:+TIUPOP
"RTN","TIURS1",52,0)
 . . . N COSIGNER
"RTN","TIURS1",53,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",54,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need cosignature..."
"RTN","TIURS1",55,0)
 . . . S COSIGNER=$$ASKCSNR^TIURS(TIUDA,DUZ)
"RTN","TIURS1",56,0)
 . . . I +COSIGNER'>0 D
"RTN","TIURS1",57,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",58,0)
 . . . . W !!,"Item #",TIUI,": MUST have a cosigner, before you may sign."
"RTN","TIURS1",59,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",60,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",61,0)
 . . N TIU,TIUY
"RTN","TIURS1",62,0)
 . . D EN^VALM("TIU SIGN/COSIGN")
"RTN","TIURS1",63,0)
 I $D(TIUSLST)'>9 D  G ELSIGX
"RTN","TIURS1",64,0)
 . S VALMSG="** Signature List Empty...Nothing signed. **"
"RTN","TIURS1",65,0)
 I $D(TIUSLST)>9 D
"RTN","TIURS1",66,0)
 . N TIUIO
"RTN","TIURS1",67,0)
 . S TIUES=$$ASKSIG^TIULA1
"RTN","TIURS1",68,0)
 . I '+TIUES S VALMSG="** Nothing Signed. **" D FIXLSTNW^TIULM Q
"RTN","TIURS1",69,0)
 . D FULL^VALM1
"RTN","TIURS1",70,0)
 . D MULTIPRN(.TIUSLST,.TIUIO)
"RTN","TIURS1",71,0)
 . S TIUI=0 F  S TIUI=$O(TIUSLST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",72,0)
 . . N TIUPY,XTRASGNR
"RTN","TIURS1",73,0)
 . . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI)),TIUDA=$P(TIUDATA,U,2)
"RTN","TIURS1",74,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",75,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",76,0)
 . . S XTRASGNR=+$P(TIUSLST(TIUI),U,3)
"RTN","TIURS1",77,0)
 . . I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS1",78,0)
 . . I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIURS1",79,0)
 . . I +TIUSLST(TIUI),(TIUIO]"") D RPC^TIUPD(.TIUPY,TIUDA,TIUIO,$P(TIUSLST(TIUI),U,2))
"RTN","TIURS1",80,0)
 . D FULL^VALM1
"RTN","TIURS1",81,0)
ELSIGX I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURS1",82,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURS1",83,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",84,0)
 S VALMBCK="R"
"RTN","TIURS1",85,0)
 D VMSG($G(TIULST),.TIUDAARY,"signed")
"RTN","TIURS1",86,0)
 Q
"RTN","TIURS1",87,0)
VMSG(TIULST,TIUDAARY,ACTION) ; Set VALMSG for messagebar, bold changed items
"RTN","TIURS1",88,0)
 N TIUI,LINENO,ACTFIRST
"RTN","TIURS1",89,0)
 S ACTFIRST=$S(ACTION="Encounter Data Edited":1,ACTION="Signers identified/edited":1,ACTION="Title changed":1,1:0)
"RTN","TIURS1",90,0)
 I TIULST']"" D  Q
"RTN","TIURS1",91,0)
 . I ACTFIRST S VALMSG="** No changes made. **" Q
"RTN","TIURS1",92,0)
 . S VALMSG="** Nothing "_ACTION_". **"
"RTN","TIURS1",93,0)
 I ACTION="copied" S ACTION="copied; See end of list"
"RTN","TIURS1",94,0)
 S TIULST=$$NEWLST(TIULST,.TIUDAARY)
"RTN","TIURS1",95,0)
 I TIULST]"" D
"RTN","TIURS1",96,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",97,0)
 . . S VALMSG="** "_ACTION_" for item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_". **"
"RTN","TIURS1",98,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_". **"
"RTN","TIURS1",99,0)
 I TIULST']"" D
"RTN","TIURS1",100,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",101,0)
 . . S VALMSG="** "_ACTION_"; item(s) no longer in list. **"
"RTN","TIURS1",102,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_", no longer in list. **"
"RTN","TIURS1",103,0)
 . ;S VALMSG="** Item(s) "_ACTION_", no longer in list. **"
"RTN","TIURS1",104,0)
 Q:$G(^TMP("TIUR",$J,"RTN"))="TIUROR"
"RTN","TIURS1",105,0)
 F TIUI=1:1 S LINENO=$P(TIULST,", ",TIUI) Q:'LINENO  D
"RTN","TIURS1",106,0)
 . D CNTRL^VALM10(LINENO,1,$G(VALM("RM")),IOINHI,IOINORM)
"RTN","TIURS1",107,0)
 Q
"RTN","TIURS1",108,0)
NEWLST(TIULST,TIUDAARY) ; Return TIULST with updated item numbers
"RTN","TIURS1",109,0)
 N TIUI,TIULNO,TIUDA,TIUNLNO,TIUNLST
"RTN","TIURS1",110,0)
 S TIUNLST=""
"RTN","TIURS1",111,0)
 F TIUI=1:1 S TIULNO=$P(TIULST,",",TIUI) Q:'TIULNO  D
"RTN","TIURS1",112,0)
 . S TIUDA=TIUDAARY(TIULNO),TIUNLNO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIURS1",113,0)
 . I TIUNLNO S TIUNLST=$G(TIUNLST)_$S($G(TIUNLST)]"":", ",1:"")_TIUNLNO
"RTN","TIURS1",114,0)
 Q TIUNLST
"RTN","TIURS1",115,0)
 ;
"RTN","TIURS1",116,0)
MULTIPRN(TIUSLST,TIUIO) ; ask device
"RTN","TIURS1",117,0)
 N TIUI,TIUASK,TIUION,TIUPOK,IO,TIUPLIST,TIUSCRN S (TIUI,TIUPOK)=0
"RTN","TIURS1",118,0)
 F  S TIUI=$O(TIUSLST(TIUI)) Q:TIUI'>0!+TIUPOK  S:+TIUSLST(TIUI) TIUPOK=1
"RTN","TIURS1",119,0)
 I '+TIUPOK S TIUIO="" Q
"RTN","TIURS1",120,0)
 S TIUPLIST=$$LIST(.TIUSLST)
"RTN","TIURS1",121,0)
 W !!,"Please specify the device for printing item"
"RTN","TIURS1",122,0)
 W $S(TIUPLIST[",":"s",TIUPLIST["-":"s",1:""),": ",TIUPLIST,!!
"RTN","TIURS1",123,0)
 S TIUSCRN="I $L($G(^%ZIS(1,+Y,""TYPE""))),("";HFS;MT;BAR;VTRM;RES;CHAN;IMPC;""'[("";""_^(""TYPE"")_"";""))"
"RTN","TIURS1",124,0)
 S TIUION=$$DEVICE^TIUDEV(.TIUIO,"LAST","N",TIUSCRN,"Q")
"RTN","TIURS1",125,0)
 I '$L(TIUION) S TIUIO=""
"RTN","TIURS1",126,0)
 D ^%ZISC
"RTN","TIURS1",127,0)
 Q
"RTN","TIURS1",128,0)
LIST(LIST) ; build print list
"RTN","TIURS1",129,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIURS1",130,0)
 F  S TIUI=$O(LIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",131,0)
 . S:+LIST(TIUI) TIUY=$G(TIUY)_$S($G(TIUY)]"":", ",1:"")_TIUI
"RTN","TIURS1",132,0)
 Q $G(TIUY)
"RTN","TIURS1",133,0)
 ;
"RTN","TIURS1",134,0)
ADDSIG(TIUDA,DA) ; Apply extra signatures to a document
"RTN","TIURS1",135,0)
 N DIE,DR
"RTN","TIURS1",136,0)
 S DIE=8925.7
"RTN","TIURS1",137,0)
 S DR=".04////"_$$NOW^TIULC_";.05////"_DUZ_";.06///^S X=$$SIGNAME^TIULS("_DUZ_");.07///^S X=$$SIGTITL^TIULS("_DUZ_");.08////E"
"RTN","TIURS1",138,0)
 D ^DIE
"RTN","TIURS1",139,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURS1",140,0)
 Q
"RTN","TIURS1",141,0)
CNVPOST ; Change Titles/Convert Postings
"RTN","TIURS1",142,0)
 N TIUI,TIULST,Y,TIUVIEW,TIUCHNG,TIUDAARY
"RTN","TIURS1",143,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinary note before changing title.",! H 3 Q
"RTN","TIURS1",144,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",145,0)
 S TIUI=0
"RTN","TIURS1",146,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURS1",147,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURS1",148,0)
 . N TIU,TIUDA,DFN,TIUDATA,VALMY,XQORM,TIUVIEW,RSTRCTD
"RTN","TIURS1",149,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",150,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",151,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",152,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",153,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",154,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURS1",155,0)
 . I +TIUVIEW'>0 D  Q  ; Exclude records user can't view
"RTN","TIURS1",156,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),! ; Echo denial message
"RTN","TIURS1",157,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",158,0)
 . S TIUCHNG=0
"RTN","TIURS1",159,0)
 . D EN^VALM("TIU CHANGE TITLE")
"RTN","TIURS1",160,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",161,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",162,0)
 ; -- Update list: --
"RTN","TIURS1",163,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURS1",164,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",165,0)
 S VALMBCK="R"
"RTN","TIURS1",166,0)
 D VMSG($G(TIULST),.TIUDAARY,"Title changed")
"RTN","TIURS1",167,0)
 Q
"RTN","TIURS1",168,0)
CNVPOST1 ; Convert Single Posting to another title
"RTN","TIURS1",169,0)
 N TIUD0,DIE,DR,TIUTITL,CHKSUM,TIUCHTTL,TIUCLSS,TIUCON
"RTN","TIURS1",170,0)
 ; Added TIUCON for **142
"RTN","TIURS1",171,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUCHNG=0
"RTN","TIURS1",172,0)
 ; Added TIUNOCS for **142
"RTN","TIURS1",173,0)
 D FULL^VALM1
"RTN","TIURS1",174,0)
 I +TIUD0=81 S TIUCHTTL="0^You may not change the TITLE of an ADDENDUM."
"RTN","TIURS1",175,0)
 I '$D(TIUCHTTL) S TIUCHTTL=$$CANDO^TIULP(TIUDA,"CHANGE TITLE")
"RTN","TIURS1",176,0)
 I +TIUCHTTL,$$DADORKID^TIUGBR(TIUDA) S TIUCHTTL="0^Interdisciplinary entries must be detached before changing titles." ;**100
"RTN","TIURS1",177,0)
 I +TIUCHTTL'>0 D  Q
"RTN","TIURS1",178,0)
 . W !!,$C(7),$P(TIUCHTTL,U,2),! ; Echo denial
"RTN","TIURS1",179,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",180,0)
 L +^TIU(8925,TIUDA,0):1
"RTN","TIURS1",181,0)
 E  D  Q
"RTN","TIURS1",182,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! ; Echo denial
"RTN","TIURS1",183,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",184,0)
 S TIUTITL=$$ASKTITLE^TIULA3(+$$CLINDOC^TIULC1(+TIUD0,TIUDA),+TIUD0)
"RTN","TIURS1",185,0)
 S TIUCLSS=$$CLASS^TIUCNSLT()
"RTN","TIURS1",186,0)
 S TIUCON=+$$ISA^TIULX(TIUTITL,TIUCLSS)
"RTN","TIURS1",187,0)
 I TIUCON=1,+TIUD0'=TIUTITL D CHANGE^TIUCNSLT(TIUDA,"",.TIUNOCS)
"RTN","TIURS1",188,0)
 I $G(TIUNOCS)=-1 D  Q
"RTN","TIURS1",189,0)
 . K TIUNOCS
"RTN","TIURS1",190,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")  ; **142
"RTN","TIURS1",191,0)
 S DIE=8925,DA=TIUDA
"RTN","TIURS1",192,0)
 S DR=".01////^S X="_TIUTITL_";.04////^S X="_$$DOCCLASS^TIULC1(TIUTITL)
"RTN","TIURS1",193,0)
 D ^DIE
"RTN","TIURS1",194,0)
 I +$G(^TIU(8925,+TIUDA,0))'=+TIUD0 S TIUCHNG=1
"RTN","TIURS1",195,0)
 S CHKSUM=+$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")")
"RTN","TIURS1",196,0)
 D AUDIT^TIUEDI1(TIUDA,CHKSUM,CHKSUM)
"RTN","TIURS1",197,0)
 L -^TIU(8925,TIUDA,0)
"RTN","TIURS1",198,0)
 K TIUNOCS
"RTN","TIURS1",199,0)
 Q
"VER")
8.0^22.0
**END**
**END**
