Released GMTS*2.7*78 SEQ #72
Extracted from mail message
**KIDS**:GMTS*2.7*78^

**INSTALL NAME**
GMTS*2.7*78
"BLD",6322,0)
GMTS*2.7*78^HEALTH SUMMARY^0^3060120^y
"BLD",6322,1,0)
^^3^3^3060110^
"BLD",6322,1,1,0)
This patch adds a new Vitals API call to several Vital Signs Health
"BLD",6322,1,2,0)
Summary Components.  It also adds a new Outpatient Pharmacy API call to 
"BLD",6322,1,3,0)
an Outpatient Pharmacy Health Summary Component.
"BLD",6322,4,0)
^9.64PA^^0
"BLD",6322,"INID")
^n
"BLD",6322,"INIT")
POST^GMTSP78
"BLD",6322,"KRN",0)
^9.67PA^8989.52^19
"BLD",6322,"KRN",.4,0)
.4
"BLD",6322,"KRN",.401,0)
.401
"BLD",6322,"KRN",.402,0)
.402
"BLD",6322,"KRN",.403,0)
.403
"BLD",6322,"KRN",.5,0)
.5
"BLD",6322,"KRN",.84,0)
.84
"BLD",6322,"KRN",3.6,0)
3.6
"BLD",6322,"KRN",3.8,0)
3.8
"BLD",6322,"KRN",9.2,0)
9.2
"BLD",6322,"KRN",9.8,0)
9.8
"BLD",6322,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6322,"KRN",9.8,"NM",1,0)
GMTSVS^^0^B40018918
"BLD",6322,"KRN",9.8,"NM",2,0)
GMTSVSD^^0^B58460028
"BLD",6322,"KRN",9.8,"NM",3,0)
GMTSVSS^^0^B43514605
"BLD",6322,"KRN",9.8,"NM",4,0)
GMTSPSO^^0^B11904487
"BLD",6322,"KRN",9.8,"NM",5,0)
GMTSPSO7^^0^B9519932
"BLD",6322,"KRN",9.8,"NM","B","GMTSPSO",4)

"BLD",6322,"KRN",9.8,"NM","B","GMTSPSO7",5)

"BLD",6322,"KRN",9.8,"NM","B","GMTSVS",1)

"BLD",6322,"KRN",9.8,"NM","B","GMTSVSD",2)

"BLD",6322,"KRN",9.8,"NM","B","GMTSVSS",3)

"BLD",6322,"KRN",19,0)
19
"BLD",6322,"KRN",19.1,0)
19.1
"BLD",6322,"KRN",101,0)
101
"BLD",6322,"KRN",409.61,0)
409.61
"BLD",6322,"KRN",771,0)
771
"BLD",6322,"KRN",870,0)
870
"BLD",6322,"KRN",8989.51,0)
8989.51
"BLD",6322,"KRN",8989.52,0)
8989.52
"BLD",6322,"KRN",8994,0)
8994
"BLD",6322,"KRN","B",.4,.4)

"BLD",6322,"KRN","B",.401,.401)

"BLD",6322,"KRN","B",.402,.402)

"BLD",6322,"KRN","B",.403,.403)

"BLD",6322,"KRN","B",.5,.5)

"BLD",6322,"KRN","B",.84,.84)

"BLD",6322,"KRN","B",3.6,3.6)

"BLD",6322,"KRN","B",3.8,3.8)

"BLD",6322,"KRN","B",9.2,9.2)

"BLD",6322,"KRN","B",9.8,9.8)

"BLD",6322,"KRN","B",19,19)

"BLD",6322,"KRN","B",19.1,19.1)

"BLD",6322,"KRN","B",101,101)

"BLD",6322,"KRN","B",409.61,409.61)

"BLD",6322,"KRN","B",771,771)

"BLD",6322,"KRN","B",870,870)

"BLD",6322,"KRN","B",8989.51,8989.51)

"BLD",6322,"KRN","B",8989.52,8989.52)

"BLD",6322,"KRN","B",8994,8994)

"BLD",6322,"QUES",0)
^9.62^^
"BLD",6322,"REQB",0)
^9.611^3^3
"BLD",6322,"REQB",1,0)
GMTS*2.7*58^1
"BLD",6322,"REQB",2,0)
GMRV*5.0*3^1
"BLD",6322,"REQB",3,0)
GMTS*2.7*56^1
"BLD",6322,"REQB","B","GMRV*5.0*3",2)

"BLD",6322,"REQB","B","GMTS*2.7*56",3)

"BLD",6322,"REQB","B","GMTS*2.7*58",1)

"INIT")
POST^GMTSP78
"MBREQ")
0
"PKG",229,-1)
1^1
"PKG",229,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",229,22,0)
^9.49I^1^1
"PKG",229,22,1,0)
2.7^2951020^2960805
"PKG",229,22,1,"PAH",1,0)
78^3060120
"PKG",229,22,1,"PAH",1,1,0)
^^3^3^3060120
"PKG",229,22,1,"PAH",1,1,1,0)
This patch adds a new Vitals API call to several Vital Signs Health
"PKG",229,22,1,"PAH",1,1,2,0)
Summary Components.  It also adds a new Outpatient Pharmacy API call to 
"PKG",229,22,1,"PAH",1,1,3,0)
an Outpatient Pharmacy Health Summary Component.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMTSP78")
0^^B9240012
"RTN","GMTSP78",1,0)
GMTSP78 ;ISP/TDP - PRE/POST INSTALL FOR GMTS*2.7*78; 8/25/2005
"RTN","GMTSP78",2,0)
 ;;2.7;Health Summary;**78**;Oct 20, 1995
"RTN","GMTSP78",3,0)
 Q
"RTN","GMTSP78",4,0)
 ;
"RTN","GMTSP78",5,0)
POST ; Start of Post-init for patch GMTS*2.7*78
"RTN","GMTSP78",6,0)
 N %
"RTN","GMTSP78",7,0)
 S %=$$NEWCP^XPDUTL("POST1","POST1^GMTSP78")
"RTN","GMTSP78",8,0)
 Q
"RTN","GMTSP78",9,0)
POST1 ;
"RTN","GMTSP78",10,0)
 D BMES^XPDUTL("Starting Post-init...")
"RTN","GMTSP78",11,0)
 D SEARCH
"RTN","GMTSP78",12,0)
 D BMES^XPDUTL("Post-init complete.")
"RTN","GMTSP78",13,0)
 Q
"RTN","GMTSP78",14,0)
 ;
"RTN","GMTSP78",15,0)
SEARCH ; Search EXTERNAL/EXTRACT ROUTINE (#1.1) field of the HEALTH SUMMARY
"RTN","GMTSP78",16,0)
 ; COMPONENT (#142.1) file for EN1;GMRVUT0 and replace with EN1;GMVHS.
"RTN","GMTSP78",17,0)
 N CNT,DA,DIC,DIE,DO,DR,GMTSCHG,GMTSEXRT,GMTSIEN,GMTSRTN,GMTSVARY,GMTSVITL,X,Y
"RTN","GMTSP78",18,0)
 S GMTSRTN="EN1;GMVHS"
"RTN","GMTSP78",19,0)
 S GMTSVARY="VITAL SIGNS^VITAL SIGNS DETAILED DISPLAY^VITAL SIGNS OUTPATIENT^VITAL SIGNS SELECTED^VITAL SIGNS SELECTED OUTPAT."
"RTN","GMTSP78",20,0)
 F CNT=1:1:5 S GMTSVITL=$P(GMTSVARY,"^",CNT) D
"RTN","GMTSP78",21,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142.1,"B",GMTSVITL,GMTSIEN)) Q:GMTSIEN=""  D
"RTN","GMTSP78",22,0)
 .. S GMTSCHG=0
"RTN","GMTSP78",23,0)
 .. I $O(^GMT(142.1,GMTSIEN,.1,"B",GMTSRTN,0)) D  Q
"RTN","GMTSP78",24,0)
 ... D BMES^XPDUTL(">>> EXTERNAL/EXTRACT ROUTINE FOR "_GMTSVITL_" HEALTH"),MES^XPDUTL(">>> SUMMARY COMPONENT ALREADY CONTAINS EN1;GMVHS.  NO CHANGES MADE.")
"RTN","GMTSP78",25,0)
 .. S GMTSEXRT=$O(^GMT(142.1,GMTSIEN,.1,"B","EN1;GMRVUT0",0))
"RTN","GMTSP78",26,0)
 .. I GMTSEXRT'="" D
"RTN","GMTSP78",27,0)
 ... S DIE="^GMT(142.1,"_GMTSIEN_",.1,",DA=GMTSEXRT,DA(1)=GMTSIEN,DR=".01////@"
"RTN","GMTSP78",28,0)
 ... D ^DIE K DIE,DA,DR
"RTN","GMTSP78",29,0)
 ... S GMTSCHG=1
"RTN","GMTSP78",30,0)
 .. K DO
"RTN","GMTSP78",31,0)
 .. S DA=+$P($G(^GMT(142.1,GMTSIEN,.1,0)),U,3)+1,DA(1)=GMTSIEN
"RTN","GMTSP78",32,0)
 .. S DIC="^GMT(142.1,GMTSIEN,.1,",DIC(0)="L",X=GMTSRTN
"RTN","GMTSP78",33,0)
 .. D FILE^DICN
"RTN","GMTSP78",34,0)
 .. I GMTSCHG=0 D
"RTN","GMTSP78",35,0)
 ... I Y=-1 D BMES^XPDUTL(">>> ERROR TRYING TO ADD EXTERNAL/EXTRACT ROUTINE OF EN1;GMVHS TO"),MES^XPDUTL(">>> "_GMTSVITL_" HEALTH SUMMARY COMPONENT.")
"RTN","GMTSP78",36,0)
 ... I Y>0 D BMES^XPDUTL(">>> EXTERNAL/EXTRACT ROUTINE OF EN1;GMVHS HAS BEEN ADDED TO"),MES^XPDUTL(">>> "_GMTSVITL_" HEALTH SUMMARY COMPONENT.")
"RTN","GMTSP78",37,0)
 .. I GMTSCHG=1 D
"RTN","GMTSP78",38,0)
 ... I Y=-1 D BMES^XPDUTL(">>> ERROR TRYING TO CHANGE EXTERNAL/EXTRACT ROUTINE FROM EN1;GMRVUT0"),MES^XPDUTL(">>> TO EN1;GMVHS FOR "_GMTSVITL_" HEALTH SUMMARY COMPONENT.")
"RTN","GMTSP78",39,0)
 ... I Y>0 D BMES^XPDUTL(">>> CHANGED EXTERNAL/EXTRACT ROUTINE FROM EN1;GMRVUT0 TO EN1;GMVHS FOR"),MES^XPDUTL(">>> "_GMTSVITL_" HEALTH SUMMARY COMPONENT.")
"RTN","GMTSP78",40,0)
 .. K DA,DIC,X,Y
"RTN","GMTSP78",41,0)
 Q
"RTN","GMTSPSO")
0^4^B11904487^B10468590
"RTN","GMTSPSO",1,0)
GMTSPSO ; SLC/JER,KER/NDBI - OP Rx Summary Component (V6) ; 08/27/2002
"RTN","GMTSPSO",2,0)
 ;;2.7;Health Summary;**15,28,37,56,78**;Oct 20, 1995
"RTN","GMTSPSO",3,0)
 ;
"RTN","GMTSPSO",4,0)
 ; External References
"RTN","GMTSPSO",5,0)
 ;   DBIA  10141  $$VERSION^XPDUTL
"RTN","GMTSPSO",6,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",7,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",8,0)
 ;   DBIA    330  ^PSOHCSUM, ACS^PSOHCSUM
"RTN","GMTSPSO",9,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO",10,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO",11,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO",12,0)
 ;                    
"RTN","GMTSPSO",13,0)
MAIN ; OP Rx HS Comp
"RTN","GMTSPSO",14,0)
 ;   Check for version 7 (or greater)   MAIN^GMTSPSO7
"RTN","GMTSPSO",15,0)
 I $$VERSION^XPDUTL("PSO")'<7 G MAIN^GMTSPSO7
"RTN","GMTSPSO",16,0)
 ;   If not version 7                   MAIN^GMTSPSO
"RTN","GMTSPSO",17,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO",18,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO",19,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO",20,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",21,0)
 D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN)
"RTN","GMTSPSO",22,0)
 I '$D(^PS(55,DFN,"P")),'$D(^("ARC")),'$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",23,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO",24,0)
 I $L($T(ACS^PSOHCSUM))>0 D ACS^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",25,0)
 I $L($T(ACS^PSOHCSUM))'>0 D ^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",26,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO",27,0)
 S (GMX,GMTOP,IX)=0
"RTN","GMTSPSO",28,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO",29,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO",30,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",31,0)
 Q
"RTN","GMTSPSO",32,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO",33,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO",34,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO",35,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO",36,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO",37,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO",38,0)
 S MI=$G(^TMP("PSOO",$J,IX,1)),NL=0 I $L(MI)>73 D PARSE
"RTN","GMTSPSO",39,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",41,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO",42,0)
 W !,?18,$P(GMR,U,6),?31,$S($P($P(GMR,U,5),";")="S":"ACTIVE/SUSP",1:$P($P(GMR,U,5),";",2)),?45,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO",43,0)
 S GMX=1 I 'NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,"SIG: ",MI,! S GMTOP=0
"RTN","GMTSPSO",44,0)
 F GMI=1:1:NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W:GMI=1 ?2,"SIG: " W ?7,MI(GMI),! S GMTOP=0
"RTN","GMTSPSO",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO",46,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO",47,0)
 W ! S GMTOP=0
"RTN","GMTSPSO",48,0)
 Q
"RTN","GMTSPSO",49,0)
PARSE ; Parses Medication Instructions
"RTN","GMTSPSO",50,0)
 N GMI,NW,WPL
"RTN","GMTSPSO",51,0)
 S NL=$S(($L(MI)/73)>($L(MI)\73):($L(MI)\73)+1,1:$L(MI)\73)
"RTN","GMTSPSO",52,0)
 S NW=$L(MI," "),WPL=$S((NW/NL)>(NW\NL):(NW\NL)+1,1:NW\NL)
"RTN","GMTSPSO",53,0)
 F GMI=1:1:NL S MI(GMI)=$P(MI," ",(GMI-1)*WPL+1,GMI*WPL)
"RTN","GMTSPSO",54,0)
 Q
"RTN","GMTSPSO",55,0)
HEAD ; Prints Header
"RTN","GMTSPSO",56,0)
 S GMTOP=1
"RTN","GMTSPSO",57,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",60,0)
 W ?18,"Rx #",?31,"Stat",?45,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO",61,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO",62,0)
 Q
"RTN","GMTSPSO7")
0^5^B9519932^B8701124
"RTN","GMTSPSO7",1,0)
GMTSPSO7 ; SLC/JER/KER - OP Rx Summary Component (V7) ; 08/27/2002
"RTN","GMTSPSO7",2,0)
 ;;2.7;Health Summary;**15,28,37,56,78**;Oct 20, 1995
"RTN","GMTSPSO7",3,0)
 ;
"RTN","GMTSPSO7",4,0)
 ; External References
"RTN","GMTSPSO7",5,0)
 ;   DBIA    330  ^PSOHCSUM, ACS^PSOHCSUM
"RTN","GMTSPSO7",6,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO7",7,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO7",8,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO7",9,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSPSO7",10,0)
 ;                      
"RTN","GMTSPSO7",11,0)
MAIN ; OP Rx HS Component
"RTN","GMTSPSO7",12,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO7",13,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO7",14,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO7",15,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO7",16,0)
 I '$D(^PS(55,DFN,"P")),'$D(^("ARC")) Q
"RTN","GMTSPSO7",17,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO7",18,0)
 I $L($T(ACS^PSOHCSUM))>0 D ACS^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",19,0)
 I $L($T(ACS^PSOHCSUM))'>0 D ^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",20,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO7",21,0)
 S (GMTOP,GMX,IX)=0
"RTN","GMTSPSO7",22,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO7",23,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO7",24,0)
 K ^TMP("PSOO",$J),^UTILITY($J,"W")
"RTN","GMTSPSO7",25,0)
 Q
"RTN","GMTSPSO7",26,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO7",27,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,DIWL,DIWR,DIWF,GMSIG,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO7",28,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO7",29,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO7",30,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO7",31,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO7",32,0)
 S NL=0,DIWL=1,DIWR=73,DIWF="" K ^UTILITY($J,"W")
"RTN","GMTSPSO7",33,0)
 F  S NL=$O(^TMP("PSOO",$J,IX,NL)) Q:NL'>0  D
"RTN","GMTSPSO7",34,0)
 . S X=$G(^TMP("PSOO",$J,IX,NL,0)) D ^DIWP
"RTN","GMTSPSO7",35,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO7",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",37,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO7",38,0)
 W !,?18,$P(GMR,U,6),?31,$S($G(GMR)["SUSPENDED":"ACTIVE/SUSP",1:$P($P(GMR,U,5),";",2)),?45,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO7",39,0)
 S GMX=1,GMI=0,GMSIG=1
"RTN","GMTSPSO7",40,0)
 F  S GMI=$O(^UTILITY($J,"W",DIWL,GMI)) Q:GMI'>0!$D(GMTSQIT)  D
"RTN","GMTSPSO7",41,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSO7",42,0)
 . S MI=$G(^UTILITY($J,"W",DIWL,GMI,0))
"RTN","GMTSPSO7",43,0)
 . W:GMSIG=1 ?2,"SIG: " S:GMSIG=1 GMSIG=0 W ?7,MI,! S GMTOP=0
"RTN","GMTSPSO7",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO7",45,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO7",46,0)
 W ! S GMTOP=0
"RTN","GMTSPSO7",47,0)
 Q
"RTN","GMTSPSO7",48,0)
HEAD ; Prints Header
"RTN","GMTSPSO7",49,0)
 ;   Only write the next line when there is data
"RTN","GMTSPSO7",50,0)
 S GMTOP=1
"RTN","GMTSPSO7",51,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO7",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO7",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",54,0)
 W ?18,"Rx #",?31,"Stat",?45,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO7",55,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO7",56,0)
 Q
"RTN","GMTSVS")
0^1^B40018918^B32837615
"RTN","GMTSVS",1,0)
GMTSVS ; SLC/KER - Vital Signs Component          ; 02/27/2002
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49,78**;Oct 20, 1995
"RTN","GMTSVS",3,0)
 ;                          
"RTN","GMTSVS",4,0)
 ; External References
"RTN","GMTSVS",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVS",7,0)
 ;                    
"RTN","GMTSVS",8,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVS",9,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVS",10,0)
 ;                          
"RTN","GMTSVS",11,0)
OUTPAT ; Outpatient Vital Signs Main Control
"RTN","GMTSVS",12,0)
 N GMRVSTR
"RTN","GMTSVS",13,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",14,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",15,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",16,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",17,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",18,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",19,0)
 ;D EN1^GMRVUT0
"RTN","GMTSVS",20,0)
 D EN1^GMVHS
"RTN","GMTSVS",21,0)
 ; If no data, display message and get
"RTN","GMTSVS",22,0)
 ; most recent inpatient measurements
"RTN","GMTSVS",23,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!!
"RTN","GMTSVS",25,0)
 . S CNTR=1 D ENVS
"RTN","GMTSVS",26,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",27,0)
 ;                          
"RTN","GMTSVS",28,0)
ENVS ; Set up for Vitals Extraction Routine
"RTN","GMTSVS",29,0)
 S CNTR=$S(+($G(CNTR))>0:+($G(CNTR)),+($G(CNTR))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",30,0)
 K ^UTILITY($J,"GMRVD"),ARRAY,GMRVSTR("LT")
"RTN","GMTSVS",31,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",32,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",33,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",34,0)
 ;D EN1^GMRVUT0 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",35,0)
 D EN1^GMVHS I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",36,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",37,0)
 ;                          
"RTN","GMTSVS",38,0)
FIRST ; First Set of Vitals
"RTN","GMTSVS",39,0)
 ;  1     2      3     4   5     6       7         8
"RTN","GMTSVS",40,0)
 ; Date^Temp()^Pulse^Respt^BP^Height()^Weight()^Control
"RTN","GMTSVS",41,0)
 N GMW,GMTSCCNT,GMTSCTL S CNTR("HOLDER")=CNTR S GMTSVMVR=$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVS",42,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",44,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",46,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?18,"TEMP",?30,"PULSE",?36,"RESP",?41,"BP",?53,"HT",?63,"WT",!
"RTN","GMTSVS",48,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"F(C)",?53,"IN(CM)",?63,"LB(KG)[BMI]",!
"RTN","GMTSVS",49,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"----",?30,"-----",?36,"----",?41,"--",?53,"------",?63,"-----------",!!
"RTN","GMTSVS",50,0)
 S GMTSCCNT=0,GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D FLOOP,FWRT
"RTN","GMTSVS",51,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",52,0)
 Q
"RTN","GMTSVS",53,0)
FLOOP ;   Loop through first set of vitals by date
"RTN","GMTSVS",54,0)
 S (GMTSCTL,GMTSVT)=""
"RTN","GMTSVS",55,0)
 F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D FFMT
"RTN","GMTSVS",56,0)
 Q
"RTN","GMTSVS",57,0)
FFMT ;   Extract and format first set of vitals
"RTN","GMTSVS",58,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN),X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",59,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",60,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",61,0)
 I GMTAB="2" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",62,0)
 I GMTAB="6" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),0)_")"
"RTN","GMTSVS",63,0)
 I GMTAB="7" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),0)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",64,0)
 I "^2^7^"[GMTAB,$P(GMTSVS,U,8)?1A.E S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",65,0)
 I GMTAB=6,$P(GMTSVS,U,8)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(GMTSVS,U,8),1,9)
"RTN","GMTSVS",66,0)
 I "^2^6^7^"'[GMTAB S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",67,0)
 I GMTAB=3,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,5)
"RTN","GMTSVS",68,0)
 I GMTAB=4,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,4)
"RTN","GMTSVS",69,0)
 ;I "^3^4^5^"[GMTAB,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,7)
"RTN","GMTSVS",70,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",71,0)
 S:GMTAB>1 GMTSCTL=GMTSCTL_$P(ARRAY,U,GMTAB),$P(ARRAY,U,8)=GMTSCTL
"RTN","GMTSVS",72,0)
 Q
"RTN","GMTSVS",73,0)
FWRT ;   Write first set of vitals by date
"RTN","GMTSVS",74,0)
 Q:$P($G(ARRAY),U,8)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",75,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",76,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",77,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?36,$P(ARRAY,U,4),?41,$P(ARRAY,U,5),?53,$P(ARRAY,U,6),?63,$P(ARRAY,U,7),!
"RTN","GMTSVS",78,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",79,0)
 K ARRAY
"RTN","GMTSVS",80,0)
 Q
"RTN","GMTSVS",81,0)
 ;                          
"RTN","GMTSVS",82,0)
SECOND ; Second Set of Vitals
"RTN","GMTSVS",83,0)
 ;  1    2   3     4     5      6
"RTN","GMTSVS",84,0)
 ; Date^CVP^POx^Cir/Gir^Pain^Control
"RTN","GMTSVS",85,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",86,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",87,0)
 W !,"Measurement DT",?18,"CVP",?32,"POx",?45,"CG"
"RTN","GMTSVS",88,0)
 W !,?18,"CMH20(MMHG)",?32,"(L/MIN)(%)",?45,"IN(CM)",?73,"Pain",!,?18,"-----------",?32,"----------",?45,"------",?73,"----",!!
"RTN","GMTSVS",89,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D SLOOP,SWRT
"RTN","GMTSVS",90,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",91,0)
 Q
"RTN","GMTSVS",92,0)
SLOOP ;   Loop through second set of vitals by date
"RTN","GMTSVS",93,0)
 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D SFMT
"RTN","GMTSVS",94,0)
 Q
"RTN","GMTSVS",95,0)
SFMT ;   Extract and format second set of vitals
"RTN","GMTSVS",96,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",97,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",98,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,GMTSVT="PN":5,1:0)
"RTN","GMTSVS",99,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",100,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",1:"("_$P(GMTSVS,U,13)_")")
"RTN","GMTSVS",101,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",($P($G(GMTSVS),U,15)="")&($P($G(GMTSVS),U,16)=""):"",1:"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")")
"RTN","GMTSVS",102,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",1:"("_$$FN($P(GMTSVS,U,13),0)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:""))
"RTN","GMTSVS",103,0)
 I GMTAB=5 S $P(ARRAY,U,GMTAB)=$S($L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=0):$P(ARRAY,U,GMTAB),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))'=99):$$FN($P(ARRAY,U,GMTAB),0),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=99):"No Response",1:"")
"RTN","GMTSVS",104,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,6)=GMTSCTL
"RTN","GMTSVS",105,0)
 Q
"RTN","GMTSVS",106,0)
SWRT ;   Write second set of vitals by date
"RTN","GMTSVS",107,0)
 Q:$P($G(ARRAY),U,6)=""
"RTN","GMTSVS",108,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",109,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",110,0)
 . W !,"Measurement DT",?18,"CVP",?34,"POx",?46,"CG"
"RTN","GMTSVS",111,0)
 . W !,?18,"CMH20(MMHG)",?32,"(L/MIN)(%)",?45,"IN(CM)",?73,"Pain",!,?18,"-----------",?32,"----------",?45,"------",?73,"----",!!
"RTN","GMTSVS",112,0)
 S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",113,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?32,$P(ARRAY,U,3),?45,$P(ARRAY,U,4),?73,$S($P(ARRAY,U,5)?1A.E:$E($P(ARRAY,U,5),1,7),1:$P(ARRAY,U,5)),!
"RTN","GMTSVS",114,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",115,0)
 K ARRAY
"RTN","GMTSVS",116,0)
 Q
"RTN","GMTSVS",117,0)
 ;                          
"RTN","GMTSVS",118,0)
KILLVS ; Kill Variables
"RTN","GMTSVS",119,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",120,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",121,0)
 Q
"RTN","GMTSVS",122,0)
FN(X,Y) ; Format Number 
"RTN","GMTSVS",123,0)
 N VAL S VAL=+($G(X)),Y=$G(Y) Q:+Y'=Y X
"RTN","GMTSVS",124,0)
 S X=$FN(VAL,"",Y) Q X
"RTN","GMTSVSD")
0^2^B58460028^B57231397
"RTN","GMTSVSD",1,0)
GMTSVSD ; SLC/KER - Vital Signs (Detailed)           ; 01/06/2003
"RTN","GMTSVSD",2,0)
 ;;2.7;Health Summary;**35,49,58,78**;Oct 20, 1995
"RTN","GMTSVSD",3,0)
 ;                          
"RTN","GMTSVSD",4,0)
 ; External References
"RTN","GMTSVSD",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVSD",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSD",7,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSVSD",8,0)
 ;                    
"RTN","GMTSVSD",9,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSD",10,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSD",11,0)
 ;                     
"RTN","GMTSVSD",12,0)
 Q
"RTN","GMTSVSD",13,0)
EN ; Detailed Vital Signs main control
"RTN","GMTSVSD",14,0)
 N GMRVSTR,GMTSC1,GMTSC2,GMTSC3,GMTSC4,GMTSCNT,GMTSCD,GMTSCHR,GMTSCI
"RTN","GMTSVSD",15,0)
 N GMTSCW1,GMTSCW2,GMTSCW3,GMTSCW4,GMTSCW5,GMTSLN,GMTSMEAS,GMTSMAX
"RTN","GMTSVSD",16,0)
 N GMTSN,GMTSOK,GMTSP,GMTSPSN,GMTSQ,GMTSREM,GMTSROV,GMTST,GMTSTO,GMTSV
"RTN","GMTSVSD",17,0)
 N GMTSVCT,GMTSVD,GMTSVI,GMTSVSD,GMTSVSDT,GMTSVT,X,Y,GMTSLM,GMTSLML
"RTN","GMTSVSD",18,0)
 S GMTSLM=0 S:$D(VALM("BM"))&($G(VALM("LINES"))>0) GMTSLM=1
"RTN","GMTSVSD",19,0)
 S GMTSLML=9999999009 S:GMTSLM GMTSLML=+($G(VALM("LINES")))
"RTN","GMTSVSD",20,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSVSD",21,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="VITALS DETAILED DISPLAY" K ^TMP("GMTSVSD",$J),^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",22,0)
 S (GMTSVCT,GMTSMAX)=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",23,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSD",24,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K GMRVSTR("LT")
"RTN","GMTSVSD",25,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",26,0)
 S GMTSCW1=0,GMTSCW2=18,GMTSCW3=36,GMTSCW4=53,GMTSCW5=+($G(IOM))-2
"RTN","GMTSVSD",27,0)
 S:GMTSCW5'>49 GMTSCW5=78
"RTN","GMTSVSD",28,0)
 I '$D(^TMP("GMTSVSD",$J)) Q
"RTN","GMTSVSD",29,0)
 D REM,OUT
"RTN","GMTSVSD",30,0)
 Q
"RTN","GMTSVSD",31,0)
 ;                
"RTN","GMTSVSD",32,0)
GET ; Get Data
"RTN","GMTSVSD",33,0)
 K ^UTILITY($J,"GMRVD") N GMTSMAX
"RTN","GMTSVSD",34,0)
 S GMTSMAX=$S(+($G(GMTSVCT))>0:+($G(GMTSVCT)),1:1) S GMTSMAX=GMTSMAX*100
"RTN","GMTSVSD",35,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVSD",36,0)
 S GMRVSTR(0)=$G(GMTSBEG)_"^"_$G(GMTSEND)_"^"_$G(GMTSMAX)_"^"_1
"RTN","GMTSVSD",37,0)
 ;D EN1^GMRVUT0 S GMTSMAX=+($G(GMTSVCT))
"RTN","GMTSVSD",38,0)
 D EN1^GMVHS S GMTSMAX=+($G(GMTSVCT))
"RTN","GMTSVSD",39,0)
 Q
"RTN","GMTSVSD",40,0)
NOD ;   No Data Found
"RTN","GMTSVSD",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR
"RTN","GMTSVSD",42,0)
 W "*** No vital measurements ***",! S GMTSMAX=1 Q
"RTN","GMTSVSD",43,0)
REM ;   Remove Excess Data
"RTN","GMTSVSD",44,0)
 N GMTSMAX S GMTSMAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",45,0)
 N GMTSVD,GMTSVT,GMTSVI,GMTST
"RTN","GMTSVSD",46,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:+GMTSVD=0  D
"RTN","GMTSVSD",47,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",48,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",49,0)
 . . . I +($G(GMTST(GMTSVT)))>(GMTSMAX-1) K ^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI) Q
"RTN","GMTSVSD",50,0)
 . . . S GMTST(GMTSVT)=+($G(GMTST(GMTSVT)))+1
"RTN","GMTSVSD",51,0)
 Q
"RTN","GMTSVSD",52,0)
 ;                
"RTN","GMTSVSD",53,0)
OUT ; Output Data
"RTN","GMTSVSD",54,0)
 D HDR Q:$D(GMTSQIT)  N GMTSVD,GMTSVT,GMTSVSDT,GMTSVSD,GMTSVI,GMTSCNT S GMTSCNT=0
"RTN","GMTSVSD",55,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:GMTSVD<1!(GMTSVD="")  D
"RTN","GMTSVSD",56,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",57,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",58,0)
 . . . S GMTSVSD=$G(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:'$L(GMTSVSD)  S GMTSVSDT=$P(GMTSVSD,"^",1) Q:'$L(GMTSVSDT)  Q:+GMTSVSDT'>0  D ADD
"RTN","GMTSVSD",59,0)
 . I +($O(^TMP("GMTSVSD",$J,GMTSVD)))'=GMTSVD D WRL
"RTN","GMTSVSD",60,0)
 I GMTSCNT=0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W "No data",!
"RTN","GMTSVSD",61,0)
 Q
"RTN","GMTSVSD",62,0)
ADD ;   Add to Output Array
"RTN","GMTSVSD",63,0)
 N GMTST,GMTSTO,GMTSV,GMTSQ S GMTST=$G(GMTSVT) Q:'$L(GMTST)
"RTN","GMTSVSD",64,0)
 S GMTSTO=$$VO(GMTST) Q:GMTSTO'>0  S GMTST=$$VT(GMTST) Q:'$L(GMTST)
"RTN","GMTSVSD",65,0)
 S GMTSV=$$VM(GMTSVT,GMTSVSD)
"RTN","GMTSVSD",66,0)
 S GMTSQ=$$VQ(GMTSVSD),GMTSROV(GMTSTO)=GMTST_"^"_GMTSV_"^"_GMTSQ,GMTSCNT=+($G(GMTSCNT))+1,GMTSROV("DT")=$$EDT^GMTSU(GMTSVSDT)
"RTN","GMTSVSD",67,0)
 Q
"RTN","GMTSVSD",68,0)
WRL ;   Write Line from Array
"RTN","GMTSVSD",69,0)
 N GMTSCI,GMTSCD,GMTSC1,GMTSC2,GMTSC3,GMTSC4
"RTN","GMTSVSD",70,0)
 S (GMTSCD,GMTSC1)=$G(GMTSROV("DT")) I '$L(GMTSC1) K GMTSROV Q
"RTN","GMTSVSD",71,0)
 S GMTSCI=0 F  S GMTSCI=$O(GMTSROV(GMTSCI)) Q:+GMTSCI=0  Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",72,0)
 . S GMTSC2=$G(GMTSROV(GMTSCI)),GMTSC3=$P(GMTSC2,"^",2),GMTSC4=$P(GMTSC2,"^",3),GMTSC2=$P(GMTSC2,"^",1)
"RTN","GMTSVSD",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVSD",74,0)
 . I +($G(GMTSLM))>0 S:+($$LMP)>0 GMTSC1=GMTSCD
"RTN","GMTSVSD",75,0)
 . I GMTSNPG'=1 W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",76,0)
 . I GMTSNPG=1 S GMTSC1=GMTSCD D HDR W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",77,0)
 . S GMTSC1="   ""        ""  "
"RTN","GMTSVSD",78,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSVSD",79,0)
 K GMTSROV
"RTN","GMTSVSD",80,0)
 Q
"RTN","GMTSVSD",81,0)
LMP(X) ;
"RTN","GMTSVSD",82,0)
 Q:+($G(GMTSLML))'>0 0
"RTN","GMTSVSD",83,0)
 N GMTSP,GMTSD S GMTSP=$Y,GMTSD=0 S:GMTSP#GMTSLML=0 GMTSD=1 S X=GMTSD Q X
"RTN","GMTSVSD",84,0)
QUAL ;   Write Vital Qualifiers
"RTN","GMTSVSD",85,0)
 N GMTSOK,GMTSLN,GMTSTO,GMTSREM,GMTSPSN,GMTSCHR S GMTSLN=GMTSCW5-GMTSCW4
"RTN","GMTSVSD",86,0)
 I $L(GMTSC4)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSC4,! Q
"RTN","GMTSVSD",87,0)
 S GMTSREM=GMTSC4 F  Q:$D(GMTSQIT)  D QPARSE Q:$D(GMTSQIT)  Q:'$L(GMTSREM)
"RTN","GMTSVSD",88,0)
 Q
"RTN","GMTSVSD",89,0)
QPARSE ;     Parse Qualifier (wrap)
"RTN","GMTSVSD",90,0)
 I $L(GMTSREM)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSREM,! S GMTSREM="" Q
"RTN","GMTSVSD",91,0)
 S GMTSOK=0 F GMTSPSN=GMTSLN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSVSD",92,0)
 . I $E(GMTSREM,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSVSD",93,0)
 . I $E(GMTSREM,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSVSD",94,0)
 . I $E(GMTSREM,GMTSPSN)="/"!($E(GMTSREM,GMTSPSN)="-")!($E(GMTSREM,GMTSPSN)=")") S GMTSCHR=$E(GMTSREM,GMTSPSN),GMTSOK=1 Q
"RTN","GMTSVSD",95,0)
 I GMTSCHR=" " D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",96,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN-1)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",97,0)
 I GMTSCHR="/"!(GMTSCHR=",")!(GMTSCHR="-")!(GMTSCHR=")") D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",98,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",99,0)
 Q
"RTN","GMTSVSD",100,0)
 ;                
"RTN","GMTSVSD",101,0)
 ; Miscellaneous
"RTN","GMTSVSD",102,0)
FM(X) ;   Format Vitals Measurement
"RTN","GMTSVSD",103,0)
 S X=$$TRIM($G(X)) Q:+X'=X X
"RTN","GMTSVSD",104,0)
 S:X["." X=$FN(X,"",2) Q X
"RTN","GMTSVSD",105,0)
TRIM(X) ;   Trim Blank Spaces
"RTN","GMTSVSD",106,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSVSD",107,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSVSD",108,0)
 Q X
"RTN","GMTSVSD",109,0)
VO(X) ;   Vital Array Order
"RTN","GMTSVSD",110,0)
 S X=$G(X) Q:X="T" 1 Q:X="P" 2 Q:X="R" 3 Q:X="BP" 4 Q:X="HT" 5 Q:X="WT" 6 Q:X="CG" 7 Q:X="PN" 8 Q:X="CVP" 9 Q:X="PO2" 10 Q ""
"RTN","GMTSVSD",111,0)
VT(X) ;   Vital Type
"RTN","GMTSVSD",112,0)
 S X=$G(X) Q:X="BP" "BP" Q:X="T" "Temp F (C)" Q:X="R" "Respir" Q:X="P" "Pulse" Q:X="HT" "Ht in (cm)"
"RTN","GMTSVSD",113,0)
 Q:X="WT" "Wt lbs (kg)[BMI]" Q:X="CVP" "CVP cm H2O(mm HG)" Q:X="PO2" "POx (L/Min)(%)" Q:X="CG" "C/G in (cm)" Q:X="PN" "Pain" Q ""
"RTN","GMTSVSD",114,0)
VM(X,Y) ;   Vital Type Measurement
"RTN","GMTSVSD",115,0)
 N GMTSMEAS,GMTSID S GMTSMEAS="",(GMTSID,X)=$G(X) Q:"^BP^T^R^P^HT^WT^CVP^PO2^CG^PN^"'[("^"_X_"^") ""
"RTN","GMTSVSD",116,0)
 S Y=$G(Y) Q:'$L(Y) ""
"RTN","GMTSVSD",117,0)
 ;     If data for T, Ht or Wt piece 8 and 13 else  piece 8
"RTN","GMTSVSD",118,0)
 I X="T"!(X="HT")!(X="WT") S GMTSMEAS=$S($P(Y,"^",8)?1A.E:$P(Y,"^",8),1:$P(Y,"^",8)_" ("_$P(Y,"^",13)_")")
"RTN","GMTSVSD",119,0)
 E  S GMTSMEAS=$P(Y,"^",8)
"RTN","GMTSVSD",120,0)
 ;     WT - Weight and BMI (piece 14)
"RTN","GMTSVSD",121,0)
 I X="WT",$L($P(Y,"^",14)) S GMTSMEAS=GMTSMEAS_"["_$P(Y,"^",14)_"]"
"RTN","GMTSVSD",122,0)
 ;     CVP - Central Venous Pressure/CG - Circum/Girth
"RTN","GMTSVSD",123,0)
 I X="CVP"!(X="CG") S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",13)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",124,0)
 ;     POx - Pulse Oximetry
"RTN","GMTSVSD",125,0)
 I X="PO2" S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",15))!($L($P(Y,"^",16))) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",15)_")("_$P(Y,"^",16)_")"
"RTN","GMTSVSD",126,0)
 ;     PN - Pain
"RTN","GMTSVSD",127,0)
 S:X="PN" GMTSMEAS=$P(Y,"^",8) S:X="PN"&(GMTSMEAS=99) GMTSMEAS="No Response"
"RTN","GMTSVSD",128,0)
 S X=GMTSMEAS Q X
"RTN","GMTSVSD",129,0)
VQ(X) ;   Vital Qualifiers
"RTN","GMTSVSD",130,0)
 S X=$G(X),X=$P(X,"^",17) S:$L(X) X=$$AQ(X) Q X
"RTN","GMTSVSD",131,0)
HDR ;   Header
"RTN","GMTSVSD",132,0)
 N GMTSLN D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",133,0)
 W "Date",?GMTSCW2,"Vital",?GMTSCW3,"Measurement",?GMTSCW4,"Qualifiers"
"RTN","GMTSVSD",134,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) !
"RTN","GMTSVSD",135,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",136,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW2-2)) W ?GMTSCW2
"RTN","GMTSVSD",137,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW3-(GMTSCW2+2))) W ?GMTSCW3
"RTN","GMTSVSD",138,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW4-(GMTSCW3+2))) W ?GMTSCW4
"RTN","GMTSVSD",139,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW5-(GMTSCW4+2)))
"RTN","GMTSVSD",140,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W !
"RTN","GMTSVSD",141,0)
 ;
"RTN","GMTSVSD",142,0)
 S GMTSNPG=0 Q
"RTN","GMTSVSD",143,0)
ST ;   Save in ^TMP Global
"RTN","GMTSVSD",144,0)
 Q:'$D(^UTILITY($J,"GMRVD"))  M ^TMP("GMTSVSD",$J)=^UTILITY($J,"GMRVD") Q
"RTN","GMTSVSD",145,0)
AQ(X) ;   All Qualifiers Field
"RTN","GMTSVSD",146,0)
 S X=$G(X) F  Q:X'[";"  S X=$P(X,";",1)_", "_$P(X,";",2,299)
"RTN","GMTSVSD",147,0)
 S X=$$MC(X) Q X
"RTN","GMTSVSD",148,0)
MC(X) ;   Mix Case for Qualifiers
"RTN","GMTSVSD",149,0)
 N GMTSP S X=$TR($G(X),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz") F GMTSP=1:1:$L(X) D
"RTN","GMTSVSD",150,0)
 . S:GMTSP=1 X=$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X)) Q:GMTSP=1
"RTN","GMTSVSD",151,0)
 . S:" /-,"[$E(X,(GMTSP-1)) X=$E(X,1,(GMTSP-1))_$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X))
"RTN","GMTSVSD",152,0)
 Q X
"RTN","GMTSVSD",153,0)
DTM(X) ;   Current Date and Time
"RTN","GMTSVSD",154,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSVSD",155,0)
FN(X,Y) ;   Format Number 
"RTN","GMTSVSD",156,0)
 N GMTSV S X=$G(X),GMTSV=+($G(X)),Y=$G(Y) S:+Y=Y X=$FN(GMTSV,"",+Y) Q X
"RTN","GMTSVSD",157,0)
LN(X) ;   Dashed Line
"RTN","GMTSVSD",158,0)
 S X=+($G(X)) Q:X=0 "" N GMTSLN S GMTSLN="",$P(GMTSLN,"-",X)="-" S X=GMTSLN Q X
"RTN","GMTSVSD",159,0)
EDT(X) ; External Date and Time
"RTN","GMTSVSD",160,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSVSD",161,0)
 D REGDTM4^GMTSU Q X
"RTN","GMTSVSS")
0^3^B43514605^B40551410
"RTN","GMTSVSS",1,0)
GMTSVSS ; SLC/KER - Selected Vital Signs           ; 02/27/2002
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49,78**;Oct 20, 1995
"RTN","GMTSVSS",3,0)
 ;                          
"RTN","GMTSVSS",4,0)
 ; External References
"RTN","GMTSVSS",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVSS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSS",7,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSVSS",8,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSVSS",9,0)
 ;                    
"RTN","GMTSVSS",10,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSS",11,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSS",12,0)
 ;                          
"RTN","GMTSVSS",13,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",14,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",15,0)
 K ^UTILITY($J,"GMRVD") S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",16,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",17,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",18,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",19,0)
 ;   Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",20,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSS",21,0)
 ;D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",22,0)
 D BLDHDR,EN1^GMVHS
"RTN","GMTSVSS",23,0)
 ;   If no data, display most recent inpatient measurements
"RTN","GMTSVSS",24,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",25,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!!
"RTN","GMTSVSS",26,0)
 . S MAX=1 D ENVS
"RTN","GMTSVSS",27,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",28,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",29,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",30,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",31,0)
 . D NXTROW
"RTN","GMTSVSS",32,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",33,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",34,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",35,0)
 Q
"RTN","GMTSVSS",36,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",37,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,ROW,WIDTH
"RTN","GMTSVSS",38,0)
 K ^UTILITY($J,"GMRVD"),GMRVSTR("LT")
"RTN","GMTSVSS",39,0)
 S MAX=$S(+($G(MAX))>0:MAX,+($G(MAX))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",40,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",41,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",42,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",43,0)
 ;D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",44,0)
 D BLDHDR,EN1^GMVHS
"RTN","GMTSVSS",45,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",46,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",47,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",48,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",49,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",50,0)
 . D NXTROW
"RTN","GMTSVSS",51,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",52,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",53,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",54,0)
 Q
"RTN","GMTSVSS",55,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",56,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",57,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVSS",58,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",59,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",60,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",61,0)
 Q
"RTN","GMTSVSS",62,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",63,0)
 N ABB,GMTSI S COL=18
"RTN","GMTSVSS",64,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",65,0)
 . S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",66,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",67,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="PN":"PAIN",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",ABB="PO2":"POx",1:ABB)
"RTN","GMTSVSS",68,0)
 . S WIDTH=$S($P(HDR(GMTSI-1),U)="T":13,$P(HDR(GMTSI-1),U)="P":8,$P(HDR(GMTSI-1),U)="R":12,$P(HDR(GMTSI-1),U)="WT":20,$P(HDR(GMTSI-1),U)="CG":34,$P(HDR(GMTSI-1),U)="CVP":16,$P(HDR(GMTSI-1),U)="HT":13,$P(HDR(GMTSI-1),U)="PO2":13,1:12)
"RTN","GMTSVSS",69,0)
 . S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",70,0)
 . S COL=COL_U
"RTN","GMTSVSS",71,0)
 . S COL=COL_COLL
"RTN","GMTSVSS",72,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",73,0)
 S ROW=1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",74,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",75,0)
 . I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",76,0)
 . . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",77,0)
 . . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",78,0)
 . . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",79,0)
 . . S CNT=CNT+1
"RTN","GMTSVSS",80,0)
 . . K HDR(LOOP)
"RTN","GMTSVSS",81,0)
 . S ROW=ROW+1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",82,0)
 . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",83,0)
 . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",84,0)
 . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",85,0)
 . S CNT=CNT+1
"RTN","GMTSVSS",86,0)
 . K HDR(LOOP)
"RTN","GMTSVSS",87,0)
 Q
"RTN","GMTSVSS",88,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",89,0)
 N GMI
"RTN","GMTSVSS",90,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",91,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",92,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",93,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",94,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",96,0)
 Q
"RTN","GMTSVSS",97,0)
WRTHDR1 ; Writes 2nd line of header
"RTN","GMTSVSS",98,0)
 N GMI
"RTN","GMTSVSS",99,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",100,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",101,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",102,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",103,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",104,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",105,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",106,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",107,0)
 . I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",108,0)
 . I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",109,0)
 . I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",110,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",111,0)
 Q
"RTN","GMTSVSS",112,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",113,0)
 N GMLEN,GMTSBMI,GMTSI,GMTSVAL,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,GMTSQUAL,IEN,X
"RTN","GMTSVSS",114,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM4^GMTSU S GMTDT=X
"RTN","GMTSVSS",115,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",116,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",117,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",118,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",119,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",120,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",121,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",122,0)
 . . Q
"RTN","GMTSVSS",123,0)
 . Q
"RTN","GMTSVSS",124,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",125,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",126,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",127,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",128,0)
 . . S:GMTSVT="PN"&(GMTSVAL=99) GMTSVAL="No Response"
"RTN","GMTSVSS",129,0)
 . . S:GMTSVT="P"&(GMTSVAL?1A.E) GMTSVAL=$E(GMTSVAL,1,7)
"RTN","GMTSVSS",130,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",131,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",132,0)
 . . S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",133,0)
 . . S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,15)
"RTN","GMTSVSS",134,0)
 . . S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",135,0)
 . . I GMTSMET'="" W "("_GMTSMET_")" ;   centigrade/kilos/centimeters
"RTN","GMTSVSS",136,0)
 . . I GMTSBMI'="" W "["_GMTSBMI_"]" ;   body mass index
"RTN","GMTSVSS",137,0)
 . . I GMTSLMIN'=""!(GMTSPERC'="") W "["_GMTSLMIN_"]["_GMTSPERC_"]" ; [liters/min supplemental O2][% supplemental O2]
"RTN","GMTSVSS",138,0)
 . . I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;   qualifiers
"RTN","GMTSVSS",139,0)
 . . Q
"RTN","GMTSVSS",140,0)
 . Q
"RTN","GMTSVSS",141,0)
 Q
"RTN","GMTSVSS",142,0)
NXTROW ; Get the Next Row of Vital Signs
"RTN","GMTSVSS",143,0)
 Q:$G(ROW)'>0  K HDR S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",144,0)
 S COL=COL(ROW) K %X,%Y
"RTN","GMTSVSS",145,0)
 Q
"VER")
8.0^22.0
"BLD",6322,6)
^72
**END**
**END**
