Released SPN*2*24 SEQ #24
Extracted from mail message
**KIDS**:SPN*2.0*24^

**INSTALL NAME**
SPN*2.0*24
"BLD",5626,0)
SPN*2.0*24^SPINAL CORD DYSFUNCTION^0^3050209^y
"BLD",5626,4,0)
^9.64PA^^
"BLD",5626,"ABPKG")
n
"BLD",5626,"KRN",0)
^9.67PA^8989.52^19
"BLD",5626,"KRN",.4,0)
.4
"BLD",5626,"KRN",.401,0)
.401
"BLD",5626,"KRN",.402,0)
.402
"BLD",5626,"KRN",.403,0)
.403
"BLD",5626,"KRN",.5,0)
.5
"BLD",5626,"KRN",.84,0)
.84
"BLD",5626,"KRN",3.6,0)
3.6
"BLD",5626,"KRN",3.8,0)
3.8
"BLD",5626,"KRN",9.2,0)
9.2
"BLD",5626,"KRN",9.8,0)
9.8
"BLD",5626,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",5626,"KRN",9.8,"NM",1,0)
SPN24E^^0^B1526668
"BLD",5626,"KRN",9.8,"NM",2,0)
SPNAGGPE^^0^B24254757
"BLD",5626,"KRN",9.8,"NM",3,0)
SPNAGGPI^^0^B28013576
"BLD",5626,"KRN",9.8,"NM",4,0)
SPNAGGPO^^0^B18603624
"BLD",5626,"KRN",9.8,"NM",5,0)
SPNFAP1^^0^B39197527
"BLD",5626,"KRN",9.8,"NM",6,0)
SPNHL1^^0^B20412880
"BLD",5626,"KRN",9.8,"NM",7,0)
SPNHL7^^0^B8407471
"BLD",5626,"KRN",9.8,"NM",8,0)
SPNHPID^^0^B309324
"BLD",5626,"KRN",9.8,"NM",9,0)
SPNLGU^^0^B1473907
"BLD",5626,"KRN",9.8,"NM",10,0)
SPNMISS^^0^B6670725
"BLD",5626,"KRN",9.8,"NM",11,0)
SPNMISS2^^0^B9636018
"BLD",5626,"KRN",9.8,"NM",12,0)
SPNPSR17^^0^B6455637
"BLD",5626,"KRN",9.8,"NM","B","SPN24E",1)

"BLD",5626,"KRN",9.8,"NM","B","SPNAGGPE",2)

"BLD",5626,"KRN",9.8,"NM","B","SPNAGGPI",3)

"BLD",5626,"KRN",9.8,"NM","B","SPNAGGPO",4)

"BLD",5626,"KRN",9.8,"NM","B","SPNFAP1",5)

"BLD",5626,"KRN",9.8,"NM","B","SPNHL1",6)

"BLD",5626,"KRN",9.8,"NM","B","SPNHL7",7)

"BLD",5626,"KRN",9.8,"NM","B","SPNHPID",8)

"BLD",5626,"KRN",9.8,"NM","B","SPNLGU",9)

"BLD",5626,"KRN",9.8,"NM","B","SPNMISS",10)

"BLD",5626,"KRN",9.8,"NM","B","SPNMISS2",11)

"BLD",5626,"KRN",9.8,"NM","B","SPNPSR17",12)

"BLD",5626,"KRN",19,0)
19
"BLD",5626,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",5626,"KRN",19,"NM",1,0)
SPN REG INQ^^0
"BLD",5626,"KRN",19,"NM",2,0)
SPNL CLEANUP REPORT^^0
"BLD",5626,"KRN",19,"NM",3,0)
SPNL MANAGEMENT^^2
"BLD",5626,"KRN",19,"NM","B","SPN REG INQ",1)

"BLD",5626,"KRN",19,"NM","B","SPNL CLEANUP REPORT",2)

"BLD",5626,"KRN",19,"NM","B","SPNL MANAGEMENT",3)

"BLD",5626,"KRN",19.1,0)
19.1
"BLD",5626,"KRN",101,0)
101
"BLD",5626,"KRN",409.61,0)
409.61
"BLD",5626,"KRN",771,0)
771
"BLD",5626,"KRN",870,0)
870
"BLD",5626,"KRN",8989.51,0)
8989.51
"BLD",5626,"KRN",8989.52,0)
8989.52
"BLD",5626,"KRN",8994,0)
8994
"BLD",5626,"KRN","B",.4,.4)

"BLD",5626,"KRN","B",.401,.401)

"BLD",5626,"KRN","B",.402,.402)

"BLD",5626,"KRN","B",.403,.403)

"BLD",5626,"KRN","B",.5,.5)

"BLD",5626,"KRN","B",.84,.84)

"BLD",5626,"KRN","B",3.6,3.6)

"BLD",5626,"KRN","B",3.8,3.8)

"BLD",5626,"KRN","B",9.2,9.2)

"BLD",5626,"KRN","B",9.8,9.8)

"BLD",5626,"KRN","B",19,19)

"BLD",5626,"KRN","B",19.1,19.1)

"BLD",5626,"KRN","B",101,101)

"BLD",5626,"KRN","B",409.61,409.61)

"BLD",5626,"KRN","B",771,771)

"BLD",5626,"KRN","B",870,870)

"BLD",5626,"KRN","B",8989.51,8989.51)

"BLD",5626,"KRN","B",8989.52,8989.52)

"BLD",5626,"KRN","B",8994,8994)

"BLD",5626,"PRE")
SPN24E
"BLD",5626,"QUES",0)
^9.62^^
"BLD",5626,"REQB",0)
^9.611^^
"KRN",19,8436,-1)
2^3
"KRN",19,8436,0)
SPNL MANAGEMENT^SCD Package Management Menu^^M^3539^SPNL SCD MGT^^^^^^356
"KRN",19,8436,10,0)
^19.01PI^11^11
"KRN",19,8436,10,11,0)
14269
"KRN",19,8436,10,11,"^")
SPNL CLEANUP REPORT
"KRN",19,8436,"U")
SCD PACKAGE MANAGEMENT MENU
"KRN",19,13939,-1)
0^1
"KRN",19,13939,0)
SPN REG INQ^Inquire to a Registry Patient^^I^^^^^^^n^SPINAL CORD DYSFUNCTION
"KRN",19,13939,1,0)
^19.06^2^2^3040920^^^
"KRN",19,13939,1,1,0)
This is a read-only (inquire) option providing a view of completed fields
"KRN",19,13939,1,2,0)
in the SCD Registry for a particular patient.
"KRN",19,13939,30)
SPNL(154,
"KRN",19,13939,31)
AEMQ
"KRN",19,13939,80)
SPNL(154,
"KRN",19,13939,82)
C
"KRN",19,13939,"U")
INQUIRE TO A REGISTRY PATIENT
"KRN",19,14269,-1)
0^2
"KRN",19,14269,0)
SPNL CLEANUP REPORT^Cleanup Report^^R^^^^^^^^SPINAL CORD DYSFUNCTION
"KRN",19,14269,1,0)
^19.06^16^16^3050119^^
"KRN",19,14269,1,1,0)
This report option scans the SCD Registry (file #154) and identifies
"KRN",19,14269,1,2,0)
patients with missing data in one or more of the following relevant
"KRN",19,14269,1,3,0)
fields:
"KRN",19,14269,1,4,0)
 
"KRN",19,14269,1,5,0)
Field Name                      Field Number
"KRN",19,14269,1,6,0)
--------------------------      ------------
"KRN",19,14269,1,7,0)
 
"KRN",19,14269,1,8,0)
Registration Status               .03
"KRN",19,14269,1,9,0)
SCI Network                       1.1
"KRN",19,14269,1,10,0)
SSN                               Computed
"KRN",19,14269,1,11,0)
Integration Control Number        (file 2)
"KRN",19,14269,1,12,0)
Registration Date                 .02
"KRN",19,14269,1,13,0)
Date of Last Review               .05
"KRN",19,14269,1,14,0)
 
"KRN",19,14269,1,15,0)
Utilizing results from this report, users will be able to edit the 
"KRN",19,14269,1,16,0)
incomplete records and populate these fields accordingly.
"KRN",19,14269,25)
SPNMISS
"KRN",19,14269,"U")
CLEANUP REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",356,-1)
1^1
"PKG",356,0)
SPINAL CORD DYSFUNCTION^SPN^SPINAL CORD DYSFUNCTION, FIELD COMPONENT
"PKG",356,20,0)
^9.402P^^
"PKG",356,22,0)
^9.49I^1^1
"PKG",356,22,1,0)
2.0^2961206^2980515^3539
"PKG",356,22,1,"PAH",1,0)
24^3050209^15343
"PRE")
SPN24E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","SPN24E")
0^1^B1526668
"RTN","SPN24E",1,0)
SPN24E ;SD/CM- ENVIRONMENT CHECK FOR SPN*2.0*24;1/11/2005
"RTN","SPN24E",2,0)
 ;;2.0;Spinal Cord Dysfunction;**24**;01/02/97
"RTN","SPN24E",3,0)
 ;
"RTN","SPN24E",4,0)
EN ;ENTRY
"RTN","SPN24E",5,0)
 N ROU,TEST,VER,X,ZAP,P23
"RTN","SPN24E",6,0)
 S ROU="SPNOBJ"
"RTN","SPN24E",7,0)
 D CHK
"RTN","SPN24E",8,0)
 I $G(ZAP)=1 S XPDABORT=2 W !,"***SPN*2.0*24 ABORTED***",! D EXIT Q
"RTN","SPN24E",9,0)
 I $G(ZAP)=1 S XPDABORT=2 W !,"***SPN*2.0*24 ABORTED***",! D EXIT Q
"RTN","SPN24E",10,0)
 W !,"***Environment is fine***",!
"RTN","SPN24E",11,0)
 K ROU,TEST,VER,ZAP,P23
"RTN","SPN24E",12,0)
 Q
"RTN","SPN24E",13,0)
CHK ;CHECK FOR PATCH SPN*2*23
"RTN","SPN24E",14,0)
 S X="S TEST=$T(+2^"_ROU_")" X X
"RTN","SPN24E",15,0)
 S VER=$P(TEST,";",3),P23=$P(TEST,";",5)
"RTN","SPN24E",16,0)
 I VER="" W !,"This account is missing some SPN routines!" S ZAP=1 Q
"RTN","SPN24E",17,0)
 I VER'[2 W !,"This is not the current version of Spinal Cord!" S ZAP=1 Q
"RTN","SPN24E",18,0)
 I P23'[23 W !,"Routine: ",ROU," is missing patch SPN*2*23" S ZAP=1
"RTN","SPN24E",19,0)
 Q
"RTN","SPN24E",20,0)
EXIT ;
"RTN","SPN24E",21,0)
 K ROU,TEST,VER,ZAP,P23
"RTN","SPN24E",22,0)
 Q
"RTN","SPNAGGPE")
0^2^B24254757
"RTN","SPNAGGPE",1,0)
SPNAGGPE ;SD/CM- PRINT AGGREGATE ANN EVAL OUTCOMES; 2-21-2003
"RTN","SPNAGGPE",2,0)
 ;;2.0;Spinal Cord Dysfunction;**21,24**;01/02/97
"RTN","SPNAGGPE",3,0)
 ;
"RTN","SPNAGGPE",4,0)
PRINT ;
"RTN","SPNAGGPE",5,0)
 S U="^"
"RTN","SPNAGGPE",6,0)
 W !!
"RTN","SPNAGGPE",7,0)
 S SPNPD0=0 F  S SPNPD0=$O(^SPNL(154.1,"B",SPNPD0)) Q:'+SPNPD0  D OIEN^SPNAGGE
"RTN","SPNAGGPE",8,0)
 W !,?20,"ANNUAL EVALUATION Outcomes Report"
"RTN","SPNAGGPE",9,0)
 W !,?24,"Date of Report: ",$$FMTE^XLFDT($$NOW^XLFDT,"5DZP")
"RTN","SPNAGGPE",10,0)
 W !,?11,"Based on Observations from ",$$FMTE^XLFDT(BDATE,"5DZP")," to ",$$FMTE^XLFDT(EDATE,"5DZP"),!!
"RTN","SPNAGGPE",11,0)
 S LINE="-" F I=1:1:80 W LINE
"RTN","SPNAGGPE",12,0)
 W !,?SPNT1,"HI TETRA",?SPNT2,"LO TETRA",?SPNT3,"PARA",?SPNT4,"ASIA D",?SPNT5,"ALL",!
"RTN","SPNAGGPE",13,0)
 W !,"# and % of Patients",?SPNT1,SPNSEVC," (",$S(+SPNDIAGC:$J(SPNSEVC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT2,SPNMODC," (",$S(+SPNDIAGC:$J(SPNMODC/SPNDIAGC*100,2,0),1:0),"%)"
"RTN","SPNAGGPE",14,0)
 W ?SPNT3,SPNPARC," (",$S(+SPNDIAGC:$J(SPNPARC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT4,SPNLOWC," (",$S(+SPNDIAGC:$J(SPNLOWC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT5,SPNDIAGC," (100%)"
"RTN","SPNAGGPE",15,0)
 W !,"Age (yrs)",?SPNT1,$S(+SPNSEVC:$J(SPNAGES/SPNSEVC,3,1),1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNAGEM/SPNMODC,3,1),1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNAGEP/SPNPARC,3,1),1:"N/A"),?SPNT4,$S(+SPNLOWC:$J(SPNAGEL/SPNLOWC,3,1),1:"N/A")
"RTN","SPNAGGPE",16,0)
 W ?SPNT5,$S(SPNDIAGC>0:$J(SPNAGES+SPNAGEM+SPNAGEP+SPNAGEL/SPNDIAGC,3,1),1:"N/A")
"RTN","SPNAGGPE",17,0)
 W !,"Age Range",?SPNT1,MINAGES,"-",MAXAGES,?SPNT2,MINAGEM,"-",MAXAGEM,?SPNT3,MINAGEP,"-",MAXAGEP,?SPNT4,MINAGEL,"-",MAXAGEL,?SPNT5,AGEL,"-",AGEH
"RTN","SPNAGGPE",18,0)
 W !,"Gender (% Male pts)",?SPNT1,$S(+SPNSEVC:$J(SPNSEXS/SPNSEVC*100,2,0)_"%",1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNSEXM/SPNMODC*100,2,0)_"%",1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNSEXP/SPNPARC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPE",19,0)
 W ?SPNT4,$S(+SPNLOWC:$J(SPNSEXL/SPNLOWC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPE",20,0)
 W ?SPNT5,$S(+SPNDIAGC:$J(SPNSEXS+SPNSEXM+SPNSEXP+SPNSEXL/SPNDIAGC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPE",21,0)
 W !,"Total FIM Score",?SPNT1,$S(+TFCS:TFS/TFCS,1:"N/A"),?SPNT2,$S(+TFCM:TFM/TFCM,1:"N/A"),?SPNT3,$S(+TFCP:TFP/TFCP,1:"N/A"),?SPNT4,$S(+TFCL:TFL/TFCL,1:"N/A")
"RTN","SPNAGGPE",22,0)
 W ?SPNT5,$S(TFCS+TFCM+TFCP+TFCL>0:$J(TFS+TFM+TFP+TFL/(TFCS+TFCM+TFCP+TFCL),3,1),1:"N/A")
"RTN","SPNAGGPE",23,0)
 W !,"Motor FIM Score",?SPNT1,$S(+MFCS:MFS/MFCS,1:"N/A"),?SPNT2,$S(+MFCM:MFM/MFCM,1:"N/A"),?SPNT3,$S(+MFCP:MFP/MFCP,1:"N/A"),?SPNT4,$S(+MFCL:MFL/MFCL,1:"N/A")
"RTN","SPNAGGPE",24,0)
 W ?SPNT5,$S(MFCS+MFCM+MFCP+MFCL>0:$J(MFS+MFM+MFP+MFL/(MFCS+MFCM+MFCP+MFCL),3,1),1:"N/A")
"RTN","SPNAGGPE",25,0)
 W !,"Cognitive FIM Score",?SPNT1,$S(+CFCS:CFS/CFCS,1:"N/A"),?SPNT2,$S(+CFCM:CFM/CFCM,1:"N/A"),?SPNT3,$S(+CFCP:CFP/CFCP,1:"N/A"),?SPNT4,$S(+CFCL:CFL/CFCL,1:"N/A")
"RTN","SPNAGGPE",26,0)
 W ?SPNT5,$S(CFCS+CFCM+CFCP+CFCL>0:$J(CFS+CFM+CFP+CFL/(CFCS+CFCM+CFCP+CFCL),3,1),1:"N/A")
"RTN","SPNAGGPE",27,0)
 W !,"CHART Physical Indep",?SPNT1,$S(+CPICS:CPIS/CPICS,1:"N/A"),?SPNT2,$S(+CPICM:CPIM/CPICM,1:"N/A"),?SPNT3,$S(+CPICP:CPIP/CPICP,1:"N/A"),?SPNT4,$S(+CPICL:CPIL/CPICL,1:"N/A")
"RTN","SPNAGGPE",28,0)
 W ?SPNT5,$S(CPICS+CPICM+CPICP+CPICL>0:$J(CPIS+CPIM+CPIP+CPIL/(CPICS+CPICM+CPICP+CPICL),3,1),1:"N/A")
"RTN","SPNAGGPE",29,0)
 W !,"CHART Cognitive Indep",?SPNT1,$S(+CCICS:CCIS/CCICS,1:"N/A"),?SPNT2,$S(+CCICM:CCIM/CCICM,1:"N/A"),?SPNT3,$S(+CCICP:CCIP/CCICP,1:"N/A"),?SPNT4,$S(+CCICL:CCIL/CCICL,1:"N/A")
"RTN","SPNAGGPE",30,0)
 W ?SPNT5,$S(CCICS+CCICM+CCICP+CCICL>0:$J(CCIS+CCIM+CCIP+CCIL/(CCICS+CCICM+CCICP+CCICL),3,1),1:"N/A")
"RTN","SPNAGGPE",31,0)
 W !,"CHART Mobility",?SPNT1,$S(+CMCS:CMS/CMCS,1:"N/A"),?SPNT2,$S(+CMCM:CMM/CMCM,1:"N/A"),?SPNT3,$S(+CMCP:CMP/CMCP,1:"N/A"),?SPNT4,$S(+CMCL:CML/CMCL,1:"N/A")
"RTN","SPNAGGPE",32,0)
 W ?SPNT5,$S(CMCS+CMCM+CMCP+CMCL>0:$J(CMS+CMM+CMP+CML/(CMCS+CMCM+CMCP+CMCL),3,1),1:"N/A")
"RTN","SPNAGGPE",33,0)
 W !,"CHART Occupation",?SPNT1,$S(+COCS:COS/COCS,1:"N/A"),?SPNT2,$S(+CMCM:COM/CMCM,1:"N/A"),?SPNT3,$S(+COCP:COP/COCP,1:"N/A"),?SPNT4,$S(+COCL:COL/COCL,1:"N/A")
"RTN","SPNAGGPE",34,0)
 W ?SPNT5,$S(COCS+COCM+COCP+COCL>0:$J(COS+COM+COP+COL/(COCS+COCM+COCP+COCL),3,1),1:"N/A")
"RTN","SPNAGGPE",35,0)
 W !,"CHART Social Interaction",?SPNT1,$S(+CSICS:CSIS/CSICS,1:"N/A"),?SPNT2,$S(+CSICM:CSIM/CSICM,1:"N/A"),?SPNT3,$S(+CSICP:CSIP/CSICP,1:"N/A"),?SPNT4,$S(+CSICL:CSIL/CSICL,1:"N/A")
"RTN","SPNAGGPE",36,0)
 W ?SPNT5,$S(CSICS+CSICM+CSICP+CSICL>0:$J(CSIS+CSIM+CSIP+CSIL/(CSICS+CSICM+CSICP+CSICL),3,1),1:"N/A")
"RTN","SPNAGGPE",37,0)
 W !,"CHART Economic",?SPNT1,$S(+CECS:CES/CECS,1:"N/A"),?SPNT2,$S(+CECM:CEM/CECM,1:"N/A"),?SPNT3,$S(+CECP:CEP/CECP,1:"N/A"),?SPNT4,$S(+CECL:CEL/CECL,1:"N/A")
"RTN","SPNAGGPE",38,0)
 W ?SPNT5,$S(CECS+CECM+CECP+CECL>0:$J(CES+CEM+CEP+CEL/(CECS+CECM+CECP+CECL),3,1),1:"N/A")
"RTN","SPNAGGPE",39,0)
 W !,"Diener SWLS",?SPNT1,$S(+SLCS:SLSS/SLCS,1:"N/A"),?SPNT2,$S(+SLCM:SLSM/SLCM,1:"N/A"),?SPNT3,$S(+SLCP:SLSP/SLCP,1:"N/A"),?SPNT4,$S(+SLCL:SLSL/SLCL,1:"N/A")
"RTN","SPNAGGPE",40,0)
 W ?SPNT5,$S(SLCS+SLCM+SLCP+SLCL>0:$J(SLSS+SLSM+SLSP+SLSL/(SLCS+SLCM+SLCP+SLCL),3,1),1:"N/A")
"RTN","SPNAGGPE",41,0)
 Q
"RTN","SPNAGGPI")
0^3^B28013576
"RTN","SPNAGGPI",1,0)
SPNAGGPI ;SD/CM- PRINT AGGREGATE INPT OUTCOMES; 2-21-2003
"RTN","SPNAGGPI",2,0)
 ;;2.0;Spinal Cord Dysfunction;**20,24**;01/02/97
"RTN","SPNAGGPI",3,0)
 ;
"RTN","SPNAGGPI",4,0)
PRINT ;
"RTN","SPNAGGPI",5,0)
 S U="^"
"RTN","SPNAGGPI",6,0)
 W !!
"RTN","SPNAGGPI",7,0)
 S SPNPD0=0 F  S SPNPD0=$O(^SPNL(154.1,"B",SPNPD0)) Q:'+SPNPD0  D OIEN^SPNAGGI
"RTN","SPNAGGPI",8,0)
 W !,?18,"INPATIENT Rehabilitation Outcomes Report"
"RTN","SPNAGGPI",9,0)
 W !,?24,"Date of Report: ",$$FMTE^XLFDT($$NOW^XLFDT,"5DZP")
"RTN","SPNAGGPI",10,0)
 W !,?12,"Based on Care End Dates from ",$$FMTE^XLFDT(BDATE,"5DZP")," to ",$$FMTE^XLFDT(EDATE,"5DZP"),!!
"RTN","SPNAGGPI",11,0)
 S LINE="-" F I=1:1:80 W LINE
"RTN","SPNAGGPI",12,0)
 W !,?SPNT1,"HI TETRA",?SPNT2,"LO TETRA",?SPNT3,"PARA",?SPNT4,"ASIA D",?SPNT5,"ALL",!
"RTN","SPNAGGPI",13,0)
 W !,"# and % of Patients",?SPNT1,SPNSEVC," (",$S(+SPNDIAGC:$J(SPNSEVC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT2,SPNMODC," (",$S(+SPNDIAGC:$J(SPNMODC/SPNDIAGC*100,2,0),1:0),"%)"
"RTN","SPNAGGPI",14,0)
 W ?SPNT3,SPNPARC," (",$S(+SPNDIAGC:$J(SPNPARC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT4,SPNLOWC," (",$S(+SPNDIAGC:$J(SPNLOWC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT5,SPNDIAGC," (100%)"
"RTN","SPNAGGPI",15,0)
 W !,"Age (yrs)",?SPNT1,$S(+SPNSEVC:$J(SPNAGES/SPNSEVC,3,1),1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNAGEM/SPNMODC,3,1),1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNAGEP/SPNPARC,3,1),1:"N/A"),?SPNT4,$S(+SPNLOWC:$J(SPNAGEL/SPNLOWC,3,1),1:"N/A")
"RTN","SPNAGGPI",16,0)
 W ?SPNT5,$S(SPNDIAGC>0:$J(SPNAGES+SPNAGEM+SPNAGEP+SPNAGEL/SPNDIAGC,3,1),1:"N/A")
"RTN","SPNAGGPI",17,0)
 W !,"Age Range",?SPNT1,MINAGES,"-",MAXAGES,?SPNT2,MINAGEM,"-",MAXAGEM,?SPNT3,MINAGEP,"-",MAXAGEP,?SPNT4,MINAGEL,"-",MAXAGEL,?SPNT5,AGEL,"-",AGEH
"RTN","SPNAGGPI",18,0)
 W !,"Gender (% Male pts)",?SPNT1,$S(+SPNSEVC:$J(SPNSEXS/SPNSEVC*100,2,0)_"%",1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNSEXM/SPNMODC*100,2,0)_"%",1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNSEXP/SPNPARC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPI",19,0)
 W ?SPNT4,$S(+SPNLOWC:$J(SPNSEXL/SPNLOWC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPI",20,0)
 W ?SPNT5,$S(+SPNDIAGC:$J(SPNSEXS+SPNSEXM+SPNSEXP+SPNSEXL/SPNDIAGC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPI",21,0)
 W !,"Length of Rehab (days)",?SPNT1,$S(+LORSC:SPNLORS/LORSC,1:"N/A"),?SPNT2,$S(+LORMC:SPNLORM/LORMC,1:"N/A"),?SPNT3,$S(+LORPC:SPNLORP/LORPC,1:"N/A"),?SPNT4
"RTN","SPNAGGPI",22,0)
 W $S(+LORLC:SPNLORL/LORLC,1:"N/A"),?SPNT5,$S(+(LORSC+LORMC+LORPC+LORLC):$J(SPNLORS+SPNLORM+SPNLORP+SPNLORL/(LORSC+LORMC+LORPC+LORLC),3,0),1:"N/A")
"RTN","SPNAGGPI",23,0)
 W !,"Length of Rehab Range",?SPNT1,MINLORS,"-",MAXLORS,?SPNT2,MINLORM,"-",MAXLORM,?SPNT3,MINLORP,"-",MAXLORP,?SPNT4,MINLORL,"-",MAXLORL,?SPNT5,LORL,"-",LORH
"RTN","SPNAGGPI",24,0)
 W !,"Total FIM Change",?SPNT1,$S(+TFCS:TFCUMS/TFCS,1:"N/A"),?SPNT2,$S(+TFCM:TFCUMM/TFCM,1:"N/A"),?SPNT3,$S(+TFCP:TFCUMP/TFCP,1:"N/A"),?SPNT4,$S(+TFCL:TFCUML/TFCL,1:"N/A")
"RTN","SPNAGGPI",25,0)
 W ?SPNT5,$S(TFCS+TFCM+TFCP+TFCL>0:$J(TFCUMS+TFCUMM+TFCUMP+TFCUML/(TFCS+TFCM+TFCP+TFCL),3,1),1:"N/A")
"RTN","SPNAGGPI",26,0)
 W !,"MSCIS Total FIM Change",?SPNT1,12.4,?SPNT2,27.8,?SPNT3,41.5,?SPNT4,41.2,?SPNT5,35.9
"RTN","SPNAGGPI",27,0)
 W !,"FIM Efficiency",?SPNT1,$S(+SPNLORS:$J(TFCUMS/SPNLORS,3,2),1:"N/A"),?SPNT2,$S(+SPNLORM:$J(TFCUMM/SPNLORM,3,2),1:"N/A"),?SPNT3,$S(+SPNLORP:$J(TFCUMP/SPNLORP,3,2),1:"N/A")
"RTN","SPNAGGPI",28,0)
 W ?SPNT4,$S(+SPNLORL:$J(TFCUML/SPNLORL,3,2),1:"N/A"),?SPNT5,$S(SPNLORS+SPNLORM+SPNLORP+SPNLORL>0:$J(TFCUMS+TFCUMM+TFCUMP+TFCUML/(SPNLORS+SPNLORM+SPNLORP+SPNLORL),3,2),1:"N/A")
"RTN","SPNAGGPI",29,0)
 W !,"MSCIS FIM Efficiency",?SPNT1,"0.13",?SPNT2,"0.28",?SPNT3,"0.76",?SPNT4,"0.84",?SPNT5,"0.55"
"RTN","SPNAGGPI",30,0)
 W !,"FIM Goal Attainment",?SPNT1,$S(+TFGCS:TFGCUMS/TFGCS,1:"N/A"),?SPNT2,$S(+TFGCM:TFGCUMM/TFGCM,1:"N/A"),?SPNT3,$S(+TFGCP:TFGCUMP/TFGCP,1:"N/A"),?SPNT4,$S(+TFGCL:TFGCUML/TFGCL,1:"N/A")
"RTN","SPNAGGPI",31,0)
 W ?SPNT5,$S(TFGCS+TFGCM+TFGCP+TFGCL>0:$J(TFGCUMS+TFGCUMM+TFGCUMP+TFGCUML/(TFGCS+TFGCM+TFGCP+TFGCL),3,1),1:"N/A")
"RTN","SPNAGGPI",32,0)
 W !,"% Discharged to Community",?SPNT1,$S(+COMDISS:COMDISS/LORSC*100_"%",1:"N/A"),?SPNT2,$S(+COMDISM:COMDISM/LORMC*100_"%",1:"N/A"),?SPNT3,$S(+COMDISP:COMDISP/LORPC*100_"%",1:"N/A"),?SPNT4,$S(+COMDISL:COMDISL/LORLC*100_"%",1:"N/A")
"RTN","SPNAGGPI",33,0)
 W ?SPNT5,$S(LORSC+LORMC+LORPC+LORLC>0:$J(COMDISS+COMDISM+COMDISP+COMDISL/(LORSC+LORMC+LORPC+LORLC)*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPI",34,0)
 W !,"FIM Durability",?SPNT1,$S(+TFUCS:TFUCUMS/TFUCS,1:"N/A"),?SPNT2,$S(+TFUCM:TFUCUMM/TFUCM,1:"N/A"),?SPNT3,$S(+TFUCP:TFUCUMP/TFUCP,1:"N/A"),?SPNT4,$S(+TFUCL:TFUCUML/TFUCL,1:"N/A")
"RTN","SPNAGGPI",35,0)
 W ?SPNT5,$S(TFUCS+TFUCM+TFUCP+TFUCL>0:$J(TFUCUMS+TFUCUMM+TFUCUMP+TFUCUML/(TFUCS+TFUCM+TFUCP+TFUCL),3,1),1:"N/A")
"RTN","SPNAGGPI",36,0)
 W !,"Diener SWLS Change",?SPNT1,$S(+SLCS:SLCUMS/SLCS,1:"N/A"),?SPNT2,$S(+SLCM:SLCUMM/SLCM,1:"N/A"),?SPNT3,$S(+SLCP:SLCUMP/SLCP,1:"N/A"),?SPNT4,$S(+SLCL:SLCUML/SLCL,1:"N/A")
"RTN","SPNAGGPI",37,0)
 W ?SPNT5,$S(SLCS+SLCM+SLCP+SLCL>0:$J(SLCUMS+SLCUMM+SLCUMP+SLCUML/(SLCS+SLCM+SLCP+SLCL),3,1),1:"N/A")
"RTN","SPNAGGPI",38,0)
 W !,"Diener SWLS Durability",?SPNT1,$S(+SLUCS:SLUCUMS/SLUCS,1:"N/A"),?SPNT2,$S(+SLUCM:SLUCUMM/SLUCM,1:"N/A"),?SPNT3,$S(+SLUCP:SLUCUMP/SLUCP,1:"N/A"),?SPNT4,$S(+SLUCL:SLUCUML/SLUCL,1:"N/A")
"RTN","SPNAGGPI",39,0)
 W ?SPNT5,$S(SLUCS+SLUCM+SLUCP+SLUCL>0:$J(SLUCUMS+SLUCUMM+SLUCUMP+SLUCUML/(SLUCS+SLUCM+SLUCP+SLUCL),3,1),1:"N/A")
"RTN","SPNAGGPI",40,0)
 Q
"RTN","SPNAGGPO")
0^4^B18603624
"RTN","SPNAGGPO",1,0)
SPNAGGPO ;SD/CM- PRINT AGGREGATE OUTPT OUTCOMES; 2-21-2003
"RTN","SPNAGGPO",2,0)
 ;;2.0;Spinal Cord Dysfunction;**20,24**;01/02/97
"RTN","SPNAGGPO",3,0)
 ;
"RTN","SPNAGGPO",4,0)
PRINT ;
"RTN","SPNAGGPO",5,0)
 S U="^"
"RTN","SPNAGGPO",6,0)
 W !!
"RTN","SPNAGGPO",7,0)
 S SPNPD0=0 F  S SPNPD0=$O(^SPNL(154.1,"B",SPNPD0)) Q:'+SPNPD0  D OIEN^SPNAGGO
"RTN","SPNAGGPO",8,0)
 W !,?18,"OUTPATIENT Rehabilitation Outcomes Report"
"RTN","SPNAGGPO",9,0)
 W !,?24,"Date of Report: ",$$FMTE^XLFDT($$NOW^XLFDT,"5DZP")
"RTN","SPNAGGPO",10,0)
 W !,?12,"Based on Care End Dates from ",$$FMTE^XLFDT(BDATE,"5DZP")," to ",$$FMTE^XLFDT(EDATE,"5DZP"),!!
"RTN","SPNAGGPO",11,0)
 S LINE="-" F I=1:1:80 W LINE
"RTN","SPNAGGPO",12,0)
 W !,?SPNT1,"HI TETRA",?SPNT2,"LO TETRA",?SPNT3,"PARA",?SPNT4,"ASIA D",?SPNT5,"ALL",!
"RTN","SPNAGGPO",13,0)
 W !,"# and % of Patients",?SPNT1,SPNSEVC," (",$S(+SPNDIAGC:$J(SPNSEVC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT2,SPNMODC," (",$S(+SPNDIAGC:$J(SPNMODC/SPNDIAGC*100,2,0),1:0),"%)"
"RTN","SPNAGGPO",14,0)
 W ?SPNT3,SPNPARC," (",$S(+SPNDIAGC:$J(SPNPARC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT4,SPNLOWC," (",$S(+SPNDIAGC:$J(SPNLOWC/SPNDIAGC*100,2,0),1:0),"%)",?SPNT5,SPNDIAGC," (100%)"
"RTN","SPNAGGPO",15,0)
 W !,"Age (yrs)",?SPNT1,$S(+SPNSEVC:$J(SPNAGES/SPNSEVC,3,1),1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNAGEM/SPNMODC,3,1),1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNAGEP/SPNPARC,3,1),1:"N/A"),?SPNT4,$S(+SPNLOWC:$J(SPNAGEL/SPNLOWC,3,1),1:"N/A")
"RTN","SPNAGGPO",16,0)
 W ?SPNT5,$S(SPNDIAGC>0:$J(SPNAGES+SPNAGEM+SPNAGEP+SPNAGEL/SPNDIAGC,3,1),1:"N/A")
"RTN","SPNAGGPO",17,0)
 W !,"Age Range",?SPNT1,MINAGES,"-",MAXAGES,?SPNT2,MINAGEM,"-",MAXAGEM,?SPNT3,MINAGEP,"-",MAXAGEP,?SPNT4,MINAGEL,"-",MAXAGEL,?SPNT5,AGEL,"-",AGEH
"RTN","SPNAGGPO",18,0)
 W !,"Gender (% Male pts)",?SPNT1,$S(+SPNSEVC:$J(SPNSEXS/SPNSEVC*100,2,0)_"%",1:"N/A"),?SPNT2,$S(+SPNMODC:$J(SPNSEXM/SPNMODC*100,2,0)_"%",1:"N/A"),?SPNT3,$S(+SPNPARC:$J(SPNSEXP/SPNPARC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPO",19,0)
 W ?SPNT4,$S(+SPNLOWC:$J(SPNSEXL/SPNLOWC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPO",20,0)
 W ?SPNT5,$S(+SPNDIAGC:$J(SPNSEXS+SPNSEXM+SPNSEXP+SPNSEXL/SPNDIAGC*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPO",21,0)
 ;W !,"Length of Rehab (days)",?SPNT1,$S(+LORSC:SPNLORS/LORSC,1:"N/A"),?SPNT2,$S(+LORMC:SPNLORM/LORMC,1:"N/A"),?SPNT3,$S(+LORPC:SPNLORP/LORPC,1:"N/A"),?SPNT4
"RTN","SPNAGGPO",22,0)
 ;W $S(+LORLC:SPNLORL/LORLC,1:"N/A"),?SPNT5,$S(+(LORSC+LORMC+LORPC+LORLC):$J(SPNLORS+SPNLORM+SPNLORP+SPNLORL/(LORSC+LORMC+LORPC+LORLC),3,0),1:"N/A")
"RTN","SPNAGGPO",23,0)
 ;W !,"Length of Rehab Range",?SPNT1,MINLORS,"-",MAXLORS,?SPNT2,MINLORM,"-",MAXLORM,?SPNT3,MINLORP,"-",MAXLORP,?SPNT4,MINLORL,"-",MAXLORL,?SPNT5,LORL,"-",LORH
"RTN","SPNAGGPO",24,0)
 W !,"Total FIM Change",?SPNT1,$S(+TFCS:TFCUMS/TFCS,1:"N/A"),?SPNT2,$S(+TFCM:TFCUMM/TFCM,1:"N/A"),?SPNT3,$S(+TFCP:TFCUMP/TFCP,1:"N/A"),?SPNT4,$S(+TFCL:TFCUML/TFCL,1:"N/A")
"RTN","SPNAGGPO",25,0)
 W ?SPNT5,$S(TFCS+TFCM+TFCP+TFCL>0:$J(TFCUMS+TFCUMM+TFCUMP+TFCUML/(TFCS+TFCM+TFCP+TFCL),3,1),1:"N/A")
"RTN","SPNAGGPO",26,0)
 ;W !,"MSCIS Total FIM Change",?SPNT1,12.4,?SPNT2,27.8,?SPNT3,41.5,?SPNT4,41.2,?SPNT5,35.9
"RTN","SPNAGGPO",27,0)
 ;W !,"FIM Efficiency",?SPNT1,$S(+SPNLORS:$J(TFCUMS/SPNLORS,3,2),1:"N/A"),?SPNT2,$S(+SPNLORM:$J(TFCUMM/SPNLORM,3,2),1:"N/A"),?SPNT3,$S(+SPNLORP:$J(TFCUMP/SPNLORP,3,2),1:"N/A")
"RTN","SPNAGGPO",28,0)
 ;W ?SPNT4,$S(+SPNLORL:$J(TFCUML/SPNLORL,3,2),1:"N/A"),?SPNT5,$S(SPNLORS+SPNLORM+SPNLORP+SPNLORL>0:$J(TFCUMS+TFCUMM+TFCUMP+TFCUML/(SPNLORS+SPNLORM+SPNLORP+SPNLORL),3,2),1:"N/A")
"RTN","SPNAGGPO",29,0)
 ;W !,"MSCIS FIM Efficiency",?SPNT1,"0.13",?SPNT2,"0.28",?SPNT3,"0.76",?SPNT4,"0.84",?SPNT5,"0.55"
"RTN","SPNAGGPO",30,0)
 W !,"FIM Goal Attainment",?SPNT1,$S(+TFGCS:TFGCUMS/TFGCS,1:"N/A"),?SPNT2,$S(+TFGCM:TFGCUMM/TFGCM,1:"N/A"),?SPNT3,$S(+TFGCP:TFGCUMP/TFGCP,1:"N/A"),?SPNT4,$S(+TFGCL:TFGCUML/TFGCL,1:"N/A")
"RTN","SPNAGGPO",31,0)
 W ?SPNT5,$S(TFGCS+TFGCM+TFGCP+TFGCL>0:$J(TFGCUMS+TFGCUMM+TFGCUMP+TFGCUML/(TFGCS+TFGCM+TFGCP+TFGCL),3,1),1:"N/A")
"RTN","SPNAGGPO",32,0)
 ;W !,"% Discharged to Community",?SPNT1,$S(+COMDISS:COMDISS/LORSC*100_"%",1:"N/A"),?SPNT2,$S(+COMDISM:COMDISM/LORMC*100_"%",1:"N/A"),?SPNT3,$S(+COMDISP:COMDISP/LORPC*100_"%",1:"N/A"),?SPNT4,$S(+COMDISL:COMDISL/LORLC*100_"%",1:"N/A")
"RTN","SPNAGGPO",33,0)
 ;W ?SPNT5,$S(LORSC+LORMC+LORPC+LORLC>0:$J(COMDISS+COMDISM+COMDISP+COMDISL/(LORSC+LORMC+LORPC+LORLC)*100,2,0)_"%",1:"N/A")
"RTN","SPNAGGPO",34,0)
 W !,"FIM Durability",?SPNT1,$S(+TFUCS:TFUCUMS/TFUCS,1:"N/A"),?SPNT2,$S(+TFUCM:TFUCUMM/TFUCM,1:"N/A"),?SPNT3,$S(+TFUCP:TFUCUMP/TFUCP,1:"N/A"),?SPNT4,$S(+TFUCL:TFUCUML/TFUCL,1:"N/A")
"RTN","SPNAGGPO",35,0)
 W ?SPNT5,$S(TFUCS+TFUCM+TFUCP+TFUCL>0:$J(TFUCUMS+TFUCUMM+TFUCUMP+TFUCUML/(TFUCS+TFUCM+TFUCP+TFUCL),3,1),1:"N/A")
"RTN","SPNAGGPO",36,0)
 W !,"Diener SWLS Change",?SPNT1,$S(+SLCS:SLCUMS/SLCS,1:"N/A"),?SPNT2,$S(+SLCM:SLCUMM/SLCM,1:"N/A"),?SPNT3,$S(+SLCP:SLCUMP/SLCP,1:"N/A"),?SPNT4,$S(+SLCL:SLCUML/SLCL,1:"N/A")
"RTN","SPNAGGPO",37,0)
 W ?SPNT5,$S(SLCS+SLCM+SLCP+SLCL>0:$J(SLCUMS+SLCUMM+SLCUMP+SLCUML/(SLCS+SLCM+SLCP+SLCL),3,1),1:"N/A")
"RTN","SPNAGGPO",38,0)
 W !,"Diener SWLS Durability",?SPNT1,$S(+SLUCS:SLUCUMS/SLUCS,1:"N/A"),?SPNT2,$S(+SLUCM:SLUCUMM/SLUCM,1:"N/A"),?SPNT3,$S(+SLUCP:SLUCUMP/SLUCP,1:"N/A"),?SPNT4,$S(+SLUCL:SLUCUML/SLUCL,1:"N/A")
"RTN","SPNAGGPO",39,0)
 W ?SPNT5,$S(SLUCS+SLUCM+SLUCP+SLUCL>0:$J(SLUCUMS+SLUCUMM+SLUCUMP+SLUCUML/(SLUCS+SLUCM+SLUCP+SLUCL),3,1),1:"N/A")
"RTN","SPNAGGPO",40,0)
 Q
"RTN","SPNFAP1")
0^5^B39197527
"RTN","SPNFAP1",1,0)
SPNFAP1 ;SAN/WDE/Print routine for pts with future appt's
"RTN","SPNFAP1",2,0)
 ;;2.0;Spinal Cord Dysfunction;**13,24**;01/02/1997
"RTN","SPNFAP1",3,0)
 ; Prints patients with future appts
"RTN","SPNFAP1",4,0)
 ;
"RTN","SPNFAP1",5,0)
EN ;
"RTN","SPNFAP1",6,0)
 K ^UTILITY($J)
"RTN","SPNFAP1",7,0)
 S SPNLEXIT=0 D EN1^SPNPRTMT Q:SPNLEXIT  ;Filters
"RTN","SPNFAP1",8,0)
DATE ;
"RTN","SPNFAP1",9,0)
 K %DT
"RTN","SPNFAP1",10,0)
 S Y=DT X ^DD("DD") S SPNDEF=$P(Y,"@",1)
"RTN","SPNFAP1",11,0)
 S %DT("A")="Enter a START date: "
"RTN","SPNFAP1",12,0)
 S %DT("B")=SPNDEF
"RTN","SPNFAP1",13,0)
 S %DT="AE"
"RTN","SPNFAP1",14,0)
 D ^%DT I Y=-1 W !,"Option aborted!" D ZAP Q
"RTN","SPNFAP1",15,0)
 S SPNSTRT=Y
"RTN","SPNFAP1",16,0)
 ;ending date
"RTN","SPNFAP1",17,0)
 S %DT("A")="Enter a ENDING date: "
"RTN","SPNFAP1",18,0)
 S %DT(0)=SPNSTRT
"RTN","SPNFAP1",19,0)
 S X1=SPNSTRT,X2=15 D C^%DTC S Y=X X ^DD("DD") S %DT("B")=$P(Y,"@",1)
"RTN","SPNFAP1",20,0)
 S %DT="AE"
"RTN","SPNFAP1",21,0)
 D ^%DT I Y=-1 W !,"Option aborted!" D ZAP Q
"RTN","SPNFAP1",22,0)
 S SPNEND=Y_.2359
"RTN","SPNFAP1",23,0)
PROMPT ;
"RTN","SPNFAP1",24,0)
 ;ask if they want only pt in the reg..
"RTN","SPNFAP1",25,0)
 ;ask if they want only pts with a sci indicator in file 2..
"RTN","SPNFAP1",26,0)
 ;ask if they want both,  Pts in 154 and pts in 2 with an indicator
"RTN","SPNFAP1",27,0)
 K DIR S DIR(0)="SOM^1:Patients in the Registry only.;2:Patients marked as SCI but not in the Registry.;3:Both."
"RTN","SPNFAP1",28,0)
 D ^DIR
"RTN","SPNFAP1",29,0)
 I (Y="^")!('+Y) D ZAP Q
"RTN","SPNFAP1",30,0)
 S SPNSEL=Y
"RTN","SPNFAP1",31,0)
 S SPNCNT=0
"RTN","SPNFAP1",32,0)
 I SPNSEL'=1 W !!,"This report should be queued to run during off hours.",!
"RTN","SPNFAP1",33,0)
DEV S ZTSAVE("SPN*")=""
"RTN","SPNFAP1",34,0)
 D DEVICE^SPNPRTMT("JUMPIN^SPNFAP1","Patients with future Appointments",.ZTSAVE) Q:SPNLEXIT
"RTN","SPNFAP1",35,0)
TASK ;
"RTN","SPNFAP1",36,0)
 I SPNIO="Q" D ZAP Q  ;queued from spnprtmt
"RTN","SPNFAP1",37,0)
JUMPIN ;
"RTN","SPNFAP1",38,0)
 ;
"RTN","SPNFAP1",39,0)
 U IO
"RTN","SPNFAP1",40,0)
 S SPNCNT=0
"RTN","SPNFAP1",41,0)
 I SPNSEL=1 D SCDONLY
"RTN","SPNFAP1",42,0)
 I SPNSEL=1 D PRINT I $E(IOST,1)="P" W @IOF X ^%ZIS("C")
"RTN","SPNFAP1",43,0)
 I SPNSEL=1 I $E(IOST,1)="C" I SPNLEXIT'=1 N DIR S DIR(0)="E" D ^DIR W @IOF Q
"RTN","SPNFAP1",44,0)
 I SPNSEL=1 G ZAP Q:SPNLEXIT=1
"RTN","SPNFAP1",45,0)
 D BOTH D PRINT X ^%ZIS("C")
"RTN","SPNFAP1",46,0)
 I $E(IOST,1)="C" I SPNLEXIT'=1 N DIR S DIR(0)="E" D ^DIR W @IOF Q
"RTN","SPNFAP1",47,0)
 D ZAP
"RTN","SPNFAP1",48,0)
 K SPNLEXIT
"RTN","SPNFAP1",49,0)
 Q
"RTN","SPNFAP1",50,0)
ZAP ;****************************************************************
"RTN","SPNFAP1",51,0)
 K ^UTILITY($J),SPNEND,SPNSTRT,SPNSEL,Y,X,SPNDFN,SPNP2,SPNP3,SPNP4
"RTN","SPNFAP1",52,0)
 K SPNA,SPNQ,SPNIO,SPNCNT,SPNDFN,DATA,SPNCHK,SPNAPPT
"RTN","SPNFAP1",53,0)
 K SPNCL,SPNDT,SPNDATA,SPNTIM,SPNSSN,SPNPT
"RTN","SPNFAP1",54,0)
 K SDARRAY,SDCOUNT,SDDATE,SDCLIEN
"RTN","SPNFAP1",55,0)
 K %DT,SPNTAB
"RTN","SPNFAP1",56,0)
 Q
"RTN","SPNFAP1",57,0)
SCDONLY S SPNDFN=0,DATA="" F  S SPNDFN=$O(^SPNL(154,SPNDFN)) Q:(SPNDFN="")!('+SPNDFN)  D
"RTN","SPNFAP1",58,0)
 .I '$$EN2^SPNPRTMT(SPNDFN) Q
"RTN","SPNFAP1",59,0)
 .D APPT
"RTN","SPNFAP1",60,0)
 Q
"RTN","SPNFAP1",61,0)
 ;--------------------------------------------------------------------
"RTN","SPNFAP1",62,0)
BOTH ;
"RTN","SPNFAP1",63,0)
 S SPNDFN=0 F  S SPNDFN=$O(^DPT(SPNDFN)) Q:(SPNDFN="")!('+SPNDFN)  D
"RTN","SPNFAP1",64,0)
 .I SPNSEL=3 I $D(^SPNL(154,SPNDFN,0)) Q:'$$EN2^SPNPRTMT(SPNDFN)  D APPT Q
"RTN","SPNFAP1",65,0)
 .S SPNCHK=$P($G(^DPT(SPNDFN,57)),U,4) I +SPNCHK D APPT
"RTN","SPNFAP1",66,0)
 .I $E(IOST,1)="C" I SPNDFN#100=62 W "."
"RTN","SPNFAP1",67,0)
 .Q
"RTN","SPNFAP1",68,0)
 Q
"RTN","SPNFAP1",69,0)
 ;---------------------------------------------------------------------
"RTN","SPNFAP1",70,0)
APPT ;
"RTN","SPNFAP1",71,0)
 I SPNSEL=2 Q:$D(^SPNL(154,SPNDFN,0))  ;pt file only pt is in 154
"RTN","SPNFAP1",72,0)
 S SPNCNT=SPNCNT+1 I $E(IOST,1)="C" I SPNCNT#10=0 W "."
"RTN","SPNFAP1",73,0)
 S SDARRAY(1)=SPNSTRT_";"_SPNEND
"RTN","SPNFAP1",74,0)
 S SDARRAY(3)="R"
"RTN","SPNFAP1",75,0)
 S SDARRAY(4)=SPNDFN
"RTN","SPNFAP1",76,0)
 S SDARRAY("FLDS")="1;2"
"RTN","SPNFAP1",77,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SPNFAP1",78,0)
 I SDCOUNT>0 D
"RTN","SPNFAP1",79,0)
 .S SDCLIEN=0 F  S SDCLIEN=$O(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN)) Q:'+SDCLIEN  D
"RTN","SPNFAP1",80,0)
 ..S SDDATE=0 F  S SDDATE=$O(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE)) Q:'+SDDATE  D
"RTN","SPNFAP1",81,0)
 ...S SDAPPT=$G(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE))
"RTN","SPNFAP1",82,0)
 ...S SPNAPPT=$P($G(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE)),U,1)
"RTN","SPNFAP1",83,0)
 ...S SPNCL=$P(SDAPPT,U,2) S SPNCL=$P(SPNCL,";",2)
"RTN","SPNFAP1",84,0)
 ...Q
"RTN","SPNFAP1",85,0)
 ..Q
"RTN","SPNFAP1",86,0)
 .I SPNSEL'=2 S SPNP2=$E($$GET1^DIQ(154,SPNDFN_",",.03),1,13),SPNP3=$E($$GET1^DIQ(154,SPNDFN_",",2.1),1,3),SPNP4=$E($$GET1^DIQ(154,SPNDFN_",",1.1),1,3)
"RTN","SPNFAP1",87,0)
 .I SPNSEL=2 S SPNP2="",SPNP3="",SPNP4=""
"RTN","SPNFAP1",88,0)
 .S ^UTILITY($J,$P(SPNAPPT,".",1),SPNAPPT,SPNCL,$P(^DPT(SPNDFN,0),U,1),$P(^DPT(SPNDFN,0),U,9))=SPNAPPT_"^"_SPNP2_"^"_SPNP3_"^"_SPNP4
"RTN","SPNFAP1",89,0)
 .S ^UTILITY($J,$P(SPNAPPT,".",1))=""
"RTN","SPNFAP1",90,0)
 I SDCOUNT<0 D
"RTN","SPNFAP1",91,0)
 .I $D(^TMP($J,"SDAMA301",101)) W !!,"Database unavailable. Try later."
"RTN","SPNFAP1",92,0)
 .I $D(^TMP($J,"SDAMA301",116)) W !!,"Pt doesn't exist in Vista system."
"RTN","SPNFAP1",93,0)
 .Q
"RTN","SPNFAP1",94,0)
 I SDCOUNT'=0 K ^TMP($J,"SDAMA301")
"RTN","SPNFAP1",95,0)
 Q
"RTN","SPNFAP1",96,0)
PRINT ;
"RTN","SPNFAP1",97,0)
 S SPNPA=1
"RTN","SPNFAP1",98,0)
 S Y=SPNSTRT X ^DD("DD") S SPNSTRT=Y S Y=SPNEND X ^DD("DD") S SPNEND=Y
"RTN","SPNFAP1",99,0)
 K Y
"RTN","SPNFAP1",100,0)
 D HDR
"RTN","SPNFAP1",101,0)
 I '$D(^UTILITY($J)) D
"RTN","SPNFAP1",102,0)
 .W !,"-----------------------------------------------------------------------------"
"RTN","SPNFAP1",103,0)
 .W !!?10,"**** No Data for this report. ****"  D  Q
"RTN","SPNFAP1",104,0)
 .I $E(IOST,1)="C" N DIR S DIR(0)="E" D ^DIR K Y
"RTN","SPNFAP1",105,0)
 .D CLOSE^SPNPRTMT
"RTN","SPNFAP1",106,0)
 .Q
"RTN","SPNFAP1",107,0)
 S SPNDT=0 F  S SPNDT=$O(^UTILITY($J,SPNDT)) Q:(SPNDT="")!('+SPNDT)  D P1 W !
"RTN","SPNFAP1",108,0)
 Q
"RTN","SPNFAP1",109,0)
 ;----------------------------------------------------------------------
"RTN","SPNFAP1",110,0)
P1 ;Get times of the appts for the given day
"RTN","SPNFAP1",111,0)
 S Y=SPNDT X ^DD("DD") W !,Y S Y="" W !,"-----------------------------------------------------------------------------"
"RTN","SPNFAP1",112,0)
 S SPNTIM=0 F  S SPNTIM=$O(^UTILITY($J,SPNDT,SPNTIM)) Q:(SPNTIM="")!('+SPNTIM)  D P2
"RTN","SPNFAP1",113,0)
 Q
"RTN","SPNFAP1",114,0)
P2 ;Get clinic
"RTN","SPNFAP1",115,0)
 S SPNCL="" F  S SPNCL=$O(^UTILITY($J,SPNDT,SPNTIM,SPNCL)) Q:SPNCL=""  D P3
"RTN","SPNFAP1",116,0)
 Q
"RTN","SPNFAP1",117,0)
 ;
"RTN","SPNFAP1",118,0)
P3 ;
"RTN","SPNFAP1",119,0)
 S SPNPT="" F  S SPNPT=$O(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT)) Q:SPNPT=""  S SPNSSN=0 F  S SPNSSN=$O(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT,SPNSSN)) Q:(SPNSSN="")!('+SPNSSN)  D PRT2
"RTN","SPNFAP1",120,0)
 Q
"RTN","SPNFAP1",121,0)
PRT2 ;
"RTN","SPNFAP1",122,0)
 S Y=$P(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT,SPNSSN),U,1) X ^DD("DD")
"RTN","SPNFAP1",123,0)
 W !,$P(Y,"@",2)
"RTN","SPNFAP1",124,0)
 W ?7,$E(SPNCL,1,20)
"RTN","SPNFAP1",125,0)
 W ?28,$E(SPNPT,1,17),?46,$E(SPNSSN,6,9)
"RTN","SPNFAP1",126,0)
 W ?53,$P(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT,SPNSSN),U,2)
"RTN","SPNFAP1",127,0)
 W ?67,$P(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT,SPNSSN),U,3)
"RTN","SPNFAP1",128,0)
 W ?73,$P(^UTILITY($J,SPNDT,SPNTIM,SPNCL,SPNPT,SPNSSN),U,4)
"RTN","SPNFAP1",129,0)
 I $Y>(IOSL-5) D HDR I SPNLEXIT S (SPNDT,SPNTIM,SPNCL,SPNCL,SPNSSN)="END" Q
"RTN","SPNFAP1",130,0)
 Q
"RTN","SPNFAP1",131,0)
HDR ;
"RTN","SPNFAP1",132,0)
 I $E(IOST,1)="P" I SPNPA'=1 W #
"RTN","SPNFAP1",133,0)
 I $E(IOST,1)="C" D  Q:SPNLEXIT
"RTN","SPNFAP1",134,0)
 .I SPNPA=1 W @IOF Q
"RTN","SPNFAP1",135,0)
 .I SPNPA'=1 D  Q:SPNLEXIT
"RTN","SPNFAP1",136,0)
 ..N DIR S DIR(0)="E" D ^DIR I 'Y S SPNLEXIT=1
"RTN","SPNFAP1",137,0)
 ..K Y
"RTN","SPNFAP1",138,0)
 ..W @IOF
"RTN","SPNFAP1",139,0)
 ..Q
"RTN","SPNFAP1",140,0)
 .Q
"RTN","SPNFAP1",141,0)
 Q:SPNLEXIT
"RTN","SPNFAP1",142,0)
 S SPNTAB=$S(SPNSEL=1:18,SPNSEL=2:12,1:2)
"RTN","SPNFAP1",143,0)
 W !?SPNTAB,$S(SPNSEL=1:"Patients in the Registry only",SPNSEL=2:"Patients marked as SCI but not in the Registry",1:"Combined report -- Pts in Registry AND Pts marked as SCI but not in Registry")
"RTN","SPNFAP1",144,0)
 W !?18,"Listing appointments from ",?72,"Page: ",SPNPA
"RTN","SPNFAP1",145,0)
 W !?15,SPNSTRT," to ",SPNEND,!
"RTN","SPNFAP1",146,0)
 W !,"Appointment date"
"RTN","SPNFAP1",147,0)
 W !,"Time",?7,"Clinic",?28,"Patient",?46,"SSN",?53,"Reg",?67,"SCI",?73,"SCI"
"RTN","SPNFAP1",148,0)
 W !,?53,"Status",?67,"LVL",?71,"NETWRK"
"RTN","SPNFAP1",149,0)
 I SPNPA'=1 W !,"-----------------------------------------------------------------------------"
"RTN","SPNFAP1",150,0)
 S SPNPA=SPNPA+1
"RTN","SPNHL1")
0^6^B20412880
"RTN","SPNHL1",1,0)
SPNHL1 ;WDE/SAN-DIEGO;Build the hl7 segment for file 154
"RTN","SPNHL1",2,0)
 ;;2.0;Spinal Cord Dysfunction;**10,12,15,24**;01/02/97
"RTN","SPNHL1",3,0)
 ;this routine is called from spnhl7 spnhl7 is called from the
"RTN","SPNHL1",4,0)
 ;edit rtn for file 154
"RTN","SPNHL1",5,0)
EN(SPNFDFN) ;
"RTN","SPNHL1",6,0)
 K OBXCNT,SPNOBR,SPLINE,DATA,X,Y,SPNDD,SPNDT,SPNTMP
"RTN","SPNHL1",7,0)
 ;collect the registration data from 154
"RTN","SPNHL1",8,0)
 S SPNOBR=1,OBXCNT=1
"RTN","SPNHL1",9,0)
 S OBXCNT=1
"RTN","SPNHL1",10,0)
 S SPLINE="",SPLINE=$O(SPMSG(SPLINE),-1)+1
"RTN","SPNHL1",11,0)
 S SPMSG(SPLINE)="OBR|"_SPNOBR_"|||Registration OBR"
"RTN","SPNHL1",12,0)
 ;set up the obr with the date of registration
"RTN","SPNHL1",13,0)
 S X=$$GET1^DIQ(154,SPNFDFN_",",.02,"I"),X=$$HLDATE^HLFNC(X,"TS")
"RTN","SPNHL1",14,0)
 S $P(SPMSG(SPLINE),"|",8)=X S SPLINE=SPLINE+1
"RTN","SPNHL1",15,0)
 S SPNDD=$G(^DD(154,.02,0)),SPNDD=$P(SPNDD,U,1)
"RTN","SPNHL1",16,0)
 ;loop through the fields and set up the message
"RTN","SPNHL1",17,0)
 ;this section will set up all data type of date (ts)
"RTN","SPNHL1",18,0)
 F X=.02,.05,8.8,10.2 D
"RTN","SPNHL1",19,0)
 . S SPNDD=$G(^DD(154,X,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="ERROR"
"RTN","SPNHL1",20,0)
 . S SPDATA=$$GET1^DIQ(154,SPNFDFN_",",X,"I") I $G(SPDATA)'="" D
"RTN","SPNHL1",21,0)
 .. S SPDATA=$$HLDATE^HLFNC(SPDATA,"TS")
"RTN","SPNHL1",22,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|TS|"_X_"^"_SPNDD_"||"_SPDATA
"RTN","SPNHL1",23,0)
 .. S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD=""
"RTN","SPNHL1",24,0)
 .. S (SPDATA,SPNDD)=""
"RTN","SPNHL1",25,0)
 F SPNCOMP=999.06,999.07,999.08 D
"RTN","SPNHL1",26,0)
 . S X=$$GET1^DIQ(154,SPNFDFN_",",SPNCOMP,"") I $G(X)'="" D
"RTN","SPNHL1",27,0)
 .. D ^%DT S SPDATA=Y  ;flip date around to fm type
"RTN","SPNHL1",28,0)
 .. S SPDATA=$$HLDATE^HLFNC(SPDATA,"TS")
"RTN","SPNHL1",29,0)
 .. S SPNDD=$G(^DD(154,SPNCOMP,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="ERROR"
"RTN","SPNHL1",30,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|TS|"_SPNCOMP_"^"_SPNDD_"||"_SPDATA
"RTN","SPNHL1",31,0)
 .. S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD=""
"RTN","SPNHL1",32,0)
 .. S (SPDATA,SPNDD)=""
"RTN","SPNHL1",33,0)
 ;check for date of death if so get it
"RTN","SPNHL1",34,0)
 S SPDATA=$$GET1^DIQ(2,SPNFDFN_",",.351,"I") I $G(SPDATA)'="" D
"RTN","SPNHL1",35,0)
 . S SPDATA=$$HLDATE^HLFNC(SPDATA,"TS")
"RTN","SPNHL1",36,0)
 . S SPMSG(SPLINE)="OBX|"_OBXCNT_"|TS|"_".351"_"^"_"DATE OF DEATH"_"||"_SPDATA
"RTN","SPNHL1",37,0)
 . S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD="",SPDATA=""
"RTN","SPNHL1",38,0)
 ;
"RTN","SPNHL1",39,0)
 ;this secton will set up all data types of free text (ST)
"RTN","SPNHL1",40,0)
 F X=.03,2.1,2.2,2.3,2.4,2.5,2.6,3.1,3.2,3.3,3.4,3.5,5.01,5.11,5.12,6.09,8.3,8.4,8.6,10.3,999.03,999.04,999.05 D
"RTN","SPNHL1",41,0)
 . S SPNDD=$G(^DD(154,X,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="ERROR"
"RTN","SPNHL1",42,0)
 . S SPDATA=$$GET1^DIQ(154,SPNFDFN_",",X) I $G(SPDATA)'="" D
"RTN","SPNHL1",43,0)
 .. S SPNTBL=$S(X=".03":"^VA0504",X="2.2":"^VA0505",X="2.3":"^VA0506",X="2.6":"^VA0507",1:"")
"RTN","SPNHL1",44,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|ST|"_X_"^"_SPNDD_SPNTBL_"||"_SPDATA
"RTN","SPNHL1",45,0)
 .. S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD=""
"RTN","SPNHL1",46,0)
 .. S (SPDATA,SPNDD,SPNTBL)=""
"RTN","SPNHL1",47,0)
 ;
"RTN","SPNHL1",48,0)
 ;set up station suffix from 40.8
"RTN","SPNHL1",49,0)
 S SPMSG(SPLINE)="OBX|"_OBXCNT_"|ST|154.91.2^DIVISION||"_$$EN^SPNMAIN(DUZ)
"RTN","SPNHL1",50,0)
 S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD=""
"RTN","SPNHL1",51,0)
 ;this section is as well data types of free text (ST)
"RTN","SPNHL1",52,0)
 F X=1.1,5.02,5.03,5.04,5.05,5.06,5.07,5.08,5.09,5.1,5.13,5.14,10.1,8.1,8.2 D
"RTN","SPNHL1",53,0)
 . S SPNDD=$G(^DD(154,X,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="ERROR"
"RTN","SPNHL1",54,0)
 . S SPDATA=$$GET1^DIQ(154,SPNFDFN_",",X) I $G(SPDATA)'="" D
"RTN","SPNHL1",55,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|ST|"_X_"^"_SPNDD_"||"_SPDATA
"RTN","SPNHL1",56,0)
 .. S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1,SPNDD=""
"RTN","SPNHL1",57,0)
 .. S (SPDATA,SPNDD)=""
"RTN","SPNHL1",58,0)
 ;this section will collect the etiology information
"RTN","SPNHL1",59,0)
 D GETS^DIQ(154,SPNFDFN_",","4*","","SPNTMP")
"RTN","SPNHL1",60,0)
 S SPNET="" F  S SPNET=$O(SPNTMP(154.004,SPNET)) Q:(SPNET="")!('+SPNET)  D ETIOBR S SPND="" F  S SPND=$O(SPNTMP(154.004,SPNET,SPND)) Q:(SPND="")!('+SPND)  D
"RTN","SPNHL1",61,0)
 . S SPNDD=$G(^DD(154.004,SPND,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="ERROR"
"RTN","SPNHL1",62,0)
 . S X=$G(SPNTMP(154.004,SPNET,SPND)) I $G(X)'="" D
"RTN","SPNHL1",63,0)
 .. I SPND=".02" D ^%DT S X=$$HLDATE^HLFNC(Y,"TS")  ;make hl7 date
"RTN","SPNHL1",64,0)
 .. S SPNTBL=$S(SPND=.01:"^VA503",1:"")
"RTN","SPNHL1",65,0)
 .. S SPDTYPE=$S(SPND=.02:"TS",1:"ST")
"RTN","SPNHL1",66,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|"_SPDTYPE_"|"_SPND_"^"_SPNDD_SPNTBL_"||"_X S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1
"RTN","SPNHL1",67,0)
 .. K SPDTYPE,SPNTBL
"RTN","SPNHL1",68,0)
 .Q
"RTN","SPNHL1",69,0)
EVAL ;
"RTN","SPNHL1",70,0)
 K SPNTMP,SPDATA,SPDD,SPD
"RTN","SPNHL1",71,0)
 D GETS^DIQ(154,SPNFDFN_",","7*","I","SPNTMP")
"RTN","SPNHL1",72,0)
 S SPNET="" F  S SPNET=$O(SPNTMP(154.07,SPNET)) Q:(SPNET="")!('+SPNET)  D EVLOBR S SPND=0 F  S SPND=$O(SPNTMP(154.07,SPNET,SPND)) Q:(SPND="")!('+SPND)  D
"RTN","SPNHL1",73,0)
 . S SPDATA=$G(SPNTMP(154.07,SPNET,SPND,"I")) I $G(SPDATA)'="" D
"RTN","SPNHL1",74,0)
 .. S SPDATA=$$HLDATE^HLFNC(SPDATA,"TS")
"RTN","SPNHL1",75,0)
 .. S SPNDD=$G(^DD(154.07,SPND,0)),SPNDD=$P(SPNDD,U,1) S:SPNDD="" SPNDD="-----"
"RTN","SPNHL1",76,0)
 .. S SPMSG(SPLINE)="OBX|"_OBXCNT_"|TS|"_SPND_"^"_SPNDD_"||"_SPDATA
"RTN","SPNHL1",77,0)
 .. S SPLINE=SPLINE+1,OBXCNT=OBXCNT+1
"RTN","SPNHL1",78,0)
 .. S (SPDATA,SPNDD,SPD)=""
"RTN","SPNHL1",79,0)
 K SPNTMP
"RTN","SPNHL1",80,0)
 Q
"RTN","SPNHL1",81,0)
 ;
"RTN","SPNHL1",82,0)
ETIOBR ;
"RTN","SPNHL1",83,0)
 S SPNOBR=SPNOBR+1
"RTN","SPNHL1",84,0)
 S X=$G(SPNTMP(154.004,SPNET,.02)) D ^%DT S ETDATE=Y K Y,X
"RTN","SPNHL1",85,0)
 S ETDATE=$$HLDATE^HLFNC(ETDATE,"TS")
"RTN","SPNHL1",86,0)
 ;note that this resets the date to an hl7 format
"RTN","SPNHL1",87,0)
 S SPMSG(SPLINE)="OBR|"_SPNOBR_"|||154 ETIOLOGY DATA|||"_ETDATE
"RTN","SPNHL1",88,0)
 S SPLINE=SPLINE+1
"RTN","SPNHL1",89,0)
 S OBXCNT=1
"RTN","SPNHL1",90,0)
 Q
"RTN","SPNHL1",91,0)
EVLOBR ;
"RTN","SPNHL1",92,0)
 S SPNOBR=SPNOBR+1
"RTN","SPNHL1",93,0)
 S SPDT=$G(SPNTMP(154.07,SPNET,.01,"I"))
"RTN","SPNHL1",94,0)
 S SPDT=$$HLDATE^HLFNC(SPDT,"TS")
"RTN","SPNHL1",95,0)
 S SPMSG(SPLINE)="OBR|"_SPNOBR_"|||154 ANNUAL EVAL DATA|||"_SPDT
"RTN","SPNHL1",96,0)
 S SPLINE=SPLINE+1
"RTN","SPNHL1",97,0)
 S OBXCNT=1
"RTN","SPNHL1",98,0)
 Q
"RTN","SPNHL7")
0^7^B8407471
"RTN","SPNHL7",1,0)
SPNHL7 ;WDE/SAN-DIEGO;validate then build the z segment
"RTN","SPNHL7",2,0)
 ;;2.0;Spinal Cord Dysfunction;**10,24**;01/02/97
"RTN","SPNHL7",3,0)
CHK(SPNFDFN) ;
"RTN","SPNHL7",4,0)
 ;       ifn is the record number in SPN(154 it's dinumed to dpt
"RTN","SPNHL7",5,0)
 ;--------------------------------------------------------------------
"RTN","SPNHL7",6,0)
 ;check registration date
"RTN","SPNHL7",7,0)
 S SPNCHK=$$GET1^DIQ(154,SPNFDFN_",",.02)
"RTN","SPNHL7",8,0)
 I $G(SPNCHK)="" D ZAP Q
"RTN","SPNHL7",9,0)
 ;check registration status
"RTN","SPNHL7",10,0)
 S SPNCHK=$$GET1^DIQ(154,SPNFDFN_",",.03)
"RTN","SPNHL7",11,0)
 I $G(SPNCHK)="" D ZAP Q
"RTN","SPNHL7",12,0)
 ;check VA SCI STATUS
"RTN","SPNHL7",13,0)
 ;S SPNCHK=$$GET1^DIQ(154,SPNFDFN_",",2.6)
"RTN","SPNHL7",14,0)
 ;I $G(SPNCHK)="" D ZAP Q
"RTN","SPNHL7",15,0)
 ;check for etiology
"RTN","SPNHL7",16,0)
 ;D GETS^DIQ(154,SPNFDFN_",","4*","","SPNCHK")
"RTN","SPNHL7",17,0)
 ;I $D(SPNCHK)=0 D ZAP Q
"RTN","SPNHL7",18,0)
 ;the record passed the test and we want it
"RTN","SPNHL7",19,0)
CREATE ;this label is also called from the tag auto
"RTN","SPNHL7",20,0)
 K SPMSG
"RTN","SPNHL7",21,0)
 D INIT
"RTN","SPNHL7",22,0)
 I HLDAP="" D ZAP Q  ;cant find the hl7 application
"RTN","SPNHL7",23,0)
 I $P($G(^HL(771,HLDAP,0)),U,2)'="a" D ZAP Q  ;test for active/on
"RTN","SPNHL7",24,0)
 D EN^SPNHPID(SPNFDFN)
"RTN","SPNHL7",25,0)
 D EN^SPNHL1(SPNFDFN)
"RTN","SPNHL7",26,0)
 ;at this point we have the HL7 message in the msg arrary!
"RTN","SPNHL7",27,0)
 D SEND  ;send will send the message off to the hl7 sftw
"RTN","SPNHL7",28,0)
ZAP ;
"RTN","SPNHL7",29,0)
 K SPMSG,X,Y,SPTMP,OBXCNT,SPLINE,DATA,CL,SPNOBR
"RTN","SPNHL7",30,0)
 K HL,HLA,SPNTMP,HLARYTYP,HLECH,HLFORMAT,HLFS,HLMTIEN,HLSAN,HLN,HLQ,HLRESLT
"RTN","SPNHL7",31,0)
 Q
"RTN","SPNHL7",32,0)
AUTO ;this tag is used for loading the AUSTIN system from a server request
"RTN","SPNHL7",33,0)
 ;this should never be ran from a site unless informed to.
"RTN","SPNHL7",34,0)
 S SPNIFN=0 F  S SPNIFN=$O(^SPNL(154,SPNIFN)) Q:(SPNIFN="")!('+SPNIFN)  D
"RTN","SPNHL7",35,0)
 . D CHK(SPNIFN) I $D(SPNCHK) D AUTO^SPNHL71
"RTN","SPNHL7",36,0)
 . K SPNCHK
"RTN","SPNHL7",37,0)
 . Q
"RTN","SPNHL7",38,0)
 Q
"RTN","SPNHL7",39,0)
INIT ;
"RTN","SPNHL7",40,0)
 ;
"RTN","SPNHL7",41,0)
 S HLDAP=$O(^HL(771,"B","SPN-HL7-APP",0))
"RTN","SPNHL7",42,0)
 Q:HLDAP=""  ;cant find the hl7 application
"RTN","SPNHL7",43,0)
 Q:$P($G(^HL(771,HLDAP,0)),U,2)'="a"  ;test for active/on
"RTN","SPNHL7",44,0)
 S HL="HL"
"RTN","SPNHL7",45,0)
 S PEIN=$O(^ORD(101,"B","SPN-HL7-SERVER",0))
"RTN","SPNHL7",46,0)
 D INIT^HLFNC2(PEIN,.HL,0)
"RTN","SPNHL7",47,0)
 S HLCOMP=$E(HL("ECH"),1),HLREP=$E(HL("ECH"),2),HLSUB=$E(HL("ECH"),4),HLFS=HL("FS"),HLQ=HL("Q"),HLECH=HL("ECH")
"RTN","SPNHL7",48,0)
 Q
"RTN","SPNHL7",49,0)
 ;-------------------------------------------------------------------
"RTN","SPNHL7",50,0)
SEND ;
"RTN","SPNHL7",51,0)
 S HLARYTYP="LM",HLFORMAT=1,HLMTIEN="",HLRESLT=""
"RTN","SPNHL7",52,0)
 S P=0 F  S P=$O(SPMSG(P)) Q:P=""  S HLA("HLS",P)=SPMSG(P)
"RTN","SPNHL7",53,0)
 D GENERATE^HLMA(PEIN,HLARYTYP,HLFORMAT,.HLRESLT,HLMTIEN,.HLP)
"RTN","SPNHL7",54,0)
 Q
"RTN","SPNHL7",55,0)
EXIT ;Exit point to clean up all var's
"RTN","SPNHL7",56,0)
 K CL,DATA,ETDAT,ETDATE,HL,HLA,HLARYTYP,HLDAP,HLDAP,HLECH,HLFORMAT,HLFS,HLMTIEN,HLN,HLP,HLQ,HLREP,HLRESLT,HLSAN,HLSUB,INJURY,INJURY,OBXCNT,PEIN,SPD,SPDATA,SPDD,SPDT,SPDTYPE,SPLINE,SPMSG,SPNCAUSE,SPNCHK,SPND,SPND1,SPNDD
"RTN","SPNHL7",57,0)
 K SPNDOC,SPNDT,SPNET,SPNETIOL,SPNFREQ,SPNLDT,SPNLET,SPNLEXAM,SPNLFAC,SPNLFAM,SPNLSEEN,SPNOBR,SPNRDT,SPNTBL,SPNTMP,SPTMP,SPX
"RTN","SPNHPID")
0^8^B309324
"RTN","SPNHPID",1,0)
SPNHPID ;SAN/WDE;Create pid segment
"RTN","SPNHPID",2,0)
 ;;2.0;Spinal Cord Dysfunction;**10,24**;01/02/97
"RTN","SPNHPID",3,0)
EN(SPNFDFN) ;
"RTN","SPNHPID",4,0)
 ;set up vars and build pid segment called from spnhl7 & spnhl71
"RTN","SPNHPID",5,0)
 ;  note that generate builds the MSH segment and puts it on top.
"RTN","SPNHPID",6,0)
 Q:$G(^DPT(SPNFDFN,0))=""  ;
"RTN","SPNHPID",7,0)
INI ;Build message header section
"RTN","SPNHPID",8,0)
 S HLECH=","
"RTN","SPNHPID",9,0)
 S HLQ="""",HLFS="^"
"RTN","SPNHPID",10,0)
 D NOW^%DTC S SPNDT=$$HLDATE^HLFNC(%,"TS")
"RTN","SPNHPID",11,0)
 S SPMSG=""
"RTN","SPNHPID",12,0)
 S SPMSG(1)=$$EN^VAFCPID(SPNFDFN,",3,5,7,8,16,19,.315",1)
"RTN","SPNHPID",13,0)
 ;S SPMSG(1)=$$EN^VAFHLPID(SPNFDFN,",3,5,7,8,16,19,.315",1)
"RTN","SPNHPID",14,0)
 K SPNDT
"RTN","SPNLGU")
0^9^B1473907
"RTN","SPNLGU",1,0)
SPNLGU ; ISC-SF/GMB - SCD LOCAL GATHER UTILITIES;11 MAY 94 [07/12/94]
"RTN","SPNLGU",2,0)
 ;;2.0;Spinal Cord Dysfunction;**24**;01/02/1997
"RTN","SPNLGU",3,0)
TRANSLAT(Y,FILENUM,FIELDNUM) ; Translate set of codes to clear text meaning
"RTN","SPNLGU",4,0)
 N C
"RTN","SPNLGU",5,0)
 S C=$P(^DD(FILENUM,FIELDNUM,0),U,2)
"RTN","SPNLGU",6,0)
 D Y^DIQ
"RTN","SPNLGU",7,0)
 Q Y
"RTN","SPNLGU",8,0)
STOPCODE(CLINIC) ; follow clinic ptr to hospital loc to stop code num
"RTN","SPNLGU",9,0)
 D SRAPI
"RTN","SPNLGU",10,0)
 Q $G(SPNSTPCD)
"RTN","SPNLGU",11,0)
SRAPI ;
"RTN","SPNLGU",12,0)
 S SDARRAY(1)=FDATE_";"_TDATE
"RTN","SPNLGU",13,0)
 S SDARRAY(2)=+CLINIC
"RTN","SPNLGU",14,0)
 S SDARRAY(3)="R;I"
"RTN","SPNLGU",15,0)
 S SDARRAY("FLDS")=13
"RTN","SPNLGU",16,0)
 S SDDATE=$P(APPTINFO,U,1)
"RTN","SPNLGU",17,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SPNLGU",18,0)
 I SDCOUNT<0 D
"RTN","SPNLGU",19,0)
 .I $D(^TMP($J,"SDAMA301",101)) W !!,"Database unavailable. Try later."
"RTN","SPNLGU",20,0)
 .I $D(^TMP($J,"SDAMA301",116)) W !!,"Pt doesn't exit in Vista system."
"RTN","SPNLGU",21,0)
 .Q
"RTN","SPNLGU",22,0)
 S SPNSTPCD=$P(^TMP($J,"SDAMA301",+CLINIC,DFN,SDDATE),U,13)
"RTN","SPNLGU",23,0)
 S SPNSTPCD=$P(SPNSTPCD,";",2)
"RTN","SPNLGU",24,0)
 I SDCOUNT'=0 K ^TMP($J,"SDAMA301")
"RTN","SPNLGU",25,0)
 K SDARRAY,SDCOUNT,SDDATE
"RTN","SPNLGU",26,0)
 Q
"RTN","SPNMISS")
0^10^B6670725
"RTN","SPNMISS",1,0)
SPNMISS ;WDE/SAN-DIEGO;CLEANUP REPORT ON MISSING DATA ELEMENTS; 1-18-2005
"RTN","SPNMISS",2,0)
 ;;2.0;Spinal Cord Dysfunction;**24**;01/02/97
"RTN","SPNMISS",3,0)
 ;
"RTN","SPNMISS",4,0)
 ;
"RTN","SPNMISS",5,0)
EN ;
"RTN","SPNMISS",6,0)
 W !!,"This report provides a list of patients with missing data in the SCD Registry."
"RTN","SPNMISS",7,0)
 W !,"Data elements checked are: Registration Status, SCI Network, SSN, Integration"
"RTN","SPNMISS",8,0)
 W !,"Control Number, Registration Date, and Date of Last Review."
"RTN","SPNMISS",9,0)
 W !!,"After viewing or printing the report, simply edit the patient records,"
"RTN","SPNMISS",10,0)
 W !,"inserting information into fields identified as having missing data."
"RTN","SPNMISS",11,0)
 W !,"Cleaning up such records is important to future development of the Registry.",!!
"RTN","SPNMISS",12,0)
 K ^TMP($J)
"RTN","SPNMISS",13,0)
 S SPNLEXIT=""
"RTN","SPNMISS",14,0)
 S ZTSAVE(DUZ)=""
"RTN","SPNMISS",15,0)
  D DEVICE^SPNPRTMT("QUED^SPNMISS","SCD Missing Data Report",.ZTSAVE) Q:SPNLEXIT
"RTN","SPNMISS",16,0)
 Q:POP
"RTN","SPNMISS",17,0)
 I $G(SPNIO)["Q" Q
"RTN","SPNMISS",18,0)
QUED ;
"RTN","SPNMISS",19,0)
 S (SPNCNT)=0
"RTN","SPNMISS",20,0)
 S DFN=0 F  S DFN=$O(^SPNL(154,DFN)) Q:(DFN=0)!('+DFN)  D
"RTN","SPNMISS",21,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNMISS",22,0)
 .I $E(IOST,1)="C" I SPNCNT#10=0 W "."
"RTN","SPNMISS",23,0)
 .S PTNAM=$$GET1^DIQ(154,DFN_",",.01)
"RTN","SPNMISS",24,0)
 .Q:PTNAM=""  ;2-9-05
"RTN","SPNMISS",25,0)
 .F FIELD=.03,1.1,.02,.05 D TEST
"RTN","SPNMISS",26,0)
 .F FIELD=991.01,.09 D TTWO  ;check ssn and icn
"RTN","SPNMISS",27,0)
 .D DUPSSN
"RTN","SPNMISS",28,0)
 .Q
"RTN","SPNMISS",29,0)
 D ^SPNMISS2
"RTN","SPNMISS",30,0)
KILL ;
"RTN","SPNMISS",31,0)
 K ^TMP($J),DATA,PAGE,STATS,EQ,PTNAM,DFN,SPNCON,SPNDD,SPNSSN,FIELD,SUBCNT,SSN,SPNLEXIT
"RTN","SPNMISS",32,0)
 K SPNIO,SPNCNT,SS,DUPDFN
"RTN","SPNMISS",33,0)
 Q
"RTN","SPNMISS",34,0)
TEST S DATA="",DATA=$$GET1^DIQ(154,DFN_",",FIELD)
"RTN","SPNMISS",35,0)
 I DATA="" D
"RTN","SPNMISS",36,0)
 .S SPNDD=$G(^DD(154,FIELD,0)),SPNDD=$P(SPNDD,U,1)
"RTN","SPNMISS",37,0)
 .I $D(^TMP($J,PTNAM,DFN,0))=0 S ^TMP($J,PTNAM,DFN,0)=""
"RTN","SPNMISS",38,0)
 .S ^TMP($J,PTNAM,DFN,FIELD)=SPNDD
"RTN","SPNMISS",39,0)
 Q
"RTN","SPNMISS",40,0)
TTWO ;test on patient file fields
"RTN","SPNMISS",41,0)
 S DATA="",DATA=$$GET1^DIQ(2,DFN_",",FIELD)
"RTN","SPNMISS",42,0)
 I DATA="" D
"RTN","SPNMISS",43,0)
 .S SPNDD=$G(^DD(2,FIELD,0)),SPNDD=$P(SPNDD,U,1)
"RTN","SPNMISS",44,0)
 .I $D(^TMP($J,PTNAM,DFN,0))=0 S ^TMP($J,PTNAM,DFN,0)=""
"RTN","SPNMISS",45,0)
 .S ^TMP($J,PTNAM,DFN,FIELD)=SPNDD
"RTN","SPNMISS",46,0)
 Q
"RTN","SPNMISS",47,0)
DUPSSN ;
"RTN","SPNMISS",48,0)
 S SUBCNT=0 S SSN=$$GET1^DIQ(2,DFN_",",.09)
"RTN","SPNMISS",49,0)
 S DUPDFN=0 F  S DUPDFN=$O(^DPT("SSN",SSN,DUPDFN)) Q:(DUPDFN=0)!('+DUPDFN)  I DUPDFN'=DFN D
"RTN","SPNMISS",50,0)
 .S SUBCNT=SUBCNT+1
"RTN","SPNMISS",51,0)
 .I $D(^TMP($J,PTNAM,DFN,0))=0 S ^TMP($J,PTNAM,DFN,0)=""
"RTN","SPNMISS",52,0)
 .S ^TMP($J,PTNAM,DFN,"SSN",SUBCNT)=DUPDFN
"RTN","SPNMISS",53,0)
 .Q
"RTN","SPNMISS",54,0)
 Q
"RTN","SPNMISS2")
0^11^B9636018
"RTN","SPNMISS2",1,0)
SPNMISS2 ;WDE/SAN-DIEGO;PRINT REPORT ON MISSING DATA ELEMENTS; 1-18-2005
"RTN","SPNMISS2",2,0)
 ;;2.0;Spinal Cord Dysfunction;**24**;01/02/97
"RTN","SPNMISS2",3,0)
 ;
"RTN","SPNMISS2",4,0)
 ;
"RTN","SPNMISS2",5,0)
EN ;
"RTN","SPNMISS2",6,0)
 W @IOF
"RTN","SPNMISS2",7,0)
 S PAGE=0,SPNCON=""
"RTN","SPNMISS2",8,0)
 D HDR
"RTN","SPNMISS2",9,0)
 S EQ="",$P(EQ,"-",80)="-"
"RTN","SPNMISS2",10,0)
 I $D(^TMP($J))=0 W !,"     No Missing Data to Report." D KILL^SPNMISS Q
"RTN","SPNMISS2",11,0)
 S PTNAM="" F  S PTNAM=$O(^TMP($J,PTNAM)) Q:PTNAM=""   S DFN=0 F  S DFN=$O(^TMP($J,PTNAM,DFN)) Q:(DFN=0)!('+DFN)  D  Q:SPNCON="^"
"RTN","SPNMISS2",12,0)
 .S X=$$GET1^DIQ(2,DFN_",",.09) S SPNSSN=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,9)
"RTN","SPNMISS2",13,0)
 .W !,$$GET1^DIQ(2,DFN_",",.01),?30,SPNSSN D  D SSN
"RTN","SPNMISS2",14,0)
 ..S FIELD=0 F  S FIELD=$O(^TMP($J,PTNAM,DFN,FIELD)) Q:(FIELD="")!('+FIELD)  W !?20,$G(^TMP($J,PTNAM,DFN,FIELD))
"RTN","SPNMISS2",15,0)
 .W !,EQ
"RTN","SPNMISS2",16,0)
 .I $E(IOST,1)="P" I $Y>(IOSL-9) D HDR
"RTN","SPNMISS2",17,0)
 .I $E(IOST,1)="C" I $Y>(IOSL-7) D CONT Q:SPNCON="^"  D HDR
"RTN","SPNMISS2",18,0)
 I SPNCON'["^" I $E(IOST,1)="C" D CONT
"RTN","SPNMISS2",19,0)
 D STATS
"RTN","SPNMISS2",20,0)
 K STATS K ^TMP($J),DUPDFN,X,Y,SS,DFN,PTNAM,SPNCON,EQ,PTCNT,FIELD,SPNSSN
"RTN","SPNMISS2",21,0)
 K SPNEXIT,SUBCNT,SSN,SPNLEXIT,SPNIO,SPNDD,SPNCNT
"RTN","SPNMISS2",22,0)
 Q
"RTN","SPNMISS2",23,0)
SSN ;
"RTN","SPNMISS2",24,0)
 S X=0 F  S X=$O(^TMP($J,PTNAM,DFN,"SSN",X)) Q:X=""  D
"RTN","SPNMISS2",25,0)
 .S DUPDFN=$P(^TMP($J,PTNAM,DFN,"SSN",X),U,1)
"RTN","SPNMISS2",26,0)
 .W !?20,"Possible Duplicate SSN Assigned to ",$P($G(^DPT(DUPDFN,0)),U,1)
"RTN","SPNMISS2",27,0)
 .Q
"RTN","SPNMISS2",28,0)
 Q
"RTN","SPNMISS2",29,0)
HDR ;
"RTN","SPNMISS2",30,0)
 W @IOF
"RTN","SPNMISS2",31,0)
 S PAGE=PAGE+1
"RTN","SPNMISS2",32,0)
 W !,"        SCD Registry Missing Data Report   ","Run Date: ",$$FMTE^XLFDT($$NOW^XLFDT,"5DZP"),"   Page ",PAGE
"RTN","SPNMISS2",33,0)
 W !,"Patient Name",?30,"SSN"
"RTN","SPNMISS2",34,0)
 W !,"=============================================================================="
"RTN","SPNMISS2",35,0)
 Q
"RTN","SPNMISS2",36,0)
CONT ;
"RTN","SPNMISS2",37,0)
 I $E(IOST,1)="C" R !?20,"Press Return To Continue Or ^ to Exit ",SPNCON:DTIME
"RTN","SPNMISS2",38,0)
 I SPNCON="^" S PTNAM="ZZZZZZZZZZZZZZZZZZZZZZZZZZZZ"  Q
"RTN","SPNMISS2",39,0)
 Q
"RTN","SPNMISS2",40,0)
STATS ;
"RTN","SPNMISS2",41,0)
 S PTCNT=0
"RTN","SPNMISS2",42,0)
 S X="" F  S X=$O(^TMP($J,X)) Q:X=""  S Y=0 F  S Y=$O(^TMP($J,X,Y)) Q:Y=""  S PTCNT=PTCNT+1 S FIELD="" F  S FIELD=$O(^TMP($J,X,Y,FIELD)) Q:FIELD=""  D
"RTN","SPNMISS2",43,0)
 .I $D(STATS(FIELD))=0 S STATS(FIELD)=0
"RTN","SPNMISS2",44,0)
 .S STATS(FIELD)=STATS(FIELD)+1
"RTN","SPNMISS2",45,0)
 .S SS="" S SS=$O(^TMP($J,X,Y,"SSN",SS))
"RTN","SPNMISS2",46,0)
 D HDR
"RTN","SPNMISS2",47,0)
 W !?20,"Total # of Patients with Missing Data: ",$J(STATS(0),3,0)
"RTN","SPNMISS2",48,0)
 I $G(STATS(991.01)) W !?20,"# Missing ICN: ",$J(STATS(991.01),3,0)
"RTN","SPNMISS2",49,0)
 I $G(STATS(.02)) W !?20,"# Missing Registration Date: ",$J(STATS(.02),3,0)
"RTN","SPNMISS2",50,0)
 I $G(STATS(.05)) W !?20,"# Missing Date of Last Review: ",$J(STATS(.05),3,0)
"RTN","SPNMISS2",51,0)
 I $G(STATS(1.1)) W !?20,"# Missing SCI Network: ",$J(STATS(1.1),3,0)
"RTN","SPNMISS2",52,0)
 I $G(STATS(.03)) W !?20,"# Missing Registration Status: ",$J(STATS(.03),3,0)
"RTN","SPNMISS2",53,0)
 I $G(STATS("SSN")) W !?20,"# of Possible Duplicate SSNs: ",$J(STATS("SSN"),3,0)
"RTN","SPNPSR17")
0^12^B6455637
"RTN","SPNPSR17",1,0)
SPNPSR17 ;HIRMFO/JWR,WAA-HUNT: PROSTHETICS CLASS ;3/1/96
"RTN","SPNPSR17",2,0)
 ;;2.0;Spinal Cord Dysfunction;**24**;01/02/1997
"RTN","SPNPSR17",3,0)
 ;
"RTN","SPNPSR17",4,0)
EN1(D0,ACTION,SEQUENCE) ; *** Search entry point
"RTN","SPNPSR17",5,0)
 ; Input:
"RTN","SPNPSR17",6,0)
 ;  ACTION,SEQUENCE = Search ACTION,SEQUENCE number
"RTN","SPNPSR17",7,0)
 ;  D0       = SCD (SPINAL CORD) REGISTRY file (#154) IEN
"RTN","SPNPSR17",8,0)
 ;  ^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",CN) = IEN ^ NAME
"RTN","SPNPSR17",9,0)
 ; Output:
"RTN","SPNPSR17",10,0)
 ;  $S( D0_Meets_Search_Criteria : 1 , 1 : 0 )
"RTN","SPNPSR17",11,0)
 ;
"RTN","SPNPSR17",12,0)
 ;N AGE,DFN,I,MEETSRCH,VA,VADM,VAERR
"RTN","SPNPSR17",13,0)
 S MEETSRCH=0
"RTN","SPNPSR17",14,0)
 S DFN=+$P($G(^SPNL(154,+D0,0)),U)
"RTN","SPNPSR17",15,0)
 G:'$D(^RMPR(665,DFN,5,0)) EXIT
"RTN","SPNPSR17",16,0)
 S CN=""
"RTN","SPNPSR17",17,0)
 S SPN2=0 F  S SPN2=$O(^RMPR(665,DFN,5,SPN2)) Q:SPN2<1  D  Q:MEETSRCH=1
"RTN","SPNPSR17",18,0)
 . S SPN3=$G(^RMPR(665,DFN,5,SPN2,0)),SPN4=$P(SPN3,U,4),SPN3=+SPN3
"RTN","SPNPSR17",19,0)
 . Q:SPN4=""  Q:'$D(^RMPR(661,SPN4,0))
"RTN","SPNPSR17",20,0)
 . S SPN5=$P($G(^RMPR(661,SPN4,0)),U,3) Q:SPN5=""
"RTN","SPNPSR17",21,0)
 . S SPN6=$P($G(^RMPR(663,SPN5,0)),U) Q:SPN6=""
"RTN","SPNPSR17",22,0)
 .; old code was looking at the whole value based on temp and was wrong
"RTN","SPNPSR17",23,0)
 .; now it only looks at the 1st piece of the tmp($j 
"RTN","SPNPSR17",24,0)
 .; F  S CN=$O(^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",CN)) Q:CN<1  I SPN6=^(CN) S MEETSRCH=1 Q:MEETSRCH=1
"RTN","SPNPSR17",25,0)
 . F  S CN=$O(^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",CN)) Q:CN<1  I SPN6=$P($G(^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",CN)),U,1) S MEETSRCH=1 Q:MEETSRCH=1
"RTN","SPNPSR17",26,0)
 . Q
"RTN","SPNPSR17",27,0)
EXIT Q MEETSRCH
"RTN","SPNPSR17",28,0)
 ;
"RTN","SPNPSR17",29,0)
EN2(ACTION,SEQUENCE) ; *** Prompt entry point
"RTN","SPNPSR17",30,0)
 ; Input:
"RTN","SPNPSR17",31,0)
 ;  ACTION,SEQUENCE = Search ACTION,SEQUENCE number
"RTN","SPNPSR17",32,0)
 ; Output:
"RTN","SPNPSR17",33,0)
 ; ^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",IEN) = RATIO ^ NAME
"RTN","SPNPSR17",34,0)
 ;  ^TMP($J,"SPNPRT",ACTION,SEQUENCE,0) = $$EN1^SPNPSR17(D0,ACTION,SEQUENCE)
"RTN","SPNPSR17",35,0)
 ;  SPNLEXIT = $S( User_Abort/Timeout : 1 , 1 : 0 )
"RTN","SPNPSR17",36,0)
 ;
"RTN","SPNPSR17",37,0)
 N DIC,AGE,DIR,DIRUT,DTOUT,DUOUT,I,SPNLFLG
"RTN","SPNPSR17",38,0)
DIR K ^TMP($J,"SPNPRT",ACTION,SEQUENCE),DIR,DIC
"RTN","SPNPSR17",39,0)
 F  S DIC=663,DIC(0)="AEMNQZ" D  Q:Y<1!(SPNLEXIT)
"RTN","SPNPSR17",40,0)
 . D ^DIC
"RTN","SPNPSR17",41,0)
 . I $D(DUOUT)!($D(DTOUT)) S SPNLEXIT=1 Q
"RTN","SPNPSR17",42,0)
 . I Y<1 Q
"RTN","SPNPSR17",43,0)
 . I $D(^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",Y)) W !!,"     ***You have already chosen that one***",! Q
"RTN","SPNPSR17",44,0)
 . W "   ",$P($G(^RMPR(663,+Y,0)),U,3) S DIC("A")="Another: "
"RTN","SPNPSR17",45,0)
 . S ^TMP($J,"SPNPRT",ACTION,SEQUENCE,"PROSTH",Y)=$P(Y,U,2)_U_$P($G(^RMPR(663,+Y,0)),U,3)
"RTN","SPNPSR17",46,0)
 . Q
"RTN","SPNPSR17",47,0)
 I Y<1,('SPNLEXIT) S ^TMP($J,"SPNPRT",ACTION,SEQUENCE,0)="$$EN1^SPNPSR17(D0,"""_ACTION_""","_SEQUENCE_")"
"RTN","SPNPSR17",48,0)
 I SPNLEXIT K ^TMP($J,"SPNPRT",ACTION,SEQUENCE)
"RTN","SPNPSR17",49,0)
 Q
"VER")
8.0^22.0
**END**
**END**
