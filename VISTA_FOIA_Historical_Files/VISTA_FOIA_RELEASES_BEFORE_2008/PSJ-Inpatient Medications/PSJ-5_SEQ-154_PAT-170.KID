Released PSJ*5*170 SEQ #154
Extracted from mail message
**KIDS**:PSJ*5.0*170^

**INSTALL NAME**
PSJ*5.0*170
"BLD",6212,0)
PSJ*5.0*170^INPATIENT MEDICATIONS^0^3060117^y
"BLD",6212,1,0)
^^26^26^3060117^
"BLD",6212,1,1,0)
1.  CPRS IV Orders currently select the first of multiple IV Additives by
"BLD",6212,1,2,0)
    IEN associated with the Pharmacy Orderable Item selected in CPRS by
"BLD",6212,1,3,0)
    the Provider.  The software checks to determine if the IV Additive 
"BLD",6212,1,4,0)
    is Inactive, but does not check the "USED IN IV FLUID ORDER ENTRY" 
"BLD",6212,1,5,0)
    field to determine if the additive should be used.
"BLD",6212,1,6,0)
 
"BLD",6212,1,7,0)
    This patch will change the software to add a check of the "USED 
"BLD",6212,1,8,0)
    IN IV FLUID ORDER ENTRY" field and exclude the additive from selection
"BLD",6212,1,9,0)
    based on that field.
"BLD",6212,1,10,0)
 
"BLD",6212,1,11,0)
*** The software included in this patch is designed to exclude an IV
"BLD",6212,1,12,0)
    Additive from the selection process only if the "USED IN IV FLUID 
"BLD",6212,1,13,0)
    ORDER ENTRY" field is set to "NO".
"BLD",6212,1,14,0)
  
"BLD",6212,1,15,0)
*** If the "USED IN IV FLUID ORDER ENTRY" field is set to "YES" or 
"BLD",6212,1,16,0)
    blank, then the IV Additive will be selected in IEN order.
"BLD",6212,1,17,0)
 
"BLD",6212,1,18,0)
2.  This patch is also designed to correct a programming error in routine
"BLD",6212,1,19,0)
    PSJPXRM1 that is to be used by CPRS to return Inpatient Medications
"BLD",6212,1,20,0)
    order information.  This is a routine that is not currently in use,
"BLD",6212,1,21,0)
    and will be tested at the programmer prompt.
"BLD",6212,1,22,0)
 
"BLD",6212,1,23,0)
3.  If the user enters a start date/time in the future and then enters 
"BLD",6212,1,24,0)
    the number of doses at the stop date/time prompt, the software
"BLD",6212,1,25,0)
    calculates the stop date/time from the current date/time instead of
"BLD",6212,1,26,0)
    the entered start date/time.
"BLD",6212,4,0)
^9.64PA^^
"BLD",6212,6)
4^
"BLD",6212,"KRN",0)
^9.67PA^8989.52^19
"BLD",6212,"KRN",.4,0)
.4
"BLD",6212,"KRN",.401,0)
.401
"BLD",6212,"KRN",.402,0)
.402
"BLD",6212,"KRN",.403,0)
.403
"BLD",6212,"KRN",.5,0)
.5
"BLD",6212,"KRN",.84,0)
.84
"BLD",6212,"KRN",3.6,0)
3.6
"BLD",6212,"KRN",3.8,0)
3.8
"BLD",6212,"KRN",9.2,0)
9.2
"BLD",6212,"KRN",9.8,0)
9.8
"BLD",6212,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6212,"KRN",9.8,"NM",1,0)
PSJHL4A^^0^B37280433
"BLD",6212,"KRN",9.8,"NM",2,0)
PSJPXRM1^^0^B33327052
"BLD",6212,"KRN",9.8,"NM",3,0)
PSGDL^^0^B13848268
"BLD",6212,"KRN",9.8,"NM","B","PSGDL",3)

"BLD",6212,"KRN",9.8,"NM","B","PSJHL4A",1)

"BLD",6212,"KRN",9.8,"NM","B","PSJPXRM1",2)

"BLD",6212,"KRN",19,0)
19
"BLD",6212,"KRN",19.1,0)
19.1
"BLD",6212,"KRN",101,0)
101
"BLD",6212,"KRN",409.61,0)
409.61
"BLD",6212,"KRN",771,0)
771
"BLD",6212,"KRN",870,0)
870
"BLD",6212,"KRN",8989.51,0)
8989.51
"BLD",6212,"KRN",8989.52,0)
8989.52
"BLD",6212,"KRN",8994,0)
8994
"BLD",6212,"KRN","B",.4,.4)

"BLD",6212,"KRN","B",.401,.401)

"BLD",6212,"KRN","B",.402,.402)

"BLD",6212,"KRN","B",.403,.403)

"BLD",6212,"KRN","B",.5,.5)

"BLD",6212,"KRN","B",.84,.84)

"BLD",6212,"KRN","B",3.6,3.6)

"BLD",6212,"KRN","B",3.8,3.8)

"BLD",6212,"KRN","B",9.2,9.2)

"BLD",6212,"KRN","B",9.8,9.8)

"BLD",6212,"KRN","B",19,19)

"BLD",6212,"KRN","B",19.1,19.1)

"BLD",6212,"KRN","B",101,101)

"BLD",6212,"KRN","B",409.61,409.61)

"BLD",6212,"KRN","B",771,771)

"BLD",6212,"KRN","B",870,870)

"BLD",6212,"KRN","B",8989.51,8989.51)

"BLD",6212,"KRN","B",8989.52,8989.52)

"BLD",6212,"KRN","B",8994,8994)

"BLD",6212,"QUES",0)
^9.62^^
"BLD",6212,"REQB",0)
^9.611^2^2
"BLD",6212,"REQB",1,0)
PSJ*5.0*154^2
"BLD",6212,"REQB",2,0)
PSJ*5.0*90^2
"BLD",6212,"REQB","B","PSJ*5.0*154",1)

"BLD",6212,"REQB","B","PSJ*5.0*90",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
170^3060117^520645566
"PKG",221,22,1,"PAH",1,1,0)
^^26^26^3060117
"PKG",221,22,1,"PAH",1,1,1,0)
1.  CPRS IV Orders currently select the first of multiple IV Additives by
"PKG",221,22,1,"PAH",1,1,2,0)
    IEN associated with the Pharmacy Orderable Item selected in CPRS by
"PKG",221,22,1,"PAH",1,1,3,0)
    the Provider.  The software checks to determine if the IV Additive 
"PKG",221,22,1,"PAH",1,1,4,0)
    is Inactive, but does not check the "USED IN IV FLUID ORDER ENTRY" 
"PKG",221,22,1,"PAH",1,1,5,0)
    field to determine if the additive should be used.
"PKG",221,22,1,"PAH",1,1,6,0)
 
"PKG",221,22,1,"PAH",1,1,7,0)
    This patch will change the software to add a check of the "USED 
"PKG",221,22,1,"PAH",1,1,8,0)
    IN IV FLUID ORDER ENTRY" field and exclude the additive from selection
"PKG",221,22,1,"PAH",1,1,9,0)
    based on that field.
"PKG",221,22,1,"PAH",1,1,10,0)
 
"PKG",221,22,1,"PAH",1,1,11,0)
*** The software included in this patch is designed to exclude an IV
"PKG",221,22,1,"PAH",1,1,12,0)
    Additive from the selection process only if the "USED IN IV FLUID 
"PKG",221,22,1,"PAH",1,1,13,0)
    ORDER ENTRY" field is set to "NO".
"PKG",221,22,1,"PAH",1,1,14,0)
  
"PKG",221,22,1,"PAH",1,1,15,0)
*** If the "USED IN IV FLUID ORDER ENTRY" field is set to "YES" or 
"PKG",221,22,1,"PAH",1,1,16,0)
    blank, then the IV Additive will be selected in IEN order.
"PKG",221,22,1,"PAH",1,1,17,0)
 
"PKG",221,22,1,"PAH",1,1,18,0)
2.  This patch is also designed to correct a programming error in routine
"PKG",221,22,1,"PAH",1,1,19,0)
    PSJPXRM1 that is to be used by CPRS to return Inpatient Medications
"PKG",221,22,1,"PAH",1,1,20,0)
    order information.  This is a routine that is not currently in use,
"PKG",221,22,1,"PAH",1,1,21,0)
    and will be tested at the programmer prompt.
"PKG",221,22,1,"PAH",1,1,22,0)
 
"PKG",221,22,1,"PAH",1,1,23,0)
3.  If the user enters a start date/time in the future and then enters 
"PKG",221,22,1,"PAH",1,1,24,0)
    the number of doses at the stop date/time prompt, the software
"PKG",221,22,1,"PAH",1,1,25,0)
    calculates the stop date/time from the current date/time instead of
"PKG",221,22,1,"PAH",1,1,26,0)
    the entered start date/time.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGDL")
0^3^B13848268^B13209027
"RTN","PSGDL",1,0)
PSGDL ;BIR/CML3-CALCULATE STOP DATE/TIME WITH DOSE LIMIT ;27 Aug 98 / 8:47 AM
"RTN","PSGDL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,50,64,58,111,170**;16 DEC 97
"RTN","PSGDL",3,0)
 ;
"RTN","PSGDL",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGDL",5,0)
 ;
"RTN","PSGDL",6,0)
EN ;
"RTN","PSGDL",7,0)
 K PSGDLS S ND2=^PS(53.1,DA,2) I $P(ND2,"^",5)!$P(ND2,"^",6) W " ...Dose Limit... " G ENGO
"RTN","PSGDL",8,0)
 G DONE
"RTN","PSGDL",9,0)
 ;
"RTN","PSGDL",10,0)
ENE ;
"RTN","PSGDL",11,0)
 S ND2=PSGSCH_"^"_PSGSD_"^^^"_PSGAT_"^"_PSGS0XT G ENGO
"RTN","PSGDL",12,0)
 ;
"RTN","PSGDL",13,0)
EN1 ;
"RTN","PSGDL",14,0)
 S ND2=$P(PSGNEDFD,"^",4)_"^"_PSGNESD_"^^^"_PSGS0Y_"^"_PSGS0XT G ENGO
"RTN","PSGDL",15,0)
 ;
"RTN","PSGDL",16,0)
EN2 ;
"RTN","PSGDL",17,0)
 K PSGDLS S ND2=^PS(55,DA(1),5,DA,2) I '$P(ND2,"^",5),'$P(ND2,"^",6) G DONE
"RTN","PSGDL",18,0)
 W " ...Dose Limit... "
"RTN","PSGDL",19,0)
 ;
"RTN","PSGDL",20,0)
ENGO ;
"RTN","PSGDL",21,0)
 S SCH=$P(ND2,"^")
"RTN","PSGDL",22,0)
 S ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSGDL",23,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSGDL",24,0)
 I $P(PSJSYSW0,U,5)=2 D
"RTN","PSGDL",25,0)
 . Q:'TS  S:TS'[$P(ST,".",2) $P(PSJSYSW0,U,5)=1 D
"RTN","PSGDL",26,0)
 .. S X=$G(PSGSD),%DT="T" D ^%DT I Y'=-1 N PSGSD S PSGSD=Y
"RTN","PSGDL",27,0)
 .. S X=$G(PSGFD),%DT="T" D ^%DT I Y'=-1 N PSGFD S PSGFD=Y
"RTN","PSGDL",28,0)
 .. I '$G(PSGSD) N PSGSD S PSGSD=$$DATE^PSJUTL2
"RTN","PSGDL",29,0)
 .. I '$G(PSGFD) N PSGFD S PSGFD=$$FMADD^XLFDT(PSGSD,30)
"RTN","PSGDL",30,0)
 .. N STRING,ND2,SCH,TS,MN S STRING=$G(PSGSD)_"^"_$G(PSGFD)_"^"_$G(PSGSCH)_"^"_$G(PSGST)_"^"_$G(PSGPDRG)_"^"_$G(PSGAT)
"RTN","PSGDL",31,0)
 .. I $G(PSGP) S ST=$$ENQ^PSJORP2(PSGP,STRING) S:'ST ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSGDL",32,0)
 . S $P(PSJSYSW0,U,5)=2
"RTN","PSGDL",33,0)
 G MWF:SCH["@",DONE:'TS&'MN
"RTN","PSGDL",34,0)
 I 'TS S AM=MN*PSGDL,X=$$EN^PSGCT(ST,AM) G DONE
"RTN","PSGDL",35,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-")))
"RTN","PSGDL",36,0)
 F Q=1:1 Q:$P(TS,"-",Q)=""!(TM<$P(TS,"-",Q))
"RTN","PSGDL",37,0)
 S X=ST\1,C=0 F Q=Q:1 D:$P(TS,"-",Q)="" ADD S C=C+1 I C=PSGDL S X=X_"."_$P(TS,"-",Q) G DONE
"RTN","PSGDL",38,0)
 ;
"RTN","PSGDL",39,0)
MWF ; if schedule is similar to monday-wednesday-friday
"RTN","PSGDL",40,0)
 S TS=$P(SCH,"@",2),SCH=$P(SCH,"@"),X=$P(ST,"."),C=0 D SCHK G:C=PSGDL DONE F Q=1:1 S X1=$P(ST,"."),X2=Q D C^%DTC S X1=X D DW^%DTC D CHK G:C=PSGDL DONE
"RTN","PSGDL",41,0)
SCHK S X1=X D DW^%DTC F Q=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",Q) I WKD=$E(X,1,$L(WKD)) Q
"RTN","PSGDL",42,0)
 E  Q
"RTN","PSGDL",43,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-"))) F Q=1:1:$L(TS,"-") I TM<$P(TS,"-",Q) S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q) Q
"RTN","PSGDL",44,0)
 Q
"RTN","PSGDL",45,0)
CHK F QQ=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",QQ) I WKD=$E(X,1,$L(WKD)) D TS Q
"RTN","PSGDL",46,0)
 Q
"RTN","PSGDL",47,0)
TS F Q1=1:1:$L(TS,"-") S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q1) Q
"RTN","PSGDL",48,0)
 Q
"RTN","PSGDL",49,0)
 ;
"RTN","PSGDL",50,0)
DONE ;
"RTN","PSGDL",51,0)
 K %H,%T,%Y,MN,ND2,ND4,PSGDLS,PSGDL,Q1,QQ,SCH,TM,WKD,TS,X1,X2 Q
"RTN","PSGDL",52,0)
 ;
"RTN","PSGDL",53,0)
ADD ;
"RTN","PSGDL",54,0)
 S X1=$P(X,"."),X2=$S(MN&'(MN#1440):MN\1440,1:1) D C^%DTC S Q=1 Q
"RTN","PSGDL",55,0)
 ;
"RTN","PSGDL",56,0)
ENPREV ; when "P" is enter at start date
"RTN","PSGDL",57,0)
 W "REVIOUS" S (X,Y)=0 I '$D(PSGP)!'$D(PSGPDRG) G:$D(DA)[0 POUT S PSGP=$P($G(^PS(53.1,DA,0)),"^",15),PSGPDRG=+$G(^(.2)),Y=1 I 'PSGP!'PSGPDRG W:'PSGPDRG !?17,"Must have drug from formulary list." G POUT
"RTN","PSGDL",58,0)
 F Q=0:0 S Q=$O(^PS(53.1,"AC",PSGP,Q)) Q:'Q  I +$G(^PS(53.1,Q,.2))=PSGPDRG,$D(^PS(53.1,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSGDL",59,0)
 F Q=0:0 S Q=$O(^PS(55,PSGP,5,"C",PSGPDRG,Q)) Q:'Q  I $D(^PS(55,PSGP,5,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSGDL",60,0)
 W:'X !?17,"No other order found with this drug."
"RTN","PSGDL",61,0)
 ;
"RTN","PSGDL",62,0)
POUT ;
"RTN","PSGDL",63,0)
 K:'X X K:Y PSGPDRG,PSGP,Q Q
"RTN","PSGDL",64,0)
ENDL(SCH,DL) ;validate that dose limit should be allowed with this schedule
"RTN","PSGDL",65,0)
 ;and that the dose limit is a whole number
"RTN","PSGDL",66,0)
 I $G(SCH)="" Q 1
"RTN","PSGDL",67,0)
 I ",ON CALL,ON-CALL,ONCALL,"[(","_SCH_",")!($$ONE^PSJBCMA(DFN,"",SCH)="O") W " Dose limit invalid with this schedule" Q 0
"RTN","PSGDL",68,0)
 I DL'?1N.N W " Dose limit must be a whole number" Q 0
"RTN","PSGDL",69,0)
 Q 1
"RTN","PSJHL4A")
0^1^B37280433^B36548779
"RTN","PSJHL4A",1,0)
PSJHL4A ;BIR/RLW-CONTINUE DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4A",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**105,111,154,170**;16 DEC 97
"RTN","PSJHL4A",3,0)
 ;
"RTN","PSJHL4A",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL4A",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL4A",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4A",7,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJHL4A",8,0)
 ;
"RTN","PSJHL4A",9,0)
RXC ; IV order
"RTN","PSJHL4A",10,0)
 N IVFL
"RTN","PSJHL4A",11,0)
 S APPL=FIELD(1)
"RTN","PSJHL4A",12,0)
 I APPL["B" S SOLCNT=SOLCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S VOLUME=+FIELD(3)_" ML" D  I '$D(^TMP("PSJNVO",$J,"SOL",SOLCNT,0)) D SOLSRCH
"RTN","PSJHL4A",13,0)
 .S SOLUTION="" F  S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) Q:'SOLUTION  S INACT=$G(^PS(52.7,SOLUTION,"I")) I 'INACT!(INACT>DT) I VOLUME=$P(^PS(52.7,SOLUTION,0),U,3) D
"RTN","PSJHL4A",14,0)
 ..S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",15,0)
 ..S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",16,0)
 I $G(INFRT)]"" S X=INFRT D ENI^PSJHLU S INFRT=$G(X)
"RTN","PSJHL4A",17,0)
 I APPL="A" S ADCNT=ADCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S STRENGTH=$G(FIELD(3))_" "_$P($G(FIELD(4)),"^",5) D  I '$D(^TMP("PSJNVO",$J,"AD",ADCNT,0)) S PSREASON="Can't find matching additive" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",18,0)
 .S ADDITIVE="" F  S ADDITIVE=$O(^PS(52.6,"AOI",PTR,ADDITIVE)) Q:'ADDITIVE  S INACT=$G(^PS(52.6,ADDITIVE,"I")),IVFL=$P($G(^(0)),"^",13) I 'INACT!(INACT>DT),IVFL'=0 Q:$G(^PS(52.6,ADDITIVE,0))']""  D  Q:ADDITIVE
"RTN","PSJHL4A",19,0)
 ..I $G(PSITEM)="" S PSITEM=PTR
"RTN","PSJHL4A",20,0)
 ..S ^TMP("PSJNVO",$J,"AD",0)=ADCNT
"RTN","PSJHL4A",21,0)
 ..S ^TMP("PSJNVO",$J,"AD",ADCNT,0)=ADDITIVE_"^"_STRENGTH
"RTN","PSJHL4A",22,0)
 Q
"RTN","PSJHL4A",23,0)
 ;
"RTN","PSJHL4A",24,0)
RXO ;
"RTN","PSJHL4A",25,0)
 I $O(PSJMSG(II,0)) D
"RTN","PSJHL4A",26,0)
 .K SEGMENT
"RTN","PSJHL4A",27,0)
 .N KK,JJ,XX
"RTN","PSJHL4A",28,0)
 .S SEGMENT(1)=$G(PSJMSG(II))
"RTN","PSJHL4A",29,0)
 .S KK=1,JJ="" F  S JJ=$O(PSJMSG(II,JJ)) Q:'JJ  S KK=KK+1,SEGMENT(KK)=$G(PSJMSG(II,JJ))
"RTN","PSJHL4A",30,0)
 .S KK=1,JJ=0
"RTN","PSJHL4A",31,0)
 .F  Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",32,0)
 ..I SEGMENT(KK)["|" S FIELD(JJ)=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(FIELD(JJ))+2,$L(SEGMENT(KK))),JJ=JJ+1 Q
"RTN","PSJHL4A",33,0)
 ..I SEGMENT(KK)'["|" S FIELD(JJ)=SEGMENT(KK),KK=KK+1 Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",34,0)
 ...S XX=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(X)+2,$L(SEGMENT(KK))),FIELD(JJ)=FIELD(JJ)_XX,JJ=JJ+1
"RTN","PSJHL4A",35,0)
 S APPL="",PSITEM=$S($P(FIELD(1),"^",5)="IV":"",1:$P(FIELD(1),"^",4))
"RTN","PSJHL4A",36,0)
 S:$P(FIELD(1),"^",6)="ORD" PSITEM=""
"RTN","PSJHL4A",37,0)
 S:$P(FIELD(1),"^",5)="IV" IVTYP="A",SCHTYP="C",INFRT=$G(FIELD(2))
"RTN","PSJHL4A",38,0)
 S DISPENSE=$P($G(FIELD(10)),"^",4)
"RTN","PSJHL4A",39,0)
 S IVLIMIT=$P($G(PSJMSG(II)),"^",3)
"RTN","PSJHL4A",40,0)
 Q
"RTN","PSJHL4A",41,0)
 ;
"RTN","PSJHL4A",42,0)
OBX ;
"RTN","PSJHL4A",43,0)
 S OBXFL=1,OCNARR=FIELD(5),OCPROV=CLERK,OCCNT=OCCNT+1
"RTN","PSJHL4A",44,0)
 S ^TMP("PSJNVO",$J,10,0)=OCCNT
"RTN","PSJHL4A",45,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,0)=OCNARR
"RTN","PSJHL4A",46,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,1)=$P($G(^VA(200,+OCPROV,0)),"^")
"RTN","PSJHL4A",47,0)
 Q
"RTN","PSJHL4A",48,0)
 ;
"RTN","PSJHL4A",49,0)
NTE ;
"RTN","PSJHL4A",50,0)
 S TEXT=$S((FIELD(1)=6)&('OBXFL):"PROCOM",(FIELD(1)=7)&('OBXFL):"ADMINSTR",1:"OCRSN")
"RTN","PSJHL4A",51,0)
 S @TEXT@(1)=$G(FIELD(3))
"RTN","PSJHL4A",52,0)
 S K=1,J="" F  S J=$O(PSJMSG(II,J)) Q:'J  S K=K+1,@TEXT@(K)=$G(PSJMSG(II,J))
"RTN","PSJHL4A",53,0)
 D:$D(OCRSN)
"RTN","PSJHL4A",54,0)
 .S QQ=0 F  S QQ=$O(OCRSN(QQ)) Q:'QQ  S ^TMP("PSJNVO",$J,10,OCCNT,2,QQ,0)=OCRSN(QQ)
"RTN","PSJHL4A",55,0)
 S OBXFL=0
"RTN","PSJHL4A",56,0)
 Q
"RTN","PSJHL4A",57,0)
 ;
"RTN","PSJHL4A",58,0)
ZRX ;
"RTN","PSJHL4A",59,0)
 N ND,ND2,CHK,FOLOR,STDT
"RTN","PSJHL4A",60,0)
 S PREON=$G(FIELD(1)),ROC=$G(FIELD(3))
"RTN","PSJHL4A",61,0)
 S ND=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,0)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,0)),1:$G(^PS(55,PSJHLDFN,5,+PREON,0)))
"RTN","PSJHL4A",62,0)
 S ND2=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,2)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),1:$G(^PS(55,PSJHLDFN,5,+PREON,2)))
"RTN","PSJHL4A",63,0)
 I 'ND I ROC'="N" S PSREASON="Invalid Pharmacy order number" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",64,0)
 I ND I ROC="R" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Duplicate Renewal Request" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",65,0)
 I ND I ROC="R" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "AE"'[CHK S PSREASON="Pharmacy orders with a status of "_CHK_" may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",66,0)
 I $G(CHK)="E" I PREON'["V" D NOW^%DTC S X1=+$E(%,1,12),X2=-4 D C^%DTC S STDT=$S(PREON["V":$P(ND,U,3),1:$P(ND2,U,4)) I STDT'>X S PSREASON="Pharmacy orders expired longer than 4 days may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",67,0)
 I ND I ROC="E" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Pharmacy orders may only be edited ONCE" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",68,0)
 I ND I ROC="E" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "DEHO"[CHK N CHKRTN S CHKRTN=CHK_"^PSJHL6" D @CHKRTN S PSREASON=PSREASON_" orders may not be edited" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",69,0)
 D:ROC'="R" VALID^PSJHL9 Q:QFLG
"RTN","PSJHL4A",70,0)
 I $G(PSITEM)="",$D(^TMP("PSJNVO",$J,"SOL",1,0)) S PSITEM=$P($G(^PS(52.7,+^TMP("PSJNVO",$J,"SOL",1,0),0)),"^",11)
"RTN","PSJHL4A",71,0)
 I PRIORITY="ZD" D VALID^PSJHL10 S QFLG=1 Q
"RTN","PSJHL4A",72,0)
 I (PREON]"")&(ROC="E") D EDITCK^PSJHL5 Q:QFLG
"RTN","PSJHL4A",73,0)
 D NVO^PSJHL9
"RTN","PSJHL4A",74,0)
 I (PREON]"")&(ROC="R") D RENEW^PSJHL7 Q
"RTN","PSJHL4A",75,0)
 I (PREON]"")&(ROC="E") D EDIT^PSJHL5
"RTN","PSJHL4A",76,0)
 Q
"RTN","PSJHL4A",77,0)
 ;
"RTN","PSJHL4A",78,0)
SOLSRCH ;Find solution
"RTN","PSJHL4A",79,0)
 N SSSS,SEG,ON,ROC,SOL,SOL2
"RTN","PSJHL4A",80,0)
 F SSSS=II:0 S SSSS=$O(PSJMSG(SSSS)) Q:'SSSS  I $P(PSJMSG(SSSS),"|")="ZRX" D  Q
"RTN","PSJHL4A",81,0)
 .S SEG=$G(PSJMSG(SSSS)),ON=$P(SEG,"|",2),ROC=$P(SEG,"|",4)
"RTN","PSJHL4A",82,0)
 I $G(ROC)'="N" F SOL=0:0 S SOL=$O(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL)) Q:'SOL  S SOL2=$G(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL,0)) I $D(^PS(52.7,"AOI",PTR,+SOL2))&($P(SOL2,U,2)=VOLUME) S SOLUTION=+SOL2 D SET Q
"RTN","PSJHL4A",83,0)
 I 'SOLUTION S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) D SET
"RTN","PSJHL4A",84,0)
 Q
"RTN","PSJHL4A",85,0)
SET ;Set solution tmp nodes
"RTN","PSJHL4A",86,0)
 Q:'+SOLUTION
"RTN","PSJHL4A",87,0)
 S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",88,0)
 S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",89,0)
 Q
"RTN","PSJHL4A",90,0)
 ;
"RTN","PSJHL4A",91,0)
SNDTSTW(PRIO,PSJSCHED,WARD) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",92,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",93,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",94,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",95,0)
 S SNOPT=$P($G(^PS(59.6,WARD,0)),"^",32)
"RTN","PSJHL4A",96,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",97,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",98,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",99,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",100,0)
 Q 1
"RTN","PSJHL4A",101,0)
 ;
"RTN","PSJHL4A",102,0)
SNDTSTP(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",103,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",104,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",105,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",106,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",107,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",108,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",109,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",110,0)
 Q 1
"RTN","PSJHL4A",111,0)
 ;
"RTN","PSJHL4A",112,0)
SNDTSTA(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",113,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",114,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",115,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",116,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",2)
"RTN","PSJHL4A",117,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",118,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",119,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",120,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",121,0)
 Q 1
"RTN","PSJPXRM1")
0^2^B33327052^B31660556
"RTN","PSJPXRM1",1,0)
PSJPXRM1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ;29 Jan 99 / 8:49 AM
"RTN","PSJPXRM1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**90,170**;16 DEC 97
"RTN","PSJPXRM1",3,0)
 ;
"RTN","PSJPXRM1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJPXRM1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJPXRM1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJPXRM1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJPXRM1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPXRM1",9,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJPXRM1",10,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJPXRM1",11,0)
 ;
"RTN","PSJPXRM1",12,0)
OEL(DAS,NAME)         ; return list of expanded inpat meds
"RTN","PSJPXRM1",13,0)
 N ADM,CNT,DFN,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND6,NDOI,ON,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y
"RTN","PSJPXRM1",14,0)
 S DFN=$P(DAS,";")
"RTN","PSJPXRM1",15,0)
 S F=$S($P(DAS,";",2)["P":"^PS(53.1,",$P(DAS,";",2)=5:"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJPXRM1",16,0)
 S ON=$P(DAS,";",3)_$S($P(DAS,";",2)="IV":"V",$P(DAS,";",2)=5:"U",1:"P")
"RTN","PSJPXRM1",17,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJPXRM1",18,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJPXRM1",19,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJPXRM1",20,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJPXRM1",21,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJPXRM1",22,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJPXRM1",23,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),NAME("PC",CNT,0)=ND
"RTN","PSJPXRM1",24,0)
 S NAME("PC",0)=CNT
"RTN","PSJPXRM1",25,0)
 Q
"RTN","PSJPXRM1",26,0)
 ;
"RTN","PSJPXRM1",27,0)
UDTMP ;*** Set array for Unit dose orders.
"RTN","PSJPXRM1",28,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN
"RTN","PSJPXRM1",29,0)
 S (MR,SCH,INST)=""
"RTN","PSJPXRM1",30,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJPXRM1",31,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJPXRM1",32,0)
 S NAME("STAT")=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJPXRM1",33,0)
 D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJPXRM1",34,0)
 S NDOI=$G(@(F_+ON_",.2)")),NAME("OI")=+NDOI,NAME("DO")=$P(NDOI,U,2)
"RTN","PSJPXRM1",35,0)
 S NAME("START")=$P(ND2,"^",2),NAME("STOP")=$P(ND2,"^",4)
"RTN","PSJPXRM1",36,0)
 S NAME("UNITS")="" I '$O(@(F_+ON_",1,1)")) S NAME("UNITS")=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(NAME("UNITS")="") NAME("UNITS")=1
"RTN","PSJPXRM1",37,0)
 S NAME("MR")=$$MR(+$P(ND0,U,3)),NAME("INST")=$G(@(F_+ON_",.3)"))
"RTN","PSJPXRM1",38,0)
 S NAME("NOTGIVEN")=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJPXRM1",39,0)
 S NAME("OERR")=$P(ND0,U,21)
"RTN","PSJPXRM1",40,0)
 S NAME("PENDRENEWAL")=($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJPXRM1",41,0)
 S NAME("PROVIDER")=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJPXRM1",42,0)
 I NAME("PROVIDER") S NAME("PROVIDER")=NAME("PROVIDER")_"^"_$P($G(^VA(200,NAME("PROVIDER"),0)),"^")
"RTN","PSJPXRM1",43,0)
 S NAME("MDR",0)=NAME("MR")]"" S:NAME("MR")]"" NAME("MDR",1,0)=NAME("MR")
"RTN","PSJPXRM1",44,0)
 S NAME("SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" NAME("SCH",1,0)=$P(ND2,U)
"RTN","PSJPXRM1",45,0)
 S:$P(ND0,U,7)]"" NAME("SCH",0)=1,$P(NAME("SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJPXRM1",46,0)
 S NAME("SIG",0)=INST]"" S:INST]"" NAME("SIG",1,0)=INST
"RTN","PSJPXRM1",47,0)
 S NAME("ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" NAME("ADM",1,0)=$P(ND2,U,5)
"RTN","PSJPXRM1",48,0)
 S NAME("SIO",0)=ND6]"" S:ND6]"" NAME("SIO",1,0)=ND6
"RTN","PSJPXRM1",49,0)
 S:ON["U" NAME("VERPHARM")=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJPXRM1",50,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJPXRM1",51,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJPXRM1",52,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJPXRM1",53,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJPXRM1",54,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJPXRM1",55,0)
 . I +PSJOUT D
"RTN","PSJPXRM1",56,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJPXRM1",57,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJPXRM1",58,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJPXRM1",59,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJPXRM1",60,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJPXRM1",61,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJPXRM1",62,0)
 . ;* S UNITS=$S('+$P(NDDD,U,2):1,1:$P(NDDD,U,2))
"RTN","PSJPXRM1",63,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJPXRM1",64,0)
 . S CNT=CNT+1,NAME("DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJPXRM1",65,0)
 S NAME("DD",0)=CNT
"RTN","PSJPXRM1",66,0)
 Q
"RTN","PSJPXRM1",67,0)
 ;
"RTN","PSJPXRM1",68,0)
IVTMP ;*** Set array for IV orders.
"RTN","PSJPXRM1",69,0)
 N PROVIDER S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJPXRM1",70,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,NAME("AD",CNT,0)=Y
"RTN","PSJPXRM1",71,0)
 S NAME("AD",0)=CNT,CNT=0
"RTN","PSJPXRM1",72,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,NAME("SOL",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJPXRM1",73,0)
 S NAME("SOL",0)=CNT
"RTN","PSJPXRM1",74,0)
 S NAME("INST")=$G(@(F_+ON_",.3)"))
"RTN","PSJPXRM1",75,0)
 I ON["P" D
"RTN","PSJPXRM1",76,0)
 . S NAME("SCH")=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJPXRM1",77,0)
 . S NAME("PROVIDER")=$P(ND0,U,2)
"RTN","PSJPXRM1",78,0)
 . S NAME("MR")=$$MR(+$P(ND0,U,3)),NAME("STAT")=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJPXRM1",79,0)
 . S NAME("INFUS")=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJPXRM1",80,0)
 . S ND2=$G(@(F_+ON_",2)")),NAME("START")=$P(ND2,U,2),NAME("STOP")=$P(ND2,U,4)
"RTN","PSJPXRM1",81,0)
 . S NAME("ADM")=$P(ND2,U,5),NAME("SIO")=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJPXRM1",82,0)
 . S NAME("DN")=$G(@(F_+ON_",.2)")),NAME("DO")=$P(NAME("DN"),U,2)
"RTN","PSJPXRM1",83,0)
 . S:NAME("DO")="" NAME("DO")=$P($G(NAME("AD",1,0)),U,2)
"RTN","PSJPXRM1",84,0)
 . S NAME("DN")=$S(+$P(NAME("DN"),U):$$OIDF^PSJLMUT1($P(NAME("DN"),U)),1:"")
"RTN","PSJPXRM1",85,0)
 I ON'["P"  D
"RTN","PSJPXRM1",86,0)
 . S NAME("PROVIDER")=$P(ND0,U,6)
"RTN","PSJPXRM1",87,0)
 . S NAME("SCH")=$P(ND0,U,9),NAME("INFUS")=$P(ND0,U,8),NAME("STAT")=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJPXRM1",88,0)
 . S NAME("MR")=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJPXRM1",89,0)
 . S NAME("START")=$P(ND0,U,2),NAME("STOP")=$P(ND0,U,3)
"RTN","PSJPXRM1",90,0)
 . S NAME("ADM")=$P(ND0,U,11),NAME("SIO")=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJPXRM1",91,0)
 . S NAME("VERPHARM")=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJPXRM1",92,0)
 . S NAME("DN")=$G(@(F_+ON_",.2)")),NAME("DO")=$P(NAME("DN"),U,2)
"RTN","PSJPXRM1",93,0)
 . S NAME("DN")=$S(+$P(NAME("DN"),U):$$OIDF^PSJLMUT1($P(NAME("DN"),U)),1:"")
"RTN","PSJPXRM1",94,0)
 S NAME("OERR")=$P(ND0,U,21)
"RTN","PSJPXRM1",95,0)
 S NAME("PENDRENEWAL")=($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJPXRM1",96,0)
 I NAME("PROVIDER") S NAME("PROVIDER")=NAME("PROVIDER")_"^"_$P($G(^VA(200,NAME("PROVIDER"),0)),"^")
"RTN","PSJPXRM1",97,0)
 S NAME("MDR",0)=NAME("MR")]"" S:NAME("MR")]"" NAME("MDR",1,0)=NAME("MR")
"RTN","PSJPXRM1",98,0)
 S NAME("SCH",0)=NAME("SCH")]"" S:NAME("SCH")]"" NAME("SCH",1,0)=NAME("SCH")
"RTN","PSJPXRM1",99,0)
 I ON["P" S:$P(ND0,U,7)]"" NAME("SCH",0)=1,$P(NAME("SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJPXRM1",100,0)
 S NAME("SIG",0)=NAME("INST")]"" S:NAME("INST")]"" NAME("SIG",1,0)=NAME("INST")
"RTN","PSJPXRM1",101,0)
 S NAME("ADM",0)=NAME("ADM")]"" S:NAME("ADM")]"" NAME("ADM",1,0)=NAME("ADM")
"RTN","PSJPXRM1",102,0)
 S NAME("SIO",0)=NAME("SIO")]"" S:NAME("SIO")]"" NAME("SIO",1,0)=NAME("SIO")
"RTN","PSJPXRM1",103,0)
 Q
"RTN","PSJPXRM1",104,0)
 ;
"RTN","PSJPXRM1",105,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJPXRM1",106,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJPXRM1",107,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJPXRM1",108,0)
 ;
"RTN","PSJPXRM1",109,0)
GTSTAT(X) ;
"RTN","PSJPXRM1",110,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJPXRM1",111,0)
 ;
"RTN","PSJPXRM1",112,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJPXRM1",113,0)
 ; X = User name
"RTN","PSJPXRM1",114,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJPXRM1",115,0)
 I +Y=-1 Q ""
"RTN","PSJPXRM1",116,0)
 Q $P(Y,U)
"RTN","PSJPXRM1",117,0)
GTSCHT(X)       ;
"RTN","PSJPXRM1",118,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"VER")
8.0^22.0
"BLD",6212,6)
^154
**END**
**END**
