$TXT Created by YORTY,M. ROBERT at CSL.FO-WASH.MED.VA.GOV  (KIDS) on Wednesday, 04/09/03 at 10:06
=============================================================================
Run Date: MAY 08, 2003                     Designation: LBR*2.5*9
Package : LBR - LIBRARY                        Priority: Mandatory
Version : 2.5         SEQ #7                   Status: Released
                  Compliance Date: JUN 08, 2003
=============================================================================

Associated patches: (v)DGBT*1*2    <<= must be installed BEFORE `LBR*2.5*9'

Subject: Library CoreFLS

Category: 
  - Data Dictionary
  - Input Template
  - Print Template
  - Sort Template
  - Routine

Description: 
============

 This patch provides Library with the interface capabilities to the Core
 Financial Logistics System (CoreFLS).  CoreFLS will replace the Integrated
 Funds Distribution, Control Point Activity, and Procurement (IFCAP)
 package.
  
 Vendor information for CoreFLS will be held nationally on a remote
 database.  To alleviate traffic over your network, a local vendor file,
 LOCAL VENDOR (#392.31) has been placed on your local system to be used to
 store and access your frequently use vendors.  The LOCAL VENDOR file 
 (#392.31) is associated with the Beneficiary Travel namespace and has 
 been distributed in the DGBT*1*2 Beneficiary Travel patch.
  
 A new field is added to the Library Site Parameters option under the 
 Library Management menu.  This field will be used to activate the CoreFLS
 interface:
  
 COREFLS ACTIVE:?
      Enter 'Yes' if using the CoreFLS system for vendors.
      Choose from: 
        1        YES
        0        NO
  
 This patch may be installed independently from the CoreFLS COMMUNICATIONS 
 SERVICE LIBRARY (CSL) Package.  A check will be performed to verify the
 existence of the COMMUNICATIONS SERVICE LIBRARY (CSL) Package.  If it
 doesn't exist the COREFLS ACTIVE field will default to NO and Library will
 maintain its current functionality.
  
 A new menu is added to your Library Management Menu. This menu called, Add
 a local vendor (COREFLS), will allow users holding the LBRY LOCAL VENDOR
 key the ability to add CoreFLS vendors to the LOCAL VENDOR file (#392.31)
 without having to go through the Library software.  Similar to above, a
 check verifying existence of CoreFLS package is performed allowing the
 user to proceed with the CoreFLS vendor query.  A second menu is added to 
 your Library Management Menu called 'COREFLS conversion of old vendors'.  
 Running this menu is optional and explained below in AFTER INSTALLATION 
 INSTRUCTIONS (AT COREFLS CUTOVER).
  
 This patch may be installed at anytime.  However, the determination to go 
 active with CoreFLS following the steps under AFTER INSTALLATION 
 INSTRUCTIONS (AT COREFLS CUTOVER) will need to be coordinated in Library
 Services.
  
 Options affected.by CoreFLS.
 ----------------------------
 Library Site Parameters
 Library Title Setup
 Copy a Specific Edit
 Local Titles by Vendor
 Holdings Setup
 Local Microfilm Titles
 Titles Due for Renewal
 Missing Issues Listing
  
 New menus added.
 ----------------
 Add a local vendor (COREFLS)
 COREFLS Conversion of old vendors 
  
 New Security key
 ----------------
 LBRY LOCAL VENDOR
  
 New Fields added with Input/Output Transforms
 ---------------------------------------------
 File: LOCAL SERIALS (#680)
    New Fields added: MICROFILM COREFLS VENDOR (#2.6)
    Output Transform: K LBRPREV S LBRPREV=$$PREV^DGBTCSL(.Y)
  
 File: LIBRARY PARAMETERS (#680.6)
    New Fields added: DEFAULT COREFLS VENDOR (#.09)
    Output Transform: K LBRPREV S LBRPREV=$$PREV^DGBTCSL(.Y)
  
    New Fields added: COREFLS ACTIVE (#.1)
     Input Transform: N LBRX S LBRX=X S X="CSLVQ" X ^%ZOSF("TEST") W:' $T
        "   ** COREFLS Package CSL V1.0 not installed. **" S:'$T X=0 S:$T 
        X=LBRX Q 
  
 File: LBRY DISPOSITION (#681)
    New Fields added: COREFLS VENDOR (#3.01)
    Output Transform: K LBRPREV S LBRPREV=$$PREV^DGBTCSL(.Y)
  
  
 Technical information.
 ----------------------
 Majority of coding enhancements are done in the INPUT templates calling a
 new routine DGBTCSL. When a prompt for COREFLS VENDOR is given, its Output
 Transform will set up a variable for its previous value.  If a value is
 given at the vendor prompt then no Query to CoreFLS is given.  If the
 previous value is the same as the current response (i.e. <return>) then
 Query to CoreFLS is given.  Reason for this is:  New entries through
 Fileman to the local vendor file, LOCAL VENDOR (#392.31) is
 forbidden (no LAYGO).  Adding new entries is done only by querying and
 accepting a vendor through CoreFLS.  Due to the local file being no LAYGO
 and adding vendors is done through a different file interface, the rule of
 querying CoreFLS if the current and previous entries are the same is
 used.  Example of this is:  User is prompted for CoreFLS vendor and enters
 a name not found in the local vendor file, the response is ??, the user
 must hit the <return> key to pass through.  At this time previous and
 current values of vendor are the same, so the prompt to Query CoreFLS is
 given.  Only draw back is getting the prompt when user is in edit mode and
 gets the Query CoreFLS prompt when hitting <return> through accepted
 responses.
  
 Example of CoreFLS vendor entry.
 --------------------------------
 VA Library Serials Enter a Title                     APR 23,2002
  
 TITLE: BLUE WHITE ILLUSTRATED
  
 Editing TITLE AUTHORITY file
 TITLE: BLUE WHITE ILLUSTRATED  Replace 
 SYNONYM: 
 ISSN/ISBN: 
 NLM TITLE ABBREVIATION: 
 SERLINE UNIQUE IDENTIFIER: 
 Select INDEXED: 
 PUBLISHER: 
 GENERAL NOTES:
   No existing text
   Edit? NO// 
 FIRST ISSUE: 
 LAST ISSUE: 
  
 Editing LOCAL SERIALS file
 INACTIVE: 
 INITIAL COPIES ORDERED: 1
 FOR-YOUR-INFORMATION: 
 PREDICTION POP-UP: 
 CHECK-IN NOTES:
   No existing text
   Edit? NO// 
  
 Entering Copy 1 information.
 GIFT: 
 COREFLS VENDOR: **READMORE PUBLICATIONS INC.//        NEW YORK-NY-01
 DO YOU WANT TO QUERY CoreFLS FOR A VENDOR? NO// YES
 ** CoreFLS Query **
 Vendor Name: TEST
 . . . . 
     
    Choose from:
    1    CERTIFICATION TESTING, INC
         2469 N DECATUR RD
         DECATUR, GA  30033
    2    LATEST PRODUCTS CORP
         DEPT L
         PO BOX 190
         SYOSSET, NY  11791
    3    **EDUCATIONAL/INDUSTRIAL TESTING SVC
         P.O . BOX 7234
         SAN DIEGO, CA  92107
    4    **RON''S SECOND TEST
         123
         BOISE, ID  83702
  
 Select QUERY RESULTS SEQ NO: 3   **EDUCATIONAL/INDUSTRIAL TESTING SVC
         P.O . BOX 7234
         SAN DIEGO, CA  92107
 **CoreFLS VENDOR UPDATED.**
 PLACEMENT OF ITEM: 
 CATEGORY OF COPY: 
 COPY DISPOSITION: SHELVED//   SHELVED
  
 Do you want to EDIT any copy now? No// Y  (Yes)
  
  
 VA Library Copy Specific Edit                        APR 23,2002
 TITLE: BLUE WHITE ILLUSTRATED
  
 ID        COPY                START                    STOP
 NUM       NUM                 DATE                     DATE
  1         1               -----------              -----------
  
 Choose: (I)nsert, (E)dit, (R)emove.  Exit// E
 Select a number from 'ID NUM' column to EDIT that COPY: 1
 COPY NUMBER OR ToC: 1// 
 GIFT: 
 COREFLS VENDOR: **EDUCATIONAL/INDUSTRIAL TESTING SVC
          // 
 DO YOU WANT TO QUERY CoreFLS FOR A VENDOR? NO// 
 PLACEMENT OF ITEM: 
 CATEGORY OF COPY: 
 COPY DISPOSITION: SHELVED// 
 START DATE: 
 STOP DATE: 
  
  
 VA Library Copy Specific Edit                        APR 23,2002
 TITLE: BLUE WHITE ILLUSTRATED
  
 ID        COPY                START                    STOP
 NUM       NUM                 DATE                     DATE
  1         1               -----------              -----------
  
 Choose: (I)nsert, (E)dit, (R)emove.  Exit// 
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch.
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 There are no NOIS messages associated with this patch.
  
 Test Sites:
 -----------
  
  
 =======================INSTALLATION INSTRUCTIONS==========================
  
 This patch can be loaded with users on the system.  However, it would be
 preferable if Library users were off the system.
  
 If installed during the normal workday it is recommended that the
 following menu options (File #19) and all of their descendants be
 disabled to prevent possible conflicts while running the KIDS Install.
 Other VISTA users will not be affected.
  
     LBRY MANAGER      Library Management
  
 Install Time - 5 minutes.
  
 Please ensure that your programming variables are set, 
 including your DUZ(0)="@", otherwise installation will abort.
  
  
 1.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
      -----------------------
      Disable routine mapping on all systems for the routines listed in 
      step 3 below.  
  
      NOTE:  If the routines included in this patch are not currently in 
      your mapped routine set, please skip this step.
  
 2.   LOAD TRANSPORT GLOBAL 
      ---------------------
      Choose the PackMan message containing this patch and invoke the 
      INSTALL/CHECK MESSAGE PackMan option.  
  
 3.   COMPONENTS SENT WITH PATCH 
      --------------------------
      The following is a list of the routines included in this patch.  
      The second line of each of these routines now looks like:  
  
      <tab>;;2.5;Library;**[patch list]**;Mar, 11, 1996
  
                             CHECK^XTSUMBLD results
 Routine name       Before Patch          After Patch         Patch List
 =============      ============          ===========         ==========
 LBR25P9                     N/A              2039683               9
 LBR25P9V                    N/A              7645170               9
 LBRCSL                      N/A               407079               9
 LBRYCSE                 8225582              9022618             2,9
 LBRYEDI                 2786243              3368854             2,9
 LBRYLST                 6694558              7079107             2,9
 LBRYPRCS                5100079              5100079           2,8,9
 LBRYRPT                 7924989              9793535             2,9
 LBRYSITE                3423451              3520805             2,9
  
   Total number of routines - 9
  
 4.   START UP KIDS 
      -------------
      Start up the Kernel Installation and Distribution System Menu 
      [XPD MAIN]: 
  
           Edits and Distribution ...  
           Utilities ...  
           Installation ...  
  
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
           Load a Distribution 
           Print Transport Global 
           Compare Transport Global to Current System 
           Verify Checksums in Transport Global 
           Install Package(s) 
           Restart Install of Package(s) 
           Unload a Distribution 
           Backup a Transport Global 
  
 Select Installation Option: 
  
 5.   Select Installation Option: 
      ---------------------------
      NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
             NAME, enter LBR*2.5*9):
  
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will not
          backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option will
          allow you to view all changes that will be made when this patch
          is installed.  It compares all components of this patch
          (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will allow
          you to ensure the integrity of the routines that are in the
          transport global.
  
 6.  Select Installation Option: Install Package(s)
                                 ------------------
     a. Choose the Install Package(s) option to start the patch install.
  
     b. When prompted "Want KIDS to Rebuild Menu Trees Upon Completion of 
        Install? YES//", answer 'NO'.
  
     c. When prompted "Want KIDS to INHIBIT LOGONs during the install? 
        YES//", answer 'NO'.
  
     d. When prompted "Want to DISABLE Scheduled Options, Menu Options, and
        Protocols? YES//", answer 'YES'.
  
     e. When prompted "Enter options you wish to mark as 'Out of Order':" 
        Enter the following options:
  
        LBRY MANAGER
  
     f. When prompted "Enter protocols you wish to mark as 'Out of Order':"
         press <return>.
  
 7.  REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
     ==========================
     NOTE: This step is only necessary if you performed step 1 or if you 
     wish to include the routines in your mapped set.
  
  
 8.  >>> AFTER INSTALLATION INSTRUCTIONS (AT COREFLS CUTOVER) <<<
     ============================================================
  
     Installation of this patch will add two new menus onto the [LBRY 
     MANAGER] 'Library Management' menu.  Access to these menus are granted
     to those users holding the new LBRY LOCAL VENDOR security key.  The 
     new menus are [LBRY LOCAL VENDOR ADD] 'Add a local vendor (COREFLS)'
     and [LBRY COREFLS CONVERSION] 'COREFLS conversion of old vendors'.
  
     The first option, [LBRY LOCAL VENDOR ADD] 'Add a local vendor
     (COREFLS)' will be used to add CoreFLS vendors from the national
     database unto you locally held LOCAL VENDOR (#392.31) File.  This menu
     can be used in conjunction with adding CoreFLS vendors through the
     Library application.
  
     The second option, [LBRY COREFLS CONVERSION] 'CoreFLS conversion of
     old vendors' option is optional.  It is explained in Step 3 and
     presented for those sites who wish to convert previous vendor
     entries, those 'free text' entries in fields; MICROFILM VENDOR (#2.5)
     of the LOCAL SERIALS FILE (#680) File and VENDOR (#1.4) from the LBRY
     DISPOSITION (#681) File over to the new CoreFLS fields; MICROFILM
     COREFLS VENDOR (#2.6) of the LOCAL SERIALS FILE (#680) File and
     COREFLS VENDOR (#3.01) from the LBRY DISPOSITION (#681) File.
  
     Perform the following steps:
  
     1.  Assign appropriate Library users the LBRY LOCAL VENDOR key.
  
     2.  Activate CoreFLS on the Library package.  In your Library Site 
         Parameters turn the ACTIVE COREFLS parameter to YES.  When 
         prompted for DEFAULT COREFLS VENDOR, hit return, then query 
         CoreFLS and select your vendor from the national database. See 
         the following example:
  
         VA Library Site Parameters Edit                      MAR 5,2003
  
         Select LIBRARY PARAMETERS SITE NAME:    LIBRARY SERVICE  FLBAY
  
         VA Library Site Parameters Edit                      MAR 5,2003
  
  
         SITE NAME: LIBRARY SERVICE// 
         DIVISION SITE NAME: FLBAY// 
         COREFLS ACTIVE: NO// Y  YES
         DEFAULT COREFLS VENDOR: 
         DO YOU WANT TO QUERY coreFLS FOR A VENDOR? NO// YES
         ** CoreFLS Query **
         Vendor Name: BARNES. . 
  
            Choose from:
            1     BARNES & NOBLE
                  4010 SOUTH TAMIAMI TRAIL
                  SARASOTA, FL  34231
  
            2     BARNES & NOBLE
                  4010 SOUTH TAMIAMI TRAI
                  SARASOTA, FL  34231
  
            3     BARNES & NOBLE BOOKSTORE
                  2501 TYRONE BLVD N
                  ST PETERSBURG, FL  337103927
  
            4     BARNES AND NOBLE BOOKSTORE     
                  SUNSET POINT RD
                  CLEARWATER, FL  34689
  
     
         Select QUERY RESULTS SEQ NO: 3    BARNES & NOBLE BOOKSTORE
                  2501 TYRONE BLVD N
                  ST PETERSBURG, FL  337103927
  
         **COREFLS VENDOR UPDATED**
         AUTOMATIC QUEUING: NO// 
         ROUTING SLIP PRINTER: KYOCERA_SLAVE_16// 
         MAIL SYMBOL: 
  
         VA Library Site Parameters Edit                      MAR 5,2003
  
         Select LIBRARY PARAMETERS SITE NAME:
  
     3.  Convert old 'free text' vendor fields into new CoreFLS vendor
         fields.  (Optional).
  
         Use the option [LBRY COREFLS CONVERSION] 'CoreFLS conversion of
         old vendors' if you wish to move values of the old 'free text'
         vendor fields over to an associated new CoreFLS field. The option
         will perform the following tasks:
  
         1).  GENERATE LIST OF 'free text' VENDORS.
         ------------------------------------------
         This will build a temporary list of existing 'free text' vendor
         names from fields; MICROFILM VENDOR (#2.5) and VENDOR (#1.4) from
         both the LOCAL SERIALS (#680) and LBRY DISPOSITION (#681) Files
         respectfully, and hold these names in the temporary list, 
         ^XTMP("LBR25P9"), for 90 days after the list is generated.
  
         2).  DISPLAY PULL LIST.
         -----------------------
         This will display the list of existing 'free text' vendor names
         from the temporary file.  If Step 3 is performed, this list will
         display the association between old 'free text' vendor and the
         new CoreFLS vendor equivalient.
  
         3).  ASSOCIATE 'free text' VENDOR NAME TO COREFLS VENDOR NAME.
         --------------------------------------------------------------
         This will go through the temporary list prompting the user with
         'free text' vendors and allow the user to make the following 
         association with CoreFLS vendors: a one-to-one association; skip
         making an association; make many-to-one associations.  Use Step 2 
         to display the associations if needed. Note: Use the new option 
         'Add a local vendor (COREFLS)' if you need to populate the LOCAL
         VENDOR (#392.31) with vendors from the national database of
         CoreFLS vendors to fulfill your association.
  
         4).  POPULATE COREFLS VENDOR NAMES.
         -----------------------------------
         This will take the temporary file of newly associated CoreFLS
         vendor names and populate the new CoreFLS fields; MICROFILM
         COREFLS VENDOR (#2.6) of the LOCAL SERIALS (#680) File and COREFLS
         VENDOR (#3.01) of the LBRY DISPOSITION (#681) File.  This will 
         complete the conversion process.  Your entries will now have
         affiliated CoreFLS vendor values associated with them.

Routine Information:
====================

Routine Name:
  - LBRYCSE

 Changes to this routine allow the addition of a CoreFLS template.
  
 BEFORE
 ------
 EDIT0+3
 S DR="[LBRY D2]",DIC=DIE D LOCK^LBRYEDR G:LBRYL=0 EXIT
  
 ENTER1+8
 S DIE=DIC,DA=+Y,DR="[LBRY D2]" D LOCK^LBRYEDR G:LBRYL=0 EXIT
  
 AFTER
 -----
 EDIT0+3
 S DR=$S($D(LBRYPTR)&($P($G(^LBRY(680.6,LBRYPTR,0)),U,10)):"[LBRY D4]",
  1:"[LBRY D2]"),DIC=DIE D LOCK^LBRYEDR G:LBRYL=0 EXIT
  
 ENTER1+8
 S DIE=DIC,DA=+Y,DR=$S($D(LBRYPTR)&($P($G(^LBRY(680.6,LBRYPTR,0)
  ),U,10)):"[LBRY D4]",1:"[LBRY D2]") D LOCK^LBRYEDR G:LBRYL=0 EXIT

Routine Checksum:

Routine Name:
  - LBRYEDI

 Changes to this routine allow the addition of a CoreFLS template.
  
 BEFORE
 ------
 HOL+9
 S DIE="^LBRY(680,",DR="[LBRY BIBLIOGRAPHIC ENTRY]",DIC=DIE
  
  
 AFTER
 -----
 HOL+9
 S DIE="^LBRY(680,",DR=$S($D(LBRYPTR)&($P($G(^LBRY(680.6,LBRYPTR
  ,0)),U,10)):"[LBRY BIBLIOGRAPHIC 2 ENTRY]",1:"[LBRY BIBLIOGRAPHIC 
  ENTRY]"),DIC=DIE

Routine Checksum:

Routine Name:
  - LBRYLST

 Changes to this routine allow the addition of a CoreFLS template.
  
 BEFORE
 ------
 COPY1+4
 K DR S DIE=DIC,DA=+Y,DIE("NO^")=1,DR="[LBRY D1]" D LOCK^LBRYEDR
  
 AFTER
 -----
 COPY1+4
 K DR S DIE=DIC,DA=+Y,DIE("NO^")=1,DR=$S(LBRYPTR&($P($G(^LBRY(68
  0.6,LBRYPTR,0)),U,10)):"[LBRY D3]",1:"[LBRY D1]") D LOCK^LBRYEDR

Routine Checksum:

Routine Name:
  - LBRYRPT

 Changes to this routine allow the addition of a CoreFLS template.
  
 BEFORE
 ------
 DFR+5
 S FLDS="[LBRY TITLES DUE RENEWAL]",BY="[LBRY TITLES DUE RENEWAL]"
  
 LTV+4
 S FLDS="[LBRY SUBSCRIPTION/VENDOR]",BY="[LBRY SUBSCRIPTION/VENDOR]"
  
 AFTER
 -----
 MIL+5
 S %=0 I $D(LBRYPTR),$P($G(^LBRY(680.6,LBRYPTR,0)),U,10) D
 . W !,"List coreFLS Vendors" S %=1 D YN^DICN
 S FLDS=$S(%=1:"[LBRY MISSING ISSUES LIST 2]",1:FLDS),BY=$S(%=1:
  "[LBRY MISSING ISSUES LIST 2]",1:BY)
  
 DFR+5
 S %=0 I $D(LBRYPTR),$P($G(^LBRY(680.6,LBRYPTR,0)),U,10) D
 . W "List coreFLS vendors" S %=1 D YN^DICN
 S FLDS=$S(%=1:"[LBRY TITLES DUE RENEWAL 2]",1:"[LBRY TITLES DUE
  RENEWAL]"),BY="[LBRY TITLES DUE RENEWAL]"
  
 LTV+4
 S %=0 I $D(LBRYPTR),$P($G(^LBRY(680.6,LBRYPTR,0)),U,10) D
 . W "Sort using coreFLS Vendors" S %=1 D YN^DICN
 S FLDS="[LBRY SUBSCRIPTION/VENDOR]",BY=$S(%=1:"[LBRY SUBSCRIPTI
  ON/VENDOR 2]",1:"[LBRY SUBSCRIPTION/VENDOR]")
  
 LMT0+4
 I $D(LBRYPTR),$P($G(^LBRY(680.6,LBRYPTR,0)),U,10) D
 . W !,"List coreFLS Vendors" S %=1 D YN^DICN
 I %=1 S:FLDS["HOLDINGS" FLDS="[LBRY MICROFILM HOLDINGS 2]" S:BY
  ["VENDOR" BY="[LBRY MICROFILM VENDOR 2]"

Routine Checksum:

Routine Name:
  - LBRYSITE

 Changes to this routine allow the addition of a CoreFLS template.
  
 BEFORE
 ------
 EN1
 S DTOUTZ=0 D START G:Y<0 EXIT S DIE=DIC,DR="[LBRY SITE]" K HFLAG
  
 AFTER
 -----
 EN1
 S DTOUTZ=0 D START G:Y<0 EXIT S DIE=DIC,DR="[LBRY SITE2]",DIE("
  NO^")="OUTOK" K HFLAG

Routine Checksum:

Routine Name:
  - LBR25P9

 This routine will run the environment check to verify installer has the 
 correct programming variables set up.

Routine Checksum:

Routine Name:
  - LBRYPRCS

 Correction to patch numbering. 
  
 BEFORE
 ------
 LBRYPRCS+1
 ;;2.5;Library;**2**;Mar 11, 1996
  
  
 AFTER
 -----
 LBRYPRCS+1
 ;;2.5;Library;**2,8,9**;Mar 11, 1996

Routine Checksum:

Routine Name:
  - LBRCSL

 This is a new routine called by the option 'Add a local vendor 
 (COREFLS)'.  This routine checks the appropriate Library variables before 
 calling Beneficiary Travel routine that will query CoreFLS vendors.

Routine Checksum:

=============================================================================
User Information:                               
Entered By  : YORTY,M ROBERT                Date Entered : APR 22, 2002
Completed By: FAIN,ZACHARY                  Date Completed: MAY 08, 2003
Released By : MORRIS,DELISA                 Date Released : MAY 08, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
