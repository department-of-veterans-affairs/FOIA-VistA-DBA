Released FB*3.5*69 SEQ #65
Extracted from mail message
**KIDS**:FB*3.5*69^

**INSTALL NAME**
FB*3.5*69
"BLD",5247,0)
FB*3.5*69^FEE BASIS^0^3040303^y
"BLD",5247,1,0)
^^7^7^3040114^
"BLD",5247,1,1,0)
Enhancement patch to
"BLD",5247,1,2,0)
1. Enhance selected existing reports to include new data captured since
"BLD",5247,1,3,0)
   patch FB*3.5*61.
"BLD",5247,1,4,0)
2. Add new report to list unauthorized EDI claims that were disapproved.
"BLD",5247,1,5,0)
3. Update VA fee schedule compilation to consider units for claims with a
"BLD",5247,1,6,0)
   date of service in FY 2004.
"BLD",5247,1,7,0)
4. Modify Selection Capability for Suspension Letters Module.
"BLD",5247,4,0)
^9.64PA^^
"BLD",5247,"ABPKG")
n
"BLD",5247,"KRN",0)
^9.67PA^8989.52^19
"BLD",5247,"KRN",.4,0)
.4
"BLD",5247,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",5247,"KRN",.4,"NM",1,0)
FBAA RX PENDING    FILE #162.1^162.1^0
"BLD",5247,"KRN",.4,"NM","B","FBAA RX PENDING    FILE #162.1",1)

"BLD",5247,"KRN",.401,0)
.401
"BLD",5247,"KRN",.401,"NM",0)
^9.68A^^
"BLD",5247,"KRN",.402,0)
.402
"BLD",5247,"KRN",.402,"NM",0)
^9.68A^^
"BLD",5247,"KRN",.403,0)
.403
"BLD",5247,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5247,"KRN",.5,0)
.5
"BLD",5247,"KRN",.84,0)
.84
"BLD",5247,"KRN",3.6,0)
3.6
"BLD",5247,"KRN",3.8,0)
3.8
"BLD",5247,"KRN",9.2,0)
9.2
"BLD",5247,"KRN",9.8,0)
9.8
"BLD",5247,"KRN",9.8,"NM",0)
^9.68A^23^22
"BLD",5247,"KRN",9.8,"NM",1,0)
FBAASLP^^0^B46707426
"BLD",5247,"KRN",9.8,"NM",2,0)
FBAASL1^^0^B16087801
"BLD",5247,"KRN",9.8,"NM",3,0)
FBCHSL1^^0^B17825081
"BLD",5247,"KRN",9.8,"NM",4,0)
FBAAPAY^^0^B15134907
"BLD",5247,"KRN",9.8,"NM",5,0)
FBUCDE^^0^B15001343
"BLD",5247,"KRN",9.8,"NM",6,0)
FBAAVP^^0^B26602032
"BLD",5247,"KRN",9.8,"NM",7,0)
FBAAPHV^^0^B7669949
"BLD",5247,"KRN",9.8,"NM",8,0)
FBCHVP^^0^B23931772
"BLD",5247,"KRN",9.8,"NM",9,0)
FBUCLET2^^0^B58951975
"BLD",5247,"KRN",9.8,"NM",10,0)
FBCHRJP^^0^B10589786
"BLD",5247,"KRN",9.8,"NM",12,0)
FBPCR2^^0^B34442449
"BLD",5247,"KRN",9.8,"NM",13,0)
FBPCR3^^0^B24418678
"BLD",5247,"KRN",9.8,"NM",14,0)
FBPCR67^^0^B21293709
"BLD",5247,"KRN",9.8,"NM",15,0)
FBPCR671^^0^B24391290
"BLD",5247,"KRN",9.8,"NM",16,0)
FBPAY^^0^B23138914
"BLD",5247,"KRN",9.8,"NM",17,0)
FBPAY2^^0^B22790628
"BLD",5247,"KRN",9.8,"NM",18,0)
FBPAY21^^0^B16002202
"BLD",5247,"KRN",9.8,"NM",19,0)
FBPAY3^^0^B36156876
"BLD",5247,"KRN",9.8,"NM",20,0)
FBPAY67^^0^B38135461
"BLD",5247,"KRN",9.8,"NM",21,0)
FBPAY671^^0^B36348688
"BLD",5247,"KRN",9.8,"NM",22,0)
FBPHON^^0^B19592256
"BLD",5247,"KRN",9.8,"NM",23,0)
FBPHON1^^0^B14820448
"BLD",5247,"KRN",9.8,"NM","B","FBAAPAY",4)

"BLD",5247,"KRN",9.8,"NM","B","FBAAPHV",7)

"BLD",5247,"KRN",9.8,"NM","B","FBAASL1",2)

"BLD",5247,"KRN",9.8,"NM","B","FBAASLP",1)

"BLD",5247,"KRN",9.8,"NM","B","FBAAVP",6)

"BLD",5247,"KRN",9.8,"NM","B","FBCHRJP",10)

"BLD",5247,"KRN",9.8,"NM","B","FBCHSL1",3)

"BLD",5247,"KRN",9.8,"NM","B","FBCHVP",8)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY",16)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY2",17)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY21",18)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY3",19)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY67",20)

"BLD",5247,"KRN",9.8,"NM","B","FBPAY671",21)

"BLD",5247,"KRN",9.8,"NM","B","FBPCR2",12)

"BLD",5247,"KRN",9.8,"NM","B","FBPCR3",13)

"BLD",5247,"KRN",9.8,"NM","B","FBPCR67",14)

"BLD",5247,"KRN",9.8,"NM","B","FBPCR671",15)

"BLD",5247,"KRN",9.8,"NM","B","FBPHON",22)

"BLD",5247,"KRN",9.8,"NM","B","FBPHON1",23)

"BLD",5247,"KRN",9.8,"NM","B","FBUCDE",5)

"BLD",5247,"KRN",9.8,"NM","B","FBUCLET2",9)

"BLD",5247,"KRN",19,0)
19
"BLD",5247,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5247,"KRN",19,"NM",1,0)
FBUC DISAPPROVED EDI^^0
"BLD",5247,"KRN",19,"NM",2,0)
FBUC OUTPUTS^^2
"BLD",5247,"KRN",19,"NM","B","FBUC DISAPPROVED EDI",1)

"BLD",5247,"KRN",19,"NM","B","FBUC OUTPUTS",2)

"BLD",5247,"KRN",19.1,0)
19.1
"BLD",5247,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5247,"KRN",101,0)
101
"BLD",5247,"KRN",101,"NM",0)
^9.68A^^
"BLD",5247,"KRN",409.61,0)
409.61
"BLD",5247,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",5247,"KRN",409.61,"NM",1,0)
FBPHONE MENU^^0
"BLD",5247,"KRN",409.61,"NM","B","FBPHONE MENU",1)

"BLD",5247,"KRN",771,0)
771
"BLD",5247,"KRN",870,0)
870
"BLD",5247,"KRN",8989.51,0)
8989.51
"BLD",5247,"KRN",8989.52,0)
8989.52
"BLD",5247,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5247,"KRN",8994,0)
8994
"BLD",5247,"KRN","B",.4,.4)

"BLD",5247,"KRN","B",.401,.401)

"BLD",5247,"KRN","B",.402,.402)

"BLD",5247,"KRN","B",.403,.403)

"BLD",5247,"KRN","B",.5,.5)

"BLD",5247,"KRN","B",.84,.84)

"BLD",5247,"KRN","B",3.6,3.6)

"BLD",5247,"KRN","B",3.8,3.8)

"BLD",5247,"KRN","B",9.2,9.2)

"BLD",5247,"KRN","B",9.8,9.8)

"BLD",5247,"KRN","B",19,19)

"BLD",5247,"KRN","B",19.1,19.1)

"BLD",5247,"KRN","B",101,101)

"BLD",5247,"KRN","B",409.61,409.61)

"BLD",5247,"KRN","B",771,771)

"BLD",5247,"KRN","B",870,870)

"BLD",5247,"KRN","B",8989.51,8989.51)

"BLD",5247,"KRN","B",8989.52,8989.52)

"BLD",5247,"KRN","B",8994,8994)

"BLD",5247,"PRE")
FBXIP69E
"BLD",5247,"QUES",0)
^9.62^^
"BLD",5247,"REQB",0)
^9.611^3^3
"BLD",5247,"REQB",1,0)
FB*3.5*61^2
"BLD",5247,"REQB",2,0)
FB*3.5*46^2
"BLD",5247,"REQB",3,0)
FB*3.5*58^2
"BLD",5247,"REQB","B","FB*3.5*46",2)

"BLD",5247,"REQB","B","FB*3.5*58",3)

"BLD",5247,"REQB","B","FB*3.5*61",1)

"KRN",.4,921,-1)
0^1
"KRN",.4,921,0)
FBAA RX PENDING^3040301.1357^@^162.1^^@^3040301
"KRN",.4,921,"%D",0)
^.4001^1^1^3031219^^^^
"KRN",.4,921,"%D",1,0)
Prescriptions pending pharmacy review
"KRN",.4,921,"F",1)
4,-161,^FBAAA(^^S I(1,0)=D1 S I(0,0)=D0 S DIP(1)=$S($D(^FBAA(162.1,D0,"RX",D1,0)):^(0),1:"") S X=$P(DIP(1),U,5),X=X S D(0)=+X;Z;"PATIENT:"~
"KRN",.4,921,"F",2)
4,-161,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^FBAAA(D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~
"KRN",.4,921,"F",3)
4,-161,-2,S DIP(201)=$S($D(^DPT(D0,.36)):^(.36),1:"") S X="Pt.ID: "_$P(DIP(201),U,3) W X K DIP;C20;N;"";Z;""Pt.ID: "_PRIMARY LONG"~
"KRN",.4,921,"F",4)
0;C1;L9;S1;"INVOICE #"~3;C12;L35~-161.2,^FBAAV(^^S I(0,0)=D0 S DIP(1)=$S($D(^FBAA(162.1,D0,0)):^(0),1:"") S X=$P(DIP(1),U,4),X=X S D(0)=+X;Z;"VEN:"~
"KRN",.4,921,"F",5)
-161.2,1;C49;L15;"VENDOR ID"~13;C66;L13;~4,"Date Filled: ";C3;""~4,2;C16;""~4,"RX #: ";C45;""~4,.01;C51;""~4,1;C1;L28;~4,1.5;C30;L15;~4,1.6;C47;L15;~
"KRN",.4,921,"F",6)
4,36;C65;L14;~
"KRN",.4,921,"H")
PRESCRIPTIONS PENDING PHARMACY REVIEW
"KRN",19,4040,-1)
2^2
"KRN",19,4040,0)
FBUC OUTPUTS^Outputs for Unauthorized Claims^^M^.5^^^^^^^
"KRN",19,4040,10,0)
^19.01IP^12^12
"KRN",19,4040,10,12,0)
11971
"KRN",19,4040,10,12,"^")
FBUC DISAPPROVED EDI
"KRN",19,4040,"U")
OUTPUTS FOR UNAUTHORIZED CLAIM
"KRN",19,11971,-1)
0^1
"KRN",19,11971,0)
FBUC DISAPPROVED EDI^Disapproved EDI Claim Report^^R^^^^^^^^FEE BASIS
"KRN",19,11971,1,0)
^^3^3^3031223^
"KRN",19,11971,1,1,0)
This option will list unauthorized claims that are an EDI claim from the 
"KRN",19,11971,1,2,0)
FPPS system and have been dispositioned within the specified period as 
"KRN",19,11971,1,3,0)
Disapproved, Cancelled/Withdrawn, or Abandoned.
"KRN",19,11971,25)
FBUCDE
"KRN",19,11971,"U")
DISAPPROVED EDI CLAIM REPORT
"KRN",409.61,201,-1)
0^1
"KRN",409.61,201,0)
FBPHONE MENU^1^^80^6^17^1^1^PAYMENT HISTORY^FB PHONE MENU^PAYMENT HISTORY^1^^1
"KRN",409.61,201,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,201,"ARRAY")
 ^TMP("FBPHON",$J)
"KRN",409.61,201,"COL",0)
^409.621^7^7
"KRN",409.61,201,"COL",1,0)
DATES^6^19^SERVICE DATES^^0
"KRN",409.61,201,"COL",2,0)
SERVICE^26^13^SERVICE^^0
"KRN",409.61,201,"COL",3,0)
CLAIMED^42^10^AMT CL^^0
"KRN",409.61,201,"COL",4,0)
PAID^53^10^AMT PD^^0
"KRN",409.61,201,"COL",5,0)
CODE^61^7^ADJ CODE^^0
"KRN",409.61,201,"COL",6,0)
INVOICE^70^7^INV^^0
"KRN",409.61,201,"COL",7,0)
BATCH^75^5^BATCH^^0
"KRN",409.61,201,"COL","AIDENT",0,1)

"KRN",409.61,201,"COL","AIDENT",0,2)

"KRN",409.61,201,"COL","AIDENT",0,3)

"KRN",409.61,201,"COL","AIDENT",0,4)

"KRN",409.61,201,"COL","AIDENT",0,5)

"KRN",409.61,201,"COL","AIDENT",0,6)

"KRN",409.61,201,"COL","AIDENT",0,7)

"KRN",409.61,201,"COL","B","BATCH",7)

"KRN",409.61,201,"COL","B","CLAIMED",3)

"KRN",409.61,201,"COL","B","CODE",5)

"KRN",409.61,201,"COL","B","DATES",1)

"KRN",409.61,201,"COL","B","INVOICE",6)

"KRN",409.61,201,"COL","B","PAID",4)

"KRN",409.61,201,"COL","B","SERVICE",2)

"KRN",409.61,201,"FNL")
D EXIT^FBPHON
"KRN",409.61,201,"HDR")
D HDR^FBPHON
"KRN",409.61,201,"HLP")
D HLP^FBPHON
"KRN",409.61,201,"INIT")
D START^FBPHON
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
69^3040303
"PKG",60,22,1,"PAH",1,1,0)
^^7^7^3040303
"PKG",60,22,1,"PAH",1,1,1,0)
Enhancement patch to
"PKG",60,22,1,"PAH",1,1,2,0)
1. Enhance selected existing reports to include new data captured since
"PKG",60,22,1,"PAH",1,1,3,0)
   patch FB*3.5*61.
"PKG",60,22,1,"PAH",1,1,4,0)
2. Add new report to list unauthorized EDI claims that were disapproved.
"PKG",60,22,1,"PAH",1,1,5,0)
3. Update VA fee schedule compilation to consider units for claims with a
"PKG",60,22,1,"PAH",1,1,6,0)
   date of service in FY 2004.
"PKG",60,22,1,"PAH",1,1,7,0)
4. Modify Selection Capability for Suspension Letters Module.
"PRE")
FBXIP69E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
23
"RTN","FBAAPAY")
0^4^B15134907
"RTN","FBAAPAY",1,0)
FBAAPAY ;AISC/DMK-COMPILE CPT CODE SCHEDULE ;6/14/1999
"RTN","FBAAPAY",2,0)
 ;;3.5;FEE BASIS;**4,69**;JAN 30, 1995
"RTN","FBAAPAY",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPAY",4,0)
ASKDT S FBFL=0,FBFY="" W !!,?20,"*** DATE RANGE SELECTION ***",!!,?12,"Enter fiscal year or date range within fiscal year.",!!
"RTN","FBAAPAY",5,0)
 S %DT="AE",%DT("A")="  Beginning Date : " D ^%DT Q:Y<0  G FYCK:'$E(Y,4,7) S BEGDATE=Y-.1,%DT(0)=Y W ! S %DT("A")="  Ending Date : " D ^%DT K %DT Q:Y<0  W ! D DATECK G:FBFL ASKDT S ENDDATE=Y+.9
"RTN","FBAAPAY",6,0)
QUE S VAR="BEGDATE^ENDDATE^FBFY",VAL=BEGDATE_"^"_ENDDATE_"^"_FBFY,PGM="START^FBAAPAY" D ZIS^FBAAUTL G END:FBPOP
"RTN","FBAAPAY",7,0)
 ;
"RTN","FBAAPAY",8,0)
START K ^TMP($J) S (CNT,PAY)="",%DT="X",X="TODAY" D ^%DT S FBRUN=Y_"^"_BEGDATE_"^"_ENDDATE,FBFY=FBFY+1700
"RTN","FBAAPAY",9,0)
 ;
"RTN","FBAAPAY",10,0)
RD F I=0:0 S I=$O(^FBAAC(I)) Q:I'>0  F J=0:0 S J=$O(^FBAAC(I,1,J)) Q:J'>0  I $D(^(J,0)) F K=0:0 S K=$O(^FBAAC(I,1,J,1,K)) Q:K'>0  I $D(^(K,0)) D RD1
"RTN","FBAAPAY",11,0)
 S I=0 F  S I=$O(^TMP($J,I)) Q:I=""  I +^(I)>7 S VARR=+^(I) D SET,80
"RTN","FBAAPAY",12,0)
 S ^FBAA(163.99,"AC",FBFY,FBFY)="" D START^FBAASOUT
"RTN","FBAAPAY",13,0)
 ;
"RTN","FBAAPAY",14,0)
END K AC,AP,%DT("A"),FBCPT,FBAAFY,FBEDT,FBRUN,PGM,Q,QQ,VAL,FBFL,FBFY,VARR,CNT,NUM,NUM1,PAY,I,II,J,K,L,NOD,VAR,X,Y,ZZ,BEGDATE,ENDDATE ;,^TMP($J),FBDESC,FBI
"RTN","FBAAPAY",15,0)
 K FBMODLE
"RTN","FBAAPAY",16,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAAPAY",17,0)
 ;
"RTN","FBAAPAY",18,0)
SET S FBI=$O(^FBAA(163.99,"B",I,0)) D:'FBI
"RTN","FBAAPAY",19,0)
 .S X=I,DIC(0)="L",DIC="^FBAA(163.99,"
"RTN","FBAAPAY",20,0)
 .K DD,DO D FILE^DICN Q:Y<0  S FBI=+Y K DIC,DD,DO
"RTN","FBAAPAY",21,0)
 Q:'$G(FBI)
"RTN","FBAAPAY",22,0)
 S:'$D(^FBAA(163.99,FBI,"FY",0)) ^FBAA(163.99,FBI,"FY",0)="^163.991A^^"
"RTN","FBAAPAY",23,0)
 S Y(2)=^FBAA(163.99,FBI,"FY",0),$P(Y(2),"^",3)=FBFY,$P(Y(2),"^",4)=$P(Y(2),"^",4)+1,^FBAA(163.99,FBI,"FY",0)=Y(2)
"RTN","FBAAPAY",24,0)
 S ^FBAA(163.99,FBI,"FY",FBFY,0)=FBFY_"^"_VARR
"RTN","FBAAPAY",25,0)
 Q
"RTN","FBAAPAY",26,0)
RD1 I +^FBAAC(I,1,J,1,K,0)>BEGDATE&(+^FBAAC(I,1,J,1,K,0)<ENDDATE) F L=0:0 S L=$O(^FBAAC(I,1,J,1,K,1,L)) Q:L'>0  I $D(^(L,0)) D LOOK
"RTN","FBAAPAY",27,0)
 Q
"RTN","FBAAPAY",28,0)
LOOK N FBUNITS
"RTN","FBAAPAY",29,0)
 S Y(1)=^FBAAC(I,1,J,1,K,1,L,0)
"RTN","FBAAPAY",30,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC(I,1,J,1,K,1,L,""M"")","E")
"RTN","FBAAPAY",31,0)
 ; file 163.99 supports upto 18 modifiers
"RTN","FBAAPAY",32,0)
 I $L(FBMODLE,",")>18 S FBMODLE=$P(FBMODLE,",",1,18) ; truncate mods
"RTN","FBAAPAY",33,0)
 S II=$$CPT^FBAAUTL4($P(Y(1),U))_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")
"RTN","FBAAPAY",34,0)
 Q:II=""
"RTN","FBAAPAY",35,0)
 S AC=$P(Y(1),"^",2),AP=$P(Y(1),"^",3) S:'$D(^TMP($J,II)) ^TMP($J,II)=0
"RTN","FBAAPAY",36,0)
 I AP>0 D
"RTN","FBAAPAY",37,0)
 . ; skip if beginning date not after October 2003
"RTN","FBAAPAY",38,0)
 . I BEGDATE>3030930 D
"RTN","FBAAPAY",39,0)
 . . S FBUNITS=$P($G(^FBAAC(I,1,J,1,K,1,L,2)),U,14)
"RTN","FBAAPAY",40,0)
 . . ; skip if units paid not more than one
"RTN","FBAAPAY",41,0)
 . . Q:$G(FBUNITS)'>1
"RTN","FBAAPAY",42,0)
 . . ; divide amount claimed by units and round it to cents
"RTN","FBAAPAY",43,0)
 . . S AC=$J(AC/FBUNITS,"",2)
"RTN","FBAAPAY",44,0)
 . . ; divide amount paid by units and round it to cents
"RTN","FBAAPAY",45,0)
 . . S AP=$J(AP/FBUNITS,"",2)
"RTN","FBAAPAY",46,0)
 . S Y=^TMP($J,II),$P(^(II),"^",1)=$P(Y,"^",1)+1,$P(^(II),"^",2)=$P(Y,"^",2)+AC,$P(^(II),"^",3)=$P(Y,"^",3)+AP,CNT=CNT+1,^TMP($J,II,+AC,+AP,CNT)=""
"RTN","FBAAPAY",47,0)
 Q
"RTN","FBAAPAY",48,0)
FILE F J=0:0 S J=$O(^TMP($J,I,J)) Q:J'>0  F K=0:0 S K=$O(^TMP($J,I,J,K)) Q:K'>0  F L=0:0 S L=$O(^TMP($J,I,J,K,L)) Q:L'>0  S CNT=CNT+1 S:CNT=VAR $P(^FBAA(163.99,FBI,"FY",FBFY,0),"^",NOD)=J,$P(^(0),"^",6,8)=FBRUN
"RTN","FBAAPAY",49,0)
 K FBI Q
"RTN","FBAAPAY",50,0)
 ;
"RTN","FBAAPAY",51,0)
80 Q:'$G(FBI)
"RTN","FBAAPAY",52,0)
 S VAR=VARR*.75,VAR=$S($P(VAR,".",2)>5:$P(VAR,".",1)+1,1:$P(VAR,".",1)) S (CNT,NUM,NUM1,PAY)=0,NOD=5 D FILE Q
"RTN","FBAAPAY",53,0)
 ;
"RTN","FBAAPAY",54,0)
FYCK S FBFY=$E(Y,1,3),BEGDATE=(FBFY-1_"1000"),ENDDATE=(FBFY_"0930") G QUE
"RTN","FBAAPAY",55,0)
 ;
"RTN","FBAAPAY",56,0)
DATECK S FBFY=$S($E(BEGDATE,4,5)>9:($E(BEGDATE,1,3)+1),1:$E(BEGDATE,1,3)) I Y>(FBFY_"1001") W !,*7," Dates must be within a fiscal year. " S FBFL=1 Q
"RTN","FBAAPAY",57,0)
 Q
"RTN","FBAAPHV")
0^7^B7669949
"RTN","FBAAPHV",1,0)
FBAAPHV ;AISC/DMK-PHARMACY PAYMENT VOID ;12JUL88
"RTN","FBAAPHV",2,0)
 ;;3.5;FEE BASIS;**69**;JAN 30, 1995
"RTN","FBAAPHV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPHV",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBAAPHV",5,0)
 D DT^DICRW
"RTN","FBAAPHV",6,0)
 N FBFPPSC
"RTN","FBAAPHV",7,0)
 I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) W !!,*7,"You must be a Fee supervisor to use this option.",! Q
"RTN","FBAAPHV",8,0)
RD S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("A")="Select Invoice number: ",DIC("S")="I $P(^(0),U,5)=4" D ^DIC G Q:X["^"!(X=""),RD:Y<0 S FBAAIN=+Y K DIC("A"),DIC("S")
"RTN","FBAAPHV",9,0)
 S FBFPPSC=$P($G(^FBAA(162.1,FBAAIN,0)),U,13)
"RTN","FBAAPHV",10,0)
 I FBFPPSC]"" W !,?2,"FPPS Claim ID: ",FBFPPSC
"RTN","FBAAPHV",11,0)
RX W ! S DIC="^FBAA(162.1,FBAAIN,""RX"",",DIC(0)="AEQM",DIC("A")="Select Prescription # : " D ^DIC G Q:X["^"!(X=""),RD:Y<0
"RTN","FBAAPHV",12,0)
 S (DA,RX)=+Y,RXN=$P(Y,"^",2) K DIC
"RTN","FBAAPHV",13,0)
 I $D(FBVOID),'$D(^FBAA(162.1,FBAAIN,"RX",RX,2)) W !,*7,"Payment not voided!",! K DA G RD
"RTN","FBAAPHV",14,0)
 I '$D(FBVOID),$D(^FBAA(162.1,FBAAIN,"RX",RX,2)),$P(^(2),"^",3)="V" W !,*7,"Payment already voided!",! K DA G RD
"RTN","FBAAPHV",15,0)
 W !! S DIC="^FBAA(162.1,FBAAIN,""RX"",",DIC(0)="AEQM",DR="" D EN^DIQ
"RTN","FBAAPHV",16,0)
RD1 S DIR(0)="Y",DIR("A")="Is this the prescription you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void"),DIR("B")="NO",DIR("?")="Answer 'Yes' if you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void ")_"this prescription."
"RTN","FBAAPHV",17,0)
 D ^DIR K DIR G RD:$D(DIRUT),RX:'Y
"RTN","FBAAPHV",18,0)
 S V=$S($D(FBVOID):"",1:"VOID"),DR=$S($D(FBVOID):"23///@;23.5///@;24///@",1:"23////^S X=""V"";23.5R;24////^S X=DUZ"),DIE="^FBAA(162.1,FBAAIN,""RX""," D ^DIE
"RTN","FBAAPHV",19,0)
 S FBON=$P(^FBAA(162.1,FBAAIN,"RX",DA,0),"^",18),A2=$P(^(0),"^",16),DFN=$P(^(0),"^",5) D ^FBAAVP0 W !,?5,"...  Done.",!
"RTN","FBAAPHV",20,0)
Q K DA,DIC,DIE,DIRUT,RX,RXN,X,Y,A2,DFN,DR,FBAACB,FBAAIN,FBON,FBVOID,ON,P3,P4,RX,RXN,V,VAL Q
"RTN","FBAASL1")
0^2^B16087801
"RTN","FBAASL1",1,0)
FBAASL1 ;AISC/GRR-PRINT SUSPENSION LETTERS CONTINUED ;09/25/00
"RTN","FBAASL1",2,0)
 ;;3.5;FEE BASIS;**12,23,69**;JAN 30, 1995
"RTN","FBAASL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAASL1",4,0)
 N FBACRR,FBSCDT
"RTN","FBAASL1",5,0)
 F K=0:0 S K=$O(^FBAA(162.1,"AG",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) S FBSW=1,FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAA(162.1,"AG",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBAASL1",6,0)
 Q
"RTN","FBAASL1",7,0)
MORE F J=0:0 S J=$O(^FBAA(162.1,"AG",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP^FBAASLP I $D(^FBAAV(K,0)) D MID
"RTN","FBAASL1",8,0)
 Q
"RTN","FBAASL1",9,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBAASL1",10,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBAASL1",11,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6)
"RTN","FBAASL1",12,0)
 W @IOF,!!!!!!!,?5,VNAM,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBAASL1",13,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBAASL1",14,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASL1",15,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",16,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",17,0)
 D HED
"RTN","FBAASL1",18,0)
 Q
"RTN","FBAASL1",19,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBAASL1",20,0)
 Q
"RTN","FBAASL1",21,0)
MORE2 F L=0:0 S L=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA,L)) Q:L'>0  F M=0:0 S M=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA,L,M)) Q:M'>0  I $D(^FBAA(162.1,L,"RX",M,0)) S Z(0)=^(0) D:$P(Z(0),"^",20)'="R" BOT
"RTN","FBAASL1",22,0)
 Q
"RTN","FBAASL1",23,0)
WPBOT D:$D(FBACRR) ACT^FBAASLP K FBACRR
"RTN","FBAASL1",24,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBAASL1",25,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",26,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",27,0)
 Q
"RTN","FBAASL1",28,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,16)>0,1:0)
"RTN","FBAASL1",29,0)
 N FBFPPSC S FBFPPSC=$P($G(^FBAA(162.1,L,0)),U,13)
"RTN","FBAASL1",30,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBAASL1",31,0)
 N FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,T,TAMT,FBJ,FBAC
"RTN","FBAASL1",32,0)
 S FBFPPSL=$P($G(^FBAA(162.1,L,"RX",M,3)),U)
"RTN","FBAASL1",33,0)
 S FBX=$$ADJLRA^FBRXFA(M_","_L_",")
"RTN","FBAASL1",34,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAASL1",35,0)
 F FBJ=1:1 S FBAC=$P(FBADJLR,",",FBJ) Q:FBAC=""  S FBACRR(FBAC)=""
"RTN","FBAASL1",36,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAASL1",37,0)
 S T=$P(Z(0),U,8)
"RTN","FBAASL1",38,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAASL1",39,0)
 S TAMT=$FN($P(Z(0),U,7),"",2)
"RTN","FBAASL1",40,0)
 S FBRRMKL=$$RRL^FBRXFR(M_","_L_",")
"RTN","FBAASL1",41,0)
 I FBSW=1 D GOTV^FBAASLP,HED S FBSW=0,FBGOT=1
"RTN","FBAASL1",42,0)
 S FBDOS=$P(Z(0),"^",3),FBDRUG=$P(Z(0),"^",2)
"RTN","FBAASL1",43,0)
 S FBRX=$P(Z(0),"^",1),A1=$P(Z(0),"^",4)+.0001,A2=$P(Z(0),"^",16)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2)
"RTN","FBAASL1",44,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBAASL1",45,0)
 W !!,PNAME,?32,PSSN,?47,$$FMTE^XLFDT(FBDOS),?61,FBRX,!,?15,$J(A1,6),?30,$J(A2,6),?50,FBDRUG,!
"RTN","FBAASL1",46,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAASL1",47,0)
 W ?15,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAASL1",48,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAASL1",49,0)
 W ?31,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAASL1",50,0)
 W ?49,FBRRMKL
"RTN","FBAASL1",51,0)
 I FBFPPSC]"" W !,?15,"FPPS Claim ID: ",FBFPPSC,?43,"FPPS Line Item: ",FBFPPSL,!
"RTN","FBAASL1",52,0)
 I FBADJLR="" G:FBA=4&($D(^FBAA(162.1,L,"RX",M,1))) WPFT D
"RTN","FBAASL1",53,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBAASL1",54,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",55,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",56,0)
 Q
"RTN","FBAASL1",57,0)
HED W !,"PATIENT NAME",?36,"SSN",?47,"RX DATE",?61,"RX #",!,?15,"AMT CLAIMED",?30,"AMT PAID",?50,"DRUG NAME"
"RTN","FBAASL1",58,0)
 W !,?15,"ADJ CODE",?30,"ADJ AMOUNT",?49,"MEDICARE REMITTANCE REMARK"
"RTN","FBAASL1",59,0)
 W !,UL,! Q
"RTN","FBAASL1",60,0)
 ;
"RTN","FBAASL1",61,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBAASL1",62,0)
 ;
"RTN","FBAASL1",63,0)
 S Y(0)=^DPT(J,0),PNAME=$P(Y(0),"^",1),PSSN=$TR($$SSN^FBAAUTL(J),"-","")
"RTN","FBAASL1",64,0)
 I PNAME["," D
"RTN","FBAASL1",65,0)
 .N FBNAMES
"RTN","FBAASL1",66,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBAASL1",67,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAASL1",68,0)
 Q
"RTN","FBAASL1",69,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASL1",70,0)
 F FBRR=0:0 S FBRR=$O(^FBAA(162.1,L,"RX",M,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",71,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",72,0)
 Q
"RTN","FBAASLP")
0^1^B46707426
"RTN","FBAASLP",1,0)
FBAASLP ;AISC/GRR-PRINT SUSPENSION LETTERS ;09/25/00
"RTN","FBAASLP",2,0)
 ;;3.5;FEE BASIS;**12,4,23,69**;JAN 30, 1995
"RTN","FBAASLP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAASLP",4,0)
 D DATE^FBAAUTL G END:FBPOP  K FBAAS S (FBAAOUT,FBSLW,FBPRG,FBCTR,FBY)=0,UL="",$P(UL,"=",80)="="
"RTN","FBAASLP",5,0)
 D ^FBAASL G END:FBAAOUT
"RTN","FBAASLP",6,0)
RDCODE S DIR(0)="Y",DIR("A")="For All Suspension codes",DIR("B")="YES",DIR("?")="'Yes' to print suspension letters for all suspension codes, 'No' to select specific codes." D ^DIR K DIR W ! G END:$D(DUOUT),END:$D(DTOUT),SEL:'Y
"RTN","FBAASLP",7,0)
 ;ask edi/non-edi/all claims
"RTN","FBAASLP",8,0)
AHEAD S DIR(0)="SA^1:EDI;2:NON-EDI;3:ALL",DIR("A")="Only print letters for claims that were submitted via (EDI/NON-EDI/ALL):",DIR("B")="ALL"
"RTN","FBAASLP",9,0)
 S DIR("?",1)=" Enter EDI to just print suspension letters for EDI claims from the FPPS system."
"RTN","FBAASLP",10,0)
 S DIR("?",2)=" Enter NON-EDI to just print suspension letters for claims that are not EDI."
"RTN","FBAASLP",11,0)
 S DIR("?",3)=" Enter ALL to print suspension letters for both EDI and NON-EDI claims."
"RTN","FBAASLP",12,0)
 S DIR("?")=" "
"RTN","FBAASLP",13,0)
 D ^DIR K DIR G END:$D(DIRUT)
"RTN","FBAASLP",14,0)
 S FBENA=Y
"RTN","FBAASLP",15,0)
 S VAR="BEGDATE^ENDDATE^FBSLW",VAL=BEGDATE_"^"_ENDDATE_"^"_FBSLW
"RTN","FBAASLP",16,0)
 I $G(DFN) S VAR="DFN^"_VAR,VAL=DFN_"^"_VAL
"RTN","FBAASLP",17,0)
 I $G(IFN) S VAR="IFN^"_VAR,VAL=IFN_"^"_VAL
"RTN","FBAASLP",18,0)
 I $G(FBDEN) S VAR="FBDEN^"_VAR,VAL=FBDEN_"^"_VAL
"RTN","FBAASLP",19,0)
 I $G(FBENA) S VAR="FBENA^"_VAR,VAL=FBENA_"^"_VAL
"RTN","FBAASLP",20,0)
 S K=0 F J=1:1:FBCTR S K=$O(FBPRG(K)) S VAR=VAR_"^FBPRG("""_K_""")",VAL=VAL_"^"_+FBPRG(K)
"RTN","FBAASLP",21,0)
 I $D(FBAAS) F J=0:0 S J=$O(FBAAS(J)) Q:J'>0  S VAR=VAR_"^FBAAS("_J_")",VAL=VAL_"^"
"RTN","FBAASLP",22,0)
 S PGM="START^FBAASLP",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAASLP",23,0)
START K ^UTILITY($J),^TMP($J) U IO S UL="",$P(UL,"=",80)="=",FBPG=1
"RTN","FBAASLP",24,0)
 I $G(FBPRG("O")) S FBLET=+FBPRG("O") F K=0:0 S K=$O(^FBAAC("AI",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) D STRT
"RTN","FBAASLP",25,0)
 I $G(FBPRG("P")),$D(^FBAA(162.1,"AG")) S FBLET=+FBPRG("P") D ^FBAASL1 K ^TMP($J)
"RTN","FBAASLP",26,0)
 I $G(FBPRG("C")),$D(^FBAA(162.2,"AI")) S FBLET=+FBPRG("C") D ^FBCHSLP
"RTN","FBAASLP",27,0)
 I $G(FBPRG("I")),$D(^FBAAI("AI")) S FBLET=+FBPRG("I") D ^FBCHSL1
"RTN","FBAASLP",28,0)
 I '$G(FBGOT) W !,"There are no suspension letters found that meet the criteria you have",!,"specified."
"RTN","FBAASLP",29,0)
END K FBAAS,UL,X,J,K,L,M,VNAM,VST1,VST2,VCITY,VSTATE,FBDT,FBA,VZIP,PNAME,A1,A2,CPT,FBDOS,FBRR,FBXX,DIC,DIWL,DIWF,BEGDATE,ENDDATE,FBAA,FBDRUG,FBFORM,FBI,FBLET,FBPDT,FBRX,FBSLW,FBSW,I,PGM,VAL,VAR,Z,ZZ,FBAAPGM,Y,PSSN,DIRUT
"RTN","FBAASLP",30,0)
 K FBAAOUT,FBCTR,FBPRG,FBY,FBMOD,FBMODLE,DFN,IFN,FBDEN,FBGOT,FBENA
"RTN","FBAASLP",31,0)
 K ^UTILITY($J),^TMP($J)
"RTN","FBAASLP",32,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAASLP",33,0)
MORE F J=0:0 S J=$O(^FBAAC("AI",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP I $D(^FBAAV(K,0)) D MID
"RTN","FBAASLP",34,0)
 Q
"RTN","FBAASLP",35,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBAASLP",36,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBAASLP",37,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6) S Y=DT D PDATE^FBAAUTL
"RTN","FBAASLP",38,0)
 W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W:(IOSL)>70 !!!! W !!!!!!!!!!!,?5,VNAM,?60,FBPDT,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBAASLP",39,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBAASLP",40,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASLP",41,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",42,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",43,0)
 Q
"RTN","FBAASLP",44,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAAC("AI",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBAASLP",45,0)
 Q
"RTN","FBAASLP",46,0)
MORE2 F L=0:0 S L=$O(^FBAAC("AI",K,FBDT,J,FBA,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AI",K,FBDT,J,FBA,L,M)) Q:M'>0  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S Z(0)=^(0) D:$P(Z(0),"^",20)'="R" BOT
"RTN","FBAASLP",47,0)
 Q
"RTN","FBAASLP",48,0)
WPBOT D ACT:$D(FBACRR) K FBACRR
"RTN","FBAASLP",49,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBAASLP",50,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",51,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",52,0)
 Q
"RTN","FBAASLP",53,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,3)>0,1:0)
"RTN","FBAASLP",54,0)
 N FBY3,FBFPPSC
"RTN","FBAASLP",55,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAASLP",56,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAASLP",57,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBAASLP",58,0)
 N FBY,FBX,T,TAMT,FBAC,FBJ,FBCSID,FBUNITS,FBADJLR,FBADJLA,FBRRMKL,FBFPPSL
"RTN","FBAASLP",59,0)
 I FBSW=1 D GOTV,HED S FBSW=0,FBGOT=1
"RTN","FBAASLP",60,0)
 S FBDOS=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:"")
"RTN","FBAASLP",61,0)
 S CPT=$P(Z(0),"^",1),A1=$P(Z(0),"^",2)+.0001,A2=$P(Z(0),"^",3)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2)
"RTN","FBAASLP",62,0)
 I CPT]"" S CPT=$$CPT^FBAAUTL4(CPT)
"RTN","FBAASLP",63,0)
 S T=$P(Z(0),U,5)
"RTN","FBAASLP",64,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAASLP",65,0)
 S TAMT=$FN($P(Z(0),U,4),"",2)
"RTN","FBAASLP",66,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAASLP",67,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBAASLP",68,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAASLP",69,0)
 S FBCSID=$P(FBY,U,16)
"RTN","FBAASLP",70,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAASLP",71,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAASLP",72,0)
 F FBJ=1:1 S FBAC=$P(FBADJLR,",",FBJ) Q:FBAC=""  S FBACRR(FBAC)=""
"RTN","FBAASLP",73,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAASLP",74,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",")
"RTN","FBAASLP",75,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAASLP",76,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBAASLP",77,0)
 W !!,$E(PNAME,1,26),?33,PSSN,?49,FBCSID
"RTN","FBAASLP",78,0)
 W !,$$DATX^FBAAUTL(FBDOS),?10,CPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?33,FBUNITS
"RTN","FBAASLP",79,0)
 I $P($G(FBMODLE),",",2)]"" D
"RTN","FBAASLP",80,0)
 . N FBI
"RTN","FBAASLP",81,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D
"RTN","FBAASLP",82,0)
 . . I $Y+4>IOSL W @IOF D HED W !,"  (continued)"
"RTN","FBAASLP",83,0)
 . . W !,?15,"-",FBMOD
"RTN","FBAASLP",84,0)
 W !,?10,$J(A1,6),?24,$J(A2,6)
"RTN","FBAASLP",85,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAASLP",86,0)
 W ?35,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAASLP",87,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAASLP",88,0)
 W ?49,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAASLP",89,0)
 W ?66,FBRRMKL
"RTN","FBAASLP",90,0)
 I FBFPPSC]"" W !,?10,"FPPS Claim ID: ",FBFPPSC,?38,"FPPS Line Item: ",FBFPPSL
"RTN","FBAASLP",91,0)
 W !
"RTN","FBAASLP",92,0)
 I FBADJLR="" G:FBA=4&($D(^FBAAC(J,1,K,1,L,1,M,1))) WPFT D
"RTN","FBAASLP",93,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBAASLP",94,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",95,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",96,0)
 Q
"RTN","FBAASLP",97,0)
ACT ; print table of adjustment reason descriptions
"RTN","FBAASLP",98,0)
 ; Input 
"RTN","FBAASLP",99,0)
 ;    FBACRR( - required, array
"RTN","FBAASLP",100,0)
 ;    FBACRR(FBADJRE)=""
"RTN","FBAASLP",101,0)
 ;    where FBADJRE = adjustment reason code, external value
"RTN","FBAASLP",102,0)
 N FBADJRE,FBI,FBACT
"RTN","FBAASLP",103,0)
 W !,"*Adjustment Code Text:"
"RTN","FBAASLP",104,0)
 S FBADJRE="" F  S FBADJRE=$O(FBACRR(FBADJRE)) Q:FBADJRE=""  D
"RTN","FBAASLP",105,0)
 . ; get description of code in FBACT
"RTN","FBAASLP",106,0)
 . I $$AR^FBUTL1(,FBADJRE,FBSCDT,"FBACT")<0 Q  ; quit if error
"RTN","FBAASLP",107,0)
 . ; print code and description
"RTN","FBAASLP",108,0)
 . K ^UTILITY($J,"W")
"RTN","FBAASLP",109,0)
 . S DIWL=1,DIWF="WC79"
"RTN","FBAASLP",110,0)
 . ; include code in output
"RTN","FBAASLP",111,0)
 . S X=$$LJ^XLFSTR("("_FBADJRE_")",7," ") D ^DIWP
"RTN","FBAASLP",112,0)
 . S DIWF="WC79I7"
"RTN","FBAASLP",113,0)
 . ; include description in output
"RTN","FBAASLP",114,0)
 . S FBI=0 F  S FBI=$O(FBACT(FBI)) Q:FBI=""  S X=FBACT(FBI) I X]"" D ^DIWP
"RTN","FBAASLP",115,0)
 . D ^DIWW
"RTN","FBAASLP",116,0)
 Q
"RTN","FBAASLP",117,0)
 ;
"RTN","FBAASLP",118,0)
HED W !,"PATIENT NAME",?33,"SSN",?49,"PATIENT ACCOUNT NUMBER"
"RTN","FBAASLP",119,0)
 W !,"SVC DATE",?10,"CPT-MOD",?33,"UNITS"
"RTN","FBAASLP",120,0)
 W !,?10,"AMT CLAIMED",?24,"AMT PAID",?35,"ADJ CODE",?49,"ADJ AMT",?66,"REMIT REMARKS"
"RTN","FBAASLP",121,0)
 W !,UL Q
"RTN","FBAASLP",122,0)
 ;
"RTN","FBAASLP",123,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBAASLP",124,0)
 ;
"RTN","FBAASLP",125,0)
 S Y(0)=^DPT(J,0),PNAME=$P(Y(0),"^",1),PSSN=$TR($$SSN^FBAAUTL(J),"-","")
"RTN","FBAASLP",126,0)
 I PNAME["," D
"RTN","FBAASLP",127,0)
 .N FBNAMES
"RTN","FBAASLP",128,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBAASLP",129,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAASLP",130,0)
 Q
"RTN","FBAASLP",131,0)
SEL W !! S DIC="^FBAA(161.27,",DIC(0)="AEQM" D ^DIC G ENDSL:X=""!(X="^"),SEL:Y<0 S DA=+Y,FBAAS(DA)="",FBSLW=1 G SEL
"RTN","FBAASLP",132,0)
ENDSL I '$D(FBAAS) W !!,*7,"No suspension codes selected!" G END
"RTN","FBAASLP",133,0)
 G AHEAD
"RTN","FBAASLP",134,0)
PSEL F FBA=0:0 S FBA=$O(FBAAS(FBA)) Q:FBA'>0  I $D(^FBAAC("AI",FBA)) F FBDT=BEGDATE-.001:0 S FBDT=$O(^FBAAC("AI",FBA,FBDT)) Q:FBDT'>0!(FBDT>ENDDATE)  D MORE
"RTN","FBAASLP",135,0)
 G END
"RTN","FBAASLP",136,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASLP",137,0)
 F FBRR=0:0 S FBRR=$O(^FBAAC(J,1,K,1,L,1,M,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",138,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",139,0)
 Q
"RTN","FBAASLP",140,0)
STRT N FBACRR,FBSCDT S FBSW=1 S Z=$O(^FBAAC("AI",K,BEGDATE-.001)) S FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAAC("AI",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBAASLP",141,0)
 Q
"RTN","FBAAVP")
0^6^B26602032
"RTN","FBAAVP",1,0)
FBAAVP ;AISC/DMK-VOID & CANCEL VOIDED MEDICAL PAYMENT ;6/21/1999
"RTN","FBAAVP",2,0)
 ;;3.5;FEE BASIS;**4,69**;JAN 30, 1995
"RTN","FBAAVP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAVP",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBAAVP",5,0)
 D DT^DICRW
"RTN","FBAAVP",6,0)
 I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) W !!,*7,"Sorry,you must be a supervisor to use this option.",! Q
"RTN","FBAAVP",7,0)
RDP K ^TMP($J) W !! S DIC="^FBAAC(",DIC(0)="AEQM",DIC("A")="Select Patient: " D ^DIC K DIC("A") G Q:X="^"!(X=""),RDP:Y<0 S DFN=+Y
"RTN","FBAAVP",8,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAVP",9,0)
RDV W !! S DIC="^FBAAV(",DIC(0)="AEQM",DA(1)=DFN D ^DIC G RDP:X="^"!(X=""),RDV:Y<0 S DA=+Y G:'$D(^FBAAC(DFN,DA,"AD")) NOCL^FBAAVP0 D EN1
"RTN","FBAAVP",10,0)
 I CNT'>0 G NVOID^FBAAVP0
"RTN","FBAAVP",11,0)
 D CPAY G Q
"RTN","FBAAVP",12,0)
EN1 S Q="",$P(Q,"-",80)="-",CNT=0
"RTN","FBAAVP",13,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP D HED
"RTN","FBAAVP",14,0)
 F D=0:0 S D=$O(^FBAAC(DFN,DA,"AD",D)) Q:D'>0  F B=0:0 S B=$O(^FBAAC(DFN,DA,"AD",D,B)) Q:B'>0  F K=0:0 S K=$O(^FBAAC(DFN,1,DA,1,B,1,K)) Q:K'>0  S L=^(K,0) Q:$D(^FBAAC(DFN,1,DA,1,B,1,K,"FBREJ"))  D EN2
"RTN","FBAAVP",15,0)
 Q
"RTN","FBAAVP",16,0)
EN2 S FBAAPD=$P(L,"^",14),ZS=$P(L,"^",20),FD=$P(L,"^",6),FBON=$P(L,"^",10),V=$P(L,"^",21) I FD]""&$S($D(FBVOID):(V="VP"),1:(V="")) D WRT
"RTN","FBAAVP",17,0)
 Q
"RTN","FBAAVP",18,0)
WRT N FBFPPSC S FBFPPSC=$P($G(^FBAAC(DFN,1,DA,1,B,1,K,3)),U,1)
"RTN","FBAAVP",19,0)
 S FBDT=$P(^FBAAC(DFN,1,DA,1,B,0),"^"),FBAADT=$E(FBDT,4,5)_"/"_$E(FBDT,6,7)_"/"_$E(FBDT,2,3),B1=$P(L,"^",8),B2=$S(B1="":"",$D(^FBAA(161.7,B1,0)):$P(^FBAA(161.7,B1,0),"^"),1:""),CNT=CNT+1,FBVD=DA,FBSD=B,FBSV=K
"RTN","FBAAVP",20,0)
 D FBCKO^FBAACCB2(DFN,FBVD,FBSD,FBSV)
"RTN","FBAAVP",21,0)
 S FBAAPD=$S(FBAAPD]"":$E(FBAAPD,4,5)_"/"_$E(FBAAPD,6,7)_"/"_$E(FBAAPD,2,3),1:"")
"RTN","FBAAVP",22,0)
 S A1=$P(L,"^",2)+.0001,A2=$P(L,"^",3)+.0001,A1=$P(A1,".")_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".")_"."_$E($P(A2,".",2),1,2),FBIN=$P(L,"^",16)
"RTN","FBAAVP",23,0)
 S FBAACPT=$$CPT^FBAAUTL4($P(L,"^"))
"RTN","FBAAVP",24,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_DA_",1,"_B_",1,"_K_",""M"")","E")
"RTN","FBAAVP",25,0)
 W !,CNT_") ",$S(ZS="R":"*",1:""),$S(V="VP":"#",1:""),?3,FBAADT,?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?23,"$",$J(A1,8),?34,"$",$J(A2,8),?49,FBIN,?60,B2,?68,FBAAPD
"RTN","FBAAVP",26,0)
 I $P($G(FBMODLE),",",2)]"" D  ;Q:FBAAOUT
"RTN","FBAAVP",27,0)
 . N FBI
"RTN","FBAAVP",28,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  ;Q:FBAAOUT
"RTN","FBAAVP",29,0)
 . . ;I $Y+4>IOSL D  Q:FBAAOUT
"RTN","FBAAVP",30,0)
 . . ;. I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBAAVP",31,0)
 . . ;. D HED W !,CNT,") (continued)"
"RTN","FBAAVP",32,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAAVP",33,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC
"RTN","FBAAVP",34,0)
 D PMNT^FBAACCB2
"RTN","FBAAVP",35,0)
 I $D(^FBAAC(DFN,1,DA,1,B,1,K,"R")),^("R")]"" W !?3,"Reason:",!?10,^("R"),!
"RTN","FBAAVP",36,0)
 S ^TMP($J,CNT)=FBAADT_"^"_FBAACPT_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_"^"_$J(A1,8)_"^"_$J(A2,8)_"^"_FBFPPSC_"^"_FBIN_"^"_B2_"^"_FBAAPD_"^"_FBSD_"^"_FBSV_"^"_FD_"^"_A2_"^"_FBON Q
"RTN","FBAAVP",37,0)
 Q
"RTN","FBAAVP",38,0)
HED W @IOF,"Patient Name: ",$P(^DPT(DFN,0),"^"),?50,"Pt.ID ",$$SSN^FBAAUTL(DFN),!!,?2,"VENDOR: ",$P(^FBAAV(DA,0),"^"),!,?10,"('*' Reimb. to Patient   '#' Voided Payment)"
"RTN","FBAAVP",39,0)
 W !," SVC DATE",?11,"CPT-MOD",?20,"AMT CLAIMED",?35,"AMT PAID",?47,"INVOICE #",?57,"BATCH #",?66,"DATE PAID",!,Q,!
"RTN","FBAAVP",40,0)
 Q
"RTN","FBAAVP",41,0)
Q K DIC,DIE,DA,DF,DA(1),^TMP($J),A,A1,A2,B,B1,B2,C,CNT,D,D0,D1,D2,D3,DI,DR,DFN,DIYS,FBAACB,FBAACPT,FBAADT,FBAAPD,FBX,DIR,FBDT,FBIN,FBON,FBSD,FBSV,FD,FBVD,FBVOID,I,K,L,ON,POP,P3,P4,Q,V,X,Y,VP,VAL,ZS,Z,ZZ,FBSSN,DIRUT,FBMOD,FBMODLE
"RTN","FBAAVP",42,0)
 Q
"RTN","FBAAVP",43,0)
CPAY W !!,"Which payment item(s) would you like to ",$S($D(FBVOID):"Cancel the void on",1:"Void")," ? " S DIR(0)="L^1:"_CNT D ^DIR
"RTN","FBAAVP",44,0)
 G RDV:$D(DIRUT) S FBX=Y D HED
"RTN","FBAAVP",45,0)
 F A=1:1:CNT S X=$P(FBX,",",A) Q:X=""  S Y(0)=^TMP($J,X),FBSD=$P(Y(0),"^",9),FBSV=$P(Y(0),"^",10),FD=$P(Y(0),"^",11),A2=$P(Y(0),"^",12),FBON=$P(Y(0),"^",13),^TMP($J,"VOID",X)=DFN_"^"_FBVD_"^"_FBSD_"^"_FBSV_"^"_FD_"^"_A2_"^"_FBON D PRT2
"RTN","FBAAVP",46,0)
VERF S DIR(0)="Y",DIR("A")="Are you sure you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void ")_"the payment(s)",DIR("B")="NO" D ^DIR K DIR G RDP:$D(DIRUT)!'Y
"RTN","FBAAVP",47,0)
 F I=0:0 S I=$O(^TMP($J,"VOID",I)) Q:I'>0  S Y(0)=^(I),DFN=$P(Y(0),"^"),FBVD=$P(Y(0),"^",2),FBSD=$P(Y(0),"^",3),FBSV=$P(Y(0),"^",4),A2=$P(Y(0),"^",6),FBON=$P(Y(0),"^",7) D SETN,^FBAAVP0 W !,?5,".... Done.",!
"RTN","FBAAVP",48,0)
 K FBVR Q
"RTN","FBAAVP",49,0)
SETN S DA=FBSV,VP=$S($D(FBVOID):"",1:"VOID")
"RTN","FBAAVP",50,0)
 I $D(FBVOID) S DR="24///@;24.5///@;25///@"
"RTN","FBAAVP",51,0)
 I '$D(FBVOID) S DR="24///^S X=VP;25////^S X=DUZ"_$S($D(FBVR):";24.5////^S X=FBVR",1:";24.5R;S FBVR=X")
"RTN","FBAAVP",52,0)
 S DIE="^FBAAC("_DFN_",1,"_FBVD_",1,"_FBSD_",1,",DIDEL=162 D ^DIE K DIDEL Q
"RTN","FBAAVP",53,0)
PRT2 D FBCKO^FBAACCB2(DFN,FBVD,FBSD,FBSV)
"RTN","FBAAVP",54,0)
 W !,$P(Y(0),"^",1),?14,$P($P(Y(0),"^",2),","),?23,$P(Y(0),"^",3),?34,$P(Y(0),"^",4),?49,$P(Y(0),"^",6),?62,$P(Y(0),"^",7),?68,$P(Y(0),"^",8)
"RTN","FBAAVP",55,0)
 I $P($P(Y(0),U,2),",",2)]"" D  ;Q:FBAAOUT
"RTN","FBAAVP",56,0)
 . N FBI
"RTN","FBAAVP",57,0)
 . F FBI=2:1 S FBMOD=$P($P(Y(0),U,2),",",FBI) Q:FBMOD=""  D  ;Q:FBAAOUT
"RTN","FBAAVP",58,0)
 . . ;I $Y+4>IOSL D  Q:FBAAOUT
"RTN","FBAAVP",59,0)
 . . ;. I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBAAVP",60,0)
 . . ;. D HED W !,CNT,") (continued)"
"RTN","FBAAVP",61,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAAVP",62,0)
 I $P(Y(0),U,5)]"" W !,?4,"FPPS Claim ID: ",$P(Y(0),U,5)
"RTN","FBAAVP",63,0)
 W !
"RTN","FBAAVP",64,0)
 D PMNT^FBAACCB2
"RTN","FBAAVP",65,0)
 Q
"RTN","FBCHRJP")
0^10^B10589786
"RTN","FBCHRJP",1,0)
FBCHRJP ;AISC/DMK/CMR-PRINT REJECTED PAYMENTS FROM PRICER ;18APR90
"RTN","FBCHRJP",2,0)
 ;;3.5;FEE BASIS;**58,69**;JAN 30, 1995
"RTN","FBCHRJP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHRJP",4,0)
 I '$D(^FBAAI("AH")) W !,*7,"No payments rejected!",! Q
"RTN","FBCHRJP",5,0)
 S (VAR,VAL)="",PGM="START^FBCHRJP" D ZIS^FBAAUTL G END:FBPOP
"RTN","FBCHRJP",6,0)
START K ^TMP($J,"FB") S (FBAAOUT,FBLISTC)=0,Q="",$P(Q,"=",80)="=",QQ="-",$P(QQ,"-",39)="-" U IO W:$E(IOST,1,2)["C-" @IOF D HED
"RTN","FBCHRJP",7,0)
 F FBA=0:0 S FBA=$O(^FBAAI("AH",FBA)) Q:FBA=""  I $D(^FBAA(161.7,FBA,0)),$P(^(0),"^",15)="Y" S FBN=+^(0) D
"RTN","FBCHRJP",8,0)
 .F FBI=0:0 S FBI=$O(^FBAAI("AH",FBA,FBI)) Q:FBI'>0  I $D(^FBAAI(FBI,0)),$P(^(0),"^",9)="",$D(^FBAAI(FBI,"FBREJ")) D
"RTN","FBCHRJP",9,0)
 ..S FBSORT=1 D VET^FBCHDI,SET^FBPAY67
"RTN","FBCHRJP",10,0)
 S (FBVEN,FBNAME)="",(FBDT,FBI)=0 K FBIN
"RTN","FBCHRJP",11,0)
 F  S FBVEN=$O(^TMP($J,"FB",6,FBVEN)) Q:FBVEN=""!(FBAAOUT)  F  S FBNAME=$O(^TMP($J,"FB",6,FBVEN,FBNAME)) Q:FBNAME=""!(FBAAOUT)  F  S FBDT=$O(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT)) Q:FBDT'>0!(FBAAOUT)  D
"RTN","FBCHRJP",12,0)
 .F  S FBI=$O(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI)) Q:FBI'>0!(FBAAOUT)  D  D PRINT
"RTN","FBCHRJP",13,0)
 ..F I=1:1:9 S FBIN(I)=$P(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI),"^",I)
"RTN","FBCHRJP",14,0)
 ..S FB7078=$S($P(^FBAAI(FBI,0),"^",5)["FB7078":$P($G(^FB7078(+$P(^FBAAI(FBI,0),"^",5),0)),"^"),1:"") F I=1:1:3 S FBREJ(I)=$P(^FBAAI(FBI,"FBREJ"),"^",I)
"RTN","FBCHRJP",15,0)
END K DFN,FB,FBA,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBVEN,FBVID,J,K,L,PGM,Q,QQ,VA,VADM,VAL,VAR,Y,FB7078,FBPROC1,FBREJ,FBINV,^TMP($J)
"RTN","FBCHRJP",16,0)
 D CLOSE^FBAAUTL,END^FBCHDI
"RTN","FBCHRJP",17,0)
 Q
"RTN","FBCHRJP",18,0)
PRINT I $Y+5>IOSL,$E(IOST,1,2)["C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBCHRJP",19,0)
 I $Y+5>IOSL W @IOF D HED
"RTN","FBCHRJP",20,0)
 S FBINV=^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI,"FBINV") ;set by FBPAY67
"RTN","FBCHRJP",21,0)
 ;If adj code found print it, if not then print suspend code
"RTN","FBCHRJP",22,0)
 I $P(FBINV,U,5)]"" S FBIN(4)=$P(FBINV,U,5)
"RTN","FBCHRJP",23,0)
 W !!,"Vendor: ",$P(FBVEN,";"),?41,"Vendor ID: ",+$P(FBVEN,";",2)
"RTN","FBCHRJP",24,0)
 W !,"Patient: ",$P(FBNAME,";"),?41,"Patient ID: ",$$SSN^FBAAUTL($P(FBNAME,";",2))
"RTN","FBCHRJP",25,0)
 W ! W:FBIN(8)["R" "*" W:FBIN(9)]"" "#" W ?3,FBIN(1),?23,FBIN(2),?33,FBIN(3),?42,FBIN(4),?49,FBIN(5),?61,FBIN(6),?72,FBIN(7)
"RTN","FBCHRJP",26,0)
 ;If FPPS Claim ID exists then print it.
"RTN","FBCHRJP",27,0)
 I $P(FBINV,U,3)]"" D
"RTN","FBCHRJP",28,0)
 .W !?3,"FPPS Claim ID: ",$P(FBINV,U,3),"    FPPS Line Item: ",$P(FBINV,U,4)
"RTN","FBCHRJP",29,0)
 W !?3,"DX: ",+$G(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI,"DX"))
"RTN","FBCHRJP",30,0)
 W !?3,"Associated 7078: ",FB7078,!?3,$S(FBREJ(1)="P":"Rejects Pending!",FBREJ(1)="C":"Rejected!",1:""),?23,"Reject Reason: ",FBREJ(2),!?3,"Old Batch #: ",FBREJ(3)
"RTN","FBCHRJP",31,0)
 Q
"RTN","FBCHRJP",32,0)
HED W !?18,"CIVIL HOSPITAL REJECTED PAYMENT HISTORY",!?18,QQ
"RTN","FBCHRJP",33,0)
 W !!?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBCHRJP",34,0)
 W !?2,"Inv Date",?23,"Amount",?33," Amount",?42,"Adj",?49,"Invoice",?61,"From",?73,"To"
"RTN","FBCHRJP",35,0)
 W !?23,"Claimed",?35,"Paid",?42,"Code",?53,"Num",?61,"Date",?71,"Date",!,Q
"RTN","FBCHRJP",36,0)
 Q
"RTN","FBCHSL1")
0^3^B17825081
"RTN","FBCHSL1",1,0)
FBCHSL1 ;AISC/DMK-PRINT SUSPENSION LETTERS CONTINUED ;09/07/00
"RTN","FBCHSL1",2,0)
 ;;3.5;FEE BASIS;**23,69**;JAN 30, 1995
"RTN","FBCHSL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHSL1",4,0)
 N FBACRR,FBSCDT
"RTN","FBCHSL1",5,0)
 F K=0:0 S K=$O(^FBAAI("AI",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) S FBSW=1,FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAAI("AI",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBCHSL1",6,0)
 K FBCHAD,FBCHDT,FBAMTC,FBAMTP,FBAMTS Q
"RTN","FBCHSL1",7,0)
MORE F J=0:0 S J=$O(^FBAAI("AI",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP^FBAASLP I $D(^FBAAV(K,0)) D MID
"RTN","FBCHSL1",8,0)
 Q
"RTN","FBCHSL1",9,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBCHSL1",10,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBCHSL1",11,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6)
"RTN","FBCHSL1",12,0)
 W @IOF,!!!!!!!,?5,VNAM,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBCHSL1",13,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBCHSL1",14,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSL1",15,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",16,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",17,0)
 D HED
"RTN","FBCHSL1",18,0)
 Q
"RTN","FBCHSL1",19,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAAI("AI",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBCHSL1",20,0)
 Q
"RTN","FBCHSL1",21,0)
MORE2 F L=0:0 S L=$O(^FBAAI("AI",K,FBDT,J,FBA,L)) Q:L'>0  I $D(^FBAAI(L,0)) S Z(0)=^(0) D BOT
"RTN","FBCHSL1",22,0)
 Q
"RTN","FBCHSL1",23,0)
WPBOT D:$D(FBACRR) ACT^FBAASLP K FBACRR
"RTN","FBCHSL1",24,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBCHSL1",25,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",26,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",27,0)
 Q
"RTN","FBCHSL1",28,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,9)>0,1:0)  ;quit if not den (if prn den's only)
"RTN","FBCHSL1",29,0)
 N FBY3,FBFPPSC
"RTN","FBCHSL1",30,0)
 S FBY3=$G(^FBAAI(L,3))
"RTN","FBCHSL1",31,0)
 S FBFPPSC=$P(FBY3,U,1) ; fpps claim id
"RTN","FBCHSL1",32,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBCHSL1",33,0)
 N FBCSID,FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,T,TAMT
"RTN","FBCHSL1",34,0)
 S FBCSID=$P($G(^FBAAI(L,2)),U,11) ; patient control number
"RTN","FBCHSL1",35,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBCHSL1",36,0)
 S FBX=$$ADJLRA^FBCHFA(L_",")
"RTN","FBCHSL1",37,0)
 S T=$P(Z(0),U,11)
"RTN","FBCHSL1",38,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBCHSL1",39,0)
 S TAMT=$FN($P(Z(0),U,10),"",2)
"RTN","FBCHSL1",40,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCHSL1",41,0)
 S:FBADJLR]"" FBACRR(FBADJLR)=""
"RTN","FBCHSL1",42,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCHSL1",43,0)
 S FBRRMKL=$$RRL^FBCHFR(L_",")
"RTN","FBCHSL1",44,0)
 I FBSW=1 D GOTV^FBAASLP,HED S FBSW=0,FBGOT=1
"RTN","FBCHSL1",45,0)
 S Y=$P(Z(0),"^",7) D PDATE^FBAAUTL S FBCHDT=FBPDT,Y=$P(Z(0),"^",6) D PDATE^FBAAUTL S FBCHAD=FBPDT,FBAMTC=$P(Z(0),"^",8),FBAMTP=$P(Z(0),"^",9),FBAMTS=$P(Z(0),"^",10)
"RTN","FBCHSL1",46,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBCHSL1",47,0)
 W !!,PNAME,?32,PSSN,?56,FBCHAD
"RTN","FBCHSL1",48,0)
 W !,FBCSID,?24,FBCHDT,?44,"$ ",FBAMTC,?61,"$ ",FBAMTP,!
"RTN","FBCHSL1",49,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBCHSL1",50,0)
 W ?4,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBCHSL1",51,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBCHSL1",52,0)
 W ?32,"$ ",$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBCHSL1",53,0)
 W ?59,FBRRMKL
"RTN","FBCHSL1",54,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC,?32,"FPPS Line Item: ",FBFPPSL,!
"RTN","FBCHSL1",55,0)
 I FBADJLR="" G:FBA=4&($D(^FBAAI(L,1,0))) WPFT D
"RTN","FBCHSL1",56,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBCHSL1",57,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",58,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",59,0)
 Q
"RTN","FBCHSL1",60,0)
HED W !,"PATIENT NAME",?36,"SSN",?53,"ADMISSION DATE"
"RTN","FBCHSL1",61,0)
 W !,"PATIENT CONTROL #",?22,"DISCHARGE DATE",?42,"AMOUNT CLAIMED",?59,"AMOUNT PAID"
"RTN","FBCHSL1",62,0)
 W !,"ADJUSTMENT CODE",?29,"ADJUSTMENT AMOUNT",?54,"MEDICARE REMITTANCE REMARK"
"RTN","FBCHSL1",63,0)
 W !,UL,! Q
"RTN","FBCHSL1",64,0)
 ;
"RTN","FBCHSL1",65,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBCHSL1",66,0)
 ;
"RTN","FBCHSL1",67,0)
 S Y(0)=^DPT(J,0),PNAME=$$NAME^FBCHREQ2(J)
"RTN","FBCHSL1",68,0)
 S PSSN=$TR($$SSN^FBAAUTL(J),"-","")
"RTN","FBCHSL1",69,0)
 I PNAME["," D
"RTN","FBCHSL1",70,0)
 .N FBNAMES
"RTN","FBCHSL1",71,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBCHSL1",72,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBCHSL1",73,0)
 Q
"RTN","FBCHSL1",74,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSL1",75,0)
 F FBRR=0:0 S FBRR=$O(^FBAAI(L,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",76,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",77,0)
 Q
"RTN","FBCHSL1",78,0)
HELP W !,"Answer 'Yes' to print suspension letters for all suspension",!,"codes, otherwise answer 'No' to select specific codes." G RDCODE^FBAASLP
"RTN","FBCHVP")
0^8^B23931772
"RTN","FBCHVP",1,0)
FBCHVP ;AISC/CMR-VOID & CANCEL VOIDED INPATIENT PAYMENT ;3/3/93
"RTN","FBCHVP",2,0)
 ;;3.5;FEE BASIS;**55,69**;JAN 30, 1995
"RTN","FBCHVP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHVP",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBCHVP",5,0)
 ;Variable 'FBTYPE' is set to 6 for CH or 7 for CNH.
"RTN","FBCHVP",6,0)
 D DT^DICRW
"RTN","FBCHVP",7,0)
 I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) W !!,*7,"Sorry, you must be a supervisor to use this option.",! Q
"RTN","FBCHVP",8,0)
RDP ;Get veteran if they have an inpatient invoice (DFN).
"RTN","FBCHVP",9,0)
 K ^TMP($J) W !! S DIC=161,DIC(0)="AEMZ",DIC("S")="I $D(^FBAAI(""AK"",+Y))" D ^DIC K DIC G Q:X=""!($D(DTOUT))!($D(DUOUT)),RDP:Y<0 S DFN=+Y
"RTN","FBCHVP",10,0)
RDV ;Get vendor if an inpatient provider for this patient (FBV).
"RTN","FBCHVP",11,0)
 W !! S DIC=161.2,DIC(0)="AEMZ",DIC("S")="I $D(^FBAAI(""AK"",DFN,+Y))" D ^DIC K DIC G Q:X=""!($D(DTOUT))!($D(DUOUT)),RDV:Y<0 S FBV=+Y
"RTN","FBCHVP",12,0)
 D EN1
"RTN","FBCHVP",13,0)
 I FBCTR=0 W !!?12,*7,"Vendor has no",$S($D(FBVOID):" VOIDED",1:"")," finalized payments ",$S('$D(FBVOID):"to VOID",1:""),!?12,"for this patient under the ",$S(FBTYPE=6:"CIVIL HOSPITAL",1:"COMMUNITY NURSING HOME")," program." G RDV
"RTN","FBCHVP",14,0)
 W !!,"Which payment item(s) would you like to ",$S($D(FBVOID):"Cancel the void on",1:"Void")," ? " S DIR(0)="L^1:"_FBCTR D ^DIR G RDV:$D(DIRUT) S FBX=Y W @IOF D HED
"RTN","FBCHVP",15,0)
 F A=1:1:FBCTR S X=$P(FBX,",",A) Q:X=""  S FBI=+FBI(X),FBINV=^TMP($J,"FBCHVP",FBI),FBVD=$P(FBINV,"^",14) W ! D WRT1 S ^TMP($J,"FBCHVP","VOID",FBI)=""
"RTN","FBCHVP",16,0)
 W ! S DIR(0)="Y",DIR("A")="Are you sure you want to "_$S($D(FBVOID):"Cancel the void on",1:"Void")_" the payment(s)",DIR("B")="No" D ^DIR K DIR G RDP:$D(DIRUT)!'Y
"RTN","FBCHVP",17,0)
 S FBI=0 F  S FBI=$O(^TMP($J,"FBCHVP","VOID",FBI)) Q:FBI'>0  D SETR,CONF W !,?5,".... Done.",!
"RTN","FBCHVP",18,0)
Q K DFN,FBV,FBI,FBTYPE,FBVOID,FBCTR,FBAMTC,FBAMTP,FBBAT,FBDRG,FBFDT,FBINV,FBNUM,FBREIM,FBTDT,FBVD,Q,FBX,VP,^TMP($J,"FBCHVP"),Y,DIE,DR,FBVR,DA
"RTN","FBCHVP",19,0)
 Q
"RTN","FBCHVP",20,0)
EN1 ;Find finalized payments that match FBTYPE and store in ^TMP.
"RTN","FBCHVP",21,0)
 S (FBI,FBCTR)=0,Q="-",$P(Q,"-",80)="-"
"RTN","FBCHVP",22,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHVP",23,0)
 F  S FBI=$O(^FBAAI("AK",DFN,FBV,FBI)) Q:FBI'>0  I $D(^FBAAI(FBI,0)),'$D(^("FBREJ")) S FBINV=^(0),FBVD=$P(FBINV,"^",14) I $P(FBINV,"^",16)'=""&($P(FBINV,"^",12)=FBTYPE)&($S($D(FBVOID):(FBVD="VP"),1:(FBVD=""))) D WRT
"RTN","FBCHVP",24,0)
 Q
"RTN","FBCHVP",25,0)
WRT N FBX,FBY2,FBY3,FBCDAYS,FBSCID,FBFPPSC,FBFPPSL,FBADJLR,FBRRMKL
"RTN","FBCHVP",26,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBCHVP",27,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBCHVP",28,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBCHVP",29,0)
 S FBCDAYS=$P(FBY2,U,10)  ; covered days
"RTN","FBCHVP",30,0)
 S FBSCID=$P(FBY2,U,11)  ; patient control number
"RTN","FBCHVP",31,0)
 S FBFPPSC=$P(FBY3,U)  ; fpps claim id
"RTN","FBCHVP",32,0)
 S FBFPPSL=$P(FBY3,U,2)  ; fpps line item
"RTN","FBCHVP",33,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",")  ; remit remarks
"RTN","FBCHVP",34,0)
 S FBADJLR=$P(FBX,U)  ; adjustment reason
"RTN","FBCHVP",35,0)
 S ^TMP($J,"FBCHVP",FBI)=FBINV
"RTN","FBCHVP",36,0)
 S ^TMP($J,"FBCHVP",FBI,"FBMR")=FBCDAYS_U_FBADJLR_U_FBRRMKL_U_FBSCID_U_FBFPPSC_U_FBFPPSL
"RTN","FBCHVP",37,0)
 I FBCTR=0!($Y+5>IOSL) W @IOF D HED
"RTN","FBCHVP",38,0)
 S FBCTR=FBCTR+1,FBI(FBCTR)=FBI
"RTN","FBCHVP",39,0)
 W !,FBCTR_") " D WRT1 I $D(FBVOID)&($D(^FBAAI(FBI,"R"))) W !?3,"Reason:",!?10,^("R"),!
"RTN","FBCHVP",40,0)
 Q
"RTN","FBCHVP",41,0)
WRT1 N FBMRVP S FBMRVP=^TMP($J,"FBCHVP",FBI,"FBMR")
"RTN","FBCHVP",42,0)
 S FBREIM=$P(FBINV,"^",13),FBFDT=$P(FBINV,"^",6),FBTDT=$P(FBINV,"^",7),FBDRG=$P(FBINV,"^",24),FBAMTC=$P(FBINV,"^",8),FBAMTP=$P(FBINV,"^",9),FBNUM=+FBINV,FBBAT=$P(FBINV,"^",17)
"RTN","FBCHVP",43,0)
 D FBCKI^FBAACCB1(FBI)
"RTN","FBCHVP",44,0)
 W $S(FBREIM="R":"*",1:""),$S(FBVD="VP":"#",1:""),?3,$$DATX^FBAAUTL(FBFDT),?16,$$DATX^FBAAUTL(FBTDT)
"RTN","FBCHVP",45,0)
 W ?26,$S($G(FBDRG):$J($$ICD^FBCSV1(FBDRG,$G(FBFDT)),4),1:""),?35,$J($FN(FBAMTC,",",2),8),?48,$J($FN(FBAMTP,",",2),8),?62,$J(FBNUM,5),?72,$J($P($G(^FBAA(161.7,+FBBAT,0)),"^"),6)
"RTN","FBCHVP",46,0)
 W !,?5,$P(FBMRVP,U),?19,$P(FBMRVP,U,2),?34,$P(FBMRVP,U,3),?54,$P(FBMRVP,U,4)
"RTN","FBCHVP",47,0)
 I $P(FBMRVP,U,5)]"" W !,?5,"FPPS Claim ID: ",$P(FBMRVP,U,5),?33,"FPPS Line Item: ",$P(FBMRVP,U,6)
"RTN","FBCHVP",48,0)
 N A2 S A2=+FBAMTP D PMNT^FBAACCB2
"RTN","FBCHVP",49,0)
 Q
"RTN","FBCHVP",50,0)
HED W !,"Patient Name: ",$P(^DPT(DFN,0),"^"),?50,"Pt.ID ",$$SSN^FBAAUTL(DFN),!!,?2,"VENDOR: ",$P(^FBAAV(FBV,0),"^"),!,?10,"('*' Represents Reimbursement to Patient)",!,?10,"('#' Represents a Voided Payment)"
"RTN","FBCHVP",51,0)
 W !,"   FROM DATE",?16,"TO DATE",?26,"DRG",?33,"AMT CLAIMED",?48,"AMT PAID",?60,"INVOICE #",?72,"BATCH #"
"RTN","FBCHVP",52,0)
 W !,?5,"COV.DAYS",?19,"ADJ CODE",?34,"REMIT REMARKS",?55,"PATIENT CONTROL #"
"RTN","FBCHVP",53,0)
 W !,Q,!
"RTN","FBCHVP",54,0)
 Q
"RTN","FBCHVP",55,0)
SETR ;Set/delete void node on record.
"RTN","FBCHVP",56,0)
 S DA=FBI,VP=$S($D(FBVOID):"",1:"VOID")
"RTN","FBCHVP",57,0)
 I $D(FBVOID) S DR="16///@;16.5///@;17///@"
"RTN","FBCHVP",58,0)
 I '$D(FBVOID) S DR="16///^S X=VP;17////^S X=DUZ"_$S($D(FBVR):";16.5////^S X=FBVR",1:";16.5R;S FBVR=X")
"RTN","FBCHVP",59,0)
 S DIE="^FBAAI(",DIDEL=162.5 D ^DIE K DIDEL
"RTN","FBCHVP",60,0)
 Q
"RTN","FBCHVP",61,0)
CONF ;Print void/cancel void confirmation.
"RTN","FBCHVP",62,0)
 W !,?10,$S($D(FBVOID):"Cancel Voided",1:"Void")," payment for ",$$NAME^FBCHREQ2(DFN),!,*7,"You must adjust control point accordingly through IFCAP!"
"RTN","FBCHVP",63,0)
 Q
"RTN","FBPAY")
0^16^B23138914
"RTN","FBPAY",1,0)
FBPAY ;AISC/DMK,GRR,TET-PATIENT/VENDOR PAYMENT OUTPUT DRIVER ;7/9/2001
"RTN","FBPAY",2,0)
 ;;3.5;FEE BASIS;**32,69**;JAN 30, 1995
"RTN","FBPAY",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY",4,0)
GETVEN ;select vendor
"RTN","FBPAY",5,0)
 K FBX S FBSORT=0 ;FBSORT=1 for patient, = 0 for vendor
"RTN","FBPAY",6,0)
 S DIC="^FBAAV(",DIC(0)="AEQMZ",DIC("A")="Select Fee Vendor: " W !! D ^DIC K DIC("A") G EXIT:$D(DTOUT)!($D(DUOUT))!(X=""),GETVEN:Y<0
"RTN","FBPAY",7,0)
 S FBIEN=+Y,FBNAME=$S(Y(0,0)]"":Y(0,0),1:"UNKNOWN"),FBID=$S($P(Y(0),U,2)]"":$P(Y(0),U,2),1:"UNKNOWN") G DATE
"RTN","FBPAY",8,0)
GETVET ;select patient
"RTN","FBPAY",9,0)
 K FBX S FBSORT=1 ;FBSORT=1 for patient, =0 for vendor
"RTN","FBPAY",10,0)
 S DIC="^FBAAA("
"RTN","FBPAY",11,0)
 S DIC(0)="AEQMNZ",DIC("A")="Select Fee Patient: " W !! D ^DIC K DIC("A") G EXIT:$D(DTOUT)!($D(DUOUT))!(X=""),GETVET:Y<0
"RTN","FBPAY",12,0)
 S FBIEN=+Y,FBNAME=Y(0,0),FBID=$$SSN^FBAAUTL(FBIEN)
"RTN","FBPAY",13,0)
DATE ;select date range
"RTN","FBPAY",14,0)
 D DATE^FBAAUTL I FBPOP G GETVET:FBSORT,GETVEN
"RTN","FBPAY",15,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPAY",16,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPAY",17,0)
PROG ;select one/many/all fee programs
"RTN","FBPAY",18,0)
 I '$G(FBCHK) S DIC="^FBAA(161.8,",DIC("S")="I $P(^(0),U,3)",VAUTSTR="FEE Program",VAUTNI=2,VAUTVB="FBPROG" D FIRST^VAUTOMA I 'FBPROG&('$O(FBPROG(0))) G GETVET:FBSORT,GETVEN
"RTN","FBPAY",19,0)
 I FBPROG S FBERR=0 D ARRAY G EXIT:FBERR
"RTN","FBPAY",20,0)
ASKMB ; if outpatient or civil hospital or pharmacy selected then ask if
"RTN","FBPAY",21,0)
 ;   report for just mill-bill (1725) or just non-mill bill claims
"RTN","FBPAY",22,0)
 I $D(FBPROG(2))!$D(FBPROG(3))!$D(FBPROG(6)) S FB1725R=$$ASKMB^FBUCUTL9 I FB1725R="" G EXIT
"RTN","FBPAY",23,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBTR"),DIC S FBX=FBSORT
"RTN","FBPAY",24,0)
 S VAR="FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPROG^FBPROG(^FBSORT^FB1725R",VAL=VAR,PGM="DQ^FBPAY" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPAY",25,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPAY",26,0)
SORT ;sort driver for payment output(s)
"RTN","FBPAY",27,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPAY",28,0)
 .I FBPI=2 D EN^FBPAY2 ;outpatient payments
"RTN","FBPAY",29,0)
 .I FBPI=3 D EN^FBPAY3 ;pharmacy payments
"RTN","FBPAY",30,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&$D(FBPROG(7)) FBPIFLG=67 D EN^FBPAY67 S:$D(FBPIFLG) FBPI=7 K FBPIFLG ;civil hospital/cnh payments
"RTN","FBPAY",31,0)
PRINT ;print driver for payment output(s)
"RTN","FBPAY",32,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPAY",33,0)
 S (FBOUT,FBPI)=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPAY",34,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPI)) D PRINT^FBPAY21 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",35,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPI)) PRINT^FBPAY3 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",36,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPI)) PRINT^FBPAY671 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",37,0)
OUT I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPAY",38,0)
 D KILL G GETVET:FBX,GETVEN
"RTN","FBPAY",39,0)
 Q
"RTN","FBPAY",40,0)
EXIT ;kill and quit
"RTN","FBPAY",41,0)
 K FBX
"RTN","FBPAY",42,0)
KILL ;kill all variables set in the FBPAY* routines, other than fbx
"RTN","FBPAY",43,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB"),^TMP($J,"FBTR")
"RTN","FBPAY",44,0)
 K A1,A2,A3,BEGDATE,B3,C,C3,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE
"RTN","FBPAY",45,0)
 K FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD,FBMOD
"RTN","FBPAY",46,0)
 K FBI,FBID,FBIEN,FBIN,FBINVN,FBIX,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIFLG,FBPIN,FBPISV,FBPNAME,FBPROG,FBPT,FBPV,FBQTY,FBREIM,FBR,FBRX,FBTRCK
"RTN","FBPAY",47,0)
 K FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,TAMT,FBRRMKL,FBADJ,FBINV
"RTN","FBPAY",48,0)
 K FBSC,FBSL,FBSORT,FBSTR,FBSUSP,FBTA,FBTRDT,FBTRX,FBTYPE,FBV,FBVCHAIN,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,J,K,L,M,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z
"RTN","FBPAY",49,0)
 K FB1725R
"RTN","FBPAY",50,0)
 Q
"RTN","FBPAY",51,0)
ARRAY ;set array if all programs are selected
"RTN","FBPAY",52,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPAY",53,0)
 I '$D(FBPROG) S FBERR=1
"RTN","FBPAY",54,0)
 Q
"RTN","FBPAY",55,0)
WMSG ;write message if no matches found
"RTN","FBPAY",56,0)
 S FBPG=FBPG+1 W:$G(FBCRT) @IOF W !
"RTN","FBPAY",57,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY",58,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY",59,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG
"RTN","FBPAY",60,0)
 I FBSORT W !,"Patient: ",FBNAME,?41,"Patient ID:",FBID
"RTN","FBPAY",61,0)
 I 'FBSORT W !,"Vendor: ",FBNAME,?41,"Vendor ID:",FBID
"RTN","FBPAY",62,0)
 ;W !?(IOM-12/2),"FEE PROGRAM:"
"RTN","FBPAY",63,0)
 W !?3,"('*' Reimb. to Patient   '+' Cancel. Activity   '#' Voided Payment)"
"RTN","FBPAY",64,0)
 W !!!,FBDASH
"RTN","FBPAY",65,0)
 W !!,"There are no payments on file for "_$S(FBSORT:"Veteran",1:"Vendor")_" ",FBNAME,!?3,"for specified date range: ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPAY",66,0)
 I 'FBPROG D
"RTN","FBPAY",67,0)
 .W !?3,"and selected Fee Program(s):"
"RTN","FBPAY",68,0)
 .S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  W !?30,FBPROG(FBPI)
"RTN","FBPAY",69,0)
 I FBPROG W !?3,"and ALL Fee programs"
"RTN","FBPAY",70,0)
 W ".",*7,!!
"RTN","FBPAY",71,0)
 Q
"RTN","FBPAY",72,0)
OTH ;other fee basis programs
"RTN","FBPAY",73,0)
 I '$D(^TMP($J,"FB",FBPI_"O")) Q
"RTN","FBPAY",74,0)
 S FBZ=FBPI,FBPI=FBPI_"O",FBPROG(FBPI)="**OUTPATIENT** "_FBXPROG
"RTN","FBPAY",75,0)
 D PRINT^FBPAY21
"RTN","FBPAY",76,0)
 K FBPROG(FBPI) S FBPI=FBZ K FBZ
"RTN","FBPAY",77,0)
 Q
"RTN","FBPAY2")
0^17^B22790628
"RTN","FBPAY2",1,0)
FBPAY2 ;AISC/DMK,GRR,TET - OUTPATIENT PAYMENT HISTORY SORT/PRINT ;7/9/2001
"RTN","FBPAY2",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69**;JAN 30, 1995
"RTN","FBPAY2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY2",4,0)
EN ;entry point
"RTN","FBPAY2",5,0)
 I FBSORT S FBPNAME=FBNAME,FBPID=FBID,(DFN,J)=FBIEN D SORT
"RTN","FBPAY2",6,0)
 I 'FBSORT S FBVNAME=$E(FBNAME,1,23),FBVID=FBID,FBVI=FBIEN,J=0 F  S J=$O(^FBAAC("AB",FBVI,J)) Q:J'>0  S DFN=J,FBPID=$$SSN^FBAAUTL(DFN),FBPNAME=$P($G(^DPT(DFN,0)),U) D SORT
"RTN","FBPAY2",7,0)
KILL ;kill variables set in this routine
"RTN","FBPAY2",8,0)
 K A1,A2,A3,B3,C3,D,D2,FBAACPTC,FBBN,FBCP,FBDOS,FBDT,FBDT1,FBIN,FBOB,FBP,FBPAT,FBPDX,FBSC,FBTA,FBTRDT,FBTRX,FBTYPE,FBVEN,FBVP,I,J,K,L,M,T,Y,FBMODLE,FB1725
"RTN","FBPAY2",9,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBY3,FBFPPSC,FBFPPSL,FBAARCE
"RTN","FBPAY2",10,0)
 K:FBSORT FBVNAME,FBVID
"RTN","FBPAY2",11,0)
 K:'FBSORT FBPNAME,FBPID,FBTRCK
"RTN","FBPAY2",12,0)
 Q
"RTN","FBPAY2",13,0)
SORT S I=FBBEG F  S I=$O(^FBAAC(J,"AB",I)) Q:'I!(I>FBEND)  F K=0:0 S K=$O(^FBAAC(J,"AB",I,K)) Q:'K  I FBSORT!(('FBSORT)&(K=$G(FBVI))) F L=0:0 S L=$O(^FBAAC(J,"AB",I,K,L)) Q:'L  D SETTR F M=0:0 S M=$O(^FBAAC(J,1,K,1,L,1,M)) Q:'M  D SET,SETTMP
"RTN","FBPAY2",14,0)
 Q
"RTN","FBPAY2",15,0)
SET ;set variables & sort - also entry point from FBPAY67
"RTN","FBPAY2",16,0)
 N FBX
"RTN","FBPAY2",17,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I '+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"") S FBOUT=1 Q
"RTN","FBPAY2",18,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY2",19,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY2",20,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(Y,U,13)["FB583":+$P($G(^FB583(+$P(Y,U,13),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) S FBOUT=1 Q
"RTN","FBPAY2",21,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBPAY2",22,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBPAY2",23,0)
 S FBAARCE=$$GET1^DIQ(162.03,M_","_L_","_K_","_J_",",48) ;revenue code
"RTN","FBPAY2",24,0)
 D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBPAY2",25,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPAY2",26,0)
 S:FBSORT FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2),1:"")
"RTN","FBPAY2",27,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23)
"RTN","FBPAY2",28,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPAY2",29,0)
 S FBPDX=$$ICD9EX^FBCSV1(FBPDX,3,18,+$G(^FBAAC(J,1,K,1,L,0)))
"RTN","FBPAY2",30,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPAY2",31,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPAY2",32,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPAY2",33,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPAY2",34,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPAY2",35,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPAY2",36,0)
 S FBCSID=$P(FBY,U,16) ;patient control number
"RTN","FBPAY2",37,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBPAY2",38,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBPAY2",39,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPAY2",40,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPAY2",41,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPAY2",42,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPAY2",43,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPAY2",44,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY2",45,0)
 ;output format
"RTN","FBPAY2",46,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),FBIN=$J(FBIN,7)
"RTN","FBPAY2",47,0)
 S A2=A2_$$APS^FBAAUTL4(J,K,L,M) ; append symbol
"RTN","FBPAY2",48,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPAY2",49,0)
 Q
"RTN","FBPAY2",50,0)
SETTMP ;sort data by fee program, vendor, patient, date
"RTN","FBPAY2",51,0)
 I '$D(FBPROG(+$P(Y,U,9)))!($P(Y,U,9)'=FBPI)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"") S FBOUT=1 G SETTMP1
"RTN","FBPAY2",52,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY2",53,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY2",54,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(Y,U,13)["FB583":+$P($G(^FB583(+$P(Y,U,13),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) S FBOUT=1 G SETTMP1
"RTN","FBPAY2",55,0)
 S ^TMP($J,"FB",FBP,FBVEN,FBPAT,I,L,M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB
"RTN","FBPAY2",56,0)
 S ^TMP($J,"FB",FBP,FBVEN,FBPAT,I,L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY2",57,0)
 S ^TMP($J,"FB",FBP,FBVEN,FBPAT,I,L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY2",58,0)
SETTMP1 D PMTCLN^FBAACCB2
"RTN","FBPAY2",59,0)
 Q
"RTN","FBPAY2",60,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=""
"RTN","FBPAY2",61,0)
 ; if just mill bill (FB1725R="M") requested then skip travel payments
"RTN","FBPAY2",62,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)),$G(FB1725R)'="M" S (FBTA,FBCTR)=0 F  S FBTA=$O(^FBAAC(J,3,"AB",D,FBTA)) Q:'FBTA  S A3=$P($G(^FBAAC(J,3,FBTA,0)),"^",3) I A3>0 D
"RTN","FBPAY2",63,0)
 .D FBCKT^FBAACCB0(J,FBTA) S FBCTR=FBCTR+1,^TMP($J,"FBTR",FBPNAME,D,FBCTR)=$J(A3,6,2)_"^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY2",64,0)
 K A3,B3,FBTA,FBCTR
"RTN","FBPAY2",65,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPAY2",66,0)
 Q
"RTN","FBPAY2",67,0)
EN1 ;entry point to set variables, called by fbpay67, oth & anc
"RTN","FBPAY2",68,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPAY2",69,0)
 D SETTR,SET
"RTN","FBPAY2",70,0)
 Q
"RTN","FBPAY2",71,0)
WMSG ;write message if no matches found
"RTN","FBPAY2",72,0)
 W !!,"There are no outpatient payments on file for specified date range"
"RTN","FBPAY2",73,0)
 W:'FBPROG !?3," and selected Fee programs"
"RTN","FBPAY2",74,0)
 W ".",*7,!!
"RTN","FBPAY2",75,0)
 Q
"RTN","FBPAY21")
0^18^B16002202
"RTN","FBPAY21",1,0)
FBPAY21 ;AISC/CMR-OUTPATIENT PAYMENT HISTORY SORT/PRINT ;7/11/2001
"RTN","FBPAY21",2,0)
 ;;3.5;FEE BASIS;**4,32,69**;JAN 30, 1995
"RTN","FBPAY21",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY21",4,0)
PRINT ;write output
"RTN","FBPAY21",5,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY21",6,0)
 D HDR I FBSORT S FBPAT=FBPNAME I $D(^TMP($J,"FBTR")) S FBTRCK=1 D TRAV^FBPAY671
"RTN","FBPAY21",7,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" D  Q:FBOUT
"RTN","FBPAY21",8,0)
 .F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D:'FBSORT SH,SH1 Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  D
"RTN","FBPAY21",9,0)
 ..S L=0 F  S L=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L)) Q:'L!(FBOUT)  S M=0 F  S M=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M)) Q:'M!(FBOUT)  D
"RTN","FBPAY21",10,0)
 ...I ($Y+6)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY21",11,0)
 ...S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M)
"RTN","FBPAY21",12,0)
 ...S FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M,"FBCK")) D EFBCK(FBCKIN)
"RTN","FBPAY21",13,0)
 ...S FBADJ=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M,"FBADJ"))
"RTN","FBPAY21",14,0)
 ...W !,$S($G(FBCAN)]"":"+",1:"")
"RTN","FBPAY21",15,0)
 ...W ?1,$P(FBDATA,U,1)
"RTN","FBPAY21",16,0)
 ...W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPAY21",17,0)
 ...W ?22,$P(FBADJ,U,9)
"RTN","FBPAY21",18,0)
 ...W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPAY21",19,0)
 ...W ?43,$P(FBDATA,U,6)
"RTN","FBPAY21",20,0)
 ...W ?54,$P(FBDATA,U,7)
"RTN","FBPAY21",21,0)
 ...W ?64,$P(FBDATA,U,8)
"RTN","FBPAY21",22,0)
 ...I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPAY21",23,0)
 ....N FBI,FBMOD
"RTN","FBPAY21",24,0)
 ....F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPAY21",25,0)
 .....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPAY21",26,0)
 .....W !?16,"-",FBMOD
"RTN","FBPAY21",27,0)
 ...W !,$P(FBDATA,U,3)
"RTN","FBPAY21",28,0)
 ...W ?13,$P(FBDATA,U,4)
"RTN","FBPAY21",29,0)
 ...W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPAY21",30,0)
 ...W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPAY21",31,0)
 ...W ?48,$P(FBADJ,U,5)
"RTN","FBPAY21",32,0)
 ...W ?60,$P(FBADJ,U,6)
"RTN","FBPAY21",33,0)
 ...I $P(FBADJ,U,7)]"" W !?5,"FPPS Claim ID: ",$P(FBADJ,U,7),"     FPPS Line Item: ",$P(FBADJ,U,8)
"RTN","FBPAY21",34,0)
 ...S A2=$$EXTRL^FBMRASVR($P(FBDATA,U,4))
"RTN","FBPAY21",35,0)
 ...W !?4,"Primary Dx: ",$P(FBDATA,U,10),?40,"S/C Condition? ",$P(FBDATA,U,9) W ?63,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPAY21",36,0)
 ...D PMNT^FBAACCB2 K A2
"RTN","FBPAY21",37,0)
 Q
"RTN","FBPAY21",38,0)
HDR ;main header
"RTN","FBPAY21",39,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY21",40,0)
 S FBPG=FBPG+1
"RTN","FBPAY21",41,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY21",42,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY21",43,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!
"RTN","FBPAY21",44,0)
 W:FBSORT "Patient: ",FBPNAME,?41,"Patient ID: ",FBPID W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID
"RTN","FBPAY21",45,0)
 ;W ?71,"Page: ",FBPG
"RTN","FBPAY21",46,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY21",47,0)
 W !,?3,"('*' Reimb. to Patient   '+' Cancel. Activity   '#' Voided Payment)"
"RTN","FBPAY21",48,0)
 W !,?3,"(paid symbol: 'R' RBRVS  'F' 75th percentile  'C' contract  'M' Mill Bill"
"RTN","FBPAY21",49,0)
 W !,?3,"              'U' U&C)"
"RTN","FBPAY21",50,0)
 W !,?1,"Svc Date",?11,"CPT-MOD ",?21,"Rev Code",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPAY21",51,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPAY21",52,0)
 Q
"RTN","FBPAY21",53,0)
SH ;subheader - vendor if fbsort; patient if 'fbsort, prints when name changed
"RTN","FBPAY21",54,0)
 I ($Y+8)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY21",55,0)
 I FBSORT W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPAY21",56,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Patient ID: ",$$SSN^FBAAUTL($P(FBPT,";",2))
"RTN","FBPAY21",57,0)
 Q
"RTN","FBPAY21",58,0)
SH1 S FBPAT=$P(FBPT,";") I $D(^TMP($J,"FBTR",FBPAT)) S FBTRCK=1 D TRAV^FBPAY671
"RTN","FBPAY21",59,0)
 Q
"RTN","FBPAY21",60,0)
CR ;read for display
"RTN","FBPAY21",61,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY21",62,0)
 Q
"RTN","FBPAY21",63,0)
PAGE ;new page
"RTN","FBPAY21",64,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY21",65,0)
 D HDR,SH
"RTN","FBPAY21",66,0)
 Q
"RTN","FBPAY21",67,0)
EFBCK(FBCKIN) ;extract check information from ^TMP
"RTN","FBPAY21",68,0)
 I $G(FBCKIN)']"" S (FBCK,FBCKDT,FBCANDT,FBCANR,FBCAN,FBDIS,FBCKINT)="" Q
"RTN","FBPAY21",69,0)
 S U="^",FBCK=$P(FBCKIN,U,2),FBCKDT=$P(FBCKIN,U,3),FBCANDT=$P(FBCKIN,U,4),FBCANR=$P(FBCKIN,U,5),FBCAN=$P(FBCKIN,U,6),FBDIS=$P(FBCKIN,U,7),FBCKINT=$P(FBCKIN,U,8)
"RTN","FBPAY21",70,0)
 K FBCKIN
"RTN","FBPAY21",71,0)
 Q
"RTN","FBPAY21",72,0)
 ;
"RTN","FBPAY21",73,0)
EN ;entry from fbpay67 to set '*' if ancillary payment is
"RTN","FBPAY21",74,0)
 ;a reimbursement.  returns FBRP=to '*' or " "
"RTN","FBPAY21",75,0)
 ;'Y' passed in equal to zero node of 162.03 look at $P(Y,U,20)
"RTN","FBPAY21",76,0)
 ;
"RTN","FBPAY21",77,0)
 S FBR=$P($G(Y),U,20),FBR=$S(FBR="R":"*",1:" ")
"RTN","FBPAY21",78,0)
 Q
"RTN","FBPAY3")
0^19^B36156876
"RTN","FBPAY3",1,0)
FBPAY3 ;AISC/GRR,TET-PHARMACY PAYMENT HISTORY, SORT/PRINT ;7/9/2001
"RTN","FBPAY3",2,0)
 ;;3.5;FEE BASIS;**12,32,69**;JAN 30, 1995
"RTN","FBPAY3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY3",4,0)
EN ;entry point
"RTN","FBPAY3",5,0)
 I FBSORT S FBPNAME=FBNAME,FBPID=FBID,(DFN,J)=FBIEN,FBDOB=$$FMTE^XLFDT($P($G(^DPT(DFN,0)),U,3)) D SORT
"RTN","FBPAY3",6,0)
 I 'FBSORT S FBVNAME=$E(FBNAME,1,23),FBVID=FBID,FBVI=FBIEN,FBVCHAIN=$P($G(^FBAAV(FBVI,0)),U,10),FBDA1=0 D
"RTN","FBPAY3",7,0)
 .F  S FBDA1=$O(^FBAA(162.1,"AN",FBVI,FBDA1)) Q:'FBDA1  S J=0 F  S J=$O(^FBAA(162.1,FBDA1,"RX","C",J)) Q:'J  S DFN=J D VET,SORT
"RTN","FBPAY3",8,0)
FBAAC ;check if anything in an xref, fbaac global (file 162)
"RTN","FBPAY3",9,0)
 I '$D(^TMP($J,"FB",FBPI)),$D(^FBAAC("AN",FBPI)) D:'FBSORT AN^FBPAY67
"RTN","FBPAY3",10,0)
KILL ;kill variables set in sort
"RTN","FBPAY3",11,0)
 K A1,A2,FBAC,FBAP,FBBATCH,FBDA1,FBDRUG,FBFD,FBFD1,FBINVN,FBLOC,FBPAT,FBPD,FBPV,FBQTY,FBREIM,FBRX,FBSTR,FBSUSP,FBVEN,FBVI,I,J,K,L,N,V,Y
"RTN","FBPAY3",12,0)
 K FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,TAMT,FBRRMKL
"RTN","FBPAY3",13,0)
 K:FBSORT FBVNAME,FBVID,FBVCHAIN K:'FBSORT FBPNAME,FBPID,FBDOB
"RTN","FBPAY3",14,0)
 D KILL^FBPAY2
"RTN","FBPAY3",15,0)
 Q
"RTN","FBPAY3",16,0)
SORT ;
"RTN","FBPAY3",17,0)
 S I=FBBEG F  S I=$O(^FBAA(162.1,"AD",J,I)) Q:I'>0!(I>FBEND)  S K=0 F  S K=$O(^FBAA(162.1,"AD",J,I,K)) Q:K'>0  S L=0 F  S L=$O(^FBAA(162.1,"AD",J,I,K,L)) Q:L'>0  D SET
"RTN","FBPAY3",18,0)
 Q
"RTN","FBPAY3",19,0)
 ;
"RTN","FBPAY3",20,0)
SET ;
"RTN","FBPAY3",21,0)
 N FBX
"RTN","FBPAY3",22,0)
 S Y(0)=$G(^FBAA(162.1,+K,"RX",+L,0)) I Y(0)']""!($P(Y(0),U,9)=1) Q
"RTN","FBPAY3",23,0)
 I $G(^FBAA(162.1,+K,"RX",+L,"FBREJ"))]"" Q  ;Eliminates Rejected Payments
"RTN","FBPAY3",24,0)
 I 'FBSORT Q:FBVI'=$P($G(^FBAA(162.1,+K,0)),"^",4)
"RTN","FBPAY3",25,0)
 S Y(2)=$G(^FBAA(162.1,+K,0))
"RTN","FBPAY3",26,0)
 S Y(1)=$G(^FBAA(162.1,+K,"RX",+L,2))
"RTN","FBPAY3",27,0)
 S FBFPPSC=$P($G(^FBAA(162.1,+K,0)),U,13) ;FPPS claim ID
"RTN","FBPAY3",28,0)
 S FBFPPSL=$P($G(^FBAA(162.1,+K,"RX",+L,3)),U) ;FPPS line item
"RTN","FBPAY3",29,0)
 S FBX=$$ADJLRA^FBRXFA(+L_","_+K_",")
"RTN","FBPAY3",30,0)
 S FBADJLR=$P(FBX,U) ;adjustment code
"RTN","FBPAY3",31,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPAY3",32,0)
 S TAMT=$FN($P(Y(0),"^",7),"",2) ;suspend amount
"RTN","FBPAY3",33,0)
 S FBRRMKL=$$RRL^FBRXFR(+L_","_+K_",") ;remitt remarks
"RTN","FBPAY3",34,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY3",35,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY3",36,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(Y(1),U,6)["FB583":+$P($G(^FB583(+$P(Y(1),U,6),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) Q
"RTN","FBPAY3",37,0)
 S FBINVN=$P(Y(2),U) D VEN:FBSORT,VET:'FBSORT
"RTN","FBPAY3",38,0)
 S FBRX=$P(Y(0),U,1),FBDRUG=$P(Y(0),U,2),FBFD=$P(Y(0),U,3),FBAC=$P(Y(0),U,4),FBAP=$P(Y(0),U,16),FBSUSP=$P(Y(0),U,8),FBPD=$P(Y(0),U,19),FBBATCH=$P(Y(0),U,17),FBBATCH=$P($G(^FBAA(161.7,+FBBATCH,0)),U)
"RTN","FBPAY3",39,0)
 I FBSUSP]"" S FBSUSP=$P($G(^FBAA(161.27,+FBSUSP,0)),U)
"RTN","FBPAY3",40,0)
 S FBREIM=$S($P(Y(0),U,20)="R":"*",1:""),FBSTR=$P(Y(0),U,12),FBQTY=$P(Y(0),U,13),A1=$J(FBAC,6,2),A2=$J(FBAP,6,2),FBPV=""
"RTN","FBPAY3",41,0)
 S FBPD=$$DATX^FBAAUTL(FBPD),FBFD=$$DATX^FBAAUTL(FBFD)
"RTN","FBPAY3",42,0)
 S FBPV=$S($P(Y(1),U,3)="V":"#",1:""),FBFD1=$S(FBPV="":" ",1:FBPV)_$S(FBREIM="":" ",1:FBREIM)_FBFD,FBRX="Rx: "_FBRX
"RTN","FBPAY3",43,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY3",44,0)
 D FBCKP^FBAACCB1(K,L)
"RTN","FBPAY3",45,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L)=FBFD1_U_FBRX_U_FBDRUG_U_FBSTR_U_FBQTY_U_A1_U_A2_U_FBSUSP_U_FBINVN_U_FBBATCH_U_FBPD_U_FBDOB_U_FBVCHAIN_U_TAMT
"RTN","FBPAY3",46,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L,"FBADJ")=FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBFPPSC_U_FBFPPSL
"RTN","FBPAY3",47,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT D PMTCLN^FBAACCB2
"RTN","FBPAY3",48,0)
 S ^TMP($J,"FB",FBPI,FBVEN)=FBVCHAIN,^TMP($J,"FB",FBPI,FBVEN,FBPAT)=FBDOB
"RTN","FBPAY3",49,0)
 I FBSORT S FBIN(5)=$P(Y(1),U,6) I FBIN(5)]"",$D(^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L)) D ANC^FBPAY67(I,L)
"RTN","FBPAY3",50,0)
 I 'FBSORT D OTH^FBPAY67
"RTN","FBPAY3",51,0)
 Q
"RTN","FBPAY3",52,0)
VET ;set variables for veteran - 'FBSORT
"RTN","FBPAY3",53,0)
 S FBPID=$$SSN^FBAAUTL(DFN),N=$G(^DPT(+DFN,0)),FBPNAME=$P(N,U),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPAY3",54,0)
 Q
"RTN","FBPAY3",55,0)
VEN ;set variables for vendor - FBSORT
"RTN","FBPAY3",56,0)
 S V=$G(^FBAAV(+$P(Y(2),U,4),0)),FBVNAME=$E($P(V,U),1,23),FBVID=$P(V,U,2),FBVCHAIN=$P(V,U,10)
"RTN","FBPAY3",57,0)
 Q
"RTN","FBPAY3",58,0)
PRINT ;write output
"RTN","FBPAY3",59,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY3",60,0)
 D HDR
"RTN","FBPAY3",61,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" D  Q:FBOUT
"RTN","FBPAY3",62,0)
 .F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D:'FBSORT SH Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  S L=0 F  S L=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L)) Q:'L!(FBOUT)  D  Q:FBOUT
"RTN","FBPAY3",63,0)
 ..I ($Y+8)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY3",64,0)
 ..S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L),FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"FBCK")) D EFBCK^FBPAY21(FBCKIN)
"RTN","FBPAY3",65,0)
 ..S FBADJ=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"FBADJ")
"RTN","FBPAY3",66,0)
 ..; S FBLOC="0^2^15^45^63^4^12^20^24^35^53"
"RTN","FBPAY3",67,0)
 ..W !,$P(FBDATA,U),?64,$P(FBDATA,U,11),!
"RTN","FBPAY3",68,0)
 ..W ?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?45,$P(FBDATA,U,4),?63,$P(FBDATA,U,5)
"RTN","FBPAY3",69,0)
 ..;F I=2:1:$L(FBLOC,"^") W ?$P(FBLOC,U,I),$P(FBDATA,U,I) W:$P(FBLOC,U,I)=63 !
"RTN","FBPAY3",70,0)
 ..W !?4,$P(FBDATA,U,6),?12,$P(FBDATA,U,7)
"RTN","FBPAY3",71,0)
 ..W ?20 I $P(FBADJ,U,1)]"" W $P(FBADJ,U,1),?30,$J($P(FBADJ,U,2),14)
"RTN","FBPAY3",72,0)
 ..I $P(FBADJ,U,1)="" W $P(FBDATA,U,8),?30,$J($P(FBDATA,U,14),14)
"RTN","FBPAY3",73,0)
 ..W ?47,$P(FBDATA,U,9),?58,$P(FBDATA,U,10),?66,$P(FBADJ,U,3)
"RTN","FBPAY3",74,0)
 ..I $P(FBADJ,U,4)]"" W !?5,"FPPS Claim ID: ",$P(FBADJ,U,4),"     FPPS Line Item: ",$P(FBADJ,U,5)
"RTN","FBPAY3",75,0)
 ..S A2=$$EXTRL^FBMRASVR($P(FBDATA,"^",7)) D PMNT^FBAACCB2 K A2
"RTN","FBPAY3",76,0)
 ..I +$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"A",0)) D PANC^FBPAY671(L) Q:FBOUT  W !,FBDASH1
"RTN","FBPAY3",77,0)
 ..W !
"RTN","FBPAY3",78,0)
EXIT ;kill and quit
"RTN","FBPAY3",79,0)
 Q
"RTN","FBPAY3",80,0)
HDR ;main header
"RTN","FBPAY3",81,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY3",82,0)
 S FBPG=FBPG+1
"RTN","FBPAY3",83,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY3",84,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY3",85,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!
"RTN","FBPAY3",86,0)
 W:FBSORT "Patient: ",FBPNAME,?41,"Pat. ID: ",FBPID,?62,"DOB: ",FBDOB W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID,?65,"Chain #: ",FBVCHAIN
"RTN","FBPAY3",87,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY3",88,0)
 ;W ?71,"Page: ",FBPG
"RTN","FBPAY3",89,0)
 W !?3,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBPAY3",90,0)
 W !?4,"Fill Date",?64,"Date Certified"
"RTN","FBPAY3",91,0)
 W !,?15,"Drug Name",?44,"Strength",?60,"Quantity"
"RTN","FBPAY3",92,0)
 W !?2,"Claimed",?12,"Paid",?20,"Adj Code",?33,"Adj Amounts",?47,"Invoice #",?58,"Batch #",?66,"Remit Remarks",!,FBDASH
"RTN","FBPAY3",93,0)
 Q
"RTN","FBPAY3",94,0)
SH ;subheader - vendor if fbsort; patient if  'fbsort, prints when name changes
"RTN","FBPAY3",95,0)
 I ($Y+10)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY3",96,0)
 I FBSORT W !!,"Vendor:",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2),?65,"Chain #: ",$P($G(^TMP($J,"FB",FBPI,FBVI)),U)
"RTN","FBPAY3",97,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Pat. ID: ",$$SSN^FBAAUTL($P(FBPT,";",2)),?62,"DOB: ",$P($G(^TMP($J,"FB",FBPI,FBVI,FBPT)),U)
"RTN","FBPAY3",98,0)
 Q
"RTN","FBPAY3",99,0)
CR ;read for display
"RTN","FBPAY3",100,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY3",101,0)
 Q
"RTN","FBPAY3",102,0)
PAGE ;new page
"RTN","FBPAY3",103,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY3",104,0)
 D HDR,SH
"RTN","FBPAY3",105,0)
 Q
"RTN","FBPAY67")
0^20^B38135461
"RTN","FBPAY67",1,0)
FBPAY67 ;AISC/DMK,TET-CH/CNH PAYMENT HISTORY SORT ;7/9/2001
"RTN","FBPAY67",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69**;JAN 30, 1995
"RTN","FBPAY67",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY67",4,0)
EN ;entry to sort
"RTN","FBPAY67",5,0)
 I FBSORT S DFN=FBIEN,FBPID=FBID,FBPNAME=FBNAME
"RTN","FBPAY67",6,0)
 I 'FBSORT S FBVI=FBIEN,FBVID=FBID,FBVNAME=$E(FBNAME,1,23)
"RTN","FBPAY67",7,0)
FBAAC ;check ^fbaac("an" (file 162)
"RTN","FBPAY67",8,0)
 S FBOUT=0 I $D(^FBAAC("AN",FBPI)) D AN  I $G(FBPIFLG) S FBPI=7 D AN S FBPI=6
"RTN","FBPAY67",9,0)
 S I=FBBEG,FBIX=$S(FBSORT:"AG",1:"AF")
"RTN","FBPAY67",10,0)
SORT ;sort programs 6 & 7 (civil hos & cnh)
"RTN","FBPAY67",11,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI(FBIX,FBIEN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI(FBIX,FBIEN,FBM,FBI)) Q:FBI'>0  I $G(^FBAAI(FBI,"FBREJ"))']"" D SET S FBPI=FBPISV
"RTN","FBPAY67",12,0)
KILL ;kill variables set in routine and in FBPAY2, sort/set sections
"RTN","FBPAY67",13,0)
 K A1,A2,A3,D,D2,FBAACPTC,FBBN,FBCNT,FBCP,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBIX,FBM,FBOB,FBPDX,FBPISV,FBPROC,FBPROC1,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBDT2
"RTN","FBPAY67",14,0)
 K:FBSORT FBVNAME,FBVID K:'FBSORT FBPNAME,FBPID
"RTN","FBPAY67",15,0)
 D KILL^FBPAY2
"RTN","FBPAY67",16,0)
 Q
"RTN","FBPAY67",17,0)
SET ;set string, also called by fbchdi (fblistc or fbaanq set if called by fbchdi)
"RTN","FBPAY67",18,0)
 N FBY2,FBY3,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,FBAARCE,FBX
"RTN","FBPAY67",19,0)
 S FBPISV=$G(FBPI),FBIN=$G(^FBAAI(FBI,0)) Q:FBIN']""  S FBPI=+$P(FBIN,U,12)
"RTN","FBPAY67",20,0)
 I 'FBPROG,'$D(FBPROG(+$P(FBIN,U,12))) Q
"RTN","FBPAY67",21,0)
 I '$D(FBPIFLG) Q:+$P(FBIN,U,12)'=FBPI
"RTN","FBPAY67",22,0)
 I $D(FBPIFLG),'FBPROG Q:'$D(FBPROG(+$P(FBIN,U,12)))
"RTN","FBPAY67",23,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBPAY67",24,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBPAY67",25,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY67",26,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY67",27,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(FBIN,U,5)["FB583":+$P($G(^FB583(+$P(FBIN,U,5),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) Q
"RTN","FBPAY67",28,0)
 F J=1,2,3,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBPAY67",29,0)
 S:FBSORT FBIN(5)=$P(FBIN,U,5) I 'FBSORT S FBIN(4)=$P(FBIN,U,4),DFN=FBIN(4) Q:DFN']""  S FBPID=$$SSN^FBAAUTL(DFN),FBPNAME=$P($G(^DPT(+DFN,0)),U)
"RTN","FBPAY67",30,0)
 I FBSORT S FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPAY67",31,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY67",32,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPAY67",33,0)
 D FBCKI^FBAACCB1(FBI)
"RTN","FBPAY67",34,0)
SETTMP S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_FBIN(13)_U_FBIN(14)_U_FBIN(10)
"RTN","FBPAY67",35,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",36,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPAY67",37,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPAY67",38,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBPAY67",39,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBPAY67",40,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPAY67",41,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPAY67",42,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPAY67",43,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPAY67",44,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBFPPSC_"^"_FBFPPSL_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL
"RTN","FBPAY67",45,0)
 S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPAY67",46,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"DX")=FBDX1
"RTN","FBPAY67",47,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:5 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPAY67",48,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPAY67",49,0)
 D ANC(FBM,FBI):FBSORT&($D(^TMP($J,"FB",FBPI,FBVEN,FBPAT,FBM,FBI)))
"RTN","FBPAY67",50,0)
 Q
"RTN","FBPAY67",51,0)
AN ;get data from an xref - called at tag fbaac in pay3 & pay67
"RTN","FBPAY67",52,0)
 I FBSORT G AN1
"RTN","FBPAY67",53,0)
 S FBVEN=FBVNAME_";"_FBVID,DFN=0 F  S DFN=$O(^FBAAC("AN",FBPI,DFN)) Q:'DFN  S FBPAT=$G(^DPT(DFN,0)),FBPNAME=$P(FBPAT,U),FBPID=$$SSN^FBAAUTL(DFN),FBPAT=FBPNAME_";"_DFN D OTH
"RTN","FBPAY67",54,0)
 Q
"RTN","FBPAY67",55,0)
AN1 S FBPAT=FBPNAME_";"_FBPID,FBVI=0 F  S FBVI=$O(^FBAAC("AN",FBPI,DFN,FBVI)) Q:'FBVI  S FBVNAME=$E($$VNAME^FBNHEXP(FBVI),1,23),FBVID=$$VID^FBNHEXP(FBVI),FBVEN=FBVNAME_";"_FBVID D OTH
"RTN","FBPAY67",56,0)
 Q
"RTN","FBPAY67",57,0)
OTH ;other fee programs - if 'fbsort (by vendor)
"RTN","FBPAY67",58,0)
 Q:'$O(^FBAAC("AN",FBPI,DFN,FBVI,0))
"RTN","FBPAY67",59,0)
 N J,K,L,M,Y,FBDT1 S J=DFN,K=FBVI
"RTN","FBPAY67",60,0)
 S L=0 F  S L=$O(^FBAAC("AN",FBPI,J,K,L)) Q:'L  S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]""&(FBDT1'<FBBDATE&(FBDT1'>FBEDATE)) D  S:FBOUT FBOUT=0
"RTN","FBPAY67",61,0)
 .S M=0 F  S M=$O(^FBAAC("AN",FBPI,J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",62,0)
 ..S FBOUT=0 D EN1^FBPAY2 Q:FBOUT  D EN^FBPAY21
"RTN","FBPAY67",63,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M)=$G(FBR)_$$DATX^FBAAUTL(FBDT1)_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB
"RTN","FBPAY67",64,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",65,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",66,0)
 Q
"RTN","FBPAY67",67,0)
ANC(FBM,FBI) ;ancillary payments - if fbsort (by patient)
"RTN","FBPAY67",68,0)
 N J,K,L,M,Y,FBDT1,FBVID
"RTN","FBPAY67",69,0)
 N FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBFPPSC,FBFPPSL,FBAARCE
"RTN","FBPAY67",70,0)
 S J=FBIEN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPAY67",71,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPAY67",72,0)
 ..N FBOUT
"RTN","FBPAY67",73,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT2=(9999999.9999-FBDT1),FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPAY67",74,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",75,0)
 ...D EN1^FBPAY2 Q:'$D(FBAACPTC)!($G(FBOUT))  S FBCNT=FBCNT+1 D EN^FBPAY21
"RTN","FBPAY67",76,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M)=$G(FBR)_FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID
"RTN","FBPAY67",77,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",78,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",79,0)
 ...I $D(^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)) K ^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)
"RTN","FBPAY67",80,0)
 Q
"RTN","FBPAY671")
0^21^B36348688
"RTN","FBPAY671",1,0)
FBPAY671 ;AISC/DMK,TET-CH/CNH PAYMENT HISTORY PRINT ;7/18/2001
"RTN","FBPAY671",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69**;JAN 30, 1995
"RTN","FBPAY671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPAY671",4,0)
PRINT ;print data from tmp global
"RTN","FBPAY671",5,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY671",6,0)
 S FBHEAD=$S(FBSORT:"VETERAN",1:"VENDOR")
"RTN","FBPAY671",7,0)
EN1 N FBI,FBINV ;entry point from fbchdi
"RTN","FBPAY671",8,0)
 D HDR S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D  Q:FBOUT  D CKANC Q:FBOUT
"RTN","FBPAY671",9,0)
 .D:'FBSORT SH Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI)) Q:'FBI!(FBOUT)  D  Q:FBOUT
"RTN","FBPAY671",10,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",11,0)
 ..S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI),A2=$$EXTRL^FBMRASVR($P(FBDATA,U,3))
"RTN","FBPAY671",12,0)
 ..S FBINV=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBINV")
"RTN","FBPAY671",13,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPAY671",14,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPAY671",15,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPAY671",16,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPAY671",17,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPAY671",18,0)
 ..W ?36,$S($P(FBINV,U,5)]"":$P(FBINV,U,5),1:$P(FBDATA,U,4))
"RTN","FBPAY671",19,0)
 ..W ?46,$S($P(FBINV,U,5)]"":$J($P(FBINV,U,6),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPAY671",20,0)
 ..W ?63,$P(FBINV,U,7)
"RTN","FBPAY671",21,0)
 .. ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",22,0)
 ..I $P(FBINV,U,3)]"" D
"RTN","FBPAY671",23,0)
 ...W !?5,"FPPS Claim ID: ",$P(FBINV,U,3),"    FPPS Line Item: ",$P(FBINV,U,4)
"RTN","FBPAY671",24,0)
 ..F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPAY671",25,0)
 ..I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D EFBCK^FBPAY21(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D PMNT^FBAACCB2 K A2
"RTN","FBPAY671",26,0)
 Q
"RTN","FBPAY671",27,0)
CKANC I +$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",0)) D PANC(FBI) Q:FBOUT  W !,FBDASH1
"RTN","FBPAY671",28,0)
 Q
"RTN","FBPAY671",29,0)
PANC(FBI) ;print anc data - FBI = unique number; called by fbpay3
"RTN","FBPAY671",30,0)
 S (FBOV,FBK)=0,FBSL=8,FBLOC=1_U_12_U_23_U_33_U_43_U_56_U_62_U_71 D SHA Q:FBOUT
"RTN","FBPAY671",31,0)
 F  S FBK=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK)) Q:'FBK!(FBOUT)  S FBL=0 F  S FBL=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL)) Q:'FBL!(FBOUT)  S FBM=0 F  S FBM=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)) Q:'FBM!(FBOUT)  D
"RTN","FBPAY671",32,0)
 .S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)
"RTN","FBPAY671",33,0)
 .S FBV=$P(FBDATA,U,12)_";"_$P(FBDATA,U,13)
"RTN","FBPAY671",34,0)
 .D WRT
"RTN","FBPAY671",35,0)
 K FBK,FBL,FBM Q
"RTN","FBPAY671",36,0)
WRT ;write ancillary info
"RTN","FBPAY671",37,0)
 I ($Y+6)>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT
"RTN","FBPAY671",38,0)
 D:FBOV'=FBV SHA2
"RTN","FBPAY671",39,0)
 S FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBCK")) D EFBCK^FBPAY21(FBCKIN)
"RTN","FBPAY671",40,0)
 S FBADJ=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBADJ"))
"RTN","FBPAY671",41,0)
 W ! W:$G(FBCAN)]"" "+"
"RTN","FBPAY671",42,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPAY671",43,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPAY671",44,0)
 W ?22,$P(FBADJ,U,9)
"RTN","FBPAY671",45,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPAY671",46,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPAY671",47,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPAY671",48,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPAY671",49,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPAY671",50,0)
 . N FBI,FBMOD
"RTN","FBPAY671",51,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPAY671",52,0)
 . . I $Y+7>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT  W !,"  (continued)"
"RTN","FBPAY671",53,0)
 . . W !?16,"-",FBMOD
"RTN","FBPAY671",54,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPAY671",55,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPAY671",56,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPAY671",57,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPAY671",58,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPAY671",59,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPAY671",60,0)
 ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",61,0)
 I $P(FBADJ,U,7)]"" D
"RTN","FBPAY671",62,0)
 .W !?5,"FPPS Claim ID: ",$P(FBADJ,U,7),"    FPPS Line Item: ",$P(FBADJ,U,8)
"RTN","FBPAY671",63,0)
 W !?4,"Primary Dx: ",$P(FBDATA,U,10),?40,"S/C Condition? ",$P(FBDATA,U,9),?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPAY671",64,0)
 N A2 S A2=$$EXTRL^FBMRASVR($P(FBDATA,U,4))
"RTN","FBPAY671",65,0)
 D PMNT^FBAACCB2
"RTN","FBPAY671",66,0)
 Q
"RTN","FBPAY671",67,0)
HDR ;main header
"RTN","FBPAY671",68,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY671",69,0)
 S FBPG=FBPG+1
"RTN","FBPAY671",70,0)
 I $D(FBHEAD) D
"RTN","FBPAY671",71,0)
 .W !?25,FBHEAD_" PAYMENT HISTORY"
"RTN","FBPAY671",72,0)
 .I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY671",73,0)
 .W !,?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!?48,"Date Range: ",$$DATX^FBAAUTL(FBBDATE)," to ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPAY671",74,0)
 I '$D(FBHEAD) W !?30,"INVOICE DISPLAY",!?29,$E(FBDASH,1,17),!
"RTN","FBPAY671",75,0)
 W ! W:FBSORT "Patient: ",FBPNAME,?41,"Patient ID: ",FBPID W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID
"RTN","FBPAY671",76,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY671",77,0)
 W !?3,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBPAY671",78,0)
 W !,?3,"(paid symbol: 'R' RBRVS  'F' 75th percentile  'C' contract  'M' Mill Bill"
"RTN","FBPAY671",79,0)
 W !,?3,"              'U' U&C)"
"RTN","FBPAY671",80,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPAY671",81,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPAY671",82,0)
 Q
"RTN","FBPAY671",83,0)
SH ;subheader - vendor if fbsort; patient if 'fbsort, prints when name changed
"RTN","FBPAY671",84,0)
 I ($Y+7)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY671",85,0)
 I FBSORT W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPAY671",86,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Patient ID: ",$$SSN^FBAAUTL($P(FBPT,";",2))
"RTN","FBPAY671",87,0)
 Q
"RTN","FBPAY671",88,0)
SHA ;ancillary subheader
"RTN","FBPAY671",89,0)
 I ($Y+14)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",90,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPAY671",91,0)
SHA1 ;subheader for ancillary data
"RTN","FBPAY671",92,0)
 W !,?1,"Svc Date",?11,"CPT-MOD ",?21,"Rev Code",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPAY671",93,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPAY671",94,0)
 Q
"RTN","FBPAY671",95,0)
SHA2 ;subheader for vendor name
"RTN","FBPAY671",96,0)
 I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR,SH,SHA
"RTN","FBPAY671",97,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPAY671",98,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID: ",$P(FBV,";",2)
"RTN","FBPAY671",99,0)
 Q
"RTN","FBPAY671",100,0)
CR ;read for display
"RTN","FBPAY671",101,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY671",102,0)
 Q
"RTN","FBPAY671",103,0)
PAGE ;new page
"RTN","FBPAY671",104,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY671",105,0)
 D HDR,SH
"RTN","FBPAY671",106,0)
 Q
"RTN","FBPAY671",107,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPAY671",108,0)
 Q
"RTN","FBPAY671",109,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPAY671",110,0)
 Q
"RTN","FBPAY671",111,0)
WRTSC ;write service connected
"RTN","FBPAY671",112,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPAY671",113,0)
 Q
"RTN","FBPAY671",114,0)
TRAV ;write out travel payments, (FBPAT,FBSORT) must be defined
"RTN","FBPAY671",115,0)
 S FBTRDT=0
"RTN","FBPAY671",116,0)
 F  S FBTRDT=$O(^TMP($J,"FBTR",FBPAT,FBTRDT)) Q:'FBTRDT  S FBTRX=0 F  S FBTRX=$O(^TMP($J,"FBTR",FBPAT,FBTRDT,FBTRX)) Q:'FBTRX  S FBCKIN=^(FBTRX),A2=$P(FBCKIN,"^") D TRCK Q:FBOUT  W:$G(FBTRCK) !,?5,"TRAVEL PAYMENTS: " D  K FBTRCK
"RTN","FBPAY671",117,0)
 .W ?22,$$DATX^FBAAUTL(FBTRDT),?35,A2
"RTN","FBPAY671",118,0)
 .S A2=$$EXTRL^FBMRASVR(A2) D EFBCK^FBPAY21(FBCKIN),PMNT^FBAACCB2
"RTN","FBPAY671",119,0)
 .K A2 W ! Q
"RTN","FBPAY671",120,0)
 Q
"RTN","FBPAY671",121,0)
TRCK I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR^FBPAY21
"RTN","FBPAY671",122,0)
 Q
"RTN","FBPCR2")
0^12^B34442449
"RTN","FBPCR2",1,0)
FBPCR2 ;ALBISC/DMK,GRR,TET-OUTPATIENT POTENTIAL COST RECOVERY SORT/PRINT ;5/12/1999
"RTN","FBPCR2",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69**;JAN 30, 1995
"RTN","FBPCR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR2",4,0)
EN ;entry point
"RTN","FBPCR2",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",6,0)
SORT ;sort by date finalized, patient, vendor, treatment ien, service ien
"RTN","FBPCR2",7,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAAC("AK",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAAC("AK",I,J)) Q:'J  D
"RTN","FBPCR2",8,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR2",9,0)
 .S K=0  F  S K=$O(^FBAAC("AK",I,J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AK",I,J,K,L)) Q:'L  D SETTR S M=0 F  S M=$O(^FBAAC("AK",I,J,K,L,M)) Q:'M  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",10,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR2",11,0)
KILL ;kill variables set in this routine
"RTN","FBPCR2",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCP,FBDOB,FBDOS,FBDT,FBDT1,FBIN,FBINS,FBOB,FBP,FBPAT,FBPCR,FBPDX,FBPDXC,FBPID,FBPNAME,FBPSF,FBSC,FBTA,FBTYPE,FBVEN,FBVID,FBVNAME,FBVP,I,J,K,L,M,T,Y,FBMODLE
"RTN","FBPCR2",13,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ
"RTN","FBPCR2",14,0)
 Q
"RTN","FBPCR2",15,0)
SET ;set variables - also entry point from FBPCR67
"RTN","FBPCR2",16,0)
 N FBPCR,FBX
"RTN","FBPCR2",17,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:'+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"")
"RTN","FBPCR2",18,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBPCR2",19,0)
 S FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2),1:"")
"RTN","FBPCR2",20,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23),FBPSF=+$P(Y,U,12)
"RTN","FBPCR2",21,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPCR2",22,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPCR2",23,0)
 Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))  S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$S(FBSC["N":$$INSURED^FBPCR4(DFN,FBPCR),1:0) Q:'FBCATC&'FBINS
"RTN","FBPCR2",24,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPCR2",25,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPCR2",26,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBPCR2",27,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPCR2",28,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR2",29,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPCR2",30,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPCR2",31,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPCR2",32,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPCR2",33,0)
 S FBCSID=$P(FBY,U,16) ;patient account number
"RTN","FBPCR2",34,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPCR2",35,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPCR2",36,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPCR2",37,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPCR2",38,0)
 ;output format
"RTN","FBPCR2",39,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),A3=$J(A3,6,2),FBIN=$J(FBIN,7)
"RTN","FBPCR2",40,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPCR2",41,0)
 Q
"RTN","FBPCR2",42,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR2",43,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR2",44,0)
 I $P(Y,U,9)'=FBPI Q
"RTN","FBPCR2",45,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR2",46,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR2",47,0)
 Q
"RTN","FBPCR2",48,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=".00"
"RTN","FBPCR2",49,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)) S FBTA=$O(^FBAAC(J,3,"AB",D,0)),A3=$S($P(^FBAAC(J,3,FBTA,0),"^",3)]"":$P(^(0),"^",3),1:.0001)
"RTN","FBPCR2",50,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPCR2",51,0)
 Q
"RTN","FBPCR2",52,0)
EN1 ;entry point to set variables, called by fbpcr67, anc
"RTN","FBPCR2",53,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPCR2",54,0)
 D SETTR,SET
"RTN","FBPCR2",55,0)
 Q
"RTN","FBPCR2",56,0)
PRINT ;write output
"RTN","FBPCR2",57,0)
 D HDR1 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR2",58,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S M=0 F  S M=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M)) Q:'M  D  Q:FBOUT
"RTN","FBPCR2",59,0)
 ..I ($Y+4)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR2",60,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M),FBCATC=$P(FBDATA,U,13),FBINS=$P(FBDATA,U,14)
"RTN","FBPCR2",61,0)
 ..S FBADJ=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBADJ"))
"RTN","FBPCR2",62,0)
 ..;S FBLOC=1_U_12_U_23_U_33_U_47_U_57_U_63_U_71
"RTN","FBPCR2",63,0)
 ..W !
"RTN","FBPCR2",64,0)
 ..;S I=1 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",65,0)
 ..W ?1,$P(FBDATA,U,1)
"RTN","FBPCR2",66,0)
 ..;S I=2 W ?$P(FBLOC,U,I),$P($P(FBDATA,U,I),",")
"RTN","FBPCR2",67,0)
 ..W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR2",68,0)
 ..;F I=3:1:8 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",69,0)
 ..W ?31,$J($P(FBADJ,U,14),10)
"RTN","FBPCR2",70,0)
 ..W ?43,$P(FBDATA,U,6)
"RTN","FBPCR2",71,0)
 ..W ?54,$P(FBDATA,U,7)
"RTN","FBPCR2",72,0)
 ..W ?64,$P(FBDATA,U,8)
"RTN","FBPCR2",73,0)
 ..I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR2",74,0)
 ...N FBI,FBMOD
"RTN","FBPCR2",75,0)
 ...F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR2",76,0)
 ....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPCR2",77,0)
 ....W !,?16,"-",FBMOD
"RTN","FBPCR2",78,0)
 ..W !,$P(FBDATA,U,3)
"RTN","FBPCR2",79,0)
 ..W ?13,$P(FBDATA,U,4)
"RTN","FBPCR2",80,0)
 ..W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR2",81,0)
 ..W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR2",82,0)
 ..W ?48,$P(FBADJ,U,5)
"RTN","FBPCR2",83,0)
 ..W ?60,$P(FBADJ,U,6)
"RTN","FBPCR2",84,0)
 ..S FBPDX=$P(FBDATA,U,10),FBPDXC=$$ICD9^FBCSV1(FBPDX,$$DT2FMDT^FBCSV1($P(FBDATA,U))),$P(FBDATA,U,10)=$E($$ICD9P^FBCSV1(FBPDX,3,$$DT2FMDT^FBCSV1($P(FBDATA,U))),1,19),FBPDXC=$S(FBPDXC="":"",1:" ("_FBPDXC_")")
"RTN","FBPCR2",85,0)
 ..W !?3,"Primary Dx: ",$P(FBDATA,U,10),FBPDXC,?45,"S/C Condition? ",$P(FBDATA,U,9) W ?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPCR2",86,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR2",87,0)
 ...W !?5,">>>"
"RTN","FBPCR2",88,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR2",89,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",90,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",91,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR2",92,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR2",93,0)
 ..S A3=".00"
"RTN","FBPCR2",94,0)
 Q
"RTN","FBPCR2",95,0)
HDR ;main header
"RTN","FBPCR2",96,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR2",97,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR2",98,0)
 ;W !!,?2,"Svc Date",?11,"CPT-MOD",?23,"Amount",?33," Amount",?42,"Susp",?49,"Travel",?57,"Batch",?63,"Invoice",?71,"Voucher"
"RTN","FBPCR2",99,0)
 ;W !,?23,"Claimed",?35,"Paid",?42,"Code",?50,"Paid",?58,"Num",?64,"Num",?72,"Date",!,FBDASH
"RTN","FBPCR2",100,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR2",101,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR2",102,0)
 Q
"RTN","FBPCR2",103,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR2",104,0)
 I ($Y+6)>IOSL D HDR Q:FBOUT
"RTN","FBPCR2",105,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPCR2",106,0)
 Q
"RTN","FBPCR2",107,0)
CR ;read for display
"RTN","FBPCR2",108,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR2",109,0)
 Q
"RTN","FBPCR2",110,0)
PAGE ;new page
"RTN","FBPCR2",111,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR2",112,0)
 Q
"RTN","FBPCR3")
0^13^B24418678
"RTN","FBPCR3",1,0)
FBPCR3 ;AISC/GRR,TET-PHARMACY POTENTIAL COST RECOVERY, SORT/PRINT ;2/4/93  09:59
"RTN","FBPCR3",2,0)
 ;;3.5;FEE BASIS;**48,69**;JAN 30, 1995
"RTN","FBPCR3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR3",4,0)
EN ;entry point
"RTN","FBPCR3",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",6,0)
SORT ;sort by date certified for payment, patient, invoice number ien, rx ien
"RTN","FBPCR3",7,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAA(162.1,"AA",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAA(162.1,"AA",I,J)) Q:'J  D
"RTN","FBPCR3",8,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR3",9,0)
 .S K=0 F  S K=$O(^FBAA(162.1,"AA",I,J,K)) Q:K'>0  S L=0 F  S L=$O(^FBAA(162.1,"AA",I,J,K,L)) Q:L'>0  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",10,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR3",11,0)
KILL ;kill variables set in sort
"RTN","FBPCR3",12,0)
 K A1,A2,DFN,FBAAA,FBAC,FBAP,FBBATCH,FBCATC,FBDA1,FBDRUG,FBFD,FBFD1,FBIN,FBINS,FBINVN,FBLOC,FBPAT,FBPD,FBPSF,FBPV,FBQTY,FBREIM,FBRX,FBSC,FBSTR,FBSUSP,FBVEN,FBVI,I,J,K,L,N,V,Y
"RTN","FBPCR3",13,0)
 K FBVNAME,FBVID,FBVCHAIN,FBPNAME,FBPID,FBDOB
"RTN","FBPCR3",14,0)
 K FBADJLA,FBADJLR,TAMT,FBRRMKL
"RTN","FBPCR3",15,0)
 D KILL^FBPCR2
"RTN","FBPCR3",16,0)
 Q
"RTN","FBPCR3",17,0)
SET ;set variables
"RTN","FBPCR3",18,0)
 N FBX
"RTN","FBPCR3",19,0)
 S Y(0)=$G(^FBAA(162.1,+K,"RX",+L,0)) I Y(0)']""!($P(Y(0),U,9)=1) Q
"RTN","FBPCR3",20,0)
 I $G(^FBAA(162.1,+K,"RX",+L,"FBREJ"))]"" Q
"RTN","FBPCR3",21,0)
 S Y(2)=$G(^FBAA(162.1,+K,0))
"RTN","FBPCR3",22,0)
 S Y(1)=$G(^FBAA(162.1,+K,"RX",+L,2))
"RTN","FBPCR3",23,0)
 S FBX=$$ADJLRA^FBRXFA(+L_","_+K_",")
"RTN","FBPCR3",24,0)
 S FBADJLR=$P(FBX,U) ;adjustment code
"RTN","FBPCR3",25,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR3",26,0)
 S TAMT=$FN($P(Y(0),"^",7),"",2) ;suspend amount
"RTN","FBPCR3",27,0)
 S FBRRMKL=$$RRL^FBRXFR(+L_","_+K_",") ;remitt remarks
"RTN","FBPCR3",28,0)
 S FBPSF=+$P(Y(1),U,5),FBFD=$P(Y(0),U,3),FBAAA=$P(Y(0),U,5)
"RTN","FBPCR3",29,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))  S FBCATC=$$CATC^FBPCR(DFN,FBFD)
"RTN","FBPCR3",30,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBAAA,+$O(^FBAAA("AIC",FBAAA,-FBFD)),0))="Y":1,1:0)
"RTN","FBPCR3",31,0)
 S FBINS=$S($$INSCK(FBFD,FBAAA,FBPI)=1:$$INSURED^FBPCR4(DFN,FBFD),1:0)
"RTN","FBPCR3",32,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR3",33,0)
 S FBINVN=$P(Y(2),U) D VEN
"RTN","FBPCR3",34,0)
 S FBRX=$P(Y(0),U,1),FBDRUG=$P(Y(0),U,2),FBAC=$P(Y(0),U,4),FBAP=$P(Y(0),U,16),FBSUSP=$P(Y(0),U,8),FBPD=$P(Y(0),U,19),FBBATCH=$P(Y(0),U,17),FBBATCH=$P($G(^FBAA(161.7,+FBBATCH,0)),U)
"RTN","FBPCR3",35,0)
 I FBSUSP]"" S FBSUSP=$P($G(^FBAA(161.27,+FBSUSP,0)),U)
"RTN","FBPCR3",36,0)
 S FBREIM=$S($P(Y(0),U,20)="R":"*",1:""),FBSTR=$P(Y(0),U,12),FBQTY=$P(Y(0),U,13),A1=$J(FBAC,6,2),A2=$J(FBAP,6,2),FBPV=""
"RTN","FBPCR3",37,0)
 S FBPD=$$DATX^FBAAUTL(FBPD),FBFD=$$DATX^FBAAUTL(FBFD)
"RTN","FBPCR3",38,0)
 S FBPV=$S($P(Y(1),U,3)="V":"#",1:""),FBFD1=$S(FBPV="":" ",1:FBPV)_$S(FBREIM="":" ",1:FBREIM)_FBFD,FBRX="Rx: "_FBRX
"RTN","FBPCR3",39,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR3",40,0)
 Q
"RTN","FBPCR3",41,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR3",42,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR3",43,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L)=FBFD1_U_FBRX_U_FBDRUG_U_FBSTR_U_FBQTY_U_A1_U_A2_U_FBSUSP_U_FBINVN_U_FBBATCH_U_FBPD_U_FBDOB_U_FBVCHAIN_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR3",44,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L,"FBADJ")=FBADJLR_U_FBADJLA_U_FBRRMKL_U_TAMT
"RTN","FBPCR3",45,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN)=FBVCHAIN,^TMP($J,"FB",FBPSF,FBPAT)=FBDOB
"RTN","FBPCR3",46,0)
 ;S FBIN(5)=$P(Y(1),U,6) I FBIN(5)]"",$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,L)) D ANC^FBPCR67
"RTN","FBPCR3",47,0)
 Q
"RTN","FBPCR3",48,0)
VEN ;set variables for vendor
"RTN","FBPCR3",49,0)
 S V=$G(^FBAAV(+$P(Y(2),U,4),0)),FBVNAME=$E($P(V,U),1,23),FBVID=$P(V,U,2),FBVCHAIN=$P(V,U,10)
"RTN","FBPCR3",50,0)
 Q
"RTN","FBPCR3",51,0)
PRINT ;write output
"RTN","FBPCR3",52,0)
 I FBPG>1&(($Y+10)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR3",53,0)
 E  D HDR1
"RTN","FBPCR3",54,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR3",55,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S L=0 F  S L=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L)) Q:'L  D  Q:FBOUT
"RTN","FBPCR3",56,0)
 ..I ($Y+6)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR3",57,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L),FBCATC=$P(FBDATA,U,15),FBINS=$P(FBDATA,U,16)
"RTN","FBPCR3",58,0)
 ..S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L,"FBADJ")
"RTN","FBPCR3",59,0)
 ..W !,$P(FBDATA,U),?64,$P(FBDATA,U,11),!
"RTN","FBPCR3",60,0)
 ..W ?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?45,$P(FBDATA,U,4),?63,$P(FBDATA,U,5)
"RTN","FBPCR3",61,0)
 ..W !?4,$P(FBDATA,U,6),?12,$P(FBDATA,U,7)
"RTN","FBPCR3",62,0)
 ..W ?20 I $P(FBADJ,U,1)]"" W $P(FBADJ,U,1),?30,$J($P(FBADJ,U,2),14)
"RTN","FBPCR3",63,0)
 ..;If no adjustment code then print suspend cpde amd amount
"RTN","FBPCR3",64,0)
 ..I $P(FBADJ,U,1)="" W $P(FBDATA,U,8),?30,$J($P(FBADJ,U,4),14)
"RTN","FBPCR3",65,0)
 ..W ?47,$P(FBDATA,U,9),?58,$P(FBDATA,U,10),?66,$P(FBADJ,U,3)
"RTN","FBPCR3",66,0)
 ..I FBCATC!FBINS W !?5,">>> Cost recover from "_$S(FBCATC:"means testing",FBINS:"insurance",1:"") W:FBCATC&FBINS " and insurance" W "."
"RTN","FBPCR3",67,0)
 ..W !
"RTN","FBPCR3",68,0)
EXIT ;kill and quit
"RTN","FBPCR3",69,0)
 Q
"RTN","FBPCR3",70,0)
HDR ;main header
"RTN","FBPCR3",71,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR3",72,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR3",73,0)
 W !?4,"Fill Date",?64,"Date Certified"
"RTN","FBPCR3",74,0)
 W !,?15,"Drug Name",?44,"Strength",?60,"Quantity"
"RTN","FBPCR3",75,0)
 W !?2,"Claimed",?12,"Paid",?20,"Adj Code",?33,"Adj Amounts",?47,"Invoice #",?58,"Batch #",?66,"Remit Remarks",!,FBDASH
"RTN","FBPCR3",76,0)
 Q
"RTN","FBPCR3",77,0)
SH ;subheader - vendor, prints when name changes
"RTN","FBPCR3",78,0)
 I ($Y+4)>IOSL D HDR Q:FBOUT
"RTN","FBPCR3",79,0)
 W !!,"Vendor:",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2),?65,"Chain #: ",$P($G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)),U)
"RTN","FBPCR3",80,0)
 Q
"RTN","FBPCR3",81,0)
CR ;read for display
"RTN","FBPCR3",82,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR3",83,0)
 Q
"RTN","FBPCR3",84,0)
PAGE ;new page
"RTN","FBPCR3",85,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR3",86,0)
 Q
"RTN","FBPCR3",87,0)
INSCK(FBDT,FBDA1,FBPI) ;possible cost recovery fcn call
"RTN","FBPCR3",88,0)
 ;Passed variables:  fbdt=fill date or treatment from date
"RTN","FBPCR3",89,0)
 ;                   fbda1=ien if fee patient file, patient ien
"RTN","FBPCR3",90,0)
 ;                    fbpi=fee program
"RTN","FBPCR3",91,0)
 ;Output variables:   fbins=1 if possible recovery, 0 if no
"RTN","FBPCR3",92,0)
 S FBINS=0,FBDT=FBDT+.1,FBDT=+$O(^FBAAA("AIC",FBDA1,-FBDT))
"RTN","FBPCR3",93,0)
 I FBDT S FBINS=$O(^FBAAA("AIC",FBDA1,FBDT,0)) I FBINS="Y" D
"RTN","FBPCR3",94,0)
 .N FBDA S FBDA=+$O(^FBAAA("AIC",FBDA1,FBDT,FBINS,0))
"RTN","FBPCR3",95,0)
 .I $P($G(^FBAAA(FBDA1,1,FBDA,0)),U,3)'=FBPI S FBINS=0
"RTN","FBPCR3",96,0)
 Q $S(FBINS="Y":1,1:0)
"RTN","FBPCR67")
0^14^B21293709
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ;5/12/1999
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69**;JAN 30, 1995
"RTN","FBPCR67",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR67",4,0)
EN ;entry point for sort
"RTN","FBPCR67",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",6,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",7,0)
 N FBY2,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",8,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",9,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",10,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",11,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y
"RTN","FBPCR67",13,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",14,0)
 K FBY2,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",15,0)
 D KILL^FBPCR2
"RTN","FBPCR67",16,0)
 Q
"RTN","FBPCR67",17,0)
SET ;set variables
"RTN","FBPCR67",18,0)
 ;I $G(FBPROG)]"",'FBPROG,'$D(FBPROG(+$P(FBIN,U,12))) Q
"RTN","FBPCR67",19,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBPCR67",20,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",21,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",22,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",23,0)
 D
"RTN","FBPCR67",24,0)
 . N FBCATC2
"RTN","FBPCR67",25,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",26,0)
 . Q:FBCATC=2
"RTN","FBPCR67",27,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",28,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",29,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",30,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",31,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",32,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",33,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",34,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",35,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",36,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",37,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",38,0)
 Q
"RTN","FBPCR67",39,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",40,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",41,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",42,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",43,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",44,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",45,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",46,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",47,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",48,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL
"RTN","FBPCR67",49,0)
 S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",50,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",51,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:5 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",52,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",53,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",54,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",55,0)
 D ANC
"RTN","FBPCR67",56,0)
 Q
"RTN","FBPCR67",57,0)
ANC ;ancillary payments
"RTN","FBPCR67",58,0)
 N J,K,L,M,Y,FBDT1,FBVID I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",59,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",60,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",61,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",62,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",63,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",64,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",65,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",66,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",67,0)
 Q
"RTN","FBPCR671")
0^15^B24391290
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;5/12/1999
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69**;JAN 30, 1995
"RTN","FBPCR671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR671",4,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",5,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",6,0)
 E  D HDR1
"RTN","FBPCR671",7,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",8,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",9,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",10,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)
"RTN","FBPCR671",11,0)
 ..S FBINV=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV")
"RTN","FBPCR671",12,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",13,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",14,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",15,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",16,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",17,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",18,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",19,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",20,0)
 ..F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",21,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",22,0)
 ...W !?5,">>>"
"RTN","FBPCR671",23,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",24,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",25,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",26,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",27,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",28,0)
 ..;
"RTN","FBPCR671",29,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",30,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",31,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D WRT Q:FBOUT
"RTN","FBPCR671",32,0)
 Q
"RTN","FBPCR671",33,0)
WRT ;write ancillary info
"RTN","FBPCR671",34,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",35,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",36,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",37,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",38,0)
 W !
"RTN","FBPCR671",39,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",40,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",41,0)
 W ?31,$J($P(FBADJ,U,14),10)
"RTN","FBPCR671",42,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",43,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",44,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",45,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",46,0)
 . N FBI,FBMOD
"RTN","FBPCR671",47,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",48,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",49,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",50,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",51,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",52,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",53,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",54,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",55,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",56,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",57,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",58,0)
 .W !?5,">>>"
"RTN","FBPCR671",59,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",60,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",61,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",62,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",63,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",64,0)
 ;
"RTN","FBPCR671",65,0)
 Q
"RTN","FBPCR671",66,0)
HDR ;main header
"RTN","FBPCR671",67,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",68,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR671",69,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",70,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",71,0)
 Q
"RTN","FBPCR671",72,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",73,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",74,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPCR671",75,0)
 Q
"RTN","FBPCR671",76,0)
SHA ;ancillary subheader
"RTN","FBPCR671",77,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",78,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",79,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",80,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",81,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",82,0)
 Q
"RTN","FBPCR671",83,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",84,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",85,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",86,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID: ",$P(FBV,";",2)
"RTN","FBPCR671",87,0)
 Q
"RTN","FBPCR671",88,0)
CR ;read for display
"RTN","FBPCR671",89,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",90,0)
 Q
"RTN","FBPCR671",91,0)
PAGE ;new page
"RTN","FBPCR671",92,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",93,0)
 Q
"RTN","FBPCR671",94,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPCR671",95,0)
 Q
"RTN","FBPCR671",96,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPCR671",97,0)
 Q
"RTN","FBPCR671",98,0)
WRTSC ;write service connected
"RTN","FBPCR671",99,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",100,0)
 Q
"RTN","FBPHON")
0^22^B19592256
"RTN","FBPHON",1,0)
FBPHON ;AISC/CMR-LIST PAYMENTS ;5/13/1999
"RTN","FBPHON",2,0)
 ;;3.5;FEE BASIS;**4,69**;JAN 30, 1995
"RTN","FBPHON",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPHON",4,0)
 S DIR(0)="P^161.2:EMZ" D ^DIR K DIR Q:$D(DIRUT)  S FBV=+Y
"RTN","FBPHON",5,0)
 S DIR(0)="P^161:EMZ",DIR("A")="Payments for veteran" D ^DIR K DIR I $D(DIRUT) G FBPHON
"RTN","FBPHON",6,0)
 S DFN=+Y
"RTN","FBPHON",7,0)
 Q
"RTN","FBPHON",8,0)
START S U="^"
"RTN","FBPHON",9,0)
 K ^TMP($J,"FBPHON"),^TMP("FBPHON",$J),^TMP("FBPHIDX",$J)
"RTN","FBPHON",10,0)
 I '$G(DFN)!('$G(FBV)) S VALMQUIT="" Q
"RTN","FBPHON",11,0)
 D GATHER^FBPHON1(DFN,FBV)
"RTN","FBPHON",12,0)
 I '$D(^TMP($J,"FBPHON")),'$G(FBCP) W !!,*7,"There are no payments to this vendor for this patient." S DIR(0)="E" D ^DIR S VALMQUIT=1 G END ;FBCP set only if changing pt
"RTN","FBPHON",13,0)
OUTPUT ;
"RTN","FBPHON",14,0)
 S (FBLINE,FBENTRY)=0,FBAADT="" F  S FBAADT=$O(^TMP($J,"FBPHON",FBAADT)) Q:'FBAADT  S FBI=0 F  S FBI=$O(^TMP($J,"FBPHON",FBAADT,FBI)) Q:'FBI  S FBX=^(FBI) D
"RTN","FBPHON",15,0)
 .S FBBDT=$P($P(FBX,U,2),"-"),FBEDT=$P($P(FBX,U,2),"-",2)
"RTN","FBPHON",16,0)
 .S FB1=$P(FBX,U,9) D FBCKI^FBAACCB1(FB1):$P(FBX,U)["C",FBCKP^FBAACCB1(+FB1,$P(FB1,",",2)):$P(FBX,U)="PHAR",FBCKO^FBAACCB2(+FB1,$P(FB1,",",2),$P(FB1,",",3),$P(FB1,",",4)):$P(FBX,U)="OPT"
"RTN","FBPHON",17,0)
 .S FBLINE=FBLINE+1,FBENTRY=FBENTRY+1,FBFL=$P(FBX,U,10),FBFL=FBFL_$S($G(FBCAN)]"":"+",1:"")
"RTN","FBPHON",18,0)
 .S FBTEXT=$S($L(FBENTRY)=1:" "_FBENTRY,1:FBENTRY)_FBFL,FBTEXT=$$SETSTR^VALM1($$DATE(FBBDT)_$S($G(FBEDT):" - "_$$DATE(FBEDT),1:""),FBTEXT,6,19)
"RTN","FBPHON",19,0)
 .S FBTEXT=$$SETSTR^VALM1($S($P(FBX,U)="OPT":"CPT: ",$P(FBX,U)="PHAR":"RX # ",1:""),FBTEXT,25,5),FBTEXT=$$SETSTR^VALM1($P(FBX,U,3),FBTEXT,30,8)
"RTN","FBPHON",20,0)
 .I $P($P(FBX,U,3),",",2)]"" S FBTEXT=$$SETSTR^VALM1("&",FBTEXT,38,1)
"RTN","FBPHON",21,0)
 .S FBTEXT=$$SETSTR^VALM1($J($FN($P(FBX,U,4),",",2),10),FBTEXT,40,10),FBTEXT=$$SETSTR^VALM1($J($FN($P(FBX,U,5),",",2),10),FBTEXT,51,10),FBTEXT=$$SETSTR^VALM1($P(FBX,U,6),FBTEXT,62,6)
"RTN","FBPHON",22,0)
 .S FBTEXT=$$SETSTR^VALM1($J($P(FBX,U,7),7)_"  "_$S($G(^FBAA(161.7,+$P(FBX,U,8),0)):$J(+^(0),5),1:""),FBTEXT,66,15)
"RTN","FBPHON",23,0)
 .S ^TMP("FBPHON",$J,FBLINE,0)=FBTEXT K FBTEXT
"RTN","FBPHON",24,0)
 .D IDX S ^TMP("FBPHIDX",$J,FBENTRY)=FBX_"^"_$G(FBCK)
"RTN","FBPHON",25,0)
 .S A2=$P(FBX,U,5) D PMNT
"RTN","FBPHON",26,0)
 .K FBBDT,FBEDT,FB1,FBX,A2,^TMP($J,"FBPHON",FBAADT,FBI)
"RTN","FBPHON",27,0)
 S VALMCNT=FBLINE,VALMBG=1
"RTN","FBPHON",28,0)
END ;
"RTN","FBPHON",29,0)
 K FBAAOUT,FBX,FBBDT,FBEDT,FBI,FBAADT,FBFL,FBLINE,FBENTRY,^TMP($J,"FBPHON")
"RTN","FBPHON",30,0)
 Q
"RTN","FBPHON",31,0)
HDR S VALMHDR(1)="VENDOR: "_$$VNAME^FBNHEXP(FBV),VALMHDR(1)=$$SETSTR^VALM1("Patient Name: "_$$NAME^FBCHREQ2(DFN),VALMHDR(1),40,40)
"RTN","FBPHON",32,0)
 S VALMHDR(2)="    ID: "_$$VID^FBNHEXP(FBV),VALMHDR(2)=$$SETSTR^VALM1("SSN: "_$$SSN^FBAAUTL(DFN),VALMHDR(2),49,31)
"RTN","FBPHON",33,0)
 S VALMHDR(3)="'*' Reimb. to Patient  '+' Cancel Activity  '#' Voided Payment  '&' Addnl Codes"
"RTN","FBPHON",34,0)
 Q
"RTN","FBPHON",35,0)
DATE(J) ;external date format
"RTN","FBPHON",36,0)
 Q $S('$D(J):"",1:$E(J,4,5)_"/"_$E(J,6,7)_"/"_$E(J,2,3))
"RTN","FBPHON",37,0)
 ;
"RTN","FBPHON",38,0)
PMNT ;sets ^TMP with payment information if it exists
"RTN","FBPHON",39,0)
 I $G(FBCK)]"" S FBLINE=FBLINE+1,^TMP("FBPHON",$J,FBLINE,0)="      >>>Check # "_FBCK I $G(FBCKDT) S ^(0)=^(0)_"  Date Paid:  "_$$DATX^FBAAUTL(FBCKDT)_$S(FBCKINT>0:"  Interest: "_$FN(FBCKINT,",",2),1:"")_"<<<" D IDX D
"RTN","FBPHON",40,0)
 .I FBDIS-FBCKINT'=+A2 S FBLINE=FBLINE+1,^TMP("FBPHON",$J,FBLINE,0)="      >>>Amount paid altered to $ "_$FN((FBDIS-FBCKINT),",",2)_" on the Fee Payment Voucher document.<<<" D IDX
"RTN","FBPHON",41,0)
 I $G(FBCANDT)>0 S FBLINE=FBLINE+1,^TMP("FBPHON",$J,FBLINE,0)="      >>>Check cancelled on: "_$$DATX^FBAAUTL(FBCANDT)_"   Reason:  "_$P($G(^FB(162.95,+FBCANR,0)),"^")_"<<<" D IDX D
"RTN","FBPHON",42,0)
 .S FBLINE=FBLINE+1,^TMP("FBPHON",$J,FBLINE,0)=$$SETSTR^VALM1($S(FBCAN="R":"Check WILL be replaced.",FBCAN="C":"Check WILL be re-issued.",FBCAN="X":"Check WILL NOT be replaced.",1:""),"",10,70) D IDX
"RTN","FBPHON",43,0)
 K FBCAN,FBCK,FBCKDT,FBCANDT,FBCANR,FBCKINT,FBDIS,FBCKIN
"RTN","FBPHON",44,0)
 Q
"RTN","FBPHON",45,0)
IDX ;sets IDX node
"RTN","FBPHON",46,0)
 S ^TMP("FBPHON",$J,"IDX",FBLINE,FBENTRY)=""
"RTN","FBPHON",47,0)
 Q
"RTN","FBPHON",48,0)
EXIT ;
"RTN","FBPHON",49,0)
 K ^TMP("FBPHON",$J),^TMP("FBPHIDX",$J),VALMY,^TMP("VALMIDX",$J)
"RTN","FBPHON",50,0)
 Q
"RTN","FBPHON",51,0)
HLP ;help text
"RTN","FBPHON",52,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","FBPHON",53,0)
 Q
"RTN","FBPHON1")
0^23^B14820448
"RTN","FBPHON1",1,0)
FBPHON1 ;AISC/CMR-LIST PAYMENTS CONT. ;5/13/1999
"RTN","FBPHON1",2,0)
 ;;3.5;FEE BASIS;**4,69**;JAN 30, 1995
"RTN","FBPHON1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPHON1",4,0)
GATHER(DFN,FBV) ;gather vendor/veteran specific payment info
"RTN","FBPHON1",5,0)
 ;required input DFN = veteran ien
"RTN","FBPHON1",6,0)
 ;               FBV = vendor ien
"RTN","FBPHON1",7,0)
 ;output ^TMP($J,"FBPHON", containing pmnts for all programs
"RTN","FBPHON1",8,0)
 N FBCNT,FBI,FBJ,FBK,FBSDI,FBAADT,FBAACPI,FBX,FBMODLE,FBXAD,FBXADJC
"RTN","FBPHON1",9,0)
 Q:'$G(DFN)!('$G(FBV))
"RTN","FBPHON1",10,0)
 S FBCNT=0
"RTN","FBPHON1",11,0)
OPT ;gather opt payments
"RTN","FBPHON1",12,0)
 S FBSDI=0 F  S FBSDI=$O(^FBAAC(DFN,1,FBV,1,FBSDI)) Q:'FBSDI  S FBAADT=+^(FBSDI,0),FBAACPI=0 F  S FBAACPI=$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)) Q:'FBAACPI  D
"RTN","FBPHON1",13,0)
 .S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")","E")
"RTN","FBPHON1",14,0)
 .S FBX=^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0),FBFL=$S($P(FBX,U,20)="R":"*",1:""),FBFL=FBFL_$S($P(FBX,U,21)="VP":"#",1:""),FBCNT=FBCNT+1
"RTN","FBPHON1",15,0)
 .S FBXAD=$$ADJLRA^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",")
"RTN","FBPHON1",16,0)
 .S FBXADJC=$P(FBXAD,U,1) ;Adjustment code list
"RTN","FBPHON1",17,0)
 .I FBXADJC["," S FBXADJC=$P(FBXADJC,",",1)_"&" ;More than one adj code
"RTN","FBPHON1",18,0)
 .I FBXADJC="" S FBXADJC=$P(FBX,U,5) ;No adj codes use Suspense code
"RTN","FBPHON1",19,0)
 .S ^TMP($J,"FBPHON",-FBAADT,FBCNT)="OPT"_"^"_FBAADT_"^"_$$CPT^FBAAUTL4(+FBX)_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_"^"_$P(FBX,U,2)_"^"_$P(FBX,U,3)_"^"_FBXADJC_"^"_$P(FBX,U,16)_"^"_$P(FBX,U,8)_"^"_DFN_","_FBV_","_FBSDI_","_FBAACPI_"^"_FBFL
"RTN","FBPHON1",20,0)
 .K FBX,FBFL
"RTN","FBPHON1",21,0)
 K FBSDI,FBAACPI,FBAADT
"RTN","FBPHON1",22,0)
INP ;gather inpt payments
"RTN","FBPHON1",23,0)
 S FBI=0 F  S FBI=$O(^FBAAI("AK",DFN,FBV,FBI)) Q:'FBI  I $D(^FBAAI(FBI,0)) S FBX=^FBAAI(FBI,0),FBCNT=FBCNT+1,FBFL=$S($P(FBX,U,13)="R":"*",1:""),FBFL=FBFL_$S($P(FBX,U,14)="VP":"#",1:"") D
"RTN","FBPHON1",24,0)
 .S FBXAD=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPHON1",25,0)
 .S FBXADJC=$P(FBXAD,U)
"RTN","FBPHON1",26,0)
 .I FBXADJC["," S FBXADJC=$P(FBXADJC,",",1)_"&" ;More than one adj code
"RTN","FBPHON1",27,0)
 .I FBXADJC="" S FBXADJC=$P(FBX,U,11) ;No adj codes use Suspense code
"RTN","FBPHON1",28,0)
 .S ^TMP($J,"FBPHON",-$P(FBX,U,6),FBCNT)=$S($P(FBX,U,12)=6:"CH",$P(FBX,U,12)=7:"CNH",1:"")_"^"_$P(FBX,U,6)_"-"_$P(FBX,U,7)_"^^"_$P(FBX,U,8)_"^"_$P(FBX,U,9)_"^"_FBXADJC_"^"_+FBX_"^"_$P(FBX,U,17)_"^"_FBI_"^"_FBFL
"RTN","FBPHON1",29,0)
 .K FBX,FBFL
"RTN","FBPHON1",30,0)
 K FBI
"RTN","FBPHON1",31,0)
PHARM ;gather pharm payments
"RTN","FBPHON1",32,0)
 S FBAADT=0 F  S FBAADT=$O(^FBAA(162.1,"AD",DFN,FBAADT)) Q:'FBAADT  S FBI=0 F  S FBI=$O(^FBAA(162.1,"AD",DFN,FBAADT,FBI)) Q:'FBI  I $D(^FBAA(162.1,"AN",FBV,FBI)) D
"RTN","FBPHON1",33,0)
 .S FBJ=0 F  S FBJ=$O(^FBAA(162.1,"AD",DFN,FBAADT,FBI,FBJ)) Q:'FBJ  I $D(^FBAA(162.1,FBI,"RX",FBJ,0)) S FBX=^(0),FBFL=$S($P(FBX,U,20)="R":"*",1:""),FBFL=FBFL_$S($P($G(^FBAA(162.1,FBI,"RX",FBJ,2)),U,3)="VP":"#",1:"") D
"RTN","FBPHON1",34,0)
 ..S FBCNT=FBCNT+1
"RTN","FBPHON1",35,0)
 ..S FBXAD=$$ADJLRA^FBRXFA(FBJ_","_FBI_",")
"RTN","FBPHON1",36,0)
 ..S FBXADJC=$P(FBXAD,U,1) ;Adjustment code list
"RTN","FBPHON1",37,0)
 ..I FBXADJC["," S FBXADJC=$P(FBXADJC,",",1)_"&" ;More than one adj code
"RTN","FBPHON1",38,0)
 ..I FBXADJC="" S FBXADJC=$P(FBX,U,8)
"RTN","FBPHON1",39,0)
 ..S ^TMP($J,"FBPHON",-(9999999-FBAADT),FBCNT)="PHAR^"_(9999999-FBAADT)_"^"_$P(FBX,U)_"^"_$P(FBX,U,4)_"^"_$P(FBX,U,16)_"^"_FBXADJC_"^"_+$G(^FBAA(162.1,FBI,0))_"^"_$P(FBX,U,17)_"^"_FBI_","_FBJ_"^"_FBFL
"RTN","FBPHON1",40,0)
 .K FBX,FBFL
"RTN","FBPHON1",41,0)
 K FBAADT,FBI,FBJ
"RTN","FBPHON1",42,0)
 Q
"RTN","FBUCDE")
0^5^B15001343
"RTN","FBUCDE",1,0)
FBUCDE ;BOIFO/SGJ-UNAUTHORIZED EDI CLAIMS THAT WERE NOT APPROVED ;12/18/03
"RTN","FBUCDE",2,0)
 ;;3.5;FEE BASIS;**69**;JAN 30, 1995 
"RTN","FBUCDE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBUCDE",4,0)
 ;
"RTN","FBUCDE",5,0)
 N FBX
"RTN","FBUCDE",6,0)
 ; ask date range
"RTN","FBUCDE",7,0)
 S DIR(0)="D^::EX",DIR("A")="   Beginning Date"
"RTN","FBUCDE",8,0)
 ;   default from date is first day of current month
"RTN","FBUCDE",9,0)
 S DIR("B")=$$FMTE^XLFDT($E(DT,1,5)_"01")
"RTN","FBUCDE",10,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBUCDE",11,0)
 S FBBEG=Y
"RTN","FBUCDE",12,0)
 S DIR(0)="DA^"_FBBEG_"::EX",DIR("A")="   Ending Date: "
"RTN","FBUCDE",13,0)
 ;   default to date is last day of specified month
"RTN","FBUCDE",14,0)
 D NOW^%DTC S DIR("B")=$$FMTE^XLFDT(X)
"RTN","FBUCDE",15,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBUCDE",16,0)
 S FBEND=Y
"RTN","FBUCDE",17,0)
 ;
"RTN","FBUCDE",18,0)
 ; ask device
"RTN","FBUCDE",19,0)
 S %ZIS="QM" D ^%ZIS G:POP EXIT
"RTN","FBUCDE",20,0)
 I $D(IO("Q")) D  G EXIT
"RTN","FBUCDE",21,0)
 . S ZTRTN="QEN^FBUCDE",ZTDESC="UNAUTHORIZED EDI CLAIMS REPORT"
"RTN","FBUCDE",22,0)
 . F FBX="FBBEG","FBEND" S ZTSAVE(FBX)=""
"RTN","FBUCDE",23,0)
 . D ^%ZTLOAD,HOME^%ZIS K ZTSK
"RTN","FBUCDE",24,0)
 ;
"RTN","FBUCDE",25,0)
QEN ; queued entry
"RTN","FBUCDE",26,0)
 U IO
"RTN","FBUCDE",27,0)
 ;
"RTN","FBUCDE",28,0)
GATHER ; collect and sort data by date
"RTN","FBUCDE",29,0)
 N FBSET,FBFPPSC,FBC,FBPG,FBHDT,FBDA,FBDTR
"RTN","FBUCDE",30,0)
 S (FBQUIT,FBPG)=0
"RTN","FBUCDE",31,0)
 D NOW^%DTC S FBDTR=$$DATX^FBAAUTL(X)
"RTN","FBUCDE",32,0)
 K FBDL S FBDL="",$P(FBDL,"=",IOM)=""
"RTN","FBUCDE",33,0)
 ; build page header text for selection criteria
"RTN","FBUCDE",34,0)
 S FBHDT(1)="From Date: "_$$DATX^FBAAUTL(FBBEG)_"    To Date: "_$$DATX^FBAAUTL(FBEND)
"RTN","FBUCDE",35,0)
 ;
"RTN","FBUCDE",36,0)
 D HD
"RTN","FBUCDE",37,0)
 S FBBEG=FBBEG-.0000001
"RTN","FBUCDE",38,0)
 S FBEND=FBEND+.999999
"RTN","FBUCDE",39,0)
 K ^TMP("FBDE")
"RTN","FBUCDE",40,0)
 ;
"RTN","FBUCDE",41,0)
 ; Initialize Counter
"RTN","FBUCDE",42,0)
 S FBC=0
"RTN","FBUCDE",43,0)
 ;
"RTN","FBUCDE",44,0)
 S FBSET="  Reason for Disapproval: "
"RTN","FBUCDE",45,0)
 ;
"RTN","FBUCDE",46,0)
 S (FBFPPSC,FBDA)=""
"RTN","FBUCDE",47,0)
 F  S FBFPPSC=$O(^FB583("AFC",FBFPPSC)) Q:FBFPPSC=""  F  S FBDA=$O(^FB583("AFC",FBFPPSC,FBDA)) Q:FBDA=""  D ONE
"RTN","FBUCDE",48,0)
 D PRINT
"RTN","FBUCDE",49,0)
 ;
"RTN","FBUCDE",50,0)
 I FBC=0 W !!,"no entries found.",!
"RTN","FBUCDE",51,0)
 ;
"RTN","FBUCDE",52,0)
 I FBQUIT W !!,"REPORT STOPPED AT USER REQUEST",!
"RTN","FBUCDE",53,0)
 ;
"RTN","FBUCDE",54,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR
"RTN","FBUCDE",55,0)
 D ^%ZISC
"RTN","FBUCDE",56,0)
 G EXIT
"RTN","FBUCDE",57,0)
 Q
"RTN","FBUCDE",58,0)
 ;
"RTN","FBUCDE",59,0)
HD ; page header
"RTN","FBUCDE",60,0)
 N FBI
"RTN","FBUCDE",61,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1,FBQUIT=1 Q
"RTN","FBUCDE",62,0)
 I $E(IOST,1,2)="C-",FBPG S DIR(0)="E" D ^DIR K DIR I 'Y S FBQUIT=1 Q
"RTN","FBUCDE",63,0)
 I $E(IOST,1,2)="C-"!FBPG W @IOF
"RTN","FBUCDE",64,0)
 S FBPG=FBPG+1
"RTN","FBUCDE",65,0)
 W !,"UNAUTHORIZED EDI CLAIMS THAT WERE NOT APPROVED",?67,FBDTR
"RTN","FBUCDE",66,0)
 S FBI=0 F  S FBI=$O(FBHDT(FBI)) Q:'FBI  W !,FBHDT(FBI)
"RTN","FBUCDE",67,0)
 W ?68,"Page: ",FBPG
"RTN","FBUCDE",68,0)
 W !!,"Date of Disposition",?23,"Disposition",?42,"FPPS Claim ID",?62,"Fee Program"
"RTN","FBUCDE",69,0)
 W !?2,"Veteran",?38,"Vendor"
"RTN","FBUCDE",70,0)
 W !?2,"Treatment From",?31,"Treatment To",?58,"Amt Claimed"
"RTN","FBUCDE",71,0)
 W !,FBDL
"RTN","FBUCDE",72,0)
 Q
"RTN","FBUCDE",73,0)
 ;
"RTN","FBUCDE",74,0)
ONE N FBZ,FBDT
"RTN","FBUCDE",75,0)
 S FBZ=$G(^FB583(FBDA,0))
"RTN","FBUCDE",76,0)
 S FBDT=$P(FBZ,U,12)
"RTN","FBUCDE",77,0)
 ; skip if date of disposition not within specified period
"RTN","FBUCDE",78,0)
 Q:FBDT=""!(FBDT>FBEND)!(FBDT<FBBEG)
"RTN","FBUCDE",79,0)
 ; skip if disposition is not equal to disapproved,
"RTN","FBUCDE",80,0)
 ; cancelled/withdrawn or abandoned.
"RTN","FBUCDE",81,0)
 Q:"^1^4^"[(U_$P(FBZ,U,11)_U)
"RTN","FBUCDE",82,0)
 ; store the ien in list (sorted by date of disposition)
"RTN","FBUCDE",83,0)
 S ^TMP("FBDE",$J,FBDT,FBDA,FBFPPSC)=""
"RTN","FBUCDE",84,0)
 Q
"RTN","FBUCDE",85,0)
PRINT ; print claims 
"RTN","FBUCDE",86,0)
 N I,FBZ,FBAC
"RTN","FBUCDE",87,0)
 S FBDT="" F  S FBDT=$O(^TMP("FBDE",$J,FBDT)) Q:FBDT=""  D  Q:FBQUIT
"RTN","FBUCDE",88,0)
 . S FBDA="" F  S FBDA=$O(^TMP("FBDE",$J,FBDT,FBDA)) Q:FBDA=""  D  Q:FBQUIT
"RTN","FBUCDE",89,0)
 . . S FBC=FBC+1,I=""
"RTN","FBUCDE",90,0)
 . . S FBZ=$G(^FB583(FBDA,0))
"RTN","FBUCDE",91,0)
 . . S FBAC=$P(FBZ,U,9)+.0001,FBAC=$P(FBAC,".",1)_"."_$E($P(FBAC,".",2),1,2)
"RTN","FBUCDE",92,0)
 . . I $Y+9>IOSL D HD Q:FBQUIT
"RTN","FBUCDE",93,0)
 . . W !!,$$DATX^FBAAUTL($E(FBDT,1,7)),?21,$E($P($$PTR^FBUCUTL("^FB(162.91,",$P(FBZ,U,11)),U),1,30),?44,$O(^TMP("FBDE",$J,FBDT,FBDA,0)),?62,$$PROG^FBUCUTL($P(FBZ,U,2))
"RTN","FBUCDE",94,0)
 . . W !?2,$E($$VET^FBUCUTL($P(FBZ,U,4)),1,30),?35,$E($$VEN^FBUCUTL($P(FBZ,U,3)),1,30)
"RTN","FBUCDE",95,0)
 . . W !?2,$$DATX^FBAAUTL($E($P(FBZ,U,5),1,7)),?32,$$DATX^FBAAUTL($E($P(FBZ,U,6),1,7)),?58,$J(FBAC,6)
"RTN","FBUCDE",96,0)
 . . F  S I=$O(^FB583(FBDA,"D","B",I)) Q:I=""  W !,FBSET_$P(^FB(162.94,I,0),U)
"RTN","FBUCDE",97,0)
 Q
"RTN","FBUCDE",98,0)
EXIT ; kill variables, tmp global and quit
"RTN","FBUCDE",99,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","FBUCDE",100,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,POP,X,Y
"RTN","FBUCDE",101,0)
 K ^TMP("FBDE"),FBBEG,FBEND,FBQUIT,FBDL
"RTN","FBUCDE",102,0)
 Q
"RTN","FBUCDE",103,0)
 ;FBUCDE
"RTN","FBUCLET2")
0^9^B58951975
"RTN","FBUCLET2",1,0)
FBUCLET2 ;WOIFO/SAB - UNAUTHORIZED CLAIM LETTER (continued) ;08/15/02
"RTN","FBUCLET2",2,0)
 ;;3.5;FEE BASIS;**38,46,69**;JAN 30, 1995
"RTN","FBUCLET2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBUCLET2",4,0)
 Q
"RTN","FBUCLET2",5,0)
AUTHPR ;print authorized dates and approved amounts on disposition letter
"RTN","FBUCLET2",6,0)
 ;INPUT:  FBDA = ien of unauthorized claim, file 162.7
"RTN","FBUCLET2",7,0)
 ;        FBORDER = (optional) order number of status
"RTN","FBUCLET2",8,0)
 ;        FBUCA = current (after) zero node of unauthorized claim (162.7)
"RTN","FBUCLET2",9,0)
 ;        FBUC = unauthorized claim node in parameter file
"RTN","FBUCLET2",10,0)
 ;        FBCC = flag, true if CC address should print at bottom of page
"RTN","FBUCLET2",11,0)
 ;        FBCCI = # used to determine where CC address prints
"RTN","FBUCLET2",12,0)
 ;OUTPUT: FBTAMT = total amount approved
"RTN","FBUCLET2",13,0)
 ;        FBCC value may be changed
"RTN","FBUCLET2",14,0)
 N DA,FBAMT,FBCPT,FBDOS,FBFILE,FBIENS,FBMOD,FBMODLE,FBSC,FBSCA
"RTN","FBUCLET2",15,0)
 N FBSCCOL,FBUCPAY,FBX,FBY,FBACRR,FBADJLR,FBFPPSC,FBSCID,FBFPPSL,FBJ
"RTN","FBUCLET2",16,0)
 ;
"RTN","FBUCLET2",17,0)
 ; get list of payments for the claim
"RTN","FBUCLET2",18,0)
 S FBX=$$PAYST^FBUCUTL(FBDA,"FBUCPAY")
"RTN","FBUCLET2",19,0)
 ; get fpps claim id
"RTN","FBUCLET2",20,0)
 S FBFPPSC=$P($G(^FB583(FBDA,5)),U)
"RTN","FBUCLET2",21,0)
 S FBSCID=""
"RTN","FBUCLET2",22,0)
 ;
"RTN","FBUCLET2",23,0)
 ; loop thru payments to get total amount approved and suspend code list
"RTN","FBUCLET2",24,0)
 S FBTAMT=0
"RTN","FBUCLET2",25,0)
 F FBFILE=162.03,162.11,162.5 D
"RTN","FBUCLET2",26,0)
 . S FBIENS="" F  S FBIENS=$O(FBUCPAY(FBDA,FBFILE,FBIENS)) Q:FBIENS=""  D
"RTN","FBUCLET2",27,0)
 . . I FBFILE=162.03 D
"RTN","FBUCLET2",28,0)
 . . . S FBAMT=$$GET1^DIQ(FBFILE,FBIENS,2)
"RTN","FBUCLET2",29,0)
 . . . Q:FBSCID]""
"RTN","FBUCLET2",30,0)
 . . . S FBSCID=$$GET1^DIQ(FBFILE,FBIENS,49)
"RTN","FBUCLET2",31,0)
 . . I FBFILE=162.11 D
"RTN","FBUCLET2",32,0)
 . . . S FBAMT=$$GET1^DIQ(FBFILE,FBIENS,6.5)
"RTN","FBUCLET2",33,0)
 . . I FBFILE=162.5 D
"RTN","FBUCLET2",34,0)
 . . . S FBAMT=$$GET1^DIQ(FBFILE,FBIENS,8)
"RTN","FBUCLET2",35,0)
 . . . Q:FBSCID]""
"RTN","FBUCLET2",36,0)
 . . . S FBSCID=$$GET1^DIQ(FBFILE,FBIENS,55)  ; patient control number
"RTN","FBUCLET2",37,0)
 . . S FBTAMT=FBTAMT+FBAMT
"RTN","FBUCLET2",38,0)
 ;
"RTN","FBUCLET2",39,0)
 ; print authorized dates and total amount
"RTN","FBUCLET2",40,0)
 I $Y+$S(FBCC:FBCCI,1:8)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",41,0)
 W !?8,"Authorized from: ",$$FMTE^XLFDT($P(FBUCA,U,13))
"RTN","FBUCLET2",42,0)
 W "  Authorized to: ",$$FMTE^XLFDT($P(FBUCA,U,14))
"RTN","FBUCLET2",43,0)
 W !?8,"Amount approved:  " W:FBTAMT "$",$FN(FBTAMT,",",2)
"RTN","FBUCLET2",44,0)
 W "  Itemized list follows:"
"RTN","FBUCLET2",45,0)
 ;
"RTN","FBUCLET2",46,0)
 ; print header and detail lines for civil hospital payments
"RTN","FBUCLET2",47,0)
 I $D(FBUCPAY(FBDA,162.5)) D
"RTN","FBUCLET2",48,0)
 . I $Y+$S(FBCC:FBCCI,1:7)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",49,0)
 . W !!?8,"Patient Control Number: ",FBSCID
"RTN","FBUCLET2",50,0)
 . I $Y+$S(FBCC:FBCCI,1:11)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",51,0)
 . D CHDHD
"RTN","FBUCLET2",52,0)
 . S FBIENS=""
"RTN","FBUCLET2",53,0)
 . F  S FBIENS=$O(FBUCPAY(FBDA,162.5,FBIENS)) Q:FBIENS=""  D CHD
"RTN","FBUCLET2",54,0)
 ;
"RTN","FBUCLET2",55,0)
 ; print header and detail lines for outpatient/ancillary payments
"RTN","FBUCLET2",56,0)
 I $D(FBUCPAY(FBDA,162.03)) D
"RTN","FBUCLET2",57,0)
 . I $Y+$S(FBCC:FBCCI,1:7)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",58,0)
 . W !!?8,"Patient Account Number: ",FBSCID
"RTN","FBUCLET2",59,0)
 . I $Y+$S(FBCC:FBCCI,1:11)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",60,0)
 . D ODHD
"RTN","FBUCLET2",61,0)
 . S FBIENS=""
"RTN","FBUCLET2",62,0)
 . F  S FBIENS=$O(FBUCPAY(FBDA,162.03,FBIENS)) Q:FBIENS=""  D OD
"RTN","FBUCLET2",63,0)
 ;
"RTN","FBUCLET2",64,0)
 ; print header and detail lines for pharmacy payments
"RTN","FBUCLET2",65,0)
 I $D(FBUCPAY(FBDA,162.11)) D
"RTN","FBUCLET2",66,0)
 . I $Y+$S(FBCC:FBCCI,1:11)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",67,0)
 . D PDHD
"RTN","FBUCLET2",68,0)
 . S FBIENS=""
"RTN","FBUCLET2",69,0)
 . F  S FBIENS=$O(FBUCPAY(FBDA,162.11,FBIENS)) Q:FBIENS=""  D PD
"RTN","FBUCLET2",70,0)
 ;
"RTN","FBUCLET2",71,0)
 ;set FBSCCOL flag to indicate if the suspend code column should be used
"RTN","FBUCLET2",72,0)
 ;    = 1 or 0 (1 if there are any suspend codes beside "4 Other")
"RTN","FBUCLET2",73,0)
 S FBSCCOL=0
"RTN","FBUCLET2",74,0)
 S FBSC="" F  S FBSC=$O(FBSCA(FBSC)) Q:FBSC=""  I FBSC'=4 S FBSCCOL=1 Q
"RTN","FBUCLET2",75,0)
 ;
"RTN","FBUCLET2",76,0)
 ; print relevant suspend code descriptions 
"RTN","FBUCLET2",77,0)
 I FBSCCOL D
"RTN","FBUCLET2",78,0)
 . N FBGL,FBLBL
"RTN","FBUCLET2",79,0)
 . I $Y+$S(FBCC:FBCCI,1:10)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",80,0)
 . W !!?8,"*Reason(s) for Suspension"
"RTN","FBUCLET2",81,0)
 . S FBSC="" F  S FBSC=$O(FBSCA(FBSC)) Q:FBSC=""  D
"RTN","FBUCLET2",82,0)
 . . I FBSC="4" D  Q
"RTN","FBUCLET2",83,0)
 . . . W !?8,"(4) Other. Specific reason immediately follows item."
"RTN","FBUCLET2",84,0)
 . . ; print description of suspend code from file when not "Other"
"RTN","FBUCLET2",85,0)
 . . S FBGL="^FBAA(161.27,"
"RTN","FBUCLET2",86,0)
 . . S FBLBL="("_FBSC_") "
"RTN","FBUCLET2",87,0)
 . . S DA=$O(^FBAA(161.27,"B",FBSC,0))
"RTN","FBUCLET2",88,0)
 . . I $Y+$S(FBCC:FBCCI,1:9)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",89,0)
 . . D TXT^FBUCUTL2(FBGL,DA,1,"WC69I8",1,1,.FBCC,FBCCI,FBLBL)
"RTN","FBUCLET2",90,0)
 ;
"RTN","FBUCLET2",91,0)
 W !
"RTN","FBUCLET2",92,0)
 D ACT:$D(FBACRR) K FBACRR
"RTN","FBUCLET2",93,0)
 Q
"RTN","FBUCLET2",94,0)
 ;
"RTN","FBUCLET2",95,0)
ACT ; print table of adjustment reason descriptions
"RTN","FBUCLET2",96,0)
 ; Input
"RTN","FBUCLET2",97,0)
 ;    FBACRR( - required, array
"RTN","FBUCLET2",98,0)
 ;    FBACRR(FBADJRE)=""
"RTN","FBUCLET2",99,0)
 ;    where FBADJRE = adjustment reason code, external value
"RTN","FBUCLET2",100,0)
 N FBADJRE,FBI,X,FBACT
"RTN","FBUCLET2",101,0)
 I $Y+$S(FBCC:FBCCI,1:10)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",102,0)
 W !,?8,"*Adjustment Code Text:"
"RTN","FBUCLET2",103,0)
 S FBADJRE="" F  S FBADJRE=$O(FBACRR(FBADJRE)) Q:FBADJRE=""  D
"RTN","FBUCLET2",104,0)
 . ; get description of code in FBACT
"RTN","FBUCLET2",105,0)
 . I $$AR^FBUTL1(,FBADJRE,,"FBACT")<0 Q  ; quit if error
"RTN","FBUCLET2",106,0)
 . ; print code and description
"RTN","FBUCLET2",107,0)
 . K ^UTILITY($J,"W")
"RTN","FBUCLET2",108,0)
 . S DIWL=1,DIWF="WC79I8"
"RTN","FBUCLET2",109,0)
 . ; include code in output
"RTN","FBUCLET2",110,0)
 . I $Y+$S(FBCC:FBCCI,1:9)>IOSL D PAGE^FBUCLET1
"RTN","FBUCLET2",111,0)
 . S X=$$LJ^XLFSTR("("_FBADJRE_")",6," ") D ^DIWP
"RTN","FBUCLET2",112,0)
 . S DIWF="WC79I14"
"RTN","FBUCLET2",113,0)
 . ; include description in output
"RTN","FBUCLET2",114,0)
 . S FBI=0 F  S FBI=$O(FBACT(FBI)) Q:FBI=""  S X=FBACT(FBI) I X]"" D ^DIWP
"RTN","FBUCLET2",115,0)
 . D ^DIWW
"RTN","FBUCLET2",116,0)
 Q
"RTN","FBUCLET2",117,0)
 ;
"RTN","FBUCLET2",118,0)
CHDHD ; civil hospital payment detail header
"RTN","FBUCLET2",119,0)
 W !!?8,"Admission Date",?24,"Discharge Date"
"RTN","FBUCLET2",120,0)
 W ?40,"Amt Claimed",?53,"Amt Approved"
"RTN","FBUCLET2",121,0)
 W ?67,"Adj Code*"
"RTN","FBUCLET2",122,0)
 W !?8,"--------------",?24,"--------------"
"RTN","FBUCLET2",123,0)
 W ?40,"-----------",?53,"------------"
"RTN","FBUCLET2",124,0)
 W ?67,"--------"
"RTN","FBUCLET2",125,0)
 Q
"RTN","FBUCLET2",126,0)
CHD ; civil hospital payment detail
"RTN","FBUCLET2",127,0)
 S FBSC=""
"RTN","FBUCLET2",128,0)
 S DA=$P(FBIENS,",")
"RTN","FBUCLET2",129,0)
 S FBY=$G(^FBAAI(DA,0))
"RTN","FBUCLET2",130,0)
 S FBFPPSL=$P($G(^FBAAI(DA,3)),U,2) ; fpps line item
"RTN","FBUCLET2",131,0)
 S FBADJLR=$P($$ADJLRA^FBCHFA(DA_","),U)
"RTN","FBUCLET2",132,0)
 S:FBADJLR]"" FBACRR(FBADJLR)=""
"RTN","FBUCLET2",133,0)
 I $Y+$S(FBCC:FBCCI,1:10)>IOSL D PAGE^FBUCLET1,CHDHD
"RTN","FBUCLET2",134,0)
 W !!?8,$$FMTE^XLFDT($P(FBY,U,6)),?24,$$FMTE^XLFDT($P(FBY,U,7))
"RTN","FBUCLET2",135,0)
 W ?40,$J("$"_$FN($P(FBY,U,8),",",2),11)
"RTN","FBUCLET2",136,0)
 W ?53,$J("$"_$FN($P(FBY,U,9),",",2),12)
"RTN","FBUCLET2",137,0)
 S:FBADJLR="" FBSC=$$GET1^DIQ(162.5,FBIENS,10)
"RTN","FBUCLET2",138,0)
 S:FBSC]"" FBSCA(FBSC)=""
"RTN","FBUCLET2",139,0)
 W ?70,$S(FBADJLR]"":FBADJLR,1:FBSC)
"RTN","FBUCLET2",140,0)
 I FBFPPSC]"" W !,?8,"FPPS Claim ID: ",FBFPPSC,?36,"FPPS Line Item: ",FBFPPSL
"RTN","FBUCLET2",141,0)
 ; if "Other" suspend code then print description
"RTN","FBUCLET2",142,0)
 I FBSC="4" D
"RTN","FBUCLET2",143,0)
 . N FBGL,FBLBL
"RTN","FBUCLET2",144,0)
 . S FBGL="^FBAAI("
"RTN","FBUCLET2",145,0)
 . S FBLBL="Reason for Suspension: "
"RTN","FBUCLET2",146,0)
 . D:$Y+$S(FBCC:FBCCI,1:9)>IOSL PAGE^FBUCLET1
"RTN","FBUCLET2",147,0)
 . D TXT^FBUCUTL2(FBGL,DA,1,"WC69I10",1,1,.FBCC,FBCCI,FBLBL)
"RTN","FBUCLET2",148,0)
 Q
"RTN","FBUCLET2",149,0)
ODHD ; outpatient/ancillary payment header
"RTN","FBUCLET2",150,0)
 W !!?8,"Service Date",?22,"CPT-MOD"
"RTN","FBUCLET2",151,0)
 W ?40,"Amt Claimed",?53,"Amt Approved"
"RTN","FBUCLET2",152,0)
 W ?67,"Adj Code*"
"RTN","FBUCLET2",153,0)
 W !?8,"------------",?22,"--------"
"RTN","FBUCLET2",154,0)
 W ?40,"-----------",?53,"------------"
"RTN","FBUCLET2",155,0)
 W ?67,"--------"
"RTN","FBUCLET2",156,0)
 Q
"RTN","FBUCLET2",157,0)
 ;
"RTN","FBUCLET2",158,0)
OD ; outpatient/ancillary payment detail
"RTN","FBUCLET2",159,0)
 N FBADJRE
"RTN","FBUCLET2",160,0)
 S FBSC=""
"RTN","FBUCLET2",161,0)
 S DA=$P(FBIENS,",")
"RTN","FBUCLET2",162,0)
 S DA(1)=$P(FBIENS,",",2)
"RTN","FBUCLET2",163,0)
 S DA(2)=$P(FBIENS,",",3)
"RTN","FBUCLET2",164,0)
 S DA(3)=$P(FBIENS,",",4)
"RTN","FBUCLET2",165,0)
 S FBY=$G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,0))
"RTN","FBUCLET2",166,0)
 S FBFPPSL=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,3)),U,2)
"RTN","FBUCLET2",167,0)
 S FBADJLR=$P($$ADJLRA^FBAAFA(DA_","_DA(1)_","_DA(2)_","_DA(3)_","),U)
"RTN","FBUCLET2",168,0)
 F FBJ=1:1 S FBADJRE=$P(FBADJLR,",",FBJ) Q:FBADJRE=""  S FBACRR(FBADJRE)=""
"RTN","FBUCLET2",169,0)
 S FBDOS=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),0)),U)
"RTN","FBUCLET2",170,0)
 S FBCPT=$$GET1^DIQ(162.03,FBIENS,.01)
"RTN","FBUCLET2",171,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"_DA_",""M"")","E")
"RTN","FBUCLET2",172,0)
 I $Y+$S(FBCC:FBCCI,1:10)>IOSL D PAGE^FBUCLET1,ODHD
"RTN","FBUCLET2",173,0)
 W !!?8,$$FMTE^XLFDT(FBDOS)
"RTN","FBUCLET2",174,0)
 W ?22,FBCPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:"")
"RTN","FBUCLET2",175,0)
 W ?40,$J("$"_$FN($P(FBY,U,2),",",2),11)
"RTN","FBUCLET2",176,0)
 W ?53,$J("$"_$FN($P(FBY,U,3),",",2),12)
"RTN","FBUCLET2",177,0)
 S:FBADJLR="" FBSC=$$GET1^DIQ(162.03,FBIENS,4)
"RTN","FBUCLET2",178,0)
 S:FBSC]"" FBSCA(FBSC)=""
"RTN","FBUCLET2",179,0)
 W ?70,$S(FBADJLR]"":FBADJLR,1:FBSC)
"RTN","FBUCLET2",180,0)
 I $P($G(FBMODLE),",",2)]"" D
"RTN","FBUCLET2",181,0)
 . N FBI
"RTN","FBUCLET2",182,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D
"RTN","FBUCLET2",183,0)
 . . ;I $Y+4>IOSL W @IOF D HED W !,"  (continued)"
"RTN","FBUCLET2",184,0)
 . . W !,?27,"-",FBMOD
"RTN","FBUCLET2",185,0)
 I FBFPPSC]"" W !,?8,"FPPS Claim ID: ",FBFPPSC,?36,"FPPS Line Item: ",FBFPPSL
"RTN","FBUCLET2",186,0)
 ; if "Other" suspend code then print description
"RTN","FBUCLET2",187,0)
 I FBSC="4" D
"RTN","FBUCLET2",188,0)
 . N FBGL,FBLBL
"RTN","FBUCLET2",189,0)
 . S FBGL="^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","FBUCLET2",190,0)
 . S FBLBL="Reason for Suspension: "
"RTN","FBUCLET2",191,0)
 . D:$Y+$S(FBCC:FBCCI,1:9)>IOSL PAGE^FBUCLET1
"RTN","FBUCLET2",192,0)
 . D TXT^FBUCUTL2(FBGL,DA,1,"WC69I10",1,1,.FBCC,FBCCI,FBLBL)
"RTN","FBUCLET2",193,0)
 Q
"RTN","FBUCLET2",194,0)
PDHD ; pharmacy payment detail header
"RTN","FBUCLET2",195,0)
 W !!?8,"RX Date",?21,"RX #"
"RTN","FBUCLET2",196,0)
 W ?40,"Amt Claimed",?53,"Amt Approved"
"RTN","FBUCLET2",197,0)
 W ?67,"Adj Code*"
"RTN","FBUCLET2",198,0)
 W !?8,"------------",?21,"--------"
"RTN","FBUCLET2",199,0)
 W ?40,"-----------",?53,"------------"
"RTN","FBUCLET2",200,0)
 W ?67,"--------"
"RTN","FBUCLET2",201,0)
 Q
"RTN","FBUCLET2",202,0)
PD ; pharmacy payment detail
"RTN","FBUCLET2",203,0)
 N FBADJRE
"RTN","FBUCLET2",204,0)
 S FBSC=""
"RTN","FBUCLET2",205,0)
 S DA=$P(FBIENS,",")
"RTN","FBUCLET2",206,0)
 S DA(1)=$P(FBIENS,",",2)
"RTN","FBUCLET2",207,0)
 S FBY=$G(^FBAA(162.1,DA(1),"RX",DA,0))
"RTN","FBUCLET2",208,0)
 S FBFPPSL=$P($G(^FBAA(162.1,DA(1),"RX",DA,3)),U)
"RTN","FBUCLET2",209,0)
 S FBADJLR=$P($$ADJLRA^FBRXFA(DA_","_DA(1)_","),U)
"RTN","FBUCLET2",210,0)
 F FBJ=1:1 S FBADJRE=$P(FBADJLR,",",FBJ) Q:FBADJRE=""  S FBACRR(FBADJRE)=""
"RTN","FBUCLET2",211,0)
 I $Y+$S(FBCC:FBCCI,1:11)>IOSL D PAGE^FBUCLET1,PDHD
"RTN","FBUCLET2",212,0)
 W !!?8,$$FMTE^XLFDT($P(FBY,U,3)),?21,$$FMTE^XLFDT($P(FBY,U,1))
"RTN","FBUCLET2",213,0)
 W ?40,$J("$"_$FN($P(FBY,U,4),",",2),11)
"RTN","FBUCLET2",214,0)
 W ?53,$J("$"_$FN($P(FBY,U,16),",",2),12)
"RTN","FBUCLET2",215,0)
 S:FBADJLR="" FBSC=$$GET1^DIQ(162.11,FBIENS,7)
"RTN","FBUCLET2",216,0)
 S:FBSC]"" FBSCA(FBSC)=""
"RTN","FBUCLET2",217,0)
 W ?70,$S(FBADJLR]"":FBADJLR,1:FBSC)
"RTN","FBUCLET2",218,0)
 W !?8,"Drug Name: ",$P(FBY,U,2)
"RTN","FBUCLET2",219,0)
 I FBFPPSC]"" W !,?8,"FPPS Claim ID: ",FBFPPSC,?36,"FPPS Line Item: ",FBFPPSL
"RTN","FBUCLET2",220,0)
 ; if "Other" suspend code then print description
"RTN","FBUCLET2",221,0)
 I FBSC="4" D
"RTN","FBUCLET2",222,0)
 . N FBGL,FBLBL
"RTN","FBUCLET2",223,0)
 . S FBGL="^FBAA(162.1,"_DA(1)_",""RX"","
"RTN","FBUCLET2",224,0)
 . S FBLBL="Reason for Suspension: "
"RTN","FBUCLET2",225,0)
 . D:$Y+$S(FBCC:FBCCI,1:8)>IOSL PAGE^FBUCLET1
"RTN","FBUCLET2",226,0)
 . D TXT^FBUCUTL2(FBGL,DA,1,"WC69I10",1,1,.FBCC,FBCCI,FBLBL)
"RTN","FBUCLET2",227,0)
 Q
"RTN","FBXIP69E")
0^^B3841143
"RTN","FBXIP69E",1,0)
FBXIP69E ;BOIFO/SGJ-PATCH FB*3.5*69 ENVIRONMENT CHECK ;01/07/04
"RTN","FBXIP69E",2,0)
 ;;3.5;Fee Basis;**69**;JAN 30, 1995
"RTN","FBXIP69E",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBXIP69E",4,0)
ENV ;
"RTN","FBXIP69E",5,0)
 ;this is the environment check pre-init routine
"RTN","FBXIP69E",6,0)
 I $$PATCH^XPDUTL("FB*3.5*42") D
"RTN","FBXIP69E",7,0)
 .W !,"You are a test site for a CoreFLS version (patch FB*3.5*42) of Fee Basis"
"RTN","FBXIP69E",8,0)
 .W !,"This patch has a conflict with the FB-CoreFLS test software."
"RTN","FBXIP69E",9,0)
 .W !,"It must NOT be installed unless an accompanying update is made to the"
"RTN","FBXIP69E",10,0)
 .W !,"FB-CoreFLS software immediately after installation of this patch."
"RTN","FBXIP69E",11,0)
 .W !
"RTN","FBXIP69E",12,0)
 .K DIR S DIR(0)="YA"
"RTN","FBXIP69E",13,0)
 .S DIR("A")="Do you have the corresponding update to the FB-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","FBXIP69E",14,0)
 .D ^DIR K DIR
"RTN","FBXIP69E",15,0)
 .I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=2 Q
"RTN","FBXIP69E",16,0)
 .W !,"OK to install!"
"RTN","FBXIP69E",17,0)
 Q
"VER")
8.0^22
**END**
**END**
