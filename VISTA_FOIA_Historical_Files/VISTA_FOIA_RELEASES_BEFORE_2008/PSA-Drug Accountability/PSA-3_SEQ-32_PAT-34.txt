$TXT Created by HOUTCHENS,THOMAS at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 04/01/04 at 07:43
=============================================================================
Run Date: AUG 23, 2004                     Designation: PSA*3*34
Package : PSA - DRUG ACCOUNTABILITY           Priority: Mandatory
Version : 3        SEQ #32                      Status: Released
                  Compliance Date: SEP 23, 2004
=============================================================================

Associated patches: (v)PSA*3*21    <<= must be installed BEFORE `PSA*3*34'

Subject: CORRECTION FOR UNDEFINED LOCATION.

Category: 
  - Routine

Description:
============

 This patch provides an update to the DRUG ACCOUTABILITY v3.0 software and
 specifically a fix for NOIS BRX-0903-11128. This site reported an error when 
 using the option "PROCESS UPLOADED PRIME VENDOR INVOICE DATA". After
 doing the GUI upload and processing the upload data, the Pharmacist
 erred out due to an undefined Pharmacy Location.
 
 ASSOCIATED E3R(S):
 ==================
 N/A
 
 This patch addresses the following NOIS Call(s):
 ---------------------------------------------------
 1. BRX-0903-11128  DRUG ACCOUNTABILITY/3.0 LOCATION IS UNDEFINED WHEN IN
                    OPTION, 'PROCESS UPLOADED PRIME VENDOR INVOICE DATA.
    Duplicates:
    NYH-1003-11498  undef variable ~PSD(58.8,0,0)
    LOU-1003-42594  UNDEFINED LOCATION
    BAY-0404-30068  GUI Interface to Prime Vendor Errors Out
 
 Overview of NOIS Call(s):
 ----------------------------
 1. BRX-0903-11128 DRUG ACCOUNTABILITY/3.0. The site reported an error 
 when processing prime vendor invoice data within the option,
 'PROCESS UPLOADED PRIME VENDOR INVOICE DATA'. This error was an undefined
 or null Pharmacy Location in the DRUG ACCOUNTABILITY STATS file (58.8).
 
 Problem:
 --------
 As stated above, after the user had completed the GUI upload and began
 processing of the upload data, the Pharmacist erred out because the
 location was undefined.
 
 Resolution:
 -----------
 A minor modification to validate the Pharmacy Location was required. If the
 location is either null or not valid, the Pharmacy Location name
 will default to 'UNKNOWN' and a prompt for the Pharmacy Location will be
 displayed, allowing the user to edit and correct the invalid location.
 
 TECHNICAL:
 ==========
 NOIS: BRX-0903-11128
 
 The routines PSAPROC6 and PSAPROC2 require minor modifications and a
 validation check of the Pharmacy Location. These modifications were 
 performed with a $SELECT and $DEFINED of the Pharmacy Location variable
 PSALOC. If the Pharmacy Location variable is null or not defined in
 the DRUG ACCOUNTABILITY STATS file (58.8), then the user is prompted for a
 valid Pharmacy Location.
 
 	Before: PSAPROC6
 	-------
 	.D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
         .W !!,"PHARMACY LOCATION: "
         .W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,
 	 $P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !,PSALOCN D PHARM
 
 	After:  PSAPROC6
 	------
 
 	.;OIFO BAY PINES;TEH;PATCH PSA*3.0*34
         .D SITES^PSAUTL1 S PSALOCN=$S($D(^PSD(58.8,PSALOC,0)):
 	 $P($G(^PSD(58.8,PSALOC,0)),"^"),1:"UNKNOWN")_PSACOMB
         .W !!,"PHARMACY LOCATION: "
         .W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,
 	 $P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !,PSALOCN D PHARM
 
          Before: PSAPROC2
          -------
 
          ..D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
 
          After:  PSAPROC2
          ------
 
          ..D SITES^PSAUTL1 S PSALOCN=$S($D(^PSD(58.8,PSALOC,0)):$P($G(
          ^PSD(58.8,PSALOC,0)),"^"),1:"UNKNOWN")_PSACOMB
 
 
 PARTICIPATING TEST SITES:
 =========================
 Bronx, NY
 El Paso, TX 
 Fayetteville, AR
 Oklahoma City, OK
 
 DATA DICTIONARY CHANGES:
 ========================
 N/A
 
 TEMPLATES:
 ==========
 N/A
 
 ROUTINE SUMMARY:
 ================
 The following is a list of the routine(s) included in this patch.  The
 second line of each of these routine(s) will look like:
 
      <tab>;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**[patch list]**;
      10/24/97
 
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  PSAPROC2              36141715             36375020             34
  PSAPROC6              29515184             29791842           3,21,34
 
 TOTAL ROUTINES=2
 
 DISTRIBUTION:
 =============
 
 This patch is exported using KIDS.
 
 
 ====================== INSTALLATION INSTRUCTIONS =============================
 
 If installed during the normal workday it is recommended that the following
 menu options (File #19) and all of their descendants are disabled to
 prevent possible conflicts while running the KIDS install. Other VistA
 users will not be affected.
 
 		1. PSA GUI UPLOAD       UPLOAD UTILITY
 
 Install Time:
 -------------
 
 Loading of routines PSAPROC2 and PSAPROC6 will take less than 5 minutes.
 
 1. LOAD TRANSPORT GLOBAL
    ---------------------
 Choose the PackMan message containing this patch and invoke the INSTALL/CHECK
 MESSAGE PackMan option.
 
 2. DISABLE ROUTINE MAPPING (DSM FOR Open VMS sites only)
    -----------------------------------------------------
 
 NOTE: If the routines included in this patch are not currently in your mapped
 routine set, please skip this step.
 
 3 START UP KIDS
   -------------
 Start up the Kernel Installation and Distribution System Menu [XPD MAIN}.
 
 	Edits and Distribution
 	Utilities
 	Installation
 
 Select Kernel Installation & Distribution System Option: Installation
 
 	Load a Distribution
 	Print Transport Global
 	Compare Transport Global to Current System
 	Verify Checksums in Transport Global
 	Install Package(s)
 	Restart Install of Package(s)
 	Unload a Distribution
 	Backup a Transport Global
 
 4. Select Installation Option:
    ---------------------------
 
 NOTE: The following are OPTIONAL - (When prompted for the INSTALL NAME, enter
       PSA*3.0*34).
 
 	a. Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
 	b. Compare Transport Global to Current System - This option will allow
            you to view all changes that will be made when this patch is
            installed. It compares all components of this patch, (routines, 
            DD's, templates, etc.).
 	c. Verify Checksums in Transport Global - This option will allow you
            to ensure the integrity of the routines that are in the transport
            global.
 
 5. Select Installation Option: Install Package(s)
    ----------------------------------------------
 	** This is the step to start the installation of this KIDS patch. **
 
 	a. Choose the Install Package(s) option to start the patch
            installation.
 	b. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
            YES//' answer 'NO' (Unless otherwise indicated).
 	c. When prompted 'Want to DISABLE Scheduled Options, Menu Options, and
            Protocols? YES// YES
         d. Informational example:
 
            Enter option you wish to mark as 'Out Of Order': PSA GUI UPLOAD
            UPLOAD UTILITY
 
            Enter options you wish to mark as 'Out Of Order'.
 
            Enter protocols you wish to mark as 'Out Of Order'.
 
            Delay Install(Minutes): (0-60): 0//
 
            Enter the Device you want to print the Install messages.
            You can queue the install by enter a 'Q' at the device prompt
            Enter a '^' to abort the install.
 
            DEVICE: HOME// UCX
 
                           PSA*3.0*34
 
            Install Starting for PSA*3.0*34:
 
                      Aug 18, 2004@16:03:03
 
            Build Distribution Date: Apr 01,2004
 
            Installing Routines:
 
                      Aug 18, 2004@16:03:03
 
            Updating Routine file...
 
            Updating KIDS Installed
            
            PSA*3.0*34 Installed.
  
                   Aug 18, 2004@16:03:03
 
            Install Message sent #13252
 
 
            --------------------------------------------------------------
            100%  |      25       50      75       |
            --------------------------------------------------------------
            Complete |                             |
            --------------------------------------------------------------
 
 
            Install Completed
 
 
 6. REBUILD MAPPED ROUTINES(S) (DSM for Open VMS sites only)
 
 Optional - Include the routines distributed with this patch in the mapped
 routine set.
 
 NOTE: This step is only necessary if you performed step 2 or if you wish to
 include the routines in your mapped set.
 
 COMPONENTS SENT WITH PATCH
 ==========================
  
 N/A
 

Routine Information:
====================

Routine Name:
  - PSAPROC6


Routine Checksum:

Routine Name:
  - PSAPROC2


Routine Checksum:

=============================================================================
User Information:
Entered By  : HOUTCHENS,THOMAS              Date Entered  : SEP 16, 2003
Completed By: ANDERSON,MAXINE               Date Completed: AUG 20, 2004
Released By : LYTTLE,KIM M                  Date Released : AUG 23, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
