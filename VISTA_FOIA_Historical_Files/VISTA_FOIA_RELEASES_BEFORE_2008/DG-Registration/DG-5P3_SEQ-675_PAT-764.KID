Released DG*5.3*764 SEQ #675
Extracted from mail message
**KIDS**:DG*5.3*764^

**INSTALL NAME**
DG*5.3*764
"BLD",7202,0)
DG*5.3*764^REGISTRATION^0^3070810^y
"BLD",7202,1,0)
^^2^2^3070808^^^
"BLD",7202,1,1,0)
Please see the national patch module for a description of the changes
"BLD",7202,1,2,0)
included in this patch.
"BLD",7202,4,0)
^9.64PA^^
"BLD",7202,6.3)
16
"BLD",7202,"ABPKG")
n
"BLD",7202,"INIT")
EP^DG53742
"BLD",7202,"KRN",0)
^9.67PA^8989.52^19
"BLD",7202,"KRN",.4,0)
.4
"BLD",7202,"KRN",.401,0)
.401
"BLD",7202,"KRN",.402,0)
.402
"BLD",7202,"KRN",.403,0)
.403
"BLD",7202,"KRN",.5,0)
.5
"BLD",7202,"KRN",.84,0)
.84
"BLD",7202,"KRN",3.6,0)
3.6
"BLD",7202,"KRN",3.8,0)
3.8
"BLD",7202,"KRN",9.2,0)
9.2
"BLD",7202,"KRN",9.8,0)
9.8
"BLD",7202,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7202,"KRN",9.8,"NM",1,0)
DGRP6CL1^^0^B35133864
"BLD",7202,"KRN",9.8,"NM",2,0)
DGRP6CL^^0^B63349974
"BLD",7202,"KRN",9.8,"NM","B","DGRP6CL",2)

"BLD",7202,"KRN",9.8,"NM","B","DGRP6CL1",1)

"BLD",7202,"KRN",19,0)
19
"BLD",7202,"KRN",19.1,0)
19.1
"BLD",7202,"KRN",101,0)
101
"BLD",7202,"KRN",409.61,0)
409.61
"BLD",7202,"KRN",771,0)
771
"BLD",7202,"KRN",870,0)
870
"BLD",7202,"KRN",8989.51,0)
8989.51
"BLD",7202,"KRN",8989.52,0)
8989.52
"BLD",7202,"KRN",8994,0)
8994
"BLD",7202,"KRN","B",.4,.4)

"BLD",7202,"KRN","B",.401,.401)

"BLD",7202,"KRN","B",.402,.402)

"BLD",7202,"KRN","B",.403,.403)

"BLD",7202,"KRN","B",.5,.5)

"BLD",7202,"KRN","B",.84,.84)

"BLD",7202,"KRN","B",3.6,3.6)

"BLD",7202,"KRN","B",3.8,3.8)

"BLD",7202,"KRN","B",9.2,9.2)

"BLD",7202,"KRN","B",9.8,9.8)

"BLD",7202,"KRN","B",19,19)

"BLD",7202,"KRN","B",19.1,19.1)

"BLD",7202,"KRN","B",101,101)

"BLD",7202,"KRN","B",409.61,409.61)

"BLD",7202,"KRN","B",771,771)

"BLD",7202,"KRN","B",870,870)

"BLD",7202,"KRN","B",8989.51,8989.51)

"BLD",7202,"KRN","B",8989.52,8989.52)

"BLD",7202,"KRN","B",8994,8994)

"BLD",7202,"QUES",0)
^9.62^^
"BLD",7202,"REQB",0)
^9.611^3^2
"BLD",7202,"REQB",2,0)
DG*5.3*751^2
"BLD",7202,"REQB",3,0)
DG*5.3*653^2
"BLD",7202,"REQB","B","DG*5.3*653",3)

"BLD",7202,"REQB","B","DG*5.3*751",2)

"INIT")
EP^DG53742
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
764^3070810^539
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3070810
"PKG",5,22,1,"PAH",1,1,1,0)
Please see the national patch module for a description of the changes
"PKG",5,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DG53742")
0^^B41932788^n/a
"RTN","DG53742",1,0)
DG53742 ;ALB/TMK - DG*5.3*764 (formerly 742) Cleanup OEF/OIF site info; 01/10/2007
"RTN","DG53742",2,0)
 ;;5.3;Registration;**764**;Aug 13,1993;Build 16
"RTN","DG53742",3,0)
 ;
"RTN","DG53742",4,0)
POST ; This routine was previously part of patch DG*5.3*742, now in *764
"RTN","DG53742",5,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTIO,ZTSK,ZTDTH
"RTN","DG53742",6,0)
 D BMES^XPDUTL("Queue-ing the job to correct OEF/OIF site info...")
"RTN","DG53742",7,0)
 K ^XTMP($$NAMSPC)
"RTN","DG53742",8,0)
 S ZTRTN="RUN^DG53742",ZTDESC="Correct OEF/OIF site info"
"RTN","DG53742",9,0)
 S ZTIO="",ZTDTH=$$NOW^XLFDT D ^%ZTLOAD
"RTN","DG53742",10,0)
 D BMES^XPDUTL("This request queued as Task # "_$G(ZTSK))
"RTN","DG53742",11,0)
 D BMES^XPDUTL("=====================================================")
"RTN","DG53742",12,0)
 D BMES^XPDUTL("")
"RTN","DG53742",13,0)
 Q
"RTN","DG53742",14,0)
EP ; Queue the conversion
"RTN","DG53742",15,0)
 N %
"RTN","DG53742",16,0)
 S %=$$NEWCP^XPDUTL("POST","POST^DG53742")
"RTN","DG53742",17,0)
 S %=$$NEWCP^XPDUTL("EVC1","EVC1^DG53742")
"RTN","DG53742",18,0)
 S %=$$NEWCP^XPDUTL("END","END^DG53742") ; Leave as last update
"RTN","DG53742",19,0)
 Q
"RTN","DG53742",20,0)
 ;
"RTN","DG53742",21,0)
EVC1 ; Update the USE FOR Z07 CHECK field #6
"RTN","DG53742",22,0)
 ; in the INCONSISTENT DATA ELEMENTS file #38.6 for CC 718
"RTN","DG53742",23,0)
 N RULE,DA,DIE,DR,X,Y
"RTN","DG53742",24,0)
 S RULE=718
"RTN","DG53742",25,0)
 D BMES^XPDUTL("Modifying entry #"_RULE_" in 38.6 file.")
"RTN","DG53742",26,0)
 S DIE=38.6,DA=$$FIND1^DIC(DIE,"","X",RULE)
"RTN","DG53742",27,0)
 I 'DA D  Q
"RTN","DG53742",28,0)
 .D MES^XPDUTL("    *** Entry not found! Nothing Updated!! ***") Q
"RTN","DG53742",29,0)
 S DR="6////0" D ^DIE
"RTN","DG53742",30,0)
 D MES^XPDUTL("    *** Update Complete ***")
"RTN","DG53742",31,0)
 D BMES^XPDUTL("")
"RTN","DG53742",32,0)
 Q
"RTN","DG53742",33,0)
 ;
"RTN","DG53742",34,0)
END ; Post-install done
"RTN","DG53742",35,0)
 D BMES^XPDUTL("Post install complete.")
"RTN","DG53742",36,0)
 Q
"RTN","DG53742",37,0)
 ;
"RTN","DG53742",38,0)
RUN ; 'Live' entry point from taskman
"RTN","DG53742",39,0)
 N NAMSPC
"RTN","DG53742",40,0)
 S NAMSPC=$$NAMSPC
"RTN","DG53742",41,0)
 D QUE(NAMSPC,0)
"RTN","DG53742",42,0)
 Q
"RTN","DG53742",43,0)
 ;
"RTN","DG53742",44,0)
TEST ;entry point for test mode
"RTN","DG53742",45,0)
 N NAMSPC
"RTN","DG53742",46,0)
 S NAMSPC=$$NAMSPC_"_TEST"
"RTN","DG53742",47,0)
 D QUE(NAMSPC,1)
"RTN","DG53742",48,0)
 Q
"RTN","DG53742",49,0)
 ;
"RTN","DG53742",50,0)
QUE(NAMSPC,TESTING) ;
"RTN","DG53742",51,0)
 N ZTSTOP,DGX,X,Y
"RTN","DG53742",52,0)
 S TESTING=+$G(TESTING)
"RTN","DG53742",53,0)
 D SETUPX(NAMSPC,90)
"RTN","DG53742",54,0)
 S DGX=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",55,0)
 I $P(DGX,U,6)="COMPLETED" D MAIL(NAMSPC,TESTING) Q
"RTN","DG53742",56,0)
 S $P(DGX,U,6)="RUNNING"
"RTN","DG53742",57,0)
 S $P(DGX,U,7)=$$NOW^XLFDT
"RTN","DG53742",58,0)
 S ^XTMP(NAMSPC,0,0)=DGX
"RTN","DG53742",59,0)
 ;
"RTN","DG53742",60,0)
 S X=$$LOOP(NAMSPC,TESTING),ZTSTOP=$P(X,U,2)
"RTN","DG53742",61,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",62,0)
 S $P(X,U,6)=$S(ZTSTOP:"STOPPED",1:"COMPLETED")
"RTN","DG53742",63,0)
 S $P(X,U,8)=$$NOW^XLFDT
"RTN","DG53742",64,0)
 S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53742",65,0)
 ;
"RTN","DG53742",66,0)
 D MAIL(NAMSPC,TESTING)
"RTN","DG53742",67,0)
 Q
"RTN","DG53742",68,0)
 ;
"RTN","DG53742",69,0)
SETUPX(NAMSPC,EXPDAYS) ;
"RTN","DG53742",70,0)
 ; requires EXPDAYS - # days to keep XTMP around
"RTN","DG53742",71,0)
 N BEGTIME,PURGDT
"RTN","DG53742",72,0)
 S NAMSPC=$$NAMSPC
"RTN","DG53742",73,0)
 S BEGTIME=$$NOW^XLFDT()
"RTN","DG53742",74,0)
 S PURGDT=$$FMADD^XLFDT(BEGTIME,EXPDAYS)
"RTN","DG53742",75,0)
 S ^XTMP(NAMSPC,0)=PURGDT_U_BEGTIME
"RTN","DG53742",76,0)
 S $P(^XTMP(NAMSPC,0),U,3)="Correct OEF/OIF site info"
"RTN","DG53742",77,0)
 Q
"RTN","DG53742",78,0)
 ;
"RTN","DG53742",79,0)
LOOP(NAMSPC,TESTING) ;
"RTN","DG53742",80,0)
 ;returns 0^stop flag
"RTN","DG53742",81,0)
 N X,XREC,LASTREC,TOTREC,TOTPAT
"RTN","DG53742",82,0)
 S LASTREC="",ZTSTOP=0
"RTN","DG53742",83,0)
 S TOTREC=0
"RTN","DG53742",84,0)
 I $D(^XTMP(NAMSPC,0,0)) D
"RTN","DG53742",85,0)
 . S XREC=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",86,0)
 . ;last xref entry processed
"RTN","DG53742",87,0)
 . S LASTREC=$P(XREC,U,1)
"RTN","DG53742",88,0)
 . ;total records read
"RTN","DG53742",89,0)
 . S TOTREC=+$P(XREC,U,2)
"RTN","DG53742",90,0)
 . ; total OEIF records updated
"RTN","DG53742",91,0)
 . S TOTPAT=+$P(XREC,U,10)
"RTN","DG53742",92,0)
 . Q
"RTN","DG53742",93,0)
 D OEIF(NAMSPC,TESTING,LASTREC)
"RTN","DG53742",94,0)
 Q 0_"^"_ZTSTOP
"RTN","DG53742",95,0)
 ;
"RTN","DG53742",96,0)
OEIF(NAMSPC,TESTING,LASTREC) ;
"RTN","DG53742",97,0)
 N GBL,DFN,OEIF,SITE,X,Y,Z,DIE,DR,DA
"RTN","DG53742",98,0)
 S ZTSTOP=0
"RTN","DG53742",99,0)
 S GBL="^DPT(""ALOEIF"""
"RTN","DG53742",100,0)
 I $TR(LASTREC,";")'="" D
"RTN","DG53742",101,0)
 . F Z=1:1:5 Q:$P(LASTREC,";",Z)=""  S:Z=1 GBL=GBL_"," S GBL=GBL_""""_$P(LASTREC,";",Z)_""""_$S($P(LASTREC,";",Z+1)'="":",",1:"")
"RTN","DG53742",102,0)
 S GBL=GBL_")"
"RTN","DG53742",103,0)
 F  S GBL=$Q(@GBL) Q:GBL=""!($QS(GBL,1)'="ALOEIF")!ZTSTOP  S DFN=$QS(GBL,5) I DFN D
"RTN","DG53742",104,0)
 . S OEIF=0 F  S OEIF=$O(^DPT(DFN,.3215,OEIF)) Q:'OEIF  S SITE=$P($G(^(OEIF,0)),U,6) I SITE,+SITE'=SITE S SITE=+$O(^DIC(4,"D",SITE,0)) I SITE D
"RTN","DG53742",105,0)
 .. S DR=".06////"_SITE,DA(1)=DFN,DA=OEIF,DIE="^DPT("_DA(1)_",.3215," D:'TESTING ^DIE S TOTPAT=TOTPAT+1
"RTN","DG53742",106,0)
 . S ZTSTOP=$$CHKR(NAMSPC,TESTING,GBL,TOTPAT,.TOTREC)
"RTN","DG53742",107,0)
 Q
"RTN","DG53742",108,0)
 ;
"RTN","DG53742",109,0)
CHKR(NAMSPC,TESTING,GBL,TOTPAT,TOTREC) ;
"RTN","DG53742",110,0)
 N X,Z,ZTSTOP
"RTN","DG53742",111,0)
 S ZTSTOP=0
"RTN","DG53742",112,0)
 F Z=2:1:6 S LASTREC=$QS(GBL,Z)_";"
"RTN","DG53742",113,0)
 S TOTREC=TOTREC+1
"RTN","DG53742",114,0)
 D UPDATEX(NAMSPC,TOTREC,LASTREC,TOTPAT)
"RTN","DG53742",115,0)
 I '(TOTREC#500) S ZTSTOP=$$STOP(NAMSPC)
"RTN","DG53742",116,0)
 Q ZTSTOP
"RTN","DG53742",117,0)
 ;
"RTN","DG53742",118,0)
UPDATEX(NAMSPC,TOTREC,LASTREC,TOTPAT) ;
"RTN","DG53742",119,0)
 N X
"RTN","DG53742",120,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",121,0)
 S $P(X,U,1)=$G(LASTREC),$P(X,U,2)=$G(TOTREC)
"RTN","DG53742",122,0)
 S $P(X,U,10)=$G(TOTPAT)
"RTN","DG53742",123,0)
 S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53742",124,0)
 Q
"RTN","DG53742",125,0)
 ;
"RTN","DG53742",126,0)
STATUS ;display status of current run
"RTN","DG53742",127,0)
 N DIR,X,Y,DTOUT,DUOUT,NAMSPC
"RTN","DG53742",128,0)
 S DIR(0)="SA^T:TEST;L:LIVE",DIR("A")="(T)EST OR (L)IVE?: ",DIR("B")="LIVE"
"RTN","DG53742",129,0)
 D ^DIR K DIR
"RTN","DG53742",130,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","DG53742",131,0)
 S NAMSPC=$$NAMSPC_$S(Y="L":"",1:"_TEST")
"RTN","DG53742",132,0)
 I Y'="L" W !,"TEST TEST TEST TEST TEST TEST",!
"RTN","DG53742",133,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",134,0)
 I X="" W !!,"Task not started!!!" Q
"RTN","DG53742",135,0)
 W !!," Current status: ",$P(X,U,6)
"RTN","DG53742",136,0)
 W !,"  Starting time: ",$$FMTE^XLFDT($P(X,U,7))
"RTN","DG53742",137,0)
 I $P(X,U,8) W !,"    Ending time: ",$$FMTE^XLFDT($P(X,U,8))
"RTN","DG53742",138,0)
 W !!,"      Total patient records read: ",$P(X,U,2)
"RTN","DG53742",139,0)
 W !,"    Last patient record processed: ",$P(X,U,1)
"RTN","DG53742",140,0)
 W !,"    Total OEF/OIF records changed: ",$P(X,U,10)
"RTN","DG53742",141,0)
 Q
"RTN","DG53742",142,0)
 ;
"RTN","DG53742",143,0)
STOP(NAMSPC) ; returns stop flag
"RTN","DG53742",144,0)
 N ZTSTOP,X
"RTN","DG53742",145,0)
 S ZTSTOP=0
"RTN","DG53742",146,0)
 I $$S^%ZTLOAD S ZTSTOP=1
"RTN","DG53742",147,0)
 I $D(^XTMP(NAMSPC,"STOP")) S ZTSTOP=1 K ^XTMP(NAMSPC,"STOP")
"RTN","DG53742",148,0)
 I ZTSTOP D
"RTN","DG53742",149,0)
 . S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",150,0)
 . S $P(X,U,6)="STOPPED",$P(X,U,7)=$$NOW^XLFDT
"RTN","DG53742",151,0)
 . S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53742",152,0)
 . Q
"RTN","DG53742",153,0)
 Q ZTSTOP
"RTN","DG53742",154,0)
 ;
"RTN","DG53742",155,0)
NAMSPC() ;
"RTN","DG53742",156,0)
 Q $T(+0)
"RTN","DG53742",157,0)
 ;
"RTN","DG53742",158,0)
MAIL(NAMSPC,TESTING) ; mail stats
"RTN","DG53742",159,0)
 N MSGNO,TOTREC,TOTPAT,STAT,STIME,ETIME,LIN,HTEXT,X
"RTN","DG53742",160,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53742",161,0)
 S TOTREC=$P(X,U,2)
"RTN","DG53742",162,0)
 S STAT=$P(X,U,6),STIME=$P(X,U,7)
"RTN","DG53742",163,0)
 S ETIME=$P(X,U,8)
"RTN","DG53742",164,0)
 S TOTPAT=$P(X,U,10)
"RTN","DG53742",165,0)
 ;
"RTN","DG53742",166,0)
 D HDNG(NAMSPC,.HTEXT,.LIN,STAT,STIME,ETIME,TESTING)
"RTN","DG53742",167,0)
 D SUMRY(.LIN,TOTREC,TOTPAT)
"RTN","DG53742",168,0)
 D MAILIT(HTEXT,NAMSPC)
"RTN","DG53742",169,0)
 K ^TMP(NAMSPC,$J,"MSG")
"RTN","DG53742",170,0)
 Q
"RTN","DG53742",171,0)
 ;
"RTN","DG53742",172,0)
HDNG(NAMSPC,HTEXT,LIN,STAT,STIME,ETIME,TESTING) ; build heading lines
"RTN","DG53742",173,0)
 N X,Y,TEXT
"RTN","DG53742",174,0)
 K ^TMP(NAMSPC,$J,"MSG")
"RTN","DG53742",175,0)
 S LIN=0
"RTN","DG53742",176,0)
 S HTEXT="Correct OEF/OIF site info "_STAT_" on "
"RTN","DG53742",177,0)
 S HTEXT=HTEXT_$$FMTE^XLFDT(ETIME)
"RTN","DG53742",178,0)
 D BLDLINE(NAMSPC,HTEXT,.LIN)
"RTN","DG53742",179,0)
 D BLDLINE(NAMSPC,"",.LIN)
"RTN","DG53742",180,0)
 I TESTING D
"RTN","DG53742",181,0)
 . S TEXT="** TESTING - NO CHANGES TO DATABASE EXECUTED **"
"RTN","DG53742",182,0)
 . D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53742",183,0)
 D BLDLINE(NAMSPC,"",.LIN)
"RTN","DG53742",184,0)
 Q
"RTN","DG53742",185,0)
 ;
"RTN","DG53742",186,0)
SUMRY(LIN,TOTREC,TOTPAT) ; build summary lines
"RTN","DG53742",187,0)
 N TEXT
"RTN","DG53742",188,0)
 S TEXT="      Total Patient Records Read: "_$J($FN(TOTREC,","),11)
"RTN","DG53742",189,0)
 D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53742",190,0)
 S TEXT="   Total OEF/OIF Records Changed: "_$J($FN(TOTPAT,","),11)
"RTN","DG53742",191,0)
 D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53742",192,0)
 Q
"RTN","DG53742",193,0)
 ;
"RTN","DG53742",194,0)
BLDLINE(NAMSPC,TEXT,LIN) ;build a single line in TMP msg global
"RTN","DG53742",195,0)
 S LIN=LIN+1
"RTN","DG53742",196,0)
 S ^TMP(NAMSPC,$J,"MSG",LIN)=TEXT
"RTN","DG53742",197,0)
 Q
"RTN","DG53742",198,0)
 ;
"RTN","DG53742",199,0)
MAILIT(HTEXT,NAMSPC) ; send the msg
"RTN","DG53742",200,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","DG53742",201,0)
 S XMY(DUZ)="",XMDUZ=.5
"RTN","DG53742",202,0)
 S XMY("G.DGEN ELIGIBILITY ALERT")=""
"RTN","DG53742",203,0)
 S XMSUB=HTEXT
"RTN","DG53742",204,0)
 S XMTEXT="^TMP(NAMSPC,$J,""MSG"","
"RTN","DG53742",205,0)
 D ^XMD
"RTN","DG53742",206,0)
 Q
"RTN","DG53742",207,0)
 ;
"RTN","DGRP6CL")
0^2^B63349974^B62565358
"RTN","DGRP6CL",1,0)
DGRP6CL ;ALB/TMK - REGISTRATION SCREEN 6 FIELDS Conflict locations ; 09/15/2005
"RTN","DGRP6CL",2,0)
 ;;5.3;Registration;**689,751,764**;Aug 13, 1993;Build 16
"RTN","DGRP6CL",3,0)
 ;
"RTN","DGRP6CL",4,0)
CLLST(DFN,DGCONF,DGPOSS,DGMSE) ;
"RTN","DGRP6CL",5,0)
 ; For patient DFN:
"RTN","DGRP6CL",6,0)
 ; Returns DGCONF array: DGCONF(conf loc)= Start dt^End dt
"RTN","DGRP6CL",7,0)
 ;  or, for multiple OEF/OIF/ UNKNOWN OEF/OIF: DGCONF(conf loc-ien) =
"RTN","DGRP6CL",8,0)
 ;                    Start dt ^ End dt ^ Site source ^ Lock flag
"RTN","DGRP6CL",9,0)
 ;    DGCONF(conflict loc,1)=1 if dts inconsistent w/mse dts
"RTN","DGRP6CL",10,0)
 ; DGPOSS = array of possible conflict locations, based on service
"RTN","DGRP6CL",11,0)
 ;          episode dts DGPOSS(conf loc)=""
"RTN","DGRP6CL",12,0)
 ; DGMSE = array of military svc episodes
"RTN","DGRP6CL",13,0)
 ;          DGMSE(1-3)=fr dt^to dt^branch ien^comp code
"RTN","DGRP6CL",14,0)
 ;
"RTN","DGRP6CL",15,0)
 N DGZ,DGZ0,DGZ1,DG32,DG3291,DIQUIET,FRTO
"RTN","DGRP6CL",16,0)
 S DIQUIET=1 K DGCONF,DGPOSS
"RTN","DGRP6CL",17,0)
 S DG32=$G(^DPT(DFN,.32)),DG3291=$G(^(.3291))
"RTN","DGRP6CL",18,0)
 S DGZ1=0
"RTN","DGRP6CL",19,0)
 F DGZ=1:1:3 S DGZ0=$S(DGZ=1:"5^5^6^7",DGZ=2:"19^10^11^12",1:"20^15^16^17") D
"RTN","DGRP6CL",20,0)
 . Q:$S($P(DG32,U,+DGZ0)="Y":0,1:'$P(DG32,U,+DGZ0))
"RTN","DGRP6CL",21,0)
 . S DGZ1=DGZ1+1,DGMSE(DGZ1)=$P(DG32,U,$P(DGZ0,U,3))_U_$P(DG32,U,$P(DGZ0,U,4))_U_$P(DG32,U,$P(DGZ0,U,2))_U_$P(DG3291,U,DGZ)
"RTN","DGRP6CL",22,0)
 ;
"RTN","DGRP6CL",23,0)
 ; Must chk all possible/on-file conf locs for valid mil svc pd
"RTN","DGRP6CL",24,0)
 ; Extract OEF/OIF data
"RTN","DGRP6CL",25,0)
 F DGZ="OEF","OIF","UNK" S DGCONF(DGZ)=""
"RTN","DGRP6CL",26,0)
 D GET^DGENOEIF(DFN,.DGZ,0,"","")
"RTN","DGRP6CL",27,0)
 S DGZ0=0 F  S DGZ0=$O(DGZ("IEN",DGZ0)) Q:'DGZ0  S DGZ=$G(DGZ("IEN",DGZ0)) D
"RTN","DGRP6CL",28,0)
 . N DGCONFX
"RTN","DGRP6CL",29,0)
 . Q:'$G(DGZ("FR",DGZ0))&'$G(DGZ("TO",DGZ0))
"RTN","DGRP6CL",30,0)
 . S DGCONFX=$P("OIF^OEF^UNK",U,+$G(DGZ("LOC",DGZ0)))_"-"_DGZ,DGCONF=DGCONFX,DGCONF($P(DGCONFX,"-"))=$G(DGCONF($P(DGCONFX,"-")))_DGZ_";"
"RTN","DGRP6CL",31,0)
 . F FRTO=1,0 S $P(DGCONF(DGCONFX),U,$S(FRTO:1,1:2))=$$GETDT^DGRPMS(DFN,DGCONFX,FRTO) I FRTO=0 D CKDT^DGRP6CL1(.DGCONF,.DGMSE,.DGPOSS)
"RTN","DGRP6CL",32,0)
 . S $P(DGCONF(DGCONFX),U,3)=$G(DGZ("SITE",DGZ0))
"RTN","DGRP6CL",33,0)
 . S $P(DGCONF(DGCONFX),U,4)=$G(DGZ("LOCK",DGZ0))
"RTN","DGRP6CL",34,0)
 F DGCONF="OEF","OIF","UNK" D CKDT^DGRP6CL1(.DGCONF,.DGMSE,.DGPOSS)
"RTN","DGRP6CL",35,0)
 F DGCONF="VIET","LEB","GREN","PAN","GULF","SOM","YUG" F FRTO=1,0 S $P(DGCONF(DGCONF),U,$S(FRTO:1,1:2))=$$GETDT^DGRPMS(DFN,DGCONF,FRTO) I FRTO=0 D CKDT^DGRP6CL1(.DGCONF,.DGMSE,.DGPOSS)
"RTN","DGRP6CL",36,0)
 Q
"RTN","DGRP6CL",37,0)
 ;
"RTN","DGRP6CL",38,0)
YN(DGRPX,X) ;Format Yes/No fld in $P(DGRPX,U,X)
"RTN","DGRP6CL",39,0)
 Q $S($P(DGRPX,"^",X)="Y":"YES",$P(DGRPX,"^",X)="N":"NO ",$P(DGRPX,"^",X)="U":"UNK",1:"   ")
"RTN","DGRP6CL",40,0)
 ;
"RTN","DGRP6CL",41,0)
DAT(DGRPX,X,Z1) ; Format dt in $P(DGRPX,U,X) for a length of Z1
"RTN","DGRP6CL",42,0)
 N Z
"RTN","DGRP6CL",43,0)
 S Z=$P(DGRPX,U,X)
"RTN","DGRP6CL",44,0)
 I Z'="" S Z=$$FMTE^XLFDT(Z,"5DZ")
"RTN","DGRP6CL",45,0)
 S:$L(Z)<Z1 Z=$E(Z_$J("",Z1),1,Z1)
"RTN","DGRP6CL",46,0)
 Q Z
"RTN","DGRP6CL",47,0)
 ;
"RTN","DGRP6CL",48,0)
EN(DFN,QUIT) ; Entry from reg screen 6
"RTN","DGRP6CL",49,0)
 N DIPA,DGCONF,DGCONFS,DGCONF1,DGMSE,DGMSG,DGPOSS,DIR,DIE,DR,DA
"RTN","DGRP6CL",50,0)
 ;
"RTN","DGRP6CL",51,0)
 ; Return QUIT=1 if ^ entered
"RTN","DGRP6CL",52,0)
EN1 ; Entry from conf subscreen off reg screen 6
"RTN","DGRP6CL",53,0)
 ; Routine loops until exit/quit from subscreen
"RTN","DGRP6CL",54,0)
 D CLEAR^VALM1
"RTN","DGRP6CL",55,0)
 K DGCONF,DGCONFS,DGPOSS,DGMSE,DGMSG,DGDISP
"RTN","DGRP6CL",56,0)
 N DIR,DTOUT,DUOUT,Z,Z0,Z1,Z2,X,Y,LOOP,DG,DGM,DGZ,DGEG,DGEGS,DGX,DGX1,DG321,DG322,DGCT,DGY,DGY1,DGCTX,SSN
"RTN","DGRP6CL",57,0)
 D CLLST(DFN,.DGCONF,.DGPOSS,.DGMSE)
"RTN","DGRP6CL",58,0)
 I $G(DGRPV) S $E(DGRPVV(6),2,3)="00",DGRPVV(6,"NOEDIT")=1
"RTN","DGRP6CL",59,0)
 I '$G(DGRPV),$E(DGRPVV(6),2,3)="11" S $E(DGRPVV(6),2,3)="00",DGRPVV(6,"NOEDIT")=1
"RTN","DGRP6CL",60,0)
 S DGMSG=0,DGCTX=0
"RTN","DGRP6CL",61,0)
 F Z="OEF","OIF","UNK" D  ; Sort OEF/OIF/ UNKNOWN OEF/OIF
"RTN","DGRP6CL",62,0)
 . ; by reverse from dt within each conf
"RTN","DGRP6CL",63,0)
 . S Z0=Z F  S Z0=$O(DGCONF(Z0)) Q:Z0=""!(Z0'[Z)  S Z2=Z_"-"_(9999999-DGCONF(Z0)) S DGCONFS(Z2)=$P(Z0,"-",2) I 'DGMSG,$G(DGCONF(Z0,1)) S DGMSG=1
"RTN","DGRP6CL",64,0)
 S DG321=$G(^DPT(DFN,.321)),DG322=$G(^(.322))
"RTN","DGRP6CL",65,0)
 ;
"RTN","DGRP6CL",66,0)
 S DIR(0)="SA^",DGCT=0
"RTN","DGRP6CL",67,0)
 S X=$S($D(^DPT(+DFN,0)):^(0),1:""),SSN=$P(X,"^",9),SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,10)
"RTN","DGRP6CL",68,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=$$SSNNM^DGRPU(DFN)
"RTN","DGRP6CL",69,0)
 S DGCT=DGCT+1,DIR("A",DGCT)="",$P(DIR("A",DGCT),"=",81)=""
"RTN","DGRP6CL",70,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=$S($O(DGMSE(0)):"MILITARY SERVICE PERIODS:",1:"NO SERVICE PERIODS FOR THIS PATIENT - NO CONFLICT LOC CAN BE ENTERED")
"RTN","DGRP6CL",71,0)
 S Z=0 F  S Z=$O(DGMSE(Z)) Q:'Z  D
"RTN","DGRP6CL",72,0)
 . S DGCT=DGCT+1,DIR("A",DGCT)=$J("",3)_$E($$EXTERNAL^DILFD(2,.325,"",$P(DGMSE(Z),U,3))_$S($P(DGMSE(Z),U,4)'="":"/"_$$SVCCOMP($P(DGMSE(Z),U,4)),1:"")_$J("",30),1,30)
"RTN","DGRP6CL",73,0)
 . S DIR("A",DGCT)=DIR("A",DGCT)_"  ("_$S($P(DGMSE(Z),U):$$FMTE^XLFDT($P(DGMSE(Z),U),"5DZ"),1:"missing")_"-"_$S($P(DGMSE(Z),U,2):$$FMTE^XLFDT($P(DGMSE(Z),U,2),"5DZ"),1:"missing")_")"
"RTN","DGRP6CL",74,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=" "
"RTN","DGRP6CL",75,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=$J("",24)_"---- CONFLICT LOCATIONS ----"
"RTN","DGRP6CL",76,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=$J("",34)_"FROM"_$J("",9)_"TO"_$J("",7)_"SOURCE (FOR OEF/OIF)"
"RTN","DGRP6CL",77,0)
 ; DGCONF(DGCONF,"OK")=# entries for OEF/OIF/ UNKNOWN OEF/OIF
"RTN","DGRP6CL",78,0)
 ;                     that are site-entered
"RTN","DGRP6CL",79,0)
 ; DGCONF(DGCONF,"OK",entry ien)=display #^formatted from dt^
"RTN","DGRP6CL",80,0)
 ;       formatted to dt^inconsistent flag (valid entries for editing)
"RTN","DGRP6CL",81,0)
 S DGEG=0
"RTN","DGRP6CL",82,0)
 F DGEGS=2,1,3 D
"RTN","DGRP6CL",83,0)
 . S DGCONF=$P("OIF^OEF^UNK",U,DGEGS),DGM=0
"RTN","DGRP6CL",84,0)
 . S DG=$$ISVALID^DGRP6CL2(.DGCONF,.DGPOSS)
"RTN","DGRP6CL",85,0)
 . S DGEG=DGEG+1
"RTN","DGRP6CL",86,0)
 . S DGDISP=$S(DGCONF'="UNK":$J("",8),1:"OEF/OIF ")_DGCONF_": "
"RTN","DGRP6CL",87,0)
 . S DGCT=DGCT+1,DGCTX=DGCT S DIR("A",DGCT)="   "_$E(DG,1)_DGEG_$E(DG,2)_"  -"_DGDISP_$$YN($S(DGCONF(DGCONF):"Y",'$D(^DPT(DFN,.3215,0)):"",1:"N"),1)
"RTN","DGRP6CL",88,0)
 . I $G(DGCONF(DGCONF))!$D(DGPOSS(DGCONF)) I '$G(DGRPV),$G(DGCONF(DGCONF,"VEDIT"))'=2,'$G(DGCONF(DGCONF,"NOEDIT")) S:DGCONF'="UNK" DIR(0)=DIR(0)_DGEG_":"_DGCONF_";"
"RTN","DGRP6CL",89,0)
 . S (DGZ,DGCONFS)=DGCONF F  S DGCONFS=$O(DGCONFS(DGCONFS)) Q:DGCONFS=""!(DGCONFS'[DGZ)  D
"RTN","DGRP6CL",90,0)
 .. N DGUN,DGIEN,STA
"RTN","DGRP6CL",91,0)
 .. S DGIEN=DGCONFS(DGCONFS),DGCONF=DGZ_"-"_DGIEN,DGCONF1=DGZ,DGM=DGM+1
"RTN","DGRP6CL",92,0)
 .. I $G(DGCONF(DGCONF,1)),DGCTX S $E(DIR("A",DGCTX),1,3)="***"
"RTN","DGRP6CL",93,0)
 .. S DG=$$ISVALID^DGRP6CL2(.DGCONF,.DGPOSS)
"RTN","DGRP6CL",94,0)
 .. S DGUN=$S($G(DGCONF(DGCONF,"NOEDIT")):1,1:0)
"RTN","DGRP6CL",95,0)
 .. I 'DGUN S DGCONF(DGCONF1,"OK")=$G(DGCONF(DGCONF1,"OK"))+1,DGCONF(DGCONF1,"OK",DGIEN)=DGM_U_$$FMTE^XLFDT($P(DGCONF(DGCONF),U),"5DZ")_U_$$FMTE^XLFDT($P(DGCONF(DGCONF),U,2),"5DZ")
"RTN","DGRP6CL",96,0)
 .. I DGM>1 S DGCT=DGCT+1
"RTN","DGRP6CL",97,0)
 .. S DIR("A",DGCT)=$S(DGM>1:$J("",27-$L(DGM)),1:DIR("A",DGCT)_" ")_"("_DGM_")  "_$E($$DAT(DGCONF(DGCONF),1,13)_$J("",12),1,12)_$E($$DAT(DGCONF(DGCONF),2,11)_$J("",10),1,10)_"   "
"RTN","DGRP6CL",98,0)
 .. S STA=$P(DGCONF(DGCONF),U,3)
"RTN","DGRP6CL",99,0)
 .. S:STA STA=$P($G(^DIC(4,+STA,99)),U)
"RTN","DGRP6CL",100,0)
 .. S DIR("A",DGCT)=DIR("A",DGCT)_$S($P(DGCONF(DGCONF),U,3)="CEV":"",1:"Station #")_$E(STA_$J("",$S('DGUN:6,1:3)),1,$S('DGUN:6,1:3))
"RTN","DGRP6CL",101,0)
 .. I DGUN S DIR("A",DGCT)=DIR("A",DGCT)_" (No Edit)"
"RTN","DGRP6CL",102,0)
 D LOOPCNF^DGRP6CL1(.DGCONF,.DGPOSS,.DIR)
"RTN","DGRP6CL",103,0)
 S DGCT=DGCT+1,DIR("A",DGCT)=" "
"RTN","DGRP6CL",104,0)
 I $G(DGMSG) S DGCT=DGCT+1,DIR("A",DGCT)="*** ==>OEF/OIF Dates are inconsistent with veteran's military service episodes"
"RTN","DGRP6CL",105,0)
 S DIR("A")="SELECT THE NUMBER OF A CONFLICT LOCATION OR (Q)UIT: "
"RTN","DGRP6CL",106,0)
 S DIR(0)=DIR(0)_"Q:QUIT"
"RTN","DGRP6CL",107,0)
 S DIR("?")="^D HELP^DGRP6CL1($P(DIR(0),U,2))"
"RTN","DGRP6CL",108,0)
 S DIR("B")="QUIT"
"RTN","DGRP6CL",109,0)
 D ^DIR K DIR
"RTN","DGRP6CL",110,0)
 I $D(DUOUT)!$D(DTOUT)!(Y="Q") S:Y'="Q" QUIT=1 G QUIT
"RTN","DGRP6CL",111,0)
 S DGY=Y,DGY1=$S(Y=2:1,Y=1:2,1:Y)
"RTN","DGRP6CL",112,0)
 I DGY<4 S DGCONF=""
"RTN","DGRP6CL",113,0)
 I DGY'<4 D
"RTN","DGRP6CL",114,0)
 . S DGCONF=$P("OEF^OIF^UNK^VIET^LEB^GREN^PAN^GULF^SOM^YUG",U,DGY)
"RTN","DGRP6CL",115,0)
 . I $G(DGCONF(DGCONF,1)) W !!,"WARNING - THIS CONFLICT IS INCONSISTENT WITH MILITARY SERVICE DATA",!
"RTN","DGRP6CL",116,0)
 . S DIE=2,DA=DFN,DR=$P($T(@DGCONF),";;",2) D:DR'="" ^DIE K DIE,DA,DR
"RTN","DGRP6CL",117,0)
 I DGY=1!(DGY=2) D
"RTN","DGRP6CL",118,0)
 . S DGCONF=$P("OEF^OIF",U,DGY)
"RTN","DGRP6CL",119,0)
 . I '$G(DGCONF(DGCONF,"OK")),$G(DGCONF(DGCONF,"VEDIT"))'=2 D ADDCFL^DGRP6CL1(DFN,DGY1,DGCONF) Q  ; Add new only valid action
"RTN","DGRP6CL",120,0)
 . I $G(DGCONF(DGCONF,"VEDIT"))=1 S DIR("A")="DO YOU WANT TO (A)DD OR (E)DIT "_DGCONF_" CONFLICT DATA?: ",DIR(0)="SA^A:ADD;E:EDIT",DIR("B")="ADD" D ^DIR K DIR
"RTN","DGRP6CL",121,0)
 . I $G(DGCONF(DGCONF,"VEDIT"))=2,$G(DGCONF(DGCONF,"OK")) S DIR("A")="DO YOU WANT TO EDIT "_DGCONF_" CONFLICT DATA?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR S Y=$S(Y=1:"E",1:Y)
"RTN","DGRP6CL",122,0)
 . Q:$D(DTOUT)!$D(DUOUT)
"RTN","DGRP6CL",123,0)
 . I Y="A" D ADDCFL^DGRP6CL1(DFN,DGY1,DGCONF) Q
"RTN","DGRP6CL",124,0)
 . I Y="E" D
"RTN","DGRP6CL",125,0)
 .. N DGXREF,IEN,DIR,X,Y
"RTN","DGRP6CL",126,0)
 .. I DGCONF(DGCONF,"OK")=1 S IEN=+$O(DGCONF(DGCONF,"OK",0)) I IEN D EDCFL^DGRP6CL1(DFN,IEN,$G(DGCONF(DGCONF,"VEDIT"))) Q
"RTN","DGRP6CL",127,0)
 .. S DIR(0)="SA^",DIR("A")="SELECT THE # OF THE "_DGCONF_" CONFLICT PERIOD TO EDIT: ",DIR("A",1)=" "
"RTN","DGRP6CL",128,0)
 .. S Z=0 F  S Z=$O(DGCONF(DGCONF,"OK",Z)) Q:'Z  S Z0=DGCONF(DGCONF,"OK",Z),DIR(0)=DIR(0)_+Z0_":"_$P(Z0,U,2)_$S($P(Z0,U,3)'="":"-"_$P(Z0,U,3),1:"")_";",DGXREF(+Z0)=Z
"RTN","DGRP6CL",129,0)
 .. S DIR(0)=DIR(0)_"Q:QUIT"
"RTN","DGRP6CL",130,0)
 .. D ^DIR K DIR
"RTN","DGRP6CL",131,0)
 .. I Y D EDCFL^DGRP6CL1(DFN,+$G(DGXREF(+Y)),$G(DGCONF(DGCONF,"VEDIT")))
"RTN","DGRP6CL",132,0)
 G EN1
"RTN","DGRP6CL",133,0)
 ;
"RTN","DGRP6CL",134,0)
QUIT Q
"RTN","DGRP6CL",135,0)
 ;
"RTN","DGRP6CL",136,0)
EN2 ; Consistency checker re-edit entrypoint for OEF/OIF data
"RTN","DGRP6CL",137,0)
 N DGOEIF,DGZ,DGQUIT,Z,Z0,Y
"RTN","DGRP6CL",138,0)
 D GET^DGENOEIF(DFN,.DGOEIF,2,"",1)
"RTN","DGRP6CL",139,0)
 I $G(DGOEIF("COUNT"))&($O(DGOEIF("OIF",0))!$O(DGOEIF("OEF",0))) D
"RTN","DGRP6CL",140,0)
 . F Z="OEF","OIF" S Z0=0 F  S Z0=$O(DGOEIF(Z,Z0)) Q:'Z0  I $G(DGOEIF(Z,Z0,"IEN")) S DGZ(DGOEIF(Z,Z0,"IEN"))=""
"RTN","DGRP6CL",141,0)
 . S (DGQUIT,DGZ)=0 F  S DGZ=$O(DGZ(DGZ)) Q:'DGZ  D  Q:DGQUIT
"RTN","DGRP6CL",142,0)
 .. N DGX,DA,DIE,DR,X
"RTN","DGRP6CL",143,0)
 .. S DGX=$G(^DPT(DFN,.3215,DGZ,0))
"RTN","DGRP6CL",144,0)
 .. W !!,"OEF/OIF CONFLICT: ",$$EXTERNAL^DILFD(2.3215,.01,"",$P(DGX,U)),"  FROM: "_$$EXTERNAL^DILFD(2.3215,.02,"",$P(DGX,U,2)),"  TO: "_$$EXTERNAL^DILFD(2.3215,.03,"",$P(DGX,U,3))
"RTN","DGRP6CL",145,0)
 .. S DA=DGZ,DA(1)=DFN,DIE="^DPT("_DA(1)_",.3215,",DR=".01;.02R;.03R" D ^DIE I $D(Y) S DGQUIT=1
"RTN","DGRP6CL",146,0)
 Q
"RTN","DGRP6CL",147,0)
 ;
"RTN","DGRP6CL",148,0)
SVCCOMP(X) ; Returns display text for service component
"RTN","DGRP6CL",149,0)
 Q $S(X="R":"REGULAR",X="V":"RESERVE",X="G":"GUARD",1:"")
"RTN","DGRP6CL",150,0)
 ;
"RTN","DGRP6CL",151,0)
VIET ;;.32101//NO;S:X'="Y" Y="@64";.32104;.32105;@64;
"RTN","DGRP6CL",152,0)
LEB ;;.3221//NO;S:X'="Y" Y="@67";.3222;Q;.3223;@67;
"RTN","DGRP6CL",153,0)
GREN ;;.3224//NO;S:X'="Y" Y="@68";.3225;Q;.3226;@68;
"RTN","DGRP6CL",154,0)
PAN ;;.3227//NO;S:X'="Y" Y="@69";.3228;Q;.3229;@69;
"RTN","DGRP6CL",155,0)
GULF ;;.32201//NO;S:X'="Y" Y="@610";.322011;Q;.322012;@610;
"RTN","DGRP6CL",156,0)
SOM ;;.322016//NO;S:X'="Y" Y="@611";.322017;Q;.322018;@611;
"RTN","DGRP6CL",157,0)
YUG ;;.322019//NO;S:X'="Y" Y="@615";.32202;Q;.322021;@615;
"RTN","DGRP6CL",158,0)
OEF ;;
"RTN","DGRP6CL",159,0)
OIF ;;
"RTN","DGRP6CL",160,0)
UNK ;;
"RTN","DGRP6CL",161,0)
 ;;
"RTN","DGRP6CL1")
0^1^B35133864^B35021800
"RTN","DGRP6CL1",1,0)
DGRP6CL1 ;ALB/TMK - REGISTRATION SCREEN 6 FLDS Conflict loc (cont) ; 09/15/2005
"RTN","DGRP6CL1",2,0)
 ;;5.3;Registration;**689,764**;Aug 13, 1993;Build 16
"RTN","DGRP6CL1",3,0)
 ;
"RTN","DGRP6CL1",4,0)
DELCFL(DFN) ; Delete all existing OEF/OIF episodes for a patient
"RTN","DGRP6CL1",5,0)
 ; DFN = patient ien
"RTN","DGRP6CL1",6,0)
 N DA,DIK,X,Y,DG
"RTN","DGRP6CL1",7,0)
 S DG=0 F  S DG=$O(^DPT(DFN,.3215,DG)) Q:'DG  I $G(^(DG,0))'="" S DA(1)=DFN,DA=DG,DIK="^DPT("_DA(1)_",.3215," D ^DIK
"RTN","DGRP6CL1",8,0)
 Q
"RTN","DGRP6CL1",9,0)
 ;
"RTN","DGRP6CL1",10,0)
EDCFL(DFN,IEN,VEDIT) ; Edit OEF/OIF conflict from/to dates only or delete entry
"RTN","DGRP6CL1",11,0)
 N DIE,DA,X,Y,DR,DIPA
"RTN","DGRP6CL1",12,0)
 I $G(VEDIT)=2 W !!,"WARNING - THIS CONFLICT IS INCONSISTENT WITH MILITARY SERVICE DATA",!
"RTN","DGRP6CL1",13,0)
 Q:$P($G(^DPT(DFN,.3215,IEN,0)),U,4)
"RTN","DGRP6CL1",14,0)
 S DIPA(.01)=+$G(^DPT(DFN,.3215,IEN,0))
"RTN","DGRP6CL1",15,0)
 S DA(1)=DFN,DA=IEN,DIE="^DPT("_DA(1)_",.3215,",DR=".05///NOW;@10;.01;I X'=DIPA(.01) S Y=""@50"";.02R;.03R;S Y=""@99"";@50;D NOCHG^DGRP6CL1;.01////"_$G(DIPA(.01))_";S Y=""@10"";@99"
"RTN","DGRP6CL1",16,0)
 D ^DIE
"RTN","DGRP6CL1",17,0)
 Q
"RTN","DGRP6CL1",18,0)
 ;
"RTN","DGRP6CL1",19,0)
ADDCFL(DFN,DGY,DGCONF,SRC) ; Add a new OEF/OIF conflict entry
"RTN","DGRP6CL1",20,0)
 ; DFN = patient ien
"RTN","DGRP6CL1",21,0)
 ; DGY = 1 for OIF, 2 for OEF, 3 for UNKNOWN OEF/OIF
"RTN","DGRP6CL1",22,0)
 ; DGCONF = the conflict record being added (OEF/OIF/ UNKNOWN OEF/OIF)
"RTN","DGRP6CL1",23,0)
 ; SRC = 1 if HEC data (locked) or 0 if site entered
"RTN","DGRP6CL1",24,0)
 ;   If SRC is passed by reference, it must contain the values needed
"RTN","DGRP6CL1",25,0)
 ;   to 'stuff' a new record into the file at the fld # subscript level
"RTN","DGRP6CL1",26,0)
 ;   SRC(.02)=from dt  SRC(.03)=to dt  SRC(.04)=1 if HEC source of data
"RTN","DGRP6CL1",27,0)
 ;   SRC("OK") is returned as 1 if filing was successful or as the
"RTN","DGRP6CL1",28,0)
 ;       reason why the data was not filed if unsuccessful
"RTN","DGRP6CL1",29,0)
 ;
"RTN","DGRP6CL1",30,0)
 N DGFORCE,DIC,DA,DO,DD,X,Y,DIR,DIK,Z0
"RTN","DGRP6CL1",31,0)
 S DGFORCE=$S($O(SRC("")):1,1:0)
"RTN","DGRP6CL1",32,0)
 I DGFORCE,('$G(SRC(.01))!'$G(SRC(.02))!'$G(SRC(.03))) S SRC("OK")="MISSING DATA" Q
"RTN","DGRP6CL1",33,0)
 S X=DGY,DIC("DR")=".05///NOW;.04////"_+$G(SRC)
"RTN","DGRP6CL1",34,0)
 Q:'X
"RTN","DGRP6CL1",35,0)
 I 'DGFORCE D
"RTN","DGRP6CL1",36,0)
 . W !!,"Adding NEW "_DGCONF_" conflict data ...",!
"RTN","DGRP6CL1",37,0)
 . S DIC("DR")=DIC("DR")_";.06////"_$S($G(DUZ(2)):DUZ(2),1:+$$SITE^VASITE())_";.02R;.03R"
"RTN","DGRP6CL1",38,0)
 ;
"RTN","DGRP6CL1",39,0)
 I DGFORCE D
"RTN","DGRP6CL1",40,0)
 . S DIC("DR")=DIC("DR")_";.02///"_SRC(.02)_";.03///"_SRC(.03)
"RTN","DGRP6CL1",41,0)
 ;
"RTN","DGRP6CL1",42,0)
 S DIC(0)="L",DA(1)=DFN,DIC="^DPT("_DA(1)_",.3215," K DO,DD D FILE^DICN
"RTN","DGRP6CL1",43,0)
 S Z0=$G(^DPT(DFN,.3215,+Y,0))
"RTN","DGRP6CL1",44,0)
 I Z0'="",'$P(Z0,U,2)!'$P(Z0,U,3) D  Q
"RTN","DGRP6CL1",45,0)
 . S DA=+Y,DA(1)=DFN,DIK="^DPT("_DA(1)_",.3215," D ^DIK
"RTN","DGRP6CL1",46,0)
 . I DGFORCE S SRC("OK")="DATA NOT FILED - BAD DATA"
"RTN","DGRP6CL1",47,0)
 . I 'DGFORCE S DIR("A",1)="BAD DATA ENCOUNTERED.  NO NEW CONFLICT DATA FILED.",DIR("A")="PRESS RETURN TO CONTINUE: ",DIR(0)="EA" D ^DIR K DIR
"RTN","DGRP6CL1",48,0)
 I DGFORCE,'$D(SRC("OK")) S SRC("OK")=1
"RTN","DGRP6CL1",49,0)
 Q
"RTN","DGRP6CL1",50,0)
 ;
"RTN","DGRP6CL1",51,0)
CKDT(DGCONF,DGMSE,DGPOSS) ; Check dates for conflict in DGCONF(DGCONF)=
"RTN","DGRP6CL1",52,0)
 ; fr date^to date are valid against military service episodes (DGMSE)
"RTN","DGRP6CL1",53,0)
 ; for the patient and if no dates, if the MSE's would support that
"RTN","DGRP6CL1",54,0)
 ; conflict being entered.
"RTN","DGRP6CL1",55,0)
 ; Assume DFN exists
"RTN","DGRP6CL1",56,0)
 ; FUNCTION returns
"RTN","DGRP6CL1",57,0)
 ;     DGCONF(DGCONF,1)=1 if MSE inconsistency found,0 if none
"RTN","DGRP6CL1",58,0)
 ;     Also returns DGPOSS(DGCONF) if patient has no dates for the
"RTN","DGRP6CL1",59,0)
 ;       conflict, but the MSE's indicate entry of the conflict would
"RTN","DGRP6CL1",60,0)
 ;       not be inconsistent.
"RTN","DGRP6CL1",61,0)
 ;
"RTN","DGRP6CL1",62,0)
 N Z,CRNG,DGOK,FAIL
"RTN","DGRP6CL1",63,0)
 S CRNG=$$GETCNFDT^DGRPDT(DGCONF)
"RTN","DGRP6CL1",64,0)
 I $TR($G(DGCONF(DGCONF)),U)="" D  Q  ; Conflict pd not prev entered
"RTN","DGRP6CL1",65,0)
 . S:$S(DGCONF="OEF"!(DGCONF="OIF")!(DGCONF="UNK"):0,1:1) DGCONF(DGCONF)=""
"RTN","DGRP6CL1",66,0)
 . ; Check if conflict period COULD be valid based on MSE
"RTN","DGRP6CL1",67,0)
 . S Z=0 F  S Z=$O(DGMSE(Z)) Q:'Z  D  Q:$D(DGPOSS(DGCONF))
"RTN","DGRP6CL1",68,0)
 .. I $S($P(DGMSE(Z),U)>$P(CRNG,U,2):1,$P(DGMSE(Z),U,2)<$P(CRNG,U):1,1:0) Q  ; Not within valid for the mil svc pd for pt
"RTN","DGRP6CL1",69,0)
 .. S DGPOSS(DGCONF)=""
"RTN","DGRP6CL1",70,0)
 . ;
"RTN","DGRP6CL1",71,0)
 S DGOK=1
"RTN","DGRP6CL1",72,0)
 I $O(DGMSE(""))="" S DGOK=0,FAIL=1
"RTN","DGRP6CL1",73,0)
 I DGOK F Z=0,1 I '$$VALCON^DGRPMS(DFN,DGCONF,$S($P(DGCONF(DGCONF),U,Z+1):$P(DGCONF(DGCONF),U,Z+1),1:DT),Z,.FAIL) S DGOK=0 Q
"RTN","DGRP6CL1",74,0)
 S DGCONF(DGCONF,1)=$S(DGOK:"",$G(FAIL):1,1:0) ; MSE Inconsistency flag
"RTN","DGRP6CL1",75,0)
 ;
"RTN","DGRP6CL1",76,0)
 Q
"RTN","DGRP6CL1",77,0)
 ;
"RTN","DGRP6CL1",78,0)
NOCHG ;Only from,to dates can be chged on locally entered OEF/OIF conflict data
"RTN","DGRP6CL1",79,0)
 N DIR,X,Y
"RTN","DGRP6CL1",80,0)
 S DIR("A",1)="You may not change this field - but you may delete it",DIR("A")="Press RETURN to continue ",DIR(0)="EA" W ! D ^DIR K DIR W !
"RTN","DGRP6CL1",81,0)
 Q
"RTN","DGRP6CL1",82,0)
 ;
"RTN","DGRP6CL1",83,0)
HELP(SET) ;Help text for reader prompt for conflict to add/edit/delete
"RTN","DGRP6CL1",84,0)
 N Z,Z0
"RTN","DGRP6CL1",85,0)
 W !!,"Those conflicts with a number enclosed in brackets ""[]"" are valid",!,"for the veteran while those enclosed in arrows ""<>"" are not.",!
"RTN","DGRP6CL1",86,0)
 W !,$J("",5),"Select one of the following:",!
"RTN","DGRP6CL1",87,0)
 F Z=1:1:$L(SET,";") S Z0=$P(SET,";",Z) I Z0'="" W !,$J("",15),$E($P(Z0,":")_$J("",10),1,10)_$P(Z0,":",2)
"RTN","DGRP6CL1",88,0)
 W !
"RTN","DGRP6CL1",89,0)
 N DIR,X,Y
"RTN","DGRP6CL1",90,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR
"RTN","DGRP6CL1",91,0)
 Q
"RTN","DGRP6CL1",92,0)
 ;
"RTN","DGRP6CL1",93,0)
LOOPCNF(DGCONF,DGPOSS,DIR) ; Loop thru non-OEF/OIF conflicts
"RTN","DGRP6CL1",94,0)
 ; DGCONF,DGPOSS = arrays from DGRP6CL containing conflict data
"RTN","DGRP6CL1",95,0)
 ; Returns DIR array for screen display of conflicts
"RTN","DGRP6CL1",96,0)
 N LOOP,DGX,DGX1
"RTN","DGRP6CL1",97,0)
 S DGX="VIET;4;Vietnam^LEB;5;Lebanon^GREN;6;Grenada^PAN;7;Panama^GULF;8;Gulf War^SOM;9;Somalia^YUG;10;Yugoslavia"
"RTN","DGRP6CL1",98,0)
 F LOOP=1:1 Q:$P(DGX,U,LOOP)=""  S DGX1=$P(DGX,U,LOOP) D
"RTN","DGRP6CL1",99,0)
 . S DGCONF=$P(DGX1,";"),DG=$$ISVALID^DGRP6CL2(.DGCONF,.DGPOSS) I $G(DGCONF(DGCONF,"VEDIT")) S DIR(0)=DIR(0)_$P(DGX1,";",2)_":"_$P(DGX1,";",3)_";"
"RTN","DGRP6CL1",100,0)
 . S DGCT=DGCT+1,DIR("A",DGCT)=$S($G(DGCONF(DGCONF,1)):"***",1:"   ")_$E(DG,1)_$P(DGX1,";",2)_$E(DG,2)_$S($L($P(DGX1,";",2))<2:" ",1:"")_" -"_$J("",11-$L($P(DGX1,";",3)))_$P(DGX1,";",3)_": "
"RTN","DGRP6CL1",101,0)
 . I $P(DGX1,";",2)=4 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG321,1)_$J("",6)_$E($$DAT^DGRP6CL(DG321,4,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG321,5,11)_$J("",12),1,12)
"RTN","DGRP6CL1",102,0)
 . I $P(DGX1,";",2)=5 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,1)_$J("",6)_$E($$DAT^DGRP6CL(DG322,2,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,3,11)_$J("",12),1,12)
"RTN","DGRP6CL1",103,0)
 . I $P(DGX1,";",2)=6 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,4)_$J("",6)_$E($$DAT^DGRP6CL(DG322,5,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,6,11)_$J("",12),1,12)
"RTN","DGRP6CL1",104,0)
 . I $P(DGX1,";",2)=7 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,7)_$J("",6)_$E($$DAT^DGRP6CL(DG322,8,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,9,11)_$J("",12),1,12)
"RTN","DGRP6CL1",105,0)
 . I $P(DGX1,";",2)=8 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,10)_$J("",6)_$E($$DAT^DGRP6CL(DG322,11,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,12,11)_$J("",12),1,12)
"RTN","DGRP6CL1",106,0)
 . I $P(DGX1,";",2)=9 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,16)_$J("",6)_$E($$DAT^DGRP6CL(DG322,17,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,18,11)_$J("",12),1,12)
"RTN","DGRP6CL1",107,0)
 . I $P(DGX1,";",2)=10 S DIR("A",DGCT)=DIR("A",DGCT)_$$YN^DGRP6CL(DG322,19)_$J("",6)_$E($$DAT^DGRP6CL(DG322,20,13)_$J("",12),1,12)_$E($$DAT^DGRP6CL(DG322,21,11)_$J("",12),1,12)
"RTN","DGRP6CL1",108,0)
 ;
"RTN","DGRP6CL1",109,0)
 Q
"RTN","DGRP6CL1",110,0)
 ;
"VER")
8.0^22.0
"BLD",7202,6)
^675
**END**
**END**
