Released DG*5.3*560 SEQ #496
Extracted from mail message
**KIDS**:DG*5.3*560^

**INSTALL NAME**
DG*5.3*560
"BLD",4628,0)
DG*5.3*560^REGISTRATION^0^3031210^y
"BLD",4628,4,0)
^9.64PA^2^1
"BLD",4628,4,2,0)
2
"BLD",4628,4,2,2,0)
^9.641^2^1
"BLD",4628,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",4628,4,2,2,2,1,0)
^9.6411^.121^1
"BLD",4628,4,2,2,2,1,.121,0)
BAD ADDRESS INDICATOR
"BLD",4628,4,2,222)
y^n^p^^^^n^^n
"BLD",4628,4,2,224)

"BLD",4628,4,"APDD",2,2)

"BLD",4628,4,"APDD",2,2,.121)

"BLD",4628,4,"B",2,2)

"BLD",4628,"KRN",0)
^9.67PA^8989.52^19
"BLD",4628,"KRN",.4,0)
.4
"BLD",4628,"KRN",.401,0)
.401
"BLD",4628,"KRN",.402,0)
.402
"BLD",4628,"KRN",.403,0)
.403
"BLD",4628,"KRN",.5,0)
.5
"BLD",4628,"KRN",.84,0)
.84
"BLD",4628,"KRN",3.6,0)
3.6
"BLD",4628,"KRN",3.8,0)
3.8
"BLD",4628,"KRN",9.2,0)
9.2
"BLD",4628,"KRN",9.8,0)
9.8
"BLD",4628,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4628,"KRN",9.8,"NM",1,0)
DGREGAED^^0^B16329835
"BLD",4628,"KRN",9.8,"NM",2,0)
DGREGAZL^^0^B31405472
"BLD",4628,"KRN",9.8,"NM",3,0)
DGREGARP^^0^B83832281
"BLD",4628,"KRN",9.8,"NM","B","DGREGAED",1)

"BLD",4628,"KRN",9.8,"NM","B","DGREGARP",3)

"BLD",4628,"KRN",9.8,"NM","B","DGREGAZL",2)

"BLD",4628,"KRN",19,0)
19
"BLD",4628,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4628,"KRN",19,"NM",1,0)
DG ALL ADDRESS CHANGE WITH RX^^0
"BLD",4628,"KRN",19,"NM",2,0)
DG REGISTRATION MENU^^2
"BLD",4628,"KRN",19,"NM","B","DG ALL ADDRESS CHANGE WITH RX",1)

"BLD",4628,"KRN",19,"NM","B","DG REGISTRATION MENU",2)

"BLD",4628,"KRN",19.1,0)
19.1
"BLD",4628,"KRN",101,0)
101
"BLD",4628,"KRN",409.61,0)
409.61
"BLD",4628,"KRN",771,0)
771
"BLD",4628,"KRN",870,0)
870
"BLD",4628,"KRN",8989.51,0)
8989.51
"BLD",4628,"KRN",8989.52,0)
8989.52
"BLD",4628,"KRN",8994,0)
8994
"BLD",4628,"KRN","B",.4,.4)

"BLD",4628,"KRN","B",.401,.401)

"BLD",4628,"KRN","B",.402,.402)

"BLD",4628,"KRN","B",.403,.403)

"BLD",4628,"KRN","B",.5,.5)

"BLD",4628,"KRN","B",.84,.84)

"BLD",4628,"KRN","B",3.6,3.6)

"BLD",4628,"KRN","B",3.8,3.8)

"BLD",4628,"KRN","B",9.2,9.2)

"BLD",4628,"KRN","B",9.8,9.8)

"BLD",4628,"KRN","B",19,19)

"BLD",4628,"KRN","B",19.1,19.1)

"BLD",4628,"KRN","B",101,101)

"BLD",4628,"KRN","B",409.61,409.61)

"BLD",4628,"KRN","B",771,771)

"BLD",4628,"KRN","B",870,870)

"BLD",4628,"KRN","B",8989.51,8989.51)

"BLD",4628,"KRN","B",8989.52,8989.52)

"BLD",4628,"KRN","B",8994,8994)

"BLD",4628,"QUES",0)
^9.62^^
"BLD",4628,"REQB",0)
^9.611^1^1
"BLD",4628,"REQB",1,0)
DG*5.3*522^2
"BLD",4628,"REQB","B","DG*5.3*522",1)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^n^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.121)

"KRN",19,185,-1)
2^2
"KRN",19,185,0)
DG REGISTRATION MENU^Registration Menu^^M^.5^^^^^^^5^y
"KRN",19,185,10,0)
^19.01IP^34^27
"KRN",19,185,10,34,0)
11273
"KRN",19,185,10,34,"^")
DG ALL ADDRESS CHANGE WITH RX
"KRN",19,185,"U")
REGISTRATION MENU
"KRN",19,11273,-1)
0^1
"KRN",19,11273,0)
DG ALL ADDRESS CHANGE WITH RX^Report - All Address Change with Rx^^R^^^^^^^^REGISTRATION
"KRN",19,11273,1,0)
^^1^1^3031023^
"KRN",19,11273,1,1,0)
This report lists changes to any patient primary address fields for the previous 24 hours, for those patient with active pharmacy prescription.
"KRN",19,11273,25)
EN^DGREGARP("RX")
"KRN",19,11273,200.9)
y
"KRN",19,11273,"U")
REPORT - ALL ADDRESS CHANGE WI
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
560^3031210
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGREGAED")
0^1^B16329835
"RTN","DGREGAED",1,0)
DGREGAED ;ALB/DW - Address Edit API; 6/2/2003
"RTN","DGREGAED",2,0)
 ;;5.3;Registration;**522,560**;Aug 13, 1993
"RTN","DGREGAED",3,0)
EN(DFN,FLG) ;Entry point
"RTN","DGREGAED",4,0)
 ;Input: 
"RTN","DGREGAED",5,0)
 ;  DFN (required) - Interal Entry # of Patient File (#2)
"RTN","DGREGAED",6,0)
 ;  FLG (optional) - Flags of 1 or 0; if null, 0 is assumed. Details:
"RTN","DGREGAED",7,0)
 ;    FLG(1) - if 1, let user edit phone numbers (field #.131 and #.132)
"RTN","DGREGAED",8,0)
 ;    FLG(2) - if 1, dispaly before & after address for user confirmation
"RTN","DGREGAED",9,0)
 K EASZIPLK
"RTN","DGREGAED",10,0)
 N DGINPUT
"RTN","DGREGAED",11,0)
 N I,X,Y
"RTN","DGREGAED",12,0)
 I $G(DFN)="" Q
"RTN","DGREGAED",13,0)
 I ($G(DFN)'?.N) Q
"RTN","DGREGAED",14,0)
 S FLG(1)=$G(FLG(1)),FLG(2)=$G(FLG(2))
"RTN","DGREGAED",15,0)
 D INPUT(.DGINPUT,DFN)
"RTN","DGREGAED",16,0)
 I $G(DGINPUT)=-1 Q
"RTN","DGREGAED",17,0)
 I $G(FLG(2))=1 D COMPARE(.DGINPUT,DFN)
"RTN","DGREGAED",18,0)
 I '$$CONFIRM() W !,"Change aborted." D EOP Q
"RTN","DGREGAED",19,0)
 D SAVE(.DGINPUT,DFN)
"RTN","DGREGAED",20,0)
 Q
"RTN","DGREGAED",21,0)
INPUT(DGINPUT,DFN) ;Let user input address changes
"RTN","DGREGAED",22,0)
 ;Output: DGINPUT(field#)=external^internal(if any)
"RTN","DGREGAED",23,0)
 N DIR,X,Y,DA,DGR,DTOUT,DUOUT,DIROUT,DGN,POP
"RTN","DGREGAED",24,0)
 S POP=0
"RTN","DGREGAED",25,0)
 F DGN=.111,.112,.113,.1112,.131,.132,.121 Q:POP  D
"RTN","DGREGAED",26,0)
 . I ($G(DGINPUT(.111))="")&((DGN=.112)!(DGN=.113)) Q
"RTN","DGREGAED",27,0)
 . I ($G(DGINPUT(.112))="")&(DGN=.113) Q
"RTN","DGREGAED",28,0)
 . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q
"RTN","DGREGAED",29,0)
 . I DGN=.1112 D  Q
"RTN","DGREGAED",30,0)
 .. D EN^DGREGAZL(.DGR,DFN)
"RTN","DGREGAED",31,0)
 .. I $G(DGR)=-1 S POP=1 Q
"RTN","DGREGAED",32,0)
 .. N DGM F DGM=.1112,.114,.115,.117 S DGINPUT(DGM)=$G(DGR(DGM))
"RTN","DGREGAED",33,0)
AGN . S DIR(0)=2_","_DGN
"RTN","DGREGAED",34,0)
 . S DA=DFN
"RTN","DGREGAED",35,0)
 . D ^DIR
"RTN","DGREGAED",36,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAED",37,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT G AGN
"RTN","DGREGAED",38,0)
 . I DGN'=.121 S DGINPUT(DGN)=$G(Y)
"RTN","DGREGAED",39,0)
 . I DGN=.121 D
"RTN","DGREGAED",40,0)
 .. I $P($G(Y),U)=$$GET1^DIQ(2,DFN_",",DGN,"I") D
"RTN","DGREGAED",41,0)
 ... S DGINPUT(DGN)=$$GET1^DIQ(2,DFN_",",DGN)_U_$P($G(Y),U)
"RTN","DGREGAED",42,0)
 .. I $P($G(Y),U)'=$$GET1^DIQ(2,DFN_",",DGN,"I") D
"RTN","DGREGAED",43,0)
 ... S DGINPUT(DGN)=$P($G(Y(0)),U)_U_$G(Y)
"RTN","DGREGAED",44,0)
 I $G(POP)=1 S DGINPUT=-1
"RTN","DGREGAED",45,0)
 Q
"RTN","DGREGAED",46,0)
COMPARE(DGINPUT,DFN) ;Display before & after address fileds.
"RTN","DGREGAED",47,0)
 N DGCURR,DGN,DGCMP,DGM,DGCNTY,DGCIEN,DGST
"RTN","DGREGAED",48,0)
 D GETS^DIQ(2,DFN_",",".111;.112;.113;.114;.115;.117;.1112;.131;.132;.121","EI","DGCURR")
"RTN","DGREGAED",49,0)
 F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.121 D
"RTN","DGREGAED",50,0)
 . S DGCMP("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"E"))
"RTN","DGREGAED",51,0)
 S DGCIEN=$G(DGCURR(2,DFN_",",.117,"I"))
"RTN","DGREGAED",52,0)
 S DGST=$G(DGCURR(2,DFN_",",.115,"I"))
"RTN","DGREGAED",53,0)
 S DGCNTY=$$CNTY^DGREGAZL(DGST,DGCIEN)
"RTN","DGREGAED",54,0)
 I DGCNTY=-1 S DGCNTY=""
"RTN","DGREGAED",55,0)
 S DGCMP("OLD",.117)=$P(DGCNTY,U)_" "_$P(DGCNTY,U,3)
"RTN","DGREGAED",56,0)
 M DGCMP("NEW")=DGINPUT
"RTN","DGREGAED",57,0)
 S DGCNTY=$P($G(DGCMP("NEW",.117)),U)_" "_$P($G(DGCMP("NEW",.117)),U,3)
"RTN","DGREGAED",58,0)
 S DGCMP("NEW",.117)=DGCNTY
"RTN","DGREGAED",59,0)
 I ($L(DGCMP("NEW",.1112))>5)&($P(DGCMP("NEW",.1112),"-",2)="") S DGCMP("NEW",.1112)=$E(DGCMP("NEW",.1112),1,5)_"-"_$E(DGCMP("NEW",.1112),6,9)
"RTN","DGREGAED",60,0)
 F DGM="OLD","NEW" D
"RTN","DGREGAED",61,0)
 . W !,?2,"[",DGM," ADDRESS]"
"RTN","DGREGAED",62,0)
 . W ?16,$P($G(DGCMP(DGM,.111)),U)
"RTN","DGREGAED",63,0)
 . I $P($G(DGCMP(DGM,.112)),U)'="" W !,?16,$P($G(DGCMP(DGM,.112)),U)
"RTN","DGREGAED",64,0)
 . I $P($G(DGCMP(DGM,.113)),U)'="" W !,?16,$P($G(DGCMP(DGM,.113)),U)
"RTN","DGREGAED",65,0)
 . W !,?16,$P($G(DGCMP(DGM,.114)),U)
"RTN","DGREGAED",66,0)
 . W:($P($G(DGCMP(DGM,.114)),U)'="")!($P($G(DGCMP(DGM,.115)),U)'="") ","
"RTN","DGREGAED",67,0)
 . W $P($G(DGCMP(DGM,.115)),U)
"RTN","DGREGAED",68,0)
 . W " ",$G(DGCMP(DGM,.1112))
"RTN","DGREGAED",69,0)
 . I $P($G(DGCMP(DGM,.117)),U)'="" W !,?6,"  County: ",$P($G(DGCMP(DGM,.117)),U)
"RTN","DGREGAED",70,0)
 . I $G(FLG(1))=1 D
"RTN","DGREGAED",71,0)
 .. W !,?6,"   Phone: ",?16,$P($G(DGCMP(DGM,.131)),U)
"RTN","DGREGAED",72,0)
 .. W !,?6,"  Office: ",?16,$P($G(DGCMP(DGM,.132)),U)
"RTN","DGREGAED",73,0)
 . W !,?6,"Bad Addr: ",?16,$P($G(DGCMP(DGM,.121)),U)
"RTN","DGREGAED",74,0)
 . W !
"RTN","DGREGAED",75,0)
 Q
"RTN","DGREGAED",76,0)
CONFIRM() ;Confirm if user wants to save the change
"RTN","DGREGAED",77,0)
 N DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","DGREGAED",78,0)
 S DIR(0)="Y"
"RTN","DGREGAED",79,0)
 S DIR("A")="Are you sure that you want to save the above changes"
"RTN","DGREGAED",80,0)
 S DIR("?")="Please answer Y for YES or N for NO."
"RTN","DGREGAED",81,0)
 D ^DIR
"RTN","DGREGAED",82,0)
 I $D(DTOUT)!($G(Y)=0) Q 0
"RTN","DGREGAED",83,0)
 I $D(DUOUT)!$D(DIROUT) Q 0
"RTN","DGREGAED",84,0)
 Q 1
"RTN","DGREGAED",85,0)
SAVE(DGINPUT,DFN) ;Save changes
"RTN","DGREGAED",86,0)
 N DGN,DGER,DGM
"RTN","DGREGAED",87,0)
 S DGER=0
"RTN","DGREGAED",88,0)
 F DGN=.111,.112,.113,.131,.132,.1112,.114,.115,.117,.121 D
"RTN","DGREGAED",89,0)
 . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q
"RTN","DGREGAED",90,0)
 . N DGCODE,DGNAME,FDA,MSG
"RTN","DGREGAED",91,0)
 . S DGCODE=$P($G(DGINPUT(DGN)),U,2)
"RTN","DGREGAED",92,0)
 . S DGNAME=$P($G(DGINPUT(DGN)),U)
"RTN","DGREGAED",93,0)
 . S FDA(2,DFN_",",DGN)=$S(DGCODE:DGCODE,1:DGNAME)
"RTN","DGREGAED",94,0)
 . D FILE^DIE($S(DGCODE:"",1:"E"),"FDA","MSG")
"RTN","DGREGAED",95,0)
 . I $D(MSG) D
"RTN","DGREGAED",96,0)
 .. S DGM="",DGER=1
"RTN","DGREGAED",97,0)
 .. W !,"Please review the saved changes!!",!
"RTN","DGREGAED",98,0)
 .. F  S DGM=$O(MSG("DIERR",1,"TEXT",DGM)) Q:DGM=""  D
"RTN","DGREGAED",99,0)
 ... W $G(MSG("DIERR",1,"TEXT",DGM))
"RTN","DGREGAED",100,0)
 I $G(DGER)=0 W !,"Change saved."
"RTN","DGREGAED",101,0)
 D EOP
"RTN","DGREGAED",102,0)
 Q
"RTN","DGREGAED",103,0)
EOP ;End of page prompt
"RTN","DGREGAED",104,0)
 N DIR,DTOUT,DUOUT,DIROUT,X,Y
"RTN","DGREGAED",105,0)
 S DIR(0)="E"
"RTN","DGREGAED",106,0)
 S DIR("A")="Press ENTER to continue"
"RTN","DGREGAED",107,0)
 D ^DIR
"RTN","DGREGAED",108,0)
 Q
"RTN","DGREGAED",109,0)
UPCT ;Indicate "^" or "^^" are unacceptable inputs.
"RTN","DGREGAED",110,0)
 W !,"EXIT NOT ALLOWED ??"
"RTN","DGREGAED",111,0)
 Q
"RTN","DGREGARP")
0^3^B83832281
"RTN","DGREGARP",1,0)
DGREGARP ;ALB/DW-Address audit reports; 6/2/2003
"RTN","DGREGARP",2,0)
 ;;5.3;Registration;**522,560**;Aug 13, 1993
"RTN","DGREGARP",3,0)
EN(TYPE) ;Entry point
"RTN","DGREGARP",4,0)
 N DGRNG,XMY,XMSUB,XMDUZ,XMTEXT,DGSRT,DGTOTAL
"RTN","DGREGARP",5,0)
 K ^TMP($J,"DG ADD CHNG RPRT")
"RTN","DGREGARP",6,0)
 K ^TMP($J,"DG ADDRESS BEFORE")
"RTN","DGREGARP",7,0)
 I ($G(TYPE)'="ALL")&($G(TYPE)'="RX") Q
"RTN","DGREGARP",8,0)
 ;If mail group has no member or remote-member
"RTN","DGREGARP",9,0)
 I '$$MEMBER() D  Q
"RTN","DGREGARP",10,0)
 . I '$D(ZTQUEUED) W !!,"DG DAILY ADDRESS CHANGE does not have a member. Report not sent." D EOP^DGREGAED
"RTN","DGREGARP",11,0)
 ;Entry from TaskMan
"RTN","DGREGARP",12,0)
 I $D(ZTQUEUED) D  Q
"RTN","DGREGARP",13,0)
 . D PRINT
"RTN","DGREGARP",14,0)
 ;User runs the option
"RTN","DGREGARP",15,0)
 I '$D(ZTQUEUED) D
"RTN","DGREGARP",16,0)
 . W !!,"The report will be sent to mail group DG DAILY ADDRESS CHANGE."
"RTN","DGREGARP",17,0)
 . D QUE
"RTN","DGREGARP",18,0)
 . W !! D EOP^DGREGAED
"RTN","DGREGARP",19,0)
 Q
"RTN","DGREGARP",20,0)
MEMBER() ;Return 0 if mail group has no local or remote member
"RTN","DGREGARP",21,0)
 N RESULT,DGIEN,DGRMT
"RTN","DGREGARP",22,0)
 S RESULT=1
"RTN","DGREGARP",23,0)
 S DGIEN=$$FIND1^DIC(3.8,"","X","DG DAILY ADDRESS CHANGE")
"RTN","DGREGARP",24,0)
 D LIST^DIC(3.812,","_DGIEN_",",.01,"P","","","","","","","DGRMT")
"RTN","DGREGARP",25,0)
 I ($P($G(DGRMT("DILIST",0)),U)'>0),('$$GOTLOCAL^XMXAPIG("DG DAILY ADDRESS CHANGE")) S RESULT=0
"RTN","DGREGARP",26,0)
 Q RESULT
"RTN","DGREGARP",27,0)
QUE ;Que the task if user invokes option
"RTN","DGREGARP",28,0)
 N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,ZUSR,POP,X,ERR,IOP
"RTN","DGREGARP",29,0)
 W !
"RTN","DGREGARP",30,0)
 S ZTIO=""
"RTN","DGREGARP",31,0)
 S ZTSAVE("TYPE")=""
"RTN","DGREGARP",32,0)
 S ZTRTN="PRINT^DGREGARP"
"RTN","DGREGARP",33,0)
 S ZTDESC="DG "_$G(TYPE)_" ADDRESS CHANGE REPORT"
"RTN","DGREGARP",34,0)
 D ^%ZTLOAD
"RTN","DGREGARP",35,0)
 D ^%ZISC,HOME^%ZIS
"RTN","DGREGARP",36,0)
 W !,$S($D(ZTSK):"REQUEST QUEUED AS TASK#"_ZTSK,1:"REQUEST CANCELLED!")
"RTN","DGREGARP",37,0)
 Q
"RTN","DGREGARP",38,0)
PRESORT ;Sort for the report
"RTN","DGREGARP",39,0)
 N DGRNG
"RTN","DGREGARP",40,0)
 D RANGE(.DGRNG)
"RTN","DGREGARP",41,0)
 I DGRNG=-1 Q
"RTN","DGREGARP",42,0)
 D SORT(.DGRNG,TYPE)
"RTN","DGREGARP",43,0)
 Q
"RTN","DGREGARP",44,0)
PRINT ;Create the email message.
"RTN","DGREGARP",45,0)
 N DGLINE,DFN,SSN,IEN
"RTN","DGREGARP",46,0)
 S (DGLINE,DFN,SSN,IEN)=0
"RTN","DGREGARP",47,0)
 D CHKPAR
"RTN","DGREGARP",48,0)
 D HEADER
"RTN","DGREGARP",49,0)
 D PRESORT
"RTN","DGREGARP",50,0)
 D REPORT
"RTN","DGREGARP",51,0)
 D TOTAL
"RTN","DGREGARP",52,0)
 D EMAIL(TYPE)
"RTN","DGREGARP",53,0)
 Q
"RTN","DGREGARP",54,0)
 ;
"RTN","DGREGARP",55,0)
REPORT ;Create the address change report body
"RTN","DGREGARP",56,0)
 N DGNAME,DGSSN,DGDFN
"RTN","DGREGARP",57,0)
 N DGR,DGUSER,DGDATE,DGSRC,DG12
"RTN","DGREGARP",58,0)
 N DGOADD1,DGOADD2,DGOADD3,DGOCITY,DGOST,DGOZIP,DGOCNTY
"RTN","DGREGARP",59,0)
 N DGNADD1,DGNADD2,DGNADD3,DGNCITY,DGNST,DGNZIP,DGNCNTY,DGOPHN,DGHPHN
"RTN","DGREGARP",60,0)
 N DGPRSCRP
"RTN","DGREGARP",61,0)
 S (DGNAME,DGSSN,DGDFN)=""
"RTN","DGREGARP",62,0)
 F  S DGNAME=$O(^TMP($J,"DG ADDRESS BEFORE",DGNAME)) Q:DGNAME=""  D
"RTN","DGREGARP",63,0)
 . S DGSSN=""
"RTN","DGREGARP",64,0)
 . F  S DGSSN=$O(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN)) Q:DGSSN=""  D
"RTN","DGREGARP",65,0)
 .. S DGDFN=""
"RTN","DGREGARP",66,0)
 .. F  S DGDFN=$O(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN)) Q:DGDFN=""  D
"RTN","DGREGARP",67,0)
 ... D GEN(DGNAME,DGSSN,DGDFN)
"RTN","DGREGARP",68,0)
 ... D OLD(DGNAME,DGSSN,DGDFN)
"RTN","DGREGARP",69,0)
 ... D NEW(DGNAME,DGSSN,DGDFN)
"RTN","DGREGARP",70,0)
 ... D PRSCPT(DGDFN)
"RTN","DGREGARP",71,0)
 Q
"RTN","DGREGARP",72,0)
GEN(DGNAME,DGSSN,DGDFN) ;General information for each patient
"RTN","DGREGARP",73,0)
 K DGR
"RTN","DGREGARP",74,0)
 D GETS^DIQ(2,DGDFN_",",".122;.118;.119;.12","E","DGR")
"RTN","DGREGARP",75,0)
 S DGUSER=$G(DGR(2,DGDFN_",",.122,"E"))
"RTN","DGREGARP",76,0)
 S DGDATE=$G(DGR(2,DGDFN_",",.118,"E"))
"RTN","DGREGARP",77,0)
 S DGSRC=$G(DGR(2,DGDFN_",",.119,"E"))
"RTN","DGREGARP",78,0)
 S DG12=$G(DGR(2,DGDFN_",",.12,"E"))
"RTN","DGREGARP",79,0)
 D
"RTN","DGREGARP",80,0)
 . D LNPLUS
"RTN","DGREGARP",81,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)=""
"RTN","DGREGARP",82,0)
 . D LNPLUS
"RTN","DGREGARP",83,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="   PATIENT: "_DGNAME_"   SSN: "_$E(DGSSN,6,10)
"RTN","DGREGARP",84,0)
 . D LNPLUS
"RTN","DGREGARP",85,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="      USER: "_DGUSER_"   DATE: "_DGDATE
"RTN","DGREGARP",86,0)
 . D LNPLUS
"RTN","DGREGARP",87,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="    SOURCE: "_DGSRC_"   "_DG12
"RTN","DGREGARP",88,0)
 Q
"RTN","DGREGARP",89,0)
OLD(DGNAME,DGSSN,DGDFN) ;Get address as of 24 hours ago, assuming audits are on for all
"RTN","DGREGARP",90,0)
 S DGOADD1=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.111))
"RTN","DGREGARP",91,0)
 S DGOADD2=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.112))
"RTN","DGREGARP",92,0)
 S DGOADD3=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.113))
"RTN","DGREGARP",93,0)
 S DGOCITY=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.114))
"RTN","DGREGARP",94,0)
 S DGOST=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.115))
"RTN","DGREGARP",95,0)
 S DGOZIP=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.1112))
"RTN","DGREGARP",96,0)
 S DGOCNTY=$G(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,.117))
"RTN","DGREGARP",97,0)
 D
"RTN","DGREGARP",98,0)
 . D LNPLUS
"RTN","DGREGARP",99,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="    BEFORE: "_DGOADD1
"RTN","DGREGARP",100,0)
 . I $G(DGOADD2)'="" D
"RTN","DGREGARP",101,0)
 .. D LNPLUS
"RTN","DGREGARP",102,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGOADD2
"RTN","DGREGARP",103,0)
 . I $G(DGOADD3)'="" D
"RTN","DGREGARP",104,0)
 .. D LNPLUS
"RTN","DGREGARP",105,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGOADD3
"RTN","DGREGARP",106,0)
 . I (DGOCITY'="")!(DGOST'="") D
"RTN","DGREGARP",107,0)
 .. D LNPLUS
"RTN","DGREGARP",108,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGOCITY_","_DGOST_" "_DGOZIP
"RTN","DGREGARP",109,0)
 . I (DGOCNTY'="") D
"RTN","DGREGARP",110,0)
 .. D LNPLUS
"RTN","DGREGARP",111,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_"COUNTY CODE: "_DGOCNTY
"RTN","DGREGARP",112,0)
 Q
"RTN","DGREGARP",113,0)
NEW(DGNAME,DGSSN,DGDFN) ;Get current address
"RTN","DGREGARP",114,0)
 K DGCURR
"RTN","DGREGARP",115,0)
 D GETS^DIQ(2,DGDFN_",",".111;.112;.113;.114;.115;.116;.117;.119;.12;.1112;.131;.132","E","DGCURR")
"RTN","DGREGARP",116,0)
 S DGNADD1=$G(DGCURR(2,DGDFN_",",.111,"E"))
"RTN","DGREGARP",117,0)
 S DGNADD2=$G(DGCURR(2,DGDFN_",",.112,"E"))
"RTN","DGREGARP",118,0)
 S DGNADD3=$G(DGCURR(2,DGDFN_",",.113,"E"))
"RTN","DGREGARP",119,0)
 S DGNCITY=$G(DGCURR(2,DGDFN_",",.114,"E"))
"RTN","DGREGARP",120,0)
 S DGNST=$G(DGCURR(2,DGDFN_",",.115,"E"))
"RTN","DGREGARP",121,0)
 S DGNZIP=$G(DGCURR(2,DGDFN_",",.1112,"E"))
"RTN","DGREGARP",122,0)
 S DGNCNTY=$G(DGCURR(2,DGDFN_",",.117,"E"))
"RTN","DGREGARP",123,0)
 S DGOPHN=$G(DGCURR(2,DGDFN_",",.132,"E"))
"RTN","DGREGARP",124,0)
 S DGHPHN=$G(DGCURR(2,DGDFN_",",.131,"E"))
"RTN","DGREGARP",125,0)
 D
"RTN","DGREGARP",126,0)
 . D LNPLUS
"RTN","DGREGARP",127,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="     AFTER: "_DGNADD1
"RTN","DGREGARP",128,0)
 . I $G(DGNADD2)'="" D
"RTN","DGREGARP",129,0)
 .. D LNPLUS
"RTN","DGREGARP",130,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGNADD2
"RTN","DGREGARP",131,0)
 . I $G(DGNADD3)'="" D
"RTN","DGREGARP",132,0)
 .. D LNPLUS
"RTN","DGREGARP",133,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGNADD3
"RTN","DGREGARP",134,0)
 . I (DGNCITY'="")!(DGNST'="") D
"RTN","DGREGARP",135,0)
 .. D LNPLUS
"RTN","DGREGARP",136,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_DGNCITY_","_DGNST_" "_DGNZIP
"RTN","DGREGARP",137,0)
 . I (DGNCNTY'="") D
"RTN","DGREGARP",138,0)
 .. D LNPLUS
"RTN","DGREGARP",139,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            "_"COUNTY CODE: "_DGNCNTY
"RTN","DGREGARP",140,0)
 . D LNPLUS
"RTN","DGREGARP",141,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="  "_"PHONE(H): "_DGHPHN
"RTN","DGREGARP",142,0)
 . D LNPLUS
"RTN","DGREGARP",143,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="  "_"PHONE(O): "_DGOPHN
"RTN","DGREGARP",144,0)
 Q
"RTN","DGREGARP",145,0)
PRSCPT(DGDFN) ;Display if the patient has active prescription
"RTN","DGREGARP",146,0)
 S DGPRSCRP=$$EN^PSSRXACT(DGDFN)
"RTN","DGREGARP",147,0)
 I $G(DGPRSCRP)=1 D
"RTN","DGREGARP",148,0)
 . D LNPLUS
"RTN","DGREGARP",149,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="Patient has active pharmacy prescription(s)"
"RTN","DGREGARP",150,0)
 Q
"RTN","DGREGARP",151,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DGREGARP",152,0)
 K ^TMP($J,"DG ADD CHNG RPRT")
"RTN","DGREGARP",153,0)
 K ^TMP($J,"DG ADDRESS BEFORE")
"RTN","DGREGARP",154,0)
 Q
"RTN","DGREGARP",155,0)
CHKPAR ;Check if audit is on for the fields
"RTN","DGREGARP",156,0)
 N DGR,DGN,DGFLD
"RTN","DGREGARP",157,0)
 F DGN=.111,.112,.113,.114,.115,.116,.117,.1112 D
"RTN","DGREGARP",158,0)
 . K DGR
"RTN","DGREGARP",159,0)
 . D FIELD^DID(2,DGN,"","LABEL;AUDIT","DGR")
"RTN","DGREGARP",160,0)
 . I $D(DGR("DIERR")) Q
"RTN","DGREGARP",161,0)
 . I ($G(DGR("AUDIT"))'["YES")&($G(DGR("AUDIT"))'["EDITED OR DELETED") D
"RTN","DGREGARP",162,0)
 .. D LNPLUS^DGREGARP
"RTN","DGREGARP",163,0)
 .. S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="Audit is off for the "_$G(DGR("LABEL"))_" field"
"RTN","DGREGARP",164,0)
 Q
"RTN","DGREGARP",165,0)
RANGE(RESULT) ;Get the range of the reports
"RTN","DGREGARP",166,0)
 K RESULT
"RTN","DGREGARP",167,0)
 N DGBEGIN,DGEND,DGNOW,DGAGO
"RTN","DGREGARP",168,0)
 N X,X1,X2
"RTN","DGREGARP",169,0)
 D NOW^%DTC
"RTN","DGREGARP",170,0)
 S DGNOW=%
"RTN","DGREGARP",171,0)
 S X1=%,X2="-1" D C^%DTC
"RTN","DGREGARP",172,0)
 S DGAGO=X
"RTN","DGREGARP",173,0)
 S DGNOW=$O(^DIA(2,"C",DGNOW),-1)
"RTN","DGREGARP",174,0)
 S DGAGO=$O(^DIA(2,"C",DGAGO))
"RTN","DGREGARP",175,0)
 I ($G(DGNOW)="")!($G(DGAGO)="") S RESULT=-1 Q
"RTN","DGREGARP",176,0)
 S (DGBEGIN,DGEND)=""
"RTN","DGREGARP",177,0)
 S DGBEGIN=$O(^DIA(2,"C",DGNOW,DGBEGIN),-1)
"RTN","DGREGARP",178,0)
 S DGEND=$O(^DIA(2,"C",DGAGO,DGEND))
"RTN","DGREGARP",179,0)
 I $G(DGBEGIN)=""!$G(DGEND)="" S RESULT=-1 Q
"RTN","DGREGARP",180,0)
 S DGBEGIN=DGBEGIN+1
"RTN","DGREGARP",181,0)
 S RESULT=DGBEGIN_U_DGEND
"RTN","DGREGARP",182,0)
 Q
"RTN","DGREGARP",183,0)
SORT(RANGE,TYPE) ;Build the temp global to display
"RTN","DGREGARP",184,0)
 N DGBEGIN,DGEND,DGIEN,DGDFN,DGFLD
"RTN","DGREGARP",185,0)
 S DGIEN=$P($G(RANGE),U)
"RTN","DGREGARP",186,0)
 S DGEND=$P($G(RANGE),U,2)
"RTN","DGREGARP",187,0)
 F  S DGIEN=$O(^DIA(2,DGIEN),-1) Q:DGIEN<DGEND  D:$$SCRN(TYPE,DGIEN)
"RTN","DGREGARP",188,0)
 . D BUILD(TYPE,DGIEN)
"RTN","DGREGARP",189,0)
 Q
"RTN","DGREGARP",190,0)
SCRN(TYPE,DGIEN) ;Screen Audit file to find address changes.
"RTN","DGREGARP",191,0)
 N DGFLD
"RTN","DGREGARP",192,0)
 S DGFLD=$P($G(^DIA(2,DGIEN,0)),U,3)
"RTN","DGREGARP",193,0)
 I (DGFLD=.114)!(DGFLD=.116)!(DGFLD=.117)!(DGFLD=.1112)!(DGFLD=.115) Q 1
"RTN","DGREGARP",194,0)
 I (DGFLD=.111)!(DGFLD=.112)!(DGFLD=.113) Q 1
"RTN","DGREGARP",195,0)
 Q 0
"RTN","DGREGARP",196,0)
BUILD(TYPE,DGIEN) ;Build temp global
"RTN","DGREGARP",197,0)
 N DGDFN,DGFLD,DGNAME,DGSSN,DGCURR,DGN
"RTN","DGREGARP",198,0)
 S DGDFN=$P($G(^DIA(2,DGIEN,0)),U)
"RTN","DGREGARP",199,0)
 I $G(TYPE)="RX" Q:'$$EN^PSSRXACT(DGDFN)
"RTN","DGREGARP",200,0)
 D GETS^DIQ(2,DGDFN_",",".01;.09","E","DGCURR")
"RTN","DGREGARP",201,0)
 S DGNAME=$G(DGCURR(2,DGDFN_",",.01,"E"))
"RTN","DGREGARP",202,0)
 S DGSSN=$G(DGCURR(2,DGDFN_",",.09,"E"))
"RTN","DGREGARP",203,0)
 I ($G(DGNAME)="")!($G(DGSSN)="")!($G(DGDFN)="") Q
"RTN","DGREGARP",204,0)
 S DGFLD=$P($G(^DIA(2,DGIEN,0)),U,3)
"RTN","DGREGARP",205,0)
 I '$D(^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN)) D
"RTN","DGREGARP",206,0)
 . ;Get current address
"RTN","DGREGARP",207,0)
 . K DGCURR,DGN
"RTN","DGREGARP",208,0)
 . D GETS^DIQ(2,DGDFN_",",".111;.112;.113;.114;.115;.116;.117;.1112","E","DGCURR")
"RTN","DGREGARP",209,0)
 . F DGN=.111,.112,.113,.114,.115,.116,.117,.1112 D
"RTN","DGREGARP",210,0)
 .. S ^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,DGN)=$G(DGCURR(2,DGDFN_",",DGN,"E"))
"RTN","DGREGARP",211,0)
 . S DGTOTAL=$G(DGTOTAL)+1
"RTN","DGREGARP",212,0)
 S ^TMP($J,"DG ADDRESS BEFORE",DGNAME,DGSSN,DGDFN,DGFLD)=$P($G(^DIA(2,DGIEN,2)),U)
"RTN","DGREGARP",213,0)
 Q
"RTN","DGREGARP",214,0)
LNPLUS ;Increase line number for the email text
"RTN","DGREGARP",215,0)
 S DGLINE=$G(DGLINE)+1
"RTN","DGREGARP",216,0)
 Q
"RTN","DGREGARP",217,0)
HEADER ;Report header
"RTN","DGREGARP",218,0)
 N RDT,Y
"RTN","DGREGARP",219,0)
 I $G(TYPE)="ALL" D
"RTN","DGREGARP",220,0)
 . D LNPLUS
"RTN","DGREGARP",221,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)=""
"RTN","DGREGARP",222,0)
 . D LNPLUS
"RTN","DGREGARP",223,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="                       ALL ADDRESS CHANGE REPORT"
"RTN","DGREGARP",224,0)
 I $G(TYPE)="RX" D
"RTN","DGREGARP",225,0)
 . D LNPLUS
"RTN","DGREGARP",226,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)=""
"RTN","DGREGARP",227,0)
 . D LNPLUS
"RTN","DGREGARP",228,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="   ALL ADDRESS CHANGE FOR PATIENTS WITH ACTIVE PRESCRIPTIONS REPORT"
"RTN","DGREGARP",229,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGREGARP",230,0)
 S RDT=$P(Y,"@",1)_"@"_$P($P(Y,"@",2),":",1,2)
"RTN","DGREGARP",231,0)
 D
"RTN","DGREGARP",232,0)
 . D LNPLUS
"RTN","DGREGARP",233,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="            The BEFORE address shown may not be accurate."
"RTN","DGREGARP",234,0)
 . D LNPLUS
"RTN","DGREGARP",235,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="     It is only valid as of 24 hours prior to running the report."
"RTN","DGREGARP",236,0)
 . D LNPLUS
"RTN","DGREGARP",237,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="          Changes within the last 24 hours will not be shown."
"RTN","DGREGARP",238,0)
 . D LNPLUS^DGREGARP
"RTN","DGREGARP",239,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="               Date/Time Report Run: "_RDT
"RTN","DGREGARP",240,0)
 . D LNPLUS^DGREGARP
"RTN","DGREGARP",241,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="-----------------------------------------------------------------------------"
"RTN","DGREGARP",242,0)
 Q
"RTN","DGREGARP",243,0)
TOTAL ;Get the total of the patients
"RTN","DGREGARP",244,0)
 N DGCNT
"RTN","DGREGARP",245,0)
 ;S DGCNT=$G(^TMP($J,"DG ADDRESS BEFORE","TOTAL"))
"RTN","DGREGARP",246,0)
 S DGCNT=$G(DGTOTAL)
"RTN","DGREGARP",247,0)
 I $G(DGCNT)>0 D
"RTN","DGREGARP",248,0)
 . D LNPLUS
"RTN","DGREGARP",249,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)=""
"RTN","DGREGARP",250,0)
 . D LNPLUS
"RTN","DGREGARP",251,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="TOTAL RECORD(S): "_DGCNT
"RTN","DGREGARP",252,0)
 Q
"RTN","DGREGARP",253,0)
EMAIL(TYPE) ;Email the report to mailgroup.
"RTN","DGREGARP",254,0)
 ;If called within a task, protect variables
"RTN","DGREGARP",255,0)
 I $D(ZTQUEUED) N %,DIFROM
"RTN","DGREGARP",256,0)
 N RDT
"RTN","DGREGARP",257,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGREGARP",258,0)
 S RDT=$P(Y,"@",1)_"@"_$P($P(Y,"@",2),":",1,2)
"RTN","DGREGARP",259,0)
 S XMSUB="DG "_$G(TYPE)_" ADDRESS CHANGE ("_RDT_")"
"RTN","DGREGARP",260,0)
 S XMY("G.DG DAILY ADDRESS CHANGE")=""
"RTN","DGREGARP",261,0)
 I $G(DGTOTAL)'>0 D
"RTN","DGREGARP",262,0)
 . D LNPLUS
"RTN","DGREGARP",263,0)
 . S ^TMP($J,"DG ADD CHNG RPRT",DGLINE)="*** NO RECORDS TO PRINT ***"
"RTN","DGREGARP",264,0)
 S XMTEXT="^TMP($J,""DG ADD CHNG RPRT"","
"RTN","DGREGARP",265,0)
 D ^XMD
"RTN","DGREGARP",266,0)
 Q
"RTN","DGREGAZL")
0^2^B31405472
"RTN","DGREGAZL",1,0)
DGREGAZL ;ALB/DW - ZIP LINKING UTILITY ; 6/25/2003
"RTN","DGREGAZL",2,0)
 ;;5.3;Registration;**522,560**;Aug 13, 1993
"RTN","DGREGAZL",3,0)
 ;
"RTN","DGREGAZL",4,0)
EN(RESULT,DFN) ;Let user edit zip+4, city, state, county based on zip-linking
"RTN","DGREGAZL",5,0)
 ; Output: RESULT(field#) = User Input External ^ Internal
"RTN","DGREGAZL",6,0)
 K RESULT
"RTN","DGREGAZL",7,0)
 N DGIND
"RTN","DGREGAZL",8,0)
 I $G(DFN)="" S RESULT=-1 Q
"RTN","DGREGAZL",9,0)
 N DGR,DGDFLT,DGALW,DGZIP,DGN
"RTN","DGREGAZL",10,0)
 S DGN=""
"RTN","DGREGAZL",11,0)
 I $$FOREIGN() D  Q
"RTN","DGREGAZL",12,0)
 . D FRGNEDT(.DGR,DFN)
"RTN","DGREGAZL",13,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",14,0)
 . F DGN=.1112,.114,.115,.117 S RESULT(DGN)=$G(DGR(DGN))
"RTN","DGREGAZL",15,0)
 S DGZIP=$$ZIP(DFN)
"RTN","DGREGAZL",16,0)
 I DGZIP=-1 S RESULT=-1 Q
"RTN","DGREGAZL",17,0)
 S RESULT(.1112)=DGZIP
"RTN","DGREGAZL",18,0)
 S DGIND=$$CITY(.DGR,DGZIP,DFN)
"RTN","DGREGAZL",19,0)
 I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",20,0)
 S RESULT(.114)=$G(DGR)
"RTN","DGREGAZL",21,0)
 S DGALW=$$ALWEDT^DGREGDD1($G(DUZ),DGZIP)
"RTN","DGREGAZL",22,0)
 I DGALW=1 D
"RTN","DGREGAZL",23,0)
 . K DGR D STCNTY(.DGR,DGZIP,DFN,DGIND)
"RTN","DGREGAZL",24,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",25,0)
 . S RESULT(.115)=$G(DGR(.115))
"RTN","DGREGAZL",26,0)
 . S RESULT(.117)=$G(DGR(.117))
"RTN","DGREGAZL",27,0)
 I DGALW=0 D
"RTN","DGREGAZL",28,0)
 . I DGZIP'="" D LINK(.DGDFLT,DGZIP,1)
"RTN","DGREGAZL",29,0)
 . S RESULT(.115)=$G(DGDFLT(.115))
"RTN","DGREGAZL",30,0)
 . S RESULT(.117)=$G(DGDFLT(.117))
"RTN","DGREGAZL",31,0)
 Q
"RTN","DGREGAZL",32,0)
ZIP(DFN) ;Let user input zip+4
"RTN","DGREGAZL",33,0)
ZAGN N DIR,DTOUT,DUOUT,DIROUT,DGDATA
"RTN","DGREGAZL",34,0)
 S DIR(0)="2,.1112"
"RTN","DGREGAZL",35,0)
 S DA=DFN
"RTN","DGREGAZL",36,0)
 D ^DIR
"RTN","DGREGAZL",37,0)
 I $D(DTOUT) Q -1
"RTN","DGREGAZL",38,0)
 I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G ZAGN
"RTN","DGREGAZL",39,0)
 S DGZIP=$G(Y)
"RTN","DGREGAZL",40,0)
 ;allow bogus zip:
"RTN","DGREGAZL",41,0)
 I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q DGZIP
"RTN","DGREGAZL",42,0)
 I DGZIP="" Q DGZIP
"RTN","DGREGAZL",43,0)
 D POSTALB^XIPUTIL(DGZIP,.DGDATA)
"RTN","DGREGAZL",44,0)
 I $D(DGDATA("ERROR")) D  G ZAGN
"RTN","DGREGAZL",45,0)
 . W $C(7)," ??"
"RTN","DGREGAZL",46,0)
 Q DGZIP
"RTN","DGREGAZL",47,0)
CITY(RESULT,ZIP,DFN) ;Base on zip, let user input city(#.114)
"RTN","DGREGAZL",48,0)
 ; Input:
"RTN","DGREGAZL",49,0)
 ;   ZIP - user input zip for the patient primary address
"RTN","DGREGAZL",50,0)
 ;   DFN - Interal entry number of Patient File (#2)
"RTN","DGREGAZL",51,0)
 ; Output:RESULT=-1 (input error or times or ^ out) 
"RTN","DGREGAZL",52,0)
 ;        or    =user input city
"RTN","DGREGAZL",53,0)
 ;        Array index # of selected city.
"RTN","DGREGAZL",54,0)
 K RESULT
"RTN","DGREGAZL",55,0)
 N DGDATA,DIR,DA,Y,DTOUT,DUOUT,DIROUT,DGIND
"RTN","DGREGAZL",56,0)
 N DGCITY,DGST,DGCNTY,DGABRV,DGN,DGECH,DGSOC
"RTN","DGREGAZL",57,0)
 S DGIND=""
"RTN","DGREGAZL",58,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",59,0)
 D FIELD^DID(2,.114,"N","LABEL","DGCITY")
"RTN","DGREGAZL",60,0)
 S DGN=""
"RTN","DGREGAZL",61,0)
 I '$D(DGDATA("ERROR")) D
"RTN","DGREGAZL",62,0)
 . F  S DGN=$O(DGDATA(DGN)) Q:DGN=""  D
"RTN","DGREGAZL",63,0)
 .. S DGABRV=$G(DGDATA(DGN,"CITY ABBREVIATION"))
"RTN","DGREGAZL",64,0)
 .. I $G(DGDATA(DGN,"CITY"))["*" S:DGABRV'="" DGABRV=DGABRV_"*"
"RTN","DGREGAZL",65,0)
 .. S DGECH=DGN_":"_$S($G(DGABRV)'="":DGABRV,1:$G(DGDATA(DGN,"CITY")))
"RTN","DGREGAZL",66,0)
 .. S DGSOC=$S($G(DGSOC)="":DGECH,1:DGSOC_";"_DGECH)
"RTN","DGREGAZL",67,0)
 . I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D
"RTN","DGREGAZL",68,0)
 .. S DGSOC=$G(DGSOC)_";"_99_":"_"FREE TEXT"
"RTN","DGREGAZL",69,0)
 . S DIR(0)="SO^"_$G(DGSOC)
"RTN","DGREGAZL",70,0)
 . ;if zip '= zip on file, default = ""; else default=city on file
"RTN","DGREGAZL",71,0)
 . ;I ($G(DFN)'="")&($E(ZIP,1,5)=$$GET1^DIQ(2,DFN_",",.116)) D
"RTN","DGREGAZL",72,0)
 . S DIR("B")=$$GET1^DIQ(2,DFN_",",.114)
"RTN","DGREGAZL",73,0)
 . S DIR("A")=$G(DGCITY("LABEL"))
"RTN","DGREGAZL",74,0)
CAGN1 . D ^DIR
"RTN","DGREGAZL",75,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",76,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN1
"RTN","DGREGAZL",77,0)
 . S RESULT=$P($G(Y(0)),"*")
"RTN","DGREGAZL",78,0)
 . S DGIND=$G(Y)
"RTN","DGREGAZL",79,0)
 I ($G(Y)=99)!($D(DGDATA("ERROR"))) D
"RTN","DGREGAZL",80,0)
CAGN2 . I '$D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q
"RTN","DGREGAZL",81,0)
 . N DIR,X,Y
"RTN","DGREGAZL",82,0)
 . S DIR(0)="2,.114"
"RTN","DGREGAZL",83,0)
 . S DA=DFN
"RTN","DGREGAZL",84,0)
 . D ^DIR
"RTN","DGREGAZL",85,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",86,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN2
"RTN","DGREGAZL",87,0)
 . S RESULT=$G(Y)
"RTN","DGREGAZL",88,0)
 I $L($G(RESULT))>15 S RESULT=$E(RESULT,1,15)
"RTN","DGREGAZL",89,0)
 Q DGIND
"RTN","DGREGAZL",90,0)
 ;
"RTN","DGREGAZL",91,0)
LINK(RESULT,ZIP,DGN) ;From zip, get the linked state,county
"RTN","DGREGAZL",92,0)
 K RESULT
"RTN","DGREGAZL",93,0)
 N DGDATA,CNTYIEN
"RTN","DGREGAZL",94,0)
 S CNTYIEN=""
"RTN","DGREGAZL",95,0)
 S DGN=$G(DGN)
"RTN","DGREGAZL",96,0)
 I (DGN="")&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",97,0)
 I (DGN=99)&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",98,0)
 I (DGN="")!(DGN=99) Q
"RTN","DGREGAZL",99,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",100,0)
 S:$G(DGDATA(DGN,"STATE POINTER"))'="" CNTYIEN=$$FIND1^DIC(5.01,","_$G(DGDATA(DGN,"STATE POINTER"))_",","MOXQ",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),"C")
"RTN","DGREGAZL",101,0)
 D:'CNTYIEN  ;could be duplicate county codes in subfile #5.01
"RTN","DGREGAZL",102,0)
 .Q:'$D(^DIC(5,+$G(DGDATA(DGN,"STATE POINTER")),1))
"RTN","DGREGAZL",103,0)
 .Q:$E($G(DGDATA(DGN,"FIPS CODE")),3,5)=""
"RTN","DGREGAZL",104,0)
 .S CNTYIEN=$O(^DIC(5,$G(DGDATA(DGN,"STATE POINTER")),1,"C",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),""))
"RTN","DGREGAZL",105,0)
 S RESULT(.115)=$G(DGDATA(DGN,"STATE"))_U_$G(DGDATA(DGN,"STATE POINTER"))
"RTN","DGREGAZL",106,0)
 S RESULT(.117)=$G(DGDATA(DGN,"COUNTY"))_U_$G(CNTYIEN)_U_$E($G(DGDATA(DGN,"FIPS CODE")),3,5)
"RTN","DGREGAZL",107,0)
 Q
"RTN","DGREGAZL",108,0)
 ;
"RTN","DGREGAZL",109,0)
STCNTY(RESULT,ZIP,DFN,DGNUM) ;Based on zip,input state (#.115) and county (#.117)
"RTN","DGREGAZL",110,0)
 K RESULT
"RTN","DGREGAZL",111,0)
 S DGNUM=$G(DGNUM)
"RTN","DGREGAZL",112,0)
 N DGN,DGDFLT,DGST,POP,DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","DGREGAZL",113,0)
 S POP=0
"RTN","DGREGAZL",114,0)
 D LINK(.DGDFLT,ZIP,DGNUM)
"RTN","DGREGAZL",115,0)
 F DGN=.115,.117 Q:POP  D
"RTN","DGREGAZL",116,0)
SCAGN . I DGN=.115 S DIR(0)=2_","_DGN
"RTN","DGREGAZL",117,0)
 . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",118,0)
 . I DGN=.117 S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",119,0)
 . S DIR("B")=$P($G(DGDFLT(DGN)),U)
"RTN","DGREGAZL",120,0)
 . D ^DIR
"RTN","DGREGAZL",121,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",122,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G SCAGN
"RTN","DGREGAZL",123,0)
 . S RESULT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",124,0)
 . I DGN=.115 S DGST=$P($G(Y),U)
"RTN","DGREGAZL",125,0)
 . I DGN=.117 S RESULT(.117)=$$CNTY(DGST,$P($G(RESULT(.117)),U,2))
"RTN","DGREGAZL",126,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",127,0)
 Q
"RTN","DGREGAZL",128,0)
CNTY(DGST,DGCIEN) ;Return county name and code
"RTN","DGREGAZL",129,0)
 ;Input:state number and county IEN
"RTN","DGREGAZL",130,0)
 ;Output: CountyName^CountyIEN^CountyCode
"RTN","DGREGAZL",131,0)
 I ($G(DGST)="")!($G(DGCIEN)="") S RESULT=-1 Q RESULT
"RTN","DGREGAZL",132,0)
 N DGR,RESULT
"RTN","DGREGAZL",133,0)
 S DGR=$G(^DIC(5,DGST,1,DGCIEN,0))
"RTN","DGREGAZL",134,0)
 S RESULT=$P($G(DGR),U)_U_DGCIEN_U_$P($G(DGR),U,3)
"RTN","DGREGAZL",135,0)
 Q RESULT
"RTN","DGREGAZL",136,0)
FOREIGN() ;Manila (Philippines) doesn't need zip linking.
"RTN","DGREGAZL",137,0)
 ;Output: 1 - area need no zip linking
"RTN","DGREGAZL",138,0)
 ;        0 - zip-linking area
"RTN","DGREGAZL",139,0)
 I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=358 Q 1
"RTN","DGREGAZL",140,0)
 ;;;I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=500 Q 1 ;;HERE TEST
"RTN","DGREGAZL",141,0)
 Q 0
"RTN","DGREGAZL",142,0)
FRGNEDT(DGINPUT,DFN) ;Edit zip+4, city, state, county for no zip-linking area
"RTN","DGREGAZL",143,0)
 K DGINPUT
"RTN","DGREGAZL",144,0)
 N DGN,DIR,DTOUT,DUOUT,DIROUT,X,Y,POP,DGST
"RTN","DGREGAZL",145,0)
 S POP=0
"RTN","DGREGAZL",146,0)
 F DGN=.1112,.114,.115,.117 Q:POP  D
"RTN","DGREGAZL",147,0)
FAGN . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",148,0)
 . S DIR(0)=2_","_DGN
"RTN","DGREGAZL",149,0)
 . I DGN=.117 D
"RTN","DGREGAZL",150,0)
 .. S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",151,0)
 .. S DIR("B")=$$GET1^DIQ(2,DFN_",",.117)
"RTN","DGREGAZL",152,0)
 . I DGN'=.117 S DA=DFN
"RTN","DGREGAZL",153,0)
 . D ^DIR
"RTN","DGREGAZL",154,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",155,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G FAGN
"RTN","DGREGAZL",156,0)
 . I (DGN=.114)!(DGN=.1112) S DGINPUT(DGN)=$G(Y)
"RTN","DGREGAZL",157,0)
 . I (DGN=.115) D
"RTN","DGREGAZL",158,0)
 .. S DGST=$P($G(Y),U)
"RTN","DGREGAZL",159,0)
 .. I DGST=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",160,0)
 ... S DGINPUT(.115)=$$GET1^DIQ(2,DFN_",",.115)_U_DGST
"RTN","DGREGAZL",161,0)
 .. I DGST'=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",162,0)
 ... S DGINPUT(.115)=$P($G(Y(0)),U)_U_DGST
"RTN","DGREGAZL",163,0)
 . I DGN=.117 S DGINPUT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",164,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",165,0)
 Q
"VER")
8.0^22
"^DD",2,2,.121,0)
BAD ADDRESS INDICATOR^S^1:UNDELIVERABLE;2:HOMELESS;3:OTHER;^.11;16^Q
"^DD",2,2,.121,3)
Please enter 1 if the address is 'UNDELIVERABLE', 2 if the patient is 'HOMELESS', or 3 for 'OTHER' bad address reasons.
"^DD",2,2,.121,21,0)
^^14^14^3031209^
"^DD",2,2,.121,21,1,0)
The Bad Address Indicator field applies to the address at which the patient
"^DD",2,2,.121,21,2,0)
resides.  This field should be set as follows (if applicable):
"^DD",2,2,.121,21,3,0)
 
"^DD",2,2,.121,21,4,0)
    "UNDELIVERABLE" - Bad Address based on returned mail.
"^DD",2,2,.121,21,5,0)
    "HOMELESS" - Patient is known to be homeless.
"^DD",2,2,.121,21,6,0)
    "OTHER" - Other Bad Address Reason
"^DD",2,2,.121,21,7,0)
 
"^DD",2,2,.121,21,8,0)
Setting this field will prevent a Bad Address from being shared with HEC
"^DD",2,2,.121,21,9,0)
and other VAMC facilities. It will also be used to block Means Test 
"^DD",2,2,.121,21,10,0)
Renewal Letters from being sent.
"^DD",2,2,.121,21,11,0)
 
"^DD",2,2,.121,21,12,0)
Once the Bad Address Indicator is set, incoming "newer" addresses will
"^DD",2,2,.121,21,13,0)
automatically remove the Bad Address Indicator, and allow the "updated"
"^DD",2,2,.121,21,14,0)
address to be transmitted to HEC and other VAMC facilities.
"^DD",2,2,.121,23,0)
^.001^9^9^3031209^^^
"^DD",2,2,.121,23,1,0)
This field is being used in conjunction with Patient Address fields
"^DD",2,2,.121,23,2,0)
.111, .1112, .112, .113, .114, .115, .116, and .117, which are located
"^DD",2,2,.121,23,3,0)
in the Patient (#2) file.
"^DD",2,2,.121,23,4,0)

"^DD",2,2,.121,23,5,0)
A programmer API, $$BADADR^DGUTL3(DFN) will allow the return of the Bad
"^DD",2,2,.121,23,6,0)
Address Indicator.  The following parameters are used:
"^DD",2,2,.121,23,7,0)

"^DD",2,2,.121,23,8,0)
Input Parameter: DFN - internal entry number for the Patient file (#2)
"^DD",2,2,.121,23,9,0)
   Return value: internal value of the Bad Address Indicator or <null>
"^DD",2,2,.121,"DT")
3030306
**END**
**END**
