Released TIU*1*194 SEQ #186
Extracted from mail message
**KIDS**:TIU*1.0*194^

**INSTALL NAME**
TIU*1.0*194
"BLD",6155,0)
TIU*1.0*194^TEXT INTEGRATION UTILITIES^0^3050503^y
"BLD",6155,1,0)
^^4^4^3050503^
"BLD",6155,1,1,0)
IN CPRS GUI, NOTES, VIEW, SIGNED BY AUTHOR IT DISPLAYS NOTES BY SIGNED BY 
"BLD",6155,1,2,0)
INSTEAD OF AUTHOR.  IN ROLL AND SCROLL OPTION 2B Review Progress Notes, 
"BLD",6155,1,3,0)
SS DOES THE SAME.  IN ROLL AND SCROLL CPRS, NOTES, CV IT DOES THE SAME.  
"BLD",6155,1,4,0)
THIS PATCH WILL CORRECT THOSE PROBLEMS.
"BLD",6155,4,0)
^9.64PA^^
"BLD",6155,"ABPKG")
n
"BLD",6155,"KRN",0)
^9.67PA^8989.52^19
"BLD",6155,"KRN",.4,0)
.4
"BLD",6155,"KRN",.401,0)
.401
"BLD",6155,"KRN",.402,0)
.402
"BLD",6155,"KRN",.403,0)
.403
"BLD",6155,"KRN",.5,0)
.5
"BLD",6155,"KRN",.84,0)
.84
"BLD",6155,"KRN",3.6,0)
3.6
"BLD",6155,"KRN",3.8,0)
3.8
"BLD",6155,"KRN",9.2,0)
9.2
"BLD",6155,"KRN",9.8,0)
9.8
"BLD",6155,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6155,"KRN",9.8,"NM",1,0)
TIUSRVLL^^0^B63151364
"BLD",6155,"KRN",9.8,"NM",2,0)
TIUSRVLO^^0^B67072677
"BLD",6155,"KRN",9.8,"NM",3,0)
TIUSRVLP^^0^B2470202
"BLD",6155,"KRN",9.8,"NM","B","TIUSRVLL",1)

"BLD",6155,"KRN",9.8,"NM","B","TIUSRVLO",2)

"BLD",6155,"KRN",9.8,"NM","B","TIUSRVLP",3)

"BLD",6155,"KRN",19,0)
19
"BLD",6155,"KRN",19.1,0)
19.1
"BLD",6155,"KRN",101,0)
101
"BLD",6155,"KRN",409.61,0)
409.61
"BLD",6155,"KRN",771,0)
771
"BLD",6155,"KRN",870,0)
870
"BLD",6155,"KRN",8989.51,0)
8989.51
"BLD",6155,"KRN",8989.52,0)
8989.52
"BLD",6155,"KRN",8994,0)
8994
"BLD",6155,"KRN","B",.4,.4)

"BLD",6155,"KRN","B",.401,.401)

"BLD",6155,"KRN","B",.402,.402)

"BLD",6155,"KRN","B",.403,.403)

"BLD",6155,"KRN","B",.5,.5)

"BLD",6155,"KRN","B",.84,.84)

"BLD",6155,"KRN","B",3.6,3.6)

"BLD",6155,"KRN","B",3.8,3.8)

"BLD",6155,"KRN","B",9.2,9.2)

"BLD",6155,"KRN","B",9.8,9.8)

"BLD",6155,"KRN","B",19,19)

"BLD",6155,"KRN","B",19.1,19.1)

"BLD",6155,"KRN","B",101,101)

"BLD",6155,"KRN","B",409.61,409.61)

"BLD",6155,"KRN","B",771,771)

"BLD",6155,"KRN","B",870,870)

"BLD",6155,"KRN","B",8989.51,8989.51)

"BLD",6155,"KRN","B",8989.52,8989.52)

"BLD",6155,"KRN","B",8994,8994)

"BLD",6155,"QUES",0)
^9.62^^
"BLD",6155,"REQB",0)
^9.611^2^2
"BLD",6155,"REQB",1,0)
TIU*1.0*143^1
"BLD",6155,"REQB",2,0)
TIU*1.0*181^1
"BLD",6155,"REQB","B","TIU*1.0*143",1)

"BLD",6155,"REQB","B","TIU*1.0*181",2)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
194^3050503
"PKG",470,22,1,"PAH",1,1,0)
^^4^4^3050503
"PKG",470,22,1,"PAH",1,1,1,0)
IN CPRS GUI, NOTES, VIEW, SIGNED BY AUTHOR IT DISPLAYS NOTES BY SIGNED BY 
"PKG",470,22,1,"PAH",1,1,2,0)
INSTEAD OF AUTHOR.  IN ROLL AND SCROLL OPTION 2B Review Progress Notes, 
"PKG",470,22,1,"PAH",1,1,3,0)
SS DOES THE SAME.  IN ROLL AND SCROLL CPRS, NOTES, CV IT DOES THE SAME.  
"PKG",470,22,1,"PAH",1,1,4,0)
THIS PATCH WILL CORRECT THOSE PROBLEMS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUSRVLL")
0^1^B63151364
"RTN","TIUSRVLL",1,0)
TIUSRVLL ; SLC/JER - Server functions for LOCAL lists ;7/16/01
"RTN","TIUSRVLL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,100,121,143,194**;Jun 20, 1997
"RTN","TIUSRVLL",3,0)
LIST(TIUY,CLASS,DFN,EARLY,LATE) ; Build List user can select from to browse
"RTN","TIUSRVLL",4,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUP,TIUQ,TIUREC,TIUPRM0,TIUPRM1
"RTN","TIUSRVLL",5,0)
 N TIUPRM3,TIUT,TIUTP,XREF,TIUS,TIUCONT,TIUSTAT,TIUTYPE
"RTN","TIUSRVLL",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRVLL",7,0)
 S EARLY=9999999-+$G(EARLY),TIUCNT=0
"RTN","TIUSRVLL",8,0)
 S (TIUI,LATE)=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUSRVLL",9,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:+TIUI'>0!(+TIUI>EARLY)  D GATHER(.TIUY,DFN,CLASS,TIUI)
"RTN","TIUSRVLL",10,0)
 Q
"RTN","TIUSRVLL",11,0)
GATHER(TIUY,DFN,CLASS,TIUI) ; Find/sort records for the list to browse
"RTN","TIUSRVLL",12,0)
 N TIUDA
"RTN","TIUSRVLL",13,0)
 S TIUDA=0
"RTN","TIUSRVLL",14,0)
 F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUSRVLL",15,0)
 . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUDA,"VIEW")'>0) Q
"RTN","TIUSRVLL",16,0)
 . I +$G(^TIU(8925,+TIUDA,0))'>0 K ^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA) Q
"RTN","TIUSRVLL",17,0)
 . I +$G(^TIU(8925,+TIUDA,0))=81,(+$P($G(^(0)),U,5)>5) Q
"RTN","TIUSRVLL",18,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVLL",19,0)
 . S ^TMP("TIUYLIST",$J,TIUCNT)=TIUDA,TIUY=TIUCNT ; TIU*1.0*143
"RTN","TIUSRVLL",20,0)
 . ; S TIUY(TIUCNT)=TIUDA,TIUY=TIUCNT ; pre-143 code
"RTN","TIUSRVLL",21,0)
 Q
"RTN","TIUSRVLL",22,0)
 ;
"RTN","TIUSRVLL",23,0)
CONTEXT(TIUY,CLASS,CONTEXT,DFN,EARLY,LATE,PERSON,OCCLIM,SEQUENCE,TIUEXPKD) ; main
"RTN","TIUSRVLL",24,0)
 ; --- Call with:  TIUY     - Return array, pass by reference
"RTN","TIUSRVLL",25,0)
 ;                 CLASS    - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUSRVLL",26,0)
 ;                 CONTEXT  - 1=All Signed (by PT),
"RTN","TIUSRVLL",27,0)
 ;                          - 2="Unsigned (by PT&(AUTHOR!TANSCRIBER))
"RTN","TIUSRVLL",28,0)
 ;                          - 3="Uncosigned (by PT&EXPECTED COSIGNER
"RTN","TIUSRVLL",29,0)
 ;                          - 4="Signed notes (by PT&selected author)
"RTN","TIUSRVLL",30,0)
 ;                          - 5="Signed notes (by PT&date range)
"RTN","TIUSRVLL",31,0)
 ;                 DFN      - Pointer to Patient (#2)
"RTN","TIUSRVLL",32,0)
 ;                [EARLY]   - FM date/time to begin search
"RTN","TIUSRVLL",33,0)
 ;                [LATE]    - FM date/time to end search
"RTN","TIUSRVLL",34,0)
 ;                [PERSON]  - Pointer to file 200 (DUZ if not passed)
"RTN","TIUSRVLL",35,0)
 ;                [OCCLIM]  - Occurrence Limit (optional)
"RTN","TIUSRVLL",36,0)
 ;               [SEQUENCE] - "A"=ascending (Regular date/time) (dflt)
"RTN","TIUSRVLL",37,0)
 ;                          - "D"=descending (Reverse date/time)
"RTN","TIUSRVLL",38,0)
 ;               [TIUEXPKD] - Return array, pass by ref.
"RTN","TIUSRVLL",39,0)
 ;                            TIUEXPKD(IFN)="", where we will expand IFN
"RTN","TIUSRVLL",40,0)
 ;                            so ID kids/adda that meet criteria are
"RTN","TIUSRVLL",41,0)
 ;                            displayed under it.
"RTN","TIUSRVLL",42,0)
 K TIUY S TIUY=0
"RTN","TIUSRVLL",43,0)
 I $G(CONTEXT)'>0 Q
"RTN","TIUSRVLL",44,0)
 I $G(CLASS)'>0 Q
"RTN","TIUSRVLL",45,0)
 S:+$G(EARLY)'>0 EARLY=0
"RTN","TIUSRVLL",46,0)
 S:+$G(LATE)'>0 LATE=5000000
"RTN","TIUSRVLL",47,0)
 S:+$G(PERSON)'>0 PERSON=DUZ
"RTN","TIUSRVLL",48,0)
 S:$G(SEQUENCE)']"" SEQUENCE="D"
"RTN","TIUSRVLL",49,0)
 S:+$G(OCCLIM)'>0 OCCLIM=9999999
"RTN","TIUSRVLL",50,0)
 S DFN=+$G(DFN)
"RTN","TIUSRVLL",51,0)
 S EARLY=9999999-EARLY,LATE=9999999-LATE ; CHANGE TO REVERSE DATES
"RTN","TIUSRVLL",52,0)
 ; --------------------
"RTN","TIUSRVLL",53,0)
 I CONTEXT=1!(CONTEXT=5) D  Q
"RTN","TIUSRVLL",54,0)
 . D ACLPT(.TIUY,CLASS,DFN,LATE,EARLY,OCCLIM,SEQUENCE)
"RTN","TIUSRVLL",55,0)
 ; --------------------
"RTN","TIUSRVLL",56,0)
 I CONTEXT=2 D  Q
"RTN","TIUSRVLL",57,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",58,0)
 . . D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",59,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLAU",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",60,0)
 ; --------------------
"RTN","TIUSRVLL",61,0)
 I CONTEXT=3 D  Q
"RTN","TIUSRVLL",62,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",63,0)
 . . D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",64,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLEC",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",65,0)
 ; --------------------
"RTN","TIUSRVLL",66,0)
 I CONTEXT=4 D  Q
"RTN","TIUSRVLL",67,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",68,0)
 . . ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 REMOVED EXECUTION OF ACLSB & ADDED APTCL
"RTN","TIUSRVLL",69,0)
 . . ;D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",70,0)
 . . D APTCL^TIUSRVLL(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLL",71,0)
 . F  S DFN=$O(^TIU(8925,"APTCL",DFN)) Q:DFN'>0  D APTCL^TIUSRVLP(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLL",72,0)
 . ;F DFN=0:0 S DFN=$O(^TIU(8925,"ACLSB",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",73,0)
 Q
"RTN","TIUSRVLL",74,0)
 ;
"RTN","TIUSRVLL",75,0)
ACLPT(ARRAY,CLASS,DFN,TIME1,TIME2,OCCLIM,SEQUENCE) ; Signed,
"RTN","TIUSRVLL",76,0)
 ;by patient, [& date].
"RTN","TIUSRVLL",77,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",78,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",79,0)
 S ROOT=$NA(^TIU(8925,"ACLPT",CLASS,DFN))
"RTN","TIUSRVLL",80,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",81,0)
 ; Since date/time is inverted, set subscripts forward for descending:
"RTN","TIUSRVLL",82,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",83,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:$S(+DATTIM'>0:1,+DATTIM>TIME2:1,+$G(^TMP("TIUREPLACE",$J))'<OCCLIM:1,1:0)  D
"RTN","TIUSRVLL",84,0)
 . F DA=0:0 S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",85,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",86,0)
 . . I +^TIU(8925,+DA,0)=81 Q
"RTN","TIUSRVLL",87,0)
 . . ; -- Set records into ^TMP("TIUREPLACE",$J),
"RTN","TIUSRVLL",88,0)
 . . ;    replacing kids w parents:
"RTN","TIUSRVLL",89,0)
 . . D REPLACE(DA,DATTIM)
"RTN","TIUSRVLL",90,0)
 ; B 1
"RTN","TIUSRVLL",91,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",92,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",93,0)
 Q
"RTN","TIUSRVLL",94,0)
 ;
"RTN","TIUSRVLL",95,0)
SETARRY(ARRAY,TIUORDER) ; Set ARRAY(SUB)=DA, which is passed
"RTN","TIUSRVLL",96,0)
 ;back to CONTEXT.  ARRAY holds the right records, in the right order
"RTN","TIUSRVLL",97,0)
 ;for the List Template list.
"RTN","TIUSRVLL",98,0)
 ; TIUORDER=1 or -1: Set ARRAY subscripts forward 1,2 etc., or
"RTN","TIUSRVLL",99,0)
 ;backward -1,-2, etc.
"RTN","TIUSRVLL",100,0)
 ; Requires ^TMP("TIUREPLACE",$J),
"RTN","TIUSRVLL",101,0)
 ;with ID kids or adda replaced by parents.
"RTN","TIUSRVLL",102,0)
 ; B 1
"RTN","TIUSRVLL",103,0)
 N DATTIM,TIUDA,SUB
"RTN","TIUSRVLL",104,0)
 S DATTIM=0
"RTN","TIUSRVLL",105,0)
 S SUB=0
"RTN","TIUSRVLL",106,0)
 F  S DATTIM=$O(^TMP("TIUREPLACE",$J,DATTIM)) Q:'DATTIM  D
"RTN","TIUSRVLL",107,0)
 . S TIUDA=0
"RTN","TIUSRVLL",108,0)
 . F  S TIUDA=$O(^TMP("TIUREPLACE",$J,DATTIM,TIUDA)) Q:'TIUDA  D
"RTN","TIUSRVLL",109,0)
 . . S SUB=SUB+TIUORDER
"RTN","TIUSRVLL",110,0)
 . . S ^TMP("TIUYARRAY",$J,SUB)=TIUDA ; TIU*1.0*143
"RTN","TIUSRVLL",111,0)
 . . ; S ARRAY(SUB)=TIUDA ; original code
"RTN","TIUSRVLL",112,0)
 Q
"RTN","TIUSRVLL",113,0)
 ;
"RTN","TIUSRVLL",114,0)
REPLACE(TIUDA,DATTIM,EXPAND,FORGETAD) ; Populate ^TMP("TIUREPLACE",$J) with
"RTN","TIUSRVLL",115,0)
 ;records that meet criteria, replacing ID kids or addenda with
"RTN","TIUSRVLL",116,0)
 ;their parents.
"RTN","TIUSRVLL",117,0)
 ; Requires TIUDA, DATTIM;
"RTN","TIUSRVLL",118,0)
 ; opt flag FORGETAD - if 1, don't add note to the expand list
"RTN","TIUSRVLL",119,0)
 ;merely because of an addendum.  Used in search by title.
"RTN","TIUSRVLL",120,0)
 ; Passes back array EXPAND.
"RTN","TIUSRVLL",121,0)
 ; Sort by ref date/time
"RTN","TIUSRVLL",122,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PDATTIM,GPDATTIM
"RTN","TIUSRVLL",123,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUSRVLL",124,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUSRVLL",125,0)
 I IDPRNT S PDATTIM=+^TIU(8925,IDPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",126,0)
 S ADDMPRNT=+$P(^TIU(8925,TIUDA,0),U,6) ; assume TIUDA is not component
"RTN","TIUSRVLL",127,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUSRVLL",128,0)
 I ADDMPRNT S PDATTIM=+^TIU(8925,ADDMPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",129,0)
 ; -- If TIUDA is not an ID kid, not addm, just put it
"RTN","TIUSRVLL",130,0)
 ;    in array and quit: --
"RTN","TIUSRVLL",131,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUSRVLL",132,0)
 I 'IDPRNT,'ADDMPRNT D  Q
"RTN","TIUSRVLL",133,0)
 . Q:$D(^TMP("TIUREPLACE",$J,DATTIM,TIUDA))
"RTN","TIUSRVLL",134,0)
 . S ^TMP("TIUREPLACE",$J,DATTIM,TIUDA)=""
"RTN","TIUSRVLL",135,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",136,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUSRVLL",137,0)
 I IDPRNT D  Q
"RTN","TIUSRVLL",138,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",139,0)
 . Q:$D(^TMP("TIUREPLACE",$J,PDATTIM,IDPRNT))
"RTN","TIUSRVLL",140,0)
 . S ^TMP("TIUREPLACE",$J,PDATTIM,IDPRNT)=""
"RTN","TIUSRVLL",141,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",142,0)
 ; -- If TIUDA is an addendum, put its parent/gprnt in array:
"RTN","TIUSRVLL",143,0)
 I ADDMPRNT D  Q
"RTN","TIUSRVLL",144,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",145,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUSRVLL",146,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUSRVLL",147,0)
 . I ADDMGPNT D  I 1
"RTN","TIUSRVLL",148,0)
 . . S GPDATTIM=+^TIU(8925,ADDMGPNT,13),GPDATTIM=9999999-GPDATTIM
"RTN","TIUSRVLL",149,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",150,0)
 . . Q:$D(^TMP("TIUREPLACE",$J,GPDATTIM,ADDMGPNT))
"RTN","TIUSRVLL",151,0)
 . . S ^TMP("TIUREPLACE",$J,GPDATTIM,ADDMGPNT)=""
"RTN","TIUSRVLL",152,0)
 . . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",153,0)
 . E  D
"RTN","TIUSRVLL",154,0)
 . . Q:$D(^TMP("TIUREPLACE",$J,PDATTIM,ADDMPRNT))
"RTN","TIUSRVLL",155,0)
 . . S ^TMP("TIUREPLACE",$J,PDATTIM,ADDMPRNT)=""
"RTN","TIUSRVLL",156,0)
 . . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",157,0)
 Q
"RTN","TIUSRVLL",158,0)
ACLAU(ARRAY,CLASS,AUTHOR,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Unsigned
"RTN","TIUSRVLL",159,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",160,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",161,0)
 S ROOT=$NA(^TIU(8925,"ACLAU",CLASS,AUTHOR,DFN))
"RTN","TIUSRVLL",162,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",163,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",164,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",165,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",166,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>6 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",167,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",168,0)
 . . ; Don't include ID kids or parents in top level of list;
"RTN","TIUSRVLL",169,0)
 . . ; Do expand kids
"RTN","TIUSRVLL",170,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",171,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",172,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",173,0)
 Q
"RTN","TIUSRVLL",174,0)
ACLEC(ARRAY,CLASS,EXCOSIGN,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Uncosigned
"RTN","TIUSRVLL",175,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",176,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",177,0)
 S ROOT=$NA(^TIU(8925,"ACLEC",CLASS,EXCOSIGN,DFN))
"RTN","TIUSRVLL",178,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",179,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",180,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",181,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",182,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",183,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",184,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",185,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",186,0)
 Q
"RTN","TIUSRVLL",187,0)
ACLSB(ARRAY,CLASS,SIGNEDBY,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Signed, by author
"RTN","TIUSRVLL",188,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",189,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",190,0)
 S ROOT=$NA(^TIU(8925,"ACLSB",CLASS,SIGNEDBY,DFN))
"RTN","TIUSRVLL",191,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",192,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",193,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",194,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",195,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",196,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",197,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",198,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",199,0)
 Q
"RTN","TIUSRVLL",200,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 ADDED NEXT TAG
"RTN","TIUSRVLL",201,0)
APTCL(ARRAY,CLASS,TIUAUTH,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Signed, by author
"RTN","TIUSRVLL",202,0)
 N DATTIM,DA,ROOT,TIUORDER,TIUS12,TIUS15
"RTN","TIUSRVLL",203,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",204,0)
 S ROOT=$NA(^TIU(8925,"APTCL",DFN,CLASS))
"RTN","TIUSRVLL",205,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",206,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",207,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",208,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",209,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",210,0)
 . . S TIUS12=$G(^TIU(8925,DA,12))
"RTN","TIUSRVLL",211,0)
 . . Q:+$P(TIUS12,U,2)'=TIUAUTH         ;See if this is the authors note
"RTN","TIUSRVLL",212,0)
 . . S TIUS15=$G(^TIU(8925,DA,15))
"RTN","TIUSRVLL",213,0)
 . . Q:+$P(TIUS15,U,2)'>0                 ;See if signed
"RTN","TIUSRVLL",214,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",215,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",216,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",217,0)
 Q
"RTN","TIUSRVLO")
0^2^B67072677
"RTN","TIUSRVLO",1,0)
TIUSRVLO ; SLC/JER - Server fns - lists for CPRS ;20-NOV-2001 08:51:07
"RTN","TIUSRVLO",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,15,19,63,108,122,181,194**;Jun 20, 1997
"RTN","TIUSRVLO",3,0)
NOTES(TIUY,DFN,EARLY,LATE,PERSON,SEQUENCE) ; Get notes
"RTN","TIUSRVLO",4,0)
 N TIUPREF,TIUOCC S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVLO",5,0)
 S TIUOCC=$P(TIUPREF,U,10),PERSON=$S(+$G(PERSON):+$G(PERSON),1:+$G(DUZ))
"RTN","TIUSRVLO",6,0)
 S SEQUENCE=$S($G(SEQUENCE)]"":$G(SEQUENCE),1:"D")
"RTN","TIUSRVLO",7,0)
 D CONTEXT(.TIUY,3,1,DFN,$G(EARLY),$G(LATE),PERSON,TIUOCC,SEQUENCE)
"RTN","TIUSRVLO",8,0)
 Q
"RTN","TIUSRVLO",9,0)
SUMMARY(TIUY,DFN,EARLY,LATE) ; Get Summaries
"RTN","TIUSRVLO",10,0)
 N TIUPREF,TIUOCC S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVLO",11,0)
 S TIUOCC=$P(TIUPREF,U,10),PERSON=$S(+$G(PERSON):+$G(PERSON),1:+$G(DUZ))
"RTN","TIUSRVLO",12,0)
 S SEQUENCE=$S($G(SEQUENCE)]"":$G(SEQUENCE),1:"D")
"RTN","TIUSRVLO",13,0)
 D CONTEXT(.TIUY,244,1,DFN,$G(EARLY),$G(LATE),PERSON,TIUOCC,SEQUENCE)
"RTN","TIUSRVLO",14,0)
 Q
"RTN","TIUSRVLO",15,0)
CONTEXT(TIUY,CLASS,CONTEXT,DFN,EARLY,LATE,PERSON,OCCLIM,SEQUENCE,SHOWADD,INCUND) ; main
"RTN","TIUSRVLO",16,0)
 ; --- Call with:  TIUY     - RETURN ARRAY pass by reference
"RTN","TIUSRVLO",17,0)
 ;                 CLASS    - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUSRVLO",18,0)
 ;                 CONTEXT  - 1=All Signed (by PT),
"RTN","TIUSRVLO",19,0)
 ;                          - 2="Unsigned (by PT&(AUTHOR!TANSCRIBER))
"RTN","TIUSRVLO",20,0)
 ;                          - 3="Uncosigned (by PT&EXPECTED COSIGNER
"RTN","TIUSRVLO",21,0)
 ;                          - 4="Signed notes (by PT&selected author)
"RTN","TIUSRVLO",22,0)
 ;                          - 5="Signed notes (by PT&date range)
"RTN","TIUSRVLO",23,0)
 ;                 DFN      - Pointer to Patient (#2)
"RTN","TIUSRVLO",24,0)
 ;                [EARLY]   - FM date/time to begin search
"RTN","TIUSRVLO",25,0)
 ;                [LATE]    - FM date/time to end search
"RTN","TIUSRVLO",26,0)
 ;                [PERSON]  - Pointer to file 200 (DUZ if not passed)
"RTN","TIUSRVLO",27,0)
 ;                [OCCLIM]  - Occurrence Limit (optional)
"RTN","TIUSRVLO",28,0)
 ;                [SEQUENCE]- "A"=ascending (Regular date/time)
"RTN","TIUSRVLO",29,0)
 ;                          - "D"=descending (Reverse date/time) (dflt)
"RTN","TIUSRVLO",30,0)
 ;                [INCUND]  - Boolean: include undictated & untranscribed
"RTN","TIUSRVLO",31,0)
 S TIUY=$NA(^TMP("TIUR",$J))
"RTN","TIUSRVLO",32,0)
 K @TIUY
"RTN","TIUSRVLO",33,0)
 I $G(CONTEXT)'>0 Q
"RTN","TIUSRVLO",34,0)
 I $G(CLASS)'>0 Q
"RTN","TIUSRVLO",35,0)
 I $G(CONTEXT)=1 D STRT1^AWCMCPR1 ; TIU*1.0*181
"RTN","TIUSRVLO",36,0)
 S:+$G(EARLY)'>0!(+$G(CONTEXT)=1) EARLY=0
"RTN","TIUSRVLO",37,0)
 S:+$G(LATE)'>0!(+$G(CONTEXT)=1) LATE=5000000
"RTN","TIUSRVLO",38,0)
 I EARLY>LATE D SWAP(.EARLY,.LATE)
"RTN","TIUSRVLO",39,0)
 I $L(LATE,".")=1 D EXPRANGE(.EARLY,.LATE)
"RTN","TIUSRVLO",40,0)
 S:+$G(PERSON)'>0 PERSON=DUZ
"RTN","TIUSRVLO",41,0)
 S:$G(SEQUENCE)']"" SEQUENCE="D"
"RTN","TIUSRVLO",42,0)
 S:+$G(OCCLIM)'>0 OCCLIM=9999999
"RTN","TIUSRVLO",43,0)
 S DFN=+$G(DFN)
"RTN","TIUSRVLO",44,0)
 S EARLY=9999999-EARLY,LATE=9999999-LATE ; CHANGE TO REVERSE DATES
"RTN","TIUSRVLO",45,0)
 ;
"RTN","TIUSRVLO",46,0)
 I CONTEXT=1!(CONTEXT=5) D  G CTXQ
"RTN","TIUSRVLO",47,0)
 . D ACLPT(.TIUY,CLASS,DFN,LATE,EARLY,OCCLIM,SEQUENCE)
"RTN","TIUSRVLO",48,0)
 ;
"RTN","TIUSRVLO",49,0)
 I CONTEXT=2 D  G CTXQ
"RTN","TIUSRVLO",50,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",51,0)
 . . D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,$G(INCUND))
"RTN","TIUSRVLO",52,0)
 . F  S DFN=$O(^TIU(8925,"ACLAU",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,$G(INCUND))
"RTN","TIUSRVLO",53,0)
 ;
"RTN","TIUSRVLO",54,0)
 I CONTEXT=3 D  G CTXQ
"RTN","TIUSRVLO",55,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",56,0)
 . . D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",57,0)
 . F  S DFN=$O(^TIU(8925,"ACLEC",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",58,0)
 ;
"RTN","TIUSRVLO",59,0)
 I CONTEXT=4 D  G CTXQ
"RTN","TIUSRVLO",60,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",61,0)
 . . ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 REMOVED EXECUTION OF ACLSB & ADDED APTCL
"RTN","TIUSRVLO",62,0)
 . . ;D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",63,0)
 . . D APTCL^TIUSRVLP(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",64,0)
 . F  S DFN=$O(^TIU(8925,"APTCL",DFN)) Q:DFN'>0  D APTCL^TIUSRVLP(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",65,0)
 ;
"RTN","TIUSRVLO",66,0)
CTXQ K @TIUY@("INDX")
"RTN","TIUSRVLO",67,0)
 I $D(AWCSTRT) D END^AWCMCPR1 ; TIU*1.0*181
"RTN","TIUSRVLO",68,0)
 Q
"RTN","TIUSRVLO",69,0)
 ;
"RTN","TIUSRVLO",70,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUSRVLO",71,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUSRVLO",72,0)
 Q
"RTN","TIUSRVLO",73,0)
 ;
"RTN","TIUSRVLO",74,0)
EXPRANGE(TIUX,TIUY) ; Expand range when same for early & late
"RTN","TIUSRVLO",75,0)
 I TIUX=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUSRVLO",76,0)
 E  S TIUY=TIUY_"."_2359
"RTN","TIUSRVLO",77,0)
 Q
"RTN","TIUSRVLO",78,0)
 ;
"RTN","TIUSRVLO",79,0)
ACLPT(TIUY,CLASS,DFN,TIME1,TIME2,OCCLIM,SEQUENCE) ; Signed, by patient
"RTN","TIUSRVLO",80,0)
 N DATTIM,DA,ROOT,TIUI,TIUJ
"RTN","TIUSRVLO",81,0)
 S ROOT=$NA(^TIU(8925,"ACLPT",CLASS,DFN)),TIUJ=0
"RTN","TIUSRVLO",82,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",83,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:$S(+DATTIM'>0:1,+DATTIM>TIME2:1,+$G(TIUJ)'<OCCLIM:1,1:0)  D
"RTN","TIUSRVLO",84,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",85,0)
 . . ;Added first condition to following line for interdisciplinary notes - need addenda
"RTN","TIUSRVLO",86,0)
 . . I +$G(SHOWADD)=0,(+$G(^TIU(8925,+DA,0))=81) Q
"RTN","TIUSRVLO",87,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",88,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",89,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLO",90,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",91,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",92,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",93,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVLO",94,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",95,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",96,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",97,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",98,0)
 Q
"RTN","TIUSRVLO",99,0)
 ;
"RTN","TIUSRVLO",100,0)
ACLAU(TIUY,CLASS,AUTHOR,DFN,TIME1,TIME2,SEQUENCE,INCUND) ; Unsigned
"RTN","TIUSRVLO",101,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",102,0)
 S ROOT=$NA(^TIU(8925,"ACLAU",CLASS,AUTHOR,DFN))
"RTN","TIUSRVLO",103,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",104,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",105,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",106,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",107,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>6 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",108,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",109,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",110,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLO",111,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",112,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",113,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",114,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",115,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",116,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",117,0)
 I +$G(INCUND) D GETUND^TIUSRVLI(.TIUY,CLASS,DFN,TIME1,TIME2,.TIUI,SEQUENCE)
"RTN","TIUSRVLO",118,0)
 Q
"RTN","TIUSRVLO",119,0)
 ;
"RTN","TIUSRVLO",120,0)
ACLEC(TIUY,CLASS,EXCOSIGN,DFN,TIME1,TIME2,SEQUENCE) ; Uncosigned
"RTN","TIUSRVLO",121,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",122,0)
 S ROOT=$NA(^TIU(8925,"ACLEC",CLASS,EXCOSIGN,DFN))
"RTN","TIUSRVLO",123,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",124,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",125,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",126,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",127,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",128,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",129,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLO",130,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",131,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",132,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",133,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",134,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",135,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",136,0)
 Q
"RTN","TIUSRVLO",137,0)
 ;
"RTN","TIUSRVLO",138,0)
ACLSB(TIUY,CLASS,SIGNEDBY,DFN,TIME1,TIME2,SEQUENCE) ; Signed, by author
"RTN","TIUSRVLO",139,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",140,0)
 S ROOT=$NA(^TIU(8925,"ACLSB",CLASS,SIGNEDBY,DFN))
"RTN","TIUSRVLO",141,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",142,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",143,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",144,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",145,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",146,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",147,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLO",148,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",149,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",150,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",151,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",152,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",153,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",154,0)
 Q
"RTN","TIUSRVLO",155,0)
 ;
"RTN","TIUSRVLO",156,0)
RESOLVE(DA) ; Resolve to external data
"RTN","TIUSRVLO",157,0)
 N DOC,LOC,PT,AUT,EDT,TIUPT,TIULST4,TIUREC,TIUR0,TIUR12,TIUR13,TIUR14
"RTN","TIUSRVLO",158,0)
 N TIUR17,STATUS,EDTCNT,LOCTYP,TIUADT,TIUDDT,PREFIX,IDPARENT,IDSORT
"RTN","TIUSRVLO",159,0)
 S PREFIX=""
"RTN","TIUSRVLO",160,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUSRVLO",161,0)
 S TIUR13=$G(^TIU(8925,+DA,13)),TIUR14=$G(^(14)),TIUR17=$G(^(17))
"RTN","TIUSRVLO",162,0)
 S IDPARENT=+$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",163,0)
 S TIUPT=$G(^DPT(+$P(TIUR0,U,2),0))
"RTN","TIUSRVLO",164,0)
 S DOC=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUSRVLO",165,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUR0,U,6),0)))
"RTN","TIUSRVLO",166,0)
 ; If IDNotes (TIU*1.0*100) installed, use $$PREFIX^TIULA2 to evaluate
"RTN","TIUSRVLO",167,0)
 ; which prefix to use:
"RTN","TIUSRVLO",168,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUSRVLO",169,0)
 ; - omit in newer TreeView versions
"RTN","TIUSRVLO",170,0)
 I $L($T(PREFIX^TIULA2)) D  I 1
"RTN","TIUSRVLO",171,0)
 . S PREFIX=$$PREFIX^TIULA2(DA,1)  ; 1=include ID Child indicator
"RTN","TIUSRVLO",172,0)
 . I PREFIX["<" S IDSORT=$$IDSORT(DA)
"RTN","TIUSRVLO",173,0)
 . I +$G(SHOWADD)=0 S DOC=PREFIX_DOC
"RTN","TIUSRVLO",174,0)
 ; otherwise, only show addendum indicator (+)
"RTN","TIUSRVLO",175,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUSRVLO",176,0)
 ; - omit in newer TreeView versions
"RTN","TIUSRVLO",177,0)
 E  D
"RTN","TIUSRVLO",178,0)
 . I +$$HASADDEN^TIULC1(DA) S PREFIX="+ "
"RTN","TIUSRVLO",179,0)
 . I +$G(SHOWADD)=0,(+$$HASADDEN^TIULC1(DA)) S DOC=PREFIX_DOC
"RTN","TIUSRVLO",180,0)
 I +$$URGENCY^TIURM(+DA)=1 S DOC=$S(DOC["+":"*",1:"* ")_DOC
"RTN","TIUSRVLO",181,0)
 S STATUS=$$LOWER^TIULS($P($G(^TIU(8925.6,+$P(TIUR0,U,5),0)),U))
"RTN","TIUSRVLO",182,0)
 S LOC=$G(^SC(+$P(TIUR12,U,5),0)),LOCTYP=$P(LOC,U,3),LOC=$P(LOC,U)
"RTN","TIUSRVLO",183,0)
 S TIUADT=$S(LOCTYP="W":"Adm: ",1:"Visit: ")_$$DATE^TIULS($P(TIUR0,U,7),"MM/DD/YY")
"RTN","TIUSRVLO",184,0)
 S TIUDDT=$S(+$P(TIUR0,U,8):"Dis: ",1:"")_$$DATE^TIULS($P(TIUR0,U,8),"MM/DD/YY")
"RTN","TIUSRVLO",185,0)
 I +$G(SHOWADD)>0 S TIUADT=TIUADT_";"_$P(TIUR0,U,7),TIUDDT=TIUDDT_";"_$P(TIUR0,U,8)
"RTN","TIUSRVLO",186,0)
 S PT=$$NAME^TIULS($P(TIUPT,U),"LAST, FIRST MI")
"RTN","TIUSRVLO",187,0)
 S TIULST4=$E($P(TIUPT,U,9),6,9)
"RTN","TIUSRVLO",188,0)
 S TIULST4="("_$E(PT)_TIULST4_")"
"RTN","TIUSRVLO",189,0)
 S AUT=+$P(TIUR12,U,2)
"RTN","TIUSRVLO",190,0)
 S AUT=AUT_";"_$$SIGNAME^TIULS(+$P(TIUR12,U,2))_";"_$P($G(^VA(200,AUT,0)),U,1)
"RTN","TIUSRVLO",191,0)
 S EDT=+TIUR13,EDTCNT=+$G(EDTCNT)+1
"RTN","TIUSRVLO",192,0)
 S TIUREC=DOC_U_EDT_U_PT_" "_TIULST4_U_AUT_U_LOC_U_STATUS_U_TIUADT_U_TIUDDT_U_$P(TIUR14,U,5)_U_$$IMGCNT(DA)_U
"RTN","TIUSRVLO",193,0)
 S TIUREC=TIUREC_$S($L(TIUR17):$E(TIUR17,1,(255-$L(TIUREC)))_U,1:U)
"RTN","TIUSRVLO",194,0)
 S TIUREC=TIUREC_$P(PREFIX," ")_U
"RTN","TIUSRVLO",195,0)
 S TIUREC=TIUREC_$S(+TIUR0=81:+$P(TIUR0,U,6),+IDPARENT:IDPARENT,+$G(CONTEXT):CONTEXT,1:1)_U_$G(IDSORT)
"RTN","TIUSRVLO",196,0)
 Q $G(TIUREC)
"RTN","TIUSRVLO",197,0)
IMGCNT(TIUDA) ; Get the number of images associated with a document
"RTN","TIUSRVLO",198,0)
 N IMGDA,TIUI S (IMGDA,TIUI)=0
"RTN","TIUSRVLO",199,0)
 F  S IMGDA=$O(^TIU(8925.91,"ADI",TIUDA,IMGDA)) Q:+IMGDA'>0  D
"RTN","TIUSRVLO",200,0)
 . S TIUI=TIUI+1
"RTN","TIUSRVLO",201,0)
 Q TIUI
"RTN","TIUSRVLO",202,0)
IDSORT(TIUDA) ; Get ID Sort indicator when appropriate
"RTN","TIUSRVLO",203,0)
 N TIUDPRM
"RTN","TIUSRVLO",204,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+TIUDA,0)),.TIUDPRM)
"RTN","TIUSRVLO",205,0)
 Q +$P(TIUDPRM(0),U,18)
"RTN","TIUSRVLP")
0^3^B2470202
"RTN","TIUSRVLP",1,0)
TIUSRVLP ;BAY PINES/ELR - Server fns - Cont of TIUSRVLO ;20-NOV-2001 08:51:07
"RTN","TIUSRVLP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**194**;Jun 20, 1997
"RTN","TIUSRVLP",3,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 FORCED TO BREAK UP TIUSRVLO DUE TO SIZE
"RTN","TIUSRVLP",4,0)
APTCL(TIUY,CLASS,TIUAUTH,DFN,TIME1,TIME2,SEQUENCE) ; Signed, by author
"RTN","TIUSRVLP",5,0)
 N DATTIM,DA,ROOT,TIUI,TIUS12,TIUS15
"RTN","TIUSRVLP",6,0)
 S ROOT=$NA(^TIU(8925,"APTCL",DFN,CLASS))
"RTN","TIUSRVLP",7,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLP",8,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLP",9,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLP",10,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DA) Q
"RTN","TIUSRVLP",11,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLP",12,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLP",13,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLP",14,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLP",15,0)
 . . S TIUS12=$G(^TIU(8925,DA,12))
"RTN","TIUSRVLP",16,0)
 . . Q:+$P(TIUS12,U,2)'=TIUAUTH         ;See if this is the authors note
"RTN","TIUSRVLP",17,0)
 . . S TIUS15=$G(^TIU(8925,DA,15))
"RTN","TIUSRVLP",18,0)
 . . Q:+$P(TIUS15,U,2)'>0                 ;See if signed
"RTN","TIUSRVLP",19,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE^TIUSRVLO(DA)
"RTN","TIUSRVLP",20,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLP",21,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLP",22,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLP",23,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLP",24,0)
 Q
"VER")
8.0^22.0
"BLD",6155,6)
^SEQ #186
**END**
**END**
