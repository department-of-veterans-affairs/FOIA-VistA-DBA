Released PSB*3*27 SEQ #19
Extracted from mail message
**KIDS**:PSB*3.0*27^

**INSTALL NAME**
PSB*3.0*27
"BLD",6638,0)
PSB*3.0*27^BAR CODE MED ADMIN^0^3060426^y
"BLD",6638,1,0)
^^18^18^3060223^
"BLD",6638,1,1,0)
This patch addresses Remedy Ticket HD127231, which arose after the 
"BLD",6638,1,2,0)
install of patch PSB*3*20.  Patch PSB*3*20 added the patient header 
"BLD",6638,1,3,0)
information to the MAH report if the report for a medication ran longer
"BLD",6638,1,4,0)
than one page.  Additionally, PSB*3*20 was designed to reprint the first 
"BLD",6638,1,5,0)
six lines of the orderable item information on subsequent pages to help 
"BLD",6638,1,6,0)
the nurses keep track of what medication they were viewing
"BLD",6638,1,7,0)
on the MAH report.  However, when the next medication on the report was 
"BLD",6638,1,8,0)
due to be printed, and a page break occurred before the orderable item 
"BLD",6638,1,9,0)
information was printed, the second page of the report printed
"BLD",6638,1,10,0)
the first six lines of the orderable item in duplicate.
"BLD",6638,1,11,0)
 
"BLD",6638,1,12,0)
The fix included in this patch will still print the patient header 
"BLD",6638,1,13,0)
information on subsequent MAH pages, but it will not reprint the first 
"BLD",6638,1,14,0)
six lines of the orderable item information.
"BLD",6638,1,15,0)
 
"BLD",6638,1,16,0)
**NOTE** This fix only affects the report when printed to a printer.
"BLD",6638,1,17,0)
This does not affect the GUI display or printing the report to the
"BLD",6638,1,18,0)
terminal screen.
"BLD",6638,4,0)
^9.64PA^^
"BLD",6638,6)
3^
"BLD",6638,"ABPKG")
n
"BLD",6638,"KRN",0)
^9.67PA^8989.52^19
"BLD",6638,"KRN",.4,0)
.4
"BLD",6638,"KRN",.401,0)
.401
"BLD",6638,"KRN",.402,0)
.402
"BLD",6638,"KRN",.403,0)
.403
"BLD",6638,"KRN",.5,0)
.5
"BLD",6638,"KRN",.84,0)
.84
"BLD",6638,"KRN",3.6,0)
3.6
"BLD",6638,"KRN",3.8,0)
3.8
"BLD",6638,"KRN",9.2,0)
9.2
"BLD",6638,"KRN",9.8,0)
9.8
"BLD",6638,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6638,"KRN",9.8,"NM",1,0)
PSBOMH2^^0^29518009
"BLD",6638,"KRN",9.8,"NM","B","PSBOMH2",1)

"BLD",6638,"KRN",19,0)
19
"BLD",6638,"KRN",19.1,0)
19.1
"BLD",6638,"KRN",101,0)
101
"BLD",6638,"KRN",409.61,0)
409.61
"BLD",6638,"KRN",771,0)
771
"BLD",6638,"KRN",870,0)
870
"BLD",6638,"KRN",8989.51,0)
8989.51
"BLD",6638,"KRN",8989.52,0)
8989.52
"BLD",6638,"KRN",8994,0)
8994
"BLD",6638,"KRN","B",.4,.4)

"BLD",6638,"KRN","B",.401,.401)

"BLD",6638,"KRN","B",.402,.402)

"BLD",6638,"KRN","B",.403,.403)

"BLD",6638,"KRN","B",.5,.5)

"BLD",6638,"KRN","B",.84,.84)

"BLD",6638,"KRN","B",3.6,3.6)

"BLD",6638,"KRN","B",3.8,3.8)

"BLD",6638,"KRN","B",9.2,9.2)

"BLD",6638,"KRN","B",9.8,9.8)

"BLD",6638,"KRN","B",19,19)

"BLD",6638,"KRN","B",19.1,19.1)

"BLD",6638,"KRN","B",101,101)

"BLD",6638,"KRN","B",409.61,409.61)

"BLD",6638,"KRN","B",771,771)

"BLD",6638,"KRN","B",870,870)

"BLD",6638,"KRN","B",8989.51,8989.51)

"BLD",6638,"KRN","B",8989.52,8989.52)

"BLD",6638,"KRN","B",8994,8994)

"BLD",6638,"QUES",0)
^9.62^^
"BLD",6638,"REQB",0)
^9.611^1^1
"BLD",6638,"REQB",1,0)
PSB*3.0*20^1
"BLD",6638,"REQB","B","PSB*3.0*20",1)

"MBREQ")
0
"PKG",537,-1)
1^1
"PKG",537,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",537,20,0)
^9.402P^^
"PKG",537,22,0)
^9.49I^1^1
"PKG",537,22,1,0)
3.0^3040224^3040504^22979
"PKG",537,22,1,"PAH",1,0)
27^3060426^33270
"PKG",537,22,1,"PAH",1,1,0)
^^18^18^3060426
"PKG",537,22,1,"PAH",1,1,1,0)
This patch addresses Remedy Ticket HD127231, which arose after the 
"PKG",537,22,1,"PAH",1,1,2,0)
install of patch PSB*3*20.  Patch PSB*3*20 added the patient header 
"PKG",537,22,1,"PAH",1,1,3,0)
information to the MAH report if the report for a medication ran longer
"PKG",537,22,1,"PAH",1,1,4,0)
than one page.  Additionally, PSB*3*20 was designed to reprint the first 
"PKG",537,22,1,"PAH",1,1,5,0)
six lines of the orderable item information on subsequent pages to help 
"PKG",537,22,1,"PAH",1,1,6,0)
the nurses keep track of what medication they were viewing
"PKG",537,22,1,"PAH",1,1,7,0)
on the MAH report.  However, when the next medication on the report was 
"PKG",537,22,1,"PAH",1,1,8,0)
due to be printed, and a page break occurred before the orderable item 
"PKG",537,22,1,"PAH",1,1,9,0)
information was printed, the second page of the report printed
"PKG",537,22,1,"PAH",1,1,10,0)
the first six lines of the orderable item in duplicate.
"PKG",537,22,1,"PAH",1,1,11,0)
 
"PKG",537,22,1,"PAH",1,1,12,0)
The fix included in this patch will still print the patient header 
"PKG",537,22,1,"PAH",1,1,13,0)
information on subsequent MAH pages, but it will not reprint the first 
"PKG",537,22,1,"PAH",1,1,14,0)
six lines of the orderable item information.
"PKG",537,22,1,"PAH",1,1,15,0)
 
"PKG",537,22,1,"PAH",1,1,16,0)
**NOTE** This fix only affects the report when printed to a printer.
"PKG",537,22,1,"PAH",1,1,17,0)
This does not affect the GUI display or printing the report to the
"PKG",537,22,1,"PAH",1,1,18,0)
terminal screen.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSBOMH2")
0^1^B29518009^B28071612
"RTN","PSBOMH2",1,0)
PSBOMH2 ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,20,27**;Mar 2004
"RTN","PSBOMH2",3,0)
 ;
"RTN","PSBOMH2",4,0)
 ; Reference/IA
"RTN","PSBOMH2",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH2",6,0)
 ;
"RTN","PSBOMH2",7,0)
EN ;
"RTN","PSBOMH2",8,0)
 ; Okay, let's print this puppy
"RTN","PSBOMH2",9,0)
 S PSBWEEK=0
"RTN","PSBOMH2",10,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",11,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","C"))
"RTN","PSBOMH2",12,0)
 ..D CONT
"RTN","PSBOMH2",13,0)
 ;
"RTN","PSBOMH2",14,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",15,0)
 S PSBWEEK=0
"RTN","PSBOMH2",16,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",17,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","P"))
"RTN","PSBOMH2",18,0)
 ..D PRN
"RTN","PSBOMH2",19,0)
 ;
"RTN","PSBOMH2",20,0)
 D LEGEND
"RTN","PSBOMH2",21,0)
 Q
"RTN","PSBOMH2",22,0)
CONT ;
"RTN","PSBOMH2",23,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",24,0)
 W $$HDR()
"RTN","PSBOMH2",25,0)
 S PSBDRUG=""
"RTN","PSBOMH2",26,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",27,0)
 .S PSBORD=""
"RTN","PSBOMH2",28,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",29,0)
 ..;S X="",PSBNAF=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,X)) Q:X=""  I ^TMP("PSB",$J,PSBWEEK,PSBORD,X,0)'=0 S PSBNAF=1  ; check for data
"RTN","PSBOMH2",30,0)
 ..;D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBOMH2",31,0)
 ..;S X=PSBOST D H^%DTC S PSBOSTH=%H
"RTN","PSBOMH2",32,0)
 ..;S X=PSBOSP D H^%DTC S PSBOSPH=%H
"RTN","PSBOMH2",33,0)
 ..;I PSBNAF=0 Q
"RTN","PSBOMH2",34,0)
 ..;I PSBNAF=0,$G(PSBAR(PSBOSTH))'=PSBWEEK,$G(PSBAR(PSBOSPH))'=PSBWEEK Q  ; no data for this week and neither start or stop date is this week
"RTN","PSBOMH2",35,0)
 ..S PSBCNT=8
"RTN","PSBOMH2",36,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",37,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",38,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR()
"RTN","PSBOMH2",39,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",40,0)
 ...I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",41,0)
 ....W !?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",42,0)
 ....W $$HDR()
"RTN","PSBOMH2",43,0)
 ....W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOMH2",44,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",45,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",46,0)
 ...S PSBDAY=0,PSBCOL=0
"RTN","PSBOMH2",47,0)
 ...F  S PSBDAY=$O(^TMP("PSB",$J,PSBWEEK,"HDR",PSBDAY)) Q:'PSBDAY  D
"RTN","PSBOMH2",48,0)
 ....W ?(40+(PSBCOL*13)),"| "
"RTN","PSBOMH2",49,0)
 ....S Y=$G(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDAY,PSBLINE))
"RTN","PSBOMH2",50,0)
 ....W $P(Y,U,3)
"RTN","PSBOMH2",51,0)
 ....W $E($P($P(Y,U,1)_"0000",".",2),1,4)," "
"RTN","PSBOMH2",52,0)
 ....W $P(Y,U,2)
"RTN","PSBOMH2",53,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)),(PSBLINE=PSBCNT) W "HOLD"  ;output hold status
"RTN","PSBOMH2",54,0)
 ....I '$D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY))&'$D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)) D
"RTN","PSBOMH2",55,0)
 .....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"NTDUE",PSBDAY)),(PSBLINE=PSBCNT) W "***"  ;write *** when day no due
"RTN","PSBOMH2",56,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY)),(PSBLINE=PSBCNT) W "***"   ;output discontinued status
"RTN","PSBOMH2",57,0)
 ....S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",58,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",59,0)
 Q
"RTN","PSBOMH2",60,0)
 ;
"RTN","PSBOMH2",61,0)
PRN ;
"RTN","PSBOMH2",62,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",63,0)
 W $$HDR(1)
"RTN","PSBOMH2",64,0)
 S PSBDRUG=""
"RTN","PSBOMH2",65,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",66,0)
 .S PSBORD=""
"RTN","PSBOMH2",67,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",68,0)
 ..S PSBCNT=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)
"RTN","PSBOMH2",69,0)
 ..D:PSBCNT<$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",70,0)
 ...S PSBCNT=$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",71,0)
 ..S:PSBCNT<8 PSBCNT=8  ; Minimum space for order
"RTN","PSBOMH2",72,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR(1)
"RTN","PSBOMH2",73,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",74,0)
 ...I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",75,0)
 ....W !?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",76,0)
 ....W $$HDR(1)
"RTN","PSBOMH2",77,0)
 ....W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOMH2",78,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",79,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",80,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",81,0)
 Q
"RTN","PSBOMH2",82,0)
 ;
"RTN","PSBOMH2",83,0)
LEGEND  ;
"RTN","PSBOMH2",84,0)
 ;print the initials - name legend as an extra page  ;
"RTN","PSBOMH2",85,0)
 ;I '$D(^TMP("PSB",$J,"LEGEND")) K ^TMP("PSJ",$J),^TMP("PSB",$J) Q  ;
"RTN","PSBOMH2",86,0)
 D PT^PSBOHDR(DFN,.PSBHDR)  ;
"RTN","PSBOMH2",87,0)
 W !!,"Initial - Name Legend",!  ;
"RTN","PSBOMH2",88,0)
 I $D(^TMP("PSB",$J,"LEGEND"))  D
"RTN","PSBOMH2",89,0)
 .S X=$Q(^TMP("PSB",$J,"LEGEND",""))
"RTN","PSBOMH2",90,0)
 .F  W $S($QS(X,4)[99:"",1:$QS(X,4)),?10,$QS(X,5),! S X=$Q(@X) Q:$QS(X,3)'="LEGEND"  ;
"RTN","PSBOMH2",91,0)
 W !!,"Status Codes",!,"C - Completed",!,"G - Given",!,"H - Held",!,"I - Infusing",!,"M - Missing Dose Requested",!,"R - Refused",!,"RM - Removed",!,"S - Stopped",!,"*** - Medication Not Due",!  ;
"RTN","PSBOMH2",92,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH2",93,0)
 Q
"RTN","PSBOMH2",94,0)
 ;
"RTN","PSBOMH2",95,0)
HDR(PRN)   ;
"RTN","PSBOMH2",96,0)
 ; PRN = TRUE IF DISPLAYING PRN MED (OPTIONAL)
"RTN","PSBOMH2",97,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMH2",98,0)
 W !,"Start Date",?20,"Stop Date",?32,"| ",$S('$G(PRN):"Admin",1:"Action Status")
"RTN","PSBOMH2",99,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"
"RTN","PSBOMH2",100,0)
 W !,"and Time",?20,"and Time",?32,"| ",$S('$G(PRN):"Times",1:"Action Date/Times")
"RTN","PSBOMH2",101,0)
 D:'$G(PRN)
"RTN","PSBOMH2",102,0)
 .S PSBCOL=0,X=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,"HDR",X)) Q:'X  D
"RTN","PSBOMH2",103,0)
 ..W ?(40+(PSBCOL*13)),"| ",$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBOMH2",104,0)
 ..S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",105,0)
 D:$G(PRN)
"RTN","PSBOMH2",106,0)
 .W ?76,"PRN Reason"
"RTN","PSBOMH2",107,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",108,0)
 Q ""
"RTN","PSBOMH2",109,0)
 ;
"RTN","PSBOMH2",110,0)
PSBCK1(PSBCHK) ;                   
"RTN","PSBOMH2",111,0)
 I PSBCHK="A" D
"RTN","PSBOMH2",112,0)
 .S TEST=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",113,0)
 .D PSBOUT^PSBOMH1(TEST,PSBINIT)
"RTN","PSBOMH2",114,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_"G"_U_PSBIEN
"RTN","PSBOMH2",115,0)
 I PSBCHK="B" D
"RTN","PSBOMH2",116,0)
 .S TESTB=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",117,0)
 .D PSBOUT^PSBOMH1(TESTB,PSBINIT)
"RTN","PSBOMH2",118,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_$P(^(0),U,9)_U_PSBIEN
"RTN","PSBOMH2",119,0)
 S PSBCHK=""
"RTN","PSBOMH2",120,0)
 Q
"RTN","PSBOMH2",121,0)
 ;
"RTN","PSBOMH2",122,0)
PSBENT(PSBTIS) ;
"RTN","PSBOMH2",123,0)
 S PSBNAME="",PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH2",124,0)
 S ^TMP("PSB",$J,"LEGEND",PSBTIS,PSBNAME)=""
"RTN","PSBOMH2",125,0)
 Q
"RTN","PSBOMH2",126,0)
 ;
"VER")
8.0^22.0
"BLD",6638,6)
^19
**END**
**END**
