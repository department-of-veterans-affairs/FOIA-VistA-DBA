Released DG*5.3*509 SEQ #441
Extracted from mail message
**KIDS**:DG*5.3*509^

**INSTALL NAME**
DG*5.3*509
"BLD",3899,0)
DG*5.3*509^REGISTRATION^0^3030418^y
"BLD",3899,4,0)
^9.64PA^^
"BLD",3899,"KRN",0)
^9.67PA^8989.52^19
"BLD",3899,"KRN",.4,0)
.4
"BLD",3899,"KRN",.401,0)
.401
"BLD",3899,"KRN",.402,0)
.402
"BLD",3899,"KRN",.403,0)
.403
"BLD",3899,"KRN",.5,0)
.5
"BLD",3899,"KRN",.84,0)
.84
"BLD",3899,"KRN",3.6,0)
3.6
"BLD",3899,"KRN",3.8,0)
3.8
"BLD",3899,"KRN",9.2,0)
9.2
"BLD",3899,"KRN",9.8,0)
9.8
"BLD",3899,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3899,"KRN",9.8,"NM",1,0)
DGPMV10^^0^B28144594
"BLD",3899,"KRN",9.8,"NM",2,0)
VADPT30^^0^B15191718
"BLD",3899,"KRN",9.8,"NM",3,0)
VADPT31^^0^B18415362
"BLD",3899,"KRN",9.8,"NM","B","DGPMV10",1)

"BLD",3899,"KRN",9.8,"NM","B","VADPT30",2)

"BLD",3899,"KRN",9.8,"NM","B","VADPT31",3)

"BLD",3899,"KRN",19,0)
19
"BLD",3899,"KRN",19.1,0)
19.1
"BLD",3899,"KRN",101,0)
101
"BLD",3899,"KRN",409.61,0)
409.61
"BLD",3899,"KRN",771,0)
771
"BLD",3899,"KRN",870,0)
870
"BLD",3899,"KRN",8989.51,0)
8989.51
"BLD",3899,"KRN",8989.52,0)
8989.52
"BLD",3899,"KRN",8994,0)
8994
"BLD",3899,"KRN","B",.4,.4)

"BLD",3899,"KRN","B",.401,.401)

"BLD",3899,"KRN","B",.402,.402)

"BLD",3899,"KRN","B",.403,.403)

"BLD",3899,"KRN","B",.5,.5)

"BLD",3899,"KRN","B",.84,.84)

"BLD",3899,"KRN","B",3.6,3.6)

"BLD",3899,"KRN","B",3.8,3.8)

"BLD",3899,"KRN","B",9.2,9.2)

"BLD",3899,"KRN","B",9.8,9.8)

"BLD",3899,"KRN","B",19,19)

"BLD",3899,"KRN","B",19.1,19.1)

"BLD",3899,"KRN","B",101,101)

"BLD",3899,"KRN","B",409.61,409.61)

"BLD",3899,"KRN","B",771,771)

"BLD",3899,"KRN","B",870,870)

"BLD",3899,"KRN","B",8989.51,8989.51)

"BLD",3899,"KRN","B",8989.52,8989.52)

"BLD",3899,"KRN","B",8994,8994)

"BLD",3899,"QUES",0)
^9.62^^
"BLD",3899,"REQB",0)
^9.611^1^1
"BLD",3899,"REQB",1,0)
DG*5.3*498^2
"BLD",3899,"REQB","B","DG*5.3*498",1)

"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
509^3030418
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGPMV10")
0^1^B28144594
"RTN","DGPMV10",1,0)
DGPMV10 ;ALB/MRL/MIR - PATIENT MOVEMENT, CONT.; 11 APR 89 ; 4/15/03 5:48pm
"RTN","DGPMV10",2,0)
 ;;5.3;Registration;**84,498,509**;Aug 13, 1993
"RTN","DGPMV10",3,0)
CS ;Current Status
"RTN","DGPMV10",4,0)
 ;first print primary care team/practitioner/attending
"RTN","DGPMV10",5,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","DGPMV10",6,0)
 S X=$S('DGPMT:1,DGPMT<4:2,DGPMT>5:2,1:3) ;DGPMT=0 if from pt inq (DGRPD)
"RTN","DGPMV10",7,0)
 I '$D(^DGPM("C",DFN)) W !!,"Status      : PATIENT HAS NO INPATIENT OR LODGER ACTIVITY IN THE COMPUTER",*7 D CS2 Q
"RTN","DGPMV10",8,0)
 S A=$S("^3^5^"[("^"_+DGPMVI(2)_"^"):0,1:+DGPMVI(2)) W !!,"Status      : ",$S('A:"IN",1:""),"ACTIVE ",$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"LODGER",1:"INPATIENT")
"RTN","DGPMV10",9,0)
 G CS1:'A W "-" S X=+DGPMVI(4) I X=1 W "on PASS" G CS1
"RTN","DGPMV10",10,0)
 I "^2^3^25^26^"[("^"_X_"^") W "on ",$S("^2^26^"[X:"A",1:"U"),"A" G CS1
"RTN","DGPMV10",11,0)
 I "^13^43^44^45^"[("^"_X_"^") W "ASIH" G CS1
"RTN","DGPMV10",12,0)
 I X=6 W "OTHER FAC" G CS1
"RTN","DGPMV10",13,0)
 W "on WARD"
"RTN","DGPMV10",14,0)
CS1 I +DGPMVI(2)=3,$D(^DGPM(+DGPMVI(17),0)) W ?39,"Discharge Type : ",$S($D(^DG(405.1,+$P(^(0),"^",4),0)):$P(^(0),"^",1),1:"UNKNOWN")
"RTN","DGPMV10",15,0)
 I "^3^4^5^"'[("^"_+DGPMVI(2)_"^"),$D(^DPT(DFN,"DAC")),($P(^("DAC"),"^",1)="S") W "  (Seriously ill)"
"RTN","DGPMV10",16,0)
 W ! I +DGPMVI(19,1) W "Patient chose not to be included in the Facility Directory for this admission"
"RTN","DGPMV10",17,0)
 W !,$S("^4^5^"'[("^"_+DGPMVI(2)_"^"):"Admitted    ",1:"Checked-in  "),": "_$P(DGPMVI(13,1),"^",2)
"RTN","DGPMV10",18,0)
 W ?39,$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"Checked-out",+DGPMVI(2)=3:"Discharged ",1:"Transferred"),"    : ",$S("^1^4^"'[("^"_+DGPMVI(2)_"^"):$P(DGPMVI(3),"^",2),$P(DGPMVI(3),"^",2)'=$P(DGPMVI(13,1),"^",2):$P(DGPMVI(3),"^",2),1:"")
"RTN","DGPMV10",19,0)
 W !,"Ward        : ",$E($P(DGPMVI(5),"^",2),1,24),?39,"Room-Bed       : ",$E($P(DGPMVI(6),"^",2),1,21) I "^4^5^"'[("^"_+DGPMVI(2)_"^") W !,"Provider    : ",$E($P(DGPMVI(7),"^",2),1,26),?39,"Specialty      : ",$E($P(DGPMVI(8),"^",2),1,21)
"RTN","DGPMV10",20,0)
 W !,"Attending   : ",$E($P(DGPMVI(18),"^",2),1,26)
"RTN","DGPMV10",21,0)
 D CS2
"RTN","DGPMV10",22,0)
 S DGPMIFN=DGPMVI(13) I +DGPMVI(2)'=4&(+DGPMVI(2)'=5) D ^DGPMLOS W !!,"Admission LOS: ",+$P(X,"^",5),"  Absence days: ",+$P(X,"^",2),"  Pass Days: ",+$P(X,"^",3),"  ASIH days: ",+$P(X,"^",4)
"RTN","DGPMV10",23,0)
 K A,C,I,J,X
"RTN","DGPMV10",24,0)
 Q
"RTN","DGPMV10",25,0)
 ;
"RTN","DGPMV10",26,0)
CS2 ;-- additional fields for admission screen
"RTN","DGPMV10",27,0)
 Q:DGPMT'=1
"RTN","DGPMV10",28,0)
 S DGHOLD=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","DGPMV10",29,0)
 W !!,"Religion    : ",$S($D(^DIC(13,+$P(DGHOLD,U,8),0)):$E($P(^(0),U),1,24),1:"")
"RTN","DGPMV10",30,0)
 W ?39,"Marital Status : ",$S($D(^DIC(11,+$P(DGHOLD,U,5),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",31,0)
 S DGHOLD=$S($D(^DPT(DFN,.36)):$P(^(.36),U),1:"")
"RTN","DGPMV10",32,0)
 W !,"Eligibility : ",$S($D(^DIC(8,+$P(DGHOLD,U),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",33,0)
 S DGHOLD=$S($D(^DPT(DFN,.361)):^(.361),1:"")
"RTN","DGPMV10",34,0)
 W:$P(DGHOLD,U)]"" " (",$P($P($P(^DD(2,.3611,0),U,3),$P(DGHOLD,U)_":",2),";"),")"
"RTN","DGPMV10",35,0)
 W:$P(DGHOLD,U)']"" " (NOT VERIFIED)"
"RTN","DGPMV10",36,0)
 K DGHOLD
"RTN","DGPMV10",37,0)
 Q
"RTN","DGPMV10",38,0)
 ;
"RTN","DGPMV10",39,0)
LODGER ;set-up necessary variables if getting last lodger episode
"RTN","DGPMV10",40,0)
 ;only need 1,2,13,17 - date/time,TT,check-in IFN,check-out IFN
"RTN","DGPMV10",41,0)
 S I=$O(^DGPM("ATID4",DFN,0)),I=$O(^(+I,0))
"RTN","DGPMV10",42,0)
 S X=$S($D(^DGPM(+I,0)):^(0),1:"") I 'X D NULL Q
"RTN","DGPMV10",43,0)
 I $D(^DGPM(+$P(X,"^",17),0)) S (DGPMDCD,DGPMVI(1))=+^(0),DGPMVI(2)=5,DGPMVI(13)=I,DGPMVI(17)=$P(X,"^",17) Q
"RTN","DGPMV10",44,0)
 S (DGPMDCD,DGPMVI(17))="",DGPMVI(1)=+X,DGPMVI(2)=4,DGPMVI(13)=I
"RTN","DGPMV10",45,0)
 Q
"RTN","DGPMV10",46,0)
NULL S DGPMDCD="" F I=1,2,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",47,0)
 Q
"RTN","DGPMV10",48,0)
 ;
"RTN","DGPMV10",49,0)
INP ;set-up inpt vbls needed (mimic VAIP array)
"RTN","DGPMV10",50,0)
 ;
"RTN","DGPMV10",51,0)
 ;Called from scheduling, too
"RTN","DGPMV10",52,0)
 ;
"RTN","DGPMV10",53,0)
 D NOW^%DTC S (VAX("DAT"),NOW)=%,NOWI=9999999.999999-% I '$D(VAIP("E")) D LAST^VADPT3
"RTN","DGPMV10",54,0)
 F I=1:1:8,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",55,0)
 F I=13,19 S DGPMVI(I,1)=""
"RTN","DGPMV10",56,0)
 S DGPMVI(1)=$S($D(VAIP("E")):VAIP("E"),1:E) ;use ifn of last mvt from VADPT call or one passed from DGPMV
"RTN","DGPMV10",57,0)
 S DGX=$G(^DGPM(+DGPMVI(1),0)),DGPMVI(2)=$P(DGX,"^",2),DGPMVI(4)=$P(DGX,"^",18) S Y=+DGX X ^DD("DD") S DGPMVI(3)=$P(DGX,"^",1)_"^"_Y
"RTN","DGPMV10",58,0)
 S DGPMVI(5)=$P(DGX,"^",6)_"^"_$S($D(^DIC(42,+$P(DGX,"^",6),0)):$P(^(0),"^",1),1:""),DGPMVI(6)=$P(DGX,"^",7)_"^"_$S($D(^DG(405.4,+$P(DGX,"^",7),0)):$P(^(0),"^",1),1:""),DGPMVI(13)=$P(DGX,"^",14)
"RTN","DGPMV10",59,0)
 I "^3^5^"[("^"_DGPMVI(2)_"^") D GETWD ;get from ward if d/c or check-out
"RTN","DGPMV10",60,0)
 S DGX=$G(^DGPM(+DGPMVI(13),0)) I DGX]"" S Y=+DGX X ^DD("DD") S DGPMVI(13,1)=$P(DGX,"^",1)_"^"_Y,DGPMVI(17)=$P(DGX,"^",17) I $D(DGPMSVC) S DGPMSV=$P($G(^DIC(42,+$P(DGX,"^",6),0)),"^",3)
"RTN","DGPMV10",61,0)
 S DGPMDCD=$S($D(^DGPM(+DGPMVI(17),0)):$P(^(0),"^",1),1:"")
"RTN","DGPMV10",62,0)
 S (DGTS,DGPP,DGAP)="" ;t.s., primary care physician, attending
"RTN","DGPMV10",63,0)
 F I=NOWI:0 S I=$O(^DGPM("ATS",DFN,+DGPMVI(13),I)) Q:'I  F J=0:0 S J=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J)) Q:'J  F IFN=0:0 S IFN=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J,IFN)) Q:'IFN  D TS1 G TSQ:DGTS&DGPP&DGAP
"RTN","DGPMV10",64,0)
TSQ S DGPMVI(7)=DGPP,DGPMVI(8)=DGTS,DGPMVI(18)=DGAP
"RTN","DGPMV10",65,0)
 S DGX=$G(^DGPM(+DGPMVI(13),0)) I $P(DGX,"^",2)=1 D
"RTN","DGPMV10",66,0)
 .S DGX=$G(^DGPM(+DGPMVI(13),"DIR"))
"RTN","DGPMV10",67,0)
 .S DGX=$P(DGX,"^",1)
"RTN","DGPMV10",68,0)
 .I DGX="" S DGX=$S('DGPMDCD:1,(DGPMDCD<3030414.999999):"",1:1) Q:DGX=""
"RTN","DGPMV10",69,0)
 .S DGPMVI(19,1)=DGX_"^"_$$EXTERNAL^DILFD(405,41,,DGX)
"RTN","DGPMV10",70,0)
 D Q^VADPT3 K DGAP,DGPP,DGTS,DGX,IFN
"RTN","DGPMV10",71,0)
 Q
"RTN","DGPMV10",72,0)
 ;
"RTN","DGPMV10",73,0)
TS1 ; set DGTS, DGPP, and DGAP
"RTN","DGPMV10",74,0)
 Q:'$D(^DGPM(IFN,0))  S DGX=^(0)
"RTN","DGPMV10",75,0)
 I 'DGPP,$D(^VA(200,+$P(DGX,"^",8),0)) S Y=$P(DGX,"^",8)_"^"_$P(^(0),"^") S DGPP=Y
"RTN","DGPMV10",76,0)
 I 'DGAP,$D(^VA(200,+$P(DGX,"^",19),0)) S Y=$P(DGX,"^",19)_"^"_$P(^(0),"^") S DGAP=Y
"RTN","DGPMV10",77,0)
 I 'DGTS,$D(^DIC(45.7,+$P(DGX,"^",9),0)) S DGTS=$P(DGX,"^",9)_"^"_$P(^(0),"^")
"RTN","DGPMV10",78,0)
 Q
"RTN","DGPMV10",79,0)
GETWD ;get the from ward if last mvt is discharge or check-out
"RTN","DGPMV10",80,0)
 I DGPMVI(2)=5 S J=DGPMVI(13) D SETWD Q
"RTN","DGPMV10",81,0)
 F I=0:0 S I=$O(^DGPM("APMV",DFN,DGPMVI(13),I)) Q:'I!+DGPMVI(5)  F J=0:0 S J=$O(^DGPM("APMV",DFN,DGPMVI(13),I,J)) Q:'J  D SETWD Q:+DGPMVI(5)
"RTN","DGPMV10",82,0)
 Q
"RTN","DGPMV10",83,0)
 ;
"RTN","DGPMV10",84,0)
SETWD ;set ward and room-bed variables for discharge/check-out mvts
"RTN","DGPMV10",85,0)
 S X=$G(^DGPM(J,0))
"RTN","DGPMV10",86,0)
 I $D(^DIC(42,+$P(X,"^",6),0)) S DGPMVI(5)=$P(X,"^",6)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",87,0)
 I $D(^DG(405.4,+$P(X,"^",7),0)) S DGPMVI(6)=$P(X,"^",7)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",88,0)
 Q
"RTN","VADPT30")
0^2^B15191718
"RTN","VADPT30",1,0)
VADPT30 ;ALB/MJK - Current Inpatient Variables; 12 DEC 1988
"RTN","VADPT30",2,0)
 ;;5.3;Registration;**111,498,509**;Aug 13, 1993
"RTN","VADPT30",3,0)
 ;
"RTN","VADPT30",4,0)
VAR ; -- inpatient demographics variables
"RTN","VADPT30",5,0)
 ;  input: DFN, VATD  = inverse date ; VACN  =
"RTN","VADPT30",6,0)
 ;              VAPRC =              ; VAPRT =
"RTN","VADPT30",7,0)
 ;
"RTN","VADPT30",8,0)
 ; output: VAWD = ward ; VATS = tr. spec. ; VARM = room/bed
"RTN","VADPT30",9,0)
 ;         VAPP = doc  ; VADX = diagnosis ; VAMV = mv entry
"RTN","VADPT30",10,0)
 ;         VAAP = attending physician
"RTN","VADPT30",11,0)
 ;         VAFD = answer to facility directory question
"RTN","VADPT30",12,0)
 ;
"RTN","VADPT30",13,0)
 S (VAWDA,VAWD,VATS,VAMV,VARM,VAPP,VAAP,VADX,VAFD)="",VAID=VATD
"RTN","VADPT30",14,0)
 ; -- get mv
"RTN","VADPT30",15,0)
 D MV G VARQ:VAMV0']""
"RTN","VADPT30",16,0)
 S Y=$G(^DGPM(+$P(VAMV0,"^",14),0)) I $P(Y,"^",2)=1 D
"RTN","VADPT30",17,0)
 .N DCD
"RTN","VADPT30",18,0)
 .S DCD=+$P(Y,"^",17) I DCD S DCD=+$G(^DGPM(DCD,0))
"RTN","VADPT30",19,0)
 .S Y=$G(^DGPM(+$P(VAMV0,"^",14),"DIR"))
"RTN","VADPT30",20,0)
 .S Y=$P(Y,"^",1)
"RTN","VADPT30",21,0)
 .I Y="" S Y=$S('DCD:1,(DCD<3030414.999999):"",1:1) Q:Y=""
"RTN","VADPT30",22,0)
 .S VAFD=Y_"^"_$$EXTERNAL^DILFD(405,41,,Y)
"RTN","VADPT30",23,0)
 ; quit if not an adm or xfr
"RTN","VADPT30",24,0)
 I "^1^2^"'[("^"_$P(VAMV0,"^",2)_"^") G VARQ
"RTN","VADPT30",25,0)
 I 'VAPRC,"^2^3^13^25^26^43^44^45^"[("^"_VAMT_"^") G VARQ
"RTN","VADPT30",26,0)
 I VAPRC,"^13^43^44^45^"[("^"_VAMT_"^") G VARQ
"RTN","VADPT30",27,0)
 S:VAPRC VABO=$S(VAMT<4:VAMT,1:4) D GET
"RTN","VADPT30",28,0)
 ;I 'VACN,'VATS S VATS=TSD ;what is this
"RTN","VADPT30",29,0)
VARQ K VAMV0,VAMT,VAID
"RTN","VADPT30",30,0)
 Q
"RTN","VADPT30",31,0)
 ;
"RTN","VADPT30",32,0)
GET ; -- get variables and quit when all set(Y=1)
"RTN","VADPT30",33,0)
 S VACA=+$P(VAMV0,"^",14)
"RTN","VADPT30",34,0)
 D TS,SET G GETQ:Y
"RTN","VADPT30",35,0)
 F VAID=VATD:0 S VAID=$O(^DGPM("APMV",DFN,VACA,VAID)) Q:'VAID  F VAIFN=0:0 S VAIFN=$O(^DGPM("APMV",DFN,VACA,VAID,VAIFN)) Q:'VAIFN  I $D(^DGPM(VAIFN,0)) S VAMV0=^(0) D SET G GETQ:Y
"RTN","VADPT30",36,0)
GETQ K VACA,VAIFN,VAID Q
"RTN","VADPT30",37,0)
 ;
"RTN","VADPT30",38,0)
KVAR K VAMV,VAWDA,VAWD,VARM,VAPP,VAAP,VATS,VATD,VAPRC,VAPRT,VACN,VADX,VABO,VAFD Q
"RTN","VADPT30",39,0)
 ;
"RTN","VADPT30",40,0)
SET ; -- set variables if null
"RTN","VADPT30",41,0)
 S Y=0
"RTN","VADPT30",42,0)
 I 'VAWD,$D(^DIC(42,+$P(VAMV0,"^",6),0)) S VAWDA=$S($D(VAIFN):VAIFN,1:VAMV),VAWD=$P(VAMV0,"^",6)_"^"_$P(^(0),"^") S VARM="" I $D(^DG(405.4,+$P(VAMV0,"^",7),0)) S VARM=$P(VAMV0,"^",7)_"^"_$P(^(0),"^")
"RTN","VADPT30",43,0)
 I 'VACN,VAWD S Y=1
"RTN","VADPT30",44,0)
 N VARSTR
"RTN","VADPT30",45,0)
 S VARSTR="^^^^^VAWD^VARM^VAPP^VATS^VADX^^^^^^^^^VAAP^"
"RTN","VADPT30",46,0)
 S $P(VARSTR,"^",41)="VAFD"
"RTN","VADPT30",47,0)
 I VACN,'VAPRT,$D(DGPMDDF),@$P(VARSTR,"^",+DGPMDDF),VAMV S Y=1
"RTN","VADPT30",48,0)
 I VACN,VAPRT,VAWD,VAMV,VADX]"" S Y=1
"RTN","VADPT30",49,0)
 Q
"RTN","VADPT30",50,0)
 ;
"RTN","VADPT30",51,0)
TS ; set VADX, VATS, VAAP, and VAPP via VACA x-refs
"RTN","VADPT30",52,0)
 N VAMV0
"RTN","VADPT30",53,0)
 S:$D(^DGPM(VACA,0)) VADX=$P(^(0),"^",10)
"RTN","VADPT30",54,0)
 F VAID=VATD:0 S VAID=$O(^DGPM("ATS",DFN,VACA,VAID)) Q:'VAID  F VAT=0:0 S VAT=$O(^DGPM("ATS",DFN,VACA,VAID,VAT)) Q:'VAT  F VAIFN=0:0 S VAIFN=$O(^DGPM("ATS",DFN,VACA,VAID,VAT,VAIFN)) Q:'VAIFN  D TS1 G TSQ:VAPP&VATS&VAAP
"RTN","VADPT30",55,0)
TSQ K VAIFN,VAT Q
"RTN","VADPT30",56,0)
 ;
"RTN","VADPT30",57,0)
TS1 ; set VATS, VAPP, and VAAP
"RTN","VADPT30",58,0)
 Q:'$D(^DGPM(VAIFN,0))  S VAMV0=^(0)
"RTN","VADPT30",59,0)
 I 'VAPP,$D(^VA(200,+$P(VAMV0,"^",8),0)) S Y=$P(VAMV0,"^",8)_"^"_$P(^(0),"^") S VAPP=Y
"RTN","VADPT30",60,0)
 I 'VAAP,$D(^VA(200,+$P(VAMV0,"^",19),0)) S Y=$P(VAMV0,"^",19)_"^"_$P(^(0),"^") S VAAP=Y
"RTN","VADPT30",61,0)
 I 'VATS,$D(^DIC(45.7,+$P(VAMV0,"^",9),0)) S VATS=$P(VAMV0,"^",9)_"^"_$P(^(0),"^")
"RTN","VADPT30",62,0)
 Q
"RTN","VADPT30",63,0)
 ;
"RTN","VADPT30",64,0)
MV ; -- get latest mv for pt before VAID and not ASIH mv
"RTN","VADPT30",65,0)
 S (VAMV,VAMV0)=""
"RTN","VADPT30",66,0)
 F VAID=VAID:0 S VAID=$O(^DGPM("APID",DFN,VAID)) G MVQ:'VAID S VAMV=$O(^DGPM("APID",DFN,VAID,0)) I $D(^DGPM(+VAMV,0)) S VAMT=$P(^(0),"^",18) G MVQ:'VAMT Q:"^13^41^42^47^"'[("^"_VAMT_"^")
"RTN","VADPT30",67,0)
 S VAMV0=^DGPM(VAMV,0)
"RTN","VADPT30",68,0)
MVQ Q
"RTN","VADPT30",69,0)
 ;
"RTN","VADPT30",70,0)
A ;return current admission or last admission for patient
"RTN","VADPT30",71,0)
 S Y=$S($D(^DPT(DFN,.105)):+^(.105),1:0) G AQ:$D(^DGPM(Y,0))
"RTN","VADPT30",72,0)
 N VAID,VAMV,VAMV0
"RTN","VADPT30",73,0)
 F VAID=0:0 S VAID=$O(^DGPM("ATID1",DFN,VAID)) Q:'VAID  F VAMV=0:0 S VAMV=$O(^DGPM("ATID1",DFN,VAID,VAMV)) Q:'VAMV  I $D(^DGPM(VAMV,0)) S VAMV0=^(0) D DIS G AQ:Y
"RTN","VADPT30",74,0)
 S Y=0
"RTN","VADPT30",75,0)
AQ Q
"RTN","VADPT30",76,0)
 ;
"RTN","VADPT30",77,0)
DIS ; check for ASIH discharges
"RTN","VADPT30",78,0)
 S Y=$S('$D(^DGPM(+$P(VAMV0,"^",17),0)):VAMV,"^41^46"[(U_$P(^(0),"^",18)_U):0,1:VAMV)
"RTN","VADPT30",79,0)
 Q
"RTN","VADPT30",80,0)
 ;
"RTN","VADPT31")
0^3^B18415362
"RTN","VADPT31",1,0)
VADPT31 ;ALB/MRL/MJK - PATIENT VARIABLES [IN5], CONT.; 12 DEC 1988
"RTN","VADPT31",2,0)
 ;;5.3;Registration;**498,509**;Aug 13, 1993
"RTN","VADPT31",3,0)
 ;Inpatient variables [Version 5.0 and above]
"RTN","VADPT31",4,0)
EN N VAINDT,VAMV,VAMV0
"RTN","VADPT31",5,0)
 S VAMV=+E,VAMV0=^DGPM(VAMV,0),VAX("CA")=+$P(VAMV0,"^",14) G ENQ:'$D(^DGPM(+VAX("CA"),0))
"RTN","VADPT31",6,0)
 I $D(VAIP("M")) D CE G ENQ:'$D(^DGPM(+E,0)) S VAMV=+E,VAMV0=^(0)
"RTN","VADPT31",7,0)
 S @VAV@($P(VAS,"^",1))=E
"RTN","VADPT31",8,0)
 S Y=$P(VAMV0,"^",2),@VAV@($P(VAS,"^",2))=Y_"^"_$S($D(^DG(405.3,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",9,0)
 S Y=$S(+VAMV0:+VAMV0,1:"") X:Y ^DD("DD") S @VAV@($P(VAS,"^",3))=+VAMV0_"^"_Y
"RTN","VADPT31",10,0)
 S Y=$P(VAMV0,"^",18),@VAV@($P(VAS,"^",4))=Y_"^"_$S($D(^DG(405.2,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",11,0)
 S Y=+$P(^DGPM(VAX("CA"),0),"^",16) S:Y @VAV@($P(VAS,"^",12))=Y
"RTN","VADPT31",12,0)
 ;
"RTN","VADPT31",13,0)
 S VATD=VAX("DT") D FIND
"RTN","VADPT31",14,0)
 S @VAV@($P(VAS,"^",5))=VAWD,@VAV@($P(VAS,"^",6))=VARM,@VAV@($P(VAS,"^",7))=VAPP,@VAV@($P(VAS,"^",8))=VATS,@VAV@($P(VAS,"^",9))=VADX,@VAV@($P(VAS,"^",18))=VAAP
"RTN","VADPT31",15,0)
 ;
"RTN","VADPT31",16,0)
 S VANODE=$G(^DGPM(VAX("CA"),0)) I $P(VANODE,"^",2)=1  D
"RTN","VADPT31",17,0)
 .N DCD
"RTN","VADPT31",18,0)
 .S DCD=+$P(VANODE,"^",17) I DCD S DCD=+$G(^DGPM(DCD,0))
"RTN","VADPT31",19,0)
 .S VANODE=$G(^DGPM(VAX("CA"),"DIR"))
"RTN","VADPT31",20,0)
 .S Y=$P(VANODE,"^",1)
"RTN","VADPT31",21,0)
 .I Y="" S Y=$S('DCD:1,(DCD<3030414.999999):"",1:1) Q:Y=""
"RTN","VADPT31",22,0)
 .S @VAV@($P(VAS,"^",19),1)=Y_"^"_$$EXTERNAL^DILFD(405,41,,Y)
"RTN","VADPT31",23,0)
 .S Y=$P(VANODE,"^",2) S @VAV@($P(VAS,"^",19),2)=Y_"^"_$$EXTERNAL^DILFD(405,42,,Y)
"RTN","VADPT31",24,0)
 .S Y=$P(VANODE,"^",3) S @VAV@($P(VAS,"^",19),3)=Y_"^"_$$EXTERNAL^DILFD(405,43,,Y)
"RTN","VADPT31",25,0)
 ;
"RTN","VADPT31",26,0)
 S VAINDT=+VAMV0 D IB^VADPT2 S @VAV@($P(VAS,"^",10))=+VAZ
"RTN","VADPT31",27,0)
 I 'VAZ,$D(VAZ(2)),VAZ(2)?7N!(VAZ(2)?7N1".".N) S Y=VAZ(2) X ^DD("DD") S @VAV@($P(VAS,"^",11))=VAZ(2)_"^"_Y
"RTN","VADPT31",28,0)
 ;
"RTN","VADPT31",29,0)
 I $D(VAIP("M")) S VASET=$S(VAIP("M"):14,1:13),VASET(VASET)="",VANODE=$P(VAS,"^",VASET) D COPY ; last or adm
"RTN","VADPT31",30,0)
 I '$D(VAIP("M")),$D(VAIP("D")),"^l^L^"[("^"_$E(VAIP("D"))_"^") S VASET(14)="",VANODE=$P(VAS,"^",14) D COPY ; last
"RTN","VADPT31",31,0)
 I "^3^5^"[("^"_$P(VAMV0,"^",2)_"^") S VASET(17)="",VANODE=$P(VAS,"^",17) D COPY ; d/c
"RTN","VADPT31",32,0)
 I '$D(VASET(13)) S VAMV=VAX("CA"),VAMV0=^DGPM(VAMV,0),VANODE=$P(VAS,"^",13) D STORE ; adm
"RTN","VADPT31",33,0)
 D BLD^VADPT32 G ENQ:'$D(^UTILITY("VADPTZ",$J,DFN))
"RTN","VADPT31",34,0)
 S VAXE=$S($D(^UTILITY("VADPTZ",$J,DFN,1)):^(1),1:""),VAMV0=$P(VAXE,"||",2),VAMV=+VAXE
"RTN","VADPT31",35,0)
 I VAMV,"^3^5^"[("^"_$P(VAMV0,"^",2)_"^"),'$D(VASET(17)) S VANODE=$P(VAS,"^",17) D STORE ; d/c
"RTN","VADPT31",36,0)
 I VAMV,'$D(VASET(14)) S VANODE=$P(VAS,"^",14) D STORE ;last
"RTN","VADPT31",37,0)
 I $S('VANN:1,'$D(^UTILITY("VADPTZ",$J,DFN,+VANN)):1,1:0) G ENQ
"RTN","VADPT31",38,0)
 I $D(^UTILITY("VADPTZ",$J,DFN,VANN-1)) S VAXE=^(VANN-1),VAMV=+VAXE,VAMV0=$P(VAXE,"||",2) I VAMV S VANODE=$P(VAS,"^",16) D STORE ; following
"RTN","VADPT31",39,0)
 I $D(^UTILITY("VADPTZ",$J,DFN,VANN+1)) S VAXE=^(VANN+1),VAMV=+VAXE,VAMV0=$P(VAXE,"||",2) I VAMV S VANODE=$P(VAS,"^",15) D STORE ; prior
"RTN","VADPT31",40,0)
 ;
"RTN","VADPT31",41,0)
ENQ K VAMVX,VANODE,VAMCC,VAXE,VANN D KVAR^VADPT30 Q
"RTN","VADPT31",42,0)
 ;
"RTN","VADPT31",43,0)
FIND ;
"RTN","VADPT31",44,0)
 S VAMVX=VAMV,VAMV0X=VAMV0
"RTN","VADPT31",45,0)
 S (VAWD,VATS,VAMV,VARM,VAPP,VAAP,VADX)=""
"RTN","VADPT31",46,0)
 I $P(VAMV0,"^",2)=4!($P(VAMV0,"^",2)=5) D LODGER G FINDQ
"RTN","VADPT31",47,0)
 S VATD=9999999.999999-VATD,(VACN,VAPRC,VAPRT)=1 D GET^VADPT30
"RTN","VADPT31",48,0)
FINDQ S VAMV=VAMVX,VAMV0=VAMV0X K VAMVX,VAMV0X
"RTN","VADPT31",49,0)
 Q
"RTN","VADPT31",50,0)
 ;
"RTN","VADPT31",51,0)
CE I 'VAIP("M") S E=+VAX("CA") Q
"RTN","VADPT31",52,0)
 S E=$O(^DGPM("APMV",DFN,+VAX("CA"),0)) Q:E'>0  S E=$O(^DGPM("APMV",DFN,+VAX("CA"),E,0)) Q
"RTN","VADPT31",53,0)
 ;
"RTN","VADPT31",54,0)
STORE ; store 'other nodes'
"RTN","VADPT31",55,0)
 S @VAV@(VANODE)=+VAMV
"RTN","VADPT31",56,0)
 S Y=+VAMV0 X:Y ^DD("DD") S @VAV@(VANODE,1)=+VAMV0_"^"_Y
"RTN","VADPT31",57,0)
 S Y=$P(VAMV0,"^",2),@VAV@(VANODE,2)=Y_"^"_$S($D(^DG(405.3,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",58,0)
 S Y=$P(VAMV0,"^",18),@VAV@(VANODE,3)=Y_"^"_$S($D(^DG(405.2,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",59,0)
 S VATD=+VAMV0 D FIND
"RTN","VADPT31",60,0)
 S @VAV@(VANODE,4)=VAWD,@VAV@(VANODE,5)=VAPP,@VAV@(VANODE,6)=VATS,@VAV@(VANODE,7)=VADX
"RTN","VADPT31",61,0)
 Q
"RTN","VADPT31",62,0)
 ;
"RTN","VADPT31",63,0)
COPY ; copy from primary to other nodes
"RTN","VADPT31",64,0)
 S @VAV@(VANODE)=VAMV
"RTN","VADPT31",65,0)
 ; 1-mvt d/t ; 2-transaction type ; 3-mvt type
"RTN","VADPT31",66,0)
 S @VAV@(VANODE,1)=@VAV@($P(VAS,"^",3)),@VAV@(VANODE,2)=@VAV@($P(VAS,"^",2)),@VAV@(VANODE,3)=@VAV@($P(VAS,"^",4))
"RTN","VADPT31",67,0)
 ; 4-ward ; 5-doc ; 6-treat spec ; 7-dx
"RTN","VADPT31",68,0)
 S @VAV@(VANODE,4)=@VAV@($P(VAS,"^",5)),@VAV@(VANODE,5)=@VAV@($P(VAS,"^",7)),@VAV@(VANODE,6)=@VAV@($P(VAS,"^",8)),@VAV@(VANODE,7)=@VAV@($P(VAS,"^",9))
"RTN","VADPT31",69,0)
 Q
"RTN","VADPT31",70,0)
 ;
"RTN","VADPT31",71,0)
LODGER ; -- get lodger data
"RTN","VADPT31",72,0)
 S VAWD=$S($P(VAMV0,"^",2)=4:$P(VAMV0,"^",6),$D(^DGPM(+$P(VAMV0,"^",14),0)):$P(^(0),"^",6),1:"")
"RTN","VADPT31",73,0)
 S VAWD=$S($D(^DIC(42,+VAWD,0)):VAWD_"^"_$P(^(0),"^"),1:"")
"RTN","VADPT31",74,0)
 S VARM=$S($P(VAMV0,"^",2)=4:$P(VAMV0,"^",7),$D(^DGPM(+$P(VAMV0,"^",14),0)):$P(^(0),"^",7),1:"")
"RTN","VADPT31",75,0)
 S VARM=$S($D(^DG(405.4,+VARM,0)):VARM_"^"_$P(^(0),"^"),1:"")
"RTN","VADPT31",76,0)
 Q
"VER")
8.0^22.0
**END**
**END**
