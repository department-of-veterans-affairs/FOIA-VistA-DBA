Released DG*5.3*713 SEQ #651
Extracted from mail message
**KIDS**:DG*5.3*713^

**INSTALL NAME**
DG*5.3*713
"BLD",6771,0)
DG*5.3*713^REGISTRATION^0^3060627^y
"BLD",6771,1,0)
^^4^4^3060626^
"BLD",6771,1,1,0)
This patch corrects a system error when adding rated disabilities,
"BLD",6771,1,2,0)
data exceptions in the MPI for the "date last treated", printing of 
"BLD",6771,1,3,0)
the full SSN on the G&L report, and not generating UR admission 
"BLD",6771,1,4,0)
bulletins on ASIH transfers.  
"BLD",6771,4,0)
^9.64PA^^
"BLD",6771,"KRN",0)
^9.67PA^8989.52^19
"BLD",6771,"KRN",.4,0)
.4
"BLD",6771,"KRN",.401,0)
.401
"BLD",6771,"KRN",.402,0)
.402
"BLD",6771,"KRN",.403,0)
.403
"BLD",6771,"KRN",.5,0)
.5
"BLD",6771,"KRN",.84,0)
.84
"BLD",6771,"KRN",3.6,0)
3.6
"BLD",6771,"KRN",3.8,0)
3.8
"BLD",6771,"KRN",9.2,0)
9.2
"BLD",6771,"KRN",9.8,0)
9.8
"BLD",6771,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6771,"KRN",9.8,"NM",1,0)
DGRPDB^^0^B20319584
"BLD",6771,"KRN",9.8,"NM",2,0)
VAFCTF^^0^B9218723
"BLD",6771,"KRN",9.8,"NM",3,0)
DGPMGLP^^0^B22017750
"BLD",6771,"KRN",9.8,"NM",4,0)
DGPMV321^^0^B20512503
"BLD",6771,"KRN",9.8,"NM","B","DGPMGLP",3)

"BLD",6771,"KRN",9.8,"NM","B","DGPMV321",4)

"BLD",6771,"KRN",9.8,"NM","B","DGRPDB",1)

"BLD",6771,"KRN",9.8,"NM","B","VAFCTF",2)

"BLD",6771,"KRN",19,0)
19
"BLD",6771,"KRN",19.1,0)
19.1
"BLD",6771,"KRN",101,0)
101
"BLD",6771,"KRN",409.61,0)
409.61
"BLD",6771,"KRN",771,0)
771
"BLD",6771,"KRN",870,0)
870
"BLD",6771,"KRN",8989.51,0)
8989.51
"BLD",6771,"KRN",8989.52,0)
8989.52
"BLD",6771,"KRN",8994,0)
8994
"BLD",6771,"KRN","B",.4,.4)

"BLD",6771,"KRN","B",.401,.401)

"BLD",6771,"KRN","B",.402,.402)

"BLD",6771,"KRN","B",.403,.403)

"BLD",6771,"KRN","B",.5,.5)

"BLD",6771,"KRN","B",.84,.84)

"BLD",6771,"KRN","B",3.6,3.6)

"BLD",6771,"KRN","B",3.8,3.8)

"BLD",6771,"KRN","B",9.2,9.2)

"BLD",6771,"KRN","B",9.8,9.8)

"BLD",6771,"KRN","B",19,19)

"BLD",6771,"KRN","B",19.1,19.1)

"BLD",6771,"KRN","B",101,101)

"BLD",6771,"KRN","B",409.61,409.61)

"BLD",6771,"KRN","B",771,771)

"BLD",6771,"KRN","B",870,870)

"BLD",6771,"KRN","B",8989.51,8989.51)

"BLD",6771,"KRN","B",8989.52,8989.52)

"BLD",6771,"KRN","B",8994,8994)

"BLD",6771,"QUES",0)
^9.62^^
"BLD",6771,"REQB",0)
^9.611^4^4
"BLD",6771,"REQB",1,0)
DG*5.3*709^1
"BLD",6771,"REQB",2,0)
DG*5.3*515^1
"BLD",6771,"REQB",3,0)
DG*5.3*428^1
"BLD",6771,"REQB",4,0)
DG*5.3*208^1
"BLD",6771,"REQB","B","DG*5.3*208",4)

"BLD",6771,"REQB","B","DG*5.3*428",3)

"BLD",6771,"REQB","B","DG*5.3*515",2)

"BLD",6771,"REQB","B","DG*5.3*709",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
713^3060627
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3060627
"PKG",5,22,1,"PAH",1,1,1,0)
This patch corrects a system error when adding rated disabilities,
"PKG",5,22,1,"PAH",1,1,2,0)
data exceptions in the MPI for the "date last treated", printing of 
"PKG",5,22,1,"PAH",1,1,3,0)
the full SSN on the G&L report, and not generating UR admission 
"PKG",5,22,1,"PAH",1,1,4,0)
bulletins on ASIH transfers.  
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGPMGLP")
0^3^B22017750^B21935096
"RTN","DGPMGLP",1,0)
DGPMGLP ;ALB/LM/MJK - G&L PRINT ROUTINE; 27 APR 2003
"RTN","DGPMGLP",2,0)
 ;;5.3;Registration;**20,134,515,713**;Aug 13, 1993
"RTN","DGPMGLP",3,0)
 ;
"RTN","DGPMGLP",4,0)
A S DIE="^DG(43,",DA=1,DR="50///NOW" D ^DIE K DA,DR,DIE
"RTN","DGPMGLP",5,0)
 S (RA,LA)="",$P(RA,"-",66)="",$P(LA,"-",66)="" ;  RA=Right Arrows "-"   LA=Left Arrows "-"
"RTN","DGPMGLP",6,0)
 D 8
"RTN","DGPMGLP",7,0)
 F DGDIV=0:0 S DGDIV=$O(^UTILITY("DGT",$J,DGDIV)) Q:DGDIV=""  S DGINST=DGDIV F DGSRV=0:0 S DGSRV=$O(^UTILITY("DGT",$J,DGDIV,DGSRV)) D:'DGSRV COR Q:'DGSRV  D DIVHD,SRVHD,SCAN S:'$D(TTNAME) TTNAME="NT" D:$D(LEG)&(TTNAME'["NO TRANSACTION") FOOT
"RTN","DGPMGLP",8,0)
 S DGINST=$P(^DG(40.8,DGINST,0),"^",7),DGINST=$P(^DIC(4,DGINST,0),"^") D COR1
"RTN","DGPMGLP",9,0)
K K TTNAME,FMNAME,NAME,PTDATA,C,C1,DFN,FM,I,I1,I2,I3,L,LA,RA,TT,X,X1,Y,DGCR,DGDIV6,DGX,Y,J,DGINST
"RTN","DGPMGLP",10,0)
 S DA=1,DIE="^DG(43,",DR="61///NOW;50///@" D ^DIE
"RTN","DGPMGLP",11,0)
 K DA,DR,DIE
"RTN","DGPMGLP",12,0)
 Q
"RTN","DGPMGLP",13,0)
 ;
"RTN","DGPMGLP",14,0)
8 ; If there are no transactions
"RTN","DGPMGLP",15,0)
 F ORDER=0:0 S ORDER=$O(^DIC(42,"AGL",ORDER)) Q:'ORDER  F WARD=0:0 S WARD=$O(^DIC(42,"AGL",ORDER,WARD)) Q:'WARD  I $D(^DIC(42,WARD,0)) S X1=$P(^DIC(42,WARD,0),"^",3) I X1]"",X1'="NC" S DGSRV=$S(X1="NH":2,X1="D":3,1:1) D 88
"RTN","DGPMGLP",16,0)
 Q
"RTN","DGPMGLP",17,0)
88 S DGDIV=$S($P(^DIC(42,WARD,0),"^",11)']"":+$P(DGPM("GL"),"^",3),1:$P(^DIC(42,WARD,0),"^",11)) D PARAM S:'$D(^UTILITY("DGT",$J,DGDIV,DGSRV)) ^UTILITY("DGT",$J,DGDIV,DGSRV,"8888")=""
"RTN","DGPMGLP",18,0)
 Q
"RTN","DGPMGLP",19,0)
 ;
"RTN","DGPMGLP",20,0)
PARAM ; --check combine/separate parameter in 40.8
"RTN","DGPMGLP",21,0)
 S DGDIV6=$S($D(^DG(40.8,DGDIV,0)):+$P(^(0),"^",6),1:0),DGSRV=$S('DGDIV6:1,1:DGSRV) Q
"RTN","DGPMGLP",22,0)
 ;
"RTN","DGPMGLP",23,0)
DIVHD I $D(FF) W @IOF
"RTN","DGPMGLP",24,0)
 S FF=1
"RTN","DGPMGLP",25,0)
 W !?94,"Date/Time Printed: ",DGNOW
"RTN","DGPMGLP",26,0)
 W !?RM-22\2,"GAINS AND LOSSES SHEET"
"RTN","DGPMGLP",27,0)
 S X=$$NAME^VASITE(RD)
"RTN","DGPMGLP",28,0)
 I X']"" D
"RTN","DGPMGLP",29,0)
 .S X="VA MEDICAL CENTER"
"RTN","DGPMGLP",30,0)
 .S X=X_$S($D(^DG(40.8,+DGDIV,0)):", "_$P(^(0),"^"),1:"") S:DGDIV']"" X=X_" at "_DGINST
"RTN","DGPMGLP",31,0)
 W !?RM-$L(X)\2,X
"RTN","DGPMGLP",32,0)
 S X=RD D DW^%DTC
"RTN","DGPMGLP",33,0)
 S Z="PERIOD ENDING MIDNIGHT "_X_", "
"RTN","DGPMGLP",34,0)
 S Y=RD X ^DD("DD")
"RTN","DGPMGLP",35,0)
 S X=Z_Y
"RTN","DGPMGLP",36,0)
 W !?RM-$L(X)\2,X
"RTN","DGPMGLP",37,0)
 K X,Z,Y
"RTN","DGPMGLP",38,0)
 Q
"RTN","DGPMGLP",39,0)
 ;
"RTN","DGPMGLP",40,0)
SRVHD ; -- print service head
"RTN","DGPMGLP",41,0)
 S X=$P("MEDICAL CENTER^NHCU^DOMICILIARY","^",DGSRV)_" TOTALS"
"RTN","DGPMGLP",42,0)
 W !?RM-$L(X)\2,X
"RTN","DGPMGLP",43,0)
 Q
"RTN","DGPMGLP",44,0)
 ;
"RTN","DGPMGLP",45,0)
SCAN ; -- scan entries
"RTN","DGPMGLP",46,0)
 F TT=0:0 S TT=$O(^UTILITY("DGT",$J,DGDIV,DGSRV,TT)) Q:'TT  S TTNAME=$S($D(^DG(405.3,+TT,0)):$P(^(0),"^"),TT=9999:"NON-LOSSES",TT=8888:"NO TRANSACTION",1:"UNKNOWN TRANSACTION TYPE")_"(S): "_$J(+^UTILITY("DGT",$J,DGDIV,DGSRV,TT),4) D ^DGPMGLP1
"RTN","DGPMGLP",47,0)
 Q
"RTN","DGPMGLP",48,0)
 ;
"RTN","DGPMGLP",49,0)
FOOT W ! W:UL["-" !
"RTN","DGPMGLP",50,0)
 F L=1:1:131 W UL
"RTN","DGPMGLP",51,0)
 S C=0,X=""
"RTN","DGPMGLP",52,0)
 F I="+","*","#","!","a","b","c","g","r" S C=C+1 I $D(LEG(I)) S X="'"_I_"' - "_$P($T(LEG+C),";;",2)_"; " W:$X>(131-$L(X)) ! W X
"RTN","DGPMGLP",53,0)
 W !
"RTN","DGPMGLP",54,0)
 Q
"RTN","DGPMGLP",55,0)
 ;
"RTN","DGPMGLP",56,0)
LEG ;  Legend
"RTN","DGPMGLP",57,0)
 ;;Third Party Reimbursement Candidate
"RTN","DGPMGLP",58,0)
 ;;While in Absent Sick in Hospital Status (ASIH)
"RTN","DGPMGLP",59,0)
 ;;Discharge within 48 hours of admission
"RTN","DGPMGLP",60,0)
 ;;While in Absence Status (authorized/unauthorized absence)
"RTN","DGPMGLP",61,0)
 ;;MT Copay Exempt
"RTN","DGPMGLP",62,0)
 ;;Category 'B' Veteran
"RTN","DGPMGLP",63,0)
 ;;MT Copay Required
"RTN","DGPMGLP",64,0)
 ;;GMT Copay Required
"RTN","DGPMGLP",65,0)
 ;;Current Means Test Required but not completed
"RTN","DGPMGLP",66,0)
 Q
"RTN","DGPMGLP",67,0)
 ;
"RTN","DGPMGLP",68,0)
LINES W !!!
"RTN","DGPMGLP",69,0)
 Q
"RTN","DGPMGLP",70,0)
COR ;  From the Medical Center Division File, Census Multiple, Corrections to the Previous G&L's word processing field
"RTN","DGPMGLP",71,0)
 ;
"RTN","DGPMGLP",72,0)
 I $D(^DG(40.8,DGDIV,"CEN",RD,"A")) F I=0:0 S I=$O(^DG(40.8,DGDIV,"CEN",RD,"A",I)) Q:I=""  D:$Y>62 DIVHD,LINES W !,^DG(40.8,DGDIV,"CEN",RD,"A",I,0)
"RTN","DGPMGLP",73,0)
 Q
"RTN","DGPMGLP",74,0)
 ;
"RTN","DGPMGLP",75,0)
COR1 ;  From the G&L Corrections File
"RTN","DGPMGLP",76,0)
 ;
"RTN","DGPMGLP",77,0)
 I '$D(^UTILITY($J,"CR")) F I=0:0 S I=$O(^DGS(43.5,"B",RD,I)) Q:I=""  I $D(^DGS(43.5,I,0)) S DGCR=^(0),^UTILITY($J,"CR",$S($D(^DPT(+$P(DGCR,"^",5),0)):$P(^(0),"^",1),1:"")_I)=DGCR
"RTN","DGPMGLP",78,0)
 I $D(^UTILITY($J,"CR")) D DIVHD,LINES ; to print G&L Corrections File on separate page
"RTN","DGPMGLP",79,0)
 S I="" F J=0:0 S I=$O(^UTILITY($J,"CR",I)) Q:I=""  S DGCR=^(I) D COR2,CORR
"RTN","DGPMGLP",80,0)
 Q
"RTN","DGPMGLP",81,0)
 ;
"RTN","DGPMGLP",82,0)
COR2 Q:'$D(DGCR)
"RTN","DGPMGLP",83,0)
 S DGX=$S($D(^DG(43.61,$P(DGCR,"^",2),0)):$P(^DG(43.61,$P(DGCR,"^",2),0),"^"),1:"")
"RTN","DGPMGLP",84,0)
 Q
"RTN","DGPMGLP",85,0)
 ;
"RTN","DGPMGLP",86,0)
CORR D:$Y>62 DIVHD,LINES
"RTN","DGPMGLP",87,0)
 W !,DGX ; Type of change
"RTN","DGPMGLP",88,0)
 W " For ",$S($D(^DPT(+$P(DGCR,"^",5),0)):$P(^(0),"^",1)_"  "_$E($P(^(0),"^",9),6,9),1:" ") ; Patient name and SSN
"RTN","DGPMGLP",89,0)
 I $P(DGCR,"^",6)]"" S Y=$P(DGCR,"^",6) X ^DD("DD") W " For admission of ",Y
"RTN","DGPMGLP",90,0)
 I $P(DGCR,"^",9)]"" S Y=$P(DGCR,"^",9) X ^DD("DD") W ", transfer of ",Y
"RTN","DGPMGLP",91,0)
 I $P(DGCR,"^",3)]"" W " Old value: ",$P(DGCR,"^",3)
"RTN","DGPMGLP",92,0)
 I $P(DGCR,"^",4)]"" W " New value: ",$P(DGCR,"^",4)
"RTN","DGPMGLP",93,0)
 Q
"RTN","DGPMV321")
0^4^B20512503^B20175654
"RTN","DGPMV321",1,0)
DGPMV321 ;ALB/MIR - ASIH TRANSFER ; 10 DEC 89 @9
"RTN","DGPMV321",2,0)
 ;;5.3;Registration;**40,208,713**;Aug 13, 1993
"RTN","DGPMV321",3,0)
ECA ;Edit corresponding admission for ASIH transfers
"RTN","DGPMV321",4,0)
 S DGPMTN=DGPMA,DGPMNI=DGPMCA D FINDLAST^DGPMV32
"RTN","DGPMV321",5,0)
 S DGPMNA=0,DGPMAA=$P(DGPMA,"^",15) I '$D(^DGPM(+DGPMAA,0)) D NEW S DGPMNA=1,DIE("NO^")=""
"RTN","DGPMV321",6,0)
 W !,"Editing Corresponding Hospital Admission",!
"RTN","DGPMV321",7,0)
 I 'DGPMNA,$D(^DGPM(+DGPMAA,0)) S DA=$P(^(0),"^",16) I $D(^DGPT(+DA,0)) S DIE="^DGPT(",DR="2////"_+DGPMA_";20;" K DQ,DG D ^DIE W ! ;update admission d/t in PTF
"RTN","DGPMV321",8,0)
 ;update pseudo discharge
"RTN","DGPMV321",9,0)
 S X1=+DGPMAB,X2=30 D C^%DTC
"RTN","DGPMV321",10,0)
 I 'DGPMNA,(+DGPMA'=+DGPMP) S DA=$P(DGPMAN,"^",17) I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,3,DA,"P")=$S($D(^UTILITY("DGPM",$J,3,DA,"P")):^("P"),1:^DGPM(DA,0)),DIE="^DGPM(",DR=".01///"_X K DQ,DG D ^DIE S ^UTILITY("DGPM",$J,3,DA,"A")=^DGPM(DA,0)
"RTN","DGPMV321",11,0)
 S DA=DGPMAA,DR="[DGPM ASIH ADMIT]",DIE="^DGPM(" I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,1,DA,"P")=$S($D(^UTILITY("DGPM",$J,1,DA,"P")):^("P"),1:^DGPM(DA,0)) S:DGPMN DIE("NO^")="" K DQ,DG D ^DIE S ^UTILITY("DGPM",$J,1,DA,"A")=^DGPM(DA,0)
"RTN","DGPMV321",12,0)
 I '$P(^DGPM(DGPMDA,0),"^",6) D UNDO^DGPMV322 Q
"RTN","DGPMV321",13,0)
 S:$D(Y) DGPMOUT=1 S Y=DGPMAA_"^1" D:'DGPMOUT SPEC^DGPMV36
"RTN","DGPMV321",14,0)
 I '$D(^DGPM("APHY",DGPMAA)) D UNDO^DGPMV322 Q
"RTN","DGPMV321",15,0)
 ; DG*713 - send admission bulletin
"RTN","DGPMV321",16,0)
 D ^DGPMVBUR
"RTN","DGPMV321",17,0)
 K DGPMAA,DGPMAB,DGPMNA,DGPMPTF Q
"RTN","DGPMV321",18,0)
UHD ;Update hospital discharge and PTF record
"RTN","DGPMV321",19,0)
 S X=("^"_$P(DGPM0,"^",18)_"^") G:"^43^45^"[X DEL Q:"^13^44^"'[X
"RTN","DGPMV321",20,0)
 ;Update hospital discharge
"RTN","DGPMV321",21,0)
 G DEL:(+DGPMA=+DGPMP)
"RTN","DGPMV321",22,0)
 S DA=$S($D(^DGPM(+$P(DGPM0,"^",15),0)):$P(^(0),"^",17),1:0)
"RTN","DGPMV321",23,0)
 I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,3,DA,"P")=$S($D(^UTILITY("DGPM",$J,3,DA,"P")):^("P"),1:^DGPM(DA,0)),DR=".01///"_+DGPMA_";102////"_DUZ_";103///NOW",DIE="^DGPM(" K DQ,DG D ^DIE S ^UTILITY("DGPM",$J,3,DA,"A")=^DGPM(DA,0)
"RTN","DGPMV321",24,0)
 I +DGPMP'=+DGPMA S DA=$P(^DGPM(+$P(DGPM0,"^",15),0),"^",16) I $D(^DGPT(+DA,0)) S DIE="^DGPT(",DR="70////"_+DGPMA K DQ,DG D ^DIE ;update discharge date for hospital PTF
"RTN","DGPMV321",25,0)
DEL ;conditionally delete WHILE ASIH or DISCHARGE FROM NHCU/DOM WHILE ASIH discharge if no longer ASIH
"RTN","DGPMV321",26,0)
 I DGPMTYP="^14^",$P(DGPMAN,U,17) D
"RTN","DGPMV321",27,0)
 . N X
"RTN","DGPMV321",28,0)
 . S X=$G(^DGPM(+$P(DGPMAN,U,17),0)) ; discharge node
"RTN","DGPMV321",29,0)
 . I $P(X,"^",18)'=42,($P(X,"^",18)'=47) Q  ; not WHILE ASIH or DISCHARGE FROM NHCU/DOM WHILE ASIH
"RTN","DGPMV321",30,0)
 . S X=9999999.9999999-+X ; inverse date of discharge movement
"RTN","DGPMV321",31,0)
 . S X=$O(^DGPM("APMV",DFN,DGPMCA,X)),X=$O(^(+X,0)) ; last movement ien
"RTN","DGPMV321",32,0)
 . S X=$P($G(^DGPM(+X,0)),"^",18) I "^13^43^44^45^"[("^"_X_"^") Q  ; still actively ASIH
"RTN","DGPMV321",33,0)
 . S DGPMAA=DGPMAN,DGPMAI=DGPMCA
"RTN","DGPMV321",34,0)
 . D DEL^DGPMV331
"RTN","DGPMV321",35,0)
 Q
"RTN","DGPMV321",36,0)
NEW ;Add new corresponding admission to file
"RTN","DGPMV321",37,0)
 W !!,"Creating new hospital admission"
"RTN","DGPMV321",38,0)
 S DGMAS=40 D FAMT^DGPMV30 ; get active mvt type for TO ASIH admission
"RTN","DGPMV321",39,0)
 S X=+DGPMA,DGPM0ND=+DGPMA_"^"_1_"^"_DFN_"^"_DGFAC_"^^^^^^^^^^"_DA_"^^^^^^^"_+DGPMDA_"^"_2 D NEW^DGPMV3 S DGPMAA=+Y K DGFAC
"RTN","DGPMV321",40,0)
 S ^UTILITY("DGPM",$J,1,+Y,"P")="",^UTILITY("DGPM",$J,1,+Y,"A")=$G(^DGPM(+Y,0))
"RTN","DGPMV321",41,0)
 ;
"RTN","DGPMV321",42,0)
 ;now update transfer movement with ASIH ADMISSION and ASIH SEQUENCE
"RTN","DGPMV321",43,0)
 S DIE="^DGPM(",DA=DGPMDA,DR=".15////"_DGPMAA_";.22////"_1 K DQ,DG D ^DIE
"RTN","DGPMV321",44,0)
 ;
"RTN","DGPMV321",45,0)
 ;create new PTF entry
"RTN","DGPMV321",46,0)
 W !,"Creating PTF record for new hospital admission",!
"RTN","DGPMV321",47,0)
 S Y=+DGPMA D CREATE^DGPTFCR S DGPMPTF=+Y
"RTN","DGPMV321",48,0)
 ;
"RTN","DGPMV321",49,0)
 ;update hospital admission with PTF NUMBER 
"RTN","DGPMV321",50,0)
 S DIE="^DGPM(",DA=DGPMAA,DR=".16////"_DGPMPTF K DQ,DG I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,1,DA,"P")=$S($D(^UTILITY("DGPM",$J,1,DA,"P")):^("P"),1:^DGPM(DA,0)) D ^DIE S ^UTILITY("DGPM",$J,1,DA,"A")=^DGPM(DA,0)
"RTN","DGPMV321",51,0)
 Q:DGPMTYP="^44^"  ;if RESUME ASIH, already have 30 day discharge
"RTN","DGPMV321",52,0)
 ;
"RTN","DGPMV321",53,0)
ASIHOF ;entry when transferring TO ASIH (OTHER FACILITY) to create 30 day discharge
"RTN","DGPMV321",54,0)
 ;create pseudo discharge for NHCU/DOM admission - 30 days from first transfer of TO ASIH or TO ASIH (OTHER FACILITY)
"RTN","DGPMV321",55,0)
 W !,"Creating 30 day pseudo discharge for NHCU/DOM admission"
"RTN","DGPMV321",56,0)
 S DGMAS=42 D FAMT^DGPMV30 ; get active mvt type for WHILE ASIH discharge
"RTN","DGPMV321",57,0)
 S X1=+DGPMAB,X2=30 D C^%DTC S DGPMPD=X,DGPM0ND=X_"^"_3_"^"_DFN_"^"_DGFAC_"^^^^^^^^^^"_+DGPMCA,Y=+$P($G(^DGPM(+DGPMCA,0)),U,17)
"RTN","DGPMV321",58,0)
 I $P($G(^DGPM(+Y,0)),U,4)=DGFAC D
"RTN","DGPMV321",59,0)
 .N DIE,DA S DIE="^DGPM(",DA=+Y N Y S DR=".01////^S X="_X D ^DIE
"RTN","DGPMV321",60,0)
 D:'Y NEW^DGPMV3 S DGPMAD=+Y K DGFAC
"RTN","DGPMV321",61,0)
 S ^UTILITY("DGPM",$J,3,+Y,"P")="",^UTILITY("DGPM",$J,3,+Y,"A")=$G(^DGPM(+Y,0))
"RTN","DGPMV321",62,0)
 ;
"RTN","DGPMV321",63,0)
 ;update NHCU/DOM PTF entry with DISCHARGE DATE, TYPE OF DISPOSITION
"RTN","DGPMV321",64,0)
 S DIE="^DGPT(",DA=$P(DGPMAN,"^",16),DR="70////"_DGPMPD_";72////"_1 K DQ,DG I $D(^DGPT(+DA,0)) D ^DIE
"RTN","DGPMV321",65,0)
 ;
"RTN","DGPMV321",66,0)
 ;update NHCU admission with DISCHARGE MOVEMENT
"RTN","DGPMV321",67,0)
 K DGPMAD,DGPMPD,DGPMPTF Q
"RTN","DGRPDB")
0^1^B20319584^B20476702
"RTN","DGRPDB",1,0)
DGRPDB ;ALB/AAS,JAN,ERC,PHH - VIEW ONLY SCREEN TO DETERMINE BILLING ELIGIBILITY ; 3/23/06 8:16am
"RTN","DGRPDB",2,0)
 ;;5.3;Registration;**26,50,358,570,631,709,713**;Aug 13, 1993
"RTN","DGRPDB",3,0)
 ;
"RTN","DGRPDB",4,0)
% S:'$D(DGQUIT) DGQUIT=0
"RTN","DGRPDB",5,0)
 G:DGQUIT END S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC G:+Y<1 END S DFN=+Y D EN
"RTN","DGRPDB",6,0)
 G %
"RTN","DGRPDB",7,0)
 ;
"RTN","DGRPDB",8,0)
EN ;entry with DFN defined.
"RTN","DGRPDB",9,0)
 Q:'$D(DFN)  D HOME^%ZIS,2^VADPT,HDR
"RTN","DGRPDB",10,0)
 D MT,AOIR,ELIG,DIS
"RTN","DGRPDB",11,0)
 N DGINS
"RTN","DGRPDB",12,0)
 I $$INSUR^IBBAPI(DFN,"","AR",.DGINS,1)
"RTN","DGRPDB",13,0)
 S C="",C=$O(DGINS("IBBAPI","INSUR",C),-1),C=+C+6
"RTN","DGRPDB",14,0)
 D:($Y>(IOSL-C)) PAUSE,HDR:'DGQUIT Q:DGQUIT  D INS,PAUSE
"RTN","DGRPDB",15,0)
 Q
"RTN","DGRPDB",16,0)
 ;
"RTN","DGRPDB",17,0)
ELIG ;eligibility code(s)
"RTN","DGRPDB",18,0)
 W !!," Primary Elig. Code: ",$P(VAEL(1),"^",2),"  --  ",$S(VAEL(8)']"":"NOT VERIFIED",1:$P(VAEL(8),"^",2))
"RTN","DGRPDB",19,0)
 I VAEL(8)]"" S Y=$S($D(^DPT(DFN,.361)):$P(^(.361),"^",2),1:"") W "  " D DT^DIQ
"RTN","DGRPDB",20,0)
 W !,"Other Elig. Code(s): " I $D(VAEL(1))>9 S I1=0 F I=0:0 S I=$O(VAEL(1,I)) Q:'I  S I1=I1+1 W:I1>1 !?21 W $P(VAEL(1,I),"^",2)
"RTN","DGRPDB",21,0)
 E  W "NO ADDITIONAL ELIGIBILITIES IDENTIFIED"
"RTN","DGRPDB",22,0)
 Q
"RTN","DGRPDB",23,0)
 ;
"RTN","DGRPDB",24,0)
DIS ;rated disabilities - Integration Agreement #700
"RTN","DGRPDB",25,0)
 ;
"RTN","DGRPDB",26,0)
 ;  This is called from the FEE and MCCR package!!!
"RTN","DGRPDB",27,0)
 ;
"RTN","DGRPDB",28,0)
 ;  Input:  DFN as IEN of PATIENT file
"RTN","DGRPDB",29,0)
 ;          VAEL array (if no passed, it is set) of eligibility info
"RTN","DGRPDB",30,0)
 ;
"RTN","DGRPDB",31,0)
 I '$D(VAEL) D ELIG^VADPT S DGKVAR=1
"RTN","DGRPDB",32,0)
 W:'+VAEL(3) !!,"  Service Connected: NO" W:+VAEL(3) !!,"         SC Percent: ",$P(VAEL(3),"^",2)_"%"
"RTN","DGRPDB",33,0)
 N DGQUIT
"RTN","DGRPDB",34,0)
 W !," Rated Disabilities: " I 'VAEL(4),$S('$D(^DG(391,+VAEL(6),0)):1,$P(^(0),"^",2):0,1:1) W "NOT A VETERAN" G DISQ
"RTN","DGRPDB",35,0)
 S I3=0 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I!($G(DGQUIT)=1)  D
"RTN","DGRPDB",36,0)
 . S I1=^(I,0),I2=$S($D(^DIC(31,+I1,0)):$P(^(0),"^",1)_" ("_+$P(I1,"^",2)_"%-"_$S($P(I1,"^",3):"SC",$P(I1,"^",3)']"":"not specified",1:"NSC")_")",1:""),I3=I3+1
"RTN","DGRPDB",37,0)
 . I $Y>(IOSL-3) D PAUSE I $G(DGQUIT)=0 W @IOF
"RTN","DGRPDB",38,0)
 . I $G(DGQUIT)=1 Q
"RTN","DGRPDB",39,0)
 . W:I3>1 !?21 W I2
"RTN","DGRPDB",40,0)
 W:'I3 "NONE STATED"
"RTN","DGRPDB",41,0)
DISQ I $D(DGKVAR) D KVAR^VADPT K DGKVAR
"RTN","DGRPDB",42,0)
 K I,I1,I2,I3
"RTN","DGRPDB",43,0)
 Q
"RTN","DGRPDB",44,0)
 ;
"RTN","DGRPDB",45,0)
INS ;insurance information
"RTN","DGRPDB",46,0)
 ;
"RTN","DGRPDB",47,0)
 ;  This is called form the FEE package!!!
"RTN","DGRPDB",48,0)
 ;
"RTN","DGRPDB",49,0)
 ;  Input:  DFN as IEN of PATIENT file
"RTN","DGRPDB",50,0)
 ;          DGINSDT as date to compute insurance flag as of (default DT)
"RTN","DGRPDB",51,0)
 ;
"RTN","DGRPDB",52,0)
 Q:'$D(DFN)
"RTN","DGRPDB",53,0)
 W !!,"    Health Insurance: "
"RTN","DGRPDB",54,0)
 S Z=$$INSUR^IBBAPI(DFN,$S($D(DGINSDT):DGINSDT,1:DT))
"RTN","DGRPDB",55,0)
 W $S(Z:"YES",1:"NO")
"RTN","DGRPDB",56,0)
 D DISP^DGIBDSP
"RTN","DGRPDB",57,0)
INSQ K I,I1,DGX,Z
"RTN","DGRPDB",58,0)
 Q
"RTN","DGRPDB",59,0)
 ;
"RTN","DGRPDB",60,0)
IN ; Old code
"RTN","DGRPDB",61,0)
 Q
"RTN","DGRPDB",62,0)
 ;
"RTN","DGRPDB",63,0)
AOIR ;Agent Orange/ionizing radiation
"RTN","DGRPDB",64,0)
 S DGX=$S($D(^DPT(DFN,.321)):^(.321),1:"")
"RTN","DGRPDB",65,0)
 F I=2,3 S X=$P(DGX,"^",I) W:I=2 !,"           A/O Exp.: " W:I=3 "ION Rad.: " W $S(X="Y":"YES",X="N":"NO",X="U":"UNKNOWN",1:"NOT ANSWERED"),"   "
"RTN","DGRPDB",66,0)
 S X=$G(^DPT(DFN,.38)),X1=$P(X,"^",1) W "Medicaid Elig: ",$S(X1="":"NOT ANSWERED",'X1:"NO",1:"YES") I ($X+15)'>IOM W " - " S Y=$P(X,"^",2) D D^DIQ W $P(Y,"@")
"RTN","DGRPDB",67,0)
 Q
"RTN","DGRPDB",68,0)
 ;
"RTN","DGRPDB",69,0)
PAUSE F J=1:1 Q:($Y>(IOSL-3))  W !
"RTN","DGRPDB",70,0)
 S DGX1="" I $E(IOST,1,2)["C-" N DIR S DIR(0)="E" D ^DIR S DGQUIT='Y
"RTN","DGRPDB",71,0)
 Q
"RTN","DGRPDB",72,0)
 ;
"RTN","DGRPDB",73,0)
HDR ;Screen Header
"RTN","DGRPDB",74,0)
 W @IOF I $P(VAEL(6),"^",2)]"" S DGTYPE=$P(VAEL(6),"^",2)
"RTN","DGRPDB",75,0)
 W $P(VADM(1),"^",1),?32,VA("PID"),?47,$P(VADM(3),"^",2) S X=$S($D(DGTYPE):$P(DGTYPE,"^",1),1:"PATIENT TYPE UNKNOWN"),X1=79-$L(X) W ?X1,X
"RTN","DGRPDB",76,0)
 S X="",$P(X,"=",80)="" W !,X Q
"RTN","DGRPDB",77,0)
 Q
"RTN","DGRPDB",78,0)
 ;
"RTN","DGRPDB",79,0)
MT I '$O(^DGMT(408.31,"AD",1,DFN,0)) W !,"  Means Test Status:  NOT IN MEANS TEST FILE" Q
"RTN","DGRPDB",80,0)
 ;if patient is on a DOM ward, don't display Means Test required message
"RTN","DGRPDB",81,0)
 D DOM^DGMTR D:'$G(DGDOM) DIS^DGMTU(DFN) K DGDOM
"RTN","DGRPDB",82,0)
 Q
"RTN","DGRPDB",83,0)
 ;
"RTN","DGRPDB",84,0)
END D KVAR^VADPT
"RTN","DGRPDB",85,0)
 K A,C,I,I1,I2,I3,J,DIC,DIR,DFN,DGA1,DGMT,DGMTL,DGMTLA,DGX,DGX1,DGT,DGTYPE,DGQUIT,DGMTLL,X,X1,VAROOT,VA,Y,Z
"RTN","DGRPDB",86,0)
 Q
"RTN","DGRPDB",87,0)
 ;
"RTN","DGRPDB",88,0)
RDIS(DGDFN,DGARR) ;API to return all Rated Disabilities from the 
"RTN","DGRPDB",89,0)
 ;Patient file for a patient using an array.  Returned in descending Service Connected percent.
"RTN","DGRPDB",90,0)
 ;
"RTN","DGRPDB",91,0)
 ; Integration Agreement #4807
"RTN","DGRPDB",92,0)
 ; 
"RTN","DGRPDB",93,0)
 ;Input          DGDFN - IEN of patient file (required)
"RTN","DGRPDB",94,0)
 ;Input/Output   DGARR - name of array for returned disability info (required)
"RTN","DGRPDB",95,0)
 ;               piece 1 - Disability IEN (in file 31)
"RTN","DGRPDB",96,0)
 ;               piece 2 - Disability %
"RTN","DGRPDB",97,0)
 ;               piece 3 - SC? (1,0)
"RTN","DGRPDB",98,0)
 ;               piece 4 - extremity affected
"RTN","DGRPDB",99,0)
 ;               piece 5 - original effective date
"RTN","DGRPDB",100,0)
 ;               piece 6 - current effective date
"RTN","DGRPDB",101,0)
 ;Output 1=successful and array returned with data
"RTN","DGRPDB",102,0)
 ;       0=unsuccessful and no array
"RTN","DGRPDB",103,0)
 ;         
"RTN","DGRPDB",104,0)
 N DGARR1,DGC,DGCC,DGERR,DGNODE,DGCT,DGE,DGEE
"RTN","DGRPDB",105,0)
 K DGW,DGARR
"RTN","DGRPDB",106,0)
 I $G(DGDFN)']"" Q 0
"RTN","DGRPDB",107,0)
 I '$D(^DPT(DGDFN,0)) Q 0
"RTN","DGRPDB",108,0)
 D GETS^DIQ(2,DGDFN,".3721*","I","DGARR1","DGERR")
"RTN","DGRPDB",109,0)
 I $D(DGERR) Q 0
"RTN","DGRPDB",110,0)
 S DGCC=0
"RTN","DGRPDB",111,0)
 S DGCC=$O(^DPT(DGDFN,.372,DGCC))
"RTN","DGRPDB",112,0)
 I 'DGCC Q 0
"RTN","DGRPDB",113,0)
 S DGC=""
"RTN","DGRPDB",114,0)
 F  S DGC=$O(DGARR1(2.04,DGC)) Q:DGC']""  D
"RTN","DGRPDB",115,0)
 . S DGNODE=DGC
"RTN","DGRPDB",116,0)
 . S DGARR(DGC)=DGARR1(2.04,DGNODE,.01,"I")_"^"_DGARR1(2.04,DGNODE,2,"I")_"^"_DGARR1(2.04,DGNODE,3,"I")_"^"_DGARR1(2.04,DGNODE,4,"I")_"^"_DGARR1(2.04,DGNODE,5,"I")_"^"_DGARR1(2.04,DGNODE,6,"I")
"RTN","DGRPDB",117,0)
 S DGE=""
"RTN","DGRPDB",118,0)
 F  S DGE=$O(DGARR(DGE)) Q:'DGE  D
"RTN","DGRPDB",119,0)
 . I $P(DGARR(DGE),U,2)="" S $P(DGARR(DGE),U,2)=0
"RTN","DGRPDB",120,0)
 . S DGW($P(DGARR(DGE),U,2),$P(DGE,",",1))=DGARR(DGE)
"RTN","DGRPDB",121,0)
 S DGE="",DGCT=1
"RTN","DGRPDB",122,0)
 K DGARR
"RTN","DGRPDB",123,0)
 F  S DGE=$O(DGW(DGE),-1) Q:DGE']""  D
"RTN","DGRPDB",124,0)
 . F DGEE=0:0 S DGEE=$O(DGW(DGE,DGEE)) Q:DGEE'>0  D
"RTN","DGRPDB",125,0)
 . . S DGARR(DGCT)=DGW(DGE,DGEE) S DGCT=DGCT+1
"RTN","DGRPDB",126,0)
 K DGW
"RTN","DGRPDB",127,0)
 Q 1
"RTN","DGRPDB",128,0)
 ;
"RTN","VAFCTF")
0^2^B9218723^B8943810
"RTN","VAFCTF",1,0)
VAFCTF ;BIR/DLR-Utility for capturing patient's Date Last Treated and Event Reason ;9/9/2002
"RTN","VAFCTF",2,0)
 ;;5.3;Registration;**428,713**;Aug 13, 1993
"RTN","VAFCTF",3,0)
 Q  ; quit if called from the top
"RTN","VAFCTF",4,0)
 ;
"RTN","VAFCTF",5,0)
 ;Reference to ^SCE("ADFN" supported by IA# 2953
"RTN","VAFCTF",6,0)
 ;Reference to EXC^RGHLLOG supported by IA# 2796
"RTN","VAFCTF",7,0)
 ;Reference to $$ICNLC^MPIF001 supported by IA #3072
"RTN","VAFCTF",8,0)
 ;
"RTN","VAFCTF",9,0)
EN1(VAFCDFN,VAFCSUP) ; determine the LAST TREATMENT DATE for a single
"RTN","VAFCTF",10,0)
 ; patient
"RTN","VAFCTF",11,0)
 ; input: VAFCDFN - the dfn of the patient
"RTN","VAFCTF",12,0)
 ;        VAFCSUP - if 1, suppress add entries to the ADT HL7 PIVOT
"RTN","VAFCTF",13,0)
 ;                (#391.71) file for TF messaging - VAFCTFMF (optional)
"RTN","VAFCTF",14,0)
 ; output: VAFCDATE - patient's DATE LAST TREATED
"RTN","VAFCTF",15,0)
 ;         VAFCENVR - event reason
"RTN","VAFCTF",16,0)
 ;
"RTN","VAFCTF",17,0)
 N ERR,VAFCSITE,VAFCLAST,VAFCSITE,VAFCADMD,VAFCENDT,VAFCDATE,VAFCENVR,VAFCTYPE
"RTN","VAFCTF",18,0)
 S U="^"
"RTN","VAFCTF",19,0)
 S:'$D(VAFCSITE) VAFCSITE=$$KSP^XUPARAM("INST") ;defines the local facility
"RTN","VAFCTF",20,0)
 S (VAFCLAST,VAFCADMD)=$$ADMDIS(VAFCDFN) ; dt_"^"_event type or ""
"RTN","VAFCTF",21,0)
 S VAFCADMD=$S(VAFCADMD]"":$P(VAFCADMD,"^"),1:"") ; event dt or null
"RTN","VAFCTF",22,0)
 S:$P(VAFCLAST,"^",2)=3!(VAFCLAST="") VAFCENDT=$$ENCDT(VAFCDFN,VAFCADMD)
"RTN","VAFCTF",23,0)
 ; patient has been discharged or has never been admitted.  Has this
"RTN","VAFCTF",24,0)
 ; individual been checked out of a clinic? 
"RTN","VAFCTF",25,0)
 I $D(VAFCENDT)#2,($P(VAFCLAST,U)) S VAFCLAST=$S(+VAFCENDT>+VAFCLAST:VAFCENDT,1:VAFCLAST)
"RTN","VAFCTF",26,0)
 I $D(VAFCENDT)#2,('$P(VAFCLAST,U)) S VAFCLAST=VAFCENDT
"RTN","VAFCTF",27,0)
 S VAFCTYPE=$P(VAFCLAST,"^",2),VAFCDATE=+VAFCLAST
"RTN","VAFCTF",28,0)
 ; input variables to FILE^VAFCTFU
"RTN","VAFCTF",29,0)
 ; VAFCDFN - patient ien ; VAFCSITE - treating facility
"RTN","VAFCTF",30,0)
 ; VAFCDATE - date last treated ; VAFCENVR - event reason
"RTN","VAFCTF",31,0)
 ;
"RTN","VAFCTF",32,0)
 I +VAFCDATE'>0 S VAFCDATE="",VAFCENVR=""
"RTN","VAFCTF",33,0)
 I +VAFCDATE>0 S VAFCENVR=$S(VAFCTYPE=1:"A1",VAFCTYPE=3:"A2",1:"A3") ;A1=adm;A2=dis;A3=CO
"RTN","VAFCTF",34,0)
 N STA,ICN S ICN=$$ICNLC^MPIF001(VAFCDFN),STA=$P($$SITE^VASITE,"^",3)
"RTN","VAFCTF",35,0)
 D FILE^VAFCTFU(VAFCDFN,VAFCSITE_U_VAFCDATE_U_VAFCENVR,$G(VAFCSUP),1,.ERR) I $D(ERR(STA)) D EXC^RGHLLOG(212,ERR(STA),VAFCDFN)
"RTN","VAFCTF",36,0)
 ;
"RTN","VAFCTF",37,0)
 Q
"RTN","VAFCTF",38,0)
ADMDIS(DFN) ; find the patient's last admission and discharge dates if
"RTN","VAFCTF",39,0)
 ; they exist.
"RTN","VAFCTF",40,0)
 ; Input: DFN - ien of the patient (file 2)
"RTN","VAFCTF",41,0)
 ;Output: a valid discharge/admission date/time concatenated with
"RTN","VAFCTF",42,0)
 ;        the event type (1=admission, 3=discharge) -or- null
"RTN","VAFCTF",43,0)
 N %,VAERR,VAIP S VAIP("D")="LAST" D IN5^VADPT
"RTN","VAFCTF",44,0)
 I '+$G(VAIP(17,1)),('+$G(VAIP(13,1))) Q ""
"RTN","VAFCTF",45,0)
 ; no discharge date, no admission date, return null
"RTN","VAFCTF",46,0)
 I '+$G(VAIP(17,1)) Q $P($G(VAIP(13,1)),U)_"^1"
"RTN","VAFCTF",47,0)
 ; no discharge date, return admission date
"RTN","VAFCTF",48,0)
 I '+$G(VAIP(13,1)) Q $P($G(VAIP(17,1)),U)_"^3"
"RTN","VAFCTF",49,0)
 ; no admission date, return discharge date
"RTN","VAFCTF",50,0)
 I +$G(VAIP(17,1))>(+$G(VAIP(13,1))) Q +$G(VAIP(17,1))_"^3"
"RTN","VAFCTF",51,0)
 ; return discharge date
"RTN","VAFCTF",52,0)
 Q +$G(VAIP(13,1))_"^1" ; return admission date
"RTN","VAFCTF",53,0)
 ;
"RTN","VAFCTF",54,0)
ENCDT(DFN,INPDT) ; find the last patient check out date/time.  'ADFN'
"RTN","VAFCTF",55,0)
 ; cross-reference accessed through DBIA: 2953
"RTN","VAFCTF",56,0)
 ; Input: DFN  - ien of the patient (file 2)
"RTN","VAFCTF",57,0)
 ;        INPDT - date (if any) returned from the inpatient admission/
"RTN","VAFCTF",58,0)
 ;               discharge subroutine     
"RTN","VAFCTF",59,0)
 ;Output: a valid discharge/admission date/time concatenated with
"RTN","VAFCTF",60,0)
 ;        the event type (5=check out) -or- null
"RTN","VAFCTF",61,0)
 Q:'DFN "" ; we need dfn defined
"RTN","VAFCTF",62,0)
 N VAFCDATA,VAFCPURG,VAFCX,VAFCX1,VAFCX2,VAFCX3
"RTN","VAFCTF",63,0)
 S VAFCX=9999999.9999999,VAFCX2=0,VAFCX3=""
"RTN","VAFCTF",64,0)
 F  S VAFCX=$O(^SCE("ADFN",DFN,VAFCX),-1) Q:'VAFCX!(INPDT>VAFCX)  D  Q:VAFCX2
"RTN","VAFCTF",65,0)
 . S VAFCX1=0 F  S VAFCX1=$O(^SCE("ADFN",DFN,VAFCX,VAFCX1)) Q:'VAFCX1  D  Q:VAFCX2
"RTN","VAFCTF",66,0)
 .. D GETGEN^SDOE(VAFCX1,"VAFCDATA")
"RTN","VAFCTF",67,0)
 .. D PARSE^SDOE(.VAFCDATA,"EXTERNAL","VAFCPARS")
"RTN","VAFCTF",68,0)
 .. I $G(VAFCPARS(.12))="CHECKED OUT" S VAFCX2=1,VAFCX3=VAFCX
"RTN","VAFCTF",69,0)
 .. K VAFCDATA,VAFCPARS
"RTN","VAFCTF",70,0)
 .. Q
"RTN","VAFCTF",71,0)
 . Q
"RTN","VAFCTF",72,0)
 K VAFCDATA,VAFCPURG,VAFCX,VAFCX1,VAFCX2
"RTN","VAFCTF",73,0)
 I $E(VAFCX3,13)>5 S VAFCX3=$E(VAFCX3,1,12)_"59"
"RTN","VAFCTF",74,0)
 Q VAFCX3_"^5" ; X is either null or the date/time of the check out
"RTN","VAFCTF",75,0)
 ;
"VER")
8.0^22.0
"BLD",6771,6)
^651
**END**
**END**
