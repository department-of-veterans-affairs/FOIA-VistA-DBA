Released SD*5.3*452 SEQ #386
Extracted from mail message
**KIDS**:SD*5.3*452^

**INSTALL NAME**
SD*5.3*452
"BLD",6598,0)
SD*5.3*452^SCHEDULING^0^3060504^y
"BLD",6598,1,0)
^^5^5^3060201^^
"BLD",6598,1,1,0)
1. Problem with Cancel Clinic Availability allowing overlap of cancelled
"BLD",6598,1,2,0)
   time sectors.
"BLD",6598,1,3,0)
 
"BLD",6598,1,4,0)
2. Restore Clinic Availability issuing bogus message "CLINIC DOES NOT 
"BLD",6598,1,5,0)
   MEET ON THIS DATE".
"BLD",6598,4,0)
^9.64PA^^
"BLD",6598,"ABPKG")
n
"BLD",6598,"KRN",0)
^9.67PA^8989.52^19
"BLD",6598,"KRN",.4,0)
.4
"BLD",6598,"KRN",.401,0)
.401
"BLD",6598,"KRN",.402,0)
.402
"BLD",6598,"KRN",.403,0)
.403
"BLD",6598,"KRN",.5,0)
.5
"BLD",6598,"KRN",.84,0)
.84
"BLD",6598,"KRN",3.6,0)
3.6
"BLD",6598,"KRN",3.8,0)
3.8
"BLD",6598,"KRN",9.2,0)
9.2
"BLD",6598,"KRN",9.8,0)
9.8
"BLD",6598,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6598,"KRN",9.8,"NM",1,0)
SDUNC^^0^B22599773
"BLD",6598,"KRN",9.8,"NM",2,0)
SDC2^^0^B9542606
"BLD",6598,"KRN",9.8,"NM","B","SDC2",2)

"BLD",6598,"KRN",9.8,"NM","B","SDUNC",1)

"BLD",6598,"KRN",19,0)
19
"BLD",6598,"KRN",19.1,0)
19.1
"BLD",6598,"KRN",101,0)
101
"BLD",6598,"KRN",409.61,0)
409.61
"BLD",6598,"KRN",771,0)
771
"BLD",6598,"KRN",870,0)
870
"BLD",6598,"KRN",8989.51,0)
8989.51
"BLD",6598,"KRN",8989.52,0)
8989.52
"BLD",6598,"KRN",8994,0)
8994
"BLD",6598,"KRN","B",.4,.4)

"BLD",6598,"KRN","B",.401,.401)

"BLD",6598,"KRN","B",.402,.402)

"BLD",6598,"KRN","B",.403,.403)

"BLD",6598,"KRN","B",.5,.5)

"BLD",6598,"KRN","B",.84,.84)

"BLD",6598,"KRN","B",3.6,3.6)

"BLD",6598,"KRN","B",3.8,3.8)

"BLD",6598,"KRN","B",9.2,9.2)

"BLD",6598,"KRN","B",9.8,9.8)

"BLD",6598,"KRN","B",19,19)

"BLD",6598,"KRN","B",19.1,19.1)

"BLD",6598,"KRN","B",101,101)

"BLD",6598,"KRN","B",409.61,409.61)

"BLD",6598,"KRN","B",771,771)

"BLD",6598,"KRN","B",870,870)

"BLD",6598,"KRN","B",8989.51,8989.51)

"BLD",6598,"KRN","B",8989.52,8989.52)

"BLD",6598,"KRN","B",8994,8994)

"BLD",6598,"QUES",0)
^9.62^^
"BLD",6598,"REQB",0)
^9.611^2^2
"BLD",6598,"REQB",1,0)
SD*5.3*182^2
"BLD",6598,"REQB",2,0)
SD*5.3*380^2
"BLD",6598,"REQB","B","SD*5.3*182",1)

"BLD",6598,"REQB","B","SD*5.3*380",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
452^3060504
"PKG",16,22,1,"PAH",1,1,0)
^^5^5^3060504
"PKG",16,22,1,"PAH",1,1,1,0)
1. Problem with Cancel Clinic Availability allowing overlap of cancelled
"PKG",16,22,1,"PAH",1,1,2,0)
   time sectors.
"PKG",16,22,1,"PAH",1,1,3,0)
 
"PKG",16,22,1,"PAH",1,1,4,0)
2. Restore Clinic Availability issuing bogus message "CLINIC DOES NOT 
"PKG",16,22,1,"PAH",1,1,5,0)
   MEET ON THIS DATE".
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SDC2")
0^2^B9542606^B9308419
"RTN","SDC2",1,0)
SDC2 ;ALB/GRR - CHECK PARTIAL CANCELLATIONS ; 19 FEB 85
"RTN","SDC2",2,0)
 ;;5.3;Scheduling;**182,452**;Aug 13, 1993
"RTN","SDC2",3,0)
 K SDZ I $D(^SC(SC,"SDCAN")),$O(^SC(SC,"SDCAN",SD))\1=SD G OVR
"RTN","SDC2",4,0)
 D WAIT^DICD F SDZL=SD:0 S SDZL=$O(^SC(SC,"S",SDZL)) Q:SDZL=""  I $D(^SC(SC,"S",SDZL,"MES")) S SDCTO=$E(^("MES"),17,20) S:'$D(^SC(SC,"SDCAN",0)) ^SC(SC,"SDCAN",0)="^44.05D^"_SDZL_"^0" D MORE
"RTN","SDC2",5,0)
 G:'$D(^SC(SC,"SDCAN")) W^SDC G:$O(^SC(SC,"SDCAN",SD))\1-SD W^SDC
"RTN","SDC2",6,0)
OVR F SDJ=SD:0 S SDJ=$O(^SC(SC,"SDCAN",SDJ)) Q:SDJ=""!(SDJ\1-SD)  S SDZ(SDJ)=SD_($P(^(SDJ,0),"^",2)/10000)_$S($D(^SC(SC,"S",SDJ,"MES")):"   ("_$P(^("MES"),"(",2),1:"")
"RTN","SDC2",7,0)
SHOW W !,"Clinic already has the following cancellation(s) for that date: ",!
"RTN","SDC2",8,0)
 F Z=0:0 S Z=$O(SDZ(Z)) Q:Z=""  S X=Z D TM W !,?15,"From: ",X,"   To: " S X=+SDZ(Z) D TM W X,$S($P(SDZ(Z),"(",2)]"":"  ("_$P(SDZ(Z),"(",2),1:"")
"RTN","SDC2",9,0)
CP S %=1 W !!,"Do you want to Cancel another portion of the day" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G CP
"RTN","SDC2",10,0)
 W:%<0 " NO" S SDANS=$S('(%-1):"Y",1:"N") Q:SDANS'["Y"
"RTN","SDC2",11,0)
RDFR R !,"STARTING TIME: ",X:DTIME Q:"^"[X  D TC G RDFR:Y<0 S FR=Y,ST=%
"RTN","SDC2",12,0)
RDTO R !,"ENDING TIME: ",X:DTIME Q:"^"[X  D TC G RDTO:Y<0 S SDHTO=X,TO=Y I TO'>FR W !,*7,"Ending time must be later than starting time!" G RDTO
"RTN","SDC2",13,0)
 D TZ G:'$D(X) SHOW
"RTN","SDC2",14,0)
 G ROPT^SDC
"RTN","SDC2",15,0)
TC S X=$$FMTE^XLFDT(SD)_"@"_X,%DT="TE" D ^%DT I Y<0!(X["?") W !,"Enter a time after starting time",!,"for clinic and which is a valid time for clinic.",*7 Q
"RTN","SDC2",16,0)
 S X=$E($P(Y_"0000",".",2),1,4),%=$E(X,3,4),%=X\100-STARTDAY*SI+(%*SI\60)*2 I %<0 W !,*7,"DAY STARTS AT ",STARTDAY S Y=-1
"RTN","SDC2",17,0)
 I %>72 W *7,"?" S Y=-1
"RTN","SDC2",18,0)
 Q
"RTN","SDC2",19,0)
TZ K SDERR F Z=0:0 S Z=$O(SDZ(Z)) Q:Z=""  S SDERR=$S(FR'<Z&(FR<SDZ(Z)):1,TO>Z&(TO<SDZ(Z)):1,1:0) Q:SDERR  I Z'<FR&(Z<TO) S SDERR=1 Q
"RTN","SDC2",20,0)
 G:SDERR ERR
"RTN","SDC2",21,0)
 Q
"RTN","SDC2",22,0)
MORE Q:$D(^SC(SC,"SDCAN",SDZL,0))  S A=^SC(SC,"SDCAN",0),SDCNT=$P(A,"^",4),^SC(SC,"SDCAN",0)=$P(A,"^",1,2)_"^"_SDZL_"^"_(SDCNT+1),^SC(SC,"SDCAN",SDZL,0)=SDZL_"^"_SDCTO
"RTN","SDC2",23,0)
 Q
"RTN","SDC2",24,0)
ERR W !!,*7,"Time frame selected overlaps previously cancelled time frame!",! K X Q
"RTN","SDC2",25,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","SDUNC")
0^1^B22599773^B22202942
"RTN","SDUNC",1,0)
SDUNC ;MAN/GRR - RESTORE CLINIC AVAILABILITY ; 24 JUL 2003  10:08 am
"RTN","SDUNC",2,0)
 ;;5.3;Scheduling;**79,303,380,452**;Aug 13, 1993
"RTN","SDUNC",3,0)
 D DT^DICRW S DIC=44,DIC(0)="MEQA",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))",DIC("A")="Select CLINIC NAME: " D ^DIC K DIC("S"),DIC("A") Q:"^"[X  G:Y<0 SDUNC Q:'$D(^SC(+Y,"SL"))
"RTN","SDUNC",4,0)
 S SC=+Y,SL=^("SL") ;NAKED REFERENCE - ^SC(IFN,"SL")
"RTN","SDUNC",5,0)
 N SDRES S SDRES=$$CLNCK^SDUTL2(SC,1)
"RTN","SDUNC",6,0)
 I 'SDRES W !,?5,"Clinic MUST be corrected before continuing." G SDUNC
"RTN","SDUNC",7,0)
 S %DT="AEXF",%DT("A")="RESTORE '"_$P(Y,U,2)_"' FOR WHAT DATE: " D ^%DT K %DT Q:Y<0
"RTN","SDUNC",8,0)
 S (SD,CDATE)=Y,%=$P(SL,U,6),SI=$S(%="":4,%<3:4,%:%,1:4),%=$P(SL,U,3),STARTDAY=$S(%:%,1:8)
"RTN","SDUNC",9,0)
 K SDIN,SDIN1,SDRE,SDRE1 I $D(^SC(SC,"I")) S SDIN=+^("I"),SDRE=+$P(^("I"),"^",2),Y=SDIN D DTS^SDUTL S SDIN1=Y,Y=SDRE D DTS^SDUTL S SDRE1=Y
"RTN","SDUNC",10,0)
 I $S('$D(SDIN):0,'SDIN:0,SDIN>CDATE:0,SDRE'>CDATE&(SDRE):0,1:1) W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),SDIN1,$S(SDRE:" to "_SDRE1,1:"") G SDUNC
"RTN","SDUNC",11,0)
 K SDIN,SDIN1,SDRE,SDRE1 G:'$D(^SC(SC,"ST",SD,1)) NOWAY
"RTN","SDUNC",12,0)
 I $D(^SC(SC,"ST",SD,1)),^(1)'["CANCELLED"&(^(1)'["X") G NOWAY
"RTN","SDUNC",13,0)
 I $D(^SC(SC,"ST",SD,9)) I $D(^SC(SC,"OST",SD,1)) D FIX Q:^SC(SC,"ST",SD,1)["X"&('$D(SDFR1))  S ^SC(SC,"ST",SD,1)=HOLD K:^(1)'["X" ^SC(SC,"ST",SD,"CAN") W !,"RESTORED!",*7 D CHK Q
"RTN","SDUNC",14,0)
 I $D(^SC(SC,"ST",SD,9)),'$D(^SC(SC,"OST",SD,1)) G ERRM^SDUNC1
"RTN","SDUNC",15,0)
 D B I '$D(DH) G NOPAT
"RTN","SDUNC",16,0)
 Q:^SC(SC,"ST",SD,1)["X"&('$D(SDFR1))  S ^SC(SC,"ST",SD,0)=SD,^SC(SC,"ST",SD,1)=DH G N
"RTN","SDUNC",17,0)
NOWAY W !,*7,"CLINIC HAS NOT BEEN CANCELLED FOR THAT DATE, SO IT CANNOT BE RESTORED",*7 G SDUNC
"RTN","SDUNC",18,0)
NOPAT W !,*7,"NO UPCOMING OR INDEFINITE APPOINTMENT PATTERN EXISTS FOR DAY OF WEEK,",!,"CREATE 'AVAILABILITY' PATTERN THRU 'CLINIC SETUP', THEN RESTORE AGAIN",*7 G SDUNC
"RTN","SDUNC",19,0)
B S X=SD D DOW^SDM0 S DOW=Y,SS=$O(^SC(SC,"T"_Y,X)) I SS'="",$D(^(SS,1)),^(1)]"" S DH=$P("SU^MO^TU^WE^TH^FR^SA","^",DOW+1)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),DO=X+1,DA(1)=SC,HOLD=DH D FIX2
"RTN","SDUNC",20,0)
 Q
"RTN","SDUNC",21,0)
N I '$F(^SC(SC,"ST",SD,1),"[") K ^SC(SC,"ST",SD) W !,*7,"CLINIC DOES NOT MEET ON THAT DAY" G SDUNC
"RTN","SDUNC",22,0)
 K:^SC(SC,"ST",SD,1)'["X" ^SC(SC,"ST",SD,"CAN") W !,"RESTORED!",*7 D CHK Q
"RTN","SDUNC",23,0)
FIX I ^SC(SC,"ST",SD,1)["X" S SDREST=^SC(SC,"OST",SD,1) D SEL Q
"RTN","SDUNC",24,0)
 S HOLD=^SC(SC,"OST",SD,1)
"RTN","SDUNC",25,0)
 Q
"RTN","SDUNC",26,0)
CHK F N1=SD:0 S N1=$O(^SC(SC,"S",N1)) Q:'N1!(N1\1-SD)  I $D(^SC(SC,"S",N1,"MES")) D KMES I $D(SDFR1),'$D(^("MES")) Q
"RTN","SDUNC",27,0)
 Q
"RTN","SDUNC",28,0)
FIX2 Q:^SC(SC,"ST",SD,1)'["X"
"RTN","SDUNC",29,0)
 S SDREST=DH D SEL Q:'$D(SDFR1)  S DH=HOLD
"RTN","SDUNC",30,0)
 Q
"RTN","SDUNC",31,0)
SEL K SDFR1 Q:'$D(^SC(SC,"SL"))  S SL=^("SL"),%=$P(SL,U,6),SI=$S(%="":4,%<3:4,%:%,1:4),%=$P(SL,U,3),STARTDAY=$S(%:%,1:8)
"RTN","SDUNC",32,0)
 W !,"Clinic has been cancelled for the following periods:",!
"RTN","SDUNC",33,0)
 K SDTEMP,SDZZ S SDZZ=0 F I=SD:0 S I=$O(^SC(SC,"SDCAN",I)) Q:'I!(I\1-SD)  S SDZZ=SDZZ+1,X=I D TM S SDFR=X,SDFRX=X1,X="."_$P(^(I,0),"^",2) D TM S SDTO=X,SDTEMP(SDFRX_"-"_X1)=SDFR_"^"_SDTO,SDZZ(SDZZ)=SDFRX_"-"_X1
"RTN","SDUNC",34,0)
 F I=SD:0 S I=$O(^SC(SC,"S",I)) Q:'I!(I\1-SD)  I $D(^SC(SC,"S",I,"MES")),'$D(^SC(SC,"SDCAN",I)) S X=I D TM S SDFRX=X1,SDFR=X,X="."_$E(^SC(SC,"S",I,"MES"),17,20) D TM S SDZZ=SDZZ+1,SDTEMP(SDFRX_"-"_X1)=SDFR_"^"_X,SDZZ(SDZZ)=SDFRX_"-"_X1
"RTN","SDUNC",35,0)
 F I1=0:0 S I1=$O(SDZZ(I1)) Q:'I1  S I=SDTEMP(SDZZ(I1)) W !,?9,"(",$J(I1,2),") ","From: ",$J($P(I,"^",1),8),"   To: ",$J($P(I,"^",2),8)
"RTN","SDUNC",36,0)
A K SDFRX,X1,SDFR,SDTO R !!,"RESTORE WHICH PERIOD?: ",X:DTIME Q:"^"[X
"RTN","SDUNC",37,0)
 I X?1"?".E W !,"Enter the # that precedes the time period you want to restore." G A
"RTN","SDUNC",38,0)
 S SDR=X I $D(SDZZ(SDR)),$D(SDTEMP(SDZZ(SDR))) W "      ",$P(SDTEMP(SDZZ(SDR)),"^",1)," - ",$P(SDTEMP(SDZZ(SDR)),"^",2) G ROK
"RTN","SDUNC",39,0)
 W !,*7,"INVALID CHOICE, TRY AGAIN" G A
"RTN","SDUNC",40,0)
ROK S X=$P(SDZZ(SDR),"-",1) D TC S FR=X,SDBEG=%+SI+SI,X=$P(SDZZ(SDR),"-",2) D TC S TO=X,SDEND=%+SI+SI
"RTN","SDUNC",41,0)
 S SDFR1=CDATE+(FR/10000) K SDTEMP,SDZZ,SDR
"RTN","SDUNC",42,0)
 S HOLD=^SC(SC,"ST",SD,1),HOLD=$E(HOLD,1,SDBEG-1)_$E(SDREST,SDBEG,SDEND)_$E(HOLD,SDEND+1,80) K ^SC(SC,"SDCAN",SDFR1) I $D(^SC(SC,"SDCAN",0)) S CNT=$P(^(0),U,4),CNT=$S(CNT>0:CNT-1,1:0),^(0)=$P(^(0),U,1,3)_U_CNT K CNT
"RTN","SDUNC",43,0)
 I HOLD'["[" S I5=$F(HOLD,"|"),HOLD=$E(HOLD,1,(I5-2))_"["_$E(HOLD,I5,999) K I5
"RTN","SDUNC",44,0)
 K SDBEG,SDEND,SDANS,SI,STARTDAY,FR,TO Q
"RTN","SDUNC",45,0)
KMES I '$D(SDFR1) K ^("MES") Q  ;NAKED REFERENCE - ^SC(IFN,"S",DATE,"MES")
"RTN","SDUNC",46,0)
 I $D(SDFR1),N1=SDFR1 K ^("MES") Q  ;NAKED REFERENCE - ^SC(IFN,"S",DATE,"MES")
"RTN","SDUNC",47,0)
 Q
"RTN","SDUNC",48,0)
TC S %=$E(X,3,4),%=X\100-STARTDAY*SI+(%*SI\60)*2
"RTN","SDUNC",49,0)
 Q
"RTN","SDUNC",50,0)
TM S X=$E($P(X,".",2)_"0000",1,4),X1=X,%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"VER")
8.0^22.0
"BLD",6598,6)
^386
**END**
**END**
