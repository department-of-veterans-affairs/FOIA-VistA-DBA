Released DVBA*2.7*17 SEQ #17
Extracted from mail message
**KIDS**:DVBA*2.7*17^

**INSTALL NAME**
DVBA*2.7*17
"BLD",977,0)
DVBA*2.7*17^AUTOMATED MED INFO EXCHANGE^0^2980302^y
"BLD",977,1,0)
^^1^1^2980123^^
"BLD",977,1,1,0)
 See the patch description for DVBA*2.7*17 in the Patch Module on Forum.
"BLD",977,4,0)
^9.64PA^^
"BLD",977,"KRN",0)
^9.67PA^19^18
"BLD",977,"KRN",.4,0)
.4
"BLD",977,"KRN",.4,"NM",0)
^9.68A^9^9
"BLD",977,"KRN",.4,"NM",1,0)
DVBA 21 DAY CERT    FILE #396^396^0
"BLD",977,"KRN",.4,"NM",2,0)
DVBA ADMISSION REVIEW    FILE #405^405^0
"BLD",977,"KRN",.4,"NM",3,0)
DVBA C REQUESTS BY DATE RANGE    FILE #396.3^396.3^0
"BLD",977,"KRN",.4,"NM",4,0)
DVBA C REQUESTS BY PHYSICIAN    FILE #396.4^396.4^0
"BLD",977,"KRN",.4,"NM",5,0)
DVBA FINALIZED REPORT    FILE #396^396^0
"BLD",977,"KRN",.4,"NM",6,0)
DVBA INCOMP REQ REPORT    FILE #396^396^0
"BLD",977,"KRN",.4,"NM",7,0)
DVBA NOT/DIS-21 DAY CERT CHECK    FILE #396^396^0
"BLD",977,"KRN",.4,"NM",8,0)
DVBA NOTICE OF DISCHARGE    FILE #396^396^0
"BLD",977,"KRN",.4,"NM",9,0)
DVBA STATUS    FILE #396^396^0
"BLD",977,"KRN",.4,"NM","B","DVBA 21 DAY CERT    FILE #396",1)

"BLD",977,"KRN",.4,"NM","B","DVBA ADMISSION REVIEW    FILE #405",2)

"BLD",977,"KRN",.4,"NM","B","DVBA C REQUESTS BY DATE RANGE    FILE #396.3",3)

"BLD",977,"KRN",.4,"NM","B","DVBA C REQUESTS BY PHYSICIAN    FILE #396.4",4)

"BLD",977,"KRN",.4,"NM","B","DVBA FINALIZED REPORT    FILE #396",5)

"BLD",977,"KRN",.4,"NM","B","DVBA INCOMP REQ REPORT    FILE #396",6)

"BLD",977,"KRN",.4,"NM","B","DVBA NOT/DIS-21 DAY CERT CHECK    FILE #396",7)

"BLD",977,"KRN",.4,"NM","B","DVBA NOTICE OF DISCHARGE    FILE #396",8)

"BLD",977,"KRN",.4,"NM","B","DVBA STATUS    FILE #396",9)

"BLD",977,"KRN",.401,0)
.401
"BLD",977,"KRN",.402,0)
.402
"BLD",977,"KRN",.402,"NM",0)
^9.68A^^
"BLD",977,"KRN",.403,0)
.403
"BLD",977,"KRN",.5,0)
.5
"BLD",977,"KRN",.84,0)
.84
"BLD",977,"KRN",3.6,0)
3.6
"BLD",977,"KRN",3.8,0)
3.8
"BLD",977,"KRN",9.2,0)
9.2
"BLD",977,"KRN",9.8,0)
9.8
"BLD",977,"KRN",9.8,"NM",0)
^9.68A^28^27
"BLD",977,"KRN",9.8,"NM",2,0)
DVBAADRP^^0^B15962581
"BLD",977,"KRN",9.8,"NM",3,0)
DVBACMRP^^0^B19319969
"BLD",977,"KRN",9.8,"NM",4,0)
DVBADSR1^^0^B4823251
"BLD",977,"KRN",9.8,"NM",5,0)
DVBADSRP^^0^B20250047
"BLD",977,"KRN",9.8,"NM",6,0)
DVBADSRT^^0^B17467761
"BLD",977,"KRN",9.8,"NM",7,0)
DVBAEDIT^^0^B13046230
"BLD",977,"KRN",9.8,"NM",8,0)
DVBAPEND^^0^B12088109
"BLD",977,"KRN",9.8,"NM",9,0)
DVBARADM^^0^B24055607
"BLD",977,"KRN",9.8,"NM",10,0)
DVBARAD1^^0^B12771304
"BLD",977,"KRN",9.8,"NM",11,0)
DVBAREQ3^^0^B18695641
"BLD",977,"KRN",9.8,"NM",12,0)
DVBAREQS^^0^B8799287
"BLD",977,"KRN",9.8,"NM",13,0)
DVBAUTL7^^0^B25268612
"BLD",977,"KRN",9.8,"NM",14,0)
DVBCAMI1^^0^B9931971
"BLD",977,"KRN",9.8,"NM",15,0)
DVBCAMIS^^0^B7969924
"BLD",977,"KRN",9.8,"NM",16,0)
DVBCAMRO^^0^B7327338
"BLD",977,"KRN",9.8,"NM",17,0)
DVBCCHKR^^0^B29016651
"BLD",977,"KRN",9.8,"NM",18,0)
DVBCENQ1^^0^B23767998
"BLD",977,"KRN",9.8,"NM",19,0)
DVBCENQ2^^0^B6809858
"BLD",977,"KRN",9.8,"NM",20,0)
DVBCIUTL^^0^B18899717
"BLD",977,"KRN",9.8,"NM",21,0)
DVBCMKL2^^0^B22184716
"BLD",977,"KRN",9.8,"NM",22,0)
DVBCPND1^^0^B22927581
"BLD",977,"KRN",9.8,"NM",23,0)
DVBCSCHD^^0^B20499986
"BLD",977,"KRN",9.8,"NM",24,0)
DVBCUTIL^^0^B24606367
"BLD",977,"KRN",9.8,"NM",25,0)
DVBADSNT^^0^B21131778
"BLD",977,"KRN",9.8,"NM",26,0)
DVBAREG2^^0^B31963943
"BLD",977,"KRN",9.8,"NM",27,0)
DVBAPND1^^0^B16396677
"BLD",977,"KRN",9.8,"NM",28,0)
DVBAUTIL^^0^B24053191
"BLD",977,"KRN",9.8,"NM","B","DVBAADRP",2)

"BLD",977,"KRN",9.8,"NM","B","DVBACMRP",3)

"BLD",977,"KRN",9.8,"NM","B","DVBADSNT",25)

"BLD",977,"KRN",9.8,"NM","B","DVBADSR1",4)

"BLD",977,"KRN",9.8,"NM","B","DVBADSRP",5)

"BLD",977,"KRN",9.8,"NM","B","DVBADSRT",6)

"BLD",977,"KRN",9.8,"NM","B","DVBAEDIT",7)

"BLD",977,"KRN",9.8,"NM","B","DVBAPEND",8)

"BLD",977,"KRN",9.8,"NM","B","DVBAPND1",27)

"BLD",977,"KRN",9.8,"NM","B","DVBARAD1",10)

"BLD",977,"KRN",9.8,"NM","B","DVBARADM",9)

"BLD",977,"KRN",9.8,"NM","B","DVBAREG2",26)

"BLD",977,"KRN",9.8,"NM","B","DVBAREQ3",11)

"BLD",977,"KRN",9.8,"NM","B","DVBAREQS",12)

"BLD",977,"KRN",9.8,"NM","B","DVBAUTIL",28)

"BLD",977,"KRN",9.8,"NM","B","DVBAUTL7",13)

"BLD",977,"KRN",9.8,"NM","B","DVBCAMI1",14)

"BLD",977,"KRN",9.8,"NM","B","DVBCAMIS",15)

"BLD",977,"KRN",9.8,"NM","B","DVBCAMRO",16)

"BLD",977,"KRN",9.8,"NM","B","DVBCCHKR",17)

"BLD",977,"KRN",9.8,"NM","B","DVBCENQ1",18)

"BLD",977,"KRN",9.8,"NM","B","DVBCENQ2",19)

"BLD",977,"KRN",9.8,"NM","B","DVBCIUTL",20)

"BLD",977,"KRN",9.8,"NM","B","DVBCMKL2",21)

"BLD",977,"KRN",9.8,"NM","B","DVBCPND1",22)

"BLD",977,"KRN",9.8,"NM","B","DVBCSCHD",23)

"BLD",977,"KRN",9.8,"NM","B","DVBCUTIL",24)

"BLD",977,"KRN",19,0)
19
"BLD",977,"KRN",19,"NM",0)
^9.68A^^
"BLD",977,"KRN",19.1,0)
19.1
"BLD",977,"KRN",101,0)
101
"BLD",977,"KRN",409.61,0)
409.61
"BLD",977,"KRN",771,0)
771
"BLD",977,"KRN",869.2,0)
869.2
"BLD",977,"KRN",870,0)
870
"BLD",977,"KRN",8994,0)
8994
"BLD",977,"KRN","B",.4,.4)

"BLD",977,"KRN","B",.401,.401)

"BLD",977,"KRN","B",.402,.402)

"BLD",977,"KRN","B",.403,.403)

"BLD",977,"KRN","B",.5,.5)

"BLD",977,"KRN","B",.84,.84)

"BLD",977,"KRN","B",3.6,3.6)

"BLD",977,"KRN","B",3.8,3.8)

"BLD",977,"KRN","B",9.2,9.2)

"BLD",977,"KRN","B",9.8,9.8)

"BLD",977,"KRN","B",19,19)

"BLD",977,"KRN","B",19.1,19.1)

"BLD",977,"KRN","B",101,101)

"BLD",977,"KRN","B",409.61,409.61)

"BLD",977,"KRN","B",771,771)

"BLD",977,"KRN","B",869.2,869.2)

"BLD",977,"KRN","B",870,870)

"BLD",977,"KRN","B",8994,8994)

"BLD",977,"QUES",0)
^9.62^^
"BLD",977,"REQB",0)
^9.611^4^4
"BLD",977,"REQB",1,0)
DI*21.0*44^0
"BLD",977,"REQB",2,0)
XU*8.0*71^2
"BLD",977,"REQB",3,0)
DVBA*2.7*14^2
"BLD",977,"REQB",4,0)
DVBA*2.7*13^2
"BLD",977,"REQB","B","DI*21.0*44",1)

"BLD",977,"REQB","B","DVBA*2.7*13",4)

"BLD",977,"REQB","B","DVBA*2.7*14",3)

"BLD",977,"REQB","B","XU*8.0*71",2)

"KRN",.4,1042,-1)
0^9
"KRN",.4,1042,0)
DVBA STATUS^2980306.1336^^396^^^2980309
"KRN",.4,1042,"DXS",1,9.2)
S DIP(2)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=" Patient Name: ",DIP(1)=X S X=$S('$D(^DPT(+$P(DIP(2),U,1),0)):"",1:$P(^(0),U,1)),DIP(3)=X S X=1,DIP(4)=X S X=25
"KRN",.4,1042,"DXS",2,9)
X DXS(2,9.2) S X=X="ACTIVITY DATE",DIP(3)=X S X=" Activity",DIP(4)=X S X=1,DIP(5)=X S X="Admission",X=$S(DIP(3):DIP(4),DIP(5):X)_" Date:"
"KRN",.4,1042,"DXS",2,9.2)
S DIP(2)=$C(59)_$S($D(^DD(396,30,0)):$P(^(0),U,3),1:""),DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P($P(DIP(2),$C(59)_$P(DIP(1),U,10)_":",2),$C(59),1)
"KRN",.4,1042,"DXS",3,9)
S FINALDTE=$P(^DVB(396,D0,1),U,12) W:FINALDTE'="" ?45,"FINALIZED BY: ",$P(^DVB(396,D0,2),U,6),!,?56,"ON: ",$$FMTE^XLFDT(FINALDTE,"5DZ")
"KRN",.4,1042,"DXS",4,9)
S:FINALDTE="" ZDAT=$P(^DVB(396,D0,1),U,1),ZDAT1=$P(^DVB(396,D0,1),U,11) W:FINALDTE="" ?49,"Date of Request: ",$$FMTE^XLFDT(ZDAT,"5DZ")
"KRN",.4,1042,"F",1)
X DXS(1,9.2) S X=$E(DIP(3),DIP(4),X) S Y=X,X=DIP(1),X=X_Y W X K DIP;Y1;Z;"" Patient Name: "_$E(PATIENT NAME,1,25)"~
"KRN",.4,1042,"F",2)
X DXS(2,9) W X K DIP;C42;Y1;Z;"$S(DOCUMENT TYPE="ACTIVITY DATE":" Activity",1:"Admission")_" Date:""~
"KRN",.4,1042,"F",3)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$P(DIP(1),U,4) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;C58;Y1;Z;"NUMDATE4(ADMISSION DATE)"~
"KRN",.4,1042,"F",4)
X $P(^DD(396,2,0),U,5,99) S DIP(1)=X S X="SSN: "_DIP(1) W X K DIP;Y2;C11;Z;""SSN: "_SOC SEC NUMBER"~
"KRN",.4,1042,"F",5)
X $P(^DD(396,1,0),U,5,99) S DIP(1)=X S X="Claim Number: "_DIP(1) W X K DIP;C44;Y2;Z;""Claim Number: "_C-NUMBER"~
"KRN",.4,1042,"F",6)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X="Receiving Div: "_$S('$D(^DG(40.8,+$P(DIP(1),U,9),0)):"",1:$P(^(0),U,1)) W X K DIP;Y3;Z;""Receiving Div: "_DIVISION"~
"KRN",.4,1042,"F",7)
"Requisition";Y4;C5~"Status";C23~"Status Date";C35~"Operator";C50~"Current Division";C62~
"KRN",.4,1042,"F",8)
"---------------------------------------------------------------------------"~"Notice/Discharge:";C3;Y6~4.5;C23~4.8;C35~4.9;C50;L11~4.6;C62;L16~
"KRN",.4,1042,"F",9)
"Hospital Summary:";Y7;C3~5.5;C23~5.8;C35~5.9;C50;L11~5.6;C62;L16~"21-day Certificate:";Y8~6.5;C23~6.8;C35~6.9;C50;L11~6.6;C62;L16~"Other/Exam:";Y9;C9~
"KRN",.4,1042,"F",10)
8;C23~8.5;C35~8.7;C50;L11~7.6;C62;L16~"Special Report:";Y10;C5~10;C23~10.5;C35~10.7;C50;L11~9.6;C62;L16~"Competency Report:";Y11;C2~12;C23~12.5;C35~
"KRN",.4,1042,"F",11)
12.7;C50;L11~11.6;C62;L16~"Form 21-2680:";Y12;C7~14;C23~14.5;C35~14.7;C50;L11~13.6;C62;L16~"Asset Information:";Y13;C2~16;C23~16.5;C35~16.7;C50;L11~
"KRN",.4,1042,"F",12)
15.6;C62;L16~"Admission Report:";Y14;C3~17.4;C23~17.8;C35~17.9;C50;L11~17.6;C62;L16~"OPT Treatment Rpt:";Y15;C2~19;C23~19.5;C35~19.7;C50;L11~
"KRN",.4,1042,"F",13)
18.6;C62;L16~"Beg Date/Care:";Y16;C6~21;C23~21.5;C35~21.7;C50;L11~20.6;C62;L16~"REMARKS:";Y18~.5,.01;C11~"Requesting location: ";C0;Y20~
"KRN",.4,1042,"F",14)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P(DIP(1),U,7),DIP(2)=X S X=1,DIP(3)=X S X=20,X=$E(DIP(2),DIP(3),X) W X K DIP;C23;Z;"$E(REQUESTING LOCATION,1,20)"~
"KRN",.4,1042,"F",15)
X DXS(3,9);Z;"S FINALDTE=$P(^DVB(396,D0,1),U,12) W:FINALDTE'="" ?45,"FINALIZED BY: ",$P(^DVB(396,D0,2),U,6),!,?56,"ON: ",$$FMTE^XLFDT(FINALDTE,"5DZ")"~
"KRN",.4,1042,"F",16)
X DXS(4,9);Z;"S:FINALDTE="" ZDAT=$P(^DVB(396,D0,1),U,1),ZDAT1=$P(^DVB(396,D0,1),U,11) W:FINALDTE="" ?49,"Date of Request: ",$$FMTE^XLFDT(ZDAT,"5DZ")"~
"KRN",.4,1042,"F",17)
"Requested by: ";C8;Y21~
"KRN",.4,1042,"F",18)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P(DIP(1),U,8),DIP(2)=X S X=1,DIP(3)=X S X=25,X=$E(DIP(2),DIP(3),X) W X K DIP;C23;Z;"$E(REQUESTED BY,1,25)"~
"KRN",.4,1042,"F",19)
W:FINALDTE="" ?49,"Date Last Edited: ",$$FMTE^XLFDT(ZDAT1,"5DZ");Z;"W:FINALDTE="" ?49,"Date Last Edited: ",$$FMTE^XLFDT(ZDAT1,"5DZ")"~
"KRN",.4,1042,"H")
@
"KRN",.4,1042,"ROUOLD")
DVBAXP
"KRN",.4,1043,-1)
0^6
"KRN",.4,1043,0)
DVBA INCOMP REQ REPORT^2980128.1435^^396^^^2980306
"KRN",.4,1043,"DCL","396^-1")
!
"KRN",.4,1043,"DXS",1,9)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$S('$D(^DPT(+$P(DIP(1),U,1),0)):"",1:$P(^(0),U,1)),DIP(2)=X S X=1,DIP(3)=X S X=15,X=$E(DIP(2),DIP(3),X)
"KRN",.4,1043,"F",1)
X DXS(1,9) W X K DIP;"PATIENT NAME";C0;Z;"$E(PATIENT NAME,1,15)"~2;C18;L11~
"KRN",.4,1043,"F",2)
S DIP(1)=$S($D(^DVB(396,D0,1)):^(1),1:"") S X=$P(DIP(1),U,1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3));L10;"DATE OF REQUEST";;;;;;;Z;"NUMDATE4(DATE OF REQUEST)";!~
"KRN",.4,1043,"F",3)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P(DIP(1),U,7),DIP(2)=X S X=1,DIP(3)=X S X=12,X=$E(DIP(2),DIP(3),X) W X K DIP;"REQUESTING LOCATION";C44;Z;"$E(REQUESTING LOCATION,1,12)"~
"KRN",.4,1043,"F",4)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P(DIP(1),U,8),DIP(2)=X S X=1,DIP(3)=X S X=15,X=$E(DIP(2),DIP(3),X) W X K DIP;"REQUESTED BY";C58;Z;"$E(REQUESTED BY,1,15)"~
"KRN",.4,1043,"H")
A.M.I.E. Incomplete Request Report
"KRN",.4,1044,-1)
0^5
"KRN",.4,1044,0)
DVBA FINALIZED REPORT^2980128.14^^396^^^2980204
"KRN",.4,1044,"DCL","396^-1")
&
"KRN",.4,1044,"DXS",1,9)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$S('$D(^DPT(+$P(DIP(1),U,1),0)):"",1:$P(^(0),U,1)),DIP(2)=X S X=1,DIP(3)=X S X=15,X=$E(DIP(2),DIP(3),X)
"KRN",.4,1044,"DXS",2,9)
X DXS(2,9.2) S D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(201)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(201),U,9) S D0=I(0,0)
"KRN",.4,1044,"DXS",2,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S I(100,0)=$S($D(D0):D0,1:"")
"KRN",.4,1044,"F",1)
X DXS(1,9) W X K DIP;"PATIENT NAME";!;C0;Z;"$E(PATIENT NAME,1,15)"~
"KRN",.4,1044,"F",2)
X DXS(2,9) W X K DIP;"SSN";C18;Z;"PATIENT NAME IN PATIENT FILE:SOCIAL SECURITY NUMBER"~
"KRN",.4,1044,"F",3)
S DIP(1)=$S($D(^DVB(396,D0,2)):^(2),1:"") S X=$P(DIP(1),U,7),DIP(2)=X S X=1,DIP(3)=X S X=15,X=$E(DIP(2),DIP(3),X) W X K DIP;"REQUESTING VARO";C32;Z;"$E(REQUESTING LOCATION,1,15)"~
"KRN",.4,1044,"F",4)
S DIP(1)=$S($D(^DVB(396,D0,1)):^(1),1:"") S X=$P(DIP(1),U,12),X1=X,X2=$P(DIP(1),U,1),X="" D:X2 ^%DTC:X1;"TOTAL DAYS TO PROCESS";C50;;;;;;;;Z;"FINALIZATION DATE-DATE OF REQUEST";&~
"KRN",.4,1044,"F",5)
S DIP(1)=$S($D(^DVB(396,D0,1)):^(1),1:"") S X=$P(DIP(1),U,1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"DATE OF REQUEST";C63;Z;"NUMDATE4(DATE OF REQUEST)"~
"KRN",.4,1044,"F",6)
S DIP(1)=$S($D(^DVB(396,D0,1)):^(1),1:"") S X=$P(DIP(1),U,12) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"FINAL DATE";C76;Z;"NUMDATE4(FINALIZATION DATE)"~
"KRN",.4,1044,"F",7)
26;L15;C88~
"KRN",.4,1044,"H")
A.M.I.E. Finalized Report
"KRN",.4,1044,"IOM")
132
"KRN",.4,1044,"LAST")

"KRN",.4,1044,"ROU")
^DVBAXF
"KRN",.4,1044,"ROUOLD")
DVBAXF
"KRN",.4,1044,"STATS","S",1)
0
"KRN",.4,1044,"T",49)
9^1^0^C0^
"KRN",.4,1045,-1)
0^7
"KRN",.4,1045,0)
DVBA NOT/DIS-21 DAY CERT CHECK^2980128.1446^^396^^^2980128
"KRN",.4,1045,"DXS",1,9)
X DXS(1,9.2) S D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(201)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(201),U,9) S D0=I(0,0)
"KRN",.4,1045,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S I(100,0)=$S($D(D0):D0,1:"")
"KRN",.4,1045,"F",1)
.01;L20~X DXS(1,9) W X K DIP;"SSN";Z;"PATIENT NAME IN PATIENT FILE:SOCIAL SECURITY NUMBER"~4;L7;"NOT/DIS REQ?"~
"KRN",.4,1045,"F",2)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$P(DIP(1),U,10) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;L10;"NT/DIS COMP DATE";Z;"NUMDATE4(NOTICE/DISCHG COMPLETION DATE)"~
"KRN",.4,1045,"F",3)
4.5;L8;"NOT/DIS STATUS"~4.9;"NOT/DIS COMPLETED BY";L15~6;"21-DAY CERT REQ?";L7~
"KRN",.4,1045,"F",4)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$P(DIP(1),U,14) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"21-DAY CERT COMP DATE";L10;Z;"NUMDATE4(#6.8)"~
"KRN",.4,1045,"F",5)
6.5;L12;"21-DAY STATUS"~6.9;L15;"21-DAY CERT COMPLETED BY"~
"KRN",.4,1045,"H")
Notice of Discharge/21-day certificate Follow-up Listing
"KRN",.4,1103,-1)
0^2
"KRN",.4,1103,0)
DVBA ADMISSION REVIEW^2980128.1019^^405^^^2980128
"KRN",.4,1103,"DCL","2^.314")
1*
"KRN",.4,1103,"F",1)
-2,^DPT(^^S I(0,0)=D0 S DIP(1)=$S($D(^DGPM(D0,0)):^(0),1:"") S X=$P(DIP(1),U,3),X=X S D(0)=+X;Z;"PATIENT:"~-2,.01;L25~-2,.09;L12~-2,.314;"C-FOLD LOC";L3~
"KRN",.4,1103,"F",2)
-2,.361;L27~-2,.3611;L15~
"KRN",.4,1103,"F",3)
-2,S DIP(101)=$S($D(^DPT(D0,.361)):^(.361),1:"") S X=$P(DIP(101),U,2) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;L10;"ELIG STATUS DATE";Z;"NUMDATE4(ELIGIBILITY STATUS DATE)"~
"KRN",.4,1103,"F",4)
-2,.301;L3;"SC?"~-2,.36205;"A&A";L3~-2,.36235;L3;"PEN"~-2,.293;"RATED INCOMP?"~
"KRN",.4,1103,"H")
PATIENT MOVEMENT LIST
"KRN",.4,1152,-1)
0^3
"KRN",.4,1152,0)
DVBA C REQUESTS BY DATE RANGE^2980128.1107^^396.3^^^2980128
"KRN",.4,1152,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396.3,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(101)=$S($D(^DPT(D0,0)):^(0),1:"")
"KRN",.4,1152,"F",1)
.01;L30~X DXS(1,9.2) S X=$P(DIP(101),U,9) S D0=I(0,0) W X K DIP;"SSN";L11;Z;"NAME:SOCIAL SECURITY NUMBER"~
"KRN",.4,1152,"F",2)
S DIP(1)=$S($D(^DVB(396.3,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"REQUEST DATE";Z;"NUMDATE4(REQUEST DATE)"~
"KRN",.4,1152,"F",3)
3;L20~
"KRN",.4,1152,"H")
2507 REQUEST LIST
"KRN",.4,1408,-1)
0^4
"KRN",.4,1408,0)
DVBA C REQUESTS BY PHYSICIAN^2980128.1333^^396.4^^^2980128
"KRN",.4,1408,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396.4,D0,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'$D(^DVB(396.3,+D0,0)) D0=-1 S DIP(101)=$S($D(^DVB(396.3,D0,0)):^(0),1:"")
"KRN",.4,1408,"DXS",2,9)
X DXS(2,9.2) S DIP(101)=$S($D(^DVB(396.3,D0,0)):^(0),1:""),D0=$P(DIP(101),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(201)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(201),U,9) S D0=I(0,0)
"KRN",.4,1408,"DXS",2,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396.4,D0,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'$D(^DVB(396.3,+D0,0)) D0=-1 S I(100,0)=$S($D(D0):D0,1:"")
"KRN",.4,1408,"DXS",3,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396.4,D0,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'$D(^DVB(396.3,+D0,0)) D0=-1 S DIP(101)=$S($D(^DVB(396.3,D0,0)):^(0),1:"")
"KRN",.4,1408,"F",1)
X DXS(1,9.2) S X=$S('$D(^DPT(+$P(DIP(101),U,1),0)):"",1:$P(^(0),U,1)) S D0=I(0,0) W X K DIP;"NAME";L25;Z;"2507 REQUEST:NAME"~
"KRN",.4,1408,"F",2)
X DXS(2,9) W X K DIP;"SSN";L13;Z;"2507 REQUEST:NAME:SSN"~
"KRN",.4,1408,"F",3)
X DXS(3,9.2) S X=$S('$D(^DIC(4,+$P(DIP(101),U,3),0)):"",1:$P(^(0),U,1)) S D0=I(0,0) W X K DIP;"REGIONAL OFFICE NUMBER";L15;Z;"2507 REQUEST:REGIONAL OFFICE NUMBER"~
"KRN",.4,1408,"F",4)
.03;"EXAM";L28~
"KRN",.4,1408,"F",5)
S DIP(1)=$S($D(^DVB(396.4,D0,0)):^(0),1:"") S X=$P(DIP(1),U,6) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"EXAM DATE";L10;Z;"NUMDATE4(DATE OF EXAM)"~
"KRN",.4,1408,"F",6)
.07;"EXAMINING PHYSICIAN";L30;~
"KRN",.4,1408,"H")
2507 EXAM LIST
"KRN",.4,1656,-1)
0^8
"KRN",.4,1656,0)
DVBA NOTICE OF DISCHARGE^2980128.1456^^396^^^2980128
"KRN",.4,1656,"DXS",1,9)
X DXS(1,9.2) S D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(201)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(201),U,9) S D0=I(0,0)
"KRN",.4,1656,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S I(100,0)=$S($D(D0):D0,1:"")
"KRN",.4,1656,"F",1)
.01;L20~X DXS(1,9) W X K DIP;"SSN";Z;"PATIENT NAME IN PATIENT FILE:SOCIAL SECURITY NUMBER"~4;L7;"NOT/DIS REQ?"~
"KRN",.4,1656,"F",2)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$P(DIP(1),U,10) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;L10;"NT/DIS COMP DATE";Z;"NUMDATE4(NOTICE/DISCHG COMPLETION DATE)"~
"KRN",.4,1656,"F",3)
4.5;L8;"NOT/DIS STATUS"~4.9;"NOT/DIS COMPLETED BY";L15~
"KRN",.4,1656,"H")
FORM 7131 LIST
"KRN",.4,1657,-1)
0^1
"KRN",.4,1657,0)
DVBA 21 DAY CERT^2980128.1^^396^^^2980128
"KRN",.4,1657,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S DIP(101)=$S($D(^DPT(D0,0)):^(0),1:"")
"KRN",.4,1657,"F",1)
.01;L20~X DXS(1,9.2) S X=$P(DIP(101),U,9) S D0=I(0,0) W X K DIP;"SSN";Z;"PATIENT:SOCIAL SECURITY NUMBER"~6;"21-DAY CERT REQ?";L4~
"KRN",.4,1657,"F",2)
S DIP(1)=$S($D(^DVB(396,D0,0)):^(0),1:"") S X=$P(DIP(1),U,14) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) W X K DIP;"21-DAY CERT COMP DATE";L10;Z;"NUMDATE4(#6.8)"~
"KRN",.4,1657,"F",3)
6.5;L10;"21-DAY STATUS"~6.9;L15;"21-DAY CERT COMPLETED BY"~
"KRN",.4,1657,"H")
FORM 7131 LIST
"OER",173,0)
173^DVBA
"OER",173,1,0)
^100.9951PA^5^5
"OER",173,1,1,0)
634
"OER",173,1,1,1,0)
^100.99511PA^1^1
"OER",173,1,1,1,1,0)
1106
"OER",173,1,2,0)
635
"OER",173,1,2,1,0)
^100.99511PA^1^1
"OER",173,1,2,1,1,0)
1106
"OER",173,1,3,0)
644
"OER",173,1,3,1,0)
^100.99511PA^1^1
"OER",173,1,3,1,1,0)
1106
"OER",173,1,4,0)
642
"OER",173,1,4,1,0)
^100.99511PA^2^2
"OER",173,1,4,1,1,0)
1106
"OER",173,1,4,1,2,0)
1303
"OER",173,1,5,0)
1305
"OER",173,1,5,1,0)
^100.99511PA^1^1
"OER",173,1,5,1,1,0)
414
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",173,-1)
1^1
"PKG",173,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",173,22,0)
^9.49I^1^1
"PKG",173,22,1,0)
2.7^2950410^2950427
"PKG",173,22,1,"PAH",1,0)
17^2980302^11988
"PKG",173,22,1,"PAH",1,1,0)
^^1^1^2980309
"PKG",173,22,1,"PAH",1,1,1,0)
 See the patch description for DVBA*2.7*17 in the Patch Module on Forum.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
27
"RTN","DVBAADRP")
0^2^B15962581
"RTN","DVBAADRP",1,0)
DVBAADRP ;ALB/GTS-557/THM-AMIE COMPLETE ADMISSION RPT ; 1/22/91  1:19 PM
"RTN","DVBAADRP",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAADRP",3,0)
 K ^TMP($J) G TERM
"RTN","DVBAADRP",4,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAADRP",5,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBAADRP",6,0)
 Q
"RTN","DVBAADRP",7,0)
 ;
"RTN","DVBAADRP",8,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),DFN=DA,QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBAADRP",9,0)
 S:ADMDT]"" ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBAADRP",10,0)
 S:DCHGDT]"" DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBAADRP",11,0)
 W:(IOST?1"C-".E!($D(DVBAON2))) @IOF
"RTN","DVBAADRP",12,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAADRP",13,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Admission Date:",?26,ADMDT,!,?3,"Admitting Diagnosis:",?26,DIAG,!
"RTN","DVBAADRP",14,0)
 W ?8,"Discharge Date:",?26,DCHGDT,!,?11,"Bed Service:",?26,BEDSEC,!,?13,"Recv A&A?:",?26,$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified"),!
"RTN","DVBAADRP",15,0)
 W ?14,"Pension?:",?26,$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),! D ELIG^DVBAVDPT I IOST'?1"C-".E S DVBAON2=""
"RTN","DVBAADRP",16,0)
 I IOST?1"C-".E DO
"RTN","DVBAADRP",17,0)
 .I ($O(^TMP($J,XCN))'=""!($O(^TMP($J,XCN,CFLOC))'=""!($O(^TMP($J,XCN,CFLOC,ADM))'=""!($O(^TMP($J,XCN,CFLOC,ADM,DA))'="")))) DO
"RTN","DVBAADRP",18,0)
 ..W *7,!,"Press RETURN to continue or ""^"" to stop    "
"RTN","DVBAADRP",19,0)
 ..R ANS:DTIME
"RTN","DVBAADRP",20,0)
 ..S:ANS=U!('$T) QUIT=1
"RTN","DVBAADRP",21,0)
 ..I '$T S DVBAQUIT=1
"RTN","DVBAADRP",22,0)
 .I ($O(^TMP($J,XCN))=""&($O(^TMP($J,XCN,CFLOC))=""&($O(^TMP($J,XCN,CFLOC,ADM))=""&($O(^TMP($J,XCN,CFLOC,ADM,DA))="")))) DO
"RTN","DVBAADRP",23,0)
 ..W *7,!,"Press RETURN to continue  "
"RTN","DVBAADRP",24,0)
 ..R ANS:DTIME
"RTN","DVBAADRP",25,0)
 Q
"RTN","DVBAADRP",26,0)
 ;
"RTN","DVBAADRP",27,0)
PRINT U IO S QUIT="" K MA,MB
"RTN","DVBAADRP",28,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAADRP",29,0)
 Q
"RTN","DVBAADRP",30,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAADRP",31,0)
 Q
"RTN","DVBAADRP",32,0)
 ;
"RTN","DVBAADRP",33,0)
TERM D HOME^%ZIS K NOASK,QUIT1
"RTN","DVBAADRP",34,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAADRP",35,0)
 ;
"RTN","DVBAADRP",36,0)
SETUP W @IOF,!,"VARO COMPLETE ADMISSION REPORT" S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAADRP",37,0)
 S HEAD="TOTAL ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAADRP",38,0)
 W !,HEAD1
"RTN","DVBAADRP",39,0)
EN1 W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,3) X ^DD("DD") W Y,!!
"RTN","DVBAADRP",40,0)
 D DATE^DVBAUTIL
"RTN","DVBAADRP",41,0)
 G:X=""!(Y<0) KILL S %ZIS="AEQ" D ^%ZIS K %ZIS
"RTN","DVBAADRP",42,0)
 I POP K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAADRP",43,0)
 ;
"RTN","DVBAADRP",44,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBAADRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE ADMISSION REPORT" F I="BDATE","EDATE","HEAD","HEAD1","RO","RONUM","FDT(0)","NOASK" S ZTSAVE(I)=""
"RTN","DVBAADRP",45,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBAADRP",46,0)
 ;
"RTN","DVBAADRP",47,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  I MA'>EDATE D SET
"RTN","DVBAADRP",48,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBAADRP",49,0)
 I $D(^TMP($J)) D PRINT I $D(DVBAQUIT) K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAADRP",50,0)
 ;
"RTN","DVBAADRP",51,0)
KILL D ^%ZISC S X=3 K DVBAON2,DCHPTR,M,Y,J D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBAADRP",52,0)
 ;
"RTN","DVBAADRP",53,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBACMRP")
0^3^B19319969
"RTN","DVBACMRP",1,0)
DVBACMRP ;ALB/GTS-557/THM-INCOMPETENT RPT ; 1/16/91  7:23 AM
"RTN","DVBACMRP",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBACMRP",3,0)
 K ^TMP($J) G TERM
"RTN","DVBACMRP",4,0)
SET Q:'$D(^DPT(DA,.29))  S ICDAT=^(.29) Q:$P(ICDAT,U,12)'=1&(ICDAT']"")  S INCMP="" S:$P(ICDAT,U)]""!($P(ICDAT,U,12)=1) INCMP=1 Q:INCMP'=1  S ICDAT2=$P(ICDAT,U,2),ICDAT=$P(ICDAT,U)
"RTN","DVBACMRP",5,0)
 S:ICDAT]"" ICDAT=$$FMTE^XLFDT(ICDAT,"5DZ")
"RTN","DVBACMRP",6,0)
 S:ICDAT2]"" ICDAT2=$$FMTE^XLFDT(ICDAT2,"5DZ")
"RTN","DVBACMRP",7,0)
 Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBACMRP",8,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_ICDAT_U_ICDAT2_U_INCMP
"RTN","DVBACMRP",9,0)
 Q
"RTN","DVBACMRP",10,0)
 ;
"RTN","DVBACMRP",11,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),ICDAT=$P(DATA,U,5),ICDAT2=$P(DATA,U,6),INCMP=$P(DATA,U,7),DFN=DA,QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBACMRP",12,0)
 S ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBACMRP",13,0)
 S DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBACMRP",14,0)
 S LADM=ADM,TDIS="UNKNOWN",TO="",DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBACMRP",15,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBACMRP",16,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBACMRP",17,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBACMRP",18,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Admission Date:",?26,ADMDT,!,?3,"Admitting Diagnosis:",?26,DIAG,!
"RTN","DVBACMRP",19,0)
 W ?8,"Discharge Date:",?26,DCHGDT,! W:DCHGDT]"" ?5,"Type of Discharge:",?26,TDIS_$S(TO]"":" TO "_$S($D(^DIC(4,+TO,0)):$P(^(0),U,1),1:""),1:""),!
"RTN","DVBACMRP",20,0)
 W ?11,"Bed Service:",?26,BEDSEC,!,?13,"Recv A&A?:",?26,$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified"),!
"RTN","DVBACMRP",21,0)
 W ?14,"Pension?:",?26,$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),! D ELIG^DVBAVDPT
"RTN","DVBACMRP",22,0)
 W !,?5,"DATE RULED INCOMP:" W:ICDAT]"" ?26,ICDAT_" (VA)" W:ICDAT2]"" " - ",ICDAT2_" (CIVIL)" W !
"RTN","DVBACMRP",23,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBACMRP",24,0)
 S DVBAON2=""
"RTN","DVBACMRP",25,0)
 Q
"RTN","DVBACMRP",26,0)
 ;
"RTN","DVBACMRP",27,0)
PRINT U IO S QUIT=""
"RTN","DVBACMRP",28,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBACMRP",29,0)
 Q
"RTN","DVBACMRP",30,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBACMRP",31,0)
 Q
"RTN","DVBACMRP",32,0)
 ;
"RTN","DVBACMRP",33,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBACMRP",34,0)
 ;
"RTN","DVBACMRP",35,0)
SETUP W @IOF,!,"VARO INCOMPETENCY REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBACMRP",36,0)
 S HEAD="INCOMPETENCY REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBACMRP",37,0)
 W !,HEAD1
"RTN","DVBACMRP",38,0)
EN1 W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,5) X ^DD("DD") W Y,!!
"RTN","DVBACMRP",39,0)
 D DATE^DVBAUTIL G:X=""!(Y<0) KILL
"RTN","DVBACMRP",40,0)
 S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBACMRP",41,0)
 ;
"RTN","DVBACMRP",42,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBACMRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE INCOMPETENT VET REPORT" F I="FDT(0)","HEAD","HEAD1","BDATE","EDATE","TYPE","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBACMRP",43,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBACMRP",44,0)
 ;
"RTN","DVBACMRP",45,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  D SET I '$D(NOASK) W "."
"RTN","DVBACMRP",46,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBACMRP",47,0)
 I $D(^TMP($J)) D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBACMRP",48,0)
 ;
"RTN","DVBACMRP",49,0)
KILL D ^%ZISC S X=5 K DVBAON2 D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBACMRP",50,0)
 ;
"RTN","DVBACMRP",51,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBADSNT")
0^25^B21131778
"RTN","DVBADSNT",1,0)
DVBADSNT ;ALB/GTS-557/THM-GENERATE AMIE NOTICE OF DISCHARGE ; 1/16/91  7:37 AM
"RTN","DVBADSNT",2,0)
 ;;2.7;AMIE;**1,14,17**;Apr 10, 1995
"RTN","DVBADSNT",3,0)
 K ^TMP($J) G TERM
"RTN","DVBADSNT",4,0)
 ;
"RTN","DVBADSNT",5,0)
SET Q:'$D(^DPT(DFN,0))  D RCV^DVBAVDPT S ^TMP($J,XCN,CFLOC,MB,DFN)=XDA_U_XDA2_U_ADMDT_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBADSNT",6,0)
 Q
"RTN","DVBADSNT",7,0)
 ;
"RTN","DVBADSNT",8,0)
PRINTB S XDA=$P(DATA,U),XDA2=$P(DATA,U,2),ADMDT=$P(DATA,U,3),RCVAA=$P(DATA,U,4),RCVPEN=$P(DATA,U,5),CNUM=$P(DATA,U,6),QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBADSNT",9,0)
 S LADM=ADM
"RTN","DVBADSNT",10,0)
 I '$D(^DGPM(LADM,0)) S FND=1
"RTN","DVBADSNT",11,0)
 I $D(^DGPM(LADM,0)) N HPAT S HPAT=$P(^DGPM(LADM,0),"^",3) I $D(^DPT(HPAT,0)) S HPAT=$P(^DPT(HPAT,0),"^") I (HPAT'=PNAM)!(ADMDT'=$P(^DGPM(LADM,0),"^")) S FND=1
"RTN","DVBADSNT",12,0)
 I $D(FND) N Y S Y=ADMDT D DD^%DT W !!,"Admission entry in Patient Movement File has been deleted for: ",!,?5,PNAM,?25,SSN,?35," at ",Y,!,"Contact VAMC for further information.",! K Y,FND D FUPD Q
"RTN","DVBADSNT",13,0)
 S DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBADSNT",14,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBADSNT",15,0)
 I DCHGDT="" S DCHGDT=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U),1:"")
"RTN","DVBADSNT",16,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBADSNT",17,0)
 W !!!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBADSNT",18,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Discharge Date:",?26,$$FMTE^XLFDT(DCHGDT,"5DZ"),!
"RTN","DVBADSNT",19,0)
 W ?5,"Type of Discharge:",?26,TDIS,!
"RTN","DVBADSNT",20,0)
 D LOS^DVBAUTIL W ?8,"Length of Stay:",?26,LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),!
"RTN","DVBADSNT",21,0)
 W ?11,"Bed Service:",?26,BEDSEC,! S DA=DFN D ELIG^DVBAVDPT
"RTN","DVBADSNT",22,0)
FUPD K DA I XDA2]"",$P(^DVB(396,XDA2,0),U,9)="P" S DA=XDA2,DIE="^DVB(396,",DR="4.5////C;4.8////"_DT_";4.9////"_"Notice of Discharge" D ^DIE K DA
"RTN","DVBADSNT",23,0)
 I $D(DVBAD2) I DVBAD2=CFLOC!(CFLOC=376) S DIE="^DVB(396.2,",DA=XDA,DR="3///P;4///"_DT_";5////"_DUZ D ^DIE
"RTN","DVBADSNT",24,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBADSNT",25,0)
 S DVBAON2=""
"RTN","DVBADSNT",26,0)
 Q
"RTN","DVBADSNT",27,0)
 ;
"RTN","DVBADSNT",28,0)
PRINT U IO S QUIT=""
"RTN","DVBADSNT",29,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBADSNT",30,0)
 Q
"RTN","DVBADSNT",31,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""  S DFN="" F L=0:0 S DFN=$O(^TMP($J,XCN,CFLOC,ADM,DFN)) Q:DFN=""!(QUIT=1)  S DATA=^(DFN) D PRINTB
"RTN","DVBADSNT",32,0)
 Q
"RTN","DVBADSNT",33,0)
 ;
"RTN","DVBADSNT",34,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBADSNT",35,0)
 D DUZ2^DVBAUTIL I $D(DVBAQUIT) K DVBAQUIT G KILL
"RTN","DVBADSNT",36,0)
 ;
"RTN","DVBADSNT",37,0)
SETUP W @IOF,!,"NOTICE OF DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBADSNT",38,0)
 S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBADSNT",39,0)
 W !,HEAD1
"RTN","DVBADSNT",40,0)
EN1 W !!,"This program will print out any new NOTICES OF DISCHARGE,",!,"based on the hospital's discharges.",!!,"Do you want to continue" S %=2 D YN^DICN
"RTN","DVBADSNT",41,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y to print out the notice, N if you want to exit the program.",! G EN1
"RTN","DVBADSNT",42,0)
 G:%'=1 KILL S %ZIS="Q" D ^%ZIS K %ZIS I POP G KILL
"RTN","DVBADSNT",43,0)
 ;
"RTN","DVBADSNT",44,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSNT",ZTIO=ION,NOASK=1,ZTDESC="AMIE NOTICE OF DISCHARGE REPORT" F I="FDT(0)","HEAD","HEAD1","NOASK","DVBAD2" S ZTSAVE(I)=""
"RTN","DVBADSNT",45,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! K ZTSK G KILL
"RTN","DVBADSNT",46,0)
 ;
"RTN","DVBADSNT",47,0)
GO F XDA=0:0 S XDA=$O(^DVB(396.2,"C",DVBAD2,"R",XDA)) Q:XDA=""  I $D(^DVB(396.2,XDA,0)) S MB=^(0),DFN=$P(MB,U),ADMDT=$P(MB,U,2),MB=$P(MB,U,3) D CHK,SET I '$D(NOASK) W "."
"RTN","DVBADSNT",48,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found.",!! H 2 G KILL
"RTN","DVBADSNT",49,0)
 D PRINT
"RTN","DVBADSNT",50,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBADSNT",51,0)
 ;
"RTN","DVBADSNT",52,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBADSNT",53,0)
 ;
"RTN","DVBADSNT",54,0)
CHK ;pull 7131 pointer
"RTN","DVBADSNT",55,0)
 F XDA2=0:0 S XDA2=$O(^DVB(396,"G",ADMDT,XDA2)) Q:XDA2=""  I $D(^DVB(396,XDA2,2))&($D(^DVB(396,XDA2,0))) Q:($P(^DVB(396,XDA2,0),U,1)=DFN&($P(^DVB(396,XDA2,2),"^",10)="A"))
"RTN","DVBADSNT",56,0)
 Q
"RTN","DVBADSNT",57,0)
 ;
"RTN","DVBADSNT",58,0)
REPRINT D CHK,SET,PRINT G KILL
"RTN","DVBADSR1")
0^4^B4823251
"RTN","DVBADSR1",1,0)
DVBADSR1 ;ALB/GTS-557/THM-REPRINT AMIE NOTICE OF DISCHARGE ;21 JUL 89
"RTN","DVBADSR1",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBADSR1",3,0)
 D HOME^%ZIS
"RTN","DVBADSR1",4,0)
 D DUZ2^DVBAUTIL I $D(DVBAQUIT) K DVBAQUIT G EXIT
"RTN","DVBADSR1",5,0)
 ;
"RTN","DVBADSR1",6,0)
SETUP S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBADSR1",7,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBADSR1",8,0)
 S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBADSR1",9,0)
 ;
"RTN","DVBADSR1",10,0)
EN W @IOF,!?(IOM-$L(HD)\2),HD,!!
"RTN","DVBADSR1",11,0)
 S DIC="^DVB(396.2,",DIC(0)="AEQM",DIC("A")="Enter NAME to reprint: "
"RTN","DVBADSR1",12,0)
 S DIC("W")="S DFN=$P(^DVB(396.2,+Y,0),U,1),ADM=$P(^(0),U,3) I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"""" S DCHPTR=$P(^(0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"""":$P(^(0),U,1),1:"""") X DVBA(""W"")"
"RTN","DVBADSR1",13,0)
 S DVBA("W")="W:$X>50 ! W ?($X+5),""Discharge date: "",$$FMTE^XLFDT(DISCH,""5DZ"")"
"RTN","DVBADSR1",14,0)
 D ^DIC I X=""!(X=U) K DVBA G EXIT
"RTN","DVBADSR1",15,0)
 I +Y<0 W *7,"   ??" H 1 G EN
"RTN","DVBADSR1",16,0)
 I $P(^DVB(396.2,+Y,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 G EN
"RTN","DVBADSR1",17,0)
 I +Y>0 S XDA=+Y,DA=$P(^DVB(396.2,+Y,0),U,1),ADMDT=$P(^(0),U,2),MB=$P(^(0),U,3)
"RTN","DVBADSR1",18,0)
 S %ZIS("B")="0;P-OTHER",%ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS K %ZIS
"RTN","DVBADSR1",19,0)
 I $D(IO("Q")) S ZTIO=ION,ZTRTN="REPRINT^DVBADSNT",ZTDESC="Reprint notice of discharge" F I="H*","D*","FDT*","A*","XDA","MB" S ZTSAVE(I)=""
"RTN","DVBADSR1",20,0)
 I  D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 2 G KILL^DVBAUTIL
"RTN","DVBADSR1",21,0)
 I POP G KILL^DVBAUTIL
"RTN","DVBADSR1",22,0)
 D REPRINT^DVBADSNT K ^TMP($J) G SETUP
"RTN","DVBADSR1",23,0)
 ;
"RTN","DVBADSR1",24,0)
EXIT G KILL^DVBAUTIL
"RTN","DVBADSRP")
0^5^B20250047
"RTN","DVBADSRP",1,0)
DVBADSRP ;ALB/GTS-557/THM-REPRINT NOTICE OF DISCHARGE ; 1/22/91  12:05 PM
"RTN","DVBADSRP",2,0)
 ;;2.7;AMIE;**1,17**;Apr 10, 1995
"RTN","DVBADSRP",3,0)
 K ^TMP($J) G TERM
"RTN","DVBADSRP",4,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT S ^TMP($J,XCN,CFLOC,MB,DA)=ADMDT_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBADSRP",5,0)
 Q
"RTN","DVBADSRP",6,0)
 ;
"RTN","DVBADSRP",7,0)
PRINTB S ADMDT=$P(DTA,U),RCVAA=$P(DTA,U,2),RCVPEN=$P(DTA,U,3),CNUM=$P(DTA,U,4),QUIT1=1,DFN=DA D ADM^DVBAVDPT
"RTN","DVBADSRP",8,0)
 S LADM=ADM
"RTN","DVBADSRP",9,0)
 I '$D(^DGPM(LADM,0)) S FND=1
"RTN","DVBADSRP",10,0)
 I $D(^DGPM(LADM,0)) N HPAT S HPAT=$P(^DGPM(LADM,0),"^",3) I $D(^DPT(HPAT,0)) S HPAT=$P(^DPT(HPAT,0),"^") I (HPAT'=PNAM)!(ADMDT'=$P(^DGPM(LADM,0),"^")) S FND=1
"RTN","DVBADSRP",11,0)
 I $D(FND) N Y S Y=ADMDT D DD^%DT W !!,"Admission entry in Patient Movement File has been deleted for: ",!,?5,PNAM,?25,SSN,?35," at ",Y,!,"Contact VAMC for further information.",! K Y,FND S DVBAON2="" Q
"RTN","DVBADSRP",12,0)
 S DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBADSRP",13,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBADSRP",14,0)
 I DCHGDT="" S DCHGDT=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U),1:"")
"RTN","DVBADSRP",15,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBADSRP",16,0)
 W !!!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBADSRP",17,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Discharge Date:",?26,$$FMTE^XLFDT(DCHGDT,"5DZ"),!
"RTN","DVBADSRP",18,0)
 W ?5,"Type of Discharge:",?26,TDIS,!
"RTN","DVBADSRP",19,0)
 D LOS^DVBAUTIL W ?8,"Length of Stay:",?26,LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),!
"RTN","DVBADSRP",20,0)
 W ?11,"Bed Service:",?26,BEDSEC,! D ELIG^DVBAVDPT ;no updating required
"RTN","DVBADSRP",21,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop" R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBADSRP",22,0)
 S DVBAON2=""
"RTN","DVBADSRP",23,0)
 Q
"RTN","DVBADSRP",24,0)
 ;
"RTN","DVBADSRP",25,0)
PRINT U IO S QUIT=""
"RTN","DVBADSRP",26,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBADSRP",27,0)
 Q
"RTN","DVBADSRP",28,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DTA=^(DA) D PRINTB
"RTN","DVBADSRP",29,0)
 Q
"RTN","DVBADSRP",30,0)
 ;
"RTN","DVBADSRP",31,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBADSRP",32,0)
 D DUZ2^DVBAUTIL I $D(DVBAQUIT) K DVBAQUIT G KILL
"RTN","DVBADSRP",33,0)
 ;
"RTN","DVBADSRP",34,0)
SETUP W @IOF,!,"* REPRINT * NOTICE OF DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBADSRP",35,0)
 S HEAD="NOTICE OF DISCHARGE REPRINT",U="^",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBADSRP",36,0)
 W !,HEAD1
"RTN","DVBADSRP",37,0)
EN1 W !!,"This program will reprint NOTICES OF DISCHARGE,",!!,"Do you want to continue" S %=2 D YN^DICN
"RTN","DVBADSRP",38,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y to reprint or N to quit.",! G EN1
"RTN","DVBADSRP",39,0)
 I %'=1 G KILL
"RTN","DVBADSRP",40,0)
ONE W !!,"Do you want only one Veteran" S %=2 D YN^DICN G:%=1 ^DVBADSR1
"RTN","DVBADSRP",41,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y to get one VET, N for all.",! G ONE
"RTN","DVBADSRP",42,0)
 G:$D(DTOUT)!(%<0) KILL
"RTN","DVBADSRP",43,0)
 ;
"RTN","DVBADSRP",44,0)
ASK W ! S %DT(0)=-DT,%DT("A")="Enter ORIGINAL PROCESSING date: ",%DT="AE" D ^%DT G:Y<0 KILL S BDATE=Y K %DT
"RTN","DVBADSRP",45,0)
 I X["?" W !,"The date the notices were originally printed on.",! G ASK
"RTN","DVBADSRP",46,0)
 G:X=""!(X=U) KILL S %ZIS="AEQ",%ZIS("B")="0;P-OTHER" D ^%ZIS K %ZIS
"RTN","DVBADSRP",47,0)
 I POP G KILL
"RTN","DVBADSRP",48,0)
 ;
"RTN","DVBADSRP",49,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE NOTICE OF DISCHARGE RPT" F I="REP","DVBATYPS","BDATE","FDT(0)","HEAD","HEAD1","NOASK","DVBAD2" S ZTSAVE(I)=""
"RTN","DVBADSRP",50,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued." G KILL
"RTN","DVBADSRP",51,0)
GO F XDA=0:0 S XDA=$O(^DVB(396.2,"C",DVBAD2,"P",XDA)) Q:XDA=""  S MB=^DVB(396.2,XDA,0),DA=$P(MB,U),ADMDT=$P(MB,U,2),MB=$P(MB,U,3) D:$P(^DVB(396.2,XDA,0),U,5)=BDATE SET I '$D(NOASK) W "."
"RTN","DVBADSRP",52,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters.",!! H 2 G KILL
"RTN","DVBADSRP",53,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBADSRP",54,0)
 ;
"RTN","DVBADSRP",55,0)
KILL K DVBAON2 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBAUTIL
"RTN","DVBADSRP",56,0)
 ;
"RTN","DVBADSRP",57,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBADSRP",58,0)
 ;
"RTN","DVBADSRP",59,0)
REPRINT D SET,PRINT G KILL
"RTN","DVBADSRT")
0^6^B17467761
"RTN","DVBADSRT",1,0)
DVBADSRT ;ALB/GTS-557/THM-AMIE DISCHARGE RPT ; 1/16/91  4:23 PM
"RTN","DVBADSRT",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBADSRT",3,0)
 ;
"RTN","DVBADSRT",4,0)
 K ^TMP($J) G TERM
"RTN","DVBADSRT",5,0)
 ;
"RTN","DVBADSRT",6,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA,DVBASC="" D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)  Q:ADTYPE="S"&(DVBASC'="Y")  Q:ADTYPE="A"&(RCVAA'=1)  Q:ADTYPE="P"&(RCVPEN'="1")
"RTN","DVBADSRT",7,0)
 S TDIS=$S($D(^DGPM(+MB,0)):$P(^(0),U,18),1:"")
"RTN","DVBADSRT",8,0)
 I $D(^DG(405.2,+TDIS,0)) DO
"RTN","DVBADSRT",9,0)
 .I '$D(^TMP("DVBA",$J,"DUP",+TDIS)) Q
"RTN","DVBADSRT",10,0)
 .S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBADSRT",11,0)
 .S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBADSRT",12,0)
 .Q
"RTN","DVBADSRT",13,0)
 Q
"RTN","DVBADSRT",14,0)
 ;
"RTN","DVBADSRT",15,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5),DFN=DA,QUIT1=1 D DCHGDT^DVBAVDPT
"RTN","DVBADSRT",16,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBADSRT",17,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBADSRT",18,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!
"RTN","DVBADSRT",19,0)
 W ?8,"Discharge Date:",?26,$$FMTE^XLFDT(DCHGDT,"5DZ"),!,?5,"Type of Discharge:",?26,TDIS,!
"RTN","DVBADSRT",20,0)
 D LOS^DVBAUTIL W ?8,"Length of Stay:",?26,LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),!
"RTN","DVBADSRT",21,0)
 W ?11,"Bed Service:",?26,BEDSEC,!
"RTN","DVBADSRT",22,0)
 W ?13,"Recv A&A?:",?26,$S(RCVAA="0":"NO",RCVAA="1":"YES",1:"Not specified"),!
"RTN","DVBADSRT",23,0)
 W ?14,"Pension?:",?26,$S(RCVPEN="0":"NO",RCVPEN="1":"YES",1:"Not specified"),! D ELIG^DVBAVDPT
"RTN","DVBADSRT",24,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I ANS=U S DVBAQUIT=1
"RTN","DVBADSRT",25,0)
 S DVBAON2=""
"RTN","DVBADSRT",26,0)
 Q
"RTN","DVBADSRT",27,0)
 ;
"RTN","DVBADSRT",28,0)
PRINT U IO S QUIT=""
"RTN","DVBADSRT",29,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBADSRT",30,0)
 Q
"RTN","DVBADSRT",31,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBADSRT",32,0)
 Q
"RTN","DVBADSRT",33,0)
 ;
"RTN","DVBADSRT",34,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBADSRT",35,0)
 ;
"RTN","DVBADSRT",36,0)
SETUP W @IOF,!,"VARO DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBADSRT",37,0)
 S DSRP=1,HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0) W !,HEAD1
"RTN","DVBADSRT",38,0)
 ;
"RTN","DVBADSRT",39,0)
EN1 W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,4) X ^DD("DD") W Y,!!
"RTN","DVBADSRT",40,0)
 D DATE^DVBAUTIL
"RTN","DVBADSRT",41,0)
 G:X=""!(Y<0) KILL
"RTN","DVBADSRT",42,0)
 ;
"RTN","DVBADSRT",43,0)
ADTYPE D ADTYPE^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBADSRT",44,0)
 W @IOF
"RTN","DVBADSRT",45,0)
 K DVBACEPT
"RTN","DVBADSRT",46,0)
 D EN^VALM("DVBA DISCHARGE TYPES")
"RTN","DVBADSRT",47,0)
 I '$D(DVBACEPT) D KILL^DVBAUTIL Q
"RTN","DVBADSRT",48,0)
 I '$O(^TMP("DVBA",$J,"DUP",0)) D KILL^DVBAUTIL Q
"RTN","DVBADSRT",49,0)
 ;
"RTN","DVBADSRT",50,0)
 W !!! S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBADSRT",51,0)
 ;
"RTN","DVBADSRT",52,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSRT",ZTIO=ION,NOASK=1,ZTDESC="AMIE DISCHARGE REPORT" F I="^TMP(""DVBA"",$J,""DUP""","ADTYPE","DVBATYPS","BDATE","BDATE1","EDATE","FDT(0)","HEAD","HEAD1","HD","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBADSRT",53,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",! G KILL
"RTN","DVBADSRT",54,0)
 ;
"RTN","DVBADSRT",55,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV3",MA)) Q:MA>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV3",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV3",MA,DA,MB)) Q:MB=""  D SET
"RTN","DVBADSRT",56,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBADSRT",57,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBADSRT",58,0)
 ;
"RTN","DVBADSRT",59,0)
KILL D ^%ZISC D:$D(ZTQUEUED) KILL^%ZTLOAD S X=4 K DVBAON2 G FINAL^DVBAUTIL
"RTN","DVBADSRT",60,0)
 ;
"RTN","DVBADSRT",61,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAEDIT")
0^7^B13046230
"RTN","DVBAEDIT",1,0)
DVBAEDIT ;ALB ISC/THM-EDIT AMIE BENEFICIARY INFO STATUS ;21 JUL 89@0117
"RTN","DVBAEDIT",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAEDIT",3,0)
 I $D(DUZ)#2=0 W !!,*7,"You have no USER NUMBER.  Contact the site manager.",!! H 3 G EXIT
"RTN","DVBAEDIT",4,0)
 ;
"RTN","DVBAEDIT",5,0)
TERM D HOME^%ZIS S OPER=$S($D(^VA(200,+DUZ,0)):$P(^(0),U,1),1:"Unknown operator")
"RTN","DVBAEDIT",6,0)
 S HD="7131 REQUEST STATUS EDITING"
"RTN","DVBAEDIT",7,0)
 ;
"RTN","DVBAEDIT",8,0)
SETUP W @IOF,!?(IOM-$L(HD)\2),HD,!! S DIE="^DVB(396,",DR="[DVBA STATUS EDIT]",DIC=DIE,DIC(0)="AEQMZ",DIC("A")="Enter PATIENT NAME: " K DVBACORR,OUT
"RTN","DVBAEDIT",9,0)
 D DICW^DVBAUTIL
"RTN","DVBAEDIT",10,0)
 S DVBACORR="N",SUPER=0 I $D(^XUSEC("DVBA SUPERVISOR",DUZ)) S SUPER=1,DVBACORR="Y"
"RTN","DVBAEDIT",11,0)
 ;
"RTN","DVBAEDIT",12,0)
EDIT D ^DIC G:X=U!(X="") EXIT W:Y<0 *7,"  ??" G:Y<0 EDIT I Y>0 S DVBAPNAM=Y(0,0),DA=+Y W !! G CHK
"RTN","DVBAEDIT",13,0)
 ;;;OLD  D ^DIC G:X=U!(X="") EXIT W:Y<0 *7,"  ??" G:Y<0 EDIT I Y>0 S DA=+Y W !! G CHK
"RTN","DVBAEDIT",14,0)
 ;
"RTN","DVBAEDIT",15,0)
EDIT1 K OUT,%,%Y S %DT(0)=-DT I SUPER=1 W !!!,*7,"Supervisory edit -- all fields available.",!!
"RTN","DVBAEDIT",16,0)
 I  W "Note:  As a Supervisor you will be allowed to use the ""^"" to escape",!,"from the program if desired.  This is not normally allowed.",! S DIE("NO^")="OUTOK" D CON G:$D(OUT) FINAL
"RTN","DVBAEDIT",17,0)
 I SUPER=0 S DIE("NO^")=1
"RTN","DVBAEDIT",18,0)
 W @IOF,!,?(IOM-$L(HD)\2),HD,!!!,"Patient Name: ",DVBAPNAM D ^DIE K DIE("NO^")
"RTN","DVBAEDIT",19,0)
 ; NEW FIX - W !,?(IOM-$L(HD)\2) D ^DIE K DIE("NO^")
"RTN","DVBAEDIT",20,0)
 ;
"RTN","DVBAEDIT",21,0)
FINAL D CHK1 G:NOFINAL=1 SETUP W !!,*7,"All items are completed.  This record is now FINALIZED.",!
"RTN","DVBAEDIT",22,0)
 S DIE="^DVB(396,",DR="25////"_DT_";26////"_OPER W !,"Updating record, please wait  ",! D ^DIE H 1
"RTN","DVBAEDIT",23,0)
 D CON G:$D(OUT) EXIT
"RTN","DVBAEDIT",24,0)
 K DA,Y G SETUP
"RTN","DVBAEDIT",25,0)
 ;
"RTN","DVBAEDIT",26,0)
EXIT W @IOF K DIE,DR,DIC,DIC(0),DIC("A"),DA,OPER,FDATE,%DT,X,NOFINAL,ZA,Y,%DT,HD,ANS,ZTYPE,DVBADIC,CODE,D0,DLAYGO,DQ,C,%X,%Y,%,DREF,DI,DIYS,ZX,%DT,DVBASTAT,DVBADT,CODE,ZX,FDT(0)
"RTN","DVBAEDIT",27,0)
 K DVBAPNAM,POP,DG,DIFLD,DK,DL,DM,SUPER,OUT,DVBACORR,D,OLDDR,DTOUT
"RTN","DVBAEDIT",28,0)
 Q
"RTN","DVBAEDIT",29,0)
 ;
"RTN","DVBAEDIT",30,0)
CHK ;CHECK TO SEE IF FINALIZED
"RTN","DVBAEDIT",31,0)
 K %,%Y
"RTN","DVBAEDIT",32,0)
 I SUPER=1,$D(^DVB(396,DA,1)),$P(^(1),U,12)]"" W *7,!,"This is finalized.  Do you want to 'unfinalize' it" S %=1 D YN^DICN I $D(%Y),%Y["?" W !!,"Enter Y if you wish to reopen this and be able to edit it,",!,"or N to leave it as is",!! G CHK
"RTN","DVBAEDIT",33,0)
 G:$D(DTOUT) EXIT I SUPER=1,$D(%),%=1 S OLDDR=DR,DR="25///@",DIE="^DVB(396," D ^DIE S DR=OLDDR G EDIT1
"RTN","DVBAEDIT",34,0)
 I SUPER=1,$D(%),%'=1 G SETUP
"RTN","DVBAEDIT",35,0)
 I SUPER=0,$P(^DVB(396,DA,1),U,12)'="" S FDATE=$P(^(1),U,12) W !!,*7,"This record has already been finalized on ",$$FMTE^XLFDT(FDATE,"5DZ"),! H 3 G SETUP
"RTN","DVBAEDIT",36,0)
 G EDIT1
"RTN","DVBAEDIT",37,0)
 ;
"RTN","DVBAEDIT",38,0)
CHK1 ;CHECK STATUS OF EACH FIELD
"RTN","DVBAEDIT",39,0)
 S NOFINAL=0
"RTN","DVBAEDIT",40,0)
 F ZA=9,11,13,15,17,19,21,23,26,28 I $P(^DVB(396,DA,0),U,ZA)="P" S NOFINAL=1 Q
"RTN","DVBAEDIT",41,0)
 Q:NOFINAL=1  I $P(^DVB(396,DA,1),U,7)="P" S NOFINAL=1 Q
"RTN","DVBAEDIT",42,0)
 Q
"RTN","DVBAEDIT",43,0)
CON ;continue
"RTN","DVBAEDIT",44,0)
 W !!,"Press RETURN to continue or ""^"" to exit  " R ANS:DTIME S:'$T!(ANS=U) OUT=1
"RTN","DVBAEDIT",45,0)
 Q
"RTN","DVBAPEND")
0^8^B12088109
"RTN","DVBAPEND",1,0)
DVBAPEND ;ALB/GTS-557/THM-PENDING REPORT ; 7/6/90  1:18 PM
"RTN","DVBAPEND",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAPEND",3,0)
 ;
"RTN","DVBAPEND",4,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAPEND",5,0)
TERM D HOME^%ZIS W @IOF,!,"Pending 7131 Report",!!! K NOASK,^TMP($J)
"RTN","DVBAPEND",6,0)
 S DVBADD=^DD("DD"),(RONUM,Y)=0 D SORT^DVBAUTIL G:Y<0 KILL
"RTN","DVBAPEND",7,0)
 D SORTDIV^DVBAPND1 G:Y<0 KILL S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL
"RTN","DVBAPEND",8,0)
 ;
"RTN","DVBAPEND",9,0)
QUEUE I $D(IO("Q")) S ZTRTN="SETUP^DVBAPEND",ZTIO=ION,ZTDESC="AMIE PENDING REPORT",NOASK=1 F I="DIVNAM","SELDIV","DVBADD","RONUM","RO","NOASK","Y","DIVNUM" S ZTSAVE(I)=""
"RTN","DVBAPEND",10,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! H 1 G KILL
"RTN","DVBAPEND",11,0)
 ;
"RTN","DVBAPEND",12,0)
SETUP D STM^DVBCUTL4
"RTN","DVBAPEND",13,0)
 S FDT(0)=$$FMTE^XLFDT(DT,"5DZ"),(PG,DVBAQUIT)=0
"RTN","DVBAPEND",14,0)
 S HEAD="PENDING REQUEST REPORT FOR "_$P(^DVB(396.1,1,0),U,1)
"RTN","DVBAPEND",15,0)
 S HEAD2=$S(RO="Y":"FOR REGIONAL OFFICE "_RONUM,1:"ALL REGIONAL OFFICES")
"RTN","DVBAPEND",16,0)
 S HEAD2=HEAD2_$S(SELDIV="Y":", FOR DIVISION "_DIVNAM,1:", ALL DIVISIONS")
"RTN","DVBAPEND",17,0)
 S PROCDT="Processed on: "_FDT(0)
"RTN","DVBAPEND",18,0)
 S QQ=1,NODTA=0 U IO D HEADER^DVBAPND1
"RTN","DVBAPEND",19,0)
DATA N REQDTE S REQDTE=""
"RTN","DVBAPEND",20,0)
 S:SELDIV="Y" ADIV=DIVNAM
"RTN","DVBAPEND",21,0)
 F J=0:0 S REQDTE=$O(^DVB(396,"E",REQDTE)) Q:REQDTE=""  F DA=0:0 S DA=$O(^DVB(396,"E",REQDTE,DA)) Q:DA=""  I $D(^DVB(396,DA,1)),($P(^DVB(396,DA,1),U,12)="")  D:SELDIV="N" ADIV D MAKUTL
"RTN","DVBAPEND",22,0)
 S (ADIV,REQDTE)=""
"RTN","DVBAPEND",23,0)
 F L=0:0 S REQDTE=$O(^TMP($J,REQDTE)) Q:REQDTE=""  D LVL2LP
"RTN","DVBAPEND",24,0)
 ;
"RTN","DVBAPEND",25,0)
EXIT I NODTA=0 U IO W *7,"No pending requests found for parameters entered.",!!
"RTN","DVBAPEND",26,0)
 ;
"RTN","DVBAPEND",27,0)
KILL S XRTN=$T(+0)
"RTN","DVBAPEND",28,0)
 D SPM^DVBCUTL4
"RTN","DVBAPEND",29,0)
 K ^TMP("DVBA","ADMIT",$J),^TMP($J),DVBAQUIT,SELDIV,DIVNUM,REQDTE
"RTN","DVBAPEND",30,0)
 K LPCNT1,PATDA,DIVNAM,XJ,XI,GDIVPTR,GDIVNUM,GINSTPT,GDIVNAM,GDIV
"RTN","DVBAPEND",31,0)
 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBAUTIL
"RTN","DVBAPEND",32,0)
 Q
"RTN","DVBAPEND",33,0)
 ;
"RTN","DVBAPEND",34,0)
LVL2LP  ;  ** 2nd level of the 2nd loop in the DATA tag - search ADIV **
"RTN","DVBAPEND",35,0)
 F J=0:0 S ADIV=$O(^TMP($J,REQDTE,ADIV)) Q:ADIV=""  D LPLVL3
"RTN","DVBAPEND",36,0)
 Q
"RTN","DVBAPEND",37,0)
 ;
"RTN","DVBAPEND",38,0)
LPLVL3 ;  **  2nd level of the loop in the LVL2LP tag - search DA **
"RTN","DVBAPEND",39,0)
 F DA=0:0 S DA=$O(^TMP($J,REQDTE,ADIV,DA)) Q:DA=""  D PRINT^DVBAPND1 S:DVBAQUIT=1 ADIV="ZZZZ",DA=999999999,REQDTE=9999999 S QQ=1
"RTN","DVBAPEND",40,0)
 Q
"RTN","DVBAPEND",41,0)
 ;
"RTN","DVBAPEND",42,0)
MAKUTL ;  **  Sort on Request Date to set up a temporary utility global  **
"RTN","DVBAPEND",43,0)
 S REQDTE=$P(^DVB(396,DA,1),"^",1),PATDA=$P(^DVB(396,DA,0),"^",1)
"RTN","DVBAPEND",44,0)
 S CFLOC=$$STATION^DVBAUTL1(PATDA)
"RTN","DVBAPEND",45,0)
 S:CFLOC=-1 CFLOC=0
"RTN","DVBAPEND",46,0)
 I SELDIV="Y"&(RO="Y") I CFLOC=RONUM D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAPEND",47,0)
 I SELDIV="Y"&(RO="N") D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAPEND",48,0)
 I SELDIV="N"&(RO="Y") I CFLOC=RONUM D SETARY
"RTN","DVBAPEND",49,0)
 I SELDIV="N"&(RO="N") D SETARY
"RTN","DVBAPEND",50,0)
 K DVBAFND
"RTN","DVBAPEND",51,0)
 QUIT
"RTN","DVBAPEND",52,0)
 ;
"RTN","DVBAPEND",53,0)
SETARY ;  ** Set temporary utility global **
"RTN","DVBAPEND",54,0)
 S ^TMP($J,REQDTE,ADIV,DA)=""
"RTN","DVBAPEND",55,0)
 QUIT
"RTN","DVBAPEND",56,0)
 ;
"RTN","DVBAPEND",57,0)
ADIV S ADIV=$S($D(^DVB(396,DA,2)):$P(^(2),U,9),1:"") S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAPEND",58,0)
 Q
"RTN","DVBAPEND",59,0)
 ;
"RTN","DVBAPEND",60,0)
CHKDIV ;**Check for selected Div
"RTN","DVBAPEND",61,0)
 N FLDVAR
"RTN","DVBAPEND",62,0)
 I $D(^DVB(396,DA,6)) DO
"RTN","DVBAPEND",63,0)
 .F FLDVAR=7,9,11,13,15,17,19,21,23,26,28 Q:$D(DVBAFND)  DO
"RTN","DVBAPEND",64,0)
 ..I ($P(^DVB(396,DA,6),U,FLDVAR)=DIVNUM) DO
"RTN","DVBAPEND",65,0)
 ...I FLDVAR=7 S:$P(^DVB(396,DA,1),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAPEND",66,0)
 ...I FLDVAR'=7 S:$P(^DVB(396,DA,0),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAPEND",67,0)
 I $D(^DVB(396,DA,2)),('$D(DVBAFND)) DO  ;**Check Routing Loc Division
"RTN","DVBAPEND",68,0)
 .I $D(^DVB(396,DA,1)) DO
"RTN","DVBAPEND",69,0)
 ..I $P(^DVB(396,DA,2),U,9)=DIVNUM,($P(^DVB(396,DA,1),U,12)="") DO
"RTN","DVBAPEND",70,0)
 ...S DVBAFND=""
"RTN","DVBAPEND",71,0)
 Q
"RTN","DVBAPND1")
0^27^B16396677
"RTN","DVBAPND1",1,0)
DVBAPND1 ;ALB ISC/GTS-AMIE PENDING RPT UT ;13 JAN 93@08:10 ; 7/2/90  2:48 PM
"RTN","DVBAPND1",2,0)
 ;;2.7;AMIE;**14,17**;Apr 10, 1995
"RTN","DVBAPND1",3,0)
 ;
"RTN","DVBAPND1",4,0)
 ;  ** The following routines are called from DVBAPEND **
"RTN","DVBAPND1",5,0)
SORTDIV W !!,"Sort by Division" S %=1 D YN^DICN
"RTN","DVBAPND1",6,0)
 I $D(DTOUT)!(%<0) K DTOUT S Y=-1 Q
"RTN","DVBAPND1",7,0)
 I $D(%Y),(%Y["?") W !!,*7,"Enter Y to sort by the Division you"
"RTN","DVBAPND1",8,0)
 I $D(%Y),(%Y["?") W !,"select or enter N to report ALL Divisions."
"RTN","DVBAPND1",9,0)
 I $D(%Y),(%Y["?") G SORTDIV
"RTN","DVBAPND1",10,0)
 I %'=1 S SELDIV="N",DIVNUM=0 Q
"RTN","DVBAPND1",11,0)
 I %=1 S SELDIV="Y" G ENTDIV
"RTN","DVBAPND1",12,0)
 W !,*7,"Invalid response.",!! G SORTDIV
"RTN","DVBAPND1",13,0)
 ;  ** Allow user to enter a selected Division to report **
"RTN","DVBAPND1",14,0)
ENTDIV S DIC="^DG(40.8,",DIC(0)="AEMQ",DIC("A")="Division number: "
"RTN","DVBAPND1",15,0)
 D ^DIC K DIC S DIVNUM=+Y
"RTN","DVBAPND1",16,0)
 S DIVNAM=$S($D(^DG(40.8,+Y,0)):$P(^(0),"^",1),1:"Unknown Division")
"RTN","DVBAPND1",17,0)
 Q
"RTN","DVBAPND1",18,0)
 ;
"RTN","DVBAPND1",19,0)
DCHGDT S DCHGDT="",DCHPTR=$P(^DGPM(XJ,0),U,17),XADMDT=$P(^(0),U,1) I DCHPTR]"",$D(^DGPM(+DCHPTR,0)) S DCHGDT=$P(^DGPM(+DCHPTR,0),U,1)
"RTN","DVBAPND1",20,0)
 K DCHPTR
"RTN","DVBAPND1",21,0)
 Q
"RTN","DVBAPND1",22,0)
 ;
"RTN","DVBAPND1",23,0)
PRINT S DOCTYPE=$S($D(^DVB(396,DA,2)):$P(^(2),U,10),1:""),DFN=$P(^DVB(396,DA,0),U,1),ADMDT=$P(^(0),U,4),RDATE=$P(^(1),U,1),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"UNKNOWN")
"RTN","DVBAPND1",24,0)
 I RO="Y" S CFLOC=$$STATION^DVBAUTL1(DFN),CFLOC=$S(CFLOC>0:CFLOC,1:9999) Q:CFLOC'=RONUM&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAPND1",25,0)
 K ^TMP("DVBA","ADMIT",$J)
"RTN","DVBAPND1",26,0)
 F XI=0:0 S XI=$O(^DGPM("APTT1",DFN,XI)) Q:XI=""  F XJ=0:0 S XJ=$O(^DGPM("APTT1",DFN,XI,XJ)) Q:XJ=""  D DCHGDT S ^TMP("DVBA","ADMIT",$J,XADMDT,DFN)=XI_U_DCHGDT
"RTN","DVBAPND1",27,0)
 W:SELDIV="Y" !,?10,"Division: "_ADIV,!
"RTN","DVBAPND1",28,0)
 W:SELDIV="N" !,?10,"Original Division: "_ADIV,!
"RTN","DVBAPND1",29,0)
 W !,PNAM,?49,"SSN: ",SSN,!,?44,"Claim no: ",CNUM,!,?38,$S(DOCTYPE="L":" Activity date: ",1:"Admission date: "),$$FMTE^XLFDT(ADMDT,"5DZ"),!,?40,"Request date: ",$$FMTE^XLFDT(RDATE,"5DZ")
"RTN","DVBAPND1",30,0)
 S DCHGDT=""
"RTN","DVBAPND1",31,0)
 I $D(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN)) S:DOCTYPE="A" DCHGDT=$P(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN),U,2)
"RTN","DVBAPND1",32,0)
 D ELAPSED
"RTN","DVBAPND1",33,0)
 W ! I DCHGDT]"" S Y=DCHGDT X DVBADD W "** Discharged: ",Y
"RTN","DVBAPND1",34,0)
 W ?40,"Elapsed days: ",EDAYS,!!,?3,"Items Pending:"
"RTN","DVBAPND1",35,0)
ITEMS F Q=9,11,13,15,17,19,21,23,26,28 I $P(^DVB(396,DA,0),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAPND1",36,0)
 S Q=7 I $P(^DVB(396,DA,1),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAPND1",37,0)
 W !! W:$D(^DVB(396,DA,2)) "Requested by: ",$S($P(^DVB(396,DA,2),U,8)]"":$P(^(2),U,8),1:" (Not specified) ")," AT ",$S($P(^(2),U,7)]"":$P(^(2),U,7),1:" (Not specified) "),! F L=1:1:79 W "-"
"RTN","DVBAPND1",38,0)
 W !
"RTN","DVBAPND1",39,0)
 D TOP Q:DVBAQUIT=1
"RTN","DVBAPND1",40,0)
 Q
"RTN","DVBAPND1",41,0)
 ;
"RTN","DVBAPND1",42,0)
PRINT1 S:$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,6),"^",Q)
"RTN","DVBAPND1",43,0)
 S:'$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,2),"^",9)
"RTN","DVBAPND1",44,0)
 S:+GDIVPTR>0 GDIVNAM=$P(^DG(40.8,GDIVPTR,0),"^",1)
"RTN","DVBAPND1",45,0)
 S:+GDIVPTR'>0 GDIVNAM=""
"RTN","DVBAPND1",46,0)
 S NODTA=1 I QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" W !,?8,MD,GDIV S QQ='QQ Q
"RTN","DVBAPND1",47,0)
 I 'QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" W ?46,MD,GDIV S QQ='QQ I $Y>22 D TOP Q:DVBAQUIT=1
"RTN","DVBAPND1",48,0)
 Q
"RTN","DVBAPND1",49,0)
 ;
"RTN","DVBAPND1",50,0)
TOP I IOST?1"C-".E,'$D(NOASK) W !!,*7,"Press RETURN to continue or ""^"" to exit   " R ANS:DTIME W @IOF I ANS=U!('$T) S DVBAQUIT=1 Q
"RTN","DVBAPND1",51,0)
 I $Y'<53 D HEADER
"RTN","DVBAPND1",52,0)
 Q
"RTN","DVBAPND1",53,0)
 ;
"RTN","DVBAPND1",54,0)
ELAPSED K EDAYS,X1,X S X1=DT,X=RDATE D ^XUWORKDY
"RTN","DVBAPND1",55,0)
 S EDAYS=X
"RTN","DVBAPND1",56,0)
 Q
"RTN","DVBAPND1",57,0)
 ;
"RTN","DVBAPND1",58,0)
HEADER S PG=PG+1 W:(IOST?1"C-".E)!(PG>1) @IOF,!
"RTN","DVBAPND1",59,0)
 W ?(80-$L(HEAD)\2),HEAD,?71,"Page: ",PG,! I HEAD2]"" W ?(80-$L(HEAD2)\2),HEAD2,!
"RTN","DVBAPND1",60,0)
 W ?(80-$L(PROCDT)\2),PROCDT,!!
"RTN","DVBAPND1",61,0)
 Q
"RTN","DVBAPND1",62,0)
FIELDS ;
"RTN","DVBAPND1",63,0)
7 ;;ADMISSION RPT
"RTN","DVBAPND1",64,0)
9 ;;NOTICE OF DISCHARGE
"RTN","DVBAPND1",65,0)
11 ;;HOSPITAL SUMMARY
"RTN","DVBAPND1",66,0)
13 ;;21-DAY CERTIFICATE
"RTN","DVBAPND1",67,0)
15 ;;OTHER/EXAM REVIEW RMKS
"RTN","DVBAPND1",68,0)
17 ;;SPECIAL REPORT
"RTN","DVBAPND1",69,0)
19 ;;COMPETENCY REPORT
"RTN","DVBAPND1",70,0)
21 ;;VA FORM 21-2680
"RTN","DVBAPND1",71,0)
23 ;;ASSET INFORMATION
"RTN","DVBAPND1",72,0)
26 ;;OPT TREATMENT REPORT
"RTN","DVBAPND1",73,0)
28 ;;BEGINNING DATE/CARE
"RTN","DVBAPND1",74,0)
 Q
"RTN","DVBARAD1")
0^10^B12771304
"RTN","DVBARAD1",1,0)
DVBARAD1 ;RE-ADMISSION REPORT, PRINT DRIVER ; 1/23/91  7:37 AM
"RTN","DVBARAD1",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBARAD1",3,0)
 ;
"RTN","DVBARAD1",4,0)
 S ZX="PENSION   ",ZY="A & A     "
"RTN","DVBARAD1",5,0)
 S MSG="" F ZZ=1:1:7 S MSG=MSG_ZX
"RTN","DVBARAD1",6,0)
 S MSG1="" F ZZ=1:1:7 S MSG1=MSG1_ZY
"RTN","DVBARAD1",7,0)
 U IO K DVBAQUIT
"RTN","DVBARAD1",8,0)
 F DVBAT="PEN","A&A" W:((IOST?1"C-".E)!(IOST'?1"P-OTHER".E)) @IOF W !!!!!!!!!! D PRINT Q:$D(DVBAQUIT)
"RTN","DVBARAD1",9,0)
 G KILL
"RTN","DVBARAD1",10,0)
 ;
"RTN","DVBARAD1",11,0)
PRINTB S DATA1=$S($D(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K,DA,"LADM")):^("LADM"),1:"") S (LADMDT,ADMDT)=$P(DATA1,U),LTDIS=$P(DATA1,U,2),DFN=DA,QUIT1=1 K DATA1 D ADM^DVBAVDPT K QUIT1,DVBAQ
"RTN","DVBARAD1",12,0)
 S LBEDSEC=BEDSEC,LDIAG=DIAG,LDCHGDT=DCHGDT,ADMDT=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5) D ADM^DVBAVDPT
"RTN","DVBARAD1",13,0)
 S RCVPEN=$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),RCVAA=$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified")
"RTN","DVBARAD1",14,0)
 W @IOF,!!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!,?(80-$L(HEADDT)\2),HEADDT,!!!
"RTN","DVBARAD1",15,0)
 S:ADMDT]"" ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBARAD1",16,0)
 S:DCHGDT]"" DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBARAD1",17,0)
 S:LADMDT]"" LADMDT=$$FMTE^XLFDT(LADMDT,"5DZ")
"RTN","DVBARAD1",18,0)
 S:LDCHGDT]"" LDCHGDT=$$FMTE^XLFDT(LDCHGDT,"5DZ")
"RTN","DVBARAD1",19,0)
 W "Patient: ",PNAM,?60,"SSN: ",SSN,!,"Claim #: ",CNUM,?56,"Pension: ",RCVPEN,!,"Claim Folder Loc: ",CFLOC,?60,"A&A: ",RCVAA,! D ELIG F LINE=1:1:80 W "="
"RTN","DVBARAD1",20,0)
 W !?26,"------- Admission data -------",!!?18,"Current",?57,"Prior",!,?18,"-------",?57,"-----",!
"RTN","DVBARAD1",21,0)
 W ?(25-$L(ADMDT)),ADMDT,?26,"------ Admission date -------  ",LADMDT,!
"RTN","DVBARAD1",22,0)
 W ?(25-$L(DIAG)),$E(DIAG,1,26),?26,"---- Admitting diagnosis ----  ",$E(LDIAG,1,23),!
"RTN","DVBARAD1",23,0)
 W ?(25-$L(DCHGDT)),DCHGDT,?26,"------- Discharge date ------- ",LDCHGDT,!
"RTN","DVBARAD1",24,0)
 W ?(25-$L(TDIS)),$E(TDIS,1,26),?26,"------- Discharge type ------- ",$E(LTDIS,1,23),!
"RTN","DVBARAD1",25,0)
 W ?(25-$L(BEDSEC)),BEDSEC,?26,"-------- Bed Service --------- ",LBEDSEC,!
"RTN","DVBARAD1",26,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) XCN="ZZZZ" I '$T S DVBAQUIT=1
"RTN","DVBARAD1",27,0)
 Q
"RTN","DVBARAD1",28,0)
 ;
"RTN","DVBARAD1",29,0)
PRINT S NODTA=1 S (XCN,XCFLOC,ANS)=""
"RTN","DVBARAD1",30,0)
 I $D(^TMP("DVBA",DVBAT,$J)) F XLINE=1:1:5 W ?5,$S(DVBAT="PEN":MSG,DVBAT="A&A":MSG1,1:""),!!
"RTN","DVBARAD1",31,0)
 F DVBAM=0:0 S XCN=$O(^TMP("DVBA",DVBAT,$J,XCN)) Q:XCN=""  F J=0:0 S XCFLOC=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC)) Q:XCFLOC=""  F K=0:0 S K=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K)) Q:K=""  D PRINTC
"RTN","DVBARAD1",32,0)
 Q
"RTN","DVBARAD1",33,0)
 ;
"RTN","DVBARAD1",34,0)
PRINTC F DA=0:0 S DA=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K,DA)) Q:DA=""  S DATA=^(DA) D PRINTB
"RTN","DVBARAD1",35,0)
 Q
"RTN","DVBARAD1",36,0)
 ;
"RTN","DVBARAD1",37,0)
KILL K ^TMP("DVBA","A&A",$J),^TMP("DVBA","PEN",$J)
"RTN","DVBARAD1",38,0)
 D ^%ZISC S X=7 D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBARAD1",39,0)
 ;
"RTN","DVBARAD1",40,0)
ELIG S ELIG=DVBAELIG,INCMP=0
"RTN","DVBARAD1",41,0)
 W "Eligibility: "
"RTN","DVBARAD1",42,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBARAD1",43,0)
 I $D(^DPT(DA,.29)),$P(^(.29),U,1)]"" S INCMP=1 ;date ruled incomp, VA
"RTN","DVBARAD1",44,0)
 I $D(^DPT(DA,.29)),$P(^(.29),U,12)=1 S INCMP=1 ;ruled incomp field
"RTN","DVBARAD1",45,0)
 W ELIG_$S(ELIG]"":", ",1:"") W:$X>60 !?14 W $S(INCMP=1:"Incompetent",1:""),!
"RTN","DVBARADM")
0^9^B24055607
"RTN","DVBARADM",1,0)
DVBARADM ;ALB/GTS-557/THM-READMISSION REPORT ; 1/23/91  8:01 AM
"RTN","DVBARADM",2,0)
 ;;2.7;AMIE;**1,17**;Apr 10, 1995
"RTN","DVBARADM",3,0)
 ;
"RTN","DVBARADM",4,0)
 G TERM
"RTN","DVBARADM",5,0)
SORT D RCV^DVBAVDPT I $D(RONUM),$D(RO) Q:CFLOC'=RONUM&(RO="Y")
"RTN","DVBARADM",6,0)
 I RCVAA S ^TMP("DVBA",$J,"A&A",DFN)=""
"RTN","DVBARADM",7,0)
 I RCVPEN S ^TMP("DVBA",$J,"PEN",DFN)=""
"RTN","DVBARADM",8,0)
 Q
"RTN","DVBARADM",9,0)
 ;
"RTN","DVBARADM",10,0)
DCHGDT S (LADMDT,LDCHGDT)="",DCHPTR=$P(^DGPM(VY,0),U,17),LADMDT=$P(^(0),U,1) I DCHPTR]"",$D(^DGPM(+DCHPTR,0)) S LDCHGDT=$P(^DGPM(+DCHPTR,0),U,1)
"RTN","DVBARADM",11,0)
 Q
"RTN","DVBARADM",12,0)
 ;
"RTN","DVBARADM",13,0)
CAL S I="",ZI=1 F DVBAI=0:0 S I=$O(^DGPM("APID",DFN,I)) Q:I=""  F J=0:0 S J=$O(^DGPM("APID",DFN,I,J)) Q:J=""  S ZJ=$S($D(^DGPM(J,0)):^(0),1:"") I $P(ZJ,U,1)'>EDATE,$P(ZJ,U,2)=1 S ^TMP("DVBA",$J,"ADM",DFN,ZI,J)="",ZI=ZI+1
"RTN","DVBARADM",14,0)
 S VX=$O(^TMP("DVBA",$J,"ADM",DFN,1,0)) Q:VX=""  S CURADMDT=$P(^DGPM(VX,0),U,1) Q:CURADMDT=""
"RTN","DVBARADM",15,0)
 F VX=1:1 S VX=$O(^TMP("DVBA",$J,"ADM",DFN,VX)) Q:VX=""  F VY=0:0 S VY=$O(^TMP("DVBA",$J,"ADM",DFN,VX,VY)) Q:VY=""  D DCHGDT I CURADMDT["."&(LADMDT[".") D SET
"RTN","DVBARADM",16,0)
 Q
"RTN","DVBARADM",17,0)
TDIS S TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") Q:TDIS=""
"RTN","DVBARADM",18,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBARADM",19,0)
 Q
"RTN","DVBARADM",20,0)
 ;
"RTN","DVBARADM",21,0)
SET S X1=CURADMDT,X2=LDCHGDT D ^%DTC Q:X>185
"RTN","DVBARADM",22,0)
 S X2=LADMDT,X1=LDCHGDT D ^%DTC S LOS=X Q:LOS'>HOSPDAYS
"RTN","DVBARADM",23,0)
 I DVBAT="A&A" DO  ;**Check last admission for A&A vet
"RTN","DVBARADM",24,0)
 .S ADMDT=LADMDT
"RTN","DVBARADM",25,0)
 .D ADM^DVBAVDPT,TDIS
"RTN","DVBARADM",26,0)
 .I TDIS["IRREGULAR" DO  ;**Irregular discharge, set last admis info
"RTN","DVBARADM",27,0)
 ..S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN,"LADM")=LADMDT_U_TDIS
"RTN","DVBARADM",28,0)
 I $D(TDIS),(TDIS'["IRREGULAR"&(DVBAT="A&A")) Q  ;**Quit
"RTN","DVBARADM",29,0)
 S ADMDT=CURADMDT
"RTN","DVBARADM",30,0)
 D ADM^DVBAVDPT,TDIS
"RTN","DVBARADM",31,0)
 ;**Set current admis info
"RTN","DVBARADM",32,0)
 S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN)=CURADMDT_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBARADM",33,0)
 I DVBAT="PEN" DO  ;**Set last admis info for Pension vet 
"RTN","DVBARADM",34,0)
 .S ADMDT=LADMDT
"RTN","DVBARADM",35,0)
 .D ADM^DVBAVDPT,TDIS
"RTN","DVBARADM",36,0)
 .S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN,"LADM")=LADMDT_U_TDIS
"RTN","DVBARADM",37,0)
 K DVBARADQ
"RTN","DVBARADM",38,0)
 S (VX,VY)=9999999
"RTN","DVBARADM",39,0)
 Q
"RTN","DVBARADM",40,0)
 ;
"RTN","DVBARADM",41,0)
TERM D HOME^%ZIS K ^TMP("DVBA",$J),^TMP("DVBA","PEN",$J),^TMP("DVBA","A&A",$J),NOASK
"RTN","DVBARADM",42,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBARADM",43,0)
 ;
"RTN","DVBARADM",44,0)
SETUP W @IOF,!,"VARO RE-ADMISSION REPORT" S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBARADM",45,0)
 S HEAD="RE-ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBARADM",46,0)
 W !,HEAD1
"RTN","DVBARADM",47,0)
EN1 W !!,"Please enter admission dates for search, oldest date first,",!,"most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,7) X ^DD("DD") W Y,!!
"RTN","DVBARADM",48,0)
 D DATE^DVBAUTIL G:Y<0 KILL^DVBAUTIL
"RTN","DVBARADM",49,0)
 S BDATE1=BDATE+.5,HEADDT="Date range: "_$$FMTE^XLFDT(BDATE1,"5DZ")_" to "_$$FMTE^XLFDT(EDATE,"5DZ")
"RTN","DVBARADM",50,0)
 ;
"RTN","DVBARADM",51,0)
ASK W !!,"Do you want (H)ospital or Hospital-(D)om   H// " R DVBAH:DTIME G:'$T!(DVBAH=U) KILL^DVBAUTIL
"RTN","DVBARADM",52,0)
 I DVBAH="" S DVBAH="H" W DVBAH
"RTN","DVBARADM",53,0)
 S:DVBAH="d" DVBAH="D"
"RTN","DVBARADM",54,0)
 S:DVBAH="h" DVBAH="H"
"RTN","DVBARADM",55,0)
 I DVBAH'?1"H"&(DVBAH'?1"D") W *7,!!,"Must be H for HOSPITAL or D for HOSPITAL-DOM",!! H 3 G ASK
"RTN","DVBARADM",56,0)
 S HEAD=HEAD_" ("_$S(DVBAH="H":"Hospital",DVBAH="D":"Hospital-Dom",1:"Unknown selection")_")"
"RTN","DVBARADM",57,0)
 S Z=$S(DVBAH="D":1,DVBAH="H":2,1:0) W $P("om^ospital",U,Z),!!
"RTN","DVBARADM",58,0)
 S %ZIS("B")="0;P-OTHER",%ZIS("A")="Printing device: ",%ZIS="AEQ" D ^%ZIS G:POP KILL^DVBAUTIL
"RTN","DVBARADM",59,0)
 I $D(IO("Q")) F I="NOASK","HEAD*","FDT(0)","DTAR","BDATE*","EDATE*","DVBAH" S ZTSAVE(I)=""
"RTN","DVBARADM",60,0)
 I  S NOASK=1,ZTRTN="DQ^DVBARADM",ZTDESC="AMIE Re-admission Report",ZTIO=ION D ^%ZTLOAD W:$D(ZTSK) !,"Request queued.",!! G KILL^DVBAUTIL
"RTN","DVBARADM",61,0)
GO I '$D(NOASK) W !!,"Looking for Pension and A&A cases ...",!!
"RTN","DVBARADM",62,0)
 F DVBADT=BDATE:0 S DVBADT=$O(^DGPM("AMV1",DVBADT)) Q:DVBADT=""!(DVBADT>EDATE)  W:'$D(NOASK) "." F DFN=0:0 S DFN=$O(^DGPM("AMV1",DVBADT,DFN)) Q:DFN=""  F ADM=0:0 S ADM=$O(^DGPM("AMV1",DVBADT,DFN,ADM)) Q:ADM=""  D SORT
"RTN","DVBARADM",63,0)
 I '$D(NOASK) W !!,"Examining cases found for re-admissions within 185 days ...",!!
"RTN","DVBARADM",64,0)
 F DVBAT="PEN","A&A" S HOSPDAYS=$S(DVBAT="PEN"&(DVBAH="H"):89,DVBAT="PEN"&(DVBAH="D"):59,1:29) F DFN=0:0 S DFN=$O(^TMP("DVBA",$J,DVBAT,DFN)) Q:DFN=""  D CAL W:'$D(NOASK) "+"
"RTN","DVBARADM",65,0)
 K ^TMP("DVBA",$J,"PEN"),^TMP("DVBA",$J,"A&A")
"RTN","DVBARADM",66,0)
 I '$D(^TMP("DVBA","PEN",$J))&('$D(^TMP("DVBA","A&A",$J))) W *7,!!,"No data found for parameters entered.",!! H 2 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBAUTIL
"RTN","DVBARADM",67,0)
 G ^DVBARAD1
"RTN","DVBARADM",68,0)
 ;
"RTN","DVBARADM",69,0)
DQ K ^TMP("DVBA",$J),^TMP("DVBA","PEN",$J),^TMP("DVBA","A&A",$J)
"RTN","DVBARADM",70,0)
 G GO
"RTN","DVBAREG2")
0^26^B31963943
"RTN","DVBAREG2",1,0)
DVBAREG2 ;ALB/JLU;second half of the 7131 input;9/20/94
"RTN","DVBAREG2",2,0)
 ;;2.7;AMIE;**3,5,14,17**;Apr 10, 1995
"RTN","DVBAREG2",3,0)
 ;
"RTN","DVBAREG2",4,0)
CONT ;asks selection from list
"RTN","DVBAREG2",5,0)
 S DIR(0)="NAO^1:"_X1_":0"
"RTN","DVBAREG2",6,0)
 S DIR("A")="Select 1-"_X1_"   or '^' to Exit or Return to continue "
"RTN","DVBAREG2",7,0)
 D ^DIR
"RTN","DVBAREG2",8,0)
 K DIR
"RTN","DVBAREG2",9,0)
 I $D(DTOUT)!$D(DUOUT) S DVBASTOP=1 Q
"RTN","DVBAREG2",10,0)
 I Y]"" S DVBANS=Y
"RTN","DVBAREG2",11,0)
 E  K DVBANS
"RTN","DVBAREG2",12,0)
 Q
"RTN","DVBAREG2",13,0)
 ;
"RTN","DVBAREG2",14,0)
SINGLE ;when select single entry point
"RTN","DVBAREG2",15,0)
 S XTYPE=""
"RTN","DVBAREG2",16,0)
 S X1=$O(^TMP("DVBA",$J,0))
"RTN","DVBAREG2",17,0)
 I X1="" S DVBASTOP=1 Q
"RTN","DVBAREG2",18,0)
 S XTYPE=$O(^TMP("DVBA",$J,X1,XTYPE))
"RTN","DVBAREG2",19,0)
 I XTYPE="" S DVBASTOP=1 Q
"RTN","DVBAREG2",20,0)
 S DIR("A",1)=""
"RTN","DVBAREG2",21,0)
 S DIR("A",2)=$P(^TMP("DVBA",$J,X1,XTYPE),U)
"RTN","DVBAREG2",22,0)
 S DIR("A")="Is this the correct information? "
"RTN","DVBAREG2",23,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",24,0)
 S DIR(0)="YA"
"RTN","DVBAREG2",25,0)
 D ^DIR
"RTN","DVBAREG2",26,0)
 K DIR
"RTN","DVBAREG2",27,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBASTOP=1 Q
"RTN","DVBAREG2",28,0)
 I Y S DVBANS=X1,DVBTYPE=XTYPE
"RTN","DVBAREG2",29,0)
 E  K DVBANS
"RTN","DVBAREG2",30,0)
 Q
"RTN","DVBAREG2",31,0)
 ;
"RTN","DVBAREG2",32,0)
DTRNG(DFN) ;gets date range from user
"RTN","DVBAREG2",33,0)
 S DIR("A",1)="Display Admission or Activity information"
"RTN","DVBAREG2",34,0)
 S DIR("A")="for "_$P(DFN,U,2)_"  by"
"RTN","DVBAREG2",35,0)
 S DIR("?")="Date Range will allow the user to select the specific dates."
"RTN","DVBAREG2",36,0)
 S DIR("?",1)="All Dates will show the user all possible information."
"RTN","DVBAREG2",37,0)
 S DIR(0)="SM^D:Date Range;A:All Dates"
"RTN","DVBAREG2",38,0)
 D ^DIR
"RTN","DVBAREG2",39,0)
 K DIR
"RTN","DVBAREG2",40,0)
 I $D(DTOUT)!($D(DUOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",41,0)
 I X="" S DVBASTOP=1 Q
"RTN","DVBAREG2",42,0)
 S DVBBDT=0,DVBEDT=0
"RTN","DVBAREG2",43,0)
 S VAR(1,0)="0,0,0,1,0^"
"RTN","DVBAREG2",44,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",45,0)
 K VAR
"RTN","DVBAREG2",46,0)
 I Y="D" DO
"RTN","DVBAREG2",47,0)
 .D DATE^DVBCUTL4(.DVBBDT,.DVBEDT)
"RTN","DVBAREG2",48,0)
 .S Y="D"
"RTN","DVBAREG2",49,0)
 .I DVBBDT>0,'+$P(DVBBDT,".",2) S DVBBDT=DVBBDT-.0000001
"RTN","DVBAREG2",50,0)
 .I DVBEDT>0,'+$P(DVBEDT,".",2) S DVBEDT=DVBEDT+.9999999
"RTN","DVBAREG2",51,0)
 .I DVBBDT=0,DVBEDT=0 S DVBAQUIT=1
"RTN","DVBAREG2",52,0)
 .I DVBBDT=-1,DVBEDT=-1 S DVBASTOP=1
"RTN","DVBAREG2",53,0)
 .Q
"RTN","DVBAREG2",54,0)
 Q
"RTN","DVBAREG2",55,0)
 ;
"RTN","DVBAREG2",56,0)
CLEAN ;cleans up variables
"RTN","DVBAREG2",57,0)
 K DA,ADM,ADMDT,ADMNUM,DFN,DIC,A,DR,PNAM,SSN,TRN,Z,DINUM,DTAR,C,J,K,L,C,D,DIE,ONFILE,%,OLDDA,%Y,DIK,ZI,X,Y,AROWOUT,DVBAEDT,DVBAENTR,DVBASTOP,DVBREQDT,DVBANS,DVBTYPE
"RTN","DVBAREG2",58,0)
 K ^TMP("DVBA",$J),^UTILITY("DIQ1",$J)
"RTN","DVBAREG2",59,0)
 Q
"RTN","DVBAREG2",60,0)
 ;
"RTN","DVBAREG2",61,0)
PAGE ;pages/dispays end of page/screen
"RTN","DVBAREG2",62,0)
 S VAR(1,0)="0,0,0,0,1^"
"RTN","DVBAREG2",63,0)
 S VAR(2,0)="0,0,"_(IOM-$L(HD)\2)_":0,0,0^"_HD
"RTN","DVBAREG2",64,0)
 S VAR(3,0)="0,0,"_(IOM-$L(HNAME)\2)_":0,1:2,0^"_HNAME
"RTN","DVBAREG2",65,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",66,0)
 K VAR
"RTN","DVBAREG2",67,0)
 Q
"RTN","DVBAREG2",68,0)
 ;
"RTN","DVBAREG2",69,0)
SELECT ;checks doc type, request status and calls deletion, if necessary
"RTN","DVBAREG2",70,0)
 N ZI
"RTN","DVBAREG2",71,0)
 K DVBAENTR
"RTN","DVBAREG2",72,0)
 S DVBREQDT=9999999.9999999-DVBANS
"RTN","DVBAREG2",73,0)
 I DVBTYPE["ADMISSION" DO
"RTN","DVBAREG2",74,0)
 .S ADMNUM=$P(^TMP("DVBA",$J,DVBANS,DVBTYPE),U,2)
"RTN","DVBAREG2",75,0)
 D COMPSEL
"RTN","DVBAREG2",76,0)
 Q
"RTN","DVBAREG2",77,0)
 ;
"RTN","DVBAREG2",78,0)
COMPSEL ;** Compare selected 7131 to existing
"RTN","DVBAREG2",79,0)
 N DVBATMPT
"RTN","DVBAREG2",80,0)
 I DVBTYPE["ADMISSION" S DVBATMPT="A"
"RTN","DVBAREG2",81,0)
 I DVBTYPE'["ADMISSION" S DVBATMPT="L"
"RTN","DVBAREG2",82,0)
 F ZI=0:0 S ZI=$O(^DVB(396,"B",+DFN,ZI)) Q:ZI=""  I $D(^DVB(396,"G",+$E(DVBREQDT,1,14),ZI))&(DVBATMPT=$P(^DVB(396,ZI,2),"^",10)) S DVBAENTR=ZI Q
"RTN","DVBAREG2",83,0)
 I $D(DVBAENTR) DO
"RTN","DVBAREG2",84,0)
 .D ALERT(ZI)
"RTN","DVBAREG2",85,0)
 .D ASK
"RTN","DVBAREG2",86,0)
 .Q:$D(DVBAQUIT)!($D(DVBASTOP))
"RTN","DVBAREG2",87,0)
 .I '$$LOCK^DVBAUTL6(DVBAENTR) S DVBASTOP=1 Q
"RTN","DVBAREG2",88,0)
 .S STAT=$P(^DVB(396,DVBAENTR,1),U,12)
"RTN","DVBAREG2",89,0)
 .S ONFILE=0
"RTN","DVBAREG2",90,0)
 .I STAT'="" D ALERT1
"RTN","DVBAREG2",91,0)
 .Q:$D(DVBAQUIT)!($D(DVBASTOP))
"RTN","DVBAREG2",92,0)
 .I ONFILE=1 S DVBASTOP=1 Q
"RTN","DVBAREG2",93,0)
 .Q
"RTN","DVBAREG2",94,0)
 I '$D(DVBAENTR) DO
"RTN","DVBAREG2",95,0)
 .D DICW^DVBAUTIL
"RTN","DVBAREG2",96,0)
 .D ASK1
"RTN","DVBAREG2",97,0)
 .I $D(DVBASTOP)!($D(DVBAQUIT)) Q
"RTN","DVBAREG2",98,0)
 .D STUFF
"RTN","DVBAREG2",99,0)
 .Q
"RTN","DVBAREG2",100,0)
 I '$D(DVBAENTR) S DVBASTOP=1
"RTN","DVBAREG2",101,0)
 Q
"RTN","DVBAREG2",102,0)
 ;
"RTN","DVBAREG2",103,0)
ALERT(Y) ;displays when a potential hit in the 7131 file.
"RTN","DVBAREG2",104,0)
 S VAR(1,0)="1,0,0,2,0^There is a 7131 already on file for "_$$FMTE^XLFDT(DVBREQDT,"5DZ")
"RTN","DVBAREG2",105,0)
 S STAT=$P(^DVB(396,+Y,1),U,12)
"RTN","DVBAREG2",106,0)
 S VAR(2,0)="0,0,0,1:1,0^Status is "_$S(STAT'="":"FINALIZED",1:"OPEN")
"RTN","DVBAREG2",107,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",108,0)
 K VAR
"RTN","DVBAREG2",109,0)
 Q
"RTN","DVBAREG2",110,0)
ALERT1 ;
"RTN","DVBAREG2",111,0)
 I STAT'="" DO
"RTN","DVBAREG2",112,0)
 .S VAR(1,0)="0,0,0,1,0^"
"RTN","DVBAREG2",113,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",114,0)
 .K VAR
"RTN","DVBAREG2",115,0)
 .S DIR("A")="Do you want to delete the existing 7131 for this date: "
"RTN","DVBAREG2",116,0)
 .S DIR(0)="YAO"
"RTN","DVBAREG2",117,0)
 .S DIR("B")="NO"
"RTN","DVBAREG2",118,0)
 .S DIR("?")="Answer YES or No.  You may not have two 7131s for the same admission date."
"RTN","DVBAREG2",119,0)
 .D ^DIR
"RTN","DVBAREG2",120,0)
 .K DIR
"RTN","DVBAREG2",121,0)
 .I $D(DTOUT)!($D(DUOUT))!(Y="") S DVBAQUIT=1 Q
"RTN","DVBAREG2",122,0)
 .I 'Y S DVBASTOP=1 Q
"RTN","DVBAREG2",123,0)
 .I Y DO
"RTN","DVBAREG2",124,0)
 ..S DA=+DVBAENTR
"RTN","DVBAREG2",125,0)
 ..D REOPEN^DVBAUTL2
"RTN","DVBAREG2",126,0)
 ..K DA
"RTN","DVBAREG2",127,0)
 ..Q
"RTN","DVBAREG2",128,0)
 .Q
"RTN","DVBAREG2",129,0)
 Q
"RTN","DVBAREG2",130,0)
 ;
"RTN","DVBAREG2",131,0)
ASK1 ;ask user if wish to add new 7131
"RTN","DVBAREG2",132,0)
 S DVBAASIH=$P(DVBREQDT,".",2) ;*ASIH admit? (P4,v2.7)
"RTN","DVBAREG2",133,0)
 D:$L(DVBAASIH)>6 ASIHALRT^DVBAUTL8 ;**Warn ASIH admit
"RTN","DVBAREG2",134,0)
 S VAR(1,0)="1,0,0,1,0^"
"RTN","DVBAREG2",135,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",136,0)
 K VAR
"RTN","DVBAREG2",137,0)
 S DIR("A",1)="Do you want to add a NEW 7131"
"RTN","DVBAREG2",138,0)
 S DIR("A")="for "_$P(PNAM,",",2,99)_" "_$P(PNAM,",",1,1)_" :"
"RTN","DVBAREG2",139,0)
 S DIR(0)="YAO"
"RTN","DVBAREG2",140,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",141,0)
 S DIR("?")="'YES' to enter a new 7131. 'NO' to search for an existing one."
"RTN","DVBAREG2",142,0)
 D ^DIR
"RTN","DVBAREG2",143,0)
 K DIR,DVBAASIH
"RTN","DVBAREG2",144,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",145,0)
 S:Y=1 DVBREQDT=+$E(DVBREQDT,1,14)
"RTN","DVBAREG2",146,0)
 I Y=0 S DVBASTOP=1 Q
"RTN","DVBAREG2",147,0)
 Q
"RTN","DVBAREG2",148,0)
 ;
"RTN","DVBAREG2",149,0)
ASK ;ask the user if wish to edit existing 7131
"RTN","DVBAREG2",150,0)
 S VAR(1,0)="1,0,0,1,0^"
"RTN","DVBAREG2",151,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",152,0)
 K VAR
"RTN","DVBAREG2",153,0)
 S DIR("A")="Are you sure you want to edit this 7131 request: "
"RTN","DVBAREG2",154,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",155,0)
 S DIR("?")="'YES' to edit the 7131 request."
"RTN","DVBAREG2",156,0)
 S DIR(0)="YAO"
"RTN","DVBAREG2",157,0)
 D ^DIR
"RTN","DVBAREG2",158,0)
 K DIR
"RTN","DVBAREG2",159,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",160,0)
 I Y=0 S DVBASTOP=1 Q
"RTN","DVBAREG2",161,0)
 I Y=1 S DVBAEDT=1
"RTN","DVBAREG2",162,0)
 Q
"RTN","DVBAREG2",163,0)
 ;
"RTN","DVBAREG2",164,0)
STUFF ;enters 7131 into 7131 form file
"RTN","DVBAREG2",165,0)
 K DA,DIC("S"),DD,DO
"RTN","DVBAREG2",166,0)
 S DLAYGO=396,DIC(0)="QLM",DIC="^DVB(396,",X=+DFN
"RTN","DVBAREG2",167,0)
 D FILE^DICN
"RTN","DVBAREG2",168,0)
 I 'Y DO  S DVBASTOP=1 Q
"RTN","DVBAREG2",169,0)
 .S VAR(1,0)="1,0,0,2,0^Unable to add this new record!"
"RTN","DVBAREG2",170,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",171,0)
 .K VAR
"RTN","DVBAREG2",172,0)
 .Q
"RTN","DVBAREG2",173,0)
 I '$$LOCK^DVBAUTL6(Y) S DVBASTOP=1 Q
"RTN","DVBAREG2",174,0)
 S DVBAENTR=+Y
"RTN","DVBAREG2",175,0)
 S DR="1////"_CNUM_";2////"_SSN_";3////"_DVBREQDT_";23////"_DT_";24////"_DT_";27////"_LOC_";28////"_OPER_";30////"_$S($D(ADMNUM):"A",1:"L")
"RTN","DVBAREG2",176,0)
 S DIE=DIC
"RTN","DVBAREG2",177,0)
 D ^DIE
"RTN","DVBAREG2",178,0)
 K DLAYGO,DIC,DIE
"RTN","DVBAREG2",179,0)
 Q
"RTN","DVBAREG2",180,0)
 ;
"RTN","DVBAREQ3")
0^11^B18695641
"RTN","DVBAREQ3",1,0)
DVBAREQ3 ;ALB/GTS-557/THM-PRINT ROUTINE NEW REQUEST RPT ;21 JUL 89
"RTN","DVBAREQ3",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAREQ3",3,0)
 ;
"RTN","DVBAREQ3",4,0)
PRINT S:$D(DVBATASK) ^TMP($J,LPDIV,DA)="" ;**Only 1 7131 printed per division
"RTN","DVBAREQ3",5,0)
 S:'$D(DVBATASK) ^TMP($J,DA)="" ;**Only 1 7131 printed.
"RTN","DVBAREQ3",6,0)
 S DFN=$P(^DVB(396,DA,0),U,1),ADMDT=$P(^(0),U,4),RDATE=$P(^(1),U,1),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"Unknown"),DOCTYPE=$P(^DVB(396,DA,2),U,10)
"RTN","DVBAREQ3",7,0)
 S ADIV=$S($D(^DVB(396,DA,2)):$P(^(2),U,9),1:"")
"RTN","DVBAREQ3",8,0)
 I DVBSEL="D" Q:'$D(XDIV)  D HEADER
"RTN","DVBAREQ3",9,0)
 I DVBSEL="N" D HEADER2
"RTN","DVBAREQ3",10,0)
 S NODTA=1
"RTN","DVBAREQ3",11,0)
 W !,PNAM,?49,"SSN: ",SSN,!,?44,"CLAIM NO: ",CNUM,!,?38,$S(DOCTYPE="L":" ACTIVITY DATE: ",1:"ADMISSION DATE: "),$$FMTE^XLFDT(ADMDT,"5DZ"),!
"RTN","DVBAREQ3",12,0)
 W ?40,"REQUEST DATE: ",$$FMTE^XLFDT(RDATE,"5DZ"),!!,?3,"Items Requested:",!
"RTN","DVBAREQ3",13,0)
 ;
"RTN","DVBAREQ3",14,0)
ITEMS F Q=5,6,7,8,16,18,20,22,24,27 I $P(^DVB(396,DA,0),U,Q)'="NO" D PRINT1
"RTN","DVBAREQ3",15,0)
 I $P(^DVB(396,DA,0),U,25)'="" S Q=25 D GETDIV S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(20+(23-$L(MC))))_")" W !,?8,MD,GDIV,": ",$P(^DVB(396,DA,0),U,25)
"RTN","DVBAREQ3",16,0)
 S DVBAWO="N"
"RTN","DVBAREQ3",17,0)
 K ^UTILITY($J,"W") W !!,"Remarks: " S DIWL=5,DIWR=65,DIWF="WB5I9"
"RTN","DVBAREQ3",18,0)
 F LPCNT=1:1 S X=($S($D(^DVB(396,DA,5,LPCNT,0)):^(0),1:"")) Q:X=""  D ^DIWP S DVBAWO="Y"
"RTN","DVBAREQ3",19,0)
 K LPCNT,DIWL,DIWR,DIWF
"RTN","DVBAREQ3",20,0)
 I DVBAWO="Y" D ^DIWW
"RTN","DVBAREQ3",21,0)
 K DVBAWO W !! W:$D(^DVB(396,DA,2)) "Requested by: ",$S($P(^DVB(396,DA,2),U,8)]"":$P(^(2),U,8),1:" (Not specified)")," AT ",$S($P(^(2),U,7)]"":$P(^(2),U,7),1:" (Not specified) "),!
"RTN","DVBAREQ3",22,0)
 I $D(^DVB(396,DA,1)) I $P(^DVB(396,DA,1),U,12)'="" S FNLDT=$P(^(1),U,12) W !!,"This record was FINALIZED on ",$$FMTE^XLFDT(FNLDT,"5DZ")
"RTN","DVBAREQ3",23,0)
 I ADIV="" W !,?5,"**Request is incomplete, contact the Regional Office to complete**"
"RTN","DVBAREQ3",24,0)
 I IOST?1"PK-"!(IOST?1"P-") W !!!!!,"Record Processing Notes: " F LN=1:1:50 W "-" ;print processing notes for admin folder if not going to a screen
"RTN","DVBAREQ3",25,0)
 W !! D TOP
"RTN","DVBAREQ3",26,0)
 Q
"RTN","DVBAREQ3",27,0)
 ;
"RTN","DVBAREQ3",28,0)
HEADER W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBAREQ3",29,0)
 W !!!!!,"AMIE 7131 NEW REQUEST REPORT FOR ",$$FMTE^XLFDT(BDT,"5DZ")," TO ",$$FMTE^XLFDT(EDT,"5DZ")_" * LONG VERSION *",!
"RTN","DVBAREQ3",30,0)
 I ADIV="" W ?5,"FOR ",HOSP,", DIVISION NOT GIVEN"
"RTN","DVBAREQ3",31,0)
 I ADIV'="" S DIVHD=$S($D(^DG(40.8,ADIV,0)):$P(^(0),U,1),1:"") W ?5,"FOR ",HOSP W:DIVHD]"" ", DIVISION ",DIVHD,!! I DIVHD="" W ", UNABLE TO DETERMINE DIVISION",!!
"RTN","DVBAREQ3",32,0)
 S DVBAON2=""
"RTN","DVBAREQ3",33,0)
 Q
"RTN","DVBAREQ3",34,0)
 ;
"RTN","DVBAREQ3",35,0)
PRINT1 D GETDIV
"RTN","DVBAREQ3",36,0)
 I QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MD))))_")" W !,?8,MD,GDIV S QQ='QQ Q
"RTN","DVBAREQ3",37,0)
 I 'QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(22-$L(MD))))_")" W ?46,MD,GDIV S QQ='QQ
"RTN","DVBAREQ3",38,0)
 Q
"RTN","DVBAREQ3",39,0)
 ;
"RTN","DVBAREQ3",40,0)
TOP K ANS I IOST?1"C-".E,'$D(NOASK) W !!,*7,"Press RETURN to continue or ""^"" to stop   " R ANS:DTIME S:'$T ANS=U I ANS=U S DA="",MA=9999999
"RTN","DVBAREQ3",41,0)
 Q
"RTN","DVBAREQ3",42,0)
 ;
"RTN","DVBAREQ3",43,0)
HEADER2 ;prints a heading for the name selection
"RTN","DVBAREQ3",44,0)
 I IOST?1"C-".E!($D(DVBAON2)) DO
"RTN","DVBAREQ3",45,0)
 .S VAR(1,0)="0,0,0,0,1^"
"RTN","DVBAREQ3",46,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAREQ3",47,0)
 .K VAR
"RTN","DVBAREQ3",48,0)
 .Q
"RTN","DVBAREQ3",49,0)
 S VAR(1,0)="0,0,0,4:1,0^AMIE 7131 NEW REQUEST REPORT FOR "_PNAM_" **Long Version**"
"RTN","DVBAREQ3",50,0)
 I ADIV="" S VAR(2,0)="0,0,5,0,0^FOR "_HOSP_", DIVISION NOT GIVEN"
"RTN","DVBAREQ3",51,0)
 I ADIV'="" DO
"RTN","DVBAREQ3",52,0)
 .S DIVHD=$S($D(^DG(40.8,ADIV,0)):$P(^(0),U,1),1:"")
"RTN","DVBAREQ3",53,0)
 .S VAR(2,0)="0,0,5,1:2,0^FOR "_HOSP_", DIVISION "_$S(DIVHD]"":DIVHD,1:"UNABLE TO DETERMINE")
"RTN","DVBAREQ3",54,0)
 .Q
"RTN","DVBAREQ3",55,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREQ3",56,0)
 K VAR
"RTN","DVBAREQ3",57,0)
 Q
"RTN","DVBAREQ3",58,0)
 ;
"RTN","DVBAREQ3",59,0)
GETDIV ;** Get the division for 7131 Rpt
"RTN","DVBAREQ3",60,0)
 I $D(^DVB(396,DA,6)) DO
"RTN","DVBAREQ3",61,0)
 .I Q=5 S GDIVPTR=$P(^DVB(396,DA,6),"^",9)
"RTN","DVBAREQ3",62,0)
 .I Q=6 S GDIVPTR=$P(^DVB(396,DA,6),"^",11)
"RTN","DVBAREQ3",63,0)
 .I Q=7 S GDIVPTR=$P(^DVB(396,DA,6),"^",13)
"RTN","DVBAREQ3",64,0)
 .I Q=8 S GDIVPTR=$P(^DVB(396,DA,6),"^",15)
"RTN","DVBAREQ3",65,0)
 .I Q=24 S GDIVPTR=$P(^DVB(396,DA,6),"^",7)
"RTN","DVBAREQ3",66,0)
 .I Q>15&(Q'=24) DO
"RTN","DVBAREQ3",67,0)
 ..S DVBAPCE=Q+1
"RTN","DVBAREQ3",68,0)
 ..S GDIVPTR=$P(^DVB(396,DA,6),"^",DVBAPCE)
"RTN","DVBAREQ3",69,0)
 ..K DVBAPCE
"RTN","DVBAREQ3",70,0)
 S:'$D(GDIVPTR) GDIVPTR=$P(^DVB(396,DA,2),"^",9)
"RTN","DVBAREQ3",71,0)
 I $D(GDIVPTR),(GDIVPTR="") S GDIVPTR=$P(^DVB(396,DA,2),"^",9)
"RTN","DVBAREQ3",72,0)
 S GDIVNAM=$P(^DG(40.8,GDIVPTR,0),"^",1)
"RTN","DVBAREQ3",73,0)
 K GDIVPTR
"RTN","DVBAREQ3",74,0)
 Q
"RTN","DVBAREQ3",75,0)
 ;
"RTN","DVBAREQ3",76,0)
FIELDS ;
"RTN","DVBAREQ3",77,0)
5 ;;NOTICE OF DISCHARGE
"RTN","DVBAREQ3",78,0)
6 ;;HOSPITAL SUMMARY
"RTN","DVBAREQ3",79,0)
7 ;;21-DAY CERTIFICATE
"RTN","DVBAREQ3",80,0)
8 ;;OTHER/EXAM REVIEW RMKS
"RTN","DVBAREQ3",81,0)
16 ;;SPECIAL REPORT
"RTN","DVBAREQ3",82,0)
18 ;;COMPETENCY REPORT
"RTN","DVBAREQ3",83,0)
20 ;;VA FORM 21-2680
"RTN","DVBAREQ3",84,0)
22 ;;ASSET INFORMATION
"RTN","DVBAREQ3",85,0)
24 ;;ADMISSION REPORT
"RTN","DVBAREQ3",86,0)
25 ;;OPT TREATMENT REPORT
"RTN","DVBAREQ3",87,0)
27 ;;BEGINNING DATE/CARE
"RTN","DVBAREQ3",88,0)
 Q
"RTN","DVBAREQS")
0^12^B8799287
"RTN","DVBAREQS",1,0)
DVBAREQS ;ALB ISC/THM-SHORT RPT FOR NEW 7131 REQUESTS; 21 JUL 89@0129 
"RTN","DVBAREQS",2,0)
 ;;2.7;AMIE;**2,17**;Apr 10, 1995
"RTN","DVBAREQS",3,0)
 ;called by DVBAREQ1 for short version of new requests
"RTN","DVBAREQS",4,0)
 ;
"RTN","DVBAREQS",5,0)
SETUP S %DT="AE",DIC="^DVB(396,",BDT1=$$FMTE^XLFDT(BDT,"5DZ"),EDT1=$$FMTE^XLFDT(EDT,"5DZ")
"RTN","DVBAREQS",6,0)
 I XDIV'="ALL" S (BDIV,EDIV)=$P(^DG(40.8,XDIV,0),U,1)
"RTN","DVBAREQS",7,0)
 I XDIV="ALL" S BDIV="@",EDIV=""
"RTN","DVBAREQS",8,0)
 ;
"RTN","DVBAREQS",9,0)
INFO S DHD="VARO 7131 NEW REQUEST REPORT FOR "_BDT1_" TO "_EDT1_" * SHORT VERSION *",L=0,FLDS=".01;L15,1;L12,2;L12,NUMDATE4(#3);L10;""ACT/ADM DATE"",23;L11,29;L9"
"RTN","DVBAREQS",10,0)
 S ^TMP(396,$J,1,2,3,4,5,6)=""
"RTN","DVBAREQS",11,0)
 S DIOBEG="K ^TMP(396,$J) D TMPSET^DVBAREQS(BDT,EDT,XDIV)"
"RTN","DVBAREQS",12,0)
 S (FR(0),TO(0))=""
"RTN","DVBAREQS",13,0)
 S DISPAR(0,2)="^;""DOCUMENT TYPE: "";S2"
"RTN","DVBAREQS",14,0)
 S BY(0)="^TMP(396,$J,",L(0)=6
"RTN","DVBAREQS",15,0)
 S DHIT="I $P($G(^DVB(396,D0,2)),U,9)="""" W ?9,""** REGIONAL OFFICE MUST EDIT THE INCOMPLETE REQUEST LISTED ABOVE **"",!"
"RTN","DVBAREQS",16,0)
 ;
"RTN","DVBAREQS",17,0)
PRINT D EN1^DIP
"RTN","DVBAREQS",18,0)
 ;
"RTN","DVBAREQS",19,0)
EXIT K FR,BY,DIS,DHIT,TO,L,FLDS,DHD,^TMP(396,$J),DIOBEG,FR(0),TO(0),BY(0),L(0)
"RTN","DVBAREQS",20,0)
 Q
"RTN","DVBAREQS",21,0)
 ;
"RTN","DVBAREQS",22,0)
NAME ;this is called from DVBAREQ1 when a selection is made by name.
"RTN","DVBAREQS",23,0)
 S DHD="VARO 7131 NEW REQUEST REPORT FOR "_$P(DA,U,2)_" * SHORT VERSION *",(FR,TO)=+DA,BY="@NUMBER"
"RTN","DVBAREQS",24,0)
 S L=0,DIC="^DVB(396,"
"RTN","DVBAREQS",25,0)
 S FLDS=".01;L15,1;L12,2;L12,NUMDATE4(#3);L10;""ACT/ADM DATE"",23;L11,29;L9"
"RTN","DVBAREQS",26,0)
 D PRINT
"RTN","DVBAREQS",27,0)
 Q
"RTN","DVBAREQS",28,0)
 ;
"RTN","DVBAREQS",29,0)
VERSION() ;Get whether user wants long or short version
"RTN","DVBAREQS",30,0)
 N DTOUT,DUOUT,Y
"RTN","DVBAREQS",31,0)
 S DIR(0)="SM^L:Long;S:Short",DIR("A")="Select version",DIR("B")="Long"
"RTN","DVBAREQS",32,0)
 D ^DIR
"RTN","DVBAREQS",33,0)
 K DIR
"RTN","DVBAREQS",34,0)
 I $D(DTOUT)!($D(DUOUT)) Q 0
"RTN","DVBAREQS",35,0)
 Q $S(Y="L"!(Y="S"):Y,1:0)
"RTN","DVBAREQS",36,0)
 ;
"RTN","DVBAREQS",37,0)
KILL1 ;
"RTN","DVBAREQS",38,0)
 K DVBDA,DVBVER,DA,NODTA,QQ,DVBAON2,^TMP($J),VAR
"RTN","DVBAREQS",39,0)
 Q
"RTN","DVBAREQS",40,0)
 ;
"RTN","DVBAREQS",41,0)
KILL S XRTN=$T(+0)
"RTN","DVBAREQS",42,0)
 D SPM^DVBCUTL4
"RTN","DVBAREQS",43,0)
 I $D(ZTQUEUED)&($D(DVBAMAN)) D KILL^%ZTLOAD
"RTN","DVBAREQS",44,0)
 K DVBAON2,DVBAMAN,^TMP($J),LPDIV,DVBOUT,DVBSEL,VAR,DVBVER,DVBDA,DVBATASK,DVBSTOP
"RTN","DVBAREQS",45,0)
 D KILL^DVBAUTIL
"RTN","DVBAREQS",46,0)
 Q
"RTN","DVBAREQS",47,0)
 ;
"RTN","DVBAREQS",48,0)
TMPSET(BDT,EDT,XDIV) ;**Set ^TMP X-Ref for short report
"RTN","DVBAREQS",49,0)
 ;** ^TMP("396",$J) array returned and must be KILLed by calling rtn
"RTN","DVBAREQS",50,0)
 N LPDT,LPDIV,LPDA,DOCTYPE,DTOFREQ,DIV,PATNAME,TYPEORD
"RTN","DVBAREQS",51,0)
 F LPDT=((BDT-1)+.2359):0 S LPDT=$O(^DVB(396,"AE",LPDT)) Q:LPDT>EDT!(LPDT="")  DO
"RTN","DVBAREQS",52,0)
 .S:XDIV'="ALL" LPDIV=+XDIV-1
"RTN","DVBAREQS",53,0)
 .S:XDIV="ALL" LPDIV=""
"RTN","DVBAREQS",54,0)
 .F  S LPDIV=$O(^DVB(396,"AE",LPDT,LPDIV)) Q:(LPDIV=""!(XDIV'="ALL"&(XDIV'=LPDIV)))  DO
"RTN","DVBAREQS",55,0)
 ..F LPDA=0:0 S LPDA=$O(^DVB(396,"AE",LPDT,LPDIV,LPDA)) Q:LPDA=""  DO
"RTN","DVBAREQS",56,0)
 ...S DOCTYPE=$P($G(^DVB(396,LPDA,2)),U,10)
"RTN","DVBAREQS",57,0)
 ...S TYPEORD=$S(DOCTYPE="A":1,DOCTYPE="L":2,1:3)
"RTN","DVBAREQS",58,0)
 ...S DOCTYPE=$S(DOCTYPE="A":"ADMISSION DATE",DOCTYPE="L":"ACTIVITY DATE",1:"")
"RTN","DVBAREQS",59,0)
 ...S DTOFREQ=$P($G(^DVB(396,LPDA,1)),U,1)
"RTN","DVBAREQS",60,0)
 ...S DIV=$P($G(^DVB(396,LPDA,2)),U,9)
"RTN","DVBAREQS",61,0)
 ...S PATNAME=$P($G(^DVB(396,LPDA,0)),U,1)
"RTN","DVBAREQS",62,0)
 ...S ^TMP("396",$J,TYPEORD,DOCTYPE,DTOFREQ,DIV,PATNAME,LPDA)=""
"RTN","DVBAREQS",63,0)
 Q
"RTN","DVBAUTIL")
0^28^B24053191
"RTN","DVBAUTIL",1,0)
DVBAUTIL ;ALB ISC/THM-AMIE UTILITIES ; 1/16/91  2:58 PM
"RTN","DVBAUTIL",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAUTIL",3,0)
 ;
"RTN","DVBAUTIL",4,0)
SORT W !!,"Sort by Regional Office number" S %=1 D YN^DICN I $D(DTOUT)!(%<0) K DTOUT S Y=-1 Q
"RTN","DVBAUTIL",5,0)
 I $D(%Y) I %Y["?" W !!,*7,"Enter Y to sort by the Regional Office number you",!,"select or enter N to get ALL Regional Offices reported." G SORT
"RTN","DVBAUTIL",6,0)
 I %'=1 S RO="N",RONUM=0 Q
"RTN","DVBAUTIL",7,0)
 I %=1 S RO="Y" G RONUM
"RTN","DVBAUTIL",8,0)
 W !,*7,"Invalid response.",!! G SORT
"RTN","DVBAUTIL",9,0)
 ;
"RTN","DVBAUTIL",10,0)
RONUM W !,"Regional Office number: " R RONUM:DTIME G:RONUM["^" SORT I '$T!(RONUM="") W *7 S Y=-1 Q
"RTN","DVBAUTIL",11,0)
 I RONUM'?1.3N W *7,"     Must be 1-3 numbers.",!! G RONUM
"RTN","DVBAUTIL",12,0)
 Q
"RTN","DVBAUTIL",13,0)
 ;
"RTN","DVBAUTIL",14,0)
KILL ;kill all variables and exit selected program
"RTN","DVBAUTIL",15,0)
 D ^%ZISC
"RTN","DVBAUTIL",16,0)
KILL1 K %DT,%ZIS,ANS,BDATE,CNUM,EDATE,L,MA,DA,NODTA,PNAM,Q,QQ,RDATE,SSN,XY,VER,J,LN,POP,FINALDTE,ADMDT,BEDSEC,CFLOC,DIAG,DCHGDT,HEAD,HEAD1,MB,RCVAA,RCVPEN,A,TYPE,C,ADMNUM,DIPGM,DIS,HNAME,DVBAQUIT,DSRP
"RTN","DVBAUTIL",17,0)
 K WARD,NOASK,^TMP($J),DTOUT,ZTSK,IO("C"),I,RO,RONUM,LADM,K,RADM,%X,%Y,%XX,%YY,X,Y,ICDAT2,ICDAT,LOS,TDIS,DIC,POP,DVBATYPS,TO,NUMSEL,REP,DVBAFIND,DVBATP,DVBAPRNT,SITE,LINE,OPER,PG,HD,HD1,HEAD2,DVBADD
"RTN","DVBAUTIL",18,0)
 K ZTIO,ZTDESC,ZTRTN,DATA,SC,LDCH,FDT(0),NAME,DIE,DR,ZX,ZI,XDA,XADMDT,DLAYGO,HD,D,DIC,Y,Z,ZTYPE,D0,D1,DI,DQ,CNM,CFLC,XDTA,MC,MD,PROCDT,ADMDATE,EDAYS,CNT,XLOC,TEMP,TEMPDA,%ZIS,%IS,DIVHD,XDIV,DVBADIV,ADIV,BDT,EDT
"RTN","DVBAUTIL",19,0)
 K ZTYPE,DO,DTAR,X,Y,HEAD,HEAD1,ADTYPE,NDCH,DOCTYPE,ELIG,INCMP,LG,OUT,LADMDT,NONE,BDATE1,XDA2,ADM,DFN,DISCH,XCN,LCN,HOSP,NODE,T,TRN,ZTSAVE,ZDT,ZDT1,ZDA,IO("Q"),IOP,BDIV,EDIV,BDT1,EDT1,NEWREQ,BED,STAT,DVBADIC,ADMNUM
"RTN","DVBAUTIL",20,0)
 K X2,DHD,DIWF,DIWL,DIWR,DVBASC,DVBAELIG,FNLDT,CFLC,HIST,DVBAELST,OLDY,PDATE,ZTDTH,DTA,VAINDT,VAIN,WWHO,SDATE,%,DVBAQUIT,NODE,NOFINAL,^TMP("ADMIT",$J),LOC,AA,DVBASTAT,OLDY,ADMDT,ANS1,CURADMDT,DVBADT,DVBAH,DVBAQ
"RTN","DVBAUTIL",21,0)
 K DVBAI,DVBAT,HEADDT,HOSPDAYS,LBEDSEC,LDCHGDT,LDIAG,LLADM,LTDIS,MSG,MSG1,VX,VY,X1,XLINE,ZJ,ZY,ZZ,LOC,QUIT,QUIT1,^UTILITY($J),^TMP("DVBA",$J),^TMP("DVBA","PEN"),^TMP("DVBA","A&A"),DVBACEPT,DCHPTR,DVBA
"RTN","DVBAUTIL",22,0)
 Q
"RTN","DVBAUTIL",23,0)
 ;
"RTN","DVBAUTIL",24,0)
LOS ;compute length of stay for discharge report
"RTN","DVBAUTIL",25,0)
 S %DT="T" S X=ADMDT D ^%DT S X2=Y
"RTN","DVBAUTIL",26,0)
 S X=DCHGDT D ^%DT S X1=Y K Y
"RTN","DVBAUTIL",27,0)
 D ^%DTC S LOS=X I LOS=0 S LOS=""
"RTN","DVBAUTIL",28,0)
 Q
"RTN","DVBAUTIL",29,0)
DATE W !,?5,"The entry of future dates is NOT allowed.",!
"RTN","DVBAUTIL",30,0)
 S %DT(0)=-DT
"RTN","DVBAUTIL",31,0)
 S %DT("A")="BEGINNING date: ",%DT="AET" D ^%DT W:X="^"!(Y=-1) !! Q:X=""!(Y=-1)  S BDATE=Y
"RTN","DVBAUTIL",32,0)
 S %DT("A")="   ENDING date: ",%DT="AET" D ^%DT S EDATE=Y Q:X="^"
"RTN","DVBAUTIL",33,0)
 I EDATE<BDATE W !!,*7,"Invalid date sequence.  Beginning date must be before the ending date.",!! H 2 G DATE
"RTN","DVBAUTIL",34,0)
 S BDATE=BDATE-.5,EDATE=EDATE+.5
"RTN","DVBAUTIL",35,0)
 D SORT K %DT(0) Q
"RTN","DVBAUTIL",36,0)
 ;
"RTN","DVBAUTIL",37,0)
DICW S DVBADIC(0,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Admission date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",38,0)
 ;
"RTN","DVBAUTIL",39,0)
DICW1 S DVBADIC(1,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Activity date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",40,0)
 ;
"RTN","DVBAUTIL",41,0)
DICW2 S DIC("W")="S ZTYPE=$S($D(^DVB(396,+Y,2)):$P(^(2),U,10),1:""A"") X $S(ZTYPE=""L"":DVBADIC(1,""W""),1:DVBADIC(0,""W""))"
"RTN","DVBAUTIL",42,0)
 Q
"RTN","DVBAUTIL",43,0)
 ;
"RTN","DVBAUTIL",44,0)
FINAL ;
"RTN","DVBAUTIL",45,0)
 S $P(^DVB(396.1,1,0),"^",X)=DT ;x is the corresponding date field
"RTN","DVBAUTIL",46,0)
 G KILL1
"RTN","DVBAUTIL",47,0)
 ;
"RTN","DVBAUTIL",48,0)
DUZ2 K DVBAQUIT
"RTN","DVBAUTIL",49,0)
 I '$D(DUZ(2)) W *7,!!,"You have no division code.  Please contact the site manager.",!! H 3 S DVBAQUIT=1 Q
"RTN","DVBAUTIL",50,0)
 S DVBAD2=$S($D(^DIC(4,+DUZ(2),99)):$P(^(99),U,1),1:0)
"RTN","DVBAUTIL",51,0)
 I DVBAD2=0 W *7,!!,"Your division code is invalid.",!! H 3 S DVBAQUIT=1
"RTN","DVBAUTIL",52,0)
 Q
"RTN","DVBAUTIL",53,0)
S ;
"RTN","DVBAUTIL",54,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",55,0)
 ;of AMIE.
"RTN","DVBAUTIL",56,0)
 Q
"RTN","DVBAUTIL",57,0)
S1 ;
"RTN","DVBAUTIL",58,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",59,0)
 ;of AMIE.
"RTN","DVBAUTIL",60,0)
 Q
"RTN","DVBAUTIL",61,0)
K ;
"RTN","DVBAUTIL",62,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",63,0)
 ;of AMIE.
"RTN","DVBAUTIL",64,0)
 Q
"RTN","DVBAUTIL",65,0)
K1 ;
"RTN","DVBAUTIL",66,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",67,0)
 ;of AMIE.
"RTN","DVBAUTIL",68,0)
 Q
"RTN","DVBAUTIL",69,0)
 ;
"RTN","DVBAUTIL",70,0)
EXIT ;called from the DVBAREG1 routine, kills off variables at end.
"RTN","DVBAUTIL",71,0)
 S VAR(1,0)="0,0,0,0:2,1^"
"RTN","DVBAUTIL",72,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAUTIL",73,0)
 K VAR,ADM,ADMDT,ANS,CNUM,DA,DFN,DIC,DIE,DR,PNAM,SSN,ZA,OPER,X,Y,POP,LOC,%,ZI,ONFILE,REOPEN,DVBADIV,STAT,ZX,HD,I,NAME,HNAME,DTAR,DTOUT,%Y,DOCTYPE,%Y1,DQ,DVBADIC,OUT,ZTYPE,A,ADMNUM,ANS1,OLDY,DVBASTAT,DVBAENTR,DVBAEDT
"RTN","DVBAUTIL",74,0)
 K DVBAD2,DVBAX,DVBCSSNO,AROWOUT,DVBADM,DVBANL,DVBAPT,DVBAQUIT,DVBBDT,DVBCHK,DVBDISP,DVBEDT,DVBSPCOD,DVBVAR,DVBCNT,DVBAY,DVBDOC,DVBAIFN,DVBANS
"RTN","DVBAUTIL",75,0)
 K ^TMP("DVBA",$J),^UTILITY("DIQ1",$J)
"RTN","DVBAUTIL",76,0)
 Q
"RTN","DVBAUTIL",77,0)
 ;
"RTN","DVBAUTL7")
0^13^B25268612
"RTN","DVBAUTL7",1,0)
DVBAUTL7 ;ALB/GTS;UTILITY ROUTINE;12/6/94
"RTN","DVBAUTL7",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBAUTL7",3,0)
 ;
"RTN","DVBAUTL7",4,0)
 ;** Version Changes
"RTN","DVBAUTL7",5,0)
 ;   2.7 - New routine (Enhc 16)
"RTN","DVBAUTL7",6,0)
 ;
"RTN","DVBAUTL7",7,0)
SEL7131() ;** Select a 7131 request
"RTN","DVBAUTL7",8,0)
 K Y
"RTN","DVBAUTL7",9,0)
 F  DO  Q:$D(Y)
"RTN","DVBAUTL7",10,0)
 .S DIC="^DVB(396,",DIC(0)="AEMQ"
"RTN","DVBAUTL7",11,0)
 .S DIC("W")="D REQDT^DVBAUTL7"
"RTN","DVBAUTL7",12,0)
 .D ^DIC
"RTN","DVBAUTL7",13,0)
 .D:+Y>0 CHECK
"RTN","DVBAUTL7",14,0)
 K DIC,X
"RTN","DVBAUTL7",15,0)
 Q +Y
"RTN","DVBAUTL7",16,0)
 ;
"RTN","DVBAUTL7",17,0)
CHECK ;** Check 7131 for a pending report
"RTN","DVBAUTL7",18,0)
 K DVBAOPEN
"RTN","DVBAUTL7",19,0)
 N DVBAX
"RTN","DVBAUTL7",20,0)
 F DVBAX=9,11,13,15,17,19,21,23,7,28,26 DO
"RTN","DVBAUTL7",21,0)
 .I '$D(DVBAOPEN) DO
"RTN","DVBAUTL7",22,0)
 ..I DVBAX'=7 DO
"RTN","DVBAUTL7",23,0)
 ...S:$P(^DVB(396,+Y,0),U,DVBAX)="P" DVBAOPEN=""
"RTN","DVBAUTL7",24,0)
 ..I DVBAX=7 DO
"RTN","DVBAUTL7",25,0)
 ...S:$P(^DVB(396,+Y,1),U,DVBAX)="P" DVBAOPEN=""
"RTN","DVBAUTL7",26,0)
 I '$D(DVBAOPEN) K Y
"RTN","DVBAUTL7",27,0)
 I '$D(DVBAOPEN) DO
"RTN","DVBAUTL7",28,0)
 .S VAR(1,0)="1,0,0,2:2,0^You must select a 7131 with Pending reports!"
"RTN","DVBAUTL7",29,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAUTL7",30,0)
 .K VAR,PAR1,PAR2
"RTN","DVBAUTL7",31,0)
 K DVBAOPEN
"RTN","DVBAUTL7",32,0)
 Q
"RTN","DVBAUTL7",33,0)
 ;
"RTN","DVBAUTL7",34,0)
INITRPT(DVBAIEN) ;** Set nodes for division updates on 7131
"RTN","DVBAUTL7",35,0)
 ;** Variable Descriptions
"RTN","DVBAUTL7",36,0)
 ;      DVBARPT(RPT #)=Report name^Selected - Y/N^Status - P/C^Division #
"RTN","DVBAUTL7",37,0)
 ;      DVBA0 and DVBA6 are the 7131 rec's 0 and 6 node respectively
"RTN","DVBAUTL7",38,0)
 ;
"RTN","DVBAUTL7",39,0)
 ;** Note: DVBARPT local array returned to calling rtn
"RTN","DVBAUTL7",40,0)
 ;
"RTN","DVBAUTL7",41,0)
 N DVBA0,DVBA6,DVBAX,SUBSCPT,RPTNME,RPTSTAT,RPTSEL,SELPCE,DVBADIV,DIVNUM
"RTN","DVBAUTL7",42,0)
 S DVBA0=^DVB(396,DVBAIEN,0)
"RTN","DVBAUTL7",43,0)
 S:$D(^DVB(396,DVBAIEN,6)) DVBA6=^DVB(396,DVBAIEN,6)
"RTN","DVBAUTL7",44,0)
 S:'$D(^DVB(396,DVBAIEN,6)) DVBA6=""
"RTN","DVBAUTL7",45,0)
 S SUBSCPT=0
"RTN","DVBAUTL7",46,0)
 F DVBAX=9,11,13,15,17,19,21,23,7,28,26 DO  ;**Subscpt's = Status Pce's
"RTN","DVBAUTL7",47,0)
 .S SUBSCPT=SUBSCPT+1
"RTN","DVBAUTL7",48,0)
 .S RPTNME=$T(@DVBAX)
"RTN","DVBAUTL7",49,0)
 .S RPTNME=$P(RPTNME,";;",2)
"RTN","DVBAUTL7",50,0)
 .I DVBAX'=7 DO  ;**Set up Rpt Selection Pce #'s
"RTN","DVBAUTL7",51,0)
 ..I DVBAX<17 DO
"RTN","DVBAUTL7",52,0)
 ...S:DVBAX=9 SELPCE=5
"RTN","DVBAUTL7",53,0)
 ...S:DVBAX=11 SELPCE=6
"RTN","DVBAUTL7",54,0)
 ...S:DVBAX=13 SELPCE=7
"RTN","DVBAUTL7",55,0)
 ...S:DVBAX=15 SELPCE=8
"RTN","DVBAUTL7",56,0)
 ..S:(DVBAX>15&(DVBAX'=26)) SELPCE=DVBAX-1
"RTN","DVBAUTL7",57,0)
 ..S RPTSTAT=$P(^DVB(396,DVBAIEN,0),U,DVBAX)
"RTN","DVBAUTL7",58,0)
 .S:DVBAX=7 RPTSTAT=$P(^DVB(396,DVBAIEN,1),U,DVBAX),SELPCE=24
"RTN","DVBAUTL7",59,0)
 .S:DVBAX'=26 RPTSEL=$P(^DVB(396,DVBAIEN,0),U,SELPCE)
"RTN","DVBAUTL7",60,0)
 .I DVBAX=26 DO
"RTN","DVBAUTL7",61,0)
 ..S SELPCE=25
"RTN","DVBAUTL7",62,0)
 ..S:$P(^DVB(396,DVBAIEN,0),U,SELPCE)'="" RPTSEL="YES"
"RTN","DVBAUTL7",63,0)
 ..S:$P(^DVB(396,DVBAIEN,0),U,SELPCE)="" RPTSEL="NO"
"RTN","DVBAUTL7",64,0)
 .S DIVNUM=$P(DVBA6,U,DVBAX)
"RTN","DVBAUTL7",65,0)
 .S:+DIVNUM>0 DVBADIV=$P(^DG(40.8,DIVNUM,0),U,1)
"RTN","DVBAUTL7",66,0)
 .S:+DIVNUM'>0 DVBADIV=""
"RTN","DVBAUTL7",67,0)
 .S DVBARPT(SUBSCPT)=RPTNME_"^"_RPTSEL_"^"_RPTSTAT_"^"_DVBADIV_"^"_DIVNUM_"^"_DIVNUM
"RTN","DVBAUTL7",68,0)
 Q
"RTN","DVBAUTL7",69,0)
 ;
"RTN","DVBAUTL7",70,0)
SETDR ;** Set DR string for 7131 division/tran date field updates
"RTN","DVBAUTL7",71,0)
 S:$D(DR) DR=DR_";"_FLDDIV_"///"_REQDIV_";"_FLDDTE_"///"_REQDTE
"RTN","DVBAUTL7",72,0)
 S:'$D(DR) DR=FLDDIV_"///"_REQDIV_";"_FLDDTE_"///"_REQDTE
"RTN","DVBAUTL7",73,0)
 Q
"RTN","DVBAUTL7",74,0)
 ;
"RTN","DVBAUTL7",75,0)
CLEARDR ;** Set DR string to clear 7131 division/tran date fields (7131 edit)
"RTN","DVBAUTL7",76,0)
 S:$D(DR) DR=DR_";"_FLDDIV_"///@;"_FLDDTE_"///@"
"RTN","DVBAUTL7",77,0)
 S:'$D(DR) DR=FLDDIV_"///@;"_FLDDTE_"///@"
"RTN","DVBAUTL7",78,0)
 Q
"RTN","DVBAUTL7",79,0)
 ;
"RTN","DVBAUTL7",80,0)
REQDT ;** Output 7131 date for DIC("W")
"RTN","DVBAUTL7",81,0)
 N DVBADTE,DVBATIME,DVBADTWK,DVBAX
"RTN","DVBAUTL7",82,0)
 S DVBADTWK=$P(^DVB(396,+Y,0),U,4)
"RTN","DVBAUTL7",83,0)
 S DVBATIME=$P(DVBADTWK,".",2)
"RTN","DVBAUTL7",84,0)
 S DVBADTWK=$P(DVBADTWK,".",1)
"RTN","DVBAUTL7",85,0)
 S DVBADTE=$$FMTE^XLFDT(DVBADTWK,"5DZ")
"RTN","DVBAUTL7",86,0)
 I +DVBATIME>0 DO
"RTN","DVBAUTL7",87,0)
 .F DVBAX=$L(DVBATIME):1:3 S DVBATIME=DVBATIME_"0"
"RTN","DVBAUTL7",88,0)
 .S DVBATIME=$E(DVBATIME,1,2)_":"_$E(DVBATIME,3,4)
"RTN","DVBAUTL7",89,0)
 .S DVBADTE=DVBADTE_" @ "_DVBATIME
"RTN","DVBAUTL7",90,0)
 W ?35,$S($P(^(2),U,10)="L":"Activity Date:  ",$P(^(2),U,10)="A":"Admission Date: ",1:""),DVBADTE
"RTN","DVBAUTL7",91,0)
 Q
"RTN","DVBAUTL7",92,0)
 ;
"RTN","DVBAUTL7",93,0)
FILE ;** Update 7131 record - Called from DVBADXFR
"RTN","DVBAUTL7",94,0)
 N DVBAX,DVBADTWK
"RTN","DVBAUTL7",95,0)
 S DVBADTWK=DVBATDT
"RTN","DVBAUTL7",96,0)
 S DVBADTWK=$P(DVBATDT,"@",2)
"RTN","DVBAUTL7",97,0)
 S REQDTE=$P(DVBATDT,"@",1)_"@"_$P(DVBADTWK,":",1)_":"_$P(DVBADTWK,":",2)
"RTN","DVBAUTL7",98,0)
 F DVBAX=1:1:11  DO
"RTN","DVBAUTL7",99,0)
 .I $P(DVBARPT(DVBAX),U,5)'=$P(DVBARPT(DVBAX),U,6) DO
"RTN","DVBAUTL7",100,0)
 ..I DVBAX=1 DO
"RTN","DVBAUTL7",101,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",102,0)
 ...S FLDDIV=4.6,FLDDTE=4.7
"RTN","DVBAUTL7",103,0)
 ...D SETDR
"RTN","DVBAUTL7",104,0)
 ..I DVBAX=2 DO
"RTN","DVBAUTL7",105,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",106,0)
 ...S FLDDIV=5.6,FLDDTE=5.7
"RTN","DVBAUTL7",107,0)
 ...D SETDR
"RTN","DVBAUTL7",108,0)
 ..I DVBAX=3 DO
"RTN","DVBAUTL7",109,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",110,0)
 ...S FLDDIV=6.6,FLDDTE=6.7
"RTN","DVBAUTL7",111,0)
 ...D SETDR
"RTN","DVBAUTL7",112,0)
 ..I DVBAX=4 DO
"RTN","DVBAUTL7",113,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",114,0)
 ...S FLDDIV=7.6,FLDDTE=7.7
"RTN","DVBAUTL7",115,0)
 ...D SETDR
"RTN","DVBAUTL7",116,0)
 ..I DVBAX=5 DO
"RTN","DVBAUTL7",117,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",118,0)
 ...S FLDDIV=9.6,FLDDTE=9.7
"RTN","DVBAUTL7",119,0)
 ...D SETDR
"RTN","DVBAUTL7",120,0)
 ..I DVBAX=6 DO
"RTN","DVBAUTL7",121,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",122,0)
 ...S FLDDIV=11.6,FLDDTE=11.7
"RTN","DVBAUTL7",123,0)
 ...D SETDR
"RTN","DVBAUTL7",124,0)
 ..I DVBAX=7 DO
"RTN","DVBAUTL7",125,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",126,0)
 ...S FLDDIV=13.6,FLDDTE=13.7
"RTN","DVBAUTL7",127,0)
 ...D SETDR
"RTN","DVBAUTL7",128,0)
 ..I DVBAX=8 DO
"RTN","DVBAUTL7",129,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",130,0)
 ...S FLDDIV=15.6,FLDDTE=15.7
"RTN","DVBAUTL7",131,0)
 ...D SETDR
"RTN","DVBAUTL7",132,0)
 ..I DVBAX=9 DO
"RTN","DVBAUTL7",133,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",134,0)
 ...S FLDDIV=17.6,FLDDTE=17.7
"RTN","DVBAUTL7",135,0)
 ...D SETDR
"RTN","DVBAUTL7",136,0)
 ..I DVBAX=10 DO
"RTN","DVBAUTL7",137,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",138,0)
 ...S FLDDIV=20.6,FLDDTE=20.7
"RTN","DVBAUTL7",139,0)
 ...D SETDR
"RTN","DVBAUTL7",140,0)
 ..I DVBAX=11 DO
"RTN","DVBAUTL7",141,0)
 ...S REQDIV=$P(DVBARPT(DVBAX),U,5)
"RTN","DVBAUTL7",142,0)
 ...S FLDDIV=18.6,FLDDTE=18.7
"RTN","DVBAUTL7",143,0)
 ...D SETDR
"RTN","DVBAUTL7",144,0)
 I $D(DR) DO
"RTN","DVBAUTL7",145,0)
 .S DIE="^DVB(396,"
"RTN","DVBAUTL7",146,0)
 .S DA=REQDA
"RTN","DVBAUTL7",147,0)
 .D ^DIE
"RTN","DVBAUTL7",148,0)
 .K DIE,DA,DR
"RTN","DVBAUTL7",149,0)
 Q
"RTN","DVBAUTL7",150,0)
 ;
"RTN","DVBAUTL7",151,0)
RPTNMS ;
"RTN","DVBAUTL7",152,0)
9 ;;Notice of Discharge
"RTN","DVBAUTL7",153,0)
11 ;;Hospital Summary
"RTN","DVBAUTL7",154,0)
13 ;;Certificate (21-day)
"RTN","DVBAUTL7",155,0)
15 ;;Other/Exam (Review Remarks)
"RTN","DVBAUTL7",156,0)
17 ;;Special Report
"RTN","DVBAUTL7",157,0)
19 ;;Competency Report
"RTN","DVBAUTL7",158,0)
21 ;;VA Form 21-2680
"RTN","DVBAUTL7",159,0)
23 ;;Asset Information
"RTN","DVBAUTL7",160,0)
7 ;;Admission Report
"RTN","DVBAUTL7",161,0)
28 ;;Beginning Date Care
"RTN","DVBAUTL7",162,0)
26 ;;OPT Treatment Report (Date Range)
"RTN","DVBAUTL7",163,0)
 Q
"RTN","DVBCAMI1")
0^14^B9931971
"RTN","DVBCAMI1",1,0)
DVBCAMI1 ;ALB/GTS-557/THM-AMIS REPORT/BULLETIN TEXT ; 10/4/91  8:48 AM
"RTN","DVBCAMI1",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCAMI1",3,0)
 ;
"RTN","DVBCAMI1",4,0)
 ;** NOTICE: This routine is part of an implementation of a Nationally
"RTN","DVBCAMI1",5,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCAMI1",6,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCAMI1",7,0)
 ;
"RTN","DVBCAMI1",8,0)
BULLTXT S TOTRECV=TOT("RECEIVED")+TOT("INSUFF"),TOTRVTN=TOTRECV+TOT("TRANSIN")
"RTN","DVBCAMI1",9,0)
 S ^TMP($J,1,0)="Processing date: "_$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCAMI1",10,0)
 S ^TMP($J,2,0)=" "
"RTN","DVBCAMI1",11,0)
 S ^TMP($J,3,0)="Total pending from previous month: "_PREVMO
"RTN","DVBCAMI1",12,0)
 S ^TMP($J,4,0)=" "
"RTN","DVBCAMI1",13,0)
 S ^TMP($J,5,0)="Requests received for date range: "_TOT("RECEIVED")
"RTN","DVBCAMI1",14,0)
 S ^TMP($J,5.1,0)=" "
"RTN","DVBCAMI1",15,0)
 S ^TMP($J,5.3,0)="Exams returned as insufficient: "_TOT("INSUFF")_"  ("_$S(TOTRECV>0:$J(TOT("INSUFF")/TOTRECV*100,0,0),1:0)_"%)"
"RTN","DVBCAMI1",16,0)
 S ^TMP($J,6,0)="Requests returned complete: "_TOT("COMPLETED")
"RTN","DVBCAMI1",17,0)
 S ^TMP($J,7,0)="Requests returned incomplete: "_TOT("INCOMPLETE")
"RTN","DVBCAMI1",18,0)
 S ^TMP($J,8,0)=" "
"RTN","DVBCAMI1",19,0)
 S ^TMP($J,8.1,0)="Total processing time: "_TOT("DAYS")_$S(TOT("DAYS")=1:" day",1:" days")
"RTN","DVBCAMI1",20,0)
 S ^TMP($J,8.2,0)=" "
"RTN","DVBCAMI1",21,0)
 S ^TMP($J,9,0)="Pending end of month: "_TOT("PENDADJ")
"RTN","DVBCAMI1",22,0)
 S ^TMP($J,10,0)="Average processing time: "_TOT("AVGDAYS")_$S(TOT("AVGDAYS")>1!(TOT("AVGDAYS")<1):" days",1:" day")
"RTN","DVBCAMI1",23,0)
 S ^TMP($J,11,0)=" "
"RTN","DVBCAMI1",24,0)
 S ^TMP($J,12,0)="Greater than 3 days to schedule: "_TOT("3DAYSCH")
"RTN","DVBCAMI1",25,0)
 S ^TMP($J,13,0)="Greater than 30 days to examine: "_TOT("30DAYEX")
"RTN","DVBCAMI1",26,0)
 S ^TMP($J,14,0)=" "
"RTN","DVBCAMI1",27,0)
 S ^TMP($J,15,0)="Pending, 0-90 days: "_TOT("P90")
"RTN","DVBCAMI1",28,0)
 S ^TMP($J,16,0)="Pending, 91-120 days: "_TOT("P121")
"RTN","DVBCAMI1",29,0)
 S ^TMP($J,17,0)="Pending, 121-150 days: "_TOT("P151")
"RTN","DVBCAMI1",30,0)
 S ^TMP($J,18,0)="Pending, 151-180 days: "_TOT("P181")
"RTN","DVBCAMI1",31,0)
 S ^TMP($J,19,0)="Pending, 181-365 days: "_TOT("P365")
"RTN","DVBCAMI1",32,0)
 S ^TMP($J,20,0)="Pending, 366 or more days: "_TOT("P366")
"RTN","DVBCAMI1",33,0)
 S ^TMP($J,21,0)=" "
"RTN","DVBCAMI1",34,0)
 S ^TMP($J,22,0)="Transfers in from other sites: "_TOT("TRANSIN")_"  ("_$S(TOTRVTN>0:$J(TOT("TRANSIN")/TOTRVTN*100,0,0),1:0)_"%)"
"RTN","DVBCAMI1",35,0)
 S ^TMP($J,23,0)="Transfers returned to other sites: "_TOT("TRNRETTO")
"RTN","DVBCAMI1",36,0)
 S ^TMP($J,24,0)="Transfers pending return to other sites: "_TOT("TRNPNDTO")
"RTN","DVBCAMI1",37,0)
 S ^TMP($J,25,0)=" "
"RTN","DVBCAMI1",38,0)
 S ^TMP($J,26,0)="Transfers out to other sites: "_TOT("TRANSOUT")_"  ("_$S(TOTRVTN>0:$J(TOT("TRANSOUT")/TOTRVTN*100,0,0),1:0)_"%)"
"RTN","DVBCAMI1",39,0)
 S ^TMP($J,27,0)="Transfers returned from other sites: "_TOT("TRNRETFR")
"RTN","DVBCAMI1",40,0)
 S ^TMP($J,28,0)="Transfers pending return from other sites: "_TOT("TRNPNDFR")
"RTN","DVBCAMI1",41,0)
 S ^TMP($J,29,0)=" "
"RTN","DVBCAMI1",42,0)
 S ^TMP($J,32,0)=" ** Transfer figures are for information only **"
"RTN","DVBCAMI1",43,0)
 S ^TMP($J,33,0)="* and should not be used to balance this report *"
"RTN","DVBCAMI1",44,0)
 K DIC,DIE,DR,DA,TOTRECV,TOTRVTN
"RTN","DVBCAMI1",45,0)
 Q
"RTN","DVBCAMIS")
0^15^B7969924
"RTN","DVBCAMIS",1,0)
DVBCAMIS ;ALB/GTS-557/THM-2507 AMIS REPORT ;21 MAY 89@0822 ; 5/23/91  1:30 PM
"RTN","DVBCAMIS",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCAMIS",3,0)
 ;
"RTN","DVBCAMIS",4,0)
 ;** NOTICE: This routine is part of an implementation of a Nationally
"RTN","DVBCAMIS",5,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCAMIS",6,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCAMIS",7,0)
 ;
"RTN","DVBCAMIS",8,0)
SETUP S UPDATE="N",PREVMO=$P(^DVB(396.1,1,0),U,11),HD="AMIS 290 REPORT" I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCAMIS",9,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCAMIS",10,0)
 D HOME^%ZIS S FF=IOF
"RTN","DVBCAMIS",11,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ","TRANSIN","TRNRETTO","TRNPNDTO","TRANSOUT","TRNRETFR","TRNPNDFR","INSUFF" S TOT(JI)=0
"RTN","DVBCAMIS",12,0)
 F JI="RECEIVED","INCOMPLETE","DAYS","COMPLETED" S TOT(JI)=0
"RTN","DVBCAMIS",13,0)
 F JI="P90","P121","P151","P181","P365","P366" S TOT(JI)=0
"RTN","DVBCAMIS",14,0)
 ;
"RTN","DVBCAMIS",15,0)
EN W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCAMIS",16,0)
 S %DT(0)=-DT,%DT="AE",%DT("A")="Enter STARTING DATE: " D ^%DT G:Y<0 EXIT S BDATE1=Y,BDATE=Y-.1
"RTN","DVBCAMIS",17,0)
 S %DT="AE",%DT("A")="    and ENDING DATE: " D ^%DT G:Y<0 EN S EDATE1=Y,EDATE=Y+.5
"RTN","DVBCAMIS",18,0)
 I EDATE1<BDATE1 W *7,!!,"Invalid date sequence - ending date is before starting date.",!! H 3 G EN
"RTN","DVBCAMIS",19,0)
ASK0 W !!,"Please enter the total pending from the previous month: " R PREVMO:DTIME G:'$T!(PREVMO[U) EXIT I PREVMO["?" W !!,"Enter the totals for the month previous to the one you are processing." G ASK0
"RTN","DVBCAMIS",20,0)
 I PREVMO'?1.4N!(PREVMO<0) W *7,!!,"Must be a number from 0 to 9999." G ASK0
"RTN","DVBCAMIS",21,0)
 ;
"RTN","DVBCAMIS",22,0)
ASK K %DT S SBULL="Y"
"RTN","DVBCAMIS",23,0)
 W !!!,"Do you want to send a bulletin when processing is done"
"RTN","DVBCAMIS",24,0)
 S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCAMIS",25,0)
 I %=0 W !!,"Enter Y to send a bulletin to selected recipients or N not to send it at all.",!! G ASK
"RTN","DVBCAMIS",26,0)
 I %'=1 S SBULL="N"
"RTN","DVBCAMIS",27,0)
 I SBULL="Y" D BULL^DVBCAMI3
"RTN","DVBCAMIS",28,0)
 W ! S %ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCAMIS",29,0)
 I $D(IO("Q")) S ZTRTN="GO^DVBCAMI2",ZTDESC="2507 Amis Report",ZTIO=ION F I="PREVMO","RO*","BDATE*","TOT*","EDATE*","SBULL","DUZ","DVBCDT(0)","XM*" S ZTSAVE(I)=""
"RTN","DVBCAMIS",30,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 K ZTSK G EXIT
"RTN","DVBCAMIS",31,0)
 G GO^DVBCAMI2
"RTN","DVBCAMIS",32,0)
 ;
"RTN","DVBCAMIS",33,0)
EXIT K PREVMO,UPDATE G KILL^DVBCUTIL
"RTN","DVBCAMRO")
0^16^B7327338
"RTN","DVBCAMRO",1,0)
DVBCAMRO ;ALB ISC/THM-REGIONAL OFFICE 2507 AMIS REPORT ; 9/28/91  6:39 AM
"RTN","DVBCAMRO",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCAMRO",3,0)
 ;
"RTN","DVBCAMRO",4,0)
SETUP S UPDATE="N",PREVMO=$P(^DVB(396.1,1,0),U,11),HD="REGIONAL OFFICE 2507 AMIS REPORT" I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCAMRO",5,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCAMRO",6,0)
 D HOME^%ZIS S FF=IOF
"RTN","DVBCAMRO",7,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ" S TOT(JI)=0
"RTN","DVBCAMRO",8,0)
 F JI="INSUFF","SENT","INCOMPLETE","DAYS","COMPLETED" S TOT(JI)=0
"RTN","DVBCAMRO",9,0)
 F JI="P90","P121","P151","P181","P365","P366" S TOT(JI)=0
"RTN","DVBCAMRO",10,0)
 ;
"RTN","DVBCAMRO",11,0)
EN W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCAMRO",12,0)
 S %DT(0)=-DT,%DT="AE",%DT("A")="Enter STARTING DATE: " D ^%DT G:Y<0 EXIT S BDATE1=Y,BDATE=Y-.1
"RTN","DVBCAMRO",13,0)
 S %DT="AE",%DT("A")="    and ENDING DATE: " D ^%DT G:Y<0 EN S EDATE1=Y,EDATE=Y+.5
"RTN","DVBCAMRO",14,0)
 I EDATE1<BDATE1 W *7,!!,"Invalid date sequence - ending date is before starting date.",!! H 3 G EN
"RTN","DVBCAMRO",15,0)
 W !!,"When selecting regional offices you may enter individual",!,"station name or station number.",!!
"RTN","DVBCAMRO",16,0)
 S DIC("A")="Select REGIONAL OFFICE NUMBER: ",DIC(0)="AEQM",DIC="^DIC(4," D ^DIC G:X=""!(X=U) EXIT I +Y>0 S DA=+Y,RONUM=$S($D(^DIC(4,DA,99)):$P(^(99),U,1),1:"000"),RONAME=$P(Y,U,2)
"RTN","DVBCAMRO",17,0)
 I +Y<0 G EXIT
"RTN","DVBCAMRO",18,0)
 ;
"RTN","DVBCAMRO",19,0)
ASK K %DT S SBULL="Y" W !!!,"Want to send a bulletin when processing is done" S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCAMRO",20,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y to send the bulletin to selected recipients or N not to send it at all.",!! G ASK
"RTN","DVBCAMRO",21,0)
 I %'=1 S SBULL="N"
"RTN","DVBCAMRO",22,0)
 I SBULL="Y" D BULL^DVBCAMR2
"RTN","DVBCAMRO",23,0)
 W ! S %ZIS="AEQ",%ZIS("B")="0;P-OTHER",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCAMRO",24,0)
 I $D(IO("Q")) S ZTRTN="GO^DVBCAMR2",ZTDESC="2507 Amis Report",ZTIO=ION F I="UPDATE","RO*","PREVMO","BDATE*","TOT*","EDATE*","SBULL","DUZ","DVBCDT(0)","XM*" S ZTSAVE(I)=""
"RTN","DVBCAMRO",25,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 K ZTSK G EXIT
"RTN","DVBCAMRO",26,0)
 G GO^DVBCAMR2
"RTN","DVBCAMRO",27,0)
 ;
"RTN","DVBCAMRO",28,0)
EXIT K PREVMO,UPDATE G KILL^DVBCUTIL
"RTN","DVBCCHKR")
0^17^B29016651
"RTN","DVBCCHKR",1,0)
DVBCCHKR ;ALB/GTS-557/THM-CHECK C&P REQUEST FOR CRITICAL DATA ; 4/23/91  7:53 AM
"RTN","DVBCCHKR",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCCHKR",3,0)
 ;
"RTN","DVBCCHKR",4,0)
 ;** Version Changes
"RTN","DVBCCHKR",5,0)
 ; 2.7 - GTS/C&P appt links report (Enhc 13)
"RTN","DVBCCHKR",6,0)
 ;
"RTN","DVBCCHKR",7,0)
 S DVBCMAN="" G EN
"RTN","DVBCCHKR",8,0)
 ;
"RTN","DVBCCHKR",9,0)
CHECK N OLDX
"RTN","DVBCCHKR",10,0)
 S OLDX=X,DTA=^DVB(396.3,DA,0),DTB=$S($D(^DVB(396.3,DA,1)):^(1),1:"")
"RTN","DVBCCHKR",11,0)
 Q:$P(DTA,U,18)["X"  F XI=2,3,4,10,18 I $P(^DVB(396.3,DA,0),U,XI)="" S X=X_XI_U
"RTN","DVBCCHKR",12,0)
 I $P(DTB,U,4)="" S X=X_99_U
"RTN","DVBCCHKR",13,0)
 I $O(^DVB(396.4,"C",DA,0))="" S X=X_98_U ;no exams selected
"RTN","DVBCCHKR",14,0)
 S REQDA=DA,NAME=$P(^DPT(DFN,0),U,1) D:STYLEIND'="4" LINKCK
"RTN","DVBCCHKR",15,0)
 I OLDX'=X DO
"RTN","DVBCCHKR",16,0)
 .S:$E(X,$L(X))="^" X=$E(X,1,($L(X)-1))
"RTN","DVBCCHKR",17,0)
 .S X=X_";"_DA_"~"
"RTN","DVBCCHKR",18,0)
 I X]"" S ^TMP($J,NAME,DFN)=X
"RTN","DVBCCHKR",19,0)
 Q
"RTN","DVBCCHKR",20,0)
 ;
"RTN","DVBCCHKR",21,0)
PRINT D HDR S NAME=""
"RTN","DVBCCHKR",22,0)
 F XI=0:0 S NAME=$O(^TMP($J,NAME)) Q:NAME=""!($D(DVBCQUIT))  DO
"RTN","DVBCCHKR",23,0)
 .S (DVBAPC,DVBADTA)=""
"RTN","DVBCCHKR",24,0)
 .F DFN=0:0 S DFN=$O(^TMP($J,NAME,DFN)) Q:DFN=""!($D(DVBCQUIT))  DO
"RTN","DVBCCHKR",25,0)
 ..I (IOST?1"C-".E),($Y>(IOSL-9)) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",26,0)
 ..I '$D(DVBCQUIT) DO
"RTN","DVBCCHKR",27,0)
 ...D:($Y>(IOSL-9)) HDR
"RTN","DVBCCHKR",28,0)
 ...D NAMELN ;**Output name
"RTN","DVBCCHKR",29,0)
 ...F DVBAPC=1:1 S DVBADTA=$P(^TMP($J,NAME,DFN),"~",DVBAPC) Q:DVBADTA=""  DO
"RTN","DVBCCHKR",30,0)
 ....W !
"RTN","DVBCCHKR",31,0)
 ....S DTA=$P(DVBADTA,";",1),REQDA=$P(DVBADTA,";",2) ;**DVBADTA=Prob pce
"RTN","DVBCCHKR",32,0)
 ....F DVBCX=1:1 S DVBAY=$P(DTA,U,DVBCX) Q:DVBAY=""!($D(DVBCQUIT))  I DVBAY]"" D PRINT1
"RTN","DVBCCHKR",33,0)
 .K DVBAPC,DVBADTA
"RTN","DVBCCHKR",34,0)
 I '$D(DVBCQUIT)&(IOST?1"C-".E) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",35,0)
 Q
"RTN","DVBCCHKR",36,0)
 ;
"RTN","DVBCCHKR",37,0)
PRINT1 I (IOST?1"C-".E),($Y>(IOSL-2)) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",38,0)
 I '$D(DVBCQUIT) DO
"RTN","DVBCCHKR",39,0)
 .I ($Y>(IOSL-2)) D HDR,NAMELN
"RTN","DVBCCHKR",40,0)
 .W ?50,$S(DVBAY=2:"Request date",DVBAY=3:"Regional office number",DVBAY=4:"Requester",DVBAY=10:"Priority of exam",DVBAY=18:"Request status",DVBAY=99:"Routing location",1:"")
"RTN","DVBCCHKR",41,0)
 .W:DVBAY=98 ?50,"** No exams selected **"
"RTN","DVBCCHKR",42,0)
 .W:DVBAY=199 ?50,"** No C&P Appt's linked **"
"RTN","DVBCCHKR",43,0)
 .W !
"RTN","DVBCCHKR",44,0)
 Q
"RTN","DVBCCHKR",45,0)
 ;
"RTN","DVBCCHKR",46,0)
EN D HOME^%ZIS S FF=IOF
"RTN","DVBCCHKR",47,0)
 W @FF,!!,"This report will check the 2507 REQUEST file for missing crucial data.",!!,"All requests will be checked and those found missing any of the following",!,"will be reported:",!!
"RTN","DVBCCHKR",48,0)
 W "1)  Request date",!,"2)  Regional office number",!,"3)  Requester",!,"4)  Priority of exam",!
"RTN","DVBCCHKR",49,0)
 W "5)  Request status",!,"6)  Routing location",!,"7)  No exams selected"
"RTN","DVBCCHKR",50,0)
 D SETSTYLE
"RTN","DVBCCHKR",51,0)
 W:STYLEIND=4 !
"RTN","DVBCCHKR",52,0)
 W:STYLEIND'="4" !,"8)  Requests older than 3 days without C&P Appt links ",!
"RTN","DVBCCHKR",53,0)
 W ! K PARAMDA
"RTN","DVBCCHKR",54,0)
 ;
"RTN","DVBCCHKR",55,0)
ASK W "Do you want to continue" S %=2 D YN^DICN G:$D(DTOUT) EXIT
"RTN","DVBCCHKR",56,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to print the report or N to quit.",!! H 2 G ASK
"RTN","DVBCCHKR",57,0)
 I $D(%),%'=1 G EXIT
"RTN","DVBCCHKR",58,0)
 ;
"RTN","DVBCCHKR",59,0)
DEV W !! S %ZIS="AEQ" D ^%ZIS K %ZIS G:POP EXIT I $D(IO("Q")) S ZTIO=ION,ZTDESC="2507 exam integrity report",ZTRTN="GO^DVBCCHKR" F I="FF" S ZTSAVE(I)=""
"RTN","DVBCCHKR",60,0)
 I  D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! G EXIT
"RTN","DVBCCHKR",61,0)
 ;
"RTN","DVBCCHKR",62,0)
GO D:'$D(STYLEIND) SETSTYLE
"RTN","DVBCCHKR",63,0)
 K ^TMP($J),LN,DVBCQUIT,GETOUT S (ITEMS,PG)=0,$P(LN,"-",80)="-",HD="C & P Exam Integrity Report",DVBCDT=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCCHKR",64,0)
 U IO F DFN=0:0 S X="",DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F DA=0:0 S DA=$O(^DVB(396.3,"B",DFN,DA)) Q:DA=""  D CHECK
"RTN","DVBCCHKR",65,0)
 I '$D(^TMP($J)) D HDR W !!!!!?25,"Nothing found to report",!!
"RTN","DVBCCHKR",66,0)
 I $D(^TMP($J)) D PRINT
"RTN","DVBCCHKR",67,0)
 I ('$D(^TMP("DVBA",$J))&((+STYLEIND'="4")&(+$$RPTCHK=1))) DO
"RTN","DVBCCHKR",68,0)
 .D NOW^%DTC S Y=X X ^DD("DD")
"RTN","DVBCCHKR",69,0)
 .S TODAYDT=Y K Y,X
"RTN","DVBCCHKR",70,0)
 .S SITE=$$SITE^DVBCUTL4
"RTN","DVBCCHKR",71,0)
 .D RPTHD^DVBCULAP W !!!!!?25,"Nothing found to report",!!
"RTN","DVBCCHKR",72,0)
 .I (IOST?1"C-".E) D PAUSE^DVBCUTL4
"RTN","DVBCCHKR",73,0)
 .K TODAYDT,SITE
"RTN","DVBCCHKR",74,0)
 I $D(^TMP("DVBA",$J)) D:(+$$RPTCHK=1) ^DVBCULAP
"RTN","DVBCCHKR",75,0)
 ;
"RTN","DVBCCHKR",76,0)
EXIT D ^%ZISC
"RTN","DVBCCHKR",77,0)
 W:'$D(ZTQUEUED) @FF,!!!
"RTN","DVBCCHKR",78,0)
 I $D(ZTQUEUED)&($D(DVBCMAN)) D KILL^%ZTLOAD
"RTN","DVBCCHKR",79,0)
 K %,%Y,DTA,DTB,DTOUT,DVBCDT,FF,HD,NAME,PG,I,ZTSAVE,POP,X,XI,Y,ZTDESC,ZTIO,ZTRTN,ZTSK,ITEMS,PRINT,DFN,DA,LN,DVBCMAN,DVBCQUIT,GETOUT,DVBCX,HDRPRT
"RTN","DVBCCHKR",80,0)
 K ^TMP("DVBA",$J),^TMP($J),REQDA,STYLEIND,DVBAY,DIQ,DIR,DIRUT,DUOUT
"RTN","DVBCCHKR",81,0)
 K DR,DIC
"RTN","DVBCCHKR",82,0)
 Q
"RTN","DVBCCHKR",83,0)
 ;
"RTN","DVBCCHKR",84,0)
HDR S PG=PG+1,HDRPRT="" W @IOF
"RTN","DVBCCHKR",85,0)
 W !,DVBCDT,?(80-$L(HD)\2),HD,?69,"Page: ",PG,!,?(80-$L($$SITE^DVBCUTL4)\2),$$SITE^DVBCUTL4,!!,"Veteran name",?28,"Social Sec #",?50,"Missing items",!
"RTN","DVBCCHKR",86,0)
 Q
"RTN","DVBCCHKR",87,0)
 ;
"RTN","DVBCCHKR",88,0)
LINKCK ;** Patient DFN's w/ 2507's >3 days w/out links
"RTN","DVBCCHKR",89,0)
 ;** Called - 2507 C&P INTEG RPT'=OFF
"RTN","DVBCCHKR",90,0)
 ;** $D(DVBAFND) - 2507 >3 days old w/out links
"RTN","DVBCCHKR",91,0)
 N DVBAX,DVBADAYS
"RTN","DVBCCHKR",92,0)
 S:'$D(X) X=""
"RTN","DVBCCHKR",93,0)
 S DVBAX=X ;**Save X (prob report var)
"RTN","DVBCCHKR",94,0)
 I +$$STYLE^DVBCUTL8(REQDA)=1 DO
"RTN","DVBCCHKR",95,0)
 .K X,X1,X2
"RTN","DVBCCHKR",96,0)
 .D NOW^%DTC
"RTN","DVBCCHKR",97,0)
 .S X2=($P(^DVB(396.3,REQDA,0),U,5)\1),X1=X\1
"RTN","DVBCCHKR",98,0)
 .K X D ^%DTC
"RTN","DVBCCHKR",99,0)
 .S DVBADAYS=X K X
"RTN","DVBCCHKR",100,0)
 .S X=DVBAX ;**Reset X (prob var)
"RTN","DVBCCHKR",101,0)
 .I +DVBADAYS>3 DO  ;**2507 >3 days old, check links
"RTN","DVBCCHKR",102,0)
 ..N APPTDA S APPTDA=""
"RTN","DVBCCHKR",103,0)
 ..K DVBAFND
"RTN","DVBCCHKR",104,0)
 ..I +$O(^DVB(396.95,"AR",REQDA,APPTDA))'>0 DO
"RTN","DVBCCHKR",105,0)
 ...S:$$TRANCHK^DVBCUTA4(REQDA)=0 DVBAFND="" ;**2507 w/out links
"RTN","DVBCCHKR",106,0)
 ..I $D(DVBAFND) DO  ;**Unlinked 2507 >3 days old
"RTN","DVBCCHKR",107,0)
 ...S:(+$$RPTCHK=1) ^TMP("DVBA",$J,NAME,DFN)="" ;**TMP("DVBA") - unlinked 2507's
"RTN","DVBCCHKR",108,0)
 ...S X=X_"199^"
"RTN","DVBCCHKR",109,0)
 K DVBAFND
"RTN","DVBCCHKR",110,0)
 Q
"RTN","DVBCCHKR",111,0)
 ;
"RTN","DVBCCHKR",112,0)
RPTCHK() ;**Check C&P Report Param field - 396.1
"RTN","DVBCCHKR",113,0)
 N PARAMDA,PARAMVAL S PARAMDA=0
"RTN","DVBCCHKR",114,0)
 S PARAMDA=$O(^DVB(396.1,PARAMDA))
"RTN","DVBCCHKR",115,0)
 S PARAMVAL=$P(^DVB(396.1,PARAMDA,0),U,19)
"RTN","DVBCCHKR",116,0)
 Q PARAMVAL
"RTN","DVBCCHKR",117,0)
 ;
"RTN","DVBCCHKR",118,0)
NAMELN W LN,!!,NAME,?28,$P(^DPT(DFN,0),U,9)
"RTN","DVBCCHKR",119,0)
 Q
"RTN","DVBCCHKR",120,0)
 ;
"RTN","DVBCCHKR",121,0)
SETSTYLE ;
"RTN","DVBCCHKR",122,0)
 S PARAMDA=0
"RTN","DVBCCHKR",123,0)
 S PARAMDA=$O(^DVB(396.1,PARAMDA))
"RTN","DVBCCHKR",124,0)
 S STYLEIND=$P(^DVB(396.1,PARAMDA,0),U,15)
"RTN","DVBCCHKR",125,0)
 Q
"RTN","DVBCENQ1")
0^18^B23767998
"RTN","DVBCENQ1",1,0)
DVBCENQ1 ;ALB/GTS-557/THM 2507 INQUIRY DISPLAY ; 5/25/91  1:52 PM
"RTN","DVBCENQ1",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCENQ1",3,0)
 ;
"RTN","DVBCENQ1",4,0)
 G START
"RTN","DVBCENQ1",5,0)
CON K OUT I IOST?1"C-".E W !,"Press [RETURN] to continue or ""^"" to stop   " R ANS:DTIME S:ANS=U!('$T) OUT=1 Q:$D(OUT)  D HDR
"RTN","DVBCENQ1",6,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBCENQ1",7,0)
 Q
"RTN","DVBCENQ1",8,0)
 ;
"RTN","DVBCENQ1",9,0)
START S PGHD="COMPENSATION AND PENSION EXAM INQUIRY",PG=0
"RTN","DVBCENQ1",10,0)
 D HDR
"RTN","DVBCENQ1",11,0)
 W !!?2,"Name: ",PNAM,?56,"SSN: ",SSN,!?51,"C-Number: ",CNUM,!?56,"DOB: " S Y=DOB X ^DD("DD") W Y,!?2,"Address: ",ADR1,! W:ADR2]"" ?11,ADR2,! W:ADR3]"" ?11,ADR3,!!
"RTN","DVBCENQ1",12,0)
 W !?2,"City,State,Zip+4: ",?48,"Res Phone: ",HOMPHON,!?5,CITY,"  ",STATE,"  ",ZIP,?48,"Bus Phone: ",BUSPHON,!
"RTN","DVBCENQ1",13,0)
 S EDTA=$S($D(^DPT(DFN,.32)):^(.32),1:""),EOD=$P(EDTA,U,6),RAD=$P(EDTA,U,7)
"RTN","DVBCENQ1",14,0)
 W !,"Entered active service: " S Y=EOD X ^DD("DD") S:Y="" Y="Not specified" W Y,! S Y=RAD X ^DD("DD") S:Y="" Y="Not specified" W "Released active service: " W Y,!
"RTN","DVBCENQ1",15,0)
 F LINE=1:1:80 W "="
"RTN","DVBCENQ1",16,0)
 W !! D CON Q:$D(OUT)  D ^DVBCENQ2,CON Q:$D(OUT)  D ^DVBCEEXM,CON Q:$D(OUT)  S REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBCENQ1",17,0)
 W !,"This request was initiated on " S Y=REQDT X ^DD("DD") W $P(Y,"@",1)," at ",$P(Y,"@",2),!!?17,"Requester: ",REQN,!,"Requesting Regional Office: ",RONAME,!
"RTN","DVBCENQ1",18,0)
 I $D(^DVB(396.4,"C",REQDA)) W !?3,"Exams on this request: " D TST^DVBCUTL2 W !
"RTN","DVBCENQ1",19,0)
 I '$D(^DVB(396.4,"C",REQDA)) W !?3,"(No exams have yet been entered)",!
"RTN","DVBCENQ1",20,0)
 W !,"** Status of request: " S (XSTAT,STAT)=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBCENQ1",21,0)
 S STAT=$S(XSTAT="N":"New",XSTAT="P":"Pending, reported to MAS",XSTAT="T":"Transcribed",XSTAT="S":"Scheduled",XSTAT="R":"Released, not printed",XSTAT="C":"Completed",XSTAT="CT":"Completed, transferred out",XSTAT="NT":"New, transferred in",1:"")
"RTN","DVBCENQ1",22,0)
 I STAT]"" W STAT
"RTN","DVBCENQ1",23,0)
 I XSTAT="R"!(XSTAT="C") W !!?9,"Released on " S Y=$P(^DVB(396.3,REQDA,0),U,14) X ^DD("DD") W Y," by " S RELBY=$P(^DVB(396.3,REQDA,0),U,15),RELBY=$S($D(^VA(200,+RELBY,0)):$P(^(0),U,1),1:"Unknown user") W RELBY,!
"RTN","DVBCENQ1",24,0)
 I XSTAT="C" W "Printed by the RO on " S Y=$P(^DVB(396.3,REQDA,0),U,16) X ^DD("DD") W Y," by " S PRBY=$P(^DVB(396.3,REQDA,0),U,17),PRBY=$S($D(^VA(200,+PRBY,0)):$P(^(0),U,1),1:"Unknown user") W PRBY,!
"RTN","DVBCENQ1",25,0)
 I STAT="" S STAT=$S(XSTAT="X":"Cancelled by MAS",XSTAT="RX":"Cancelled by RO",1:"Unknown") W STAT I STAT["Cancelled" W "  (Cancelled on " S CANDT=$P(^DVB(396.3,REQDA,0),U,19) W $$FMTE^XLFDT(CANDT,"5DZ"),")"
"RTN","DVBCENQ1",26,0)
 ;S X=$S($D(^DVB(396.3,REQDA,4)):$P(^(4),U,1),1:"") I X="y" W !,"Exam(s) transferred to another site -- see pending report.",!
"RTN","DVBCENQ1",27,0)
 I $D(^DVB(396.3,REQDA,1)),$P(^(1),U,3)="Y" W !,"This request was faxed to the regional office.",!
"RTN","DVBCENQ1",28,0)
 S FEXAM=$P(^DVB(396.3,REQDA,0),U,9) I FEXAM="Y" W !!,"*** Exams done on a FEE BASIS ***  ",! K FEXAM
"RTN","DVBCENQ1",29,0)
 W ! F LINE=1:1:79 W "-"
"RTN","DVBCENQ1",30,0)
 W ! D DDIS Q:$D(OUT)  D CON Q:$D(OUT)
"RTN","DVBCENQ1",31,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBCENQ1",32,0)
 W !!,"Other Disabilities:",!!?2,OTHDIS,! I $D(^DVB(396.3,REQDA,1)) W ?2,OTHDIS1,!?2,OTHDIS2
"RTN","DVBCENQ1",33,0)
 W !!,"General Remarks:",!!
"RTN","DVBCENQ1",34,0)
 K ^UTILITY($J,"W")
"RTN","DVBCENQ1",35,0)
 F LINE=0:0 S LINE=$O(^DVB(396.3,REQDA,2,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP I IOST?1"C-".E,$Y>19 D CON W !!,"General Remarks, continued",!!!
"RTN","DVBCENQ1",36,0)
 D ^DIWW
"RTN","DVBCENQ1",37,0)
END K ANS I IOST?1"C-".E W !!,"Press [RETURN] to continue or ""^"" to stop   " R ANS:DTIME S:'$T!(ANS=U) OUT=1 I $D(OUT) Q:OUT=1
"RTN","DVBCENQ1",38,0)
 Q
"RTN","DVBCENQ1",39,0)
 ;
"RTN","DVBCENQ1",40,0)
DDIS1 W ?2,DX,?37,$J(PCT,3,0)," %",?50,$S(SC=1:"Yes",1:"No"),?58,DXCOD,!
"RTN","DVBCENQ1",41,0)
 I $Y>19 D CON
"RTN","DVBCENQ1",42,0)
 Q
"RTN","DVBCENQ1",43,0)
 ;
"RTN","DVBCENQ1",44,0)
DDIS I $Y>12 D CON Q:$D(OUT)
"RTN","DVBCENQ1",45,0)
 I '$D(^DPT(DFN,.372)) W !?25,"No rated disabilities on file",!! Q
"RTN","DVBCENQ1",46,0)
 W !?2,"Rated Disability",?37,"Percent",?50,"SC ?",?58,"Dx Code",! W ?2 F LINE=1:1:63 W "-"
"RTN","DVBCENQ1",47,0)
 W !!
"RTN","DVBCENQ1",48,0)
 F JII=0:0 S JII=$O(^DPT(DFN,.372,JII)) Q:JII=""  S DXNUM=$P(^DPT(DFN,.372,JII,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBCENQ1",49,0)
 W !!
"RTN","DVBCENQ1",50,0)
 Q
"RTN","DVBCENQ1",51,0)
 ;
"RTN","DVBCENQ1",52,0)
HDR S PG=PG+1 W:(IOST?1"C-".E) @IOF
"RTN","DVBCENQ1",53,0)
 W !,"Date: ",FDT(0),?(80-$L(PGHD)\2),PGHD,?71,"Page: ",PG W !,?(80-$L($$SITE^DVBCUTL4)\2),$$SITE^DVBCUTL4 I PG>1 W !!,"Name: ",PNAM,?44,"SSN: ",SSN,?63,"C-NUM: ",CNUM
"RTN","DVBCENQ1",54,0)
 W ! F XLINE=1:1:80 W "="
"RTN","DVBCENQ1",55,0)
 W ! Q
"RTN","DVBCENQ2")
0^19^B6809858
"RTN","DVBCENQ2",1,0)
DVBCENQ2 ;ALB ISC/THM-DISPLAY C&P APPOINTMENTS ; 8/13/90  7:02 AM
"RTN","DVBCENQ2",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCENQ2",3,0)
 ;
"RTN","DVBCENQ2",4,0)
 S DVBCLNE=" >>> Future C&P Appointments <<<" W ! D HDR
"RTN","DVBCENQ2",5,0)
 ;
"RTN","DVBCENQ2",6,0)
FA S CT=0 W ! I $O(^DPT(DFN,"S",DT-.1))="" W !!?23,"No future C & P appointments found.",!! G EXIT
"RTN","DVBCENQ2",7,0)
 K PRT F FA=DT-.1:0 S FA=$O(^DPT(DFN,"S",FA)) Q:FA=""  S L=^(FA,0),C=+L S YY=$P(L,U,2) I YY'="N"&(YY'="C")&(YY'="NA")&(YY'="CA")&(YY'="PC")&(YY'="PCA") D FA1
"RTN","DVBCENQ2",8,0)
 W:'$D(PRT) !!?23,"No future C&P appointments found.",!! G EXIT
"RTN","DVBCENQ2",9,0)
 ;
"RTN","DVBCENQ2",10,0)
FA1 S DVBCX=$P(^DPT(DFN,"S",FA,0),U,16) I $D(^SD(409.1,+DVBCX,0)) Q:$P(^(0),U,1)'["COMPENSATION"  ;compensation and pension exams only
"RTN","DVBCENQ2",11,0)
 W !?0,$$FMTE^XLFDT(FA,"5DZ"),?9,$J(+$E(FA_"00",9,10)_":"_$E(FA_"0000",11,12),6),?18,$E($P($S($D(^SC(C,0)):^(0),1:""),"^"),1,21),"  " D CAL S PRT=1
"RTN","DVBCENQ2",12,0)
 Q
"RTN","DVBCENQ2",13,0)
 ;
"RTN","DVBCENQ2",14,0)
EXIT K YY,CT,FA,L,C,DVBCX,DATE,DVBCLNE W !!! Q
"RTN","DVBCENQ2",15,0)
 ;
"RTN","DVBCENQ2",16,0)
CONT I IOST?1"C-".E W !!,"Press [RETURN] to continue  " R ANS:DTIME
"RTN","DVBCENQ2",17,0)
 Q
"RTN","DVBCENQ2",18,0)
 ;
"RTN","DVBCENQ2",19,0)
HDR W ?(80-$L(DVBCLNE)\2),DVBCLNE,!!?0,"Date",?12,"Time",?18,"Clinic",?43,"  Lab",?56,"  X-Ray",?69,"  EKG",!?0 F I=0:1:79 W "-"
"RTN","DVBCENQ2",20,0)
 Q
"RTN","DVBCENQ2",21,0)
 ;
"RTN","DVBCENQ2",22,0)
CAL F J=3:1:5 I $P(L,U,J)]"" S DATE(J)=$E($P(L,U,J),4,7),DATE(J)=$E(DATE(J),1,2)_"/"_$E(DATE(J),3,4)_" ",TIME(J)=$P($P(L,U,J),".",2) D CAL1
"RTN","DVBCENQ2",23,0)
 Q
"RTN","DVBCENQ2",24,0)
 ;
"RTN","DVBCENQ2",25,0)
CAL1 S:TIME(J)=1 TIME(J)=10 S TIME(J)=$S($L(TIME(J))=2:TIME(J)_"00",$L(TIME(J))=3:TIME(J)_"0",1:TIME(J)),DATE(J)=DATE(J)_TIME(J)
"RTN","DVBCENQ2",26,0)
 I $D(DATE(3)) S DATE(3)=$E(DATE(3),1,6)_$E(DATE(3),7,8)_":"_$E(DATE(3),9,10) W:$D(DATE(3)) ?42,DATE(3)
"RTN","DVBCENQ2",27,0)
 I $D(DATE(4)) S DATE(4)=$E(DATE(4),1,6)_$E(DATE(4),7,8)_":"_$E(DATE(4),9,10) W:$D(DATE(4)) ?55,DATE(4)
"RTN","DVBCENQ2",28,0)
 I $D(DATE(5)) S DATE(5)=$E(DATE(5),1,6)_$E(DATE(5),7,8)_":"_$E(DATE(5),9,10) W:$D(DATE(5)) ?68,DATE(5)
"RTN","DVBCENQ2",29,0)
 I IOST?1"C-".E,$Y>18 D CONT,HDR
"RTN","DVBCENQ2",30,0)
 I IOST?1"P-".E,$Y>45 D HDR
"RTN","DVBCENQ2",31,0)
 K DATE,CONT
"RTN","DVBCENQ2",32,0)
 Q
"RTN","DVBCIUTL")
0^20^B18899717
"RTN","DVBCIUTL",1,0)
DVBCIUTL ;ALB/GTS-AMIE INSUFFICIENT RPT UTILITY RTN ; 11/14/94  9:15 AM
"RTN","DVBCIUTL",2,0)
 ;;2.7;AMIE;**13,17**;Apr 10, 1995
"RTN","DVBCIUTL",3,0)
 ;
"RTN","DVBCIUTL",4,0)
 ;** Version Changes
"RTN","DVBCIUTL",5,0)
 ;   2.7 - New routine (Enhc 15)
"RTN","DVBCIUTL",6,0)
 ;
"RTN","DVBCIUTL",7,0)
DETHD ;** Detailed Report header
"RTN","DVBCIUTL",8,0)
 S:'$D(DVBAPG1) TVAR(1,0)="0,15,0,1,0^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",9,0)
 S:$D(DVBAPG1) TVAR(1,0)="0,15,0,1,1^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",10,0)
 S TVAR(2,0)="0,11,0,2,0^For Date Range: "_STRTDT_" to "_LSTDT
"RTN","DVBCIUTL",11,0)
 D WR^DVBAUTL4("TVAR")
"RTN","DVBCIUTL",12,0)
 K TVAR
"RTN","DVBCIUTL",13,0)
 Q
"RTN","DVBCIUTL",14,0)
 ;
"RTN","DVBCIUTL",15,0)
EXMOUT ;** Output exam information for reason/type
"RTN","DVBCIUTL",16,0)
 I $Y>(IOSL-9) DO
"RTN","DVBCIUTL",17,0)
 .I IOST?1"C-".E D TERM^DVBCUTL3
"RTN","DVBCIUTL",18,0)
 .I '$D(GETOUT) DO
"RTN","DVBCIUTL",19,0)
 ..D DETHD
"RTN","DVBCIUTL",20,0)
 ..D RESOUT
"RTN","DVBCIUTL",21,0)
 ..W !
"RTN","DVBCIUTL",22,0)
 ..D TYPEOUT
"RTN","DVBCIUTL",23,0)
 ..S (DVBARSPT,DVBAXMPT)=""
"RTN","DVBCIUTL",24,0)
 I '$D(GETOUT) DO
"RTN","DVBCIUTL",25,0)
 .I '$D(DVBARSPT) DO
"RTN","DVBCIUTL",26,0)
 ..D RESOUT
"RTN","DVBCIUTL",27,0)
 ..S DVBARSPT=""
"RTN","DVBCIUTL",28,0)
 .I '$D(DVBAXMPT) DO
"RTN","DVBCIUTL",29,0)
 ..W !
"RTN","DVBCIUTL",30,0)
 ..D TYPEOUT
"RTN","DVBCIUTL",31,0)
 ..S DVBAXMPT=""
"RTN","DVBCIUTL",32,0)
 .S REQDA=$P(^DVB(396.4,XMDA,0),U,2) ;*REQDA of PRIORITY Insuf 2507
"RTN","DVBCIUTL",33,0)
 .I +REQDA>0 DO  ;*Get REQDA of Orig 2507
"RTN","DVBCIUTL",34,0)
 ..S DFN=$P(^DVB(396.3,REQDA,0),U,1)
"RTN","DVBCIUTL",35,0)
 ..I '$D(^DVB(396.3,REQDA,5)) S REQDA=""
"RTN","DVBCIUTL",36,0)
 ..I +REQDA>0,($D(^DVB(396.3,REQDA,5))) S REQDA=$P(^DVB(396.3,REQDA,5),U,1)
"RTN","DVBCIUTL",37,0)
 .S DVBAORXM=""
"RTN","DVBCIUTL",38,0)
 .I +REQDA>0 DO  ;*If link to orig 2507
"RTN","DVBCIUTL",39,0)
 ..S DVBAXMTP=$P(^DVB(396.4,XMDA,0),U,3)
"RTN","DVBCIUTL",40,0)
 ..S DVBACMND="F  S DVBAORXM=$O(^DVB(396.4,""ARQ"_REQDA_""","_DVBAXMTP_",DVBAORXM)) Q:DVBAORXM=""""  Q:$D(^DVB(396.4,""APS"","_DFN_","_DVBAXMTP_",""C"",DVBAORXM))"
"RTN","DVBCIUTL",41,0)
 ..X DVBACMND ;**Return DA of original, insuff exam
"RTN","DVBCIUTL",42,0)
 .S DVBANAME=$P(^DPT(DFN,0),U,1)
"RTN","DVBCIUTL",43,0)
 .S DVBASSN=$P(^DPT(DFN,0),U,9)
"RTN","DVBCIUTL",44,0)
 .S DVBACNUM="" S:$D(^DPT(DFN,.31)) DVBACNUM=$P(^DPT(DFN,.31),U,3)
"RTN","DVBCIUTL",45,0)
 .I DVBAORXM'="",($D(^DVB(396.4,DVBAORXM,0))) S DVBAORDT=$P(^DVB(396.4,DVBAORXM,0),U,6)
"RTN","DVBCIUTL",46,0)
 .I DVBAORXM'="",('$D(^DVB(396.4,DVBAORXM,0))) S (DVBAORDT,DVBADTE)=""
"RTN","DVBCIUTL",47,0)
 .S:DVBAORXM="" (DVBAORDT,DVBADTE)=""
"RTN","DVBCIUTL",48,0)
 .I DVBAORDT'="" DO
"RTN","DVBCIUTL",49,0)
 ..S DVBADTWK=$P(DVBAORDT,".",1)
"RTN","DVBCIUTL",50,0)
 ..S DVBADTE=$$FMTE^XLFDT(DVBADTWK,"5DZ")
"RTN","DVBCIUTL",51,0)
 .S DVBAORPV=$P(^DVB(396.4,XMDA,0),U,12)
"RTN","DVBCIUTL",52,0)
 .S DVBAORP1=$E(DVBAORPV,1,15)
"RTN","DVBCIUTL",53,0)
 .S DVBANAM1=$E(DVBANAME,1,15)
"RTN","DVBCIUTL",54,0)
 .W !,DVBAORP1
"RTN","DVBCIUTL",55,0)
 .W:$L(DVBAORPV)>$L(DVBAORP1) "**" ;**Indicate that Dr.'s Name truncated
"RTN","DVBCIUTL",56,0)
 .W ?20,DVBADTE,?32,DVBANAM1
"RTN","DVBCIUTL",57,0)
 .W:$L(DVBANAME)>$L(DVBANAM1) "**" ;**Indicate that Vet's Name truncated
"RTN","DVBCIUTL",58,0)
 .W ?52,DVBASSN,?66,DVBACNUM
"RTN","DVBCIUTL",59,0)
 Q
"RTN","DVBCIUTL",60,0)
 ;
"RTN","DVBCIUTL",61,0)
RESOUT ;** Output the Reason
"RTN","DVBCIUTL",62,0)
 W !!!!!,"Reason: ",$P(^DVB(396.94,$P(^DVB(396.4,XMDA,0),U,11),0),U,3)
"RTN","DVBCIUTL",63,0)
 Q
"RTN","DVBCIUTL",64,0)
 ;
"RTN","DVBCIUTL",65,0)
TYPEOUT ;** Output the Exam
"RTN","DVBCIUTL",66,0)
 W !,"Exam: ",$P(^DVB(396.6,$P(^DVB(396.4,XMDA,0),U,3),0),U,2)
"RTN","DVBCIUTL",67,0)
 W !,"Provider",?20,"Exam Dt",?32,"Patient Name",?52,"SSN",?66,"Claim #"
"RTN","DVBCIUTL",68,0)
 Q
"RTN","DVBCIUTL",69,0)
 ;
"RTN","DVBCIUTL",70,0)
RSEL ;** Select Reasons
"RTN","DVBCIUTL",71,0)
 ;** The selection prompt is defaulted to ALL.  If the user selects
"RTN","DVBCIUTL",72,0)
 ;**  'All', only reasons for exams entered on requests with a
"RTN","DVBCIUTL",73,0)
 ;**  priority of 'Insufficient' will be reported.  Not all reasons.
"RTN","DVBCIUTL",74,0)
 ;
"RTN","DVBCIUTL",75,0)
 W @IOF,!
"RTN","DVBCIUTL",76,0)
 W !,"Insufficient Reason Selection"
"RTN","DVBCIUTL",77,0)
 S DVBCYQ=""
"RTN","DVBCIUTL",78,0)
 N RESANS,DVBAOUT S DVBAOUT="" ;**Pre-read
"RTN","DVBCIUTL",79,0)
 K Y,DTOUT,DUOUT,DVBATSAV
"RTN","DVBCIUTL",80,0)
 F  Q:(DVBAOUT=1!(DVBCYQ=1))  DO
"RTN","DVBCIUTL",81,0)
 .W !!,"  Enter '^' to end Reason Selection"
"RTN","DVBCIUTL",82,0)
 .W !,"  'Return' to select all Insufficient Reasons",!
"RTN","DVBCIUTL",83,0)
 .K DIC,DTOUT,DUOUT,Y
"RTN","DVBCIUTL",84,0)
 .W !,"  Enter Insufficient Reason: ALL//"
"RTN","DVBCIUTL",85,0)
 .R RESANS:DTIME
"RTN","DVBCIUTL",86,0)
 .S:$T DVBATSAV=""
"RTN","DVBCIUTL",87,0)
 .I RESANS=""&($D(DVBATSAV)) S Y=-1 D INREAS^DVBCIUT1
"RTN","DVBCIUTL",88,0)
 .S:('$D(DVBATSAV)!(RESANS["^")) DVBAOUT="1"
"RTN","DVBCIUTL",89,0)
 .I DVBAOUT'=1,('$D(Y)) DO
"RTN","DVBCIUTL",90,0)
 ..I RESANS["?" DO
"RTN","DVBCIUTL",91,0)
 ...N LPDA S LPDA=0
"RTN","DVBCIUTL",92,0)
 ...W !,"CHOOSE FROM:"
"RTN","DVBCIUTL",93,0)
 ...F  S LPDA=$O(^DVB(396.94,LPDA)) Q:+LPDA'>0  DO
"RTN","DVBCIUTL",94,0)
 ....W !,?3,$P(^DVB(396.94,LPDA,0),U,1)
"RTN","DVBCIUTL",95,0)
 ...W !
"RTN","DVBCIUTL",96,0)
 ..I RESANS'["?" DO
"RTN","DVBCIUTL",97,0)
 ...S DIC="^DVB(396.94,"
"RTN","DVBCIUTL",98,0)
 ...S DIC(0)="EMQ"
"RTN","DVBCIUTL",99,0)
 ...S X=RESANS
"RTN","DVBCIUTL",100,0)
 ...D ^DIC
"RTN","DVBCIUTL",101,0)
 ...D:+Y>0 INREAS^DVBCIUT1
"RTN","DVBCIUTL",102,0)
 .I RESANS="",($D(Y)&(+Y=-1)) S DVBCYQ=1
"RTN","DVBCIUTL",103,0)
 K DTOUT,DUOUT,Y,DIC,DVBCYQ,DVBATSAV
"RTN","DVBCIUTL",104,0)
 Q
"RTN","DVBCIUTL",105,0)
 ;
"RTN","DVBCIUTL",106,0)
XMSEL ;** Select Exams
"RTN","DVBCIUTL",107,0)
 ;** The selection prompt is defaulted to ALL.  If the user selects
"RTN","DVBCIUTL",108,0)
 ;**  'All', only exams entered on requests with a priority of 
"RTN","DVBCIUTL",109,0)
 ;**  'Insufficient' will be reported.  Not all exams.
"RTN","DVBCIUTL",110,0)
 ;
"RTN","DVBCIUTL",111,0)
 W @IOF,!
"RTN","DVBCIUTL",112,0)
 W !,"AMIE Exam Selection"
"RTN","DVBCIUTL",113,0)
 S DVBCYQ=""
"RTN","DVBCIUTL",114,0)
 K Y,DTOUT,DUOUT
"RTN","DVBCIUTL",115,0)
 F  Q:($D(DTOUT)!($D(DUOUT)!(DVBCYQ=1)))  DO
"RTN","DVBCIUTL",116,0)
 .W !!,"  Enter '^' to end Exam Selection"
"RTN","DVBCIUTL",117,0)
 .W !,"  'Return' to select all AMIE Exams",!
"RTN","DVBCIUTL",118,0)
 .K DIC,DTOUT,DUOUT
"RTN","DVBCIUTL",119,0)
 .S DIC="^DVB(396.6,"
"RTN","DVBCIUTL",120,0)
 .S DIC(0)="AEMQ"
"RTN","DVBCIUTL",121,0)
 .S DIC("A")="  Enter Exam: ALL//"
"RTN","DVBCIUTL",122,0)
 .;removed screen for inactive exams
"RTN","DVBCIUTL",123,0)
 .D ^DIC
"RTN","DVBCIUTL",124,0)
 .I '$D(DTOUT),('$D(DUOUT)) D EXMTPE^DVBCIUT1
"RTN","DVBCIUTL",125,0)
 .I $D(Y),(+Y=-1) S DVBCYQ=1
"RTN","DVBCIUTL",126,0)
 K DTOUT,DUOUT,Y,DIC,DVBCYQ
"RTN","DVBCIUTL",127,0)
 Q
"RTN","DVBCMKL2")
0^21^B22184716
"RTN","DVBCMKL2",1,0)
DVBCMKL2 ;ALB/GTS-AMIE APPT EVENT DRIVER-LINK RTN 2 ; 10/20/94  9:00 PM
"RTN","DVBCMKL2",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCMKL2",3,0)
 ;
"RTN","DVBCMKL2",4,0)
 ;** NOTICE: This routine is part of an implementation of a Nationally
"RTN","DVBCMKL2",5,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCMKL2",6,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCMKL2",7,0)
 ;
"RTN","DVBCMKL2",8,0)
 ;** Version Changes
"RTN","DVBCMKL2",9,0)
 ;   2.7 - New routine (Enhc 13)
"RTN","DVBCMKL2",10,0)
 ;
"RTN","DVBCMKL2",11,0)
LINKAPPT ;** Link C&P appt to 2507
"RTN","DVBCMKL2",12,0)
 ;** Enhanced mode On - user prompted with checks
"RTN","DVBCMKL2",13,0)
 ;** Enhanced mode Off - appointment added as new link
"RTN","DVBCMKL2",14,0)
 I $D(^DVB(396.95,"AR",DVBADA)),(+$$ENHNC^DVBCUTA4=1) DO
"RTN","DVBCMKL2",15,0)
 .S DIR("A",1)=" "
"RTN","DVBCMKL2",16,0)
 .S DIR("A",2)="This 2507 already has appointments."
"RTN","DVBCMKL2",17,0)
 .S DIR("A",3)="    Enter '?' for help"
"RTN","DVBCMKL2",18,0)
 .S DIR("A")="Is this appointment due to a cancellation? "
"RTN","DVBCMKL2",19,0)
 .S DIR("?",1)="Enter NO if the appointment is not a reschedule of another appointment"
"RTN","DVBCMKL2",20,0)
 .S DIR("?",2)=" made previously.  Enter YES if the appointment is being scheduled because"
"RTN","DVBCMKL2",21,0)
 .S DIR("?")=" an appointment has been or will be canceled."
"RTN","DVBCMKL2",22,0)
 .S DIR(0)="YA^^"
"RTN","DVBCMKL2",23,0)
 .S DIR("B")="NO"
"RTN","DVBCMKL2",24,0)
 .S Y=""
"RTN","DVBCMKL2",25,0)
 .F  Q:(Y=1!(Y=0)!($D(DTOUT)))  DO
"RTN","DVBCMKL2",26,0)
 ..D ^DIR
"RTN","DVBCMKL2",27,0)
 ..W:Y="^" *7,"  '^' NOT ALLOWED"
"RTN","DVBCMKL2",28,0)
 .S DVBAYANS=+Y
"RTN","DVBCMKL2",29,0)
 .K DIR,Y
"RTN","DVBCMKL2",30,0)
 .I +DVBAYANS=1 DO  ;**Appt link selection
"RTN","DVBCMKL2",31,0)
 ..S DVBALKRC=$$SELLNK^DVBCUTL8(DVBADA)
"RTN","DVBCMKL2",32,0)
 ..I +DVBALKRC'>0 DO  ;**Appt not selected for reschedule
"RTN","DVBCMKL2",33,0)
 ...S DIR("A",1)=" "
"RTN","DVBCMKL2",34,0)
 ...S DIR("A",2)="You have not selected the linked appointment being rescheduled.  You may"
"RTN","DVBCMKL2",35,0)
 ...S DIR("A",3)=" need to adjust the link to the appointment with the AMIE link"
"RTN","DVBCMKL2",36,0)
 ...S DIR("A",4)=" management option to ensure proper processing time calculation for this 2507."
"RTN","DVBCMKL2",37,0)
 ...S DIR("A",5)=" "
"RTN","DVBCMKL2",38,0)
 ...S DIR(0)="FAO^1:1",DIR("A")="Hit any key to continue." D ^DIR K DIR,X,Y
"RTN","DVBCMKL2",39,0)
 ..I +DVBALKRC>0 DO  ;**Appt selected for reschedule
"RTN","DVBCMKL2",40,0)
 ...I +$P(^DVB(396.95,DVBALKRC,0),U,4)'=1!($P(^DVB(396.95,DVBALKRC,0),U,5)'="") DO
"RTN","DVBCMKL2",41,0)
 ....K DIR,X,Y
"RTN","DVBCMKL2",42,0)
 ....S DIR("?",1)="Enter Yes if the veteran requested a reschedule or 'No Showed' the appointment"
"RTN","DVBCMKL2",43,0)
 ....S DIR("?")="Enter No if the Clinic required a reschedule."
"RTN","DVBCMKL2",44,0)
 ....S DIR("A")="Is this appointment due to a veteran requested cancellation or 'No Show'"
"RTN","DVBCMKL2",45,0)
 ....S DIR(0)="Y^AO" D ^DIR I $D(DTOUT)!($D(DUOUT)) S DVBAGETO=""
"RTN","DVBCMKL2",46,0)
 ....K DIR,DTOUT,DUOUT
"RTN","DVBCMKL2",47,0)
 ....I '$D(DVBAGETO) S:+Y=1 DVBAVTRQ="" DO
"RTN","DVBCMKL2",48,0)
 .....D UPDTLK ;**Reschedule appt
"RTN","DVBCMKL2",49,0)
 ....I $D(DVBAGETO) DO  ;**Time or '^' out
"RTN","DVBCMKL2",50,0)
 .....K Y,DIR,DTOUT,DUOUT
"RTN","DVBCMKL2",51,0)
 .....S DIR("A",1)=" "
"RTN","DVBCMKL2",52,0)
 .....S DIR("A",2)="You have not indicated if the reschedule was due to action by the veteran."
"RTN","DVBCMKL2",53,0)
 .....S DIR("A",3)="The new appointment will not be linked.  You will need to adjust"
"RTN","DVBCMKL2",54,0)
 .....S DIR("A",4)="the link for this appointment with the AMIE/C&P appointment link management"
"RTN","DVBCMKL2",55,0)
 .....S DIR("A",5)="option to ensure proper processing time calculation for this 2507."
"RTN","DVBCMKL2",56,0)
 .....S DIR("A",6)=" "
"RTN","DVBCMKL2",57,0)
 .....S DIR(0)="FAO^1:1",DIR("A")="Hit any key to continue."
"RTN","DVBCMKL2",58,0)
 .....D ^DIR K DIR,X,Y
"RTN","DVBCMKL2",59,0)
 ....K DVBAGETO
"RTN","DVBCMKL2",60,0)
 ...I +$P(^DVB(396.95,DVBALKRC,0),U,4)=1&($P(^DVB(396.95,DVBALKRC,0),U,5)="") S DVBAVTRQ="" D UPDTLK ;**Vet cancel and no vet req date - reschd appt
"RTN","DVBCMKL2",61,0)
 .I +DVBAYANS'=1 DO CRTREC^DVBCMKLK ;**Create new appt tracking record
"RTN","DVBCMKL2",62,0)
 ;
"RTN","DVBCMKL2",63,0)
 ;**No appointments exist for 2507 or enhanced dialogue Off
"RTN","DVBCMKL2",64,0)
 I '$D(^DVB(396.95,"AR",DVBADA))!(+$$ENHNC^DVBCUTA4'=1) DO CRTREC^DVBCMKLK
"RTN","DVBCMKL2",65,0)
 Q
"RTN","DVBCMKL2",66,0)
 ;
"RTN","DVBCMKL2",67,0)
UPDTLK ;** Update selected 396.95 link
"RTN","DVBCMKL2",68,0)
 S DVBARSAP=$P(^DVB(396.95,DVBALKRC,0),U,3)
"RTN","DVBCMKL2",69,0)
 K Y,DIR D RSCHAPT^DVBCMKLK(DVBALKRC,$P(SDATA,U,3))
"RTN","DVBCMKL2",70,0)
 K DVBAVTRQ
"RTN","DVBCMKL2",71,0)
 N DVBAAPST
"RTN","DVBCMKL2",72,0)
 S DVBAAPST=$P(^DPT(DVBADFN,"S",DVBARSAP,0),U,2)
"RTN","DVBCMKL2",73,0)
 I DVBAAPST="NT"!(DVBAAPST="I"!(DVBAAPST="")) DO
"RTN","DVBCMKL2",74,0)
 .N DVBAAPIN S DVBAAPIN=DVBARSAP
"RTN","DVBCMKL2",75,0)
 .S Y=DVBARSAP X ^DD("DD")
"RTN","DVBCMKL2",76,0)
 .S DVBARSAP=Y K Y
"RTN","DVBCMKL2",77,0)
 .S DIR("A",1)=" "
"RTN","DVBCMKL2",78,0)
 .S DIR("A",2)="Remember to cancel the appointment for "_DVBARSAP
"RTN","DVBCMKL2",79,0)
 .S DIR("A",3)=" and do NOT auto-rebook."
"RTN","DVBCMKL2",80,0)
 .S DIR("A",4)=" "
"RTN","DVBCMKL2",81,0)
 .S DIR("A")="Hit Return to continue"
"RTN","DVBCMKL2",82,0)
 .S DIR(0)="FAO^1:1"
"RTN","DVBCMKL2",83,0)
 .D:$P(SDATA,U,3)'=DVBAAPIN ^DIR
"RTN","DVBCMKL2",84,0)
 .K DIR,Y,DVBARSAP
"RTN","DVBCMKL2",85,0)
 Q
"RTN","DVBCMKL2",86,0)
 ;
"RTN","DVBCMKL2",87,0)
LINKHLP ;** Indentifier info for selected links
"RTN","DVBCMKL2",88,0)
 N DVBACLNC,DVBADTE,DVBATIME,DVBADTWK,DVBAX
"RTN","DVBCMKL2",89,0)
 S DVBACLNC=$P(^DPT(DVBADFN,"S",$P(^DVB(396.95,+Y,0),U,3),0),U,1)
"RTN","DVBCMKL2",90,0)
 S DVBACLNC=$P(^SC(DVBACLNC,0),U,1)
"RTN","DVBCMKL2",91,0)
 S DVBADTWK=$P(^DVB(396.95,+Y,0),U,3) ;**Get current date
"RTN","DVBCMKL2",92,0)
 S DVBATIME=$P(DVBADTWK,".",2)
"RTN","DVBCMKL2",93,0)
 S DVBADTWK=$P(DVBADTWK,".",1)
"RTN","DVBCMKL2",94,0)
 S DVBADTE=$$FMTE^XLFDT(DVBADTWK,"5DZ")
"RTN","DVBCMKL2",95,0)
 F DVBAX=$L(DVBATIME):1:3 S DVBATIME=DVBATIME_"0"
"RTN","DVBCMKL2",96,0)
 S DVBATIME=$E(DVBATIME,1,2)_":"_$E(DVBATIME,3,4)
"RTN","DVBCMKL2",97,0)
 S DVBADTE=DVBADTE_" @ "_DVBATIME
"RTN","DVBCMKL2",98,0)
 W ?23,"Currently: ",DVBADTE,?59,DVBACLNC
"RTN","DVBCMKL2",99,0)
 Q
"RTN","DVBCPND1")
0^22^B22927581
"RTN","DVBCPND1",1,0)
DVBCPND1 ;ALB/GTS-557/THM-2507 PENDING REQUESTS, PART 2 ; 4/30/91  7:09 AM
"RTN","DVBCPND1",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCPND1",3,0)
 ;
"RTN","DVBCPND1",4,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:999999)
"RTN","DVBCPND1",5,0)
 Q
"RTN","DVBCPND1",6,0)
 ;
"RTN","DVBCPND1",7,0)
SORT S STAT=$P(^DVB(396.3,REQDA,0),U,18) Q:"^R^X^RX^C^CT^"[(U_STAT_U)  I DVBCSORT="S" Q:STAT'=RSTAT&(RSTAT'="A")
"RTN","DVBCPND1",8,0)
 S PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),ROUT=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,4),1:0),RDATE=$P(^(0),U,5)
"RTN","DVBCPND1",9,0)
 I DVBCSORT="V" S ^TMP($J,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",10,0)
 I DVBCSORT="S" S ^TMP($J,STAT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",11,0)
 I DVBCSORT="R",$D(ADIVNUM),ROUT=ADIVNUM S ^TMP($J,ROUT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",12,0)
 I DVBCSORT="A" D ELAPSED I EDAYS'<ERDAYS,EDAYS'>OLDAYS S ^TMP($J,EDAYS,PNAM,DFN,REQDA)=""
"RTN","DVBCPND1",13,0)
 Q
"RTN","DVBCPND1",14,0)
 ;
"RTN","DVBCPND1",15,0)
SETUP K ^TMP($J) S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=0
"RTN","DVBCPND1",16,0)
 S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0 U IO D HEADER
"RTN","DVBCPND1",17,0)
 ;
"RTN","DVBCPND1",18,0)
DATA S DFN="" F J=0:0 S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT
"RTN","DVBCPND1",19,0)
 I DVBCSORT="V" S PNAM="" F I=0:0 S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:DFN=""  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZ" Q
"RTN","DVBCPND1",20,0)
 I DVBCSORT="R"!(DVBCSORT="A") S PNAM="" F JX=-1:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",21,0)
 I DVBCSORT="S" S (PNAM,JX)="" F ZX=0:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",22,0)
 D:$Y>60 HEADER I DVBCCNT>0 W !!,"Total pending: ",DVBCCNT,!
"RTN","DVBCPND1",23,0)
 I IOST?1"C-".E W !!,"Press RETURN  " R ANS:DTIME
"RTN","DVBCPND1",24,0)
 ;
"RTN","DVBCPND1",25,0)
EXIT I NODATA=0 U IO W *7,!!!!!,"No pending requests found for selected parameters.",!! H 2
"RTN","DVBCPND1",26,0)
 ;
"RTN","DVBCPND1",27,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD K ANS,JX,DVBCHDR,^TMP($J) G KILL^DVBCUTIL
"RTN","DVBCPND1",28,0)
 ;
"RTN","DVBCPND1",29,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBCPND1",30,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5),SSN=$P(^DPT(DFN,0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"Unknown") D ELAPSED
"RTN","DVBCPND1",31,0)
 S STATUS="Unknown" W !?10,"Division: "_ADIV,!?12,"Status: " S XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBCPND1",32,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by MAS",XX="RX":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBCPND1",33,0)
 W STATUS,!!,PNAM,?49,"SSN: ",SSN,!?44,"Claim no: ",CNUM,!?40,"Request date: ",$$FMTE^XLFDT(RDATE1,"5DZ"),!?40,"Elapsed days: ",EDAYS,!!
"RTN","DVBCPND1",34,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBCPND1",35,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" W "Transferred in from ",$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown site"),!
"RTN","DVBCPND1",36,0)
 W !?5,"Exams requested:",!!
"RTN","DVBCPND1",37,0)
 ;
"RTN","DVBCPND1",38,0)
ITEMS D TST^DVBCUTL2 S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBCPND1",39,0)
 W !!,"Requested by: ",$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")," at "
"RTN","DVBCPND1",40,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"") W $S(RONAME]"":RONAME,1:" (Not specified) "),! F L=1:1:79 W "-"
"RTN","DVBCPND1",41,0)
 S DVBCCNT=DVBCCNT+1 I IOST?1"C-".E K OUT W !!!,"Press RETURN to continue or ""^"" exit  " R ANS:DTIME S:'$T!(ANS=U) OUT=1 Q:$D(OUT)  D HEADER Q
"RTN","DVBCPND1",42,0)
 W ! I $Y>45 D HEADER
"RTN","DVBCPND1",43,0)
 Q
"RTN","DVBCPND1",44,0)
 ;
"RTN","DVBCPND1",45,0)
HEADER S PG=PG+1 W @IOF,!!
"RTN","DVBCPND1",46,0)
 W ?(80-$L(HEAD)\2),HEAD,?71,"Page: ",PG,!?(80-$L(DVBCHDR)\2),DVBCHDR,!! I HEAD2]"" W ?(80-$L(HEAD2)\2),HEAD2,!
"RTN","DVBCPND1",47,0)
 W ?(80-$L(PROCDT)\2),PROCDT,!?(80-$L(HEAD3)\2),HEAD3,! F LN=1:1:80 W "="
"RTN","DVBCPND1",48,0)
 W !!
"RTN","DVBCPND1",49,0)
 Q
"RTN","DVBCPND1",50,0)
 ;
"RTN","DVBCPND1",51,0)
ELAPSED K EDAYS,X1,X2,X S X1=DT,(X2,X)=RDATE D:ELTYP="C" ^%DTC D:ELTYP="W" ^XUWORKDY S EDAYS=X
"RTN","DVBCSCHD")
0^23^B20499986
"RTN","DVBCSCHD",1,0)
DVBCSCHD ;ALB/GTS-557/THM-SCHEDULE C&P EXAMS ; 9/23/91  9:54 AM
"RTN","DVBCSCHD",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCSCHD",3,0)
 ;
"RTN","DVBCSCHD",4,0)
 ;** Version Changes
"RTN","DVBCSCHD",5,0)
 ;   2.7 - GTS/Set DVBADA,DVBASDRT SD Event driver  (Enhc 13)
"RTN","DVBCSCHD",6,0)
 ;
"RTN","DVBCSCHD",7,0)
SETUP D HOME^%ZIS S HD="SCHEDULE C&P EXAMS",FF=IOF
"RTN","DVBCSCHD",8,0)
 I $D(DUZ)#2=0 W *7,!!,"You have no user number !",!! H 3 G EXIT
"RTN","DVBCSCHD",9,0)
 S SUPER=0 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBCSCHD",10,0)
 ;
"RTN","DVBCSCHD",11,0)
EN D ZAP W @FF,?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCSCHD",12,0)
 S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Enter VETERAN NAME: ",DIC("W")="D DICW^DVBCUTIL"
"RTN","DVBCSCHD",13,0)
 D ^DIC G:X=""!(X[U)!($D(DTOUT)) EXIT
"RTN","DVBCSCHD",14,0)
 I +Y>0 S (OLDDA,REQDA)=+Y,DFN=$P(Y,U,2)
"RTN","DVBCSCHD",15,0)
 I $O(^DVB(396.4,"C",REQDA,0))="" W !!,*7,"This request has no exams on it and should",!,"be completely cancelled.",!! H 3 G EN
"RTN","DVBCSCHD",16,0)
 D GO1 I '$D(TFIND) W !!,*7,"This request has been completely transferred to another site.",!,"Scheduling will not be allowed.",!! H 3 G EN
"RTN","DVBCSCHD",17,0)
 S STAT=$P(^DVB(396.3,+Y,0),U,18) D STATCHK I $D(NCN) G EN
"RTN","DVBCSCHD",18,0)
 S DTSCHED=$P(^DVB(396.3,+Y,0),U,6) I DTSCHED]"" W !!,*7,"Scheduling has been completed for this request as of ",$$FMTE^XLFDT(DTSCHED,"5DZ")_".",!
"RTN","DVBCSCHD",19,0)
 I DTSCHED]"",SUPER=0 W "Only supervisors can change it.",!! H 3 G EN
"RTN","DVBCSCHD",20,0)
 ;
"RTN","DVBCSCHD",21,0)
ASK K %,%Y I DTSCHED]"",SUPER=1 W "Do you want to change" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCSCHD",22,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to be able to change the scheduling information or N to backup.",!! G ASK
"RTN","DVBCSCHD",23,0)
 I $D(%),%'=1 G EN
"RTN","DVBCSCHD",24,0)
 ;
"RTN","DVBCSCHD",25,0)
ASK1 I $D(^DVB(396.3,REQDA,4)),$P(^(4),U,1)="y" W !!,"Note:  One or more exams on this request have transferred out."
"RTN","DVBCSCHD",26,0)
 W !!,"Do you want to make an appointment for a clinic" S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT I %=1 W @FF,"Schedule a Clinic Appointment for 2507 Exam",!!! S ORACTION=1,DVBADA=REQDA,DVBASDRT="",ORVP=DFN D OERR^SDM
"RTN","DVBCSCHD",27,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to make an appointment via ADT/Scheduling or N to skip." G ASK1
"RTN","DVBCSCHD",28,0)
 ;
"RTN","DVBCSCHD",29,0)
EN1 W @FF,"Enter Scheduling Information for 2507 Exams",!!
"RTN","DVBCSCHD",30,0)
 ;
"RTN","DVBCSCHD",31,0)
ASK2 W !,"Has scheduling for all exams been completed" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCSCHD",32,0)
 I $D(%Y),%Y["?" W !!,"Enter Y if scheduling is completed, N if not.",!! G ASK2
"RTN","DVBCSCHD",33,0)
 G:%'=1 EN
"RTN","DVBCSCHD",34,0)
 W !!,"Ok, then please complete the following:",!!
"RTN","DVBCSCHD",35,0)
 S:$P(^DVB(396.3,REQDA,0),U,6)="" DR="5///NOW",DIE="^DVB(396.3,",DA=REQDA D ^DIE:$P(^DVB(396.3,REQDA,0),U,6)="",EXAMS I '$D(Y) G EN
"RTN","DVBCSCHD",36,0)
 I $D(Y) W *7,!!,"Important scheduling information is missing!",!,"2507 file NOT updated!",!! S DR="5///@",DIE="^DVB(396.3,",DA=REQDA D ^DIE H 2 G EN ;delete date if "^"
"RTN","DVBCSCHD",37,0)
 ;
"RTN","DVBCSCHD",38,0)
ZAP K %,%Y,NCN,DFN,EXAM,JDR,JDT,DTSCHED,REQDA,RO,RONAME,STAT,TFIND,TSTDT
"RTN","DVBCSCHD",39,0)
 Q
"RTN","DVBCSCHD",40,0)
 ;
"RTN","DVBCSCHD",41,0)
EXIT K TFIND,ORACTION,ORVP,DVBAXJ,DVBASDRT G KILL^DVBCUTIL
"RTN","DVBCSCHD",42,0)
 ;
"RTN","DVBCSCHD",43,0)
STATCHK Q:STAT="P"!(STAT="N")!(STAT="NT")!(STAT="S")!(STAT="O")
"RTN","DVBCSCHD",44,0)
 W !!,*7,"This request has been ",$S(STAT="RX":"cancelled by the RO",STAT="X":"cancelled by MAS",STAT="T":"transcribed",STAT="R":"released",STAT="C":"completed",STAT="CT":"completed, transferred out",1:"given an incorrect status"),".",!!
"RTN","DVBCSCHD",45,0)
 S NCN=1 H 2 Q
"RTN","DVBCSCHD",46,0)
 ;NCN=no can do
"RTN","DVBCSCHD",47,0)
 Q
"RTN","DVBCSCHD",48,0)
 ;
"RTN","DVBCSCHD",49,0)
EXAMS H 1 S DA(1)=REQDA
"RTN","DVBCSCHD",50,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""!(+DA=0)  S EXNAME=+$P(^DVB(396.4,DA,0),U,3),EXST=$P(^(0),U,4),EXNAME=$S($D(^DVB(396.6,EXNAME,0)):$P(^(0),U,1),1:"") I EXST'["X",EXST'="T" D EXAMS1 ;screen cancels, transfers
"RTN","DVBCSCHD",51,0)
 Q
"RTN","DVBCSCHD",52,0)
 ;
"RTN","DVBCSCHD",53,0)
EXAMS1 I EXNAME]"" S DIE="^DVB(396.4,",DR=".08//NO;.09//CLINIC" W @IOF,!!!,"Exam: ",EXNAME,!!! D ^DIE Q:$D(Y)
"RTN","DVBCSCHD",54,0)
 Q
"RTN","DVBCSCHD",55,0)
 ;
"RTN","DVBCSCHD",56,0)
GO1 K TFIND F DVBAXJ=0:0 S DVBAXJ=$O(^DVB(396.4,"C",REQDA,DVBAXJ)) Q:DVBAXJ=""  I $P(^DVB(396.4,DVBAXJ,0),U,4)'="T" S TFIND=1
"RTN","DVBCSCHD",57,0)
 Q
"RTN","DVBCSCHD",58,0)
 ;if $D(TFIND) at least one exam to be done locally
"RTN","DVBCSCHD",59,0)
 ;if '$D(TFIND) all exams are transferred/don't consider
"RTN","DVBCUTIL")
0^24^B24606367
"RTN","DVBCUTIL",1,0)
DVBCUTIL ;ALB/GTS-557/THM;C&P UTILITY ROUTINE ; 4/26/91  11:16 AM
"RTN","DVBCUTIL",2,0)
 ;;2.7;AMIE;**17**;Apr 10, 1995
"RTN","DVBCUTIL",3,0)
KILL ;common exit
"RTN","DVBCUTIL",4,0)
 D ^%ZISC I $D(FF),'$D(ZTQUEUED) W @FF,!!
"RTN","DVBCUTIL",5,0)
 K %DT,ADR1,ADR2,ADR3,BDTRQ,BUSPHON,CITY,CNDCT,CNUM,DFN,DIW,DIWF,DIWL,DIWR,DIWT,DN,DOB,DTA,DTRQ,DX,DXCOD,DXNUM,EDTRQ,HOMPHON,I,LINE,MDTRM,NAME,OTHDIS,PCT,PG,PGHD,POP,PRINT,REQN,RO,ROHD,RONAME,RQ,SC,D,DIE,ONE,DVBCNEW,LN,FEXM,PRIO,DTB
"RTN","DVBCUTIL",6,0)
 K SEX,SSN,STATE,TST,X,Y,Z,JI,JII,ZIP,JJ,KJX,D0,D1,DA,DI,DIC,DIPGM,DLAYGO,DQ,DWLW,HD,HD1,HD2,J,ONFILE,CTIM,JJ,C,DIZ,DPTSZ,STAT,JDT,JY,TSTDT,DIYS,EXAM,DR,REQDT,ELIG,INCMP,PRDSV,WARD,ADD1,ADD2,CNTY,PG,OLDDA,DIRUT,DUOUT
"RTN","DVBCUTIL",7,0)
 K DVBCCNT,TNAM,DIR,TEMP,SWITCH,EDTA,RAD,EOD,%T,STATUS,XX,XDD,OLDA,OLDA1
"RTN","DVBCUTIL",8,0)
 K DTTRNSC,ZIP4,DVBAINSF
"RTN","DVBCUTIL",9,0)
 G KILL^DVBCUTL2
"RTN","DVBCUTIL",10,0)
 ;
"RTN","DVBCUTIL",11,0)
DICW ;used on ^DIC lookups only
"RTN","DVBCUTIL",12,0)
 W ! S TSTDT=$P(^(0),U,2),RO=$P(^(0),U,3),STAT=$P(^(0),U,18),RONAME=$S($D(^DIC(4,+RO,0)):$P(^(0),U,1),1:"Unknown RO") D DICW1
"RTN","DVBCUTIL",13,0)
 W ! Q
"RTN","DVBCUTIL",14,0)
 ;
"RTN","DVBCUTIL",15,0)
DICW1 F JY=0:0 S JY=$O(^DVB(396.4,"C",+Y,JY)) Q:JY=""  S EXAM=$P(^DVB(396.4,+JY,0),U,3),EXAM=$S($D(^DVB(396.6,EXAM,0)):$P(^(0),U,1),1:"Unknown exam") D DICW2
"RTN","DVBCUTIL",16,0)
 Q
"RTN","DVBCUTIL",17,0)
 ;
"RTN","DVBCUTIL",18,0)
DICW2 W ?3,EXAM," (",$$FMTE^XLFDT(TSTDT,"5DZ")," by ",RONAME,")",!
"RTN","DVBCUTIL",19,0)
 Q
"RTN","DVBCUTIL",20,0)
 ;
"RTN","DVBCUTIL",21,0)
VARS S DTA=^DVB(396.3,DA,0),DFN=$P(DTA,U,1),(NAME,PNAM)=$P(^DPT(DFN,0),U,1),DOB=$P(^(0),U,3),SEX=$P(^(0),U,2),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown"),DTRQ=$P(DTA,U,2)
"RTN","DVBCUTIL",22,0)
 S RO=$P(DTA,U,3),FEXM=$P(DTA,U,9) S:RO="" RO=0 S RONAME=$S($D(^DIC(4,RO,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCUTIL",23,0)
 S REQN=$P(DTA,U,4),REQN=$S($D(^VA(200,+REQN,0)):$P(^(0),U,1),1:"Unknown"),OTHDIS=$P(DTA,U,11) I $D(^DVB(396.3,DA,1)) S OTHDIS1=$P(^(1),U,9),OTHDIS2=$P(^(1),U,10)
"RTN","DVBCUTIL",24,0)
 S ZPR=$P(DTA,U,10),PRIO=$S(ZPR="T":"Terminal",ZPR="P":"Prisoner of war",ZPR="OS":"Original SC",ZPR="ON":"Original NSC",ZPR="I":"Increase",ZPR="R":"Review",ZPR="OTR":"Other",ZPR="E":"Inadequate exam",1:"Unknown")
"RTN","DVBCUTIL",25,0)
 K DVBAINSF S:ZPR="E" DVBAINSF=""
"RTN","DVBCUTIL",26,0)
 S (ADR1,ADR2,ADR3,CITY,STATE,ZIP)=""
"RTN","DVBCUTIL",27,0)
 I $D(^DPT(DFN,.11)) S DTA=^DPT(DFN,.11),ADR1=$P(DTA,U,1),ADR2=$P(DTA,U,2),ADR3=$P(DTA,U,3),CITY=$P(DTA,U,4),ZIP=$P(DTA,U,12) S:ZIP'="" ZIP=$S($L(ZIP)>5:$E(ZIP,1,5)_"-"_$E(ZIP,6,9),1:ZIP) I ZIP="" S ZIP="No Zip"
"RTN","DVBCUTIL",28,0)
 S CITY=$S(CITY]"":CITY,1:"Unknown") S STATE=$P(DTA,U,5) I STATE]"" S STATE=$S($D(^DIC(5,STATE,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCUTIL",29,0)
 S (HOMPHON,BUSPHON)="Unknown" I $D(^DPT(DFN,.13)) S HOMPHON=$P(^(.13),U,1),BUSPHON=$P(^(.13),U,2)
"RTN","DVBCUTIL",30,0)
 S EDTA=$S($D(^DPT(DFN,.32)):^(.32),1:""),EOD=$P(EDTA,U,6),RAD=$P(EDTA,U,7),Y=$S($D(^DVB(396.3,DA,1)):$P(^(1),U,7),1:"") X ^DD("DD") S LREXMDT=Y
"RTN","DVBCUTIL",31,0)
 Q
"RTN","DVBCUTIL",32,0)
 ;
"RTN","DVBCUTIL",33,0)
HDR W @FF,?(IOM-$L(HD2)\2),HD2,!!!?5,"Veteran name: ",PNAM,?45,"SSN: ",SSN,!?40,"C-NUMBER: ",CNUM,!!,"Exams on this request:",!!
"RTN","DVBCUTIL",34,0)
 S JII=""
"RTN","DVBCUTIL",35,0)
 F JIJ=0:0 S JII=$O(^TMP($J,JII)) Q:JII=""  S XST=$P(^TMP($J,JII),U,1) W JII,", ",$S(XST="C":"Completed",XST="RX":"Cancelled by RO",XST="X":"Cancelled by MAS",XST="T":"Transferred",1:"Open"),", " I $X>30 W !
"RTN","DVBCUTIL",36,0)
 Q
"RTN","DVBCUTIL",37,0)
 ;
"RTN","DVBCUTIL",38,0)
ADDR S (ADD1,ADD2,CITY,CNTY,STATE,ZIP)=""
"RTN","DVBCUTIL",39,0)
 I $D(^DPT(DFN,.11)) S DTA=^(.11),ADD1=$P(DTA,U,1),ADD2=$P(DTA,U,2),CITY=$P(DTA,U,4),STATE=$P(DTA,U,5),ZIP=$P(DTA,U,12),CNTY=$P(DTA,U,7)
"RTN","DVBCUTIL",40,0)
 S:ZIP'="" ZIP=$S($L(ZIP)>5:$E(ZIP,1,5)_"-"_$E(ZIP,6,9),1:ZIP)
"RTN","DVBCUTIL",41,0)
 S CNTY=$S($D(^DIC(5,+STATE,1,+CNTY,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCUTIL",42,0)
 S STATE=$S($D(^DIC(5,+STATE,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCUTIL",43,0)
 W !!?0,"Address: ",?9,ADD1,! W:ADD2]"" ?9,ADD2,! W ?0,"City:",?9,CITY,"  ",STATE,"  ",ZIP,!?0,"County:",?9,CNTY,!!
"RTN","DVBCUTIL",44,0)
 S PRDSV=$S($D(^DPT(DFN,.32)):$P(^(.32),U,3),1:"") I PRDSV]"" S PRDSV=$P(^DIC(21,PRDSV,0),U,1)
"RTN","DVBCUTIL",45,0)
 W "Period of service: ",PRDSV,!
"RTN","DVBCUTIL",46,0)
 S ELIG="",INCMP=0
"RTN","DVBCUTIL",47,0)
 W ?0,"Eligibility data:" I $D(^DPT(DFN,.36)),$P(^(.36),U,1)]"" S ELIG=$S($D(^DIC(8,+^(.36),0)):$P(^(0),U,6),1:"")
"RTN","DVBCUTIL",48,0)
 I ELIG]"",$D(^DPT(DFN,.361)),^(.361)]"" S ELIG=ELIG_" ("_$S($P(^(.361),U,1)="P":"Pend ver",$P(^(.361),U,1)="R":"Pend re-verif",$P(^(.361),U,1)="V":"Verified",1:"Not verified")_")"
"RTN","DVBCUTIL",49,0)
 I $D(^DPT(DFN,.29)),$P(^(.29),U,1)]"" S INCMP=1
"RTN","DVBCUTIL",50,0)
 I $D(^DPT(DA,.293)),$P(^(.293),U,1)=1 S INCMP=1
"RTN","DVBCUTIL",51,0)
 W ?19,ELIG_$S(ELIG]"":", ",1:"")_$S(INCMP=1:"Incompetent",1:""),!
"RTN","DVBCUTIL",52,0)
 Q
"RTN","DVBCUTIL",53,0)
 ;
"RTN","DVBCUTIL",54,0)
SSNSHRT ;  ** Set SSN in the Format '***********' **
"RTN","DVBCUTIL",55,0)
 K DVBCSSNO
"RTN","DVBCUTIL",56,0)
 S DVBCSSNO=$E(SSN,1,3)_" "_$E(SSN,4,5)_" "_$E(SSN,6,9)
"RTN","DVBCUTIL",57,0)
 Q
"RTN","DVBCUTIL",58,0)
 ;
"RTN","DVBCUTIL",59,0)
SSNOUT ;  ** Set SSN in the Format '*********** (Z6789) **
"RTN","DVBCUTIL",60,0)
 D SSNSHRT
"RTN","DVBCUTIL",61,0)
 S DVBCSSNO=DVBCSSNO_" ("_$E(PNAM)_$E(SSN,6,9)_")"
"RTN","DVBCUTIL",62,0)
 Q
"VER")
8.0^21.0
**END**
**END**
