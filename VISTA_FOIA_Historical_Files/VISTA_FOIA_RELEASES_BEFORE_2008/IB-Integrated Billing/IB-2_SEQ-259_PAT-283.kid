Released IB*2*283 SEQ #259
Extracted from mail message
**KIDS**:IB*2.0*283^

**INSTALL NAME**
IB*2.0*283
"BLD",5088,0)
IB*2.0*283^INTEGRATED BILLING^0^3040929^y
"BLD",5088,1,0)
^^2^2^3040929^
"BLD",5088,1,1,0)
CSA screen performance enhancements and improve message handling of 
"BLD",5088,1,2,0)
entries in file 361 - IB BILL STATUS MESSAGE.
"BLD",5088,4,0)
^9.64PA^^
"BLD",5088,"ABPKG")
n
"BLD",5088,"INIT")
IBY283PO
"BLD",5088,"KRN",0)
^9.67PA^8989.52^19
"BLD",5088,"KRN",.4,0)
.4
"BLD",5088,"KRN",.401,0)
.401
"BLD",5088,"KRN",.402,0)
.402
"BLD",5088,"KRN",.403,0)
.403
"BLD",5088,"KRN",.5,0)
.5
"BLD",5088,"KRN",.84,0)
.84
"BLD",5088,"KRN",3.6,0)
3.6
"BLD",5088,"KRN",3.8,0)
3.8
"BLD",5088,"KRN",9.2,0)
9.2
"BLD",5088,"KRN",9.8,0)
9.8
"BLD",5088,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5088,"KRN",9.8,"NM",1,0)
IBCECSA1^^0^B28975725
"BLD",5088,"KRN",9.8,"NM",2,0)
IBCEST^^0^B65571445
"BLD",5088,"KRN",9.8,"NM",3,0)
IBCE^^0^B20226336
"BLD",5088,"KRN",9.8,"NM","B","IBCE",3)

"BLD",5088,"KRN",9.8,"NM","B","IBCECSA1",1)

"BLD",5088,"KRN",9.8,"NM","B","IBCEST",2)

"BLD",5088,"KRN",19,0)
19
"BLD",5088,"KRN",19.1,0)
19.1
"BLD",5088,"KRN",101,0)
101
"BLD",5088,"KRN",409.61,0)
409.61
"BLD",5088,"KRN",771,0)
771
"BLD",5088,"KRN",870,0)
870
"BLD",5088,"KRN",8989.51,0)
8989.51
"BLD",5088,"KRN",8989.52,0)
8989.52
"BLD",5088,"KRN",8994,0)
8994
"BLD",5088,"KRN","B",.4,.4)

"BLD",5088,"KRN","B",.401,.401)

"BLD",5088,"KRN","B",.402,.402)

"BLD",5088,"KRN","B",.403,.403)

"BLD",5088,"KRN","B",.5,.5)

"BLD",5088,"KRN","B",.84,.84)

"BLD",5088,"KRN","B",3.6,3.6)

"BLD",5088,"KRN","B",3.8,3.8)

"BLD",5088,"KRN","B",9.2,9.2)

"BLD",5088,"KRN","B",9.8,9.8)

"BLD",5088,"KRN","B",19,19)

"BLD",5088,"KRN","B",19.1,19.1)

"BLD",5088,"KRN","B",101,101)

"BLD",5088,"KRN","B",409.61,409.61)

"BLD",5088,"KRN","B",771,771)

"BLD",5088,"KRN","B",870,870)

"BLD",5088,"KRN","B",8989.51,8989.51)

"BLD",5088,"KRN","B",8989.52,8989.52)

"BLD",5088,"KRN","B",8994,8994)

"BLD",5088,"QUES",0)
^9.62^^
"BLD",5088,"REQB",0)
^9.611^2^2
"BLD",5088,"REQB",1,0)
IB*2.0*135^2
"BLD",5088,"REQB",2,0)
IB*2.0*215^2
"BLD",5088,"REQB","B","IB*2.0*135",1)

"BLD",5088,"REQB","B","IB*2.0*215",2)

"INIT")
IBY283PO
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
283^3040929
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3040929
"PKG",200,22,1,"PAH",1,1,1,0)
CSA screen performance enhancements and improve message handling of 
"PKG",200,22,1,"PAH",1,1,2,0)
entries in file 361 - IB BILL STATUS MESSAGE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IBCE")
0^3^B20226336
"RTN","IBCE",1,0)
IBCE ;ALB/TMP - 837 EDI TRANSMISSION UTILITIES/NIGHTLY JOB ;22-JAN-96
"RTN","IBCE",2,0)
 ;;2.0;INTEGRATED BILLING;**137,283**;21-MAR-94
"RTN","IBCE",3,0)
EN ; Run all jobs needed for EDI processing nightly
"RTN","IBCE",4,0)
 ; including transmit bills waiting for extract, batches not sent,
"RTN","IBCE",5,0)
 N IBLAST,IBZ,IBZ0
"RTN","IBCE",6,0)
 D NOTSENT^IBCEBUL
"RTN","IBCE",7,0)
 D EN^IBCE837
"RTN","IBCE",8,0)
 D EN^IBCEMPRG      ; purge status messages from file 361
"RTN","IBCE",9,0)
 S IBLAST=$G(^IBA(364.2,"ALAST")),^IBA(364.2,"ALAST")=$$NOW^XLFDT()
"RTN","IBCE",10,0)
 ; Clean up ACOB xref in 364
"RTN","IBCE",11,0)
 S IBZ=0
"RTN","IBCE",12,0)
 F  S IBZ=$O(^IBA(364,"ACOB",IBZ)) Q:'IBZ  S IBZ0=0 F  S IBZ0=$O(^IBA(364,"ACOB",IBZ,IBZ0)) Q:'IBZ0  I '$$COBPOSS^IBCECOB(IBZ0) D UPDEDI^IBCEM(IBZ0,"N",1)
"RTN","IBCE",13,0)
 Q
"RTN","IBCE",14,0)
 ;
"RTN","IBCE",15,0)
EN1 ; Manual entry point for transmitting EDI bills
"RTN","IBCE",16,0)
 N DIR,X,Y,IBLAST,IBTASK,IBOPTX,DTOUT,DUOUT
"RTN","IBCE",17,0)
 I '$$MGCHK(1) G EN1Q
"RTN","IBCE",18,0)
 S DIR("A")="Select transmit option: ",DIR("B")="S",DIR(0)="SAM^A:Transmit (A)LL bills in READY FOR EXTRACT status;S:Transmit only (S)ELECTED bills"
"RTN","IBCE",19,0)
 D ^DIR K DIR
"RTN","IBCE",20,0)
 I $D(DTOUT)!$D(DUOUT) G EN1Q
"RTN","IBCE",21,0)
 S IBOPTX=Y
"RTN","IBCE",22,0)
 I Y="A" D  G EN1Q
"RTN","IBCE",23,0)
 . S DIR("A",1)="This option will run a job to transmit ALL bills ready for EDI transmission"
"RTN","IBCE",24,0)
 . S DIR("A",2)="This option's last scheduled run was "_$$FMTE^XLFDT($G(^IBA(364.2,"ALAST")),2)
"RTN","IBCE",25,0)
 . S DIR("A",3)=" "
"RTN","IBCE",26,0)
 . S DIR("A")="Are you absolutely sure this is what you want to do? "
"RTN","IBCE",27,0)
 . S DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR
"RTN","IBCE",28,0)
 . Q:'Y
"RTN","IBCE",29,0)
 . S DIR(0)="YA",DIR("A",1)=" "
"RTN","IBCE",30,0)
 . S DIR("A",2)="Transmission of ALL bills will be run now"
"RTN","IBCE",31,0)
 . S DIR("A")="Is this OK? ",DIR("B")="NO"
"RTN","IBCE",32,0)
 . D ^DIR K DIR
"RTN","IBCE",33,0)
 . Q:'Y
"RTN","IBCE",34,0)
 . D EN1^IBCE837B(.IBTASK)
"RTN","IBCE",35,0)
 . I $G(IBTASK) D
"RTN","IBCE",36,0)
 .. S DIR("A",1)="Task # for this job is: "_IBTASK
"RTN","IBCE",37,0)
 . E  D
"RTN","IBCE",38,0)
 .. I $G(IBTASK)'="" S DIR("A",1)="Error encountered in tasking job - check IRM for reported errors"
"RTN","IBCE",39,0)
 .. S DIR(0)="EA",DIR("A")=" Press RETURN to continue " W !! D ^DIR K DIR
"RTN","IBCE",40,0)
 I IBOPTX="S" D SUB1^IBCEM03 G EN1Q
"RTN","IBCE",41,0)
EN1Q Q
"RTN","IBCE",42,0)
 ;
"RTN","IBCE",43,0)
RESUB(IB364) ; Manually resubmit bill for transmission (ien file 364 = IB364)
"RTN","IBCE",44,0)
 N DIR,X,Y,IBBTCH,DTOUT,DUOUT
"RTN","IBCE",45,0)
 I '$$MGCHK(1) G RESUBQ
"RTN","IBCE",46,0)
 S IBBTCH=""
"RTN","IBCE",47,0)
 W ! S DIR(0)="SA^I:IMMEDIATE TRANSMIT;L:TRANSMIT LATER WITH REST OF READY FOR EXTRACT BILLS",DIR("A")="TRANSMIT (I)MMEDIATELY OR (L)ATER?: ",DIR("B")="L"
"RTN","IBCE",48,0)
 S DIR("?",1)="IF YOU CHOOSE TO TRANSMIT IMMEDIATELY, THE BILL'S DATA WILL BE BATCHED BY",DIR("?",2)=" ITSELF AND SENT OUT IMMEDIATELY.  IF YOU CHOOSE TO TRANSMIT LATER, THE"
"RTN","IBCE",49,0)
 S DIR("?",3)="  BILL'S TRANSMISSION STATUS WILL BE RESET TO 'READY FOR EXTRACT' AND THE BILL'S",DIR("?",4)="  DATA WILL BE EXTRACTED THE NEXT TIME A GENERAL TRANSMISSION OF YOUR BILLS",DIR("?")="  IN READY TO EXTRACT STATUS OCCURS"
"RTN","IBCE",50,0)
 D ^DIR K DIR
"RTN","IBCE",51,0)
 I $D(DTOUT)!$D(DUOUT) G RESUBQ
"RTN","IBCE",52,0)
 I Y="I" D  G:'IBBTCH RESUBQ
"RTN","IBCE",53,0)
 . N Y
"RTN","IBCE",54,0)
 . K ^TMP("IBONE",$J),^TMP("IBSELX",$J),^TMP("IBCE-BATCH",$J)
"RTN","IBCE",55,0)
 . S ^TMP("IBONE",$J,IB364)="",^TMP("IBONE",$J)=0,^TMP("IBSELX",$J)=""
"RTN","IBCE",56,0)
 . D ONE^IBCE837
"RTN","IBCE",57,0)
 . S IBBTCH=$O(^TMP("IBCE-BATCH",$J,0))                     ; external batch#
"RTN","IBCE",58,0)
 . I IBBTCH'="" S IBBTCH=+$G(^TMP("IBCE-BATCH",$J,IBBTCH))  ; internal batch#
"RTN","IBCE",59,0)
 . K ^TMP("IBONE",$J),^TMP("IBSELX",$J),^TMP("IBCE-BATCH",$J)
"RTN","IBCE",60,0)
 . I 'IBBTCH D
"RTN","IBCE",61,0)
 .. S DIR("A",1)="BILL NOT RESUBMITTED - CHECK ALERTS/MAIL FOR DETAILS"
"RTN","IBCE",62,0)
 . E  D
"RTN","IBCE",63,0)
 .. N DIE,DR,DA
"RTN","IBCE",64,0)
 .. D UPDEDI^IBCEM(IB364,"R")
"RTN","IBCE",65,0)
 .. S DIE="^IBA(364,",DR=".06////"_+IBBTCH,DA=IB364 D ^DIE
"RTN","IBCE",66,0)
 .. S DIR("A",1)="BILL RESUBMITTED IN BATCH #"_$P($G(^IBA(364.1,IBBTCH,0)),U)
"RTN","IBCE",67,0)
 . S DIR(0)="EA",DIR("A")="PRESS ENTER TO CONTINUE " D ^DIR K DIR
"RTN","IBCE",68,0)
 I Y="L" D
"RTN","IBCE",69,0)
 . N Y
"RTN","IBCE",70,0)
 . D UPDEDI^IBCEM(IB364,"R")
"RTN","IBCE",71,0)
 . ;Add a new transmission record
"RTN","IBCE",72,0)
 . S Y=$$ADDTBILL^IBCB1($P($G(^IBA(364,+IB364,0)),U),1)
"RTN","IBCE",73,0)
 . S DIR("A",1)="BILL'S TRANSMISSION STATUS RESET TO 'READY TO EXTRACT'"
"RTN","IBCE",74,0)
 . S DIR(0)="EA",DIR("A")="PRESS ENTER TO CONTINUE " D ^DIR K DIR
"RTN","IBCE",75,0)
 ;
"RTN","IBCE",76,0)
RESUBQ Q
"RTN","IBCE",77,0)
 ;
"RTN","IBCE",78,0)
MGCHK(DSP) ; Returns 1 if mail group IB EDI has at least 1 local member,
"RTN","IBCE",79,0)
 ; 0 if none found
"RTN","IBCE",80,0)
 ; DSP = flag that if =1, displays error message
"RTN","IBCE",81,0)
 N IB
"RTN","IBCE",82,0)
 S IB=$$GOTLOCAL^XMXAPIG("IB EDI")
"RTN","IBCE",83,0)
 I 'IB,$G(DSP) D
"RTN","IBCE",84,0)
 . ; No local members in mail group for EDI messages
"RTN","IBCE",85,0)
 . S DIR("A",1)="YOU MUST HAVE AT LEAST 1 MEMBER IN THE 'IB EDI' MAIL GROUP TO TRANSMIT A BILL",DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","IBCE",86,0)
 . S DIR(0)="EA" D ^DIR K DIR
"RTN","IBCE",87,0)
 Q IB
"RTN","IBCE",88,0)
 ;
"RTN","IBCECSA1")
0^1^B28975725
"RTN","IBCECSA1",1,0)
IBCECSA1 ;ALB/CXW - IB STATUS AWAITING RESOLUTION SCREEN ;28-JUL-99
"RTN","IBCECSA1",2,0)
 ;;2.0;INTEGRATED BILLING;**137,283**;21-MAR-94
"RTN","IBCECSA1",3,0)
 ; DBIA for $$ORI^PRCAFN() = DBIA380
"RTN","IBCECSA1",4,0)
 ; DBIA for $$BN1^PRCAFN() = 
"RTN","IBCECSA1",5,0)
 ;
"RTN","IBCECSA1",6,0)
BLD ; Build list entrypoint
"RTN","IBCECSA1",7,0)
 N IBDA,IBREV,IBIFN,IBPAY,IBSSN,IBSER,IB399,IBLOC,IBDIV,IBUER,IBMSG,IBERR,IBPEN,SEVERITY
"RTN","IBCECSA1",8,0)
 K ^TMP("IBCECSA",$J),^TMP("IBCECSB",$J),^TMP("IBCECSD",$J)
"RTN","IBCECSA1",9,0)
 S IBSEV=$G(IBSEV,"R")
"RTN","IBCECSA1",10,0)
 S VALMCNT=0,IB364=""
"RTN","IBCECSA1",11,0)
 S SEVERITY=""
"RTN","IBCECSA1",12,0)
 F  S SEVERITY=$O(^IBM(361,"ACSA",SEVERITY)) Q:SEVERITY=""  I SEVERITY="R"!(IBSEV="B") S IBREV="" F  S IBREV=$O(^IBM(361,"ACSA",SEVERITY,IBREV)) Q:IBREV=""  I IBREV<2 S IBDA=0 F  S IBDA=$O(^IBM(361,"ACSA",SEVERITY,IBREV,IBDA)) Q:'IBDA  D
"RTN","IBCECSA1",13,0)
 . S IB=$G(^IBM(361,IBDA,0)),IBIFN=+IB
"RTN","IBCECSA1",14,0)
 . S IBPEN=$$FMDIFF^XLFDT(DT,$P(IB,U,2),1)
"RTN","IBCECSA1",15,0)
 . ;quit if not pending for at least the minimum # of days requested
"RTN","IBCECSA1",16,0)
 . Q:IBDAYS>IBPEN
"RTN","IBCECSA1",17,0)
 . ;add No EOB bill check here in future
"RTN","IBCECSA1",18,0)
 . S IB399=$G(^DGCR(399,IBIFN,0))
"RTN","IBCECSA1",19,0)
 . S IBDIV=+$P(IB399,U,22)
"RTN","IBCECSA1",20,0)
 . S IBUER=+$P($G(^DGCR(399,IBIFN,"S")),U,11)
"RTN","IBCECSA1",21,0)
 . ;
"RTN","IBCECSA1",22,0)
 . ; If Request MRA bill, pull the MRA Requestor user instead
"RTN","IBCECSA1",23,0)
 . I 'IBUER,$P(IB399,U,13)=2 S IBUER=+$P($G(^DGCR(399,IBIFN,"S")),U,8)
"RTN","IBCECSA1",24,0)
 . I $D(^TMP("IBBIL",$J)),'$D(^TMP("IBBIL",$J,IBUER)) Q  ; User not selected
"RTN","IBCECSA1",25,0)
 . I $D(^TMP("IBDIV",$J)),'$D(^TMP("IBDIV",$J,IBDIV)) Q  ; Div not selected
"RTN","IBCECSA1",26,0)
 . ;
"RTN","IBCECSA1",27,0)
 . S IBPAY=$P($G(^DIC(36,+$P($G(^DGCR(399,IBIFN,"MP")),U),0)),U)
"RTN","IBCECSA1",28,0)
 . I IBPAY="" S IBPAY=$P($G(^DIC(36,+$$CURR^IBCEF2(IBIFN),0)),U)
"RTN","IBCECSA1",29,0)
 . I IBPAY="" S IBPAY="UNKNOWN PAYER"
"RTN","IBCECSA1",30,0)
 . S IBPAT=$G(^DPT(+$P(IB399,U,2),0))
"RTN","IBCECSA1",31,0)
 . S IBSSN=$E($P(IBPAT,U,9),6,9)
"RTN","IBCECSA1",32,0)
 . S IBPAT=$P(IBPAT,U)
"RTN","IBCECSA1",33,0)
 . S IBSER=$P($G(^DGCR(399,IBIFN,"U")),U)
"RTN","IBCECSA1",34,0)
 . S IBLOC=$P(IB399,U,4)
"RTN","IBCECSA1",35,0)
 . S IBLOC=$S(IBLOC=1:"HOSPITAL",IBLOC=2:"SKILLED NURSING",1:"CLINIC")
"RTN","IBCECSA1",36,0)
 . I IBDIV S IBDIV=$P($G(^DG(40.8,IBDIV,0)),U) S:IBDIV=""&(IBSORT1="D"!(IBSORT2="D")) IBDIV="UNSPECIFIED"
"RTN","IBCECSA1",37,0)
 . S IBMSG=$S($P(IB,U,8):"PAYER",1:"NON-PAYER")
"RTN","IBCECSA1",38,0)
 . S IBUER=$S(IBUER:$P($G(^VA(200,IBUER,0)),U),1:"UNKNOWN")_"~"_IBUER
"RTN","IBCECSA1",39,0)
 . S IB364=$P(IB,U,11)
"RTN","IBCECSA1",40,0)
 . S IBOAM=$$ORI^PRCAFN(IBIFN)  ;original amt
"RTN","IBCECSA1",41,0)
 . ;
"RTN","IBCECSA1",42,0)
 . ;error code
"RTN","IBCECSA1",43,0)
 . S IBERR="-"
"RTN","IBCECSA1",44,0)
 . I IBSORT1="E"!(IBSORT2="E") D
"RTN","IBCECSA1",45,0)
 .. N Z
"RTN","IBCECSA1",46,0)
 .. I '$O(^IBM(361,IBDA,1,0)) Q
"RTN","IBCECSA1",47,0)
 .. S IB=0 F  S IB=$O(^IBM(361,IBDA,1,IB)) Q:'IB  S Z=^(IB,0) I $TR(Z,"error","ERROR")["ERROR" S IBERR=$E(Z,1,30) Q
"RTN","IBCECSA1",48,0)
 . S IB=$$BN1^PRCAFN(IBIFN)
"RTN","IBCECSA1",49,0)
 . S A=IBIFN_U_IBPAY_U_IBPAT_U_IBSSN_U_IBSER_U_IBOAM_U_IBLOC_U_IBDIV_U_IBUER_U_IBMSG_U_IBPEN_U_$S(IBREV:"*",1:"")_U_IB364_U_IB
"RTN","IBCECSA1",50,0)
 . S ^TMP("IBCECSB",$J,$S(IBSORT1="D":IBDIV,IBSORT1="A":IBUER,IBSORT1="P":IBPAY,IBSORT1="N":-IBPEN,IBSORT1="B":IB,1:IBERR),$S(IBSORT2="D":IBDIV,IBSORT2="A":IBUER,IBSORT2="P":IBPAY,IBSORT2="N":-IBPEN,IBSORT2="B":IB,1:IBERR),IBDA)=A
"RTN","IBCECSA1",51,0)
 ;
"RTN","IBCECSA1",52,0)
 I '$D(^TMP("IBCECSB",$J)) D NMAT Q
"RTN","IBCECSA1",53,0)
 D SCRN
"RTN","IBCECSA1",54,0)
 Q
"RTN","IBCECSA1",55,0)
 ;
"RTN","IBCECSA1",56,0)
NMAT ;No CSA list
"RTN","IBCECSA1",57,0)
 S VALMCNT=2,IBCNT=2
"RTN","IBCECSA1",58,0)
 S ^TMP("IBCECSA",$J,1,0)=" "
"RTN","IBCECSA1",59,0)
 S ^TMP("IBCECSA",$J,2,0)="No Messages Matching Selection Criteria Found"
"RTN","IBCECSA1",60,0)
 Q
"RTN","IBCECSA1",61,0)
 ;
"RTN","IBCECSA1",62,0)
SCRN ;
"RTN","IBCECSA1",63,0)
 N IBSRT1,IBSRT2,IBS1,IBS2,IBSS1,IBSS2,IBX,IBCNT,IBIFN,IBDA,IB,INFX,DAT,X
"RTN","IBCECSA1",64,0)
 S IBCNT=0
"RTN","IBCECSA1",65,0)
 S IBS1=$S(IBSORT1="A":"AUTHORIZING BILLER",IBSORT1="B":"BILL NUMBER",IBSORT1="D":"DIVISION",IBSORT1="P":"PAYER",IBSORT1="N":"NUMBER OF DAYS PENDING",1:"ERROR CODE")
"RTN","IBCECSA1",66,0)
 S IBS2=$S(IBSORT2="A":"AUTHORIZING BILLER",IBSORT2="B":"BILL NUMBER",IBSORT2="D":"DIVISION",IBSORT2="P":"PAYER",IBSORT2="N":"NUMBER OF DAYS PENDING",1:"ERROR CODE")
"RTN","IBCECSA1",67,0)
 S IBSRT1="" F  S IBSRT1=$O(^TMP("IBCECSB",$J,IBSRT1)) Q:IBSRT1=""  D
"RTN","IBCECSA1",68,0)
 . S IBSS1=1
"RTN","IBCECSA1",69,0)
 . S IBSRT2="" F  S IBSRT2=$O(^TMP("IBCECSB",$J,IBSRT1,IBSRT2)) Q:IBSRT2=""  S IBSS2=1,IBDA=0 F  S IBDA=$O(^TMP("IBCECSB",$J,IBSRT1,IBSRT2,IBDA)) Q:'IBDA  D
"RTN","IBCECSA1",70,0)
 .. S IB=$G(^TMP("IBCECSB",$J,IBSRT1,IBSRT2,IBDA))
"RTN","IBCECSA1",71,0)
 .. S IBIFN=+IB
"RTN","IBCECSA1",72,0)
 .. S IB364=$P(IB,U,13)
"RTN","IBCECSA1",73,0)
 .. S DAT=IBIFN_U_IBDA_U_IBSRT1_U_IBSRT2_U_IB364
"RTN","IBCECSA1",74,0)
 .. I IBSS1 D:IBCNT SET(" ",IBCNT,"") S IBSS1=0 D:$S("BPE"[IBSORT1&("BPE"[IBSORT2):0,1:1) SET(IBS1_": "_$S(IBSRT1="-":"NONE",1:$P(IBSRT1,"~")),$S(IBCNT:IBCNT,1:1),"")
"RTN","IBCECSA1",75,0)
 .. I IBSS2 S IBSS2=0 D:$S("BPE"[IBSORT2:0,1:1) SET("  "_IBS2_": "_$S(IBS2="-":"NONE",1:$P(IBSRT2,"~")),$S(IBCNT:IBCNT,1:1),"")
"RTN","IBCECSA1",76,0)
 .. S IBCNT=IBCNT+1
"RTN","IBCECSA1",77,0)
 .. S X=$$SETFLD^VALM1(IBCNT,"","NUMBER")
"RTN","IBCECSA1",78,0)
 .. D SETL1(IB,.X)
"RTN","IBCECSA1",79,0)
 .. D SET(X,IBCNT,DAT)
"RTN","IBCECSA1",80,0)
 .. S IBX=$O(^IBM(361,IBDA,1,0)) I IBX D  D SET(X,IBCNT,DAT)
"RTN","IBCECSA1",81,0)
 ... S X=IBX,(IBERR,INFX,IBX)=0
"RTN","IBCECSA1",82,0)
 ... F  S IBX=$O(^IBM(361,IBDA,1,IBX)) Q:'IBX  S IB=$G(^(IBX,0)),IBERR=$S(IB["Error":IBX,1:0) Q:IBERR  I IB["Informational",'INFX S INFX=IBX
"RTN","IBCECSA1",83,0)
 ... I IBERR S X=$$SETSTR^VALM1($G(^IBM(361,IBDA,1,IBERR,0)),"",4,200) Q
"RTN","IBCECSA1",84,0)
 ... I INFX S X=$$SETSTR^VALM1($G(^IBM(361,IBDA,1,INFX,0)),"",4,200) Q
"RTN","IBCECSA1",85,0)
 ... S X=$$SETSTR^VALM1($G(^IBM(361,IBDA,1,X,0)),"",4,200)
"RTN","IBCECSA1",86,0)
 Q
"RTN","IBCECSA1",87,0)
 ;
"RTN","IBCECSA1",88,0)
SET(X,CNT,DAT) ;set up list manager screen array
"RTN","IBCECSA1",89,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCECSA1",90,0)
 S ^TMP("IBCECSA",$J,VALMCNT,0)=X
"RTN","IBCECSA1",91,0)
 S ^TMP("IBCECSA",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECSA1",92,0)
 I DAT'="" S ^TMP("IBCECSA",$J,CNT)=VALMCNT_U_DAT
"RTN","IBCECSA1",93,0)
 Q
"RTN","IBCECSA1",94,0)
 ;
"RTN","IBCECSA1",95,0)
SETL1(IB,X) ;
"RTN","IBCECSA1",96,0)
 S X=$$SETFLD^VALM1($P(IB,U,14)_$P(IB,U,12),X,"BILL")
"RTN","IBCECSA1",97,0)
 S X=$$SETFLD^VALM1($P(IB,U,2),X,"PNAME")
"RTN","IBCECSA1",98,0)
 S X=$$SETFLD^VALM1($E($P(IB,U,3),1,20)_"/"_$P(IB,U,4),X,"PANAME")
"RTN","IBCECSA1",99,0)
 S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IB,U,5)),X,"SERVICE")
"RTN","IBCECSA1",100,0)
 S X=$$SETFLD^VALM1("$"_$J($P(IB,U,6),0,2),X,"ABILL")
"RTN","IBCECSA1",101,0)
 Q
"RTN","IBCECSA1",102,0)
 ;
"RTN","IBCEST")
0^2^B65571445
"RTN","IBCEST",1,0)
IBCEST ;ALB/TMP - 837 EDI STATUS MESSAGE PROCESSING ;17-APR-96
"RTN","IBCEST",2,0)
 ;;2.0;INTEGRATED BILLING;**137,189,197,135,283**;21-MAR-94
"RTN","IBCEST",3,0)
 ; IA 4042 for call to AUDITX^PRCAUDT
"RTN","IBCEST",4,0)
 Q
"RTN","IBCEST",5,0)
 ;
"RTN","IBCEST",6,0)
UPD361(IBTDA) ; Update IB BILL STATUS MESSAGES file
"RTN","IBCEST",7,0)
 ; IBTDA = ien of return message in file 364.2
"RTN","IBCEST",8,0)
 ;
"RTN","IBCEST",9,0)
 N IB,IB0,IBSEQ,IB00,IBBILL,IBBTCH,IBMNUM
"RTN","IBCEST",10,0)
 ;
"RTN","IBCEST",11,0)
 I '$$LOCK^IBCEM(IBTDA) G UPDQ ;Lock message in file 364.2
"RTN","IBCEST",12,0)
 ;
"RTN","IBCEST",13,0)
 S IB0=$G(^IBA(364.2,IBTDA,0))
"RTN","IBCEST",14,0)
 S IBMNUM=$P(IB0,U) ; Message number
"RTN","IBCEST",15,0)
 S IB00=$G(^IBA(364,+$P(IB0,U,5),0)) ; Transmit bill entry
"RTN","IBCEST",16,0)
 S IBBILL=+IB00 ; Actual bill ien in file 399
"RTN","IBCEST",17,0)
 S IBBTCH=$P(IB0,U,4) ; Batch #
"RTN","IBCEST",18,0)
 ;
"RTN","IBCEST",19,0)
 ; Auto-audit bills based on status code on '10' record of status msg
"RTN","IBCEST",20,0)
 ; flat file
"RTN","IBCEST",21,0)
 I IBBILL,$P($T(PRCAUDT+1^PRCAUDT),"**",2)[",173" D
"RTN","IBCEST",22,0)
 . N Z,Z0,Z1,OK
"RTN","IBCEST",23,0)
 . Q:+$$STA^PRCAFN(IBBILL)'=104
"RTN","IBCEST",24,0)
 . S (Z,OK)=0
"RTN","IBCEST",25,0)
 . F  S Z=$O(^IBA(364.2,IBTDA,2,Z)) Q:'Z  S Z0=$P($G(^(Z,0)),"##RAW DATA: ",2) I +Z0=10 S Z0=$P(Z0,U,5) D  Q:OK
"RTN","IBCEST",26,0)
 .. ; Strip leading spaces
"RTN","IBCEST",27,0)
 .. F  S Z0=$P(Z0," ",2,99) Q:$E(Z0)'=" "
"RTN","IBCEST",28,0)
 .. Q:Z0=""
"RTN","IBCEST",29,0)
 .. I "A3^AC^A7^A8^AA^2P^10^11"[Z0,$P($G(^DGCR(399.3,+$P($G(^DGCR(399,IBBILL,0)),U,7),0)),U,11) D AUDITX^PRCAUDT(IBBILL) S OK=1 ; IA 4042
"RTN","IBCEST",30,0)
 ;
"RTN","IBCEST",31,0)
 I $S(IBMNUM="":1,1:'IBBILL&(IBBTCH="")) D DELMSG^IBCESRV2(IBTDA) G UPDQ
"RTN","IBCEST",32,0)
 ;
"RTN","IBCEST",33,0)
 ; Individual bill
"RTN","IBCEST",34,0)
 I IBBILL D  G UPDQ
"RTN","IBCEST",35,0)
 . N IBA1,IBMSG0,IBPID
"RTN","IBCEST",36,0)
 . S IBPID="",IBA1=0
"RTN","IBCEST",37,0)
 . F  S IBA1=$O(^IBA(364.2,IBTDA,2,IBA1)) Q:'IBA1  S IBMSG0=$P($G(^(IBA1,0)),"##RAW DATA: ",2) I +IBMSG0=277,$P(IBMSG0,U,5)="N" S IBPID=$P(IBMSG0,U,11) Q
"RTN","IBCEST",38,0)
 . S IBSEQ=$P(IB00,U,8) S:IBSEQ="" IBSEQ="P"
"RTN","IBCEST",39,0)
 . D STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,IBPID,1)
"RTN","IBCEST",40,0)
 ;
"RTN","IBCEST",41,0)
 ; Batch - update each bill separately
"RTN","IBCEST",42,0)
 S IBBILL=""
"RTN","IBCEST",43,0)
 F  S IBBILL=$O(^IBA(364,"ABABI",+IBBTCH,IBBILL)) Q:'IBBILL  D
"RTN","IBCEST",44,0)
 . Q:$D(^TMP("IBCONF",$J,IBBILL))  ;Bill was rejected
"RTN","IBCEST",45,0)
 . S IB=$O(^IBA(364,"ABABI",+IBBTCH,IBBILL,0)) Q:'IB
"RTN","IBCEST",46,0)
 . S IBSEQ=$P($G(^IBA(364,IB,0)),U,8) S:IBSEQ="" IBSEQ="P"
"RTN","IBCEST",47,0)
 . D STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,"",0)
"RTN","IBCEST",48,0)
 ;
"RTN","IBCEST",49,0)
 Q
"RTN","IBCEST",50,0)
 ;
"RTN","IBCEST",51,0)
STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,IBPID,IB1) ;
"RTN","IBCEST",52,0)
 ;
"RTN","IBCEST",53,0)
 ; IB0 = 0-node of message in file 364.2
"RTN","IBCEST",54,0)
 ; IBBTCH = ien of batch in file 364.1
"RTN","IBCEST",55,0)
 ; IBMNUM = actual message number
"RTN","IBCEST",56,0)
 ; IBTDA = ien of message in file 364.2
"RTN","IBCEST",57,0)
 ; IBBILL = ien of bill in 399
"RTN","IBCEST",58,0)
 ; IBSEQ = P/S/T/ for COB sequence related to message
"RTN","IBCEST",59,0)
 ; IBPID = the payer id returned from clearinghouse for the claim
"RTN","IBCEST",60,0)
 ; IB1 = flag that says if the message was for a single bill or a batch.
"RTN","IBCEST",61,0)
 ;       Batch statuses have an additional standard text entry.
"RTN","IBCEST",62,0)
 ;       1 = single bill 0 = batch
"RTN","IBCEST",63,0)
 ; 
"RTN","IBCEST",64,0)
 N DA,DIK,DIE,DIC,X,Y,DR,DO,DD,DLAYGO,Z,Z0,Z1,IBE,IBT,IBDUP,IBFLDS,IBY,IBAUTO
"RTN","IBCEST",65,0)
 ;
"RTN","IBCEST",66,0)
 S X=IBBILL,IBDUP=0
"RTN","IBCEST",67,0)
 ;
"RTN","IBCEST",68,0)
 I $D(^IBM(361,"AC",IBMNUM\1)) D  ; Message already there for bill
"RTN","IBCEST",69,0)
 . S Z=0 F  S Z=$O(^IBM(361,"AC",IBMNUM\1,Z)) Q:'Z  I +$G(^IBM(361,Z,0))=IBBILL S IBDUP=Z Q
"RTN","IBCEST",70,0)
 ;
"RTN","IBCEST",71,0)
 S IBFLDS=".02////"_$P(IB0,U,3)
"RTN","IBCEST",72,0)
 S IBFLDS=IBFLDS_";.03////"_$S($$EXTERNAL^DILFD(364.2,.02,"U",$P(IB0,U,2))["REJ":"R",1:"I")_";.05////"_IBBTCH_";.06////"_IBMNUM_";.04////"_+$P(IB0,U,8)_";.07////"_IBSEQ_$S($P(IB0,U,5):";.11////"_$P(IB0,U,5),1:"")
"RTN","IBCEST",73,0)
 S IBFLDS=IBFLDS_";.12////"_$P(IB0,U,10)_";.09////0"
"RTN","IBCEST",74,0)
 I IBPID'="" D
"RTN","IBCEST",75,0)
 . S IBPID("TYPE")=$S($$FT^IBCEF(IBBILL)=2:"P",1:"I")
"RTN","IBCEST",76,0)
 . D UPDINS(.IBPID,$$POLICY^IBCEF(IBBILL,1,$TR(IBSEQ,"PST","123")),IBBILL)
"RTN","IBCEST",77,0)
 ;
"RTN","IBCEST",78,0)
 I IBDUP D  I $D(Y) G UPDQ
"RTN","IBCEST",79,0)
 . ; Stuff fields into existing entry
"RTN","IBCEST",80,0)
 . ; (may be needed for reprocessing of aborted updates)
"RTN","IBCEST",81,0)
 . S DIE="^IBM(361,",DA=IBDUP,DR=IBFLDS_";1///@"
"RTN","IBCEST",82,0)
 . D ^DIE
"RTN","IBCEST",83,0)
 . I $D(Y) S IBY=-1 Q  ;Update not successful
"RTN","IBCEST",84,0)
 . S IBY=IBDUP
"RTN","IBCEST",85,0)
 ;
"RTN","IBCEST",86,0)
 K IBT
"RTN","IBCEST",87,0)
 I 'IBDUP D  ; Create new entry and stuff fields
"RTN","IBCEST",88,0)
 . S DIC(0)="L",DIC="^IBM(361,",DLAYGO=361
"RTN","IBCEST",89,0)
 . S DIC("DR")=IBFLDS
"RTN","IBCEST",90,0)
 . D FILE^DICN
"RTN","IBCEST",91,0)
 . K DO,DD,DLAYGO,DIC
"RTN","IBCEST",92,0)
 . S IBY=+Y
"RTN","IBCEST",93,0)
 . Q:IBY'>0
"RTN","IBCEST",94,0)
 . F Z=1:1:10 L +^IBM(361,"AD",IBBILL):10 Q:$T
"RTN","IBCEST",95,0)
 . I '$T S DA=IBY,DIK="^IBM(361," D ^DIK S IBY=-1 Q
"RTN","IBCEST",96,0)
 . S Z=0
"RTN","IBCEST",97,0)
 . F  S Z=$O(^IBM(361,"AD",IBBILL,+$P(IB0,U,10),Z)) Q:'Z  I Z'=IBY D  Q:IBY'>0
"RTN","IBCEST",98,0)
 .. ; Check for same exact message
"RTN","IBCEST",99,0)
 .. N IB0,IBT
"RTN","IBCEST",100,0)
 .. S IB0=$G(^IBM(361,Z,0)),IB00=$G(^IBM(361,IBY,0))
"RTN","IBCEST",101,0)
 .. S $P(IB0,U,6)="",$P(IB00,U,6)=""
"RTN","IBCEST",102,0)
 .. I $P(IB0,U,3,8)=$P(IB00,U,3,8) D
"RTN","IBCEST",103,0)
 ... N IBSAME
"RTN","IBCEST",104,0)
 ... D BLDMSG(IB1,IBTDA,.IBT)
"RTN","IBCEST",105,0)
 ... S IBSAME=1,(Z1,Z0)=0 F  S Z0=$O(^IBM(361,Z,1,Z0)) S:'Z0&($O(IBT(Z1))) IBSAME=0 Q:'Z0  S Z1=Z0 I $G(IBT(Z0))'=$G(^IBM(361,Z,1,Z0,0)) S IBSAME=0 Q
"RTN","IBCEST",106,0)
 ... I IBSAME S DIK="^IBM(361,",DA=IBY,IBY=-1 D ^DIK D DELMSG^IBCESRV2(IBTDA)
"RTN","IBCEST",107,0)
 ;
"RTN","IBCEST",108,0)
 I IBY>0 D  ;Move text over
"RTN","IBCEST",109,0)
 . K IBE("DIERR"),IBT
"RTN","IBCEST",110,0)
 . ;
"RTN","IBCEST",111,0)
 . D BLDMSG(IB1,IBTDA,.IBT,.IBAUTO)
"RTN","IBCEST",112,0)
 . ; if info msg, ck for no review needed based on first line of text
"RTN","IBCEST",113,0)
 . I $G(IBAUTO),$P($G(^IBM(361,+IBY,0)),U,3)="I" D
"RTN","IBCEST",114,0)
 .. S DIE="^IBM(361,",DR=".09////2;.14////1;.1////F",DA=+IBY D ^DIE
"RTN","IBCEST",115,0)
 .. I IB1,$P($G(^IBM(361,+IBY,0)),U,11),$$PRINTUPD^IBCEU0($G(IBT(1)),$P($G(^IBM(361,+IBY,0)),U,11))
"RTN","IBCEST",116,0)
 . ;
"RTN","IBCEST",117,0)
 . F Z=1:1:20 D WP^DIE(361,+IBY_",",1,"AK","IBT","IBE") Q:$S('$D(IBE("DIERR")):1,+IBE("DIERR")=1:$G(IBE("DIERR",1))'=110,1:1)  K IBE("DIERR") ; On lock error (110), retry up to 20 times
"RTN","IBCEST",118,0)
 . ;
"RTN","IBCEST",119,0)
 . ; Delete message after it successfully updates the database.
"RTN","IBCEST",120,0)
 . I '$D(IBE("DIERR")) D DELMSG^IBCESRV2(IBTDA)
"RTN","IBCEST",121,0)
 ;
"RTN","IBCEST",122,0)
UPDQ L -^IBA(364.2,IBTDA,0),-^IBM(361,"AD",IBBILL)
"RTN","IBCEST",123,0)
 Q
"RTN","IBCEST",124,0)
 ;
"RTN","IBCEST",125,0)
BLDMSG(IB1,IBTDA,IBT,IBAUTO) ; Builds message text
"RTN","IBCEST",126,0)
 ; IB1 = flag for batch message
"RTN","IBCEST",127,0)
 ; IBTDA = ien of entry in file 364.2
"RTN","IBCEST",128,0)
 ; IBT = array returned with message text
"RTN","IBCEST",129,0)
 ; IBAUTO = if passed by reference, returns 1 if text indicates review
"RTN","IBCEST",130,0)
 ;          not needed
"RTN","IBCEST",131,0)
 N IBDATA,IBCK,IBZ,IBZ0,IBZ1,Z
"RTN","IBCEST",132,0)
 S (IBZ,IBZ0,IBDATA,IBAUTO,IBCK)=0
"RTN","IBCEST",133,0)
 I 'IB1 S IBT(1)="Status message received for batch "_$P($G(^IBA(364.1,IBBTCH,0)),U)_" dated "_$$FMTE^XLFDT($P($G(^IBA(364.2,IBTDA,0)),U,10),2),IBZ0=1
"RTN","IBCEST",134,0)
 ; Don't move the raw data over, just move the text of the message
"RTN","IBCEST",135,0)
 F  S IBZ=$O(^IBA(364.2,IBTDA,2,IBZ)) Q:'IBZ  S IBZ1=$G(^(IBZ,0)) S IBDATA=($E(IBZ1,1,2)="##") Q:IBDATA  S IBZ0=IBZ0+1,IBT(IBZ0)=IBZ1 I 'IBCK S Z=$$CKREVU^IBCEM4(IBZ1,,,.IBCK),IBAUTO=$S(IBCK:0,Z:1,1:IBAUTO)
"RTN","IBCEST",136,0)
 ;
"RTN","IBCEST",137,0)
 ; Convert Message Lines in IBT to be no longer than 70 chars
"RTN","IBCEST",138,0)
 D MSGLNSZ(.IBT)
"RTN","IBCEST",139,0)
 Q
"RTN","IBCEST",140,0)
 ;
"RTN","IBCEST",141,0)
UPDINS(IBPID,IBINS,IBIFN) ; Update the insurance id or the bill printed at
"RTN","IBCEST",142,0)
 ;    the EDI contractor's print shop and mailed to the ins co.
"RTN","IBCEST",143,0)
 ; IBPID = the id returned from the EDI contractor for the ins co
"RTN","IBCEST",144,0)
 ;      ("TYPE") = P if professional id or I if institutional id
"RTN","IBCEST",145,0)
 ; IBINS = the ien of the insurance co it was sent to (file 36)
"RTN","IBCEST",146,0)
 ; IBIFN = the ien of the claim (file 399)
"RTN","IBCEST",147,0)
 ;
"RTN","IBCEST",148,0)
 N IBID,IBIDFLD,IBPRT,IBLOOK,DA,DR,DIE,X,Y,Z
"RTN","IBCEST",149,0)
 ;
"RTN","IBCEST",150,0)
 Q:'$G(IBINS)!($G(IBPID)="")
"RTN","IBCEST",151,0)
 ;
"RTN","IBCEST",152,0)
 ; Strip spaces off the end of data
"RTN","IBCEST",153,0)
 S IBLOOK=""
"RTN","IBCEST",154,0)
 I $L(IBPID) F Z=$L(IBPID):-1:1 I $E(IBPID,Z)'=" " S IBLOOK=$E(IBPID,1,Z) Q
"RTN","IBCEST",155,0)
 ;
"RTN","IBCEST",156,0)
 S IBPRT=($E(IBLOOK,2,5)="PRNT")
"RTN","IBCEST",157,0)
 I IBPRT D  ; Set printed via EDI field on bill
"RTN","IBCEST",158,0)
 . S DA=IBIFN,DIE="^DGCR(399,",DR="26////1" D ^DIE
"RTN","IBCEST",159,0)
 ;
"RTN","IBCEST",160,0)
 S IBLOOK=$E($S('IBPRT:$P(IBLOOK,"PAYID=",2),1:""),1,5)
"RTN","IBCEST",161,0)
 Q:IBLOOK=""!($E(IBLOOK,2,5)="PRNT")
"RTN","IBCEST",162,0)
 S IBIDFLD="3.0"_$S($G(IBPID("TYPE"))="I":4,1:2)
"RTN","IBCEST",163,0)
 S IBID=$P($G(^DIC(36,+IBINS,3)),U,IBIDFLD*100#100)
"RTN","IBCEST",164,0)
 Q:IBID=IBLOOK
"RTN","IBCEST",165,0)
 I IBID="" D  G UPDINSQ ; Update insurance co electronic id # if blank
"RTN","IBCEST",166,0)
 . S DIE="^DIC(36,",DR=IBIDFLD_"////"_IBLOOK,DA=IBINS D ^DIE
"RTN","IBCEST",167,0)
 I IBID'="",IBLOOK'="" D  ; Bulletin that the id on file and id returned
"RTN","IBCEST",168,0)
 . ; are different
"RTN","IBCEST",169,0)
 . N XMTO,XMDUZ,XMBODY,IBXM,XMSUBJ,XMZ
"RTN","IBCEST",170,0)
 . S XMTO("I:G.IB EDI")=""
"RTN","IBCEST",171,0)
 . S XMDUZ="",XMBODY="IBXM",XMSUBJ="PAYER ID RETURNED IS DIFFERENT THAN PAYER ID ON FILE"
"RTN","IBCEST",172,0)
 . S IBXM(1)="BILL #     : "_$P($G(^DGCR(399,IBIFN,0)),U)
"RTN","IBCEST",173,0)
 . S IBXM(2)="PAYER      : "_$P($G(^DIC(36,+IBINS,0)),U)
"RTN","IBCEST",174,0)
 . S IBXM(3)="BILL TYPE  : "_$S($G(IBPID("TYPE"))="I":"INSTITUT",1:"PROFESS")_"IONAL"
"RTN","IBCEST",175,0)
 . S IBXM(4)="ID ON FILE : "_IBID
"RTN","IBCEST",176,0)
 . S IBXM(5)="ID RETURNED: "_IBLOOK
"RTN","IBCEST",177,0)
 . S IBXM(6)=" ",IBXM(7)="   Please determine which id number is correct and correct the id in the",IBXM(8)="insurance file for this payer, if needed"
"RTN","IBCEST",178,0)
 . D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","IBCEST",179,0)
 ;
"RTN","IBCEST",180,0)
UPDINSQ Q
"RTN","IBCEST",181,0)
 ;
"RTN","IBCEST",182,0)
MSGLNSZ(MSG) ; Change Input Message Lines to be no more than 70 characters long each
"RTN","IBCEST",183,0)
 ;
"RTN","IBCEST",184,0)
 ; Input/Output:   MSG  - array of Input Message Lines; this is also the Output Message
"RTN","IBCEST",185,0)
 ; which is an array of Converted Message Lines (with lines no more than 70 chars each)
"RTN","IBCEST",186,0)
 ;
"RTN","IBCEST",187,0)
 N LN,XARY,XARYLN,CNT,OUTMSG,TMPMSG,LDNGSP
"RTN","IBCEST",188,0)
 S LN="",CNT=0
"RTN","IBCEST",189,0)
 F  S LN=$O(MSG(LN)) Q:LN=""  D  ;
"RTN","IBCEST",190,0)
 . ;
"RTN","IBCEST",191,0)
 . ; Find any leading spaces in original message line, 
"RTN","IBCEST",192,0)
 . ; to be used if line got split below
"RTN","IBCEST",193,0)
 . S TMPMSG=$$TRIM^XLFSTR(MSG(LN),"L"," ")  ;Trim Leading Spaces
"RTN","IBCEST",194,0)
 . S LDNGSP=$P(MSG(LN),TMPMSG,1)  ;get leading spaces if any
"RTN","IBCEST",195,0)
 . ;
"RTN","IBCEST",196,0)
 . ; Converts a single line to multiple lines with a maximum width of 70 each
"RTN","IBCEST",197,0)
 . ; If line is 70 chars or less, this call returns the exact line
"RTN","IBCEST",198,0)
 . K XARY D FSTRNG^IBJU1(MSG(LN),70,.XARY)
"RTN","IBCEST",199,0)
 . ;
"RTN","IBCEST",200,0)
 . ; Scan lines and merge them into the final output array (OUTMSG)
"RTN","IBCEST",201,0)
 . ; On lines 2 and higher, add Leading Spaces found above, if any.
"RTN","IBCEST",202,0)
 . S XARYLN=""
"RTN","IBCEST",203,0)
 . F  S XARYLN=$O(XARY(XARYLN)) Q:XARYLN=""  S CNT=CNT+1,OUTMSG(CNT)=$S(XARYLN=1:XARY(XARYLN),1:LDNGSP_XARY(XARYLN))
"RTN","IBCEST",204,0)
 ;
"RTN","IBCEST",205,0)
 ; Move the final Message Lines (OUTMSG) into MSG array to be returned
"RTN","IBCEST",206,0)
 K MSG M MSG=OUTMSG
"RTN","IBCEST",207,0)
 Q  ;MSGLNSZ
"RTN","IBCEST",208,0)
 ;
"RTN","IBY283PO")
0^^B36843159
"RTN","IBY283PO",1,0)
IBY283PO ;ALB/ESG - Post Install for IB patch 283 ;24-AUG-2004
"RTN","IBY283PO",2,0)
 ;;2.0;INTEGRATED BILLING;**283**;21-MAR-94
"RTN","IBY283PO",3,0)
 ; IA#2916 for call to CREIXN^DDMOD
"RTN","IBY283PO",4,0)
 ;
"RTN","IBY283PO",5,0)
EN ;
"RTN","IBY283PO",6,0)
 N XPDIDTOT S XPDIDTOT=4
"RTN","IBY283PO",7,0)
 D TEXT         ; new text entries in file 361.3
"RTN","IBY283PO",8,0)
 D ACSA         ; new index file for 361
"RTN","IBY283PO",9,0)
 D AUTOFILE     ; examine informational messages for auto-file
"RTN","IBY283PO",10,0)
 D PARAM        ; site parameter purge value
"RTN","IBY283PO",11,0)
EX ;
"RTN","IBY283PO",12,0)
 Q
"RTN","IBY283PO",13,0)
 ;
"RTN","IBY283PO",14,0)
TEXT ; Add new text entries in file 361.3 - IB MESSAGE SCREEN TEXT
"RTN","IBY283PO",15,0)
 NEW DATA,TXT,DO,DA,DIC,X,Y
"RTN","IBY283PO",16,0)
 D BMES^XPDUTL(" STEP 1 of 4")
"RTN","IBY283PO",17,0)
 D MES^XPDUTL("-------------")
"RTN","IBY283PO",18,0)
 D MES^XPDUTL("Adding new entries into file 361.3 ....")
"RTN","IBY283PO",19,0)
 S DATA("CLAIM RECEIVED")=""
"RTN","IBY283PO",20,0)
 S DATA("ACK/ACCEPTANCE HAS BEEN ACCEPT")=""
"RTN","IBY283PO",21,0)
 S DATA("COMPLETED: PAYMENT MADE")=""
"RTN","IBY283PO",22,0)
 S DATA("FINALIZED-PAYMENT: PAYMENT REF")=""
"RTN","IBY283PO",23,0)
 S TXT=""
"RTN","IBY283PO",24,0)
 F  S TXT=$O(DATA(TXT)) Q:TXT=""  D
"RTN","IBY283PO",25,0)
 . I $D(^IBE(361.3,"B",TXT)) Q      ; already on file
"RTN","IBY283PO",26,0)
 . S DIC="^IBE(361.3,",DIC(0)="F",X=TXT
"RTN","IBY283PO",27,0)
 . S DIC("DR")=".02////0"
"RTN","IBY283PO",28,0)
 . D FILE^DICN
"RTN","IBY283PO",29,0)
 . Q
"RTN","IBY283PO",30,0)
TX ;
"RTN","IBY283PO",31,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY283PO",32,0)
 D UPDATE^XPDID(1)
"RTN","IBY283PO",33,0)
 Q
"RTN","IBY283PO",34,0)
 ;
"RTN","IBY283PO",35,0)
ACSA ; Build the new "ACSA" index for file 361
"RTN","IBY283PO",36,0)
 NEW IBMXR,IBMRES,IBMOUT
"RTN","IBY283PO",37,0)
 S IBMXR("FILE")=361
"RTN","IBY283PO",38,0)
 S IBMXR("NAME")="ACSA"
"RTN","IBY283PO",39,0)
 S IBMXR("TYPE")="R"
"RTN","IBY283PO",40,0)
 S IBMXR("USE")="S"
"RTN","IBY283PO",41,0)
 S IBMXR("EXECUTION")="R"
"RTN","IBY283PO",42,0)
 S IBMXR("ACTIVITY")="IR"
"RTN","IBY283PO",43,0)
 S IBMXR("SHORT DESCR")="Index by Message Severity and Review Status"
"RTN","IBY283PO",44,0)
 S IBMXR("DESCR",1)="This index is used in the CSA screen (Claims Status Awaiting"
"RTN","IBY283PO",45,0)
 S IBMXR("DESCR",2)="Resolution).  Most often the CSA screen is built with unreviewed"
"RTN","IBY283PO",46,0)
 S IBMXR("DESCR",3)="rejection messages.  This index file can immediately locate them."
"RTN","IBY283PO",47,0)
 S IBMXR("VAL",1)=.03
"RTN","IBY283PO",48,0)
 S IBMXR("VAL",1,"SUBSCRIPT")=1
"RTN","IBY283PO",49,0)
 S IBMXR("VAL",1,"COLLATION")="F"
"RTN","IBY283PO",50,0)
 S IBMXR("VAL",2)=.09
"RTN","IBY283PO",51,0)
 S IBMXR("VAL",2,"SUBSCRIPT")=2
"RTN","IBY283PO",52,0)
 S IBMXR("VAL",2,"COLLATION")="F"
"RTN","IBY283PO",53,0)
 ;
"RTN","IBY283PO",54,0)
 D BMES^XPDUTL(" STEP 2 of 4")
"RTN","IBY283PO",55,0)
 D MES^XPDUTL("-------------")
"RTN","IBY283PO",56,0)
 D MES^XPDUTL("A new index will now be created for file 361.")
"RTN","IBY283PO",57,0)
 D MES^XPDUTL("This may take some time depending on how many entries are in file 361.")
"RTN","IBY283PO",58,0)
 D CREIXN^DDMOD(.IBMXR,"SW",.IBMRES,"IBMOUT")
"RTN","IBY283PO",59,0)
 I +$G(IBMRES) D MES^XPDUTL("Index successfully created!") G ACSAX
"RTN","IBY283PO",60,0)
 ;
"RTN","IBY283PO",61,0)
 ; Index not created
"RTN","IBY283PO",62,0)
 D MES^XPDUTL("A PROBLEM WAS ENCOUNTERED.  INDEX FILE NOT CREATED!!!")
"RTN","IBY283PO",63,0)
 D MES^XPDUTL("SENDING MAILMAN MESSAGE...")
"RTN","IBY283PO",64,0)
 D MES^XPDUTL("PLACING THE CSA SCREEN OUT-OF-ORDER.")
"RTN","IBY283PO",65,0)
 NEW XMDUZ,XMSUBJ,XMBODY,MSG,XMTO,DA,DIE,DR
"RTN","IBY283PO",66,0)
 S XMDUZ=DUZ,XMSUBJ="IB*2*283 Error:  ACSA index not built",XMBODY="MSG"
"RTN","IBY283PO",67,0)
 S MSG(1)="The new ""ACSA"" index for file 361 was not created at"
"RTN","IBY283PO",68,0)
 S MSG(2)=" "
"RTN","IBY283PO",69,0)
 S MSG(3)="     "_$$SITE^VASITE
"RTN","IBY283PO",70,0)
 S MSG(4)=" "
"RTN","IBY283PO",71,0)
 S MSG(5)="The CSA screen has been placed out of order."
"RTN","IBY283PO",72,0)
 ;
"RTN","IBY283PO",73,0)
 ; recipients of message
"RTN","IBY283PO",74,0)
 S XMTO(DUZ)=""
"RTN","IBY283PO",75,0)
 S XMTO("eric.gustafson@daou.com")=""
"RTN","IBY283PO",76,0)
 S XMTO("G.PATCHES")=""
"RTN","IBY283PO",77,0)
 S XMTO("G.IB EDI")=""
"RTN","IBY283PO",78,0)
 S XMTO("G.IB EDI SUPERVISOR")=""
"RTN","IBY283PO",79,0)
 ;
"RTN","IBY283PO",80,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,XMBODY,.XMTO)
"RTN","IBY283PO",81,0)
 ;
"RTN","IBY283PO",82,0)
 ; place CSA screen out of order
"RTN","IBY283PO",83,0)
 S DA=$O(^DIC(19,"B","IBCE CLAIMS STATUS AWAITING",""))
"RTN","IBY283PO",84,0)
 I DA S DIE=19,DR="2///IB Patch 283 Installation Failure" D ^DIE
"RTN","IBY283PO",85,0)
ACSAX ;
"RTN","IBY283PO",86,0)
 D UPDATE^XPDID(2)
"RTN","IBY283PO",87,0)
 Q
"RTN","IBY283PO",88,0)
 ;
"RTN","IBY283PO",89,0)
AUTOFILE ; Loop through the informational status messages with
"RTN","IBY283PO",90,0)
 ; no Final Review Action and check to see if they qualify for
"RTN","IBY283PO",91,0)
 ; auto-file with no review.
"RTN","IBY283PO",92,0)
 ;
"RTN","IBY283PO",93,0)
 NEW IBDA,IBCNT,IB,Z,STOP,IBAUTO,TXT,NOREVU,IBREV
"RTN","IBY283PO",94,0)
 D BMES^XPDUTL(" STEP 3 of 4")
"RTN","IBY283PO",95,0)
 D MES^XPDUTL("-------------")
"RTN","IBY283PO",96,0)
 D MES^XPDUTL("Now looking at all informational status messages on file to see if any of them")
"RTN","IBY283PO",97,0)
 D MES^XPDUTL("can be auto-filed with no review needed.  Each ""."" represents 1000 messages.")
"RTN","IBY283PO",98,0)
 D MES^XPDUTL("")
"RTN","IBY283PO",99,0)
 S IBDA=0,IBCNT=0
"RTN","IBY283PO",100,0)
 F  S IBDA=$O(^IBM(361,"ASV","I",IBDA)) Q:'IBDA  D
"RTN","IBY283PO",101,0)
 . S IBCNT=IBCNT+1 W:(IBCNT#1000=0)&'$D(ZTQUEUED) "."
"RTN","IBY283PO",102,0)
 . S IB=$G(^IBM(361,IBDA,0))
"RTN","IBY283PO",103,0)
 . ;
"RTN","IBY283PO",104,0)
 . I $P(IB,U,10)'="" Q     ; final review action exists so quit out
"RTN","IBY283PO",105,0)
 . ;
"RTN","IBY283PO",106,0)
 . ; if this message was previously auto-filed with no review, then
"RTN","IBY283PO",107,0)
 . ; update the final review information and quit out
"RTN","IBY283PO",108,0)
 . I $P(IB,U,9)=2,$P(IB,U,14)=1 D  Q
"RTN","IBY283PO",109,0)
 .. N DIE,DR,DA
"RTN","IBY283PO",110,0)
 .. S DIE=361,DR=".1////F",DA=IBDA D ^DIE
"RTN","IBY283PO",111,0)
 .. Q
"RTN","IBY283PO",112,0)
 . ;
"RTN","IBY283PO",113,0)
 . ; IBAUTO - flag indicating that the whole message can be auto-filed
"RTN","IBY283PO",114,0)
 . ;          with no review needed
"RTN","IBY283PO",115,0)
 . ; NOREVU - flag indicating that one of the message lines had 'No
"RTN","IBY283PO",116,0)
 . ;          Review Needed' text
"RTN","IBY283PO",117,0)
 . ; IBREV  - flag indicating that one of the message lines had 'Review
"RTN","IBY283PO",118,0)
 . ;          Always Needed' text (so the whole message needs review)
"RTN","IBY283PO",119,0)
 . ;
"RTN","IBY283PO",120,0)
 . S Z=0,STOP=0,IBAUTO=0
"RTN","IBY283PO",121,0)
 . F  S Z=$O(^IBM(361,IBDA,1,Z)) Q:'Z  D  Q:STOP
"RTN","IBY283PO",122,0)
 .. S TXT=$G(^IBM(361,IBDA,1,Z,0)) Q:TXT=""   ; text line Z
"RTN","IBY283PO",123,0)
 .. S NOREVU=$$CKREVU^IBCEM4(TXT,,,.IBREV)    ; call function
"RTN","IBY283PO",124,0)
 .. I IBREV S STOP=1,IBAUTO=0 Q       ; 'review always needed' text found
"RTN","IBY283PO",125,0)
 .. I NOREVU S IBAUTO=1    ; 'no review needed' text found
"RTN","IBY283PO",126,0)
 .. Q
"RTN","IBY283PO",127,0)
 . ;
"RTN","IBY283PO",128,0)
 . I IBAUTO D
"RTN","IBY283PO",129,0)
 .. N DIE,DR,DA
"RTN","IBY283PO",130,0)
 .. S DIE=361,DR=".09////2;.14////1;.1////F",DA=IBDA D ^DIE
"RTN","IBY283PO",131,0)
 .. Q
"RTN","IBY283PO",132,0)
 . Q
"RTN","IBY283PO",133,0)
 ;
"RTN","IBY283PO",134,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY283PO",135,0)
 D UPDATE^XPDID(3)
"RTN","IBY283PO",136,0)
 Q
"RTN","IBY283PO",137,0)
 ;
"RTN","IBY283PO",138,0)
PARAM ; Ensure there is a value in IB site parameter field 350.9,8.02
"RTN","IBY283PO",139,0)
 ; "Days to wait to purge messages"
"RTN","IBY283PO",140,0)
 ; If not defined, set it to be 90 days.
"RTN","IBY283PO",141,0)
 ;
"RTN","IBY283PO",142,0)
 N A
"RTN","IBY283PO",143,0)
 S A=$G(^IBE(350.9,1,8))
"RTN","IBY283PO",144,0)
 D BMES^XPDUTL(" STEP 4 of 4")
"RTN","IBY283PO",145,0)
 D MES^XPDUTL("-------------")
"RTN","IBY283PO",146,0)
 ;
"RTN","IBY283PO",147,0)
 I $P(A,U,2) D  G PARAMX      ; quit out if field is defined
"RTN","IBY283PO",148,0)
 . D MES^XPDUTL("IB site parameter value ""Days to wait to purge status messages"" is set to "_$P(A,U,2)_".")
"RTN","IBY283PO",149,0)
 . D MES^XPDUTL(" No changes made.")
"RTN","IBY283PO",150,0)
 . Q
"RTN","IBY283PO",151,0)
 ;
"RTN","IBY283PO",152,0)
 D MES^XPDUTL("IB site parameter value ""Days to wait to purge status messages"" is not defined.")
"RTN","IBY283PO",153,0)
 D MES^XPDUTL("Setting this parameter value to 90 ....")
"RTN","IBY283PO",154,0)
 S $P(^IBE(350.9,1,8),U,2)=90    ; set to 90 days if undefined
"RTN","IBY283PO",155,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY283PO",156,0)
PARAMX ;
"RTN","IBY283PO",157,0)
 D UPDATE^XPDID(4)
"RTN","IBY283PO",158,0)
 Q
"RTN","IBY283PO",159,0)
 ;
"VER")
8.0^22.0
**END**
**END**
