Released RMPR*3*82 SEQ #74
Extracted from mail message
**KIDS**:RMPR*3.0*82^

**INSTALL NAME**
RMPR*3.0*82
"BLD",4780,0)
RMPR*3.0*82^PROSTHETICS^0^3040809^y
"BLD",4780,1,0)
^^2^2^3040227^
"BLD",4780,1,1,0)
Add text to the PCE Interface Message and Remove SSN from the Patient 
"BLD",4780,1,2,0)
Correspondence and Patient Notification Letters.
"BLD",4780,4,0)
^9.64PA^^
"BLD",4780,"ABPKG")
n
"BLD",4780,"KRN",0)
^9.67PA^8989.52^19
"BLD",4780,"KRN",.4,0)
.4
"BLD",4780,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",.401,0)
.401
"BLD",4780,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",.402,0)
.402
"BLD",4780,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",.403,0)
.403
"BLD",4780,"KRN",.5,0)
.5
"BLD",4780,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",.84,0)
.84
"BLD",4780,"KRN",3.6,0)
3.6
"BLD",4780,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",3.8,0)
3.8
"BLD",4780,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",9.2,0)
9.2
"BLD",4780,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",9.8,0)
9.8
"BLD",4780,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",4780,"KRN",9.8,"NM",1,0)
RMPRPCEB^^0^B19107003
"BLD",4780,"KRN",9.8,"NM",2,0)
RMPRFO^^0^B10863611
"BLD",4780,"KRN",9.8,"NM",3,0)
RMPRP24^^0^B10480052
"BLD",4780,"KRN",9.8,"NM",4,0)
RMPRPCEA^^0^B24300097
"BLD",4780,"KRN",9.8,"NM",5,0)
RMPRFO3^^0^B33520812
"BLD",4780,"KRN",9.8,"NM",6,0)
RMPRFO6^^0^B2899949
"BLD",4780,"KRN",9.8,"NM","B","RMPRFO",2)

"BLD",4780,"KRN",9.8,"NM","B","RMPRFO3",5)

"BLD",4780,"KRN",9.8,"NM","B","RMPRFO6",6)

"BLD",4780,"KRN",9.8,"NM","B","RMPRP24",3)

"BLD",4780,"KRN",9.8,"NM","B","RMPRPCEA",4)

"BLD",4780,"KRN",9.8,"NM","B","RMPRPCEB",1)

"BLD",4780,"KRN",19,0)
19
"BLD",4780,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",19.1,0)
19.1
"BLD",4780,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",101,0)
101
"BLD",4780,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",409.61,0)
409.61
"BLD",4780,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",4780,"KRN",771,0)
771
"BLD",4780,"KRN",870,0)
870
"BLD",4780,"KRN",8989.51,0)
8989.51
"BLD",4780,"KRN",8989.52,0)
8989.52
"BLD",4780,"KRN",8994,0)
8994
"BLD",4780,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",4780,"KRN","B",.4,.4)

"BLD",4780,"KRN","B",.401,.401)

"BLD",4780,"KRN","B",.402,.402)

"BLD",4780,"KRN","B",.403,.403)

"BLD",4780,"KRN","B",.5,.5)

"BLD",4780,"KRN","B",.84,.84)

"BLD",4780,"KRN","B",3.6,3.6)

"BLD",4780,"KRN","B",3.8,3.8)

"BLD",4780,"KRN","B",9.2,9.2)

"BLD",4780,"KRN","B",9.8,9.8)

"BLD",4780,"KRN","B",19,19)

"BLD",4780,"KRN","B",19.1,19.1)

"BLD",4780,"KRN","B",101,101)

"BLD",4780,"KRN","B",409.61,409.61)

"BLD",4780,"KRN","B",771,771)

"BLD",4780,"KRN","B",870,870)

"BLD",4780,"KRN","B",8989.51,8989.51)

"BLD",4780,"KRN","B",8989.52,8989.52)

"BLD",4780,"KRN","B",8994,8994)

"BLD",4780,"PRE")
RMPRP382
"BLD",4780,"QUES",0)
^9.62^^
"BLD",4780,"REQB",0)
^9.611^2^1
"BLD",4780,"REQB",2,0)
RMPR*3.0*77^1
"BLD",4780,"REQB","B","RMPR*3.0*77",2)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
82^3040809
"PKG",101,22,1,"PAH",1,1,0)
^^2^2^3040809
"PKG",101,22,1,"PAH",1,1,1,0)
Add text to the PCE Interface Message and Remove SSN from the Patient 
"PKG",101,22,1,"PAH",1,1,2,0)
Correspondence and Patient Notification Letters.
"PRE")
RMPRP382
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RMPRFO")
0^2^B10863611
"RTN","RMPRFO",1,0)
RMPRFO ;PHX/RFM,HPL-DRIVER FOR PROSTHETIC LETTERS ; 1/5/04 1:41pm
"RTN","RMPRFO",2,0)
 ;;3.0;PROSTHETICS;**55,77,82**;Feb 09, 1996
"RTN","RMPRFO",3,0)
 ;
"RTN","RMPRFO",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace hard code 121 mail symbol with
"RTN","RMPRFO",5,0)
 ;                            call to extrinsic to read site param.
"RTN","RMPRFO",6,0)
 ;                            nois AUG-1097-32118
"RTN","RMPRFO",7,0)
 ;RVD patch #77 - remove link to suspense
"RTN","RMPRFO",8,0)
 ;KAM patch #82 - remove SSN from Patient Correspondence print
"RTN","RMPRFO",9,0)
 N % K ^TMP($J,1),^TMP($J,"RMPR") D HOME^%ZIS S RMPRIN=0
"RTN","RMPRFO",10,0)
 K RMPRFF,DFN
"RTN","RMPRFO",11,0)
 S RMPRDEL="S RMPRGO=$S($D(^RMPR(665.4,RMPRIN,0)):""DEL^RMPRFO1"",1:""EXIT^RMPRFO1"") G @RMPRGO"
"RTN","RMPRFO",12,0)
 I '$D(RMPRFF)!($G(DFN)="") D DIV4^RMPRSIT G:$D(X) EXIT^RMPRFO1 S DIC="^DPT(",DIC(0)="AEMQ",DIC("A")="Select PATIENT: "
"RTN","RMPRFO",13,0)
 I $D(RMPRFF)&($G(DFN)>0) S DIC="^DPT(",DIC(0)="N"
"RTN","RMPRFO",14,0)
 D ^DIC G:Y<0 EXIT^RMPRFO1
"RTN","RMPRFO",15,0)
 K DIC S DFN=+Y
"RTN","RMPRFO",16,0)
CUM K ^TMP($J,1),^TMP($J,"RMPR")
"RTN","RMPRFO",17,0)
 S Y=DT D DD^%DT S NAME=Y D TRANS^RMPRUTL1 S RMPRDATE=RMPRNAME
"RTN","RMPRFO",18,0)
 S DIC="^RMPR(665.2,",DIC(0)="AEMQ",DIC("A")="Select FORM LETTER TYPE: " D ^DIC G:Y<0 EXIT^RMPRFO1
"RTN","RMPRFO",19,0)
 K DIC S RMPRFA=+Y
"RTN","RMPRFO",20,0)
 S RMPRTY=$P(Y,U,2)
"RTN","RMPRFO",21,0)
 I $P(^RMPR(665.2,RMPRFA,0),U,3) D VEN^RMPRFO3 D EXIT^RMPRFO1 Q
"RTN","RMPRFO",22,0)
 D DEM^VADPT,ADD^VADPT
"RTN","RMPRFO",23,0)
 F RI=1:1:17 S ^TMP($J,1,RI,0)=" "
"RTN","RMPRFO",24,0)
HEAD1 S %=1 W !,"Would you like a header on this letter" D YN^DICN G:%<0 EXIT^RMPRFO1
"RTN","RMPRFO",25,0)
 I %=0 W !,"Answer `YES` for a header, `NO` for no header" G HEAD1
"RTN","RMPRFO",26,0)
 W @IOF I %=2 S RMPRHED=1 G HEADER
"RTN","RMPRFO",27,0)
 S ^TMP($J,1,1,0)="|SETTAB(""C"")|"
"RTN","RMPRFO",28,0)
 S ^TMP($J,1,2,0)="|TAB|Department of Veterans Affairs"
"RTN","RMPRFO",29,0)
 S NAME=$P(^RMPR(669.9,RMPRSITE,2),U,4) I NAME]"" S NAME=$S($D(^DIC(5,NAME)):$P(^DIC(5,NAME,0),U),1:"STATE") W $$PARS^RMPRUTL1(NAME)
"RTN","RMPRFO",30,0)
 S ^TMP($J,1,3,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,0),U)
"RTN","RMPRFO",31,0)
 S ^TMP($J,1,4,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,2),U,2)
"RTN","RMPRFO",32,0)
 S ^TMP($J,1,5,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,2),U,3)_", "_FIXDNAME_" "_$P(^RMPR(669.9,RMPRSITE,2),U,5) K FIXDNAME
"RTN","RMPRFO",33,0)
HEADER S ^TMP($J,1,9,0)="|SETTAB(5,50)||TAB|"_RMPRDATE
"RTN","RMPRFO",34,0)
 I '$D(RMPRHED) D
"RTN","RMPRFO",35,0)
 . S ^TMP($J,1,11,0)="|TAB|"_$P(VADM(1),",",2)_" "_$P(VADM(1),",",1)_"|TAB|In Reply Refer To: "_$$STA^RMPRUTIL_"/"_$$ROU^RMPRUTIL(RMPRSITE)
"RTN","RMPRFO",36,0)
 . Q
"RTN","RMPRFO",37,0)
 E  D
"RTN","RMPRFO",38,0)
 . S ^TMP($J,1,11,0)="|TAB|"_$P(VADM(1),",",2)_" "_$P(VADM(1),",",1)_"|TAB|"_"             "_$$STA^RMPRUTIL_"/"_$$ROU^RMPRUTIL(RMPRSITE)
"RTN","RMPRFO",39,0)
 . Q
"RTN","RMPRFO",40,0)
 S ^TMP($J,1,12,0)="|TAB|"_VAPA(1)
"RTN","RMPRFO",41,0)
 I VAPA(2)]"" S ^TMP($J,1,13,0)="|TAB|"_VAPA(2)_"|TAB|"_VADM(1),^TMP($J,1,14,0)="|TAB|"_VAPA(4)_","_" "_$P(VAPA(5),U,2)_" "_VAPA(6)
"RTN","RMPRFO",42,0)
 E  S ^TMP($J,1,13,0)="|TAB|"_VAPA(4)_","_" "_$P(VAPA(5),U,2)_" "_VAPA(6)_"|TAB|"_VADM(1)
"RTN","RMPRFO",43,0)
 S NAME=$P(VADM(1),",")
"RTN","RMPRFO",44,0)
 I $P(NAME," ",2)?1A.A D
"RTN","RMPRFO",45,0)
 .S NAME1=NAME,NAME=$P(NAME," ",1) D TRANS^RMPRUTL1 S RMPRNAM1=RMPRNAME,NAME=NAME1,NAME=$P(NAME," ",2) D TRANS^RMPRUTL1 S RMPRNAM2=RMPRNAME,RMPRNAME=RMPRNAM1_" "_RMPRNAM2
"RTN","RMPRFO",46,0)
 E  D TRANS^RMPRUTL1
"RTN","RMPRFO",47,0)
 G NAME^RMPRFO1
"RTN","RMPRFO3")
0^5^B33520812
"RTN","RMPRFO3",1,0)
RMPRFO3 ;PHX/HPL-PRINT FL 10-90 ADP LETTER ; 12/2/03 1:14pm
"RTN","RMPRFO3",2,0)
 ;;3.0;PROSTHETICS;**82**;Feb 09, 1996
"RTN","RMPRFO3",3,0)
 ;VARIABLES REQUIRED: DFN - DFN OF PATIENT ASSOCIATED WITH THE FL 10-90
"RTN","RMPRFO3",4,0)
 ;                    RMPRFA - LETTER TYPE IN ENGLISH (e.g.:  FL 10-90)
"RTN","RMPRFO3",5,0)
 ; 07/21/2004 KAM Patch RMPR*3*82 - Remove Patient SSN from Letter
"RTN","RMPRFO3",6,0)
VEN ;Enter the Vendor and items
"RTN","RMPRFO3",7,0)
 I '$D(RMPR("SIG")) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRFO3",8,0)
 K DIC S DIC="^RMPR(665.4,",DIC(0)="L",X=DFN,DLAYGO=665.4
"RTN","RMPRFO3",9,0)
 D FILE^DICN
"RTN","RMPRFO3",10,0)
 S DA=+Y,ITM=DA,$P(^RMPR(665.4,DA,0),U,2)=RMPRFA
"RTN","RMPRFO3",11,0)
 S $P(^RMPR(665.4,DA,0),U,4)=DUZ
"RTN","RMPRFO3",12,0)
 S $P(^RMPR(665.4,DA,4),U,1)=RMPR("SIG"),$P(^(4),U,2)=RMPR("SBT")
"RTN","RMPRFO3",13,0)
 S $P(^RMPR(665.4,DA,5),U,1)=DT
"RTN","RMPRFO3",14,0)
 K DIK S DIK="^RMPR(665.4," D IX1^DIK
"RTN","RMPRFO3",15,0)
 S ITMFLG=0
"RTN","RMPRFO3",16,0)
 S DIE="^RMPR(665.4,",DR="[RMPR FL 10-90 ADP]"
"RTN","RMPRFO3",17,0)
 D ^DIE,PRNT1,EXIT
"RTN","RMPRFO3",18,0)
 Q
"RTN","RMPRFO3",19,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPRFO3",20,0)
 K DIE,LP,LINES,LEN,LAPS,ITEM,HEADING,MORE,RMPRTMP1,RMPRTMP2
"RTN","RMPRFO3",21,0)
 K RMPRLNG,RMPRADD,RMPRCIT
"RTN","RMPRFO3",22,0)
 K DA,DIC,DIR,DR,ITM,ITMFLG,NAME,NOIT,RMPR1,RMPR2,RMPRDATE
"RTN","RMPRFO3",23,0)
 K RMPRDEL,RMPRFA,RMPRIN,RMPRL,RMPRTY,RMPRU
"RTN","RMPRFO3",24,0)
 Q
"RTN","RMPRFO3",25,0)
PRNT1 ;
"RTN","RMPRFO3",26,0)
 S %ZIS="MQ" D ^%ZIS G:POP EXIT
"RTN","RMPRFO3",27,0)
 K IOP I $E(IOST,1,2)["C-" G ENT
"RTN","RMPRFO3",28,0)
 I $D(IO("Q")) D  G EXIT
"RTN","RMPRFO3",29,0)
 .S ZTSAVE("DA")="",ZTSAVE("DFN")="",ZTSAVE("RMPR(")=""
"RTN","RMPRFO3",30,0)
 .S ZTSAVE("DATE(")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRFO3",31,0)
 .S ZTIO=ION,ZTRTN="ENT^RMPRFO3",ZTDESC="PRINT PROSTHETICS FL 10-90"
"RTN","RMPRFO3",32,0)
 .D ^%ZTLOAD K ZTDESC,ZTIO,ZTRTN,ZTSAVE
"RTN","RMPRFO3",33,0)
 ;
"RTN","RMPRFO3",34,0)
ENT ;ENTRY POINT FOR ACTUAL PRINTING
"RTN","RMPRFO3",35,0)
 ;If DA is not set then a skeleton ADP FL 10-90 letter is being printed.
"RTN","RMPRFO3",36,0)
 I $G(DA)>0&('$D(RMPR)) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRFO3",37,0)
ENTR ;
"RTN","RMPRFO3",38,0)
 U IO
"RTN","RMPRFO3",39,0)
 S MORE=0,HEADING="REQUEST FOR QUOTATION"
"RTN","RMPRFO3",40,0)
 W !!,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO3",41,0)
 S HEADING="Date: "_$$FMTE^XLFDT(DT,"D")
"RTN","RMPRFO3",42,0)
 W !,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO3",43,0)
 W !!,?5,"TO: "
"RTN","RMPRFO3",44,0)
 I $G(DA)>0 I $D(^RMPR(665.4,DA,2)) W:($P(^RMPR(665.4,DA,2),U,1)'="") $P(^PRC(440,$P(^RMPR(665.4,DA,2),U,1),0),U,1)
"RTN","RMPRFO3",45,0)
 S RMPRCIT=RMPR("CITY")
"RTN","RMPRFO3",46,0)
 S RMPRADD=$L(RMPR("ADD"))
"RTN","RMPRFO3",47,0)
 S RMPRLNG=$S(RMPRCIT>RMPRADD:RMPRCIT,1:RMPRADD)
"RTN","RMPRFO3",48,0)
 S RMPRLNG=$S(RMPRLNG>$L(RMPR("ADD")):RMPRLNG,1:$L(RMPR("ADD")))
"RTN","RMPRFO3",49,0)
 S RMPRLNG=$S(RMPRLNG>$L(RMPR("NAME")):RMPRLNG,1:$L(RMPR("NAME")))
"RTN","RMPRFO3",50,0)
 W ?IOM-5-RMPRLNG-6,"FROM: Prosthetics Service" ;,RMPR("NAME")
"RTN","RMPRFO3",51,0)
 I $G(DA)>0 I $D(^RMPR(665.4,DA,2)) S:($P(^RMPR(665.4,DA,2),U,1)'="") RMPRTMP1=$P(^RMPR(665.4,DA,2),U,1),RMPRTMP2=^PRC(440,RMPRTMP1,0)
"RTN","RMPRFO3",52,0)
 I $G(DA)'>0 S RMPRTMP2="^^^^^^^^^"
"RTN","RMPRFO3",53,0)
 I $G(DA)>0 I '$D(^RMPR(665.4,DA,2)) S RMPRTMP2="^^^^^^^^^"
"RTN","RMPRFO3",54,0)
 S:$P(RMPRTMP2,U,7)'="" $P(RMPRTMP2,U,7)=$P(^DIC(5,$P(RMPRTMP2,U,7),0),U,1)
"RTN","RMPRFO3",55,0)
 W !,?9,$S($P(RMPRTMP2,U,2)'="":$P(RMPRTMP2,U,2),$P(RMPRTMP2,U,6)'=""&($P(RMPRTMP2,U,7)'=""):$P(RMPRTMP2,U,6)_", "_$P(RMPRTMP2,U,7)_"  "_$P(RMPRTMP2,U,8),1:"")
"RTN","RMPRFO3",56,0)
 W ?IOM-5-RMPRLNG,RMPR("NAME") ;"Prosthetics Service"
"RTN","RMPRFO3",57,0)
 W !,?9,$S($P(RMPRTMP2,U,2)'=""&($P(RMPRTMP2,U,3)'=""):$P(RMPRTMP2,U,3),$P(RMPRTMP2,U,6)'="":$P(RMPRTMP2,U,6)_", "_$P(RMPRTMP2,U,7)_"  "_$P(RMPRTMP2,U,8),1:"") W ?IOM-5-RMPRLNG,RMPR("ADD")
"RTN","RMPRFO3",58,0)
 I $P(RMPRTMP2,U,2)="",$P(RMPRTMP2,U,3)="",$P(RMPRTMP2,U,4)="" W !,?IOM-5-RMPRLNG,RMPR("CITY") G DNE
"RTN","RMPRFO3",59,0)
 I $P(RMPRTMP2,U,2)'=""&($P(RMPRTMP2,U,3)'="") D
"RTN","RMPRFO3",60,0)
 .I $P(RMPRTMP2,U,4)'="" W !,?9,$P(RMPRTMP2,U,4),?IOM-5-RMPRLNG,RMPR("CITY") S RDN=1
"RTN","RMPRFO3",61,0)
 I $P(RMPRTMP2,U,2)'=""&($P(RMPRTMP2,U,3)'="")&(($P(RMPRTMP2,U,4)'="")&($P(RMPRTMP2,U,5)'="")) D
"RTN","RMPRFO3",62,0)
 .W !,?9,$P(RMPRTMP2,U,5)
"RTN","RMPRFO3",63,0)
 .I $G(RDN)<1 W ?IOM-5-RMPRLNG,RMPR("CITY") S RDN=1
"RTN","RMPRFO3",64,0)
 I $P(RMPRTMP2,U,2)'=""&($P(RMPRTMP2,U,3)'="") W:$P(RMPRTMP2,U,6)'=""&($P(RMPRTMP2,U,7)'="") !,?9,$P(RMPRTMP2,U,6)_", "_$P(RMPRTMP2,U,7)_"  "_$P(RMPRTMP2,U,8) I $G(RDN)<1 W ?IOM-5-RMPRLNG,RMPR("CITY") S RDN=1
"RTN","RMPRFO3",65,0)
 I $G(RDN)<1 W !,?IOM-5-RMPRLNG,RMPR("CITY")
"RTN","RMPRFO3",66,0)
DNE K RDN S NAME=" ",SSN=" "
"RTN","RMPRFO3",67,0)
 ;Vendor phone on ADP FL 10-90
"RTN","RMPRFO3",68,0)
 W !!
"RTN","RMPRFO3",69,0)
 I $G(DA)'>0 S NAME="               "
"RTN","RMPRFO3",70,0)
DNE1 W ?9,"Vendor Phone #: "
"RTN","RMPRFO3",71,0)
 I $D(DA),$G(^RMPR(665.4,DA,2)) W $P(^PRC(440,$P(^RMPR(665.4,DA,2),U,1),0),U,10)
"RTN","RMPRFO3",72,0)
 I $G(DA)>0 S NAME=$P(^DPT($P(^RMPR(665.4,DA,0),U,1),0),U,1)
"RTN","RMPRFO3",73,0)
 ; *82 removed patient SSN from next line
"RTN","RMPRFO3",74,0)
 W ?IOM-5-$L(NAME)-9,"Veteran: ",NAME,!
"RTN","RMPRFO3",75,0)
 W !!,?5,"Your firm is being considered for the following:"
"RTN","RMPRFO3",76,0)
 S LINES=0,ITM=0,LEN=0
"RTN","RMPRFO3",77,0)
 F  Q:$G(DA)'>0  S ITM=$O(^RMPR(665.4,DA,3,ITM)) Q:ITM'>0!(LINES=5)  D:LINES<5
"RTN","RMPRFO3",78,0)
 .I LEN=0 W !,?6," " S LINES=LINES+1
"RTN","RMPRFO3",79,0)
 .I LEN>0,LEN+$L($P(^RMPR(665.4,DA,3,ITM,0),U,1))<71 W ", "
"RTN","RMPRFO3",80,0)
 .I LEN>0,LEN+$L($P(^RMPR(665.4,DA,3,ITM,0),U,1))>70 S LEN=0 W !,?6," " S LINES=LINES+1
"RTN","RMPRFO3",81,0)
 .W:LINES<5 ^RMPR(665.4,DA,3,ITM,0)
"RTN","RMPRFO3",82,0)
 .S LEN=LEN+2+$L($P(^RMPR(665.4,DA,3,ITM,0),U,1))
"RTN","RMPRFO3",83,0)
 .I LINES>4&(ITM>0) S MORE=1,ITEM=ITM Q
"RTN","RMPRFO3",84,0)
 W !!,?5,"An estimate on the above-listed item(s) is requested.  "
"RTN","RMPRFO3",85,0)
 W "YOUR QUOTATION "
"RTN","RMPRFO3",86,0)
 W !,?5,"DOES NOT CONSTITUTE A PURCHASE ORDER."
"RTN","RMPRFO3",87,0)
 W "  Upon completion of the esti-"
"RTN","RMPRFO3",88,0)
 W !,?5,"mate, return the original to the Veterans Affairs facility indicated"
"RTN","RMPRFO3",89,0)
 W !,?5,"above and retain a copy for your files."
"RTN","RMPRFO3",90,0)
 W !!,?5,"If approved, a purchase order will be prepared and forwarded to you."
"RTN","RMPRFO3",91,0)
 W !!,?5,"Sincerely,"
"RTN","RMPRFO3",92,0)
 I $Y+2>IOST,$E(IOST,1,2)["C-" W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1 Q:Y'>0  W @IOF
"RTN","RMPRFO3",93,0)
 W !!!!,?5,RMPR("SIG"),!,?5,RMPR("SBT")
"RTN","RMPRFO3",94,0)
EST ;PRINT VENDOR'S ESTIMATE SECTION OF FL 10-90
"RTN","RMPRFO3",95,0)
 S LINES=0,HEADING="VENDOR'S ESTIMATE" W !!,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO3",96,0)
 S HEADING="(To be completed by Vendor)" W !,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO3",97,0)
 W !,?5,$$REPEAT^XLFSTR("-",70)
"RTN","RMPRFO3",98,0)
 W !,?5,"|",?12,"Article or Service"
"RTN","RMPRFO3",99,0)
 W ?37,"|Quantity| Unit |Unit Cost|Total Cost|"
"RTN","RMPRFO3",100,0)
 W !,?5,$$REPEAT^XLFSTR("-",70)
"RTN","RMPRFO3",101,0)
 S LAPS=$Y
"RTN","RMPRFO3",102,0)
 F LP=LAPS:1:47 W !,?5,"|",?37,"|",?46,"|",?53,"|",?63,"|",?74,"|" I $Y>20&($E(IOST,1,2)["C-") K DIR S DIR(0)="E" D ^DIR G:(X="^")!($D(DTOUT)) QWIT W @IOF
"RTN","RMPRFO3",103,0)
 W !,?5,$$REPEAT^XLFSTR("-",70)
"RTN","RMPRFO3",104,0)
 W !,?5,"|  Vendor:",?42,"Contract number (if applicable) |"
"RTN","RMPRFO3",105,0)
 W !,?5,"|  Address:",?74,"|"
"RTN","RMPRFO3",106,0)
 W !,?5,"|  City:",?74,"|",!,?5,"|  State:",?26,"Zip:",?74,"|"
"RTN","RMPRFO3",107,0)
 W !,?5,"|  Telephone:",?74,"|",!,?5,"|  Date:",?37,"Signature & Title of Company Official|"
"RTN","RMPRFO3",108,0)
 W !,?5,"|  Note:List Terms/Discounts if Applicable",?74,"|"
"RTN","RMPRFO3",109,0)
 W !,?5,$$REPEAT^XLFSTR("-",70)
"RTN","RMPRFO3",110,0)
 W !,?59,"FL 10-90 ADP"
"RTN","RMPRFO3",111,0)
 I $E(IOST,1,2)["C-" S DIR(0)="E" D ^DIR
"RTN","RMPRFO3",112,0)
 W @IOF D:$G(MORE)=1 MORE^RMPRFO6,EST D EXIT,^%ZISC
"RTN","RMPRFO3",113,0)
QWIT Q
"RTN","RMPRFO6")
0^6^B2899949
"RTN","RMPRFO6",1,0)
RMPRFO6 ;PHX/HPL-PRINT FL 10-90 ADP LETTER ;11/01/1994
"RTN","RMPRFO6",2,0)
 ;;3.0;PROSTHETICS;**82**;Feb 09, 1996
"RTN","RMPRFO6",3,0)
 ; 07/21/2004 KAM RMPR*3*82 - Remove Patient SSN from Letter
"RTN","RMPRFO6",4,0)
MORE ;PRINT ADDITIONAL PAGE(S) OF FL 10-90 ADP IF NEEDED
"RTN","RMPRFO6",5,0)
 Q:MORE=0&(ITEM'>0)  S LINES=0,MORE=0,HEADING="CONTINUATION OF REQUEST FOR QUOTATION" W !!!,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO6",6,0)
 S HEADING="Date: "_$$FMTE^XLFDT(DT,"D") W !,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRFO6",7,0)
 W !!,?5,"TO: ",$P(^PRC(440,$P(^RMPR(665.4,DA,2),U,1),0),U,1)
"RTN","RMPRFO6",8,0)
 W ?IOM-5-RMPRLNG-6,"FROM: ",RMPR("NAME")
"RTN","RMPRFO6",9,0)
 W !,?IOM-5-RMPRLNG,RMPR("ADD"),!,?IOM-5-RMPRLNG,RMPR("CITY")
"RTN","RMPRFO6",10,0)
 ; *82 removed patient SSN from next line
"RTN","RMPRFO6",11,0)
 W !!,?IOM-5-$L(NAME)-9,"Veteran: ",NAME,!
"RTN","RMPRFO6",12,0)
 W !!,?5,"CONTINUATION OF ITEM LIST:"
"RTN","RMPRFO6",13,0)
 Q:$G(ITEM)'>0  S LINES=0,LEN=0 W !,?6," ",^RMPR(665.4,DA,3,ITEM,0) S LEN=$L($P(^RMPR(665.4,DA,3,ITEM,0),U,1))+2
"RTN","RMPRFO6",14,0)
 F  S ITEM=$O(^RMPR(665.4,DA,3,ITEM)) Q:ITEM'>0!(LINES>11)  D:LINES<12
"RTN","RMPRFO6",15,0)
 .I LEN=0 W !,?6," " S LINES=LINES+1
"RTN","RMPRFO6",16,0)
 .I LEN>0,LEN+$L($P(^RMPR(665.4,DA,3,ITEM,0),U,1))<71 W ", "
"RTN","RMPRFO6",17,0)
 .I LEN>0,LEN+$L($P(^RMPR(665.4,DA,3,ITEM,0),U,1))>70 S LEN=0 W !,?6," " S LINES=LINES+1
"RTN","RMPRFO6",18,0)
 .W:LINES<12 ^RMPR(665.4,DA,3,ITEM,0) S LEN=LEN+2+$L($P(^RMPR(665.4,DA,3,ITEM,0),U,1))
"RTN","RMPRFO6",19,0)
 .I LINES>11&(ITEM>0) S MORE=1 D MORE
"RTN","RMPRFO6",20,0)
 I LINES<12&(LINES>0&(MORE=0)) S MORE=0 Q
"RTN","RMPRP24")
0^3^B10480052
"RTN","RMPRP24",1,0)
RMPRP24 ;PHX/HPL-Print patient notification letter ; 1/2/04 11:30am
"RTN","RMPRP24",2,0)
 ;;3.0;PROSTHETICS;**55,82**;Feb 09, 1996
"RTN","RMPRP24",3,0)
 ;
"RTN","RMPRP24",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace 121 hard coded mail symbol with
"RTN","RMPRP24",5,0)
 ;                            call to site param. extrinsic.
"RTN","RMPRP24",6,0)
 ;                            see nois AUG-1097-32118
"RTN","RMPRP24",7,0)
 ;
"RTN","RMPRP24",8,0)
 ; KAM - patch 82 - 1/02/04 - remove SSN from letter
"RTN","RMPRP24",9,0)
 ;
"RTN","RMPRP24",10,0)
EN(RDA) ;SETUP VARIABLES AND PRINT PATIENT NOTIFICATION LETTER
"RTN","RMPRP24",11,0)
 ;VARIABLE REQUIRED:RDA - ENTRY # IN FILE 664
"RTN","RMPRP24",12,0)
 N VAHOW
"RTN","RMPRP24",13,0)
 S NAME=$P(^RMPR(664,RDA,0),U,9),RMPRINIT=NAME,RMPREMP=$$SIG^RMPR31U(NAME)
"RTN","RMPRP24",14,0)
 I $D(^VA(200,RMPRINIT,.13)) S RMPRPHON=$P(^VA(200,RMPRINIT,.13),U,2)
"RTN","RMPRP24",15,0)
 I '$D(^VA(200,$P(^RMPR(664,RDA,0),U,9),.13)) S RMPRPHON=RMPR("PHONE")
"RTN","RMPRP24",16,0)
 S DFN=$P(^RMPR(664,RDA,0),U,2) D ADD^VADPT,DEM^VADPT
"RTN","RMPRP24",17,0)
 S RMPRITEM=""
"RTN","RMPRP24",18,0)
 S RMPRITM=0 F LP=1:1 S RMPRITM=$O(^RMPR(664,RDA,1,RMPRITM)) Q:RMPRITM="B"  S RMPRITEM(LP)=$P(^RMPR(664,RDA,1,RMPRITM,0),U,2),RMPRITM(LP)=$P(^RMPR(664,RDA,1,RMPRITM,0),U,1)
"RTN","RMPRP24",19,0)
 S HEADING="Department of Veterans Affairs"
"RTN","RMPRP24",20,0)
 W !!!!!,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPRP24",21,0)
 S RMPRTAB=IOM-$L(RMPR("NAME"))\2 W !,?RMPRTAB,RMPR("NAME")
"RTN","RMPRP24",22,0)
 S RMPRTAB=IOM-$L(RMPR("ADD"))\2 W !,?RMPRTAB,RMPR("ADD")
"RTN","RMPRP24",23,0)
 S RMPRTAB=IOM-$L(RMPR("CITY"))\2 W !,?RMPRTAB,RMPR("CITY")
"RTN","RMPRP24",24,0)
 S RMPRTAB=7 S NAME=VADM(1) S FIXDNAME=$$PARS^RMPRUTL1(NAME)
"RTN","RMPRP24",25,0)
 W !!,?44,$$FMTE^XLFDT(DT,"D")
"RTN","RMPRP24",26,0)
 S FIXDNAME=$E(FIXDNAME,2,$L(FIXDNAME)-2)
"RTN","RMPRP24",27,0)
 W !!,?RMPRTAB,$S($P(VADM(5),U,1)["M":"MR. ",$P(VADM(5),U,1)["F":"MS. ",1:"")_$$UP^XLFSTR(FIXDNAME),?44,"In reply refer to: ",$P(^DIC(4,RMPR("STA"),99),U,1)_"/"_$$ROU^RMPRUTIL(RMPRSITE),!
"RTN","RMPRP24",28,0)
 W:VAPA(1)'="" ?RMPRTAB,VAPA(1),?44,"Veteran: ",VADM(1),!
"RTN","RMPRP24",29,0)
 ; *82 removed SSN from the next line
"RTN","RMPRP24",30,0)
 W:VAPA(2)'="" ?RMPRTAB,VAPA(2),!
"RTN","RMPRP24",31,0)
 W:VAPA(3)'="" ?RMPRTAB,VAPA(3)
"RTN","RMPRP24",32,0)
 W:VAPA(4)'="" ?RMPRTAB,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_VAPA(6)
"RTN","RMPRP24",33,0)
 W !!!,?RMPRTAB,"Dear ",$S($P(VADM(5),"^",1)["M":"Mr. ",$P(VADM(5),"^",1)["F":"Ms. ",1:"")_FIXDNAME_","
"RTN","RMPRP24",34,0)
 W !!,?RMPRTAB+0
"RTN","RMPRP24",35,0)
 W "This is to notify you that the items listed below were ordered"
"RTN","RMPRP24",36,0)
 W !,?RMPRTAB,"for you on "
"RTN","RMPRP24",37,0)
 W $$FMTE^XLFDT($P(^RMPR(664,RDA,0),U,1),"D")_".  Delivery of this equipment is expected"
"RTN","RMPRP24",38,0)
 W !,?RMPRTAB,$S($P($G(^RMPR(664,RDA,3)),U,2)'="":"on or about "_$$FMTE^XLFDT($P(^RMPR(664,RDA,3),U,2),"D")_".",1:"in 30 days from the order date.")
"RTN","RMPRP24",39,0)
 W !!,?RMPRTAB,"If you do not receive it within 5 days of the expected date,"
"RTN","RMPRP24",40,0)
 S LINE="please contact "_RMPREMP_", of my staff, at "_RMPRPHON_"."
"RTN","RMPRP24",41,0)
 W $$RAP^RMPRUTL1(LINE,RMPRTAB)
"RTN","RMPRP24",42,0)
ITEMS NEW DA
"RTN","RMPRP24",43,0)
 W !
"RTN","RMPRP24",44,0)
 S RMPRLAST=$P(^RMPR(664,RDA,1,0),U,4) F LP=1:1:RMPRLAST D
"RTN","RMPRP24",45,0)
 .I $D(RMPRITEM(LP)) W !,?RMPRTAB+3,RMPRITEM(LP)
"RTN","RMPRP24",46,0)
 .E  S RMPRITM=RMPRITM(LP) W !,?RMPRTAB+3,$$ITM^RMPR31U(RMPRITM)
"RTN","RMPRP24",47,0)
 W !!,?RMPRTAB,"Sincerely,"
"RTN","RMPRP24",48,0)
 W !!!!!,?RMPRTAB,RMPR("SIG")
"RTN","RMPRP24",49,0)
 W !,?RMPRTAB,RMPR("SBT")
"RTN","RMPRP24",50,0)
 W @IOF
"RTN","RMPRP24",51,0)
 K RMPREMP,RMPRNAME,LINE Q " "
"RTN","RMPRP382")
0^^B841290
"RTN","RMPRP382",1,0)
RMPRP382 ; BAY/KAM - Patch RMPR*3*82 Install Utility Routine ; 1/20/04 10:18am
"RTN","RMPRP382",2,0)
 ;;3.0;Prosthetics;**82**;AUG 13, 1993
"RTN","RMPRP382",3,0)
 ;
"RTN","RMPRP382",4,0)
ENV ;Main Entry point for Environment Check
"RTN","RMPRP382",5,0)
 S XPDABORT=""
"RTN","RMPRP382",6,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","RMPRP382",7,0)
 I XPDABORT="" K XPDABORT
"RTN","RMPRP382",8,0)
 Q
"RTN","RMPRP382",9,0)
PROGCHK(XPDABORT) ; checks for necessary programmer variables
"RTN","RMPRP382",10,0)
 ;
"RTN","RMPRP382",11,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^")  D
"RTN","RMPRP382",12,0)
 . D BMES^XPDUTL("****")
"RTN","RMPRP382",13,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","RMPRP382",14,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","RMPRP382",15,0)
 . D MES^XPDUTL("*****")
"RTN","RMPRP382",16,0)
 . S XPDABORT=2
"RTN","RMPRP382",17,0)
 Q
"RTN","RMPRPCEA")
0^4^B24300097
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82**;Feb 09, 1996
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",5,0)
 ;
"RTN","RMPRPCEA",6,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",7,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",8,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",9,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",12,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",13,0)
 D NEWVAR
"RTN","RMPRPCEA",14,0)
 S RMERR=1
"RTN","RMPRPCEA",15,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",16,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",17,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",18,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",19,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",20,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",21,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",22,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",23,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",24,0)
 .S RMERR=-2
"RTN","RMPRPCEA",25,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",26,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",27,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",28,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01)
"RTN","RMPRPCEA",29,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",30,0)
 .F I=1:1:38-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",31,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",32,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTA)
"RTN","RMPRPCEA",33,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",34,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",35,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",36,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTA
"RTN","RMPRPCEA",37,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",38,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",39,0)
 ; initialize temp file.
"RTN","RMPRPCEA",40,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",41,0)
 ;
"RTN","RMPRPCEA",42,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",43,0)
 D GETDATA
"RTN","RMPRPCEA",44,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",45,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",46,0)
 ;
"RTN","RMPRPCEA",47,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",48,0)
 D BUILD
"RTN","RMPRPCEA",49,0)
 ;
"RTN","RMPRPCEA",50,0)
 ; now send
"RTN","RMPRPCEA",51,0)
 D SENDIT
"RTN","RMPRPCEA",52,0)
 ;
"RTN","RMPRPCEA",53,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",54,0)
 ;
"RTN","RMPRPCEA",55,0)
 ; clear the temp file
"RTN","RMPRPCEA",56,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",57,0)
 ;
"RTN","RMPRPCEA",58,0)
 ; return
"RTN","RMPRPCEA",59,0)
 Q RMERR
"RTN","RMPRPCEA",60,0)
 ;
"RTN","RMPRPCEA",61,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",62,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",63,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",64,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",65,0)
 D NOW^%DTC
"RTN","RMPRPCEA",66,0)
 S RMDANOW=%
"RTN","RMPRPCEA",67,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",68,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",69,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",70,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",71,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",72,0)
 S RMSCON=0
"RTN","RMPRPCEA",73,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",74,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",75,0)
 S RMETYP="P"
"RTN","RMPRPCEA",76,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",77,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",78,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",79,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",80,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",81,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",82,0)
 ;get Date of Death.
"RTN","RMPRPCEA",83,0)
 D DEM^VADPT
"RTN","RMPRPCEA",84,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",85,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",86,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",87,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",88,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",89,0)
 Q
"RTN","RMPRPCEA",90,0)
 ;
"RTN","RMPRPCEA",91,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",92,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI")
"RTN","RMPRPCEA",93,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",94,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",95,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",96,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",97,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",98,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",99,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",100,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",101,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",102,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",103,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",104,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",105,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",106,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",107,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",108,0)
 ;-------------military sexual trauma----------
"RTN","RMPRPCEA",109,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=""
"RTN","RMPRPCEA",110,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",111,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",112,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",113,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",114,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",115,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",116,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",117,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",118,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",119,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",120,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",121,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",122,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",123,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",124,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",125,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",126,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",127,0)
 Q
"RTN","RMPRPCEA",128,0)
 ;
"RTN","RMPRPCEA",129,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",130,0)
 K RMPROB
"RTN","RMPRPCEA",131,0)
 S (RMPRCPER,RMPROB)=0
"RTN","RMPRPCEA",132,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",133,0)
 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",134,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",135,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",136,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",137,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",138,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",139,0)
 I $G(RMPCE),$G(RMPRCPER) S RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",140,0)
 ;
"RTN","RMPRPCEA",141,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",142,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",143,0)
 K RMUPD
"RTN","RMPRPCEA",144,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",145,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",146,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",147,0)
 Q
"RTN","RMPRPCEA",148,0)
 ;
"RTN","RMPRPCEA",149,0)
NEWVAR ;new all variables.
"RTN","RMPRPCEA",150,0)
 N RMPROB,RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",151,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",152,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN
"RTN","RMPRPCEA",153,0)
 N RERRMSG,RERRMSG2
"RTN","RMPRPCEA",154,0)
 Q
"RTN","RMPRPCEB")
0^1^B19107003
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ; 1/23/04 8:09am
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,82**;Feb 09, 1996
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 ;KAM Patch #82 06/21/2004 - Add more robust text to 'Missing
"RTN","RMPRPCEB",9,0)
 ;                           Prosthetics Clinic PCE error message
"RTN","RMPRPCEB",10,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",11,0)
 Q
"RTN","RMPRPCEB",12,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",13,0)
 S IO=0,RMAIL=1
"RTN","RMPRPCEB",14,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",15,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",16,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",17,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",18,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",19,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",20,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",21,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))
"RTN","RMPRPCEB",22,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",23,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",24,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",25,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",26,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",27,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",28,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",29,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",30,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",31,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",32,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",33,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",34,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",35,0)
 .S RMICD9=$P(RM610,U,8)
"RTN","RMPRPCEB",36,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",37,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",38,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",39,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",40,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",41,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",42,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",43,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",44,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",45,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",46,0)
 ;
"RTN","RMPRPCEB",47,0)
 D PROC
"RTN","RMPRPCEB",48,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",49,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",50,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",51,0)
 G EXIT
"RTN","RMPRPCEB",52,0)
 ;
"RTN","RMPRPCEB",53,0)
PCEFLG ;
"RTN","RMPRPCEB",54,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",55,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",56,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",57,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",58,0)
 Q
"RTN","RMPRPCEB",59,0)
 ;
"RTN","RMPRPCEB",60,0)
PROC ;process
"RTN","RMPRPCEB",61,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",62,0)
 .;call PCE Interface
"RTN","RMPRPCEB",63,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",64,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",65,0)
 . I RMC<1 D
"RTN","RMPRPCEB",66,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",67,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",68,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",69,0)
 ..;Added next line for RMPR*3*82
"RTN","RMPRPCEB",70,0)
 ..I '$G(RMLOC) S ^TMP($J,"RMPRERR",RK)=^TMP($J,"RMPRERR",RK)_RERRMSG_RERRMSG2
"RTN","RMPRPCEB",71,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",72,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",73,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",74,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",75,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,65)
"RTN","RMPRPCEB",76,0)
 Q
"RTN","RMPRPCEB",77,0)
 ;
"RTN","RMPRPCEB",78,0)
MES1 ;
"RTN","RMPRPCEB",79,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",80,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",81,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",82,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",83,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",84,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",85,0)
 Q
"RTN","RMPRPCEB",86,0)
MES2 ;
"RTN","RMPRPCEB",87,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",88,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",89,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",90,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",91,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",92,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",93,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",94,0)
 D ^XMD
"RTN","RMPRPCEB",95,0)
 D NOW^%DTC
"RTN","RMPRPCEB",96,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",97,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",98,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",99,0)
 Q
"RTN","RMPRPCEB",100,0)
 ;
"RTN","RMPRPCEB",101,0)
BUILD ;
"RTN","RMPRPCEB",102,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",103,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",104,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",105,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",106,0)
 Q
"RTN","RMPRPCEB",107,0)
 ;
"RTN","RMPRPCEB",108,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",109,0)
 K ^TMP($J)
"RTN","RMPRPCEB",110,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",111,0)
 Q
"VER")
8.0^22
**END**
**END**
