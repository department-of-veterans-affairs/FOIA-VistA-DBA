Released PRCA*4.5*226 SEQ #198
Extracted from mail message
**KIDS**:PRCA*4.5*226^

**INSTALL NAME**
PRCA*4.5*226
"BLD",5926,0)
PRCA*4.5*226^ACCOUNTS RECEIVABLE^0^3041228^y
"BLD",5926,1,0)
^^13^13^3041228^
"BLD",5926,1,1,0)
This patch addresses 2 issues.
"BLD",5926,1,2,0)
 
"BLD",5926,1,3,0)
The first issue is incorrect coding in routine RCBEUBIL.  This is not
"BLD",5926,1,4,0)
causing an error and it doesn't appear to have caused any incorrect data
"BLD",5926,1,5,0)
in the past but the change is needed to safeguard against any future
"BLD",5926,1,6,0)
problems.
"BLD",5926,1,7,0)
 
"BLD",5926,1,8,0)
The second issue is incorrect coding in routine RCBEUTR1.  The code is
"BLD",5926,1,9,0)
looking at file #433 instead of #430.  If a contractual adjustment is
"BLD",5926,1,10,0)
made, a Modified Billing Document is being sent to FMS instead of the
"BLD",5926,1,11,0)
correct Write Off Document.  This problem only affects bills with a 
"BLD",5926,1,12,0)
category of 30 (tricare) or 32 (tricare third party) AND using a 
"BLD",5926,1,13,0)
contractual adjustment.
"BLD",5926,4,0)
^9.64PA^^
"BLD",5926,"ABPKG")
n
"BLD",5926,"KRN",0)
^9.67PA^8989.52^19
"BLD",5926,"KRN",.4,0)
.4
"BLD",5926,"KRN",.401,0)
.401
"BLD",5926,"KRN",.402,0)
.402
"BLD",5926,"KRN",.403,0)
.403
"BLD",5926,"KRN",.5,0)
.5
"BLD",5926,"KRN",.84,0)
.84
"BLD",5926,"KRN",3.6,0)
3.6
"BLD",5926,"KRN",3.8,0)
3.8
"BLD",5926,"KRN",9.2,0)
9.2
"BLD",5926,"KRN",9.8,0)
9.8
"BLD",5926,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5926,"KRN",9.8,"NM",1,0)
RCBEUTR1^^0^B31843556
"BLD",5926,"KRN",9.8,"NM",2,0)
RCBEUBIL^^0^B20443775
"BLD",5926,"KRN",9.8,"NM","B","RCBEUBIL",2)

"BLD",5926,"KRN",9.8,"NM","B","RCBEUTR1",1)

"BLD",5926,"KRN",19,0)
19
"BLD",5926,"KRN",19.1,0)
19.1
"BLD",5926,"KRN",101,0)
101
"BLD",5926,"KRN",409.61,0)
409.61
"BLD",5926,"KRN",771,0)
771
"BLD",5926,"KRN",870,0)
870
"BLD",5926,"KRN",8989.51,0)
8989.51
"BLD",5926,"KRN",8989.52,0)
8989.52
"BLD",5926,"KRN",8994,0)
8994
"BLD",5926,"KRN","B",.4,.4)

"BLD",5926,"KRN","B",.401,.401)

"BLD",5926,"KRN","B",.402,.402)

"BLD",5926,"KRN","B",.403,.403)

"BLD",5926,"KRN","B",.5,.5)

"BLD",5926,"KRN","B",.84,.84)

"BLD",5926,"KRN","B",3.6,3.6)

"BLD",5926,"KRN","B",3.8,3.8)

"BLD",5926,"KRN","B",9.2,9.2)

"BLD",5926,"KRN","B",9.8,9.8)

"BLD",5926,"KRN","B",19,19)

"BLD",5926,"KRN","B",19.1,19.1)

"BLD",5926,"KRN","B",101,101)

"BLD",5926,"KRN","B",409.61,409.61)

"BLD",5926,"KRN","B",771,771)

"BLD",5926,"KRN","B",870,870)

"BLD",5926,"KRN","B",8989.51,8989.51)

"BLD",5926,"KRN","B",8989.52,8989.52)

"BLD",5926,"KRN","B",8994,8994)

"BLD",5926,"QUES",0)
^9.62^^
"BLD",5926,"REQB",0)
^9.611^2^2
"BLD",5926,"REQB",1,0)
PRCA*4.5*192^2
"BLD",5926,"REQB",2,0)
PRCA*4.5*153^2
"BLD",5926,"REQB","B","PRCA*4.5*153",2)

"BLD",5926,"REQB","B","PRCA*4.5*192",1)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
226^3041228
"PKG",142,22,1,"PAH",1,1,0)
^^13^13^3041228
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues.
"PKG",142,22,1,"PAH",1,1,2,0)
 
"PKG",142,22,1,"PAH",1,1,3,0)
The first issue is incorrect coding in routine RCBEUBIL.  This is not
"PKG",142,22,1,"PAH",1,1,4,0)
causing an error and it doesn't appear to have caused any incorrect data
"PKG",142,22,1,"PAH",1,1,5,0)
in the past but the change is needed to safeguard against any future
"PKG",142,22,1,"PAH",1,1,6,0)
problems.
"PKG",142,22,1,"PAH",1,1,7,0)
 
"PKG",142,22,1,"PAH",1,1,8,0)
The second issue is incorrect coding in routine RCBEUTR1.  The code is
"PKG",142,22,1,"PAH",1,1,9,0)
looking at file #433 instead of #430.  If a contractual adjustment is
"PKG",142,22,1,"PAH",1,1,10,0)
made, a Modified Billing Document is being sent to FMS instead of the
"PKG",142,22,1,"PAH",1,1,11,0)
correct Write Off Document.  This problem only affects bills with a 
"PKG",142,22,1,"PAH",1,1,12,0)
category of 30 (tricare) or 32 (tricare third party) AND using a 
"PKG",142,22,1,"PAH",1,1,13,0)
contractual adjustment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCBEUBIL")
0^2^B20443775
"RTN","RCBEUBIL",1,0)
RCBEUBIL ;WISC/RFJ-utilties for bills (in file 430)                  ;1 Jun 00
"RTN","RCBEUBIL",2,0)
 ;;4.5;Accounts Receivable;**153,226**;Mar 20, 1995
"RTN","RCBEUBIL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBEUBIL",4,0)
 Q
"RTN","RCBEUBIL",5,0)
 ;
"RTN","RCBEUBIL",6,0)
 ;
"RTN","RCBEUBIL",7,0)
GETABILL() ;  select an active bill
"RTN","RCBEUBIL",8,0)
 N RCBILLDA,RCCAT,RCCATEG,STATUS
"RTN","RCBEUBIL",9,0)
 F  D  Q:RCBILLDA
"RTN","RCBEUBIL",10,0)
 .   W !! S RCBILLDA=$$SELBILL^RCDPBTLM
"RTN","RCBEUBIL",11,0)
 .   I RCBILLDA=0 S RCBILLDA=-1 Q
"RTN","RCBEUBIL",12,0)
 .   I RCBILLDA<1 Q
"RTN","RCBEUBIL",13,0)
 .   ;  bill must be active
"RTN","RCBEUBIL",14,0)
 .   S STATUS=$P($G(^PRCA(430,RCBILLDA,0)),"^",8)
"RTN","RCBEUBIL",15,0)
 .   I STATUS'=16,STATUS'=42 W !,"THIS IS NOT AN ACTIVE BILL !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",16,0)
 .   ;
"RTN","RCBEUBIL",17,0)
 .   ;  determine if bill can be adjusted based on category
"RTN","RCBEUBIL",18,0)
 .   K RCCAT D RCCAT^RCRCUTL(.RCCAT)  ;returns rccat(category) array
"RTN","RCBEUBIL",19,0)
 .   S RCCATEG=+$P(^PRCA(430,RCBILLDA,0),"^",2)
"RTN","RCBEUBIL",20,0)
 .   I +$G(RCCAT(RCCATEG))=1,$$REFST^RCRCUTL(RCBILLDA) W !!,"YOU CANNOT USE THIS OPTION TO ADJUST REFERRED "_$P($G(RCCAT(RCCATEG)),"^",2)_" BILLS !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",21,0)
 .   ;
"RTN","RCBEUBIL",22,0)
 .   I RCCATEG=26 W !,"YOU CANNOT ADJUST A PREPAYMENT BILL !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",23,0)
 Q RCBILLDA
"RTN","RCBEUBIL",24,0)
 ;
"RTN","RCBEUBIL",25,0)
 ;
"RTN","RCBEUBIL",26,0)
EDIT430(RCBILLDA,DR) ;  edit the fields in 430 with the DR string passed
"RTN","RCBEUBIL",27,0)
 I '$D(^PRCA(430,RCBILLDA)) Q
"RTN","RCBEUBIL",28,0)
 N %,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,J,X,Y
"RTN","RCBEUBIL",29,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",30,0)
 D ^DIE
"RTN","RCBEUBIL",31,0)
 ;  user pressed up-arrow
"RTN","RCBEUBIL",32,0)
 I $D(Y) Q "0^BILL FIELDS NOT UPDATED"
"RTN","RCBEUBIL",33,0)
 Q 1
"RTN","RCBEUBIL",34,0)
 ;
"RTN","RCBEUBIL",35,0)
 ;
"RTN","RCBEUBIL",36,0)
CHGSTAT(RCBILLDA,STATUS) ;  change the current status
"RTN","RCBEUBIL",37,0)
 I '$D(^PRCA(430,RCBILLDA,0)) Q
"RTN","RCBEUBIL",38,0)
 ;  if the current status equals the new status, quit
"RTN","RCBEUBIL",39,0)
 I $P(^PRCA(430,RCBILLDA,0),"^",8)=STATUS Q
"RTN","RCBEUBIL",40,0)
 ;  if the status not defined in file 430.3, quit
"RTN","RCBEUBIL",41,0)
 I '$D(^PRCA(430.3,STATUS,0)) Q
"RTN","RCBEUBIL",42,0)
 N %,D,D0,DA,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,DR,PREVSTAT,X,Y
"RTN","RCBEUBIL",43,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",44,0)
 ;  build DR string
"RTN","RCBEUBIL",45,0)
 S DR=""
"RTN","RCBEUBIL",46,0)
 ;  get the current status and set to previous status
"RTN","RCBEUBIL",47,0)
 S PREVSTAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",8)
"RTN","RCBEUBIL",48,0)
 ;  if previous status equal to new status, quit
"RTN","RCBEUBIL",49,0)
 I PREVSTAT=STATUS Q
"RTN","RCBEUBIL",50,0)
 I PREVSTAT S DR=DR_"95////"_PREVSTAT_";"
"RTN","RCBEUBIL",51,0)
 S DR=DR_"8////"_STATUS_";"    ;current status
"RTN","RCBEUBIL",52,0)
 S DR=DR_"17////"_$G(DUZ)_";"  ;status updated by
"RTN","RCBEUBIL",53,0)
 D ^DIE
"RTN","RCBEUBIL",54,0)
 Q
"RTN","RCBEUBIL",55,0)
 ;
"RTN","RCBEUBIL",56,0)
 ;
"RTN","RCBEUBIL",57,0)
SETRCDOJ(RCBILLDA,RCTRANDA,RCDOJ) ;  set the bill and transaction to rc or doj
"RTN","RCBEUBIL",58,0)
 ;  rcdoj = code RC or DOJ
"RTN","RCBEUBIL",59,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCBEUBIL",60,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",61,0)
 S DR="65////"_RCDOJ_";"
"RTN","RCBEUBIL",62,0)
 D ^DIE
"RTN","RCBEUBIL",63,0)
 ;
"RTN","RCBEUBIL",64,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUBIL",65,0)
 S DR="7////"_RCDOJ_";"
"RTN","RCBEUBIL",66,0)
 D ^DIE
"RTN","RCBEUBIL",67,0)
 Q
"RTN","RCBEUBIL",68,0)
 ;
"RTN","RCBEUBIL",69,0)
 ;
"RTN","RCBEUBIL",70,0)
SETBAL(RCTRANDA) ;  set the bills balance by adding value of transaction
"RTN","RCBEUBIL",71,0)
 N RCBILLDA,RCDATA7,VALUE
"RTN","RCBEUBIL",72,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'RCBILLDA Q
"RTN","RCBEUBIL",73,0)
 ;  get the value of the transaction
"RTN","RCBEUBIL",74,0)
 S VALUE=$P($$TRANVALU^RCDPBTLM(RCTRANDA),"^",2,6)
"RTN","RCBEUBIL",75,0)
 ;  there is no value on the transaction
"RTN","RCBEUBIL",76,0)
 I $TR(VALUE,"^0")="" Q
"RTN","RCBEUBIL",77,0)
 ;
"RTN","RCBEUBIL",78,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUBIL",79,0)
 S $P(RCDATA7,"^",1)=$P(RCDATA7,"^",1)+$P(VALUE,"^",1) ; principal
"RTN","RCBEUBIL",80,0)
 S $P(RCDATA7,"^",2)=$P(RCDATA7,"^",2)+$P(VALUE,"^",2) ; interest
"RTN","RCBEUBIL",81,0)
 S $P(RCDATA7,"^",3)=$P(RCDATA7,"^",3)+$P(VALUE,"^",3) ; admin
"RTN","RCBEUBIL",82,0)
 S $P(RCDATA7,"^",4)=$P(RCDATA7,"^",4)+$P(VALUE,"^",4) ; marshal fee
"RTN","RCBEUBIL",83,0)
 S $P(RCDATA7,"^",5)=$P(RCDATA7,"^",5)+$P(VALUE,"^",5) ; court cost
"RTN","RCBEUBIL",84,0)
 S $P(^PRCA(430,RCBILLDA,7),"^",1,5)=$P(RCDATA7,"^",1,5)
"RTN","RCBEUBIL",85,0)
 Q
"RTN","RCBEUBIL",86,0)
 ;
"RTN","RCBEUBIL",87,0)
 ;
"RTN","RCBEUBIL",88,0)
FYMULT(RCTRANDA) ;  update the fiscal year multiple for bill
"RTN","RCBEUBIL",89,0)
 ;  to equal the fiscal year multiple for transaction in file 433
"RTN","RCBEUBIL",90,0)
 N RCBILLDA,FYDA
"RTN","RCBEUBIL",91,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'RCBILLDA Q
"RTN","RCBEUBIL",92,0)
 S FYDA=0
"RTN","RCBEUBIL",93,0)
 F  S FYDA=$O(^PRCA(433,RCTRANDA,4,FYDA)) Q:'FYDA  D
"RTN","RCBEUBIL",94,0)
 .   I $D(^PRCA(430,RCBILLDA,2,FYDA,0)) S $P(^PRCA(430,RCBILLDA,2,FYDA,0),"^",2)=$P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)
"RTN","RCBEUBIL",95,0)
 Q
"RTN","RCBEUBIL",96,0)
 ;
"RTN","RCBEUBIL",97,0)
 ;
"RTN","RCBEUBIL",98,0)
SHOWBILL(RCBILLDA) ;  show data for bill
"RTN","RCBEUBIL",99,0)
 N DATA7
"RTN","RCBEUBIL",100,0)
 S DATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUBIL",101,0)
 W !?8,"Principal Balance: ",$J($P(DATA7,"^"),9,2)
"RTN","RCBEUBIL",102,0)
 W !?8," Interest Balance: ",$J($P(DATA7,"^",2),9,2)
"RTN","RCBEUBIL",103,0)
 W !?8,"    Admin Balance: ",$J($P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCBEUBIL",104,0)
 W !?27,"---------"
"RTN","RCBEUBIL",105,0)
 W !?8,"    TOTAL Balance: ",$J($P(DATA7,"^")+$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCBEUBIL",106,0)
 Q
"RTN","RCBEUBIL",107,0)
 ;
"RTN","RCBEUBIL",108,0)
 ;
"RTN","RCBEUBIL",109,0)
ADDCOMM(RCBILLDA,COMMENT) ;  automatically put a comment on a bill
"RTN","RCBEUBIL",110,0)
 ;  comment in the array comment(1)=first line
"RTN","RCBEUBIL",111,0)
 ;                       comment(2)=second line
"RTN","RCBEUBIL",112,0)
 N CURRLINE,LINE
"RTN","RCBEUBIL",113,0)
 ;  get the last line
"RTN","RCBEUBIL",114,0)
 S CURRLINE=$O(^PRCA(430,RCBILLDA,10,99999999),-1)
"RTN","RCBEUBIL",115,0)
 ;  if comment already on transaction, add a blank line and
"RTN","RCBEUBIL",116,0)
 ;  date time of new comment
"RTN","RCBEUBIL",117,0)
 I CURRLINE D
"RTN","RCBEUBIL",118,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(430,RCBILLDA,10,CURRLINE,0)=" "
"RTN","RCBEUBIL",119,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(430,RCBILLDA,10,CURRLINE,0)="Comment added on: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","RCBEUBIL",120,0)
 ;  add new lines
"RTN","RCBEUBIL",121,0)
 F LINE=1:1 Q:'$D(COMMENT(LINE))  S ^PRCA(430,RCBILLDA,10,CURRLINE+LINE,0)=COMMENT(LINE)
"RTN","RCBEUBIL",122,0)
 ;  set the 0th node
"RTN","RCBEUBIL",123,0)
 S ^PRCA(430,RCBILLDA,10,0)="^^"_(CURRLINE+LINE-1)_"^"_(CURRLINE+LINE-1)_"^"_DT_"^"
"RTN","RCBEUBIL",124,0)
 Q
"RTN","RCBEUTR1")
0^1^B31843556
"RTN","RCBEUTR1",1,0)
RCBEUTR1 ;WISC/RFJ-add int,admin chg or increase,decrease principal  ;1 Jun 00
"RTN","RCBEUTR1",2,0)
 ;;4.5;Accounts Receivable;**153,169,192,226**;Mar 20, 1995
"RTN","RCBEUTR1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBEUTR1",4,0)
 Q
"RTN","RCBEUTR1",5,0)
 ;
"RTN","RCBEUTR1",6,0)
 ;
"RTN","RCBEUTR1",7,0)
INTADM(RCBILLDA,RCVALUE,RCCOMMNT,RCDATE) ;  add an intererst/admin charge (transaction type=13)
"RTN","RCBEUTR1",8,0)
 ;  for a bill.  rcvalue = interest ^ admin ^ penalty ^ marshal fee ^ court cost
"RTN","RCBEUTR1",9,0)
 ;  for the transaction.  rcdate = process date (optional)
"RTN","RCBEUTR1",10,0)
 ;  returns transaction number if successful
"RTN","RCBEUTR1",11,0)
 ;
"RTN","RCBEUTR1",12,0)
 N RCDRSTRG,RCTRANDA,Y
"RTN","RCBEUTR1",13,0)
 ;  add the transaction (if added to 433, transaction is locked)
"RTN","RCBEUTR1",14,0)
 S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,13) I 'RCTRANDA Q 0
"RTN","RCBEUTR1",15,0)
 ;
"RTN","RCBEUTR1",16,0)
 ;  build dr string
"RTN","RCBEUTR1",17,0)
 ;  transaction date (strip off time)
"RTN","RCBEUTR1",18,0)
 S RCDRSTRG="11////"_$S($G(RCDATE):$P(RCDATE,"."),1:DT)_";"
"RTN","RCBEUTR1",19,0)
 ;
"RTN","RCBEUTR1",20,0)
 ;  transaction values
"RTN","RCBEUTR1",21,0)
 S RCDRSTRG=RCDRSTRG_"15////"_($P(RCVALUE,"^")+$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_";"
"RTN","RCBEUTR1",22,0)
 I $P(RCVALUE,"^",4) S RCDRSTRG=RCDRSTRG_"25////"_$P(RCVALUE,"^",4)_";"  ;marshal fee
"RTN","RCBEUTR1",23,0)
 I $P(RCVALUE,"^",5) S RCDRSTRG=RCDRSTRG_"26////"_$P(RCVALUE,"^",5)_";"  ;court cost
"RTN","RCBEUTR1",24,0)
 I $P(RCVALUE,"^",1) S RCDRSTRG=RCDRSTRG_"27////"_$P(RCVALUE,"^",1)_";"  ;interest
"RTN","RCBEUTR1",25,0)
 I $P(RCVALUE,"^",2) S RCDRSTRG=RCDRSTRG_"28////"_$P(RCVALUE,"^",2)_";"  ;admin
"RTN","RCBEUTR1",26,0)
 I $P(RCVALUE,"^",3) S RCDRSTRG=RCDRSTRG_"29////"_$P(RCVALUE,"^",3)_";"  ;penalty
"RTN","RCBEUTR1",27,0)
 I $G(RCDATE) S RCDRSTRG=RCDRSTRG_"19////"_RCDATE_";"  ;date entered
"RTN","RCBEUTR1",28,0)
 ;
"RTN","RCBEUTR1",29,0)
 ;  input the fields for the transaction
"RTN","RCBEUTR1",30,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,RCDRSTRG) I 'Y L -^PRCA(433,RCTRANDA) Q 0
"RTN","RCBEUTR1",31,0)
 ;
"RTN","RCBEUTR1",32,0)
 ;  set the comment
"RTN","RCBEUTR1",33,0)
 I $D(RCCOMMNT(1)) D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCBEUTR1",34,0)
 ;
"RTN","RCBEUTR1",35,0)
 ;  move over 433 from 430 (no principal, just move it)
"RTN","RCBEUTR1",36,0)
 D FY433^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",37,0)
 ;
"RTN","RCBEUTR1",38,0)
 ;  mark transaction as processed
"RTN","RCBEUTR1",39,0)
 D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",40,0)
 ;
"RTN","RCBEUTR1",41,0)
 ;  update the bill file with the balance of the transaction
"RTN","RCBEUTR1",42,0)
 D SETBAL^RCBEUBIL(RCTRANDA)
"RTN","RCBEUTR1",43,0)
 ;
"RTN","RCBEUTR1",44,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",45,0)
 D CLOSEIT(RCBILLDA)
"RTN","RCBEUTR1",46,0)
 ;
"RTN","RCBEUTR1",47,0)
 ;  clear the lock and return the transaction added
"RTN","RCBEUTR1",48,0)
 L -^PRCA(433,RCTRANDA)
"RTN","RCBEUTR1",49,0)
 Q RCTRANDA
"RTN","RCBEUTR1",50,0)
 ;
"RTN","RCBEUTR1",51,0)
INCDEC(RCBILLDA,RCVALUE,RCCOMMNT,RCDATE,RCPREPAY,RCONTADJ) ;  automatically
"RTN","RCBEUTR1",52,0)
 ;  create an increase or decrease adjustment for a bill
"RTN","RCBEUTR1",53,0)
 ;  pass variables:
"RTN","RCBEUTR1",54,0)
 ;      rcvalue  = principal value for the transaction.
"RTN","RCBEUTR1",55,0)
 ;                 if rcvalue is less than zero, it will create a
"RTN","RCBEUTR1",56,0)
 ;                 decrease adjustment.  if rcvalue is greater than
"RTN","RCBEUTR1",57,0)
 ;                 zero, it will create an increase adjustment.
"RTN","RCBEUTR1",58,0)
 ;      rccommnt = the comments for the word processing field.
"RTN","RCBEUTR1",59,0)
 ;      rcdate   = optional processing date and time.  if not
"RTN","RCBEUTR1",60,0)
 ;                 passed, the current date and time will be used
"RTN","RCBEUTR1",61,0)
 ;      rcprepay = optional prepayment transaction.  this is the
"RTN","RCBEUTR1",62,0)
 ;                 payment transaction applied to the bill to
"RTN","RCBEUTR1",63,0)
 ;                 create the decrease adjustment.  this gets
"RTN","RCBEUTR1",64,0)
 ;                 stored in field 20 (file 433).
"RTN","RCBEUTR1",65,0)
 ;      rcontadj = optional contract adjustment.  if 1 then this
"RTN","RCBEUTR1",66,0)
 ;                 gets stored in field 88 (file 433).
"RTN","RCBEUTR1",67,0)
 ;
"RTN","RCBEUTR1",68,0)
 ;  returns transaction number added to 433 if successful.
"RTN","RCBEUTR1",69,0)
 ;
"RTN","RCBEUTR1",70,0)
 N ADJNUMB,RCDRSTRG,RCTRANDA,X,Y
"RTN","RCBEUTR1",71,0)
 ;
"RTN","RCBEUTR1",72,0)
 ;  add the transaction (if added to 433, transaction is locked)
"RTN","RCBEUTR1",73,0)
 S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,$S(RCVALUE>0:1,1:35)) I 'RCTRANDA Q 0
"RTN","RCBEUTR1",74,0)
 ;
"RTN","RCBEUTR1",75,0)
 ;  build dr string
"RTN","RCBEUTR1",76,0)
 ;  11=transaction date (strip off time)
"RTN","RCBEUTR1",77,0)
 S RCDRSTRG="11////"_$S($G(RCDATE):$P(RCDATE,"."),1:DT)_";"
"RTN","RCBEUTR1",78,0)
 ;  transaction value (make sure it is not negative)
"RTN","RCBEUTR1",79,0)
 I RCVALUE<0 S RCVALUE=-RCVALUE
"RTN","RCBEUTR1",80,0)
 S RCDRSTRG=RCDRSTRG_"15////"_RCVALUE_";"
"RTN","RCBEUTR1",81,0)
 S RCDRSTRG=RCDRSTRG_"81////"_RCVALUE_";"
"RTN","RCBEUTR1",82,0)
 ;
"RTN","RCBEUTR1",83,0)
 ;  get the next adjustment number if increase(1) or decrease(35)
"RTN","RCBEUTR1",84,0)
 ;  start with the last transaction and work backwards
"RTN","RCBEUTR1",85,0)
 S X=999999999999,ADJNUMB=1
"RTN","RCBEUTR1",86,0)
 F  S X=$O(^PRCA(433,"C",RCBILLDA,X),-1) Q:'X  I $P($G(^PRCA(433,X,1)),"^",4) I $P(^(1),"^",2)=1!($P(^(1),"^",2)=35) S ADJNUMB=$P(^(1),"^",4)+1 Q
"RTN","RCBEUTR1",87,0)
 S RCDRSTRG=RCDRSTRG_"14////"_ADJNUMB_";"
"RTN","RCBEUTR1",88,0)
 ;
"RTN","RCBEUTR1",89,0)
 ;  date entered
"RTN","RCBEUTR1",90,0)
 I $G(RCDATE) S RCDRSTRG=RCDRSTRG_"19////"_RCDATE_";"
"RTN","RCBEUTR1",91,0)
 ;
"RTN","RCBEUTR1",92,0)
 ;  store the prepayment transaction
"RTN","RCBEUTR1",93,0)
 I $G(RCPREPAY) D
"RTN","RCBEUTR1",94,0)
 .   S RCDRSTRG=RCDRSTRG_"20////"_RCPREPAY_";"
"RTN","RCBEUTR1",95,0)
 .   ;  for prepayments, set the incomplete transaction flag
"RTN","RCBEUTR1",96,0)
 .   ;  this will no longer be used after patch 146 and can
"RTN","RCBEUTR1",97,0)
 .   ;  be removed
"RTN","RCBEUTR1",98,0)
 .   S RCDRSTRG=RCDRSTRG_"10////1;"
"RTN","RCBEUTR1",99,0)
 ;
"RTN","RCBEUTR1",100,0)
 ;  contract adjustment
"RTN","RCBEUTR1",101,0)
 I $G(RCONTADJ) S RCDRSTRG=RCDRSTRG_"88///1;"
"RTN","RCBEUTR1",102,0)
 ;
"RTN","RCBEUTR1",103,0)
 ;  input the fields for the transaction
"RTN","RCBEUTR1",104,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,RCDRSTRG) I 'Y L -^PRCA(433,RCTRANDA) Q 0
"RTN","RCBEUTR1",105,0)
 ;
"RTN","RCBEUTR1",106,0)
 ;  set the comment
"RTN","RCBEUTR1",107,0)
 I $D(RCCOMMNT(1)) D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCBEUTR1",108,0)
 ;
"RTN","RCBEUTR1",109,0)
 ;  mark the transaction processed
"RTN","RCBEUTR1",110,0)
 D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",111,0)
 ;
"RTN","RCBEUTR1",112,0)
 ;  update the fiscal year multiple (must be done after marked as
"RTN","RCBEUTR1",113,0)
 ;  processed so the value is defined)
"RTN","RCBEUTR1",114,0)
 D FYMULT^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",115,0)
 ;
"RTN","RCBEUTR1",116,0)
 ;  update the bill file with the balance of the transaction
"RTN","RCBEUTR1",117,0)
 D SETBAL^RCBEUBIL(RCTRANDA)
"RTN","RCBEUTR1",118,0)
 ;
"RTN","RCBEUTR1",119,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",120,0)
 D CLOSEIT(RCBILLDA)
"RTN","RCBEUTR1",121,0)
 ;
"RTN","RCBEUTR1",122,0)
 ;  send FMS document if non-accrued (redo this later on)
"RTN","RCBEUTR1",123,0)
 I '$$ACCK^PRCAACC(RCBILLDA) D
"RTN","RCBEUTR1",124,0)
 .   N D0,DA,DI,DIC,DIE,DIQ2,DQ,DR,ENT,FMSNUM,GECSDATA
"RTN","RCBEUTR1",125,0)
 .   N CATEG,DATA1,ERR
"RTN","RCBEUTR1",126,0)
 .   S CATEG=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCBEUTR1",127,0)
 .   ;
"RTN","RCBEUTR1",128,0)
 .   ;  category=29 champva, do not send to fms, quit
"RTN","RCBEUTR1",129,0)
 .   I CATEG=29 Q
"RTN","RCBEUTR1",130,0)
 .   ;
"RTN","RCBEUTR1",131,0)
 .   ;  category=30 tricare or 32 tricare third party, and contract adj
"RTN","RCBEUTR1",132,0)
 .   I (CATEG=30!(CATEG=32)),$P($G(^PRCA(433,RCTRANDA,8)),"^",8) D  Q
"RTN","RCBEUTR1",133,0)
 .   .   S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCBEUTR1",134,0)
 .   .   D EN^PRCAFWO(RCBILLDA,$P(DATA1,"^",1),$P(DATA1,"^",5),$$SITE^RCMSITE,RCTRANDA)
"RTN","RCBEUTR1",135,0)
 .   ;
"RTN","RCBEUTR1",136,0)
 .   ;  all other categories
"RTN","RCBEUTR1",137,0)
 .   ;  pass trans amount(1;5),trans type(1;2),trans date(1;1)
"RTN","RCBEUTR1",138,0)
 .   S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCBEUTR1",139,0)
 .   D EN^PRCAFBDM(RCBILLDA,$P(DATA1,"^",5),$P(DATA1,"^",2),$P(DATA1,"^",1),RCTRANDA,.ERR)
"RTN","RCBEUTR1",140,0)
 ;
"RTN","RCBEUTR1",141,0)
 ;  clear the lock and return the transaction added
"RTN","RCBEUTR1",142,0)
 L -^PRCA(433,RCTRANDA)
"RTN","RCBEUTR1",143,0)
 Q RCTRANDA
"RTN","RCBEUTR1",144,0)
 ;
"RTN","RCBEUTR1",145,0)
 ;
"RTN","RCBEUTR1",146,0)
CLOSEIT(RCBILLDA) ;  check to cancel or close bill with no balance
"RTN","RCBEUTR1",147,0)
 N AMTPAID,BILLBAL,DATA7,TRANDA
"RTN","RCBEUTR1",148,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",149,0)
 S DATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUTR1",150,0)
 S BILLBAL=$P(DATA7,"^")+$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5)
"RTN","RCBEUTR1",151,0)
 I 'BILLBAL D
"RTN","RCBEUTR1",152,0)
 .   ;  get payments recorded against the bill.  if payments have been
"RTN","RCBEUTR1",153,0)
 .   ;  made, then the status of the bill should be collected/closed.
"RTN","RCBEUTR1",154,0)
 .   S AMTPAID=$P(DATA7,"^",7)+$P(DATA7,"^",8)+$P(DATA7,"^",9)+$P(DATA7,"^",10)+$P(DATA7,"^",11)
"RTN","RCBEUTR1",155,0)
 .   I AMTPAID D CHGSTAT^RCBEUBIL(RCBILLDA,22) Q
"RTN","RCBEUTR1",156,0)
 .   ;  if the last transaction was a decrease contract adjustment,
"RTN","RCBEUTR1",157,0)
 .   ;  then the status will be collected/closed
"RTN","RCBEUTR1",158,0)
 .   S TRANDA=+$O(^PRCA(433,"C",RCBILLDA,999999999999),-1)
"RTN","RCBEUTR1",159,0)
 .   I $P($G(^PRCA(433,TRANDA,8)),"^",8) D CHGSTAT^RCBEUBIL(RCBILLDA,22) Q
"RTN","RCBEUTR1",160,0)
 .   ;  otherwise it should be cancellation
"RTN","RCBEUTR1",161,0)
 .   D CHGSTAT^RCBEUBIL(RCBILLDA,39)
"RTN","RCBEUTR1",162,0)
 Q
"VER")
8.0^22
**END**
**END**
