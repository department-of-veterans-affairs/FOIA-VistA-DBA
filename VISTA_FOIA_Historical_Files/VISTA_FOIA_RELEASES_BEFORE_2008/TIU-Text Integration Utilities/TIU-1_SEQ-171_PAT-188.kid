Released TIU*1*188 SEQ #171
Extracted from mail message
**KIDS**:TIU*1.0*188^

**INSTALL NAME**
TIU*1.0*188
"BLD",5063,0)
TIU*1.0*188^TEXT INTEGRATION UTILITIES^0^3041101^y
"BLD",5063,1,0)
^^3^3^3041101^^^^
"BLD",5063,1,1,0)

"BLD",5063,1,2,0)
The description of this patch may be found in the National Patch Module 
"BLD",5063,1,3,0)
under TIU*1*188.
"BLD",5063,4,0)
^9.64PA^^
"BLD",5063,"KRN",0)
^9.67PA^8989.52^19
"BLD",5063,"KRN",.4,0)
.4
"BLD",5063,"KRN",.401,0)
.401
"BLD",5063,"KRN",.402,0)
.402
"BLD",5063,"KRN",.403,0)
.403
"BLD",5063,"KRN",.5,0)
.5
"BLD",5063,"KRN",.84,0)
.84
"BLD",5063,"KRN",3.6,0)
3.6
"BLD",5063,"KRN",3.8,0)
3.8
"BLD",5063,"KRN",9.2,0)
9.2
"BLD",5063,"KRN",9.8,0)
9.8
"BLD",5063,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5063,"KRN",9.8,"NM",1,0)
TIUP188^^0^B47141753
"BLD",5063,"KRN",9.8,"NM",2,0)
TIUP188P^^0^B23227242
"BLD",5063,"KRN",9.8,"NM","B","TIUP188",1)

"BLD",5063,"KRN",9.8,"NM","B","TIUP188P",2)

"BLD",5063,"KRN",19,0)
19
"BLD",5063,"KRN",19.1,0)
19.1
"BLD",5063,"KRN",101,0)
101
"BLD",5063,"KRN",409.61,0)
409.61
"BLD",5063,"KRN",771,0)
771
"BLD",5063,"KRN",870,0)
870
"BLD",5063,"KRN",8989.51,0)
8989.51
"BLD",5063,"KRN",8989.52,0)
8989.52
"BLD",5063,"KRN",8994,0)
8994
"BLD",5063,"KRN","B",.4,.4)

"BLD",5063,"KRN","B",.401,.401)

"BLD",5063,"KRN","B",.402,.402)

"BLD",5063,"KRN","B",.403,.403)

"BLD",5063,"KRN","B",.5,.5)

"BLD",5063,"KRN","B",.84,.84)

"BLD",5063,"KRN","B",3.6,3.6)

"BLD",5063,"KRN","B",3.8,3.8)

"BLD",5063,"KRN","B",9.2,9.2)

"BLD",5063,"KRN","B",9.8,9.8)

"BLD",5063,"KRN","B",19,19)

"BLD",5063,"KRN","B",19.1,19.1)

"BLD",5063,"KRN","B",101,101)

"BLD",5063,"KRN","B",409.61,409.61)

"BLD",5063,"KRN","B",771,771)

"BLD",5063,"KRN","B",870,870)

"BLD",5063,"KRN","B",8989.51,8989.51)

"BLD",5063,"KRN","B",8989.52,8989.52)

"BLD",5063,"KRN","B",8994,8994)

"BLD",5063,"QUES",0)
^9.62^^
"BLD",5063,"REQB",0)
^9.611^2^2
"BLD",5063,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",5063,"REQB",2,0)
TIU*1.0*179^2
"BLD",5063,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",5063,"REQB","B","TIU*1.0*179",2)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
188^3041101
"PKG",193,22,1,"PAH",1,1,0)
^^3^3^3041101
"PKG",193,22,1,"PAH",1,1,1,0)

"PKG",193,22,1,"PAH",1,1,2,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,3,0)
under TIU*1*188.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUP188")
0^1^B47141753
"RTN","TIUP188",1,0)
TIUP188 ;SLC/RMO,TT - Post-Install for TIU*1*188 ; [5/19/04 1:26pm]
"RTN","TIUP188",2,0)
 ;;1.0;Text Integration Utilities;**188**;Jun 20, 1997
"RTN","TIUP188",3,0)
 ;
"RTN","TIUP188",4,0)
EN ;Entry point to queue a job to automatically link the missing VISIT
"RTN","TIUP188",5,0)
 ;field for a date range of documents
"RTN","TIUP188",6,0)
 N TIUBEGDT,TIUENDT,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","TIUP188",7,0)
 ;
"RTN","TIUP188",8,0)
 W !!,"PATCH TIU*1*188"
"RTN","TIUP188",9,0)
 W !!,"Automatically Link the missing VISIT field for a date range of documents"
"RTN","TIUP188",10,0)
 W !!,"Documents must meet the following criteria to be linked:"
"RTN","TIUP188",11,0)
 W !,"- Date range cannot be before 8/1/02 or after TODAY"
"RTN","TIUP188",12,0)
 W !,"- Entry Date/Time is within the selected date range"
"RTN","TIUP188",13,0)
 W !,"- No visit has been associated with the document"
"RTN","TIUP188",14,0)
 W !,"- A visit exists to be associated with the document"
"RTN","TIUP188",15,0)
 W !,"- The capture method is direct or remote"
"RTN","TIUP188",16,0)
 W !,"- The status is uncosigned or completed or amended"
"RTN","TIUP188",17,0)
 W !,"- The document is under the progress notes class or consults"
"RTN","TIUP188",18,0)
 W !,"- The document has a signature date/time"
"RTN","TIUP188",19,0)
 W !,"- Workload data should be collected for the document"
"RTN","TIUP188",20,0)
 W !!,"  Special Note about Parameters:",!
"RTN","TIUP188",21,0)
 W !,"  The 'ASK DX/CPT ON ALL OPT VISITS' TIU Document parameter"
"RTN","TIUP188",22,0)
 W !,"  is not date sensitive so collecting workload is based on"
"RTN","TIUP188",23,0)
 W !,"  the value of this parameter at the time this routine is"
"RTN","TIUP188",24,0)
 W !,"  invoked rather than at the time the visit was created."
"RTN","TIUP188",25,0)
 ;
"RTN","TIUP188",26,0)
 ;Ask date range
"RTN","TIUP188",27,0)
 I '$$ASKRNG(.TIUBEGDT,.TIUENDT) G ENQ
"RTN","TIUP188",28,0)
 ;
"RTN","TIUP188",29,0)
 ;Set variables
"RTN","TIUP188",30,0)
 S (ZTSAVE("TIUBEGDT"),ZTSAVE("TIUENDT"))=""
"RTN","TIUP188",31,0)
 S ZTRTN="LNKRNG^TIUP188",ZTIO="",ZTSAVE("DUZ")=""
"RTN","TIUP188",32,0)
 S ZTDESC="Automatically link missing VISIT field for File #8925 - Patch 188"
"RTN","TIUP188",33,0)
 W ! D ^%ZTLOAD
"RTN","TIUP188",34,0)
 I $G(ZTSK) D
"RTN","TIUP188",35,0)
 . W !!,"A task has been queued in the background and a bulletin will be sent"
"RTN","TIUP188",36,0)
 . W !,"to you upon completion of the task or if the task is stopped."
"RTN","TIUP188",37,0)
 . W !,"Please only run one date range at a time."
"RTN","TIUP188",38,0)
 . W !!,"The task number is "_$G(ZTSK)_"."
"RTN","TIUP188",39,0)
ENQ Q
"RTN","TIUP188",40,0)
 ;
"RTN","TIUP188",41,0)
ASKRNG(BEGDT,ENDT) ;Prompt for date range
"RTN","TIUP188",42,0)
 ; Input  -- None
"RTN","TIUP188",43,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUP188",44,0)
 ;           BEGDT Begin Date
"RTN","TIUP188",45,0)
 ;           ENDT  End Date
"RTN","TIUP188",46,0)
 N DIRUT,DTOUT,DUOUT,Y
"RTN","TIUP188",47,0)
 W !!,"Please specify a date range:"
"RTN","TIUP188",48,0)
 S BEGDT=+$$READ^TIUU("DA^"_3020801_":"_DT_":E","   Beginning: ")
"RTN","TIUP188",49,0)
 I +$D(DIRUT)!(BEGDT'>0) G ASKRNGQ
"RTN","TIUP188",50,0)
 S ENDT=+$$READ^TIUU("DA^"_BEGDT_":"_DT_":E","        Thru: ")_"."_235959
"RTN","TIUP188",51,0)
 I +$D(DIRUT)!(ENDT'>0) G ASKRNGQ
"RTN","TIUP188",52,0)
 S Y=1
"RTN","TIUP188",53,0)
ASKRNGQ Q +$G(Y)
"RTN","TIUP188",54,0)
 ;
"RTN","TIUP188",55,0)
LNKRNG ;Entry point to automatically link a document to a visit for
"RTN","TIUP188",56,0)
 ;a specified date range
"RTN","TIUP188",57,0)
 ; Input  -- TIUBEGDT Begin Date
"RTN","TIUP188",58,0)
 ;           TIUENDT  End Date
"RTN","TIUP188",59,0)
 ; Output -- ^XTMP("TIUP188", Global
"RTN","TIUP188",60,0)
 N TIUDA,TIUDT,TIURSTDT,TIUS
"RTN","TIUP188",61,0)
 ;
"RTN","TIUP188",62,0)
 ;Exit if required variables are not defined
"RTN","TIUP188",63,0)
 I '$G(TIUBEGDT)!('$G(TIUENDT)) G LNKRNGQ
"RTN","TIUP188",64,0)
 ;
"RTN","TIUP188",65,0)
 ;Initialize re-start if check point exists
"RTN","TIUP188",66,0)
 I +$G(^XTMP("TIUP188","CHKPT")) D
"RTN","TIUP188",67,0)
 . S TIURSTDT=$P($G(^XTMP("TIUP188","CHKPT")),U,1)
"RTN","TIUP188",68,0)
 ELSE  D
"RTN","TIUP188",69,0)
 . ;Initialize ^XTMP("TIUP188" if not re-start
"RTN","TIUP188",70,0)
 . S ^XTMP("TIUP188",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","TIUP188",71,0)
 . S ^XTMP("TIUP188","CNT","EX")=0 F TIUS=1:1:3 S ^XTMP("TIUP188","CNT","EX",TIUS)=0
"RTN","TIUP188",72,0)
 . S ^XTMP("TIUP188","CNT","LNK")=0
"RTN","TIUP188",73,0)
 . S ^XTMP("TIUP188","CNT","TOT")=0
"RTN","TIUP188",74,0)
 . S ^XTMP("TIUP188","CHKPT")=U_TIUBEGDT_U_TIUENDT
"RTN","TIUP188",75,0)
 K ^XTMP("TIUP188","STOP")
"RTN","TIUP188",76,0)
 S ^XTMP("TIUP188","T0")=$$NOW^XLFDT
"RTN","TIUP188",77,0)
 ;
"RTN","TIUP188",78,0)
 ;Loop through Entry Date/Time of documents by specified date range
"RTN","TIUP188",79,0)
 S TIUDT=$S($G(TIURSTDT):TIURSTDT,1:TIUBEGDT)
"RTN","TIUP188",80,0)
 F  S TIUDT=$O(^TIU(8925,"F",TIUDT)) Q:'TIUDT!(TIUDT>TIUENDT)!($G(ZTSTOP))  D
"RTN","TIUP188",81,0)
 . ;Loop through documents for Entry Date/Time
"RTN","TIUP188",82,0)
 . S TIUDA=0
"RTN","TIUP188",83,0)
 . F  S TIUDA=+$O(^TIU(8925,"F",TIUDT,TIUDA)) Q:'TIUDA  D LNKONE(TIUDA)
"RTN","TIUP188",84,0)
 . ;Set check point for Entry Date/Time
"RTN","TIUP188",85,0)
 . S $P(^XTMP("TIUP188","CHKPT"),U,1)=TIUDT
"RTN","TIUP188",86,0)
 . ;Check if user requested to stop task
"RTN","TIUP188",87,0)
 . I $$S^%ZTLOAD S ZTSTOP=1
"RTN","TIUP188",88,0)
 ;
"RTN","TIUP188",89,0)
LNKRNGQ ;Send bulletin, re-set check point and clean up variables
"RTN","TIUP188",90,0)
 I $G(ZTSTOP) S ^XTMP("TIUP188","STOP")=$$NOW^XLFDT
"RTN","TIUP188",91,0)
 S ^XTMP("TIUP188","T1")=$$NOW^XLFDT
"RTN","TIUP188",92,0)
 ;
"RTN","TIUP188",93,0)
 D MAIL^TIUP188P
"RTN","TIUP188",94,0)
 ;
"RTN","TIUP188",95,0)
 I '$G(ZTSTOP) S ^XTMP("TIUP188","CHKPT")=""
"RTN","TIUP188",96,0)
 K TIUBEGDT,TIUENDT,TIURSTDT
"RTN","TIUP188",97,0)
 Q
"RTN","TIUP188",98,0)
 ;
"RTN","TIUP188",99,0)
LNKONE(TIUDA) ;Entry point to automatically link one document to visit
"RTN","TIUP188",100,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188",101,0)
 ; Output -- None
"RTN","TIUP188",102,0)
 N TIUEX,TIUMVSTF,TIUVSIT
"RTN","TIUP188",103,0)
 ;
"RTN","TIUP188",104,0)
 ;Check if document can be linked
"RTN","TIUP188",105,0)
 I $D(^TIU(8925,TIUDA,0)),$P(^(0),U,3)'>0,$$CHKDOC(TIUDA) D
"RTN","TIUP188",106,0)
 . ;Get visit to associate with document
"RTN","TIUP188",107,0)
 . D GETVST(TIUDA,.TIUVSIT,.TIUMVSTF)
"RTN","TIUP188",108,0)
 . ;If only one visit update the document with the visit
"RTN","TIUP188",109,0)
 . I $G(TIUVSIT)>0,'$G(TIUMVSTF) D
"RTN","TIUP188",110,0)
 . . I $G(TIUVSIT),$$UPDVST^TIUPXAP2(TIUDA,TIUVSIT) D
"RTN","TIUP188",111,0)
 . . . ;Document linked to visit
"RTN","TIUP188",112,0)
 . . . D SETXTMP(TIUDA,,TIUVSIT)
"RTN","TIUP188",113,0)
 . . . ;Update kids that are addenda
"RTN","TIUP188",114,0)
 . . . D UPDKIDS(TIUDA,TIUVSIT)
"RTN","TIUP188",115,0)
 . . ELSE  D
"RTN","TIUP188",116,0)
 . . . ;Unable to automatically link - entry in use
"RTN","TIUP188",117,0)
 . . . D SETXTMP(TIUDA,2)
"RTN","TIUP188",118,0)
 . ELSE  D
"RTN","TIUP188",119,0)
 . . ;Unable to automatically link - multiple visits or no matching visit
"RTN","TIUP188",120,0)
 . . S TIUEX=$S($G(TIUMVSTF):1,1:3)
"RTN","TIUP188",121,0)
 . . D SETXTMP(TIUDA,TIUEX)
"RTN","TIUP188",122,0)
 S ^XTMP("TIUP188","CNT","TOT")=+$G(^XTMP("TIUP188","CNT","TOT"))+1
"RTN","TIUP188",123,0)
 Q
"RTN","TIUP188",124,0)
 ;
"RTN","TIUP188",125,0)
CHKDOC(TIUDA) ;Check if document can be auto-linked
"RTN","TIUP188",126,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188",127,0)
 ; Output -- 1=Can be linked and 0=Cannot be linked
"RTN","TIUP188",128,0)
 N TIUD0,TIUDPRM,Y
"RTN","TIUP188",129,0)
 ;
"RTN","TIUP188",130,0)
 ;Set variables
"RTN","TIUP188",131,0)
 S Y=0
"RTN","TIUP188",132,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUP188",133,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM)
"RTN","TIUP188",134,0)
 ;
"RTN","TIUP188",135,0)
 ;Capture method must be direct or remote
"RTN","TIUP188",136,0)
 I ("^D^R^")'[(U_$P($G(^TIU(8925,TIUDA,13)),U,3)_U) G CHKDOCQ
"RTN","TIUP188",137,0)
 ;
"RTN","TIUP188",138,0)
 ;Status must be uncosigned or completed or amended
"RTN","TIUP188",139,0)
 I ("^6^7^8^")'[(U_$P(TIUD0,U,5)_U) G CHKDOCQ
"RTN","TIUP188",140,0)
 ;
"RTN","TIUP188",141,0)
 ;Document must be signed
"RTN","TIUP188",142,0)
 I '+$G(^TIU(8925,TIUDA,15)) G CHKDOCQ
"RTN","TIUP188",143,0)
 ;
"RTN","TIUP188",144,0)
 ;Document cannot be a component
"RTN","TIUP188",145,0)
 I $P($G(TIUDPRM(0)),U,4)="CO" G CHKDOCQ
"RTN","TIUP188",146,0)
 ;
"RTN","TIUP188",147,0)
 ;Document cannot be associated with a disposition location
"RTN","TIUP188",148,0)
 I +$O(^PX(815,1,"DHL","B",+$P($G(^TIU(8925,TIUDA,12)),U,11),0)) G CHKDOCQ
"RTN","TIUP188",149,0)
 ;
"RTN","TIUP188",150,0)
 ;Document must be under progress notes class or consults
"RTN","TIUP188",151,0)
 I '+$$ISA^TIULX(+TIUD0,3),'+$$ISA^TIULX(+TIUD0,+$$CLASS^TIUCNSLT) G CHKDOCQ
"RTN","TIUP188",152,0)
 ;
"RTN","TIUP188",153,0)
 ;Check if workload should be entered and set auto-link flag to yes
"RTN","TIUP188",154,0)
 I $$WORKOK^TIUPXAP1(TIUDA),$$CHKWKL^TIUPXAP2(TIUDA,.TIUDPRM) S Y=1
"RTN","TIUP188",155,0)
CHKDOCQ Q +$G(Y)
"RTN","TIUP188",156,0)
 ;
"RTN","TIUP188",157,0)
GETVST(TIUDA,TIUVSIT,TIUMVSTF) ;Get visit to associate with document
"RTN","TIUP188",158,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188",159,0)
 ; Output -- TIUVSIT  Visit file (#9000010) IEN
"RTN","TIUP188",160,0)
 ;           TIUMVSTF Multiple Visit Flag
"RTN","TIUP188",161,0)
 ;                    1=Multiple Visits
"RTN","TIUP188",162,0)
 ;
"RTN","TIUP188",163,0)
 N TIUD0,TIUDFN,TIUEDT,TIUHL,TIUVSITS,TIUVSTR
"RTN","TIUP188",164,0)
 ;
"RTN","TIUP188",165,0)
 ;Set variables
"RTN","TIUP188",166,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUP188",167,0)
 S TIUDFN=$P(TIUD0,U,2),TIUEDT=$P(TIUD0,U,7)
"RTN","TIUP188",168,0)
 S TIUHL=$P($G(^TIU(8925,TIUDA,12)),U,11)
"RTN","TIUP188",169,0)
 S TIUVSTR=TIUHL_";"_TIUEDT_";"_$P(TIUD0,U,13)
"RTN","TIUP188",170,0)
 ;
"RTN","TIUP188",171,0)
 ;Check if document is an addendum, if it is use visit of parent
"RTN","TIUP188",172,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  G GETVSTQ
"RTN","TIUP188",173,0)
 . I $D(^TIU(8925,+$P(TIUD0,U,6),0)),$P(^(0),U,3)>0 S TIUVSIT=$P(^(0),U,3)
"RTN","TIUP188",174,0)
 ;
"RTN","TIUP188",175,0)
 ;Check if a document has already been entered for the Vstring,
"RTN","TIUP188",176,0)
 ;if it has use the visit in the AVSTRV cross-reference
"RTN","TIUP188",177,0)
 I +$G(TIUVSTR),+$O(^TIU(8925,"AVSTRV",+TIUDFN,TIUVSTR,0))>0 D  G GETVSTQ:$G(TIUVSIT)>0
"RTN","TIUP188",178,0)
 . S TIUVSIT=+$O(^TIU(8925,"AVSTRV",+TIUDFN,TIUVSTR,0))
"RTN","TIUP188",179,0)
 . I $P($G(^AUPNVSIT(+TIUVSIT,0)),U,5)'=TIUDFN S TIUVSIT=""
"RTN","TIUP188",180,0)
 ;
"RTN","TIUP188",181,0)
 ;Check PCE for a visit
"RTN","TIUP188",182,0)
 S TIUVSITS=$$GETENC^PXAPI(TIUDFN,TIUEDT,TIUHL)
"RTN","TIUP188",183,0)
 I TIUVSITS>0 S TIUVSIT=+TIUVSITS
"RTN","TIUP188",184,0)
 ;
"RTN","TIUP188",185,0)
 ;Set a flag if multiple visits
"RTN","TIUP188",186,0)
 I $P(TIUVSITS,U,2)'="" S TIUMVSTF=1
"RTN","TIUP188",187,0)
 K ^TMP("PXKENC",$J)
"RTN","TIUP188",188,0)
GETVSTQ Q
"RTN","TIUP188",189,0)
 ;
"RTN","TIUP188",190,0)
SETXTMP(TIUDA,TIUEX,TIUVSIT) ;Set ^XTMP for entries processed
"RTN","TIUP188",191,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188",192,0)
 ;           TIUEX    Unable to automatically link Exception types:  (Optional)
"RTN","TIUP188",193,0)
 ;                    1=Multiple Visits
"RTN","TIUP188",194,0)
 ;                    2=Entry in Use
"RTN","TIUP188",195,0)
 ;                    3=No Matching Visit
"RTN","TIUP188",196,0)
 ;           TIUVSIT  Visit file (#9000010) IEN  (Optional)
"RTN","TIUP188",197,0)
 ; Output -- Set ^XTMP("TIUP188","LNK",TIUDA)=
"RTN","TIUP188",198,0)
 ;               1st piece= 1=Linked and 0=Not Linked
"RTN","TIUP188",199,0)
 ;               2nd piece= Exception type if not linked
"RTN","TIUP188",200,0)
 ;               3rd piece= Visit file (#9000010) IEN if linked
"RTN","TIUP188",201,0)
 I $G(TIUEX) D
"RTN","TIUP188",202,0)
 . S ^XTMP("TIUP188","LNK",TIUDA)=0_U_$G(TIUEX)
"RTN","TIUP188",203,0)
 . S ^XTMP("TIUP188","CNT","EX",TIUEX)=+$G(^XTMP("TIUP188","CNT","EX",TIUEX))+1
"RTN","TIUP188",204,0)
 . S ^XTMP("TIUP188","CNT","EX")=+$G(^XTMP("TIUP188","CNT","EX"))+1
"RTN","TIUP188",205,0)
 ELSE  D
"RTN","TIUP188",206,0)
 . S ^XTMP("TIUP188","LNK",TIUDA)=1_U_U_$G(TIUVSIT)
"RTN","TIUP188",207,0)
 . S ^XTMP("TIUP188","CNT","LNK")=+$G(^XTMP("TIUP188","CNT","LNK"))+1
"RTN","TIUP188",208,0)
 Q
"RTN","TIUP188",209,0)
 ;
"RTN","TIUP188",210,0)
UPDKIDS(TIUDA,TIUVSIT) ;Update visit for kids that are addenda
"RTN","TIUP188",211,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188",212,0)
 ;           TIUVSIT  Visit file (#9000010) IEN
"RTN","TIUP188",213,0)
 ; Output -- None
"RTN","TIUP188",214,0)
 N TIUKID
"RTN","TIUP188",215,0)
 S TIUKID=0
"RTN","TIUP188",216,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",TIUDA,TIUKID)) Q:'TIUKID  D
"RTN","TIUP188",217,0)
 . I +$$ISADDNDM^TIULC1(TIUKID),$P($G(^TIU(8925,TIUKID,0)),U,3)'>0 D
"RTN","TIUP188",218,0)
 . . I $$UPDVST^TIUPXAP2(TIUKID,TIUVSIT) D
"RTN","TIUP188",219,0)
 . . . D SETXTMP(TIUKID,,TIUVSIT)
"RTN","TIUP188",220,0)
 . . ELSE  D
"RTN","TIUP188",221,0)
 . . . D SETXTMP(TIUKID,2)
"RTN","TIUP188",222,0)
 Q
"RTN","TIUP188P")
0^2^B23227242
"RTN","TIUP188P",1,0)
TIUP188P ; SLC/RMO,TT - Post-Install for TIU*1*188 Cont.; [5/19/04 1:52pm]
"RTN","TIUP188P",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**188**;Jun 20, 1997
"RTN","TIUP188P",3,0)
PRINT ; -- Device Selection
"RTN","TIUP188P",4,0)
 W !!,"This routine will print ALL records processed to date by the"
"RTN","TIUP188P",5,0)
 W !,"auto-link routine independent of the date range selected at"
"RTN","TIUP188P",6,0)
 W !,"processing time."
"RTN","TIUP188P",7,0)
 W !!,$C(7),"This report requires a column width of 132.",!
"RTN","TIUP188P",8,0)
 S %ZIS="Q" D ^%ZIS I POP K POP G PRINTQ
"RTN","TIUP188P",9,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","TIUP188P",10,0)
 . S ZTRTN="LIST^TIUP188P"
"RTN","TIUP188P",11,0)
 . S ZTDESC="TIU*1*188 AUTO-LINK MISSING VISIT TO DOCUMENT RESULTS"
"RTN","TIUP188P",12,0)
 . D ^%ZTLOAD W !,$S($D(ZTSK):"Request queued",1:"Request Cancelled!")
"RTN","TIUP188P",13,0)
 . K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,%ZIS
"RTN","TIUP188P",14,0)
 . D HOME^%ZIS
"RTN","TIUP188P",15,0)
 U IO D LIST,^%ZISC
"RTN","TIUP188P",16,0)
PRINTQ Q
"RTN","TIUP188P",17,0)
 ;
"RTN","TIUP188P",18,0)
LIST ; -- Entry point to generate list
"RTN","TIUP188P",19,0)
 N TIUDA,TIULNK,TIUOUT S TIUOUT=0
"RTN","TIUP188P",20,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","TIUP188P",21,0)
 D HDR
"RTN","TIUP188P",22,0)
 I +$O(^XTMP("TIUP188","LNK",0))'>0 W !?4,"No records in list." G LISTQ
"RTN","TIUP188P",23,0)
 S TIUDA=0
"RTN","TIUP188P",24,0)
 F  S TIUDA=$O(^XTMP("TIUP188","LNK",TIUDA)) Q:'TIUDA!(TIUOUT)  S TIULNK=$G(^(TIUDA)) D LISTONE(TIUDA,TIULNK)
"RTN","TIUP188P",25,0)
LISTQ Q
"RTN","TIUP188P",26,0)
 ;
"RTN","TIUP188P",27,0)
LISTONE(TIUDA,TIULNK) ;Entry point to list one record
"RTN","TIUP188P",28,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUP188P",29,0)
 ;           TIULNK   1st piece= 1=Linked and 0=Not Linked
"RTN","TIUP188P",30,0)
 ;                    2nd piece= Exception type if not linked
"RTN","TIUP188P",31,0)
 ;                    3rd piece= Visit file (#9000010) IEN if linked
"RTN","TIUP188P",32,0)
 ; Output -- None
"RTN","TIUP188P",33,0)
 N DFN,TIUEX,VADM,VAIP,VAIN,VA
"RTN","TIUP188P",34,0)
 I $Y>(IOSL-4) D ASK G LISTONEQ:TIUOUT  D HDR
"RTN","TIUP188P",35,0)
 S DFN=+$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","TIUP188P",36,0)
 S TIUEX=+$P($G(TIULNK),U,2)
"RTN","TIUP188P",37,0)
 D OERR^VADPT
"RTN","TIUP188P",38,0)
 W !,$E($G(VADM(1)),1,20)_" ("_$G(VA("BID"))_")"
"RTN","TIUP188P",39,0)
 W ?30,TIUDA
"RTN","TIUP188P",40,0)
 W ?42,$E($P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUDA,0)),0)),U,1),1,10)
"RTN","TIUP188P",41,0)
 W ?53,$$DATE^TIULS(+$P($G(^TIU(8925,+TIUDA,13)),U,1),"MM/DD/CCYY HR:MIN")
"RTN","TIUP188P",42,0)
 I +$G(TIULNK),$P(TIULNK,U,3) D
"RTN","TIUP188P",43,0)
 . N DA,DIC,DIQ,DR,TIUVISIT
"RTN","TIUP188P",44,0)
 . S DIC="^AUPNVSIT(",DIQ="TIUVISIT",DIQ(0)="E",DA=+$P(TIULNK,U,3)
"RTN","TIUP188P",45,0)
 . S DR=".01;.22" D EN^DIQ1
"RTN","TIUP188P",46,0)
 . W ?70,$E($G(TIUVISIT(9000010,DA,.22,"E")),1,15)
"RTN","TIUP188P",47,0)
 . W ?86,$G(TIUVISIT(9000010,DA,.01,"E"))
"RTN","TIUP188P",48,0)
 . W ?109,"Yes-Visit #"_$P(TIULNK,U,3)
"RTN","TIUP188P",49,0)
 ELSE  D
"RTN","TIUP188P",50,0)
 . W ?109,"No-"
"RTN","TIUP188P",51,0)
 . W $S(TIUEX=1:"Multiple Visits",TIUEX=2:"Entry in Use",TIUEX=3:"No Matching Visit",1:"")
"RTN","TIUP188P",52,0)
LISTONEQ Q
"RTN","TIUP188P",53,0)
 ;
"RTN","TIUP188P",54,0)
ASK ; -- End of Page
"RTN","TIUP188P",55,0)
 I IO=IO(0),$E(IOST,1,2)="C-" D
"RTN","TIUP188P",56,0)
 . W ! N DIR,X,Y,DUOUT,DTOUT S DIR(0)="E"
"RTN","TIUP188P",57,0)
 . D ^DIR I $D(DUOUT)!$D(DTOUT) S TIUOUT=1
"RTN","TIUP188P",58,0)
 Q
"RTN","TIUP188P",59,0)
 ;
"RTN","TIUP188P",60,0)
HDR ; -- Header for report
"RTN","TIUP188P",61,0)
 N LNE,TIUNOW
"RTN","TIUP188P",62,0)
 D NOW^%DTC S Y=% X ^DD("DD") S TIUNOW=Y
"RTN","TIUP188P",63,0)
 W @IOF,"TIU*1*188 AUTO-LINK MISSING VISIT TO DOCUMENT LIST - Printed: ",TIUNOW
"RTN","TIUP188P",64,0)
 W !,"Patient",?30,"Document #",?42,"Title",?53,"Reference Date",?70,"Visit Location",?86,"Visit Date/Time",?109,"Linked"
"RTN","TIUP188P",65,0)
 W ! S LNE="",$P(LNE,"-",(IOM-1))="" W LNE
"RTN","TIUP188P",66,0)
 Q
"RTN","TIUP188P",67,0)
 ;
"RTN","TIUP188P",68,0)
MAIL ;Send completion message to user who initiated post-install
"RTN","TIUP188P",69,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,XMMG
"RTN","TIUP188P",70,0)
 N TIURNG,TIUTXT
"RTN","TIUP188P",71,0)
 S XMDUZ="PATCH TIU*1*188 AUTO-LINK VISIT TO DOCUMENT",XMY(.5)=""
"RTN","TIUP188P",72,0)
 S:$G(DUZ) XMY(DUZ)=""
"RTN","TIUP188P",73,0)
 S TIUTXT(1)="Auto-link missing VISIT field (#.03) in the TIU DOCUMENT file (#8925)"
"RTN","TIUP188P",74,0)
 S TIUTXT(2)="to an existing visit:"
"RTN","TIUP188P",75,0)
 S TIUTXT(3)=""
"RTN","TIUP188P",76,0)
 S TIUTXT(4)="Task Started: "_$$FMTE^XLFDT($G(^XTMP("TIUP188","T0")))
"RTN","TIUP188P",77,0)
 S TIUTXT(5)="Task   Ended: "_$$FMTE^XLFDT($G(^XTMP("TIUP188","T1")))
"RTN","TIUP188P",78,0)
 S TIUTXT(6)=""
"RTN","TIUP188P",79,0)
 ;
"RTN","TIUP188P",80,0)
 S TIURNG=$$FMTE^XLFDT($P($G(^XTMP("TIUP188","CHKPT")),U,2))_" thru "_$S($G(^XTMP("TIUP188","STOP")):$$FMTE^XLFDT($P($G(^XTMP("TIUP188","CHKPT")),U,1)),1:$$FMTE^XLFDT($P($G(^XTMP("TIUP188","CHKPT")),U,3)))
"RTN","TIUP188P",81,0)
 S TIUTXT(7)="Date Range Processed: "_TIURNG
"RTN","TIUP188P",82,0)
 S TIUTXT(8)=""
"RTN","TIUP188P",83,0)
 S TIUTXT(9)="Number of entries automatically linked: "_+$G(^XTMP("TIUP188","CNT","LNK"))
"RTN","TIUP188P",84,0)
 S TIUTXT(10)=""
"RTN","TIUP188P",85,0)
 S TIUTXT(11)="Number of entries NOT automatically linked: "_+$G(^XTMP("TIUP188","CNT","EX"))
"RTN","TIUP188P",86,0)
 S TIUTXT(12)="  -Number NOT linked because - Multiple Visits: "_+$G(^XTMP("TIUP188","CNT","EX",1))
"RTN","TIUP188P",87,0)
 S TIUTXT(13)="  -Number NOT linked because - Entry in Use: "_+$G(^XTMP("TIUP188","CNT","EX",2))
"RTN","TIUP188P",88,0)
 S TIUTXT(14)="  -Number NOT linked because - No Matching Visit: "_+$G(^XTMP("TIUP188","CNT","EX",3))
"RTN","TIUP188P",89,0)
 S TIUTXT(15)=""
"RTN","TIUP188P",90,0)
 S TIUTXT(16)="TOTAL Number of entries processed: "_+$G(^XTMP("TIUP188","CNT","TOT"))
"RTN","TIUP188P",91,0)
 S TIUTXT(17)=""
"RTN","TIUP188P",92,0)
 I $G(^XTMP("TIUP188","STOP")) D
"RTN","TIUP188P",93,0)
 . S TIUTXT(18)="Task STOPPED: "_$$FMTE^XLFDT($G(^XTMP("TIUP188","STOP")))_"."
"RTN","TIUP188P",94,0)
 ELSE  D
"RTN","TIUP188P",95,0)
 . S TIUTXT(18)="Task COMPLETED successfully."
"RTN","TIUP188P",96,0)
 . S TIUTXT(19)=""
"RTN","TIUP188P",97,0)
 . S TIUTXT(20)="To print a detailed listing of ALL records processed invoke D PRINT^TIUP188P."
"RTN","TIUP188P",98,0)
 S XMTEXT="TIUTXT(",XMSUB="TIU*1*188 Auto-link from "_TIURNG
"RTN","TIUP188P",99,0)
 D ^XMD
"RTN","TIUP188P",100,0)
 Q
"VER")
8.0^22.0
**END**
**END**
