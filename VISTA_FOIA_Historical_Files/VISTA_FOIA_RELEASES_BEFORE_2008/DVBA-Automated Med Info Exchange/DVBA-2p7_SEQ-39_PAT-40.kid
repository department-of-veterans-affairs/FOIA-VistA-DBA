EMERGENCY Released DVBA*2.7*40 SEQ #39
Extracted from mail message
**KIDS**:DVBA*2.7*40^

**INSTALL NAME**
DVBA*2.7*40
"BLD",3646,0)
DVBA*2.7*40^AUTOMATED MED INFO EXCHANGE^0^3011107^y
"BLD",3646,4,0)
^9.64PA^^
"BLD",3646,"ABPKG")
n
"BLD",3646,"INI")
DVBAP40
"BLD",3646,"INID")
^^y
"BLD",3646,"KRN",0)
^9.67PA^19^17
"BLD",3646,"KRN",.4,0)
.4
"BLD",3646,"KRN",.401,0)
.401
"BLD",3646,"KRN",.402,0)
.402
"BLD",3646,"KRN",.403,0)
.403
"BLD",3646,"KRN",.5,0)
.5
"BLD",3646,"KRN",.84,0)
.84
"BLD",3646,"KRN",3.6,0)
3.6
"BLD",3646,"KRN",3.8,0)
3.8
"BLD",3646,"KRN",9.2,0)
9.2
"BLD",3646,"KRN",9.8,0)
9.8
"BLD",3646,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3646,"KRN",9.8,"NM",1,0)
DVBCPATA^^0^B9297946
"BLD",3646,"KRN",9.8,"NM","B","DVBCPATA",1)

"BLD",3646,"KRN",19,0)
19
"BLD",3646,"KRN",19.1,0)
19.1
"BLD",3646,"KRN",101,0)
101
"BLD",3646,"KRN",409.61,0)
409.61
"BLD",3646,"KRN",771,0)
771
"BLD",3646,"KRN",870,0)
870
"BLD",3646,"KRN",8994,0)
8994
"BLD",3646,"KRN","B",.4,.4)

"BLD",3646,"KRN","B",.401,.401)

"BLD",3646,"KRN","B",.402,.402)

"BLD",3646,"KRN","B",.403,.403)

"BLD",3646,"KRN","B",.5,.5)

"BLD",3646,"KRN","B",.84,.84)

"BLD",3646,"KRN","B",3.6,3.6)

"BLD",3646,"KRN","B",3.8,3.8)

"BLD",3646,"KRN","B",9.2,9.2)

"BLD",3646,"KRN","B",9.8,9.8)

"BLD",3646,"KRN","B",19,19)

"BLD",3646,"KRN","B",19.1,19.1)

"BLD",3646,"KRN","B",101,101)

"BLD",3646,"KRN","B",409.61,409.61)

"BLD",3646,"KRN","B",771,771)

"BLD",3646,"KRN","B",870,870)

"BLD",3646,"KRN","B",8994,8994)

"BLD",3646,"QUES",0)
^9.62^^
"BLD",3646,"REQB",0)
^9.611^^
"INI")
DVBAP40
"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
40^3011107^100892
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBAP40")
0^^B4445036
"RTN","DVBAP40",1,0)
DVBAP40 ;ALB-ISC/FLB - Pre/post inits  ; 30 OCT 2001 12:00PM
"RTN","DVBAP40",2,0)
 ;;2.7;AMIE;**40**;Apr 10, 1995
"RTN","DVBAP40",3,0)
PRE ;
"RTN","DVBAP40",4,0)
 ;checking enviroment variables
"RTN","DVBAP40",5,0)
 N EVN S EVN=1
"RTN","DVBAP40",6,0)
 I '$G(DUZ)!($G(DUZ(0))'="@") D
"RTN","DVBAP40",7,0)
 .D MES^XPDUTL("*****")
"RTN","DVBAP40",8,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DVBAP40",9,0)
 .D MES^XPDUTL("Pre-installation aborted.")
"RTN","DVBAP40",10,0)
 .D MES^XPDUTL("Please notify National Help Desk 888-596-4357 with any questions.")
"RTN","DVBAP40",11,0)
 .D MES^XPDUTL("*****")
"RTN","DVBAP40",12,0)
 .S EVN=0
"RTN","DVBAP40",13,0)
 .Q
"RTN","DVBAP40",14,0)
 Q:'EVN 
"RTN","DVBAP40",15,0)
 N IEN,DIERR
"RTN","DVBAP40",16,0)
 S IEN=$$FIND1^DIC(.402,"","X","DVBA C ADD 2507 PAT")
"RTN","DVBAP40",17,0)
 I $D(DIERR) D
"RTN","DVBAP40",18,0)
 .N VAR
"RTN","DVBAP40",19,0)
 .S VAR(1,0)="1,7,0,2,0^...Error..."
"RTN","DVBAP40",20,0)
 .S VAR(2,0)="0,7,0,2,0^...Duplicate Input Templates located...."
"RTN","DVBAP40",21,0)
 .S VAR(3,0)="0,7,0,2,0^...Duplicate Templates found for, 'DVBA C ADD 2507 PAT'"
"RTN","DVBAP40",22,0)
 .S VAR(4,0)="0,7,0,2,0^...Pre-installation aborted!...."
"RTN","DVBAP40",23,0)
 .S VAR(5,0)="0,7,0,2,0^...Please notify National Help Desk 888-596-4357 with any questions."
"RTN","DVBAP40",24,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAP40",25,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBAP40",26,0)
 I $D(DIERR) G EXIT
"RTN","DVBAP40",27,0)
 I 'IEN D
"RTN","DVBAP40",28,0)
 .N VAR
"RTN","DVBAP40",29,0)
 .S VAR(1,0)="1,7,0,2,0^...Error..."
"RTN","DVBAP40",30,0)
 .S VAR(2,0)="0,7,0,2,0^...Unable to locate Input Template..."
"RTN","DVBAP40",31,0)
 .S VAR(3,0)="0,7,0,2,0^...Template 'DVBA C ADD 2507 PAT' not found ...."
"RTN","DVBAP40",32,0)
 .S VAR(4,0)="0,7,0,2,0^...Pre-installation aborted!...."
"RTN","DVBAP40",33,0)
 .S VAR(5,0)="0,7,0,2,0^...Please notify National Help Desk 888-596-4357 with any questions."
"RTN","DVBAP40",34,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAP40",35,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBAP40",36,0)
 Q:'IEN  D UNC
"RTN","DVBAP40",37,0)
EXIT Q
"RTN","DVBAP40",38,0)
UNC ; Uncomplie Input template
"RTN","DVBAP40",39,0)
 D UNC^DIEZ(IEN)
"RTN","DVBAP40",40,0)
 Q
"RTN","DVBCPATA")
0^1^B9297946
"RTN","DVBCPATA",1,0)
DVBCPATA ;ALB/JLU,557/THM-ADD NEW VET TO FILE #2 ; 10/4/91  9:22 AM
"RTN","DVBCPATA",2,0)
 ;;2.7;AMIE;**1,23,40**;Apr 10, 1995
"RTN","DVBCPATA",3,0)
 ;
"RTN","DVBCPATA",4,0)
EN ;determine if new patient
"RTN","DVBCPATA",5,0)
 S OLDHD1=HD1,HD1="Additional Veteran Information"
"RTN","DVBCPATA",6,0)
 K DVBCNEW,OUT,EDIT
"RTN","DVBCPATA",7,0)
 S DIC="^DPT(",DIC(0)="AELMQ",DLAYGO=2
"RTN","DVBCPATA",8,0)
 D ^DIC
"RTN","DVBCPATA",9,0)
 K DLAYGO
"RTN","DVBCPATA",10,0)
 I Y<0 S OUT=1 D EXIT1 Q
"RTN","DVBCPATA",11,0)
 S (DVBADA,DA)=+Y
"RTN","DVBCPATA",12,0)
 I $P(Y,U,3) S DVBCNEW=1
"RTN","DVBCPATA",13,0)
 ;
"RTN","DVBCPATA",14,0)
ADDR I '$D(DVBCNEW) S DTA=^DPT(DA,0),PNAM=$P(DTA,U,1),SSN=$P(DTA,U,9),DFN=DA,CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") S:CNUM="" CNUM="Unknown"
"RTN","DVBCPATA",15,0)
 ;
"RTN","DVBCPATA",16,0)
ASK K %Y I '$D(DVBCNEW) D ADDR^DVBCUTIL W !,"Is this the correct Veteran" S %=2 D YN^DICN I $D(DTOUT)!(%<0) S OUT=1 G EXIT
"RTN","DVBCPATA",17,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y if it is the correct Veteran, N to reselect",! G ASK
"RTN","DVBCPATA",18,0)
 K %Y I '$D(DVBCNEW),$D(%),%'=1 D CLR G EN
"RTN","DVBCPATA",19,0)
 ;
"RTN","DVBCPATA",20,0)
ASKED1 I $D(EDIT) S DIE="^DPT(",DR="W @IOF,!,""Edit Veteran Data"",!!!;.02;.09;.313;.314;.361;.525;.323;1901;.111;.112:.115;.1112;.117;.131;.132;.326;.327" D ^DIE S EDIT=1
"RTN","DVBCPATA",21,0)
 ;
"RTN","DVBCPATA",22,0)
ASKED2 I $D(EDIT) W !!,"Want to edit it again" S %=1 D YN^DICN G:%=1 ASKED1 S:$D(DTOUT)!(%<0) OUT=1 I $D(OUT) G EXIT
"RTN","DVBCPATA",23,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to edit the information again or N to skip.",!! H 3 G ASKED2
"RTN","DVBCPATA",24,0)
 W !! G EXIT1:'$D(DVBCNEW)
"RTN","DVBCPATA",25,0)
 S DIE("NO^")="BACKOUTOK",DIE="^DPT(",DR="[DVBA C ADD 2507 PAT]" D ^DIE K DIE("NO^") S EDIT=1
"RTN","DVBCPATA",26,0)
 I $D(DVBACPLT),DVBACPLT=0 DO
"RTN","DVBCPATA",27,0)
 .;Aborting C&P request due to incomplete Patient required information.
"RTN","DVBCPATA",28,0)
 .N VAR
"RTN","DVBCPATA",29,0)
 .S VAR(1,0)="1,5,0,2,0^...Error, required information missing!...."
"RTN","DVBCPATA",30,0)
 .S VAR(2,0)="0,7,0,1:2,0^...Unable to complete, Request aborted!....."
"RTN","DVBCPATA",31,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBCPATA",32,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCPATA",33,0)
 .S OUT=""
"RTN","DVBCPATA",34,0)
 .K VAR
"RTN","DVBCPATA",35,0)
 I $D(DVBACPLT),DVBACPLT=0 D EXIT1 QUIT  ;**QUIT w/out D EXIT
"RTN","DVBCPATA",36,0)
 ;
"RTN","DVBCPATA",37,0)
EXIT S DTA=^DPT(DA,0),PNAM=$P(DTA,U,1),SSN=$P(DTA,U,9),DFN=DA,CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") S:CNUM="" CNUM="Unknown"
"RTN","DVBCPATA",38,0)
 I $D(DVBCNEW) S XMB="DVBA C NEW C&P VETERAN",XMB(1)=PNAM,XMB(2)=SSN,XMB(3)=$S($D(^VA(200,+DUZ,0)):$P(^(0),U),1:"Unknown user"),Y=DT X ^DD("DD") S XMB(4)=Y D ^XMB
"RTN","DVBCPATA",39,0)
EXIT1 S HD1=OLDHD1 K OLDHD1,DIC,DIE,DR,%,%Y,DTA,X,Y,DVBCNEW,DVBADA,DVBACPLT Q
"RTN","DVBCPATA",40,0)
 ;
"RTN","DVBCPATA",41,0)
CLR W @IOF,!?(IOM-$L(HD1)\2),HD1,!!
"RTN","DVBCPATA",42,0)
 Q
"VER")
8.0^22
**END**
**END**
