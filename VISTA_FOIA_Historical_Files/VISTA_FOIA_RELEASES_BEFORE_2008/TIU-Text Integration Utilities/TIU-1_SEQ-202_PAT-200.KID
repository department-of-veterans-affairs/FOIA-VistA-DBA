Released TIU*1*200 SEQ #202
Extracted from mail message
**KIDS**:TIU*1.0*200^

**INSTALL NAME**
TIU*1.0*200
"BLD",6182,0)
TIU*1.0*200^TEXT INTEGRATION UTILITIES^0^3060828^y
"BLD",6182,1,0)
^^2^2^3050729^^
"BLD",6182,1,1,0)
The description of this patch may be found under the National Patch Module 
"BLD",6182,1,2,0)
under TIU*1.0*200.
"BLD",6182,4,0)
^9.64PA^^
"BLD",6182,"INI")
EN^TIUPR200
"BLD",6182,"KRN",0)
^9.67PA^8989.52^19
"BLD",6182,"KRN",.4,0)
.4
"BLD",6182,"KRN",.401,0)
.401
"BLD",6182,"KRN",.402,0)
.402
"BLD",6182,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6182,"KRN",.403,0)
.403
"BLD",6182,"KRN",.5,0)
.5
"BLD",6182,"KRN",.84,0)
.84
"BLD",6182,"KRN",3.6,0)
3.6
"BLD",6182,"KRN",3.8,0)
3.8
"BLD",6182,"KRN",9.2,0)
9.2
"BLD",6182,"KRN",9.8,0)
9.8
"BLD",6182,"KRN",9.8,"NM",0)
^9.68A^11^9
"BLD",6182,"KRN",9.8,"NM",1,0)
TIUHL7P1^^0^65222748
"BLD",6182,"KRN",9.8,"NM",2,0)
TIUHL7P2^^0^40187296
"BLD",6182,"KRN",9.8,"NM",3,0)
TIUHL7U1^^0^49682985
"BLD",6182,"KRN",9.8,"NM",6,0)
TIUHL7^^0^19460697
"BLD",6182,"KRN",9.8,"NM",7,0)
TIUHL7A^^0^6833987
"BLD",6182,"KRN",9.8,"NM",8,0)
TIUHL7P3^^0^44685560
"BLD",6182,"KRN",9.8,"NM",9,0)
TIUHL7U2^^0^27485997
"BLD",6182,"KRN",9.8,"NM",10,0)
TIUPR200^^0^23776798
"BLD",6182,"KRN",9.8,"NM",11,0)
TIULV^^0^32139768
"BLD",6182,"KRN",9.8,"NM","B","TIUHL7",6)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7A",7)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7P1",1)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7P2",2)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7P3",8)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7U1",3)

"BLD",6182,"KRN",9.8,"NM","B","TIUHL7U2",9)

"BLD",6182,"KRN",9.8,"NM","B","TIULV",11)

"BLD",6182,"KRN",9.8,"NM","B","TIUPR200",10)

"BLD",6182,"KRN",19,0)
19
"BLD",6182,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6182,"KRN",19,"NM",1,0)
TIUHL7 MSG MGR^^0
"BLD",6182,"KRN",19,"NM",2,0)
TIU IRM MAINTENANCE MENU^^2
"BLD",6182,"KRN",19,"NM","B","TIU IRM MAINTENANCE MENU",2)

"BLD",6182,"KRN",19,"NM","B","TIUHL7 MSG MGR",1)

"BLD",6182,"KRN",19.1,0)
19.1
"BLD",6182,"KRN",101,0)
101
"BLD",6182,"KRN",101,"NM",0)
^9.68A^14^14
"BLD",6182,"KRN",101,"NM",1,0)
TIUHL7 EXAMPLE MDM EVENT^^0
"BLD",6182,"KRN",101,"NM",2,0)
TIUHL7 EXAMPLE MDM SUB^^0
"BLD",6182,"KRN",101,"NM",3,0)
TIUHL7 MSG MGR BLANK 1^^0
"BLD",6182,"KRN",101,"NM",4,0)
TIUHL7 MSG MGR BLANK 2^^0
"BLD",6182,"KRN",101,"NM",5,0)
TIUHL7 MSG MGR BLANK 3^^0
"BLD",6182,"KRN",101,"NM",6,0)
TIUHL7 MSG MGR BLANK 4^^0
"BLD",6182,"KRN",101,"NM",7,0)
TIUHL7 MSG MGR MENU^^0
"BLD",6182,"KRN",101,"NM",8,0)
TIUHL7 MSG MGR DELETE^^0
"BLD",6182,"KRN",101,"NM",9,0)
TIUHL7 MSG MGR VIEW^^0
"BLD",6182,"KRN",101,"NM",10,0)
TIUHL7 MSG VIEW MENU^^0
"BLD",6182,"KRN",101,"NM",11,0)
TIUHL7 MSG VIEW DELETE^^0
"BLD",6182,"KRN",101,"NM",12,0)
TIUHL7 MSG VIEW REPROC^^0
"BLD",6182,"KRN",101,"NM",13,0)
TIUHL7 MSG MGR SELECT^^0
"BLD",6182,"KRN",101,"NM",14,0)
TIUHL7 MSG MGR REFRESH^^0
"BLD",6182,"KRN",101,"NM","B","TIUHL7 EXAMPLE MDM EVENT",1)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 EXAMPLE MDM SUB",2)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR BLANK 1",3)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR BLANK 2",4)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR BLANK 3",5)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR BLANK 4",6)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR DELETE",8)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR MENU",7)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR REFRESH",14)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR SELECT",13)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG MGR VIEW",9)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG VIEW DELETE",11)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG VIEW MENU",10)

"BLD",6182,"KRN",101,"NM","B","TIUHL7 MSG VIEW REPROC",12)

"BLD",6182,"KRN",409.61,0)
409.61
"BLD",6182,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",6182,"KRN",409.61,"NM",1,0)
TIUHL7 MSG MGR^^0
"BLD",6182,"KRN",409.61,"NM",2,0)
TIUHL7 MSG VIEW^^0
"BLD",6182,"KRN",409.61,"NM","B","TIUHL7 MSG MGR",1)

"BLD",6182,"KRN",409.61,"NM","B","TIUHL7 MSG VIEW",2)

"BLD",6182,"KRN",771,0)
771
"BLD",6182,"KRN",771,"NM",0)
^9.68A^3^2
"BLD",6182,"KRN",771,"NM",2,0)
TIUHL7 EX RECEIVING APP^^0
"BLD",6182,"KRN",771,"NM",3,0)
TIUHL7 EX SENDING APP^^0
"BLD",6182,"KRN",771,"NM","B","TIUHL7 EX RECEIVING APP",2)

"BLD",6182,"KRN",771,"NM","B","TIUHL7 EX SENDING APP",3)

"BLD",6182,"KRN",870,0)
870
"BLD",6182,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",6182,"KRN",870,"NM",1,0)
TIUHL7 EX^^0
"BLD",6182,"KRN",870,"NM","B","TIUHL7 EX",1)

"BLD",6182,"KRN",8989.51,0)
8989.51
"BLD",6182,"KRN",8989.52,0)
8989.52
"BLD",6182,"KRN",8994,0)
8994
"BLD",6182,"KRN","B",.4,.4)

"BLD",6182,"KRN","B",.401,.401)

"BLD",6182,"KRN","B",.402,.402)

"BLD",6182,"KRN","B",.403,.403)

"BLD",6182,"KRN","B",.5,.5)

"BLD",6182,"KRN","B",.84,.84)

"BLD",6182,"KRN","B",3.6,3.6)

"BLD",6182,"KRN","B",3.8,3.8)

"BLD",6182,"KRN","B",9.2,9.2)

"BLD",6182,"KRN","B",9.8,9.8)

"BLD",6182,"KRN","B",19,19)

"BLD",6182,"KRN","B",19.1,19.1)

"BLD",6182,"KRN","B",101,101)

"BLD",6182,"KRN","B",409.61,409.61)

"BLD",6182,"KRN","B",771,771)

"BLD",6182,"KRN","B",870,870)

"BLD",6182,"KRN","B",8989.51,8989.51)

"BLD",6182,"KRN","B",8989.52,8989.52)

"BLD",6182,"KRN","B",8994,8994)

"BLD",6182,"PRE")
TIUPR200
"BLD",6182,"QUES",0)
^9.62^^
"BLD",6182,"REQB",0)
^9.611^1^1
"BLD",6182,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",6182,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"INI")
EN^TIUPR200
"KRN",19,13218,-1)
2^2
"KRN",19,13218,0)
TIU IRM MAINTENANCE MENU^TIU Maintenance Menu^^M^33238^^^^^^^506^y^1^1
"KRN",19,13218,10,0)
^19.01IP^12^12
"KRN",19,13218,10,11,0)
17162^7^7
"KRN",19,13218,10,11,"^")
TIUHL7 MSG MGR
"KRN",19,13218,"U")
TIU MAINTENANCE MENU
"KRN",19,17162,-1)
0^1
"KRN",19,17162,0)
TIUHL7 MSG MGR^TIUHL7 Message Manager^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,17162,25)
EN^TIUHL7
"KRN",19,17162,99.1)
60478,28650
"KRN",19,17162,"U")
TIUHL7 MESSAGE MANAGER
"KRN",101,6461,-1)
0^7
"KRN",101,6461,0)
TIUHL7 MSG MGR MENU^TIUHL7 Message Manager Menu^^M^^^^^^^^
"KRN",101,6461,4)
40
"KRN",101,6461,10,0)
^101.01PA^6^6
"KRN",101,6461,10,1,0)
6465^^1^
"KRN",101,6461,10,1,"^")
TIUHL7 MSG MGR BLANK 1
"KRN",101,6461,10,2,0)
6463^^2^
"KRN",101,6461,10,2,"^")
TIUHL7 MSG MGR VIEW
"KRN",101,6461,10,3,0)
6466^^3^
"KRN",101,6461,10,3,"^")
TIUHL7 MSG MGR BLANK 2
"KRN",101,6461,10,4,0)
6467^^4^
"KRN",101,6461,10,4,"^")
TIUHL7 MSG MGR BLANK 3
"KRN",101,6461,10,5,0)
6464^^5^
"KRN",101,6461,10,5,"^")
TIUHL7 MSG MGR DELETE
"KRN",101,6461,10,6,0)
6482^^6^
"KRN",101,6461,10,6,"^")
TIUHL7 MSG MGR REFRESH
"KRN",101,6461,15)
D EXIT^TIUHL7
"KRN",101,6461,20)

"KRN",101,6461,26)
D SHOW^VALM
"KRN",101,6461,28)
Select Action:  
"KRN",101,6461,99)
60485,51613
"KRN",101,6462,-1)
0^13
"KRN",101,6462,0)
TIUHL7 MSG MGR SELECT^^^A^^^^^^^^
"KRN",101,6462,15)
S VALMBCK="R"
"KRN",101,6462,20)
D ACTION^TIUHL7("SELECT")
"KRN",101,6463,-1)
0^9
"KRN",101,6463,0)
TIUHL7 MSG MGR VIEW^View Message^^A^^^^^^^^
"KRN",101,6463,15)
S VALMBCK="R"
"KRN",101,6463,20)
D ACTION^TIUHL7("VIEW")
"KRN",101,6463,99)
60485,51613
"KRN",101,6464,-1)
0^8
"KRN",101,6464,0)
TIUHL7 MSG MGR DELETE^Delete Message(s)^^A^^^^^^^^
"KRN",101,6464,15)
S VALMBCK="R"
"KRN",101,6464,20)
D ACTION^TIUHL7("DELETE")
"KRN",101,6464,99)
60485,51613
"KRN",101,6465,-1)
0^3
"KRN",101,6465,0)
TIUHL7 MSG MGR BLANK 1^   ^^A^^^^^^^^
"KRN",101,6465,15)
S VALMBCK="R"
"KRN",101,6465,99)
60485,51613
"KRN",101,6466,-1)
0^4
"KRN",101,6466,0)
TIUHL7 MSG MGR BLANK 2^   ^^A^^^^^^^^
"KRN",101,6466,15)
S VALMBCK="R"
"KRN",101,6466,99)
60485,51613
"KRN",101,6467,-1)
0^5
"KRN",101,6467,0)
TIUHL7 MSG MGR BLANK 3^   ^^A^^^^^^^^
"KRN",101,6467,15)
S VALMBCK="R"
"KRN",101,6467,99)
60485,51613
"KRN",101,6468,-1)
0^6
"KRN",101,6468,0)
TIUHL7 MSG MGR BLANK 4^   ^^A^^^^^^^^
"KRN",101,6468,15)
S VALMBCK="R"
"KRN",101,6468,99)
60485,51613
"KRN",101,6477,-1)
0^10
"KRN",101,6477,0)
TIUHL7 MSG VIEW MENU^TIUHL7 Message Viewer^^M^^^^^^^^
"KRN",101,6477,4)
40
"KRN",101,6477,10,0)
^101.01PA^5^5
"KRN",101,6477,10,1,0)
6465^^1^
"KRN",101,6477,10,1,"^")
TIUHL7 MSG MGR BLANK 1
"KRN",101,6477,10,2,0)
6478^^2^
"KRN",101,6477,10,2,"^")
TIUHL7 MSG VIEW DELETE
"KRN",101,6477,10,3,0)
6466^^3^
"KRN",101,6477,10,3,"^")
TIUHL7 MSG MGR BLANK 2
"KRN",101,6477,10,4,0)
6467^^4^
"KRN",101,6477,10,4,"^")
TIUHL7 MSG MGR BLANK 3
"KRN",101,6477,10,5,0)
6479^^5^
"KRN",101,6477,10,5,"^")
TIUHL7 MSG VIEW REPROC
"KRN",101,6477,15)
D EXIT^TIUHL7A
"KRN",101,6477,26)
D SHOW^VALM
"KRN",101,6477,99)
60485,51613
"KRN",101,6478,-1)
0^11
"KRN",101,6478,0)
TIUHL7 MSG VIEW DELETE^Delete Message^^A^^^^^^^^
"KRN",101,6478,15)
S VALMBCK="Q"
"KRN",101,6478,20)
D DELETE^TIUHL7A
"KRN",101,6478,99)
60485,51613
"KRN",101,6479,-1)
0^12
"KRN",101,6479,0)
TIUHL7 MSG VIEW REPROC^Reprocess Message^^A^^^^^^^^
"KRN",101,6479,15)
S VALMBCK="Q"
"KRN",101,6479,20)
D REPROC^TIUHL7A
"KRN",101,6479,99)
60485,51613
"KRN",101,6480,-1)
0^1
"KRN",101,6480,0)
TIUHL7 EXAMPLE MDM EVENT^^^E^^^^^^^^
"KRN",101,6480,770)
TIUHL7 EX SENDING APP^^MDM^T02^^^^^^2.4^
"KRN",101,6480,775,0)
^101.0775PA^^0
"KRN",101,6481,-1)
0^2
"KRN",101,6481,0)
TIUHL7 EXAMPLE MDM SUB^^^S^^^^^^^^
"KRN",101,6481,770)
^TIUHL7 EX RECEIVING APP^^T02^^^TIUHL7 EX^^^^ACK
"KRN",101,6482,-1)
0^14
"KRN",101,6482,0)
TIUHL7 MSG MGR REFRESH^Refresh Message List^^A^^^^^^^^
"KRN",101,6482,20)
D REFRESH^TIUHL7
"KRN",101,6482,28)
     
"KRN",101,6482,99)
60485,51613
"KRN",409.61,627,-1)
0^1
"KRN",409.61,627,0)
TIUHL7 MSG MGR^1^^80^6^19^0^1^^TIUHL7 MSG MGR MENU^TIUHL7 Message Manager^1^^1
"KRN",409.61,627,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,627,"COL",0)
^409.621^5^5
"KRN",409.61,627,"COL",1,0)
Message ID^5^15^Message ID
"KRN",409.61,627,"COL",2,0)
Date/Time Processed^21^22^Date/Time Processed
"KRN",409.61,627,"COL",3,0)
RecApp^43^13^Application
"KRN",409.61,627,"COL",4,0)
SendApp^57^14^Application
"KRN",409.61,627,"COL",5,0)
Status^72^8^Status
"KRN",409.61,627,"COL","B","Date/Time Processed",2)

"KRN",409.61,627,"COL","B","Message ID",1)

"KRN",409.61,627,"COL","B","RecApp",3)

"KRN",409.61,627,"COL","B","SendApp",4)

"KRN",409.61,627,"COL","B","Status",5)

"KRN",409.61,627,"FNL")
D EXIT^TIUHL7
"KRN",409.61,627,"HDR")
D HDR^TIUHL7
"KRN",409.61,627,"HLP")
D HELP^TIUHL7
"KRN",409.61,627,"INIT")
D INIT^TIUHL7
"KRN",409.61,630,-1)
0^2
"KRN",409.61,630,0)
TIUHL7 MSG VIEW^1^^80^2^19^1^1^^TIUHL7 MSG VIEW MENU^TIUHL7 Message Viewer^1^^1
"KRN",409.61,630,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,630,"FNL")
D EXIT^TIUHL7A
"KRN",409.61,630,"HDR")
D HDR^TIUHL7A
"KRN",409.61,630,"HLP")
D HELP^TIUHL7A
"KRN",409.61,630,"INIT")
D INIT^TIUHL7A
"KRN",771,192,-1)
0^2
"KRN",771,192,0)
TIUHL7 EX RECEIVING APP^i^<required>^^^^USA
"KRN",771,192,"EC")
~|\&
"KRN",771,192,"FS")
^
"KRN",771,193,-1)
0^3
"KRN",771,193,0)
TIUHL7 EX SENDING APP^i^<required>^^^^USA
"KRN",771,193,"EC")
~|\&
"KRN",771,193,"FS")
^
"KRN",870,261,-1)
0^1
"KRN",870,261,0)
TIUHL7 EX^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,261,400)
10.224.54.3^5000^C^^^
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",506,-1)
1^1
"PKG",506,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",506,20,0)
^9.402P^^
"PKG",506,22,0)
^9.49I^1^1
"PKG",506,22,1,0)
1.0^2970620^2970916^3316
"PKG",506,22,1,"PAH",1,0)
200^3060828^33238
"PKG",506,22,1,"PAH",1,1,0)
^^2^2^3060828
"PKG",506,22,1,"PAH",1,1,1,0)
The description of this patch may be found under the National Patch Module 
"PKG",506,22,1,"PAH",1,1,2,0)
under TIU*1.0*200.
"PRE")
TIUPR200
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","TIUHL7")
0^6^B19460697^n/a
"RTN","TIUHL7",1,0)
TIUHL7 ; SLC/AJB - TIUHL7 Msg Mgr ; 10OCT05
"RTN","TIUHL7",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7",3,0)
 Q
"RTN","TIUHL7",4,0)
ACTION(ACT) ;
"RTN","TIUHL7",5,0)
 N TIUMSG,TIUSEL
"RTN","TIUHL7",6,0)
 D FULL^VALM1
"RTN","TIUHL7",7,0)
 I VALMCNT=0 W !,"No documents to select." H 3 Q
"RTN","TIUHL7",8,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUHL7",9,0)
 I TIUSEL="" D  Q:'+TIUSEL
"RTN","TIUHL7",10,0)
 . I VALMLST=1 S TIUSEL=1 Q
"RTN","TIUHL7",11,0)
 . N DIR,X,Y
"RTN","TIUHL7",12,0)
 . S DIR("A")=$S(ACT="DELETE":"Select Message(s) to Delete",ACT="VIEW":"Select Message to View")_": (1-"_VALMLST_") "
"RTN","TIUHL7",13,0)
 . S DIR("?")=$S(ACT="DELETE":"Select one or more messages to be deleted",ACT="VIEW":"Select one message to view")
"RTN","TIUHL7",14,0)
 . S DIR(0)=$S(ACT="DELETE":"L",ACT="VIEW":"N")_"OA^1:"_VALMLST
"RTN","TIUHL7",15,0)
 . D ^DIR S TIUSEL=Y
"RTN","TIUHL7",16,0)
 I TIUSEL["," S TIUSEL=$E(TIUSEL,1,($L(TIUSEL)-1))
"RTN","TIUHL7",17,0)
 F X=1:1:$L(TIUSEL,",") S TIUMSG($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUHL7",18,0)
 I ACT="SELECT" S ACT=$S(+$L(TIUSEL,",")=1:"VIEW",1:"DELETE")
"RTN","TIUHL7",19,0)
 D @ACT
"RTN","TIUHL7",20,0)
 Q
"RTN","TIUHL7",21,0)
DELETE ;
"RTN","TIUHL7",22,0)
 D FULL^VALM1
"RTN","TIUHL7",23,0)
 W @IOF,"Deleting the following message(s):",!
"RTN","TIUHL7",24,0)
 W !,"                                          Receiving     Sending        Message",!
"RTN","TIUHL7",25,0)
 W IOUON,"    Message ID      Date/Time Processed   Application   Application    Status   ",!,IOUOFF
"RTN","TIUHL7",26,0)
 S TIUSEL="" F  S TIUSEL=$O(TIUMSG(TIUSEL)) Q:'+TIUSEL  W @VALMAR@(TIUSEL,0),! ; TIUSEL,"   ",TIUMSG(TIUSEL),!
"RTN","TIUHL7",27,0)
 I $$READ^TIUU("Y","Delete message(s)") D
"RTN","TIUHL7",28,0)
 . S TIUSEL="" F  S TIUSEL=$O(TIUMSG(TIUSEL)) Q:'+TIUSEL  K ^XTMP("TIUHL7",$P(TIUMSG(TIUSEL),U,2),$P(TIUMSG(TIUSEL),U))
"RTN","TIUHL7",29,0)
 . W !!,"Deleting...finished."
"RTN","TIUHL7",30,0)
 W ! I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUHL7",31,0)
 D CLEAN^VALM10,INIT,RE^VALM4
"RTN","TIUHL7",32,0)
 S VALMBG=1
"RTN","TIUHL7",33,0)
 Q
"RTN","TIUHL7",34,0)
REFRESH ;
"RTN","TIUHL7",35,0)
 D CLEAN^VALM10,INIT,RE^VALM4
"RTN","TIUHL7",36,0)
 S VALMBG=1
"RTN","TIUHL7",37,0)
 Q
"RTN","TIUHL7",38,0)
VIEW ;
"RTN","TIUHL7",39,0)
 D EN^TIUHL7A
"RTN","TIUHL7",40,0)
 D CLEAN^VALM10,INIT,RE^VALM4
"RTN","TIUHL7",41,0)
 S VALMBG=1
"RTN","TIUHL7",42,0)
 Q
"RTN","TIUHL7",43,0)
EN ; main entry point for TIUHL7 MSG MGR
"RTN","TIUHL7",44,0)
 N POP
"RTN","TIUHL7",45,0)
 D EN^VALM("TIUHL7 MSG MGR")
"RTN","TIUHL7",46,0)
 Q
"RTN","TIUHL7",47,0)
HDR ; header code
"RTN","TIUHL7",48,0)
 N HDR S HDR="TIUHL7 Received Messages"
"RTN","TIUHL7",49,0)
 S VALMHDR(1)=$$SETSTR^VALM1(HDR,"",(IOM-$L(HDR))/2,$L(HDR))
"RTN","TIUHL7",50,0)
 S VALMHDR(2)=""
"RTN","TIUHL7",51,0)
 S VALMHDR(3)="                                          Receiving     Sending        Message"
"RTN","TIUHL7",52,0)
 D XQORM
"RTN","TIUHL7",53,0)
 Q
"RTN","TIUHL7",54,0)
INIT ; init variables and list array
"RTN","TIUHL7",55,0)
 N TIU,TIUDISP,TIUDT,TIUMID
"RTN","TIUHL7",56,0)
 S TIU("CUOFF")=$C(27)_"[?25l",TIU("CUON")=$C(27)_"[?25h" ; cursor values
"RTN","TIUHL7",57,0)
 W TIU("CUOFF"),!!,"Searching for messages..."
"RTN","TIUHL7",58,0)
 S (TIUDT,VALMCNT)=0,(TIUDISP,TIUMID)=""
"RTN","TIUHL7",59,0)
 F  S TIUDT=$O(^XTMP("TIUHL7",TIUDT)) Q:'+TIUDT  F  S TIUMID=$O(^XTMP("TIUHL7",TIUDT,TIUMID)) Q:'+TIUMID  D
"RTN","TIUHL7",60,0)
 . S VALMCNT=VALMCNT+1 W:VALMCNT#3=0 "."
"RTN","TIUHL7",61,0)
 . S TIUDISP=$$SETSTR^VALM1(VALMCNT,"",1,8)
"RTN","TIUHL7",62,0)
 . S TIUDISP=$$SETFLD^VALM1($P($G(^XTMP("TIUHL7",TIUDT,TIUMID,"MSGRESULT",1)),U,3),TIUDISP,"Message ID")
"RTN","TIUHL7",63,0)
 . S TIUDISP=$$SETFLD^VALM1($$FMTE^XLFDT(TIUDT),TIUDISP,"Date/Time Processed")
"RTN","TIUHL7",64,0)
 . S TIUDISP=$$SETFLD^VALM1($P($G(^XTMP("TIUHL7",TIUDT,TIUMID,"MSGRESULT",1)),U,4),TIUDISP,"RecApp")
"RTN","TIUHL7",65,0)
 . S TIUDISP=$$SETFLD^VALM1($P($G(^XTMP("TIUHL7",TIUDT,TIUMID,"MSGRESULT",1)),U,5),TIUDISP,"SendApp")
"RTN","TIUHL7",66,0)
 . S TIU=$P($G(^XTMP("TIUHL7",TIUDT,TIUMID,"MSGRESULT",1)),U,2),TIU=$S(TIU="AR":"Rejected",TIU="AA":"Accepted",1:"Unknown")
"RTN","TIUHL7",67,0)
 . S TIUDISP=$$SETFLD^VALM1(TIU,TIUDISP,"Status")
"RTN","TIUHL7",68,0)
 . D SET^VALM10(VALMCNT,TIUDISP,TIUMID_U_TIUDT)
"RTN","TIUHL7",69,0)
 ;
"RTN","TIUHL7",70,0)
 I VALMCNT=0 D
"RTN","TIUHL7",71,0)
 . S TIU="No records found to satisfy search criteria."
"RTN","TIUHL7",72,0)
 . D SET^VALM10(2,$$SETSTR^VALM1(TIU,"",(IOM-$L(TIU))/2,$L(TIU)),0)
"RTN","TIUHL7",73,0)
 Q
"RTN","TIUHL7",74,0)
HELP ; help code
"RTN","TIUHL7",75,0)
 I X="?" S POP=1
"RTN","TIUHL7",76,0)
 D FULL^VALM1
"RTN","TIUHL7",77,0)
 W !!,"The following actions are available:"
"RTN","TIUHL7",78,0)
 W !!,"View a Message       - View a selected message"
"RTN","TIUHL7",79,0)
 W !,"Delete Message(s)    - Delete selected message(s)"
"RTN","TIUHL7",80,0)
 W !,"Refresh Message List - Refresh display"
"RTN","TIUHL7",81,0)
 W !!,"If ONE message is selected, default action is VIEW"
"RTN","TIUHL7",82,0)
 W !,"If multiple messages are selected, default action is DELETE",!
"RTN","TIUHL7",83,0)
 I +$G(POP) I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUHL7",84,0)
 S VALMBCK="R",POP=0
"RTN","TIUHL7",85,0)
 Q
"RTN","TIUHL7",86,0)
EXIT ; exit code
"RTN","TIUHL7",87,0)
 D XQORM
"RTN","TIUHL7",88,0)
 Q
"RTN","TIUHL7",89,0)
EXPND ; expand code
"RTN","TIUHL7",90,0)
 Q
"RTN","TIUHL7",91,0)
XQORM ; default action for list manager
"RTN","TIUHL7",92,0)
 S XQORM("#")=$O(^ORD(101,"B","TIUHL7 MSG MGR SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUHL7",93,0)
 Q
"RTN","TIUHL7A")
0^7^B6833987^n/a
"RTN","TIUHL7A",1,0)
TIUHL7A ; SLC/AJB - TIUHL7 Msg Mgr ; 10OCT05
"RTN","TIUHL7A",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7A",3,0)
 Q
"RTN","TIUHL7A",4,0)
DELETE ;
"RTN","TIUHL7A",5,0)
 D FULL^VALM1
"RTN","TIUHL7A",6,0)
 W ! I $$READ^TIUU("Y","Are you sure you wish to delete this message") D
"RTN","TIUHL7A",7,0)
 . K ^XTMP("TIUHL7",$P(TIUMSG(TIUSEL),U,2),$P(TIUMSG(TIUSEL),U))
"RTN","TIUHL7A",8,0)
 . W !!,"Message deleted."
"RTN","TIUHL7A",9,0)
 W ! I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUHL7A",10,0)
 Q
"RTN","TIUHL7A",11,0)
REPROC ;
"RTN","TIUHL7A",12,0)
 N HL771RF,HL771SF,HLCS,HLDOM,HLINSTN,HLPARAM,HLPID,HLREC,HLRFREQ,HLSFREQ
"RTN","TIUHL7A",13,0)
 D FULL^VALM1
"RTN","TIUHL7A",14,0)
 W !!,"Reprocessing message..."
"RTN","TIUHL7A",15,0)
 I '$$REPROC^HLUTIL($P(TIUMSG(TIUSEL),U),"PROCMSG^TIUHL7P1") W !,"finished.",! I $$READ^TIUU("EA","Press <RETURN> to continue") Q
"RTN","TIUHL7A",16,0)
 W "ERROR.  Unable to reprocess this message.",!
"RTN","TIUHL7A",17,0)
 I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUHL7A",18,0)
 Q
"RTN","TIUHL7A",19,0)
EN ; main entry point for TIUHL7 MSG VIEW
"RTN","TIUHL7A",20,0)
 N TIULVL
"RTN","TIUHL7A",21,0)
 D EN^VALM("TIUHL7 MSG VIEW")
"RTN","TIUHL7A",22,0)
 K ^XTMP("VALMAR",$J,TIULVL)
"RTN","TIUHL7A",23,0)
 Q
"RTN","TIUHL7A",24,0)
HDR ;
"RTN","TIUHL7A",25,0)
 Q
"RTN","TIUHL7A",26,0)
INIT ;
"RTN","TIUHL7A",27,0)
 N TIULINE,TIUX
"RTN","TIUHL7A",28,0)
 S TIULVL=VALMEVL,VALMCNT=0
"RTN","TIUHL7A",29,0)
 F TIUX="MSGRESULT","MSG" D
"RTN","TIUHL7A",30,0)
 . N TIUCNT,TIUTEXT,TIUVAL S TIUVAL=80 ; TIUVAL is column width for display in LM - each line will be <=TIUVAL
"RTN","TIUHL7A",31,0)
 . S TIULINE="" F  S TIULINE=$O(^XTMP("TIUHL7",$P(TIUMSG(TIUSEL),U,2),$P(TIUMSG(TIUSEL),U),TIUX,TIULINE)) Q:'+TIULINE  D
"RTN","TIUHL7A",32,0)
 . . S TIUTEXT=^XTMP("TIUHL7",$P(TIUMSG(TIUSEL),U,2),$P(TIUMSG(TIUSEL),U),TIUX,TIULINE)
"RTN","TIUHL7A",33,0)
 . . F TIUCNT=1:1:(($L(TIUTEXT)\TIUVAL)+1) S VALMCNT=VALMCNT+1 D SET^VALM10(VALMCNT,$E(TIUTEXT,(TIUVAL*(TIUCNT-1)+1),(TIUVAL*TIUCNT)))
"RTN","TIUHL7A",34,0)
 . S VALMCNT=VALMCNT+1 D SET^VALM10(VALMCNT,"")
"RTN","TIUHL7A",35,0)
 Q
"RTN","TIUHL7A",36,0)
HELP ; help code
"RTN","TIUHL7A",37,0)
 I X="?" S POP=1
"RTN","TIUHL7A",38,0)
 D FULL^VALM1
"RTN","TIUHL7A",39,0)
 W !!,"The following actions are available:"
"RTN","TIUHL7A",40,0)
 W !!,"Delete Message    - Delete the current message"
"RTN","TIUHL7A",41,0)
 W !,"Reprocess Message - Reprocess the current message",!
"RTN","TIUHL7A",42,0)
 I +$G(POP) I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUHL7A",43,0)
 S VALMBCK="R",POP=0
"RTN","TIUHL7A",44,0)
 Q
"RTN","TIUHL7A",45,0)
EXIT ; exit code
"RTN","TIUHL7A",46,0)
 Q
"RTN","TIUHL7A",47,0)
EXPND ; expand code
"RTN","TIUHL7A",48,0)
 Q
"RTN","TIUHL7P1")
0^1^B65222748^n/a
"RTN","TIUHL7P1",1,0)
TIUHL7P1 ; SLC/AJB - TIUHL7 Msg Processing; January 6, 2006
"RTN","TIUHL7P1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7P1",3,0)
 Q
"RTN","TIUHL7P1",4,0)
PROCMSG ;
"RTN","TIUHL7P1",5,0)
 N DFN,DUZ,TIU,TIUDA,TIUDPRM,TIUDT,TIUERR,TIUI,TIUJ,TIUMSG,TIUNAME,TIUTMP,TIUFS,TIUCS,TIURS,TIUES,TIUSS,TIUZ
"RTN","TIUHL7P1",6,0)
 ;
"RTN","TIUHL7P1",7,0)
 ; quit if HL7 Message IEN is not present
"RTN","TIUHL7P1",8,0)
 I '+$G(HLMTIENS) Q
"RTN","TIUHL7P1",9,0)
 ;
"RTN","TIUHL7P1",10,0)
 ; remove HL7 message entries 7 days or older
"RTN","TIUHL7P1",11,0)
 D CLEAN^TIUHL7U1
"RTN","TIUHL7P1",12,0)
 ;
"RTN","TIUHL7P1",13,0)
 ; sets field, component and repetition separators from HL7 Message
"RTN","TIUHL7P1",14,0)
 S TIUFS=$G(HL("FS")),TIUJ=0 F TIUI="TIUCS","TIURS","TIUES","TIUSS" S TIUJ=TIUJ+1 S @TIUI=$E(HL("ECH"),TIUJ,TIUJ)
"RTN","TIUHL7P1",15,0)
 ;
"RTN","TIUHL7P1",16,0)
 ; initializes variables and ^XTMP expiration
"RTN","TIUHL7P1",17,0)
 S TIU="TIU",(TIU("EC"),TIUDA)=0,TIUDT=+$$NOW^XLFDT,TIUNAME=$NA(^XTMP("TIUHL7",TIUDT,HLMTIENS)),^XTMP("TIUHL7",0)=$$FMADD^XLFDT(TIUDT,7)_U_TIUDT
"RTN","TIUHL7P1",18,0)
 ;
"RTN","TIUHL7P1",19,0)
 ; retrieves HL7 message and stores to temporary global
"RTN","TIUHL7P1",20,0)
 F TIUI=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","TIUHL7P1",21,0)
 . S @TIUNAME@("MSG",TIUI)=HLNODE,TIUJ=0
"RTN","TIUHL7P1",22,0)
 . F  S TIUJ=$O(HLNODE(TIUJ)) Q:'TIUJ  S @TIUNAME@("MSG",TIUI)=@TIUNAME@("MSG",TIUI)_HLNODE(TIUJ)
"RTN","TIUHL7P1",23,0)
 ;
"RTN","TIUHL7P1",24,0)
 ; places temporary global in local memory
"RTN","TIUHL7P1",25,0)
 S TIUI="" F  S TIUI=$O(@TIUNAME@("MSG",TIUI)) Q:'+TIUI  S TIUMSG(TIUI)=@TIUNAME@("MSG",TIUI)
"RTN","TIUHL7P1",26,0)
 S TIU("XTMP")=TIUNAME,TIUNAME="TIUMSG"
"RTN","TIUHL7P1",27,0)
 ;
"RTN","TIUHL7P1",28,0)
 ; verifies message format
"RTN","TIUHL7P1",29,0)
 S TIUI="" F  S TIUI=$O(@TIUNAME@(TIUI)) Q:'+TIUI  D
"RTN","TIUHL7P1",30,0)
 . S TIUI=0 F TIUJ="MSH","EVN","PID","PV1","TXA","OBX" S TIUI=TIUI+1 D
"RTN","TIUHL7P1",31,0)
 . . I $P(@TIUNAME@(TIUI),TIUFS)'=TIUJ D ERR^TIUHL7U1("MSG",1,"000.000","Improper message format: "_TIUJ_" segment.")
"RTN","TIUHL7P1",32,0)
 ;
"RTN","TIUHL7P1",33,0)
 ; parse message data
"RTN","TIUHL7P1",34,0)
 ; get patient name [required]
"RTN","TIUHL7P1",35,0)
 S TIU("PTNAME")=$$UPPER^HLFNC($$FMNAME^HLFNC($P($P($G(@TIUNAME@(3)),TIUFS,6),TIUCS,1,4),TIUCS)),TIU("PTNAME")=$$REMESC^TIUHL7U1(TIU("PTNAME"))
"RTN","TIUHL7P1",36,0)
 ;
"RTN","TIUHL7P1",37,0)
 ; get patient ICN/SSN/DFN - order may vary [conditionally required]
"RTN","TIUHL7P1",38,0)
 S (TIU("DFN"),TIU("ICN"),TIU("SSN"))="" F TIUI=1:1:$L($P($G(@TIUNAME@(3)),TIUFS,4),TIURS) S TIUJ=$P($P($G(@TIUNAME@(3)),TIUFS,4),TIURS,TIUI) I +TIUJ>0 D
"RTN","TIUHL7P1",39,0)
 . S TIUTMP=$S($P(TIUJ,TIUCS,5)="NI":"ICN",$P(TIUJ,TIUCS,5)="SS":"SSN",$P(TIUJ,TIUCS,5)="PI":"DFN",1:"UNK")
"RTN","TIUHL7P1",40,0)
 . S @TIU@(TIUTMP)=$$REMESC^TIUHL7U1($P(TIUJ,TIUCS)) I TIUTMP="ICN",@TIU@(TIUTMP)["V" S @TIU@(TIUTMP)=$P(@TIU@(TIUTMP),"V")
"RTN","TIUHL7P1",41,0)
 ;
"RTN","TIUHL7P1",42,0)
 ; get PATIENT DOB (optional)
"RTN","TIUHL7P1",43,0)
 S TIU("DOB")=$$HL7TFM^XLFDT($$REMESC^TIUHL7U1($P($G(@TIUNAME@(3)),TIUFS,8)))
"RTN","TIUHL7P1",44,0)
 ;
"RTN","TIUHL7P1",45,0)
 ; get DOCUMENT TITLE (#8925.1) [required] & set IEN
"RTN","TIUHL7P1",46,0)
 S TIU("TITLE")=$$UPPER^HLFNC($P($G(@TIUNAME@(5)),TIUFS,17)),TIU("TITLE")=$$REMESC^TIUHL7U1(TIU("TITLE"))
"RTN","TIUHL7P1",47,0)
 S TIU("TDA")=$$LU^TIUHL7U1(8925.1,TIU("TITLE"),"X","I $P(^TIU(8925.1,+Y,0),U,4)=""DOC""") I $L(TIU("TITLE"))'>0 S TIU("TITLE")="[UNKNOWN]"
"RTN","TIUHL7P1",48,0)
 ;
"RTN","TIUHL7P1",49,0)
 ; get DOCUMENT AVAILABILITY [optional]
"RTN","TIUHL7P1",50,0)
 S TIU("AVAIL")=$$REMESC^TIUHL7U1($P($G(@TIUNAME@(5)),TIUFS,20))
"RTN","TIUHL7P1",51,0)
 ;
"RTN","TIUHL7P1",52,0)
 ;gets DOCUMENT COMPLETION STATUS [optional]
"RTN","TIUHL7P1",53,0)
 S TIU("COMP")=$$REMESC^TIUHL7U1($P($G(@TIUNAME@(5)),TIUFS,18))
"RTN","TIUHL7P1",54,0)
 ;
"RTN","TIUHL7P1",55,0)
 ; get REFERENCE DATE [required]
"RTN","TIUHL7P1",56,0)
 S TIU("RFDT")=$$HL7TFM^XLFDT($$REMESC^TIUHL7U1($P($G(@TIUNAME@(5)),TIUFS,5))) I TIU("RFDT")'>-1 D ERR^TIUHL7U1("TXA",4,"0000.00","Invalid HL7 date format for ACTIVITY DATE/TIME[REFERENCE DATE/TIME].")
"RTN","TIUHL7P1",57,0)
 I +$P(TIU("RFDT"),"."),'+$P(TIU("RFDT"),".",2) S $P(TIU("RFDT"),".",2)=$P($$NOW^XLFDT,".",2)
"RTN","TIUHL7P1",58,0)
 ;
"RTN","TIUHL7P1",59,0)
 ; get EPISODE BEGIN DT/TIME [conditionally required for DISCHARGE SUMMARIES]
"RTN","TIUHL7P1",60,0)
 S TIU("EPDT")=$$HL7TFM^XLFDT($$REMESC^TIUHL7U1($P($G(@TIUNAME@(4)),TIUFS,45))) I TIU("EPDT")'>-1 D ERR^TIUHL7U1("PV1",44,"0000.00","Invalid HL7 date format for ADMIT DATE/TIME [EPISODE BEGIN DATE/TIME].")
"RTN","TIUHL7P1",61,0)
 I +$P(TIU("EPDT"),"."),'+$P(TIU("EPDT"),".",2) S $P(TIU("EPDT"),".",2)=$P($$NOW^XLFDT,".",2)
"RTN","TIUHL7P1",62,0)
 ;
"RTN","TIUHL7P1",63,0)
 ; get DICTATION DT/TIME [optional]
"RTN","TIUHL7P1",64,0)
 S TIU("DICDT")=$$HL7TFM^XLFDT($$REMESC^TIUHL7U1($P($G(@TIUNAME@(5)),TIUFS,7))) I TIU("DICDT")'>-1 D ERR^TIUHL7U1("TXA",6,"0000.00","Invalid HL7 date format for TRANSCRIPTION DATE/TIME[DICTATION DATE/TIME].")
"RTN","TIUHL7P1",65,0)
 I +$P(TIU("DICDT"),"."),'+$P(TIU("DICDT"),".",2) S $P(TIU("DICDT"),".",2)=$P($$NOW^XLFDT,".",2)
"RTN","TIUHL7P1",66,0)
 ;
"RTN","TIUHL7P1",67,0)
 ; get VISIT # [optional]
"RTN","TIUHL7P1",68,0)
 S TIU("VNUM")=$$REMESC^TIUHL7U1($P($G(@TIUNAME@(4)),TIUFS,20))
"RTN","TIUHL7P1",69,0)
 ;
"RTN","TIUHL7P1",70,0)
 ; get HOSPITAL LOCATION [conditionally required for NEW VISITS]
"RTN","TIUHL7P1",71,0)
 S TIU("HLOC")=$$REMESC^TIUHL7U1($P($P($G(@TIUNAME@(4)),TIUFS,4),TIUCS)) I +$L(TIU("HLOC")) S TIU("HLOC")=+$$LU^TIUHL7U1(44,TIU("HLOC"))
"RTN","TIUHL7P1",72,0)
 ;
"RTN","TIUHL7P1",73,0)
 ; get AUTHOR/DICTATOR SSN or IEN [optional] & NAME [required]
"RTN","TIUHL7P1",74,0)
 S TIUTMP=$S($P($P($G(@TIUNAME@(5)),TIUFS,10),TIUCS,9)'="USSSA":"AUDA",1:"AUSSN") S @TIU@(TIUTMP)=$P($P($G(@TIUNAME@(5)),TIUFS,10),TIUCS)
"RTN","TIUHL7P1",75,0)
 S TIU("AUNAME")=$$UPPER^HLFNC($$FMNAME^HLFNC($P($P($G(@TIUNAME@(5)),TIUFS,10),TIUCS,2,4),TIUCS)),TIU("AUNAME")=$$REMESC^TIUHL7U1(TIU("AUNAME"))
"RTN","TIUHL7P1",76,0)
 ;
"RTN","TIUHL7P1",77,0)
 ; get EXPECTED COSIGNER SSN or IEN [optional] & NAME [conditionally required]
"RTN","TIUHL7P1",78,0)
 S TIUTMP=$S($P($P($G(@TIUNAME@(5)),TIUFS,11),TIUCS,9)'="USSSA":"CSDA",1:"CSSSN") S @TIU@(TIUTMP)=$P($P($G(@TIUNAME@(5)),TIUFS,11),TIUCS)
"RTN","TIUHL7P1",79,0)
 S TIU("CSNAME")=$$UPPER^HLFNC($$FMNAME^HLFNC($P($P($G(@TIUNAME@(5)),TIUFS,11),TIUCS,2,4),TIUCS)),TIU("CSNAME")=$$REMESC^TIUHL7U1(TIU("CSNAME"))
"RTN","TIUHL7P1",80,0)
 ;
"RTN","TIUHL7P1",81,0)
 ; get ENTERED BY SSN or IEN [optional] & NAME [optional]
"RTN","TIUHL7P1",82,0)
 S TIUTMP=$S($P($P($G(@TIUNAME@(5)),TIUFS,12),TIUCS,9)'="USSSA":"EBDA",1:"EBSSN") S @TIU@(TIUTMP)=$P($P($G(@TIUNAME@(5)),TIUFS,12),TIUCS)
"RTN","TIUHL7P1",83,0)
 S TIU("EBNAME")=$$UPPER^HLFNC($$FMNAME^HLFNC($P($P($G(@TIUNAME@(5)),TIUFS,12),TIUCS,2,4),TIUCS)),TIU("EBNAME")=$$REMESC^TIUHL7U1(TIU("EBNAME"))
"RTN","TIUHL7P1",84,0)
 ;
"RTN","TIUHL7P1",85,0)
 ; get SURGICAL CASE or CONSULT # [conditionally required for SURGICAL REPORTS or CONSULT titles]
"RTN","TIUHL7P1",86,0)
 S TIUTMP=$S($$MEMBEROF^TIUHL7U1(TIU("TITLE"),"CONSULTS"):"CNCN",1:"SRCN") S @TIU@(TIUTMP)=$$REMESC^TIUHL7U1($P($P($G(@TIUNAME@(5)),TIUFS,13),TIUCS))
"RTN","TIUHL7P1",87,0)
 ;
"RTN","TIUHL7P1",88,0)
 ; gets SIGNATURE/COSIGNATURE DATE/TIME [optional]
"RTN","TIUHL7P1",89,0)
 S TIU("SIGNED")=$$REMESC^TIUHL7U1($P($P($G(@TIUNAME@(5)),TIUFS,23),TIUCS,15)),TIU("CSIGNED")=$$REMESC^TIUHL7U1($P($P($G(@TIUNAME@(5)),TIUFS,23),TIUCS,29))
"RTN","TIUHL7P1",90,0)
 ;
"RTN","TIUHL7P1",91,0)
 ; get DOCUMENT TEXT [required]
"RTN","TIUHL7P1",92,0)
 S TIUTMP="" F  S TIUTMP=$O(@TIUNAME@(TIUTMP)) Q:TIUTMP=""  D:$P($G(@TIUNAME@(TIUTMP)),TIUFS)="OBX"
"RTN","TIUHL7P1",93,0)
 . I $P(@TIUNAME@(TIUTMP),TIUFS,2)=1,$L($G(TIU("SUB")))'>0 S TIU("SUB")=$P($P(@TIUNAME@(TIUTMP),TIUFS,4),TIUCS,2),TIU("SUB")=$$REMESC^TIUHL7U1(TIU("SUB"))
"RTN","TIUHL7P1",94,0)
 . F TIUI=1:1:$L($P(@TIUNAME@(TIUTMP),TIUFS,6),TIURS) S TIUZ("TEXT",TIUI,0)=$P($P(@TIUNAME@(TIUTMP),TIUFS,6),TIURS,TIUI),TIUZ("TEXT",TIUI,0)=$$STRIP^TIUHL7U2($$REMESC^TIUHL7U1(TIUZ("TEXT",TIUI,0)))
"RTN","TIUHL7P1",95,0)
 ;
"RTN","TIUHL7P1",96,0)
 ; begin data verification
"RTN","TIUHL7P1",97,0)
 ; PATIENT IDENTIFICATION
"RTN","TIUHL7P1",98,0)
 D
"RTN","TIUHL7P1",99,0)
 . N TIUI,TIUJ,TIUERR,TIUN,TIUOUT,TIUTMP,TIUQUIT
"RTN","TIUHL7P1",100,0)
 . I '+$L($G(TIU("PTNAME"))) D ERR^TIUHL7U1("PID",5,"0000.00","Missing PATIENT NAME.")
"RTN","TIUHL7P1",101,0)
 . ; verify there is at least one piece of numeric PATIENT ID
"RTN","TIUHL7P1",102,0)
 . S TIUJ=0 F TIUI="ICN","DFN","SSN" S:+$G(TIU(TIUI)) TIUJ=TIUJ+1
"RTN","TIUHL7P1",103,0)
 . I '+TIUJ D ERR^TIUHL7U1("PID",5,"0000.00","Missing numeric PATIENT ID data; at least one numeric identifier [ICN,SSN,DFN] must be sent.") Q
"RTN","TIUHL7P1",104,0)
 . I +TIUJ=1 D
"RTN","TIUHL7P1",105,0)
 . . I '+$L($P(TIU("PTNAME"),",",2)) D ERR^TIUHL7U1("PID",5,"0000.00","FIRST NAME/INITIAL missing with only one numeric identifier sent.")
"RTN","TIUHL7P1",106,0)
 . . S TIUN("PT")=$$PNAME^TIUHL7U1(TIU("PTNAME")),TIUTMP=1
"RTN","TIUHL7P1",107,0)
 . E  S TIUN("PT")=$P(TIU("PTNAME"),",")
"RTN","TIUHL7P1",108,0)
 . S TIUJ=0
"RTN","TIUHL7P1",109,0)
 . ; check DFN if available
"RTN","TIUHL7P1",110,0)
 . I +$G(TIU("DFN")) S TIUJ=TIUJ+1,DFN(TIUJ)=TIU("DFN") D
"RTN","TIUHL7P1",111,0)
 . . I +$G(TIUTMP) S TIUN("DFN")=$$PNAME^TIUHL7U1($$GET1^DIQ(2,TIU("DFN"),.01))
"RTN","TIUHL7P1",112,0)
 . . E  S TIUN("DFN")=$P($$GET1^DIQ(2,TIU("DFN"),.01),",")
"RTN","TIUHL7P1",113,0)
 . . I '$$COMPARE^TIUHL7U1(TIUN("DFN"),TIUN("PT")) D ERR^TIUHL7U1("PID",5,"0000.00","PATIENT NAME discrepancy between HL7 message name ["_TIU("PTNAME")_"] & the HL7 message DFN #"_TIU("DFN")_" ["_$$GET1^DIQ(2,DFN(TIUJ),.01)_"].")
"RTN","TIUHL7P1",114,0)
 . ; check ICN if available
"RTN","TIUHL7P1",115,0)
 . I +$G(TIU("ICN")) S TIUJ=TIUJ+1,DFN(TIUJ)=+$$FIND1^DIC(2,"","X",TIU("ICN"),"AICN") D
"RTN","TIUHL7P1",116,0)
 . . I +$G(TIUTMP) S TIUN("ICN")=$$PNAME^TIUHL7U1($$GET1^DIQ(2,DFN(TIUJ),.01))
"RTN","TIUHL7P1",117,0)
 . . E  S TIUN("ICN")=$P($$GET1^DIQ(2,DFN(TIUJ),.01),",")
"RTN","TIUHL7P1",118,0)
 . . I '$$COMPARE^TIUHL7U1(TIUN("ICN"),TIUN("PT")) D ERR^TIUHL7U1("PID",5,"0000.00","PATIENT NAME discrepancy between HL7 message name ["_TIU("PTNAME")_"] & the HL7 message ICN #"_TIU("ICN")_" ["_$$GET1^DIQ(2,DFN(TIUJ),.01)_"].")
"RTN","TIUHL7P1",119,0)
 . ; check SSN if available
"RTN","TIUHL7P1",120,0)
 . I +$G(TIU("SSN")) S TIUJ=TIUJ+1,DFN(TIUJ)=+$$FIND1^DIC(2,"","X",TIU("SSN"),"SSN") D
"RTN","TIUHL7P1",121,0)
 . . I +$G(TIUTMP) S TIUN("SSN")=$$PNAME^TIUHL7U1($$GET1^DIQ(2,DFN(TIUJ),.01))
"RTN","TIUHL7P1",122,0)
 . . E  S TIUN("SSN")=$P($$GET1^DIQ(2,DFN(TIUJ),.01),",")
"RTN","TIUHL7P1",123,0)
 . . I '$$COMPARE^TIUHL7U1(TIUN("SSN"),TIUN("PT")) D ERR^TIUHL7U1("PID",5,"0000.00","PATIENT NAME discrepancy between HL7 message name ["_TIU("PTNAME")_"] & the HL7 message SSN #"_TIU("SSN")_" ["_$$GET1^DIQ(2,DFN(TIUJ),.01)_"].")
"RTN","TIUHL7P1",124,0)
 . ; compare DFN lookup values
"RTN","TIUHL7P1",125,0)
 . I TIUJ>1 S (TIUI,TIUJ)=0 F  S TIUI=$O(DFN(TIUI)) Q:'TIUI  I TIUI>1 S TIUJ=TIUI-1 I DFN(TIUI)'=DFN(TIUJ) D ERR^TIUHL7U1("PID",5,"0000.00","PATIENT IEN discrepancies between the numeric lookups.") Q
"RTN","TIUHL7P1",126,0)
 . I TIU("EC") Q
"RTN","TIUHL7P1",127,0)
 . S DFN=DFN(1)
"RTN","TIUHL7P1",128,0)
 ;
"RTN","TIUHL7P1",129,0)
 D CONTINUE^TIUHL7P2
"RTN","TIUHL7P1",130,0)
 Q
"RTN","TIUHL7P2")
0^2^B40187296^n/a
"RTN","TIUHL7P2",1,0)
TIUHL7P2 ; SLC/AJB - TIUHL7 Msg Processing; March 23, 2005
"RTN","TIUHL7P2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7P2",3,0)
 Q
"RTN","TIUHL7P2",4,0)
CONTINUE ; data verification
"RTN","TIUHL7P2",5,0)
 ;
"RTN","TIUHL7P2",6,0)
 ; DOCUMENT TEXT
"RTN","TIUHL7P2",7,0)
 D
"RTN","TIUHL7P2",8,0)
 . N TIUI S TIUTMP=0 F  S TIUTMP=$O(TIUZ("TEXT",TIUTMP)) Q:'TIUTMP  I +$L(TIUZ("TEXT",TIUTMP,0)) S TIUI=1
"RTN","TIUHL7P2",9,0)
 . I '+$G(TIUI) D ERR^TIUHL7U1("OBX",1,"0000.00","Missing DOCUMENT TEXT.")
"RTN","TIUHL7P2",10,0)
 ;
"RTN","TIUHL7P2",11,0)
 ; DOCUMENT TITLE
"RTN","TIUHL7P2",12,0)
 I +TIU("TDA")'>0 D ERR^TIUHL7U1("TXA",16,"0000.00","Could not resolve the document title "_TIU("TITLE")_".")
"RTN","TIUHL7P2",13,0)
 I +$$GET1^DIQ(8925.1,TIU("TDA"),.07,"I")'=11 D ERR^TIUHL7U1("TXA",16,"0000.00","The document title "_TIU("TITLE")_" must be ACTIVE before use.")
"RTN","TIUHL7P2",14,0)
 ;
"RTN","TIUHL7P2",15,0)
 ; AUTHOR/DICTATOR
"RTN","TIUHL7P2",16,0)
 D
"RTN","TIUHL7P2",17,0)
 . I '+$L(TIU("AUNAME")) D ERR^TIUHL7U1("TXA",9,"0000.00","Missing AUTHOR/DICTATOR name from HL7 message.") Q
"RTN","TIUHL7P2",18,0)
 . I '+$G(TIU("AUDA")),'+$G(TIU("AUSSN")) S TIU("AUDA")=$$LU^TIUHL7U1(200,TIU("AUNAME"),"X") I '+TIU("AUDA") D ERR^TIUHL7U1("TXA",9,"0000.00","AUTHOR/DICTATOR name lookup failed for ["_TIU("AUNAME")_"].") Q
"RTN","TIUHL7P2",19,0)
 . I '+$G(TIU("AUDA")),+$G(TIU("AUSSN")) S TIU("AUDA")=+$$FIND1^DIC(200,"","X",+$G(TIU("AUSSN")),"SSN") I '+TIU("AUDA") D ERR^TIUHL7U1("TXA",9,"0000.00","SSN ["_TIU("AUSSN")_"] lookup failed for AUTHOR/DICTATOR.") Q
"RTN","TIUHL7P2",20,0)
 . I '$$COMPARE^TIUHL7U1($$GET1^DIQ(200,TIU("AUDA"),.01),TIU("AUNAME")) D
"RTN","TIUHL7P2",21,0)
 . . D ERR^TIUHL7U1("TXA",9,"0000.00","AUTHOR/DICTATOR name discrepancy between HL7 message IEN/SSN ["_$$GET1^DIQ(200,TIU("AUDA"),.01)_"]"_" & the HL7 message name ["_TIU("AUNAME")_"].")
"RTN","TIUHL7P2",22,0)
 ;
"RTN","TIUHL7P2",23,0)
 ; EXPECTED CO-SIGNER [ignored if AUTHOR/DICTATOR does not require]
"RTN","TIUHL7P2",24,0)
 I $$REQCOSIG^TIULP($G(TIU("TDA")),,$G(TIU("AUDA")),$G(TIU("RFDT"))) D
"RTN","TIUHL7P2",25,0)
 . N TIUTMP
"RTN","TIUHL7P2",26,0)
 . S TIUZ(1506)=1
"RTN","TIUHL7P2",27,0)
 . I +$L($G(TIU("CSNAME")))!(+$G(TIU("CSDA")))!(+$G(TIU("CSSSN"))) D
"RTN","TIUHL7P2",28,0)
 . . I '+$L($G(TIU("CSNAME"))) D ERR^TIUHL7U1("TXA",10,"0000.00","Missing EXPECTED COSIGNER name from HL7 message.") Q
"RTN","TIUHL7P2",29,0)
 . . I '+$G(TIU("CSDA")),'+$G(TIU("CSSSN")) S TIU("CSDA")=$$LU^TIUHL7U1(200,TIU("CSNAME"),"X") I '+TIU("CSDA") D ERR^TIUHL7U1("TXA",10,"0000.000","EXPECTED COSIGNER name lookup failed for ["_TIU("CSNAME")_"].") Q
"RTN","TIUHL7P2",30,0)
 . . I '+$G(TIU("CSDA")),+$G(TIU("CSSSN")) S TIU("CSDA")=+$$FIND1^DIC(200,"","X",+$G(TIU("CSSSN")),"SSN") I '+TIU("CSDA") D ERR^TIUHL7U1("TXA",10,"0000.00","SSN ["_TIU("CSSSN")_"] lookup failed for EXPECTED COSIGNER.") Q
"RTN","TIUHL7P2",31,0)
 . . I '$$COMPARE^TIUHL7U1($$GET1^DIQ(200,TIU("CSDA"),.01),TIU("CSNAME")) D
"RTN","TIUHL7P2",32,0)
 . . . D ERR^TIUHL7U1("TXA",10,"0000.00","EXPECTED COSIGNER name discrepancy between HL7 message IEN/SSN ["_$$GET1^DIQ(200,TIU("CSDA"),.01)_"]"_" & HL7 message name ["_TIU("CSNAME")_"].")
"RTN","TIUHL7P2",33,0)
 . I '+$G(TIU("CSDA")) D ERR^TIUHL7U1("TXA",10,"0000.000","Unable to resolve EXPECTED COSIGNER; the AUTHOR/DICTATOR ["_TIU("AUNAME")_"] requires COSIGNATURE.")
"RTN","TIUHL7P2",34,0)
 ;
"RTN","TIUHL7P2",35,0)
 ; ENTERED BY [optional]
"RTN","TIUHL7P2",36,0)
 I +$L($G(TIU("EBNAME")))!(+$G(TIU("EBDA")))!(+$G(TIU("EBSSN"))) D
"RTN","TIUHL7P2",37,0)
 . I '+$L($G(TIU("EBNAME"))) D ERR^TIUHL7U1("TXA",11,"0000.00","Missing ENTERED BY name from HL7 message.") Q
"RTN","TIUHL7P2",38,0)
 . I '+$G(TIU("EBDA")),'+$G(TIU("EBSSN")) S TIU("EBDA")=$$LU^TIUHL7U1(200,TIU("EBNAME"),"X") I '+TIU("EBDA") D ERR^TIUHL7U1("TXA",11,"0000.000","ENTERED BY name lookup failed for ["_TIU("EBNAME")_"].") Q
"RTN","TIUHL7P2",39,0)
 . I '+$G(TIU("EBDA")),+$G(TIU("EBSSN")) S TIU("EBDA")=+$$FIND1^DIC(200,"","X",+$G(TIU("EBSSN")),"SSN") I '+TIU("EBDA") D ERR^TIUHL7U1("TXA",11,"0000.00","SSN ["_TIU("EBSSN")_"] lookup failed for ENTERED BY.") Q
"RTN","TIUHL7P2",40,0)
 . I '$$COMPARE^TIUHL7U1($$GET1^DIQ(200,TIU("EBDA"),.01),TIU("EBNAME")) D
"RTN","TIUHL7P2",41,0)
 . . D ERR^TIUHL7U1("TXA",11,"0000.00","ENTERED BY name discrepancy between HL7 message IEN/SSN ["_$$GET1^DIQ(200,TIU("EBDA"),.01)_"]"_" & HL7 message name ["_TIU("EBNAME")_"].")
"RTN","TIUHL7P2",42,0)
 ;
"RTN","TIUHL7P2",43,0)
 ; EPISODE BEGIN DATE/TIME for DISCHARGE SUMMARIES
"RTN","TIUHL7P2",44,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"DISCHARGE SUMMARIES") D
"RTN","TIUHL7P2",45,0)
 . I '+$G(TIU("CSDA")) D ERR^TIUHL7U1("TXA",10,"0000.000","DISCHARGE SUMMARIES require an ATTENDING PHYSICIAN (EXPECTED COSIGNER).")
"RTN","TIUHL7P2",46,0)
 . S TIUZ(1209)=$G(TIU("CSDA"))
"RTN","TIUHL7P2",47,0)
 . I +TIU("VNUM") D  Q
"RTN","TIUHL7P2",48,0)
 . . I '$$COMPARE^TIUHL7U1($$GET1^DIQ(9000010,TIU("VNUM"),.05),$S(+$G(DFN):$$GET1^DIQ(2,DFN,.01),1:TIU("PTNAME"))) D
"RTN","TIUHL7P2",49,0)
 . . . D ERR^TIUHL7U1("PV1",19,"0000.00","HL7 message PATIENT NAME ["_TIU("PTNAME")_"] does not match VISIT PATIENT NAME ["_$$GET1^DIQ(9000010,TIU("VNUM"),.05)_"].") Q
"RTN","TIUHL7P2",50,0)
 . . S TIU("EPDT")=$$GET1^DIQ(9000010,TIU("VNUM"),.01,"I"),TIU("VSTR")=$$VSTRBLD^TIUSRVP(TIU("VNUM"))
"RTN","TIUHL7P2",51,0)
 . I '+TIU("EPDT") D ERR^TIUHL7U1("PV1",44,"0000.000",TIU("TITLE")_" requires an EPISODE BEGIN DATE/TIME.") Q
"RTN","TIUHL7P2",52,0)
 . I '+$$GETADMIT^TIUHL7U1(+$G(DFN),TIU("EPDT")) D ERR^TIUHL7U1("PV1","44","0000.00","Could not resolve ADMISSION DT[TIME] for "_$$FMTE^XLFDT(TIUDT)_".")
"RTN","TIUHL7P2",53,0)
 ;
"RTN","TIUHL7P2",54,0)
 ; VISIT information for PROGRESS NOTES
"RTN","TIUHL7P2",55,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"PROGRESS NOTES") D
"RTN","TIUHL7P2",56,0)
 . I TIU("VNUM")="NEW" D  Q
"RTN","TIUHL7P2",57,0)
 . . N TYP
"RTN","TIUHL7P2",58,0)
 . . I '+TIU("HLOC"),TIU("AVAIL")'="AV" D ERR^TIUHL7U1("PV1",4,"0000.00","Missing/Invalid HOSPITAL LOCATION ('AV' not set); required for NEW visits.") Q
"RTN","TIUHL7P2",59,0)
 . . I +TIU("EPDT")'>0 S TIU("EPDT")=$$NOW^XLFDT
"RTN","TIUHL7P2",60,0)
 . . I $L(TIU("EPDT"),".")=1 S TIU("EPDT")=TIU("EPDT")_"."_$P($$NOW^XLFDT,".",2)
"RTN","TIUHL7P2",61,0)
 . . I +TIU("HLOC") I $$GET1^DIQ(44,TIU("HLOC"),2,"I")="W" S TYP="I"
"RTN","TIUHL7P2",62,0)
 . . S TIU("VSTR")=TIU("HLOC")_";"_TIU("EPDT")_";"_$S(+$D(TYP):"I",TIU("AVAIL")="AV":"E",1:"A")
"RTN","TIUHL7P2",63,0)
 . I +TIU("VNUM") D  Q
"RTN","TIUHL7P2",64,0)
 . . I '$$COMPARE^TIUHL7U1($$GET1^DIQ(9000010,TIU("VNUM"),.05),$S(+$G(DFN):$$GET1^DIQ(2,DFN,.01),1:TIU("PTNAME"))) D  Q
"RTN","TIUHL7P2",65,0)
 . . . D ERR^TIUHL7U1("PV1",19,"0000.00","HL7 message PATIENT NAME ["_TIU("PTNAME")_"] does not match VISIT PATIENT NAME ["_$$GET1^DIQ(9000010,TIU("VNUM"),.05)_"].")
"RTN","TIUHL7P2",66,0)
 . . S TIU("EPDT")=$$GET1^DIQ(9000010,TIU("VNUM"),.01,"I"),TIU("VSTR")=$$VSTRBLD^TIUSRVP(TIU("VNUM"))
"RTN","TIUHL7P2",67,0)
 . I '+TIU("VNUM") D
"RTN","TIUHL7P2",68,0)
 . . I +TIU("EPDT") I '+$$GETADMIT^TIUHL7U1(+$G(DFN),TIU("EPDT")),TIU("AVAIL")'="AV" D ERR^TIUHL7U1("PV1","44","0000.00","Could not find a visit for "_$$FMTE^XLFDT(TIU("EPDT"))_".") Q
"RTN","TIUHL7P2",69,0)
 . . I '+$$GETVISIT^TIUHL7U1(+$G(DFN),TIU("RFDT")),TIU("AVAIL")'="AV" D ERR^TIUHL7U1("PV1","44","0000.00","Could not find a visit for "_$$FMTE^XLFDT(TIU("RFDT"))_".") Q
"RTN","TIUHL7P2",70,0)
 . . S TIU("VSTR")=TIU("HLOC")_";"_$$NOW^XLFDT_";E"
"RTN","TIUHL7P2",71,0)
 ;
"RTN","TIUHL7P2",72,0)
 D CONTINUE^TIUHL7P3
"RTN","TIUHL7P2",73,0)
 Q
"RTN","TIUHL7P3")
0^8^B44685560^n/a
"RTN","TIUHL7P3",1,0)
TIUHL7P3 ; SLC/AJB - TIUHL7 Msg Processing; March 23, 2005
"RTN","TIUHL7P3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7P3",3,0)
 Q
"RTN","TIUHL7P3",4,0)
CONTINUE ;
"RTN","TIUHL7P3",5,0)
 ;
"RTN","TIUHL7P3",6,0)
 ; DOCUMENT TITLE & VISIT LIMITATION
"RTN","TIUHL7P3",7,0)
 I '+$$MEMBEROF^TIUHL7U1(TIU("TITLE"),"OPERATION REPORTS")!'+($$MEMBEROF^TIUHL7U1(TIU("TITLE"),"PROCEDURE REPORT (NON-O.R.)")) D TIUVISIT^TIUSRVA(.TIUTMP,TIU("TDA"),$G(DFN),$G(TIU("VSTR"))) I +TIUTMP D
"RTN","TIUHL7P3",8,0)
 . S TIUDA=+$$EXIST^TIUEDI3(+$G(DFN),+TIU("TDA"),$G(TIU("VSTR")),0,+TIU("AUDA")) I '+TIUDA D ERR^TIUHL7U1("TXA",16,"0000.00",TIU("TITLE")_" already exists for this visit; only one record of this type is allowed per visit.")
"RTN","TIUHL7P3",9,0)
 ;
"RTN","TIUHL7P3",10,0)
 ; get document parameters
"RTN","TIUHL7P3",11,0)
 D DOCPRM^TIUHL7U2(TIU("TDA"),.TIUDPRM)
"RTN","TIUHL7P3",12,0)
 ;
"RTN","TIUHL7P3",13,0)
 ; verify upload support for SURGICAL REPORT titles
"RTN","TIUHL7P3",14,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"SURGICAL REPORTS") D
"RTN","TIUHL7P3",15,0)
 . I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"OPERATION REPORTS")!($$MEMBEROF^TIUHL7U1(TIU("TITLE"),"PROCEDURE REPORT (NON-O.R.)")) Q
"RTN","TIUHL7P3",16,0)
 . D ERR^TIUHL7U1("TXA",16,"0000.00","This SURGICAL REPORT ["_TIU("TITLE")_"] title is not a supported upload title.")
"RTN","TIUHL7P3",17,0)
 ;
"RTN","TIUHL7P3",18,0)
 ; send APPLICATION REJECT if any data element verification failed
"RTN","TIUHL7P3",19,0)
 I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",20,0)
 ;
"RTN","TIUHL7P3",21,0)
 ; validate and process OPERATION REPORTS or PROCEDURE REPORTS
"RTN","TIUHL7P3",22,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"OPERATION REPORTS")!($$MEMBEROF^TIUHL7U1(TIU("TITLE"),"PROCEDURE REPORT (NON-O.R.)")) D  Q
"RTN","TIUHL7P3",23,0)
 . N SUCCESS,TIUD0,TIUDA,TIUDAD,TIUSR0,TIUSRCN,TIUOPDT,TIUSTAT
"RTN","TIUHL7P3",24,0)
 . S TIUSRCN=+$G(TIU("SRCN")),TIUOPDT=+$P($G(TIU("EPDT")),"."),TIUDA=""
"RTN","TIUHL7P3",25,0)
 . I '+TIUSRCN,'+TIUOPDT D ERR^TIUHL7U1("TXA",12,"0000.000","HL7 message missing SURGICAL CASE # and OPERATION DATE.")
"RTN","TIUHL7P3",26,0)
 . I '+TIUSRCN,+TIUOPDT S TIUSRCN=$$FINDCASE^TIUPUTS($G(DFN),TIUOPDT) I '+TIUSRCN D ERR^TIUHL7U1("TXA",12,"0000.000","Unable to find a SURGICAL CASE # using the EPISODE BEGIN DATE ["_$$FMTE^XLFDT(TIUOPDT)_"].")
"RTN","TIUHL7P3",27,0)
 . I +TIUSRCN,$D(^SRF(TIUSRCN,"TIU")) S TIUDA=$$GETSDA^TIUPUTS(TIUSRCN) I '+TIUDA D ERR^TIUHL7U1("TXA",12,"0000.000","Unable to find "_TIU("TITLE")_" document stub for SURGICAL CASE #"_TIUSRCN_".")
"RTN","TIUHL7P3",28,0)
 . I +TIUSRCN'>0 D ERR^TIUHL7U1("TXA",12,"0000.000","SURGICAL CASE # cannot be determined.")
"RTN","TIUHL7P3",29,0)
 . I +TIUDA'>0 D ERR^TIUHL7U1("TXA",12,"0000.000","Unable to find "_TIU("TITLE")_" document stub for SURGICAL CASE #"_TIUSRCN_".")
"RTN","TIUHL7P3",30,0)
 . I '+TIU("EC") D
"RTN","TIUHL7P3",31,0)
 . . S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUSR0=$G(^SRF(TIUSRCN,0))
"RTN","TIUHL7P3",32,0)
 . . I '+TIUOPDT S TIU("EPDT")=$P($P(TIUSR0,U,9),"."),TIUOPDT=TIU("EPDT")
"RTN","TIUHL7P3",33,0)
 . . I +TIUSR0'=$G(DFN) D ERR^TIUHL7U1("TXA",12,"0000.000","PATIENT mismatch between HL7 message ["_$$GET1^DIQ(2,$G(DFN),.01)_"] and SURGICAL CASE #"_TIUSRCN_" ["_$$GET1^DIQ(2,+TIUSR0,.01)_"].")
"RTN","TIUHL7P3",34,0)
 . . I +$P(TIUD0,U,2)'=$G(DFN) D ERR^TIUHL7U1("TXA",12,"0000.000","PATIENT mismatch between HL7 message ["_$$GET1^DIQ(2,$G(DFN),.01)_"] and "_TIU("TITLE")_" stub ["_$$GET1^DIQ(2,+$P(TIUD0,U,2),.01)_"].")
"RTN","TIUHL7P3",35,0)
 . . I TIUOPDT'=$P($P(TIUSR0,U,9),".") D ERR^TIUHL7U1("TXA",12,"0000.000","OPERATION DATE mismatch between HL7 message ["_$$FMTE^XLFDT(TIUOPDT)_"] and SURGICAL CASE #"_TIUSRCN_" ["_$$FMTE^XLFDT($P($P(TIUSR0,U,9),"."))_"].") Q
"RTN","TIUHL7P3",36,0)
 . . I +TIU("EC") Q
"RTN","TIUHL7P3",37,0)
 . . I +$G(TIUDA),'$$CANEDIT^TIUHL7U1(TIUDA),'+TIU("EC") G MAKEADD
"RTN","TIUHL7P3",38,0)
 . . S TIUZ("HDR")="1^1" D SETTEXT^TIUSRVPT(.SUCCESS,+TIUDA,.TIUZ)
"RTN","TIUHL7P3",39,0)
 . . I '+$G(SUCCESS) D ERR^TIUHL7U1("OBX",1,"0000.00","DOCUMENT TEXT failed to update.")
"RTN","TIUHL7P3",40,0)
 . I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",41,0)
 . D FOLLOWUP^TIUPUTS(+TIUDA)
"RTN","TIUHL7P3",42,0)
 . S $P(^TIU(8925,+TIUDA,13),U,2)=$S(+$G(TIU("EBDA")):TIU("EBDA"),1:TIU("AUDA"))
"RTN","TIUHL7P3",43,0)
 . D SIGNDOC^TIUHL7U1(+TIUDA) I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",44,0)
 . D ACK^TIUHL7U1("AA",TIUNAME,+TIUDA)
"RTN","TIUHL7P3",45,0)
 ;
"RTN","TIUHL7P3",46,0)
MAKEADD ;
"RTN","TIUHL7P3",47,0)
 ; validate CONSULT title
"RTN","TIUHL7P3",48,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"CONSULTS") D
"RTN","TIUHL7P3",49,0)
 . I '+$G(TIU("CNCN")) D ERR^TIUHL7U1("TXA",12,"0000.00","HL7 message missing CONSULT #.") Q
"RTN","TIUHL7P3",50,0)
 . I '$$CPPAT^GMRCCP(TIU("CNCN"),$G(DFN)) D ERR^TIUHL7U1("TXA",12,"0000.00","PATIENT NAME ["_TIU("PTNAME")_"] mismatch between HL7 message and CONSULT ["_$$GET1^DIQ(123,TIU("CNCN"),.02)_"].") Q
"RTN","TIUHL7P3",51,0)
 . S TIUZ(1405)=TIU("CNCN")_";GMR(123,"
"RTN","TIUHL7P3",52,0)
 ;
"RTN","TIUHL7P3",53,0)
 I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",54,0)
 ;
"RTN","TIUHL7P3",55,0)
 ; set data fields
"RTN","TIUHL7P3",56,0)
 ; set appropriate DOCUMENT STATUS from document parameters
"RTN","TIUHL7P3",57,0)
 S DUZ=$G(TIU("AUDA")),DUZ(2)=$$GETDIV^TIUHL7U1(DUZ),TIU("DIVISION")=DUZ(2)
"RTN","TIUHL7P3",58,0)
 I $P(TIUDPRM(0),U,2)=1 S TIUZ(.05)=3
"RTN","TIUHL7P3",59,0)
 I '+$G(TIUZ(.05)),$P(TIUDPRM(0),U,3)>0,$P(TIUDPRM(0),U,3)'>2 S TIUZ(.05)=4
"RTN","TIUHL7P3",60,0)
 I '+$G(TIUZ(.05)) S TIUZ(.05)=5
"RTN","TIUHL7P3",61,0)
 ;
"RTN","TIUHL7P3",62,0)
 S TIUZ(.07)=$S(+$G(TIU("EPDT")):TIU("EPDT"),+$G(TIU("RFDT")):TIU("RFDT"),1:$$NOW^XLFDT)
"RTN","TIUHL7P3",63,0)
 S TIUZ(1201)=$$NOW^XLFDT
"RTN","TIUHL7P3",64,0)
 S TIUZ(1202)=$G(TIU("AUDA"))
"RTN","TIUHL7P3",65,0)
 S TIUZ(1204)=$G(TIU("AUDA"))
"RTN","TIUHL7P3",66,0)
 S TIUZ(1208)=$G(TIU("CSDA"))
"RTN","TIUHL7P3",67,0)
 S TIUZ(1212)=$G(TIU("DIVISION"))
"RTN","TIUHL7P3",68,0)
 S TIUZ(1301)=$G(TIU("RFDT"))
"RTN","TIUHL7P3",69,0)
 S TIUZ(1302)=$S(+$G(TIU("EBDA")):TIU("EBDA"),1:TIU("AUDA")),TIU("EBDA")=TIUZ(1302)
"RTN","TIUHL7P3",70,0)
 S TIUZ(1307)=$G(TIU("DICDT"))
"RTN","TIUHL7P3",71,0)
 S TIUZ(1701)=$G(TIU("SUB"))
"RTN","TIUHL7P3",72,0)
 ;
"RTN","TIUHL7P3",73,0)
 ; check if document was found and editable
"RTN","TIUHL7P3",74,0)
 ; if not editable, make addendum
"RTN","TIUHL7P3",75,0)
 I +$G(TIUDA),'$$CANEDIT^TIUHL7U1(TIUDA),'+TIU("EC") D  Q
"RTN","TIUHL7P3",76,0)
 . N PERSON,SUCCESS
"RTN","TIUHL7P3",77,0)
 . S PERSON=$G(TIU("AUDA"))
"RTN","TIUHL7P3",78,0)
 . D MAKEADD^TIUHL7U2(.SUCCESS,TIUDA,.TIUZ,1)
"RTN","TIUHL7P3",79,0)
 . I '+SUCCESS D ERR^TIUHL7U1("TIU",1,"0000.000",$P(SUCCESS,U,2))
"RTN","TIUHL7P3",80,0)
 . I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",81,0)
 . S $P(^TIU(8925,+SUCCESS,13),U,3)="U",$P(^TIU(8925,+SUCCESS,13),U,2)=$S(+$G(TIU("EBDA")):TIU("EBDA"),1:TIU("AUDA"))
"RTN","TIUHL7P3",82,0)
 . D SIGNDOC^TIUHL7U1(+SUCCESS) I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,+SUCCESS) Q
"RTN","TIUHL7P3",83,0)
 . D ACK^TIUHL7U1("AA",TIUNAME,SUCCESS),SEND^TIUALRT(SUCCESS),SENDADD^TIUALRT(+TIUDA)
"RTN","TIUHL7P3",84,0)
 ;
"RTN","TIUHL7P3",85,0)
 ; if editable, make changes to document
"RTN","TIUHL7P3",86,0)
 I +$G(TIUDA),$$CANEDIT^TIUHL7U1(TIUDA),'+TIU("EC") D  Q
"RTN","TIUHL7P3",87,0)
 . N SUCCESS
"RTN","TIUHL7P3",88,0)
 . D DELTEXT^TIUPUTPN(TIUDA)
"RTN","TIUHL7P3",89,0)
 . S TIUZ("HDR")="1^1" D SETTEXT^TIUSRVPT(.SUCCESS,+TIUDA,.TIUZ) K TIUZ("HDR"),TIUZ("TEXT")
"RTN","TIUHL7P3",90,0)
 . I '+SUCCESS D ERR^TIUHL7U1("TIU",1,"0000.000",$P(SUCCESS,U,2))
"RTN","TIUHL7P3",91,0)
 . D FILE^TIUSRVP(.SUCCESS,+TIUDA,.TIUZ)
"RTN","TIUHL7P3",92,0)
 . I '+SUCCESS D ERR^TIUHL7U1("TIU",1,"0000.000",$P(SUCCESS,U,2))
"RTN","TIUHL7P3",93,0)
 . I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",94,0)
 . S $P(^TIU(8925,+SUCCESS,13),U,3)="U",$P(^TIU(8925,+SUCCESS,13),U,2)=$S(+$G(TIU("EBDA")):TIU("EBDA"),1:TIU("AUDA"))
"RTN","TIUHL7P3",95,0)
 . D SIGNDOC^TIUHL7U1(+SUCCESS) I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,+SUCCESS) Q
"RTN","TIUHL7P3",96,0)
 . D ACK^TIUHL7U1("AA",TIUNAME,TIUDA),SEND^TIUALRT(TIUDA) Q
"RTN","TIUHL7P3",97,0)
 ;
"RTN","TIUHL7P3",98,0)
 I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",99,0)
 ;
"RTN","TIUHL7P3",100,0)
 ; document creation
"RTN","TIUHL7P3",101,0)
 N SDCNT,TIUDIV1,TIUFPRIV,TIUPRM0,TIUPRM1
"RTN","TIUHL7P3",102,0)
 D MAKE^TIUSRVP(.TIUDA,DFN,TIU("TDA"),,,,.TIUZ,TIU("VSTR"))
"RTN","TIUHL7P3",103,0)
 ;
"RTN","TIUHL7P3",104,0)
 ; verify creation & and set capture method to UPLOAD & ENTERED BY (if applicable)
"RTN","TIUHL7P3",105,0)
 I '+TIUDA D ERR^TIUHL7U1("TIU",1,"0000.00",$P(TIUDA,U,2)),ACK^TIUHL7U1("AR",TIUNAME,-1) Q
"RTN","TIUHL7P3",106,0)
 S $P(^TIU(8925,+TIUDA,13),U,3)="U",$P(^TIU(8925,+TIUDA,13),U,2)=$S(+$G(TIU("EBDA")):TIU("EBDA"),1:TIU("AUDA"))
"RTN","TIUHL7P3",107,0)
 S $P(^TIU(8925,+TIUDA,0),U,7)=$S(+$G(TIU("EPDT")):TIU("EPDT"),+$G(TIU("RFDT")):TIU("RFDT"),1:$$NOW^XLFDT)
"RTN","TIUHL7P3",108,0)
 ;
"RTN","TIUHL7P3",109,0)
 ; process signature/co-signature
"RTN","TIUHL7P3",110,0)
 D SIGNDOC^TIUHL7U1(+TIUDA) I +TIU("EC") D ACK^TIUHL7U1("AR",TIUNAME,+TIUDA) Q
"RTN","TIUHL7P3",111,0)
 ;
"RTN","TIUHL7P3",112,0)
 ; update the consult as necessary
"RTN","TIUHL7P3",113,0)
 I $$MEMBEROF^TIUHL7U1(TIU("TITLE"),"CONSULTS") D
"RTN","TIUHL7P3",114,0)
 . N TIUSTAT S TIUSTAT=$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIUHL7P3",115,0)
 . S TIUSTAT=$S(TIUSTAT>6:"COMPLETED",1:"INCOMPLETE")
"RTN","TIUHL7P3",116,0)
 . D GET^GMRCTIU(TIU("CNCN"),+TIUDA,TIUSTAT,TIU("AUDA"))
"RTN","TIUHL7P3",117,0)
 ;
"RTN","TIUHL7P3",118,0)
 D ACK^TIUHL7U1("AA",TIUNAME,+TIUDA)
"RTN","TIUHL7P3",119,0)
 D SEND^TIUALRT(+TIUDA)
"RTN","TIUHL7P3",120,0)
 D AUDIT^TIUHL7U1(+TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUHL7P3",121,0)
 ;
"RTN","TIUHL7P3",122,0)
 Q
"RTN","TIUHL7U1")
0^3^B49682985^n/a
"RTN","TIUHL7U1",1,0)
TIUHL7U1 ; SLC/AJB - TIUHL7 Utilities; March 23, 2005
"RTN","TIUHL7U1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7U1",3,0)
 Q
"RTN","TIUHL7U1",4,0)
ACK(CODE,ERLOC,TIUDA) ;
"RTN","TIUHL7U1",5,0)
 N HLA,RESULT
"RTN","TIUHL7U1",6,0)
 S HLA("HLA",1)="MSA"_HL("FS")_CODE_HL("FS")_HL("MID")_HL("FS")_$G(HL("RAN"))_HL("FS")_$G(HL("SAN"))
"RTN","TIUHL7U1",7,0)
 I CODE="AR" D
"RTN","TIUHL7U1",8,0)
 . N TIUCNT
"RTN","TIUHL7U1",9,0)
 . S TIUCNT=0 F  S TIUCNT=$O(@ERLOC@("MSGERR",TIUCNT)) Q:'+TIUCNT  S HLA("HLA",(TIUCNT+1))=@ERLOC@("MSGERR",TIUCNT)
"RTN","TIUHL7U1",10,0)
 . D SNDALRT
"RTN","TIUHL7U1",11,0)
 I CODE="AA" D
"RTN","TIUHL7U1",12,0)
 . S HLA("HLA",2)=+$G(TIUDA)_TIUCS_"Document creation successful."
"RTN","TIUHL7U1",13,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.RESULT)
"RTN","TIUHL7U1",14,0)
 M @TIU("XTMP")@("MSGRESULT")=HLA("HLA")
"RTN","TIUHL7U1",15,0)
 Q
"RTN","TIUHL7U1",16,0)
AUDIT(TIUDA,TIUCKSM0,TIUCKSM1) ; Update audit trail
"RTN","TIUHL7U1",17,0)
 N DIC,DIE,DA,DR,X,Y
"RTN","TIUHL7U1",18,0)
 S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.5,DIC(0)="FLX" D ^DIC Q:+Y'>0
"RTN","TIUHL7U1",19,0)
 S DIE=DIC,DR=".02////"_$$NOW^TIULC_";.03////"_TIU("EBDA")_";.04////"_TIUCKSM0_";.05////"_TIUCKSM1
"RTN","TIUHL7U1",20,0)
 S DA=+Y D ^DIE
"RTN","TIUHL7U1",21,0)
 Q
"RTN","TIUHL7U1",22,0)
CANEDIT(DA) ; check whether or not document is released
"RTN","TIUHL7U1",23,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUHL7U1",24,0)
CLASS(CLNAME) ;
"RTN","TIUHL7U1",25,0)
 N TIUY S TIUY=+$O(^TIU(8925.1,"B",CLNAME,0))
"RTN","TIUHL7U1",26,0)
 I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S TIUY=0
"RTN","TIUHL7U1",27,0)
 Q TIUY
"RTN","TIUHL7U1",28,0)
CLEAN ; removes messages older than 7 days
"RTN","TIUHL7U1",29,0)
 N TIUDT
"RTN","TIUHL7U1",30,0)
 S TIUDT=0
"RTN","TIUHL7U1",31,0)
 F  S TIUDT=$O(^XTMP("TIUHL7",TIUDT)) Q:'+TIUDT  D
"RTN","TIUHL7U1",32,0)
 . I $$FMDIFF^XLFDT($$NOW^XLFDT,TIUDT)'<7 K ^XTMP("TIUHL7",TIUDT)
"RTN","TIUHL7U1",33,0)
 Q
"RTN","TIUHL7U1",34,0)
COMPARE(NAME1,NAME2) ; compare first and last names only
"RTN","TIUHL7U1",35,0)
 N NAME,TIUX,TIUY
"RTN","TIUHL7U1",36,0)
 S TIUY=0
"RTN","TIUHL7U1",37,0)
 I $L(NAME1,",")=1,$L(NAME2,",")=1 S:NAME1=NAME2 TIUY=1 Q TIUY
"RTN","TIUHL7U1",38,0)
 S NAME("L1")=$P(NAME1,","),NAME("F1")=$P(NAME1,",",2),NAME("F1")=$P(NAME("F1")," ")
"RTN","TIUHL7U1",39,0)
 S NAME("L2")=$P(NAME2,","),NAME("F2")=$P(NAME2,",",2),NAME("F2")=$P(NAME("F2")," ")
"RTN","TIUHL7U1",40,0)
 I NAME("L1")=NAME("L2"),NAME("F1")=NAME("F2") S TIUY=1
"RTN","TIUHL7U1",41,0)
 Q TIUY
"RTN","TIUHL7U1",42,0)
DELDOC(TIUDA) ;
"RTN","TIUHL7U1",43,0)
 N ERR
"RTN","TIUHL7U1",44,0)
 D DELETE^TIUSRVP(.ERR,TIUDA,"",1)
"RTN","TIUHL7U1",45,0)
 Q
"RTN","TIUHL7U1",46,0)
ERR(TIUSEG,TIUP,TIUNUM,TIUTXT) ;
"RTN","TIUHL7U1",47,0)
 S TIU("EC")=TIU("EC")+1
"RTN","TIUHL7U1",48,0)
 S @TIUNAME@("MSGERR",TIU("EC"))="ERR"_TIUFS_TIUSEG_TIUFS_TIUP_TIUFS_TIUFS_TIUNUM_TIUCS_TIUTXT
"RTN","TIUHL7U1",49,0)
 Q
"RTN","TIUHL7U1",50,0)
GETADMIT(DFN,TIUDT) ;
"RTN","TIUHL7U1",51,0)
 N TIUCNT,TIULIST,TIUY S (TIUCNT,TIUY)=0
"RTN","TIUHL7U1",52,0)
 I '+$G(TIUDT) Q TIUY
"RTN","TIUHL7U1",53,0)
 D:+$G(DFN) ADMITLST^ORWPT(.TIULIST,DFN)
"RTN","TIUHL7U1",54,0)
 I $D(TIULIST) D
"RTN","TIUHL7U1",55,0)
 . S TIULIST="" F  S TIULIST=$O(TIULIST(TIULIST)) Q:'+TIULIST  I $P($P(TIULIST(TIULIST),U),".")=$P(TIUDT,".") S TIUCNT=TIUCNT+1,TIUCNT(TIULIST)=TIULIST(TIULIST)
"RTN","TIUHL7U1",56,0)
 . I TIUCNT=0 D ERR("ERR","44","0000.00","ADMISSION not found for "_$$FMTE^XLFDT(TIUDT)_".") Q
"RTN","TIUHL7U1",57,0)
 . I TIUCNT=1 S TIULIST="",TIULIST=$O(TIUCNT(TIULIST)),TIU("VSTR")=$P(TIULIST(TIULIST),U,2)_";"_$P(TIULIST(TIULIST),U)_";H",TIUY=1 Q
"RTN","TIUHL7U1",58,0)
 . I +TIU("HLOC") D
"RTN","TIUHL7U1",59,0)
 . . S TIULIST="" F  S TIULIST=$O(TIUCNT(TIULIST)) Q:'+TIULIST!(+TIUY)  I $P(TIUCNT(TIULIST),U,2)=TIU("HLOC") S TIU("VSTR")=TIU("HLOC")_";"_$P(TIUCNT(TIULIST),U)_";H",TIUY=1
"RTN","TIUHL7U1",60,0)
 Q TIUY
"RTN","TIUHL7U1",61,0)
GETDIV(USER) ;
"RTN","TIUHL7U1",62,0)
 N TIUY
"RTN","TIUHL7U1",63,0)
 D DIV4^XUSER(.TIUY,USER) I +$D(TIUY) S TIUY="",TIUY=$O(TIUY(TIUY))
"RTN","TIUHL7U1",64,0)
 I +$G(TIUY)'>0 S TIUY=$$GET1^DIQ(8989.3,1,217,"I")
"RTN","TIUHL7U1",65,0)
 Q TIUY
"RTN","TIUHL7U1",66,0)
GETVISIT(DFN,TIUDT) ; 
"RTN","TIUHL7U1",67,0)
 N TIUCNT,TIULIST,TIUY
"RTN","TIUHL7U1",68,0)
 S (TIUCNT,TIUY)=0
"RTN","TIUHL7U1",69,0)
 I '+$G(TIUDT) Q TIUY
"RTN","TIUHL7U1",70,0)
 D:+$G(DFN) VST1^ORWCV(.TIULIST,DFN,$P(TIUDT,"."),$$FMADD^XLFDT(TIUDT,1),1)
"RTN","TIUHL7U1",71,0)
 I $D(TIULIST) D
"RTN","TIUHL7U1",72,0)
 . S TIULIST="" F  S TIULIST=$O(TIULIST(TIULIST)) Q:'+TIULIST  I $P($P(TIULIST(TIULIST),U,2),".")=$P(TIUDT,".") S TIUCNT=TIUCNT+1,TIUCNT(TIULIST)=TIULIST(TIULIST)
"RTN","TIUHL7U1",73,0)
 . I TIUCNT=1 S TIULIST="",TIULIST=$O(TIUCNT(TIULIST)),TIU("VSTR")=$P($P(TIULIST(TIULIST),U),";",3)_";"_$P(TIULIST(TIULIST),U,2)_";"_$S(TIU("AVAIL")="AV":"E",1:"A"),TIUY=1 Q
"RTN","TIUHL7U1",74,0)
 . I +TIU("HLOC") D
"RTN","TIUHL7U1",75,0)
 . . S TIULIST="" F  S TIULIST=$O(TIUCNT(TIULIST)) Q:'+TIULIST!(+TIUY)  I $P($P(TIULIST(TIULIST),U),";",3)=TIU("HLOC") S TIU("VSTR")=TIU("HLOC")_";"_$P(TIULIST(TIULIST),U,2)_";"_$S(TIU("AVAIL")="AV":"E",1:"A"),TIUY=1
"RTN","TIUHL7U1",76,0)
 Q TIUY
"RTN","TIUHL7U1",77,0)
LU(FILE,NAME,FLAGS,SCREEN,INDEXES) ;
"RTN","TIUHL7U1",78,0)
 Q $$FIND1^DIC(FILE,"",$G(FLAGS),NAME,$G(INDEXES),$G(SCREEN),"TIUERR")
"RTN","TIUHL7U1",79,0)
MEMBEROF(TITLE,CLASS) ;
"RTN","TIUHL7U1",80,0)
 N TIUY S TIUY=0
"RTN","TIUHL7U1",81,0)
 S CLASS=+$$CLASS(CLASS) Q:+CLASS'>0 TIUY
"RTN","TIUHL7U1",82,0)
 S TITLE=$$LU(8925.1,TITLE,"X","I $P(^(0),U,4)=""DOC""") Q:+TITLE'>0 TIUY
"RTN","TIUHL7U1",83,0)
 S TIUY=+$$ISA^TIULX(TITLE,CLASS)
"RTN","TIUHL7U1",84,0)
 Q TIUY
"RTN","TIUHL7U1",85,0)
PNAME(NAME) ;
"RTN","TIUHL7U1",86,0)
 N LAST,FIRST
"RTN","TIUHL7U1",87,0)
 S LAST=$P(NAME,","),FIRST=$E($P(NAME,",",2),1)
"RTN","TIUHL7U1",88,0)
 Q LAST_","_FIRST
"RTN","TIUHL7U1",89,0)
REMESC(TIUSTR) ;
"RTN","TIUHL7U1",90,0)
 ; Remove Escape Characters from HL7 Message Text
"RTN","TIUHL7U1",91,0)
 ; Escape Sequence codes:
"RTN","TIUHL7U1",92,0)
 ;         F = field separator (TIUFS)
"RTN","TIUHL7U1",93,0)
 ;         S = component separator (TIUCS)
"RTN","TIUHL7U1",94,0)
 ;         R = repitition separator (TIURS)
"RTN","TIUHL7U1",95,0)
 ;         E = escape character (TIUES)
"RTN","TIUHL7U1",96,0)
 ;         T = subcomponent separator (TIUSS)
"RTN","TIUHL7U1",97,0)
 N I1,I2,J1,J2,K,TIUCHR,TIUREP,VALUE
"RTN","TIUHL7U1",98,0)
 F TIUCHR="F","S","R","E","T" S TIUREP(TIUES_TIUCHR_TIUES)=$S(TIUCHR="F":TIUFS,TIUCHR="S":TIUCS,TIUCHR="R":TIURS,TIUCHR="E":TIUES,TIUCHR="T":TIUSS)
"RTN","TIUHL7U1",99,0)
 S TIUSTR=$$REPLACE^XLFSTR(TIUSTR,.TIUREP)
"RTN","TIUHL7U1",100,0)
 F  S I1=$P(TIUSTR,TIUES_"X") Q:$L(I1)=$L(TIUSTR)  D
"RTN","TIUHL7U1",101,0)
 .S I2=$P(TIUSTR,TIUES_"X",2,99)
"RTN","TIUHL7U1",102,0)
 .S J1=$P(I2,TIUES) Q:'$L(J1)
"RTN","TIUHL7U1",103,0)
 .S J2=$P(I2,TIUES,2,99)
"RTN","TIUHL7U1",104,0)
 .S VALUE=$$BASE^XLFUTL($$UP^XLFSTR(J1),16,10)
"RTN","TIUHL7U1",105,0)
 .S K=$S(VALUE>255:"?",VALUE<32!(VALUE>127&(VALUE<160)):"",1:$C(VALUE))
"RTN","TIUHL7U1",106,0)
 .S TIUSTR=I1_K_J2
"RTN","TIUHL7U1",107,0)
 Q TIUSTR
"RTN","TIUHL7U1",108,0)
SIGNDOC(TIUDA) ;
"RTN","TIUHL7U1",109,0)
 N TIUDEL
"RTN","TIUHL7U1",110,0)
 I $G(TIU("COMP"))="LA",'+TIU("EC") D
"RTN","TIUHL7U1",111,0)
 . I '+$G(TIU("SIGNED")),'+$G(TIU("CSIGNED")) D  Q
"RTN","TIUHL7U1",112,0)
 . . I TIU("AVAIL")'="AV" D DELDOC(TIUDA),ERR("TIU","","2100.040","SIGNATURE DATE[TIME] missing from HL7 message & availability not 'AV'; document has been deleted.")
"RTN","TIUHL7U1",113,0)
 . I +TIU("SIGNED") D
"RTN","TIUHL7U1",114,0)
 . . N TIUACT,TIUAUTH,TIUES,TIUSTAT S TIUACT="SIGNATURE",TIUAUTH=$$CANDO^TIULP(TIUDA,TIUACT,TIU("AUDA")) I '+TIUAUTH D
"RTN","TIUHL7U1",115,0)
 . . . D ERR("TIU","15","0000.000",$P(TIUAUTH,U,2)) I TIU("AVAIL")="AV" Q
"RTN","TIUHL7U1",116,0)
 . . . S TIUDEL=1 D ERR("TIU","","0000.000","Legal authentication failed & availability not 'AV'; document has been deleted.")
"RTN","TIUHL7U1",117,0)
 . . I '+$G(TIUDEL) S TIUES=1_U_$$GET1^DIQ(200,TIU("AUDA"),20.2)_U_$$GET1^DIQ(200,TIU("AUDA"),20.3)
"RTN","TIUHL7U1",118,0)
 . . I '+$G(TIUDEL) D ES^TIUHL7U2(TIUDA,TIUES,"",TIU("AUDA"))
"RTN","TIUHL7U1",119,0)
 . . I '+$G(TIUDEL) S TIUSTAT=$P($G(^TIU(8925,TIUDA,0)),U,5) I TIUSTAT<6,TIU("AVAIL")'="AV" D
"RTN","TIUHL7U1",120,0)
 . . . S TIUDEL=1 D ERR("TIU","","0000.000","Legal authentication failed & availability not 'AV'; document has been deleted.")
"RTN","TIUHL7U1",121,0)
 . I +TIU("CSIGNED") D
"RTN","TIUHL7U1",122,0)
 . . N TIUACT,TIUAUTH,TIUES,TIUSTAT S TIUACT="COSIGNATURE",TIUAUTH=$$CANDO^TIULP(TIUDA,TIUACT,TIU("CSDA")) I '+TIUAUTH D
"RTN","TIUHL7U1",123,0)
 . . . D ERR("TIU","29","0000.000",$P(TIUAUTH,U,2)) I TIU("AVAIL")="AV" Q
"RTN","TIUHL7U1",124,0)
 . . . S TIUDEL=1 D ERR("TIU","29","0000.000","Legal authentication failed & availability not 'AV'; document has been deleted.")
"RTN","TIUHL7U1",125,0)
 . . I '+$G(TIUDEL) S TIUES=1_U_$$GET1^DIQ(200,TIU("CSDA"),20.2)_U_$$GET1^DIQ(200,TIU("CSDA"),20.3)
"RTN","TIUHL7U1",126,0)
 . . I '+$G(TIUDEL) D ES^TIURS(TIUDA,TIUES,"",TIU("CSDA"))
"RTN","TIUHL7U1",127,0)
 . . I '+$G(TIUDEL) S TIUSTAT=$P($G(^TIU(8925,TIUDA,0)),U,5) I TIUSTAT'=7,TIU("AVAIL")'="AV" D
"RTN","TIUHL7U1",128,0)
 . . . S TIUDEL=1 D ERR("TIU","29","0000.000","Legal authentication failed & availability not 'AV'; document has been deleted.")
"RTN","TIUHL7U1",129,0)
 I +$G(TIUDEL) D DELDOC(TIUDA)
"RTN","TIUHL7U1",130,0)
 Q
"RTN","TIUHL7U1",131,0)
SNDALRT ;
"RTN","TIUHL7U1",132,0)
 N TIUCNT,XQA,XQAMSG
"RTN","TIUHL7U1",133,0)
 I '+$G(TIUDPRM(4)) Q
"RTN","TIUHL7U1",134,0)
 F TIUCNT=1:1:$L(TIUDPRM(4),U) S:+$P(TIUDPRM(4),U,TIUCNT) XQA($P(TIUDPRM(4),U,TIUCNT))=""
"RTN","TIUHL7U1",135,0)
 S XQAMSG="TIUHL7 has encountered an error during message ["_HL("MID")_"] processing."
"RTN","TIUHL7U1",136,0)
 D SETUP^XQALERT
"RTN","TIUHL7U1",137,0)
 Q
"RTN","TIUHL7U2")
0^9^B27485997^n/a
"RTN","TIUHL7U2",1,0)
TIUHL7U2 ; SLC/AJB - TIUHL7 Utilities; March 23, 2005
"RTN","TIUHL7U2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUHL7U2",3,0)
 Q
"RTN","TIUHL7U2",4,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum
"RTN","TIUHL7U2",5,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUHL7U2",6,0)
 N PTIEN,SUCCESS
"RTN","TIUHL7U2",7,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM",$G(PERSON))
"RTN","TIUHL7U2",8,0)
 I TIUCAN'>0 S TIUDADD=TIUCAN Q
"RTN","TIUHL7U2",9,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUHL7U2",10,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUHL7U2",11,0)
 D ^DIC
"RTN","TIUHL7U2",12,0)
 S TIUDADD=+Y
"RTN","TIUHL7U2",13,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUHL7U2",14,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUHL7U2",15,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUHL7U2",16,0)
 S PTIEN=$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIUHL7U2",17,0)
 D STUFREC^TIUSRVP1(+TIUDADD,.TIUX,PTIEN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUHL7U2",18,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUHL7U2",19,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUHL7U2",20,0)
 D SETXT0^TIUSRVP(+TIUDADD)
"RTN","TIUHL7U2",21,0)
 D FILE^TIUSRVP(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUHL7U2",22,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) S TIUDADD="-1^Could not create addendum." Q
"RTN","TIUHL7U2",23,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUHL7U2",24,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUHL7U2",25,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUHL7U2",26,0)
 Q
"RTN","TIUHL7U2",27,0)
DOCPRM(TIUTYP,TIUDPRM,TIUDA) ; Get Document Parameters, support inheritance
"RTN","TIUHL7U2",28,0)
 N TIUI,TIUDAD
"RTN","TIUHL7U2",29,0)
 S (TIUDPRM(0),TIUDPRM(5))=""
"RTN","TIUHL7U2",30,0)
 I $P($G(^TIU(8925.1,+TIUTYP,0)),U)["ADDENDUM",+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUHL7U2",31,0)
 S TIUI=+$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIUHL7U2",32,0)
 I +TIUI D  Q
"RTN","TIUHL7U2",33,0)
 . S TIUDPRM(0)=$G(^TIU(8925.95,+TIUI,0))
"RTN","TIUHL7U2",34,0)
 . I +$O(^TIU(8925.95,+TIUI,5,0)) D
"RTN","TIUHL7U2",35,0)
 . . N TIUJ S TIUJ=0
"RTN","TIUHL7U2",36,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,5,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUHL7U2",37,0)
 . . . S $P(TIUDPRM(5),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,5,+TIUJ,0))
"RTN","TIUHL7U2",38,0)
 . . S TIUJ=0
"RTN","TIUHL7U2",39,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,4,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUHL7U2",40,0)
 . . . S $P(TIUDPRM(4),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,4,+TIUJ,0))
"RTN","TIUHL7U2",41,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUHL7U2",42,0)
 I +TIUDAD D DOCPRM(TIUDAD,.TIUDPRM)
"RTN","TIUHL7U2",43,0)
 Q
"RTN","TIUHL7U2",44,0)
ES(DA,TIUES,TIUI,TIUESIG) ; ^DIE call for /es/
"RTN","TIUHL7U2",45,0)
 N SIGNER,DR,DIE,ESDT,TIUSTAT,TIUSTNOW,COSIGNER,SVCHIEF,CSREQ,TIUPRINT
"RTN","TIUHL7U2",46,0)
 N CSNEED,TIUTTL,TIUPSIG,TIUDPRM,DAO,TIUSTWAS,TIUSTIS,DAORIG,TIUCHNG
"RTN","TIUHL7U2",47,0)
 S TIUSTWAS=$P($G(^TIU(8925,DA,0)),U,5) S:'+$G(TIUESIG) TIUESIG=DUZ
"RTN","TIUHL7U2",48,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPRM,DA)
"RTN","TIUHL7U2",49,0)
 S TIUSTAT=$P($G(^TIU(8925,+DA,0)),U,5),ESDT=$$NOW^TIULC
"RTN","TIUHL7U2",50,0)
 S SVCHIEF=+$$ISA^USRLM(TIUESIG,"CLINICAL SERVICE CHIEF")
"RTN","TIUHL7U2",51,0)
 S SIGNER=$P(^TIU(8925,+DA,12),U,4),COSIGNER=$P(^(12),U,8),CSREQ=0
"RTN","TIUHL7U2",52,0)
 S CSNEED=+$P($G(^TIU(8925,+DA,15)),U,6)
"RTN","TIUHL7U2",53,0)
 I +CSNEED,(TIUESIG'=COSIGNER),'+$G(SVCHIEF),(TIUSTAT'=6) S CSREQ=1
"RTN","TIUHL7U2",54,0)
 I TIUSTAT=5 D
"RTN","TIUHL7U2",55,0)
 . S DR=".05////"_$S(+CSREQ:6,1:7)_";1501////"_ESDT_";1502////"_+TIUESIG
"RTN","TIUHL7U2",56,0)
 . I '+$G(CSREQ),+CSNEED,$S(TIUESIG=COSIGNER:1,+$G(SVCHIEF):1,1:0) D
"RTN","TIUHL7U2",57,0)
 . . S DR=DR_";1506////0;1507////"_ESDT_";1508////"_+TIUESIG_";1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIUHL7U2",58,0)
 I TIUSTAT=6 S DR=".05////7;1506////0;1507////"_ESDT_";1508////"_+TIUESIG
"RTN","TIUHL7U2",59,0)
 Q:'$D(DR)
"RTN","TIUHL7U2",60,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "."
"RTN","TIUHL7U2",61,0)
 I TIUSTAT=5 S DR="1503///^S X=$P(TIUES,U,2);1504///^S X=$P(TIUES,U,3);1505////E"
"RTN","TIUHL7U2",62,0)
 I TIUSTAT=6 D
"RTN","TIUHL7U2",63,0)
 . N TIUSBY S DR="",TIUSBY=$P($G(^TIU(8925,+DA,15)),U,2)
"RTN","TIUHL7U2",64,0)
 . I +TIUSBY>0 S DR="1503///^S X=$$SIGNAME^TIULS("_TIUSBY_");1504///^S X=$$SIGTITL^TIULS("_TIUSBY_");"
"RTN","TIUHL7U2",65,0)
 . S DR=$G(DR)_"1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIUHL7U2",66,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "." S:'+$G(TIUCHNG) TIUCHNG=1
"RTN","TIUHL7U2",67,0)
 D SEND^TIUALRT(DA),SIGNIRT^TIUDIRT(+DA)
"RTN","TIUHL7U2",68,0)
 S DAORIG=DA
"RTN","TIUHL7U2",69,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUHL7U2",70,0)
 I +$G(CSREQ)'>0 D MAIN^TIUPD(DA,"S") I 1
"RTN","TIUHL7U2",71,0)
 ;If 'Credit Stop Code on Completion' is Yes
"RTN","TIUHL7U2",72,0)
 I +$P(^TIU(8925,+DA,0),U,11) D
"RTN","TIUHL7U2",73,0)
 . ;If workload does not exist, process using TIU's interview otherwise
"RTN","TIUHL7U2",74,0)
 . ;process as an edit using PCE's interview
"RTN","TIUHL7U2",75,0)
 . I '$$CHKVST^TIUPXAP2(+DA) D  I 1
"RTN","TIUHL7U2",76,0)
 . . N TIUCONT,TIUPRMT
"RTN","TIUHL7U2",77,0)
 . . Q:$D(XWBOS)
"RTN","TIUHL7U2",78,0)
 . . I $P(+$P(^TIU(8925,+DA,0),U,7),".")>DT D  Q
"RTN","TIUHL7U2",79,0)
 . . . W !!
"RTN","TIUHL7U2",80,0)
 . . . D QUE^TIUPXAP1
"RTN","TIUHL7U2",81,0)
 . . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUHL7U2",82,0)
 . . W !!
"RTN","TIUHL7U2",83,0)
 . . ;Check if workload should be entered
"RTN","TIUHL7U2",84,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D CREDIT^TIUVSIT(DA)
"RTN","TIUHL7U2",85,0)
 . E  D
"RTN","TIUHL7U2",86,0)
 . . ;Check if workload should be entered
"RTN","TIUHL7U2",87,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D EDTENC^TIUPXAP2(DA)
"RTN","TIUHL7U2",88,0)
 . D REMFLAG^TIUVSIT(+DA)
"RTN","TIUHL7U2",89,0)
 ;If document does not have a visit and docmt is associated with
"RTN","TIUHL7U2",90,0)
 ;an event type visit or call is invoked by broker, check if
"RTN","TIUHL7U2",91,0)
 ;docmt can be linked to an existing visit or try and create a new
"RTN","TIUHL7U2",92,0)
 ;visit. (P179)
"RTN","TIUHL7U2",93,0)
 I $D(^TIU(8925,+DA,0)),$P(^(0),U,3)'>0,($P(^(0),U,13)="E"!($$BROKER^XWBLIB)) D
"RTN","TIUHL7U2",94,0)
 . N D0,DFN,TIU,TIUVSIT
"RTN","TIUHL7U2",95,0)
 . ;Try to link docmt to an existing visit, quit if successful
"RTN","TIUHL7U2",96,0)
 . I $$LNKVST^TIUPXAP3(DA,.TIUVSIT) Q
"RTN","TIUHL7U2",97,0)
 . ;Otherwise set TIU array and DFN to use TIU API which calls PCE
"RTN","TIUHL7U2",98,0)
 . ;to resolve multiple visits or creates a new visit
"RTN","TIUHL7U2",99,0)
 . D GETTIU^TIULD(.TIU,DA)
"RTN","TIUHL7U2",100,0)
 . S DFN=$P($G(^TIU(8925,+DA,0)),U,2)
"RTN","TIUHL7U2",101,0)
 . D QUE^TIUPXAP1
"RTN","TIUHL7U2",102,0)
 ; post-signature action
"RTN","TIUHL7U2",103,0)
 N TIUCONS S TIUCONS=-1
"RTN","TIUHL7U2",104,0)
 D ISCNSLT^TIUCNSLT(.TIUCONS,+$G(^TIU(8925,DA,0)))
"RTN","TIUHL7U2",105,0)
 I TIUCONS S DA=DAORIG
"RTN","TIUHL7U2",106,0)
 S TIUSTIS=$P($G(^TIU(8925,DA,0)),U,5)
"RTN","TIUHL7U2",107,0)
 S TIUTTL=+$G(^TIU(8925,+DA,0)),TIUPSIG=$$POSTSIGN^TIULC1(TIUTTL)
"RTN","TIUHL7U2",108,0)
 I +$L(TIUPSIG),'+$G(CSREQ) X TIUPSIG
"RTN","TIUHL7U2",109,0)
 I TIUCONS,TIUSTIS=7,TIUSTWAS<7,$$HASKIDS^TIUSRVLI(DA) D
"RTN","TIUHL7U2",110,0)
 . N SEQUENCE,TIUKIDS,TIUINT,TIUK
"RTN","TIUHL7U2",111,0)
 . S SEQUENCE="D",TIUKIDS="TIUKIDS",TIUINT=0,TIUK=0
"RTN","TIUHL7U2",112,0)
 . D SETKIDS^TIUSRVLI(TIUKIDS,DA,TIUINT)
"RTN","TIUHL7U2",113,0)
 . F  S TIUK=$O(TIUKIDS(TIUK)) Q:'TIUK  D
"RTN","TIUHL7U2",114,0)
 . . I $P(TIUKIDS(TIUK),U,7)="completed" X TIUPSIG
"RTN","TIUHL7U2",115,0)
 Q
"RTN","TIUHL7U2",116,0)
STRIP(X) ; Strip control characters
"RTN","TIUHL7U2",117,0)
 N I,Y
"RTN","TIUHL7U2",118,0)
 ; First replace TABS w/5 spaces
"RTN","TIUHL7U2",119,0)
 F I=1:1:$L(X) S:$A(X,I)=9 X=$E(X,1,(I-1))_"     "_$E(X,(I+1),$L(X))
"RTN","TIUHL7U2",120,0)
 ; Next, remove control characters
"RTN","TIUHL7U2",121,0)
 S Y="" F I=1:1:$L(X) S:$A(X,I)>31 Y=Y_$E(X,I)
"RTN","TIUHL7U2",122,0)
 Q Y
"RTN","TIULV")
0^11^B32139768^B31297101
"RTN","TIULV",1,0)
TIULV ; SLC/JER - Visit/Movement related library ; 4/18/03
"RTN","TIULV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,30,55,45,52,148,156,152,113,200**;Jun 20, 1997
"RTN","TIULV",3,0)
PATPN(TIUY,DFN) ; Get minimum demographics for PN Print
"RTN","TIULV",4,0)
 N VADM,VAIP,VAIN,VA,VAPA
"RTN","TIULV",5,0)
 D OERR^VADPT
"RTN","TIULV",6,0)
 S TIUY("PNMP")=$E($G(VADM(1)),1,30)
"RTN","TIULV",7,0)
 S TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",8,0)
 S TIUY("DOB")="DOB:"_$$DATE^TIULS(+$G(VADM(3)),"MM/DD/CCYY")
"RTN","TIULV",9,0)
 D ADD^VADPT
"RTN","TIULV",10,0)
 I $G(VAPA(8))'="" S TIUY("PH#")="Ph:"_VAPA(8)
"RTN","TIULV",11,0)
 I $G(VAPA(8))="" S TIUY("PH#")="Ph: **UNKNOWN**"
"RTN","TIULV",12,0)
 S TIUY("INTNM")=$$NAME^VASITE ;Integration Name
"RTN","TIULV",13,0)
 S TIUY("SITE")=$P($$SITE^VASITE,U,2)
"RTN","TIULV",14,0)
 S TIUY("LOCP")="Pt Loc: "_$S(VAIN(4)]"":$P(VAIN(4),U,2)_"  "_VAIN(5),1:"OUTPATIENT")
"RTN","TIULV",15,0)
 Q
"RTN","TIULV",16,0)
 ;
"RTN","TIULV",17,0)
PATVADPT(TIUY,DFN,TIUMVN,TIUVSTR,TIUSDC) ; Extract MAS data
"RTN","TIULV",18,0)
 N VA,VADM,VAEL,VAERR,VAIP,TIUI,TIUWARD,X,Y,TIUTYPE,TIUFTS,TIUSS,VAPA
"RTN","TIULV",19,0)
 D DEM^VADPT
"RTN","TIULV",20,0)
 S TIUY("PNM")=$G(VADM(1)),TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",21,0)
 S TIUY("AGE")=$G(VADM(4)),TIUY("PID")="("_$E(TIUY("PNM"))_VA("BID")_")"
"RTN","TIULV",22,0)
 S TIUY("DOB")=$G(VADM(3))
"RTN","TIULV",23,0)
 D ADD^VADPT
"RTN","TIULV",24,0)
 I $G(VAPA(8))'="" S TIUY("PH#")=VAPA(8)
"RTN","TIULV",25,0)
 I $G(VAPA(8))="" S TIUY("PH#")="**UNKNOWN**"
"RTN","TIULV",26,0)
 S TIUY("SEX")=$G(VADM(5))
"RTN","TIULV",27,0)
 ; Below TIU*148
"RTN","TIULV",28,0)
 I +$G(VADM(12))>0 D 
"RTN","TIULV",29,0)
 . F TIUY("NUMRACE")=1:1:VADM(12) S TIUY("RACE",TIUY("NUMRACE"))=$G(VADM(12,TIUY("NUMRACE")))
"RTN","TIULV",30,0)
 S TIUY("RACENO")=+$G(VADM(12))
"RTN","TIULV",31,0)
 I +$G(VADM(12))=0 S TIUY("RACE")=$G(VADM(8))
"RTN","TIULV",32,0)
 I +$G(TIUSDC) S TIUY("STOP")=$G(TIUSDC)
"RTN","TIULV",33,0)
 I +$G(TIUD13(0)) S TIUY("REFDT")=+$G(TIUD13(0))
"RTN","TIULV",34,0)
 I +$G(TIUMVN),$D(^DGPM(+TIUMVN)) D
"RTN","TIULV",35,0)
 . ; N VLOC,VDT,TIUDIV
"RTN","TIULV",36,0)
 . N VLOC,VDT,TIUDIV
"RTN","TIULV",37,0)
 . S VAIP("E")=TIUMVN D 52^VADPT
"RTN","TIULV",38,0)
 . S TIUI=$S(+$G(VAIP(17,1)):17,1:14)
"RTN","TIULV",39,0)
 . S TIUY("CLAIM")=$G(VAEL(7)),TIUY("PMD")=$G(VAIP(TIUI,5))
"RTN","TIULV",40,0)
 . S TIUY("AMD")=$G(VAIP(18)),TIUY("TS")=$G(VAIP(TIUI,6))
"RTN","TIULV",41,0)
 . S TIUY("SVC")=+$$GET1^DIQ(45.7,+TIUY("TS"),2,"I",,"ERROR")
"RTN","TIULV",42,0)
 . S TIUY("SVC")=TIUY("SVC")_U_$$GET1^DIQ(49,+TIUY("SVC"),.01,"I",,"ERROR")
"RTN","TIULV",43,0)
 . S TIUY("WARD")=$$WARD($G(VAIP(17)))
"RTN","TIULV",44,0)
 . S (TIUY("ADDT"),TIUY("EDT"))=$G(VAIP(3))
"RTN","TIULV",45,0)
 . I +TIUY("WARD") S TIUY("LOC")=$G(^DIC(42,+TIUY("WARD"),44))
"RTN","TIULV",46,0)
 . I +$G(TIUY("LOC")) D
"RTN","TIULV",47,0)
 . . S TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",48,0)
 . S TIUY("ADDX")=$G(VAIP(9)),TIUY("LDT")=$G(VAIP(17,1))
"RTN","TIULV",49,0)
 . S TIUY("AD#")=+$G(VAIP(13)),TIUY("MTYPE")=$G(VAIP(TIUI,3))
"RTN","TIULV",50,0)
 . S TIUDIV=$P($G(^DIC(42,+TIUY("WARD"),0)),U,11)
"RTN","TIULV",51,0)
 . I +TIUDIV S TIUY("DIV")=TIUDIV_U_$P($G(^DG(40.8,+TIUDIV,0)),U)
"RTN","TIULV",52,0)
 . S VDT=+VAIP(3)
"RTN","TIULV",53,0)
 . S VLOC=$G(^DIC(42,+$P($G(VAIP(13,4)),U),44))
"RTN","TIULV",54,0)
 . S TIUY("VSTR")=VLOC_";"_+TIUY("EDT")_";H"
"RTN","TIULV",55,0)
 . S TIUY("VLOC")=VLOC_U_$P($G(^SC(VLOC,0)),U)
"RTN","TIULV",56,0)
 . S:'+$G(TIUY("LOC")) TIUY("LOC")=TIUY("VLOC")
"RTN","TIULV",57,0)
 I $G(TIUVSTR)]"" S TIUY("VSTR")=TIUVSTR D VSIT(.TIUY,TIUVSTR)
"RTN","TIULV",58,0)
 I '+$G(TIUMVN),'+$G(TIUVSTR) D CURRENT(.TIUY,DFN)
"RTN","TIULV",59,0)
 ; D CURRENT(.TIUY,DFN)
"RTN","TIULV",60,0)
 I +$$PROVIDER^TIUPXAP1($S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ),+$G(TIUY("EDT"))) D
"RTN","TIULV",61,0)
 . S TIUY("SVC")=$$PROVSVC(+$S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ))
"RTN","TIULV",62,0)
 I +$G(TIUY("VSTR")),(+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))>0) D
"RTN","TIULV",63,0)
 . N TIUVSIT S TIUVSIT=+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))
"RTN","TIULV",64,0)
 . I $P($G(^AUPNVSIT(+TIUVSIT,0)),U,5)'=DFN K ^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),TIUVSIT) Q
"RTN","TIULV",65,0)
 . S TIUY("VISIT")=+TIUVSIT_U_+$G(^AUPNVSIT(+TIUVSIT,0))
"RTN","TIULV",66,0)
 ; if pt an inpt + doc class is pn- default to current inpt loc
"RTN","TIULV",67,0)
 S TIUTYPE=$S(+$P($G(TIUTYP(1)),U,2)>0:$P($G(TIUTYP(1)),U,2),1:+$G(TIUTYP))
"RTN","TIULV",68,0)
 I +TIUTYPE'>0 S TIUY("INST")=$$DIVISION^TIULC1(+TIUY("LOC")) Q
"RTN","TIULV",69,0)
 I +$G(TIUMVN),$D(^DPT(DFN,.1)),+$$ISPN^TIULX(TIUTYPE) D
"RTN","TIULV",70,0)
 . I $D(VAIP(14,4)) S TIUY("LOC")=$G(^DIC(42,+VAIP(14,4),44))_U_$P(VAIP(14,4),U,2)
"RTN","TIULV",71,0)
 S TIUY("INST")=$$DIVISION^TIULC1(+TIUY("LOC"))
"RTN","TIULV",72,0)
 Q
"RTN","TIULV",73,0)
WARD(DA) ; Compute ward at discharge
"RTN","TIULV",74,0)
 N %,D0,DIC,DIQ,DR,MOVE,X,Y
"RTN","TIULV",75,0)
 I +DA'>0 S Y=$G(VAIP(TIUI,4)) G WARDX
"RTN","TIULV",76,0)
 S DIC="^DGPM(",DIQ(0)="IE",DIQ="MOVE(",DR=200
"RTN","TIULV",77,0)
 D EN^DIQ1
"RTN","TIULV",78,0)
 S X=$G(MOVE(405,DA,200,"E")),DIC=42,DIC(0)="X" D ^DIC
"RTN","TIULV",79,0)
 I +Y'>0 S Y=""
"RTN","TIULV",80,0)
WARDX Q Y
"RTN","TIULV",81,0)
PROVSVC(TIUSER) ; Resolve user's Service
"RTN","TIULV",82,0)
 N TIUY
"RTN","TIULV",83,0)
 S TIUY=$P($G(^VA(200,+TIUSER,5)),U)
"RTN","TIULV",84,0)
 S:+TIUY TIUY=TIUY_U_$P(^DIC(49,+TIUY,0),U)
"RTN","TIULV",85,0)
 Q TIUY
"RTN","TIULV",86,0)
VSIT(TIUY,TIUVSTR) ; Get Visit related info
"RTN","TIULV",87,0)
 N DIC,DIQ,X,Y,DA,DR,VSIT,TIUCT,VAEL,VAERR
"RTN","TIULV",88,0)
 D ELIG^VADPT
"RTN","TIULV",89,0)
 I '$D(TIUY("EDT")) D
"RTN","TIULV",90,0)
 . S TIUY("EDT")=$P(TIUVSTR,";",2)_U_$$DATE^TIULS($P(TIUVSTR,";",2),"AMTH DD, CCYY@HR:MIN")
"RTN","TIULV",91,0)
 S TIUY("LDT")=$G(TIUY("LDT"))
"RTN","TIULV",92,0)
 S TIUCT=$P(TIUVSTR,";",3)
"RTN","TIULV",93,0)
 I TIUCT]"" S TIUY("CAT")=TIUCT_U_$S(TIUCT="A":"AMBULATORY",TIUCT="I":"IN HOSPITAL",TIUCT="H":"HOSPITALIZATION",TIUCT="T":"TELEPHONE",1:"EVENT (HISTORICAL)")
"RTN","TIULV",94,0)
 I TIUCT="E",+$G(TIUVSTR)'>0 Q
"RTN","TIULV",95,0)
 S TIUY("LVL")=$G(TIUY("LVL"))
"RTN","TIULV",96,0)
 S TIUY("ELG")=$G(VAEL(1))
"RTN","TIULV",97,0)
 S TIUY("VLOC")=+$G(TIUVSTR)_U_$P($G(^SC(+$G(TIUVSTR),0)),U)
"RTN","TIULV",98,0)
 I $G(TIUY("LOC"))']"" S TIUY("LOC")=$S($L($G(TIUD12)):$P($G(TIUD12),U,5),+$G(TIUDA):+$P($G(^TIU(8925,+$G(TIUDA),12)),U,5),1:+TIUY("VLOC"))
"RTN","TIULV",99,0)
 S:$P(TIUY("LOC"),U,2)']"" TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",100,0)
 I '$D(TIUY("DIV")),+$G(TIUY("LOC")) D
"RTN","TIULV",101,0)
 . N TIUDIV,DIC,DR,DA,DIQ,X,Y
"RTN","TIULV",102,0)
 . S DIC=44,DIQ="TIUDIV",DIQ(0)="IE",DA=+TIUY("LOC"),DR="3.5" D EN^DIQ1
"RTN","TIULV",103,0)
 . I '+$G(TIUDIV(44,+DA,3.5,"I")) Q
"RTN","TIULV",104,0)
 . S TIUY("DIV")=TIUDIV(44,+DA,3.5,"I")_U_TIUDIV(44,+DA,3.5,"E")
"RTN","TIULV",105,0)
 I '$D(TIUY("DIV")),'+$G(TIUY("LOC")) D
"RTN","TIULV",106,0)
 . S TIUY("DIV")=+$O(^DG(40.8,"AD",+$G(DUZ(2)),0))
"RTN","TIULV",107,0)
 . S TIUY("DIV")=+TIUY("DIV")_U_$P($G(^DG(40.8,+$G(TIUY("DIV")),0)),U)
"RTN","TIULV",108,0)
 S TIUY("INS")=$G(TIUY("DIV"))
"RTN","TIULV",109,0)
 S TIUY("SC")=$G(TIUY("SC"))
"RTN","TIULV",110,0)
 Q
"RTN","TIULV",111,0)
CURRENT(TIUY,DFN) ; Get current INPATIENT data
"RTN","TIULV",112,0)
 N VAIN D INP^VADPT
"RTN","TIULV",113,0)
 S TIUY("AD#")=$G(VAIN(1)),TIUY("PMD")=$G(VAIN(2))
"RTN","TIULV",114,0)
 S TIUY("TS")=$G(VAIN(3)),TIUY("WARD")=$G(VAIN(4),"0^OUTPATIENT")
"RTN","TIULV",115,0)
 S TIUY("RB")=$G(VAIN(5))
"RTN","TIULV",116,0)
 I +TIUY("WARD") D
"RTN","TIULV",117,0)
 . N DIC,DIQ,DR,DA,TIUDIV,Y
"RTN","TIULV",118,0)
 . S DIC=42,DA=+TIUY("WARD"),DIQ="TIUDIV(",DIQ(0)="IE",DR=".015;44"
"RTN","TIULV",119,0)
 . D EN^DIQ1
"RTN","TIULV",120,0)
 . S TIUY("DIV")=$G(TIUDIV(42,DA,.015,"I"))_U_$G(TIUDIV(42,DA,.015,"E"))
"RTN","TIULV",121,0)
 . S TIUY("LOC")=$G(TIUDIV(42,DA,44,"I"))_U_$G(TIUDIV(42,DA,44,"E"))
"RTN","TIULV",122,0)
 S TIUY("LOC")=$G(TIUY("LOC"))
"RTN","TIULV",123,0)
 I '+$G(TIUY("DIV")) D
"RTN","TIULV",124,0)
 . N DIC,DIQ,DR,DA
"RTN","TIULV",125,0)
 . S DIC=4,DR=".01",DA=+$G(DUZ(2)),DIQ="TIUDIV1"
"RTN","TIULV",126,0)
 . D EN^DIQ1
"RTN","TIULV",127,0)
 . ;TIU*1*152 changed TIUDIV1(4,DUZ(2),.01) to $G(TIUDIV1(4,$G(DUZ(2)),.01)) ; TIU*1*200 Added + to 2nd piece and + to $G(DUZ(2))
"RTN","TIULV",128,0)
 . S TIUY("DIV")=+$G(DUZ(2))_U_+$G(TIUDIV1(4,+$G(DUZ(2)),.01))
"RTN","TIULV",129,0)
 Q
"RTN","TIUPR200")
0^10^B23776798^n/a
"RTN","TIUPR200",1,0)
TIUPR200 ; SLC/AJB - Pre-install/Home Telehealth Titles; July 26, 2005
"RTN","TIUPR200",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200**;Jun 20, 1997
"RTN","TIUPR200",3,0)
 ;
"RTN","TIUPR200",4,0)
 Q  
"RTN","TIUPR200",5,0)
 W !,"Verifying installation environment..."
"RTN","TIUPR200",6,0)
 S TIUCOCOR=$$LU(8930,"CLINICAL COORDINATOR","X") I '+TIUCOCOR W !,"Installation Error:  CLINICAL COORDINATOR (Class Owner) cannot be defined." S TIUABORT=1
"RTN","TIUPR200",7,0)
 S TIUCNSLT=$$LU(8925.1,"CONSULTS","X","I $P(^TIU(8925.1,+Y,0),U,4)=""DC""") I '+TIUCNSLT W !,"Installation Error:  Cannot define CONSULTS class." S TIUABORT=1
"RTN","TIUPR200",8,0)
 S TIUPGNTS=$$LU(8925.1,"PROGRESS NOTES","X","I $P(^TIU(8925.1,+Y,0),U,4)=""CL""") I '+TIUPGNTS W !,"Installation Error:  Cannot define PROGRESS NOTES class." S TIUABORT=1
"RTN","TIUPR200",9,0)
 I +$G(TIUABORT) W !!,"Please re-install TIU*1.0*200 after the necessary changes have been made." S XPDABORT=1 Q
"RTN","TIUPR200",10,0)
 W "complete."
"RTN","TIUPR200",11,0)
 Q 
"RTN","TIUPR200",12,0)
EN Q  
"RTN","TIUPR200",13,0)
 N LINE,TIUABORT,TIUCNSLT,TIUCOCOR,TIUFPRIV,TIUNAME,TIUPGNTS,TIUPRNT,TITLE,X,Y
"RTN","TIUPR200",14,0)
 X ^%ZOSF("EON") W $G(IOCUON) W:+$L($G(IOF)) @IOF
"RTN","TIUPR200",15,0)
 W !,"Preparing installation environment..."
"RTN","TIUPR200",16,0)
 S TIUCOCOR=$$LU(8930,"CLINICAL COORDINATOR","X") I '+TIUCOCOR W !,"Installation Error:  CLINICAL COORDINATOR (Class Owner) cannot be found." S TIUABORT=1
"RTN","TIUPR200",17,0)
 S TIUCNSLT=$$LU(8925.1,"CONSULTS","X","I $P(^TIU(8925.1,+Y,0),U,4)=""DC""") I '+TIUCNSLT W !,"Installation Error:  Cannot find CONSULTS class." S TIUABORT=1
"RTN","TIUPR200",18,0)
 S TIUPGNTS=$$LU(8925.1,"PROGRESS NOTES","X","I $P(^TIU(8925.1,+Y,0),U,4)=""CL""") I '+TIUPGNTS W !,"Installation Error:  Cannot find PROGRESS NOTES class." S TIUABORT=1
"RTN","TIUPR200",19,0)
 I +$G(TIUABORT) W ! Q
"RTN","TIUPR200",20,0)
 W "complete.",!
"RTN","TIUPR200",21,0)
 I $$READ^TIUU("Y","Install the Home TeleHealth Note Titles","YES") W !,! D HTH
"RTN","TIUPR200",22,0)
 Q
"RTN","TIUPR200",23,0)
HTH ;
"RTN","TIUPR200",24,0)
 S TIUFPRIV=1,TIUNAME="Care Coordination Ho"
"RTN","TIUPR200",25,0)
 F X="CONS","DC","PNS" F LINE=1:1 S TITLE=$P($T(@X+LINE),";;",2) Q:TITLE="EOM"  D
"RTN","TIUPR200",26,0)
 . N TIUDA
"RTN","TIUPR200",27,0)
 . I X="DC" I '$$LU(8925.1,$P(TITLE,U),"X","I $P(^TIU(8925.1,+Y,0),U,4)=""DC""") D
"RTN","TIUPR200",28,0)
 . . I +$G(TIUPGNTS) S TIUDA=$$CREATE($P(TITLE,U),$P(TITLE,U,2)) I +TIUDA D ATTACH(TIUDA,TIUPGNTS) S TIUPRNT=TIUDA W !,"Installed "_$P(TITLE,U)_" successfully."
"RTN","TIUPR200",29,0)
 . I X="PNS" I '$$LU(8925.1,$P(TITLE,U),"X","I $P(^TIU(8925.1,+Y,0),U,4)=""DOC""") D
"RTN","TIUPR200",30,0)
 . . S TIUPRNT=$$LU(8925.1,"CARE COORDINATION HOME TELEHEALTH NOTES","X","I $P(^TIU(8925.1,+Y,0),U,4)=""DC""")
"RTN","TIUPR200",31,0)
 . . I +$G(TIUPRNT) S TIUDA=$$CREATE($P(TITLE,U),$P(TITLE,U,2)) I +TIUDA D ATTACH(TIUDA,TIUPRNT) W !,"Installed "_$P(TITLE,U)_" successfully."
"RTN","TIUPR200",32,0)
 . I X="CONS" I '$$LU(8925.1,$P(TITLE,U),"X","I $P(^TIU(8925.1,+Y,0),U,4)=""DOC""") D
"RTN","TIUPR200",33,0)
 . . I +$G(TIUCNSLT) S TIUDA=$$CREATE($P(TITLE,U),$P(TITLE,U,2)) I +TIUDA D ATTACH(TIUDA,TIUCNSLT) W !,"Installed "_$P(TITLE,U)_" successfully."
"RTN","TIUPR200",34,0)
EXIT D
"RTN","TIUPR200",35,0)
 .N DIR,X,Y
"RTN","TIUPR200",36,0)
 .S DIR(0)="E"
"RTN","TIUPR200",37,0)
 .W ! D ^DIR
"RTN","TIUPR200",38,0)
 Q
"RTN","TIUPR200",39,0)
LU(FILE,NAME,FLAGS,SCREEN,INDEXES) ;
"RTN","TIUPR200",40,0)
 Q $$FIND1^DIC(FILE,"",$G(FLAGS),NAME,$G(INDEXES),$G(SCREEN),"MSGERR")
"RTN","TIUPR200",41,0)
CREATE(NAME,TYPE) ;
"RTN","TIUPR200",42,0)
 N TIU,TIUDA,TIUIEN,TIUMSG
"RTN","TIUPR200",43,0)
 S TIU(8925.1,"+1,",.01)=NAME
"RTN","TIUPR200",44,0)
 S TIU(8925.1,"+1,",.02)=""
"RTN","TIUPR200",45,0)
 S TIU(8925.1,"+1,",.03)=NAME
"RTN","TIUPR200",46,0)
 S TIU(8925.1,"+1,",.04)=TYPE
"RTN","TIUPR200",47,0)
 S TIU(8925.1,"+1,",.05)=""
"RTN","TIUPR200",48,0)
 S TIU(8925.1,"+1,",.06)=TIUCOCOR
"RTN","TIUPR200",49,0)
 S TIU(8925.1,"+1,",.07)=11
"RTN","TIUPR200",50,0)
 S TIU(8925.1,"+1,",3.02)=1
"RTN","TIUPR200",51,0)
 S TIU(8925.1,"+1,",99)=$H
"RTN","TIUPR200",52,0)
 D UPDATE^DIE("","TIU","TIUIEN","TIUMSG")
"RTN","TIUPR200",53,0)
 S TIUDA=+$G(TIUIEN(1))
"RTN","TIUPR200",54,0)
 I $D(TIUMSG) D
"RTN","TIUPR200",55,0)
 . W !!,"The following error message was returned:",!!
"RTN","TIUPR200",56,0)
 . S TIUMSG="" F  S TIUMSG=$O(TIUMSG("DIERR",1,"TEXT",TIUMSG)) Q:TIUMSG=""  W TIUMSG("DIERR",1,"TEXT",TIUMSG),!
"RTN","TIUPR200",57,0)
 Q TIUDA
"RTN","TIUPR200",58,0)
ATTACH(TIUDA,TIUPRNT) ;
"RTN","TIUPR200",59,0)
 N TIU,TIUIEN,TIUMSG
"RTN","TIUPR200",60,0)
 S TIU(8925.14,"+2,"_TIUPRNT_",",.01)=TIUDA
"RTN","TIUPR200",61,0)
 S TIU(8925.14,"+2,"_TIUPRNT_",",4)=TIUNAME
"RTN","TIUPR200",62,0)
 D UPDATE^DIE("","TIU","TIUIEN","TIUMSG")
"RTN","TIUPR200",63,0)
 I $D(TIUMSG) D
"RTN","TIUPR200",64,0)
 . W !!,"The following error message was returned:",!!
"RTN","TIUPR200",65,0)
 . S TIUMSG="" F  S TIUMSG=$O(TIUMSG("DIERR",1,"TEXT",TIUMSG)) Q:TIUMSG=""  W TIUMSG("DIERR",1,"TEXT",TIUMSG),!
"RTN","TIUPR200",66,0)
 Q
"RTN","TIUPR200",67,0)
DC ;
"RTN","TIUPR200",68,0)
 ;;CARE COORDINATION HOME TELEHEALTH NOTES^DC
"RTN","TIUPR200",69,0)
 ;;EOM
"RTN","TIUPR200",70,0)
 Q
"RTN","TIUPR200",71,0)
CONS ;
"RTN","TIUPR200",72,0)
 ;;CARE COORDINATION HOME TELEHEALTH SCREENING CONSULT^DOC
"RTN","TIUPR200",73,0)
 ;;EOM
"RTN","TIUPR200",74,0)
 Q
"RTN","TIUPR200",75,0)
PNS ;
"RTN","TIUPR200",76,0)
 ;;CARE COORDINATION HOME TELEHEALTH DISCHARGE NOTE^DOC
"RTN","TIUPR200",77,0)
 ;;CARE COORDINATION HOME TELEHEALTH EDUCATION NOTE^DOC
"RTN","TIUPR200",78,0)
 ;;CARE COORDINATION HOME TELEHEALTH EVALUATION NOTE^DOC
"RTN","TIUPR200",79,0)
 ;;CARE COORDINATION HOME TELEHEALTH EVALUATION TREATMENT PLAN^DOC
"RTN","TIUPR200",80,0)
 ;;CARE COORDINATION HOME TELEHEALTH SUBSEQUENT EVAL NOTE^DOC
"RTN","TIUPR200",81,0)
 ;;CARE COORDINATION HOME TELEHEALTH SUMMARY OF EPISODE NOTE^DOC
"RTN","TIUPR200",82,0)
 ;;CARE COORDINATION HOME TELEHEALTH TELEPHONE ENCOUNTER NOTE^DOC
"RTN","TIUPR200",83,0)
 ;;CARE COORDINATION HOME TELEHEALTH VIDEO VISIT NOTE^DOC
"RTN","TIUPR200",84,0)
 ;;EOM
"RTN","TIUPR200",85,0)
 Q
"VER")
8.0^22.0
**END**
**END**
