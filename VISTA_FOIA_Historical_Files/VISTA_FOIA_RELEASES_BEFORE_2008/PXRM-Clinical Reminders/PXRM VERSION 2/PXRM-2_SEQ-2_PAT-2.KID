Released PXRM*2*2 SEQ #2
Extracted from mail message
**KIDS**:PXRM*2.0*2^

**INSTALL NAME**
PXRM*2.0*2
"BLD",5130,0)
PXRM*2.0*2^CLINICAL REMINDERS^0^3050315^y
"BLD",5130,1,0)
^^1^1^3050216^^^^
"BLD",5130,1,1,0)
See description in the national patch module under patch PXRM*2*2.
"BLD",5130,4,0)
^9.64PA^^0
"BLD",5130,"ABPKG")
n
"BLD",5130,"INI")

"BLD",5130,"INID")
^n
"BLD",5130,"INIT")
POST^PXRMG2M1
"BLD",5130,"KRN",0)
^9.67PA^8989.52^19
"BLD",5130,"KRN",.4,0)
.4
"BLD",5130,"KRN",.401,0)
.401
"BLD",5130,"KRN",.402,0)
.402
"BLD",5130,"KRN",.403,0)
.403
"BLD",5130,"KRN",.5,0)
.5
"BLD",5130,"KRN",.84,0)
.84
"BLD",5130,"KRN",3.6,0)
3.6
"BLD",5130,"KRN",3.8,0)
3.8
"BLD",5130,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5130,"KRN",3.8,"NM",1,0)
GEC2 NATIONAL ROLLUP^^0
"BLD",5130,"KRN",3.8,"NM","B","GEC2 NATIONAL ROLLUP",1)

"BLD",5130,"KRN",9.2,0)
9.2
"BLD",5130,"KRN",9.8,0)
9.8
"BLD",5130,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",5130,"KRN",9.8,"NM",1,0)
PXRMG2E1^^0^B47935634
"BLD",5130,"KRN",9.8,"NM",2,0)
PXRMG2E2^^0^B38330452
"BLD",5130,"KRN",9.8,"NM",3,0)
PXRMG2E3^^0^B4625411
"BLD",5130,"KRN",9.8,"NM",4,0)
PXRMG2E4^^0^B11134068
"BLD",5130,"KRN",9.8,"NM",5,0)
PXRMG2M1^^0^B20412738
"BLD",5130,"KRN",9.8,"NM",6,0)
PXRMG2R1^^0^B25023497
"BLD",5130,"KRN",9.8,"NM",7,0)
PXRMG2R2^^0^B12447730
"BLD",5130,"KRN",9.8,"NM",8,0)
PXRMG2S1^^0^B15372525
"BLD",5130,"KRN",9.8,"NM",9,0)
PXRMGECP^^0^B60301590
"BLD",5130,"KRN",9.8,"NM","B","PXRMG2E1",1)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2E2",2)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2E3",3)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2E4",4)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2M1",5)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2R1",6)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2R2",7)

"BLD",5130,"KRN",9.8,"NM","B","PXRMG2S1",8)

"BLD",5130,"KRN",9.8,"NM","B","PXRMGECP",9)

"BLD",5130,"KRN",19,0)
19
"BLD",5130,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5130,"KRN",19,"NM",1,0)
PXRM GEC2 QUARTERLY ROLLUP^^0
"BLD",5130,"KRN",19,"NM","B","PXRM GEC2 QUARTERLY ROLLUP",1)

"BLD",5130,"KRN",19.1,0)
19.1
"BLD",5130,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5130,"KRN",101,0)
101
"BLD",5130,"KRN",409.61,0)
409.61
"BLD",5130,"KRN",771,0)
771
"BLD",5130,"KRN",870,0)
870
"BLD",5130,"KRN",8989.51,0)
8989.51
"BLD",5130,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",5130,"KRN",8989.52,0)
8989.52
"BLD",5130,"KRN",8994,0)
8994
"BLD",5130,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",5130,"KRN","B",.4,.4)

"BLD",5130,"KRN","B",.401,.401)

"BLD",5130,"KRN","B",.402,.402)

"BLD",5130,"KRN","B",.403,.403)

"BLD",5130,"KRN","B",.5,.5)

"BLD",5130,"KRN","B",.84,.84)

"BLD",5130,"KRN","B",3.6,3.6)

"BLD",5130,"KRN","B",3.8,3.8)

"BLD",5130,"KRN","B",9.2,9.2)

"BLD",5130,"KRN","B",9.8,9.8)

"BLD",5130,"KRN","B",19,19)

"BLD",5130,"KRN","B",19.1,19.1)

"BLD",5130,"KRN","B",101,101)

"BLD",5130,"KRN","B",409.61,409.61)

"BLD",5130,"KRN","B",771,771)

"BLD",5130,"KRN","B",870,870)

"BLD",5130,"KRN","B",8989.51,8989.51)

"BLD",5130,"KRN","B",8989.52,8989.52)

"BLD",5130,"KRN","B",8994,8994)

"BLD",5130,"PRE")

"BLD",5130,"QUES",0)
^9.62^^
"BLD",5130,"REQB",0)
^9.611^^0
"INIT")
POST^PXRMG2M1
"KRN",3.8,199,-1)
0^1
"KRN",3.8,199,0)
GEC2 NATIONAL ROLLUP^PU^y^^^^
"KRN",3.8,199,3)

"KRN",3.8,199,6,0)
^3.812^8^4
"KRN",3.8,199,6,1,0)
VAUGHN.SMITH@MED.VA.GOV
"KRN",3.8,199,6,6,0)
patrick.brady@E2K.HQ.MED.VA.GOV
"KRN",3.8,199,6,7,0)
daniel.schoeps@E2K.HQ.MED.VA.GOV
"KRN",3.8,199,6,8,0)
CHERYL.LEIFERMAN2@MED.VA.GOV
"KRN",3.8,199,6,"B","CHERYL.LEIFERMAN2@MED.VA.GOV",8)

"KRN",3.8,199,6,"B","VAUGHN.SMITH@MED.VA.GOV",1)

"KRN",3.8,199,6,"B","daniel.schoeps@E2K.HQ.MED.VA.G",7)

"KRN",3.8,199,6,"B","patrick.brady@E2K.HQ.MED.VA.GO",6)

"KRN",19,9654,-1)
0^1
"KRN",19,9654,0)
PXRM GEC2 QUARTERLY ROLLUP^GEC Fiscal Quarterly Rollup^^R^^^^^^^^CLINICAL REMINDERS
"KRN",19,9654,1,0)
^^3^3^3050216^
"KRN",19,9654,1,1,0)
This is a queuable option that will send quarterly information to
"KRN",19,9654,1,2,0)
Washington DC. It should be set for the 5th day of the first month
"KRN",19,9654,1,3,0)
of the next quarter and requeued "3M" every 3 months.
"KRN",19,9654,25)
START^PXRMG2M1
"KRN",19,9654,"U")
GEC FISCAL QUARTERLY ROLLUP
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",364,-1)
1^1
"PKG",364,0)
CLINICAL REMINDERS^PXRM^Clinical Reminders^^^3011030
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
2.0^3050204
"PKG",364,22,1,"PAH",1,0)
2^3050315
"PKG",364,22,1,"PAH",1,1,0)
^^1^1^3050315
"PKG",364,22,1,"PAH",1,1,1,0)
See description in the national patch module under patch PXRM*2*2.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PXRMG2E1")
0^1^B47935634
"RTN","PXRMG2E1",1,0)
PXRMG2E1 ;SLC/JVS -GEC #2 Extract initial arrays  ;2/13/05  20:08
"RTN","PXRMG2E1",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2E1",3,0)
 Q
"RTN","PXRMG2E1",4,0)
 ;
"RTN","PXRMG2E1",5,0)
 ;Arrays
"RTN","PXRMG2E1",6,0)
 ;^TMP("PXRMGEC",$J,    = Root Reference
"RTN","PXRMG2E1",7,0)
 ;"REF",DATE,DFN)       = Number of HF in Referral
"RTN","PXRMG2E1",8,0)
 ;"REFDFN",DFN)         = Number of Referrals per Patient
"RTN","PXRMG2E1",9,0)
 ;"HS"                  = Heath Summary Array
"RTN","PXRMG2E1",10,0)
 Q
"RTN","PXRMG2E1",11,0)
GEC ;Get ien for GEC Date Sources
"RTN","PXRMG2E1",12,0)
 S (GEC1DA,GEC2DA,GEC3DA,GECFDA)=0
"RTN","PXRMG2E1",13,0)
 S GECFDA=$O(^PX(839.7,"B","GECF",0))
"RTN","PXRMG2E1",14,0)
 S GEC1DA=$O(^PX(839.7,"B","GEC1",0))
"RTN","PXRMG2E1",15,0)
 S GEC2DA=$O(^PX(839.7,"B","GEC2",0))
"RTN","PXRMG2E1",16,0)
 S GEC3DA=$O(^PX(839.7,"B","GEC3",0))
"RTN","PXRMG2E1",17,0)
 Q
"RTN","PXRMG2E1",18,0)
 ;
"RTN","PXRMG2E1",19,0)
RANG(BDT,EDT,VDT,SDT,CHK) ;Dates are in date range
"RTN","PXRMG2E1",20,0)
 ;S=start date F=finished date
"RTN","PXRMG2E1",21,0)
 N OK,SOK,FOK
"RTN","PXRMG2E1",22,0)
 S (SOK,FOK,OK)=0
"RTN","PXRMG2E1",23,0)
 I CHK["S" D
"RTN","PXRMG2E1",24,0)
 .S:($P(SDT,".",1)'<(BDT))&($P(SDT,".",1)'>(EDT)) SOK=1
"RTN","PXRMG2E1",25,0)
 I CHK["F" D
"RTN","PXRMG2E1",26,0)
 .S:($P(VDT,".",1)'<(BDT))&($P(VDT,".",1)'>(EDT)) FOK=1
"RTN","PXRMG2E1",27,0)
 S OK=$S(SOK=1:1,FOK=1:1,1:0)
"RTN","PXRMG2E1",28,0)
 I CHK["SF"&(SOK+FOK'=2) S OK=0
"RTN","PXRMG2E1",29,0)
 Q OK
"RTN","PXRMG2E1",30,0)
 ;
"RTN","PXRMG2E1",31,0)
FIN(DATE,DFN) ;Check to see if finished
"RTN","PXRMG2E1",32,0)
 N GEC,DA,VST,VDT,DONE
"RTN","PXRMG2E1",33,0)
 S DONE=0,VDT="0000000"
"RTN","PXRMG2E1",34,0)
 S GEC=0 F  S GEC=$O(^AUPNVHF("AED",DATE,DFN,GEC)) Q:GEC=""  D
"RTN","PXRMG2E1",35,0)
 .I GEC=GECFDA S DONE=1 D
"RTN","PXRMG2E1",36,0)
 ..S DA=$O(^AUPNVHF("AED",DATE,DFN,GEC,0))
"RTN","PXRMG2E1",37,0)
 ..S VST=$P($G(^AUPNVHF(DA,0)),"^",3)
"RTN","PXRMG2E1",38,0)
 ..S VDT=$P($G(^AUPNVSIT(VST,0)),"^",1)
"RTN","PXRMG2E1",39,0)
 Q DONE_"^"_VDT
"RTN","PXRMG2E1",40,0)
 ;
"RTN","PXRMG2E1",41,0)
E(ARY,FIN,BDT,EDT,CHK,DFNONLY,TPAT) ;EXTRACT GEC REFERRALS
"RTN","PXRMG2E1",42,0)
 N DATE,GEC,DFN,DA,DFNX,DATEX,ZALL,CNTREF,COMPLETE
"RTN","PXRMG2E1",43,0)
 N REFERAL,REFERA,LOCA,LOCN,LOC,DOC,DOCT,DOCTN,DOCTNA
"RTN","PXRMG2E1",44,0)
 N DOCTOR,DR,DONE,VDT,FLAG,DTCHK,DATE1,DFN1,DATEY,DFNXX
"RTN","PXRMG2E1",45,0)
 N GEC1DA,GEC2DA,GEC3DA,GECFDA,DFNFLAG
"RTN","PXRMG2E1",46,0)
 N TMPDFN,TMPDOC,TMPDT,TMPLOC
"RTN","PXRMG2E1",47,0)
 ;====================================================
"RTN","PXRMG2E1",48,0)
 K ^TMP("PXRMGEC",$J,"REF"),^TMP("PXRMGEC",$J,"REFDFN")
"RTN","PXRMG2E1",49,0)
 ;====================================================
"RTN","PXRMG2E1",50,0)
 ;Callers Responsibility to Kill the Array
"RTN","PXRMG2E1",51,0)
 ;(ARY,FIN,BDT,EDT,CHK,DFNONLY)
"RTN","PXRMG2E1",52,0)
 ;EXAMPLE FOR HEALTH SUMMARY
"RTN","PXRMG2E1",53,0)
 ;D E^PXRMGECV("HS",2,3020509,3030609,"S",0)
"RTN","PXRMG2E1",54,0)
 ;Parameters
"RTN","PXRMG2E1",55,0)
 ;S ARY="HS"
"RTN","PXRMG2E1",56,0)
 ;Array to Create HS,DT,DFN,DOC,LOC,HFCD
"RTN","PXRMG2E1",57,0)
 ;S FIN=0
"RTN","PXRMG2E1",58,0)
 ;finished referrals 1=finished 0=unfinished 2=Both ""=finished
"RTN","PXRMG2E1",59,0)
 ;S BDT=3020509 Begin Date
"RTN","PXRMG2E1",60,0)
 ;S EDT=3030609 End Date
"RTN","PXRMG2E1",61,0)
 ;S CHK="S"
"RTN","PXRMG2E1",62,0)
 ;Check dates S=Start date Default F=Final date for date range
"RTN","PXRMG2E1",63,0)
 ;S DFNONLY=0
"RTN","PXRMG2E1",64,0)
 ; DFN of patient 0 or all
"RTN","PXRMG2E1",65,0)
 ;=====================================================
"RTN","PXRMG2E1",66,0)
 ;Count of Referrals
"RTN","PXRMG2E1",67,0)
 S CNTREF=0
"RTN","PXRMG2E1",68,0)
 D GEC ;get iens for the GECF VARIABLES
"RTN","PXRMG2E1",69,0)
 ;==============
"RTN","PXRMG2E1",70,0)
 D WORK
"RTN","PXRMG2E1",71,0)
 Q
"RTN","PXRMG2E1",72,0)
WORK ;
"RTN","PXRMG2E1",73,0)
 S DATE1=0,DFN1=0
"RTN","PXRMG2E1",74,0)
 S DATE=BDT F  S DATE=$O(^AUPNVHF("AED",DATE)) Q:DATE=""  Q:DATE>(EDT+1)  D
"RTN","PXRMG2E1",75,0)
 .S DFN="" F  S DFN=$O(^AUPNVHF("AED",DATE,DFN)) Q:DFN=""  D
"RTN","PXRMG2E1",76,0)
 ..I $D(TPAT) I TPAT=0 Q:$$TESTPAT^VADPT(DFN)
"RTN","PXRMG2E1",77,0)
 ..S COMPLETE=$$FIN(DATE,DFN),DONE=+COMPLETE,VDT=$P(COMPLETE,"^",2)
"RTN","PXRMG2E1",78,0)
 ..Q:FIN=1&(DONE=0)
"RTN","PXRMG2E1",79,0)
 ..Q:FIN=0&(DONE=1)
"RTN","PXRMG2E1",80,0)
 ..Q:'$$RANG(BDT,EDT,VDT,DATE,CHK)
"RTN","PXRMG2E1",81,0)
 ..;
"RTN","PXRMG2E1",82,0)
PAT ..;===Check Patient DFN to see if continue or quit
"RTN","PXRMG2E1",83,0)
 ..S DFNFLAG=1 I DFNONLY>0 D  Q:DFNFLAG=0
"RTN","PXRMG2E1",84,0)
 ...I $D(DFNARY)&('$D(DFNARY(DFN))) S DFNFLAG=0
"RTN","PXRMG2E1",85,0)
 ...I '$D(DFNARY)&(DFN'=DFNONLY) S DFNFLAG=0
"RTN","PXRMG2E1",86,0)
 ...;======
"RTN","PXRMG2E1",87,0)
 ...;
"RTN","PXRMG2E1",88,0)
 ..S GEC="" F  S GEC=$O(^AUPNVHF("AED",DATE,DFN,GEC)) Q:GEC=""  D
"RTN","PXRMG2E1",89,0)
 ...Q:GEC'=GECFDA&(GEC'=GEC1DA)&(GEC'=GEC2DA)&(GEC'=GEC3DA)
"RTN","PXRMG2E1",90,0)
 ...S DFNXX=$P($G(^DPT(DFN,0)),"^",1)_" "_$P($G(^DPT(DFN,0)),"^",9)
"RTN","PXRMG2E1",91,0)
 ...S DATEY=$$FMTE^XLFDT(DATE,"1P")
"RTN","PXRMG2E1",92,0)
 ...I $D(^TMP("PXRMGEC",$J,"REF",DATE,DFN)) S ^TMP("PXRMGEC",$J,"REF",DATE,DFN)=$G(^TMP("PXRMGEC",$J,"REF",DATE,DFN))+1
"RTN","PXRMG2E1",93,0)
 ...E  S ^TMP("PXRMGEC",$J,"REF",DATE,DFN)=1
"RTN","PXRMG2E1",94,0)
 ...;TO HERE BY REFERRAL
"RTN","PXRMG2E1",95,0)
 ...S DA="" F  S DA=$O(^AUPNVHF("AED",DATE,DFN,GEC,DA)) Q:DA=""  D
"RTN","PXRMG2E1",96,0)
 ....;TO HERE BY HEALTH FACTOR
"RTN","PXRMG2E1",97,0)
 ....D VDOC(DA,.VDOC,.LOCB)
"RTN","PXRMG2E1",98,0)
 Q
"RTN","PXRMG2E1",99,0)
KILL ;Kill out unwanted Arrays
"RTN","PXRMG2E1",100,0)
 K ^TMP("PXRMGEC",$J,"REF"),^TMP("PXRMGEC",$J,"REFDFN")
"RTN","PXRMG2E1",101,0)
 Q
"RTN","PXRMG2E1",102,0)
VDOC(DA,VDOC,LOCB) ;Get Dr's and location according to Visit
"RTN","PXRMG2E1",103,0)
 Q:ARY="CTD"
"RTN","PXRMG2E1",104,0)
 Q:ARY="CTP"
"RTN","PXRMG2E1",105,0)
 ;
"RTN","PXRMG2E1",106,0)
 S VDOC("UNKNOWN",DA)=""
"RTN","PXRMG2E1",107,0)
 Q:DA=""
"RTN","PXRMG2E1",108,0)
 Q:'$D(^AUPNVHF(DA))
"RTN","PXRMG2E1",109,0)
 S VDOC("UNKNOWN")=1
"RTN","PXRMG2E1",110,0)
 S VST=$P($G(^AUPNVHF(DA,0)),"^",3)
"RTN","PXRMG2E1",111,0)
 S DOC="" F  S DOC=$O(^AUPNVPRV("AD",VST,DOC)) Q:DOC=""  D
"RTN","PXRMG2E1",112,0)
 .K VDOC("UNKNOWN")
"RTN","PXRMG2E1",113,0)
 .S DOCT=$P($G(^AUPNVPRV(DOC,0)),"^",1)
"RTN","PXRMG2E1",114,0)
 .S DOCTN=$$GET1^DIQ(200,DOCT,.01)
"RTN","PXRMG2E1",115,0)
 .;S ^TMP("PXRMGEC",$J,"REFDOC",DOCTN,VDT,DOCT)=""
"RTN","PXRMG2E1",116,0)
 .I $D(VDOC(DOCTN,VDT)) S VDOC(DOCTN,VDT)=$G(VDOC(DOCTN,VDT))+1
"RTN","PXRMG2E1",117,0)
 .E  S VDOC(DOCTN,VDT)=1
"RTN","PXRMG2E1",118,0)
 .;DBIA #10040 However the ability for the Visit to store a pointer
"RTN","PXRMG2E1",119,0)
 .;to the location file might be removed in the future.
"RTN","PXRMG2E1",120,0)
 .S LOC=$P($G(^AUPNVSIT(VST,0)),"^",22)
"RTN","PXRMG2E1",121,0)
 .S LOCN=$P($G(^SC(LOC,0)),"^",1)
"RTN","PXRMG2E1",122,0)
 .;S ^TMP("PXRMGEC",$J,"REFLOC",LOCN,VDT)=""
"RTN","PXRMG2E1",123,0)
 .I DONE=1 D
"RTN","PXRMG2E1",124,0)
 ..K TMPDT(DATEY,DFNXX,DOCTN,LOCN)
"RTN","PXRMG2E1",125,0)
 ..K TMPDFN(DFNXX,DATEY,DOCTN,LOCN)
"RTN","PXRMG2E1",126,0)
 ..K TMPDOC(DOCTN,LOCN,DATEY,DFNXX)
"RTN","PXRMG2E1",127,0)
 ..K TMPLOC(LOCN,DOCTN,DATEY,DFNXX)
"RTN","PXRMG2E1",128,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDT",DATEY,DFNXX,DOCTN,LOCN)
"RTN","PXRMG2E1",129,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDFN",DFNXX,DATEY,DOCTN,LOCN)
"RTN","PXRMG2E1",130,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDOC",DOCTN,LOCN,DATEY,DFNXX)
"RTN","PXRMG2E1",131,0)
 ..K ^TMP("PXRMGEC",$J,"TMPLOC",LOCN,DOCTN,DATEY,DFNXX)
"RTN","PXRMG2E1",132,0)
 .;===============================================================
"RTN","PXRMG2E1",133,0)
 .;CHeck for new Referral
"RTN","PXRMG2E1",134,0)
 .I DATE1'=DATE!(DFN1'=DFN) S CNTREF=CNTREF+1,DATE1=DATE,DFN1=DFN
"RTN","PXRMG2E1",135,0)
 .;===============================================================
"RTN","PXRMG2E1",136,0)
 .I ARY="HS" D
"RTN","PXRMG2E1",137,0)
 ..;CNTREF=Count or numbered Referral
"RTN","PXRMG2E1",138,0)
 ..;DFN   =Patient IEN
"RTN","PXRMG2E1",139,0)
 ..;DATE  =Starting Date of Referral
"RTN","PXRMG2E1",140,0)
 ..;VDT   =Finished Date of Referral-Visit of GECF
"RTN","PXRMG2E1",141,0)
 ..;CAT   =Health Factor Category
"RTN","PXRMG2E1",142,0)
 ..;DATEV =Date that each Dialog was done
"RTN","PXRMG2E1",143,0)
 ..;DA    =Ien of each Health Factor
"RTN","PXRMG2E1",144,0)
 ..;
"RTN","PXRMG2E1",145,0)
 ..N NAMEDA,NAME,CATDA,CAT,DATEV,DATEDA,AGE,PXRMAPT,AGEF,SSN
"RTN","PXRMG2E1",146,0)
 ..;DBIA #11
"RTN","PXRMG2E1",147,0)
 ..;---AGE---
"RTN","PXRMG2E1",148,0)
 ..D GETS^DIQ(2,DFN,.033,"ER","AGE")
"RTN","PXRMG2E1",149,0)
 ..S AGE=AGE(2,DFN_",","AGE","E")
"RTN","PXRMG2E1",150,0)
 ..S AGEF=0 I AGE>74 S AGEF=1
"RTN","PXRMG2E1",151,0)
 ..;---SSN---"M3456"
"RTN","PXRMG2E1",152,0)
 ..D GETS^DIQ(2,DFN,.0905,"ER","SSN")
"RTN","PXRMG2E1",153,0)
 ..S SSN=SSN(2,DFN_",","1U4N","E")
"RTN","PXRMG2E1",154,0)
 ..;---APPOINTMENTS---
"RTN","PXRMG2E1",155,0)
 ..;DBIA #3859
"RTN","PXRMG2E1",156,0)
 ..S PXRMAPT=0
"RTN","PXRMG2E1",157,0)
 ..D GETAPPT^SDAMA201(DFN,"1","R",$$FMADD^XLFDT(VDT,-365,0,0,0),VDT,.PXRMAPT,"")
"RTN","PXRMG2E1",158,0)
 ..K ^TMP($J,"SDAMA201","GETAPPT")
"RTN","PXRMG2E1",159,0)
 ..;---APPOINTMENTS---
"RTN","PXRMG2E1",160,0)
 ..S NAMEDA=$P($G(^AUPNVHF(DA,0)),"^",1)
"RTN","PXRMG2E1",161,0)
 ..;GET COMMENTS
"RTN","PXRMG2E1",162,0)
 ..S NAME=$P($G(^AUTTHF(NAMEDA,0)),"^",1)
"RTN","PXRMG2E1",163,0)
 ..S DATEDA=$P($G(^AUPNVHF(DA,0)),"^",3)
"RTN","PXRMG2E1",164,0)
 ..S DATEV=$P($G(^AUPNVSIT(DATEDA,0)),"^",1)
"RTN","PXRMG2E1",165,0)
 ..S CATDA=$P($G(^AUTTHF(NAMEDA,0)),"^",3)
"RTN","PXRMG2E1",166,0)
 ..S CAT=$P($G(^AUTTHF(CATDA,0)),"^",1)
"RTN","PXRMG2E1",167,0)
 ..;S ^TMP("PXRMGEC",$J,"HS",CNTREF,DFN,DATE,VDT,CAT,DATEV,DA)=""
"RTN","PXRMG2E1",168,0)
 ..S ^TMP("PXRMGEC",$J,"GEC2",CNTREF,NAMEDA,AGEF,PXRMAPT,DFN,+$E($P(VDT,"."),4,5),SSN,VDT)=""
"RTN","PXRMG2E1",169,0)
 ..K AGE
"RTN","PXRMG2E1",170,0)
 .;===============================================================
"RTN","PXRMG2E1",171,0)
 S DOCT=$P($G(^AUPNVHF(DA,12)),"^",4)
"RTN","PXRMG2E1",172,0)
 I DOCT>0 D
"RTN","PXRMG2E1",173,0)
 .Q:ARY="LOC"
"RTN","PXRMG2E1",174,0)
 .Q:ARY="DR"
"RTN","PXRMG2E1",175,0)
 .Q:ARY="HS1"
"RTN","PXRMG2E1",176,0)
 .Q:ARY="HS"
"RTN","PXRMG2E1",177,0)
 .Q:ARY="HFCD"
"RTN","PXRMG2E1",178,0)
 .S DOCTN=$$GET1^DIQ(200,DOCT,.01)
"RTN","PXRMG2E1",179,0)
 .I $D(VDOC(DA,DOCTN,DA)) S VDOC(DA,DOCTN,DA)=$G(VDOC(DA,DOCTN,DA))+1
"RTN","PXRMG2E1",180,0)
 .E  S VDOC(DA,DOCTN,DA)=1
"RTN","PXRMG2E1",181,0)
 .I DONE=1 D
"RTN","PXRMG2E1",182,0)
 ..K TMPDT(DATEY,DFNXX,DOCTN,LOCN)
"RTN","PXRMG2E1",183,0)
 ..K TMPDFN(DFNXX,DATEY,DOCTN,LOCN)
"RTN","PXRMG2E1",184,0)
 ..K TMPDOC(DOCTN,LOCN,DATEY,DFNXX)
"RTN","PXRMG2E1",185,0)
 ..K TMPLOC(LOCN,DOCTN,DATEY,DFNXX)
"RTN","PXRMG2E1",186,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDT",DATEY,DFNXX,DOCTN,LOCN)
"RTN","PXRMG2E1",187,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDFN",DFNXX,DATEY,DOCTN,LOCN)
"RTN","PXRMG2E1",188,0)
 ..K ^TMP("PXRMGEC",$J,"TMPDOC",DOCTN,LOCN,DATEY,DFNXX)
"RTN","PXRMG2E1",189,0)
 ..K ^TMP("PXRMGEC",$J,"TMPLOC",LOCN,DOCTN,DATEY,DFNXX)
"RTN","PXRMG2E1",190,0)
 .;==========================
"RTN","PXRMG2E1",191,0)
 .;CHeck for new Referral
"RTN","PXRMG2E1",192,0)
 .I DATE1'=DATE!(DFN1'=DFN) S CNTREF=CNTREF+1,DATE1=DATE,DFN1=DFN
"RTN","PXRMG2E1",193,0)
 .;==========================
"RTN","PXRMG2E1",194,0)
 Q
"RTN","PXRMG2E1",195,0)
 ;
"RTN","PXRMG2E2")
0^2^B38330452
"RTN","PXRMG2E2",1,0)
PXRMG2E2 ;SLC/JVS -GEC #2 EXTRACT #2  ;2/13/05  20:08
"RTN","PXRMG2E2",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2E2",3,0)
 Q
"RTN","PXRMG2E2",4,0)
 ;
"RTN","PXRMG2E2",5,0)
 ;Variables
"RTN","PXRMG2E2",6,0)
 ;CNTREF=The unique counted Referral number
"RTN","PXRMG2E2",7,0)
 ;DA    =DA or Ien of the Health Factor
"RTN","PXRMG2E2",8,0)
 ;REF   =REFERRAL NUMBER
"RTN","PXRMG2E2",9,0)
 ;ARY   =Array that is ordering through
"RTN","PXRMG2E2",10,0)
 Q
"RTN","PXRMG2E2",11,0)
EN ;Entry Point
"RTN","PXRMG2E2",12,0)
 ;SEND IN
"RTN","PXRMG2E2",13,0)
 ;BDT,EDT,QUARTER
"RTN","PXRMG2E2",14,0)
 ;-----TEMPORARY-----
"RTN","PXRMG2E2",15,0)
 K ^TMP("PXRMGEC",$J)
"RTN","PXRMG2E2",16,0)
 ;-----TEMPORARY-----
"RTN","PXRMG2E2",17,0)
 N CR1,CR2,CR3,CR4,CRITER,FOUND,CNT,ARY
"RTN","PXRMG2E2",18,0)
 N M1,M2,M3,BDTEDT
"RTN","PXRMG2E2",19,0)
 ;---TEMPORARY
"RTN","PXRMG2E2",20,0)
 ;S QUARTER=1
"RTN","PXRMG2E2",21,0)
 ;---TEMORARY
"RTN","PXRMG2E2",22,0)
 S CRITER=0,FOUND=0,CNT=0
"RTN","PXRMG2E2",23,0)
 D PROGRAM^PXRMG2E4,CRITER4^PXRMG2E3
"RTN","PXRMG2E2",24,0)
 I $D(YEAR),$D(QUARTER) D
"RTN","PXRMG2E2",25,0)
 .S BDTEDT=$$FMDATE(YEAR,QUARTER)
"RTN","PXRMG2E2",26,0)
 .S BDT=$P(BDTEDT,"^",1)
"RTN","PXRMG2E2",27,0)
 .S EDT=$P(BDTEDT,"^",2)
"RTN","PXRMG2E2",28,0)
 ;
"RTN","PXRMG2E2",29,0)
 D E^PXRMG2E1("HS",1,BDT,EDT,"F",DFNONLY,TPAT)
"RTN","PXRMG2E2",30,0)
 K VDOC
"RTN","PXRMG2E2",31,0)
 ;This creates the following array besides the HS array
"RTN","PXRMG2E2",32,0)
 ;TMP("PXRMGEC",$J,"GEC2",CNTREF,DA,AGE FLAG,APPOINTMENTS,MONTH)=""
"RTN","PXRMG2E2",33,0)
 ;
"RTN","PXRMG2E2",34,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2E2",35,0)
 S REF=0 F  S REF=$O(@ARY@(REF)) Q:REF<1  D
"RTN","PXRMG2E2",36,0)
 .I QUARTER=1 S M1=1,M2=2,M3=3
"RTN","PXRMG2E2",37,0)
 .I QUARTER=2 S M1=4,M2=5,M3=6
"RTN","PXRMG2E2",38,0)
 .I QUARTER=3 S M1=7,M2=8,M3=9
"RTN","PXRMG2E2",39,0)
 .I QUARTER=4 S M1=10,M2=11,M3=12
"RTN","PXRMG2E2",40,0)
 .D PRE(REF)
"RTN","PXRMG2E2",41,0)
 D POST
"RTN","PXRMG2E2",42,0)
 Q
"RTN","PXRMG2E2",43,0)
 ;======================================
"RTN","PXRMG2E2",44,0)
FMDATE(YEAR,QUARTER) ;Get BDT and EDT from year and quarter
"RTN","PXRMG2E2",45,0)
 Q:YEAR=""
"RTN","PXRMG2E2",46,0)
 Q:QUARTER=""
"RTN","PXRMG2E2",47,0)
 Q:QUARTER>4
"RTN","PXRMG2E2",48,0)
 Q:QUARTER=0
"RTN","PXRMG2E2",49,0)
 N YER,QAR,BDT,EDT
"RTN","PXRMG2E2",50,0)
 S YER=YEAR-1700
"RTN","PXRMG2E2",51,0)
 I QUARTER=1 S BDT=YER_"0101",EDT=YER_"0331"
"RTN","PXRMG2E2",52,0)
 I QUARTER=2 S BDT=YER_"0401",EDT=YER_"0630"
"RTN","PXRMG2E2",53,0)
 I QUARTER=3 S BDT=YER_"0701",EDT=YER_"0930"
"RTN","PXRMG2E2",54,0)
 I QUARTER=4 S BDT=YER_"1001",EDT=YER_"1231"
"RTN","PXRMG2E2",55,0)
 Q BDT_"^"_EDT
"RTN","PXRMG2E2",56,0)
 ;======================================
"RTN","PXRMG2E2",57,0)
GET(REF) ;Get Criteria
"RTN","PXRMG2E2",58,0)
 N DFN,MONTH,NAME,SSN,PROG
"RTN","PXRMG2E2",59,0)
 S (CR1,CR2,CR3,CR4,CRITER)=0
"RTN","PXRMG2E2",60,0)
 S CR1=$$C1^PXRMG2S1(REF)
"RTN","PXRMG2E2",61,0)
 S CR2=$$C2^PXRMG2S1(REF)
"RTN","PXRMG2E2",62,0)
 S CR3=$$C3^PXRMG2S1(REF)
"RTN","PXRMG2E2",63,0)
 S CR4=$$C4^PXRMG2S1(REF)
"RTN","PXRMG2E2",64,0)
 S DFN=$P(CR4,"^",2)
"RTN","PXRMG2E2",65,0)
 S MONTH=$P(CR4,"^",3)
"RTN","PXRMG2E2",66,0)
 S NAME=$P(^DPT(DFN,0),"^",1)
"RTN","PXRMG2E2",67,0)
 S SSN=$P(CR4,"^",4)
"RTN","PXRMG2E2",68,0)
 S DATE=$P(CR4,"^",5)
"RTN","PXRMG2E2",69,0)
 S PROG=$P(CR4,"^",6)
"RTN","PXRMG2E2",70,0)
 S CR4=+CR4
"RTN","PXRMG2E2",71,0)
 I CR1=1 S CRITER="1"
"RTN","PXRMG2E2",72,0)
 I CR2=1 S CRITER=$S(CRITER=0:2,1:CRITER_",2")
"RTN","PXRMG2E2",73,0)
 I CR3=1 S CRITER=$S(CRITER=0:3,1:CRITER_",3")
"RTN","PXRMG2E2",74,0)
 I CR4=1 S CRITER=$S(CRITER=0:4,1:CRITER_",4")
"RTN","PXRMG2E2",75,0)
 S ^TMP("PXRMGEC",$J,"GEC2","RPT",NAME,SSN,DATE,CRITER,PROG)=""
"RTN","PXRMG2E2",76,0)
 Q CRITER
"RTN","PXRMG2E2",77,0)
 ;
"RTN","PXRMG2E2",78,0)
PRE(REF) ;Pre Process array by Program and Month
"RTN","PXRMG2E2",79,0)
 N ARY
"RTN","PXRMG2E2",80,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2E2",81,0)
 I $D(@ARY@(REF,$O(P441(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2E2",82,0)
 .S @ARY@("ADHC",$$MONTH(REF,ARY),REF,$$PIECE($$GET(REF)))=$$GET(REF)
"RTN","PXRMG2E2",83,0)
 I $D(@ARY@(REF,$O(P4410(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2E2",84,0)
 .S @ARY@("HHHA",$$MONTH(REF,ARY),REF,$$PIECE($$GET(REF)))=$$GET(REF)
"RTN","PXRMG2E2",85,0)
 I $D(@ARY@(REF,$O(P4412(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2E2",86,0)
 .S @ARY@("VAIHR",$$MONTH(REF,ARY),REF,$$PIECE($$GET(REF)))=$$GET(REF)
"RTN","PXRMG2E2",87,0)
 I $D(@ARY@(REF,$O(P451(0)))),$D(@ARY@(REF,$O(P452(0)))) D
"RTN","PXRMG2E2",88,0)
 .S @ARY@("CC",$$MONTH(REF,ARY),REF,$$PIECE($$GET(REF)))=$$GET(REF)
"RTN","PXRMG2E2",89,0)
 Q
"RTN","PXRMG2E2",90,0)
 ;
"RTN","PXRMG2E2",91,0)
MONTH(REF,ARY) ;Get month out of array
"RTN","PXRMG2E2",92,0)
 Q:REF=""
"RTN","PXRMG2E2",93,0)
 Q:ARY=""
"RTN","PXRMG2E2",94,0)
 N IEN,AGE,APP,DFN,MON
"RTN","PXRMG2E2",95,0)
 S IEN=$O(@ARY@(REF,0))
"RTN","PXRMG2E2",96,0)
 S AGE=$O(@ARY@(REF,IEN,-1))
"RTN","PXRMG2E2",97,0)
 S APP=$O(@ARY@(REF,IEN,AGE,-1))
"RTN","PXRMG2E2",98,0)
 S DFN=$O(@ARY@(REF,IEN,AGE,APP,0))
"RTN","PXRMG2E2",99,0)
 S MON=$O(@ARY@(REF,IEN,AGE,APP,DFN,0))
"RTN","PXRMG2E2",100,0)
 Q MON
"RTN","PXRMG2E2",101,0)
 ;
"RTN","PXRMG2E2",102,0)
PIECE(CRITER) ;Get the piece in the array the criter goes into
"RTN","PXRMG2E2",103,0)
 N PIECE
"RTN","PXRMG2E2",104,0)
 I CRITER=0 S PIECE=5
"RTN","PXRMG2E2",105,0)
 I CRITER=1 S PIECE=6
"RTN","PXRMG2E2",106,0)
 I CRITER=2 S PIECE=7
"RTN","PXRMG2E2",107,0)
 I CRITER=3 S PIECE=8
"RTN","PXRMG2E2",108,0)
 I CRITER=4 S PIECE=9
"RTN","PXRMG2E2",109,0)
 I CRITER="1,2" S PIECE=10
"RTN","PXRMG2E2",110,0)
 I CRITER="1,3" S PIECE=11
"RTN","PXRMG2E2",111,0)
 I CRITER="1,4" S PIECE=12
"RTN","PXRMG2E2",112,0)
 I CRITER="2,3" S PIECE=13
"RTN","PXRMG2E2",113,0)
 I CRITER="2,4" S PIECE=14
"RTN","PXRMG2E2",114,0)
 I CRITER="3,4" S PIECE=15
"RTN","PXRMG2E2",115,0)
 I CRITER="1,2,3" S PIECE=16
"RTN","PXRMG2E2",116,0)
 I CRITER="1,2,4" S PIECE=17
"RTN","PXRMG2E2",117,0)
 I CRITER="1,3,4" S PIECE=18
"RTN","PXRMG2E2",118,0)
 I CRITER="2,3,4" S PIECE=19
"RTN","PXRMG2E2",119,0)
 I CRITER="1,2,3,4" S PIECE=20
"RTN","PXRMG2E2",120,0)
 Q PIECE
"RTN","PXRMG2E2",121,0)
 ;
"RTN","PXRMG2E2",122,0)
POST ;Set the Statistical Arrays
"RTN","PXRMG2E2",123,0)
 D START
"RTN","PXRMG2E2",124,0)
 N PROG,MON,REF,PIE,MONX,SITE,STOP,ARY,X,Y
"RTN","PXRMG2E2",125,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2E2",126,0)
 S PROG="ADH" F  S PROG=$O(@ARY@(PROG)) Q:PROG=""  D
"RTN","PXRMG2E2",127,0)
 .S MON=0 F  S MON=$O(@ARY@(PROG,MON)) Q:MON=""  D
"RTN","PXRMG2E2",128,0)
 ..Q:MON'=M1&(MON'=M2)&(MON'=M3)
"RTN","PXRMG2E2",129,0)
 ..S CNT=0
"RTN","PXRMG2E2",130,0)
 ..S REF=0 F  S REF=$O(@ARY@(PROG,MON,REF)) Q:REF=""  D
"RTN","PXRMG2E2",131,0)
 ...S CNT=CNT+1
"RTN","PXRMG2E2",132,0)
 ...S PIE=0 F  S PIE=$O(@ARY@(PROG,MON,REF,PIE)) Q:PIE=""  D
"RTN","PXRMG2E2",133,0)
 ....I MON=1!(MON=4)!(MON=7)!(MON=10) S MONX=1
"RTN","PXRMG2E2",134,0)
 ....I MON=2!(MON=5)!(MON=8)!(MON=11) S MONX=2
"RTN","PXRMG2E2",135,0)
 ....I MON=3!(MON=6)!(MON=9)!(MON=12) S MONX=3
"RTN","PXRMG2E2",136,0)
 ....S Y=$P($G(STAT(PROG,MONX)),",",PIE)
"RTN","PXRMG2E2",137,0)
 ....S Y=Y+1,$P(STAT(PROG,MONX),",",PIE)=Y
"RTN","PXRMG2E2",138,0)
 ....S $P(STAT(PROG,MONX),",",2)=MON
"RTN","PXRMG2E2",139,0)
 ....S $P(STAT(PROG,MONX),",",4)=CNT
"RTN","PXRMG2E2",140,0)
 Q
"RTN","PXRMG2E2",141,0)
 ;
"RTN","PXRMG2E2",142,0)
START ; Start the STAT(PROG,MON) ARRAYS
"RTN","PXRMG2E2",143,0)
 N I,SITE,F,S,T
"RTN","PXRMG2E2",144,0)
 I QUARTER=1 S F=1,S=2,T=3
"RTN","PXRMG2E2",145,0)
 I QUARTER=2 S F=4,S=5,T=6
"RTN","PXRMG2E2",146,0)
 I QUARTER=3 S F=7,S=8,T=9
"RTN","PXRMG2E2",147,0)
 I QUARTER=4 S F=10,S=11,T=12
"RTN","PXRMG2E2",148,0)
 S SITE=$P($$SITE^VASITE,"^",3)
"RTN","PXRMG2E2",149,0)
 F I=1:1:3 S STAT("ADHC",I)=SITE_",,"_"ADHC"_",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0" D
"RTN","PXRMG2E2",150,0)
 .I I=1 S $P(STAT("ADHC",I),",",2)=F
"RTN","PXRMG2E2",151,0)
 .I I=2 S $P(STAT("ADHC",I),",",2)=S
"RTN","PXRMG2E2",152,0)
 .I I=3 S $P(STAT("ADHC",I),",",2)=T
"RTN","PXRMG2E2",153,0)
 F I=1:1:3 S STAT("HHHA",I)=SITE_",,"_"HHHA"_",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0" D
"RTN","PXRMG2E2",154,0)
 .I I=1 S $P(STAT("HHHA",I),",",2)=F
"RTN","PXRMG2E2",155,0)
 .I I=2 S $P(STAT("HHHA",I),",",2)=S
"RTN","PXRMG2E2",156,0)
 .I I=3 S $P(STAT("HHHA",I),",",2)=T
"RTN","PXRMG2E2",157,0)
 F I=1:1:3 S STAT("CC",I)=SITE_",,"_"CC"_",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0" D
"RTN","PXRMG2E2",158,0)
 .I I=1 S $P(STAT("CC",I),",",2)=F
"RTN","PXRMG2E2",159,0)
 .I I=2 S $P(STAT("CC",I),",",2)=S
"RTN","PXRMG2E2",160,0)
 .I I=3 S $P(STAT("CC",I),",",2)=T
"RTN","PXRMG2E2",161,0)
 F I=1:1:3 S STAT("VAIHR",I)=SITE_",,"_"VAIHR"_",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0" D
"RTN","PXRMG2E2",162,0)
 .I I=1 S $P(STAT("VAIHR",I),",",2)=F
"RTN","PXRMG2E2",163,0)
 .I I=2 S $P(STAT("VAIHR",I),",",2)=S
"RTN","PXRMG2E2",164,0)
 .I I=3 S $P(STAT("VAIHR",I),",",2)=T
"RTN","PXRMG2E2",165,0)
 Q
"RTN","PXRMG2E2",166,0)
WRITE ;Write to screen the STAT array
"RTN","PXRMG2E2",167,0)
 N PROG,MON
"RTN","PXRMG2E2",168,0)
 W !,"An Email containing this information will be sent to all those who are listed"
"RTN","PXRMG2E2",169,0)
 W !,"in the ""G.GEC2 NATIONAL ROLLUP"" mail group",!
"RTN","PXRMG2E2",170,0)
 S PROG="AD" F  S PROG=$O(STAT(PROG)) Q:PROG=""  D
"RTN","PXRMG2E2",171,0)
 .S MON=0 F  S MON=$O(STAT(PROG,MON)) Q:MON=""  D
"RTN","PXRMG2E2",172,0)
 ..W !,$G(STAT(PROG,MON))
"RTN","PXRMG2E2",173,0)
 W !!,"The above information is a statistical compilation of the"
"RTN","PXRMG2E2",174,0)
 W !,"information seen in the local view of this option."
"RTN","PXRMG2E2",175,0)
 W !!,"Thanks in advance",!!
"RTN","PXRMG2E2",176,0)
 D MAIL^PXRMG2M1
"RTN","PXRMG2E2",177,0)
 D EXIT
"RTN","PXRMG2E2",178,0)
 Q
"RTN","PXRMG2E2",179,0)
 ;=================================================
"RTN","PXRMG2E2",180,0)
EXIT ;Exit and Clean up Variables
"RTN","PXRMG2E2",181,0)
 K C1101,C1107,C1108
"RTN","PXRMG2E2",182,0)
 K C1410,C1412,C1414,C142,C144,C146,C148,C166,C171
"RTN","PXRMG2E2",183,0)
 K C2110,C2114,C2118,C212,C2120,C216,C218,C221,C224,C226
"RTN","PXRMG2E2",184,0)
 K C2710,C272,C274,C276,C278,C286
"RTN","PXRMG2E2",185,0)
 K P441,P4410,P4412,P449,P451,P452
"RTN","PXRMG2E2",186,0)
 K STAT
"RTN","PXRMG2E2",187,0)
 Q
"RTN","PXRMG2E3")
0^3^B4625411
"RTN","PXRMG2E3",1,0)
PXRMG2E3 ;SLC/JVS -GEC #2 EXTRACT #3  ;2/13/05  20:08
"RTN","PXRMG2E3",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2E3",3,0)
 Q
"RTN","PXRMG2E3",4,0)
 ;
"RTN","PXRMG2E3",5,0)
CRITER4 ; Extracts the IEN for the health factors that represents
"RTN","PXRMG2E3",6,0)
 ; the 3 IADL'S
"RTN","PXRMG2E3",7,0)
 I $D(^AUTTHF("B","GEC DIFFICULT TRANSPORTATION/LAST 7D-YES")) D
"RTN","PXRMG2E3",8,0)
 .S C142($O(^AUTTHF("B","GEC DIFFICULT TRANSPORTATION/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",9,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY MANAGING MEDS/LAST 7D-YES")) D
"RTN","PXRMG2E3",10,0)
 .S C144($O(^AUTTHF("B","GEC DIFFICULTY MANAGING MEDS/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",11,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY MNG FINANCES/LAST 7D-YES")) D
"RTN","PXRMG2E3",12,0)
 .S C146($O(^AUTTHF("B","GEC DIFFICULTY MNG FINANCES/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",13,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY PREPARE MEALS/LAST 7D-YES")) D
"RTN","PXRMG2E3",14,0)
 .S C148($O(^AUTTHF("B","GEC DIFFICULTY PREPARE MEALS/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",15,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY USING PHONE/LAST 7D-YES")) D
"RTN","PXRMG2E3",16,0)
 .S C1410($O(^AUTTHF("B","GEC DIFFICULTY USING PHONE/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",17,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY W/ HOUSEWORK/LAST 7D-YES")) D
"RTN","PXRMG2E3",18,0)
 .S C1412($O(^AUTTHF("B","GEC DIFFICULTY W/ HOUSEWORK/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",19,0)
 I $D(^AUTTHF("B","GEC DIFFICULTY WITH SHOPPING/LAST 7D-YES")) D
"RTN","PXRMG2E3",20,0)
 .S C1414($O(^AUTTHF("B","GEC DIFFICULTY WITH SHOPPING/LAST 7D-YES",0)))=""
"RTN","PXRMG2E3",21,0)
 I $D(^AUTTHF("B","GEC COMMUNITY NRSNG HOME (REFERRED FROM)")) D
"RTN","PXRMG2E3",22,0)
 .S C1101($O(^AUTTHF("B","GEC COMMUNITY NRSNG HOME (REFERRED FROM)",0)))=""
"RTN","PXRMG2E3",23,0)
 I $D(^AUTTHF("B","GEC VA DOMICILIARY (REFERRED FROM)")) D
"RTN","PXRMG2E3",24,0)
 .S C1107($O(^AUTTHF("B","GEC VA DOMICILIARY (REFERRED FROM)",0)))=""
"RTN","PXRMG2E3",25,0)
 I $D(^AUTTHF("B","GEC VA NURSING HOME")) D
"RTN","PXRMG2E3",26,0)
 .S C1108($O(^AUTTHF("B","GEC VA NURSING HOME",0)))=""
"RTN","PXRMG2E3",27,0)
 I $D(^AUTTHF("B","GEC ALONE")) D
"RTN","PXRMG2E3",28,0)
 .S C171($O(^AUTTHF("B","GEC ALONE",0)))=""
"RTN","PXRMG2E3",29,0)
 I $D(^AUTTHF("B","GEC NURSING HOME")) D
"RTN","PXRMG2E3",30,0)
 .S C166($O(^AUTTHF("B","GEC NURSING HOME",0)))=""
"RTN","PXRMG2E3",31,0)
 ;
"RTN","PXRMG2E3",32,0)
 Q
"RTN","PXRMG2E3",33,0)
 ;Continued in..
"RTN","PXRMG2E4")
0^4^B11134068
"RTN","PXRMG2E4",1,0)
PXRMG2E4 ;SLC/JVS -GEC #2 EXTRACT #4  ;2/13/05  20:07
"RTN","PXRMG2E4",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2E4",3,0)
 Q
"RTN","PXRMG2E4",4,0)
 ;
"RTN","PXRMG2E4",5,0)
 Q
"RTN","PXRMG2E4",6,0)
PROGRAM ; Extracts the IEN for the health factors that represents
"RTN","PXRMG2E4",7,0)
 ; each of the home health programs.
"RTN","PXRMG2E4",8,0)
 I $D(^AUTTHF("B","GEC ADULT DAY HEALTH CARE (REFERRED TO)")) D
"RTN","PXRMG2E4",9,0)
 .S P441($O(^AUTTHF("B","GEC ADULT DAY HEALTH CARE (REFERRED TO)",0)))=""
"RTN","PXRMG2E4",10,0)
 I $D(^AUTTHF("B","GEC HOMECARE FUNDING-VA")) D
"RTN","PXRMG2E4",11,0)
 .S P449($O(^AUTTHF("B","GEC HOMECARE FUNDING-VA",0)))=""
"RTN","PXRMG2E4",12,0)
 I $D(^AUTTHF("B","GEC HOMEMAKER/HOME HEALTH AIDE")) D
"RTN","PXRMG2E4",13,0)
 .S P4410($O(^AUTTHF("B","GEC HOMEMAKER/HOME HEALTH AIDE",0)))=""
"RTN","PXRMG2E4",14,0)
 I $D(^AUTTHF("B","GEC VA IN-HOME RESPITE")) D
"RTN","PXRMG2E4",15,0)
 .S P4412($O(^AUTTHF("B","GEC VA IN-HOME RESPITE",0)))=""
"RTN","PXRMG2E4",16,0)
 I $D(^AUTTHF("B","GEC HOME TELEHEALTH (REFERRED TO)")) D
"RTN","PXRMG2E4",17,0)
 .S P451($O(^AUTTHF("B","GEC HOME TELEHEALTH (REFERRED TO)",0)))=""
"RTN","PXRMG2E4",18,0)
 I $D(^AUTTHF("B","GEC TELEHEALTH FUNDING-VA")) D
"RTN","PXRMG2E4",19,0)
 .S P452($O(^AUTTHF("B","GEC TELEHEALTH FUNDING-VA",0)))=""
"RTN","PXRMG2E4",20,0)
 ;
"RTN","PXRMG2E4",21,0)
CRITER1 ; Extracts the IEN for the health factors that represents
"RTN","PXRMG2E4",22,0)
 ; the 8 ADL's
"RTN","PXRMG2E4",23,0)
 I $D(^AUTTHF("B","GEC BATHING HELP/SUPERVISION LAST 7D-YES")) D
"RTN","PXRMG2E4",24,0)
 .S C212($O(^AUTTHF("B","GEC BATHING HELP/SUPERVISION LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",25,0)
 I $D(^AUTTHF("B","GEC BED POSITIONING HELP LAST 7D-YES")) D
"RTN","PXRMG2E4",26,0)
 .S C216($O(^AUTTHF("B","GEC BED POSITIONING HELP LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",27,0)
 I $D(^AUTTHF("B","GEC DRESS HELP/SUPERVISION LAST 7D-YES")) D
"RTN","PXRMG2E4",28,0)
 .S C218($O(^AUTTHF("B","GEC DRESS HELP/SUPERVISION LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",29,0)
 I $D(^AUTTHF("B","GEC EATING HELP/SUPERVISION LAST 7D-YES")) D
"RTN","PXRMG2E4",30,0)
 .S C2110($O(^AUTTHF("B","GEC EATING HELP/SUPERVISION LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",31,0)
 I $D(^AUTTHF("B","GEC MOVING AROUND INDOORS LAST 7D-YES")) D
"RTN","PXRMG2E4",32,0)
 .S C2114($O(^AUTTHF("B","GEC MOVING AROUND INDOORS LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",33,0)
 I $D(^AUTTHF("B","GEC TOILET HELP/SUPERVISION LAST 7D-YES")) D
"RTN","PXRMG2E4",34,0)
 .S C2118($O(^AUTTHF("B","GEC TOILET HELP/SUPERVISION LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",35,0)
 I $D(^AUTTHF("B","GEC TRANSFERS HELP/SPRVISION LAST 7D-YES")) D
"RTN","PXRMG2E4",36,0)
 .S C2120($O(^AUTTHF("B","GEC TRANSFERS HELP/SPRVISION LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",37,0)
 ;
"RTN","PXRMG2E4",38,0)
CRITER2 ; Extracts the IEN for the health factors that represents
"RTN","PXRMG2E4",39,0)
 ; the 8 "SIGNIFICANT COGNITIVE IMPARIMENT"
"RTN","PXRMG2E4",40,0)
 I $D(^AUTTHF("B","GEC CAN BE UNDERSTOOD LAST 7D-NO")) D
"RTN","PXRMG2E4",41,0)
 .S C221($O(^AUTTHF("B","GEC CAN BE UNDERSTOOD LAST 7D-NO",0)))=""
"RTN","PXRMG2E4",42,0)
 I $D(^AUTTHF("B","GEC ENDANGERED SAFETY LAST 90D-YES")) D
"RTN","PXRMG2E4",43,0)
 .S C224($O(^AUTTHF("B","GEC ENDANGERED SAFETY LAST 90D-YES",0)))=""
"RTN","PXRMG2E4",44,0)
 I $D(^AUTTHF("B","GEC MADE REASONABLE DECISIONS LAST 7D-NO")) D
"RTN","PXRMG2E4",45,0)
 .S C226($O(^AUTTHF("B","GEC MADE REASONABLE DECISIONS LAST 7D-NO",0)))=""
"RTN","PXRMG2E4",46,0)
 I $D(^AUTTHF("B","GEC HALLUCINATIONS/DELUSIONS LAST 7D-YES")) D
"RTN","PXRMG2E4",47,0)
 .S C272($O(^AUTTHF("B","GEC HALLUCINATIONS/DELUSIONS LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",48,0)
 I $D(^AUTTHF("B","GEC PHYSICALLY ABUSIVE LAST 7D-YES")) D
"RTN","PXRMG2E4",49,0)
 .S C274($O(^AUTTHF("B","GEC PHYSICALLY ABUSIVE LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",50,0)
 I $D(^AUTTHF("B","GEC RESISTS CARE LAST 7D-YES")) D
"RTN","PXRMG2E4",51,0)
 .S C276($O(^AUTTHF("B","GEC RESISTS CARE LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",52,0)
 I $D(^AUTTHF("B","GEC VERBALLY ABUSIVE LAST 7D-YES")) D
"RTN","PXRMG2E4",53,0)
 .S C278($O(^AUTTHF("B","GEC VERBALLY ABUSIVE LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",54,0)
 I $D(^AUTTHF("B","GEC WANDERING LAST 7D-YES")) D
"RTN","PXRMG2E4",55,0)
 .S C2710($O(^AUTTHF("B","GEC WANDERING LAST 7D-YES",0)))=""
"RTN","PXRMG2E4",56,0)
 ;
"RTN","PXRMG2E4",57,0)
CRITER3 ; Extracts the IEN for the health factors that represents
"RTN","PXRMG2E4",58,0)
 ; the 1 "Life expectancy < 6 months"
"RTN","PXRMG2E4",59,0)
 I $D(^AUTTHF("B","GEC LIFE EXPECTANCY < 6MO-YES")) D
"RTN","PXRMG2E4",60,0)
 .S C286($O(^AUTTHF("B","GEC LIFE EXPECTANCY < 6MO-YES",0)))=""
"RTN","PXRMG2E4",61,0)
 ;
"RTN","PXRMG2E4",62,0)
 ;S NCRITER(0)=0
"RTN","PXRMG2E4",63,0)
 ;S NCRITER(1)=0
"RTN","PXRMG2E4",64,0)
 ;S NCRITER(2)=0
"RTN","PXRMG2E4",65,0)
 ;S NCRITER(3)=0
"RTN","PXRMG2E4",66,0)
 ;S NCRITER(4)=0
"RTN","PXRMG2E4",67,0)
 ;S NCRITER("1,2")=0
"RTN","PXRMG2E4",68,0)
 ;S NCRITER("1,3")=0
"RTN","PXRMG2E4",69,0)
 ;S NCRITER("1,4")=0
"RTN","PXRMG2E4",70,0)
 ;S NCRITER("2,3")=0
"RTN","PXRMG2E4",71,0)
 ;S NCRITER("2,4")=0
"RTN","PXRMG2E4",72,0)
 ;S NCRITER("3,4")=0
"RTN","PXRMG2E4",73,0)
 ;S NCRITER("1,2,3")=0
"RTN","PXRMG2E4",74,0)
 ;S NCRITER("1,2,4")=0
"RTN","PXRMG2E4",75,0)
 ;S NCRITER("1,3,4")=0
"RTN","PXRMG2E4",76,0)
 ;S NCRITER("2,3,4")=0
"RTN","PXRMG2E4",77,0)
 ;S NCRITER("1,2,3,4")=0
"RTN","PXRMG2E4",78,0)
 ;Continued in PXRMG2E3
"RTN","PXRMG2M1")
0^5^B20412738
"RTN","PXRMG2M1",1,0)
PXRMG2M1 ;SLC/JVS -GEC #2 MAIL MESSAGES ;2/13/05  20:07
"RTN","PXRMG2M1",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2M1",3,0)
 Q
"RTN","PXRMG2M1",4,0)
 ;=================================================
"RTN","PXRMG2M1",5,0)
TASK ;Start queued option PXRM GEC QUARTERLY ROLLUP
"RTN","PXRMG2M1",6,0)
 Q:'$D(DT)
"RTN","PXRMG2M1",7,0)
 D CALCMON
"RTN","PXRMG2M1",8,0)
 D EN^PXRMG2E2
"RTN","PXRMG2M1",9,0)
 D MAIL
"RTN","PXRMG2M1",10,0)
 Q
"RTN","PXRMG2M1",11,0)
START ;Start queued option PXRM GEC QUARTERLY ROLLUP
"RTN","PXRMG2M1",12,0)
 Q:'$D(DT)
"RTN","PXRMG2M1",13,0)
 D CALC
"RTN","PXRMG2M1",14,0)
 D EN^PXRMG2E2
"RTN","PXRMG2M1",15,0)
 D MAIL
"RTN","PXRMG2M1",16,0)
 Q
"RTN","PXRMG2M1",17,0)
MAIL ;MAIL OUT the STAT array
"RTN","PXRMG2M1",18,0)
 N SITE,XMZ,XMY,XMSUB,XMDUZ,SITE2
"RTN","PXRMG2M1",19,0)
 S XMSUB="GEC FISCAL QUARTER "_FQUARTER_" "_YEAR_" Rollup Data"
"RTN","PXRMG2M1",20,0)
 I DT<3050401 S XMSUB="TEST DATA-- "_XMSUB
"RTN","PXRMG2M1",21,0)
 S SITE=$P($$SITE^VASITE,"^",2)_" #"_$P($$SITE^VASITE,"^",3)
"RTN","PXRMG2M1",22,0)
 S SITE2=$P($$SITE^VASITE,"^",3)_" "_$P($$SITE^VASITE,"^",2)
"RTN","PXRMG2M1",23,0)
 S XMDUZ=SITE2_" GEC Rollup Data"
"RTN","PXRMG2M1",24,0)
RETRY D XMZ^XMA2
"RTN","PXRMG2M1",25,0)
 I XMZ<1 G RETRY
"RTN","PXRMG2M1",26,0)
 ;
"RTN","PXRMG2M1",27,0)
 N PROG,MON,L,LINE,MGIEN,MGROUP
"RTN","PXRMG2M1",28,0)
 S L=0
"RTN","PXRMG2M1",29,0)
 S PROG="AD" F  S PROG=$O(STAT(PROG)) Q:PROG=""  D
"RTN","PXRMG2M1",30,0)
 .S MON=0 F  S MON=$O(STAT(PROG,MON)) Q:MON=""  D
"RTN","PXRMG2M1",31,0)
 ..S L=L+1
"RTN","PXRMG2M1",32,0)
 ..S ^XMB(3.9,XMZ,2,L,0)=$G(STAT(PROG,MON))
"RTN","PXRMG2M1",33,0)
 ;
"RTN","PXRMG2M1",34,0)
 I L>10 D
"RTN","PXRMG2M1",35,0)
 .F I=(L+1):1:14 S ^XMB(3.9,XMZ,2,I,0)=$P($T(TEXT+(I-12)),";",3)
"RTN","PXRMG2M1",36,0)
 .S ^XMB(3.9,XMZ,2,15,0)="data from "_SITE_" for Fiscal Quarter # "_FQUARTER_" of "_YEAR_". (Calendar Quarter "_QUARTER_")"
"RTN","PXRMG2M1",37,0)
 .S L=15 F I=(L+1):1:55 S ^XMB(3.9,XMZ,2,I,0)=$P($T(TEXT+(I-12)),";",3)
"RTN","PXRMG2M1",38,0)
 .;
"RTN","PXRMG2M1",39,0)
 .S ^XMB(3.9,XMZ,2,0)="^3.92^"_I_"^"_I_"^"_DT
"RTN","PXRMG2M1",40,0)
 .S XMDUZ="GEC Project"
"RTN","PXRMG2M1",41,0)
 .I $$PROD^XUPROD(1) S XMY("G.GEC2 NATIONAL ROLLUP")=""
"RTN","PXRMG2M1",42,0)
 .S MGIEN=$G(^PXRM(800,1,"MGFE"))
"RTN","PXRMG2M1",43,0)
 .I MGIEN'="" D
"RTN","PXRMG2M1",44,0)
 ..S MGROUP="G."_$$GET1^DIQ(3.8,MGIEN,.01)
"RTN","PXRMG2M1",45,0)
 ..S XMY(MGROUP)=""
"RTN","PXRMG2M1",46,0)
 .D ENT1^XMD
"RTN","PXRMG2M1",47,0)
 .D EXIT
"RTN","PXRMG2M1",48,0)
 Q
"RTN","PXRMG2M1",49,0)
TEXT ;Text added to the bottom of the mail message
"RTN","PXRMG2M1",50,0)
 ;13;
"RTN","PXRMG2M1",51,0)
 ;14;   The above information is Geriatric Extended Care "Home" Referral
"RTN","PXRMG2M1",52,0)
 ;15;
"RTN","PXRMG2M1",53,0)
 ;16;-------------------------------------------------
"RTN","PXRMG2M1",54,0)
 ;17;   Each section of data is separated by a comma. The table below
"RTN","PXRMG2M1",55,0)
 ;18;defines the sections. Numbers represent Patients. Patient only counted once.
"RTN","PXRMG2M1",56,0)
 ;19;
"RTN","PXRMG2M1",57,0)
 ;20;  1 Number for the site.
"RTN","PXRMG2M1",58,0)
 ;21;  2 Number that stands for the Month (1=January)...
"RTN","PXRMG2M1",59,0)
 ;22;  3 Acronym for the Program (ADHC,HHHA,VAIHR,CC)
"RTN","PXRMG2M1",60,0)
 ;23;  4 Total number of patients referred to the program that month
"RTN","PXRMG2M1",61,0)
 ;24;  5 Number that DID NOT MEET ANY of the criteria
"RTN","PXRMG2M1",62,0)
 ;25;  6 Number that only met criteria 1
"RTN","PXRMG2M1",63,0)
 ;26;  7 Number that only met criteria 2
"RTN","PXRMG2M1",64,0)
 ;27;  8 Number that only met criteria 3
"RTN","PXRMG2M1",65,0)
 ;28;  9 Number that only met criteria 4
"RTN","PXRMG2M1",66,0)
 ;29; 10 Number that only met both criteria's 1 and 2
"RTN","PXRMG2M1",67,0)
 ;30; 11 Number that only met both criteria's 1 and 3
"RTN","PXRMG2M1",68,0)
 ;31; 12 Number that only met both criteria's 1 and 4
"RTN","PXRMG2M1",69,0)
 ;32; 13 Number that only met both criteria's 2 and 3
"RTN","PXRMG2M1",70,0)
 ;34; 14 Number that only met both criteria's 2 and 4
"RTN","PXRMG2M1",71,0)
 ;35; 15 Number that only met both criteria's 3 and 4
"RTN","PXRMG2M1",72,0)
 ;36; 16 Number that only met the criteria's 1 and 2 and 3
"RTN","PXRMG2M1",73,0)
 ;37; 17 Number that only met the criteria's 1 and 2 and 4
"RTN","PXRMG2M1",74,0)
 ;38; 18 Number that only met the criteria's 1 and 3 and 4
"RTN","PXRMG2M1",75,0)
 ;39; 19 Number that only met the criteria's 2 and 3 and 4
"RTN","PXRMG2M1",76,0)
 ;40; 20 Number that met all criteria's, 1 and 2 and 3 and 4
"RTN","PXRMG2M1",77,0)
 ;41;
"RTN","PXRMG2M1",78,0)
 ;42;--------------------------------------------------
"RTN","PXRMG2M1",79,0)
 ;43;The Basic Criteria for Eligibility is shown below.
"RTN","PXRMG2M1",80,0)
 ;44;
"RTN","PXRMG2M1",81,0)
 ;45; 1: Problems with 3 or more ADL's.
"RTN","PXRMG2M1",82,0)
 ;46; 2: 1 or more patient behavior or cognitive problem.
"RTN","PXRMG2M1",83,0)
 ;47; 3: Expected life limit of less than 6 months.
"RTN","PXRMG2M1",84,0)
 ;48; 4: Combination of the following:
"RTN","PXRMG2M1",85,0)
 ;49;      2 or more ADL dependencies.
"RTN","PXRMG2M1",86,0)
 ;50;      <AND> 2 or more of the following:
"RTN","PXRMG2M1",87,0)
 ;51;            problems with 3 or more IADL's.
"RTN","PXRMG2M1",88,0)
 ;52;      <OR> age of patients is 75 or more.
"RTN","PXRMG2M1",89,0)
 ;53;      <OR> living alone in the community.
"RTN","PXRMG2M1",90,0)
 ;54;      <OR> utilizes the clinics 12 or more times in the
"RTN","PXRMG2M1",91,0)
 ;55;           preceding 12 months.
"RTN","PXRMG2M1",92,0)
 ;============================================
"RTN","PXRMG2M1",93,0)
EXIT ;Exit and Clean up Variables
"RTN","PXRMG2M1",94,0)
 Q
"RTN","PXRMG2M1",95,0)
CALC ;Calculate the quarter number
"RTN","PXRMG2M1",96,0)
 N MON,YER,CQTR,BCQTR,BQTR,BYER,FQTR
"RTN","PXRMG2M1",97,0)
 S MON=+$E(DT,4,5),YER=1700+$E(DT,1,3)
"RTN","PXRMG2M1",98,0)
 ;
"RTN","PXRMG2M1",99,0)
 I MON=1!(MON=2)!(MON=3) S CQTR=1
"RTN","PXRMG2M1",100,0)
 I MON=4!(MON=5)!(MON=6) S CQTR=2
"RTN","PXRMG2M1",101,0)
 I MON=7!(MON=8)!(MON=9) S CQTR=3
"RTN","PXRMG2M1",102,0)
 I MON=10!(MON=11)!(MON=12) S CQTR=4
"RTN","PXRMG2M1",103,0)
 ;
"RTN","PXRMG2M1",104,0)
 I CQTR=1 S BYER=YER-1
"RTN","PXRMG2M1",105,0)
 E  S BYER=YER
"RTN","PXRMG2M1",106,0)
 I CQTR=1 S BQTR=4
"RTN","PXRMG2M1",107,0)
 E  S BQTR=CQTR-1
"RTN","PXRMG2M1",108,0)
 ;
"RTN","PXRMG2M1",109,0)
 I BQTR=1 S FQTR=2
"RTN","PXRMG2M1",110,0)
 I BQTR=2 S FQTR=3
"RTN","PXRMG2M1",111,0)
 I BQTR=3 S FQTR=4
"RTN","PXRMG2M1",112,0)
 I BQTR=4 S FQTR=1
"RTN","PXRMG2M1",113,0)
 S QUARTER=BQTR,FQUARTER=FQTR,YEAR=BYER,DFNONLY=0
"RTN","PXRMG2M1",114,0)
 ;After april 1 2005 no test patients
"RTN","PXRMG2M1",115,0)
 I DT>3050331 S TPAT=0
"RTN","PXRMG2M1",116,0)
 E  S TPAT=1
"RTN","PXRMG2M1",117,0)
 Q
"RTN","PXRMG2M1",118,0)
 ;
"RTN","PXRMG2M1",119,0)
CALCMON ;Calculate the quarter number for current quarter
"RTN","PXRMG2M1",120,0)
 N MON,YER,CQTR,BQTR,BCQTR,BYER,FQTR
"RTN","PXRMG2M1",121,0)
 S MON=+$E(DT,4,5),YER=1700+$E(DT,1,3)
"RTN","PXRMG2M1",122,0)
 ;
"RTN","PXRMG2M1",123,0)
 I MON=1!(MON=2)!(MON=3) S CQTR=1
"RTN","PXRMG2M1",124,0)
 I MON=4!(MON=5)!(MON=6) S CQTR=2
"RTN","PXRMG2M1",125,0)
 I MON=7!(MON=8)!(MON=9) S CQTR=3
"RTN","PXRMG2M1",126,0)
 I MON=10!(MON=11)!(MON=12) S CQTR=4
"RTN","PXRMG2M1",127,0)
 ;
"RTN","PXRMG2M1",128,0)
 I CQTR=1 S BYER=YER
"RTN","PXRMG2M1",129,0)
 E  S BYER=YER
"RTN","PXRMG2M1",130,0)
 I CQTR=1 S BQTR=1
"RTN","PXRMG2M1",131,0)
 E  S BQTR=BCQTR
"RTN","PXRMG2M1",132,0)
 ;
"RTN","PXRMG2M1",133,0)
 I BQTR=1 S FQTR=2
"RTN","PXRMG2M1",134,0)
 I BQTR=2 S FQTR=3
"RTN","PXRMG2M1",135,0)
 I BQTR=3 S FQTR=4
"RTN","PXRMG2M1",136,0)
 I BQTR=4 S FQTR=1
"RTN","PXRMG2M1",137,0)
 ;
"RTN","PXRMG2M1",138,0)
 S QUARTER=BQTR,FQUARTER=FQTR,YEAR=BYER,DFNONLY=0
"RTN","PXRMG2M1",139,0)
 ;After april 1 2005 no test patients
"RTN","PXRMG2M1",140,0)
 I DT>3050331 S TPAT=0
"RTN","PXRMG2M1",141,0)
 E  S TPAT=1
"RTN","PXRMG2M1",142,0)
 S ZTREQ="@"
"RTN","PXRMG2M1",143,0)
 ;
"RTN","PXRMG2M1",144,0)
 Q
"RTN","PXRMG2M1",145,0)
POST ;Post installation routine
"RTN","PXRMG2M1",146,0)
 ;add remote members to mail group
"RTN","PXRMG2M1",147,0)
 D ADDMBRS^XMXAPIG(DUZ,"GEC2 NATIONAL ROLLUP","VAUGHN.SMITH@MED.VA.GOV")
"RTN","PXRMG2M1",148,0)
 D ADDMBRS^XMXAPIG(DUZ,"GEC2 NATIONAL ROLLUP","patrick.brady@e2k.hq.med.va.gov")
"RTN","PXRMG2M1",149,0)
 D ADDMBRS^XMXAPIG(DUZ,"GEC2 NATIONAL ROLLUP","daniel.schoeps@e2k.hq.med.va.gov")
"RTN","PXRMG2M1",150,0)
 ;
"RTN","PXRMG2M1",151,0)
TASKRPT ;This will task a monthy report for 4 month.
"RTN","PXRMG2M1",152,0)
 ;May 8th 2005,June 8th 2005,AUG 8th 2005,Sept 8th 2005
"RTN","PXRMG2M1",153,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,MON,ZTREQ,ZTSK
"RTN","PXRMG2M1",154,0)
 S MON=0
"RTN","PXRMG2M1",155,0)
 Q:$D(^TMP("PXRMG2TSK"))
"RTN","PXRMG2M1",156,0)
 F ZTDTH="3050408.0200","3050608.0200","3050808.0200","3050908.0200" D
"RTN","PXRMG2M1",157,0)
 .S MON=MON+1
"RTN","PXRMG2M1",158,0)
 .I MON=1 S MONTH="MAY"
"RTN","PXRMG2M1",159,0)
 .I MON=2 S MONTH="JUNE"
"RTN","PXRMG2M1",160,0)
 .I MON=3 S MONTH="AUGUST"
"RTN","PXRMG2M1",161,0)
 .I MON=4 S MONTH="SEPT"
"RTN","PXRMG2M1",162,0)
 .S ZTRTN="TASK^PXRMG2M1"
"RTN","PXRMG2M1",163,0)
 .S ZTDESC=MONTH_" 2005 GEC National Report"
"RTN","PXRMG2M1",164,0)
 .S ZTIO=""
"RTN","PXRMG2M1",165,0)
 .D ^%ZTLOAD
"RTN","PXRMG2M1",166,0)
 .D BMES^XPDUTL(MONTH_" 8th's GEC Tasked Job number "_ZTSK)
"RTN","PXRMG2M1",167,0)
 S ^TMP("PXRMG2TSK",$J)="DT"
"RTN","PXRMG2M1",168,0)
CLEAN ;Clean up after previous builds
"RTN","PXRMG2M1",169,0)
 K ^PXRMD(801.5,"ATASK")
"RTN","PXRMG2M1",170,0)
 Q
"RTN","PXRMG2R1")
0^6^B25023497
"RTN","PXRMG2R1",1,0)
PXRMG2R1 ;SLC/JVS -GEC #2 REPORT #1  ;2/13/05  20:06
"RTN","PXRMG2R1",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2R1",3,0)
 Q
"RTN","PXRMG2R1",4,0)
EN ;Entry Point for Local Report
"RTN","PXRMG2R1",5,0)
 N NAME,ARY,SSN,CRITER,DATE,DATEF,NAME2
"RTN","PXRMG2R1",6,0)
 N CRP1,CRP2,CRP3,CRP4,CRP5,CNT,PROG
"RTN","PXRMG2R1",7,0)
 S (CRP1,CRP2,CRP3,CRP4,CRP5)=""
"RTN","PXRMG2R1",8,0)
 D EN^PXRMG2E2
"RTN","PXRMG2R1",9,0)
 W @IOF
"RTN","PXRMG2R1",10,0)
 W "============================================================================="
"RTN","PXRMG2R1",11,0)
 W !,"Referred to Homemaker/Home Health Aide(HHHA) or Adult Day Health Care(ADHC)"
"RTN","PXRMG2R1",12,0)
 W !,"or VA In-Home Respite(VAIHR) or Care Coordination programs(CC)"
"RTN","PXRMG2R1",13,0)
 W !,"From: "_$$FMTE^XLFDT(BDT,"5ZM")_" To: "_$$FMTE^XLFDT(EDT,"5ZM")
"RTN","PXRMG2R1",14,0)
 W !,"Fiscal Quarter: "_FQUARTER_" (Calendar Quarter "_QUARTER_")"
"RTN","PXRMG2R1",15,0)
 W !,?39,"    Criteria ",?65,"Measured"
"RTN","PXRMG2R1",16,0)
 W !,"Name",?25,"SSN",?32,"Prog.",?39,"0",?42,"#1",?45,"#2",?48,"#3",?51,"#4",?54,"Date",?65,"Criteria"
"RTN","PXRMG2R1",17,0)
 W !,"============================================================================="
"RTN","PXRMG2R1",18,0)
 W ! D PB Q:Y=0
"RTN","PXRMG2R1",19,0)
 S CNT=0
"RTN","PXRMG2R1",20,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"",""RPT"")"
"RTN","PXRMG2R1",21,0)
 S NAME="" F  S NAME=$O(@ARY@(NAME)) Q:NAME=""  D
"RTN","PXRMG2R1",22,0)
 .S CNT=1
"RTN","PXRMG2R1",23,0)
 .S SSN="" F  S SSN=$O(@ARY@(NAME,SSN)) Q:SSN=""  D
"RTN","PXRMG2R1",24,0)
 ..S DATE=""  F  S DATE=$O(@ARY@(NAME,SSN,DATE)) Q:DATE=""  D
"RTN","PXRMG2R1",25,0)
 ...S DATEF=$$FMTE^XLFDT(DATE,"5ZM")
"RTN","PXRMG2R1",26,0)
 ...S CRITER="" F  S CRITER=$O(@ARY@(NAME,SSN,DATE,CRITER)) Q:CRITER=""  D
"RTN","PXRMG2R1",27,0)
 ....I CRITER=0 S CRP1="X"
"RTN","PXRMG2R1",28,0)
 ....I CRITER[1 S CRP2="X"
"RTN","PXRMG2R1",29,0)
 ....I CRITER[2 S CRP3="X"
"RTN","PXRMG2R1",30,0)
 ....I CRITER[3 S CRP4="X"
"RTN","PXRMG2R1",31,0)
 ....I CRITER[4 S CRP5="X"
"RTN","PXRMG2R1",32,0)
 ....S PROG=$O(@ARY@(NAME,SSN,DATE,CRITER,""))
"RTN","PXRMG2R1",33,0)
 ....I $D(XYZ) S NAME2="CPRS PATIENT "_$E(SSN,4,5)
"RTN","PXRMG2R1",34,0)
 ....W !,$S($D(XYZ):NAME2,1:NAME),?25,SSN,?32,PROG,?39,CRP1,?42,CRP2,?45,CRP3,?48,CRP4,?51,CRP5,?54,$P(DATEF,"@",1),?65,$S(CRP1="X":"Not Met",1:"")
"RTN","PXRMG2R1",35,0)
 ....S (CRP1,CRP2,CRP3,CRP4,CRP5)=""
"RTN","PXRMG2R1",36,0)
 ....D PB Q:Y=0
"RTN","PXRMG2R1",37,0)
 I CNT=0 W !,"     < NO PATIENT DATA FOUND >",!
"RTN","PXRMG2R1",38,0)
 W ! D PB Q:Y=0
"RTN","PXRMG2R1",39,0)
 W !,"Criteria" D PB Q:Y=0
"RTN","PXRMG2R1",40,0)
 W !,"0: Not eligible under any criteria." D PB Q:Y=0
"RTN","PXRMG2R1",41,0)
 W !,"1: Problems with 3 or more ADL's." D PB Q:Y=0
"RTN","PXRMG2R1",42,0)
 W !,"2: 1 or more patient behavior or cognitive problem." D PB Q:Y=0
"RTN","PXRMG2R1",43,0)
 W !,"3: Expected life limit of less than 6 months." D PB Q:Y=0
"RTN","PXRMG2R1",44,0)
 W !,"4: Combination of the following:" D PB Q:Y=0
"RTN","PXRMG2R1",45,0)
 W !,"   2 or more ADL dependencies" D PB Q:Y=0
"RTN","PXRMG2R1",46,0)
 W !,"   <AND> 2 or more of the following:" D PB Q:Y=0
"RTN","PXRMG2R1",47,0)
 W !,"          Problems with 3 or more IADL's" D PB Q:Y=0
"RTN","PXRMG2R1",48,0)
 W !,"     <OR> age of patients is 75 or more." D PB Q:Y=0
"RTN","PXRMG2R1",49,0)
 W !,"     <OR> living alone in the community." D PB Q:Y=0
"RTN","PXRMG2R1",50,0)
 W !,"     <OR> utilizes the clinics 12 or more time in the" D PB Q:Y=0
"RTN","PXRMG2R1",51,0)
 W !,"          preceding 12 months." D PB Q:Y=0
"RTN","PXRMG2R1",52,0)
 D EXIT
"RTN","PXRMG2R1",53,0)
 Q
"RTN","PXRMG2R1",54,0)
 ;========================================================
"RTN","PXRMG2R1",55,0)
ENP ;Entry Point for Local Report
"RTN","PXRMG2R1",56,0)
 N NAME,ARY,SSN,CRITER,DATE,DATEF
"RTN","PXRMG2R1",57,0)
 N CRP1,CRP2,CRP3,CRP4,CRP5,CNT,PROG
"RTN","PXRMG2R1",58,0)
 S (CRP1,CRP2,CRP3,CRP4,CRP5)=""
"RTN","PXRMG2R1",59,0)
 D EN^PXRMG2E2
"RTN","PXRMG2R1",60,0)
 W @IOF
"RTN","PXRMG2R1",61,0)
 W "============================================================================="
"RTN","PXRMG2R1",62,0)
 W !,"Referred to Homemaker/Home Health Aide(HHHA) or Adult Day Health Care(ADHC)"
"RTN","PXRMG2R1",63,0)
 W !,"or VA In-Home Respite(VAIHR) or Care Coordination programs(CC)"
"RTN","PXRMG2R1",64,0)
 W !,"From: "_$$FMTE^XLFDT(BDT,"5ZM")_" To: "_$$FMTE^XLFDT(EDT,"5ZM")
"RTN","PXRMG2R1",65,0)
 W !,"Fiscal Quarter: "_FQUARTER_" (Calendar Quarter "_QUARTER_")"
"RTN","PXRMG2R1",66,0)
 W !,?39,"    Criteria ",?65,"Measured"
"RTN","PXRMG2R1",67,0)
 W !,"Name",?25,"SSN",?32,"Prog.",?39,"0",?42,"#1",?45,"#2",?48,"#3",?51,"#4",?54,"Date",?65,"Criteria"
"RTN","PXRMG2R1",68,0)
 W !,"==========================================================================="
"RTN","PXRMG2R1",69,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"",""RPT"")"
"RTN","PXRMG2R1",70,0)
 S CNT=0
"RTN","PXRMG2R1",71,0)
 S NAME="" F  S NAME=$O(@ARY@(NAME)) Q:NAME=""  D
"RTN","PXRMG2R1",72,0)
 .S CNT=1
"RTN","PXRMG2R1",73,0)
 .S SSN="" F  S SSN=$O(@ARY@(NAME,SSN)) Q:SSN=""  D
"RTN","PXRMG2R1",74,0)
 ..S DATE=""  F  S DATE=$O(@ARY@(NAME,SSN,DATE)) Q:DATE=""  D
"RTN","PXRMG2R1",75,0)
 ...S DATEF=$$FMTE^XLFDT(DATE,"5ZM")
"RTN","PXRMG2R1",76,0)
 ...S CRITER="" F  S CRITER=$O(@ARY@(NAME,SSN,DATE,CRITER)) Q:CRITER=""  D
"RTN","PXRMG2R1",77,0)
 ....I CRITER=0 S CRP1="X"
"RTN","PXRMG2R1",78,0)
 ....I CRITER[1 S CRP2="X"
"RTN","PXRMG2R1",79,0)
 ....I CRITER[2 S CRP3="X"
"RTN","PXRMG2R1",80,0)
 ....I CRITER[3 S CRP4="X"
"RTN","PXRMG2R1",81,0)
 ....I CRITER[4 S CRP5="X"
"RTN","PXRMG2R1",82,0)
 ....S PROG=$O(@ARY@(NAME,SSN,DATE,CRITER,""))
"RTN","PXRMG2R1",83,0)
 ....W !,$S($D(XYZ):NAME2,1:NAME),?25,SSN,?32,PROG,?39,CRP1,?42,CRP2,?45,CRP3,?48,CRP4,?51,CRP5,?54,$P(DATEF,"@",1),?65,$S(CRP1="X":"Not Met",1:"")
"RTN","PXRMG2R1",84,0)
 ....S (CRP1,CRP2,CRP3,CRP4,CRP5)=""
"RTN","PXRMG2R1",85,0)
 I CNT=0 W !,"     < NO PATIENT DATA FOUND >",!
"RTN","PXRMG2R1",86,0)
 W !
"RTN","PXRMG2R1",87,0)
 W !,"Criteria"
"RTN","PXRMG2R1",88,0)
 W !,"0: Not eligible under any criteria."
"RTN","PXRMG2R1",89,0)
 W !,"1: Problems with 3 or more ADL's."
"RTN","PXRMG2R1",90,0)
 W !,"2: 1 or more patient behavior or cognitive problem."
"RTN","PXRMG2R1",91,0)
 W !,"3: Expected life limit of less than 6 months."
"RTN","PXRMG2R1",92,0)
 W !,"4: Combination of the following:"
"RTN","PXRMG2R1",93,0)
 W !,"   2 or more ADL dependencies"
"RTN","PXRMG2R1",94,0)
 W !,"   <AND> 2 or more of the following:"
"RTN","PXRMG2R1",95,0)
 W !,"          Problems with 3 or more IADL's"
"RTN","PXRMG2R1",96,0)
 W !,"     <OR> age of patients is 75 or more."
"RTN","PXRMG2R1",97,0)
 W !,"     <OR> living alone in the community."
"RTN","PXRMG2R1",98,0)
 W !,"     <OR> utilizes the clinics 12 or more time in the"
"RTN","PXRMG2R1",99,0)
 W !,"          preceding 12 months."
"RTN","PXRMG2R1",100,0)
 D EXIT
"RTN","PXRMG2R1",101,0)
 Q
"RTN","PXRMG2R1",102,0)
PB ;Page Break
"RTN","PXRMG2R1",103,0)
 S Y=""
"RTN","PXRMG2R1",104,0)
 I $Y=(IOSL-2) D
"RTN","PXRMG2R1",105,0)
 .K DIR
"RTN","PXRMG2R1",106,0)
 .S DIR(0)="E"
"RTN","PXRMG2R1",107,0)
 .D ^DIR
"RTN","PXRMG2R1",108,0)
 .I Y=1 W @IOF S $Y=0
"RTN","PXRMG2R1",109,0)
 K DIR
"RTN","PXRMG2R1",110,0)
 Q
"RTN","PXRMG2R1",111,0)
EXIT ;Exit and Clean up Variables
"RTN","PXRMG2R1",112,0)
 K XYZ,FQUARTER
"RTN","PXRMG2R1",113,0)
 K ^TMP("PXRMGEC",$J)
"RTN","PXRMG2R1",114,0)
 Q
"RTN","PXRMG2R2")
0^7^B12447730
"RTN","PXRMG2R2",1,0)
PXRMG2R2 ;SLC/JVS -GEC #2-REPORT PROMPTS ;2/13/05  20:05
"RTN","PXRMG2R2",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2R2",3,0)
 Q
"RTN","PXRMG2R2",4,0)
 ;
"RTN","PXRMG2R2",5,0)
HOME ;#8 Start of Home Help Eligibility Programs Report
"RTN","PXRMG2R2",6,0)
 ;^DISV(  = DBIA #510
"RTN","PXRMG2R2",7,0)
 N POP,DIROUT,DIRUT,DUOUT,LOCNP,MENU,PROV,Y
"RTN","PXRMG2R2",8,0)
 N REPORT
"RTN","PXRMG2R2",9,0)
 ;
"RTN","PXRMG2R2",10,0)
 S TPAT=1
"RTN","PXRMG2R2",11,0)
HOMEYER D YER Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMG2R2",12,0)
HOMEQTR D QTR Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G HOMEYER
"RTN","PXRMG2R2",13,0)
HOMENAT ;D NAT Q:$D(DIROUT)!($D(DIRUT))  I $D(DIRUT) K DIRUT G HOMEQTR
"RTN","PXRMG2R2",14,0)
HOMEPAT D PAT^PXRMGECP Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G HOMEQTR
"RTN","PXRMG2R2",15,0)
HOMTPAT I DFNONLY=0 D TPAT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G HOMEPAT
"RTN","PXRMG2R2",16,0)
HOMEIOO D HOMEIO Q:$D(DIROUT)
"RTN","PXRMG2R2",17,0)
 Q
"RTN","PXRMG2R2",18,0)
HOMEIO ;=====Select IO device
"RTN","PXRMG2R2",19,0)
 N ZTRTN,ZTDESC,ZTSAVE
"RTN","PXRMG2R2",20,0)
 ;I REPORT="N" S DFNONLY=0 W !!,"Please wait..." D EN^PXRMG2E2,WRITE^PXRMG2E2
"RTN","PXRMG2R2",21,0)
 ;I REPORT="N" Q
"RTN","PXRMG2R2",22,0)
 N %ZIS
"RTN","PXRMG2R2",23,0)
 S %ZIS="QM" D ^%ZIS
"RTN","PXRMG2R2",24,0)
 I POP Q
"RTN","PXRMG2R2",25,0)
 I $D(IO("Q")) D
"RTN","PXRMG2R2",26,0)
 .S ZTRTN="PRINT^PXRMG2R2"
"RTN","PXRMG2R2",27,0)
 .S ZTDESC="GEC HOME HELP ELIGIBILITY REPORT"
"RTN","PXRMG2R2",28,0)
 .S ZTSAVE("*")=""
"RTN","PXRMG2R2",29,0)
 .D ^%ZTLOAD
"RTN","PXRMG2R2",30,0)
 ;=====Call Report
"RTN","PXRMG2R2",31,0)
 E  W !,"Please wait ..." D EN^PXRMG2E2,EN^PXRMG2R1
"RTN","PXRMG2R2",32,0)
 D HOME^%ZIS
"RTN","PXRMG2R2",33,0)
 D ^%ZISC
"RTN","PXRMG2R2",34,0)
 S:'$D(DIRUT)&('$D(DUOUT))&('$D(DIROUT)) DIR(0)="E" D ^DIR K DIR(0),Y
"RTN","PXRMG2R2",35,0)
 Q
"RTN","PXRMG2R2",36,0)
 ;=============================================================
"RTN","PXRMG2R2",37,0)
PRINT ;Call for printed report
"RTN","PXRMG2R2",38,0)
 D EN^PXRMG2E2,ENP^PXRMG2R1
"RTN","PXRMG2R2",39,0)
 Q
"RTN","PXRMG2R2",40,0)
NAT ;Select National
"RTN","PXRMG2R2",41,0)
 W !
"RTN","PXRMG2R2",42,0)
 S DIR("A",1)="Select Local or National Report"
"RTN","PXRMG2R2",43,0)
 S DIR("A")="REPORT or ^ to exit"
"RTN","PXRMG2R2",44,0)
 I $D(^DISV(DUZ,"PXRMGEC","REPORT")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","REPORT"))
"RTN","PXRMG2R2",45,0)
 S DIR(0)="S^L:LOCAL;N:NATIONAL"
"RTN","PXRMG2R2",46,0)
 D ^DIR
"RTN","PXRMG2R2",47,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMG2R2",48,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMG2R2",49,0)
 S ^DISV(DUZ,"PXRMGEC","REPORT")=X
"RTN","PXRMG2R2",50,0)
 S REPORT=Y
"RTN","PXRMG2R2",51,0)
 Q
"RTN","PXRMG2R2",52,0)
TPAT ;Select Test patients
"RTN","PXRMG2R2",53,0)
 W !
"RTN","PXRMG2R2",54,0)
 S DIR("A",1)="Select Show Test Patients in this Report?"
"RTN","PXRMG2R2",55,0)
 S DIR("A")="Y or N or ^ to exit"
"RTN","PXRMG2R2",56,0)
 I $D(^DISV(DUZ,"PXRMGEC","TPAT")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","TPAT"))
"RTN","PXRMG2R2",57,0)
 S DIR(0)="S^Y:YES;N:NO"
"RTN","PXRMG2R2",58,0)
 D ^DIR
"RTN","PXRMG2R2",59,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMG2R2",60,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMG2R2",61,0)
 S ^DISV(DUZ,"PXRMGEC","TPAT")=X
"RTN","PXRMG2R2",62,0)
 I Y="Y" S Y=1
"RTN","PXRMG2R2",63,0)
 I Y="N" S Y=0
"RTN","PXRMG2R2",64,0)
 S TPAT=Y
"RTN","PXRMG2R2",65,0)
 Q
"RTN","PXRMG2R2",66,0)
 ;
"RTN","PXRMG2R2",67,0)
YER ;Select Year
"RTN","PXRMG2R2",68,0)
 W !
"RTN","PXRMG2R2",69,0)
 S DIR("A",1)="Select a year for the report (i.e.2005)"
"RTN","PXRMG2R2",70,0)
 S DIR("A")="YEAR or ^ to exit"
"RTN","PXRMG2R2",71,0)
 I $D(^DISV(DUZ,"PXRMGEC","YEAR")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","YEAR"))
"RTN","PXRMG2R2",72,0)
 S DIR(0)="N^2004:2030:0"
"RTN","PXRMG2R2",73,0)
 D ^DIR
"RTN","PXRMG2R2",74,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMG2R2",75,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMG2R2",76,0)
 S ^DISV(DUZ,"PXRMGEC","YEAR")=X
"RTN","PXRMG2R2",77,0)
 S YEAR=Y
"RTN","PXRMG2R2",78,0)
 Q
"RTN","PXRMG2R2",79,0)
 ;
"RTN","PXRMG2R2",80,0)
QTR ;Select Quarter
"RTN","PXRMG2R2",81,0)
 N Z
"RTN","PXRMG2R2",82,0)
 W !
"RTN","PXRMG2R2",83,0)
 S DIR("A",1)="Select a Fiscal QUARTER in the year "_YEAR_" (i.e.2)"
"RTN","PXRMG2R2",84,0)
 S DIR("A",2)="     Fiscal Years start in October."
"RTN","PXRMG2R2",85,0)
 S DIR("A",3)="Fiscal Quarter 1 same as Calendar Quarter 4"
"RTN","PXRMG2R2",86,0)
 S DIR("A",4)="Fiscal Quarter 2 same as Calendar Quarter 1"
"RTN","PXRMG2R2",87,0)
 S DIR("A",5)="Fiscal Quarter 3 same as Calendar Quarter 2"
"RTN","PXRMG2R2",88,0)
 S DIR("A",6)="Fiscal Quarter 4 same as Calendar Quarter 3"
"RTN","PXRMG2R2",89,0)
 S DIR("A",7)=""
"RTN","PXRMG2R2",90,0)
 S DIR("A")="Fiscal Quarter or ^ to exit"
"RTN","PXRMG2R2",91,0)
 I $D(^DISV(DUZ,"PXRMGEC","QUARTER")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","QUARTER"))
"RTN","PXRMG2R2",92,0)
 S DIR(0)="N^1:4:0"
"RTN","PXRMG2R2",93,0)
 D ^DIR
"RTN","PXRMG2R2",94,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMG2R2",95,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMG2R2",96,0)
 S ^DISV(DUZ,"PXRMGEC","QUARTER")=X
"RTN","PXRMG2R2",97,0)
 I Y=1 S Z=4
"RTN","PXRMG2R2",98,0)
 I Y=2 S Z=1
"RTN","PXRMG2R2",99,0)
 I Y=3 S Z=2
"RTN","PXRMG2R2",100,0)
 I Y=4 S Z=3
"RTN","PXRMG2R2",101,0)
 S FQUARTER=Y
"RTN","PXRMG2R2",102,0)
 S QUARTER=Z
"RTN","PXRMG2R2",103,0)
 Q
"RTN","PXRMG2S1")
0^8^B15372525
"RTN","PXRMG2S1",1,0)
PXRMG2S1 ;SLC/JVS -GEC #2 SORTING INFORMATION #1  ;2/13/05  20:05
"RTN","PXRMG2S1",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMG2S1",3,0)
 Q
"RTN","PXRMG2S1",4,0)
 ;
"RTN","PXRMG2S1",5,0)
C1(REF) ;Check for Criteria 1 qualifications 3 ADL's
"RTN","PXRMG2S1",6,0)
 N ARY,C1CNT,ELIGIBLE
"RTN","PXRMG2S1",7,0)
 S C1CNT=0,ELIGIBLE=0
"RTN","PXRMG2S1",8,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2S1",9,0)
 I $D(@ARY@(REF,$O(C212(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",10,0)
 I $D(@ARY@(REF,$O(C216(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",11,0)
 I $D(@ARY@(REF,$O(C218(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",12,0)
 I $D(@ARY@(REF,$O(C2110(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",13,0)
 I $D(@ARY@(REF,$O(C2114(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",14,0)
 I $D(@ARY@(REF,$O(C2118(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",15,0)
 I $D(@ARY@(REF,$O(C2120(0)))) S C1CNT=C1CNT+1
"RTN","PXRMG2S1",16,0)
 I C1CNT>2 S ELIGIBLE=1
"RTN","PXRMG2S1",17,0)
 Q ELIGIBLE
"RTN","PXRMG2S1",18,0)
 ;
"RTN","PXRMG2S1",19,0)
C2(REF) ;Check for Criteria 2 qualifications 1 "Cognitive Impairment"
"RTN","PXRMG2S1",20,0)
 N ARY,C2CNT,ELIGIBLE
"RTN","PXRMG2S1",21,0)
 S C2CNT=0,ELIGIBLE=0
"RTN","PXRMG2S1",22,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2S1",23,0)
 I $D(@ARY@(REF,$O(C221(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",24,0)
 I $D(@ARY@(REF,$O(C224(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",25,0)
 I $D(@ARY@(REF,$O(C226(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",26,0)
 I $D(@ARY@(REF,$O(C272(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",27,0)
 I $D(@ARY@(REF,$O(C274(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",28,0)
 I $D(@ARY@(REF,$O(C276(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",29,0)
 I $D(@ARY@(REF,$O(C278(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",30,0)
 I $D(@ARY@(REF,$O(C2710(0)))) S C2CNT=C2CNT+1
"RTN","PXRMG2S1",31,0)
 I C2CNT>0 S ELIGIBLE=1
"RTN","PXRMG2S1",32,0)
 Q ELIGIBLE
"RTN","PXRMG2S1",33,0)
 ;
"RTN","PXRMG2S1",34,0)
 ;
"RTN","PXRMG2S1",35,0)
C3(REF) ;Check for Criteria 3 qualifications 1 "Life Expectancy<6mo"
"RTN","PXRMG2S1",36,0)
 N ARY,C3CNT,ELIGIBLE
"RTN","PXRMG2S1",37,0)
 S C3CNT=0,ELIGIBLE=0
"RTN","PXRMG2S1",38,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2S1",39,0)
 I $D(@ARY@(REF,$O(C286(0)))) S C3CNT=C3CNT+1
"RTN","PXRMG2S1",40,0)
 I C3CNT>0 S ELIGIBLE=1
"RTN","PXRMG2S1",41,0)
 Q ELIGIBLE
"RTN","PXRMG2S1",42,0)
 ;
"RTN","PXRMG2S1",43,0)
C4(REF) ;Check for Criteria 4 qualifications 2 OR MORE ADL's
"RTN","PXRMG2S1",44,0)
 N ARY,C4ACNT,ELIGIBLE,C4BCNT,C4FCNT,AGEF,AGEO,C4CCNT,PXRMAPT,APPTF
"RTN","PXRMG2S1",45,0)
 N NAME,APPTO,HFDA,SSN,DATE,PROG
"RTN","PXRMG2S1",46,0)
 S C4ACNT=0,ELIGIBLE=0,C4BCNT=0,C4FCNT=0,C4CCNT=0
"RTN","PXRMG2S1",47,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2S1",48,0)
 S HFDA=$O(@ARY@(REF,0))
"RTN","PXRMG2S1",49,0)
 ;---AGE---
"RTN","PXRMG2S1",50,0)
 ;S AGEO=$O(@ARY@(REF,0))
"RTN","PXRMG2S1",51,0)
 S AGEF=$O(@ARY@(REF,HFDA,-1))
"RTN","PXRMG2S1",52,0)
 ;---AGE-----
"RTN","PXRMG2S1",53,0)
 ;---APPOINTMENTS---
"RTN","PXRMG2S1",54,0)
 S APPTF=0
"RTN","PXRMG2S1",55,0)
 S APPTO=$O(@ARY@(REF,HFDA,AGEF,-1))
"RTN","PXRMG2S1",56,0)
 I APPTO>12 S APPTF=1
"RTN","PXRMG2S1",57,0)
 ;---APPOINTMENTS---
"RTN","PXRMG2S1",58,0)
 ;---NAME AND SSN---
"RTN","PXRMG2S1",59,0)
 S NAME=$O(@ARY@(REF,HFDA,AGEF,APPTO,0))
"RTN","PXRMG2S1",60,0)
 ;---NAME AND SSN---
"RTN","PXRMG2S1",61,0)
 ;---MONTH
"RTN","PXRMG2S1",62,0)
 S MONTH=$O(@ARY@(REF,HFDA,AGEF,APPTO,NAME,0))
"RTN","PXRMG2S1",63,0)
 ;---MONTH
"RTN","PXRMG2S1",64,0)
 ;---SSN
"RTN","PXRMG2S1",65,0)
 S SSN=$O(@ARY@(REF,HFDA,AGEF,APPTO,NAME,MONTH,""))
"RTN","PXRMG2S1",66,0)
 ;---SSN
"RTN","PXRMG2S1",67,0)
 ;---DATE
"RTN","PXRMG2S1",68,0)
 S DATE=$O(@ARY@(REF,HFDA,AGEF,APPTO,NAME,MONTH,SSN,0))
"RTN","PXRMG2S1",69,0)
 ;---DATE
"RTN","PXRMG2S1",70,0)
 ;---PROGRAM
"RTN","PXRMG2S1",71,0)
 S PROG=$$PROG(REF)
"RTN","PXRMG2S1",72,0)
 ;---PROGRAM
"RTN","PXRMG2S1",73,0)
 I $D(@ARY@(REF,$O(C212(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",74,0)
 I $D(@ARY@(REF,$O(C216(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",75,0)
 I $D(@ARY@(REF,$O(C218(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",76,0)
 I $D(@ARY@(REF,$O(C2110(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",77,0)
 I $D(@ARY@(REF,$O(C2114(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",78,0)
 I $D(@ARY@(REF,$O(C2118(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",79,0)
 I $D(@ARY@(REF,$O(C2120(0)))) S C4ACNT=C4ACNT+1
"RTN","PXRMG2S1",80,0)
 I $D(@ARY@(REF,$O(C142(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",81,0)
 I $D(@ARY@(REF,$O(C144(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",82,0)
 I $D(@ARY@(REF,$O(C146(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",83,0)
 I $D(@ARY@(REF,$O(C148(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",84,0)
 I $D(@ARY@(REF,$O(C1410(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",85,0)
 I $D(@ARY@(REF,$O(C1412(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",86,0)
 I $D(@ARY@(REF,$O(C1414(0)))) S C4BCNT=C4BCNT+1
"RTN","PXRMG2S1",87,0)
 I $D(@ARY@(REF,$O(C1101(0)))) S C4CCNT=C4CCNT+1
"RTN","PXRMG2S1",88,0)
 I $D(@ARY@(REF,$O(C1107(0)))) S C4CCNT=C4CCNT+1
"RTN","PXRMG2S1",89,0)
 I $D(@ARY@(REF,$O(C1108(0)))) S C4CCNT=C4CCNT+1
"RTN","PXRMG2S1",90,0)
 I $D(@ARY@(REF,$O(C171(0)))) S C4FCNT=C4FCNT+1
"RTN","PXRMG2S1",91,0)
 I $D(@ARY@(REF,$O(C166(0)))) S C4FCNT=C4FCNT+1
"RTN","PXRMG2S1",92,0)
 ;--EVALUATION--
"RTN","PXRMG2S1",93,0)
 N ELI
"RTN","PXRMG2S1",94,0)
 S ELI=0
"RTN","PXRMG2S1",95,0)
 I C4BCNT>2 S ELI=ELI+1
"RTN","PXRMG2S1",96,0)
 I C4CCNT>0 S ELI=ELI+1
"RTN","PXRMG2S1",97,0)
 I AGEF=1 S ELI=ELI+1
"RTN","PXRMG2S1",98,0)
 I APPTF=1 S ELI=ELI+1
"RTN","PXRMG2S1",99,0)
 I C4FCNT>0 S ELI=ELI+1
"RTN","PXRMG2S1",100,0)
 ;
"RTN","PXRMG2S1",101,0)
 I C4ACNT>1,ELI>1 S ELIGIBLE=1
"RTN","PXRMG2S1",102,0)
 ;--EVALUATION--
"RTN","PXRMG2S1",103,0)
 S ELIGIBLE=ELIGIBLE_"^"_NAME_"^"_MONTH_"^"_SSN_"^"_DATE_"^"_PROG
"RTN","PXRMG2S1",104,0)
 Q ELIGIBLE
"RTN","PXRMG2S1",105,0)
 ;=============================================
"RTN","PXRMG2S1",106,0)
PROG(REF) ;Determind Program (FUNCTION)
"RTN","PXRMG2S1",107,0)
 N ARY,PROG
"RTN","PXRMG2S1",108,0)
 S PROG="NONE"
"RTN","PXRMG2S1",109,0)
 S ARY="^TMP(""PXRMGEC"",$J,""GEC2"")"
"RTN","PXRMG2S1",110,0)
 I $D(@ARY@(REF,$O(P441(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2S1",111,0)
 .S PROG="ADHC"
"RTN","PXRMG2S1",112,0)
 I $D(@ARY@(REF,$O(P4410(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2S1",113,0)
 .S PROG="HHHA"
"RTN","PXRMG2S1",114,0)
 I $D(@ARY@(REF,$O(P4412(0)))),$D(@ARY@(REF,$O(P449(0)))) D
"RTN","PXRMG2S1",115,0)
 .S PROG="VAIHR"
"RTN","PXRMG2S1",116,0)
 I $D(@ARY@(REF,$O(P451(0)))),$D(@ARY@(REF,$O(P452(0)))) D
"RTN","PXRMG2S1",117,0)
 .S PROG="CC"
"RTN","PXRMG2S1",118,0)
 Q PROG
"RTN","PXRMGECP")
0^9^B60301590
"RTN","PXRMGECP",1,0)
PXRMGECP ;SLC/JVS -GEC-Prompts ;2/13/05  19:56
"RTN","PXRMGECP",2,0)
 ;;2.0;CLINICAL REMINDERS;**2**;Feb 04, 2005
"RTN","PXRMGECP",3,0)
 Q
"RTN","PXRMGECP",4,0)
EN ;Entry Point
"RTN","PXRMGECP",5,0)
 ;^DISV(  = DBIA #510
"RTN","PXRMGECP",6,0)
 N POP,DIROUT,DIRUT,DUOUT,LOCNP,MENU,PROV,Y
"RTN","PXRMGECP",7,0)
 N DETAIL,FORMAT,INC
"RTN","PXRMGECP",8,0)
 ;D INIT^PXRMGECW
"RTN","PXRMGECP",9,0)
 S X="IOUON;IOUOFF;IORVOFF;IORVON" D ENDR^%ZISS
"RTN","PXRMGECP",10,0)
 W IOUOFF,IORVOFF
"RTN","PXRMGECP",11,0)
 W @IOF
"RTN","PXRMGECP",12,0)
 W !,"All Reports will print on 80 Columns"
"RTN","PXRMGECP",13,0)
 K DIR
"RTN","PXRMGECP",14,0)
 S DIR("A")="Select Option or ^ to Exit"
"RTN","PXRMGECP",15,0)
 I $D(^DISV(DUZ,"PXRMGEC","EN")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","EN"))
"RTN","PXRMGECP",16,0)
 S DIR(0)="S^1:Category;2:Patient;3:Provider by Patient;4:Referral Date;5:Location;6:Referral Count Totals;7:Category-Referred Service;8:Summary (Score);9:'Home Help' Eligibility"
"RTN","PXRMGECP",17,0)
 D ^DIR
"RTN","PXRMGECP",18,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",19,0)
 Q:$D(DIRUT)!($D(DIROUT))
"RTN","PXRMGECP",20,0)
 ;DBIA #510
"RTN","PXRMGECP",21,0)
 S MENU=Y,^DISV(DUZ,"PXRMGEC","EN")=MENU
"RTN","PXRMGECP",22,0)
 I MENU=1 D CAT
"RTN","PXRMGECP",23,0)
 I MENU=2 D PATIENT
"RTN","PXRMGECP",24,0)
 I MENU=3 D PRO
"RTN","PXRMGECP",25,0)
 I MENU=4 D DR
"RTN","PXRMGECP",26,0)
 I MENU=5 D LOCDIR^PXRMGECO
"RTN","PXRMGECP",27,0)
 I MENU=6 D CT^PXRMGECO
"RTN","PXRMGECP",28,0)
 I MENU=7 D RS^PXRMGECO
"RTN","PXRMGECP",29,0)
 I MENU=8 D SUM^PXRMGECO
"RTN","PXRMGECP",30,0)
 I MENU=9 D HOME^PXRMG2R2
"RTN","PXRMGECP",31,0)
 D KILL^%ZISS
"RTN","PXRMGECP",32,0)
 Q
"RTN","PXRMGECP",33,0)
 ;==========================================================
"RTN","PXRMGECP",34,0)
 ;
"RTN","PXRMGECP",35,0)
CAT ;#1 Start List and array of GEC Categories
"RTN","PXRMGECP",36,0)
 ;
"RTN","PXRMGECP",37,0)
 N CAT,CATNA,CNT,STAY,NUM,CATIEN,CATARY,BDT,EDT,CATDA,SYN
"RTN","PXRMGECP",38,0)
 W @IOF
"RTN","PXRMGECP",39,0)
 W "GEC Referral Categories"
"RTN","PXRMGECP",40,0)
 S CNT=0
"RTN","PXRMGECP",41,0)
 S SYN="" F  S SYN=$O(^AUTTHF("D",SYN)) Q:SYN=""  D
"RTN","PXRMGECP",42,0)
 .I $E(SYN,1,3)="GEC",$E(SYN,5)="C" D
"RTN","PXRMGECP",43,0)
 ..S CAT=0 F  S CAT=$O(^AUTTHF("D",SYN,CAT)) Q:CAT=""  D
"RTN","PXRMGECP",44,0)
 ...Q:$P($G(^AUTTHF(CAT,0)),"^",11)=1
"RTN","PXRMGECP",45,0)
 ...S CATNA=$P($G(^AUTTHF(CAT,0)),"^",1)
"RTN","PXRMGECP",46,0)
 ...S CATNA=$P(CATNA," ",3,7)
"RTN","PXRMGECP",47,0)
 ...S CATARY(CATNA,CAT)=""
"RTN","PXRMGECP",48,0)
 S CATNA="" F  S CATNA=$O(CATARY(CATNA)) Q:CATNA=""  D
"RTN","PXRMGECP",49,0)
 .S CAT=$O(CATARY(CATNA,0))
"RTN","PXRMGECP",50,0)
 .S CNT=CNT+1
"RTN","PXRMGECP",51,0)
 .S CATDA(CNT,CAT)=""
"RTN","PXRMGECP",52,0)
 .W:CNT#2=1 !,CNT,?4,CATNA
"RTN","PXRMGECP",53,0)
 .W:CNT#2=0 ?35,CNT,?39,CATNA
"RTN","PXRMGECP",54,0)
SC ;=====Select Categories
"RTN","PXRMGECP",55,0)
 W !
"RTN","PXRMGECP",56,0)
 S DIR("A",1)="Select Categories from the list above using"
"RTN","PXRMGECP",57,0)
 S DIR("A",2)="Commas and/or Dashes for ranges of numbers."
"RTN","PXRMGECP",58,0)
 S DIR("A")="Select Categories or ^ to exit"
"RTN","PXRMGECP",59,0)
 I $D(^DISV(DUZ,"PXRMGEC","SC")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","SC"))
"RTN","PXRMGECP",60,0)
 S DIR(0)="L^1:"_CNT
"RTN","PXRMGECP",61,0)
 D ^DIR
"RTN","PXRMGECP",62,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",63,0)
 Q:$D(DIROUT)
"RTN","PXRMGECP",64,0)
 Q:$D(DIRUT)
"RTN","PXRMGECP",65,0)
 S ^DISV(DUZ,"PXRMGEC","SC")=X
"RTN","PXRMGECP",66,0)
 N LEN,IME,MEY
"RTN","PXRMGECP",67,0)
 S LEN=$L(Y,",")
"RTN","PXRMGECP",68,0)
 S MEY=0 F IME=1:1:LEN-1 S MEY=$P(Y,",",IME) D
"RTN","PXRMGECP",69,0)
 .S CATMEY(MEY)=""
"RTN","PXRMGECP",70,0)
 S STAY=0 F  S STAY=$O(CATDA(STAY)) Q:STAY=""  D
"RTN","PXRMGECP",71,0)
 .I '$D(CATMEY(STAY)) K CATDA(STAY)
"RTN","PXRMGECP",72,0)
 S NUM=0 F  S NUM=$O(CATDA(NUM)) Q:NUM=""  D
"RTN","PXRMGECP",73,0)
 .S CATIEN($O(CATDA(NUM,0)))=""
"RTN","PXRMGECP",74,0)
 K CATDA,CATMEY
"RTN","PXRMGECP",75,0)
CATBDT D BDT Q:$D(DIROUT)!$D(DIRUT)
"RTN","PXRMGECP",76,0)
CATEDT D EDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G CATBDT
"RTN","PXRMGECP",77,0)
CATPAT D PAT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G CATEDT
"RTN","PXRMGECP",78,0)
CATFOR D FOR Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G CATPAT
"RTN","PXRMGECP",79,0)
CATIOO D CATIO Q:$D(DIROUT)
"RTN","PXRMGECP",80,0)
 Q
"RTN","PXRMGECP",81,0)
BDT ;=====Select Beginning Date
"RTN","PXRMGECP",82,0)
 ;--Return BDT as DATE
"RTN","PXRMGECP",83,0)
 W !
"RTN","PXRMGECP",84,0)
 S DIR("A",1)="Select a Beginning Historical Date."
"RTN","PXRMGECP",85,0)
 S DIR("A")="BEGINNING date or ^ to exit"
"RTN","PXRMGECP",86,0)
 I $D(^DISV(DUZ,"PXRMGEC","BDT")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","BDT"))
"RTN","PXRMGECP",87,0)
 S DIR(0)="D^2880101:"_DT_":EX"
"RTN","PXRMGECP",88,0)
 D ^DIR
"RTN","PXRMGECP",89,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",90,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMGECP",91,0)
 S ^DISV(DUZ,"PXRMGEC","BDT")=X
"RTN","PXRMGECP",92,0)
 S BDT=Y
"RTN","PXRMGECP",93,0)
 Q
"RTN","PXRMGECP",94,0)
 ;
"RTN","PXRMGECP",95,0)
EDT ;=====Select Ending Date
"RTN","PXRMGECP",96,0)
 ;--Return EDT as DATE
"RTN","PXRMGECP",97,0)
 W !
"RTN","PXRMGECP",98,0)
 S DIR("A",1)="Select Ending Date."
"RTN","PXRMGECP",99,0)
 S DIR("A")="ENDING date or ^ to exit"
"RTN","PXRMGECP",100,0)
 I $D(^DISV(DUZ,"PXRMGEC","EDT")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","EDT"))
"RTN","PXRMGECP",101,0)
 S DIR(0)="D^"_BDT_":"_DT_":EX"
"RTN","PXRMGECP",102,0)
 D ^DIR
"RTN","PXRMGECP",103,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",104,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMGECP",105,0)
 S ^DISV(DUZ,"PXRMGEC","EDT")=X
"RTN","PXRMGECP",106,0)
 S EDT=Y
"RTN","PXRMGECP",107,0)
 Q
"RTN","PXRMGECP",108,0)
 ;=====Select Patients
"RTN","PXRMGECP",109,0)
PAT ;--Return DFNONLY as Patient DFN
"RTN","PXRMGECP",110,0)
 W @IOF
"RTN","PXRMGECP",111,0)
 K DIR,DIR("A")
"RTN","PXRMGECP",112,0)
 S DIR("A")="Select Patients or ^ to exit"
"RTN","PXRMGECP",113,0)
 I $D(^DISV(DUZ,"PXRMGEC","PAT")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","PAT"))
"RTN","PXRMGECP",114,0)
 S DIR(0)="S^A:All Patients;M:Multiple Patients"
"RTN","PXRMGECP",115,0)
 D ^DIR
"RTN","PXRMGECP",116,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",117,0)
 Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMGECP",118,0)
 S ^DISV(DUZ,"PXRMGEC","PAT")=X
"RTN","PXRMGECP",119,0)
 I Y="A" S DFNONLY=0
"RTN","PXRMGECP",120,0)
 I Y="M" D PATLU
"RTN","PXRMGECP",121,0)
 Q
"RTN","PXRMGECP",122,0)
 ;
"RTN","PXRMGECP",123,0)
FOR ;=====Formatted or Delimited Report
"RTN","PXRMGECP",124,0)
 ;--Return FORMAT equal to Y
"RTN","PXRMGECP",125,0)
 S DIR("A")="Select Report Format or ^ to exit"
"RTN","PXRMGECP",126,0)
 I $D(^DISV(DUZ,"PXRMGEC","FOR")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","FOR"))
"RTN","PXRMGECP",127,0)
 S DIR(0)="S^F:Formatted;D:Delimited"
"RTN","PXRMGECP",128,0)
 D ^DIR
"RTN","PXRMGECP",129,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",130,0)
 Q:$D(DIRUT)!($D(DIROUT))
"RTN","PXRMGECP",131,0)
 S ^DISV(DUZ,"PXRMGEC","FOR")=X
"RTN","PXRMGECP",132,0)
 S FORMAT=Y
"RTN","PXRMGECP",133,0)
 Q
"RTN","PXRMGECP",134,0)
 ;
"RTN","PXRMGECP",135,0)
CATIO ;=====Select IO device
"RTN","PXRMGECP",136,0)
 Q:'$D(BDT)!('$D(EDT))!('$D(DFNONLY))!'$D(FORMAT)
"RTN","PXRMGECP",137,0)
 N %ZIS
"RTN","PXRMGECP",138,0)
 S %ZIS="QM" D ^%ZIS
"RTN","PXRMGECP",139,0)
 I POP Q
"RTN","PXRMGECP",140,0)
 I $D(IO("Q")) D
"RTN","PXRMGECP",141,0)
 .S ZTRTN="HFCD^PXRMGECQ"
"RTN","PXRMGECP",142,0)
 .S ZTDESC="Gec Report Printing"
"RTN","PXRMGECP",143,0)
 .S ZTSAVE("*")=""
"RTN","PXRMGECP",144,0)
 .D ^%ZTLOAD K IO("Q") Q
"RTN","PXRMGECP",145,0)
 ;=====Call Report
"RTN","PXRMGECP",146,0)
 E  D HFCD^PXRMGECR
"RTN","PXRMGECP",147,0)
 D HOME^%ZIS
"RTN","PXRMGECP",148,0)
 D ^%ZISC
"RTN","PXRMGECP",149,0)
 S:'$D(DIRUT)&('$D(DUOUT))&('$D(DIROUT)) DIR(0)="E" D ^DIR K DIR(0),Y
"RTN","PXRMGECP",150,0)
 Q
"RTN","PXRMGECP",151,0)
 ;
"RTN","PXRMGECP",152,0)
 ;================SUB ROUTINES==============================
"RTN","PXRMGECP",153,0)
PROV ;Select Provider
"RTN","PXRMGECP",154,0)
 W @IOF
"RTN","PXRMGECP",155,0)
 N DIC,Y
"RTN","PXRMGECP",156,0)
 S PROV=0
"RTN","PXRMGECP",157,0)
 K PROVARY
"RTN","PXRMGECP",158,0)
 S DIC="^VA(200,"
"RTN","PXRMGECP",159,0)
 S DIC(0)="QAMEZ"
"RTN","PXRMGECP",160,0)
PROVR D ^DIC
"RTN","PXRMGECP",161,0)
 I Y=-1 K DIC,DIC(0),Y Q
"RTN","PXRMGECP",162,0)
 I +Y>0 S PROVARY(+Y)=""
"RTN","PXRMGECP",163,0)
 S PROV=+Y
"RTN","PXRMGECP",164,0)
 G PROVR
"RTN","PXRMGECP",165,0)
 Q
"RTN","PXRMGECP",166,0)
 ;
"RTN","PXRMGECP",167,0)
PATLU ;Patient Look up
"RTN","PXRMGECP",168,0)
 N Y,DIC
"RTN","PXRMGECP",169,0)
 S DFNONLY=0
"RTN","PXRMGECP",170,0)
 K DFNARY
"RTN","PXRMGECP",171,0)
 S DIC="^DPT("
"RTN","PXRMGECP",172,0)
 S DIC(0)="QAMEZ"
"RTN","PXRMGECP",173,0)
PATLUR D ^DIC
"RTN","PXRMGECP",174,0)
 I Y=-1 K DIC,DIC(0),Y Q
"RTN","PXRMGECP",175,0)
 I +Y>0 S DFNONLY=+Y,DFNARY(+Y)=""
"RTN","PXRMGECP",176,0)
 G PATLUR
"RTN","PXRMGECP",177,0)
 Q
"RTN","PXRMGECP",178,0)
 ;
"RTN","PXRMGECP",179,0)
 ;================================================================
"RTN","PXRMGECP",180,0)
PRO ; #3 Start of Provider by Patient Report
"RTN","PXRMGECP",181,0)
 N BDT,EDT,DFNONLY
"RTN","PXRMGECP",182,0)
 W @IOF
"RTN","PXRMGECP",183,0)
 K DIR
"RTN","PXRMGECP",184,0)
 I $D(^DISV(DUZ,"PXRMGEC","PRO")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","PRO"))
"RTN","PXRMGECP",185,0)
 S DIR(0)="S^A:All Providers;M:Multiple Providers"
"RTN","PXRMGECP",186,0)
 D ^DIR
"RTN","PXRMGECP",187,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",188,0)
 Q:$D(DIRUT)!($D(DUOUT))
"RTN","PXRMGECP",189,0)
 Q:$D(DIROUT)
"RTN","PXRMGECP",190,0)
 S ^DISV(DUZ,"PXRMGEC","PRO")=X
"RTN","PXRMGECP",191,0)
 I Y="A" S PROV=0
"RTN","PXRMGECP",192,0)
 I Y="M" D PROV Q:'$D(PROVARY)
"RTN","PXRMGECP",193,0)
 Q:$D(DIRUT)!($D(DIROUT))
"RTN","PXRMGECP",194,0)
PROBDT D BDT Q:$D(DIRUT)!($D(DIRUT))
"RTN","PXRMGECP",195,0)
PROEDT D EDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G PROBDT
"RTN","PXRMGECP",196,0)
PROFOR D FOR Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G PROEDT
"RTN","PXRMGECP",197,0)
PROIOO D PROIO Q:$D(DIROUT)
"RTN","PXRMGECP",198,0)
 Q
"RTN","PXRMGECP",199,0)
 ;
"RTN","PXRMGECP",200,0)
PROIO ;=====Select IO device
"RTN","PXRMGECP",201,0)
 N %ZIS
"RTN","PXRMGECP",202,0)
 S %ZIS="QM" D ^%ZIS
"RTN","PXRMGECP",203,0)
 I POP Q
"RTN","PXRMGECP",204,0)
 I $D(IO("Q")) D
"RTN","PXRMGECP",205,0)
 .S ZTRTN="DFN2^PXRMGECQ"
"RTN","PXRMGECP",206,0)
 .S ZTDESC="GEC PROVIDER REPORT"
"RTN","PXRMGECP",207,0)
 .S ZTSAVE("*")=""
"RTN","PXRMGECP",208,0)
 .D ^%ZTLOAD K IO("Q") Q
"RTN","PXRMGECP",209,0)
 ;=====Call Report
"RTN","PXRMGECP",210,0)
 E  D DFN2^PXRMGECS
"RTN","PXRMGECP",211,0)
 D HOME^%ZIS
"RTN","PXRMGECP",212,0)
 D ^%ZISC
"RTN","PXRMGECP",213,0)
 S:'$D(DIRUT)&('$D(DUOUT))&('$D(DIROUT)) DIR(0)="E" D ^DIR K DIR(0),Y
"RTN","PXRMGECP",214,0)
 Q
"RTN","PXRMGECP",215,0)
 ;=================================================================
"RTN","PXRMGECP",216,0)
DR ; #4 Referral Date
"RTN","PXRMGECP",217,0)
 ;
"RTN","PXRMGECP",218,0)
DRPAT D PAT Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMGECP",219,0)
DRBDT D BDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G DRPAT
"RTN","PXRMGECP",220,0)
DREDT D EDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G DRBDT
"RTN","PXRMGECP",221,0)
DRALL D ALL Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G DREDT
"RTN","PXRMGECP",222,0)
DRFOR D FOR Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G DRALL
"RTN","PXRMGECP",223,0)
DRIOO D DRIO Q:$D(DIROUT)
"RTN","PXRMGECP",224,0)
 Q
"RTN","PXRMGECP",225,0)
 ;
"RTN","PXRMGECP",226,0)
ALL ;=====Select All Referrals or
"RTN","PXRMGECP",227,0)
 ;--Return INC equal to Y
"RTN","PXRMGECP",228,0)
 I $D(^DISV(DUZ,"PXRMGEC","ALL")) S DIR("B")=$G(^DISV(DUZ,"PXRMGEC","ALL"))
"RTN","PXRMGECP",229,0)
 S DIR(0)="S^I:Incomplete Referrals Only;C:Complete Referrals Only;B:Both Complete and Incomplete"
"RTN","PXRMGECP",230,0)
 D ^DIR
"RTN","PXRMGECP",231,0)
 K DIR("A"),DIR("B"),DIR(0)
"RTN","PXRMGECP",232,0)
 Q:$D(DIRUT)!($D(DUOUT))
"RTN","PXRMGECP",233,0)
 S ^DISV(DUZ,"PXRMGEC","ALL")=X
"RTN","PXRMGECP",234,0)
 I Y="I" S INC=0
"RTN","PXRMGECP",235,0)
 I Y="C" S INC=1
"RTN","PXRMGECP",236,0)
 I Y="B" S INC=2
"RTN","PXRMGECP",237,0)
 Q
"RTN","PXRMGECP",238,0)
 ;
"RTN","PXRMGECP",239,0)
DRIO ;=====Select IO device
"RTN","PXRMGECP",240,0)
 N %ZIS
"RTN","PXRMGECP",241,0)
 S %ZIS="QM" D ^%ZIS
"RTN","PXRMGECP",242,0)
 I POP Q
"RTN","PXRMGECP",243,0)
 I $D(IO("Q")) D
"RTN","PXRMGECP",244,0)
 .S ZTRTN="DR^PXRMGECQ"
"RTN","PXRMGECP",245,0)
 .S ZTDESC="GEC REPORT"
"RTN","PXRMGECP",246,0)
 .S ZTSAVE("*")=""
"RTN","PXRMGECP",247,0)
 .D ^%ZTLOAD K IO("Q") Q
"RTN","PXRMGECP",248,0)
 ;=====Call Report
"RTN","PXRMGECP",249,0)
 E  D DR^PXRMGECR
"RTN","PXRMGECP",250,0)
 D HOME^%ZIS
"RTN","PXRMGECP",251,0)
 D ^%ZISC
"RTN","PXRMGECP",252,0)
 S:'$D(DIRUT)&('$D(DUOUT))&('$D(DIROUT)) DIR(0)="E" D ^DIR K DIR(0),Y
"RTN","PXRMGECP",253,0)
 Q
"RTN","PXRMGECP",254,0)
 ;
"RTN","PXRMGECP",255,0)
 ;==================================================================
"RTN","PXRMGECP",256,0)
PATIENT ; #2 Start of Patient Report
"RTN","PXRMGECP",257,0)
 ;
"RTN","PXRMGECP",258,0)
PATPAT D PAT Q:$D(DIROUT)!($D(DIRUT))
"RTN","PXRMGECP",259,0)
PATBDT D BDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G PATPAT
"RTN","PXRMGECP",260,0)
PATEDT D EDT Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G PATBDT
"RTN","PXRMGECP",261,0)
PATFOR D FOR Q:$D(DIROUT)  I $D(DIRUT) K DIRUT G PATEDT
"RTN","PXRMGECP",262,0)
PATIOO D PATIO Q:$D(DIROUT)
"RTN","PXRMGECP",263,0)
 Q
"RTN","PXRMGECP",264,0)
 ;
"RTN","PXRMGECP",265,0)
PATIO ;=====Select IO device for Patient Report
"RTN","PXRMGECP",266,0)
 N %ZIS
"RTN","PXRMGECP",267,0)
 S %ZIS="QM" D ^%ZIS
"RTN","PXRMGECP",268,0)
 I POP Q
"RTN","PXRMGECP",269,0)
 I $D(IO("Q")) D
"RTN","PXRMGECP",270,0)
 .S ZTRTN="HS1^PXRMGECQ"
"RTN","PXRMGECP",271,0)
 .S ZTDESC="GEC PATIENT REPORT"
"RTN","PXRMGECP",272,0)
 .S ZTSAVE("*")=""
"RTN","PXRMGECP",273,0)
 .D ^%ZTLOAD K IO("Q") Q
"RTN","PXRMGECP",274,0)
 ;=====Call Report
"RTN","PXRMGECP",275,0)
 E  D HS1^PXRMGECR
"RTN","PXRMGECP",276,0)
 D HOME^%ZIS
"RTN","PXRMGECP",277,0)
 D ^%ZISC
"RTN","PXRMGECP",278,0)
 S:'$D(DIRUT)&('$D(DUOUT))&('$D(DIROUT)) DIR(0)="E" D ^DIR K DIR(0),Y
"RTN","PXRMGECP",279,0)
 Q
"RTN","PXRMGECP",280,0)
 ;=========================================================
"VER")
8.0^22.0
**END**
**END**
