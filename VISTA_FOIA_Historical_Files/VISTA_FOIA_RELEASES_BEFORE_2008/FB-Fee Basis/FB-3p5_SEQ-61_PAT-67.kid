Released FB*3.5*67 SEQ #61
Extracted from mail message
**KIDS**:FB*3.5*67^

**INSTALL NAME**
FB*3.5*67
"BLD",5135,0)
FB*3.5*67^FEE BASIS^0^3031030^y
"BLD",5135,1,0)
^^1^1^3031023^
"BLD",5135,1,1,0)
PROBLEM WITH MULTIPLE PAYMENT ENTRY
"BLD",5135,4,0)
^9.64PA^^
"BLD",5135,"KRN",0)
^9.67PA^8989.52^19
"BLD",5135,"KRN",.4,0)
.4
"BLD",5135,"KRN",.401,0)
.401
"BLD",5135,"KRN",.402,0)
.402
"BLD",5135,"KRN",.403,0)
.403
"BLD",5135,"KRN",.5,0)
.5
"BLD",5135,"KRN",.84,0)
.84
"BLD",5135,"KRN",3.6,0)
3.6
"BLD",5135,"KRN",3.8,0)
3.8
"BLD",5135,"KRN",9.2,0)
9.2
"BLD",5135,"KRN",9.8,0)
9.8
"BLD",5135,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5135,"KRN",9.8,"NM",1,0)
FBAAMP^^0^B63835336
"BLD",5135,"KRN",9.8,"NM","B","FBAAMP",1)

"BLD",5135,"KRN",19,0)
19
"BLD",5135,"KRN",19.1,0)
19.1
"BLD",5135,"KRN",101,0)
101
"BLD",5135,"KRN",409.61,0)
409.61
"BLD",5135,"KRN",771,0)
771
"BLD",5135,"KRN",870,0)
870
"BLD",5135,"KRN",8989.51,0)
8989.51
"BLD",5135,"KRN",8989.52,0)
8989.52
"BLD",5135,"KRN",8994,0)
8994
"BLD",5135,"KRN","B",.4,.4)

"BLD",5135,"KRN","B",.401,.401)

"BLD",5135,"KRN","B",.402,.402)

"BLD",5135,"KRN","B",.403,.403)

"BLD",5135,"KRN","B",.5,.5)

"BLD",5135,"KRN","B",.84,.84)

"BLD",5135,"KRN","B",3.6,3.6)

"BLD",5135,"KRN","B",3.8,3.8)

"BLD",5135,"KRN","B",9.2,9.2)

"BLD",5135,"KRN","B",9.8,9.8)

"BLD",5135,"KRN","B",19,19)

"BLD",5135,"KRN","B",19.1,19.1)

"BLD",5135,"KRN","B",101,101)

"BLD",5135,"KRN","B",409.61,409.61)

"BLD",5135,"KRN","B",771,771)

"BLD",5135,"KRN","B",870,870)

"BLD",5135,"KRN","B",8989.51,8989.51)

"BLD",5135,"KRN","B",8989.52,8989.52)

"BLD",5135,"KRN","B",8994,8994)

"BLD",5135,"QUES",0)
^9.62^^
"BLD",5135,"REQB",0)
^9.611^1^1
"BLD",5135,"REQB",1,0)
FB*3.5*61^2
"BLD",5135,"REQB","B","FB*3.5*61",1)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
67^3031030^100906
"PKG",60,22,1,"PAH",1,1,0)
^^1^1^3031030
"PKG",60,22,1,"PAH",1,1,1,0)
PROBLEM WITH MULTIPLE PAYMENT ENTRY
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","FBAAMP")
0^1^B63835336
"RTN","FBAAMP",1,0)
FBAAMP ;AISC/CMR-MULTIPLE PAYMENT ENTRY ;9/29/2003
"RTN","FBAAMP",2,0)
 ;;3.5;FEE BASIS;**4,21,38,55,61,67**;JAN 30, 1995
"RTN","FBAAMP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAMP",4,0)
 S FBMP=1 ;multiple payment flag
"RTN","FBAAMP",5,0)
 G ^FBAACO
"RTN","FBAAMP",6,0)
1 ;return from FBAACO
"RTN","FBAAMP",7,0)
 D MMPPT^FBAACP G:$G(FBAAOUT) Q1
"RTN","FBAAMP",8,0)
 D MPDT I 'FBMPDT G Q1
"RTN","FBAAMP",9,0)
 K FBAAOUT W ! D CPTM^FBAALU(FBMPDT,DFN) I 'FBGOT G Q1
"RTN","FBAAMP",10,0)
 ; prompt revenue code
"RTN","FBAAMP",11,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",12,0)
 ; prompt units paid
"RTN","FBAAMP",13,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",14,0)
 S FY=$E(DT,1,3)+1700+$S($E(DT,4,5)>9:1,1:0)
"RTN","FBAAMP",15,0)
 D ASKZIP^FBAAFS($G(FBV)) I $G(FBAAOUT)!($G(FBZIP)']"") G Q1
"RTN","FBAAMP",16,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G Q1
"RTN","FBAAMP",17,0)
 D HCFA^FBAAMP1 G Q1:$G(FBAAOUT)
"RTN","FBAAMP",18,0)
AMTCL S DIR(0)="162.03,1",DIR("A")="Amount Claimed:  $",DIR("?")="Enter the amount being claimed by the vendor" D ^DIR K DIR G Q:$D(DIRUT) S FBJ=+Y
"RTN","FBAAMP",19,0)
 W ! S DIR("A")="Is $"_FBJ_" correct for Amount Claimed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),AMTCL:'Y
"RTN","FBAAMP",20,0)
RDAP D FEE G Q:$G(FBAAOUT) S FBK=FBAMTPD
"RTN","FBAAMP",21,0)
 W ! S DIR("A")="Is $"_FBK_" correct for Amount Paid",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),RDAP:'Y
"RTN","FBAAMP",22,0)
 S FBAAAS=0 K FBADJ I FBJ-FBK D SUSP^FBAAMP1 I $G(FBAAOUT) G Q:$D(DUOUT),Q1
"RTN","FBAAMP",23,0)
 S FBJ=+FBJ,FBK=+FBK,FBAAAS=+FBAAAS
"RTN","FBAAMP",24,0)
 ; prompt for remittance remarks
"RTN","FBAAMP",25,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G Q1
"RTN","FBAAMP",26,0)
MULT W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAAMP",27,0)
 W !! S %DT("A")="Date of Service: ",%DT="AEPX" D ^%DT G Q1:X=""!(X="^")
"RTN","FBAAMP",28,0)
 D DATCK^FBAAUTL G MULT:'$D(X)!(Y<0)
"RTN","FBAAMP",29,0)
 S FBDT=Y
"RTN","FBAAMP",30,0)
 I '$$CHKCPT() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",31,0)
 I $$CHKICD9^FBCSV1(+$G(FBHCFA(28)),$G(FBDT))="" G MULT
"RTN","FBAAMP",32,0)
 I '$G(FBAAMM1),'$$CHKFS() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",33,0)
 S DIR(0)="Y",DIR("A")="Is "_($$DATX^FBAAUTL(FBDT))_" correct",DIR("B")="Yes" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",34,0)
 S FBAADT=FBDT
"RTN","FBAAMP",35,0)
 S FBMODL=$$MODL^FBAAUTL4("FBMODA","I")
"RTN","FBAAMP",36,0)
 I $D(^FBAAC("AE",DFN,FBV,FBAADT,FBAACP_$S($G(FBMODL)]"":"-"_FBMODL,1:""))) S DIR(0)="Y",DIR("A")="Code already exists for that date!  Want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",37,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5() I FBFPPSL=-1 G Q1
"RTN","FBAAMP",38,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) G Q:$G(FBAAOUT)
"RTN","FBAAMP",39,0)
 D SETO^FBAACO3,SVCPR^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBAAMP",40,0)
FILE S TP="",DR="1///^S X=FBJ;Q;2///^S X=FBK;47///^S X=FBUNITS"
"RTN","FBAAMP",41,0)
 I FBCSID]"" S DR=DR_";49///^S X=FBCSID"
"RTN","FBAAMP",42,0)
 I FBFPPSC]"" S DR=DR_";50///^S X=FBFPPSC;51///^S X=FBFPPSL"
"RTN","FBAAMP",43,0)
 I FBAARC]"" S DR=DR_";48////^S X=FBAARC"
"RTN","FBAAMP",44,0)
 ;S DR=DR_$S(FBJ-FBK:";3///^S X=FBAAAS;3.5////^S X=DT;4////^S X=FBAASC;D DESC^FBAAMP1",1:"")
"RTN","FBAAMP",45,0)
 S DR(1,162.03,1)="6////^S X=DUZ;7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;15///^S X=FBPT;16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=2;26////^S X=FBPSA"
"RTN","FBAAMP",46,0)
 S DR(1,162.03,2)="34///^S X=$G(FBAAMM1);28////^S X=FBHCFA(28);30////^S X=FBHCFA(30);31////^S X=FBHCFA(31);32////^S X=FBHCFA(32);33///^S X=FBAAVID;44///^S X=FBFSAMT;45////^S X=FBFSUSD"
"RTN","FBAAMP",47,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAAMP",48,0)
 S DA=FBAACPI,DA(1)=FBSDI,DA(2)=FBV,DA(3)=DFN
"RTN","FBAAMP",49,0)
 D LOCK^FBUCUTL(DIE,FBAACPI,1)
"RTN","FBAAMP",50,0)
 D ^DIE
"RTN","FBAAMP",51,0)
 D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAAMP",52,0)
 D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAAMP",53,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAAMP",54,0)
 S FBINTOT=FBINTOT+FBK
"RTN","FBAAMP",55,0)
 W " ....OK, DONE...."
"RTN","FBAAMP",56,0)
 I FBK>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAAMP",57,0)
 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line items!" I Z1>(FBAAMPI-1) D  S FBMAX=1 G Q1
"RTN","FBAAMP",58,0)
 .W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAAMP",59,0)
 G MULT
"RTN","FBAAMP",60,0)
Q1 K FBADJ,FBAADT,FBX,FBAACP,DIC,DIE,X,Y,DIRUT,DUOUT,DTOUT,FBOUT,FBSI,FBMPDT G ^FBAACO:$D(FBMAX),1^FBAACO
"RTN","FBAAMP",61,0)
 ;
"RTN","FBAAMP",62,0)
Q ;kill variables and exit
"RTN","FBAAMP",63,0)
 D Q^FBAACO
"RTN","FBAAMP",64,0)
 Q
"RTN","FBAAMP",65,0)
 ;
"RTN","FBAAMP",66,0)
MPDT ;
"RTN","FBAAMP",67,0)
 S FBMPDT=""
"RTN","FBAAMP",68,0)
 S DIR(0)="D^::EX"
"RTN","FBAAMP",69,0)
 S DIR("A")="Enter date to use for CPT/ICD checks and fee schedule calc"
"RTN","FBAAMP",70,0)
 S DIR("B")="TODAY"
"RTN","FBAAMP",71,0)
 S DIR("?",1)="Enter a date. This date will be used when checking for"
"RTN","FBAAMP",72,0)
 S DIR("?",2)="an active CPT/Modifier/ICD code. Also, the fee schedule"
"RTN","FBAAMP",73,0)
 S DIR("?",3)="amount will be computed based on this date."
"RTN","FBAAMP",74,0)
 S DIR("?")="Enter '^' to exit."
"RTN","FBAAMP",75,0)
 W !
"RTN","FBAAMP",76,0)
 D ^DIR K DIR S:'$D(DIRUT) FBMPDT=Y
"RTN","FBAAMP",77,0)
 Q
"RTN","FBAAMP",78,0)
 ;
"RTN","FBAAMP",79,0)
FEE N FBX,FB1725
"RTN","FBAAMP",80,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",81,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",82,0)
 S FBFY=FY-1
"RTN","FBAAMP",83,0)
 S (FBFSAMT,FBFSUSD,FBAMFS)=""
"RTN","FBAAMP",84,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBMPDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAAMP",85,0)
 ;
"RTN","FBAAMP",86,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",87,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAAMP",88,0)
 E  D
"RTN","FBAAMP",89,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAAMP",90,0)
 ;
"RTN","FBAAMP",91,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAAMP",92,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAAMP",93,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAAMP",94,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAAMP",95,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAAMP",96,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAAMP",97,0)
 ;
"RTN","FBAAMP",98,0)
 I FB1725 D
"RTN","FBAAMP",99,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAAMP",100,0)
 . I FBFSAMT D
"RTN","FBAAMP",101,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAAMP",102,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAAMP",103,0)
 ;
"RTN","FBAAMP",104,0)
 I $G(FBUNITS)>1 D
"RTN","FBAAMP",105,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAAMP",106,0)
 . Q:FBFSAMT'>0
"RTN","FBAAMP",107,0)
 . N FBFSUNIT
"RTN","FBAAMP",108,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAAMP",109,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBMPDT>3040930):1,1:0)
"RTN","FBAAMP",110,0)
 . I FBFSUNIT D
"RTN","FBAAMP",111,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAAMP",112,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAAMP",113,0)
 . E  D
"RTN","FBAAMP",114,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAAMP",115,0)
 ;
"RTN","FBAAMP",116,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",117,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAAMP",118,0)
 . S FBAMFS=$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT)
"RTN","FBAAMP",119,0)
 ;
"RTN","FBAAMP",120,0)
 W !
"RTN","FBAAMP",121,0)
 ;
"RTN","FBAAMP",122,0)
AMTPD S DIR(0)="162.5,9",DIR("A")="Amount Paid: $",DIR("B")=$G(FBAMFS),DIR("?")="^D HELP1^FBAAMP" K:$G(FBAMFS)="" DIR("B") D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP",123,0)
 I +Y>FBJ W !!,*7,"Amount paid cannot be greater than the amount claimed." G AMTPD
"RTN","FBAAMP",124,0)
 I FBAMFS]"" I +Y>FBAMFS&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' key in order to",!,"exceed the Fee Schedule.",! G AMTPD
"RTN","FBAAMP",125,0)
 S FBAMTPD=+Y K FBAMFS Q
"RTN","FBAAMP",126,0)
HELP1 W !!,"Enter a dollar amount that does not exceed the amount claimed.",!
"RTN","FBAAMP",127,0)
 I FBAMFS>0 W "Only the holder of the 'FBAASUPERVISOR' key may exceed the",!,"Fee Schedule.",!
"RTN","FBAAMP",128,0)
 Q
"RTN","FBAAMP",129,0)
 ;
"RTN","FBAAMP",130,0)
CHKCPT() ; check if CPT/Modifer active on date of service
"RTN","FBAAMP",131,0)
 N FBCPTX,FBI,FBMOD,FBMODX,FBRET
"RTN","FBAAMP",132,0)
 S FBRET=1
"RTN","FBAAMP",133,0)
 S FBCPTX=$$CPT^ICPTCOD(FBAACP,FBDT,1)
"RTN","FBAAMP",134,0)
 I '$P(FBCPTX,U,7) S FBRET=0 W !,"  CPT Code ",$P(FBCPTX,U,2)," inactive on date of service."
"RTN","FBAAMP",135,0)
 I $O(FBMODA(0)) D
"RTN","FBAAMP",136,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAAMP",137,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",FBDT,1)
"RTN","FBAAMP",138,0)
 . . I '$P(FBMODX,U,7) S FBRET=0 W !,"  CPT Modifier ",$P(FBMODX,U,2)," inactive on date of service."
"RTN","FBAAMP",139,0)
 Q FBRET
"RTN","FBAAMP",140,0)
 ;
"RTN","FBAAMP",141,0)
CHKFS() ; check if fee schedule amount is different on date of service
"RTN","FBAAMP",142,0)
 N FBX,FBRET,FB1725
"RTN","FBAAMP",143,0)
 S FBRET=1 ; return value - true if date of service allowed
"RTN","FBAAMP",144,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",145,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",146,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAAMP",147,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",148,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",149,0)
 ; adjust amount if mill bill
"RTN","FBAAMP",150,0)
 I FB1725 S $P(FBX,U)=$J($P(FBX,U)*.7,0,2)
"RTN","FBAAMP",151,0)
 ; adjust amount if units > 1
"RTN","FBAAMP",152,0)
 I $G(FBUNITS) D
"RTN","FBAAMP",153,0)
 . N FBFSUNIT
"RTN","FBAAMP",154,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAAMP",155,0)
 . S FBFSUNIT=$S($P(FBX,U,2)="R":1,$P(FBX,U,2)="F"&(FBDT>3040930):1,1:0)
"RTN","FBAAMP",156,0)
 . I FBFSUNIT S $P(FBX,U)=$J($P(FBX,U)*FBUNITS,0,2)
"RTN","FBAAMP",157,0)
 ; issue warning if lesser of claim and fee schedule amount different
"RTN","FBAAMP",158,0)
 I +$S($P(FBX,U)>$G(FBJ):$G(FBJ),1:$P(FBX,U))'=+$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT) D
"RTN","FBAAMP",159,0)
 . W !,"  Warning: The fee schedule amount (",$P(FBX,U),") for this date of service "
"RTN","FBAAMP",160,0)
 . W !,"  differs from the initial fee schedule amount (",FBFSAMT,")."
"RTN","FBAAMP",161,0)
 . I $P(FBX,U)>0,FBK>$P(FBX,U) D
"RTN","FBAAMP",162,0)
 . . W !,"  Amount paid (",FBK,") exceeds the fee schedule amount."
"RTN","FBAAMP",163,0)
 . . I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) D
"RTN","FBAAMP",164,0)
 . . . W !,"  You must be a holder of the 'FBAASUPERVISOR' key in order"
"RTN","FBAAMP",165,0)
 . . . W !,"  to exceed the Fee Schedule."
"RTN","FBAAMP",166,0)
 . . . S FBRET=0
"RTN","FBAAMP",167,0)
 . W:FBRET !,"  You may want to separately process this date of service."
"RTN","FBAAMP",168,0)
 Q FBRET
"RTN","FBAAMP",169,0)
 ;
"RTN","FBAAMP",170,0)
ANCIL ;ENTRY POINT FOR mutiple ancillary payment option
"RTN","FBAAMP",171,0)
 S FBCHCO=1 D ^FBAAMP
"RTN","FBAAMP",172,0)
 K FBCHCO Q
"VER")
8.0^22
**END**
**END**
