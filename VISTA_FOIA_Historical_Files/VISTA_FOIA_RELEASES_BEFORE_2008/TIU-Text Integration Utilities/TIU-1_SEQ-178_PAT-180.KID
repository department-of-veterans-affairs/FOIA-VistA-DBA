Released TIU*1*180 SEQ #178
Extracted from mail message
**KIDS**:TIU*1.0*180^

**INSTALL NAME**
TIU*1.0*180
"BLD",4945,0)
TIU*1.0*180^TEXT INTEGRATION UTILITIES^0^3050328^y
"BLD",4945,1,0)
^^2^2^3050125^^^^
"BLD",4945,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",4945,1,2,0)
under TIU*1.0*180.
"BLD",4945,4,0)
^9.64PA^^
"BLD",4945,"KRN",0)
^9.67PA^8989.52^19
"BLD",4945,"KRN",.4,0)
.4
"BLD",4945,"KRN",.401,0)
.401
"BLD",4945,"KRN",.402,0)
.402
"BLD",4945,"KRN",.403,0)
.403
"BLD",4945,"KRN",.5,0)
.5
"BLD",4945,"KRN",.84,0)
.84
"BLD",4945,"KRN",3.6,0)
3.6
"BLD",4945,"KRN",3.8,0)
3.8
"BLD",4945,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",4945,"KRN",9.2,0)
9.2
"BLD",4945,"KRN",9.8,0)
9.8
"BLD",4945,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4945,"KRN",9.8,"NM",1,0)
TIUSUPN^^0^B33132269
"BLD",4945,"KRN",9.8,"NM",2,0)
TIUSUPN1^^0^B6890812
"BLD",4945,"KRN",9.8,"NM",3,0)
TIUSUPN2^^0^B5855306
"BLD",4945,"KRN",9.8,"NM",4,0)
TIUPNAPI^^0^B17865619
"BLD",4945,"KRN",9.8,"NM","B","TIUPNAPI",4)

"BLD",4945,"KRN",9.8,"NM","B","TIUSUPN",1)

"BLD",4945,"KRN",9.8,"NM","B","TIUSUPN1",2)

"BLD",4945,"KRN",9.8,"NM","B","TIUSUPN2",3)

"BLD",4945,"KRN",19,0)
19
"BLD",4945,"KRN",19,"NM",0)
^9.68A^5^3
"BLD",4945,"KRN",19,"NM",1,0)
TIU SIGNED PN UNSIGNED STATUS^^0
"BLD",4945,"KRN",19,"NM",2,0)
TIU SIGNED/UNSIGNED PN^^0
"BLD",4945,"KRN",19,"NM",5,0)
TIU MAIN MENU MGR^^2
"BLD",4945,"KRN",19,"NM","B","TIU MAIN MENU MGR",5)

"BLD",4945,"KRN",19,"NM","B","TIU SIGNED PN UNSIGNED STATUS",1)

"BLD",4945,"KRN",19,"NM","B","TIU SIGNED/UNSIGNED PN",2)

"BLD",4945,"KRN",19.1,0)
19.1
"BLD",4945,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4945,"KRN",101,0)
101
"BLD",4945,"KRN",101,"NM",0)
^9.68A^7^6
"BLD",4945,"KRN",101,"NM",2,0)
TIU SIGNED/UNSIGNED DETAIL DISPLAY^^0
"BLD",4945,"KRN",101,"NM",3,0)
TIU SIGNED/UNSIGNED UPDATE^^0
"BLD",4945,"KRN",101,"NM",4,0)
TIU SIGNED/UNSIGNED BROWSE^^0
"BLD",4945,"KRN",101,"NM",5,0)
TIU SIGNED/UNSIGNED MENU^^0
"BLD",4945,"KRN",101,"NM",6,0)
TIU SIGNED/UNSIGNED SELECT^^0
"BLD",4945,"KRN",101,"NM",7,0)
TIU SIGNED/UNSIGNED QUIT^^0
"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED BROWSE",4)

"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED DETAIL DISPLAY",2)

"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED MENU",5)

"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED QUIT",7)

"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED SELECT",6)

"BLD",4945,"KRN",101,"NM","B","TIU SIGNED/UNSIGNED UPDATE",3)

"BLD",4945,"KRN",409.61,0)
409.61
"BLD",4945,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",4945,"KRN",409.61,"NM",1,0)
TIU SIGNED/UNSIGNED^^0
"BLD",4945,"KRN",409.61,"NM","B","TIU SIGNED/UNSIGNED",1)

"BLD",4945,"KRN",771,0)
771
"BLD",4945,"KRN",771,"NM",0)
^9.68A^^
"BLD",4945,"KRN",870,0)
870
"BLD",4945,"KRN",8989.51,0)
8989.51
"BLD",4945,"KRN",8989.52,0)
8989.52
"BLD",4945,"KRN",8994,0)
8994
"BLD",4945,"KRN","B",.4,.4)

"BLD",4945,"KRN","B",.401,.401)

"BLD",4945,"KRN","B",.402,.402)

"BLD",4945,"KRN","B",.403,.403)

"BLD",4945,"KRN","B",.5,.5)

"BLD",4945,"KRN","B",.84,.84)

"BLD",4945,"KRN","B",3.6,3.6)

"BLD",4945,"KRN","B",3.8,3.8)

"BLD",4945,"KRN","B",9.2,9.2)

"BLD",4945,"KRN","B",9.8,9.8)

"BLD",4945,"KRN","B",19,19)

"BLD",4945,"KRN","B",19.1,19.1)

"BLD",4945,"KRN","B",101,101)

"BLD",4945,"KRN","B",409.61,409.61)

"BLD",4945,"KRN","B",771,771)

"BLD",4945,"KRN","B",870,870)

"BLD",4945,"KRN","B",8989.51,8989.51)

"BLD",4945,"KRN","B",8989.52,8989.52)

"BLD",4945,"KRN","B",8994,8994)

"BLD",4945,"QUES",0)
^9.62^^
"BLD",4945,"REQB",0)
^9.611^1^1
"BLD",4945,"REQB",1,0)
TIU*1.0*175^2
"BLD",4945,"REQB","B","TIU*1.0*175",1)

"KRN",19,9686,-1)
2^5
"KRN",19,9686,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^64^^^^^^y^362^^1^^^1
"KRN",19,9686,10,0)
^19.01IP^17^16
"KRN",19,9686,10,17,0)
11971^9
"KRN",19,9686,10,17,"^")
TIU SIGNED/UNSIGNED PN
"KRN",19,9686,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,11940,-1)
0^1
"KRN",19,11940,0)
TIU SIGNED PN UNSIGNED STATUS^Signed/unsigned PN daily search^^R^^^^^^^^TEXT INTEGRATION UTILITIES^^
"KRN",19,11940,20)

"KRN",19,11940,25)
EN^TIUSUPN2
"KRN",19,11940,200.9)
y
"KRN",19,11940,"U")
SIGNED/UNSIGNED PN DAILY SEARC
"KRN",19,11971,-1)
0^2
"KRN",19,11971,0)
TIU SIGNED/UNSIGNED PN^Signed/unsigned PN report and update^^R^^^^^^^^TEXT INTEGRATION UTILITIES^^^
"KRN",19,11971,1,0)
^19.06^2^2^3050321^^
"KRN",19,11971,1,1,0)
This option allows end-users to search for signed Progress Notes that are 
"KRN",19,11971,1,2,0)
filed as unsigned.
"KRN",19,11971,15)

"KRN",19,11971,25)
EN^TIUSUPN
"KRN",19,11971,"U")
SIGNED/UNSIGNED PN REPORT AND 
"KRN",101,5455,-1)
0^2
"KRN",101,5455,0)
TIU SIGNED/UNSIGNED DETAIL DISPLAY^Detailed Display^^A^^^^^^^^
"KRN",101,5455,2,0)
^101.02A^1^1
"KRN",101,5455,2,1,0)
DD
"KRN",101,5455,2,"B","DD",1)

"KRN",101,5455,15)
S VALMBCK="R"
"KRN",101,5455,20)
D SELECT^TIUSUPN("DISP^TIUSUPN1")
"KRN",101,5455,99)
59959,48933
"KRN",101,5456,-1)
0^3
"KRN",101,5456,0)
TIU SIGNED/UNSIGNED UPDATE^Status Update^^A^^^^^^^^
"KRN",101,5456,2,0)
^101.02A^1^1
"KRN",101,5456,2,1,0)
SU
"KRN",101,5456,2,"B","SU",1)

"KRN",101,5456,15)
S VALMBCK="R"
"KRN",101,5456,20)
D SELECT^TIUSUPN("UPDTDOC^TIUSUPN1")
"KRN",101,5456,99)
59962,43191
"KRN",101,5457,-1)
0^4
"KRN",101,5457,0)
TIU SIGNED/UNSIGNED BROWSE^Browse^^A^^^^^^^^
"KRN",101,5457,10,0)
^101.01PA
"KRN",101,5457,15)
S VALMBCK="R"
"KRN",101,5457,20)
D SELECT^TIUSUPN("BROWSE^TIUSUPN1")
"KRN",101,5457,99)
59959,48933
"KRN",101,5458,-1)
0^5
"KRN",101,5458,0)
TIU SIGNED/UNSIGNED MENU^TIU signed/unsigned menu^^M^^^^^^^^
"KRN",101,5458,4)
40
"KRN",101,5458,10,0)
^101.01PA^4^4
"KRN",101,5458,10,1,0)
5455^^2^
"KRN",101,5458,10,1,"^")
TIU SIGNED/UNSIGNED DETAIL DISPLAY
"KRN",101,5458,10,2,0)
5456^^3^
"KRN",101,5458,10,2,"^")
TIU SIGNED/UNSIGNED UPDATE
"KRN",101,5458,10,3,0)
5457^^1^
"KRN",101,5458,10,3,"^")
TIU SIGNED/UNSIGNED BROWSE
"KRN",101,5458,10,4,0)
5544^^4^
"KRN",101,5458,10,4,"^")
TIU SIGNED/UNSIGNED QUIT
"KRN",101,5458,15)
D EXIT^TIUSUPN
"KRN",101,5458,26)
D SHOW^VALM
"KRN",101,5458,28)
Select action:
"KRN",101,5458,99)
59976,38714
"KRN",101,5542,-1)
0^6
"KRN",101,5542,0)
TIU SIGNED/UNSIGNED SELECT^^^A^^^^^^^^
"KRN",101,5542,15)
S VALMBCK="R"
"KRN",101,5542,20)
D SELECT^TIUSUPN("ACTIONS")
"KRN",101,5544,-1)
0^7
"KRN",101,5544,0)
TIU SIGNED/UNSIGNED QUIT^Quit^^A^^^^^^^^
"KRN",101,5544,20)
Q
"KRN",101,5544,99)
59976,38658
"KRN",409.61,618,-1)
0^1
"KRN",409.61,618,0)
TIU SIGNED/UNSIGNED^1^^80^5^18^1^1^^TIU SIGNED/UNSIGNED MENU^TIU SIGNED/UNSIGNED^1^^1
"KRN",409.61,618,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,618,"COL",0)
^409.621^5^5
"KRN",409.61,618,"COL",1,0)
PATIENT^6^7^Patient^^0
"KRN",409.61,618,"COL",2,0)
DOCUMENT^28^10^Document^^0
"KRN",409.61,618,"COL",3,0)
AUTHOR^38^6^Author^^0
"KRN",409.61,618,"COL",4,0)
ENTRY DATE^58^10^Entry date^^0
"KRN",409.61,618,"COL",5,0)
STATUS^70^10^Status^^0
"KRN",409.61,618,"COL","AIDENT",0,1)

"KRN",409.61,618,"COL","AIDENT",0,2)

"KRN",409.61,618,"COL","AIDENT",0,3)

"KRN",409.61,618,"COL","AIDENT",0,4)

"KRN",409.61,618,"COL","AIDENT",0,5)

"KRN",409.61,618,"COL","B","AUTHOR",3)

"KRN",409.61,618,"COL","B","DOCUMENT",2)

"KRN",409.61,618,"COL","B","ENTRY DATE",4)

"KRN",409.61,618,"COL","B","PATIENT",1)

"KRN",409.61,618,"COL","B","STATUS",5)

"KRN",409.61,618,"FNL")
D EXIT^TIUSUPN
"KRN",409.61,618,"HDR")
D HDR^TIUSUPN
"KRN",409.61,618,"HLP")
D HELP^TIUSUPN
"KRN",409.61,618,"INIT")
D INIT^TIUSUPN
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",362,-1)
1^1
"PKG",362,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",362,20,0)
^9.402P^^
"PKG",362,22,0)
^9.49I^1^1
"PKG",362,22,1,0)
1.0^3010119^2970819^64
"PKG",362,22,1,"PAH",1,0)
180^3050328^222222279
"PKG",362,22,1,"PAH",1,1,0)
^^2^2^3050328
"PKG",362,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",362,22,1,"PAH",1,1,2,0)
under TIU*1.0*180.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUPNAPI")
0^4^B17865619
"RTN","TIUPNAPI",1,0)
TIUPNAPI ; SLC/JER - API to Replace GMRPAPI ; 3/17/04
"RTN","TIUPNAPI",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**57,140,175,180**;Jun 20, 1997
"RTN","TIUPNAPI",3,0)
NEW(TIUIFN,DFN,TIUAUTH,TIURDT,TIUTITLE,TIULOC,TIUES,TIUPRT,TIUESBY,TIUASKVS,TIUADEL) ;
"RTN","TIUPNAPI",4,0)
 ; -- Create new note
"RTN","TIUPNAPI",5,0)
 ; Return variable (must pass by reference):
"RTN","TIUPNAPI",6,0)
 ;      TIUIFN (pass by ref) = New note IFN in file 8925, -1 if error,
"RTN","TIUPNAPI",7,0)
 ;                           = IFN^0 if note filed, w/o signature when
"RTN","TIUPNAPI",8,0)
 ;                             TIUES=1
"RTN","TIUPNAPI",9,0)
 ; Required Input parameters:
"RTN","TIUPNAPI",10,0)
 ;      DFN                  = Patient IFN in file #2
"RTN","TIUPNAPI",11,0)
 ;      TIUAUTH              = Author IFN in file #200
"RTN","TIUPNAPI",12,0)
 ;      TIURDT               = Date/time of note in FM format
"RTN","TIUPNAPI",13,0)
 ;      TIUTITLE             = Title IFN in file 8925.1
"RTN","TIUPNAPI",14,0)
 ; Required global variable:
"RTN","TIUPNAPI",15,0)
 ;      ^TMP("TIUP",$J)      = Array root for text in format compatible
"RTN","TIUPNAPI",16,0)
 ;                             w/FM Word-processing fields. e.g.,
"RTN","TIUPNAPI",17,0)
 ;                             ^TMP("TIUP",$J,0)=^^1^1^2961216^
"RTN","TIUPNAPI",18,0)
 ;                             ^TMP("TIUP",$J,1,0)=Testing the TIUPNAPI.
"RTN","TIUPNAPI",19,0)
 ; 
"RTN","TIUPNAPI",20,0)
 ;                             NOTE: you no longer need to use the
"RTN","TIUPNAPI",21,0)
 ;                             additional subscript to designate where
"RTN","TIUPNAPI",22,0)
 ;                             the text should go (e.g., 10 for Admission
"RTN","TIUPNAPI",23,0)
 ;                             Note).
"RTN","TIUPNAPI",24,0)
 ; Optional Input variables:
"RTN","TIUPNAPI",25,0)
 ;      TIULOC              = Patient Location IFN in file #44
"RTN","TIUPNAPI",26,0)
 ;      TIUES               = 1 if TIU should prompt/process E-SIG
"RTN","TIUPNAPI",27,0)
 ;      TIUPRT              = 1 if TIU should prompt user to print note
"RTN","TIUPNAPI",28,0)
 ;      TIUESBY             = Signer IFN in file #200:  Calling App is
"RTN","TIUPNAPI",29,0)
 ;                            resonsible for Electronic Signature
"RTN","TIUPNAPI",30,0)
 ;      TIUASKVS            = BOOLEAN flag indicating whether to ask for visit
"RTN","TIUPNAPI",31,0)
 ;      NOTE: If TIUESBY is passed, the document will be marked as
"RTN","TIUPNAPI",32,0)
 ;            signed at the time the encrypted signature block name
"RTN","TIUPNAPI",33,0)
 ;            and title are filed...It is NOT necessary to pass a
"RTN","TIUPNAPI",34,0)
 ;            signature date/time, as GNEW^GMRPAPI permitted
"RTN","TIUPNAPI",35,0)
 ;      TIUADEL             = BOOLEAN flag for automatic delete if TIUESBY>0 and
"RTN","TIUPNAPI",36,0)
 ;                            signature fails instead of leaving UNSIGNED doc.
"RTN","TIUPNAPI",37,0)
 ;
"RTN","TIUPNAPI",38,0)
 N TIUX,TIUCHNG,TIUHIT,TIUPRM0,TIUPRM1,TIUTYP,TIUOUT,TIUDPRM,TIUVSTR
"RTN","TIUPNAPI",39,0)
 S TIUIFN=-1
"RTN","TIUPNAPI",40,0)
 I $D(^TMP("TIUP",$J))'>9 Q  ; If no text, quit
"RTN","TIUPNAPI",41,0)
 I '$D(^DPT(+$G(DFN),0)) G EXIT ; if not valid patient, clean-up & quit
"RTN","TIUPNAPI",42,0)
 I $L($$GET1^DIQ(200,+$G(TIUAUTH),.01))'>0 G EXIT ; if not valid author, clean-up & quit
"RTN","TIUPNAPI",43,0)
 I '$D(^TIU(8925.1,+$G(TIUTITLE),0)) G EXIT ; if not valid title, clean-up & quit
"RTN","TIUPNAPI",44,0)
 I $S(+$G(TIURDT)'>0:1,+$G(TIURDT)>+$$NOW^XLFDT:1,+$$FMTH^XLFDT(TIURDT)'>0:1,1:0) G EXIT
"RTN","TIUPNAPI",45,0)
 I $S('($D(DUZ)#2):1,$L($$GET1^DIQ(200,DUZ,.01))'>0:1,1:0) G EXIT
"RTN","TIUPNAPI",46,0)
 S TIUASKVS=+$G(TIUASKVS)
"RTN","TIUPNAPI",47,0)
 ; -- Okay, create new note
"RTN","TIUPNAPI",48,0)
 S TIUX(1202)=TIUAUTH,TIUX(1301)=TIURDT
"RTN","TIUPNAPI",49,0)
 ; get doc parameters
"RTN","TIUPNAPI",50,0)
 D DOCPRM^TIULC1(TIUTITLE,.TIUDPRM)
"RTN","TIUPNAPI",51,0)
 I +$$REQCOSIG^TIULP(TIUTITLE,"",TIUAUTH) D  G:+$G(TIUOUT) EXIT
"RTN","TIUPNAPI",52,0)
 . Q:$D(ZTQUEUED)  ; If called from a task, don't go interactive
"RTN","TIUPNAPI",53,0)
 . Q:$D(XWBOS)  ; If called from RPCBroker app, don't go interactive
"RTN","TIUPNAPI",54,0)
 . S TIUX(1506)=1
"RTN","TIUPNAPI",55,0)
 . S TIUX(1208)=$$GETCOSNR
"RTN","TIUPNAPI",56,0)
 . I TIUX(1208)'>0 S TIUOUT=1,TIUIFN=-1
"RTN","TIUPNAPI",57,0)
 I +TIUASKVS D  G:+$G(TIUOUT) EXIT
"RTN","TIUPNAPI",58,0)
 . N TIUBY,TIU,TIUY
"RTN","TIUPNAPI",59,0)
 . D ENPN^TIUVSIT(.TIU,DFN,1)
"RTN","TIUPNAPI",60,0)
 . I '$D(TIU) S TIUOUT=1,TIUIFN=-1 Q
"RTN","TIUPNAPI",61,0)
 . S TIUY=$$CHEKPN^TIULD(.TIU,.TIUBY)
"RTN","TIUPNAPI",62,0)
 . I '+TIUY S TIUOUT=1,TIUIFN=-1 Q
"RTN","TIUPNAPI",63,0)
 . I '$L($G(TIU("VSTR"))) S TIUOUT=1,TIUIFN=-1 Q
"RTN","TIUPNAPI",64,0)
 . S TIUVSTR=$G(TIU("VSTR")),TIULOC=+$G(TIU("LOC"))
"RTN","TIUPNAPI",65,0)
 . I +$G(TIU("STOP")),(+$P(TIUDPRM(0),U,14)'=1) S TIUX(.11)=1
"RTN","TIUPNAPI",66,0)
 M TIUX("TEXT")=^TMP("TIUP",$J)
"RTN","TIUPNAPI",67,0)
 D MAKE^TIUSRVP(.TIUIFN,DFN,TIUTITLE,TIURDT,$G(TIULOC),"",.TIUX,$G(TIUVSTR))
"RTN","TIUPNAPI",68,0)
 I +TIUIFN'>0 S TIUIFN=-1 G EXIT
"RTN","TIUPNAPI",69,0)
 I '+$G(TIUESBY),(+$G(TIUES)>0) D  Q:'$D(^TIU(8925,+TIUIFN,0))
"RTN","TIUPNAPI",70,0)
 . N VALMBCK
"RTN","TIUPNAPI",71,0)
 . D EXSTNOTE^TIUBR1(DFN,TIUIFN) Q:'$D(^TIU(8925,+TIUIFN,0))
"RTN","TIUPNAPI",72,0)
 . I +$P(^TIU(8925,+TIUIFN,0),U,5)<6 S TIUIFN=TIUIFN_"^-1"
"RTN","TIUPNAPI",73,0)
 I +$G(TIUESBY) D MARKSIGN(.TIUIFN,+$G(TIUESBY))
"RTN","TIUPNAPI",74,0)
 I +$G(TIUESBY),+$G(TIUADEL),+$P(^TIU(8925,+TIUIFN,0),U,5)<6 D DELETE^TIUSRVP("",+TIUIFN,"",1) S TIUIFN="-1^-1" G EXIT
"RTN","TIUPNAPI",75,0)
 D SEND^TIUALRT(+TIUIFN)
"RTN","TIUPNAPI",76,0)
EXIT K ^TMP("TIUP",$J)
"RTN","TIUPNAPI",77,0)
 Q
"RTN","TIUPNAPI",78,0)
WHATITLE(X) ; -- Given a freetext title, return pointer to file 8925.1
"RTN","TIUPNAPI",79,0)
 Q $$WHATITLE^TIUPUTU(X)
"RTN","TIUPNAPI",80,0)
GETCOSNR() ; Ask Expected Cosigner
"RTN","TIUPNAPI",81,0)
 N TIUY
"RTN","TIUPNAPI",82,0)
 S TIUY=$$READ^TIUU("P^200:AEMQ","EXPECTED COSIGNER")
"RTN","TIUPNAPI",83,0)
 Q +$G(TIUY)
"RTN","TIUPNAPI",84,0)
MARKSIGN(TIUDA,TIUESBY) ; Mark note as electronically signed
"RTN","TIUPNAPI",85,0)
 N ESNAME,ESTITLE,ESBLOCK
"RTN","TIUPNAPI",86,0)
 I $S(+$G(TIUESBY)'>0:1,$L($$GET1^DIQ(200,+$G(TIUESBY),.01))'>0:1,+$$CANDO^TIULP(TIUDA,"SIGNATURE",$G(TIUESBY))'>0:1,1:0) S TIUDA=TIUDA_U_-1 Q
"RTN","TIUPNAPI",87,0)
 S ESNAME=$$GET1^DIQ(200,+TIUESBY,20.2),ESTITLE=$$GET1^DIQ(200,+TIUESBY,20.3)
"RTN","TIUPNAPI",88,0)
 S ESBLOCK="1^"_ESNAME_U_ESTITLE
"RTN","TIUPNAPI",89,0)
 D ES^TIURS(TIUDA,ESBLOCK)
"RTN","TIUPNAPI",90,0)
 I +$P(^TIU(8925,+TIUIFN,0),U,5)<6 S TIUDA=TIUDA_"^-1"
"RTN","TIUPNAPI",91,0)
 Q
"RTN","TIUPNAPI",92,0)
TEST ; Interactive Test
"RTN","TIUPNAPI",93,0)
 N DUOUT,DFN,TITLE,TIUTYP,TIURDT,TIUDA,DIC K ^TMP("TIUP",$J)
"RTN","TIUPNAPI",94,0)
 W !,"First, collect the data to pass to the API...",!
"RTN","TIUPNAPI",95,0)
 S DFN=+$$PATIENT^TIULA Q:+DFN'>0
"RTN","TIUPNAPI",96,0)
 D DOCSPICK^TIULA2(.TIUTYP,3,"1A","","","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)")
"RTN","TIUPNAPI",97,0)
 S TITLE=$P($G(TIUTYP(1)),U,2) Q:+TITLE'>0
"RTN","TIUPNAPI",98,0)
 S TIURDT=+$$NOW^XLFDT
"RTN","TIUPNAPI",99,0)
 S DIC="^TMP(""TIUP"",$J," D EN^DIWE
"RTN","TIUPNAPI",100,0)
 W !,"NOW, call the API!",!
"RTN","TIUPNAPI",101,0)
 D NEW(.TIUDA,DFN,DUZ,TIURDT,TITLE,"",1,1,"",1)
"RTN","TIUPNAPI",102,0)
 Q
"RTN","TIUSUPN")
0^1^B33132269
"RTN","TIUSUPN",1,0)
TIUSUPN ;;SLC/TT - TIU SIGNED/UNSIGNED List Manager ; 04-FEB-2005
"RTN","TIUSUPN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**180**;Jun 20, 1997
"RTN","TIUSUPN",3,0)
 ;
"RTN","TIUSUPN",4,0)
 Q
"RTN","TIUSUPN",5,0)
EN ; -- main entry point for TIU SIGNED/UNSIGNED PN
"RTN","TIUSUPN",6,0)
 N TIUSDT,TIUEDT
"RTN","TIUSUPN",7,0)
 W @IOF
"RTN","TIUSUPN",8,0)
 K ^TMP("TIUPS180",$J),^TMP("TIUSEL",$J),^TMP("VALMAR",$J),^TMP("TIU180",$J)
"RTN","TIUSUPN",9,0)
 I '$$ASKRNG(.TIUSDT,.TIUEDT) Q
"RTN","TIUSUPN",10,0)
 D EN^VALM("TIU SIGNED/UNSIGNED")
"RTN","TIUSUPN",11,0)
 Q
"RTN","TIUSUPN",12,0)
 ;
"RTN","TIUSUPN",13,0)
HDR ; -- header code
"RTN","TIUSUPN",14,0)
 N HDR1,HDR2
"RTN","TIUSUPN",15,0)
 S HDR1="From "_$$FMTE^XLFDT(TIUSDT)_" to "_$$FMTE^XLFDT(TIUEDT,"D")
"RTN","TIUSUPN",16,0)
 S HDR2=$P(^TMP("TIU180",$J,"TOTAL"),U)_" "_$S($P(^TMP("TIU180",$J,"TOTAL"),U)=0:"Document",$P(^TMP("TIU180",$J,"TOTAL"),U)=1:"Document",1:"Documents")
"RTN","TIUSUPN",17,0)
 S VALMHDR(1)=$$SETSTR^VALM1(HDR1,"",(IOM-$L(HDR1))/2,$L(HDR1))
"RTN","TIUSUPN",18,0)
 S VALMHDR(2)=$$SETSTR^VALM1(HDR2,"",(IOM-$L(HDR2))/2,$L(HDR2))
"RTN","TIUSUPN",19,0)
 D XQORM
"RTN","TIUSUPN",20,0)
 Q
"RTN","TIUSUPN",21,0)
 ;
"RTN","TIUSUPN",22,0)
INIT ; Create list
"RTN","TIUSUPN",23,0)
 N TIUDATE,TIUDA,TIUIEN,TIUTM,TIUCNT,TIUDP,TIUNO,TIUTOTAL
"RTN","TIUSUPN",24,0)
 I '$G(TIUSDT)!'($G(TIUEDT)) Q
"RTN","TIUSUPN",25,0)
 S TIUDATE=TIUSDT,(TIUCNT,VALMCNT,TIUTOTAL)=0
"RTN","TIUSUPN",26,0)
 W !!,"Searching for the documents."
"RTN","TIUSUPN",27,0)
 S TIUTM("STR")=$$NOW^XLFDT
"RTN","TIUSUPN",28,0)
 F  S TIUDATE=$O(^TIU(8925,"F",TIUDATE)) Q:'TIUDATE!(TIUDATE>TIUEDT)  D
"RTN","TIUSUPN",29,0)
 .S TIUIEN=$O(^TIU(8925,"F",TIUDATE,0)),TIUCNT=TIUCNT+1 D GETINFO(TIUIEN)
"RTN","TIUSUPN",30,0)
 .W:TIUCNT#1000'>0 "."
"RTN","TIUSUPN",31,0)
 ;
"RTN","TIUSUPN",32,0)
 S TIUDA="" F  S TIUDA=$O(^TMP("TIUPS180",$J,TIUDA)) Q:TIUDA=""  D
"RTN","TIUSUPN",33,0)
 .S TIUTOTAL=+$G(TIUTOTAL)+1
"RTN","TIUSUPN",34,0)
 .S TIUDP=$$SETSTR^VALM1(TIUTOTAL,"",1,5)
"RTN","TIUSUPN",35,0)
 .S TIUDP=$$SETSTR^VALM1($P($$GET1^DIQ(8925,TIUDA,.02),",")_","_$E($P($$GET1^DIQ(8925,TIUDA,.02),",",2),1),TIUDP,6,18)
"RTN","TIUSUPN",36,0)
 .S TIUDP=$$SETSTR^VALM1("("_$$PATFMAT($P(^TIU(8925,TIUDA,0),U,2))_")",TIUDP,19,26)
"RTN","TIUSUPN",37,0)
 .S TIUDP=$$SETSTR^VALM1(TIUDA,TIUDP,28,36)
"RTN","TIUSUPN",38,0)
 .S TIUDP=$$SETSTR^VALM1($E($$GET1^DIQ(8925,TIUDA,1502),1,19),TIUDP,38,56)
"RTN","TIUSUPN",39,0)
 .S TIUDP=$$SETSTR^VALM1($P($$FMTE^XLFDT($P(^TIU(8925,TIUDA,12),U),2),"@"),TIUDP,58,68)
"RTN","TIUSUPN",40,0)
 .S TIUDP=$$SETSTR^VALM1($$GET1^DIQ(8925,TIUDA,.05),TIUDP,70,100)
"RTN","TIUSUPN",41,0)
 .D SET^VALM10(TIUTOTAL,TIUDP,TIUDA)
"RTN","TIUSUPN",42,0)
 S (VALMCNT,^TMP("TIU180",$J,"TOTAL"))=+$G(TIUTOTAL)
"RTN","TIUSUPN",43,0)
 I +$G(TIUTOTAL)'>0 D
"RTN","TIUSUPN",44,0)
 .S VALMCNT=1
"RTN","TIUSUPN",45,0)
 .D SET^VALM10(1," ",0)
"RTN","TIUSUPN",46,0)
 .S TIUNO="No records found to satisfy search criteria."
"RTN","TIUSUPN",47,0)
 .S TIUNO=$$SETSTR^VALM1(TIUNO,"",(IOM-$L(TIUNO))/2,$L(TIUNO))
"RTN","TIUSUPN",48,0)
 .D SET^VALM10(2,TIUNO,0)
"RTN","TIUSUPN",49,0)
 S TIUTM("END")=$$NOW^XLFDT
"RTN","TIUSUPN",50,0)
 W !!,"Report started:   ",$P($$FMTE^XLFDT(TIUTM("STR")),"@",2)
"RTN","TIUSUPN",51,0)
 W !,"Report finished:  ",$P($$FMTE^XLFDT(TIUTM("END")),"@",2)
"RTN","TIUSUPN",52,0)
 W !,"Total searched:   ",TIUCNT
"RTN","TIUSUPN",53,0)
 Q
"RTN","TIUSUPN",54,0)
 ;
"RTN","TIUSUPN",55,0)
GETINFO(TIUDA1) ;GET SIGNED DOCUMENT BUT UNSIGNED STATUS 
"RTN","TIUSUPN",56,0)
 ; Input  -- TIUDA1 TIU Document file (#8925) IEN
"RTN","TIUSUPN",57,0)
 ;
"RTN","TIUSUPN",58,0)
 N TIUD0,TIUD15
"RTN","TIUSUPN",59,0)
 I TIUDA1'>0 Q
"RTN","TIUSUPN",60,0)
 I '$D(^TIU(8925,TIUDA1,0))!('$D(^TIU(8925,TIUDA1,15))) Q
"RTN","TIUSUPN",61,0)
 S TIUD0=$G(^TIU(8925,TIUDA1,0)),TIUD15=$G(^TIU(8925,TIUDA1,15))
"RTN","TIUSUPN",62,0)
 I $P(TIUD0,U,5)=5,$P(TIUD15,U,1)>0 D
"RTN","TIUSUPN",63,0)
 .S ^TMP("TIUPS180",$J,TIUDA1)=""
"RTN","TIUSUPN",64,0)
 Q
"RTN","TIUSUPN",65,0)
 ;
"RTN","TIUSUPN",66,0)
HELP ; -- help code
"RTN","TIUSUPN",67,0)
 N DIR
"RTN","TIUSUPN",68,0)
 I X="?" S DIR("A")="Enter RETURN to continue or '^' to exit",DIR(0)="E"
"RTN","TIUSUPN",69,0)
 D FULL^VALM1
"RTN","TIUSUPN",70,0)
 W !!,"The following actions are available:"
"RTN","TIUSUPN",71,0)
 W !,"Browse Document  - View selected documents (if authorized)"
"RTN","TIUSUPN",72,0)
 W !,"Detailed Display   - View detailed display of selected documents (if authorized)"
"RTN","TIUSUPN",73,0)
 W !,"Update Document  - Update the status of selected documents"
"RTN","TIUSUPN",74,0)
 I $D(DIR("A")) D ^DIR
"RTN","TIUSUPN",75,0)
 S VALMBCK="R"
"RTN","TIUSUPN",76,0)
 Q
"RTN","TIUSUPN",77,0)
 ;
"RTN","TIUSUPN",78,0)
ASKRNG(TIUBEGDT,TIUENDT) ;Prompt for date range
"RTN","TIUSUPN",79,0)
 ; Input  -- None
"RTN","TIUSUPN",80,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUSUPN",81,0)
 ;           BEGDT Begin Date
"RTN","TIUSUPN",82,0)
 ;           ENDT  End Date
"RTN","TIUSUPN",83,0)
 N DIRUT,DTOUT,DUOUT,Y
"RTN","TIUSUPN",84,0)
 W !,"Please specify a date range:",!
"RTN","TIUSUPN",85,0)
 S TIUBEGDT=+$$READ^TIUU("DA^:DT:E","   Start Reference Date: ")
"RTN","TIUSUPN",86,0)
 I +$D(DIRUT)!(TIUBEGDT'>0) G ASKRNGQ
"RTN","TIUSUPN",87,0)
 S TIUENDT=+$$READ^TIUU("DA^"_TIUBEGDT_":DT:E","  Ending Reference Date: ")_"."_235959
"RTN","TIUSUPN",88,0)
 I +$D(DIRUT)!(TIUENDT'>0) G ASKRNGQ
"RTN","TIUSUPN",89,0)
 S Y=1
"RTN","TIUSUPN",90,0)
ASKRNGQ Q +$G(Y)
"RTN","TIUSUPN",91,0)
 ;
"RTN","TIUSUPN",92,0)
PATFMAT(TIUPAT) ; format patient as first letter of last name and last 4 SSN
"RTN","TIUSUPN",93,0)
 N TIUPATN,TIULAST4,TIUINIT
"RTN","TIUSUPN",94,0)
 I 'TIUPAT Q ""
"RTN","TIUSUPN",95,0)
 S TIUPATN=$$EXTERNAL^DILFD(8925,.02,"",TIUPAT)
"RTN","TIUSUPN",96,0)
 S TIULAST4=$E($$GET1^DIQ(2,$G(TIUPAT),.09),6,9)
"RTN","TIUSUPN",97,0)
 S TIUINIT=$E($P(TIUPATN,","))
"RTN","TIUSUPN",98,0)
 Q TIUINIT_TIULAST4
"RTN","TIUSUPN",99,0)
 ;
"RTN","TIUSUPN",100,0)
EXIT ; -- exit code
"RTN","TIUSUPN",101,0)
 D XQORM
"RTN","TIUSUPN",102,0)
 Q
"RTN","TIUSUPN",103,0)
 ;
"RTN","TIUSUPN",104,0)
XQORM ; default action for list manager
"RTN","TIUSUPN",105,0)
 S XQORM("#")=$O(^ORD(101,"B","TIU SIGNED/UNSIGNED SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUSUPN",106,0)
 Q
"RTN","TIUSUPN",107,0)
 ;
"RTN","TIUSUPN",108,0)
ACTIONS ; user selectable actions
"RTN","TIUSUPN",109,0)
 N ACTION
"RTN","TIUSUPN",110,0)
 D
"RTN","TIUSUPN",111,0)
 . N DIR,DIRUT,POP,X,Y
"RTN","TIUSUPN",112,0)
 . S DIR(0)="SA^1:Browse Document;2:Detailed Display;3:Status Update"
"RTN","TIUSUPN",113,0)
 . S DIR("A")="Select Action: "
"RTN","TIUSUPN",114,0)
 . S DIR("B")="Status Update"
"RTN","TIUSUPN",115,0)
 . S DIR("L",1)="1.   Browse Document"
"RTN","TIUSUPN",116,0)
 . S DIR("L",2)="2.   Detailed Display"
"RTN","TIUSUPN",117,0)
 . S DIR("L",3)="3.   Status Update"
"RTN","TIUSUPN",118,0)
 . S DIR("L",4)=""
"RTN","TIUSUPN",119,0)
 . S DIR("L")="Enter selection by typing the name, number, or abbreviation"
"RTN","TIUSUPN",120,0)
 . S DIR("?",1)="The following actions are available:"
"RTN","TIUSUPN",121,0)
 . S DIR("?",2)=""
"RTN","TIUSUPN",122,0)
 . S DIR("?",3)="Browse Document  - View selected documents (if authorized)"
"RTN","TIUSUPN",123,0)
 . S DIR("?",4)="Detailed Display   - Detailed View of selected documents (if authorized)"
"RTN","TIUSUPN",124,0)
 . S DIR("?",5)="Status Update  - Update the status of selected documents"
"RTN","TIUSUPN",125,0)
 . D ^DIR Q:$D(DIRUT) 
"RTN","TIUSUPN",126,0)
 . S ACTION=$S(+Y=1:"BROWSE^TIUSUPN1",+Y=2:"DISP^TIUSUPN1",+Y=3:"UPDTDOC^TIUSUPN1",Y=U:-1,1:-1)
"RTN","TIUSUPN",127,0)
 . Q:ACTION=-1
"RTN","TIUSUPN",128,0)
 . D @ACTION
"RTN","TIUSUPN",129,0)
 . S VALMBCK="R"
"RTN","TIUSUPN",130,0)
 Q
"RTN","TIUSUPN",131,0)
 ;
"RTN","TIUSUPN",132,0)
SELECT(ACTION) ; selects document(s) and calls ACTION
"RTN","TIUSUPN",133,0)
 N TIUDOCS,TIUSEL,TIUQUIT,TIUCNT,TIUDA
"RTN","TIUSUPN",134,0)
 D FULL^VALM1
"RTN","TIUSUPN",135,0)
 I $P(^TMP("TIU180",$J,"TOTAL"),U)=0 W !,"No documents to select." H 3 Q
"RTN","TIUSUPN",136,0)
 S TIUSEL=$P(XQORNOD(0),"=",2),TIUCNT=0
"RTN","TIUSUPN",137,0)
 I TIUSEL="" D  Q:$D(TIUQUIT)
"RTN","TIUSUPN",138,0)
 . N DIR,X,Y
"RTN","TIUSUPN",139,0)
 . S DIR("A")="Select Document(s)"
"RTN","TIUSUPN",140,0)
 . S DIR(0)="L^"_VALMBG_":"_VALMLST
"RTN","TIUSUPN",141,0)
 . D ^DIR I $D(DIRUT)!(Y=U) S TIUQUIT=1 Q
"RTN","TIUSUPN",142,0)
 . S TIUSEL=Y(0)
"RTN","TIUSUPN",143,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  D
"RTN","TIUSUPN",144,0)
 . S TIUCNT=TIUCNT+1
"RTN","TIUSUPN",145,0)
 . S TIUDOCS($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUSUPN",146,0)
 . S ^TMP("TIUSEL",$J,TIUCNT)=$P(TIUSEL,",",X)
"RTN","TIUSUPN",147,0)
 I $D(TIUDOCS)'>1 S VALMBCK="R" Q
"RTN","TIUSUPN",148,0)
 D @ACTION
"RTN","TIUSUPN",149,0)
 Q
"RTN","TIUSUPN1")
0^2^B6890812
"RTN","TIUSUPN1",1,0)
TIUSUPN1 ;SLC/TT - SIGNED DOCUMENT WITH UNSIGNED STATUS; 11/23/04
"RTN","TIUSUPN1",2,0)
 ;;1.0; TEXT INTEGRATION UTILITIES;**180**;Jun 20, 1997
"RTN","TIUSUPN1",3,0)
 ;
"RTN","TIUSUPN1",4,0)
 Q
"RTN","TIUSUPN1",5,0)
 ;
"RTN","TIUSUPN1",6,0)
UPDTDOC ;update status
"RTN","TIUSUPN1",7,0)
 N TIULINE,TIUDA,TIUSEL,TIUC
"RTN","TIUSUPN1",8,0)
 D FULL^VALM1
"RTN","TIUSUPN1",9,0)
 S TIUSEL=""
"RTN","TIUSUPN1",10,0)
 F  S TIUSEL=$O(^TMP("TIUSEL",$J,TIUSEL)) Q:'TIUSEL  D
"RTN","TIUSUPN1",11,0)
 .S TIULINE=$P(^TMP("TIUSEL",$J,TIUSEL),U)
"RTN","TIUSUPN1",12,0)
 .S TIUC(TIULINE)=$O(@VALMAR@("IDX",TIULINE,""))
"RTN","TIUSUPN1",13,0)
 .S TIUDA=TIUC(TIULINE)
"RTN","TIUSUPN1",14,0)
 .Q:'TIUDA
"RTN","TIUSUPN1",15,0)
 .I $P(^TIU(8925,TIUDA,0),U,5)=7 Q
"RTN","TIUSUPN1",16,0)
 .I $$UPDATE^TIUSUPN1(TIUDA) D
"RTN","TIUSUPN1",17,0)
 ..D FLDTEXT^VALM10(TIULINE,"STATUS",$$GET1^DIQ(8925,TIUDA,.05))
"RTN","TIUSUPN1",18,0)
 ..D SELECT^VALM10(TIULINE,1)
"RTN","TIUSUPN1",19,0)
 K VALMY S VALMBCK="R"
"RTN","TIUSUPN1",20,0)
 Q 
"RTN","TIUSUPN1",21,0)
 ;
"RTN","TIUSUPN1",22,0)
UPDATE(DA) ;
"RTN","TIUSUPN1",23,0)
 N TIUSTAT,DIE,DR,TIUCOS,TIUCOSDT,TIULFLAG,TIUPFLAG,TIUD15
"RTN","TIUSUPN1",24,0)
 S (TIULFLAG,TIUPFLAG)=0
"RTN","TIUSUPN1",25,0)
 I DA'>0 Q 0
"RTN","TIUSUPN1",26,0)
 S TIUD15=$G(^TIU(8925,DA,15))
"RTN","TIUSUPN1",27,0)
 S TIUCOS=+$P(TIUD15,U,6),TIUCOSDT=+$P(TIUD15,U,7)
"RTN","TIUSUPN1",28,0)
 I TIUCOS,TIUCOSDT'>0 S TIUSTAT="uncosigned"
"RTN","TIUSUPN1",29,0)
 E  S TIUSTAT="completed"
"RTN","TIUSUPN1",30,0)
 L +^TIU(8925,DA):1 I '$T S TIULFLAG=1
"RTN","TIUSUPN1",31,0)
 I 'TIULFLAG S DIE=8925,DR=".05///^S X=TIUSTAT" D ^DIE S TIUPFLAG=1
"RTN","TIUSUPN1",32,0)
 E  W !,DA," is being edited by another user."
"RTN","TIUSUPN1",33,0)
 L -^TIU(8925,DA)
"RTN","TIUSUPN1",34,0)
 Q TIUPFLAG
"RTN","TIUSUPN1",35,0)
 ;
"RTN","TIUSUPN1",36,0)
BROWSE ;browse documents
"RTN","TIUSUPN1",37,0)
 N TIULINE,TIUDA,TIUSEL,TIUC
"RTN","TIUSUPN1",38,0)
 D FULL^VALM1
"RTN","TIUSUPN1",39,0)
 S TIUSEL=""
"RTN","TIUSUPN1",40,0)
 F  S TIUSEL=$O(^TMP("TIUSEL",$J,TIUSEL)) Q:'TIUSEL  D
"RTN","TIUSUPN1",41,0)
 .S TIULINE=^TMP("TIUSEL",$J,TIUSEL)
"RTN","TIUSUPN1",42,0)
 .S TIUC(TIULINE)=$O(@VALMAR@("IDX",TIULINE,""))
"RTN","TIUSUPN1",43,0)
 .S TIUDA=TIUC(TIULINE)
"RTN","TIUSUPN1",44,0)
 .Q:'TIUDA
"RTN","TIUSUPN1",45,0)
 .D EN^VALM("TIU BROWSE FOR READ ONLY")
"RTN","TIUSUPN1",46,0)
 K ^TMP("TIUSEL",$J),VALMY S VALMBCK="R"
"RTN","TIUSUPN1",47,0)
 Q
"RTN","TIUSUPN1",48,0)
 ;
"RTN","TIUSUPN1",49,0)
DISP ; detailed display
"RTN","TIUSUPN1",50,0)
 N TIULINE,TIUDA,TIUSEL,TIUC,TIUVIEW,RSTRCTD
"RTN","TIUSUPN1",51,0)
 D FULL^VALM1
"RTN","TIUSUPN1",52,0)
 S TIUSEL=""
"RTN","TIUSUPN1",53,0)
 F  S TIUSEL=$O(^TMP("TIUSEL",$J,TIUSEL)) Q:'TIUSEL  D
"RTN","TIUSUPN1",54,0)
 .S TIULINE=^TMP("TIUSEL",$J,TIUSEL)
"RTN","TIUSUPN1",55,0)
 .S TIUC(TIULINE)=$O(@VALMAR@("IDX",TIULINE,""))
"RTN","TIUSUPN1",56,0)
 .S TIUDA=TIUC(TIULINE)
"RTN","TIUSUPN1",57,0)
 .Q:'TIUDA
"RTN","TIUSUPN1",58,0)
 .S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSUPN1",59,0)
 .I +TIUVIEW'>0 D  Q
"RTN","TIUSUPN1",60,0)
 .. W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIUSUPN1",61,0)
 .. I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUSUPN1",62,0)
 .S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIUSUPN1",63,0)
 .I RSTRCTD D  Q
"RTN","TIUSUPN1",64,0)
 .. W !!,$C(7),"Ok, no harm done...",!
"RTN","TIUSUPN1",65,0)
 .. I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUSUPN1",66,0)
 .D EN^TIUAUDIT
"RTN","TIUSUPN1",67,0)
 .I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIUSUPN1",68,0)
 K VALMY,^TMP("TIUSEL",$J) S VALMBCK="R"
"RTN","TIUSUPN1",69,0)
 Q
"RTN","TIUSUPN2")
0^3^B5855306
"RTN","TIUSUPN2",1,0)
TIUSUPN2 ;SLC/TT - DAILY SEARCH FOR SIGNED DOCUMENT WITH UNSIGNED STATUS; 11/29/04
"RTN","TIUSUPN2",2,0)
 ;;1.0; TEXT INTEGRATION UTILITIES;**180**;Jun 20, 1997
"RTN","TIUSUPN2",3,0)
 ;
"RTN","TIUSUPN2",4,0)
 Q
"RTN","TIUSUPN2",5,0)
EN ;Entry point to send mail
"RTN","TIUSUPN2",6,0)
 D SNDMAIL
"RTN","TIUSUPN2",7,0)
 Q
"RTN","TIUSUPN2",8,0)
 ;
"RTN","TIUSUPN2",9,0)
SNDMAIL ; SEND MAIL
"RTN","TIUSUPN2",10,0)
 ;
"RTN","TIUSUPN2",11,0)
 N TIUSTDT,TIUEDT,TIUTOTAL,TIUINFO,TIUDTIME,TIUDA,TIUI,TIUTEXT
"RTN","TIUSUPN2",12,0)
 K ^TMP("TIUP180",$J)
"RTN","TIUSUPN2",13,0)
 S TIUSTDT=DT,TIUEDT=DT+1,TIUTOTAL=0
"RTN","TIUSUPN2",14,0)
 F  S TIUSTDT=$O(^TIU(8925,"F",TIUSTDT)) Q:'TIUSTDT!(TIUSTDT>TIUEDT)  D
"RTN","TIUSUPN2",15,0)
 .S TIUDA=$O(^TIU(8925,"F",TIUSTDT,0)) S TIUTOTAL=TIUTOTAL+$$GATHER^TIUSUPN2(TIUDA)
"RTN","TIUSUPN2",16,0)
 I TIUTOTAL D
"RTN","TIUSUPN2",17,0)
 .S TIUDTIME=0,TIUI=3
"RTN","TIUSUPN2",18,0)
 .F  S TIUDTIME=$O(^TMP("TIUP180",$J,TIUDTIME)) Q:'TIUDTIME  D
"RTN","TIUSUPN2",19,0)
 ..S TIUINFO=$G(^TMP("TIUP180",$J,TIUDTIME))
"RTN","TIUSUPN2",20,0)
 ..S TIUI=TIUI+1,TIUTEXT(TIUI)=$P(TIUINFO,U)
"RTN","TIUSUPN2",21,0)
 .D CRTML
"RTN","TIUSUPN2",22,0)
 Q
"RTN","TIUSUPN2",23,0)
 ;
"RTN","TIUSUPN2",24,0)
CRTML ; CREAT MAIL
"RTN","TIUSUPN2",25,0)
 ;
"RTN","TIUSUPN2",26,0)
 N XMSUB,XMTEXT,XMDUZ,XMY
"RTN","TIUSUPN2",27,0)
 S XMDUZ="PATCH TIU*1*180"
"RTN","TIUSUPN2",28,0)
 S XMY("G.TIU SIGNED/UNSIGNED DOC")="",XMY(.5)=""
"RTN","TIUSUPN2",29,0)
 S TIUTEXT(1)="Below "_$S(TIUTOTAL=1:"is IEN for uncosigned or completed document",1:"are IENs for uncosigned/completed documents")_" with unsigned "_$S(TIUTOTAL=1:"status.",1:"statuses.")
"RTN","TIUSUPN2",30,0)
 S TIUTEXT(2)="Please run ""TIU SIGNED/UNSIGNED PN"" option for more detail."
"RTN","TIUSUPN2",31,0)
 S TIUTEXT(3)=""
"RTN","TIUSUPN2",32,0)
 S XMTEXT="TIUTEXT(",XMSUB="TIU SIGNED/UNSIGNED DOCUMENTS"
"RTN","TIUSUPN2",33,0)
 D ^XMD
"RTN","TIUSUPN2",34,0)
 Q
"RTN","TIUSUPN2",35,0)
 ;
"RTN","TIUSUPN2",36,0)
GATHER(TIUIEN) ; GET SIGNED DOCUMENT BUT UNSIGNED STATUS
"RTN","TIUSUPN2",37,0)
 ; Input  -- TIUIEN: TIU Document file (#8925) IEN
"RTN","TIUSUPN2",38,0)
 ; Output -- CNT: Total documents found
"RTN","TIUSUPN2",39,0)
 ; TIUDOC - TIU DOCUMENT NAME
"RTN","TIUSUPN2",40,0)
 ; TIUPTN - PATIENT NAME
"RTN","TIUSUPN2",41,0)
 ; TIUSIGDT - SIGNATURE DATE/TIME
"RTN","TIUSUPN2",42,0)
 ;
"RTN","TIUSUPN2",43,0)
 N TIUD0,TIUD15,TIUDOC,TIUPTN,TIUSIGDT,TIUCNT
"RTN","TIUSUPN2",44,0)
 S TIUCNT=0
"RTN","TIUSUPN2",45,0)
 I TIUIEN'>0 Q 0
"RTN","TIUSUPN2",46,0)
 I '$D(^TIU(8925,TIUIEN,0))!('$D(^TIU(8925,TIUIEN,15))) Q 0
"RTN","TIUSUPN2",47,0)
 S TIUD0=$G(^TIU(8925,TIUIEN,0)),TIUD15=$G(^TIU(8925,TIUIEN,15))
"RTN","TIUSUPN2",48,0)
 I $P(TIUD0,U,5)=5,$P(TIUD15,U,1)>0 D 
"RTN","TIUSUPN2",49,0)
 .S TIUSIGDT=$P(TIUD15,U),TIUCNT=TIUCNT+1
"RTN","TIUSUPN2",50,0)
 .S ^TMP("TIUP180",$J,TIUSIGDT)=TIUIEN
"RTN","TIUSUPN2",51,0)
 Q TIUCNT
"VER")
8.0^22.0
**END**
**END**
