Released XU*8*351 SEQ #302
Extracted from mail message
**KIDS**:XU*8.0*351^

**INSTALL NAME**
XU*8.0*351
"BLD",829,0)
XU*8.0*351^KERNEL^0^3040715^y
"BLD",829,1,0)
^^2^2^3040715^
"BLD",829,1,1,0)
Kernel Patch XU*8.0*351 Reactivate a User [XUSERREACT] Fix. 
"BLD",829,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"BLD",829,4,0)
^9.64PA^^
"BLD",829,"ABPKG")
n
"BLD",829,"KRN",0)
^9.67PA^8989.52^19
"BLD",829,"KRN",.4,0)
.4
"BLD",829,"KRN",.401,0)
.401
"BLD",829,"KRN",.402,0)
.402
"BLD",829,"KRN",.403,0)
.403
"BLD",829,"KRN",.5,0)
.5
"BLD",829,"KRN",.84,0)
.84
"BLD",829,"KRN",3.6,0)
3.6
"BLD",829,"KRN",3.8,0)
3.8
"BLD",829,"KRN",9.2,0)
9.2
"BLD",829,"KRN",9.8,0)
9.8
"BLD",829,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",829,"KRN",9.8,"NM",1,0)
XUSERNEW^^0^B19489672
"BLD",829,"KRN",9.8,"NM","B","XUSERNEW",1)

"BLD",829,"KRN",19,0)
19
"BLD",829,"KRN",19.1,0)
19.1
"BLD",829,"KRN",101,0)
101
"BLD",829,"KRN",409.61,0)
409.61
"BLD",829,"KRN",771,0)
771
"BLD",829,"KRN",870,0)
870
"BLD",829,"KRN",8989.51,0)
8989.51
"BLD",829,"KRN",8989.52,0)
8989.52
"BLD",829,"KRN",8994,0)
8994
"BLD",829,"KRN","B",.4,.4)

"BLD",829,"KRN","B",.401,.401)

"BLD",829,"KRN","B",.402,.402)

"BLD",829,"KRN","B",.403,.403)

"BLD",829,"KRN","B",.5,.5)

"BLD",829,"KRN","B",.84,.84)

"BLD",829,"KRN","B",3.6,3.6)

"BLD",829,"KRN","B",3.8,3.8)

"BLD",829,"KRN","B",9.2,9.2)

"BLD",829,"KRN","B",9.8,9.8)

"BLD",829,"KRN","B",19,19)

"BLD",829,"KRN","B",19.1,19.1)

"BLD",829,"KRN","B",101,101)

"BLD",829,"KRN","B",409.61,409.61)

"BLD",829,"KRN","B",771,771)

"BLD",829,"KRN","B",870,870)

"BLD",829,"KRN","B",8989.51,8989.51)

"BLD",829,"KRN","B",8989.52,8989.52)

"BLD",829,"KRN","B",8994,8994)

"BLD",829,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
351^3040715
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3040715
"PKG",3,22,1,"PAH",1,1,1,0)
Kernel Patch XU*8.0*351 Reactivate a User [XUSERREACT] Fix. 
"PKG",3,22,1,"PAH",1,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XUSERNEW")
0^1^B19489672
"RTN","XUSERNEW",1,0)
XUSERNEW ;SF/RWF - ADD NEW USER ; [7/15/04 9:32am]
"RTN","XUSERNEW",2,0)
 ;;8.0;KERNEL;**16,49,134,208,157,313,351**;Jul 10, 1995
"RTN","XUSERNEW",3,0)
 ;In the call to NEW^XM for new users the variable XMZ must be undef.
"RTN","XUSERNEW",4,0)
 ;on a reactivation XMZ should be set to the current max message number.
"RTN","XUSERNEW",5,0)
EN ;Add
"RTN","XUSERNEW",6,0)
 N Y,XUN,DR,DIE,DA,DTOUT,DIWF,XMDT,XMM,XMZ
"RTN","XUSERNEW",7,0)
 S Y=$$ADD("","",1) G EXIT:Y'>0,RE:$P(Y,U,3)'=1
"RTN","XUSERNEW",8,0)
 S XUN=+Y ;XU USER ADD called in $$ADD
"RTN","XUSERNEW",9,0)
 S DR="["_$$GET^XUPARAM("XUNEW USER","N")_"]"
"RTN","XUSERNEW",10,0)
 S DIE=200,DA=XUN D XUDIE^XUS5 G:$D(DTOUT) EXIT
"RTN","XUSERNEW",11,0)
 S Y=XUN K XMZ D NEW^XM K XMDT,XMM,XMZ
"RTN","XUSERNEW",12,0)
 ;ACCESS LETTER, Also see XUSERBLK
"RTN","XUSERNEW",13,0)
 W ! D LETTER(XUN,1)
"RTN","XUSERNEW",14,0)
 K DIR,DIWF,XUTEXT
"RTN","XUSERNEW",15,0)
 ;
"RTN","XUSERNEW",16,0)
 ;Fall in from above, called from REACT
"RTN","XUSERNEW",17,0)
KEYS N DIR,XQHOLD,XQKEY,XQDA,XQAL,XQ6,XQFL
"RTN","XUSERNEW",18,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to allocate security keys" D ^DIR G:$D(DIRUT) EXIT
"RTN","XUSERNEW",19,0)
 I Y=1 S XQHOLD(XUN)="",XQKEY(0)=0,XQDA=0,XQAL=1,XQ6="",XQFL="" D KEY^XQ6
"RTN","XUSERNEW",20,0)
 ;
"RTN","XUSERNEW",21,0)
 ;Check on adding this user to user groups
"RTN","XUSERNEW",22,0)
 I $P(^VA(200,XUN,0),U,3)'="" D  ;Must have access code & mailbox
"RTN","XUSERNEW",23,0)
 .N DIR,Y
"RTN","XUSERNEW",24,0)
 .S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to add this user to mail groups" D ^DIR Q:$D(DIRUT)
"RTN","XUSERNEW",25,0)
 .I Y=1 D ENLOCAL1^XMVGRP(XUN)
"RTN","XUSERNEW",26,0)
 .K XMDUN,XMDUZ,XMV
"RTN","XUSERNEW",27,0)
 .Q
"RTN","XUSERNEW",28,0)
 ;
"RTN","XUSERNEW",29,0)
EXIT K D0,DA,DDER,DDSFILE,DIE,DIC,DIR,DI,DICR,DIG,DIH,DISYS,DIU,DIV,DIWT,DLAYGO,DR,DQ,K,I,X,X1,XQHOLD,XQKEY,XUN,XUSOLD,XMB,XMZ,Y,Z,XQ6,XQFL,DTOUT
"RTN","XUSERNEW",30,0)
 Q
"RTN","XUSERNEW",31,0)
 ;
"RTN","XUSERNEW",32,0)
RE ;Jump from new user to reactivate
"RTN","XUSERNEW",33,0)
 S XUN=+Y,DIR("A")="This isn't a new user, Want to reactivate?",DIR(0)="Y",DIR("B")="NO"
"RTN","XUSERNEW",34,0)
 D ^DIR
"RTN","XUSERNEW",35,0)
 G EXIT:$D(DIRUT)!(Y'=1),RE2
"RTN","XUSERNEW",36,0)
 ;Reactivate a user
"RTN","XUSERNEW",37,0)
REACT ;SEA/WDE-REACTIVATE A USER
"RTN","XUSERNEW",38,0)
 N XUN,XUSOLD,DIE,DIC,DA,DR,FDA
"RTN","XUSERNEW",39,0)
 S XUN=+$$LOOKUP^XUSER G EXIT:XUN<0
"RTN","XUSERNEW",40,0)
RE2 S XUSOLD=^VA(200,XUN,0)
"RTN","XUSERNEW",41,0)
 S FDA(200,XUN_",",9.2)="@" ;Clear the Termination date
"RTN","XUSERNEW",42,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUSERNEW",43,0)
 ;Show the screanman form
"RTN","XUSERNEW",44,0)
 S DIE=200,DR="["_$$GET^XUPARAM("XUREACT USER","N")_"]",DA=XUN
"RTN","XUSERNEW",45,0)
 D XUDIE^XUS5 G:$D(DTOUT) EXIT
"RTN","XUSERNEW",46,0)
 I $P(^VA(200,XUN,0),U,3)="" W !!,"No ACCESS CODE has been entered.",$C(7),!
"RTN","XUSERNEW",47,0)
 I $P(^VA(200,XUN,0),U,11)>0,$P(^(0),U,11)'>DT W !!,"User is still TERMINATED.",$C(7),!
"RTN","XUSERNEW",48,0)
 N DIR
"RTN","XUSERNEW",49,0)
 S DIR(0)="Y",DIR("A")="Deny access to old mail messages",DIR("B")="NO",DIR("?")="Enter a 'YES' to restrict access to old mail messages."
"RTN","XUSERNEW",50,0)
 D ^DIR G:$D(DIRUT) EXIT
"RTN","XUSERNEW",51,0)
 K XMZ S:Y=1 XMZ=+$P(^XMB(3.9,0),"^",3) S Y=XUN D NEW^XM K XMDT,XMM,XMZ
"RTN","XUSERNEW",52,0)
 D REACT^XQ84(XUN) ;See if this user's menu trees need to be rebuilt
"RTN","XUSERNEW",53,0)
 G KEYS
"RTN","XUSERNEW",54,0)
 Q
"RTN","XUSERNEW",55,0)
 ;
"RTN","XUSERNEW",56,0)
ADD(NP1,KEYS,NONC) ;Common point to do DIC call for adding a new person.
"RTN","XUSERNEW",57,0)
 ;NP1 will be added to the default or what comes from the NPI field of the KSP.
"RTN","XUSERNEW",58,0)
 ;KEYS is a list of Keys to give the new person
"RTN","XUSERNEW",59,0)
 N DA,DR,DLAYGO,XUITNAME,XUS1,XUS2,DIC,DIE,DIK,NP2,Y
"RTN","XUSERNEW",60,0)
 I $G(^XTV(8989.3,1,"NPI"))]"" X ^("NPI") S NP2=DR
"RTN","XUSERNEW",61,0)
 S:'$D(NP2) NP2="1;"_$S($D(^XUSEC("XUSPF200",DUZ)):9,1:"9R~")_";4"
"RTN","XUSERNEW",62,0)
 S DIC="^VA(200,",DIC(0)="AELMQ",DLAYGO=200,DIC("A")="Enter NEW PERSON's name (Family,Given Middle Suffix): ",DIC("DR")="",XUITNAME=1
"RTN","XUSERNEW",63,0)
 D ^DIC S XUS1=Y G AX:(Y'>0)!($P(Y,U,3)'>0)
"RTN","XUSERNEW",64,0)
 S DA=+$G(^VA(200,+XUS1,3.1)) I DA,'$G(NONC) D
"RTN","XUSERNEW",65,0)
 . W !,"Name components."
"RTN","XUSERNEW",66,0)
 . S DIE="^VA(20,",DR="1;2;3;5"
"RTN","XUSERNEW",67,0)
 . L +^VA(20,DA,0):60 D ^DIE L -^VA(20,DA,0)
"RTN","XUSERNEW",68,0)
 . I $D(Y)!$D(DTOUT) S DA=+XUS1,XUS1=-1
"RTN","XUSERNEW",69,0)
 . E  S $P(XUS1,U,2)=$P(^VA(200,+XUS1,0),U)
"RTN","XUSERNEW",70,0)
 D:XUS1>0
"RTN","XUSERNEW",71,0)
 . W !,"Now for the Identifiers."
"RTN","XUSERNEW",72,0)
 . S DA=+XUS1,DIE="^VA(200,",DR=NP2_$S($D(NP1):";"_NP1,1:""),DIE("NO^")="OUTOK"
"RTN","XUSERNEW",73,0)
 . L +^VA(200,DA,0):60 D ^DIE L -^VA(200,DA,0)
"RTN","XUSERNEW",74,0)
 . S:$D(Y)!$D(DTOUT) XUS1=-1
"RTN","XUSERNEW",75,0)
 I XUS1<0 D  S XUS1=-1
"RTN","XUSERNEW",76,0)
 . W !?5,"<'",$P(^VA(200,DA,0),U),"' DELETED>"
"RTN","XUSERNEW",77,0)
 . S DIK="^VA(200," D ^DIK
"RTN","XUSERNEW",78,0)
 . Q:$P($G(^DIC(3,0)),U)'="USER"!'$D(^DD(3,0))
"RTN","XUSERNEW",79,0)
 . S DIK="^DIC(3,",XUS1=$P($G(^DIC(3,DA,0)),U,16) D ^DIK
"RTN","XUSERNEW",80,0)
 . Q:'XUS1!($P($G(^DIC(16,0)),U)'="PERSON")!'$D(^DD(16,0))
"RTN","XUSERNEW",81,0)
 . S DIK="^DIC(16,",DA=XUS1 D ^DIK
"RTN","XUSERNEW",82,0)
 I XUS1>0,$D(KEYS) F XUS2=1:1 S Y=$P(KEYS,",",XUS2) Q:'$L(Y)  D
"RTN","XUSERNEW",83,0)
 . S %=$$ADD^XQKEY(XUS1,Y) I '% W !,"Key '",Y,"' not allocated"
"RTN","XUSERNEW",84,0)
 I XUS1>0 D CALL^XUSERP(+XUS1,1) ;XQOR add
"RTN","XUSERNEW",85,0)
AX Q XUS1
"RTN","XUSERNEW",86,0)
 ;
"RTN","XUSERNEW",87,0)
REPRINT ;Reprint letter
"RTN","XUSERNEW",88,0)
 S DA=+$$LOOKUP^XUSER G EXIT:DA'>0
"RTN","XUSERNEW",89,0)
 D LETTER(DA)
"RTN","XUSERNEW",90,0)
 G EXIT
"RTN","XUSERNEW",91,0)
 ;
"RTN","XUSERNEW",92,0)
LETTER(XUN,ASK) ;Print access letter
"RTN","XUSERNEW",93,0)
 Q:'$G(XUN)
"RTN","XUSERNEW",94,0)
 N DIWF,FR,TO,BY,DIR,XUTEXT
"RTN","XUSERNEW",95,0)
 S XUTEXT=$$GET^XUPARAM("XUSER COMPUTER ACCOUNT","N"),XUTEXT=$O(^DIC(9.2,"B",XUTEXT,0))
"RTN","XUSERNEW",96,0)
 S DIR(0)="Y",DIR("A")="Print User Account Access Letter"
"RTN","XUSERNEW",97,0)
 I XUTEXT>0 S Y=1 D:$G(ASK) ^DIR I Y=1 D
"RTN","XUSERNEW",98,0)
 . S XUU="________",DIWF="^DIC(9.2,XUTEXT,1,",DIWF(1)=200,FR=XUN,TO=XUN,BY="NUMBER" D EN2^DIWF
"RTN","XUSERNEW",99,0)
 . Q
"RTN","XUSERNEW",100,0)
 Q
"VER")
8.0^22.0
**END**
**END**
