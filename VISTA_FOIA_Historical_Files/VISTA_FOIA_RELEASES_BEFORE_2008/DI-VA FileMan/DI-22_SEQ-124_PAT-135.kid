Released DI*22*135 SEQ #124
Extracted from mail message
**KIDS**:DI*22.0*135^

**INSTALL NAME**
DI*22.0*135
"BLD",532,0)
DI*22.0*135^VA FILEMAN^0^3040506^y
"BLD",532,1,0)
^^2^2^3040105^
"BLD",532,1,1,0)
See patch DI*22*135 in the National Patch Module on FORUM for complete
"BLD",532,1,2,0)
information on this patch.
"BLD",532,4,0)
^9.64PA^^
"BLD",532,"KRN",0)
^9.67PA^8989.52^19
"BLD",532,"KRN",.4,0)
.4
"BLD",532,"KRN",.401,0)
.401
"BLD",532,"KRN",.402,0)
.402
"BLD",532,"KRN",.403,0)
.403
"BLD",532,"KRN",.5,0)
.5
"BLD",532,"KRN",.84,0)
.84
"BLD",532,"KRN",3.6,0)
3.6
"BLD",532,"KRN",3.8,0)
3.8
"BLD",532,"KRN",9.2,0)
9.2
"BLD",532,"KRN",9.8,0)
9.8
"BLD",532,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",532,"KRN",9.8,"NM",1,0)
DICF1^^0^B22351550
"BLD",532,"KRN",9.8,"NM","B","DICF1",1)

"BLD",532,"KRN",19,0)
19
"BLD",532,"KRN",19.1,0)
19.1
"BLD",532,"KRN",101,0)
101
"BLD",532,"KRN",409.61,0)
409.61
"BLD",532,"KRN",771,0)
771
"BLD",532,"KRN",870,0)
870
"BLD",532,"KRN",8989.51,0)
8989.51
"BLD",532,"KRN",8989.52,0)
8989.52
"BLD",532,"KRN",8994,0)
8994
"BLD",532,"KRN","B",.4,.4)

"BLD",532,"KRN","B",.401,.401)

"BLD",532,"KRN","B",.402,.402)

"BLD",532,"KRN","B",.403,.403)

"BLD",532,"KRN","B",.5,.5)

"BLD",532,"KRN","B",.84,.84)

"BLD",532,"KRN","B",3.6,3.6)

"BLD",532,"KRN","B",3.8,3.8)

"BLD",532,"KRN","B",9.2,9.2)

"BLD",532,"KRN","B",9.8,9.8)

"BLD",532,"KRN","B",19,19)

"BLD",532,"KRN","B",19.1,19.1)

"BLD",532,"KRN","B",101,101)

"BLD",532,"KRN","B",409.61,409.61)

"BLD",532,"KRN","B",771,771)

"BLD",532,"KRN","B",870,870)

"BLD",532,"KRN","B",8989.51,8989.51)

"BLD",532,"KRN","B",8989.52,8989.52)

"BLD",532,"KRN","B",8994,8994)

"BLD",532,"PRE")
DIENVWRN
"BLD",532,"QUES",0)
^9.62^^
"BLD",532,"REQB",0)
^9.611^1^1
"BLD",532,"REQB",1,0)
DI*22.0*70^2
"BLD",532,"REQB","B","DI*22.0*70",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3030110^41
"PKG",5,22,1,"PAH",1,0)
135^3040506
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3040506
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*135 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DIENVWRN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DICF1")
0^1^B22351550
"RTN","DICF1",1,0)
DICF1 ;SEA/TOAD,SF/TKW-VA FileMan: Finder, Part 2 (Transform) ;1:36 PM  6 May 2004
"RTN","DICF1",2,0)
 ;;22.0;VA FileMan;**15,51,70,135**;Mar 30, 1999
"RTN","DICF1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DICF1",4,0)
 ;
"RTN","DICF1",5,0)
XFORM(DIFLAGS,DIVALUE,DISCREEN,DINDEX) ;
"RTN","DICF1",6,0)
 ; FIND--produce array of values and screens by transforming input
"RTN","DICF1",7,0)
 ; subroutine, DIVALUE, DINDEX, & DISCREEN passed by reference
"RTN","DICF1",8,0)
 N DISUB F DISUB=1:1:DINDEX("#") D VALUES
"RTN","DICF1",9,0)
 Q
"RTN","DICF1",10,0)
VALUES ; Set original lookup value into array.
"RTN","DICF1",11,0)
 I $D(DIVALUE(DISUB,0,1)) S DIVALUE(DISUB)=DIVALUE(DISUB,0,1)
"RTN","DICF1",12,0)
 N I F I="PART","FROM","TO" I $D(DIVALUE(DISUB,0,1,I)) D
"RTN","DICF1",13,0)
 . S DINDEX(DISUB,I)=DIVALUE(DISUB,0,1,I) Q
"RTN","DICF1",14,0)
 D
"RTN","DICF1",15,0)
 . S I=-1 F  S I=$O(DIVALUE(DISUB,I)) Q:I=""  K DIVALUE(DISUB,I)
"RTN","DICF1",16,0)
 . S I=-1 F  S I=$O(DISCREEN(DISUB,I)) Q:I=""  K DISCREEN(DISUB,I)
"RTN","DICF1",17,0)
 . Q
"RTN","DICF1",18,0)
 S DIVALUE(DISUB,1)=DIVALUE(DISUB)
"RTN","DICF1",19,0)
 Q:DIVALUE(DISUB)=""
"RTN","DICF1",20,0)
 I DIFLAGS["Q" D LONG Q
"RTN","DICF1",21,0)
LOWER ;
"RTN","DICF1",22,0)
 I DIVALUE(DISUB)?.E1L.E,DIFLAGS'["X" D
"RTN","DICF1",23,0)
 . S DIVALUE(DISUB,2)=$$OUT^DIALOGU(DIVALUE(DISUB),"UC")
"RTN","DICF1",24,0)
 . Q
"RTN","DICF1",25,0)
 ;
"RTN","DICF1",26,0)
CHK ; Quit if data type not free-text, pointer or vp, or if lookup value is numeric or a date.
"RTN","DICF1",27,0)
 I "PVF"'[$G(DINDEX(DISUB,"TYPE"))!(DIVALUE(DISUB)?.NP) Q
"RTN","DICF1",28,0)
 N Y D  Q:Y>0
"RTN","DICF1",29,0)
 . N X S X=DIVALUE(DISUB) N %DT,DIFLAGS,DIVALUE,DISCREEN,DINDEX,DISUB
"RTN","DICF1",30,0)
 . S %DT="T" D ^%DT Q
"RTN","DICF1",31,0)
COMMA I DIVALUE(DISUB)[",",DIFLAGS'["X" D
"RTN","DICF1",32,0)
 . N DISTEMP,DIPIECE1 S DISTEMP="",DIPIECE1=$P(DIVALUE(DISUB),",")
"RTN","DICF1",33,0)
 . Q:$L(DIPIECE1)>DINDEX(DISUB,"LENGTH")
"RTN","DICF1",34,0)
 . Q:'$L(DIPIECE1)  ;SO
"RTN","DICF1",35,0)
21 . I DIFLAGS["C" D
"RTN","DICF1",36,0)
 . . N DIPART1 S DIPART1=" I %?.E1P1"""
"RTN","DICF1",37,0)
 . . N DIPART2 S DIPART2=""".E!(D'=""B""&(%?1"""
"RTN","DICF1",38,0)
 . . N DIPART3 S DIPART3=""".E))"
"RTN","DICF1",39,0)
 . . N DIOUT S DIOUT=0
"RTN","DICF1",40,0)
 . . N DIPIECE,DIVPIECE F DIPIECE=2:1 D  I DIOUT Q
"RTN","DICF1",41,0)
 . . . S DIVPIECE=$P(DIVALUE(DISUB),",",DIPIECE)
"RTN","DICF1",42,0)
 . . . I DIVPIECE["""" Q
"RTN","DICF1",43,0)
 . . . I $E(DIVPIECE)=" " S DIVPIECE=$E(DIVPIECE,2,$L(DIVPIECE))
"RTN","DICF1",44,0)
 . . . I DIVPIECE="" S DIOUT=1 Q
"RTN","DICF1",45,0)
 . . . I $L(DIVPIECE)*2+$L(DISTEMP)+33+14+34>255 S DIOUT=1 Q
"RTN","DICF1",46,0)
 . . . S DISTEMP=DISTEMP_DIPART1_DIVPIECE_DIPART2_DIVPIECE_DIPART3
"RTN","DICF1",47,0)
 . . . Q:DISTEMP=""
"RTN","DICF1",48,0)
 . . . S DISTEMP="S %=DIVAL "_DISTEMP Q  ;22*135
"RTN","DICF1",49,0)
 . . I DISTEMP="" Q
"RTN","DICF1",50,0)
22 . I DIFLAGS'["C" N DIPIECE2,DIPC2 D
"RTN","DICF1",51,0)
 . . S (DIPC2,DIPIECE2)=$P(DIVALUE(DISUB),",",2)
"RTN","DICF1",52,0)
 . . I DIPIECE2["""" S DIPC2=$$CONVQQ^DILIBF(DIPIECE2)
"RTN","DICF1",53,0)
 . . S DISTEMP="S %=$P(DIVAL,"","",2) I $E(%,1,"_$L(DIPIECE2)_")="""_DIPC2_""""
"RTN","DICF1",54,0)
 . . Q
"RTN","DICF1",55,0)
23 . S DIVALUE(DISUB,3)=DIPIECE1
"RTN","DICF1",56,0)
 . S DISCREEN(DISUB,3)=DISTEMP
"RTN","DICF1",57,0)
 . I DIFLAGS'["C" S DIVALUE(DISUB,3,"c")=DIPIECE2
"RTN","DICF1",58,0)
24 . I DIVALUE(DISUB)'?.E1L.E Q
"RTN","DICF1",59,0)
 . S DIVALUE(DISUB,4)=$$OUT^DIALOGU(DIPIECE1,"UC")
"RTN","DICF1",60,0)
 . S DISCREEN(DISUB,4)=$$OUT^DIALOGU(DISTEMP,"UC")
"RTN","DICF1",61,0)
 . I DIFLAGS'["C" S DIVALUE(DISUB,4,"c")=$$OUT^DIALOGU(DIPIECE2,"UC")
"RTN","DICF1",62,0)
 ;
"RTN","DICF1",63,0)
LONG I $L(DIVALUE(DISUB))'>DINDEX(DISUB,"LENGTH") Q
"RTN","DICF1",64,0)
 N J,X,DISLONG,DISPART,DISXACT,DIREF
"RTN","DICF1",65,0)
 F I=0:0 S I=$O(DIVALUE(DISUB,I)) Q:'I  D
"RTN","DICF1",66,0)
 . N L,M S L=DINDEX(DISUB,"LENGTH")
"RTN","DICF1",67,0)
 . Q:$L(DIVALUE(DISUB,I))'>L
"RTN","DICF1",68,0)
 . S X=DIVALUE(DISUB,I) K DIVALUE(DISUB,I) S DIVALUE(DISUB,0,I)=X
"RTN","DICF1",69,0)
 . I $G(DISCREEN(DISUB,I))]"" S X=DISCREEN(DISUB,I) K DISCREEN(DISUB,I) S DISCREEN(DISUB,0,I)=X
"RTN","DICF1",70,0)
 . S DIVALUE(DISUB,I)=$E(DIVALUE(DISUB,0,I),1,L)
"RTN","DICF1",71,0)
 . I I=1 D
"RTN","DICF1",72,0)
 . . S (DIVALUE(DISUB),DINDEX(DISUB))=DIVALUE(DISUB,I)
"RTN","DICF1",73,0)
 . . F J="PART","FROM","TO" S M=$L($G(DINDEX(DISUB,J))) D:M>L
"RTN","DICF1",74,0)
 . . . S DIVALUE(DISUB,0,I,J)=DINDEX(DISUB,J)
"RTN","DICF1",75,0)
 . . . S DINDEX(DISUB,J)=$E(DINDEX(DISUB,J),1,L) Q
"RTN","DICF1",76,0)
 . . Q
"RTN","DICF1",77,0)
 . S DISLONG=""
"RTN","DICF1",78,0)
 . I $D(DISCREEN(DISUB,0,I)) S DISLONG=" X DISCREEN("_DISUB_",0,"_I_")"
"RTN","DICF1",79,0)
 . S DIREF="DINDEX("_DISUB_",0,"_I_")"
"RTN","DICF1",80,0)
 . S DISPART="I $P(DIVAL,$G("_DIREF_"))="""""_DISLONG ;DI*22*70
"RTN","DICF1",81,0)
 . S DISXACT="I $P(DIVAL,U)="_DIREF_DISLONG
"RTN","DICF1",82,0)
L10 . I DIFLAGS["X" S DISCREEN(DISUB,I)=DISXACT Q
"RTN","DICF1",83,0)
 . I DIFLAGS'["O" S DISCREEN(DISUB,I)=DISPART Q
"RTN","DICF1",84,0)
 . S DISCREEN(DISUB,I)=DISXACT
"RTN","DICF1",85,0)
 . S DISCREEN(DISUB,I,2)=DISPART
"RTN","DICF1",86,0)
 . Q
"RTN","DICF1",87,0)
 Q
"RTN","DICF1",88,0)
 ;
"RTN","DICF1",89,0)
SPECIAL(DIFILE,DIEN,DIFIEN,DIFLAGS,DIVALUE,DINDEX,DISCREEN,DIDENT,DIOUT,DILIST) ;
"RTN","DICF1",90,0)
 ; Process space-bar return, 'IEN or DIVALUE equal to an IEN.
"RTN","DICF1",91,0)
 S DIOUT=0
"RTN","DICF1",92,0)
11 I DIVALUE=" " D  S DIOUT=1 Q
"RTN","DICF1",93,0)
 . N DIROOT S DIROOT=$$ROOT^DIQGU(DIFILE,DIFIEN,"Q")
"RTN","DICF1",94,0)
 . N DINODE S DINODE=$G(^DISV(DUZ,$E(DIROOT,1,28)))
"RTN","DICF1",95,0)
 . N DINODEL S DINODEL=$L(DINODE,",")
"RTN","DICF1",96,0)
 . I $P(DINODE,",",1,DINODEL-1)'=$E(DIROOT,29,9999) Q
"RTN","DICF1",97,0)
 . S DIEN=$P(DINODE,",",DINODEL)
"RTN","DICF1",98,0)
 . I 'DIEN S DIEN="" Q
"RTN","DICF1",99,0)
 . D ENTRY Q
"RTN","DICF1",100,0)
12 I DIVALUE?1"`".NP D  Q:DIOUT=1
"RTN","DICF1",101,0)
 . S DIEN=$E(DIVALUE,2,$L(DIVALUE)) Q:+DIEN'=DIEN
"RTN","DICF1",102,0)
 . D ENTRY S DIOUT=1 Q
"RTN","DICF1",103,0)
13 I $S(DIVALUE?1.N:1,DIVALUE'?.NP:0,1:+DIVALUE=DIVALUE) D
"RTN","DICF1",104,0)
 . N DI001 S DI001=$D(^DD(DIFILE,.001))
"RTN","DICF1",105,0)
 . N DI01FLAG S DI01FLAG=$P($G(^DD(DIFILE,.01,0)),U,2)
"RTN","DICF1",106,0)
 . I $D(@DIFILE(DIFILE)@(DIVALUE)) D
"RTN","DICF1",107,0)
 . . I DIFLAGS'["A",'DI001,DI01FLAG["N"!($O(@DIFILE(DIFILE)@("A["))'="") Q
"RTN","DICF1",108,0)
 . . S DIEN=DIVALUE
"RTN","DICF1",109,0)
 . . D ENTRY
"RTN","DICF1",110,0)
 . . I $G(DINDEX("DONE"))!($G(DIERR)) S DIEN="",DIOUT=1
"RTN","DICF1",111,0)
 Q
"RTN","DICF1",112,0)
 ;
"RTN","DICF1",113,0)
ENTRY ; Execute screens, and if entry passes, do ACCEPT to add it to output.
"RTN","DICF1",114,0)
 N DI0NODE S DI0NODE=$G(@DIFILE(DIFILE)@(DIEN,0))
"RTN","DICF1",115,0)
 Q:$$SCREEN^DICL2(.DIFILE,.DIEN,DIFLAGS,DIFIEN,.DISCREEN,.DINDEX,DI0NODE)
"RTN","DICF1",116,0)
 D ACCEPT^DICL2(.DIFILE,.DIEN,.DIFLAGS,DIFIEN,.DINDEX,.DIDENT,.DILIST,DI0NODE)
"RTN","DICF1",117,0)
 Q
"RTN","DIENVWRN")
0^^B3680036
"RTN","DIENVWRN",1,0)
DIENVWRN ;IRMFO-SF/FM STAFF-ENVIRONMENT CHECK ROUTINE ;9:36 AM  26 Jan 2004
"RTN","DIENVWRN",2,0)
 ;;22.0;VA FileMan;;Mar 30, 1999
"RTN","DIENVWRN",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIENVWRN",4,0)
 ;
"RTN","DIENVWRN",5,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DIENVWRN",6,0)
 I 'XPDENV Q  ; Loading Distribution - No Check
"RTN","DIENVWRN",7,0)
 ;
"RTN","DIENVWRN",8,0)
INSCHK ; Do Checks During Install Only
"RTN","DIENVWRN",9,0)
 W $C(7)
"RTN","DIENVWRN",10,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DIENVWRN",11,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DIENVWRN",12,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DIENVWRN",13,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DIENVWRN",14,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DIENVWRN",15,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DIENVWRN",16,0)
 ;
"RTN","DIENVWRN",17,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DIENVWRN",18,0)
 S X=$$TM^%ZTLOAD
"RTN","DIENVWRN",19,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DIENVWRN",20,0)
 . W $C(7)
"RTN","DIENVWRN",21,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DIENVWRN",22,0)
 ;
"RTN","DIENVWRN",23,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DIENVWRN",24,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DIENVWRN",25,0)
 S X=+$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DIENVWRN",26,0)
 I 'X D
"RTN","DIENVWRN",27,0)
 . W $C(7)
"RTN","DIENVWRN",28,0)
 . D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DIENVWRN",29,0)
 Q
"VER")
8^22.0
**END**
**END**
