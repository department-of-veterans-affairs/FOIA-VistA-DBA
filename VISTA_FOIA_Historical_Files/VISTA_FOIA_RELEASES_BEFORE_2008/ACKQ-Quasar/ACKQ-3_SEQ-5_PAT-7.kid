Released ACKQ*3*7 SEQ #5
Extracted from mail message
**KIDS**:ACKQ*3.0*7^

**INSTALL NAME**
ACKQ*3.0*7
"BLD",3524,0)
ACKQ*3.0*7^QUASAR^0^3030506^y
"BLD",3524,1,0)
^^2^2^3030502^^
"BLD",3524,1,1,0)
This patch fixes problems with the updating of the Problem List via the 
"BLD",3524,1,2,0)
PCE interface.
"BLD",3524,4,0)
^9.64PA^^
"BLD",3524,"KRN",0)
^9.67PA^8989.52^19
"BLD",3524,"KRN",.4,0)
.4
"BLD",3524,"KRN",.401,0)
.401
"BLD",3524,"KRN",.402,0)
.402
"BLD",3524,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",3524,"KRN",.402,"NM",1,0)
ACKQAS VISIT ENTRY    FILE #509850.6^509850.6^0
"BLD",3524,"KRN",.402,"NM","B","ACKQAS VISIT ENTRY    FILE #509850.6",1)

"BLD",3524,"KRN",.403,0)
.403
"BLD",3524,"KRN",.5,0)
.5
"BLD",3524,"KRN",.84,0)
.84
"BLD",3524,"KRN",3.6,0)
3.6
"BLD",3524,"KRN",3.8,0)
3.8
"BLD",3524,"KRN",9.2,0)
9.2
"BLD",3524,"KRN",9.8,0)
9.8
"BLD",3524,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3524,"KRN",9.8,"NM",1,0)
ACKQPCE1^^0^B70026503
"BLD",3524,"KRN",9.8,"NM",2,0)
ACKQUTL6^^0^B69249054
"BLD",3524,"KRN",9.8,"NM","B","ACKQPCE1",1)

"BLD",3524,"KRN",9.8,"NM","B","ACKQUTL6",2)

"BLD",3524,"KRN",19,0)
19
"BLD",3524,"KRN",19.1,0)
19.1
"BLD",3524,"KRN",101,0)
101
"BLD",3524,"KRN",409.61,0)
409.61
"BLD",3524,"KRN",771,0)
771
"BLD",3524,"KRN",870,0)
870
"BLD",3524,"KRN",8989.51,0)
8989.51
"BLD",3524,"KRN",8989.52,0)
8989.52
"BLD",3524,"KRN",8994,0)
8994
"BLD",3524,"KRN","B",.4,.4)

"BLD",3524,"KRN","B",.401,.401)

"BLD",3524,"KRN","B",.402,.402)

"BLD",3524,"KRN","B",.403,.403)

"BLD",3524,"KRN","B",.5,.5)

"BLD",3524,"KRN","B",.84,.84)

"BLD",3524,"KRN","B",3.6,3.6)

"BLD",3524,"KRN","B",3.8,3.8)

"BLD",3524,"KRN","B",9.2,9.2)

"BLD",3524,"KRN","B",9.8,9.8)

"BLD",3524,"KRN","B",19,19)

"BLD",3524,"KRN","B",19.1,19.1)

"BLD",3524,"KRN","B",101,101)

"BLD",3524,"KRN","B",409.61,409.61)

"BLD",3524,"KRN","B",771,771)

"BLD",3524,"KRN","B",870,870)

"BLD",3524,"KRN","B",8989.51,8989.51)

"BLD",3524,"KRN","B",8989.52,8989.52)

"BLD",3524,"KRN","B",8994,8994)

"BLD",3524,"QUES",0)
^9.62^^
"BLD",3524,"REQB",0)
^9.611^2^2
"BLD",3524,"REQB",1,0)
ACKQ*3.0*1^2
"BLD",3524,"REQB",2,0)
ACKQ*3.0*5^2
"BLD",3524,"REQB","B","ACKQ*3.0*1",1)

"BLD",3524,"REQB","B","ACKQ*3.0*5",2)

"KRN",.402,1860,-1)
0^1
"KRN",.402,1860,0)
ACKQAS VISIT ENTRY^3001005.1539^^509850.6^^^3030502
"KRN",.402,1860,"DIAB",1,0,509850.6,2)
PATIENT NAME:
"KRN",.402,1860,"DIAB",1,0,509850.6,6)
20//^S X="";"Was care for SC Condition ?"
"KRN",.402,1860,"DIAB",1,1,509850.66,0)
SECONDARY PROVIDER;DUP
"KRN",.402,1860,"DIAB",2,0,509850.6,8)
35//^S X="";"Was care related to EC Exposure ?"
"KRN",.402,1860,"DIAB",3,0,509850.6,18)
STUDENT;DUP
"KRN",.402,1860,"DIAB",4,0,509850.6,2)
2.5//YES;"Is this a C&P Visit ?"
"KRN",.402,1860,"DIAB",5,0,509850.6,7)
30//^S X="";"Was care related to IR Exposure ?"
"KRN",.402,1860,"DIAB",5,0,509850.6,17)
PRIMARY PROVIDER;DUP
"KRN",.402,1860,"DIAB",5,1,509850.63,0)
.12//^S X="";"Is this the Primary Diagnosis ?"
"KRN",.402,1860,"DIAB",6,0,509850.6,8)
90//^S X="";"Was care related to MST ?"
"KRN",.402,1860,"DIAB",7,0,509850.6,6)
25//^S X="";"Was care related to AO Exposure ?"
"KRN",.402,1860,"DIAB",8,0,509850.6,4)
80//^S X=ACKELIG;"Enter the Eligibility for this Appointment"
"KRN",.402,1860,"DIAB",8,1,509850.63,0)
.13//^S X="";"Update PCE Problem List with Diag. code ?"
"KRN",.402,1860,"DR",1,509850.6)
I $G(ACKVISIT)'="NEW",$G(ACKVISIT)'="EDIT" W !!,"This option must only be run from QUASAR" S Y="@999";D SETUP^ACKQUTL4;D HLOSS^ACKQUTL4;S ACKCP=$$ACKCP^ACKQUTL4;S ACKCPNO=$S(+ACKCP=0:"",1:$P(ACKCP,U,2)),ACKCP=+ACKCP;@10;
"KRN",.402,1860,"DR",1,509850.6,1)
D EN^ACKQUTL7;I $D(ACKDIRUT) S Y="@999";I $$TIMECHEK^ACKQASU5(ACKVIEN,1) S Y="@15";55;@15;I ACKVISIT="EDIT" S Y="@16";1////^S X=ACKPAT;@16;
"KRN",.402,1860,"DR",1,509850.6,2)
^509850.2^ACK(509850.2,^^S I(0,0)=D0 S Y(1)=$S($D(^ACK(509850.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@30;I ACKCP=0 S Y="@40";2.5Is this a C&P Visit ?~//YES;S ACKCP=X;S:'ACKCP Y="@40";
"KRN",.402,1860,"DR",1,509850.6,3)
S:ACKCPNO="" Y="@40";.08////^S X=$S(ACKCPNO'="":ACKCPNO,1:"");@40;D DIAGDIS^ACKQUTL4;3;IF $O(^ACK(509850.6,ACKVIEN,1,0))="" WRITE !!,"You must enter at least one Diagnosis" S Y="@40";I '$$POSTDIAG^ACKQASU5(ACKVIEN) S Y="@40";
"KRN",.402,1860,"DR",1,509850.6,4)
D HLOSS^ACKQUTL4;@50;W @IOF;I ACKPCE'=1 S Y="@100";I ACKSC=0 D CLASDIS^ACKQNQ S Y="@55";D PATDIS^ACKQUTL4;D ELIGDIS^ACKQUTL4;80Enter the Eligibility for this Appointment~//^S X=ACKELIG;
"KRN",.402,1860,"DR",1,509850.6,5)
S ACKELIG=$S(ACKPCE'=1:"",ACKELGCT=1:ACKELIG,1:X);S Y="@60";@55;I $$GET1^DIQ(509850.6,ACKVIEN_",",80,"I")=ACKELIG1 S Y="@60";80////^S X=ACKELIG1;@60;I ACKPCE'=1 S Y="@100";I ACKSC=0 S Y="@70";
"KRN",.402,1860,"DR",1,509850.6,6)
20Was care for SC Condition ?~//^S X="";I ACKPCE'=1 S Y="@100";S ACKSC=$S(ACKSC=0:0,X=1:2,1:1);@70;I ACKAO=0 S Y="@80";I ACKSC=2 S Y="@100";25Was care related to AO Exposure ?~//^S X="";
"KRN",.402,1860,"DR",1,509850.6,7)
S ACKAO=$S(ACKAO=0:0,ACKSC'=1:ACKAO,X=1:2,1:1);@80;I ACKRAD=0 S Y="@90";I ACKSC=2 S Y="@100";30Was care related to IR Exposure ?~//^S X="";S ACKRAD=$S(ACKRAD=0:0,ACKSC'=1:ACKRAD,X=1:2,1:1);@90;I ACKENV=0 S Y="@100";
"KRN",.402,1860,"DR",1,509850.6,8)
I ACKSC=2 S Y="@100";35Was care related to EC Exposure ?~//^S X="";S ACKENV=$S(ACKENV=0:0,ACKSC'=1:ACKENV,X=1:2,1:1);@100;I '$$MST^ACKQUTL4(ACKPCE,ACKVD,ACKPAT) S Y="@105";90Was care related to MST ?~//^S X="";
"KRN",.402,1860,"DR",1,509850.6,9)
I '$$MST^ACKQUTL4(ACKPCE,ACKVD,ACKPAT) D CLEAR^ACKQUTL4(ACKVIEN,"90");@105;5//^S X=$$CDR^ACKQUTL6();@110;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO S Y="@270";I 'ACKATS S Y="@120";S ACKLAMD=$$LAMD^ACKQAS1(DFN);I $D(DIRUT) S Y="@999";
"KRN",.402,1860,"DR",1,509850.6,10)
I ACKLAMD S Y="@265";@120;S ACKLAMD=ACKVD;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";W !!,"Enter Audiometrics :",!;4.01;@130;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.02;@140;
"KRN",.402,1860,"DR",1,509850.6,11)
S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.03;@150;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.04;@160;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.05;@170;
"KRN",.402,1860,"DR",1,509850.6,12)
S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.07;@180;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.08;@190;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.09;@200;
"KRN",.402,1860,"DR",1,509850.6,13)
S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.1;@210;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.11;@230;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.13;@240;
"KRN",.402,1860,"DR",1,509850.6,14)
S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.14;@250;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.15;@260;S ACKAUDIO=$$AUDIO^ACKQUTL4 I 'ACKAUDIO!($L(ACKLAMD)>7) S Y="@270";4.16;@265;
"KRN",.402,1860,"DR",1,509850.6,15)
4.23////^S X=+ACKLAMD;@270;I ACKCP'=1 S Y="@320";S ACKQHLP="^509850.6^100" D ^ACKQHLP;100;I $D(DIRUT) S Y="@999";@280;I ACKCP'=1 S Y="@320";S ACKQHLP="^509850.6^101" D ^ACKQHLP;101;I $D(DIRUT) S Y="@999";@290;I ACKCP'=1 S Y="@320";
"KRN",.402,1860,"DR",1,509850.6,16)
S ACKQHLP="^509850.6^102" D ^ACKQHLP;102;I $D(DIRUT) S Y="@999";@300;I ACKCP'=1 S Y="@320";S ACKQHLP="^509850.6^103" D ^ACKQHLP;103;I $D(DIRUT) S Y="@999";@310;I ACKCP'=1 S Y="@320";S ACKQHLP="^509850.6^104" D ^ACKQHLP;104;
"KRN",.402,1860,"DR",1,509850.6,17)
I $D(DIRUT) S Y="@999";@320;D PROVDIS^ACKQUTL4;@325;6d~;@330;I $$GET1^DIQ(509850.6,ACKVIEN_",",6)="" W !,"A Primary Provider MUST be entered for this Visit !!",! S Y="@325";2.7;
"KRN",.402,1860,"DR",1,509850.6,18)
I $$GET1^DIQ(509850.6,ACKVIEN_",",6)="" W !,"A Primary Provider MUST be entered for this Visit !!",! S Y="@325";@340;7d~;
"KRN",.402,1860,"DR",1,509850.6,19)
I $$GET1^DIQ(509850.6,ACKVIEN_",",6)="" W !,"A Primary Provider MUST be entered for this Visit !!",! S Y="@325";@350;I ACKEVENT S Y="@372";D CPTDIS^ACKQUTL4;10;I ACKEVENT S Y="@372";
"KRN",.402,1860,"DR",1,509850.6,20)
I '$O(^ACK(509850.6,ACKVIEN,3,0)) W !!,$C(7),"You must enter at least one PROCEDURE CODE !!" S Y="@350";@370;I 'ACKEVENT S Y="@378";@372;D EVNTDIS^ACKQUTL5;15;I 'ACKEVENT S Y="@378";
"KRN",.402,1860,"DR",1,509850.6,21)
I '$O(^ACK(509850.6,ACKVIEN,7,0)) W !!,$C(7),"You must enter at least one EC PROCEDURE CODE !!" S Y="@372";@378;.07;I ACKCP'=1!($P($G(^ACK(509850.6,ACKVIEN,4)),U,17)]"") S Y="@999";@380;S ACKMODE=1 D SIG^ACKQCP;
"KRN",.402,1860,"DR",1,509850.6,22)
S:'$D(ACKSIG) Y="@999";4.17////^S X=ACKSIG;4.18////^S X=DT;4.24////^S X=ACKTITL;@999;W !;
"KRN",.402,1860,"DR",2,509850.2)
@17;I ACKCLNO'=1 S Y="@20";W !!;.03;@20;
"KRN",.402,1860,"DR",2,509850.61)
.01;S ACKPC=X;D LONG^ACKQUTL6(ACKPC,"");.04;@360;.03//^S X=1;@363;.05//^S X=$$GET1^DIQ(509850.6,ACKVIEN_",",6);I X="" W !,"Each Procedure must have a Provider allocated.",! S Y="@363";D ADDPROV^ACKQUTL(ACKVIEN,X);K ACKPC;@365;
"KRN",.402,1860,"DR",2,509850.615)
.01;.03//^S X=1;@374;.05//^S X=$$GET1^DIQ(509850.6,ACKVIEN_",",6);I X="" W !,"Each EC Procedure must have a Provider allocated.",! S Y="@374";D ADDPROV^ACKQUTL(ACKVIEN,X);@376;
"KRN",.402,1860,"DR",2,509850.63)
.01;S ACKDC=X;D DC^ACKQASU;I $$PRIMARY^ACKQASU5(ACKVIEN,DA) S Y="@45";.12Is this the Primary Diagnosis ?~//^S X="";@45;I '$$PROB^ACKQUTL4(ACKPCE,ACKDIV)!(+$$PLIST^ACKQUTL6(ACKPAT,ACKDC)=2) S Y="@49";
"KRN",.402,1860,"DR",2,509850.63,1)
.13Update PCE Problem List with Diag. code ?~//^S X="";I X=0 S Y="@49";I '$$PROB^ACKQUTL4(ACKPCE,ACKDIV)!(+$$PLIST^ACKQUTL6(ACKPAT,ACKDC)=2) S Y="@49";.14;@49;
"KRN",.402,1860,"DR",2,509850.66)
.01d~;
"KRN",.402,1860,"DR",3,509850.64)
K ACKMOD;.01;K ACKMOD;
"KRN",.402,1860,"ROU")
^ACKQTE
"KRN",.402,1860,"ROUOLD")
ACKQTE
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",509,-1)
1^1
"PKG",509,0)
QUASAR^ACKQ^Quality: Audiology and Speech Pathology Audit and Review
"PKG",509,20,0)
^9.402P^^
"PKG",509,22,0)
^9.49I^1^1
"PKG",509,22,1,0)
3.0^3000211^3000901^11718
"PKG",509,22,1,"PAH",1,0)
7^3030506
"PKG",509,22,1,"PAH",1,1,0)
^^2^2^3030506
"PKG",509,22,1,"PAH",1,1,1,0)
This patch fixes problems with the updating of the Problem List via the 
"PKG",509,22,1,"PAH",1,1,2,0)
PCE interface.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ACKQPCE1")
0^1^B70026503
"RTN","ACKQPCE1",1,0)
ACKQPCE1 ;HCIOFO/AG - Quasar/PCE Interface; August 1999. ; 5/6/03 11:06am
"RTN","ACKQPCE1",2,0)
 ;;3.0;QUASAR;**1,2,5,7**;Feb 11, 2000
"RTN","ACKQPCE1",3,0)
 ;
"RTN","ACKQPCE1",4,0)
 ; this routine contains the code for sending a Quasar visit to PCE
"RTN","ACKQPCE1",5,0)
 ; it is called from ACKQPCE.
"RTN","ACKQPCE1",6,0)
 ;
"RTN","ACKQPCE1",7,0)
SENDPCE(ACKVIEN,ACKPKG,ACKSRC) ; send a Quasar Visit to PCE.
"RTN","ACKQPCE1",8,0)
 ; see SENDPCE^ACKQPCE for entry parameters and processing notes.
"RTN","ACKQPCE1",9,0)
 ; this routine should not be called directly, only from ACKQPCE
"RTN","ACKQPCE1",10,0)
 ; (this routine assumes all the entry parameters are passed!)
"RTN","ACKQPCE1",11,0)
 N ACKSENT,ACKLOCK,ACKRSN,ACKMSG,ACKFDA,ACKFDA2,ACKPCE,ACKE,ACKERR,ACKNARR
"RTN","ACKQPCE1",12,0)
 N ACKVDT,ACKVTM,ACKPAT,ACKSC,ACKAO,ACKIR,ACKEC,ACKCHKDT,ACKELIG,ACKPROCP
"RTN","ACKQPCE1",13,0)
 N ACKVSC,ACKCAT,ACKAPI,ACKCT,ACKPRIM,ACKSCND,ACKSTUD,ACKIEN,ACKICD9
"RTN","ACKQPCE1",14,0)
 N ACKCPT,ACKVOL,ACKIEN2,ACKMOD,ACKPROB,ACKARR,ACKDATE,ACKDPRIM,ACKK5
"RTN","ACKQPCE1",15,0)
 ; initialize
"RTN","ACKQPCE1",16,0)
 S ACKSENT=0,ACKLOCK=0,ACKERR=0
"RTN","ACKQPCE1",17,0)
 D NOW^%DTC S ACKDATE=%  ; to be used for LAST SENT TO PCE field
"RTN","ACKQPCE1",18,0)
 ;
"RTN","ACKQPCE1",19,0)
 ; lock the visit
"RTN","ACKQPCE1",20,0)
 L +^ACK(509850.6,ACKVIEN):0 S ACKLOCK=$T
"RTN","ACKQPCE1",21,0)
 ; if unable to lock then exit
"RTN","ACKQPCE1",22,0)
 I 'ACKLOCK G SENDPCEX
"RTN","ACKQPCE1",23,0)
 ;
"RTN","ACKQPCE1",24,0)
 ; initialize temp file
"RTN","ACKQPCE1",25,0)
 K ^TMP("ACKQPCE1",$J)
"RTN","ACKQPCE1",26,0)
 ;
"RTN","ACKQPCE1",27,0)
 ; remove PCE errors from the visit
"RTN","ACKQPCE1",28,0)
 D CLEAR^ACKQPCE(ACKVIEN)
"RTN","ACKQPCE1",29,0)
 ;
"RTN","ACKQPCE1",30,0)
 ; get the visit data and place in temp file
"RTN","ACKQPCE1",31,0)
 D GETDATA
"RTN","ACKQPCE1",32,0)
 ;
"RTN","ACKQPCE1",33,0)
 ; if this visit exists in PCE then remove workload data
"RTN","ACKQPCE1",34,0)
 D CHKPCE I ACKERR G SENDPCEX
"RTN","ACKQPCE1",35,0)
 ;
"RTN","ACKQPCE1",36,0)
 ; build the temp file for sending to PCE
"RTN","ACKQPCE1",37,0)
 D BUILD
"RTN","ACKQPCE1",38,0)
 ;
"RTN","ACKQPCE1",39,0)
 ; now send
"RTN","ACKQPCE1",40,0)
 D SENDIT
"RTN","ACKQPCE1",41,0)
 ;
"RTN","ACKQPCE1",42,0)
SENDPCEX ; exit point
"RTN","ACKQPCE1",43,0)
 ;
"RTN","ACKQPCE1",44,0)
 ; if visit was locked, unlock it
"RTN","ACKQPCE1",45,0)
 I ACKLOCK L -^ACK(509850.6,ACKVIEN)
"RTN","ACKQPCE1",46,0)
 ;
"RTN","ACKQPCE1",47,0)
 ; clear the temp file
"RTN","ACKQPCE1",48,0)
 ;K ^TMP("ACKQPCE1",$J)
"RTN","ACKQPCE1",49,0)
 ;
"RTN","ACKQPCE1",50,0)
 ; return
"RTN","ACKQPCE1",51,0)
 Q ACKSENT
"RTN","ACKQPCE1",52,0)
 ;
"RTN","ACKQPCE1",53,0)
GETDATA ; get the visit data and place in temp file
"RTN","ACKQPCE1",54,0)
 S ACKFDA=$NA(^TMP("ACKQPCE1",$J,"FDA"))
"RTN","ACKQPCE1",55,0)
 D GETS^DIQ(509850.6,ACKVIEN_",","**","I",ACKFDA,"")
"RTN","ACKQPCE1",56,0)
 S ACKFDA2=$NA(^TMP("ACKQPCE1",$J,"FDA",509850.6,ACKVIEN_","))
"RTN","ACKQPCE1",57,0)
 ; data now stored in ..
"RTN","ACKQPCE1",58,0)
 ;  ^TMP("ACKQPCE1",$J,"FDA",509850.6,visit_",",fldnum,"I")=internal value
"RTN","ACKQPCE1",59,0)
 ;  simplified to @ACKFDA2@(fldnum,"I")=internal value
"RTN","ACKQPCE1",60,0)
 ;  get the PCE visit ien
"RTN","ACKQPCE1",61,0)
 S ACKPCE=@ACKFDA2@(125,"I")
"RTN","ACKQPCE1",62,0)
 ; get the visit date and time, patient and clinic
"RTN","ACKQPCE1",63,0)
 S ACKVDT=@ACKFDA2@(.01,"I")
"RTN","ACKQPCE1",64,0)
 S ACKVTM=@ACKFDA2@(55,"I")
"RTN","ACKQPCE1",65,0)
 S ACKPAT=@ACKFDA2@(1,"I")
"RTN","ACKQPCE1",66,0)
 S ACKCLN=@ACKFDA2@(2.6,"I")
"RTN","ACKQPCE1",67,0)
 ; end of getdata
"RTN","ACKQPCE1",68,0)
 Q
"RTN","ACKQPCE1",69,0)
 ;
"RTN","ACKQPCE1",70,0)
CHKPCE ; check if the visit is already in PCE and remove workload if it is
"RTN","ACKQPCE1",71,0)
 I 'ACKPCE Q
"RTN","ACKQPCE1",72,0)
 ;
"RTN","ACKQPCE1",73,0)
 ; check PCE visit is for same Patient, Clinic, Date and Time
"RTN","ACKQPCE1",74,0)
 ;  if any item different then this Qsr visit is treated as new
"RTN","ACKQPCE1",75,0)
 ;   and any data from Quasar is deleted from the original PCE visit
"RTN","ACKQPCE1",76,0)
 ;  (sending ACKPKG and ACKSRC ensures that only data that originally
"RTN","ACKQPCE1",77,0)
 ;  came from Quasar will be removed).
"RTN","ACKQPCE1",78,0)
 I +$$PCECHK^ACKQUTL3(ACKPCE,ACKVDT,ACKVTM,ACKPAT,ACKCLN)'=2 D  Q
"RTN","ACKQPCE1",79,0)
 . S ACKE=$$DELVFILE^PXAPI("ALL",ACKPCE,ACKPKG,ACKSRC,0,0,"")
"RTN","ACKQPCE1",80,0)
 . S ACKPCE=""  ; remove PCE Visit ien from Qsr visit
"RTN","ACKQPCE1",81,0)
 . K ACKARR S ACKARR(509850.6,ACKVIEN_",",125)="@"
"RTN","ACKQPCE1",82,0)
 . D FILE^DIE("","ACKARR","")
"RTN","ACKQPCE1",83,0)
 ;
"RTN","ACKQPCE1",84,0)
 ; remove all workload data from the PCE visit
"RTN","ACKQPCE1",85,0)
 S ACKE=$$DELVFILE^PXAPI("CPT^POV^PRV^VISIT",ACKPCE,"","",0,0,"")
"RTN","ACKQPCE1",86,0)
 S ACKERR=$S(ACKE>-1:0,ACKE=-4:0,1:1)
"RTN","ACKQPCE1",87,0)
 ;
"RTN","ACKQPCE1",88,0)
 ; if error occurred then store on visit file
"RTN","ACKQPCE1",89,0)
 I ACKERR D  Q
"RTN","ACKQPCE1",90,0)
 . K ACKRSN S ACKMSG="Unable to delete original PCE visit data (error code="_ACKE_")"
"RTN","ACKQPCE1",91,0)
 . D ADDRSN^ACKQPCE2("PCE VISIT",ACKPCE,"",ACKMSG,.ACKRSN)
"RTN","ACKQPCE1",92,0)
 . D FILERSN^ACKQPCE(ACKVIEN,.ACKRSN)   ; file errors on visit file
"RTN","ACKQPCE1",93,0)
 ;
"RTN","ACKQPCE1",94,0)
 ; if no error, check to see if the entire PCE visit has been deleted
"RTN","ACKQPCE1",95,0)
 ;  and if so, blank out the PCE Visit ien variable so that a new one
"RTN","ACKQPCE1",96,0)
 ;  can be allocated.
"RTN","ACKQPCE1",97,0)
 K ^TMP("PXKENC",$J)
"RTN","ACKQPCE1",98,0)
 D ENCEVENT^PXAPI(ACKPCE)
"RTN","ACKQPCE1",99,0)
 I '$D(^TMP("PXKENC",$J,ACKPCE)) D
"RTN","ACKQPCE1",100,0)
 . K ACKARR S ACKARR(509850.6,ACKVIEN_",",125)="@"
"RTN","ACKQPCE1",101,0)
 . D FILE^DIE("","ACKARR","")
"RTN","ACKQPCE1",102,0)
 . S ACKPCE=""
"RTN","ACKQPCE1",103,0)
 K ^TMP("PXKENC",$J)
"RTN","ACKQPCE1",104,0)
 ;
"RTN","ACKQPCE1",105,0)
 ; return
"RTN","ACKQPCE1",106,0)
 Q
"RTN","ACKQPCE1",107,0)
 ;
"RTN","ACKQPCE1",108,0)
 ;
"RTN","ACKQPCE1",109,0)
BUILD ; now build array for passing data to PCE
"RTN","ACKQPCE1",110,0)
 K ^TMP("ACKQPCE1",$J,"PXAPI")
"RTN","ACKQPCE1",111,0)
 S ACKAPI=$NA(^TMP("ACKQPCE1",$J,"PXAPI"))
"RTN","ACKQPCE1",112,0)
 ;
"RTN","ACKQPCE1",113,0)
 ; ----------encounter date/time----------------
"RTN","ACKQPCE1",114,0)
 S @ACKAPI@("ENCOUNTER",1,"ENC D/T")=(ACKVDT\1+ACKVTM)
"RTN","ACKQPCE1",115,0)
 ; --------------patient-----------------------
"RTN","ACKQPCE1",116,0)
 S @ACKAPI@("ENCOUNTER",1,"PATIENT")=ACKPAT
"RTN","ACKQPCE1",117,0)
 ; ---------------clinic-----------------------
"RTN","ACKQPCE1",118,0)
 S @ACKAPI@("ENCOUNTER",1,"HOS LOC")=ACKCLN
"RTN","ACKQPCE1",119,0)
 ; ------------service connected---------------
"RTN","ACKQPCE1",120,0)
 S ACKSC=@ACKFDA2@(20,"I")
"RTN","ACKQPCE1",121,0)
 S @ACKAPI@("ENCOUNTER",1,"SC")=ACKSC
"RTN","ACKQPCE1",122,0)
 ; -------------agent orange,MST etc---------------
"RTN","ACKQPCE1",123,0)
 S ACKAO=@ACKFDA2@(25,"I")
"RTN","ACKQPCE1",124,0)
 S @ACKAPI@("ENCOUNTER",1,"AO")=ACKAO
"RTN","ACKQPCE1",125,0)
 S ACKIR=@ACKFDA2@(30,"I")
"RTN","ACKQPCE1",126,0)
 S @ACKAPI@("ENCOUNTER",1,"IR")=ACKIR
"RTN","ACKQPCE1",127,0)
 S ACKEC=@ACKFDA2@(35,"I")
"RTN","ACKQPCE1",128,0)
 S @ACKAPI@("ENCOUNTER",1,"EC")=ACKEC
"RTN","ACKQPCE1",129,0)
 S ACKMST=@ACKFDA2@(90,"I")
"RTN","ACKQPCE1",130,0)
 S @ACKAPI@("ENCOUNTER",1,"MST")=ACKMST
"RTN","ACKQPCE1",131,0)
 ; -------------checkout date/time-------------
"RTN","ACKQPCE1",132,0)
 D NOW^%DTC S ACKCHKDT=%
"RTN","ACKQPCE1",133,0)
 S @ACKAPI@("ENCOUNTER",1,"CHECKOUT D/T")=ACKCHKDT
"RTN","ACKQPCE1",134,0)
 ; -------------visit eligibility--------------
"RTN","ACKQPCE1",135,0)
 S ACKELIG=@ACKFDA2@(80,"I")
"RTN","ACKQPCE1",136,0)
 S @ACKAPI@("ENCOUNTER",1,"ELIGIBILITY")=ACKELIG
"RTN","ACKQPCE1",137,0)
 ; --------------service category--------------
"RTN","ACKQPCE1",138,0)
 S ACKVSC=@ACKFDA2@(4,"I")
"RTN","ACKQPCE1",139,0)
 S ACKCAT=$S(ACKVSC="AT":"T",ACKVSC="ST":"T",1:"X")
"RTN","ACKQPCE1",140,0)
 S @ACKAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=ACKCAT
"RTN","ACKQPCE1",141,0)
 ; ---------------encounter type---------------
"RTN","ACKQPCE1",142,0)
 S @ACKAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","ACKQPCE1",143,0)
 ;
"RTN","ACKQPCE1",144,0)
 S ACKCT=0
"RTN","ACKQPCE1",145,0)
 ; ------------secondary provider-------------
"RTN","ACKQPCE1",146,0)
 S ACKK5=""
"RTN","ACKQPCE1",147,0)
 F  S ACKK5=$O(^TMP("ACKQPCE1",$J,"FDA",509850.66,ACKK5)) Q:ACKK5=""  D
"RTN","ACKQPCE1",148,0)
 . I $P(ACKK5,",",2)'=ACKVIEN Q
"RTN","ACKQPCE1",149,0)
 . S ACKSCND=$G(^TMP("ACKQPCE1",$J,"FDA",509850.66,ACKK5,".01","I"))
"RTN","ACKQPCE1",150,0)
 . I ACKSCND="" Q
"RTN","ACKQPCE1",151,0)
 . S ACKSCND=$$CONVERT1^ACKQUTL4(ACKSCND)
"RTN","ACKQPCE1",152,0)
 . S ACKCT=ACKCT+1,@ACKAPI@("PROVIDER",ACKCT,"NAME")=ACKSCND
"RTN","ACKQPCE1",153,0)
 ; ------------primary provider----------------
"RTN","ACKQPCE1",154,0)
 S ACKPRIM=@ACKFDA2@(6,"I")
"RTN","ACKQPCE1",155,0)
 I ACKPRIM'="" D
"RTN","ACKQPCE1",156,0)
 . S ACKPRIM=$$CONVERT1^ACKQUTL4(ACKPRIM)
"RTN","ACKQPCE1",157,0)
 . S ACKCT=ACKCT+1,@ACKAPI@("PROVIDER",ACKCT,"NAME")=ACKPRIM
"RTN","ACKQPCE1",158,0)
 . S @ACKAPI@("PROVIDER",ACKCT,"PRIMARY")=1
"RTN","ACKQPCE1",159,0)
 ;
"RTN","ACKQPCE1",160,0)
 ; ----------------diagnosis------------------
"RTN","ACKQPCE1",161,0)
 N ACKPBLM,ACKPBLMP,ACKIFN,ACKPLQT
"RTN","ACKQPCE1",162,0)
 S ACKCT=0,(ACKIEN,ACKDPRIM,ACKNARR,ACKPBLM,ACKPBLMP)=""
"RTN","ACKQPCE1",163,0)
 F  S ACKIEN=$O(@ACKFDA@(509850.63,ACKIEN)) Q:ACKIEN=""  D
"RTN","ACKQPCE1",164,0)
 . I $P(ACKIEN,",",2)'=ACKVIEN Q
"RTN","ACKQPCE1",165,0)
 . S ACKICD9=@ACKFDA@(509850.63,ACKIEN,.01,"I")
"RTN","ACKQPCE1",166,0)
 . S ACKCT=ACKCT+1,@ACKAPI@("DX/PL",ACKCT,"DIAGNOSIS")=ACKICD9
"RTN","ACKQPCE1",167,0)
 . S ACKNARR=$$GET1^DIQ(80,ACKICD9,10,"I")
"RTN","ACKQPCE1",168,0)
 . I ACKNARR'="" S @ACKAPI@("DX/PL",ACKCT,"NARRATIVE")=ACKNARR
"RTN","ACKQPCE1",169,0)
 . ; check for updating PCE problem list flag
"RTN","ACKQPCE1",170,0)
 . S ACKPBLM=@ACKFDA@(509850.63,ACKIEN,.13,"I") I ACKPBLM D
"RTN","ACKQPCE1",171,0)
 . . ; don't send if diagnosis provider blank
"RTN","ACKQPCE1",172,0)
 . . S ACKPBLMP=@ACKFDA@(509850.63,ACKIEN,.14,"I") Q:'ACKPBLMP
"RTN","ACKQPCE1",173,0)
 . . S ACKPLQT=$$PLIST^ACKQUTL6(ACKPAT,ACKICD9)
"RTN","ACKQPCE1",174,0)
 . . ; send new problem if not on list
"RTN","ACKQPCE1",175,0)
 . . I 'ACKPLQT S @ACKAPI@("DX/PL",ACKCT,"PL ADD")=1
"RTN","ACKQPCE1",176,0)
 . . ; make existing problem active if currently inactive
"RTN","ACKQPCE1",177,0)
 . . I +ACKPLQT=1 D
"RTN","ACKQPCE1",178,0)
 . . . S @ACKAPI@("DX/PL",ACKCT,"PL IEN")=$P(ACKPLQT,U,2)
"RTN","ACKQPCE1",179,0)
 . . . S @ACKAPI@("DX/PL",ACKCT,"PL ACTIVE")="A"
"RTN","ACKQPCE1",180,0)
 . . ; send event date and encounter provider if updating list
"RTN","ACKQPCE1",181,0)
 . . I +ACKPLQT'=2 D
"RTN","ACKQPCE1",182,0)
 . . . S @ACKAPI@("DX/PL",ACKCT,"EVENT D/T")=ACKVD
"RTN","ACKQPCE1",183,0)
 . . . S ACKPBLMP=$$CONVERT1^ACKQUTL4(ACKPBLMP)
"RTN","ACKQPCE1",184,0)
 . . . S @ACKAPI@("DX/PL",ACKCT,"ENC PROVIDER")=ACKPBLMP
"RTN","ACKQPCE1",185,0)
 . ; Check for primary diagnosis
"RTN","ACKQPCE1",186,0)
 . I 'ACKDPRIM,@ACKFDA@(509850.63,ACKIEN,.12,"I")=1 D
"RTN","ACKQPCE1",187,0)
 . . S @ACKAPI@("DX/PL",ACKCT,"PRIMARY")=1
"RTN","ACKQPCE1",188,0)
 . . S ACKDPRIM=1
"RTN","ACKQPCE1",189,0)
 ; First Diagnosis sent as Primary if No Primary defined on Visit file
"RTN","ACKQPCE1",190,0)
 I 'ACKDPRIM,ACKCT>0 S @ACKAPI@("DX/PL",1,"PRIMARY")=1
"RTN","ACKQPCE1",191,0)
 ;
"RTN","ACKQPCE1",192,0)
 ; -----------------procedures----------------
"RTN","ACKQPCE1",193,0)
 S ACKCT=0,ACKIEN="",ACKPROCP=""
"RTN","ACKQPCE1",194,0)
 F  S ACKIEN=$O(@ACKFDA@(509850.61,ACKIEN)) Q:ACKIEN=""  D
"RTN","ACKQPCE1",195,0)
 . I $P(ACKIEN,",",2)'=ACKVIEN Q
"RTN","ACKQPCE1",196,0)
 . S ACKCPT=@ACKFDA@(509850.61,ACKIEN,.01,"I")    ; CPT IEN
"RTN","ACKQPCE1",197,0)
 . S ACKVOL=@ACKFDA@(509850.61,ACKIEN,.03,"I")    ; Volume
"RTN","ACKQPCE1",198,0)
 . S ACKPROCP=@ACKFDA@(509850.61,ACKIEN,.05,"I")  ; Provider
"RTN","ACKQPCE1",199,0)
 . I ACKPROCP'="" S ACKPROCP=$$CONVERT1^ACKQUTL4(ACKPROCP)   ;  Convert from QSR to Vista
"RTN","ACKQPCE1",200,0)
 . S ACKCT=ACKCT+1,@ACKAPI@("PROCEDURE",ACKCT,"PROCEDURE")=ACKCPT
"RTN","ACKQPCE1",201,0)
 . S @ACKAPI@("PROCEDURE",ACKCT,"QTY")=$S(ACKVOL:ACKVOL,1:1)
"RTN","ACKQPCE1",202,0)
 . I ACKPROCP'="" S @ACKAPI@("PROCEDURE",ACKCT,"ENC PROVIDER")=ACKPROCP
"RTN","ACKQPCE1",203,0)
 . ; --------------procedure modifiers-------------
"RTN","ACKQPCE1",204,0)
 . S ACKIEN2=""
"RTN","ACKQPCE1",205,0)
 . F  S ACKIEN2=$O(@ACKFDA@(509850.64,ACKIEN2)) Q:ACKIEN2=""  D
"RTN","ACKQPCE1",206,0)
 . . I $P(ACKIEN2,",",2,3)'=$P(ACKIEN,",",1,2) Q
"RTN","ACKQPCE1",207,0)
 . . S ACKMOD=@ACKFDA@(509850.64,ACKIEN2,.01,"I")
"RTN","ACKQPCE1",208,0)
 . . S ACKMOD=$$GET1^DIQ(509850.5,ACKMOD,.01,"E")
"RTN","ACKQPCE1",209,0)
 . . I $D(@ACKAPI@("PROCEDURE",ACKCT,"MODIFIERS"))#10=0 D
"RTN","ACKQPCE1",210,0)
 . . . S @ACKAPI@("PROCEDURE",ACKCT,"MODIFIERS")=""
"RTN","ACKQPCE1",211,0)
 . . S @ACKAPI@("PROCEDURE",ACKCT,"MODIFIERS",ACKMOD)=""
"RTN","ACKQPCE1",212,0)
 ;
"RTN","ACKQPCE1",213,0)
 ; end of build
"RTN","ACKQPCE1",214,0)
 Q
"RTN","ACKQPCE1",215,0)
 ;
"RTN","ACKQPCE1",216,0)
SENDIT ; send the data to PCE
"RTN","ACKQPCE1",217,0)
 K ACKPROB
"RTN","ACKQPCE1",218,0)
 ;
"RTN","ACKQPCE1",219,0)
 ; call the PCE package API
"RTN","ACKQPCE1",220,0)
 S ACKE=$$DATA2PCE^PXAPI($NA(^TMP("ACKQPCE1",$J,"PXAPI")),ACKPKG,ACKSRC,.ACKPCE,"",0,.ACKE2,"",.ACKPROB)
"RTN","ACKQPCE1",221,0)
 ;
"RTN","ACKQPCE1",222,0)
 ; check for returned error messages
"RTN","ACKQPCE1",223,0)
 K ACKRSN S ACKRSN=0
"RTN","ACKQPCE1",224,0)
 I $D(ACKPROB) D CONVERT^ACKQPCE2(.ACKPROB,ACKAPI,.ACKRSN)
"RTN","ACKQPCE1",225,0)
 ;
"RTN","ACKQPCE1",226,0)
 ; if update failed but no errors were returned then create a message
"RTN","ACKQPCE1",227,0)
 I ACKE'=1,'ACKRSN D
"RTN","ACKQPCE1",228,0)
 . S ACKMSG="Unable to update PCE Visit (error code="_ACKE_")"
"RTN","ACKQPCE1",229,0)
 . D ADDRSN^ACKQPCE2("PCE VISIT","","",ACKMSG,.ACKRSN)
"RTN","ACKQPCE1",230,0)
 . I ACKPCE'>0 D    ; pce ien has been corrupted by the API
"RTN","ACKQPCE1",231,0)
 . . K ACKARR S ACKARR(509850.6,ACKVIEN_",",125)="@"
"RTN","ACKQPCE1",232,0)
 . . D FILE^DIE("","ACKARR","")
"RTN","ACKQPCE1",233,0)
 ;
"RTN","ACKQPCE1",234,0)
 ; if errors found then file them on the Visit file and create exception
"RTN","ACKQPCE1",235,0)
 I ACKE'=1,ACKRSN D
"RTN","ACKQPCE1",236,0)
 . D FILERSN^ACKQPCE(ACKVIEN,.ACKRSN)
"RTN","ACKQPCE1",237,0)
 . K ACKARR
"RTN","ACKQPCE1",238,0)
 . S ACKARR(509850.6,ACKVIEN_",",125)=ACKPCE  ; for new visits!
"RTN","ACKQPCE1",239,0)
 . D FILE^DIE("","ACKARR","")
"RTN","ACKQPCE1",240,0)
 ;
"RTN","ACKQPCE1",241,0)
 ; if no errors update the PCE fields
"RTN","ACKQPCE1",242,0)
 I ACKE=1 D
"RTN","ACKQPCE1",243,0)
 . K ACKARR
"RTN","ACKQPCE1",244,0)
 . S ACKARR(509850.6,ACKVIEN_",",125)=ACKPCE  ; for new visits!
"RTN","ACKQPCE1",245,0)
 . S ACKARR(509850.6,ACKVIEN_",",135)=ACKDATE ; date last sent
"RTN","ACKQPCE1",246,0)
 . D FILE^DIE("","ACKARR","")
"RTN","ACKQPCE1",247,0)
 . S ACKSENT=1   ; return flag (1=sent,0=not sent)
"RTN","ACKQPCE1",248,0)
 ;
"RTN","ACKQPCE1",249,0)
 ; end of sendit
"RTN","ACKQPCE1",250,0)
 Q
"RTN","ACKQPCE1",251,0)
 ;
"RTN","ACKQUTL6")
0^2^B69249054
"RTN","ACKQUTL6",1,0)
ACKQUTL6 ;HCIOFO/BH-A&SP Utilities routine ; 5/6/03 11:07am
"RTN","ACKQUTL6",2,0)
 ;;3.0;QUASAR;**1,7**;Feb 11, 2000
"RTN","ACKQUTL6",3,0)
 ;Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","ACKQUTL6",4,0)
 ;
"RTN","ACKQUTL6",5,0)
DATACHEK(X,ACKVIEN) ;  Checks that the input (X) is a valid time also checks that 
"RTN","ACKQUTL6",6,0)
 ;          current user has supervisor status
"RTN","ACKQUTL6",7,0)
 ;
"RTN","ACKQUTL6",8,0)
 I $$TIMECHEK^ACKQASU5(ACKVIEN,"") Q 0
"RTN","ACKQUTL6",9,0)
 S X=$$TTIME(X) Q X
"RTN","ACKQUTL6",10,0)
 ;
"RTN","ACKQUTL6",11,0)
 ;
"RTN","ACKQUTL6",12,0)
SUPER(DUZ) ;  Function passes back true if DUZ belongs to a supervisor
"RTN","ACKQUTL6",13,0)
 N ACKDUZ
"RTN","ACKQUTL6",14,0)
 S ACKDUZ=$$PROVCHK^ACKQASU4(DUZ)
"RTN","ACKQUTL6",15,0)
 I 'ACKDUZ Q 0
"RTN","ACKQUTL6",16,0)
 I $D(^ACK(509850.3,ACKDUZ,0)),$P(^(0),"^",6)=1 Q 1
"RTN","ACKQUTL6",17,0)
 Q 0
"RTN","ACKQUTL6",18,0)
 ;
"RTN","ACKQUTL6",19,0)
 ;
"RTN","ACKQUTL6",20,0)
TTIME(X) ;   Time input validation used within input transform of
"RTN","ACKQUTL6",21,0)
 ;           the Appointment time field (#55) of the visit file.
"RTN","ACKQUTL6",22,0)
 ;
"RTN","ACKQUTL6",23,0)
 ;           X=Time entered by the user
"RTN","ACKQUTL6",24,0)
 ;           Return value either O if input was invalid or formatted
"RTN","ACKQUTL6",25,0)
 ;           time.
"RTN","ACKQUTL6",26,0)
 ;
"RTN","ACKQUTL6",27,0)
 N Y,ACKFMT,ACKAMPM
"RTN","ACKQUTL6",28,0)
 I X="NOW"!(X="now") D NOW^%DTC S X=$P(%,".",2)
"RTN","ACKQUTL6",29,0)
 I X="NOO" S X="NOON"
"RTN","ACKQUTL6",30,0)
 ;
"RTN","ACKQUTL6",31,0)
 S %DT="%DTS"
"RTN","ACKQUTL6",32,0)
 ; S DIR(0)="D^::%DT"
"RTN","ACKQUTL6",33,0)
 S X="2990303@"_X
"RTN","ACKQUTL6",34,0)
 K Y
"RTN","ACKQUTL6",35,0)
 D ^%DT
"RTN","ACKQUTL6",36,0)
 ;
"RTN","ACKQUTL6",37,0)
 I Y="-1" Q 0
"RTN","ACKQUTL6",38,0)
 S Y=$P(Y,".",2)
"RTN","ACKQUTL6",39,0)
 S ACKT="."_Y
"RTN","ACKQUTL6",40,0)
 ;
"RTN","ACKQUTL6",41,0)
 S ACKFMT=Y
"RTN","ACKQUTL6",42,0)
 ;. D AMPM
"RTN","ACKQUTL6",43,0)
 ;. W ?30,"("_+$E(ACKFMT,1,2)_":"_$E(ACKFMT,3,4)_":"_$E(ACKFMT,5,6)_ACKAMPM_")"
"RTN","ACKQUTL6",44,0)
 ;. D AMPM
"RTN","ACKQUTL6",45,0)
 ;. W ?30,"("_+$E(ACKFMT,1,2)_":"_$E(ACKFMT,3,4)_ACKAMPM_")"
"RTN","ACKQUTL6",46,0)
 W ?30,"("_$$FMT(ACKFMT)_")"
"RTN","ACKQUTL6",47,0)
 Q ACKT
"RTN","ACKQUTL6",48,0)
 ;
"RTN","ACKQUTL6",49,0)
FMT(ACKFMT,ACKSTYL) ; convert Quasar Time to external format
"RTN","ACKQUTL6",50,0)
 ; inputs:- ACKFMT - fileman time (internal)  (reqd)
"RTN","ACKQUTL6",51,0)
 ;            can be passed in as 'date.time','.time' or just 'time'
"RTN","ACKQUTL6",52,0)
 ;          ACKSTYL - style of output (optional)
"RTN","ACKQUTL6",53,0)
 ;                    where 0 = 12:mm[:ss] am/pm (no lead space)
"RTN","ACKQUTL6",54,0)
 ;                          1 = 12:mm[:ss] am/pm (lead space)
"RTN","ACKQUTL6",55,0)
 ;                          2 = 12:mm am/pm
"RTN","ACKQUTL6",56,0)
 N ACKHH,ACKAMPM
"RTN","ACKQUTL6",57,0)
 S ACKSTYL=+$G(ACKSTYL)
"RTN","ACKQUTL6",58,0)
 I ACKFMT["." S ACKFMT=$P(ACKFMT,".",2)
"RTN","ACKQUTL6",59,0)
 S ACKFMT=ACKFMT_"00000"
"RTN","ACKQUTL6",60,0)
 S ACKHH=+$E(ACKFMT,1,2)
"RTN","ACKQUTL6",61,0)
 G:ACKSTYL=1 FMT1
"RTN","ACKQUTL6",62,0)
 G:ACKSTYL=2 FMT2
"RTN","ACKQUTL6",63,0)
FMT0 ; style 0 - 12:mm[:ss] am/pm  (the default)
"RTN","ACKQUTL6",64,0)
 S ACKAMPM=" AM" I ACKHH>11,ACKHH<24 S ACKAMPM=" PM"
"RTN","ACKQUTL6",65,0)
 I ACKHH<1 S ACKHH=12
"RTN","ACKQUTL6",66,0)
 I ACKHH>12 S ACKHH=ACKHH-12
"RTN","ACKQUTL6",67,0)
 S ACKFMT=ACKHH_":"_$E(ACKFMT,3,4)_$S(+$E(ACKFMT,5,6)>0:":"_$E(ACKFMT,5,6),1:"")_ACKAMPM
"RTN","ACKQUTL6",68,0)
 Q ACKFMT
"RTN","ACKQUTL6",69,0)
FMT1 ; style 1 - 12:mm[:ss] am/pm  (with lead space if hour<10)
"RTN","ACKQUTL6",70,0)
 S ACKAMPM=" AM" I ACKHH>11,ACKHH<24 S ACKAMPM=" PM"
"RTN","ACKQUTL6",71,0)
 I ACKHH<1 S ACKHH=12
"RTN","ACKQUTL6",72,0)
 I ACKHH>12 S ACKHH=ACKHH-12
"RTN","ACKQUTL6",73,0)
 S ACKFMT=$J(ACKHH,2)_":"_$E(ACKFMT,3,4)_$S(+$E(ACKFMT,5,6)>0:":"_$E(ACKFMT,5,6),1:"")_ACKAMPM
"RTN","ACKQUTL6",74,0)
 Q ACKFMT
"RTN","ACKQUTL6",75,0)
FMT2 ; style 2 - 12:mm am/pm
"RTN","ACKQUTL6",76,0)
 S ACKAMPM=" AM" I ACKHH>11,ACKHH<24 S ACKAMPM=" PM"
"RTN","ACKQUTL6",77,0)
 I ACKHH<1 S ACKHH=12
"RTN","ACKQUTL6",78,0)
 I ACKHH>12 S ACKHH=ACKHH-12
"RTN","ACKQUTL6",79,0)
 S ACKFMT=$J(ACKHH,2)_":"_$E(ACKFMT,3,4)_ACKAMPM
"RTN","ACKQUTL6",80,0)
 Q ACKFMT
"RTN","ACKQUTL6",81,0)
 ;
"RTN","ACKQUTL6",82,0)
DUPECHK(X,DA,ACKP) ;  Check there are no previous duplicate entries
"RTN","ACKQUTL6",83,0)
 N ACKTGT,ACKCLIN,ACKVD,ACKPAT
"RTN","ACKQUTL6",84,0)
 S ACKPAT=ACKP
"RTN","ACKQUTL6",85,0)
 D GETS^DIQ(509850.6,DA_",",".01;1;2.6","I","ACKTGT")
"RTN","ACKQUTL6",86,0)
 S ACKVD=$G(ACKTGT(509850.6,DA_",",.01,"I")) I ACKVD="" Q 1
"RTN","ACKQUTL6",87,0)
 I ACKPAT="" S ACKPAT=$G(ACKTGT(509850.6,DA_",",1,"I")) I ACKPAT="" Q 1
"RTN","ACKQUTL6",88,0)
 S ACKCLIN=$G(ACKTGT(509850.6,DA_",",2.6,"I")) I ACKCLIN="" Q 1
"RTN","ACKQUTL6",89,0)
 I $D(^ACK(509850.6,"APCE",ACKPAT,ACKCLIN,ACKVD,X)) Q 0
"RTN","ACKQUTL6",90,0)
 Q 1
"RTN","ACKQUTL6",91,0)
 ;
"RTN","ACKQUTL6",92,0)
DUPCHK ;  Called from xecutable help of Appointment Time field when ACKITME is
"RTN","ACKQUTL6",93,0)
 ;  defined.  This will only be defined if DUPECHK returned false
"RTN","ACKQUTL6",94,0)
 W !!,"Quasar already has a Visit entry for this Patient, within the same Clinic,"
"RTN","ACKQUTL6",95,0)
 W !,"on the same date at the same time."
"RTN","ACKQUTL6",96,0)
 W !!,"Please re-enter a new Appointment Time.",!!
"RTN","ACKQUTL6",97,0)
 K ACKITME Q
"RTN","ACKQUTL6",98,0)
 ;
"RTN","ACKQUTL6",99,0)
 ;
"RTN","ACKQUTL6",100,0)
CDR() ;  COMPUTE SUGGESTED CDR BASED ON TREATING SPECIALTY
"RTN","ACKQUTL6",101,0)
 S VAIP("D")=ACKVD D IN5^VADPT S ACKTS=+$$GET1^DIQ(45.7,+VAIP(8),1,"I"),ACKCDN=$$GET1^DIQ(42.4,ACKTS,6)_".00"
"RTN","ACKQUTL6",102,0)
 S ACKCDP=$S($O(^ACK(509850,"B",ACKCDN,0)):$O(^(0)),1:0) I 'ACKCDP S ACKCDP=$O(^ACK(509850,"B","2611.00",0))
"RTN","ACKQUTL6",103,0)
 S ACKCDN=$P(^ACK(509850,ACKCDP,0),U),ACKCD=$P(^(0),U,2)
"RTN","ACKQUTL6",104,0)
 K %,%H,%I,ACKTS,ACKCDP,VAIP,VAERR
"RTN","ACKQUTL6",105,0)
 W !!,"Suggested CDR Account :",ACKCDN,"  ",ACKCD,!
"RTN","ACKQUTL6",106,0)
 Q ACKCDN
"RTN","ACKQUTL6",107,0)
 ;
"RTN","ACKQUTL6",108,0)
 ;----------------------------------------------------------------
"RTN","ACKQUTL6",109,0)
 ;  Routines and Utilities used within the Clinician Template
"RTN","ACKQUTL6",110,0)
 ;
"RTN","ACKQUTL6",111,0)
 ;
"RTN","ACKQUTL6",112,0)
STAFFNO(X) ;  Finds valid staff No. to be used when allocating next time
"RTN","ACKQUTL6",113,0)
 ;
"RTN","ACKQUTL6",114,0)
 N ACKFIRST,ACKFIND,ACKX
"RTN","ACKQUTL6",115,0)
 S ACKFIRST=1
"RTN","ACKQUTL6",116,0)
 I X=9999 S X="0000" S ACKFIRST=0
"RTN","ACKQUTL6",117,0)
 D GETNEXT,FILE
"RTN","ACKQUTL6",118,0)
 Q
"RTN","ACKQUTL6",119,0)
 ;
"RTN","ACKQUTL6",120,0)
GETNEXT ;
"RTN","ACKQUTL6",121,0)
 S ACKFIND=0
"RTN","ACKQUTL6",122,0)
 F  Q:ACKFIND  D
"RTN","ACKQUTL6",123,0)
 . S ACKX=+X
"RTN","ACKQUTL6",124,0)
 . S X=X+1
"RTN","ACKQUTL6",125,0)
 . I X=9999,ACKFIRST S ACKFIRST=0 S X=0 Q
"RTN","ACKQUTL6",126,0)
 . I X=9999,'ACKFIRST S ACKFIND=1 Q
"RTN","ACKQUTL6",127,0)
 . S X=$E("0000",$L(X)+1,4)_X
"RTN","ACKQUTL6",128,0)
 . I '$D(^ACK(509850.3,"C",X)) S ACKFIND=1,X=ACKX Q
"RTN","ACKQUTL6",129,0)
 Q
"RTN","ACKQUTL6",130,0)
 ;
"RTN","ACKQUTL6",131,0)
FILE ;
"RTN","ACKQUTL6",132,0)
 S ^ACK(509850.3,"ALID")=$E("0000",$L(X)+1,4)_X
"RTN","ACKQUTL6",133,0)
 Q
"RTN","ACKQUTL6",134,0)
 ;
"RTN","ACKQUTL6",135,0)
 ;
"RTN","ACKQUTL6",136,0)
IDATE(D0,Y) ;  Checks that the entered Inactive date falls after the
"RTN","ACKQUTL6",137,0)
 ;          Active date (if one has been entered).
"RTN","ACKQUTL6",138,0)
 I Y="" Q 1  ;  Its valid to not enter an inactivation date. 
"RTN","ACKQUTL6",139,0)
 N ACKACT
"RTN","ACKQUTL6",140,0)
 S ACKACT=$$GET1^DIQ(509850.3,D0,.03,"I") I ACKACT="" Q 1
"RTN","ACKQUTL6",141,0)
 I Y<ACKACT Q 0
"RTN","ACKQUTL6",142,0)
 Q 1
"RTN","ACKQUTL6",143,0)
 ;
"RTN","ACKQUTL6",144,0)
ADATE(D0,Y) ;  Checks that the entered Active date falls before the
"RTN","ACKQUTL6",145,0)
 ;          Inactive date (if one has been entered).
"RTN","ACKQUTL6",146,0)
 N ACKINA
"RTN","ACKQUTL6",147,0)
 S ACKINA=$$GET1^DIQ(509850.3,D0,.04,"I") I ACKINA="" Q 1
"RTN","ACKQUTL6",148,0)
 I Y>ACKINA Q 0
"RTN","ACKQUTL6",149,0)
 Q 1
"RTN","ACKQUTL6",150,0)
 ;
"RTN","ACKQUTL6",151,0)
STAFFREF(X,DA) ;    Cross Reference called from Cross Reference 'Logic'
"RTN","ACKQUTL6",152,0)
 ;            of .01 field of Staff file.
"RTN","ACKQUTL6",153,0)
 N ACKNAME
"RTN","ACKQUTL6",154,0)
 S ACKNAME=$$GET1^DIQ(8930.3,X_",",.01)
"RTN","ACKQUTL6",155,0)
 S ^ACK(509850.3,"D",ACKNAME,DA)=""
"RTN","ACKQUTL6",156,0)
 Q
"RTN","ACKQUTL6",157,0)
 ;
"RTN","ACKQUTL6",158,0)
REINDEX() ;   Re-Indexes 'D' Cross Reference of Staff file
"RTN","ACKQUTL6",159,0)
 ;   First checks that all ^USR(8930.3 entries that 509850.3 points to
"RTN","ACKQUTL6",160,0)
 ;   still exist
"RTN","ACKQUTL6",161,0)
 N ACK01,ACK,ACKARR,ACKCNT
"RTN","ACKQUTL6",162,0)
 K ACKARR
"RTN","ACKQUTL6",163,0)
 S ACK=0,ACKCNT=0
"RTN","ACKQUTL6",164,0)
 F  S ACK=$O(^ACK(509850.3,ACK)) Q:'ACK  D
"RTN","ACKQUTL6",165,0)
 . S ACK01=$P(^ACK(509850.3,ACK,0),"^",1)
"RTN","ACKQUTL6",166,0)
 . I '$D(^USR(8930.3,ACK01,0)) D SETARR(ACK)
"RTN","ACKQUTL6",167,0)
 ;
"RTN","ACKQUTL6",168,0)
 I $D(ACKARR) D  Q 0
"RTN","ACKQUTL6",169,0)
 . W !!,"Warning - The following user(s) have been deleted from the USR Class Membership"
"RTN","ACKQUTL6",170,0)
 . W !,"file (#8930.3)."
"RTN","ACKQUTL6",171,0)
 . W !,"Quasar's A&SP Staff file (#509850.3) points to this file."
"RTN","ACKQUTL6",172,0)
 . W !,"The Quasar staff member(s) need to be re-entered into the USR Class Membership"
"RTN","ACKQUTL6",173,0)
 . W !,"file (8930.3) and the associated Quasar staff record amended to point to this"
"RTN","ACKQUTL6",174,0)
 . W !,"new entry.",!!
"RTN","ACKQUTL6",175,0)
 . N ACK1
"RTN","ACKQUTL6",176,0)
 . S ACK1=""
"RTN","ACKQUTL6",177,0)
 . F  S ACK1=$O(ACKARR(ACK1)) Q:ACK1=""  D
"RTN","ACKQUTL6",178,0)
 . . W "     "_ACKARR(ACK1),!
"RTN","ACKQUTL6",179,0)
 . W !!
"RTN","ACKQUTL6",180,0)
 . W "Please inform IRM/National VistA Support of this problem.  This error"
"RTN","ACKQUTL6",181,0)
 . W !,"can be re-created by running this option again."
"RTN","ACKQUTL6",182,0)
 . W !!
"RTN","ACKQUTL6",183,0)
 ;
"RTN","ACKQUTL6",184,0)
 N DA,D0,X,Y
"RTN","ACKQUTL6",185,0)
 K ^ACK(509850.3,"D")
"RTN","ACKQUTL6",186,0)
 S DIK="^ACK(509850.3,"
"RTN","ACKQUTL6",187,0)
 S DIK(1)=".01^D"
"RTN","ACKQUTL6",188,0)
 D ENALL^DIK
"RTN","ACKQUTL6",189,0)
 Q 1
"RTN","ACKQUTL6",190,0)
 ;
"RTN","ACKQUTL6",191,0)
SETARR(ACK) ;
"RTN","ACKQUTL6",192,0)
 N ACKNAME
"RTN","ACKQUTL6",193,0)
 S ACKNAME=""
"RTN","ACKQUTL6",194,0)
 F  S ACKNAME=$O(^ACK(509850.3,"D",ACKNAME)) Q:ACKNAME=""  D
"RTN","ACKQUTL6",195,0)
 . I $D(^ACK(509850.3,"D",ACKNAME,ACK)) S ACKCNT=ACKCNT+1 S ACKARR(ACKCNT)=ACKNAME
"RTN","ACKQUTL6",196,0)
 Q
"RTN","ACKQUTL6",197,0)
 ;
"RTN","ACKQUTL6",198,0)
LONG(ACKPC,ACKQPR) ;  Displays Long Description of Procedure Code
"RTN","ACKQUTL6",199,0)
 ;
"RTN","ACKQUTL6",200,0)
 Q
"RTN","ACKQUTL6",201,0)
 N ACKQ,ACKRES,ACKNEW,ACKSTR,ACK1,ACKQARR,ACKLEN,ACKCNT S ACKSTR="",ACKCNT=0
"RTN","ACKQUTL6",202,0)
 S ACK1=0
"RTN","ACKQUTL6",203,0)
 F  S ACK1=$O(^ICPT(ACKPC,"D",ACK1)) Q:'ACK1  D
"RTN","ACKQUTL6",204,0)
 . S ACKNEW=^ICPT(ACKPC,"D",ACK1,0)
"RTN","ACKQUTL6",205,0)
 . S ACKNEW=$$STRIP(ACKNEW)
"RTN","ACKQUTL6",206,0)
 . I $G(ACKSTR)'="" S ACKNEW=ACKSTR_" "_ACKNEW
"RTN","ACKQUTL6",207,0)
 . S ACKLEN=$L(ACKNEW)
"RTN","ACKQUTL6",208,0)
 . I ACKLEN>54 D
"RTN","ACKQUTL6",209,0)
 . . I ACKLEN=55 S ACKCNT=ACKCNT+1,ACKQARR(ACKCNT)=ACKNEW S ACKSTR="" Q
"RTN","ACKQUTL6",210,0)
 . . S ACKRES=$$FORMAT(ACKNEW) S ACKNEW=$P(ACKRES,"^",1),ACKSTR=$P(ACKRES,"^",2),ACKCNT=ACKCNT+1,ACKQARR(ACKCNT)=ACKNEW
"RTN","ACKQUTL6",211,0)
 . I ACKLEN<55 S ACKSTR=ACKNEW
"RTN","ACKQUTL6",212,0)
 I $G(ACKSTR)'="" D
"RTN","ACKQUTL6",213,0)
 . S ACKQ=1
"RTN","ACKQUTL6",214,0)
 . F  Q:'ACKQ  D
"RTN","ACKQUTL6",215,0)
 . . S ACKNEW=ACKSTR S ACKRES=$$FORMAT(ACKNEW)
"RTN","ACKQUTL6",216,0)
 . . S ACKNEW=$P(ACKRES,"^",1),ACKSTR=$P(ACKRES,"^",2)
"RTN","ACKQUTL6",217,0)
 . . S ACKCNT=ACKCNT+1,ACKQARR(ACKCNT)=ACKNEW
"RTN","ACKQUTL6",218,0)
 . . I $G(ACKSTR)="" S ACKQ=0
"RTN","ACKQUTL6",219,0)
 ;
"RTN","ACKQUTL6",220,0)
 ;  Display Array
"RTN","ACKQUTL6",221,0)
 ;
"RTN","ACKQUTL6",222,0)
 I '$D(ACKQARR) Q
"RTN","ACKQUTL6",223,0)
 N ACKK1,ACKQUIT
"RTN","ACKQUTL6",224,0)
 S ACKK1="",ACKQUIT=0
"RTN","ACKQUTL6",225,0)
 W !!," Long Description: "
"RTN","ACKQUTL6",226,0)
 F  S ACKK1=$O(ACKQARR(ACKK1)) Q:'ACKK1!(ACKQUIT)  D
"RTN","ACKQUTL6",227,0)
 . I ACKK1'=1 W !,"                   "
"RTN","ACKQUTL6",228,0)
 . W ACKQARR(ACKK1) I ACKQPR=1,ACKK1=3 W "..." S ACKQUIT=1
"RTN","ACKQUTL6",229,0)
 W !
"RTN","ACKQUTL6",230,0)
 ;
"RTN","ACKQUTL6",231,0)
 Q
"RTN","ACKQUTL6",232,0)
 ;
"RTN","ACKQUTL6",233,0)
FORMAT(ACKNEW) ;
"RTN","ACKQUTL6",234,0)
 ;
"RTN","ACKQUTL6",235,0)
 N ACKRES,ACKCCT,ACKEND,ACKN
"RTN","ACKQUTL6",236,0)
 I $L(ACKNEW)<56 S ACKRES=ACKNEW_"^"_"" Q ACKRES
"RTN","ACKQUTL6",237,0)
 S ACKCCT=0,ACKEND=0
"RTN","ACKQUTL6",238,0)
 F  Q:ACKEND  D
"RTN","ACKQUTL6",239,0)
 . S ACKCCT=ACKCCT+1
"RTN","ACKQUTL6",240,0)
 . I $L($P(ACKNEW," ",1,ACKCCT))<56 S ACKN=ACKCCT
"RTN","ACKQUTL6",241,0)
 . I $L($P(ACKNEW," ",1,ACKCCT))'<56 S ACKEND=1
"RTN","ACKQUTL6",242,0)
 S ACKRES=$P(ACKNEW," ",1,ACKN)_"^"_$P(ACKNEW," ",ACKN+1,999)
"RTN","ACKQUTL6",243,0)
 Q ACKRES
"RTN","ACKQUTL6",244,0)
 ;
"RTN","ACKQUTL6",245,0)
STRIP(ACKNEW) ;
"RTN","ACKQUTL6",246,0)
 N ACKARRAY,ACKCT,ACKLEN,ACKX,ACKY,ACKI
"RTN","ACKQUTL6",247,0)
 S ACKY="",ACKCT=0
"RTN","ACKQUTL6",248,0)
 S ACKLEN=$L(ACKNEW)
"RTN","ACKQUTL6",249,0)
 F ACKI=1:1:ACKLEN D
"RTN","ACKQUTL6",250,0)
 . S ACKX=$E(ACKNEW,ACKI,ACKI)
"RTN","ACKQUTL6",251,0)
 . I ACKX'=" " S ACKY=ACKY_ACKX
"RTN","ACKQUTL6",252,0)
 . I ACKX=" ",ACKY'="" S ACKCT=ACKCT+1 S ACKARRAY(ACKCT)=ACKY S ACKY=""
"RTN","ACKQUTL6",253,0)
 . I ACKI=ACKLEN,ACKY'="" S ACKCT=ACKCT+1 S ACKARRAY(ACKCT)=ACKY S ACKY=""
"RTN","ACKQUTL6",254,0)
 ;
"RTN","ACKQUTL6",255,0)
 N ACKLOOP,ACKSTRG
"RTN","ACKQUTL6",256,0)
 S ACKLOOP=0,ACKSTRG=""
"RTN","ACKQUTL6",257,0)
 F  S ACKLOOP=$O(ACKARRAY(ACKLOOP)) Q:ACKLOOP=""  D
"RTN","ACKQUTL6",258,0)
 . S ACKSTRG=ACKSTRG_ACKARRAY(ACKLOOP)_" "
"RTN","ACKQUTL6",259,0)
 ;
"RTN","ACKQUTL6",260,0)
 S ACKLEN=$L(ACKSTRG)
"RTN","ACKQUTL6",261,0)
 I $E(ACKSTRG,ACKLEN,ACKLEN)=" " S ACKSTRG=$E(ACKSTRG,1,ACKLEN-1)
"RTN","ACKQUTL6",262,0)
 ;
"RTN","ACKQUTL6",263,0)
 Q ACKSTRG
"RTN","ACKQUTL6",264,0)
PLIST(ACKPAT,ACKDC) ; Determines if an entry exists in the Problem file
"RTN","ACKQUTL6",265,0)
 ; returns Status as first piece, Problem List IEN as second piece
"RTN","ACKQUTL6",266,0)
 ; (Status^IEN)
"RTN","ACKQUTL6",267,0)
 ; Status values -  1=Inactive, 2=Active
"RTN","ACKQUTL6",268,0)
 N ACKIFN,ACKPLQT
"RTN","ACKQUTL6",269,0)
 S (ACKIFN,ACKPLQT)=0
"RTN","ACKQUTL6",270,0)
 I $D(^AUPNPROB("AC",ACKPAT)) D
"RTN","ACKQUTL6",271,0)
 . F  S ACKIFN=$O(^AUPNPROB("AC",ACKPAT,ACKIFN)) Q:(ACKIFN="")  D  Q:ACKPLQT
"RTN","ACKQUTL6",272,0)
 . .I $D(^AUPNPROB("B",ACKDC,ACKIFN)) S ACKPLQT=ACKIFN
"RTN","ACKQUTL6",273,0)
 I ACKPLQT Q $S($P($G(^AUPNPROB(ACKPLQT,0)),U,12)="A":2,1:1)_U_ACKPLQT
"RTN","ACKQUTL6",274,0)
 Q 0
"RTN","ACKQUTL6",275,0)
 ;
"VER")
8.0^22.0
**END**
**END**
