Released SD*5.3*285 SEQ #383
Extracted from mail message
**KIDS**:SD*5.3*285^

**INSTALL NAME**
SD*5.3*285
"BLD",5866,0)
SD*5.3*285^SCHEDULING^0^3050512^y
"BLD",5866,1,0)
^^11^11^3041027^^
"BLD",5866,1,1,0)
API to return encounter or appointment date/time for a patient that
"BLD",5866,1,2,0)
can receive inpatient medication from an authorized clinic.
"BLD",5866,1,3,0)
 
"BLD",5866,1,4,0)
Additional field "Administer Inpatient Meds?" added to Hospital Location 
"BLD",5866,1,5,0)
file (44).
"BLD",5866,1,6,0)
 
"BLD",5866,1,7,0)
Prompt added for "Administer Inpatient Meds?" field during option SET UP 
"BLD",5866,1,8,0)
A CLINIC.
"BLD",5866,1,9,0)
 
"BLD",5866,1,10,0)
Stand-alone option SD IMO EDIT added to prompt for "Administer Inpatient
"BLD",5866,1,11,0)
Meds?" for a clinic.
"BLD",5866,4,0)
^9.64PA^44^1
"BLD",5866,4,44,0)
44
"BLD",5866,4,44,2,0)
^9.641^44^1
"BLD",5866,4,44,2,44,0)
HOSPITAL LOCATION  (File-top level)
"BLD",5866,4,44,2,44,1,0)
^9.6411^2802^1
"BLD",5866,4,44,2,44,1,2802,0)
ADMINISTER INPATIENT MEDS?
"BLD",5866,4,44,222)
y^y^p^^^^n^^n
"BLD",5866,4,44,224)

"BLD",5866,4,"APDD",44,44)

"BLD",5866,4,"APDD",44,44,2802)

"BLD",5866,4,"B",44,44)

"BLD",5866,"KRN",0)
^9.67PA^8989.52^19
"BLD",5866,"KRN",.4,0)
.4
"BLD",5866,"KRN",.401,0)
.401
"BLD",5866,"KRN",.402,0)
.402
"BLD",5866,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",5866,"KRN",.402,"NM",1,0)
SDB    FILE #44^44^0
"BLD",5866,"KRN",.402,"NM",2,0)
SD IMO    FILE #44^44^0
"BLD",5866,"KRN",.402,"NM","B","SD IMO    FILE #44",2)

"BLD",5866,"KRN",.402,"NM","B","SDB    FILE #44",1)

"BLD",5866,"KRN",.403,0)
.403
"BLD",5866,"KRN",.5,0)
.5
"BLD",5866,"KRN",.84,0)
.84
"BLD",5866,"KRN",3.6,0)
3.6
"BLD",5866,"KRN",3.8,0)
3.8
"BLD",5866,"KRN",9.2,0)
9.2
"BLD",5866,"KRN",9.8,0)
9.8
"BLD",5866,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5866,"KRN",9.8,"NM",1,0)
SDAMA203^^0^B33220874
"BLD",5866,"KRN",9.8,"NM","B","SDAMA203",1)

"BLD",5866,"KRN",19,0)
19
"BLD",5866,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5866,"KRN",19,"NM",1,0)
SD IMO EDIT^^0
"BLD",5866,"KRN",19,"NM","B","SD IMO EDIT",1)

"BLD",5866,"KRN",19.1,0)
19.1
"BLD",5866,"KRN",101,0)
101
"BLD",5866,"KRN",409.61,0)
409.61
"BLD",5866,"KRN",771,0)
771
"BLD",5866,"KRN",870,0)
870
"BLD",5866,"KRN",8989.51,0)
8989.51
"BLD",5866,"KRN",8989.52,0)
8989.52
"BLD",5866,"KRN",8994,0)
8994
"BLD",5866,"KRN","B",.4,.4)

"BLD",5866,"KRN","B",.401,.401)

"BLD",5866,"KRN","B",.402,.402)

"BLD",5866,"KRN","B",.403,.403)

"BLD",5866,"KRN","B",.5,.5)

"BLD",5866,"KRN","B",.84,.84)

"BLD",5866,"KRN","B",3.6,3.6)

"BLD",5866,"KRN","B",3.8,3.8)

"BLD",5866,"KRN","B",9.2,9.2)

"BLD",5866,"KRN","B",9.8,9.8)

"BLD",5866,"KRN","B",19,19)

"BLD",5866,"KRN","B",19.1,19.1)

"BLD",5866,"KRN","B",101,101)

"BLD",5866,"KRN","B",409.61,409.61)

"BLD",5866,"KRN","B",771,771)

"BLD",5866,"KRN","B",870,870)

"BLD",5866,"KRN","B",8989.51,8989.51)

"BLD",5866,"KRN","B",8989.52,8989.52)

"BLD",5866,"KRN","B",8994,8994)

"BLD",5866,"QUES",0)
^9.62^^
"BLD",5866,"REQB",0)
^9.611^3^2
"BLD",5866,"REQB",2,0)
SD*5.3*131^1
"BLD",5866,"REQB",3,0)
SD*5.3*283^1
"BLD",5866,"REQB","B","SD*5.3*131",2)

"BLD",5866,"REQB","B","SD*5.3*283",3)

"FIA",44)
HOSPITAL LOCATION
"FIA",44,0)
^SC(
"FIA",44,0,0)
44I
"FIA",44,0,1)
y^y^p^^^^n^^n
"FIA",44,0,10)

"FIA",44,0,11)

"FIA",44,0,"RLRO")

"FIA",44,0,"VR")
5.3^SD
"FIA",44,44)
1
"FIA",44,44,2802)

"KRN",.402,114,-1)
0^1
"KRN",.402,114,0)
SDB^3030424.1353^^44^^^3040503
"KRN",.402,114,"%D",0)
^^1^1^2970819^
"KRN",.402,114,"%D",1,0)
 
"KRN",.402,114,"AR",44,500)
1^SDBT9
"KRN",.402,114,"DIAB",1,1,44.03,0)
ALL
"KRN",.402,114,"DIAB",1,1,44.04,0)
ALL
"KRN",.402,114,"DR",1,44)
.01;1;2504//Y;9;2502;S:X'["Y" Y="@05";2502.5;@05;S:$S('$D(^DG(43,1,"GL")):1,$D(^DG(43,1,"GL"))&('$P(^DG(43,1,"GL"),"^",2)):1,1:0) Y="@10";3.5//^S X=+$O(^DG(40.8,0)),X=$S($D(^(X,0)):$P(^(0),"^"),1:"");@10;8;2507//REGULAR;2802;99;
"KRN",.402,114,"DR",1,44,1)
2000;2000.5//YES;2508;2509;2510;2511;24;2600;2801;2700;30;2001;2002;S:+$O(^SC(DA,"ST",0))>0 Y="@25";1914;Q;@25;2003;2005;1918.5;2503;2500;S:X'="Y" Y="@30";2501;Q;@30;10;1916;1918;1910;1912;Q;I '$D(SDLA) S SDLA=X;1913;
"KRN",.402,114,"DR",1,44,2)
S:+$O(^SC(DA,"ST",0))>0 Y="@99";1917//4;@99;
"KRN",.402,114,"DR",2,44.03)
.01
"KRN",.402,114,"DR",2,44.04)
.01
"KRN",.402,114,"DR",2,44.1)
.01;.02;
"KRN",.402,114,"DR",2,44.11)
.01;.02;
"KRN",.402,114,"ROU")
^SDBT
"KRN",.402,114,"ROUOLD")
SDBT
"KRN",.402,2405,-1)
0^2
"KRN",.402,2405,0)
SD IMO^3030418.1341^@^44^^@^3030428
"KRN",.402,2405,"DR",1,44)
2802;
"KRN",19,2910275,-1)
0^1
"KRN",19,2910275,0)
SD IMO EDIT^Inpatient Medications to Clinic^^E^^^^^^^^SCHEDULING
"KRN",19,2910275,1,0)
^19.06^1^1^3030430^^^^
"KRN",19,2910275,1,1,0)
Respond YES only if clinic is authorized to dispense inpatient medications.
"KRN",19,2910275,30)
SC(
"KRN",19,2910275,31)
AEMQ
"KRN",19,2910275,50)
SC(
"KRN",19,2910275,51)
[SD IMO]
"KRN",19,2910275,99.1)
59281,51012
"KRN",19,2910275,"U")
INPATIENT MEDICATIONS TO CLINI
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930925
"PKG",16,22,1,"PAH",1,0)
285^3050512^22950
"PKG",16,22,1,"PAH",1,1,0)
^^11^11^3050512
"PKG",16,22,1,"PAH",1,1,1,0)
API to return encounter or appointment date/time for a patient that
"PKG",16,22,1,"PAH",1,1,2,0)
can receive inpatient medication from an authorized clinic.
"PKG",16,22,1,"PAH",1,1,3,0)
 
"PKG",16,22,1,"PAH",1,1,4,0)
Additional field "Administer Inpatient Meds?" added to Hospital Location 
"PKG",16,22,1,"PAH",1,1,5,0)
file (44).
"PKG",16,22,1,"PAH",1,1,6,0)
 
"PKG",16,22,1,"PAH",1,1,7,0)
Prompt added for "Administer Inpatient Meds?" field during option SET UP 
"PKG",16,22,1,"PAH",1,1,8,0)
A CLINIC.
"PKG",16,22,1,"PAH",1,1,9,0)
 
"PKG",16,22,1,"PAH",1,1,10,0)
Stand-alone option SD IMO EDIT added to prompt for "Administer Inpatient
"PKG",16,22,1,"PAH",1,1,11,0)
Meds?" for a clinic.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDAMA203")
0^1^B33220874
"RTN","SDAMA203",1,0)
SDAMA203 ;BPIOFO/ACS-Scheduling API for IMO ;15 April 2003
"RTN","SDAMA203",2,0)
 ;;5.3;Scheduling;**285**;13 Aug 1993
"RTN","SDAMA203",3,0)
 ;
"RTN","SDAMA203",4,0)
 ;Scheduling API to return encounter or appointment date/time for
"RTN","SDAMA203",5,0)
 ;a patient that can receive inpatient medication from an
"RTN","SDAMA203",6,0)
 ;authorized clinic
"RTN","SDAMA203",7,0)
 ;
"RTN","SDAMA203",8,0)
 ;**********************************************************************
"RTN","SDAMA203",9,0)
 ;                        CHANGE LOG
"RTN","SDAMA203",10,0)
 ;
"RTN","SDAMA203",11,0)
 ;  DATE      PATCH       DESCRIPTION                 DEVELOPER
"RTN","SDAMA203",12,0)
 ;--------  ----------    ----------------------------------------------
"RTN","SDAMA203",13,0)
 ;04/15/03  SD*5.3*285    ROUTINE WRITTEN             A SAUNDERS
"RTN","SDAMA203",14,0)
 ;
"RTN","SDAMA203",15,0)
 ;**********************************************************************
"RTN","SDAMA203",16,0)
 ;
"RTN","SDAMA203",17,0)
 ;          **** TO BE CALLED WITH AN EXTRINISIC CALL ****
"RTN","SDAMA203",18,0)
 ;Example:  I $$SDIMO^SDAMA203(CLIEN,DFN) S APPTDT=SDIMO(1) K SDIMO(1)
"RTN","SDAMA203",19,0)
 ;
"RTN","SDAMA203",20,0)
 ;INPUT
"RTN","SDAMA203",21,0)
 ;  SDCLIEN      Clinic IEN (required)
"RTN","SDAMA203",22,0)
 ;  SDPATDFN     Patient DFN (required)
"RTN","SDAMA203",23,0)
 ;  
"RTN","SDAMA203",24,0)
 ;OUTPUT
"RTN","SDAMA203",25,0)
 ;  The extrinsic call will return one of the following values:
"RTN","SDAMA203",26,0)
 ;     1   Patient has at least one scheduled appointment or checked-in
"RTN","SDAMA203",27,0)
 ;         visit in an authorized clinic
"RTN","SDAMA203",28,0)
 ;     0   Patient has no scheduled appointments or checked-in visits
"RTN","SDAMA203",29,0)
 ;         in an authorized clinic
"RTN","SDAMA203",30,0)
 ;    -1   Clinic is not an authorized clinic, clinic is inactive,
"RTN","SDAMA203",31,0)
 ;         or SDCLIEN is null
"RTN","SDAMA203",32,0)
 ;    -2   SDPATDFN is null
"RTN","SDAMA203",33,0)
 ;    -3   Scheduling database is unavailable
"RTN","SDAMA203",34,0)
 ;  
"RTN","SDAMA203",35,0)
 ;  If a 1 is returned, then SDIMO(1) = Encounter or appointment 
"RTN","SDAMA203",36,0)
 ;  date/time in FileMan format
"RTN","SDAMA203",37,0)
 ;   
"RTN","SDAMA203",38,0)
 ;**********************************************************************
"RTN","SDAMA203",39,0)
 ;   Special Logic:
"RTN","SDAMA203",40,0)
 ; - In line tag SDVISIT, the ACRP Toolkit API EXOE^SDOE is called 
"RTN","SDAMA203",41,0)
 ;   multiple times as needed.  This API returns the NEXT encounter, 
"RTN","SDAMA203",42,0)
 ;   given a start and end date/time.  We want to check ALL encounters
"RTN","SDAMA203",43,0)
 ;   for a match on clinic IEN
"RTN","SDAMA203",44,0)
 ; - In line tag SDDATE, if the current time is between midnight and 6am,
"RTN","SDAMA203",45,0)
 ;   the API will start to look for encounters and/or appointments on the 
"RTN","SDAMA203",46,0)
 ;   previous day
"RTN","SDAMA203",47,0)
 ;
"RTN","SDAMA203",48,0)
 ;  Internal variables:
"RTN","SDAMA203",49,0)
 ;  SDBACK   Contains the value to be returned from this call.  See 
"RTN","SDAMA203",50,0)
 ;           above for OUTPUT values and corresponding definitions
"RTN","SDAMA203",51,0)
 ;  SDCONT   Flag to indicate if processing should continue.  If
"RTN","SDAMA203",52,0)
 ;           the patient has an encounter in an authorized clinic
"RTN","SDAMA203",53,0)
 ;           today, then we can skip the last step and not look for
"RTN","SDAMA203",54,0)
 ;           a scheduled appointment
"RTN","SDAMA203",55,0)
 ;  SDFROM   The date to start searching for an encounter or appointment
"RTN","SDAMA203",56,0)
 ;  SDAPPTDT Encounter or appointment date/time returned in SDIMO(1)
"RTN","SDAMA203",57,0)
 ;
"RTN","SDAMA203",58,0)
 ;**********************************************************************
"RTN","SDAMA203",59,0)
SDIMO(SDCLIEN,SDPATDFN) ;
"RTN","SDAMA203",60,0)
 ;
"RTN","SDAMA203",61,0)
 ;--INITIALIZATION--
"RTN","SDAMA203",62,0)
 K SDIMO(1)
"RTN","SDAMA203",63,0)
 N SDBACK,SDCONT,SDFROM,SDAPPTDT
"RTN","SDAMA203",64,0)
 S SDBACK=1,SDCONT=1,SDAPPTDT=0,SDFROM=0
"RTN","SDAMA203",65,0)
 ;
"RTN","SDAMA203",66,0)
 ;--MAIN--
"RTN","SDAMA203",67,0)
 ; Valid variables passed in?
"RTN","SDAMA203",68,0)
 D SDVALVAR($G(SDPATDFN),$G(SDCLIEN),.SDBACK)
"RTN","SDAMA203",69,0)
 ; If no error, is clinic active and authorized?
"RTN","SDAMA203",70,0)
 I SDBACK=1 D SDAUTHCL(SDCLIEN,.SDBACK)
"RTN","SDAMA203",71,0)
 ; If no error, set up search "start" date
"RTN","SDAMA203",72,0)
 I SDBACK=1 D SDDATE(.SDFROM)
"RTN","SDAMA203",73,0)
 ; If no error, does patient have an encounter in that clinic?
"RTN","SDAMA203",74,0)
 I SDBACK=1 D SDVISIT(SDPATDFN,SDCLIEN,.SDAPPTDT,.SDCONT,.SDBACK,SDFROM)
"RTN","SDAMA203",75,0)
 ; If no error and no encounter, does patient have an appointment in that
"RTN","SDAMA203",76,0)
 ; clinic?
"RTN","SDAMA203",77,0)
 I SDBACK=1,SDCONT=1 D SDAPPT(SDPATDFN,SDCLIEN,.SDAPPTDT,.SDBACK,SDFROM)
"RTN","SDAMA203",78,0)
 ;
"RTN","SDAMA203",79,0)
 ;--FINALIZATION--
"RTN","SDAMA203",80,0)
 ; If no error
"RTN","SDAMA203",81,0)
 I SDBACK=1 D
"RTN","SDAMA203",82,0)
 . ; Set up output array with the encounter or appointment date/time
"RTN","SDAMA203",83,0)
 . ; Make sure the appointment date/time exists in SDAPPTDT
"RTN","SDAMA203",84,0)
 . I $G(SDAPPTDT)]"" D
"RTN","SDAMA203",85,0)
 .. S SDIMO(1)=SDAPPTDT
"RTN","SDAMA203",86,0)
 . I $G(SDAPPTDT)']"" D
"RTN","SDAMA203",87,0)
 .. S SDBACK=0
"RTN","SDAMA203",88,0)
 ; Return value
"RTN","SDAMA203",89,0)
 Q SDBACK
"RTN","SDAMA203",90,0)
 ;
"RTN","SDAMA203",91,0)
 ;----------------------------------------------------------------------
"RTN","SDAMA203",92,0)
 ;-Validate input variables
"RTN","SDAMA203",93,0)
SDVALVAR(SDPATDFN,SDCLIEN,SDBACK) ;
"RTN","SDAMA203",94,0)
 ; Clinic IEN and patient DFN cannot be null
"RTN","SDAMA203",95,0)
 I $G(SDCLIEN)="" S SDBACK=-1 Q
"RTN","SDAMA203",96,0)
 I $G(SDPATDFN)="" S SDBACK=-2 Q
"RTN","SDAMA203",97,0)
 Q
"RTN","SDAMA203",98,0)
 ;
"RTN","SDAMA203",99,0)
 ;-Clinic must be type "C", authorized to administer inpatient meds,
"RTN","SDAMA203",100,0)
 ;-and active
"RTN","SDAMA203",101,0)
SDAUTHCL(SDCLIEN,SDBACK) ;
"RTN","SDAMA203",102,0)
 N SDAUTH,SDTYPE
"RTN","SDAMA203",103,0)
 S SDAUTH=0,SDTYPE=0
"RTN","SDAMA203",104,0)
 ; clinic must be type "C"
"RTN","SDAMA203",105,0)
 S SDTYPE=$P($G(^SC(SDCLIEN,0)),"^",3)
"RTN","SDAMA203",106,0)
 I $G(SDTYPE)="C" D
"RTN","SDAMA203",107,0)
 . ; clinic must be authorized to administer inpatient meds
"RTN","SDAMA203",108,0)
 . I $D(^SC("AE",1,SDCLIEN)) S SDAUTH=1
"RTN","SDAMA203",109,0)
 I SDAUTH'=1 S SDBACK=-1 Q
"RTN","SDAMA203",110,0)
 ; clinic must be active
"RTN","SDAMA203",111,0)
 ; if clinic inactivate date exists, check further
"RTN","SDAMA203",112,0)
 N SDINACT,SDREACT
"RTN","SDAMA203",113,0)
 S SDINACT=$P($G(^SC(SDCLIEN,"I")),"^",1)
"RTN","SDAMA203",114,0)
 I $G(SDINACT)]"" D
"RTN","SDAMA203",115,0)
 . ; if inactivate date is today or earlier, get reactivate date
"RTN","SDAMA203",116,0)
 . I SDINACT'>DT D
"RTN","SDAMA203",117,0)
 .. S SDREACT=$P($G(^SC(SDCLIEN,"I")),"^",2)
"RTN","SDAMA203",118,0)
 .. ; reactivate date can't be null
"RTN","SDAMA203",119,0)
 .. I $G(SDREACT)="" S SDBACK=-1
"RTN","SDAMA203",120,0)
 .. ; if reactivate date exists
"RTN","SDAMA203",121,0)
 .. E  D
"RTN","SDAMA203",122,0)
 ... ; reactivate date must be less than or equal to today
"RTN","SDAMA203",123,0)
 ... ; but greater than or equal to inactivate date
"RTN","SDAMA203",124,0)
 ... I (SDREACT>DT!(SDREACT<SDINACT)) S SDBACK=-1
"RTN","SDAMA203",125,0)
 Q
"RTN","SDAMA203",126,0)
 ;-Set up start date for encounters and appointments
"RTN","SDAMA203",127,0)
SDDATE(SDFROM) ;
"RTN","SDAMA203",128,0)
 N %,X
"RTN","SDAMA203",129,0)
 D NOW^%DTC
"RTN","SDAMA203",130,0)
 ;if the current time is before 6am, set 'start' date to yesterday
"RTN","SDAMA203",131,0)
 I ("."_$P(%,".",2))<.060000 S SDFROM=(X-1)
"RTN","SDAMA203",132,0)
 E  S SDFROM=X
"RTN","SDAMA203",133,0)
 Q
"RTN","SDAMA203",134,0)
 ;-Look for encounter that occurred in the authorized clinic
"RTN","SDAMA203",135,0)
SDVISIT(SDPATDFN,SDCLIEN,SDAPPTDT,SDCONT,SDBACK,SDFROM) ;
"RTN","SDAMA203",136,0)
 N SDSTART,SDEND,SDENCNUM,SDENCDT,SDENCCL
"RTN","SDAMA203",137,0)
 ; set up start and end date/time
"RTN","SDAMA203",138,0)
 S SDSTART=SDFROM_".0000"
"RTN","SDAMA203",139,0)
 S SDEND=DT_".2359"
"RTN","SDAMA203",140,0)
 ; get encounters
"RTN","SDAMA203",141,0)
 F  D  Q:+SDENCNUM=0
"RTN","SDAMA203",142,0)
 . ; call API to get next encounter
"RTN","SDAMA203",143,0)
 . S SDENCNUM=+$$EXOE^SDOE(SDPATDFN,SDSTART,SDEND)
"RTN","SDAMA203",144,0)
 . I $G(SDENCNUM) D
"RTN","SDAMA203",145,0)
 .. ; encounter found.  call API to get more encounter data
"RTN","SDAMA203",146,0)
 .. D GETGEN^SDOE(SDENCNUM,"SDDATA")
"RTN","SDAMA203",147,0)
 .. I $G(SDDATA(0)) D
"RTN","SDAMA203",148,0)
 ... ; get encounter date/time and clinic IEN
"RTN","SDAMA203",149,0)
 ... S SDENCDT=$P($G(SDDATA(0)),"^",1),SDENCCL=$P($G(SDDATA(0)),"^",4)
"RTN","SDAMA203",150,0)
 ... ; if encounter clinic matches authorized clinic, set flags
"RTN","SDAMA203",151,0)
 ... I $G(SDENCCL)=SDCLIEN S SDENCNUM=0,SDCONT=0,SDAPPTDT=$G(SDENCDT)
"RTN","SDAMA203",152,0)
 ... ; if no match on clinic, reset start date for next encounter
"RTN","SDAMA203",153,0)
 ... I $G(SDENCCL)'=SDCLIEN S SDSTART=(SDENCDT+.000001)
"RTN","SDAMA203",154,0)
 ... K SDDATA
"RTN","SDAMA203",155,0)
 Q
"RTN","SDAMA203",156,0)
 ;-Look for scheduled appointment in the authorized clinic
"RTN","SDAMA203",157,0)
SDAPPT(SDPATDFN,SDCLIEN,SDAPPTDT,SDBACK,SDFROM) ;
"RTN","SDAMA203",158,0)
 N SDRESULT,SDAPPTCL,SDMATCH
"RTN","SDAMA203",159,0)
 S SDMATCH=0
"RTN","SDAMA203",160,0)
 ; call API to get appointments for this patient
"RTN","SDAMA203",161,0)
 D GETAPPT^SDAMA201(SDPATDFN,"1;2","R;NT",SDFROM,,.SDRESULT)
"RTN","SDAMA203",162,0)
 ; SDRESULT contains a count of the returned appointments
"RTN","SDAMA203",163,0)
 I SDRESULT>0 D
"RTN","SDAMA203",164,0)
 . N SDI
"RTN","SDAMA203",165,0)
 . ; spin through returned appointments and look for match on clinic IEN
"RTN","SDAMA203",166,0)
 . F SDI=1:1:SDRESULT D  Q:SDMATCH=1
"RTN","SDAMA203",167,0)
 .. S SDAPPTCL=$G(^TMP($J,"SDAMA201","GETAPPT",SDI,2))
"RTN","SDAMA203",168,0)
 .. I +$G(SDAPPTCL)=SDCLIEN D
"RTN","SDAMA203",169,0)
 ... S SDAPPTDT=$G(^TMP($J,"SDAMA201","GETAPPT",SDI,1))
"RTN","SDAMA203",170,0)
 ... S SDMATCH=1
"RTN","SDAMA203",171,0)
 . ; delete appointment array returned from Scheduling API
"RTN","SDAMA203",172,0)
 . K ^TMP($J,"SDAMA201","GETAPPT")
"RTN","SDAMA203",173,0)
 I ((SDRESULT=0)!(SDMATCH=0)) S SDBACK=0
"RTN","SDAMA203",174,0)
 I SDRESULT=-1 D
"RTN","SDAMA203",175,0)
 . S SDBACK=0
"RTN","SDAMA203",176,0)
 . ; if database unavailable, set database-specific flag
"RTN","SDAMA203",177,0)
 . I $G(^TMP($J,"SDAMA201","GETAPPT","ERROR",101)) S SDBACK=-3
"RTN","SDAMA203",178,0)
 . ; delete error array returned from Scheduling API
"RTN","SDAMA203",179,0)
 . K ^TMP($J,"SDAMA201","GETAPPT")
"RTN","SDAMA203",180,0)
 Q
"VER")
8.0^22.0
"^DD",44,44,2802,0)
ADMINISTER INPATIENT MEDS?^S^1:YES;^0;25^Q
"^DD",44,44,2802,1,0)
^.1
"^DD",44,44,2802,1,1,0)
44^AE
"^DD",44,44,2802,1,1,1)
S ^SC("AE",$E(X,1,30),DA)=""
"^DD",44,44,2802,1,1,2)
K ^SC("AE",$E(X,1,30),DA)
"^DD",44,44,2802,1,1,"DT")
3030418
"^DD",44,44,2802,3)
Respond YES only if the clinic is authorized to dispense inpatient medications to outpatients.
"^DD",44,44,2802,21,0)
^.001^2^2^3030429^^^^
"^DD",44,44,2802,21,1,0)
This field should contain a YES only if the clinic location is
"^DD",44,44,2802,21,2,0)
authorized to dispense inpatient medications to outpatients.
"^DD",44,44,2802,"DT")
3030424
"BLD",5866,6)
^383
**END**
**END**
