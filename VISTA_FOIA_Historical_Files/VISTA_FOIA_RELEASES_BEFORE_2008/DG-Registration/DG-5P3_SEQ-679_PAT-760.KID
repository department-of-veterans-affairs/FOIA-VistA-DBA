Released DG*5.3*760 SEQ #679
Extracted from mail message
**KIDS**:DG*5.3*760^

**INSTALL NAME**
DG*5.3*760
"BLD",7305,0)
DG*5.3*760^REGISTRATION^0^3070820^y
"BLD",7305,1,0)
^^5^5^3070802^
"BLD",7305,1,1,0)
This patch corrects the following:
"BLD",7305,1,2,0)
Problem deleting PTF record when procedure has been deleted.
"BLD",7305,1,3,0)
SCI output on Registration view to show full value
"BLD",7305,1,4,0)
Default city choice in Registration to use full City name instead of 
"BLD",7305,1,5,0)
abbreviation.
"BLD",7305,4,0)
^9.64PA^^
"BLD",7305,6)
2^
"BLD",7305,6.3)
11
"BLD",7305,"KRN",0)
^9.67PA^8989.52^19
"BLD",7305,"KRN",.4,0)
.4
"BLD",7305,"KRN",.401,0)
.401
"BLD",7305,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7305,"KRN",.402,0)
.402
"BLD",7305,"KRN",.403,0)
.403
"BLD",7305,"KRN",.5,0)
.5
"BLD",7305,"KRN",.84,0)
.84
"BLD",7305,"KRN",3.6,0)
3.6
"BLD",7305,"KRN",3.8,0)
3.8
"BLD",7305,"KRN",9.2,0)
9.2
"BLD",7305,"KRN",9.8,0)
9.8
"BLD",7305,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",7305,"KRN",9.8,"NM",1,0)
DGPTFDEL^^0^B17066204
"BLD",7305,"KRN",9.8,"NM",3,0)
DGREGAZL^^0^B41604558
"BLD",7305,"KRN",9.8,"NM",4,0)
DGRP2^^0^B11254124
"BLD",7305,"KRN",9.8,"NM","B","DGPTFDEL",1)

"BLD",7305,"KRN",9.8,"NM","B","DGREGAZL",3)

"BLD",7305,"KRN",9.8,"NM","B","DGRP2",4)

"BLD",7305,"KRN",19,0)
19
"BLD",7305,"KRN",19,"NM",0)
^9.68A^^
"BLD",7305,"KRN",19.1,0)
19.1
"BLD",7305,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7305,"KRN",101,0)
101
"BLD",7305,"KRN",409.61,0)
409.61
"BLD",7305,"KRN",771,0)
771
"BLD",7305,"KRN",870,0)
870
"BLD",7305,"KRN",8989.51,0)
8989.51
"BLD",7305,"KRN",8989.52,0)
8989.52
"BLD",7305,"KRN",8994,0)
8994
"BLD",7305,"KRN","B",.4,.4)

"BLD",7305,"KRN","B",.401,.401)

"BLD",7305,"KRN","B",.402,.402)

"BLD",7305,"KRN","B",.403,.403)

"BLD",7305,"KRN","B",.5,.5)

"BLD",7305,"KRN","B",.84,.84)

"BLD",7305,"KRN","B",3.6,3.6)

"BLD",7305,"KRN","B",3.8,3.8)

"BLD",7305,"KRN","B",9.2,9.2)

"BLD",7305,"KRN","B",9.8,9.8)

"BLD",7305,"KRN","B",19,19)

"BLD",7305,"KRN","B",19.1,19.1)

"BLD",7305,"KRN","B",101,101)

"BLD",7305,"KRN","B",409.61,409.61)

"BLD",7305,"KRN","B",771,771)

"BLD",7305,"KRN","B",870,870)

"BLD",7305,"KRN","B",8989.51,8989.51)

"BLD",7305,"KRN","B",8989.52,8989.52)

"BLD",7305,"KRN","B",8994,8994)

"BLD",7305,"QUES",0)
^9.62^^
"BLD",7305,"REQB",0)
^9.611^4^3
"BLD",7305,"REQB",1,0)
DG*5.3*517^1
"BLD",7305,"REQB",3,0)
DG*5.3*677^1
"BLD",7305,"REQB",4,0)
DG*5.3*730^1
"BLD",7305,"REQB","B","DG*5.3*517",1)

"BLD",7305,"REQB","B","DG*5.3*677",3)

"BLD",7305,"REQB","B","DG*5.3*730",4)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
760^3070820^100850
"PKG",5,22,1,"PAH",1,1,0)
^^5^5^3070820
"PKG",5,22,1,"PAH",1,1,1,0)
This patch corrects the following:
"PKG",5,22,1,"PAH",1,1,2,0)
Problem deleting PTF record when procedure has been deleted.
"PKG",5,22,1,"PAH",1,1,3,0)
SCI output on Registration view to show full value
"PKG",5,22,1,"PAH",1,1,4,0)
Default city choice in Registration to use full City name instead of 
"PKG",5,22,1,"PAH",1,1,5,0)
abbreviation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGPTFDEL")
0^1^B17066204^B17558288
"RTN","DGPTFDEL",1,0)
DGPTFDEL ;ALB/JDS - PTF ENTRY DELETION ; 7/31/07 11:19am
"RTN","DGPTFDEL",2,0)
 ;;5.3;Registration;**517,760**;Aug 13, 1993;Build 11
"RTN","DGPTFDEL",3,0)
 ;
"RTN","DGPTFDEL",4,0)
A D LO^DGUTL I $D(^DISV(DUZ,"^DPT(")),$D(^("^DGPT(")) S A=+^("^DGPT("),B=+^("^DPT(") I $D(^DGPT(A,0)),$D(^DPT(B,0)) S:(+^DGPT(A,0)'=B&$D(^DGPT("B",B))) ^DISV(DUZ,"^DGPT(")=""
"RTN","DGPTFDEL",5,0)
 Q
"RTN","DGPTFDEL",6,0)
 ;
"RTN","DGPTFDEL",7,0)
ASK D A W !!
"RTN","DGPTFDEL",8,0)
 S Y=1 D RTY^DGPTUTL
"RTN","DGPTFDEL",9,0)
 S DIC("S")="I $P(^(0),U,11)=1,'$D(^DGP(45.84,+Y))",DIC="^DGPT(",DIC(0)="NEAQ",DIC("A")="Enter PTF record to delete: "
"RTN","DGPTFDEL",10,0)
 D ^DIC G Q:Y'>0 S DA=+Y,DIC(0)="NE",X=DA D CEN G ASK:'$D(DA)
"RTN","DGPTFDEL",11,0)
A1 W !! D ^DIC S %=2 W !,"Ok to delete" D YN^DICN
"RTN","DGPTFDEL",12,0)
 I %=1 S DGPTIFN=DA D KDGPT W !,"****** DELETED ******" D HANG^DGPTUTL G Q
"RTN","DGPTFDEL",13,0)
AD I '% W !,"Anwer Yes or No",!,"On deletion pointers will be updated" G A1
"RTN","DGPTFDEL",14,0)
 ;
"RTN","DGPTFDEL",15,0)
 ;
"RTN","DGPTFDEL",16,0)
Q K DA,DFN,A,B,L,I,ANS,DIE,DR,DIK,DIC,DGRTY,DGRTY0,DGPTIFN Q
"RTN","DGPTFDEL",17,0)
 ;
"RTN","DGPTFDEL",18,0)
HEL ;
"RTN","DGPTFDEL",19,0)
 I '$D(DGRTY) S Y=1 D RTY^DGPTUTL
"RTN","DGPTFDEL",20,0)
 D A W !!
"RTN","DGPTFDEL",21,0)
 S DIC(0)="NEAQ",DIC="^DGP(45.84,",DIC("S")="I '$D(^DGP(45.83,""C"",+Y)),$D(^DGPT(+Y,0)),$P(^(0),U,11)="_DGRTY,DIC("A")="Enter "_$P(DGRTY0,U)_" record to re-open: "
"RTN","DGPTFDEL",22,0)
 D ^DIC G Q:Y'>0 S (X,DGPTIFN)=+Y,%=2
"RTN","DGPTFDEL",23,0)
A2 I '% W !!,DGPTIFN,"  ",$P(^DPT(+^DGPT(DGPTIFN,0),0),U) S DGSENFLG="",X=DGPTIFN,DIC(0)="NE",DIC="^DGP(45.84," D ^DIC K DIC,DGSENFLG
"RTN","DGPTFDEL",24,0)
 I DGRTY=2 D CHK G Q:'DGPTIFN
"RTN","DGPTFDEL",25,0)
 S %=2 W !,"Ok to reactivate" D YN^DICN
"RTN","DGPTFDEL",26,0)
 I '% W !,"Answer Yes or No" G A2
"RTN","DGPTFDEL",27,0)
 G Q:%'=1
"RTN","DGPTFDEL",28,0)
 D OPEN G Q
"RTN","DGPTFDEL",29,0)
 ;
"RTN","DGPTFDEL",30,0)
OLD I '$D(^DISV(DUZ,"PTFAD",DFN)) W "  ???",*7,*7 G AD
"RTN","DGPTFDEL",31,0)
 S X=^(DFN)
"RTN","DGPTFDEL",32,0)
 Q
"RTN","DGPTFDEL",33,0)
DREL ; -- open released rec
"RTN","DGPTFDEL",34,0)
 I '$D(DGRTY) S Y=1 D RTY^DGPTUTL
"RTN","DGPTFDEL",35,0)
 W ! S DIC("A")="Enter Released "_$P(DGRTY0,U)_" Record to Re-open: ",DIC("S")="I $D(^DGP(45.83,""C"",+Y)),$D(^DGPT(+Y,0)),$D(^(70)),+^(70)>2901000,$P(^(0),U,11)="_DGRTY,DIC="^DGP(45.84,",DIC(0)="MEQA"
"RTN","DGPTFDEL",36,0)
 D ^DIC K DIC G Q:+Y'>0 S DGPTIFN=+Y
"RTN","DGPTFDEL",37,0)
 I DGRTY=2 D CHK G Q:'DGPTIFN
"RTN","DGPTFDEL",38,0)
OK W !,"Ok to Re-open" S %=2 D YN^DICN
"RTN","DGPTFDEL",39,0)
 I '% W !!?14,"Enter <RET> to exit routine",!?10,"Enter 'Y' for YES to RE-OPEN Record",! G OK
"RTN","DGPTFDEL",40,0)
 G Q:%'=1
"RTN","DGPTFDEL",41,0)
 S DA(1)=$O(^DGP(45.83,"C",DGPTIFN,0)) I DA(1) S DIK="^DGP(45.83,"_DA(1)_",""P"",",DA=DGPTIFN D ^DIK K DIK,DA
"RTN","DGPTFDEL",42,0)
 D OPEN G Q
"RTN","DGPTFDEL",43,0)
 ;
"RTN","DGPTFDEL",44,0)
OPEN ;
"RTN","DGPTFDEL",45,0)
 D KDGP,KDGPT:DGRTY=2
"RTN","DGPTFDEL",46,0)
 W !,"****** RECORD RE-OPENED ******" D HANG^DGPTUTL
"RTN","DGPTFDEL",47,0)
 Q
"RTN","DGPTFDEL",48,0)
 ;
"RTN","DGPTFDEL",49,0)
KDGP ; -- kill close-out rec ; input DGPTIFN := ifn
"RTN","DGPTFDEL",50,0)
 S DA=DGPTIFN,DIK="^DGP(45.84," D ^DIK K DIK,DA
"RTN","DGPTFDEL",51,0)
 Q
"RTN","DGPTFDEL",52,0)
 ;
"RTN","DGPTFDEL",53,0)
KDGPT ; -- kill DGPT rec ; input DGPTIFN := ifn
"RTN","DGPTFDEL",54,0)
 S DA=DGPTIFN,DIK="^DGPT(",FLAG=1,I=0 F  S I=$O(^DGCPT(46,"C",DA,I)) Q:'I  I '$G(^DGCPT(46,I,9)) S FLAG=0 Q
"RTN","DGPTFDEL",55,0)
 I 'FLAG W !,"CANNOT DELETE THE PTF RECORD WHEN THERE ARE ACTIVE ORDERS OR CPT RECORDS." H 2 K FLAG Q
"RTN","DGPTFDEL",56,0)
 D ^DIK K DA,DIK,I,FLAG
"RTN","DGPTFDEL",57,0)
 I DGRTY=1 S DA=+$O(^DGPM("APTF",DGPTIFN,0)) I $D(^DGPM(DA,0)),$P(^(0),U,16)=DGPTIFN S DR=".16///@",DIE="^DGPM(" D ^DIE K DR,DIE
"RTN","DGPTFDEL",58,0)
 K DA Q
"RTN","DGPTFDEL",59,0)
 ;
"RTN","DGPTFDEL",60,0)
CHK ; -- check to see if PTF is open ; return DGPTIFN="" is not open
"RTN","DGPTFDEL",61,0)
 I $D(^DGPT(+$P(^DGPT(DGPTIFN,0),U,12),0)),$P(^(0),U,6) W !!,*7,?5,"Associated PTF record #",+$P(^DGPT(DGPTIFN,0),U,12)," must be RE-OPENED",!?5,"in order to re-open Census record #",DGPTIFN,"." S DGPTIFN=""
"RTN","DGPTFDEL",62,0)
 Q
"RTN","DGPTFDEL",63,0)
 ;
"RTN","DGPTFDEL",64,0)
CEN ; -- check if closed for census
"RTN","DGPTFDEL",65,0)
 K DGI
"RTN","DGPTFDEL",66,0)
 F DGI=0:0 S DGI=$O(^DGPT("ACENSUS",DA,DGI)) Q:'DGI  I $D(^DGPT(DGI,0)),$P(^(0),U,12)=DA,$D(^DG(45.86,+$P(^(0),U,13),0)) S Y=+^(0) X ^DD("DD") S DGI(DGI)=Y
"RTN","DGPTFDEL",67,0)
 G CENQ:$D(DGI)<10
"RTN","DGPTFDEL",68,0)
 W !!?2,*7,"This PTF record is associated with the following Census records:"
"RTN","DGPTFDEL",69,0)
 F DGI=0:0 S DGI=$O(DGI(DGI)) Q:'DGI  W !?10,"Census Record #",DGI,?35,"==>",?40,"Census Date: ",DGI(DGI)
"RTN","DGPTFDEL",70,0)
 W !!?2,"PTF record can not be deleted."
"RTN","DGPTFDEL",71,0)
 K DA
"RTN","DGPTFDEL",72,0)
CENQ K DGI Q
"RTN","DGREGAZL")
0^3^B41604558^B39798425
"RTN","DGREGAZL",1,0)
DGREGAZL ;ALB/DW - ZIP LINKING UTILITY ; 5/27/04 10:54am
"RTN","DGREGAZL",2,0)
 ;;5.3;Registration;**522,560,581,730,760**;Aug 13, 1993;Build 11
"RTN","DGREGAZL",3,0)
 ;
"RTN","DGREGAZL",4,0)
EN(RESULT,DFN) ;Let user edit zip+4, city, state, county based on zip-linking
"RTN","DGREGAZL",5,0)
 ; Output: RESULT(field#) = User Input External ^ Internal
"RTN","DGREGAZL",6,0)
 K RESULT
"RTN","DGREGAZL",7,0)
 N DGIND,DGTOT
"RTN","DGREGAZL",8,0)
 I $G(DFN)="" S RESULT=-1 Q
"RTN","DGREGAZL",9,0)
 N DGR,DGDFLT,DGALW,DGZIP,DGN
"RTN","DGREGAZL",10,0)
 S DGN=""
"RTN","DGREGAZL",11,0)
 I $$FOREIGN() D  Q
"RTN","DGREGAZL",12,0)
 . D FRGNEDT(.DGR,DFN)
"RTN","DGREGAZL",13,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",14,0)
 . F DGN=.1112,.114,.115,.117 S RESULT(DGN)=$G(DGR(DGN))
"RTN","DGREGAZL",15,0)
 S DGZIP=$$ZIP(DFN)
"RTN","DGREGAZL",16,0)
 I DGZIP=-1 S RESULT=-1 Q
"RTN","DGREGAZL",17,0)
 S RESULT(.1112)=DGZIP
"RTN","DGREGAZL",18,0)
 S DGIND=$$CITY(.DGR,DGZIP,DFN)
"RTN","DGREGAZL",19,0)
 I DGIND=$G(DGTOT)+1 S DGIND=""
"RTN","DGREGAZL",20,0)
 I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",21,0)
 S RESULT(.114)=$G(DGR)
"RTN","DGREGAZL",22,0)
 S DGALW=$$ALWEDT^DGREGDD1($G(DUZ),DGZIP)
"RTN","DGREGAZL",23,0)
 I DGALW=1 D
"RTN","DGREGAZL",24,0)
 . K DGR D STCNTY(.DGR,DGZIP,DFN,DGIND)
"RTN","DGREGAZL",25,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",26,0)
 . S RESULT(.115)=$G(DGR(.115))
"RTN","DGREGAZL",27,0)
 . S RESULT(.117)=$G(DGR(.117))
"RTN","DGREGAZL",28,0)
 I DGALW=0 D
"RTN","DGREGAZL",29,0)
 . I DGZIP'="" D LINK(.DGDFLT,DGZIP,1)
"RTN","DGREGAZL",30,0)
 . S RESULT(.115)=$G(DGDFLT(.115))
"RTN","DGREGAZL",31,0)
 . S RESULT(.117)=$G(DGDFLT(.117))
"RTN","DGREGAZL",32,0)
 Q
"RTN","DGREGAZL",33,0)
ZIP(DFN) ;Let user input zip+4
"RTN","DGREGAZL",34,0)
ZAGN N DIR,DTOUT,DUOUT,DIROUT,DGDATA
"RTN","DGREGAZL",35,0)
 S DIR(0)="2,.1112"
"RTN","DGREGAZL",36,0)
 S DA=DFN
"RTN","DGREGAZL",37,0)
 D ^DIR
"RTN","DGREGAZL",38,0)
 I $D(DTOUT) Q -1
"RTN","DGREGAZL",39,0)
 I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G ZAGN
"RTN","DGREGAZL",40,0)
 S DGZIP=$G(Y)
"RTN","DGREGAZL",41,0)
 ;allow bogus zip:
"RTN","DGREGAZL",42,0)
 I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q DGZIP
"RTN","DGREGAZL",43,0)
 I DGZIP="" Q DGZIP
"RTN","DGREGAZL",44,0)
 D POSTALB^XIPUTIL(DGZIP,.DGDATA)
"RTN","DGREGAZL",45,0)
  ;DG*730 - later commented out by DG*760
"RTN","DGREGAZL",46,0)
 ;I $G(DGDATA(1,"CITY ABBREVIATION"))'="",$G(DGDATA(1,"CITY ABBREVIATION"))=$G(DGDATA(2,"CITY")) S DGDATA=1 K DGDATA(2)
"RTN","DGREGAZL",47,0)
 I $D(DGDATA("ERROR")) D  G ZAGN
"RTN","DGREGAZL",48,0)
 . W $C(7)," ??"
"RTN","DGREGAZL",49,0)
 Q DGZIP
"RTN","DGREGAZL",50,0)
CITY(RESULT,ZIP,DFN) ;Base on zip, let user input city(#.114)
"RTN","DGREGAZL",51,0)
 ; Input:
"RTN","DGREGAZL",52,0)
 ;   ZIP - user input zip for the patient primary address
"RTN","DGREGAZL",53,0)
 ;   DFN - Interal entry number of Patient File (#2)
"RTN","DGREGAZL",54,0)
 ; Output:RESULT=-1 (input error or timed or ^ out) 
"RTN","DGREGAZL",55,0)
 ;        or    =user input city
"RTN","DGREGAZL",56,0)
 ;        Array index # of selected city.
"RTN","DGREGAZL",57,0)
 K RESULT
"RTN","DGREGAZL",58,0)
 N DGDATA,DIR,DA,Y,DTOUT,DUOUT,DIROUT,DGIND
"RTN","DGREGAZL",59,0)
 N DGCITY,DGST,DGCNTY,DGABRV,DGN,DGECH,DGSOC
"RTN","DGREGAZL",60,0)
 N DOLDCITY,DGSAME,DGELEVEN
"RTN","DGREGAZL",61,0)
 ; DG*760 brought in DGCITI
"RTN","DGREGAZL",62,0)
 N DGCITI
"RTN","DGREGAZL",63,0)
 S DGIND=""
"RTN","DGREGAZL",64,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",65,0)
 ;DG*730 - later commented out by DG*760
"RTN","DGREGAZL",66,0)
 ;I $G(DGDATA(1,"CITY ABBREVIATION"))'="",$G(DGDATA(1,"CITY ABBREVIATION"))=$G(DGDATA(2,"CITY")) S DGDATA=1 K DGDATA(2)
"RTN","DGREGAZL",67,0)
 D FIELD^DID(2,.114,"N","LABEL","DGCITY")
"RTN","DGREGAZL",68,0)
 S DGN=""
"RTN","DGREGAZL",69,0)
 I '$D(DGDATA("ERROR")) D
"RTN","DGREGAZL",70,0)
 . S DOLDCITY=$$GET1^DIQ(2,DFN_",",.114)
"RTN","DGREGAZL",71,0)
 . S DGSAME=0
"RTN","DGREGAZL",72,0)
 . F  S DGN=$O(DGDATA(DGN)) Q:DGN=""  D
"RTN","DGREGAZL",73,0)
 .. S DGCITI=$P($G(DGDATA(DGN,"CITY")),"*",1)
"RTN","DGREGAZL",74,0)
 .. S DGABRV=$G(DGDATA(DGN,"CITY ABBREVIATION"))
"RTN","DGREGAZL",75,0)
 .. I DOLDCITY'="",DGCITI=DOLDCITY!(DGABRV=DOLDCITY) S DGSAME=1
"RTN","DGREGAZL",76,0)
 .. ; next 4 commented out lines done by DG*760
"RTN","DGREGAZL",77,0)
 .. ;I DGABRV="" S DGABRV=$P($G(DGDATA(DGN,"CITY")),"*",1)
"RTN","DGREGAZL",78,0)
 .. ;I DOLDCITY'="",DGABRV=DOLDCITY S DGSAME=1
"RTN","DGREGAZL",79,0)
 .. ;I $G(DGDATA(DGN,"CITY"))["*" S:DGABRV'="" DGABRV=DGABRV_"*"
"RTN","DGREGAZL",80,0)
 .. I $G(DGDATA(DGN,"CITY"))["*" S DGCITI=DGCITI_"*"
"RTN","DGREGAZL",81,0)
 .. ;S DGECH=DGN_":"_DGABRV
"RTN","DGREGAZL",82,0)
 .. S DGECH=DGN_":"_DGCITI
"RTN","DGREGAZL",83,0)
 .. S DGSOC=$S($G(DGSOC)="":DGECH,1:DGSOC_";"_DGECH)
"RTN","DGREGAZL",84,0)
 .. S DGTOT=DGN
"RTN","DGREGAZL",85,0)
 .I 'DGSAME S DGELEVEN=$G(^DPT(DFN,.11)) D
"RTN","DGREGAZL",86,0)
 ..Q:$P(DGELEVEN,U,6)'=$G(DGDATA(DGTOT,"POSTAL CODE"))
"RTN","DGREGAZL",87,0)
 ..Q:$P(DGELEVEN,U,14)'="VAMC"
"RTN","DGREGAZL",88,0)
 ..Q:$P(DGELEVEN,U,15)'=$$GETSITE^DGMTU4($G(DUZ))
"RTN","DGREGAZL",89,0)
 ..Q:$P(DGELEVEN,U,17)'>.5
"RTN","DGREGAZL",90,0)
 ..S DGN=DGTOT+1,DGECH=DGN_":"_DOLDCITY,DGSOC=DGSOC_";"_DGECH
"RTN","DGREGAZL",91,0)
 .;
"RTN","DGREGAZL",92,0)
 . I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D
"RTN","DGREGAZL",93,0)
 .. S DGSOC=$G(DGSOC)_";"_99_":"_"FREE TEXT"
"RTN","DGREGAZL",94,0)
 . S DIR(0)="SO^"_$G(DGSOC)
"RTN","DGREGAZL",95,0)
 . ;if zip '= zip on file, default = ""; else default=city on file
"RTN","DGREGAZL",96,0)
 . ;I ($G(DFN)'="")&($E(ZIP,1,5)=$$GET1^DIQ(2,DFN_",",.116)) D
"RTN","DGREGAZL",97,0)
 . S DIR("B")=$$GET1^DIQ(2,DFN_",",.114)
"RTN","DGREGAZL",98,0)
 . S DIR("A")=$G(DGCITY("LABEL"))
"RTN","DGREGAZL",99,0)
CAGN1 . D ^DIR
"RTN","DGREGAZL",100,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",101,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN1
"RTN","DGREGAZL",102,0)
 . S RESULT=$P($G(Y(0)),"*")
"RTN","DGREGAZL",103,0)
 . S DGIND=$G(Y)
"RTN","DGREGAZL",104,0)
 I ($G(Y)=99)!($D(DGDATA("ERROR"))) D
"RTN","DGREGAZL",105,0)
CAGN2 . I '$D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q
"RTN","DGREGAZL",106,0)
 . N DIR,X,Y
"RTN","DGREGAZL",107,0)
 . S DIR(0)="2,.114"
"RTN","DGREGAZL",108,0)
 . S DA=DFN
"RTN","DGREGAZL",109,0)
 . D ^DIR
"RTN","DGREGAZL",110,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",111,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN2
"RTN","DGREGAZL",112,0)
 . S RESULT=$G(Y)
"RTN","DGREGAZL",113,0)
 I $L($G(RESULT))>15 D
"RTN","DGREGAZL",114,0)
 . S DGN=Y
"RTN","DGREGAZL",115,0)
 . S RESULT=$G(DGDATA(DGN,"CITY ABBREVIATION"))
"RTN","DGREGAZL",116,0)
 Q DGIND
"RTN","DGREGAZL",117,0)
 ;
"RTN","DGREGAZL",118,0)
LINK(RESULT,ZIP,DGN) ;From zip, get the linked state,county
"RTN","DGREGAZL",119,0)
 K RESULT
"RTN","DGREGAZL",120,0)
 N DGDATA,CNTYIEN
"RTN","DGREGAZL",121,0)
 S CNTYIEN=""
"RTN","DGREGAZL",122,0)
 S DGN=$G(DGN)
"RTN","DGREGAZL",123,0)
 I (DGN="")&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",124,0)
 I (DGN=99)&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",125,0)
 I (DGN="")!(DGN=99) Q
"RTN","DGREGAZL",126,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",127,0)
 S:$G(DGDATA(DGN,"STATE POINTER"))'="" CNTYIEN=$$FIND1^DIC(5.01,","_$G(DGDATA(DGN,"STATE POINTER"))_",","MOXQ",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),"C")
"RTN","DGREGAZL",128,0)
 D:'CNTYIEN  ;could be duplicate county codes in subfile #5.01
"RTN","DGREGAZL",129,0)
 .Q:'$D(^DIC(5,+$G(DGDATA(DGN,"STATE POINTER")),1))
"RTN","DGREGAZL",130,0)
 .Q:$E($G(DGDATA(DGN,"FIPS CODE")),3,5)=""
"RTN","DGREGAZL",131,0)
 .S CNTYIEN=$O(^DIC(5,$G(DGDATA(DGN,"STATE POINTER")),1,"C",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),""))
"RTN","DGREGAZL",132,0)
 S RESULT(.115)=$G(DGDATA(DGN,"STATE"))_U_$G(DGDATA(DGN,"STATE POINTER"))
"RTN","DGREGAZL",133,0)
 S RESULT(.117)=$G(DGDATA(DGN,"COUNTY"))_U_$G(CNTYIEN)_U_$E($G(DGDATA(DGN,"FIPS CODE")),3,5)
"RTN","DGREGAZL",134,0)
 Q
"RTN","DGREGAZL",135,0)
 ;
"RTN","DGREGAZL",136,0)
STCNTY(RESULT,ZIP,DFN,DGNUM) ;Based on zip,input state (#.115) and county (#.117)
"RTN","DGREGAZL",137,0)
 K RESULT
"RTN","DGREGAZL",138,0)
 S DGNUM=$G(DGNUM)
"RTN","DGREGAZL",139,0)
 N DGN,DGDFLT,DGST,POP,DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","DGREGAZL",140,0)
 S POP=0
"RTN","DGREGAZL",141,0)
 D LINK(.DGDFLT,ZIP,DGNUM)
"RTN","DGREGAZL",142,0)
 F DGN=.115,.117 Q:POP  D
"RTN","DGREGAZL",143,0)
SCAGN . I DGN=.115 S DIR(0)=2_","_DGN
"RTN","DGREGAZL",144,0)
 . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",145,0)
 . I DGN=.117 S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",146,0)
 . S DIR("B")=$P($G(DGDFLT(DGN)),U)
"RTN","DGREGAZL",147,0)
 . D ^DIR
"RTN","DGREGAZL",148,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",149,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G SCAGN
"RTN","DGREGAZL",150,0)
 . S RESULT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",151,0)
 . I DGN=.115 S DGST=$P($G(Y),U)
"RTN","DGREGAZL",152,0)
 . I DGN=.117 S RESULT(.117)=$$CNTY(DGST,$P($G(RESULT(.117)),U,2))
"RTN","DGREGAZL",153,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",154,0)
 Q
"RTN","DGREGAZL",155,0)
CNTY(DGST,DGCIEN) ;Return county name and code
"RTN","DGREGAZL",156,0)
 ;Input:state number and county IEN
"RTN","DGREGAZL",157,0)
 ;Output: CountyName^CountyIEN^CountyCode
"RTN","DGREGAZL",158,0)
 I ($G(DGST)="")!($G(DGCIEN)="") S RESULT=-1 Q RESULT
"RTN","DGREGAZL",159,0)
 N DGR,RESULT
"RTN","DGREGAZL",160,0)
 S DGR=$G(^DIC(5,DGST,1,DGCIEN,0))
"RTN","DGREGAZL",161,0)
 S RESULT=$P($G(DGR),U)_U_DGCIEN_U_$P($G(DGR),U,3)
"RTN","DGREGAZL",162,0)
 Q RESULT
"RTN","DGREGAZL",163,0)
FOREIGN() ;Manila (Philippines) doesn't need zip linking.
"RTN","DGREGAZL",164,0)
 ;Output: 1 - area need no zip linking
"RTN","DGREGAZL",165,0)
 ;        0 - zip-linking area
"RTN","DGREGAZL",166,0)
 I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=358 Q 1
"RTN","DGREGAZL",167,0)
 ;;;I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=500 Q 1 ;;HERE TEST
"RTN","DGREGAZL",168,0)
 Q 0
"RTN","DGREGAZL",169,0)
FRGNEDT(DGINPUT,DFN) ;Edit zip+4, city, state, county for no zip-linking area
"RTN","DGREGAZL",170,0)
 K DGINPUT
"RTN","DGREGAZL",171,0)
 N DGN,DIR,DTOUT,DUOUT,DIROUT,X,Y,POP,DGST
"RTN","DGREGAZL",172,0)
 S POP=0
"RTN","DGREGAZL",173,0)
 F DGN=.1112,.114,.115,.117 Q:POP  D
"RTN","DGREGAZL",174,0)
FAGN . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",175,0)
 . S DIR(0)=2_","_DGN
"RTN","DGREGAZL",176,0)
 . I DGN=.117 D
"RTN","DGREGAZL",177,0)
 .. S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",178,0)
 .. S DIR("B")=$$GET1^DIQ(2,DFN_",",.117)
"RTN","DGREGAZL",179,0)
 . I DGN'=.117 S DA=DFN
"RTN","DGREGAZL",180,0)
 . D ^DIR
"RTN","DGREGAZL",181,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",182,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G FAGN
"RTN","DGREGAZL",183,0)
 . I (DGN=.114)!(DGN=.1112) S DGINPUT(DGN)=$G(Y)
"RTN","DGREGAZL",184,0)
 . I (DGN=.115) D
"RTN","DGREGAZL",185,0)
 .. S DGST=$P($G(Y),U)
"RTN","DGREGAZL",186,0)
 .. I DGST=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",187,0)
 ... S DGINPUT(.115)=$$GET1^DIQ(2,DFN_",",.115)_U_DGST
"RTN","DGREGAZL",188,0)
 .. I DGST'=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",189,0)
 ... S DGINPUT(.115)=$P($G(Y(0)),U)_U_DGST
"RTN","DGREGAZL",190,0)
 . I DGN=.117 S DGINPUT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",191,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",192,0)
 Q
"RTN","DGRP2")
0^4^B11254124^B11252492
"RTN","DGRP2",1,0)
DGRP2 ;ALB/MRL,BRM - REGISTRATION SCREEN 2/CONTACT INFORMATION ;06 JUN 88@2300
"RTN","DGRP2",2,0)
 ;;5.3;Registration;**415,545,638,677,760**;Aug 13, 1993;Build 11
"RTN","DGRP2",3,0)
 S DGRPS=2 D H^DGRPU F I=0,.24,57,1010.15 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP2",4,0)
 S DGRPX=DGRP(0)
"RTN","DGRP2",5,0)
 S (Z,DGRPW)=1 D WW^DGRPV W "  Marital: " S Z=$S($D(^DIC(11,+$P(DGRPX,"^",5),0)):$E($P(^(0),"^",1),1,28),1:DGRPU),Z1=30 D WW1^DGRPV
"RTN","DGRP2",6,0)
 ;S (Z,DGRPW)=1 D WW^DGRPV W "     Sex: " S X=$P(DGRP(0),"^",2),Z=$S(X="M":"MALE",X="F":"FEMALE",1:DGRPU),Z1=31 D WW1^DGRPV
"RTN","DGRP2",7,0)
 S DGD=$$DISP^DG1010P0(DGRP(0),11,0,1),DGNOCITY=DGUNK,DGD1=$$POINT^DG1010P0(DGRP(0),12,5,1,0,1)
"RTN","DGRP2",8,0)
 W ?41,"POB: ",$E($S((DGNOCITY&DGUNK):"UNANSWERED",1:DGD_$S(($L(DGD)):", ",1:"")_DGD1),1,29)
"RTN","DGRP2",9,0)
 ;S DGRPX=DGRP(0)
"RTN","DGRP2",10,0)
 W !?4,"Religion: ",$S($D(^DIC(13,+$P(DGRPX,"^",8),0)):$P(^(0),"^",1),1:DGRPU),?41,"Father: ",$S($P(DGRP(.24),"^",1)]"":$E($P(DGRP(.24),"^",1),1,29),1:DGRPU)
"RTN","DGRP2",11,0)
 S X=$P(DGRP(57),"^",4),X=$S(X']"":DGRPU,X="X":"NOT APPLICABLE",X=1:"PARA,",X=2:"QUAD,",X=3:"PARA,NON",1:"QUAD,NON"),X=$S("QP"[$E(X):X_"TRAUMATIC",1:X) W !?9,"SCI: ",X
"RTN","DGRP2",12,0)
 W ?41,"Mother: ",$S($P(DGRP(.24),"^",2)]"":$E($P(DGRP(.24),"^",2),1,29),1:DGRPU)
"RTN","DGRP2",13,0)
 W !,?35,"Mom's Maiden: ",$S($P(DGRP(.24),"^",3)]"":$E($P(DGRP(.24),"^",3),1,29),1:DGRPU)
"RTN","DGRP2",14,0)
 W ! S Z=2 D WW^DGRPV W " Previous Care Date      Location of Previous Care",!?4,"------------------      -------------------------" S DGRPX=DGRP(1010.15) I $P(DGRPX,"^",5)'="Y" S X="NONE INDICATED" W !?4,X,?28,X
"RTN","DGRP2",15,0)
 E  F I=1:1:4 S I1=$P(DGRPX,"^",I) X "I I#2 S Y=I1 X:Y]"""" ^DD(""DD"") W !?4,$S(Y]"""":Y,1:DGRPU)" I '(I#2) W ?28,$S($D(^DIC(4,+I1,0)):$P(^(0),"^",1),1:DGRPU)
"RTN","DGRP2",16,0)
 W ! S Z=3 D WW^DGRPV W " Ethnicity: " D
"RTN","DGRP2",17,0)
 .I '$O(^DPT(DFN,.06,0)) W "UNANSWERED" Q
"RTN","DGRP2",18,0)
 .N NODE,NUM,ETHNIC
"RTN","DGRP2",19,0)
 .S I=0
"RTN","DGRP2",20,0)
 .F NUM=0:1 S I=+$O(^DPT(DFN,.06,I)) Q:'I  D
"RTN","DGRP2",21,0)
 ..S NODE=$G(^DPT(DFN,.06,I,0))
"RTN","DGRP2",22,0)
 ..S X=$P($G(^DIC(10.2,+NODE,0)),"^",1)
"RTN","DGRP2",23,0)
 ..S ETHNIC=$S(X="":"?????",1:X)
"RTN","DGRP2",24,0)
 ..S X=$P($G(^DIC(10.3,+$P(NODE,"^",2),0)),"^",2)
"RTN","DGRP2",25,0)
 ..S ETHNIC=ETHNIC_" ("_$S(X="":"?",1:X)_")"
"RTN","DGRP2",26,0)
 ..I NUM S ETHNIC=", "_ETHNIC
"RTN","DGRP2",27,0)
 ..I ($X+$L(ETHNIC))>IOM D  W !?15
"RTN","DGRP2",28,0)
 ...F  S X=$P(ETHNIC," ",1)_" " Q:($X+$L(X))>IOM  W X S ETHNIC=$P(ETHNIC," ",2,999)
"RTN","DGRP2",29,0)
 ..W ETHNIC
"RTN","DGRP2",30,0)
 W !?9,"Race: " D
"RTN","DGRP2",31,0)
 .I '$O(^DPT(DFN,.02,0)) W "UNANSWERED" Q
"RTN","DGRP2",32,0)
 .N NODE,NUM,RACE
"RTN","DGRP2",33,0)
 .S I=0
"RTN","DGRP2",34,0)
 .F NUM=0:1 S I=+$O(^DPT(DFN,.02,I)) Q:'I  D
"RTN","DGRP2",35,0)
 ..S NODE=$G(^DPT(DFN,.02,I,0))
"RTN","DGRP2",36,0)
 ..S X=$P($G(^DIC(10,+NODE,0)),"^",1)
"RTN","DGRP2",37,0)
 ..S RACE=$S(X="":"?????",1:X)
"RTN","DGRP2",38,0)
 ..S X=$P($G(^DIC(10.3,+$P(NODE,"^",2),0)),"^",2)
"RTN","DGRP2",39,0)
 ..S RACE=RACE_" ("_$S(X="":"?",1:X)_")"
"RTN","DGRP2",40,0)
 ..I NUM S RACE=", "_RACE
"RTN","DGRP2",41,0)
 ..I ($X+$L(RACE))>IOM D  W !?15
"RTN","DGRP2",42,0)
 ...F  S X=$P(RACE," ",1)_" " Q:($X+$L(X))>IOM  W X S RACE=$P(RACE," ",2,999)
"RTN","DGRP2",43,0)
 ..W RACE
"RTN","DGRP2",44,0)
 D GETS^DIQ(2,DFN_",",".351;.353;.354;.355","E","PDTHINFO")
"RTN","DGRP2",45,0)
 W !!
"RTN","DGRP2",46,0)
 W "<4> Date of Death Information"
"RTN","DGRP2",47,0)
 W !,?5,"Date of Death: ",$G(PDTHINFO(2,DFN_",",.351,"E"))
"RTN","DGRP2",48,0)
 W ?41,"Source of Notification: ",$G(PDTHINFO(2,DFN_",",.353,"E"))
"RTN","DGRP2",49,0)
 W !,?5,"Updated Date/Time: ",$G(PDTHINFO(2,DFN_",",.354,"E"))
"RTN","DGRP2",50,0)
 W ?41,"Last Edited By: ",$G(PDTHINFO(2,DFN_",",.355,"E")),!
"RTN","DGRP2",51,0)
 K PDTHINFO
"RTN","DGRP2",52,0)
 ;
"RTN","DGRP2",53,0)
 ;Emergency Response Indicator
"RTN","DGRP2",54,0)
 N DGEMRES S DGEMRES=$P($G(^DPT(DFN,.18)),"^")
"RTN","DGRP2",55,0)
 S Z=5 D WW^DGRPV W " Emergency Response: "_$$EXTERNAL^DILFD(2,.181,,DGEMRES)
"RTN","DGRP2",56,0)
 G ^DGRPP
"VER")
8.0^22.0
"BLD",7305,6)
^679
**END**
**END**
