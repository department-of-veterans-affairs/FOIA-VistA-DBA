Released SR*3*147 SEQ #139
Extracted from mail message
**KIDS**:SR*3.0*147^

**INSTALL NAME**
SR*3.0*147
"BLD",5478,0)
SR*3.0*147^SURGERY^0^3050825^y
"BLD",5478,1,0)
^^13^13^3050825^
"BLD",5478,1,1,0)
1. For CPRS-R (ReHosting), a cache of patient data will be maintained for
"BLD",5478,1,2,0)
   the duration of his/her inpatient stay (or outpatient visit) for ease
"BLD",5478,1,3,0)
   of searching and sorting within the new Java client; rather than making
"BLD",5478,1,4,0)
   frequent calls back to each application's database. To this end, this
"BLD",5478,1,5,0)
   patch contains modifications that will allow the Surgery software to
"BLD",5478,1,6,0)
   update the CPRS-R (ReHosting) cache of patient data when a case is
"BLD",5478,1,7,0)
   created or edited.
"BLD",5478,1,8,0)
 
"BLD",5478,1,9,0)
2. This patch updates the data dictionary of the PREOP SHAVE BY field
"BLD",5478,1,10,0)
   (#.12) in the SURGERY file (#130). The field is renamed "PREOP HAIR
"BLD",5478,1,11,0)
   CLIPPING BY" and the title and description of this field are updated.
"BLD",5478,1,12,0)
   The field titles on the Nurse Intraoperative Report are changed as
"BLD",5478,1,13,0)
   well.
"BLD",5478,4,0)
^9.64PA^130^1
"BLD",5478,4,130,0)
130
"BLD",5478,4,130,2,0)
^9.641^130^1
"BLD",5478,4,130,2,130,0)
SURGERY  (File-top level)
"BLD",5478,4,130,2,130,1,0)
^9.6411^.12^1
"BLD",5478,4,130,2,130,1,.12,0)
PREOP HAIR CLIPPING BY
"BLD",5478,4,130,222)
y^y^p^^^^n^^n
"BLD",5478,4,130,224)

"BLD",5478,4,"APDD",130,130)

"BLD",5478,4,"APDD",130,130,.12)

"BLD",5478,4,"B",130,130)

"BLD",5478,6)
1^
"BLD",5478,"KRN",0)
^9.67PA^8989.52^19
"BLD",5478,"KRN",.4,0)
.4
"BLD",5478,"KRN",.401,0)
.401
"BLD",5478,"KRN",.402,0)
.402
"BLD",5478,"KRN",.403,0)
.403
"BLD",5478,"KRN",.5,0)
.5
"BLD",5478,"KRN",.84,0)
.84
"BLD",5478,"KRN",3.6,0)
3.6
"BLD",5478,"KRN",3.8,0)
3.8
"BLD",5478,"KRN",9.2,0)
9.2
"BLD",5478,"KRN",9.8,0)
9.8
"BLD",5478,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5478,"KRN",9.8,"NM",1,0)
SROERR^^0^B33489403
"BLD",5478,"KRN",9.8,"NM",2,0)
SROERR0^^0^B17879401
"BLD",5478,"KRN",9.8,"NM",3,0)
SROESNR0^^0^B29620281
"BLD",5478,"KRN",9.8,"NM",4,0)
SRONRPT0^^0^B48530067
"BLD",5478,"KRN",9.8,"NM","B","SROERR",1)

"BLD",5478,"KRN",9.8,"NM","B","SROERR0",2)

"BLD",5478,"KRN",9.8,"NM","B","SROESNR0",3)

"BLD",5478,"KRN",9.8,"NM","B","SRONRPT0",4)

"BLD",5478,"KRN",19,0)
19
"BLD",5478,"KRN",19.1,0)
19.1
"BLD",5478,"KRN",101,0)
101
"BLD",5478,"KRN",409.61,0)
409.61
"BLD",5478,"KRN",771,0)
771
"BLD",5478,"KRN",870,0)
870
"BLD",5478,"KRN",8989.51,0)
8989.51
"BLD",5478,"KRN",8989.52,0)
8989.52
"BLD",5478,"KRN",8994,0)
8994
"BLD",5478,"KRN","B",.4,.4)

"BLD",5478,"KRN","B",.401,.401)

"BLD",5478,"KRN","B",.402,.402)

"BLD",5478,"KRN","B",.403,.403)

"BLD",5478,"KRN","B",.5,.5)

"BLD",5478,"KRN","B",.84,.84)

"BLD",5478,"KRN","B",3.6,3.6)

"BLD",5478,"KRN","B",3.8,3.8)

"BLD",5478,"KRN","B",9.2,9.2)

"BLD",5478,"KRN","B",9.8,9.8)

"BLD",5478,"KRN","B",19,19)

"BLD",5478,"KRN","B",19.1,19.1)

"BLD",5478,"KRN","B",101,101)

"BLD",5478,"KRN","B",409.61,409.61)

"BLD",5478,"KRN","B",771,771)

"BLD",5478,"KRN","B",870,870)

"BLD",5478,"KRN","B",8989.51,8989.51)

"BLD",5478,"KRN","B",8989.52,8989.52)

"BLD",5478,"KRN","B",8994,8994)

"BLD",5478,"QUES",0)
^9.62^^
"BLD",5478,"REQB",0)
^9.611^1^1
"BLD",5478,"REQB",1,0)
SR*3.0*129^2
"BLD",5478,"REQB","B","SR*3.0*129",1)

"FIA",130)
SURGERY
"FIA",130,0)
^SRF(
"FIA",130,0,0)
130IP
"FIA",130,0,1)
y^y^p^^^^n^^n
"FIA",130,0,10)

"FIA",130,0,11)

"FIA",130,0,"RLRO")

"FIA",130,0,"VR")
3.0^SR
"FIA",130,130)
1
"FIA",130,130,.12)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
147^3050825^517
"PKG",167,22,1,"PAH",1,1,0)
^^13^13^3050825
"PKG",167,22,1,"PAH",1,1,1,0)
1. For CPRS-R (ReHosting), a cache of patient data will be maintained for
"PKG",167,22,1,"PAH",1,1,2,0)
   the duration of his/her inpatient stay (or outpatient visit) for ease
"PKG",167,22,1,"PAH",1,1,3,0)
   of searching and sorting within the new Java client; rather than making
"PKG",167,22,1,"PAH",1,1,4,0)
   frequent calls back to each application's database. To this end, this
"PKG",167,22,1,"PAH",1,1,5,0)
   patch contains modifications that will allow the Surgery software to
"PKG",167,22,1,"PAH",1,1,6,0)
   update the CPRS-R (ReHosting) cache of patient data when a case is
"PKG",167,22,1,"PAH",1,1,7,0)
   created or edited.
"PKG",167,22,1,"PAH",1,1,8,0)
 
"PKG",167,22,1,"PAH",1,1,9,0)
2. This patch updates the data dictionary of the PREOP SHAVE BY field
"PKG",167,22,1,"PAH",1,1,10,0)
   (#.12) in the SURGERY file (#130). The field is renamed "PREOP HAIR
"PKG",167,22,1,"PAH",1,1,11,0)
   CLIPPING BY" and the title and description of this field are updated.
"PKG",167,22,1,"PAH",1,1,12,0)
   The field titles on the Nurse Intraoperative Report are changed as
"PKG",167,22,1,"PAH",1,1,13,0)
   well.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SROERR")
0^1^B33489403
"RTN","SROERR",1,0)
SROERR ;BIR/MAM,ADM - ORDER ENTRY ROUTINE ;01/22/99
"RTN","SROERR",2,0)
 ;;3.0; Surgery ;**14,67,73,41,80,86,107,147**;24 Jun 93
"RTN","SROERR",3,0)
 ;
"RTN","SROERR",4,0)
 ; Reference to ^ORD(100.99 supported by DBIA #874
"RTN","SROERR",5,0)
 ; Reference to FILE^ORX supported by DBIA #866
"RTN","SROERR",6,0)
 ; Reference to ST^ORX supported by DBIA #866
"RTN","SROERR",7,0)
 ; Reference to NEW^VPRSR supported by DBIA #4750
"RTN","SROERR",8,0)
 ; Reference to DEL^VPRSR supported by DBIA #4750
"RTN","SROERR",9,0)
 ;
"RTN","SROERR",10,0)
CREATE ; create order in ORDER file (100)
"RTN","SROERR",11,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y" D
"RTN","SROERR",12,0)
 .N SROP,SROPER,SRTYPE,DYNOTE
"RTN","SROERR",13,0)
 .S SROP=SRTN,SROPER="" D ^SROP1 S SRTYPE=1
"RTN","SROERR",14,0)
 .I SROPER["REQUESTED" Q
"RTN","SROERR",15,0)
 .I $P($G(^SRF(SRTN,"OP")),"^",2)']"" D
"RTN","SROERR",16,0)
 ..W !!,"  This Surgery case does not have a Principal CPT Code entered. The ",!,"  information sent to SPD for creation of a case cart may not contain ",!,"  enough information for processing."
"RTN","SROERR",17,0)
 .I SROPER["SCHEDULED" S SRTYPE=1
"RTN","SROERR",18,0)
 .I SROPER["NOT COMPLETE",$P($G(^SRF(SRTN,.2)),"^",10) S SRTYPE=1
"RTN","SROERR",19,0)
 .D ST^SRSCOR(SRTN)
"RTN","SROERR",20,0)
 N SREVENT S SREVENT="S12",SROERR=SRTN D STATUS^SROERR0,MSG^SRHLZIU(SRTN,SRSTATUS,SREVENT)
"RTN","SROERR",21,0)
 I $L($T(NEW^VPRSR)) D NEW^VPRSR(SROERR,$G(DFN),SRSTATUS) Q  ;CPRS-R
"RTN","SROERR",22,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 K SROERR Q
"RTN","SROERR",23,0)
 I '$D(^ORD(100.99)) Q
"RTN","SROERR",24,0)
 I '$D(ORPCL) K DIC S DIC="^DIC(19,",X="SR SURGERY REQUEST",DIC(0)="" D ^DIC I Y'=-1 S ORPCL=+Y_";DIC(19,"
"RTN","SROERR",25,0)
REQ S ORNP=SRSDOC,ORPK=SRTN,ORSTRT=SRSDATE S:'$D(ORVP) ORVP=DFN_";DPT(" D:'$D(ORL) LOC
"RTN","SROERR",26,0)
 S:'$D(SROERR) SROERR=SRTN D STATUS^SROERR0 S ORTX=SRSOP_"|>> Case #"_SRTN_" "_SRSTATUS
"RTN","SROERR",27,0)
 I DT<$E(ORSTRT,1,7) S X1=ORSTRT,X2=DT D ^%DTC S ORPURG=X+30
"RTN","SROERR",28,0)
 D FILE^ORX K DIE,DA,DR S DA=SRTN,DIE=130,DR="100////"_ORIFN D ^DIE K DA,DR,DIE,ORIFN,SROERR
"RTN","SROERR",29,0)
 Q
"RTN","SROERR",30,0)
LOC S SRL=$P($G(^DPT(DFN,.1)),"^") I SRL'="" K DIC S DIC="^DIC(42,",X=SRL D ^DIC K DIC S SRL=$S(Y'=-1:+Y,1:"") S:SRL SRL=$P($G(^DIC(42,SRL,44)),"^")
"RTN","SROERR",31,0)
 S ORL=$S(SRL:SRL_";SC(",1:"")
"RTN","SROERR",32,0)
 Q
"RTN","SROERR",33,0)
EN ; entry for OE/RR, process order actions
"RTN","SROERR",34,0)
 S:'$D(ORGY) ORGY="" Q:'$D(ORACTION)!(ORGY=9)  I ORGY=10 S SROERR=ORPK D ^SROERR0 Q
"RTN","SROERR",35,0)
 I ORACTION=7 D PURGE Q
"RTN","SROERR",36,0)
8 I ORACTION=8 D DETAIL S:'$O(ORSLST(ORNXT)) OREND=1 Q
"RTN","SROERR",37,0)
 I "2345"[ORACTION W !!,"Not allowed on Surgical Requests !" Q
"RTN","SROERR",38,0)
 I ORACTION,ORSTS'=5 W !!,"Cannot update/delete case not in 'REQUESTED' status !" Q
"RTN","SROERR",39,0)
 I '$D(^XUSEC("SROREQ",DUZ)) W !!,"You must hold the 'SROREQ' key to perform this function !" G PRESS
"RTN","SROERR",40,0)
 D:'$D(SRSITE) ^SROVAR S DFN=+ORVP D DEM^VADPT I ORACTION=0 S ORPCL=XQORNOD D ADD Q
"RTN","SROERR",41,0)
 I ORACTION=1 D DISPLAY,EDIT Q
"RTN","SROERR",42,0)
 I ORACTION=6 D DISPLAY D DEL^SRSUPRQ G END
"RTN","SROERR",43,0)
 Q
"RTN","SROERR",44,0)
EDIT ; edit requested case
"RTN","SROERR",45,0)
 W !!,"1. Delete",!,"2. Update Request Information",!,"3. Change the Request Date",!!,"Select Number: " R Z:DTIME S:'$T Z="" G:"^"[Z END S:Z["?" Z=4
"RTN","SROERR",46,0)
 I Z<1!(Z>3)!(+Z\1'=Z) W !!,"If you want to delete this request, enter '1'.  Enter '2' if you only want",!,"to update the general information about this case, or '3' to change the date",!,"for which this case is requested." G EDIT
"RTN","SROERR",47,0)
 I Z=1 D DEL^SRSUPRQ G END
"RTN","SROERR",48,0)
 I Z=2 D UPDATE^SRSUPRQ G END
"RTN","SROERR",49,0)
 I Z=3 D CHANGE^SRSDT
"RTN","SROERR",50,0)
END K SRTN D ^SRSKILL
"RTN","SROERR",51,0)
 Q
"RTN","SROERR",52,0)
DISPLAY S SRDFN=+ORVP,SRNM=VADM(1),SRTN=ORPK,SRSDATE=$P(^SRF(SRTN,0),"^",9)
"RTN","SROERR",53,0)
 W @IOF,!,SRNM," (",VA("PID"),")" I $P($G(^DPT(DFN,.35)),"^")'="" S Y=$P(^(.35),"^") D D^DIQ W "   ** DIED: "_Y_" **" G END
"RTN","SROERR",54,0)
 S SRSDT=$E(SRSDATE,4,5)_"/"_$E(SRSDATE,6,7)_"/"_$E(SRSDATE,2,3) S SROPER=$P(^SRF(SRTN,"OP"),"^")_" (#"_SRTN_")"
"RTN","SROERR",55,0)
 K SROPS,MM,MMM S:$L(SROPER)<71 SROPS(1)=SROPER I $L(SROPER)>70 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROERR",56,0)
 W !!,SRSDT,?11,SROPS(1) I $D(SROPS(2)) W !,?11,SROPS(2) I $D(SROPS(3)) W !,?11,SROPS(3)
"RTN","SROERR",57,0)
 Q
"RTN","SROERR",58,0)
LOOP ; break case information if longer than 70 characters
"RTN","SROERR",59,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<70  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROERR",60,0)
 Q
"RTN","SROERR",61,0)
PRESS W !!,"Press RETURN to continue  " R X:DTIME G:'$T END
"RTN","SROERR",62,0)
 Q
"RTN","SROERR",63,0)
DETAIL I $E(IOST)="C" W !!,"Press RETURN to review case information, or '^' to quit.  " R X:DTIME I '$T!(X["^") S OREND=1 Q
"RTN","SROERR",64,0)
 S SRTN=ORPK I $P($G(^SRF(SRTN,"NON")),"^")="Y" D ^SROERR2 G END
"RTN","SROERR",65,0)
 D ^SROERR1,END
"RTN","SROERR",66,0)
 Q
"RTN","SROERR",67,0)
ADD ; add new requests to ORDER file (100)
"RTN","SROERR",68,0)
 W @IOF,!,VADM(1)," (",VA("PID"),")" I $P($G(^DPT(+ORVP,.35)),"^")'="" S Y=$P(^(.35),"^") D D^DIQ W "   ** DIED: "_Y_" **"
"RTN","SROERR",69,0)
 W !!,"Add New Surgery Requests",!!!,"1. Make Operation Requests",!,"2. Make a Request from the Waiting List",!,"3. Make a Request for Concurrent Cases"
"RTN","SROERR",70,0)
 W !!,"Select Number: " R Z:DTIME S:'$T Z="" G:"^"[Z END S:Z["?" Z=4
"RTN","SROERR",71,0)
 I Z<1!(Z>3)!(+Z\1'=Z) W !!,"If you want to make a new operation request, enter '1'.  Enter '2' if you want",!,"to make a request from the surgery waiting list, or '3' to make a request for",!,"concurrent cases." D PRESS G ADD
"RTN","SROERR",72,0)
 I Z=1 D ^SRSMREQ G END
"RTN","SROERR",73,0)
 I Z=2 D ^SRSWREQ G END
"RTN","SROERR",74,0)
 I Z=3 D ^SRSCONR G END
"RTN","SROERR",75,0)
 Q
"RTN","SROERR",76,0)
PURGE ; purge order from ORDER file
"RTN","SROERR",77,0)
 N SREVENT,SRSTATUS S SREVENT="S17",SRSTATUS="(DELETED)" D MSG^SRHLZIU(ORPK,SRSTATUS,SREVENT)
"RTN","SROERR",78,0)
 I $L($T(DEL^VPRSR)) D DEL^VPRSR(ORPK,$G(DFN)) Q  ;CPRS-R
"RTN","SROERR",79,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 Q
"RTN","SROERR",80,0)
 I "589"'[ORSTS S:$D(^SRF(ORPK,0)) $P(^(0),"^",14)="" S ORSTS="K" D ST^ORX
"RTN","SROERR",81,0)
 Q
"RTN","SROERR",82,0)
DEL ; delete from ORDER file (100) and call CoreFLS API
"RTN","SROERR",83,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y" D
"RTN","SROERR",84,0)
 .N SRDYNOTE,SRTYPE
"RTN","SROERR",85,0)
 .S SRDYNOTE=$P($G(^SRF(SRTN,31)),"^",10) Q:'SRDYNOTE
"RTN","SROERR",86,0)
 .I SRDYNOTE S SRTYPE=4 D ST^SRSCOR(SRTN)
"RTN","SROERR",87,0)
 N SREVENT,SRSTATUS S SREVENT="S17",SRSTATUS="(DELETED)" D MSG^SRHLZIU(SRTN,SRSTATUS,SREVENT)
"RTN","SROERR",88,0)
 I $L($T(DEL^VPRSR)) D DEL^VPRSR(SRTN,$G(DFN)) Q  ;CPRS-R
"RTN","SROERR",89,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 Q
"RTN","SROERR",90,0)
 S:'$D(ORIFN) ORIFN=$P(^SRF(SRTN,0),"^",14) I $D(ORIFN) S ORSTS="K" D ST^ORX K ORIFN
"RTN","SROERR",91,0)
 Q
"RTN","SROERR0")
0^2^B17879401
"RTN","SROERR0",1,0)
SROERR0 ;BIR/ADM - ORDER ENTRY ROUTINE ;01/07/99
"RTN","SROERR0",2,0)
 ;;3.0; Surgery ;**4,67,73,41,86,107,147**;24 Jun 93
"RTN","SROERR0",3,0)
 ;
"RTN","SROERR0",4,0)
 ; Reference to RETURN^ORX supported by DBIA #866
"RTN","SROERR0",5,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SROERR0",6,0)
 ; Reference to UPD^VPRSR supported by DBIA #4750
"RTN","SROERR0",7,0)
 ;
"RTN","SROERR0",8,0)
 N SROP,SROPER,SRDYNOTE,SRTYPE S SRTYPE=0
"RTN","SROERR0",9,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y",$D(^TMP("CSLSUR1",$J)) D
"RTN","SROERR0",10,0)
 .S SROP=SROERR,SROPER="" D ^SROP1 S SRDYNOTE=$P($G(^SRF(SROERR,31)),"^",10)
"RTN","SROERR0",11,0)
 .I SROPER["REQUESTED",'SRDYNOTE Q
"RTN","SROERR0",12,0)
 .I SROPER["CANCELLED"!(SROPER["ABORTED") S SRTYPE=3
"RTN","SROERR0",13,0)
 .I 'SRTYPE,'SRDYNOTE S SRTYPE=1
"RTN","SROERR0",14,0)
 .I 'SRTYPE,SRDYNOTE=1 S SRTYPE=2
"RTN","SROERR0",15,0)
 .I '$P($G(^SRF(SROERR,.2)),"^",10),'$P($G(^SRF(SROERR,"OP")),"^",2) D
"RTN","SROERR0",16,0)
 ..W !!,"  This Surgery case does not have a Principal CPT Code entered. The ",!,"  information sent to SPD for creation of a case cart may not contain ",!,"  enough information for processing."
"RTN","SROERR0",17,0)
 .D ST^SRSCOR(SROERR)
"RTN","SROERR0",18,0)
 D STATUS
"RTN","SROERR0",19,0)
 I '$D(SREVENT) N SREVENT S SREVENT=$S(SRSTATUS="(CANCELLED)":"S15",1:"S14")
"RTN","SROERR0",20,0)
 D MSG^SRHLZIU(SROERR,SRSTATUS,SREVENT)
"RTN","SROERR0",21,0)
 I SRSTATUS="(COMPLETED)"!(SRSTATUS="(NOT COMPLETE)")!(SRSTATUS="(ABORTED)") D MSG^SRHLOORU(SROERR,SRSTATUS,SREVENT)
"RTN","SROERR0",22,0)
 I $L($T(UPD^VPRSR)) D UPD^VPRSR(SROERR,$G(DFN),SRSTATUS) Q  ;CPRS-R
"RTN","SROERR0",23,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 D END Q
"RTN","SROERR0",24,0)
 S:'$G(ORIFN) ORIFN=$P(^SRF(SROERR,0),"^",14) I 'ORIFN K ORIFN D END Q
"RTN","SROERR0",25,0)
 S ORNP=$S($P($G(^SRF(SROERR,"NON")),"^")="Y":$P(^("NON"),"^",6),1:$P(^(.1),"^",4)),SRSOP=$P(^("OP"),"^")
"RTN","SROERR0",26,0)
 S ORTX=SRSOP_"|>> Case #"_SROERR_" "_SRSTATUS,ORSTRT=$P(^SRF(SROERR,0),"^",9)
"RTN","SROERR0",27,0)
 I DT<$E(ORSTRT,1,7) S X1=ORSTRT,X2=DT D ^%DTC S ORPURG=X+30
"RTN","SROERR0",28,0)
 D RETURN^ORX
"RTN","SROERR0",29,0)
END K SROERR
"RTN","SROERR0",30,0)
 Q
"RTN","SROERR0",31,0)
STATUS ; case status
"RTN","SROERR0",32,0)
 I $P($G(^SRF(SROERR,"NON")),"^")="Y" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=2 S SRSTATUS=$S($P($G(^(30)),"^"):"(ABORTED)",$P($G(^("NON")),"^",5):"(COMPLETED)",1:"(NOT COMPLETE)") Q
"RTN","SROERR0",33,0)
 I $P($G(^SRF(SROERR,30)),"^")'="" D CAN Q
"RTN","SROERR0",34,0)
 I $P($G(^SRF(SROERR,31)),"^",8)'="" D CAN Q
"RTN","SROERR0",35,0)
 I $P($G(^SRF(SROERR,.2)),"^",12) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=2 S SRSTATUS="(COMPLETED)" Q
"RTN","SROERR0",36,0)
 I $D(^SRF(SROERR,.2)),$P(^(.2),"^",12)="" S SRSTAT=0 D SCH I SRST=0 D REQ Q:SRST  G NO
"RTN","SROERR0",37,0)
 I '$D(^SRF(SROERR,.2)) S SRSTAT=0 D SCH I SRST=0 D REQ Q:SRST=1  G NO
"RTN","SROERR0",38,0)
 Q
"RTN","SROERR0",39,0)
NO ; not requested or scheduled
"RTN","SROERR0",40,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 S ORSTS=9
"RTN","SROERR0",41,0)
 S SRSTATUS="(NOT COMPLETE)"
"RTN","SROERR0",42,0)
 Q
"RTN","SROERR0",43,0)
CAN ; cancelled or aborted
"RTN","SROERR0",44,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 S ORSTS=1
"RTN","SROERR0",45,0)
 S SR(.2)=$G(^SRF(SROERR,.2)) I $P(SR(.2),"^")!($P(SR(.2),"^",10)) S SRSTATUS="(ABORTED)" Q
"RTN","SROERR0",46,0)
 S SRSTATUS="(CANCELLED)"
"RTN","SROERR0",47,0)
 Q
"RTN","SROERR0",48,0)
SCH ; check to see if case is scheduled
"RTN","SROERR0",49,0)
 I '$D(^SRF(SROERR,31)) S SRST=0 Q
"RTN","SROERR0",50,0)
 I $P($G(^SRF(SROERR,31)),"^",4)="" S SRST=0 Q
"RTN","SROERR0",51,0)
 I $P($G(^SRF(SROERR,31)),"^",4) D:SRSTAT=0 TIM0 D:SRSTAT=1 TIM1 S SRST=1 Q
"RTN","SROERR0",52,0)
 Q
"RTN","SROERR0",53,0)
TIM0 I '$D(^SRF(SROERR,.2)) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)" Q
"RTN","SROERR0",54,0)
 I $P(^SRF(SROERR,.2),"^",2) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=9 S SRSTATUS="(NOT COMPLETE)" Q
"RTN","SROERR0",55,0)
 I $P(^SRF(SROERR,.2),"^",2)="" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)"
"RTN","SROERR0",56,0)
 Q
"RTN","SROERR0",57,0)
TIM1 S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)" Q
"RTN","SROERR0",58,0)
REQ ; check to see if case has been requested
"RTN","SROERR0",59,0)
 I $P($G(^SRF(SROERR,"REQ")),"^")=1,'$D(^SRF(SROERR,.2)) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=5 S SRSTATUS="(REQUESTED)",SRST=1 Q
"RTN","SROERR0",60,0)
 I $P($G(^SRF(SROERR,"REQ")),"^")=1,$P($G(^(.2)),"^",2)="" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=5 S SRSTATUS="(REQUESTED)",SRST=1
"RTN","SROERR0",61,0)
 Q
"RTN","SROESNR0")
0^3^B29620281
"RTN","SROESNR0",1,0)
SROESNR0 ;BIR/ADM - NURSE REPORT E-SIG UTILITY ;02/27/04
"RTN","SROESNR0",2,0)
 ;;3.0; Surgery ;**100,129,147**;24 Jun 93
"RTN","SROESNR0",3,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROESNR0",4,0)
 ;**         controlled procedure. Local modifications to this routine
"RTN","SROESNR0",5,0)
 ;**         are prohibited.
"RTN","SROESNR0",6,0)
 ;
"RTN","SROESNR0",7,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SROESNR0",8,0)
 ;
"RTN","SROESNR0",9,0)
VIEW N SRJ,SRCAT,SRFIELD,SRFLD,SRFILE,SRLN,SRNP,SRN,SRP,SRSUB,SRW,X,Y
"RTN","SROESNR0",10,0)
 F SRJ=1:1 S SRFLD=$P($T(FIELD+SRJ),";;",2) Q:SRFLD=""  D
"RTN","SROESNR0",11,0)
 .S SRNP=$P(SRFLD,"^",3),SRN=$P(SRNP,";"),SRP=$P(SRNP,";",2)
"RTN","SROESNR0",12,0)
 .S (SRSUB,X)=$P(SRFLD,"^",2),Y=$P(X,"-",2),SRFILE=$P(Y,","),SRFIELD=$P(Y,",",2)
"RTN","SROESNR0",13,0)
 .I SRFIELD=27 Q:'$P($G(^SRF(SRTN,"TIU")),"^",6)
"RTN","SROESNR0",14,0)
 .I SRFIELD=66 Q:'$P($G(^SRF(SRTN,"TIU")),"^",7)
"RTN","SROESNR0",15,0)
 .S SRCAT=$P(SRFLD,"^") S SRCAT=$S(SRCAT="":SRFILE,1:SRCAT)
"RTN","SROESNR0",16,0)
 .S SRW=$S($P(Y,";",2)["W":1,1:0) I SRW D  Q
"RTN","SROESNR0",17,0)
 ..S ^TMP("SRNRAD"_SRS,$J,SRTN,SRCAT,SRSUB,0)=$G(^SRF(SRTN,SRN,0))
"RTN","SROESNR0",18,0)
 ..I SRS=1 S ^TMP("SRNSAVE",$J,SRTN,SRCAT,SRSUB,0)=$G(^SRF(SRTN,SRN,0))
"RTN","SROESNR0",19,0)
 ..S SRLN=0 F  S SRLN=$O(^SRF(SRTN,SRN,SRLN)) Q:'SRLN  S ^TMP("SRNRAD"_SRS,$J,SRTN,SRCAT,SRSUB,SRLN)=$G(^SRF(SRTN,SRN,SRLN,0)) I SRS=1 S ^TMP("SRNSAVE",$J,SRTN,SRCAT,SRSUB,SRLN)=$G(^SRF(SRTN,SRN,SRLN,0))
"RTN","SROESNR0",20,0)
 .S ^TMP("SRNRAD"_SRS,$J,SRTN,SRCAT,SRSUB)=$P($G(^SRF(SRTN,SRN)),"^",SRP)
"RTN","SROESNR0",21,0)
 .I SRS=1 S ^TMP("SRNSAVE",$J,SRTN,SRCAT,SRSUB)=$P($G(^SRF(SRTN,SRN)),"^",SRP)
"RTN","SROESNR0",22,0)
 Q
"RTN","SROESNR0",23,0)
REVRS ; restore before-edit data
"RTN","SROESNR0",24,0)
 N I,SRCAT,SRCNT,SRE,SRE1,SRFF,SRFIELD,SRFILE,SRFLD,SRI,SRIEN,SRJ,SRK,SRL,SRLN,SRN,SRNP,SRP,SRSUB,SRVAL,SRW,X,Y
"RTN","SROESNR0",25,0)
 F SRJ=1:1 S SRFLD=$P($T(FIELD+SRJ),";;",2) Q:SRFLD=""  D
"RTN","SROESNR0",26,0)
 .S SRNP=$P(SRFLD,"^",3),SRN=$P(SRNP,";"),SRP=$P(SRNP,";",2)
"RTN","SROESNR0",27,0)
 .S (SRSUB,X)=$P(SRFLD,"^",2),Y=$P(X,"-",2),SRFILE=$P(Y,","),SRFIELD=$P(Y,",",2)
"RTN","SROESNR0",28,0)
 .S SRCAT=$P(SRFLD,"^") S SRCAT=$S(SRCAT="":SRFILE,1:SRCAT)
"RTN","SROESNR0",29,0)
 .Q:'$D(^TMP("SRNRAD1",$J,SRTN,130,SRSUB))
"RTN","SROESNR0",30,0)
 .S SRW=$S($P(Y,";",2)["W":1,1:0) I SRW D  Q
"RTN","SROESNR0",31,0)
 ..K ^SRF(SRTN,SRN) S ^SRF(SRTN,SRN,0)=$G(^TMP("SRNSAVE",$J,SRTN,130,SRSUB,0))
"RTN","SROESNR0",32,0)
 ..S SRLN=0 F  S SRLN=$O(^TMP("SRNSAVE",$J,SRTN,130,SRSUB,SRLN)) Q:'SRLN  S ^SRF(SRTN,SRN,SRLN,0)=$G(^TMP("SRNSAVE",$J,SRTN,130,SRSUB,SRLN))
"RTN","SROESNR0",33,0)
 .S SRVAL=$G(^TMP("SRNSAVE",$J,SRTN,130,SRSUB)) I SRFIELD=27 D  Q
"RTN","SROESNR0",34,0)
 ..S $P(^SRF(SRTN,"OP"),"^",2)=SRVAL K DA,DIK S DA=SRTN,DIK="^SRF(",DIK(1)="27" D EN^DIK K DA,DIK
"RTN","SROESNR0",35,0)
 ..;Set ^TMP("CSLSUR1",$J) in order to send an update trans. via Surgery/CoreFLS interface
"RTN","SROESNR0",36,0)
 ..S ^TMP("CSLSUR1",$J)=""
"RTN","SROESNR0",37,0)
 .I SRVAL="" S SRVAL="@"
"RTN","SROESNR0",38,0)
 .K DA,DIE,DR S DA=SRTN,DIE=130,DR=SRFIELD_"////^S X=SRVAL" D ^DIE K DA,DIE,DR
"RTN","SROESNR0",39,0)
 D REVRS^SROESNRA
"RTN","SROESNR0",40,0)
 Q
"RTN","SROESNR0",41,0)
TR S SRP=SRI,SRP=$TR(SRP,"1234567890.,","ABCDEFGHIJPK")
"RTN","SROESNR0",42,0)
 Q
"RTN","SROESNR0",43,0)
FIELD ; list of fields (^field name on report-file,field^node;piece)
"RTN","SROESNR0",44,0)
KPJB ;;^Operating Room-130,.02^0;2
"RTN","SROESNR0",45,0)
KPJCE ;;^Surgical Priority-130,.035^0;10
"RTN","SROESNR0",46,0)
KPBJC ;;^Time Patient Arrived in Holding Area-130,.203^.2;15
"RTN","SROESNR0",47,0)
KPBJE ;;^Time Patient In the O.R.-130,.205^.2;10
"RTN","SROESNR0",48,0)
KPBB ;;^Time the Operation Began-130,.22^.2;2
"RTN","SROESNR0",49,0)
KPBC ;;^Time the Operation Ends-130,.23^.2;3
"RTN","SROESNR0",50,0)
KPBJF ;;^Surgeon Present Time-130,.206^.2;9
"RTN","SROESNR0",51,0)
KPBCB ;;^Time Patient Out of the O.R.-130,.232^.2;12
"RTN","SROESNR0",52,0)
KPAD ;;^Surgeon-130,.14^.1;4
"RTN","SROESNR0",53,0)
KPAE ;;^First Assistant-130,.15^.1;5
"RTN","SROESNR0",54,0)
KPAFD ;;^Attending Surgeon-130,.164^.1;13
"RTN","SROESNR0",55,0)
KPAF ;;^Second Assistant-130,.16^.1;6
"RTN","SROESNR0",56,0)
KPCA ;;^Principal Anesthetist-130,.31^.3;1
"RTN","SROESNR0",57,0)
KPCC ;;^Assistant Anesthetist-130,.33^.3;3
"RTN","SROESNR0",58,0)
KPAI ;;^Preoperative Mood-130,.19^.1;9
"RTN","SROESNR0",59,0)
KPAIF ;;^Preoperative Consciousness-130,.196^.1;15
"RTN","SROESNR0",60,0)
KPJG ;;^Preoperative Skin Integrity-130,.07^0;7
"RTN","SROESNR0",61,0)
KPAIE ;;^Preoperative Conversation-130,.195^.1;14
"RTN","SROESNR0",62,0)
KPFI ;;^Person Confirming ID Band and Valid Consent-130,.69^.6;9
"RTN","SROESNR0",63,0)
KGA ;;^Time Out Verification Completed (Y/N)-130,71^VER;3
"RTN","SROESNR0",64,0)
KGB ;;^Preoperative Imaging Confirmed-130,72^VER;4
"RTN","SROESNR0",65,0)
KGC ;;^Mark on Surgical Site Confirmed-130,73^VER;5
"RTN","SROESNR0",66,0)
KGD ;;^Correct Surgery Comments-130,74;W^74;0
"RTN","SROESNR0",67,0)
KHB ;;^Time Out Verified Comments-130,82;W^82;0
"RTN","SROESNR0",68,0)
KHC ;;^Imaging Confirmed Comments-130,83;W^83;0
"RTN","SROESNR0",69,0)
KHD ;;^Marked Site Comments-130,84;W^84;0
"RTN","SROESNR0",70,0)
KPAH ;;^Skin Prepped By-130,.18^.1;8
"RTN","SROESNR0",71,0)
KPAGE ;;^Skin Preparation Agent-130,.175^.1;7
"RTN","SROESNR0",72,0)
KD ;;^Skin Prepped By (2)-130,4^.1;12
"RTN","SROESNR0",73,0)
KH ;;^Second Skin Preparation Agent-130,8^31;2
"RTN","SROESNR0",74,0)
KPAB ;;^Preoperative Hair Clipping By-130,.12^.1;2
"RTN","SROESNR0",75,0)
KPGE ;;^Electrocautery Unit-130,.75^.7;5
"RTN","SROESNR0",76,0)
KPEE ;;^Electroground Placement-130,.55^.5;4
"RTN","SROESNR0",77,0)
KF ;;^Electroground Position (2)-130,6^.5;13
"RTN","SROESNR0",78,0)
KEG ;;^ESU Coagulation Range-130,57^.7;1
"RTN","SROESNR0",79,0)
KEGC ;;^ESU Cutting Range-130,58^.7;2
"RTN","SROESNR0",80,0)
KPJC ;;^Major or Minor-130,.03^0;3
"RTN","SROESNR0",81,0)
KBF ;;^Principal Procedure-130,26^OP;1
"RTN","SROESNR0",82,0)
KBG ;;^Principal CPT Code-130,27^OP;2
"RTN","SROESNR0",83,0)
KFF ;;^Principal Diagnosis Code-130,66^34;2
"RTN","SROESNR0",84,0)
KBB ;;^Tubes and Drains-130,22^3;1
"RTN","SROESNR0",85,0)
KDD ;;^Final Sponge Count Correct (Y/N)-130,44^25;1
"RTN","SROESNR0",86,0)
KDE ;;^Final Sharps Count Correct (Y/N)-130,45^25;2
"RTN","SROESNR0",87,0)
KDF ;;^Final Instrument Count Correct (Y/N)-130,46^25;3
"RTN","SROESNR0",88,0)
KDG ;;^Person Responsible for Final Counts-130,47^25;4
"RTN","SROESNR0",89,0)
KDH ;;^Count Verifier-130,48^25;5
"RTN","SROESNR0",90,0)
KDA ;;^Dressing(s)-130,41^35;1
"RTN","SROESNR0",91,0)
KPHGE ;;^Packing Type-130,.875^.8;11
"RTN","SROESNR0",92,0)
KPBE ;;^Intraoperative Blood Loss (ml)-130,.25^.2;5
"RTN","SROESNR0",93,0)
KPBEE ;;^Total Urine Output (ml)-130,.255^.2;16
"RTN","SROESNR0",94,0)
KPHA ;;^Postoperative Mood-130,.81^.8;1
"RTN","SROESNR0",95,0)
KPHBA ;;^Postoperative Consciousness-130,.821^.8;10
"RTN","SROESNR0",96,0)
KPGF ;;^Postoperative Skin Integrity-130,.76^.7;6
"RTN","SROESNR0",97,0)
KPGG ;;^Postoperative Skin Color-130,.77^.7;7
"RTN","SROESNR0",98,0)
KABH ;;^Type of Laser-130,128^.7;8
"RTN","SROESNR0",99,0)
KABG ;;^Sequential Compression Device (Y/N)-130,127^.7;3
"RTN","SROESNR0",100,0)
KAPJI ;;^Wound Classification-130,1.09^1.0;8
"RTN","SROESNR0",101,0)
KPDF ;;^Postoperative Disposition-130,.46^.4;6
"RTN","SROESNR0",102,0)
KBE ;;^Patient Discharged Via-130,25^.7;4
"RTN","SROESNR0",103,0)
KACA ;;^Device(s)-130,131^46;1
"RTN","SROESNR0",104,0)
KDI ;;^Specimens-130,49;W^9;0
"RTN","SROESNR0",105,0)
KFD ;;^Cultures-130,64;W^41;0
"RTN","SROESNR0",106,0)
KPBI ;;^Nursing Care Comments-130,.29;W^7;0
"RTN","SRONRPT0")
0^4^B48530067
"RTN","SRONRPT0",1,0)
SRONRPT0 ;BIR/ADM - NURSE INTRAOP REPORT ;02/27/04
"RTN","SRONRPT0",2,0)
 ;;3.0; Surgery ;**100,129,147**;24 Jun 93
"RTN","SRONRPT0",3,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SRONRPT0",4,0)
 ;**         controlled procedure. Local modifications to this routine
"RTN","SRONRPT0",5,0)
 ;**         are prohibited.
"RTN","SRONRPT0",6,0)
 ;
"RTN","SRONRPT0",7,0)
 D LINE(2) S @SRG@(SRI)="OR Support Personnel:" D LINE(1) S @SRG@(SRI)="  Scrubbed",@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"Circulating" D NURSE
"RTN","SRONRPT0",8,0)
 S SRLF=1,SRLINE="Other Persons in OR: " I '$O(^SRF(SRTN,32,0)),SRALL D LINE(1) S @SRG@(SRI)=SRLINE_"N/A"
"RTN","SRONRPT0",9,0)
 I $O(^SRF(SRTN,32,0)) D LINE(1) S @SRG@(SRI)=SRLINE D
"RTN","SRONRPT0",10,0)
 .S OTH=0 F  S OTH=$O(^SRF(SRTN,32,OTH)) Q:'OTH  D
"RTN","SRONRPT0",11,0)
 ..S X=^SRF(SRTN,32,OTH,0),SRLINE="  "_$P(X,"^")
"RTN","SRONRPT0",12,0)
 ..S Y=$P(X,"^",2) S:Y'="" SRLINE=SRLINE_" ("_Y_")"
"RTN","SRONRPT0",13,0)
 ..D LINE(1) S @SRG@(SRI)=SRLINE
"RTN","SRONRPT0",14,0)
 S SRLF=1
"RTN","SRONRPT0",15,0)
 S X=$P(SR(.1),"^",9),SRMOOD=$S(X:$E($P(^SRO(135.3,X,0),"^"),1,20),1:"N/A")
"RTN","SRONRPT0",16,0)
 S X=$P(SR(.1),"^",15),SRCONS=$S(X:$E($P(^SRO(135.4,X,0),"^"),1,24),1:"N/A")
"RTN","SRONRPT0",17,0)
 S X=$P(SR(0),"^",7),SRSKIN=$S(X:$E($P(^SRO(135.2,X,0),"^"),1,20),1:"N/A")
"RTN","SRONRPT0",18,0)
 S Y=$P(SR(.1),"^",14),C=$P(^DD(130,.195,0),"^",2) D:Y'="" Y^DIQ S SRCONV=$S(Y'="":Y,1:"N/A")
"RTN","SRONRPT0",19,0)
 I 'SRALL,SRMOOD="N/A",SRCONS="N/A" G SKIN
"RTN","SRONRPT0",20,0)
 D LINE(1) S @SRG@(SRI)="Preop Mood:",@SRG@(SRI)=@SRG@(SRI)_$$SPACE(18)_SRMOOD,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"Preop Consc:",@SRG@(SRI)=@SRG@(SRI)_$$SPACE(56)_SRCONS
"RTN","SRONRPT0",21,0)
SKIN I 'SRALL,SRSKIN="N/A",SRCONV="N/A" G VAL
"RTN","SRONRPT0",22,0)
 D LINE(1) S @SRG@(SRI)="Preop Skin Integ: "_SRSKIN,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"Preop Converse: "_SRCONV
"RTN","SRONRPT0",23,0)
VAL S SRLF=1,Y=$P(SR(.6),"^",9),C=$P(^DD(130,.69,0),"^",2) D:Y'="" Y^DIQ S SRUSER=$S(Y="":"N/A",1:Y)
"RTN","SRONRPT0",24,0)
 I 'SRALL,SRUSER="N/A" G VER
"RTN","SRONRPT0",25,0)
 D LINE(1) S @SRG@(SRI)="Valid Consent/ID Band Confirmed By: "_SRUSER
"RTN","SRONRPT0",26,0)
 ;
"RTN","SRONRPT0",27,0)
VER N II,SROIM,SROUT,SROIN
"RTN","SRONRPT0",28,0)
 S Y=$P(SR("VER"),"^",5),SROIN=$S(Y="Y":"YES",Y="M":"MARKING NOT REQUIRED FOR THIS PROCEDURE",Y="N":"NO - MARKING REQUIRED BUT NOT DONE (see CORRECT SURGERY COMMENTS)",1:"* NOT ENTERED *")
"RTN","SRONRPT0",29,0)
 D LINE(1) S @SRG@(SRI)="Mark on Surgical Site Confirmed: "_$S($L(SROIN)>43:"",1:SROIN)
"RTN","SRONRPT0",30,0)
 I $L(SROIN)>43 D LINE(1) S @SRG@(SRI)=$$SPACE(2)_SROIN
"RTN","SRONRPT0",31,0)
 S II=84 D ENSC,LINE(1)
"RTN","SRONRPT0",32,0)
 S Y=$P(SR("VER"),"^",4),SROIM=$S(Y="Y":"YES",Y="I":"IMAGING NOT REQUIRED FOR THIS PROCEDURE",Y="N":"IMAGING REQUIRED BUT NOT VIEWED (see CORRECT SURGERY COMMENTS)",1:"* NOT ENTERED *")
"RTN","SRONRPT0",33,0)
 D LINE(1) S @SRG@(SRI)="Preoperative Imaging Confirmed:  "_$S($L(SROIM)>43:"",1:SROIM)
"RTN","SRONRPT0",34,0)
 I $L(SROIM)>43 D LINE(1) S @SRG@(SRI)=$$SPACE(2)_SROIM
"RTN","SRONRPT0",35,0)
 S II=83 D ENSC,LINE(1)
"RTN","SRONRPT0",36,0)
 S Y=$P(SR("VER"),"^",3),SROUT=$S(Y="Y":"YES",Y="N":"NO (see SEE CORRECT SURGERY COMMENTS)",1:"* NOT ENTERED *")
"RTN","SRONRPT0",37,0)
 D LINE(1) S @SRG@(SRI)="Time Out Verification Completed: "_$S($L(SROUT)>43:"",1:SROUT)
"RTN","SRONRPT0",38,0)
 S II=82 D ENSC
"RTN","SRONRPT0",39,0)
 S SRLF=1
"RTN","SRONRPT0",40,0)
 ;
"RTN","SRONRPT0",41,0)
PREP S Y=$P(SR(.1),"^",8),C=$P(^DD(130,.18,0),"^",2) D:Y'="" Y^DIQ,N(25) S SRUSER=$S(Y="":"N/A",1:Y)
"RTN","SRONRPT0",42,0)
 S Y=$P(SR(.1),"^",7),C=$P(^DD(130,.175,0),"^",2) D:Y'="" Y^DIQ S SRAGNT=$S(Y="":"N/A",1:$E(Y,1,22))
"RTN","SRONRPT0",43,0)
 I 'SRALL,SRUSER="N/A",SRAGNT="N/A" G PREP2
"RTN","SRONRPT0",44,0)
 D LINE(1) S @SRG@(SRI)="Skin Prep By: "_SRUSER,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"Skin Prep Agent: "_SRAGNT
"RTN","SRONRPT0",45,0)
PREP2 S Y=$P(SR(.1),"^",12),C=$P(^DD(130,4,0),"^",2) D:Y'="" Y^DIQ,N(21) S SRUSER=$S(Y="":"N/A",1:Y)
"RTN","SRONRPT0",46,0)
 S Y=$P(SR(31),"^",2),C=$P(^DD(130,8,0),"^",2) D:Y'="" Y^DIQ S SRAGNT=$S(Y="":"N/A",1:$E(Y,1,18))
"RTN","SRONRPT0",47,0)
 I 'SRALL,SRUSER="N/A",SRAGNT="N/A" G PREOP
"RTN","SRONRPT0",48,0)
 D LINE(1) S @SRG@(SRI)="Skin Prep By (2): "_SRUSER,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"2nd Skin Prep Agent: "_SRAGNT
"RTN","SRONRPT0",49,0)
PREOP S Y=$P(SR(.1),"^",2),C=$P(^DD(130,.12,0),"^",2) D:Y'="" Y^DIQ S SRUSER=$S(Y="":"N/A",1:Y) I 'SRALL,SRUSER="N/A" G POS
"RTN","SRONRPT0",50,0)
 D LINE(1) S @SRG@(SRI)="Preop Hair Clipping By: "_SRUSER
"RTN","SRONRPT0",51,0)
POS S SRLF=1,SRLINE="Surgery Position(s): " I '$O(^SRF(SRTN,42,0)),SRALL D LINE(1) S @SRG@(SRI)=SRLINE_"N/A"
"RTN","SRONRPT0",52,0)
 I $O(^SRF(SRTN,42,0)) D LINE(1) S @SRG@(SRI)=SRLINE D
"RTN","SRONRPT0",53,0)
 .S SRP=0 F  S SRP=$O(^SRF(SRTN,42,SRP)) Q:'SRP  S X=^SRF(SRTN,42,SRP,0),Z=$P(X,"^"),Y=$P(X,"^",2) D
"RTN","SRONRPT0",54,0)
 ..S SRPOS=$P(^SRO(132,Z,0),"^") D:Y D^DIQ S SRTIME=$S(Y'="":$P(Y,"@")_"  "_$P(Y,"@",2),1:"N/A")
"RTN","SRONRPT0",55,0)
 ..D LINE(1) S @SRG@(SRI)="  "_SRPOS,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_"Placed: "_SRTIME
"RTN","SRONRPT0",56,0)
 S SRLF=1,SRLINE="Restraints and Position Aids: "
"RTN","SRONRPT0",57,0)
 I '$O(^SRF(SRTN,20,0)),SRALL D LINE(1) S @SRG@(SRI)=SRLINE_"N/A"
"RTN","SRONRPT0",58,0)
 I $O(^SRF(SRTN,20,0)) N SRRP D LINE(1) S @SRG@(SRI)=SRLINE,(SRRP,CNT)=0 F  S SRRP=$O(^SRF(SRTN,20,SRRP)) Q:'SRRP  S CNT=CNT+1,X=^SRF(SRTN,20,SRRP,0),Z=$P(X,"^"),Y=$P(X,"^",2),W=$P(X,"^",3) D
"RTN","SRONRPT0",59,0)
 .S SREST=$P(^SRO(132.05,Z,0),"^"),C=$P(^DD(130.31,1,0),"^",2) D:Y'="" Y^DIQ,N(31) S:Y="" Y="N/A"
"RTN","SRONRPT0",60,0)
 .D LINE(1) S @SRG@(SRI)="  "_SREST,@SRG@(SRI)=@SRG@(SRI)_$$SPACE(36)_"Applied By: "_Y
"RTN","SRONRPT0",61,0)
 .I W'="" D LINE(1) S @SRG@(SRI)="      Comments: "_W
"RTN","SRONRPT0",62,0)
 S SRLF=1,X=$P(SR(.7),"^",5),SREL=$S(X'="":X,1:"N/A")
"RTN","SRONRPT0",63,0)
 S X=$P(SR(.5),"^",4),SRELP=$S(X:$P(^SRO(138,X,0),"^"),1:"N/A")
"RTN","SRONRPT0",64,0)
 S X=$P(SR(.5),"^",13),SRELP2=$S(X:$P(^SRO(138,X,0),"^"),1:"")
"RTN","SRONRPT0",65,0)
 S X=$P(SR(.7),"^"),SRC=$S(X'="":X,1:"N/A"),X=$P(SR(.7),"^",2),SRCT=$S(X'="":X,1:"N/A")
"RTN","SRONRPT0",66,0)
 I 'SRALL,SREL="N/A",SRELP="N/A",SRELP2="" G LAB
"RTN","SRONRPT0",67,0)
 D LINE(1) S @SRG@(SRI)="Electrocautery Unit:       "_SREL
"RTN","SRONRPT0",68,0)
 D LINE(1) S @SRG@(SRI)="ESU Coagulation Range:     "_SRC
"RTN","SRONRPT0",69,0)
 D LINE(1) S @SRG@(SRI)="ESU Cutting Range:         "_SRCT
"RTN","SRONRPT0",70,0)
 D LINE(1) S @SRG@(SRI)="Electroground Position(s): "_SRELP
"RTN","SRONRPT0",71,0)
 I SRELP2'="" D LINE(1) S @SRG@(SRI)=$$SPACE(27)_SRELP2
"RTN","SRONRPT0",72,0)
LAB S SRLF=1 I $O(^SRF(SRTN,9,0))!SRALL D LAB1
"RTN","SRONRPT0",73,0)
 S SRLF=1 I $O(^SRF(SRTN,6,0)) D LINE(1) S @SRG@(SRI)="Anesthesia Technique(s):" S ANE=0 F  S ANE=$O(^SRF(SRTN,6,ANE)) Q:'ANE  D ANE
"RTN","SRONRPT0",74,0)
 I '$O(^SRF(SRTN,6,0)),SRALL D LINE(1) S @SRG@(SRI)="Anesthesia Technique(s): N/A"
"RTN","SRONRPT0",75,0)
 D ^SRONRPT1
"RTN","SRONRPT0",76,0)
 Q
"RTN","SRONRPT0",77,0)
NURSE ; nurse info
"RTN","SRONRPT0",78,0)
 N CNT,CIRC,I,NURSE,SCRU,X,Y,Z
"RTN","SRONRPT0",79,0)
 S (CNT,CIRC)=0 F  S CIRC=$O(^SRF(SRTN,19,CIRC)) Q:'CIRC  S CNT=CNT+1 D
"RTN","SRONRPT0",80,0)
 .S Z=^SRF(SRTN,19,CIRC,0),Y=$P(Z,"^"),C=$P(^DD(130.28,.01,0),"^",2) D Y^DIQ,N(21) S SRX=Y
"RTN","SRONRPT0",81,0)
 .S Y=$P(Z,"^",3),C=$P(^DD(130.28,3,0),"^",2) D:Y'="" Y^DIQ S CIRC(CNT)=SRX_" ("_Y_")"
"RTN","SRONRPT0",82,0)
 S (CNT,SCRU)=0 F  S SCRU=$O(^SRF(SRTN,23,SCRU)) Q:'SCRU  S CNT=CNT+1 D
"RTN","SRONRPT0",83,0)
 .S Z=^SRF(SRTN,23,SCRU,0),Y=$P(Z,"^"),C=$P(^DD(130.36,.01,0),"^",2) D Y^DIQ,N(21) S SRX=Y
"RTN","SRONRPT0",84,0)
 .S Y=$P(Z,"^",3),C=$P(^DD(130.36,3,0),"^",2) D:Y'="" Y^DIQ S SCRU(CNT)=SRX_" ("_Y_")"
"RTN","SRONRPT0",85,0)
 S:'$D(SCRU(1)) SCRU(1)="N/A" S:'$D(CIRC(1)) CIRC(1)="N/A"
"RTN","SRONRPT0",86,0)
 F I=1:1 Q:('$D(SCRU(I))&'$D(CIRC(I)))  S NURSE(I)=$S($D(SCRU(I)):SCRU(I),1:"")_"^"_$S($D(CIRC(I)):CIRC(I),1:"")
"RTN","SRONRPT0",87,0)
 S I=0 F  S I=$O(NURSE(I)) Q:'I  D LINE(1) S @SRG@(SRI)=$$SPACE(2)_$P(NURSE(I),"^") S @SRG@(SRI)=@SRG@(SRI)_$$SPACE(40)_$P(NURSE(I),"^",2)
"RTN","SRONRPT0",88,0)
 Q
"RTN","SRONRPT0",89,0)
LAB1 N SRSP S SRLF=1 D LINE(1) S @SRG@(SRI)="Material Sent to Laboratory for Analysis: "
"RTN","SRONRPT0",90,0)
 I 'SRALL,'$O(^SRF(SRTN,9,0)),'$O(^SRF(SRTN,41,0)) S @SRG@(SRI)=@SRG@(SRI)_"N/A" Q
"RTN","SRONRPT0",91,0)
 D LINE(1) S @SRG@(SRI)="Specimens: " D
"RTN","SRONRPT0",92,0)
 .I '$O(^SRF(SRTN,9,0)) S @SRG@(SRI)=@SRG@(SRI)_"N/A" Q
"RTN","SRONRPT0",93,0)
 .S SRSP=0 F  S SRSP=$O(^SRF(SRTN,9,SRSP)) Q:'SRSP  D LINE(1) S @SRG@(SRI)=$$SPACE(2)_^SRF(SRTN,9,SRSP,0)
"RTN","SRONRPT0",94,0)
 D LINE(1) S @SRG@(SRI)="Cultures:  " D
"RTN","SRONRPT0",95,0)
 .I '$O(^SRF(SRTN,41,0)) S @SRG@(SRI)=@SRG@(SRI)_"N/A" Q
"RTN","SRONRPT0",96,0)
 .S SRSP=0 F  S SRSP=$O(^SRF(SRTN,41,SRSP)) Q:'SRSP  D LINE(1) S @SRG@(SRI)=$$SPACE(2)_^SRF(SRTN,41,SRSP,0)
"RTN","SRONRPT0",97,0)
 Q
"RTN","SRONRPT0",98,0)
N(SRL) N SRN I $L(Y)>SRL S SRN=$P(Y,",")_","_$E($P(Y,",",2))_".",Y=SRN
"RTN","SRONRPT0",99,0)
 Q
"RTN","SRONRPT0",100,0)
SPACE(NUM) ; create spaces
"RTN","SRONRPT0",101,0)
 ;pass in position returns number of needed spaces
"RTN","SRONRPT0",102,0)
 I '$D(@SRG@(SRI)) S @SRG@(SRI)=""
"RTN","SRONRPT0",103,0)
 Q $J("",NUM-$L(@SRG@(SRI)))
"RTN","SRONRPT0",104,0)
LINE(NUM) ; create carriage returns
"RTN","SRONRPT0",105,0)
 I $G(SRLF) S NUM=NUM+1,SRLF=0
"RTN","SRONRPT0",106,0)
 F J=1:1:NUM S SRI=SRI+1,@SRG@(SRI)=""
"RTN","SRONRPT0",107,0)
 Q
"RTN","SRONRPT0",108,0)
ANE ; print anesthesia technique
"RTN","SRONRPT0",109,0)
 N A,AGNT,C,CNT,DRUG
"RTN","SRONRPT0",110,0)
 S A=^SRF(SRTN,6,ANE,0),Y=$P(A,"^"),C=$P(^DD(130.06,.01,0),"^",2) D:Y'="" Y^DIQ D LINE(1) S Y=Y_$S($P(A,"^",3)="Y":"  (PRINCIPAL)",1:""),@SRG@(SRI)=$$SPACE(2)_Y
"RTN","SRONRPT0",111,0)
 Q
"RTN","SRONRPT0",112,0)
ENSC N X,SRLINE
"RTN","SRONRPT0",113,0)
 D LINE(1) S @SRG@(SRI)="  "_$S(II=82:"Time Out Verified Comments: ",II=83:"Imaging Confirmed Comments: ",II=84:"Marked Site Comments: ",1:"") D
"RTN","SRONRPT0",114,0)
 .I '$O(^SRF(SRTN,II,0)) S @SRG@(SRI)=@SRG@(SRI)_"NO COMMENTS ENTERED" Q
"RTN","SRONRPT0",115,0)
 .S SRLINE=0 F  S SRLINE=$O(^SRF(SRTN,II,SRLINE)) Q:'SRLINE  S X=^SRF(SRTN,II,SRLINE,0) D COMM^SRONRPT3(X,3)
"RTN","SRONRPT0",116,0)
 Q
"VER")
8.0^22.0
"^DD",130,130,.12,0)
PREOP HAIR CLIPPING BY^*P200'^VA(200,^.1;2^S DIC("S")="S RESTRICT=""130,.12"" D KEY^SROXPR I $D(SROK)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",130,130,.12,.1)
Preoperative Hair Clipping By
"^DD",130,130,.12,3)
If the patient had hair clipped for the procedure, enter the name of the person responsible for clipping the patient's hair. This field may be restricted based on locally defined keys.
"^DD",130,130,.12,12)
This field may be restricted based on locally defined keys.
"^DD",130,130,.12,12.1)
S DIC("S")="S RESTRICT=""130,.12"" D KEY^SROXPR I $D(SROK)"
"^DD",130,130,.12,21,0)
^^2^2^3050815^
"^DD",130,130,.12,21,1,0)
This is the person responsible for clipping the patient's hair in 
"^DD",130,130,.12,21,2,0)
preparation for the operative procedure (if necessary).
"^DD",130,130,.12,"DT")
3050824
"BLD",5478,6)
^SEQ #139
**END**
**END**
