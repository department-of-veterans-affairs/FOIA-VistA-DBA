Released IB*2*214 SEQ #197
Extracted from mail message
**KIDS**:IB*2.0*214^

**INSTALL NAME**
IB*2.0*214
"BLD",4093,0)
IB*2.0*214^INTEGRATED BILLING^0^3030606^y
"BLD",4093,1,0)
^^1^1^3030411^
"BLD",4093,1,1,0)
REMOTE INSURANCE QUERY 
"BLD",4093,4,0)
^9.64PA^355.34^1
"BLD",4093,4,355.34,0)
355.34
"BLD",4093,4,355.34,222)
y^y^f^^^^n
"BLD",4093,4,"B",355.34,355.34)

"BLD",4093,"KRN",0)
^9.67PA^8989.52^19
"BLD",4093,"KRN",.4,0)
.4
"BLD",4093,"KRN",.401,0)
.401
"BLD",4093,"KRN",.402,0)
.402
"BLD",4093,"KRN",.403,0)
.403
"BLD",4093,"KRN",.5,0)
.5
"BLD",4093,"KRN",.84,0)
.84
"BLD",4093,"KRN",3.6,0)
3.6
"BLD",4093,"KRN",3.8,0)
3.8
"BLD",4093,"KRN",9.2,0)
9.2
"BLD",4093,"KRN",9.8,0)
9.8
"BLD",4093,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4093,"KRN",9.8,"NM",1,0)
IBCNRDV^^0^B75144503
"BLD",4093,"KRN",9.8,"NM",2,0)
IBTRKR2^^0^B4858987
"BLD",4093,"KRN",9.8,"NM",3,0)
IBTRKR^^0^B36589425
"BLD",4093,"KRN",9.8,"NM","B","IBCNRDV",1)

"BLD",4093,"KRN",9.8,"NM","B","IBTRKR",3)

"BLD",4093,"KRN",9.8,"NM","B","IBTRKR2",2)

"BLD",4093,"KRN",19,0)
19
"BLD",4093,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4093,"KRN",19,"NM",1,0)
IBCN REMOTE INSURANCE QUERY^^0
"BLD",4093,"KRN",19,"NM",2,0)
IBCN INSURANCE MGMT MENU^^2
"BLD",4093,"KRN",19,"NM","B","IBCN INSURANCE MGMT MENU",2)

"BLD",4093,"KRN",19,"NM","B","IBCN REMOTE INSURANCE QUERY",1)

"BLD",4093,"KRN",19.1,0)
19.1
"BLD",4093,"KRN",101,0)
101
"BLD",4093,"KRN",409.61,0)
409.61
"BLD",4093,"KRN",771,0)
771
"BLD",4093,"KRN",870,0)
870
"BLD",4093,"KRN",8989.51,0)
8989.51
"BLD",4093,"KRN",8989.52,0)
8989.52
"BLD",4093,"KRN",8994,0)
8994
"BLD",4093,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",4093,"KRN",8994,"NM",1,0)
IBCN INSURANCE QUERY^^0
"BLD",4093,"KRN",8994,"NM",2,0)
IBCN INSURANCE QUERY TASK^^0
"BLD",4093,"KRN",8994,"NM","B","IBCN INSURANCE QUERY",1)

"BLD",4093,"KRN",8994,"NM","B","IBCN INSURANCE QUERY TASK",2)

"BLD",4093,"KRN","B",.4,.4)

"BLD",4093,"KRN","B",.401,.401)

"BLD",4093,"KRN","B",.402,.402)

"BLD",4093,"KRN","B",.403,.403)

"BLD",4093,"KRN","B",.5,.5)

"BLD",4093,"KRN","B",.84,.84)

"BLD",4093,"KRN","B",3.6,3.6)

"BLD",4093,"KRN","B",3.8,3.8)

"BLD",4093,"KRN","B",9.2,9.2)

"BLD",4093,"KRN","B",9.8,9.8)

"BLD",4093,"KRN","B",19,19)

"BLD",4093,"KRN","B",19.1,19.1)

"BLD",4093,"KRN","B",101,101)

"BLD",4093,"KRN","B",409.61,409.61)

"BLD",4093,"KRN","B",771,771)

"BLD",4093,"KRN","B",870,870)

"BLD",4093,"KRN","B",8989.51,8989.51)

"BLD",4093,"KRN","B",8989.52,8989.52)

"BLD",4093,"KRN","B",8994,8994)

"BLD",4093,"QUES",0)
^9.62^^
"BLD",4093,"REQB",0)
^9.611^1^1
"BLD",4093,"REQB",1,0)
IB*2.0*62^2
"BLD",4093,"REQB","B","IB*2.0*62",1)

"FIA",355.34)
INSURANCE REMOTE QUERY RESULTS
"FIA",355.34,0)
^IBA(355.34,
"FIA",355.34,0,0)
355.34D
"FIA",355.34,0,1)
y^y^f^^^^n
"FIA",355.34,0,10)

"FIA",355.34,0,11)

"FIA",355.34,0,"RLRO")

"FIA",355.34,0,"VR")
2.0^IB
"FIA",355.34,355.34)
0
"KRN",19,2921346,-1)
2^2
"KRN",19,2921346,0)
IBCN INSURANCE MGMT MENU^Patient Insurance Menu^^M^10869^^^^^^^
"KRN",19,2921346,10,0)
^19.01IP^22^17
"KRN",19,2921346,10,21,0)
2927671^RQI
"KRN",19,2921346,10,21,"^")
IBCN REMOTE INSURANCE QUERY
"KRN",19,2921346,"U")
PATIENT INSURANCE MENU
"KRN",19,2927671,-1)
0^1
"KRN",19,2927671,0)
IBCN REMOTE INSURANCE QUERY^Remote Insurance Query^^R^^^^^^^^
"KRN",19,2927671,1,0)
^19.06^2^2^3030327^^
"KRN",19,2927671,1,1,0)
This option will perform a query on the selected patient for insurance 
"KRN",19,2927671,1,2,0)
information at remote VA sites.
"KRN",19,2927671,25)
IBCNRDV
"KRN",19,2927671,"U")
REMOTE INSURANCE QUERY
"KRN",8994,1356,-1)
0^1
"KRN",8994,1356,0)
IBCN INSURANCE QUERY^RPC^IBCNRDV^2^P
"KRN",8994,1356,1,0)
^8994.01^1^1^3030414^^^^
"KRN",8994,1356,1,1,0)
This does a remote query on the insurance information.
"KRN",8994,1356,2,0)
^8994.02A^1^1
"KRN",8994,1356,2,1,0)
IBICN^1^50^1^1
"KRN",8994,1356,2,1,1,0)
^8994.021^1^1^3030414^^^^
"KRN",8994,1356,2,1,1,1,0)
This is the patient's ICN.
"KRN",8994,1356,2,"B","IBICN",1)

"KRN",8994,1356,2,"PARAMSEQ",1,1)

"KRN",8994,1356,3,0)
^8994.03^10^10^3030414^^^^
"KRN",8994,1356,3,1,0)
The return is in the following format:
"KRN",8994,1356,3,2,0)
 
"KRN",8994,1356,3,3,0)
         -- output var(0)   =: number of entries insurance multiple
"KRN",8994,1356,3,4,0)
                   var(x,0) =: ^dpt(dfn,.312,x,0)
"KRN",8994,1356,3,5,0)
                   var(x,1) =: ^dpt(dfn,.312,x,1)
"KRN",8994,1356,3,6,0)
                   var(x,2) =: ^dpt(dfn,.312,x,2)
"KRN",8994,1356,3,7,0)
                   var(x,3) =: ^dpt(dfn,.312,x,3)
"KRN",8994,1356,3,8,0)
                   var(x,4) =: ^dpt(dfn,.312,x,4)
"KRN",8994,1356,3,9,0)
               var(x,355.3) =: ^iba(355.3,$p(var(x,0),"^",18),0)
"KRN",8994,1356,3,10,0)
               var("S",COB sequence,x) =: (null) as an xref for COB
"KRN",8994,1357,-1)
0^2
"KRN",8994,1357,0)
IBCN INSURANCE QUERY TASK^RPC^IBCNRDV^2^P^^^^^1
"KRN",8994,1357,1,0)
^8994.01^2^2^3030414^^^
"KRN",8994,1357,1,1,0)
This does a remote query on the insurance information. This is the one 
"KRN",8994,1357,1,2,0)
that used during tasked jobs to avoid user data exchange.
"KRN",8994,1357,2,0)
^8994.02A^1^1
"KRN",8994,1357,2,1,0)
IBICN^1^50^1
"KRN",8994,1357,2,1,1,0)
^8994.021^1^1^3030414^^^^
"KRN",8994,1357,2,1,1,1,0)
This is the patient's ICN.
"KRN",8994,1357,2,"B","IBICN",1)

"KRN",8994,1357,3,0)
^8994.03^10^10^3030414^^^^
"KRN",8994,1357,3,1,0)
The return is in the following format:
"KRN",8994,1357,3,2,0)
 
"KRN",8994,1357,3,3,0)
         -- output var(0)   =: number of entries insurance multiple
"KRN",8994,1357,3,4,0)
                   var(x,0) =: ^dpt(dfn,.312,x,0)
"KRN",8994,1357,3,5,0)
                   var(x,1) =: ^dpt(dfn,.312,x,1)
"KRN",8994,1357,3,6,0)
                   var(x,2) =: ^dpt(dfn,.312,x,2)
"KRN",8994,1357,3,7,0)
                   var(x,3) =: ^dpt(dfn,.312,x,3)
"KRN",8994,1357,3,8,0)
                   var(x,4) =: ^dpt(dfn,.312,x,4)
"KRN",8994,1357,3,9,0)
               var(x,355.3) =: ^iba(355.3,$p(var(x,0),"^",18),0)
"KRN",8994,1357,3,10,0)
               var("S",COB sequence,x) =: (null) as an xref for COB
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",202,-1)
1^1
"PKG",202,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",202,20,0)
^9.402P^1^1
"PKG",202,20,1,0)
2^^IBAXDR
"PKG",202,20,1,1)

"PKG",202,20,"B",2,1)

"PKG",202,22,0)
^9.49I^1^1
"PKG",202,22,1,0)
2.0^2940321^2940321
"PKG",202,22,1,"PAH",1,0)
214^3030606
"PKG",202,22,1,"PAH",1,1,0)
^^1^1^3030606
"PKG",202,22,1,"PAH",1,1,1,0)
REMOTE INSURANCE QUERY 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBCNRDV")
0^1^B75144503
"RTN","IBCNRDV",1,0)
IBCNRDV ;OAKFO/ELZ - INSURANCE INFORMATION EXCHANGE VIA RDV;27-MAR-03
"RTN","IBCNRDV",2,0)
 ;;2.0;INTEGRATED BILLING;**214**;21-MAR-94
"RTN","IBCNRDV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRDV",4,0)
 ;
"RTN","IBCNRDV",5,0)
 ; This routine is used to exchange insurance information between
"RTN","IBCNRDV",6,0)
 ; facilities.
"RTN","IBCNRDV",7,0)
OPT ; Menu option entry point.  This is used to select a patient to request
"RTN","IBCNRDV",8,0)
 ; information about from the remote treating facilities.
"RTN","IBCNRDV",9,0)
 N DFN,DIC,X,Y,DTOUT,DUOUT,IBT,%,%Y,IBX,VADM,IBB,IBD,IBH,IBI,IBICN,IBR,IBRZ,IBX,IBY,IBZ,IBWAIT,IBL,DO
"RTN","IBCNRDV",10,0)
 ; prompt for patient
"RTN","IBCNRDV",11,0)
AGAIN S DIC="^DPT(",DIC(0)="AEMNQ" D ^DIC Q:Y<1  S DFN=+Y
"RTN","IBCNRDV",12,0)
 ; look up treating facilities
"RTN","IBCNRDV",13,0)
 K IBT S IBT=$$TFL^IBARXMU(DFN,.IBT) I IBT<1 W !!,"This patient has no remote treating facilities to query." G AGAIN
"RTN","IBCNRDV",14,0)
 ; display and verify we want to do this
"RTN","IBCNRDV",15,0)
 D DEM^VADPT W !!,"The patient ",VADM(1)," has the following ",IBT," remote facilitie(s)",! S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  W !?10,$P(IBT(IBX),"^",2)
"RTN","IBCNRDV",16,0)
 W !!,"Do you want to perform this Remote Query" S %=1 D YN^DICN G:%'=1 AGAIN
"RTN","IBCNRDV",17,0)
 ; get ICN
"RTN","IBCNRDV",18,0)
 S IBICN=$$ICN^IBARXMU(DFN) I 'IBICN W !!,"No ICN for this patient" G AGAIN
"RTN","IBCNRDV",19,0)
 ; sent off the remote queries and get back handles
"RTN","IBCNRDV",20,0)
 S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  D SEND(.IBH,IBX,IBICN,"IBCN INSURANCE QUERY") X $S(IBH(0)'="":"S $P(IBT(IBX),U,5)=IBH(0)",1:"W !,""No handle returned for "",$P(IBT(IBX),U,2) K IBT(IBX)")
"RTN","IBCNRDV",21,0)
 ; no handles returned
"RTN","IBCNRDV",22,0)
 I $D(IBT)<9 W !!,"Unable to perform any remote queries.",! G AGAIN
"RTN","IBCNRDV",23,0)
 ; go through every IBT()
"RTN","IBCNRDV",24,0)
 S IBP="|",IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1!($D(IBT)<9)  D
"RTN","IBCNRDV",25,0)
 . ;
"RTN","IBCNRDV",26,0)
 . ; do I have a return data.
"RTN","IBCNRDV",27,0)
 . F IBWAIT=1:1:60 W "." H 1 D CHECK(.IBR,$P(IBT(IBX),"^",5)) I $G(IBR(0))["Done" Q
"RTN","IBCNRDV",28,0)
 . I $G(IBR(0))'["Done" W !!,"Unable to communicate with ",$P(IBT(IBX),U,2) Q
"RTN","IBCNRDV",29,0)
 . K IBR D RETURN(.IBR,$P(IBT(IBX),"^",5))
"RTN","IBCNRDV",30,0)
 . ; no data returned or error message
"RTN","IBCNRDV",31,0)
 . S IBRZ=$S(-1=+$G(IBR):IBR,$G(IBR(0))="":$G(IBR(1)),1:$G(IBR(0)))
"RTN","IBCNRDV",32,0)
 . ; no info to proceed
"RTN","IBCNRDV",33,0)
 . I IBRZ<1 W !,"Response from ",$P(IBT(IBX),U,2),!,$P(IBRZ,"^",2) K IBT(IBX) D:IBRZ="-1^No insurance on file" FILE(0) Q
"RTN","IBCNRDV",34,0)
 . ; received insurance info, need to file and display message
"RTN","IBCNRDV",35,0)
 . W !,"Received ",$G(IBR(0))," insurance companies from ",$P(IBT(IBX),U,2) D FILE(+IBR(0))
"RTN","IBCNRDV",36,0)
 . S IBY=0 F  S IBY=$O(IBR(IBY))  Q:IBY<1  D
"RTN","IBCNRDV",37,0)
 .. F IBL=5:1  S IBT=$P($T(MAP+IBL),";",3) Q:IBT=""  D
"RTN","IBCNRDV",38,0)
 ... ; am i on the right MAP line
"RTN","IBCNRDV",39,0)
 ... I $P(IBT,IBP,3)=$S(IBY#6:IBY#6,1:6) S IBZ=$P(IBR(IBY),"^",$P(IBT,IBP,4)) I $L(IBZ) D
"RTN","IBCNRDV",40,0)
 .... ; xecute code to change external to internal
"RTN","IBCNRDV",41,0)
 .... X:$L($P(IBT,IBP,7)) $P(IBT,IBP,7)
"RTN","IBCNRDV",42,0)
 .... ; put the info in the array for the buffer file
"RTN","IBCNRDV",43,0)
 .... S IBB($P(IBT,IBP,5))=IBZ
"RTN","IBCNRDV",44,0)
 .. ; need to avoid duplicates if possible.
"RTN","IBCNRDV",45,0)
 .. I $G(IBB(20.01))["MEDICARE (WNR)" S X=0 F  S X=$O(^DPT(DFN,.312,X)) Q:X<1  I $P($G(^DIC(36,+$P($G(^DPT(DFN,.312,X,0)),"^"),0)),"^")["MEDICARE (WNR)" K IBB Q
"RTN","IBCNRDV",46,0)
 .. Q:'$D(IBB)
"RTN","IBCNRDV",47,0)
 .. ; file in the buffer file
"RTN","IBCNRDV",48,0)
 .. I IBY#6=0 S IBB=$$ADDSTF^IBCNBES($G(IBB(.03),1),DFN,.IBB) W:IBB !,$P(IBB,"^")," Buffer File entry for ",$G(IBB(20.01)) K IBB
"RTN","IBCNRDV",49,0)
 ;
"RTN","IBCNRDV",50,0)
 ; flag so i don't do this patient again within 90 days
"RTN","IBCNRDV",51,0)
 S ^IBT(356,"ARDV",DFN,$$FMADD^XLFDT(DT,90))=""
"RTN","IBCNRDV",52,0)
 Q
"RTN","IBCNRDV",53,0)
RPC(IBD,IBICN) ; rpc entry for looking up insurance info
"RTN","IBCNRDV",54,0)
 N DFN,IBZ,IBX,IBY,IBP,IBI,IBT,IBZ
"RTN","IBCNRDV",55,0)
 S DFN=$$DFN^IBARXMU(IBICN) I 'DFN S IBD(0)="-1^ICN Not found" Q
"RTN","IBCNRDV",56,0)
 D ALL^IBCNS1(DFN,"IBY",3)
"RTN","IBCNRDV",57,0)
 I '$D(IBY) S IBD(0)="-1^No insurance on file" Q
"RTN","IBCNRDV",58,0)
 ; set up return format
"RTN","IBCNRDV",59,0)
 ; IBD(0)   = # of insurance companies
"RTN","IBCNRDV",60,0)
 S IBD(0)=$G(IBY(0))
"RTN","IBCNRDV",61,0)
 ;
"RTN","IBCNRDV",62,0)
 ; where n starts at 1 and increments 6 for each insurnace co
"RTN","IBCNRDV",63,0)
 ; IBD(n) = 355.33, zero node format
"RTN","IBCNRDV",64,0)
 ; IBD(n+1) = 355.33, 20 node format
"RTN","IBCNRDV",65,0)
 ; IBD(n+2) = 355.33, 21 node format
"RTN","IBCNRDV",66,0)
 ; IBD(n+3) = 355.33, 40 node format
"RTN","IBCNRDV",67,0)
 ; IBD(n+4) = 355.33, 60 node format
"RTN","IBCNRDV",68,0)
 ; IBD(n+5) = 355.33, 61 node format
"RTN","IBCNRDV",69,0)
 ;
"RTN","IBCNRDV",70,0)
 S IBP="|"
"RTN","IBCNRDV",71,0)
 S IBI=0 F  S IBI=$O(IBY(IBI))  Q:IBI<1  F IBL=5:1 S IBT=$P($T(MAP+IBL),";",3) Q:IBT=""  D
"RTN","IBCNRDV",72,0)
 . S IBZ=$P($G(IBY(IBI,+IBT)),"^",$P(IBT,IBP,2)) ; set the existing data
"RTN","IBCNRDV",73,0)
 . I $L($P(IBT,IBP,6)) X $P(IBT,IBP,6) ; output transform
"RTN","IBCNRDV",74,0)
 . S $P(IBD(IBI-1*6+$P(IBT,IBP,3)),"^",$P(IBT,IBP,4))=IBZ ; set data IBD
"RTN","IBCNRDV",75,0)
 Q
"RTN","IBCNRDV",76,0)
MAP ; this is a mapping of data returned from ALL^IBCNS1 to the buffer file
"RTN","IBCNRDV",77,0)
 ; format is:  node number | piece | extract node | extract piece
"RTN","IBCNRDV",78,0)
 ;             | 355.33 field number | format out code (if any)
"RTN","IBCNRDV",79,0)
 ;             | format in code (if any)
"RTN","IBCNRDV",80,0)
 ; the exract nodes will be sequential to match buffer file dd
"RTN","IBCNRDV",81,0)
 ;;0|1|2|1|20.01|N Z X "F Z=0,.11,.13 S IBY(IBI,36+Z)=$G(^DIC(36,IBZ,Z))" S IBZ=$P(IBY(IBI,36),"^");ins co name
"RTN","IBCNRDV",82,0)
 ;;0|2|5|4|60.04;subscriber id
"RTN","IBCNRDV",83,0)
 ;;0|4|5|3|60.03;experation date
"RTN","IBCNRDV",84,0)
 ;;0|6|5|5|60.05;who's insurance
"RTN","IBCNRDV",85,0)
 ;;0|8|5|2|60.02;effective date
"RTN","IBCNRDV",86,0)
 ;;0|16|5|6|60.06;pt relationship to insured
"RTN","IBCNRDV",87,0)
 ;;0|17|5|7|60.07;name of insured
"RTN","IBCNRDV",88,0)
 ;;0|20|5|12|60.12;coordination of benefits
"RTN","IBCNRDV",89,0)
 ;;1|3|1|10|.1;date (last) verified
"RTN","IBCNRDV",90,0)
 ;;1|9|1|3|.03;source of information
"RTN","IBCNRDV",91,0)
 ;;2|1|6|5|61.05;send bill to employer
"RTN","IBCNRDV",92,0)
 ;;2|2|6|6|61.06;employer claims street address (line 1)
"RTN","IBCNRDV",93,0)
 ;;2|3|6|7|61.07;employer claims street address line 2
"RTN","IBCNRDV",94,0)
 ;;2|4|6|8|61.08;employer claims street address line 3
"RTN","IBCNRDV",95,0)
 ;;2|5|6|9|61.09;employer claims city
"RTN","IBCNRDV",96,0)
 ;;2|6|6|10|61.1|S IBZ=$$EXTERNAL^DILFD(2.312,.01,"",IBZ)|N DIC,X,Y S DIC="^DIC(5,",X=IBZ,DIC(0)="OX" D ^DIC K:+Y<1 IBZ S:+Y>0 IBZ=+Y;employer claims state
"RTN","IBCNRDV",97,0)
 ;;2|7|6|11|61.11;employer claims zip code
"RTN","IBCNRDV",98,0)
 ;;2|8|6|12|61.12;employer claims phone
"RTN","IBCNRDV",99,0)
 ;;2|10|6|1|61.01;esghp
"RTN","IBCNRDV",100,0)
 ;;2|11|6|3|61.03;employment status
"RTN","IBCNRDV",101,0)
 ;;2|12|6|4|61.04;retirement date
"RTN","IBCNRDV",102,0)
 ;;3|1|5|8|60.08;insured's dob
"RTN","IBCNRDV",103,0)
 ;;3|5|5|9|60.09;insured's ssn
"RTN","IBCNRDV",104,0)
 ;;4|1|5|10|60.1;primary care provider
"RTN","IBCNRDV",105,0)
 ;;4|2|5|11|60.11;primary provider phone
"RTN","IBCNRDV",106,0)
 ;;355.3|2|4|1|40.01;is this a group policy
"RTN","IBCNRDV",107,0)
 ;;355.3|3|4|2|40.02;group name
"RTN","IBCNRDV",108,0)
 ;;355.3|4|4|3|40.03;group number
"RTN","IBCNRDV",109,0)
 ;;355.3|5|4|4|40.04;(is) utilization required
"RTN","IBCNRDV",110,0)
 ;;355.3|6|4|5|40.05;(is) pre-certification required
"RTN","IBCNRDV",111,0)
 ;;355.3|7|4|7|40.07;exclude pre-existing condition
"RTN","IBCNRDV",112,0)
 ;;355.3|8|4|8|40.08;benefits assignable
"RTN","IBCNRDV",113,0)
 ;;355.3|9|4|9|40.09;type of plan
"RTN","IBCNRDV",114,0)
 ;;355.3|12|4|6|40.06;ambulatory care certification
"RTN","IBCNRDV",115,0)
 ;;36|2|2|5|20.05;reimburse
"RTN","IBCNRDV",116,0)
 ;;36.11|1|3|1|21.01;street address line 1
"RTN","IBCNRDV",117,0)
 ;;36.11|2|3|2|21.02;street address line 2
"RTN","IBCNRDV",118,0)
 ;;36.11|3|3|3|21.03;street address line 3
"RTN","IBCNRDV",119,0)
 ;;36.11|4|3|4|21.04;city
"RTN","IBCNRDV",120,0)
 ;;36.11|5|3|5|21.05|S IBZ=$$EXTERNAL^DILFD(36,.115,"",IBZ)|N DIC,X,Y S DIC="^DIC(5,",X=IBZ,DIC(0)="OX" D ^DIC K:+Y<1 IBZ S:+Y>0 IBZ=+Y;state
"RTN","IBCNRDV",121,0)
 ;;36.11|6|3|6|21.06;zip code
"RTN","IBCNRDV",122,0)
 ;;36.13|1|2|2|20.02;phone number
"RTN","IBCNRDV",123,0)
 ;;36.13|2|2|3|20.03;billing phone number
"RTN","IBCNRDV",124,0)
 ;;36.13|3|2|4|20.04;precertification phone number
"RTN","IBCNRDV",125,0)
 ;;
"RTN","IBCNRDV",126,0)
 ;
"RTN","IBCNRDV",127,0)
SEND(IBH,IBX,IBICN,IBRPC) ; called to send off queries
"RTN","IBCNRDV",128,0)
 D EN1^XWB2HL7(.IBH,IBX,IBRPC,"",IBICN)
"RTN","IBCNRDV",129,0)
 Q
"RTN","IBCNRDV",130,0)
CHECK(IBR,IBH) ; called to check the return status of an RPC
"RTN","IBCNRDV",131,0)
 D RPCCHK^XWB2HL7(.IBR,IBH)
"RTN","IBCNRDV",132,0)
 Q
"RTN","IBCNRDV",133,0)
RETURN(IBR,IBH) ; called to get the return data and clear the broker
"RTN","IBCNRDV",134,0)
 N IBZ
"RTN","IBCNRDV",135,0)
 D RTNDATA^XWBDRPC(.IBR,IBH),CLEAR^XWBDRPC(.IBZ,IBH)
"RTN","IBCNRDV",136,0)
 Q
"RTN","IBCNRDV",137,0)
BACKGND ; background entry point, assumes DFN, IBDUZ is optional
"RTN","IBCNRDV",138,0)
 N IBT,IBICN,IBX,IBH,IBP,IBWAIT,IBR,IBRZ,IBY,IBL,IBB
"RTN","IBCNRDV",139,0)
 ;
"RTN","IBCNRDV",140,0)
 ; look up treating facilities
"RTN","IBCNRDV",141,0)
 S IBT=$$TFL^IBARXMU(DFN,.IBT)
"RTN","IBCNRDV",142,0)
 ; no facilities
"RTN","IBCNRDV",143,0)
 I IBT<1 Q
"RTN","IBCNRDV",144,0)
 ; get ICN
"RTN","IBCNRDV",145,0)
 S IBICN=$$ICN^IBARXMU(DFN) I 'IBICN Q
"RTN","IBCNRDV",146,0)
 ;
"RTN","IBCNRDV",147,0)
 ; sent off the remote queries and get back handles
"RTN","IBCNRDV",148,0)
 S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  D SEND(.IBH,IBX,IBICN,"IBCN INSURANCE QUERY TASK") X $S(IBH(0)'="":"S $P(IBT(IBX),U,5)=IBH(0)",1:"K IBT(IBX)")
"RTN","IBCNRDV",149,0)
 ; no handles returned
"RTN","IBCNRDV",150,0)
 I $D(IBT)<9 Q
"RTN","IBCNRDV",151,0)
 ; go through every IBT()
"RTN","IBCNRDV",152,0)
 S IBP="|",IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1!($D(IBT)<9)  D
"RTN","IBCNRDV",153,0)
 . ; do I have a return data.
"RTN","IBCNRDV",154,0)
 . F IBWAIT=1:1:60 H 1 D CHECK(.IBR,$P(IBT(IBX),"^",5)) I $G(IBR(0))["Done" Q
"RTN","IBCNRDV",155,0)
 . I $G(IBR(0))'["Done" Q
"RTN","IBCNRDV",156,0)
 . K IBR
"RTN","IBCNRDV",157,0)
 . D RETURN(.IBR,$P(IBT(IBX),"^",5))
"RTN","IBCNRDV",158,0)
 . ; no data returned or error message
"RTN","IBCNRDV",159,0)
 . S IBRZ=$S(-1=+$G(IBR):IBR,$G(IBR(0))="":$G(IBR(1)),1:$G(IBR(0)))
"RTN","IBCNRDV",160,0)
 . ; no info to proceed
"RTN","IBCNRDV",161,0)
 . I IBRZ<1 D:IBRZ["No insurance on file" FILE(0) K IBT(IBX) Q
"RTN","IBCNRDV",162,0)
 . D FILE(+$G(IBR(0)))
"RTN","IBCNRDV",163,0)
 . ; received insurance info, need to file
"RTN","IBCNRDV",164,0)
 . S IBY=0 F  S IBY=$O(IBR(IBY))  Q:IBY<1  D
"RTN","IBCNRDV",165,0)
 .. F IBL=5:1  S IBT=$P($T(MAP+IBL),";",3) Q:IBT=""  D
"RTN","IBCNRDV",166,0)
 ... ; am i on the right MAP line
"RTN","IBCNRDV",167,0)
 ... I $P(IBT,IBP,3)=$S(IBY#6:IBY#6,1:6) S IBZ=$P(IBR(IBY),"^",$P(IBT,IBP,4)) I $L(IBZ) D
"RTN","IBCNRDV",168,0)
 .... ; xecute code to change external to internal
"RTN","IBCNRDV",169,0)
 .... X:$L($P(IBT,IBP,7)) $P(IBT,IBP,7)
"RTN","IBCNRDV",170,0)
 .... ; put the info in the array for the buffer file
"RTN","IBCNRDV",171,0)
 .... S IBB($P(IBT,IBP,5))=IBZ
"RTN","IBCNRDV",172,0)
 .. ; need to avoid duplicates if possible.
"RTN","IBCNRDV",173,0)
 .. I $G(IBB(20.01))["MEDICARE (WNR)" S X=0 F  S X=$O(^DPT(DFN,.312,X)) Q:X<1  I $P($G(^DIC(36,+$P($G(^DPT(DFN,.312,X,0)),"^"),0)),"^")["MEDICARE (WNR)" K IBB Q
"RTN","IBCNRDV",174,0)
 .. Q:'$D(IBB)
"RTN","IBCNRDV",175,0)
 .. ;
"RTN","IBCNRDV",176,0)
 .. ; file in the buffer file & where else needed.
"RTN","IBCNRDV",177,0)
 .. I IBY#6=0 S IBB=$$ADDSTF^IBCNBES($G(IBB(.03),1),DFN,.IBB) D:IBB&('$D(IB1)) SCH^IBTUTL2(DFN,$G(IBSAVEI),$G(IBSAVEJ)):IBTYPE="TRKR",ADM^IBTUTL($G(IBSAVE1),$G(IBSAVE2),$G(IBSAVE3),$G(IBSAVE4)):IBTYPE="ADM" S IB1=1 K IBB
"RTN","IBCNRDV",178,0)
 ;
"RTN","IBCNRDV",179,0)
 ; flag so i don't do this patient again within 90 days
"RTN","IBCNRDV",180,0)
 S ^IBT(356,"ARDV",DFN,$$FMADD^XLFDT(DT,90))=""
"RTN","IBCNRDV",181,0)
 Q
"RTN","IBCNRDV",182,0)
TASK ; queue off task job
"RTN","IBCNRDV",183,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","IBCNRDV",184,0)
 S ZTRTN="BACKGND^IBCNRDV",ZTDESC="Query Remote Facilities for Insurance",ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT),(ZTIO,ZTSAVE("DFN"),ZTSAVE("IBSAVE*"),ZTSAVE("IBTYPE"))="" D ^%ZTLOAD
"RTN","IBCNRDV",185,0)
 Q
"RTN","IBCNRDV",186,0)
TRKR(DFN,IBSAVEI,IBSAVEJ,IBDUZ) ; claims tracking entry
"RTN","IBCNRDV",187,0)
 N IBTYPE,IBT
"RTN","IBCNRDV",188,0)
 Q:$D(^IBT(356,"ARDV",DFN))  ; have already done recently
"RTN","IBCNRDV",189,0)
 Q:'$$TFL^IBARXMU(DFN,.IBT)  ; no remote facilities
"RTN","IBCNRDV",190,0)
 S IBTYPE="TRKR" D
"RTN","IBCNRDV",191,0)
 . I DUZ=.5 N DUZ S DUZ=+$G(IBDUZ),DUZ(2)=+$$SITE^VASITE
"RTN","IBCNRDV",192,0)
 . D TASK
"RTN","IBCNRDV",193,0)
 Q
"RTN","IBCNRDV",194,0)
ADM(DFN,IBSAVE1,IBSAVE2,IBSAVE3,IBSAVE4) ; admit event entry
"RTN","IBCNRDV",195,0)
 N IBTYPE S IBTYPE="ADM" D TASK
"RTN","IBCNRDV",196,0)
 Q
"RTN","IBCNRDV",197,0)
FILE(IBX) ; updates data into the log file
"RTN","IBCNRDV",198,0)
 ;IBX = number of insurance co's found
"RTN","IBCNRDV",199,0)
 N DIC,DA,DIE,IBM,DO,X,Y,IBZ,DR
"RTN","IBCNRDV",200,0)
 S IBM=$E($$DT^XLFDT,1,5)_"00",DA=+$O(^IBA(355.34,"B",IBM,0))
"RTN","IBCNRDV",201,0)
 I 'DA K DA L +^IBA(355.34,"B",IBM):10 S X=IBM,DIC="^IBA(355.34,",DIC(0)="F" D FILE^DICN S DA=+Y L -^IBA(355.34,"B",IBM)
"RTN","IBCNRDV",202,0)
 L +^IBA(355.34,DA):10
"RTN","IBCNRDV",203,0)
 S IBZ=^IBA(355.34,DA,0),DIE="^IBA(355.34,"
"RTN","IBCNRDV",204,0)
 S DR=".02///"_($P(IBZ,"^",2)+1)_";.03///"_($P(IBZ,"^",3)+IBX) D ^DIE
"RTN","IBCNRDV",205,0)
 L -^IBA(355.34,DA)
"RTN","IBCNRDV",206,0)
 Q
"RTN","IBTRKR")
0^3^B36589425
"RTN","IBTRKR",1,0)
IBTRKR ;ALB/AAS - CLAIMS TRACKER - AUTO-ENROLLER ; 4-AUG-93
"RTN","IBTRKR",2,0)
 ;;2.0;INTEGRATED BILLING;**23,43,45,56,214**;21-MAR-94
"RTN","IBTRKR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR",4,0)
 ;
"RTN","IBTRKR",5,0)
INP ; -- Inpatient Tracker
"RTN","IBTRKR",6,0)
 ;    called by ibamtd  from DGPM MOVEMENT EVENTS
"RTN","IBTRKR",7,0)
 ;                                               add   edit   delete
"RTN","IBTRKR",8,0)
 ;  dgpma = after movement 0th node file 405  : data   data   null
"RTN","IBTRKR",9,0)
 ;  dgpmp = prior movement 0th node file 405  : null   data   data
"RTN","IBTRKR",10,0)
 ;  dfn   = ien of patient
"RTN","IBTRKR",11,0)
 ;  
"RTN","IBTRKR",12,0)
 N %,%H,%I,IBMVAD,IBMVTP,IBTRKR
"RTN","IBTRKR",13,0)
 ;
"RTN","IBTRKR",14,0)
 ;  inpatient claims tracking turned off
"RTN","IBTRKR",15,0)
 S IBTRKR=$G(^IBE(350.9,1,6)) I '$P(IBTRKR,"^",2) Q
"RTN","IBTRKR",16,0)
 ;
"RTN","IBTRKR",17,0)
 ;  movement type 1=admission, 2=transfer, 3=discharge, 6=specialty chg
"RTN","IBTRKR",18,0)
 S IBMVTP=$S($P(DGPMA,"^",2):$P(DGPMA,"^",2),1:$P(DGPMP,"^",2)) I 'IBMVTP Q
"RTN","IBTRKR",19,0)
 ;
"RTN","IBTRKR",20,0)
 ;  $p(14)=admission movement ptr entry in file 405
"RTN","IBTRKR",21,0)
 S IBMVAD=$S(DGPMA'="":$P(DGPMA,"^",14),1:$P(DGPMP,"^",14)) I 'IBMVAD Q
"RTN","IBTRKR",22,0)
 ;
"RTN","IBTRKR",23,0)
 D WRITE("Updating claims tracking ... ",2)
"RTN","IBTRKR",24,0)
 ;
"RTN","IBTRKR",25,0)
 I '$D(VAIN(1)) D INP^VADPT
"RTN","IBTRKR",26,0)
 ;
"RTN","IBTRKR",27,0)
 ;  add/edit admission
"RTN","IBTRKR",28,0)
 I IBMVTP=1 D ADMIT Q
"RTN","IBTRKR",29,0)
 ;
"RTN","IBTRKR",30,0)
 ;  transfer to asih (patch 23)
"RTN","IBTRKR",31,0)
 I $P($G(^DGPM(+$P(DGPMA,"^",15),0)),"^",2)=1 S IBMVAD=$P(DGPMA,"^",15) D ADMIT Q
"RTN","IBTRKR",32,0)
 ;
"RTN","IBTRKR",33,0)
 ;  specialty change
"RTN","IBTRKR",34,0)
 I IBMVTP=6 D SPECIAL Q
"RTN","IBTRKR",35,0)
 ;
"RTN","IBTRKR",36,0)
 D WRITE("completed.")
"RTN","IBTRKR",37,0)
 Q
"RTN","IBTRKR",38,0)
 ;
"RTN","IBTRKR",39,0)
 ;
"RTN","IBTRKR",40,0)
WRITE(MSG,FF)         ;  write message on screen if not silent
"RTN","IBTRKR",41,0)
 ;  write 'F'orm 'F'eeds count followed by msg (optional)
"RTN","IBTRKR",42,0)
 N %
"RTN","IBTRKR",43,0)
 I '$D(IB20),'$G(DGQUIET) D
"RTN","IBTRKR",44,0)
 .   F %=1:1:$G(FF) W !
"RTN","IBTRKR",45,0)
 .   W MSG
"RTN","IBTRKR",46,0)
 Q
"RTN","IBTRKR",47,0)
 ;
"RTN","IBTRKR",48,0)
 ;
"RTN","IBTRKR",49,0)
ADMIT ; -- process admission movements
"RTN","IBTRKR",50,0)
 ;  ibmvad is admission movement pointer to file 405
"RTN","IBTRKR",51,0)
 ;  dgpma  is movement entry from file 405
"RTN","IBTRKR",52,0)
 N %,%H,%I,IBCTFLAG,IBNEW,IBRANDOM,IBTRN,LASTADM,LASTDA,LASTDATA
"RTN","IBTRKR",53,0)
 ;
"RTN","IBTRKR",54,0)
 ;  this is a deleted admission from file 405, dgpma=null
"RTN","IBTRKR",55,0)
 I DGPMA="" D DELADMIT Q
"RTN","IBTRKR",56,0)
 ;
"RTN","IBTRKR",57,0)
 ;  try and relink to existing entry if already there
"RTN","IBTRKR",58,0)
 ;  find the last admission, check to make sure its inactive and there
"RTN","IBTRKR",59,0)
 ;  is not a pointer to the movement file ($p(5)).  if the current
"RTN","IBTRKR",60,0)
 ;  admission date is within 5 days, update the entry.
"RTN","IBTRKR",61,0)
 S LASTADM=$O(^IBT(356,"APTY",DFN,+$O(^IBE(356.6,"AC",1,0)),9999999),-1)
"RTN","IBTRKR",62,0)
 I LASTADM S LASTDA=+$O(^IBT(356,"APTY",DFN,1,LASTADM,0)),LASTDATA=$G(^IBT(356,LASTDA,0)) I $P(LASTDATA,"^",20)=0,$P(LASTDATA,"^",5)="" D  Q:$G(IBCTFLAG)
"RTN","IBTRKR",63,0)
 .   S %=$$FMDIFF^XLFDT($P(DGPMA,"."),$P(LASTADM,"."))
"RTN","IBTRKR",64,0)
 .   I %>-5,%<5 D RELINK^IBTRKRU(LASTDA,IBMVAD,$P(DGPMA,"^")),RELBULL^IBTRKRBR(DFN,LASTDA,DGPMA,+$G(VAIN(3))),WRITE("entry re-linked.") S IBCTFLAG=1
"RTN","IBTRKR",65,0)
 ;
"RTN","IBTRKR",66,0)
 ;  random sampler, admission date must equal today (dt)
"RTN","IBTRKR",67,0)
 I +$G(VAIN(3)),($E(+DGPMA,1,7)=DT) S IBRANDOM=$$RANDOM^IBTRKR1(+VAIN(3))
"RTN","IBTRKR",68,0)
 ;
"RTN","IBTRKR",69,0)
 N D,D0,DI,DIG,DIH,DIU,DIV,DQ,IBADMDT,IBETYP  ; variables left by ibtutl
"RTN","IBTRKR",70,0)
 ;  inpatient claims tracking = all patients
"RTN","IBTRKR",71,0)
 I $P(IBTRKR,"^",2)=2 D  Q
"RTN","IBTRKR",72,0)
 .   D ADM^IBTUTL(IBMVAD,+$E(+DGPMA,1,12),$G(IBRANDOM),$P(DGPMA,"^",27))
"RTN","IBTRKR",73,0)
 .   D WRITE("entry "_$S($G(IBNEW):"added.",1:"edited."))
"RTN","IBTRKR",74,0)
 .   I $G(IBRANDOM),$G(IBTRN) D ADMTBULL^IBTRKRBA(DFN,IBTRN,DGPMA,+$G(VAIN(3)))
"RTN","IBTRKR",75,0)
 ;
"RTN","IBTRKR",76,0)
 ;  inpatient claims tracking = insured and ur only
"RTN","IBTRKR",77,0)
 I $P(IBTRKR,"^",2)=1,$S($G(IBRANDOM):1,'$$INSURED^IBCNS1(DFN,+DGPMA):0,1:$$PTCOV^IBCNSU3(DFN,+DGPMA,"INPATIENT")) D  Q
"RTN","IBTRKR",78,0)
 .   D ADM^IBTUTL(IBMVAD,+$E(+DGPMA,1,12),$G(IBRANDOM),$P(DGPMA,"^",27))
"RTN","IBTRKR",79,0)
 .   D WRITE("entry "_$S($G(IBNEW):"added.",1:"edited."))
"RTN","IBTRKR",80,0)
 .   I $G(IBRANDOM),$G(IBTRN) D ADMTBULL^IBTRKRBA(DFN,IBTRN,DGPMA,+$G(VAIN(3)))
"RTN","IBTRKR",81,0)
 ;
"RTN","IBTRKR",82,0)
 ;  inpatient claims tracking = insured and ur only, but not insurred
"RTN","IBTRKR",83,0)
 ;  need to send off RDV in background
"RTN","IBTRKR",84,0)
 N IBT
"RTN","IBTRKR",85,0)
 I $P(IBTRKR,"^",2)=1,'$$INSURED^IBCNS1(DFN,+DGPMA),$$TFL^IBARXMU(DFN,.IBT),'$D(^IBT(356,"ARDV",DFN)) D ADM^IBCNRDV(DFN,IBMVAD,+$E(+DGPMA,1,12),$G(IBRANDOM),$P(DGPMA,"^",27)) D WRITE("Remote Query for insurance sent.") Q
"RTN","IBTRKR",86,0)
 ;
"RTN","IBTRKR",87,0)
 ;
"RTN","IBTRKR",88,0)
 D WRITE("no action taken.")
"RTN","IBTRKR",89,0)
 Q
"RTN","IBTRKR",90,0)
 ;
"RTN","IBTRKR",91,0)
 ;
"RTN","IBTRKR",92,0)
DELADMIT ;  deleted admission
"RTN","IBTRKR",93,0)
 N DA,FILE,IBDATE,IBTRN,SPECALTY
"RTN","IBTRKR",94,0)
 S IBTRN=$O(^IBT(356,"AD",+IBMVAD,0)) I IBTRN D  Q
"RTN","IBTRKR",95,0)
 .   S SPECALTY=+$P($G(^UTILITY($J,"ATS",+$P(DGPMP,"^"),+$O(^UTILITY($J,"ATS",+$P(DGPMP,"^"),0)))),"^",9)
"RTN","IBTRKR",96,0)
 .   ;  send information bulletin
"RTN","IBTRKR",97,0)
 .   D DELBULL^IBTRKRBD(DFN,IBTRN,DGPMP,SPECALTY)
"RTN","IBTRKR",98,0)
 .   ;  clean up files pointing to 405
"RTN","IBTRKR",99,0)
 .   F FILE=356.9,356.91,356.94 S DA=0 F  S DA=$O(^IBT(FILE,"C",+IBMVAD,DA)) Q:'DA  D DELETE^IBTRKRU(FILE,DA)
"RTN","IBTRKR",100,0)
 .   S IBDATE=0 F  S IBDATE=$O(^IBT(356.93,"AMVD",+IBMVAD,IBDATE)) Q:'IBDATE  S DA=0 F  S DA=$O(^IBT(356.93,"AMVD",+IBMVAD,IBDATE,DA)) Q:'DA  D DELETE^IBTRKRU(356.93,DA)
"RTN","IBTRKR",101,0)
 .   ;  inactivate entry in ct 356
"RTN","IBTRKR",102,0)
 .   D INACTIVE^IBTRKRU(IBTRN)
"RTN","IBTRKR",103,0)
 .   D WRITE("entry inactivated.")
"RTN","IBTRKR",104,0)
 D WRITE("no action taken.")
"RTN","IBTRKR",105,0)
 Q
"RTN","IBTRKR",106,0)
 ;
"RTN","IBTRKR",107,0)
 ;
"RTN","IBTRKR",108,0)
SPECIAL ;  specialty change
"RTN","IBTRKR",109,0)
 ;  deleted movement
"RTN","IBTRKR",110,0)
 I DGPMA="" D WRITE("no action taken.") Q
"RTN","IBTRKR",111,0)
 ;
"RTN","IBTRKR",112,0)
 ;  if specialty change is past 7 days, quit
"RTN","IBTRKR",113,0)
 I +DGPMA<$$FMADD^XLFDT(+DT,-7) D WRITE("no action taken.") Q
"RTN","IBTRKR",114,0)
 ;
"RTN","IBTRKR",115,0)
 N IBDT,IBTSA,IBTSP,IBTRC,IBTRN,IBTRV
"RTN","IBTRKR",116,0)
 ;  treating specialty after
"RTN","IBTRKR",117,0)
 S IBTSA=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P(DGPMA,"^",9),0)),"^",2),0)),"^",3)
"RTN","IBTRKR",118,0)
 ;
"RTN","IBTRKR",119,0)
 ;  treating specialty before
"RTN","IBTRKR",120,0)
 I DGPMP'="" S IBTSP=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P(DGPMP,"^",9),0)),"^",2),0)),"^",3)
"RTN","IBTRKR",121,0)
 ;
"RTN","IBTRKR",122,0)
 I DGPMP="" D
"RTN","IBTRKR",123,0)
 .   S IBDT=9999999.9999999-$P(DGPMA,"^")
"RTN","IBTRKR",124,0)
 .   S IBTSP=$P($G(^DIC(45.7,+$O(^(+$O(^DGPM("ATS",+DFN,+IBMVAD,+IBDT)),0)),0)),"^",2)
"RTN","IBTRKR",125,0)
 .   S IBTSP=$P($G(^DIC(42.4,+IBTSP,0)),"^",3)
"RTN","IBTRKR",126,0)
 ;
"RTN","IBTRKR",127,0)
 ;  no change in major bed section
"RTN","IBTRKR",128,0)
 I IBTSA=IBTSP D WRITE("no action taken.") Q
"RTN","IBTRKR",129,0)
 ;
"RTN","IBTRKR",130,0)
 S IBTRN=$O(^IBT(356,"AD",+IBMVAD,0))
"RTN","IBTRKR",131,0)
 ;
"RTN","IBTRKR",132,0)
 ;  tracked as hospital review
"RTN","IBTRKR",133,0)
 I $O(^IBT(356.1,"C",+IBTRN,0)) D
"RTN","IBTRKR",134,0)
 .   I $$ALREADY(356.1,+DGPMA) Q
"RTN","IBTRKR",135,0)
 .   D PRE^IBTUTL2($E(+DGPMA,1,7),IBTRN,30)
"RTN","IBTRKR",136,0)
 .   I $G(IBTRV) D COMMENT^IBTRKRU(356.1,+IBTRV)
"RTN","IBTRKR",137,0)
 ;
"RTN","IBTRKR",138,0)
 ;  tracked as insurance review
"RTN","IBTRKR",139,0)
 I $O(^IBT(356.2,"C",+IBTRN,0)) D
"RTN","IBTRKR",140,0)
 .   I $$ALREADY(356.2,+DGPMA) Q
"RTN","IBTRKR",141,0)
 .   I $P($G(^IBT(356,+IBTRN,0)),"^",24) D COM^IBTUTL3($E(+DGPMA,1,12),IBTRN,30)
"RTN","IBTRKR",142,0)
 .   I $G(IBTRC) D COMMENT^IBTRKRU(356.2,+IBTRC)
"RTN","IBTRKR",143,0)
 ;
"RTN","IBTRKR",144,0)
 D WRITE("completed.")
"RTN","IBTRKR",145,0)
 Q
"RTN","IBTRKR",146,0)
 ;
"RTN","IBTRKR",147,0)
 ;
"RTN","IBTRKR",148,0)
ALREADY(FILE,DATE) ; -- see if already is review for date
"RTN","IBTRKR",149,0)
 N X,Y,IBX
"RTN","IBTRKR",150,0)
 S IBX=0
"RTN","IBTRKR",151,0)
 S X=$P(DATE,".")+.25
"RTN","IBTRKR",152,0)
 S Y=$O(^IBT(FILE,"ATIDT",+IBTRN,-X)) S Y=-Y I Y,$P(Y,".")=$P(DATE,".") S IBX=1
"RTN","IBTRKR",153,0)
 Q IBX
"RTN","IBTRKR",154,0)
 ;
"RTN","IBTRKR",155,0)
 ;
"RTN","IBTRKR",156,0)
NIGHTLY ; -- nightly job for claims tracking, called by IBAMTC
"RTN","IBTRKR",157,0)
 ;
"RTN","IBTRKR",158,0)
 D UPDATE^IBTRKR1 ; update claims tracking site parameters (random sampler)
"RTN","IBTRKR",159,0)
 D ^IBTRKR2 ;       add scheduled admissions to tracking
"RTN","IBTRKR",160,0)
 D ^IBTRKR3 ;       add rx refill to outpatient encounters
"RTN","IBTRKR",161,0)
 D ^IBTRKR4 ;       add outpatient encounters to tracking
"RTN","IBTRKR",162,0)
 D ^IBTRKR5 ;       add outpatient prosthetics item to tracking
"RTN","IBTRKR",163,0)
 Q
"RTN","IBTRKR2")
0^2^B4858987
"RTN","IBTRKR2",1,0)
IBTRKR2 ;ALB/AAS - ADD/TRACK SCHEDULED ADMISSION ; 9-AUG-93
"RTN","IBTRKR2",2,0)
 ;;2.0;INTEGRATED BILLING;**43,62,214**;21-MAR-94
"RTN","IBTRKR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR2",4,0)
 ;
"RTN","IBTRKR2",5,0)
% ;
"RTN","IBTRKR2",6,0)
EN ; -- add scheduled admissions to claims tracking file
"RTN","IBTRKR2",7,0)
 N I,J,X,Y,IBTRKR,IBI,IBJ,DFN,IBDATA
"RTN","IBTRKR2",8,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR2",9,0)
 G:'$P(IBTRKR,"^",2) ENQ ; inpatient tracking off
"RTN","IBTRKR2",10,0)
 S:'$G(IBTSBDT) IBTSBDT=$$FMADD^XLFDT(DT,-3)-.1
"RTN","IBTRKR2",11,0)
 S:'$G(IBTSEDT) IBTSEDT=$$FMADD^XLFDT(DT,7)+.9
"RTN","IBTRKR2",12,0)
 I IBTSBDT<+IBTRKR S IBTSBDT=+IBTRKR-.1 ; start date can't be before ct start date
"RTN","IBTRKR2",13,0)
 S IBI=IBTSBDT-.0001 F  S IBI=$O(^DGS(41.1,"C",IBI)) Q:'IBI!(IBI>IBTSEDT)  S IBJ="" F  S IBJ=$O(^DGS(41.1,"C",IBI,IBJ)) Q:'IBJ  D
"RTN","IBTRKR2",14,0)
 .S IBDATA=$G(^DGS(41.1,IBJ,0))
"RTN","IBTRKR2",15,0)
 .S DFN=+IBDATA
"RTN","IBTRKR2",16,0)
 .Q:'DFN  ;  no patient
"RTN","IBTRKR2",17,0)
 .Q:$P(IBDATA,"^",17)  ; already admitted
"RTN","IBTRKR2",18,0)
 .;
"RTN","IBTRKR2",19,0)
 .S IBTRN=$O(^IBT(356,"ASCH",IBJ,0))
"RTN","IBTRKR2",20,0)
 .I $P(IBDATA,"^",13) D:IBTRN INACTIVE^IBTRKRU(IBTRN) Q  ; canceled
"RTN","IBTRKR2",21,0)
 .;
"RTN","IBTRKR2",22,0)
 .; - if not in ct add
"RTN","IBTRKR2",23,0)
 .I 'IBTRN D  Q
"RTN","IBTRKR2",24,0)
 ..I $P(IBTRKR,"^",2)=2 D SCH^IBTUTL2(DFN,IBI,IBJ) Q
"RTN","IBTRKR2",25,0)
 ..I $P(IBTRKR,"^",2)=1,$S('$$INSURED^IBCNS1(DFN,+IBI):0,1:$$PTCOV^IBCNSU3(DFN,+IBI,"INPATIENT")) D SCH^IBTUTL2(DFN,IBI,IBJ) Q
"RTN","IBTRKR2",26,0)
 ..D TRKR^IBCNRDV(DFN,IBI,IBJ,$P(IBDATA,"^",11))
"RTN","IBTRKR2",27,0)
 ..Q
"RTN","IBTRKR2",28,0)
 .;
"RTN","IBTRKR2",29,0)
 .; - if inactive re-activate
"RTN","IBTRKR2",30,0)
 .I '$P(^IBT(356,+IBTRN,0),"^",20) D
"RTN","IBTRKR2",31,0)
 ..N X,Y,I,J,DA,DR,DIE,DIC
"RTN","IBTRKR2",32,0)
 ..S DA=IBTRN,DR=".2////1",DIE="^IBT(356," D ^DIE
"RTN","IBTRKR2",33,0)
 .Q
"RTN","IBTRKR2",34,0)
 ;
"RTN","IBTRKR2",35,0)
ENQ K IBTSEDT,IBTSBDT
"RTN","IBTRKR2",36,0)
 ; add cleanup of ARDV
"RTN","IBTRKR2",37,0)
 S X=0 F  S X=$O(^IBT(356,"ARDV",X)) Q:X<1  S Y=0 F  S Y=$O(^IBT(356,"ARDV",X,Y)) Q:Y<1  I Y<DT K ^IBT(356,"ARDV",X,Y)
"RTN","IBTRKR2",38,0)
 Q
"RTN","IBTRKR2",39,0)
 ;
"RTN","IBTRKR2",40,0)
SCH(DGPMCA) ; -- is this admission movement a scheduled admission
"RTN","IBTRKR2",41,0)
 ; -- output scheduled admission pointer
"RTN","IBTRKR2",42,0)
 ;
"RTN","IBTRKR2",43,0)
 N IBTSA S IBTSA=0
"RTN","IBTRKR2",44,0)
 I '$G(DGPMCA) G SCHQ
"RTN","IBTRKR2",45,0)
 S IBTSA=+$O(^DGS(41.1,"AMVT",DGPMCA,0))
"RTN","IBTRKR2",46,0)
SCHQ Q IBTSA
"SEC","^DIC",355.34,355.34,0,"AUDIT")
@
"SEC","^DIC",355.34,355.34,0,"DD")
@
"SEC","^DIC",355.34,355.34,0,"DEL")
@
"SEC","^DIC",355.34,355.34,0,"LAYGO")
@
"SEC","^DIC",355.34,355.34,0,"RD")
@
"SEC","^DIC",355.34,355.34,0,"WR")
@
"VER")
8.0^22.0
"^DD",355.34,355.34,0)
FIELD^^.03^3
"^DD",355.34,355.34,0,"DDA")
N
"^DD",355.34,355.34,0,"DT")
3030507
"^DD",355.34,355.34,0,"IX","B",355.34,.01)

"^DD",355.34,355.34,0,"NM","INSURANCE REMOTE QUERY RESULTS")

"^DD",355.34,355.34,.01,0)
MONTH^RD^^0;1^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",355.34,355.34,.01,1,0)
^.1
"^DD",355.34,355.34,.01,1,1,0)
355.34^B
"^DD",355.34,355.34,.01,1,1,1)
S ^IBA(355.34,"B",$E(X,1,30),DA)=""
"^DD",355.34,355.34,.01,1,1,2)
K ^IBA(355.34,"B",$E(X,1,30),DA)
"^DD",355.34,355.34,.01,3)
Enter the month/year for the query results.
"^DD",355.34,355.34,.01,21,0)
^^1^1^3030507^
"^DD",355.34,355.34,.01,21,1,0)
This is the month/year of the query results.
"^DD",355.34,355.34,.01,"DT")
3030507
"^DD",355.34,355.34,.02,0)
NUMBER OF QUERIES^NJ9,0^^0;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",355.34,355.34,.02,3)
Enter the number of queries performed during the month.
"^DD",355.34,355.34,.02,21,0)
^^2^2^3030507^
"^DD",355.34,355.34,.02,21,1,0)
This is the total number of remote queries for insurance for the given 
"^DD",355.34,355.34,.02,21,2,0)
month/year.
"^DD",355.34,355.34,.02,"DT")
3030507
"^DD",355.34,355.34,.03,0)
SUCCESSFUL INSURANCE QUERIES^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1.N) X
"^DD",355.34,355.34,.03,3)
Enter the number of times a remote query is successful in finding insurance data.
"^DD",355.34,355.34,.03,21,0)
^^2^2^3030515^
"^DD",355.34,355.34,.03,21,1,0)
For a given month, the value is updated each time a remote query is 
"^DD",355.34,355.34,.03,21,2,0)
successful in finding insurance data.
"^DD",355.34,355.34,.03,"DT")
3030515
"^DIC",355.34,355.34,0)
INSURANCE REMOTE QUERY RESULTS^355.34
"^DIC",355.34,355.34,0,"GL")
^IBA(355.34,
"^DIC",355.34,355.34,"%",0)
^1.005^^
"^DIC",355.34,355.34,"%D",0)
^^5^5^3030507^
"^DIC",355.34,355.34,"%D",1,0)
This is a log file for the insurance queries that were done during a 
"^DIC",355.34,355.34,"%D",2,0)
given month/year.  There will be one entry for each month/year with 
"^DIC",355.34,355.34,"%D",3,0)
summary results only stored in the file.
"^DIC",355.34,355.34,"%D",4,0)
 
"^DIC",355.34,355.34,"%D",5,0)
Per VHA Directive 10-93-142, this file definition should not be modified.
"^DIC",355.34,"B","INSURANCE REMOTE QUERY RESULTS",355.34)

**END**
**END**
