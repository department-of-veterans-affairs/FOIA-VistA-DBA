Released WV*1*18 SEQ #18
Extracted from mail message
**KIDS**:WV*1.0*18^

**INSTALL NAME**
WV*1.0*18
"BLD",6345,0)
WV*1.0*18^WOMEN'S HEALTH^0^3051007^y
"BLD",6345,1,0)
^^1^1^3051007^^
"BLD",6345,1,1,0)
DUZ undefinied fix in WVRALINK
"BLD",6345,4,0)
^9.64PA^^
"BLD",6345,"KRN",0)
^9.67PA^8989.52^19
"BLD",6345,"KRN",.4,0)
.4
"BLD",6345,"KRN",.401,0)
.401
"BLD",6345,"KRN",.402,0)
.402
"BLD",6345,"KRN",.403,0)
.403
"BLD",6345,"KRN",.5,0)
.5
"BLD",6345,"KRN",.84,0)
.84
"BLD",6345,"KRN",3.6,0)
3.6
"BLD",6345,"KRN",3.8,0)
3.8
"BLD",6345,"KRN",9.2,0)
9.2
"BLD",6345,"KRN",9.8,0)
9.8
"BLD",6345,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6345,"KRN",9.8,"NM",1,0)
WVRALINK^^0^49986932
"BLD",6345,"KRN",9.8,"NM","B","WVRALINK",1)

"BLD",6345,"KRN",19,0)
19
"BLD",6345,"KRN",19.1,0)
19.1
"BLD",6345,"KRN",101,0)
101
"BLD",6345,"KRN",409.61,0)
409.61
"BLD",6345,"KRN",771,0)
771
"BLD",6345,"KRN",870,0)
870
"BLD",6345,"KRN",8989.51,0)
8989.51
"BLD",6345,"KRN",8989.52,0)
8989.52
"BLD",6345,"KRN",8994,0)
8994
"BLD",6345,"KRN","B",.4,.4)

"BLD",6345,"KRN","B",.401,.401)

"BLD",6345,"KRN","B",.402,.402)

"BLD",6345,"KRN","B",.403,.403)

"BLD",6345,"KRN","B",.5,.5)

"BLD",6345,"KRN","B",.84,.84)

"BLD",6345,"KRN","B",3.6,3.6)

"BLD",6345,"KRN","B",3.8,3.8)

"BLD",6345,"KRN","B",9.2,9.2)

"BLD",6345,"KRN","B",9.8,9.8)

"BLD",6345,"KRN","B",19,19)

"BLD",6345,"KRN","B",19.1,19.1)

"BLD",6345,"KRN","B",101,101)

"BLD",6345,"KRN","B",409.61,409.61)

"BLD",6345,"KRN","B",771,771)

"BLD",6345,"KRN","B",870,870)

"BLD",6345,"KRN","B",8989.51,8989.51)

"BLD",6345,"KRN","B",8989.52,8989.52)

"BLD",6345,"KRN","B",8994,8994)

"BLD",6345,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",518,-1)
1^1
"PKG",518,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",518,20,0)
^9.402P^^
"PKG",518,22,0)
^9.49I^1^1
"PKG",518,22,1,0)
1.0^2980925^2981209^3694
"PKG",518,22,1,"PAH",1,0)
18^3051007
"PKG",518,22,1,"PAH",1,1,0)
^^1^1^3051007
"PKG",518,22,1,"PAH",1,1,1,0)
DUZ undefinied fix in WVRALINK
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","WVRALINK")
0^1^B49986932
"RTN","WVRALINK",1,0)
WVRALINK ;HCIOFO/FT-RAD/NM-WOMEN'S HEALTH LINK  ;6/10/04  14:51
"RTN","WVRALINK",2,0)
 ;;1.0;WOMEN'S HEALTH;**3,5,7,9,10,16,18**;Sep 30, 1998
"RTN","WVRALINK",3,0)
 ;
"RTN","WVRALINK",4,0)
 ; This routine uses the following IAs:
"RTN","WVRALINK",5,0)
 ; #2480  - FILE 70         (private)
"RTN","WVRALINK",6,0)
 ; #2481  - FILE 71         (private)
"RTN","WVRALINK",7,0)
 ; #2482  - FILE 71.2       (private)
"RTN","WVRALINK",8,0)
 ; #10035 - FILE 2          (supported)
"RTN","WVRALINK",9,0)
 ; #10063 - ^%ZTLOAD        (supported)
"RTN","WVRALINK",10,0)
 ; #10070 - ^XMD            (supported)
"RTN","WVRALINK",11,0)
 ; #10141 - ^XPDUTL         (supported)
"RTN","WVRALINK",12,0)
 ;
"RTN","WVRALINK",13,0)
 ;;  Original routine created by IHS/ANMC/MWR
"RTN","WVRALINK",14,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRALINK",15,0)
 ;;  CREATE MAMMOGRAM PROCEDURE IN WOMEN'S HEALTH FOR THIS PATIENT.
"RTN","WVRALINK",16,0)
 ;;  CALLED BY ^RART WHEN A RADIOLOGY REPORT IS VERIFIED.
"RTN","WVRALINK",17,0)
 ;;  CALLED BY ^RARTE1 WHEN A RADIOLOGY REPORT IS UNVERIFIED.
"RTN","WVRALINK",18,0)
 ;;  CALLED BY ^WVEXPTRA WHEN EXPORTING HISTORICAL MAMS TO WOMEN'S HEALTH
"RTN","WVRALINK",19,0)
 ;
"RTN","WVRALINK",20,0)
 ;---> REQUIRED VARIABLES: DFN  = DFN OF RADIOLOGY PATIENT.
"RTN","WVRALINK",21,0)
 ;--->                     DATE = INVERSE DATE/TIME OF VISIT.
"RTN","WVRALINK",22,0)
 ;--->                     CASE = IEN OF RADIOLOGY EXAM (CASE).
"RTN","WVRALINK",23,0)
 ;
"RTN","WVRALINK",24,0)
 ;---> OPTIONAL VARIABLE:  WVNEWP = TOTAL NEW WH PATIENTS ADDED.
"RTN","WVRALINK",25,0)
 ;--->                     WVMCNT = TOTAL NEW MAMS PROCEDURES ADDED.
"RTN","WVRALINK",26,0)
 ;--->                     THESE IF CALLED FROM ^WVEXPTRA ROUTINE.
"RTN","WVRALINK",27,0)
 ;
"RTN","WVRALINK",28,0)
 ;---> GENERATED VARIBLES:
"RTN","WVRALINK",29,0)
 ;---> WVPROC = IEN OF RADIOLOGY PROCEDURE (FILE #71), THEN IT
"RTN","WVRALINK",30,0)
 ;--->          GETS CHANGED TO WOMEN'S HEALTH PROCEDURE TYPE
"RTN","WVRALINK",31,0)
 ;--->                                   (FILE #790.2).
"RTN","WVRALINK",32,0)
 ;---> WVLOC  = WARD/CLINIC/LOCATION (FILE #44).
"RTN","WVRALINK",33,0)
 ;---> WVDATE = DATE OF THE PROCEDURE.
"RTN","WVRALINK",34,0)
 ;---> WVPROV = ORDERING PROVIDER.
"RTN","WVRALINK",35,0)
 ;---> WVMOD  = LEFT OR RIGHT, IF IT'S A UNILATERAL MAMMOGRAM.
"RTN","WVRALINK",36,0)
 ;---> WVDX   = RADIOLOGY DIAGNOSTIC CODE.
"RTN","WVRALINK",37,0)
 ;---> WVBWDX = WOMEN'S HEALTH RESULT/DIAGNOSIS.
"RTN","WVRALINK",38,0)
 ;
"RTN","WVRALINK",39,0)
CREATE(DFN,DATE,CASE) ;
"RTN","WVRALINK",40,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",41,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")
"RTN","WVRALINK",42,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",43,0)
 S:'$D(DUZ)#2 DUZ=.5
"RTN","WVRALINK",44,0)
 S:'$D(DUZ(2))#2 DUZ(2)=$$KSP^XUPARAM("INST")
"RTN","WVRALINK",45,0)
 S ZTRTN="CREATEQ^WVRALINK",ZTDESC="WV CREATE MAMMOGRAM ENTRY"
"RTN","WVRALINK",46,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",47,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",48,0)
 D ^%ZTLOAD
"RTN","WVRALINK",49,0)
 Q
"RTN","WVRALINK",50,0)
CREATEH(DFN,DATE,CASE,STATUS) ; Entry from ^WVEXPTRA which looks for exams
"RTN","WVRALINK",51,0)
 ; created before the WH package was installed.
"RTN","WVRALINK",52,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")!($G(STATUS)']"")
"RTN","WVRALINK",53,0)
 ; 
"RTN","WVRALINK",54,0)
CREATEQ ; Queue data entry creation. Called from CREATE above
"RTN","WVRALINK",55,0)
 N WVPROC,WVLOC,WVDATE,WVDR,WVPROV,WVMOD,WVDX,WVBWDX,WVLEFT,WVRIGHT
"RTN","WVRALINK",56,0)
 N WVCASE,WVCPT,WVERR,WVCREDIT,WVEXAM0,WVZSTAT
"RTN","WVRALINK",57,0)
 ;---> QUIT IF RADIOLOGY DATA IS NOT DEFINED OR ="".
"RTN","WVRALINK",58,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",59,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",60,0)
 ;
"RTN","WVRALINK",61,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE A MAM CPT CODE.
"RTN","WVRALINK",62,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE AN ULTRASOUND CPT CODE.
"RTN","WVRALINK",63,0)
 ;---> WVEXAM0=ZERO NODE OF RADIOLOGY EXAM.
"RTN","WVRALINK",64,0)
 S WVEXAM0=^RADPT(DFN,"DT",DATE,"P",CASE,0)
"RTN","WVRALINK",65,0)
 S WVCPT=$$GET1^DIQ(71,$P(WVEXAM0,U,2),9,"I") Q:WVCPT=""
"RTN","WVRALINK",66,0)
 S WVPROC=$O(^WV(790.2,"AC",WVCPT,0)) ;cpt code x-ref to get 790.2 ien
"RTN","WVRALINK",67,0)
 Q:'WVPROC  ;cpt code is not tracked in 790.2
"RTN","WVRALINK",68,0)
 Q:$P($G(^WV(790.2,+WVPROC,0)),U,5)'="R"  ;cpt is not rad/nm procedure
"RTN","WVRALINK",69,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVRALINK",70,0)
 ;
"RTN","WVRALINK",71,0)
 ;---> QUIT IF NO WOMEN'S HEALTH SITE PARAMETER FILE ON THIS MACHINE.
"RTN","WVRALINK",72,0)
 ;     OR NO DEFAULT CASE MANAGER
"RTN","WVRALINK",73,0)
 Q:'$D(^WV(790.02,DUZ(2)))
"RTN","WVRALINK",74,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,2)
"RTN","WVRALINK",75,0)
 ;
"RTN","WVRALINK",76,0)
 ;---> IF NOT CALLED FROM ^WVEXPTRA (i.e., STATUS is undefined) CHECK
"RTN","WVRALINK",77,0)
 ;---> SITE PARAMETER AND QUIT IF "IMPORT MAMMOGRAMS FROM RADIOLOGY"
"RTN","WVRALINK",78,0)
 ;---> IS NOT SET TO "YES". CHECK VETERAN STATUS AND ELIGIBILITY CODE.
"RTN","WVRALINK",79,0)
 N Y S Y=^WV(790.02,DUZ(2),0)
"RTN","WVRALINK",80,0)
 I '$D(STATUS) Q:'$P(Y,U,10)
"RTN","WVRALINK",81,0)
 I '$D(STATUS) Q:'$$VNVEC^WVRALIN1()  ;vet/non-vet/eligibility code check
"RTN","WVRALINK",82,0)
 ;
"RTN","WVRALINK",83,0)
 ;---> SET WVZSTAT =THE STATUS (OPEN OR CLOSED) IN WOMEN'S HEALTH.
"RTN","WVRALINK",84,0)
 ;---> THAT MAMMOGRAMS SHOULD RECEIVE WHEN COPIED OVER FROM RADIOLOGY.
"RTN","WVRALINK",85,0)
 S WVZSTAT=$P(Y,U,23) S:WVZSTAT="" WVZSTAT="o"
"RTN","WVRALINK",86,0)
 I $G(STATUS)]"" S WVZSTAT=$G(STATUS) ;status selected in ^WVEXPTRA
"RTN","WVRALINK",87,0)
 ;
"RTN","WVRALINK",88,0)
 D COPY(WVEXAM0)
"RTN","WVRALINK",89,0)
 ;
"RTN","WVRALINK",90,0)
EXIT ;EP
"RTN","WVRALINK",91,0)
 K I,N,X
"RTN","WVRALINK",92,0)
 Q
"RTN","WVRALINK",93,0)
 ;
"RTN","WVRALINK",94,0)
COPY(Y) ;EP
"RTN","WVRALINK",95,0)
 ;---> COPY MAM PROCEDURE DATA FROM RADIOLOGY TO WOMEN'S HEALTH.
"RTN","WVRALINK",96,0)
 ;---> VARIABLE DFN=PATIENT
"RTN","WVRALINK",97,0)
 ;---> LOCATION=DUZ(2)
"RTN","WVRALINK",98,0)
 ;---> WARD/CLINIC/LOCATION
"RTN","WVRALINK",99,0)
 N X
"RTN","WVRALINK",100,0)
 S WVLOC=$P(Y,U,8)
"RTN","WVRALINK",101,0)
 ;
"RTN","WVRALINK",102,0)
 ;---> WVDATE=DATE OF THE PROCEDURE.
"RTN","WVRALINK",103,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",104,0)
 ;
"RTN","WVRALINK",105,0)
 ;---> RECONSTRUCT THE FULL CASE# FOR THIS RAD PROCEDURE.
"RTN","WVRALINK",106,0)
 ;---> THIS IS USED AS A LINK (XREF) BETWEEN THE RADIOLOGY PROCEDURE
"RTN","WVRALINK",107,0)
 ;---> AND THE WOMEN'S HEALTH PROCEDURE.
"RTN","WVRALINK",108,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_$P(Y,U)
"RTN","WVRALINK",109,0)
 ;---> CHECK TO BE SURE THE CASE# XREF IS REALLY DOWN THERE.
"RTN","WVRALINK",110,0)
 S:'$D(^RADPT("ADC",WVCASE,DFN,DATE,CASE)) WVCASE="UNKNOWN"
"RTN","WVRALINK",111,0)
 ;
"RTN","WVRALINK",112,0)
 ;---> QUIT IF THIS PROCEDURE HAS ALREADY BEEN SENT TO WOMEN'S HEALTH.
"RTN","WVRALINK",113,0)
 Q:$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",114,0)
 ;
"RTN","WVRALINK",115,0)
 ;---> REQUESTING PROVIDER/ORDERING PROVIDER
"RTN","WVRALINK",116,0)
 S WVPROV=$P(Y,U,14)
"RTN","WVRALINK",117,0)
 ;
"RTN","WVRALINK",118,0)
 ;---> IF UNILATERAL, ATTEMPT TO PICK UP LEFT OR RIGHT MODIFIER.
"RTN","WVRALINK",119,0)
 I WVPROC=26 D
"RTN","WVRALINK",120,0)
 .I $D(^RADPT(DFN,"DT",DATE,"P",CASE,"M",0)) D
"RTN","WVRALINK",121,0)
 ..N N S N=0
"RTN","WVRALINK",122,0)
 ..F  S N=$O(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N)) Q:'N  D
"RTN","WVRALINK",123,0)
 ...S WVMOD=$P(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N,0),U)
"RTN","WVRALINK",124,0)
 ...S WVMOD=$$GET1^DIQ(71.2,WVMOD,.01,"I")
"RTN","WVRALINK",125,0)
 ...I "LEFTleft"[WVMOD S WVLEFT=1
"RTN","WVRALINK",126,0)
 ...I "RIGHTright"[WVMOD S WVRIGHT=1
"RTN","WVRALINK",127,0)
 ..Q:$D(WVLEFT)&($D(WVRIGHT))
"RTN","WVRALINK",128,0)
 ..I $D(WVLEFT) S WVMOD="l" Q
"RTN","WVRALINK",129,0)
 ..I $D(WVRIGHT) S WVMOD="r" Q
"RTN","WVRALINK",130,0)
 ;
"RTN","WVRALINK",131,0)
 ;---> IF THERE'S A DIAGNOSTIC CODE, ATTEMPT TO PICK UP DIAGNOSIS.
"RTN","WVRALINK",132,0)
 ;---> USE "WV DIAGNOSTIC CODE TRANSLATION" FILE #790.32.
"RTN","WVRALINK",133,0)
 S WVDX=$P(Y,U,13)
"RTN","WVRALINK",134,0)
 I +WVDX I $D(^WV(790.32,"C",WVDX)) S WVBWDX=$O(^WV(790.32,"C",WVDX,0))
"RTN","WVRALINK",135,0)
 ;
"RTN","WVRALINK",136,0)
 ;---> GET CREDIT METHOD.
"RTN","WVRALINK",137,0)
 S WVCREDIT=$P(Y,U,26)
"RTN","WVRALINK",138,0)
 ;
"RTN","WVRALINK",139,0)
PATIENT ;---> IF PATIENT ISN'T IN WOMEN'S HEALTH DATABASE, ADD HER.
"RTN","WVRALINK",140,0)
 S WVERR=1
"RTN","WVRALINK",141,0)
 I '$D(^WV(790,DFN,0)) D
"RTN","WVRALINK",142,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVRALINK",143,0)
 .I $D(WVNEWP) S:WVERR WVNEWP=WVNEWP+1
"RTN","WVRALINK",144,0)
 Q:WVERR<0
"RTN","WVRALINK",145,0)
 D FIND^WVRALIN1 ;check for 'unlinked' entry in File 790.1
"RTN","WVRALINK",146,0)
 Q:$D(^WV(790.1,"E",WVCASE))  ;quit if link was made in WVRALIN1
"RTN","WVRALINK",147,0)
PROC ;---> CREATE MAMMOGRAM PROCEDURE IN WV PROCEDURE FILE #790.1.
"RTN","WVRALINK",148,0)
 S WVDR=".02////"_DFN_";.04////"_WVPROC
"RTN","WVRALINK",149,0)
 S WVDR=WVDR_";.05////"_$G(WVBWDX)_";.07////"_WVPROV
"RTN","WVRALINK",150,0)
 S WVDR=WVDR_";.09////"_$G(WVMOD)_";.1////"_DUZ(2)_";.11////"_WVLOC
"RTN","WVRALINK",151,0)
 S WVDR=WVDR_";.12////"_WVDATE_";.14////"_WVZSTAT_";.15////"_WVCASE
"RTN","WVRALINK",152,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT_";.34////"_$G(DUZ(2))_";.35////"_WVCREDIT
"RTN","WVRALINK",153,0)
 ;
"RTN","WVRALINK",154,0)
 D NEW2^WVPROC(DFN,WVPROC,WVDATE,WVDR,"","",.WVERR)
"RTN","WVRALINK",155,0)
 I $D(WVMCNT) S:WVERR>-1 WVMCNT=WVMCNT+1
"RTN","WVRALINK",156,0)
 Q:WVERR<0  ;procedure not added
"RTN","WVRALINK",157,0)
 Q:$D(WVMCNT)  ;mass import of Rad/NM exams
"RTN","WVRALINK",158,0)
 ;Q:$P($G(^WV(790.02,+DUZ(2),0)),U,23)="c"  ;Status=closed
"RTN","WVRALINK",159,0)
 I (WVCPT=76856)!(WVCPT=76830)!(WVCPT=76645) D  Q  ;not breast related
"RTN","WVRALINK",160,0)
 .D MAIL^WVRADWP(DFN,+Y,WVPROC,WVPROV) ;iens for patient, accession, procedure, provider/requestor
"RTN","WVRALINK",161,0)
 .Q
"RTN","WVRALINK",162,0)
 D CPRS^WVSNOMED(69,DFN,"",WVPROV,"Mammogram results available.","")
"RTN","WVRALINK",163,0)
 Q
"RTN","WVRALINK",164,0)
 ;
"RTN","WVRALINK",165,0)
DELETE(DFN,DATE,CASE) ;EP
"RTN","WVRALINK",166,0)
 ;---> MODIFY WOMEN'S HEALTH PROCEDURE TO REFLECT CHANGE.
"RTN","WVRALINK",167,0)
 ;---> CALLED FROM RARTE1 (DELETE A REPORT AND UNVERIFY A REPORT).
"RTN","WVRALINK",168,0)
 ;
"RTN","WVRALINK",169,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",170,0)
 Q:'$D(DFN)!('$D(DATE))!('$D(CASE))
"RTN","WVRALINK",171,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",172,0)
 S ZTRTN="DELETEQ^WVRALINK",ZTDESC="WV MAMMOGRAM RPT CHANGE"
"RTN","WVRALINK",173,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",174,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",175,0)
 D ^%ZTLOAD
"RTN","WVRALINK",176,0)
 Q
"RTN","WVRALINK",177,0)
DELETEQ ; Modify WV entry when mammogram report is unverified or deleted
"RTN","WVRALINK",178,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",179,0)
 N WVIEN,WVDATE,WVCASE,WVCMGR,WVLOOP,WVMSG,WVPROV
"RTN","WVRALINK",180,0)
 N XMDUZ,XMSUB,XMTEXT,XMY ;send mail message to case manager
"RTN","WVRALINK",181,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",182,0)
 ;
"RTN","WVRALINK",183,0)
 ;---> WVDATE=DATE OF PROCEDURE.
"RTN","WVRALINK",184,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",185,0)
 S WVCASE=$P(^RADPT(DFN,"DT",DATE,"P",CASE,0),U)
"RTN","WVRALINK",186,0)
 ;
"RTN","WVRALINK",187,0)
 ;---> WVCASE=RECONSTRUCTED CASE# OF PROCEDURE.
"RTN","WVRALINK",188,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_WVCASE
"RTN","WVRALINK",189,0)
 ;---> QUIT IF NO CASE# XREF IN WOMEN'S HEALTH PROCEDURE FILE.
"RTN","WVRALINK",190,0)
 Q:'$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",191,0)
 ;
"RTN","WVRALINK",192,0)
 S WVIEN=$O(^WV(790.1,"E",WVCASE,0))
"RTN","WVRALINK",193,0)
 Q:'$D(^WV(790.1,WVIEN,0))
"RTN","WVRALINK",194,0)
 D RADMOD^WVPROC(WVIEN) ;update wh status to "open"
"RTN","WVRALINK",195,0)
 S WVPROV=+$$GET1^DIQ(790.1,WVIEN,.07,"I") ;get provider/requestor
"RTN","WVRALINK",196,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVRALINK",197,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",198,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVRALINK",199,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVRALINK",200,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVRALINK",201,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",202,0)
 .Q
"RTN","WVRALINK",203,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVRALINK",204,0)
 S:WVPROV XMY(WVPROV)=""
"RTN","WVRALINK",205,0)
 S XMDUZ=.5 ;message sender
"RTN","WVRALINK",206,0)
 S XMSUB="RAD/NM Rpt for WH patient is UNVERIFIED/DELETED"
"RTN","WVRALINK",207,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVRALINK",208,0)
 S WVMSG(2)=" WH Accession #: "_$P($G(^WV(790.1,+WVIEN,0)),U,1)
"RTN","WVRALINK",209,0)
 S WVMSG(3)="  RAD/NM Case #: "_WVCASE
"RTN","WVRALINK",210,0)
 S WVMSG(4)=" "
"RTN","WVRALINK",211,0)
 S WVMSG(5)="NOTE: THIS PROCEDURE HAS BEEN ALTERED IN RADIOLOGY/NM."
"RTN","WVRALINK",212,0)
 S WVMSG(6)="Follow-up is required in the WOMEN'S HEALTH package!"
"RTN","WVRALINK",213,0)
 S XMTEXT="WVMSG("
"RTN","WVRALINK",214,0)
 D ^XMD
"RTN","WVRALINK",215,0)
 Q
"VER")
8.0^22.0
"BLD",6345,6)
^SEQ #18
**END**
**END**
