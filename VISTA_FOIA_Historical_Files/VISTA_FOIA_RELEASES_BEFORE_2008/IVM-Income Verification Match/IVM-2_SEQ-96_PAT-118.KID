Released IVM*2*118 SEQ #96
Extracted from mail message
**KIDS**:IVM*2.0*118^

**INSTALL NAME**
IVM*2.0*118
"BLD",6272,0)
IVM*2.0*118^INCOME VERIFICATION MATCH^0^3060710^y
"BLD",6272,1,0)
^^2^2^3060407^
"BLD",6272,1,1,0)
This patch updates an earlier single-message link to process batch
"BLD",6272,1,2,0)
messages and initiate the generation of A31 Update Person messages.
"BLD",6272,4,0)
^9.64PA^^
"BLD",6272,"ABPKG")
n
"BLD",6272,"KRN",0)
^9.67PA^8989.52^19
"BLD",6272,"KRN",.4,0)
.4
"BLD",6272,"KRN",.401,0)
.401
"BLD",6272,"KRN",.402,0)
.402
"BLD",6272,"KRN",.403,0)
.403
"BLD",6272,"KRN",.5,0)
.5
"BLD",6272,"KRN",.84,0)
.84
"BLD",6272,"KRN",3.6,0)
3.6
"BLD",6272,"KRN",3.8,0)
3.8
"BLD",6272,"KRN",9.2,0)
9.2
"BLD",6272,"KRN",9.8,0)
9.8
"BLD",6272,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6272,"KRN",9.8,"NM",1,0)
IVMPREC2^^0^B11517998
"BLD",6272,"KRN",9.8,"NM","B","IVMPREC2",1)

"BLD",6272,"KRN",19,0)
19
"BLD",6272,"KRN",19.1,0)
19.1
"BLD",6272,"KRN",101,0)
101
"BLD",6272,"KRN",409.61,0)
409.61
"BLD",6272,"KRN",771,0)
771
"BLD",6272,"KRN",870,0)
870
"BLD",6272,"KRN",8989.51,0)
8989.51
"BLD",6272,"KRN",8989.52,0)
8989.52
"BLD",6272,"KRN",8994,0)
8994
"BLD",6272,"KRN","B",.4,.4)

"BLD",6272,"KRN","B",.401,.401)

"BLD",6272,"KRN","B",.402,.402)

"BLD",6272,"KRN","B",.403,.403)

"BLD",6272,"KRN","B",.5,.5)

"BLD",6272,"KRN","B",.84,.84)

"BLD",6272,"KRN","B",3.6,3.6)

"BLD",6272,"KRN","B",3.8,3.8)

"BLD",6272,"KRN","B",9.2,9.2)

"BLD",6272,"KRN","B",9.8,9.8)

"BLD",6272,"KRN","B",19,19)

"BLD",6272,"KRN","B",19.1,19.1)

"BLD",6272,"KRN","B",101,101)

"BLD",6272,"KRN","B",409.61,409.61)

"BLD",6272,"KRN","B",771,771)

"BLD",6272,"KRN","B",870,870)

"BLD",6272,"KRN","B",8989.51,8989.51)

"BLD",6272,"KRN","B",8989.52,8989.52)

"BLD",6272,"KRN","B",8994,8994)

"BLD",6272,"QUES",0)
^9.62^^
"BLD",6272,"REQB",0)
^9.611^1^1
"BLD",6272,"REQB",1,0)
IVM*2.0*112^2
"BLD",6272,"REQB","B","IVM*2.0*112",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
118^3060710
"PKG",220,22,1,"PAH",1,1,0)
^^2^2^3060710
"PKG",220,22,1,"PAH",1,1,1,0)
This patch updates an earlier single-message link to process batch
"PKG",220,22,1,"PAH",1,1,2,0)
messages and initiate the generation of A31 Update Person messages.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMPREC2")
0^1^B11517998^B11485332
"RTN","IVMPREC2",1,0)
IVMPREC2 ;ALB/KCL - ROUTE INCOMING HL7 (ORU) MESSAGES BY EVENT TYPE ;5/17/02 1:43pm
"RTN","IVMPREC2",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**12,34,112,118**;21-OCT-94
"RTN","IVMPREC2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPREC2",4,0)
 ;
"RTN","IVMPREC2",5,0)
 ; This routine will process (ORU) HL7 messages received from the
"RTN","IVMPREC2",6,0)
 ; IVM center. Event type code indicating type of transmission is
"RTN","IVMPREC2",7,0)
 ; in the BHS segment. Routines based on type will be called to
"RTN","IVMPREC2",8,0)
 ; process these messages.  For each batch an ACK will be sent to
"RTN","IVMPREC2",9,0)
 ; the IVM Center indicating errors found.  If any errors are found
"RTN","IVMPREC2",10,0)
 ; a batch message with AE(indicating error(s)) is sent.  If no errors
"RTN","IVMPREC2",11,0)
 ; only a MSH and MSA with AA(no errors) is sent. The following event
"RTN","IVMPREC2",12,0)
 ; type codes are processed in the following routines:
"RTN","IVMPREC2",13,0)
 ;
"RTN","IVMPREC2",14,0)
 ;    EVENT CODE    TRANSMISSION TYPE             PROCESSING ROUTINE
"RTN","IVMPREC2",15,0)
 ;    ==============================================================
"RTN","IVMPREC2",16,0)
 ;       Z03        SSN TRANSMISSIONS                  IVMPREC5
"RTN","IVMPREC2",17,0)
 ;       Z04        INSURANCE TRANSMISSIONS            IVMPREC3
"RTN","IVMPREC2",18,0)
 ;       Z05        DEMOGRAPHIC TRANSMISSIONS          IVMPREC6
"RTN","IVMPREC2",19,0)
 ;       Z06        MEANS TEST TRANSMISSIONS           IVMPREC7
"RTN","IVMPREC2",20,0)
 ;       Z08        CASE STATUS TRANSMISSIONS          IVMPREC4
"RTN","IVMPREC2",21,0)
 ;       Z10        INCOME TEST TRANSMISSIONS          IVMCM
"RTN","IVMPREC2",22,0)
 ;       Z11        ENROLLMENT/ELIGIBILTY              ORUZ11^DGENUPL
"RTN","IVMPREC2",23,0)
 ;
"RTN","IVMPREC2",24,0)
 ;
"RTN","IVMPREC2",25,0)
ORU ; - Receive Observational Results Unsolicited Message
"RTN","IVMPREC2",26,0)
 ;
"RTN","IVMPREC2",27,0)
 N DIC,%,%H,%I D NOW^%DTC S HLDT=%
"RTN","IVMPREC2",28,0)
 K HLERR,IVMSEG1,IVMSEG2,IVMSEG3
"RTN","IVMPREC2",29,0)
 S (HLEVN,IVMCT,IVMERROR,IVMCNTR)=0
"RTN","IVMPREC2",30,0)
 ; Make sure POSTMASTER DUZ instead of DUZ of Person who
"RTN","IVMPREC2",31,0)
 ; started Incoming Logical Link
"RTN","IVMPREC2",32,0)
 S DUZ=.5
"RTN","IVMPREC2",33,0)
 ;
"RTN","IVMPREC2",34,0)
 ; - get incoming segment from HL7 (#772) file
"RTN","IVMPREC2",35,0)
 N IVMRTN,SEGCNT,CNT,STATION,HLEID,HLEIDS
"RTN","IVMPREC2",36,0)
 S IVMRTN="IVMPREC2" K ^TMP($J,IVMRTN),^TMP("HLA",$J),^TMP("HLS",$J)
"RTN","IVMPREC2",37,0)
 F SEGCNT=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","IVMPREC2",38,0)
 . S CNT=0
"RTN","IVMPREC2",39,0)
 . S ^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE
"RTN","IVMPREC2",40,0)
 . F  S CNT=$O(HLNODE(CNT)) Q:'CNT  S ^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE(CNT)
"RTN","IVMPREC2",41,0)
 ;
"RTN","IVMPREC2",42,0)
 S HLDA=HLMTIEN
"RTN","IVMPREC2",43,0)
 S IVMSEG=$G(^TMP($J,IVMRTN,1,0)) I IVMSEG']"" G ORUQ
"RTN","IVMPREC2",44,0)
 ;
"RTN","IVMPREC2",45,0)
 ; - check for BHS 
"RTN","IVMPREC2",46,0)
 I $E(IVMSEG,1,3)'="BHS" G ORUQ
"RTN","IVMPREC2",47,0)
 ;
"RTN","IVMPREC2",48,0)
 ; - get batch control id
"RTN","IVMPREC2",49,0)
 S HLFS=HL("FS")
"RTN","IVMPREC2",50,0)
 S HLECH=HL("ECH")
"RTN","IVMPREC2",51,0)
 S HLQ=$G(HL("HLQ")) S:HLQ="" HLQ=""""""
"RTN","IVMPREC2",52,0)
 S IVMHLMID=$P(IVMSEG,HLFS,11)
"RTN","IVMPREC2",53,0)
 S STATION=$P(IVMSEG,HLFS,6)
"RTN","IVMPREC2",54,0)
 ;
"RTN","IVMPREC2",55,0)
 ; - get event type code
"RTN","IVMPREC2",56,0)
 S IVMETC=$P($P(IVMSEG,HLFS,9),$E(HLECH),3)
"RTN","IVMPREC2",57,0)
 S IVMETC=$P(IVMETC,$E(HLECH,2),2)
"RTN","IVMPREC2",58,0)
 S HLEID="VAMC "_STATION_" ORU-"_IVMETC_" SERVER"
"RTN","IVMPREC2",59,0)
 I IVMETC="Z04" S HLEID=HLEID_" H"  ;HEC TO VAMC
"RTN","IVMPREC2",60,0)
 S HLEID=$O(^ORD(101,"B",HLEID,0)),HLEIDS=""
"RTN","IVMPREC2",61,0)
 I HLEID]"" S HLEIDS=$O(^ORD(101,HLEID,775,"B",0))
"RTN","IVMPREC2",62,0)
 ;
"RTN","IVMPREC2",63,0)
 ; - process the message according to the event type code
"RTN","IVMPREC2",64,0)
 S IVMDO=$S(IVMETC="Z03":"EN^IVMPREC5",IVMETC="Z04":"EN^IVMPREC3",IVMETC="Z05":"EN^IVMPREC6",IVMETC="Z06":"EN^IVMPREC7",IVMETC="Z08":"EN^IVMPREC4",IVMETC="Z10":"ORU^IVMCM",IVMETC="Z11":"ORUZ11^DGENUPL",1:"ORUQ")
"RTN","IVMPREC2",65,0)
 I IVMETC="Z11" D
"RTN","IVMPREC2",66,0)
 .D ORUZ11^DGENUPL(HLDA,.IVMERROR)
"RTN","IVMPREC2",67,0)
 .S IVMCT=2*IVMERROR
"RTN","IVMPREC2",68,0)
 .S HLEVN=IVMERROR
"RTN","IVMPREC2",69,0)
 I IVMETC'="Z11" D
"RTN","IVMPREC2",70,0)
 .D @IVMDO
"RTN","IVMPREC2",71,0)
 Q:IVMDO="ORUQ" 
"RTN","IVMPREC2",72,0)
 ;
"RTN","IVMPREC2",73,0)
 ; - if no error send ACK 'AA' message
"RTN","IVMPREC2",74,0)
 S HLMTN="ACK"
"RTN","IVMPREC2",75,0)
 K HLARYTYP,HLMTIENA,HLRESLTA,HLP
"RTN","IVMPREC2",76,0)
 I 'IVMERROR S HLMID=IVMHLMID D ACK^IVMPREC S HLARYTYP="GM",HLMTIENA=""
"RTN","IVMPREC2",77,0)
 I IVMERROR S HLARYTYP="GB",HLMTIENA=HLMTIEN  ;HLMTIEN comes from ACK^IVMPREC
"RTN","IVMPREC2",78,0)
 K ^TMP("HLA",$J) M ^TMP("HLA",$J)=^TMP("HLS",$J) K ^TMP("HLS",$J)
"RTN","IVMPREC2",79,0)
 D GENACK^HLMA1(HLEID,HLMTIENS,HLEIDS,HLARYTYP,1,.HLRESLTA,HLMTIENA,.HLP)
"RTN","IVMPREC2",80,0)
 ; The following line is added for  PFSS Registration.  This line will ensure any patient 
"RTN","IVMPREC2",81,0)
 ; registration updates received from the HEC are forwarded to a COTS billing application
"RTN","IVMPREC2",82,0)
 ; See DBIA#4840
"RTN","IVMPREC2",83,0)
 S X="DGPFSS2" X ^%ZOSF("TEST") I $T D BATCH^DGPFSS2(IVMRTN)
"RTN","IVMPREC2",84,0)
 ;
"RTN","IVMPREC2",85,0)
ORUQ ;
"RTN","IVMPREC2",86,0)
 K DFN,IVMCNTR,IVMCT,IVMDA,IVMERR,IVMERROR,IVMHLMID,IVMNDE,IVMPTID
"RTN","IVMPREC2",87,0)
 K IVMSEG,IVMSEG1,IVMSEG2,IVMSEG3,IVMTEXT,XMSUB
"RTN","IVMPREC2",88,0)
 K HLARYTYP,HLMTIENA,HLRESLTA,HLP
"RTN","IVMPREC2",89,0)
 K ^TMP($J,IVMRTN),^TMP("HLA",$J),^TMP("HLS",$J)
"RTN","IVMPREC2",90,0)
 Q
"VER")
8.0^22.0
"BLD",6272,6)
^96
**END**
**END**
