KIDS Distribution saved on Aug 22, 2007@10:41:11
BPS*1.0*5, PSO*7.0*260, IB*2.0*363 BUNDLE
**KIDS**:BPS PSO IB BUNDLE 2.0^BPS*1.0*5^PSO*7.0*260^IB*2.0*363^

**INSTALL NAME**
BPS PSO IB BUNDLE 2.0
"BLD",6627,0)
BPS PSO IB BUNDLE 2.0^^1^3070822^y
"BLD",6627,1,0)
^^10^10^3070413^
"BLD",6627,1,1,0)
The general purpose of this multi-build is to meet the requirements in
"BLD",6627,1,2,0)
support of the Phase 4 ePharmacy enhancements. Three patches will be
"BLD",6627,1,3,0)
released in the KIDS multi-build distribution, BPS PSO IB BUNDLE 2.0,
"BLD",6627,1,4,0)
containing: BPS*1*5, IB*2*363, PSO*7*260.  PSX*2*63 will be released as a
"BLD",6627,1,5,0)
stand-alone patch.    The recommended order for installing the patches is
"BLD",6627,1,6,0)
to install the stand-alone patch first and multi-build must be installed
"BLD",6627,1,7,0)
second. This is due to a implementation dependency between the multi-build
"BLD",6627,1,8,0)
distribution and the stand-alone patch.  For more specific instructions
"BLD",6627,1,9,0)
please refer to the installation steps provided in each of the stand-alone
"BLD",6627,1,10,0)
patches.
"BLD",6627,6.3)
21
"BLD",6627,10,0)
^9.63^3^3
"BLD",6627,10,1,0)
BPS*1.0*5^1
"BLD",6627,10,2,0)
PSO*7.0*260^1
"BLD",6627,10,3,0)
IB*2.0*363^1
"BLD",6627,10,"B","BPS*1.0*5",1)

"BLD",6627,10,"B","IB*2.0*363",3)

"BLD",6627,10,"B","PSO*7.0*260",2)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
BPS*1.0*5
"BLD",6454,0)
BPS*1.0*5^E CLAIMS MGMT ENGINE^0^3070822^y
"BLD",6454,1,0)
^^21^21^3070604^
"BLD",6454,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans
"BLD",6454,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic
"BLD",6454,1,3,0)
pharmacy (ePharmacy) system.  Below is a list of all the applications
"BLD",6454,1,4,0)
involved in this project along with their patch number:
"BLD",6454,1,5,0)
  
"BLD",6454,1,6,0)
   APPLICATION/VERSION                                  PATCH
"BLD",6454,1,7,0)
   --------------------------------------------------------------
"BLD",6454,1,8,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*260
"BLD",6454,1,9,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*363
"BLD",6454,1,10,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*5
"BLD",6454,1,11,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*127
"BLD",6454,1,12,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*63
"BLD",6454,1,13,0)
 
"BLD",6454,1,14,0)
The first three patches (BPS*1*5, IB*2*363,and PSO*7*260) will be
"BLD",6454,1,15,0)
released in the Kernel Installation and Distribution System (KIDS)
"BLD",6454,1,16,0)
multi-build distribution BPS PSO IB BUNDLE 2.0.  Patches PSX*2*63 and
"BLD",6454,1,17,0)
PSS*1*127 will be released as stand-alone patches.  Since there is an
"BLD",6454,1,18,0)
implementation dependency between the multi-build distribution and the
"BLD",6454,1,19,0)
stand-alone patches, PSX*2*63 and PSS*1*127 must be installed prior to
"BLD",6454,1,20,0)
the installation of the multi-build.  For more specific instructions
"BLD",6454,1,21,0)
please refer to the installation steps provided in each of the patches.
"BLD",6454,4,0)
^9.64PA^9002313.31^11
"BLD",6454,4,9002313.02,0)
9002313.02
"BLD",6454,4,9002313.02,222)
y^y^f^^^^n
"BLD",6454,4,9002313.12,0)
9002313.12
"BLD",6454,4,9002313.12,222)
y^y^f^^^^n
"BLD",6454,4,9002313.31,0)
9002313.31
"BLD",6454,4,9002313.31,222)
y^y^f^^^^n
"BLD",6454,4,9002313.56,0)
9002313.56
"BLD",6454,4,9002313.56,222)
y^y^f^^^^n
"BLD",6454,4,9002313.57,0)
9002313.57
"BLD",6454,4,9002313.57,222)
y^y^f^^^^n^^n
"BLD",6454,4,9002313.57,224)

"BLD",6454,4,9002313.58,0)
9002313.58
"BLD",6454,4,9002313.58,222)
y^y^f^^^^n^^n
"BLD",6454,4,9002313.58,224)

"BLD",6454,4,9002313.59,0)
9002313.59
"BLD",6454,4,9002313.59,222)
y^y^f^^^^n^^n
"BLD",6454,4,9002313.59,224)

"BLD",6454,4,9002313.8242,0)
9002313.8242
"BLD",6454,4,9002313.8242,222)
y^y^f^^n^^y^o^n
"BLD",6454,4,9002313.82461,0)
9002313.82461
"BLD",6454,4,9002313.82461,222)
y^y^f^^n^^y^o^n
"BLD",6454,4,9002313.91,0)
9002313.91
"BLD",6454,4,9002313.91,222)
y^y^f^^n^^y^r^n
"BLD",6454,4,9002313.99,0)
9002313.99
"BLD",6454,4,9002313.99,222)
y^y^f^^^^n
"BLD",6454,4,"B",9002313.02,9002313.02)

"BLD",6454,4,"B",9002313.12,9002313.12)

"BLD",6454,4,"B",9002313.31,9002313.31)

"BLD",6454,4,"B",9002313.56,9002313.56)

"BLD",6454,4,"B",9002313.57,9002313.57)

"BLD",6454,4,"B",9002313.58,9002313.58)

"BLD",6454,4,"B",9002313.59,9002313.59)

"BLD",6454,4,"B",9002313.8242,9002313.8242)

"BLD",6454,4,"B",9002313.82461,9002313.82461)

"BLD",6454,4,"B",9002313.91,9002313.91)

"BLD",6454,4,"B",9002313.99,9002313.99)

"BLD",6454,6.3)
45
"BLD",6454,"INI")

"BLD",6454,"INIT")
EN^BPS01P5
"BLD",6454,"KRN",0)
^9.67PA^8989.52^19
"BLD",6454,"KRN",.4,0)
.4
"BLD",6454,"KRN",.4,"NM",0)
^9.68A^10^10
"BLD",6454,"KRN",.4,"NM",1,0)
BPS GRACE    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM",2,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94^9002313.94^1^
"BLD",6454,"KRN",.4,"NM",3,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99^9002313.99^1^
"BLD",6454,"KRN",.4,"NM",4,0)
BPS INSURERS    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM",5,0)
BPS NCPDP    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM",6,0)
BPS PREBILL    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM",7,0)
BPS PRICING TABLES    FILE #9002313.53^9002313.53^1^
"BLD",6454,"KRN",.4,"NM",8,0)
BPS UN/BILLABLE    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM",9,0)
BPS USER PREFERENCES    FILE #9002313.515^9002313.515^1^
"BLD",6454,"KRN",.4,"NM",10,0)
BPS WORKERS COMP    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.4,"NM","B","BPS GRACE    FILE #9002313.4",1)

"BLD",6454,"KRN",.4,"NM","B","BPS INSURANCE RULES AVAIL    FILE #9002313.94",2)

"BLD",6454,"KRN",.4,"NM","B","BPS INSURANCE RULES IN-USE    FILE #9002313.99",3)

"BLD",6454,"KRN",.4,"NM","B","BPS INSURERS    FILE #9002313.4",4)

"BLD",6454,"KRN",.4,"NM","B","BPS NCPDP    FILE #9002313.4",5)

"BLD",6454,"KRN",.4,"NM","B","BPS PREBILL    FILE #9002313.4",6)

"BLD",6454,"KRN",.4,"NM","B","BPS PRICING TABLES    FILE #9002313.53",7)

"BLD",6454,"KRN",.4,"NM","B","BPS UN/BILLABLE    FILE #9002313.4",8)

"BLD",6454,"KRN",.4,"NM","B","BPS USER PREFERENCES    FILE #9002313.515",9)

"BLD",6454,"KRN",.4,"NM","B","BPS WORKERS COMP    FILE #9002313.4",10)

"BLD",6454,"KRN",.401,0)
.401
"BLD",6454,"KRN",.401,"NM",0)
^9.68A^10^10
"BLD",6454,"KRN",.401,"NM",1,0)
BPS GRACE    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM",2,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94^9002313.94^1^
"BLD",6454,"KRN",.401,"NM",3,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99^9002313.99^1^
"BLD",6454,"KRN",.401,"NM",4,0)
BPS INSURERS    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM",5,0)
BPS NCPDP    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM",6,0)
BPS PREBILL    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM",7,0)
BPS PRICING TABLES    FILE #9002313.53^9002313.53^1^
"BLD",6454,"KRN",.401,"NM",8,0)
BPS UN/BILLABLE    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM",9,0)
BPS USER PREFERENCES    FILE #9002313.515^9002313.515^1^
"BLD",6454,"KRN",.401,"NM",10,0)
BPS WORKERS COMP    FILE #9002313.4^9002313.4^1^
"BLD",6454,"KRN",.401,"NM","B","BPS GRACE    FILE #9002313.4",1)

"BLD",6454,"KRN",.401,"NM","B","BPS INSURANCE RULES AVAIL    FILE #9002313.94",2)

"BLD",6454,"KRN",.401,"NM","B","BPS INSURANCE RULES IN-USE    FILE #9002313.99",3)

"BLD",6454,"KRN",.401,"NM","B","BPS INSURERS    FILE #9002313.4",4)

"BLD",6454,"KRN",.401,"NM","B","BPS NCPDP    FILE #9002313.4",5)

"BLD",6454,"KRN",.401,"NM","B","BPS PREBILL    FILE #9002313.4",6)

"BLD",6454,"KRN",.401,"NM","B","BPS PRICING TABLES    FILE #9002313.53",7)

"BLD",6454,"KRN",.401,"NM","B","BPS UN/BILLABLE    FILE #9002313.4",8)

"BLD",6454,"KRN",.401,"NM","B","BPS USER PREFERENCES    FILE #9002313.515",9)

"BLD",6454,"KRN",.401,"NM","B","BPS WORKERS COMP    FILE #9002313.4",10)

"BLD",6454,"KRN",.402,0)
.402
"BLD",6454,"KRN",.402,"NM",0)
^9.68A^^
"BLD",6454,"KRN",.403,0)
.403
"BLD",6454,"KRN",.403,"NM",0)
^9.68A^3^3
"BLD",6454,"KRN",.403,"NM",1,0)
BPS BPSOSPW    FILE #9002313.99^9002313.99^1^
"BLD",6454,"KRN",.403,"NM",2,0)
BPS EOB TO BATCH    FILE #9002313.99^9002313.99^1^
"BLD",6454,"KRN",.403,"NM",3,0)
BPS INPUT 1    FILE #9002313.51^9002313.51^1^
"BLD",6454,"KRN",.403,"NM","B","BPS BPSOSPW    FILE #9002313.99",1)

"BLD",6454,"KRN",.403,"NM","B","BPS EOB TO BATCH    FILE #9002313.99",2)

"BLD",6454,"KRN",.403,"NM","B","BPS INPUT 1    FILE #9002313.51",3)

"BLD",6454,"KRN",.5,0)
.5
"BLD",6454,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",6454,"KRN",.84,0)
.84
"BLD",6454,"KRN",.84,"NM",0)
^9.68A^^
"BLD",6454,"KRN",3.6,0)
3.6
"BLD",6454,"KRN",3.8,0)
3.8
"BLD",6454,"KRN",9.2,0)
9.2
"BLD",6454,"KRN",9.8,0)
9.8
"BLD",6454,"KRN",9.8,"NM",0)
^9.68A^211^191
"BLD",6454,"KRN",9.8,"NM",1,0)
BPSBUTL^^0^B49471092
"BLD",6454,"KRN",9.8,"NM",2,0)
BPSECMP2^^0^B64422717
"BLD",6454,"KRN",9.8,"NM",3,0)
BPSNCPD3^^0^B20450751
"BLD",6454,"KRN",9.8,"NM",4,0)
BPSOS^^0^B2649792
"BLD",6454,"KRN",9.8,"NM",5,0)
BPSOSC2^^0^B29561871
"BLD",6454,"KRN",9.8,"NM",6,0)
BPSSCRCL^^0^B76014207
"BLD",6454,"KRN",9.8,"NM",7,0)
BPSSCRCV^^0^B47506376
"BLD",6454,"KRN",9.8,"NM",8,0)
BPSSCRPR^^0^B1032507
"BLD",6454,"KRN",9.8,"NM",9,0)
BPSSCRRS^^0^B25558353
"BLD",6454,"KRN",9.8,"NM",10,0)
BPSSCRRV^^0^B14899182
"BLD",6454,"KRN",9.8,"NM",11,0)
BPSSCRU2^^0^B41765546
"BLD",6454,"KRN",9.8,"NM",12,0)
BPSSCRU5^^0^B59880838
"BLD",6454,"KRN",9.8,"NM",13,0)
BPSUTIL^^0^B11392543
"BLD",6454,"KRN",9.8,"NM",14,0)
BPSUTIL1^^0^B29877020
"BLD",6454,"KRN",9.8,"NM",15,0)
BPSNCPDP^^0^B73597678
"BLD",6454,"KRN",9.8,"NM",16,0)
BPSNCPD2^^0^B37248829
"BLD",6454,"KRN",9.8,"NM",17,0)
BPSBCKJ^^0^B46482167
"BLD",6454,"KRN",9.8,"NM",18,0)
BPSOSCD^^0^B38448977
"BLD",6454,"KRN",9.8,"NM",19,0)
BPSRDT1^^0^B23088150
"BLD",6454,"KRN",9.8,"NM",20,0)
BPSRPT1^^0^B48512534
"BLD",6454,"KRN",9.8,"NM",21,0)
BPSRPT2^^0^B30091108
"BLD",6454,"KRN",9.8,"NM",22,0)
BPSRPT5^^0^B83699658
"BLD",6454,"KRN",9.8,"NM",23,0)
BPSRPT6^^0^B58276933
"BLD",6454,"KRN",9.8,"NM",24,0)
BPSRPT8^^0^B76134264
"BLD",6454,"KRN",9.8,"NM",25,0)
BPSRPT3^^0^B36736728
"BLD",6454,"KRN",9.8,"NM",26,0)
BPSRPT7^^0^B69704437
"BLD",6454,"KRN",9.8,"NM",27,0)
BPSNCPD1^^0^B40334169
"BLD",6454,"KRN",9.8,"NM",29,0)
BPSOSO^^0^B2239666
"BLD",6454,"KRN",9.8,"NM",32,0)
BPSOSRX^^0^B28605769
"BLD",6454,"KRN",9.8,"NM",33,0)
BPSOSU^^0^B49057530
"BLD",6454,"KRN",9.8,"NM",34,0)
BPSOS6M^^0^B10068430
"BLD",6454,"KRN",9.8,"NM",35,0)
BPSCMT01^^0^B20954371
"BLD",6454,"KRN",9.8,"NM",36,0)
BPSSCR03^^0^B43854425
"BLD",6454,"KRN",9.8,"NM",37,0)
BPSRPT0^^0^B20527507
"BLD",6454,"KRN",9.8,"NM",38,0)
BPSJACK^^0^B35592079
"BLD",6454,"KRN",9.8,"NM",39,0)
BPSJAREG^^0^B13096479
"BLD",6454,"KRN",9.8,"NM",40,0)
BPSJPREG^^0^B18672204
"BLD",6454,"KRN",9.8,"NM",41,0)
BPSJUTL^^0^B9622844
"BLD",6454,"KRN",9.8,"NM",42,0)
BPSOSRB^^0^B30030353
"BLD",6454,"KRN",9.8,"NM",43,0)
BPSOSCF^^0^B26940349
"BLD",6454,"KRN",9.8,"NM",44,0)
BPSECA2^^1^
"BLD",6454,"KRN",9.8,"NM",45,0)
BPSECA4^^1^
"BLD",6454,"KRN",9.8,"NM",46,0)
BPSECA5^^1^
"BLD",6454,"KRN",9.8,"NM",47,0)
BPSECA7^^1^
"BLD",6454,"KRN",9.8,"NM",48,0)
BPSECP1^^1^
"BLD",6454,"KRN",9.8,"NM",49,0)
BPSECP2^^1^
"BLD",6454,"KRN",9.8,"NM",50,0)
BPSECX4^^1^
"BLD",6454,"KRN",9.8,"NM",54,0)
BPSOS6A^^1^
"BLD",6454,"KRN",9.8,"NM",55,0)
BPSOS6B^^1^
"BLD",6454,"KRN",9.8,"NM",56,0)
BPSOS6C^^1^
"BLD",6454,"KRN",9.8,"NM",57,0)
BPSOS6D^^1^
"BLD",6454,"KRN",9.8,"NM",58,0)
BPSOS6F^^1^
"BLD",6454,"KRN",9.8,"NM",59,0)
BPSOS6G^^1^
"BLD",6454,"KRN",9.8,"NM",60,0)
BPSOS6H^^1^
"BLD",6454,"KRN",9.8,"NM",61,0)
BPSOS6I^^1^
"BLD",6454,"KRN",9.8,"NM",62,0)
BPSOS6J^^1^
"BLD",6454,"KRN",9.8,"NM",63,0)
BPSOS6L^^1^
"BLD",6454,"KRN",9.8,"NM",64,0)
BPSOS6N^^1^
"BLD",6454,"KRN",9.8,"NM",65,0)
BPSOS9^^1^
"BLD",6454,"KRN",9.8,"NM",66,0)
BPSOSI^^1^
"BLD",6454,"KRN",9.8,"NM",67,0)
BPSOSA^^1^
"BLD",6454,"KRN",9.8,"NM",68,0)
BPSOSP^^1^
"BLD",6454,"KRN",9.8,"NM",69,0)
BPSOSB^^1^
"BLD",6454,"KRN",9.8,"NM",70,0)
BPSOSIV^^1^
"BLD",6454,"KRN",9.8,"NM",71,0)
BPSOSM^^1^
"BLD",6454,"KRN",9.8,"NM",72,0)
BPSOSAA^^1^
"BLD",6454,"KRN",9.8,"NM",73,0)
BPSOSAB^^1^
"BLD",6454,"KRN",9.8,"NM",74,0)
BPSOSAD^^1^
"BLD",6454,"KRN",9.8,"NM",75,0)
BPSOSAM^^1^
"BLD",6454,"KRN",9.8,"NM",76,0)
BPSOSAN^^1^
"BLD",6454,"KRN",9.8,"NM",77,0)
BPSOSAO^^1^
"BLD",6454,"KRN",9.8,"NM",78,0)
BPSOSAP^^1^
"BLD",6454,"KRN",9.8,"NM",79,0)
BPSOSAQ^^1^
"BLD",6454,"KRN",9.8,"NM",80,0)
BPSOSAR^^1^
"BLD",6454,"KRN",9.8,"NM",81,0)
BPSOSAS^^1^
"BLD",6454,"KRN",9.8,"NM",82,0)
BPSOSAW^^1^
"BLD",6454,"KRN",9.8,"NM",83,0)
BPSOSAY^^1^
"BLD",6454,"KRN",9.8,"NM",84,0)
BPSOSB3^^1^
"BLD",6454,"KRN",9.8,"NM",85,0)
BPSOSBB^^1^
"BLD",6454,"KRN",9.8,"NM",86,0)
BPSOSBC^^1^
"BLD",6454,"KRN",9.8,"NM",87,0)
BPSOSBD^^1^
"BLD",6454,"KRN",9.8,"NM",88,0)
BPSOSBF^^1^
"BLD",6454,"KRN",9.8,"NM",89,0)
BPSOSBM^^1^
"BLD",6454,"KRN",9.8,"NM",90,0)
BPSOSBP^^1^
"BLD",6454,"KRN",9.8,"NM",91,0)
BPSOSBQ^^1^
"BLD",6454,"KRN",9.8,"NM",92,0)
BPSOSBT^^1^
"BLD",6454,"KRN",9.8,"NM",93,0)
BPSOSBV^^1^
"BLD",6454,"KRN",9.8,"NM",94,0)
BPSOSBW^^1^
"BLD",6454,"KRN",9.8,"NM",95,0)
BPSOSBX^^1^
"BLD",6454,"KRN",9.8,"NM",96,0)
BPSOSC3^^1^
"BLD",6454,"KRN",9.8,"NM",97,0)
BPSOSH4^^1^
"BLD",6454,"KRN",9.8,"NM",98,0)
BPSOSH5^^1^
"BLD",6454,"KRN",9.8,"NM",99,0)
BPSOSH6^^1^
"BLD",6454,"KRN",9.8,"NM",100,0)
BPSOSH7^^1^
"BLD",6454,"KRN",9.8,"NM",101,0)
BPSOSHU^^1^
"BLD",6454,"KRN",9.8,"NM",102,0)
BPSOSI1^^1^
"BLD",6454,"KRN",9.8,"NM",103,0)
BPSOSI7^^1^
"BLD",6454,"KRN",9.8,"NM",104,0)
BPSOSI8^^1^
"BLD",6454,"KRN",9.8,"NM",105,0)
BPSOSIF^^1^
"BLD",6454,"KRN",9.8,"NM",106,0)
BPSOSIW^^1^
"BLD",6454,"KRN",9.8,"NM",109,0)
BPSOSM1^^1^
"BLD",6454,"KRN",9.8,"NM",110,0)
BPSOSM2^^1^
"BLD",6454,"KRN",9.8,"NM",111,0)
BPSOSNC^^1^
"BLD",6454,"KRN",9.8,"NM",121,0)
BPSOSS2^^1^
"BLD",6454,"KRN",9.8,"NM",122,0)
BPSOSS3^^1^
"BLD",6454,"KRN",9.8,"NM",123,0)
BPSOSS6^^1^
"BLD",6454,"KRN",9.8,"NM",124,0)
BPSOSS9^^1^
"BLD",6454,"KRN",9.8,"NM",125,0)
BPSOSU6^^1^
"BLD",6454,"KRN",9.8,"NM",126,0)
BPSOSU7^^1^
"BLD",6454,"KRN",9.8,"NM",127,0)
BPSOSUA^^1^
"BLD",6454,"KRN",9.8,"NM",128,0)
BPSOS2^^0^B14102494
"BLD",6454,"KRN",9.8,"NM",129,0)
BPSOS25^^1^
"BLD",6454,"KRN",9.8,"NM",130,0)
BPSOS29^^1^
"BLD",6454,"KRN",9.8,"NM",131,0)
BPSOS2D^^1^
"BLD",6454,"KRN",9.8,"NM",132,0)
BPSOS2A^^0^B6917182
"BLD",6454,"KRN",9.8,"NM",133,0)
BPSOS2B^^0^B2390241
"BLD",6454,"KRN",9.8,"NM",134,0)
BPSOS2C^^0^B1491511
"BLD",6454,"KRN",9.8,"NM",135,0)
BPSOSK^^0^B7715281
"BLD",6454,"KRN",9.8,"NM",136,0)
BPSOSK1^^1^
"BLD",6454,"KRN",9.8,"NM",137,0)
BPSOSK2^^1^
"BLD",6454,"KRN",9.8,"NM",138,0)
BPSOSL^^0^B6592911
"BLD",6454,"KRN",9.8,"NM",139,0)
BPSOSL1^^0^B8172126
"BLD",6454,"KRN",9.8,"NM",140,0)
BPSOSQ^^0^B1468656
"BLD",6454,"KRN",9.8,"NM",141,0)
BPSOSQ1^^1^
"BLD",6454,"KRN",9.8,"NM",142,0)
BPSOSQ3^^1^
"BLD",6454,"KRN",9.8,"NM",143,0)
BPSOSQB^^1^
"BLD",6454,"KRN",9.8,"NM",144,0)
BPSOSQD^^1^
"BLD",6454,"KRN",9.8,"NM",145,0)
BPSOSQH^^1^
"BLD",6454,"KRN",9.8,"NM",146,0)
BPSOSQJ^^1^
"BLD",6454,"KRN",9.8,"NM",147,0)
BPSOSQQ^^1^
"BLD",6454,"KRN",9.8,"NM",148,0)
BPSOSQS^^1^
"BLD",6454,"KRN",9.8,"NM",149,0)
BPSOSQP^^1^
"BLD",6454,"KRN",9.8,"NM",150,0)
BPSOSQ2^^0^B19065204
"BLD",6454,"KRN",9.8,"NM",151,0)
BPSOSQA^^0^B6788168
"BLD",6454,"KRN",9.8,"NM",152,0)
BPSOSQC^^0^B701556
"BLD",6454,"KRN",9.8,"NM",153,0)
BPSOSQ4^^0^B18119106
"BLD",6454,"KRN",9.8,"NM",154,0)
BPSOSQL^^0^B17767813
"BLD",6454,"KRN",9.8,"NM",155,0)
BPSOSQG^^0^B6928881
"BLD",6454,"KRN",9.8,"NM",156,0)
BPSOSQF^^0^B8677183
"BLD",6454,"KRN",9.8,"NM",157,0)
BPSECA1^^0^B9994271
"BLD",6454,"KRN",9.8,"NM",158,0)
BPSECA8^^0^B7457603
"BLD",6454,"KRN",9.8,"NM",159,0)
BPSECMC2^^0^B15229460
"BLD",6454,"KRN",9.8,"NM",160,0)
BPSECX0^^0^B4171802
"BLD",6454,"KRN",9.8,"NM",161,0)
BPSECX1^^0^B3758850
"BLD",6454,"KRN",9.8,"NM",162,0)
BPSMHDR^^0^B2671885
"BLD",6454,"KRN",9.8,"NM",163,0)
BPSJINIT^^0^B36083922
"BLD",6454,"KRN",9.8,"NM",164,0)
BPSOS03^^0^B8935735
"BLD",6454,"KRN",9.8,"NM",165,0)
BPSOS57^^0^B16780486
"BLD",6454,"KRN",9.8,"NM",166,0)
BPSOSCA^^0^B9099682
"BLD",6454,"KRN",9.8,"NM",167,0)
BPSOSCB^^0^B2743656
"BLD",6454,"KRN",9.8,"NM",168,0)
BPSOSCC^^0^B24314564
"BLD",6454,"KRN",9.8,"NM",169,0)
BPSOSCE^^0^B14464874
"BLD",6454,"KRN",9.8,"NM",170,0)
BPSOSH2^^0^B26441893
"BLD",6454,"KRN",9.8,"NM",171,0)
BPSOSHR^^0^B15113089
"BLD",6454,"KRN",9.8,"NM",172,0)
BPSOSHF^^0^B11141582
"BLD",6454,"KRN",9.8,"NM",173,0)
BPSOSIY^^0^B52867161
"BLD",6454,"KRN",9.8,"NM",174,0)
BPSOSIZ^^0^B12107785
"BLD",6454,"KRN",9.8,"NM",175,0)
BPSOSO2^^0^B31121702
"BLD",6454,"KRN",9.8,"NM",176,0)
BPSOSR2^^0^B1160966
"BLD",6454,"KRN",9.8,"NM",177,0)
BPSOSS8^^0^B1373912
"BLD",6454,"KRN",9.8,"NM",178,0)
BPSOSSG^^0^B18762002
"BLD",6454,"KRN",9.8,"NM",179,0)
BPSOSU8^^0^B19335097
"BLD",6454,"KRN",9.8,"NM",180,0)
BPSOSUC^^0^B6143853
"BLD",6454,"KRN",9.8,"NM",181,0)
BPSOSUD^^0^B21782144
"BLD",6454,"KRN",9.8,"NM",182,0)
BPSUSCR1^^0^B20439548
"BLD",6454,"KRN",9.8,"NM",183,0)
BPSRREV^^1^
"BLD",6454,"KRN",9.8,"NM",184,0)
BPS01P3^^1^
"BLD",6454,"KRN",9.8,"NM",185,0)
BPS03P1^^1^
"BLD",6454,"KRN",9.8,"NM",186,0)
BPS02P1^^1^
"BLD",6454,"KRN",9.8,"NM",187,0)
BPS01P1^^1^
"BLD",6454,"KRN",9.8,"NM",188,0)
BPSP11P^^1^
"BLD",6454,"KRN",9.8,"NM",189,0)
BPSJXI1^^1^
"BLD",6454,"KRN",9.8,"NM",191,0)
BPSCEAR^^1^
"BLD",6454,"KRN",9.8,"NM",192,0)
BPSOS6E^^1^
"BLD",6454,"KRN",9.8,"NM",193,0)
BPSRES^^0^B65826768
"BLD",6454,"KRN",9.8,"NM",195,0)
BPSSCRU3^^0^B34384463
"BLD",6454,"KRN",9.8,"NM",197,0)
BPS01P5^^0^B100471929
"BLD",6454,"KRN",9.8,"NM",198,0)
BPS01P5A^^0^B71771473
"BLD",6454,"KRN",9.8,"NM",199,0)
BPS01P5B^^0^B78865684
"BLD",6454,"KRN",9.8,"NM",200,0)
BPSRPT4^^0^B66657579
"BLD",6454,"KRN",9.8,"NM",201,0)
BPSSCRLG^^0^B91531978
"BLD",6454,"KRN",9.8,"NM",202,0)
BPSRCRI^^0^B34932652
"BLD",6454,"KRN",9.8,"NM",203,0)
BPSECMPS^^0^B69163590
"BLD",6454,"KRN",9.8,"NM",204,0)
BPSNPI^^0^B3073624
"BLD",6454,"KRN",9.8,"NM",205,0)
BPSPHAR^^0^B1798391
"BLD",6454,"KRN",9.8,"NM",206,0)
BPSJVAL2^^0^B28991650
"BLD",6454,"KRN",9.8,"NM",207,0)
BPSSCR01^^0^B17522420
"BLD",6454,"KRN",9.8,"NM",208,0)
BPS01P5C^^0^B4183248
"BLD",6454,"KRN",9.8,"NM",209,0)
BPSJVAL1^^0^B15725764
"BLD",6454,"KRN",9.8,"NM",210,0)
BPSSCR04^^0^B53618434
"BLD",6454,"KRN",9.8,"NM",211,0)
BPSSCRCU^^0^B3767208
"BLD",6454,"KRN",9.8,"NM","B","BPS01P1",187)

"BLD",6454,"KRN",9.8,"NM","B","BPS01P3",184)

"BLD",6454,"KRN",9.8,"NM","B","BPS01P5",197)

"BLD",6454,"KRN",9.8,"NM","B","BPS01P5A",198)

"BLD",6454,"KRN",9.8,"NM","B","BPS01P5B",199)

"BLD",6454,"KRN",9.8,"NM","B","BPS01P5C",208)

"BLD",6454,"KRN",9.8,"NM","B","BPS02P1",186)

"BLD",6454,"KRN",9.8,"NM","B","BPS03P1",185)

"BLD",6454,"KRN",9.8,"NM","B","BPSBCKJ",17)

"BLD",6454,"KRN",9.8,"NM","B","BPSBUTL",1)

"BLD",6454,"KRN",9.8,"NM","B","BPSCEAR",191)

"BLD",6454,"KRN",9.8,"NM","B","BPSCMT01",35)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA1",157)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA2",44)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA4",45)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA5",46)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA7",47)

"BLD",6454,"KRN",9.8,"NM","B","BPSECA8",158)

"BLD",6454,"KRN",9.8,"NM","B","BPSECMC2",159)

"BLD",6454,"KRN",9.8,"NM","B","BPSECMP2",2)

"BLD",6454,"KRN",9.8,"NM","B","BPSECMPS",203)

"BLD",6454,"KRN",9.8,"NM","B","BPSECP1",48)

"BLD",6454,"KRN",9.8,"NM","B","BPSECP2",49)

"BLD",6454,"KRN",9.8,"NM","B","BPSECX0",160)

"BLD",6454,"KRN",9.8,"NM","B","BPSECX1",161)

"BLD",6454,"KRN",9.8,"NM","B","BPSECX4",50)

"BLD",6454,"KRN",9.8,"NM","B","BPSJACK",38)

"BLD",6454,"KRN",9.8,"NM","B","BPSJAREG",39)

"BLD",6454,"KRN",9.8,"NM","B","BPSJINIT",163)

"BLD",6454,"KRN",9.8,"NM","B","BPSJPREG",40)

"BLD",6454,"KRN",9.8,"NM","B","BPSJUTL",41)

"BLD",6454,"KRN",9.8,"NM","B","BPSJVAL1",209)

"BLD",6454,"KRN",9.8,"NM","B","BPSJVAL2",206)

"BLD",6454,"KRN",9.8,"NM","B","BPSJXI1",189)

"BLD",6454,"KRN",9.8,"NM","B","BPSMHDR",162)

"BLD",6454,"KRN",9.8,"NM","B","BPSNCPD1",27)

"BLD",6454,"KRN",9.8,"NM","B","BPSNCPD2",16)

"BLD",6454,"KRN",9.8,"NM","B","BPSNCPD3",3)

"BLD",6454,"KRN",9.8,"NM","B","BPSNCPDP",15)

"BLD",6454,"KRN",9.8,"NM","B","BPSNPI",204)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS",4)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS03",164)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS2",128)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS25",129)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS29",130)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS2A",132)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS2B",133)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS2C",134)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS2D",131)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS57",165)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6A",54)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6B",55)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6C",56)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6D",57)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6E",192)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6F",58)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6G",59)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6H",60)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6I",61)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6J",62)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6L",63)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6M",34)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS6N",64)

"BLD",6454,"KRN",9.8,"NM","B","BPSOS9",65)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSA",67)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAA",72)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAB",73)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAD",74)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAM",75)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAN",76)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAO",77)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAP",78)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAQ",79)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAR",80)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAS",81)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAW",82)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSAY",83)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSB",69)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSB3",84)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBB",85)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBC",86)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBD",87)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBF",88)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBM",89)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBP",90)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBQ",91)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBT",92)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBV",93)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBW",94)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSBX",95)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSC2",5)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSC3",96)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCA",166)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCB",167)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCC",168)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCD",18)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCE",169)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSCF",43)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSH2",170)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSH4",97)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSH5",98)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSH6",99)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSH7",100)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSHF",172)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSHR",171)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSHU",101)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSI",66)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSI1",102)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSI7",103)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSI8",104)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSIF",105)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSIV",70)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSIW",106)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSIY",173)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSIZ",174)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSK",135)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSK1",136)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSK2",137)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSL",138)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSL1",139)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSM",71)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSM1",109)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSM2",110)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSNC",111)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSO",29)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSO2",175)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSP",68)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQ",140)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQ1",141)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQ2",150)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQ3",142)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQ4",153)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQA",151)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQB",143)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQC",152)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQD",144)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQF",156)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQG",155)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQH",145)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQJ",146)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQL",154)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQP",149)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQQ",147)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSQS",148)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSR2",176)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSRB",42)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSRX",32)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSS2",121)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSS3",122)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSS6",123)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSS8",177)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSS9",124)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSSG",178)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSU",33)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSU6",125)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSU7",126)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSU8",179)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSUA",127)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSUC",180)

"BLD",6454,"KRN",9.8,"NM","B","BPSOSUD",181)

"BLD",6454,"KRN",9.8,"NM","B","BPSP11P",188)

"BLD",6454,"KRN",9.8,"NM","B","BPSPHAR",205)

"BLD",6454,"KRN",9.8,"NM","B","BPSRCRI",202)

"BLD",6454,"KRN",9.8,"NM","B","BPSRDT1",19)

"BLD",6454,"KRN",9.8,"NM","B","BPSRES",193)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT0",37)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT1",20)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT2",21)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT3",25)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT4",200)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT5",22)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT6",23)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT7",26)

"BLD",6454,"KRN",9.8,"NM","B","BPSRPT8",24)

"BLD",6454,"KRN",9.8,"NM","B","BPSRREV",183)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCR01",207)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCR03",36)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCR04",210)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRCL",6)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRCU",211)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRCV",7)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRLG",201)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRPR",8)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRRS",9)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRRV",10)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRU2",11)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRU3",195)

"BLD",6454,"KRN",9.8,"NM","B","BPSSCRU5",12)

"BLD",6454,"KRN",9.8,"NM","B","BPSUSCR1",182)

"BLD",6454,"KRN",9.8,"NM","B","BPSUTIL",13)

"BLD",6454,"KRN",9.8,"NM","B","BPSUTIL1",14)

"BLD",6454,"KRN",19,0)
19
"BLD",6454,"KRN",19,"NM",0)
^9.68A^19^19
"BLD",6454,"KRN",19,"NM",1,0)
BPS RPT ERRONEOUS REV^^1^
"BLD",6454,"KRN",19,"NM",2,0)
BPS MANAGER MENU^^0
"BLD",6454,"KRN",19,"NM",3,0)
BPS RPT SETUP PHARMACIES^^0^
"BLD",6454,"KRN",19,"NM",4,0)
BPS RPT TURNAROUND STATS^^0^
"BLD",6454,"KRN",19,"NM",5,0)
BPS SETUP BASIC PARAMS^^0
"BLD",6454,"KRN",19,"NM",6,0)
BPS STATISTICS SCREEN^^0
"BLD",6454,"KRN",19,"NM",7,0)
BPS UNSTRAND SCREEN^^0
"BLD",6454,"KRN",19,"NM",8,0)
BPS USER SCREEN^^0
"BLD",6454,"KRN",19,"NM",9,0)
BPSMENU^^0
"BLD",6454,"KRN",19,"NM",10,0)
BPS MENU RPT MAIN^^4^
"BLD",6454,"KRN",19,"NM",11,0)
BPS SETUP MENU^^4^
"BLD",6454,"KRN",19,"NM",12,0)
BPS MENU MAINTENANCE^^0^
"BLD",6454,"KRN",19,"NM",13,0)
BPS RPT CMOP/ECME ACTIVITY^^0
"BLD",6454,"KRN",19,"NM",14,0)
BPS MENU RPT CLAIM STATUS^^2
"BLD",6454,"KRN",19,"NM",15,0)
BPS MENU RPT OTHER^^0
"BLD",6454,"KRN",19,"NM",16,0)
BPS RPT CLAIMS RESPONSE^^0
"BLD",6454,"KRN",19,"NM",17,0)
BPS RPT PAYER SHEET DETAIL^^4^
"BLD",6454,"KRN",19,"NM",18,0)
BPS REOPEN CLOSED CLAIM^^4^
"BLD",6454,"KRN",19,"NM",19,0)
BPS NIGHTLY BACKGROUND JOB^^0
"BLD",6454,"KRN",19,"NM","B","BPS MANAGER MENU",2)

"BLD",6454,"KRN",19,"NM","B","BPS MENU MAINTENANCE",12)

"BLD",6454,"KRN",19,"NM","B","BPS MENU RPT CLAIM STATUS",14)

"BLD",6454,"KRN",19,"NM","B","BPS MENU RPT MAIN",10)

"BLD",6454,"KRN",19,"NM","B","BPS MENU RPT OTHER",15)

"BLD",6454,"KRN",19,"NM","B","BPS NIGHTLY BACKGROUND JOB",19)

"BLD",6454,"KRN",19,"NM","B","BPS REOPEN CLOSED CLAIM",18)

"BLD",6454,"KRN",19,"NM","B","BPS RPT CLAIMS RESPONSE",16)

"BLD",6454,"KRN",19,"NM","B","BPS RPT CMOP/ECME ACTIVITY",13)

"BLD",6454,"KRN",19,"NM","B","BPS RPT ERRONEOUS REV",1)

"BLD",6454,"KRN",19,"NM","B","BPS RPT PAYER SHEET DETAIL",17)

"BLD",6454,"KRN",19,"NM","B","BPS RPT SETUP PHARMACIES",3)

"BLD",6454,"KRN",19,"NM","B","BPS RPT TURNAROUND STATS",4)

"BLD",6454,"KRN",19,"NM","B","BPS SETUP BASIC PARAMS",5)

"BLD",6454,"KRN",19,"NM","B","BPS SETUP MENU",11)

"BLD",6454,"KRN",19,"NM","B","BPS STATISTICS SCREEN",6)

"BLD",6454,"KRN",19,"NM","B","BPS UNSTRAND SCREEN",7)

"BLD",6454,"KRN",19,"NM","B","BPS USER SCREEN",8)

"BLD",6454,"KRN",19,"NM","B","BPSMENU",9)

"BLD",6454,"KRN",19.1,0)
19.1
"BLD",6454,"KRN",101,0)
101
"BLD",6454,"KRN",101,"NM",0)
^9.68A^24^24
"BLD",6454,"KRN",101,"NM",1,0)
BPS HIDDEN ACTIONS^^1^
"BLD",6454,"KRN",101,"NM",2,0)
BPS P1 CONTINUOUS^^1^
"BLD",6454,"KRN",101,"NM",3,0)
BPS P1 NEW CLAIMS^^1^
"BLD",6454,"KRN",101,"NM",4,0)
BPS P1 PRINT PATIENT^^1^
"BLD",6454,"KRN",101,"NM",5,0)
BPS P1 QUIT^^1^
"BLD",6454,"KRN",101,"NM",6,0)
BPS P1 RECEIPT^^1^
"BLD",6454,"KRN",101,"NM",7,0)
BPS P2 POKE^^1^
"BLD",6454,"KRN",101,"NM",8,0)
BPS P2 TMIT JOBS^^1^
"BLD",6454,"KRN",101,"NM",9,0)
BPS P2 TRANSMITTER^^1^
"BLD",6454,"KRN",101,"NM",10,0)
BPS PRTCL RSCH VIEW ELIG MENU^^1^
"BLD",6454,"KRN",101,"NM",11,0)
BPS PRTCL USRSCR PRINT^^1^
"BLD",6454,"KRN",101,"NM",12,0)
BPS PRTCL ECME USRSCR^^0
"BLD",6454,"KRN",101,"NM",13,0)
BPS PRTCL USRSCR REVERSE^^0
"BLD",6454,"KRN",101,"NM",14,0)
BPS PRTCL USRSCR CONTINUOUS^^0
"BLD",6454,"KRN",101,"NM",15,0)
BPS PRTCL USRSCR RESUBMIT^^0
"BLD",6454,"KRN",101,"NM",16,0)
BPS PRTCL USRSCR UPDATE^^0
"BLD",6454,"KRN",101,"NM",17,0)
BPS PRTCL USRSCR SORTLIST^^0
"BLD",6454,"KRN",101,"NM",18,0)
BPS PRTCL USRSCR COMMENT^^0
"BLD",6454,"KRN",101,"NM",19,0)
BPS PRTCL USRSCR RESEARCH MENU^^0
"BLD",6454,"KRN",101,"NM",20,0)
BPS PRTCL USRSCR CLAIM LOG^^0
"BLD",6454,"KRN",101,"NM",21,0)
BPS PRTCL USRSCR CLOSE^^0
"BLD",6454,"KRN",101,"NM",22,0)
BPS PRTCL USRSCR CHANGE VIEW^^0
"BLD",6454,"KRN",101,"NM",23,0)
BPS PRTCL USRSCR EXIT^^0
"BLD",6454,"KRN",101,"NM",24,0)
BPS PRTCL LOG MENU^^0
"BLD",6454,"KRN",101,"NM","B","BPS HIDDEN ACTIONS",1)

"BLD",6454,"KRN",101,"NM","B","BPS P1 CONTINUOUS",2)

"BLD",6454,"KRN",101,"NM","B","BPS P1 NEW CLAIMS",3)

"BLD",6454,"KRN",101,"NM","B","BPS P1 PRINT PATIENT",4)

"BLD",6454,"KRN",101,"NM","B","BPS P1 QUIT",5)

"BLD",6454,"KRN",101,"NM","B","BPS P1 RECEIPT",6)

"BLD",6454,"KRN",101,"NM","B","BPS P2 POKE",7)

"BLD",6454,"KRN",101,"NM","B","BPS P2 TMIT JOBS",8)

"BLD",6454,"KRN",101,"NM","B","BPS P2 TRANSMITTER",9)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL ECME USRSCR",12)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL LOG MENU",24)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL RSCH VIEW ELIG MENU",10)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR CHANGE VIEW",22)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR CLAIM LOG",20)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR CLOSE",21)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR COMMENT",18)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR CONTINUOUS",14)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR EXIT",23)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR PRINT",11)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR RESEARCH MENU",19)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR RESUBMIT",15)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR REVERSE",13)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR SORTLIST",17)

"BLD",6454,"KRN",101,"NM","B","BPS PRTCL USRSCR UPDATE",16)

"BLD",6454,"KRN",409.61,0)
409.61
"BLD",6454,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",6454,"KRN",409.61,"NM",1,0)
BPS STATISTICS AND MANAGEMENT^^0
"BLD",6454,"KRN",409.61,"NM","B","BPS STATISTICS AND MANAGEMENT",1)

"BLD",6454,"KRN",771,0)
771
"BLD",6454,"KRN",870,0)
870
"BLD",6454,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",6454,"KRN",870,"NM",1,0)
EPHARM IN^^1^
"BLD",6454,"KRN",870,"NM","B","EPHARM IN",1)

"BLD",6454,"KRN",8989.51,0)
8989.51
"BLD",6454,"KRN",8989.52,0)
8989.52
"BLD",6454,"KRN",8994,0)
8994
"BLD",6454,"KRN","B",.4,.4)

"BLD",6454,"KRN","B",.401,.401)

"BLD",6454,"KRN","B",.402,.402)

"BLD",6454,"KRN","B",.403,.403)

"BLD",6454,"KRN","B",.5,.5)

"BLD",6454,"KRN","B",.84,.84)

"BLD",6454,"KRN","B",3.6,3.6)

"BLD",6454,"KRN","B",3.8,3.8)

"BLD",6454,"KRN","B",9.2,9.2)

"BLD",6454,"KRN","B",9.8,9.8)

"BLD",6454,"KRN","B",19,19)

"BLD",6454,"KRN","B",19.1,19.1)

"BLD",6454,"KRN","B",101,101)

"BLD",6454,"KRN","B",409.61,409.61)

"BLD",6454,"KRN","B",771,771)

"BLD",6454,"KRN","B",870,870)

"BLD",6454,"KRN","B",8989.51,8989.51)

"BLD",6454,"KRN","B",8989.52,8989.52)

"BLD",6454,"KRN","B",8994,8994)

"BLD",6454,"QUES",0)
^9.62^^
"BLD",6454,"REQB",0)
^9.611^3^3
"BLD",6454,"REQB",1,0)
BPS*1.0*2^2
"BLD",6454,"REQB",2,0)
DI*22.0*153^2
"BLD",6454,"REQB",3,0)
PSX*2.0*63^2
"BLD",6454,"REQB","B","BPS*1.0*2",1)

"BLD",6454,"REQB","B","DI*22.0*153",2)

"BLD",6454,"REQB","B","PSX*2.0*63",3)

"DATA",9002313.8242,9,0)
0^NOT SPECIFIED
"DATA",9002313.8242,10,0)
1^NO OVERRIDE
"DATA",9002313.8242,11,0)
2^OTHER OVERRIDE
"DATA",9002313.8242,12,0)
3^VACATION SUPPLY
"DATA",9002313.8242,13,0)
4^LOST PRESCRIPTION
"DATA",9002313.8242,14,0)
5^THERAPY CHANGE
"DATA",9002313.8242,15,0)
6^STARTER DOSE
"DATA",9002313.8242,16,0)
7^MEDICALLY NECESSARY
"DATA",9002313.8242,17,0)
8^PROCESS COMPOUND FOR APPR ING
"DATA",9002313.8242,18,0)
9^ENCOUNTERS
"DATA",9002313.8242,19,0)
10^MEETS PLAN LIMITATIONS
"DATA",9002313.8242,20,0)
99^OTHER
"DATA",9002313.82461,1,0)
0^NOT SPECIFIED
"DATA",9002313.82461,2,0)
1^PRIOR AUTHORIZATION
"DATA",9002313.82461,3,0)
2^MEDICAL CERTIFICATION
"DATA",9002313.82461,4,0)
3^EPSDT
"DATA",9002313.82461,5,0)
4^EXEMPTION FROM COPAY
"DATA",9002313.82461,6,0)
5^EXEMPTION FROM RX
"DATA",9002313.82461,7,0)
6^FAMILY PLAN. INDIC.
"DATA",9002313.82461,8,0)
7^AFDC
"DATA",9002313.82461,9,0)
8^PAYER DEFINED EXEMPTION
"DATA",9002313.91,1,0)
101^^BIN NUMBER^N^
"DATA",9002313.91,1,5)
A1^6
"DATA",9002313.91,1,10,0)
^^1^1^3061023^
"DATA",9002313.91,1,10,1,0)
S BPS("X")=$G(BPS("NCPDP","BIN Number"))
"DATA",9002313.91,1,25,0)
^9002313.9104^1^1^3040130^^^^
"DATA",9002313.91,1,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,1,30,0)
^9002313.9103^1^1^3040130^^^^
"DATA",9002313.91,1,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,1)=BPS("X")
"DATA",9002313.91,2,0)
102^^VERSION/RELEASE NUMBER^A/N^
"DATA",9002313.91,2,5)
A2^2
"DATA",9002313.91,2,10,0)
^9002313.9101^1^1^3061023^^^^
"DATA",9002313.91,2,10,1,0)
S BPS("X")=$G(BPS("NCPDP","Version"))
"DATA",9002313.91,2,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,2,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,2,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,2,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,2)=BPS("X")
"DATA",9002313.91,3,0)
103^^TRANSACTION CODE^N^
"DATA",9002313.91,3,5)
A3^2
"DATA",9002313.91,3,10,0)
^9002313.9101^1^1^3061023^^^^
"DATA",9002313.91,3,10,1,0)
S BPS("X")=$G(BPS("Transaction Code"))
"DATA",9002313.91,3,25,0)
^9002313.9104^1^1^3040130^^^^
"DATA",9002313.91,3,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,3,30,0)
^9002313.9103^1^1^3040130^^^^
"DATA",9002313.91,3,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,3)=BPS("X")
"DATA",9002313.91,4,0)
104^^PROCESSOR CONTROL NUMBER^A/N^
"DATA",9002313.91,4,5)
A4^10
"DATA",9002313.91,4,10,0)
^^1^1^3061023^
"DATA",9002313.91,4,10,1,0)
S BPS("X")=$G(BPS("NCPDP","PCN"))
"DATA",9002313.91,4,25,0)
^9002313.9104^1^1^3040820^^^^
"DATA",9002313.91,4,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,4,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,4,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,4)=BPS("X")
"DATA",9002313.91,5,0)
201^^SERVICE PROVIDER ID^A/N^
"DATA",9002313.91,5,5)
B1^12
"DATA",9002313.91,5,10,0)
^9002313.9101^1^1^3070214^^^
"DATA",9002313.91,5,10,1,0)
S BPS("X")=$G(BPS("Site","NPI"))
"DATA",9002313.91,5,25,0)
^9002313.9104^1^1^3070214^^^^
"DATA",9002313.91,5,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,5,30,0)
^9002313.9103^1^1^3040827^^^^
"DATA",9002313.91,5,30,1,0)
S $P(^BPSC(BPS(9002313.02),200),U,1)=BPS("X")
"DATA",9002313.91,6,0)
301^^GROUP NUMBER^A/N^
"DATA",9002313.91,6,5)
C1^15
"DATA",9002313.91,6,10,0)
^9002313.9101^1^1^3041021^^
"DATA",9002313.91,6,10,1,0)
S BPS("X")=$G(BPS("Insurer","Group #"))
"DATA",9002313.91,6,25,0)
^9002313.9104^1^1^3041021^^^^
"DATA",9002313.91,6,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,6,30,0)
^9002313.9103^1^1^3041021^^^^
"DATA",9002313.91,6,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,1)=BPS("X")
"DATA",9002313.91,7,0)
302^^CARDHOLDER ID NUMBER^A/N^
"DATA",9002313.91,7,5)
C2^20
"DATA",9002313.91,7,10,0)
^9002313.9101^1^1^3041021^^^^
"DATA",9002313.91,7,10,1,0)
S BPS("X")=$G(BPS("Insurer","Policy #"))
"DATA",9002313.91,7,25,0)
^^1^1^3061121^
"DATA",9002313.91,7,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,7,30,0)
^9002313.9103^1^1^3041021^^
"DATA",9002313.91,7,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,2)=$TR(BPS("X")," ","")
"DATA",9002313.91,8,0)
303^^PERSON CODE^A/N^
"DATA",9002313.91,8,5)
C3^3
"DATA",9002313.91,8,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,8,10,1,0)
S BPS("X")=$G(BPS("Insurer","Person Code"))
"DATA",9002313.91,8,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,8,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,8,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,8,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,3)=BPS("X")
"DATA",9002313.91,9,0)
304^^DATE OF BIRTH^N^
"DATA",9002313.91,9,5)
C4^8
"DATA",9002313.91,9,10,0)
^9002313.9101^1^1^3040820^^^^
"DATA",9002313.91,9,10,1,0)
S BPS("X")=$G(BPS("Patient","DOB"))
"DATA",9002313.91,9,25,0)
^9002313.9104^1^1^3040820^^^^
"DATA",9002313.91,9,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,9,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,9,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,4)=BPS("X")
"DATA",9002313.91,10,0)
305^^SEX CODE^N^
"DATA",9002313.91,10,5)
C5^1
"DATA",9002313.91,10,10,0)
^9002313.9101^3^3^3040114^^^^
"DATA",9002313.91,10,10,1,0)
S BPS("X")=$G(BPS("Patient","Sex"))
"DATA",9002313.91,10,10,2,0)
S BPS("X")=$E(BPS("X"),1,1)
"DATA",9002313.91,10,10,3,0)
S BPS("X")=$S(BPS("X")="M":"1",BPS("X")="F":"2",1:"0")
"DATA",9002313.91,10,25,0)
^9002313.9104^1^1^3040114^^
"DATA",9002313.91,10,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,10,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,10,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,5)=BPS("X")
"DATA",9002313.91,11,0)
306^^RELATIONSHIP CODE^N^
"DATA",9002313.91,11,5)
C6^1
"DATA",9002313.91,11,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,11,10,1,0)
S BPS("X")=$G(BPS("Insurer","Relationship"))
"DATA",9002313.91,11,25,0)
^9002313.9104^1^1^3040114^^^
"DATA",9002313.91,11,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,11,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,11,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,6)=BPS("X")
"DATA",9002313.91,12,0)
308^^OTHER COVERAGE CODE^N^
"DATA",9002313.91,12,5)
C8^2
"DATA",9002313.91,12,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,12,10,1,0)
S BPS("X")=$G(BPS("Patient","Other Coverage Code")) S:'BPS("X") BPS("X")=0
"DATA",9002313.91,12,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,12,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,12,30,0)
^9002313.9103^1^1^3061120^^
"DATA",9002313.91,12,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),300),U,8)=BPS("X")
"DATA",9002313.91,13,0)
401^^DATE FILLED^N^
"DATA",9002313.91,13,5)
D1^8
"DATA",9002313.91,13,10,0)
^^1^1^3061023^
"DATA",9002313.91,13,10,1,0)
S BPS("X")=$G(BPS("RX",BPS("RX",0),"Date Filled"))
"DATA",9002313.91,13,25,0)
^9002313.9104^1^1^3040113^^^^
"DATA",9002313.91,13,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,13,30,0)
^^2^2^3061023^
"DATA",9002313.91,13,30,1,0)
S $P(^BPSC(BPS(9002313.02),401),U,1)=BPS("X")
"DATA",9002313.91,13,30,2,0)
S $P(^BPSC(BPS(9002313.02),400,BPS("RX",0),400),U,1)=BPS("X")
"DATA",9002313.91,14,0)
307^^CUSTOMER LOCATION^A/N^
"DATA",9002313.91,14,5)
C7^2
"DATA",9002313.91,14,10,0)
^9002313.9101^1^1^3040820^^^^
"DATA",9002313.91,14,10,1,0)
S BPS("X")=$G(BPS("Customer Location")) S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,14,25,0)
^^1^1^3061121^
"DATA",9002313.91,14,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,14,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,14,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,7)=BPS("X")
"DATA",9002313.91,15,0)
309^^ELIGIBILITY CLARIFICATION CODE^N^
"DATA",9002313.91,15,5)
C9^1
"DATA",9002313.91,15,10,0)
^^1^1^3061023^
"DATA",9002313.91,15,10,1,0)
S BPS("X")=0
"DATA",9002313.91,15,25,0)
^^1^1^3061121^
"DATA",9002313.91,15,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,15,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,15,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,9)=BPS("X")
"DATA",9002313.91,16,0)
310^^PATIENT FIRST NAME^A/N^
"DATA",9002313.91,16,5)
CA^12
"DATA",9002313.91,16,10,0)
^^2^2^3050727^
"DATA",9002313.91,16,10,1,0)
S BPS("X")=$G(BPS("Patient","First Name"))
"DATA",9002313.91,16,10,2,0)
I BPS("X")="" N X S X=$G(BPS("Patient","Name")) D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("GIVEN")) K X
"DATA",9002313.91,16,25,0)
^^1^1^3061121^
"DATA",9002313.91,16,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,16,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,16,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,10)=BPS("X")
"DATA",9002313.91,17,0)
311^^PATIENT LAST NAME^A/N^
"DATA",9002313.91,17,5)
CB^15
"DATA",9002313.91,17,10,0)
^^2^2^3050727^
"DATA",9002313.91,17,10,1,0)
S BPS("X")=$G(BPS("Patient","Last Name"))
"DATA",9002313.91,17,10,2,0)
I BPS("X")="" N X S X=$G(BPS("Patient","Name")) D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,17,25,0)
^^1^1^3061121^
"DATA",9002313.91,17,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,17,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,17,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,11)=BPS("X")
"DATA",9002313.91,18,0)
402^^PRESCRIPTION NUMBER^N^
"DATA",9002313.91,18,5)
D2^7
"DATA",9002313.91,18,10,0)
^9002313.9101^1^1^3040109^^^
"DATA",9002313.91,18,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"RX IEN"))
"DATA",9002313.91,18,25,0)
^^2^2^3061121^
"DATA",9002313.91,18,25,1,0)
I $L(BPS("X"))>7 S BPS("X")=$E(BPS("X"),$L(BPS("X"))-6,$L(BPS("X")))
"DATA",9002313.91,18,25,2,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,18,30,0)
^9002313.9103^1^1^3040109^^^^
"DATA",9002313.91,18,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,2)=BPS("X")
"DATA",9002313.91,19,0)
403^^NEW/REFILL CODE^N^
"DATA",9002313.91,19,5)
D3^2
"DATA",9002313.91,19,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,19,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Refill #"))
"DATA",9002313.91,19,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,19,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,19,30,0)
1^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,19,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,3)=BPS("X")
"DATA",9002313.91,21,0)
405^^DAYS SUPPLY^N^
"DATA",9002313.91,21,5)
D5^3
"DATA",9002313.91,21,10,0)
^9002313.9101^1^1^3040109^^^^
"DATA",9002313.91,21,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Days Supply"))
"DATA",9002313.91,21,25,0)
^9002313.9104^1^1^3030827^^^^
"DATA",9002313.91,21,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,21,30,0)
^9002313.9103^1^1^3030827^^^^
"DATA",9002313.91,21,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,5)=BPS("X")
"DATA",9002313.91,22,0)
406^^COMPOUND CODE^N^
"DATA",9002313.91,22,5)
D6^407
"DATA",9002313.91,22,10,0)
^9002313.9101^2^2^3040114^^^^
"DATA",9002313.91,22,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Compound Code"))
"DATA",9002313.91,22,10,2,0)
S:BPS("X")="" BPS("X")=1
"DATA",9002313.91,22,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,22,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,22,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,22,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,6)=BPS("X")
"DATA",9002313.91,23,0)
407^^PRODUCT/SERVICE ID^A/N^
"DATA",9002313.91,23,5)
D7^19
"DATA",9002313.91,23,10,0)
^9002313.9101^2^2^3030825^
"DATA",9002313.91,23,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"NDC"))
"DATA",9002313.91,23,10,2,0)
S BPS("X")=$$NDCF^BPSECFM(BPS("X"))
"DATA",9002313.91,23,25,0)
^9002313.9104^1^1^3030825^^^
"DATA",9002313.91,23,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,23,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,23,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,7)=BPS("X")
"DATA",9002313.91,24,0)
408^^OTHER COVERAGE CODE^N^
"DATA",9002313.91,24,5)
D8^1
"DATA",9002313.91,24,10,0)
^^2^2^3070205^
"DATA",9002313.91,24,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DAW"))
"DATA",9002313.91,24,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,24,25,0)
^^1^1^3061120^
"DATA",9002313.91,24,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,24,30,0)
^^1^1^3030722^
"DATA",9002313.91,24,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,8)=BPS("X")
"DATA",9002313.91,25,0)
409^^INGREDIENT COST^D^
"DATA",9002313.91,25,5)
D9^8
"DATA",9002313.91,25,10,0)
^^1^1^3040907^
"DATA",9002313.91,25,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Gross Amount Due"))
"DATA",9002313.91,25,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,25,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,25,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,25,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,9)=BPS("X")
"DATA",9002313.91,26,0)
411^^PRESCRIBER ID^A/N^
"DATA",9002313.91,26,5)
DB^15
"DATA",9002313.91,26,10,0)
^9002313.9101^1^1^3070214^^
"DATA",9002313.91,26,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber NPI"))
"DATA",9002313.91,26,25,0)
^^1^1^3070214^
"DATA",9002313.91,26,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,26,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,26,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,11)=BPS("X")
"DATA",9002313.91,27,0)
414^^DATE PRESCRIPTION WRITTEN^N^
"DATA",9002313.91,27,5)
DE^8
"DATA",9002313.91,27,10,0)
^9002313.9101^1^1^3040913^^^^
"DATA",9002313.91,27,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Date Written"))
"DATA",9002313.91,27,25,0)
^9002313.9104^1^1^3040913^^^^
"DATA",9002313.91,27,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,27,30,0)
^9002313.9103^1^1^3040913^^^^
"DATA",9002313.91,27,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,14)=BPS("X")
"DATA",9002313.91,28,0)
415^^NUMBER REFILLS AUTHORIZED^N^
"DATA",9002313.91,28,5)
DF^2
"DATA",9002313.91,28,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,28,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"# Refills"))
"DATA",9002313.91,28,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,28,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,28,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,28,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,15)=BPS("X")
"DATA",9002313.91,29,0)
419^^PRESCRIPTION ORIGIN CODE^N^
"DATA",9002313.91,29,5)
DJ^1
"DATA",9002313.91,29,10,0)
^9002313.9101^2^2^3030721^^^^
"DATA",9002313.91,29,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Origin Code"))
"DATA",9002313.91,29,10,2,0)
S:BPS("X")="" BPS("X")="0"
"DATA",9002313.91,29,25,0)
^9002313.9104^1^1^3030721^^^^
"DATA",9002313.91,29,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,29,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,29,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,19)=BPS("X")
"DATA",9002313.91,30,0)
420^^PRESCRIPTION CLARIFICATION^N^
"DATA",9002313.91,30,5)
DK^2
"DATA",9002313.91,30,10,0)
^9002313.9101^2^2^3030721^^^^
"DATA",9002313.91,30,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Clarification"))
"DATA",9002313.91,30,10,2,0)
S:BPS("X")="" BPS("X")="00"
"DATA",9002313.91,30,25,0)
^9002313.9104^1^1^3030721^^^^
"DATA",9002313.91,30,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,30,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,30,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,20)=BPS("X")
"DATA",9002313.91,31,0)
453^^ORIG PRESCR PROD/SERV ID QUAL^N^
"DATA",9002313.91,31,5)
EJ^2
"DATA",9002313.91,31,10,0)
^^1^1^3040907^
"DATA",9002313.91,31,10,1,0)
S BPS("X")=""
"DATA",9002313.91,31,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,31,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,31,30,0)
^9002313.9103^1^1^3040907^^^
"DATA",9002313.91,31,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,3)=""
"DATA",9002313.91,33,0)
423^^BASIS OF COST DETERMINATION^A/N^
"DATA",9002313.91,33,5)
DN^2
"DATA",9002313.91,33,10,0)
^9002313.9101^1^1^3030916^^^^
"DATA",9002313.91,33,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Basis of Cost Determination"))
"DATA",9002313.91,33,25,0)
^^1^1^3061121^
"DATA",9002313.91,33,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,33,30,0)
^9002313.9103^1^1^3030916^^^^
"DATA",9002313.91,33,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,23)=BPS("X")
"DATA",9002313.91,34,0)
424^^DIAGNOSIS CODE^A/N^
"DATA",9002313.91,34,5)
DO^15
"DATA",9002313.91,34,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,34,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Diagnosis Code"))
"DATA",9002313.91,34,25,0)
^^1^1^3061122^
"DATA",9002313.91,34,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,34,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,34,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,24)=BPS("X")
"DATA",9002313.91,35,0)
430^^GROSS AMOUNT DUE^D^
"DATA",9002313.91,35,5)
DU^8
"DATA",9002313.91,35,10,0)
^9002313.9101^1^1^3030722^^^^
"DATA",9002313.91,35,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Gross Amount Due"))
"DATA",9002313.91,35,25,0)
^^1^1^3061122^
"DATA",9002313.91,35,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,35,30,0)
^9002313.9103^1^1^3030722^^^^
"DATA",9002313.91,35,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,30)=BPS("X")
"DATA",9002313.91,36,0)
433^^PATIENT PAID AMOUNT^D^
"DATA",9002313.91,36,5)
DX^8
"DATA",9002313.91,36,10,0)
^^1^1^3061023^
"DATA",9002313.91,36,10,1,0)
S BPS("X")="0.00"
"DATA",9002313.91,36,25,0)
^^1^1^3061122^
"DATA",9002313.91,36,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,36,30,0)
^9002313.9103^1^1^3030916^^
"DATA",9002313.91,36,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,3)=BPS("X")
"DATA",9002313.91,37,0)
439^^DUR CONFLICT CODE^A/N^
"DATA",9002313.91,37,5)
E4^2
"DATA",9002313.91,37,10,0)
^9002313.9101^1^1^3031230^
"DATA",9002313.91,37,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Conflict Code",439))
"DATA",9002313.91,37,25,0)
^9002313.9104^1^1^3031230^^
"DATA",9002313.91,37,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,37,30,0)
^9002313.9103^1^1^3031230^^^^
"DATA",9002313.91,37,30,1,0)
D FLD439^BPSOSSG
"DATA",9002313.91,38,0)
440^^DUR INTERVENTION CODE^A/N^
"DATA",9002313.91,38,5)
E5^2
"DATA",9002313.91,38,10,0)
^9002313.9101^1^1^3031230^
"DATA",9002313.91,38,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Intervention Code",440))
"DATA",9002313.91,38,25,0)
^^1^1^3061122^
"DATA",9002313.91,38,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,38,30,0)
^9002313.9103^2^2^3031230^^^^
"DATA",9002313.91,38,30,1,0)
D FLD440^BPSOSSG
"DATA",9002313.91,38,30,2,0)
;S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,40)=BPS("X")
"DATA",9002313.91,39,0)
441^^DUR OUTCOME CODE^A/N^
"DATA",9002313.91,39,5)
E6^2
"DATA",9002313.91,39,10,0)
^9002313.9101^2^2^3070214^^
"DATA",9002313.91,39,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Outcome Code",441))
"DATA",9002313.91,39,10,2,0)
S:BPS("X")="" BPS("X")="00"
"DATA",9002313.91,39,25,0)
^9002313.9104^1^1^3070214^^
"DATA",9002313.91,39,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,39,30,0)
^9002313.9103^2^2^3031230^^^^
"DATA",9002313.91,39,30,1,0)
D FLD441^BPSOSSG
"DATA",9002313.91,39,30,2,0)
;S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,41)=BPS("X")
"DATA",9002313.91,40,0)
442^^QUANTITY DISPENSED^N^
"DATA",9002313.91,40,5)
E7^10
"DATA",9002313.91,40,10,0)
^9002313.9101^1^1^3070620^^
"DATA",9002313.91,40,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Quantity"))*1000\1
"DATA",9002313.91,40,25,0)
^^1^1^3061122^
"DATA",9002313.91,40,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,40,30,0)
^9002313.9103^1^1^3040109^^^^
"DATA",9002313.91,40,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,2)=BPS("X")
"DATA",9002313.91,42,0)
412^^DISPENSING FEE SUBMITTED^D^
"DATA",9002313.91,42,5)
DC^8
"DATA",9002313.91,42,10,0)
^^1^1^3040907^
"DATA",9002313.91,42,10,1,0)
S BPS("X")=""
"DATA",9002313.91,42,25,0)
^^1^1^3061121^
"DATA",9002313.91,42,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,42,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,42,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,12)=BPS("X")
"DATA",9002313.91,44,0)
418^^LEVEL OF SERVICE^N^
"DATA",9002313.91,44,5)
DI^2
"DATA",9002313.91,44,10,0)
^9002313.9101^2^2^3070215^^
"DATA",9002313.91,44,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Level of Service"))
"DATA",9002313.91,44,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,44,25,0)
^9002313.9104^1^1^3070215^^
"DATA",9002313.91,44,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,44,30,0)
^9002313.9103^1^1^3070215^^^^
"DATA",9002313.91,44,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,18)=BPS("X")
"DATA",9002313.91,45,0)
421^^PRIMARY PRESCRIBER^A/N^
"DATA",9002313.91,45,5)
DL^15
"DATA",9002313.91,45,10,0)
^^1^1^3070214^
"DATA",9002313.91,45,10,1,0)
S BPS("X")=BPS("RX",BPS(9002313.0201),"Primary Care Provider NPI")
"DATA",9002313.91,45,25,0)
^^1^1^3070214^
"DATA",9002313.91,45,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,45,30,0)
^^1^1^3041015^
"DATA",9002313.91,45,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,21)=""
"DATA",9002313.91,46,0)
426^^USUAL & CUSTOMARY CHARGE^D^
"DATA",9002313.91,46,5)
DQ^8
"DATA",9002313.91,46,10,0)
^9002313.9101^1^1^3031219^
"DATA",9002313.91,46,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Usual & Customary"))
"DATA",9002313.91,46,25,0)
^9002313.9104^1^1^3031219^^^^
"DATA",9002313.91,46,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,46,30,0)
^9002313.9103^1^1^3031219^^^^
"DATA",9002313.91,46,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,26)=BPS("X")
"DATA",9002313.91,47,0)
429^^UNIT DOSE INDICATOR^N^
"DATA",9002313.91,47,5)
DT^1
"DATA",9002313.91,47,10,0)
^9002313.9101^2^2^3030823^^^
"DATA",9002313.91,47,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Unit Dose Indicator"))
"DATA",9002313.91,47,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,47,25,0)
^^1^1^3061122^
"DATA",9002313.91,47,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,47,30,0)
^9002313.9103^1^1^3030823^^^
"DATA",9002313.91,47,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,29)=BPS("X")
"DATA",9002313.91,48,0)
431^^OTHER PAYOR AMOUNT^D^
"DATA",9002313.91,48,5)
DV^8
"DATA",9002313.91,48,10,0)
^9002313.9101^1^1^3000930^
"DATA",9002313.91,48,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Other Payor Amount"))
"DATA",9002313.91,48,25,0)
^^1^1^3031212^
"DATA",9002313.91,48,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,48,30,0)
^^1^1^2960410^^^
"DATA",9002313.91,48,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,31)=BPS("X")
"DATA",9002313.91,49,0)
438^^INCENTIVE AMOUNT SUBMITTED^D^
"DATA",9002313.91,49,5)
E3^8
"DATA",9002313.91,49,10,0)
^^1^1^3040907^
"DATA",9002313.91,49,10,1,0)
S BPS("X")=0
"DATA",9002313.91,49,25,0)
^^1^1^3061122^
"DATA",9002313.91,49,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,49,30,0)
^^1^1^3040907^
"DATA",9002313.91,49,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,8)=""
"DATA",9002313.91,51,0)
443^^Other Payer Date^N^
"DATA",9002313.91,51,5)
E8^8
"DATA",9002313.91,51,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,51,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Primary Payor Denial Date"))
"DATA",9002313.91,51,25,0)
^^1^1^3040224^
"DATA",9002313.91,51,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,51,30,0)
^9002313.9103^1^1^3040224^^^^
"DATA",9002313.91,51,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,43)=BPS("X")
"DATA",9002313.91,52,0)
313^^CARDHOLDER LAST NAME^A/N^
"DATA",9002313.91,52,5)
CD^15
"DATA",9002313.91,52,10,0)
^9002313.9101^3^3^3050802^^
"DATA",9002313.91,52,10,1,0)
S BPS("X")=$G(BPS("Cardholder","Last Name"))
"DATA",9002313.91,52,10,2,0)
I BPS("X")="" S BPS("X")=$G(BPS("Cardholder","Name"))
"DATA",9002313.91,52,10,3,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,52,25,0)
^^1^1^3061121^
"DATA",9002313.91,52,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,52,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,52,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,13)=BPS("X")
"DATA",9002313.91,53,0)
312^^CARDHOLDER FIRST NAME^A/N^
"DATA",9002313.91,53,5)
CC^12
"DATA",9002313.91,53,10,0)
^9002313.9101^3^3^3050802^^
"DATA",9002313.91,53,10,1,0)
S BPS("X")=","_$G(BPS("Cardholder","First Name"))
"DATA",9002313.91,53,10,2,0)
I BPS("X")="," S BPS("X")=$G(BPS("Cardholder","Name"))
"DATA",9002313.91,53,10,3,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("GIVEN")) K X
"DATA",9002313.91,53,25,0)
^^1^1^3061121^
"DATA",9002313.91,53,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,53,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,53,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,12)=BPS("X")
"DATA",9002313.91,54,0)
322^^PATIENT STREET ADDRESS^A/N^
"DATA",9002313.91,54,5)
CM^30
"DATA",9002313.91,54,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,54,10,1,0)
S BPS("X")=$G(BPS("Patient","Street Address"))
"DATA",9002313.91,54,25,0)
^^1^1^3061121^
"DATA",9002313.91,54,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,54,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,54,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,2)=BPS("X")
"DATA",9002313.91,55,0)
323^^PATIENT CITY^A/N^
"DATA",9002313.91,55,5)
CN^20
"DATA",9002313.91,55,10,0)
^9002313.9101^1^1^3030703^^^^
"DATA",9002313.91,55,10,1,0)
S BPS("X")=$G(BPS("Patient","City"))
"DATA",9002313.91,55,25,0)
^^1^1^3061121^
"DATA",9002313.91,55,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,55,30,0)
^9002313.9103^1^1^3030703^^^^
"DATA",9002313.91,55,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,3)=BPS("X")
"DATA",9002313.91,56,0)
324^^PATIENT STATE^A/N^
"DATA",9002313.91,56,5)
CO^2
"DATA",9002313.91,56,10,0)
^9002313.9101^1^1^3030717^^^^
"DATA",9002313.91,56,10,1,0)
S BPS("X")=$G(BPS("Patient","State"))
"DATA",9002313.91,56,25,0)
^^1^1^3061121^
"DATA",9002313.91,56,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,56,30,0)
^9002313.9103^1^1^3030717^^^^
"DATA",9002313.91,56,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,4)=BPS("X")
"DATA",9002313.91,57,0)
325^^PATIENT ZIP^A/N^
"DATA",9002313.91,57,5)
CP^15
"DATA",9002313.91,57,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,57,10,1,0)
S BPS("X")=$G(BPS("Patient","Zip"))
"DATA",9002313.91,57,25,0)
^9002313.9104^2^2^3030718^^^^
"DATA",9002313.91,57,25,1,0)
S BPS("X")=$TR(BPS("X"),"-/._","")
"DATA",9002313.91,57,25,2,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,57,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,57,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,5)=BPS("X")
"DATA",9002313.91,58,0)
314^^HOME PLAN^A/N^
"DATA",9002313.91,58,5)
CE^3
"DATA",9002313.91,58,10,0)
^9002313.9101^1^1^3030823^^
"DATA",9002313.91,58,10,1,0)
S BPS("X")=$G(BPS("Home Plan"))
"DATA",9002313.91,58,25,0)
^^1^1^3061121^
"DATA",9002313.91,58,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),3)
"DATA",9002313.91,58,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,58,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,14)=BPS("X")
"DATA",9002313.91,59,0)
315^^EMPLOYER NAME^A/N^
"DATA",9002313.91,59,5)
CF^30
"DATA",9002313.91,59,10,0)
^^2^2^3061023^
"DATA",9002313.91,59,10,1,0)
D EMPL^BPSOSSG
"DATA",9002313.91,59,10,2,0)
S BPS("X")=$G(BPS("Employer","Name"))
"DATA",9002313.91,59,25,0)
^9002313.9104^1^1^3030718^^^
"DATA",9002313.91,59,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,59,30,0)
^^1^1^3061120^
"DATA",9002313.91,59,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,5)=BPS("X")
"DATA",9002313.91,60,0)
316^^EMPLOYER STREET ADDRESS^A/N^
"DATA",9002313.91,60,5)
CG^30
"DATA",9002313.91,60,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,60,10,1,0)
S BPS("X")=$G(BPS("Employer","Address"))
"DATA",9002313.91,60,25,0)
^9002313.9104^1^1^3030718^^^
"DATA",9002313.91,60,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,60,30,0)
^^1^1^3061120^
"DATA",9002313.91,60,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,6)=BPS("X")
"DATA",9002313.91,61,0)
317^^EMPLOYER CITY ADDRESS^A/N^
"DATA",9002313.91,61,5)
CH^20
"DATA",9002313.91,61,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,61,10,1,0)
S BPS("X")=$G(BPS("Employer","City"))
"DATA",9002313.91,61,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,61,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,61,30,0)
^^1^1^3061120^
"DATA",9002313.91,61,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,7)=BPS("X")
"DATA",9002313.91,62,0)
318^^EMPLOYER STATE^A/N^
"DATA",9002313.91,62,5)
CI^2
"DATA",9002313.91,62,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,62,10,1,0)
S BPS("X")=$G(BPS("Employer","State"))
"DATA",9002313.91,62,25,0)
^^1^1^3061121^
"DATA",9002313.91,62,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,62,30,0)
^^1^1^3061120^
"DATA",9002313.91,62,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,8)=BPS("X")
"DATA",9002313.91,63,0)
319^^EMPLOYER ZIP CODE^A/N^
"DATA",9002313.91,63,5)
CJ^15
"DATA",9002313.91,63,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,63,10,1,0)
S BPS("X")=$G(BPS("Employer","Zip Code"))
"DATA",9002313.91,63,25,0)
^^1^1^3061121^
"DATA",9002313.91,63,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,63,30,0)
^^1^1^3061120^
"DATA",9002313.91,63,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,9)=BPS("X")
"DATA",9002313.91,64,0)
327^^CARRIER ID #^A/N^
"DATA",9002313.91,64,5)
CR^12
"DATA",9002313.91,64,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,64,10,1,0)
S BPS("X")=$G(BPS("Carrier ID #"))
"DATA",9002313.91,64,25,0)
^^1^1^3061121^
"DATA",9002313.91,64,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,64,30,0)
^^1^1^3061120^
"DATA",9002313.91,64,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,7)=BPS("X")
"DATA",9002313.91,67,0)
427^^PRESCRIBER LAST NAME^A/N^
"DATA",9002313.91,67,5)
DR^15
"DATA",9002313.91,67,10,0)
^9002313.9101^2^2^3050802^^
"DATA",9002313.91,67,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber Name"))
"DATA",9002313.91,67,10,2,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,67,25,0)
^^1^1^3061122^
"DATA",9002313.91,67,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,67,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,67,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),420),U,27)=BPS("X")
"DATA",9002313.91,69,0)
434^^DATE OF INJURY^N^
"DATA",9002313.91,69,5)
DY^8
"DATA",9002313.91,69,10,0)
^9002313.9101^2^2^3010125^^
"DATA",9002313.91,69,10,1,0)
S BPS("X")=$G(BPS("Date of Injury"))
"DATA",9002313.91,69,10,2,0)
S BPS("X")=$$DTF1^BPSECFM(BPS("X"))
"DATA",9002313.91,69,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,69,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,69,30,0)
^^1^1^3010125^^
"DATA",9002313.91,69,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,34)=BPS("X")
"DATA",9002313.91,70,0)
435^^CLAIM/REF ID NUMBER^A/N^
"DATA",9002313.91,70,5)
DZ^30
"DATA",9002313.91,70,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,70,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Claim/Ref ID #"))
"DATA",9002313.91,70,25,0)
^^1^1^3061122^
"DATA",9002313.91,70,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,70,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,70,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,35)=BPS("X")
"DATA",9002313.91,71,0)
436^^PRODUCT/SERV ID QUAL^A/N^
"DATA",9002313.91,71,5)
E1^2
"DATA",9002313.91,71,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,71,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Alt. Product Type"))
"DATA",9002313.91,71,25,0)
^^1^1^3061122^
"DATA",9002313.91,71,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,71,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,71,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,6)=BPS("X")
"DATA",9002313.91,74,0)
498.51^^PRIOR AUTH PROCESSED DATE^A/N^
"DATA",9002313.91,74,5)
PR^8
"DATA",9002313.91,74,10,0)
^^1^1^3040223^
"DATA",9002313.91,74,10,1,0)
S BPS("X")=""
"DATA",9002313.91,75,0)
202^^SERV PROVIDER ID QUALIFIER^A/N^
"DATA",9002313.91,75,5)
B2^2
"DATA",9002313.91,75,10,0)
^9002313.9101^1^1^3070214^^
"DATA",9002313.91,75,10,1,0)
S BPS("X")="01"
"DATA",9002313.91,75,25,0)
^^1^1^3070214^
"DATA",9002313.91,75,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,75,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,75,30,1,0)
S $P(^BPSC(BPS(9002313.02),200),U,2)=BPS("X") ;VA
"DATA",9002313.91,76,0)
110^^SOFTWARE VENDOR/CERT ID^A/N^
"DATA",9002313.91,76,5)
AK^10
"DATA",9002313.91,76,10,0)
^^1^1^3061023^
"DATA",9002313.91,76,10,1,0)
S BPS("X")=$G(BPS("NCPDP","Software Vendor/Cert ID"))
"DATA",9002313.91,76,25,0)
^9002313.9104^1^1^3040202^^^^
"DATA",9002313.91,76,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10) ;VA
"DATA",9002313.91,76,30,0)
^^1^1^3061023^
"DATA",9002313.91,76,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,10)=BPS("X")
"DATA",9002313.91,77,0)
331^^PATIENT ID QUALIFIER^A/N^
"DATA",9002313.91,77,5)
CX^2
"DATA",9002313.91,77,10,0)
^^1^1^3061023^
"DATA",9002313.91,77,10,1,0)
S BPS("X")="01"
"DATA",9002313.91,77,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,77,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,77,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,77,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,1)=BPS("X") ;VA
"DATA",9002313.91,78,0)
332^^PATIENT ID^A/N^
"DATA",9002313.91,78,5)
CY^20
"DATA",9002313.91,78,10,0)
^^1^1^3061023^
"DATA",9002313.91,78,10,1,0)
S BPS("X")=$G(BPS("Patient","SSN"))
"DATA",9002313.91,78,25,0)
^^1^1^3061121^
"DATA",9002313.91,78,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,78,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,78,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,2)=BPS("X") ;VA
"DATA",9002313.91,79,0)
326^^PATIENT PHONE NUMBER^N^
"DATA",9002313.91,79,5)
CQ^10
"DATA",9002313.91,79,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,79,10,1,0)
S BPS("X")=$TR($G(BPS("Patient","Phone #")),"#() -_*.@") ;VA
"DATA",9002313.91,79,25,0)
^9002313.9104^1^1^3030718^^^^
"DATA",9002313.91,79,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10) ;VA
"DATA",9002313.91,79,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,79,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,6)=BPS("X") ;VA
"DATA",9002313.91,80,0)
455^^RX/SERVICE REF NUMBER QUAL^A/N^
"DATA",9002313.91,80,5)
EM^1
"DATA",9002313.91,80,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,80,10,1,0)
S BPS("X")=1  ;VA 
"DATA",9002313.91,80,25,0)
^^1^1^3061122^
"DATA",9002313.91,80,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,80,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,80,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,5)=BPS("X")
"DATA",9002313.91,81,0)
460^^QUANTITY PRESCRIBED^N^
"DATA",9002313.91,81,5)
ET^10
"DATA",9002313.91,81,10,0)
^^1^1^3070620^
"DATA",9002313.91,81,10,1,0)
S BPS("X")=BPS("RX",BPS(9002313.0201),"Quantity")*1000\1
"DATA",9002313.91,81,25,0)
^9002313.9104^1^1^3030827^^^^
"DATA",9002313.91,81,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,81,30,0)
^9002313.9103^1^1^3030827^^^^
"DATA",9002313.91,81,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,10)=BPS("X") ;VA
"DATA",9002313.91,82,0)
465^^PROVIDER ID QUALIFIER^A/N^
"DATA",9002313.91,82,5)
EY^2
"DATA",9002313.91,82,10,0)
^9002313.9101^1^1^3070214^^
"DATA",9002313.91,82,10,1,0)
S BPS("X")="05"
"DATA",9002313.91,82,25,0)
^^1^1^3070214^
"DATA",9002313.91,82,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,82,30,0)
^^1^1^3041015^
"DATA",9002313.91,82,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,5)=""
"DATA",9002313.91,83,0)
444^^PROVIDER ID^A/N^
"DATA",9002313.91,83,5)
E9^15
"DATA",9002313.91,83,10,0)
^9002313.9101^1^1^3070214^^
"DATA",9002313.91,83,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Provider NPI"))
"DATA",9002313.91,83,25,0)
^^1^1^3070214^
"DATA",9002313.91,83,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,83,30,0)
^^1^1^3041015^
"DATA",9002313.91,83,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,4)=""
"DATA",9002313.91,84,0)
466^^PRESCRIBER ID QUALIFIER^A/N^
"DATA",9002313.91,84,5)
EZ^2
"DATA",9002313.91,84,10,0)
^9002313.9101^1^1^3070214^^
"DATA",9002313.91,84,10,1,0)
S BPS("X")="01"
"DATA",9002313.91,84,25,0)
^9002313.9104^1^1^3070214^^^^
"DATA",9002313.91,84,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,84,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,84,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,6)=BPS("X")
"DATA",9002313.91,85,0)
467^^PRESCRIBER LOCATION CODE^A/N^
"DATA",9002313.91,85,5)
1E^3
"DATA",9002313.91,85,10,0)
^9002313.9101^1^1^3030721^^
"DATA",9002313.91,85,10,1,0)
S BPS("X")=$G(BPS("RX",1,"Prescriber Billing Location"))
"DATA",9002313.91,85,25,0)
^^1^1^3061122^
"DATA",9002313.91,85,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,85,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,85,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,7)=BPS("X")
"DATA",9002313.91,86,0)
498^^PRESCRIBER TELEPHONE NUMBER^N^
"DATA",9002313.91,86,5)
PM^10
"DATA",9002313.91,86,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,86,10,1,0)
S BPS("X")=$TR($G(BPS("RX",MEDN,"Prescriber Phone #")),"#() -_*.@")
"DATA",9002313.91,86,25,0)
^^1^1^3061122^
"DATA",9002313.91,86,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,86,30,0)
^9002313.9103^1^1^3040224^^^^
"DATA",9002313.91,86,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),498),U,12)=BPS("X")
"DATA",9002313.91,87,0)
468^^PRIMARY CARE PROV ID QUAL^A/N^
"DATA",9002313.91,87,5)
2E^2
"DATA",9002313.91,87,10,0)
^^1^1^3070214^
"DATA",9002313.91,87,10,1,0)
S BPS("X")="01"
"DATA",9002313.91,87,25,0)
^9002313.9104^1^1^3070214^^^^
"DATA",9002313.91,87,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,87,30,0)
^^1^1^3041015^
"DATA",9002313.91,87,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,8)=""
"DATA",9002313.91,88,0)
469^^PRIM CARE PROV LOCATION CODE^N^
"DATA",9002313.91,88,5)
H5^3
"DATA",9002313.91,88,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,88,10,1,0)
S BPS("X")=$G(BPS("Patient","Primary Care Prov Location Code"))
"DATA",9002313.91,88,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,88,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,88,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,88,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,9)=BPS("X")
"DATA",9002313.91,89,0)
470^^PRIM CARE PROVIDER LAST NAME^A/N^
"DATA",9002313.91,89,5)
4E^15
"DATA",9002313.91,89,10,0)
^9002313.9101^2^2^3050802^^
"DATA",9002313.91,89,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber Name"))
"DATA",9002313.91,89,10,2,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,89,25,0)
^^1^1^3061122^
"DATA",9002313.91,89,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,89,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,89,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,10)=BPS("X")
"DATA",9002313.91,91,0)
480^^OTHER AMT CLAIM SUBMITTED^D^
"DATA",9002313.91,91,5)
H9^8
"DATA",9002313.91,91,10,0)
^9002313.9101^1^1^3040907^^^^
"DATA",9002313.91,91,10,1,0)
S BPS("X")="" I $G(BPS("Insurer","Administrative Fee"))'="" S BPS("X")=BPS("Insurer","Administrative Fee")
"DATA",9002313.91,91,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,91,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,91,30,0)
^9002313.9103^1^1^3040907^^^
"DATA",9002313.91,91,30,1,0)
D FLD480^BPSOSSG
"DATA",9002313.91,92,0)
109^^TRANSACTION COUNT^A/N^
"DATA",9002313.91,92,5)
A9^1
"DATA",9002313.91,92,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,92,10,1,0)
S BPS("X")=BPS("Transaction Count")
"DATA",9002313.91,92,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,92,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,92,30,0)
^9002313.9103^1^1^3040114^^^
"DATA",9002313.91,92,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,9)=BPS("X")
"DATA",9002313.91,93,0)
111^^SEGMENT IDENTIFICATION^A/N^
"DATA",9002313.91,93,5)
AM^2
"DATA",9002313.91,93,10,0)
^9002313.9101^1^1^3040114^^
"DATA",9002313.91,93,10,1,0)
S BPS("X")=""
"DATA",9002313.91,95,0)
112^^TRANSACTION RESPONSE STATUS^A/N^
"DATA",9002313.91,95,5)
AN^2
"DATA",9002313.91,95,10,0)
^9002313.9101^1^1^3040114^^
"DATA",9002313.91,95,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),110)),U,2)
"DATA",9002313.91,95,25,0)
^9002313.9104^1^1^3040114^^
"DATA",9002313.91,95,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,95,30,0)
^9002313.9103^1^1^3040114^^
"DATA",9002313.91,95,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),110),U,2)=BPS("X")
"DATA",9002313.91,96,0)
320^^EMPLOYER PHONE NUMBER^N^
"DATA",9002313.91,96,5)
CK^10
"DATA",9002313.91,96,10,0)
^9002313.9101^1^1^3050802^^^
"DATA",9002313.91,96,10,1,0)
S BPS("X")=$TR($G(BPS("Employer","Phone")),"#() -_*.@")
"DATA",9002313.91,96,25,0)
^^1^1^3061121^
"DATA",9002313.91,96,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,96,30,0)
^^1^1^3061120^
"DATA",9002313.91,96,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,10)=BPS("X")
"DATA",9002313.91,97,0)
321^^EMPLOYER CONTACT NAME^A/N^
"DATA",9002313.91,97,5)
CL^30
"DATA",9002313.91,97,10,0)
^9002313.9101^1^1^3040224^^^
"DATA",9002313.91,97,10,1,0)
S BPS("X")=""
"DATA",9002313.91,97,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,97,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,97,30,0)
^^1^1^3040224^
"DATA",9002313.91,97,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,1)=BPS("X")
"DATA",9002313.91,98,0)
330^^ALTERNANT ID^A/N^
"DATA",9002313.91,98,5)
CW^20
"DATA",9002313.91,98,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,98,10,1,0)
S BPS("X")=""
"DATA",9002313.91,98,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,98,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,98,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,98,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,10)=BPS("X")
"DATA",9002313.91,99,0)
333^^EMPLOYER ID^A/N^
"DATA",9002313.91,99,5)
CZ^15
"DATA",9002313.91,99,10,0)
^9002313.9101^1^1^3030823^^
"DATA",9002313.91,99,10,1,0)
S BPS("X")=""
"DATA",9002313.91,99,25,0)
^^1^1^3030823^
"DATA",9002313.91,99,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,99,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,99,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,3)=BPS("X")
"DATA",9002313.91,100,0)
334^^SMOKER/NONSMOKER^N^
"DATA",9002313.91,100,5)
1C^1
"DATA",9002313.91,100,10,0)
^9002313.9101^1^1^3070620^^^^
"DATA",9002313.91,100,10,1,0)
S BPS("X")=""
"DATA",9002313.91,100,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,100,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,100,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,100,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,4)=BPS("X")
"DATA",9002313.91,101,0)
335^^PREGNANCY INDICATOR^N^
"DATA",9002313.91,101,5)
2C^1
"DATA",9002313.91,101,10,0)
^9002313.9101^1^1^3030823^^^
"DATA",9002313.91,101,10,1,0)
S BPS("X")=""
"DATA",9002313.91,101,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,101,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,101,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,101,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,5)=BPS("X")
"DATA",9002313.91,102,0)
336^^FACILITY ID^A/N^
"DATA",9002313.91,102,5)
8C^10
"DATA",9002313.91,102,10,0)
^^1^1^3070103^
"DATA",9002313.91,102,10,1,0)
S BPS("X")=$G(BPS("Insurer","Facility ID"))
"DATA",9002313.91,102,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,102,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,102,30,0)
^^1^1^3030823^
"DATA",9002313.91,102,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,6)=BPS("X")
"DATA",9002313.91,103,0)
337^^COB/OTHER PAYMENTS COUNTER^N^
"DATA",9002313.91,103,5)
4C^1
"DATA",9002313.91,103,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,103,10,1,0)
S BPS("X")=""
"DATA",9002313.91,103,25,0)
^9002313.9104^1^1^3040223^^^
"DATA",9002313.91,103,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,103,30,0)
^9002313.9103^1^1^3040223^^
"DATA",9002313.91,103,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,1)=BPS("X")
"DATA",9002313.91,104,0)
338^^OTHER PAYER COVERAGE TYPE^N^
"DATA",9002313.91,104,5)
5C^2
"DATA",9002313.91,104,10,0)
^9002313.9101^1^1^3040223^^^^
"DATA",9002313.91,104,10,1,0)
S BPS("X")=$G(BPS("Insurer","Other Payer Coverage Type"))
"DATA",9002313.91,104,25,0)
^9002313.9104^1^1^3040223^^^^
"DATA",9002313.91,104,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,104,30,0)
^^1^1^3040223^
"DATA",9002313.91,104,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,2)=BPS("X")
"DATA",9002313.91,105,0)
339^^OTHER PAYER ID QUALIFIER^N^
"DATA",9002313.91,105,5)
6C^2
"DATA",9002313.91,105,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,105,10,1,0)
S BPS("X")=""
"DATA",9002313.91,105,25,0)
^9002313.9104^1^1^3040223^^^
"DATA",9002313.91,105,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,105,30,0)
^^1^1^3040223^
"DATA",9002313.91,105,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337),U,10)=BPS("X")
"DATA",9002313.91,106,0)
340^^OTHER PAYER ID^A/N^
"DATA",9002313.91,106,5)
7C^10
"DATA",9002313.91,106,10,0)
^9002313.9101^1^1^3040223^^
"DATA",9002313.91,106,10,1,0)
S BPS("X")=""
"DATA",9002313.91,106,25,0)
^9002313.9104^1^1^3040223^^
"DATA",9002313.91,106,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,106,30,0)
^^1^1^3040223^
"DATA",9002313.91,106,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,3)=BPS("X")
"DATA",9002313.91,107,0)
341^^OTHER PAYER AMOUNT PAID COUNT^N^
"DATA",9002313.91,107,5)
HB^1
"DATA",9002313.91,107,10,0)
^^1^1^3040224^
"DATA",9002313.91,107,10,1,0)
S BPS("X")=""
"DATA",9002313.91,107,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,107,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,107,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,107,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,6)=BPS("X")
"DATA",9002313.91,108,0)
342^^OTH PYR AMOUNT PAID QUAL.^A/N^
"DATA",9002313.91,108,5)
HC^2
"DATA",9002313.91,108,10,0)
^9002313.9101^1^1^3040428^^
"DATA",9002313.91,108,10,1,0)
S BPS("X")=""
"DATA",9002313.91,108,25,0)
^^1^1^3040428^
"DATA",9002313.91,108,25,1,0)
S BPS("X")=""
"DATA",9002313.91,108,30,0)
^9002313.9103^1^1^3040428^^^^
"DATA",9002313.91,108,30,1,0)
S FDA(54.3,"IENS(1),",342)=BPS("X")
"DATA",9002313.91,109,0)
343^^DISPENSING STATUS^A/N^
"DATA",9002313.91,109,5)
HD^1
"DATA",9002313.91,109,10,0)
^9002313.9101^1^1^3040913^^^^
"DATA",9002313.91,109,10,1,0)
S BPS("X")=""
"DATA",9002313.91,109,25,0)
^9002313.9104^1^1^3040913^^^^
"DATA",9002313.91,109,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,109,30,0)
^^1^1^3070620^
"DATA",9002313.91,109,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340),U,3)=""
"DATA",9002313.91,110,0)
344^^QTY INTENDED TO BE DISPENSED^N^
"DATA",9002313.91,110,5)
HF^10
"DATA",9002313.91,110,10,0)
^^1^1^3070620^
"DATA",9002313.91,110,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Quantity"))*1000\1
"DATA",9002313.91,110,25,0)
^^1^1^3070620^
"DATA",9002313.91,110,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,110,30,0)
^^1^1^3070620^
"DATA",9002313.91,110,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340),U,4)=""
"DATA",9002313.91,111,0)
345^^DAYS SUPPLY INTEND TO BE DISP^N^
"DATA",9002313.91,111,5)
HG^3
"DATA",9002313.91,111,10,0)
^9002313.9101^1^1^3030827^
"DATA",9002313.91,111,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Days Supply"))*1000
"DATA",9002313.91,111,25,0)
^9002313.9104^1^1^3030827^^^
"DATA",9002313.91,111,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,111,30,0)
^^1^1^3070620^
"DATA",9002313.91,111,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340),U,5)=""
"DATA",9002313.91,112,0)
346^^BASIS OF CALC - DISP. FEE^A/N^
"DATA",9002313.91,112,5)
HH^8
"DATA",9002313.91,112,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,112,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,6)
"DATA",9002313.91,112,25,0)
^^1^1^3031205^
"DATA",9002313.91,112,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,112,30,0)
^^1^1^3031205^
"DATA",9002313.91,112,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,6)=BPS("X")
"DATA",9002313.91,113,0)
347^^BASIS OF CALC - COPAY^A/N^
"DATA",9002313.91,113,5)
HJ^8
"DATA",9002313.91,113,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,113,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,7)
"DATA",9002313.91,113,25,0)
^9002313.9104^1^1^3040114^^^
"DATA",9002313.91,113,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,113,30,0)
^9002313.9103^1^1^3040114^^^
"DATA",9002313.91,113,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,7)=BPS("X")
"DATA",9002313.91,114,0)
348^^BASIS OF CALC - FLAT SALES TAX^A/N^
"DATA",9002313.91,114,5)
HK^8
"DATA",9002313.91,114,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,114,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,8)
"DATA",9002313.91,114,25,0)
^^1^1^3031205^
"DATA",9002313.91,114,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,114,30,0)
^^1^1^3031205^
"DATA",9002313.91,114,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,8)=BPS("X")
"DATA",9002313.91,115,0)
349^^BASIS OF CALC - %SALES TAX^A/N^
"DATA",9002313.91,115,5)
HM^8
"DATA",9002313.91,115,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,115,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,9)
"DATA",9002313.91,115,25,0)
^^1^1^3031205^
"DATA",9002313.91,115,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,115,30,0)
^^1^1^3031205^
"DATA",9002313.91,115,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,9)=BPS("X")
"DATA",9002313.91,116,0)
350^^PATIENT E-MAIL ADDRESS^A/N^
"DATA",9002313.91,116,5)
HN^80
"DATA",9002313.91,116,10,0)
^^1^1^3030512^
"DATA",9002313.91,116,10,1,0)
S BPS("X")=""
"DATA",9002313.91,117,0)
351^^OTHER PAYER-PAT RESP AMT QUAL^A/N^
"DATA",9002313.91,117,5)
NP^1
"DATA",9002313.91,117,10,0)
^^1^1^3031212^
"DATA",9002313.91,117,10,1,0)
S BPS("X")=""
"DATA",9002313.91,118,0)
352^^OTHER PAYER-PAT RESP AMOUNT^D^
"DATA",9002313.91,118,5)
NQ^10
"DATA",9002313.91,118,10,0)
^^1^1^3031212^
"DATA",9002313.91,118,10,1,0)
S BPS("X")=""
"DATA",9002313.91,118,25,0)
^^1^1^3031212^
"DATA",9002313.91,118,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,119,0)
353^^OTHER PAYER-PAT RESP AMT CNT^N^
"DATA",9002313.91,119,5)
NR^1
"DATA",9002313.91,119,10,0)
^^1^1^3031212^
"DATA",9002313.91,119,10,1,0)
S BPS("X")=""
"DATA",9002313.91,120,0)
445^^ORIG PRESCRIBED PROD/SERV CODE^A/N^
"DATA",9002313.91,120,5)
EA^19
"DATA",9002313.91,120,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,120,10,1,0)
S BPX("X")=""
"DATA",9002313.91,120,25,0)
^9002313.9104^1^1^3040107^^
"DATA",9002313.91,120,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),19)
"DATA",9002313.91,120,30,0)
^9002313.9103^1^1^3040107^^
"DATA",9002313.91,120,30,1,0)
S BPS("X")=""
"DATA",9002313.91,121,0)
446^^ORIGINALLY PRESCRIBED QTY^N^
"DATA",9002313.91,121,5)
EB^10
"DATA",9002313.91,121,10,0)
^9002313.9101^1^1^3070620^^
"DATA",9002313.91,121,10,1,0)
S BPS("X")=BPS("RX",BPS(9002313.0201),"Quantity")*1000\1
"DATA",9002313.91,121,25,0)
^9002313.9104^1^1^3030828^^^^
"DATA",9002313.91,121,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,121,30,0)
^9002313.9103^1^1^3030828^^^^
"DATA",9002313.91,121,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,6)=BPS("X") ;VA
"DATA",9002313.91,122,0)
454^^SCHEDULED PRESCRIPTION ID NUM^N^
"DATA",9002313.91,122,5)
EK^12
"DATA",9002313.91,122,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,122,10,1,0)
S BPS("X")=""
"DATA",9002313.91,122,25,0)
^9002313.9104^1^1^3040224^^
"DATA",9002313.91,122,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,122,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,122,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,4)=BPS("X")
"DATA",9002313.91,123,0)
456^^ASSOC RX/SERVICE REF NUMBER^A/N^
"DATA",9002313.91,123,5)
EN^7
"DATA",9002313.91,123,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,123,10,1,0)
S BPS("X")=""
"DATA",9002313.91,123,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,123,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),7)
"DATA",9002313.91,123,30,0)
^^1^1^3030823^
"DATA",9002313.91,123,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,6)=BPS("X")
"DATA",9002313.91,124,0)
457^^ASSOC RX/SERVICE DATE^A/N^
"DATA",9002313.91,124,5)
EP^8
"DATA",9002313.91,124,10,0)
^9002313.9101^1^1^3030825^^^^
"DATA",9002313.91,124,10,1,0)
S BPS("X")=""
"DATA",9002313.91,124,25,0)
^9002313.9104^1^1^3030825^^
"DATA",9002313.91,124,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,124,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,124,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,7)=BPS("X")
"DATA",9002313.91,125,0)
458^^PROCEDURE MODIFIER CODE COUNT^N^
"DATA",9002313.91,125,5)
SE^1
"DATA",9002313.91,125,10,0)
^9002313.9101^1^1^3040819^^^^
"DATA",9002313.91,125,10,1,0)
S BPS("X")=""
"DATA",9002313.91,125,25,0)
^9002313.9104^1^1^3040819^^^^
"DATA",9002313.91,125,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,125,30,0)
^^1^1^3040819^
"DATA",9002313.91,125,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,8)=""
"DATA",9002313.91,126,0)
459^^PROCEDURE MODIFIER CODE^A/N^
"DATA",9002313.91,126,5)
ER^2
"DATA",9002313.91,126,10,0)
^9002313.9101^1^1^3040819^^^^
"DATA",9002313.91,126,10,1,0)
S BPS("X")=""
"DATA",9002313.91,126,25,0)
^9002313.9104^1^1^3040819^^^^
"DATA",9002313.91,126,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,126,30,0)
^^1^1^3040819^
"DATA",9002313.91,126,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,10)=""
"DATA",9002313.91,127,0)
461^^PRIOR AUTHORIZATION TYPE CODE^N^
"DATA",9002313.91,127,5)
EU^2
"DATA",9002313.91,127,10,0)
^9002313.9101^2^2^3031222^
"DATA",9002313.91,127,10,1,0)
S BPS("X")=$G(BPS("Claim",MEDN,"Prior Auth Type"))
"DATA",9002313.91,127,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,127,25,0)
^9002313.9104^1^1^3031222^^^^
"DATA",9002313.91,127,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,127,30,0)
^9002313.9103^1^1^3031222^^^^
"DATA",9002313.91,127,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,1)=BPS("X")
"DATA",9002313.91,128,0)
462^^PRIOR AUTHORIZATION NUM SUB^A/N^
"DATA",9002313.91,128,5)
EV^11
"DATA",9002313.91,128,10,0)
^9002313.9101^1^1^3031222^
"DATA",9002313.91,128,10,1,0)
S BPS("X")=$G(BPS("Claim",MEDN,"Prior Auth Num Sub"))
"DATA",9002313.91,128,25,0)
^9002313.9104^1^1^3031222^^^^
"DATA",9002313.91,128,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,128,30,0)
^9002313.9103^1^1^3031222^^^^
"DATA",9002313.91,128,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,2)=BPS("X")
"DATA",9002313.91,129,0)
464^^INTERMEDIARY AUTHORIZATION ID^A/N^
"DATA",9002313.91,129,5)
EX^11
"DATA",9002313.91,129,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,129,10,1,0)
S BPS("X")=""
"DATA",9002313.91,129,25,0)
^^1^1^3030823^
"DATA",9002313.91,129,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),11)
"DATA",9002313.91,129,30,0)
^9002313.9103^1^1^3030823^^^
"DATA",9002313.91,129,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,4)=BPS("X")
"DATA",9002313.91,130,0)
471^^OTHER PAYER REJECT COUNT^N^
"DATA",9002313.91,130,5)
5E^2
"DATA",9002313.91,130,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,130,10,1,0)
S BPS("X")=""
"DATA",9002313.91,130,25,0)
^9002313.9104^1^1^3040224^^
"DATA",9002313.91,130,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,130,30,0)
^^1^1^3040224^
"DATA",9002313.91,130,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,4)=BPS("X")
"DATA",9002313.91,131,0)
472^^OTHER PAYER REJECT CODE^A/N^
"DATA",9002313.91,131,5)
6E^3
"DATA",9002313.91,131,10,0)
^9002313.9101^1^1^3040224^^^
"DATA",9002313.91,131,10,1,0)
S BPS("X")=""
"DATA",9002313.91,131,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,131,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,132,0)
473^^DUR/PPS CODE COUNTER^N^
"DATA",9002313.91,132,5)
7E^1
"DATA",9002313.91,132,10,0)
^9002313.9101^1^1^3031230^^^^
"DATA",9002313.91,132,10,1,0)
S BPS("X")=1
"DATA",9002313.91,132,25,0)
^9002313.9104^1^1^3031230^^^^
"DATA",9002313.91,132,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,132,30,0)
^9002313.9103^1^1^3031230^^^^
"DATA",9002313.91,132,30,1,0)
D FLD473^BPSOSSG
"DATA",9002313.91,133,0)
474^^DUR/PPS LEVEL OF EFFORT^N^
"DATA",9002313.91,133,5)
8E^2
"DATA",9002313.91,133,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,133,10,1,0)
S BPS("X")=12
"DATA",9002313.91,133,25,0)
^^1^1^3030718^
"DATA",9002313.91,133,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,133,30,0)
^^1^1^3030718^
"DATA",9002313.91,133,30,1,0)
D FLD474^BPSOSSG
"DATA",9002313.91,134,0)
475^^DUR CO-AGENT ID QUALIFIER^A/N^
"DATA",9002313.91,134,5)
J9^2
"DATA",9002313.91,134,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,134,10,1,0)
S BPS("X")=""
"DATA",9002313.91,134,25,0)
^^1^1^3030718^
"DATA",9002313.91,134,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,134,30,0)
^^1^1^3030718^
"DATA",9002313.91,134,30,1,0)
D FLD475^BPSOSSG
"DATA",9002313.91,135,0)
476^^DUR CO-AGENT ID^A/N^
"DATA",9002313.91,135,5)
H6^19
"DATA",9002313.91,135,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,135,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0)),U,7)
"DATA",9002313.91,135,25,0)
^9002313.9104^1^1^3040107^^^
"DATA",9002313.91,135,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,135,30,0)
^9002313.9103^1^1^3040107^^^
"DATA",9002313.91,135,30,1,0)
D FLD476^BPSOSSG
"DATA",9002313.91,136,0)
477^^PROFESSIONAL SERV FEE SUBMIT^D^
"DATA",9002313.91,136,5)
BE^8
"DATA",9002313.91,136,10,0)
^9002313.9101^1^1^3030823^
"DATA",9002313.91,136,10,1,0)
S BPS("X")=0
"DATA",9002313.91,136,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,136,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,136,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,136,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),470),U,7)=BPS("X")
"DATA",9002313.91,139,0)
481^^FLAT SALES TAX AMOUNT SUBMIT^D^
"DATA",9002313.91,139,5)
HA^8
"DATA",9002313.91,139,10,0)
^9002313.9101^1^1^3040907^^^
"DATA",9002313.91,139,10,1,0)
S BPS("X")=""
"DATA",9002313.91,139,25,0)
^9002313.9104^1^1^3040907^^
"DATA",9002313.91,139,25,1,0)
S BPS("X")=$$DFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,139,30,0)
^9002313.9103^1^1^3040907^^
"DATA",9002313.91,139,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,1)=BPS("X")
"DATA",9002313.91,140,0)
482^^PERCENTAGE SALES TAX AMT SUB^D^
"DATA",9002313.91,140,5)
GE^8
"DATA",9002313.91,140,10,0)
^^1^1^3050802^
"DATA",9002313.91,140,10,1,0)
S BPS("X")=0
"DATA",9002313.91,140,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,140,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,140,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,140,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,2)=BPS("X")
"DATA",9002313.91,141,0)
483^^PERCENT SALES TAX RATE SUB^D^
"DATA",9002313.91,141,5)
HE^7
"DATA",9002313.91,141,10,0)
^^1^1^3050802^
"DATA",9002313.91,141,10,1,0)
S BPS("X")=BPS("Insurer","Percent Sales Tax Rate Sub")
"DATA",9002313.91,141,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,141,25,1,0)
S BPS("X")=$$DFF^BPSECFM(BPS("X"),7)
"DATA",9002313.91,141,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,141,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,3)=BPS("X")
"DATA",9002313.91,142,0)
484^^PERCENT SALES TAX BASIS SUB^A/N^
"DATA",9002313.91,142,5)
JE^2
"DATA",9002313.91,142,10,0)
^9002313.9101^1^1^3050802^^^^
"DATA",9002313.91,142,10,1,0)
S BPS("X")=""
"DATA",9002313.91,142,25,0)
^^1^1^3030824^
"DATA",9002313.91,142,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,142,30,0)
^9002313.9103^1^1^3030824^^^
"DATA",9002313.91,142,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,4)=BPS("X")
"DATA",9002313.91,143,0)
485^^COUPON TYPE^A/N^
"DATA",9002313.91,143,5)
KE^2
"DATA",9002313.91,143,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,143,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,5)
"DATA",9002313.91,143,25,0)
^9002313.9104^1^1^3040107^^
"DATA",9002313.91,143,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,143,30,0)
^9002313.9103^1^1^3040107^^
"DATA",9002313.91,143,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,5)=BPS("X")
"DATA",9002313.91,144,0)
486^^COUPON NUMBER^A/N^
"DATA",9002313.91,144,5)
ME^15
"DATA",9002313.91,144,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,144,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,6)
"DATA",9002313.91,144,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,144,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,144,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,144,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,6)=BPS("X")
"DATA",9002313.91,145,0)
487^^COUPON VALUE AMOUNT^D^
"DATA",9002313.91,145,5)
NE^8
"DATA",9002313.91,145,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,145,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,7)
"DATA",9002313.91,145,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,145,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,145,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,145,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,7)=BPS("X")
"DATA",9002313.91,146,0)
491^^DIAGNOSIS CODE COUNT^N^
"DATA",9002313.91,146,5)
VE^1
"DATA",9002313.91,146,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,146,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),490)),U,1)
"DATA",9002313.91,146,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,146,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,147,0)
492^^DIAGNOSIS CODE QUALIFIER^A/N^
"DATA",9002313.91,147,5)
WE^2
"DATA",9002313.91,147,10,0)
^^1^1^3040224^
"DATA",9002313.91,147,10,1,0)
S BPS("X")=""
"DATA",9002313.91,147,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,147,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,148,0)
493^^CLINICAL INFORMATION COUNTER^N^
"DATA",9002313.91,148,5)
XE^1
"DATA",9002313.91,148,10,0)
^^1^1^3040224^
"DATA",9002313.91,148,10,1,0)
S BPS("X")=""
"DATA",9002313.91,148,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,148,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,149,0)
498.01^^REQUEST TYPE^N^
"DATA",9002313.91,149,5)
PA^1
"DATA",9002313.91,149,10,0)
^9002313.9101^1^1^3040428^^
"DATA",9002313.91,149,10,1,0)
S BPS("X")=""
"DATA",9002313.91,149,25,0)
^^1^1^3040428^
"DATA",9002313.91,149,25,1,0)
S BPS("X")=""
"DATA",9002313.91,150,0)
498.02^^REQUEST PERIOD DATE-BEGIN^A/N^
"DATA",9002313.91,150,5)
PB^8
"DATA",9002313.91,150,10,0)
^^1^1^3040223^
"DATA",9002313.91,150,10,1,0)
S BPS("X")=""
"DATA",9002313.91,151,0)
498.03^^REQUEST PERIOD DATE-END^A/N^
"DATA",9002313.91,151,5)
PC^8
"DATA",9002313.91,151,10,0)
^^1^1^3040223^
"DATA",9002313.91,151,10,1,0)
S BPS("X")=""
"DATA",9002313.91,152,0)
498.04^^BASIS OF REQUEST^A/N^
"DATA",9002313.91,152,5)
PD^2
"DATA",9002313.91,152,10,0)
^^1^1^3040223^
"DATA",9002313.91,152,10,1,0)
S BPS("X")=""
"DATA",9002313.91,153,0)
498.05^^AUTH REP FIRST NAME^A/N^
"DATA",9002313.91,153,5)
PE^12
"DATA",9002313.91,153,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,153,10,1,0)
S BPS("X")=""
"DATA",9002313.91,154,0)
498.06^^AUTHORIZED REP LAST NAME^A/N^
"DATA",9002313.91,154,5)
PF^15
"DATA",9002313.91,154,10,0)
^^1^1^3040223^
"DATA",9002313.91,154,10,1,0)
S BPS("X")=""
"DATA",9002313.91,155,0)
498.07^^AUTH REP STREET ADDRESS^A/N^
"DATA",9002313.91,155,5)
PG^30
"DATA",9002313.91,155,10,0)
^^1^1^3040223^
"DATA",9002313.91,155,10,1,0)
S BPS("X")=""
"DATA",9002313.91,156,0)
498.08^^AUTH REP CITY ADDRESS^A/N^
"DATA",9002313.91,156,5)
PH^20
"DATA",9002313.91,156,10,0)
^^1^1^3040223^
"DATA",9002313.91,156,10,1,0)
S BPS("X")=""
"DATA",9002313.91,157,0)
498.09^^AUTH REP STATE/PROV ADDRESS^A/N^
"DATA",9002313.91,157,5)
PJ^2
"DATA",9002313.91,157,10,0)
^^1^1^3040223^
"DATA",9002313.91,157,10,1,0)
S BPS("X")=""
"DATA",9002313.91,158,0)
498.11^^AUTH REP ZIP/POSTAL CODE^A/N^
"DATA",9002313.91,158,5)
PK^15
"DATA",9002313.91,158,10,0)
^^1^1^3040223^
"DATA",9002313.91,158,10,1,0)
S BPS("X")=""
"DATA",9002313.91,159,0)
498.12^^PRESCRIBER PHONE NUMBER^N^
"DATA",9002313.91,159,5)
PM^10
"DATA",9002313.91,159,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,159,10,1,0)
S BPS("X")=$TR($G(BPS("RX",MEDN,"Prescriber Phone #")),"#() -_*.@")
"DATA",9002313.91,159,25,0)
^9002313.9104^1^1^3030722^^
"DATA",9002313.91,159,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,159,30,0)
^9002313.9103^1^1^3030722^^
"DATA",9002313.91,159,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),498),U,12)=BPS("X")
"DATA",9002313.91,160,0)
498.13^^PRIOR AUTH SUPPORTING DOC^A/N^
"DATA",9002313.91,160,5)
PP^200
"DATA",9002313.91,160,10,0)
^^1^1^3040223^
"DATA",9002313.91,160,10,1,0)
S BPS("X")=""
"DATA",9002313.91,161,0)
498.14^^PRIOR AUTH NUMBER ASSIGN^N^
"DATA",9002313.91,161,5)
PY^8
"DATA",9002313.91,161,10,0)
^^1^1^3040223^
"DATA",9002313.91,161,10,1,0)
S BPS("X")=""
"DATA",9002313.91,162,0)
498.52^^PRIOR AUTHO EFFECT. DATE^A/N^
"DATA",9002313.91,162,5)
PS^8
"DATA",9002313.91,162,10,0)
^^1^1^3040223^
"DATA",9002313.91,162,10,1,0)
S BPS("X")=""
"DATA",9002313.91,163,0)
498.53^^PRIOR AUTHO EXP. DATE^A/N^
"DATA",9002313.91,163,5)
PT^8
"DATA",9002313.91,163,10,0)
^^1^1^3040223^
"DATA",9002313.91,163,10,1,0)
S BPS("X")=""
"DATA",9002313.91,164,0)
498.54^^PRIOR AUTH. NUM REFILLS^N^
"DATA",9002313.91,164,5)
PW^8
"DATA",9002313.91,164,10,0)
^^1^1^3040223^
"DATA",9002313.91,164,10,1,0)
S BPS("X")=""
"DATA",9002313.91,165,0)
498.55^^PRIOR AUTH QTY ACCUM^N^
"DATA",9002313.91,165,5)
PX^8
"DATA",9002313.91,165,10,0)
^^1^1^3040223^
"DATA",9002313.91,165,10,1,0)
S BPS("X")=""
"DATA",9002313.91,166,0)
498.57^^PRIOR AUTH QTY^A/N^
"DATA",9002313.91,166,5)
RA^3
"DATA",9002313.91,166,10,0)
^^1^1^3040223^
"DATA",9002313.91,166,10,1,0)
S BPS("X")=""
"DATA",9002313.91,167,0)
498.58^^PRIOR AUTH DOLLARS AUTH^N^
"DATA",9002313.91,167,5)
RB^8
"DATA",9002313.91,167,10,0)
^^1^1^3040223^
"DATA",9002313.91,167,10,1,0)
S BPS("X")=""
"DATA",9002313.91,168,0)
498.59^^AUTH REP CITY ADDRESS^A/N^
"DATA",9002313.91,168,5)
PH^20
"DATA",9002313.91,168,10,0)
^^1^1^3030512^
"DATA",9002313.91,168,10,1,0)
S BPS("X")=""
"DATA",9002313.91,169,0)
501^^HEADER RESPONSE STATUS^A/N^
"DATA",9002313.91,169,5)
AN^1
"DATA",9002313.91,169,10,0)
^9002313.9101^1^1^3040202^^^
"DATA",9002313.91,169,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),500)),U,1)
"DATA",9002313.91,169,25,0)
^9002313.9104^1^1^3040202^^^
"DATA",9002313.91,169,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,169,30,0)
^9002313.9103^1^1^3040202^^^
"DATA",9002313.91,169,30,1,0)
S $P(^BPSR(BPS(9002313.02),500),U,1)=BPS("X")
"DATA",9002313.91,170,0)
503^^AUTHORIZTION NUMBER^A/N^
"DATA",9002313.91,170,5)
F3^20
"DATA",9002313.91,170,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,170,10,1,0)
S BPS("X")=""
"DATA",9002313.91,170,30,0)
^^1^1^3031205^
"DATA",9002313.91,170,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,3)=BPS("X")
"DATA",9002313.91,171,0)
504^^MESSAGE^A/N^
"DATA",9002313.91,171,5)
F4^200
"DATA",9002313.91,171,10,0)
^^1^1^3031211^
"DATA",9002313.91,171,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),504)),U,1)
"DATA",9002313.91,171,25,0)
^^1^1^3031211^
"DATA",9002313.91,171,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,171,30,0)
^^1^1^3031211^
"DATA",9002313.91,171,30,1,0)
S $P(^BPSR(BPS(9002313.02),504),U,1)=BPS("X")
"DATA",9002313.91,172,0)
505^^PATIENT PAY AMOUNT^A/N^
"DATA",9002313.91,172,5)
F5^8
"DATA",9002313.91,172,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,172,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,5)
"DATA",9002313.91,172,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,172,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,172,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,172,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,5)=S BPS("X")
"DATA",9002313.91,173,0)
506^^INGREDIENT COST PAID^A/N^
"DATA",9002313.91,173,5)
F6^8
"DATA",9002313.91,173,10,0)
^9002313.9101^1^1^3031211^^
"DATA",9002313.91,173,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,6)
"DATA",9002313.91,173,25,0)
^9002313.9104^1^1^3031211^^
"DATA",9002313.91,173,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,173,30,0)
^9002313.9103^1^1^3031211^^
"DATA",9002313.91,173,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,6)=BPS("X")
"DATA",9002313.91,174,0)
507^^DISPENSING FEE PAID^A/N^
"DATA",9002313.91,174,5)
F7^8
"DATA",9002313.91,174,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,174,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,7)
"DATA",9002313.91,174,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,174,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,174,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,174,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,7)=BPS("X")
"DATA",9002313.91,175,0)
509^^TOTAL AMOUNT PAID^A/N^
"DATA",9002313.91,175,5)
F9^8
"DATA",9002313.91,175,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,175,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,9)
"DATA",9002313.91,175,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,175,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,175,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,175,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,9)
"DATA",9002313.91,176,0)
510^^REJECT COUNT^N^
"DATA",9002313.91,176,5)
FA^2
"DATA",9002313.91,176,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,176,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,10)
"DATA",9002313.91,176,25,0)
^^1^1^3031217^
"DATA",9002313.91,176,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,176,30,0)
^^1^1^3031217^
"DATA",9002313.91,176,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,10)=BPS("X")
"DATA",9002313.91,177,0)
511^^REJECT CODE^A/N^
"DATA",9002313.91,177,5)
FB^3
"DATA",9002313.91,177,10,0)
^9002313.9101^1^1^3031217^^^
"DATA",9002313.91,177,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0)),U,1)
"DATA",9002313.91,177,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,177,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,177,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,177,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0),U,1)
"DATA",9002313.91,178,0)
512^^ACCUM DEDUC AMT^A/N^
"DATA",9002313.91,178,5)
FC^8
"DATA",9002313.91,178,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,178,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",10)
"DATA",9002313.91,178,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,178,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,178,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,178,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",10)=BPS("X")
"DATA",9002313.91,179,0)
513^^REMAIN, DEDUC. AMT^A/N^
"DATA",9002313.91,179,5)
FD^8
"DATA",9002313.91,179,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,179,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,13)
"DATA",9002313.91,179,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,179,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,179,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,179,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,13)=BPS("X")
"DATA",9002313.91,180,0)
514^^REMAIN. BENEFIT AMT^A/N^
"DATA",9002313.91,180,5)
FE^8
"DATA",9002313.91,180,10,0)
^9002313.9101^1^1^3031217^^^
"DATA",9002313.91,180,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,14)
"DATA",9002313.91,180,25,0)
^9002313.9104^1^1^3031217^^^
"DATA",9002313.91,180,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,180,30,0)
^9002313.9103^1^1^3031217^^^
"DATA",9002313.91,180,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,14)
"DATA",9002313.91,182,0)
517^^AMT APPLIED TO PER. DEDUCT.^D^
"DATA",9002313.91,182,5)
FH^8
"DATA",9002313.91,182,10,0)
^9002313.9101^1^1^3031205^^^
"DATA",9002313.91,182,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",17)
"DATA",9002313.91,182,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,182,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,182,30,0)
^9002313.9103^1^1^3031205^^
"DATA",9002313.91,182,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",17)=BPS("X")
"DATA",9002313.91,183,0)
518^^AMT OF COPAY/CO-INS^D^
"DATA",9002313.91,183,5)
FI^8
"DATA",9002313.91,183,10,0)
^^1^1^3030512^
"DATA",9002313.91,183,10,1,0)
S BPS("X")=""
"DATA",9002313.91,183,25,0)
^^1^1^3031205^
"DATA",9002313.91,183,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,183,30,0)
^^1^1^3031205^
"DATA",9002313.91,183,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",18)=BPS("X")
"DATA",9002313.91,184,0)
519^^AMT. ATTRIB TO PRODUCT SEL.^D^
"DATA",9002313.91,184,5)
FJ^8
"DATA",9002313.91,184,10,0)
^^1^1^3030512^
"DATA",9002313.91,184,10,1,0)
S BPS("X")=""
"DATA",9002313.91,184,25,0)
^^1^1^3031205^
"DATA",9002313.91,184,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,184,30,0)
^^1^1^3031205^
"DATA",9002313.91,184,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,19)=BPS("X")
"DATA",9002313.91,185,0)
520^^AMT. EXCEEDING PER. MAX^D^
"DATA",9002313.91,185,5)
FK^8
"DATA",9002313.91,185,10,0)
^9002313.9101^1^1^3030512^
"DATA",9002313.91,185,10,1,0)
S BPS("X")=""
"DATA",9002313.91,185,25,0)
^^1^1^3031205^
"DATA",9002313.91,185,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,185,30,0)
^^1^1^3031205^
"DATA",9002313.91,185,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,20)=BPS("X")
"DATA",9002313.91,186,0)
521^^INCENTIVE AMOUNT PAID^A/N^
"DATA",9002313.91,186,5)
FL^8
"DATA",9002313.91,186,10,0)
^9002313.9101^1^1^3031210^
"DATA",9002313.91,186,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,21)
"DATA",9002313.91,186,25,0)
^^1^1^3031210^
"DATA",9002313.91,186,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,186,30,0)
^^1^1^3031210^
"DATA",9002313.91,186,30,1,0)
$P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,21)=BPS("X")
"DATA",9002313.91,187,0)
522^^BASIS OF REIM. DETERM.^N^
"DATA",9002313.91,187,5)
FM^2
"DATA",9002313.91,187,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,187,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",22)
"DATA",9002313.91,187,25,0)
^^1^1^3031205^
"DATA",9002313.91,187,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,187,30,0)
^^1^1^3031205^
"DATA",9002313.91,187,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,22)=BPS("X")
"DATA",9002313.91,188,0)
523^^AMT ATTRIV TO SALES TAX^D^
"DATA",9002313.91,188,5)
FN^8
"DATA",9002313.91,188,10,0)
^^1^1^3030512^
"DATA",9002313.91,188,10,1,0)
S BPS("X")=""
"DATA",9002313.91,188,25,0)
^^1^1^3031205^
"DATA",9002313.91,188,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,188,30,0)
^^1^1^3031205^
"DATA",9002313.91,188,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",23)=BPS("X")
"DATA",9002313.91,189,0)
524^^PLAN ID^A/N^
"DATA",9002313.91,189,5)
FO^8
"DATA",9002313.91,189,10,0)
^9002313.9101^1^1^3070103^^
"DATA",9002313.91,189,10,1,0)
S BPS("X")=$G(BPS("Patient","Plan ID"))
"DATA",9002313.91,189,25,0)
^^1^1^3061122^
"DATA",9002313.91,189,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,189,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,189,30,1,0)
S $P(^BPSC(BPS(9002313.02),520),U,4)=BPS("X")
"DATA",9002313.91,191,0)
526^^ADDITIONAL MESSAGE INFO^A/N^
"DATA",9002313.91,191,5)
FQ^200
"DATA",9002313.91,191,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,191,10,1,0)
S BPS("X")=$G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),526))
"DATA",9002313.91,191,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,191,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,191,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,191,30,1,0)
S ^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),526)=BPS("X")
"DATA",9002313.91,192,0)
528^^CLINICAL SIGNIFICANCE CODE^A/N^
"DATA",9002313.91,192,5)
FS^1
"DATA",9002313.91,192,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,192,10,1,0)
S BPS("X")=$G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),525))
"DATA",9002313.91,192,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,192,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,192,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,192,30,1,0)
S ^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),525)=$G(BPS("X"))
"DATA",9002313.91,193,0)
529^^OTHER PHARMACY INDICATOR^A/N^
"DATA",9002313.91,193,5)
FT^1
"DATA",9002313.91,193,10,0)
^^1^1^3031212^
"DATA",9002313.91,193,10,1,0)
S BPS("X")=""
"DATA",9002313.91,194,0)
530^^PREVIOUS DATE OF FILL^A/N^
"DATA",9002313.91,194,5)
FU^8
"DATA",9002313.91,194,10,0)
^^1^1^3061103^
"DATA",9002313.91,194,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,5)
"DATA",9002313.91,194,25,0)
^^1^1^3031216^
"DATA",9002313.91,194,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X"))
"DATA",9002313.91,194,30,0)
^^1^1^3031216^
"DATA",9002313.91,194,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,5)=BPS("X")
"DATA",9002313.91,195,0)
531^^QUANTITY OF PREVIOUS FILL^N^
"DATA",9002313.91,195,5)
FV^8
"DATA",9002313.91,195,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,195,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,6)
"DATA",9002313.91,195,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,195,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,195,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,195,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,6)=BPS("X")
"DATA",9002313.91,196,0)
532^^DATABASE INDICATOR^A/N^
"DATA",9002313.91,196,5)
FW^1
"DATA",9002313.91,196,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,196,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,BPS(9002313.020101),0)),U,7)
"DATA",9002313.91,196,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,196,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,196,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,196,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,BPS(9002313.020101),0),U,7)=BPS("X")
"DATA",9002313.91,197,0)
533^^OTHER PRESCRIBER INDICATOR^A/N^
"DATA",9002313.91,197,5)
FX^1
"DATA",9002313.91,197,10,0)
^^1^1^3031212^
"DATA",9002313.91,197,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,8)
"DATA",9002313.91,197,25,0)
^^1^1^3031212^
"DATA",9002313.91,197,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,197,30,0)
^^1^1^3031212^
"DATA",9002313.91,197,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,8)=BPS("X")
"DATA",9002313.91,199,0)
544^^DUR FREE TEXT MESSAGE^A/N^
"DATA",9002313.91,199,5)
FY^30
"DATA",9002313.91,199,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,199,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,9)
"DATA",9002313.91,199,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,199,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,199,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,199,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,9)=BPS("X")
"DATA",9002313.91,200,0)
545^^NETWORK REIMBURSEMENT ID^A/N^
"DATA",9002313.91,200,5)
2F^10
"DATA",9002313.91,200,10,0)
^^1^1^3040223^
"DATA",9002313.91,200,10,1,0)
S BPS("X")=""
"DATA",9002313.91,201,0)
546^^REJ FIELD OCCUR. INDICATOR^A/N^
"DATA",9002313.91,201,5)
4F^2
"DATA",9002313.91,201,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,201,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0)),U,2)
"DATA",9002313.91,201,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,201,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,201,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,201,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0),U,2)=BPS("X")
"DATA",9002313.91,202,0)
547^^APPROVED MESSAGE CODE COUNT^A/N^
"DATA",9002313.91,202,5)
5F^1
"DATA",9002313.91,202,10,0)
^^1^1^3030512^
"DATA",9002313.91,202,10,1,0)
S BPS("X")=""
"DATA",9002313.91,202,25,0)
^^1^1^3031205^
"DATA",9002313.91,202,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,202,30,0)
^^1^1^3031205^
"DATA",9002313.91,202,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,7)=BPS("X")
"DATA",9002313.91,203,0)
548^^APPROVED MESSAGE CODE^A/N^
"DATA",9002313.91,203,5)
6F^3
"DATA",9002313.91,203,10,0)
^^1^1^3030512^
"DATA",9002313.91,203,10,1,0)
S BPS("X")=""
"DATA",9002313.91,203,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,203,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,203,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,203,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),548,0),B,4)=BPS("X")
"DATA",9002313.91,204,0)
549^^HELP DESK PHONE NUMBER QUAL^A/N^
"DATA",9002313.91,204,5)
7F^2
"DATA",9002313.91,204,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,204,10,1,0)
S BPS("X")=$TR($P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540)),U,9),"#() -_*.@")
"DATA",9002313.91,204,25,0)
^^1^1^3031210^
"DATA",9002313.91,204,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,204,30,0)
^^1^1^3031210^
"DATA",9002313.91,204,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,9)=BPS("X")
"DATA",9002313.91,205,0)
550^^HELP DESK PHONE NUMBER^A/N^
"DATA",9002313.91,205,5)
8F^18
"DATA",9002313.91,205,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,205,10,1,0)
S BPS("X")=$TR($P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540)),U,10),"#() -_*.@")
"DATA",9002313.91,205,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,205,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,205,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,205,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,10)=BPS("X")
"DATA",9002313.91,206,0)
551^^PREFERRED PRODUCT COUNT^A/N^
"DATA",9002313.91,206,5)
9F^1
"DATA",9002313.91,206,10,0)
^9002313.9101^1^1^3031216^
"DATA",9002313.91,206,10,1,0)
S BPS("X")=""
"DATA",9002313.91,207,0)
552^^PREFERRED PRODUCT ID QUALIFIER^A/N^
"DATA",9002313.91,207,5)
AP^2
"DATA",9002313.91,207,10,0)
^^1^1^3031216^
"DATA",9002313.91,207,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,1)
"DATA",9002313.91,207,25,0)
^^1^1^3031216^
"DATA",9002313.91,207,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,207,30,0)
^^1^1^3031216^
"DATA",9002313.91,207,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,1)=BPS("X")
"DATA",9002313.91,208,0)
553^^PREFERRED PRODUCT ID^A/N^
"DATA",9002313.91,208,5)
AR^19
"DATA",9002313.91,208,10,0)
^^1^1^3031216^
"DATA",9002313.91,208,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,2)
"DATA",9002313.91,208,25,0)
^^1^1^3031216^
"DATA",9002313.91,208,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,208,30,0)
^^1^1^3031216^
"DATA",9002313.91,208,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,2)=BPS("X")
"DATA",9002313.91,209,0)
554^^PREFERRED PRODUCT INCENTIVE^A/N^
"DATA",9002313.91,209,5)
AS^8
"DATA",9002313.91,209,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,209,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,3)
"DATA",9002313.91,209,25,0)
^^1^1^3031216^
"DATA",9002313.91,209,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,209,30,0)
^^1^1^3031216^
"DATA",9002313.91,209,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,3)=BPS("X")
"DATA",9002313.91,210,0)
555^^PREF. PRODUCT COPAY INCENTIVE^A/N^
"DATA",9002313.91,210,5)
AT^8
"DATA",9002313.91,210,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,210,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,4)
"DATA",9002313.91,210,25,0)
^9002313.9104^1^1^3031216^^
"DATA",9002313.91,210,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,210,30,0)
^9002313.9103^1^1^3031216^^
"DATA",9002313.91,210,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,4)=BPS("X")
"DATA",9002313.91,211,0)
556^^PREFERRED PRODUCT DESCRIPTION^A/N^
"DATA",9002313.91,211,5)
AU^40
"DATA",9002313.91,211,10,0)
^^1^1^3031216^
"DATA",9002313.91,211,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,5)
"DATA",9002313.91,211,25,0)
^^1^1^3031216^
"DATA",9002313.91,211,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),40)
"DATA",9002313.91,211,30,0)
^^1^1^3031216^
"DATA",9002313.91,211,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,5)=BPS("X")
"DATA",9002313.91,212,0)
557^^TAX EXEMPT INDICATOR^A/N^
"DATA",9002313.91,212,5)
AV^1
"DATA",9002313.91,212,10,0)
^^1^1^3031217^
"DATA",9002313.91,212,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,7)
"DATA",9002313.91,212,25,0)
^^1^1^3031217^
"DATA",9002313.91,212,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,212,30,0)
^^1^1^3031217^
"DATA",9002313.91,212,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,7)
"DATA",9002313.91,213,0)
558^^FLAT SALES TAX AMOUNT PAID^A/N^
"DATA",9002313.91,213,5)
AW^8
"DATA",9002313.91,213,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,213,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,8)
"DATA",9002313.91,213,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,213,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,213,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,213,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,8)=BPS("X")
"DATA",9002313.91,214,0)
559^^PERCENTAGE SALES TAX AMT^A/N^
"DATA",9002313.91,214,5)
AX^8
"DATA",9002313.91,214,10,0)
^9002313.9101^1^1^3031212^^^
"DATA",9002313.91,214,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,9)
"DATA",9002313.91,214,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,214,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,214,30,0)
^9002313.9103^1^1^3031212^^^
"DATA",9002313.91,214,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,9)=BPS("X")
"DATA",9002313.91,215,0)
560^^PERCENTAGE SALES TAX RATE^A/N^
"DATA",9002313.91,215,5)
AY^8
"DATA",9002313.91,215,10,0)
^^1^1^3040223^
"DATA",9002313.91,215,10,1,0)
S BPS("X")=""
"DATA",9002313.91,216,0)
561^^PERCENTAGE SALES TAX BASIS^A/N^
"DATA",9002313.91,216,5)
AZ^8
"DATA",9002313.91,216,10,0)
^^1^1^3031212^
"DATA",9002313.91,216,10,1,0)
S BPS("X")=""
"DATA",9002313.91,217,0)
562^^PROFESSIONAL SERVICE FEE PAID^A/N^
"DATA",9002313.91,217,5)
J1^8
"DATA",9002313.91,217,10,0)
^^1^1^3031217^
"DATA",9002313.91,217,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560)),U,2)
"DATA",9002313.91,217,25,0)
^^1^1^3031217^
"DATA",9002313.91,217,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,217,30,0)
^^1^1^3031217^
"DATA",9002313.91,217,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560),U,2)=BPS("X")
"DATA",9002313.91,218,0)
563^^OTHER AMOUNT PAID COUNT^N^
"DATA",9002313.91,218,5)
J2^1
"DATA",9002313.91,218,10,0)
^^1^1^3031212^
"DATA",9002313.91,218,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,0)),U,1)
"DATA",9002313.91,218,25,0)
^^1^1^3031212^
"DATA",9002313.91,218,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,218,30,0)
^^1^1^3031212^
"DATA",9002313.91,218,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,0)),U,1)
"DATA",9002313.91,219,0)
564^^OTHER AMOUNT PAID QUALIFIER^A/N^
"DATA",9002313.91,219,5)
J3^2
"DATA",9002313.91,219,10,0)
^^1^1^3031212^
"DATA",9002313.91,219,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1)),U,1)
"DATA",9002313.91,219,25,0)
^^1^1^3031212^
"DATA",9002313.91,219,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,219,30,0)
^^1^1^3031212^
"DATA",9002313.91,219,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1),U,1)=BPS("X")
"DATA",9002313.91,220,0)
565^^OTHER AMOUNT PAID^A/N^
"DATA",9002313.91,220,5)
J4^8
"DATA",9002313.91,220,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,220,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1)),U,2)
"DATA",9002313.91,220,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,220,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,220,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,220,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1),U,2)=BPS("X")
"DATA",9002313.91,221,0)
566^^OTHER PAYER AMOUNT RECOGNIZED^A/N^
"DATA",9002313.91,221,5)
J5^8
"DATA",9002313.91,221,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,221,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560)),U,6)
"DATA",9002313.91,221,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,221,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,221,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,221,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560),U,6)=BPS("X")
"DATA",9002313.91,222,0)
567^^DUR/PPS RESPONSE CODE COUNTER^N^
"DATA",9002313.91,222,5)
J6^1
"DATA",9002313.91,222,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,222,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,1)
"DATA",9002313.91,222,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,222,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,222,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,222,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,1)=BPS("X")
"DATA",9002313.91,223,0)
568^^PAYER ID QUALIFIER^A/N^
"DATA",9002313.91,223,5)
J7^2
"DATA",9002313.91,223,10,0)
^^1^1^3031212^
"DATA",9002313.91,223,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),560)),U,8)
"DATA",9002313.91,223,25,0)
^^1^1^3031212^
"DATA",9002313.91,223,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,223,30,0)
^^1^1^3031212^
"DATA",9002313.91,223,30,1,0)
S $P(^BPSR(BPS(9002313.02),560),U,8)
"DATA",9002313.91,224,0)
569^^PAYER ID^A/N^
"DATA",9002313.91,224,5)
J8^10
"DATA",9002313.91,224,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,224,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),560)),U,9)
"DATA",9002313.91,224,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,224,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,224,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,224,30,1,0)
S $P(^BPSR(BPS(9002313.02),560),U,9)=BPS("X")
"DATA",9002313.91,225,0)
600^^Unit of Measure^A/N^
"DATA",9002313.91,225,5)
28^2
"DATA",9002313.91,225,10,0)
^^1^1^3070625^
"DATA",9002313.91,225,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Unit of Measure"))
"DATA",9002313.91,225,25,0)
^^1^1^3070620^
"DATA",9002313.91,225,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,225,30,0)
^^1^1^3070620^
"DATA",9002313.91,225,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),600),U,1)=""
"DATA",9002313.91,240,0)
478^^OTHER AMT CLAIMED SUB COUNT^N^
"DATA",9002313.91,240,5)
H7^1
"DATA",9002313.91,240,10,0)
^9002313.9101^1^1^3040107^^^
"DATA",9002313.91,240,10,1,0)
S BPS("X")=""
"DATA",9002313.91,241,0)
479^^Other Amt Claimed Sub Qual^A/N^
"DATA",9002313.91,241,5)
H8^2
"DATA",9002313.91,241,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,241,10,1,0)
S BPS("X")=""
"DATA",9002313.91,242,0)
463^^INTERMED AUTH TYPE ID^N^
"DATA",9002313.91,242,5)
EW^2
"DATA",9002313.91,242,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,242,10,1,0)
S BPS("X")=0
"DATA",9002313.91,242,25,0)
^9002313.9104^1^1^3030823^^^^
"DATA",9002313.91,242,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,242,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,242,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,3)=BPS("X")
"DATA",9002313.91,265,0)
451^^Compound Dispense Unt Form Ind^N^
"DATA",9002313.91,265,5)
EG^1
"DATA",9002313.91,265,10,0)
^^1^1^3040224^
"DATA",9002313.91,265,10,1,0)
S BPS("X")=""
"DATA",9002313.91,265,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,265,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,266,0)
450^^Compound Dose Form Desc Code^A/N^
"DATA",9002313.91,266,5)
EF^2
"DATA",9002313.91,266,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,266,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440)),U,10)
"DATA",9002313.91,266,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,266,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,266,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,266,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,10)=BPS("X")
"DATA",9002313.91,267,0)
490^^Comp Ingred Basis Cost Determ^A/N^
"DATA",9002313.91,267,5)
UE^2
"DATA",9002313.91,267,10,0)
^^1^1^3040224^
"DATA",9002313.91,267,10,1,0)
S BPS("X")=""
"DATA",9002313.91,267,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,267,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,268,0)
447^^Compound Ingred Comp Count^N^
"DATA",9002313.91,268,5)
EC^2
"DATA",9002313.91,268,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,268,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440)),U,7)
"DATA",9002313.91,268,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,268,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,268,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,268,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,7)=BPS("X")
"DATA",9002313.91,269,0)
449^^Compound Ingredient Drug Cost^N^
"DATA",9002313.91,269,5)
EE^8
"DATA",9002313.91,269,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,269,10,1,0)
S BPS("X")=""
"DATA",9002313.91,269,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,269,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,271,0)
489^^Compound Product ID^A/N^
"DATA",9002313.91,271,5)
TE^19
"DATA",9002313.91,271,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,271,10,1,0)
S BPS("X")=""
"DATA",9002313.91,271,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,271,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,272,0)
488^^Compound Product ID Qualifier^A/N^
"DATA",9002313.91,272,5)
RE^2
"DATA",9002313.91,272,10,0)
^^1^1^3040224^
"DATA",9002313.91,272,10,1,0)
S BPS("X")=""
"DATA",9002313.91,272,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,272,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,273,0)
452^^Compound Route of Admin^N^
"DATA",9002313.91,273,5)
EH^2
"DATA",9002313.91,273,10,0)
^^1^1^3040224^
"DATA",9002313.91,273,10,1,0)
S BPS("X")=""
"DATA",9002313.91,273,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,273,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,308,0)
448^^Compound Ingredient Quantity^N^
"DATA",9002313.91,308,5)
ED^10
"DATA",9002313.91,308,10,0)
^^1^1^3040224^
"DATA",9002313.91,308,10,1,0)
S BPS("X")=""
"DATA",9002313.91,308,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,308,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,324,0)
494^^Measurement Date^A/N^
"DATA",9002313.91,324,5)
ZE^8
"DATA",9002313.91,324,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,324,10,1,0)
S BPS("X")=""
"DATA",9002313.91,324,25,0)
^^1^1^3040224^
"DATA",9002313.91,324,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,325,0)
496^^Measurement Dimension^A/N^
"DATA",9002313.91,325,5)
H2^2
"DATA",9002313.91,325,10,0)
^^1^1^3040224^
"DATA",9002313.91,325,10,1,0)
S BPS("X")=""
"DATA",9002313.91,325,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,325,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,326,0)
495^^Measurement Time^N^
"DATA",9002313.91,326,5)
H1^4
"DATA",9002313.91,326,10,0)
^^1^1^3040224^
"DATA",9002313.91,326,10,1,0)
S BPS("X")=""
"DATA",9002313.91,326,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,326,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),4)
"DATA",9002313.91,327,0)
497^^Measurement Unit^A/N^
"DATA",9002313.91,327,5)
H3^2
"DATA",9002313.91,327,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,327,10,1,0)
S BPS("X")=""
"DATA",9002313.91,327,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,327,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,328,0)
499^^Measurement Value^A/N^
"DATA",9002313.91,328,5)
H4^15
"DATA",9002313.91,328,10,0)
^^1^1^3040224^
"DATA",9002313.91,328,10,1,0)
S BPS("X")=""
"DATA",9002313.91,328,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,328,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"FIA",9002313.02)
BPS CLAIMS
"FIA",9002313.02,0)
^BPSC(
"FIA",9002313.02,0,0)
9002313.02
"FIA",9002313.02,0,1)
y^y^f^^^^n
"FIA",9002313.02,0,10)

"FIA",9002313.02,0,11)

"FIA",9002313.02,0,"RLRO")

"FIA",9002313.02,0,"VR")
1.0^BPS
"FIA",9002313.02,9002313.02)
0
"FIA",9002313.02,9002313.0201)
0
"FIA",9002313.02,9002313.0401)
0
"FIA",9002313.02,9002313.0501)
0
"FIA",9002313.02,9002313.0601)
0
"FIA",9002313.02,9002313.0701)
0
"FIA",9002313.02,9002313.0801)
0
"FIA",9002313.02,9002313.0901)
0
"FIA",9002313.02,9002313.1001)
0
"FIA",9002313.02,9002313.201459)
0
"FIA",9002313.02,9002313.29999)
0
"FIA",9002313.02,9002313.401342)
0
"FIA",9002313.02,9002313.401472)
0
"FIA",9002313.12)
BPS LOG
"FIA",9002313.12,0)
^BPS(9002313.12,
"FIA",9002313.12,0,0)
9002313.12
"FIA",9002313.12,0,1)
y^y^f^^^^n
"FIA",9002313.12,0,10)

"FIA",9002313.12,0,11)

"FIA",9002313.12,0,"RLRO")

"FIA",9002313.12,0,"VR")
1.0^BPS
"FIA",9002313.12,9002313.12)
0
"FIA",9002313.12,9002313.1201)
0
"FIA",9002313.31)
BPS CERTIFICATION
"FIA",9002313.31,0)
^BPS(9002313.31,
"FIA",9002313.31,0,0)
9002313.31
"FIA",9002313.31,0,1)
y^y^f^^^^n
"FIA",9002313.31,0,10)

"FIA",9002313.31,0,11)

"FIA",9002313.31,0,"RLRO")

"FIA",9002313.31,0,"VR")
1.0^BPS
"FIA",9002313.31,9002313.31)
0
"FIA",9002313.31,9002313.311)
0
"FIA",9002313.31,9002313.312)
0
"FIA",9002313.31,9002313.3121)
0
"FIA",9002313.31,9002313.31902)
0
"FIA",9002313.56)
BPS PHARMACIES
"FIA",9002313.56,0)
^BPS(9002313.56,
"FIA",9002313.56,0,0)
9002313.56
"FIA",9002313.56,0,1)
y^y^f^^^^n
"FIA",9002313.56,0,10)

"FIA",9002313.56,0,11)

"FIA",9002313.56,0,"RLRO")

"FIA",9002313.56,0,"VR")
1.0^BPS
"FIA",9002313.56,9002313.56)
0
"FIA",9002313.56,9002313.5601)
0
"FIA",9002313.57)
BPS LOG OF TRANSACTIONS
"FIA",9002313.57,0)
^BPSTL(
"FIA",9002313.57,0,0)
9002313.57
"FIA",9002313.57,0,1)
y^y^f^^^^n^^n
"FIA",9002313.57,0,10)

"FIA",9002313.57,0,11)

"FIA",9002313.57,0,"RLRO")

"FIA",9002313.57,0,"VR")
1.0^BPS
"FIA",9002313.57,9002313.57)
0
"FIA",9002313.57,9002313.57111)
0
"FIA",9002313.57,9002313.5713)
0
"FIA",9002313.57,9002313.57902)
0
"FIA",9002313.58)
BPS STATISTICS
"FIA",9002313.58,0)
^BPSECX("S",
"FIA",9002313.58,0,0)
9002313.58
"FIA",9002313.58,0,1)
y^y^f^^^^n^^n
"FIA",9002313.58,0,10)

"FIA",9002313.58,0,11)

"FIA",9002313.58,0,"RLRO")

"FIA",9002313.58,0,"VR")
1.0^BPS
"FIA",9002313.58,9002313.58)
0
"FIA",9002313.59)
BPS TRANSACTION
"FIA",9002313.59,0)
^BPST(
"FIA",9002313.59,0,0)
9002313.59O
"FIA",9002313.59,0,1)
y^y^f^^^^n^^n
"FIA",9002313.59,0,10)

"FIA",9002313.59,0,11)

"FIA",9002313.59,0,"RLRO")

"FIA",9002313.59,0,"VR")
1.0^BPS
"FIA",9002313.59,9002313.59)
0
"FIA",9002313.59,9002313.59111)
0
"FIA",9002313.59,9002313.5913)
0
"FIA",9002313.59,9002313.59902)
0
"FIA",9002313.8242)
BPS NCPDP FIELD 420
"FIA",9002313.8242,0)
^BPSF(9002313.8242,
"FIA",9002313.8242,0,0)
9002313.8242I
"FIA",9002313.8242,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.8242,0,10)

"FIA",9002313.8242,0,11)

"FIA",9002313.8242,0,"RLRO")

"FIA",9002313.8242,0,"VR")
1.0^BPS
"FIA",9002313.8242,9002313.8242)
0
"FIA",9002313.82461)
BPS NCPDP FIELD 461
"FIA",9002313.82461,0)
^BPSF(9002313.82461,
"FIA",9002313.82461,0,0)
9002313.82461I
"FIA",9002313.82461,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.82461,0,10)

"FIA",9002313.82461,0,11)

"FIA",9002313.82461,0,"RLRO")

"FIA",9002313.82461,0,"VR")
1.0^BPS
"FIA",9002313.82461,9002313.82461)
0
"FIA",9002313.91)
BPS NCPDP FIELD DEFS
"FIA",9002313.91,0)
^BPSF(9002313.91,
"FIA",9002313.91,0,0)
9002313.91I
"FIA",9002313.91,0,1)
y^y^f^^n^^y^r^n
"FIA",9002313.91,0,10)

"FIA",9002313.91,0,11)

"FIA",9002313.91,0,"RLRO")

"FIA",9002313.91,0,"VR")
1.0^BPS
"FIA",9002313.91,9002313.91)
0
"FIA",9002313.91,9002313.9101)
0
"FIA",9002313.91,9002313.9103)
0
"FIA",9002313.91,9002313.9104)
0
"FIA",9002313.99)
BPS SETUP
"FIA",9002313.99,0)
^BPS(9002313.99,
"FIA",9002313.99,0,0)
9002313.99
"FIA",9002313.99,0,1)
y^y^f^^^^n
"FIA",9002313.99,0,10)

"FIA",9002313.99,0,11)

"FIA",9002313.99,0,"RLRO")

"FIA",9002313.99,0,"VR")
1.0^BPS
"FIA",9002313.99,9002313.99)
0
"INIT")
EN^BPS01P5
"KRN",.4,5185,-1)
1^1
"KRN",.4,5185,0)
BPS GRACE    FILE #9002313.4
"KRN",.4,5186,-1)
1^2
"KRN",.4,5186,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94
"KRN",.4,5187,-1)
1^3
"KRN",.4,5187,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99
"KRN",.4,5188,-1)
1^4
"KRN",.4,5188,0)
BPS INSURERS    FILE #9002313.4
"KRN",.4,5189,-1)
1^5
"KRN",.4,5189,0)
BPS NCPDP    FILE #9002313.4
"KRN",.4,5190,-1)
1^6
"KRN",.4,5190,0)
BPS PREBILL    FILE #9002313.4
"KRN",.4,5191,-1)
1^7
"KRN",.4,5191,0)
BPS PRICING TABLES    FILE #9002313.53
"KRN",.4,5192,-1)
1^8
"KRN",.4,5192,0)
BPS UN/BILLABLE    FILE #9002313.4
"KRN",.4,5193,-1)
1^9
"KRN",.4,5193,0)
BPS USER PREFERENCES    FILE #9002313.515
"KRN",.4,5194,-1)
1^10
"KRN",.4,5194,0)
BPS WORKERS COMP    FILE #9002313.4
"KRN",.401,449515,-1)
1^1
"KRN",.401,449515,0)
BPS GRACE    FILE #9002313.4
"KRN",.401,449516,-1)
1^2
"KRN",.401,449516,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94
"KRN",.401,449517,-1)
1^3
"KRN",.401,449517,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99
"KRN",.401,449518,-1)
1^4
"KRN",.401,449518,0)
BPS INSURERS    FILE #9002313.4
"KRN",.401,449519,-1)
1^5
"KRN",.401,449519,0)
BPS NCPDP    FILE #9002313.4
"KRN",.401,449520,-1)
1^6
"KRN",.401,449520,0)
BPS PREBILL    FILE #9002313.4
"KRN",.401,449521,-1)
1^7
"KRN",.401,449521,0)
BPS PRICING TABLES    FILE #9002313.53
"KRN",.401,449522,-1)
1^8
"KRN",.401,449522,0)
BPS UN/BILLABLE    FILE #9002313.4
"KRN",.401,449523,-1)
1^9
"KRN",.401,449523,0)
BPS USER PREFERENCES    FILE #9002313.515
"KRN",.401,449524,-1)
1^10
"KRN",.401,449524,0)
BPS WORKERS COMP    FILE #9002313.4
"KRN",.403,131,-1)
1^1
"KRN",.403,131,0)
BPS BPSOSPW    FILE #9002313.99
"KRN",.403,132,-1)
1^2
"KRN",.403,132,0)
BPS EOB TO BATCH    FILE #9002313.99
"KRN",.403,133,-1)
1^3
"KRN",.403,133,0)
BPS INPUT 1    FILE #9002313.51
"KRN",19,2919759,-1)
4^11
"KRN",19,2919759,0)
BPS SETUP MENU
"KRN",19,2919760,-1)
0^2
"KRN",19,2919760,0)
BPS MANAGER MENU^Pharmacy ECME Manager Menu^^M^^BPS MANAGER^^^^^^^^^^^1
"KRN",19,2919760,1,0)
^^3^3^3060606^
"KRN",19,2919760,1,1,0)
BPS submenu which contains a link to the ECME Transaction 
"KRN",19,2919760,1,2,0)
Maintenance menu, a link to the Pharmacy ECME Setup menu, and the BPS
"KRN",19,2919760,1,3,0)
Statistics Screen.
"KRN",19,2919760,10,0)
^19.01IP^10^10
"KRN",19,2919760,10,8,0)
2919759^SET^20
"KRN",19,2919760,10,8,"^")
BPS SETUP MENU
"KRN",19,2919760,10,9,0)
2920210^MNT^10
"KRN",19,2919760,10,9,"^")
BPS MENU MAINTENANCE
"KRN",19,2919760,10,10,0)
2920215^STAT^30
"KRN",19,2919760,10,10,"^")
BPS STATISTICS SCREEN
"KRN",19,2919760,20)

"KRN",19,2919760,26)
D HDR^BPSMHDR
"KRN",19,2919760,99)
60855,39463
"KRN",19,2919760,99.1)
60855,39477
"KRN",19,2919760,"U")
PHARMACY ECME MANAGER MENU
"KRN",19,2919761,-1)
0^9
"KRN",19,2919761,0)
BPSMENU^ECME^^M^^BPSMENU^^^^^^E CLAIMS MGMT ENGINE^^^^^1
"KRN",19,2919761,1,0)
^19.06^1^1^3070327^^
"KRN",19,2919761,1,1,0)
The main BPS menu which provides access to all of the ECME options. 
"KRN",19,2919761,10,0)
^19.01IP^4^4
"KRN",19,2919761,10,2,0)
2919760^MGR^2
"KRN",19,2919761,10,2,"^")
BPS MANAGER MENU
"KRN",19,2919761,10,3,0)
2919769^U^1
"KRN",19,2919761,10,3,"^")
BPS USER SCREEN
"KRN",19,2919761,10,4,0)
2919771^RPT^4
"KRN",19,2919761,10,4,"^")
BPS MENU RPT MAIN
"KRN",19,2919761,20)

"KRN",19,2919761,26)
D HDR^BPSMHDR
"KRN",19,2919761,99)
60855,39463
"KRN",19,2919761,99.1)
60855,39477
"KRN",19,2919761,"U")
ECME
"KRN",19,2919769,-1)
0^8
"KRN",19,2919769,0)
BPS USER SCREEN^ECME User Screen^^R^^BPS USER^^^^^^^^^
"KRN",19,2919769,1,0)
^^4^4^3060602^
"KRN",19,2919769,1,1,0)
The User Screen was designed to provide the user with a set of operations 
"KRN",19,2919769,1,2,0)
to manipulate claims:  Reverse, resubmit, close, etc. The Further Research
"KRN",19,2919769,1,3,0)
submenu also provides shortcuts to preexisting IB and Pharmacy menu
"KRN",19,2919769,1,4,0)
options that are commonly used by OPECC personal.
"KRN",19,2919769,15)

"KRN",19,2919769,20)

"KRN",19,2919769,25)
EN^BPSSCR
"KRN",19,2919769,99.1)
58154,30494
"KRN",19,2919769,"U")
ECME USER SCREEN
"KRN",19,2919771,-1)
4^10
"KRN",19,2919771,0)
BPS MENU RPT MAIN
"KRN",19,2919816,-1)
2^14
"KRN",19,2919816,0)
BPS MENU RPT CLAIM STATUS^Claim Results and Status^^M^520651049^BPS REPORTS^^^^^^^^^^^1
"KRN",19,2919816,10,0)
^19.01IP^31^31
"KRN",19,2919816,10,30,0)
2920209^ECMP^3
"KRN",19,2919816,10,30,"^")
BPS RPT CMOP/ECME ACTIVITY
"KRN",19,2919816,"U")
CLAIM RESULTS AND STATUS
"KRN",19,2919827,-1)
0^15
"KRN",19,2919827,0)
BPS MENU RPT OTHER^Other Reports^^M^^BPS REPORTS^^^^^^^^^^^1
"KRN",19,2919827,1,0)
^19.06^4^4^3070213^^^^
"KRN",19,2919827,1,1,0)
This menu contains any ECME reports which do not directly relate to 
"KRN",19,2919827,1,2,0)
claims. Currently included in this menu are the Payer Sheet Detail 
"KRN",19,2919827,1,3,0)
Report, the ECME Setup - Pharmacies Report, and the Turn-around Time 
"KRN",19,2919827,1,4,0)
Statistics Report.
"KRN",19,2919827,10,0)
^19.01IP^7^7
"KRN",19,2919827,10,4,0)
2920214^PAY^2
"KRN",19,2919827,10,4,"^")
BPS RPT PAYER SHEET DETAIL
"KRN",19,2919827,10,5,0)
2920216^PHAR^5
"KRN",19,2919827,10,5,"^")
BPS RPT SETUP PHARMACIES
"KRN",19,2919827,10,6,0)
2920217^TAT^91
"KRN",19,2919827,10,6,"^")
BPS RPT TURNAROUND STATS
"KRN",19,2919827,10,7,0)
2920292^CRI^1
"KRN",19,2919827,10,7,"^")
BPS RPT CLAIMS RESPONSE
"KRN",19,2919827,26)
D HDR^BPSMHDR
"KRN",19,2919827,99)
60855,39463
"KRN",19,2919827,"U")
OTHER REPORTS
"KRN",19,2920209,-1)
0^13
"KRN",19,2920209,0)
BPS RPT CMOP/ECME ACTIVITY^CMOP/ECME Activity Report^^R^^BPS REPORTS^^^^^^
"KRN",19,2920209,1,0)
^^3^3^3060602^
"KRN",19,2920209,1,1,0)
This report is necessary for monitoring CMOP activity during both the 
"KRN",19,2920209,1,2,0)
Controlled Substances and General CMOP Transmissions. This report shall 
"KRN",19,2920209,1,3,0)
contain reference information from File 550.2, CMOP Transmissions.
"KRN",19,2920209,25)
PSXBPSRP
"KRN",19,2920209,62)
0
"KRN",19,2920209,"U")
CMOP/ECME ACTIVITY REPORT
"KRN",19,2920210,-1)
0^12
"KRN",19,2920210,0)
BPS MENU MAINTENANCE^ECME transaction maintenance options^^M^^BPS MANAGER^^^^^^^^^^^1
"KRN",19,2920210,1,0)
^^2^2^3060608^
"KRN",19,2920210,1,1,0)
This ECME maintenance menu contains the BPS Unstrand Screen and the 
"KRN",19,2920210,1,2,0)
Re-Open Closed Claim options.
"KRN",19,2920210,10,0)
^19.01IP^2^2
"KRN",19,2920210,10,1,0)
2920213^UNS^1
"KRN",19,2920210,10,1,"^")
BPS UNSTRAND SCREEN
"KRN",19,2920210,10,2,0)
2920227^ROC^2
"KRN",19,2920210,10,2,"^")
BPS REOPEN CLOSED CLAIM
"KRN",19,2920210,26)
D HDR^BPSMHDR
"KRN",19,2920210,99)
60855,39463
"KRN",19,2920210,"U")
ECME TRANSACTION MAINTENANCE O
"KRN",19,2920211,-1)
0^19
"KRN",19,2920211,0)
BPS NIGHTLY BACKGROUND JOB^BPS NIGHTLY BACKGROUND JOB^^R^^^^^^^^
"KRN",19,2920211,1,0)
^^6^6^3060602^
"KRN",19,2920211,1,1,0)
This option is not to be placed on any menu nor run by any user.  It has
"KRN",19,2920211,1,2,0)
specifically been designed to be scheduled in TaskMan to be executed
"KRN",19,2920211,1,3,0)
once a day during off-peak hours. It is recommended that this option be
"KRN",19,2920211,1,4,0)
scheduled to run at night after midnight. Running this option more than
"KRN",19,2920211,1,5,0)
once a day may cause unexpected results.  This option is the BPS nightly
"KRN",19,2920211,1,6,0)
task that performs ECME-related nightly procedures.
"KRN",19,2920211,25)
EN^BPSBCKJ
"KRN",19,2920211,200.9)
y
"KRN",19,2920211,"U")
BPS NIGHTLY BACKGROUND JOB
"KRN",19,2920213,-1)
0^7
"KRN",19,2920213,0)
BPS UNSTRAND SCREEN^View/Unstrand Claims Not Completed^^R^^BPS MANAGER^^^^^^^^^
"KRN",19,2920213,1,0)
^^4^4^3060602^
"KRN",19,2920213,1,1,0)
List Manager screen which permits users to see claims that have not
"KRN",19,2920213,1,2,0)
completed and have been in progress for one half hour or more. Users
"KRN",19,2920213,1,3,0)
can then unstrand these claims so that they can be processed via the
"KRN",19,2920213,1,4,0)
ECME user screen (i.e., reversed, resubmitted).
"KRN",19,2920213,15)

"KRN",19,2920213,25)
EN^BPSUSCR
"KRN",19,2920213,99.1)
58154,30494
"KRN",19,2920213,"U")
VIEW/UNSTRAND CLAIMS NOT COMPL
"KRN",19,2920214,-1)
4^17
"KRN",19,2920214,0)
BPS RPT PAYER SHEET DETAIL
"KRN",19,2920215,-1)
0^6
"KRN",19,2920215,0)
BPS STATISTICS SCREEN^Statistics Screen^^R^^BPS MANAGER^^^^^^^^^
"KRN",19,2920215,1,0)
^^4^4^3060602^
"KRN",19,2920215,1,1,0)
List Manager screen that shows claims that are in progress and
"KRN",19,2920215,1,2,0)
completed.  The in progress claims are broken out by the progress states
"KRN",19,2920215,1,3,0)
(i.e., Waiting for Packet Build, Transmitted).  The completed claims are
"KRN",19,2920215,1,4,0)
broken out by payer results (i.e., Paid, Rejected, Duplicate).
"KRN",19,2920215,15)

"KRN",19,2920215,20)

"KRN",19,2920215,25)
EN^BPSOS2
"KRN",19,2920215,"U")
STATISTICS SCREEN
"KRN",19,2920216,-1)
0^3
"KRN",19,2920216,0)
BPS RPT SETUP PHARMACIES^ECME Setup - Pharmacies Report^^P^^BPS REPORTS^^^^^^^^^1
"KRN",19,2920216,1,0)
^^3^3^3060602^
"KRN",19,2920216,1,1,0)
This report shows BPS Pharmacy information entered via the Register with
"KRN",19,2920216,1,2,0)
Austin Automation Center and Edit ECME Pharmacy Data options.  All BPS
"KRN",19,2920216,1,3,0)
Pharmacies are displayed.
"KRN",19,2920216,15)
D PRESSANY^BPSOSU5()
"KRN",19,2920216,30)

"KRN",19,2920216,60)
BPS(9002313.56,
"KRN",19,2920216,62)
0
"KRN",19,2920216,63)
[CAPTIONED]
"KRN",19,2920216,64)
[BPS SETUP PHARMACIES]
"KRN",19,2920216,"U")
ECME SETUP - PHARMACIES REPORT
"KRN",19,2920217,-1)
0^4
"KRN",19,2920217,0)
BPS RPT TURNAROUND STATS^Turn-around time statistics^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2920217,1,0)
^^4^4^3060602^
"KRN",19,2920217,1,1,0)
After the user selects a transaction date range, this report shows the 
"KRN",19,2920217,1,2,0)
length of time for claims to complete, including breakouts for various 
"KRN",19,2920217,1,3,0)
steps of claims creation.  The end of the report has the average time for 
"KRN",19,2920217,1,4,0)
the claims displayed.
"KRN",19,2920217,15)

"KRN",19,2920217,25)
BPSRDT1
"KRN",19,2920217,"U")
TURN-AROUND TIME STATISTICS
"KRN",19,2920219,-1)
0^5
"KRN",19,2920219,0)
BPS SETUP BASIC PARAMS^Edit Basic ECME Parameters^^R^^BPS MASTER^^^^^^^^^
"KRN",19,2920219,1,0)
^^3^3^3060602^
"KRN",19,2920219,1,1,0)
Gives users the ability to edit the ECME timeout parameter, which 
"KRN",19,2920219,1,2,0)
determines how long ECME claim progress messages are displayed on the 
"KRN",19,2920219,1,3,0)
screen.
"KRN",19,2920219,15)

"KRN",19,2920219,25)
EN^BPSOSS8
"KRN",19,2920219,"U")
EDIT BASIC ECME PARAMETERS
"KRN",19,2920227,-1)
4^18
"KRN",19,2920227,0)
BPS REOPEN CLOSED CLAIM
"KRN",19,2920292,-1)
0^16
"KRN",19,2920292,0)
BPS RPT CLAIMS RESPONSE^ECME Claims-Response Inquiry^^R^^BPS REPORTS^^^^^^E CLAIMS MGMT ENGINE^^
"KRN",19,2920292,1,0)
^^5^5^3070517^
"KRN",19,2920292,1,1,0)
A report that displays the data that was sent to the third-party payer and
"KRN",19,2920292,1,2,0)
the response that was returned.  This report displays or prints
"KRN",19,2920292,1,3,0)
information from the following files - BPS Transaction (#9002313.59) or
"KRN",19,2920292,1,4,0)
Log of Transaction (#9002313.57), BPS Claims (#9002313.02), and BPS
"KRN",19,2920292,1,5,0)
Responses (#9002313.03).
"KRN",19,2920292,20)

"KRN",19,2920292,25)
EN^BPSRCRI
"KRN",19,2920292,"U")
ECME CLAIMS-RESPONSE INQUIRY
"KRN",19,2920305,-1)
1^1
"KRN",19,2920305,0)
BPS RPT ERRONEOUS REV
"KRN",101,7082,-1)
0^12
"KRN",101,7082,0)
BPS PRTCL ECME USRSCR^ECME User Options^^M^^^^^^^^
"KRN",101,7082,4)
26^4
"KRN",101,7082,10,0)
^101.01PA^13^13
"KRN",101,7082,10,2,0)
7083^REV^5^
"KRN",101,7082,10,2,"^")
BPS PRTCL USRSCR REVERSE
"KRN",101,7082,10,3,0)
7084^CU^1^
"KRN",101,7082,10,3,"^")
BPS PRTCL USRSCR CONTINUOUS
"KRN",101,7082,10,4,0)
7085^RES^6^
"KRN",101,7082,10,4,"^")
BPS PRTCL USRSCR RESUBMIT
"KRN",101,7082,10,5,0)
7086^UD^2^
"KRN",101,7082,10,5,"^")
BPS PRTCL USRSCR UPDATE
"KRN",101,7082,10,6,0)
7087^SO^4^
"KRN",101,7082,10,6,"^")
BPS PRTCL USRSCR SORTLIST
"KRN",101,7082,10,7,0)
7088^CMT^8^
"KRN",101,7082,10,7,"^")
BPS PRTCL USRSCR COMMENT
"KRN",101,7082,10,8,0)
7089^FR^9^
"KRN",101,7082,10,8,"^")
BPS PRTCL USRSCR RESEARCH MENU
"KRN",101,7082,10,10,0)
7091^LOG^11^
"KRN",101,7082,10,10,"^")
BPS PRTCL USRSCR CLAIM LOG
"KRN",101,7082,10,11,0)
7092^CLO^7^
"KRN",101,7082,10,11,"^")
BPS PRTCL USRSCR CLOSE
"KRN",101,7082,10,12,0)
7102^CV^3^
"KRN",101,7082,10,12,"^")
BPS PRTCL USRSCR CHANGE VIEW
"KRN",101,7082,10,13,0)
7104^EX^12^
"KRN",101,7082,10,13,"^")
BPS PRTCL USRSCR EXIT
"KRN",101,7082,26)
DO SHOW^VALM
"KRN",101,7082,28)
Select Action: 
"KRN",101,7082,99)
60855,39462
"KRN",101,7083,-1)
0^13
"KRN",101,7083,0)
BPS PRTCL USRSCR REVERSE^Reverse Payable Claim^^A^^^^^^^^
"KRN",101,7083,20)
D REV^BPSSCRRV
"KRN",101,7083,99)
60855,39462
"KRN",101,7084,-1)
0^14
"KRN",101,7084,0)
BPS PRTCL USRSCR CONTINUOUS^Continuous Update^^A^^^^^^^^
"KRN",101,7084,20)
D CU^BPSSCRCU
"KRN",101,7084,99)
60855,39462
"KRN",101,7085,-1)
0^15
"KRN",101,7085,0)
BPS PRTCL USRSCR RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7085,20)
D RES^BPSSCRRS
"KRN",101,7085,99)
60855,39462
"KRN",101,7086,-1)
0^16
"KRN",101,7086,0)
BPS PRTCL USRSCR UPDATE^Display Update^^A^^^^^^^^
"KRN",101,7086,20)
D UD^BPSSCRUD
"KRN",101,7086,99)
60855,39462
"KRN",101,7087,-1)
0^17
"KRN",101,7087,0)
BPS PRTCL USRSCR SORTLIST^Sort List^^A^^^^^^^^
"KRN",101,7087,20)
D SL^BPSSCRSL
"KRN",101,7087,99)
60855,39462
"KRN",101,7088,-1)
0^18
"KRN",101,7088,0)
BPS PRTCL USRSCR COMMENT^Add/View Comments^^A^^^^^^^^
"KRN",101,7088,20)
D CMT^BPSCMT
"KRN",101,7088,99)
60855,39462
"KRN",101,7089,-1)
0^19
"KRN",101,7089,0)
BPS PRTCL USRSCR RESEARCH MENU^Further Research^^A^^^^^^^^
"KRN",101,7089,20)
D RM^BPSRSM
"KRN",101,7089,99)
60855,39462
"KRN",101,7091,-1)
0^20
"KRN",101,7091,0)
BPS PRTCL USRSCR CLAIM LOG^Print Claim Log^^A^^^^^^^^
"KRN",101,7091,20)
D LOG^BPSSCRLG
"KRN",101,7091,99)
60855,39462
"KRN",101,7092,-1)
0^21
"KRN",101,7092,0)
BPS PRTCL USRSCR CLOSE^Close Rejected Claim^^A^^^^^^^^
"KRN",101,7092,20)
D CLO^BPSSCRCL
"KRN",101,7092,99)
60855,39462
"KRN",101,7102,-1)
0^22
"KRN",101,7102,0)
BPS PRTCL USRSCR CHANGE VIEW^Change View^^A^^^^^^^^
"KRN",101,7102,20)
D CV^BPSSCRCV
"KRN",101,7102,99)
60855,39462
"KRN",101,7104,-1)
0^23
"KRN",101,7104,0)
BPS PRTCL USRSCR EXIT^Exit^^A^^^^^^^^
"KRN",101,7104,20)

"KRN",101,7104,99)
60855,39462
"KRN",101,7110,-1)
0^24
"KRN",101,7110,0)
BPS PRTCL LOG MENU^Menu protocol for LOG^^M^^^^^^^^
"KRN",101,7110,4)
26^4
"KRN",101,7110,10,0)
^101.01PA^2^1
"KRN",101,7110,10,2,0)
7104^EX^3^
"KRN",101,7110,10,2,"^")
BPS PRTCL USRSCR EXIT
"KRN",101,7110,26)
DO SHOW^VALM
"KRN",101,7110,28)
Select action:
"KRN",101,7110,99)
60855,39462
"KRN",101,7240,-1)
1^1
"KRN",101,7240,0)
BPS HIDDEN ACTIONS
"KRN",101,7241,-1)
1^2
"KRN",101,7241,0)
BPS P1 CONTINUOUS
"KRN",101,7242,-1)
1^3
"KRN",101,7242,0)
BPS P1 NEW CLAIMS
"KRN",101,7243,-1)
1^4
"KRN",101,7243,0)
BPS P1 PRINT PATIENT
"KRN",101,7244,-1)
1^5
"KRN",101,7244,0)
BPS P1 QUIT
"KRN",101,7245,-1)
1^6
"KRN",101,7245,0)
BPS P1 RECEIPT
"KRN",101,7246,-1)
1^7
"KRN",101,7246,0)
BPS P2 POKE
"KRN",101,7247,-1)
1^8
"KRN",101,7247,0)
BPS P2 TMIT JOBS
"KRN",101,7248,-1)
1^9
"KRN",101,7248,0)
BPS P2 TRANSMITTER
"KRN",101,7249,-1)
1^10
"KRN",101,7249,0)
BPS PRTCL RSCH VIEW ELIG MENU
"KRN",101,7250,-1)
1^11
"KRN",101,7250,0)
BPS PRTCL USRSCR PRINT
"KRN",409.61,558,-1)
0^1
"KRN",409.61,558,0)
BPS STATISTICS AND MANAGEMENT^1^^80^4^18^0^1^^BPS PROTOCOL 2^ECME STATISTICS^1^^1
"KRN",409.61,558,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,558,"ARRAY")
 ^TMP("BPSOS2",$J)
"KRN",409.61,558,"FNL")
D EXIT^BPSOS2
"KRN",409.61,558,"HDR")
D HDR^BPSOS2
"KRN",409.61,558,"HLP")
D HELP^BPSOS2
"KRN",409.61,558,"INIT")
D INIT^BPSOS2
"KRN",870,236,-1)
1^1
"KRN",870,236,0)
EPHARM IN
"MBREQ")
1
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",632,-1)
1^1
"PKG",632,0)
E CLAIMS MGMT ENGINE^BPS^ELECTRONIC CLAIMS MGT
"PKG",632,22,0)
^9.49I^1^1
"PKG",632,22,1,0)
1.0^3041008^3041130^568
"PKG",632,22,1,"PAH",1,0)
5^3070822^520651032
"PKG",632,22,1,"PAH",1,1,0)
^^21^21^3070822
"PKG",632,22,1,"PAH",1,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans
"PKG",632,22,1,"PAH",1,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic
"PKG",632,22,1,"PAH",1,1,3,0)
pharmacy (ePharmacy) system.  Below is a list of all the applications
"PKG",632,22,1,"PAH",1,1,4,0)
involved in this project along with their patch number:
"PKG",632,22,1,"PAH",1,1,5,0)
  
"PKG",632,22,1,"PAH",1,1,6,0)
   APPLICATION/VERSION                                  PATCH
"PKG",632,22,1,"PAH",1,1,7,0)
   --------------------------------------------------------------
"PKG",632,22,1,"PAH",1,1,8,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*260
"PKG",632,22,1,"PAH",1,1,9,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*363
"PKG",632,22,1,"PAH",1,1,10,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*5
"PKG",632,22,1,"PAH",1,1,11,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*127
"PKG",632,22,1,"PAH",1,1,12,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*63
"PKG",632,22,1,"PAH",1,1,13,0)
 
"PKG",632,22,1,"PAH",1,1,14,0)
The first three patches (BPS*1*5, IB*2*363,and PSO*7*260) will be
"PKG",632,22,1,"PAH",1,1,15,0)
released in the Kernel Installation and Distribution System (KIDS)
"PKG",632,22,1,"PAH",1,1,16,0)
multi-build distribution BPS PSO IB BUNDLE 2.0.  Patches PSX*2*63 and
"PKG",632,22,1,"PAH",1,1,17,0)
PSS*1*127 will be released as stand-alone patches.  Since there is an
"PKG",632,22,1,"PAH",1,1,18,0)
implementation dependency between the multi-build distribution and the
"PKG",632,22,1,"PAH",1,1,19,0)
stand-alone patches, PSX*2*63 and PSS*1*127 must be installed prior to
"PKG",632,22,1,"PAH",1,1,20,0)
the installation of the multi-build.  For more specific instructions
"PKG",632,22,1,"PAH",1,1,21,0)
please refer to the installation steps provided in each of the patches.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
191
"RTN","BPS01P1")
1^187
"RTN","BPS01P3")
1^184
"RTN","BPS01P5")
0^197^B100471929
"RTN","BPS01P5",1,0)
BPS01P5 ;BHAM ISC/BEE - BPS*1.0*5 POST INSTALL ROUTINE ;14-NOV-06
"RTN","BPS01P5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPS01P5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPS01P5",4,0)
 Q
"RTN","BPS01P5",5,0)
 ;
"RTN","BPS01P5",6,0)
EN ;BPS*1.0*5 - POST-INSTALL
"RTN","BPS01P5",7,0)
 N X,Y,%DT,ZTDESC,ZTSAVE,ZTIO,ZTDTH,ZTRTN
"RTN","BPS01P5",8,0)
 S X="N",%DT="ST"
"RTN","BPS01P5",9,0)
 D ^%DT
"RTN","BPS01P5",10,0)
 S ZTDTH=Y
"RTN","BPS01P5",11,0)
 S ZTIO=""
"RTN","BPS01P5",12,0)
 S ZTDESC="BPS*1.0*5 POST INSTALL"
"RTN","BPS01P5",13,0)
 S ZTSAVE("*")=""
"RTN","BPS01P5",14,0)
 S ZTRTN="EN1^BPS01P5"
"RTN","BPS01P5",15,0)
 D ^%ZTLOAD
"RTN","BPS01P5",16,0)
 Q
"RTN","BPS01P5",17,0)
 ;
"RTN","BPS01P5",18,0)
EN1 N DIFROM,TMPARR,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","BPS01P5",19,0)
 ;
"RTN","BPS01P5",20,0)
 ;Perform Data Cleanup - Delete Values from Obsolete Fields
"RTN","BPS01P5",21,0)
 D 02  ;BPS CLAIMS
"RTN","BPS01P5",22,0)
 D 31  ;BPS CERTIFICATION
"RTN","BPS01P5",23,0)
 D 56  ;BPS PHARMACIES
"RTN","BPS01P5",24,0)
 D 57  ;BPS LOG OF TRANSACTIONS
"RTN","BPS01P5",25,0)
 D 58  ;BPS STATISTICS
"RTN","BPS01P5",26,0)
 D 59  ;BPS TRANSACTIONS
"RTN","BPS01P5",27,0)
 D 91  ;BPS NCPDP FIELD DEFS
"RTN","BPS01P5",28,0)
 D 99^BPS01P5A  ;BPS SETUP
"RTN","BPS01P5",29,0)
 ;
"RTN","BPS01P5",30,0)
 ;Delete Obsolete Files
"RTN","BPS01P5",31,0)
 D DEL^BPS01P5A
"RTN","BPS01P5",32,0)
 ;
"RTN","BPS01P5",33,0)
 ;Convert BPSECX/BPSECP
"RTN","BPS01P5",34,0)
 D EN^BPS01P5A
"RTN","BPS01P5",35,0)
 ;
"RTN","BPS01P5",36,0)
 ; Update BPS Statistics
"RTN","BPS01P5",37,0)
 D STAT^BPS01P5B
"RTN","BPS01P5",38,0)
 ;
"RTN","BPS01P5",39,0)
 ; Move Submit Date/Time from submit queue to BPS Transaction
"RTN","BPS01P5",40,0)
 D SUBMIT^BPS01P5B
"RTN","BPS01P5",41,0)
 ;
"RTN","BPS01P5",42,0)
 ;Delete obsolete BPS NCPDP FIELD DEF records
"RTN","BPS01P5",43,0)
 D DEL91^BPS01P5C
"RTN","BPS01P5",44,0)
 ;
"RTN","BPS01P5",45,0)
 ;Delete fields from data dictionaries
"RTN","BPS01P5",46,0)
 D EN^BPS01P5B
"RTN","BPS01P5",47,0)
 ;
"RTN","BPS01P5",48,0)
 ;Delete entries from 'BPS NCPDP FIELD 420' with leading zeros.
"RTN","BPS01P5",49,0)
 D 420
"RTN","BPS01P5",50,0)
 ;
"RTN","BPS01P5",51,0)
 ;Clean up indexes
"RTN","BPS01P5",52,0)
 D IND
"RTN","BPS01P5",53,0)
 ;
"RTN","BPS01P5",54,0)
 ;Send mail to the user
"RTN","BPS01P5",55,0)
 S TMPARR(1)=""
"RTN","BPS01P5",56,0)
 S TMPARR(2)="The conversion of data from the ^BPSECP global to the BPS LOG file"
"RTN","BPS01P5",57,0)
 I $D(^BPSECP("LOG")) S TMPARR(3)="did not complete properly.  Please log a Remedy Ticket"
"RTN","BPS01P5",58,0)
 E  S TMPARR(3)="has successfully completed."
"RTN","BPS01P5",59,0)
 S XMSUB="BPS*1.0*5 installation has been completed"
"RTN","BPS01P5",60,0)
 S XMDUZ="E CLAIMS MGMT ENGINE PACKAGE"
"RTN","BPS01P5",61,0)
 S XMTEXT="TMPARR("
"RTN","BPS01P5",62,0)
 S XMY(DUZ)=""
"RTN","BPS01P5",63,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPS01P5",64,0)
 D ^XMD
"RTN","BPS01P5",65,0)
 Q
"RTN","BPS01P5",66,0)
 ;
"RTN","BPS01P5",67,0)
 ;BPS CLAIMS (#9002313.02)
"RTN","BPS01P5",68,0)
02 N IEN,IEN02,IEN57,IEN92,NODE0,VPIEN
"RTN","BPS01P5",69,0)
 S IEN=0 F  S IEN=$O(^BPSC(IEN)) Q:'IEN  D
"RTN","BPS01P5",70,0)
 .N I,X
"RTN","BPS01P5",71,0)
 .;
"RTN","BPS01P5",72,0)
 .;Fix 'Transmitted On'
"RTN","BPS01P5",73,0)
 .S NODE0=$G(^BPSC(IEN,0))
"RTN","BPS01P5",74,0)
 .I $P(NODE0,U,5)="" D
"RTN","BPS01P5",75,0)
 ..S $P(NODE0,U,5)=$P(NODE0,U,6)
"RTN","BPS01P5",76,0)
 ..I $P(NODE0,U,5)]"" S ^BPSC("AE",$E($P(NODE0,U,5),1,30),IEN)=""
"RTN","BPS01P5",77,0)
 .;
"RTN","BPS01P5",78,0)
 .;Fix fields for Reversal Claims
"RTN","BPS01P5",79,0)
 .I $P($G(^BPSC(IEN,100)),U,3)="B2" D
"RTN","BPS01P5",80,0)
 ..S IEN57=$O(^BPSTL("AER",IEN,"")) Q:IEN57=""
"RTN","BPS01P5",81,0)
 ..;
"RTN","BPS01P5",82,0)
 ..;Electronic payer (.02)
"RTN","BPS01P5",83,0)
 ..S IEN92=$P($G(^BPSTL(IEN57,10,1,0)),U,3)
"RTN","BPS01P5",84,0)
 ..S:IEN92 $P(NODE0,U,2)=IEN92
"RTN","BPS01P5",85,0)
 ..;
"RTN","BPS01P5",86,0)
 ..;Original Claim IEN
"RTN","BPS01P5",87,0)
 ..S IEN02=$P($G(^BPSTL(IEN57,0)),U,4) Q:IEN02=""
"RTN","BPS01P5",88,0)
 ..;
"RTN","BPS01P5",89,0)
 ..;MEDICATION NUMBER (.03)/MEDICATION NAME (.04)
"RTN","BPS01P5",90,0)
 ..N MED S MED=$G(^BPSC(IEN,400,1,0))
"RTN","BPS01P5",91,0)
 ..S:$P(MED,U,3)="" $P(MED,U,3)=1
"RTN","BPS01P5",92,0)
 ..S:$P(MED,U,4)="" $P(MED,U,4)=$P($G(^BPSC(IEN02,400,1,0)),U,4)
"RTN","BPS01P5",93,0)
 ..S ^BPSC(IEN,400,1,0)=MED
"RTN","BPS01P5",94,0)
 ..K MED
"RTN","BPS01P5",95,0)
 ..;
"RTN","BPS01P5",96,0)
 ..;VA PLAN IEN (1.04)
"RTN","BPS01P5",97,0)
 ..S VPIEN=$P($G(^BPSC(IEN02,1)),U,4)
"RTN","BPS01P5",98,0)
 ..S:VPIEN]"" $P(^BPSC(IEN,1),U,4)=VPIEN
"RTN","BPS01P5",99,0)
 .;
"RTN","BPS01P5",100,0)
 .;Store '0' Node
"RTN","BPS01P5",101,0)
 .S ^BPSC(IEN,0)=NODE0
"RTN","BPS01P5",102,0)
 .;
"RTN","BPS01P5",103,0)
 .;'1' Node
"RTN","BPS01P5",104,0)
 .S X=$G(^BPSC(IEN,1))
"RTN","BPS01P5",105,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",106,0)
 ..F I=2,3 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",107,0)
 ..S ^BPSC(IEN,1)=X
"RTN","BPS01P5",108,0)
 .;
"RTN","BPS01P5",109,0)
 .;'300' Node
"RTN","BPS01P5",110,0)
 .S X=$G(^BPSC(IEN,300))
"RTN","BPS01P5",111,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",112,0)
 ..F I=8,15,16,17,18,19 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",113,0)
 ..S ^BPSC(IEN,300)=X
"RTN","BPS01P5",114,0)
 .;
"RTN","BPS01P5",115,0)
 .;'320' Node
"RTN","BPS01P5",116,0)
 .K ^BPSC(IEN,320)
"RTN","BPS01P5",117,0)
 .;
"RTN","BPS01P5",118,0)
 .;'498' Node
"RTN","BPS01P5",119,0)
 .K ^BPSC(IEN,498)
"RTN","BPS01P5",120,0)
 .;
"RTN","BPS01P5",121,0)
 .N IEN2
"RTN","BPS01P5",122,0)
 .S IEN2=0 F  S IEN2=$O(^BPSC(IEN,400,IEN2)) Q:'IEN2  D
"RTN","BPS01P5",123,0)
 ..;
"RTN","BPS01P5",124,0)
 ..;'400;0' Node
"RTN","BPS01P5",125,0)
 ..S X=$G(^BPSC(IEN,400,IEN2,0))
"RTN","BPS01P5",126,0)
 ..I $TR(X,U)]"" D
"RTN","BPS01P5",127,0)
 ...S $P(X,U,2)=""
"RTN","BPS01P5",128,0)
 ...S ^BPSC(IEN,400,IEN2,0)=X
"RTN","BPS01P5",129,0)
 ..;
"RTN","BPS01P5",130,0)
 ..;'400;400' Node
"RTN","BPS01P5",131,0)
 ..S X=$G(^BPSC(IEN,400,IEN2,400))
"RTN","BPS01P5",132,0)
 ..I $TR(X,U)]"" D
"RTN","BPS01P5",133,0)
 ...F I=4,10,16,22 S $P(X,U,I)=""
"RTN","BPS01P5",134,0)
 ...S ^BPSC(IEN,400,IEN2,400)=X
"RTN","BPS01P5",135,0)
 ..;
"RTN","BPS01P5",136,0)
 ..;'400;420' Node
"RTN","BPS01P5",137,0)
 ..S X=$G(^BPSC(IEN,400,IEN2,420))
"RTN","BPS01P5",138,0)
 ..I $TR(X,U)]"" D
"RTN","BPS01P5",139,0)
 ...F I=25,28,32 S $P(X,U,I)=""
"RTN","BPS01P5",140,0)
 ...S ^BPSC(IEN,400,IEN2,420)=X
"RTN","BPS01P5",141,0)
 ..;
"RTN","BPS01P5",142,0)
 ..;'400;430' Node
"RTN","BPS01P5",143,0)
 ..S X=$G(^BPSC(IEN,400,IEN2,430))
"RTN","BPS01P5",144,0)
 ..I $TR(X,U)]"" D
"RTN","BPS01P5",145,0)
 ...F I=7,9,10 S $P(X,U,I)=""
"RTN","BPS01P5",146,0)
 ...S ^BPSC(IEN,400,IEN2,430)=X
"RTN","BPS01P5",147,0)
 ..;
"RTN","BPS01P5",148,0)
 ..;'400;440' Node
"RTN","BPS01P5",149,0)
 ..S X=$G(^BPSC(IEN,400,IEN2,440))
"RTN","BPS01P5",150,0)
 ..I $TR(X,U)]"" D
"RTN","BPS01P5",151,0)
 ...S $P(X,U)=""
"RTN","BPS01P5",152,0)
 ...S ^BPSC(IEN,400,IEN2,440)=X
"RTN","BPS01P5",153,0)
 ;
"RTN","BPS01P5",154,0)
 K IEN,IEN02,IEN57,IEN92,VPIEN
"RTN","BPS01P5",155,0)
 Q
"RTN","BPS01P5",156,0)
 ;
"RTN","BPS01P5",157,0)
 ;BPS CERTIFICATION (#9002313.31)
"RTN","BPS01P5",158,0)
31 N IEN
"RTN","BPS01P5",159,0)
 ;
"RTN","BPS01P5",160,0)
 S IEN=0 F  S IEN=$O(^BPS(9002313.31,IEN)) Q:'IEN  D
"RTN","BPS01P5",161,0)
 .N X
"RTN","BPS01P5",162,0)
 .S X=$G(^BPS(9002313.31,IEN,0))
"RTN","BPS01P5",163,0)
 .I $TR(X,U)]"" S $P(X,U,5)="",^BPS(9002313.31,IEN,0)=X  ;Reset field
"RTN","BPS01P5",164,0)
 .S X=$G(^BPS(9002313.31,IEN,4))
"RTN","BPS01P5",165,0)
 .I $TR(X,U)]"" S $P(X,U)="",^BPS(9002313.31,IEN,4)=X  ;Reset field
"RTN","BPS01P5",166,0)
 ;
"RTN","BPS01P5",167,0)
 K IEN
"RTN","BPS01P5",168,0)
 Q
"RTN","BPS01P5",169,0)
 ;
"RTN","BPS01P5",170,0)
 ;BPS PHARMACIES (#9002313.56)
"RTN","BPS01P5",171,0)
56 N IEN,IEN2
"RTN","BPS01P5",172,0)
 ;
"RTN","BPS01P5",173,0)
 S IEN=0 F  S IEN=$O(^BPS(9002313.56,IEN)) Q:'IEN  D
"RTN","BPS01P5",174,0)
 .N I,X
"RTN","BPS01P5",175,0)
 .;
"RTN","BPS01P5",176,0)
 .;'0' Node
"RTN","BPS01P5",177,0)
 .S X=$G(^BPS(9002313.56,IEN,0))
"RTN","BPS01P5",178,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",179,0)
 ..F I=4:1:7 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",180,0)
 ..S ^BPS(9002313.56,IEN,0)=X
"RTN","BPS01P5",181,0)
 .;
"RTN","BPS01P5",182,0)
 .;CAID' Node (Reset MEDICAID # and DEFAULT CAID PROVIDER #)
"RTN","BPS01P5",183,0)
 .K ^BPS(9002313.56,IEN,"CAID")
"RTN","BPS01P5",184,0)
 .;
"RTN","BPS01P5",185,0)
 .;'INSURER/INSURER-ASSIGNED #' Node (Reset INSURER and INSURER-ASSIGNED #)
"RTN","BPS01P5",186,0)
 .K ^BPS(9002313.56,IEN,"INSURER-ASSIGNED #")
"RTN","BPS01P5",187,0)
 .;
"RTN","BPS01P5",188,0)
 .;'PRESCRIBER' Node (Reset PRESCRIBER)
"RTN","BPS01P5",189,0)
 .S IEN2=0 F  S IEN2=$O(^BPS(9002313.56,IEN,"OPSITE",IEN2)) Q:'IEN2  D
"RTN","BPS01P5",190,0)
 ..K ^BPS(9002313.56,IEN,"OPSITE",IEN2,1)  ;Reset PRESCRIBER information
"RTN","BPS01P5",191,0)
 ;
"RTN","BPS01P5",192,0)
 K IEN,IEN2
"RTN","BPS01P5",193,0)
 Q
"RTN","BPS01P5",194,0)
 ;
"RTN","BPS01P5",195,0)
 ;BPS LOG OF TRANSACTIONS (#9002313.57)
"RTN","BPS01P5",196,0)
57 N IEN
"RTN","BPS01P5",197,0)
 S IEN=0 F  S IEN=$O(^BPSTL(IEN)) Q:'IEN  D
"RTN","BPS01P5",198,0)
 .N I,X
"RTN","BPS01P5",199,0)
 .;
"RTN","BPS01P5",200,0)
 .;'0' Node
"RTN","BPS01P5",201,0)
 .S X=$G(^BPSTL(IEN,0))
"RTN","BPS01P5",202,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",203,0)
 ..F I=7,12:1:16 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",204,0)
 ..S ^BPSTL(IEN,0)=X
"RTN","BPS01P5",205,0)
 .;
"RTN","BPS01P5",206,0)
 .;'1' Node
"RTN","BPS01P5",207,0)
 .S X=$G(^BPSTL(IEN,1))
"RTN","BPS01P5",208,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",209,0)
 ..F I=3,5,6,14 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",210,0)
 ..S ^BPSTL(IEN,1)=X
"RTN","BPS01P5",211,0)
 .;
"RTN","BPS01P5",212,0)
 .;'2' Node
"RTN","BPS01P5",213,0)
 .N NRES,RES,ND2
"RTN","BPS01P5",214,0)
 .S ND2=$G(^BPSTL(IEN,2))
"RTN","BPS01P5",215,0)
 .S RES=$P(ND2,U,2,99)
"RTN","BPS01P5",216,0)
 .S RES=$TR(RES,"]")  ;Translate ']' to NULL
"RTN","BPS01P5",217,0)
 .;
"RTN","BPS01P5",218,0)
 .;Translate '[Previously: ' to ';'
"RTN","BPS01P5",219,0)
 .S NRES=""
"RTN","BPS01P5",220,0)
 .F I=1:1:$L(RES,"[Previously: ") S NRES=NRES_$S(I>1:";",1:"")_$P(RES,"[Previously: ",I)
"RTN","BPS01P5",221,0)
 .;
"RTN","BPS01P5",222,0)
 .;Store changes
"RTN","BPS01P5",223,0)
 .S ^BPSTL(IEN,2)=$P(ND2,U)_U_NRES
"RTN","BPS01P5",224,0)
 .;
"RTN","BPS01P5",225,0)
 .;'3' Node
"RTN","BPS01P5",226,0)
 .K ^BPSTL(IEN,3)
"RTN","BPS01P5",227,0)
 .;
"RTN","BPS01P5",228,0)
 .;'4' Node
"RTN","BPS01P5",229,0)
 .S X=$G(^BPSTL(IEN,4))
"RTN","BPS01P5",230,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",231,0)
 ..S $P(X,U,3)=""  ;Reset PAPER REVERSAL
"RTN","BPS01P5",232,0)
 ..S ^BPSTL(IEN,4)=X
"RTN","BPS01P5",233,0)
 .;
"RTN","BPS01P5",234,0)
 .;'5' Node
"RTN","BPS01P5",235,0)
 .S X=$G(^BPSTL(IEN,5))
"RTN","BPS01P5",236,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",237,0)
 ..S $P(X,U,6)=""   ;Reset PRICE MANUALLY ENTERED
"RTN","BPS01P5",238,0)
 ..S ^BPSTL(IEN,5)=X
"RTN","BPS01P5",239,0)
 .;
"RTN","BPS01P5",240,0)
 .;'6' Node
"RTN","BPS01P5",241,0)
 .K ^BPSTL(IEN,6)
"RTN","BPS01P5",242,0)
 .;
"RTN","BPS01P5",243,0)
 .;'7' Node
"RTN","BPS01P5",244,0)
 .K ^BPSTL(IEN,7)
"RTN","BPS01P5",245,0)
 .;
"RTN","BPS01P5",246,0)
 .;'8' Node
"RTN","BPS01P5",247,0)
 .S X=$G(^BPSTL(IEN,8))
"RTN","BPS01P5",248,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",249,0)
 ..S $P(X,U,2)=""  ;Reset RETRY ON DIAL OUT
"RTN","BPS01P5",250,0)
 ..S ^BPSTL(IEN,8)=X
"RTN","BPS01P5",251,0)
 ;
"RTN","BPS01P5",252,0)
 K IEN
"RTN","BPS01P5",253,0)
 Q
"RTN","BPS01P5",254,0)
 ;
"RTN","BPS01P5",255,0)
 ;BPS STATISTICS (#9002313.58)
"RTN","BPS01P5",256,0)
58 N DIK,IEN,X
"RTN","BPS01P5",257,0)
 ;
"RTN","BPS01P5",258,0)
 ;Clear out the "B" index
"RTN","BPS01P5",259,0)
 K ^BPSECX("S","B")
"RTN","BPS01P5",260,0)
 ;
"RTN","BPS01P5",261,0)
 S IEN=0 F  S IEN=$O(^BPSECX("S",IEN)) Q:'IEN  D
"RTN","BPS01P5",262,0)
 .;
"RTN","BPS01P5",263,0)
 .;'M' Node
"RTN","BPS01P5",264,0)
 .K ^BPSECX("S",IEN,"M")
"RTN","BPS01P5",265,0)
 .;
"RTN","BPS01P5",266,0)
 .;'C' Node
"RTN","BPS01P5",267,0)
 .K ^BPSECX("S",IEN,"C")
"RTN","BPS01P5",268,0)
 .;
"RTN","BPS01P5",269,0)
 .;'CT' Node
"RTN","BPS01P5",270,0)
 .K ^BPSECX("S",IEN,"CT")
"RTN","BPS01P5",271,0)
 .;
"RTN","BPS01P5",272,0)
 .;'D' Node
"RTN","BPS01P5",273,0)
 .K ^BPSECX("S",IEN,"D")
"RTN","BPS01P5",274,0)
 .;
"RTN","BPS01P5",275,0)
 .;'CR' Node
"RTN","BPS01P5",276,0)
 .K ^BPSECX("S",IEN,"CR")
"RTN","BPS01P5",277,0)
 .;
"RTN","BPS01P5",278,0)
 .;'CR2' Node
"RTN","BPS01P5",279,0)
 .K ^BPSECX("S",IEN,"CR2")
"RTN","BPS01P5",280,0)
 .;
"RTN","BPS01P5",281,0)
 .;'CRN' Node
"RTN","BPS01P5",282,0)
 .K ^BPSECX("S",IEN,"CRN")
"RTN","BPS01P5",283,0)
 .;
"RTN","BPS01P5",284,0)
 .;'ABSBPOSV' Node
"RTN","BPS01P5",285,0)
 .K ^BPSECX("S",IEN,"ABSBPOSV")
"RTN","BPS01P5",286,0)
 .;
"RTN","BPS01P5",287,0)
 .;'V' Node
"RTN","BPS01P5",288,0)
 .K ^BPSECX("S",IEN,"V")
"RTN","BPS01P5",289,0)
 .;
"RTN","BPS01P5",290,0)
 .;Copy IEN into .01 field
"RTN","BPS01P5",291,0)
 .S X=$G(^BPSECX("S",IEN,0))
"RTN","BPS01P5",292,0)
 .S $P(X,U)=IEN,^BPSECX("S",IEN,0)=X
"RTN","BPS01P5",293,0)
 .S ^BPSECX("S","B",$E(IEN,1,30),IEN)=""
"RTN","BPS01P5",294,0)
 .;
"RTN","BPS01P5",295,0)
 .;Update File Header Field
"RTN","BPS01P5",296,0)
 .S $P(^BPSECX("S",0),U,3)=IEN
"RTN","BPS01P5",297,0)
 ;
"RTN","BPS01P5",298,0)
 K DIK,IEN,X
"RTN","BPS01P5",299,0)
 ;
"RTN","BPS01P5",300,0)
 Q
"RTN","BPS01P5",301,0)
 ;
"RTN","BPS01P5",302,0)
 ;BPS TRANSACTION (#9002313.59)
"RTN","BPS01P5",303,0)
59 N IEN
"RTN","BPS01P5",304,0)
 S IEN=0 F  S IEN=$O(^BPST(IEN)) Q:'IEN  D
"RTN","BPS01P5",305,0)
 .N I,X
"RTN","BPS01P5",306,0)
 .;
"RTN","BPS01P5",307,0)
 .;'0' Node
"RTN","BPS01P5",308,0)
 .S X=$G(^BPST(IEN,0))
"RTN","BPS01P5",309,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",310,0)
 ..F I=7,12:1:16 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",311,0)
 ..S ^BPST(IEN,0)=X
"RTN","BPS01P5",312,0)
 .;
"RTN","BPS01P5",313,0)
 .;'1' Node
"RTN","BPS01P5",314,0)
 .S X=$G(^BPST(IEN,1))
"RTN","BPS01P5",315,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",316,0)
 ..F I=3,5,6,14 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",317,0)
 ..S ^BPST(IEN,1)=X
"RTN","BPS01P5",318,0)
 .;
"RTN","BPS01P5",319,0)
 .;'2' Node
"RTN","BPS01P5",320,0)
 .N NRES,RES,ND2
"RTN","BPS01P5",321,0)
 .S ND2=$G(^BPST(IEN,2))
"RTN","BPS01P5",322,0)
 .S RES=$P(ND2,U,2,99)
"RTN","BPS01P5",323,0)
 .S RES=$TR(RES,"]")  ;Translate ']' to NULL
"RTN","BPS01P5",324,0)
 .;
"RTN","BPS01P5",325,0)
 .;Translate '[Previously: ' to ';'
"RTN","BPS01P5",326,0)
 .S NRES=""
"RTN","BPS01P5",327,0)
 .F I=1:1:$L(RES,"[Previously: ") S NRES=NRES_$S(I>1:";",1:"")_$P(RES,"[Previously: ",I)
"RTN","BPS01P5",328,0)
 .;
"RTN","BPS01P5",329,0)
 .;Store changes
"RTN","BPS01P5",330,0)
 .S ^BPST(IEN,2)=$P(ND2,U)_U_NRES
"RTN","BPS01P5",331,0)
 .S $P(^BPST(IEN,2),U,2)=NRES
"RTN","BPS01P5",332,0)
 .;
"RTN","BPS01P5",333,0)
 .;'3' Node
"RTN","BPS01P5",334,0)
 .K ^BPST(IEN,3)
"RTN","BPS01P5",335,0)
 .;
"RTN","BPS01P5",336,0)
 .;'4' Node
"RTN","BPS01P5",337,0)
 .S X=$G(^BPST(IEN,4))
"RTN","BPS01P5",338,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",339,0)
 ..S $P(X,U,3)=""  ;Reset PAPER REVERSAL
"RTN","BPS01P5",340,0)
 ..S ^BPST(IEN,4)=X
"RTN","BPS01P5",341,0)
 .;
"RTN","BPS01P5",342,0)
 .;'5' Node
"RTN","BPS01P5",343,0)
 .S X=$G(^BPST(IEN,5))
"RTN","BPS01P5",344,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",345,0)
 ..S $P(X,U,6)=""   ;Reset PRICE MANUALLY ENTERED
"RTN","BPS01P5",346,0)
 ..S ^BPST(IEN,5)=X
"RTN","BPS01P5",347,0)
 .;
"RTN","BPS01P5",348,0)
 .;'6' Node
"RTN","BPS01P5",349,0)
 .K ^BPST(IEN,6)
"RTN","BPS01P5",350,0)
 .;
"RTN","BPS01P5",351,0)
 .;'7' Node
"RTN","BPS01P5",352,0)
 .K ^BPST(IEN,7)
"RTN","BPS01P5",353,0)
 .;
"RTN","BPS01P5",354,0)
 .;'8' Node
"RTN","BPS01P5",355,0)
 .S X=$G(^BPST(IEN,8))
"RTN","BPS01P5",356,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",357,0)
 ..S $P(X,U,2)=""  ;Reset RETRY ON DIAL OUT
"RTN","BPS01P5",358,0)
 ..S ^BPST(IEN,8)=X
"RTN","BPS01P5",359,0)
 ;
"RTN","BPS01P5",360,0)
 K IEN
"RTN","BPS01P5",361,0)
 Q
"RTN","BPS01P5",362,0)
 ;
"RTN","BPS01P5",363,0)
 ;BPS NCPDP FIELD DEFS (#9002313.91)
"RTN","BPS01P5",364,0)
91 N IEN
"RTN","BPS01P5",365,0)
 S IEN=0 F  S IEN=$O(^BPSF(9002313.91,IEN)) Q:'IEN  D
"RTN","BPS01P5",366,0)
 .N I,X
"RTN","BPS01P5",367,0)
 .;
"RTN","BPS01P5",368,0)
 .;'0' Node
"RTN","BPS01P5",369,0)
 .S X=$G(^BPSF(9002313.91,IEN,0))
"RTN","BPS01P5",370,0)
 .I $TR(X,U)]"" D
"RTN","BPS01P5",371,0)
 ..F I=2,5 S $P(X,U,I)=""  ;Reset selected fields
"RTN","BPS01P5",372,0)
 ..S ^BPSF(9002313.91,IEN,0)=X
"RTN","BPS01P5",373,0)
 .;
"RTN","BPS01P5",374,0)
 .;Remove Format Code (Field 20)
"RTN","BPS01P5",375,0)
 .K ^BPSF(9002313.91,IEN,20)
"RTN","BPS01P5",376,0)
 ;
"RTN","BPS01P5",377,0)
 K IEN
"RTN","BPS01P5",378,0)
 Q
"RTN","BPS01P5",379,0)
 ;
"RTN","BPS01P5",380,0)
 ;Delete entries with leading zeros from BPS NCPDP FIELD 420 (#9002313.8242)
"RTN","BPS01P5",381,0)
420 N DIE,DA,DR,CD
"RTN","BPS01P5",382,0)
 S CD=0 F  S CD=$O(^BPSF(9002313.8242,"B",CD)) Q:CD=""  D
"RTN","BPS01P5",383,0)
 .I $E(CD,1)'="0" Q
"RTN","BPS01P5",384,0)
 .S DA=$O(^BPSF(9002313.8242,"B",CD,"")) Q:DA=""
"RTN","BPS01P5",385,0)
 .S DIE=9002313.8242,DR=".01////@"
"RTN","BPS01P5",386,0)
 .D ^DIE
"RTN","BPS01P5",387,0)
 Q
"RTN","BPS01P5",388,0)
 ;
"RTN","BPS01P5",389,0)
 ;Delete indexes
"RTN","BPS01P5",390,0)
IND K ^BPSC("D") ;9002313.02 - Billing Item PCN #
"RTN","BPS01P5",391,0)
 K ^BPSC("E") ;9002313.02 - Billing Item VCN #
"RTN","BPS01P5",392,0)
 K ^BPSTL("AI") ;9002313.57 - INSURER
"RTN","BPS01P5",393,0)
 K ^BPSTL("AR") ;9002313.57 - POSTED TO A/R
"RTN","BPS01P5",394,0)
 K ^BPSTL("AS") ;9002313.57 - NEEDS BILLING
"RTN","BPS01P5",395,0)
 K ^BPST("AR") ;9002313.59 - POSTED TO A/R
"RTN","BPS01P5",396,0)
 Q
"RTN","BPS01P5A")
0^198^B71771473
"RTN","BPS01P5A",1,0)
BPS01P5A ;BHAM ISC/BEE - Post-Install for BPS*1*5 (cont) ;13-DEC-06
"RTN","BPS01P5A",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPS01P5A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPS01P5A",4,0)
 ;
"RTN","BPS01P5A",5,0)
 Q
"RTN","BPS01P5A",6,0)
 ;
"RTN","BPS01P5A",7,0)
 ; Called by the BPS*1.0*5 Post-Install routine BPS01P5.
"RTN","BPS01P5A",8,0)
 ;
"RTN","BPS01P5A",9,0)
 ; This routine will convert or delete the invalid usage of globals
"RTN","BPS01P5A",10,0)
 ;   ^BPSECX and ^BPSECP
"RTN","BPS01P5A",11,0)
 ; It will also delete several ECME files that are now obsolete
"RTN","BPS01P5A",12,0)
 ;
"RTN","BPS01P5A",13,0)
 ; ^BPSECX cleanup - Here are the nodes and what should be done
"RTN","BPS01P5A",14,0)
 ;    "BPSOSRX" is the processing queue - Convert to XTMP and delete
"RTN","BPS01P5A",15,0)
 ;    "R" is the BPS Report Master database (obsolete) and will be
"RTN","BPS01P5A",16,0)
 ;       deleted by BPSO1P5
"RTN","BPS01P5A",17,0)
 ;    "S" is the BPS Statistics database and should not be deleted
"RTN","BPS01P5A",18,0)
 ;    "POS", "BPSOSQ3", and $J were for HL7 packet creation.  They
"RTN","BPS01P5A",19,0)
 ;       do not need to be converted and can just be killed.
"RTN","BPS01P5A",20,0)
 ;
"RTN","BPS01P5A",21,0)
 ;
"RTN","BPS01P5A",22,0)
 ; ^BPSECP cleanup - Here are the nodes and what should be done
"RTN","BPS01P5A",23,0)
 ;    "CHECKTIM" - Used for queuing BPSOSQ1.  This is no longer
"RTN","BPS01P5A",24,0)
 ;       needed and can just be killed.
"RTN","BPS01P5A",25,0)
 ;    "LOG" - Convert to BPS Log file and then delete.
"RTN","BPS01P5A",26,0)
 ;
"RTN","BPS01P5A",27,0)
EN ;
"RTN","BPS01P5A",28,0)
 ; Remove XTMP global used for logging errors
"RTN","BPS01P5A",29,0)
 K ^XTMP("BPS01P5A")
"RTN","BPS01P5A",30,0)
 ;
"RTN","BPS01P5A",31,0)
 ; First convert ^BPSECP("BPSOSRX") into XTMP and delete it
"RTN","BPS01P5A",32,0)
 M ^XTMP("BPS-PROC")=^BPSECP("BPSOSRX")
"RTN","BPS01P5A",33,0)
 K ^BPSECP("BPSOSRX")
"RTN","BPS01P5A",34,0)
 ; If the global has been created but the zero node is missing, set it
"RTN","BPS01P5A",35,0)
 I $D(^XTMP("BPS-PROC")),'$D(^XTMP("BPS-PROC",0)) D
"RTN","BPS01P5A",36,0)
 . N X,X1,X2
"RTN","BPS01P5A",37,0)
 . S X1=DT,X2=30 D C^%DTC
"RTN","BPS01P5A",38,0)
 . S ^XTMP("BPS-PROC",0)=X_U_DT_U_"ECME PROCESSING QUEUE"
"RTN","BPS01P5A",39,0)
 ;
"RTN","BPS01P5A",40,0)
 ; Second, kill off unneeded ^BPSECX nodes
"RTN","BPS01P5A",41,0)
 ; Note that we need to loop because of the $J nodes.
"RTN","BPS01P5A",42,0)
 N SUB
"RTN","BPS01P5A",43,0)
 S SUB=""
"RTN","BPS01P5A",44,0)
 F  S SUB=$O(^BPSECX(SUB)) Q:SUB=""  I SUB'="S",SUB'="RPT" K ^BPSECX(SUB)
"RTN","BPS01P5A",45,0)
 ;
"RTN","BPS01P5A",46,0)
 ; Third, kill ^BPSECP("CHECKTIM")
"RTN","BPS01P5A",47,0)
 K ^BPSECP("CHECKTIM")
"RTN","BPS01P5A",48,0)
 ;
"RTN","BPS01P5A",49,0)
 ; Fourth, convert ^BPSECP("LOG")
"RTN","BPS01P5A",50,0)
 ; Note that we are only converting the transaction log (pattern match .N1"."5N)
"RTN","BPS01P5A",51,0)
 ;   and purge logs (type=5).  Other communication logs are being deleted.
"RTN","BPS01P5A",52,0)
 N SLOT,TXTIEN,PURGE,LOGIEN,PDT
"RTN","BPS01P5A",53,0)
 N TXTIEN,TM,TMP,TXT,TXT1,TXT2,PDTM
"RTN","BPS01P5A",54,0)
 S SLOT=""
"RTN","BPS01P5A",55,0)
 F  S SLOT=$O(^BPSECP("LOG",SLOT)) Q:SLOT=""  D
"RTN","BPS01P5A",56,0)
 . ; Set PURGE equal to whether the SLOT if a Purge Log
"RTN","BPS01P5A",57,0)
 . S PURGE=$P(SLOT,".",2)=5
"RTN","BPS01P5A",58,0)
 . ; If not transaction log or purge log, delete it and go on
"RTN","BPS01P5A",59,0)
 . I SLOT'?.N1"."5N,'PURGE K ^BPSECP("LOG",SLOT) Q
"RTN","BPS01P5A",60,0)
 . ; Create/find LOG IEN
"RTN","BPS01P5A",61,0)
 . S LOGIEN=$$LOG(SLOT)
"RTN","BPS01P5A",62,0)
 . I LOGIEN=-1 Q
"RTN","BPS01P5A",63,0)
 . S PDT="",PDTM=""
"RTN","BPS01P5A",64,0)
 . I PURGE S PDT=$P(SLOT,".",1)
"RTN","BPS01P5A",65,0)
 . S TXTIEN=0 F  S TXTIEN=$O(^BPSECP("LOG",SLOT,TXTIEN)) Q:TXTIEN=""  D
"RTN","BPS01P5A",66,0)
 .. ; Get data
"RTN","BPS01P5A",67,0)
 .. S X=$G(^BPSECP("LOG",SLOT,TXTIEN))
"RTN","BPS01P5A",68,0)
 .. S TM=$P($$HTFM^XLFDT(+$H_","_$P(X,U,1)),".",2),TXT=$P(X,U,2),TXT1=$$UP(TXT)
"RTN","BPS01P5A",69,0)
 .. ; If it is a transaction log, get the purge date
"RTN","BPS01P5A",70,0)
 .. I 'PURGE D
"RTN","BPS01P5A",71,0)
 ... I TXT1["BEFORE SUBMIT OF CLAIM" S TMP=$P($P(TXT1," - ",2)," BEFORE",1) I TMP?1"30"5N S PDT=TMP
"RTN","BPS01P5A",72,0)
 ... I TXT1["BEFORE SUBMIT OF REVERSAL" S TMP=$P($P(TXT1," - ",2)," BEFORE",1) I TMP?1"30"5N S PDT=TMP
"RTN","BPS01P5A",73,0)
 ... I TXT1["START OF CLAIM" S X=$P($P(TXT1,"START OF CLAIM - ",2),"@"),PDT=$$CDT(X,PDT)
"RTN","BPS01P5A",74,0)
 ... I TXT1["LOG TIME STAMP" D
"RTN","BPS01P5A",75,0)
 .... S X=$P(TXT1,"LOG TIME STAMP",2)
"RTN","BPS01P5A",76,0)
 .... I $E(X,1)=" " S X=$E(X,2,999)
"RTN","BPS01P5A",77,0)
 .... S X=$P($P(X," ",1,2),"@",1),PDT=$$CDT(X,PDT)
"RTN","BPS01P5A",78,0)
 ... S TXT2=","_$E(TXT1,1,3)_","
"RTN","BPS01P5A",79,0)
 ... I ",JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,"[TXT2 S X=$P($P(TXT1," ",1,2),"@",1),PDT=$$CDT(X,PDT)
"RTN","BPS01P5A",80,0)
 .. I PDT="" S ^XTMP("BPS01P5A",1,SLOT,TXTIEN)=TXT Q
"RTN","BPS01P5A",81,0)
 .. S PDTM=PDT_"."_TM
"RTN","BPS01P5A",82,0)
 .. D FILE1(LOGIEN,TXTIEN,PDTM,TXT)
"RTN","BPS01P5A",83,0)
 . I PDTM="" S PDTM=$$NOW^XLFDT(),^XTMP("BPS01P5A",2,SLOT)=PDTM
"RTN","BPS01P5A",84,0)
 . D FILE2(LOGIEN,PDTM)
"RTN","BPS01P5A",85,0)
 . K ^BPSECP("LOG",SLOT)
"RTN","BPS01P5A",86,0)
 ;
"RTN","BPS01P5A",87,0)
 ; If XTMP("BPS01P5A") global created, add top node with purge date
"RTN","BPS01P5A",88,0)
 I $D(^XTMP("BPS01P5A")) D
"RTN","BPS01P5A",89,0)
 . N X,X1,X2
"RTN","BPS01P5A",90,0)
 . S X1=DT,X2=60 D C^%DTC
"RTN","BPS01P5A",91,0)
 . S ^XTMP("BPS01P5A",0)=X_U_DT_U_"BPS Log Conversion"
"RTN","BPS01P5A",92,0)
 ;
"RTN","BPS01P5A",93,0)
 ; Kill the top node of ^BPSECP if that is all there is left
"RTN","BPS01P5A",94,0)
 I $D(^BPSECP("LOG"))=1 K ^BPSECP("LOG")
"RTN","BPS01P5A",95,0)
 Q
"RTN","BPS01P5A",96,0)
 ;
"RTN","BPS01P5A",97,0)
LOG(X) ; Create or find slot in BPS LOG
"RTN","BPS01P5A",98,0)
 N DIC,DLAYGO,Y
"RTN","BPS01P5A",99,0)
 S DIC=9002313.12,DIC(0)="LBO",DLAYGO=DIC
"RTN","BPS01P5A",100,0)
 D ^DIC
"RTN","BPS01P5A",101,0)
 I Y=-1 S ^XTMP("BPS01P5A",3,X)=Y
"RTN","BPS01P5A",102,0)
 Q +Y
"RTN","BPS01P5A",103,0)
 ;
"RTN","BPS01P5A",104,0)
FILE1(LOGIEN,TXTIEN,PDTM,TXT) ; Create multiple entry
"RTN","BPS01P5A",105,0)
 N FN,FDA,MSG
"RTN","BPS01P5A",106,0)
 S FN=9002313.1201
"RTN","BPS01P5A",107,0)
 S FDA(FN,"+1,"_LOGIEN_",",.01)=PDTM
"RTN","BPS01P5A",108,0)
 S FDA(FN,"+1,"_LOGIEN_",",1)=$TR($E(TXT,1,200),"^","~")
"RTN","BPS01P5A",109,0)
 D UPDATE^DIE("","FDA","","MSG")
"RTN","BPS01P5A",110,0)
 I $D(MSG) S ^XTMP("BPS01P5A",4,LOGIEN,TXTIEN)=PDTM_U_TXT M ^XTMP("BPS01P5A",4,LOGIEN,"MSG")=MSG
"RTN","BPS01P5A",111,0)
 Q
"RTN","BPS01P5A",112,0)
 ;
"RTN","BPS01P5A",113,0)
FILE2(LOGIEN,PDTM) ; Update LAST UPDATE field with the last date
"RTN","BPS01P5A",114,0)
 N FDA,MSG,FN
"RTN","BPS01P5A",115,0)
 S FN=9002313.12
"RTN","BPS01P5A",116,0)
 S FDA(FN,LOGIEN_",",.02)=PDTM
"RTN","BPS01P5A",117,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPS01P5A",118,0)
 I $D(MSG) S ^XTMP("BPS01P5A",5,LOGIEN)=PDTM M ^XTMP("BPS01P5A",5,LOGIEN,"MSG")=MSG
"RTN","BPS01P5A",119,0)
 Q
"RTN","BPS01P5A",120,0)
 ;
"RTN","BPS01P5A",121,0)
CDT(X,PDT) ; Convert external date to internal
"RTN","BPS01P5A",122,0)
 ; If date evaluates to -Y, use default date (PDT)
"RTN","BPS01P5A",123,0)
 N %DT,Y
"RTN","BPS01P5A",124,0)
 S %DT="" D ^%DT
"RTN","BPS01P5A",125,0)
 I Y=-1 S Y=PDT
"RTN","BPS01P5A",126,0)
 Q Y
"RTN","BPS01P5A",127,0)
 ;
"RTN","BPS01P5A",128,0)
UP(X) ; Convert text to uppercase
"RTN","BPS01P5A",129,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPS01P5A",130,0)
 ;
"RTN","BPS01P5A",131,0)
 ;DELETE OBSOLETE FILES
"RTN","BPS01P5A",132,0)
 ;  For BPSCOMB and BPSEI, we need to delete each node manually 
"RTN","BPS01P5A",133,0)
 ;  to prevent global protection errors.
"RTN","BPS01P5A",134,0)
 ;
"RTN","BPS01P5A",135,0)
DEL N DIU,X
"RTN","BPS01P5A",136,0)
 ;
"RTN","BPS01P5A",137,0)
 ;Turn global protection off (SACC Exemption has been granted to use $ZU)
"RTN","BPS01P5A",138,0)
 S X=$ZU(68,28,0)
"RTN","BPS01P5A",139,0)
 ;
"RTN","BPS01P5A",140,0)
 ;Remove BPS COMBINED INSURANCE (#9002313.1), which uses an unsubscripted global 
"RTN","BPS01P5A",141,0)
 ;reference to store the data
"RTN","BPS01P5A",142,0)
 S DIU="^BPSCOMB(",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",143,0)
 ;
"RTN","BPS01P5A",144,0)
 ;Remove BPS INSURER (#9002313.4), which uses an unsubscripted global reference to store
"RTN","BPS01P5A",145,0)
 ;the data
"RTN","BPS01P5A",146,0)
 S DIU="^BPSEI(",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",147,0)
 ;
"RTN","BPS01P5A",148,0)
 ;Turn global protection back on
"RTN","BPS01P5A",149,0)
 S X=$ZU(68,28,1)
"RTN","BPS01P5A",150,0)
 ;
"RTN","BPS01P5A",151,0)
 ;BPS DATA INPUT (#9002313.51)
"RTN","BPS01P5A",152,0)
 S DIU="^BPS(9002313.51,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",153,0)
 ;
"RTN","BPS01P5A",154,0)
 ;BPS ORIGIN OF INPUT (#9002313.516)
"RTN","BPS01P5A",155,0)
 S DIU="^BPS(9002313.516,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",156,0)
 ;
"RTN","BPS01P5A",157,0)
 ;BPS DIALOUT (#9002313.55)
"RTN","BPS01P5A",158,0)
 S DIU="^BPS(9002313.55,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",159,0)
 ;
"RTN","BPS01P5A",160,0)
 ;BPS INPUT USER PREF (#9002313.515)
"RTN","BPS01P5A",161,0)
 S DIU="^BPS(9002313.515,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",162,0)
 ;
"RTN","BPS01P5A",163,0)
 ;BPS INSURANCE RULES (#9002313.94)
"RTN","BPS01P5A",164,0)
 S DIU="^BPSF(9002313.94,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",165,0)
 ;
"RTN","BPS01P5A",166,0)
 ;BPS PRICING TABLES (#9002313.53)
"RTN","BPS01P5A",167,0)
 S DIU="^BPS(9002313.53,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",168,0)
 ;
"RTN","BPS01P5A",169,0)
 ;BPS REPORT MASTER (#9002313.61)
"RTN","BPS01P5A",170,0)
 S DIU="^BPSECX(""RPT"",",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",171,0)
 ;
"RTN","BPS01P5A",172,0)
 ;BPS TRANSLATE (#9002313.81)
"RTN","BPS01P5A",173,0)
 S DIU="^BPSF(9002313.81,",DIU(0)="DS" D EN^DIU2
"RTN","BPS01P5A",174,0)
 ;
"RTN","BPS01P5A",175,0)
 K DIU,X
"RTN","BPS01P5A",176,0)
 ;
"RTN","BPS01P5A",177,0)
 Q
"RTN","BPS01P5A",178,0)
 ;
"RTN","BPS01P5A",179,0)
 ;BPS SETUP (#9002313.99)
"RTN","BPS01P5A",180,0)
99 N IEN
"RTN","BPS01P5A",181,0)
 ;
"RTN","BPS01P5A",182,0)
 S IEN=0 F  S IEN=$O(^BPS(9002313.99,IEN)) Q:'IEN  D
"RTN","BPS01P5A",183,0)
 .;
"RTN","BPS01P5A",184,0)
 .;'2' Node
"RTN","BPS01P5A",185,0)
 .K ^BPS(9002313.99,IEN,2)
"RTN","BPS01P5A",186,0)
 .;
"RTN","BPS01P5A",187,0)
 .;'BPSOS6*' Node
"RTN","BPS01P5A",188,0)
 .K ^BPS(9002313.99,IEN,"BPSOS6*")
"RTN","BPS01P5A",189,0)
 .;
"RTN","BPS01P5A",190,0)
 .;'BPSOSM1' Node
"RTN","BPS01P5A",191,0)
 .K ^BPS(9002313.99,IEN,"BPSOSM1")
"RTN","BPS01P5A",192,0)
 .;
"RTN","BPS01P5A",193,0)
 .;'BPSOSR1' Node
"RTN","BPS01P5A",194,0)
 .K ^BPS(9002313.99,IEN,"BPSOSR1")
"RTN","BPS01P5A",195,0)
 .;
"RTN","BPS01P5A",196,0)
 .;'BPSOSX' Node
"RTN","BPS01P5A",197,0)
 .K ^BPS(9002313.99,IEN,"BPSOSX")
"RTN","BPS01P5A",198,0)
 .;
"RTN","BPS01P5A",199,0)
 .;'A/R INTERFACE' Node
"RTN","BPS01P5A",200,0)
 .K ^BPS(9002313.99,IEN,"A/R INTERFACE")
"RTN","BPS01P5A",201,0)
 .;
"RTN","BPS01P5A",202,0)
 .;'BILLING' Node
"RTN","BPS01P5A",203,0)
 .K ^BPS(9002313.99,IEN,"BILLING")
"RTN","BPS01P5A",204,0)
 .;
"RTN","BPS01P5A",205,0)
 .;'BILLING - NEW' Node
"RTN","BPS01P5A",206,0)
 .K ^BPS(9002313.99,IEN,"BILLING - NEW")
"RTN","BPS01P5A",207,0)
 .;
"RTN","BPS01P5A",208,0)
 .;'BILLING LOG FILE' Node
"RTN","BPS01P5A",209,0)
 .K ^BPS(9002313.99,IEN,"BILLING LOG FILE")
"RTN","BPS01P5A",210,0)
 .;
"RTN","BPS01P5A",211,0)
 .;'CREATING A/R' Node
"RTN","BPS01P5A",212,0)
 .K ^BPS(9002313.99,IEN,"CREATING A/R")
"RTN","BPS01P5A",213,0)
 .;
"RTN","BPS01P5A",214,0)
 .;'DIAL-OUT DEFAULT' Node
"RTN","BPS01P5A",215,0)
 .K ^BPS(9002313.99,IEN,"DIAL-OUT DEFAULT")
"RTN","BPS01P5A",216,0)
 .;
"RTN","BPS01P5A",217,0)
 .;'EOB-SCREEN' Node
"RTN","BPS01P5A",218,0)
 .K ^BPS(9002313.99,IEN,"EOB-SCREEN")
"RTN","BPS01P5A",219,0)
 .;
"RTN","BPS01P5A",220,0)
 .;'FORMS - NCPDP' Node
"RTN","BPS01P5A",221,0)
 .K ^BPS(9002313.99,IEN,"FORMS - NCPDP")
"RTN","BPS01P5A",222,0)
 .;
"RTN","BPS01P5A",223,0)
 .;'FORMS - PREBILL' Node
"RTN","BPS01P5A",224,0)
 .K ^BPS(9002313.99,IEN,"FORMS - PREBILL")
"RTN","BPS01P5A",225,0)
 .;
"RTN","BPS01P5A",226,0)
 .;'INPUT' Node
"RTN","BPS01P5A",227,0)
 .K ^BPS(9002313.99,IEN,"INPUT")
"RTN","BPS01P5A",228,0)
 .;
"RTN","BPS01P5A",229,0)
 .;'INS' Node
"RTN","BPS01P5A",230,0)
 .K ^BPS(9002313.99,IEN,"INS")
"RTN","BPS01P5A",231,0)
 .;
"RTN","BPS01P5A",232,0)
 .;'INS BASE SCORES'
"RTN","BPS01P5A",233,0)
 .K ^BPS(9002313.99,IEN,"INS BASE SCORES")
"RTN","BPS01P5A",234,0)
 .;
"RTN","BPS01P5A",235,0)
 .;'INS RULES' Node
"RTN","BPS01P5A",236,0)
 .K ^BPS(9002313.99,IEN,"INS RULES")
"RTN","BPS01P5A",237,0)
 .;
"RTN","BPS01P5A",238,0)
 .;'NULL FILE' Node
"RTN","BPS01P5A",239,0)
 .K ^BPS(9002313.99,IEN,"NULL FILE")
"RTN","BPS01P5A",240,0)
 .;
"RTN","BPS01P5A",241,0)
 .;'OUTSIDE LINE' Node
"RTN","BPS01P5A",242,0)
 .K ^BPS(9002313.99,IEN,"OUTSIDE LINE")
"RTN","BPS01P5A",243,0)
 .;
"RTN","BPS01P5A",244,0)
 .;'POSTAGE' Node
"RTN","BPS01P5A",245,0)
 .K ^BPS(9002313.99,IEN,"POSTAGE")
"RTN","BPS01P5A",246,0)
 .;
"RTN","BPS01P5A",247,0)
 .;'RX A/R TYPE' Node
"RTN","BPS01P5A",248,0)
 .K ^BPS(9002313.99,IEN,"RX A/R TYPE")
"RTN","BPS01P5A",249,0)
 .;
"RTN","BPS01P5A",250,0)
 .;'RECEIPT' Node
"RTN","BPS01P5A",251,0)
 .K ^BPS(9002313.99,IEN,"RECEIPT")
"RTN","BPS01P5A",252,0)
 .;
"RTN","BPS01P5A",253,0)
 .;'SPECIAL' Node
"RTN","BPS01P5A",254,0)
 .K ^BPS(9002313.99,IEN,"SPECIAL")
"RTN","BPS01P5A",255,0)
 .;
"RTN","BPS01P5A",256,0)
 .;'STARTUP' Node
"RTN","BPS01P5A",257,0)
 .K ^BPS(9002313.99,IEN,"STARTUP")
"RTN","BPS01P5A",258,0)
 .;
"RTN","BPS01P5A",259,0)
 .;'UNBILLABLE NDC #' Node
"RTN","BPS01P5A",260,0)
 .K ^BPS(9002313.99,IEN,"UNBILLABLE NDC #")
"RTN","BPS01P5A",261,0)
 .;
"RTN","BPS01P5A",262,0)
 .;'UNBILLABLE DRUG NAME' Node
"RTN","BPS01P5A",263,0)
 .K ^BPS(9002313.99,IEN,"UNBILLABLE DRUG NAME")
"RTN","BPS01P5A",264,0)
 .;
"RTN","BPS01P5A",265,0)
 .;'UNBILLABLE OTC' Node
"RTN","BPS01P5A",266,0)
 .K ^BPS(9002313.99,IEN,"UNBILLABLE OTC")
"RTN","BPS01P5A",267,0)
 .;
"RTN","BPS01P5A",268,0)
 .;'WRITEOFF-SCREEN' Node
"RTN","BPS01P5A",269,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN")
"RTN","BPS01P5A",270,0)
 .;
"RTN","BPS01P5A",271,0)
 .;'WRITEOFF-SCREEN ARTYPE' Node
"RTN","BPS01P5A",272,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN ARTYPE")
"RTN","BPS01P5A",273,0)
 .;
"RTN","BPS01P5A",274,0)
 .;'WRITEOFF-SCREEN BATCH' Node
"RTN","BPS01P5A",275,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN BATCH")
"RTN","BPS01P5A",276,0)
 .;
"RTN","BPS01P5A",277,0)
 .;'WRITEOFF-SCREEN CLINIC' Node
"RTN","BPS01P5A",278,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN CLINIC")
"RTN","BPS01P5A",279,0)
 .;
"RTN","BPS01P5A",280,0)
 .;'WRITEOFF-SCREEN DIAG' Node
"RTN","BPS01P5A",281,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN DIAG")
"RTN","BPS01P5A",282,0)
 .;
"RTN","BPS01P5A",283,0)
 .;'WRITEOFF-SCREEN INSURER' Node
"RTN","BPS01P5A",284,0)
 .K ^BPS(9002313.99,IEN,"WRITEOFF-SCREEN INSURER")
"RTN","BPS01P5A",285,0)
 .;
"RTN","BPS01P5A",286,0)
 .;'WINNOW' Node
"RTN","BPS01P5A",287,0)
 .N X
"RTN","BPS01P5A",288,0)
 .S X=$P($G(^BPS(9002313.99,IEN,"WINNOW")),U)
"RTN","BPS01P5A",289,0)
 .I X'=0,X'=1 S X=$P($G(^BPS(9002313.99,IEN,"WINNOW TESTING")),U),X=$S(X=1:1,1:0)
"RTN","BPS01P5A",290,0)
 .S ^BPS(9002313.99,IEN,"WINNOW")=X_"^^365"
"RTN","BPS01P5A",291,0)
 .K X
"RTN","BPS01P5A",292,0)
 .;
"RTN","BPS01P5A",293,0)
 .;'WINNOW TESTING' Node
"RTN","BPS01P5A",294,0)
 .K ^BPS(9002313.99,IEN,"WINNOW TESTING")
"RTN","BPS01P5A",295,0)
 .;
"RTN","BPS01P5A",296,0)
 .;'WINNOW LOG' Node
"RTN","BPS01P5A",297,0)
 .K ^BPS(9002313.99,IEN,"WINNOW LOG")
"RTN","BPS01P5A",298,0)
 .;
"RTN","BPS01P5A",299,0)
 .;'WORKERS COMP' Node
"RTN","BPS01P5A",300,0)
 .K ^BPS(9002313.99,IEN,"WORKERS COMP")
"RTN","BPS01P5A",301,0)
 .;
"RTN","BPS01P5A",302,0)
 .;'WRITE OFF INSURER' Node
"RTN","BPS01P5A",303,0)
 .K ^BPS(9002313.99,IEN,"WRITE OFF INSURER")
"RTN","BPS01P5A",304,0)
 .;
"RTN","BPS01P5A",305,0)
 .;'WRITE OFF SELF PAY' Node
"RTN","BPS01P5A",306,0)
 .K ^BPS(9002313.99,IEN,"WRITE OFF SELF PAY")
"RTN","BPS01P5A",307,0)
 .;
"RTN","BPS01P5A",308,0)
 .;'NCPDP51' Node
"RTN","BPS01P5A",309,0)
 .K ^BPS(9002313.99,IEN,"NCPDP51")
"RTN","BPS01P5A",310,0)
 .;
"RTN","BPS01P5A",311,0)
 .;'WINNOW LOGS' Node
"RTN","BPS01P5A",312,0)
 .K ^BPS(9002313.99,IEN,"WINNOW LOGS")
"RTN","BPS01P5A",313,0)
 ;
"RTN","BPS01P5A",314,0)
 K IEN
"RTN","BPS01P5A",315,0)
 ;
"RTN","BPS01P5A",316,0)
 Q
"RTN","BPS01P5B")
0^199^B78865684
"RTN","BPS01P5B",1,0)
BPS01P5B ;BHAM ISC/BEE - Post-Install for BPS*1*5 (cont) ;13-DEC-06
"RTN","BPS01P5B",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPS01P5B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPS01P5B",4,0)
 ;
"RTN","BPS01P5B",5,0)
 Q
"RTN","BPS01P5B",6,0)
 ;
"RTN","BPS01P5B",7,0)
 ; Called by the BPS*1.0*5 Post-Install routine BPS01P5.
"RTN","BPS01P5B",8,0)
 ;
"RTN","BPS01P5B",9,0)
EN N DA,DIK,F,FILE,FIELD,FLDNUM,IFLD,XEC
"RTN","BPS01P5B",10,0)
 F F=2,201,31,56,56011,57,58,59,6,91,9102,99,9902,9903,9905,9904,992271,992273,992274,992279,9901,992388,992389 S FILE=$P($T(@F),";",3) F IFLD=1:1 S FLDNUM=$P($T(@F+IFLD),";",3) Q:FLDNUM="END"  D
"RTN","BPS01P5B",11,0)
 .I FLDNUM]"" S DIK="^DD("_FILE_",",DA=FLDNUM,DA(1)=FILE D ^DIK
"RTN","BPS01P5B",12,0)
 .S XEC=$P($T(@F+IFLD),";",4) I XEC]"" X XEC
"RTN","BPS01P5B",13,0)
 Q
"RTN","BPS01P5B",14,0)
 ;
"RTN","BPS01P5B",15,0)
 ;BPS CLAIMS (#9002313.02)
"RTN","BPS01P5B",16,0)
2 ;;9002313.02
"RTN","BPS01P5B",17,0)
 ;;1.02
"RTN","BPS01P5B",18,0)
 ;;1.03
"RTN","BPS01P5B",19,0)
 ;;308
"RTN","BPS01P5B",20,0)
 ;;315
"RTN","BPS01P5B",21,0)
 ;;316
"RTN","BPS01P5B",22,0)
 ;;317
"RTN","BPS01P5B",23,0)
 ;;318
"RTN","BPS01P5B",24,0)
 ;;319
"RTN","BPS01P5B",25,0)
 ;;320
"RTN","BPS01P5B",26,0)
 ;;327
"RTN","BPS01P5B",27,0)
 ;;329
"RTN","BPS01P5B",28,0)
 ;;498.09
"RTN","BPS01P5B",29,0)
 ;;END
"RTN","BPS01P5B",30,0)
 ;
"RTN","BPS01P5B",31,0)
 ;BPS CLAIMS - Medication(s) (#9002313.0201)
"RTN","BPS01P5B",32,0)
201 ;;9002313.0201
"RTN","BPS01P5B",33,0)
 ;;.02
"RTN","BPS01P5B",34,0)
 ;;404
"RTN","BPS01P5B",35,0)
 ;;410
"RTN","BPS01P5B",36,0)
 ;;416
"RTN","BPS01P5B",37,0)
 ;;422
"RTN","BPS01P5B",38,0)
 ;;425
"RTN","BPS01P5B",39,0)
 ;;428
"RTN","BPS01P5B",40,0)
 ;;432
"RTN","BPS01P5B",41,0)
 ;;437
"RTN","BPS01P5B",42,0)
 ;;439
"RTN","BPS01P5B",43,0)
 ;;440
"RTN","BPS01P5B",44,0)
 ;;441
"RTN","BPS01P5B",45,0)
 ;;END
"RTN","BPS01P5B",46,0)
 ;
"RTN","BPS01P5B",47,0)
 ;BPS CERTIFICATION (#9002313.31)
"RTN","BPS01P5B",48,0)
31 ;;9002313.31
"RTN","BPS01P5B",49,0)
 ;;.05
"RTN","BPS01P5B",50,0)
 ;;901
"RTN","BPS01P5B",51,0)
 ;;END
"RTN","BPS01P5B",52,0)
 ;
"RTN","BPS01P5B",53,0)
 ;BPS PHARMACIES (#9002313.56)
"RTN","BPS01P5B",54,0)
56 ;;9002313.56
"RTN","BPS01P5B",55,0)
 ;;.04
"RTN","BPS01P5B",56,0)
 ;;.05
"RTN","BPS01P5B",57,0)
 ;;.06
"RTN","BPS01P5B",58,0)
 ;;.07
"RTN","BPS01P5B",59,0)
 ;;3001.01
"RTN","BPS01P5B",60,0)
 ;;3001.02
"RTN","BPS01P5B",61,0)
 ;;END
"RTN","BPS01P5B",62,0)
 ;
"RTN","BPS01P5B",63,0)
 ;BPS PHARMACIES - PRESCRIBER (#9002313.56011) - Field 1 In OUTPATIENT SITE Multiple
"RTN","BPS01P5B",64,0)
56011 ;;9002313.56011
"RTN","BPS01P5B",65,0)
 ;;;N DIU S DIU=9002313.56011,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",66,0)
 ;;END
"RTN","BPS01P5B",67,0)
 ;
"RTN","BPS01P5B",68,0)
 ;BPS LOG OF TRANSACTIONS (#9002313.57)
"RTN","BPS01P5B",69,0)
57 ;;9002313.57
"RTN","BPS01P5B",70,0)
 ;;.13
"RTN","BPS01P5B",71,0)
 ;;.14
"RTN","BPS01P5B",72,0)
 ;;.15
"RTN","BPS01P5B",73,0)
 ;;.16
"RTN","BPS01P5B",74,0)
 ;;1.05
"RTN","BPS01P5B",75,0)
 ;;1.06
"RTN","BPS01P5B",76,0)
 ;;1.14
"RTN","BPS01P5B",77,0)
 ;;8
"RTN","BPS01P5B",78,0)
 ;;8.0099
"RTN","BPS01P5B",79,0)
 ;;12
"RTN","BPS01P5B",80,0)
 ;;16
"RTN","BPS01P5B",81,0)
 ;;301
"RTN","BPS01P5B",82,0)
 ;;302
"RTN","BPS01P5B",83,0)
 ;;403
"RTN","BPS01P5B",84,0)
 ;;506
"RTN","BPS01P5B",85,0)
 ;;601
"RTN","BPS01P5B",86,0)
 ;;602
"RTN","BPS01P5B",87,0)
 ;;603
"RTN","BPS01P5B",88,0)
 ;;701
"RTN","BPS01P5B",89,0)
 ;;702
"RTN","BPS01P5B",90,0)
 ;;703
"RTN","BPS01P5B",91,0)
 ;;802
"RTN","BPS01P5B",92,0)
 ;;END
"RTN","BPS01P5B",93,0)
 ;
"RTN","BPS01P5B",94,0)
 ;BPS STATISTICS (#9002313.58)
"RTN","BPS01P5B",95,0)
58 ;;9002313.58
"RTN","BPS01P5B",96,0)
 ;;301
"RTN","BPS01P5B",97,0)
 ;;302
"RTN","BPS01P5B",98,0)
 ;;402
"RTN","BPS01P5B",99,0)
 ;;403
"RTN","BPS01P5B",100,0)
 ;;404
"RTN","BPS01P5B",101,0)
 ;;405
"RTN","BPS01P5B",102,0)
 ;;406
"RTN","BPS01P5B",103,0)
 ;;407
"RTN","BPS01P5B",104,0)
 ;;408
"RTN","BPS01P5B",105,0)
 ;;409
"RTN","BPS01P5B",106,0)
 ;;411
"RTN","BPS01P5B",107,0)
 ;;412
"RTN","BPS01P5B",108,0)
 ;;413
"RTN","BPS01P5B",109,0)
 ;;414
"RTN","BPS01P5B",110,0)
 ;;415
"RTN","BPS01P5B",111,0)
 ;;419
"RTN","BPS01P5B",112,0)
 ;;501
"RTN","BPS01P5B",113,0)
 ;;601
"RTN","BPS01P5B",114,0)
 ;;602
"RTN","BPS01P5B",115,0)
 ;;603
"RTN","BPS01P5B",116,0)
 ;;604
"RTN","BPS01P5B",117,0)
 ;;701
"RTN","BPS01P5B",118,0)
 ;;702
"RTN","BPS01P5B",119,0)
 ;;703
"RTN","BPS01P5B",120,0)
 ;;704
"RTN","BPS01P5B",121,0)
 ;;705
"RTN","BPS01P5B",122,0)
 ;;709
"RTN","BPS01P5B",123,0)
 ;;719
"RTN","BPS01P5B",124,0)
 ;;801
"RTN","BPS01P5B",125,0)
 ;;802
"RTN","BPS01P5B",126,0)
 ;;803
"RTN","BPS01P5B",127,0)
 ;;804
"RTN","BPS01P5B",128,0)
 ;;809
"RTN","BPS01P5B",129,0)
 ;;901
"RTN","BPS01P5B",130,0)
 ;;902
"RTN","BPS01P5B",131,0)
 ;;903
"RTN","BPS01P5B",132,0)
 ;;904
"RTN","BPS01P5B",133,0)
 ;;909
"RTN","BPS01P5B",134,0)
 ;;1001
"RTN","BPS01P5B",135,0)
 ;;1002
"RTN","BPS01P5B",136,0)
 ;;1101
"RTN","BPS01P5B",137,0)
 ;;1102
"RTN","BPS01P5B",138,0)
 ;;1103
"RTN","BPS01P5B",139,0)
 ;;END
"RTN","BPS01P5B",140,0)
 ;
"RTN","BPS01P5B",141,0)
 ;BPS TRANSACTION (#9002313.59)
"RTN","BPS01P5B",142,0)
59 ;;9002313.59
"RTN","BPS01P5B",143,0)
 ;;.13
"RTN","BPS01P5B",144,0)
 ;;.14
"RTN","BPS01P5B",145,0)
 ;;.15
"RTN","BPS01P5B",146,0)
 ;;.16
"RTN","BPS01P5B",147,0)
 ;;1.05
"RTN","BPS01P5B",148,0)
 ;;1.06
"RTN","BPS01P5B",149,0)
 ;;1.14
"RTN","BPS01P5B",150,0)
 ;;8
"RTN","BPS01P5B",151,0)
 ;;8.0099
"RTN","BPS01P5B",152,0)
 ;;12
"RTN","BPS01P5B",153,0)
 ;;16
"RTN","BPS01P5B",154,0)
 ;;301
"RTN","BPS01P5B",155,0)
 ;;302
"RTN","BPS01P5B",156,0)
 ;;403
"RTN","BPS01P5B",157,0)
 ;;506
"RTN","BPS01P5B",158,0)
 ;;601
"RTN","BPS01P5B",159,0)
 ;;602
"RTN","BPS01P5B",160,0)
 ;;603
"RTN","BPS01P5B",161,0)
 ;;701
"RTN","BPS01P5B",162,0)
 ;;702
"RTN","BPS01P5B",163,0)
 ;;703
"RTN","BPS01P5B",164,0)
 ;;802
"RTN","BPS01P5B",165,0)
 ;;END
"RTN","BPS01P5B",166,0)
 ;
"RTN","BPS01P5B",167,0)
 ;BPS PHARMACIES - INSURER-ASSIGNED # (#9002313.6)/Field 950
"RTN","BPS01P5B",168,0)
6 ;;9002313.6
"RTN","BPS01P5B",169,0)
 ;;;N DIU S DIU=9002313.6,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",170,0)
 ;;END
"RTN","BPS01P5B",171,0)
 ;
"RTN","BPS01P5B",172,0)
 ;BPS NCPDP FIELD DEFS (#9002313.91)
"RTN","BPS01P5B",173,0)
91 ;;9002313.91
"RTN","BPS01P5B",174,0)
 ;;.02
"RTN","BPS01P5B",175,0)
 ;;.05
"RTN","BPS01P5B",176,0)
 ;;END
"RTN","BPS01P5B",177,0)
 ;
"RTN","BPS01P5B",178,0)
 ;BPS NCPDP FIELD DEFS - FORMAT CODE (#9002313.9102)/Field 20
"RTN","BPS01P5B",179,0)
9102 ;;9002313.9102
"RTN","BPS01P5B",180,0)
 ;;;N DIU S DIU=9002313.9102,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",181,0)
 ;;END
"RTN","BPS01P5B",182,0)
 ;
"RTN","BPS01P5B",183,0)
 ;BPS SETUP (#9002313.99)
"RTN","BPS01P5B",184,0)
99 ;;9002313.99
"RTN","BPS01P5B",185,0)
 ;;2.01
"RTN","BPS01P5B",186,0)
 ;;115.01
"RTN","BPS01P5B",187,0)
 ;;115.02
"RTN","BPS01P5B",188,0)
 ;;119.01
"RTN","BPS01P5B",189,0)
 ;;119.02
"RTN","BPS01P5B",190,0)
 ;;119.03
"RTN","BPS01P5B",191,0)
 ;;119.04
"RTN","BPS01P5B",192,0)
 ;;119.05
"RTN","BPS01P5B",193,0)
 ;;120.01
"RTN","BPS01P5B",194,0)
 ;;120.02
"RTN","BPS01P5B",195,0)
 ;;120.03
"RTN","BPS01P5B",196,0)
 ;;120.04
"RTN","BPS01P5B",197,0)
 ;;120.05
"RTN","BPS01P5B",198,0)
 ;;120.06
"RTN","BPS01P5B",199,0)
 ;;120.07
"RTN","BPS01P5B",200,0)
 ;;140.01
"RTN","BPS01P5B",201,0)
 ;;140.02
"RTN","BPS01P5B",202,0)
 ;;140.03
"RTN","BPS01P5B",203,0)
 ;;170.01
"RTN","BPS01P5B",204,0)
 ;;230.01
"RTN","BPS01P5B",205,0)
 ;;235.01
"RTN","BPS01P5B",206,0)
 ;;235.02
"RTN","BPS01P5B",207,0)
 ;;235.03
"RTN","BPS01P5B",208,0)
 ;;235.04
"RTN","BPS01P5B",209,0)
 ;;235.05
"RTN","BPS01P5B",210,0)
 ;;235.06
"RTN","BPS01P5B",211,0)
 ;;235.07
"RTN","BPS01P5B",212,0)
 ;;370.01
"RTN","BPS01P5B",213,0)
 ;;370.02
"RTN","BPS01P5B",214,0)
 ;;370.03
"RTN","BPS01P5B",215,0)
 ;;440.01
"RTN","BPS01P5B",216,0)
 ;;577.01
"RTN","BPS01P5B",217,0)
 ;;577.02
"RTN","BPS01P5B",218,0)
 ;;577.03
"RTN","BPS01P5B",219,0)
 ;;577.04
"RTN","BPS01P5B",220,0)
 ;;577.05
"RTN","BPS01P5B",221,0)
 ;;665.01
"RTN","BPS01P5B",222,0)
 ;;665.02
"RTN","BPS01P5B",223,0)
 ;;665.03
"RTN","BPS01P5B",224,0)
 ;;665.04
"RTN","BPS01P5B",225,0)
 ;;667.01
"RTN","BPS01P5B",226,0)
 ;;667.02
"RTN","BPS01P5B",227,0)
 ;;941
"RTN","BPS01P5B",228,0)
 ;;942
"RTN","BPS01P5B",229,0)
 ;;943
"RTN","BPS01P5B",230,0)
 ;;951
"RTN","BPS01P5B",231,0)
 ;;952
"RTN","BPS01P5B",232,0)
 ;;953
"RTN","BPS01P5B",233,0)
 ;;960.01
"RTN","BPS01P5B",234,0)
 ;;960.02
"RTN","BPS01P5B",235,0)
 ;;960.03
"RTN","BPS01P5B",236,0)
 ;;960.04
"RTN","BPS01P5B",237,0)
 ;;960.05
"RTN","BPS01P5B",238,0)
 ;;1490
"RTN","BPS01P5B",239,0)
 ;;1501
"RTN","BPS01P5B",240,0)
 ;;1660.01
"RTN","BPS01P5B",241,0)
 ;;1801
"RTN","BPS01P5B",242,0)
 ;;1811.01
"RTN","BPS01P5B",243,0)
 ;;1960.01
"RTN","BPS01P5B",244,0)
 ;;1960.02
"RTN","BPS01P5B",245,0)
 ;;1960.03
"RTN","BPS01P5B",246,0)
 ;;1980.01
"RTN","BPS01P5B",247,0)
 ;;2128.13
"RTN","BPS01P5B",248,0)
 ;;2270.01
"RTN","BPS01P5B",249,0)
 ;;2270.02
"RTN","BPS01P5B",250,0)
 ;;2270.03
"RTN","BPS01P5B",251,0)
 ;;2270.04
"RTN","BPS01P5B",252,0)
 ;;2270.05
"RTN","BPS01P5B",253,0)
 ;;2270.06
"RTN","BPS01P5B",254,0)
 ;;2270.11
"RTN","BPS01P5B",255,0)
 ;;2270.12
"RTN","BPS01P5B",256,0)
 ;;2270.7
"RTN","BPS01P5B",257,0)
 ;;2270.8
"RTN","BPS01P5B",258,0)
 ;;2270.9
"RTN","BPS01P5B",259,0)
 ;;2272.01
"RTN","BPS01P5B",260,0)
 ;;2341.02
"RTN","BPS01P5B",261,0)
 ;;2341.04
"RTN","BPS01P5B",262,0)
 ;;2341.05
"RTN","BPS01P5B",263,0)
 ;;2341.06
"RTN","BPS01P5B",264,0)
 ;;2341.07
"RTN","BPS01P5B",265,0)
 ;;2341.08
"RTN","BPS01P5B",266,0)
 ;;2341.09
"RTN","BPS01P5B",267,0)
 ;;2341.1
"RTN","BPS01P5B",268,0)
 ;;2341.11
"RTN","BPS01P5B",269,0)
 ;;2342.01
"RTN","BPS01P5B",270,0)
 ;;2342.02
"RTN","BPS01P5B",271,0)
 ;;2342.03
"RTN","BPS01P5B",272,0)
 ;;2343.01
"RTN","BPS01P5B",273,0)
 ;;5151
"RTN","BPS01P5B",274,0)
 ;;END
"RTN","BPS01P5B",275,0)
 ;
"RTN","BPS01P5B",276,0)
 ;BPS SETUP - BILLING LOG FILE (#9002313.9902)/Field 240
"RTN","BPS01P5B",277,0)
9902 ;;9002313.9902
"RTN","BPS01P5B",278,0)
 ;;;N DIU S DIU=9002313.9902,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",279,0)
 ;;END
"RTN","BPS01P5B",280,0)
 ;
"RTN","BPS01P5B",281,0)
 ;BPS SETUP - INS RULE ORDER (#9002313.9903)/Field 970.01
"RTN","BPS01P5B",282,0)
9903 ;;9002313.9903
"RTN","BPS01P5B",283,0)
 ;;;N DIU S DIU=9002313.9903,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",284,0)
 ;;END
"RTN","BPS01P5B",285,0)
 ;
"RTN","BPS01P5B",286,0)
 ;BPS SETUP - UNBILLABLE NDC # (#9002313.9905)/Field 2128.11
"RTN","BPS01P5B",287,0)
9905 ;;9002313.9905
"RTN","BPS01P5B",288,0)
 ;;;N DIU S DIU=9002313.9905,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",289,0)
 ;;END
"RTN","BPS01P5B",290,0)
 ;
"RTN","BPS01P5B",291,0)
 ;BPS SETUP - UNBILLABLE DRUG NAME (#9002313.9904)/Field 2128.12
"RTN","BPS01P5B",292,0)
9904 ;;9002313.9904
"RTN","BPS01P5B",293,0)
 ;;;N DIU S DIU=9002313.9904,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",294,0)
 ;;END
"RTN","BPS01P5B",295,0)
 ;
"RTN","BPS01P5B",296,0)
 ;BPS SETUP - WO ARTYPE (#9002313.992271)/Field 2271
"RTN","BPS01P5B",297,0)
992271 ;;9002313.992271
"RTN","BPS01P5B",298,0)
 ;;;N DIU S DIU=9002313.992271,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",299,0)
 ;;END
"RTN","BPS01P5B",300,0)
 ;
"RTN","BPS01P5B",301,0)
 ;BPS SETUP - WO CLINIC (#9002313.992273)/Field 2273
"RTN","BPS01P5B",302,0)
992273 ;;9002313.992273
"RTN","BPS01P5B",303,0)
 ;;;N DIU S DIU=9002313.992273,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",304,0)
 ;;END
"RTN","BPS01P5B",305,0)
 ;
"RTN","BPS01P5B",306,0)
 ;BPS SETUP - WO DIAG (#9002313.992274)/Field 2274
"RTN","BPS01P5B",307,0)
992274 ;;9002313.992274
"RTN","BPS01P5B",308,0)
 ;;;N DIU S DIU=9002313.992274,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",309,0)
 ;;END
"RTN","BPS01P5B",310,0)
 ;
"RTN","BPS01P5B",311,0)
 ;BPS SETUP - WO INSURER (#9002313.992279)/Field 2279
"RTN","BPS01P5B",312,0)
992279 ;;9002313.992279
"RTN","BPS01P5B",313,0)
 ;;;N DIU S DIU=9002313.992279,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",314,0)
 ;;END
"RTN","BPS01P5B",315,0)
 ;
"RTN","BPS01P5B",316,0)
 ;BPS SETUP - WORKERS COMP (#9002313.9901)/Field 2380
"RTN","BPS01P5B",317,0)
9901 ;;9002313.9901
"RTN","BPS01P5B",318,0)
 ;;;N DIU S DIU=9002313.9901,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",319,0)
 ;;END
"RTN","BPS01P5B",320,0)
 ;
"RTN","BPS01P5B",321,0)
 ;BPS SETUP - WRITE OFF INSURER (#9002313.992388)/Field 2388
"RTN","BPS01P5B",322,0)
992388 ;;9002313.992388
"RTN","BPS01P5B",323,0)
 ;;;N DIU S DIU=9002313.992388,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",324,0)
 ;;END
"RTN","BPS01P5B",325,0)
 ;
"RTN","BPS01P5B",326,0)
 ;BPS SETUP - WRITE OFF SELF PAY (#9002313.992389)/Field 2389
"RTN","BPS01P5B",327,0)
992389 ;;9002313.992389
"RTN","BPS01P5B",328,0)
 ;;;N DIU S DIU=9002313.992389,DIU(0)="DS" D EN^DIU2 K DIU
"RTN","BPS01P5B",329,0)
 ;;END
"RTN","BPS01P5B",330,0)
 ;
"RTN","BPS01P5B",331,0)
 ; STAT - This procedure will adjust the Statistics buckets.
"RTN","BPS01P5B",332,0)
 ;  It should move some claims from the OTHER bucket to the Accepted
"RTN","BPS01P5B",333,0)
 ;    Reversal bucket
"RTN","BPS01P5B",334,0)
 ;  It should move claims from the REJECTED bucket to the Rejected
"RTN","BPS01P5B",335,0)
 ;    Reversal bucket
"RTN","BPS01P5B",336,0)
 ;
"RTN","BPS01P5B",337,0)
STAT ; EP - BPS01P5
"RTN","BPS01P5B",338,0)
 ; Initialize variables
"RTN","BPS01P5B",339,0)
 N RESPDT,RESPIEN,POS,REV,RESP,PIECE,RESP1
"RTN","BPS01P5B",340,0)
 N CLOSEDT,CLAIMIEN,DROP
"RTN","BPS01P5B",341,0)
 F PIECE=2:1:8,19 S $P(RESP1,U,PIECE)=0
"RTN","BPS01P5B",342,0)
 ;
"RTN","BPS01P5B",343,0)
 ; Get date when stats were last cleared
"RTN","BPS01P5B",344,0)
 ;   If missing, set to 1/1/2001, which preceeds initial ECME install
"RTN","BPS01P5B",345,0)
 ;   Subtract one second for starting time of loop
"RTN","BPS01P5B",346,0)
 S RESPDT=$$GET1^DIQ(9002313.58,1,2,"I")
"RTN","BPS01P5B",347,0)
 I RESPDT="" S RESPDT=3010101
"RTN","BPS01P5B",348,0)
 S RESPDT=$$FMADD^XLFDT(RESPDT,0,0,0,-1)
"RTN","BPS01P5B",349,0)
 S CLOSEDT=RESPDT
"RTN","BPS01P5B",350,0)
 ;
"RTN","BPS01P5B",351,0)
 ; Loop trough BPS Response starting with Zero-Out Date,
"RTN","BPS01P5B",352,0)
 ;   get response and update counters
"RTN","BPS01P5B",353,0)
 F  S RESPDT=$O(^BPSR("AE",RESPDT)) Q:RESPDT=""  D
"RTN","BPS01P5B",354,0)
 . S RESPIEN=""  F  S RESPIEN=$O(^BPSR("AE",RESPDT,RESPIEN)) Q:RESPIEN=""  D
"RTN","BPS01P5B",355,0)
 .. S POS=$O(^BPSR(RESPIEN,1000,0))
"RTN","BPS01P5B",356,0)
 .. I POS="" Q
"RTN","BPS01P5B",357,0)
 .. S REV=$$GET1^DIQ(9002313.03,RESPIEN,103)="B2"
"RTN","BPS01P5B",358,0)
 .. S RESP=$$GET1^DIQ(9002313.0301,POS_","_RESPIEN,501,"I")
"RTN","BPS01P5B",359,0)
 .. S PIECE=$S(RESP="R"&REV:7,RESP="R":2,RESP="P":3,RESP="D":4,RESP="C":5,RESP="A":6,1:19)
"RTN","BPS01P5B",360,0)
 .. S $P(RESP1,U,PIECE)=$P(RESP1,U,PIECE)+1
"RTN","BPS01P5B",361,0)
 ;
"RTN","BPS01P5B",362,0)
 ; Loop through Closed Date cross-reference of BPS Claims starting
"RTN","BPS01P5B",363,0)
 ;   with Zero-Out Date and update Dropped to Paper bucket
"RTN","BPS01P5B",364,0)
 F  S CLOSEDT=$O(^BPSC("AG",CLOSEDT)) Q:CLOSEDT=""  D
"RTN","BPS01P5B",365,0)
 . S CLAIMIEN=""  F  S CLAIMIEN=$O(^BPSC("AG",CLOSEDT,CLAIMIEN)) Q:CLAIMIEN=""  D
"RTN","BPS01P5B",366,0)
 .. S DROP=$$GET1^DIQ(9002313.02,CLAIMIEN,905,"I")
"RTN","BPS01P5B",367,0)
 .. I DROP="D" S $P(RESP1,U,8)=$P(RESP1,U,8)+1
"RTN","BPS01P5B",368,0)
 ;
"RTN","BPS01P5B",369,0)
 ; Set up XTMP global
"RTN","BPS01P5B",370,0)
 N X,X1,X2
"RTN","BPS01P5B",371,0)
 S X1=DT,X2=60 D C^%DTC
"RTN","BPS01P5B",372,0)
 S ^XTMP("BPS01P5B",0)=X_U_DT_U_"BPS Stats Update"
"RTN","BPS01P5B",373,0)
 M ^XTMP("BPS01P5B","STATS")=^BPSECX("S",1)
"RTN","BPS01P5B",374,0)
 ;
"RTN","BPS01P5B",375,0)
 ; Save off old stats and reset stats
"RTN","BPS01P5B",376,0)
 L +^BPSECX("S",1,"R"):5
"RTN","BPS01P5B",377,0)
 S $P(^BPSECX("S",1,"R"),U,2,8)=$P(RESP1,U,2,8)
"RTN","BPS01P5B",378,0)
 S $P(^BPSECX("S",1,"R"),U,19)=$P(RESP1,U,19)
"RTN","BPS01P5B",379,0)
 L -^BPSECX("S",1,"R")
"RTN","BPS01P5B",380,0)
 Q
"RTN","BPS01P5B",381,0)
 ;
"RTN","BPS01P5B",382,0)
 ; SUBMIT - Move Submit Date/Time from submit queue to
"RTN","BPS01P5B",383,0)
 ;   BPS Transaction
"RTN","BPS01P5B",384,0)
SUBMIT ;
"RTN","BPS01P5B",385,0)
 ; Initialize variables
"RTN","BPS01P5B",386,0)
 N RXI,RXR,IEN59,SUBDT
"RTN","BPS01P5B",387,0)
 ;
"RTN","BPS01P5B",388,0)
 ; Get RX/Fill from submit queue
"RTN","BPS01P5B",389,0)
 S RXI=""
"RTN","BPS01P5B",390,0)
 F  S RXI=$O(^XTMP("BPSOSRX",RXI)) Q:RXI=""  D
"RTN","BPS01P5B",391,0)
 . S RXR="" F  S RXR=$O(^XTMP("BPSOSRX",RXI,RXR)) Q:RXR=""  D
"RTN","BPS01P5B",392,0)
 .. ; Calculate IEN59
"RTN","BPS01P5B",393,0)
 .. S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPS01P5B",394,0)
 .. ; If no IEN59 or zero node not defined, quit
"RTN","BPS01P5B",395,0)
 .. I IEN59="" Q
"RTN","BPS01P5B",396,0)
 .. I '$D(^BPST(IEN59,0)) Q
"RTN","BPS01P5B",397,0)
 .. ; Get submit date and quit if not there
"RTN","BPS01P5B",398,0)
 .. S SUBDT=$G(^XTMP("BPSOSRX",RXI,RXR))
"RTN","BPS01P5B",399,0)
 .. I SUBDT="" Q
"RTN","BPS01P5B",400,0)
 .. ; If not processed yet, quit
"RTN","BPS01P5B",401,0)
 .. I $D(^XTMP("BPS-PROC","CLAIM",RXI,RXR)) Q
"RTN","BPS01P5B",402,0)
 .. I $D(^XTMP("BPS-PROC","UNCLAIM",RXI,RXR)) Q
"RTN","BPS01P5B",403,0)
 .. ; Store in BPS Transaction
"RTN","BPS01P5B",404,0)
 .. S $P(^BPST(IEN59,0),U,7)=SUBDT
"RTN","BPS01P5B",405,0)
 Q
"RTN","BPS01P5C")
0^208^B4183248
"RTN","BPS01P5C",1,0)
BPS01P5C ;ALB/SS - BPS*1.0*5 POST INSTALL ROUTINE ;14-NOV-06
"RTN","BPS01P5C",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPS01P5C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPS01P5C",4,0)
 Q
"RTN","BPS01P5C",5,0)
 ;/*
"RTN","BPS01P5C",6,0)
 ;Get ePharmacy ien by:
"RTN","BPS01P5C",7,0)
 ;  BPSDT - date, 
"RTN","BPS01P5C",8,0)
 ;  BPSRXIEN - RX ien and 
"RTN","BPS01P5C",9,0)
 ;  BPSREF - refil number 
"RTN","BPS01P5C",10,0)
 ;by using BPS LOG file, then BPS TRANSACTION file and then PRESCRIPTION file
"RTN","BPS01P5C",11,0)
 ;
"RTN","BPS01P5C",12,0)
 ;returns ien of #9002313.56 BPS PHARMACIES
"RTN","BPS01P5C",13,0)
 ;or zero (0) if not found
"RTN","BPS01P5C",14,0)
GETEPHRM(BPSDT,BPSRXIEN,BPSREF) ;*/
"RTN","BPS01P5C",15,0)
 I +$G(BPSRXIEN)=0 Q 0
"RTN","BPS01P5C",16,0)
 I $G(BPSREF)="" Q 0
"RTN","BPS01P5C",17,0)
 N BP57,BP59,BPZ,BPFND,BPSPHRM
"RTN","BPS01P5C",18,0)
 S BPFND=0,BPSPHRM=0
"RTN","BPS01P5C",19,0)
 ;create a BPS TRANSACTION ien
"RTN","BPS01P5C",20,0)
 S BP59=BPSRXIEN_"."_$E(((BPSREF_"1")+100000),2,6)
"RTN","BPS01P5C",21,0)
 ;first look at BPS LOG file for the date
"RTN","BPS01P5C",22,0)
 ;
"RTN","BPS01P5C",23,0)
 I $G(BPSDT)>0 S BP57=0 F  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:(+BP57=0)!(BPFND>0)  D
"RTN","BPS01P5C",24,0)
 . I ($P($G(^BPSTL(BP57,0)),U,11)\1)=BPSDT S BPFND=BP57
"RTN","BPS01P5C",25,0)
 ;if was found in BPS LOG
"RTN","BPS01P5C",26,0)
 I BPFND>0 S BPSPHRM=+$P($G(^BPSTL(BPFND,1)),U,7) I BPSPHRM>0 Q BPSPHRM
"RTN","BPS01P5C",27,0)
 ;if not get it from BPS TRANSACTION
"RTN","BPS01P5C",28,0)
 S BPSPHRM=+$P($G(^BPST(BP59,1)),U,7) I BPSPHRM>0 Q BPSPHRM
"RTN","BPS01P5C",29,0)
 ;if not then get it using PRESCRIPTION file's OUTPATIENT SITE 
"RTN","BPS01P5C",30,0)
 Q +$$EPHARM(BPSRXIEN,BPSREF)
"RTN","BPS01P5C",31,0)
 ;
"RTN","BPS01P5C",32,0)
 ;/*
"RTN","BPS01P5C",33,0)
 ;returns ien of #9002313.56 BPS PHARMACIES associated
"RTN","BPS01P5C",34,0)
 ;with the prescription specified by:
"RTN","BPS01P5C",35,0)
 ; BPSRX - IEN in file #52
"RTN","BPS01P5C",36,0)
 ; BPSREFIL - zero(0) for the original prescription or the refill 
"RTN","BPS01P5C",37,0)
 ;    number for a refill (IEN of REFILL multiple #52.1)
"RTN","BPS01P5C",38,0)
EPHARM(BPSRX,BPSREFIL) ;*/
"RTN","BPS01P5C",39,0)
 I +$G(BPSRX)=0 Q ""
"RTN","BPS01P5C",40,0)
 I $G(BPSREFIL)="" Q ""
"RTN","BPS01P5C",41,0)
 N BPSDIV59
"RTN","BPS01P5C",42,0)
 S BPSDIV59=+$$RXSITE^PSOBPSUT(+BPSRX,+BPSREFIL) ;IA #4701
"RTN","BPS01P5C",43,0)
 I BPSDIV59>0 Q $$GETPHARM^BPSUTIL(BPSDIV59)
"RTN","BPS01P5C",44,0)
 Q ""
"RTN","BPS01P5C",45,0)
 ;
"RTN","BPS01P5C",46,0)
 ; Delete BPS NCPDP FIELD DEF entries that are obsolete
"RTN","BPS01P5C",47,0)
 ;  for version 5.1 or are not Telecommunication standard
"RTN","BPS01P5C",48,0)
DEL91 ;
"RTN","BPS01P5C",49,0)
 N I,FLDNUM
"RTN","BPS01P5C",50,0)
 ;
"RTN","BPS01P5C",51,0)
 ; Fields in LIST are obsolete and/or not part of the Telecommunication standard
"RTN","BPS01P5C",52,0)
 F I=1:1 S FLDNUM=$P($T(LIST+I),";",3) Q:FLDNUM="END"  D DEL91A(FLDNUM)
"RTN","BPS01P5C",53,0)
 ;
"RTN","BPS01P5C",54,0)
 ; Fields 601+ are either obsolete and/or not part of the Telecommunication standard
"RTN","BPS01P5C",55,0)
 S FLDNUM=600 F  S FLDNUM=$O(^BPSF(9002313.91,"B",FLDNUM)) Q:+FLDNUM=0  D DEL91A(FLDNUM)
"RTN","BPS01P5C",56,0)
 Q
"RTN","BPS01P5C",57,0)
 ;
"RTN","BPS01P5C",58,0)
DEL91A(FLDNUM) ;
"RTN","BPS01P5C",59,0)
 N DIE,DA,DR
"RTN","BPS01P5C",60,0)
 S DA=$O(^BPSF(9002313.91,"B",FLDNUM,""))
"RTN","BPS01P5C",61,0)
 I DA="" Q
"RTN","BPS01P5C",62,0)
 S DIE=9002313.91,DR=".01////@"
"RTN","BPS01P5C",63,0)
 D ^DIE
"RTN","BPS01P5C",64,0)
 Q
"RTN","BPS01P5C",65,0)
 ;
"RTN","BPS01P5C",66,0)
LIST ;;
"RTN","BPS01P5C",67,0)
 ;;329
"RTN","BPS01P5C",68,0)
 ;;404
"RTN","BPS01P5C",69,0)
 ;;410
"RTN","BPS01P5C",70,0)
 ;;416
"RTN","BPS01P5C",71,0)
 ;;422
"RTN","BPS01P5C",72,0)
 ;;425
"RTN","BPS01P5C",73,0)
 ;;428
"RTN","BPS01P5C",74,0)
 ;;432
"RTN","BPS01P5C",75,0)
 ;;437
"RTN","BPS01P5C",76,0)
 ;;508
"RTN","BPS01P5C",77,0)
 ;;516
"RTN","BPS01P5C",78,0)
 ;;525
"RTN","BPS01P5C",79,0)
 ;;535
"RTN","BPS01P5C",80,0)
 ;;END
"RTN","BPS02P1")
1^186
"RTN","BPS03P1")
1^185
"RTN","BPSBCKJ")
0^17^B46482167
"RTN","BPSBCKJ",1,0)
BPSBCKJ ;BHAM ISC/AAT - BPS NIGHTLY BACKGROUND JOB ;02/27/2005
"RTN","BPSBCKJ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSBCKJ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSBCKJ",4,0)
 ;
"RTN","BPSBCKJ",5,0)
 Q
"RTN","BPSBCKJ",6,0)
 ;
"RTN","BPSBCKJ",7,0)
EN ; The ECME NIGHTLY PROCESS
"RTN","BPSBCKJ",8,0)
 ;
"RTN","BPSBCKJ",9,0)
 ; The list of nightly actions
"RTN","BPSBCKJ",10,0)
 D AUTOREV     ; Auto-Reversals (normal and inpatient)
"RTN","BPSBCKJ",11,0)
 D MAIN^BPSOSK ; Purge BPS LOG
"RTN","BPSBCKJ",12,0)
 D TASKMAN^BPSJAREG ; Do automatic registration.
"RTN","BPSBCKJ",13,0)
 Q
"RTN","BPSBCKJ",14,0)
 ;
"RTN","BPSBCKJ",15,0)
AUTOREV ; The Auto-Reverse Procedure
"RTN","BPSBCKJ",16,0)
 N BDT,BTRAN,BPHARM,BTRAN0,BTRAN1,BTRAN4,BDAYS,BRX,BFIL,BDATE,BNOW,BCLAIM,BRES,BREV,BTEST,REF,BCNT,BTX,X,X1,X2
"RTN","BPSBCKJ",17,0)
 ;
"RTN","BPSBCKJ",18,0)
 S BTEST=0 ; Debugging flag 1 - TEST, 0 - LIVE
"RTN","BPSBCKJ",19,0)
 S BCNT=0 ; Count reversals
"RTN","BPSBCKJ",20,0)
 ;
"RTN","BPSBCKJ",21,0)
 S REF=$NA(^TMP($J,"BPSBCKJ")) K @REF
"RTN","BPSBCKJ",22,0)
 ;
"RTN","BPSBCKJ",23,0)
 S (X1,BNOW)=$$DT^XLFDT()
"RTN","BPSBCKJ",24,0)
 ;
"RTN","BPSBCKJ",25,0)
 ;Define number of days to look back - Auto Reverse days can be from 0-31
"RTN","BPSBCKJ",26,0)
 ;To make sure every claim is caught, moving back 45 days
"RTN","BPSBCKJ",27,0)
 S X2=-45 D C^%DTC S BDT=X
"RTN","BPSBCKJ",28,0)
 ;
"RTN","BPSBCKJ",29,0)
 ;Loop through 'LAST UPDATE' 'AH' index
"RTN","BPSBCKJ",30,0)
 F  S BDT=$O(^BPST("AH",BDT)) Q:'BDT  S BTRAN=0 F  S BTRAN=$O(^BPST("AH",BDT,BTRAN)) Q:'BTRAN  D
"RTN","BPSBCKJ",31,0)
 . W:BTEST !,"TRAN=",BTRAN," ",?20
"RTN","BPSBCKJ",32,0)
 . S BTRAN0=$G(^BPST(BTRAN,0)),BTRAN1=$G(^(1)),BTRAN4=$G(^(4))
"RTN","BPSBCKJ",33,0)
 . I BTRAN0=""!(BTRAN1="") W:BTEST "ZERO OR ONE NODE MISSING" Q
"RTN","BPSBCKJ",34,0)
 . I '$$PAID^BPSOSQ4(BTRAN) W:BTEST "NOT PAID" Q  ; Not paid
"RTN","BPSBCKJ",35,0)
 . S BPHARM=$P(BTRAN1,U,7) I 'BPHARM W:BTEST "NO BPS PHARM" Q  ; BPS PHARMACY
"RTN","BPSBCKJ",36,0)
 . W:BTEST "BPHARM=",$P($G(^BPS(9002313.56,BPHARM,0)),U,1),"  "
"RTN","BPSBCKJ",37,0)
 . ;
"RTN","BPSBCKJ",38,0)
 . ;Handle 'Inpatient' Auto-Reversals
"RTN","BPSBCKJ",39,0)
 . S BREV=$$REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) Q:BREV
"RTN","BPSBCKJ",40,0)
 . ;
"RTN","BPSBCKJ",41,0)
 . ;Handle Regular Auto-Reversals
"RTN","BPSBCKJ",42,0)
 . S BDAYS=+$P($G(^BPS(9002313.56,BPHARM,0)),U,9)
"RTN","BPSBCKJ",43,0)
 . I 'BDAYS W:BTEST "AUTO-REV DISABLED" Q  ;disabled
"RTN","BPSBCKJ",44,0)
 . I $P(BTRAN4,U,1) Q  ;Reversal claim exist
"RTN","BPSBCKJ",45,0)
 . S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM W:BTEST "NO BCLAIM" Q
"RTN","BPSBCKJ",46,0)
 . I $P($G(^BPSC(BCLAIM,0)),U,7) W:BTEST "AUTO-REVERSE FLAG" Q 
"RTN","BPSBCKJ",47,0)
 . S BDATE=$P($G(^BPSC(BCLAIM,0)),U,5)
"RTN","BPSBCKJ",48,0)
 . I 'BDATE S BDATE=$P($G(^BPSC(BCLAIM,0)),U,6)
"RTN","BPSBCKJ",49,0)
 . S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",50,0)
 . I 'BDATE="" W:BTEST "NO DATE" Q
"RTN","BPSBCKJ",51,0)
 . W:BTEST "DATE=",BDATE,"  "
"RTN","BPSBCKJ",52,0)
 . I $$FMDIFF^XLFDT(BNOW,BDATE,1)'>BDAYS W:BTEST "TOO EARLY" Q
"RTN","BPSBCKJ",53,0)
 . S BRX=$P(BTRAN1,U,11) I 'BRX W:BTEST "NO RX" Q
"RTN","BPSBCKJ",54,0)
 . S BFIL=$P(BTRAN1,U,1)
"RTN","BPSBCKJ",55,0)
 . I $$RELDATE(BRX,BFIL) W:BTEST " RELEASED" Q  ;released
"RTN","BPSBCKJ",56,0)
 . S BRES=$$REVERSE(BRX,BFIL,BCLAIM,1)
"RTN","BPSBCKJ",57,0)
 . W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",58,0)
 . I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",59,0)
 .. S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",60,0)
 .. S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",61,0)
 . ; Any notifications to IB?
"RTN","BPSBCKJ",62,0)
 D BULL(REF) ; Send the bulletin
"RTN","BPSBCKJ",63,0)
 K @REF
"RTN","BPSBCKJ",64,0)
 Q
"RTN","BPSBCKJ",65,0)
 ;
"RTN","BPSBCKJ",66,0)
 ;Auto-Reverse Claims for Current Inpatients
"RTN","BPSBCKJ",67,0)
 ;
"RTN","BPSBCKJ",68,0)
 ;20050810;BEE;Phase III - CR11
"RTN","BPSBCKJ",69,0)
 ;
"RTN","BPSBCKJ",70,0)
REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) ;
"RTN","BPSBCKJ",71,0)
 N BRX,BFIL,BCLAIM,BDATE,BRES,DFN,VAIP
"RTN","BPSBCKJ",72,0)
 ;
"RTN","BPSBCKJ",73,0)
 ;Only process Window fills
"RTN","BPSBCKJ",74,0)
 S BRX=+$P(BTRAN1,U,11) I BRX=0 Q 0
"RTN","BPSBCKJ",75,0)
 S BFIL=+$P(BTRAN1,U)
"RTN","BPSBCKJ",76,0)
 I $$MWC^BPSRPT6(BRX,BFIL)'="W" Q 0
"RTN","BPSBCKJ",77,0)
 ;
"RTN","BPSBCKJ",78,0)
 ;Check for Fill date - Must be equal to T-5
"RTN","BPSBCKJ",79,0)
 S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM Q 0
"RTN","BPSBCKJ",80,0)
 S BDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",81,0)
 S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",82,0)
 I 'BDATE="" Q 0
"RTN","BPSBCKJ",83,0)
 I $$FMDIFF^XLFDT(BNOW,BDATE,1)'=5 Q 0
"RTN","BPSBCKJ",84,0)
 ;
"RTN","BPSBCKJ",85,0)
 ;Check for current Inpatient
"RTN","BPSBCKJ",86,0)
 S DFN=+$P(BTRAN0,U,6) I DFN=0 Q 0
"RTN","BPSBCKJ",87,0)
 D IN5^VADPT
"RTN","BPSBCKJ",88,0)
 I $G(VAIP(3))="" Q 0
"RTN","BPSBCKJ",89,0)
 ;
"RTN","BPSBCKJ",90,0)
 ;Auto-Reverse Claim
"RTN","BPSBCKJ",91,0)
 S BRES=$$REVERSE(BRX,BFIL,BCLAIM,2)
"RTN","BPSBCKJ",92,0)
 W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",93,0)
 I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",94,0)
 . S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",95,0)
 . S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",96,0)
 Q 1
"RTN","BPSBCKJ",97,0)
 ;
"RTN","BPSBCKJ",98,0)
RELDATE(BRX,BFIL) ;Get the Released Date
"RTN","BPSBCKJ",99,0)
 I BFIL Q $$RXSUBF1^BPSUTIL1(BRX,52,52.1,+BFIL,17,"I")
"RTN","BPSBCKJ",100,0)
 Q $$RXAPI1^BPSUTIL1(BRX,31,"I")
"RTN","BPSBCKJ",101,0)
 ;
"RTN","BPSBCKJ",102,0)
FILDATE(BRX,BFIL) ;Get the Fill Date
"RTN","BPSBCKJ",103,0)
 I BFIL Q $$RXSUBF1^BPSUTIL1(BRX,52,52.1,+BFIL,.01,"I")
"RTN","BPSBCKJ",104,0)
 Q $$RXAPI1^BPSUTIL1(BRX,22,"I")
"RTN","BPSBCKJ",105,0)
 ;
"RTN","BPSBCKJ",106,0)
REVERSE(BRX,BFIL,BCLAIM,BTYPE) ;Auto-Reverse the claim
"RTN","BPSBCKJ",107,0)
 ;PUBLIC BTEST
"RTN","BPSBCKJ",108,0)
 N BDOS,BRES,BDAT,BMES,BRSN
"RTN","BPSBCKJ",109,0)
 I $G(BTEST) Q 0  ; Test mode
"RTN","BPSBCKJ",110,0)
 ;
"RTN","BPSBCKJ",111,0)
 ; Get Date of Service and set reversal reason
"RTN","BPSBCKJ",112,0)
 S BDOS=$$DOSDATE^BPSSCRRS(BRX,BFIL)
"RTN","BPSBCKJ",113,0)
 S BRSN=$S(BTYPE=2:"CURRENT INPATIENT",1:"PRESCRIPTION NOT RELEASED")
"RTN","BPSBCKJ",114,0)
 ;
"RTN","BPSBCKJ",115,0)
 ; Call ECME to process reversal
"RTN","BPSBCKJ",116,0)
 S BRES=$$EN^BPSNCPDP(BRX,BFIL,BDOS,"AREV","",BRSN,"")
"RTN","BPSBCKJ",117,0)
 ;
"RTN","BPSBCKJ",118,0)
 ; If successful, log message to the Prescription Activity Log
"RTN","BPSBCKJ",119,0)
 ;  and set the auto-reversal flag
"RTN","BPSBCKJ",120,0)
 S BRES=+BRES,BMES="Submitted to ECME: AUTO REVERSAL JOB"
"RTN","BPSBCKJ",121,0)
 I BRES=0 D
"RTN","BPSBCKJ",122,0)
 . D ECMEACT^PSOBPSU1(BRX,BFIL,BMES,.5)
"RTN","BPSBCKJ",123,0)
 . S BDAT(9002313.02,BCLAIM_",",.07)=BTYPE D FILE^DIE("","BDAT")
"RTN","BPSBCKJ",124,0)
 Q BRES
"RTN","BPSBCKJ",125,0)
 ;
"RTN","BPSBCKJ",126,0)
 ;
"RTN","BPSBCKJ",127,0)
BULL(REF) ;Bulletin to the OPECC
"RTN","BPSBCKJ",128,0)
 ;PUBLIC BTEST,DUZ,DT
"RTN","BPSBCKJ",129,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,BLNUM
"RTN","BPSBCKJ",130,0)
 ;
"RTN","BPSBCKJ",131,0)
 S BLNUM=0,BCNT=+$G(@REF@(0))
"RTN","BPSBCKJ",132,0)
 S XMSUB="ECME AUTO-REVERSAL PROCESS"
"RTN","BPSBCKJ",133,0)
 I $G(BTEST) D T("*** P L E A S E   D I S R E G A R D    T H I S    E M A I L ***"),T(),T("NOT ACTUALLY REVERSED - THIS IS A TEST"),T()
"RTN","BPSBCKJ",134,0)
 D T("The ECME Nightly Process submitted auto-reversals for the following e-Pharmacy")
"RTN","BPSBCKJ",135,0)
 D T("prescriptions.")
"RTN","BPSBCKJ",136,0)
 D T()
"RTN","BPSBCKJ",137,0)
 D T("TOTAL CLAIMS SUBMITTED FOR AUTO-REVERSALS: "_BCNT)
"RTN","BPSBCKJ",138,0)
 D T()
"RTN","BPSBCKJ",139,0)
 I BCNT D T("Claims Submitted for Auto-Reversals on "_$$DAT(DT)_":") D ARLIST(0,REF)
"RTN","BPSBCKJ",140,0)
 D T()
"RTN","BPSBCKJ",141,0)
 S BCNT=+$G(@REF@(4))
"RTN","BPSBCKJ",142,0)
 I BCNT'=0 D
"RTN","BPSBCKJ",143,0)
 . D T()
"RTN","BPSBCKJ",144,0)
 . D T("The ECME Nightly Process attempted to auto-reverse the following claims but")
"RTN","BPSBCKJ",145,0)
 . D T("could not because the previous request was IN PROGRESS.  Please verify that")
"RTN","BPSBCKJ",146,0)
 . D T("the previous request is not stranded.")
"RTN","BPSBCKJ",147,0)
 . D T()
"RTN","BPSBCKJ",148,0)
 . D T("Total number of claims that could not be auto-reversed: "_BCNT)
"RTN","BPSBCKJ",149,0)
 . D T()
"RTN","BPSBCKJ",150,0)
 . D T("Claims not auto-reversed on "_$$DAT(DT)_":")
"RTN","BPSBCKJ",151,0)
 . D ARLIST(4,REF)
"RTN","BPSBCKJ",152,0)
 . D T()
"RTN","BPSBCKJ",153,0)
 ;
"RTN","BPSBCKJ",154,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTX("
"RTN","BPSBCKJ",155,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSBCKJ",156,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSBCKJ",157,0)
 D ^XMD
"RTN","BPSBCKJ",158,0)
 Q
"RTN","BPSBCKJ",159,0)
 ;
"RTN","BPSBCKJ",160,0)
T(BTXT) ; Add text to the message
"RTN","BPSBCKJ",161,0)
 ;PUBLIC BLNUM,BTEST
"RTN","BPSBCKJ",162,0)
 S BLNUM=BLNUM+1,BTX(BLNUM)=$G(BTXT," ")
"RTN","BPSBCKJ",163,0)
 I $G(BTEST) W !,$G(BTXT)
"RTN","BPSBCKJ",164,0)
 Q
"RTN","BPSBCKJ",165,0)
 ;
"RTN","BPSBCKJ",166,0)
ARLIST(BRES,REF) ;Auto-Rev List
"RTN","BPSBCKJ",167,0)
 N I,TXT,BCLAIM,BTRAN,Y,BRX,BFIL,BFDATE,BPHARM,BRXN,BPHARMN,BPAT,BPSTAT
"RTN","BPSBCKJ",168,0)
 D T()
"RTN","BPSBCKJ",169,0)
 D T(" #    RX     FILL  STATUS FILL DATE PATIENT                      BPS PHARMACY")
"RTN","BPSBCKJ",170,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",171,0)
 S I=0 F  S I=$O(@REF@(BRES,I)) Q:'I   D
"RTN","BPSBCKJ",172,0)
 . S Y=@REF@(BRES,I)
"RTN","BPSBCKJ",173,0)
 . S BTRAN=$P(Y,U)
"RTN","BPSBCKJ",174,0)
 . S BCLAIM=$P(Y,U,2)
"RTN","BPSBCKJ",175,0)
 . S BRX=$P(Y,U,3),BRXN=$$RXAPI1^BPSUTIL1(BRX,.01,"I")
"RTN","BPSBCKJ",176,0)
 . S BPAT=$P($G(^DPT(+$$RXAPI1^BPSUTIL1(BRX,2,"I"),0)),U)
"RTN","BPSBCKJ",177,0)
 . S BFIL=$P(Y,U,4)
"RTN","BPSBCKJ",178,0)
 . S BPHARM=$P(Y,U,5),BPHARMN=$P($G(^BPS(9002313.56,BPHARM,0)),U)
"RTN","BPSBCKJ",179,0)
 . S BFDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",180,0)
 . S BPSTAT=$$MWC^BPSRPT6(BRX,BFIL)_"/"_$S($$RELDATE(BRX,BFIL)]"":"RL",1:"NR")
"RTN","BPSBCKJ",181,0)
 . S TXT=$J(I,3)_" "_$$J(BRXN,10)_" "_$$J(BFIL,2)_"  "_$J(BPSTAT,4)_"  "_$$J($$DAT(BFDATE),11)_$$J(BPAT,25)_" "_$J($E(BPHARMN,1,15),15)
"RTN","BPSBCKJ",182,0)
 . D T(TXT)
"RTN","BPSBCKJ",183,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",184,0)
 Q
"RTN","BPSBCKJ",185,0)
 ;
"RTN","BPSBCKJ",186,0)
J(TXT,LEN) ;Left justify
"RTN","BPSBCKJ",187,0)
 Q TXT_$J("",LEN-$L(TXT))
"RTN","BPSBCKJ",188,0)
 ;
"RTN","BPSBCKJ",189,0)
DAT(X,Y) ; Convert FM date to displayable (mm/dd/yy) format.
"RTN","BPSBCKJ",190,0)
 ; -- optional output of time, if $g(y) 
"RTN","BPSBCKJ",191,0)
 N DATE,T
"RTN","BPSBCKJ",192,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSBCKJ",193,0)
 I $G(Y) S T="."_$E($P(X,".",2)_"000000",1,7) I T>0 S DATE=DATE_" "_$S($E(T,2,3)>12:$E(T,2,3)-12,$E(T,2,3)="00":"00",1:+$E(T,2,3))_":"_$E(T,4,5)_$S($E(T,2,5)>1200:" pm",1:" am")
"RTN","BPSBCKJ",194,0)
 Q DATE
"RTN","BPSBUTL")
0^1^B49471092
"RTN","BPSBUTL",1,0)
BPSBUTL ;BHAM ISC/MFR/VA/DLF - IB Communication Utilities ;06/01/2004
"RTN","BPSBUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSBUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSBUTL",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSBUTL",5,0)
 Q
"RTN","BPSBUTL",6,0)
 ;
"RTN","BPSBUTL",7,0)
CLOSE(CLAIM,TRNDX,REASON,PAPER,RELCOP,COMMENT,ERROR) ; Send IB an update on the CLAIM status for a Closed Claim
"RTN","BPSBUTL",8,0)
 N DFN,BPSARRY,BILLNUM,CLAIMNFO,FILLNUM,RXIEN,TRANINFO
"RTN","BPSBUTL",9,0)
 ;
"RTN","BPSBUTL",10,0)
 ; - Data gathering
"RTN","BPSBUTL",11,0)
 D GETS^DIQ("9002313.59",TRNDX,"1.11;9","I","TRANINFO")
"RTN","BPSBUTL",12,0)
 S RXIEN=TRANINFO(9002313.59,TRNDX_",",1.11,"I")
"RTN","BPSBUTL",13,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" S ERROR="Prescription not found." Q
"RTN","BPSBUTL",14,0)
 S BPSARRY("FILL NUMBER")=TRANINFO(9002313.59,TRNDX_",",9,"I")
"RTN","BPSBUTL",15,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSBUTL",16,0)
 S BPSARRY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",17,0)
 S FILLNUM=+BPSARRY("FILL NUMBER")
"RTN","BPSBUTL",18,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSBUTL",19,0)
 S BPSARRY("FILLED BY")=$$RXAPI1^BPSUTIL1(RXIEN,16,"I")
"RTN","BPSBUTL",20,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",21,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",22,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",23,0)
 S BPSARRY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^")
"RTN","BPSBUTL",24,0)
 S BPSARRY("STATUS")="CLOSED"
"RTN","BPSBUTL",25,0)
 S BPSARRY("PAID")=0
"RTN","BPSBUTL",26,0)
 S BPSARRY("RELEASE DATE")=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSBUTL",27,0)
 S BPSARRY("USER")=DUZ
"RTN","BPSBUTL",28,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,TRNDX,1.07,"I")
"RTN","BPSBUTL",29,0)
 I REASON'="" D
"RTN","BPSBUTL",30,0)
 . S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",31,0)
 . S BPSARRY("DROP TO PAPER")=+$G(PAPER)
"RTN","BPSBUTL",32,0)
 . S BPSARRY("RELEASE COPAY")=+$G(RELCOP)
"RTN","BPSBUTL",33,0)
 I $G(COMMENT)]"" S BPSARRY("CLOSE COMMENT")=COMMENT
"RTN","BPSBUTL",34,0)
 ;
"RTN","BPSBUTL",35,0)
 ; If dropped to Paper, increment the counter in BPS Statistics
"RTN","BPSBUTL",36,0)
 I BPSARRY("DROP TO PAPER")=1 D INCSTAT^BPSOSUD("R",8)
"RTN","BPSBUTL",37,0)
 ;
"RTN","BPSBUTL",38,0)
 ; Call IB
"RTN","BPSBUTL",39,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSBUTL",40,0)
 Q
"RTN","BPSBUTL",41,0)
 ; Send IB an update on the CLAIM status for a restocked or deleted prescription
"RTN","BPSBUTL",42,0)
CLOSE2(RXIEN,BFILL,BWHERE) ;
"RTN","BPSBUTL",43,0)
 N IEN59,BPSARRY,DFN,BILLNUM,FILL,REASON
"RTN","BPSBUTL",44,0)
 N CLAIMNFO
"RTN","BPSBUTL",45,0)
 N DIE,DA,DR
"RTN","BPSBUTL",46,0)
 ;
"RTN","BPSBUTL",47,0)
 ; Check parameters
"RTN","BPSBUTL",48,0)
 I '$G(RXIEN) S ERROR="No prescription parameter" Q
"RTN","BPSBUTL",49,0)
 ;
"RTN","BPSBUTL",50,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" S ERROR="Prescription not found." Q
"RTN","BPSBUTL",51,0)
 I ",DDED,DE,RS,"'[(","_BWHERE_",") S ERROR="Invalid BWHERE parameter" Q
"RTN","BPSBUTL",52,0)
 ;
"RTN","BPSBUTL",53,0)
 ; Calculate the transaction IEN and see that it exists
"RTN","BPSBUTL",54,0)
 S FILL=".0000"_+BFILL
"RTN","BPSBUTL",55,0)
 S IEN59=RXIEN_"."_$E(FILL,$L(FILL)-3,$L(FILL))_"1"
"RTN","BPSBUTL",56,0)
 I '$D(^BPST(IEN59,0)) Q
"RTN","BPSBUTL",57,0)
 ;
"RTN","BPSBUTL",58,0)
 ; Get claim data
"RTN","BPSBUTL",59,0)
 S CLAIM=$P(^BPST(IEN59,0),"^",4)
"RTN","BPSBUTL",60,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;426","","CLAIMNFO")
"RTN","BPSBUTL",61,0)
 S BPSARRY("FILL NUMBER")=+BFILL
"RTN","BPSBUTL",62,0)
 S BPSARRY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",63,0)
 ;
"RTN","BPSBUTL",64,0)
 ; Get prescription data
"RTN","BPSBUTL",65,0)
 S FILLNUM=BPSARRY("FILL NUMBER")
"RTN","BPSBUTL",66,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSBUTL",67,0)
 S BPSARRY("FILLED BY")=$$RXAPI1^BPSUTIL1(RXIEN,16,"I")
"RTN","BPSBUTL",68,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",69,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",70,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",71,0)
 S BPSARRY("PLAN")=$P(^BPST(IEN59,10,1,0),"^")
"RTN","BPSBUTL",72,0)
 S BPSARRY("STATUS")="CLOSED"
"RTN","BPSBUTL",73,0)
 S BPSARRY("PAID")=0
"RTN","BPSBUTL",74,0)
 S BPSARRY("RELEASE DATE")=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSBUTL",75,0)
 S BPSARRY("USER")=.5
"RTN","BPSBUTL",76,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,IEN59,1.07,"I")
"RTN","BPSBUTL",77,0)
 ;
"RTN","BPSBUTL",78,0)
 ; Determine the reversal reason based on the BWHERE value
"RTN","BPSBUTL",79,0)
 I BWHERE="RS" S REASON="PRESCRIPTION NOT RELEASED"
"RTN","BPSBUTL",80,0)
 I BWHERE="DE"!(BWHERE="DDED") S REASON="PRESCRIPTION DELETED"
"RTN","BPSBUTL",81,0)
 I REASON]"" S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",82,0)
 ;
"RTN","BPSBUTL",83,0)
 ;if a refill was deleted while RX is still active (not deleted) then send DELETION OF REFILL comment for CT record
"RTN","BPSBUTL",84,0)
 I BWHERE="DE",$$RXSTATUS^BPSSCRU2(RXIEN)'=13 S BPSARRY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSBUTL",85,0)
 ;
"RTN","BPSBUTL",86,0)
 ;
"RTN","BPSBUTL",87,0)
 ; Update IB
"RTN","BPSBUTL",88,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSBUTL",89,0)
 ;
"RTN","BPSBUTL",90,0)
 ; Update the claim file that the claim is closed and the reason why.
"RTN","BPSBUTL",91,0)
 S DIE="^BPSC(",DA=CLAIM
"RTN","BPSBUTL",92,0)
 S DR="901///1;902///"_$$NOW^XLFDT()_";903///.5;904///"_BPSARRY("CLOSE REASON")
"RTN","BPSBUTL",93,0)
 D ^DIE
"RTN","BPSBUTL",94,0)
 Q
"RTN","BPSBUTL",95,0)
 ;
"RTN","BPSBUTL",96,0)
 ; Function to return Transaction, claim, and response IENs
"RTN","BPSBUTL",97,0)
 ; Parameters:
"RTN","BPSBUTL",98,0)
 ;    RXI: Prescription IEN
"RTN","BPSBUTL",99,0)
 ;    RXR: Fill Number
"RTN","BPSBUTL",100,0)
 ; Returns:
"RTN","BPSBUTL",101,0)
 ;    IEN59^Claim IEN^Response IEN^Reversal Claim IEN^Reversal Response IEN
"RTN","BPSBUTL",102,0)
CLAIM(RXI,RXR) ;
"RTN","BPSBUTL",103,0)
 N IEN59,CLAIMIEN,RESPIEN,REVCLAIM,REVRESP
"RTN","BPSBUTL",104,0)
 I '$G(RXI) Q
"RTN","BPSBUTL",105,0)
 S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSBUTL",106,0)
 I '$D(^BPST(IEN59,0)) Q ""
"RTN","BPSBUTL",107,0)
 S CLAIMIEN=$P(^BPST(IEN59,0),"^",4),RESPIEN=$P(^BPST(IEN59,0),"^",5)
"RTN","BPSBUTL",108,0)
 S REVCLAIM=$P($G(^BPST(IEN59,4)),"^",1),REVRESP=$P($G(^BPST(IEN59,4)),"^",2)
"RTN","BPSBUTL",109,0)
 Q IEN59_U_CLAIMIEN_U_RESPIEN_U_REVCLAIM_U_REVRESP
"RTN","BPSBUTL",110,0)
 ;
"RTN","BPSBUTL",111,0)
 ; NABP - Return the value in the Service Provider ID (201-B1) field
"RTN","BPSBUTL",112,0)
 ;   of the claim.  Note that as of the NPI release (BPS*1*2), this
"RTN","BPSBUTL",113,0)
 ;   API may return NPI instead of NABP/NCPDP
"RTN","BPSBUTL",114,0)
NABP(RXP,BFILL) ;
"RTN","BPSBUTL",115,0)
 I '$G(RXP) Q ""
"RTN","BPSBUTL",116,0)
 I $G(BFILL)="" S BFILL=0
"RTN","BPSBUTL",117,0)
 N BPSTIEN,BPSCIEN,DFILL,NABP
"RTN","BPSBUTL",118,0)
 S DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)
"RTN","BPSBUTL",119,0)
 S BPSTIEN=RXP_"."_DFILL_"1"
"RTN","BPSBUTL",120,0)
 I 'BPSTIEN Q ""
"RTN","BPSBUTL",121,0)
 S BPSCIEN=$P($G(^BPST(BPSTIEN,0)),U,4)
"RTN","BPSBUTL",122,0)
 I 'BPSCIEN Q ""
"RTN","BPSBUTL",123,0)
 S NABP=$P($G(^BPSC(BPSCIEN,200)),U)
"RTN","BPSBUTL",124,0)
 Q NABP
"RTN","BPSBUTL",125,0)
 ;
"RTN","BPSBUTL",126,0)
 ; DIVNCPDP - For a specific outpatient site, return the NPI & NCPDP.
"RTN","BPSBUTL",127,0)
 ; Note that the procedure name is misleading but when originally
"RTN","BPSBUTL",128,0)
 ;   coded, this procedure only returned NCPDP.
"RTN","BPSBUTL",129,0)
 ;
"RTN","BPSBUTL",130,0)
 ; Input
"RTN","BPSBUTL",131,0)
 ;   BPSDIV - Outpatient Site (#59)
"RTN","BPSBUTL",132,0)
 ; Output
"RTN","BPSBUTL",133,0)
 ;   "" - No BPSDIV passed in
"RTN","BPSBUTL",134,0)
 ;   NCPDP and NPI separated by a caret
"RTN","BPSBUTL",135,0)
DIVNCPDP(BPSDIV) ;
"RTN","BPSBUTL",136,0)
 N BPSPHARM,NPI,NCPDP
"RTN","BPSBUTL",137,0)
 I '$G(BPSDIV) Q "^"
"RTN","BPSBUTL",138,0)
 ;
"RTN","BPSBUTL",139,0)
 ; Get the NCPDP
"RTN","BPSBUTL",140,0)
 S NCPDP=""
"RTN","BPSBUTL",141,0)
 S BPSPHARM=$$GETPHARM^BPSUTIL(BPSDIV)
"RTN","BPSBUTL",142,0)
 I BPSPHARM S NCPDP=$$GET1^DIQ(9002313.56,BPSPHARM_",",.02)
"RTN","BPSBUTL",143,0)
 ;
"RTN","BPSBUTL",144,0)
 ; Get the NPI and validate it
"RTN","BPSBUTL",145,0)
 S NPI=+$$NPI^BPSNPI("Pharmacy_ID",BPSDIV)
"RTN","BPSBUTL",146,0)
 I NPI=-1 S NPI=""
"RTN","BPSBUTL",147,0)
 ;
"RTN","BPSBUTL",148,0)
 Q NCPDP_"^"_NPI
"RTN","BPSBUTL",149,0)
 ;
"RTN","BPSBUTL",150,0)
 ;ADDCOMM - Add a comment to a ECME claim
"RTN","BPSBUTL",151,0)
 ;Input:
"RTN","BPSBUTL",152,0)
 ; BPRX - ien in file #52 
"RTN","BPSBUTL",153,0)
 ; BPREF - refill number (0,1,2,...)
"RTN","BPSBUTL",154,0)
 ; BPRCMNT - comment text 
"RTN","BPSBUTL",155,0)
 ;Output:
"RTN","BPSBUTL",156,0)
 ;  1 - okay
"RTN","BPSBUTL",157,0)
 ; -1 - failed
"RTN","BPSBUTL",158,0)
ADDCOMM(BPRX,BPREF,BPRCMNT) ;
"RTN","BPSBUTL",159,0)
 N BP59,BPNOW,BPLCK,BPREC,BPDA,BPERR
"RTN","BPSBUTL",160,0)
 N %,%H,%I,X
"RTN","BPSBUTL",161,0)
 I $L(BPRX)<1 Q -1
"RTN","BPSBUTL",162,0)
 I $G(BPRCMNT)="" Q -1
"RTN","BPSBUTL",163,0)
 S BP59=BPRX_$S($L(+BPREF)=1:".000",1:".00")_+BPREF_"1" ;borrowed from CLOSE2 above
"RTN","BPSBUTL",164,0)
 D NOW^%DTC
"RTN","BPSBUTL",165,0)
 S BPNOW=%
"RTN","BPSBUTL",166,0)
 L +^BPST(9002313.59111,+BP59):10
"RTN","BPSBUTL",167,0)
 S BPLCK=$T
"RTN","BPSBUTL",168,0)
 I 'BPLCK Q -1  ;quit
"RTN","BPSBUTL",169,0)
 D INSITEM^BPSCMT01(9002313.59111,+BP59,BPNOW)
"RTN","BPSBUTL",170,0)
 S BPREC=$O(^BPST(BP59,11,"B",BPNOW,0))
"RTN","BPSBUTL",171,0)
 I BPREC>0 D
"RTN","BPSBUTL",172,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.02)=+$G(DUZ)
"RTN","BPSBUTL",173,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.03)=$E($G(BPRCMNT),1,63)
"RTN","BPSBUTL",174,0)
 . D FILE^DIE("","BPDA","BPERR")
"RTN","BPSBUTL",175,0)
 I BPLCK L -^BPST(9002313.59111,+BP59)
"RTN","BPSBUTL",176,0)
 I BPREC>0,'$D(BPERR) Q 1
"RTN","BPSBUTL",177,0)
 Q -1
"RTN","BPSBUTL",178,0)
 ;
"RTN","BPSBUTL",179,0)
 ;REOPEN - Reopen closed claim
"RTN","BPSBUTL",180,0)
 ;Input:
"RTN","BPSBUTL",181,0)
 ; BP59 - ien in BPS TRANSACTION file
"RTN","BPSBUTL",182,0)
 ; BP02 - ien in BPS CLAIMS file
"RTN","BPSBUTL",183,0)
 ; BPREOPDT - reopen date/time 
"RTN","BPSBUTL",184,0)
 ; BPDUZ - user DUZ (#200 ien)
"RTN","BPSBUTL",185,0)
 ; BPCOMM - reopen comment text
"RTN","BPSBUTL",186,0)
 ;Output:
"RTN","BPSBUTL",187,0)
 ; 0^message_error - error
"RTN","BPSBUTL",188,0)
 ; 1 - success
"RTN","BPSBUTL",189,0)
REOPEN(BP59,BP02,BPREOPDT,BPDUZ,BPCOMM) ;
"RTN","BPSBUTL",190,0)
 N RECIENS,BPDA,ERRARR,BPREFNO,BPRXIEN,BPFILLDT,BPCLMID,BPZ,BPSARRY,BPDFN,BPRETVAL,BPZ1
"RTN","BPSBUTL",191,0)
 S BPDFN=$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSBUTL",192,0)
 S BPREFNO=$P($G(^BPST(BP59,1)),U)
"RTN","BPSBUTL",193,0)
 I BPREFNO="" Q "0^Null Fill Number"
"RTN","BPSBUTL",194,0)
 S BPRXIEN=$P($G(^BPST(BP59,1)),U,11)
"RTN","BPSBUTL",195,0)
 I BPRXIEN="" Q "0^Null RX ien Number"
"RTN","BPSBUTL",196,0)
 ;in VA there is only one med/claim but in some cases it can different than "1"
"RTN","BPSBUTL",197,0)
 ;so take the latest one
"RTN","BPSBUTL",198,0)
 S BPZ=$O(^BPSC(BP02,400,9999999),-1)
"RTN","BPSBUTL",199,0)
 I BPRXIEN="" Q "0^Database Error"
"RTN","BPSBUTL",200,0)
 S BPFILLDT=$$YMD2FM^BPSSCRU6(+$P($G(^BPSC(BP02,400,+BPZ,400)),U))
"RTN","BPSBUTL",201,0)
 S BPCLMID=$$CONVCLID^BPSSCRU6($P($G(^BPSC(BP02,400,+BPZ,400)),U,2))
"RTN","BPSBUTL",202,0)
 ;============
"RTN","BPSBUTL",203,0)
 ;Now update ECME database
"RTN","BPSBUTL",204,0)
 S BPRETVAL=$$UPDREOP^BPSREOP1(BP02,0,BPREOPDT,BPDUZ,BPCOMM)
"RTN","BPSBUTL",205,0)
 I +BPRETVAL=0 D  Q BPRETVAL
"RTN","BPSBUTL",206,0)
 . ;try to reverse it in case it was done partially
"RTN","BPSBUTL",207,0)
 . I $$UPDREOP^BPSREOP1(BP02,1,"@",+BPDUZ,"@")
"RTN","BPSBUTL",208,0)
 ;============
"RTN","BPSBUTL",209,0)
 ;Now call IB API for "REOPEN" event
"RTN","BPSBUTL",210,0)
 S BPSARRY("STATUS")="REOPEN"
"RTN","BPSBUTL",211,0)
 S BPSARRY("FILL DATE")=BPFILLDT
"RTN","BPSBUTL",212,0)
 S BPSARRY("FILL NUMBER")=BPREFNO
"RTN","BPSBUTL",213,0)
 S BPSARRY("PRESCRIPTION")=BPRXIEN
"RTN","BPSBUTL",214,0)
 S BPSARRY("CLAIMID")=BPCLMID
"RTN","BPSBUTL",215,0)
 S BPSARRY("DRUG")=$$DRUGIEN^BPSSCRU6(BPRXIEN,BPDFN)
"RTN","BPSBUTL",216,0)
 S BPSARRY("PLAN")=$P($G(^BPST(BP59,10,1,0)),"^")
"RTN","BPSBUTL",217,0)
 S BPSARRY("USER")=BPDUZ
"RTN","BPSBUTL",218,0)
 S BPSARRY("REOPEN COMMENT")=BPCOMM
"RTN","BPSBUTL",219,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,BP59,1.07,"I")
"RTN","BPSBUTL",220,0)
 S BPRETVAL=$$STORESP^IBNCPDP(BPDFN,.BPSARRY)
"RTN","BPSBUTL",221,0)
 ;if successful
"RTN","BPSBUTL",222,0)
 I +BPRETVAL>0 Q "1^ReOpening Claim: "_$P($G(^BPSC(BP02,0)),U)_" ... OK"
"RTN","BPSBUTL",223,0)
 ;===========
"RTN","BPSBUTL",224,0)
 ;if it was unsuccessful
"RTN","BPSBUTL",225,0)
 ;reverse ECME database (keep the user who made the attempt)
"RTN","BPSBUTL",226,0)
 I $$UPDREOP^BPSREOP1(BP02,1,"@",+BPDUZ,"@")
"RTN","BPSBUTL",227,0)
 ;return IB error message
"RTN","BPSBUTL",228,0)
 Q BPRETVAL
"RTN","BPSCEAR")
1^191
"RTN","BPSCMT01")
0^35^B20954371
"RTN","BPSCMT01",1,0)
BPSCMT01 ;BHAM ISC/SS - ECME ADD/VIEW COMMENTS ;05-APR-05
"RTN","BPSCMT01",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSCMT01",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSCMT01",4,0)
 ;USER SCREEN
"RTN","BPSCMT01",5,0)
 Q
"RTN","BPSCMT01",6,0)
 ;
"RTN","BPSCMT01",7,0)
ADD ;entry point for Add option in Add/View screen
"RTN","BPSCMT01",8,0)
 ;full screen mode
"RTN","BPSCMT01",9,0)
 D FULL^VALM1
"RTN","BPSCMT01",10,0)
 D ADDCMT
"RTN","BPSCMT01",11,0)
 S VALMBCK="R"
"RTN","BPSCMT01",12,0)
 Q
"RTN","BPSCMT01",13,0)
 ;make element for the patient
"RTN","BPSCMT01",14,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSCMT01",15,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSCMT01",16,0)
 ;BPDFN - patient's DFN
"RTN","BPSCMT01",17,0)
 ;BPSINSUR - ;patient's insurance ien^name^phone
"RTN","BPSCMT01",18,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSCMT01",19,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSCMT01",20,0)
 ;BPPREV - to store previous data to update patient summary line
"RTN","BPSCMT01",21,0)
MKPATELM(BPLINE,BPTMP,BPDFN,BPSINSUR,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSCMT01",22,0)
 N BPSSTR,BPLNS,BPSTAT
"RTN","BPSCMT01",23,0)
 ;PATIENT SUMMARY level
"RTN","BPSCMT01",24,0)
 ;-------- first process previous patient & insurance group
"RTN","BPSCMT01",25,0)
 ;determine patient summary statuses for the previous "patient" group
"RTN","BPSCMT01",26,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSCMT01",27,0)
 I BPLMIND>0,+BPPREV=BPLMIND D UPDPREV(BPTMP,BPLMIND,BPPREV)
"RTN","BPSCMT01",28,0)
 ;process new "patient & insurance" group ------------------
"RTN","BPSCMT01",29,0)
 S BPDRIND=0
"RTN","BPSCMT01",30,0)
 S BPLMIND=(BPLMIND\1)+1
"RTN","BPSCMT01",31,0)
 ;save the all necessary data for the patient & insurance to use as previous for STAT4PAT later on
"RTN","BPSCMT01",32,0)
 S BPPREV=BPLMIND_U_BPLINE_U_BPDFN_U_$$PATINF^BPSSCR02(BPDFN,BPSINSUR)_U_(+BPSINSUR)
"RTN","BPSCMT01",33,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)
"RTN","BPSCMT01",34,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,0,BPLINE,BPSSTR,+BPSINSUR)
"RTN","BPSCMT01",35,0)
 S BPLINE=BPLINE+1
"RTN","BPSCMT01",36,0)
 Q
"RTN","BPSCMT01",37,0)
 ;
"RTN","BPSCMT01",38,0)
 ;/**
"RTN","BPSCMT01",39,0)
 ;update patient summary info in LM array
"RTN","BPSCMT01",40,0)
UPDPREV(BPTMP,BPLMIND,BPPREV) ;
"RTN","BPSCMT01",41,0)
 N BPSSTR
"RTN","BPSCMT01",42,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSCMT01",43,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)_" "_$$STAT4PAT^BPSSCR02(BPLMIND)
"RTN","BPSCMT01",44,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,0,+$P(BPPREV,U,3),0,+$P(BPPREV,U,2),BPSSTR,+$P(BPPREV,U,5))
"RTN","BPSCMT01",45,0)
 Q
"RTN","BPSCMT01",46,0)
 ;/**
"RTN","BPSCMT01",47,0)
 ;make array element for a claim
"RTN","BPSCMT01",48,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSCMT01",49,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSCMT01",50,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSCMT01",51,0)
 ;BPDFN - patient's DFN
"RTN","BPSCMT01",52,0)
 ;BPSINSUR - ;patient's insurance ien
"RTN","BPSCMT01",53,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSCMT01",54,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSCMT01",55,0)
 ;BPPREV - to store previous data to update patient summary line
"RTN","BPSCMT01",56,0)
MKCLMELM(BPLINE,BPTMP,BP59,BPDFN,BPSINSUR,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSCMT01",57,0)
 N BPSSTR,BPLNS,BPSTAT
"RTN","BPSCMT01",58,0)
 ;CLAIMS level
"RTN","BPSCMT01",59,0)
 I +$O(@BPTMP@("LMIND",BPLMIND,BPDRIND,BPDFN,0))'=BP59 D
"RTN","BPSCMT01",60,0)
 . S BPDRIND=BPDRIND+1
"RTN","BPSCMT01",61,0)
 . S BPSSTR="  "_$$LJ^BPSSCR02(+$P(BPLMIND,".")_"."_BPDRIND,5)_" "_$$CLAIMINF^BPSSCR02(BP59)
"RTN","BPSCMT01",62,0)
 . D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSCMT01",63,0)
 . S BPLINE=BPLINE+1
"RTN","BPSCMT01",64,0)
 . N BPARR,X
"RTN","BPSCMT01",65,0)
 . ;use ADDINF^BPSSCR03 to get comments
"RTN","BPSCMT01",66,0)
 . S BPLNS=$$ADDINF^BPSSCR03(BP59,.BPARR,74,"C")
"RTN","BPSCMT01",67,0)
 . F X=1:1:BPLNS D
"RTN","BPSCMT01",68,0)
 . . I $G(BPARR(X))="" Q
"RTN","BPSCMT01",69,0)
 . . D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,"      "_BPARR(X),BPSINSUR)
"RTN","BPSCMT01",70,0)
 . . S BPLINE=BPLINE+1
"RTN","BPSCMT01",71,0)
 Q
"RTN","BPSCMT01",72,0)
 ;/**
"RTN","BPSCMT01",73,0)
 ;input:
"RTN","BPSCMT01",74,0)
 ; BPDFLT1 - default selection (optional)
"RTN","BPSCMT01",75,0)
 ;add comment
"RTN","BPSCMT01",76,0)
 ;the user can select
"RTN","BPSCMT01",77,0)
 ; a patient - comment will be added to all claims
"RTN","BPSCMT01",78,0)
 ; a claim - comment will be added only to this claim
"RTN","BPSCMT01",79,0)
ADDCMT ;*/
"RTN","BPSCMT01",80,0)
 N BPRET,BPSEL,BP59ARR,BPRCMNT,BP59,BPNOW,BPLCK,BPREC,BPDFLT1
"RTN","BPSCMT01",81,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSCMT01",82,0)
 D FULL^VALM1
"RTN","BPSCMT01",83,0)
 ;select an item
"RTN","BPSCMT01",84,0)
 W !,"Enter the line number for which you wish to Add comments."
"RTN","BPSCMT01",85,0)
 S BPDFLT1=$G(^TMP("BPSCMT",$J,"VALM","SELLN"))
"RTN","BPSCMT01",86,0)
 S BPDFLT1=$P(BPDFLT1,U,6)_"."_$P(BPDFLT1,U,7)
"RTN","BPSCMT01",87,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","PC","Please select Patient Line to add a comment to all RXs or a SINGLE RXs",$G(BPDFLT1))
"RTN","BPSCMT01",88,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSCMT01",89,0)
 ;if single claim
"RTN","BPSCMT01",90,0)
 I $P(BPSEL,U,7)>0 S BP59ARR(+$P(BPSEL,U,4))=""
"RTN","BPSCMT01",91,0)
 E  D MKPATARR^BPSCMT(VALMAR,+$P(BPSEL,U,6),.BP59ARR)
"RTN","BPSCMT01",92,0)
 S BPRCMNT=$$COMMENT^BPSSCRCL("Enter Comment",60)
"RTN","BPSCMT01",93,0)
 I (BPRCMNT="^")!($L(BPRCMNT)=0)!(BPRCMNT?1" "." ") Q
"RTN","BPSCMT01",94,0)
 S BP59=0
"RTN","BPSCMT01",95,0)
 F  S BP59=$O(BP59ARR(BP59)) Q:+BP59=0  D
"RTN","BPSCMT01",96,0)
 . N BPDA,BPERR,%
"RTN","BPSCMT01",97,0)
 . D NOW^%DTC
"RTN","BPSCMT01",98,0)
 . S BPNOW=%
"RTN","BPSCMT01",99,0)
 . L +^BPST(9002313.59111,+BP59):10
"RTN","BPSCMT01",100,0)
 . S BPLCK=$T
"RTN","BPSCMT01",101,0)
 . I 'BPLCK Q  ;quit
"RTN","BPSCMT01",102,0)
 . D INSITEM(9002313.59111,+BP59,BPNOW)
"RTN","BPSCMT01",103,0)
 . S BPREC=$O(^BPST(BP59,11,"B",BPNOW,0))
"RTN","BPSCMT01",104,0)
 . I BPREC>0 D
"RTN","BPSCMT01",105,0)
 . . S BPDA(9002313.59111,BPREC_","_BP59_",",.02)=+$G(DUZ)
"RTN","BPSCMT01",106,0)
 . . S BPDA(9002313.59111,BPREC_","_BP59_",",.03)=$G(BPRCMNT)
"RTN","BPSCMT01",107,0)
 . . D FILE^DIE("","BPDA","BPERR")
"RTN","BPSCMT01",108,0)
 . I BPLCK L -^BPST(9002313.59111,+BP59)
"RTN","BPSCMT01",109,0)
 D REDRWCMT^BPSCMT ;update the content of the screen and display it
"RTN","BPSCMT01",110,0)
 S ^TMP("BPSSCR",$J,"VALM","UPDATE")=1
"RTN","BPSCMT01",111,0)
 Q
"RTN","BPSCMT01",112,0)
 ;
"RTN","BPSCMT01",113,0)
 ;/**
"RTN","BPSCMT01",114,0)
 ;BPSFILE - subfile# (9002313.59111) for comment
"RTN","BPSCMT01",115,0)
 ;BPIEN - ien for file in which the new subfile entry will be inserted
"RTN","BPSCMT01",116,0)
 ;BPVAL01 - .01 value for the new entry
"RTN","BPSCMT01",117,0)
INSITEM(BPSFILE,BPIEN,BPVAL01) ;*/
"RTN","BPSCMT01",118,0)
 N BPSSI,BPIENS,BPFDA,BPER
"RTN","BPSCMT01",119,0)
 S BPIENS="+1,"_BPIEN_","
"RTN","BPSCMT01",120,0)
 S BPFDA(BPSFILE,BPIENS,.01)=BPVAL01
"RTN","BPSCMT01",121,0)
 D UPDATE^DIE("","BPFDA","BPSSI","BPER")
"RTN","BPSCMT01",122,0)
 I $D(BPER) D BMES^XPDUTL(BPER("DIERR",1,"TEXT",1))
"RTN","BPSCMT01",123,0)
 Q
"RTN","BPSCMT01",124,0)
 ;
"RTN","BPSCMT01",125,0)
 ;Function to return username data from NEW PERSON file VA(200)
"RTN","BPSCMT01",126,0)
 ; Parameter
"RTN","BPSCMT01",127,0)
 ;  BPSDUZ - IEN of NEW PERSON file
"RTN","BPSCMT01",128,0)
 ;  
"RTN","BPSCMT01",129,0)
 ; Returns
"RTN","BPSCMT01",130,0)
 ;  Username in format of Lastname, Firstname MI
"RTN","BPSCMT01",131,0)
USERNAM(BPSDUZ) ; Return username from NEW PERSON file
"RTN","BPSCMT01",132,0)
 N BPSNMI,BPSNMO
"RTN","BPSCMT01",133,0)
 I '$G(BPSDUZ) Q ""
"RTN","BPSCMT01",134,0)
 S BPSNMI=$$VA200NM^BPSJUTL(+BPSDUZ,"")
"RTN","BPSCMT01",135,0)
 I $G(BPSNMI)="" Q ""
"RTN","BPSCMT01",136,0)
 Q:$P(BPSNMI,U)="" ""
"RTN","BPSCMT01",137,0)
 S BPSNMO=$P(BPSNMI,U)
"RTN","BPSCMT01",138,0)
 Q:$P(BPSNMI,U,2)="" BPSNMO
"RTN","BPSCMT01",139,0)
 S BPSNMO=BPSNMO_", "_$P(BPSNMI,U,2)
"RTN","BPSCMT01",140,0)
 Q:$P(BPSNMI,U,3)="" BPSNMO
"RTN","BPSCMT01",141,0)
 S BPSNMO=BPSNMO_" "_$E($P(BPSNMI,U,3),1)
"RTN","BPSCMT01",142,0)
 Q BPSNMO
"RTN","BPSECA1")
0^157^B9994271
"RTN","BPSECA1",1,0)
BPSECA1 ;BHAM ISC/FCS/DRS/VA/DLF - Assemble formatted claim ;05/14/2004
"RTN","BPSECA1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSECA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECA1",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA1",5,0)
 ; Assemble ASCII formatted claim submission record
"RTN","BPSECA1",6,0)
 ;
"RTN","BPSECA1",7,0)
 ; Input Variables:
"RTN","BPSECA1",8,0)
 ;  CLAIMIEN - pointer into 9002313.02
"RTN","BPSECA1",9,0)
 ;  MSG - Array passed by reference - This will have the claim packet
"RTN","BPSECA1",10,0)
 ;
"RTN","BPSECA1",11,0)
 ; NCPDP 5.1 changes
"RTN","BPSECA1",12,0)
 ;     5.1 has 14 claim segments (header, patient, insurance, claim
"RTN","BPSECA1",13,0)
 ;                                pharmacy provider, prescriber,
"RTN","BPSECA1",14,0)
 ;                                COB, workers comp, DUR, Pricing,
"RTN","BPSECA1",15,0)
 ;                                coupon, compound, prior auth,
"RTN","BPSECA1",16,0)
 ;                                clinical)
"RTN","BPSECA1",17,0)
 ;    5.1 requires field identifiers and separators on all fields
"RTN","BPSECA1",18,0)
 ;        other than the header
"RTN","BPSECA1",19,0)
 ;    5.1 Segment separators are required prior to each segment
"RTN","BPSECA1",20,0)
 ;        following the header
"RTN","BPSECA1",21,0)
 ;    5.1 Group separators appear at the end of each
"RTN","BPSECA1",22,0)
 ;        transaction (prescription)
"RTN","BPSECA1",23,0)
 ;
"RTN","BPSECA1",24,0)
 ;   Adjustments were also made to the reversal logic as well.
"RTN","BPSECA1",25,0)
 ;
"RTN","BPSECA1",26,0)
ASCII(CLAIMIEN,MSG) ;EP - from BPSOSQG
"RTN","BPSECA1",27,0)
 N IEN,RECORD,BPS,UERETVAL,DET51,WP
"RTN","BPSECA1",28,0)
 ;
"RTN","BPSECA1",29,0)
 ; Quit if no Claim IEN
"RTN","BPSECA1",30,0)
 I '$G(CLAIMIEN) Q
"RTN","BPSECA1",31,0)
 I '$D(^BPSC(CLAIMIEN,0)) Q
"RTN","BPSECA1",32,0)
 ;
"RTN","BPSECA1",33,0)
 ; Setup IEN variables (used when executing format code)
"RTN","BPSECA1",34,0)
 S IEN(9002313.02)=CLAIMIEN
"RTN","BPSECA1",35,0)
 ;
"RTN","BPSECA1",36,0)
 ; Get Payer Sheet pointer
"RTN","BPSECA1",37,0)
 S IEN(9002313.92)=$P($G(^BPSC(IEN(9002313.02),0)),U,2)
"RTN","BPSECA1",38,0)
 ;
"RTN","BPSECA1",39,0)
 ; Quit if the payer sheet pointer is missing
"RTN","BPSECA1",40,0)
 I 'IEN(9002313.92) Q
"RTN","BPSECA1",41,0)
 ;
"RTN","BPSECA1",42,0)
 ; Quit if the payer sheet does not exist
"RTN","BPSECA1",43,0)
 I '$D(^BPSF(9002313.92,+IEN(9002313.92),0)) Q
"RTN","BPSECA1",44,0)
 ;
"RTN","BPSECA1",45,0)
 ; Retrieve claim submission record (used when executing format code)
"RTN","BPSECA1",46,0)
 D GETBPS2^BPSECX0(IEN(9002313.02),.BPS)
"RTN","BPSECA1",47,0)
 ;
"RTN","BPSECA1",48,0)
 ; Assemble required claim header and optional format sections
"RTN","BPSECA1",49,0)
 S RECORD=""
"RTN","BPSECA1",50,0)
 ;
"RTN","BPSECA1",51,0)
 ; Do non-repeating claim segments
"RTN","BPSECA1",52,0)
 D XLOOP^BPSOSH2("100^110^120",.IEN,.BPS,.RECORD)
"RTN","BPSECA1",53,0)
 ;
"RTN","BPSECA1",54,0)
 ; Set list of repeating claim segments
"RTN","BPSECA1",55,0)
 S DET51="130^140^150^160^170^180^190^200^210^220^230"
"RTN","BPSECA1",56,0)
 ;
"RTN","BPSECA1",57,0)
 ; Loop through prescription multiple and get create repeation segments
"RTN","BPSECA1",58,0)
 S IEN(9002313.01)=0
"RTN","BPSECA1",59,0)
 F  S IEN(9002313.01)=$O(^BPSC(IEN(9002313.02),400,IEN(9002313.01))) Q:'IEN(9002313.01)  D
"RTN","BPSECA1",60,0)
 . ;
"RTN","BPSECA1",61,0)
 . ;Retrieve prescription information (used when executing format code)
"RTN","BPSECA1",62,0)
 . K BPS(9002313.0201)
"RTN","BPSECA1",63,0)
 . D GETBPS3^BPSECX0(IEN(9002313.02),IEN(9002313.01),.BPS)
"RTN","BPSECA1",64,0)
 . ;
"RTN","BPSECA1",65,0)
 . ; Handle the DUR repeating flds
"RTN","BPSECA1",66,0)
 . D DURVALUE
"RTN","BPSECA1",67,0)
 . ;
"RTN","BPSECA1",68,0)
 . ; Append group separator character
"RTN","BPSECA1",69,0)
 . S RECORD=RECORD_$C(29)
"RTN","BPSECA1",70,0)
 . ;
"RTN","BPSECA1",71,0)
 . ; Assemble claim information required and optional sections
"RTN","BPSECA1",72,0)
 . D XLOOP^BPSOSH2(DET51,.IEN,.BPS,.RECORD)
"RTN","BPSECA1",73,0)
 ;
"RTN","BPSECA1",74,0)
 ; Need to store by segment due to HL7 constraints.  Had to change field, group,
"RTN","BPSECA1",75,0)
 ; and segment separators to control characters for Vitria/AAC processing as well as
"RTN","BPSECA1",76,0)
 ; shortening the length of the xmit.
"RTN","BPSECA1",77,0)
 ; DMB 11/27/2006 - If the first NNODES has $C(30), this will bomb since OREC will not 
"RTN","BPSECA1",78,0)
 ;   have a value.  Need to look into this.
"RTN","BPSECA1",79,0)
 N NNODES,INDEX,ONE,TWO,OREC
"RTN","BPSECA1",80,0)
 S NNODES=0 F  S NNODES=$O(RECORD(NNODES)) Q:NNODES=""  D
"RTN","BPSECA1",81,0)
 . I RECORD(NNODES)[$C(30) D
"RTN","BPSECA1",82,0)
 .. S ONE=$P(RECORD(NNODES),($C(30)_$C(28)),1),TWO=$P(RECORD(NNODES),($C(30)_$C(28)),2)
"RTN","BPSECA1",83,0)
 .. S RECORD(OREC)=RECORD(OREC)_ONE_$C(30)_$C(28),RECORD(NNODES)=TWO
"RTN","BPSECA1",84,0)
 . S OREC=NNODES
"RTN","BPSECA1",85,0)
 ;
"RTN","BPSECA1",86,0)
 ; Put claim packet into local array to be passed back to calling routine
"RTN","BPSECA1",87,0)
 S NNODES=""
"RTN","BPSECA1",88,0)
 S INDEX=1 F  S NNODES=$O(RECORD(NNODES)) Q:NNODES=""  D
"RTN","BPSECA1",89,0)
 . S MSG("HLS",INDEX)=RECORD(NNODES)
"RTN","BPSECA1",90,0)
 . S WP(INDEX/100+1,0)=RECORD(NNODES)
"RTN","BPSECA1",91,0)
 . S INDEX=INDEX+1
"RTN","BPSECA1",92,0)
 S MSG("HLS",0)=INDEX-1
"RTN","BPSECA1",93,0)
 ;
"RTN","BPSECA1",94,0)
 ; Store raw data into the BPS Claims record
"RTN","BPSECA1",95,0)
 D WP^DIE(9002313.02,CLAIMIEN_",",9999,"","WP")
"RTN","BPSECA1",96,0)
 Q
"RTN","BPSECA1",97,0)
 ;
"RTN","BPSECA1",98,0)
 ; DURVALUE - This subroutine will loop through the DUR/PPS repeating
"RTN","BPSECA1",99,0)
 ; fields and load their values into the BPS array for the claim
"RTN","BPSECA1",100,0)
 ; generation process
"RTN","BPSECA1",101,0)
DURVALUE ;
"RTN","BPSECA1",102,0)
 N DURCNT,DUR
"RTN","BPSECA1",103,0)
 ;
"RTN","BPSECA1",104,0)
 K BPS(9002313.1001)
"RTN","BPSECA1",105,0)
 ;
"RTN","BPSECA1",106,0)
 ; Get the number of DUR records
"RTN","BPSECA1",107,0)
 S DURCNT=$P($G(^BPSC(IEN(9002313.02),400,IEN(9002313.01),473.01,0)),U,4)
"RTN","BPSECA1",108,0)
 ;
"RTN","BPSECA1",109,0)
 ; Loop through DURS and get the data
"RTN","BPSECA1",110,0)
 F DUR=1:1:DURCNT  D
"RTN","BPSECA1",111,0)
 . D GETBPS4^BPSECX0(IEN(9002313.02),IEN(9002313.01),DUR,.BPS)
"RTN","BPSECA1",112,0)
 Q
"RTN","BPSECA2")
1^44
"RTN","BPSECA4")
1^45
"RTN","BPSECA5")
1^46
"RTN","BPSECA7")
1^47
"RTN","BPSECA8")
0^158^B7457603
"RTN","BPSECA8",1,0)
BPSECA8 ;BHAM ISC/FCS/DRS/VA/DLF - construct a claim reversal ;05/17/04
"RTN","BPSECA8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSECA8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECA8",4,0)
 Q
"RTN","BPSECA8",5,0)
 ; REVERSE - The way we build the claim reversal is to take the
"RTN","BPSECA8",6,0)
 ; source data from the original claim (CLAIMIEN) and position therein (POS).
"RTN","BPSECA8",7,0)
 ;
"RTN","BPSECA8",8,0)
 ; Remember, you have two 401 fields - one in header, one in prescription.
"RTN","BPSECA8",9,0)
 ;
"RTN","BPSECA8",10,0)
 ; 5.1 Updates
"RTN","BPSECA8",11,0)
 ; There are new fields to consider in the 5.1 reversal process, in
"RTN","BPSECA8",12,0)
 ; addition to a new value for the transaction code (B2)
"RTN","BPSECA8",13,0)
 ;
"RTN","BPSECA8",14,0)
 ; Input
"RTN","BPSECA8",15,0)
 ;   IEN59  - Transaction number
"RTN","BPSECA8",16,0)
 ; Returns REVIEN of the reversal claim created
"RTN","BPSECA8",17,0)
 ;
"RTN","BPSECA8",18,0)
REVERSE(IEN59) ;EP - from BPSOSRB
"RTN","BPSECA8",19,0)
 ;
"RTN","BPSECA8",20,0)
 ; Variable initialization
"RTN","BPSECA8",21,0)
 N CLAIM,RXMULT,BPSFORM,BPS,I,TMP
"RTN","BPSECA8",22,0)
 N DIC,DR,DIQ,DIE,DA,X,DLAYGO,REVIEN,Y,UERETVAL
"RTN","BPSECA8",23,0)
 S CLAIM=9002313.02,RXMULT=9002313.0201
"RTN","BPSECA8",24,0)
 ;
"RTN","BPSECA8",25,0)
 ; Check IEN59
"RTN","BPSECA8",26,0)
 I $G(IEN59)="" Q 0
"RTN","BPSECA8",27,0)
 ;
"RTN","BPSECA8",28,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSECA8",29,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Gathering claim information")
"RTN","BPSECA8",30,0)
 ;
"RTN","BPSECA8",31,0)
 ; Get Claim and multiple POS
"RTN","BPSECA8",32,0)
 N CLAIMIEN,POS
"RTN","BPSECA8",33,0)
 S CLAIMIEN=$P(^BPST(IEN59,0),U,4)
"RTN","BPSECA8",34,0)
 I CLAIMIEN="" Q 0
"RTN","BPSECA8",35,0)
 S POS=$O(^BPSC(CLAIMIEN,400,0))
"RTN","BPSECA8",36,0)
 I POS="" Q 0
"RTN","BPSECA8",37,0)
 ;
"RTN","BPSECA8",38,0)
 ; Get reversal payer sheet.  If missing, quit
"RTN","BPSECA8",39,0)
 S BPSFORM=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.19","I")
"RTN","BPSECA8",40,0)
 I BPSFORM="" Q 0
"RTN","BPSECA8",41,0)
 ;
"RTN","BPSECA8",42,0)
 ; Get data from original claim request
"RTN","BPSECA8",43,0)
 S DR="**",DIQ="TMP",DIQ(0)="I"
"RTN","BPSECA8",44,0)
 D GETS^DIQ(CLAIM,CLAIMIEN,DR,DIQ(0),DIQ)
"RTN","BPSECA8",45,0)
 ;
"RTN","BPSECA8",46,0)
 ; Update CLAIMIEN to match CLAIMIEN format in TMP
"RTN","BPSECA8",47,0)
 S CLAIMIEN=CLAIMIEN_","
"RTN","BPSECA8",48,0)
 ;
"RTN","BPSECA8",49,0)
 ; Execute special code in reversal payer sheets
"RTN","BPSECA8",50,0)
 D REFORM^BPSOSHR(BPSFORM,CLAIMIEN,POS)
"RTN","BPSECA8",51,0)
 ;
"RTN","BPSECA8",52,0)
 ; Create a new claim record and use function to get the Claim ID
"RTN","BPSECA8",53,0)
R2 S DIC=CLAIM,DIC(0)="LX",DLAYGO=CLAIM
"RTN","BPSECA8",54,0)
 S X=$$CLAIMID^BPSECX1(IEN59)
"RTN","BPSECA8",55,0)
 I X="" Q 0
"RTN","BPSECA8",56,0)
 D ^DIC
"RTN","BPSECA8",57,0)
 S REVIEN=+Y
"RTN","BPSECA8",58,0)
 I REVIEN<1 Q 0
"RTN","BPSECA8",59,0)
 ;
"RTN","BPSECA8",60,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSECA8",61,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Created claim ID "_X_" ("_REVIEN_")")
"RTN","BPSECA8",62,0)
 ;
"RTN","BPSECA8",63,0)
 ; Create a new prescription multiple for the claim
"RTN","BPSECA8",64,0)
R4 S DIC="^BPSC("_REVIEN_",400,",DIC(0)="LX"
"RTN","BPSECA8",65,0)
 S DIC("P")=$P(^DD(CLAIM,400,0),U,2)
"RTN","BPSECA8",66,0)
 S DA(1)=REVIEN,DLAYGO=RXMULT,X=1
"RTN","BPSECA8",67,0)
 D ^DIC
"RTN","BPSECA8",68,0)
 I +Y'=1 D  G:UERETVAL R4
"RTN","BPSECA8",69,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("FM,P",,"call to ^DIC","for multiple",,$T(+0))
"RTN","BPSECA8",70,0)
 ;
"RTN","BPSECA8",71,0)
 ; Update claim with new values
"RTN","BPSECA8",72,0)
 S DIE=CLAIM,DA=REVIEN,DR=""
"RTN","BPSECA8",73,0)
 F I=.03,.04,1.01,1.04,101,102,104,110,201,202,302,304,305,310,311,331,332,401 D
"RTN","BPSECA8",74,0)
 . S DR=DR_I_"////"_$G(TMP(CLAIM,CLAIMIEN,I,"I"))_";"
"RTN","BPSECA8",75,0)
 ; Add fields that do not come from the claim
"RTN","BPSECA8",76,0)
 ;   Payer sheet is the reversal sheet, Created On is current date/time
"RTN","BPSECA8",77,0)
 ;   Transaction Code is B2 and Transaction Count is 1
"RTN","BPSECA8",78,0)
 S DR=DR_".02////"_BPSFORM_";.06////"_$$NOWFM^BPSOSU1()
"RTN","BPSECA8",79,0)
 S DR=DR_";103////B2;109////1"
"RTN","BPSECA8",80,0)
 D ^DIE
"RTN","BPSECA8",81,0)
 ;
"RTN","BPSECA8",82,0)
 ; Update multiple with new values
"RTN","BPSECA8",83,0)
 S DIE="^BPSC("_REVIEN_",400,"
"RTN","BPSECA8",84,0)
 S DA(1)=REVIEN,DA=1,DR=""
"RTN","BPSECA8",85,0)
 F I=.03,.04,.05,308,401,402,403,407,418,420,436,438,455 D
"RTN","BPSECA8",86,0)
 . S DR=DR_I_"////"_$G(TMP(RXMULT,POS_","_CLAIMIEN,I,"I"))_";"
"RTN","BPSECA8",87,0)
 S DR=$E(DR,1,$L(DR)-1) ; get rid of extra trailing ";"
"RTN","BPSECA8",88,0)
 D ^DIE
"RTN","BPSECA8",89,0)
 ;
"RTN","BPSECA8",90,0)
 Q REVIEN
"RTN","BPSECMC2")
0^159^B15229460
"RTN","BPSECMC2",1,0)
BPSECMC2 ;BHAM ISC/SAB - ENTER/EDIT OUTPATIENT SITE PARAMETERS ;09/18/92 9:11
"RTN","BPSECMC2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSECMC2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECMC2",4,0)
 ;
"RTN","BPSECMC2",5,0)
 ; CHOP - Final processing prio to submitting a claim to HL7;
"RTN","BPSECMC2",6,0)
 ; Input
"RTN","BPSECMC2",7,0)
 ;   HLA      - HL7 packet (local array)
"RTN","BPSECMC2",8,0)
 ;   CLAIMIEN - BPS Claims
"RTN","BPSECMC2",9,0)
 ;   IEN59    - BPS Transactions
"RTN","BPSECMC2",10,0)
CHOP(HLA,CLAIMIEN,IEN59) ;
"RTN","BPSECMC2",11,0)
 ;
"RTN","BPSECMC2",12,0)
 N TCNT,CNT,RNLNGTH,TRANID,V2DTG,RTN,MSG
"RTN","BPSECMC2",13,0)
 N BPSRESLT,HL
"RTN","BPSECMC2",14,0)
 S CNT=0,RTN=$T(+0)
"RTN","BPSECMC2",15,0)
 ;
"RTN","BPSECMC2",16,0)
 ; Crash proofing - Need to put better error handling in
"RTN","BPSECMC2",17,0)
 I '$D(HLA)!'$L($G(CLAIMIEN)) D ERROR^BPSOSU(RTN,IEN59,511,"Invalid Claim Data") Q
"RTN","BPSECMC2",18,0)
 ;
"RTN","BPSECMC2",19,0)
 ; Initialize HL7 environment
"RTN","BPSECMC2",20,0)
 D INIT^HLFNC2("BPS ECMECL1 NTE",.HL)
"RTN","BPSECMC2",21,0)
 ;
"RTN","BPSECMC2",22,0)
 ; Handle failure if variables were not initialized
"RTN","BPSECMC2",23,0)
 I $G(HL) D ERROR^BPSOSU(RTN,IEN59,512,"Call to INIT^HLFNC2 failed") Q
"RTN","BPSECMC2",24,0)
 ;
"RTN","BPSECMC2",25,0)
 ; Determine run length of the transmission & pad with zeroes
"RTN","BPSECMC2",26,0)
 S RNLNGTH=0
"RTN","BPSECMC2",27,0)
 F TCNT=1:1 Q:$G(HLA("HLS",TCNT))=""  S RNLNGTH=RNLNGTH+$L(HLA("HLS",TCNT))
"RTN","BPSECMC2",28,0)
 S RNLNGTH=$RE($E($RE("0000"_(RNLNGTH+32)),1,4))
"RTN","BPSECMC2",29,0)
 S CNT=TCNT-1
"RTN","BPSECMC2",30,0)
 ;
"RTN","BPSECMC2",31,0)
 S TRANID=$P($G(^BPSC(CLAIMIEN,0)),"^")
"RTN","BPSECMC2",32,0)
 S HLA("HLS",1)="\X02\"_RNLNGTH_TRANID_$G(HLA("HLS",1))
"RTN","BPSECMC2",33,0)
 ;
"RTN","BPSECMC2",34,0)
 ; Translate non-printable to printable & Set OBX segs
"RTN","BPSECMC2",35,0)
 F TCNT=1:1:CNT Q:$G(HLA("HLS",TCNT))=""  D
"RTN","BPSECMC2",36,0)
 . F  D  Q:$P(HLA("HLS",TCNT),$C(29))=HLA("HLS",TCNT)
"RTN","BPSECMC2",37,0)
 .. S:HLA("HLS",TCNT)[$C(29) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(29))_"\X1D\"_$P(HLA("HLS",TCNT),$C(29),2,999)
"RTN","BPSECMC2",38,0)
 . F  D  Q:$P(HLA("HLS",TCNT),$C(30))=HLA("HLS",TCNT)
"RTN","BPSECMC2",39,0)
 .. S:HLA("HLS",TCNT)[$C(30) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(30))_"\X1E\"_$P(HLA("HLS",TCNT),$C(30),2,999)
"RTN","BPSECMC2",40,0)
 . F  D  Q:$P(HLA("HLS",TCNT),$C(28))=HLA("HLS",TCNT)
"RTN","BPSECMC2",41,0)
 .. S:HLA("HLS",TCNT)[$C(28) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(28))_"\X1C\"_$P(HLA("HLS",TCNT),$C(28),2,999)
"RTN","BPSECMC2",42,0)
 . I TCNT=CNT S HLA("HLS",CNT)=$P(HLA("HLS",CNT),$C(3))_"\X03\"
"RTN","BPSECMC2",43,0)
 . S HLA("HLS",TCNT)="OBX||FT|NCPDP|"_TCNT_"|"_HLA("HLS",TCNT)_"||||||F"
"RTN","BPSECMC2",44,0)
 ;
"RTN","BPSECMC2",45,0)
 ; Set OBR seg
"RTN","BPSECMC2",46,0)
 ; Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSECMC2",47,0)
 S V2DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSECMC2",48,0)
 ;
"RTN","BPSECMC2",49,0)
 ; Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSECMC2",50,0)
 S HLA("HLS",.5)="OBR||||NCPDP|||"_$$FMTHL7^XLFDT(V2DTG)_"|||||||||||"_$E(TRANID,1,32)
"RTN","BPSECMC2",51,0)
 K HLA("HLS",0)
"RTN","BPSECMC2",52,0)
 ;
"RTN","BPSECMC2",53,0)
 ; Change status to 60 and call HL7 to transmit a single message
"RTN","BPSECMC2",54,0)
 D SETSTAT^BPSOSU(IEN59,60)
"RTN","BPSECMC2",55,0)
 D GENERATE^HLMA("BPS ECMESV1 NTE","LM",1,.BPSRESLT,"")
"RTN","BPSECMC2",56,0)
 ;
"RTN","BPSECMC2",57,0)
 ; If error, log error and quit
"RTN","BPSECMC2",58,0)
 I +BPSRESLT'>0 D  Q
"RTN","BPSECMC2",59,0)
 . S MSG="HL7 error for "_$P($G(^BPSC(CLAIMIEN,0)),U)_".  Error message-"_$P(BPSRESLT,U,3)_"-Error code: "_+$P(BPSRESLT,U,2)
"RTN","BPSECMC2",60,0)
 . D ERROR^BPSOSU(RTN,IEN59,601,MSG)
"RTN","BPSECMC2",61,0)
 ;
"RTN","BPSECMC2",62,0)
 ; If successful, log message
"RTN","BPSECMC2",63,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSECMC2",64,0)
 D LOG^BPSOSL(IEN59,RTN_"-Claim Sent - "_$P($G(^BPSC(CLAIMIEN,0)),U))
"RTN","BPSECMC2",65,0)
 ;
"RTN","BPSECMC2",66,0)
 ; Update Transmitted On field in BPS Claim
"RTN","BPSECMC2",67,0)
 N FDA,MSG
"RTN","BPSECMC2",68,0)
 S FDA(9002313.02,CLAIMIEN_",",.05)=$$NOW^XLFDT
"RTN","BPSECMC2",69,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSECMC2",70,0)
 ;
"RTN","BPSECMC2",71,0)
 ; If filing did not work, log it
"RTN","BPSECMC2",72,0)
 I $D(MSG) D LOG^BPSOSL(IEN59,$T(+0)_"-Failed to update Transmitted On field")
"RTN","BPSECMC2",73,0)
 Q
"RTN","BPSECMC2",74,0)
 ;
"RTN","BPSECMC2",75,0)
 ; STORESP - The HL7 Response Processing Routine calls this procedure.  This module reads the
"RTN","BPSECMC2",76,0)
 ;   the information and stores it into BPS Responses
"RTN","BPSECMC2",77,0)
 ;   Note the code below assumes that there will only be one Claim per Transaction.
"RTN","BPSECMC2",78,0)
 ;   If the VA ever bundles multiple transactions into a single claim, the code
"RTN","BPSECMC2",79,0)
 ;   below will need to be change to walk the AE/AER index to handle each transaction
"RTN","BPSECMC2",80,0)
 ;
"RTN","BPSECMC2",81,0)
 ; HLNODE and HLNEXT are 'passed-in' by the HL7 application
"RTN","BPSECMC2",82,0)
STORESP ;
"RTN","BPSECMC2",83,0)
 ;
"RTN","BPSECMC2",84,0)
 ; Initialize variables
"RTN","BPSECMC2",85,0)
 N RI,TMSG,RMSG,RESPIEN,TRANTYPE,VANUM,CLAIMIEN,IEN59
"RTN","BPSECMC2",86,0)
 ;
"RTN","BPSECMC2",87,0)
 ; Get the OBX segment
"RTN","BPSECMC2",88,0)
 S TMSG=""
"RTN","BPSECMC2",89,0)
 F RI=1:1 X HLNEXT Q:HLNODE=""  I $E(HLNODE,1,3)="OBX"  D
"RTN","BPSECMC2",90,0)
 . S TMSG=HLNODE,RMSG=""
"RTN","BPSECMC2",91,0)
 . F  S RMSG=$O(HLNODE(RMSG)) Q:RMSG=""  S TMSG=TMSG_HLNODE(RMSG)
"RTN","BPSECMC2",92,0)
 ;
"RTN","BPSECMC2",93,0)
 ; Strip off HL7, STX, ETX, NTE, and Byte Count
"RTN","BPSECMC2",94,0)
 S TMSG=$P(TMSG,$E(TMSG,4),6),TMSG=$E(TMSG,10,$L(TMSG)-5)
"RTN","BPSECMC2",95,0)
 ;
"RTN","BPSECMC2",96,0)
 ; Get the claim ID (external and internal)
"RTN","BPSECMC2",97,0)
 S TRANTYPE=$E(TMSG,35,36),VANUM=$E(TMSG,1,32)
"RTN","BPSECMC2",98,0)
 S CLAIMIEN=$O(^BPSC("B",VANUM,""))
"RTN","BPSECMC2",99,0)
 ;
"RTN","BPSECMC2",100,0)
 ; Using the Claim ID, get the BPS transaction IEN
"RTN","BPSECMC2",101,0)
 ;   If CLAIMIEN is null, next line will crash ungracefully
"RTN","BPSECMC2",102,0)
 ;   We should log an error, but we need the Transaction IEN to
"RTN","BPSECMC2",103,0)
 ;   do so.  So, the next best thing is to log an error in the error
"RTN","BPSECMC2",104,0)
 ;   trap.
"RTN","BPSECMC2",105,0)
 S IEN59=$O(^BPST("AE",CLAIMIEN,""))
"RTN","BPSECMC2",106,0)
 I IEN59="" S IEN59=$O(^BPST("AER",CLAIMIEN,""))
"RTN","BPSECMC2",107,0)
 ;
"RTN","BPSECMC2",108,0)
 ; Update the status to 70 (Receiving Response)
"RTN","BPSECMC2",109,0)
 D SETSTAT^BPSOSU(IEN59,70)
"RTN","BPSECMC2",110,0)
 ;
"RTN","BPSECMC2",111,0)
 ; Store the response in BPS Response
"RTN","BPSECMC2",112,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Parsing Response "_$P($G(^BPSC(CLAIMIEN,0)),U))
"RTN","BPSECMC2",113,0)
 ;
"RTN","BPSECMC2",114,0)
 ; Parse the response and store it into BPS Responses
"RTN","BPSECMC2",115,0)
 ; If the testing tool is on, BPSECMPS will need variable TRANTYPE as well
"RTN","BPSECMC2",116,0)
 D PARSE^BPSECMPS(TMSG,CLAIMIEN,.RESPIEN)
"RTN","BPSECMC2",117,0)
 ;
"RTN","BPSECMC2",118,0)
 ; Log that parsing is done
"RTN","BPSECMC2",119,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSECMC2",120,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Response stored "_$P($G(^BPSC(CLAIMIEN,0)),U))
"RTN","BPSECMC2",121,0)
 ;
"RTN","BPSECMC2",122,0)
 ; Call BPSOSQL for final processing
"RTN","BPSECMC2",123,0)
 D ONE^BPSOSQL(CLAIMIEN,$G(RESPIEN))
"RTN","BPSECMC2",124,0)
 Q
"RTN","BPSECMP2")
0^2^B64422717
"RTN","BPSECMP2",1,0)
BPSECMP2 ;BHAM ISC/FCS/DRS - Parse Claim Response ;06/15/2004
"RTN","BPSECMP2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSECMP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECMP2",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSECMP2",5,0)
 Q
"RTN","BPSECMP2",6,0)
 ; Parameters:
"RTN","BPSECMP2",7,0)
 ;    CLAIMIEN: IEN from BPS Claims
"RTN","BPSECMP2",8,0)
 ;    RESPIEN:  IEN from BPS Response
"RTN","BPSECMP2",9,0)
 ;    EVENT:    This is used by PSO to create specific events (BILL).
"RTN","BPSECMP2",10,0)
 ;    USER:     User who is creating the event.  This is required when EVENT is sent.
"RTN","BPSECMP2",11,0)
IBSEND(CLAIMIEN,RESPIEN,EVENT,USER) ;
"RTN","BPSECMP2",12,0)
 N BPSARRY,RXIEN,FILLNUM,IND,TRNDX,RELDATE,X,Y,%DT
"RTN","BPSECMP2",13,0)
 N CLAIMNFO,RESPNFO,RXINFO,RFINFO,TRANINFO
"RTN","BPSECMP2",14,0)
 N RESPONSE,RXACT,CLREAS,BILLNUM,DFN,REQCLAIM
"RTN","BPSECMP2",15,0)
 N DIE,DA,DR
"RTN","BPSECMP2",16,0)
 ;
"RTN","BPSECMP2",17,0)
 ; Quit if there is not a Response or Claim IEN
"RTN","BPSECMP2",18,0)
 I '$G(RESPIEN) Q
"RTN","BPSECMP2",19,0)
 I '$G(CLAIMIEN) Q
"RTN","BPSECMP2",20,0)
 ;
"RTN","BPSECMP2",21,0)
 ; Get Claims and Response Data
"RTN","BPSECMP2",22,0)
 D GETS^DIQ("9002313.02",CLAIMIEN,"103;400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSECMP2",23,0)
 D GETS^DIQ("9002313.0301","1,"_RESPIEN,"112;503;509","I","RESPNFO")
"RTN","BPSECMP2",24,0)
 ;
"RTN","BPSECMP2",25,0)
 ; Get the Transaction IEN and Data
"RTN","BPSECMP2",26,0)
 S IND=$S(CLAIMNFO("9002313.02",CLAIMIEN_",","103")="B2":"AER",1:"AE")
"RTN","BPSECMP2",27,0)
 S TRNDX=$O(^BPST(IND,CLAIMIEN,""))
"RTN","BPSECMP2",28,0)
 I TRNDX="" Q
"RTN","BPSECMP2",29,0)
 D GETS^DIQ("9002313.59",TRNDX,"3;13;404;501;1201","I","TRANINFO")
"RTN","BPSECMP2",30,0)
 ;
"RTN","BPSECMP2",31,0)
 ; Determine Prescription IEN
"RTN","BPSECMP2",32,0)
 S RXIEN=$P(^BPSC(CLAIMIEN,400,1,0),"^",5)
"RTN","BPSECMP2",33,0)
 ;
"RTN","BPSECMP2",34,0)
 ; If Certify Mode is On, don't send to IB
"RTN","BPSECMP2",35,0)
 I $$GET1^DIQ(9002313.59902,"1,"_TRNDX_",","902.22")["MODE ON" Q
"RTN","BPSECMP2",36,0)
 ;
"RTN","BPSECMP2",37,0)
 ; Testing for Certification Only - DLF
"RTN","BPSECMP2",38,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" Q
"RTN","BPSECMP2",39,0)
 ;
"RTN","BPSECMP2",40,0)
 ; Store RXACT into a local variable as it is will be used a lot
"RTN","BPSECMP2",41,0)
 S RXACT=TRANINFO("9002313.59",TRNDX_",",1201,"I")
"RTN","BPSECMP2",42,0)
 ;
"RTN","BPSECMP2",43,0)
 ; Setup User data
"RTN","BPSECMP2",44,0)
 ; If event is passed in, the user should be passed in as well
"RTN","BPSECMP2",45,0)
 ; If no Event, but action is Auto-Reversal (AREV) or CMOP (CR*/PC/RL),
"RTN","BPSECMP2",46,0)
 ;     user postmaster (.5)
"RTN","BPSECMP2",47,0)
 ; Else use the user from BPS Transaction
"RTN","BPSECMP2",48,0)
 I EVENT]"" S BPSARRY("USER")=USER
"RTN","BPSECMP2",49,0)
 E  I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_RXACT_",") S BPSARRY("USER")=.5
"RTN","BPSECMP2",50,0)
 E  S BPSARRY("USER")=TRANINFO("9002313.59",TRNDX_",",13,"I")
"RTN","BPSECMP2",51,0)
 ;
"RTN","BPSECMP2",52,0)
 ; Determine Payer Response
"RTN","BPSECMP2",53,0)
 ; Treat Duplicate of Accepted Reversal ("S") as accepted
"RTN","BPSECMP2",54,0)
 S RESPONSE=RESPNFO(9002313.0301,"1,"_RESPIEN_",",112,"I")
"RTN","BPSECMP2",55,0)
 S RESPONSE=$S(RESPONSE="A":"ACCEPTED",RESPONSE="C":"CAPTURED",RESPONSE="D":"DUPLICATE",RESPONSE="P":"PAYABLE",RESPONSE="R":"REJECTED",RESPONSE="S":"ACCEPTED",1:"OTHER")
"RTN","BPSECMP2",56,0)
 ;
"RTN","BPSECMP2",57,0)
 ; Get Prescription Information
"RTN","BPSECMP2",58,0)
 D RXAPI^BPSUTIL1(RXIEN,".01;4;6;8;16;27","RXINFO","IE")
"RTN","BPSECMP2",59,0)
 ;
"RTN","BPSECMP2",60,0)
 ; Get Refill Info if this is a refill
"RTN","BPSECMP2",61,0)
 S FILLNUM=+$E($P(TRNDX,".",2),1,4)
"RTN","BPSECMP2",62,0)
 I FILLNUM>0 D RXSUBF^BPSUTIL1(RXIEN,52,52.1,FILLNUM,".01;1.1;11","RFINFO","E")
"RTN","BPSECMP2",63,0)
 ;
"RTN","BPSECMP2",64,0)
 ; Fill Date
"RTN","BPSECMP2",65,0)
 S BPSARRY("FILL DATE")=CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","401")
"RTN","BPSECMP2",66,0)
 S %DT="X",X=BPSARRY("FILL DATE") D ^%DT S:Y'=-1 BPSARRY("FILL DATE")=Y
"RTN","BPSECMP2",67,0)
 ;
"RTN","BPSECMP2",68,0)
 ; Information needed for PAID/BILLING event
"RTN","BPSECMP2",69,0)
 S BPSARRY("PAID")=0
"RTN","BPSECMP2",70,0)
 I RESPONSE="PAYABLE" D
"RTN","BPSECMP2",71,0)
 . S BPSARRY("PAID")=$$DFF2EXT^BPSECFM(RESPNFO(9002313.0301,"1,"_RESPIEN_",",509,"I"))
"RTN","BPSECMP2",72,0)
 . S BPSARRY("AUTH #")=RESPNFO(9002313.0301,"1,"_RESPIEN_",",503,"I")
"RTN","BPSECMP2",73,0)
 . S BPSARRY("RX NO")=RXINFO(52,RXIEN,.01,"E")
"RTN","BPSECMP2",74,0)
 . S BPSARRY("DRUG")=$$RXAPI1^BPSUTIL1(RXIEN,6,"I")
"RTN","BPSECMP2",75,0)
 . S BPSARRY("QTY")=$G(TRANINFO(9002313.59,TRNDX_",",501,"I"))
"RTN","BPSECMP2",76,0)
 . I FILLNUM<1  D
"RTN","BPSECMP2",77,0)
 .. S BPSARRY("DAYS SUPPLY")=RXINFO(52,RXIEN,8,"E")
"RTN","BPSECMP2",78,0)
 . E  D
"RTN","BPSECMP2",79,0)
 .. S BPSARRY("DAYS SUPPLY")=$G(RFINFO(52.1,FILLNUM,1.1,"E"))
"RTN","BPSECMP2",80,0)
 ;
"RTN","BPSECMP2",81,0)
 ; Get Plan info
"RTN","BPSECMP2",82,0)
 I $D(^BPST(TRNDX,10,1,0)) S BPSARRY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^")
"RTN","BPSECMP2",83,0)
 ;
"RTN","BPSECMP2",84,0)
 ; Setup miscellaneous values
"RTN","BPSECMP2",85,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSECMP2",86,0)
 S BPSARRY("NDC")=$$GETNDC^PSONDCUT(RXIEN,FILLNUM)
"RTN","BPSECMP2",87,0)
 S BPSARRY("FILL NUMBER")=FILLNUM
"RTN","BPSECMP2",88,0)
 S BPSARRY("FILLED BY")=RXINFO(52,RXIEN,16,"I")
"RTN","BPSECMP2",89,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSECMP2",90,0)
 S BPSARRY("BILLED")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","426"),"DQ",2)
"RTN","BPSECMP2",91,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM(BPSARRY("BILLED"))
"RTN","BPSECMP2",92,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","402"),"D2",2)
"RTN","BPSECMP2",93,0)
 S RELDATE=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSECMP2",94,0)
 S BPSARRY("RELEASE DATE")=$P(RELDATE,".")
"RTN","BPSECMP2",95,0)
 S BPSARRY("RESPONSE")=RESPONSE
"RTN","BPSECMP2",96,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,TRNDX,1.07,"I")
"RTN","BPSECMP2",97,0)
 ;
"RTN","BPSECMP2",98,0)
 ; For reversals, get reversal reason and check for closed reason
"RTN","BPSECMP2",99,0)
 ; Call IB with Reversal Event
"RTN","BPSECMP2",100,0)
 ; If there is a close reason, call IB with CLOSE event
"RTN","BPSECMP2",101,0)
 ;    and update BPS Claim with close information
"RTN","BPSECMP2",102,0)
 I EVENT="",$$ISREVERS^BPSOSU(CLAIMIEN) D  Q
"RTN","BPSECMP2",103,0)
 . S REQCLAIM=TRANINFO("9002313.59",TRNDX_",",3,"I")
"RTN","BPSECMP2",104,0)
 . S BPSARRY("REVERSAL REASON")=TRANINFO("9002313.59",TRNDX_",",404,"I")
"RTN","BPSECMP2",105,0)
 . S BPSARRY("RTS-DEL")=0
"RTN","BPSECMP2",106,0)
 . ; Get RX action, which determine close event
"RTN","BPSECMP2",107,0)
 . I RXACT="RS" S CLREAS="PRESCRIPTION NOT RELEASED",BPSARRY("RTS-DEL")=1
"RTN","BPSECMP2",108,0)
 . I RXACT="DE" D
"RTN","BPSECMP2",109,0)
 . . S CLREAS="PRESCRIPTION DELETED",BPSARRY("RTS-DEL")=1
"RTN","BPSECMP2",110,0)
 . . ; check whether RX was in fact deleted in Pharmacy
"RTN","BPSECMP2",111,0)
 . . ; if not then the refill was deleted
"RTN","BPSECMP2",112,0)
 . . I $$RXSTATUS^BPSSCRU2(RXIEN)'=13 S BPSARRY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSECMP2",113,0)
 . ; If accepted inpatient autoreversal, then close the claim
"RTN","BPSECMP2",114,0)
 . I RXACT="AREV",RESPONSE="ACCEPTED",REQCLAIM,$P($G(^BPSC(REQCLAIM,0)),U,7)=2 D
"RTN","BPSECMP2",115,0)
 .. S CLREAS="OTHER",BPSARRY("CLOSE COMMENT")="INPATIENT PRESCRIPTION"
"RTN","BPSECMP2",116,0)
 . I $D(CLREAS) S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",CLREAS,0))
"RTN","BPSECMP2",117,0)
 . ;
"RTN","BPSECMP2",118,0)
 . ; Call IB for Reversal Event
"RTN","BPSECMP2",119,0)
 . S BPSARRY("STATUS")="REVERSED",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",120,0)
 . ; If there is no close reason, quit
"RTN","BPSECMP2",121,0)
 . I '$D(BPSARRY("CLOSE REASON")) Q
"RTN","BPSECMP2",122,0)
 . ; Call IB for CLOSE event
"RTN","BPSECMP2",123,0)
 . ;  Note for close, user is always postmaster (.5)
"RTN","BPSECMP2",124,0)
 . S BPSARRY("STATUS")="CLOSED",BPSARRY("USER")=.5
"RTN","BPSECMP2",125,0)
 . S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",126,0)
 . ;
"RTN","BPSECMP2",127,0)
 . ; Populate the original claim request with the close reason
"RTN","BPSECMP2",128,0)
 . I REQCLAIM D
"RTN","BPSECMP2",129,0)
 .. S DIE="^BPSC(",DA=REQCLAIM
"RTN","BPSECMP2",130,0)
 .. S DR="901///1;902///"_$$NOW^XLFDT()_";903///.5;904///"_BPSARRY("CLOSE REASON")
"RTN","BPSECMP2",131,0)
 .. D ^DIE
"RTN","BPSECMP2",132,0)
 ; 
"RTN","BPSECMP2",133,0)
 ; If we got here, then it is not a reversal
"RTN","BPSECMP2",134,0)
 ; If EVENT is set, send Submit event
"RTN","BPSECMP2",135,0)
 I EVENT="" S BPSARRY("STATUS")="SUBMITTED",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",136,0)
 ;
"RTN","BPSECMP2",137,0)
 ; Sent Paid (Billable) event is the claim was paid and released or EVENT is BILL
"RTN","BPSECMP2",138,0)
 ;   Note: User is always postmaster except for BackBilling (BB)
"RTN","BPSECMP2",139,0)
 I EVENT="BILL"!(RESPONSE="PAYABLE"&(BPSARRY("RELEASE DATE")]"")) D
"RTN","BPSECMP2",140,0)
 . I RXACT'="BB" S BPSARRY("USER")=.5
"RTN","BPSECMP2",141,0)
 . S BPSARRY("STATUS")="PAID",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",142,0)
 Q
"RTN","BPSECMP2",143,0)
 ;
"RTN","BPSECMP2",144,0)
 ; Synch DURs between ECME and PSO
"RTN","BPSECMP2",145,0)
 ; Parameters:
"RTN","BPSECMP2",146,0)
 ;   IEN59 is the BPS Transaction IEN
"RTN","BPSECMP2",147,0)
DURSYNC(IEN59) ;
"RTN","BPSECMP2",148,0)
 N RXIEN,RXFILL
"RTN","BPSECMP2",149,0)
 ;
"RTN","BPSECMP2",150,0)
 ; Check Parameter
"RTN","BPSECMP2",151,0)
 I IEN59="" Q
"RTN","BPSECMP2",152,0)
 ;
"RTN","BPSECMP2",153,0)
 ; Get Prescription and Fill number
"RTN","BPSECMP2",154,0)
 S RXIEN=$$GET1^DIQ(9002313.59,IEN59_",",1.11,"I")
"RTN","BPSECMP2",155,0)
 S RXFILL=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",",902.17,"E")
"RTN","BPSECMP2",156,0)
 I RXIEN=""!(RXFILL="") Q
"RTN","BPSECMP2",157,0)
 ;
"RTN","BPSECMP2",158,0)
 ; Call PSO to sync reject codes
"RTN","BPSECMP2",159,0)
 D SYNC^PSOREJUT(RXIEN,RXFILL,"")
"RTN","BPSECMP2",160,0)
 Q
"RTN","BPSECMP2",161,0)
 ;
"RTN","BPSECMP2",162,0)
PROCOTH ;
"RTN","BPSECMP2",163,0)
 Q:$G(FDATA(TRANSACT,563.01,1))=""
"RTN","BPSECMP2",164,0)
 N NNDX,FILE,ROOT,FDATA3,FLDNUM
"RTN","BPSECMP2",165,0)
 S FILE="9002313.1401"
"RTN","BPSECMP2",166,0)
 S ROOT="FDATA3(9002313.1401)"
"RTN","BPSECMP2",167,0)
 S NNDX=""
"RTN","BPSECMP2",168,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),563.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",169,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,563.01,NNDX),ROOT)
"RTN","BPSECMP2",170,0)
 D UPDATE^DIE("S","FDATA3(9002313.1401)")
"RTN","BPSECMP2",171,0)
 Q
"RTN","BPSECMP2",172,0)
PROCDUR ;
"RTN","BPSECMP2",173,0)
 Q:$G(FDATA(TRANSACT,567,1))=""
"RTN","BPSECMP2",174,0)
 N NNDX,FILE,ROOT,FDAT1101,FLDNUM
"RTN","BPSECMP2",175,0)
 S FILE="9002313.1101"
"RTN","BPSECMP2",176,0)
 S ROOT="FDAT1101(9002313.1101)"
"RTN","BPSECMP2",177,0)
 S NNDX=""
"RTN","BPSECMP2",178,0)
 F  S NNDX=$O(FDATA(TRANSACT,567,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",179,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,567,NNDX),ROOT)
"RTN","BPSECMP2",180,0)
 .I $D(FDATA(TRANSACT,439,NNDX))  D
"RTN","BPSECMP2",181,0)
 ..S FLDNUM="439"
"RTN","BPSECMP2",182,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,439,NNDX),ROOT)
"RTN","BPSECMP2",183,0)
 .I $D(FDATA(TRANSACT,528,NNDX))  D
"RTN","BPSECMP2",184,0)
 ..S FLDNUM="528"
"RTN","BPSECMP2",185,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,528,NNDX),ROOT)
"RTN","BPSECMP2",186,0)
 .I $D(FDATA(TRANSACT,529,NNDX))  D
"RTN","BPSECMP2",187,0)
 ..S FLDNUM="529"
"RTN","BPSECMP2",188,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,529,NNDX),ROOT)
"RTN","BPSECMP2",189,0)
 .I $D(FDATA(TRANSACT,530,NNDX))  D
"RTN","BPSECMP2",190,0)
 ..S FLDNUM="530"
"RTN","BPSECMP2",191,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,530,NNDX),ROOT)
"RTN","BPSECMP2",192,0)
 .I $D(FDATA(TRANSACT,531,NNDX))  D
"RTN","BPSECMP2",193,0)
 ..S FLDNUM="531"
"RTN","BPSECMP2",194,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,531,NNDX),ROOT)
"RTN","BPSECMP2",195,0)
 .I $D(FDATA(TRANSACT,532,NNDX))  D
"RTN","BPSECMP2",196,0)
 ..S FLDNUM="532"
"RTN","BPSECMP2",197,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,532,NNDX),ROOT)
"RTN","BPSECMP2",198,0)
 .I $D(FDATA(TRANSACT,533,NNDX))  D
"RTN","BPSECMP2",199,0)
 ..S FLDNUM="533"
"RTN","BPSECMP2",200,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,533,NNDX),ROOT)
"RTN","BPSECMP2",201,0)
 .I $D(FDATA(TRANSACT,544,NNDX)) D
"RTN","BPSECMP2",202,0)
 ..S FLDNUM="544"
"RTN","BPSECMP2",203,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,544,NNDX),ROOT)
"RTN","BPSECMP2",204,0)
 D UPDATE^DIE("S","FDAT1101(9002313.1101)")
"RTN","BPSECMP2",205,0)
 Q
"RTN","BPSECMPS")
0^203^B69163590
"RTN","BPSECMPS",1,0)
BPSECMPS ;BHAM ISC/FCS/DRS - Parse Claim Response ;06/15/2004
"RTN","BPSECMPS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSECMPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECMPS",4,0)
 ;
"RTN","BPSECMPS",5,0)
PARSE(RREC,CLAIMIEN,RESPIEN) ;
"RTN","BPSECMPS",6,0)
 N GS,FS,SS,FILE,ROOT,TRANSACT,TRANSCNT
"RTN","BPSECMPS",7,0)
 N FDATA,FDAIEN,FDAIEN03
"RTN","BPSECMPS",8,0)
 ;
"RTN","BPSECMPS",9,0)
 ;Make sure input variables are defined
"RTN","BPSECMPS",10,0)
 Q:$G(RREC)=""
"RTN","BPSECMPS",11,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECMPS",12,0)
 ;
"RTN","BPSECMPS",13,0)
 ;group and field separator characters
"RTN","BPSECMPS",14,0)
 S GS="\X1D\",FS="\X1C\",SS="\X1E\"
"RTN","BPSECMPS",15,0)
 S FILE="9002313.03"
"RTN","BPSECMPS",16,0)
 S ROOT="FDATA(9002313.03)"
"RTN","BPSECMPS",17,0)
 D TRANSMSN            ;process the transmission level data
"RTN","BPSECMPS",18,0)
 D TRANSACT            ;process the transaction level data
"RTN","BPSECMPS",19,0)
 ;
"RTN","BPSECMPS",20,0)
 ; If the test payer routine exists, call the override routine
"RTN","BPSECMPS",21,0)
 ; IEN59 and TRANTYPE are set in BPSECMC2
"RTN","BPSECMPS",22,0)
 ; Commented for production.  MUST be commented out for any release.
"RTN","BPSECMPS",23,0)
 ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D SETOVER^ZZGIZOV1(IEN59,TRANTYPE,.FDATA)
"RTN","BPSECMPS",24,0)
 D UPDATE^DIE("S","FDATA(9002313.03)","FDAIEN")
"RTN","BPSECMPS",25,0)
 F TRANSACT=1:1:TRANSCNT  D
"RTN","BPSECMPS",26,0)
 .D PROCRESP
"RTN","BPSECMPS",27,0)
 .D PROCREJ
"RTN","BPSECMPS",28,0)
 .D PROCAPP
"RTN","BPSECMPS",29,0)
 .D PROCPPR
"RTN","BPSECMPS",30,0)
 .D PROCOTH^BPSECMP2
"RTN","BPSECMPS",31,0)
 .D PROCDUR^BPSECMP2
"RTN","BPSECMPS",32,0)
 .S RESPIEN=FDAIEN(TRANSACT)
"RTN","BPSECMPS",33,0)
 .D IBSEND^BPSECMP2(CLAIMIEN,RESPIEN,"","")
"RTN","BPSECMPS",34,0)
 Q
"RTN","BPSECMPS",35,0)
 ;
"RTN","BPSECMPS",36,0)
TRANSMSN ;This subroutine will work through the transmission level information
"RTN","BPSECMPS",37,0)
 ;
"RTN","BPSECMPS",38,0)
 N RTRANM,RHEADER,SEG,SEGMENT,SEGID
"RTN","BPSECMPS",39,0)
 ;
"RTN","BPSECMPS",40,0)
 ;Parse response transmission level from ascii record
"RTN","BPSECMPS",41,0)
 S RTRANM=$P(RREC,GS,1)
"RTN","BPSECMPS",42,0)
 ;
"RTN","BPSECMPS",43,0)
 ; get just the header segment 
"RTN","BPSECMPS",44,0)
 S RHEADER=$P(RTRANM,SS,1)    ;header- required/fixed length
"RTN","BPSECMPS",45,0)
 D PARSEH
"RTN","BPSECMPS",46,0)
 ;
"RTN","BPSECMPS",47,0)
 ; There are 2 optional segments on the transmission level - message
"RTN","BPSECMPS",48,0)
 ; and insurance.  We'll check for both and parse what we find.
"RTN","BPSECMPS",49,0)
 F SEG=2:1:3 D
"RTN","BPSECMPS",50,0)
 . S SEGMENT=$P(RTRANM,SS,SEG)
"RTN","BPSECMPS",51,0)
 . Q:SEGMENT=""
"RTN","BPSECMPS",52,0)
 . S SEGID=$P(SEGMENT,FS,2)
"RTN","BPSECMPS",53,0)
 . I $E(SEGID,1,2)="AM" D                ;segment identification
"RTN","BPSECMPS",54,0)
 .. S SEGFID=$E(SEGID,3,4)
"RTN","BPSECMPS",55,0)
 .. D:(SEGFID=20)!(SEGFID=25) PARSETM
"RTN","BPSECMPS",56,0)
 ;
"RTN","BPSECMPS",57,0)
 Q
"RTN","BPSECMPS",58,0)
 ;
"RTN","BPSECMPS",59,0)
TRANSACT ;This subroutine will work through the transaction level information
"RTN","BPSECMPS",60,0)
 ;
"RTN","BPSECMPS",61,0)
 N RTRAN,SEG,SEGMENT,MEDN,GRP
"RTN","BPSECMPS",62,0)
 S MEDN=0
"RTN","BPSECMPS",63,0)
 ;
"RTN","BPSECMPS",64,0)
 F GRP=2:1 D  Q:RTRAN=""
"RTN","BPSECMPS",65,0)
 . S RTRAN=$P(RREC,GS,GRP)     ;get the next transaction (could be 4)
"RTN","BPSECMPS",66,0)
 . Q:RTRAN=""                  ;we're done if it's empty
"RTN","BPSECMPS",67,0)
 . S MEDN=MEDN+1               ;transaction counter
"RTN","BPSECMPS",68,0)
 . ;
"RTN","BPSECMPS",69,0)
 . F SEG=2:1 D  Q:SEGMENT=""   ;break the record down by segments
"RTN","BPSECMPS",70,0)
 .. S SEGMENT=$P(RTRAN,SS,SEG) ;get the segment
"RTN","BPSECMPS",71,0)
 .. Q:SEGMENT=""
"RTN","BPSECMPS",72,0)
 .. D PARSETN                  ;get the fields
"RTN","BPSECMPS",73,0)
 Q
"RTN","BPSECMPS",74,0)
 ;
"RTN","BPSECMPS",75,0)
PARSEH ; The header record is required on all responses, and is fixed 
"RTN","BPSECMPS",76,0)
 ; length.  It is the only record that is fixed length.
"RTN","BPSECMPS",77,0)
 ;
"RTN","BPSECMPS",78,0)
 N FIELD,%,%H,%I
"RTN","BPSECMPS",79,0)
 S FIELD=".01" D FDA^DILF(FILE,"+1",FIELD,"",CLAIMIEN,ROOT)
"RTN","BPSECMPS",80,0)
 D NOW^%DTC
"RTN","BPSECMPS",81,0)
 S FIELD=".02" D FDA^DILF(FILE,"+1",FIELD,"",%,ROOT)
"RTN","BPSECMPS",82,0)
 S FIELD=".03" D FDA^DILF(FILE,"+1",FIELD,"",$H,ROOT)
"RTN","BPSECMPS",83,0)
 S FIELD=102 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,33,34),ROOT)    ;version/release number
"RTN","BPSECMPS",84,0)
 S FIELD=103 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,35,36),ROOT)    ;transaction code
"RTN","BPSECMPS",85,0)
 S FIELD=109 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,37,37),ROOT)    ;transaction count
"RTN","BPSECMPS",86,0)
 S TRANSCNT=$E(RHEADER,37,37)
"RTN","BPSECMPS",87,0)
 S FIELD=501 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,38,38),ROOT)    ;response status header
"RTN","BPSECMPS",88,0)
 S FIELD=202 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,39,40),ROOT)    ;service provider id qualifier
"RTN","BPSECMPS",89,0)
 S FIELD=201 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,41,55),ROOT)    ;service provider id
"RTN","BPSECMPS",90,0)
 S FIELD=401 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,56,63),ROOT)    ;date of service
"RTN","BPSECMPS",91,0)
 Q
"RTN","BPSECMPS",92,0)
 ;
"RTN","BPSECMPS",93,0)
PARSETM ; This subroutine will parse the variable portions of the transmission 
"RTN","BPSECMPS",94,0)
 ;
"RTN","BPSECMPS",95,0)
 N FIELD,PC,FLDNUM
"RTN","BPSECMPS",96,0)
 ;
"RTN","BPSECMPS",97,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -already know its value 
"RTN","BPSECMPS",98,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",99,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",100,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",101,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSECMPS",102,0)
 . S FIELD=$E(FIELD,3,999)
"RTN","BPSECMPS",103,0)
 . D FDA^DILF(FILE,"+1",FLDNUM,"",FIELD,ROOT)
"RTN","BPSECMPS",104,0)
 Q
"RTN","BPSECMPS",105,0)
 ; 
"RTN","BPSECMPS",106,0)
PARSETN ; This subroutine will parse the transaction level segments. For 
"RTN","BPSECMPS",107,0)
 ;
"RTN","BPSECMPS",108,0)
 ; Possible values of the SEGFID field:
"RTN","BPSECMPS",109,0)
 ;  21 = Response Status Segment
"RTN","BPSECMPS",110,0)
 ;  22 = Response Claim Segment
"RTN","BPSECMPS",111,0)
 ;  23 = Response Pricing Segment
"RTN","BPSECMPS",112,0)
 ;  24 = Response DUR/PPS Segment
"RTN","BPSECMPS",113,0)
 ;  26 = Response Prior Authorization Segment
"RTN","BPSECMPS",114,0)
 ;
"RTN","BPSECMPS",115,0)
 N FIELD,PC,FLDNUM,RPTFLD,RCNT,REPEAT
"RTN","BPSECMPS",116,0)
 N SEGID,SEGFID,CKRPT
"RTN","BPSECMPS",117,0)
 ;
"RTN","BPSECMPS",118,0)
 S RPTFLD=""
"RTN","BPSECMPS",119,0)
 S SEGID=$P(SEGMENT,FS,2)           ;this should be the segment id
"RTN","BPSECMPS",120,0)
 Q:SEGID=""                         ;don't process without a Seg id
"RTN","BPSECMPS",121,0)
 Q:$E(SEGID,1,2)'="AM"              ;don't know what we have - skip
"RTN","BPSECMPS",122,0)
 ;
"RTN","BPSECMPS",123,0)
 S SEGFID=$E(SEGID,3,4)             ;this should be the field ID
"RTN","BPSECMPS",124,0)
 ;
"RTN","BPSECMPS",125,0)
 ; setup the repeating flds based on the segment
"RTN","BPSECMPS",126,0)
 I SEGFID=21 D               ;status segment
"RTN","BPSECMPS",127,0)
 . S RPTFLD=",548,511,546,"
"RTN","BPSECMPS",128,0)
 . S (RCNT(548),RCNT(511),RCNT(546))=0
"RTN","BPSECMPS",129,0)
 ;
"RTN","BPSECMPS",130,0)
 I SEGFID=22 D                 ;claim segment
"RTN","BPSECMPS",131,0)
 . S RPTFLD=",552,553,554,555,556,"
"RTN","BPSECMPS",132,0)
 . S (RCNT(552),RCNT(553),RCNT(554),RCNT(555),RCNT(556))=0
"RTN","BPSECMPS",133,0)
 ;
"RTN","BPSECMPS",134,0)
 I SEGFID=23 D                ;pricing segment
"RTN","BPSECMPS",135,0)
 . S RPTFLD=",564,565,"
"RTN","BPSECMPS",136,0)
 . S (RCNT(564),RCNT(565))=0
"RTN","BPSECMPS",137,0)
 ;
"RTN","BPSECMPS",138,0)
 I SEGFID=24 D                ;DUR/PPS segment
"RTN","BPSECMPS",139,0)
 . S RPTFLD=",439,528,529,530,531,532,533,9002313,544,567,"
"RTN","BPSECMPS",140,0)
 . S (RCNT(439),RCNT(528),RCNT(529),RCNT(530),RCNT(531))=0
"RTN","BPSECMPS",141,0)
 . S (RCNT(532),RCNT(533),RCNT(9002313),RCNT(567))=0,RCNT(544)=0
"RTN","BPSECMPS",142,0)
 ;
"RTN","BPSECMPS",143,0)
 ; now lets parse out the fields
"RTN","BPSECMPS",144,0)
 ;
"RTN","BPSECMPS",145,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -jump to the other flds
"RTN","BPSECMPS",146,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",147,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",148,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",149,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSECMPS",150,0)
 . S REPEAT=0                  ;for this segment, lets figure
"RTN","BPSECMPS",151,0)
 . S CKRPT=","_FLDNUM_","      ;out if the field is a repeating
"RTN","BPSECMPS",152,0)
 . S:RPTFLD[CKRPT REPEAT=1     ;field
"RTN","BPSECMPS",153,0)
 . ;
"RTN","BPSECMPS",154,0)
 . I REPEAT D                  ;if rptg, store with a counter
"RTN","BPSECMPS",155,0)
 .. S RCNT(FLDNUM)=$G(RCNT(FLDNUM))+1
"RTN","BPSECMPS",156,0)
 .. S FDATA(MEDN,FLDNUM,RCNT(FLDNUM))=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",157,0)
 . ;
"RTN","BPSECMPS",158,0)
 . I 'REPEAT D                 ;not rptg, store without counter
"RTN","BPSECMPS",159,0)
 .. S FDATA(MEDN,FLDNUM)=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",160,0)
 Q
"RTN","BPSECMPS",161,0)
 ;
"RTN","BPSECMPS",162,0)
GETNUM(FIELD) ; This routine will translate the field ID into a field number.    
"RTN","BPSECMPS",163,0)
 ; We will use the NCPDP field Defs files, cross ref "D" to
"RTN","BPSECMPS",164,0)
 ; perform this translation.  (The field number is needed to store
"RTN","BPSECMPS",165,0)
 ; the data in the correct field within the response file.)
"RTN","BPSECMPS",166,0)
 ;
"RTN","BPSECMPS",167,0)
 N FLDID,FLDIEN,FLDNUM
"RTN","BPSECMPS",168,0)
 S (FLDID,FLDNUM)=""
"RTN","BPSECMPS",169,0)
 S FLDIEN=0
"RTN","BPSECMPS",170,0)
 ;
"RTN","BPSECMPS",171,0)
 S FLDID=$E(FIELD,1,2)       ;field identifier
"RTN","BPSECMPS",172,0)
 Q:FLDID=""
"RTN","BPSECMPS",173,0)
 ;
"RTN","BPSECMPS",174,0)
 I FLDID'="" D
"RTN","BPSECMPS",175,0)
 . S FLDIEN=$O(^BPSF(9002313.91,"D",FLDID,FLDIEN))  ;internal fld #
"RTN","BPSECMPS",176,0)
 . S:FLDIEN FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U) ;fld number
"RTN","BPSECMPS",177,0)
 Q FLDNUM
"RTN","BPSECMPS",178,0)
 ;
"RTN","BPSECMPS",179,0)
PROCRESP ;
"RTN","BPSECMPS",180,0)
 N FILE,ROOT,FDATA03,FLDNUM,FIELD
"RTN","BPSECMPS",181,0)
 S FILE="9002313.0301"
"RTN","BPSECMPS",182,0)
 S ROOT="FDATA03(9002313.0301)"
"RTN","BPSECMPS",183,0)
 K FDATA03
"RTN","BPSECMPS",184,0)
 I '$D(FDATA(TRANSACT,501)) S FDATA(TRANSACT,501)=FDATA(TRANSACT,112)
"RTN","BPSECMPS",185,0)
 I '$D(FDATA(TRANSACT,112)) S FDATA(TRANSACT,112)=FDATA(TRANSACT,501)
"RTN","BPSECMPS",186,0)
 S FLDNUM=".01" D FDA^DILF(FILE,"+1,"_FDAIEN(TRANSACT),FLDNUM,"",TRANSACT,ROOT)
"RTN","BPSECMPS",187,0)
 S FIELD=""
"RTN","BPSECMPS",188,0)
 F  S FIELD=$O(FDATA(TRANSACT,FIELD)) Q:FIELD=""  D   ;set all the non-repeating fields for 9002313.0301
"RTN","BPSECMPS",189,0)
 .I $G(FDATA(TRANSACT,FIELD))'=""  D
"RTN","BPSECMPS",190,0)
 ..I FIELD=402 S FDATA(TRANSACT,FIELD)=$TR(FDATA(TRANSACT,FIELD),"\","") ;REMOVE EXTRANEOUS "\"
"RTN","BPSECMPS",191,0)
 ..D FDA^DILF(FILE,"+"_TRANSACT_","_FDAIEN(TRANSACT),FIELD,"",FDATA(TRANSACT,FIELD),ROOT)
"RTN","BPSECMPS",192,0)
 .E  D
"RTN","BPSECMPS",193,0)
 ..;
"RTN","BPSECMPS",194,0)
 D UPDATE^DIE("S","FDATA03(9002313.0301)","FDAIEN03")
"RTN","BPSECMPS",195,0)
 Q
"RTN","BPSECMPS",196,0)
 ;
"RTN","BPSECMPS",197,0)
PROCREJ ;
"RTN","BPSECMPS",198,0)
 Q:$G(FDATA(TRANSACT,510))=""
"RTN","BPSECMPS",199,0)
 N FILE,ROOT,FLDNUM,FDAT3511,NUMREJS,NNDX
"RTN","BPSECMPS",200,0)
 S FILE="9002313.03511"
"RTN","BPSECMPS",201,0)
 S ROOT="FDAT3511(9002313.03511)"
"RTN","BPSECMPS",202,0)
 S NUMREJS=FDATA(TRANSACT,510)
"RTN","BPSECMPS",203,0)
 S NNDX=""
"RTN","BPSECMPS",204,0)
 F  S NNDX=$O(FDATA(TRANSACT,511,NNDX)) Q:NNDX=""  D   ;set all the non-repeating fields for 9002313.3511 rejections
"RTN","BPSECMPS",205,0)
 .S FDATA(TRANSACT,511,NNDX)=$TR(FDATA(TRANSACT,511,NNDX),"\","")
"RTN","BPSECMPS",206,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,511,NNDX),ROOT)
"RTN","BPSECMPS",207,0)
 D UPDATE^DIE("S","FDAT3511(9002313.03511)")
"RTN","BPSECMPS",208,0)
 Q
"RTN","BPSECMPS",209,0)
 ;
"RTN","BPSECMPS",210,0)
PROCAPP ;
"RTN","BPSECMPS",211,0)
 Q:$G(FDATA(TRANSACT,548,1))=""
"RTN","BPSECMPS",212,0)
 N FILE,ROOT,FLDNUM,FDAT1548,NNDX
"RTN","BPSECMPS",213,0)
 S FILE="9002313.301548"
"RTN","BPSECMPS",214,0)
 S ROOT="FDAT1548(9002313.0301548)"
"RTN","BPSECMPS",215,0)
 S NNDX=""
"RTN","BPSECMPS",216,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),548,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",217,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,548,NNDX),ROOT)
"RTN","BPSECMPS",218,0)
 D UPDATE^DIE("S","FDAT1548(9002313.301548)")
"RTN","BPSECMPS",219,0)
 Q
"RTN","BPSECMPS",220,0)
 ;
"RTN","BPSECMPS",221,0)
PROCPPR ;
"RTN","BPSECMPS",222,0)
 Q:$G(FDATA(TRANSACT,551.01,1))=""
"RTN","BPSECMPS",223,0)
 N FILE,ROOT,FLDNUM,FDAT1301,NNDX
"RTN","BPSECMPS",224,0)
 S FILE="9002313.1301"
"RTN","BPSECMPS",225,0)
 S ROOT="FDAT1301(9002313.1301)"
"RTN","BPSECMPS",226,0)
 S NNDX=""
"RTN","BPSECMPS",227,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),551.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",228,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,551.01,NNDX),ROOT)
"RTN","BPSECMPS",229,0)
 D UPDATE^DIE("S","FDAT1301(9002313.1301)")
"RTN","BPSECMPS",230,0)
 Q
"RTN","BPSECP1")
1^48
"RTN","BPSECP2")
1^49
"RTN","BPSECX0")
0^160^B4171802
"RTN","BPSECX0",1,0)
BPSECX0 ;BHAM ISC/FCS/DRS/VA/DLF - Retrieve Claim submission record ;05/17/2004
"RTN","BPSECX0",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSECX0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECX0",4,0)
 Q
"RTN","BPSECX0",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",6,0)
 ;Retrieve Claim submission record
"RTN","BPSECX0",7,0)
 ;
"RTN","BPSECX0",8,0)
 ;Input Variables:   CLAIMIEN -  Claim Submission IEN (9002313.02)
"RTN","BPSECX0",9,0)
 ;                   .BPS     -  Pass by reference, output only
"RTN","BPSECX0",10,0)
 ;
"RTN","BPSECX0",11,0)
 ;Output Variables:  BPS(9002313.02,CLAIMIEN,<field #>,"I")  = Value
"RTN","BPSECX0",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",13,0)
 ; IHS/SD/lwj  08/13/02  NCPDP 5.1 changes
"RTN","BPSECX0",14,0)
 ; Many fields that were once a part of the "header" of the claim
"RTN","BPSECX0",15,0)
 ; were shifted to appear on the "rx" or "detail" segments of the
"RTN","BPSECX0",16,0)
 ; claim in 5.1. Additionally, MANY new fields were added beyond 499. 
"RTN","BPSECX0",17,0)
 ; For these reasons, we had to change the GETBPS3
"RTN","BPSECX0",18,0)
 ; subroutine to pull fields 308 through 600 rather than just 
"RTN","BPSECX0",19,0)
 ; 402 - 499. The really cool thing is that because we are at the
"RTN","BPSECX0",20,0)
 ; subfile level, the duplicated fields (between header and rx)
"RTN","BPSECX0",21,0)
 ; will only pull at the appropriate level.  3.2 claims should
"RTN","BPSECX0",22,0)
 ; be unaffected by this change, as the adjusted and new fields
"RTN","BPSECX0",23,0)
 ; were not populated for 3.2
"RTN","BPSECX0",24,0)
 ;
"RTN","BPSECX0",25,0)
 ; New subroutine added GETBPS4 to pull out the repeating fields for
"RTN","BPSECX0",26,0)
 ; the DUR/PPS records
"RTN","BPSECX0",27,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",28,0)
 ; 
"RTN","BPSECX0",29,0)
GETBPS2(CLAIMIEN,BPS) ;EP - from BPSECA1 from BPSOSQG from BPSOSQ2
"RTN","BPSECX0",30,0)
 ;Manage local variables
"RTN","BPSECX0",31,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",32,0)
 ;
"RTN","BPSECX0",33,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",34,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",35,0)
 ;
"RTN","BPSECX0",36,0)
 ;Set input variables for FileMan data retrieval routine
"RTN","BPSECX0",37,0)
 ;IHS/SD/lwj 9/9/02  need to expand the field range to include
"RTN","BPSECX0",38,0)
 ; the "500" range fields now used in the header segments
"RTN","BPSECX0",39,0)
 ; for NCPDP 5.1
"RTN","BPSECX0",40,0)
 ;
"RTN","BPSECX0",41,0)
 S DIC=9002313.02
"RTN","BPSECX0",42,0)
 ; IHS/SD/lwj 9/9/02 NCPDP 5.1 changes
"RTN","BPSECX0",43,0)
 S DR="101:600"
"RTN","BPSECX0",44,0)
 S DA=CLAIMIEN
"RTN","BPSECX0",45,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",46,0)
 ;
"RTN","BPSECX0",47,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",48,0)
 D EN^DIQ1
"RTN","BPSECX0",49,0)
 Q
"RTN","BPSECX0",50,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",51,0)
 ;Retrieve Claim Submission, Prescription(s) multiple record
"RTN","BPSECX0",52,0)
 ;
"RTN","BPSECX0",53,0)
 ;Input Variables:   CLAIMIEN - Claim Submission IEN (9002313.02)
"RTN","BPSECX0",54,0)
 ;                   CRXIEN   - Prescription Multiple IEN (9002313.0201)
"RTN","BPSECX0",55,0)
 ;
"RTN","BPSECX0",56,0)
 ;Output Variables:  BPS(9002313.0201,CRXIEN,<field #>,"I") = Value
"RTN","BPSECX0",57,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",58,0)
GETBPS3(CLAIMIEN,CRXIEN,BPS) ;EP - from BPSECA1
"RTN","BPSECX0",59,0)
 ;Manage local variables
"RTN","BPSECX0",60,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",61,0)
 ;
"RTN","BPSECX0",62,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",63,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",64,0)
 Q:$G(CRXIEN)=""
"RTN","BPSECX0",65,0)
 ;
"RTN","BPSECX0",66,0)
 ;S input variables for FileMan data retrieval routine
"RTN","BPSECX0",67,0)
 S DIC=9002313.02
"RTN","BPSECX0",68,0)
 ;
"RTN","BPSECX0",69,0)
 S DR="400",DR(9002313.0201)="308:600"  ;need new RX fields
"RTN","BPSECX0",70,0)
 ;IHS/SD/lwj 8/13/02 end changes
"RTN","BPSECX0",71,0)
 S DA=CLAIMIEN,DA(9002313.0201)=CRXIEN
"RTN","BPSECX0",72,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",73,0)
 ;
"RTN","BPSECX0",74,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",75,0)
 D EN^DIQ1
"RTN","BPSECX0",76,0)
 Q
"RTN","BPSECX0",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",78,0)
 ;Retrieve Claim Submission, Prescription(s) multiple, DUR/PPS multiple 
"RTN","BPSECX0",79,0)
 ; record
"RTN","BPSECX0",80,0)
 ;
"RTN","BPSECX0",81,0)
 ;Input Variables:   CLAIMIEN - Claim Submission IEN (9002313.02)
"RTN","BPSECX0",82,0)
 ;                   CRXIEN   - Prescription Multiple IEN (9002313.0201)
"RTN","BPSECX0",83,0)
 ;                   CDURIEN  - DUR/PPS Multiple IEN (9002313.1001)
"RTN","BPSECX0",84,0)
 ;
"RTN","BPSECX0",85,0)
 ;Output Variables:  BPS(9002313.1001,CDURIEN,<field #>,"I") = Value
"RTN","BPSECX0",86,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",87,0)
GETBPS4(CLAIMIEN,CRXIEN,CDURIEN,BPS) ;EP - from BPSECA1
"RTN","BPSECX0",88,0)
 ;
"RTN","BPSECX0",89,0)
 ;Manage local variables
"RTN","BPSECX0",90,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",91,0)
 ;
"RTN","BPSECX0",92,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",93,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",94,0)
 Q:$G(CRXIEN)=""
"RTN","BPSECX0",95,0)
 Q:$G(CDURIEN)=""
"RTN","BPSECX0",96,0)
 ;
"RTN","BPSECX0",97,0)
 ;S input variables for FileMan data retrieval routine
"RTN","BPSECX0",98,0)
 S DIC=9002313.02
"RTN","BPSECX0",99,0)
 ;
"RTN","BPSECX0",100,0)
 S DR="400",DR(9002313.0201)=473.01  ;fields
"RTN","BPSECX0",101,0)
 S DR(9002313.1001)=".01;439;440;441;474;475;476"  ;fields
"RTN","BPSECX0",102,0)
 S DA=CLAIMIEN,DA(9002313.0201)=CRXIEN,DA(9002313.1001)=CDURIEN
"RTN","BPSECX0",103,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",104,0)
 ;
"RTN","BPSECX0",105,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",106,0)
 D EN^DIQ1
"RTN","BPSECX0",107,0)
 ;
"RTN","BPSECX0",108,0)
 Q
"RTN","BPSECX1")
0^161^B3758850
"RTN","BPSECX1",1,0)
BPSECX1 ;BHAM ISC/FCS/DRS/VA/DLF - Create new Claim ID for Claim Submission file ;05/17/2004
"RTN","BPSECX1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSECX1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECX1",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX1",5,0)
 ;Create new Claim ID for Claim Submission file (9002313.02)
"RTN","BPSECX1",6,0)
 ;
"RTN","BPSECX1",7,0)
 ;Function Returns:  VA<YYYY>=<Pharmacy ID>=<Plan ID>=<Sequence Number>
"RTN","BPSECX1",8,0)
 ;                   Where: <YYYY> is the year
"RTN","BPSECX1",9,0)
 ;                          <Pharmacy ID> NPI or NCPDPP of the BPS Pharmacy
"RTN","BPSECX1",10,0)
 ;                          <Plan ID> is the VA National Plan ID w/o leading alphas
"RTN","BPSECX1",11,0)
 ;                          <Sequence #> is a unique counter stored in BPS SETUP
"RTN","BPSECX1",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX1",13,0)
 ;
"RTN","BPSECX1",14,0)
CLAIMID(IEN59) ;EP - Called from BPSOSCE (billing requests) and BPSECA8 (reversals)
"RTN","BPSECX1",15,0)
 ; Check parameters
"RTN","BPSECX1",16,0)
 I '$G(IEN59) Q ""
"RTN","BPSECX1",17,0)
 ;
"RTN","BPSECX1",18,0)
 ; Initialization
"RTN","BPSECX1",19,0)
 N PHARMACY,FACID,THIRD,DEL,PLAN,I,SEQNUM
"RTN","BPSECX1",20,0)
 ;
"RTN","BPSECX1",21,0)
 ; Get and format the Facility ID (second piece of the transmission ID)
"RTN","BPSECX1",22,0)
 ;   1. Try to get NPI first.
"RTN","BPSECX1",23,0)
 ;   2. If we do not get the NPI, get the NCPDP and left-pad it with zeros
"RTN","BPSECX1",24,0)
 ;      up to seven characters.
"RTN","BPSECX1",25,0)
 ;   3. Right-pad the final ID with spaces up to 10 characters
"RTN","BPSECX1",26,0)
 S PHARMACY=+$P($G(^BPST(IEN59,1)),U,7)
"RTN","BPSECX1",27,0)
 S FACID=$P($G(^BPS(9002313.56,PHARMACY,"NPI")),U,1)
"RTN","BPSECX1",28,0)
 I FACID="" D
"RTN","BPSECX1",29,0)
 . S FACID=$P($G(^BPS(9002313.56,PHARMACY,0)),U,2)
"RTN","BPSECX1",30,0)
 . S FACID=$TR($J("",7-$L(FACID))," ","0")_FACID
"RTN","BPSECX1",31,0)
 S FACID=$RE($J($RE(FACID),10))
"RTN","BPSECX1",32,0)
 ;
"RTN","BPSECX1",33,0)
 ; Get the third piece of the transmission ID
"RTN","BPSECX1",34,0)
 ;  If the National Plan ID is available, use it with '=' delimiter (new format)
"RTN","BPSECX1",35,0)
 ;  If not, it will need to be the BIN with the '-' delimiter (old format)
"RTN","BPSECX1",36,0)
 S THIRD="",PLAN=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.27")
"RTN","BPSECX1",37,0)
 I PLAN]"" D
"RTN","BPSECX1",38,0)
 . F I=1:1:$L(PLAN) I $E(PLAN,I)?1N Q
"RTN","BPSECX1",39,0)
 . S PLAN=$E(PLAN,I,$L(PLAN))
"RTN","BPSECX1",40,0)
 . S THIRD=PLAN,DEL="="
"RTN","BPSECX1",41,0)
 ;
"RTN","BPSECX1",42,0)
 ; If no plan, get BIN and use '-' delimiter (old format)
"RTN","BPSECX1",43,0)
 I THIRD="" S DEL="-",THIRD=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.03")
"RTN","BPSECX1",44,0)
 ;
"RTN","BPSECX1",45,0)
 ; Pad third piece with zeros
"RTN","BPSECX1",46,0)
 S THIRD=$TR($J("",6-$L(THIRD))," ","0")_THIRD
"RTN","BPSECX1",47,0)
 ;
"RTN","BPSECX1",48,0)
 ; Get and format the sequence number (fourth piece)
"RTN","BPSECX1",49,0)
 L +^BPS(9002313.99,1,3):15
"RTN","BPSECX1",50,0)
 I '$T D IMPOSS^BPSOSUE("DB,P","TI","",,"Can't lock BPS(9002313.99,1,3)",$T(+0))
"RTN","BPSECX1",51,0)
 S SEQNUM=+$G(^BPS(9002313.99,1,3)),^BPS(9002313.99,1,3)=SEQNUM+1
"RTN","BPSECX1",52,0)
 I $L(SEQNUM<7) S SEQNUM=$E($TR($J("",7-$L(SEQNUM))," ","0")_SEQNUM,1,7)
"RTN","BPSECX1",53,0)
 L -^BPS(9002313.99,1,3)
"RTN","BPSECX1",54,0)
 ;
"RTN","BPSECX1",55,0)
 ; Create the Transmission ID
"RTN","BPSECX1",56,0)
 Q "VA"_($E(DT,1,3)+1700)_DEL_FACID_DEL_THIRD_DEL_SEQNUM
"RTN","BPSECX4")
1^50
"RTN","BPSJACK")
0^38^B35592079
"RTN","BPSJACK",1,0)
BPSJACK ;BHAM ISC/LJF - HL7 Acknowledgement Messages ;21-NOV-2003
"RTN","BPSJACK",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSJACK",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJACK",4,0)
 ;
"RTN","BPSJACK",5,0)
 ; This routine examines an Acknowledgement Message. If the message is
"RTN","BPSJACK",6,0)
 ; the E-PHARM Application Acknowledgement Message, and it is "AA",
"RTN","BPSJACK",7,0)
 ; it kicks off the Pharmacy Registration Messages.
"RTN","BPSJACK",8,0)
 ; If the message flags an error, then error notification is processed.
"RTN","BPSJACK",9,0)
 ;
"RTN","BPSJACK",10,0)
EN(HL) N ACK,AREG,BPSJSEG,ERR,HCT,SEG
"RTN","BPSJACK",11,0)
 N MFI,MFIIX,MSGCTLID,MSGID,MSGIX,MSH
"RTN","BPSJACK",12,0)
 ;
"RTN","BPSJACK",13,0)
 I '$D(HL) Q
"RTN","BPSJACK",14,0)
 ;
"RTN","BPSJACK",15,0)
 S (AREG,HCT,MFIIX,MSGCTLID,MSGID,MSGIX)=0,(ACK,MFI,MSH)=""
"RTN","BPSJACK",16,0)
 S ERR("MSA")=""
"RTN","BPSJACK",17,0)
 ;  Loop through the message and find each segment for processing
"RTN","BPSJACK",18,0)
 F  S HCT=$O(^TMP($J,"BPSJHLI",HCT)) Q:HCT=""  D
"RTN","BPSJACK",19,0)
 . K BPSJSEG D SPAR^BPSJUTL(.HL,.BPSJSEG,HCT) S SEG=$G(BPSJSEG(1))
"RTN","BPSJACK",20,0)
 . ;
"RTN","BPSJACK",21,0)
 . I SEG="MSH" D  Q
"RTN","BPSJACK",22,0)
 . . S MSGCTLID=$G(BPSJSEG(10))    ; get the message control id
"RTN","BPSJACK",23,0)
 . ;
"RTN","BPSJACK",24,0)
 . I SEG="MSA" D  Q  ; MSA seg looks like this -> MSA|AA|509133482
"RTN","BPSJACK",25,0)
 . . S ACK=$G(BPSJSEG(2)),MSGID=$G(BPSJSEG(3)) K ERR("MSA")
"RTN","BPSJACK",26,0)
 . ;
"RTN","BPSJACK",27,0)
 . I SEG="MFI",ACK="AA",$P($G(BPSJSEG(2)),$E($G(HL("ECH"))))="Facility Table" S AREG=1
"RTN","BPSJACK",28,0)
 . ;
"RTN","BPSJACK",29,0)
 . ;GET NPI 
"RTN","BPSJACK",30,0)
 . I SEG="MFI",ACK="AA",$P($G(BPSJSEG(2)),$E($G(HL("ECH"))))="Pharmacy Table" D
"RTN","BPSJACK",31,0)
 . . I '$G(MSGID) Q
"RTN","BPSJACK",32,0)
 . . N BPSJNPI,BPSJPIX,BPSJNDT,BPSJ,HLMAID,HLID
"RTN","BPSJACK",33,0)
 . . S HLMAID=$O(^HLMA("C",MSGID,"")) I '$G(HLMAID) Q
"RTN","BPSJACK",34,0)
 . . S HLID=$P(^HLMA(HLMAID,0),U) I '$G(HLID) Q
"RTN","BPSJACK",35,0)
 . . S BPSJNPI=$P($G(^HL(772,HLID,"IN",22,0)),"|") I '$G(BPSJNPI) Q
"RTN","BPSJACK",36,0)
 . . S BPSJ=$G(^XTMP("BPSJ","NPI",BPSJNPI)) I 'BPSJ Q
"RTN","BPSJACK",37,0)
 . . S BPSJPIX=$P(BPSJ,U),BPSJNDT=$P(BPSJ,U,2)
"RTN","BPSJACK",38,0)
 . . N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJACK",39,0)
 . . S DA=BPSJPIX,DIE=$$ROOT^DILFD(9002313.56)
"RTN","BPSJACK",40,0)
 . . S DR="41.01////"_BPSJNPI_";41.02////"_BPSJNDT D ^DIE
"RTN","BPSJACK",41,0)
 . . K ^XTMP("BPSJ","NPI",BPSJNPI)
"RTN","BPSJACK",42,0)
 . ;
"RTN","BPSJACK",43,0)
 . I SEG="MFA",ACK="AE" S ERR("MFA",U_$G(BPSJSEG(5)))="" Q
"RTN","BPSJACK",44,0)
 ;
"RTN","BPSJACK",45,0)
 ; Pharmacy Registrations
"RTN","BPSJACK",46,0)
 I AREG S AREG=0 D
"RTN","BPSJACK",47,0)
 . F  S AREG=$O(^BPS(9002313.56,AREG)) Q:'AREG  D REG^BPSJPREG(AREG)
"RTN","BPSJACK",48,0)
 ;
"RTN","BPSJACK",49,0)
 I $D(ERR) D ERRORM D MSG^BPSJUTL(.ERR,"BPSJACK")
"RTN","BPSJACK",50,0)
 Q
"RTN","BPSJACK",51,0)
 ;
"RTN","BPSJACK",52,0)
ERRORM ; Error message setup
"RTN","BPSJACK",53,0)
 N ERRT
"RTN","BPSJACK",54,0)
 ;
"RTN","BPSJACK",55,0)
 S ERR(1)="Error(s) indicated for HL7 Application Acknowledge Message ID: "_$G(MSGCTLID)
"RTN","BPSJACK",56,0)
 I $D(ERR("MSA")) S ERR(2)="Error:NO MSA - No MSA segment found."
"RTN","BPSJACK",57,0)
 I $D(ERR("MFA")) S ERRT="" F  S ERRT=$O(ERR("MFA",ERRT)) Q:ERRT=""  D
"RTN","BPSJACK",58,0)
 . I ERRT["NC100" S ERR(100)="Error:NC100 - Invalid OP Interface version." Q
"RTN","BPSJACK",59,0)
 . I ERRT["NC200" S ERR(200)="Error:NC200 - Not e-IIV registered." Q
"RTN","BPSJACK",60,0)
 . I ERRT["NC201" S ERR(201)="Error:NC201 - Invalid IIV Interface version." Q
"RTN","BPSJACK",61,0)
 . I ERRT["NC202" S ERR(202)="Error:NC202 - Invalid e-IIV registration state." Q
"RTN","BPSJACK",62,0)
 . I ERRT["NC300" S ERR(300)="Error:NC300 - OP pharmacy not registered.  Failed to update Pharmacy information." Q
"RTN","BPSJACK",63,0)
 . I ERRT["NC301" S ERR(301)="Error:NC301 - Unable to update Pharmacy information due to outpatient pharmacy registration has invalid OP interface version." Q
"RTN","BPSJACK",64,0)
 . I ERRT["NC302" S ERR(302)="Error:NC302 - Unable to update Pharmacy information due to invalid e-IIV registration state." Q
"RTN","BPSJACK",65,0)
 . S ERR(399)="Error:"_ERRT_" - Unknown error."
"RTN","BPSJACK",66,0)
 K ERR("MFA"),ERR("MSA")
"RTN","BPSJACK",67,0)
 ;
"RTN","BPSJACK",68,0)
 Q
"RTN","BPSJACK",69,0)
 ;
"RTN","BPSJACK",70,0)
APPACK(HL,APPACK,PSIEN) ; Application Acknowledgement for Payer Sheets
"RTN","BPSJACK",71,0)
 N MGRP,MSG,MCT,BPSGENR
"RTN","BPSJACK",72,0)
 N TLN,FS,FS2,FS3,CS
"RTN","BPSJACK",73,0)
 ;
"RTN","BPSJACK",74,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",75,0)
 ;
"RTN","BPSJACK",76,0)
 ;-Set up HL7
"RTN","BPSJACK",77,0)
 D INIT^HLFNC2("BPSJ REGISTER",.HL)
"RTN","BPSJACK",78,0)
 ;
"RTN","BPSJACK",79,0)
 D DGAPPACK  ; Dollar G the APPACK variable (bullet proofing)
"RTN","BPSJACK",80,0)
 ;
"RTN","BPSJACK",81,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"      ; field separator
"RTN","BPSJACK",82,0)
 S CS=$E($G(HL("ECH"))) I CS="" S CS="^"  ; component separator
"RTN","BPSJACK",83,0)
 ;
"RTN","BPSJACK",84,0)
 S MCT=0,FS2=FS_FS,FS3=FS_FS_FS
"RTN","BPSJACK",85,0)
 ;
"RTN","BPSJACK",86,0)
 ;-MSA SEG
"RTN","BPSJACK",87,0)
 I APPACK("MFA",4,1)="S" S ^TMP("HLA",$J,1)="MSA"_FS_"AA"_FS_APPACK("MSA",2)
"RTN","BPSJACK",88,0)
 E  S ^TMP("HLA",$J,1)="MSA"_FS_"AE"_FS_APPACK("MSA",2)
"RTN","BPSJACK",89,0)
 ;
"RTN","BPSJACK",90,0)
 ;-MFI SEG
"RTN","BPSJACK",91,0)
 S TLN="MFI"_FS_APPACK("MFI",1,1)_CS_APPACK("MFI",1,2)_FS2
"RTN","BPSJACK",92,0)
 S ^TMP("HLA",$J,2)=TLN_APPACK("MFI",3)_FS3_APPACK("MFI",6)
"RTN","BPSJACK",93,0)
 ;
"RTN","BPSJACK",94,0)
 ;-MFA SEG(S)
"RTN","BPSJACK",95,0)
 I APPACK("MFA",4,1)="S" D  S ^TMP("HLA",$J,3)=TLN
"RTN","BPSJACK",96,0)
 . S TLN="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)_FS2
"RTN","BPSJACK",97,0)
 . S TLN=TLN_APPACK("MFA",4,1)_CS_APPACK("MFA",4,2)_FS
"RTN","BPSJACK",98,0)
 . S TLN=TLN_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",99,0)
 E  D MFASEGS
"RTN","BPSJACK",100,0)
 ;
"RTN","BPSJACK",101,0)
 D GENACK^HLMA1($G(HL("EID")),$G(HL("HLMTIENS")),$G(HL("EIDS")),"GM",1,.BPSGENR)
"RTN","BPSJACK",102,0)
 ;
"RTN","BPSJACK",103,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",104,0)
 Q
"RTN","BPSJACK",105,0)
 ;
"RTN","BPSJACK",106,0)
MFASEGS ; Set up the MFA segs for Reject message
"RTN","BPSJACK",107,0)
 N MFAP1,MFAP2,MFACNTR,FIELD,RECORD,ZPRERR
"RTN","BPSJACK",108,0)
 ;
"RTN","BPSJACK",109,0)
 S MFAP1="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)
"RTN","BPSJACK",110,0)
 S MFAP1=MFAP1_FS2_APPACK("MFA",4,1)_CS
"RTN","BPSJACK",111,0)
 S MFAP2=FS_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",112,0)
 S MFACNTR=2
"RTN","BPSJACK",113,0)
 ;
"RTN","BPSJACK",114,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFI")) S FIELD="" D
"RTN","BPSJACK",115,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFI",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",116,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",117,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V60"_FIELD_MFAP2
"RTN","BPSJACK",118,0)
 ;
"RTN","BPSJACK",119,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFE")) S FIELD="" D
"RTN","BPSJACK",120,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFE",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",121,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",122,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V61"_FIELD_MFAP2
"RTN","BPSJACK",123,0)
 ;
"RTN","BPSJACK",124,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPS")) S FIELD="" D
"RTN","BPSJACK",125,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPS",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",126,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",127,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V62"_FIELD_MFAP2
"RTN","BPSJACK",128,0)
 ;
"RTN","BPSJACK",129,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPR")) S RECORD="" D
"RTN","BPSJACK",130,0)
 . F  S RECORD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD)),FIELD="" Q:'RECORD  D
"RTN","BPSJACK",131,0)
 .. F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD)) Q:'FIELD  D
"RTN","BPSJACK",132,0)
 ... S ZPRERR=$G(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD))
"RTN","BPSJACK",133,0)
 ... S MFACNTR=MFACNTR+1,^TMP("HLA",$J,MFACNTR)=MFAP1_ZPRERR_MFAP2
"RTN","BPSJACK",134,0)
 ;
"RTN","BPSJACK",135,0)
 Q
"RTN","BPSJACK",136,0)
DGAPPACK ; $G the APPACK var
"RTN","BPSJACK",137,0)
 S APPACK("MFA",1)=$G(APPACK("MFA",1))
"RTN","BPSJACK",138,0)
 S APPACK("MFA",2)=$G(APPACK("MFA",2))
"RTN","BPSJACK",139,0)
 S APPACK("MFA",3)=$G(APPACK("MFA",3))
"RTN","BPSJACK",140,0)
 S APPACK("MFA",4,1)=$G(APPACK("MFA",4,1))
"RTN","BPSJACK",141,0)
 S APPACK("MFA",4,2)=$G(APPACK("MFA",4,2))
"RTN","BPSJACK",142,0)
 S APPACK("MFA",5)=$G(APPACK("MFA",5))
"RTN","BPSJACK",143,0)
 S APPACK("MFA",6)=$G(APPACK("MFA",6))
"RTN","BPSJACK",144,0)
 S APPACK("MFI",1,1)=$G(APPACK("MFI",1,1))
"RTN","BPSJACK",145,0)
 S APPACK("MFI",1,2)=$G(APPACK("MFI",1,2))
"RTN","BPSJACK",146,0)
 S APPACK("MFI",3)=$G(APPACK("MFI",3))
"RTN","BPSJACK",147,0)
 S APPACK("MFI",6)=$G(APPACK("MFI",6))
"RTN","BPSJACK",148,0)
 S APPACK("MSA",1)=$G(APPACK("MSA",1))
"RTN","BPSJACK",149,0)
 S APPACK("MSA",2)=$G(APPACK("MSA",2))
"RTN","BPSJACK",150,0)
 Q
"RTN","BPSJAREG")
0^39^B13096479
"RTN","BPSJAREG",1,0)
BPSJAREG ;BHAM ISC/LJF - HL7 Application Registration MFN Message ;21-NOV-2003
"RTN","BPSJAREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSJAREG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJAREG",4,0)
 ;
"RTN","BPSJAREG",5,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJAREG",6,0)
 ;
"RTN","BPSJAREG",7,0)
 ;  Variables
"RTN","BPSJAREG",8,0)
 ; HL      = HL7 parameters
"RTN","BPSJAREG",9,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJAREG",10,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJAREG",11,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJAREG",12,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJAREG",13,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJAREG",14,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJAREG",15,0)
 ; IPP     = IP Port
"RTN","BPSJAREG",16,0)
 ; IPA     = IP Address
"RTN","BPSJAREG",17,0)
 ; MCT     = Message Count
"RTN","BPSJAREG",18,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJAREG",19,0)
 ; MSG     = Message
"RTN","BPSJAREG",20,0)
 ;
"RTN","BPSJAREG",21,0)
INI ;
"RTN","BPSJAREG",22,0)
INIT ; Unconditional jump....
"RTN","BPSJAREG",23,0)
 G ^BPSJINIT
"RTN","BPSJAREG",24,0)
 Q
"RTN","BPSJAREG",25,0)
 ;
"RTN","BPSJAREG",26,0)
BPSJVAL(BPSJVAL) ; Validation entry point - HL7 message processing prevented
"RTN","BPSJAREG",27,0)
 ;
"RTN","BPSJAREG",28,0)
TASKMAN ; Entry point for taskman to run this routine
"RTN","BPSJAREG",29,0)
 ;
"RTN","BPSJAREG",30,0)
 N DA,HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLRESET,HLPRO
"RTN","BPSJAREG",31,0)
 N IPA,IPP
"RTN","BPSJAREG",32,0)
 N MGRP,MSG,MCT,BPSJARES,BPVALFN
"RTN","BPSJAREG",33,0)
 ;
"RTN","BPSJAREG",34,0)
 S MCT=0,BPSJVAL=+$G(BPSJVAL)
"RTN","BPSJAREG",35,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",36,0)
 ;       
"RTN","BPSJAREG",37,0)
 S BPVALFN=9002313.99
"RTN","BPSJAREG",38,0)
 ;
"RTN","BPSJAREG",39,0)
 ; Create/update BPS Setup record
"RTN","BPSJAREG",40,0)
 ; Returns record number in DA
"RTN","BPSJAREG",41,0)
 D VERSION^BPSJINIT(BPVALFN)
"RTN","BPSJAREG",42,0)
 ;
"RTN","BPSJAREG",43,0)
 ; The following code was copied from BPSJINIT w/o edits for patch BPS*1*2
"RTN","BPSJAREG",44,0)
 ; It is probably not needed since VERSION^BPSJINIT sets the version
"RTN","BPSJAREG",45,0)
 ; Need to delete/clean up in the next release
"RTN","BPSJAREG",46,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJAREG",47,0)
 S DR=$P($G(^BPS(BPVALFN,DA,"VITRIA")),U,3)
"RTN","BPSJAREG",48,0)
 I DR>2,DR=+DR
"RTN","BPSJAREG",49,0)
 E  S DIE=$$ROOT^DILFD(BPVALFN),DR="6003////3" D ^DIE
"RTN","BPSJAREG",50,0)
 ;
"RTN","BPSJAREG",51,0)
 ;  Get Link data from HL7 table
"RTN","BPSJAREG",52,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJAREG",53,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJAREG",54,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJAREG",55,0)
 ;
"RTN","BPSJAREG",56,0)
 ;  Error if any missing data
"RTN","BPSJAREG",57,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJAREG",58,0)
 ;
"RTN","BPSJAREG",59,0)
 I MCT,'BPSJVAL D MSG^BPSJUTL(.MSG,"BPSJAREG") Q
"RTN","BPSJAREG",60,0)
 ;
"RTN","BPSJAREG",61,0)
 ;  Initialize the HL7
"RTN","BPSJAREG",62,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJAREG",63,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJAREG",64,0)
 S HLECH=$E($G(HL("ECH")),1) I HLECH="" S HLECH="^"
"RTN","BPSJAREG",65,0)
 S HL("SITE")=$$SITE^VASITE,HL("SAF")=$P(HL("SITE"),U,2,3)
"RTN","BPSJAREG",66,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJAREG",67,0)
 ;
"RTN","BPSJAREG",68,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJAREG",69,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJAREG",70,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJAREG",71,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJAREG",72,0)
 ;
"RTN","BPSJAREG",73,0)
 ;   Set the MFI segment
"RTN","BPSJAREG",74,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Facility Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJAREG",75,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJAREG",76,0)
 ;
"RTN","BPSJAREG",77,0)
 ;  Set the MFE segment
"RTN","BPSJAREG",78,0)
 S ^TMP("HLS",$J,2)="MFE"_HLFS_"MUP"_HLFS_HLFS_HL7DTG_HLFS
"RTN","BPSJAREG",79,0)
 S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_+HL("SITE")_HLFS_"ST"
"RTN","BPSJAREG",80,0)
 ;
"RTN","BPSJAREG",81,0)
 ; Set the ZQR segment
"RTN","BPSJAREG",82,0)
 S ^TMP("HLS",$J,3)=$$EN^BPSJZQR(.HL)
"RTN","BPSJAREG",83,0)
 ;
"RTN","BPSJAREG",84,0)
 S BPSJARES=$$VAL1^BPSJVAL(BPSJVAL)   ; 0 = ok,
"RTN","BPSJAREG",85,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJAREG",86,0)
 ;
"RTN","BPSJAREG",87,0)
 ;-Check if msg valid.
"RTN","BPSJAREG",88,0)
 I 'BPSJARES D  G FINI
"RTN","BPSJAREG",89,0)
 . N BPSHLRS
"RTN","BPSJAREG",90,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.BPSHLRS,"")
"RTN","BPSJAREG",91,0)
 . I $P($G(BPSHLRS),U,2)]"" D  Q
"RTN","BPSJAREG",92,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJAREG",93,0)
 ... W !!,"ECME Application Registration HL7 Message not created: "_BPSHLRS
"RTN","BPSJAREG",94,0)
 .. S MCT=MCT+1,MSG(MCT)="ECME Application Registration HL7 Message not created."
"RTN","BPSJAREG",95,0)
 .. S MCT=MCT+1,MSG(MCT)=BPSHLRS
"RTN","BPSJAREG",96,0)
 .. D MSG^BPSJUTL(.MSG,"ECME Application Registration")
"RTN","BPSJAREG",97,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJAREG",98,0)
 .. W !!,"ECME Application Registration HL7 Message successfully created."
"RTN","BPSJAREG",99,0)
 ;
"RTN","BPSJAREG",100,0)
FINI ; Clean up
"RTN","BPSJAREG",101,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",102,0)
 Q
"RTN","BPSJINIT")
0^163^B36083922
"RTN","BPSJINIT",1,0)
BPSJINIT ;BHAM ISC/LJF - HL7 Application Registration ;21-NOV-2003
"RTN","BPSJINIT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSJINIT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJINIT",4,0)
 ;
"RTN","BPSJINIT",5,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",6,0)
 N BPVALFN,BPSJAPPR,BPSJVALR,PHIX
"RTN","BPSJINIT",7,0)
 ;
"RTN","BPSJINIT",8,0)
 ;  This program will allow user to enter site data.
"RTN","BPSJINIT",9,0)
 ;
"RTN","BPSJINIT",10,0)
 ; Programmer Note: D BPSJVAL^BPSJAREG(X) will validate with following.
"RTN","BPSJINIT",11,0)
 ;   where X is: 0 = HL7 trigger, no validation display
"RTN","BPSJINIT",12,0)
 ;               1 = HL7 trigger, display validation
"RTN","BPSJINIT",13,0)
 ;               2 = no HL7 trigger, display validation
"RTN","BPSJINIT",14,0)
 ;               3 = no validation display, no HL7 trigger
"RTN","BPSJINIT",15,0)
 ;
"RTN","BPSJINIT",16,0)
 W !!!,"ENTER/VERIFY SITE REGISTRATION DATA.",!!
"RTN","BPSJINIT",17,0)
 ;
"RTN","BPSJINIT",18,0)
 S BPVALFN=9002313.99
"RTN","BPSJINIT",19,0)
 ;
"RTN","BPSJINIT",20,0)
 ; Create/update BPS Setup record
"RTN","BPSJINIT",21,0)
 ; Returns record number in DA
"RTN","BPSJINIT",22,0)
 D VERSION(BPVALFN)
"RTN","BPSJINIT",23,0)
 ;
"RTN","BPSJINIT",24,0)
 W !!,"PRIMARY SITE CONTACT DATA."
"RTN","BPSJINIT",25,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",26,0)
 S DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",27,0)
 S DR="[BPSJ CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",28,0)
 ;
"RTN","BPSJINIT",29,0)
 W !!,"ALTERNATE SITE CONTACT DATA."
"RTN","BPSJINIT",30,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",31,0)
 S DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",32,0)
 S DR="[BPSJ ALT CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",33,0)
 ;
"RTN","BPSJINIT",34,0)
 W !!!,"-- APPLICATION REGISTRATION VALIDATION RESULTS. --",!!
"RTN","BPSJINIT",35,0)
 S BPSJVALR=-1
"RTN","BPSJINIT",36,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJINIT",37,0)
 S BPSJAPPR=BPSJVALR
"RTN","BPSJINIT",38,0)
 ;
"RTN","BPSJINIT",39,0)
 I 'BPSJAPPR W !!,"-- APPLICATION REGISTRATION DATA VALID. --",!
"RTN","BPSJINIT",40,0)
 E  D
"RTN","BPSJINIT",41,0)
 . W !!,"** APPLICATION REGISTRATION DATA INVALID!!!  **"
"RTN","BPSJINIT",42,0)
 . W !,"**  APPLICATION REGISTRATION AND PHARMACY    **"
"RTN","BPSJINIT",43,0)
 . W !,"**    REGISTRATIONS WILL NOT BE SENT!        **",!
"RTN","BPSJINIT",44,0)
 ;
"RTN","BPSJINIT",45,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",46,0)
 S DIR(0)="EO" D ^DIR I X=U Q
"RTN","BPSJINIT",47,0)
 ;
"RTN","BPSJINIT",48,0)
 D PHARM
"RTN","BPSJINIT",49,0)
 I BPSJAPPR D  Q
"RTN","BPSJINIT",50,0)
 . W !!,"REGISTRATION ABORTED DUE TO INVALID SITE REGISTRATION DATA.",!!
"RTN","BPSJINIT",51,0)
 ;
"RTN","BPSJINIT",52,0)
 W !!!,"APPLICATION REGISTRATION DATA IS VALID."
"RTN","BPSJINIT",53,0)
 W !!,"PHARMACY REGISTRATION DATA IS:"
"RTN","BPSJINIT",54,0)
 S PHIX=$O(^BPS(9002313.56,0))
"RTN","BPSJINIT",55,0)
 F  Q:'PHIX  D  S PHIX=$O(^BPS(9002313.56,PHIX))
"RTN","BPSJINIT",56,0)
 . S BPSJVALR=-1 D REG^BPSJPREG(PHIX,3)
"RTN","BPSJINIT",57,0)
 . I BPSJVALR>0 S DIR=" *INVALID",DIE=" and will NOT be transmitted."
"RTN","BPSJINIT",58,0)
 . E  S DIR="    VALID",DIE=" and will be transmitted."
"RTN","BPSJINIT",59,0)
 . W !,DIR_" for "_$P($G(^BPS(9002313.56,PHIX,0)),U)_DIE
"RTN","BPSJINIT",60,0)
 W !
"RTN","BPSJINIT",61,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",62,0)
 S DIR(0)="YEO",DIR("A")="SEND APPLICATION REGISTRATION: Y/N " D ^DIR
"RTN","BPSJINIT",63,0)
 I $TR($E(X),"y","Y")'="Y" Q
"RTN","BPSJINIT",64,0)
 ;
"RTN","BPSJINIT",65,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",66,0)
 D BPSJVAL^BPSJAREG(0)
"RTN","BPSJINIT",67,0)
 W !!,"APPLICATION REGISTRATION SUBMITTED."
"RTN","BPSJINIT",68,0)
 Q
"RTN","BPSJINIT",69,0)
 ;
"RTN","BPSJINIT",70,0)
PHARM ;CYCLE THROUGH PHARMACIES
"RTN","BPSJINIT",71,0)
 ;
"RTN","BPSJINIT",72,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",73,0)
 N BPVALFN,BPSJVALR,BPSJPHPR
"RTN","BPSJINIT",74,0)
 ;
"RTN","BPSJINIT",75,0)
 ;
"RTN","BPSJINIT",76,0)
 ; Check DropDeadDate
"RTN","BPSJINIT",77,0)
 N BPSJDDD
"RTN","BPSJINIT",78,0)
 S BPSJDDD=$$NPIREQ^BPSNPI(DT) ; DDD=3080524
"RTN","BPSJINIT",79,0)
 ;
"RTN","BPSJINIT",80,0)
 S BPVALFN=9002313.56,PHIX=0
"RTN","BPSJINIT",81,0)
 ;
"RTN","BPSJINIT",82,0)
 F  D  Q:PHIX=""
"RTN","BPSJINIT",83,0)
 . W !!!,"ENTER/VERIFY PHARMACY REGISTRATION DATA."
"RTN","BPSJINIT",84,0)
 . W !!,"PHARMACY SPECIFIC DATA."
"RTN","BPSJINIT",85,0)
 . K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",86,0)
 . ;check for drop dead date
"RTN","BPSJINIT",87,0)
 . S DIC(0)="QAELM" I $G(BPSJDDD)>0 S DIC(0)="QAEM"
"RTN","BPSJINIT",88,0)
 . S DIC=BPVALFN,DLAYGO=DIC D ^DIC
"RTN","BPSJINIT",89,0)
 . ;
"RTN","BPSJINIT",90,0)
 . I X'=U,0<+Y S PHIX=+Y
"RTN","BPSJINIT",91,0)
 . E  S PHIX="" Q
"RTN","BPSJINIT",92,0)
 . D MOD I 'PHIX Q
"RTN","BPSJINIT",93,0)
 . W !!!,"-- PHARMACY REGISTRATION VALIDATION RESULTS. --",!
"RTN","BPSJINIT",94,0)
 . ;
"RTN","BPSJINIT",95,0)
 . S BPSJVALR=-1
"RTN","BPSJINIT",96,0)
 . D REG^BPSJPREG(PHIX,2)
"RTN","BPSJINIT",97,0)
 . S BPSJPHPR=BPSJVALR
"RTN","BPSJINIT",98,0)
 . ;
"RTN","BPSJINIT",99,0)
 . I 'BPSJPHPR W !!,"-- PHARMACY REGISTRATION DATA VALID. --",!
"RTN","BPSJINIT",100,0)
 . E  D
"RTN","BPSJINIT",101,0)
 .. W !!,"**     PHARMACY REGISTRATION DATA INVALID!!!      **"
"RTN","BPSJINIT",102,0)
 .. W !,"** THIS PHARMACY'S REGISTRATION WILL NOT BE SENT! **",!
"RTN","BPSJINIT",103,0)
 . ;
"RTN","BPSJINIT",104,0)
 . K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",105,0)
 . S DIR(0)="EO",DIR("A")="Enter RETURN to continue" D ^DIR
"RTN","BPSJINIT",106,0)
 ;
"RTN","BPSJINIT",107,0)
 Q
"RTN","BPSJINIT",108,0)
 ;
"RTN","BPSJINIT",109,0)
MOD ;
"RTN","BPSJINIT",110,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",111,0)
 ;
"RTN","BPSJINIT",112,0)
 ; Set hours to default if not set.
"RTN","BPSJINIT",113,0)
 S DA=$$OPHOURS^BPSJZRP(PHIX),DR=$G(^BPS(9002313.56,PHIX,"HOURS"))
"RTN","BPSJINIT",114,0)
 I $P(DR,U,2,5)'=DA S ^BPS(9002313.56,PHIX,"HOURS")="24"_U_DA
"RTN","BPSJINIT",115,0)
 ;
"RTN","BPSJINIT",116,0)
 ; Set STATUS default to ACTIVE if not set
"RTN","BPSJINIT",117,0)
 I $$GET1^DIQ(9002313.56,PHIX,.1,"I")="" D
"RTN","BPSJINIT",118,0)
 . K DI,DIDEL
"RTN","BPSJINIT",119,0)
 . S DR=".1///ACTIVE",DIE=9002313.56,DA=PHIX
"RTN","BPSJINIT",120,0)
 . D ^DIE
"RTN","BPSJINIT",121,0)
 ;
"RTN","BPSJINIT",122,0)
 W !!,"SITE DATA."
"RTN","BPSJINIT",123,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",124,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",125,0)
 S DR="[BPSJ PHARMACY SITE ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",126,0)
 ;
"RTN","BPSJINIT",127,0)
 I '$G(DA) S PHIX=0 Q   ; Pharmacy killed by user
"RTN","BPSJINIT",128,0)
 ;
"RTN","BPSJINIT",129,0)
 ; Pharmacy open hours
"RTN","BPSJINIT",130,0)
 I '$D(Y) D EN^BPSJINI1(PHIX)
"RTN","BPSJINIT",131,0)
 ;
"RTN","BPSJINIT",132,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",133,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",134,0)
 ;
"RTN","BPSJINIT",135,0)
 I X=U Q
"RTN","BPSJINIT",136,0)
 ;
"RTN","BPSJINIT",137,0)
 W !!,"PRIMARY CONTACT DATA."
"RTN","BPSJINIT",138,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",139,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",140,0)
 S DR="[BPSJ PHARM CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",141,0)
 ;
"RTN","BPSJINIT",142,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",143,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",144,0)
 ;
"RTN","BPSJINIT",145,0)
 I X=U Q
"RTN","BPSJINIT",146,0)
 ;
"RTN","BPSJINIT",147,0)
 W !!,"ALTERNATE CONTACT DATA."
"RTN","BPSJINIT",148,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",149,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",150,0)
 S DR="[BPSJ PHARM ALT CONT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",151,0)
 ;
"RTN","BPSJINIT",152,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",153,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",154,0)
 ;
"RTN","BPSJINIT",155,0)
 I X=U Q
"RTN","BPSJINIT",156,0)
 ;
"RTN","BPSJINIT",157,0)
 W !!,"PHARMACIST DATA."  ; VA LEAD PHARMACIST
"RTN","BPSJINIT",158,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",159,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",160,0)
 S DR="[BPSJ PHARMACIST ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",161,0)
 ;
"RTN","BPSJINIT",162,0)
 I $D(Y) Q
"RTN","BPSJINIT",163,0)
 ;
"RTN","BPSJINIT",164,0)
 ; VA LEAD PHARMACIST LICENSE
"RTN","BPSJINIT",165,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",166,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",167,0)
 S DR="1900.04//" D ^DIE
"RTN","BPSJINIT",168,0)
 ;
"RTN","BPSJINIT",169,0)
 Q
"RTN","BPSJINIT",170,0)
 ;
"RTN","BPSJINIT",171,0)
 ; Create record if it is missing
"RTN","BPSJINIT",172,0)
 ; Set version number to 3
"RTN","BPSJINIT",173,0)
 ; Return record number
"RTN","BPSJINIT",174,0)
VERSION(BPVAL) ;      
"RTN","BPSJINIT",175,0)
 I '$G(BPVAL) Q
"RTN","BPSJINIT",176,0)
 S DA=$O(^BPS(BPVAL,0))
"RTN","BPSJINIT",177,0)
 I 'DA D
"RTN","BPSJINIT",178,0)
 . N DIC,DLAYGO,DR,X,Y,DTOUT,DUOUT
"RTN","BPSJINIT",179,0)
 . S (DIC,DLAYGO)=BPVAL,DIC(0)="L",X="MAIN SETUP ENTRY" D ^DIC
"RTN","BPSJINIT",180,0)
 . S DA=+Y
"RTN","BPSJINIT",181,0)
 I DA=-1 Q
"RTN","BPSJINIT",182,0)
 N DIE,DR,DTOUT
"RTN","BPSJINIT",183,0)
 S DIE=BPVAL,DR="6003////3" D ^DIE
"RTN","BPSJINIT",184,0)
 Q
"RTN","BPSJINIT",185,0)
 ;
"RTN","BPSJINIT",186,0)
VALIDATE ;  this will only validate the Application Registration and
"RTN","BPSJINIT",187,0)
 ;          the Pharmacy registrations
"RTN","BPSJINIT",188,0)
 Q
"RTN","BPSJINIT",189,0)
 N AREG
"RTN","BPSJINIT",190,0)
 ;
"RTN","BPSJINIT",191,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJINIT",192,0)
 ;
"RTN","BPSJINIT",193,0)
 S DIR(0)="EO"
"RTN","BPSJINIT",194,0)
 D ^DIR
"RTN","BPSJINIT",195,0)
 I X=U Q
"RTN","BPSJINIT",196,0)
 ;
"RTN","BPSJINIT",197,0)
 S AREG="" F  S AREG=$O(^BPS(9002313.56,AREG)) Q:'AREG  D  I X=U Q
"RTN","BPSJINIT",198,0)
 . D REG^BPSJPREG(AREG,2)
"RTN","BPSJINIT",199,0)
 . S DIR(0)="EO"
"RTN","BPSJINIT",200,0)
 . D ^DIR
"RTN","BPSJINIT",201,0)
 ;
"RTN","BPSJINIT",202,0)
 Q
"RTN","BPSJPREG")
0^40^B18672204
"RTN","BPSJPREG",1,0)
BPSJPREG ;BHAM ISC/LJF - HL7 Registration MFN Message ;21-NOV-2003
"RTN","BPSJPREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSJPREG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJPREG",4,0)
 ;
"RTN","BPSJPREG",5,0)
 ;**Program Description**
"RTN","BPSJPREG",6,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJPREG",7,0)
 ;
"RTN","BPSJPREG",8,0)
 ;  Variable
"RTN","BPSJPREG",9,0)
 ; HL      = HL7 parameters
"RTN","BPSJPREG",10,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJPREG",11,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJPREG",12,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJPREG",13,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJPREG",14,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJPREG",15,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJPREG",16,0)
 ; IPP     = IP Port
"RTN","BPSJPREG",17,0)
 ; IPA     = IP Address
"RTN","BPSJPREG",18,0)
 ; MCT     = Message Count
"RTN","BPSJPREG",19,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJPREG",20,0)
 ; MSG     = Message
"RTN","BPSJPREG",21,0)
 ;
"RTN","BPSJPREG",22,0)
 ; Don't allow direct execution
"RTN","BPSJPREG",23,0)
 ;
"RTN","BPSJPREG",24,0)
 W !!!,"DIRECT ENTRY NOT ALLOWED",!!!
"RTN","BPSJPREG",25,0)
 Q
"RTN","BPSJPREG",26,0)
 ;
"RTN","BPSJPREG",27,0)
REG(PHARMIX,BPSJVAL) ;  Registration message for when a site installs
"RTN","BPSJPREG",28,0)
 ;
"RTN","BPSJPREG",29,0)
 N HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLPRO,BPSHLRS,IPA,IPP,NPKEY,NCPDP
"RTN","BPSJPREG",30,0)
 N MGRP,MCT,MSG,TAXID,ZRPSEG,BPSJVAL2,BPSJPRES
"RTN","BPSJPREG",31,0)
 ;
"RTN","BPSJPREG",32,0)
 S (MCT,TAXID)=0,BPSJVAL=$G(BPSJVAL)
"RTN","BPSJPREG",33,0)
 ;
"RTN","BPSJPREG",34,0)
 I '$G(PHARMIX) Q
"RTN","BPSJPREG",35,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",36,0)
 ;
"RTN","BPSJPREG",37,0)
 ; NPI Processing      
"RTN","BPSJPREG",38,0)
 ; Get DropDeadDate and Date/Time Last Change
"RTN","BPSJPREG",39,0)
 N BPSJAPI,BPSJNPI,BPSJNDT,BPSJOP,BPSJOPS,BPSJDDD,NPKEY
"RTN","BPSJPREG",40,0)
 S BPSJDDD=$$NPIREQ^BPSNPI(DT)
"RTN","BPSJPREG",41,0)
 N NOW,%,%H,%I,X D NOW^%DTC S BPSJNDT=%
"RTN","BPSJPREG",42,0)
 ; Get OP site for pharmacy and NPIAPI
"RTN","BPSJPREG",43,0)
 S BPSJOP=0,BPSJAPI=""
"RTN","BPSJPREG",44,0)
 F  S BPSJOP=$O(^BPS(9002313.56,PHARMIX,"OPSITE",BPSJOP)) Q:'BPSJOP  D  I BPSJAPI'="" Q
"RTN","BPSJPREG",45,0)
 . S BPSJOPS=$G(^BPS(9002313.56,PHARMIX,"OPSITE",BPSJOP,0))
"RTN","BPSJPREG",46,0)
 . S BPSJAPI=$$NPI^BPSNPI("Pharmacy_ID",BPSJOPS)
"RTN","BPSJPREG",47,0)
 . I $P(BPSJAPI,U,1)=-1 S BPSJAPI="" Q
"RTN","BPSJPREG",48,0)
 . I $P(BPSJAPI,U)>0 S BPSJAPI=$P(BPSJAPI,U)
"RTN","BPSJPREG",49,0)
 ; Check for existing NPI 
"RTN","BPSJPREG",50,0)
 S BPSJNPI=$P($G(^BPS(9002313.56,PHARMIX,"NPI")),U)
"RTN","BPSJPREG",51,0)
 I 'BPSJAPI,BPSJNPI,BPSJVAL<2 D
"RTN","BPSJPREG",52,0)
 . N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJPREG",53,0)
 . S DA=PHARMIX,DIE=$$ROOT^DILFD(9002313.56)
"RTN","BPSJPREG",54,0)
 . S DR="41.01///@;41.02///@" D ^DIE
"RTN","BPSJPREG",55,0)
 I BPSJAPI,BPSJVAL<2 D
"RTN","BPSJPREG",56,0)
 . S ^XTMP("BPSJ",0)=(BPSJNDT+7)_U_BPSJNDT_U_"BPS NPI HL7 DATA"
"RTN","BPSJPREG",57,0)
 . S ^XTMP("BPSJ","NPI",BPSJAPI)=PHARMIX_U_BPSJNDT
"RTN","BPSJPREG",58,0)
 ;
"RTN","BPSJPREG",59,0)
 ;  Get Link data from HL7 table
"RTN","BPSJPREG",60,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJPREG",61,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJPREG",62,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJPREG",63,0)
 ;
"RTN","BPSJPREG",64,0)
 ;  Error if any missing data
"RTN","BPSJPREG",65,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJPREG",66,0)
 ;
"RTN","BPSJPREG",67,0)
 ;  Initialize the HL7
"RTN","BPSJPREG",68,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJPREG",69,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJPREG",70,0)
 S HLECH=$E($G(HL("ECH"),1)) I HLECH="" S HLECH="^"
"RTN","BPSJPREG",71,0)
 S HL("SITE")=$$SITE^VASITE,HL("SAF")=$P(HL("SITE"),U,2,3)
"RTN","BPSJPREG",72,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJPREG",73,0)
 ;
"RTN","BPSJPREG",74,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJPREG",75,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJPREG",76,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJPREG",77,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJPREG",78,0)
 ;
"RTN","BPSJPREG",79,0)
 ;  Set the ZRP Segment
"RTN","BPSJPREG",80,0)
 D EN^BPSJZRP(.HL,PHARMIX,.ZRPSEG,BPSJAPI,.NCPDP)
"RTN","BPSJPREG",81,0)
 M ^TMP("HLS",$J,3)=ZRPSEG K ZRPSEG
"RTN","BPSJPREG",82,0)
 ;
"RTN","BPSJPREG",83,0)
 ;  Set the MFE segment
"RTN","BPSJPREG",84,0)
 N BPSMFE S BPSMFE="MUP"
"RTN","BPSJPREG",85,0)
 S NPKEY=$$NPKEY^BPSNPI(NCPDP,BPSJNPI,BPSJAPI)
"RTN","BPSJPREG",86,0)
 I NPKEY D
"RTN","BPSJPREG",87,0)
 . I '$$BPSACTV^BPSUTIL(PHARMIX) S BPSMFE="MDC"
"RTN","BPSJPREG",88,0)
 . S ^TMP("HLS",$J,2)="MFE"_HLFS_BPSMFE_HLFS_HLFS_HL7DTG
"RTN","BPSJPREG",89,0)
 . S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_HLFS_NPKEY_HLFS_"ST"
"RTN","BPSJPREG",90,0)
 ;
"RTN","BPSJPREG",91,0)
 ;   Set the MFI segment
"RTN","BPSJPREG",92,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Pharmacy Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJPREG",93,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJPREG",94,0)
 ;
"RTN","BPSJPREG",95,0)
 S BPSJPRES=$$VAL2^BPSJVAL(BPSJVAL,BPSJDDD)  ; 0 = ok
"RTN","BPSJPREG",96,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJPREG",97,0)
 ;
"RTN","BPSJPREG",98,0)
 ;-Check if msg valid.
"RTN","BPSJPREG",99,0)
 I 'BPSJPRES D  G FINI
"RTN","BPSJPREG",100,0)
 . N BPSHLRS
"RTN","BPSJPREG",101,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.BPSHLRS,"")
"RTN","BPSJPREG",102,0)
 . I $P($G(BPSHLRS),U,2)]"" D  Q
"RTN","BPSJPREG",103,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJPREG",104,0)
 ... W !!,"ECME Pharmacy Registration HL7 Message not created: "_BPSHLRS
"RTN","BPSJPREG",105,0)
 ... W !," PHARMIX: "_PHARMIX_""
"RTN","BPSJPREG",106,0)
 .. S MCT=MCT+1,MSG(MCT)="ECME Pharmacy Registration HL7 Message not created. (PHARMIX: "_PHARMIX_")"
"RTN","BPSJPREG",107,0)
 .. S MCT=MCT+1,MSG(MCT)=BPSHLRS
"RTN","BPSJPREG",108,0)
 .. D MSG^BPSJUTL(.MSG,"ECME Pharmacy Registration")
"RTN","BPSJPREG",109,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJPREG",110,0)
 .. W !!,"ECME Pharmacy Registration HL7 Message was created successfully."
"RTN","BPSJPREG",111,0)
 ;
"RTN","BPSJPREG",112,0)
 ;
"RTN","BPSJPREG",113,0)
FINI ; Clean up
"RTN","BPSJPREG",114,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",115,0)
 Q
"RTN","BPSJUTL")
0^41^B9622844
"RTN","BPSJUTL",1,0)
BPSJUTL ;BHAM ISC/LJF - e-Pharmacy Utils ;16-OCT-2003
"RTN","BPSJUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSJUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJUTL",4,0)
 ;
"RTN","BPSJUTL",5,0)
 Q
"RTN","BPSJUTL",6,0)
 ;
"RTN","BPSJUTL",7,0)
HLP(PROTOCOL) ;  Find the Protocol IEN
"RTN","BPSJUTL",8,0)
 Q +$O(^ORD(101,"B",PROTOCOL,0))
"RTN","BPSJUTL",9,0)
 ;
"RTN","BPSJUTL",10,0)
VAHL7ECH(HL) ; Hl7 Encoding Characters
"RTN","BPSJUTL",11,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJUTL",12,0)
 S ECH=$G(HL("ECH")) I ECH="" S ECH="^~\&"
"RTN","BPSJUTL",13,0)
 S CPS=$E(ECH),REP=$E(ECH,2)
"RTN","BPSJUTL",14,0)
 ;
"RTN","BPSJUTL",15,0)
 Q
"RTN","BPSJUTL",16,0)
 ;
"RTN","BPSJUTL",17,0)
MSG(BPSJMM,BPSJRTN) ; Message Handler
"RTN","BPSJUTL",18,0)
 ;
"RTN","BPSJUTL",19,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,BPMSJMG
"RTN","BPSJUTL",20,0)
 ;
"RTN","BPSJUTL",21,0)
 I $G(U)="" S U="^"
"RTN","BPSJUTL",22,0)
 I $G(BPSJRTN)]"" S BPSJMM(.0001)="Source Process: "_BPSJRTN
"RTN","BPSJUTL",23,0)
 S BPMSJMG=$O(^BPS(9002313.99,0)) Q:'BPMSJMG
"RTN","BPSJUTL",24,0)
 S BPMSJMG=+$G(^BPS(9002313.99,BPMSJMG,"VITRIA")) Q:'BPMSJMG
"RTN","BPSJUTL",25,0)
 S BPMSJMG=$G(^VA(200,BPMSJMG,.15)) Q:BPMSJMG=""
"RTN","BPSJUTL",26,0)
 S XMY(BPMSJMG)="",XMTEXT="BPSJMM(",XMSUB="ECME Registration Problem."
"RTN","BPSJUTL",27,0)
 D ^XMD
"RTN","BPSJUTL",28,0)
 ;
"RTN","BPSJUTL",29,0)
 Q
"RTN","BPSJUTL",30,0)
 ;
"RTN","BPSJUTL",31,0)
VA200NM(VAIX,VATITLE,HL) ;
"RTN","BPSJUTL",32,0)
 ;
"RTN","BPSJUTL",33,0)
 N RETDATA,BPSNMDAT
"RTN","BPSJUTL",34,0)
 N FS,CPS,REP
"RTN","BPSJUTL",35,0)
 ;
"RTN","BPSJUTL",36,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",37,0)
 S BPSNMDAT=$P($G(^VA(200,VAIX,0)),U,1) I BPSNMDAT="" Q ""
"RTN","BPSJUTL",38,0)
 ;
"RTN","BPSJUTL",39,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",40,0)
 D STDNAME^XLFNAME(.BPSNMDAT,"C")
"RTN","BPSJUTL",41,0)
 ;
"RTN","BPSJUTL",42,0)
 S RETDATA=$G(BPSNMDAT("FAMILY"))              ;1
"RTN","BPSJUTL",43,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("GIVEN"))   ;2
"RTN","BPSJUTL",44,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("MIDDLE"))  ;3
"RTN","BPSJUTL",45,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("SUFFIX"))  ;4
"RTN","BPSJUTL",46,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("PREFIX"))  ;5
"RTN","BPSJUTL",47,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("DEGREE"))  ;6
"RTN","BPSJUTL",48,0)
 ;
"RTN","BPSJUTL",49,0)
 S VATITLE=$P($G(^VA(200,VAIX,0)),U,9)
"RTN","BPSJUTL",50,0)
 I VATITLE S VATITLE=$G(^DIC(3.1,VATITLE,0))
"RTN","BPSJUTL",51,0)
 ;
"RTN","BPSJUTL",52,0)
 Q RETDATA
"RTN","BPSJUTL",53,0)
 ;
"RTN","BPSJUTL",54,0)
VA20013(VAIX,HL) ; Build the HL7 Contact Means data field
"RTN","BPSJUTL",55,0)
 ;
"RTN","BPSJUTL",56,0)
 N FDATA,RETDATA
"RTN","BPSJUTL",57,0)
 N FS,CPS,REP
"RTN","BPSJUTL",58,0)
 ;
"RTN","BPSJUTL",59,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",60,0)
 ; VAIX is the index to ^VA(200,n
"RTN","BPSJUTL",61,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",62,0)
 S RETDATA=$P($G(^VA(200,VAIX,.15)),U,1)   ; LJF@DAOU.COM
"RTN","BPSJUTL",63,0)
 I RETDATA]"",RETDATA["@" S RETDATA=CPS_"NET"_CPS_"INTERNET"_CPS_RETDATA
"RTN","BPSJUTL",64,0)
 S FDATA=$$EN^BPSJPHNM(VAIX,CPS,REP)
"RTN","BPSJUTL",65,0)
 I $L(FDATA) D
"RTN","BPSJUTL",66,0)
 . I $L(RETDATA) S RETDATA=RETDATA_REP
"RTN","BPSJUTL",67,0)
 . S RETDATA=RETDATA_FDATA
"RTN","BPSJUTL",68,0)
 Q RETDATA
"RTN","BPSJUTL",69,0)
 ;
"RTN","BPSJUTL",70,0)
ENCODE(INSTR,TCH) ;  Encode data - Primarily HL7
"RTN","BPSJUTL",71,0)
 N X,WCHR,OSTR
"RTN","BPSJUTL",72,0)
 S OSTR=""
"RTN","BPSJUTL",73,0)
 I $G(INSTR)]"" F X=1:1:$L(INSTR) D  S OSTR=OSTR_WCHR
"RTN","BPSJUTL",74,0)
 . S WCHR=$E(INSTR,X) I $D(TCH(WCHR)) S WCHR=TCH(WCHR)
"RTN","BPSJUTL",75,0)
 Q OSTR
"RTN","BPSJUTL",76,0)
 ;
"RTN","BPSJUTL",77,0)
SPAR(HL,BPSJSEG,HCTS) ;  Segment Parsing
"RTN","BPSJUTL",78,0)
 N II,IJ,IK,ISDATA
"RTN","BPSJUTL",79,0)
 N FS,CPS,REP,ECH
"RTN","BPSJUTL",80,0)
 ;
"RTN","BPSJUTL",81,0)
 I '$G(HCTS) Q
"RTN","BPSJUTL",82,0)
 ;
"RTN","BPSJUTL",83,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",84,0)
 M ISDATA=^TMP($J,"BPSJHLI",HCTS)
"RTN","BPSJUTL",85,0)
 S IK=0,IJ=1,II=""
"RTN","BPSJUTL",86,0)
 F  S II=$O(ISDATA(II)) Q:II=""  D
"RTN","BPSJUTL",87,0)
 . S ISDATA=$G(ISDATA(II)) Q:ISDATA=""
"RTN","BPSJUTL",88,0)
 . F  D  Q:ISDATA=""
"RTN","BPSJUTL",89,0)
 . . S IK=IK+1,BPSJSEG(IJ,IK)=$P(ISDATA,FS)
"RTN","BPSJUTL",90,0)
 . . S $P(ISDATA,FS)=""
"RTN","BPSJUTL",91,0)
 . . I $E(ISDATA)=FS S IJ=IJ+1,$E(ISDATA)=""
"RTN","BPSJUTL",92,0)
 ;
"RTN","BPSJUTL",93,0)
 ; Promote data in 1st subnode and kill subnode
"RTN","BPSJUTL",94,0)
 S II=""
"RTN","BPSJUTL",95,0)
 F  S II=$O(BPSJSEG(II)) Q:II=""  D
"RTN","BPSJUTL",96,0)
 . S IJ=$O(BPSJSEG(II,"")) Q:'IJ
"RTN","BPSJUTL",97,0)
 . S BPSJSEG(II)=BPSJSEG(II,IJ) K BPSJSEG(II,IJ)
"RTN","BPSJUTL",98,0)
 Q
"RTN","BPSJVAL1")
0^209^B15725764
"RTN","BPSJVAL1",1,0)
BPSJVAL1 ;BHAM ISC/LJF - Pharmacy Application Validation ;2004-03-01
"RTN","BPSJVAL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSJVAL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJVAL1",4,0)
 ;
"RTN","BPSJVAL1",5,0)
 N BPSJVAL1,VERBOSE
"RTN","BPSJVAL1",6,0)
 W !!!,"SITE REGISTRATION VALIDATION.",!
"RTN","BPSJVAL1",7,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJVAL1",8,0)
 W !!!!
"RTN","BPSJVAL1",9,0)
 ;
"RTN","BPSJVAL1",10,0)
 Q
"RTN","BPSJVAL1",11,0)
 ;
"RTN","BPSJVAL1",12,0)
VALIDATE ; Validate ZQR Data
"RTN","BPSJVAL1",13,0)
 ;
"RTN","BPSJVAL1",14,0)
 N SEG,SEGIX,ZQR,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX
"RTN","BPSJVAL1",15,0)
 N HL7EOIEN,HL7EOIP
"RTN","BPSJVAL1",16,0)
 N HL7VOIEN,HL7VOIP
"RTN","BPSJVAL1",17,0)
 N HL7EDOM,HL7PDOM,HL7OPORT,HL7PORT,CMA
"RTN","BPSJVAL1",18,0)
 ;
"RTN","BPSJVAL1",19,0)
 ; Constants
"RTN","BPSJVAL1",20,0)
 S HL7PORT=5105,ZMAX=8,CMA=","
"RTN","BPSJVAL1",21,0)
 S HL7PDOM="EPHARMACY.VITRIA-EDI.AAC.VA.GOV"
"RTN","BPSJVAL1",22,0)
 ;
"RTN","BPSJVAL1",23,0)
 S RETCODE=+$G(RETCODE)
"RTN","BPSJVAL1",24,0)
 S ZQR="",RIX=0
"RTN","BPSJVAL1",25,0)
 ;
"RTN","BPSJVAL1",26,0)
 S HL7EOIEN=$$FIND1^DIC(870,"",,"EPHARM OUT","B")_CMA   ;EPHARM OUT
"RTN","BPSJVAL1",27,0)
 S HL7VOIEN=$$FIND1^DIC(870,"",,"IIV EC","B")_CMA       ;IIV EC
"RTN","BPSJVAL1",28,0)
 ;
"RTN","BPSJVAL1",29,0)
 ; Vitria Domain name
"RTN","BPSJVAL1",30,0)
 S HL7EDOM=$$GET1^DIQ(870,HL7EOIEN,.03)   ;EPHARM OUT
"RTN","BPSJVAL1",31,0)
 I HL7EDOM=HL7PDOM S ZNOTE="   DOMAIN NAME - Required - VALID: "_HL7PDOM
"RTN","BPSJVAL1",32,0)
 E  D
"RTN","BPSJVAL1",33,0)
 . I HL7EDOM="" S ZNOTE="** DOMAIN NAME - Required - INVALID" S RETCODE=.3 Q
"RTN","BPSJVAL1",34,0)
 . S ZNOTE=" * WARNING: EXPECTED DOMAIN NAME: "_HL7PDOM_"                            CURRENT DOMAIN NAME: "_HL7EDOM
"RTN","BPSJVAL1",35,0)
 S RETCODE(.3)=ZNOTE
"RTN","BPSJVAL1",36,0)
 I +$G(VERBOSE) W !,RETCODE(.3)
"RTN","BPSJVAL1",37,0)
 ;
"RTN","BPSJVAL1",38,0)
 ; Get IP addresses
"RTN","BPSJVAL1",39,0)
 S HL7EOIP=$$GET1^DIQ(870,HL7EOIEN,400.01)   ;EPHARM OUT
"RTN","BPSJVAL1",40,0)
 S HL7VOIP=$$GET1^DIQ(870,HL7VOIEN,400.01)   ;IIV EC
"RTN","BPSJVAL1",41,0)
 ;
"RTN","BPSJVAL1",42,0)
 I HL7EOIP,HL7EOIP=HL7VOIP S ZNOTE="   TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - VALID: "_HL7EOIP
"RTN","BPSJVAL1",43,0)
 E  D
"RTN","BPSJVAL1",44,0)
 . I 'HL7EOIP S ZNOTE="** TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - INVALID",RETCODE=.7 Q
"RTN","BPSJVAL1",45,0)
 . I HL7VOIP,HL7EOIP'=HL7VOIP S ZNOTE=" * WARNING: ""EPHARM OUT"" TCP/IP ADDRESS DIFFERENT THAN ""IIV EC"" TCP/IP ADDRESS.        EPHARM OUT: "_HL7EOIP_"   IIV EC: "_HL7VOIP
"RTN","BPSJVAL1",46,0)
 S RETCODE(.7)=ZNOTE
"RTN","BPSJVAL1",47,0)
 I +$G(VERBOSE) W !,RETCODE(.7)
"RTN","BPSJVAL1",48,0)
 ;
"RTN","BPSJVAL1",49,0)
 ; Get Outgoing Port and IP Address
"RTN","BPSJVAL1",50,0)
 S HL7OPORT=$$GET1^DIQ(870,HL7EOIEN,400.02)   ;EPHARM OUT
"RTN","BPSJVAL1",51,0)
 I HL7OPORT,HL7OPORT=HL7PORT S ZNOTE="   ""EPHARM OUT"" PORT NUMBER - Required - VALID: "_HL7OPORT
"RTN","BPSJVAL1",52,0)
 E  D
"RTN","BPSJVAL1",53,0)
 . S ZNOTE=" * WARNING: EXPECTED ""EPHARM OUT"" PORT NUMBER: "_HL7PORT
"RTN","BPSJVAL1",54,0)
 . S ZNOTE=ZNOTE_"                                         CURRENT "
"RTN","BPSJVAL1",55,0)
 . S ZNOTE=ZNOTE_"""EPHARM OUT"" PORT NUMBER: "_HL7OPORT
"RTN","BPSJVAL1",56,0)
 . I 'HL7OPORT S ZNOTE="** ""EPHARM OUT"" PORT NUMBER - Required - INVALID",RETCODE=.9 Q
"RTN","BPSJVAL1",57,0)
 S RETCODE(.9)=ZNOTE
"RTN","BPSJVAL1",58,0)
 I +$G(VERBOSE) W !,RETCODE(.9)
"RTN","BPSJVAL1",59,0)
 ;
"RTN","BPSJVAL1",60,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D
"RTN","BPSJVAL1",61,0)
 . I $E(SEG,1,3)="ZQR" S ZQR=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL1",62,0)
 . I ZQR="" Q
"RTN","BPSJVAL1",63,0)
 . S PIXL=$L(SEG,ZQR)
"RTN","BPSJVAL1",64,0)
 . F  S RIX=RIX+1,PIX=PIX+1 Q:RIX>ZMAX  D
"RTN","BPSJVAL1",65,0)
 .. S RETCODE(RIX)=$P(SEG,ZQR,PIX) D @RIX
"RTN","BPSJVAL1",66,0)
 .. ; RIX 4 - EPHARM IN Port - no longer required nor validated
"RTN","BPSJVAL1",67,0)
 .. I +$G(VERBOSE),$L($G(RETCODE(RIX))),RIX'=4 W !,RETCODE(RIX) Q
"RTN","BPSJVAL1",68,0)
 ;
"RTN","BPSJVAL1",69,0)
 Q
"RTN","BPSJVAL1",70,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL1",71,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL1",72,0)
 ;
"RTN","BPSJVAL1",73,0)
1 ; Set ID - NS
"RTN","BPSJVAL1",74,0)
 Q
"RTN","BPSJVAL1",75,0)
2 ; Site Number - R
"RTN","BPSJVAL1",76,0)
 S ZNOTE="   SITE NUMBER - Required - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",77,0)
 I RETCODE(RIX)="" S ZNOTE="** SITE NUMBER - Required - INVALID",RETCODE=2
"RTN","BPSJVAL1",78,0)
 S RETCODE(RIX)=ZNOTE
"RTN","BPSJVAL1",79,0)
 Q
"RTN","BPSJVAL1",80,0)
3 ; Interface Version - R
"RTN","BPSJVAL1",81,0)
 ;     Must equal 2 or greater for this validation version
"RTN","BPSJVAL1",82,0)
 S ZNOTE="   INTERFACE VERSION - Required - VALID: "
"RTN","BPSJVAL1",83,0)
 I RETCODE(RIX)<2 S ZNOTE="** INTERFACE VERSION - Required - INVALID: ",RETCODE=3
"RTN","BPSJVAL1",84,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL1",85,0)
 Q
"RTN","BPSJVAL1",86,0)
4 ; EPHARM IN port - NS
"RTN","BPSJVAL1",87,0)
 Q
"RTN","BPSJVAL1",88,0)
5 ; Contact Name
"RTN","BPSJVAL1",89,0)
 S RETCODE(RIX)="   CONTACT NAME - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",90,0)
 Q
"RTN","BPSJVAL1",91,0)
6 ; Contact Means
"RTN","BPSJVAL1",92,0)
 S RETCODE(RIX)="   CONTACT MEANS - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",93,0)
 Q
"RTN","BPSJVAL1",94,0)
7 ; Alternate Contact NAME
"RTN","BPSJVAL1",95,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT NAME - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",96,0)
 Q
"RTN","BPSJVAL1",97,0)
8 ; Alternate Contact Means
"RTN","BPSJVAL1",98,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT MEANS - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",99,0)
 Q
"RTN","BPSJVAL2")
0^206^B28991650
"RTN","BPSJVAL2",1,0)
BPSJVAL2 ;BHAM ISC/LJF - Validate Pharmacy data ;2004-03-01
"RTN","BPSJVAL2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSJVAL2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJVAL2",4,0)
 ;
"RTN","BPSJVAL2",5,0)
 N PHARMIX,RET,DIR,X
"RTN","BPSJVAL2",6,0)
 ;
"RTN","BPSJVAL2",7,0)
 S PHARMIX=0,X=""
"RTN","BPSJVAL2",8,0)
 F  S PHARMIX=$O(^BPS(9002313.56,PHARMIX)) Q:'PHARMIX  D  Q:X=U
"RTN","BPSJVAL2",9,0)
 . W !!,"VERIFY PHARMACY REGISTRATIONS DATA.",!
"RTN","BPSJVAL2",10,0)
 . D REG^BPSJPREG(PHARMIX,2)
"RTN","BPSJVAL2",11,0)
 . W !
"RTN","BPSJVAL2",12,0)
 . S DIR(0)="EO" D ^DIR
"RTN","BPSJVAL2",13,0)
 ;
"RTN","BPSJVAL2",14,0)
 Q
"RTN","BPSJVAL2",15,0)
 ;
"RTN","BPSJVAL2",16,0)
 ; Array HL and variable VERBOSE newed/set by calling routine
"RTN","BPSJVAL2",17,0)
 ; RETCODE returned to calling routine
"RTN","BPSJVAL2",18,0)
VALIDATE(BPSJDDD) ;
"RTN","BPSJVAL2",19,0)
 N SEG,SEGIX,ZRP,RAY,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX,CPS,FS,REP
"RTN","BPSJVAL2",20,0)
 N VALDATA,TMP
"RTN","BPSJVAL2",21,0)
 S ZMAX=17
"RTN","BPSJVAL2",22,0)
 ;
"RTN","BPSJVAL2",23,0)
 S RETCODE=$G(RETCODE)
"RTN","BPSJVAL2",24,0)
 S ZRP="",RIX=0
"RTN","BPSJVAL2",25,0)
 ;
"RTN","BPSJVAL2",26,0)
 ; Set HL7 Delimiters - use standard defaults if none provided
"RTN","BPSJVAL2",27,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJVAL2",28,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJVAL2",29,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJVAL2",30,0)
 ;
"RTN","BPSJVAL2",31,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D  I ZRP]"" Q
"RTN","BPSJVAL2",32,0)
 . I $E(SEG,1,3)="ZRP" S ZRP=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL2",33,0)
 I ZRP="" Q
"RTN","BPSJVAL2",34,0)
 F  S RIX=$O(^TMP("HLS",$J,SEGIX,RIX)) Q:'RIX  I RIX<(ZMAX+1) D
"RTN","BPSJVAL2",35,0)
 . S TMP=$P($G(^TMP("HLS",$J,SEGIX,RIX)),ZRP)
"RTN","BPSJVAL2",36,0)
 . I $G(TMP)="" S RETCODE(RIX)=""
"RTN","BPSJVAL2",37,0)
 . I RIX=3 S RETCODE(RIX)=TMP ;capture pharmacy name
"RTN","BPSJVAL2",38,0)
 F  S RIX=$O(RETCODE(RIX)) Q:'RIX  D
"RTN","BPSJVAL2",39,0)
 . D @RIX
"RTN","BPSJVAL2",40,0)
 . I +$G(VERBOSE),$L($G(RETCODE(RIX))) W !,RETCODE(RIX)
"RTN","BPSJVAL2",41,0)
 ;
"RTN","BPSJVAL2",42,0)
 Q
"RTN","BPSJVAL2",43,0)
 ;
"RTN","BPSJVAL2",44,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL2",45,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL2",46,0)
 ;
"RTN","BPSJVAL2",47,0)
1 ; Set ID - NS
"RTN","BPSJVAL2",48,0)
 Q
"RTN","BPSJVAL2",49,0)
2 ; NCPDP Number - C
"RTN","BPSJVAL2",50,0)
 S ZNOTE="   NCPDP NUMBER - VALID"
"RTN","BPSJVAL2",51,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",52,0)
 . I BPSJDDD=0 D 
"RTN","BPSJVAL2",53,0)
 . . I '$D(RETCODE(17)) Q
"RTN","BPSJVAL2",54,0)
 . . S ZNOTE="** NCPDP NUMBER - NCPDP OR NPI - Missing/Invalid",RETCODE=2
"RTN","BPSJVAL2",55,0)
 . . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",56,0)
 Q
"RTN","BPSJVAL2",57,0)
3 ; PHARMACY NAME - R
"RTN","BPSJVAL2",58,0)
 S ZNOTE="   PHARMACY NAME"
"RTN","BPSJVAL2",59,0)
 I RETCODE(RIX)="" D 
"RTN","BPSJVAL2",60,0)
 . S ZNOTE="** PHARMACY NAME - Missing/Invalid",RETCODE=3
"RTN","BPSJVAL2",61,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_$$DECODE(RETCODE(RIX))
"RTN","BPSJVAL2",62,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",63,0)
 Q
"RTN","BPSJVAL2",64,0)
4 ; DEA Number - R
"RTN","BPSJVAL2",65,0)
 S ZNOTE="   DEA NUMBER - Required - VALID"
"RTN","BPSJVAL2",66,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",67,0)
 . S ZNOTE="** DEA NUMBER - Missing/Invalid",RETCODE=4
"RTN","BPSJVAL2",68,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",69,0)
 Q
"RTN","BPSJVAL2",70,0)
5 ; Hour of Operation
"RTN","BPSJVAL2",71,0)
 S ZNOTE="   HOURS OF OPERATION - VALID"
"RTN","BPSJVAL2",72,0)
 Q
"RTN","BPSJVAL2",73,0)
6 ; Mailing Address - R
"RTN","BPSJVAL2",74,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",75,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street address
"RTN","BPSJVAL2",76,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",77,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",78,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",79,0)
 S ZNOTE="   MAILING ADDRESS - Required - VALID"
"RTN","BPSJVAL2",80,0)
 I VALDATA D
"RTN","BPSJVAL2",81,0)
 . S ZNOTE="** MAILING ADDRESS - Missing/Invalid",RETCODE=6
"RTN","BPSJVAL2",82,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",83,0)
 Q
"RTN","BPSJVAL2",84,0)
7 ; Remittance Address - R
"RTN","BPSJVAL2",85,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",86,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street Address
"RTN","BPSJVAL2",87,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",88,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",89,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",90,0)
 S ZNOTE="   REMITTANCE ADDRESS - Required - VALID"
"RTN","BPSJVAL2",91,0)
 I VALDATA D 
"RTN","BPSJVAL2",92,0)
 . S ZNOTE="** REMITTANCE ADDRESS - Missing/Invalid",RETCODE=7
"RTN","BPSJVAL2",93,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",94,0)
 Q
"RTN","BPSJVAL2",95,0)
8 ; Contact Name
"RTN","BPSJVAL2",96,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",97,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",98,0)
 S ZNOTE="   CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",99,0)
 I VALDATA D
"RTN","BPSJVAL2",100,0)
 . S ZNOTE="** CONTACT NAME - Missing/Invalid",RETCODE=8
"RTN","BPSJVAL2",101,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",102,0)
 Q
"RTN","BPSJVAL2",103,0)
9 ; Contact Title
"RTN","BPSJVAL2",104,0)
 S ZNOTE="   CONTACT TITLE - VALID"
"RTN","BPSJVAL2",105,0)
 Q
"RTN","BPSJVAL2",106,0)
10 ; Contact means
"RTN","BPSJVAL2",107,0)
 S ZNOTE="   CONTACT MEANS - VALID"
"RTN","BPSJVAL2",108,0)
 ;S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",109,0)
 Q
"RTN","BPSJVAL2",110,0)
11 ; Alternate Contact Name
"RTN","BPSJVAL2",111,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",112,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",113,0)
 S ZNOTE="   ALTERNATE CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",114,0)
 I VALDATA D
"RTN","BPSJVAL2",115,0)
 . S ZNOTE="** ALTERNATE CONTACT NAME - Missing/Invalid",RETCODE=11
"RTN","BPSJVAL2",116,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",117,0)
 Q
"RTN","BPSJVAL2",118,0)
12 ; Alternate Contact Title
"RTN","BPSJVAL2",119,0)
 S ZNOTE="   ALTERNATE CONTACT TITLE - VALID"
"RTN","BPSJVAL2",120,0)
 Q
"RTN","BPSJVAL2",121,0)
13 ; Alternate Contact means
"RTN","BPSJVAL2",122,0)
 S ZNOTE="   ALTERNATE CONTACT MEANS - VALID"
"RTN","BPSJVAL2",123,0)
 Q
"RTN","BPSJVAL2",124,0)
14 ; Lead Pharmacist Name - R
"RTN","BPSJVAL2",125,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",126,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",127,0)
 S ZNOTE="   LEAD PHARMACIST NAME - Required - VALID"
"RTN","BPSJVAL2",128,0)
 I VALDATA D
"RTN","BPSJVAL2",129,0)
 . S ZNOTE="** LEAD PHARMACIST NAME - Missing/Invalid",RETCODE=14
"RTN","BPSJVAL2",130,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",131,0)
 Q
"RTN","BPSJVAL2",132,0)
15 ; Lead Pharmacist Title
"RTN","BPSJVAL2",133,0)
 S ZNOTE="   LEAD PHARMACIST TITLE - VALID"
"RTN","BPSJVAL2",134,0)
 Q
"RTN","BPSJVAL2",135,0)
16 ; Lead Pharmacist License Number
"RTN","BPSJVAL2",136,0)
 S ZNOTE="   LEAD PHARMACIST LICENSE NUMBER - VALID"
"RTN","BPSJVAL2",137,0)
 Q
"RTN","BPSJVAL2",138,0)
17 ; NPI Number - C (R - AFTER DDD)
"RTN","BPSJVAL2",139,0)
 S ZNOTE="   NPI NUMBER - Required - VALID "
"RTN","BPSJVAL2",140,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",141,0)
 . I BPSJDDD=0 D
"RTN","BPSJVAL2",142,0)
 . . I '$D(RETCODE(2)) S ZNOTE="   NPI NUMBER - Warning NPI NUMBER Missing " Q
"RTN","BPSJVAL2",143,0)
 . . S ZNOTE="** NPI NUMBER - NPI OR NCPDP - Missing/Invalid" S RETCODE=17
"RTN","BPSJVAL2",144,0)
 . I BPSJDDD>0 D
"RTN","BPSJVAL2",145,0)
 . . S ZNOTE="** NPI NUMBER - Missing/Invalid" S RETCODE=17
"RTN","BPSJVAL2",146,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",147,0)
 Q
"RTN","BPSJVAL2",148,0)
 ;
"RTN","BPSJVAL2",149,0)
TRIMTAIL(INSTR) ;
"RTN","BPSJVAL2",150,0)
 N OUTSTR,CHR
"RTN","BPSJVAL2",151,0)
 ;
"RTN","BPSJVAL2",152,0)
 I $G(INSTR)="" Q ""   ; quit if nothing there
"RTN","BPSJVAL2",153,0)
 ;
"RTN","BPSJVAL2",154,0)
 S INSTR=$RE(INSTR)
"RTN","BPSJVAL2",155,0)
 S CHR=$E($TR(INSTR,CPS_REP))
"RTN","BPSJVAL2",156,0)
 I CHR]"" Q $RE($P(INSTR,CHR,2,200))_CHR
"RTN","BPSJVAL2",157,0)
 Q ""
"RTN","BPSJVAL2",158,0)
 ;
"RTN","BPSJVAL2",159,0)
 ; DECODE - Normalize data for display
"RTN","BPSJVAL2",160,0)
 ; Input:
"RTN","BPSJVAL2",161,0)
 ;   INSTR - String to normalize
"RTN","BPSJVAL2",162,0)
 ; Output
"RTN","BPSJVAL2",163,0)
 ;   Normalize data  
"RTN","BPSJVAL2",164,0)
DECODE(INSTR) ;
"RTN","BPSJVAL2",165,0)
 N TRCH
"RTN","BPSJVAL2",166,0)
 S TRCH("\F\")="|",TRCH("\R\")="~",TRCH("\E\")="\"
"RTN","BPSJVAL2",167,0)
 S TRCH("\T\")="&",TRCH("\S\")="^"
"RTN","BPSJVAL2",168,0)
 Q $$DECODE^BPSJZPR(INSTR,.TRCH)
"RTN","BPSJXI1")
1^189
"RTN","BPSMHDR")
0^162^B2671885
"RTN","BPSMHDR",1,0)
BPSMHDR ;BHAM ISC/FCS/DRS - MENUS HEADERS ;06/01/2004
"RTN","BPSMHDR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSMHDR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSMHDR",4,0)
 ;
"RTN","BPSMHDR",5,0)
 ; XQSAV,XQY0 passed in from various BPS options
"RTN","BPSMHDR",6,0)
HDR ;EP - Screen header
"RTN","BPSMHDR",7,0)
 N BPSMT,BPSPNV,D,DIC,X,Y
"RTN","BPSMHDR",8,0)
 Q:$G(XQY0)=""
"RTN","BPSMHDR",9,0)
 I $D(XQSAV),XQY0'=XQSAV Q
"RTN","BPSMHDR",10,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","BPSMHDR",11,0)
 S D="C",DIC="^DIC(9.4,",X="BPS",DIC(0)="" D IX^DIC
"RTN","BPSMHDR",12,0)
 S BPSPNV=+Y
"RTN","BPSMHDR",13,0)
 I $G(BPSPNV) S BPSPNV="V"_$$GET1^DIQ(9.4,BPSPNV,13,1)
"RTN","BPSMHDR",14,0)
 S BPSPNV="Electronic Claims Management Engine (ECME) "_BPSPNV
"RTN","BPSMHDR",15,0)
 S BPSMT=$S($P(XQY0,U)="BPSMENU":"Main Menu",1:$P(XQY0,U,2))
"RTN","BPSMHDR",16,0)
 N A,D,F,L,N,R
"RTN","BPSMHDR",17,0)
 S F=0
"RTN","BPSMHDR",18,0)
 W !
"RTN","BPSMHDR",19,0)
 S A=$X W IORVON,IORVOFF S D=$X S:D>A F=D-A ;compute length of revvideo
"RTN","BPSMHDR",20,0)
 S L=(80-$L(BPSPNV))\2-1,R=L+$L(BPSPNV)+1
"RTN","BPSMHDR",21,0)
 S D=$L(BPSPNV)+2,N=$L(BPSPNV)-1
"RTN","BPSMHDR",22,0)
 W @IOF,!,$$CTR($$REPEAT^XLFSTR("*",D)),!
"RTN","BPSMHDR",23,0)
 W ?L,"*",$$CTR(BPSPNV,N),?R,"*",!
"RTN","BPSMHDR",24,0)
 W ?L,"*",$$CTR($$LOC(),N),?R,"*",!
"RTN","BPSMHDR",25,0)
 W ?L,"*",?(L+(((R-L)-$L(BPSMT))\2)),IORVON,BPSMT,IORVOFF,?R+F,"*",!
"RTN","BPSMHDR",26,0)
 W $$CTR($$REPEAT^XLFSTR("*",D)),!
"RTN","BPSMHDR",27,0)
 Q
"RTN","BPSMHDR",28,0)
 ;
"RTN","BPSMHDR",29,0)
 ;----------
"RTN","BPSMHDR",30,0)
CTR(X,Y) ;EP - Center X in a field Y wide.
"RTN","BPSMHDR",31,0)
 Q $J("",$S($D(Y):Y,1:IOM)-$L(X)\2)_X
"RTN","BPSMHDR",32,0)
 ;----------
"RTN","BPSMHDR",33,0)
 ;EP
"RTN","BPSMHDR",34,0)
LOC() ;EP - Return location name from file 4 based on DUZ(2).
"RTN","BPSMHDR",35,0)
 N LOC
"RTN","BPSMHDR",36,0)
 I '$G(DUZ(2)) Q "DUZ(2) UNDEFINED OR 0"
"RTN","BPSMHDR",37,0)
 S LOC=$$GET1^DIQ(4,DUZ(2),.01,"E")
"RTN","BPSMHDR",38,0)
 I LOC'="" Q LOC
"RTN","BPSMHDR",39,0)
 Q "UNKNOWN"
"RTN","BPSNCPD1")
0^27^B40334169
"RTN","BPSNCPD1",1,0)
BPSNCPD1 ;BHAM ISC/LJE - Pharmacy API part 2 ;06/16/2004
"RTN","BPSNCPD1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSNCPD1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD1",4,0)
 ;
"RTN","BPSNCPD1",5,0)
 ; External reference to $$NCPDPQTY^PSSBPSUT supported by IA4992
"RTN","BPSNCPD1",6,0)
 ;
"RTN","BPSNCPD1",7,0)
 ; Due to space considerations, these comments were moved from BPSNPCPD
"RTN","BPSNCPD1",8,0)
 ;   to this routine.
"RTN","BPSNCPD1",9,0)
 ;
"RTN","BPSNCPD1",10,0)
 ; ------------------ Beginning of BPSNCPDP comments ------------------
"RTN","BPSNCPD1",11,0)
 ;Input
"RTN","BPSNCPD1",12,0)
 ; BRXIEN = Prescription IEN
"RTN","BPSNCPD1",13,0)
 ; BFILL = Fill Number
"RTN","BPSNCPD1",14,0)
 ; BFILLDAT = Fill Date of current prescription and fill number
"RTN","BPSNCPD1",15,0)
 ; BWHERE (RX Action)
"RTN","BPSNCPD1",16,0)
 ;    ARES = Resubmit for an auto-reversed claim was released while waiting
"RTN","BPSNCPD1",17,0)
 ;           for the payer response
"RTN","BPSNCPD1",18,0)
 ;    AREV = Auto-Reversal
"RTN","BPSNCPD1",19,0)
 ;    BB   = Back Billing
"RTN","BPSNCPD1",20,0)
 ;    CRLB = CMOP Release & Rebill
"RTN","BPSNCPD1",21,0)
 ;    CRLR = CMOP Release & Reverse (successful release)
"RTN","BPSNCPD1",22,0)
 ;    CRLX = CMOP unsuccessful release & reverse
"RTN","BPSNCPD1",23,0)
 ;    DC   = Discontinue - only reverse un-released PAYABLE DC's, release date check
"RTN","BPSNCPD1",24,0)
 ;           should be in calling routine.
"RTN","BPSNCPD1",25,0)
 ;    DDED = Delete in edit
"RTN","BPSNCPD1",26,0)
 ;    DE   = Delete
"RTN","BPSNCPD1",27,0)
 ;    ED   = Edit
"RTN","BPSNCPD1",28,0)
 ;    ERES = Resubmit from ECME user screen
"RTN","BPSNCPD1",29,0)
 ;    EREV = Reversal from ECME user screen
"RTN","BPSNCPD1",30,0)
 ;    HLD  = Put prescription on Hold
"RTN","BPSNCPD1",31,0)
 ;    OF   = Original Fill
"RTN","BPSNCPD1",32,0)
 ;    PC   = Pull CMOPs
"RTN","BPSNCPD1",33,0)
 ;    PE   = Pull early from suspense
"RTN","BPSNCPD1",34,0)
 ;    PL   = Pull local from suspense
"RTN","BPSNCPD1",35,0)
 ;    PP   = PP from Patient Prescription Processing option
"RTN","BPSNCPD1",36,0)
 ;    RF   = Refill
"RTN","BPSNCPD1",37,0)
 ;    RL   = Release Rx NDC check - Rebill if billed NDC doesn't match release NDC
"RTN","BPSNCPD1",38,0)
 ;    RN   = Renew
"RTN","BPSNCPD1",39,0)
 ;    RRL  = Original claim rejected, submit another claim, no reversal
"RTN","BPSNCPD1",40,0)
 ;    RS   = Return-to-Stock
"RTN","BPSNCPD1",41,0)
 ; BILLNDC = Valid NDC# with format 5-4-2
"RTN","BPSNCPD1",42,0)
 ; REVREAS = Reversal Reason
"RTN","BPSNCPD1",43,0)
 ; DURREC  = String of DUR info - Three "^" pieces
"RTN","BPSNCPD1",44,0)
 ;                Professional Service Code
"RTN","BPSNCPD1",45,0)
 ;                Reason for Service Code
"RTN","BPSNCPD1",46,0)
 ;                Result of Service Code
"RTN","BPSNCPD1",47,0)
 ; BPOVRIEN = Pointer to BPS NCPDP OVERIDE file.  This parameter will 
"RTN","BPSNCPD1",48,0)
 ;            only be passed if there are overrides entered by the
"RTN","BPSNCPD1",49,0)
 ;            user via the Resubmit with Edits (RED) option in the 
"RTN","BPSNCPD1",50,0)
 ;            user screen.
"RTN","BPSNCPD1",51,0)
 ; BPSCLARF = Clarification Code (0-9,99), entered by pharmacist and passed
"RTN","BPSNCPD1",52,0)
 ;            by Outpatient Pharmacy to ECME to put into the claim  
"RTN","BPSNCPD1",53,0)
 ;  
"RTN","BPSNCPD1",54,0)
 ;Output (RESPONSE^MESSAGE)
"RTN","BPSNCPD1",55,0)
 ; RESPONSE
"RTN","BPSNCPD1",56,0)
 ;    0  Submitted through ECME
"RTN","BPSNCPD1",57,0)
 ;    1  No submission through ECME
"RTN","BPSNCPD1",58,0)
 ;    2  IB not billable
"RTN","BPSNCPD1",59,0)
 ;    3  Claim was closed, not submitted (RTS/Deletes)
"RTN","BPSNCPD1",60,0)
 ;    4  Unable to queue claim
"RTN","BPSNCPD1",61,0)
 ;    5  Incorrect information supplied to ECME
"RTN","BPSNCPD1",62,0)
 ;    10 Reversal but no resubmit
"RTN","BPSNCPD1",63,0)
 ; MESSAGE = Message associated with the response (error/submitted)
"RTN","BPSNCPD1",64,0)
 ; ----------------- End of BPSNCPDP comments ----------------------
"RTN","BPSNCPD1",65,0)
 ;
"RTN","BPSNCPD1",66,0)
 ; Procedure STARRAY - Retrieve information for API call to IB and store in BPSARRY
"RTN","BPSNCPD1",67,0)
 ; Incoming Parameters
"RTN","BPSNCPD1",68,0)
 ;    BRXIEN - Prescription IEN
"RTN","BPSNCPD1",69,0)
 ;    BFILL  - Fill Number
"RTN","BPSNCPD1",70,0)
 ;    BWHERE - RX action
"RTN","BPSNCPD1",71,0)
 ;    BPSARRY  - Array that is built (passed by reference)
"RTN","BPSNCPD1",72,0)
 ;    BPSITE - OUTPATIENT SITE file #59 ien
"RTN","BPSNCPD1",73,0)
STARRAY(BRXIEN,BFILL,BWHERE,BPSARRY,BPSITE) ;
"RTN","BPSNCPD1",74,0)
 N DRUGIEN,BPARR,BPSARR,QTY
"RTN","BPSNCPD1",75,0)
 D RXAPI^BPSUTIL1(BRXIEN,"6;7;8;31","BPARR","I")
"RTN","BPSNCPD1",76,0)
 I BFILL>0 D RXSUBF^BPSUTIL1(BRXIEN,52,52.1,BFILL,"1;1.1;17","BPARR","I")
"RTN","BPSNCPD1",77,0)
 S BPSARRY("DFN")=DFN
"RTN","BPSNCPD1",78,0)
 S BPSARRY("DAYS SUPPLY")=$S(BFILL=0:$G(BPARR(52,BRXIEN,8,"I")),1:$G(BPARR(52.1,BFILL,1.1,"I")))
"RTN","BPSNCPD1",79,0)
 S BPSARRY("IEN")=BRXIEN
"RTN","BPSNCPD1",80,0)
 S BPSARRY("FILL NUMBER")=BFILL
"RTN","BPSNCPD1",81,0)
 S BPSARRY("NDC")=BILLNDC
"RTN","BPSNCPD1",82,0)
 S (BPSARRY("DRUG"),DRUGIEN)=BPARR(52,BRXIEN,6,"I")
"RTN","BPSNCPD1",83,0)
 S BPSARRY("DEA")=$$DRUGDIE^BPSUTIL1(DRUGIEN,3)
"RTN","BPSNCPD1",84,0)
 S BPSARRY("COST")=$$DRUGDIE^BPSUTIL1(DRUGIEN,16)
"RTN","BPSNCPD1",85,0)
 S QTY=$S(BFILL=0:$G(BPARR(52,BRXIEN,7,"I")),1:$G(BPARR(52.1,BFILL,1,"I")))
"RTN","BPSNCPD1",86,0)
 S QTY=$$NCPDPQTY^PSSBPSUT(DRUGIEN,QTY)
"RTN","BPSNCPD1",87,0)
 S BPSARRY("QTY")=$P(QTY,U,1)
"RTN","BPSNCPD1",88,0)
 S BPSARRY("UNITS")=$P(QTY,U,2)
"RTN","BPSNCPD1",89,0)
 S BPSARRY("FILL DATE")=BFILLDAT
"RTN","BPSNCPD1",90,0)
 S BPSARRY("RELEASE DATE")=$P($S(BFILL=0:$G(BPARR(52,BRXIEN,31,"I")),1:$G(BPARR(52.1,BFILL,17,"I"))),".")
"RTN","BPSNCPD1",91,0)
 S BPSARRY("SC/EI OVR")=0
"RTN","BPSNCPD1",92,0)
 ;determine BPS PHARMACY
"RTN","BPSNCPD1",93,0)
 I $G(BPSITE)>0 S BPSARRY("EPHARM")=$$GETPHARM^BPSUTIL(BPSITE)
"RTN","BPSNCPD1",94,0)
 ;
"RTN","BPSNCPD1",95,0)
 ; Add user so that it is stored correctly in the IB Event Log
"RTN","BPSNCPD1",96,0)
 ;  Note: Auto-Reversals (AREV) and CMOP/OPAI (CR*/PC/RL) use postmaster (.5)
"RTN","BPSNCPD1",97,0)
 I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_BWHERE_",") S BPSARRY("USER")=.5
"RTN","BPSNCPD1",98,0)
 E  S BPSARRY("USER")=DUZ
"RTN","BPSNCPD1",99,0)
 Q
"RTN","BPSNCPD1",100,0)
 ;
"RTN","BPSNCPD1",101,0)
 ; Called by BPSNCPDP to display progress of claim
"RTN","BPSNCPD1",102,0)
STATUS(BRXIEN,BFILL,REBILL,REVONLY,BPSTART,BWHERE) ;
"RTN","BPSNCPD1",103,0)
 ; Initialization
"RTN","BPSNCPD1",104,0)
 N TRANSIEN,CERTUSER,BPSTO,END,IBSEQ,BPQ
"RTN","BPSNCPD1",105,0)
 N CLMSTAT,OCLMSTAT,RESUB,RESFL
"RTN","BPSNCPD1",106,0)
 S (CLMSTAT,OCLMSTAT)=0
"RTN","BPSNCPD1",107,0)
 ;
"RTN","BPSNCPD1",108,0)
 ; Set CERTUSER to true if this user is the certifier
"RTN","BPSNCPD1",109,0)
 S CERTUSER=^BPS(9002313.99,1,"CERTIFIER")=DUZ
"RTN","BPSNCPD1",110,0)
 ;
"RTN","BPSNCPD1",111,0)
 ; Build Transaction IEN
"RTN","BPSNCPD1",112,0)
 S TRANSIEN=BRXIEN_"."_$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD1",113,0)
 ;
"RTN","BPSNCPD1",114,0)
 ; Write Rebill and Status Messages
"RTN","BPSNCPD1",115,0)
 W !!,"Claim Status: "
"RTN","BPSNCPD1",116,0)
 I REBILL,$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 W !,"Reversing and Rebilling a previously submitted claim...",!,"Reversing..."
"RTN","BPSNCPD1",117,0)
 ;
"RTN","BPSNCPD1",118,0)
 ; Get the ECME Timeout and set the display timeout
"RTN","BPSNCPD1",119,0)
 S BPSTO=$$GET1^DIQ(9002313.99,"1,",3.01),END=$S(CERTUSER:50,$G(BPSTO)]"":BPSTO,1:5)
"RTN","BPSNCPD1",120,0)
 ;
"RTN","BPSNCPD1",121,0)
 ; For remaining time, loop through and display status
"RTN","BPSNCPD1",122,0)
 S (BPQ,RESFL)=0
"RTN","BPSNCPD1",123,0)
 F IBSEQ=1:1:END D  Q:BPQ=1
"RTN","BPSNCPD1",124,0)
 . H 1
"RTN","BPSNCPD1",125,0)
 . ;
"RTN","BPSNCPD1",126,0)
 . ; Get status of resubmit, last update, and claim status
"RTN","BPSNCPD1",127,0)
 . S CLMSTAT=$$STATUS^BPSOSRX(BRXIEN,BFILL,1)
"RTN","BPSNCPD1",128,0)
 . S RESUB=$$GET1^DIQ(9002313.59,TRANSIEN_",",1.12,"I")
"RTN","BPSNCPD1",129,0)
 . ;
"RTN","BPSNCPD1",130,0)
 . ; Format status message
"RTN","BPSNCPD1",131,0)
 . S CLMSTAT=$P(CLMSTAT,"^",1)_$S($P(CLMSTAT,"^",1)["IN PROGRESS":"-"_$P(CLMSTAT,"^",3),1:"")
"RTN","BPSNCPD1",132,0)
 . ;
"RTN","BPSNCPD1",133,0)
 . ; If we are starting the resubmit, display message
"RTN","BPSNCPD1",134,0)
 . I REBILL,RESFL=0,RESUB=1,CLMSTAT["Resubmitting" W !,"Resubmitting..." S RESFL=1 Q
"RTN","BPSNCPD1",135,0)
 . I REBILL,RESFL=0,RESUB=2,CLMSTAT["IN PROGRESS" W !,"Resubmitting..." S RESFL=1
"RTN","BPSNCPD1",136,0)
 . ;
"RTN","BPSNCPD1",137,0)
 . ; If the status has changed, display the new message
"RTN","BPSNCPD1",138,0)
 . I OCLMSTAT'=CLMSTAT W !,CLMSTAT S OCLMSTAT=CLMSTAT
"RTN","BPSNCPD1",139,0)
 . ;
"RTN","BPSNCPD1",140,0)
 . ; If the status is not IN PROGRESS, then we are done
"RTN","BPSNCPD1",141,0)
 . I CLMSTAT'["IN PROGRESS" S BPQ=1
"RTN","BPSNCPD1",142,0)
 W !
"RTN","BPSNCPD1",143,0)
 Q
"RTN","BPSNCPD1",144,0)
 ;
"RTN","BPSNCPD1",145,0)
 ; Bulletin to the OPECC
"RTN","BPSNCPD1",146,0)
BULL(RXI,RXR,SITE,DFN,PATNAME) ;
"RTN","BPSNCPD1",147,0)
 N BTXT,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","BPSNCPD1",148,0)
 N SSN,X,SITENM
"RTN","BPSNCPD1",149,0)
 I $G(SITE) D
"RTN","BPSNCPD1",150,0)
 . K ^TMP($J,"BPSARR")
"RTN","BPSNCPD1",151,0)
 . D PSS^PSO59(SITE,,"BPSARR")
"RTN","BPSNCPD1",152,0)
 . S SITENM=$G(^TMP($J,"BPSARR",SITE,.01))
"RTN","BPSNCPD1",153,0)
 I $G(DFN) D
"RTN","BPSNCPD1",154,0)
 . S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","BPSNCPD1",155,0)
 . S SSN=$E(X,$L(X)-3,$L(X))
"RTN","BPSNCPD1",156,0)
 ;
"RTN","BPSNCPD1",157,0)
 ; Need to do in the background
"RTN","BPSNCPD1",158,0)
 ;   Mailman calls CMOP which calls EN^BPSNCPDP.
"RTN","BPSNCPD1",159,0)
 ;   If BPSNCPDP* (same process) then calls mailman, it gets confused.
"RTN","BPSNCPD1",160,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC
"RTN","BPSNCPD1",161,0)
 N %,%H,%I,X
"RTN","BPSNCPD1",162,0)
 D NOW^%DTC
"RTN","BPSNCPD1",163,0)
 S ZTIO="",ZTDTH=%,ZTDESC="IN PROGRESS BULLETIN"
"RTN","BPSNCPD1",164,0)
 S ZTSAVE("RXR")="",ZTSAVE("RXI")=""
"RTN","BPSNCPD1",165,0)
 S ZTSAVE("SITENM")="",ZTSAVE("PATNAME")=""
"RTN","BPSNCPD1",166,0)
 S ZTSAVE("SSN")=""
"RTN","BPSNCPD1",167,0)
 S ZTRTN="BULL1^BPSNCPD1"
"RTN","BPSNCPD1",168,0)
 D ^%ZTLOAD
"RTN","BPSNCPD1",169,0)
 Q
"RTN","BPSNCPD1",170,0)
 ;
"RTN","BPSNCPD1",171,0)
BULL1 ;
"RTN","BPSNCPD1",172,0)
 S XMSUB="RX not processed for site "_$G(SITENM)
"RTN","BPSNCPD1",173,0)
 S BTXT(1)="Prescription "_$$RXAPI1^BPSUTIL1(RXI,.01,"E")_" and fill number "_+RXR_" could "
"RTN","BPSNCPD1",174,0)
 S BTXT(1)=BTXT(1)_"not be processed because the "
"RTN","BPSNCPD1",175,0)
 S BTXT(2)="previous request was in progress.  There may have been a delay in processing "
"RTN","BPSNCPD1",176,0)
 S BTXT(3)="of the previous claim or the previous claim may be stranded."
"RTN","BPSNCPD1",177,0)
 S BTXT(4)=""
"RTN","BPSNCPD1",178,0)
 S BTXT(5)="For more information on this prescription's activity, please view the "
"RTN","BPSNCPD1",179,0)
 S BTXT(6)="ECME log within the View Prescription (VP) option on the Further Research (FR) "
"RTN","BPSNCPD1",180,0)
 S BTXT(7)="menu of the ECME user screen."
"RTN","BPSNCPD1",181,0)
 S BTXT(8)=""
"RTN","BPSNCPD1",182,0)
 S BTXT(9)="Patient Name: "_$G(PATNAME)
"RTN","BPSNCPD1",183,0)
 S BTXT(10)="Last four digits of SSN: "_$G(SSN)
"RTN","BPSNCPD1",184,0)
 S BTXT(11)=""
"RTN","BPSNCPD1",185,0)
 ;
"RTN","BPSNCPD1",186,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTXT("
"RTN","BPSNCPD1",187,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSNCPD1",188,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSNCPD1",189,0)
 D ^XMD
"RTN","BPSNCPD1",190,0)
 Q
"RTN","BPSNCPD2")
0^16^B37248829
"RTN","BPSNCPD2",1,0)
BPSNCPD2 ;BHAM ISC/LJE - Continuation of BPSNCPDP (IB Billing Determiation) ;08/01/03
"RTN","BPSNCPD2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSNCPD2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD2",4,0)
 ;External reference $$RX^IBNCPDP supported by DBIA 4299
"RTN","BPSNCPD2",5,0)
 ;
"RTN","BPSNCPD2",6,0)
 ;
"RTN","BPSNCPD2",7,0)
 ; EN - Call IB Billing Determination.  If good to go, update MOREDATA array
"RTN","BPSNCPD2",8,0)
 ; Notes about variables
"RTN","BPSNCPD2",9,0)
 ;input:
"RTN","BPSNCPD2",10,0)
 ;   DFN - PATIENT file #2 ien
"RTN","BPSNCPD2",11,0)
 ;   BWHERE - shows where the code is called from and what needs to be done
"RTN","BPSNCPD2",12,0)
 ;   the following should be passed by reference:
"RTN","BPSNCPD2",13,0)
 ;   MOREDATA - Initialized by BPSNCPDP and more data is added here
"RTN","BPSNCPD2",14,0)
 ;   BPSARRY  - Created by STARRAY^BPSNCPD1 and used for IB Determination
"RTN","BPSNCPD2",15,0)
 ;   IB    - Returned to BPSNCPDP
"RTN","BPSNCPD2",16,0)
 ;   CERTIEN - BPS Certification IEN - Not passed but newed/set in BPSNCPDP
"RTN","BPSNCPD2",17,0)
 ;
"RTN","BPSNCPD2",18,0)
EN(DFN,BWHERE,MOREDATA,BPSARRY,IB) ;
"RTN","BPSNCPD2",19,0)
 I '$G(CERTIEN) D  I IB=2 Q
"RTN","BPSNCPD2",20,0)
 . ;
"RTN","BPSNCPD2",21,0)
 . ;For NCPDP IB call to see if we need to 3rd Party Bill and if so, get insurance/payer sheet info
"RTN","BPSNCPD2",22,0)
 . S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.BPSARRY)  ;IB CALL
"RTN","BPSNCPD2",23,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",24,0)
 . ;
"RTN","BPSNCPD2",25,0)
 . ; If calling program is the ECME user screen and we can't bill because of NEEDS SC DETERMINATION
"RTN","BPSNCPD2",26,0)
 . ; or EI, then prompt the user to see if they want to bill
"RTN","BPSNCPD2",27,0)
 . I BWHERE="ERES",$P(MOREDATA("BILL"),U,1)=0,$G(BPSARRY("SC/EI NO ANSW"))]"" D
"RTN","BPSNCPD2",28,0)
 .. N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,I,BPEISC
"RTN","BPSNCPD2",29,0)
 .. F I=1:1:$L($G(BPSARRY("SC/EI NO ANSW")),",") S BPEISC=$P($G(BPSARRY("SC/EI NO ANSW")),",",I) I BPEISC]"" D
"RTN","BPSNCPD2",30,0)
 ... W !,"The prescription is potentially ",BPEISC,"-related and needs ",BPEISC," determination."
"RTN","BPSNCPD2",31,0)
 ... W !,"Prescriptions related to ",BPEISC," cannot be billed to Third Party Insurance.",!
"RTN","BPSNCPD2",32,0)
 .. S DIR(0)="Y",DIR("A")="Are you sure you want to bill this prescription"
"RTN","BPSNCPD2",33,0)
 .. S DIR("B")="NO"
"RTN","BPSNCPD2",34,0)
 .. S DIR("?")="If you want to bill this prescription, enter 'Yes' - otherwise, enter 'No'"
"RTN","BPSNCPD2",35,0)
 .. W ! D ^DIR K DIR
"RTN","BPSNCPD2",36,0)
 .. I '+Y Q
"RTN","BPSNCPD2",37,0)
 .. S BPSARRY("SC/EI OVR")=1
"RTN","BPSNCPD2",38,0)
 .. S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.BPSARRY)  ;Call IB again
"RTN","BPSNCPD2",39,0)
 . ;
"RTN","BPSNCPD2",40,0)
 . ; Quit if no response from IB call
"RTN","BPSNCPD2",41,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",42,0)
 . I $P(MOREDATA("BILL"),U,1)=0 S IB=2 Q  ;IB says not to bill
"RTN","BPSNCPD2",43,0)
 . S IB=1
"RTN","BPSNCPD2",44,0)
 . M MOREDATA("IBDATA")=BPSARRY("INS")
"RTN","BPSNCPD2",45,0)
 . S $P(MOREDATA("BPSDATA",1),U,1)=BPSARRY("QTY")
"RTN","BPSNCPD2",46,0)
 . S $P(MOREDATA("BPSDATA",1),U,2)=BPSARRY("COST")
"RTN","BPSNCPD2",47,0)
 . S $P(MOREDATA("BPSDATA",1),U,3)=BPSARRY("NDC")
"RTN","BPSNCPD2",48,0)
 . S $P(MOREDATA("BPSDATA",1),U,4)=BFILL
"RTN","BPSNCPD2",49,0)
 . S $P(MOREDATA("BPSDATA",1),U,5)=""  ; Certify Mode
"RTN","BPSNCPD2",50,0)
 . S $P(MOREDATA("BPSDATA",1),U,6)=""  ; Cert IEN
"RTN","BPSNCPD2",51,0)
 . S $P(MOREDATA("BPSDATA",1),U,7)=BPSARRY("UNITS")
"RTN","BPSNCPD2",52,0)
 ;
"RTN","BPSNCPD2",53,0)
 ; If certification mode on and no IB result (somewhat redundant since IB is not called
"RTN","BPSNCPD2",54,0)
 ;   for certification), get data from BPS Certification table
"RTN","BPSNCPD2",55,0)
 I $G(CERTIEN),'$G(IB) D
"RTN","BPSNCPD2",56,0)
 . N NODE,FLD,NFLD,CERTARY
"RTN","BPSNCPD2",57,0)
 . S MOREDATA("BILL")=1
"RTN","BPSNCPD2",58,0)
 . S MOREDATA("IBDATA",1,1)="",MOREDATA("IBDATA",1,2)="",MOREDATA("BPSDATA",1)=""
"RTN","BPSNCPD2",59,0)
 . S $P(MOREDATA("BPSDATA",1),U,5)=1  ;Certify Mode
"RTN","BPSNCPD2",60,0)
 . S $P(MOREDATA("BPSDATA",1),U,6)=CERTIEN  ;Cert IEN
"RTN","BPSNCPD2",61,0)
 . S $P(MOREDATA("IBDATA",1,1),U,1)=1  ;Plan IEN
"RTN","BPSNCPD2",62,0)
 . S $P(MOREDATA("IBDATA",1,1),U,4)=$$GET1^DIQ(9002313.31,CERTIEN,.04,"E")  ;Payer Sheet
"RTN","BPSNCPD2",63,0)
 . S $P(MOREDATA("IBDATA",1,1),U,10)="01"  ;Home State Plan
"RTN","BPSNCPD2",64,0)
 . S $P(MOREDATA("IBDATA",1,1),U,11)=""  ;B2 Payer Sheet (reversal)
"RTN","BPSNCPD2",65,0)
 . S $P(MOREDATA("IBDATA",1,1),U,12)=""  ;B3 Payer Sheet (rebill)
"RTN","BPSNCPD2",66,0)
 . S $P(MOREDATA("IBDATA",1,1),U,14)=""  ;Plan Name
"RTN","BPSNCPD2",67,0)
 . S $P(MOREDATA("IBDATA",1,2),U,5)=0    ;Admin Fee
"RTN","BPSNCPD2",68,0)
 . ;
"RTN","BPSNCPD2",69,0)
 . ;Get data from non-mulitple fields and add to MOREDATA
"RTN","BPSNCPD2",70,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","1*","","CERTARY")
"RTN","BPSNCPD2",71,0)
 . S NODE="" F  S NODE=$O(CERTARY(9002313.311,NODE)) Q:NODE=""  D
"RTN","BPSNCPD2",72,0)
 .. S FLD="" F  S FLD=$O(CERTARY(9002313.311,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",73,0)
 ... I FLD=.01 S NFLD=CERTARY(9002313.311,NODE,FLD) D
"RTN","BPSNCPD2",74,0)
 .... I NFLD=101 S $P(MOREDATA("IBDATA",1,1),U,2)=CERTARY(9002313.311,NODE,.02) ;BIN
"RTN","BPSNCPD2",75,0)
 .... I NFLD=104 S $P(MOREDATA("IBDATA",1,1),U,3)=CERTARY(9002313.311,NODE,.02)  ;PCN
"RTN","BPSNCPD2",76,0)
 .... I NFLD=110 S $P(MOREDATA("IBDATA",1,1),U,13)=CERTARY(9002313.311,NODE,.02)  ;Certification ID
"RTN","BPSNCPD2",77,0)
 . ;
"RTN","BPSNCPD2",78,0)
 . ;Get data from mulitple fields and add to MOREDATA
"RTN","BPSNCPD2",79,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","2*","","CERTARY")
"RTN","BPSNCPD2",80,0)
 . S NODE="" F  S NODE=$O(CERTARY(9002313.3121,NODE)) Q:NODE=""  D
"RTN","BPSNCPD2",81,0)
 ..  S FLD="" F  S FLD=$O(CERTARY(9002313.3121,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",82,0)
 ... I FLD=.01 S NFLD=CERTARY(9002313.3121,NODE,FLD) D
"RTN","BPSNCPD2",83,0)
 .... I NFLD=301 S $P(MOREDATA("IBDATA",1,1),U,5)=CERTARY(9002313.3121,NODE,.02)  ;Group ID
"RTN","BPSNCPD2",84,0)
 .... I NFLD=302 S $P(MOREDATA("IBDATA",1,1),U,6)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder ID
"RTN","BPSNCPD2",85,0)
 .... I NFLD=306 S $P(MOREDATA("IBDATA",1,1),U,7)=CERTARY(9002313.3121,NODE,.02)  ;Patient Rel Code
"RTN","BPSNCPD2",86,0)
 .... I NFLD=312 S $P(MOREDATA("IBDATA",1,1),U,8)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder First Name
"RTN","BPSNCPD2",87,0)
 .... I NFLD=313 S $P(MOREDATA("IBDATA",1,1),U,9)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder Last Name
"RTN","BPSNCPD2",88,0)
 .... I NFLD=412 S $P(MOREDATA("IBDATA",1,2),U,1)=CERTARY(9002313.3121,NODE,.02)  ;Dispensing Fee
"RTN","BPSNCPD2",89,0)
 .... I NFLD=423 S $P(MOREDATA("IBDATA",1,2),U,2)=CERTARY(9002313.3121,NODE,.02)  ;Basis of Cost Determination
"RTN","BPSNCPD2",90,0)
 .... I NFLD=426 S $P(MOREDATA("IBDATA",1,2),U,3)=CERTARY(9002313.3121,NODE,.02)  ;Usual & Customary - Base Price
"RTN","BPSNCPD2",91,0)
 .... I NFLD=430 S $P(MOREDATA("IBDATA",1,2),U,4)=CERTARY(9002313.3121,NODE,.02)  ;Gross Amt Due
"RTN","BPSNCPD2",92,0)
 .... I NFLD=442 S $P(MOREDATA("BPSDATA",1),U,1)=CERTARY(9002313.3121,NODE,.02)  ;Qty
"RTN","BPSNCPD2",93,0)
 .... I NFLD=409 S $P(MOREDATA("BPSDATA",1),U,2)=CERTARY(9002313.3121,NODE,.02)  ;Unit Cost
"RTN","BPSNCPD2",94,0)
 .... I NFLD=407 S $P(MOREDATA("BPSDATA",1),U,3)=CERTARY(9002313.3121,NODE,.02)  ;NDC
"RTN","BPSNCPD2",95,0)
 .... I NFLD=403 S $P(MOREDATA("BPSDATA",1),U,4)=CERTARY(9002313.3121,NODE,.02)  ;Fill #
"RTN","BPSNCPD2",96,0)
 .... I NFLD=600 S $P(MOREDATA("BPSDATA",1),U,7)=CERTARY(9002313.3121,NODE,.02)  ;Unit of Measure
"RTN","BPSNCPD2",97,0)
 . ;
"RTN","BPSNCPD2",98,0)
 . ; If Gross Amt Due is missing, use Usual and Customary
"RTN","BPSNCPD2",99,0)
 . I $P(MOREDATA("IBDATA",1,2),U,4)="" S $P(MOREDATA("IBDATA",1,2),U,4)=$P(MOREDATA("IBDATA",1,2),U,3)
"RTN","BPSNCPD2",100,0)
 ;
"RTN","BPSNCPD2",101,0)
 ; The code below checks if Sequence one is missing and move the next number down if needed.
"RTN","BPSNCPD2",102,0)
 ; DMB - This is existing code so I am not sure if it is needed or not.
"RTN","BPSNCPD2",103,0)
 I '$D(MOREDATA("IBDATA",1)) D
"RTN","BPSNCPD2",104,0)
 . N WW
"RTN","BPSNCPD2",105,0)
 . S WW=$O(MOREDATA("IBDATA",""))
"RTN","BPSNCPD2",106,0)
 . I WW'="" M MOREDATA("IBDATA",1)=MOREDATA("IBDATA",WW) K MOREDATA("IBDATA",WW)
"RTN","BPSNCPD2",107,0)
 ;
"RTN","BPSNCPD2",108,0)
 ; Uppercase the IBDATA
"RTN","BPSNCPD2",109,0)
 ; DMB - Assume this was adding in case any of the BPS Certification data was entered as lowercase
"RTN","BPSNCPD2",110,0)
 S MOREDATA("IBDATA",1,1)=$TR(MOREDATA("IBDATA",1,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",111,0)
 S MOREDATA("IBDATA",1,2)=$TR(MOREDATA("IBDATA",1,2),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",112,0)
 S MOREDATA("BPSDATA",1)=$TR(MOREDATA("BPSDATA",1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",113,0)
 ;
"RTN","BPSNCPD2",114,0)
 Q
"RTN","BPSNCPD3")
0^3^B20450751
"RTN","BPSNCPD3",1,0)
BPSNCPD3 ;BHAM ISC/LJE - Continuation of BPSNCPDP - DUR HANDLING ;06/16/2004
"RTN","BPSNCPD3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSNCPD3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD3",4,0)
 ; DUR1 is called by PSO to get the reject info so that should NOT be removed
"RTN","BPSNCPD3",5,0)
 ;
"RTN","BPSNCPD3",6,0)
 ;
"RTN","BPSNCPD3",7,0)
 ;
"RTN","BPSNCPD3",8,0)
 ; Function call for DUR INFORMATION 
"RTN","BPSNCPD3",9,0)
 ; Parameters: BRXIEN = Prescription IEN
"RTN","BPSNCPD3",10,0)
 ;             BFILL = fill number
"RTN","BPSNCPD3",11,0)
 ;             DUR = DUR info passed back
"RTN","BPSNCPD3",12,0)
 ;             ERROR = error passed back
"RTN","BPSNCPD3",13,0)
 ; Note:
"RTN","BPSNCPD3",14,0)
 ;    DUR("BILLED")=0 if ecme off for pharmacy or no transaction in ECME
"RTN","BPSNCPD3",15,0)
 ;    DUR(<Insurance counter>,"BILLED")=1 if billed through ecme
"RTN","BPSNCPD3",16,0)
DUR1(BRXIEN,BFILL,DUR,ERROR) ;
"RTN","BPSNCPD3",17,0)
 N SITE,DFILL,TRANIEN,JJ,DUR1,DURIEN,I
"RTN","BPSNCPD3",18,0)
 ;
"RTN","BPSNCPD3",19,0)
 ; Get Site info and check is ECME is turned on
"RTN","BPSNCPD3",20,0)
 ; If not, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",21,0)
 I '$G(BFILL) S SITE=$$RXAPI1^BPSUTIL1(BRXIEN,20,"I")
"RTN","BPSNCPD3",22,0)
 I $G(BFILL) S SITE=$$RXSUBF1^BPSUTIL1(BRXIEN,52,52.1,BFILL,8,"I")
"RTN","BPSNCPD3",23,0)
 I '$$ECMEON^BPSUTIL(SITE) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",24,0)
 ;
"RTN","BPSNCPD3",25,0)
 ; Set up the Transaction IEN
"RTN","BPSNCPD3",26,0)
 S DFILL="",DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD3",27,0)
 S TRANIEN=BRXIEN_"."_DFILL
"RTN","BPSNCPD3",28,0)
 ;
"RTN","BPSNCPD3",29,0)
 ; If the transaction record does not exist, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",30,0)
 I '$D(^BPST(TRANIEN)) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",31,0)
 ;
"RTN","BPSNCPD3",32,0)
 ; Loop through the insurance multiple and set DUR array
"RTN","BPSNCPD3",33,0)
 S JJ=0
"RTN","BPSNCPD3",34,0)
 F  S JJ=$O(^BPST(TRANIEN,10,JJ)) Q:JJ=""!(JJ'?1N.N)  D
"RTN","BPSNCPD3",35,0)
 . ;
"RTN","BPSNCPD3",36,0)
 . ; We are good so set Billed
"RTN","BPSNCPD3",37,0)
 . S DUR(JJ,"BILLED")=1
"RTN","BPSNCPD3",38,0)
 . ;
"RTN","BPSNCPD3",39,0)
 . ; Get Insurance Info and set into DUR array
"RTN","BPSNCPD3",40,0)
 . D GETS^DIQ(9002313.59902,JJ_","_TRANIEN_",","902.05;902.06;902.24;902.25;902.26","E","DUR1","ERROR")
"RTN","BPSNCPD3",41,0)
 . S DUR(JJ,"INSURANCE NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.24,"E"))  ; Insurance Company Name
"RTN","BPSNCPD3",42,0)
 . S DUR(JJ,"GROUP NUMBER")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.05,"E"))    ; Insurance Group Number
"RTN","BPSNCPD3",43,0)
 . S DUR(JJ,"GROUP NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.25,"E"))      ; Insurance Group Name
"RTN","BPSNCPD3",44,0)
 . S DUR(JJ,"PLAN CONTACT")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.26,"E"))    ; Insurance Contact Number
"RTN","BPSNCPD3",45,0)
 . S DUR(JJ,"CARDHOLDER ID")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.06,"E"))   ; Cardholder ID
"RTN","BPSNCPD3",46,0)
 . ;
"RTN","BPSNCPD3",47,0)
 . ; Get Response IEN and Data
"RTN","BPSNCPD3",48,0)
 . S DURIEN="",DURIEN=$P(^BPST(TRANIEN,0),"^",5)                             ;Note: in future will need to store/get DURIEN for each insurance
"RTN","BPSNCPD3",49,0)
 . S DUR(JJ,"RESPONSE IEN")=DURIEN
"RTN","BPSNCPD3",50,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","501;567.01*;526","E","DUR1","ERROR")
"RTN","BPSNCPD3",51,0)
 . S DUR(JJ,"PAYER MESSAGE")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",526,"E"))           ;Additional free text message info from payer
"RTN","BPSNCPD3",52,0)
 . S DUR(JJ,"STATUS")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",501,"E"))                  ;Status of Response
"RTN","BPSNCPD3",53,0)
 . S DUR(JJ,"REASON")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",439,"E"))                ;Reason of Service Code
"RTN","BPSNCPD3",54,0)
 . S DUR(JJ,"CLIN SIGNIFICANCE")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",528,"E"))     ;Clinical Significance Code
"RTN","BPSNCPD3",55,0)
 . S DUR(JJ,"OTH PHARM IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",529,"E"))         ;Other Pharmacy Indicator Code
"RTN","BPSNCPD3",56,0)
 . S DUR(JJ,"PREV FILL DATE")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",530,"E"))        ;Previous Date of Fill
"RTN","BPSNCPD3",57,0)
 . S DUR(JJ,"QTY OF PREV FILL")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",531,"E"))      ;Quantity of Previous Fill
"RTN","BPSNCPD3",58,0)
 . S DUR(JJ,"DATABASE IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",532,"E"))          ;Database Indicator
"RTN","BPSNCPD3",59,0)
 . S DUR(JJ,"OTH PRESCRIBER IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",533,"E"))    ;Other Prescriber Indicator
"RTN","BPSNCPD3",60,0)
 . S DUR(JJ,"DUR FREE TEXT DESC")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",544,"E"))    ;DUR Free Text Message from Payer
"RTN","BPSNCPD3",61,0)
 . ;
"RTN","BPSNCPD3",62,0)
 . ; Get DUR reject codes and description and store in DUR 
"RTN","BPSNCPD3",63,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","511*","I","DUR1","ERROR")                 ;get DUR codes and descriptions
"RTN","BPSNCPD3",64,0)
 . S DUR(JJ,"REJ CODE LST")=""
"RTN","BPSNCPD3",65,0)
 . F I=1:1 Q:'$D(DUR1(9002313.03511,I_",1,"_DURIEN_","))  D
"RTN","BPSNCPD3",66,0)
 .. S DUR(JJ,"REJ CODES",I,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"))=$$GET1^DIQ(9002313.93,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"),".02")
"RTN","BPSNCPD3",67,0)
 .. S DUR(JJ,"REJ CODE LST")=DUR(JJ,"REJ CODE LST")_","_DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I")
"RTN","BPSNCPD3",68,0)
 . S DUR(JJ,"REJ CODE LST")=$E(DUR(JJ,"REJ CODE LST"),2,9999)
"RTN","BPSNCPD3",69,0)
 Q
"RTN","BPSNCPDP")
0^15^B73597678
"RTN","BPSNCPDP",1,0)
BPSNCPDP ;BHAM ISC/LJE - API to submit a claim to ECME ;8/01/03
"RTN","BPSNCPDP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,4,2,5**;JUN 2004;Build 45
"RTN","BPSNCPDP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPDP",4,0)
 ;
"RTN","BPSNCPDP",5,0)
 ; For comments regarding this API, see routine BPSNCPD1.
"RTN","BPSNCPDP",6,0)
 ;   They were moved to BPSNCPD1 due to size constraints
"RTN","BPSNCPDP",7,0)
 ;
"RTN","BPSNCPDP",8,0)
EN(BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH) ;
"RTN","BPSNCPDP",9,0)
EN1 N DFN,PNAME,BRX,BPSARRY,MOREDATA,SITE,WFLG,OLDRESP,IEN59
"RTN","BPSNCPDP",10,0)
 N %,%I,%H,X,TODAY
"RTN","BPSNCPDP",11,0)
 N QUIT,CERTIEN
"RTN","BPSNCPDP",12,0)
 N REBILL,REVONLY,CLMSTAT,RESPONSE,BPSTART,IB,RESP
"RTN","BPSNCPDP",13,0)
 ;
"RTN","BPSNCPDP",14,0)
 ; Default variables
"RTN","BPSNCPDP",15,0)
 S RESPONSE="",CLMSTAT=""
"RTN","BPSNCPDP",16,0)
 ;
"RTN","BPSNCPDP",17,0)
 ; Check for valid RX and fill
"RTN","BPSNCPDP",18,0)
 I '$G(BRXIEN) S CLMSTAT="Prescription IEN parameter missing",RESPONSE=5 G END
"RTN","BPSNCPDP",19,0)
 I '$G(BFILL) S BFILL=0
"RTN","BPSNCPDP",20,0)
 ;
"RTN","BPSNCPDP",21,0)
 ; Setup IEN59, and initialize log
"RTN","BPSNCPDP",22,0)
 S IEN59=$$IEN59^BPSOSRX(BRXIEN,BFILL)
"RTN","BPSNCPDP",23,0)
 I IEN59="" S CLMSTAT="BPS Transaction IEN could not be calculated",RESPONSE=1 G END
"RTN","BPSNCPDP",24,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Start of claim","DT")
"RTN","BPSNCPDP",25,0)
 ;
"RTN","BPSNCPDP",26,0)
 ; Check for BWHERE parameter
"RTN","BPSNCPDP",27,0)
 I $G(BWHERE)="" S CLMSTAT="RX Action parameter missing",RESPONSE=5 G END
"RTN","BPSNCPDP",28,0)
 ;
"RTN","BPSNCPDP",29,0)
 ; Get prescription number
"RTN","BPSNCPDP",30,0)
 S BRX=$$RXAPI1^BPSUTIL1(BRXIEN,.01,"I")
"RTN","BPSNCPDP",31,0)
 ;
"RTN","BPSNCPDP",32,0)
 ; Check that the prescription exists
"RTN","BPSNCPDP",33,0)
 I BRX="" S CLMSTAT="Prescription does not exist",RESPONSE=5 G END
"RTN","BPSNCPDP",34,0)
 ;
"RTN","BPSNCPDP",35,0)
 ; Get the NDC if it was not passed in
"RTN","BPSNCPDP",36,0)
 I $G(BILLNDC)="" S BILLNDC=$$GETNDC^PSONDCUT(BRXIEN,BFILL)
"RTN","BPSNCPDP",37,0)
 ;
"RTN","BPSNCPDP",38,0)
 ; Patient Info
"RTN","BPSNCPDP",39,0)
 S DFN=$$RXAPI1^BPSUTIL1(BRXIEN,2,"I"),PNAME=$$GET1^DIQ(2,DFN,.01)
"RTN","BPSNCPDP",40,0)
 ;
"RTN","BPSNCPDP",41,0)
 ; Set write flag
"RTN","BPSNCPDP",42,0)
 S WFLG=1
"RTN","BPSNCPDP",43,0)
 I ",ARES,AREV,CRLB,CRLR,CRLX,DDED,DE,EREV,HLD,PC,PE,PL,RS,"[(","_BWHERE_",") S WFLG=0
"RTN","BPSNCPDP",44,0)
 ;
"RTN","BPSNCPDP",45,0)
 ; Get status of previously submitted claim and set rebill/revonly flags
"RTN","BPSNCPDP",46,0)
 S (REBILL,REVONLY)=0
"RTN","BPSNCPDP",47,0)
 S OLDRESP=$P($$STATUS^BPSOSRX(BRXIEN,BFILL,1),U,1)
"RTN","BPSNCPDP",48,0)
 I ",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",") S REVONLY=1
"RTN","BPSNCPDP",49,0)
 E  I OLDRESP="E PAYABLE"!(OLDRESP="E DUPLICATE") S REBILL=1
"RTN","BPSNCPDP",50,0)
 ;
"RTN","BPSNCPDP",51,0)
 ; Get Site info and check if the site has ECME turned on.  Note that
"RTN","BPSNCPDP",52,0)
 ;   ECMEON will also return false if there is no NPI after the drop
"RTN","BPSNCPDP",53,0)
 ;   dead date.  Do not do this check for reversals/rebill as these
"RTN","BPSNCPDP",54,0)
 ;   need to be processed for the old site
"RTN","BPSNCPDP",55,0)
 I 'BFILL S SITE=$$RXAPI1^BPSUTIL1(BRXIEN,20,"I")
"RTN","BPSNCPDP",56,0)
 I BFILL S SITE=$$RXSUBF1^BPSUTIL1(BRXIEN,52,52.1,+BFILL,8,"I")
"RTN","BPSNCPDP",57,0)
 I 'REVONLY,'REBILL D  I RESPONSE=1 G END
"RTN","BPSNCPDP",58,0)
 . I '$G(SITE) S CLMSTAT="No Site Information",RESPONSE=1 Q
"RTN","BPSNCPDP",59,0)
 . I '$$ECMEON^BPSUTIL(SITE) S CLMSTAT="ECME switch is not on for the site",RESPONSE=1
"RTN","BPSNCPDP",60,0)
 ;
"RTN","BPSNCPDP",61,0)
 ; In Progress/Stranded claims check
"RTN","BPSNCPDP",62,0)
 I OLDRESP["IN PROGRESS" D  G END
"RTN","BPSNCPDP",63,0)
 . S CLMSTAT="Previous request is IN PROGRESS.  It may need to be unstranded.",RESPONSE=4
"RTN","BPSNCPDP",64,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",65,0)
 . ; If not OP, then send an email to the OPECC
"RTN","BPSNCPDP",66,0)
 . I ",AREV,BB,ERES,EREV,"'[(","_BWHERE_",") D BULL^BPSNCPD1(BRXIEN,BFILL,$G(SITE),$G(DFN),$G(PNAME))
"RTN","BPSNCPDP",67,0)
 ;
"RTN","BPSNCPDP",68,0)
 ; Backbilling check
"RTN","BPSNCPDP",69,0)
 I BWHERE="BB",OLDRESP'="" D  G END
"RTN","BPSNCPDP",70,0)
 . S CLMSTAT="Previously billed through ECME: "_OLDRESP,RESPONSE=1
"RTN","BPSNCPDP",71,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",72,0)
 ;
"RTN","BPSNCPDP",73,0)
 ; Do not reverse if the prescription was not previously billed through ECME
"RTN","BPSNCPDP",74,0)
 I OLDRESP="",(",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",75,0)
 . S CLMSTAT="Prescription not previously billed through ECME.  Cannot Reverse claim.",RESPONSE=1
"RTN","BPSNCPDP",76,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",77,0)
 ;
"RTN","BPSNCPDP",78,0)
 ; If returning to stock or deleting and the previous claim was not paid, then no reversal is needed
"RTN","BPSNCPDP",79,0)
 ;   so close the prescription and quit
"RTN","BPSNCPDP",80,0)
 I OLDRESP'["E PAYABLE",OLDRESP'["E REVERSAL REJECTED",(",RS,DE,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",81,0)
 . D CLOSE2^BPSBUTL(BRXIEN,BFILL,BWHERE)
"RTN","BPSNCPDP",82,0)
 . S CLMSTAT="Claim was not payable so it has been closed.  No ECME claim created.",RESPONSE=3
"RTN","BPSNCPDP",83,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",84,0)
 ;
"RTN","BPSNCPDP",85,0)
 ; Do not reverse if the claim is not E PAYABLE
"RTN","BPSNCPDP",86,0)
 I OLDRESP'["E PAYABLE",OLDRESP'["E DUPLICATE",(",AREV,CRLR,CRLX,DC,DDED,HLD,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",87,0)
 . S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed.",RESPONSE=1
"RTN","BPSNCPDP",88,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",89,0)
 ;
"RTN","BPSNCPDP",90,0)
 ; EREV can be re-reversed if the previous submission is Payable or Rejected Revesal
"RTN","BPSNCPDP",91,0)
 I BWHERE="EREV",",E PAYABLE,E DUPLICATE,E REVERSAL REJECTED,E REVERSAL STRANDED,"'[(","_OLDRESP_",") D  G END
"RTN","BPSNCPDP",92,0)
 . S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed.",RESPONSE=1
"RTN","BPSNCPDP",93,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",94,0)
 ;
"RTN","BPSNCPDP",95,0)
 ; Make sure fill date is not in the future or empty
"RTN","BPSNCPDP",96,0)
 D NOW^%DTC
"RTN","BPSNCPDP",97,0)
 S TODAY=$P(%,".",1)
"RTN","BPSNCPDP",98,0)
 I '$G(BFILLDAT)!($G(BFILLDAT)>TODAY) S BFILLDAT=TODAY
"RTN","BPSNCPDP",99,0)
 ;
"RTN","BPSNCPDP",100,0)
 ; Store needed parameters into MOREDATA
"RTN","BPSNCPDP",101,0)
 ; In instances where duz is null set it equal to .5 (postmaster)
"RTN","BPSNCPDP",102,0)
 S MOREDATA("USER")=$S('DUZ:.5,1:DUZ)
"RTN","BPSNCPDP",103,0)
 S MOREDATA("RX ACTION")=$G(BWHERE)
"RTN","BPSNCPDP",104,0)
 S MOREDATA("DATE OF SERVICE")=$P($G(BFILLDAT),".",1)
"RTN","BPSNCPDP",105,0)
 S MOREDATA("REVERSAL REASON")=$S($G(REVREAS)="":"UNKNOWN",1:$E($G(REVREAS),1,40))
"RTN","BPSNCPDP",106,0)
 I $G(DURREC)]"" S MOREDATA("DUR",1,0)=DURREC
"RTN","BPSNCPDP",107,0)
 I $G(BPOVRIEN)]"" S MOREDATA("BPOVRIEN")=BPOVRIEN
"RTN","BPSNCPDP",108,0)
 I $G(BPSCLARF)]"" S MOREDATA("BPSCLARF")=BPSCLARF
"RTN","BPSNCPDP",109,0)
 I $TR($G(BPSAUTH),"^")]"" S MOREDATA("BPSAUTH")=BPSAUTH
"RTN","BPSNCPDP",110,0)
 ;
"RTN","BPSNCPDP",111,0)
 ; Do a reversal for the appropriate actions
"RTN","BPSNCPDP",112,0)
 I ",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",") D  G STATUS:RESPONSE=0,END:RESPONSE=4
"RTN","BPSNCPDP",113,0)
 . ; If override flag is set, prompt for override values - MUST be commented out for any release.
"RTN","BPSNCPDP",114,0)
 . ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D GETOVER^ZZGIZOV1(BRXIEN,BFILL,OLDRESP,BWHERE,"R")
"RTN","BPSNCPDP",115,0)
 . ;
"RTN","BPSNCPDP",116,0)
 . ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPDP",117,0)
 . D LOG(IEN59,"Before Submit of Reversal")
"RTN","BPSNCPDP",118,0)
 . S BPSTART=$$STTM()
"RTN","BPSNCPDP",119,0)
 . S RESP=$$UNCLAIM^BPSOSRX(BRXIEN,BFILL,.MOREDATA)
"RTN","BPSNCPDP",120,0)
 . D LOG(IEN59,"After Submit of Reversal. Return Value: "_RESP)
"RTN","BPSNCPDP",121,0)
 . I RESP=1 D
"RTN","BPSNCPDP",122,0)
 .. S RESPONSE=0,CLMSTAT="Reversing prescription "_BRX_"."
"RTN","BPSNCPDP",123,0)
 .. I WFLG W !,CLMSTAT H 2
"RTN","BPSNCPDP",124,0)
 . I RESP=0 D
"RTN","BPSNCPDP",125,0)
 .. S RESPONSE=4,CLMSTAT="No claim submission made.  Unable to queue reversal."
"RTN","BPSNCPDP",126,0)
 .. D LOG(IEN59,CLMSTAT)
"RTN","BPSNCPDP",127,0)
 .. I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",128,0)
 .. L -^BPST
"RTN","BPSNCPDP",129,0)
 ;
"RTN","BPSNCPDP",130,0)
 ; Can not resubmit reversed claims unless they are accepted
"RTN","BPSNCPDP",131,0)
 I OLDRESP]"",OLDRESP["E REVERSAL",OLDRESP'="E REVERSAL ACCEPTED" D  G END
"RTN","BPSNCPDP",132,0)
 . S CLMSTAT="Can not resubmit a rejected or stranded reversal",RESPONSE=1
"RTN","BPSNCPDP",133,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",134,0)
 ;
"RTN","BPSNCPDP",135,0)
 ; Some actions require a paid claim (they will not do a reversal/resubmit)
"RTN","BPSNCPDP",136,0)
 I OLDRESP]"",OLDRESP'="E REVERSAL ACCEPTED",OLDRESP'="E REJECTED",(",CRLB,ED,ERES,RL,RRL,"'[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",137,0)
 . S CLMSTAT="Previously billed through ECME: "_OLDRESP,RESPONSE=1
"RTN","BPSNCPDP",138,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",139,0)
 ;
"RTN","BPSNCPDP",140,0)
 ; Certification Testing
"RTN","BPSNCPDP",141,0)
 S QUIT=0,CERTIEN=""
"RTN","BPSNCPDP",142,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ D  I QUIT S CLMSTAT="User exited from certification questions",RESPONSE=1 G END
"RTN","BPSNCPDP",143,0)
C1 . R !,"ENTER NDC: ",BILLNDC:120 S:BILLNDC="^" QUIT=1 Q:QUIT  I BILLNDC="" G C1
"RTN","BPSNCPDP",144,0)
C3 . R !,"CERTIFICATION ENTRY: ",CERTIEN:120 I '$D(^BPS(9002313.31,CERTIEN)) S:CERTIEN="^" QUIT=1 Q:QUIT  W !,"INVALID IEN" G C3
"RTN","BPSNCPDP",145,0)
 I WFLG W !!
"RTN","BPSNCPDP",146,0)
 ;
"RTN","BPSNCPDP",147,0)
 ; Build array BPSARRY with prescription data
"RTN","BPSNCPDP",148,0)
 D STARRAY^BPSNCPD1(BRXIEN,BFILL,BWHERE,.BPSARRY,$G(SITE))
"RTN","BPSNCPDP",149,0)
 ;
"RTN","BPSNCPDP",150,0)
 ; Do IB billing determination and check response
"RTN","BPSNCPDP",151,0)
 ; If IB=2, then not billable, so write messages
"RTN","BPSNCPDP",152,0)
 S IB=0
"RTN","BPSNCPDP",153,0)
 D EN^BPSNCPD2(DFN,BWHERE,.MOREDATA,.BPSARRY,.IB)
"RTN","BPSNCPDP",154,0)
 I IB=2,(OLDRESP="E PAYABLE")!(OLDRESP="E DUPLICATE"),(",CRLB,ED,ERES,RL,RRL,"[(","_BWHERE_",")) D
"RTN","BPSNCPDP",155,0)
 .S MOREDATA("REVERSE THEN RESUBMIT")=2
"RTN","BPSNCPDP",156,0)
 .S CLMSTAT=$P(MOREDATA("BILL"),"^",2)
"RTN","BPSNCPDP",157,0)
 .D LOG(IEN59,CLMSTAT_" - Claim Will Be Reversed But Will Not Be Resubmitted")
"RTN","BPSNCPDP",158,0)
 .I WFLG W !,CLMSTAT_" - Claim Will Be Reversed But Will Not Be Resubmitted" H 2
"RTN","BPSNCPDP",159,0)
 I IB=2,$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 D  G END
"RTN","BPSNCPDP",160,0)
 . S RESPONSE=2
"RTN","BPSNCPDP",161,0)
 . S CLMSTAT=$P(MOREDATA("BILL"),"^",2)
"RTN","BPSNCPDP",162,0)
 . I OLDRESP]"" D LOG(IEN59,CLMSTAT)
"RTN","BPSNCPDP",163,0)
 ;
"RTN","BPSNCPDP",164,0)
 ; Check for missing data (Will IB billing determination catch this?)
"RTN","BPSNCPDP",165,0)
 I $D(MOREDATA("IBDATA",1,1)),$P(MOREDATA("IBDATA",1,1),"^",1)="",$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 D  G END
"RTN","BPSNCPDP",166,0)
 . S RESPONSE=2,CLMSTAT="Information missing from IB data."
"RTN","BPSNCPDP",167,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",168,0)
 ;
"RTN","BPSNCPDP",169,0)
 ; Check for missing/invalid payer sheets (I think IB billing determination will catch this)
"RTN","BPSNCPDP",170,0)
 I $P($G(MOREDATA("IBDATA",1,1)),"^",4)="",$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 D  G END
"RTN","BPSNCPDP",171,0)
 . S RESPONSE=2,CLMSTAT="Invalid/missing payer sheet from IB data."
"RTN","BPSNCPDP",172,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",173,0)
 ;
"RTN","BPSNCPDP",174,0)
 ; Check if IB says to bill
"RTN","BPSNCPDP",175,0)
 I '$G(MOREDATA("BILL")),$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 D  G END
"RTN","BPSNCPDP",176,0)
 . S RESPONSE=2
"RTN","BPSNCPDP",177,0)
 . S CLMSTAT="Flagged by IB to not 3rd Party Insurance bill through ECME."
"RTN","BPSNCPDP",178,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",179,0)
 ;
"RTN","BPSNCPDP",180,0)
 ; Log message to ECME log
"RTN","BPSNCPDP",181,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPDP",182,0)
 D LOG(IEN59,"Before submit of claim")
"RTN","BPSNCPDP",183,0)
 ;
"RTN","BPSNCPDP",184,0)
 ; If override flag is set, prompt for override values - MUST be commented out for any release.
"RTN","BPSNCPDP",185,0)
 ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D GETOVER^ZZGIZOV1(BRXIEN,BFILL,OLDRESP,BWHERE,"S")
"RTN","BPSNCPDP",186,0)
 ;
"RTN","BPSNCPDP",187,0)
 ; Get require data
"RTN","BPSNCPDP",188,0)
 S BPSTART=$$STTM()
"RTN","BPSNCPDP",189,0)
 ;
"RTN","BPSNCPDP",190,0)
 ; Submit claim and check result
"RTN","BPSNCPDP",191,0)
 S RESP=$$CLAIM^BPSOSRX(BRXIEN,BFILL,.MOREDATA)
"RTN","BPSNCPDP",192,0)
 D LOG(IEN59,"After Submit of Claim.  Return Value: "_RESP)
"RTN","BPSNCPDP",193,0)
 I RESP=1 D
"RTN","BPSNCPDP",194,0)
 . S RESPONSE=0
"RTN","BPSNCPDP",195,0)
 . I $G(MOREDATA("REVERSE THEN RESUBMIT"))=2 S CLMSTAT="Prescription "_BRX_" successfully submitted to ECME for claim reversal."
"RTN","BPSNCPDP",196,0)
 . E  S CLMSTAT="Prescription "_BRX_" successfully submitted to ECME for claim generation."
"RTN","BPSNCPDP",197,0)
 . I WFLG W !!,CLMSTAT
"RTN","BPSNCPDP",198,0)
 I RESP=0 D  G END
"RTN","BPSNCPDP",199,0)
 . S RESPONSE=4
"RTN","BPSNCPDP",200,0)
 . S CLMSTAT="No claim submission made.  Unable to queue claim submission."
"RTN","BPSNCPDP",201,0)
 . I WFLG W !!,CLMSTAT,!
"RTN","BPSNCPDP",202,0)
 . D LOG(IEN59,CLMSTAT)
"RTN","BPSNCPDP",203,0)
 ;
"RTN","BPSNCPDP",204,0)
 ; Display status
"RTN","BPSNCPDP",205,0)
STATUS I 'WFLG H 1
"RTN","BPSNCPDP",206,0)
 E  D STATUS^BPSNCPD1(BRXIEN,BFILL,REBILL,REVONLY,BPSTART,BWHERE)
"RTN","BPSNCPDP",207,0)
 ;
"RTN","BPSNCPDP",208,0)
 ;Update Response for Reversal but no Resubmit
"RTN","BPSNCPDP",209,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=2 S RESPONSE=10,CLMSTAT=$P($G(MOREDATA("BILL")),U,2)
"RTN","BPSNCPDP",210,0)
 ;
"RTN","BPSNCPDP",211,0)
 ; Clean up and quit
"RTN","BPSNCPDP",212,0)
END K BRXIEN,BFILL,BFILLDAT,BWHERE,MOREDATA
"RTN","BPSNCPDP",213,0)
 S:'$D(RESPONSE) RESPONSE=1
"RTN","BPSNCPDP",214,0)
 I $G(IEN59) D
"RTN","BPSNCPDP",215,0)
 . N MSG
"RTN","BPSNCPDP",216,0)
 . S MSG="Foreground Process Complete-RESPONSE="_$G(RESPONSE)
"RTN","BPSNCPDP",217,0)
 . I $G(RESPONSE)'=0 S MSG=MSG_", CLMSTAT="_$G(CLMSTAT)
"RTN","BPSNCPDP",218,0)
 . D LOG(IEN59,MSG)
"RTN","BPSNCPDP",219,0)
 Q RESPONSE_"^"_$G(CLMSTAT)
"RTN","BPSNCPDP",220,0)
 ;
"RTN","BPSNCPDP",221,0)
LOG(IEN59,MSG) ;
"RTN","BPSNCPDP",222,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-"_MSG)
"RTN","BPSNCPDP",223,0)
 Q
"RTN","BPSNCPDP",224,0)
STTM() ;
"RTN","BPSNCPDP",225,0)
 N %,%H,%I
"RTN","BPSNCPDP",226,0)
 D NOW^%DTC
"RTN","BPSNCPDP",227,0)
 Q %
"RTN","BPSNPI")
0^204^B3073624
"RTN","BPSNPI",1,0)
BPSNPI ;BHAM ISC/DMB - NPI Utilities ;04/19/2006
"RTN","BPSNPI",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**2,5**;JUN 2004;Build 45
"RTN","BPSNPI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNPI",4,0)
 ;
"RTN","BPSNPI",5,0)
 ; Reference to $$NPI^XUSNPI supported by IA4532
"RTN","BPSNPI",6,0)
 ;
"RTN","BPSNPI",7,0)
 ; Must call at an entry point  
"RTN","BPSNPI",8,0)
 Q
"RTN","BPSNPI",9,0)
 ;
"RTN","BPSNPI",10,0)
 ; NPIREQ - Extrinsic funtion that will return a flag indicating
"RTN","BPSNPI",11,0)
 ;          if the NPI 'drop dead date' has been passed.
"RTN","BPSNPI",12,0)
 ; Input
"RTN","BPSNPI",13,0)
 ;    BPSDT - Date to check (internal Fileman format)
"RTN","BPSNPI",14,0)
 ; Output
"RTN","BPSNPI",15,0)
 ;    1 - On or after the May 23, 2008 drop dead date
"RTN","BPSNPI",16,0)
 ;    0 - Prior to the May 23, 2008 drop dead date 
"RTN","BPSNPI",17,0)
NPIREQ(BPSDT) ; Check NPI drop dead date
"RTN","BPSNPI",18,0)
 N BPSCHKDT
"RTN","BPSNPI",19,0)
 S BPSCHKDT=3080523
"RTN","BPSNPI",20,0)
 Q $S(BPSDT<BPSCHKDT:0,1:1)
"RTN","BPSNPI",21,0)
 ;
"RTN","BPSNPI",22,0)
 ; NPI - Get NPI number
"RTN","BPSNPI",23,0)
 ; Input
"RTN","BPSNPI",24,0)
 ;   TYPE - Organization_ID, Individual_ID, or Pharmacy_ID
"RTN","BPSNPI",25,0)
 ;   IEN  - For Organization, IEN from Institution file (#4)
"RTN","BPSNPI",26,0)
 ;        - For Individual, IEN from New Person file (#200)
"RTN","BPSNPI",27,0)
 ;        - For Pharmacy, IEN from Outpatient Site file (#59)
"RTN","BPSNPI",28,0)
 ; Output - NPI for valid entry
"RTN","BPSNPI",29,0)
 ;        -  -1^Error Code if unable to get NPI
"RTN","BPSNPI",30,0)
NPI(TYPE,IEN) ;
"RTN","BPSNPI",31,0)
 N NPI
"RTN","BPSNPI",32,0)
 S TYPE=$G(TYPE)
"RTN","BPSNPI",33,0)
 I TYPE'="Organization_ID",TYPE'="Individual_ID",TYPE'="Pharmacy_ID" Q "-1^Invalid Type"
"RTN","BPSNPI",34,0)
 I '$G(IEN) Q "-1^Invalid IEN"
"RTN","BPSNPI",35,0)
 I TYPE="Pharmacy_ID" D
"RTN","BPSNPI",36,0)
 . K ^TMP($J,"BPS59")
"RTN","BPSNPI",37,0)
 . D PSS^PSO59(IEN,"","BPS59")
"RTN","BPSNPI",38,0)
 . S IEN=$P($G(^TMP($J,"BPS59",IEN,101)),U,1),TYPE="Organization_ID"
"RTN","BPSNPI",39,0)
 . K ^TMP($J,"BPS59")
"RTN","BPSNPI",40,0)
 I 'IEN Q "-1^Unable to determine Institution ID"
"RTN","BPSNPI",41,0)
 S NPI=$$NPI^XUSNPI(TYPE,IEN)
"RTN","BPSNPI",42,0)
 I $P(NPI,U,1)<1 Q "-1^No NPI"
"RTN","BPSNPI",43,0)
 I $P(NPI,U,3)'="Active" Q "-1^Inactive NPI"
"RTN","BPSNPI",44,0)
 Q $P(NPI,U,1)
"RTN","BPSNPI",45,0)
 ;
"RTN","BPSNPI",46,0)
NPKEY(BPSNCP,BPSNPI,BPSAPI) ;
"RTN","BPSNPI",47,0)
 ; Determine primay key to use in MFE 4.1 for pharm registration.
"RTN","BPSNPI",48,0)
 ; Input
"RTN","BPSNPI",49,0)
 ;    BPSNCP  - ncpdp number for the pharmacy in file (#9002313.56,.02)
"RTN","BPSNPI",50,0)
 ;    BPSNPI - existing NPI for the pharmacy in file (#9002313.56,41.01)
"RTN","BPSNPI",51,0)
 ;    BPSAPI - current NPI returned from NPI^BPSNPI 
"RTN","BPSNPI",52,0)
 N BPSPKY
"RTN","BPSNPI",53,0)
 S BPSPKY=""
"RTN","BPSNPI",54,0)
 I $G(BPSNPI) S BPSPKY=BPSNPI
"RTN","BPSNPI",55,0)
 E  I $G(BPSNCP) S BPSPKY=BPSNCP
"RTN","BPSNPI",56,0)
 E  S BPSPKY=$G(BPSAPI)
"RTN","BPSNPI",57,0)
 Q BPSPKY
"RTN","BPSOS")
0^4^B2649792
"RTN","BPSOS",1,0)
BPSOS ;BHAM ISC/FCS/DRS - Table of Contents, etc ;06/01/2004
"RTN","BPSOS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS",4,0)
 ;
"RTN","BPSOS",5,0)
 Q
"RTN","BPSOS",6,0)
 ;
"RTN","BPSOS",7,0)
TOC N I,X F I=0:1 S X=$P($T(TOC1+I),";",2,9) Q:X="*"  D
"RTN","BPSOS",8,0)
 . W X,!
"RTN","BPSOS",9,0)
 Q
"RTN","BPSOS",10,0)
TOC1 ; Directory of BPSEC* and BPSOS*
"RTN","BPSOS",11,0)
 ; BPSECA* - Build formatted claim packets
"RTN","BPSOS",12,0)
 ; BPSECFM - Formatting (signed numeric overpunch, etc.)
"RTN","BPSOS",13,0)
 ; BPSECM* - Parse Response packets
"RTN","BPSOS",14,0)
 ; BPSECX* - Low-level BPS Claims routines, descendant from BPSOSQ2
"RTN","BPSOS",15,0)
 ; BPSMHDR - Menu header
"RTN","BPSOS",16,0)
 ; BPSNCP* - Callable API to initiate an ECME claim
"RTN","BPSOS",17,0)
 ; BPSOS0* - Some fetch utilities for BPS Claims and BPS Responses
"RTN","BPSOS",18,0)
 ; BPSOS2x - Statistics Screen
"RTN","BPSOS",19,0)
 ; BPSOS57 - Utilities for BPS Log of Transactions
"RTN","BPSOS",20,0)
 ; BPSOS6M - Developer Log
"RTN","BPSOS",21,0)
 ; BPSOSC2 - Certification utilities (sporadic development use only)
"RTN","BPSOS",22,0)
 ; BPSOSCx - Building BPS Claims (BPSOSQ2->QG->CA->C*)
"RTN","BPSOS",23,0)
 ; BPSOSH* - Support utilities for packet building
"RTN","BPSOS",24,0)
 ; BPSOSI* - BPS Transaction creation
"RTN","BPSOS",25,0)
 ; BPSOSK* - Winnowing old data
"RTN","BPSOS",26,0)
 ; BPSOSL* - Log file utilities
"RTN","BPSOS",27,0)
 ; BPSOSO* - Override NCPDP Data Dictionary values
"RTN","BPSOS",28,0)
 ; BPSOSQ* - Claim processing through the queues
"RTN","BPSOS",29,0)
 ; BPSOSR* - Queue Processing
"RTN","BPSOS",30,0)
 ; BPSOSS* - Setup POS
"RTN","BPSOS",31,0)
 ; BPSOSU* - Utilities
"RTN","BPSOS",32,0)
 ;*
"RTN","BPSOS",33,0)
RXDEL(RXI,RXR) ; EP - $$ is RX deleted?
"RTN","BPSOS",34,0)
 ; For refills:  if the refill multiple is gone, it's been "deleted"
"RTN","BPSOS",35,0)
 I $G(RXR),$$RXSUBF1^BPSUTIL1(RXI,52,52.1,RXR,.01,"I")="" Q 1
"RTN","BPSOS",36,0)
 ; For first fill: look at the STATUS flag
"RTN","BPSOS",37,0)
 I $$RXAPI1^BPSUTIL1(RXI,.01,"E")="" Q 1 ; shouldn't be missing but is
"RTN","BPSOS",38,0)
 N X S X=$$RXAPI1^BPSUTIL1(RXI,100,"I")
"RTN","BPSOS",39,0)
 Q X=13 ; if status is DELETED
"RTN","BPSOS",40,0)
ZWRITE(%,VARA,VARB,VARC,VARD,VARE) ;EP - from many, many places
"RTN","BPSOS",41,0)
 I %="%"!(%?1"VAR"1U) D  Q
"RTN","BPSOS",42,0)
 . D IMPOSS^BPSOSUE("P","TI","Conflict in var names",%,"ZWRITE",$T(+0))
"RTN","BPSOS",43,0)
 I '$D(@%) W %," is undefined",! Q
"RTN","BPSOS",44,0)
 I $D(@%)#10 W %,"=",@%,!
"RTN","BPSOS",45,0)
 F  S %=$Q(@%) Q:%=""  W %,"=",@%,!
"RTN","BPSOS",46,0)
 I $D(VARA) D ZWRITE(VARA)
"RTN","BPSOS",47,0)
 I $D(VARB) D ZWRITE(VARB)
"RTN","BPSOS",48,0)
 I $D(VARC) D ZWRITE(VARC)
"RTN","BPSOS",49,0)
 I $D(VARD) D ZWRITE(VARD)
"RTN","BPSOS",50,0)
 I $D(VARE) D ZWRITE(VARE)
"RTN","BPSOS",51,0)
 Q
"RTN","BPSOS03")
0^164^B8935735
"RTN","BPSOS03",1,0)
BPSOS03 ;BHAM ISC/FCS/DRS - 9002313.03 utilities ;06/01/2004
"RTN","BPSOS03",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS03",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS03",4,0)
 ;
"RTN","BPSOS03",5,0)
 Q
"RTN","BPSOS03",6,0)
 ; General utilities for retrieval from 9002313.03, Claim Response
"RTN","BPSOS03",7,0)
 ; $$INSPAID is used by BPSOSQL
"RTN","BPSOS03",8,0)
INSPAID(N) ;EP - from BPSOSQL -  total amount paid by insurer
"RTN","BPSOS03",9,0)
 N RX,TOT,X S (TOT,RX)=0
"RTN","BPSOS03",10,0)
 F  S RX=$O(^BPSR(N,1000,RX)) Q:'RX  D
"RTN","BPSOS03",11,0)
 . ; Try Gross Amount Due, and if that's zero, Usual and Customary
"RTN","BPSOS03",12,0)
 . S X=$$INSPAID1(N,RX)
"RTN","BPSOS03",13,0)
 . S TOT=TOT+X
"RTN","BPSOS03",14,0)
 Q TOT
"RTN","BPSOS03",15,0)
INSPAID1(N,RX) ;EP -
"RTN","BPSOS03",16,0)
 N X S X=$$509(N,RX) Q X
"RTN","BPSOS03",17,0)
NETPAID1(N,RX) ; EP - computed field in 9002313.57 and 9002313.59
"RTN","BPSOS03",18,0)
 N X S X=$$509(N,RX) ; X = (#509) Total Amount Paid
"RTN","BPSOS03",19,0)
 N SUB S SUB=1 ; Do we need to subtract (#505) Patient Pay Amount?
"RTN","BPSOS03",20,0)
 N IEN02,INS,FMT S IEN02=$P(^BPSR(RESP,0),U)
"RTN","BPSOS03",21,0)
 I IEN02 D
"RTN","BPSOS03",22,0)
 . S INS=$P($G(^BPSC(IEN02,0)),U,2) Q:'INS    ;IHS/SD/lwj 9/11/02
"RTN","BPSOS03",23,0)
 . S FMT=INS
"RTN","BPSOS03",24,0)
 . N X S X=$P(^BPSF(9002313.92,FMT,1),U,10)
"RTN","BPSOS03",25,0)
 . I X S SUB=0 ; Total paid means total paid by insurance
"RTN","BPSOS03",26,0)
 I SUB S X=X-$$505(N,RX)
"RTN","BPSOS03",27,0)
 I X<0,SUB D  ; apparently this format is supposed to be excl.
"RTN","BPSOS03",28,0)
 . Q:'$G(FMT)
"RTN","BPSOS03",29,0)
 . S $P(^BPSF(9002313.92,FMT,1),U,10)=1
"RTN","BPSOS03",30,0)
 . S X=X+$$505(N,RX) ;*1.26*1*
"RTN","BPSOS03",31,0)
 Q X
"RTN","BPSOS03",32,0)
REJTEXT(RESP,POS,ARR) ; EP - fills array (passed by ref)
"RTN","BPSOS03",33,0)
 K ARR
"RTN","BPSOS03",34,0)
 N A,I,X,R S (A,I)=0
"RTN","BPSOS03",35,0)
 F  S A=$O(^BPSR(RESP,1000,POS,511,A)) Q:'A  D
"RTN","BPSOS03",36,0)
 . S R=$P(^BPSR(RESP,1000,POS,511,A,0),U)
"RTN","BPSOS03",37,0)
 . Q:R=""
"RTN","BPSOS03",38,0)
 . N S S S=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSOS03",39,0)
 . I S S X=$TR($G(^BPSF(9002313.93,S,0)),U,":")
"RTN","BPSOS03",40,0)
 . E  S X=R_" unrecognized reject code"
"RTN","BPSOS03",41,0)
 . S I=I+1,ARR(I)=X
"RTN","BPSOS03",42,0)
 Q
"RTN","BPSOS03",43,0)
MESSAGE(RESP,POS,N) ; EP - get additional message from response
"RTN","BPSOS03",44,0)
 I $G(N)=1 Q $P($G(^BPSR(RESP,1000,POS,504)),U)
"RTN","BPSOS03",45,0)
 I $G(N)=2 Q $P($G(^BPSR(RESP,1000,POS,526)),U)
"RTN","BPSOS03",46,0)
 Q $$MESSAGE(RESP,POS,1)_$$MESSAGE(RESP,POS,2)
"RTN","BPSOS03",47,0)
DFF2EXT(X) Q $$DFF2EXT^BPSECFM(X)
"RTN","BPSOS03",48,0)
505(M,N) Q $$500(M,N,5) ; Patient Pay Amount
"RTN","BPSOS03",49,0)
506(M,N) Q $$500(M,N,6) ; Ingredient Cost Paid
"RTN","BPSOS03",50,0)
507(M,N) Q $$500(M,N,7) ; Contract Fee Paid
"RTN","BPSOS03",51,0)
508(M,N) Q $$500(M,N,8) ; Sales Tax Paid
"RTN","BPSOS03",52,0)
509(M,N) Q $$500(M,N,9) ; Total Amount Paid
"RTN","BPSOS03",53,0)
512(M,N) Q $$500(M,N,12) ; Accumulated Deductible Amount
"RTN","BPSOS03",54,0)
513(M,N) Q $$500(M,N,13) ; Remaining Deductible Amount
"RTN","BPSOS03",55,0)
514(M,N) Q $$500(M,N,14) ; Remaining Benefit Amount
"RTN","BPSOS03",56,0)
517(M,N) Q $$500(M,N,17) ; Amt Applied to Periodic Deduct
"RTN","BPSOS03",57,0)
518(M,N) Q $$500(M,N,18) ; Amount of Copay/CoInsurance
"RTN","BPSOS03",58,0)
519(M,N) Q $$500(M,N,19) ; Amt Attrib to Prod Selection
"RTN","BPSOS03",59,0)
520(M,N) Q $$500(M,N,20) ; Amt Exceed Per Benefit Max
"RTN","BPSOS03",60,0)
521(M,N) Q $$500(M,N,21) ; Incentive Fee Paid
"RTN","BPSOS03",61,0)
523(M,N) Q $$500(M,N,23) ; Amount Attributed to Sales Tax
"RTN","BPSOS03",62,0)
500(M,N,J) ; field #500+J signed numeric
"RTN","BPSOS03",63,0)
 Q:'M!'N ""
"RTN","BPSOS03",64,0)
 N X S X=$P($G(^BPSR(M,1000,N,500)),U,J)
"RTN","BPSOS03",65,0)
 I $E(X,1,2)?2U S X=$E(X,3,$L(X))
"RTN","BPSOS03",66,0)
 S X=$$DFF2EXT(X)
"RTN","BPSOS03",67,0)
 Q X
"RTN","BPSOS2")
0^128^B14102494
"RTN","BPSOS2",1,0)
BPSOS2 ;BHAM ISC/FCS/DRS - ECME manager's ScreenMan ;06/01/2004
"RTN","BPSOS2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS2",4,0)
 ;
"RTN","BPSOS2",5,0)
 ; ECME Statistics Screen
"RTN","BPSOS2",6,0)
 ;   Called by option BPS STATISTICS
"RTN","BPSOS2",7,0)
 ;   Uses List Template BPS STATISTICS AND MANAGEMENT
"RTN","BPSOS2",8,0)
 ;   Original IHS logic had many management function, which are no
"RTN","BPSOS2",9,0)
 ;   longer used
"RTN","BPSOS2",10,0)
 ;
"RTN","BPSOS2",11,0)
 ; ALL writes of screen lines should be done as follows:
"RTN","BPSOS2",12,0)
 ;  IF $$VISIBLE(line) DO WRITE^VALM10(line)
"RTN","BPSOS2",13,0)
 ;  Then NODISPLY can be set so that $$VISIBLE always returns FALSE
"RTN","BPSOS2",14,0)
 Q
"RTN","BPSOS2",15,0)
 ;
"RTN","BPSOS2",16,0)
EN ;EP - Option BPS STATISTICS
"RTN","BPSOS2",17,0)
 N BASE,CURR,DISP,AVG,CHG
"RTN","BPSOS2",18,0)
 ; BASE(*) = base values, from when zeroed things out
"RTN","BPSOS2",19,0)
 ; CURR(*) = current values, from most recent read
"RTN","BPSOS2",20,0)
 ; CHG(*) = changed value to print, if any
"RTN","BPSOS2",21,0)
 D FETCHES(0) ; fetch stats into CURR() array - possibly reset BASE array
"RTN","BPSOS2",22,0)
 M CHG=CURR
"RTN","BPSOS2",23,0)
 D DIFF
"RTN","BPSOS2",24,0)
 S ^TMP("BPSOS2",$J,"FREQ")=30
"RTN","BPSOS2",25,0)
 I $P($G(^BPSECX("S",1,0)),U,2)="" D
"RTN","BPSOS2",26,0)
 .N %,%H,%I,X D NOW^%DTC S $P(^BPSECX("S",1,0),U,2)=%
"RTN","BPSOS2",27,0)
 D EN^VALM("BPS STATISTICS AND MANAGEMENT")
"RTN","BPSOS2",28,0)
 Q
"RTN","BPSOS2",29,0)
 ;
"RTN","BPSOS2",30,0)
INIT ; Entry Code - Init variables and list array
"RTN","BPSOS2",31,0)
 N NODISPLY S NODISPLY=1
"RTN","BPSOS2",32,0)
 D CLEAN^VALM10
"RTN","BPSOS2",33,0)
 S VALMCNT=0 ; 0 lines so far
"RTN","BPSOS2",34,0)
 D LABELS^BPSOS2C
"RTN","BPSOS2",35,0)
 D HDR
"RTN","BPSOS2",36,0)
 D FETCHES(1) ; set up CURR
"RTN","BPSOS2",37,0)
 M CHG=CURR
"RTN","BPSOS2",38,0)
 D DIFF ; compute DIFF = differences and changed ones go into CHG
"RTN","BPSOS2",39,0)
 D VALUES^BPSOS2B ; displays whatever's in CHG() and kills it off
"RTN","BPSOS2",40,0)
 Q
"RTN","BPSOS2",41,0)
 ;
"RTN","BPSOS2",42,0)
 ; Define Current (CURR) array and reset BASE
"RTN","BPSOS2",43,0)
 ;
"RTN","BPSOS2",44,0)
 ; Input variable -> B = 0 Reset (kill) BASE values and retrieve
"RTN","BPSOS2",45,0)
 ;                         values
"RTN","BPSOS2",46,0)
 ;                       1 Just retrieve current values
"RTN","BPSOS2",47,0)
FETCHES(B) N DST
"RTN","BPSOS2",48,0)
 S DST="CURR"
"RTN","BPSOS2",49,0)
 S ^TMP("BPSOS2",$J,"$H",DST)=$H
"RTN","BPSOS2",50,0)
 D FETCH58(DST_"(""COMM"")")
"RTN","BPSOS2",51,0)
 D FETSTAT(DST_"(""STAT"")")
"RTN","BPSOS2",52,0)
 ;
"RTN","BPSOS2",53,0)
 ;If entering option or resetting permanent values clear base
"RTN","BPSOS2",54,0)
 I B=0 K BASE S ^TMP("BPSOS2",$J,"$H","BASE")=$H
"RTN","BPSOS2",55,0)
 Q
"RTN","BPSOS2",56,0)
 ;
"RTN","BPSOS2",57,0)
DIFF ;EP - from BPSOS2A
"RTN","BPSOS2",58,0)
 N A,B S A=""
"RTN","BPSOS2",59,0)
 F  S A=$O(CURR(A)) Q:A=""  S B="" F  S B=$O(CURR(A,B)) Q:B=""  D
"RTN","BPSOS2",60,0)
 .I A="STAT" S CHG(A,B)=CURR(A,B)
"RTN","BPSOS2",61,0)
 .I A="COMM" S CHG(A,B)=CURR(A,B)-$G(BASE(A,B))
"RTN","BPSOS2",62,0)
 ;
"RTN","BPSOS2",63,0)
 Q
"RTN","BPSOS2",64,0)
 ;
"RTN","BPSOS2",65,0)
FETCH58(DST) ; send DST = closed root of the destination
"RTN","BPSOS2",66,0)
 K @DST
"RTN","BPSOS2",67,0)
 N FN,DIC,DR,DA,DIQ,TMP ; note that DA=1 is hardcoded
"RTN","BPSOS2",68,0)
 S (FN,DIC)=9002313.58,DR="200:219",DIQ="TMP(",DA=1
"RTN","BPSOS2",69,0)
 D EN^DIQ1
"RTN","BPSOS2",70,0)
 M @DST=TMP(FN,1)
"RTN","BPSOS2",71,0)
 Q
"RTN","BPSOS2",72,0)
 ;
"RTN","BPSOS2",73,0)
FETSTAT(DEST) ;
"RTN","BPSOS2",74,0)
 ; send DEST = closed root of the destination
"RTN","BPSOS2",75,0)
 K @DEST
"RTN","BPSOS2",76,0)
 N Q,N,A F Q=0:10:90,31 D
"RTN","BPSOS2",77,0)
 .S A="" F N=0:1 S A=$O(^BPST("AD",Q,A)) Q:A=""
"RTN","BPSOS2",78,0)
 . I Q#10 S @DEST@(Q\10*10)=@DEST@(Q\10*10)+N
"RTN","BPSOS2",79,0)
 . E  S @DEST@(Q)=N ; relies on multiples of 10 coming first!
"RTN","BPSOS2",80,0)
 Q
"RTN","BPSOS2",81,0)
 ;
"RTN","BPSOS2",82,0)
UPDFREQ() ;
"RTN","BPSOS2",83,0)
 Q 3
"RTN","BPSOS2",84,0)
 ;
"RTN","BPSOS2",85,0)
CLEARAT() ;
"RTN","BPSOS2",86,0)
 S Y=$P(^BPSECX("S",1,0),U,2) X ^DD("DD") Q Y
"RTN","BPSOS2",87,0)
 ;
"RTN","BPSOS2",88,0)
HDR ; -- header code
"RTN","BPSOS2",89,0)
 S VALMHDR(1)="Communications statistics last cleared on "_$$CLEARAT
"RTN","BPSOS2",90,0)
 S XQORM("B")="U1" ; Default action is Update
"RTN","BPSOS2",91,0)
 Q
"RTN","BPSOS2",92,0)
 ;
"RTN","BPSOS2",93,0)
UPD ;EP - From BPSOS2A ; Protocol BPS P2 UPDATE
"RTN","BPSOS2",94,0)
 D UPDATE(1)
"RTN","BPSOS2",95,0)
 S VALMBCK="",XQORM("B")="U1"
"RTN","BPSOS2",96,0)
 Q
"RTN","BPSOS2",97,0)
 ;
"RTN","BPSOS2",98,0)
CONTUPD ; Protocol BPS P2 CONTINUOUS
"RTN","BPSOS2",99,0)
 W !!!!!
"RTN","BPSOS2",100,0)
 D UPDATE(-1)
"RTN","BPSOS2",101,0)
 S VALMBCK=""
"RTN","BPSOS2",102,0)
 Q
"RTN","BPSOS2",103,0)
 ;
"RTN","BPSOS2",104,0)
UPDATE(COUNTER) ; with COUNTER = a count down
"RTN","BPSOS2",105,0)
 N STOP,DTOUT
"RTN","BPSOS2",106,0)
 F  D  Q:$G(STOP)
"RTN","BPSOS2",107,0)
 .D UPD1
"RTN","BPSOS2",108,0)
 .S COUNTER=COUNTER-1 I 'COUNTER S STOP=1 Q
"RTN","BPSOS2",109,0)
 .I '$G(NODISPLY) D
"RTN","BPSOS2",110,0)
 ..D MSG^VALM10("In continuous update mode: press Q to Quit")
"RTN","BPSOS2",111,0)
 ..N X S X=$$READ^XGF(1,$$UPDFREQ) D MSG^VALM10(" ")
"RTN","BPSOS2",112,0)
 ..I '$G(DTOUT),X]"","Qq^^"[X S STOP=1
"RTN","BPSOS2",113,0)
 ..N Y F  R Y:0 Q:'$T  ; clean out typeahead (like mistaken arrow keys)
"RTN","BPSOS2",114,0)
 ..; But if timed out, keep looping and updating
"RTN","BPSOS2",115,0)
 Q
"RTN","BPSOS2",116,0)
 ;
"RTN","BPSOS2",117,0)
UPD1 ; one update cycle
"RTN","BPSOS2",118,0)
 N A,B,T
"RTN","BPSOS2",119,0)
 D HDR,RE^VALM4
"RTN","BPSOS2",120,0)
 D FETCHES(1) ; fetch into CURR array
"RTN","BPSOS2",121,0)
 D DIFF ; compute differences
"RTN","BPSOS2",122,0)
 D VALUES^BPSOS2B ; compute values and display if changed
"RTN","BPSOS2",123,0)
 Q
"RTN","BPSOS2",124,0)
 ;
"RTN","BPSOS2",125,0)
HELP ; -- help code
"RTN","BPSOS2",126,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSOS2",127,0)
 Q
"RTN","BPSOS2",128,0)
 ;
"RTN","BPSOS2",129,0)
EXIT ; -- exit code
"RTN","BPSOS2",130,0)
 D FULL^VALM1
"RTN","BPSOS2",131,0)
 Q
"RTN","BPSOS2",132,0)
 ;
"RTN","BPSOS2",133,0)
EXPND ; -- expand code
"RTN","BPSOS2",134,0)
 Q
"RTN","BPSOS25")
1^129
"RTN","BPSOS29")
1^130
"RTN","BPSOS2A")
0^132^B6917182
"RTN","BPSOS2A",1,0)
BPSOS2A ;BHAM ISC/FCS/DRS/DLF - continuation of BPSOS2 ;06/01/2004
"RTN","BPSOS2A",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS2A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS2A",4,0)
 Q
"RTN","BPSOS2A",5,0)
 ;Statistics & Misc Options Screen - Zero Stats
"RTN","BPSOS2A",6,0)
 ;
"RTN","BPSOS2A",7,0)
 ;Protocol - BPS P2 ZERO - clearing stats
"RTN","BPSOS2A",8,0)
ZERO N ZTYP,X
"RTN","BPSOS2A",9,0)
 S ZTYP=$$SELZTYP() I ZTYP="^" W !!!,"Nothing changed.",! D ANY
"RTN","BPSOS2A",10,0)
 I ZTYP'="^" D
"RTN","BPSOS2A",11,0)
 .I $$SURE'=1 W !!!,"Nothing changed.",! D ANY Q
"RTN","BPSOS2A",12,0)
 .;
"RTN","BPSOS2A",13,0)
 .;Clear Local Stats
"RTN","BPSOS2A",14,0)
 .I ZTYP=0 D ZLOCAL
"RTN","BPSOS2A",15,0)
 .;
"RTN","BPSOS2A",16,0)
 .;Clear Permanent Stats
"RTN","BPSOS2A",17,0)
 .I ZTYP=1 D ZPERM,FETCHES^BPSOS2(0) ; fetch all these zeroes into BASE(*)
"RTN","BPSOS2A",18,0)
 D UPD^BPSOS2
"RTN","BPSOS2A",19,0)
 S VALMBCK=""
"RTN","BPSOS2A",20,0)
 Q
"RTN","BPSOS2A",21,0)
 ;
"RTN","BPSOS2A",22,0)
 ;Zero Local Statistics
"RTN","BPSOS2A",23,0)
 ;
"RTN","BPSOS2A",24,0)
 ;Reset Base Numbers to Current Numbers
"RTN","BPSOS2A",25,0)
ZLOCAL K BASE M BASE=CURR
"RTN","BPSOS2A",26,0)
 Q
"RTN","BPSOS2A",27,0)
 ;
"RTN","BPSOS2A",28,0)
 ;Zero Permanent Statistics
"RTN","BPSOS2A",29,0)
 ; This logic will create a strange order - Record 1 is always the newest.
"RTN","BPSOS2A",30,0)
 ; Record 2 will be the oldest, Record 3 is next oldest, etc.
"RTN","BPSOS2A",31,0)
ZPERM N FILE
"RTN","BPSOS2A",32,0)
 S FILE=9002313.58
"RTN","BPSOS2A",33,0)
 L +^BPSECX("S"):300 I '$T W "LOCK failed",! Q
"RTN","BPSOS2A",34,0)
 ;
"RTN","BPSOS2A",35,0)
 ; Increment zero node for the database
"RTN","BPSOS2A",36,0)
 N I,N
"RTN","BPSOS2A",37,0)
 F I=3,4 D
"RTN","BPSOS2A",38,0)
 . S N=$P(^BPSECX("S",0),U,I)+1
"RTN","BPSOS2A",39,0)
 . S $P(^BPSECX("S",0),U,I)=N
"RTN","BPSOS2A",40,0)
 ;
"RTN","BPSOS2A",41,0)
 ; Merge current data into new record
"RTN","BPSOS2A",42,0)
 S N=$P(^BPSECX("S",0),U,3)
"RTN","BPSOS2A",43,0)
 M ^BPSECX("S",N)=^BPSECX("S",1)
"RTN","BPSOS2A",44,0)
 S $P(^BPSECX("S",N,0),U)=N ; fix up the .01 field
"RTN","BPSOS2A",45,0)
 N DIK,DA S DIK="^BPSECX(""S"",",DA=N D IX^DIK ; trivial indexing
"RTN","BPSOS2A",46,0)
 ;
"RTN","BPSOS2A",47,0)
 ; Update fields to be zero, except date/time cleared
"RTN","BPSOS2A",48,0)
 N FIELD S FIELD=.01
"RTN","BPSOS2A",49,0)
 F  S FIELD=$O(^DD(FILE,FIELD)) Q:'FIELD  D
"RTN","BPSOS2A",50,0)
 . N VALUE
"RTN","BPSOS2A",51,0)
 . I FIELD=2 D  ; date/time last cleared
"RTN","BPSOS2A",52,0)
 .. N %,%H,%I,X D NOW^%DTC S VALUE=%
"RTN","BPSOS2A",53,0)
 . E  S VALUE=0
"RTN","BPSOS2A",54,0)
 . N DIE,DA,DR S DIE=FILE,DA=1,DR=FIELD_"////"_VALUE D ^DIE
"RTN","BPSOS2A",55,0)
 ;
"RTN","BPSOS2A",56,0)
 ; Unlock record
"RTN","BPSOS2A",57,0)
 L -^BPSECX("S")
"RTN","BPSOS2A",58,0)
 Q
"RTN","BPSOS2A",59,0)
 ;
"RTN","BPSOS2A",60,0)
SELZTYP() ;
"RTN","BPSOS2A",61,0)
 N DFLT,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSOS2A",62,0)
 S DFLT="Local Copy"
"RTN","BPSOS2A",63,0)
 S DIR(0)="S^L:Local Copy;P:Permanent Copy",DIR("A")="Delete (L)ocal Copy or (P)ermanent Copy of the statistics",DIR("B")=DFLT
"RTN","BPSOS2A",64,0)
 D ^DIR
"RTN","BPSOS2A",65,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSOS2A",66,0)
 S Y=$S(Y="P":1,Y="L":0,1:Y)
"RTN","BPSOS2A",67,0)
 Q Y
"RTN","BPSOS2A",68,0)
 ;
"RTN","BPSOS2A",69,0)
SURE(DEF) ;
"RTN","BPSOS2A",70,0)
 N SURE,PMT,OPT,ANS
"RTN","BPSOS2A",71,0)
 S PMT="Are you sure"
"RTN","BPSOS2A",72,0)
 I '$D(DEF) S DEF="N"
"RTN","BPSOS2A",73,0)
 S OPT=1 ; answer is optional
"RTN","BPSOS2A",74,0)
 S ANS=$$YESNO^BPSOSU3(PMT,DEF,OPT)
"RTN","BPSOS2A",75,0)
 Q ANS ; 1 or 0 or -1 or ^ or ^^ or null
"RTN","BPSOS2A",76,0)
ANY ;EP
"RTN","BPSOS2A",77,0)
 W:$X ! D PRESSANY^BPSOSU5() Q  ; Press any key
"RTN","BPSOS2B")
0^133^B2390241
"RTN","BPSOS2B",1,0)
BPSOS2B ;BHAM ISC/FCS/DRS/DLF - BPSOS2 continuation ;06/01/2004
"RTN","BPSOS2B",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS2B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS2B",4,0)
 Q
"RTN","BPSOS2B",5,0)
VALUES ;EP - from BPSOS2
"RTN","BPSOS2B",6,0)
 ; note!  This must correspond with the LABELS code in BPSOS2C
"RTN","BPSOS2B",7,0)
 N I,R,C,X,X2,X3
"RTN","BPSOS2B",8,0)
 ;
"RTN","BPSOS2B",9,0)
 ; Display In Progress Stats
"RTN","BPSOS2B",10,0)
 S R=1,C=29
"RTN","BPSOS2B",11,0)
 F I=0,10,30,40,50,60,70,90 D
"RTN","BPSOS2B",12,0)
 . S R=R+1,X=+$G(CHG("STAT",I)),X2=0,X3=3 D COM
"RTN","BPSOS2B",13,0)
 ;
"RTN","BPSOS2B",14,0)
 ; Display Completed Stats
"RTN","BPSOS2B",15,0)
 S R=1,C=65
"RTN","BPSOS2B",16,0)
 F I=203,202,208,204,205,206,207,201 D
"RTN","BPSOS2B",17,0)
 . S R=R+1,X=+$G(CHG("COMM",I)),X2=0,X3=7 D COM
"RTN","BPSOS2B",18,0)
 Q
"RTN","BPSOS2B",19,0)
 ;
"RTN","BPSOS2B",20,0)
COM ; Copied from COMMA^%DTC with NEWs added
"RTN","BPSOS2B",21,0)
 ; Input X=value to format
"RTN","BPSOS2B",22,0)
 ;       X2=# decimal digits opt. followed by "$"
"RTN","BPSOS2B",23,0)
 ;       X3=len of desired output
"RTN","BPSOS2B",24,0)
 N %,D,L
"RTN","BPSOS2B",25,0)
 I $D(X3) S X3=X3+1 ; make room for the trailing space we'll get rid of
"RTN","BPSOS2B",26,0)
 S D=X<0 S:D X=-X S %=$S($D(X2):+X2,1:2),X=$J(X,1,%),%=$L(X)-3-$E(23456789,%),L=$S($D(X3):X3,1:12)
"RTN","BPSOS2B",27,0)
 F %=%:-3 Q:$E(X,%)=""  S X=$E(X,1,%)_","_$E(X,%+1,99)
"RTN","BPSOS2B",28,0)
 S:$D(X2) X=$E("$",X2["$")_X S X=$J($E("(",D)_X_$E(" )",D+1),L)
"RTN","BPSOS2B",29,0)
 I $E(X,$L(X))=" " S X=$E(X,1,$L(X)-1)
"RTN","BPSOS2B",30,0)
 ;
"RTN","BPSOS2B",31,0)
 ; given R=row,C=col,X=string
"RTN","BPSOS2B",32,0)
 D SET^VALM10(R,$$SETSTR^VALM1(X,$G(@VALMAR@(R,0)),C,$L(X)))
"RTN","BPSOS2B",33,0)
 I $$VISIBLE(R) D WRITE^VALM10(R)
"RTN","BPSOS2B",34,0)
 Q
"RTN","BPSOS2B",35,0)
 ;
"RTN","BPSOS2B",36,0)
VISIBLE(R) ;EP -
"RTN","BPSOS2B",37,0)
 I $G(NODISPLY) Q 0
"RTN","BPSOS2B",38,0)
 I '$G(VALMBG) Q 0
"RTN","BPSOS2B",39,0)
 I R<VALMBG Q 0
"RTN","BPSOS2B",40,0)
 I R>(VALMBG+(18-3)) Q 0
"RTN","BPSOS2B",41,0)
 Q 1
"RTN","BPSOS2C")
0^134^B1491511
"RTN","BPSOS2C",1,0)
BPSOS2C ;BHAM ISC/FCS/DRS/DLF - BPSOS2 continuation ;06/01/2004
"RTN","BPSOS2C",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS2C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS2C",4,0)
 Q
"RTN","BPSOS2C",5,0)
LABELS ;EP - from BPSOS2 ; set up the labels display
"RTN","BPSOS2C",6,0)
 N R,C,X,R1,I
"RTN","BPSOS2C",7,0)
 ;
"RTN","BPSOS2C",8,0)
 ; Display Headers for In Progress claims
"RTN","BPSOS2C",9,0)
 S R=1,C=3,X="* CLAIM STATUS *" D L1
"RTN","BPSOS2C",10,0)
 F I=0,10,30,40,50,60,70,90 S R=R+1,X=$$STATI^BPSOSU(I) D L1
"RTN","BPSOS2C",11,0)
 S R1=R
"RTN","BPSOS2C",12,0)
 ;
"RTN","BPSOS2C",13,0)
 ; Display Headers for Completed claims
"RTN","BPSOS2C",14,0)
 S R=1,C=40,X="* CLAIM RESULTS *" D L1
"RTN","BPSOS2C",15,0)
 F I=1:1:8 S R=R+1,X=$P($T(HDR+I),";",3) D L1
"RTN","BPSOS2C",16,0)
 ;
"RTN","BPSOS2C",17,0)
 ; Update Line Counter to side with highest number of rows
"RTN","BPSOS2C",18,0)
 S VALMCNT=$S(R>R1:R,1:R1)
"RTN","BPSOS2C",19,0)
 Q
"RTN","BPSOS2C",20,0)
L1 ; given R=row,C=col,X=string
"RTN","BPSOS2C",21,0)
 ; Duplicate of L1^BPSOS2B
"RTN","BPSOS2C",22,0)
 D SET^VALM10(R,$$SETSTR^VALM1(X,$G(@VALMAR@(R,0)),C,$L(X)))
"RTN","BPSOS2C",23,0)
 I $$VISIBLE^BPSOS2B(R) D WRITE^VALM10(R)
"RTN","BPSOS2C",24,0)
 Q
"RTN","BPSOS2C",25,0)
HDR ;;
"RTN","BPSOS2C",26,0)
 ;;Paid claims
"RTN","BPSOS2C",27,0)
 ;;Rejected claims
"RTN","BPSOS2C",28,0)
 ;;Dropped to Paper
"RTN","BPSOS2C",29,0)
 ;;Duplicate claims
"RTN","BPSOS2C",30,0)
 ;;Captured claims
"RTN","BPSOS2C",31,0)
 ;;Accepted Reversals
"RTN","BPSOS2C",32,0)
 ;;Rejected Reversals
"RTN","BPSOS2C",33,0)
 ;;Errors
"RTN","BPSOS2D")
1^131
"RTN","BPSOS57")
0^165^B16780486
"RTN","BPSOS57",1,0)
BPSOS57 ;BHAM ISC/FCS/DRS/FLS - BPS Log of Transactions Utils ;06/01/2004
"RTN","BPSOS57",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS57",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS57",4,0)
 Q
"RTN","BPSOS57",5,0)
 ; Numerous BPS Log of Transaction functions are here
"RTN","BPSOS57",6,0)
 ; Each assumes that IEN57 is defined
"RTN","BPSOS57",7,0)
 ; Originally copied from BPSOSQ
"RTN","BPSOS57",8,0)
 ;
"RTN","BPSOS57",9,0)
PREVIOUS(N57) ;
"RTN","BPSOS57",10,0)
 I '$D(N57) S N57=IEN57
"RTN","BPSOS57",11,0)
 N RXI,RXR S RXI=$P(^BPSTL(N57,1),U,11)
"RTN","BPSOS57",12,0)
 S RXR=$P(^BPSTL(N57,1),U)
"RTN","BPSOS57",13,0)
 I RXI=""!(RXR="") Q ""
"RTN","BPSOS57",14,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,N57),-1)
"RTN","BPSOS57",15,0)
LAST57(RXI,RXR) Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,""),-1)
"RTN","BPSOS57",16,0)
DRGDFN() ; EP - BPS Log of Transaction field
"RTN","BPSOS57",17,0)
 N RXI
"RTN","BPSOS57",18,0)
 S RXI=$$RXI
"RTN","BPSOS57",19,0)
 I 'RXI Q ""
"RTN","BPSOS57",20,0)
 Q $$RXAPI1^BPSUTIL1(RXI,6,"I") ; Given IEN57, return DRGDFN
"RTN","BPSOS57",21,0)
DRGNAME() ; EP - BPS Log of Transaction field
"RTN","BPSOS57",22,0)
 N RXI
"RTN","BPSOS57",23,0)
 S RXI=$$RXI
"RTN","BPSOS57",24,0)
 I 'RXI Q ""
"RTN","BPSOS57",25,0)
 Q $$RXAPI1^BPSUTIL1(RXI,6,"E") ; Given IEN57, return DRGNAME
"RTN","BPSOS57",26,0)
RELDATE() ;EP - BPS Log of Transaction field
"RTN","BPSOS57",27,0)
 N RXI,RXR
"RTN","BPSOS57",28,0)
 S RXI=$$RXI,RXR=$$RXR
"RTN","BPSOS57",29,0)
 I 'RXI Q ""
"RTN","BPSOS57",30,0)
 I RXR Q $$REFAPI1^BPSUTIL1(RXI,RXR,17,"I")
"RTN","BPSOS57",31,0)
 Q $$RXAPI1^BPSUTIL1(RXI,31,"I")
"RTN","BPSOS57",32,0)
RXI() Q $P(^BPSTL(IEN57,1),U,11) ; Given IEN57, return RXI
"RTN","BPSOS57",33,0)
RXR() Q $P(^BPSTL(IEN57,1),U,1) ; Given IEN57, return RXR
"RTN","BPSOS57",34,0)
NDC() Q $P(^BPSTL(IEN57,1),U,2)
"RTN","BPSOS57",35,0)
QTY() Q $P(^BPSTL(IEN57,5),U) ; Given IEN57, return quantity
"RTN","BPSOS57",36,0)
AMT() Q $P(^BPSTL(IEN57,5),U,5) ; return total $amount
"RTN","BPSOS57",37,0)
CHG() Q $P(^BPSTL(IEN57,5),U,5) ; Given IEN57, ret total charge
"RTN","BPSOS57",38,0)
INSIEN() Q $P(^BPSTL(IEN57,1),U,6)
"RTN","BPSOS57",39,0)
PATIENT() Q $P(^BPSTL(IEN57,0),U,6)
"RTN","BPSOS57",40,0)
HRN() ; Health record number and facility abbreviation
"RTN","BPSOS57",41,0)
 ; Called by BPS Log of Transaction field
"RTN","BPSOS57",42,0)
 Q 0
"RTN","BPSOS57",43,0)
USER() N X S X=$P(^BPSTL(IEN57,0),U,10) S:'X X=$G(DUZ) Q X
"RTN","BPSOS57",44,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOS57",45,0)
ISREVERS(N) ;EP - BPSOSIY
"RTN","BPSOS57",46,0)
 ; Returns reversal claim #, else false
"RTN","BPSOS57",47,0)
 N X S X=$G(^BPSTL(N,4)) Q:X="" 0
"RTN","BPSOS57",48,0)
 I X Q $P(X,U) ; reversal of electronic claim
"RTN","BPSOS57",49,0)
 Q 0
"RTN","BPSOS57",50,0)
REVACC(N) ;EP - BPSOSIY
"RTN","BPSOS57",51,0)
 ; was this an accepted reversal? return true or false
"RTN","BPSOS57",52,0)
 ; Treat Duplicate of Accepted Reversal ("S") as accepted
"RTN","BPSOS57",53,0)
 N X
"RTN","BPSOS57",54,0)
 S X=$$REVRESP(N)
"RTN","BPSOS57",55,0)
 Q X="A"!(X="S")
"RTN","BPSOS57",56,0)
REVRESP(N) ;
"RTN","BPSOS57",57,0)
 N RESP S RESP=$P(^BPSTL(N,4),U,2)
"RTN","BPSOS57",58,0)
 I 'RESP Q "?"
"RTN","BPSOS57",59,0)
 N X S X=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOS57",60,0)
 Q X ; Should be "A" or "R" - can be "S" (Duplicate of Accepted Reversal)
"RTN","BPSOS57",61,0)
 ;
"RTN","BPSOS57",62,0)
POSITION() ; return pointer to position within claim (D1)
"RTN","BPSOS57",63,0)
 Q $P($G(^BPSTL(IEN57,0)),U,9)
"RTN","BPSOS57",64,0)
IEN02() ; return pointer to claim
"RTN","BPSOS57",65,0)
 Q $P($G(^BPSTL(IEN57,0)),U,4)
"RTN","BPSOS57",66,0)
IEN03() ; return pointer to response
"RTN","BPSOS57",67,0)
 Q $P($G(^BPSTL(IEN57,0)),U,5)
"RTN","BPSOS57",68,0)
REVIEN02() ; return pointer to reversal claim
"RTN","BPSOS57",69,0)
 Q $P($G(^BPSTL(IEN57,4)),U)
"RTN","BPSOS57",70,0)
REVIEN03() ; return pointer to reversal response
"RTN","BPSOS57",71,0)
 Q $P($G(^BPSTL(IEN57,4)),U,2)
"RTN","BPSOS57",72,0)
FIELD(F,REV) ; EP - BPS Log of Transaction fields
"RTN","BPSOS57",73,0)
 ; Retrieve field F from claim or response - Given IEN57
"RTN","BPSOS57",74,0)
 ; Returns value
"RTN","BPSOS57",75,0)
 ; Special for reject codes:  F=511 gets ","-delimited string of codes
"RTN","BPSOS57",76,0)
 ;  F=511.01 gets first code, F=511.02 gets second one, etc.
"RTN","BPSOS57",77,0)
 N X,IEN02,IEN03,POS,IEN57 S IEN57=D0
"RTN","BPSOS57",78,0)
 S POS=$$POSITION,IEN02=$$IEN02,IEN03=$$IEN03
"RTN","BPSOS57",79,0)
 I $G(REV) S IEN02=$$REVIEN02,IEN03=$$REVIEN03
"RTN","BPSOS57",80,0)
 ;
"RTN","BPSOS57",81,0)
 ; Validate IENs
"RTN","BPSOS57",82,0)
 I 'IEN02 Q ""
"RTN","BPSOS57",83,0)
 I 'POS,F=308!(F>400) Q ""
"RTN","BPSOS57",84,0)
 I 'IEN03,F>500 Q ""
"RTN","BPSOS57",85,0)
 ;
"RTN","BPSOS57",86,0)
 ; Get Data
"RTN","BPSOS57",87,0)
 I F<400,F'=308 S X=$$GET1^DIQ(9002313.02,IEN02_",",F,"I")
"RTN","BPSOS57",88,0)
 E  I F=308!(F>400&(F<500)) S X=$$GET1^DIQ(9002313.0201,POS_","_IEN02_",",F,"I")
"RTN","BPSOS57",89,0)
 E  I F=501!(F=524) S X=$$GET1^DIQ(9002313.03,IEN03_",",F,"I")
"RTN","BPSOS57",90,0)
 E  I F\1=511 D REJCODES S:F#1 X=$G(X(F#1*100))
"RTN","BPSOS57",91,0)
 E  S X=$$GET1^DIQ(9002313.0301,POS_","_IEN03_",",F,"I")
"RTN","BPSOS57",92,0)
 ;
"RTN","BPSOS57",93,0)
 ; Do format conversions
"RTN","BPSOS57",94,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,$L(X)-1)
"RTN","BPSOS57",95,0)
 D STRIPID ; strip field ID, if any
"RTN","BPSOS57",96,0)
 D MONEY ; money fields, where appropriate
"RTN","BPSOS57",97,0)
 D OTHER ; other special conversions
"RTN","BPSOS57",98,0)
 Q X
"RTN","BPSOS57",99,0)
 ;
"RTN","BPSOS57",100,0)
REJCODES ; rejection codes for IEN03
"RTN","BPSOS57",101,0)
 ; X = ","-delimited string of two-char codes
"RTN","BPSOS57",102,0)
 ; X(j)=code_" "_description
"RTN","BPSOS57",103,0)
 K X S X=""
"RTN","BPSOS57",104,0)
 N I,J S (I,J)=0
"RTN","BPSOS57",105,0)
 F  S I=$O(^BPSR(IEN03,1000,POS,511,I)) Q:'I  D
"RTN","BPSOS57",106,0)
 . N A S A=$P(^BPSR(IEN03,1000,POS,511,I,0),U) Q:'A
"RTN","BPSOS57",107,0)
 . S A=$O(^BPSF(9002313.93,"B",A,0)) Q:'A
"RTN","BPSOS57",108,0)
 . S A=^BPSF(9002313.93,A,0)
"RTN","BPSOS57",109,0)
 . S:X]"" X=X_"," S X=X_$P(A,U)
"RTN","BPSOS57",110,0)
 . S J=J+1,X(J)=$P(A,U)_" "_$P(A,U,2)
"RTN","BPSOS57",111,0)
 Q
"RTN","BPSOS57",112,0)
 ;
"RTN","BPSOS57",113,0)
STRIPID ; some fields have two-character field ID
"RTN","BPSOS57",114,0)
 ; and first eliminate all those that don't:
"RTN","BPSOS57",115,0)
 Q:F<307  Q:F=308
"RTN","BPSOS57",116,0)
 I F>400,F<500 Q:F<410  Q:F=411  Q:F=414  Q:F=415  Q:F=419  Q:F=420  Q:F=426
"RTN","BPSOS57",117,0)
 ;IHS/DSD/lwj 10/02 nxt line changed on behalf of David Slauenwhite
"RTN","BPSOS57",118,0)
 I F>500 Q:F<512  Q:F=525  Q:F=526  ;DS 10/11/01
"RTN","BPSOS57",119,0)
 S X=$E(X,3,$L(X))
"RTN","BPSOS57",120,0)
 Q
"RTN","BPSOS57",121,0)
MONEY ; some fields are money fields in signed overpunch format
"RTN","BPSOS57",122,0)
 Q:F<400
"RTN","BPSOS57",123,0)
 ;IHS/DSD/lwj 10/02 nxt line changed on behalf of David Slauenwhite
"RTN","BPSOS57",124,0)
 I F>400,F<500 I F'=409,F'=410,F'=426,F'=430,F'=431,F'=433,F'=438,F'=428,F'=412 Q
"RTN","BPSOS57",125,0)
 I F>500 Q:F<505  Q:F=510  Q:F\1=511  Q:F=522  Q:F>523
"RTN","BPSOS57",126,0)
 S X=+$$DFF2EXT^BPSECFM(X)
"RTN","BPSOS57",127,0)
 I X=0 S X="" ; so [CAPTIONED] doesn't print it
"RTN","BPSOS57",128,0)
 Q
"RTN","BPSOS57",129,0)
OTHER ; other special conversions
"RTN","BPSOS57",130,0)
 I F=442 S X=X/1000 Q  ; metric decimal quantity
"RTN","BPSOS57",131,0)
 Q
"RTN","BPSOS6A")
1^54
"RTN","BPSOS6B")
1^55
"RTN","BPSOS6C")
1^56
"RTN","BPSOS6D")
1^57
"RTN","BPSOS6E")
1^192
"RTN","BPSOS6F")
1^58
"RTN","BPSOS6G")
1^59
"RTN","BPSOS6H")
1^60
"RTN","BPSOS6I")
1^61
"RTN","BPSOS6J")
1^62
"RTN","BPSOS6L")
1^63
"RTN","BPSOS6M")
0^34^B10068430
"RTN","BPSOS6M",1,0)
BPSOS6M ;BHAM ISC/FCS/DRS - Print log of claim ;06/01/2004
"RTN","BPSOS6M",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOS6M",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOS6M",4,0)
 ;
"RTN","BPSOS6M",5,0)
 ; Display the BPS Log for a given BPS Transaction
"RTN","BPSOS6M",6,0)
 Q
"RTN","BPSOS6M",7,0)
CLAIMLOG(IEN59) ;EP - from BPSSCRDV
"RTN","BPSOS6M",8,0)
 ;
"RTN","BPSOS6M",9,0)
 I '$G(IEN59) Q
"RTN","BPSOS6M",10,0)
 ;
"RTN","BPSOS6M",11,0)
 ; Get Device
"RTN","BPSOS6M",12,0)
 N POP
"RTN","BPSOS6M",13,0)
 D ^%ZIS
"RTN","BPSOS6M",14,0)
 I $G(POP) Q
"RTN","BPSOS6M",15,0)
 U IO
"RTN","BPSOS6M",16,0)
 ;
"RTN","BPSOS6M",17,0)
 ; Determine if this is a terminal
"RTN","BPSOS6M",18,0)
 N BPSCR S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSOS6M",19,0)
 ;
"RTN","BPSOS6M",20,0)
 ; Read BPS Transaction into the local variable
"RTN","BPSOS6M",21,0)
 N REC,X,X1,X2 M REC=^BPST(IEN59)
"RTN","BPSOS6M",22,0)
 N I F I=0:1:2 I '$D(REC(I)) S REC(I)=""
"RTN","BPSOS6M",23,0)
 ;
"RTN","BPSOS6M",24,0)
 ; Display Header
"RTN","BPSOS6M",25,0)
 I BPSCR W @IOF
"RTN","BPSOS6M",26,0)
 W "Pharmacy ECME Log of activity for one prescription",!
"RTN","BPSOS6M",27,0)
 ;
"RTN","BPSOS6M",28,0)
 ; Prescription and Transaction Info
"RTN","BPSOS6M",29,0)
 W "Internal Prescription #",$P(REC(1),U,11)
"RTN","BPSOS6M",30,0)
 W "  Fill #",+$P(REC(1),U)
"RTN","BPSOS6M",31,0)
 W !,"VA Prescription #",$$RXAPI1^BPSUTIL1(+$P(REC(1),U,11),.01)
"RTN","BPSOS6M",32,0)
 W !,"Transaction #",IEN59
"RTN","BPSOS6M",33,0)
 ;
"RTN","BPSOS6M",34,0)
 ; Patient
"RTN","BPSOS6M",35,0)
 W !,"Patient: "
"RTN","BPSOS6M",36,0)
 S X=$P(REC(0),U,6) I X]"" S X=$P($G(^DPT(X,0)),U) W X
"RTN","BPSOS6M",37,0)
 ;
"RTN","BPSOS6M",38,0)
 ; Status and Response
"RTN","BPSOS6M",39,0)
 W !!,"Status: "
"RTN","BPSOS6M",40,0)
 S X=$P(REC(0),U,2) W X," (",$$STATI^BPSOSU(X),")"
"RTN","BPSOS6M",41,0)
 I X=99 D DISPRESP
"RTN","BPSOS6M",42,0)
 ;
"RTN","BPSOS6M",43,0)
 ; Transaction Times
"RTN","BPSOS6M",44,0)
 W !!,"Last started on " S X1=$P(REC(0),U,11) I X1]"" W $$DATETIME^BPSOSUD(X1)
"RTN","BPSOS6M",45,0)
 W !,"Last activity on " S X2=$P(REC(0),U,8) I X2]"" W $$DATETIME^BPSOSUD(X2)
"RTN","BPSOS6M",46,0)
 I X1]"",X2]"" W "  Elapsed time: " W $$TIMEDIF^BPSOSUD(X1,X2)
"RTN","BPSOS6M",47,0)
 ;
"RTN","BPSOS6M",48,0)
 ; Claim and Response
"RTN","BPSOS6M",49,0)
 W !!
"RTN","BPSOS6M",50,0)
 S X=$P(REC(0),U,4)
"RTN","BPSOS6M",51,0)
 I X="" W "No entry"
"RTN","BPSOS6M",52,0)
 E  W "See also entry `",X
"RTN","BPSOS6M",53,0)
 W " in file BPS CLAIMS (#9002313.02)",!
"RTN","BPSOS6M",54,0)
 I X]"" D
"RTN","BPSOS6M",55,0)
 . S X=$P(REC(0),U,5)
"RTN","BPSOS6M",56,0)
 . I X="" W "  but there is no entry"
"RTN","BPSOS6M",57,0)
 . E  W "  and entry `",X
"RTN","BPSOS6M",58,0)
 . W " in file BPS RESPONSES (#9002313.03)",!
"RTN","BPSOS6M",59,0)
 ;
"RTN","BPSOS6M",60,0)
 ; Log
"RTN","BPSOS6M",61,0)
 N STOP S STOP=0
"RTN","BPSOS6M",62,0)
 N EXISTS S EXISTS=$$EXISTS^BPSOSL1(IEN59)
"RTN","BPSOS6M",63,0)
 I EXISTS D  Q:$G(STOP)
"RTN","BPSOS6M",64,0)
 . W !,"Log of this claim's activity: ",!
"RTN","BPSOS6M",65,0)
 . I BPSCR S X="" D PAUSE^VALM1 I X="^" S STOP=1 Q
"RTN","BPSOS6M",66,0)
 . D PRINTLOG^BPSOSL1(IEN59,.STOP)
"RTN","BPSOS6M",67,0)
 . I $G(STOP) Q
"RTN","BPSOS6M",68,0)
 . I BPSCR D PRESSANY^BPSOSU5()
"RTN","BPSOS6M",69,0)
 I 'EXISTS D
"RTN","BPSOS6M",70,0)
 . W !,"There is no log for this claim's activity.",!
"RTN","BPSOS6M",71,0)
 . I BPSCR D PRESSANY^BPSOSU5()
"RTN","BPSOS6M",72,0)
 ;
"RTN","BPSOS6M",73,0)
 ; Close Device
"RTN","BPSOS6M",74,0)
 D ^%ZISC
"RTN","BPSOS6M",75,0)
 Q
"RTN","BPSOS6M",76,0)
 ;
"RTN","BPSOS6M",77,0)
 ; Display response info
"RTN","BPSOS6M",78,0)
DISPRESP ;
"RTN","BPSOS6M",79,0)
 N RES
"RTN","BPSOS6M",80,0)
 S RES=$P(REC(2),U)
"RTN","BPSOS6M",81,0)
 I RES=0 D  ; good, go to the claim response and see what it says
"RTN","BPSOS6M",82,0)
 . N RSP D RESPINFO^BPSOSQ4(IEN59,.RSP)
"RTN","BPSOS6M",83,0)
 . W !,"Response Status-Header: ",$G(RSP("HDR"))
"RTN","BPSOS6M",84,0)
 . W !,"Response Status-Prescription: ",$G(RSP("RSP")) ; Payable, Rejected, Captured, Duplicate
"RTN","BPSOS6M",85,0)
 . I $G(RSP("MSG"))]"" W !?10,RSP("MSG")
"RTN","BPSOS6M",86,0)
 . N I F I=1:1:$G(RSP("REJ",0)) W !?10,$G(RSP("REJ",I))
"RTN","BPSOS6M",87,0)
 E  D
"RTN","BPSOS6M",88,0)
 . W !,"Result: ",RES
"RTN","BPSOS6M",89,0)
 . I $P(REC(2),U,2)]"" W " (",$P($P(REC(2),";",1),U,2,$L(REC(2),U)),")"
"RTN","BPSOS6M",90,0)
 Q
"RTN","BPSOS6N")
1^64
"RTN","BPSOS9")
1^65
"RTN","BPSOSA")
1^67
"RTN","BPSOSAA")
1^72
"RTN","BPSOSAB")
1^73
"RTN","BPSOSAD")
1^74
"RTN","BPSOSAM")
1^75
"RTN","BPSOSAN")
1^76
"RTN","BPSOSAO")
1^77
"RTN","BPSOSAP")
1^78
"RTN","BPSOSAQ")
1^79
"RTN","BPSOSAR")
1^80
"RTN","BPSOSAS")
1^81
"RTN","BPSOSAW")
1^82
"RTN","BPSOSAY")
1^83
"RTN","BPSOSB")
1^69
"RTN","BPSOSB3")
1^84
"RTN","BPSOSBB")
1^85
"RTN","BPSOSBC")
1^86
"RTN","BPSOSBD")
1^87
"RTN","BPSOSBF")
1^88
"RTN","BPSOSBM")
1^89
"RTN","BPSOSBP")
1^90
"RTN","BPSOSBQ")
1^91
"RTN","BPSOSBT")
1^92
"RTN","BPSOSBV")
1^93
"RTN","BPSOSBW")
1^94
"RTN","BPSOSBX")
1^95
"RTN","BPSOSC2")
0^5^B29561871
"RTN","BPSOSC2",1,0)
BPSOSC2 ;BHAM ISC/FCS/DRS - certification testing ;06/01/2004
"RTN","BPSOSC2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSC2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSC2",4,0)
 ;
"RTN","BPSOSC2",5,0)
 Q
"RTN","BPSOSC2",6,0)
 ; SETBPS - Overwrite BPS array with values from BPS Certfication file
"RTN","BPSOSC2",7,0)
 ; Input
"RTN","BPSOSC2",8,0)
 ;    ENTRY - IEN for BPS Certification (#9002313.31)
"RTN","BPSOSC2",9,0)
 ; Output
"RTN","BPSOSC2",10,0)
 ;    BPS Array - This is newed in BPSOSCA and is shared by all BPSOSC* routines
"RTN","BPSOSC2",11,0)
 ;                and others
"RTN","BPSOSC2",12,0)
SETBPS(ENTRY) ;
"RTN","BPSOSC2",13,0)
 ;
"RTN","BPSOSC2",14,0)
 I $G(ENTRY)="" Q
"RTN","BPSOSC2",15,0)
 ; If there is a payer in the Certification File, reset transaction header
"RTN","BPSOSC2",16,0)
 ;   values based on this payer sheet
"RTN","BPSOSC2",17,0)
 N XDATA
"RTN","BPSOSC2",18,0)
 I $P(^BPS(9002313.31,ENTRY,0),"^",4) D
"RTN","BPSOSC2",19,0)
 . S BPS("NCPDP","IEN")=$P(^BPS(9002313.31,ENTRY,0),"^",4)
"RTN","BPSOSC2",20,0)
 . S XDATA=$G(^BPSF(9002313.92,BPS("NCPDP","IEN"),1))
"RTN","BPSOSC2",21,0)
 . S BPS("NCPDP","Version")=$P(XDATA,U,2)
"RTN","BPSOSC2",22,0)
 . S BPS("NCPDP","# Meds/Claim")=$P(XDATA,U,3)
"RTN","BPSOSC2",23,0)
 . S BPS("NCPDP","Software Vendor/Cert ID")=$P(XDATA,U,13)
"RTN","BPSOSC2",24,0)
 ;
"RTN","BPSOSC2",25,0)
 ; DMB 11/28/2006 - Existing Code, not sure if this is needed.
"RTN","BPSOSC2",26,0)
 S BPS("Patient","SSN")=""
"RTN","BPSOSC2",27,0)
 ;
"RTN","BPSOSC2",28,0)
 ; Loop through claim header fields
"RTN","BPSOSC2",29,0)
 N A,N S A=0
"RTN","BPSOSC2",30,0)
 F  S A=$O(^BPS(9002313.31,ENTRY,1,A)) Q:'A  D
"RTN","BPSOSC2",31,0)
 . N X S X=^BPS(9002313.31,ENTRY,1,A,0)
"RTN","BPSOSC2",32,0)
 . N FIELD S FIELD=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSC2",33,0)
 . D SETBPS1(FIELD,$P(X,U,2))
"RTN","BPSOSC2",34,0)
 ;
"RTN","BPSOSC2",35,0)
 ; Loop through prescription fields
"RTN","BPSOSC2",36,0)
 S N=0
"RTN","BPSOSC2",37,0)
 F  S N=$O(^BPS(9002313.31,ENTRY,2,N)) Q:'N  D
"RTN","BPSOSC2",38,0)
 . N A S A=0
"RTN","BPSOSC2",39,0)
 . F  S A=$O(^BPS(9002313.31,ENTRY,2,N,1,A)) Q:'A  D
"RTN","BPSOSC2",40,0)
 .. S X=^BPS(9002313.31,ENTRY,2,N,1,A,0)
"RTN","BPSOSC2",41,0)
 .. N FIELD S FIELD=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSC2",42,0)
 .. D SETBPS1(FIELD,$P(X,U,2),N)
"RTN","BPSOSC2",43,0)
 ;
"RTN","BPSOSC2",44,0)
 ; Construct a few other fields that weren't already set
"RTN","BPSOSC2",45,0)
 ; DMB 11/28/2006 - Existing Code, not sure if this is needed.
"RTN","BPSOSC2",46,0)
 S BPS("Patient","Name")=$G(BPS("Patient","Last Name"))_","_$G(BPS("Patient","First Name"))
"RTN","BPSOSC2",47,0)
 I '$D(BPS("RX",1,"Quantity")) S BPS("RX",1,"Quantity")=$G(BPS("RX",1,"Metric Decimal Quantity"))
"RTN","BPSOSC2",48,0)
 Q
"RTN","BPSOSC2",49,0)
 ;
"RTN","BPSOSC2",50,0)
 ; Overwrite BPS array values
"RTN","BPSOSC2",51,0)
SETBPS1(FIELD,VALUE,N) ;
"RTN","BPSOSC2",52,0)
 N OK S OK=0
"RTN","BPSOSC2",53,0)
 N I F I=1:1 Q:$T(TABLE+I)[";;*"  D  Q:OK
"RTN","BPSOSC2",54,0)
 . N X S X=$T(TABLE+I)
"RTN","BPSOSC2",55,0)
 . I $P(X,";",3)'=FIELD Q
"RTN","BPSOSC2",56,0)
 . S @("BPS("_$P(X,";",4)_")=VALUE")
"RTN","BPSOSC2",57,0)
 . S OK=1
"RTN","BPSOSC2",58,0)
 Q
"RTN","BPSOSC2",59,0)
 ;
"RTN","BPSOSC2",60,0)
TABLE ;;
"RTN","BPSOSC2",61,0)
 ;;101;"NCPDP","BIN Number"
"RTN","BPSOSC2",62,0)
 ;;102;"NCPDP","Version"
"RTN","BPSOSC2",63,0)
 ;;103;"Transaction Code"
"RTN","BPSOSC2",64,0)
 ;;104;"NCPDP","PCN"
"RTN","BPSOSC2",65,0)
 ;;109;"Transaction Count"
"RTN","BPSOSC2",66,0)
 ;;110;"NCPDP","Software Vendor/Cert ID"
"RTN","BPSOSC2",67,0)
 ;;111;"NCPDP","Segment Identification"
"RTN","BPSOSC2",68,0)
 ;;201;"Site","Pharmacy #"
"RTN","BPSOSC2",69,0)
 ;;202;"Service Provider ID Qual"
"RTN","BPSOSC2",70,0)
 ;;301;"Insurer","Group #"
"RTN","BPSOSC2",71,0)
 ;;302;"Insurer","Policy #"
"RTN","BPSOSC2",72,0)
 ;;303;"Insurer","Person Code"
"RTN","BPSOSC2",73,0)
 ;;304;"Patient","DOB"
"RTN","BPSOSC2",74,0)
 ;;305;"Patient","Sex"
"RTN","BPSOSC2",75,0)
 ;;306;"Insurer","Relationship"
"RTN","BPSOSC2",76,0)
 ;;308;"Patient","Other Coverage Code"
"RTN","BPSOSC2",77,0)
 ;;307;"Customer Location"
"RTN","BPSOSC2",78,0)
 ;;309;"Eligibility Clarification Code"
"RTN","BPSOSC2",79,0)
 ;;310;"Patient","First Name"
"RTN","BPSOSC2",80,0)
 ;;311;"Patient","Last Name"
"RTN","BPSOSC2",81,0)
 ;;312;"Cardholder","First Name"
"RTN","BPSOSC2",82,0)
 ;;313;"Cardholder","Last Name"
"RTN","BPSOSC2",83,0)
 ;;322;"Patient","Street Address"
"RTN","BPSOSC2",84,0)
 ;;323;"Patient","City"
"RTN","BPSOSC2",85,0)
 ;;324;"Patient","State"
"RTN","BPSOSC2",86,0)
 ;;325;"Patient","Zip"
"RTN","BPSOSC2",87,0)
 ;;331;"Patient","Patient ID Qualifier"
"RTN","BPSOSC2",88,0)
 ;;332;"Patient","SSN"
"RTN","BPSOSC2",89,0)
 ;;326;"Patient","Phone #"
"RTN","BPSOSC2",90,0)
 ;;401;"RX","Date Filled"
"RTN","BPSOSC2",91,0)
 ;;402;"RX",N,"RX Number"
"RTN","BPSOSC2",92,0)
 ;;403;"RX",N,"Refill #"
"RTN","BPSOSC2",93,0)
 ;;404;"RX",N,"Quantity"
"RTN","BPSOSC2",94,0)
 ;;405;"RX",N,"Days Supply"
"RTN","BPSOSC2",95,0)
 ;;406;"RX",N,"Compound Code"
"RTN","BPSOSC2",96,0)
 ;;407;"RX",N,"NDC"
"RTN","BPSOSC2",97,0)
 ;;408;"RX",N,"DAW"
"RTN","BPSOSC2",98,0)
 ;;409;"RX",N,"Ingredient Cost"
"RTN","BPSOSC2",99,0)
 ;;410;"RX",N,"Sales Tax"
"RTN","BPSOSC2",100,0)
 ;;411;"RX",N,"Prescriber ID"
"RTN","BPSOSC2",101,0)
 ;;412;"RX",N,"Dispensing Fee"
"RTN","BPSOSC2",102,0)
 ;;414;"RX",N,"Date Written"
"RTN","BPSOSC2",103,0)
 ;;415;"RX",N,"# Refills"
"RTN","BPSOSC2",104,0)
 ;;416;"RX",N,"Preauth #"
"RTN","BPSOSC2",105,0)
 ;;418;"RX",N,"Level of Service"
"RTN","BPSOSC2",106,0)
 ;;419;"RX",N,"Origin Code"
"RTN","BPSOSC2",107,0)
 ;;420;"RX",N,"Clarification"
"RTN","BPSOSC2",108,0)
 ;;421;"RX",N,"Primary Prescriber"
"RTN","BPSOSC2",109,0)
 ;;422;"RX",N,"Clinic ID"
"RTN","BPSOSC2",110,0)
 ;;423;"RX",N,"Basis of Cost Determination"
"RTN","BPSOSC2",111,0)
 ;;424;"RX",N,"Diagnosis Code"
"RTN","BPSOSC2",112,0)
 ;;426;"RX",N,"Usual & Customary"
"RTN","BPSOSC2",113,0)
 ;;427;"RX",N,"Prescriber Last Name"
"RTN","BPSOSC2",114,0)
 ;;429;"RX",N,"Unit Dose Indicator"
"RTN","BPSOSC2",115,0)
 ;;430;"RX",N,"Gross Amount Due"
"RTN","BPSOSC2",116,0)
 ;;431;"RX",N,"Other Payor Amount"
"RTN","BPSOSC2",117,0)
 ;;433;"RX",N,"Patient Paid Amount"
"RTN","BPSOSC2",118,0)
 ;;436;"RX",N,"Alt. Product Type"
"RTN","BPSOSC2",119,0)
 ;;438;"RX",N,"Incentive Amount"
"RTN","BPSOSC2",120,0)
 ;;439;"RX",N,"DUR","DUR Conflict Code",439
"RTN","BPSOSC2",121,0)
 ;;440;"RX",N,"DUR","DUR Intervention Code",440
"RTN","BPSOSC2",122,0)
 ;;441;"RX",N,"DUR","DUR Outcome Code",441
"RTN","BPSOSC2",123,0)
 ;;442;"RX",N,"Metric Decimal Quantity"
"RTN","BPSOSC2",124,0)
 ;;443;"RX",N,"Primary Payor Denial Date"
"RTN","BPSOSC2",125,0)
 ;;444;"RX",N,"Provider ID"
"RTN","BPSOSC2",126,0)
 ;;455;"RX",N,"Rx/Service Ref Num Qual"
"RTN","BPSOSC2",127,0)
 ;;460;"RX",N,"Quantity"
"RTN","BPSOSC2",128,0)
 ;;461;"Claim",N,"Prior Auth Type"
"RTN","BPSOSC2",129,0)
 ;;462;"Claim",N,"Prior Auth Num Sub"
"RTN","BPSOSC2",130,0)
 ;;465;"RX",N,"Provider ID"
"RTN","BPSOSC2",131,0)
 ;;466;"RX",N,"Prescriber ID Qualifier"
"RTN","BPSOSC2",132,0)
 ;;467;"RX",N,"Prescriber Location Code"
"RTN","BPSOSC2",133,0)
 ;;468;"RX",N,"Primary Care Prov ID Qual"
"RTN","BPSOSC2",134,0)
 ;;469;"RX",N,"Primary Care Prov ID"
"RTN","BPSOSC2",135,0)
 ;;470;"RX",N,"Primary Care Prov Last Name"
"RTN","BPSOSC2",136,0)
 ;;473;"RX",N,"DUR","DUR/PPS CODE COUNTER",473
"RTN","BPSOSC2",137,0)
 ;;478;"Insurer","Other Amt Claim Sub Cnt"
"RTN","BPSOSC2",138,0)
 ;;479;"Insurer","Other Amt Claim Sub Qual"
"RTN","BPSOSC2",139,0)
 ;;480;"Insurer","Other Amt Claim Submitted"
"RTN","BPSOSC2",140,0)
 ;;481;"Insurer","Flat Sales Tax Amt Sub"
"RTN","BPSOSC2",141,0)
 ;;482;"Insurer","Percentage Sales Tax Amt Sub"
"RTN","BPSOSC2",142,0)
 ;;483;"Insurer","Percent Sales Tax Rate Sub"
"RTN","BPSOSC2",143,0)
 ;;484;"Insurer","Percent Sales Tax Basis Sub"
"RTN","BPSOSC2",144,0)
 ;;498;"RX",N,"Prescriber Phone #"
"RTN","BPSOSC2",145,0)
 ;;*
"RTN","BPSOSC3")
1^96
"RTN","BPSOSCA")
0^166^B9099682
"RTN","BPSOSCA",1,0)
BPSOSCA ;BHAM ISC/FCS/DRS - Create BPS Claims entries ;06/01/2004
"RTN","BPSOSCA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSCA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCA",4,0)
 ;
"RTN","BPSOSCA",5,0)
 Q
"RTN","BPSOSCA",6,0)
 ; Create BPS Claims entries for RXILIST(*) claims.
"RTN","BPSOSCA",7,0)
 ; Called from PACKET^BPSOSQG
"RTN","BPSOSCA",8,0)
 ;
"RTN","BPSOSCA",9,0)
 ; Input:
"RTN","BPSOSCA",10,0)
 ;      RXILIST(IEN59) - Array of pointers to 9002313.59
"RTN","BPSOSCA",11,0)
 ;         A list of prescriptions for the same visit/patient/etc.
"RTN","BPSOSCA",12,0)
 ;         to be bundled into one or more 9002313.02 claims
"RTN","BPSOSCA",13,0)
 ;
"RTN","BPSOSCA",14,0)
 ; Outputs:
"RTN","BPSOSCA",15,0)
 ;      CLAIMIEN(CLAIMIEN)="", pointers to the ^BPSC(CLAIMIEN,
"RTN","BPSOSCA",16,0)
 ;                             claim records created.
"RTN","BPSOSCA",17,0)
 ;      ERROR
"RTN","BPSOSCA",18,0)
 ;
"RTN","BPSOSCA",19,0)
 ; BPSOSCA calls:
"RTN","BPSOSCA",20,0)
 ;   BPSOSCB to build BPS(*) array
"RTN","BPSOSCA",21,0)
 ;      (and BPSOSCB calls BPSOSCC and BPSOSCD)
"RTN","BPSOSCA",22,0)
 ;   BPSOSCE to build the ^BPSC( entry
"RTN","BPSOSCA",23,0)
 ;
"RTN","BPSOSCA",24,0)
EN(CLAIMIEN) ;EP - from BPSOSQG
"RTN","BPSOSCA",25,0)
 I $D(RXILIST)<10  D  Q "306^No RXILIST defined"
"RTN","BPSOSCA",26,0)
 . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","Bad RXILIST",,,$T(+0))
"RTN","BPSOSCA",27,0)
 . D LOG2LIST^BPSOSL($T(+0)_"-No RXILIST passed into BPSOSCA")
"RTN","BPSOSCA",28,0)
 ;
"RTN","BPSOSCA",29,0)
 ; Manage local variables
"RTN","BPSOSCA",30,0)
 N BPS,START,END,TOTAL,NCLAIMS,CLAIMN,ERROR
"RTN","BPSOSCA",31,0)
 S ERROR=$$BPS^BPSOSCB()
"RTN","BPSOSCA",32,0)
 I ERROR D LOG2LIST^BPSOSL($T(+0)_"-$$BPS^BPSOSCB(.BPS) returned "_ERROR)
"RTN","BPSOSCA",33,0)
 I $G(BPS("RX",0))="" S:'ERROR ERROR="301^BPS(""RX"" not created" Q ERROR
"RTN","BPSOSCA",34,0)
 I $G(BPS("NCPDP","# Meds/Claim"))="" Q "302^Number of Meds not returned"
"RTN","BPSOSCA",35,0)
 ;
"RTN","BPSOSCA",36,0)
 ; Calculate number of claim records to be generated for Billing Item
"RTN","BPSOSCA",37,0)
 S NCLAIMS=((BPS("RX",0)-1)\BPS("NCPDP","# Meds/Claim"))+1
"RTN","BPSOSCA",38,0)
 I NCLAIMS=0 Q "303^Number of claims is zero"
"RTN","BPSOSCA",39,0)
 ;
"RTN","BPSOSCA",40,0)
 ;Generate claim submission records
"RTN","BPSOSCA",41,0)
 F CLAIMN=1:1:NCLAIMS D  Q:$G(ERROR)
"RTN","BPSOSCA",42,0)
 . S START=((CLAIMN-1)*BPS("NCPDP","# Meds/Claim"))+1
"RTN","BPSOSCA",43,0)
 . S END=START+BPS("NCPDP","# Meds/Claim")-1
"RTN","BPSOSCA",44,0)
 . S:END>BPS("RX",0) END=BPS("RX",0)
"RTN","BPSOSCA",45,0)
 . S TOTAL=END-START+1
"RTN","BPSOSCA",46,0)
 . S ERROR=$$NEWCLAIM^BPSOSCE(START,END,TOTAL)
"RTN","BPSOSCA",47,0)
 . I ERROR]"" Q
"RTN","BPSOSCA",48,0)
 . S CLAIMIEN=BPS(9002313.02)
"RTN","BPSOSCA",49,0)
 . S CLAIMIEN(CLAIMIEN)=""
"RTN","BPSOSCA",50,0)
 . ; Mark each of the .59s with the claim number and position within
"RTN","BPSOSCA",51,0)
 . F I=START:1:END D
"RTN","BPSOSCA",52,0)
 .. ;
"RTN","BPSOSCA",53,0)
 .. ; IEN59 handling 06/23/2000. The ELSE should never happen again.
"RTN","BPSOSCA",54,0)
 .. ; and the $G() can probably be gotten rid of, safely.
"RTN","BPSOSCA",55,0)
 .. N IEN59 S IEN59=$G(BPS("RX",I,"IEN59"))
"RTN","BPSOSCA",56,0)
 .. I IEN59 D
"RTN","BPSOSCA",57,0)
 ... N DIE,DA,DR S DIE=9002313.59
"RTN","BPSOSCA",58,0)
 ... ;
"RTN","BPSOSCA",59,0)
 ... ; Field #3-CLAIM, #14-POSITION
"RTN","BPSOSCA",60,0)
 ... ; POSITION:  Not the relative position within the packet,
"RTN","BPSOSCA",61,0)
 ... ; but the index in BPS("RX",n,....  This is the position in which
"RTN","BPSOSCA",62,0)
 ... ; it will be stored in ^BPSC(ien,400,POSITION
"RTN","BPSOSCA",63,0)
 ... ; and likewise for 9002313.03 when the response comes in.
"RTN","BPSOSCA",64,0)
 ... S DA=IEN59,DR=3_"////"_CLAIMIEN_";14////"_I N I D ^DIE
"RTN","BPSOSCA",65,0)
 .. E  D
"RTN","BPSOSCA",66,0)
 ... S $P(^BPST(BPS("RX",I,"RX IEN"),0),"^",4)=CLAIMIEN
"RTN","BPSOSCA",67,0)
 ... S ^BPST("AE",CLAIMIEN,BPS("RX",I,"RX IEN"))=""
"RTN","BPSOSCA",68,0)
 ... S $P(^BPST(BPS("RX",I,"RX IEN"),0),"^",9)=I
"RTN","BPSOSCA",69,0)
 Q ERROR
"RTN","BPSOSCB")
0^167^B2743656
"RTN","BPSOSCB",1,0)
BPSOSCB ;BHAM ISC/FCS/DRS/DLF - Prep for building BPS array ;06/01/2004
"RTN","BPSOSCB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSCB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCB",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",5,0)
 ; Called from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSOSCB",6,0)
 ; Setup BPS() array which contains all pertinent data to create
"RTN","BPSOSCB",7,0)
 ;   claim Submission Records for the current Billing Item Record:
"RTN","BPSOSCB",8,0)
 ;
"RTN","BPSOSCB",9,0)
 ; Input:
"RTN","BPSOSCB",10,0)
 ;   RXILIST needs to be defined - List of Transactions
"RTN","BPSOSCB",11,0)
 ; Returns
"RTN","BPSOSCB",12,0)
 ;   BPS    Formatted array containing data required to create claim
"RTN","BPSOSCB",13,0)
 ;             submission records.  This array is shared by all BPSOSC*
"RTN","BPSOSCB",14,0)
 ;             routines and some of the BPSOSH routines as well.
"RTN","BPSOSCB",15,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",16,0)
 ;
"RTN","BPSOSCB",17,0)
 Q
"RTN","BPSOSCB",18,0)
BPS() ;
"RTN","BPSOSCB",19,0)
 N IEN59,IEN5902,INDEX,ENTRY,VAINFO
"RTN","BPSOSCB",20,0)
 ;
"RTN","BPSOSCB",21,0)
 ; Set up some basic variables from first transaction
"RTN","BPSOSCB",22,0)
 S IEN59=$O(RXILIST(""))
"RTN","BPSOSCB",23,0)
 I IEN59="" Q "320^BPS Transaction not found in RXILIST"
"RTN","BPSOSCB",24,0)
 ;
"RTN","BPSOSCB",25,0)
 S IEN5902=$P(^BPST(IEN59,9),U,1)
"RTN","BPSOSCB",26,0)
 I IEN5902="" Q "321^VA Insurer not determined"
"RTN","BPSOSCB",27,0)
 ;
"RTN","BPSOSCB",28,0)
 ; Set transaction multiple into VAINFO array and get top node of multiple
"RTN","BPSOSCB",29,0)
 D GETS^DIQ(9002313.59,IEN59_",","902*","I","VAINFO")
"RTN","BPSOSCB",30,0)
 ;
"RTN","BPSOSCB",31,0)
 ; Set up BPS array for Patient, Insurer, Site and NCPDP record format data
"RTN","BPSOSCB",32,0)
 D GETINFO^BPSOSCC(IEN59,IEN5902)
"RTN","BPSOSCB",33,0)
 ;
"RTN","BPSOSCB",34,0)
 ; Get medication and prescription data for each medication
"RTN","BPSOSCB",35,0)
 S IEN59=""
"RTN","BPSOSCB",36,0)
 F INDEX=1:1 S IEN59=$O(RXILIST(IEN59)) Q:'IEN59  D
"RTN","BPSOSCB",37,0)
 . S IEN5902=$P(^BPST(IEN59,9),U,1)
"RTN","BPSOSCB",38,0)
 . D MEDINFO^BPSOSCD(IEN59,IEN5902,INDEX)
"RTN","BPSOSCB",39,0)
 ;
"RTN","BPSOSCB",40,0)
 ; Set up BPS("RX",0)
"RTN","BPSOSCB",41,0)
 S BPS("RX",0)=INDEX-1
"RTN","BPSOSCB",42,0)
 I BPS("RX",0)=0 Q "322^No claims in RXILIST"
"RTN","BPSOSCB",43,0)
 ;
"RTN","BPSOSCB",44,0)
 ; If certification, get certification overrides
"RTN","BPSOSCB",45,0)
 S IEN59=$O(RXILIST("")),IEN5902=$P(^BPST(IEN59,9),U,1)
"RTN","BPSOSCB",46,0)
 S ENTRY=$$GET1^DIQ(9002313.59902,IEN5902_","_IEN59_",",902.23,"I")
"RTN","BPSOSCB",47,0)
 I ENTRY,$D(^BPS(9002313.31,ENTRY)) D SETBPS^BPSOSC2(ENTRY)
"RTN","BPSOSCB",48,0)
 ;
"RTN","BPSOSCB",49,0)
 ; Quit with no error
"RTN","BPSOSCB",50,0)
 Q 0
"RTN","BPSOSCC")
0^168^B24314564
"RTN","BPSOSCC",1,0)
BPSOSCC ;BHAM ISC/FCS/DRS/DLF - Set up BPS() ;06/01/2004
"RTN","BPSOSCC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSOSCC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCC",4,0)
 ;
"RTN","BPSOSCC",5,0)
 ; GETINFO - Create BPS array for non-repeating data
"RTN","BPSOSCC",6,0)
 ;    IEN59  - Pointer to BPS Transactions
"RTN","BPSOSCC",7,0)
 ;    IEN5902 - IEN for Insurance multiple of BPS Transactions
"RTN","BPSOSCC",8,0)
 ;
"RTN","BPSOSCC",9,0)
 ; Note that the BPS array is shared by all of the BPSOSC* routines and
"RTN","BPSOSCC",10,0)
 ;  is newed by BPSOSCA
"RTN","BPSOSCC",11,0)
 ; Note that VAINFO is newed/set in BPSOSCB
"RTN","BPSOSCC",12,0)
 Q
"RTN","BPSOSCC",13,0)
GETINFO(IEN59,IEN5902) ; EP - BPSOSCB
"RTN","BPSOSCC",14,0)
 ; Check parameters
"RTN","BPSOSCC",15,0)
 I $G(IEN59)="" Q
"RTN","BPSOSCC",16,0)
 I $G(IEN5902)="" Q
"RTN","BPSOSCC",17,0)
 ;
"RTN","BPSOSCC",18,0)
 ; New variables and parse parameter data
"RTN","BPSOSCC",19,0)
 N RXIEN,IENS,XDATA,PHARMACY,DFN,VAPA,VADM,SITE,NPI
"RTN","BPSOSCC",20,0)
 ;
"RTN","BPSOSCC",21,0)
 ; Setup Prescription IEN and IENS for transaction multiple
"RTN","BPSOSCC",22,0)
 S RXIEN=$P(IEN59,".",1)
"RTN","BPSOSCC",23,0)
 S IENS=IEN5902_","_IEN59_","
"RTN","BPSOSCC",24,0)
 ;
"RTN","BPSOSCC",25,0)
 ; Site Information
"RTN","BPSOSCC",26,0)
 S PHARMACY=$P(^BPST(IEN59,1),U,7)
"RTN","BPSOSCC",27,0)
 S XDATA=^BPS(9002313.56,PHARMACY,0)
"RTN","BPSOSCC",28,0)
 S BPS("Site","NABP #")=$P(XDATA,U,2)
"RTN","BPSOSCC",29,0)
 S BPS("Site","Default DEA #")=$P(XDATA,U,3)
"RTN","BPSOSCC",30,0)
 S BPS("Site","Medicaid Pharmacy #")="" ; Referenced in payer sheet special code
"RTN","BPSOSCC",31,0)
 S BPS("Site","Pharmacy #")=BPS("Site","NABP #")
"RTN","BPSOSCC",32,0)
 S SITE=$P($G(^BPST(IEN59,1)),U,4)
"RTN","BPSOSCC",33,0)
 S NPI=$$NPI^BPSNPI("Pharmacy_ID",SITE)
"RTN","BPSOSCC",34,0)
 I +NPI=-1 S NPI=""
"RTN","BPSOSCC",35,0)
 S BPS("Site","NPI")=$P(NPI,U,1)
"RTN","BPSOSCC",36,0)
 ;
"RTN","BPSOSCC",37,0)
 ; Transaction Header Data
"RTN","BPSOSCC",38,0)
 S BPS("NCPDP","IEN")=$G(VAINFO(9002313.59902,IENS,902.02,"I"))
"RTN","BPSOSCC",39,0)
 S BPS("NCPDP","BIN Number")=$G(VAINFO(9002313.59902,IENS,902.03,"I"))
"RTN","BPSOSCC",40,0)
 S BPS("NCPDP","PCN")=$G(VAINFO(9002313.59902,IENS,902.04,"I"))
"RTN","BPSOSCC",41,0)
 I BPS("NCPDP","IEN")="" D IMPOSS^BPSOSUE("P","TI","Payer Sheet pointer missing from multiple",,1,$T(+0))
"RTN","BPSOSCC",42,0)
 I BPS("NCPDP","IEN") S XDATA=$G(^BPSF(9002313.92,BPS("NCPDP","IEN"),1))
"RTN","BPSOSCC",43,0)
 I XDATA="" D IMPOSS^BPSOSUE("DB","TI","VA - Payer sheet info missing.",,2,$T(+0))
"RTN","BPSOSCC",44,0)
 I BPS("NCPDP","BIN Number")="" S BPS("NCPDP","BIN Number")=$P(XDATA,U,1)
"RTN","BPSOSCC",45,0)
 S BPS("NCPDP","Version")=$P(XDATA,U,2)
"RTN","BPSOSCC",46,0)
 S BPS("NCPDP","# Meds/Claim")=$P(XDATA,U,3)
"RTN","BPSOSCC",47,0)
 S BPS("NCPDP","Software Vendor/Cert ID")=$G(VAINFO(9002313.59902,IENS,902.18,"I"))
"RTN","BPSOSCC",48,0)
 ;
"RTN","BPSOSCC",49,0)
 ; Patient Data
"RTN","BPSOSCC",50,0)
 S DFN=$P(^BPST(IEN59,0),U,6)
"RTN","BPSOSCC",51,0)
 I 'DFN D IMPOSS^BPSOSUE("DB","TI","DFN",,,$T(+0))
"RTN","BPSOSCC",52,0)
 I DFN,'$D(^DPT(DFN,0)) D IMPOSS^BPSOSUE("DB","TI","^DPT(DFN)",,,$T(+0))
"RTN","BPSOSCC",53,0)
 D DEM^VADPT,ADD^VADPT
"RTN","BPSOSCC",54,0)
 S BPS("Patient","IEN")=DFN
"RTN","BPSOSCC",55,0)
 S BPS("Patient","Name")=$G(VADM(1))
"RTN","BPSOSCC",56,0)
 S BPS("Patient","Sex")=$P($G(VADM(5)),"^",1)
"RTN","BPSOSCC",57,0)
 S BPS("Patient","DOB")=$P($G(VADM(3)),"^",1)
"RTN","BPSOSCC",58,0)
 S BPS("Patient","DOB")=($E(BPS("Patient","DOB"),1,3)+1700)_$E(BPS("Patient","DOB"),4,7)
"RTN","BPSOSCC",59,0)
 S BPS("Patient","SSN")=$P($G(VADM(2)),"^",1)
"RTN","BPSOSCC",60,0)
 S BPS("Patient","State")=$P($G(VAPA(5)),"^",1)
"RTN","BPSOSCC",61,0)
 I BPS("Patient","State")'="" S BPS("Patient","State")=$P($G(^DIC(5,BPS("Patient","State"),0)),"^",2)
"RTN","BPSOSCC",62,0)
 S BPS("Patient","Street Address")=$G(VAPA(1))
"RTN","BPSOSCC",63,0)
 S BPS("Patient","City")=$G(VAPA(4))
"RTN","BPSOSCC",64,0)
 S BPS("Patient","Zip")=$G(VAPA(6))
"RTN","BPSOSCC",65,0)
 S BPS("Patient","Phone #")=$TR($P($G(VAPA(8)),"^",1),"()-/*# ")
"RTN","BPSOSCC",66,0)
 S BPS("Patient","Plan ID")=$$GET1^DIQ(2.312,"1,"_DFN_",",.18)
"RTN","BPSOSCC",67,0)
 ;
"RTN","BPSOSCC",68,0)
 ; Insurer Data
"RTN","BPSOSCC",69,0)
 S BPS("Insurer","IEN")=$G(VAINFO(9002313.59902,IENS,.01,"I"))
"RTN","BPSOSCC",70,0)
 S BPS("Insurer","Relationship")=$G(VAINFO(9002313.59902,IENS,902.07,"I"))
"RTN","BPSOSCC",71,0)
 S BPS("Insurer","Administrative Fee")=$G(VAINFO(9002313.59902,IENS,902.16,"I"))
"RTN","BPSOSCC",72,0)
 I BPS("Insurer","Administrative Fee")'="",BPS("Insurer","Administrative Fee")'=0 S BPS("Insurer","Other Amt Claim Sub Qual")="04"
"RTN","BPSOSCC",73,0)
 E  S BPS("Insurer","Other Amt Claim Sub Qual")=""
"RTN","BPSOSCC",74,0)
 I BPS("Insurer","Relationship")="" S BPS("Insurer","Relationship")=0 ;if not there, mark it as unspecified.
"RTN","BPSOSCC",75,0)
 S BPS("Patient","Primary Care Prov Location Code")=$G(VAINFO(9002313.59902,IENS,902.11,"I"))
"RTN","BPSOSCC",76,0)
 S BPS("Insurer","Person Code")=$S(BPS("Insurer","Relationship")=1:"01",BPS("Insurer","Relationship")=2:"02",BPS("Insurer","Relationship")=3:03,1:"")
"RTN","BPSOSCC",77,0)
 S BPS("Insurer","Group #")=$G(VAINFO(9002313.59902,IENS,902.05,"I"))
"RTN","BPSOSCC",78,0)
 S BPS("Insurer","Policy #")=$G(VAINFO(9002313.59902,IENS,902.06,"I"))  ;CARDHOLDER ID
"RTN","BPSOSCC",79,0)
 S BPS("Insurer","Full Policy #")=BPS("Insurer","Policy #")
"RTN","BPSOSCC",80,0)
 S:'$D(BPS("Insurer","Percent Sales Tax Rate Sub")) BPS("Insurer","Percent Sales Tax Rate Sub")=""
"RTN","BPSOSCC",81,0)
 S:'$D(BPS("Insurer","Percent Sales Tax Basis Sub")) BPS("Insurer","Percent Sales Tax Basis Sub")=""
"RTN","BPSOSCC",82,0)
 S BPS("Insurer","Percentage Sales Tax Amt Sub")=0
"RTN","BPSOSCC",83,0)
 S BPS("Insurer","Flat Sales Tax Amount Sub")=0
"RTN","BPSOSCC",84,0)
 ;
"RTN","BPSOSCC",85,0)
 ; DMB - The next pair of lines may seem odd.  However, there was an error in the IHS code, so
"RTN","BPSOSCC",86,0)
 ;   this array element was always set to "".  I fixed the code, but do not want to implement the fix
"RTN","BPSOSCC",87,0)
 ;   until it can be determined whether the fix will not cause rejects
"RTN","BPSOSCC",88,0)
 S BPS("Insurer","Facility ID")=$$RXAPI1^BPSUTIL1(RXIEN,5,"E")
"RTN","BPSOSCC",89,0)
 S BPS("Insurer","Facility ID")=""
"RTN","BPSOSCC",90,0)
 ;
"RTN","BPSOSCC",91,0)
 ; Cardholder Data
"RTN","BPSOSCC",92,0)
 S BPS("Cardholder","First Name")=$G(VAINFO(9002313.59902,IENS,902.08,"I"))
"RTN","BPSOSCC",93,0)
 S BPS("Cardholder","Last Name")=$G(VAINFO(9002313.59902,IENS,902.09,"I"))
"RTN","BPSOSCC",94,0)
 S BPS("Home Plan")=$G(VAINFO(9002313.59902,IENS,902.11,"I"))
"RTN","BPSOSCC",95,0)
 Q
"RTN","BPSOSCD")
0^18^B38448977
"RTN","BPSOSCD",1,0)
BPSOSCD ;BHAM ISC/FCS/DRS/DLF - Set BPS() "RX" nodes for current medication ;06/01/2004
"RTN","BPSOSCD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSOSCD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCD",4,0)
 ;
"RTN","BPSOSCD",5,0)
 Q
"RTN","BPSOSCD",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",7,0)
 ;Set BPS() "RX" nodes for current medication:
"RTN","BPSOSCD",8,0)
 ;
"RTN","BPSOSCD",9,0)
 ;Parameters:   IEN59   - Pointer to BPS Transactions
"RTN","BPSOSCD",10,0)
 ;              IEN5902 - IEN for Insurance multiple of BPS Transactions
"RTN","BPSOSCD",11,0)
 ;              MEDN    - Index number indicating what medication is
"RTN","BPSOSCD",12,0)
 ;                        being processed
"RTN","BPSOSCD",13,0)
 ;
"RTN","BPSOSCD",14,0)
 ; Note that the BPS array is shared by all of the BPSOSC* routines and
"RTN","BPSOSCD",15,0)
 ;  is newed by BPSOSCA
"RTN","BPSOSCD",16,0)
 ; Note that VAINFO is newed/set in BPSOSCB
"RTN","BPSOSCD",17,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",18,0)
 ; Called from BPSOSCA for every prescription in the multiple
"RTN","BPSOSCD",19,0)
MEDINFO(IEN59,IEN5902,MEDN) ;
"RTN","BPSOSCD",20,0)
 ; Verify Parameters
"RTN","BPSOSCD",21,0)
 I $G(IEN59)="" Q
"RTN","BPSOSCD",22,0)
 I $G(IEN5902)="" Q
"RTN","BPSOSCD",23,0)
 I $G(MEDN)="" Q
"RTN","BPSOSCD",24,0)
 ;
"RTN","BPSOSCD",25,0)
 ; New variables and basic setup
"RTN","BPSOSCD",26,0)
 N RXIEN,RXRFIEN,IENS,DRUGIEN,PROVIEN,RXI,FILLDT,NDC,NPI
"RTN","BPSOSCD",27,0)
 S RXIEN=$P(IEN59,".",1)
"RTN","BPSOSCD",28,0)
 S RXRFIEN=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSCD",29,0)
 S IENS=IEN5902_","_IEN59_","
"RTN","BPSOSCD",30,0)
 ;
"RTN","BPSOSCD",31,0)
 ; Get any user-entered overrides stored in BPS NCPDP OVERRIDES
"RTN","BPSOSCD",32,0)
 D OVERRIDE(IEN59,MEDN)
"RTN","BPSOSCD",33,0)
 ;
"RTN","BPSOSCD",34,0)
 ; Retrieve DUR values
"RTN","BPSOSCD",35,0)
 D DURVALUE(IEN59,MEDN)
"RTN","BPSOSCD",36,0)
 ;
"RTN","BPSOSCD",37,0)
 ; Get Drug and Prescriber IEN
"RTN","BPSOSCD",38,0)
 S DRUGIEN=$$RXAPI1^BPSUTIL1(RXIEN,6,"I")
"RTN","BPSOSCD",39,0)
 S PROVIEN=$$RXAPI1^BPSUTIL1(RXIEN,4,"I")
"RTN","BPSOSCD",40,0)
 ;
"RTN","BPSOSCD",41,0)
 ; Basic RX info
"RTN","BPSOSCD",42,0)
 S BPS("RX",MEDN,"IEN59")=IEN59
"RTN","BPSOSCD",43,0)
 S BPS("RX",MEDN,"RX IEN")=RXIEN
"RTN","BPSOSCD",44,0)
 S BPS("RX",MEDN,"RX Number")=RXIEN
"RTN","BPSOSCD",45,0)
 S BPS("RX",MEDN,"Date Written")=$$RXAPI1^BPSUTIL1(RXIEN,1,"I")
"RTN","BPSOSCD",46,0)
 S BPS("RX",MEDN,"New/Refill")=$S(RXRFIEN="":"N",1:"R")
"RTN","BPSOSCD",47,0)
 ;
"RTN","BPSOSCD",48,0)
 ; Get/format the Service Date - It should be in BPS Transaction.  If not,
"RTN","BPSOSCD",49,0)
 ;   use the established algorithm, which is $$DOSDATE^BPSSCRRS
"RTN","BPSOSCD",50,0)
 S FILLDT=$P($G(^BPST(IEN59,12)),U,2)
"RTN","BPSOSCD",51,0)
 I FILLDT="" S FILLDT=$$DOSDATE^BPSSCRRS(RXIEN,RXRFIEN) D LOG^BPSOSL(IEN59,$T(+0)_"-Fill Date sent as "_FILLDT)
"RTN","BPSOSCD",52,0)
 S BPS("RX",MEDN,"Date Filled")=$$FMTHL7^XLFDT(FILLDT)
"RTN","BPSOSCD",53,0)
 ;
"RTN","BPSOSCD",54,0)
 ; PreAuth and Prior Auth (use same fields)
"RTN","BPSOSCD",55,0)
 S BPS("RX",MEDN,"Preauth #")=$P(^BPST(IEN59,1),U,15)_$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",56,0)
 S BPS("Claim",MEDN,"Prior Auth Type")=$P(^BPST(IEN59,1),U,15)
"RTN","BPSOSCD",57,0)
 S BPS("Claim",MEDN,"Prior Auth Num Sub")=$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",58,0)
 ;
"RTN","BPSOSCD",59,0)
 ; NDC - Get from transaction first.  If not there (which should not happen),
"RTN","BPSOSCD",60,0)
 ;   get it from the RX/Fill
"RTN","BPSOSCD",61,0)
 S NDC=$P(^BPST(IEN59,1),U,2)
"RTN","BPSOSCD",62,0)
 I NDC="" S NDC=$$GETNDC^PSONDCUT(RXIEN,RXRFIEN) D LOG^BPSOSL(IEN59,$T(+0)_"-NDC sent as "_NDC)
"RTN","BPSOSCD",63,0)
 S BPS("RX",MEDN,"NDC")=NDC
"RTN","BPSOSCD",64,0)
 ;
"RTN","BPSOSCD",65,0)
 ; Prescription Data
"RTN","BPSOSCD",66,0)
 S BPS("RX",MEDN,"# Refills")=$$RXAPI1^BPSUTIL1(RXIEN,9,"I")
"RTN","BPSOSCD",67,0)
 S BPS("RX",MEDN,"Refill #")=+RXRFIEN
"RTN","BPSOSCD",68,0)
 ;
"RTN","BPSOSCD",69,0)
 ; Prescription Data dependent on original vs. refill
"RTN","BPSOSCD",70,0)
 I 'RXRFIEN D  ; first fill
"RTN","BPSOSCD",71,0)
 . S BPS("RX",MEDN,"Days Supply")=$$RXAPI1^BPSUTIL1(RXIEN,8,"I")
"RTN","BPSOSCD",72,0)
 . S BPS("RX",MEDN,"DAW")=$$RXAPI1^BPSUTIL1(RXIEN,81,"I")
"RTN","BPSOSCD",73,0)
 E  D  ; refill
"RTN","BPSOSCD",74,0)
 . S BPS("RX",MEDN,"Days Supply")=$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,+RXRFIEN,1.1,"I")
"RTN","BPSOSCD",75,0)
 . S BPS("RX",MEDN,"DAW")=$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,+RXRFIEN,81,"I")
"RTN","BPSOSCD",76,0)
 ;
"RTN","BPSOSCD",77,0)
 ; Provider Info
"RTN","BPSOSCD",78,0)
 S BPS("RX",MEDN,"Prescriber IEN")=+PROVIEN
"RTN","BPSOSCD",79,0)
 I PROVIEN'="" D
"RTN","BPSOSCD",80,0)
 . S BPS("RX",MEDN,"Prescriber Name")=$$GET1^DIQ(200,+PROVIEN,.01)
"RTN","BPSOSCD",81,0)
 . S BPS("RX",MEDN,"Prescriber Phone #")=$$GET1^DIQ(200,+PROVIEN,.131)
"RTN","BPSOSCD",82,0)
 . I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S BPS("RX",MEDN,"Prescriber DEA #")=$G(BPS("RX",1,"Provider ID"))
"RTN","BPSOSCD",83,0)
 . S BPS("RX",MEDN,"Prescriber DEA #")=$$GET1^DIQ(200,+PROVIEN,53.2)
"RTN","BPSOSCD",84,0)
 . S BPS("RX",MEDN,"Prescriber CAID #")=""
"RTN","BPSOSCD",85,0)
 . S BPS("RX",MEDN,"Prescriber UPIN #")=""
"RTN","BPSOSCD",86,0)
 . S BPS("RX",MEDN,"Prescriber Billing Location")=""
"RTN","BPSOSCD",87,0)
 . S NPI=$$NPI^BPSNPI("Individual_ID",+PROVIEN)
"RTN","BPSOSCD",88,0)
 . I +NPI=-1 S NPI=""
"RTN","BPSOSCD",89,0)
 . S BPS("RX",MEDN,"Prescriber NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",90,0)
 . S BPS("RX",MEDN,"Primary Care Provider NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",91,0)
 . S BPS("RX",MEDN,"Provider NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",92,0)
 ;
"RTN","BPSOSCD",93,0)
 ; Set Prescriber ID field to individual DEA if it exists, else default DEA
"RTN","BPSOSCD",94,0)
 N %
"RTN","BPSOSCD",95,0)
 S %=$G(BPS("RX",MEDN,"Prescriber DEA #"))
"RTN","BPSOSCD",96,0)
 I %="" S %=$G(BPS("Site","Default DEA #"))
"RTN","BPSOSCD",97,0)
 S BPS("RX",MEDN,"Prescriber ID")=%
"RTN","BPSOSCD",98,0)
 ;
"RTN","BPSOSCD",99,0)
 ; Get State IDs for providers
"RTN","BPSOSCD",100,0)
 D STLIC^BPSJPAY(MEDN,PROVIEN,BPS("RX",MEDN,"Date Filled"))
"RTN","BPSOSCD",101,0)
 ;
"RTN","BPSOSCD",102,0)
 ; Origin Code
"RTN","BPSOSCD",103,0)
 N VANATURE,VAOIEN
"RTN","BPSOSCD",104,0)
 S (VANATURE,VAOIEN)="",VAOIEN=+$$RXAPI1^BPSUTIL1(RXIEN,39.3,"I"),VANATURE=$$GET1^DIQ(100.008,"1,"_VAOIEN_",","12")
"RTN","BPSOSCD",105,0)
 S BPS("RX",MEDN,"Origin Code")=$S(VANATURE="AUTO":2,VANATURE["ELECTRONIC":3,VANATURE="DUPLICATE":0,VANATURE["TELEPHONE":2,1:1)
"RTN","BPSOSCD",106,0)
 ;
"RTN","BPSOSCD",107,0)
 ;Submission Clarification Code
"RTN","BPSOSCD",108,0)
 S BPS("RX",MEDN,"Clarification")=$P($G(^BPST(IEN59,12)),U,3)
"RTN","BPSOSCD",109,0)
 ;
"RTN","BPSOSCD",110,0)
 ; Drug Info
"RTN","BPSOSCD",111,0)
 I DRUGIEN'="" D
"RTN","BPSOSCD",112,0)
 . S BPS("RX",MEDN,"Drug IEN")=DRUGIEN
"RTN","BPSOSCD",113,0)
 . S BPS("RX",MEDN,"Drug Name")=$$DRUGDIE^BPSUTIL1(DRUGIEN,.01,"E")
"RTN","BPSOSCD",114,0)
 ;
"RTN","BPSOSCD",115,0)
 ; Pricing Info
"RTN","BPSOSCD",116,0)
 S BPS("RX",MEDN,"Alt. Product Type")="03"
"RTN","BPSOSCD",117,0)
 S BPS("RX",MEDN,"Gross Amount Due")=$G(VAINFO(9002313.59902,IENS,902.15,"I"))
"RTN","BPSOSCD",118,0)
 S BPS("RX",MEDN,"Usual & Customary")=$G(VAINFO(9002313.59902,IENS,902.14,"I"))
"RTN","BPSOSCD",119,0)
 S BPS("RX",MEDN,"Basis of Cost Determination")=$G(VAINFO(9002313.59902,IENS,902.13,"I"))
"RTN","BPSOSCD",120,0)
 ;
"RTN","BPSOSCD",121,0)
 ; More pricing info
"RTN","BPSOSCD",122,0)
 N PRICING
"RTN","BPSOSCD",123,0)
 S PRICING=^BPST(IEN59,5)
"RTN","BPSOSCD",124,0)
 S BPS("RX",MEDN,"Quantity")=$P(PRICING,U) ; 01/31/2001
"RTN","BPSOSCD",125,0)
 S BPS("RX",MEDN,"Unit Price")=$P(PRICING,U,2)
"RTN","BPSOSCD",126,0)
 S BPS("RX",MEDN,"Ingredient Cost")=$J($P(PRICING,U,2),0,2)
"RTN","BPSOSCD",127,0)
 S BPS("RX",MEDN,"Dispensing Fee")=$J($P(PRICING,U,4),0,2)
"RTN","BPSOSCD",128,0)
 S BPS("Site","Dispensing Fee")=BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",129,0)
 S BPS("RX",MEDN,"Usual & Customary")=$J($P(PRICING,U,5),0,2)
"RTN","BPSOSCD",130,0)
 S BPS("RX",MEDN,"Unit of Measure")=$P(PRICING,U,8)
"RTN","BPSOSCD",131,0)
 I $G(BPS("NCPDP","Add Disp. Fee to Ingr. Cost")) D
"RTN","BPSOSCD",132,0)
 . S BPS("RX",MEDN,"Ingredient Cost")=BPS("RX",MEDN,"Ingredient Cost")+BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",133,0)
 Q
"RTN","BPSOSCD",134,0)
 ;
"RTN","BPSOSCD",135,0)
 ; OVERRIDE - Retrieve OVERRIDE nodes and put into BPS array
"RTN","BPSOSCD",136,0)
 ; They will be fetched from BPS("OVERRIDE"
"RTN","BPSOSCD",137,0)
 ;   during low-level construction of the actual encoded claim packet.
"RTN","BPSOSCD",138,0)
 ; BPS("OVERRIDE",field)=value  for fields 101-401
"RTN","BPSOSCD",139,0)
 ; BPS("OVERRIDE","RX",MEDN,field) for med #N, fields 402+
"RTN","BPSOSCD",140,0)
 ; Note that if you have multiple prescriptions bundled, the
"RTN","BPSOSCD",141,0)
 ;   union of overrides from 101-401 apply to all; and if there's a
"RTN","BPSOSCD",142,0)
 ;   conflict, the last one overwrites the previous ones.
"RTN","BPSOSCD",143,0)
OVERRIDE(IEN59,MEDN) ;
"RTN","BPSOSCD",144,0)
 N IEN511 S IEN511=$P(^BPST(IEN59,1),U,13) Q:'IEN511
"RTN","BPSOSCD",145,0)
 N RETVAL S RETVAL=$$GET511^BPSOSO2(IEN511,"BPS(""OVERRIDE"")","BPS(""OVERRIDE"",""RX"","_MEDN_")")
"RTN","BPSOSCD",146,0)
 Q
"RTN","BPSOSCD",147,0)
 ;
"RTN","BPSOSCD",148,0)
 ; DURVALUE - Will read in the DUR data from the DUR multiple
"RTN","BPSOSCD",149,0)
 ;   in BPS Transactions and store the values into BPS("RX",MEDN,DUR,....)
"RTN","BPSOSCD",150,0)
 ; NOTE - unlike most values, these fields are stored by their
"RTN","BPSOSCD",151,0)
 ;   field number.  Since they are repeating, it will ease the
"RTN","BPSOSCD",152,0)
 ;   retrieval of them, when we populate the claim.
"RTN","BPSOSCD",153,0)
DURVALUE(IEN59,MEDN) ;
"RTN","BPSOSCD",154,0)
 N DUR,DCNT,DURREC
"RTN","BPSOSCD",155,0)
 ;
"RTN","BPSOSCD",156,0)
 S (DUR,DCNT)=0
"RTN","BPSOSCD",157,0)
 F  S DCNT=$O(^BPST(IEN59,13,DCNT)) Q:'+DCNT  D
"RTN","BPSOSCD",158,0)
 . S DURREC=$G(^BPST(IEN59,13,DCNT,0))
"RTN","BPSOSCD",159,0)
 . I DURREC="" Q
"RTN","BPSOSCD",160,0)
 . S DUR=DUR+1
"RTN","BPSOSCD",161,0)
 . S BPS("RX",MEDN,"DUR",DUR,473)=DUR  ;dur/pps cntr
"RTN","BPSOSCD",162,0)
 . S BPS("RX",MEDN,"DUR",DUR,439)=$P(DURREC,U,3) ;Reason Srv Cd
"RTN","BPSOSCD",163,0)
 . S BPS("RX",MEDN,"DUR",DUR,440)=$P(DURREC,U,2) ;Prof Srv Cd
"RTN","BPSOSCD",164,0)
 . S BPS("RX",MEDN,"DUR",DUR,441)=$P(DURREC,U,4) ;Result Src Cd
"RTN","BPSOSCD",165,0)
 . S BPS("RX",MEDN,"DUR",DUR,474)=""             ;Level of Effort
"RTN","BPSOSCD",166,0)
 . S BPS("RX",MEDN,"DUR",DUR,475)=""             ;Co-agent Qual
"RTN","BPSOSCD",167,0)
 . S BPS("RX",MEDN,"DUR",DUR,476)=""             ;Co-agent ID
"RTN","BPSOSCD",168,0)
 Q
"RTN","BPSOSCE")
0^169^B14464874
"RTN","BPSOSCE",1,0)
BPSOSCE ;BHAM ISC/FCS/DRS/DLF - New entry in 9002313.02 ;06/01/2004
"RTN","BPSOSCE",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSCE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCE",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",5,0)
 ;Creates an Electronic Claim Submission record
"RTN","BPSOSCE",6,0)
 ;
"RTN","BPSOSCE",7,0)
 ;Parameters:  START     - START Medication Number
"RTN","BPSOSCE",8,0)
 ;             END       - END Medication Number
"RTN","BPSOSCE",9,0)
 ;             TOTAL     - TOTAL Medications in Claim
"RTN","BPSOSCE",10,0)
 ;                       - The BPS(*) array pointed to by START, END
"RTN","BPSOSCE",11,0)
 ;
"RTN","BPSOSCE",12,0)
 ; Note that the BPS array is shared by all of the BPSOSC* routines
"RTN","BPSOSCE",13,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",14,0)
 ; NEWCLAIM^BPSOSCE called from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSOSCE",15,0)
 ;
"RTN","BPSOSCE",16,0)
 ; This routine is responsible for creating a new entry in the
"RTN","BPSOSCE",17,0)
 ; claims file, and for calling the routines that then populate
"RTN","BPSOSCE",18,0)
 ; that new entry.
"RTN","BPSOSCE",19,0)
 ;
"RTN","BPSOSCE",20,0)
 Q
"RTN","BPSOSCE",21,0)
 ;
"RTN","BPSOSCE",22,0)
NEWCLAIM(START,END,TOTAL) ;EP
"RTN","BPSOSCE",23,0)
 ;
"RTN","BPSOSCE",24,0)
 ;Manage local variables
"RTN","BPSOSCE",25,0)
 N CLAIMID,DIC,DLAYGO,X,Y,COUNT,INDEX,DIK,DA,NODE0,ROU,ERROR,SEG
"RTN","BPSOSCE",26,0)
 S ROU=$T(+0),START=+$G(START),END=+$G(END),TOTAL=+$G(TOTAL)
"RTN","BPSOSCE",27,0)
 ;
"RTN","BPSOSCE",28,0)
 ;Create new record in Claim Submission File (9002313.02)
"RTN","BPSOSCE",29,0)
L L +^TMP($J,"BPSOSCE"):300 I '$T G L:$$IMPOSS^BPSOSUE("L","RTI","Single-threaded routine",,,$T(+0))
"RTN","BPSOSCE",30,0)
 ;
"RTN","BPSOSCE",31,0)
 ; Generate Claim ID
"RTN","BPSOSCE",32,0)
 S CLAIMID=$$CLAIMID^BPSECX1($G(BPS("RX",START,"IEN59")))
"RTN","BPSOSCE",33,0)
 I CLAIMID="" D  Q ERROR
"RTN","BPSOSCE",34,0)
 . S ERROR="320^VA Claim ID not created"
"RTN","BPSOSCE",35,0)
 . D LOG(ROU_"-Failed to create Claim ID")
"RTN","BPSOSCE",36,0)
 ;
"RTN","BPSOSCE",37,0)
 ; Create claim record
"RTN","BPSOSCE",38,0)
 S DLAYGO=9002313.02,DIC="^BPSC(",DIC(0)="LXZ",X=CLAIMID
"RTN","BPSOSCE",39,0)
 D ^DIC S Y=+Y
"RTN","BPSOSCE",40,0)
 L -^TMP($J,"BPSOSCE")
"RTN","BPSOSCE",41,0)
 I Y<1 D  Q ERROR
"RTN","BPSOSCE",42,0)
 . S ERROR="321^Failed to create claim record"
"RTN","BPSOSCE",43,0)
 . D LOG(ROU_"-Failed to create an entry in file 9002313.02")
"RTN","BPSOSCE",44,0)
 ;
"RTN","BPSOSCE",45,0)
 ; Update BPS and Log it
"RTN","BPSOSCE",46,0)
 S BPS(9002313.02)=Y
"RTN","BPSOSCE",47,0)
 ;
"RTN","BPSOSCE",48,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSCE",49,0)
 D LOG(ROU_"-Created claim ID "_CLAIMID_" (IEN "_BPS(9002313.02)_")")
"RTN","BPSOSCE",50,0)
 ;
"RTN","BPSOSCE",51,0)
 ; Update the zero node of the claim
"RTN","BPSOSCE",52,0)
 S NODE0=$G(^BPSC(BPS(9002313.02),0))
"RTN","BPSOSCE",53,0)
 S $P(NODE0,U,2)=$G(BPS("NCPDP","IEN")) ; Electronic Payor (Payer Sheet)
"RTN","BPSOSCE",54,0)
 S $P(NODE0,U,4)=2 ; Transmit Flag - 2 is 'Yes (Point of Sale)'
"RTN","BPSOSCE",55,0)
 S $P(NODE0,U,6)=$$NOWFM^BPSOSU1() ; Created On
"RTN","BPSOSCE",56,0)
 S ^BPSC(BPS(9002313.02),0)=NODE0
"RTN","BPSOSCE",57,0)
 ;
"RTN","BPSOSCE",58,0)
 ; Update Patient Name
"RTN","BPSOSCE",59,0)
 S $P(^BPSC(BPS(9002313.02),1),U,1)=$G(BPS("Patient","Name"))
"RTN","BPSOSCE",60,0)
 S $P(^BPSC(BPS(9002313.02),1),U,4)=$G(BPS("Insurer","IEN"))
"RTN","BPSOSCE",61,0)
 ;
"RTN","BPSOSCE",62,0)
 ; Only Billing Request call this routine so the transaction code
"RTN","BPSOSCE",63,0)
 ;   is always "B1"
"RTN","BPSOSCE",64,0)
 S BPS("Transaction Code")="B1"
"RTN","BPSOSCE",65,0)
 S BPS("Transaction Count")=TOTAL
"RTN","BPSOSCE",66,0)
 ;
"RTN","BPSOSCE",67,0)
 ; Process the 'non-multiple' segments (Header, Patient, Cardholder)
"RTN","BPSOSCE",68,0)
 F SEG=100:10:120 D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG)
"RTN","BPSOSCE",69,0)
 ;
"RTN","BPSOSCE",70,0)
 ; Create the definition node for the multiple
"RTN","BPSOSCE",71,0)
 S ^BPSC(BPS(9002313.02),400,0)="^9002313.0201PA^^"
"RTN","BPSOSCE",72,0)
 ;
"RTN","BPSOSCE",73,0)
 S COUNT=0
"RTN","BPSOSCE",74,0)
 F INDEX=START:1:END D
"RTN","BPSOSCE",75,0)
 . ;
"RTN","BPSOSCE",76,0)
 . ;Create node zero of the medication multiple
"RTN","BPSOSCE",77,0)
 . S COUNT=COUNT+1
"RTN","BPSOSCE",78,0)
 . S NODE0=""
"RTN","BPSOSCE",79,0)
 . S $P(NODE0,U,1)=INDEX
"RTN","BPSOSCE",80,0)
 . S $P(NODE0,U,3)=INDEX
"RTN","BPSOSCE",81,0)
 . S $P(NODE0,U,4)=$G(BPS("RX",INDEX,"Drug Name"))
"RTN","BPSOSCE",82,0)
 . S $P(NODE0,U,5)=$G(BPS("RX",INDEX,"RX IEN"))
"RTN","BPSOSCE",83,0)
 . S ^BPSC(BPS(9002313.02),400,INDEX,0)=NODE0
"RTN","BPSOSCE",84,0)
 . ;
"RTN","BPSOSCE",85,0)
 . ;
"RTN","BPSOSCE",86,0)
 . I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S INDEX=1 ;LJE
"RTN","BPSOSCE",87,0)
 . S $P(^BPSC(BPS(9002313.02),400,INDEX,400),U,1)=BPS("RX",INDEX,"Date Filled")
"RTN","BPSOSCE",88,0)
 . S BPS(9002313.0201)=INDEX ;07/28/96.
"RTN","BPSOSCE",89,0)
 . ;
"RTN","BPSOSCE",90,0)
 . ; Process multiples in the medication multiple
"RTN","BPSOSCE",91,0)
 . F SEG=130:10:230 D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG,INDEX)
"RTN","BPSOSCE",92,0)
 . ;
"RTN","BPSOSCE",93,0)
 . ; Update the indices
"RTN","BPSOSCE",94,0)
 . S ^BPSC(BPS(9002313.02),400,"B",INDEX,INDEX)=""
"RTN","BPSOSCE",95,0)
 . S ^BPSC(BPS(9002313.02),400,"AC",INDEX,INDEX)=""
"RTN","BPSOSCE",96,0)
 . S NODE0=$G(^BPSC(BPS(9002313.02),400,0))
"RTN","BPSOSCE",97,0)
 . ;
"RTN","BPSOSCE",98,0)
 . ; Update the definition node of the multiple
"RTN","BPSOSCE",99,0)
 . S $P(NODE0,U,4)=COUNT
"RTN","BPSOSCE",100,0)
 . S $P(NODE0,U,3)=$O(^BPSC(BPS(9002313.02),400,"A"),-1)
"RTN","BPSOSCE",101,0)
 . S ^BPSC(BPS(9002313.02),400,0)=NODE0
"RTN","BPSOSCE",102,0)
 . ;
"RTN","BPSOSCE",103,0)
 ;
"RTN","BPSOSCE",104,0)
 ; Cross-Reference Claim Submission Record
"RTN","BPSOSCE",105,0)
 S DIK="^BPSC("
"RTN","BPSOSCE",106,0)
 S DA=BPS(9002313.02)
"RTN","BPSOSCE",107,0)
 D IX1^DIK
"RTN","BPSOSCE",108,0)
 Q ""
"RTN","BPSOSCE",109,0)
 ;
"RTN","BPSOSCE",110,0)
 ; LOG - Write the message to all of transactions that are
"RTN","BPSOSCE",111,0)
 ; being bundled into this 9002313.02 claim
"RTN","BPSOSCE",112,0)
LOG(MSG) ;
"RTN","BPSOSCE",113,0)
 N IEN59,I
"RTN","BPSOSCE",114,0)
 F I=START:1:END D
"RTN","BPSOSCE",115,0)
 . S IEN59=$G(BPS("RX",I,"IEN59"))
"RTN","BPSOSCE",116,0)
 . I IEN59 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSCE",117,0)
 Q
"RTN","BPSOSCF")
0^43^B26940349
"RTN","BPSOSCF",1,0)
BPSOSCF ;BHAM ISC/FCS/DRS/DLF - Low-level format of .02 ;06/01/2004
"RTN","BPSOSCF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSCF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCF",4,0)
 ;
"RTN","BPSOSCF",5,0)
 ; XLOOP - Build claim record
"RTN","BPSOSCF",6,0)
 ; Inputs:
"RTN","BPSOSCF",7,0)
 ;   BPS    - This is shared among the BPSOSC* routines
"RTN","BPSOSCF",8,0)
 ;   FORMAT - Pointer to 9002313.92
"RTN","BPSOSCF",9,0)
 ;   NODE   - Segment Node
"RTN","BPSOSCF",10,0)
 ;            100  (5.1 Transaction Header Segment)
"RTN","BPSOSCF",11,0)
 ;            110  (5.1 Patient Segment)
"RTN","BPSOSCF",12,0)
 ;            120  (5.1 Insurance Segment)
"RTN","BPSOSCF",13,0)
 ;            130  (5.1 Claim Segment)
"RTN","BPSOSCF",14,0)
 ;            140  (5.1 Pharmacy Provider Segment)
"RTN","BPSOSCF",15,0)
 ;            150  (5.1 Prescriber Segment)
"RTN","BPSOSCF",16,0)
 ;            160  (5.1 COB/Other Payments Segment)
"RTN","BPSOSCF",17,0)
 ;            170  (5.1 Worker's Compensation Segment)
"RTN","BPSOSCF",18,0)
 ;            180  (5.1 DUR/PPS Segment)
"RTN","BPSOSCF",19,0)
 ;            190  (5.1 Pricing Segment)
"RTN","BPSOSCF",20,0)
 ;            200  (5.1 Coupon Segment)
"RTN","BPSOSCF",21,0)
 ;            210  (5.1 Compound Segment)
"RTN","BPSOSCF",22,0)
 ;            220  (5.1 Prior Authorization Segment)
"RTN","BPSOSCF",23,0)
 ;            230  (5.1 Clinical Segment)
"RTN","BPSOSCF",24,0)
 ;   MEDN   - Prescription multiple in BPS Claims
"RTN","BPSOSCF",25,0)
 ;
"RTN","BPSOSCF",26,0)
XLOOP(FORMAT,NODE,MEDN) ;EP
"RTN","BPSOSCF",27,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,PMODE,FLAG,OVERRIDE
"RTN","BPSOSCF",28,0)
 ;
"RTN","BPSOSCF",29,0)
 ; Check parameters
"RTN","BPSOSCF",30,0)
 I $G(FORMAT)="" Q
"RTN","BPSOSCF",31,0)
 I $G(NODE)="" Q
"RTN","BPSOSCF",32,0)
 ;
"RTN","BPSOSCF",33,0)
 ; If the payer sheet does have a particular segment quit
"RTN","BPSOSCF",34,0)
 I '$D(^BPSF(9002313.92,FORMAT,NODE,0)) Q
"RTN","BPSOSCF",35,0)
 ;
"RTN","BPSOSCF",36,0)
 ; VA does not currently do these segments
"RTN","BPSOSCF",37,0)
 I ",230,220,210,200,170,160,"[(","_NODE_",") Q
"RTN","BPSOSCF",38,0)
 ;
"RTN","BPSOSCF",39,0)
 ; DUR is handled differently since it is repeating
"RTN","BPSOSCF",40,0)
 I NODE=180 D DURPPS^BPSOSHF(FORMAT,NODE,MEDN) Q
"RTN","BPSOSCF",41,0)
 ;
"RTN","BPSOSCF",42,0)
 ; Loop through the fields in the segment
"RTN","BPSOSCF",43,0)
 S ORDER=0
"RTN","BPSOSCF",44,0)
 F  S ORDER=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER)) Q:'ORDER  D
"RTN","BPSOSCF",45,0)
 . ;
"RTN","BPSOSCF",46,0)
 . ; Get the pointer to the BPS NCPDP FIELD DEFS table
"RTN","BPSOSCF",47,0)
 . S RECMIEN=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER,0))
"RTN","BPSOSCF",48,0)
 . I 'RECMIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"ORDER="_ORDER,2,$T(+0))
"RTN","BPSOSCF",49,0)
 . S MDATA=^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)
"RTN","BPSOSCF",50,0)
 . S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSCF",51,0)
 . ;
"RTN","BPSOSCF",52,0)
 . ; Quit for 111-AM (Segment ID), 478-H7 (Other Amt Claimed Sub Count), and
"RTN","BPSOSCF",53,0)
 . ;   479-H8 (Other Amt Claimed Sub Qual)
"RTN","BPSOSCF",54,0)
 . ; 478 and 479 are handled by 480 and 111 is standard field for each segment
"RTN","BPSOSCF",55,0)
 . Q:FLDIEN=241!(FLDIEN=240)!(FLDIEN=93)
"RTN","BPSOSCF",56,0)
 . ;
"RTN","BPSOSCF",57,0)
 . ; Corrupt or erroneous format file
"RTN","BPSOSCF",58,0)
 . I 'FLDIEN Q
"RTN","BPSOSCF",59,0)
 . ;
"RTN","BPSOSCF",60,0)
 . ; Set override value (may not be defined so override will be null)
"RTN","BPSOSCF",61,0)
 . I $D(MEDN) S OVERRIDE=$G(BPS("OVERRIDE","RX",MEDN,FLDIEN))
"RTN","BPSOSCF",62,0)
 . E  S OVERRIDE=$G(BPS("OVERRIDE",FLDIEN))
"RTN","BPSOSCF",63,0)
 . ;
"RTN","BPSOSCF",64,0)
 . ; Get processing mode (S-Standard (default), X-Special Code)
"RTN","BPSOSCF",65,0)
 . S PMODE=$P(MDATA,U,3)
"RTN","BPSOSCF",66,0)
 . I PMODE="" S PMODE="S" ;default it
"RTN","BPSOSCF",67,0)
 . ;
"RTN","BPSOSCF",68,0)
 . ; Default FLAG and value being computed
"RTN","BPSOSCF",69,0)
 . S FLAG="GFS"
"RTN","BPSOSCF",70,0)
 . S BPS("X")=""
"RTN","BPSOSCF",71,0)
 . ;
"RTN","BPSOSCF",72,0)
 . ; If there is an override, set BPS("X") to it and
"RTN","BPSOSCF",73,0)
 . ;   only do Format and Set code
"RTN","BPSOSCF",74,0)
 . I OVERRIDE]"" S FLAG="FS",BPS("X")=OVERRIDE
"RTN","BPSOSCF",75,0)
 . ;
"RTN","BPSOSCF",76,0)
 . ; If Special Code mode is set, execute special code instead
"RTN","BPSOSCF",77,0)
 . ;   of field's Get code and change Flag to FS so Format and
"RTN","BPSOSCF",78,0)
 . ;   Set code is still done but not GET code
"RTN","BPSOSCF",79,0)
 . I PMODE="X",OVERRIDE="" D
"RTN","BPSOSCF",80,0)
 .. S FLAG="FS"
"RTN","BPSOSCF",81,0)
 .. D XSPCCODE(FORMAT,NODE,RECMIEN)
"RTN","BPSOSCF",82,0)
 . ;
"RTN","BPSOSCF",83,0)
 . ; Call XFLDCODE to do processing based on FLAG setting
"RTN","BPSOSCF",84,0)
 . D XFLDCODE(NODE,FLDIEN,FLAG)
"RTN","BPSOSCF",85,0)
 Q
"RTN","BPSOSCF",86,0)
 ;
"RTN","BPSOSCF",87,0)
 ; Execute Get, Format and/or Set MUMPS code for a NCPDP Field
"RTN","BPSOSCF",88,0)
 ;
"RTN","BPSOSCF",89,0)
 ; Parameters:   NODE    -  Segment Node
"RTN","BPSOSCF",90,0)
 ;               FLDIEN  -  NCPDP Field Definitions IEN
"RTN","BPSOSCF",91,0)
 ;               FLAG    -  If variable contains:
"RTN","BPSOSCF",92,0)
 ;                          "G" - Execute Get Code
"RTN","BPSOSCF",93,0)
 ;                          "F" - Execute Format Code
"RTN","BPSOSCF",94,0)
 ;                          "S" - Execute S Code
"RTN","BPSOSCF",95,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSCF",96,0)
XFLDCODE(NODE,FLDIEN,FLAG) ;EP
"RTN","BPSOSCF",97,0)
 ; 5.1 loops through the 10, 25, 30 nodes
"RTN","BPSOSCF",98,0)
 ;
"RTN","BPSOSCF",99,0)
 N FNODE,INDEX,MCODE
"RTN","BPSOSCF",100,0)
 ;
"RTN","BPSOSCF",101,0)
 ; Check if record exists and FLAG variable is set correctly
"RTN","BPSOSCF",102,0)
 ; Changed from Q: to give fatal error - 10/18/2000
"RTN","BPSOSCF",103,0)
 I 'FLDIEN D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",104,0)
 I '$D(^BPSF(9002313.91,FLDIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",105,0)
 I FLAG="" D IMPOSS^BPSOSUE("DB,P","TI","FLAG null",,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",106,0)
 ;
"RTN","BPSOSCF",107,0)
 ; Loop through Get, Format and Set Code fields and execute code
"RTN","BPSOSCF",108,0)
 F FNODE=10,25,30 D
"RTN","BPSOSCF",109,0)
 . I FLAG'[$S(FNODE=10:"G",FNODE=25:"F",FNODE=30:"S",1:"") Q
"RTN","BPSOSCF",110,0)
 . ;
"RTN","BPSOSCF",111,0)
 . ; Quit for 111-AM (Segment ID), 478-H7 (Other Amt Claimed Sub Count), and
"RTN","BPSOSCF",112,0)
 . ;   479-H8 (Other Amt Claimed Sub Qual)
"RTN","BPSOSCF",113,0)
 . ; 478 and 479 are handled by 480 and 111 is standard field for each segment
"RTN","BPSOSCF",114,0)
 . I FLDIEN=241!(FLDIEN=240)!(FLDIEN=93) Q
"RTN","BPSOSCF",115,0)
 . I '$D(^BPSF(9002313.91,FLDIEN,FNODE,0)) D IMPOSS^BPSOSUE("DB","TI","FLDIEN="_FLDIEN,"FNODE="_FNODE,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",116,0)
 . ;
"RTN","BPSOSCF",117,0)
 . ; Loop through the multiple and execute each line
"RTN","BPSOSCF",118,0)
 . S INDEX=0
"RTN","BPSOSCF",119,0)
 . F  S INDEX=$O(^BPSF(9002313.91,FLDIEN,FNODE,INDEX)) Q:'+INDEX  D
"RTN","BPSOSCF",120,0)
 .. ;
"RTN","BPSOSCF",121,0)
 .. ; If doing SET code and if this is not the header segment, add the ID prefix
"RTN","BPSOSCF",122,0)
 .. I FNODE=30,NODE'=100 S BPS("X")=$P($G(^BPSF(9002313.91,FLDIEN,5)),U,1)_BPS("X")
"RTN","BPSOSCF",123,0)
 .. ;
"RTN","BPSOSCF",124,0)
 .. ; Get the code and xecute
"RTN","BPSOSCF",125,0)
 .. S MCODE=$G(^BPSF(9002313.91,FLDIEN,FNODE,INDEX,0))
"RTN","BPSOSCF",126,0)
 .. Q:MCODE=""
"RTN","BPSOSCF",127,0)
 .. Q:$E(MCODE,1)=";"
"RTN","BPSOSCF",128,0)
 .. X MCODE
"RTN","BPSOSCF",129,0)
 Q
"RTN","BPSOSCF",130,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCF",131,0)
 ;Execute Special Code (for a NCPDP Field within a NCPDP Record)
"RTN","BPSOSCF",132,0)
 ;
"RTN","BPSOSCF",133,0)
 ;Parameters:    FORMAT   - NCPDP Record Format IEN (9002313.92)
"RTN","BPSOSCF",134,0)
 ;               NODE     - Global node value (100,110,120,130,140)
"RTN","BPSOSCF",135,0)
 ;               RECMIEN  - Field Multiple IEN
"RTN","BPSOSCF",136,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSCF",137,0)
XSPCCODE(FORMAT,NODE,RECMIEN) ;EP - Above and BPSOSHR
"RTN","BPSOSCF",138,0)
 ;
"RTN","BPSOSCF",139,0)
 N INDEX,MCODE
"RTN","BPSOSCF",140,0)
 I '$D(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","no special code there to XECUTE","FORMAT="_FORMAT,"XSPCCODE",$T(+0))
"RTN","BPSOSCF",141,0)
 ;
"RTN","BPSOSCF",142,0)
 S INDEX=0
"RTN","BPSOSCF",143,0)
 F  S INDEX=$O(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,1,INDEX)) Q:'+INDEX  D
"RTN","BPSOSCF",144,0)
 . S MCODE=$G(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,1,INDEX,0))
"RTN","BPSOSCF",145,0)
 . Q:MCODE=""
"RTN","BPSOSCF",146,0)
 . Q:$E(MCODE,1)=";"
"RTN","BPSOSCF",147,0)
 . X MCODE
"RTN","BPSOSCF",148,0)
 Q
"RTN","BPSOSH2")
0^170^B26441893
"RTN","BPSOSH2",1,0)
BPSOSH2 ;BHAM ISC/SD/lwj/DLF - Assemble formatted claim for 5.1 ;06/01/2004
"RTN","BPSOSH2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSH2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSH2",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",5,0)
 ; Changes for NCPDP 5.1
"RTN","BPSOSH2",6,0)
 ;    5.1 has 14 claim segments (header, patient, insurance, claim
"RTN","BPSOSH2",7,0)
 ;                                pharmacy provider, prescriber,
"RTN","BPSOSH2",8,0)
 ;                                COB, workers comp, DUR, Pricing,
"RTN","BPSOSH2",9,0)
 ;                                coupon, compound, prior auth,
"RTN","BPSOSH2",10,0)
 ;                                clinical)
"RTN","BPSOSH2",11,0)
 ;    5.1 requires field identifiers and separators on all fields
"RTN","BPSOSH2",12,0)
 ;        other than the header
"RTN","BPSOSH2",13,0)
 ;    5.1 segment separators are required prior to each segment
"RTN","BPSOSH2",14,0)
 ;        following the header
"RTN","BPSOSH2",15,0)
 ;    5.1  Group separators appear at the end of each
"RTN","BPSOSH2",16,0)
 ;        transaction (prescription)
"RTN","BPSOSH2",17,0)
 ;    5.1 we only want to send segments that have data - a new
"RTN","BPSOSH2",18,0)
 ;        segment record will hold the data until we are sure
"RTN","BPSOSH2",19,0)
 ;        we have something to send
"RTN","BPSOSH2",20,0)
 ;
"RTN","BPSOSH2",21,0)
 ;
"RTN","BPSOSH2",22,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",23,0)
 ;Put together ascii formatted record via NCPDP Record definition
"RTN","BPSOSH2",24,0)
 ;
"RTN","BPSOSH2",25,0)
 ;Input Variables:  NODES     - (100^110^120 or
"RTN","BPSOSH2",26,0)
 ;                               130^140^150^160^170^180^190^
"RTN","BPSOSH2",27,0)
 ;                               200^210^220^230)
"RTN","BPSOSH2",28,0)
 ;                  .IEN      - Internal Entry Number array
"RTN","BPSOSH2",29,0)
 ;                  .BPS     - Formatted Data Array with claim and
"RTN","BPSOSH2",30,0)
 ;                              prescription data
"RTN","BPSOSH2",31,0)
 ;                  .REC      - Formatted Ascii record (result)
"RTN","BPSOSH2",32,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",33,0)
XLOOP(NODES,IEN,BPS,REC) ;EP - from BPSECA1
"RTN","BPSOSH2",34,0)
 ;
"RTN","BPSOSH2",35,0)
 ; Manage local variables
"RTN","BPSOSH2",36,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,PMODE,FLAG,NODE,FDATA,FLDNUM,FLDDATA
"RTN","BPSOSH2",37,0)
 N INDEX,FLDID
"RTN","BPSOSH2",38,0)
 N SEGREC,DATAFND,FDATA5
"RTN","BPSOSH2",39,0)
 ;
"RTN","BPSOSH2",40,0)
 ;Loop through the NODES defined in NODES variable parsed by U
"RTN","BPSOSH2",41,0)
 F INDEX=1:1:$L(NODES,U) D
"RTN","BPSOSH2",42,0)
 . S NODE=$P(NODES,U,INDEX)
"RTN","BPSOSH2",43,0)
 . Q:NODE=""
"RTN","BPSOSH2",44,0)
 . ;
"RTN","BPSOSH2",45,0)
 . ; VA does not support these nodes
"RTN","BPSOSH2",46,0)
 . Q:",230,220,210,200,170,160,"[NODE
"RTN","BPSOSH2",47,0)
 . ;
"RTN","BPSOSH2",48,0)
 . ; Quit if the payer sheet does not have the node
"RTN","BPSOSH2",49,0)
 . Q:'$D(^BPSF(9002313.92,+IEN(9002313.92),NODE,0))
"RTN","BPSOSH2",50,0)
 . ;
"RTN","BPSOSH2",51,0)
 . ; Per NCPDP standard, reversals do not support segments listed below - DMB 5/2/2005
"RTN","BPSOSH2",52,0)
 . I $G(BPS(9002313.02,+$G(IEN(9002313.02)),103,"I"))="B2",",230,220,210,200,170,160,150,140,"[NODE Q
"RTN","BPSOSH2",53,0)
 . ;
"RTN","BPSOSH2",54,0)
 . S DATAFND=0  ;indicates if data is on the segment for us to send
"RTN","BPSOSH2",55,0)
 . S SEGREC=""  ;holds the segment's information
"RTN","BPSOSH2",56,0)
 . ;
"RTN","BPSOSH2",57,0)
 . D:NODE=180 PROCDUR
"RTN","BPSOSH2",58,0)
 . ;
"RTN","BPSOSH2",59,0)
 . S ORDER=""
"RTN","BPSOSH2",60,0)
 . F  D  Q:'ORDER
"RTN","BPSOSH2",61,0)
 .. ;
"RTN","BPSOSH2",62,0)
 .. Q:NODE=180    ;already had to process the DUR/PPS section (repeating)
"RTN","BPSOSH2",63,0)
 .. S ORDER=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER))
"RTN","BPSOSH2",64,0)
 .. Q:'ORDER
"RTN","BPSOSH2",65,0)
 .. S RECMIEN=""
"RTN","BPSOSH2",66,0)
 .. S RECMIEN=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER,RECMIEN))
"RTN","BPSOSH2",67,0)
 .. Q:RECMIEN=""
"RTN","BPSOSH2",68,0)
 .. ;
"RTN","BPSOSH2",69,0)
 .. S MDATA=$G(^BPSF(9002313.92,+IEN(9002313.92),NODE,RECMIEN,0))
"RTN","BPSOSH2",70,0)
 .. Q:MDATA=""
"RTN","BPSOSH2",71,0)
 .. ;
"RTN","BPSOSH2",72,0)
 .. S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSH2",73,0)
 .. Q:FLDIEN=""
"RTN","BPSOSH2",74,0)
 .. ;
"RTN","BPSOSH2",75,0)
 .. S FDATA=$G(^BPSF(9002313.91,FLDIEN,0))
"RTN","BPSOSH2",76,0)
 .. Q:FDATA=""
"RTN","BPSOSH2",77,0)
 .. S FLDNUM=$P(FDATA,U,1)
"RTN","BPSOSH2",78,0)
 .. Q:FLDNUM=""
"RTN","BPSOSH2",79,0)
 .. ;
"RTN","BPSOSH2",80,0)
 .. S FDATA5=$G(^BPSF(9002313.91,FLDIEN,5))   ;5.1 id and length
"RTN","BPSOSH2",81,0)
 .. S FLDID=$P(FDATA5,U,1)         ;5.1 ID
"RTN","BPSOSH2",82,0)
 .. ;
"RTN","BPSOSH2",83,0)
 .. ;header data
"RTN","BPSOSH2",84,0)
 .. S:NODE<130 FLDDATA=$G(BPS(9002313.02,IEN(9002313.02),FLDNUM,"I"))
"RTN","BPSOSH2",85,0)
 .. ;
"RTN","BPSOSH2",86,0)
 .. ;transaction data
"RTN","BPSOSH2",87,0)
 .. S:NODE>120 FLDDATA=$G(BPS(9002313.0201,IEN(9002313.01),FLDNUM,"I"))
"RTN","BPSOSH2",88,0)
 .. ;
"RTN","BPSOSH2",89,0)
 .. I FLDID'=$TR(FLDDATA,"0 {}") S DATAFND=1 ;fld chk-is the field empty?
"RTN","BPSOSH2",90,0)
 .. ;
"RTN","BPSOSH2",91,0)
 .. ;check if this is the seg id - call this after fld chk since
"RTN","BPSOSH2",92,0)
 .. ;we don't want to send the segment if this is all there is
"RTN","BPSOSH2",93,0)
 .. I (NODE>100)&(FLDNUM=111) S FLDDATA=$$SEGID(NODE)
"RTN","BPSOSH2",94,0)
 .. ;
"RTN","BPSOSH2",95,0)
 .. Q:FLDDATA=""   ;lje;7/23/03; don't want extra field separators when field is blank for testing for WebMD.
"RTN","BPSOSH2",96,0)
 .. ;
"RTN","BPSOSH2",97,0)
 .. S:NODE=100 SEGREC=SEGREC_FLDDATA  ;no FS on the header rec
"RTN","BPSOSH2",98,0)
 .. S:NODE>100 SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",99,0)
 .. ;
"RTN","BPSOSH2",100,0)
 . ;
"RTN","BPSOSH2",101,0)
 . I (DATAFND)&(NODE=100) S REC(NODE)=SEGREC   ;no SS when it's the header
"RTN","BPSOSH2",102,0)
 . I (DATAFND)&(NODE>100) D
"RTN","BPSOSH2",103,0)
 .. I '$D(REC(NODE)) S REC(NODE)=REC I REC[$C(29) S REC=""
"RTN","BPSOSH2",104,0)
 .. S REC(NODE)=REC(NODE)_$C(30)_SEGREC  ;SS before the seg
"RTN","BPSOSH2",105,0)
 ;
"RTN","BPSOSH2",106,0)
 Q
"RTN","BPSOSH2",107,0)
 ;
"RTN","BPSOSH2",108,0)
SEGID(ND) ; Field 111 is the Segment Identifier - for each segment, other than
"RTN","BPSOSH2",109,0)
 ; the header, a pre-defined, unique value must be sent in this field
"RTN","BPSOSH2",110,0)
 ; to identify which segment is being sent.  This value is not stored
"RTN","BPSOSH2",111,0)
 ; in the claim - as it changes with each of the 13 segments. The
"RTN","BPSOSH2",112,0)
 ; field does appear as part of the NCPCP Format, put is simply not
"RTN","BPSOSH2",113,0)
 ; stored.
"RTN","BPSOSH2",114,0)
 ;    01 = Patient   02 = Pharmacy Provider    03 = Prescriber
"RTN","BPSOSH2",115,0)
 ;    04 = Insurance 05 = COB/Other Payment    06 = Workers Comp
"RTN","BPSOSH2",116,0)
 ;    07 = Claim     08 = DUR/PPS              09 = Coupon
"RTN","BPSOSH2",117,0)
 ;    10 = Compound  11 = Pricing              12 = Prior Auth
"RTN","BPSOSH2",118,0)
 ;    13 = Clinical
"RTN","BPSOSH2",119,0)
 ;
"RTN","BPSOSH2",120,0)
 N FLD
"RTN","BPSOSH2",121,0)
 ;
"RTN","BPSOSH2",122,0)
 S FLD=$S(ND=110:"01",ND=120:"04",ND=130:"07",ND=140:"02",ND=150:"03",ND=160:"05",ND=170:"06",ND=180:"08",ND=190:11,ND=200:"09",ND=210:10,ND=220:12,ND=230:13,1:"00")
"RTN","BPSOSH2",123,0)
 S FLD="AM"_$$NFF^BPSECFM(FLD,2)
"RTN","BPSOSH2",124,0)
 ;
"RTN","BPSOSH2",125,0)
 Q FLD
"RTN","BPSOSH2",126,0)
 ;
"RTN","BPSOSH2",127,0)
PROCDUR ;NCPDP 5.1 - The DUR/PPS segment can repeat itself for any given
"RTN","BPSOSH2",128,0)
 ; transaction within a claim.  This means we have to have special
"RTN","BPSOSH2",129,0)
 ; programming to handle the repeating fields.
"RTN","BPSOSH2",130,0)
 ;
"RTN","BPSOSH2",131,0)
 ; Note that BPS array is set in BPSOSC* routines
"RTN","BPSOSH2",132,0)
 ;
"RTN","BPSOSH2",133,0)
 N FIELD,DUR,FLD,ORD
"RTN","BPSOSH2",134,0)
 ;
"RTN","BPSOSH2",135,0)
 ; If there isn't any data in this segment, then lets quit
"RTN","BPSOSH2",136,0)
 Q:'$D(BPS(9002313.1001))
"RTN","BPSOSH2",137,0)
 ;
"RTN","BPSOSH2",138,0)
 ; Second thing - create the 111 field entry as it is not repeating
"RTN","BPSOSH2",139,0)
 S FLDDATA=$$SEGID(NODE)
"RTN","BPSOSH2",140,0)
 S SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",141,0)
 ;
"RTN","BPSOSH2",142,0)
 ; Next- let's look to the format to see which DUR/PPS fields are
"RTN","BPSOSH2",143,0)
 ; needed (remember - ALL fields on the DUR/PPS segment are optional)
"RTN","BPSOSH2",144,0)
 D GETFLDS^BPSOSHF(+IEN(9002313.92),NODE,.FIELD)
"RTN","BPSOSH2",145,0)
 ;
"RTN","BPSOSH2",146,0)
 ; Finally -loop through and process the fields for as many times
"RTN","BPSOSH2",147,0)
 ; as they appear
"RTN","BPSOSH2",148,0)
 S DUR=0
"RTN","BPSOSH2",149,0)
 F  S DUR=$O(BPS(9002313.1001,DUR)) Q:DUR=""  D
"RTN","BPSOSH2",150,0)
 . S ORD=0
"RTN","BPSOSH2",151,0)
 . F  S ORD=$O(FIELD(ORD)) Q:ORD=""  D
"RTN","BPSOSH2",152,0)
 .. S FLDIEN=$P(FIELD(ORD),U)
"RTN","BPSOSH2",153,0)
 .. S FLD=$P(FIELD(ORD),U,2)
"RTN","BPSOSH2",154,0)
 .. S:FLD=473 FLD=.01   ;473 value stored in the .01 field
"RTN","BPSOSH2",155,0)
 .. S FDATA5=$G(^BPSF(9002313.91,FLDIEN,5))   ;5.1 id and length
"RTN","BPSOSH2",156,0)
 .. S FLDID=$P(FDATA5,U,1)         ;5.1 ID
"RTN","BPSOSH2",157,0)
 .. ;
"RTN","BPSOSH2",158,0)
 .. ; Transaction data
"RTN","BPSOSH2",159,0)
 .. S FLDDATA=$G(BPS(9002313.1001,DUR,FLD,"I"))
"RTN","BPSOSH2",160,0)
 .. ;
"RTN","BPSOSH2",161,0)
 .. I FLDID'=$TR(FLDDATA,"0 {}") S DATAFND=1 ;fld chk-is the fld empty?
"RTN","BPSOSH2",162,0)
 .. ;
"RTN","BPSOSH2",163,0)
 .. S SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",164,0)
 Q
"RTN","BPSOSH4")
1^97
"RTN","BPSOSH5")
1^98
"RTN","BPSOSH6")
1^99
"RTN","BPSOSH7")
1^100
"RTN","BPSOSHF")
0^172^B11141582
"RTN","BPSOSHF",1,0)
BPSOSHF ;BHAM ISC/SD/lwj/DLF - Get/Format/Set value for DUR/PPS segment ;06/01/2004
"RTN","BPSOSHF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSHF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSHF",4,0)
 ;
"RTN","BPSOSHF",5,0)
 ; This routine is an addendum to BPSOSCF.  Its purpose is to handle
"RTN","BPSOSHF",6,0)
 ; some of the repeating fields that now exist in NCPDP 5.1.
"RTN","BPSOSHF",7,0)
 ; The logic was put in here rather than BPSOSCF to keep the original
"RTN","BPSOSHF",8,0)
 ; routine (BPSOSCF) from growing too large and too cumbersome to
"RTN","BPSOSHF",9,0)
 ; maintain.
"RTN","BPSOSHF",10,0)
 ;
"RTN","BPSOSHF",11,0)
 ; At this point, the only repeating fields we handle in this routine
"RTN","BPSOSHF",12,0)
 ; are those contained in the DUR/PPS segment.
"RTN","BPSOSHF",13,0)
 ;
"RTN","BPSOSHF",14,0)
DURPPS(FORMAT,NODE,MEDN) ;EP called from BPSOSCF
"RTN","BPSOSHF",15,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",16,0)
 ;NCPDP 5.1 changes
"RTN","BPSOSHF",17,0)
 ; Processing of the 5.1 DUR/PPS segment is much different than the
"RTN","BPSOSHF",18,0)
 ; conventional segments of 3.2, simply because all of its fields
"RTN","BPSOSHF",19,0)
 ; are optional, and repeating.  The repeating portion of this
"RTN","BPSOSHF",20,0)
 ; causes us to have yet another index we have to account for, and
"RTN","BPSOSHF",21,0)
 ; we must be able to tell which of the fields really needs to be
"RTN","BPSOSHF",22,0)
 ; populated.  The population of this segment is based on those
"RTN","BPSOSHF",23,0)
 ; values found for the prescription or refill in the BPS DUR/PPS
"RTN","BPSOSHF",24,0)
 ; file.  The file's values are temporarily stored in the
"RTN","BPSOSHF",25,0)
 ; BPS("RX",MEDN,DUR....) array for easy access and reference.
"RTN","BPSOSHF",26,0)
 ; (Special note - Overrides are not allowed on this multiple since
"RTN","BPSOSHF",27,0)
 ; they can simply update the DUR/PPS filed directly. For the same
"RTN","BPSOSHF",28,0)
 ; reason, "special" code is not accounted for either.
"RTN","BPSOSHF",29,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",30,0)
 ;
"RTN","BPSOSHF",31,0)
 ; first order of business - check the BPS("RX",MEDN,"DUR") array
"RTN","BPSOSHF",32,0)
 ; for values - if there aren't any, we don't need to write this
"RTN","BPSOSHF",33,0)
 ; segment
"RTN","BPSOSHF",34,0)
 ;
"RTN","BPSOSHF",35,0)
 N FIELD,RECCNT,DUR,FLD,OVERRIDE,FLAG,ORD,FLDIEN,FLDNUM,FLDNUMB,FOUND
"RTN","BPSOSHF",36,0)
 S FLAG="FS"
"RTN","BPSOSHF",37,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S FLAG="GFS"
"RTN","BPSOSHF",38,0)
 ;
"RTN","BPSOSHF",39,0)
 Q:'$D(BPS("RX",MEDN,"DUR"))
"RTN","BPSOSHF",40,0)
 ;
"RTN","BPSOSHF",41,0)
 ;next we need to figure out which fields on this format are really
"RTN","BPSOSHF",42,0)
 ; needed, then we will loop through and populate them
"RTN","BPSOSHF",43,0)
 ;
"RTN","BPSOSHF",44,0)
 D GETFLDS(FORMAT,NODE,.FIELD)
"RTN","BPSOSHF",45,0)
 ;
"RTN","BPSOSHF",46,0)
 ; now lets get, format and set the field
"RTN","BPSOSHF",47,0)
 S (ORD,RECCNT,DUR)=0
"RTN","BPSOSHF",48,0)
 S RECCNT=RECCNT+1
"RTN","BPSOSHF",49,0)
 F  S DUR=$O(BPS("RX",MEDN,"DUR",DUR)) Q:DUR=""  D
"RTN","BPSOSHF",50,0)
 . S FLDNUM="" F  S FLDNUM=$O(BPS("RX",MEDN,"DUR",DUR,FLDNUM)) Q:FLDNUM=""  D
"RTN","BPSOSHF",51,0)
 .. S ORD="",FOUND=0
"RTN","BPSOSHF",52,0)
 .. F  S ORD=$O(FIELD(ORD)) Q:ORD=""  D  Q:FOUND
"RTN","BPSOSHF",53,0)
 ... S FLDNUMB="",FLDNUMB=$P(FIELD(ORD),U,2) Q:FLDNUMB'=FLDNUM
"RTN","BPSOSHF",54,0)
 ... S FLDIEN="",FLDIEN=$P(FIELD(ORD),U)
"RTN","BPSOSHF",55,0)
 ... S BPS("X")=BPS("RX",MEDN,"DUR",DUR,FLDNUM)
"RTN","BPSOSHF",56,0)
 ... S FOUND=1
"RTN","BPSOSHF",57,0)
 ... D XFLDCODE^BPSOSCF(NODE,FLDIEN,FLAG)  ;format/set
"RTN","BPSOSHF",58,0)
 ;
"RTN","BPSOSHF",59,0)
 ; this sets the record count and last record on the subfile
"RTN","BPSOSHF",60,0)
 S ^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,0)="^9002313.1001A^"_RECCNT_"^"_RECCNT
"RTN","BPSOSHF",61,0)
 ;
"RTN","BPSOSHF",62,0)
 Q
"RTN","BPSOSHF",63,0)
GETFLDS(FORMAT,NODE,FIELD) ;EP NCPDP 5.1
"RTN","BPSOSHF",64,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",65,0)
 ;This routine will get the list of repeating fields that must be
"RTN","BPSOSHF",66,0)
 ; be worked with separately
"RTN","BPSOSHF",67,0)
 ; (This was originally coded for the DUR/PPS segment - I'm not
"RTN","BPSOSHF",68,0)
 ; 100% sure how and if it will work for the other repeating
"RTN","BPSOSHF",69,0)
 ; fields that exist within a segment.)
"RTN","BPSOSHF",70,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",71,0)
 ; Coming in:
"RTN","BPSOSHF",72,0)
 ;   FORMAT = BPSF(9002313.92 's format IEN
"RTN","BPSOSHF",73,0)
 ;   NODE   = which segment we are processing (i.e. 180 - DUR/PPS)
"RTN","BPSOSHF",74,0)
 ;  .FIELD  = array to store the values in
"RTN","BPSOSHF",75,0)
 ;
"RTN","BPSOSHF",76,0)
 ; Exitting:
"RTN","BPSOSHF",77,0)
 ;  .FIELD array will look like:
"RTN","BPSOSHF",78,0)
 ;     FIELD(ord)=int^ext
"RTN","BPSOSHF",79,0)
 ;  Where:   ext = external field number from BPSF(9002313.91
"RTN","BPSOSHF",80,0)
 ;           int = internal field number from BPSF(9002313.91
"RTN","BPSOSHF",81,0)
 ;           ord = the order of the field - used in creating clm
"RTN","BPSOSHF",82,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",83,0)
 ;
"RTN","BPSOSHF",84,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,FLDNUM,DUR
"RTN","BPSOSHF",85,0)
 ;
"RTN","BPSOSHF",86,0)
 S ORDER=0
"RTN","BPSOSHF",87,0)
 ;
"RTN","BPSOSHF",88,0)
 F  D  Q:'ORDER
"RTN","BPSOSHF",89,0)
 . ;
"RTN","BPSOSHF",90,0)
 . ; let's order through the format file for this node
"RTN","BPSOSHF",91,0)
 . ;
"RTN","BPSOSHF",92,0)
 . S ORDER=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER)) Q:'ORDER
"RTN","BPSOSHF",93,0)
 . S RECMIEN=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER,0))
"RTN","BPSOSHF",94,0)
 . I 'RECMIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"ORDER="_ORDER,2,$T(+0))
"RTN","BPSOSHF",95,0)
 . S MDATA=^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)
"RTN","BPSOSHF",96,0)
 . S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSHF",97,0)
 . I 'FLDIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"RECMIEN="_RECMIEN,3,$T(+0)) ; corrupt or erroneous format file
"RTN","BPSOSHF",98,0)
 . I '$D(^BPSF(9002313.91,FLDIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"DURPPS",$T(+0))  ;incomplete field definition
"RTN","BPSOSHF",99,0)
 . ;
"RTN","BPSOSHF",100,0)
 . ;lets create a list of fields we need
"RTN","BPSOSHF",101,0)
 . S FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHF",102,0)
 . S:FLDNUM'=111 FIELD(ORDER)=FLDIEN_"^"_FLDNUM
"RTN","BPSOSHF",103,0)
 ;
"RTN","BPSOSHF",104,0)
 ;
"RTN","BPSOSHF",105,0)
 Q
"RTN","BPSOSHR")
0^171^B15113089
"RTN","BPSOSHR",1,0)
BPSOSHR ;BHAM ISC/SD/lwj/DLF - Format conversion for reversals ;06/01/2004
"RTN","BPSOSHR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSOSHR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSHR",4,0)
 ;
"RTN","BPSOSHR",5,0)
 ; This routine was originally used by IHS to reformat reversal claims
"RTN","BPSOSHR",6,0)
 ;   into version 5.1 if the original billing request was version 3x.
"RTN","BPSOSHR",7,0)
 ;   For that purpose, this routine is no longer needed.  However,
"RTN","BPSOSHR",8,0)
 ;   it also executes the special code fields so for that reason, it
"RTN","BPSOSHR",9,0)
 ;   has not been removed. We also may need to do this if we change
"RTN","BPSOSHR",10,0)
 ;   from version 5.1 to some other version, such as version 8, in the
"RTN","BPSOSHR",11,0)
 ;   future.
"RTN","BPSOSHR",12,0)
 ;
"RTN","BPSOSHR",13,0)
 ; NOTE: There is a problem with special code if it relies on BPS array
"RTN","BPSOSHR",14,0)
 ;   values, such as BPS("Site","NCPDP") since those variables will not
"RTN","BPSOSHR",15,0)
 ;   be defined at this point.  So, the only special code that will
"RTN","BPSOSHR",16,0)
 ;   work are hard-coded values or executes of a procedure.  If executing
"RTN","BPSOSHR",17,0)
 ;   a procedure, it also needs to not rely on BPS array elements or needs
"RTN","BPSOSHR",18,0)
 ;   to distinquish between billing requests and reversals.
"RTN","BPSOSHR",19,0)
 Q
"RTN","BPSOSHR",20,0)
 ;
"RTN","BPSOSHR",21,0)
 ; Input
"RTN","BPSOSHR",22,0)
 ;   BPSFORM  - Reversal payer sheet IEN
"RTN","BPSOSHR",23,0)
 ;   CLAIMIEN - Original claim IEN
"RTN","BPSOSHR",24,0)
 ;   POS      - Multiple from original claim
"RTN","BPSOSHR",25,0)
 ;
"RTN","BPSOSHR",26,0)
 ; Input/Output
"RTN","BPSOSHR",27,0)
 ;   TMP is the array originally created in BPSECA8.  Since it is quite
"RTN","BPSOSHR",28,0)
 ;     large, we are not passing it into here.  It will be modified by
"RTN","BPSOSHR",29,0)
 ;     this routine.
"RTN","BPSOSHR",30,0)
 ;
"RTN","BPSOSHR",31,0)
REFORM(BPSFORM,CLAIMIEN,POS) ;
"RTN","BPSOSHR",32,0)
 ;
"RTN","BPSOSHR",33,0)
 ; Validate parameters
"RTN","BPSOSHR",34,0)
 I $G(BPSFORM)="" Q
"RTN","BPSOSHR",35,0)
 I $G(CLAIMIEN)="" Q
"RTN","BPSOSHR",36,0)
 I $G(POS)="" Q
"RTN","BPSOSHR",37,0)
 ;
"RTN","BPSOSHR",38,0)
 ; Initialize variables
"RTN","BPSOSHR",39,0)
 N FLDIEN,PMODE,ORDER,RECMIEN,FIELD,NODE
"RTN","BPSOSHR",40,0)
 ;
"RTN","BPSOSHR",41,0)
 ; First go through the header fields.  The original IHS logic was only
"RTN","BPSOSHR",42,0)
 ;   checking four specific fields.  Of these, I removed:
"RTN","BPSOSHR",43,0)
 ;    109 (Transaction Count) - Always 1 for reversals and it does
"RTN","BPSOSHR",44,0)
 ;      not make sense for this to be determined by special code.
"RTN","BPSOSHR",45,0)
 ;    201 (Service Provider ID) - The logic currently implemented
"RTN","BPSOSHR",46,0)
 ;      relies on BPS array elements that are not defined here so this
"RTN","BPSOSHR",47,0)
 ;      was getting set to NULL when it needed to be set.  In addition
"RTN","BPSOSHR",48,0)
 ;      I compared reversal and request (11/30/2006) and this value is 
"RTN","BPSOSHR",49,0)
 ;      always the same for both so reversals will get the right value
"RTN","BPSOSHR",50,0)
 ;      from the request.
"RTN","BPSOSHR",51,0)
 ;    202 (Service Provider ID Qualifier) - It does not make sense
"RTN","BPSOSHR",52,0)
 ;      to do this field if we are not doing field 201.
"RTN","BPSOSHR",53,0)
 ;
"RTN","BPSOSHR",54,0)
 ; So that leaves 110 (Software Vendor/Certification ID), which is needed
"RTN","BPSOSHR",55,0)
 ;   by the WEBMD reversal test payer sheet.
"RTN","BPSOSHR",56,0)
 ;
"RTN","BPSOSHR",57,0)
 ; Kept looping structure in case other fields are added later
"RTN","BPSOSHR",58,0)
 ;     
"RTN","BPSOSHR",59,0)
 S NODE=100,ORDER=0
"RTN","BPSOSHR",60,0)
 F  S ORDER=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER)) Q:'ORDER  D
"RTN","BPSOSHR",61,0)
 . S RECMIEN=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER,0))
"RTN","BPSOSHR",62,0)
 . I 'RECMIEN Q
"RTN","BPSOSHR",63,0)
 . S FLDIEN=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,2)
"RTN","BPSOSHR",64,0)
 . S FIELD=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHR",65,0)
 . I FIELD'=110 Q
"RTN","BPSOSHR",66,0)
 . ;
"RTN","BPSOSHR",67,0)
 . ; Check to see if the format has special code.  If not, quit
"RTN","BPSOSHR",68,0)
 . ;  If we change versions (5x to ??), we made need to execute FORMAT
"RTN","BPSOSHR",69,0)
 . ;    code no matter what, but for now, only do if there is special
"RTN","BPSOSHR",70,0)
 . ;    code.
"RTN","BPSOSHR",71,0)
 . S PMODE=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,3)
"RTN","BPSOSHR",72,0)
 . I PMODE'="X" Q
"RTN","BPSOSHR",73,0)
 . ;
"RTN","BPSOSHR",74,0)
 . ; If special code, get the value, format it and store it in TMP
"RTN","BPSOSHR",75,0)
 . D XSPCCODE^BPSOSCF(BPSFORM,NODE,RECMIEN)
"RTN","BPSOSHR",76,0)
 . D FORMAT(NODE,FLDIEN)
"RTN","BPSOSHR",77,0)
 . S TMP(9002313.02,CLAIMIEN,FIELD,"I")=BPS("X")
"RTN","BPSOSHR",78,0)
 ;
"RTN","BPSOSHR",79,0)
 ; Now reformat the "detail" portion of the claim. For now, the only
"RTN","BPSOSHR",80,0)
 ;   segment we are going to look at is 130, which is the claim segment
"RTN","BPSOSHR",81,0)
 ;   If other reversal formats become available, and they require other
"RTN","BPSOSHR",82,0)
 ;   segments - this section will have to change.  Since the claim
"RTN","BPSOSHR",83,0)
 ;   segment full of optional fields, we wil read through the format
"RTN","BPSOSHR",84,0)
 ;   and take it a field at a time.
"RTN","BPSOSHR",85,0)
 S NODE=130,ORDER=0
"RTN","BPSOSHR",86,0)
 F  S ORDER=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER)) Q:'ORDER  D
"RTN","BPSOSHR",87,0)
 . S RECMIEN=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER,0))
"RTN","BPSOSHR",88,0)
 . I 'RECMIEN Q
"RTN","BPSOSHR",89,0)
 . S FLDIEN=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,2)
"RTN","BPSOSHR",90,0)
 . S FIELD=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHR",91,0)
 . I FIELD=111 Q    ; Never do Segment Indentifier
"RTN","BPSOSHR",92,0)
 . ;
"RTN","BPSOSHR",93,0)
 . ; Check to see if the format has special code.  If not, quit
"RTN","BPSOSHR",94,0)
 . ; If we change versions (5x to ??), we made need to execute FORMAT
"RTN","BPSOSHR",95,0)
 . ;   code no matter what, but for now, only do if there is special
"RTN","BPSOSHR",96,0)
 . ;   code.
"RTN","BPSOSHR",97,0)
 . S PMODE=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,3)
"RTN","BPSOSHR",98,0)
 . I PMODE'="X" Q
"RTN","BPSOSHR",99,0)
 . ;
"RTN","BPSOSHR",100,0)
 . ; If special code, get the value, format it and store it in TMP
"RTN","BPSOSHR",101,0)
 . D XSPCCODE^BPSOSCF(BPSFORM,NODE,RECMIEN)
"RTN","BPSOSHR",102,0)
 . D FORMAT(NODE,FLDIEN)
"RTN","BPSOSHR",103,0)
 . S TMP(9002313.0201,POS_","_CLAIMIEN,FIELD,"I")=BPS("X")
"RTN","BPSOSHR",104,0)
 Q
"RTN","BPSOSHR",105,0)
 ;
"RTN","BPSOSHR",106,0)
 ; FORMAT will format the data based on the FORMAT code in BPS NCPDP
"RTN","BPSOSHR",107,0)
 ;   FIELD DEFS
"RTN","BPSOSHR",108,0)
FORMAT(NODE,FLDIEN) ;
"RTN","BPSOSHR",109,0)
 N INDEX,MCODE,QUAL
"RTN","BPSOSHR",110,0)
 ;
"RTN","BPSOSHR",111,0)
 ; Loop through format code and format the data
"RTN","BPSOSHR",112,0)
 S INDEX=0
"RTN","BPSOSHR",113,0)
 F  S INDEX=$O(^BPSF(9002313.91,FLDIEN,25,INDEX))  Q:'+INDEX  D
"RTN","BPSOSHR",114,0)
 . S MCODE=$G(^BPSF(9002313.91,FLDIEN,25,INDEX,0))
"RTN","BPSOSHR",115,0)
 . I MCODE="" Q
"RTN","BPSOSHR",116,0)
 . I $E(MCODE,1)=";" Q
"RTN","BPSOSHR",117,0)
 . X MCODE
"RTN","BPSOSHR",118,0)
 ;
"RTN","BPSOSHR",119,0)
 ; If node not equal to 100, append qualifier
"RTN","BPSOSHR",120,0)
 I NODE'=100 D
"RTN","BPSOSHR",121,0)
 . S QUAL=$P(^BPSF(9002313.91,FLDIEN,5),"^",1)
"RTN","BPSOSHR",122,0)
 . S BPS("X")=QUAL_BPS("X")
"RTN","BPSOSHR",123,0)
 Q
"RTN","BPSOSHU")
1^101
"RTN","BPSOSI")
1^66
"RTN","BPSOSI1")
1^102
"RTN","BPSOSI7")
1^103
"RTN","BPSOSI8")
1^104
"RTN","BPSOSIF")
1^105
"RTN","BPSOSIV")
1^70
"RTN","BPSOSIW")
1^106
"RTN","BPSOSIY")
0^173^B52867161
"RTN","BPSOSIY",1,0)
BPSOSIY ;BHAM ISC/FCS/DRS/DLF - Updating BPS Transaction record ;06/01/2004
"RTN","BPSOSIY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSOSIY",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSIY",4,0)
 Q
"RTN","BPSOSIY",5,0)
 ;
"RTN","BPSOSIY",6,0)
 ; INIT - Update BPS Transaction
"RTN","BPSOSIY",7,0)
 ; Input
"RTN","BPSOSIY",8,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSIY",9,0)
 ;   MOREDATA is not passed but assumed to exist
"RTN","BPSOSIY",10,0)
 ; Returns
"RTN","BPSOSIY",11,0)
 ;   ERROR - 0 or error number
"RTN","BPSOSIY",12,0)
INIT(IEN59) ;EP - from BPSOSIZ
"RTN","BPSOSIY",13,0)
 ;
"RTN","BPSOSIY",14,0)
 ; Initialize variables
"RTN","BPSOSIY",15,0)
 N FDA,MSG,FN,IENS,REC,B1,X1,X2,X3,ERROR,SEQ
"RTN","BPSOSIY",16,0)
 N RXI,RXR,DIV
"RTN","BPSOSIY",17,0)
 S FN=9002313.59,REC=IEN59_",",ERROR=0
"RTN","BPSOSIY",18,0)
 S RXI=$P(IEN59,".",1),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIY",19,0)
 I RXI="" Q 11
"RTN","BPSOSIY",20,0)
 ;
"RTN","BPSOSIY",21,0)
 ; Change status to 0% (Waiting to Start), which will reset START TIME,
"RTN","BPSOSIY",22,0)
 ;   and then to 10% (Building transaction)
"RTN","BPSOSIY",23,0)
 D SETSTAT^BPSOSU(IEN59,0)
"RTN","BPSOSIY",24,0)
 D SETSTAT^BPSOSU(IEN59,10)
"RTN","BPSOSIY",25,0)
 ;
"RTN","BPSOSIY",26,0)
 ; Get the Outpatient Site
"RTN","BPSOSIY",27,0)
 S DIV=$$GETDIV^BPSOSQC(RXI,RXR)
"RTN","BPSOSIY",28,0)
 ;
"RTN","BPSOSIY",29,0)
 ; If there are Prior Auth or Sub Clar Code override, create override 
"RTN","BPSOSIY",30,0)
 ;   record.  Note that setting of MOREDATA("BPOVRIEN") in this routine 
"RTN","BPSOSIY",31,0)
 ;   will not conflict with prior setting of this value of BPOVRIEN
"RTN","BPSOSIY",32,0)
 ;   since BPOVRIEN and BPSAUTH/BPSCLARF are mutually exclusive
"RTN","BPSOSIY",33,0)
 I $G(MOREDATA("BPSAUTH"))]""!($G(MOREDATA("BPSCLARF"))]"") S MOREDATA("BPOVRIEN")=$$OVERRIDE(IEN59)
"RTN","BPSOSIY",34,0)
 ;
"RTN","BPSOSIY",35,0)
 ; Set BPSDATA into local variable
"RTN","BPSOSIY",36,0)
 S B1=$G(MOREDATA("BPSDATA",1))
"RTN","BPSOSIY",37,0)
 ;
"RTN","BPSOSIY",38,0)
 ; Get first record from MOREDATA("IBDATA") as there are some
"RTN","BPSOSIY",39,0)
 ;   non-multiple fields that need it
"RTN","BPSOSIY",40,0)
 S X2="",SEQ=$O(MOREDATA("IBDATA",""))
"RTN","BPSOSIY",41,0)
 I SEQ S X2=$G(MOREDATA("IBDATA",SEQ,2))
"RTN","BPSOSIY",42,0)
 ;
"RTN","BPSOSIY",43,0)
 ; Set non-multiple fields
"RTN","BPSOSIY",44,0)
 S FDA(FN,REC,1.07)=$$GETPHARM^BPSUTIL(DIV) ;BPS Pharmacy
"RTN","BPSOSIY",45,0)
 S FDA(FN,REC,1.08)=1   ;PINS piece
"RTN","BPSOSIY",46,0)
 S FDA(FN,REC,1.11)=RXI ;Prescription
"RTN","BPSOSIY",47,0)
 I $P($G(^BPST(IEN59,1)),U,12)=1 S FDA(FN,REC,1.12)=2 ;Resubmit after reversal
"RTN","BPSOSIY",48,0)
 S FDA(FN,REC,1.13)=$G(MOREDATA("BPOVRIEN"))  ;NCPDP Overrides
"RTN","BPSOSIY",49,0)
 S FDA(FN,REC,5)=$$RXAPI1^BPSUTIL1(RXI,2,"I") ;Patient
"RTN","BPSOSIY",50,0)
 I '$P($G(^BPST(IEN59,1)),U,12) S FDA(FN,REC,6)=$G(MOREDATA("SUBMIT TIME")) ;Submit Date/Time
"RTN","BPSOSIY",51,0)
 S FDA(FN,REC,9)=RXR  ;Refill
"RTN","BPSOSIY",52,0)
 S FDA(FN,REC,10)=$P(B1,U,3)  ;NDC
"RTN","BPSOSIY",53,0)
 S FDA(FN,REC,11)=DIV ;Outpatient Site
"RTN","BPSOSIY",54,0)
 S FDA(FN,REC,13)=$G(MOREDATA("USER")) ;User
"RTN","BPSOSIY",55,0)
 S FDA(FN,REC,501)=$P(B1,U,1) ;Drug Quanity
"RTN","BPSOSIY",56,0)
 S FDA(FN,REC,502)=$P(B1,U,2) ;Ingredient Cost
"RTN","BPSOSIY",57,0)
 S FDA(FN,REC,504)=$P(X2,U,1) ;Dispense Fee
"RTN","BPSOSIY",58,0)
 S FDA(FN,REC,505)=$P(X2,U,3) ;Total Price
"RTN","BPSOSIY",59,0)
 S FDA(FN,REC,507)=$P(X2,U,5) ;Administrative Fee
"RTN","BPSOSIY",60,0)
 S FDA(FN,REC,508)=$E($P(B1,U,7),1,2) ;Dispense Unit
"RTN","BPSOSIY",61,0)
 S FDA(FN,REC,901)=1          ;Current VA Insurer
"RTN","BPSOSIY",62,0)
 S FDA(FN,REC,1201)=$G(MOREDATA("RX ACTION")) ;RX Action
"RTN","BPSOSIY",63,0)
 S FDA(FN,REC,1202)=$G(MOREDATA("DATE OF SERVICE")) ;Date of Service
"RTN","BPSOSIY",64,0)
 ;
"RTN","BPSOSIY",65,0)
 ; File non-multiple fields - Record is already defined
"RTN","BPSOSIY",66,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIY",67,0)
 I $D(MSG) D  Q ERROR
"RTN","BPSOSIY",68,0)
 . S ERROR=12
"RTN","BPSOSIY",69,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Non-multiple fields did not file")
"RTN","BPSOSIY",70,0)
 . D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",71,0)
 . D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",72,0)
 . D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",73,0)
 . D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",74,0)
 ;
"RTN","BPSOSIY",75,0)
 ; Build Multiple
"RTN","BPSOSIY",76,0)
 S SEQ=""
"RTN","BPSOSIY",77,0)
 F  S SEQ=$O(MOREDATA("IBDATA",SEQ)) Q:SEQ=""  D  I ERROR Q
"RTN","BPSOSIY",78,0)
 . K FDA,MSG,IENS
"RTN","BPSOSIY",79,0)
 . S FN=9002313.59902,IENS="+1,"_REC,IENS(1)=SEQ
"RTN","BPSOSIY",80,0)
 . S X1=$G(MOREDATA("IBDATA",SEQ,1)),X2=$G(MOREDATA("IBDATA",SEQ,2)),X3=$G(MOREDATA("IBDATA",SEQ,3))
"RTN","BPSOSIY",81,0)
 . ;
"RTN","BPSOSIY",82,0)
 . ; Update fields
"RTN","BPSOSIY",83,0)
 . S FDA(FN,IENS,.01)=$P(X1,U,1)    ;Plan ID
"RTN","BPSOSIY",84,0)
 . S FDA(FN,IENS,902.03)=$P(X1,U,2) ;BIN
"RTN","BPSOSIY",85,0)
 . S FDA(FN,IENS,902.04)=$P(X1,U,3) ;PCN
"RTN","BPSOSIY",86,0)
 . S FDA(FN,IENS,902.05)=$P(X1,U,5) ;Group ID
"RTN","BPSOSIY",87,0)
 . S FDA(FN,IENS,902.06)=$P(X1,U,6) ;Cardholder ID
"RTN","BPSOSIY",88,0)
 . S FDA(FN,IENS,902.07)=$S(+$P(X1,U,7)>4:4,1:+$P(X1,U,7)) ;Patient Relationship Code
"RTN","BPSOSIY",89,0)
 . S FDA(FN,IENS,902.08)=$P($P(X1,U,8)," ") ;Cardholder First Name
"RTN","BPSOSIY",90,0)
 . S FDA(FN,IENS,902.09)=$P(X1,U,9)  ;Cardholder Last Name
"RTN","BPSOSIY",91,0)
 . S FDA(FN,IENS,902.11)=$P(X1,U,10) ;Home Plan State
"RTN","BPSOSIY",92,0)
 . S FDA(FN,IENS,902.12)=$P(X2,U,1)  ;Dispense Fee
"RTN","BPSOSIY",93,0)
 . S FDA(FN,IENS,902.13)=$P(X2,U,2)  ;Basis of Cost Determination
"RTN","BPSOSIY",94,0)
 . S FDA(FN,IENS,902.14)=$P(X2,U,3)  ;Usual & Customary Charge
"RTN","BPSOSIY",95,0)
 . S FDA(FN,IENS,902.15)=$P(X2,U,4)  ;Gross Amt Due
"RTN","BPSOSIY",96,0)
 . S FDA(FN,IENS,902.16)=$P(X2,U,5)  ;Administrative Fee
"RTN","BPSOSIY",97,0)
 . S FDA(FN,IENS,902.17)=$P(B1,U,4)  ;VA Fill Number
"RTN","BPSOSIY",98,0)
 . S FDA(FN,IENS,902.18)=$P(X1,U,13) ;Software/Vendor Cert ID
"RTN","BPSOSIY",99,0)
 . S FDA(FN,IENS,902.22)=$P(B1,U,5)  ;Certify Mode
"RTN","BPSOSIY",100,0)
 . S FDA(FN,IENS,902.23)=$P(B1,U,6)  ;Certification IEN
"RTN","BPSOSIY",101,0)
 . S FDA(FN,IENS,902.24)=$P(X1,U,14) ;Plan Name
"RTN","BPSOSIY",102,0)
 . S FDA(FN,IENS,902.25)=$P(X3,U,1)  ;Group Name
"RTN","BPSOSIY",103,0)
 . S FDA(FN,IENS,902.26)=$P(X3,U,2)  ;Insurance Co Phone #
"RTN","BPSOSIY",104,0)
 . S FDA(FN,IENS,902.27)=$P(X3,U,3)  ;Pharmacy Plan ID
"RTN","BPSOSIY",105,0)
 . ;
"RTN","BPSOSIY",106,0)
 . ; File the data
"RTN","BPSOSIY",107,0)
 . D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIY",108,0)
 . I $D(MSG) D
"RTN","BPSOSIY",109,0)
 .. S ERROR=13
"RTN","BPSOSIY",110,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-Multiple fields did not file, SEQ="_SEQ)
"RTN","BPSOSIY",111,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",112,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",113,0)
 .. D LOG^BPSOSL(IEN59,"IENS Array:")
"RTN","BPSOSIY",114,0)
 .. D LOGARRAY^BPSOSL(IEN59,"IENS")
"RTN","BPSOSIY",115,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",116,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",117,0)
 . ;
"RTN","BPSOSIY",118,0)
 . ; Payer sheets are in external format
"RTN","BPSOSIY",119,0)
 . K FDA,MSG
"RTN","BPSOSIY",120,0)
 . S FN=9002313.59902,IENS=IENS(1)_","_REC
"RTN","BPSOSIY",121,0)
 . S FDA(FN,IENS,902.02)=$P(X1,U,4)  ;Payer Sheet IEN
"RTN","BPSOSIY",122,0)
 . S FDA(FN,IENS,902.19)=$P(X1,U,11) ;B2 Payer Sheet (Reversal)
"RTN","BPSOSIY",123,0)
 . S FDA(FN,IENS,902.21)=$P(X1,U,12) ;B3 Payer Sheet (Rebill)
"RTN","BPSOSIY",124,0)
 . D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSIY",125,0)
 . I $D(MSG) D
"RTN","BPSOSIY",126,0)
 .. S ERROR=14
"RTN","BPSOSIY",127,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-Payer sheets did not file, SEQ="_SEQ)
"RTN","BPSOSIY",128,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",129,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",130,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",131,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",132,0)
 ;
"RTN","BPSOSIY",133,0)
 ; Store DUR multiple if it exists
"RTN","BPSOSIY",134,0)
 N DUR,DURREC
"RTN","BPSOSIY",135,0)
 S FN=9002313.5913,DUR=0
"RTN","BPSOSIY",136,0)
 F  S DUR=$O(MOREDATA("DUR",DUR)) Q:DUR=""  D  I ERROR Q
"RTN","BPSOSIY",137,0)
 . K FDA,MSG,IENS
"RTN","BPSOSIY",138,0)
 . S DURREC=$G(MOREDATA("DUR",DUR,0))
"RTN","BPSOSIY",139,0)
 . S IENS="+1,"_REC,IENS(1)=DUR
"RTN","BPSOSIY",140,0)
 . S FDA(FN,IENS,.01)=DUR  ; DUR Counter
"RTN","BPSOSIY",141,0)
 . S FDA(FN,IENS,1)=$P(DURREC,U,1)    ; DUR Professional Service Code
"RTN","BPSOSIY",142,0)
 . S FDA(FN,IENS,2)=$P(DURREC,U,2)    ; DUR Reason for Service Code
"RTN","BPSOSIY",143,0)
 . S FDA(FN,IENS,3)=$P(DURREC,U,3)    ; DUR Result of Service Code
"RTN","BPSOSIY",144,0)
 . D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIY",145,0)
 . I $D(MSG) D
"RTN","BPSOSIY",146,0)
 .. S ERROR=15
"RTN","BPSOSIY",147,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-DUR fields did not file, DUR="_DUR)
"RTN","BPSOSIY",148,0)
 .. D LOG^BPSOSL(IEN59,"DURREC="_DURREC)
"RTN","BPSOSIY",149,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",150,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",151,0)
 .. D LOG^BPSOSL(IEN59,"IENS Array:")
"RTN","BPSOSIY",152,0)
 .. D LOGARRAY^BPSOSL(IEN59,"IENS")
"RTN","BPSOSIY",153,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",154,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",155,0)
 ;
"RTN","BPSOSIY",156,0)
 Q ERROR
"RTN","BPSOSIY",157,0)
 ;
"RTN","BPSOSIY",158,0)
 ; OVERRIDE - Function to create override record
"RTN","BPSOSIY",159,0)
OVERRIDE(IEN59) ;
"RTN","BPSOSIY",160,0)
 ;Save values into BPS NCPDP OVERRIDES (#9002313.511)
"RTN","BPSOSIY",161,0)
 N BPSFDA,BPSFLD,BPOVRIEN,BPSMSG,BPSQ
"RTN","BPSOSIY",162,0)
 ;
"RTN","BPSOSIY",163,0)
 ; Set Name (.01) to transaction number
"RTN","BPSOSIY",164,0)
 S BPSFDA(9002313.511,"+1,",.01)=IEN59
"RTN","BPSOSIY",165,0)
 ;
"RTN","BPSOSIY",166,0)
 ; Set Created On (.02) to current date/time
"RTN","BPSOSIY",167,0)
 S BPSFDA(9002313.511,"+1,",.02)=$$NOW^BPSOSRX()
"RTN","BPSOSIY",168,0)
 ;
"RTN","BPSOSIY",169,0)
 ; Submission Clarification Code
"RTN","BPSOSIY",170,0)
 I $G(MOREDATA("BPSCLARF"))]"" D
"RTN","BPSOSIY",171,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",420,""))
"RTN","BPSOSIY",172,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+2,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+2,+1,",.02)=$E(MOREDATA("BPSCLARF"),1,2)
"RTN","BPSOSIY",173,0)
 ;
"RTN","BPSOSIY",174,0)
 ; Prior Auth Fields (Code and Number)
"RTN","BPSOSIY",175,0)
 I $G(MOREDATA("BPSAUTH"))]"" D
"RTN","BPSOSIY",176,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",461,""))
"RTN","BPSOSIY",177,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+3,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+3,+1,",.02)=$E($P(MOREDATA("BPSAUTH"),U,1),1,2)
"RTN","BPSOSIY",178,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",462,""))
"RTN","BPSOSIY",179,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+4,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+4,+1,",.02)=$E($P(MOREDATA("BPSAUTH"),U,2),1,11)
"RTN","BPSOSIY",180,0)
 ;
"RTN","BPSOSIY",181,0)
 ; Create the record
"RTN","BPSOSIY",182,0)
 D UPDATE^DIE("","BPSFDA","BPOVRIEN","BPMSG")
"RTN","BPSOSIY",183,0)
 ;
"RTN","BPSOSIY",184,0)
 I $G(BPOVRIEN(1))]"" S BPSQ=BPOVRIEN(1)
"RTN","BPSOSIY",185,0)
 E  S BPSQ=""
"RTN","BPSOSIY",186,0)
 Q BPSQ
"RTN","BPSOSIY",187,0)
 ;
"RTN","BPSOSIY",188,0)
 ; RXPAID - Check for status of previous claim
"RTN","BPSOSIY",189,0)
 ; INPUT
"RTN","BPSOSIY",190,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSIY",191,0)
 ; Return
"RTN","BPSOSIY",192,0)
 ;   0 - OK
"RTN","BPSOSIY",193,0)
 ;   1 - Payable
"RTN","BPSOSIY",194,0)
 ;   2 - Reversal not accepted
"RTN","BPSOSIY",195,0)
 ;   3 - Duplicate
"RTN","BPSOSIY",196,0)
RXPAID(IEN59) ;EP - from BPSOSIZ
"RTN","BPSOSIY",197,0)
 N N57
"RTN","BPSOSIY",198,0)
 S N57=$$RXPREV(IEN59)
"RTN","BPSOSIY",199,0)
 I 'N57 Q ""  ; no ECME record of this
"RTN","BPSOSIY",200,0)
 ; If it's a reversal, then our result depends on the reversal:
"RTN","BPSOSIY",201,0)
 ;   Was the reversal accepted?   If so, then No, not paid.
"RTN","BPSOSIY",202,0)
 ;   Was the reversal rejected?   Assume Paid, since we try to
"RTN","BPSOSIY",203,0)
 ;        allow reversals only in the case of a paid original.
"RTN","BPSOSIY",204,0)
 I $$ISREVERS^BPSOS57(N57) Q $S($$REVACC^BPSOS57(N57):0,1:2)
"RTN","BPSOSIY",205,0)
 ;
"RTN","BPSOSIY",206,0)
 ; Not a reversal:
"RTN","BPSOSIY",207,0)
 N X S X=$$CATEG^BPSOSUC(N57)
"RTN","BPSOSIY",208,0)
 Q $S(X="E PAYABLE":1,X="E DUPLICATE":3,1:0)
"RTN","BPSOSIY",209,0)
 ;
"RTN","BPSOSIY",210,0)
 ; RXPREV - Has this item previously been through ECME?
"RTN","BPSOSIY",211,0)
 ; Return false if not
"RTN","BPSOSIY",212,0)
 ; Return pointer to BPS Log of Transactions if true
"RTN","BPSOSIY",213,0)
RXPREV(IEN59) ;
"RTN","BPSOSIY",214,0)
 N RXI,RXR
"RTN","BPSOSIY",215,0)
 S RXI=$P(IEN59,".",1),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIY",216,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,""),-1)
"RTN","BPSOSIZ")
0^174^B12107785
"RTN","BPSOSIZ",1,0)
BPSOSIZ ;BHAM ISC/FCS/DRS/DLF - Filing BPS Transaction ;06/01/2004
"RTN","BPSOSIZ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSIZ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSIZ",4,0)
 ;
"RTN","BPSOSIZ",5,0)
 Q
"RTN","BPSOSIZ",6,0)
 ;
"RTN","BPSOSIZ",7,0)
 ; EN - Create and/or update BPS Transaction
"RTN","BPSOSIZ",8,0)
 ; Input
"RTN","BPSOSIZ",9,0)
 ;   IEN59    - BPS Transaction number
"RTN","BPSOSIZ",10,0)
 ;   MOREDATA - Array of data created by BPSNCPD*
"RTN","BPSOSIZ",11,0)
EN(IEN59,MOREDATA) ;EP - BPSOSRB
"RTN","BPSOSIZ",12,0)
 ;
"RTN","BPSOSIZ",13,0)
 ; Initialize variables
"RTN","BPSOSIZ",14,0)
 N RX,RXR,EXISTS,ERROR,X
"RTN","BPSOSIZ",15,0)
 S ERROR=0,RX=$P(IEN59,"."),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIZ",16,0)
 ;
"RTN","BPSOSIZ",17,0)
 ;
"RTN","BPSOSIZ",18,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Building Transaction")
"RTN","BPSOSIZ",19,0)
 ;
"RTN","BPSOSIZ",20,0)
 ; Lock the transaction
"RTN","BPSOSIZ",21,0)
 I '$$LOCK59(IEN59) D ERROR(IEN59,"Could not lock the transaction") Q
"RTN","BPSOSIZ",22,0)
 ;
"RTN","BPSOSIZ",23,0)
 ; Check for claims that should not be resubmitted
"RTN","BPSOSIZ",24,0)
 S X=$$RXPAID^BPSOSIY(IEN59)
"RTN","BPSOSIZ",25,0)
 I X D ERROR(IEN59,"RXPAID^BPSOSIY returned "_X) Q
"RTN","BPSOSIZ",26,0)
 ;
"RTN","BPSOSIZ",27,0)
 ; Make sure that the record is not already IN PROGRESS
"RTN","BPSOSIZ",28,0)
 S X=+$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSIZ",29,0)
 I X'=0,X'=99 D ERROR(IEN59,"STATUS is "_X) Q
"RTN","BPSOSIZ",30,0)
 ;
"RTN","BPSOSIZ",31,0)
 ; Check if the BPS Transaction exists
"RTN","BPSOSIZ",32,0)
 S EXISTS=$$EXIST59(IEN59)
"RTN","BPSOSIZ",33,0)
 ;
"RTN","BPSOSIZ",34,0)
 ; If the record exists, delete all but the essential fields
"RTN","BPSOSIZ",35,0)
 I EXISTS D CLEAR59(IEN59)
"RTN","BPSOSIZ",36,0)
 ;
"RTN","BPSOSIZ",37,0)
 ; If the record does not exist, create new record and validate the IEN
"RTN","BPSOSIZ",38,0)
 I 'EXISTS S X=$$NEW59(IEN59) I X'=IEN59 D ERROR(IEN59,"NEW59 returned "_X) Q
"RTN","BPSOSIZ",39,0)
 ;
"RTN","BPSOSIZ",40,0)
 ; Update the fields.  If error is returned, log to the BPS Transaction, which
"RTN","BPSOSIZ",41,0)
 ;   we know exists at this point
"RTN","BPSOSIZ",42,0)
 S ERROR=$$INIT^BPSOSIY(IEN59)
"RTN","BPSOSIZ",43,0)
 I ERROR D ERROR^BPSOSU($T(+0),IEN59,ERROR,"BPS Transaction not updated"),UNLOCK59(IEN59) Q
"RTN","BPSOSIZ",44,0)
 ;
"RTN","BPSOSIZ",45,0)
 ; Validate the transaction
"RTN","BPSOSIZ",46,0)
 D ONE59^BPSOSQA(IEN59)
"RTN","BPSOSIZ",47,0)
 ;
"RTN","BPSOSIZ",48,0)
 ; Unlock the transaction
"RTN","BPSOSIZ",49,0)
 D UNLOCK59(IEN59)
"RTN","BPSOSIZ",50,0)
 Q
"RTN","BPSOSIZ",51,0)
 ;
"RTN","BPSOSIZ",52,0)
 ; LOCK59 - Lock Transaction
"RTN","BPSOSIZ",53,0)
LOCK59(IEN59) ;
"RTN","BPSOSIZ",54,0)
 L +^BPST(IEN59):5
"RTN","BPSOSIZ",55,0)
 Q $T
"RTN","BPSOSIZ",56,0)
 ;
"RTN","BPSOSIZ",57,0)
 ; UNLOCK59 - Unlock record
"RTN","BPSOSIZ",58,0)
UNLOCK59(IEN59) ;
"RTN","BPSOSIZ",59,0)
 L -^BPST(IEN59)
"RTN","BPSOSIZ",60,0)
 Q
"RTN","BPSOSIZ",61,0)
 ;
"RTN","BPSOSIZ",62,0)
 ; EXISTS - See if the BPS Transaction already exists
"RTN","BPSOSIZ",63,0)
EXIST59(IEN59) ;
"RTN","BPSOSIZ",64,0)
 N X
"RTN","BPSOSIZ",65,0)
 S X=$$FIND1^DIC(9002313.59,,"QX","`"_IEN59)
"RTN","BPSOSIZ",66,0)
 Q $S(X>0:X,X=0:0)
"RTN","BPSOSIZ",67,0)
 ;
"RTN","BPSOSIZ",68,0)
 ; NEW59 - Create a new BPS Transaction record
"RTN","BPSOSIZ",69,0)
NEW59(IEN59) ;
"RTN","BPSOSIZ",70,0)
 ; Initialize variables
"RTN","BPSOSIZ",71,0)
 N FDA,IEN,MSG,FN
"RTN","BPSOSIZ",72,0)
 ;
"RTN","BPSOSIZ",73,0)
 ; The .01 node and IEN should be the transaction number
"RTN","BPSOSIZ",74,0)
 S FN=9002313.59
"RTN","BPSOSIZ",75,0)
 S (IEN(1),FDA(FN,"+1,",.01))=IEN59
"RTN","BPSOSIZ",76,0)
 ;
"RTN","BPSOSIZ",77,0)
 ; Create the new BPS Transaction record
"RTN","BPSOSIZ",78,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPSOSIZ",79,0)
 I $D(MSG) Q 0
"RTN","BPSOSIZ",80,0)
 Q IEN(1)
"RTN","BPSOSIZ",81,0)
 ;
"RTN","BPSOSIZ",82,0)
 ; CLEAR59 - If it exists, clear out the old values
"RTN","BPSOSIZ",83,0)
CLEAR59(IEN59) ;
"RTN","BPSOSIZ",84,0)
 ; Deletes all values except for fields:
"RTN","BPSOSIZ",85,0)
 ;   Entry # (.01)
"RTN","BPSOSIZ",86,0)
 ;   Resubmit after reversal (1.12)
"RTN","BPSOSIZ",87,0)
 ;   Result Text (202)
"RTN","BPSOSIZ",88,0)
 ;   Comments (111 multiple)
"RTN","BPSOSIZ",89,0)
 ; If reverse/resubmit, then also do not clear fields:
"RTN","BPSOSIZ",90,0)
 ;   Status (1)
"RTN","BPSOSIZ",91,0)
 ;   Submit Date/Time (6)
"RTN","BPSOSIZ",92,0)
 ;   Last Update (7)
"RTN","BPSOSIZ",93,0)
 ;   Start Date (15)
"RTN","BPSOSIZ",94,0)
 ;
"RTN","BPSOSIZ",95,0)
 ; Initialize variables
"RTN","BPSOSIZ",96,0)
 N FN,FDA,MSG,FIELD,SKIP,ENTRY
"RTN","BPSOSIZ",97,0)
 S FN=9002313.59
"RTN","BPSOSIZ",98,0)
 ;
"RTN","BPSOSIZ",99,0)
 ; Set up fields that we do not want to delete
"RTN","BPSOSIZ",100,0)
 S SKIP(1.12)="",SKIP(202)=""
"RTN","BPSOSIZ",101,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=1 S SKIP(1)="",SKIP(6)="",SKIP(7)="",SKIP(15)=""
"RTN","BPSOSIZ",102,0)
 ;
"RTN","BPSOSIZ",103,0)
 ; Start with field .01 so it will not be deleted
"RTN","BPSOSIZ",104,0)
 ; Place 'non-skip' fields in FDA to be deleted
"RTN","BPSOSIZ",105,0)
 S FIELD=.01
"RTN","BPSOSIZ",106,0)
 F  S FIELD=$O(^DD(FN,FIELD)) Q:'FIELD  I '$D(SKIP(FIELD)) S FDA(FN,IEN59_",",FIELD)=""
"RTN","BPSOSIZ",107,0)
 ;
"RTN","BPSOSIZ",108,0)
 ; Delete Insurance multiple
"RTN","BPSOSIZ",109,0)
 S FN=9002313.59902,ENTRY=0
"RTN","BPSOSIZ",110,0)
 F  S ENTRY=$O(^BPST(IEN59,10,ENTRY)) Q:ENTRY="B"!(ENTRY="")  D
"RTN","BPSOSIZ",111,0)
 . S FDA(FN,ENTRY_","_IEN59_",",.01)=""
"RTN","BPSOSIZ",112,0)
 ;
"RTN","BPSOSIZ",113,0)
 ; Delete DUR multiple
"RTN","BPSOSIZ",114,0)
 S FN=9002313.5913,ENTRY=0
"RTN","BPSOSIZ",115,0)
 F  S ENTRY=$O(^BPST(IEN59,13,ENTRY)) Q:+ENTRY=0  D
"RTN","BPSOSIZ",116,0)
 . S FDA(FN,ENTRY_","_IEN59_",",.01)=""
"RTN","BPSOSIZ",117,0)
 ;
"RTN","BPSOSIZ",118,0)
 ; Fileman call to do the delete
"RTN","BPSOSIZ",119,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIZ",120,0)
 ;
"RTN","BPSOSIZ",121,0)
 ; Update Result Text File with 'PREVIOUSLY['
"RTN","BPSOSIZ",122,0)
 D PREVISLY(IEN59) ; for result text field 202
"RTN","BPSOSIZ",123,0)
 Q
"RTN","BPSOSIZ",124,0)
 ;
"RTN","BPSOSIZ",125,0)
 ; PREVISLY - Add semicolon in between the result text
"RTN","BPSOSIZ",126,0)
PREVISLY(IEN59) ;EP - BPSOSRB, BPSOSU
"RTN","BPSOSIZ",127,0)
 N X
"RTN","BPSOSIZ",128,0)
 S X=$$GET1^DIQ(9002313.59,IEN59,202)
"RTN","BPSOSIZ",129,0)
 I X="" Q
"RTN","BPSOSIZ",130,0)
 S X=$E(";"_X,1,200)
"RTN","BPSOSIZ",131,0)
 N FN,FDA,MSG
"RTN","BPSOSIZ",132,0)
 S FDA(9002313.59,IEN59_",",202)=X
"RTN","BPSOSIZ",133,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIZ",134,0)
 Q
"RTN","BPSOSIZ",135,0)
 ;
"RTN","BPSOSIZ",136,0)
 ; ERROR - Log an error to the log
"RTN","BPSOSIZ",137,0)
ERROR(IEN59,MSG) ;
"RTN","BPSOSIZ",138,0)
 N RX,RXR
"RTN","BPSOSIZ",139,0)
 S RX=$P(IEN59,"."),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIZ",140,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Skipping: "_$G(MSG))
"RTN","BPSOSIZ",141,0)
 K ^XTMP("BPSOSRX",RX,RXR)
"RTN","BPSOSIZ",142,0)
 D UNLOCK59(IEN59)
"RTN","BPSOSIZ",143,0)
 Q
"RTN","BPSOSK")
0^135^B7715281
"RTN","BPSOSK",1,0)
BPSOSK ;BHAM ISC/FCS/DRS/DLF - Winnow ECME data ;06/01/2004
"RTN","BPSOSK",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSK",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSK",4,0)
 Q
"RTN","BPSOSK",5,0)
 ;
"RTN","BPSOSK",6,0)
 ; MAIN
"RTN","BPSOSK",7,0)
MAIN ;
"RTN","BPSOSK",8,0)
 ; Set lock so only one job is running at a time
"RTN","BPSOSK",9,0)
 L +^TMP($T(+0)):0 Q:'$T
"RTN","BPSOSK",10,0)
 ;
"RTN","BPSOSK",11,0)
 ; New the common variables
"RTN","BPSOSK",12,0)
 N SLOT,TESTING
"RTN","BPSOSK",13,0)
 ;
"RTN","BPSOSK",14,0)
 ; Initialize the log and store slot in BPS Setup
"RTN","BPSOSK",15,0)
 ; Also keep previous two logs.
"RTN","BPSOSK",16,0)
 S SLOT=DT+.5
"RTN","BPSOSK",17,0)
 D LOG^BPSOSL(SLOT,"Start Purge","DT")
"RTN","BPSOSK",18,0)
 ;
"RTN","BPSOSK",19,0)
 S TESTING=$$GET1^DIQ(9002313.99,1,2341.01,"I")
"RTN","BPSOSK",20,0)
 I TESTING D LOG^BPSOSL(SLOT,"Test Mode - no data will be deleted")
"RTN","BPSOSK",21,0)
 I 'TESTING D LOG^BPSOSL(SLOT,"Purge Mode - data may be deleted")
"RTN","BPSOSK",22,0)
 ;
"RTN","BPSOSK",23,0)
 ; Delete the log file
"RTN","BPSOSK",24,0)
 N FILE,AGE,IEN,UPDT,IENS,MSG,FDA,ENDDT
"RTN","BPSOSK",25,0)
 S FILE=9002313.12
"RTN","BPSOSK",26,0)
 ;
"RTN","BPSOSK",27,0)
 ; Log start message
"RTN","BPSOSK",28,0)
 D LOG^BPSOSL(SLOT,"Winnowing file BPS LOG")
"RTN","BPSOSK",29,0)
 ;
"RTN","BPSOSK",30,0)
 ; Get number of days to keep on the system
"RTN","BPSOSK",31,0)
 S AGE=$$GET1^DIQ(9002313.99,1,2341.03)
"RTN","BPSOSK",32,0)
 I 'AGE D
"RTN","BPSOSK",33,0)
 . S AGE=365
"RTN","BPSOSK",34,0)
 . I '$D(^BPS(9002313.99,1)) Q
"RTN","BPSOSK",35,0)
 . N DIE,DA,DR,DTOUT
"RTN","BPSOSK",36,0)
 . S DIE=9002313.99,DA=1,DR="2341.03///"_AGE
"RTN","BPSOSK",37,0)
 . D ^DIE
"RTN","BPSOSK",38,0)
 ;
"RTN","BPSOSK",39,0)
 ; Calculate end date of purge
"RTN","BPSOSK",40,0)
 N X,X1,X2
"RTN","BPSOSK",41,0)
 S X1=DT,X2=(AGE*-1) D C^%DTC
"RTN","BPSOSK",42,0)
 S ENDDT=X
"RTN","BPSOSK",43,0)
 D LOG^BPSOSL(SLOT,"AGE is "_AGE_".  End Date is "_ENDDT)
"RTN","BPSOSK",44,0)
 ;
"RTN","BPSOSK",45,0)
 ; Loop through data and delete it
"RTN","BPSOSK",46,0)
 S UPDT="" F  S UPDT=$O(^BPS(FILE,"AC",UPDT)) Q:UPDT'<ENDDT!(UPDT="")  D
"RTN","BPSOSK",47,0)
 . S IEN="" F  S IEN=$O(^BPS(FILE,"AC",UPDT,IEN)) Q:'IEN  D
"RTN","BPSOSK",48,0)
 .. S IENS=IEN_","
"RTN","BPSOSK",49,0)
 .. ;
"RTN","BPSOSK",50,0)
 .. ; Never delete the highest entry in a file
"RTN","BPSOSK",51,0)
 .. ; This will prevent the re-use of IENs.
"RTN","BPSOSK",52,0)
 .. I '$O(^BPS(FILE,IEN)) Q
"RTN","BPSOSK",53,0)
 .. ;
"RTN","BPSOSK",54,0)
 .. ; Log the message
"RTN","BPSOSK",55,0)
 .. S MSG=$S(TESTING:"  We would delete",1:"  Deleting")
"RTN","BPSOSK",56,0)
 .. S MSG=MSG_" record "_IEN_" - "_$P($G(^BPS(FILE,IEN,0)),U,1)
"RTN","BPSOSK",57,0)
 .. D LOG^BPSOSL(SLOT,MSG)
"RTN","BPSOSK",58,0)
 .. ;
"RTN","BPSOSK",59,0)
 .. ; Quit if testing mode
"RTN","BPSOSK",60,0)
 .. I TESTING Q
"RTN","BPSOSK",61,0)
 .. ;
"RTN","BPSOSK",62,0)
 .. ; Do the delete
"RTN","BPSOSK",63,0)
 .. K FDA,MSG
"RTN","BPSOSK",64,0)
 .. S FDA(FILE,IENS,.01)=""
"RTN","BPSOSK",65,0)
 .. D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSK",66,0)
 .. I $D(MSG) D
"RTN","BPSOSK",67,0)
 ... D LOG^BPSOSL(SLOT,"Deletion failed - MSG array returned:")
"RTN","BPSOSK",68,0)
 ... D LOGARRAY^BPSOSL(SLOT,"MSG")
"RTN","BPSOSK",69,0)
 .. ;
"RTN","BPSOSK",70,0)
 .. ; Make sure the deletion worked: fetch the .01 field
"RTN","BPSOSK",71,0)
 .. I $$GET1^DIQ(FILE,IENS,.01)]"" D LOG^BPSOSL(SLOT,"Deletion failed-record still defined")
"RTN","BPSOSK",72,0)
 ;
"RTN","BPSOSK",73,0)
 ; Log ending message
"RTN","BPSOSK",74,0)
 D LOG^BPSOSL(SLOT,"Done with file BPS LOG")
"RTN","BPSOSK",75,0)
 ;
"RTN","BPSOSK",76,0)
 ; Unlock the job
"RTN","BPSOSK",77,0)
 L -^TMP($T(+0))
"RTN","BPSOSK",78,0)
 Q
"RTN","BPSOSK1")
1^136
"RTN","BPSOSK2")
1^137
"RTN","BPSOSL")
0^138^B6592911
"RTN","BPSOSL",1,0)
BPSOSL ;BHAM ISC/FCS/DRS/DLF - Logging ;06/01/2004
"RTN","BPSOSL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSL",4,0)
 Q
"RTN","BPSOSL",5,0)
 ; Entry Points:
"RTN","BPSOSL",6,0)
 ;   LOG  - Log a message
"RTN","BPSOSL",7,0)
 ;   LOG2CLM - Log a message to all transactions associated with a claim
"RTN","BPSOSL",8,0)
 ;   LOG2LIST - Log a message to all transactions in RXILIST
"RTN","BPSOSL",9,0)
 ;   LOGARRAY - Log array data into the transaction
"RTN","BPSOSL",10,0)
 ;   LOGARAY2 - Log array data into all transactions associated with a claim
"RTN","BPSOSL",11,0)
 ;
"RTN","BPSOSL",12,0)
 ; SLOT is usually a BPS Transaction, but can also be a communication log
"RTN","BPSOSL",13,0)
 ;   The only communication log currently is for purging (format is DT+.5)
"RTN","BPSOSL",14,0)
 ;
"RTN","BPSOSL",15,0)
 ; LOG - Add an entry to BPS LOG
"RTN","BPSOSL",16,0)
 ; Input
"RTN","BPSOSL",17,0)
 ;   SLOT - Slot to write message (required)
"RTN","BPSOSL",18,0)
 ;   TEXT - Message text (required)
"RTN","BPSOSL",19,0)
 ;   SPECIAL - Special processing (add date and/or time to TEXT
"RTN","BPSOSL",20,0)
 ;             If it contains a 'D', add Date
"RTN","BPSOSL",21,0)
 ;             If it contains a 'T', add time
"RTN","BPSOSL",22,0)
LOG(SLOT,TEXT,SPECIAL) ;
"RTN","BPSOSL",23,0)
 ; Check parameters
"RTN","BPSOSL",24,0)
 I $G(SLOT)="" Q
"RTN","BPSOSL",25,0)
 I $G(TEXT)="" Q
"RTN","BPSOSL",26,0)
 ;
"RTN","BPSOSL",27,0)
 ; Do SPECIAL processing
"RTN","BPSOSL",28,0)
 I $G(SPECIAL)]"",SPECIAL["D"!(SPECIAL["T") D
"RTN","BPSOSL",29,0)
 . N %,%H,%I,X,Y D NOW^%DTC S Y=% X ^DD("DD")
"RTN","BPSOSL",30,0)
 . I SPECIAL'["D" S Y=$P(Y,"@",2)
"RTN","BPSOSL",31,0)
 . I SPECIAL'["T" S Y=$P(Y,"@")
"RTN","BPSOSL",32,0)
 . S TEXT=TEXT_" - "_Y
"RTN","BPSOSL",33,0)
 ;
"RTN","BPSOSL",34,0)
 ; Initialize variables
"RTN","BPSOSL",35,0)
 N FN,FDA,LOGIEN,IEN,MSG,NOW
"RTN","BPSOSL",36,0)
 S FN=9002313.12,NOW=$$NOW^XLFDT()
"RTN","BPSOSL",37,0)
 ;
"RTN","BPSOSL",38,0)
 ; If SLOT not defined, create it and then check for errors
"RTN","BPSOSL",39,0)
 S LOGIEN=$O(^BPS(FN,"B",SLOT,""))
"RTN","BPSOSL",40,0)
 I 'LOGIEN D
"RTN","BPSOSL",41,0)
 . S FDA(FN,"+1,",.01)=SLOT
"RTN","BPSOSL",42,0)
 . D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPSOSL",43,0)
 . S LOGIEN=$G(IEN(1))
"RTN","BPSOSL",44,0)
 I 'LOGIEN!$D(MSG) Q
"RTN","BPSOSL",45,0)
 ;
"RTN","BPSOSL",46,0)
 ; Update LAST UPDATE field
"RTN","BPSOSL",47,0)
 K FDA,MSG
"RTN","BPSOSL",48,0)
 S FDA(FN,LOGIEN_",",.02)=NOW
"RTN","BPSOSL",49,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSL",50,0)
 I $D(MSG) Q
"RTN","BPSOSL",51,0)
 ;
"RTN","BPSOSL",52,0)
 ; Create the multiple
"RTN","BPSOSL",53,0)
 K FDA
"RTN","BPSOSL",54,0)
 S FN=9002313.1201
"RTN","BPSOSL",55,0)
 S FDA(FN,"+1,"_LOGIEN_",",.01)=NOW
"RTN","BPSOSL",56,0)
 S FDA(FN,"+1,"_LOGIEN_",",1)=$TR($E(TEXT,1,200),"^","~")
"RTN","BPSOSL",57,0)
 D UPDATE^DIE("","FDA")
"RTN","BPSOSL",58,0)
 Q
"RTN","BPSOSL",59,0)
 ;
"RTN","BPSOSL",60,0)
 ; LOG2CLM - Write MSG to log file for all BPS Transactions associated
"RTN","BPSOSL",61,0)
 ;   with the claim
"RTN","BPSOSL",62,0)
LOG2CLM(IEN02,MSG) ;
"RTN","BPSOSL",63,0)
 N IEN59 S IEN59=0
"RTN","BPSOSL",64,0)
 F  S IEN59=$O(^BPST("AE",IEN02,IEN59)) Q:'IEN59  D LOG(IEN59,MSG)
"RTN","BPSOSL",65,0)
 Q
"RTN","BPSOSL",66,0)
 ;
"RTN","BPSOSL",67,0)
 ; LOG2LIST - Write MSG to the log files of all in RXILIST(*)
"RTN","BPSOSL",68,0)
 ; Assumes RXILIST exists
"RTN","BPSOSL",69,0)
LOG2LIST(MSG) ;
"RTN","BPSOSL",70,0)
 N IEN59
"RTN","BPSOSL",71,0)
 S IEN59=0
"RTN","BPSOSL",72,0)
 F  S IEN59=$O(RXILIST(IEN59)) Q:'IEN59  D LOG(IEN59,MSG)
"RTN","BPSOSL",73,0)
 Q
"RTN","BPSOSL",74,0)
 ;
"RTN","BPSOSL",75,0)
 ; LOGARRAY - Log an array
"RTN","BPSOSL",76,0)
LOGARRAY(SLOT,ROOT,MAX) ;
"RTN","BPSOSL",77,0)
 N REF S REF=ROOT
"RTN","BPSOSL",78,0)
 N COUNT S COUNT=0
"RTN","BPSOSL",79,0)
 I '$D(MAX) S MAX=100
"RTN","BPSOSL",80,0)
 I $D(@REF)#10'=1 S REF=$Q(@REF)
"RTN","BPSOSL",81,0)
 F  Q:REF=""  D  Q:'MAX
"RTN","BPSOSL",82,0)
 . D LOG(SLOT,REF_"="_@REF)
"RTN","BPSOSL",83,0)
 . S COUNT=COUNT+1
"RTN","BPSOSL",84,0)
 . S REF=$Q(@REF)
"RTN","BPSOSL",85,0)
 . S MAX=MAX-1
"RTN","BPSOSL",86,0)
 I 'MAX,REF]"" D LOG(SLOT,"More of "_ROOT_" to log, but max reached")
"RTN","BPSOSL",87,0)
 I 'COUNT D LOG(SLOT,"Nothing found in "_ROOT)
"RTN","BPSOSL",88,0)
 Q
"RTN","BPSOSL",89,0)
 ;
"RTN","BPSOSL",90,0)
 ; LOGARAY2 - Log an array to the BPS Transactions associated with a claim
"RTN","BPSOSL",91,0)
LOGARAY2(IEN02,ROOT,MAX) ;
"RTN","BPSOSL",92,0)
 N IEN59
"RTN","BPSOSL",93,0)
 S IEN59=0
"RTN","BPSOSL",94,0)
 F  S IEN59=$O(^BPST("AE",IEN02,IEN59)) Q:'IEN59  D LOGARRAY(IEN59,ROOT,MAX)
"RTN","BPSOSL",95,0)
 Q
"RTN","BPSOSL1")
0^139^B8172126
"RTN","BPSOSL1",1,0)
BPSOSL1 ;BHAM ISC/FCS/DRS/DLF - log file printing ;06/01/2004
"RTN","BPSOSL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSL1",4,0)
 Q
"RTN","BPSOSL1",5,0)
 ;
"RTN","BPSOSL1",6,0)
 ;  Two entry points:
"RTN","BPSOSL1",7,0)
 ;    PRINTLOG to print the log file, given the LOG
"RTN","BPSOSL1",8,0)
 ;    PRINTDAT(type,start,end) prints all log files of the given
"RTN","BPSOSL1",9,0)
 ;      type in the given date range.  It prompts for missing parameters.
"RTN","BPSOSL1",10,0)
 ;
"RTN","BPSOSL1",11,0)
 ; PRINTDAT - Display Communication Log
"RTN","BPSOSL1",12,0)
 ; Input
"RTN","BPSOSL1",13,0)
 ;   TYPE  - Type of Communication Log.  If not specified, prompt
"RTN","BPSOSL1",14,0)
 ;   START - Start Date.  If not specified, prompt
"RTN","BPSOSL1",15,0)
 ;   END   - End Date.  If not specified, use START
"RTN","BPSOSL1",16,0)
PRINTDAT(TYPE,START,END) ;
"RTN","BPSOSL1",17,0)
 I '$D(TYPE) S TYPE=$$GETTYPE Q:'TYPE
"RTN","BPSOSL1",18,0)
 W !
"RTN","BPSOSL1",19,0)
 I $D(START) D
"RTN","BPSOSL1",20,0)
 . I '$D(END) S END=START
"RTN","BPSOSL1",21,0)
 E  D  Q:'START
"RTN","BPSOSL1",22,0)
 . S START=$$GETDATES,END=$P(START,U,2),START=$P(START,U)
"RTN","BPSOSL1",23,0)
 N POP D ^%ZIS Q:$G(POP)
"RTN","BPSOSL1",24,0)
 N FORDATE,STOP
"RTN","BPSOSL1",25,0)
 S FORDATE=START,STOP=0
"RTN","BPSOSL1",26,0)
 F  D  Q:FORDATE>END!STOP
"RTN","BPSOSL1",27,0)
 . N SLOT,EXISTS
"RTN","BPSOSL1",28,0)
 . S SLOT=FORDATE+(TYPE/10),EXISTS=$$EXISTS(SLOT)
"RTN","BPSOSL1",29,0)
 . I EXISTS D PRINTLOG(SLOT,.STOP)
"RTN","BPSOSL1",30,0)
 . I 'EXISTS  W "There is no log file ",SLOT,! H .25
"RTN","BPSOSL1",31,0)
 . S FORDATE=$$TADD^BPSOSUD(FORDATE,1) ; add one day
"RTN","BPSOSL1",32,0)
 D ^%ZISC
"RTN","BPSOSL1",33,0)
 Q
"RTN","BPSOSL1",34,0)
 ;
"RTN","BPSOSL1",35,0)
GETDATES() ; Return start^end
"RTN","BPSOSL1",36,0)
 N PROMPT1 S PROMPT1="Starting date: "
"RTN","BPSOSL1",37,0)
 N PROMPT2 S PROMPT2="  Ending date: "
"RTN","BPSOSL1",38,0)
 N DEF1,DEF2 S (DEF1,DEF2)=DT
"RTN","BPSOSL1",39,0)
 Q $$DTR^BPSOSU1(PROMPT1,PROMPT2,DEF1,DEF2,"")
"RTN","BPSOSL1",40,0)
 ;
"RTN","BPSOSL1",41,0)
 ; Currently, we only have one communication log, which is .5=winnowing
"RTN","BPSOSL1",42,0)
 ;   so we will return that.  Kept old code that allowed a selection in
"RTN","BPSOSL1",43,0)
 ;   case we add other logs again
"RTN","BPSOSL1",44,0)
GETTYPE() ; Return log type
"RTN","BPSOSL1",45,0)
 Q 5
"RTN","BPSOSL1",46,0)
 N PROMPT S PROMPT="Which log file? "
"RTN","BPSOSL1",47,0)
 N DEF S DEF=5
"RTN","BPSOSL1",48,0)
 N MODE S MODE="V"
"RTN","BPSOSL1",49,0)
 N MENU S MENU="5:Winnowing;"
"RTN","BPSOSL1",50,0)
 Q $$SET^BPSOSU3(PROMPT,DEF,1,MODE,MENU)
"RTN","BPSOSL1",51,0)
 ;
"RTN","BPSOSL1",52,0)
 ; PRINTLOG - Print a log
"RTN","BPSOSL1",53,0)
 ; Input
"RTN","BPSOSL1",54,0)
 ;   SLOT - Log to display
"RTN","BPSOSL1",55,0)
 ;   STOP - If user quit from the display
"RTN","BPSOSL1",56,0)
PRINTLOG(SLOT,STOP) ; EP - Above and BPSOS6M
"RTN","BPSOSL1",57,0)
 ;
"RTN","BPSOSL1",58,0)
 ; Validate parameters
"RTN","BPSOSL1",59,0)
 I '$G(SLOT) Q
"RTN","BPSOSL1",60,0)
 ;
"RTN","BPSOSL1",61,0)
 ; Initialize variables
"RTN","BPSOSL1",62,0)
 N IEN,LEN,UPDT,SEQ,UPDT,TEXT
"RTN","BPSOSL1",63,0)
 N PREVDATE,PREVTIME,EXDTTM
"RTN","BPSOSL1",64,0)
 ;
"RTN","BPSOSL1",65,0)
 ; Set IEN for the slot.  If it does not exist, display message and quit
"RTN","BPSOSL1",66,0)
 S IEN=$$EXISTS(SLOT)
"RTN","BPSOSL1",67,0)
 I 'IEN W "Nothing in SLOT=",SLOT,! Q
"RTN","BPSOSL1",68,0)
 ;
"RTN","BPSOSL1",69,0)
 ; Do the Header
"RTN","BPSOSL1",70,0)
 I $Y D HDR
"RTN","BPSOSL1",71,0)
 ;
"RTN","BPSOSL1",72,0)
 ; Loop through text and display
"RTN","BPSOSL1",73,0)
 S (PREVDATE,PREVTIME)="",STOP=0,LEN=$S($G(IOM):IOM,1:80)-10-1
"RTN","BPSOSL1",74,0)
 S UPDT="" F  S UPDT=$O(^BPS(9002313.12,IEN,10,"B",UPDT)) Q:UPDT=""  D  Q:STOP
"RTN","BPSOSL1",75,0)
 . S SEQ="" F  S SEQ=$O(^BPS(9002313.12,IEN,10,"B",UPDT,SEQ)) Q:SEQ=""  D  Q:STOP
"RTN","BPSOSL1",76,0)
 .. S TEXT=$P($G(^BPS(9002313.12,IEN,10,SEQ,1)),U,1)
"RTN","BPSOSL1",77,0)
 .. S EXDTTM=$$FMTE^XLFDT(UPDT,1)
"RTN","BPSOSL1",78,0)
 .. I PREVDATE'=$P(UPDT,".",1) D
"RTN","BPSOSL1",79,0)
 ... S PREVDATE=$P(UPDT,".",1)
"RTN","BPSOSL1",80,0)
 ... W !,$P(EXDTTM,"@",1),!
"RTN","BPSOSL1",81,0)
 .. I $P(UPDT,".",2)'=PREVTIME D
"RTN","BPSOSL1",82,0)
 ... S PREVTIME=$P(UPDT,".",2)
"RTN","BPSOSL1",83,0)
 ... W $P(EXDTTM,"@",2)
"RTN","BPSOSL1",84,0)
 .. N I F I=1:LEN:$L(TEXT) D  Q:STOP
"RTN","BPSOSL1",85,0)
 ... I I>1 W ?6,"..."
"RTN","BPSOSL1",86,0)
 ... W ?10,$E(TEXT,I,I+LEN-1),!
"RTN","BPSOSL1",87,0)
 ... D EOP
"RTN","BPSOSL1",88,0)
 Q
"RTN","BPSOSL1",89,0)
 ;
"RTN","BPSOSL1",90,0)
EOP ; end of page handling
"RTN","BPSOSL1",91,0)
 ; set STOP if the user wants to get out
"RTN","BPSOSL1",92,0)
 S STOP=$$EOPQ^BPSOSU8(2,,"D HDR^"_$T(+0))
"RTN","BPSOSL1",93,0)
 Q
"RTN","BPSOSL1",94,0)
 ;
"RTN","BPSOSL1",95,0)
HDR W @IOF,"Log file #",SLOT,!
"RTN","BPSOSL1",96,0)
 Q
"RTN","BPSOSL1",97,0)
 ;
"RTN","BPSOSL1",98,0)
 ; Get internal number for the slot
"RTN","BPSOSL1",99,0)
EXISTS(SLOT) ; EP - Above and BPSOS6M
"RTN","BPSOSL1",100,0)
 I $G(SLOT)="" Q ""
"RTN","BPSOSL1",101,0)
 Q $O(^BPS(9002313.12,"B",SLOT,""))
"RTN","BPSOSL1",102,0)
 ;
"RTN","BPSOSM")
1^71
"RTN","BPSOSM1")
1^109
"RTN","BPSOSM2")
1^110
"RTN","BPSOSNC")
1^111
"RTN","BPSOSO")
0^29^B2239666
"RTN","BPSOSO",1,0)
BPSOSO ;BHAM ISC/FCS/DRS/DLF - "O" is for Override NCPDP field values ;06/01/2004
"RTN","BPSOSO",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSO",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSO",4,0)
 ;
"RTN","BPSOSO",5,0)
 ; File 9002313.511 BPS NCPDP OVERRIDE
"RTN","BPSOSO",6,0)
 ;
"RTN","BPSOSO",7,0)
 ; IHS/SD/lwj 8/20/02 NCPDP 5.1 changes
"RTN","BPSOSO",8,0)
 ; In 5.1 there is now some repeating fields/records.  The DUR/PPS
"RTN","BPSOSO",9,0)
 ; segment is a repeating segment (i.e. all the fields in this
"RTN","BPSOSO",10,0)
 ; segment repeat.)  Much like the values for the BPS NCPDP
"RTN","BPSOSO",11,0)
 ; Overrides are stored in a separate file, and referenced in
"RTN","BPSOSO",12,0)
 ; the prescription file, the DUR/PPS values will be stored in
"RTN","BPSOSO",13,0)
 ; a separate file (BPS DUR/PPS) and simply referenced in the
"RTN","BPSOSO",14,0)
 ; prescription file.  For this reason, I'm adding the retrieval
"RTN","BPSOSO",15,0)
 ; of the prescription DUR/PPS pointer in this routine to keep
"RTN","BPSOSO",16,0)
 ; things consistent.
"RTN","BPSOSO",17,0)
 ;
"RTN","BPSOSO",18,0)
 Q
"RTN","BPSOSO",19,0)
 ;
"RTN","BPSOSO",20,0)
OVERRIDE(IEN) ; main entry point
"RTN","BPSOSO",21,0)
 ; IEN points to file 9002313.511
"RTN","BPSOSO",22,0)
 ; Sometimes we have IEN; sometimes we don't
"RTN","BPSOSO",23,0)
 ; called from pharmacy package
"RTN","BPSOSO",24,0)
 ; called from somewhere in POS, too
"RTN","BPSOSO",25,0)
 I $D(IEN) D
"RTN","BPSOSO",26,0)
 . I '$D(^BPS(9002313.511,IEN)) D  ; it must have been winnowed
"RTN","BPSOSO",27,0)
 . . S IEN=$$NEW^BPSOSO2
"RTN","BPSOSO",28,0)
 E  D
"RTN","BPSOSO",29,0)
 . I '$D(IEN) S IEN=$$NEW^BPSOSO2
"RTN","BPSOSO",30,0)
 I 'IEN N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("FM,P","TI","Failed to create Overrides record / or bad parameter in call",,"OVERRIDE",$T(+0)) Q ""
"RTN","BPSOSO",31,0)
 D MENU^BPSOSO1(IEN)
"RTN","BPSOSO",32,0)
 Q IEN
"RTN","BPSOSO",33,0)
OVERRIDR(RXI,RXR) ; alternative entry point - given RXI,RXR instead of IEN
"RTN","BPSOSO",34,0)
 N IEN
"RTN","BPSOSO",35,0)
 I $G(RXR) S IEN=$$GETIEN(RXI,RXR)
"RTN","BPSOSO",36,0)
 E  S IEN=$$GETIEN(RXI)
"RTN","BPSOSO",37,0)
 S IEN=$$OVERRIDE(IEN)
"RTN","BPSOSO",38,0)
 Q IEN
"RTN","BPSOSO",39,0)
GETIEN(RXI,RXR) ;EP -  also called from claim construction
"RTN","BPSOSO",40,0)
 Q ""
"RTN","BPSOSO2")
0^175^B31121702
"RTN","BPSOSO2",1,0)
BPSOSO2 ;BHAM ISC/FCS/DRS/DLF - NCPDP Override-Fman utils ;06/01/2004
"RTN","BPSOSO2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSOSO2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSO2",4,0)
 Q
"RTN","BPSOSO2",5,0)
 ; EDIT,EDITGEN are called from the menus in BPSOSO1,
"RTN","BPSOSO2",6,0)
 ;   typically reached from the pharmacy package's call
"RTN","BPSOSO2",7,0)
 ;   to OVERRIDE^BPSOSO
"RTN","BPSOSO2",8,0)
 ; GET511 is called from BPSOSCD during claim construction
"RTN","BPSOSO2",9,0)
 ;
"RTN","BPSOSO2",10,0)
 ;IHS/SD/lwj 8/01/02  NCPDP 5.1 changes to GET511 subroutine
"RTN","BPSOSO2",11,0)
 ; Routine was changed to look at an exceptions list, if the
"RTN","BPSOSO2",12,0)
 ; field being processed is in the exceptions list it will
"RTN","BPSOSO2",13,0)
 ; create a "claim header" and "claim rx" entry.  The reason
"RTN","BPSOSO2",14,0)
 ; for this is that several 300 range fields were moved to the
"RTN","BPSOSO2",15,0)
 ; claim rx area within the 5.1 segments creating duplicate flds.
"RTN","BPSOSO2",16,0)
 ; (i.e. the <402 and >402 rule is no longer valid)
"RTN","BPSOSO2",17,0)
 ;
"RTN","BPSOSO2",18,0)
 ; New routine (PRIORA) added to handle the input of the prior
"RTN","BPSOSO2",19,0)
 ; authorization information at prescription creation time.
"RTN","BPSOSO2",20,0)
 ;
"RTN","BPSOSO2",21,0)
EDIT(IEN,FIELDNUM) ;
"RTN","BPSOSO2",22,0)
 I '$D(FIELDNUM) D EDITGEN(IEN) Q
"RTN","BPSOSO2",23,0)
 ; Editing one field
"RTN","BPSOSO2",24,0)
 N DIE,DA,DR,DIDEL,DTOUT,FIELDNAM
"RTN","BPSOSO2",25,0)
 S DA=$$HASVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",26,0)
 ; Make sure the entry exists in the subfile.
"RTN","BPSOSO2",27,0)
 ; Create an empty one if necessary.
"RTN","BPSOSO2",28,0)
 I 'DA S DA=$$SETVALUE(IEN,FIELDNUM,"")
"RTN","BPSOSO2",29,0)
 ; edit the value field in the subfile
"RTN","BPSOSO2",30,0)
 S DIE="^BPS(9002313.511,"_IEN_",1,",DA(1)=IEN
"RTN","BPSOSO2",31,0)
 S DR=.02_$TR($$FIELDNAM(FIELDNUM),""";~","")
"RTN","BPSOSO2",32,0)
 D ^DIE
"RTN","BPSOSO2",33,0)
 ; If the value is null, then delete the entire FIELDNUM entry
"RTN","BPSOSO2",34,0)
 I $$GETVALUE(IEN,FIELDNUM)="" D DELVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",35,0)
 Q
"RTN","BPSOSO2",36,0)
EDITGEN(IEN) ; general edit
"RTN","BPSOSO2",37,0)
 ; First pass:  quick & dirty Fileman ^DIE call
"RTN","BPSOSO2",38,0)
 ; Future: Screenman interface
"RTN","BPSOSO2",39,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSO2",40,0)
 S DA=IEN,DIE=$$FILENUM,DR=1 D ^DIE
"RTN","BPSOSO2",41,0)
 ; And we need to delete any entries with null values
"RTN","BPSOSO2",42,0)
 N A S A=0 F  S A=$O(^BPS(9002313.511,IEN,1,A)) Q:'A  D
"RTN","BPSOSO2",43,0)
 . N X S X=^BPS(9002313.511,IEN,1,A,0)
"RTN","BPSOSO2",44,0)
 . I $P(X,U,2)="" D
"RTN","BPSOSO2",45,0)
 . . N FIELDNUM S FIELDNUM=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSO2",46,0)
 . . D DELVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",47,0)
 Q
"RTN","BPSOSO2",48,0)
GET511(IEN,ARR101,ARR402) ;EP - from BPSOSCD - load arrays with data from IEN
"RTN","BPSOSO2",49,0)
 ;
"RTN","BPSOSO2",50,0)
 N A,C S A=0,C=0
"RTN","BPSOSO2",51,0)
 N X,F,HDRLST,MULTLST,TFLD,BPFLDNUM
"RTN","BPSOSO2",52,0)
 ;
"RTN","BPSOSO2",53,0)
 ; Build the exception lists
"RTN","BPSOSO2",54,0)
 S HDRLST=",524,",MULTLST=",308,315,316,317,318,319,320,327,"
"RTN","BPSOSO2",55,0)
 ;
"RTN","BPSOSO2",56,0)
 F  S A=$O(^BPS(9002313.511,IEN,1,A)) Q:'A  D
"RTN","BPSOSO2",57,0)
 . S X=^BPS(9002313.511,IEN,1,A,0)
"RTN","BPSOSO2",58,0)
 . S F=$P(X,U) ; Field IEN, points to 9002313.91
"RTN","BPSOSO2",59,0)
 . ; Store in either claim header or claim detail, based on field #
"RTN","BPSOSO2",60,0)
 . ; Note that logic below will put 401 field in both header and detail
"RTN","BPSOSO2",61,0)
 . S BPFLDNUM=+$$FIELDNUM(F)
"RTN","BPSOSO2",62,0)
 . S TFLD=","_BPFLDNUM_","
"RTN","BPSOSO2",63,0)
 . I BPFLDNUM<402!(HDRLST[TFLD) S @ARR101@(F)=$P(X,U,2)
"RTN","BPSOSO2",64,0)
 . I BPFLDNUM>400!(MULTLST[TFLD) S @ARR402@(F)=$P(X,U,2)
"RTN","BPSOSO2",65,0)
 . ;
"RTN","BPSOSO2",66,0)
 . S C=C+1
"RTN","BPSOSO2",67,0)
 Q C
"RTN","BPSOSO2",68,0)
 ;
"RTN","BPSOSO2",69,0)
 ; Generalized utilities - good for everything, not just auth #
"RTN","BPSOSO2",70,0)
LOCK() L +^BPS(9002313.511,IEN):300 Q $T
"RTN","BPSOSO2",71,0)
UNLOCK L -^BPS(9002313.511,IEN) Q
"RTN","BPSOSO2",72,0)
FILENUM() Q 9002313.511
"RTN","BPSOSO2",73,0)
SUBFNUM() Q 9002313.5111
"RTN","BPSOSO2",74,0)
FLOCK() L +^BPS(9002313.511):300 Q $T
"RTN","BPSOSO2",75,0)
FUNLOCK L -^BPS(9002313.511) Q
"RTN","BPSOSO2",76,0)
FIELDIEN(FIELDNUM) ; ien of a 9002313.91 NCPDP Data Dictionary field
"RTN","BPSOSO2",77,0)
 Q $$FIND1^DIC(9002313.91,,,FIELDNUM)
"RTN","BPSOSO2",78,0)
FIELDNAM(FIELDNUM) ; name of a 9002313.91 NCPDP Data Dictionary field
"RTN","BPSOSO2",79,0)
 Q $$GET1^DIQ(9002313.91,$$FIELDIEN(FIELDNUM),.03)
"RTN","BPSOSO2",80,0)
 ; given pointer to NCPDP Data Dictionary fields, return external #
"RTN","BPSOSO2",81,0)
FIELDNUM(IEN91) Q $P($G(^BPSF(9002313.91,IEN91,0)),U)
"RTN","BPSOSO2",82,0)
NEW() ;EP -  create new entry in 9002313.511
"RTN","BPSOSO2",83,0)
 F  Q:$$FLOCK  Q:'$$IMPOSS^BPSOSUE("L","RTI","interlock on new Override record creation",,"NEW",$T(+0))
"RTN","BPSOSO2",84,0)
 N FLAGS,FDA,IEN,MSG,FN,X,NEWREC S FN=$$FILENUM
"RTN","BPSOSO2",85,0)
 D NEW1
"RTN","BPSOSO2",86,0)
 D FUNLOCK
"RTN","BPSOSO2",87,0)
 Q NEWREC
"RTN","BPSOSO2",88,0)
NEW1 ;
"RTN","BPSOSO2",89,0)
 S FDA(FN,"+1,",.01)=$O(^BPS(FN,"B",999999999999),-1)+1
"RTN","BPSOSO2",90,0)
 D UPDATE^DIE(,"FDA","IEN","MSG")
"RTN","BPSOSO2",91,0)
 I $D(MSG) D  G NEW1:$$IMPOSS^BPSOSUE("FM","TRI","UPDATE^DIE failed",,"NEW1",$T(+0))
"RTN","BPSOSO2",92,0)
 . D ZWRITE^BPSOS("FDA","IEN","MSG")
"RTN","BPSOSO2",93,0)
 . K MSG
"RTN","BPSOSO2",94,0)
 S NEWREC=IEN(1)
"RTN","BPSOSO2",95,0)
NEW2 ;
"RTN","BPSOSO2",96,0)
 S FDA(FN,NEWREC_",",.02)="NOW"
"RTN","BPSOSO2",97,0)
 D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSO2",98,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",99,0)
 G NEW2:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"NEW2",$T(+0))
"RTN","BPSOSO2",100,0)
 Q
"RTN","BPSOSO2",101,0)
HASVALUE(IEN,FIELDNUM) ; does the FIELDNUM have an override value?
"RTN","BPSOSO2",102,0)
 ; returns IEN into the subfile
"RTN","BPSOSO2",103,0)
 Q $$FIND1^DIC($$SUBFNUM,","_IEN_",",,FIELDNUM)
"RTN","BPSOSO2",104,0)
GETVALUE(IEN,FIELDNUM) ; return currently-set override value for given FIELDNUM
"RTN","BPSOSO2",105,0)
 N X S X=$$HASVALUE(IEN,FIELDNUM) I 'X Q ""
"RTN","BPSOSO2",106,0)
 Q $$GET1^DIQ($$SUBFNUM,X_","_IEN_",",.02)
"RTN","BPSOSO2",107,0)
SETVALUE(IEN,FIELDNUM,VALUE) ;
"RTN","BPSOSO2",108,0)
 ; can DO or $$; $$ = ien in subfile for this FIELDNUM
"RTN","BPSOSO2",109,0)
 ; Special case for the override file:  if you're trying to set the
"RTN","BPSOSO2",110,0)
 ; field's value to "@", don't just delete the field value,
"RTN","BPSOSO2",111,0)
 ; which would leave the field defined with a null value.
"RTN","BPSOSO2",112,0)
 ; Instead, delete the entire override for the field.
"RTN","BPSOSO2",113,0)
 ; This prevents accidentally overriding a genuine value with null.
"RTN","BPSOSO2",114,0)
 I "@"=VALUE D DELVALUE(IEN,FIELDNUM) Q ""
"RTN","BPSOSO2",115,0)
 ; But the usual case is just storing a value:
"RTN","BPSOSO2",116,0)
 N FDA,MSG,IENS,IENARRAY
"RTN","BPSOSO2",117,0)
 ; Note:  I tried the "+?1,ien," method but it always created a new
"RTN","BPSOSO2",118,0)
 ; entry, even when it meant creating duplicates.  So now we test to
"RTN","BPSOSO2",119,0)
 ; see if there's already an entry for the fieldnum, and if not,
"RTN","BPSOSO2",120,0)
 ; then we put in a "+1,"
"RTN","BPSOSO2",121,0)
 N ENTRY S ENTRY=$$HASVALUE(IEN,FIELDNUM) ; do we already have FIELDNUM
"RTN","BPSOSO2",122,0)
 I 'ENTRY S ENTRY="+1" ; if not, then create a new entry
"RTN","BPSOSO2",123,0)
 S IENS=ENTRY_","_IEN_","
"RTN","BPSOSO2",124,0)
 S FDA($$SUBFNUM,IENS,.01)=FIELDNUM
"RTN","BPSOSO2",125,0)
 S FDA($$SUBFNUM,IENS,.02)=VALUE
"RTN","BPSOSO2",126,0)
 D SETV1
"RTN","BPSOSO2",127,0)
 I ENTRY="+1" S ENTRY=$G(IENARRAY(1))
"RTN","BPSOSO2",128,0)
 Q ENTRY
"RTN","BPSOSO2",129,0)
SETV1 ;
"RTN","BPSOSO2",130,0)
 D UPDATE^DIE("E","FDA","IENARRAY","MSG")
"RTN","BPSOSO2",131,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",132,0)
 K ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE")
"RTN","BPSOSO2",133,0)
 S ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE")=$$ERRHDR
"RTN","BPSOSO2",134,0)
 M ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE","MSG")=MSG
"RTN","BPSOSO2",135,0)
 I $D(IENARRAY) M ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE","IENARRAY")=IENARRAY
"RTN","BPSOSO2",136,0)
 D ZWRITE^BPSOS("FDA","IENARRAY","MSG")
"RTN","BPSOSO2",137,0)
 G SETV1:$$IMPOSS^BPSOSUE("FM","TRI",,,"SETVALUE",$T(+0))
"RTN","BPSOSO2",138,0)
 Q
"RTN","BPSOSO2",139,0)
DELVALUE(IEN,FIELDNUM) ;
"RTN","BPSOSO2",140,0)
 N ENTRY S ENTRY=$$HASVALUE(IEN,FIELDNUM) Q:'ENTRY  ; wasn't defined
"RTN","BPSOSO2",141,0)
 N FDA,MSG
"RTN","BPSOSO2",142,0)
 S FDA($$SUBFNUM,ENTRY_","_IEN_",",.01)="@"
"RTN","BPSOSO2",143,0)
DE5 D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSO2",144,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",145,0)
 K ^TMP("BPS",$J,"BPSOSO2",$J,"DELVALUE")
"RTN","BPSOSO2",146,0)
 S ^TMP("BPS",$J,"BPSOSO2",$J,"DELVALUE")=$$ERRHDR
"RTN","BPSOSO2",147,0)
 D ZWRITE^BPSOS("IEN","FDA","MSG")
"RTN","BPSOSO2",148,0)
 G DE5:$$IMPOSS^BPSOSUE("FM","TRI",,,"DELVALUE",$T(+0))
"RTN","BPSOSO2",149,0)
 Q
"RTN","BPSOSO2",150,0)
ERRHDR() Q "ERROR AT $H="_$H_" FOR $J="_$J
"RTN","BPSOSO2",151,0)
SEE(IEN) N TMP M TMP=^BPS($$FILENUM,IEN) D ZWRITE^BPSOS("TMP") Q  ; debugging
"RTN","BPSOSO2",152,0)
 ;
"RTN","BPSOSO2",153,0)
PRIORA(IEN) ;IHS/SD/lwj 9/3/02 NCPDP 5.1 Changes - Prior Authorization
"RTN","BPSOSO2",154,0)
 ; We are still processing 5.1 and 3.2 claims, so we have to be able
"RTN","BPSOSO2",155,0)
 ; to populate fields 461, 462 and 416.  416 will be created based
"RTN","BPSOSO2",156,0)
 ; on the input into fields 461, and 462.
"RTN","BPSOSO2",157,0)
 ;
"RTN","BPSOSO2",158,0)
 N FIELDNUM
"RTN","BPSOSO2",159,0)
 ;
"RTN","BPSOSO2",160,0)
 S FIELDNUM=461       ;Prior authorization type code
"RTN","BPSOSO2",161,0)
 D EDIT(IEN,FIELDNUM)
"RTN","BPSOSO2",162,0)
 ;
"RTN","BPSOSO2",163,0)
 S FIELDNUM=462       ;Prior authorization number submitted
"RTN","BPSOSO2",164,0)
 D EDIT(IEN,FIELDNUM)
"RTN","BPSOSO2",165,0)
 ;
"RTN","BPSOSO2",166,0)
 ;now we combine field 461 and 462 to creat field 416
"RTN","BPSOSO2",167,0)
 ;
"RTN","BPSOSO2",168,0)
 N VAL461,VAL462,VAL416,DA
"RTN","BPSOSO2",169,0)
 S (VAL461,VAL462,VAL416)=""
"RTN","BPSOSO2",170,0)
 ;
"RTN","BPSOSO2",171,0)
 S VAL461=$$GETVALUE(IEN,461)
"RTN","BPSOSO2",172,0)
 S VAL462=$$GETVALUE(IEN,462)
"RTN","BPSOSO2",173,0)
 S VAL416=VAL461_VAL462
"RTN","BPSOSO2",174,0)
 Q:VAL416=""
"RTN","BPSOSO2",175,0)
 ;
"RTN","BPSOSO2",176,0)
 S DA=$$SETVALUE(IEN,416,"")
"RTN","BPSOSO2",177,0)
 S:$G(DA)'="" DA=$$SETVALUE(IEN,416,VAL416)
"RTN","BPSOSO2",178,0)
 ;
"RTN","BPSOSO2",179,0)
 ;
"RTN","BPSOSO2",180,0)
 Q
"RTN","BPSOSP")
1^68
"RTN","BPSOSQ")
0^140^B1468656
"RTN","BPSOSQ",1,0)
BPSOSQ ;BHAM ISC/FCS/DRS/DLF - BPS Transactions Utils ;06/01/2004
"RTN","BPSOSQ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQ",4,0)
 Q
"RTN","BPSOSQ",5,0)
 ;
"RTN","BPSOSQ",6,0)
 ; Numerous little functions for BPS Transactions
"RTN","BPSOSQ",7,0)
 ; BPS Log of Transaction versions in BPSOS57
"RTN","BPSOSQ",8,0)
 ; All functions assume that IEN59 will exist
"RTN","BPSOSQ",9,0)
 ;
"RTN","BPSOSQ",10,0)
RXI() Q $P(^BPST(IEN59,1),U,11) ; Given IEN59, return RXI
"RTN","BPSOSQ",11,0)
RXR() Q $P(^BPST(IEN59,1),U,1) ; Given IEN59, return RXR
"RTN","BPSOSQ",12,0)
NDC() Q $P(^BPST(IEN59,1),U,2)
"RTN","BPSOSQ",13,0)
QTY() Q $P(^BPST(IEN59,5),U) ; Given IEN59, return quantity
"RTN","BPSOSQ",14,0)
AMT() Q $P(^BPST(IEN59,5),U,5) ; return total $amount
"RTN","BPSOSQ",15,0)
CHG() Q $P(^BPST(IEN59,5),U,5) ; Given IEN59, ret total charge
"RTN","BPSOSQ",16,0)
PATIENT() Q $P(^BPST(IEN59,0),U,6)
"RTN","BPSOSQ",17,0)
USER() N X S X=$P(^BPST(IEN59,0),U,10) S:'X X=$G(DUZ) Q X
"RTN","BPSOSQ",18,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ1")
1^141
"RTN","BPSOSQ2")
0^150^B19065204
"RTN","BPSOSQ2",1,0)
BPSOSQ2 ;BHAM ISC/FCS/DRS/DLF - form transmission packets ;06/01/2004
"RTN","BPSOSQ2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQ2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQ2",4,0)
 ; Construct packets for transmission
"RTN","BPSOSQ2",5,0)
 Q
"RTN","BPSOSQ2",6,0)
 ;
"RTN","BPSOSQ2",7,0)
PACKETS ; EP - Tasked by BPSOSQA
"RTN","BPSOSQ2",8,0)
 ;
"RTN","BPSOSQ2",9,0)
 ; Initialize
"RTN","BPSOSQ2",10,0)
 N ERROR,RXILIST,STATUS
"RTN","BPSOSQ2",11,0)
 ;
"RTN","BPSOSQ2",12,0)
 ; First handle insurer alseep transactions
"RTN","BPSOSQ2",13,0)
 D STATUS31^BPSOSQF
"RTN","BPSOSQ2",14,0)
 ;
"RTN","BPSOSQ2",15,0)
 ; Handle claims that need the packet to be built
"RTN","BPSOSQ2",16,0)
 I $D(^BPST("AD",30)) D STATUS30
"RTN","BPSOSQ2",17,0)
 ;
"RTN","BPSOSQ2",18,0)
 ; If there are still any claims with status 30 (perhaps due to failed
"RTN","BPSOSQ2",19,0)
 ;   LOCK59), queue up BPSOSQ2 to run again
"RTN","BPSOSQ2",20,0)
 I $O(^BPST("AD",30,0)) H 60 D TASK^BPSOSQA
"RTN","BPSOSQ2",21,0)
 Q
"RTN","BPSOSQ2",22,0)
 ;
"RTN","BPSOSQ2",23,0)
 ; Walk through claims at 30%, bundle, and create the claim
"RTN","BPSOSQ2",24,0)
STATUS30 ;
"RTN","BPSOSQ2",25,0)
 N IEN59
"RTN","BPSOSQ2",26,0)
 S IEN59=""
"RTN","BPSOSQ2",27,0)
 I '$$LOCK59(30) Q
"RTN","BPSOSQ2",28,0)
 ;
"RTN","BPSOSQ2",29,0)
 ; Loop though claims at 30%, bundle with other 30% claims, and process
"RTN","BPSOSQ2",30,0)
 F  S IEN59=$$NEXT59(IEN59,30) Q:IEN59=""  D
"RTN","BPSOSQ2",31,0)
 . ; Intialize the list
"RTN","BPSOSQ2",32,0)
 . K RXILIST
"RTN","BPSOSQ2",33,0)
 . S RXILIST(IEN59)=""
"RTN","BPSOSQ2",34,0)
 . ;
"RTN","BPSOSQ2",35,0)
 . ; Update the status to 40 (Building the packet)
"RTN","BPSOSQ2",36,0)
 . D SETSTAT^BPSOSU(IEN59,40)
"RTN","BPSOSQ2",37,0)
 . ;
"RTN","BPSOSQ2",38,0)
 . ; If reversal, only one claim per packet
"RTN","BPSOSQ2",39,0)
 . I $G(^BPST(IEN59,4)) G POINTX
"RTN","BPSOSQ2",40,0)
 . ;
"RTN","BPSOSQ2",41,0)
 . ; If prior auth are entered, only one claim per packet
"RTN","BPSOSQ2",42,0)
 . G:$$CHKPA() POINTX
"RTN","BPSOSQ2",43,0)
 . ;
"RTN","BPSOSQ2",44,0)
 . ; Code below is for bundling claims.  The VA is not doing this
"RTN","BPSOSQ2",45,0)
 . ; so we are skipping it.  However, the code is left here in
"RTN","BPSOSQ2",46,0)
 . ; case we do bundling in the future.  If so, the code will need to be
"RTN","BPSOSQ2",47,0)
 . ; rewritten to look at the corect fields.
"RTN","BPSOSQ2",48,0)
 . G POINTX
"RTN","BPSOSQ2",49,0)
 . ;
"RTN","BPSOSQ2",50,0)
 . N RA0,RA1 S RA0=^BPST(IEN59,0),RA1=^(1)
"RTN","BPSOSQ2",51,0)
 . N IEN59 S IEN59="" ; preserve the top-level index!
"RTN","BPSOSQ2",52,0)
 . F  S IEN59=$$NEXT59(IEN59,30) Q:'IEN59  D
"RTN","BPSOSQ2",53,0)
 .. N RB0,RB1 S RB0=^BPST(IEN59,0),RB1=^(1)
"RTN","BPSOSQ2",54,0)
 .. ; Only bundle when you have the same:
"RTN","BPSOSQ2",55,0)
 .. ; Patient, Visit, Division, Division Source, Insurer, Pharmacy
"RTN","BPSOSQ2",56,0)
 .. I $P(RA0,U,6,7)'=$P(RB0,U,6,7) Q
"RTN","BPSOSQ2",57,0)
 .. I $P(RA1,U,4,7)'=$P(RB1,U,4,7) Q
"RTN","BPSOSQ2",58,0)
 .. I $P(RB0,U,2)'=30 Q  ; might have been canceled, or maybe 31'd
"RTN","BPSOSQ2",59,0)
 .. D SETSTAT^BPSOSU(IEN59,40)
"RTN","BPSOSQ2",60,0)
 .. S RXILIST(IEN59)=""
"RTN","BPSOSQ2",61,0)
POINTX . ; Reversals and prior auth claims branch to here to bypass multi-claim packeting
"RTN","BPSOSQ2",62,0)
 . ;
"RTN","BPSOSQ2",63,0)
 . ; BPSOSQG will build the claim data, create the packet, and send to HL7
"RTN","BPSOSQ2",64,0)
 . S ERROR=$$PACKET^BPSOSQG
"RTN","BPSOSQ2",65,0)
 . ;
"RTN","BPSOSQ2",66,0)
 . ; If an error is returned, log the error to each transaction
"RTN","BPSOSQ2",67,0)
 . I ERROR S IEN59="" F  S IEN59=$O(RXILIST(IEN59)) Q:IEN59=""  D
"RTN","BPSOSQ2",68,0)
 .. D ERROR^BPSOSU($T(+0),IEN59,$P(ERROR,U),$P(ERROR,U,2,$L(ERROR,U)))
"RTN","BPSOSQ2",69,0)
 D UNLOCK59(30)
"RTN","BPSOSQ2",70,0)
 Q
"RTN","BPSOSQ2",71,0)
 ;
"RTN","BPSOSQ2",72,0)
NEXT59(IEN59,STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",73,0)
 N INS,PAYSH,PAYSHNM,RETRY
"RTN","BPSOSQ2",74,0)
N59A ;
"RTN","BPSOSQ2",75,0)
 ; Get next transaction for the given status
"RTN","BPSOSQ2",76,0)
 S IEN59=$O(^BPST("AD",STATUS,IEN59))
"RTN","BPSOSQ2",77,0)
 I IEN59="" Q IEN59  ; end of list, return ""
"RTN","BPSOSQ2",78,0)
 ;
"RTN","BPSOSQ2",79,0)
 ; but if the insurer is asleep, don't take this one
"RTN","BPSOSQ2",80,0)
 S INS=$P(^BPST(IEN59,9),U,1)
"RTN","BPSOSQ2",81,0)
 ;
"RTN","BPSOSQ2",82,0)
 ; Not sure when this would happen, but do not want to take it out
"RTN","BPSOSQ2",83,0)
 I INS="" S INS=1,$P(^BPST(IEN59,9),U,1)=INS  ;LJE;8/25/03  ;current insurance
"RTN","BPSOSQ2",84,0)
 ;
"RTN","BPSOSQ2",85,0)
 ; Get the payer sheet, name, and retry time
"RTN","BPSOSQ2",86,0)
 S PAYSH=$$PAYERSH^BPSOSQF(IEN59)
"RTN","BPSOSQ2",87,0)
 S PAYSHNM=$$GET1^DIQ(9002313.92,PAYSH_",",.01,"E")
"RTN","BPSOSQ2",88,0)
 S RETRY=$$GET1^DIQ(9002313.92,PAYSH_",",1.12,"I")    ;RETRY TIME
"RTN","BPSOSQ2",89,0)
 ;
"RTN","BPSOSQ2",90,0)
 ; If no retry time, insurer is not asleep and we can return the transaction
"RTN","BPSOSQ2",91,0)
 I 'RETRY Q IEN59
"RTN","BPSOSQ2",92,0)
 ;
"RTN","BPSOSQ2",93,0)
 ; Insurer is asleep -
"RTN","BPSOSQ2",94,0)
 ; If necessary, update the .59's record of when to retry
"RTN","BPSOSQ2",95,0)
 I $P($G(^BPST(IEN59,8)),U)'=RETRY D  ;
"RTN","BPSOSQ2",96,0)
 . S $P(^BPST(IEN59,8),U)=RETRY ; stamp with latest retry time
"RTN","BPSOSQ2",97,0)
 . D SETSTAT^BPSOSU(IEN59,31) ; force screen update, too
"RTN","BPSOSQ2",98,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Insurer still asleep - retry at "_RETRY_" for "_$G(PAYSHNM))
"RTN","BPSOSQ2",99,0)
 ;
"RTN","BPSOSQ2",100,0)
 ; If time to retry, return this transaction for processing
"RTN","BPSOSQ2",101,0)
 I RETRY'>$$NOW Q IEN59
"RTN","BPSOSQ2",102,0)
 ;
"RTN","BPSOSQ2",103,0)
 ; If we are checking status 30, convert to insurer asleep
"RTN","BPSOSQ2",104,0)
 I STATUS=30 D
"RTN","BPSOSQ2",105,0)
 . D SETSTAT^BPSOSU(IEN59,31)
"RTN","BPSOSQ2",106,0)
 . S $P(^BPST(IEN59,8),U)=$P($G(^BPSF(9002313.92,PAYSH,1)),"^",12)
"RTN","BPSOSQ2",107,0)
 . S $P(^BPST(IEN59,8),U,3)=PAYSH
"RTN","BPSOSQ2",108,0)
 ;
"RTN","BPSOSQ2",109,0)
 ; Still asleep, go to next transaction
"RTN","BPSOSQ2",110,0)
 G N59A
"RTN","BPSOSQ2",111,0)
 ;
"RTN","BPSOSQ2",112,0)
 ;
"RTN","BPSOSQ2",113,0)
LOCK59(STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",114,0)
 L +^BPST("AD",STATUS):60
"RTN","BPSOSQ2",115,0)
 Q $T
"RTN","BPSOSQ2",116,0)
 ;
"RTN","BPSOSQ2",117,0)
UNLOCK59(STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",118,0)
 L -^BPST("AD",STATUS)
"RTN","BPSOSQ2",119,0)
 Q
"RTN","BPSOSQ2",120,0)
 ;
"RTN","BPSOSQ2",121,0)
CHKPA() ;
"RTN","BPSOSQ2",122,0)
 N PATYP,PANUM,PACLM
"RTN","BPSOSQ2",123,0)
 S PACLM=0
"RTN","BPSOSQ2",124,0)
 ;
"RTN","BPSOSQ2",125,0)
 S PATYP=$P($G(^BPST(IEN59,1)),U,15)    ;prior auth type code
"RTN","BPSOSQ2",126,0)
 S PANUM=$P($G(^BPST(IEN59,1)),U,9)     ;prior auth number
"RTN","BPSOSQ2",127,0)
 I ($G(PATYP)'="")!($G(PANUM)'="") S PACLM=1
"RTN","BPSOSQ2",128,0)
 ;
"RTN","BPSOSQ2",129,0)
 Q PACLM
"RTN","BPSOSQ2",130,0)
 ;
"RTN","BPSOSQ2",131,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ3")
1^142
"RTN","BPSOSQ4")
0^153^B18119106
"RTN","BPSOSQ4",1,0)
BPSOSQ4 ;BHAM ISC/FCS/DRS/DLF - Process responses ;06/01/2004
"RTN","BPSOSQ4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQ4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQ4",4,0)
 ;
"RTN","BPSOSQ4",5,0)
 ; This routine has two components
"RTN","BPSOSQ4",6,0)
 ;   Procedures to report Response info
"RTN","BPSOSQ4",7,0)
 ;   Procedures to handle insurer asleep functions
"RTN","BPSOSQ4",8,0)
 Q
"RTN","BPSOSQ4",9,0)
 ;
"RTN","BPSOSQ4",10,0)
 ; The following are separate little utilities called from elsewhere.
"RTN","BPSOSQ4",11,0)
 ;
"RTN","BPSOSQ4",12,0)
PAID(IEN59) ;quick query to see if it's paid
"RTN","BPSOSQ4",13,0)
 N TMP D RESPINFO(IEN59,.TMP) Q:'$D(TMP("RSP")) 0
"RTN","BPSOSQ4",14,0)
 N X S X=TMP("RSP")
"RTN","BPSOSQ4",15,0)
 I X="Payable" Q 1
"RTN","BPSOSQ4",16,0)
 Q 0
"RTN","BPSOSQ4",17,0)
RESPINFO(RXI,DST) ;EP - BPSOS6M
"RTN","BPSOSQ4",18,0)
 ; quick way to get all the response info for a given RXI
"RTN","BPSOSQ4",19,0)
 ; IMPORTANT!!  Do not change spelling, case, wording, or spacing!!!
"RTN","BPSOSQ4",20,0)
 ; If a reversal was attempted, it complicates things.
"RTN","BPSOSQ4",21,0)
 ;  fills DST array as follows:
"RTN","BPSOSQ4",22,0)
 ; DST("HDR")=Response Status (header)
"RTN","BPSOSQ4",23,0)
 ; DST("RSP")=Response Status (prescription)
"RTN","BPSOSQ4",24,0)
 ;   This could be:  "Payable"  "Rejected"  "Captured"  "Duplicate"
"RTN","BPSOSQ4",25,0)
 ;   or  "Accepted reversal"  or  "Rejected reversal"
"RTN","BPSOSQ4",26,0)
 ;   or  "null"   or "null reversal"  (no response or corrupt response
"RTN","BPSOSQ4",27,0)
 ;    or maybe someone without insurance, so no request was sent)
"RTN","BPSOSQ4",28,0)
 ; DST("REJ",0)=count of reject codes
"RTN","BPSOSQ4",29,0)
 ; DST("REJ",n)=each reject code
"RTN","BPSOSQ4",30,0)
 ; DST("MSG")=message with the response
"RTN","BPSOSQ4",31,0)
 ; All of these are defined, even if originals were '$D.
"RTN","BPSOSQ4",32,0)
 ; The external forms are returned.
"RTN","BPSOSQ4",33,0)
 N REVERSAL S REVERSAL=$G(^BPST(RXI,4))>0
"RTN","BPSOSQ4",34,0)
 N RESP
"RTN","BPSOSQ4",35,0)
 I 'REVERSAL S RESP=$P(^BPST(RXI,0),U,5)
"RTN","BPSOSQ4",36,0)
 E  S RESP=$P(^BPST(RXI,4),U,2)
"RTN","BPSOSQ4",37,0)
 I 'RESP Q
"RTN","BPSOSQ4",38,0)
 N ECME S POS=$P(^BPST(RXI,0),U,9) Q:'POS
"RTN","BPSOSQ4",39,0)
 N FMT S FMT="E"
"RTN","BPSOSQ4",40,0)
 S DST("HDR")=$$RESP500(RESP,FMT)
"RTN","BPSOSQ4",41,0)
 S DST("RSP")=$$RESP1000(RESP,POS,FMT)
"RTN","BPSOSQ4",42,0)
 S DST("REJ",0)=$$REJCOUNT(RESP,POS,FMT)
"RTN","BPSOSQ4",43,0)
 I DST("REJ",0) D
"RTN","BPSOSQ4",44,0)
 . N I F I=1:1:DST("REJ",0) S DST("REJ",I)=$$REJCODE(RESP,POS,I,FMT)
"RTN","BPSOSQ4",45,0)
 S DST("MSG")=$$RESPMSG(RESP,POS,FMT)
"RTN","BPSOSQ4",46,0)
 ; Dealing with oddities of PCS (and others'?) response to reversals
"RTN","BPSOSQ4",47,0)
 I REVERSAL,DST("RSP")["null" D
"RTN","BPSOSQ4",48,0)
 . I DST("RSP")["null" S DST("RSP")=DST("HDR")_" reversal"
"RTN","BPSOSQ4",49,0)
 Q
"RTN","BPSOSQ4",50,0)
 ; In the following quickies:
"RTN","BPSOSQ4",51,0)
 ; RESP = RESPIEN, pointer to 9002313.03
"RTN","BPSOSQ4",52,0)
 ; FMT = "I" for internal, "E" for external, defaults to internal
"RTN","BPSOSQ4",53,0)
RESP500(RESP,FMT) ;EP - BPSOS57,BPSOSUC
"RTN","BPSOSQ4",54,0)
 ; returns the response header status
"RTN","BPSOSQ4",55,0)
 N X S X=$P($G(^BPSR(RESP,500)),U)
"RTN","BPSOSQ4",56,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",57,0)
 I X="" S X="null"
"RTN","BPSOSQ4",58,0)
 S X=$S(X="A":"Accepted",X="R":"Rejected",1:"?"_X)
"RTN","BPSOSQ4",59,0)
 Q X
"RTN","BPSOSQ4",60,0)
RESP1000(RESP,POS,FMT) ;EP - BPSOSUC
"RTN","BPSOSQ4",61,0)
 ; returns the prescription response status
"RTN","BPSOSQ4",62,0)
 ; Note!  Could be DP or DC for duplicates
"RTN","BPSOSQ4",63,0)
 N X S X=$P($G(^BPSR(RESP,1000,POS,500)),U)
"RTN","BPSOSQ4",64,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",65,0)
 I X="" S X="null"
"RTN","BPSOSQ4",66,0)
 ;
"RTN","BPSOSQ4",67,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes - they will send an "A" back
"RTN","BPSOSQ4",68,0)
 ; now on the transaction level to indicate that it has been accepted
"RTN","BPSOSQ4",69,0)
 ; Next code line remarked out - following added
"RTN","BPSOSQ4",70,0)
 ;
"RTN","BPSOSQ4",71,0)
 S X=$S(X="A":"Accepted",X="P":"Payable",X="R":"Rejected",X="C":"Captured",X="D"!(X="DP")!(X="DC"):"Duplicate",1:"?"_X)
"RTN","BPSOSQ4",72,0)
 Q X
"RTN","BPSOSQ4",73,0)
 ;
"RTN","BPSOSQ4",74,0)
REJCOUNT(RESP,POS,FMT) ; returns rejection count
"RTN","BPSOSQ4",75,0)
 Q +$P($G(^BPSR(RESP,1000,POS,511,0)),U,3)
"RTN","BPSOSQ4",76,0)
 ;
"RTN","BPSOSQ4",77,0)
REJCODE(RESP,POS,N,FMT) ; returns Nth rejection code
"RTN","BPSOSQ4",78,0)
 ; if FMT="E", returns code:text
"RTN","BPSOSQ4",79,0)
 N CODE S CODE=$P($G(^BPSR(RESP,1000,POS,511,N,0)),U)
"RTN","BPSOSQ4",80,0)
 I CODE="" S CODE="null"
"RTN","BPSOSQ4",81,0)
 I FMT'="E" Q CODE
"RTN","BPSOSQ4",82,0)
 N X S X=$O(^BPSF(9002313.93,"B",CODE,0))
"RTN","BPSOSQ4",83,0)
 I X]"" S CODE=CODE_":"_$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQ4",84,0)
 E  S CODE="?"_CODE
"RTN","BPSOSQ4",85,0)
 Q CODE
"RTN","BPSOSQ4",86,0)
 ;
"RTN","BPSOSQ4",87,0)
 ; NCPDP 5.1 changes - message may not come back in 504.  They may
"RTN","BPSOSQ4",88,0)
 ;  come back in 526 instead
"RTN","BPSOSQ4",89,0)
RESPMSG(RESP,POS,FMT) ; response message - additional text from insurer
"RTN","BPSOSQ4",90,0)
 ;
"RTN","BPSOSQ4",91,0)
 N MSG
"RTN","BPSOSQ4",92,0)
 S MSG=""
"RTN","BPSOSQ4",93,0)
 S MSG=$G(^BPSR(RESP,504))
"RTN","BPSOSQ4",94,0)
 S:MSG="" MSG=$G(^BPSR(RESP,1000,POS,504))
"RTN","BPSOSQ4",95,0)
 S:MSG="" MSG=$G(^BPSR(RESP,1000,POS,526))
"RTN","BPSOSQ4",96,0)
 Q MSG
"RTN","BPSOSQ4",97,0)
 ;
"RTN","BPSOSQ4",98,0)
 ;
"RTN","BPSOSQ4",99,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ4",100,0)
 ;
"RTN","BPSOSQ4",101,0)
 ; The xxxSLEEP functions are called from BPSOSQL
"RTN","BPSOSQ4",102,0)
 ;
"RTN","BPSOSQ4",103,0)
 ; REJSLEEP - Check if the insurer should be asleep
"RTN","BPSOSQ4",104,0)
 ;   based on the reject codes
"RTN","BPSOSQ4",105,0)
 ; Input
"RTN","BPSOSQ4",106,0)
 ;   RESP - BPS Response IEN
"RTN","BPSOSQ4",107,0)
 ;   POS  - Multiple IEN
"RTN","BPSOSQ4",108,0)
 ; Return
"RTN","BPSOSQ4",109,0)
 ;   1 if the insurer is asleep
"RTN","BPSOSQ4",110,0)
 ;   0 if the insurer is not asleep
"RTN","BPSOSQ4",111,0)
REJSLEEP(RESP,POS) ;EP - BPSOSQL
"RTN","BPSOSQ4",112,0)
 ;
"RTN","BPSOSQ4",113,0)
 ; DMB - Asleep functionality is disabled for VA until an analysis of reject
"RTN","BPSOSQ4",114,0)
 ;   codes can be done and asleep code needs to handle a stranded prober.
"RTN","BPSOSQ4",115,0)
 Q 0
"RTN","BPSOSQ4",116,0)
 ;
"RTN","BPSOSQ4",117,0)
 ; Validate parameters
"RTN","BPSOSQ4",118,0)
 I '$G(RESP) Q 0
"RTN","BPSOSQ4",119,0)
 I '$G(POS) Q 0
"RTN","BPSOSQ4",120,0)
 ;
"RTN","BPSOSQ4",121,0)
 ; This is basically old IHS logic
"RTN","BPSOSQ4",122,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV16-".E Q 1
"RTN","BPSOSQ4",123,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV38-".E Q 1
"RTN","BPSOSQ4",124,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV32-".E Q 1
"RTN","BPSOSQ4",125,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV25-".E Q 1 ; BPS*1.0T7*4
"RTN","BPSOSQ4",126,0)
 ;
"RTN","BPSOSQ4",127,0)
 ; NDC's, and theoretically, Envoy too, though they seem to do EV- msgs
"RTN","BPSOSQ4",128,0)
 I $O(^BPSR(RESP,1000,POS,511,"B",90))="" Q 0 ; cheap check
"RTN","BPSOSQ4",129,0)
 ;
"RTN","BPSOSQ4",130,0)
 ; But for a PCS case we see, Code 99 + some code < 90 ; BPS*1.0T7*2
"RTN","BPSOSQ4",131,0)
 ; isn't "asleep" - 99 is something PCS threw in       ; BPS*1.0T7*2
"RTN","BPSOSQ4",132,0)
 ; so require 99 to be accompanied by something <99 too ; BPS*1.0T7*2
"RTN","BPSOSQ4",133,0)
 ;
"RTN","BPSOSQ4",134,0)
 N RET S RET=0 N I F I=92,93,99 D  Q:RET
"RTN","BPSOSQ4",135,0)
 . I $D(^BPSR(RESP,1000,POS,511,"B",I)) S RET=1
"RTN","BPSOSQ4",136,0)
 . Q:I'=99  Q:'RET  ; BPS*1.0T7*2
"RTN","BPSOSQ4",137,0)
 . I I=99,$O(^BPSR(RESP,1000,POS,511,"B",0))<90 S RET=0 ; BPS*1.0T7*2
"RTN","BPSOSQ4",138,0)
 Q RET
"RTN","BPSOSQ4",139,0)
 ;
"RTN","BPSOSQ4",140,0)
 ; INCSLEEP - Increment sleep time for this insurer, if necessary.
"RTN","BPSOSQ4",141,0)
 ; Input
"RTN","BPSOSQ4",142,0)
 ;   IEN59 - BPS Transaction IEN
"RTN","BPSOSQ4",143,0)
 ;   PAYSH - Payer Sheet IEN
"RTN","BPSOSQ4",144,0)
 ; Return the scheduled retry time
"RTN","BPSOSQ4",145,0)
INCSLEEP(IEN59,PAYSH) ;EP - BPSOSQL
"RTN","BPSOSQ4",146,0)
 ;
"RTN","BPSOSQ4",147,0)
 ; Set retry time to be 10 minutes in the future
"RTN","BPSOSQ4",148,0)
 N X,RETRY
"RTN","BPSOSQ4",149,0)
 S X=600,RETRY=$$TADDNOWS^BPSOSUD(X)
"RTN","BPSOSQ4",150,0)
 ;
"RTN","BPSOSQ4",151,0)
 ; Set retry time to be 10 minutes
"RTN","BPSOSQ4",152,0)
 S $P(^BPSF(9002313.92,PAYSH,1),U,12)=RETRY
"RTN","BPSOSQ4",153,0)
 S $P(^BPST(IEN59,8),U,1)=RETRY
"RTN","BPSOSQ4",154,0)
 S $P(^BPST(IEN59,8),U,3)=PAYSH
"RTN","BPSOSQ4",155,0)
 ;
"RTN","BPSOSQ4",156,0)
 ; Fire up a packet process 10 seconds after the RETRY time so that the
"RTN","BPSOSQ4",157,0)
 ;   claims can be processed as soon as the retry time expires
"RTN","BPSOSQ4",158,0)
 D TASKAT^BPSOSQA($$TADDNOWS^BPSOSUD(X+10))
"RTN","BPSOSQ4",159,0)
 ;
"RTN","BPSOSQ4",160,0)
 ; And run packeter right now, too, to stamp new times on the others in status 31
"RTN","BPSOSQ4",161,0)
 D TASK^BPSOSQA
"RTN","BPSOSQ4",162,0)
 Q RETRY
"RTN","BPSOSQ4",163,0)
 ;
"RTN","BPSOSQ4",164,0)
 ; Clear insurer sleeping condition
"RTN","BPSOSQ4",165,0)
CLRSLEEP(IEN59,PAYSH) ;EP - BPSOSQL
"RTN","BPSOSQ4",166,0)
 N RETRY
"RTN","BPSOSQ4",167,0)
 ;
"RTN","BPSOSQ4",168,0)
 ; Reset Retry Time and Prober Flga
"RTN","BPSOSQ4",169,0)
 I $D(^BPST(IEN59,8)) S $P(^BPST(IEN59,8),U,1)="",$P(^BPST(IEN59,8),U,3)=""
"RTN","BPSOSQ4",170,0)
 ;
"RTN","BPSOSQ4",171,0)
 ; Get retry time from the payer sheet and quit if does not exist
"RTN","BPSOSQ4",172,0)
 S RETRY=$P($G(^BPSF(9002313.92,PAYSH,1)),U,12)
"RTN","BPSOSQ4",173,0)
 ;
"RTN","BPSOSQ4",174,0)
 ; Reset Retry Time and Prober
"RTN","BPSOSQ4",175,0)
 S $P(^BPSF(9002313.92,PAYSH,1),U,11)=""
"RTN","BPSOSQ4",176,0)
 S $P(^BPSF(9002313.92,PAYSH,1),U,12)=""
"RTN","BPSOSQ4",177,0)
 ;
"RTN","BPSOSQ4",178,0)
 ; If this insurer was asleep and there are other asleep transactions, fire off
"RTN","BPSOSQ4",179,0)
 ; the Packeter task to see if they should be done
"RTN","BPSOSQ4",180,0)
 I RETRY,$D(^BPST("AD",31)) D TASK^BPSOSQA
"RTN","BPSOSQ4",181,0)
 Q
"RTN","BPSOSQA")
0^151^B6788168
"RTN","BPSOSQA",1,0)
BPSOSQA ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/02/2004
"RTN","BPSOSQA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQA",4,0)
 Q
"RTN","BPSOSQA",5,0)
 ;
"RTN","BPSOSQA",6,0)
 ; ONE59 - Validate BPS Transaction data
"RTN","BPSOSQA",7,0)
 ; Input
"RTN","BPSOSQA",8,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSQA",9,0)
 ;
"RTN","BPSOSQA",10,0)
ONE59(IEN59) ;EP - from BPSOSIZ
"RTN","BPSOSQA",11,0)
 ; Process this one IEN59
"RTN","BPSOSQA",12,0)
 ;
"RTN","BPSOSQA",13,0)
 ; Initialize variables
"RTN","BPSOSQA",14,0)
 N X1,RX,RXI,RTN
"RTN","BPSOSQA",15,0)
 S X1=$G(^BPST(IEN59,1))
"RTN","BPSOSQA",16,0)
 S RXI=$P(X1,U),RX=$P(X1,U,11),RTN=$T(+0)
"RTN","BPSOSQA",17,0)
 ;
"RTN","BPSOSQA",18,0)
 I RX="" D ERROR^BPSOSU(RTN,IEN59,106,"Prescription Number not found in Transaction") G END
"RTN","BPSOSQA",19,0)
 I RXI="" D ERROR^BPSOSU(RTN,IEN59,107,"Fill Number not found in Transaction") G END
"RTN","BPSOSQA",20,0)
 ; Create log entry
"RTN","BPSOSQA",21,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSQA",22,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Validating the BPS Transaction")
"RTN","BPSOSQA",23,0)
 ;
"RTN","BPSOSQA",24,0)
 ; Check for existance of the prescription
"RTN","BPSOSQA",25,0)
 I $$RXAPI1^BPSUTIL1(RX,.01,"I")="" D ERROR^BPSOSU(RTN,IEN59,101,"Missing RX # field .01") G END
"RTN","BPSOSQA",26,0)
 ;
"RTN","BPSOSQA",27,0)
 ; If there is a refill, check for the existance of the refill
"RTN","BPSOSQA",28,0)
 I RXI,$$RXSUBF1^BPSUTIL1(RX,52,52.1,RXI,.01,"I")="" D ERROR^BPSOSU(RTN,IEN59,102,"Missing RX Refill field .01") G END
"RTN","BPSOSQA",29,0)
 ;
"RTN","BPSOSQA",30,0)
 ; Check for missing patient
"RTN","BPSOSQA",31,0)
 I '$P(^BPST(IEN59,0),U,6) D ERROR^BPSOSU(RTN,IEN59,103,"Patient missing from BPS Transaction") G END
"RTN","BPSOSQA",32,0)
 ;
"RTN","BPSOSQA",33,0)
 ; Check for missing division
"RTN","BPSOSQA",34,0)
 I '$P(X1,U,4) D ERROR^BPSOSU(RTN,IEN59,104,"Division missing from BPS Transaction") G END
"RTN","BPSOSQA",35,0)
 ;
"RTN","BPSOSQA",36,0)
 ; Check for missing BPS Pharmacy
"RTN","BPSOSQA",37,0)
 I '$P(X1,U,7)="" D ERROR^BPSOSU(RTN,IEN59,105,"ECME Pharmacy missing from BPS Transaction") G END
"RTN","BPSOSQA",38,0)
 ;
"RTN","BPSOSQA",39,0)
 ; Check for missing insurance node
"RTN","BPSOSQA",40,0)
 I '$D(^BPST(IEN59,10,1,0)) D ERROR^BPSOSU(RTN,IEN59,106,"Missing Insurance in BPST("_IEN59_",10,1,0)") G END
"RTN","BPSOSQA",41,0)
 ;
"RTN","BPSOSQA",42,0)
 ; If we got this far, we did not get an error
"RTN","BPSOSQA",43,0)
 ; Change status to 30 (Waiting for packet build)
"RTN","BPSOSQA",44,0)
 D SETSTAT^BPSOSU(IEN59,30)
"RTN","BPSOSQA",45,0)
 ;
"RTN","BPSOSQA",46,0)
END ; Common exit point
"RTN","BPSOSQA",47,0)
 ;
"RTN","BPSOSQA",48,0)
 ; Log the contents of Transaction record
"RTN","BPSOSQA",49,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Contents of ^BPST("_IEN59_"):")
"RTN","BPSOSQA",50,0)
 D LOG59(IEN59)
"RTN","BPSOSQA",51,0)
 ;
"RTN","BPSOSQA",52,0)
 ; If there are claims at 30%, fire up the packet process
"RTN","BPSOSQA",53,0)
 I $O(^BPST("AD",30,0)) D TASK
"RTN","BPSOSQA",54,0)
 Q
"RTN","BPSOSQA",55,0)
 ;
"RTN","BPSOSQA",56,0)
 ;
"RTN","BPSOSQA",57,0)
LOG59(IEN59) ; Log the IEN59 array
"RTN","BPSOSQA",58,0)
 N A
"RTN","BPSOSQA",59,0)
 M A=^BPST(IEN59)
"RTN","BPSOSQA",60,0)
 D LOGARRAY^BPSOSL(IEN59,"A")
"RTN","BPSOSQA",61,0)
 Q
"RTN","BPSOSQA",62,0)
 ;
"RTN","BPSOSQA",63,0)
TASK ;EP - from BPSOSQ2,BPSOSQ4,BPSOSRB
"RTN","BPSOSQA",64,0)
 N X,%DT,Y S X="N",%DT="ST" D ^%DT
"RTN","BPSOSQA",65,0)
 D TASKAT(Y)
"RTN","BPSOSQA",66,0)
 Q
"RTN","BPSOSQA",67,0)
 ;
"RTN","BPSOSQA",68,0)
TASKAT(ZTDTH) ;EP - from BPSOSQ4 (requeue if insurer is sleeping)
"RTN","BPSOSQA",69,0)
 N ZTRTN,ZTIO
"RTN","BPSOSQA",70,0)
 S ZTRTN="PACKETS^BPSOSQ2",ZTIO=""
"RTN","BPSOSQA",71,0)
 D ^%ZTLOAD
"RTN","BPSOSQA",72,0)
 Q
"RTN","BPSOSQB")
1^143
"RTN","BPSOSQC")
0^152^B701556
"RTN","BPSOSQC",1,0)
BPSOSQC ;BHAM ISC/FCS/DRS/FLS - ECME background, Part 1 ;06/01/2004
"RTN","BPSOSQC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSOSQC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQC",4,0)
 ;External reference private DBIA 4303
"RTN","BPSOSQC",5,0)
 Q
"RTN","BPSOSQC",6,0)
 ;
"RTN","BPSOSQC",7,0)
 ; Function to return division linked to the prescription or refill
"RTN","BPSOSQC",8,0)
 ; Input
"RTN","BPSOSQC",9,0)
 ;   RX - Prescription IEN
"RTN","BPSOSQC",10,0)
 ;   RXR - Refill
"RTN","BPSOSQC",11,0)
 ; Returns
"RTN","BPSOSQC",12,0)
 ;   BPSDIV - Outpatient Site
"RTN","BPSOSQC",13,0)
GETDIV(RX,RXR)   ; Get Division from RX or Refill
"RTN","BPSOSQC",14,0)
 N BPSDIV
"RTN","BPSOSQC",15,0)
 I '$G(RX) Q ""
"RTN","BPSOSQC",16,0)
 I $G(RXR)="" Q ""
"RTN","BPSOSQC",17,0)
 I RXR S BPSDIV=$$RXSUBF1^BPSUTIL1(RX,52,52.1,RXR,8,"I")
"RTN","BPSOSQC",18,0)
 E  S BPSDIV=$$RXAPI1^BPSUTIL1(RX,20,"I")
"RTN","BPSOSQC",19,0)
 Q BPSDIV
"RTN","BPSOSQD")
1^144
"RTN","BPSOSQF")
0^156^B8677183
"RTN","BPSOSQF",1,0)
BPSOSQF ;BHAM ISC/FCS/DRS/FLS - Insurer asleep - status 31 ;06/01/2004
"RTN","BPSOSQF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQF",4,0)
 Q
"RTN","BPSOSQF",5,0)
 ;
"RTN","BPSOSQF",6,0)
 ; Check for insurer asleep claims
"RTN","BPSOSQF",7,0)
 ;
"RTN","BPSOSQF",8,0)
STATUS31 ;EP - BPSOSQ2
"RTN","BPSOSQF",9,0)
 ; Situation:  you have 1 or 2 or maybe 200 claims in status 31,
"RTN","BPSOSQF",10,0)
 ; because we've determined that the insurer is asleep.
"RTN","BPSOSQF",11,0)
 ; change at most one claim per insurer to status 30, to let it
"RTN","BPSOSQF",12,0)
 ; go through and try again.  But if the insurer is awake for sure,
"RTN","BPSOSQF",13,0)
 ; let all of the claims for that insurer go on through.
"RTN","BPSOSQF",14,0)
 ;
"RTN","BPSOSQF",15,0)
 ; Initialization
"RTN","BPSOSQF",16,0)
 N RETRY,PROBER,IEN59,PAYERSH,X
"RTN","BPSOSQF",17,0)
 S IEN59=""
"RTN","BPSOSQF",18,0)
 K ^TMP("BPSOSQF",$J) ; build ^TMP("BPSOSQF",$J,PAYERSH,IEN59)=""
"RTN","BPSOSQF",19,0)
 ;
"RTN","BPSOSQF",20,0)
 ; Make sure we can get the lock
"RTN","BPSOSQF",21,0)
 I '$$LOCK59^BPSOSQ2(31) Q
"RTN","BPSOSQF",22,0)
 ;
"RTN","BPSOSQF",23,0)
 ; Loop through transaction that are 31 per cent
"RTN","BPSOSQF",24,0)
 F  S IEN59=$$NEXT59^BPSOSQ2(IEN59,31) Q:'IEN59  D
"RTN","BPSOSQF",25,0)
 . ; if $$NEXT59() returned us an IEN59, then the waiting time
"RTN","BPSOSQF",26,0)
 . ; has expired - or better yet, the insurer has awakened
"RTN","BPSOSQF",27,0)
 . ;
"RTN","BPSOSQF",28,0)
 . ; Get the payer sheet for the transaction
"RTN","BPSOSQF",29,0)
 . S PAYERSH=$$PAYERSH(IEN59)
"RTN","BPSOSQF",30,0)
 . I PAYERSH="" D LOG^BPSOSL(IEN59,$T(+0)_"-No payersheet was found") Q
"RTN","BPSOSQF",31,0)
 . ;
"RTN","BPSOSQF",32,0)
 . ; Get Retry Time and Prober
"RTN","BPSOSQF",33,0)
 . S X=$G(^BPSF(9002313.92,PAYERSH,1))
"RTN","BPSOSQF",34,0)
 . S RETRY=$P(X,U,12),PROBER=$P(X,U,11)
"RTN","BPSOSQF",35,0)
 . ;
"RTN","BPSOSQF",36,0)
 . ; If still in wait, but wait expired, just allow one claim thru.
"RTN","BPSOSQF",37,0)
 . ; But if wait has been canceled - that is, we had a successful
"RTN","BPSOSQF",38,0)
 . ; transmit, meaning the insurer has awakened - then let them all
"RTN","BPSOSQF",39,0)
 . ; go through to status 30.
"RTN","BPSOSQF",40,0)
 . ; if somehow the prober became complete, without clearing 101;6
"RTN","BPSOSQF",41,0)
 . ; (maybe this happens if cancellation takes place?)
"RTN","BPSOSQF",42,0)
 . I PROBER D
"RTN","BPSOSQF",43,0)
 .. S X=$P($G(^BPST(PROBER,0)),U,2)
"RTN","BPSOSQF",44,0)
 .. I X=99!(X="") S PROBER=""
"RTN","BPSOSQF",45,0)
 . I RETRY,PROBER,PROBER'=IEN59 Q  ; only prober can go thru during wait
"RTN","BPSOSQF",46,0)
 . ;
"RTN","BPSOSQF",47,0)
 . ; Don't we need to compare RETRY time to the current time?
"RTN","BPSOSQF",48,0)
 . I RETRY S $P(^BPSF(9002313.92,PAYERSH,1),U,11)=IEN59,PROBER=IEN59
"RTN","BPSOSQF",49,0)
 . S ^TMP("BPSOSQF",$J,PAYERSH,IEN59)=""
"RTN","BPSOSQF",50,0)
 D UNLOCK59^BPSOSQ2(31)
"RTN","BPSOSQF",51,0)
 ;
"RTN","BPSOSQF",52,0)
 ; Loop through payer sheet and transactions and change status to 30%
"RTN","BPSOSQF",53,0)
 S PAYERSH="" F  S PAYERSH=$O(^TMP("BPSOSQF",$J,PAYERSH)) Q:'PAYERSH  D
"RTN","BPSOSQF",54,0)
 . S IEN59="" F  S IEN59=$O(^TMP("BPSOSQF",$J,PAYERSH,IEN59)) Q:'IEN59  D
"RTN","BPSOSQF",55,0)
 . . D SETSTAT^BPSOSU(IEN59,30) ; reset to status 30
"RTN","BPSOSQF",56,0)
 . . D LOG^BPSOSL(IEN59,$T(+0)_"-Retrying Asleep Claim.  Prober? "_$S(PROBER=IEN59:"YES",1:"NO"))
"RTN","BPSOSQF",57,0)
 Q
"RTN","BPSOSQF",58,0)
 ;
"RTN","BPSOSQF",59,0)
 ; Function to get the payer sheet for a given transaction
"RTN","BPSOSQF",60,0)
PAYERSH(IEN59) ;
"RTN","BPSOSQF",61,0)
 N POS
"RTN","BPSOSQF",62,0)
 S POS=$P($G(^BPST(IEN59,9)),U,1)
"RTN","BPSOSQF",63,0)
 I POS="" Q ""
"RTN","BPSOSQF",64,0)
 Q $$GET1^DIQ(9002313.59902,POS_","_IEN59_",",902.02,"I")
"RTN","BPSOSQG")
0^155^B6928881
"RTN","BPSOSQG",1,0)
BPSOSQG ;BHAM ISC/FCS/DRS/FLS - form transmission packets ;06/01/2004
"RTN","BPSOSQG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQG",4,0)
 Q
"RTN","BPSOSQG",5,0)
 ;
"RTN","BPSOSQG",6,0)
 ; PACKET
"RTN","BPSOSQG",7,0)
 ;   Calls BPSOSCA to get claims data (BPS array)
"RTN","BPSOSQG",8,0)
 ;   Calls BPSECA1 to create packet
"RTN","BPSOSQG",9,0)
 ;   Calls CHOP^BPSECMC2 to send packet to HL7 application
"RTN","BPSOSQG",10,0)
 ;
"RTN","BPSOSQG",11,0)
PACKET() ;EP - BPSOSQ2
"RTN","BPSOSQG",12,0)
 ; packetize one prescription (and possibly more prescriptions
"RTN","BPSOSQG",13,0)
 ; for the same patient, if they're ready now.)
"RTN","BPSOSQG",14,0)
 ; Called from BPSOSQ2,
"RTN","BPSOSQG",15,0)
 ;  which gave us RXILIST(IEN59) array of claims to packetize.
"RTN","BPSOSQG",16,0)
 ;
"RTN","BPSOSQG",17,0)
 N CLAIMIEN,ERROR,FIRST59
"RTN","BPSOSQG",18,0)
 ;
"RTN","BPSOSQG",19,0)
 ; Get first transaction from list
"RTN","BPSOSQG",20,0)
 S FIRST59=$O(RXILIST(0))
"RTN","BPSOSQG",21,0)
 ;
"RTN","BPSOSQG",22,0)
 ; If it's a reversal, we already have an ^BPSC(, which was
"RTN","BPSOSQG",23,0)
 ;   created by the call to BPSECA8, way back at the beginning.
"RTN","BPSOSQG",24,0)
 ; So, unlike claims, we need only the NCPDP formatting for it
"RTN","BPSOSQG",25,0)
 ;   by creating CLAIMIEN array and jumping to POINTM
"RTN","BPSOSQG",26,0)
 I $G(^BPST(FIRST59,4)) D  G POINTM
"RTN","BPSOSQG",27,0)
 . ; Mimic a few things that are set up in the code we're skipping
"RTN","BPSOSQG",28,0)
 . S CLAIMIEN=$P(^BPST(FIRST59,4),U)
"RTN","BPSOSQG",29,0)
 . S CLAIMIEN(CLAIMIEN)=""
"RTN","BPSOSQG",30,0)
 ;
"RTN","BPSOSQG",31,0)
 ; DMB - This code will only be executed if there is more than one
"RTN","BPSOSQG",32,0)
 ;  transaction in RXILIST.  This will not happen for the VA but leave
"RTN","BPSOSQG",33,0)
 ;  functionality in case we bundle claims later
"RTN","BPSOSQG",34,0)
 I $O(RXILIST($O(RXILIST("")))) D
"RTN","BPSOSQG",35,0)
 . D LOG2LIST^BPSOSL($T(+0)_"-Packetizing - we have more than one claim:")
"RTN","BPSOSQG",36,0)
 . N I,X,Y S (X,Y)=""
"RTN","BPSOSQG",37,0)
 . F I=1:1 S X=$O(RXILIST(X)) Q:'X  D
"RTN","BPSOSQG",38,0)
 . . S $P(Y,", ",I-1#4+1)=X
"RTN","BPSOSQG",39,0)
 . . I I#4=0 D LOG2LIST^BPSOSL(Y) S Y=""
"RTN","BPSOSQG",40,0)
 . I Y]"" D LOG2LIST^BPSOSL(Y)
"RTN","BPSOSQG",41,0)
 ;
"RTN","BPSOSQG",42,0)
 ; BPSOSCA calls BPSOSCB,BPSOSCC,BPSOSCD to set up BPS(*) and
"RTN","BPSOSQG",43,0)
 ;    then calls BPSOSCE to create claims in 9002313.02
"RTN","BPSOSQG",44,0)
 ; BPSOSCA expects RXILIST(*) to be defined and will return
"RTN","BPSOSQG",45,0)
 ;   ERROR - any error encountered
"RTN","BPSOSQG",46,0)
 ;   CLAIMIEN - last claim created
"RTN","BPSOSQG",47,0)
 ;   CLAIMIEN(CLAIMIEN) - the list of all claims created
"RTN","BPSOSQG",48,0)
 S ERROR=$$EN^BPSOSCA(.CLAIMIEN)
"RTN","BPSOSQG",49,0)
 I ERROR D LOG2LIST^BPSOSL($T(+0)_"-ERROR="_ERROR_" returned from BPSOSCA")
"RTN","BPSOSQG",50,0)
 I $G(CLAIMIEN)<1 Q $S(ERROR:ERROR,1:"300^No Claim IEN returned by BPSOSCA")
"RTN","BPSOSQG",51,0)
 ;
"RTN","BPSOSQG",52,0)
 ; POINTM will create the claims packet and put them in XTMP
"RTN","BPSOSQG",53,0)
POINTM ; Reversals are joining again here
"RTN","BPSOSQG",54,0)
 N VAMSG,IEN59,ERROR
"RTN","BPSOSQG",55,0)
 ;
"RTN","BPSOSQG",56,0)
 ; CLAIMIEN(*) = a list of CLAIMIENs that were generated from
"RTN","BPSOSQG",57,0)
 ;   all the prescriptions that might have been bundled together.
"RTN","BPSOSQG",58,0)
 ;   So we must loop through that list.
"RTN","BPSOSQG",59,0)
 ; Currently, VA does not bundle claims.  If it does so,
"RTN","BPSOSQG",60,0)
 ;   we may want to change error handling.
"RTN","BPSOSQG",61,0)
 S ERROR=0,CLAIMIEN=""
"RTN","BPSOSQG",62,0)
 F  S CLAIMIEN=$O(CLAIMIEN(CLAIMIEN)) Q:CLAIMIEN=""  D
"RTN","BPSOSQG",63,0)
 . S IEN59=$O(^BPST("AE",CLAIMIEN,""))
"RTN","BPSOSQG",64,0)
 . I IEN59="" S IEN59=$O(^BPST("AER",CLAIMIEN,""))
"RTN","BPSOSQG",65,0)
 . I IEN59="" S ERROR="500^Transaction IEN not determined for "_CLAIMIEN Q
"RTN","BPSOSQG",66,0)
 . D SETSTAT^BPSOSU(IEN59,50)
"RTN","BPSOSQG",67,0)
 . K VAMSG
"RTN","BPSOSQG",68,0)
 . D LOG2CLM^BPSOSL(CLAIMIEN,$T(+0)_"-Packet being built for Claim ID "_$P(^BPSC(CLAIMIEN,0),U))
"RTN","BPSOSQG",69,0)
 . D ASCII^BPSECA1(CLAIMIEN,.VAMSG)
"RTN","BPSOSQG",70,0)
 . I '$G(VAMSG("HLS",0)) S ERROR="501^Claim packet not built for "_$P($G(^BPSC(CLAIMIEN,0)),U,1) Q
"RTN","BPSOSQG",71,0)
 . D CHOP^BPSECMC2(.VAMSG,CLAIMIEN,IEN59)
"RTN","BPSOSQG",72,0)
 Q ERROR
"RTN","BPSOSQH")
1^145
"RTN","BPSOSQJ")
1^146
"RTN","BPSOSQL")
0^154^B17767813
"RTN","BPSOSQL",1,0)
BPSOSQL ;BHAM ISC/FCS/DRS/FLS - Process responses ;06/01/2004
"RTN","BPSOSQL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSQL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQL",4,0)
 ;
"RTN","BPSOSQL",5,0)
 Q
"RTN","BPSOSQL",6,0)
 ;
"RTN","BPSOSQL",7,0)
 ;  ONE(CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",8,0)
 ;     Process the Response for the claim.  Loop through the
"RTN","BPSOSQL",9,0)
 ;     transaction associated with the claim and call RESP1
"RTN","BPSOSQL",10,0)
 ;  RESP1
"RTN","BPSOSQL",11,0)
 ;     The real work of response handling for one IEN59 is in here
"RTN","BPSOSQL",12,0)
 ;  RESPBAD
"RTN","BPSOSQL",13,0)
 ;     Branch from RESP1 if there is no response value in the
"RTN","BPSOSQL",14,0)
 ;     prescription
"RTN","BPSOSQL",15,0)
 ;
"RTN","BPSOSQL",16,0)
 ; ONE - Both the claim and response record are correct and complete
"RTN","BPSOSQL",17,0)
 ;   Now update all of the prescription records affected by them.
"RTN","BPSOSQL",18,0)
ONE(CLAIMIEN,RESPIEN) ;
"RTN","BPSOSQL",19,0)
 N ISREVERS,INDEX,IEN59
"RTN","BPSOSQL",20,0)
 S ISREVERS=$$ISREVERS^BPSOSU(CLAIMIEN)
"RTN","BPSOSQL",21,0)
 S INDEX=$S(ISREVERS:"AER",1:"AE")
"RTN","BPSOSQL",22,0)
 S IEN59=0
"RTN","BPSOSQL",23,0)
 F  S IEN59=$O(^BPST(INDEX,CLAIMIEN,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQL",24,0)
 . D RESP1(IEN59,ISREVERS,CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",25,0)
 Q
"RTN","BPSOSQL",26,0)
 ;
"RTN","BPSOSQL",27,0)
 ; RESP1 - Process each transaction associated with the claim
"RTN","BPSOSQL",28,0)
RESP1(IEN59,REVERSAL,CLAIMIEN,RESPIEN) ; called from ONE
"RTN","BPSOSQL",29,0)
 N ERROR,ERRTXT,X,MSG
"RTN","BPSOSQL",30,0)
 ;
"RTN","BPSOSQL",31,0)
 ; Store pointer to response
"RTN","BPSOSQL",32,0)
 N DIE,DA,DR
"RTN","BPSOSQL",33,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOSQL",34,0)
 S DR=$S(REVERSAL:402,1:4)_"////"_RESPIEN
"RTN","BPSOSQL",35,0)
 D ^DIE
"RTN","BPSOSQL",36,0)
 ;
"RTN","BPSOSQL",37,0)
 ; Update the status
"RTN","BPSOSQL",38,0)
 D SETSTAT^BPSOSU(IEN59,90) ; "Processing response"
"RTN","BPSOSQL",39,0)
 ;
"RTN","BPSOSQL",40,0)
 ; Get Position and log it
"RTN","BPSOSQL",41,0)
 N POSITION S POSITION=$P(^BPST(IEN59,0),U,9)
"RTN","BPSOSQL",42,0)
 I REVERSAL S POSITION=1 ; but reversals have only 1 transaction
"RTN","BPSOSQL",43,0)
 ;
"RTN","BPSOSQL",44,0)
 ;
"RTN","BPSOSQL",45,0)
 S MSG=$T(+0)_"-Processing "
"RTN","BPSOSQL",46,0)
 I REVERSAL S MSG=MSG_"Reversal "
"RTN","BPSOSQL",47,0)
 S MSG=MSG_"Response #"_RESPIEN_" for Claim #"_CLAIMIEN_" and position "_POSITION
"RTN","BPSOSQL",48,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSQL",49,0)
 ;
"RTN","BPSOSQL",50,0)
 ; If the Response Status is missing for the prescription, quit with error
"RTN","BPSOSQL",51,0)
 I '$D(^BPSR(RESPIEN,1000,POSITION,500)) D  G RESPBAD
"RTN","BPSOSQL",52,0)
 . S ERROR=901,ERRTXT="Corrupted response `"_RESPIEN
"RTN","BPSOSQL",53,0)
 ;
"RTN","BPSOSQL",54,0)
 ; Get the Respose Status for the prescription and update the statistics
"RTN","BPSOSQL",55,0)
 N RESP S RESP=$P(^BPSR(RESPIEN,1000,POSITION,500),U)
"RTN","BPSOSQL",56,0)
 D INCSTAT^BPSOSUD("R",$S(RESP="R"&REVERSAL:7,RESP="R":2,RESP="P":3,RESP="D":4,RESP="C":5,RESP="A":6,1:19))
"RTN","BPSOSQL",57,0)
 ;
"RTN","BPSOSQL",58,0)
 ; Log Response and if Payable, Amount Paid
"RTN","BPSOSQL",59,0)
 S MSG=$T(+0)_"-Response = "_RESP
"RTN","BPSOSQL",60,0)
 I RESP="P" S MSG=MSG_"-$"_$$INSPAID1^BPSOS03(RESPIEN,POSITION)
"RTN","BPSOSQL",61,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSQL",62,0)
 ;
"RTN","BPSOSQL",63,0)
 ; If the claims was rejected, log the reject reason
"RTN","BPSOSQL",64,0)
 I RESP="R" D  ; rejected, give rejection reasons
"RTN","BPSOSQL",65,0)
 . N J S J=0 F  S J=$O(^BPSR(RESPIEN,1000,POSITION,511,J)) Q:'J  D
"RTN","BPSOSQL",66,0)
 .. N R S R=$P($G(^BPSR(RESPIEN,1000,POSITION,511,J,0)),U)
"RTN","BPSOSQL",67,0)
 .. N X
"RTN","BPSOSQL",68,0)
 .. I R]"" D
"RTN","BPSOSQL",69,0)
 ... S X=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSOSQL",70,0)
 ... I X]"" S X=$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQL",71,0)
 .. E  S X=""
"RTN","BPSOSQL",72,0)
 .. D LOG^BPSOSL(IEN59,"Reject Code: "_R_" - "_X)
"RTN","BPSOSQL",73,0)
 . ;
"RTN","BPSOSQL",74,0)
 . ; If there are reject codes and the claim is not a reversal, synch reject codes
"RTN","BPSOSQL",75,0)
 . ;   with Outpatient Pharmacy
"RTN","BPSOSQL",76,0)
 . I 'REVERSAL D DURSYNC^BPSECMP2(IEN59)
"RTN","BPSOSQL",77,0)
 ;
"RTN","BPSOSQL",78,0)
 ; Get response messages and log them.
"RTN","BPSOSQL",79,0)
 S X=$G(^BPSR(RESPIEN,504))
"RTN","BPSOSQL",80,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",81,0)
 S X=$G(^BPSR(RESPIEN,1000,POSITION,504))
"RTN","BPSOSQL",82,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",83,0)
 S X=$G(^BPSR(RESPIEN,1000,POSITION,526))
"RTN","BPSOSQL",84,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",85,0)
 ;
"RTN","BPSOSQL",86,0)
 ; Get Payer Sheet and Payer Sheet name
"RTN","BPSOSQL",87,0)
 N PAYSH,PAYSHNM
"RTN","BPSOSQL",88,0)
 S PAYSH=$$PAYERSH^BPSOSQF(IEN59),PAYSHNM=$$GET1^DIQ(9002313.92,PAYSH_",",.01,"E")
"RTN","BPSOSQL",89,0)
 ;
"RTN","BPSOSQL",90,0)
 ; Check if the payer should go to sleep based on the reject codes
"RTN","BPSOSQL",91,0)
 I $$REJSLEEP^BPSOSQ4(RESPIEN,POSITION) D  ; ins. asleep: want to retry
"RTN","BPSOSQL",92,0)
 . D SETSTAT^BPSOSU(IEN59,31)
"RTN","BPSOSQL",93,0)
 . N RETRY
"RTN","BPSOSQL",94,0)
 . S RETRY=$$INCSLEEP^BPSOSQ4(IEN59,PAYSH)
"RTN","BPSOSQL",95,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Insurer asleep; retry scheduled for "_RETRY_" for "_$G(PAYSHNM))
"RTN","BPSOSQL",96,0)
 E  D  ; else: a normal kind of response, so we are done
"RTN","BPSOSQL",97,0)
 . D CLRSLEEP^BPSOSQ4(IEN59,PAYSH)
"RTN","BPSOSQL",98,0)
 . N RESULT
"RTN","BPSOSQL",99,0)
 . I REVERSAL S RESULT="Reversal "
"RTN","BPSOSQL",100,0)
 . S RESULT=$G(RESULT)_$S(RESP="R":"Rejected",RESP="P":"Payable",RESP="D":"Duplicate",RESP="C":"Captured",RESP="A":"Accepted",1:"Completed")
"RTN","BPSOSQL",101,0)
 . D SETRESU^BPSOSU(IEN59,0,RESULT)
"RTN","BPSOSQL",102,0)
 . D SETSTAT^BPSOSU(IEN59,99) ; "Done"
"RTN","BPSOSQL",103,0)
 Q
"RTN","BPSOSQL",104,0)
 ;
"RTN","BPSOSQL",105,0)
RESPBAD ; corrupted response escape from RESP1 - reached by a GOTO from RESP
"RTN","BPSOSQL",106,0)
 ; Log the error
"RTN","BPSOSQL",107,0)
 D ERROR^BPSOSU($T(+0),IEN59,$G(ERROR),$G(ERRTXT))
"RTN","BPSOSQL",108,0)
 Q
"RTN","BPSOSQP")
1^149
"RTN","BPSOSQQ")
1^147
"RTN","BPSOSQS")
1^148
"RTN","BPSOSR2")
0^176^B1160966
"RTN","BPSOSR2",1,0)
BPSOSR2 ;BHAM ISC/FCS/DRS/FLS - Show submit queue ;06/01/2004
"RTN","BPSOSR2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSR2",4,0)
 ;
"RTN","BPSOSR2",5,0)
 Q
"RTN","BPSOSR2",6,0)
 ; SHOWQ subroutine - continuation of BPSOSRX
"RTN","BPSOSR2",7,0)
SHOWQ ;EP - BPSOSRX
"RTN","BPSOSR2",8,0)
 N ROOT S ROOT="^XTMP(""BPS-PROC"")"
"RTN","BPSOSR2",9,0)
 N COUNT S COUNT=0
"RTN","BPSOSR2",10,0)
 N TYPE,RXI,RXR
"RTN","BPSOSR2",11,0)
 F TYPE="CLAIM","UNCLAIM" D
"RTN","BPSOSR2",12,0)
 . W TYPE
"RTN","BPSOSR2",13,0)
 . I '$D(@ROOT@(TYPE)) W " - none",! Q
"RTN","BPSOSR2",14,0)
 . W ":",!
"RTN","BPSOSR2",15,0)
 . S RXI="" F  S RXI=$O(@ROOT@(TYPE,RXI)) Q:RXI=""  D
"RTN","BPSOSR2",16,0)
 . . S RXR="" F  S RXR=$O(@ROOT@(TYPE,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSR2",17,0)
 . . . W RXI,",",RXR
"RTN","BPSOSR2",18,0)
 . . . ; details like patient, drug could go here
"RTN","BPSOSR2",19,0)
 . . . W !
"RTN","BPSOSR2",20,0)
 . . . S COUNT=COUNT+1
"RTN","BPSOSR2",21,0)
 . W "Total ",COUNT," ",TYPE W:COUNT'=1 "s"
"RTN","BPSOSR2",22,0)
 . W !
"RTN","BPSOSR2",23,0)
 Q
"RTN","BPSOSRB")
0^42^B30030353
"RTN","BPSOSRB",1,0)
BPSOSRB ;BHAM ISC/FCS/DRS/FLS - Process claim on processing queue ;06/01/2004
"RTN","BPSOSRB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSRB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRB",4,0)
 ;
"RTN","BPSOSRB",5,0)
 Q
"RTN","BPSOSRB",6,0)
BACKGR ;
"RTN","BPSOSRB",7,0)
 I '$$LOCKNOW^BPSOSRX("BACKGROUND") Q
"RTN","BPSOSRB",8,0)
 N TYPE,RXI,RXR,IEN59
"RTN","BPSOSRB",9,0)
 I '$$LOCK^BPSOSRX("BACKGROUND",300) G FAIL
"RTN","BPSOSRB",10,0)
 F TYPE="CLAIM","UNCLAIM" D
"RTN","BPSOSRB",11,0)
 . S RXI="" F  S RXI=$O(^XTMP("BPS-PROC",TYPE,RXI)) Q:RXI=""  D
"RTN","BPSOSRB",12,0)
 .. S RXR="" F  S RXR=$O(^XTMP("BPS-PROC",TYPE,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSRB",13,0)
 ... N X S X=$$STATUS^BPSOSRX(RXI,RXR,0)
"RTN","BPSOSRB",14,0)
 ... S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSOSRB",15,0)
 ... D LOG^BPSOSL(IEN59,$T(+0)_"-Dequeuing.  Type is "_TYPE)
"RTN","BPSOSRB",16,0)
 ... I $P(X,U)="IN PROGRESS" D  Q
"RTN","BPSOSRB",17,0)
 .... D LOG^BPSOSL(IEN59,$T(+0)_"-Status is 'IN PROGRESS'.  Will retry later.")
"RTN","BPSOSRB",18,0)
 ... N TIME,MOREDATA
"RTN","BPSOSRB",19,0)
 ... S TIME=^XTMP("BPS-PROC",TYPE,RXI,RXR) ; time requested
"RTN","BPSOSRB",20,0)
 ... I '$$LOCK^BPSOSRX("SUBMIT",10) D  Q
"RTN","BPSOSRB",21,0)
 .... D LOG^BPSOSL(IEN59,$T(+0)_"-Failed to $$LOCK^BPSOSRX(""SUBMIT"").  Will retry later.")
"RTN","BPSOSRB",22,0)
 ... I $D(^XTMP("BPS-PROC",TYPE,RXI,RXR,"MOREDATA")) M MOREDATA=^("MOREDATA")
"RTN","BPSOSRB",23,0)
 ... E  S MOREDATA=0
"RTN","BPSOSRB",24,0)
 ... K ^XTMP("BPS-PROC",TYPE,RXI,RXR)
"RTN","BPSOSRB",25,0)
 ... D BACKGR1(TYPE,RXI,RXR,TIME,.MOREDATA)
"RTN","BPSOSRB",26,0)
 ... D UNLOCK^BPSOSRX("SUBMIT")
"RTN","BPSOSRB",27,0)
FAIL D UNLOCK^BPSOSRX("BACKGROUND")
"RTN","BPSOSRB",28,0)
 Q
"RTN","BPSOSRB",29,0)
 ;
"RTN","BPSOSRB",30,0)
 ; BACKGR1 - Further processing of the claim
"RTN","BPSOSRB",31,0)
 ; Besides the parameter below, IEN59 also needs to be defined
"RTN","BPSOSRB",32,0)
BACKGR1(TYPE,RXI,RXR,TIME,MOREDATA) ;
"RTN","BPSOSRB",33,0)
 ; Resolve multiple requests
"RTN","BPSOSRB",34,0)
 N SKIP S SKIP=0 ; skip if you already got desired result
"RTN","BPSOSRB",35,0)
 N SKIPREAS
"RTN","BPSOSRB",36,0)
 N RESULT S RESULT=$$STATUS^BPSOSRX(RXI,RXR,0),RESULT=$P(RESULT,U)
"RTN","BPSOSRB",37,0)
 N STARTTIM S STARTTIM=$$STARTTIM(RXI,RXR)
"RTN","BPSOSRB",38,0)
 I TYPE="CLAIM" D
"RTN","BPSOSRB",39,0)
 . I $$RXDEL^BPSOS(RXI,RXR) D  Q
"RTN","BPSOSRB",40,0)
 .. S SKIP=1,SKIPREAS="Prescription is marked as DELETED or CANCELLED"
"RTN","BPSOSRB",41,0)
 . ; If it's never been through ECME before, good.
"RTN","BPSOSRB",42,0)
 . I RESULT="" Q
"RTN","BPSOSRB",43,0)
 . ; There's already a complete transaction for this RXI,RXR
"RTN","BPSOSRB",44,0)
 . ; (We screened out "IN PROGRESS" earlier)
"RTN","BPSOSRB",45,0)
 . ; The program to poll indexes would have set DO NOT RESUBMIT.
"RTN","BPSOSRB",46,0)
 . ; Calls from pharm pkg to ECME have '$D(MOREDATA("DO NOT RESUBMIT"))
"RTN","BPSOSRB",47,0)
 . I $D(MOREDATA("DO NOT RESUBMIT")) D
"RTN","BPSOSRB",48,0)
 .. S SKIP=1
"RTN","BPSOSRB",49,0)
 .. S SKIPREAS="MOREDATA(""DO NOT RESUBMIT"") is set"
"RTN","BPSOSRB",50,0)
 . E  I TIME<STARTTIM D  ; our request was made before trans. began
"RTN","BPSOSRB",51,0)
 .. ; submit claim but only if the prev result was successful reversal
"RTN","BPSOSRB",52,0)
 .. I RESULT="PAPER REVERSAL" Q
"RTN","BPSOSRB",53,0)
 .. I RESULT="E REVERSAL ACCEPTED" Q
"RTN","BPSOSRB",54,0)
 .. S SKIP=1
"RTN","BPSOSRB",55,0)
 .. S SKIPREAS="Prev result "_RESULT_"; claim started "_STARTTIM_">"_TIME_" submitted"
"RTN","BPSOSRB",56,0)
 . E  D  ; our request was made after it began
"RTN","BPSOSRB",57,0)
 .. ; So we will make a reversal if necessary,
"RTN","BPSOSRB",58,0)
 .. ; and then the claim will be resubmitted.
"RTN","BPSOSRB",59,0)
 .. I RESULT="E PAYABLE"!(RESULT="E DUPLICATE"),$G(MOREDATA("REVERSE THEN RESUBMIT"))'=2 D
"RTN","BPSOSRB",60,0)
 ... S MOREDATA("REVERSE THEN RESUBMIT")=1
"RTN","BPSOSRB",61,0)
 E  I TYPE="UNCLAIM" D
"RTN","BPSOSRB",62,0)
 . ; It must have gone through ECME with a payable result
"RTN","BPSOSRB",63,0)
 . I RESULT="E PAYABLE" Q
"RTN","BPSOSRB",64,0)
 . I RESULT="E DUPLICATE" Q
"RTN","BPSOSRB",65,0)
 . N RXACTION S RXACTION=$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRB",66,0)
 . I RESULT="E REVERSAL REJECTED",(",DE,EREV,RS,"[(","_RXACTION_",")) Q
"RTN","BPSOSRB",67,0)
 . I RESULT="E REVERSAL STRANDED",RXACTION="EREV" Q
"RTN","BPSOSRB",68,0)
 . S SKIP=1
"RTN","BPSOSRB",69,0)
 . S SKIPREAS="Cannot reverse - previous result was "_RESULT
"RTN","BPSOSRB",70,0)
 E  D IMPOSS^BPSOSUE("P","TI","bad arg TYPE="_TYPE,,"BACKGR1",$T(+0))
"RTN","BPSOSRB",71,0)
 I SKIP D  Q
"RTN","BPSOSRB",72,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Skipping.  Reason: "_SKIPREAS)
"RTN","BPSOSRB",73,0)
 S MOREDATA("SUBMIT TIME")=TIME
"RTN","BPSOSRB",74,0)
 I TYPE="UNCLAIM"!$G(MOREDATA("REVERSE THEN RESUBMIT")) D REVERSE(IEN59,.MOREDATA)
"RTN","BPSOSRB",75,0)
 I TYPE="CLAIM",'$G(MOREDATA("REVERSE THEN RESUBMIT")) D CLAIM(IEN59,.MOREDATA)
"RTN","BPSOSRB",76,0)
 Q
"RTN","BPSOSRB",77,0)
 ;
"RTN","BPSOSRB",78,0)
 ; STARTTIM - Get START TIME field from BPS Transactions
"RTN","BPSOSRB",79,0)
STARTTIM(RXI,RXR) Q $P($G(^BPST($$IEN59^BPSOSRX(RXI,RXR),0)),U,11)
"RTN","BPSOSRB",80,0)
 ;
"RTN","BPSOSRB",81,0)
 ; Process claim request
"RTN","BPSOSRB",82,0)
 ; EP - Above and BPSOSU (for a resubmit after a reversal)
"RTN","BPSOSRB",83,0)
CLAIM(IEN59,MOREDATA) ;
"RTN","BPSOSRB",84,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Initiating Claim")
"RTN","BPSOSRB",85,0)
 D EN^BPSOSIZ(IEN59,.MOREDATA)
"RTN","BPSOSRB",86,0)
 Q
"RTN","BPSOSRB",87,0)
 ;
"RTN","BPSOSRB",88,0)
 ; Process the reversal
"RTN","BPSOSRB",89,0)
REVERSE(IEN59,MOREDATA) ;
"RTN","BPSOSRB",90,0)
 N MSG,RETVAL,REV
"RTN","BPSOSRB",91,0)
 ;
"RTN","BPSOSRB",92,0)
 ; Log Reversal or Reversal/Resubmit message.
"RTN","BPSOSRB",93,0)
 ; Note that the reversal/resubmit message is needed
"RTN","BPSOSRB",94,0)
 ;   for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSRB",95,0)
 S MSG=$T(+0)_"-Initiating Reversal"
"RTN","BPSOSRB",96,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=1 D
"RTN","BPSOSRB",97,0)
 . S MSG=MSG_" and after that, claim will be resubmitted"
"RTN","BPSOSRB",98,0)
 . N X,X1,X2
"RTN","BPSOSRB",99,0)
 . S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRB",100,0)
 . S ^XTMP("BPSOSRB",0)=X_U_DT_U_"PASS VARIABLES FOR RESUBMITS"
"RTN","BPSOSRB",101,0)
 . K ^XTMP("BPSOSRB","MOREDATA",IEN59)
"RTN","BPSOSRB",102,0)
 . M ^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB")=MOREDATA
"RTN","BPSOSRB",103,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSRB",104,0)
 ;
"RTN","BPSOSRB",105,0)
 ; Change status to 0% (Waiting to Start), which will reset START TIME,
"RTN","BPSOSRB",106,0)
 ;   and then to 10% (Building transaction)
"RTN","BPSOSRB",107,0)
 D SETSTAT^BPSOSU(IEN59,0)
"RTN","BPSOSRB",108,0)
 D SETSTAT^BPSOSU(IEN59,10)
"RTN","BPSOSRB",109,0)
 ;
"RTN","BPSOSRB",110,0)
 ; Update User (#13), RX Action (#1201), and Reversal Reason (#404)
"RTN","BPSOSRB",111,0)
 ;   in BPS Transactions
"RTN","BPSOSRB",112,0)
 N DIE,DR,DA
"RTN","BPSOSRB",113,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOSRB",114,0)
 S DR="6////"_$G(MOREDATA("SUBMIT TIME"))_";13////"_$G(MOREDATA("USER"))
"RTN","BPSOSRB",115,0)
 S DR=DR_";404////"_$G(MOREDATA("REVERSAL REASON"))_";1201////"_$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRB",116,0)
 ;
"RTN","BPSOSRB",117,0)
 ; Also update RESUBMIT AFTER REVERSAL field (#1.12) if needed
"RTN","BPSOSRB",118,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=1 S DR=DR_";1.12////1"
"RTN","BPSOSRB",119,0)
 D ^DIE
"RTN","BPSOSRB",120,0)
 ;
"RTN","BPSOSRB",121,0)
 ; Log message for reverse without resubmit
"RTN","BPSOSRB",122,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=2 D LOG^BPSOSL(IEN59,$P($G(MOREDATA("BILL")),U,2)_"-Claim cannot be resubmitted")
"RTN","BPSOSRB",123,0)
 ;
"RTN","BPSOSRB",124,0)
 ; Store contents of BPST in the Log
"RTN","BPSOSRB",125,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Contents of ^BPST("_IEN59_") :")
"RTN","BPSOSRB",126,0)
 D LOG59^BPSOSQA(IEN59) ; Log contents of 9002313.59
"RTN","BPSOSRB",127,0)
 ;
"RTN","BPSOSRB",128,0)
 ; Add semi-colon to result text
"RTN","BPSOSRB",129,0)
 D PREVISLY^BPSOSIZ(IEN59)
"RTN","BPSOSRB",130,0)
 ;
"RTN","BPSOSRB",131,0)
 ; Contruct revesal claim
"RTN","BPSOSRB",132,0)
 ;   If no reversal claim is returned, log error and quit.
"RTN","BPSOSRB",133,0)
 S REV=$$REVERSE^BPSECA8(IEN59)
"RTN","BPSOSRB",134,0)
 I REV=0 D  Q
"RTN","BPSOSRB",135,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Reversal claim not created for "_IEN59)
"RTN","BPSOSRB",136,0)
 . D ERROR^BPSOSU($T(+0),IEN59,100,"Reversal Claim not created")
"RTN","BPSOSRB",137,0)
 ;
"RTN","BPSOSRB",138,0)
 ; Update Reversal Field in the transaction
"RTN","BPSOSRB",139,0)
 S DIE=9002313.59,DA=IEN59,DR="401////"_REV
"RTN","BPSOSRB",140,0)
 D ^DIE
"RTN","BPSOSRB",141,0)
 ;
"RTN","BPSOSRB",142,0)
 ; Update Log
"RTN","BPSOSRB",143,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Reversal claim "_$P(^BPSC(REV,0),U)_" ("_REV_")")
"RTN","BPSOSRB",144,0)
 ;
"RTN","BPSOSRB",145,0)
 ; Update status to 30% (Building the claim)
"RTN","BPSOSRB",146,0)
 D SETSTAT^BPSOSU(IEN59,30)
"RTN","BPSOSRB",147,0)
 ;
"RTN","BPSOSRB",148,0)
 ; Fire off task to get this on the HL7 queue
"RTN","BPSOSRB",149,0)
 D TASK^BPSOSQA
"RTN","BPSOSRB",150,0)
 Q
"RTN","BPSOSRX")
0^32^B28605769
"RTN","BPSOSRX",1,0)
BPSOSRX ;BHAM ISC/FCS/DRS/FLS - callable from RPMS pharm ;06/01/2004
"RTN","BPSOSRX",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSRX",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX",4,0)
 ;
"RTN","BPSOSRX",5,0)
 ; There are only four callable entry points!
"RTN","BPSOSRX",6,0)
 ; $$CLAIM^BPSOSRX     Submit a claim to ECME
"RTN","BPSOSRX",7,0)
 ; $$UNCLAIM^BPSOSRX   Reverse a previously submitted claim.
"RTN","BPSOSRX",8,0)
 ; $$STATUS^BPSOSRX    Inquire about a claim's status
"RTN","BPSOSRX",9,0)
 ; SHOWQ^BPSOSRX       Display queue of claims to be processed
"RTN","BPSOSRX",10,0)
 Q
"RTN","BPSOSRX",11,0)
 ;
"RTN","BPSOSRX",12,0)
 ; $$CLAIM - Submit a claim to ECME
"RTN","BPSOSRX",13,0)
 ; Input
"RTN","BPSOSRX",14,0)
 ;   RXI - Prescription IEN
"RTN","BPSOSRX",15,0)
 ;   RXR - Fill Number
"RTN","BPSOSRX",16,0)
 ;   MOREDATA - Array of data needed for transaction/claim
"RTN","BPSOSRX",17,0)
 ; Return values:
"RTN","BPSOSRX",18,0)
 ;   1 = accepted for processing
"RTN","BPSOSRX",19,0)
 ;   0^reason = failure (should never happen)
"RTN","BPSOSRX",20,0)
 ;
"RTN","BPSOSRX",21,0)
 ; All this does is to put it on a list and start a background job.
"RTN","BPSOSRX",22,0)
 ;
"RTN","BPSOSRX",23,0)
 ; Note:  If the claim has already been processed, and it's
"RTN","BPSOSRX",24,0)
 ;        resubmitted, then a reversal will be done first,
"RTN","BPSOSRX",25,0)
 ;        and then the resubmit will be done.   Intervening calls
"RTN","BPSOSRX",26,0)
 ;        to $$STATUS may show progress of the reversal before
"RTN","BPSOSRX",27,0)
 ;        the resubmitted claim is processed.
"RTN","BPSOSRX",28,0)
CLAIM(RXI,RXR,MOREDATA) ;
"RTN","BPSOSRX",29,0)
 N RETVAL,STAT,TYPE,SUBMITDT
"RTN","BPSOSRX",30,0)
 I '$G(RXI) Q 0
"RTN","BPSOSRX",31,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX",32,0)
 I '$$LOCK("SUBMIT",5) Q 0
"RTN","BPSOSRX",33,0)
 S TYPE="CLAIM",SUBMITDT=$$NOW
"RTN","BPSOSRX",34,0)
 N X,X1,X2
"RTN","BPSOSRX",35,0)
 S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRX",36,0)
 K ^XTMP("BPS-PROC",TYPE,RXI,RXR)
"RTN","BPSOSRX",37,0)
 S ^XTMP("BPS-PROC",0)=X_U_DT_U_"ECME PROCESSING QUEUE"
"RTN","BPSOSRX",38,0)
 S ^XTMP("BPS-PROC",TYPE,RXI,RXR)=SUBMITDT
"RTN","BPSOSRX",39,0)
 I $D(MOREDATA) M ^XTMP("BPS-PROC",TYPE,RXI,RXR,"MOREDATA")=MOREDATA
"RTN","BPSOSRX",40,0)
 S ^XTMP("BPSOSRX",0)=X_U_DT_U_"ECME SUBMIT DATE FOR A RX AND FILL"
"RTN","BPSOSRX",41,0)
 S ^XTMP("BPSOSRX",RXI,RXR)=SUBMITDT
"RTN","BPSOSRX",42,0)
 D UNLOCK("SUBMIT")
"RTN","BPSOSRX",43,0)
 D RUNNING()
"RTN","BPSOSRX",44,0)
 S RETVAL=1
"RTN","BPSOSRX",45,0)
 Q RETVAL
"RTN","BPSOSRX",46,0)
 ;
"RTN","BPSOSRX",47,0)
 ; $$UNCLAIM - Reverse a previously submitted claim.
"RTN","BPSOSRX",48,0)
 ; Input
"RTN","BPSOSRX",49,0)
 ;   RXI - Prescription IEN
"RTN","BPSOSRX",50,0)
 ;   RXR - Fill Number
"RTN","BPSOSRX",51,0)
 ;   MOREDATA - Array of data needed for transaction/claim
"RTN","BPSOSRX",52,0)
 ; Return values:
"RTN","BPSOSRX",53,0)
 ;   1 = accepted for processing
"RTN","BPSOSRX",54,0)
 ;   0^reason = failure (should never happen)
"RTN","BPSOSRX",55,0)
 ;
"RTN","BPSOSRX",56,0)
 ;   All this does is to put it on a list and start a background job.
"RTN","BPSOSRX",57,0)
 ;
"RTN","BPSOSRX",58,0)
 ; Note:  The reversal will actually be done ONLY if the
"RTN","BPSOSRX",59,0)
 ;        most recent processing of the claim resulted in something
"RTN","BPSOSRX",60,0)
 ;        reversible, namely E PAYABLE or E REVERSAL REJECTED
"RTN","BPSOSRX",61,0)
UNCLAIM(RXI,RXR,MOREDATA) ;
"RTN","BPSOSRX",62,0)
 N RETVAL,STAT,RESULT,TYPE,SUBMITDT
"RTN","BPSOSRX",63,0)
 I '$G(RXI) Q 0
"RTN","BPSOSRX",64,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX",65,0)
 I '$$LOCK("SUBMIT",5) Q 0
"RTN","BPSOSRX",66,0)
 S TYPE="UNCLAIM",SUBMITDT=$$NOW
"RTN","BPSOSRX",67,0)
 N X,X1,X2
"RTN","BPSOSRX",68,0)
 S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRX",69,0)
 K ^XTMP("BPS-PROC",TYPE,RXI,RXR)
"RTN","BPSOSRX",70,0)
 S ^XTMP("BPS-PROC",0)=X_U_DT_U_"ECME PROCESSING QUEUE"
"RTN","BPSOSRX",71,0)
 S ^XTMP("BPS-PROC",TYPE,RXI,RXR)=SUBMITDT
"RTN","BPSOSRX",72,0)
 I $D(MOREDATA) M ^XTMP("BPS-PROC",TYPE,RXI,RXR,"MOREDATA")=MOREDATA
"RTN","BPSOSRX",73,0)
 S ^XTMP("BPSOSRX",0)=X_U_DT_U_"ECME SUBMIT DATE FOR A RX AND FILL"
"RTN","BPSOSRX",74,0)
 S ^XTMP("BPSOSRX",RXI,RXR)=SUBMITDT
"RTN","BPSOSRX",75,0)
 D UNLOCK("SUBMIT")
"RTN","BPSOSRX",76,0)
 D RUNNING()
"RTN","BPSOSRX",77,0)
 S RETVAL=1
"RTN","BPSOSRX",78,0)
 Q RETVAL
"RTN","BPSOSRX",79,0)
 ;
"RTN","BPSOSRX",80,0)
 ; $$STATUS(RXI,RXR,QUE) - Returns the Status of the prescription/fill
"RTN","BPSOSRX",81,0)
 ; Input
"RTN","BPSOSRX",82,0)
 ;   RXI - Prescription IEN (required)
"RTN","BPSOSRX",83,0)
 ;   RXR - Refill Number (required)
"RTN","BPSOSRX",84,0)
 ;   QUE:  0/null - Do not check if a RX/fill is on the queue (optional)
"RTN","BPSOSRX",85,0)
 ;         1 - Check if RX/fill is on the queue
"RTN","BPSOSRX",86,0)
 ;
"RTN","BPSOSRX",87,0)
 ; Returns
"RTN","BPSOSRX",88,0)
 ;    RESULT^LAST UPDATE DATE/TIME^DESCRIPTION^STATUS %
"RTN","BPSOSRX",89,0)
 ;    Returns null if there's no ECME record of this RX/fill
"RTN","BPSOSRX",90,0)
 ;
"RTN","BPSOSRX",91,0)
 ;    RESULT is either:
"RTN","BPSOSRX",92,0)
 ;      1. IN PROGRESS for incomplete claims
"RTN","BPSOSRX",93,0)
 ;      2. Final status for complete claims.  See comments for
"RTN","BPSOSRX",94,0)
 ;         BPSOSUC for complete list of possible statuses.
"RTN","BPSOSRX",95,0)
 ;    LAST UPDATE DATE/TIME is the Fileman date and time of the
"RTN","BPSOSRX",96,0)
 ;         last update to the status of this claim.
"RTN","BPSOSRX",97,0)
 ;    DESCRIPTION is either:
"RTN","BPSOSRX",98,0)
 ;      1. Incomplete claims will be the status (i.e., Waiting to Start,
"RTN","BPSOSRX",99,0)
 ;         Transmitting)
"RTN","BPSOSRX",100,0)
 ;      2. Completed claims will have the reason that the ECME process
"RTN","BPSOSRX",101,0)
 ;         was aborted if the result is  E OTHER.  Otherwise, it will
"RTN","BPSOSRX",102,0)
 ;         be similiar to the RESULT
"RTN","BPSOSRX",103,0)
 ;    STATUS % is the completion percentage.  Note that 99 is considered
"RTN","BPSOSRX",104,0)
 ;         complete.
"RTN","BPSOSRX",105,0)
STATUS(RXI,RXR,QUE) ;
"RTN","BPSOSRX",106,0)
 ;
"RTN","BPSOSRX",107,0)
 ; Setup needed variables
"RTN","BPSOSRX",108,0)
 N IEN59,SDT,A,SUBDT
"RTN","BPSOSRX",109,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",110,0)
 I $G(RXR)="" Q ""
"RTN","BPSOSRX",111,0)
 I $G(QUE)="" S QUE=1
"RTN","BPSOSRX",112,0)
 S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",113,0)
 S SDT=$G(^XTMP("BPSOSRX",RXI,RXR))
"RTN","BPSOSRX",114,0)
 ;
"RTN","BPSOSRX",115,0)
 ; ECME record not created
"RTN","BPSOSRX",116,0)
 I '$D(^BPST(IEN59)) D  Q A
"RTN","BPSOSRX",117,0)
 . I QUE,SDT S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX",118,0)
 . I QUE,$D(^XTMP("BPS-PROC","CLAIM",RXI,RXR)) S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX",119,0)
 . S A=""
"RTN","BPSOSRX",120,0)
 ;
"RTN","BPSOSRX",121,0)
 ; Loop: Get data, quit if times and status match (no change during gather)
"RTN","BPSOSRX",122,0)
 N C,T1,T2,S1,S2 F  D  I T1=T2,S1=S2 Q
"RTN","BPSOSRX",123,0)
 . S T1=$$LASTUP59(IEN59)
"RTN","BPSOSRX",124,0)
 . S S1=$$STATUS59(IEN59)
"RTN","BPSOSRX",125,0)
 . I S1=99 D  ; completed
"RTN","BPSOSRX",126,0)
 . . S A=$$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSRX",127,0)
 . . S C=$$RESTXT59(IEN59)
"RTN","BPSOSRX",128,0)
 . I S1'=99 D
"RTN","BPSOSRX",129,0)
 . . S A="IN PROGRESS"
"RTN","BPSOSRX",130,0)
 . . S C=$$STATI^BPSOSU(S1)
"RTN","BPSOSRX",131,0)
 . S T2=$$LASTUP59(IEN59)
"RTN","BPSOSRX",132,0)
 . S S2=$$STATUS59(IEN59)
"RTN","BPSOSRX",133,0)
 ;
"RTN","BPSOSRX",134,0)
 ; If the queue parameter is set and the submit date from the queue
"RTN","BPSOSRX",135,0)
 ;   follows the SUBMIT DATE/LAST UPDATE date from BPS TRANSACTION 
"RTN","BPSOSRX",136,0)
 ;   or the RX/fill is still on the queue, then change the response
"RTN","BPSOSRX",137,0)
 ;   to IN PROGRESS^Submit Date^WAITING TO START
"RTN","BPSOSRX",138,0)
 S SUBDT=$$SUBMIT59(IEN59)
"RTN","BPSOSRX",139,0)
 I SUBDT="" S SUBDT=T1
"RTN","BPSOSRX",140,0)
 I $G(QUE),SDT>SUBDT!($D(^XTMP("BPS-PROC","CLAIM",RXI,RXR)))!($D(^XTMP("BPS-PROC","UNCLAIM",RXI,RXR))) S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0)
"RTN","BPSOSRX",141,0)
 ;
"RTN","BPSOSRX",142,0)
 ; When finishing the reversal of a Reversal/Resubmit, display IN PROGRESS
"RTN","BPSOSRX",143,0)
 I $P($G(^BPST(IEN59,1)),"^",12)=1,S1=99 S A="IN PROGRESS",S1=98,C=$$STATI^BPSOSU(S1)
"RTN","BPSOSRX",144,0)
 ;
"RTN","BPSOSRX",145,0)
 ; Return results
"RTN","BPSOSRX",146,0)
 Q A_U_T1_U_$E(C,1,255-$L(A)-$L(T1)-2)_U_S1
"RTN","BPSOSRX",147,0)
 ;
"RTN","BPSOSRX",148,0)
 ; SHOWQ - Show RX/Fill on the Queue.  Since claims are generally processed
"RTN","BPSOSRX",149,0)
 ;   immediately, this report will generally have no output.
"RTN","BPSOSRX",150,0)
SHOWQ G SHOWQ^BPSOSR2
"RTN","BPSOSRX",151,0)
 ;
"RTN","BPSOSRX",152,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSRX",153,0)
 ;
"RTN","BPSOSRX",154,0)
 ; RESTXT59 - Return first semi-colon piece of the Result Text (202) field
"RTN","BPSOSRX",155,0)
 ;    from BPS Transaction
"RTN","BPSOSRX",156,0)
RESTXT59(IEN59) ;
"RTN","BPSOSRX",157,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",158,0)
 Q $P($P($G(^BPST(IEN59,2)),U,2,99),";",1)
"RTN","BPSOSRX",159,0)
 ;
"RTN","BPSOSRX",160,0)
 ; LASTUP59 - Return last update date/time from BPS Transactions
"RTN","BPSOSRX",161,0)
LASTUP59(IEN59) ;
"RTN","BPSOSRX",162,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",163,0)
 Q $P($G(^BPST(IEN59,0)),U,8)
"RTN","BPSOSRX",164,0)
 ;
"RTN","BPSOSRX",165,0)
 ; STATUS59 returns STATUS field from BPS Transaction
"RTN","BPSOSRX",166,0)
 ; Note: 99 means complete
"RTN","BPSOSRX",167,0)
STATUS59(IEN59) ;
"RTN","BPSOSRX",168,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",169,0)
 Q $P($G(^BPST(IEN59,0)),U,2)
"RTN","BPSOSRX",170,0)
 ;
"RTN","BPSOSRX",171,0)
 ; SUBMIT59 - Return Submit date/time from BPS Transactions
"RTN","BPSOSRX",172,0)
SUBMIT59(IEN59) ;
"RTN","BPSOSRX",173,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",174,0)
 Q $P($G(^BPST(IEN59,0)),U,7)
"RTN","BPSOSRX",175,0)
 ;
"RTN","BPSOSRX",176,0)
 ; RXRDEF - Get last refill
"RTN","BPSOSRX",177,0)
RXRDEF(RXI) ;
"RTN","BPSOSRX",178,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",179,0)
 K ^TMP($J)
"RTN","BPSOSRX",180,0)
 N BPSPT S BPSPT=$$RXAPI1^BPSUTIL1(RXI,2,"I")
"RTN","BPSOSRX",181,0)
 I BPSPT="" Q ""
"RTN","BPSOSRX",182,0)
 D RX^PSO52API(BPSPT,"BPSREF",RXI,,"R")
"RTN","BPSOSRX",183,0)
 Q +$O(^TMP($J,"BPSREF",BPSPT,RXI,"RF",""),-1)
"RTN","BPSOSRX",184,0)
 ;
"RTN","BPSOSRX",185,0)
 ; Utilities
"RTN","BPSOSRX",186,0)
 ;
"RTN","BPSOSRX",187,0)
 ;  LOCKING:  Just one user of this routine at a time.
"RTN","BPSOSRX",188,0)
 ;  X = "SUBMIT" to interlock the claim submission
"RTN","BPSOSRX",189,0)
 ;  X = "BACKGROUND" to interlock the background job
"RTN","BPSOSRX",190,0)
LOCK(X,TIMEOUT) ;EP - BPSOSRB
"RTN","BPSOSRX",191,0)
 I $G(TIMEOUT)="" S TIMEOUT=0
"RTN","BPSOSRX",192,0)
 L +^XTMP("BPS-PROC",X):TIMEOUT
"RTN","BPSOSRX",193,0)
 Q $T
"RTN","BPSOSRX",194,0)
 ;
"RTN","BPSOSRX",195,0)
LOCKNOW(X) ;EP - BPSOSRB
"RTN","BPSOSRX",196,0)
 L +^XTMP("BPS-PROC",X):0
"RTN","BPSOSRX",197,0)
 Q $T
"RTN","BPSOSRX",198,0)
 ;
"RTN","BPSOSRX",199,0)
UNLOCK(X) ;EP - BPSOSRB
"RTN","BPSOSRX",200,0)
 L -^XTMP("BPS-PROC",X)
"RTN","BPSOSRX",201,0)
 Q
"RTN","BPSOSRX",202,0)
 ;
"RTN","BPSOSRX",203,0)
RUNNING() ;
"RTN","BPSOSRX",204,0)
 I '$$LOCKNOW("BACKGROUND") Q  ; it is running; don't start another
"RTN","BPSOSRX",205,0)
 D UNLOCK("BACKGROUND") ; it's not running; release our probing lock
"RTN","BPSOSRX",206,0)
 D TASK
"RTN","BPSOSRX",207,0)
 Q
"RTN","BPSOSRX",208,0)
 ;
"RTN","BPSOSRX",209,0)
IEN59(RXI,RXR) ;EP - from BPSOS, BPSOSRB
"RTN","BPSOSRX",210,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",211,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX",212,0)
 Q RXI_"."_$TR($J(RXR,4)," ","0")_"1"
"RTN","BPSOSRX",213,0)
 ;
"RTN","BPSOSRX",214,0)
 ; The background job
"RTN","BPSOSRX",215,0)
TASK N X,Y,%DT
"RTN","BPSOSRX",216,0)
 S X="N",%DT="ST"
"RTN","BPSOSRX",217,0)
 D ^%DT,TASKAT(Y)
"RTN","BPSOSRX",218,0)
 Q
"RTN","BPSOSRX",219,0)
 ;
"RTN","BPSOSRX",220,0)
TASKAT(ZTDTH) ;
"RTN","BPSOSRX",221,0)
 N ZTIO S ZTIO="" ; no device
"RTN","BPSOSRX",222,0)
 N ZTRTN S ZTRTN="BACKGR^BPSOSRB"
"RTN","BPSOSRX",223,0)
 D ^%ZTLOAD
"RTN","BPSOSRX",224,0)
 Q
"RTN","BPSOSS2")
1^121
"RTN","BPSOSS3")
1^122
"RTN","BPSOSS6")
1^123
"RTN","BPSOSS8")
0^177^B1373912
"RTN","BPSOSS8",1,0)
BPSOSS8 ;BHAM ISC/FCS/DRS/FLS - Edit Basic ECME Parameters ;06/01/2004
"RTN","BPSOSS8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSS8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSS8",4,0)
 Q
"RTN","BPSOSS8",5,0)
EN ;EP - Option BPS SETUP BASIC PARAMS
"RTN","BPSOSS8",6,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSS8",7,0)
 W !!,"Edit Pharmacy ECME configuration",!
"RTN","BPSOSS8",8,0)
 ;
"RTN","BPSOSS8",9,0)
 ; If the BPS Setup record is not created, create it.
"RTN","BPSOSS8",10,0)
 ; Quit if there is an error.
"RTN","BPSOSS8",11,0)
 I $D(^BPS(9002313.99,1,0)) S DA=1
"RTN","BPSOSS8",12,0)
 E  S DA=$$INIT()
"RTN","BPSOSS8",13,0)
 ;
"RTN","BPSOSS8",14,0)
 ; Check for errors
"RTN","BPSOSS8",15,0)
 I DA'=1!'$D(^BPS(9002313.99,1,0)) D  Q
"RTN","BPSOSS8",16,0)
 . W !!,"BPS Setup not defined and can not be created.  Quitting."
"RTN","BPSOSS8",17,0)
 ;
"RTN","BPSOSS8",18,0)
 ; Prompts and input
"RTN","BPSOSS8",19,0)
 S DIE=9002313.99
"RTN","BPSOSS8",20,0)
 S DR="3.01R~ECME timeout? (0 to 30 seconds) //10"
"RTN","BPSOSS8",21,0)
 D ^DIE
"RTN","BPSOSS8",22,0)
 Q
"RTN","BPSOSS8",23,0)
 ;
"RTN","BPSOSS8",24,0)
 ; INIT - Create record 1 in the BPS SETUP file
"RTN","BPSOSS8",25,0)
INIT() ;
"RTN","BPSOSS8",26,0)
 ; Set up .01 node and call UPDATE
"RTN","BPSOSS8",27,0)
 N FN,IEN,FDA,MSG
"RTN","BPSOSS8",28,0)
 S FN=9002313.99,IEN(1)=1
"RTN","BPSOSS8",29,0)
 S FDA(FN,"+1,",.01)="MAIN SETUP ENTRY"
"RTN","BPSOSS8",30,0)
 S FDA(FN,"+1,",3.01)=10
"RTN","BPSOSS8",31,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPSOSS8",32,0)
 Q +$G(IEN(1))
"RTN","BPSOSS9")
1^124
"RTN","BPSOSSG")
0^178^B18762002
"RTN","BPSOSSG",1,0)
BPSOSSG ;BHAM ISC/SD/lwj/FLS - Special gets for formats ;06/01/2004
"RTN","BPSOSSG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSSG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSSG",4,0)
 ;
"RTN","BPSOSSG",5,0)
 Q
"RTN","BPSOSSG",6,0)
 ;
"RTN","BPSOSSG",7,0)
FLD439 ;Reason for service code
"RTN","BPSOSSG",8,0)
 ;Called by SET logic in BPS NCPDP Field DEFS for field 439
"RTN","BPSOSSG",9,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",10,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",11,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,2)=BPS("X")
"RTN","BPSOSSG",12,0)
 Q
"RTN","BPSOSSG",13,0)
 ;
"RTN","BPSOSSG",14,0)
FLD440 ;Professional Service Code
"RTN","BPSOSSG",15,0)
 ;Called by set logic in BPS NCPDP Field DEFS for field 440
"RTN","BPSOSSG",16,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",17,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",18,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,3)=BPS("X")
"RTN","BPSOSSG",19,0)
 Q
"RTN","BPSOSSG",20,0)
 ;
"RTN","BPSOSSG",21,0)
FLD441 ;Result of Service Code
"RTN","BPSOSSG",22,0)
 ;Called by SET logic in BPS NCPDP Field DEFS for field 441
"RTN","BPSOSSG",23,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",24,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",25,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,4)=BPS("X")
"RTN","BPSOSSG",26,0)
 Q
"RTN","BPSOSSG",27,0)
 ;
"RTN","BPSOSSG",28,0)
FLD473 ;DUR/PPS code counter - called from SET logic in BPS NCPDP Field Defs
"RTN","BPSOSSG",29,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",30,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",31,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,1)=BPS("X")
"RTN","BPSOSSG",32,0)
 S ^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,"B",BPS("X"),DUR)=""
"RTN","BPSOSSG",33,0)
 Q
"RTN","BPSOSSG",34,0)
FLD474 ;DUR/PPS level of effort - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",35,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",36,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",37,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,5)=BPS("X")
"RTN","BPSOSSG",38,0)
 Q
"RTN","BPSOSSG",39,0)
 ;
"RTN","BPSOSSG",40,0)
FLD475 ;DUR Co-agent ID Qualifier - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",41,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",42,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",43,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,6)=BPS("X")
"RTN","BPSOSSG",44,0)
 Q
"RTN","BPSOSSG",45,0)
 ;
"RTN","BPSOSSG",46,0)
FLD476 ;DUR Co-agent ID - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",47,0)
 ;DUR is newed in BPSOSHF
"RTN","BPSOSSG",48,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",49,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,7)=BPS("X")
"RTN","BPSOSSG",50,0)
 Q
"RTN","BPSOSSG",51,0)
 ;
"RTN","BPSOSSG",52,0)
FLD480 ;Other Amount Claimed Submitted field
"RTN","BPSOSSG",53,0)
 ;Called by set logic in BPS NCPDP Field DEFS for field 480
"RTN","BPSOSSG",54,0)
 ;Sets fields 478, 479, and 480 in BPS Claims
"RTN","BPSOSSG",55,0)
 Q:BPS("X")=""!(BPS("X")=0)!($TR(BPS("X"),"{}0.H7H8H9")="")
"RTN","BPSOSSG",56,0)
 N FDA,MSG
"RTN","BPSOSSG",57,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",.01)="H7"_1
"RTN","BPSOSSG",58,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",480)=BPS("X")
"RTN","BPSOSSG",59,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",479)="H8"_$G(BPS("Insurer","Other Amt Claim Sub Qual"))
"RTN","BPSOSSG",60,0)
 D UPDATE^DIE("","FDA","BPS(9002313.0601)","MSG")
"RTN","BPSOSSG",61,0)
 I $D(MSG) D
"RTN","BPSOSSG",62,0)
 . D LOG2CLM^BPSOSL(BPS(9002313.02),$T(+0)_"-Failed to update NCPDP field 480 and/or 479")
"RTN","BPSOSSG",63,0)
 . D LOGARAY2^BPSOSL(BPS(9002313.02),"MSG")
"RTN","BPSOSSG",64,0)
 Q
"RTN","BPSOSSG",65,0)
 ;
"RTN","BPSOSSG",66,0)
EMPL ;Get employer info
"RTN","BPSOSSG",67,0)
 ; This by GET logic in BPS NCPDP Field Defs for field 315 (Employer Name)
"RTN","BPSOSSG",68,0)
 ; DMB 11/13/2006 - It makes some sense to only set these fields if
"RTN","BPSOSSG",69,0)
 ;   they exist on the payer sheet.  However, it assumes that the
"RTN","BPSOSSG",70,0)
 ;   employer name field will always be before the other fields and
"RTN","BPSOSSG",71,0)
 ;   that the other fields will not exist without the Employer Name
"RTN","BPSOSSG",72,0)
 ;   field.  For now, leave this be as these fields are on the
"RTN","BPSOSSG",73,0)
 ;   Worker's Comp segment, which we do not do.  We may want to evaluate
"RTN","BPSOSSG",74,0)
 ;   if we were to ever add the Worker's Comp segment
"RTN","BPSOSSG",75,0)
 Q:'$G(BPS("Patient","IEN"))
"RTN","BPSOSSG",76,0)
 D GETS^DIQ(2,BPS("Patient","IEN"),".3111;.3112;.3113;.3115;.3116;.3117;.3118;.3119","","EMPL")
"RTN","BPSOSSG",77,0)
 S BPS("Employer","Name")=EMPL(2,BPS("Patient","IEN")_",",.3111)
"RTN","BPSOSSG",78,0)
 S:EMPL(2,BPS("Patient","IEN")_",",.3111)=""&(EMPL(2,BPS("Patient","IEN")_",",.3112)'="") BPS("Employer","Name")=EMPL(2,BPS("Patient","IEN")_",",.3112)
"RTN","BPSOSSG",79,0)
 S BPS("Employer","Address")=EMPL(2,BPS("Patient","IEN")_",",.3113)
"RTN","BPSOSSG",80,0)
 S BPS("Employer","City")=EMPL(2,BPS("Patient","IEN")_",",.3116)
"RTN","BPSOSSG",81,0)
 S BPS("Employer","State")=EMPL(2,BPS("Patient","IEN")_",",.3117)
"RTN","BPSOSSG",82,0)
 I BPS("Employer","State")'="" D
"RTN","BPSOSSG",83,0)
 . S STATEIEN="",STATEIEN=$O(^DIC(5,"B",BPS("Employer","State"),STATEIEN)),BPS("Employer","State")=$P($G(^DIC(5,STATEIEN,0)),"^",2)
"RTN","BPSOSSG",84,0)
 S BPS("Employer","Zip Code")=EMPL(2,BPS("Patient","IEN")_",",.3118)
"RTN","BPSOSSG",85,0)
 S BPS("Employer","Phone")=EMPL(2,BPS("Patient","IEN")_",",.3119)
"RTN","BPSOSSG",86,0)
 K EMPL,STATEIEN
"RTN","BPSOSSG",87,0)
 Q
"RTN","BPSOSSG",88,0)
 ;
"RTN","BPSOSSG",89,0)
STLIC(STATE) ; Retrieve the state license number.
"RTN","BPSOSSG",90,0)
 ;  This can be called by the special code in the payer sheet
"RTN","BPSOSSG",91,0)
 ;  References to State file (DIC(5)) covered by IA 10056
"RTN","BPSOSSG",92,0)
 ;  References to New Person file (VA(200)) covered by IA 10060
"RTN","BPSOSSG",93,0)
 ;  
"RTN","BPSOSSG",94,0)
 ;
"RTN","BPSOSSG",95,0)
 ; Validate the STATE parameter
"RTN","BPSOSSG",96,0)
 I $G(STATE)="" Q ""
"RTN","BPSOSSG",97,0)
 ;
"RTN","BPSOSSG",98,0)
 ; Get state IEN and make sure it exists
"RTN","BPSOSSG",99,0)
 N STIEN
"RTN","BPSOSSG",100,0)
 S STIEN=$O(^DIC(5,"C",STATE,0))
"RTN","BPSOSSG",101,0)
 I STIEN="" Q ""
"RTN","BPSOSSG",102,0)
 ;
"RTN","BPSOSSG",103,0)
 ; Get Provider IEN and make sure it exist
"RTN","BPSOSSG",104,0)
 N PROVIEN
"RTN","BPSOSSG",105,0)
 S PROVIEN=$G(BPS("RX",BPS(9002313.02),"Prescriber IEN"))
"RTN","BPSOSSG",106,0)
 I PROVIEN="" Q ""
"RTN","BPSOSSG",107,0)
 ;
"RTN","BPSOSSG",108,0)
 ; Get the expiration date and compare to the date of service
"RTN","BPSOSSG",109,0)
 N EXPDT
"RTN","BPSOSSG",110,0)
 S EXPDT=$$GET1^DIQ(200.541,STIEN_","_PROVIEN_",",2)
"RTN","BPSOSSG",111,0)
 I EXPDT,EXPDT+17000000<$G(BPS("RX",BPS(9002313.02),"Date Filled")) Q ""
"RTN","BPSOSSG",112,0)
 ;
"RTN","BPSOSSG",113,0)
 ; Get the license number
"RTN","BPSOSSG",114,0)
 Q $$GET1^DIQ(200.541,STIEN_","_PROVIEN_",",1)
"RTN","BPSOSSG",115,0)
 ;
"RTN","BPSOSSG",116,0)
STDEA(STATE) ; Retrieve the state DEA number.
"RTN","BPSOSSG",117,0)
 ;  This can be called by the special code in the payer sheet
"RTN","BPSOSSG",118,0)
 ;  References to State file (DIC(5)) covered by IA 10056
"RTN","BPSOSSG",119,0)
 ;  References to New Person file (VA(200)) covered by IA 10060
"RTN","BPSOSSG",120,0)
 ;
"RTN","BPSOSSG",121,0)
 ; Validate the STATE parameter
"RTN","BPSOSSG",122,0)
 I $G(STATE)="" Q ""
"RTN","BPSOSSG",123,0)
 ;
"RTN","BPSOSSG",124,0)
 ; Get state IEN and make sure it exists
"RTN","BPSOSSG",125,0)
 N STIEN
"RTN","BPSOSSG",126,0)
 S STIEN=$O(^DIC(5,"C",STATE,0))
"RTN","BPSOSSG",127,0)
 I STIEN="" Q ""
"RTN","BPSOSSG",128,0)
 ;
"RTN","BPSOSSG",129,0)
 ; Get Provider IEN and make sure it exist
"RTN","BPSOSSG",130,0)
 N PROVIEN
"RTN","BPSOSSG",131,0)
 S PROVIEN=$G(BPS("RX",BPS(9002313.02),"Prescriber IEN"))
"RTN","BPSOSSG",132,0)
 I PROVIEN="" Q ""
"RTN","BPSOSSG",133,0)
 ;
"RTN","BPSOSSG",134,0)
 ; Get the license number
"RTN","BPSOSSG",135,0)
 Q $$GET1^DIQ(200.55,STIEN_","_PROVIEN_",",1)
"RTN","BPSOSU")
0^33^B49057530
"RTN","BPSOSU",1,0)
BPSOSU ;BHAM ISC/FCS/DRS/FLS - Common utilities ;06/01/2004
"RTN","BPSOSU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5**;JUN 2004;Build 45
"RTN","BPSOSU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU",4,0)
 Q
"RTN","BPSOSU",5,0)
 ; Common utilities called a lot.
"RTN","BPSOSU",6,0)
 ;
"RTN","BPSOSU",7,0)
 ; SETSTAT - set status field for ^BPST(IEN59,
"RTN","BPSOSU",8,0)
 ; Input:
"RTN","BPSOSU",9,0)
 ;   IEN59   - BPS Transaction
"RTN","BPSOSU",10,0)
 ;   STATUS  - Value to set into BPS Transaction
"RTN","BPSOSU",11,0)
SETSTAT(IEN59,STATUS) ; EP - from many places
"RTN","BPSOSU",12,0)
 ;
"RTN","BPSOSU",13,0)
 ; In case there is a timing problem, make sure the Status is not
"RTN","BPSOSU",14,0)
 ;   already more than the requested status
"RTN","BPSOSU",15,0)
 I STATUS'=0,$P(^BPST(IEN59,0),U,2)>STATUS Q
"RTN","BPSOSU",16,0)
 ;
"RTN","BPSOSU",17,0)
 ; Lock the record - something is very wrong if you can't get the lock
"RTN","BPSOSU",18,0)
 F  L +^BPST(IEN59):300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK +^BPST",,"SETSTAT",$T(+0))
"RTN","BPSOSU",19,0)
 N DIE,DA,DR,X
"RTN","BPSOSU",20,0)
 S DIE=9002313.59,DA=IEN59,DR="1///"_STATUS_";7///NOW" ; Status and Last Update
"RTN","BPSOSU",21,0)
 I STATUS=0 S DR=DR_";15///NOW" ; If Status is 0, init START TIME
"RTN","BPSOSU",22,0)
 D ^DIE
"RTN","BPSOSU",23,0)
 ;
"RTN","BPSOSU",24,0)
 ; Verify that there no other statuses in the X-ref
"RTN","BPSOSU",25,0)
 S X=""
"RTN","BPSOSU",26,0)
 F  S X=$O(^BPST("AD",X)) Q:X=""  D
"RTN","BPSOSU",27,0)
 . I X'=STATUS K ^BPST("AD",X,IEN59)
"RTN","BPSOSU",28,0)
 I STATUS=99 D STATUS99(IEN59)
"RTN","BPSOSU",29,0)
 L -^BPST(IEN59)
"RTN","BPSOSU",30,0)
 Q
"RTN","BPSOSU",31,0)
 ;
"RTN","BPSOSU",32,0)
 ; STATUS99 - Special activity when a claim reaches status 99
"RTN","BPSOSU",33,0)
 ; Input:
"RTN","BPSOSU",34,0)
 ;   IEN59 - BPS Transaction IEN
"RTN","BPSOSU",35,0)
STATUS99(IEN59) ;
"RTN","BPSOSU",36,0)
 N CLMSTAT,BPS57
"RTN","BPSOSU",37,0)
 ;
"RTN","BPSOSU",38,0)
 ; Get status of the claim
"RTN","BPSOSU",39,0)
 S CLMSTAT=$$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSU",40,0)
 ;
"RTN","BPSOSU",41,0)
 S BPS57=$$NEW57(IEN59)
"RTN","BPSOSU",42,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Created BPS Log of Transaction record "_BPS57)
"RTN","BPSOSU",43,0)
 ;
"RTN","BPSOSU",44,0)
 ; If claims completed normally, log its completion.
"RTN","BPSOSU",45,0)
 ; Do not log error'ed or stranded claims as we don't want to show these in the
"RTN","BPSOSU",46,0)
 ;   turn-around stats
"RTN","BPSOSU",47,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSU",48,0)
 I CLMSTAT'["E OTHER",CLMSTAT'["E STRANDED",CLMSTAT'["E REVERSAL STRANDED" D LOG^BPSOSL(IEN59,$T(+0)_"-Claim Complete")
"RTN","BPSOSU",49,0)
 ;
"RTN","BPSOSU",50,0)
 ; If the Reverse Then Resubmit field is set to Resubmitting (2),
"RTN","BPSOSU",51,0)
 ;   then set to 'Done' (0)
"RTN","BPSOSU",52,0)
 I $P(^BPST(IEN59,1),U,12)=2 S $P(^BPST(IEN59,1),U,12)=0
"RTN","BPSOSU",53,0)
 ;
"RTN","BPSOSU",54,0)
 ; If resubmit flag is set to 'Reverse, then Resubmit' (1), see about
"RTN","BPSOSU",55,0)
 ;   doing a resubmit
"RTN","BPSOSU",56,0)
 I $P(^BPST(IEN59,1),U,12)=1 D
"RTN","BPSOSU",57,0)
 . ;
"RTN","BPSOSU",58,0)
 . ; Initialize variables
"RTN","BPSOSU",59,0)
 . N SKIP,SITE
"RTN","BPSOSU",60,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Reverse then Resubmit attempt")
"RTN","BPSOSU",61,0)
 . ;
"RTN","BPSOSU",62,0)
 . ; Initialize the skip flag
"RTN","BPSOSU",63,0)
 . S SKIP=0
"RTN","BPSOSU",64,0)
 . ;
"RTN","BPSOSU",65,0)
 . ; Get Site info and make sure it exists
"RTN","BPSOSU",66,0)
 . S SITE=$P(^BPST(IEN59,1),U,4)
"RTN","BPSOSU",67,0)
 . I '$G(SITE) D
"RTN","BPSOSU",68,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_" Cannot - No site information")
"RTN","BPSOSU",69,0)
 .. S SKIP=1
"RTN","BPSOSU",70,0)
 . ;
"RTN","BPSOSU",71,0)
 . ; Check the ECME switch for the site
"RTN","BPSOSU",72,0)
 . I $G(SITE),'$$ECMEON^BPSUTIL(SITE) D
"RTN","BPSOSU",73,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_" Cannot - ECME switch is off for the site")
"RTN","BPSOSU",74,0)
 .. S SKIP=1
"RTN","BPSOSU",75,0)
 . ;
"RTN","BPSOSU",76,0)
 . ; If reversal was not successful, log message and quit
"RTN","BPSOSU",77,0)
 . I CLMSTAT'="E REVERSAL ACCEPTED" D
"RTN","BPSOSU",78,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_" Cannot - Reversal failed - "_CLMSTAT)
"RTN","BPSOSU",79,0)
 .. S SKIP=1
"RTN","BPSOSU",80,0)
 . ;
"RTN","BPSOSU",81,0)
 . ; Check if the MOREDATA array is defined
"RTN","BPSOSU",82,0)
 . I '$D(^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB")) D
"RTN","BPSOSU",83,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_" Cannot - MOREDATA array undefined")
"RTN","BPSOSU",84,0)
 .. S SKIP=1
"RTN","BPSOSU",85,0)
 . ;
"RTN","BPSOSU",86,0)
 . ; If skip flag is set, clear the resubmit flag and kill the temp global
"RTN","BPSOSU",87,0)
 . ; Else resubmit the claim
"RTN","BPSOSU",88,0)
 . I SKIP D
"RTN","BPSOSU",89,0)
 .. S $P(^BPST(IEN59,1),U,12)=0
"RTN","BPSOSU",90,0)
 .. K ^XTMP("BPSOSRB","MOREDATA",IEN59)
"RTN","BPSOSU",91,0)
 . E  D
"RTN","BPSOSU",92,0)
 .. K MOREDATA
"RTN","BPSOSU",93,0)
 .. M MOREDATA=^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB")
"RTN","BPSOSU",94,0)
 .. K ^XTMP("BPSOSRB","MOREDATA",IEN59)
"RTN","BPSOSU",95,0)
 .. ;
"RTN","BPSOSU",96,0)
 .. ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSU",97,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-Now resubmit")
"RTN","BPSOSU",98,0)
 .. D CLAIM^BPSOSRB(IEN59,.MOREDATA)
"RTN","BPSOSU",99,0)
 ;
"RTN","BPSOSU",100,0)
 ; If the ECME Nightly Background job and CMOP release message are running at the same
"RTN","BPSOSU",101,0)
 ;   time, there are unreleased RXs that are auto-reversed but then are released by
"RTN","BPSOSU",102,0)
 ;   CMOP at the same time.  Unfortunately, if the auto-reversal is in progress, CMOP
"RTN","BPSOSU",103,0)
 ;   can not resubmit the claim (due to the queuing issue) so we need to automatically
"RTN","BPSOSU",104,0)
 ;   submit them here.
"RTN","BPSOSU",105,0)
 ; Criteria:
"RTN","BPSOSU",106,0)
 ;   Status is Reversal Accepted
"RTN","BPSOSU",107,0)
 ;   RX is released
"RTN","BPSOSU",108,0)
 ;   Normal Auto-Reversal
"RTN","BPSOSU",109,0)
 I CLMSTAT="E REVERSAL ACCEPTED" D
"RTN","BPSOSU",110,0)
 . N RX,RXR
"RTN","BPSOSU",111,0)
 . S RX=$P(IEN59,"."),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSU",112,0)
 . I '$$RXRLDT^PSOBPSUT(RX,RXR) Q
"RTN","BPSOSU",113,0)
 . N CLAIMIEN,AUTOREV
"RTN","BPSOSU",114,0)
 . S CLAIMIEN=$$GET1^DIQ(9002313.59,IEN59,3,"I")
"RTN","BPSOSU",115,0)
 . I '$G(CLAIMIEN) Q
"RTN","BPSOSU",116,0)
 . S AUTOREV=$$GET1^DIQ(9002313.02,CLAIMIEN,.07,"I")
"RTN","BPSOSU",117,0)
 . I $G(AUTOREV)'=1 Q
"RTN","BPSOSU",118,0)
 . N BDOS,BRES,BMES,BMSG
"RTN","BPSOSU",119,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Submit released auto-reversal")
"RTN","BPSOSU",120,0)
 . S BDOS=$$DOSDATE^BPSSCRRS(RX,RXR)
"RTN","BPSOSU",121,0)
 . S BRES=$$EN^BPSNCPDP(RX,RXR,BDOS,"ARES")
"RTN","BPSOSU",122,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Response from BPSNCPDP: "_BRES)
"RTN","BPSOSU",123,0)
 . S BMSG=$P(BRES,U,2),BRES=+BRES
"RTN","BPSOSU",124,0)
 . S BMES="Submitted to ECME: Resubmit for released autoreversal"
"RTN","BPSOSU",125,0)
 . S BMES=BMES_$S(BRES=1:"-NO SUBMISSION VIA ECME",BRES=4:"-NOT PROCESSED",BRES=5:"-SOFTWARE ERROR",1:"")
"RTN","BPSOSU",126,0)
 . D ECMEACT^PSOBPSU1(RX,RXR,BMES,.5)
"RTN","BPSOSU",127,0)
 . I BRES=2 D ECMEACT^PSOBPSU1(RX,RXR,"Not ECME Billable: "_BMSG,.5)
"RTN","BPSOSU",128,0)
 Q
"RTN","BPSOSU",129,0)
 ;
"RTN","BPSOSU",130,0)
 ; NEW57 - Copy the BPS Transaction into BPS Log of Transaction
"RTN","BPSOSU",131,0)
 ;  Input
"RTN","BPSOSU",132,0)
 ;    IEN59 - BPS Transaction
"RTN","BPSOSU",133,0)
 ;  Returns
"RTN","BPSOSU",134,0)
 ;    BPS Log of Transaction IEN
"RTN","BPSOSU",135,0)
NEW57(IEN59) ;
"RTN","BPSOSU",136,0)
 F  L +^BPSTL:300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK ^BPSTL",,"NEW57",$T(+0))
"RTN","BPSOSU",137,0)
 ;
"RTN","BPSOSU",138,0)
 ; Get next record number in BPS Log of Transactions
"RTN","BPSOSU",139,0)
NEW57A N N,C
"RTN","BPSOSU",140,0)
 S N=$P(^BPSTL(0),U,3)+1
"RTN","BPSOSU",141,0)
 S C=$P(^BPSTL(0),U,4)+1
"RTN","BPSOSU",142,0)
 S $P(^BPSTL(0),U,3,4)=N_U_C
"RTN","BPSOSU",143,0)
 I $D(^BPSTL(N)) G NEW57A ; should never happen
"RTN","BPSOSU",144,0)
 L -^BPSTL
"RTN","BPSOSU",145,0)
 ;
"RTN","BPSOSU",146,0)
 ; Merge BPS Transaction into Log of Transactions
"RTN","BPSOSU",147,0)
 M ^BPSTL(N)=^BPST(IEN59)
"RTN","BPSOSU",148,0)
 ;
"RTN","BPSOSU",149,0)
 ; Indexing - First, fileman indexing
"RTN","BPSOSU",150,0)
 D
"RTN","BPSOSU",151,0)
 . N DIK,DA S DIK="^BPSTL(",DA=N N N D IX1^DIK
"RTN","BPSOSU",152,0)
 ;
"RTN","BPSOSU",153,0)
 ; Setup the NON-FILEMAN index on RX and Fill
"RTN","BPSOSU",154,0)
 N A,B
"RTN","BPSOSU",155,0)
 S A=$P(^BPSTL(N,1),U,11)
"RTN","BPSOSU",156,0)
 S B=$P(^BPSTL(N,1),U)
"RTN","BPSOSU",157,0)
 S ^BPSTL("NON-FILEMAN","RXIRXR",A,B,N)=""
"RTN","BPSOSU",158,0)
 ;
"RTN","BPSOSU",159,0)
 ; Quit with the new record number
"RTN","BPSOSU",160,0)
 Q N
"RTN","BPSOSU",161,0)
 ;
"RTN","BPSOSU",162,0)
 ; ISREVES - Is this a reversal claim
"RTN","BPSOSU",163,0)
 ; Input
"RTN","BPSOSU",164,0)
 ;   CLAIMIEN - Pointer to BPS Claims
"RTN","BPSOSU",165,0)
 ;
"RTN","BPSOSU",166,0)
 ; Return Value
"RTN","BPSOSU",167,0)
 ;   1 - Reversal claim
"RTN","BPSOSU",168,0)
 ;   0 - Not a reversal claim
"RTN","BPSOSU",169,0)
ISREVERS(CLAIM) ;
"RTN","BPSOSU",170,0)
 Q $P($G(^BPSC(CLAIM,100)),"^",3)="B2"
"RTN","BPSOSU",171,0)
 ;
"RTN","BPSOSU",172,0)
 ; SETCSTAT - Set the status for every transaction associated with
"RTN","BPSOSU",173,0)
 ;   this claim
"RTN","BPSOSU",174,0)
SETCSTAT(CLAIM,STATUS) ;
"RTN","BPSOSU",175,0)
 N IEN59,INDEX
"RTN","BPSOSU",176,0)
 ;
"RTN","BPSOSU",177,0)
 ; Determine correct index
"RTN","BPSOSU",178,0)
 I $$ISREVERS(CLAIM) S INDEX="AER"
"RTN","BPSOSU",179,0)
 E  S INDEX="AE"
"RTN","BPSOSU",180,0)
 ;
"RTN","BPSOSU",181,0)
 ; Loop through the transactions and set the status
"RTN","BPSOSU",182,0)
 S IEN59=""
"RTN","BPSOSU",183,0)
 F  S IEN59=$O(^BPST(INDEX,CLAIM,IEN59)) Q:IEN59=""  D SETSTAT(IEN59,STATUS)
"RTN","BPSOSU",184,0)
 Q
"RTN","BPSOSU",185,0)
 ;
"RTN","BPSOSU",186,0)
 ; ERROR - Handle any errors
"RTN","BPSOSU",187,0)
 ;   Log them into BPS Transactions
"RTN","BPSOSU",188,0)
 ;   Change status to 99
"RTN","BPSOSU",189,0)
 ;   Update the LOG
"RTN","BPSOSU",190,0)
 ;   Increment the statistics
"RTN","BPSOSU",191,0)
 ;   We should be okay for the resubmit flag since the STATUS
"RTN","BPSOSU",192,0)
 ;     will be E OTHER instead of E REVERSAL ACCEPTED
"RTN","BPSOSU",193,0)
 ; Input
"RTN","BPSOSU",194,0)
 ;   RTN     - Routine reporting the error
"RTN","BPSOSU",195,0)
 ;   IEN59   - BPS Transaction
"RTN","BPSOSU",196,0)
 ;   ERROR   - Error Number (goes in RESULT CODE)
"RTN","BPSOSU",197,0)
 ;   ERRTEXT - Error Text (goes in RESULT TEXT)
"RTN","BPSOSU",198,0)
 ;
"RTN","BPSOSU",199,0)
 ; To prevent conflicts, set the error number to the first digit of
"RTN","BPSOSU",200,0)
 ;   Status and a unique number for the status.
"RTN","BPSOSU",201,0)
ERROR(RTN,IEN59,ERROR,ERRTEXT) ;
"RTN","BPSOSU",202,0)
 ;
"RTN","BPSOSU",203,0)
 ; Check parameters
"RTN","BPSOSU",204,0)
 I '$G(IEN59) Q
"RTN","BPSOSU",205,0)
 I '$G(ERROR) S ERROR=0
"RTN","BPSOSU",206,0)
 I $G(ERRTEXT)="" S ERRTEXT="ERROR - see LOG"
"RTN","BPSOSU",207,0)
 ;
"RTN","BPSOSU",208,0)
 ; Set Error and Error Text in BPS Transaction
"RTN","BPSOSU",209,0)
 D SETRESU(IEN59,ERROR,ERRTEXT)
"RTN","BPSOSU",210,0)
 ;
"RTN","BPSOSU",211,0)
 ; Log Message
"RTN","BPSOSU",212,0)
 D LOG^BPSOSL(IEN59,RTN_" returned error - "_ERRTEXT)
"RTN","BPSOSU",213,0)
 ;
"RTN","BPSOSU",214,0)
 ; Update unbillable count in stats
"RTN","BPSOSU",215,0)
 D INCSTAT^BPSOSUD("R",1)
"RTN","BPSOSU",216,0)
 ;
"RTN","BPSOSU",217,0)
 ; Update Status to complete
"RTN","BPSOSU",218,0)
 D SETSTAT(IEN59,99)
"RTN","BPSOSU",219,0)
 Q
"RTN","BPSOSU",220,0)
 ;
"RTN","BPSOSU",221,0)
 ; SETRESU - Set Result into ^BPST(IEN59,2)
"RTN","BPSOSU",222,0)
 ; Input
"RTN","BPSOSU",223,0)
 ;   IEN59 - BPS Transaction IEN
"RTN","BPSOSU",224,0)
 ;   RESULT - Result Code
"RTN","BPSOSU",225,0)
 ;   TEXT   - Result Text.  Semi-colons (";") should not in the text data as
"RTN","BPSOSU",226,0)
 ;            this is used as a separator between current and previous text
"RTN","BPSOSU",227,0)
 ;            messages.  If there is a semi-colon, it is converted to a dash.
"RTN","BPSOSU",228,0)
SETRESU(IEN59,RESULT,TEXT) ;
"RTN","BPSOSU",229,0)
 ;
"RTN","BPSOSU",230,0)
 ; First, store the Result Code
"RTN","BPSOSU",231,0)
 S $P(^BPST(IEN59,2),U)=$G(RESULT)
"RTN","BPSOSU",232,0)
 ;
"RTN","BPSOSU",233,0)
 ; Second, store the Result Text
"RTN","BPSOSU",234,0)
 ; Considerations:
"RTN","BPSOSU",235,0)
 ;   Convert any semi-colons to dashes
"RTN","BPSOSU",236,0)
 ;   Add semi-colon delimiter if needed
"RTN","BPSOSU",237,0)
 ;   Truncate data if needed
"RTN","BPSOSU",238,0)
 I $G(TEXT)]"" D
"RTN","BPSOSU",239,0)
 . N X
"RTN","BPSOSU",240,0)
 . S TEXT=$TR(TEXT,";","-")
"RTN","BPSOSU",241,0)
 . S X=$P(^BPST(IEN59,2),U,2,99)
"RTN","BPSOSU",242,0)
 . I X]"",$E(X)'=";" S X=";"_X
"RTN","BPSOSU",243,0)
 . S X=$E(TEXT_X,1,255-$L(RESULT)-1)
"RTN","BPSOSU",244,0)
 . S $P(^BPST(IEN59,2),U,2)=X
"RTN","BPSOSU",245,0)
 Q
"RTN","BPSOSU",246,0)
 ;
"RTN","BPSOSU",247,0)
 ; SETCRESU - set the result code for every transaction assoc'd with
"RTN","BPSOSU",248,0)
 ;   this claim.  Note that this will only work for billing requests (B1)
"RTN","BPSOSU",249,0)
 ; Input
"RTN","BPSOSU",250,0)
 ;   CLAIMIEN - BPS Claim IEN
"RTN","BPSOSU",251,0)
 ;   RESULT   - Result Code
"RTN","BPSOSU",252,0)
 ;   TEXT     - Result Text
"RTN","BPSOSU",253,0)
SETCRESU(CLAIM,RESULT,TEXT) ;
"RTN","BPSOSU",254,0)
 N IEN59
"RTN","BPSOSU",255,0)
 S IEN59=""
"RTN","BPSOSU",256,0)
 F  S IEN59=$O(^BPST("AE",CLAIM,IEN59)) Q:IEN59=""  D SETRESU(IEN59,RESULT,$G(TEXT))
"RTN","BPSOSU",257,0)
 Q
"RTN","BPSOSU",258,0)
 ;
"RTN","BPSOSU",259,0)
 ; STATI(X) gives a text version of what status code X means.
"RTN","BPSOSU",260,0)
 ;   For effeciency, put more common ones at the top.
"RTN","BPSOSU",261,0)
 ; Also note that you should check the display on the stats screen if you
"RTN","BPSOSU",262,0)
 ;   modify any of these.
"RTN","BPSOSU",263,0)
STATI(X) ;
"RTN","BPSOSU",264,0)
 I X=99 Q "Done"
"RTN","BPSOSU",265,0)
 I X=60 Q "Transmitting"
"RTN","BPSOSU",266,0)
 I X=0 Q "Waiting to start"
"RTN","BPSOSU",267,0)
 I X=40 Q "Building the HL7 packet"
"RTN","BPSOSU",268,0)
 I X=70 Q "Parsing response"
"RTN","BPSOSU",269,0)
 I X=30 Q "Building the claim"
"RTN","BPSOSU",270,0)
 I X=10 Q "Building the transaction"
"RTN","BPSOSU",271,0)
 I X=90 Q "Processing response"
"RTN","BPSOSU",272,0)
 I X=98 Q "Resubmitting" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",273,0)
 I X=50 Q "Preparing for transmit"
"RTN","BPSOSU",274,0)
 I X=31 Q "Wait for retry (insurer asleep)"
"RTN","BPSOSU",275,0)
 I X=80 Q "Waiting to process response"
"RTN","BPSOSU",276,0)
 Q "?"_X_"?"
"RTN","BPSOSU6")
1^125
"RTN","BPSOSU7")
1^126
"RTN","BPSOSU8")
0^179^B19335097
"RTN","BPSOSU8",1,0)
BPSOSU8 ;BHAM ISC/FCS/DRS/FLS - utilities ;06/01/2004
"RTN","BPSOSU8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSU8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU8",4,0)
 ;*** Collection of FSI UTILITIES ***
"RTN","BPSOSU8",5,0)
 ;
"RTN","BPSOSU8",6,0)
 ;EOPQ(LINES,PARAM,Xcode) - Return 0 to continue, 1 to quit.
"RTN","BPSOSU8",7,0)
 ;PAUSE() Return 1 to continue, 0 to stop.
"RTN","BPSOSU8",8,0)
 ;ENDRPT()
"RTN","BPSOSU8",9,0)
 ;DEVICE(DEV,RTN,TITLE,MULTI) S up a device, 1 if successful, 0 not.
"RTN","BPSOSU8",10,0)
 ;HEADER(PROGRAM,TITLE1,TITLE2,RUNTIME,NOFF,UL) Procedure call
"RTN","BPSOSU8",11,0)
 ;CENTER
"RTN","BPSOSU8",12,0)
 ;UNDERLINE
"RTN","BPSOSU8",13,0)
 ;REPLICATE
"RTN","BPSOSU8",14,0)
 ;FMPAGE() Handle the screen or printer for an FM print report.
"RTN","BPSOSU8",15,0)
 ;PAGE0
"RTN","BPSOSU8",16,0)
 ;STANDBY
"RTN","BPSOSU8",17,0)
 ;======================================================================
"RTN","BPSOSU8",18,0)
EOPQ(LINESBOT,PARAM,EOPXCODE) ;EP -
"RTN","BPSOSU8",19,0)
 ; IN: LINESBOT = (optional) # of LINES from bottom (IOSL) before
"RTN","BPSOSU8",20,0)
 ;               determining what to do next.  I this is a CRT, we
"RTN","BPSOSU8",21,0)
 ;               will ask user whether to continue; for printers, just
"RTN","BPSOSU8",22,0)
 ;               continue.  DEFAULT=6
"RTN","BPSOSU8",23,0)
 ;     PARAM    = List of parameter codes (each may occur):
"RTN","BPSOSU8",24,0)
 ;                "M" - Will display "-- More --" at bottom.
"RTN","BPSOSU8",25,0)
 ;     EOPXCODE = xecutable code that will occur if this is the
"RTN","BPSOSU8",26,0)
 ;                end of the page (like, D HEADER^ROU).
"RTN","BPSOSU8",27,0)
 ;
"RTN","BPSOSU8",28,0)
 ; OUT: 0 if not end of page, OR if we're EOP but we're continuing;
"RTN","BPSOSU8",29,0)
 ;      1 if user wants to quit.
"RTN","BPSOSU8",30,0)
 ; May call this as DO in some cases (like a little trailer on report)
"RTN","BPSOSU8",31,0)
 ;
"RTN","BPSOSU8",32,0)
 N X,Y,%,DIR
"RTN","BPSOSU8",33,0)
 ;
"RTN","BPSOSU8",34,0)
 I '$G(IOSL) Q 0  ;if we don't know page length, then not at end
"RTN","BPSOSU8",35,0)
 S LINESBOT=$S($G(LINESBOT):LINESBOT,1:6)
"RTN","BPSOSU8",36,0)
 I ($Y+LINESBOT)<IOSL Q 0  ;not at end of page
"RTN","BPSOSU8",37,0)
 ; -- Okay, we're at end of page
"RTN","BPSOSU8",38,0)
 I $G(PARAM)["M" W !,?($S($G(IOM):IOM,1:80)-12),"-- More --"
"RTN","BPSOSU8",39,0)
 ;
"RTN","BPSOSU8",40,0)
 I '$$PAUSE Q 1  ;user wants out
"RTN","BPSOSU8",41,0)
 X $G(EOPXCODE)
"RTN","BPSOSU8",42,0)
 ;
"RTN","BPSOSU8",43,0)
 Q 0
"RTN","BPSOSU8",44,0)
 ;======================================================================
"RTN","BPSOSU8",45,0)
PAUSE() ;3/31/93
"RTN","BPSOSU8",46,0)
 ;END of screen... should we continue?
"RTN","BPSOSU8",47,0)
 ;I $E(IOST,1)'="C"
"RTN","BPSOSU8",48,0)
 I '$$TOSCREEN^BPSOSU5 Q 1
"RTN","BPSOSU8",49,0)
 K DIR
"RTN","BPSOSU8",50,0)
 S DIR(0)="E" D ^DIR
"RTN","BPSOSU8",51,0)
 Q Y  ;Y=1 to continue, 0 to quit.
"RTN","BPSOSU8",52,0)
 ;===================================================================
"RTN","BPSOSU8",53,0)
ENDRPT() ;EP - end of report.  Pause until user presses return (or timeout)
"RTN","BPSOSU8",54,0)
 I '$$TOSCREEN^BPSOSU5 W:$Y @IOF Q 1
"RTN","BPSOSU8",55,0)
 I $G(FLGSTOP) W !," <escape>"
"RTN","BPSOSU8",56,0)
 N DIR,X,Y
"RTN","BPSOSU8",57,0)
 S DIR(0)="E"
"RTN","BPSOSU8",58,0)
 S DIR("A")="  -- END OF REPORT --  (Press <ENTER> to return to menu)"
"RTN","BPSOSU8",59,0)
 D ^DIR
"RTN","BPSOSU8",60,0)
 Q Y
"RTN","BPSOSU8",61,0)
 ;===================================================================
"RTN","BPSOSU8",62,0)
DEVICE(DEV,RTN,TITLE,MULTI) ;EP
"RTN","BPSOSU8",63,0)
 ;Select an output device.
"RTN","BPSOSU8",64,0)
 ;No parameters are required.  DEV can be set alone, or if queuing
"RTN","BPSOSU8",65,0)
 ;  set to variables needed for queuing.
"RTN","BPSOSU8",66,0)
 ;   DEV   - DEFAULT device, "HOME" if undefined.
"RTN","BPSOSU8",67,0)
 ;   RTN   - Routine name if queuing is selected.
"RTN","BPSOSU8",68,0)
 ;   TITLE - Description for the task log if queuing is selected.
"RTN","BPSOSU8",69,0)
 ;   MULTI - I then ask NUMBER OF COPIES, which sets the variable
"RTN","BPSOSU8",70,0)
 ;           DCOPIES that the calling routine should use.
"RTN","BPSOSU8",71,0)
 ;Return 1 if successful, 0 if not.  Also returns DCOPIES to number of
"RTN","BPSOSU8",72,0)
 ;  copies if MULTI parameter is set.
"RTN","BPSOSU8",73,0)
 ;Examples: Q:'$$DEVICE^ABSBUU01("STANDARD")
"RTN","BPSOSU8",74,0)
 ;
"RTN","BPSOSU8",75,0)
 ;       Q:'$$DEVICE^ABSBUU01("PC;132;66","EN^WSHLC","CORRECTION LIST")
"RTN","BPSOSU8",76,0)
 ;       note: D ^%ZISC to close the device after printing is done.
"RTN","BPSOSU8",77,0)
 N I,Y,%ZIS,POP,ZTRTN,ZTIO,ZTDESC,ZTSAVE,ZTQUEUED,PAGE
"RTN","BPSOSU8",78,0)
 W !!
"RTN","BPSOSU8",79,0)
 S ZTSAVE("PAGE")=""
"RTN","BPSOSU8",80,0)
 I $D(RTN) S %ZIS="QM" ; Ask if queuing is allowed only if RTN is set.
"RTN","BPSOSU8",81,0)
 S %ZIS("A")="Send report to device: " ;PROMPT
"RTN","BPSOSU8",82,0)
 S %ZIS("B")=$S($D(DEV):DEV,1:"HOME") ;DEFAULT device
"RTN","BPSOSU8",83,0)
 D ^%ZIS ;Input/Output variables.
"RTN","BPSOSU8",84,0)
 I POP W "   try again later" S Y=0 G DEVQ  ;Device success flag
"RTN","BPSOSU8",85,0)
 S PAGE=0
"RTN","BPSOSU8",86,0)
 I '$D(IO("Q")) U IO S Y=1 G DEVQ ;Queuing not selected
"RTN","BPSOSU8",87,0)
 S ZTRTN=RTN ;Routine entry point for queuing.
"RTN","BPSOSU8",88,0)
 S ZTIO=ION ;Output device for queuing.
"RTN","BPSOSU8",89,0)
 S ZTDESC=$G(TITLE) ;Report title if queuing is selected.
"RTN","BPSOSU8",90,0)
 S ZTSAVE("*")="" ;All variables in memory for queuing.
"RTN","BPSOSU8",91,0)
 D ^%ZTLOAD ;Entry point for queuing.
"RTN","BPSOSU8",92,0)
 W !,$S($D(ZTQUEUED):"Request queued!",1:"Request cancelled!") ;flag
"RTN","BPSOSU8",93,0)
 S Y='$D(ZTQUEUED)
"RTN","BPSOSU8",94,0)
 D HOME^%ZIS ;S IO variables back to device = screen.
"RTN","BPSOSU8",95,0)
 U IO ;Use the currently open IO device
"RTN","BPSOSU8",96,0)
DEVQ I +$G(MULTI)>0 D  USE IO
"RTN","BPSOSU8",97,0)
 . USE $P
"RTN","BPSOSU8",98,0)
 . N Y
"RTN","BPSOSU8",99,0)
 . S DCOPIES=0
"RTN","BPSOSU8",100,0)
 . K DIR
"RTN","BPSOSU8",101,0)
 . S DIR(0)="NO^0:99999",DIR("A")="NUMBER OF COPIES TO OUTPUT"
"RTN","BPSOSU8",102,0)
 . S DIR("B")=1
"RTN","BPSOSU8",103,0)
 . D ^DIR K DIR
"RTN","BPSOSU8",104,0)
 . I +Y>0 S DCOPIES=Y
"RTN","BPSOSU8",105,0)
 . I Y["^" S DCOPIES=-1
"RTN","BPSOSU8",106,0)
 I $G(DCOPIES)<0 S Y=0
"RTN","BPSOSU8",107,0)
 Q Y
"RTN","BPSOSU8",108,0)
 ;===================================================================
"RTN","BPSOSU8",109,0)
HEADER(PROGRAM,TITLE1,TITLE2,RUNTIME,NOFF,UL) ;
"RTN","BPSOSU8",110,0)
 ; This PROCEDURE accepts the routine name and titles and prints out a 
"RTN","BPSOSU8",111,0)
 ; standard header with the run date and time,page and increments
"RTN","BPSOSU8",112,0)
 ; the page counter by 1.  Page is initialized in function DEVICE.
"RTN","BPSOSU8",113,0)
 ; W @IOF if (to SCREEN) OR (to PRINTER after page 1)
"RTN","BPSOSU8",114,0)
 ;    TITLE variable has special uses.  I the calling routine
"RTN","BPSOSU8",115,0)
 ; send-in the TITLE-array (by setting TITLE(1)="LINE 1", TITLE(n)=
"RTN","BPSOSU8",116,0)
 ; "LINE n of title", and then D HEADER^WSHUTL("ROUTINE",.TITLE),"."),
"RTN","BPSOSU8",117,0)
 ; then the entire array of TITLE will be used (and TITLE2 will be
"RTN","BPSOSU8",118,0)
 ; ignored).  You must send-in TITLE2="."
"RTN","BPSOSU8",119,0)
 ;    RUNTIME has been added so that all pages of the report can
"RTN","BPSOSU8",120,0)
 ; have the same date.time.  The calling report must send it in.
"RTN","BPSOSU8",121,0)
 ;    NOFF (optional) - if it exists, then do NOT issue a FormFeed.
"RTN","BPSOSU8",122,0)
 ; This is necessary for reports that are controlled as a FileMan
"RTN","BPSOSU8",123,0)
 ; template... since FM issues its own FF, this routine should not.
"RTN","BPSOSU8",124,0)
 ;    UL (opt) - is flag to print a 1-IOSL dashes after the header.
"RTN","BPSOSU8",125,0)
 ; DEFAULT is no-underline.  S UL to 1 to print the underline.
"RTN","BPSOSU8",126,0)
 ;
"RTN","BPSOSU8",127,0)
 ; Note: PAGE is assumed to exist even though it is not passed in
"RTN","BPSOSU8",128,0)
 N X,N
"RTN","BPSOSU8",129,0)
 S $Y=0,PAGE=$G(PAGE)
"RTN","BPSOSU8",130,0)
 I $E(IOST,1)="C"!($E(IOST,1)="P"&(PAGE>0)) I '$D(NOFF) W @IOF
"RTN","BPSOSU8",131,0)
 S PAGE=PAGE+1
"RTN","BPSOSU8",132,0)
 I $G(RUNTIME)="" D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S RUNTIME=Y
"RTN","BPSOSU8",133,0)
 W !,"RUN DATE: ",RUNTIME
"RTN","BPSOSU8",134,0)
 W ?(IOM-10),"PAGE: ",$J(PAGE,3,0)
"RTN","BPSOSU8",135,0)
 I $D(PROGRAM),PROGRAM'="" W !,"PGM:  ",PROGRAM
"RTN","BPSOSU8",136,0)
 I $G(TITLE2)'="." DO
"RTN","BPSOSU8",137,0)
 . I $D(TITLE1) D WCENTER^BPSOSU9(TITLE1)
"RTN","BPSOSU8",138,0)
 . I $D(TITLE2) D WCENTER^BPSOSU9(TITLE2)
"RTN","BPSOSU8",139,0)
 I $G(TITLE2)="." DO
"RTN","BPSOSU8",140,0)
 . S N=""
"RTN","BPSOSU8",141,0)
 . F  S N=$O(TITLE1(N)) Q:N=""  D WCENTER^BPSOSU9($G(TITLE1(N)))
"RTN","BPSOSU8",142,0)
 I $G(UL)=1 D  ;print dashes across the page
"RTN","BPSOSU8",143,0)
 . W !
"RTN","BPSOSU8",144,0)
 . FOR I=1:1:$S($G(IOM)>0:IOM,1:80) W "-"
"RTN","BPSOSU8",145,0)
 W !
"RTN","BPSOSU8",146,0)
 Q
"RTN","BPSOSU8",147,0)
 ;===================================================================
"RTN","BPSOSU8",148,0)
FMPAGE ;at end of page
"RTN","BPSOSU8",149,0)
 I $$TOSCREEN^BPSOSU5 D  Q
"RTN","BPSOSU8",150,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSOSU8",151,0)
 I IOST["P-" W @IOF Q
"RTN","BPSOSU8",152,0)
 ; should we fall through to PAGE0?
"RTN","BPSOSU8",153,0)
 Q
"RTN","BPSOSU8",154,0)
 ;===================================================================
"RTN","BPSOSU8",155,0)
PAGE0 ; This checks the IO device and issues a pagefeed if $Y>0
"RTN","BPSOSU8",156,0)
 Q:'$G(IO)
"RTN","BPSOSU8",157,0)
 ;OPEN IO USE IO I $Y>0 USE IO W #
"RTN","BPSOSU8",158,0)
 U IO I $Y>0 U IO W #
"RTN","BPSOSU8",159,0)
 Q
"RTN","BPSOSU8",160,0)
 ;===================================================================
"RTN","BPSOSU8",161,0)
STANDBY ;  W a message to screen to "Please Wait"
"RTN","BPSOSU8",162,0)
 USE $P D WAIT^DICD USE +$G(IO)
"RTN","BPSOSU8",163,0)
 Q
"RTN","BPSOSU8",164,0)
 ;===================================================================
"RTN","BPSOSUA")
1^127
"RTN","BPSOSUC")
0^180^B6143853
"RTN","BPSOSUC",1,0)
BPSOSUC ;BHAM ISC/FCS/DRS/FLS - ECME utilities ;06/01/2004
"RTN","BPSOSUC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSUC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSUC",4,0)
 Q
"RTN","BPSOSUC",5,0)
 ; CATEG returns the status of a Transaction or Log of Transaction
"RTN","BPSOSUC",6,0)
 ;   entry.  It is used mainly by STATUS^BPSOSRX but is also
"RTN","BPSOSUC",7,0)
 ;   called by some other routines as well as computed fields of BPS Log
"RTN","BPSOSUC",8,0)
 ;   of Transactions and BPS Tranasctions
"RTN","BPSOSUC",9,0)
CATEG(N,WANTREV) ;
"RTN","BPSOSUC",10,0)
 ; N - If decimal, IEN from BPS Transaction
"RTN","BPSOSUC",11,0)
 ;   - If integer, IEN from BPS Log of Transactions
"RTN","BPSOSUC",12,0)
 ; $G(WANTREV) = true if you care about reversals
"RTN","BPSOSUC",13,0)
 ;      (that's the default if N is an IEN59)
"RTN","BPSOSUC",14,0)
 ; $G(WANTREV) = false if you want to ignore reversals
"RTN","BPSOSUC",15,0)
 ;      (that's the default if IEN57)
"RTN","BPSOSUC",16,0)
 ;
"RTN","BPSOSUC",17,0)
 ; Many routines rely on these exact return values; do not change them:
"RTN","BPSOSUC",18,0)
 ; Return values:
"RTN","BPSOSUC",19,0)
 ;     For both reversals and submissions:
"RTN","BPSOSUC",20,0)
 ;       CORRUPT - Should never happen
"RTN","BPSOSUC",21,0)
 ;
"RTN","BPSOSUC",22,0)
 ;     For submissions:
"RTN","BPSOSUC",23,0)
 ;       E PAYABLE, E CAPTURED, E DUPLICATE, E REJECTED, E OTHER, and
"RTN","BPSOSUC",24,0)
 ;       E STRANDED
"RTN","BPSOSUC",25,0)
 ;
"RTN","BPSOSUC",26,0)
 ;     For Reversals:
"RTN","BPSOSUC",27,0)
 ;       E REVERSAL ACCEPTED, E REVERSAL REJECTED, E REVERSAL OTHER, and
"RTN","BPSOSUC",28,0)
 ;       E REVERSAL STRANDED
"RTN","BPSOSUC",29,0)
 ;
"RTN","BPSOSUC",30,0)
 I N<1 Q "" ; Should not happen
"RTN","BPSOSUC",31,0)
 N FILENUM S FILENUM=$S(N[".":9002313.59,1:9002313.57)
"RTN","BPSOSUC",32,0)
 I '$D(WANTREV) S WANTREV=$S(FILENUM=9002313.57:0,FILENUM=9002313.59:1)
"RTN","BPSOSUC",33,0)
 N RETVAL,CLAIM,RESP,X,RESP500,CODE,STAT,DISYS
"RTN","BPSOSUC",34,0)
 I '$$GET1^DIQ(FILENUM,N_",",.01) Q "CORRUPT"
"RTN","BPSOSUC",35,0)
 S CLAIM=$$GET1^DIQ(FILENUM,N_",",3,"I")
"RTN","BPSOSUC",36,0)
 S RESP=$$GET1^DIQ(FILENUM,N_",",4,"I")
"RTN","BPSOSUC",37,0)
 S CODE=$$GET1^DIQ(FILENUM,N_",",201,"I")
"RTN","BPSOSUC",38,0)
 S STAT=$$GET1^DIQ(FILENUM,N_",",202,"I")
"RTN","BPSOSUC",39,0)
 I $P(STAT,";")="E REVERSAL STRANDED" Q "E REVERSAL STRANDED"
"RTN","BPSOSUC",40,0)
 I $P(STAT,";")="E STRANDED" Q "E STRANDED"
"RTN","BPSOSUC",41,0)
 ; During a reversal/resubmit, you may get the next line between the reversal and
"RTN","BPSOSUC",42,0)
 ;   and the resubmit
"RTN","BPSOSUC",43,0)
 I 'CLAIM S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",44,0)
 I WANTREV S X=$$GET1^DIQ(FILENUM,N_",",401,"I") I X D  Q RETVAL
"RTN","BPSOSUC",45,0)
 . S RESP=$$GET1^DIQ(FILENUM,N_",",402,"I")
"RTN","BPSOSUC",46,0)
 . S RETVAL="E REVERSAL "
"RTN","BPSOSUC",47,0)
 . I 'RESP S RETVAL=RETVAL_"OTHER" Q
"RTN","BPSOSUC",48,0)
 . S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",49,0)
 . S X=$$RESP1000^BPSOSQ4(RESP,1,"I")
"RTN","BPSOSUC",50,0)
 . I RESP500="R"!(X="R") S RETVAL=RETVAL_"REJECTED" Q
"RTN","BPSOSUC",51,0)
 . ; Treat Duplicate of Accepted Reversal ("S") as Accepted
"RTN","BPSOSUC",52,0)
 . I RESP500="A",X="A"!(X="S") S RETVAL=RETVAL_"ACCEPTED" Q
"RTN","BPSOSUC",53,0)
 . S RETVAL=RETVAL_"OTHER"
"RTN","BPSOSUC",54,0)
 ; Response not received yet
"RTN","BPSOSUC",55,0)
 I 'RESP S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",56,0)
 S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",57,0)
 N POS S POS=$$GET1^DIQ(FILENUM,N_",",14)
"RTN","BPSOSUC",58,0)
 S X=$$RESP1000^BPSOSQ4(RESP,POS,"I")
"RTN","BPSOSUC",59,0)
 I X="P"!(X="DP") Q "E PAYABLE"
"RTN","BPSOSUC",60,0)
 I X="D" Q "E DUPLICATE" ; SHOULD NEVER HAPPEN as of 02/06/2001
"RTN","BPSOSUC",61,0)
 I X="R" Q "E REJECTED"
"RTN","BPSOSUC",62,0)
 I X="C"!(X="DC") Q "E CAPTURED"
"RTN","BPSOSUC",63,0)
 ; 1000 indefinite, fall back to 500
"RTN","BPSOSUC",64,0)
 I RESP500="R" Q "E REJECTED"
"RTN","BPSOSUC",65,0)
 Q "E OTHER" ; corrupt?
"RTN","BPSOSUD")
0^181^B21782144
"RTN","BPSOSUD",1,0)
BPSOSUD ;BHAM ISC/FCS/DRS/FLS - utils, some options ;06/01/2004
"RTN","BPSOSUD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSOSUD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSUD",4,0)
 ;
"RTN","BPSOSUD",5,0)
 ; Some utilities.
"RTN","BPSOSUD",6,0)
 ; Some options- goal is to move them out to other routines
"RTN","BPSOSUD",7,0)
 ;
"RTN","BPSOSUD",8,0)
 Q
"RTN","BPSOSUD",9,0)
 ;
"RTN","BPSOSUD",10,0)
INCSTAT(N1,P1,N2,P2,N3,P3) ;EP - BPSBUTL,BPSOSQL
"RTN","BPSOSUD",11,0)
 ; increment the given N nodes at the P pieces
"RTN","BPSOSUD",12,0)
 D ADD1STAT(N1,P1,1)
"RTN","BPSOSUD",13,0)
 Q:'$D(N2)  D ADD1STAT(N2,P2,1)
"RTN","BPSOSUD",14,0)
 Q:'$D(N3)  D ADD1STAT(N3,P3,1)
"RTN","BPSOSUD",15,0)
 Q
"RTN","BPSOSUD",16,0)
ADDSTAT(N1,P1,Q1,N2,P2,Q2,N3,P3,Q3) ;
"RTN","BPSOSUD",17,0)
 ; add Quantities to given Nodes,Pieces
"RTN","BPSOSUD",18,0)
 D ADD1STAT(N1,P1,Q1)
"RTN","BPSOSUD",19,0)
 Q:'$D(N2)  D ADD1STAT(N2,P2,Q2)
"RTN","BPSOSUD",20,0)
 Q:'$D(N3)  D ADD1STAT(N3,P3,Q3)
"RTN","BPSOSUD",21,0)
 Q
"RTN","BPSOSUD",22,0)
ADD1STAT(N,P,Q) ;
"RTN","BPSOSUD",23,0)
 L +^BPSECX("S",1,N):5
"RTN","BPSOSUD",24,0)
 I '$D(^BPSECX("S",1,N)) S ^BPSECX("S",1,N)=""
"RTN","BPSOSUD",25,0)
 S $P(^BPSECX("S",1,N),U,P)=$P(^BPSECX("S",1,N),U,P)+Q
"RTN","BPSOSUD",26,0)
 L -^BPSECX("S",1,N)
"RTN","BPSOSUD",27,0)
 Q
"RTN","BPSOSUD",28,0)
 ;
"RTN","BPSOSUD",29,0)
DATETIME(Y) ;EP - convert fileman date.time to printable
"RTN","BPSOSUD",30,0)
 X ^DD("DD") Q Y
"RTN","BPSOSUD",31,0)
TIMEAGO(THEN) ; external form for TIMEAGOI
"RTN","BPSOSUD",32,0)
 N %,%H,%I,X D NOW^%DTC Q $$TIMEDIF(THEN,%)
"RTN","BPSOSUD",33,0)
TIMEAGOI(THEN) ; how many seconds ago was it? returns positive value
"RTN","BPSOSUD",34,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",35,0)
 Q $$TIMEDIFI(THEN,%)
"RTN","BPSOSUD",36,0)
TIMEDIFI(X1,X2) ;EP - Computed field of BPS Log of Transactions and BPS Transactions
"RTN","BPSOSUD",37,0)
 ; time difference in seconds, negative if X1>X2
"RTN","BPSOSUD",38,0)
 I X1>X2 Q -$$TIMEDIFI(X2,X1)
"RTN","BPSOSUD",39,0)
 N %,X,%H,%T,%Y,D1,T1,D2,T2
"RTN","BPSOSUD",40,0)
 S X=X1 D H^%DTC S D1=%H,T1=%T
"RTN","BPSOSUD",41,0)
 S X=X2 D H^%DTC S D2=%H,T2=%T
"RTN","BPSOSUD",42,0)
 S X=D2-D1*86400+T2-T1
"RTN","BPSOSUD",43,0)
 Q X
"RTN","BPSOSUD",44,0)
TIMEDIF(X1,X2) ;EP - Computed field of BPS Log of Transactions and BPS Transactions
"RTN","BPSOSUD",45,0)
 N X S X=$$TIMEDIFI(X1,X2)
"RTN","BPSOSUD",46,0)
 N SGN S SGN=$S(X<0:-1,1:1),X=X*SGN
"RTN","BPSOSUD",47,0)
 Q $S(SGN<0:"-",1:"")_$$SECSDHMS(X)
"RTN","BPSOSUD",48,0)
SECSDHMS(X) ;EP - seconds ->  # da # hr # min # sec
"RTN","BPSOSUD",49,0)
 N % S %=""
"RTN","BPSOSUD",50,0)
 I X'<86400 S %=X\86400_" da",X=X#86400
"RTN","BPSOSUD",51,0)
 I X'<3600!(%]"") S:%]"" %=%_" " S %=%_(X\3600)_" hr",X=X#3600
"RTN","BPSOSUD",52,0)
 I X'<60!(%]"") S:%]"" %=%_" " S %=%_(X\60)_" min",X=X#60
"RTN","BPSOSUD",53,0)
 S:%]"" %=%_" " S %=%_X_" sec"
"RTN","BPSOSUD",54,0)
 Q %
"RTN","BPSOSUD",55,0)
PRESSANY D PRESSANY^BPSOSU5() Q
"RTN","BPSOSUD",56,0)
CONTINUE(DEF) ;EP -
"RTN","BPSOSUD",57,0)
 ; returns a single character
"RTN","BPSOSUD",58,0)
 ; or returns DEF, the default
"RTN","BPSOSUD",59,0)
CONT1 ;
"RTN","BPSOSUD",60,0)
 S X=$$FREETEXT^BPSOSU2("Type C to continue or Q to quit: ",,1,1,1,15)
"RTN","BPSOSUD",61,0)
 Q X
"RTN","BPSOSUD",62,0)
 ;
"RTN","BPSOSUD",63,0)
TT() Q "S:Y[""."" Y=$P(Y,""."",2) S Y=Y_""000000"" S Y=""@""_$E(Y,1,2)_"":""_$E(Y,3,4)_"":""_$E(Y,5,6)" ; TT is kind of like ^DD("DD") but just for our times
"RTN","BPSOSUD",64,0)
SHOULDNT W "this should never happen" Q
"RTN","BPSOSUD",65,0)
TDIFNOW(T) ;EP - ; compute time difference between T and NOW
"RTN","BPSOSUD",66,0)
 ; returns # of seconds, positive if T precedes now (how long ago)
"RTN","BPSOSUD",67,0)
 ;   negative if T follows NOW (countdown "T minus...")
"RTN","BPSOSUD",68,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",69,0)
 Q $$TDIF(%,T)
"RTN","BPSOSUD",70,0)
TDIF(T1,T2) ; compute time difference T1-T2 = how many seconds
"RTN","BPSOSUD",71,0)
 ;T1,T2 both Fileman date.times
"RTN","BPSOSUD",72,0)
 S T1=$TR($J(T1,16,8)," ","0"),T2=$TR($J(T2,16,8)," ","0")
"RTN","BPSOSUD",73,0)
 N R S R=$P(T1,".")-$P(T2,".")*86400 ; days' difference
"RTN","BPSOSUD",74,0)
 S T1=$P(T1,".",2),T2=$P(T2,".",2) ; hhmmsstt
"RTN","BPSOSUD",75,0)
 S T1=$E(T1,1,2)*60+$E(T1,3,4)*60+$E(T1,5,6)
"RTN","BPSOSUD",76,0)
 S T2=$E(T2,1,2)*60+$E(T2,3,4)*60+$E(T2,5,6)
"RTN","BPSOSUD",77,0)
 I $E(T1,7,8) S T1=$E(T1,7,8)/100+T1
"RTN","BPSOSUD",78,0)
 I $E(T2,7,8) S T2=$E(T2,7,8)/100+T2
"RTN","BPSOSUD",79,0)
 S R=R+T1-T2
"RTN","BPSOSUD",80,0)
 Q R
"RTN","BPSOSUD",81,0)
TADDSECS(T1,SECS) ; add SECS seconds to T1
"RTN","BPSOSUD",82,0)
 N T2 S T2=$$SECS2T2(SECS)
"RTN","BPSOSUD",83,0)
 Q $$TADD(T1,T2)
"RTN","BPSOSUD",84,0)
BADPARAM(VARNAME,ATLABEL) D IMPOSS^BPSOSUE("P,DB","TI","Bad parameter "_VARNAME_"="_$G(@VARNAME),,ATLABEL,$T(+0)) Q
"RTN","BPSOSUD",85,0)
TADDNOWS(SECS) ;EP - add SECS seconds to NOW
"RTN","BPSOSUD",86,0)
 I SECS'?1N.N D BADPARAM("SECS","TADDNOWS") Q ""
"RTN","BPSOSUD",87,0)
 N T2 S T2=$$SECS2T2(SECS)
"RTN","BPSOSUD",88,0)
 Q $$TADDNOW(T2)
"RTN","BPSOSUD",89,0)
SECS2T2(SECS) ; convert integer seconds into a fileman time format
"RTN","BPSOSUD",90,0)
 N T2,NEG S NEG=(SECS<0) I NEG S SECS=-SECS
"RTN","BPSOSUD",91,0)
 I SECS>86400 S T2=SECS\86400,SECS=SECS#86400_"."
"RTN","BPSOSUD",92,0)
 E  S T2="."
"RTN","BPSOSUD",93,0)
 N % S %=SECS\3600,SECS=SECS#3600 S:$L(%)=1 %="0"_% S T2=T2_%
"RTN","BPSOSUD",94,0)
 S %=SECS\60,SECS=SECS#60 S:$L(%)=1 %="0"_% S T2=T2_%
"RTN","BPSOSUD",95,0)
 S:$L(SECS)=1 SECS="0"_SECS S T2=T2_SECS
"RTN","BPSOSUD",96,0)
 Q $S(NEG:"-",1:"")_T2
"RTN","BPSOSUD",97,0)
TADDNOW(T2) ;EP - ; add T2 time differential to NOW
"RTN","BPSOSUD",98,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",99,0)
 Q $$TADD(%,T2)
"RTN","BPSOSUD",100,0)
TADD(T1,T2) ;EP -  ; add T2 time differential to T1
"RTN","BPSOSUD",101,0)
 I T1<0 D BADPARAM("T1","TADD") Q  ; but T2 can be negative
"RTN","BPSOSUD",102,0)
 N SGN S SGN=$S(T2<0:-1,1:1),T2=T2*SGN
"RTN","BPSOSUD",103,0)
 I SGN<0,T2>T1 D BADPARAM("T2","TADD") Q  ; can't handle this case (yet)
"RTN","BPSOSUD",104,0)
 S T1=$TR($J(T1,16,8)," ","0"),T2=$TR($J(T2,16,8)," ","0")
"RTN","BPSOSUD",105,0)
 N R ;S R=$P(T1,".",1)+($P(T2,".",1)*SGN) ; add days portion
"RTN","BPSOSUD",106,0)
 S R=$$CDTC($P(T1,"."),$P(T2,".")*SGN)
"RTN","BPSOSUD",107,0)
 S T2=$P(T2,".",2) ; note: without the sign
"RTN","BPSOSUD",108,0)
 S T1=$P(T1,".",2)
"RTN","BPSOSUD",109,0)
 S T1=$E(T1,1,2)*60+$E(T1,3,4)*60+$E(T1,5,6) ; seconds
"RTN","BPSOSUD",110,0)
 S T2=$E(T2,1,2)*60+$E(T2,3,4)*60+$E(T2,5,6) ; seconds
"RTN","BPSOSUD",111,0)
 I $E(T1,7,8) S T1=$E(T1,7,8)/100+T1 ; hundredths
"RTN","BPSOSUD",112,0)
 I $E(T2,7,8) S T2=$E(T2,7,8)/100+T2 ; hundredths
"RTN","BPSOSUD",113,0)
 S T2=T2*SGN ; restore sign to T2's hundredths
"RTN","BPSOSUD",114,0)
 N S S S=T1+T2
"RTN","BPSOSUD",115,0)
 I S>86400 S S=S-86400,R=$$CDTC(R,1) ; R+1 ; carry
"RTN","BPSOSUD",116,0)
 E  I S<0 S S=S+86400,R=$$CDTC(R,-1) ; R-1 ; borrow
"RTN","BPSOSUD",117,0)
 S T2=S\3600,S=S#3600
"RTN","BPSOSUD",118,0)
 S R=R_"."_$TR($J(T2,2)," ","0") ; hours
"RTN","BPSOSUD",119,0)
 S T2=S\60,S=S#60
"RTN","BPSOSUD",120,0)
 S R=R_$TR($J(T2,2)," ","0") ; minutes
"RTN","BPSOSUD",121,0)
 S T2=S\1,S=S#1
"RTN","BPSOSUD",122,0)
 S R=R_$TR($J(T2,2)," ","0") ; seconds
"RTN","BPSOSUD",123,0)
 S T2=S*100\1,R=R_$TR($J(T2,2)," ","0") ; hundredths of seconds
"RTN","BPSOSUD",124,0)
 S R=+R ; removes trailing zeroes
"RTN","BPSOSUD",125,0)
 Q R
"RTN","BPSOSUD",126,0)
CDTC(X1,X2) N X,%H D C^%DTC Q X
"RTN","BPSP11P")
1^188
"RTN","BPSPHAR")
0^205^B1798391
"RTN","BPSPHAR",1,0)
BPSPHAR ;BHAM ISC/BEE - ECME MGR PHAR OPTION ;14-FEB-05
"RTN","BPSPHAR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSPHAR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSPHAR",4,0)
 ;
"RTN","BPSPHAR",5,0)
 ; This routine is called by the BPS SETUP PHARMACY menu option. It updates
"RTN","BPSPHAR",6,0)
 ; several fields in the BPS PHARMACIES file.
"RTN","BPSPHAR",7,0)
 ;
"RTN","BPSPHAR",8,0)
 Q
"RTN","BPSPHAR",9,0)
 ;
"RTN","BPSPHAR",10,0)
EN ; Main Entry Point
"RTN","BPSPHAR",11,0)
 N D0,DA,DI,DIC,DLAYGO,DIE,DIRUT,DQ,DR,DTOUT,DUOUT,X,Y
"RTN","BPSPHAR",12,0)
 ;
"RTN","BPSPHAR",13,0)
 ; First select the pharmacy or enter a new one
"RTN","BPSPHAR",14,0)
 W !! S DIC(0)="QEALM",(DLAYGO,DIC)=9002313.56,DIC("A")="Select BPS PHARMACIES NAME: "
"RTN","BPSPHAR",15,0)
 D ^DIC
"RTN","BPSPHAR",16,0)
 ;
"RTN","BPSPHAR",17,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSPHAR",18,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)=-1) Q
"RTN","BPSPHAR",19,0)
 ;
"RTN","BPSPHAR",20,0)
 ;Pull internal entry
"RTN","BPSPHAR",21,0)
 S DA=$P($G(Y),U) Q:'$G(Y)
"RTN","BPSPHAR",22,0)
 ;
"RTN","BPSPHAR",23,0)
 ; If new BPS Pharmacy, default the CMOP Switch and Auto-Reversal Parameter
"RTN","BPSPHAR",24,0)
 I $P(Y,U,3)=1 D
"RTN","BPSPHAR",25,0)
 . N DIE,DR,DTOUT
"RTN","BPSPHAR",26,0)
 . S DIE=9002313.56,DR="1////0;.09////0"
"RTN","BPSPHAR",27,0)
 . D ^DIE
"RTN","BPSPHAR",28,0)
 ;
"RTN","BPSPHAR",29,0)
 ; Display the BPS Pharmacy name, NCPDP #, and NPI
"RTN","BPSPHAR",30,0)
 W !!,"NAME: ",$P($G(^BPS(9002313.56,DA,0)),U,1)
"RTN","BPSPHAR",31,0)
 W !,"STATUS: ",$$GET1^DIQ(9002313.56,DA,.1,"E")
"RTN","BPSPHAR",32,0)
 W !,"NCPDP #: ",$P($G(^BPS(9002313.56,DA,0)),U,2)
"RTN","BPSPHAR",33,0)
 W !,"NPI: ",$P($G(^BPS(9002313.56,DA,"NPI")),U,1)
"RTN","BPSPHAR",34,0)
 ;
"RTN","BPSPHAR",35,0)
 ; Now edit OUTPATIENT SITE, CMOP SWITCH, AUTO-REVERSE PARAMETER, 
"RTN","BPSPHAR",36,0)
 ;   and the DEFAULT DEA #
"RTN","BPSPHAR",37,0)
 S DIE=9002313.56
"RTN","BPSPHAR",38,0)
 S DR="13800;1;.09;.03"
"RTN","BPSPHAR",39,0)
 S DR(2,9002313.5601)=".01"
"RTN","BPSPHAR",40,0)
 D ^DIE
"RTN","BPSPHAR",41,0)
 ;
"RTN","BPSPHAR",42,0)
 Q
"RTN","BPSRCRI")
0^202^B34932652
"RTN","BPSRCRI",1,0)
BPSRCRI  ;BHAM ISC/NSS - ECME REPORTS ;08-FEB-07
"RTN","BPSRCRI",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPSRCRI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRCRI",4,0)
 ;
"RTN","BPSRCRI",5,0)
 Q
"RTN","BPSRCRI",6,0)
 ;
"RTN","BPSRCRI",7,0)
 ;ECME Claims Response Inquiry Report
"RTN","BPSRCRI",8,0)
 ; 
"RTN","BPSRCRI",9,0)
 ;User input prompts
"RTN","BPSRCRI",10,0)
EN ; Routine entry point
"RTN","BPSRCRI",11,0)
 N BPCFILE,BP02,BP03,BPSCR,BPQ,BPX,BPVAX,ZTQUEUED
"RTN","BPSRCRI",12,0)
 S BPCFILE=9002313.02
"RTN","BPSRCRI",13,0)
 I $D(IOF) W @IOF
"RTN","BPSRCRI",14,0)
 W !,"ECME Claims-Response Inquiry Report",!
"RTN","BPSRCRI",15,0)
 ;
"RTN","BPSRCRI",16,0)
 ;User selects VA CLAIM ID
"RTN","BPSRCRI",17,0)
 S BP02=$$BPIEN(BPCFILE)
"RTN","BPSRCRI",18,0)
 I BP02=-1 G EXIT
"RTN","BPSRCRI",19,0)
 S BPVAX=$P(BP02,U,2),BP02=+BP02
"RTN","BPSRCRI",20,0)
 ;
"RTN","BPSRCRI",21,0)
 ;Select device
"RTN","BPSRCRI",22,0)
 I $$DEVICE=-1 G EXIT
"RTN","BPSRCRI",23,0)
 ;
"RTN","BPSRCRI",24,0)
 ;Run the reports
"RTN","BPSRCRI",25,0)
 D RUNRPT
"RTN","BPSRCRI",26,0)
 ;
"RTN","BPSRCRI",27,0)
 ;Prompt user to retrieve Claim IEN
"RTN","BPSRCRI",28,0)
 ;Input
"RTN","BPSRCRI",29,0)
 ;  BPCFILE (9002313.02) user inputs VA ID#
"RTN","BPSRCRI",30,0)
 ;Output
"RTN","BPSRCRI",31,0)
 ;  -1 (not found) or File IEN
"RTN","BPSRCRI",32,0)
BPIEN(BPCFILE) ; User is prompted for input, cross-ref "B" lookup
"RTN","BPSRCRI",33,0)
 N DIC,Y,DUOUT,DTOUT,DIROUT
"RTN","BPSRCRI",34,0)
 S DIC=$$ROOT^DILFD(BPCFILE)
"RTN","BPSRCRI",35,0)
 S DIC("A")="Select VA Claim ID: "
"RTN","BPSRCRI",36,0)
 S DIC(0)="ABEQ"
"RTN","BPSRCRI",37,0)
 D ^DIC
"RTN","BPSRCRI",38,0)
 I (Y=-1)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) Q -1
"RTN","BPSRCRI",39,0)
 Q Y
"RTN","BPSRCRI",40,0)
 ;
"RTN","BPSRCRI",41,0)
 ;Select the output Device
"RTN","BPSRCRI",42,0)
DEVICE() ; 
"RTN","BPSRCRI",43,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTSAVE,ZTDESC,POP,BPQ
"RTN","BPSRCRI",44,0)
 S BPQ=0
"RTN","BPSRCRI",45,0)
 S %ZIS="QM"
"RTN","BPSRCRI",46,0)
 W !!,"Note: This report contains three separate sections - transaction data, claims"
"RTN","BPSRCRI",47,0)
 W !,"      data, and response data.  There will be a page break/form feed after"
"RTN","BPSRCRI",48,0)
 W !,"      each section regardless of the page length specified in the device input.",!
"RTN","BPSRCRI",49,0)
 D ^%ZIS
"RTN","BPSRCRI",50,0)
 I POP Q -1
"RTN","BPSRCRI",51,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRCRI",52,0)
 I $D(IO("Q")) D  S BPQ=-1
"RTN","BPSRCRI",53,0)
 . S ZTRTN="RUNRPT^BPSRCRI"
"RTN","BPSRCRI",54,0)
 . S ZTIO=ION
"RTN","BPSRCRI",55,0)
 . S ZTSAVE("*")=""
"RTN","BPSRCRI",56,0)
 . S ZTDESC="ECME CLAIMS RESPONSE INQUIRY REPORT"
"RTN","BPSRCRI",57,0)
 . D ^%ZTLOAD
"RTN","BPSRCRI",58,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRCRI",59,0)
 . D HOME^%ZIS
"RTN","BPSRCRI",60,0)
 U IO
"RTN","BPSRCRI",61,0)
 Q BPQ
"RTN","BPSRCRI",62,0)
 ;
"RTN","BPSRCRI",63,0)
 ; Print or display the report
"RTN","BPSRCRI",64,0)
RUNRPT ; 
"RTN","BPSRCRI",65,0)
 N BPLARR,BP57,BP59,BPQ
"RTN","BPSRCRI",66,0)
 D BPFLDS ; BPS TRANSACTIONS/LOG OF TRANSACTIONS
"RTN","BPSRCRI",67,0)
 D PRNTRPT
"RTN","BPSRCRI",68,0)
 Q
"RTN","BPSRCRI",69,0)
 ;
"RTN","BPSRCRI",70,0)
 ;Collect data from Transactions file #59 or Transactions Log file #57
"RTN","BPSRCRI",71,0)
BPFLDS ; Build BPLARR array of data
"RTN","BPSRCRI",72,0)
 N BPL0,BPL1,BP902
"RTN","BPSRCRI",73,0)
 S BP03=0,BPX=""
"RTN","BPSRCRI",74,0)
 ;Determine if claim is reversal or not
"RTN","BPSRCRI",75,0)
 I $D(^BPST("AE",BP02))!($D(^BPSTL("AE",BP02))) D
"RTN","BPSRCRI",76,0)
 . S BPX="AE" ;Not a reversal
"RTN","BPSRCRI",77,0)
 . S BPLARR(9)="  CLAIM IEN (c): "
"RTN","BPSRCRI",78,0)
 . S BPLARR(10)="RESPONSE IEN (c): "
"RTN","BPSRCRI",79,0)
 I BPX="",($D(^BPST("AER",BP02))!($D(^BPSTL("AER",BP02)))) D
"RTN","BPSRCRI",80,0)
 . S BPX="AER" ;Reversal
"RTN","BPSRCRI",81,0)
 . S BPLARR(10)="REVERSAL RESPONSE IEN (c): "
"RTN","BPSRCRI",82,0)
 . S BPLARR(9)="  REVERSAL CLAIM IEN (c): "
"RTN","BPSRCRI",83,0)
 I BPX="" Q
"RTN","BPSRCRI",84,0)
 S (BP57,BP59)=0
"RTN","BPSRCRI",85,0)
 S BP59=$O(^BPST(BPX,BP02,""),-1)
"RTN","BPSRCRI",86,0)
 I BP59="" S BP59=0
"RTN","BPSRCRI",87,0)
 ;
"RTN","BPSRCRI",88,0)
 I BP59'=0 D  ;Find claim in BPS Transactions file
"RTN","BPSRCRI",89,0)
 . S BPL0=$G(^BPST(BP59,0)),BPL1=$G(^BPST(BP59,1))
"RTN","BPSRCRI",90,0)
 . I BPX="AE" S BP03=$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSRCRI",91,0)
 . I BPX="AER" S BP03=$P($G(^BPST(BP59,4)),U,2)
"RTN","BPSRCRI",92,0)
 . S BPLARR(4)="PRESCRIPTION #: "_+$$GET1^DIQ(9002313.59,BP59,1.11)
"RTN","BPSRCRI",93,0)
 . D GETS^DIQ(9002313.59902,1_","_BP59,"902;902.24;902.27","E","BP902","ERROR")
"RTN","BPSRCRI",94,0)
 . S BPLARR(7)="  PLAN NAME: "_$G(BP902(9002313.59902,"1,"_BP59_",",902.24,"E"))
"RTN","BPSRCRI",95,0)
 . S BPLARR(8)="PHARMACY PLAN ID: "_$G(BP902(9002313.59902,"1,"_BP59_",",902.27,"E"))
"RTN","BPSRCRI",96,0)
 ;
"RTN","BPSRCRI",97,0)
 I BP59=0 D  ;;Find claim in BPS Log of Transactions file
"RTN","BPSRCRI",98,0)
 . S BP57=$O(^BPSTL(BPX,BP02,""),-1)
"RTN","BPSRCRI",99,0)
 . I BP57="" S BP57=0 Q
"RTN","BPSRCRI",100,0)
 . S BPL0=$G(^BPSTL(BP57,0)),BPL1=$G(^BPSTL(BP57,1)),BP59=$P($G(BPL0),U)
"RTN","BPSRCRI",101,0)
 . I BPX="AE" S BP03=$P($G(^BPSTL(BP57,0)),U,5)
"RTN","BPSRCRI",102,0)
 . I BPX="AER" S BP03=$P($G(^BPSTL(BP57,4)),U,2)
"RTN","BPSRCRI",103,0)
 . S BPLARR(4)="PRESCRIPTION #: "_+$$GET1^DIQ(9002313.57,BP57,1.11)
"RTN","BPSRCRI",104,0)
 . D GETS^DIQ(9002313.57902,1_","_BP57,"902;902.24;902.27","E","BP902","ERROR")
"RTN","BPSRCRI",105,0)
 . S BPLARR(7)="  PLAN NAME: "_$G(BP902(9002313.59902,"1,"_BP57_",",902.24,"E"))
"RTN","BPSRCRI",106,0)
 . S BPLARR(8)="PHARMACY PLAN ID: "_$G(BP902(9002313.59902,"1,"_BP57_",",902.27,"E"))
"RTN","BPSRCRI",107,0)
 ;
"RTN","BPSRCRI",108,0)
 I BP59=0,BP57=0 Q
"RTN","BPSRCRI",109,0)
 ;Build rest of array components
"RTN","BPSRCRI",110,0)
 S BPLARR(1)="ENTRY#: "_BP59
"RTN","BPSRCRI",111,0)
 S BPLARR(2)="STATUS: "_+$P($G(BPL0),U,2)
"RTN","BPSRCRI",112,0)
 S BPX=$P($G(BPL1),U,7)
"RTN","BPSRCRI",113,0)
 S BPLARR(3)="  PHARMACY: "_$P($G(^BPS(9002313.56,+BPX,0)),"^")
"RTN","BPSRCRI",114,0)
 S BPLARR(5)="  RXI-INTERNAL (c): "_$P($G(BPL1),U,11)
"RTN","BPSRCRI",115,0)
 S BPLARR(9)=BPLARR(9)_BP02
"RTN","BPSRCRI",116,0)
 S BPLARR(10)=BPLARR(10)_BP03
"RTN","BPSRCRI",117,0)
 Q
"RTN","BPSRCRI",118,0)
 ;
"RTN","BPSRCRI",119,0)
PRNTRPT ; Output the reports
"RTN","BPSRCRI",120,0)
 N BPQ,ZTREQ
"RTN","BPSRCRI",121,0)
 S BPQ=0
"RTN","BPSRCRI",122,0)
 W @IOF
"RTN","BPSRCRI",123,0)
 D CHKP(1) I BPQ Q
"RTN","BPSRCRI",124,0)
 W "ECME Claims-Response Inquiry Report"
"RTN","BPSRCRI",125,0)
 W ?48,"Print Date: "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","BPSRCRI",126,0)
 W !,"VA CLAIM ID: "_BPVAX,!
"RTN","BPSRCRI",127,0)
 D PRTTRANS ; BPS Transaction (or Transaction log) file fields
"RTN","BPSRCRI",128,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRCRI",129,0)
 E  I 'BPQ D PAUSE
"RTN","BPSRCRI",130,0)
 Q:BPQ
"RTN","BPSRCRI",131,0)
 D PRT02 ; BPS CLAIMS FILE
"RTN","BPSRCRI",132,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRCRI",133,0)
 E  I 'BPQ D PAUSE
"RTN","BPSRCRI",134,0)
 Q:BPQ
"RTN","BPSRCRI",135,0)
 D PRT03 ; BPS RESPONSE FILE
"RTN","BPSRCRI",136,0)
 Q:BPQ
"RTN","BPSRCRI",137,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRCRI",138,0)
 E  I 'BPQ D PAUSE2
"RTN","BPSRCRI",139,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRCRI",140,0)
 D ^%ZISC
"RTN","BPSRCRI",141,0)
 Q
"RTN","BPSRCRI",142,0)
 ;
"RTN","BPSRCRI",143,0)
 ; Display transaction log fields
"RTN","BPSRCRI",144,0)
PRTTRANS ; Print transaction file report
"RTN","BPSRCRI",145,0)
 W !,"BPS TRANSACTION/BPS LOG OF TRANSACTION DATA: ",!
"RTN","BPSRCRI",146,0)
 I BPX="" W !,"NO TRANSACTION MATCHES FOUND",!! Q
"RTN","BPSRCRI",147,0)
 ;
"RTN","BPSRCRI",148,0)
 ;Loop through the array
"RTN","BPSRCRI",149,0)
 N BPX
"RTN","BPSRCRI",150,0)
 S BPX=0 F  S BPX=$O(BPLARR(BPX)) Q:'BPX  D  I BPQ Q
"RTN","BPSRCRI",151,0)
 . D CHKP(1) I BPQ Q
"RTN","BPSRCRI",152,0)
 . I BPX=1 W !,BPLARR(BPX) Q
"RTN","BPSRCRI",153,0)
 . I BPX#2=0 W ?40,BPLARR(BPX) Q
"RTN","BPSRCRI",154,0)
 . W !,BPLARR(BPX)
"RTN","BPSRCRI",155,0)
 Q
"RTN","BPSRCRI",156,0)
 ;
"RTN","BPSRCRI",157,0)
 ;Run claim file data report #9002313.02
"RTN","BPSRCRI",158,0)
PRT02  ; Claims file output
"RTN","BPSRCRI",159,0)
 W !,"BPS CLAIMS FILE DATA: "
"RTN","BPSRCRI",160,0)
 N DIC,DR,DA,DIQ,DTOUT,DIRUT
"RTN","BPSRCRI",161,0)
 S DIC=$$ROOT^DILFD(BPCFILE),DA=BP02
"RTN","BPSRCRI",162,0)
 I $D(IOF) W @IOF
"RTN","BPSRCRI",163,0)
 D EN^DIQ
"RTN","BPSRCRI",164,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S BPQ=1
"RTN","BPSRCRI",165,0)
 Q
"RTN","BPSRCRI",166,0)
 ;
"RTN","BPSRCRI",167,0)
 ;Run response file data report #9002313.03
"RTN","BPSRCRI",168,0)
PRT03 ; Response file output
"RTN","BPSRCRI",169,0)
 W !!,"BPS RESPONSE FILE DATA: ",!
"RTN","BPSRCRI",170,0)
 I BP03=0!(BP03="") W !,"NO RESPONSE FILE DATA FOUND",!! Q
"RTN","BPSRCRI",171,0)
 N DIC,DR,DA,DIQ,DTOUT,DIRUT
"RTN","BPSRCRI",172,0)
 S DIC=$$ROOT^DILFD(9002313.03),DA=BP03
"RTN","BPSRCRI",173,0)
 D EN^DIQ
"RTN","BPSRCRI",174,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S BPQ=1
"RTN","BPSRCRI",175,0)
 Q
"RTN","BPSRCRI",176,0)
 ;
"RTN","BPSRCRI",177,0)
 ;Check for End of Page
"RTN","BPSRCRI",178,0)
 ; Input variable -> BPLINES - Number of lines from bottom
"RTN","BPSRCRI",179,0)
 ;                      CONT - 0 = New Entry, 1 = Continue Entry
"RTN","BPSRCRI",180,0)
CHKP(BPLINES) ;
"RTN","BPSRCRI",181,0)
 S BPLINES=BPLINES+1
"RTN","BPSRCRI",182,0)
 I $G(BPSCR) S BPLINES=BPLINES+1
"RTN","BPSRCRI",183,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE Q:$G(BPQ) 0 Q 1
"RTN","BPSRCRI",184,0)
 Q 0
"RTN","BPSRCRI",185,0)
 ;
"RTN","BPSRCRI",186,0)
PAUSE ;
"RTN","BPSRCRI",187,0)
 N X
"RTN","BPSRCRI",188,0)
 U IO(0)
"RTN","BPSRCRI",189,0)
 R !!,"Press RETURN to continue, '^' to exit: ",X:DTIME
"RTN","BPSRCRI",190,0)
 I '$T S X="^"
"RTN","BPSRCRI",191,0)
 I X["^" S BPQ=1
"RTN","BPSRCRI",192,0)
 U IO
"RTN","BPSRCRI",193,0)
 Q
"RTN","BPSRCRI",194,0)
 ;
"RTN","BPSRCRI",195,0)
PAUSE2 ;
"RTN","BPSRCRI",196,0)
 N X
"RTN","BPSRCRI",197,0)
 U IO(0)
"RTN","BPSRCRI",198,0)
 R !,"Press RETURN to continue: ",X:DTIME
"RTN","BPSRCRI",199,0)
 U IO
"RTN","BPSRCRI",200,0)
 Q
"RTN","BPSRCRI",201,0)
 ;
"RTN","BPSRCRI",202,0)
 ;EXIT
"RTN","BPSRCRI",203,0)
EXIT ;
"RTN","BPSRCRI",204,0)
 Q
"RTN","BPSRCRI",205,0)
 ;
"RTN","BPSRDT1")
0^19^B23088150
"RTN","BPSRDT1",1,0)
BPSRDT1 ;BHAM ISC/FCS/DRS/FLS/DLF - Turn Around Time Statistics Report ;06/01/2004
"RTN","BPSRDT1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSRDT1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRDT1",4,0)
 ;
"RTN","BPSRDT1",5,0)
 N TRANDT,FR,TO,BPSSIZ,BPSTTAT,IEN57,IEN59,IEN,UPDT,SEQ,ENDLOOP,BPSTATIM
"RTN","BPSRDT1",6,0)
 N BPSBGN,BPSBTIM,BPSCTIM,BPSEND,BPSETIM,BPSGTIM,BPSRTIM,BPSSTIM
"RTN","BPSRDT1",7,0)
 N BPSBDT,BPSCNT,X,Y,BPSQUIT,MES,TYPE,DATA
"RTN","BPSRDT1",8,0)
 K ^TMP("BPSRDT1",$J)
"RTN","BPSRDT1",9,0)
 ;
"RTN","BPSRDT1",10,0)
 ; Get start/end dates.  Quit if no dates entered
"RTN","BPSRDT1",11,0)
 D DATE I Y<0 K DTOUT Q
"RTN","BPSRDT1",12,0)
 ;
"RTN","BPSRDT1",13,0)
 ; Initialize variables
"RTN","BPSRDT1",14,0)
 S TRANDT=FR,BPSSIZ=0,BPSTTAT=0,BPSCNT=0
"RTN","BPSRDT1",15,0)
 ;
"RTN","BPSRDT1",16,0)
 ; Quit if no dates in X-ref that match
"RTN","BPSRDT1",17,0)
 I '$O(^BPSTL("AH",TRANDT)) G QUIT
"RTN","BPSRDT1",18,0)
 ;
"RTN","BPSRDT1",19,0)
 ; Loop through the dates and build temporary list
"RTN","BPSRDT1",20,0)
 F  S TRANDT=$O(^BPSTL("AH",TRANDT)) Q:TRANDT=""!($P(TRANDT,".")>TO)  D
"RTN","BPSRDT1",21,0)
 . S IEN57=""
"RTN","BPSRDT1",22,0)
 . F  S IEN57=$O(^BPSTL("AH",TRANDT,IEN57)) Q:IEN57=""  D
"RTN","BPSRDT1",23,0)
 .. S IEN59=$P($G(^BPSTL(IEN57,0)),U,1)
"RTN","BPSRDT1",24,0)
 .. I 'IEN59 Q
"RTN","BPSRDT1",25,0)
 .. S IEN=$$EXISTS^BPSOSL1(IEN59)
"RTN","BPSRDT1",26,0)
 .. I IEN S ^TMP("BPSRDT1",$J,1,IEN59)=IEN
"RTN","BPSRDT1",27,0)
 ;
"RTN","BPSRDT1",28,0)
 ; Loop through the temporary list and build second list with turn-around stats
"RTN","BPSRDT1",29,0)
 S IEN59=""
"RTN","BPSRDT1",30,0)
 F  S IEN59=$O(^TMP("BPSRDT1",$J,1,IEN59)) Q:IEN59=""  D
"RTN","BPSRDT1",31,0)
 . S IEN=$G(^TMP("BPSRDT1",$J,1,IEN59))
"RTN","BPSRDT1",32,0)
 . S ENDLOOP=0
"RTN","BPSRDT1",33,0)
 . S (BPSBDT,BPSBGN,BPSEND,BPSBTIM,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM,TYPE)=""
"RTN","BPSRDT1",34,0)
 . S UPDT=FR F  S UPDT=$O(^BPS(9002313.12,IEN,10,"B",UPDT)) Q:UPDT=""  D  Q:ENDLOOP
"RTN","BPSRDT1",35,0)
 .. S SEQ="" F  S SEQ=$O(^BPS(9002313.12,IEN,10,"B",UPDT,SEQ)) Q:SEQ=""  D  Q:ENDLOOP
"RTN","BPSRDT1",36,0)
 ... S MES=$$UP($P($G(^BPS(9002313.12,IEN,10,SEQ,1)),U,1))
"RTN","BPSRDT1",37,0)
 ... I MES="" Q
"RTN","BPSRDT1",38,0)
 ... I MES["BEFORE SUBMIT OF " D
"RTN","BPSRDT1",39,0)
 .... S TYPE=$P(MES,"BEFORE SUBMIT OF ",2)
"RTN","BPSRDT1",40,0)
 .... S BPSBDT=$P(UPDT,".",1)
"RTN","BPSRDT1",41,0)
 .... I BPSBDT>TO S BPSBDT="",ENDLOOP=1 Q
"RTN","BPSRDT1",42,0)
 .... S BPSBGN=$$TIME2(UPDT),BPSBTIM=$$TIME(UPDT)
"RTN","BPSRDT1",43,0)
 .... S (BPSEND,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM)=""
"RTN","BPSRDT1",44,0)
 ... I ENDLOOP=1 Q
"RTN","BPSRDT1",45,0)
 ... I BPSBDT,MES["BPSOSU NOW RESUBMIT"!(MES["BPSOSU-NOW RESUBMIT") D
"RTN","BPSRDT1",46,0)
 .... S TYPE="Request portion of a Reversal/Resubmit"
"RTN","BPSRDT1",47,0)
 .... S BPSBGN=$$TIME2(UPDT),BPSBTIM=$$TIME(UPDT)
"RTN","BPSRDT1",48,0)
 .... S (BPSEND,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM)=""
"RTN","BPSRDT1",49,0)
 ... I BPSBGN="" Q
"RTN","BPSRDT1",50,0)
 ... I MES["INITIATING REVERSAL AND AFTER THAT, CLAIM WILL BE RESUBMITTED" S TYPE="Reversal portion of a Reversal/Resubmit"
"RTN","BPSRDT1",51,0)
 ... I MES["GATHERING"!(MES["VALIDATING THE BPS TRANSACTION") S BPSGTIM=$$TIME(UPDT)
"RTN","BPSRDT1",52,0)
 ... I MES["CREATED CLAIM ID" S BPSCTIM=$$TIME(UPDT)
"RTN","BPSRDT1",53,0)
 ... I MES["BPSECMC2 - CLAIM - SENT"!(MES["BPSECMC2-CLAIM SENT") S BPSSTIM=$$TIME(UPDT)
"RTN","BPSRDT1",54,0)
 ... I MES["BPSECMC2 - CLAIM - RESPONSE STORED"!(MES["BPSECMC2-RESPONSE STORED") S BPSRTIM=$$TIME(UPDT)
"RTN","BPSRDT1",55,0)
 ... I MES["CLAIM - END"!(MES["BPSOSU-CLAIM COMPLETE") I BPSBGN D
"RTN","BPSRDT1",56,0)
 .... S BPSEND=$$TIME2(UPDT),BPSETIM=$$TIME(UPDT)
"RTN","BPSRDT1",57,0)
 .... D LOG
"RTN","BPSRDT1",58,0)
 ;
"RTN","BPSRDT1",59,0)
 ; If no data to report, quit
"RTN","BPSRDT1",60,0)
 I 'BPSTTAT G QUIT
"RTN","BPSRDT1",61,0)
 ;
"RTN","BPSRDT1",62,0)
 ; Loop through list of stats and output
"RTN","BPSRDT1",63,0)
 S BPSCNT="",BPSQUIT=0
"RTN","BPSRDT1",64,0)
 F  S BPSCNT=$O(^TMP("BPSRDT1",$J,2,BPSCNT)) Q:BPSCNT=""  D  I BPSQUIT=1 Q
"RTN","BPSRDT1",65,0)
 . S DATA=$G(^TMP("BPSRDT1",$J,2,BPSCNT)),IEN59=$P(DATA,U,1),TYPE=$P(DATA,U,2)
"RTN","BPSRDT1",66,0)
 . S TYPE=$S(TYPE="CLAIM":"Request",TYPE="REVERSAL":"Reversal",1:TYPE)
"RTN","BPSRDT1",67,0)
 . W !,"For Prescription",?25,IEN59_"  (Rx# "_$$RXAPI1^BPSUTIL1($P(IEN59,"."),.01,"I")_")"
"RTN","BPSRDT1",68,0)
 . W !,"Type",?25,TYPE
"RTN","BPSRDT1",69,0)
 . W !,"Date",?25,$$FMTE^XLFDT($P(DATA,U,3),"5Z")
"RTN","BPSRDT1",70,0)
 . W !,"Begin ",?25,$P(DATA,U,4)
"RTN","BPSRDT1",71,0)
 . W !,"Gathering information",?25,$P(DATA,U,5)
"RTN","BPSRDT1",72,0)
 . W !,"Claim ID created",?25,$P(DATA,U,6)
"RTN","BPSRDT1",73,0)
 . W !,"Claim Sent",?25,$P(DATA,U,7)
"RTN","BPSRDT1",74,0)
 . W !,"Response stored ",?25,$P(DATA,U,8)
"RTN","BPSRDT1",75,0)
 . W !,"Completed at",?25,$P(DATA,U,9)
"RTN","BPSRDT1",76,0)
 . W !,"Turn-around time",?25,$P(DATA,U,10),!
"RTN","BPSRDT1",77,0)
 . I BPSCNT#2=0 D
"RTN","BPSRDT1",78,0)
 .. R !!,"Press RETURN to continue, '^' to exit: ",X:DTIME
"RTN","BPSRDT1",79,0)
 .. I '$T!(X["^") S BPSQUIT=1
"RTN","BPSRDT1",80,0)
 ;
"RTN","BPSRDT1",81,0)
 ; Write Totals
"RTN","BPSRDT1",82,0)
 W !!!,"Total number of claims",?25,BPSSIZ
"RTN","BPSRDT1",83,0)
 W !,"Average Turn-around time",?25,BPSTTAT\BPSSIZ,!!
"RTN","BPSRDT1",84,0)
 D PRESSANY^BPSOSU5()
"RTN","BPSRDT1",85,0)
 ;
"RTN","BPSRDT1",86,0)
 ; Kill scratch global
"RTN","BPSRDT1",87,0)
 K ^TMP("BPSRDT1",$J)
"RTN","BPSRDT1",88,0)
 Q
"RTN","BPSRDT1",89,0)
 ;
"RTN","BPSRDT1",90,0)
 ;
"RTN","BPSRDT1",91,0)
TIME(%) ;
"RTN","BPSRDT1",92,0)
 S %=$E($P(%,".",2)_"000000",1,6)
"RTN","BPSRDT1",93,0)
 Q $E(%,1,2)_":"_$E(%,3,4)_":"_$E(%,5,6)
"RTN","BPSRDT1",94,0)
 ;
"RTN","BPSRDT1",95,0)
TIME2(%) ;
"RTN","BPSRDT1",96,0)
 Q $P($$FMTH^XLFDT(%),",",2)
"RTN","BPSRDT1",97,0)
 ;
"RTN","BPSRDT1",98,0)
 ;
"RTN","BPSRDT1",99,0)
LOG ;
"RTN","BPSRDT1",100,0)
 I BPSBGN="" Q
"RTN","BPSRDT1",101,0)
 I BPSEND="" Q
"RTN","BPSRDT1",102,0)
 S BPSTATIM=$G(BPSEND)-$G(BPSBGN)
"RTN","BPSRDT1",103,0)
 ;
"RTN","BPSRDT1",104,0)
 ; Remove negative times (span midnight) and claims more than 20 minutes as anomolies
"RTN","BPSRDT1",105,0)
 I BPSTATIM'>0 Q
"RTN","BPSRDT1",106,0)
 ;I BPSTATIM>1200 Q
"RTN","BPSRDT1",107,0)
 S BPSCNT=BPSCNT+1
"RTN","BPSRDT1",108,0)
 S ^TMP("BPSRDT1",$J,2,BPSCNT)=IEN59_U_TYPE_U_BPSBDT_U_BPSBTIM_U_BPSGTIM_U_BPSCTIM_U_BPSSTIM_U_BPSRTIM_U_BPSETIM_U_BPSTATIM
"RTN","BPSRDT1",109,0)
 S BPSTTAT=BPSTTAT+BPSTATIM
"RTN","BPSRDT1",110,0)
 S BPSSIZ=BPSSIZ+1
"RTN","BPSRDT1",111,0)
 I TYPE="Reversal/Resubmit" S BPSSIZ=BPSSIZ+1
"RTN","BPSRDT1",112,0)
 S (BPSBGN,TYPE)=""
"RTN","BPSRDT1",113,0)
 Q
"RTN","BPSRDT1",114,0)
 ;
"RTN","BPSRDT1",115,0)
DATE ; Ask user the date range
"RTN","BPSRDT1",116,0)
 N %DT,VAL,TYPEVAL,X
"RTN","BPSRDT1",117,0)
 S %DT="AEP",%DT(0)=-DT,%DT("A")="START WITH DATE: "
"RTN","BPSRDT1",118,0)
 S %DT("B")="T-1"
"RTN","BPSRDT1",119,0)
 D ^%DT Q:Y<0!($D(DTOUT))
"RTN","BPSRDT1",120,0)
 S (%DT(0),FR)=Y
"RTN","BPSRDT1",121,0)
 S %DT("A")="GO TO DATE: "
"RTN","BPSRDT1",122,0)
 S %DT("B")="T"
"RTN","BPSRDT1",123,0)
 D ^%DT Q:Y<0!($D(DTOUT))
"RTN","BPSRDT1",124,0)
 S TO=Y
"RTN","BPSRDT1",125,0)
 Q
"RTN","BPSRDT1",126,0)
 ;
"RTN","BPSRDT1",127,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSRDT1",128,0)
QUIT ;
"RTN","BPSRDT1",129,0)
 W !!,"*** No valid data found ***",!!
"RTN","BPSRDT1",130,0)
 D PRESSANY^BPSOSU5()
"RTN","BPSRDT1",131,0)
 Q
"RTN","BPSRES")
0^193^B65826768
"RTN","BPSRES",1,0)
BPSRES ;BHAM ISC/BEE - ECME SCREEN RESUBMIT W/EDITS ;19-MAY-06
"RTN","BPSRES",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**3,5**;JUN 2004;Build 45
"RTN","BPSRES",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRES",4,0)
 ;
"RTN","BPSRES",5,0)
 Q
"RTN","BPSRES",6,0)
 ;
"RTN","BPSRES",7,0)
 ;ECME Resubmit w/EDITS Protocol (Hidden) - Called by [BPS USER SCREEN]
"RTN","BPSRES",8,0)
 ;
"RTN","BPSRES",9,0)
RESED N BPSEL
"RTN","BPSRES",10,0)
 ;
"RTN","BPSRES",11,0)
 I '$D(@(VALMAR)) G XRESED
"RTN","BPSRES",12,0)
 D FULL^VALM1
"RTN","BPSRES",13,0)
 ;
"RTN","BPSRES",14,0)
 ;Select the claim to resubmit
"RTN","BPSRES",15,0)
 W !,"Enter the line number for the claim to be resubmitted."
"RTN","BPSRES",16,0)
 S BPSEL=$$ASKLINE("Select item","Please select a SINGLE claim only when using the Resubmit w/EDITS action option.")
"RTN","BPSRES",17,0)
 I BPSEL<1 S VALMBCK="R" G XRESED
"RTN","BPSRES",18,0)
 ;
"RTN","BPSRES",19,0)
 ;Attempt to resubmit the claim, update the content of the screen, and display
"RTN","BPSRES",20,0)
 ;only if claim submitted successfully
"RTN","BPSRES",21,0)
 I $$DOSELCTD(BPSEL) D REDRAW^BPSSCRUD("Updating screen for resubmitted claim...")
"RTN","BPSRES",22,0)
 E  S VALMBCK="R"
"RTN","BPSRES",23,0)
 ;
"RTN","BPSRES",24,0)
XRESED Q
"RTN","BPSRES",25,0)
 ;
"RTN","BPSRES",26,0)
 ;Attempt to Edit and Resubmit Selected Claim
"RTN","BPSRES",27,0)
 ;
"RTN","BPSRES",28,0)
 ;   Input Value -> BPRXI - Entry with ptr to BPS TRANSACTION file
"RTN","BPSRES",29,0)
 ;
"RTN","BPSRES",30,0)
 ;  Return Value -> 0 - Claim was not resubmitted
"RTN","BPSRES",31,0)
 ;                  1 - Claim was resubmitted
"RTN","BPSRES",32,0)
 ;
"RTN","BPSRES",33,0)
DOSELCTD(BPRXI) N BP02,BP59,BPBILL,BPCLTOT,BPDFN,BPDOSDT,BPOVRIEN,BPQ,BPRXIEN,BPRXR,BPSTATUS,BPUPDFLG
"RTN","BPSRES",34,0)
 S (BPQ)=""
"RTN","BPSRES",35,0)
 S (BPCLTOT,BPUPDFLG)=0
"RTN","BPSRES",36,0)
 ;
"RTN","BPSRES",37,0)
 ;Pull BPS TRANSACTION/BPS CLAIMS entries
"RTN","BPSRES",38,0)
 S BP59=$P(BPRXI,U,4) I BP59="" W !!,"No Initial Claim Submission Found - Data Elements are NOT Editable for Re-Submission",! G XRES
"RTN","BPSRES",39,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4) I 'BP02 W !!,"No Initial Claim Submission Found - Data Elements are NOT Editable for Re-Submission",! G XRES
"RTN","BPSRES",40,0)
 ;
"RTN","BPSRES",41,0)
 ;Write Form Feed
"RTN","BPSRES",42,0)
 W @IOF
"RTN","BPSRES",43,0)
 ;
"RTN","BPSRES",44,0)
 ;Display selected claim and ask to submit
"RTN","BPSRES",45,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRES",46,0)
 W !,"You've chosen to RESUBMIT the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSRES",47,0)
 W !,@VALMAR@(+$P(BPRXI,U,5),0)
"RTN","BPSRES",48,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSRES",49,0)
 I BPQ'=1 S BPQ="^" G XRES
"RTN","BPSRES",50,0)
 ;
"RTN","BPSRES",51,0)
 ;Check to make sure claim can be Resubmitted w/EDITS
"RTN","BPSRES",52,0)
 S BPRXIEN=$P(BP59,".")
"RTN","BPSRES",53,0)
 S BPRXR=+$E($P(BP59,".",2),1,4)
"RTN","BPSRES",54,0)
 I $$RXDEL^BPSOS($P(BP59,".",1),+$E($P(BP59,".",2),1,4)) W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"cannot be Resubmitted w/EDITS because it has been deleted in Pharmacy.",! G XRES
"RTN","BPSRES",55,0)
 S BPSTATUS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSRES",56,0)
 I BPSTATUS["IN PROGRESS" W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"is still In Progress and cannot be Resubmitted w/EDITS",! G XRES
"RTN","BPSRES",57,0)
 I BPSTATUS'["E REJECTED" W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"is NOT Rejected and cannot be Resubmitted w/EDITS",! G XRES
"RTN","BPSRES",58,0)
 ;
"RTN","BPSRES",59,0)
 ;Prompt for EDIT Information
"RTN","BPSRES",60,0)
 S BPOVRIEN=$$PROMPTS(BP59,BP02) I BPOVRIEN=-1 G XRES
"RTN","BPSRES",61,0)
 ;
"RTN","BPSRES",62,0)
 ;Retrieve DOS
"RTN","BPSRES",63,0)
 S BPDOSDT=$$DOSDATE^BPSSCRRS(BPRXIEN,BPRXR)
"RTN","BPSRES",64,0)
 ;
"RTN","BPSRES",65,0)
 ;Resubmit Claim
"RTN","BPSRES",66,0)
 S BPBILL=$$EN^BPSNCPDP(BPRXIEN,BPRXR,BPDOSDT,"ERES","","ECME RESUBMIT","",BPOVRIEN)
"RTN","BPSRES",67,0)
 ;
"RTN","BPSRES",68,0)
 ;Print Return Value Message
"RTN","BPSRES",69,0)
 W !!
"RTN","BPSRES",70,0)
 W:+BPBILL>0 $S(+BPBILL=10:"Reversal but no Resubmit:",1:"Not Processed:"),!,"  "
"RTN","BPSRES",71,0)
 ;
"RTN","BPSRES",72,0)
 ;Change Return Message for SC/EI
"RTN","BPSRES",73,0)
 S:$P(BPBILL,U,2)="NEEDS SC DETERMINATION" $P(BPBILL,U,2)="NEEDS SC/EI DETERMINATION"
"RTN","BPSRES",74,0)
 W $P(BPBILL,U,2)
"RTN","BPSRES",75,0)
 ;
"RTN","BPSRES",76,0)
 ;0 Prescription/Fill successfully submitted to ECME
"RTN","BPSRES",77,0)
 ;1 ECME did not submit prescription/fill
"RTN","BPSRES",78,0)
 ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSRES",79,0)
 ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSRES",80,0)
 ;4 Unable to queue the ECME claim
"RTN","BPSRES",81,0)
 ;5 Invalid input
"RTN","BPSRES",82,0)
 ;10 Reversal Processed But Claim Was Not Resubmitted
"RTN","BPSRES",83,0)
 ;
"RTN","BPSRES",84,0)
 I +BPBILL=0 D 
"RTN","BPSRES",85,0)
 . D ECMEACT^PSOBPSU1(+BPRXIEN,+BPRXR,"Claim resubmitted to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSRES",86,0)
 . S BPUPDFLG=1,BPCLTOT=1
"RTN","BPSRES",87,0)
XRES I BPCLTOT W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been resubmitted.",!
"RTN","BPSRES",88,0)
 D PAUSE^VALM1
"RTN","BPSRES",89,0)
 Q BPUPDFLG
"RTN","BPSRES",90,0)
 ;
"RTN","BPSRES",91,0)
 ;Enter EDIT information for claim
"RTN","BPSRES",92,0)
 ;
"RTN","BPSRES",93,0)
 ;  Input Values -> BP59 - The BPS TRANSACTION entry
"RTN","BPSRES",94,0)
 ;                  BP02 - The BPS CLAIMS entry
"RTN","BPSRES",95,0)
 ;  Output Value -> BPQ  - -1 - The user chose to quit
"RTN","BPSRES",96,0)
 ;                         "" - The user completed the EDITS
"RTN","BPSRES",97,0)
PROMPTS(BP59,BP02) N %,BP300,BPCLCD,BPFDA,BPFLD,BPOVRIEN,BPMED,BPMSG,BPPSNCD,BPPREAUT,BPPRETYP,BPQ,BPRELCD,DIC,DIR,DIROUT,DTOUT,DUOUT,X,Y
"RTN","BPSRES",98,0)
 ;
"RTN","BPSRES",99,0)
 S BPQ=""
"RTN","BPSRES",100,0)
 ;
"RTN","BPSRES",101,0)
 ;Pull Information from Claim
"RTN","BPSRES",102,0)
 S BP300=$G(^BPSC(BP02,300))
"RTN","BPSRES",103,0)
 S BPRELCD=$TR($E($P(BP300,U,6),3,99)," ")
"RTN","BPSRES",104,0)
 S BPPSNCD=$TR($E($P(BP300,U,3),3,99)," ")
"RTN","BPSRES",105,0)
 S (BPPRETYP,BPPREAUT,BPCLCD)="",BPMED=0 F  S BPMED=$O(^BPSC(BP02,400,BPMED)) Q:'BPMED  D  I BPPREAUT]"",BPCLCD]"" Q
"RTN","BPSRES",106,0)
 .N BP460 S BP460=$G(^BPSC(BP02,400,BPMED,460))
"RTN","BPSRES",107,0)
 .S:BPPREAUT="" BPPREAUT=$TR($E($P(BP460,U,2),3,99)," "),BPPRETYP=$TR($E($P(BP460,U),3,99)," ")
"RTN","BPSRES",108,0)
 .S:BPCLCD="" BPCLCD=$TR($E($P($G(^BPSC(BP02,400,BPMED,400)),U,20),3,99)," ")
"RTN","BPSRES",109,0)
 ;
"RTN","BPSRES",110,0)
 W ! S DIR(0)="FO^1:1",DIR("A")="Relationship Code"
"RTN","BPSRES",111,0)
 S DIR("B")=BPRELCD
"RTN","BPSRES",112,0)
 K DIR("?")
"RTN","BPSRES",113,0)
 S DIR("?",1)="Select the relationship code that describes the relationship this patient has"
"RTN","BPSRES",114,0)
 S DIR("?",2)="to the holder of this insurance policy. The standard NCPDP Patient"
"RTN","BPSRES",115,0)
 S DIR("?",3)="Relationship Code list is shown below.  However, it is important to note"
"RTN","BPSRES",116,0)
 S DIR("?",4)="that some payers use their own set of codes for this field so the field"
"RTN","BPSRES",117,0)
 S DIR("?",5)="should be populated based upon the payer's expectations."
"RTN","BPSRES",118,0)
 S DIR("?",6)=" "
"RTN","BPSRES",119,0)
 S DIR("?",7)="Choose from:"
"RTN","BPSRES",120,0)
 S DIR("?",8)="  0   Not Specified"
"RTN","BPSRES",121,0)
 S DIR("?",9)="  1   Cardholder"
"RTN","BPSRES",122,0)
 S DIR("?",10)="  2   Spouse"
"RTN","BPSRES",123,0)
 S DIR("?",11)="  3   Child"
"RTN","BPSRES",124,0)
 S DIR("?")="  4   Other"
"RTN","BPSRES",125,0)
 D ^DIR
"RTN","BPSRES",126,0)
 I $G(DTOUT)!$G(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",127,0)
 S BPRELCD=Y
"RTN","BPSRES",128,0)
 ;
"RTN","BPSRES",129,0)
 ;Person Code
"RTN","BPSRES",130,0)
 K DIR("?") S DIR(0)="FO^1:3",DIR("A")="Person Code",DIR("?")="Enter the Specific Person Code Assigned to the Patient by the Payer"
"RTN","BPSRES",131,0)
 S DIR("B")=BPPSNCD
"RTN","BPSRES",132,0)
 D ^DIR
"RTN","BPSRES",133,0)
 I $G(DTOUT)!$G(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",134,0)
 S BPPSNCD=Y
"RTN","BPSRES",135,0)
 ;
"RTN","BPSRES",136,0)
 ;Pre-Authorization
"RTN","BPSRES",137,0)
 K DIR("?") S DIR(0)="FO^1:11",DIR("A")="Prior Authorization Number",DIR("?")="Enter the Number Submitted by the Provider to Identify the Prior Authorization"
"RTN","BPSRES",138,0)
 S DIR("B")=BPPREAUT
"RTN","BPSRES",139,0)
 D ^DIR
"RTN","BPSRES",140,0)
 I $G(DTOUT)!$G(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",141,0)
 S BPPREAUT=Y
"RTN","BPSRES",142,0)
 ;
"RTN","BPSRES",143,0)
 ;Prior-Authorization Type Code
"RTN","BPSRES",144,0)
 N X,DIC,Y
"RTN","BPSRES",145,0)
 S DIC("B")=+BPPRETYP
"RTN","BPSRES",146,0)
 S DIC(0)="QEAM",DIC=9002313.82461,DIC("A")="Prior Authorization Type Code: "
"RTN","BPSRES",147,0)
 D ^DIC
"RTN","BPSRES",148,0)
 ;
"RTN","BPSRES",149,0)
 ;Check for "^" or timeout
"RTN","BPSRES",150,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!(Y=-1) S BPQ=-1 K X,DIC,Y G XPROMPTS
"RTN","BPSRES",151,0)
 S BPPRETYP=$P(Y,U,2)
"RTN","BPSRES",152,0)
 K X,DIC,Y
"RTN","BPSRES",153,0)
 ;
"RTN","BPSRES",154,0)
 ;Submission Clarification Code
"RTN","BPSRES",155,0)
 N X,DIC,Y
"RTN","BPSRES",156,0)
 S DIC("B")=+BPCLCD
"RTN","BPSRES",157,0)
 S DIC(0)="QEAM",DIC=9002313.8242,DIC("A")="Submission Clarification Code: "
"RTN","BPSRES",158,0)
 D ^DIC
"RTN","BPSRES",159,0)
 ;
"RTN","BPSRES",160,0)
 ;Check for "^" or timeout
"RTN","BPSRES",161,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!(Y=-1) S BPQ=-1 K X,DIC,Y G XPROMPTS
"RTN","BPSRES",162,0)
 S BPCLCD=$P(Y,U,2)
"RTN","BPSRES",163,0)
 K X,DIC,Y
"RTN","BPSRES",164,0)
 ;
"RTN","BPSRES",165,0)
 ;Ask to proceed
"RTN","BPSRES",166,0)
 W ! S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSRES",167,0)
 I BPQ'=1 S BPQ=-1 G XPROMPTS
"RTN","BPSRES",168,0)
 ;
"RTN","BPSRES",169,0)
 ;Save into BPS NCPDP OVERRIDES (#9002313.511)
"RTN","BPSRES",170,0)
 S BPFDA(9002313.511,"+1,",.01)=BP59
"RTN","BPSRES",171,0)
 D NOW^%DTC
"RTN","BPSRES",172,0)
 S BPFDA(9002313.511,"+1,",.02)=%
"RTN","BPSRES",173,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",303,"")) I BPFLD]"" S BPFDA(9002313.5111,"+2,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+2,+1,",.02)=BPPSNCD
"RTN","BPSRES",174,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",306,"")) I BPFLD]"" S BPFDA(9002313.5111,"+3,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+3,+1,",.02)=BPRELCD
"RTN","BPSRES",175,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",462,"")) I BPFLD]"" S BPFDA(9002313.5111,"+4,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+4,+1,",.02)=BPPREAUT
"RTN","BPSRES",176,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",461,"")) I BPFLD]"" S BPFDA(9002313.5111,"+5,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+5,+1,",.02)=BPPRETYP
"RTN","BPSRES",177,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",420,"")) I BPFLD]"" S BPFDA(9002313.5111,"+6,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+6,+1,",.02)=BPCLCD
"RTN","BPSRES",178,0)
 D UPDATE^DIE("","BPFDA","BPOVRIEN","BPMSG")
"RTN","BPSRES",179,0)
 ;
"RTN","BPSRES",180,0)
 I $D(BPMSG("DIERR")) W !!,"Could Not Save Override information into BPS NCPDP OVERRIDES FILES",! S BPQ=-1 G XPROMPTS
"RTN","BPSRES",181,0)
 ;
"RTN","BPSRES",182,0)
XPROMPTS S BPOVRIEN=$S(BPQ=-1:BPQ,$G(BPOVRIEN(1))]"":BPOVRIEN(1),1:-1)
"RTN","BPSRES",183,0)
 Q BPOVRIEN
"RTN","BPSRES",184,0)
 ;
"RTN","BPSRES",185,0)
 ;Prompt User for Claim to Resubmit (w/EDITS)
"RTN","BPSRES",186,0)
 ;
"RTN","BPSRES",187,0)
 ; Input values ->  BPROMPT - prompt string
"RTN","BPSRES",188,0)
 ;                 BPERRMES - the message to display when the user tries
"RTN","BPSRES",189,0)
 ;                           to make multi line selection (optional)
"RTN","BPSRES",190,0)
 ;                  Piece
"RTN","BPSRES",191,0)
 ;output values ->      1 - 1 = okay, <0 = errors, 0 = quit
"RTN","BPSRES",192,0)
 ;                      2 - patient ien #2
"RTN","BPSRES",193,0)
 ;                      3 - insurance ien #36
"RTN","BPSRES",194,0)
 ;                      4 - ptr to #9002313.59
"RTN","BPSRES",195,0)
 ;                      5 - 1st line for index(es) in LM "VALM" array
"RTN","BPSRES",196,0)
 ;                      6 - patient's index
"RTN","BPSRES",197,0)
 ;                      7 - claim's index
"RTN","BPSRES",198,0)
ASKLINE(BPROMPT,BPERRMES) ;
"RTN","BPSRES",199,0)
 N BPRET,BPCNT
"RTN","BPSRES",200,0)
 S BPRET="",BPCNT=0
"RTN","BPSRES",201,0)
 F  S BPRET=$$SELLINE^BPSSCRU4(BPROMPT,"C",VALMAR,"") Q:BPRET'<0  D
"RTN","BPSRES",202,0)
 . ;
"RTN","BPSRES",203,0)
 . I BPCNT<1 S BPCNT=BPCNT+1 W !
"RTN","BPSRES",204,0)
 . E  S BPCNT=0 D RE^VALM4
"RTN","BPSRES",205,0)
 . I BPRET=-1 W "Invalid line number" ; (invalid Patient summary line)"
"RTN","BPSRES",206,0)
 . I BPRET=-8 W $S($G(BPERRMES)]"":BPERRMES,1:" Invalid line number")
"RTN","BPSRES",207,0)
 . I BPRET=-4 W "Invalid line number" ; (invalid RX line)"
"RTN","BPSRES",208,0)
 . I BPRET=-2 W "Please select Patient's summary line."
"RTN","BPSRES",209,0)
 . I BPRET=-3 W "Please specify RX line."
"RTN","BPSRES",210,0)
 . I ",-1,-8,-4,-2,-3,"'[(","_BPRET_",") W "Incorrect format." ; Corrupted array (",BPRET,")"
"RTN","BPSRES",211,0)
 Q BPRET
"RTN","BPSRPT0")
0^37^B20527507
"RTN","BPSRPT0",1,0)
BPSRPT0 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT0",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSRPT0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT0",4,0)
 ;
"RTN","BPSRPT0",5,0)
 Q
"RTN","BPSRPT0",6,0)
 ;
"RTN","BPSRPT0",7,0)
 ; Front End for ECME Reports
"RTN","BPSRPT0",8,0)
 ; 
"RTN","BPSRPT0",9,0)
 ; Input variable: BPRTYPE -> 1 = Payable Claims
"RTN","BPSRPT0",10,0)
 ;                          2 = Rejected Claims
"RTN","BPSRPT0",11,0)
 ;                          3 = Claims Submitted, Not Yet Released
"RTN","BPSRPT0",12,0)
 ;                          4 = Reversed Claims
"RTN","BPSRPT0",13,0)
 ;                          5 = Recent Transactions
"RTN","BPSRPT0",14,0)
 ;                          6 = Totals By Date
"RTN","BPSRPT0",15,0)
 ;                          7 = Closed Claims
"RTN","BPSRPT0",16,0)
 ;                          
"RTN","BPSRPT0",17,0)
 ; Passed variables - The following local variables are passed around the BPSRPT* routines
"RTN","BPSRPT0",18,0)
 ;                    and are not passed as parameters but are assumed to be defined:
"RTN","BPSRPT0",19,0)
 ;                    BPACREJ,BPAUTREV,BPBEGDT,BPBLINE,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,
"RTN","BPSRPT0",20,0)
 ;                    BPINSINF,BPGRPLN,BPMWC,BPNOW,BPPAGE,BPPHARM,BPQ,BPQSTDRG,
"RTN","BPSRPT0",21,0)
 ;                    BPRLNRL,BPRTBCK,BPSDATA,BPSUMDET,BPRTYPE
"RTN","BPSRPT0",22,0)
 ;                          
"RTN","BPSRPT0",23,0)
EN(BPRTYPE) N %,BPACREJ,BPAUTREV,BPBEGDT,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,BPNOW,BPPHARM,BPINSINF,BPMWC,BPQ,BPQSTDRG
"RTN","BPSRPT0",24,0)
 N BPREJCD,BPRLNRL,BPRPTNAM,BPRTBCK,BPSCR,BPSUMDET,CODE,POS,STAT,X,Y
"RTN","BPSRPT0",25,0)
 ;
"RTN","BPSRPT0",26,0)
 ;Verify that a valid report has been requested
"RTN","BPSRPT0",27,0)
 I ",1,2,3,4,5,6,7,"'[(","_$G(BPRTYPE)_",") W "<Invalid Menu Definition - Report Undefined>" H 3 Q
"RTN","BPSRPT0",28,0)
 S BPRPTNAM=$S(BPRTYPE=1:"PAYABLE CLAIMS",BPRTYPE=2:"REJECTED CLAIMS",BPRTYPE=3:"SUBMIT,NOT RELEASED CLAIMS",BPRTYPE=4:"REVERSED CLAIMS",BPRTYPE=5:"RECENT TRANSACTIONS",BPRTYPE=6:"TOTALS",BPRTYPE=7:"CLOSED CLAIMS",1:"")
"RTN","BPSRPT0",29,0)
 ;
"RTN","BPSRPT0",30,0)
 ;Get current Date/Time
"RTN","BPSRPT0",31,0)
 D NOW^%DTC S Y=% D DD^%DT S BPNOW=Y
"RTN","BPSRPT0",32,0)
 ;
"RTN","BPSRPT0",33,0)
 ;Prompt for ECME Pharmacy Division(s) (No Default)
"RTN","BPSRPT0",34,0)
 ;Sets up BPPHARM variable and array, BPPHARM =0 ALL or BPPHARM=1,BPPHARM(ptr) for list
"RTN","BPSRPT0",35,0)
 S X=$$SELPHARM^BPSRPT3() I X="^" G EXIT
"RTN","BPSRPT0",36,0)
 ;
"RTN","BPSRPT0",37,0)
 ;Prompt to Display Summary or Detail Format (Default to Detail)
"RTN","BPSRPT0",38,0)
 ;Returns 1 for Summary, 0 for Detail
"RTN","BPSRPT0",39,0)
 S BPSUMDET=$$SELSMDET^BPSRPT3(2) I BPSUMDET="^" G EXIT
"RTN","BPSRPT0",40,0)
 ;
"RTN","BPSRPT0",41,0)
 ;Prompt to Display Single Insurance or All (Default to ALL)
"RTN","BPSRPT0",42,0)
 ;Returns Insurance Company Name (from #36) or 0 for All
"RTN","BPSRPT0",43,0)
 S BPINSINF=$$SELINSIN^BPSRPT3(0) I BPINSINF="^" G EXIT
"RTN","BPSRPT0",44,0)
 ;
"RTN","BPSRPT0",45,0)
 ;Prompt to Display (C)MOP or (M)ail or (W)indow or (A)LL (Default to ALL)
"RTN","BPSRPT0",46,0)
 ;Returns (A-ALL,M-Mail,W-Window,C-CMOP)
"RTN","BPSRPT0",47,0)
 S BPMWC=$$SELMWC^BPSRPT3("A") I BPMWC="^" G EXIT
"RTN","BPSRPT0",48,0)
 ;
"RTN","BPSRPT0",49,0)
 ;Prompt to Display (R)ealTime Fills or (B)ackbills or (A)LL (Default to ALL)
"RTN","BPSRPT0",50,0)
 ;Returns (1-ALL,2-RealTime Fills,3-Backbills)
"RTN","BPSRPT0",51,0)
 S BPRTBCK=$$SELRTBCK^BPSRPT3(1) I BPRTBCK="^" G EXIT
"RTN","BPSRPT0",52,0)
 ;
"RTN","BPSRPT0",53,0)
 ;Prompt to Display Specific (D)rug or Drug (C)lass or (A)ll (Default to ALL)
"RTN","BPSRPT0",54,0)
 ;Returns (1-ALL,2-Drug,3-Drug Class)
"RTN","BPSRPT0",55,0)
 S BPQSTDRG=$$SELDRGAL^BPSRPT3(1) I BPQSTDRG="^" Q
"RTN","BPSRPT0",56,0)
 ;
"RTN","BPSRPT0",57,0)
 ;Prompt to Select Drug (No Default)
"RTN","BPSRPT0",58,0)
 S BPDRUG=0 I BPQSTDRG=2 S BPDRUG=$$SELDRG^BPSRPT3() I BPDRUG="^" G EXIT
"RTN","BPSRPT0",59,0)
 ;
"RTN","BPSRPT0",60,0)
 ;Prompt to Select Drug Class (No Default)
"RTN","BPSRPT0",61,0)
 S BPDRGCL=0 I BPQSTDRG=3 S BPDRGCL=$$SELDRGCL^BPSRPT3() I BPDRGCL="^" G EXIT
"RTN","BPSRPT0",62,0)
 ;
"RTN","BPSRPT0",63,0)
 ;Report Specific Prompts
"RTN","BPSRPT0",64,0)
 ;
"RTN","BPSRPT0",65,0)
 ;Prompt to select Date Range
"RTN","BPSRPT0",66,0)
 ;Returns (Start Date^End Date)
"RTN","BPSRPT0",67,0)
 I (",1,2,3,4,5,6,7,")[BPRTYPE S BPBEGDT=$$SELDATE^BPSRPT3(BPRTYPE) D  I BPBEGDT="^" G EXIT
"RTN","BPSRPT0",68,0)
 .I BPBEGDT="^" Q
"RTN","BPSRPT0",69,0)
 .S BPENDDT=$P(BPBEGDT,U,2)
"RTN","BPSRPT0",70,0)
 .S BPBEGDT=$P(BPBEGDT,U)
"RTN","BPSRPT0",71,0)
 ;
"RTN","BPSRPT0",72,0)
 ;Prompt to Include (R)ELEASED or (N)OT RELEASED or (A)LL (Default to RELEASED)
"RTN","BPSRPT0",73,0)
 ;Returns (1-ALL,2-RELEASED,3-NOT RELEASED)
"RTN","BPSRPT0",74,0)
 S BPRLNRL=$S(BPRTYPE=3:3,1:1) I (",1,2,4,6,7,")[BPRTYPE S BPRLNRL=$$SELRLNRL^BPSRPT4(2) I BPRLNRL="^" G EXIT
"RTN","BPSRPT0",75,0)
 ;
"RTN","BPSRPT0",76,0)
 ;Prompt to Include (S)pecific Reject Code or (A)LL (Default to ALL)
"RTN","BPSRPT0",77,0)
 ;Returns (0-ALL,ptr-Pointer to Selected Reject Code in #9002313.93)
"RTN","BPSRPT0",78,0)
 S BPREJCD=0 I (",2,")[BPRTYPE S BPREJCD=$$SELREJCD^BPSRPT4(0) I BPREJCD="^" G EXIT
"RTN","BPSRPT0",79,0)
 ;
"RTN","BPSRPT0",80,0)
 ;Prompt to Include Auto(R)eversed or (A)LL (Default to ALL)
"RTN","BPSRPT0",81,0)
 ;Returns (0-All,1-AutoReversed)
"RTN","BPSRPT0",82,0)
 S BPAUTREV=0 I (",4,")[BPRTYPE S BPAUTREV=$$SELAUREV^BPSRPT4(0) I BPAUTREV="^" G EXIT
"RTN","BPSRPT0",83,0)
 ;
"RTN","BPSRPT0",84,0)
 ;Prompt to Include A(C)cepted or (R)ejected or (A)LL (Default to REJECTED)
"RTN","BPSRPT0",85,0)
 ;Returns (0-All,1-Rejected,2-Accepted)
"RTN","BPSRPT0",86,0)
 S BPACREJ=0 I (",4,")[BPRTYPE S BPACREJ=$$SELACREJ^BPSRPT4(1) I BPACREJ="^" G EXIT
"RTN","BPSRPT0",87,0)
 ;
"RTN","BPSRPT0",88,0)
 ;Prompt to Include (S)pecific Close Claim Reason or (A)ll (Default to All)
"RTN","BPSRPT0",89,0)
 ;Returns (0-All,ptr-Pointer to #356.8)
"RTN","BPSRPT0",90,0)
 S BPCCRSN=0 I (",7,")[BPRTYPE S BPCCRSN=$$SELCCRSN^BPSRPT4(0) I BPCCRSN="^" G EXIT
"RTN","BPSRPT0",91,0)
 ;
"RTN","BPSRPT0",92,0)
 ;Prompt for Excel Capture (Detail Only)
"RTN","BPSRPT0",93,0)
 S BPEXCEL=0 I 'BPSUMDET S BPEXCEL=$$SELEXCEL^BPSRPT4() I BPEXCEL="^" G EXIT
"RTN","BPSRPT0",94,0)
 ;
"RTN","BPSRPT0",95,0)
 ;Prompt for the Device
"RTN","BPSRPT0",96,0)
 I 'BPEXCEL D
"RTN","BPSRPT0",97,0)
 .W !!,"WARNING - THIS REPORT REQUIRES THAT A DEVICE WITH 132 COLUMN WIDTH BE USED."
"RTN","BPSRPT0",98,0)
 .W !,"IT WILL NOT DISPLAY CORRECTLY USING 80 COLUMN WIDTH DEVICES",!
"RTN","BPSRPT0",99,0)
 S BPQ=0 D DEVICE(BPRPTNAM) Q:BPQ
"RTN","BPSRPT0",100,0)
 ;
"RTN","BPSRPT0",101,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",102,0)
 D RUN(BPEXCEL,BPRPTNAM,BPSUMDET)
"RTN","BPSRPT0",103,0)
 I 'BPQ D PAUSE2^BPSRPT1
"RTN","BPSRPT0",104,0)
 ;
"RTN","BPSRPT0",105,0)
EXIT Q
"RTN","BPSRPT0",106,0)
 ;
"RTN","BPSRPT0",107,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",108,0)
 ;
"RTN","BPSRPT0",109,0)
RUN(BPEXCEL,BPRPTNAM,BPSUMDET) N BPPAGE,BPTMP
"RTN","BPSRPT0",110,0)
 S BPTMP=$NA(^TMP($J,"BPSRPT"))
"RTN","BPSRPT0",111,0)
 K @BPTMP
"RTN","BPSRPT0",112,0)
 S BPPAGE=0
"RTN","BPSRPT0",113,0)
 W:BPSCR&'BPEXCEL !,"Please wait...",!
"RTN","BPSRPT0",114,0)
 ;
"RTN","BPSRPT0",115,0)
 ;Compile the report
"RTN","BPSRPT0",116,0)
 Q:$$COLLECT^BPSRPT1(BPTMP)=-1
"RTN","BPSRPT0",117,0)
 U IO
"RTN","BPSRPT0",118,0)
 ;
"RTN","BPSRPT0",119,0)
 ;Display the report
"RTN","BPSRPT0",120,0)
 D REPORT^BPSRPT5(BPTMP,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE)
"RTN","BPSRPT0",121,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRPT0",122,0)
 K @BPTMP
"RTN","BPSRPT0",123,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRPT0",124,0)
 D ^%ZISC
"RTN","BPSRPT0",125,0)
 Q
"RTN","BPSRPT0",126,0)
 ;
"RTN","BPSRPT0",127,0)
 ;Prompt For the Device
"RTN","BPSRPT0",128,0)
 ;
"RTN","BPSRPT0",129,0)
 ; Returns Device variables and BPSCR
"RTN","BPSRPT0",130,0)
 ;
"RTN","BPSRPT0",131,0)
DEVICE(BPRPTNAM) N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,ZTSAVE,POP
"RTN","BPSRPT0",132,0)
 S %ZIS="QM"
"RTN","BPSRPT0",133,0)
 D ^%ZIS
"RTN","BPSRPT0",134,0)
 I POP S BPQ=1
"RTN","BPSRPT0",135,0)
 ;
"RTN","BPSRPT0",136,0)
 ;Check for exit
"RTN","BPSRPT0",137,0)
 I $G(BPQ) G XDEV
"RTN","BPSRPT0",138,0)
 ;
"RTN","BPSRPT0",139,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRPT0",140,0)
 I $D(IO("Q")) D  S BPQ=1
"RTN","BPSRPT0",141,0)
 . S ZTRTN="RUN^BPSRPT0(BPEXCEL,BPRPTNAM,BPSUMDET)"
"RTN","BPSRPT0",142,0)
 . S ZTIO=ION
"RTN","BPSRPT0",143,0)
 . S ZTSAVE("*")=""
"RTN","BPSRPT0",144,0)
 . S ZTDESC="BPS REPORT: "_BPRPTNAM
"RTN","BPSRPT0",145,0)
 . D ^%ZTLOAD
"RTN","BPSRPT0",146,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRPT0",147,0)
 . D HOME^%ZIS
"RTN","BPSRPT0",148,0)
 U IO
"RTN","BPSRPT0",149,0)
XDEV Q
"RTN","BPSRPT1")
0^20^B48512534
"RTN","BPSRPT1",1,0)
BPSRPT1 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSRPT1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT1",4,0)
 Q
"RTN","BPSRPT1",5,0)
 ;
"RTN","BPSRPT1",6,0)
 ; ECME Report Compile Routine - Looping/Filtering Routine
"RTN","BPSRPT1",7,0)
 ;
"RTN","BPSRPT1",8,0)
 ;  Input Variables:
"RTN","BPSRPT1",9,0)
 ;                 BPRTYPE - Type of Report (1-7)
"RTN","BPSRPT1",10,0)
 ;               BPGLTMP - Temporary storage global
"RTN","BPSRPT1",11,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array
"RTN","BPSRPT1",12,0)
 ;                         of internal pointers of selected pharmacies
"RTN","BPSRPT1",13,0)
 ;              BPSUMDET - (1) Summary or (0) Detail format
"RTN","BPSRPT1",14,0)
 ;              BPINSINF - Set to 0 for all insurances or insurance co name
"RTN","BPSRPT1",15,0)
 ;                 BPMWC - 1-ALL,2-Mail,3-Window,4-CMOP Prescriptions
"RTN","BPSRPT1",16,0)
 ;               BPRTBCK - 1-ALL,2-RealTime,3-Backbill Claim Submission
"RTN","BPSRPT1",17,0)
 ;               BPRLNRL - 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",18,0)
 ;                BPDRUG - DRUG to report on (ptr to #50)
"RTN","BPSRPT1",19,0)
 ;               BPDRGCL - DRUG CLASS to report on (0 for ALL)
"RTN","BPSRPT1",20,0)
 ;               BPBEGDT - Beginning Date
"RTN","BPSRPT1",21,0)
 ;               BPENDDT - Ending Date
"RTN","BPSRPT1",22,0)
 ;               BPCCRSN - Set to 0 for all closed claim reasons or ptr to #356.8
"RTN","BPSRPT1",23,0)
 ;              BPAUTREV - 0-ALL,1-Auto Reversed
"RTN","BPSRPT1",24,0)
 ;               BPACREJ - 0-ALL,1-REJECTED,2-ACCEPTED
"RTN","BPSRPT1",25,0)
 ;              
"RTN","BPSRPT1",26,0)
COLLECT(BPGLTMP) N BP02,BP57,BP59,BPENDDT1,BPLDT02,BPLDT57,X,Y,OK,BPIX
"RTN","BPSRPT1",27,0)
 ;
"RTN","BPSRPT1",28,0)
 ;Check Variables
"RTN","BPSRPT1",29,0)
 S OK=1
"RTN","BPSRPT1",30,0)
 S:'$G(BPBEGDT) BPBEGDT=0
"RTN","BPSRPT1",31,0)
 S:'$G(BPENDDT) BPENDDT=9999999
"RTN","BPSRPT1",32,0)
 S BPENDDT=BPENDDT+0.9
"RTN","BPSRPT1",33,0)
 I $G(BPRTYPE)=""!($G(BPGLTMP)="")!($G(BPPHARM)="")!($G(BPSUMDET)="")!($G(BPINSINF)="")!($G(BPMWC)="")!($G(BPRTBCK)="") S OK=-1 G EXIT
"RTN","BPSRPT1",34,0)
 ;
"RTN","BPSRPT1",35,0)
 ;Loop through BPS CLAIMS
"RTN","BPSRPT1",36,0)
 ;
"RTN","BPSRPT1",37,0)
 ;First look for fill/refill cross reference
"RTN","BPSRPT1",38,0)
 ;Loop through Date of Service Index in BPS CLAIMS file and find link to 
"RTN","BPSRPT1",39,0)
 ;claim in BPS TRANSACTION.  Process earliest Date of Service entry found in
"RTN","BPSRPT1",40,0)
 ;BPS TRANSACTION
"RTN","BPSRPT1",41,0)
 ;
"RTN","BPSRPT1",42,0)
 ;Choose Index to Loop through (different for Closed Claims)
"RTN","BPSRPT1",43,0)
 S BPIX="AF" S:BPRTYPE=7 BPIX="AG"
"RTN","BPSRPT1",44,0)
 ;
"RTN","BPSRPT1",45,0)
 S BPLDT02=$S(BPIX="AF":$$FM2YMD(BPBEGDT-0.00001),1:BPBEGDT) S:BPLDT02="" BPLDT02=0
"RTN","BPSRPT1",46,0)
 S BPENDDT1=$S(BPIX="AF":$$FM2YMD(BPENDDT),1:BPENDDT_".9999999999") S:BPENDDT1="" BPENDDT1=99999999
"RTN","BPSRPT1",47,0)
 F  S BPLDT02=+$O(^BPSC(BPIX,BPLDT02)) Q:BPLDT02=0!(BPLDT02>BPENDDT1)  D
"RTN","BPSRPT1",48,0)
 . S BP02=0 F  S BP02=$O(^BPSC(BPIX,BPLDT02,BP02)) Q:+BP02=0  D
"RTN","BPSRPT1",49,0)
 . . S BP59=+$O(^BPST("AE",BP02,0))
"RTN","BPSRPT1",50,0)
 . . Q:BP59=0
"RTN","BPSRPT1",51,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",52,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT02_"^02"
"RTN","BPSRPT1",53,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",54,0)
 ;
"RTN","BPSRPT1",55,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSRPT1",56,0)
 ;  of the latest update for the claim
"RTN","BPSRPT1",57,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSRPT1",58,0)
 ;  changes made the claim
"RTN","BPSRPT1",59,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSRPT1",60,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSRPT1",61,0)
 S BPLDT57=BPBEGDT-0.00001
"RTN","BPSRPT1",62,0)
 F  S BPLDT57=+$O(^BPSTL("AH",BPLDT57)) Q:BPLDT57=0!(BPLDT57>BPENDDT)  D
"RTN","BPSRPT1",63,0)
 . S BP57=0 F  S BP57=$O(^BPSTL("AH",BPLDT57,BP57)) Q:+BP57=0  D
"RTN","BPSRPT1",64,0)
 . . S BP59=+$G(^BPSTL(BP57,0))
"RTN","BPSRPT1",65,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",66,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT57_"^57"
"RTN","BPSRPT1",67,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",68,0)
 ;
"RTN","BPSRPT1",69,0)
 ;Remove Portion of Scratch Global
"RTN","BPSRPT1",70,0)
EXIT K @BPGLTMP@("FILE59")
"RTN","BPSRPT1",71,0)
 Q OK
"RTN","BPSRPT1",72,0)
 ;
"RTN","BPSRPT1",73,0)
 ;Convert FB date to YYYYMMDD
"RTN","BPSRPT1",74,0)
FM2YMD(BPFMDT) N Y,Y1
"RTN","BPSRPT1",75,0)
 S Y=$E(BPFMDT,2,3),Y1=$E(BPFMDT,1,1) S Y=$S(Y1=3:"20"_Y,Y1=2:"19"_Y,1:"")
"RTN","BPSRPT1",76,0)
 Q:Y Y_$E(BPFMDT,4,7)
"RTN","BPSRPT1",77,0)
 Q ""
"RTN","BPSRPT1",78,0)
 ;
"RTN","BPSRPT1",79,0)
 ;Process each Entry
"RTN","BPSRPT1",80,0)
 ;
"RTN","BPSRPT1",81,0)
PROCESS(BP59) N BPBCK,BPDFN,BPREF,BPPAYBL,BPPLAN,BPREJ,BPRLSDT,BPRX,BPRXDRG,BPSTATUS
"RTN","BPSRPT1",82,0)
 ;
"RTN","BPSRPT1",83,0)
 ;Get ABSBRXI - ptr to #52
"RTN","BPSRPT1",84,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11)
"RTN","BPSRPT1",85,0)
 ;
"RTN","BPSRPT1",86,0)
 ;Get ABSBRXR - Prescription Number IEN
"RTN","BPSRPT1",87,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U)
"RTN","BPSRPT1",88,0)
 ;
"RTN","BPSRPT1",89,0)
 ;Get PATIENT - ptr to #2
"RTN","BPSRPT1",90,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT1",91,0)
 ;
"RTN","BPSRPT1",92,0)
 ;Check for correct BPS Pharmacy (DIVISION)
"RTN","BPSRPT1",93,0)
 I $G(BPPHARM)=1,$$CHKPHRM(BP59)=0 G XPROC
"RTN","BPSRPT1",94,0)
 ;
"RTN","BPSRPT1",95,0)
 ;Check for Display 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",96,0)
 S BPRLSDT=$$RELEASED(BPRX,BPREF)
"RTN","BPSRPT1",97,0)
 I BPRLNRL'=1 I ((BPRLNRL=2)&(BPRLSDT=0))!((BPRLNRL=3)&(BPRLSDT)) G XPROC
"RTN","BPSRPT1",98,0)
 ;
"RTN","BPSRPT1",99,0)
 ;Get Status
"RTN","BPSRPT1",100,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT1",101,0)
 ;
"RTN","BPSRPT1",102,0)
 ;if REVERSAL
"RTN","BPSRPT1",103,0)
 I BPRTYPE=4,BPSTATUS'["REVERSAL" G XPROC  ; exclude non-reversed
"RTN","BPSRPT1",104,0)
 ;
"RTN","BPSRPT1",105,0)
 ;if PAYABLE
"RTN","BPSRPT1",106,0)
 S BPPAYBL=BPSTATUS["PAYABLE"
"RTN","BPSRPT1",107,0)
 I BPRTYPE=1,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",108,0)
 I BPRTYPE=1,BPSTATUS["REVERSAL" G XPROC  ; reversed
"RTN","BPSRPT1",109,0)
 ;
"RTN","BPSRPT1",110,0)
 ;if REJECTED
"RTN","BPSRPT1",111,0)
 S BPREJ=BPSTATUS["REJECTED"
"RTN","BPSRPT1",112,0)
 I BPRTYPE=2,BPSTATUS["REVERSAL" G XPROC ; exclude rejected reversals
"RTN","BPSRPT1",113,0)
 I BPRTYPE=2,'BPREJ G XPROC  ; exclude non-rejected
"RTN","BPSRPT1",114,0)
 I BPRTYPE=2,$$CLSCLM(BP59) G XPROC  ;exclude closed claims
"RTN","BPSRPT1",115,0)
 ;
"RTN","BPSRPT1",116,0)
 ;if SUBMITTED NOT RELEASED exclude released ones
"RTN","BPSRPT1",117,0)
 I BPRTYPE=3,BPRLSDT'=0 G XPROC
"RTN","BPSRPT1",118,0)
 I BPRTYPE=3,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",119,0)
 ;
"RTN","BPSRPT1",120,0)
 ;Auto Reverse Check
"RTN","BPSRPT1",121,0)
 I BPRTYPE=4,BPAUTREV,'$$AUTOREV(BP59) G XPROC
"RTN","BPSRPT1",122,0)
 ;
"RTN","BPSRPT1",123,0)
 ;if CLOSED
"RTN","BPSRPT1",124,0)
 I BPRTYPE=7,'$$CLSCLM(BP59) G XPROC  ;exclude open claims
"RTN","BPSRPT1",125,0)
 I BPRTYPE=7,BPSTATUS'["REJECTED" G XPROC  ;exclude non-rejected closed claims
"RTN","BPSRPT1",126,0)
 ;
"RTN","BPSRPT1",127,0)
 ;if Recent Transactions, exclude closed claims
"RTN","BPSRPT1",128,0)
 I BPRTYPE=5,$$CLSCLM(BP59) G XPROC
"RTN","BPSRPT1",129,0)
 ;
"RTN","BPSRPT1",130,0)
 ;If Totals by Date, include only rejects and payables
"RTN","BPSRPT1",131,0)
 I BPRTYPE=6,BPSTATUS'["REJECTED",BPSTATUS'["PAYABLE" G XPROC  ; Reversed
"RTN","BPSRPT1",132,0)
 ;
"RTN","BPSRPT1",133,0)
 ;Realtime/Backbill Check
"RTN","BPSRPT1",134,0)
 S BPBCK=$$RTBCK(BP59)
"RTN","BPSRPT1",135,0)
 I BPRTBCK'=1 I ((BPRTBCK=2)&(BPBCK=0))!((BPRTBCK=3)&(BPBCK)) G XPROC
"RTN","BPSRPT1",136,0)
 ;
"RTN","BPSRPT1",137,0)
 ;Check for MAIL/WINDOW/CMOP/ALL
"RTN","BPSRPT1",138,0)
 I BPMWC'="A",$$MWC^BPSRPT6(BPRX,BPREF)'=BPMWC G XPROC
"RTN","BPSRPT1",139,0)
 ;
"RTN","BPSRPT1",140,0)
 ;Check for selected insurance
"RTN","BPSRPT1",141,0)
 S BPPLAN=$P($$INSNAM^BPSRPT6(BP59),U,2)
"RTN","BPSRPT1",142,0)
 I BPINSINF'=0,BPINSINF'=BPPLAN G XPROC
"RTN","BPSRPT1",143,0)
 ;
"RTN","BPSRPT1",144,0)
 ;Check for selected drug
"RTN","BPSRPT1",145,0)
 S BPRXDRG=$$GETDRUG^BPSRPT6(BPRX)
"RTN","BPSRPT1",146,0)
 I BPRXDRG=0 G XPROC
"RTN","BPSRPT1",147,0)
 I BPDRUG,BPDRUG'=BPRXDRG G XPROC
"RTN","BPSRPT1",148,0)
 ;
"RTN","BPSRPT1",149,0)
 ;Check for selected drug classes
"RTN","BPSRPT1",150,0)
 I BPDRGCL'=0,BPDRGCL'=$$DRGCLNAM^BPSRPT6($$GETDRGCL^BPSRPT6(BPRXDRG),99) G XPROC
"RTN","BPSRPT1",151,0)
 ;
"RTN","BPSRPT1",152,0)
 ;Check for selected Close Reason
"RTN","BPSRPT1",153,0)
 I BPCCRSN,BPCCRSN'=$P($$CLRSN^BPSRPT7(BP59),U) G XPROC
"RTN","BPSRPT1",154,0)
 ;
"RTN","BPSRPT1",155,0)
 ;Check for Accepted/Rejected
"RTN","BPSRPT1",156,0)
 I BPACREJ=1,BPSTATUS'["REJECTED" G XPROC
"RTN","BPSRPT1",157,0)
 I BPACREJ=2,BPSTATUS'["ACCEPTED" G XPROC
"RTN","BPSRPT1",158,0)
 ;
"RTN","BPSRPT1",159,0)
 ;Check for Specific Reject Code
"RTN","BPSRPT1",160,0)
 I BPREJCD'=0,'$$CKREJ(BP59,BPREJCD) G XPROC
"RTN","BPSRPT1",161,0)
 ;
"RTN","BPSRPT1",162,0)
 ;Save Entry for Report
"RTN","BPSRPT1",163,0)
 D SETTMP^BPSRPT2(BPGLTMP,BPDFN,BPRX,BPREF,BP59,BPBEGDT,BPENDDT,.BPPHARM,BPSUMDET,BPPLAN,BPRLSDT,BPPAYBL,BPREJ,BPRXDRG,$P(BPSTATUS,U))
"RTN","BPSRPT1",164,0)
 ;
"RTN","BPSRPT1",165,0)
XPROC Q
"RTN","BPSRPT1",166,0)
 ;
"RTN","BPSRPT1",167,0)
 ;Check if selected BPS PHARMACY
"RTN","BPSRPT1",168,0)
 ;
"RTN","BPSRPT1",169,0)
 ; Defined Variable: BPPHARM(ptr) - List of BPS Pharmacies to Report on
"RTN","BPSRPT1",170,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",171,0)
 ; 
"RTN","BPSRPT1",172,0)
 ; Returned Value -> 0 = Entry not in list of selected pharmacies
"RTN","BPSRPT1",173,0)
 ;                   1 = Entry is in list of selected pharmacies
"RTN","BPSRPT1",174,0)
CHKPHRM(BP59) N PHARM
"RTN","BPSRPT1",175,0)
 S PHARM=+$P($G(^BPST(BP59,1)),"^",7)
"RTN","BPSRPT1",176,0)
 S PHARM=$S($D(BPPHARM(PHARM)):1,1:0)
"RTN","BPSRPT1",177,0)
 Q PHARM
"RTN","BPSRPT1",178,0)
 ;
"RTN","BPSRPT1",179,0)
 ;Determine whether claim is Released or Not Released
"RTN","BPSRPT1",180,0)
 ;
"RTN","BPSRPT1",181,0)
 ; Input Variables: BPRX - ptr to PRESCRIPTION (#52)
"RTN","BPSRPT1",182,0)
 ;                 BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT1",183,0)
 ;
"RTN","BPSRPT1",184,0)
 ; Return Value ->             0 = Not Released
"RTN","BPSRPT1",185,0)
 ;                 released date = Released
"RTN","BPSRPT1",186,0)
 ;                 
"RTN","BPSRPT1",187,0)
RELEASED(BPRX,BPREF) N RDT
"RTN","BPSRPT1",188,0)
 ;
"RTN","BPSRPT1",189,0)
 I BPREF=0 S RDT=$$RXRELDT^BPSRPT6(BPRX)\1
"RTN","BPSRPT1",190,0)
 I BPREF'=0 S RDT=$$REFRELDT^BPSRPT6(BPRX,BPREF)\1
"RTN","BPSRPT1",191,0)
 Q RDT
"RTN","BPSRPT1",192,0)
 ;
"RTN","BPSRPT1",193,0)
 ;Determine if claim was Auto Reversed
"RTN","BPSRPT1",194,0)
 ;
"RTN","BPSRPT1",195,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",196,0)
 ; Return Value -> 1 = Auto Reversed
"RTN","BPSRPT1",197,0)
 ;                 0 = Not Auto Reversed
"RTN","BPSRPT1",198,0)
 ;
"RTN","BPSRPT1",199,0)
AUTOREV(BP59) N AR,BP02
"RTN","BPSRPT1",200,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",201,0)
 S AR=+$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSRPT1",202,0)
 Q AR
"RTN","BPSRPT1",203,0)
 ;
"RTN","BPSRPT1",204,0)
 ;Determine if claim was closed
"RTN","BPSRPT1",205,0)
 ;
"RTN","BPSRPT1",206,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",207,0)
 ; Return Value -> 1 = Closed
"RTN","BPSRPT1",208,0)
 ;                 0 = Not Closed
"RTN","BPSRPT1",209,0)
 ;                 
"RTN","BPSRPT1",210,0)
CLSCLM(BP59) N BP02,CL
"RTN","BPSRPT1",211,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",212,0)
 S CL=+$G(^BPSC(BP02,900))
"RTN","BPSRPT1",213,0)
 Q CL
"RTN","BPSRPT1",214,0)
 ;
"RTN","BPSRPT1",215,0)
 ;Determine whether claim is Realtime or Backbilled
"RTN","BPSRPT1",216,0)
 ;
"RTN","BPSRPT1",217,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",218,0)
 ; Return Value -> 1 = Backbilled
"RTN","BPSRPT1",219,0)
 ;                 0 = Realtime
"RTN","BPSRPT1",220,0)
RTBCK(BP59) N BB
"RTN","BPSRPT1",221,0)
 S BB=$P($G(^BPST(BP59,12)),U)
"RTN","BPSRPT1",222,0)
 S BB=$S(BB="BB":0,1:1)
"RTN","BPSRPT1",223,0)
 Q BB
"RTN","BPSRPT1",224,0)
 ;
"RTN","BPSRPT1",225,0)
 ;Screen Pause 1
"RTN","BPSRPT1",226,0)
 ;
"RTN","BPSRPT1",227,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",228,0)
 ;                          2 Quit
"RTN","BPSRPT1",229,0)
PAUSE N X
"RTN","BPSRPT1",230,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","BPSRPT1",231,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",232,0)
 U IO
"RTN","BPSRPT1",233,0)
 Q
"RTN","BPSRPT1",234,0)
 ;
"RTN","BPSRPT1",235,0)
 ;Screen Pause 2
"RTN","BPSRPT1",236,0)
 ;
"RTN","BPSRPT1",237,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",238,0)
 ;                         2 Quit
"RTN","BPSRPT1",239,0)
PAUSE2 N X
"RTN","BPSRPT1",240,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","BPSRPT1",241,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",242,0)
 U IO
"RTN","BPSRPT1",243,0)
 Q
"RTN","BPSRPT1",244,0)
 ;
"RTN","BPSRPT1",245,0)
 ;Get ECME#
"RTN","BPSRPT1",246,0)
 ;
"RTN","BPSRPT1",247,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",248,0)
 ; Returned value -> Last 7 digits of ECME#
"RTN","BPSRPT1",249,0)
 ; 
"RTN","BPSRPT1",250,0)
ECMENUM(BP59) N BPY1,BPY2
"RTN","BPSRPT1",251,0)
 S BPY1=(BP59\1),BPY2=$E(BPY1,$L(BPY1)-6,99) ;last 7 digits
"RTN","BPSRPT1",252,0)
 Q BPY2
"RTN","BPSRPT1",253,0)
 ;
"RTN","BPSRPT1",254,0)
 ;Convert FM date or date.time to displayable (mm/dd/yy HH:MM) format
"RTN","BPSRPT1",255,0)
 ;
"RTN","BPSRPT1",256,0)
DATTIM(X) N DATE,BPT,BPM,BPH,BPAP
"RTN","BPSRPT1",257,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSRPT1",258,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSRPT1",259,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSRPT1",260,0)
 S BPAP="AM" I BPH>12 S BPH=BPH-12,BPAP="PM" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSRPT1",261,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSRPT1",262,0)
 Q $G(DATE)
"RTN","BPSRPT1",263,0)
 ;
"RTN","BPSRPT1",264,0)
 ;Display RT-Realtime,BB-Backbill, or " "
"RTN","BPSRPT1",265,0)
 ;
"RTN","BPSRPT1",266,0)
RTBCKNAM(BPINDEX) Q $S(BPINDEX=1:"RT",BPINDEX=0:"BB",1:" ")
"RTN","BPSRPT1",267,0)
 ;
"RTN","BPSRPT1",268,0)
 ;See for Specific Reject Code
"RTN","BPSRPT1",269,0)
 ;
"RTN","BPSRPT1",270,0)
CKREJ(BP59,BPREJCD) N FREJ,I,REJ,X
"RTN","BPSRPT1",271,0)
 S FREJ=0
"RTN","BPSRPT1",272,0)
 S X=$$REJTEXT^BPSRPT2(BP59,.REJ)
"RTN","BPSRPT1",273,0)
 S X="" F  S X=$O(REJ(X)) Q:X=""  D  Q:FREJ=1
"RTN","BPSRPT1",274,0)
 .S REJ=$P($G(REJ(X)),":") Q:REJ=""
"RTN","BPSRPT1",275,0)
 .S I="" F  S I=$O(^BPSF(9002313.93,"B",REJ,I)) Q:I=""  I I=BPREJCD S FREJ=1
"RTN","BPSRPT1",276,0)
 Q FREJ
"RTN","BPSRPT2")
0^21^B30091108
"RTN","BPSRPT2",1,0)
BPSRPT2 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT2",4,0)
 ;
"RTN","BPSRPT2",5,0)
 Q
"RTN","BPSRPT2",6,0)
 ;
"RTN","BPSRPT2",7,0)
 ;Save One Report Entry
"RTN","BPSRPT2",8,0)
 ;
"RTN","BPSRPT2",9,0)
 ; Input variables -> See BPSRPT0 for description
"RTN","BPSRPT2",10,0)
 ; BPTMPGL,BPDFN,BPRX,BPREF,BP59,BPENDDT,BPPHARM,BPSUMDET,BPGRPLAN,BPRLDT,BPPAYBL,BPREJFL,BPRXDRG
"RTN","BPSRPT2",11,0)
 ; 
"RTN","BPSRPT2",12,0)
SETTMP(BPTMPGL,BPDFN,BPRX,BPREF,BP59,BPBEGDT,BPENDDT,BPPHARM,BPSUMDET,BPGRPLAN,BPRLDT,BPPAYBL,BPREJFL,BPRXDRG,BPSTATUS) ;
"RTN","BPSRPT2",13,0)
 N BPCLSDT,BPDATA,BPDIV,BPFILDT,BPISSDT,BPSMSG,BPSREJ,BPREST,BPSRWR,BPTDTTM,BPTRDT
"RTN","BPSRPT2",14,0)
 ;
"RTN","BPSRPT2",15,0)
 ;Check for bad data
"RTN","BPSRPT2",16,0)
 I BPREF,$$IFREFILL^BPSRPT6(BPRX,BPREF)=0 G EXIT
"RTN","BPSRPT2",17,0)
 ;
"RTN","BPSRPT2",18,0)
 ;Retrieve Close Date
"RTN","BPSRPT2",19,0)
 S BPCLSDT=$P($$CLOSEDT(BP59),".")
"RTN","BPSRPT2",20,0)
 ;
"RTN","BPSRPT2",21,0)
 ;If NO refills 
"RTN","BPSRPT2",22,0)
 I BPREF=0 D
"RTN","BPSRPT2",23,0)
 . S BPFILDT=$$RXFILDT^BPSRPT6(BPRX)
"RTN","BPSRPT2",24,0)
 . S BPISSDT=$$RXISSDT^BPSRPT6(BPRX)
"RTN","BPSRPT2",25,0)
 ;
"RTN","BPSRPT2",26,0)
 ;If Refills
"RTN","BPSRPT2",27,0)
 I BPREF>0 D
"RTN","BPSRPT2",28,0)
 . S BPFILDT=$$REFFILDT^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT2",29,0)
 . S BPISSDT=$$REFISSDT^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT2",30,0)
 ;
"RTN","BPSRPT2",31,0)
 ;Get Transaction Date/Transaction Date and Time
"RTN","BPSRPT2",32,0)
 S BPTRDT=$$TRANDT(BP59,0)
"RTN","BPSRPT2",33,0)
 S BPTDTTM=$$TRANDT(BP59,1)
"RTN","BPSRPT2",34,0)
 ;
"RTN","BPSRPT2",35,0)
 ;Get Result, Message, Reject Information, and BPS Pharmacy
"RTN","BPSRPT2",36,0)
 S BPREST=$$RESULT(BP59,.BPSRWR)
"RTN","BPSRPT2",37,0)
 S BPSMSG=$$MSG(BPSRWR,.BPSMSG,BP59)
"RTN","BPSRPT2",38,0)
 S BPSREJ=$S(BPREJFL=0:"",1:$$REJECT(BPREST,.BPSREJ,BP59))
"RTN","BPSRPT2",39,0)
 S BPDIV=+$P($G(^BPST(BP59,1)),"^",7)
"RTN","BPSRPT2",40,0)
 ;
"RTN","BPSRPT2",41,0)
 ;Set up data node
"RTN","BPSRPT2",42,0)
 S BPDATA=BPRLDT_U_BPTRDT_U_BP59_U_BPRX_U_BPREF_U_BPREST_U_BPSTATUS_U_BPFILDT_U_BPISSDT_U_U_U_BPPAYBL_U_BPREJFL_U_BPRXDRG_U_BPSRWR
"RTN","BPSRPT2",43,0)
 ;
"RTN","BPSRPT2",44,0)
 ;For Totals by Date - No Insurance Sort
"RTN","BPSRPT2",45,0)
 I BPRTYPE=6 S BPGRPLAN="~"
"RTN","BPSRPT2",46,0)
 ;
"RTN","BPSRPT2",47,0)
 ;Sort by transaction date
"RTN","BPSRPT2",48,0)
 I BPRTYPE'=7 D:$$CHKDT(+$G(BPTRDT),BPBEGDT,BPENDDT)
"RTN","BPSRPT2",49,0)
 . ;
"RTN","BPSRPT2",50,0)
 . ;For Recent Transactions tack on Txn date and Time to Ins
"RTN","BPSRPT2",51,0)
 . I BPRTYPE=5 S BPGRPLAN=-BPTDTTM_"^"_BPGRPLAN
"RTN","BPSRPT2",52,0)
 . S @BPTMPGL@(BPDIV,BPGRPLAN,BPDFN,BPTRDT,BPRX,BPREF)=BPDATA
"RTN","BPSRPT2",53,0)
 ;
"RTN","BPSRPT2",54,0)
 ;Sort by close date
"RTN","BPSRPT2",55,0)
 I BPRTYPE=7 D:$$CHKDT(+$G(BPCLSDT),BPBEGDT,BPENDDT)
"RTN","BPSRPT2",56,0)
 . S @BPTMPGL@(BPDIV,BPGRPLAN,BPDFN,BPCLSDT,BPRX,BPREF)=BPDATA
"RTN","BPSRPT2",57,0)
 ;
"RTN","BPSRPT2",58,0)
EXIT Q
"RTN","BPSRPT2",59,0)
 ;
"RTN","BPSRPT2",60,0)
 ;Get Transaction date and Time
"RTN","BPSRPT2",61,0)
 ;
"RTN","BPSRPT2",62,0)
 ; Input Variables -> BP59 - ptr to BPS TRANSACTION
"RTN","BPSRPT2",63,0)
 ;                    TIME - 1 - Return DT.TM, 0 - DT
"RTN","BPSRPT2",64,0)
 ; Returned Value -> Transaction or Transaction Date.Time
"RTN","BPSRPT2",65,0)
 ; 
"RTN","BPSRPT2",66,0)
TRANDT(BP59,TIME) N X
"RTN","BPSRPT2",67,0)
 S X=$P($G(^BPST(BP59,0)),U,8)
"RTN","BPSRPT2",68,0)
 Q $S(TIME=0:X\1,1:X)
"RTN","BPSRPT2",69,0)
 ;
"RTN","BPSRPT2",70,0)
 ;Determine the Claim Close Date
"RTN","BPSRPT2",71,0)
 ;
"RTN","BPSRPT2",72,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT2",73,0)
 ; Returned Value -> CL = Claim Close Date and Time
"RTN","BPSRPT2",74,0)
 ; 
"RTN","BPSRPT2",75,0)
CLOSEDT(BP59) N CL,BP02
"RTN","BPSRPT2",76,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",77,0)
 S CL=+$P($G(^BPSC(BP02,900)),U,2)
"RTN","BPSRPT2",78,0)
 Q CL
"RTN","BPSRPT2",79,0)
 ;
"RTN","BPSRPT2",80,0)
 ;Get Result
"RTN","BPSRPT2",81,0)
 ;
"RTN","BPSRPT2",82,0)
RESULT(BP59,RWR) N X
"RTN","BPSRPT2",83,0)
 I BP59 S RWR=$$CATEG^BPSOSUC(BP59)
"RTN","BPSRPT2",84,0)
 E  S RWR=""
"RTN","BPSRPT2",85,0)
 I RWR?1"E ".E D
"RTN","BPSRPT2",86,0)
 . S X=RWR
"RTN","BPSRPT2",87,0)
 . I X="E PAYABLE" S X=4
"RTN","BPSRPT2",88,0)
 . E  I X="E CAPTURED" S X=3
"RTN","BPSRPT2",89,0)
 . E  I X="E DUPLICATE" S X=2
"RTN","BPSRPT2",90,0)
 . E  I X="E REJECTED" S X=1
"RTN","BPSRPT2",91,0)
 . E  I X="E REVERSAL ACCEPTED" S X=11
"RTN","BPSRPT2",92,0)
 . E  I X="E REVERSAL REJECTED" S X=12
"RTN","BPSRPT2",93,0)
 . E  S X=0
"RTN","BPSRPT2",94,0)
 E  I RWR="PAPER" S X=9
"RTN","BPSRPT2",95,0)
 E  I RWR="PAPER REVERSAL" S X=19
"RTN","BPSRPT2",96,0)
 E  S X=15
"RTN","BPSRPT2",97,0)
 Q X
"RTN","BPSRPT2",98,0)
 ;
"RTN","BPSRPT2",99,0)
 ;Message
"RTN","BPSRPT2",100,0)
 ;
"RTN","BPSRPT2",101,0)
MSG(RWR,MSGTEXT,BP59) N BPRET
"RTN","BPSRPT2",102,0)
 S BPRET=0
"RTN","BPSRPT2",103,0)
 ; If the claim has any message text, store it
"RTN","BPSRPT2",104,0)
 I RWR?1"E ".E D
"RTN","BPSRPT2",105,0)
 . S X=$$MESSAG59(BP59,1)
"RTN","BPSRPT2",106,0)
 . I X]"" S MSGTEXT(1)=X
"RTN","BPSRPT2",107,0)
 . S X=$$MESSAG59(BP59,2)
"RTN","BPSRPT2",108,0)
 . I X]"" S MSGTEXT(2)=X
"RTN","BPSRPT2",109,0)
 . I $D(MSGTEXT) S MSGTEXT="MSGTEXT"
"RTN","BPSRPT2",110,0)
 . S BPRET=1
"RTN","BPSRPT2",111,0)
 Q BPRET
"RTN","BPSRPT2",112,0)
 ;
"RTN","BPSRPT2",113,0)
 ;Reject Text
"RTN","BPSRPT2",114,0)
 ;
"RTN","BPSRPT2",115,0)
 ; Output Variable -> BPSRTEXT,BPRET
"RTN","BPSRPT2",116,0)
 ; 
"RTN","BPSRPT2",117,0)
REJECT(RWR,BPSRTEXT,BP59) N BPRET,BPSRESP,BPSECME,BPSPOS
"RTN","BPSRPT2",118,0)
 S BPRET=0
"RTN","BPSRPT2",119,0)
 ; If it's a rejected claim, build the rejection text
"RTN","BPSRPT2",120,0)
 I RWR="E REJECTED"!(RWR="E REVERSAL REJECTED") D
"RTN","BPSRPT2",121,0)
 . D RESP59(BP59,.BPSRESP,.BPSECME) ; set BPSRESP,BPSECME pointers
"RTN","BPSRPT2",122,0)
 . D REJTEXT^BPSOS03(BPSRESP,BPSPOS,.BPSRTEXT)
"RTN","BPSRPT2",123,0)
 . ; word processing text goes into FDA(FILE,IENS,FIELD,n)=text
"RTN","BPSRPT2",124,0)
 . S BPSRTEXT=$S($D(BPSRTEXT):"REJTEXT",1:"")
"RTN","BPSRPT2",125,0)
 . S:$D(BPSRTEXT) BPRET=1
"RTN","BPSRPT2",126,0)
 Q BPRET
"RTN","BPSRPT2",127,0)
 ;
"RTN","BPSRPT2",128,0)
 ;Messages 
"RTN","BPSRPT2",129,0)
 ;
"RTN","BPSRPT2",130,0)
MESSAG59(BP59,N) N MSG,BPSRESP,BPSPOS
"RTN","BPSRPT2",131,0)
 I 'BP59 S MSG="" G XMSG59
"RTN","BPSRPT2",132,0)
 D RESP59(59,.BPSRESP,.BPSPOS) I 'BPSRESP!'BPSPOS S MSG="" G XMSG59
"RTN","BPSRPT2",133,0)
 I '$D(N) S N=0
"RTN","BPSRPT2",134,0)
 I N=1 S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS,1) I 1
"RTN","BPSRPT2",135,0)
 I N=2 S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS,2) I 1
"RTN","BPSRPT2",136,0)
 E  S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS)
"RTN","BPSRPT2",137,0)
XMSG59 Q MSG
"RTN","BPSRPT2",138,0)
 ;
"RTN","BPSRPT2",139,0)
 ;Responds
"RTN","BPSRPT2",140,0)
RESP59(BP59,BPSRESP,BPSPOS) ;EP - caller should N BPSRESP,BPSPOS
"RTN","BPSRPT2",141,0)
 ;Input: BP59
"RTN","BPSRPT2",142,0)
 ;Output:
"RTN","BPSRPT2",143,0)
 ; BPSRESP,BPSPOS by reference
"RTN","BPSRPT2",144,0)
 I $G(^BPST(BP59,4)) D  ; reversal
"RTN","BPSRPT2",145,0)
 . S BPSRESP=$P($G(^BPST(BP59,4)),U,2)
"RTN","BPSRPT2",146,0)
 . S BPSPOS=1
"RTN","BPSRPT2",147,0)
 E  D
"RTN","BPSRPT2",148,0)
 . S BPSRESP=$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSRPT2",149,0)
 . S BPSPOS=$P($G(^BPST(BP59,0)),U,9)
"RTN","BPSRPT2",150,0)
 Q
"RTN","BPSRPT2",151,0)
 ;
"RTN","BPSRPT2",152,0)
 ;Check and compare dates
"RTN","BPSRPT2",153,0)
CHKDT(BPTSTDT,BPBEGDT,BPENDDT) ;
"RTN","BPSRPT2",154,0)
 I BPTSTDT=0 Q 0
"RTN","BPSRPT2",155,0)
 I BPTSTDT'<BPBEGDT,BPTSTDT'>BPENDDT Q 1
"RTN","BPSRPT2",156,0)
 Q 0
"RTN","BPSRPT2",157,0)
 ;
"RTN","BPSRPT2",158,0)
 ;Populate passed in Array
"RTN","BPSRPT2",159,0)
 ;
"RTN","BPSRPT2",160,0)
REJTEXT(BP59,ARR) N BBX,BPSRESP,BPSPOS,A,I,X,R
"RTN","BPSRPT2",161,0)
 S BBX=$G(^BPST(BP59,0))
"RTN","BPSRPT2",162,0)
 S BPSRESP=$P(BBX,U,5)
"RTN","BPSRPT2",163,0)
 S BPSPOS=$P(BBX,U,9)
"RTN","BPSRPT2",164,0)
 S (A,I)=0
"RTN","BPSRPT2",165,0)
 I BPSRESP&BPSPOS D
"RTN","BPSRPT2",166,0)
 . K ARR
"RTN","BPSRPT2",167,0)
 . F  S A=$O(^BPSR(BPSRESP,1000,BPSPOS,511,A)) Q:'A  D
"RTN","BPSRPT2",168,0)
 . . S R=$P(^BPSR(BPSRESP,1000,BPSPOS,511,A,0),U)
"RTN","BPSRPT2",169,0)
 . . Q:R=""
"RTN","BPSRPT2",170,0)
 . . N S S S=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSRPT2",171,0)
 . . I S S X=$TR($G(^BPSF(9002313.93,S,0)),U,":")
"RTN","BPSRPT2",172,0)
 . . E  S X=R_" unrecognized reject code"
"RTN","BPSRPT2",173,0)
 . . S I=I+1,ARR(I)=X
"RTN","BPSRPT2",174,0)
 . . K S
"RTN","BPSRPT2",175,0)
 Q I
"RTN","BPSRPT2",176,0)
 ;
"RTN","BPSRPT2",177,0)
 ;Get Claim ID
"RTN","BPSRPT2",178,0)
CLAIMID(BP59) N BP02
"RTN","BPSRPT2",179,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",180,0)
 Q $P($G(^BPSC(BP02,0)),U)
"RTN","BPSRPT2",181,0)
 ;
"RTN","BPSRPT2",182,0)
 ;Determine $Ins Paid
"RTN","BPSRPT2",183,0)
 ;
"RTN","BPSRPT2",184,0)
INSPAID(BP59) N X,RESP,POSITION
"RTN","BPSRPT2",185,0)
 S X=$G(^BPST(BP59,0))
"RTN","BPSRPT2",186,0)
 S RESP=$P(X,U,5)
"RTN","BPSRPT2",187,0)
 S POSITION=$P(X,U,9)
"RTN","BPSRPT2",188,0)
 Q $S(RESP&POSITION:$$INSPAID1^BPSOS03(RESP,POSITION),1:0)
"RTN","BPSRPT2",189,0)
 ;
"RTN","BPSRPT2",190,0)
 ;Get the Cardholder ID
"RTN","BPSRPT2",191,0)
CRDHLDID(BP59) N BP02
"RTN","BPSRPT2",192,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",193,0)
 Q $P($G(^BPSC(BP02,300)),U,2)
"RTN","BPSRPT2",194,0)
 ;
"RTN","BPSRPT2",195,0)
GRPID(BP59) ;sent by IB in RX^IBNCPDP
"RTN","BPSRPT2",196,0)
 N BP02
"RTN","BPSRPT2",197,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",198,0)
 Q $P($G(^BPSC(BP02,300)),U)
"RTN","BPSRPT3")
0^25^B36736728
"RTN","BPSRPT3",1,0)
BPSRPT3 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT3",4,0)
 ;
"RTN","BPSRPT3",5,0)
 Q
"RTN","BPSRPT3",6,0)
 ;
"RTN","BPSRPT3",7,0)
 ; Select the ECME Pharmacy or Pharmacies
"RTN","BPSRPT3",8,0)
 ; 
"RTN","BPSRPT3",9,0)
 ; Input Variable -> none
"RTN","BPSRPT3",10,0)
 ; Return Value ->   "" = Valid Entry or Entries Selected
"RTN","BPSRPT3",11,0)
 ;                                        ^ = Exit
"RTN","BPSRPT3",12,0)
 ;                                       
"RTN","BPSRPT3",13,0)
 ; Output Variable -> BPPHARM = 1 One or More Pharmacies Selected
"RTN","BPSRPT3",14,0)
 ;                          = 0 User Entered 'ALL'
"RTN","BPSRPT3",15,0)
 ;                            
"RTN","BPSRPT3",16,0)
 ; If BPPHARM = 1 then the BPPHARM array will be defined where:
"RTN","BPSRPT3",17,0)
 ;    BPPHARM(ptr) = ptr ^ BPS PHARMACY NAME and
"RTN","BPSRPT3",18,0)
 ;    ptr = Internal Pointer to BPS PHARMACIES file (#9002313.56)
"RTN","BPSRPT3",19,0)
 ;                    
"RTN","BPSRPT3",20,0)
SELPHARM() N DIC,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",21,0)
 ;
"RTN","BPSRPT3",22,0)
 ;Reset BPPHARM array
"RTN","BPSRPT3",23,0)
 K BPPHARM
"RTN","BPSRPT3",24,0)
 ;
"RTN","BPSRPT3",25,0)
 ;First see if they want to enter individual divisions or ALL
"RTN","BPSRPT3",26,0)
 S DIR(0)="S^D:DIVISION;A:ALL"
"RTN","BPSRPT3",27,0)
 S DIR("A")="Select Certain Pharmacy (D)ivisions or (A)LL"
"RTN","BPSRPT3",28,0)
 S DIR("L",1)="Select one of the following:"
"RTN","BPSRPT3",29,0)
 S DIR("L",2)=""
"RTN","BPSRPT3",30,0)
 S DIR("L",3)="     D         DIVISION"
"RTN","BPSRPT3",31,0)
 S DIR("L",4)="     A         ALL"
"RTN","BPSRPT3",32,0)
 D ^DIR K DIR
"RTN","BPSRPT3",33,0)
 ;
"RTN","BPSRPT3",34,0)
 ;Check for "^" or timeout, otherwise define BPPHARM
"RTN","BPSRPT3",35,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",36,0)
 E  S BPPHARM=$S(Y="A":0,1:1)
"RTN","BPSRPT3",37,0)
 ;
"RTN","BPSRPT3",38,0)
 ;If division selected, ask prompt
"RTN","BPSRPT3",39,0)
 I $G(BPPHARM)=1 F  D  Q:Y="^"!(Y="") 
"RTN","BPSRPT3",40,0)
 .;
"RTN","BPSRPT3",41,0)
 .;Prompt for entry
"RTN","BPSRPT3",42,0)
 .K X S DIC(0)="QEAM",DIC=9002313.56,DIC("A")="Select ECME Pharmacy Division(s): "
"RTN","BPSRPT3",43,0)
 .W ! D ^DIC
"RTN","BPSRPT3",44,0)
 .;
"RTN","BPSRPT3",45,0)
 .;Check for "^" or timeout 
"RTN","BPSRPT3",46,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",47,0)
 .;
"RTN","BPSRPT3",48,0)
 .;Check for blank entry, quit if no previous selections
"RTN","BPSRPT3",49,0)
 .I $G(X)="" S Y=$S($D(BPPHARM)>9:"",1:"^") K:Y="^" BPPHARM Q
"RTN","BPSRPT3",50,0)
 .;
"RTN","BPSRPT3",51,0)
 .;Handle Deletes
"RTN","BPSRPT3",52,0)
 .I $D(BPPHARM(+Y)) D  Q:Y="^"  I 1
"RTN","BPSRPT3",53,0)
 ..N P
"RTN","BPSRPT3",54,0)
 ..S P=Y  ;Save Original Value
"RTN","BPSRPT3",55,0)
 ..S DIR(0)="S^Y:YES;N:NO",DIR("A")="Delete "_$P(P,U,2)_" from your list?"
"RTN","BPSRPT3",56,0)
 ..S DIR("B")="NO" D ^DIR
"RTN","BPSRPT3",57,0)
 ..I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",58,0)
 ..I Y="Y" K BPPHARM(+P),BPPHARM("B",$P(P,U,2),+P)
"RTN","BPSRPT3",59,0)
 ..S Y=P  ;Restore Original Value
"RTN","BPSRPT3",60,0)
 ..K P
"RTN","BPSRPT3",61,0)
 .E  D
"RTN","BPSRPT3",62,0)
 ..;Define new entries in BPPHARM array
"RTN","BPSRPT3",63,0)
 ..S BPPHARM(+Y)=Y
"RTN","BPSRPT3",64,0)
 ..S BPPHARM("B",$P(Y,U,2),+Y)=""
"RTN","BPSRPT3",65,0)
 .;
"RTN","BPSRPT3",66,0)
 .;Display a list of selected divisions
"RTN","BPSRPT3",67,0)
 .I $D(BPPHARM)>9 D
"RTN","BPSRPT3",68,0)
 ..N X
"RTN","BPSRPT3",69,0)
 ..W !,?2,"Selected:"
"RTN","BPSRPT3",70,0)
 ..S X="" F  S X=$O(BPPHARM("B",X)) Q:X=""  W !,?10,X
"RTN","BPSRPT3",71,0)
 ..K X
"RTN","BPSRPT3",72,0)
 .Q
"RTN","BPSRPT3",73,0)
 ;
"RTN","BPSRPT3",74,0)
 K BPPHARM("B")
"RTN","BPSRPT3",75,0)
 Q Y
"RTN","BPSRPT3",76,0)
 ;
"RTN","BPSRPT3",77,0)
 ; Display (S)ummary or (D)etail Format
"RTN","BPSRPT3",78,0)
 ; 
"RTN","BPSRPT3",79,0)
 ; Input Variable -> DFLT = 1 Summary
"RTN","BPSRPT3",80,0)
 ;                          2 Detail
"RTN","BPSRPT3",81,0)
 ;                          
"RTN","BPSRPT3",82,0)
 ; Return Value ->   1 = Summary
"RTN","BPSRPT3",83,0)
 ;                   0 = Detail
"RTN","BPSRPT3",84,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",85,0)
 ;
"RTN","BPSRPT3",86,0)
SELSMDET(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",87,0)
 S DFLT=$S($G(DFLT)=1:"Summary",$G(DFLT)=0:"Detail",1:"Detail")
"RTN","BPSRPT3",88,0)
 S DIR(0)="S^S:Summary;D:Detail",DIR("A")="Display (S)ummary or (D)etail Format",DIR("B")=DFLT
"RTN","BPSRPT3",89,0)
 D ^DIR
"RTN","BPSRPT3",90,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",91,0)
 S Y=$S(Y="S":1,Y="D":0,1:Y)
"RTN","BPSRPT3",92,0)
 Q Y
"RTN","BPSRPT3",93,0)
 ;
"RTN","BPSRPT3",94,0)
 ; Select to Display Single (I)nsurance Company or (A)ll
"RTN","BPSRPT3",95,0)
 ;
"RTN","BPSRPT3",96,0)
 ; Input Variable -> DFLT = 1 Single Insurance
"RTN","BPSRPT3",97,0)
 ;                          0 All Insurance
"RTN","BPSRPT3",98,0)
 ;                          
"RTN","BPSRPT3",99,0)
 ; Return Value ->   ptr to #36^Insurance Company Name
"RTN","BPSRPT3",100,0)
 ;                     0 = All Insurances
"RTN","BPSRPT3",101,0)
 ;                     ^ = Exit
"RTN","BPSRPT3",102,0)
 ;
"RTN","BPSRPT3",103,0)
SELINSIN(DFLT) N DIC,DIR,DIRUT,DUOUT,INS,X,Y
"RTN","BPSRPT3",104,0)
 ;
"RTN","BPSRPT3",105,0)
 S DFLT=$S($G(DFLT)=1:"Single Insurance",1:"ALL")
"RTN","BPSRPT3",106,0)
 S DIR(0)="S^I:Single Insurance;A:ALL"
"RTN","BPSRPT3",107,0)
 S DIR("A")="Display Single (I)nsurance Company or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",108,0)
 D ^DIR
"RTN","BPSRPT3",109,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",110,0)
 S INS=$S(Y="I":1,Y="A":0,1:Y)
"RTN","BPSRPT3",111,0)
 ;
"RTN","BPSRPT3",112,0)
 ;Check for "^" or timeout, otherwise define INS
"RTN","BPSRPT3",113,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (INS,Y)="^"
"RTN","BPSRPT3",114,0)
 ;
"RTN","BPSRPT3",115,0)
 ;If single insurance selected, ask prompt
"RTN","BPSRPT3",116,0)
 I $G(INS)=1 D
"RTN","BPSRPT3",117,0)
 .;
"RTN","BPSRPT3",118,0)
 .;Prompt for entry
"RTN","BPSRPT3",119,0)
 .W ! S Y=$$SELINS^BPSRPT6()
"RTN","BPSRPT3",120,0)
 .;
"RTN","BPSRPT3",121,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",122,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (INS,Y)="^" Q
"RTN","BPSRPT3",123,0)
 .;
"RTN","BPSRPT3",124,0)
 .;If valid entry, setup INS
"RTN","BPSRPT3",125,0)
 .I Y'="^" S INS=Y
"RTN","BPSRPT3",126,0)
 ;
"RTN","BPSRPT3",127,0)
 Q INS
"RTN","BPSRPT3",128,0)
 ;
"RTN","BPSRPT3",129,0)
 ; Display (C)MOP or (M)ail or (W)indow or (A)ll
"RTN","BPSRPT3",130,0)
 ; 
"RTN","BPSRPT3",131,0)
 ;    Input Variable -> DFLT = C CMOP
"RTN","BPSRPT3",132,0)
 ;                             W Window
"RTN","BPSRPT3",133,0)
 ;                             M Mail
"RTN","BPSRPT3",134,0)
 ;                             A All
"RTN","BPSRPT3",135,0)
 ;                          
"RTN","BPSRPT3",136,0)
 ;    Return Value ->   C = CMOP
"RTN","BPSRPT3",137,0)
 ;                      W = Window
"RTN","BPSRPT3",138,0)
 ;                      M = Mail
"RTN","BPSRPT3",139,0)
 ;                      A = All
"RTN","BPSRPT3",140,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",141,0)
 ; 
"RTN","BPSRPT3",142,0)
SELMWC(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",143,0)
 S DFLT=$S($G(DFLT)="C":"CMOP",$G(DFLT)="W":"Window",$G(DFLT)="M":"Mail",1:"ALL")
"RTN","BPSRPT3",144,0)
 S DIR(0)="S^C:CMOP;M:Mail;W:Window;A:ALL"
"RTN","BPSRPT3",145,0)
 S DIR("A")="Display (C)MOP or (M)ail or (W)indow or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",146,0)
 D ^DIR
"RTN","BPSRPT3",147,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",148,0)
 Q Y
"RTN","BPSRPT3",149,0)
 ;
"RTN","BPSRPT3",150,0)
 ; Display (R)ealTime Fills or (B)ackbills or (A)LL
"RTN","BPSRPT3",151,0)
 ;
"RTN","BPSRPT3",152,0)
 ;    Input Variable -> DFLT = 3 Backbill
"RTN","BPSRPT3",153,0)
 ;                             2 Real Time Fills
"RTN","BPSRPT3",154,0)
 ;                             1 ALL
"RTN","BPSRPT3",155,0)
 ;                          
"RTN","BPSRPT3",156,0)
 ;    Return Value ->   3 = Backbill (manually)
"RTN","BPSRPT3",157,0)
 ;                      2 = Real Time Fills (automatically during FINISH)
"RTN","BPSRPT3",158,0)
 ;                      1 = ALL
"RTN","BPSRPT3",159,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",160,0)
 ;
"RTN","BPSRPT3",161,0)
SELRTBCK(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",162,0)
 S DFLT=$S($G(DFLT)=2:"Real Time",$G(DFLT)=3:"Backbill",1:"ALL")
"RTN","BPSRPT3",163,0)
 S DIR(0)="S^R:Real Time Fills;B:Backbill;A:ALL"
"RTN","BPSRPT3",164,0)
 S DIR("A")="Display (R)ealTime Fills or (B)ackbills or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",165,0)
 D ^DIR
"RTN","BPSRPT3",166,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",167,0)
 S Y=$S(Y="A":1,Y="R":2,Y="B":3,1:Y)
"RTN","BPSRPT3",168,0)
 Q Y
"RTN","BPSRPT3",169,0)
 ;
"RTN","BPSRPT3",170,0)
 ; Display Specific (D)rug or Drug (C)lass
"RTN","BPSRPT3",171,0)
 ; 
"RTN","BPSRPT3",172,0)
 ;    Input Variable -> DFLT = 3 Drug Class
"RTN","BPSRPT3",173,0)
 ;                             2 Drug
"RTN","BPSRPT3",174,0)
 ;                             1 ALL
"RTN","BPSRPT3",175,0)
 ;                          
"RTN","BPSRPT3",176,0)
 ;     Return Value ->   3 = Drug Class
"RTN","BPSRPT3",177,0)
 ;                       2 = Drug
"RTN","BPSRPT3",178,0)
 ;                       1 = ALL
"RTN","BPSRPT3",179,0)
 ;                       ^ = Exit
"RTN","BPSRPT3",180,0)
 ;                       
"RTN","BPSRPT3",181,0)
SELDRGAL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",182,0)
 S DFLT=$S($G(DFLT)=2:"Drug",$G(DFLT)=3:"Drug Class",1:"ALL")
"RTN","BPSRPT3",183,0)
 S DIR(0)="S^D:Drug;C:Drug Class;A:ALL"
"RTN","BPSRPT3",184,0)
 S DIR("A")="Display Specific (D)rug or Drug (C)lass or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",185,0)
 D ^DIR
"RTN","BPSRPT3",186,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",187,0)
 S Y=$S(Y="A":1,Y="D":2,Y="C":3,1:Y)
"RTN","BPSRPT3",188,0)
 Q Y
"RTN","BPSRPT3",189,0)
 ;
"RTN","BPSRPT3",190,0)
 ; Select Drug
"RTN","BPSRPT3",191,0)
 ; 
"RTN","BPSRPT3",192,0)
 ; Input Variable -> none
"RTN","BPSRPT3",193,0)
 ; 
"RTN","BPSRPT3",194,0)
 ; Return Value -> ptr = pointer to DRUG file (#50)
"RTN","BPSRPT3",195,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",196,0)
 ;                   
"RTN","BPSRPT3",197,0)
SELDRG() N DIC,DIRUT,DUOUT,X,Y
"RTN","BPSRPT3",198,0)
 ;
"RTN","BPSRPT3",199,0)
 ;Prompt for entry
"RTN","BPSRPT3",200,0)
 W ! D SELDRG^BPSRPT6
"RTN","BPSRPT3",201,0)
 ;
"RTN","BPSRPT3",202,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",203,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",204,0)
 ;
"RTN","BPSRPT3",205,0)
 ;Check for Valid Entry
"RTN","BPSRPT3",206,0)
 I +Y>0 S Y=+Y
"RTN","BPSRPT3",207,0)
 ;
"RTN","BPSRPT3",208,0)
 Q Y
"RTN","BPSRPT3",209,0)
 ;
"RTN","BPSRPT3",210,0)
 ; Select Drug Class
"RTN","BPSRPT3",211,0)
 ; 
"RTN","BPSRPT3",212,0)
 ; Input Variable -> none
"RTN","BPSRPT3",213,0)
 ; 
"RTN","BPSRPT3",214,0)
 ; Return Value -> ptr = pointer to VA DRUG CLASS file (#50.605)
"RTN","BPSRPT3",215,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",216,0)
 ;
"RTN","BPSRPT3",217,0)
SELDRGCL() N DIC,DIRUT,DUOUT,Y
"RTN","BPSRPT3",218,0)
 ;
"RTN","BPSRPT3",219,0)
 ;Prompt for entry
"RTN","BPSRPT3",220,0)
 W ! D SELDRGC^BPSRPT6
"RTN","BPSRPT3",221,0)
 ;
"RTN","BPSRPT3",222,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",223,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^"
"RTN","BPSRPT3",224,0)
 ;
"RTN","BPSRPT3",225,0)
 Q Y
"RTN","BPSRPT3",226,0)
 ;
"RTN","BPSRPT3",227,0)
 ; Enter Date Range
"RTN","BPSRPT3",228,0)
 ;
"RTN","BPSRPT3",229,0)
 ; Input Variable -> TYPE = 7 CLOSE REPORT
"RTN","BPSRPT3",230,0)
 ;                          1-6 OTHER REPORTS
"RTN","BPSRPT3",231,0)
 ;
"RTN","BPSRPT3",232,0)
 ; Return Value -> P1^P2
"RTN","BPSRPT3",233,0)
 ; 
"RTN","BPSRPT3",234,0)
 ;           where P1 = From Date
"RTN","BPSRPT3",235,0)
 ;                    = ^ Exit
"RTN","BPSRPT3",236,0)
 ;                 P2 = To Date
"RTN","BPSRPT3",237,0)
 ;                    = blank for Exit
"RTN","BPSRPT3",238,0)
 ;                 
"RTN","BPSRPT3",239,0)
SELDATE(TYPE) N BPSIBDT,DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","BPSRPT3",240,0)
 S TYPE=$S($G(TYPE)=7:"CLOSE",1:"TRANSACTION")
"RTN","BPSRPT3",241,0)
SELDATE1 S VAL="",DIR(0)="DA^:DT:EX",DIR("A")="START WITH "_TYPE_" DATE: ",DIR("B")="T-1"
"RTN","BPSRPT3",242,0)
 W ! D ^DIR
"RTN","BPSRPT3",243,0)
 ;
"RTN","BPSRPT3",244,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",245,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","BPSRPT3",246,0)
 ;
"RTN","BPSRPT3",247,0)
 I VAL="" D
"RTN","BPSRPT3",248,0)
 .S $P(VAL,U)=Y
"RTN","BPSRPT3",249,0)
 .S DIR(0)="DA^"_VAL_":DT:EX",DIR("A")="  GO TO "_TYPE_" DATE: ",DIR("B")="T"
"RTN","BPSRPT3",250,0)
 .D ^DIR
"RTN","BPSRPT3",251,0)
 .;
"RTN","BPSRPT3",252,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",253,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","BPSRPT3",254,0)
 .;
"RTN","BPSRPT3",255,0)
 .;Define Entry
"RTN","BPSRPT3",256,0)
 .S $P(VAL,U,2)=Y
"RTN","BPSRPT3",257,0)
 ;
"RTN","BPSRPT3",258,0)
 Q VAL
"RTN","BPSRPT4")
0^200^B66657579
"RTN","BPSRPT4",1,0)
BPSRPT4 ;BHAM ISC/BEE - ECME REPORTS (CONT) ;14-FEB-05
"RTN","BPSRPT4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSRPT4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT4",4,0)
 ;
"RTN","BPSRPT4",5,0)
 Q
"RTN","BPSRPT4",6,0)
 ;
"RTN","BPSRPT4",7,0)
 ; Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL
"RTN","BPSRPT4",8,0)
 ;
"RTN","BPSRPT4",9,0)
 ;    Input Variable -> DFLT = 3 NOT RELEASED
"RTN","BPSRPT4",10,0)
 ;                             2 RELEASED
"RTN","BPSRPT4",11,0)
 ;                             1 ALL
"RTN","BPSRPT4",12,0)
 ;                          
"RTN","BPSRPT4",13,0)
 ;    Return Value ->   3 = NOT RELEASED
"RTN","BPSRPT4",14,0)
 ;                      2 = RELEASED
"RTN","BPSRPT4",15,0)
 ;                      1 = ALL
"RTN","BPSRPT4",16,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",17,0)
 ;
"RTN","BPSRPT4",18,0)
SELRLNRL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",19,0)
 S DFLT=$S($G(DFLT)=1:"ALL",$G(DFLT)=3:"NOT RELEASED",1:"RELEASED")
"RTN","BPSRPT4",20,0)
 S DIR(0)="S^R:RELEASED;N:NOT RELEASED;A:ALL"
"RTN","BPSRPT4",21,0)
 S DIR("A")="Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",22,0)
 D ^DIR
"RTN","BPSRPT4",23,0)
 ;
"RTN","BPSRPT4",24,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",25,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",26,0)
 ;
"RTN","BPSRPT4",27,0)
 S Y=$S(Y="A":1,Y="R":2,Y="N":3,1:Y)
"RTN","BPSRPT4",28,0)
 ;
"RTN","BPSRPT4",29,0)
 Q Y
"RTN","BPSRPT4",30,0)
 ;
"RTN","BPSRPT4",31,0)
 ; Select to Include (S)pecific Reject Code or (A)ll
"RTN","BPSRPT4",32,0)
 ;
"RTN","BPSRPT4",33,0)
 ; Input Variable -> DFLT = 1 Specific Reject Code
"RTN","BPSRPT4",34,0)
 ;                          0 All Reject Codes
"RTN","BPSRPT4",35,0)
 ;                          
"RTN","BPSRPT4",36,0)
 ; Return Value ->   ptr = pointer to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",37,0)
 ;                     0 = All Reject Codes
"RTN","BPSRPT4",38,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",39,0)
 ;
"RTN","BPSRPT4",40,0)
SELREJCD(DFLT) N DIC,DIR,DIRUT,DUOUT,REJ,X,Y
"RTN","BPSRPT4",41,0)
 ;
"RTN","BPSRPT4",42,0)
 S DFLT=$S($G(DFLT)=1:"Specific Reject Code",1:"ALL")
"RTN","BPSRPT4",43,0)
 S DIR(0)="S^S:Specific Reject Code;A:ALL"
"RTN","BPSRPT4",44,0)
 S DIR("A")="Include (S)pecific Reject Code or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",45,0)
 D ^DIR
"RTN","BPSRPT4",46,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",47,0)
 S REJ=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",48,0)
 ;
"RTN","BPSRPT4",49,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",50,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (REJ,Y)="^"
"RTN","BPSRPT4",51,0)
 ;
"RTN","BPSRPT4",52,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",53,0)
 I $G(REJ)=1 D
"RTN","BPSRPT4",54,0)
 .;
"RTN","BPSRPT4",55,0)
 .;Prompt for entry
"RTN","BPSRPT4",56,0)
 .K X S DIC(0)="QEAM",DIC=9002313.93,DIC("A")="Select Reject Code: "
"RTN","BPSRPT4",57,0)
 .W ! D ^DIC
"RTN","BPSRPT4",58,0)
 .;
"RTN","BPSRPT4",59,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",60,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (REJ,Y)="^" Q
"RTN","BPSRPT4",61,0)
 .;
"RTN","BPSRPT4",62,0)
 .;If valid entry, setup REJ
"RTN","BPSRPT4",63,0)
 .I +Y>0 S REJ=+Y
"RTN","BPSRPT4",64,0)
 ;
"RTN","BPSRPT4",65,0)
 Q REJ
"RTN","BPSRPT4",66,0)
 ;
"RTN","BPSRPT4",67,0)
 ; Include Auto(R)eversed or (A)LL
"RTN","BPSRPT4",68,0)
 ; 
"RTN","BPSRPT4",69,0)
 ;    Input Variable -> DFLT = 1 AutoReversed
"RTN","BPSRPT4",70,0)
 ;                             0 ALL
"RTN","BPSRPT4",71,0)
 ;                          
"RTN","BPSRPT4",72,0)
 ;    Return Value ->   1 = AutoReversed
"RTN","BPSRPT4",73,0)
 ;                      0 = ALL
"RTN","BPSRPT4",74,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",75,0)
 ;
"RTN","BPSRPT4",76,0)
SELAUREV(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",77,0)
 ;
"RTN","BPSRPT4",78,0)
 S DFLT=$S($G(DFLT)=1:"AutoReversed",1:"ALL")
"RTN","BPSRPT4",79,0)
 S DIR(0)="S^R:AutoReversed;A:ALL"
"RTN","BPSRPT4",80,0)
 S DIR("A")="Include Auto(R)eversed or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",81,0)
 D ^DIR
"RTN","BPSRPT4",82,0)
 ;
"RTN","BPSRPT4",83,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",84,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",85,0)
 ;
"RTN","BPSRPT4",86,0)
 S Y=$S(Y="A":0,Y="R":1,1:Y)
"RTN","BPSRPT4",87,0)
 ;
"RTN","BPSRPT4",88,0)
 Q Y
"RTN","BPSRPT4",89,0)
 ;
"RTN","BPSRPT4",90,0)
 ; Include A(C)cepted or (R)ejected or (A)LL
"RTN","BPSRPT4",91,0)
 ; 
"RTN","BPSRPT4",92,0)
 ;    Input Variable -> DFLT = 2 Accepted
"RTN","BPSRPT4",93,0)
 ;                             1 Rejected
"RTN","BPSRPT4",94,0)
 ;                             0 ALL
"RTN","BPSRPT4",95,0)
 ;                          
"RTN","BPSRPT4",96,0)
 ;    Return Value ->   2 = Accepted
"RTN","BPSRPT4",97,0)
 ;                      1 = Rejected
"RTN","BPSRPT4",98,0)
 ;                      0 = ALL
"RTN","BPSRPT4",99,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",100,0)
 ;
"RTN","BPSRPT4",101,0)
SELACREJ(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",102,0)
 ;
"RTN","BPSRPT4",103,0)
 S DFLT=$S($G(DFLT)=2:"Accepted",$G(DFLT)=1:"Rejected",1:"ALL")
"RTN","BPSRPT4",104,0)
 S DIR(0)="S^C:Accepted;R:Rejected;A:ALL"
"RTN","BPSRPT4",105,0)
 S DIR("A")="Include A(C)cepted or (R)ejected or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",106,0)
 D ^DIR
"RTN","BPSRPT4",107,0)
 ;
"RTN","BPSRPT4",108,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",109,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",110,0)
 ;
"RTN","BPSRPT4",111,0)
 S Y=$S(Y="C":2,Y="R":1,Y="A":0,1:Y)
"RTN","BPSRPT4",112,0)
 ;
"RTN","BPSRPT4",113,0)
 Q Y
"RTN","BPSRPT4",114,0)
 ;
"RTN","BPSRPT4",115,0)
 ; Select to Include (S)pecific Close Claim Reason or (A)ll
"RTN","BPSRPT4",116,0)
 ;
"RTN","BPSRPT4",117,0)
 ; Input Variable -> DFLT = 1 Specific CLAIMS TRACKING NON-BILLABLE REASONS
"RTN","BPSRPT4",118,0)
 ;                          0 All Reasons
"RTN","BPSRPT4",119,0)
 ;                          
"RTN","BPSRPT4",120,0)
 ; Return Value ->   ptr = pointer to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT4",121,0)
 ;                     0 = All Reasons
"RTN","BPSRPT4",122,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",123,0)
 ;
"RTN","BPSRPT4",124,0)
SELCCRSN(DFLT) N DIC,DIR,DIRUT,DUOUT,RSN,X,Y
"RTN","BPSRPT4",125,0)
 ;
"RTN","BPSRPT4",126,0)
 S DFLT=$S($G(DFLT)=1:"Specific Close Claim Reason",1:"ALL")
"RTN","BPSRPT4",127,0)
 S DIR(0)="S^S:Specific Close Claim Reason;A:ALL"
"RTN","BPSRPT4",128,0)
 S DIR("A")="Include (S)pecific Close Claim Reason or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",129,0)
 D ^DIR
"RTN","BPSRPT4",130,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",131,0)
 S RSN=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",132,0)
 ;
"RTN","BPSRPT4",133,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",134,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (RSN,Y)="^"
"RTN","BPSRPT4",135,0)
 ;
"RTN","BPSRPT4",136,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",137,0)
 I $G(RSN)=1 D
"RTN","BPSRPT4",138,0)
 .;
"RTN","BPSRPT4",139,0)
 .;Prompt for entry
"RTN","BPSRPT4",140,0)
 .K X S DIC(0)="QEAM",DIC=356.8,DIC("A")="Select Close Claim Reason: "
"RTN","BPSRPT4",141,0)
 .W ! D ^DIC
"RTN","BPSRPT4",142,0)
 .;
"RTN","BPSRPT4",143,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",144,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (RSN,Y)="^" Q
"RTN","BPSRPT4",145,0)
 .;
"RTN","BPSRPT4",146,0)
 .;If valid entry, setup RSN
"RTN","BPSRPT4",147,0)
 .I +Y>0 S RSN=+Y
"RTN","BPSRPT4",148,0)
 ;
"RTN","BPSRPT4",149,0)
 Q RSN
"RTN","BPSRPT4",150,0)
 ;
"RTN","BPSRPT4",151,0)
 ;Pull Selected BPS Pharmacies for Display
"RTN","BPSRPT4",152,0)
 ;
"RTN","BPSRPT4",153,0)
 ;  Input Variables: 
"RTN","BPSRPT4",154,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array of internal
"RTN","BPSRPT4",155,0)
 ;                         pointers of selected pharmacies       
"RTN","BPSRPT4",156,0)
 ;                       - BPLEN = The length of the display field
"RTN","BPSRPT4",157,0)
 ;  Returned value -> List of selected BPS Pharmacies (possibly cut short)                 
"RTN","BPSRPT4",158,0)
 ; 
"RTN","BPSRPT4",159,0)
GETDIVS(BPLEN,BPPHARM) N BPDIV,BPSTR,BPQUIT
"RTN","BPSRPT4",160,0)
 I $G(BPPHARM)=0 S BPSTR="ALL"
"RTN","BPSRPT4",161,0)
 E  D
"RTN","BPSRPT4",162,0)
 .S BPDIV="",BPQUIT=0,BPSTR=""
"RTN","BPSRPT4",163,0)
 .F  S BPDIV=$O(BPPHARM(BPDIV)) Q:+BPDIV=0  D  Q:BPQUIT=1
"RTN","BPSRPT4",164,0)
 .. I $L(BPSTR_$$DIVNAME^BPSSCRDS(BPDIV))>(BPLEN-4) D  S BPQUIT=1 Q
"RTN","BPSRPT4",165,0)
 ... S BPSTR=$$LJ^BPSSCR02(BPSTR_",...",BPLEN)
"RTN","BPSRPT4",166,0)
 .. S BPSTR=BPSTR_$S(BPSTR]"":", ",1:"")_$$DIVNAME^BPSSCRDS(BPDIV)
"RTN","BPSRPT4",167,0)
 Q BPSTR
"RTN","BPSRPT4",168,0)
 ;
"RTN","BPSRPT4",169,0)
 ;Get the Reject Code
"RTN","BPSRPT4",170,0)
 ;
"RTN","BPSRPT4",171,0)
 ; Input variable -> 0 for All Reject Codes or
"RTN","BPSRPT4",172,0)
 ;                   lookup to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",173,0)
 ; Returned value -> ALL or the selected Reject Code
"RTN","BPSRPT4",174,0)
 ; 
"RTN","BPSRPT4",175,0)
GETREJ(REJ) ;
"RTN","BPSRPT4",176,0)
 I REJ="0" S REJ="ALL"
"RTN","BPSRPT4",177,0)
 E  S REJ=$P($G(^BPSF(9002313.93,+REJ,0)),U,2)
"RTN","BPSRPT4",178,0)
 Q REJ
"RTN","BPSRPT4",179,0)
 ;
"RTN","BPSRPT4",180,0)
 ;Print Header 2 Line 1
"RTN","BPSRPT4",181,0)
 ;
"RTN","BPSRPT4",182,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",183,0)
 ;
"RTN","BPSRPT4",184,0)
HEADLN1(BPRTYPE) ;
"RTN","BPSRPT4",185,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W !,"PATIENT NAME",?27,"Pt.ID",?35,"RX#",?47,"REF/ECME#"
"RTN","BPSRPT4",186,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",187,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",188,0)
 . W ?78,$J("$BILLED",10)
"RTN","BPSRPT4",189,0)
 . W ?97,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",190,0)
 . W ?122,$J("$COLLECT",10)
"RTN","BPSRPT4",191,0)
 ;
"RTN","BPSRPT4",192,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",193,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",194,0)
 . W ?78,"RELEASED ON"
"RTN","BPSRPT4",195,0)
 . W ?91,"RX INFO"
"RTN","BPSRPT4",196,0)
 ;
"RTN","BPSRPT4",197,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",198,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",199,0)
 . W ?100,$J("$BILLED",10)
"RTN","BPSRPT4",200,0)
 . W ?119,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",201,0)
 ;
"RTN","BPSRPT4",202,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",203,0)
 . W ?60,"COMPLETED"
"RTN","BPSRPT4",204,0)
 . W ?78,"TRANS TYPE"
"RTN","BPSRPT4",205,0)
 . W ?95,"PAYER RESPONSE"
"RTN","BPSRPT4",206,0)
 ;
"RTN","BPSRPT4",207,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",208,0)
 . W !,?33,$J("AMOUNT",17)
"RTN","BPSRPT4",209,0)
 . W ?51,$J("RETURNED",17)
"RTN","BPSRPT4",210,0)
 . W ?69,$J("RETURNED",17)
"RTN","BPSRPT4",211,0)
 . W ?87,$J("AMOUNT",17)
"RTN","BPSRPT4",212,0)
 ;
"RTN","BPSRPT4",213,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",214,0)
 . W ?65,"RX INFO"
"RTN","BPSRPT4",215,0)
 . W ?87,"DRUG"
"RTN","BPSRPT4",216,0)
 . W ?121,"NDC"
"RTN","BPSRPT4",217,0)
 Q
"RTN","BPSRPT4",218,0)
 ;
"RTN","BPSRPT4",219,0)
 ;Print Header 2 Line 2
"RTN","BPSRPT4",220,0)
 ;
"RTN","BPSRPT4",221,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",222,0)
 ; 
"RTN","BPSRPT4",223,0)
HEADLN2(BPRTYPE) ;
"RTN","BPSRPT4",224,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",225,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",226,0)
 . W ?36,"NDC"
"RTN","BPSRPT4",227,0)
 . I BPRTYPE=1 W ?47,"RELEASED ON"
"RTN","BPSRPT4",228,0)
 . W ?68,"RX INFO"
"RTN","BPSRPT4",229,0)
 . I BPRTYPE=1 W ?122,$J("BILL#",10)
"RTN","BPSRPT4",230,0)
 ;
"RTN","BPSRPT4",231,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",232,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",233,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",234,0)
 . W ?41,$J("$BILLED",10)
"RTN","BPSRPT4",235,0)
 . W ?54,"QTY"
"RTN","BPSRPT4",236,0)
 . W ?61,"NDC#"
"RTN","BPSRPT4",237,0)
 . W ?82,"DRUG"
"RTN","BPSRPT4",238,0)
 ;
"RTN","BPSRPT4",239,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",240,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",241,0)
 . W ?43,"NDC"
"RTN","BPSRPT4",242,0)
 . W ?68,"RX INFO"
"RTN","BPSRPT4",243,0)
 ;
"RTN","BPSRPT4",244,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",245,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",246,0)
 . W ?32,"NDC"
"RTN","BPSRPT4",247,0)
 . W ?47,"RX INFO"
"RTN","BPSRPT4",248,0)
 . W ?69,"INSURANCE"
"RTN","BPSRPT4",249,0)
 . W ?112,"ELAP TIME IN SECONDS"
"RTN","BPSRPT4",250,0)
 ;
"RTN","BPSRPT4",251,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",252,0)
 .W !,?1,"DATE"
"RTN","BPSRPT4",253,0)
 .W ?15,$J("#CLAIMS",17)
"RTN","BPSRPT4",254,0)
 .W ?33,$J("SUBMITTED",17)
"RTN","BPSRPT4",255,0)
 .W ?51,$J("REJECTED",17)
"RTN","BPSRPT4",256,0)
 .W ?69,$J("PAYABLE",17)
"RTN","BPSRPT4",257,0)
 .W ?87,$J("TO RECEIVE",17)
"RTN","BPSRPT4",258,0)
 .W ?115,$J("DIFFERENCE",17)
"RTN","BPSRPT4",259,0)
 ;
"RTN","BPSRPT4",260,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",261,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",262,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",263,0)
 . W ?41,"CLOSE DATE/TIME"
"RTN","BPSRPT4",264,0)
 . W ?59,"CLOSED BY"
"RTN","BPSRPT4",265,0)
 . W ?87,"CLOSE REASON"
"RTN","BPSRPT4",266,0)
 Q
"RTN","BPSRPT4",267,0)
 ;
"RTN","BPSRPT4",268,0)
 ;Print Header 2 Line 3
"RTN","BPSRPT4",269,0)
 ;
"RTN","BPSRPT4",270,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",271,0)
 ; 
"RTN","BPSRPT4",272,0)
HEADLN3(BPTYP) ;
"RTN","BPSRPT4",273,0)
 D:BPTYP=4
"RTN","BPSRPT4",274,0)
 . W !,?6,"RELEASED ON"
"RTN","BPSRPT4",275,0)
 . W ?22,"REVERSAL METHOD/RETURN STATUS/REASON"
"RTN","BPSRPT4",276,0)
 Q
"RTN","BPSRPT4",277,0)
 ;
"RTN","BPSRPT4",278,0)
SELEXCEL() ; - Returns whether to capture data for Excel report.
"RTN","BPSRPT4",279,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","BPSRPT4",280,0)
 ;
"RTN","BPSRPT4",281,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","BPSRPT4",282,0)
 ;
"RTN","BPSRPT4",283,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","BPSRPT4",284,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","BPSRPT4",285,0)
 S DIR("?")="^D HEXC^BPSRPT4"
"RTN","BPSRPT4",286,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","BPSRPT4",287,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","BPSRPT4",288,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","BPSRPT4",289,0)
 ;
"RTN","BPSRPT4",290,0)
 ;Display Excel display message
"RTN","BPSRPT4",291,0)
 I EXCEL=1 D EXMSG
"RTN","BPSRPT4",292,0)
 ;
"RTN","BPSRPT4",293,0)
 Q EXCEL
"RTN","BPSRPT4",294,0)
 ;
"RTN","BPSRPT4",295,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","BPSRPT4",296,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","BPSRPT4",297,0)
 W !,"                        to an Excel document"
"RTN","BPSRPT4",298,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","BPSRPT4",299,0)
 W !,"              '^'    -  To quit this option"
"RTN","BPSRPT4",300,0)
 Q
"RTN","BPSRPT4",301,0)
 ;
"RTN","BPSRPT4",302,0)
 ;Display the message about capturing to an Excel file format
"RTN","BPSRPT4",303,0)
 ; 
"RTN","BPSRPT4",304,0)
EXMSG ;
"RTN","BPSRPT4",305,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","BPSRPT4",306,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","BPSRPT4",307,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","BPSRPT4",308,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","BPSRPT4",309,0)
 W !?5,"while to run."
"RTN","BPSRPT4",310,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","BPSRPT4",311,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","BPSRPT4",312,0)
 Q
"RTN","BPSRPT5")
0^22^B83699658
"RTN","BPSRPT5",1,0)
BPSRPT5 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT5",4,0)
 ;
"RTN","BPSRPT5",5,0)
 Q
"RTN","BPSRPT5",6,0)
 ;
"RTN","BPSRPT5",7,0)
 ;Routine to Display the Reports
"RTN","BPSRPT5",8,0)
 ;
"RTN","BPSRPT5",9,0)
 ;Print Report Line 1
"RTN","BPSRPT5",10,0)
 ;
"RTN","BPSRPT5",11,0)
 ; Input Variables -> BPRTYPE,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS
"RTN","BPSRPT5",12,0)
 ;                    BPCOLL,BPEXCEL
"RTN","BPSRPT5",13,0)
 ; 
"RTN","BPSRPT5",14,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL) ;
"RTN","BPSRPT5",15,0)
 ;
"RTN","BPSRPT5",16,0)
 ;Excel Output
"RTN","BPSRPT5",17,0)
 I $G(BPEXCEL) D WRLINE1^BPSRPT8(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) Q
"RTN","BPSRPT5",18,0)
 ;
"RTN","BPSRPT5",19,0)
 ;Report Output
"RTN","BPSRPT5",20,0)
 ;
"RTN","BPSRPT5",21,0)
 W !,$$PATNAME^BPSRPT6(BPDFN)
"RTN","BPSRPT5",22,0)
 W ?27,"("_$$SSN4^BPSRPT6(BPDFN)_")"
"RTN","BPSRPT5",23,0)
 W ?35,$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)
"RTN","BPSRPT5",24,0)
 W ?47,BPREF,"/",$$ECMENUM^BPSRPT1($P(BPX,U,3))
"RTN","BPSRPT5",25,0)
 ;
"RTN","BPSRPT5",26,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",27,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",28,0)
 . W ?78,$J(BPBIL,10,2),?100,$J(BPINS,10,2),?122,$S(BPCOLL]"":$J(BPCOLL,10,2),1:"")
"RTN","BPSRPT5",29,0)
 ;
"RTN","BPSRPT5",30,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",31,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",32,0)
 . W ?78,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",33,0)
 . W ?91,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",34,0)
 . W ?94,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",35,0)
 . W ?98,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",36,0)
 . W ?101,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",37,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",38,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",39,0)
 . W ?100,$J(BPBIL,10,2),?122,$J(BPINS,10,2)
"RTN","BPSRPT5",40,0)
 ;
"RTN","BPSRPT5",41,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",42,0)
 . W ?60,$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))
"RTN","BPSRPT5",43,0)
 . W ?78,$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",44,0)
 . W ?95,$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",45,0)
 ;
"RTN","BPSRPT5",46,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",47,0)
 . W ?65,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",48,0)
 . W ?68,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",49,0)
 . W ?72,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",50,0)
 . W ?75,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",51,0)
 . W ?79,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",52,0)
 . W ?87,$$DRGNAM^BPSRPT6($P(BPX,U,14),30)
"RTN","BPSRPT5",53,0)
 . W ?118,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",54,0)
 Q
"RTN","BPSRPT5",55,0)
 ;
"RTN","BPSRPT5",56,0)
 ;Print Report Line 2
"RTN","BPSRPT5",57,0)
 ;
"RTN","BPSRPT5",58,0)
 ; Input Variables -> BPRTYPE,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL
"RTN","BPSRPT5",59,0)
 ; 
"RTN","BPSRPT5",60,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL,BPICNT) ;
"RTN","BPSRPT5",61,0)
 ;
"RTN","BPSRPT5",62,0)
 ;Excel Output
"RTN","BPSRPT5",63,0)
 I $G(BPEXCEL) D WRLINE2^BPSRPT8(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) Q
"RTN","BPSRPT5",64,0)
 ;
"RTN","BPSRPT5",65,0)
 ;Report Output
"RTN","BPSRPT5",66,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",67,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),27),?32,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",68,0)
 . I BPRTYPE=1 W ?47,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",69,0)
 . W ?68,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",70,0)
 . W ?71,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",71,0)
 . W ?75,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",72,0)
 . W ?78,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",73,0)
 . W ?82,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",74,0)
 . I BPRTYPE=1 W ?122,$J($$BILL^BPSRPT6(BPRX,BPREF),10)
"RTN","BPSRPT5",75,0)
 ;
"RTN","BPSRPT5",76,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",77,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",78,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",79,0)
 . W ?41,$J(BPBIL,10,2)
"RTN","BPSRPT5",80,0)
 . W ?54,$$QTY^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",81,0)
 . W ?61,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",82,0)
 . W ?82,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",83,0)
 ;
"RTN","BPSRPT5",84,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",85,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",86,0)
 . W ?41,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",87,0)
 . W ?68,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",88,0)
 . W ?71,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",89,0)
 . W ?74,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",90,0)
 . W ?77,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",91,0)
 . W ?81,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",92,0)
 ;
"RTN","BPSRPT5",93,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",94,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),23)
"RTN","BPSRPT5",95,0)
 . W ?28,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",96,0)
 . W ?47,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",97,0)
 . W ?50,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",98,0)
 . W ?53,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",99,0)
 . W ?56,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",100,0)
 . W ?60,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",101,0)
 . I $P(BPGRPLAN,U,2)]"" W ?69,$E($P(BPGRPLAN,U,2),1,30)
"RTN","BPSRPT5",102,0)
 . W ?122,$J($$ELAPSE^BPSRPT6($P(BPX,U,3)),10)
"RTN","BPSRPT5",103,0)
 ;
"RTN","BPSRPT5",104,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",105,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",106,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",107,0)
 . W ?41,$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))
"RTN","BPSRPT5",108,0)
 . N BPCLBY S BPCLBY=$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25) S:BPCLBY="" BPCLBY="BLANK"
"RTN","BPSRPT5",109,0)
 . W ?59,BPCLBY S BPCNT(BPCLBY)=$G(BPCNT(BPCLBY))+1,BPGCNT(BPCLBY)=$G(BPGCNT(BPCLBY))+1,BPICNT(BPCLBY)=$G(BPICNT(BPCLBY))+1
"RTN","BPSRPT5",110,0)
 . W ?87,$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)
"RTN","BPSRPT5",111,0)
 Q
"RTN","BPSRPT5",112,0)
 ;
"RTN","BPSRPT5",113,0)
 ;Print Report Line 3
"RTN","BPSRPT5",114,0)
 ;
"RTN","BPSRPT5",115,0)
 ; Input Variables -> BPRTYPE,BPX,BPEXCEL
"RTN","BPSRPT5",116,0)
 ; 
"RTN","BPSRPT5",117,0)
WRLINE3(BPRTYPE,BPREC,BPX,BPEXCEL) N BP59
"RTN","BPSRPT5",118,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT5",119,0)
 ;
"RTN","BPSRPT5",120,0)
 ;Excel Output
"RTN","BPSRPT5",121,0)
 I $G(BPEXCEL) D WRLINE3^BPSRPT8(BPRTYPE,.BPREC,BPX) Q
"RTN","BPSRPT5",122,0)
 ;
"RTN","BPSRPT5",123,0)
 ;Report Output
"RTN","BPSRPT5",124,0)
 I BPRTYPE=4 D
"RTN","BPSRPT5",125,0)
 . S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",126,0)
 . ;Released On
"RTN","BPSRPT5",127,0)
 . W !,?6,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",128,0)
 . ;Method
"RTN","BPSRPT5",129,0)
 . I $$AUTOREV^BPSRPT1(BP59) W ?22,"AUTO/"
"RTN","BPSRPT5",130,0)
 . E  W ?22,"REGULAR/"
"RTN","BPSRPT5",131,0)
 . ;Return Status
"RTN","BPSRPT5",132,0)
 . I $P(BPX,U,15)["ACCEPTED" W "ACCEPTED/"
"RTN","BPSRPT5",133,0)
 . E  W "REJECTED/"
"RTN","BPSRPT5",134,0)
 . ;Reason
"RTN","BPSRPT5",135,0)
 . W $$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT5",136,0)
 ;
"RTN","BPSRPT5",137,0)
 Q
"RTN","BPSRPT5",138,0)
 ;
"RTN","BPSRPT5",139,0)
 ;Display the Report
"RTN","BPSRPT5",140,0)
 ;
"RTN","BPSRPT5",141,0)
 ; Input Variables -> REF,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE
"RTN","BPSRPT5",142,0)
 ;
"RTN","BPSRPT5",143,0)
REPORT(REF,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE) N BPBIL,BPBLINE,BPCOLL,BPDFN,BPDIV,BPELTM,BPGELTM,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGRPLAN,BPINS,BPLINES,BPREC,BPREF,BPRX,BPSRTDT,BPSTATUS,BPTBIL,BPTCOLL,BPTINS,BPX,BPSGTOT,NP,BPSDATA
"RTN","BPSRPT5",144,0)
 I '$D(@REF) D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) W !,"No data meets the criteria." G XREPORT
"RTN","BPSRPT5",145,0)
 S (BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM)=0
"RTN","BPSRPT5",146,0)
 S BPDIV="" F  S BPDIV=$O(@REF@(BPDIV)) Q:BPDIV=""  D  Q:BPQ
"RTN","BPSRPT5",147,0)
 .S BPGRPLAN=0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE)
"RTN","BPSRPT5",148,0)
 .N BPCNT S (BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM)=0
"RTN","BPSRPT5",149,0)
 .F  S BPGRPLAN=$O(@REF@(BPDIV,BPGRPLAN)) Q:BPGRPLAN=""  D  Q:BPQ
"RTN","BPSRPT5",150,0)
 .. I BPSUMDET=0 D WRPLAN(BPGRPLAN) Q:BPQ
"RTN","BPSRPT5",151,0)
 .. S BPBLINE=""  ;Reset Blank Line Indicator
"RTN","BPSRPT5",152,0)
 .. N BPSCLM,BPREC,BPTOT,BPIBIL,BPICNT,BPICOL,BPIINS
"RTN","BPSRPT5",153,0)
 .. S (BPIBIL,BPICNT,BPICOL,BPIINS)=0
"RTN","BPSRPT5",154,0)
 .. S BPDFN="" F  S BPDFN=$O(@REF@(BPDIV,BPGRPLAN,BPDFN)) Q:BPDFN=""  D  Q:BPQ
"RTN","BPSRPT5",155,0)
 ... S BPSRTDT="" F  S BPSRTDT=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT)) Q:BPSRTDT=""  D  Q:BPQ
"RTN","BPSRPT5",156,0)
 .... S BPRX="" F  S BPRX=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX)) Q:BPRX=""  D  Q:BPQ
"RTN","BPSRPT5",157,0)
 ..... S BPREF="" F  S BPREF=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)) Q:BPREF=""  D  Q:BPQ
"RTN","BPSRPT5",158,0)
 ...... S BPX=@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)
"RTN","BPSRPT5",159,0)
 ...... S BPCNT=BPCNT+1,BPGCNT=BPGCNT+1,BPICNT=BPICNT+1
"RTN","BPSRPT5",160,0)
 ...... I BPRTYPE=5 D
"RTN","BPSRPT5",161,0)
 ....... S BPELTM=BPELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",162,0)
 ....... S BPGELTM=BPGELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",163,0)
 ...... S BPBIL=$$BILLED^BPSRPT7($P(BPX,U,3)),BPTBIL=BPTBIL+BPBIL,BPGBIL=BPGBIL+BPBIL,BPIBIL=BPIBIL+BPBIL
"RTN","BPSRPT5",164,0)
 ...... S BPINS=$$INSPAID^BPSRPT2($P(BPX,U,3)),BPTINS=BPTINS+BPINS,BPGINS=BPGINS+BPINS,BPIINS=BPIINS+BPINS
"RTN","BPSRPT5",165,0)
 ...... S BPCOLL=$$COLLECTD^BPSRPT6(BPRX,BPREF),BPTCOLL=BPTCOLL+BPCOLL,BPGCOLL=BPGCOLL+BPCOLL,BPICOL=BPICOL+BPCOLL
"RTN","BPSRPT5",166,0)
 ...... I BPRTYPE=6 D  Q
"RTN","BPSRPT5",167,0)
 .......S BPSTATUS=$P(BPX,U,7)
"RTN","BPSRPT5",168,0)
 .......I BPSTATUS["REJECT" S $P(BPSCLM(BPSRTDT),U,3)=$P($G(BPSCLM(BPSRTDT)),U,3)+BPBIL
"RTN","BPSRPT5",169,0)
 .......I BPSTATUS["PAYABLE" S $P(BPSCLM(BPSRTDT),U,4)=$P($G(BPSCLM(BPSRTDT)),U,4)+BPBIL
"RTN","BPSRPT5",170,0)
 .......S $P(BPSCLM(BPSRTDT),U,2)=$P($G(BPSCLM(BPSRTDT)),U,2)+BPBIL
"RTN","BPSRPT5",171,0)
 .......S $P(BPSCLM(BPSRTDT),U,5)=$P($G(BPSCLM(BPSRTDT)),U,5)+BPINS
"RTN","BPSRPT5",172,0)
 .......S $P(BPSCLM(BPSRTDT),U)=$P($G(BPSCLM(BPSRTDT)),U)+1
"RTN","BPSRPT5",173,0)
 ...... ;
"RTN","BPSRPT5",174,0)
 ...... ;Display Detail Section
"RTN","BPSRPT5",175,0)
 ...... Q:BPSUMDET=1
"RTN","BPSRPT5",176,0)
 ...... S BPREC=""  ;Reset Excel Display Variable
"RTN","BPSRPT5",177,0)
 ...... I 'BPEXCEL,BPRTYPE=1,BPBLINE=1 S NP=$$CHKP(2) Q:BPQ  I BPBLINE=1 W !  ;Print blank line
"RTN","BPSRPT5",178,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE1(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL)
"RTN","BPSRPT5",179,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE2(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL,.BPICNT)
"RTN","BPSRPT5",180,0)
 ...... D WRLINE3(BPRTYPE,.BPREC,BPX,BPEXCEL)
"RTN","BPSRPT5",181,0)
 ...... I (",2,7,")[BPRTYPE,'BPEXCEL D  Q:BPQ
"RTN","BPSRPT5",182,0)
 ....... D COMMENT(+$P(BPX,U,3)) Q:BPQ
"RTN","BPSRPT5",183,0)
 ....... S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",184,0)
 ....... W !,?10,"Claim ID: ",$$CLAIMID^BPSRPT2(+$P(BPX,U,3))
"RTN","BPSRPT5",185,0)
 ....... N BPSARR,BPRJCNT,BPZZ S BPRJCNT=$$REJTEXT^BPSRPT2(+$P(BPX,U,3),.BPSARR)
"RTN","BPSRPT5",186,0)
 ....... F BPZZ=1:1:BPRJCNT S NP=$$CHKP(1) Q:BPQ  W !,?10,BPSARR(BPZZ) Q:BPQ
"RTN","BPSRPT5",187,0)
 ...... I 'BPEXCEL,BPRTYPE=1 S BPBLINE=1  ;Set Blank Line Display Indicator
"RTN","BPSRPT5",188,0)
 .. I BPRTYPE=6 D PTBDT^BPSRPT7(BPDIV,BPSUMDET,.BPSCLM,.BPSGTOT)
"RTN","BPSRPT5",189,0)
 .. I 'BPQ,(",1,2,3,4,7,")[BPRTYPE,'BPEXCEL S NP=$$CHKP(5) Q:BPQ  D ITOT^BPSRPT8(BPRTYPE,BPDIV,BPGRPLAN,BPIBIL,BPIINS,BPICOL,.BPICNT)
"RTN","BPSRPT5",190,0)
 .I 'BPEXCEL,'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D TOTALS^BPSRPT7(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,.BPCNT,BPELTM)
"RTN","BPSRPT5",191,0)
 .I 'BPEXCEL,'BPQ,$O(@REF@(BPDIV))]"" D:$G(BPSCR) PAUSE^BPSRPT1 Q:BPQ
"RTN","BPSRPT5",192,0)
 ;
"RTN","BPSRPT5",193,0)
 ;Print Grand Totals
"RTN","BPSRPT5",194,0)
 I 'BPEXCEL D
"RTN","BPSRPT5",195,0)
 .I 'BPQ,BPRTYPE=6 D PGTOT6^BPSRPT7($G(BPSGTOT))
"RTN","BPSRPT5",196,0)
 .I 'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D PGTOT^BPSRPT7(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,.BPGCNT,BPGELTM)
"RTN","BPSRPT5",197,0)
 ;
"RTN","BPSRPT5",198,0)
XREPORT Q
"RTN","BPSRPT5",199,0)
 ;
"RTN","BPSRPT5",200,0)
 ;Display Comments
"RTN","BPSRPT5",201,0)
 ; 
"RTN","BPSRPT5",202,0)
 ;Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT5",203,0)
 ;
"RTN","BPSRPT5",204,0)
COMMENT(BP59) N CNODE,I,J,NP
"RTN","BPSRPT5",205,0)
 S I="" F  S I=$O(^BPST(BP59,11,"B",I),-1) Q:'I  D  Q:BPQ
"RTN","BPSRPT5",206,0)
 .S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",207,0)
 .S J=$O(^BPST(BP59,11,"B",I,"")) Q:J=""
"RTN","BPSRPT5",208,0)
 .S CNODE=$G(^BPST(BP59,11,J,0))
"RTN","BPSRPT5",209,0)
 .W !,?10,$$DATTIM^BPSRPT1(+$P($P(CNODE,U),"."))," - ",$P(CNODE,U,3)
"RTN","BPSRPT5",210,0)
 Q
"RTN","BPSRPT5",211,0)
 ;
"RTN","BPSRPT5",212,0)
 ;Display the Insurance
"RTN","BPSRPT5",213,0)
 ;
"RTN","BPSRPT5",214,0)
 ; Input Variable -> BPSDATA -> if 0, skip page check
"RTN","BPSRPT5",215,0)
 ;                   BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",216,0)
 ;
"RTN","BPSRPT5",217,0)
WRPLAN(BPGRPLAN) N INS,NP
"RTN","BPSRPT5",218,0)
 ;
"RTN","BPSRPT5",219,0)
 I BPSUMDET'=0 Q
"RTN","BPSRPT5",220,0)
 I BPEXCEL Q
"RTN","BPSRPT5",221,0)
 ;
"RTN","BPSRPT5",222,0)
 ;Skip for Recent Transactions and Totals by Date Reports
"RTN","BPSRPT5",223,0)
 I BPRTYPE=5!(BPRTYPE=6) Q
"RTN","BPSRPT5",224,0)
 ;
"RTN","BPSRPT5",225,0)
 I $G(BPSDATA) S NP=$$CHKP(5) Q:BPQ!NP
"RTN","BPSRPT5",226,0)
 ;
"RTN","BPSRPT5",227,0)
 ;Get and display the Insurance Name
"RTN","BPSRPT5",228,0)
 S INS=$E(BPGRPLAN,1,90)
"RTN","BPSRPT5",229,0)
 I INS]"" D
"RTN","BPSRPT5",230,0)
 .D ULINE("-")
"RTN","BPSRPT5",231,0)
 .W !,INS
"RTN","BPSRPT5",232,0)
 .D ULINE("-")
"RTN","BPSRPT5",233,0)
 Q
"RTN","BPSRPT5",234,0)
 ;
"RTN","BPSRPT5",235,0)
 ;Check for End of Page
"RTN","BPSRPT5",236,0)
 ;
"RTN","BPSRPT5",237,0)
 ; Input variables -> BPLINES -> Number of lines from bottom
"RTN","BPSRPT5",238,0)
 ;                    BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",239,0)
 ; Output variable -> BPSDATA -> 0 -> New screen, no data displayed yet
"RTN","BPSRPT5",240,0)
 ;                               1 -> Data displayed on current screen
"RTN","BPSRPT5",241,0)
 ; 
"RTN","BPSRPT5",242,0)
CHKP(BPLINES) Q:$G(BPEXCEL) 0
"RTN","BPSRPT5",243,0)
 S BPLINES=BPLINES+1
"RTN","BPSRPT5",244,0)
 I $G(BPSCR) S BPLINES=BPLINES+2
"RTN","BPSRPT5",245,0)
 I $G(BPSCR),'$G(BPSDATA) S BPSDATA=1 Q 0
"RTN","BPSRPT5",246,0)
 S BPSDATA=1
"RTN","BPSRPT5",247,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE^BPSRPT1 Q:$G(BPQ) 0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) Q 1
"RTN","BPSRPT5",248,0)
 Q 0
"RTN","BPSRPT5",249,0)
 ;
"RTN","BPSRPT5",250,0)
 ;Print one line of characters
"RTN","BPSRPT5",251,0)
 ;
"RTN","BPSRPT5",252,0)
ULINE(X) N I
"RTN","BPSRPT5",253,0)
 W ! F I=1:1:132 W $G(X,"-")
"RTN","BPSRPT5",254,0)
 Q
"RTN","BPSRPT6")
0^23^B58276933
"RTN","BPSRPT6",1,0)
BPSRPT6 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT6",4,0)
 ;
"RTN","BPSRPT6",5,0)
 Q
"RTN","BPSRPT6",6,0)
 ;
"RTN","BPSRPT6",7,0)
 ;Get the Insurance Company pointer and name
"RTN","BPSRPT6",8,0)
 ;
"RTN","BPSRPT6",9,0)
 ; Returned Value -> ptr^Insurance Company Name
"RTN","BPSRPT6",10,0)
 ; 
"RTN","BPSRPT6",11,0)
INSNAM(BP59) N BPIN,BPDOS,BPDFN,BPSZZ,BP36,BPX
"RTN","BPSRPT6",12,0)
 ;
"RTN","BPSRPT6",13,0)
 ;Reset Insurance
"RTN","BPSRPT6",14,0)
 S BP36=""
"RTN","BPSRPT6",15,0)
 ;
"RTN","BPSRPT6",16,0)
 ;First Pull From BPS Transactions
"RTN","BPSRPT6",17,0)
 S BPIN=+$P($G(^BPST(BP59,9)),U)
"RTN","BPSRPT6",18,0)
 I +BPIN S BP36=$P($G(^BPST(BP59,10,BPIN,0)),U,7) S:BP36]"" BP36="1^"_BP36
"RTN","BPSRPT6",19,0)
 ;
"RTN","BPSRPT6",20,0)
 ;If Not Found, look up using API
"RTN","BPSRPT6",21,0)
 I BP36="" D
"RTN","BPSRPT6",22,0)
 .S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSRPT6",23,0)
 .I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSRPT6",24,0)
 .S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT6",25,0)
 .S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPSZZ,"1")
"RTN","BPSRPT6",26,0)
 .S BP36=$G(BPSZZ("IBBAPI","INSUR",1,1))
"RTN","BPSRPT6",27,0)
 ;
"RTN","BPSRPT6",28,0)
 ;If Not Found, put in MISSING INSURANCE
"RTN","BPSRPT6",29,0)
 I $TR(BP36,U)="" S BP36=" ^**MISSING INSURANCE**"
"RTN","BPSRPT6",30,0)
 ;
"RTN","BPSRPT6",31,0)
 Q BP36
"RTN","BPSRPT6",32,0)
 ;
"RTN","BPSRPT6",33,0)
 ;Select an Insurance Company file entry (Fileman Lookup)
"RTN","BPSRPT6",34,0)
 ;
"RTN","BPSRPT6",35,0)
 ; Returned value -> Insurance Company Name
"RTN","BPSRPT6",36,0)
 ; 
"RTN","BPSRPT6",37,0)
SELINS() N INS
"RTN","BPSRPT6",38,0)
 S INS=$$SELINSUR^IBNCPDPI("Select Insurance","")
"RTN","BPSRPT6",39,0)
 I $P(INS,U)=-1 S INS="^"
"RTN","BPSRPT6",40,0)
 E  S INS=$P(INS,U,2)
"RTN","BPSRPT6",41,0)
 Q INS
"RTN","BPSRPT6",42,0)
 ;
"RTN","BPSRPT6",43,0)
 ;Get the drug name for display
"RTN","BPSRPT6",44,0)
 ;
"RTN","BPSRPT6",45,0)
 ; Input variable ->  BP50 - Lookup to DRUG (#50)
"RTN","BPSRPT6",46,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",47,0)
 ; Returned value -> Name of the drug
"RTN","BPSRPT6",48,0)
 ; 
"RTN","BPSRPT6",49,0)
DRGNAM(BP50,BPLEN) Q $E($$DRUGDIE^BPSUTIL1(+BP50,.01,"E"),1,BPLEN)
"RTN","BPSRPT6",50,0)
 ;       
"RTN","BPSRPT6",51,0)
 ;Select a DRUG file entry (Fileman Lookup)
"RTN","BPSRPT6",52,0)
 ;
"RTN","BPSRPT6",53,0)
 ; Returned Variable -> Y
"RTN","BPSRPT6",54,0)
 ; 
"RTN","BPSRPT6",55,0)
SELDRG N DIC S DIC(0)="QEAM",DIC=50,DIC("A")="Select Drug: "
"RTN","BPSRPT6",56,0)
 D DRUGDIC^BPSUTIL1(.DIC)
"RTN","BPSRPT6",57,0)
 Q
"RTN","BPSRPT6",58,0)
 ;
"RTN","BPSRPT6",59,0)
 ;Get the drug class for display
"RTN","BPSRPT6",60,0)
 ;
"RTN","BPSRPT6",61,0)
 ; Input variable -> BP50605 - Lookup to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",62,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",63,0)
 ; Returned value -> Name of the drug class
"RTN","BPSRPT6",64,0)
 ;                   
"RTN","BPSRPT6",65,0)
DRGCLNAM(BP50605,BPLEN) N IEN,Y
"RTN","BPSRPT6",66,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",67,0)
 S Y=""
"RTN","BPSRPT6",68,0)
 I BP50605]"" D 
"RTN","BPSRPT6",69,0)
 .D C^PSN50P65(BP50605,"","BPSRPT6")
"RTN","BPSRPT6",70,0)
 .S IEN=$O(^TMP($J,"BPSRPT6",0))
"RTN","BPSRPT6",71,0)
 .I IEN]"" S Y=$E($G(^TMP($J,"BPSRPT6",IEN,1)),1,BPLEN)
"RTN","BPSRPT6",72,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",73,0)
 Q Y
"RTN","BPSRPT6",74,0)
 ;
"RTN","BPSRPT6",75,0)
 ;Select a VA DRUG CLASS file entry (Fileman Lookup)
"RTN","BPSRPT6",76,0)
 ;
"RTN","BPSRPT6",77,0)
SELDRGC N DIR,DIRUT,DTOUT,DUOUT,IEN,TOT,X
"RTN","BPSRPT6",78,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",79,0)
 ;
"RTN","BPSRPT6",80,0)
 F  D  Q:Y]""
"RTN","BPSRPT6",81,0)
 .K ^TMP($J,"BPSRPT6"),^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",82,0)
 .S DIR(0)="FO^1:35"
"RTN","BPSRPT6",83,0)
 .S DIR("A")="Select Drug Class"
"RTN","BPSRPT6",84,0)
 .S DIR("?")="Answer with VA DRUG CLASS CODE, or CLASSIFICATION. TYPE '??' FOR A LIST"
"RTN","BPSRPT6",85,0)
 .S DIR("??")="^D DCLIST^BPSRPT6"
"RTN","BPSRPT6",86,0)
 .D ^DIR
"RTN","BPSRPT6",87,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^" Q
"RTN","BPSRPT6",88,0)
 .;
"RTN","BPSRPT6",89,0)
 .;Get list based on original user input
"RTN","BPSRPT6",90,0)
 .D C^PSN50P65("",Y,"BPSRPT6X")
"RTN","BPSRPT6",91,0)
 .;
"RTN","BPSRPT6",92,0)
 .;Get list based on uppercase input
"RTN","BPSRPT6",93,0)
 .S Y=$$UP^XLFSTR(Y)
"RTN","BPSRPT6",94,0)
 .D C^PSN50P65("",Y,"BPSRPT6")
"RTN","BPSRPT6",95,0)
 .;
"RTN","BPSRPT6",96,0)
 .;Merge lists together
"RTN","BPSRPT6",97,0)
 .M ^TMP($J,"BPSRPT6")=^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",98,0)
 .K ^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",99,0)
 .;
"RTN","BPSRPT6",100,0)
 .; Reset 0 node based on combined lists
"RTN","BPSRPT6",101,0)
 .S Y=0 F TOT=0:1 S Y=$O(^TMP($J,"BPSRPT6",Y)) Q:'+Y
"RTN","BPSRPT6",102,0)
 .S ^TMP($J,"BPSRPT6",0)=TOT
"RTN","BPSRPT6",103,0)
 .;
"RTN","BPSRPT6",104,0)
 .;Check for no entries found
"RTN","BPSRPT6",105,0)
 .I TOT<1 W "  ??" S Y="" Q
"RTN","BPSRPT6",106,0)
 .;
"RTN","BPSRPT6",107,0)
 .;Check for Unique Entry
"RTN","BPSRPT6",108,0)
 .I TOT=1 D  Q
"RTN","BPSRPT6",109,0)
 ..S Y="",IEN=$O(^TMP($J,"BPSRPT6",0))
"RTN","BPSRPT6",110,0)
 ..I IEN]"" S Y=$G(^TMP($J,"BPSRPT6",IEN,1)) W $C(13),"Select Drug Class: ",Y
"RTN","BPSRPT6",111,0)
 .;
"RTN","BPSRPT6",112,0)
 .;Check for multiple entries - allow user to pick
"RTN","BPSRPT6",113,0)
 .I TOT>1 S Y=$$DCSEL(TOT)
"RTN","BPSRPT6",114,0)
 .I Y="^^" S Y=""
"RTN","BPSRPT6",115,0)
 .;
"RTN","BPSRPT6",116,0)
 Q
"RTN","BPSRPT6",117,0)
 ;
"RTN","BPSRPT6",118,0)
 ;List Entries in VA DRUG CLASS
"RTN","BPSRPT6",119,0)
 ;
"RTN","BPSRPT6",120,0)
DCLIST N CL,DTOUT,IEN,Y
"RTN","BPSRPT6",121,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",122,0)
 D C^PSN50P65("","??","BPSRPT6")
"RTN","BPSRPT6",123,0)
 ;
"RTN","BPSRPT6",124,0)
 ;First create new index - sorted by CLASSIFICATION
"RTN","BPSRPT6",125,0)
 S IEN=0 F  S IEN=$O(^TMP($J,"BPSRPT6",IEN)) Q:'IEN  D
"RTN","BPSRPT6",126,0)
 .S CL=$G(^TMP($J,"BPSRPT6",IEN,1)) Q:CL=""
"RTN","BPSRPT6",127,0)
 .S ^TMP($J,"BPSRPT6","B",CL,IEN)=$G(^TMP($J,"BPSRPT6",IEN,".01"))
"RTN","BPSRPT6",128,0)
 ;
"RTN","BPSRPT6",129,0)
 ;Now loop through and display entries
"RTN","BPSRPT6",130,0)
 S $X=0,$Y=0 W !,?3,"Choose from: ",!
"RTN","BPSRPT6",131,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"BPSRPT6","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",132,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"BPSRPT6","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",133,0)
 ..W ?3,$G(^TMP($J,"BPSRPT6","B",CL,IEN)),!,?3,CL,!
"RTN","BPSRPT6",134,0)
 ..I $Y>19!'$Y D
"RTN","BPSRPT6",135,0)
 ...W ?3 R "'^' TO STOP: ",Y:$G(DTIME,300)
"RTN","BPSRPT6",136,0)
 ...E  S DTOUT=1
"RTN","BPSRPT6",137,0)
 ...W $C(13),$J("",17),$C(13)
"RTN","BPSRPT6",138,0)
 ...I ($G(DTOUT)=1)!($G(Y)="^") S Y="^" Q
"RTN","BPSRPT6",139,0)
 ...S $X=0,$Y=0
"RTN","BPSRPT6",140,0)
 ;
"RTN","BPSRPT6",141,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",142,0)
 Q
"RTN","BPSRPT6",143,0)
 ;
"RTN","BPSRPT6",144,0)
 ;Allow user to pick VA DRUG CLASS entry based on initial input
"RTN","BPSRPT6",145,0)
 ;
"RTN","BPSRPT6",146,0)
 ; Input variable - TOT -> Total entries placed in ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",147,0)
 ; Returned value - VA DRUG CLASSIFICATION
"RTN","BPSRPT6",148,0)
 ;
"RTN","BPSRPT6",149,0)
DCSEL(TOT) N CL,DTOUT,I,IEN,IX,Y
"RTN","BPSRPT6",150,0)
 ;
"RTN","BPSRPT6",151,0)
 ;First create new index
"RTN","BPSRPT6",152,0)
 F IX="B","N" K ^TMP($J,"BPSRPT6",IX)
"RTN","BPSRPT6",153,0)
 S Y="",IEN=0 F  S IEN=$O(^TMP($J,"BPSRPT6",IEN)) Q:'IEN  D
"RTN","BPSRPT6",154,0)
 .S CL=$G(^TMP($J,"BPSRPT6",IEN,1)) Q:CL=""
"RTN","BPSRPT6",155,0)
 .S ^TMP($J,"BPSRPT6","B",CL,IEN)=$G(^TMP($J,"BPSRPT6",IEN,".01"))
"RTN","BPSRPT6",156,0)
 ;
"RTN","BPSRPT6",157,0)
 ;Now loop through and allow one to be picked
"RTN","BPSRPT6",158,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"BPSRPT6","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",159,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"BPSRPT6","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",160,0)
 ..S I=$G(I)+1 W !,?5,I,?9,$G(^TMP($J,"BPSRPT6","B",CL,IEN)),!,?3,CL
"RTN","BPSRPT6",161,0)
 ..S ^TMP($J,"BPSRPT6","N",I)=CL
"RTN","BPSRPT6",162,0)
 ..;
"RTN","BPSRPT6",163,0)
 ..;Stop after every 5 entries
"RTN","BPSRPT6",164,0)
 ..I I#5=0 I TOT>I D  Q:$G(Y)="^"!($G(Y)="^^")
"RTN","BPSRPT6",165,0)
 ...W !,"Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","BPSRPT6",166,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",167,0)
 ...I ($G(DTOUT)=1)!(Y="^") S Y="^^"
"RTN","BPSRPT6",168,0)
 ..;
"RTN","BPSRPT6",169,0)
 ..;Stop after last entry
"RTN","BPSRPT6",170,0)
 ..I I=TOT D
"RTN","BPSRPT6",171,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",172,0)
 ..I ($G(DTOUT)=1)!(Y="^") S Y="^^"
"RTN","BPSRPT6",173,0)
 ..;
"RTN","BPSRPT6",174,0)
 ..;Check for valid entry
"RTN","BPSRPT6",175,0)
 ..I Y="^^" S Y=""
"RTN","BPSRPT6",176,0)
 ..I Y]"",'$D(^TMP($J,"BPSRPT6","N",Y)) W "  ??" S Y=""
"RTN","BPSRPT6",177,0)
 ..I Y]"",$D(^TMP($J,"BPSRPT6","N",Y)) S Y=$G(^TMP($J,"BPSRPT6","N",Y))
"RTN","BPSRPT6",178,0)
 ;
"RTN","BPSRPT6",179,0)
 Q Y
"RTN","BPSRPT6",180,0)
 ;
"RTN","BPSRPT6",181,0)
 ;Get DRUG file pointer
"RTN","BPSRPT6",182,0)
 ;       
"RTN","BPSRPT6",183,0)
 ; Return Value -> n = ptr to DRUG (#50)
"RTN","BPSRPT6",184,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",185,0)
 ; 
"RTN","BPSRPT6",186,0)
GETDRUG(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,6,"I")
"RTN","BPSRPT6",187,0)
 ;
"RTN","BPSRPT6",188,0)
 ;Get VA DRUG CLASS pointer
"RTN","BPSRPT6",189,0)
 ;       
"RTN","BPSRPT6",190,0)
 ; Input Variables: BP50 - ptr to DRUG (#50)
"RTN","BPSRPT6",191,0)
 ;
"RTN","BPSRPT6",192,0)
 ; Return Value -> n = ptr to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",193,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",194,0)
 ;
"RTN","BPSRPT6",195,0)
GETDRGCL(BP50) Q $$DRUGDIE^BPSUTIL1(BP50,25)
"RTN","BPSRPT6",196,0)
 ;
"RTN","BPSRPT6",197,0)
 ;Determine whether claim was Mail, Window, or CMOP
"RTN","BPSRPT6",198,0)
 ;
"RTN","BPSRPT6",199,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",200,0)
 ;
"RTN","BPSRPT6",201,0)
 ; Return Value -> M = Mail
"RTN","BPSRPT6",202,0)
 ;                 W = Window
"RTN","BPSRPT6",203,0)
 ;                 C = CMOP
"RTN","BPSRPT6",204,0)
 ;
"RTN","BPSRPT6",205,0)
MWC(BPRX,BPREF) Q $$MWC^PSOBPSU2(BPRX,BPREF)
"RTN","BPSRPT6",206,0)
 ;
"RTN","BPSRPT6",207,0)
 ;Get Patient Name
"RTN","BPSRPT6",208,0)
 ;
"RTN","BPSRPT6",209,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",210,0)
 ; Returned value -> Patient Name (shortened)
"RTN","BPSRPT6",211,0)
 ; 
"RTN","BPSRPT6",212,0)
PATNAME(BPDFN) Q $E($P($G(^DPT(BPDFN,0)),U),1,25)
"RTN","BPSRPT6",213,0)
 ;
"RTN","BPSRPT6",214,0)
 ;Get Last 4 of SSN
"RTN","BPSRPT6",215,0)
 ;
"RTN","BPSRPT6",216,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",217,0)
 ; Returned value -> Last 4 digits of patient's SSN
"RTN","BPSRPT6",218,0)
 ; 
"RTN","BPSRPT6",219,0)
SSN4(BPDFN) N X
"RTN","BPSRPT6",220,0)
 S X=$P($G(^DPT(BPDFN,0)),U,9)
"RTN","BPSRPT6",221,0)
 Q $E(X,$L(X)-3,$L(X))
"RTN","BPSRPT6",222,0)
 ;
"RTN","BPSRPT6",223,0)
 ;Get RX#
"RTN","BPSRPT6",224,0)
 ;
"RTN","BPSRPT6",225,0)
 ; Returned value -> RX#
"RTN","BPSRPT6",226,0)
 ; 
"RTN","BPSRPT6",227,0)
RXNUM(BPRX) Q $$RXAPI1^BPSUTIL1(+BPRX,.01,"I")
"RTN","BPSRPT6",228,0)
 ;
"RTN","BPSRPT6",229,0)
 ;Determine $Collected
"RTN","BPSRPT6",230,0)
 ;
"RTN","BPSRPT6",231,0)
 ; Returned Value -> $Collected
"RTN","BPSRPT6",232,0)
 ;
"RTN","BPSRPT6",233,0)
COLLECTD(BPRX,BPREF) N COL,RET
"RTN","BPSRPT6",234,0)
 S RET=$$BILLINFO^IBNCPDPI(BPRX,BPREF)
"RTN","BPSRPT6",235,0)
 S COL=$P(RET,U,5) I COL="0",($P(RET,U,3)=16)!($P(RET,U,3)=27) S COL=""
"RTN","BPSRPT6",236,0)
 I $P(RET,U,7)=1 S COL="N/A"
"RTN","BPSRPT6",237,0)
 Q COL
"RTN","BPSRPT6",238,0)
 ;
"RTN","BPSRPT6",239,0)
 ;Determine Bill #
"RTN","BPSRPT6",240,0)
 ;
"RTN","BPSRPT6",241,0)
 ; Returned Value -> Bill Number
"RTN","BPSRPT6",242,0)
 ;
"RTN","BPSRPT6",243,0)
BILL(BPRX,BPREF) N BILL
"RTN","BPSRPT6",244,0)
 S BILL=$P($$BILLINFO^IBNCPDPI(BPRX,BPREF),U)
"RTN","BPSRPT6",245,0)
 Q BILL
"RTN","BPSRPT6",246,0)
 ;
"RTN","BPSRPT6",247,0)
 ;Get the Closed Claim Reason
"RTN","BPSRPT6",248,0)
 ;
"RTN","BPSRPT6",249,0)
 ; Input variable -> 0 for All Closed Claim Reasons or
"RTN","BPSRPT6",250,0)
 ;                   lookup to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT6",251,0)
 ; Returned value -> ALL or the selected Closed Claim Reason
"RTN","BPSRPT6",252,0)
 ; 
"RTN","BPSRPT6",253,0)
GETCLR(RSN) ;
"RTN","BPSRPT6",254,0)
 I RSN="0" S RSN="ALL"
"RTN","BPSRPT6",255,0)
 E  S RSN=$P($G(^IBE(356.8,+RSN,0)),U)
"RTN","BPSRPT6",256,0)
 Q RSN
"RTN","BPSRPT6",257,0)
 ;
"RTN","BPSRPT6",258,0)
 ;Get the Closed By Person
"RTN","BPSRPT6",259,0)
 ;
"RTN","BPSRPT6",260,0)
 ; Returned Value -> Closed By Name
"RTN","BPSRPT6",261,0)
 ; 
"RTN","BPSRPT6",262,0)
CLSBY(BP59) N BP02,CBY,Y
"RTN","BPSRPT6",263,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT6",264,0)
 S CBY=+$P($G(^BPSC(BP02,900)),U,3)
"RTN","BPSRPT6",265,0)
 S Y=$$GET1^DIQ(200,CBY_",",".01")
"RTN","BPSRPT6",266,0)
 Q Y
"RTN","BPSRPT6",267,0)
 ;
"RTN","BPSRPT6",268,0)
 ;Get the Claim Status
"RTN","BPSRPT6",269,0)
 ;
"RTN","BPSRPT6",270,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",271,0)
 ;
"RTN","BPSRPT6",272,0)
STATUS(BPRX,BPREF) Q $$STATUS^BPSOSRX(BPRX,BPREF,0)
"RTN","BPSRPT6",273,0)
 ;
"RTN","BPSRPT6",274,0)
 ;Elapsed Time
"RTN","BPSRPT6",275,0)
 ;
"RTN","BPSRPT6",276,0)
 ; Returned Value -> TIME - Elapsed Processing Time
"RTN","BPSRPT6",277,0)
 ; 
"RTN","BPSRPT6",278,0)
ELAPSE(BP59) Q $$TIMEDIFI^BPSOSUD($P($G(^BPST(BP59,0)),U,11),$P($G(^BPST(BP59,0)),U,8))
"RTN","BPSRPT6",279,0)
 ;
"RTN","BPSRPT6",280,0)
 ;Get RX issue date
"RTN","BPSRPT6",281,0)
 ;
"RTN","BPSRPT6",282,0)
RXISSDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,1,"I")
"RTN","BPSRPT6",283,0)
 ;
"RTN","BPSRPT6",284,0)
 ;
"RTN","BPSRPT6",285,0)
 ;Get RX's fill date
"RTN","BPSRPT6",286,0)
RXFILDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,22,"I")
"RTN","BPSRPT6",287,0)
 ;
"RTN","BPSRPT6",288,0)
 ;Get Refill's issue date
"RTN","BPSRPT6",289,0)
 ;
"RTN","BPSRPT6",290,0)
REFISSDT(BPRX,BPREF) Q $$REFDISDT(BPRX,BPREF)
"RTN","BPSRPT6",291,0)
 ;
"RTN","BPSRPT6",292,0)
 ;Get Refill's dispense date
"RTN","BPSRPT6",293,0)
 ;
"RTN","BPSRPT6",294,0)
REFDISDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,10.1,"I")
"RTN","BPSRPT6",295,0)
 ;
"RTN","BPSRPT6",296,0)
 ;Get Refill's refill date
"RTN","BPSRPT6",297,0)
 ;
"RTN","BPSRPT6",298,0)
REFFILDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,.01,"I")
"RTN","BPSRPT6",299,0)
 ;
"RTN","BPSRPT6",300,0)
 ;Get RX's release date
"RTN","BPSRPT6",301,0)
 ;
"RTN","BPSRPT6",302,0)
RXRELDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,31,"I")
"RTN","BPSRPT6",303,0)
 ;
"RTN","BPSRPT6",304,0)
 ;Get Refill's release date
"RTN","BPSRPT6",305,0)
 ;
"RTN","BPSRPT6",306,0)
REFRELDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,17,"I")
"RTN","BPSRPT6",307,0)
 ;
"RTN","BPSRPT6",308,0)
 ;See if refill exists
"RTN","BPSRPT6",309,0)
 ;
"RTN","BPSRPT6",310,0)
IFREFILL(BPRX,BPREF) Q $S(+$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,.01,"I"):1,1:0)
"RTN","BPSRPT6",311,0)
 ;
"RTN","BPSRPT6",312,0)
 ;Get RX status
"RTN","BPSRPT6",313,0)
 ;
"RTN","BPSRPT6",314,0)
 ; Input Variables -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT6",315,0)
 ;                            
"RTN","BPSRPT6",316,0)
RXSTATUS(BP59) Q $$RXST^BPSSCRU2(BP59)
"RTN","BPSRPT6",317,0)
 ;
"RTN","BPSRPT6",318,0)
 ;Return RX Quantity (From BPS TRANSACTION)
"RTN","BPSRPT6",319,0)
 ;
"RTN","BPSRPT6",320,0)
QTY(BP59) Q +$P($G(^BPST(BP59,5)),U,1)
"RTN","BPSRPT6",321,0)
 ;
"RTN","BPSRPT6",322,0)
 ;Return NDC Number
"RTN","BPSRPT6",323,0)
GETNDC(BPRX,BPREF) Q $$GETNDC^PSONDCUT(BPRX,BPREF)
"RTN","BPSRPT6",324,0)
 ;
"RTN","BPSRPT6",325,0)
 ;Return Copay Status ($)
"RTN","BPSRPT6",326,0)
COPAY(BPRX) Q $S(+$$RXAPI1^BPSUTIL1(BPRX,105,"I"):"$",1:"")
"RTN","BPSRPT7")
0^26^B69704437
"RTN","BPSRPT7",1,0)
BPSRPT7 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT7",4,0)
 ;
"RTN","BPSRPT7",5,0)
 Q
"RTN","BPSRPT7",6,0)
 ;
"RTN","BPSRPT7",7,0)
 ;Routine to Display the Reports (Continued)
"RTN","BPSRPT7",8,0)
 ;
"RTN","BPSRPT7",9,0)
 ; Input Variables -> BPCLM = Array of report data by date
"RTN","BPSRPT7",10,0)
 ;                   BPDIV,BPSUMDET,GTOT
"RTN","BPSRPT7",11,0)
 ; Returned Value -> Cumulative Grand Totals
"RTN","BPSRPT7",12,0)
 ; 
"RTN","BPSRPT7",13,0)
PTBDT(BPDIV,BPSUMDET,BPCLM,GTOT) N DIFF,I,NP,RDT,TOT,X
"RTN","BPSRPT7",14,0)
 ;
"RTN","BPSRPT7",15,0)
 ;Loop through compiled array and display
"RTN","BPSRPT7",16,0)
 S TOT=""
"RTN","BPSRPT7",17,0)
 S RDT="" F  S RDT=$O(BPCLM(RDT)) Q:RDT=""  D  Q:BPQ
"RTN","BPSRPT7",18,0)
 .S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",19,0)
 .S X=$G(BPCLM(RDT))
"RTN","BPSRPT7",20,0)
 .;
"RTN","BPSRPT7",21,0)
 .;Print Details - Report
"RTN","BPSRPT7",22,0)
 .I BPSUMDET=0,'BPEXCEL D
"RTN","BPSRPT7",23,0)
 ..W !,$$DATTIM^BPSRPT1(RDT) ;Date
"RTN","BPSRPT7",24,0)
 ..W ?15,$J(+$P(X,U),17) ;#Claims
"RTN","BPSRPT7",25,0)
 ..W ?33,$J(+$P(X,U,2),17,2)  ;Amount Submitted
"RTN","BPSRPT7",26,0)
 ..W ?51,$J(+$P(X,U,3),17,2)  ;Returned Rejected
"RTN","BPSRPT7",27,0)
 ..W ?69,$J(+$P(X,U,4),17,2)  ;Returned Payable
"RTN","BPSRPT7",28,0)
 ..W ?87,$J(+$P(X,U,5),17,2)  ;Amount to Receive
"RTN","BPSRPT7",29,0)
 ..;
"RTN","BPSRPT7",30,0)
 ..;Difference
"RTN","BPSRPT7",31,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",32,0)
 ..I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",33,0)
 ..E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",34,0)
 ..;
"RTN","BPSRPT7",35,0)
 ..;Print Details - Excel
"RTN","BPSRPT7",36,0)
 .I BPSUMDET=0,BPEXCEL D
"RTN","BPSRPT7",37,0)
 ..;
"RTN","BPSRPT7",38,0)
 ..;Division
"RTN","BPSRPT7",39,0)
 ..W !,$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV),U
"RTN","BPSRPT7",40,0)
 ..W $$DATTIM^BPSRPT1(RDT),U  ;Date
"RTN","BPSRPT7",41,0)
 ..W +$P(X,U),U ;#Claims
"RTN","BPSRPT7",42,0)
 ..W $TR($J(+$P(X,U,2),17,2)," "),U  ;Amount Submitted
"RTN","BPSRPT7",43,0)
 ..W $TR($J(+$P(X,U,3),17,2)," "),U  ;Returned Rejected
"RTN","BPSRPT7",44,0)
 ..W $TR($J(+$P(X,U,4),17,2)," "),U  ;Returned Payable
"RTN","BPSRPT7",45,0)
 ..W $TR($J(+$P(X,U,5),17,2)," "),U  ;Amount to Receive
"RTN","BPSRPT7",46,0)
 ..;
"RTN","BPSRPT7",47,0)
 ..;Difference
"RTN","BPSRPT7",48,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",49,0)
 ..W $TR($J(DIFF,15,2)," ")
"RTN","BPSRPT7",50,0)
 .;
"RTN","BPSRPT7",51,0)
 .;Save Totals
"RTN","BPSRPT7",52,0)
 .F I=1:1:5 S $P(TOT,U,I)=$P(TOT,U,I)+$P(X,U,I),$P(GTOT,U,I)=$P($G(GTOT),U,I)+$P(X,U,I)
"RTN","BPSRPT7",53,0)
 ;
"RTN","BPSRPT7",54,0)
 ;Print Totals
"RTN","BPSRPT7",55,0)
 Q:BPEXCEL
"RTN","BPSRPT7",56,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",57,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",58,0)
 W !,"TOTALS"
"RTN","BPSRPT7",59,0)
 W ?15,$J(+$P(TOT,U),17)
"RTN","BPSRPT7",60,0)
 W ?33,$J(+$P(TOT,U,2),17,2)
"RTN","BPSRPT7",61,0)
 W ?51,$J(+$P(TOT,U,3),17,2)
"RTN","BPSRPT7",62,0)
 W ?69,$J(+$P(TOT,U,4),17,2)
"RTN","BPSRPT7",63,0)
 W ?87,$J(+$P(TOT,U,5),17,2)
"RTN","BPSRPT7",64,0)
 S X=$S((+$P(TOT,U,4))=0:0,1:(+$P(TOT,U,5))/(+$P(TOT,U,4)))
"RTN","BPSRPT7",65,0)
 S DIFF=+$P(TOT,U,4)-$P(TOT,U,5)
"RTN","BPSRPT7",66,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",67,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",68,0)
 Q
"RTN","BPSRPT7",69,0)
 ;
"RTN","BPSRPT7",70,0)
 ;Print Grand Totals - Report 6
"RTN","BPSRPT7",71,0)
 ;
"RTN","BPSRPT7",72,0)
PGTOT6(GTOT) N DIFF,NP,X
"RTN","BPSRPT7",73,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",74,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",75,0)
 W !,"GRAND TOTALS"
"RTN","BPSRPT7",76,0)
 W ?15,$J(+$P(GTOT,U),17)
"RTN","BPSRPT7",77,0)
 W ?33,$J(+$P(GTOT,U,2),17,2)
"RTN","BPSRPT7",78,0)
 W ?51,$J(+$P(GTOT,U,3),17,2)
"RTN","BPSRPT7",79,0)
 W ?69,$J(+$P(GTOT,U,4),17,2)
"RTN","BPSRPT7",80,0)
 W ?87,$J(+$P(GTOT,U,5),17,2)
"RTN","BPSRPT7",81,0)
 S X=$S((+$P(GTOT,U,4))=0:0,1:(+$P(GTOT,U,5))/(+$P(GTOT,U,4)))
"RTN","BPSRPT7",82,0)
 S DIFF=+$P(GTOT,U,4)-$P(GTOT,U,5)
"RTN","BPSRPT7",83,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",84,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",85,0)
 Q
"RTN","BPSRPT7",86,0)
 ;
"RTN","BPSRPT7",87,0)
 ;Print Grand Totals - Reports 1,2,3,4,5,7
"RTN","BPSRPT7",88,0)
 ;
"RTN","BPSRPT7",89,0)
PGTOT(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM) ;
"RTN","BPSRPT7",90,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",91,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",92,0)
 .W !,"GRAND TOTALS",?78,$J(BPGBIL,10,2),?100,$J(BPGINS,10,2),?122,$J(BPGCOLL,10,2)
"RTN","BPSRPT7",93,0)
 .W !,"COUNT",?78,$J(BPGCNT,10),?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",94,0)
 .W:BPGCNT !,"MEAN",?78,$J(BPGBIL/BPGCNT,10,2),?100,$J(BPGINS/BPGCNT,10,2),?122,$J(BPGCOLL/BPGCNT,10,2)
"RTN","BPSRPT7",95,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",96,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",97,0)
 .W !,"GRAND TOTALS",?100,$J(BPGBIL,10,2),?122,$J(BPGINS,10,2)
"RTN","BPSRPT7",98,0)
 .W !,"COUNT",?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",99,0)
 .W:BPGCNT !,"MEAN",?100,$J(BPGBIL/BPGCNT,10,2),?122,$J(BPGINS/BPGCNT,10,2)
"RTN","BPSRPT7",100,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",101,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",102,0)
 .W !,"GRAND TOTALS",?41,$J(BPGBIL,10,2)
"RTN","BPSRPT7",103,0)
 .W !,"COUNT",?41,$J(BPGCNT,10)
"RTN","BPSRPT7",104,0)
 .W:BPGCNT !,"MEAN",?41,$J(BPGBIL/BPGCNT,10,2)
"RTN","BPSRPT7",105,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",106,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS)",?65,"---------------"
"RTN","BPSRPT7",107,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPGCNT,15)
"RTN","BPSRPT7",108,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPGCNT=0:"0",1:(BPGELTM\BPGCNT)),15)
"RTN","BPSRPT7",109,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",110,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS) BY BILLER"
"RTN","BPSRPT7",111,0)
 .N BPBILR,BPDIV S BPDIV="ALL DIVISIONS"
"RTN","BPSRPT7",112,0)
 .S BPBILR="" F  S BPBILR=$O(BPGCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",113,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",114,0)
 ..W !,?3,BPBILR,?65,$J($G(BPGCNT(BPBILR)),5)
"RTN","BPSRPT7",115,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",116,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",117,0)
 .W !,"CLOSED CLAIMS GRAND TOTAL",?65,$J(BPGCNT,5)
"RTN","BPSRPT7",118,0)
 ;
"RTN","BPSRPT7",119,0)
 Q
"RTN","BPSRPT7",120,0)
 ;
"RTN","BPSRPT7",121,0)
 ;Get Close Reason
"RTN","BPSRPT7",122,0)
 ;
"RTN","BPSRPT7",123,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",124,0)
 ; Returned Value -> Claim Close Reason
"RTN","BPSRPT7",125,0)
 ;
"RTN","BPSRPT7",126,0)
CLRSN(BP59) N BP02,CIEN,CL
"RTN","BPSRPT7",127,0)
 S CL=""
"RTN","BPSRPT7",128,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT7",129,0)
 S CIEN=+$P($G(^BPSC(BP02,900)),U,4)
"RTN","BPSRPT7",130,0)
 I CIEN'=0 S CL=$$GETCLR^BPSRPT6(CIEN)
"RTN","BPSRPT7",131,0)
 Q CIEN_"^"_CL
"RTN","BPSRPT7",132,0)
 ;
"RTN","BPSRPT7",133,0)
 ;Get Reversal Reason
"RTN","BPSRPT7",134,0)
 ;
"RTN","BPSRPT7",135,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",136,0)
 ; Returned Value -> Claim Reversal Reason
"RTN","BPSRPT7",137,0)
 ;
"RTN","BPSRPT7",138,0)
RVSRSN(BP59) Q $P($G(^BPST(BP59,4)),U,4)
"RTN","BPSRPT7",139,0)
 ;
"RTN","BPSRPT7",140,0)
 ;Return the Billed Amount
"RTN","BPSRPT7",141,0)
 ;
"RTN","BPSRPT7",142,0)
BILLED(BP59) ;
"RTN","BPSRPT7",143,0)
 Q +$P($G(^BPST(BP59,5)),U,5)
"RTN","BPSRPT7",144,0)
 ;
"RTN","BPSRPT7",145,0)
 ;Return the Transaction Type - SUBMIT or REVERSAL
"RTN","BPSRPT7",146,0)
 ;
"RTN","BPSRPT7",147,0)
TTYPE(BPRX,BPREF) N BPSTATUS,TTYPE
"RTN","BPSRPT7",148,0)
 S TTYPE="SUBMIT"
"RTN","BPSRPT7",149,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT7",150,0)
 I BPSTATUS["REVERSAL" S TTYPE="REVERSAL"
"RTN","BPSRPT7",151,0)
 Q TTYPE
"RTN","BPSRPT7",152,0)
 ;
"RTN","BPSRPT7",153,0)
 ;Return the payer response
"RTN","BPSRPT7",154,0)
 ;
"RTN","BPSRPT7",155,0)
RESPONSE(BPRX,BPREF) Q $P($$STATUS^BPSRPT6(BPRX,BPREF),U)
"RTN","BPSRPT7",156,0)
 ;
"RTN","BPSRPT7",157,0)
 ;Print Report Subtotals
"RTN","BPSRPT7",158,0)
 ;
"RTN","BPSRPT7",159,0)
TOTALS(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM) ;
"RTN","BPSRPT7",160,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",161,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",162,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,52),?78,$J(BPTBIL,10,2),?100,$J(BPTINS,10,2),?122,$J(BPTCOLL,10,2)
"RTN","BPSRPT7",163,0)
 .W !,"COUNT",?78,$J(BPCNT,10),?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",164,0)
 .W:BPCNT !,"MEAN",?78,$J(BPTBIL/BPCNT,10,2),?100,$J(BPTINS/BPCNT,10,2),?122,$J(BPTCOLL/BPCNT,10,2)
"RTN","BPSRPT7",165,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",166,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",167,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,52),?100,$J(BPTBIL,10,2),?122,$J(BPTINS,10,2)
"RTN","BPSRPT7",168,0)
 .W !,"COUNT",?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",169,0)
 .W:BPCNT !,"MEAN",?100,$J(BPTBIL/BPCNT,10,2),?122,$J(BPTINS/BPCNT,10,2)
"RTN","BPSRPT7",170,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",171,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",172,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,22),?41,$J(BPTBIL,10,2)
"RTN","BPSRPT7",173,0)
 .W !,"COUNT",?41,$J(BPCNT,10)
"RTN","BPSRPT7",174,0)
 .W:BPCNT !,"MEAN",?41,$J(BPTBIL/BPCNT,10,2)
"RTN","BPSRPT7",175,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",176,0)
 .W !!,"SUBTOTALS for DIV: ",$E($$BPDIV(BPDIV),1,43),?65,"---------------"
"RTN","BPSRPT7",177,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPCNT,15)
"RTN","BPSRPT7",178,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPCNT=0:"0",1:(BPELTM\BPCNT)),15)
"RTN","BPSRPT7",179,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",180,0)
 .W !!,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,43)
"RTN","BPSRPT7",181,0)
 .N BPBILR
"RTN","BPSRPT7",182,0)
 .S BPBILR="" F  S BPBILR=$O(BPCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",183,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",184,0)
 ..W !,?3,BPBILR,?65,$J($G(BPCNT(BPBILR)),5)
"RTN","BPSRPT7",185,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",186,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",187,0)
 .W !,"CLOSED CLAIMS SUBTOTAL",?65,$J(BPCNT,5)
"RTN","BPSRPT7",188,0)
 ;
"RTN","BPSRPT7",189,0)
 Q
"RTN","BPSRPT7",190,0)
 ;
"RTN","BPSRPT7",191,0)
 ;Print Report Header
"RTN","BPSRPT7",192,0)
 ; Input variables (defined in BPSRPT0) - BPPHARM,BPSUMDET,BPNOW,BPMWC,BPRTBCK,BPINSINF
"RTN","BPSRPT7",193,0)
 ;                                        BPREJCD,BPCCRSN,BPAUTREV,BPACREJ,BPQSTDRG
"RTN","BPSRPT7",194,0)
 ;                                        BPDRUG,BPDRGCL,BPRLNRL,BPSORT,BPBEGDT,BPENDDT
"RTN","BPSRPT7",195,0)
 ; Output variable - BPSDATA -> Reset to 0 to show no actual data has been printed
"RTN","BPSRPT7",196,0)
 ;                           on the screen
"RTN","BPSRPT7",197,0)
 ;                   BPPAGE -> First set in BPSRPT0
"RTN","BPSRPT7",198,0)
 ;                   BPBLINE -> Controls whether to print a blank line
"RTN","BPSRPT7",199,0)
 ;                   
"RTN","BPSRPT7",200,0)
HDR(BPRTYPE,BPRPTNAM,BPPAGE) ;
"RTN","BPSRPT7",201,0)
 ;Display Excel Header
"RTN","BPSRPT7",202,0)
 I BPEXCEL D HDR^BPSRPT8(BPRTYPE) Q
"RTN","BPSRPT7",203,0)
 ;
"RTN","BPSRPT7",204,0)
 ; Define BPPDATA - Tells whether data has been displayed for a screen
"RTN","BPSRPT7",205,0)
 S BPSDATA=0
"RTN","BPSRPT7",206,0)
 S BPBLINE=""
"RTN","BPSRPT7",207,0)
 S BPPAGE=$G(BPPAGE)+1
"RTN","BPSRPT7",208,0)
 W @IOF
"RTN","BPSRPT7",209,0)
 W "ECME "_BPRPTNAM_" "_$S(BPSUMDET=1:"SUMMARY",1:"DETAIL")_" REPORT"
"RTN","BPSRPT7",210,0)
 W ?89,"Print Date: "_$G(BPNOW)_"  Page:",$J(BPPAGE,3)
"RTN","BPSRPT7",211,0)
 W !,"DIVISION(S): ",$$GETDIVS^BPSRPT4(75,.BPPHARM)
"RTN","BPSRPT7",212,0)
 W ?93,"Fill Locations: "_$S(BPMWC="A":"C,M,W",1:BPMWC)
"RTN","BPSRPT7",213,0)
 W ?116,"Fill type: "_$S(BPRTBCK=2:"RT",BPRTBCK=3:"BB",1:"RT,BB")
"RTN","BPSRPT7",214,0)
 W !,"Insurance: "_$E($S(BPINSINF=0:"ALL",1:BPINSINF),1,30)
"RTN","BPSRPT7",215,0)
 I (",2,")[BPRTYPE W ?44,"Reject Code: ",$E($$GETREJ^BPSRPT4(BPREJCD),1,28)
"RTN","BPSRPT7",216,0)
 I (",7,")[BPRTYPE W ?44,"Close Reason: ",$E($$GETCLR^BPSRPT6(BPCCRSN),1,26)
"RTN","BPSRPT7",217,0)
 I (",4,")[BPRTYPE W ?44,$J($S(BPAUTREV=0:"ALL",1:"AUTO"),4)," Reversals"
"RTN","BPSRPT7",218,0)
 I (",4,")[BPRTYPE W ?60,$J($S(BPACREJ=1:"REJECTED",BPACREJ=2:"ACCEPTED",1:"ALL"),8)," Returned Status"
"RTN","BPSRPT7",219,0)
 W ?87,"Drugs/Classes: "_$S(BPQSTDRG=2:$$DRGNAM^BPSRPT6(BPDRUG,30),BPQSTDRG=3:$E(BPDRGCL,1,30),1:"ALL")
"RTN","BPSRPT7",220,0)
 W !,$S(BPRTYPE=5:"PRESCRIPTIONS",BPRLNRL=2:"RELEASED PRESCRIPTIONS",BPRLNRL=3:"PRESCRIPTIONS (NOT RELEASED)",1:"ALL PRESCRIPTIONS")
"RTN","BPSRPT7",221,0)
 W " BY "_$S(BPRTYPE=7:"CLOSE",1:"TRANSACTION")_" DATE: "
"RTN","BPSRPT7",222,0)
 W "From "_$$DATTIM^BPSRPT1(BPBEGDT)_" through "_$$DATTIM^BPSRPT1($P(BPENDDT,"."))
"RTN","BPSRPT7",223,0)
 ;
"RTN","BPSRPT7",224,0)
 D ULINE^BPSRPT5("=") Q:$G(BPQ)
"RTN","BPSRPT7",225,0)
 D HEADLN1^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",226,0)
 D HEADLN2^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",227,0)
 D HEADLN3^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",228,0)
 D ULINE^BPSRPT5("=")
"RTN","BPSRPT7",229,0)
 ;
"RTN","BPSRPT7",230,0)
 ;Print Division
"RTN","BPSRPT7",231,0)
 I $G(BPDIV)]"" D
"RTN","BPSRPT7",232,0)
 .W !,"DIVISION: ",$S(BPDIV=0:"BLANK",BPDIV="ALL DIVISIONS":"ALL DIVISIONS",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)
"RTN","BPSRPT7",233,0)
 .I BPRTYPE=5!(BPRTYPE=6)!(BPSUMDET=1)!(BPGRPLAN="") D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",234,0)
 ;
"RTN","BPSRPT7",235,0)
 ;Print Insurance If Defined
"RTN","BPSRPT7",236,0)
 I BPSUMDET=0,$G(BPGRPLAN)]"",$G(BPGRPLAN)'=0,$G(BPGRPLAN)'="~" D WRPLAN^BPSRPT5(BPGRPLAN)
"RTN","BPSRPT7",237,0)
 Q
"RTN","BPSRPT7",238,0)
 ;
"RTN","BPSRPT7",239,0)
 ;Special Division Handling
"RTN","BPSRPT7",240,0)
 ;
"RTN","BPSRPT7",241,0)
BPDIV(BPDIV) Q $S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)
"RTN","BPSRPT8")
0^24^B76134264
"RTN","BPSRPT8",1,0)
BPSRPT8 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSRPT8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT8",4,0)
 ;
"RTN","BPSRPT8",5,0)
 Q
"RTN","BPSRPT8",6,0)
 ;
"RTN","BPSRPT8",7,0)
 ;Routine to Display the Reports in Excel
"RTN","BPSRPT8",8,0)
 ;
"RTN","BPSRPT8",9,0)
 ;Print Report Line 1
"RTN","BPSRPT8",10,0)
 ;
"RTN","BPSRPT8",11,0)
 ; Input Variable -> BPRTYPE,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT
"RTN","BPSRPT8",12,0)
 ;                   BPBIL,BPINS,BPCOLL
"RTN","BPSRPT8",13,0)
 ; 
"RTN","BPSRPT8",14,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) ;
"RTN","BPSRPT8",15,0)
 ;
"RTN","BPSRPT8",16,0)
 ;Division
"RTN","BPSRPT8",17,0)
 S BPREC=$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)_U
"RTN","BPSRPT8",18,0)
 ;Insurance
"RTN","BPSRPT8",19,0)
 I BPRTYPE'=5,BPRTYPE'=6 S BPREC=BPREC_$E(BPGRPLAN,1,90)_U
"RTN","BPSRPT8",20,0)
 S BPREC=BPREC_$$PATNAME^BPSRPT6(BPDFN)_U  ;Patient Name
"RTN","BPSRPT8",21,0)
 S BPREC=BPREC_"("_$$SSN4^BPSRPT6(BPDFN)_")"_U ;L4SSN
"RTN","BPSRPT8",22,0)
 S BPREC=BPREC_$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)_U ;RX Number
"RTN","BPSRPT8",23,0)
 S BPREC=BPREC_BPREF_"/"_$$ECMENUM^BPSRPT1($P(BPX,U,3))_U ;Refill/ECME Number
"RTN","BPSRPT8",24,0)
 ;
"RTN","BPSRPT8",25,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",26,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U  ;Date
"RTN","BPSRPT8",27,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",28,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;$Ins. Paid
"RTN","BPSRPT8",29,0)
 . S BPREC=BPREC_$S(BPCOLL]"":$TR($J(BPCOLL,10,2)," "),1:"")_U ;$Collected
"RTN","BPSRPT8",30,0)
 ;
"RTN","BPSRPT8",31,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",32,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",33,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+BPX)_U  ;Released On
"RTN","BPSRPT8",34,0)
 . ;RX INFO
"RTN","BPSRPT8",35,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",36,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U  ;Fill Type
"RTN","BPSRPT8",37,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",38,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",39,0)
 ;
"RTN","BPSRPT8",40,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",41,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",42,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",43,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;Insurance Response
"RTN","BPSRPT8",44,0)
 ;
"RTN","BPSRPT8",45,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",46,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))_U ;Completed
"RTN","BPSRPT8",47,0)
 . S BPREC=BPREC_$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Trans Type
"RTN","BPSRPT8",48,0)
 . S BPREC=BPREC_$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Payer Response
"RTN","BPSRPT8",49,0)
 ;
"RTN","BPSRPT8",50,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",51,0)
 . ;RX INFO
"RTN","BPSRPT8",52,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",53,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",54,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",55,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",56,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",57,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",58,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",59,0)
 Q
"RTN","BPSRPT8",60,0)
 ;
"RTN","BPSRPT8",61,0)
 ;Print Report Line 2
"RTN","BPSRPT8",62,0)
 ;
"RTN","BPSRPT8",63,0)
 ; Input Variable -> BPRTYPE,BPX,BPRX,BPREF,BPBIL,BPGRPLAN
"RTN","BPSRPT8",64,0)
 ; 
"RTN","BPSRPT8",65,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) ;
"RTN","BPSRPT8",66,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",67,0)
 . ;Drug, Released On
"RTN","BPSRPT8",68,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",69,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+BPX)_U
"RTN","BPSRPT8",70,0)
 . ;RX INFO
"RTN","BPSRPT8",71,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",72,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",73,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",74,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",75,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",76,0)
 . I BPRTYPE=1 S BPREC=BPREC_U_$$BILL^BPSRPT6(BPRX,BPREF) ;Bill #
"RTN","BPSRPT8",77,0)
 ;
"RTN","BPSRPT8",78,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",79,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",80,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U ;Group ID
"RTN","BPSRPT8",81,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",82,0)
 . S BPREC=BPREC_$$QTY^BPSRPT6($P(BPX,U,3))_U ;Qty
"RTN","BPSRPT8",83,0)
 . S BPREC=BPREC_$$GETNDC^BPSRPT6(BPRX,BPREF)_U ;NDC#
"RTN","BPSRPT8",84,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",85,0)
 ;
"RTN","BPSRPT8",86,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",87,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",88,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",89,0)
 . ;RX INFO
"RTN","BPSRPT8",90,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",91,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",92,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",93,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",94,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",95,0)
 ;
"RTN","BPSRPT8",96,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",97,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",98,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",99,0)
 . ;RX INFO
"RTN","BPSRPT8",100,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",101,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",102,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",103,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",104,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",105,0)
 . I $P(BPGRPLAN,U,2)]"" S BPREC=BPREC_$E($P(BPGRPLAN,U,2),1,30) ;Insurance
"RTN","BPSRPT8",106,0)
 . S BPREC=BPREC_U_$$ELAPSE^BPSRPT6($P(BPX,U,3))  ;Elapsed Time
"RTN","BPSRPT8",107,0)
 ;
"RTN","BPSRPT8",108,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",109,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",110,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U  ;Group ID
"RTN","BPSRPT8",111,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))_U ;Close Dt/Time
"RTN","BPSRPT8",112,0)
 . S BPREC=BPREC_$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25)_U ;Close By
"RTN","BPSRPT8",113,0)
 . S BPREC=BPREC_$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)_U ;Close Reason
"RTN","BPSRPT8",114,0)
 Q
"RTN","BPSRPT8",115,0)
 ;
"RTN","BPSRPT8",116,0)
 ;Print Report Line 3
"RTN","BPSRPT8",117,0)
 ;
"RTN","BPSRPT8",118,0)
 ; Input Variable -> BPRTYPE,BPX
"RTN","BPSRPT8",119,0)
 ; 
"RTN","BPSRPT8",120,0)
WRLINE3(BPRTYPE,BPREC,BPX) N BP59,BPSARR,BPRJCNT,BPZZ
"RTN","BPSRPT8",121,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT8",122,0)
 ;
"RTN","BPSRPT8",123,0)
 I (",2,7,")[BPRTYPE D  Q
"RTN","BPSRPT8",124,0)
 .S BPREC=BPREC_$$CLAIMID^BPSRPT2(BP59)_U ;Claim ID
"RTN","BPSRPT8",125,0)
 .S BPRJCNT=$$REJTEXT^BPSRPT2(BP59,.BPSARR)
"RTN","BPSRPT8",126,0)
 .F BPZZ=1:1:BPRJCNT S:BPZZ'=1 BPREC=BPREC_"," S BPREC=BPREC_$P(BPSARR(BPZZ),":")
"RTN","BPSRPT8",127,0)
 .;
"RTN","BPSRPT8",128,0)
 .;Write one record per reject/close code
"RTN","BPSRPT8",129,0)
 .S:+BPRJCNT=0 BPRJCNT=1
"RTN","BPSRPT8",130,0)
 .F BPZZ=1:1:BPRJCNT W !,$G(BPREC),U,$P($G(BPSARR(BPZZ)),":"),U,$P($G(BPSARR(BPZZ)),":",2)
"RTN","BPSRPT8",131,0)
 ;
"RTN","BPSRPT8",132,0)
 I BPRTYPE=4 D
"RTN","BPSRPT8",133,0)
 . ;Method
"RTN","BPSRPT8",134,0)
 . I $$AUTOREV^BPSRPT1(BP59) S BPREC=BPREC_U_"AUTO"_U
"RTN","BPSRPT8",135,0)
 . E  S BPREC=BPREC_U_"REGULAR"_U
"RTN","BPSRPT8",136,0)
 . ;Return Status
"RTN","BPSRPT8",137,0)
 . I $P(BPX,U,15)["ACCEPTED" S BPREC=BPREC_"ACCEPTED"_U
"RTN","BPSRPT8",138,0)
 . E  S BPREC=BPREC_"REJECTED"_U
"RTN","BPSRPT8",139,0)
 . ;Reason
"RTN","BPSRPT8",140,0)
 . S BPREC=BPREC_$$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT8",141,0)
 ;
"RTN","BPSRPT8",142,0)
 ;Write the record
"RTN","BPSRPT8",143,0)
 W !,$G(BPREC)
"RTN","BPSRPT8",144,0)
 Q
"RTN","BPSRPT8",145,0)
 ;
"RTN","BPSRPT8",146,0)
 ;Print Excel Header
"RTN","BPSRPT8",147,0)
 ;
"RTN","BPSRPT8",148,0)
HDR(BPRTYPE) ;
"RTN","BPSRPT8",149,0)
 ;
"RTN","BPSRPT8",150,0)
 ;Check if header already printed
"RTN","BPSRPT8",151,0)
 I $G(BPSDATA) Q
"RTN","BPSRPT8",152,0)
 S BPSDATA=1
"RTN","BPSRPT8",153,0)
 ;
"RTN","BPSRPT8",154,0)
 ;Division
"RTN","BPSRPT8",155,0)
 W !,"DIVISION",U
"RTN","BPSRPT8",156,0)
 ;
"RTN","BPSRPT8",157,0)
 I BPRTYPE'=5,BPRTYPE'=6 W "INSURANCE",U
"RTN","BPSRPT8",158,0)
 ;
"RTN","BPSRPT8",159,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W "PATIENT NAME",U,"Pt.ID",U,"RX#",U,"REF/ECME#",U
"RTN","BPSRPT8",160,0)
 ;
"RTN","BPSRPT8",161,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",162,0)
 . W "DATE",U
"RTN","BPSRPT8",163,0)
 . W "$BILLED",U
"RTN","BPSRPT8",164,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",165,0)
 . W "$COLLECT",U
"RTN","BPSRPT8",166,0)
 . W "DRUG",U
"RTN","BPSRPT8",167,0)
 . W "NDC",U
"RTN","BPSRPT8",168,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",169,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",170,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",171,0)
 . W "STATUS",U
"RTN","BPSRPT8",172,0)
 . W "REJECTED"
"RTN","BPSRPT8",173,0)
 . I BPRTYPE=1 W U,"BILL#"
"RTN","BPSRPT8",174,0)
 . I BPRTYPE=4 W U,"REVERSAL METHOD",U,"RETURN STATUS",U,"REASON"
"RTN","BPSRPT8",175,0)
 ;
"RTN","BPSRPT8",176,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",177,0)
 . W "DATE",U
"RTN","BPSRPT8",178,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",179,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",180,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",181,0)
 . W "STATUS",U
"RTN","BPSRPT8",182,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",183,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",184,0)
 . W "$BILLED",U
"RTN","BPSRPT8",185,0)
 . W "QTY",U
"RTN","BPSRPT8",186,0)
 . W "NDC#",U
"RTN","BPSRPT8",187,0)
 . W "DRUG",U
"RTN","BPSRPT8",188,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",189,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",190,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",191,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",192,0)
 ;
"RTN","BPSRPT8",193,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",194,0)
 . W "DATE",U
"RTN","BPSRPT8",195,0)
 . W "$BILLED",U
"RTN","BPSRPT8",196,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",197,0)
 . W "DRUG",U
"RTN","BPSRPT8",198,0)
 . W "NDC",U
"RTN","BPSRPT8",199,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",200,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",201,0)
 . W "STATUS",U
"RTN","BPSRPT8",202,0)
 . W "REJECTED"
"RTN","BPSRPT8",203,0)
 ;
"RTN","BPSRPT8",204,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",205,0)
 . W "COMPLETED",U
"RTN","BPSRPT8",206,0)
 . W "TRANS TYPE",U
"RTN","BPSRPT8",207,0)
 . W "PAYER RESPONSE",U
"RTN","BPSRPT8",208,0)
 . W "DRUG",U
"RTN","BPSRPT8",209,0)
 . W "NDC",U
"RTN","BPSRPT8",210,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",211,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",212,0)
 . W "STATUS",U
"RTN","BPSRPT8",213,0)
 . W "REJECTED",U
"RTN","BPSRPT8",214,0)
 . W "INSURANCE",U
"RTN","BPSRPT8",215,0)
 . W "ELAP TIME IN SECONDS"
"RTN","BPSRPT8",216,0)
 ;
"RTN","BPSRPT8",217,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT8",218,0)
 .W "DATE",U
"RTN","BPSRPT8",219,0)
 .W "#CLAIMS",U
"RTN","BPSRPT8",220,0)
 .W "AMOUNT SUBMITTED",U
"RTN","BPSRPT8",221,0)
 .W "RETURNED REJECTED",U
"RTN","BPSRPT8",222,0)
 .W "RETURNED PAYABLE",U
"RTN","BPSRPT8",223,0)
 .W "AMOUNT TO RECEIVE",U
"RTN","BPSRPT8",224,0)
 .W "DIFFERENCE"
"RTN","BPSRPT8",225,0)
 ;
"RTN","BPSRPT8",226,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",227,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",228,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",229,0)
 . W "STATUS",U
"RTN","BPSRPT8",230,0)
 . W "REJECTED",U
"RTN","BPSRPT8",231,0)
 . W "DRUG",U
"RTN","BPSRPT8",232,0)
 . W "NDC",U
"RTN","BPSRPT8",233,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",234,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",235,0)
 . W "CLOSE DATE/TIME",U
"RTN","BPSRPT8",236,0)
 . W "CLOSED BY",U
"RTN","BPSRPT8",237,0)
 . W "CLOSE REASON",U
"RTN","BPSRPT8",238,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",239,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",240,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",241,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",242,0)
 Q
"RTN","BPSRPT8",243,0)
 ;
"RTN","BPSRPT8",244,0)
 ;Print Report Insurance Subtotals
"RTN","BPSRPT8",245,0)
 ;
"RTN","BPSRPT8",246,0)
ITOT(BPRTYPE,BPDIV,BPGRPLAN,BPTBIL,BPTINS,BPTCOLL,BPCNT) N BPNP
"RTN","BPSRPT8",247,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",248,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT8",249,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50),?78,$J(BPTBIL,10,2),?100,$J(BPTINS,10,2),?122,$J(BPTCOLL,10,2)
"RTN","BPSRPT8",250,0)
 .W !,"COUNT",?78,$J(BPCNT,10),?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT8",251,0)
 .W:BPCNT !,"MEAN",?78,$J(BPTBIL/BPCNT,10,2),?100,$J(BPTINS/BPCNT,10,2),?122,$J(BPTCOLL/BPCNT,10,2)
"RTN","BPSRPT8",252,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",253,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT8",254,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50),?100,$J(BPTBIL,10,2),?122,$J(BPTINS,10,2)
"RTN","BPSRPT8",255,0)
 .W !,"COUNT",?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT8",256,0)
 .W:BPCNT !,"MEAN",?100,$J(BPTBIL/BPCNT,10,2),?122,$J(BPTINS/BPCNT,10,2)
"RTN","BPSRPT8",257,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",258,0)
 .W !!,?41,"----------"
"RTN","BPSRPT8",259,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,22),?41,$J(BPTBIL,10,2)
"RTN","BPSRPT8",260,0)
 .W !,"COUNT",?41,$J(BPCNT,10)
"RTN","BPSRPT8",261,0)
 .W:BPCNT !,"MEAN",?41,$J(BPTBIL/BPCNT,10,2)
"RTN","BPSRPT8",262,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT8",263,0)
 .W !!,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50)
"RTN","BPSRPT8",264,0)
 .N BPBILR
"RTN","BPSRPT8",265,0)
 .S BPBILR="" F  S BPBILR=$O(BPCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT8",266,0)
 ..S BPNP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT8",267,0)
 ..W !,?3,BPBILR,?65,$J($G(BPCNT(BPBILR)),5)
"RTN","BPSRPT8",268,0)
 .Q:$G(BPQ)
"RTN","BPSRPT8",269,0)
 .W !,?65,"-----"
"RTN","BPSRPT8",270,0)
 .W !,"CLOSED CLAIMS SUBTOTAL",?65,$J(BPCNT,5)
"RTN","BPSRPT8",271,0)
 ;
"RTN","BPSRPT8",272,0)
 Q
"RTN","BPSRREV")
1^183
"RTN","BPSSCR01")
0^207^B17522420
"RTN","BPSSCR01",1,0)
BPSSCR01 ;BHAM ISC/SS - USER SCREEN ;10-MAR-2005
"RTN","BPSSCR01",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCR01",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR01",4,0)
 ;USER SCREEN
"RTN","BPSSCR01",5,0)
 Q
"RTN","BPSSCR01",6,0)
 ;User Screen header
"RTN","BPSSCR01",7,0)
 ;input:
"RTN","BPSSCR01",8,0)
 ; BPSLN - line of the header
"RTN","BPSSCR01",9,0)
 ;output:
"RTN","BPSSCR01",10,0)
 ; text string for the header
"RTN","BPSSCR01",11,0)
HDR(BPSLN) ; -- header code
"RTN","BPSSCR01",12,0)
 N BPARR,BPX,BPXSL
"RTN","BPSSCR01",13,0)
 Q:'$D(@VALMAR@("VIEWPARAMS"))
"RTN","BPSSCR01",14,0)
 D RESTVIEW(.BPARR)
"RTN","BPSSCR01",15,0)
 I BPSLN=1 Q "SELECTED DIVISION(S): "_$$GETVDIVS(.BPARR,58)
"RTN","BPSSCR01",16,0)
 I BPSLN=2 Q $$GETVDETS(.BPARR)
"RTN","BPSSCR01",17,0)
 I BPSLN=3 D  Q $$LINE^BPSSCRU3(80-$L(BPX)," ")_BPX
"RTN","BPSSCR01",18,0)
 . S BPXSL=$$SORTTYPE^BPSSCRSL($G(BPARR(1.12)))
"RTN","BPSSCR01",19,0)
 . I BPXSL="" S BPXSL="Transaction date by default"
"RTN","BPSSCR01",20,0)
 . S BPX="Sorted by: "_BPXSL
"RTN","BPSSCR01",21,0)
 Q ""
"RTN","BPSSCR01",22,0)
 ;/**
"RTN","BPSSCR01",23,0)
 ;get current view details
"RTN","BPSSCR01",24,0)
GETVDETS(BPARR) ;*/
"RTN","BPSSCR01",25,0)
 N BPSTR
"RTN","BPSSCR01",26,0)
 I $G(BPARR(1.01))="A" S BPSTR=$$LJ^BPSSCR02("Transmitted by ALL users",31)
"RTN","BPSSCR01",27,0)
 E  S BPSTR=$$LJ^BPSSCR02("Transmitted by "_$$GETUSRNM^BPSSCRU1($G(BPARR(1.16))),31)
"RTN","BPSSCR01",28,0)
 S BPSTR=BPSTR_$$LJ^BPSSCR02(" Activity Date Range: within the past "_$G(BPARR(1.05))_$S($G(BPARR(1.04))="H":" hour(s)",1:" day(s)"),49)
"RTN","BPSSCR01",29,0)
 Q BPSTR
"RTN","BPSSCR01",30,0)
 ;
"RTN","BPSSCR01",31,0)
 ;/**
"RTN","BPSSCR01",32,0)
 ;get divisions selected
"RTN","BPSSCR01",33,0)
GETVDIVS(BPARRAY,BPMLEN) ;*/
"RTN","BPSSCR01",34,0)
 I $G(BPARRAY(1.13))="A" Q "ALL"
"RTN","BPSSCR01",35,0)
 N BPDIV,BPCNT,BPSTR,BPQUIT
"RTN","BPSSCR01",36,0)
 S BPQUIT=0,BPSTR=""
"RTN","BPSSCR01",37,0)
 F BPCNT=1:1:20 S BPDIV=$P($G(BPARRAY("DIVS")),";",BPCNT+1) Q:+BPDIV=0  D  Q:BPQUIT=1
"RTN","BPSSCR01",38,0)
 . I $L(BPSTR_$$DIVNAME^BPSSCRDS(BPDIV))>(BPMLEN-4) D  S BPQUIT=1 Q
"RTN","BPSSCR01",39,0)
 . . S BPSTR=$$LJ^BPSSCR02(BPSTR_",...",BPMLEN)
"RTN","BPSSCR01",40,0)
 . S BPSTR=BPSTR_$S(BPCNT>1:", ",1:"")_$$DIVNAME^BPSSCRDS(BPDIV)
"RTN","BPSSCR01",41,0)
 Q BPSTR
"RTN","BPSSCR01",42,0)
 ;/**
"RTN","BPSSCR01",43,0)
 ;input:
"RTN","BPSSCR01",44,0)
 ; BPARR - local array to store user profile info
"RTN","BPSSCR01",45,0)
 ;returns:
"RTN","BPSSCR01",46,0)
 ; the last number in LM ARRAY
"RTN","BPSSCR01",47,0)
INIT() ; -- init variables and list array*/
"RTN","BPSSCR01",48,0)
 N BPLN,BPLM,BP59,BPSORT,BPTMPGL,BPRET
"RTN","BPSSCR01",49,0)
 N BPARR
"RTN","BPSSCR01",50,0)
 ;get user's ien in BPS PRFILE file
"RTN","BPSSCR01",51,0)
 ;if array is not defined then read information from file, 
"RTN","BPSSCR01",52,0)
 ;otherwise use current info from the array, because the user
"RTN","BPSSCR01",53,0)
 ;may specify criteria in array without saving it in file for
"RTN","BPSSCR01",54,0)
 ;the temporary use
"RTN","BPSSCR01",55,0)
 I '$D(@VALMAR@("VIEWPARAMS")) D
"RTN","BPSSCR01",56,0)
 . D READPROF^BPSSCRSL(.BPARR,+DUZ)
"RTN","BPSSCR01",57,0)
 . D SAVEVIEW(.BPARR)
"RTN","BPSSCR01",58,0)
 E  D RESTVIEW(.BPARR)
"RTN","BPSSCR01",59,0)
 ;get date/time range
"RTN","BPSSCR01",60,0)
 I $$GETDT^BPSSCRU1(.BPARR)=0 Q
"RTN","BPSSCR01",61,0)
 S BPTMPGL=$NA(^TMP($J,"BPSSCR"))
"RTN","BPSSCR01",62,0)
 K @BPTMPGL,@VALMAR
"RTN","BPSSCR01",63,0)
 D COLLECT^BPSSCR04(BPTMPGL,.BPARR)
"RTN","BPSSCR01",64,0)
 D SAVEVIEW(.BPARR)
"RTN","BPSSCR01",65,0)
 S BPRET=$$LMARRAY(BPTMPGL,.BPARR)
"RTN","BPSSCR01",66,0)
 K @BPTMPGL
"RTN","BPSSCR01",67,0)
 S:BPRET>1 BPRET=BPRET-1
"RTN","BPSSCR01",68,0)
 Q BPRET
"RTN","BPSSCR01",69,0)
 ;
"RTN","BPSSCR01",70,0)
 ;/**
"RTN","BPSSCR01",71,0)
 ;make elements for List Manager array
"RTN","BPSSCR01",72,0)
 ;input:
"RTN","BPSSCR01",73,0)
 ;BPTMPGL - TMP global to store selected claims
"RTN","BPSSCR01",74,0)
 ;BPARR - local array to store user profile info
"RTN","BPSSCR01",75,0)
 ;returns:
"RTN","BPSSCR01",76,0)
 ; the last number in LM ARRAY
"RTN","BPSSCR01",77,0)
 ;indexing (example):
"RTN","BPSSCR01",78,0)
 ;S ^TMP("BPSSCR",$J,"VALM",1,0)="2   BUMSTEAD,CHARLE 5444 WEBMD"
"RTN","BPSSCR01",79,0)
 ;S ^TMP("BPSSCR",$J,"VALM",2,0)="    2.1  CEFACLOR 500MG CAP"
"RTN","BPSSCR01",80,0)
 ;S ^TMP("BPSSCR",$J,"VALM",3,0)="    2.2  AMPICILLIN 250MG CAP"
"RTN","BPSSCR01",81,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2,437272,7008776.00001,0)=""
"RTN","BPSSCR01",82,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2.1,437272,7008778.00011,1)=""
"RTN","BPSSCR01",83,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2.2,437272,7009457.00001,2)=""
"RTN","BPSSCR01",84,0)
LMARRAY(BPTMPGL,BPARR) ;*/
"RTN","BPSSCR01",85,0)
 N BPSRTVAL,BP59,BPSORT,BPLN,BPLM,BPSTR1,BPCLM,BPPREV
"RTN","BPSSCR01",86,0)
 S BPLM=0 ;patient_AND_insurance level counter
"RTN","BPSSCR01",87,0)
 S BPCLM=0 ;claim level counter 
"RTN","BPSSCR01",88,0)
 S BP59=0
"RTN","BPSSCR01",89,0)
 S BPLN=1 ;line counter for List manager array to display on the screen
"RTN","BPSSCR01",90,0)
 S BPPREV=0 ;to store data from previous patient group
"RTN","BPSSCR01",91,0)
 ;sort type:
"RTN","BPSSCR01",92,0)
 ;'T' FOR TRANSACTION DATE
"RTN","BPSSCR01",93,0)
 ;'D' FOR DIVISION (ECME pharmacy)
"RTN","BPSSCR01",94,0)
 ;'I' FOR INSURANCE
"RTN","BPSSCR01",95,0)
 ;'C' FOR REJECT CODE 
"RTN","BPSSCR01",96,0)
 ;'P' FOR PATIENT NAME
"RTN","BPSSCR01",97,0)
 ;'N' FOR DRUG NAME
"RTN","BPSSCR01",98,0)
 ;'B' FOR BILL TYPE (BB/RT)
"RTN","BPSSCR01",99,0)
 ;'L' FOR FILL LOCATION (Windows/Mail/CMOP) 
"RTN","BPSSCR01",100,0)
 ;'R' FOR RELEASED/NON-RELEASED RX
"RTN","BPSSCR01",101,0)
 ;'A' FOR ACTIVE/DISCONTINUED RX
"RTN","BPSSCR01",102,0)
 S BPSORT=$G(BPARR(1.12))
"RTN","BPSSCR01",103,0)
 S:BPSORT="" BPSORT="T" ;default
"RTN","BPSSCR01",104,0)
 S BPSRTVAL="" ;a value that "makes" an order, can be a string
"RTN","BPSSCR01",105,0)
 F  S BPSRTVAL=$O(@BPTMPGL@("SORT",BPSORT,BPSRTVAL)) Q:BPSRTVAL=""  D
"RTN","BPSSCR01",106,0)
 . I BPSORT="D" D
"RTN","BPSSCR01",107,0)
 . . S BPSTR1="---- Division: "_$$DIVNAME^BPSSCRDS(+$P(BPSRTVAL,U,2))_" "
"RTN","BPSSCR01",108,0)
 . . D SET^VALM10(BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"),0)
"RTN","BPSSCR01",109,0)
 . . S BPLN=BPLN+1
"RTN","BPSSCR01",110,0)
 . I BPSORT="C" D
"RTN","BPSSCR01",111,0)
 . . S BPSTR1=$E("---- Reject code: "_$$GETRJNAM^BPSSCRU3(BPSRTVAL)_" ",1,79)
"RTN","BPSSCR01",112,0)
 . . D SET^VALM10(BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"),0)
"RTN","BPSSCR01",113,0)
 . . S BPLN=BPLN+1
"RTN","BPSSCR01",114,0)
 . S BP59=0
"RTN","BPSSCR01",115,0)
 . F  S BP59=+$O(@BPTMPGL@("SORT",BPSORT,BPSRTVAL,BP59)) Q:+BP59=0  D
"RTN","BPSSCR01",116,0)
 . . I BP59'=0 D MKARRELM^BPSSCR02(.BPLN,VALMAR,BP59,.BPLM,.BPCLM,.BPPREV)
"RTN","BPSSCR01",117,0)
 D UPDPREV^BPSSCR02(VALMAR,BPLM,BPPREV)
"RTN","BPSSCR01",118,0)
 Q BPLN
"RTN","BPSSCR01",119,0)
 ;
"RTN","BPSSCR01",120,0)
HELP ; -- help code
"RTN","BPSSCR01",121,0)
 N X S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCR01",122,0)
 Q
"RTN","BPSSCR01",123,0)
 ;
"RTN","BPSSCR01",124,0)
EXIT ; -- exit code
"RTN","BPSSCR01",125,0)
 Q
"RTN","BPSSCR01",126,0)
 ;
"RTN","BPSSCR01",127,0)
EXPND ; -- expand code
"RTN","BPSSCR01",128,0)
 Q
"RTN","BPSSCR01",129,0)
 ;/**
"RTN","BPSSCR01",130,0)
 ;store current view params in VALMAR("VIEWPARAMS") TMP global array
"RTN","BPSSCR01",131,0)
 ;to display in the header
"RTN","BPSSCR01",132,0)
 ;input: 
"RTN","BPSSCR01",133,0)
 ; BPARR - array with user profile info to store
"RTN","BPSSCR01",134,0)
SAVEVIEW(BPARR) ;        S @VALMAR@("VIEWPARAMS",BPLMIND,BPDFN,BP59,BPLINE)=""
"RTN","BPSSCR01",135,0)
 Q:'$D(BPARR)
"RTN","BPSSCR01",136,0)
 M @VALMAR@("VIEWPARAMS")=BPARR
"RTN","BPSSCR01",137,0)
 Q
"RTN","BPSSCR01",138,0)
 ;
"RTN","BPSSCR01",139,0)
 ;/**
"RTN","BPSSCR01",140,0)
 ;restore current view params from VALMAR("VIEWPARAMS") TMP global array
"RTN","BPSSCR01",141,0)
 ;input: 
"RTN","BPSSCR01",142,0)
 ; BPARR - array with user profile info to store
"RTN","BPSSCR01",143,0)
RESTVIEW(BPARR) ;        S @VALMAR@("VIEWPARAMS",BPLMIND,BPDFN,BP59,BPLINE)=""
"RTN","BPSSCR01",144,0)
 Q:'$D(@VALMAR@("VIEWPARAMS"))
"RTN","BPSSCR01",145,0)
 M BPARR=@VALMAR@("VIEWPARAMS")
"RTN","BPSSCR01",146,0)
 Q
"RTN","BPSSCR01",147,0)
 ;
"RTN","BPSSCR03")
0^36^B43854425
"RTN","BPSSCR03",1,0)
BPSSCR03 ;BHAM ISC/SS - ECME USR SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR03",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCR03",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR03",4,0)
 Q
"RTN","BPSSCR03",5,0)
 ;/**
"RTN","BPSSCR03",6,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR03",7,0)
 ; BPARR to return formatted info via ref
"RTN","BPSSCR03",8,0)
 ; BPMLEM - max len for each line
"RTN","BPSSCR03",9,0)
 ; BPMODE - mode
"RTN","BPSSCR03",10,0)
 ;   R -regular for main screen, will show only latest comment
"RTN","BPSSCR03",11,0)
 ;   C - comment mode - show all comments
"RTN","BPSSCR03",12,0)
ADDINF(BP59,BPARR,BPMLEN,BPMODE) ;to return additional information about the claim*/
"RTN","BPSSCR03",13,0)
 N BPX,BPN,BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1,BPPRCNTG,BPN2,BPSTATUS
"RTN","BPSSCR03",14,0)
 S BPN=0,(BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1)=""
"RTN","BPSSCR03",15,0)
 I BPMODE="R" D
"RTN","BPSSCR03",16,0)
 . S BPX=$$COMMENT^BPSSCRU3(BP59)
"RTN","BPSSCR03",17,0)
 . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=$P(BPX,U)
"RTN","BPSSCR03",18,0)
 . I $P(BPX,U,2)]"" S BPN=BPN+1,BPARR(BPN)="("_$P(BPX,U,2)_")"
"RTN","BPSSCR03",19,0)
 E  D
"RTN","BPSSCR03",20,0)
 . N BPCMNT,BPX1 S BPCMNT=99999999
"RTN","BPSSCR03",21,0)
 . F  S BPCMNT=$O(^BPST(BP59,11,BPCMNT),-1) Q:+BPCMNT=0  D
"RTN","BPSSCR03",22,0)
 . . S BPX1=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCR03",23,0)
 . . I BPX1="" Q
"RTN","BPSSCR03",24,0)
 . . S BPX=$$DATTIM^BPSSCRU3($P(BPX1,U,1)\1)_" - "_$P(BPX1,U,3)
"RTN","BPSSCR03",25,0)
 . . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",26,0)
 . . I +$P(BPX1,U,2)]"" D
"RTN","BPSSCR03",27,0)
 . . . S BPX=$$USERNAM^BPSCMT01(+$P(BPX1,U,2))
"RTN","BPSSCR03",28,0)
 . . . I BPX'="" S BPX="("_BPX_")",BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",29,0)
 S BPX=$$CLAIMST^BPSSCRU3(BP59)
"RTN","BPSSCR03",30,0)
 S BPSTATUS=$P(BPX,U)
"RTN","BPSSCR03",31,0)
 S BPPRCNTG=$$LJ^BPSSCR02("("_$$PRCNTG^BPSSCRU3(BP59)_"%) ",6)
"RTN","BPSSCR03",32,0)
 ;I BPX["AR" S BPARR(BPN)="Auto-Reversal",BPN=BPN+1
"RTN","BPSSCR03",33,0)
 I BPSTATUS["E REVERSAL ACCEPTED" S BPTXT1=BPTXT1_"Reversal accepted "
"RTN","BPSSCR03",34,0)
 I BPSTATUS["E REVERSAL REJECTED" S BPTXT1=BPTXT1_"Reversal rejected "
"RTN","BPSSCR03",35,0)
 I BPSTATUS["E PAYABLE" S BPTXT1=BPTXT1_"Payable "
"RTN","BPSSCR03",36,0)
 I BPSTATUS["E REJECTED" S BPTXT1=BPTXT1_"Rejected "
"RTN","BPSSCR03",37,0)
 I BPSTATUS["E STRANDED" S BPTXT1=BPTXT1_"Stranded "
"RTN","BPSSCR03",38,0)
 I BPSTATUS["E REVERSAL STRANDED" S BPTXT1=BPTXT1_"Stranded reversal"
"RTN","BPSSCR03",39,0)
 I BPSTATUS["E CAPTURED" S BPTXT1=BPTXT1_"Captured "
"RTN","BPSSCR03",40,0)
 I BPSTATUS["E DUPLICATE" S BPTXT1=BPTXT1_"Duplicate "
"RTN","BPSSCR03",41,0)
 I BPSTATUS["E OTHER" S BPTXT1=BPTXT1_"Other "
"RTN","BPSSCR03",42,0)
 I BPSTATUS["IN PROGRESS" S BPTXT1=BPTXT1_"In progress "
"RTN","BPSSCR03",43,0)
 I BPSTATUS["CORRUPT" S BPTXT1=BPTXT1_"Corrupt "
"RTN","BPSSCR03",44,0)
 I BPSTATUS["E REVERSAL OTHER" S BPTXT1=BPTXT1_"Reversal Other "
"RTN","BPSSCR03",45,0)
 I BPTXT1="" S BPTXT1="Unknown status "
"RTN","BPSSCR03",46,0)
 ;
"RTN","BPSSCR03",47,0)
 I (BPSTATUS["E REJECTED")!(BPSTATUS["E REVERSAL REJECTED") D
"RTN","BPSSCR03",48,0)
 . I $L(BPTXT1)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT1
"RTN","BPSSCR03",49,0)
 . S BPTXT1=""
"RTN","BPSSCR03",50,0)
 . S BPN2=BPN
"RTN","BPSSCR03",51,0)
 . D GETRJCOD^BPSSCRU3(BP59,.BPARR,.BPN,74,"")
"RTN","BPSSCR03",52,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,504,BP59),74,"",0)
"RTN","BPSSCR03",53,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,526,BP59),74,"",0)
"RTN","BPSSCR03",54,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(504,0,BP59),74,"",0)
"RTN","BPSSCR03",55,0)
 . I BPN>BPN2 Q  ;reject codes are enough
"RTN","BPSSCR03",56,0)
 . ;S BPX1=$P($P(BPX,U,3),"[") I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",57,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",58,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",59,0)
 ;
"RTN","BPSSCR03",60,0)
 I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS")!(BPSTATUS["E STRANDED")!(BPSTATUS["E CAPTURED")!(BPSTATUS["E REVERSAL STRANDED") D
"RTN","BPSSCR03",61,0)
 . I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS") S BPX1=$P(BPX,U,3) I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",62,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",63,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",64,0)
 ;
"RTN","BPSSCR03",65,0)
 S BPTXT2=$E(BPTXT1,1,BPMLEN)
"RTN","BPSSCR03",66,0)
 S BPTXT3=$E(BPTXT1,BPMLEN+1,2*BPMLEN)
"RTN","BPSSCR03",67,0)
 S BPTXT4=$E(BPTXT1,(2*BPMLEN)+1,3*BPMLEN)
"RTN","BPSSCR03",68,0)
 I $L(BPTXT2)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT2
"RTN","BPSSCR03",69,0)
 I $L(BPTXT3)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT3
"RTN","BPSSCR03",70,0)
 I $L(BPTXT4)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT4
"RTN","BPSSCR03",71,0)
 Q BPN
"RTN","BPSSCR03",72,0)
 ;
"RTN","BPSSCR03",73,0)
CLMINF(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",74,0)
 W !,"Claim info. Press a key"
"RTN","BPSSCR03",75,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",76,0)
 Q
"RTN","BPSSCR03",77,0)
 ;
"RTN","BPSSCR03",78,0)
 ;
"RTN","BPSSCR03",79,0)
COMM(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",80,0)
 W !,"the latest comment. Press a key"
"RTN","BPSSCR03",81,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",82,0)
 Q
"RTN","BPSSCR03",83,0)
 ;
"RTN","BPSSCR03",84,0)
RESP(BP59) ;Payer Response Information
"RTN","BPSSCR03",85,0)
 W !,"payer Response Information. Press a key"
"RTN","BPSSCR03",86,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",87,0)
 Q
"RTN","BPSSCR03",88,0)
 ;
"RTN","BPSSCR03",89,0)
 ;/**
"RTN","BPSSCR03",90,0)
 ;Checks if the CLAIM for specific Transaction is CLOSED?
"RTN","BPSSCR03",91,0)
 ;BPCLAIM - ptr to #9002313.02
"RTN","BPSSCR03",92,0)
 ;see also CLOSED^BPSSCRU1
"RTN","BPSSCR03",93,0)
CLOSED02(BPCLAIM) ;*/
"RTN","BPSSCR03",94,0)
 ; get closed status
"RTN","BPSSCR03",95,0)
 Q +$P($G(^BPSC(BPCLAIM,900)),U)=1  ;Q $$GET1^DIQ(9002313.02,CLAIM,901,"I")
"RTN","BPSSCR03",96,0)
 ;
"RTN","BPSSCR03",97,0)
 ;return:
"RTN","BPSSCR03",98,0)
 ; 1 - okay. matches criteria
"RTN","BPSSCR03",99,0)
 ; 0-  not okay, doesn't match criteria
"RTN","BPSSCR03",100,0)
FILTER(BP59,BPARR) ;
"RTN","BPSSCR03",101,0)
 N BPST0,BPST1,BPRXREF,BPRX52,BPREFNUM
"RTN","BPSSCR03",102,0)
 N BPRET
"RTN","BPSSCR03",103,0)
 S BPRET=1 ;1 - okay bt default
"RTN","BPSSCR03",104,0)
 S BPST0=$G(^BPST(BP59,0))
"RTN","BPSSCR03",105,0)
 S BPST1=$G(^BPST(BP59,1))
"RTN","BPSSCR03",106,0)
 S BPRXREF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCR03",107,0)
 S BPRX52=+$P(BPRXREF,U) ;ptr to #52
"RTN","BPSSCR03",108,0)
 S BPREFNUM=$P(BPRXREF,U,2) ;refill #
"RTN","BPSSCR03",109,0)
 ;if closed
"RTN","BPSSCR03",110,0)
 I $$CLOSED02(+$P(BPST0,U,4)) Q 0
"RTN","BPSSCR03",111,0)
 ;user
"RTN","BPSSCR03",112,0)
 I $G(BPARR(1.01))="U",$$FLTUSR(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",113,0)
 ;patient
"RTN","BPSSCR03",114,0)
 I $G(BPARR(1.02))="P",$$FLTPAT(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",115,0)
 ;RX
"RTN","BPSSCR03",116,0)
 I $G(BPARR(1.03))="R",$$FLTRX(BPST1,.BPARR)=0 Q 0
"RTN","BPSSCR03",117,0)
 ;only rejected
"RTN","BPSSCR03",118,0)
 I $G(BPARR(1.06))="R",$$REJECTED^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",119,0)
 ;only payable
"RTN","BPSSCR03",120,0)
 I $G(BPARR(1.06))="P",$$PAYABLE^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",121,0)
 ;released
"RTN","BPSSCR03",122,0)
 I $G(BPARR(1.07))="R",$$RL^BPSSCRU2(BP59)'="RL" Q 0
"RTN","BPSSCR03",123,0)
 ;non released
"RTN","BPSSCR03",124,0)
 I $G(BPARR(1.07))="N",$$RL^BPSSCRU2(BP59)="RL" Q 0
"RTN","BPSSCR03",125,0)
 ;window/cmop/mail
"RTN","BPSSCR03",126,0)
 I $G(BPARR(1.08))'="A",$$ISMWC(BPRX52,BPREFNUM,$G(BPARR(1.08)))=0 Q 0
"RTN","BPSSCR03",127,0)
 ;Back billing
"RTN","BPSSCR03",128,0)
 I $G(BPARR(1.09))="B",$$RTBB^BPSSCRU2(BP59)'="BB" Q 0
"RTN","BPSSCR03",129,0)
 ;real time
"RTN","BPSSCR03",130,0)
 I $G(BPARR(1.09))="R",$$RTBB^BPSSCRU2(BP59)="BB" Q 0
"RTN","BPSSCR03",131,0)
 ;if only rejected and only specific rejected codes should be displayed
"RTN","BPSSCR03",132,0)
 I $G(BPARR(1.06))="R",$G(BPARR(1.1))="R",$$FLTREJ(BP59,.BPARR)=0 Q 0
"RTN","BPSSCR03",133,0)
 ;insurance
"RTN","BPSSCR03",134,0)
 I $G(BPARR(1.11))="I",$G(BPARR(1.14))'="",$P($$GETINSUR^BPSSCRU2(+BP59),U,2)'=$G(BPARR(1.14)) Q 0
"RTN","BPSSCR03",135,0)
 ;divisions - ECME pharmacies
"RTN","BPSSCR03",136,0)
 I $G(BPARR(1.13))="D",BPARR("DIVS")'[(";"_$P(BPST1,U,7)_";") Q 0
"RTN","BPSSCR03",137,0)
 Q 1
"RTN","BPSSCR03",138,0)
 ;
"RTN","BPSSCR03",139,0)
 ;check user filter
"RTN","BPSSCR03",140,0)
 ;input:
"RTN","BPSSCR03",141,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",142,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",143,0)
 ;returns :
"RTN","BPSSCR03",144,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",145,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",146,0)
FLTUSR(BPST0,BPARR) ;
"RTN","BPSSCR03",147,0)
 I $L($G(BPARR(1.16)))=0 Q 0
"RTN","BPSSCR03",148,0)
 I $P(BPST0,U,10)'=$G(BPARR(1.16)) Q 0
"RTN","BPSSCR03",149,0)
 Q 1
"RTN","BPSSCR03",150,0)
 ;check patient filter
"RTN","BPSSCR03",151,0)
 ;input:
"RTN","BPSSCR03",152,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",153,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",154,0)
 ;returns :
"RTN","BPSSCR03",155,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",156,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",157,0)
FLTPAT(BPST0,BPARR) ;
"RTN","BPSSCR03",158,0)
 I $L($G(BPARR(1.17)))=0 Q 0
"RTN","BPSSCR03",159,0)
 I $P(BPST0,U,6)'=$G(BPARR(1.17)) Q 0
"RTN","BPSSCR03",160,0)
 Q 1
"RTN","BPSSCR03",161,0)
 ;check RX filter
"RTN","BPSSCR03",162,0)
 ;input:
"RTN","BPSSCR03",163,0)
 ;BPST1 - 1st node of #9002313.59
"RTN","BPSSCR03",164,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",165,0)
 ;returns :
"RTN","BPSSCR03",166,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",167,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",168,0)
FLTRX(BPST1,BPARR) ;
"RTN","BPSSCR03",169,0)
 I $L($G(BPARR(1.18)))=0 Q 0
"RTN","BPSSCR03",170,0)
 I $P(BPST1,U,11)'=$G(BPARR(1.18)) Q 0
"RTN","BPSSCR03",171,0)
 Q 1
"RTN","BPSSCR03",172,0)
 ;input:
"RTN","BPSSCR03",173,0)
 ;BP59 - zero node of #9002313.59
"RTN","BPSSCR03",174,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",175,0)
 ;returns :
"RTN","BPSSCR03",176,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",177,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",178,0)
FLTREJ(BP59,BPARR) ;
"RTN","BPSSCR03",179,0)
 N BPRCODES
"RTN","BPSSCR03",180,0)
 N BPRJCD
"RTN","BPSSCR03",181,0)
 S BPRJCD=$P($G(^BPSF(9002313.93,+$G(BPARR(1.15)),0)),U)
"RTN","BPSSCR03",182,0)
 I $L(BPRJCD)=0 Q 0
"RTN","BPSSCR03",183,0)
 D REJCODES^BPSSCRU3(BP59,.BPRCODES)
"RTN","BPSSCR03",184,0)
 I $D(BPRCODES(BPRJCD)) Q 1
"RTN","BPSSCR03",185,0)
 Q 0
"RTN","BPSSCR03",186,0)
 ;check W(indow)/C(mop)/M(ail)
"RTN","BPSSCR03",187,0)
 ;input:
"RTN","BPSSCR03",188,0)
 ;BPRX52 - ptr to #52
"RTN","BPSSCR03",189,0)
 ;BPREFNUM - refill #
"RTN","BPSSCR03",190,0)
 ;BPMWC - given value from CMOP/MAIL/WINDOW instance 1.08 of BPS USRSCR parameters
"RTN","BPSSCR03",191,0)
 ;returns :
"RTN","BPSSCR03",192,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",193,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",194,0)
ISMWC(BPRX52,BPREFNUM,BPMWC) ;
"RTN","BPSSCR03",195,0)
 I $$MWCNAME^BPSSCRU2($$MWC^BPSSCRU2(BPRX52,BPREFNUM))=BPMWC Q 1
"RTN","BPSSCR03",196,0)
 Q 0
"RTN","BPSSCR03",197,0)
 ;
"RTN","BPSSCR03",198,0)
FILTRALL(BPTMP1,BPTMP2,BPARR) ;
"RTN","BPSSCR03",199,0)
 N BP59
"RTN","BPSSCR03",200,0)
 S BP59=0
"RTN","BPSSCR03",201,0)
 F  S BP59=+$O(@BPTMP1@(BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",202,0)
 . I $$FILTER(BP59,.BPARR) S @BPTMP2@(BP59)=""
"RTN","BPSSCR03",203,0)
 Q
"RTN","BPSSCR03",204,0)
 ;
"RTN","BPSSCR03",205,0)
 ;go thru all FILE59 entries and run SETTRDFN for each of them
"RTN","BPSSCR03",206,0)
 ;
"RTN","BPSSCR03",207,0)
TRDFNALL(BPTMP) ;
"RTN","BPSSCR03",208,0)
 N BP59
"RTN","BPSSCR03",209,0)
 S BP59=0
"RTN","BPSSCR03",210,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",211,0)
 . D SETTRDFN(BPTMP,BP59)
"RTN","BPSSCR03",212,0)
 Q
"RTN","BPSSCR03",213,0)
 ;
"RTN","BPSSCR03",214,0)
 ;sorting for "TRANSACTION DATE" type is
"RTN","BPSSCR03",215,0)
 ;actually sorting by patients , but patient should be sorted not in alphabetical order:
"RTN","BPSSCR03",216,0)
 ;the first patient is the one which has the most recent transaction and so on
"RTN","BPSSCR03",217,0)
 ;BPTMP - TMP global
"RTN","BPSSCR03",218,0)
 ;BP59 - ptr to #9002313.59
"RTN","BPSSCR03",219,0)
SETTRDFN(BPTMP,BP59) ;
"RTN","BPSSCR03",220,0)
 ;the following stores the latest transaction date of the claims, which
"RTN","BPSSCR03",221,0)
 ;was found for this particular combination of patient and insurance
"RTN","BPSSCR03",222,0)
 ;@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",223,0)
 ;the following stores the latest transaction date BPTRDT,patient BPDFN and
"RTN","BPSSCR03",224,0)
 ;insurance BPINSUR to provide a proper order
"RTN","BPSSCR03",225,0)
 ;@BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",226,0)
 N BPZERO,BPTRDT,BPDFN,BPPREV,BPINSUR
"RTN","BPSSCR03",227,0)
 S BPZERO=$G(^BPST(BP59,0)) ;
"RTN","BPSSCR03",228,0)
 S BPTRDT=-$P(BPZERO,U,8) ;"transaction" date
"RTN","BPSSCR03",229,0)
 S BPDFN=+$P(BPZERO,U,6) ;patient ptr to #2
"RTN","BPSSCR03",230,0)
 S BPINSUR=+$$GETINSUR^BPSSCRU2(BP59) ;insurance ien
"RTN","BPSSCR03",231,0)
 ;in the beginning we don't have any "DFN-TRDT" and "TRDTDFN"
"RTN","BPSSCR03",232,0)
 ;so create them and quit
"RTN","BPSSCR03",233,0)
 I '$D(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)) D  Q
"RTN","BPSSCR03",234,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",235,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",236,0)
 ;if we already have them then get the latest into BPPREV
"RTN","BPSSCR03",237,0)
 S BPPREV=+$G(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR))
"RTN","BPSSCR03",238,0)
 ;and compare it against the BPTRDT for this BP59
"RTN","BPSSCR03",239,0)
 ;if the BPTRDT is greater then replace the values in "DFN-TRDT"
"RTN","BPSSCR03",240,0)
 ;and "TRDTDFN"
"RTN","BPSSCR03",241,0)
 I BPTRDT<BPPREV D
"RTN","BPSSCR03",242,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",243,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",244,0)
 . K @BPTMP@("TRDTDFN",BPPREV,BPDFN,BPINSUR)
"RTN","BPSSCR03",245,0)
 Q
"RTN","BPSSCR04")
0^210^B53618434
"RTN","BPSSCR04",1,0)
BPSSCR04 ;BHAM ISC/SS - USER SCREEN ;14-FEB-05
"RTN","BPSSCR04",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCR04",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR04",4,0)
 ;USER SCREEN
"RTN","BPSSCR04",5,0)
 Q
"RTN","BPSSCR04",6,0)
 ;input:
"RTN","BPSSCR04",7,0)
 ;BPTMP - TMP global to store data (example : $NA(^TMP($J,"BPSSCR")))
"RTN","BPSSCR04",8,0)
 ;BPARR - array with user profile information
"RTN","BPSSCR04",9,0)
COLLECT(BPTMP,BPARR) ;
"RTN","BPSSCR04",10,0)
 N BPBDT,BPEDT,BPSORT
"RTN","BPSSCR04",11,0)
 S BPBDT=BPARR("BDT") ;start date
"RTN","BPSSCR04",12,0)
 S BPEDT=BPARR("EDT") ;end date
"RTN","BPSSCR04",13,0)
 ;sort type - see SORTIT()
"RTN","BPSSCR04",14,0)
 S BPSORT=$G(BPARR(1.12))
"RTN","BPSSCR04",15,0)
 S:BPSORT="" BPSORT="T" ;default
"RTN","BPSSCR04",16,0)
 ;kill TMP
"RTN","BPSSCR04",17,0)
 ;look for  claims in 3 files
"RTN","BPSSCR04",18,0)
 ;temporary TMP file
"RTN","BPSSCR04",19,0)
 N BPTMP1 S BPTMP1=$NA(@BPTMP@("PRE59"))
"RTN","BPSSCR04",20,0)
 N BPTMP2 S BPTMP2=$NA(@BPTMP@("FILE59"))
"RTN","BPSSCR04",21,0)
 K @BPTMP1
"RTN","BPSSCR04",22,0)
 K @BPTMP2
"RTN","BPSSCR04",23,0)
 ;
"RTN","BPSSCR04",24,0)
 D LOOK02(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",25,0)
 D LOOK57(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",26,0)
 D LOOK59(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",27,0)
 ;remove all claims that don't match filter criteria
"RTN","BPSSCR04",28,0)
 D FILTRALL^BPSSCR03(BPTMP1,BPTMP2,.BPARR)
"RTN","BPSSCR04",29,0)
 ;preliminary sorting for "T" sorting type
"RTN","BPSSCR04",30,0)
 I BPSORT="T" D TRDFNALL^BPSSCR03(BPTMP)
"RTN","BPSSCR04",31,0)
 ;final sorting 
"RTN","BPSSCR04",32,0)
 D SORTIT(BPTMP,BPSORT)
"RTN","BPSSCR04",33,0)
 K @BPTMP1
"RTN","BPSSCR04",34,0)
 K @BPTMP2
"RTN","BPSSCR04",35,0)
 Q
"RTN","BPSSCR04",36,0)
 ;Input:
"RTN","BPSSCR04",37,0)
 ;BPTMP - TMP global to store data (example : $NA(^TMP($J,"BPSSCR")))
"RTN","BPSSCR04",38,0)
 ;BPSORT:
"RTN","BPSSCR04",39,0)
 ;'T' FOR TRANSACTION DATE
"RTN","BPSSCR04",40,0)
 ;'D' FOR DIVISION (ECME pharmacy)
"RTN","BPSSCR04",41,0)
 ;'I' FOR INSURANCE
"RTN","BPSSCR04",42,0)
 ;'C' FOR REJECT CODE 
"RTN","BPSSCR04",43,0)
 ;'P' FOR PATIENT NAME
"RTN","BPSSCR04",44,0)
 ;'N' FOR DRUG NAME
"RTN","BPSSCR04",45,0)
 ;'B' FOR BILL TYPE (BB/RT)
"RTN","BPSSCR04",46,0)
 ;'L' FOR FILL LOCATION (Windows/Mail/CMOP) 
"RTN","BPSSCR04",47,0)
 ;'R' FOR RELEASED/NON-RELEASED RX
"RTN","BPSSCR04",48,0)
 ;'A' FOR ACTIVE/DISCONTINUED RX
"RTN","BPSSCR04",49,0)
 ;sort it and prepare the TMP for the user screen
"RTN","BPSSCR04",50,0)
SORTIT(BPTMP,BPSORT) ;*/
"RTN","BPSSCR04",51,0)
 ;S BP59=+$G(^TMP($J,"BPSSCR","SRT",BPSRT))
"RTN","BPSSCR04",52,0)
 ;BPSORT:
"RTN","BPSSCR04",53,0)
 ;TRANSACTION DATE - the last time when the record 
"RTN","BPSSCR04",54,0)
 ;in the file #9002313.59 -- BPS TRANSACTION FILE has been updated
"RTN","BPSSCR04",55,0)
 ;F   S X=$O(@BPTMP@("SRT",BPSRT))
"RTN","BPSSCR04",56,0)
 K @BPTMP@("SORT")
"RTN","BPSSCR04",57,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPIEN,BPIENNM
"RTN","BPSSCR04",58,0)
 S BP59=0
"RTN","BPSSCR04",59,0)
 ;by transaction date -- sort by the patient/insurance combinations,
"RTN","BPSSCR04",60,0)
 ;which might have more than one claims. 
"RTN","BPSSCR04",61,0)
 ;- the first on the top will be the one which has the claim(s) with the 
"RTN","BPSSCR04",62,0)
 ;  most recent date (other claims in this group can have any other date)
"RTN","BPSSCR04",63,0)
 I BPSORT="T" D
"RTN","BPSSCR04",64,0)
 . D MKPATINS(BPTMP) ;1st step
"RTN","BPSSCR04",65,0)
 . D MKTRSORT(BPTMP) ;2nd step
"RTN","BPSSCR04",66,0)
 ;by patient name (and his/her insurances)
"RTN","BPSSCR04",67,0)
 I BPSORT="P" D
"RTN","BPSSCR04",68,0)
 . D MKNAMINS(BPTMP) ;1st step
"RTN","BPSSCR04",69,0)
 . D MKPTSORT(BPTMP) ;2nd step
"RTN","BPSSCR04",70,0)
 ;by insurance
"RTN","BPSSCR04",71,0)
 ;(the name will be shortened up to 10 chars and its 
"RTN","BPSSCR04",72,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",73,0)
 I BPSORT="I" D
"RTN","BPSSCR04",74,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",75,0)
 . . S BPIEN=$$GETINSUR^BPSSCRU2(+BP59)
"RTN","BPSSCR04",76,0)
 . . S BPIENNM=$S(+BPIEN>0:$E($P(BPIEN,U,2),1,10)_U_(+BPIEN),1:"0")
"RTN","BPSSCR04",77,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",78,0)
 ;by division
"RTN","BPSSCR04",79,0)
 ;(the name will be shortened up to 10 chars and its 
"RTN","BPSSCR04",80,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",81,0)
 I BPSORT="D" D
"RTN","BPSSCR04",82,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",83,0)
 . . S BPIEN=+$$DIVIS^BPSSCRU2(+BP59)
"RTN","BPSSCR04",84,0)
 . . S BPIENNM=$S(BPIEN>0:$E($$DIVNAME^BPSSCRDS(BPIEN),1,10)_U_(BPIEN),1:"0")
"RTN","BPSSCR04",85,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",86,0)
 ;by reject code
"RTN","BPSSCR04",87,0)
 ;the same claim can be listed more than once (under different reject code
"RTN","BPSSCR04",88,0)
 ;sections) because each claim may have more than one reject code.
"RTN","BPSSCR04",89,0)
 I BPSORT="C" D
"RTN","BPSSCR04",90,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",91,0)
 . . N BPRJCDS,BPRJ
"RTN","BPSSCR04",92,0)
 . . D REJCODES^BPSSCRU3(+BP59,.BPRJCDS)
"RTN","BPSSCR04",93,0)
 . . S BPRJ=""
"RTN","BPSSCR04",94,0)
 . . F  S BPRJ=$O(BPRJCDS(BPRJ)) Q:BPRJ=""  D
"RTN","BPSSCR04",95,0)
 . . . D SETSORT(BPTMP,BPSORT,BPRJ,BP59)
"RTN","BPSSCR04",96,0)
 ;by drug names 
"RTN","BPSSCR04",97,0)
 ;(the name will be shortened upto 10 chars and its 
"RTN","BPSSCR04",98,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",99,0)
 I BPSORT="N" D
"RTN","BPSSCR04",100,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",101,0)
 . . S BPIEN=+$$GETDRG59^BPSSCRU2(+BP59)
"RTN","BPSSCR04",102,0)
 . . S BPIENNM=$S(BPIEN>0:$E($$DRGNAM^BPSSCRU2(BPIEN),1,10)_U_(BPIEN),1:"0")
"RTN","BPSSCR04",103,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",104,0)
 ;by claim origination type (BB- backbilling, RT- realtime)
"RTN","BPSSCR04",105,0)
 I BPSORT="B" D
"RTN","BPSSCR04",106,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",107,0)
 . . D SETSORT(BPTMP,BPSORT,$$RTBB^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",108,0)
 ;by filling location 
"RTN","BPSSCR04",109,0)
 ;M-MAIL/W-WINDOW/C-CMOP
"RTN","BPSSCR04",110,0)
 I BPSORT="L" D
"RTN","BPSSCR04",111,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",112,0)
 . . D SETSORT(BPTMP,BPSORT,$$MWCNAME^BPSSCRU2($$GETMWC^BPSSCRU2(+BP59)),BP59)
"RTN","BPSSCR04",113,0)
 ;by released (1) /non released (0)
"RTN","BPSSCR04",114,0)
 I BPSORT="R" D
"RTN","BPSSCR04",115,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",116,0)
 . . D SETSORT(BPTMP,BPSORT,$$ISRXREL^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",117,0)
 ;by status of the fill ACT-active/DIS-discontinued/SUS-suspended/etc
"RTN","BPSSCR04",118,0)
 I BPSORT="A" D
"RTN","BPSSCR04",119,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",120,0)
 . . D SETSORT(BPTMP,BPSORT,$$RXST^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",121,0)
 ;
"RTN","BPSSCR04",122,0)
 ;K @BPTMP@("FILE59")
"RTN","BPSSCR04",123,0)
 Q
"RTN","BPSSCR04",124,0)
 ;set SORT node
"RTN","BPSSCR04",125,0)
SETSORT(BPTMP,BPSORT,BPSRTVAL,BP59) ;*/
"RTN","BPSSCR04",126,0)
 S:$L(BPSRTVAL)>0 @BPTMP@("SORT",BPSORT,BPSRTVAL,BP59)=""
"RTN","BPSSCR04",127,0)
 Q
"RTN","BPSSCR04",128,0)
 ;first look at ^BPSC (#9002313.02) for fill/refill x-ref
"RTN","BPSSCR04",129,0)
 ; since #9002313.57 is not created at the time of refill
"RTN","BPSSCR04",130,0)
 ; and since #9002313.59 has the last update date, which can be any kind of date (released/reversal/etc)
"RTN","BPSSCR04",131,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",132,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",133,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",134,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",135,0)
LOOK02(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",136,0)
 N BP02,BPENDDT1,BPLDT02,BP59
"RTN","BPSSCR04",137,0)
 S BP59=0
"RTN","BPSSCR04",138,0)
 S BPLDT02=$$FM2YMD(BPBEGDT-0.00001)
"RTN","BPSSCR04",139,0)
 S BPENDDT1=$$FM2YMD(BPENDDT)
"RTN","BPSSCR04",140,0)
 I BPLDT02="" S BPLDT02=0
"RTN","BPSSCR04",141,0)
 I BPENDDT1="" S BPENDDT1=99999999
"RTN","BPSSCR04",142,0)
 F  S BPLDT02=+$O(^BPSC("AF",BPLDT02)) Q:BPLDT02=0!(BPLDT02>BPENDDT1)  D
"RTN","BPSSCR04",143,0)
 . S BP02=0 F  S BP02=$O(^BPSC("AF",BPLDT02,BP02)) Q:+BP02=0  D
"RTN","BPSSCR04",144,0)
 . . S BP59=+$O(^BPST("AE",BP02,0))
"RTN","BPSSCR04",145,0)
 . . Q:BP59=0
"RTN","BPSSCR04",146,0)
 . . I $D(@BPTMP@(BP59)) Q
"RTN","BPSSCR04",147,0)
 . . S @BPTMP@(BP59)=$$YMD2FM(BPLDT02)_"^02"
"RTN","BPSSCR04",148,0)
 Q
"RTN","BPSSCR04",149,0)
 ; finds claims in  #9002313.57 for given date frame
"RTN","BPSSCR04",150,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSSCR04",151,0)
 ;  of the latest update for the claim
"RTN","BPSSCR04",152,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSSCR04",153,0)
 ;  changes made the claim
"RTN","BPSSCR04",154,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSSCR04",155,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSSCR04",156,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",157,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",158,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",159,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",160,0)
LOOK57(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",161,0)
 N BPLDT57,BP57,BP59
"RTN","BPSSCR04",162,0)
 S BPLDT57=BPBEGDT-0.00001
"RTN","BPSSCR04",163,0)
 F  S BPLDT57=+$O(^BPSTL("AH",BPLDT57)) Q:BPLDT57=0!(BPLDT57>BPENDDT)  D
"RTN","BPSSCR04",164,0)
 . S BP57=0 F  S BP57=$O(^BPSTL("AH",BPLDT57,BP57)) Q:+BP57=0  D
"RTN","BPSSCR04",165,0)
 . . S BP59=+$G(^BPSTL(BP57,0))
"RTN","BPSSCR04",166,0)
 . . I $D(@BPTMP@(BP59)) Q  ;don't create an entry if the claim is already there
"RTN","BPSSCR04",167,0)
 . . S @BPTMP@(BP59)=(BPLDT57\1)_"^57-"
"RTN","BPSSCR04",168,0)
 Q
"RTN","BPSSCR04",169,0)
 ; finds claims in  #9002313.59 for given date frame
"RTN","BPSSCR04",170,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSSCR04",171,0)
 ;  of the latest update for the claim
"RTN","BPSSCR04",172,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSSCR04",173,0)
 ;  changes made the claim
"RTN","BPSSCR04",174,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSSCR04",175,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSSCR04",176,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",177,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",178,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",179,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",180,0)
LOOK59(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",181,0)
 N BPLDT59,BP59
"RTN","BPSSCR04",182,0)
 S BPLDT59=BPBEGDT-0.00001
"RTN","BPSSCR04",183,0)
 F  S BPLDT59=+$O(^BPST("AH",BPLDT59)) Q:BPLDT59=0!(BPLDT59>BPENDDT)  D
"RTN","BPSSCR04",184,0)
 . S BP59=0 F  S BP59=$O(^BPST("AH",BPLDT59,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",185,0)
 . . I $D(@BPTMP@(BP59)) Q  ;don't create an entry if the claim is already there
"RTN","BPSSCR04",186,0)
 . . S @BPTMP@(BP59)=(BPLDT59\1)_"^59-"
"RTN","BPSSCR04",187,0)
 Q
"RTN","BPSSCR04",188,0)
 ;
"RTN","BPSSCR04",189,0)
YMD2FM(BPYMD) ;convert YYYYDDMM to FM date
"RTN","BPSSCR04",190,0)
 Q (($E(BPYMD,1,4))-1700)_$E(BPYMD,5,8)
"RTN","BPSSCR04",191,0)
 ;
"RTN","BPSSCR04",192,0)
FM2YMD(BPFMDT) ;convert FM date to YYYYMMDD
"RTN","BPSSCR04",193,0)
 N Y,Y1
"RTN","BPSSCR04",194,0)
 S Y=$E(BPFMDT,2,3),Y1=$E(BPFMDT,1,1) S Y=$S(Y1=3:"20"_Y,Y1=2:"19"_Y,1:"")
"RTN","BPSSCR04",195,0)
 Q:Y Y_$E(BPFMDT,4,7)
"RTN","BPSSCR04",196,0)
 Q ""
"RTN","BPSSCR04",197,0)
 ;make PATIENT -INSURANCE intermediate SORTING
"RTN","BPSSCR04",198,0)
 ;global for transaction and patient sortings (1st pass)
"RTN","BPSSCR04",199,0)
 ;example:
"RTN","BPSSCR04",200,0)
 ;@BPTMP@("SORT","PI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",201,0)
MKPATINS(BPTMP) ;
"RTN","BPSSCR04",202,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",203,0)
 S BP59=0
"RTN","BPSSCR04",204,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",205,0)
 . S BPDFN=+$$GETPATID^BPSSCRU2(BP59)
"RTN","BPSSCR04",206,0)
 . Q:BPDFN=0
"RTN","BPSSCR04",207,0)
 . S BPINS=+$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR04",208,0)
 . S @BPTMP@("SORT","PI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",209,0)
 Q
"RTN","BPSSCR04",210,0)
 ;make PATIENT NAME -INSURANCE intermediate SORTING
"RTN","BPSSCR04",211,0)
 ;global for transaction and patient sortings (1st pass)
"RTN","BPSSCR04",212,0)
 ;example:
"RTN","BPSSCR04",213,0)
 ;@BPTMP@("SORT","PNI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",214,0)
MKNAMINS(BPTMP) ;
"RTN","BPSSCR04",215,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",216,0)
 S BP59=0
"RTN","BPSSCR04",217,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",218,0)
 . S BPDFN=+$$GETPATID^BPSSCRU2(BP59)
"RTN","BPSSCR04",219,0)
 . Q:BPDFN=0
"RTN","BPSSCR04",220,0)
 . S BPINS=+$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR04",221,0)
 . S @BPTMP@("SORT","PNI",$E($$PATNAME^BPSSCRU2(BPDFN),1,20)_BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",222,0)
 Q
"RTN","BPSSCR04",223,0)
 ;Transaction type sorting - the 2nd pass
"RTN","BPSSCR04",224,0)
 ;is called after MKPATINS
"RTN","BPSSCR04",225,0)
MKTRSORT(BPTMP) ;
"RTN","BPSSCR04",226,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",227,0)
 S BPTRDT=-99999999,BPSRTVAL=0
"RTN","BPSSCR04",228,0)
 F  S BPTRDT=$O(@BPTMP@("TRDTDFN",BPTRDT)) Q:+BPTRDT=0  D
"RTN","BPSSCR04",229,0)
 . S BPDFN=0
"RTN","BPSSCR04",230,0)
 . F  S BPDFN=$O(@BPTMP@("TRDTDFN",BPTRDT,BPDFN)) Q:+BPDFN=0  D
"RTN","BPSSCR04",231,0)
 . . S BPINS=""
"RTN","BPSSCR04",232,0)
 . . F  S BPINS=$O(@BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR04",233,0)
 . . . S BPSRTVAL=BPSRTVAL+1,BPINS=+BPINS
"RTN","BPSSCR04",234,0)
 . . . S BP59=0
"RTN","BPSSCR04",235,0)
 . . . F  S BP59=$O(@BPTMP@("SORT","PI",BPDFN,BPINS,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",236,0)
 . . . . D SETSORT(BPTMP,"T",BPSRTVAL,BP59)
"RTN","BPSSCR04",237,0)
 Q
"RTN","BPSSCR04",238,0)
 ;Patient type sorting - the 2nd pass
"RTN","BPSSCR04",239,0)
 ;is called after MKPATINS
"RTN","BPSSCR04",240,0)
MKPTSORT(BPTMP) ;
"RTN","BPSSCR04",241,0)
 N BPSRTVAL,BPTRDT,BP59,BPPATNAM,BPINS
"RTN","BPSSCR04",242,0)
 S BPPATNAM="",BPSRTVAL=0
"RTN","BPSSCR04",243,0)
 F  S BPPATNAM=$O(@BPTMP@("SORT","PNI",BPPATNAM)) Q:BPPATNAM=""  D
"RTN","BPSSCR04",244,0)
 . S BPINS="" ;"" to handle claims without insurance (corrupted data)
"RTN","BPSSCR04",245,0)
 . F  S BPINS=$O(@BPTMP@("SORT","PNI",BPPATNAM,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR04",246,0)
 . . S BPSRTVAL=BPSRTVAL+1,BPINS=+BPINS
"RTN","BPSSCR04",247,0)
 . . S BP59=0
"RTN","BPSSCR04",248,0)
 . . F  S BP59=$O(@BPTMP@("SORT","PNI",BPPATNAM,BPINS,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",249,0)
 . . . D SETSORT(BPTMP,"P",BPSRTVAL,BP59)
"RTN","BPSSCR04",250,0)
 Q
"RTN","BPSSCR04",251,0)
 ;
"RTN","BPSSCRCL")
0^6^B76014207
"RTN","BPSSCRCL",1,0)
BPSSCRCL ;BHAM ISC/SS - ECME SCREEN CLOSE CLAIMS ;05-APR-05
"RTN","BPSSCRCL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSSCRCL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCL",4,0)
 Q
"RTN","BPSSCRCL",5,0)
 ;
"RTN","BPSSCRCL",6,0)
CLO ;entry point to close claims
"RTN","BPSSCRCL",7,0)
 N BPRET,BPSARR59
"RTN","BPSSCRCL",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRCL",9,0)
 D FULL^VALM1
"RTN","BPSSCRCL",10,0)
 W !,"Enter the line numbers for the claim(s) to be closed."
"RTN","BPSSCRCL",11,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRCL",12,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRCL",13,0)
 ;close claims
"RTN","BPSSCRCL",14,0)
 ;update the content of the screen
"RTN","BPSSCRCL",15,0)
 ;only if at least one claim was closed
"RTN","BPSSCRCL",16,0)
 I $$CLOSE(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for closed claims...")
"RTN","BPSSCRCL",17,0)
 E  S VALMBCK="R"
"RTN","BPSSCRCL",18,0)
 Q
"RTN","BPSSCRCL",19,0)
 ;
"RTN","BPSSCRCL",20,0)
 ;close claims
"RTN","BPSSCRCL",21,0)
 ;input:
"RTN","BPSSCRCL",22,0)
 ; BP59ARR - array with ptrs to BPS TRANSACTION FILE
"RTN","BPSSCRCL",23,0)
 ;       BP59ARR(ien59)="ien in TMP ^ number on the user screen"
"RTN","BPSSCRCL",24,0)
 ;returns:
"RTN","BPSSCRCL",25,0)
 ; BPCLTOT - number of closed claims
"RTN","BPSSCRCL",26,0)
CLOSE(BP59ARR) ;
"RTN","BPSSCRCL",27,0)
 N BPNEWARR,BPRETV,BPREJFLG,X
"RTN","BPSSCRCL",28,0)
 N BPDFN,BP59,BPIFANY,BPQ
"RTN","BPSSCRCL",29,0)
 N BPREAS,BPCOMM,BP90ANSW,BPRCOPAY,BPRXINFO,BPCOP,BPCLTOT,BPINS,BPINSNM,BP59FRST
"RTN","BPSSCRCL",30,0)
 S BPRETV=$$MKNEWARR(.BP59ARR,.BPNEWARR,.BPINS)
"RTN","BPSSCRCL",31,0)
 S BPQ="",BPIFANY=0,BPREJFLG=1
"RTN","BPSSCRCL",32,0)
 S BPDFN=""
"RTN","BPSSCRCL",33,0)
 F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",34,0)
 . W !!,"You've chosen to close the following prescription(s) for",!,$E($$PATNAME^BPSSCRU2(BPDFN),1,13)_" :"
"RTN","BPSSCRCL",35,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",36,0)
 . . I $Y>20 D PAUSE^VALM1 W @IOF I X="^" S BPQ="^" Q
"RTN","BPSSCRCL",37,0)
 . . S BPIFANY=1,BPQ=""
"RTN","BPSSCRCL",38,0)
 . . ;I $P($G(BPNEWARR(BPDFN,BP59)),U,3)=1 W:BPREJFLG=0 ! S BPREJFLG=1
"RTN","BPSSCRCL",39,0)
 . . ;E  W:BPREJFLG=1 ! S BPREJFLG=0
"RTN","BPSSCRCL",40,0)
 . . S BPREJFLG=+$P($G(BPNEWARR(BPDFN,BP59)),U,3)
"RTN","BPSSCRCL",41,0)
 . . W !,@VALMAR@(+$G(BPNEWARR(BPDFN,BP59)),0)
"RTN","BPSSCRCL",42,0)
 . . D DISPREJ^BPSSCRU6(BP59)
"RTN","BPSSCRCL",43,0)
 . . W:BPREJFLG=0 !,"Claim NOT Rejected and cannot be Closed."
"RTN","BPSSCRCL",44,0)
 I +BPRETV=0 Q $$QUITCL()
"RTN","BPSSCRCL",45,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",46,0)
 ;
"RTN","BPSSCRCL",47,0)
 W !!,"ALL Selected Rxs will be CLOSED using the same information gathered in the following prompts.",!
"RTN","BPSSCRCL",48,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",49,0)
 I BPQ'=1 Q $$QUITCL()
"RTN","BPSSCRCL",50,0)
 ;
"RTN","BPSSCRCL",51,0)
 ; ask questions for all of them
"RTN","BPSSCRCL",52,0)
 W !!
"RTN","BPSSCRCL",53,0)
 I $$ASKQUEST(+$P(BPRETV,U,2),.BPREAS,.BPCOMM,.BP90ANSW,.BPRCOPAY)'=1 Q $$QUITCL()
"RTN","BPSSCRCL",54,0)
 ;
"RTN","BPSSCRCL",55,0)
 ; check 2nd insurance
"RTN","BPSSCRCL",56,0)
 S BPQ=""
"RTN","BPSSCRCL",57,0)
 I BP90ANSW'="D" D
"RTN","BPSSCRCL",58,0)
 . S BPDFN="" F  S BPDFN=$O(BPINS(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",59,0)
 . . S BPINSNM="" F  S BPINSNM=$O(BPINS(BPDFN,BPINSNM)) Q:BPINSNM=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",60,0)
 . . . S BP59FRST=0
"RTN","BPSSCRCL",61,0)
 . . . S BP59=""
"RTN","BPSSCRCL",62,0)
 . . . K BPRXINFO
"RTN","BPSSCRCL",63,0)
 . . . F  S BP59=$O(BPINS(BPDFN,BPINSNM,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",64,0)
 . . . . S:BP59FRST=0 BP59FRST=BP59
"RTN","BPSSCRCL",65,0)
 . . . . S BPRXINFO(BP59)=$E($G(@VALMAR@(+$G(BP59ARR(BP59)),0)),7,99)
"RTN","BPSSCRCL",66,0)
 . . . ; call CH2NDINS^BPSSCRU5 only once for all claims for this patient and insurance
"RTN","BPSSCRCL",67,0)
 . . . ; you can use one BP59FRST for the group of claims here as a parameter since 
"RTN","BPSSCRCL",68,0)
 . . . ; they all are all identical from the "patient-insurance pair" point of view
"RTN","BPSSCRCL",69,0)
 . . . D:BP59FRST>0 CH2NDINS^BPSSCRU5(BP59FRST,$E($$PATNAME^BPSSCRU2(BPDFN),1,13),BPINSNM,.BPRXINFO)
"RTN","BPSSCRCL",70,0)
 ;
"RTN","BPSSCRCL",71,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",72,0)
 ;
"RTN","BPSSCRCL",73,0)
 W @IOF
"RTN","BPSSCRCL",74,0)
 ;and finally close all
"RTN","BPSSCRCL",75,0)
 S BPCLTOT=0
"RTN","BPSSCRCL",76,0)
 S BPDFN="" F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D
"RTN","BPSSCRCL",77,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D
"RTN","BPSSCRCL",78,0)
 . . I $P($G(BPNEWARR(BPDFN,BP59)),U,3)=0 Q  ;can't be closed
"RTN","BPSSCRCL",79,0)
 . . S BPCOP=0
"RTN","BPSSCRCL",80,0)
 . . I +BPRCOPAY=1,$P($G(BPNEWARR(BPDFN,BP59)),U,4)=1 S BPCOP=1 ;release copay
"RTN","BPSSCRCL",81,0)
 . . I $$CLOSEIT(BP59,$P(BPREAS,U,2),BPCOMM,BP90ANSW,BPCOP)>0 D
"RTN","BPSSCRCL",82,0)
 . . . S BPCLTOT=BPCLTOT+1
"RTN","BPSSCRCL",83,0)
 ;
"RTN","BPSSCRCL",84,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been closed.",!
"RTN","BPSSCRCL",85,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",86,0)
 Q BPCLTOT
"RTN","BPSSCRCL",87,0)
 ;
"RTN","BPSSCRCL",88,0)
QUITCL() ;
"RTN","BPSSCRCL",89,0)
 W !!,"0 claims have been closed."
"RTN","BPSSCRCL",90,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",91,0)
 Q 0
"RTN","BPSSCRCL",92,0)
 ;/**
"RTN","BPSSCRCL",93,0)
 ;Ask all necessary questions
"RTN","BPSSCRCL",94,0)
 ;Input
"RTN","BPSSCRCL",95,0)
 ; BPRELCOP - ask release copay question
"RTN","BPSSCRCL",96,0)
 ; .BPREAZ - ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",97,0)
 ; .BPCOMZ - close comment (string)
"RTN","BPSSCRCL",98,0)
 ; .BP90ANSZ - "", "D"(drop to paper) or "N" (non-billable)
"RTN","BPSSCRCL",99,0)
 ; .BPRCOPAZ - 1(Yes) or 0(No) , answer to "release copay" question
"RTN","BPSSCRCL",100,0)
 ;Output:
"RTN","BPSSCRCL",101,0)
 ; 0 - cancel process
"RTN","BPSSCRCL",102,0)
 ; ^ - emergency quit (cancel process)
"RTN","BPSSCRCL",103,0)
 ; 1 - ok, can proceed
"RTN","BPSSCRCL",104,0)
ASKQUEST(BPRELCOP,BPREAZ,BPCOMZ,BP90ANSZ,BPRCOPAZ) ;*/
"RTN","BPSSCRCL",105,0)
 S BPCOMZ=""
"RTN","BPSSCRCL",106,0)
 S BP90ANSZ=""
"RTN","BPSSCRCL",107,0)
 S BPRCOPAZ=0
"RTN","BPSSCRCL",108,0)
 ;ask the user to choose the close reason from #356.8
"RTN","BPSSCRCL",109,0)
 ;using set of close reasons in IB file 356.8
"RTN","BPSSCRCL",110,0)
 S BPREAZ=$$REASON()
"RTN","BPSSCRCL",111,0)
 I BPREAZ="^" Q "^"
"RTN","BPSSCRCL",112,0)
 I ($P(BPREAZ,U,4)=1) D  ;if has ECME PAPER FLAG
"RTN","BPSSCRCL",113,0)
 . ;ask if the claim is still billable thru paper?
"RTN","BPSSCRCL",114,0)
 . S BP90ANSZ=$$PROMPT^BPSSCRCV("S^N:NON-BILLABLE;D:DROP TO PAPER","Treat as (N)on-Billable Episode or (D)rop Bill to Paper?","")
"RTN","BPSSCRCL",115,0)
 I BP90ANSZ=-1 Q "^"
"RTN","BPSSCRCL",116,0)
 S BPCOMZ=$$COMMENT("Comment ",40)
"RTN","BPSSCRCL",117,0)
 I (BPCOMZ="^") Q "^"
"RTN","BPSSCRCL",118,0)
 I $L(BPCOMZ)>0,BPCOMZ?1" "." " S BPCOMZ=""
"RTN","BPSSCRCL",119,0)
 ;check copay
"RTN","BPSSCRCL",120,0)
 ;ask "release copay?" in all NON-BILLABLE cases, i.e. except user answered "DROP TO PAPER"
"RTN","BPSSCRCL",121,0)
 ;(even in cases when he was not asked about it)
"RTN","BPSSCRCL",122,0)
 I BP90ANSZ'="D",BPRELCOP D
"RTN","BPSSCRCL",123,0)
 . ; Ask user if s/he wants to release a copay
"RTN","BPSSCRCL",124,0)
 . S BPRCOPAZ=$$YESNO^BPSSCRRS("Release Patient CoPay(Y/N)")
"RTN","BPSSCRCL",125,0)
 I BPRCOPAZ=-1 Q "^"
"RTN","BPSSCRCL",126,0)
 ;
"RTN","BPSSCRCL",127,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",128,0)
 I BPQ=-1 Q "^" ;quit by "^"
"RTN","BPSSCRCL",129,0)
 I BPQ'=1 Q 0 ;doesn't want to proceed
"RTN","BPSSCRCL",130,0)
 Q 1 ; answers can be used
"RTN","BPSSCRCL",131,0)
 ;
"RTN","BPSSCRCL",132,0)
 ;/**
"RTN","BPSSCRCL",133,0)
 ;ask for the close reason
"RTN","BPSSCRCL",134,0)
 ;return:
"RTN","BPSSCRCL",135,0)
 ;   ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",136,0)
REASON() ;
"RTN","BPSSCRCL",137,0)
 N DIC,BPREASNM,BP3568,Y
"RTN","BPSSCRCL",138,0)
 ; - Asks for REASON for Closing
"RTN","BPSSCRCL",139,0)
 S DIC="^IBE(356.8,",DIC(0)="AEQMZ"
"RTN","BPSSCRCL",140,0)
 S DIC("S")="I $P(^(0),U,2)=1"
"RTN","BPSSCRCL",141,0)
 D ^DIC
"RTN","BPSSCRCL",142,0)
 I Y=-1 Q "^"
"RTN","BPSSCRCL",143,0)
 Q +Y_U_Y(0)
"RTN","BPSSCRCL",144,0)
 ;/**
"RTN","BPSSCRCL",145,0)
 ;enter the comment
"RTN","BPSSCRCL",146,0)
 ;BPSTR  -prompt string
"RTN","BPSSCRCL",147,0)
 ;BPMLEN -maxlen
"RTN","BPSSCRCL",148,0)
COMMENT(BPSTR,BPMLEN) ;*/
"RTN","BPSSCRCL",149,0)
 N DIR,DTOUT,DUOUT,BPQ
"RTN","BPSSCRCL",150,0)
 I '$D(BPSTR) S BPSTR="Comment "
"RTN","BPSSCRCL",151,0)
 I '$D(BPMLEN) S BPMLEN=40
"RTN","BPSSCRCL",152,0)
 S DIR(0)="FO^0:250"
"RTN","BPSSCRCL",153,0)
 S DIR("A")=BPSTR
"RTN","BPSSCRCL",154,0)
 S DIR("?",1)="This response must have at least 0 characters and no more"
"RTN","BPSSCRCL",155,0)
 S DIR("?")="than "_BPMLEN_" characters and must not contain embedded uparrow"
"RTN","BPSSCRCL",156,0)
 S BPQ=0
"RTN","BPSSCRCL",157,0)
 F  D  Q:+BPQ'=0
"RTN","BPSSCRCL",158,0)
 . D ^DIR
"RTN","BPSSCRCL",159,0)
 . I $D(DUOUT)!($D(DTOUT)) S BPQ=-1 Q
"RTN","BPSSCRCL",160,0)
 . I $L(Y)'>BPMLEN S BPQ=1 Q
"RTN","BPSSCRCL",161,0)
 . W !!,"This response must have at least 0 characters and no more"
"RTN","BPSSCRCL",162,0)
 . W !,"than "_BPMLEN_" characters and must not contain embedded uparrow.",!
"RTN","BPSSCRCL",163,0)
 . S DIR("B")=$E(Y,1,BPMLEN)
"RTN","BPSSCRCL",164,0)
 Q:BPQ<0 "^"
"RTN","BPSSCRCL",165,0)
 Q Y
"RTN","BPSSCRCL",166,0)
 ;/** 
"RTN","BPSSCRCL",167,0)
 ;close the claim
"RTN","BPSSCRCL",168,0)
 ;the approach and code partially borrowed from IHS code CLOSE^BPSOS6N
"RTN","BPSSCRCL",169,0)
 ;BPSTRA - ptr to #9002313.59
"RTN","BPSSCRCL",170,0)
 ;REASON - text name of the close reason 
"RTN","BPSSCRCL",171,0)
 ;BPSCLCM - comment 
"RTN","BPSSCRCL",172,0)
 ;BPDROP:
"RTN","BPSSCRCL",173,0)
 ;  "D" - DROP BILL TO PAPER
"RTN","BPSSCRCL",174,0)
 ;  "N" - NON-BILLABLE
"RTN","BPSSCRCL",175,0)
 ;BPRELCOP - 1 (Yes) or 0 (No) release copay or not?
"RTN","BPSSCRCL",176,0)
CLOSEIT(BPSTRA,REASON,BPSCLCM,BPDROP,BPRELCOP) ;
"RTN","BPSSCRCL",177,0)
 N BPSCLA,ERROR,DA,DR,BPLCK,DIE
"RTN","BPSSCRCL",178,0)
 S BPSCLA=$$GET1^DIQ(9002313.59,BPSTRA,3,"I")
"RTN","BPSSCRCL",179,0)
 W !,"Closing Claim ",$$GET1^DIQ(9002313.02,BPSCLA,.01),"..."
"RTN","BPSSCRCL",180,0)
 S BPLCK=0
"RTN","BPSSCRCL",181,0)
 L +^BPSC(BPSCLA):0
"RTN","BPSSCRCL",182,0)
 I $T S BPLCK=1
"RTN","BPSSCRCL",183,0)
 E  W !,"       *** CLAIM ",$$GET1^DIQ(9002313.02,BPSCLA,.01)," IN USE ***" Q 0
"RTN","BPSSCRCL",184,0)
 D CLOSE^BPSBUTL(BPSCLA,BPSTRA,REASON,$S($G(BPDROP)="D":1,1:0),BPRELCOP,BPSCLCM,.ERROR)
"RTN","BPSSCRCL",185,0)
 I $D(ERROR) W "NOT OK" D DSPERR(ERROR) D  Q 0
"RTN","BPSSCRCL",186,0)
 . I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",187,0)
 S DIE="^BPSC(",DA=BPSCLA,DR="901///1;902///"_$$NOW^XLFDT()_";903///"_$G(DUZ)_";904///"_REASON_";905////"_BPDROP D ^DIE
"RTN","BPSSCRCL",188,0)
 I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",189,0)
 H 1 W "OK"
"RTN","BPSSCRCL",190,0)
 Q 1
"RTN","BPSSCRCL",191,0)
 ;
"RTN","BPSSCRCL",192,0)
DSPERR(MSG) ; Display the ERROR message
"RTN","BPSSCRCL",193,0)
 W !,"Error: *** ",MSG," ***"
"RTN","BPSSCRCL",194,0)
 Q
"RTN","BPSSCRCL",195,0)
 ;
"RTN","BPSSCRCL",196,0)
 ;/**
"RTN","BPSSCRCL",197,0)
 ;ECME has tried to submit the claim to insurance with the name BPINSNAM
"RTN","BPSSCRCL",198,0)
 ;but the claim was rejected and now we need to determine if the patient
"RTN","BPSSCRCL",199,0)
 ;has any other insurance with pharmacy coverage that can be billed for the RX
"RTN","BPSSCRCL",200,0)
 ;Input:
"RTN","BPSSCRCL",201,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRCL",202,0)
 ; BPINSNAM - insurance that have already been used by ECME
"RTN","BPSSCRCL",203,0)
 ;Output:
"RTN","BPSSCRCL",204,0)
 ; 0 - not found
"RTN","BPSSCRCL",205,0)
 ; 1 ^ Insurance Name ^ Group Number ^ Date  of service
"RTN","BPSSCRCL",206,0)
NEXTINS(BP59,BPINSNAM) ;get insurance info by the pointer of #9002313.59
"RTN","BPSSCRCL",207,0)
 N BPDOS,BPDFN,BPZZ,BP36,BPX,BPHONE,BPY,BPINSNM
"RTN","BPSSCRCL",208,0)
 N BPPHARM,BPCOORD,BPINS,BPFOUND
"RTN","BPSSCRCL",209,0)
 S BPY=0
"RTN","BPSSCRCL",210,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRCL",211,0)
 S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRCL",212,0)
 I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRCL",213,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRCL",214,0)
 ; call INSUR^IBBAPI to get information about:
"RTN","BPSSCRCL",215,0)
 ;1 = Insurance Company Name
"RTN","BPSSCRCL",216,0)
 ;7 = Coordination of Benefits (primary, secondary, tertiary)
"RTN","BPSSCRCL",217,0)
 ;15 = Pharmacy Coverage?
"RTN","BPSSCRCL",218,0)
 ;18 = Group Number
"RTN","BPSSCRCL",219,0)
 S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,7,15,18")
"RTN","BPSSCRCL",220,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",221,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",222,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",223,0)
 I BPX<1 Q 0
"RTN","BPSSCRCL",224,0)
 D PROCINS(.BPZZ)
"RTN","BPSSCRCL",225,0)
 ;check pharmacy coverage
"RTN","BPSSCRCL",226,0)
 S BPFOUND=0 ;if found will be set to insurance node in the INSUR^IBBAPI array
"RTN","BPSSCRCL",227,0)
 S BPPHARM=1 ;look only at those with pharmacy coverage
"RTN","BPSSCRCL",228,0)
 S BPCOORD=0
"RTN","BPSSCRCL",229,0)
 F  S BPCOORD=+$O(BPZZ("RES",BPPHARM,BPCOORD)) Q:BPCOORD=0!(BPFOUND'=0)  D
"RTN","BPSSCRCL",230,0)
 . S BPINS=+$O(BPZZ("RES",BPPHARM,BPCOORD,0))
"RTN","BPSSCRCL",231,0)
 . I BPINS>0 I $P($G(BPZZ("IBBAPI","INSUR",BPINS,1)),U,2)'=BPINSNAM S BPFOUND=BPINS
"RTN","BPSSCRCL",232,0)
 I BPFOUND=0 Q 0
"RTN","BPSSCRCL",233,0)
 Q 1_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,1)),U,2)_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,18)),U)_U_BPDOS
"RTN","BPSSCRCL",234,0)
 ;
"RTN","BPSSCRCL",235,0)
 ;process insurances
"RTN","BPSSCRCL",236,0)
 ;input: local array returned by INSUR^IBBAPI
"RTN","BPSSCRCL",237,0)
 ;output: BPZZ("RES",pharmacy coverage,coordination,insurance element # in BPZZ array)
"RTN","BPSSCRCL",238,0)
PROCINS(BPZZ) ;
"RTN","BPSSCRCL",239,0)
 N BP1,BP2,BP0,BPPHONE,BPPHARM,BPCOORD
"RTN","BPSSCRCL",240,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",241,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",242,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",243,0)
 . ;get coordination of benefits
"RTN","BPSSCRCL",244,0)
 . S BPCOORD=+$G(BPZZ("IBBAPI","INSUR",BP1,7))
"RTN","BPSSCRCL",245,0)
 . ;create ^TMP to sort results by pharmacy coverage and coordination of benefits
"RTN","BPSSCRCL",246,0)
 . S BPZZ("RES",BPPHARM,BPCOORD,BP1)=""
"RTN","BPSSCRCL",247,0)
 Q
"RTN","BPSSCRCL",248,0)
 ;
"RTN","BPSSCRCL",249,0)
 ;------------
"RTN","BPSSCRCL",250,0)
MKNEWARR(BPARR,BPNEWARR,BPINSARR) ;
"RTN","BPSSCRCL",251,0)
 N BP59,BPREJ,BPREJCNT,BPRELCNT,BPREL,BPINS
"RTN","BPSSCRCL",252,0)
 S BPREJCNT=0,BPRELCNT=0
"RTN","BPSSCRCL",253,0)
 S BPINS=0
"RTN","BPSSCRCL",254,0)
 S BP59="" F  S BP59=$O(BPARR(BP59)) Q:BP59=""  D
"RTN","BPSSCRCL",255,0)
 . S BPREJ=0
"RTN","BPSSCRCL",256,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRCL",257,0)
 . S BPREJ=$S($P($$CLAIMST^BPSSCRU3(BP59),U)="E REJECTED":1,1:0)
"RTN","BPSSCRCL",258,0)
 . S:BPREJ BPREJCNT=BPREJCNT+1
"RTN","BPSSCRCL",259,0)
 . S BPREL=$S($$RXAPI1^BPSUTIL1(+$P($$RXREF^BPSSCRU2(BP59),U),106,"I"):1,1:0)
"RTN","BPSSCRCL",260,0)
 . S:BPREL BPRELCNT=BPRELCNT+1
"RTN","BPSSCRCL",261,0)
 . S BPNEWARR(BPDFN,BP59)=BPARR(BP59)_U_BPREJ_U_BPREL
"RTN","BPSSCRCL",262,0)
 . S BPINS=$P($$GETINSUR^BPSSCRU2(BP59),U,2)
"RTN","BPSSCRCL",263,0)
 . I BPREJ=1,$L(BPINS)>0 S BPINSARR(BPDFN,BPINS,BP59)=BPARR(BP59)
"RTN","BPSSCRCL",264,0)
 Q BPREJCNT_U_BPRELCNT
"RTN","BPSSCRCL",265,0)
 ;
"RTN","BPSSCRCU")
0^211^B3767208
"RTN","BPSSCRCU",1,0)
BPSSCRCU ;BHAM ISC/SS - ECME SCREEN CONTINUOUS UPDATE AND CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRCU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCU",4,0)
 Q
"RTN","BPSSCRCU",5,0)
 ;
"RTN","BPSSCRCU",6,0)
CU ;
"RTN","BPSSCRCU",7,0)
 N BPKEY,BPTIME,X,Y
"RTN","BPSSCRCU",8,0)
 S BPTIME=15 ;update every 15 seconds
"RTN","BPSSCRCU",9,0)
 D RE^VALM4
"RTN","BPSSCRCU",10,0)
 W "Press ""Q"" to quit."
"RTN","BPSSCRCU",11,0)
 F  D  S BPKEY=$$READ^XGF(1,BPTIME) Q:(BPKEY="Q")!(BPKEY="q")
"RTN","BPSSCRCU",12,0)
 . D UD^BPSSCRUD
"RTN","BPSSCRCU",13,0)
 . D RE^VALM4
"RTN","BPSSCRCU",14,0)
 . N %
"RTN","BPSSCRCU",15,0)
 . D NOW^%DTC S Y=% X ^DD("DD")
"RTN","BPSSCRCU",16,0)
 . W "The screen has been updated on "_Y_". Press ""Q"" to quit."
"RTN","BPSSCRCU",17,0)
 Q
"RTN","BPSSCRCU",18,0)
 ;
"RTN","BPSSCRCU",19,0)
 ;select insurance from the list of the insurances which was built for the current user setting
"RTN","BPSSCRCU",20,0)
 ;for the User Screen.
"RTN","BPSSCRCU",21,0)
 ;input : none
"RTN","BPSSCRCU",22,0)
 ;output : 1^name of the insurance or null
"RTN","BPSSCRCU",23,0)
 ;0^ - if "^" or was not selected
"RTN","BPSSCRCU",24,0)
SELINSUR() ;
"RTN","BPSSCRCU",25,0)
 N DIR,Y,X
"RTN","BPSSCRCU",26,0)
 N BPX,BPCNT,BPTEL
"RTN","BPSSCRCU",27,0)
 S BPX=0,BPCNT=0
"RTN","BPSSCRCU",28,0)
 K ^TMP($J,"BPSSCRINS","LOOKUP")
"RTN","BPSSCRCU",29,0)
 F  S BPX=$O(^TMP($J,"BPSSCRINS","VAL",BPX)) Q:BPX=""  D
"RTN","BPSSCRCU",30,0)
 . S BPCNT=BPCNT+1
"RTN","BPSSCRCU",31,0)
 . S BPTEL=$O(^TMP($J,"BPSSCRINS","VAL",BPX,""))
"RTN","BPSSCRCU",32,0)
 . S ^TMP($J,"BPSSCRINS","LOOKUP",BPCNT,0)=BPX_U_BPTEL
"RTN","BPSSCRCU",33,0)
 . S ^TMP($J,"BPSSCRINS","LOOKUP","B",BPX,BPCNT)=""
"RTN","BPSSCRCU",34,0)
 S ^TMP($J,"BPSSCRINS","LOOKUP",0)=U_U_BPCNT_U_BPCNT
"RTN","BPSSCRCU",35,0)
 ;set DIR variables
"RTN","BPSSCRCU",36,0)
 S DIR(0)="P^TMP($J,""BPSSCRINS"",""LOOKUP"",:AEQMZ"
"RTN","BPSSCRCU",37,0)
 S DIR("A")="Select "
"RTN","BPSSCRCU",38,0)
 S DIR("A",1)=""
"RTN","BPSSCRCU",39,0)
 S DIR("A",2)="Select one of the insurances which were used by ECME to submit claims within"
"RTN","BPSSCRCU",40,0)
 S DIR("A",3)="the date range specified by the user."
"RTN","BPSSCRCU",41,0)
 S DIR("A",4)=""
"RTN","BPSSCRCU",42,0)
 D ^DIR
"RTN","BPSSCRCU",43,0)
 K ^TMP($J,"BPSSCRINS","LOOKUP")
"RTN","BPSSCRCU",44,0)
 I X="^" Q "-1^"
"RTN","BPSSCRCU",45,0)
 I $P(Y,U,2)="" Q "0^"
"RTN","BPSSCRCU",46,0)
 Q 1_U_$P(Y,U,2)
"RTN","BPSSCRCU",47,0)
 ;
"RTN","BPSSCRCV")
0^7^B47506376
"RTN","BPSSCRCV",1,0)
BPSSCRCV ;BHAM ISC/SS - ECME SCREEN CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRCV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCV",4,0)
 ;USER SCREEN
"RTN","BPSSCRCV",5,0)
 Q
"RTN","BPSSCRCV",6,0)
 ;****
"RTN","BPSSCRCV",7,0)
 ;This software is using PARAMETER TOOLS (see XT*7.3*26) to store user's settings:
"RTN","BPSSCRCV",8,0)
 ;PARAMETER DEFINITION NAME="BPS USRSCR" (file #8989.51, IA# 2263)
"RTN","BPSSCRCV",9,0)
 ;ENTITY is "USR" , i.e. IEN in ^VA(200  -- see definition for "BPS USRSCR"
"RTN","BPSSCRCV",10,0)
 ;INSTANCEs are as follows:
"RTN","BPSSCRCV",11,0)
 ;1.01 ONE/ALL USERS --'U' ONE USER, 'A' ALL; Display claims for ONE or ALL users 
"RTN","BPSSCRCV",12,0)
 ;1.02 ONE/ALL PATIENTS --'P' FOR ONE PATIENT; 'A' FOR ALL; Display claims for ONE/ALL PATIENTS 
"RTN","BPSSCRCV",13,0)
 ;1.03 ONE/ALL RX --'R' FOR ONE RX; 'A' FOR ALL; Display claims for ONE or ALL RX 
"RTN","BPSSCRCV",14,0)
 ;1.04 HOURS/DAYS -- 'D' FOR DAYS; 'H' FOR HOURS; Use HOURS or DAYS to specify timeframe 
"RTN","BPSSCRCV",15,0)
 ;1.05 TIMEFRAME -- NUMBER Depends on the value of the field "USR SCR HOURS/DAYS" this field will
"RTN","BPSSCRCV",16,0)
 ;store the default number of HOURS from NOW or DAYS from TODAY to select claims to display 
"RTN","BPSSCRCV",17,0)
 ;1.06 REJECTED/PAYABLE --'R' FOR REJECTS; 'P' FOR PAYABLES 'A' FOR ALL; Display Rejects or Payables or ALL claims 
"RTN","BPSSCRCV",18,0)
 ;1.07 RELEASED/NOT RELEASED --'R' FOR RELEASED; 'N' FOR NON-RELEASED; 'A' FOR ALL; Display Released Rxs or Non-Released Rxs or ALL 
"RTN","BPSSCRCV",19,0)
 ;1.08 CMOP/MAIL/WINDOW --'C' FOR CMOP; 'M' FOR MAIL;'W' FOR WINDOW;'A' FOR ALL; Display CMOP or Mail or Window or ALL Rxs 
"RTN","BPSSCRCV",20,0)
 ;1.09 REALTIME/BACKBILL --'R' FOR REALTIME; 'B' FOR BACKBILLS; 'A' FOR ALL; Display RealTime Fills or Backbills or ALL 
"RTN","BPSSCRCV",21,0)
 ;1.1 REJECT CODE/ALL --'R' FOR REJECT CODE; 'A' FOR ALL; Display Specific Reject Code or ALL Reject
"RTN","BPSSCRCV",22,0)
 ;Codes 0 means ALL Reject Codes otherwise - Reject Code value 
"RTN","BPSSCRCV",23,0)
 ;1.11 SINGLE/ALL INSURANCES --'I' FOR SINGLE INSURANCE;'A' FOR ALL; Display Single Insurance Company or All null - ALL otherwise - pointer to INSURANCE COMPANY file #36 
"RTN","BPSSCRCV",24,0)
 ;1.12 SORT LIST --'T' FOR TRANSACTION DATE;'D' FOR DIVISION; 'I' FOR INSURANCE; 'C' FOR REJECT CODE; 
"RTN","BPSSCRCV",25,0)
 ;'P' FOR PATIENT NAME -- 'N' FOR DRUG NAME; 'B' FOR BILL TYPE (BB/RT); 'L' FOR FILL LOCATION;
"RTN","BPSSCRCV",26,0)
 ;'R' FOR RELEASED/NON-RELEASED -- 'A' FOR ACTIVE/DISCONTINUED; the field used to sort claims in the list 
"RTN","BPSSCRCV",27,0)
 ;1.13 ALL ECME PHARMACY DIVISIONS --'D' FOR DIVISION; 'A' FOR ALL; 
"RTN","BPSSCRCV",28,0)
 ;1.14 SELECTED INSURANCE -- Single insurance to select claims for the User Screen, to store INSURANCE COMPANY pointer (#36) 
"RTN","BPSSCRCV",29,0)
 ;1.15 SELECTED REJECTED CODE --POINTER TO BPS NCPDP REJECT CODES FILE (#9002313.93) Reject code selected by the user to filter claims.
"RTN","BPSSCRCV",30,0)
 ;1.16 SELECTED USER -- POINTER TO NEW PERSON FILE (#200) Selected user for the user screen 
"RTN","BPSSCRCV",31,0)
 ;1.17 SELECTED PATIENT -- POINTER TO PATIENT FILE (#2) Selected patient for the User Screen 
"RTN","BPSSCRCV",32,0)
 ;1.18 SELECTED RX -- POINTER TO PRESCRIPTION FILE (#52) Selected RX 
"RTN","BPSSCRCV",33,0)
 ;2    ECME PHARMACY DIVISION -- the list of POINTERs TO BPS PHARMACIES FILE (#9002313.56) separated by "^"
"RTN","BPSSCRCV",34,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRCV",35,0)
 ;
"RTN","BPSSCRCV",36,0)
 ;NOTE: use D ^XPAREDIT to add/edit values
"RTN","BPSSCRCV",37,0)
 ;
"RTN","BPSSCRCV",38,0)
 ;*****
"RTN","BPSSCRCV",39,0)
 ;
"RTN","BPSSCRCV",40,0)
CV ;
"RTN","BPSSCRCV",41,0)
 D FULL^VALM1
"RTN","BPSSCRCV",42,0)
 W @IOF
"RTN","BPSSCRCV",43,0)
 K BPARR
"RTN","BPSSCRCV",44,0)
 I +$G(DUZ)=0 D ERRMSG^BPSSCRCV("Unknown User") Q
"RTN","BPSSCRCV",45,0)
 N BPDUZ7
"RTN","BPSSCRCV",46,0)
 S BPDUZ7=+DUZ
"RTN","BPSSCRCV",47,0)
 ;always get current profile from the file
"RTN","BPSSCRCV",48,0)
 D READPROF^BPSSCRSL(.BPARR,BPDUZ7)
"RTN","BPSSCRCV",49,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",50,0)
 ;edit current profile
"RTN","BPSSCRCV",51,0)
 D EDITPROF(.BPARR,.BPDUZ7)
"RTN","BPSSCRCV",52,0)
 ;ask user if need to save everything in USR PROFILE file 
"RTN","BPSSCRCV",53,0)
 ;(except SORT LIST field)
"RTN","BPSSCRCV",54,0)
 N BPSRT S BPSRT=BPARR(1.12)
"RTN","BPSSCRCV",55,0)
 K BPARR(1.12)
"RTN","BPSSCRCV",56,0)
 D ENDEDIT^BPSSCRSL(.BPARR,+BPDUZ7)
"RTN","BPSSCRCV",57,0)
 S BPARR(1.12)=BPSRT
"RTN","BPSSCRCV",58,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",59,0)
 S VALMBG=1
"RTN","BPSSCRCV",60,0)
 D REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSSCRCV",61,0)
 Q
"RTN","BPSSCRCV",62,0)
 ;edit user profile for CHANGE VIEW
"RTN","BPSSCRCV",63,0)
EDITPROF(BPARR,BPDUZ7) ;
"RTN","BPSSCRCV",64,0)
 I +$G(DUZ)=0 D ERRMSG("Unknown User") Q
"RTN","BPSSCRCV",65,0)
 N BP1,BPTF,BPQ,BPINP
"RTN","BPSSCRCV",66,0)
 N BPRET
"RTN","BPSSCRCV",67,0)
 N DIR,DR,DIE,DA
"RTN","BPSSCRCV",68,0)
 ;get ONE/ALL USERS?
"RTN","BPSSCRCV",69,0)
 ;EDITFLD(FILENO,FLDNO,RECIEN,CODESET,PRMTMSG,DFLTCODE)  ;
"RTN","BPSSCRCV",70,0)
 S BPRET=$$DS^BPSSCRDS(.BPARR,+BPDUZ7) ;get divisions
"RTN","BPSSCRCV",71,0)
 Q:BPRET=-2  ;quit due to timeout or ^
"RTN","BPSSCRCV",72,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",73,0)
 . S BPINP=$$EDITFLD(1.01,+BPDUZ7,"S^U:ONE USER;A:ALL","Display One ECME (U)ser or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",74,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",75,0)
 . S BPINP=$$EDITFLD(1.16,+BPDUZ7,"P^VA(200,","Select User","",.BPARR)
"RTN","BPSSCRCV",76,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",77,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",78,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",79,0)
 . S BPINP=$$EDITFLD(1.02,+BPDUZ7,"S^P:ONE PATIENT;A:ALL","Display One (P)atient or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",80,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",81,0)
 . S BPINP=$$EDITFLD(1.17,+BPDUZ7,"P^DPT(","Select Patient","",.BPARR)
"RTN","BPSSCRCV",82,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",83,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",84,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",85,0)
 . S BPINP=$$EDITFLD(1.03,+BPDUZ7,"S^R:ONE RX;A:ALL","Display One (R)x or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",86,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",87,0)
 . S BPINP=$$EDITRX^BPSSCRPR(1.18,+BPDUZ7,"Select RX","",.BPARR)
"RTN","BPSSCRCV",88,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",89,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",90,0)
 S BPINP=$$EDITFLD(1.04,+BPDUZ7,"S^D:DAYS;H:HOURS","Activity Timeframe (H)ours or (D)ays","DAYS",.BPARR)
"RTN","BPSSCRCV",91,0)
 I BPINP=-1 Q  ;quit due to timeout or ^
"RTN","BPSSCRCV",92,0)
 S BPTF=$P(BPINP,U,2)
"RTN","BPSSCRCV",93,0)
 Q:$$EDITFLD(1.05,+BPDUZ7,"N^1:999:0","Activity Timeframe Value",$S(BPTF="H":24,1:7),.BPARR)=-1
"RTN","BPSSCRCV",94,0)
 Q:$$EDITFLD(1.06,+BPDUZ7,"S^R:REJECTS;P:PAYABLES;A:ALL","Display (R)ejects or (P)ayables or (A)LL","REJECTS",.BPARR)=-1
"RTN","BPSSCRCV",95,0)
 Q:$$EDITFLD(1.07,+BPDUZ7,"S^R:RELEASED;N:NON-RELEASED;A:ALL","Display (R)eleased Rxs or (N)on-Released Rxs or (A)LL","RELEASED",.BPARR)=-1
"RTN","BPSSCRCV",96,0)
 Q:$$EDITFLD(1.08,+BPDUZ7,"S^C:CMOP;M:MAIL;W:WINDOW;A:ALL","Display (C)MOP or (M)ail or (W)indow or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",97,0)
 Q:$$EDITFLD(1.09,+BPDUZ7,"S^R:REALTIME;B:BACKBILLS;A:ALL","Display (R)ealTime Fills or (B)ackbills or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",98,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",99,0)
 . S BPINP=$$EDITFLD(1.1,+BPDUZ7,"S^R:REJECT CODE;A:ALL","Display Specific (R)eject Code or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",100,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",101,0)
 . S BPINP=$$EDITFLD(1.15,+BPDUZ7,"P^BPSF(9002313.93,","Select Reject Code","",.BPARR)
"RTN","BPSSCRCV",102,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",103,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",104,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",105,0)
 . S BPINP=$$EDITFLD(1.11,+BPDUZ7,"S^I:SINGLE INSURANCE;A:ALL","Display Single (I)nsurance Company or (A)ll","ALL",.BPARR)
"RTN","BPSSCRCV",106,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",107,0)
 . S BPINP=$$INSURFLD(1.14,+BPDUZ7,"Select Insurance","",.BPARR)
"RTN","BPSSCRCV",108,0)
 . I +BPINP=0 S BPARR(1.11)="A",BPQ=1 D  Q  ;
"RTN","BPSSCRCV",109,0)
 . . W !,"Your selection will be changed to ALL insurances selected.",!
"RTN","BPSSCRCV",110,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",111,0)
 Q
"RTN","BPSSCRCV",112,0)
 ;
"RTN","BPSSCRCV",113,0)
 ;select insurance using IB API
"RTN","BPSSCRCV",114,0)
INSURFLD(FLDNO,RECIEN,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRCV",115,0)
 N DIR,RETV
"RTN","BPSSCRCV",116,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRCV",117,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRCV",118,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRCV",119,0)
 ;prompt the user
"RTN","BPSSCRCV",120,0)
 S RETV=$$SELINSUR^BPSSCRCU()
"RTN","BPSSCRCV",121,0)
 Q:(+RETV)<1 +RETV
"RTN","BPSSCRCV",122,0)
 ;save it in the database
"RTN","BPSSCRCV",123,0)
 S BPARRAY(FLDNO)=$P(RETV,U,2)
"RTN","BPSSCRCV",124,0)
 Q "1^"_(+RETV)
"RTN","BPSSCRCV",125,0)
 ;
"RTN","BPSSCRCV",126,0)
ERRMSG(BPMSG) ;
"RTN","BPSSCRCV",127,0)
 W !,"***",BPMSG,"***",!
"RTN","BPSSCRCV",128,0)
 D PAUSE^VALM1
"RTN","BPSSCRCV",129,0)
 Q
"RTN","BPSSCRCV",130,0)
 ;/**
"RTN","BPSSCRCV",131,0)
 ;FLDNO - filed #
"RTN","BPSSCRCV",132,0)
 ;RECIEN - ien in file #FILENO
"RTN","BPSSCRCV",133,0)
 ;DIR0 - like DIR(0) node for ^DIR - i.e. field type, etc
"RTN","BPSSCRCV",134,0)
 ;PRMTMSG - user prompt
"RTN","BPSSCRCV",135,0)
 ;DFLTVAL - pass the default value for the case if there is no value in database
"RTN","BPSSCRCV",136,0)
 ;BPARRAY - array to store and change values in profile
"RTN","BPSSCRCV",137,0)
 ;returns:
"RTN","BPSSCRCV",138,0)
 ;as return value:
"RTN","BPSSCRCV",139,0)
 ; "1^value" - if selected
"RTN","BPSSCRCV",140,0)
 ; "-1" if timeout or uparrow
"RTN","BPSSCRCV",141,0)
 ;via BPARRAY
"RTN","BPSSCRCV",142,0)
 ; BPARRAY(filedno)=value
"RTN","BPSSCRCV",143,0)
EDITFLD(FLDNO,RECIEN,DIR0,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRCV",144,0)
 N DIR,RETV,RETARR
"RTN","BPSSCRCV",145,0)
 N RECIENS,FDA,LCK,ERRARR
"RTN","BPSSCRCV",146,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRCV",147,0)
 I FLDNO=1.17 S RETV=$P($G(^DPT(+RETV,0)),U)
"RTN","BPSSCRCV",148,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRCV",149,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRCV",150,0)
 ;prompt the user
"RTN","BPSSCRCV",151,0)
 S RETV=$$PROMPT(DIR0,PRMTMSG,DFLTVAL)
"RTN","BPSSCRCV",152,0)
 Q:RETV<0 -1
"RTN","BPSSCRCV",153,0)
 ;save it in the database
"RTN","BPSSCRCV",154,0)
 S BPARRAY(FLDNO)=RETV
"RTN","BPSSCRCV",155,0)
 Q "1^"_RETV
"RTN","BPSSCRCV",156,0)
 ;
"RTN","BPSSCRCV",157,0)
 ;
"RTN","BPSSCRCV",158,0)
FILEIT(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","BPSSCRCV",159,0)
 N RECIENS
"RTN","BPSSCRCV",160,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",161,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","BPSSCRCV",162,0)
 L +^BPS(FILENO,RECIEN,1):10 S LCK=$T I 'LCK Q "0^"_NEWVAL_"^LOCKED"  ;quit
"RTN","BPSSCRCV",163,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","BPSSCRCV",164,0)
 I LCK L -^BPS(FILENO,RECIEN,1)
"RTN","BPSSCRCV",165,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","BPSSCRCV",166,0)
 Q "1^"_NEWVAL
"RTN","BPSSCRCV",167,0)
 ;
"RTN","BPSSCRCV",168,0)
 ;prompts for selection
"RTN","BPSSCRCV",169,0)
 ;returns selection
"RTN","BPSSCRCV",170,0)
 ;OR -1 when timeout and uparrow
"RTN","BPSSCRCV",171,0)
PROMPT(ZERONODE,PRMTMSG,DFLTVAL) ;
"RTN","BPSSCRCV",172,0)
 N Y,DUOUT,DTOUT,BPQUIT,DIROUT
"RTN","BPSSCRCV",173,0)
 S BPQUIT=0
"RTN","BPSSCRCV",174,0)
 I $E(ZERONODE,1,1)="P" D
"RTN","BPSSCRCV",175,0)
 . N DIC
"RTN","BPSSCRCV",176,0)
 . S DIC="^"_$P(ZERONODE,U,2)
"RTN","BPSSCRCV",177,0)
 . S DIC(0)="AEMNQ"
"RTN","BPSSCRCV",178,0)
 . S:$L($G(DFLTVAL))>0 DIC("B")=DFLTVAL
"RTN","BPSSCRCV",179,0)
 . S DIC("A")=PRMTMSG_": "
"RTN","BPSSCRCV",180,0)
 . D ^DIC
"RTN","BPSSCRCV",181,0)
 . I (Y=-1)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",182,0)
 E  D
"RTN","BPSSCRCV",183,0)
 . N DIR
"RTN","BPSSCRCV",184,0)
 . S DIR(0)=ZERONODE
"RTN","BPSSCRCV",185,0)
 . S DIR("A")=PRMTMSG
"RTN","BPSSCRCV",186,0)
 . S:$L($G(DFLTVAL))>0 DIR("B")=DFLTVAL
"RTN","BPSSCRCV",187,0)
 . D ^DIR
"RTN","BPSSCRCV",188,0)
 . I (Y=-1)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",189,0)
 I BPQUIT=1 Q -1
"RTN","BPSSCRCV",190,0)
 Q $P(Y,U)
"RTN","BPSSCRCV",191,0)
 ;
"RTN","BPSSCRCV",192,0)
GETFLD(FILENO,FLDNO,RECIEN) ;
"RTN","BPSSCRCV",193,0)
 N RETV,RETARR
"RTN","BPSSCRCV",194,0)
 N RECIENS
"RTN","BPSSCRCV",195,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",196,0)
 ; first try to get the value from file
"RTN","BPSSCRCV",197,0)
 D GETS^DIQ(FILENO,RECIENS,FLDNO,"E","RETARR")
"RTN","BPSSCRCV",198,0)
 S RETV=$G(RETARR(FILENO,RECIENS,FLDNO,"E"))
"RTN","BPSSCRCV",199,0)
 Q $G(RETV)
"RTN","BPSSCRCV",200,0)
 ;
"RTN","BPSSCRCV",201,0)
 ;save all profile array to file
"RTN","BPSSCRCV",202,0)
 ;BPARRAY - arrays with pointers to 9002313.56
"RTN","BPSSCRCV",203,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRCV",204,0)
FILEALL(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRCV",205,0)
 N BPFLD,BP2
"RTN","BPSSCRCV",206,0)
 S BPFLD=0
"RTN","BPSSCRCV",207,0)
 F  S BPFLD=+$O(BPARRAY(BPFLD)) Q:+BPFLD=0  D
"RTN","BPSSCRCV",208,0)
 . I $$SAVEPAR^BPSSCRSL(BPFLD,+BPDUZ7,$G(BPARRAY(BPFLD)))
"RTN","BPSSCRCV",209,0)
 I $$SAVEPAR^BPSSCRSL(2,BPDUZ7,$G(BPARRAY("DIVS")))
"RTN","BPSSCRCV",210,0)
 Q
"RTN","BPSSCRCV",211,0)
 ;
"RTN","BPSSCRCV",212,0)
 ;
"RTN","BPSSCRLG")
0^201^B91531978
"RTN","BPSSCRLG",1,0)
BPSSCRLG ;BHAM ISC/SS - ECME LOGINFO ;05-APR-05
"RTN","BPSSCRLG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRLG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRLG",4,0)
 ;
"RTN","BPSSCRLG",5,0)
 Q
"RTN","BPSSCRLG",6,0)
 ;
"RTN","BPSSCRLG",7,0)
EN ; -- main entry point for BPS LSTMN LOG
"RTN","BPSSCRLG",8,0)
 D EN^VALM("BPS LSTMN LOG")
"RTN","BPSSCRLG",9,0)
 Q
"RTN","BPSSCRLG",10,0)
 ;
"RTN","BPSSCRLG",11,0)
HDR ; -- header code
"RTN","BPSSCRLG",12,0)
 S VALMHDR(1)="Claim Log information"
"RTN","BPSSCRLG",13,0)
 S VALMHDR(2)=""
"RTN","BPSSCRLG",14,0)
 Q
"RTN","BPSSCRLG",15,0)
 ;
"RTN","BPSSCRLG",16,0)
INIT ; -- init variables and list array
"RTN","BPSSCRLG",17,0)
 N BPSELCLM,LINE
"RTN","BPSSCRLG",18,0)
 S BPSELCLM=$G(@VALMAR@("SELLN"))
"RTN","BPSSCRLG",19,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRLG",20,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRLG",21,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRLG",22,0)
 S LINE=1
"RTN","BPSSCRLG",23,0)
 S VALMCNT=$$PREPINFO(.LINE,$P(BPSELCLM,U,2),$P(BPSELCLM,U,3),$P(BPSELCLM,U,4))
"RTN","BPSSCRLG",24,0)
 S:VALMCNT>1 VALMCNT=VALMCNT-1
"RTN","BPSSCRLG",25,0)
 Q
"RTN","BPSSCRLG",26,0)
 ;
"RTN","BPSSCRLG",27,0)
HELP ; -- help code
"RTN","BPSSCRLG",28,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCRLG",29,0)
 K X
"RTN","BPSSCRLG",30,0)
 Q
"RTN","BPSSCRLG",31,0)
 ;
"RTN","BPSSCRLG",32,0)
EXIT ; -- exit code
"RTN","BPSSCRLG",33,0)
 Q
"RTN","BPSSCRLG",34,0)
 ;
"RTN","BPSSCRLG",35,0)
EXPND ; -- expand code
"RTN","BPSSCRLG",36,0)
 Q
"RTN","BPSSCRLG",37,0)
 ;
"RTN","BPSSCRLG",38,0)
 ;
"RTN","BPSSCRLG",39,0)
LOG ;entry point for LOG menu option of the main User Screen
"RTN","BPSSCRLG",40,0)
 N BPRET,BPSEL
"RTN","BPSSCRLG",41,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRLG",42,0)
 D FULL^VALM1
"RTN","BPSSCRLG",43,0)
 W !,"Enter the line number for which you wish to print claim logs."
"RTN","BPSSCRLG",44,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE Rx Line.")
"RTN","BPSSCRLG",45,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSSCRLG",46,0)
 D SAVESEL(BPSEL,VALMAR)
"RTN","BPSSCRLG",47,0)
 D EN
"RTN","BPSSCRLG",48,0)
 S VALMBCK="R"
"RTN","BPSSCRLG",49,0)
 Q
"RTN","BPSSCRLG",50,0)
 ;
"RTN","BPSSCRLG",51,0)
 ;save selection in order to use inside enclosed ListManager copy
"RTN","BPSSCRLG",52,0)
 ;BPSEL - selected line
"RTN","BPSSCRLG",53,0)
 ;BPVALMR - parent VALMAR 
"RTN","BPSSCRLG",54,0)
SAVESEL(BPSEL,BPVALMR) ;
"RTN","BPSSCRLG",55,0)
 D CLEANIT
"RTN","BPSSCRLG",56,0)
 S ^TMP("BPSLOG",$J,"VALM","SELLN")=BPSEL
"RTN","BPSSCRLG",57,0)
 S ^TMP("BPSLOG",$J,"VALM","PARENT")=BPVALMR
"RTN","BPSSCRLG",58,0)
 M ^TMP("BPSLOG",$J,"VALM","VIEWPARAMS")=@BPVALMR@("VIEWPARAMS")
"RTN","BPSSCRLG",59,0)
 Q
"RTN","BPSSCRLG",60,0)
 ;
"RTN","BPSSCRLG",61,0)
CLEANIT ;
"RTN","BPSSCRLG",62,0)
 K ^TMP("BPSLOG",$J,"VALM")
"RTN","BPSSCRLG",63,0)
 Q
"RTN","BPSSCRLG",64,0)
 ;input:
"RTN","BPSSCRLG",65,0)
 ; BPDFN: patient ien #2
"RTN","BPSSCRLG",66,0)
 ; BP36: insurance ien #36
"RTN","BPSSCRLG",67,0)
 ; BP59: ptr to #9002313.59
"RTN","BPSSCRLG",68,0)
 ; returns number of lines
"RTN","BPSSCRLG",69,0)
PREPINFO(BPLN,BPDFN,BP36,BP59) ;
"RTN","BPSSCRLG",70,0)
 I '$G(BP59) Q 0
"RTN","BPSSCRLG",71,0)
 I '$G(BP36) Q 0
"RTN","BPSSCRLG",72,0)
 I '$G(BPDFN) Q 0
"RTN","BPSSCRLG",73,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",74,0)
 N BPX,BPRXIEN,BPREF,BP1,BPLSTCLM,BPLSTRSP,BPDAT59,BPUSR,BPSTRT,BPHIST,BPQ
"RTN","BPSSCRLG",75,0)
 N BPDT,BPLN0,BPCNT
"RTN","BPSSCRLG",76,0)
 S BP1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRLG",77,0)
 S BPRXIEN=$P(BP1,U,1)
"RTN","BPSSCRLG",78,0)
 S BPREF=$P(BP1,U,2)
"RTN","BPSSCRLG",79,0)
 S BPDAT59(0)=$G(^BPST(BP59,0))
"RTN","BPSSCRLG",80,0)
 ;create a history
"RTN","BPSSCRLG",81,0)
 D MKHIST^BPSSCRU5(BP59,.BPHIST)
"RTN","BPSSCRLG",82,0)
 ;
"RTN","BPSSCRLG",83,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",84,0)
 D SETLINE(.BPLN,"Pharmacy ECME Log")
"RTN","BPSSCRLG",85,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",86,0)
 S BPX=$$RJ^BPSSCR02("VA Rx #: ",19)_$$LJ^BPSSCR02($$RXNUM^BPSSCRU2(+BPRXIEN),13)
"RTN","BPSSCRLG",87,0)
 S BPX=BPX_$$RJ^BPSSCR02("Fill #: ",10)_$$LJ^BPSSCR02(BPREF,4)
"RTN","BPSSCRLG",88,0)
 S BPX=BPX_$$RJ^BPSSCR02("ECME Claim Rx #: ",18)_$$LJ^BPSSCR02(BP59,20)
"RTN","BPSSCRLG",89,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",90,0)
 S BPX=$$RJ^BPSSCR02("Patient Name: ",19)
"RTN","BPSSCRLG",91,0)
 S BPX=BPX_$$LJ^BPSSCR02($$PATNAME^BPSSCRU2(BPDFN)_" "_$$SSN4^BPSSCRU2(BPDFN),30)
"RTN","BPSSCRLG",92,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",93,0)
 S BPX=$$RJ^BPSSCR02("Last Submitted: ",19)
"RTN","BPSSCRLG",94,0)
 S BPSTRT=$P(BPDAT59(0),U,11) ;@# need to check with analyst if this is a START DATE
"RTN","BPSSCRLG",95,0)
 I BPSTRT]"" S BPX=BPX_$$DATETIME^BPSSCRU5(BPSTRT)
"RTN","BPSSCRLG",96,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",97,0)
 S BPX=$$RJ^BPSSCR02("Last Submitted By: ",19)
"RTN","BPSSCRLG",98,0)
 S BPUSR=$P(BPDAT59(0),U,10)
"RTN","BPSSCRLG",99,0)
 I BPUSR]"" S BPX=BPX_$$GETUSRNM^BPSSCRU1(BPUSR)
"RTN","BPSSCRLG",100,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",101,0)
 ;
"RTN","BPSSCRLG",102,0)
 ;find the latest claim
"RTN","BPSSCRLG",103,0)
 S BP1=+$O(BPHIST("C",99999999),-1)
"RTN","BPSSCRLG",104,0)
 I BP1=0 D SETLINE(.BPLN,""),SETLINE(.BPLN,"------ No electronic claims ------") Q BPLN
"RTN","BPSSCRLG",105,0)
 S BP1=+$O(BPHIST("C",BP1,0))
"RTN","BPSSCRLG",106,0)
 S BPX=$$RJ^BPSSCR02("Last VA Claim #: ",19)_$P($G(^BPSC(+BP1,0)),U,1)
"RTN","BPSSCRLG",107,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",108,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",109,0)
 ;process history
"RTN","BPSSCRLG",110,0)
 N BPTYPE,BPIEN,BPIENRS
"RTN","BPSSCRLG",111,0)
 S BPDT=99999999
"RTN","BPSSCRLG",112,0)
 F  S BPDT=$O(BPHIST("C",BPDT),-1) Q:+BPDT=0  D
"RTN","BPSSCRLG",113,0)
 . S BPIEN=+$O(BPHIST("C",BPDT,0)) Q:BPIEN=""
"RTN","BPSSCRLG",114,0)
 . D DISPCLM(.BPLN,BP59,BPIEN,+BPHIST("C",BPDT,BPIEN),$P(BPHIST("C",BPDT,BPIEN),U,2),BPDT)
"RTN","BPSSCRLG",115,0)
 . S BPIENRS=0
"RTN","BPSSCRLG",116,0)
 . F  S BPIENRS=$O(BPHIST("C",BPDT,BPIEN,"R",BPIENRS)) Q:+BPIENRS=0  D
"RTN","BPSSCRLG",117,0)
 . . D DISPRSP(.BPLN,BP59,BPIENRS,+BPHIST("C",BPDT,BPIEN,"R",BPIENRS),$P(BPHIST("C",BPDT,BPIEN,"R",BPIENRS),U,2),BPDT)
"RTN","BPSSCRLG",118,0)
 Q BPLN
"RTN","BPSSCRLG",119,0)
 ;calls SET^VALM10,
"RTN","BPSSCRLG",120,0)
 ;increments BPLINE
"RTN","BPSSCRLG",121,0)
SETLINE(BPLINE,BPSTR) ;
"RTN","BPSSCRLG",122,0)
 D SET^VALM10(BPLINE,BPSTR)
"RTN","BPSSCRLG",123,0)
 S BPLINE=BPLINE+1
"RTN","BPSSCRLG",124,0)
 Q
"RTN","BPSSCRLG",125,0)
 ;display claim record
"RTN","BPSSCRLG",126,0)
DISPCLM(BPLN,BP59,BPIEN02,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",127,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",128,0)
 N BPX,BPLN0,BPCNT,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",129,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",130,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",131,0)
 S BPSTR1="Transmission Information ("_BPSTYP2_")(#"_BPIEN02_")"
"RTN","BPSSCRLG",132,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",133,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",134,0)
 D SETLINE(.BPLN,"Created on: "_$$CREATEDT(BPIEN02,BPSDTALT))
"RTN","BPSSCRLG",135,0)
 D SETLINE(.BPLN,"VA Claim ID: "_$P($G(^BPSC(+BPIEN02,0)),U,1))
"RTN","BPSSCRLG",136,0)
 D SETLINE(.BPLN,"Transaction Type: "_$$TRTYPE^BPSSCRU5($$TRCODE(BPIEN02)))
"RTN","BPSSCRLG",137,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSCLM(BPIEN02))
"RTN","BPSSCRLG",138,0)
 D SETLINE(.BPLN,"NDC: "_$$LNDC^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",139,0)
 D SETLINE(.BPLN,"ECME Pharmacy: "_$$DIVNAME^BPSSCRDS($$LDIV(BP57)))
"RTN","BPSSCRLG",140,0)
 D SETLINE(.BPLN,"Days Supply: "_$$DAYSSUPL(BPIEN02))
"RTN","BPSSCRLG",141,0)
 S BPX="Qty: "_$$QTY(BP57)
"RTN","BPSSCRLG",142,0)
 S BPX=BPX_"     Unit Price: "_$$UNTPRICE(BP57)
"RTN","BPSSCRLG",143,0)
 S BPX=BPX_"     Total Price: "_$$TOTPRICE(BP57)
"RTN","BPSSCRLG",144,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",145,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",146,0)
 D SETLINE(.BPLN,"Insurance Name: "_$$INSUR57(BP57))
"RTN","BPSSCRLG",147,0)
 D SETLINE(.BPLN,"BIN: "_$$BIN(BPIEN02))
"RTN","BPSSCRLG",148,0)
 D SETLINE(.BPLN,"PCN: "_$$PCN(BPIEN02))
"RTN","BPSSCRLG",149,0)
 D SETLINE(.BPLN,"Group ID: "_$$GRPID(BPIEN02))
"RTN","BPSSCRLG",150,0)
 D SETLINE(.BPLN,"Cardholder ID: "_$$CRDHLDID(BPIEN02))
"RTN","BPSSCRLG",151,0)
 D SETLINE(.BPLN,"Patient Relationship Code: "_$$PATRELSH(BPIEN02,BP57))
"RTN","BPSSCRLG",152,0)
 D SETLINE(.BPLN,"Cardholder First Name: "_$$CRDHLDFN(BPIEN02,BP57))
"RTN","BPSSCRLG",153,0)
 D SETLINE(.BPLN,"Cardholder Last Name: "_$$CRDHLDLN(BPIEN02,BP57))
"RTN","BPSSCRLG",154,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",155,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",156,0)
 D SETLINE(.BPLN,"Plan ID: "_$$PLANID(BP57))
"RTN","BPSSCRLG",157,0)
 D SETLINE(.BPLN,"Payer Sheet IEN: "_$$PYRIEN^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",158,0)
 D SETLINE(.BPLN,"B2 Payer Sheet IEN: "_$$B2PYRIEN^BPSSCRU5(BPIEN02,BP57))
"RTN","BPSSCRLG",159,0)
 D SETLINE(.BPLN,"B3 Rebill Payer Sheet: "_$$B3PYRIEN^BPSSCRU5(BPIEN02,BP59,BP57))
"RTN","BPSSCRLG",160,0)
 D SETLINE(.BPLN,"Certify Mode: "_$$CERTMOD(BP57))
"RTN","BPSSCRLG",161,0)
 D SETLINE(.BPLN,"Cert IEN: "_$$CERTIEN(BP57))
"RTN","BPSSCRLG",162,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",163,0)
 Q
"RTN","BPSSCRLG",164,0)
 ;Date os service date in BPS CLAIM file
"RTN","BPSSCRLG",165,0)
DOSCLM(BPIEN02) ;
"RTN","BPSSCRLG",166,0)
 N BPDT
"RTN","BPSSCRLG",167,0)
 S BPDT=$P($G(^BPSC(BPIEN02,400,1,400)),U,1)\1
"RTN","BPSSCRLG",168,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",169,0)
 ;record created on 
"RTN","BPSSCRLG",170,0)
CREATEDT(BPIEN02,BPSDTALT) ;
"RTN","BPSSCRLG",171,0)
 N BPSDT
"RTN","BPSSCRLG",172,0)
 S BPSDT=+$P($G(^BPSC(BPIEN02,0)),U,6)
"RTN","BPSSCRLG",173,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",174,0)
 Q
"RTN","BPSSCRLG",175,0)
 ;Plan ID from #9002313.57
"RTN","BPSSCRLG",176,0)
PLANID(BP57) ;
"RTN","BPSSCRLG",177,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,1)
"RTN","BPSSCRLG",178,0)
 ;
"RTN","BPSSCRLG",179,0)
CERTMOD(BP57) ;
"RTN","BPSSCRLG",180,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,5)
"RTN","BPSSCRLG",181,0)
 ;Software Vendor/Cert ID
"RTN","BPSSCRLG",182,0)
CERTIEN(BP57) ;
"RTN","BPSSCRLG",183,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,6)
"RTN","BPSSCRLG",184,0)
 ;group ID
"RTN","BPSSCRLG",185,0)
GRPID(BPIEN02) ;
"RTN","BPSSCRLG",186,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,1),3,99)
"RTN","BPSSCRLG",187,0)
 ;
"RTN","BPSSCRLG",188,0)
 ;Cardholder ID
"RTN","BPSSCRLG",189,0)
CRDHLDID(BPIEN02) ;
"RTN","BPSSCRLG",190,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,2),3,99)
"RTN","BPSSCRLG",191,0)
 ;Cardholder First name
"RTN","BPSSCRLG",192,0)
CRDHLDFN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",193,0)
 N Y
"RTN","BPSSCRLG",194,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,12)
"RTN","BPSSCRLG",195,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,6)
"RTN","BPSSCRLG",196,0)
 Q Y
"RTN","BPSSCRLG",197,0)
 ;Cardholder Last  Name
"RTN","BPSSCRLG",198,0)
CRDHLDLN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",199,0)
 N Y
"RTN","BPSSCRLG",200,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,13)
"RTN","BPSSCRLG",201,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,7)
"RTN","BPSSCRLG",202,0)
 Q Y
"RTN","BPSSCRLG",203,0)
 ;Patient Relationship Code
"RTN","BPSSCRLG",204,0)
PATRELSH(BPIEN02,BP57) ;
"RTN","BPSSCRLG",205,0)
 N Y
"RTN","BPSSCRLG",206,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,6)
"RTN","BPSSCRLG",207,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,5)
"RTN","BPSSCRLG",208,0)
 Q $S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"RTN","BPSSCRLG",209,0)
 ;
"RTN","BPSSCRLG",210,0)
PCN(BPIEN02) ;
"RTN","BPSSCRLG",211,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,4)
"RTN","BPSSCRLG",212,0)
 ;
"RTN","BPSSCRLG",213,0)
BIN(BPIEN02) ;
"RTN","BPSSCRLG",214,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,1)
"RTN","BPSSCRLG",215,0)
 ;insurance name by 9002313.57 pointer
"RTN","BPSSCRLG",216,0)
INSUR57(BPIEN57) ;
"RTN","BPSSCRLG",217,0)
 N BPINSN
"RTN","BPSSCRLG",218,0)
 S BPINSN=+$G(^BPSTL(BPIEN57,9))
"RTN","BPSSCRLG",219,0)
 Q $P($G(^BPSTL(BPIEN57,10,BPINSN,0)),U,7)
"RTN","BPSSCRLG",220,0)
 ;
"RTN","BPSSCRLG",221,0)
QTY(BPIEN57) ;
"RTN","BPSSCRLG",222,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,1)
"RTN","BPSSCRLG",223,0)
UNTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",224,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,2)
"RTN","BPSSCRLG",225,0)
TOTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",226,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,5)
"RTN","BPSSCRLG",227,0)
 ;get ECME pharmacy division ptr for LOG
"RTN","BPSSCRLG",228,0)
LDIV(BPIEN57) ;
"RTN","BPSSCRLG",229,0)
 Q +$P($G(^BPSTL(BPIEN57,1)),U,7)
"RTN","BPSSCRLG",230,0)
 ;transaction code
"RTN","BPSSCRLG",231,0)
TRCODE(BPIEN02) ;
"RTN","BPSSCRLG",232,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,3)
"RTN","BPSSCRLG",233,0)
 ;days supply
"RTN","BPSSCRLG",234,0)
DAYSSUPL(BPIEN02) ;
"RTN","BPSSCRLG",235,0)
 ;format D5NNN -> NNN
"RTN","BPSSCRLG",236,0)
 Q +$E($P($G(^BPSC(BPIEN02,400,1,400)),U,5),3,99)
"RTN","BPSSCRLG",237,0)
 ;
"RTN","BPSSCRLG",238,0)
 ;display response record
"RTN","BPSSCRLG",239,0)
DISPRSP(BPLN,BP59,BPIEN03,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",240,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",241,0)
 N BPX,BPLN0,BPCNT,BPRJCDS,BPRJ,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",242,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",243,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",244,0)
 S BPSTR1="Response Information  ("_BPSTYP2_")(#"_BPIEN03_")"
"RTN","BPSSCRLG",245,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",246,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",247,0)
 D SETLINE(.BPLN,"Response Received: "_$$RESPREC(BPIEN03,BPSDTALT))
"RTN","BPSSCRLG",248,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSRSP(BPIEN03))
"RTN","BPSSCRLG",249,0)
 D SETLINE(.BPLN,"Transaction Response Status: "_$$RESPSTAT^BPSSCRU5(BPIEN03))
"RTN","BPSSCRLG",250,0)
 D SETLINE(.BPLN,"Total Amount Paid: $"_+$$TOTAMNT(BPIEN03,BP59,BP57))
"RTN","BPSSCRLG",251,0)
 D SETLINE(.BPLN,"Reject code(s): ")
"RTN","BPSSCRLG",252,0)
 D REJCODES^BPSSCRU5(BPIEN03,.BPRJCDS)
"RTN","BPSSCRLG",253,0)
 S BPRJ=""
"RTN","BPSSCRLG",254,0)
 F  S BPRJ=$O(BPRJCDS(BPRJ)) Q:BPRJ=""  D
"RTN","BPSSCRLG",255,0)
 . D SETLINE(.BPLN," "_$$GETRJNAM^BPSSCRU3(BPRJ))
"RTN","BPSSCRLG",256,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$MESSAGE(BPIEN03),76,"Message: ",5)
"RTN","BPSSCRLG",257,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$ADDMESS(BPIEN03),76,"Additional Message: ",5)
"RTN","BPSSCRLG",258,0)
 ;D WRAPLN^BPSSCRU5(.BPLN,$$DUR(BPIEN03),60,"DUR Information: ",5)
"RTN","BPSSCRLG",259,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$DURRESP(BPIEN03),76,"DUR Response Info: ",5)
"RTN","BPSSCRLG",260,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",261,0)
 Q
"RTN","BPSSCRLG",262,0)
 ;
"RTN","BPSSCRLG",263,0)
RESPREC(BPIEN03,BPSDTALT) ;
"RTN","BPSSCRLG",264,0)
 N BPSDT
"RTN","BPSSCRLG",265,0)
 S BPSDT=+$P($G(^BPSR(BPIEN03,0)),U,2)
"RTN","BPSSCRLG",266,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",267,0)
 ;
"RTN","BPSSCRLG",268,0)
DOSRSP(BPIEN03) ;
"RTN","BPSSCRLG",269,0)
 N BPDT
"RTN","BPSSCRLG",270,0)
 S BPDT=$P($G(^BPSR(BPIEN03,400)),U,1)\1
"RTN","BPSSCRLG",271,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",272,0)
 ;
"RTN","BPSSCRLG",273,0)
TOTAMNT(BPIEN03,BP59,BP57) ;
"RTN","BPSSCRLG",274,0)
 Q $$DFF2EXT^BPSECFM($P($G(^BPSR(BPIEN03,1000,1,500)),U,9))
"RTN","BPSSCRLG",275,0)
 ;
"RTN","BPSSCRLG",276,0)
MESSAGE(BPIEN03) ;
"RTN","BPSSCRLG",277,0)
 Q $P($G(^BPSR(BPIEN03,504)),U)
"RTN","BPSSCRLG",278,0)
 ;
"RTN","BPSSCRLG",279,0)
ADDMESS(BPIEN03) ;
"RTN","BPSSCRLG",280,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,526)),U)
"RTN","BPSSCRLG",281,0)
 ;
"RTN","BPSSCRLG",282,0)
DUR(BPIEN03) ;
"RTN","BPSSCRLG",283,0)
 Q "???"
"RTN","BPSSCRLG",284,0)
 ;
"RTN","BPSSCRLG",285,0)
DURRESP(BPIEN03) ;
"RTN","BPSSCRLG",286,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,525)),U)
"RTN","BPSSCRPR")
0^8^B1032507
"RTN","BPSSCRPR",1,0)
BPSSCRPR ;BHAM ISC/SS - ECME SCREEN PRINT ;05-APR-05
"RTN","BPSSCRPR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRPR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRPR",4,0)
 Q
"RTN","BPSSCRPR",5,0)
 ;
"RTN","BPSSCRPR",6,0)
 ;
"RTN","BPSSCRPR",7,0)
 ;/**
"RTN","BPSSCRPR",8,0)
 ;FLDNO - field # in PARAMETER file to store prescription for the User Screen
"RTN","BPSSCRPR",9,0)
 ;RECIEN - user ID
"RTN","BPSSCRPR",10,0)
 ;PRMTMSG - user prompt
"RTN","BPSSCRPR",11,0)
 ;DFLTVAL - pass the default value for the case if there is no value in database
"RTN","BPSSCRPR",12,0)
 ;BPARRAY - array to store and change values in profile
"RTN","BPSSCRPR",13,0)
 ;returns:
"RTN","BPSSCRPR",14,0)
 ;as return value:
"RTN","BPSSCRPR",15,0)
 ; "1^value" - if selected
"RTN","BPSSCRPR",16,0)
 ; "-1" if timeout or uparrow
"RTN","BPSSCRPR",17,0)
 ;via BPARRAY
"RTN","BPSSCRPR",18,0)
 ; BPARRAY(FLDNO)=value  
"RTN","BPSSCRPR",19,0)
EDITRX(FLDNO,RECIEN,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRPR",20,0)
 N DIR,RETV,RETARR
"RTN","BPSSCRPR",21,0)
 N RECIENS,FDA,LCK,ERRARR
"RTN","BPSSCRPR",22,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRPR",23,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRPR",24,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRPR",25,0)
 ;prompt the user
"RTN","BPSSCRPR",26,0)
 S RETV=$$PROMPTRX^BPSUTIL1(PRMTMSG,DFLTVAL)
"RTN","BPSSCRPR",27,0)
 Q:RETV<0 -1
"RTN","BPSSCRPR",28,0)
 ;save it in the database
"RTN","BPSSCRPR",29,0)
 S BPARRAY(FLDNO)=RETV
"RTN","BPSSCRPR",30,0)
 Q "1^"_RETV
"RTN","BPSSCRPR",31,0)
 ;
"RTN","BPSSCRRS")
0^9^B25558353
"RTN","BPSSCRRS",1,0)
BPSSCRRS ;BHAM ISC/SS - ECME SCREEN RESUBMIT ;05-APR-05
"RTN","BPSSCRRS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSSCRRS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRRS",4,0)
 Q
"RTN","BPSSCRRS",5,0)
 ;IA 4702
"RTN","BPSSCRRS",6,0)
 ;
"RTN","BPSSCRRS",7,0)
RES ;
"RTN","BPSSCRRS",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRS",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRS",10,0)
 D FULL^VALM1
"RTN","BPSSCRRS",11,0)
 W !,"Enter the line numbers for the claim(s) to be resubmitted."
"RTN","BPSSCRRS",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRS",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRS",14,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRS",16,0)
 ;only if at least one claim was submitted successfully
"RTN","BPSSCRRS",17,0)
 I $$RESUBMIT(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for resubmitted claims...")
"RTN","BPSSCRRS",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRS",19,0)
 Q
"RTN","BPSSCRRS",20,0)
 ;
"RTN","BPSSCRRS",21,0)
 ;/**
"RTN","BPSSCRRS",22,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",23,0)
 ;input:
"RTN","BPSSCRRS",24,0)
 ; RXI - array with ptrs to BPS TRANSACTION file (see ASKLINES^BPSSCRU4)
"RTN","BPSSCRRS",25,0)
 ;returns 
"RTN","BPSSCRRS",26,0)
 ; 0 - if no claims were resubmitted 
"RTN","BPSSCRRS",27,0)
 ; 1 - if at least one claim was resubmitted 
"RTN","BPSSCRRS",28,0)
RESUBMIT(RXI) ;*/
"RTN","BPSSCRRS",29,0)
 N BPRVRSED ;was successfully reversed
"RTN","BPSSCRRS",30,0)
 N BPRVNEED ;needs reversal
"RTN","BPSSCRRS",31,0)
 N BPRVWAIT ;cycles of waiting 
"RTN","BPSSCRRS",32,0)
 N BPRVRSNT ;reversal has been sent
"RTN","BPSSCRRS",33,0)
 N WHERE,DOSDATE,BILLNUM,RXIEN,RXR,BPDFN
"RTN","BPSSCRRS",34,0)
 N BP59
"RTN","BPSSCRRS",35,0)
 N UPDATFLG,BPCLTOT,BPCLTOTR
"RTN","BPSSCRRS",36,0)
 N BPQ
"RTN","BPSSCRRS",37,0)
 N BPSTATUS
"RTN","BPSSCRRS",38,0)
 N REVCOUNT S REVCOUNT=0
"RTN","BPSSCRRS",39,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRS",40,0)
 S BPCLTOT=0 ;total for resubmitted
"RTN","BPSSCRRS",41,0)
 S BPCLTOTR=0 ;total for reversed, not resubmitted
"RTN","BPSSCRRS",42,0)
 S UPDATFLG=0
"RTN","BPSSCRRS",43,0)
 S BP59="",BPQ=""
"RTN","BPSSCRRS",44,0)
 F  S BP59=$O(RXI(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRS",45,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRS",46,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRS",47,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRS",48,0)
 . W !,"You've chosen to RESUBMIT the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRS",49,0)
 . W !,@VALMAR@(+$G(RXI(BP59)),0)
"RTN","BPSSCRRS",50,0)
 . S (BPRVNEED,BPRVRSED,BPRVWAIT,BPRVRSNT)=0
"RTN","BPSSCRRS",51,0)
 . S BPQ=$$YESNO("Are you sure?(Y/N)")
"RTN","BPSSCRRS",52,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRS",53,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRS",54,0)
 . S RXIEN=$P(BP59,".")
"RTN","BPSSCRRS",55,0)
 . S RXR=+$E($P(BP59,".",2),1,4)
"RTN","BPSSCRRS",56,0)
 . I BPRVNEED=1&(BPRVRSED'=1) Q  ;cannot be resubmitted
"RTN","BPSSCRRS",57,0)
 . I $$RXDEL^BPSOS(+RXIEN,RXR) W !!,">> Cannot Reverse or Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because it has been deleted in Pharmacy.",! Q
"RTN","BPSSCRRS",58,0)
 . S BPSTATUS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRS",59,0)
 . I BPSTATUS["E REVERSAL REJECTED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because the REVERSAL was rejected.",! Q
"RTN","BPSSCRRS",60,0)
 . I BPSTATUS["IN PROGRESS" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response from the payer yet.",! Q
"RTN","BPSSCRRS",61,0)
 . I BPSTATUS["E REVERSAL STRANDED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response for reversal yet.",! Q
"RTN","BPSSCRRS",62,0)
 . S DOSDATE=$$DOSDATE(RXIEN,RXR)
"RTN","BPSSCRRS",63,0)
 . S BILLNUM=$$EN^BPSNCPDP(RXIEN,RXR,DOSDATE,"ERES","","ECME RESUBMIT")
"RTN","BPSSCRRS",64,0)
 . ;print return value message
"RTN","BPSSCRRS",65,0)
 . W !!
"RTN","BPSSCRRS",66,0)
 . W:+BILLNUM>0 $S(+BILLNUM=10:"Reversal but no Resubmit:",1:"Not Processed:"),!,"  "
"RTN","BPSSCRRS",67,0)
 . ;Change Return Message for SC/EI
"RTN","BPSSCRRS",68,0)
 . S:$P(BILLNUM,U,2)="NEEDS SC DETERMINATION" $P(BILLNUM,U,2)="NEEDS SC/EI DETERMINATION"
"RTN","BPSSCRRS",69,0)
 . W $P(BILLNUM,U,2)
"RTN","BPSSCRRS",70,0)
 . ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRS",71,0)
 . ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRS",72,0)
 . ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRS",73,0)
 . ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRS",74,0)
 . ;4 Unable to queue the ECME claim
"RTN","BPSSCRRS",75,0)
 . ;5 Invalid input
"RTN","BPSSCRRS",76,0)
 . ;10 Reversal but no resubmit
"RTN","BPSSCRRS",77,0)
 . I +BILLNUM=0 D 
"RTN","BPSSCRRS",78,0)
 . . D ECMEACT^PSOBPSU1(+RXIEN,+RXR,"Claim resubmitted to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRS",79,0)
 . . S UPDATFLG=1,BPCLTOT=BPCLTOT+1
"RTN","BPSSCRRS",80,0)
 . I +BILLNUM=10 D 
"RTN","BPSSCRRS",81,0)
 . . D ECMEACT^PSOBPSU1(+RXIEN,+RXR,"Claim reversed but not resubmitted: ECME USER's SCREEN")
"RTN","BPSSCRRS",82,0)
 . . S UPDATFLG=1,BPCLTOTR=BPCLTOTR+1
"RTN","BPSSCRRS",83,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRS",84,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been resubmitted.",!
"RTN","BPSSCRRS",85,0)
 W:BPCLTOTR>0 !,BPCLTOTR," claim",$S(BPCLTOTR'=1:"s have",1:" has")," been reversed but not resubmitted.",!
"RTN","BPSSCRRS",86,0)
 D PAUSE^VALM1
"RTN","BPSSCRRS",87,0)
 Q UPDATFLG
"RTN","BPSSCRRS",88,0)
 ;
"RTN","BPSSCRRS",89,0)
 ; Ask
"RTN","BPSSCRRS",90,0)
 ; Input:
"RTN","BPSSCRRS",91,0)
 ;  BPQSTR - question
"RTN","BPSSCRRS",92,0)
 ;  BPDFL - default answer
"RTN","BPSSCRRS",93,0)
 ; Output: 
"RTN","BPSSCRRS",94,0)
 ; 1 YES
"RTN","BPSSCRRS",95,0)
 ; 0 NO
"RTN","BPSSCRRS",96,0)
 ; -1 if cancelled
"RTN","BPSSCRRS",97,0)
YESNO(BPQSTR,BPDFL) ; Default - YES
"RTN","BPSSCRRS",98,0)
 N DIR,Y,DUOUT
"RTN","BPSSCRRS",99,0)
 S DIR(0)="Y"
"RTN","BPSSCRRS",100,0)
 S DIR("A")=BPQSTR
"RTN","BPSSCRRS",101,0)
 S:$L($G(BPDFL)) DIR("B")=BPDFL
"RTN","BPSSCRRS",102,0)
 D ^DIR
"RTN","BPSSCRRS",103,0)
 Q $S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","BPSSCRRS",104,0)
 ;
"RTN","BPSSCRRS",105,0)
 ;Date of service
"RTN","BPSSCRRS",106,0)
 ;RXIEN - IEN in file #52
"RTN","BPSSCRRS",107,0)
 ;RXR - refill number
"RTN","BPSSCRRS",108,0)
 ;returns:
"RTN","BPSSCRRS",109,0)
 ; date of service
"RTN","BPSSCRRS",110,0)
DOSDATE(RXIEN,RXR) ;
"RTN","BPSSCRRS",111,0)
 N BPDOS,BPDT
"RTN","BPSSCRRS",112,0)
 ;try release date
"RTN","BPSSCRRS",113,0)
 S BPDOS=$$RXRLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",114,0)
 Q:+BPDOS>0 BPDOS
"RTN","BPSSCRRS",115,0)
 ;try fill date
"RTN","BPSSCRRS",116,0)
 S BPDOS=$$RXFLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",117,0)
 I '$G(DT) Q BPDOS
"RTN","BPSSCRRS",118,0)
 I BPDOS>0,BPDOS'>DT Q BPDOS
"RTN","BPSSCRRS",119,0)
 ;use current date (today)
"RTN","BPSSCRRS",120,0)
 Q DT\1
"RTN","BPSSCRRS",121,0)
 ;
"RTN","BPSSCRRS",122,0)
 ;To display the FILL date on the screen
"RTN","BPSSCRRS",123,0)
 ; use Date Of Service date , later on it might be changed
"RTN","BPSSCRRS",124,0)
 ;input:
"RTN","BPSSCRRS",125,0)
 ;RXIEN - IEN in file #52
"RTN","BPSSCRRS",126,0)
 ;RXR - refill number
"RTN","BPSSCRRS",127,0)
 ;returns:
"RTN","BPSSCRRS",128,0)
 ; date of service
"RTN","BPSSCRRS",129,0)
 ; or empty date if failure
"RTN","BPSSCRRS",130,0)
FILLDATE(RXIEN,RXR) ;
"RTN","BPSSCRRS",131,0)
 N DOSDT
"RTN","BPSSCRRS",132,0)
 S DOSDT=$$DOSDATE(RXIEN,RXR)
"RTN","BPSSCRRS",133,0)
 I $L(DOSDT)'=7 Q "  /  "
"RTN","BPSSCRRS",134,0)
 Q $E(DOSDT,4,5)_"/"_$E(DOSDT,6,7)
"RTN","BPSSCRRS",135,0)
 ;       
"RTN","BPSSCRRV")
0^10^B14899182
"RTN","BPSSCRRV",1,0)
BPSSCRRV ;BHAM ISC/SS - ECME SCREEN REVERSE CLAIM ;05-APR-05
"RTN","BPSSCRRV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRRV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRRV",4,0)
 Q
"RTN","BPSSCRRV",5,0)
 ;IA 4702
"RTN","BPSSCRRV",6,0)
 ;
"RTN","BPSSCRRV",7,0)
REV ;entry point for "Reverse" menu item
"RTN","BPSSCRRV",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRV",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRV",10,0)
 D FULL^VALM1
"RTN","BPSSCRRV",11,0)
 W !,"Enter the line numbers for the Payable claim(s) to be Reversed."
"RTN","BPSSCRRV",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRV",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRV",14,0)
 ;reverse selected lines
"RTN","BPSSCRRV",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRV",16,0)
 ;only if at least one reversal was submitted successfully
"RTN","BPSSCRRV",17,0)
 I $$RVLINES(.BPSARR59)>0 D REDRAW^BPSSCRUD("Updating screen for reversed claims...")
"RTN","BPSSCRRV",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRV",19,0)
 Q
"RTN","BPSSCRRV",20,0)
 ;/**
"RTN","BPSSCRRV",21,0)
 ;Reverse selected lines
"RTN","BPSSCRRV",22,0)
 ;input: 
"RTN","BPSSCRRV",23,0)
 ; BP59ARR(BP59)="line# in LM array "
"RTN","BPSSCRRV",24,0)
 ;output:
"RTN","BPSSCRRV",25,0)
 ; REVTOTAL - total number of claims for whose the reversal was submitted sucessfully  
"RTN","BPSSCRRV",26,0)
RVLINES(BP59ARR) ;*/
"RTN","BPSSCRRV",27,0)
 N BP59,REVTOTAL,BPRVREAS,BPDFN,BPQ
"RTN","BPSSCRRV",28,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRV",29,0)
 N BPSTATS
"RTN","BPSSCRRV",30,0)
 S REVTOTAL=0,BPQ=""
"RTN","BPSSCRRV",31,0)
 S BP59="" F  S BP59=$O(BP59ARR(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRV",32,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRV",33,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRV",34,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRV",35,0)
 . S BPSTATS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRV",36,0)
 . I BPSTATS'["E DUPLICATE",BPSTATS'["E REVERSAL REJECTED",BPSTATS'["E REVERSAL STRANDED",BPSTATS'["E PAYABLE" D  S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",37,0)
 . . W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"is NOT Payable and cannot be Reversed."
"RTN","BPSSCRRV",38,0)
 . ;
"RTN","BPSSCRRV",39,0)
 . W !,"You've chosen to REVERSE the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRV",40,0)
 . W !,$G(@VALMAR@(+$G(BP59ARR(BP59)),0))
"RTN","BPSSCRRV",41,0)
 . F  S BPRVREAS=$$COMMENT^BPSSCRCL("Enter REQUIRED REVERSAL REASON",60) Q:BPRVREAS="^"  Q:($L(BPRVREAS)>0)&&(BPRVREAS'="^")&&('(BPRVREAS?1" "." "))  D
"RTN","BPSSCRRV",42,0)
 . . W !,"Please provide the reason or enter ^ to abandon the reversal."
"RTN","BPSSCRRV",43,0)
 . I BPRVREAS["^" W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"was NOT reversed!" S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",44,0)
 . S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRRV",45,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRV",46,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRV",47,0)
 . I $$REVERSIT(BP59,BPRVREAS)=0 S REVTOTAL=REVTOTAL+1
"RTN","BPSSCRRV",48,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRV",49,0)
 W !,REVTOTAL," claim reversal",$S(REVTOTAL'=1:"s",1:"")," in progress.",!
"RTN","BPSSCRRV",50,0)
 D PAUSE^VALM1
"RTN","BPSSCRRV",51,0)
 Q REVTOTAL
"RTN","BPSSCRRV",52,0)
 ;
"RTN","BPSSCRRV",53,0)
 ;
"RTN","BPSSCRRV",54,0)
 ;the similar to REVERSE
"RTN","BPSSCRRV",55,0)
 ;with some information displayed for the user 
"RTN","BPSSCRRV",56,0)
 ;Input:
"RTN","BPSSCRRV",57,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",58,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",59,0)
 ;Output:
"RTN","BPSSCRRV",60,0)
 ;-1 Claim is not Payable
"RTN","BPSSCRRV",61,0)
 ;-2 no reversal, it's unreversable
"RTN","BPSSCRRV",62,0)
 ;-3 paper claim
"RTN","BPSSCRRV",63,0)
 ;>0 - IEN of reversal claim if electronic claim submitted for
"RTN","BPSSCRRV",64,0)
 ;   reversal.
"RTN","BPSSCRRV",65,0)
REVERSIT(BP59,BPRVREAS) ;
"RTN","BPSSCRRV",66,0)
 N BPRET
"RTN","BPSSCRRV",67,0)
 N BPRX
"RTN","BPSSCRRV",68,0)
 N BPRXRF
"RTN","BPSSCRRV",69,0)
 S BPRXRF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRRV",70,0)
 S BPRET=+$$REVERSE(BP59,BPRVREAS,+BPRXRF,+$P(BPRXRF,U,2))
"RTN","BPSSCRRV",71,0)
 S BPRX=$$RXNUM^BPSSCRU2(+BPRXRF)
"RTN","BPSSCRRV",72,0)
 Q BPRET
"RTN","BPSSCRRV",73,0)
 ;
"RTN","BPSSCRRV",74,0)
 ;
"RTN","BPSSCRRV",75,0)
 ;/**
"RTN","BPSSCRRV",76,0)
 ;Reverse the claim 
"RTN","BPSSCRRV",77,0)
 ;Input:
"RTN","BPSSCRRV",78,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",79,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",80,0)
 ; BPRX - RX ien (#52)
"RTN","BPSSCRRV",81,0)
 ; BPFIL - refill number
"RTN","BPSSCRRV",82,0)
 ;Output:
"RTN","BPSSCRRV",83,0)
 ; code^message
"RTN","BPSSCRRV",84,0)
 ; where 
"RTN","BPSSCRRV",85,0)
 ; code :
"RTN","BPSSCRRV",86,0)
 ;  from $$EN^BPSNCPDP
"RTN","BPSSCRRV",87,0)
 ;  0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",88,0)
 ;  1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",89,0)
 ;  2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",90,0)
 ;  3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",91,0)
 ;  4 Unable to queue the ECME claim
"RTN","BPSSCRRV",92,0)
 ;  5 Invalid input
"RTN","BPSSCRRV",93,0)
 ;  and additional 
"RTN","BPSSCRRV",94,0)
 ;  12 Claim has been deleted in Pharmacy.
"RTN","BPSSCRRV",95,0)
 ; message - whatever $$EN^BPSNCPDP returns
"RTN","BPSSCRRV",96,0)
 ; for 12 - "Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",97,0)
 ; 
"RTN","BPSSCRRV",98,0)
REVERSE(BP59,BPRVREAS,BPRX,BPFIL) ;*/
"RTN","BPSSCRRV",99,0)
 N BPDOS S BPDOS=$$DOSDATE^BPSSCRRS(BPRX,BPFIL)
"RTN","BPSSCRRV",100,0)
 N BPNDC S BPNDC=$$NDC^BPSSCRU2(BPRX,BPFIL)
"RTN","BPSSCRRV",101,0)
 N BPRET
"RTN","BPSSCRRV",102,0)
 I $$RXDEL^BPSOS(BPRX,BPFIL) D  Q 12_U_"Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",103,0)
 . W !,"The claim cannot be reversed since it has been deleted in Pharmacy."
"RTN","BPSSCRRV",104,0)
 S BPRET=$$EN^BPSNCPDP(BPRX,BPFIL,BPDOS,"EREV",BPNDC,BPRVREAS)
"RTN","BPSSCRRV",105,0)
 ;print return value message
"RTN","BPSSCRRV",106,0)
 W !!
"RTN","BPSSCRRV",107,0)
 W:+BPRET>0 "Not Processed:",!,"  "
"RTN","BPSSCRRV",108,0)
 W $P(BPRET,U,2)
"RTN","BPSSCRRV",109,0)
 ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",110,0)
 ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",111,0)
 ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",112,0)
 ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",113,0)
 ;4 Unable to queue the ECME claim
"RTN","BPSSCRRV",114,0)
 ;5 Invalid input
"RTN","BPSSCRRV",115,0)
 I +BPRET=0 D ECMEACT^PSOBPSU1(+BPRX,+BPFIL,"Claim reversal sent to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRV",116,0)
 Q BPRET
"RTN","BPSSCRRV",117,0)
 ;
"RTN","BPSSCRRV",118,0)
PAUSE() ;
"RTN","BPSSCRRV",119,0)
 N X
"RTN","BPSSCRRV",120,0)
 W ! S DIR(0)="E" D ^DIR K DIR W !
"RTN","BPSSCRRV",121,0)
 Q X
"RTN","BPSSCRRV",122,0)
 ;
"RTN","BPSSCRU2")
0^11^B41765546
"RTN","BPSSCRU2",1,0)
BPSSCRU2 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5**;JUN 2004;Build 45
"RTN","BPSSCRU2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRU2",4,0)
 ;USER SCREEN
"RTN","BPSSCRU2",5,0)
 Q
"RTN","BPSSCRU2",6,0)
 ;/**
"RTN","BPSSCRU2",7,0)
 ;Input:
"RTN","BPSSCRU2",8,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",9,0)
 ;Output:
"RTN","BPSSCRU2",10,0)
 ;get filling "location" like "WINDOW/LOCALMAIL/CMOP"
"RTN","BPSSCRU2",11,0)
GETMWC(BP59) ;*/
"RTN","BPSSCRU2",12,0)
 N BP1 S BP1=$$RXREF(BP59)
"RTN","BPSSCRU2",13,0)
 Q:+BP1=0 ""
"RTN","BPSSCRU2",14,0)
 Q $$MWC($P(BP1,U),$P(BP1,U,2))
"RTN","BPSSCRU2",15,0)
 ;
"RTN","BPSSCRU2",16,0)
 ;initially this was designed to convert numbers to letters to display on the screen
"RTN","BPSSCRU2",17,0)
 ;but later the Pharmacy designed API that returns letters instead of numbers
"RTN","BPSSCRU2",18,0)
 ;so now this function just returns what it receives in its parameter, while it does not 
"RTN","BPSSCRU2",19,0)
 ;make any sense, we still keep it in order to prevent changes in other four routines:
"RTN","BPSSCRU2",20,0)
 ; BPSREOP1, BPSSCR02, BPSSCR03, BPSSCR04
"RTN","BPSSCRU2",21,0)
MWCNAME(BPMWC) ;
"RTN","BPSSCRU2",22,0)
 Q BPMWC
"RTN","BPSSCRU2",23,0)
 ;/**
"RTN","BPSSCRU2",24,0)
 ;Input:
"RTN","BPSSCRU2",25,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",26,0)
 ;Output:
"RTN","BPSSCRU2",27,0)
 ;get RX pointer in file #52 and refill number in its multiple (0 - original refill)
"RTN","BPSSCRU2",28,0)
RXREF(BP59) ;
"RTN","BPSSCRU2",29,0)
 N BPRX,BPREF
"RTN","BPSSCRU2",30,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11) ;ptr to RX node in #52
"RTN","BPSSCRU2",31,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U) ;ptr to refill multiple in #52
"RTN","BPSSCRU2",32,0)
 Q BPRX_U_BPREF
"RTN","BPSSCRU2",33,0)
 ; determines if the refill was MAIL/WINDOW/CMOP
"RTN","BPSSCRU2",34,0)
MWC(BPRX,BPREF) ;MAIL/WINDOW/CMOP
"RTN","BPSSCRU2",35,0)
 ;input:
"RTN","BPSSCRU2",36,0)
 ; BPRX ptr to #52 (RX)
"RTN","BPSSCRU2",37,0)
 ; BPREF ptr to #52.1 (refills)
"RTN","BPSSCRU2",38,0)
 ;return value:
"RTN","BPSSCRU2",39,0)
 ; 2-MAIL/3-WINDOW/4-CMOP
"RTN","BPSSCRU2",40,0)
 Q $$MWC^PSOBPSU2(BPRX,BPREF)
"RTN","BPSSCRU2",41,0)
 ;
"RTN","BPSSCRU2",42,0)
 ;
"RTN","BPSSCRU2",43,0)
 ;/**
"RTN","BPSSCRU2",44,0)
 ;Input:
"RTN","BPSSCRU2",45,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",46,0)
 ;Output:
"RTN","BPSSCRU2",47,0)
 ; insurance ien ^ name ^ phone
"RTN","BPSSCRU2",48,0)
GETINSUR(BP59) ;get insurance info by the pointer of #9002313.59
"RTN","BPSSCRU2",49,0)
 N BPHONE,BPINSNM,BPINSID,BP57,BPINSN,BPX
"RTN","BPSSCRU2",50,0)
 S BPX=$$NAMEPHON^BPSSCRU3(BP59)
"RTN","BPSSCRU2",51,0)
 S BPINSNM=$P(BPX,U,1)
"RTN","BPSSCRU2",52,0)
 S BPHONE=$P(BPX,U,2)
"RTN","BPSSCRU2",53,0)
 ;Get a temporary ID for the insurance from ^TMP list of insurances.
"RTN","BPSSCRU2",54,0)
 ;If doesn't exist yet then create a new record in ^TMP list of insurances 
"RTN","BPSSCRU2",55,0)
 ;   for this insurance and return the ID for the record.
"RTN","BPSSCRU2",56,0)
 ;A lifetime for ^TMP list of insurances is the time period the user is using 
"RTN","BPSSCRU2",57,0)
 ;   the User Screen menu option
"RTN","BPSSCRU2",58,0)
 S BPINSID=$$CHKINSUR^BPSSCR(BPINSNM,BPHONE)
"RTN","BPSSCRU2",59,0)
 I $L(BPHONE)=0 S BPHONE=" "
"RTN","BPSSCRU2",60,0)
 I $L(BPINSNM)=0 S BPINSNM="?NODATA?"
"RTN","BPSSCRU2",61,0)
 Q BPINSID_U_BPINSNM_U_BPHONE
"RTN","BPSSCRU2",62,0)
 ;
"RTN","BPSSCRU2",63,0)
 ;/**
"RTN","BPSSCRU2",64,0)
 ;Input:
"RTN","BPSSCRU2",65,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",66,0)
 ;Output:
"RTN","BPSSCRU2",67,0)
 ;transaction date
"RTN","BPSSCRU2",68,0)
TRANDT(BP59) ;
"RTN","BPSSCRU2",69,0)
 Q $P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRU2",70,0)
 ;
"RTN","BPSSCRU2",71,0)
 ;/**
"RTN","BPSSCRU2",72,0)
 ;Input:
"RTN","BPSSCRU2",73,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",74,0)
 ;Output:
"RTN","BPSSCRU2",75,0)
 ;ECME pharmacy division (9002313.56)
"RTN","BPSSCRU2",76,0)
DIVIS(BP59) ;
"RTN","BPSSCRU2",77,0)
 Q $P($G(^BPST(BP59,1)),U,7)
"RTN","BPSSCRU2",78,0)
 ;
"RTN","BPSSCRU2",79,0)
 ;/**
"RTN","BPSSCRU2",80,0)
 ;Input:
"RTN","BPSSCRU2",81,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",82,0)
 ;Output:
"RTN","BPSSCRU2",83,0)
 ;patient's DFN (file #2)
"RTN","BPSSCRU2",84,0)
GETPATID(BP59) ;
"RTN","BPSSCRU2",85,0)
 Q $P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRU2",86,0)
 ;
"RTN","BPSSCRU2",87,0)
 ;return RX status as ACT/DIS/etc
"RTN","BPSSCRU2",88,0)
RXST(BP59) ;
"RTN","BPSSCRU2",89,0)
 N BPRXREF
"RTN","BPSSCRU2",90,0)
 S BPRXREF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU2",91,0)
 ;display status ONLY if the refill is the most recent 
"RTN","BPSSCRU2",92,0)
 ;otherwise display blanks (three spaces for sorting purposes)
"RTN","BPSSCRU2",93,0)
 I +$P(BPRXREF,U,2)'=(+$$LSTRFL^PSOBPSU1(+$P(BPRXREF,U,1))) Q "***"
"RTN","BPSSCRU2",94,0)
 Q $$RXSTANAM($$RXSTATUS(+$P(BPRXREF,U,1)))
"RTN","BPSSCRU2",95,0)
 ;/**
"RTN","BPSSCRU2",96,0)
 ;RX status
"RTN","BPSSCRU2",97,0)
 ;Input 
"RTN","BPSSCRU2",98,0)
 ; RXNUM:
"RTN","BPSSCRU2",99,0)
 ;  ien of file #52 (if MODE=0) 
"RTN","BPSSCRU2",100,0)
 ;  or RX number (if MODE=1)
"RTN","BPSSCRU2",101,0)
 ;----------
"RTN","BPSSCRU2",102,0)
 ;Output:
"RTN","BPSSCRU2",103,0)
 ; 0    if not found
"RTN","BPSSCRU2",104,0)
 ; status set#
"RTN","BPSSCRU2",105,0)
RXSTATUS(RXNUM) ;*/
"RTN","BPSSCRU2",106,0)
 N BPRET
"RTN","BPSSCRU2",107,0)
 S BPRET=$$RXAPI1^BPSUTIL1(RXNUM,100,"I")
"RTN","BPSSCRU2",108,0)
 I BPRET="" Q -1
"RTN","BPSSCRU2",109,0)
 Q BPRET
"RTN","BPSSCRU2",110,0)
 ;/**
"RTN","BPSSCRU2",111,0)
 ;if RX "valid" 
"RTN","BPSSCRU2",112,0)
RXACTIVE(BPRXSTAT) ;*/
"RTN","BPSSCRU2",113,0)
 ; 0    not valid
"RTN","BPSSCRU2",114,0)
 ; 1    valid (i.e. ACTIVE/NON-VERIFIED/REFILL/HOLD/DRUG INTERACTIONS/SUSPENDED) 
"RTN","BPSSCRU2",115,0)
 ; -1   doesn't exist
"RTN","BPSSCRU2",116,0)
 Q:BPRXSTAT<6 1  ;active
"RTN","BPSSCRU2",117,0)
 ;/**
"RTN","BPSSCRU2",118,0)
 ;RX status text
"RTN","BPSSCRU2",119,0)
RXSTANAM(BPRXSTAT) ;*/
"RTN","BPSSCRU2",120,0)
 Q:BPRXSTAT=0 "ACT"  ; ACTIVE; 
"RTN","BPSSCRU2",121,0)
 Q:BPRXSTAT=1 "NVER"  ; NON-VERIFIED; 
"RTN","BPSSCRU2",122,0)
 Q:BPRXSTAT=3 "HLD"  ; HOLD; 
"RTN","BPSSCRU2",123,0)
 Q:BPRXSTAT=5 "SUS"  ; SUSPENDED; 
"RTN","BPSSCRU2",124,0)
 Q:BPRXSTAT=11 "EXP"  ; EXPIRED; 
"RTN","BPSSCRU2",125,0)
 Q:BPRXSTAT=12 "DIS"  ; DISCONTINUED; 
"RTN","BPSSCRU2",126,0)
 Q:BPRXSTAT=13 "DEL"  ; DELETED; 
"RTN","BPSSCRU2",127,0)
 Q:BPRXSTAT=14 "DIS"  ; DISCONTINUED BY PROVIDER; 
"RTN","BPSSCRU2",128,0)
 Q:BPRXSTAT=15 "DIS"  ; DISCONTINUED (EDIT); 
"RTN","BPSSCRU2",129,0)
 Q:BPRXSTAT=16 "HLD"  ; PROVIDER HOLD; 
"RTN","BPSSCRU2",130,0)
 Q:BPRXSTAT=-1 "???"
"RTN","BPSSCRU2",131,0)
 Q ""
"RTN","BPSSCRU2",132,0)
 ;/**
"RTN","BPSSCRU2",133,0)
 ;Input:
"RTN","BPSSCRU2",134,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",135,0)
 ;Output:
"RTN","BPSSCRU2",136,0)
 ;returns:
"RTN","BPSSCRU2",137,0)
 ;>0  Released
"RTN","BPSSCRU2",138,0)
 ;0   non released
"RTN","BPSSCRU2",139,0)
 ;-1  error
"RTN","BPSSCRU2",140,0)
ISRXREL(BP59) ;
"RTN","BPSSCRU2",141,0)
 N BP1
"RTN","BPSSCRU2",142,0)
 S BP1=$$REFILINF(BP59)
"RTN","BPSSCRU2",143,0)
 Q:BP1<0 -1
"RTN","BPSSCRU2",144,0)
 Q $P(BP1,U,2) ; i.e. it is non-released if there is no any release date
"RTN","BPSSCRU2",145,0)
 ;
"RTN","BPSSCRU2",146,0)
 ;release status
"RTN","BPSSCRU2",147,0)
RL(BP59) ;
"RTN","BPSSCRU2",148,0)
 Q $S($$ISRXREL(BP59)>0:"RL",1:"NR")
"RTN","BPSSCRU2",149,0)
 ;/**
"RTN","BPSSCRU2",150,0)
 ;get refill (including original refill) info by BP59
"RTN","BPSSCRU2",151,0)
 ;Input:
"RTN","BPSSCRU2",152,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",153,0)
 ;Output:
"RTN","BPSSCRU2",154,0)
 ;returns:
"RTN","BPSSCRU2",155,0)
 ;on error : "-1"  
"RTN","BPSSCRU2",156,0)
 ;on success : refill# ^ release date ^label print date ^ fill date ^ issue date
"RTN","BPSSCRU2",157,0)
REFILINF(BP59) ;*/
"RTN","BPSSCRU2",158,0)
 N BP1 S BP1=$$RXREF(BP59)
"RTN","BPSSCRU2",159,0)
 N BPRX S BPRX=$P(BP1,U,1) ;ptr to #52
"RTN","BPSSCRU2",160,0)
 N BPREF S BPREF=$P(BP1,U,2) ;ptr in its refill multiple
"RTN","BPSSCRU2",161,0)
 I BPREF,$$IFREFILL(BPRX,BPREF)=0 Q -1  ;if bad data
"RTN","BPSSCRU2",162,0)
 ;original refill
"RTN","BPSSCRU2",163,0)
 I BPREF=0 Q "0"_U_$$RXRELDT(BPRX)_U_U_$$RXFILDT(BPRX)_U_$$RXISSDT(BPRX)
"RTN","BPSSCRU2",164,0)
 ;refill's release date
"RTN","BPSSCRU2",165,0)
 I BPREF>0 Q BPREF_U_$$REFRELDT(BPRX,BPREF)_U_U_$$REFFILDT(BPRX,BPREF)_U_$$REFISSDT(BPRX,BPREF)
"RTN","BPSSCRU2",166,0)
 Q -1
"RTN","BPSSCRU2",167,0)
 ;
"RTN","BPSSCRU2",168,0)
 ;-Prescriptions-----------------------
"RTN","BPSSCRU2",169,0)
 ;RX issue date
"RTN","BPSSCRU2",170,0)
RXISSDT(BPRX) ;
"RTN","BPSSCRU2",171,0)
 Q +$$RXAPI1^BPSUTIL1(BPRX,1,"I")
"RTN","BPSSCRU2",172,0)
 ;
"RTN","BPSSCRU2",173,0)
 ;RX's release date
"RTN","BPSSCRU2",174,0)
RXRELDT(BPRX) ;
"RTN","BPSSCRU2",175,0)
 Q +$$RXAPI1^BPSUTIL1(BPRX,31,"I")
"RTN","BPSSCRU2",176,0)
 ;
"RTN","BPSSCRU2",177,0)
 ;RX's fill date
"RTN","BPSSCRU2",178,0)
RXFILDT(BPRX) ;
"RTN","BPSSCRU2",179,0)
 Q +$$RXAPI1^BPSUTIL1(BPRX,22,"I")
"RTN","BPSSCRU2",180,0)
 ;
"RTN","BPSSCRU2",181,0)
 ;refill's release date
"RTN","BPSSCRU2",182,0)
REFRELDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",183,0)
 Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,BPREF,17,"I")
"RTN","BPSSCRU2",184,0)
 ;
"RTN","BPSSCRU2",185,0)
 ;refill's refill date
"RTN","BPSSCRU2",186,0)
REFFILDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",187,0)
 Q $$RXSUBF1^BPSUTIL1(BPRX,52,52.1,BPREF,.01,"I")
"RTN","BPSSCRU2",188,0)
 ;
"RTN","BPSSCRU2",189,0)
 ;refill's issue date
"RTN","BPSSCRU2",190,0)
REFISSDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",191,0)
 Q $$REFDISDT(BPRX,BPREF)
"RTN","BPSSCRU2",192,0)
 ;
"RTN","BPSSCRU2",193,0)
 ;refill's dispense date
"RTN","BPSSCRU2",194,0)
REFDISDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",195,0)
 Q $$RXSUBF1^BPSUTIL1(BPRX,52,52.1,BPREF,10.1,"I")
"RTN","BPSSCRU2",196,0)
 ;
"RTN","BPSSCRU2",197,0)
 ;if refill exists
"RTN","BPSSCRU2",198,0)
IFREFILL(BPRX,BPREF) ;
"RTN","BPSSCRU2",199,0)
 Q $$RXSUBF1^BPSUTIL1(BPRX,52,52.1,BPREF,.01,"I")'=""
"RTN","BPSSCRU2",200,0)
 ;/**
"RTN","BPSSCRU2",201,0)
 ;input 
"RTN","BPSSCRU2",202,0)
 ;ptr to 9002313.59
"RTN","BPSSCRU2",203,0)
 ;output :
"RTN","BPSSCRU2",204,0)
 ; BB - back billing
"RTN","BPSSCRU2",205,0)
 ; RT - all other values in (#1201) RX ACTION field on 9002313.59
"RTN","BPSSCRU2",206,0)
RTBB(BP59) ;*/
"RTN","BPSSCRU2",207,0)
 N BPTRBB
"RTN","BPSSCRU2",208,0)
 S BPTRBB=$P($G(^BPST(BP59,12)),U)
"RTN","BPSSCRU2",209,0)
 I BPTRBB="" Q "**"
"RTN","BPSSCRU2",210,0)
 I BPTRBB="BB" Q "BB"
"RTN","BPSSCRU2",211,0)
 Q "RT"
"RTN","BPSSCRU2",212,0)
 ;
"RTN","BPSSCRU2",213,0)
 ;------------ patient's name
"RTN","BPSSCRU2",214,0)
PATNAME(BPDFN) ;
"RTN","BPSSCRU2",215,0)
 Q $E($P($G(^DPT(BPDFN,0)),U),1,15)
"RTN","BPSSCRU2",216,0)
 ;
"RTN","BPSSCRU2",217,0)
SSN4(DFN) ;last 4 SSN
"RTN","BPSSCRU2",218,0)
 N X
"RTN","BPSSCRU2",219,0)
 S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","BPSSCRU2",220,0)
 Q "("_$E(X,$L(X)-3,$L(X))_")"
"RTN","BPSSCRU2",221,0)
 ;
"RTN","BPSSCRU2",222,0)
 ;get drug generic name
"RTN","BPSSCRU2",223,0)
DRGNAM(BP50) ;
"RTN","BPSSCRU2",224,0)
 ;BP50 - ptr to #50
"RTN","BPSSCRU2",225,0)
 Q $E($$DRUGDIE^BPSUTIL1(BP50,.01,"E"),1,35)
"RTN","BPSSCRU2",226,0)
 ;get drug
"RTN","BPSSCRU2",227,0)
GETDRUG(BP52) ;
"RTN","BPSSCRU2",228,0)
 ;return value:
"RTN","BPSSCRU2",229,0)
 ; 0 - unknown
"RTN","BPSSCRU2",230,0)
 ; n - ptr to DRUG file #50
"RTN","BPSSCRU2",231,0)
 Q +$$RXAPI1^BPSUTIL1(BP52,6,"I")
"RTN","BPSSCRU2",232,0)
 ;
"RTN","BPSSCRU2",233,0)
GETDRG59(BP59) ;
"RTN","BPSSCRU2",234,0)
 N BPX
"RTN","BPSSCRU2",235,0)
 S BPX=$$RXREF(BP59)
"RTN","BPSSCRU2",236,0)
 Q $$GETDRUG(+BPX)
"RTN","BPSSCRU2",237,0)
 ;
"RTN","BPSSCRU2",238,0)
 ;
"RTN","BPSSCRU2",239,0)
 ;review %% for each of claims in the array 
"RTN","BPSSCRU2",240,0)
 ;and calculate "overall" "done" status
"RTN","BPSSCRU2",241,0)
 ;input:
"RTN","BPSSCRU2",242,0)
 ; BPARR59 - array of ptr to #9002313.59
"RTN","BPSSCRU2",243,0)
 ;output:
"RTN","BPSSCRU2",244,0)
 ; status
"RTN","BPSSCRU2",245,0)
FINISHST(BPARR59) ;
"RTN","BPSSCRU2",246,0)
 N BPFIN,BP59
"RTN","BPSSCRU2",247,0)
 S BPFIN=1,BP59=0
"RTN","BPSSCRU2",248,0)
 F  S BP59=$O(BPARR59(BP59)) Q:+BP59=0  D  Q:BPFIN=0
"RTN","BPSSCRU2",249,0)
 . I $$PRCNTG^BPSSCRU3(BP59)<99 S BPFIN=0
"RTN","BPSSCRU2",250,0)
 I BPFIN=1 Q "**FINISHED**"
"RTN","BPSSCRU2",251,0)
 Q ""
"RTN","BPSSCRU2",252,0)
 ;
"RTN","BPSSCRU2",253,0)
 ;/**
"RTN","BPSSCRU2",254,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU2",255,0)
 ;output :
"RTN","BPSSCRU2",256,0)
 ;ECME number 
"RTN","BPSSCRU2",257,0)
 ; 7 digits of the prescription IEN file 52
"RTN","BPSSCRU2",258,0)
 ;or 7 spaces
"RTN","BPSSCRU2",259,0)
ECMENUM(BP59) ;*/
"RTN","BPSSCRU2",260,0)
 N X
"RTN","BPSSCRU2",261,0)
 S X=$P($G(^BPST(BP59,0)),"^")
"RTN","BPSSCRU2",262,0)
 I X="" Q $$FORMAT(X,7," ",1)
"RTN","BPSSCRU2",263,0)
 Q $$FORMAT(X\1,7,"0",1)
"RTN","BPSSCRU2",264,0)
 ;
"RTN","BPSSCRU2",265,0)
 ;BPRX - ptr to #52
"RTN","BPSSCRU2",266,0)
RXNUM(BPRX) ;
"RTN","BPSSCRU2",267,0)
 Q $$RXAPI1^BPSUTIL1(BPRX,.01,"E")_$S(+$$RXAPI1^BPSUTIL1(BPRX,105,"I"):"$",1:"")
"RTN","BPSSCRU2",268,0)
 ;
"RTN","BPSSCRU2",269,0)
 ;/**
"RTN","BPSSCRU2",270,0)
 ;get NDC
"RTN","BPSSCRU2",271,0)
 ;input 
"RTN","BPSSCRU2",272,0)
 ;BPRX - ptr to #52
"RTN","BPSSCRU2",273,0)
 ;BPREF - refill # (0,1,2,3...)
"RTN","BPSSCRU2",274,0)
NDC(BPRX,BPREF) ;*/
"RTN","BPSSCRU2",275,0)
 Q $$GETNDC^PSONDCUT(BPRX,BPREF)
"RTN","BPSSCRU2",276,0)
 ;
"RTN","BPSSCRU2",277,0)
DRGNAME(BP59) ;drug name BP59 -ptr to .59 file
"RTN","BPSSCRU2",278,0)
 N BPRX
"RTN","BPSSCRU2",279,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11) ;ptr to RX node in #52
"RTN","BPSSCRU2",280,0)
 Q $E($$DRGNAM($$GETDRUG(BPRX)),1,23)
"RTN","BPSSCRU2",281,0)
 ;
"RTN","BPSSCRU2",282,0)
 ;is the number even?
"RTN","BPSSCRU2",283,0)
 ;1-yes
"RTN","BPSSCRU2",284,0)
 ;0 -no
"RTN","BPSSCRU2",285,0)
ISEVEN(BPNUM) ;
"RTN","BPSSCRU2",286,0)
 Q ((BPNUM/2)-(BPNUM\2))=0
"RTN","BPSSCRU2",287,0)
 ;
"RTN","BPSSCRU2",288,0)
 ;BPSTR - string to format
"RTN","BPSSCRU2",289,0)
 ;BPSMLEN - max lenght
"RTN","BPSSCRU2",290,0)
 ;BPSCHR - char to add
"RTN","BPSSCRU2",291,0)
 ;BPSLFT - 1 - add from the left, 0 - from the right
"RTN","BPSSCRU2",292,0)
FORMAT(BPSTR,BPSMLEN,BPSCHR,BPSLFT) ;
"RTN","BPSSCRU2",293,0)
 N LN S LN=$L(BPSTR)
"RTN","BPSSCRU2",294,0)
 N ZZ S ZZ=""
"RTN","BPSSCRU2",295,0)
 I LN=BPSMLEN Q BPSTR
"RTN","BPSSCRU2",296,0)
 I LN>BPSMLEN Q:BPSLFT $E(BPSTR,LN-BPSMLEN+1,9999) Q $E(BPSTR,1,BPSMLEN)
"RTN","BPSSCRU2",297,0)
 S $P(ZZ,BPSCHR,BPSMLEN-LN+1)=""
"RTN","BPSSCRU2",298,0)
 Q:BPSLFT ZZ_BPSTR
"RTN","BPSSCRU2",299,0)
 Q BPSTR_ZZ
"RTN","BPSSCRU2",300,0)
 ;
"RTN","BPSSCRU3")
0^195^B34384463
"RTN","BPSSCRU3",1,0)
BPSSCRU3 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRU3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRU3",4,0)
 ;USER SCREEN
"RTN","BPSSCRU3",5,0)
 Q
"RTN","BPSSCRU3",6,0)
 ;get comment from BPS TRANSACTION file
"RTN","BPSSCRU3",7,0)
 ;BP59 - ien in that file
"RTN","BPSSCRU3",8,0)
COMMENT(BP59) ;
"RTN","BPSSCRU3",9,0)
 N BPCMNT,BPX
"RTN","BPSSCRU3",10,0)
 S BPCMNT=$O(^BPST(BP59,11,999999),-1)
"RTN","BPSSCRU3",11,0)
 I BPCMNT="" Q ""
"RTN","BPSSCRU3",12,0)
 S BPX=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCRU3",13,0)
 Q $$DATTIM($P(BPX,U,1)\1)_" - "_$P(BPX,U,3)_U_$$USERNAM^BPSCMT01($P(BPX,U,2))
"RTN","BPSSCRU3",14,0)
 ;
"RTN","BPSSCRU3",15,0)
DATTIM(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",16,0)
 I +X=0 W ""
"RTN","BPSSCRU3",17,0)
 N DATE,YR,BPT,BPM,BPH,BPAP
"RTN","BPSSCRU3",18,0)
 I $G(X) S YR=$E(X,2,3)
"RTN","BPSSCRU3",19,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",20,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSSCRU3",21,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSSCRU3",22,0)
 S BPAP="a" I BPH>12 S BPH=BPH-12,BPAP="p" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSSCRU3",23,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSSCRU3",24,0)
 Q $G(DATE)
"RTN","BPSSCRU3",25,0)
 ;/**
"RTN","BPSSCRU3",26,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",27,0)
 ;returns the string with none, one or more than one of the following:
"RTN","BPSSCRU3",28,0)
 ; PB - payable
"RTN","BPSSCRU3",29,0)
 ; RJ - rejected
"RTN","BPSSCRU3",30,0)
 ; RA - reversal accepted
"RTN","BPSSCRU3",31,0)
 ; RR
"RTN","BPSSCRU3",32,0)
 ; AR - autoreversal
"RTN","BPSSCRU3",33,0)
 ; SR - stranded
"RTN","BPSSCRU3",34,0)
 ; example: "^RV^AR"
"RTN","BPSSCRU3",35,0)
CLAIMST(BP59,BPDESRC) ;*/
"RTN","BPSSCRU3",36,0)
 N BPX,BPRET,BPSTATUS
"RTN","BPSSCRU3",37,0)
 S BPRET="^"
"RTN","BPSSCRU3",38,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU3",39,0)
 S BPSTATUS=$$STATUS^BPSOSRX(+BPX,$P(BPX,U,2))
"RTN","BPSSCRU3",40,0)
 Q $P(BPSTATUS,U,1,3)
"RTN","BPSSCRU3",41,0)
 ;Q $P(BPSTATUS,U,1)_U_$P(BPSTATUS,U,2)_U_$P(BPSTATUS,U,3)
"RTN","BPSSCRU3",42,0)
 ;/**
"RTN","BPSSCRU3",43,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",44,0)
 ;returns the string with none, one or more tha one of the following:
"RTN","BPSSCRU3",45,0)
 ; PB - payable
"RTN","BPSSCRU3",46,0)
 ; RJ - rejected
"RTN","BPSSCRU3",47,0)
 ; RV - reversal
"RTN","BPSSCRU3",48,0)
 ; AR - autoreversal
"RTN","BPSSCRU3",49,0)
 ; SR - stranded
"RTN","BPSSCRU3",50,0)
 ; example: "^RV^AR"
"RTN","BPSSCRU3",51,0)
CLAIMST2(BP59) ;*/
"RTN","BPSSCRU3",52,0)
 N BPX,BPRET,BPSTATUS
"RTN","BPSSCRU3",53,0)
 S BPRET="^"
"RTN","BPSSCRU3",54,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU3",55,0)
 S BPSTATUS=$$STATUS^BPSOSRX(+BPX,$P(BPX,U,2))
"RTN","BPSSCRU3",56,0)
 I BPSTATUS["E REVERSAL" S BPRET=BPRET_"RV^"
"RTN","BPSSCRU3",57,0)
 I BPSTATUS["E PAYABLE" S BPRET=BPRET_"PB^"
"RTN","BPSSCRU3",58,0)
 I BPSTATUS["E REJECTED" S BPRET=BPRET_"RJ^"
"RTN","BPSSCRU3",59,0)
 I BPSTATUS["E STRANDED" S BPRET=BPRET_"SR^"
"RTN","BPSSCRU3",60,0)
 I BPSTATUS["E REVERSAL STRANDED" S BPRET=BPRET_"SR^"
"RTN","BPSSCRU3",61,0)
 Q BPRET
"RTN","BPSSCRU3",62,0)
 ;/**
"RTN","BPSSCRU3",63,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",64,0)
 ;B59 - ptr to #9002313.59
"RTN","BPSSCRU3",65,0)
 ;BPRESP - ptr to #9002313.03
"RTN","BPSSCRU3",66,0)
 ;BPPOS - position inside #9002313.03 (i.e. the number 
"RTN","BPSSCRU3",67,0)
 ;of the claim in the transmission - currently we always have only 1
"RTN","BPSSCRU3",68,0)
GRESPPOS(BP59,BPRESP,BPPOS) ;*/
"RTN","BPSSCRU3",69,0)
 I $G(^BPST(BP59,4)) D  ; reversal kind of message
"RTN","BPSSCRU3",70,0)
 . S BPRESP=+$P(^BPST(BP59,4),U,2)
"RTN","BPSSCRU3",71,0)
 . S BPPOS=1
"RTN","BPSSCRU3",72,0)
 E  D
"RTN","BPSSCRU3",73,0)
 . S BPRESP=+$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSSCRU3",74,0)
 . S BPPOS=+$P($G(^BPST(BP59,0)),U,9)
"RTN","BPSSCRU3",75,0)
 Q:+BPRESP=0 0
"RTN","BPSSCRU3",76,0)
 Q:+BPPOS=0 0
"RTN","BPSSCRU3",77,0)
 Q 1
"RTN","BPSSCRU3",78,0)
 ;
"RTN","BPSSCRU3",79,0)
 ;/**
"RTN","BPSSCRU3",80,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",81,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",82,0)
 ;BPTOP - top level index (for exmpl "504" for ^BPSR(D0,504)= (#504) Message [1F]
"RTN","BPSSCRU3",83,0)
 ;BPDEEP - lower level (for exmpl BPTOP=1000 and BPDEEP=525 for  
"RTN","BPSSCRU3",84,0)
 ;  ^BPSR(D0,1000,D1,525)= (#525) DUR Response Data [1F]
"RTN","BPSSCRU3",85,0)
 ;
"RTN","BPSSCRU3",86,0)
GETMESS(BPTOP,BPDEEP,BP59) ;
"RTN","BPSSCRU3",87,0)
 N BP59DAT,BPRESP,BPPOS
"RTN","BPSSCRU3",88,0)
 N BP1
"RTN","BPSSCRU3",89,0)
 ;S (BPRESP,BPPOS)=0
"RTN","BPSSCRU3",90,0)
 ;get response and position in the BPS RESPONSE file
"RTN","BPSSCRU3",91,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q ""
"RTN","BPSSCRU3",92,0)
 ; -------- transmission specific message ----------
"RTN","BPSSCRU3",93,0)
 I BPTOP=504 Q $P($G(^BPSR(BPRESP,504)),U)
"RTN","BPSSCRU3",94,0)
 ;
"RTN","BPSSCRU3",95,0)
 ; -------claim specific message-----------
"RTN","BPSSCRU3",96,0)
 ;assuming there is only one claim/response per transmission
"RTN","BPSSCRU3",97,0)
 S BP1=$O(^BPSR(BPRESP,BPTOP,0))
"RTN","BPSSCRU3",98,0)
 I BP1=0 Q ""
"RTN","BPSSCRU3",99,0)
 ;---525: DUR
"RTN","BPSSCRU3",100,0)
 ;---526: Additional Message Information
"RTN","BPSSCRU3",101,0)
 ;---504: Message for the claim
"RTN","BPSSCRU3",102,0)
 I (BPDEEP=525)!(BPDEEP=526)!(BPDEEP=504) Q $P($G(^BPSR(BPRESP,1000,BPPOS,BPDEEP)),U)
"RTN","BPSSCRU3",103,0)
 Q ""
"RTN","BPSSCRU3",104,0)
 ;
"RTN","BPSSCRU3",105,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",106,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",107,0)
 ;BPARR1 - array to return messages (by ref)
"RTN","BPSSCRU3",108,0)
 ;BPN1 - index for the array (by ref - will 
"RTN","BPSSCRU3",109,0)
 ;  be incremented if more than one node added)
"RTN","BPSSCRU3",110,0)
 ;BPMLEN - max length for each string
"RTN","BPSSCRU3",111,0)
 ;PBPREF - for prefix string
"RTN","BPSSCRU3",112,0)
 ;. D GETMESS^BPSSCRU3(1000,504,BP59,.BPARR,.BPN,50)
"RTN","BPSSCRU3",113,0)
 ;compare GETRJCOD from BPSSCRu2
"RTN","BPSSCRU3",114,0)
GETRJCOD(BP59,BPARR1,BPN1,BPMLEN,PBPREF) ;
"RTN","BPSSCRU3",115,0)
 N BP59DAT S BP59DAT=$G(^BPST(BP59,0))
"RTN","BPSSCRU3",116,0)
 N BPRESP,BPPOS
"RTN","BPSSCRU3",117,0)
 N BPRJCOD
"RTN","BPSSCRU3",118,0)
 N BPRJTXT
"RTN","BPSSCRU3",119,0)
 N BPSTR
"RTN","BPSSCRU3",120,0)
 N BPRJ
"RTN","BPSSCRU3",121,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",122,0)
 ;get response and position 
"RTN","BPSSCRU3",123,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",124,0)
 S BPRJ=0
"RTN","BPSSCRU3",125,0)
 S BPSTR=""
"RTN","BPSSCRU3",126,0)
 F  S BPRJ=$O(^BPSR(BPRESP,1000,BPPOS,511,BPRJ)) Q:+BPRJ=0  D
"RTN","BPSSCRU3",127,0)
 . S BPRJCOD=$P($G(^BPSR(BPRESP,1000,BPPOS,511,BPRJ,0)),U)
"RTN","BPSSCRU3",128,0)
 . Q:$L(BPRJCOD)=0
"RTN","BPSSCRU3",129,0)
 . S BPRJTXT=$$GETRJNAM(BPRJCOD)
"RTN","BPSSCRU3",130,0)
 . S BPN1=BPN1+1,BPARR1(BPN1)=PBPREF_BPRJTXT
"RTN","BPSSCRU3",131,0)
 Q BPN1
"RTN","BPSSCRU3",132,0)
 ;/**
"RTN","BPSSCRU3",133,0)
 ;Input:
"RTN","BPSSCRU3",134,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU3",135,0)
 ;Output:
"RTN","BPSSCRU3",136,0)
 ; BPRCODES - array for reject codes by reference
"RTN","BPSSCRU3",137,0)
REJCODES(BP59,BPRCODES) ;get reject codes
"RTN","BPSSCRU3",138,0)
 N BPRESP,BPPOS,BPA,BPR
"RTN","BPSSCRU3",139,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",140,0)
 ;get response and position
"RTN","BPSSCRU3",141,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",142,0)
 ;
"RTN","BPSSCRU3",143,0)
 S BPA=0
"RTN","BPSSCRU3",144,0)
 F  S BPA=$O(^BPSR(BPRESP,1000,BPPOS,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU3",145,0)
 . S BPR=$P(^BPSR(BPRESP,1000,BPPOS,511,BPA,0),U)
"RTN","BPSSCRU3",146,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU3",147,0)
 Q
"RTN","BPSSCRU3",148,0)
 ;/**
"RTN","BPSSCRU3",149,0)
 ;BPRJCODE - code
"RTN","BPSSCRU3",150,0)
GETRJNAM(BPRJCODE) ;*/
"RTN","BPSSCRU3",151,0)
 N BPRJIEN
"RTN","BPSSCRU3",152,0)
 S BPRJIEN=$O(^BPSF(9002313.93,"B",BPRJCODE,0))
"RTN","BPSSCRU3",153,0)
 Q:+BPRJIEN=0 ""
"RTN","BPSSCRU3",154,0)
 Q BPRJCODE_":"_$P($G(^BPSF(9002313.93,BPRJIEN,0)),U,2)
"RTN","BPSSCRU3",155,0)
 ;/**
"RTN","BPSSCRU3",156,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",157,0)
 ;was the claim ever autoreversed ?
"RTN","BPSSCRU3",158,0)
AUTOREV(BP59) ;*/
"RTN","BPSSCRU3",159,0)
 N BP02
"RTN","BPSSCRU3",160,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSSCRU3",161,0)
 Q +$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSSCRU3",162,0)
 ;
"RTN","BPSSCRU3",163,0)
 ;/**
"RTN","BPSSCRU3",164,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",165,0)
 ;returns :
"RTN","BPSSCRU3",166,0)
 ;0 Waiting to start
"RTN","BPSSCRU3",167,0)
 ;10 Gathering claim info
"RTN","BPSSCRU3",168,0)
 ;19 Special Grouping
"RTN","BPSSCRU3",169,0)
 ;30 Waiting for packet build
"RTN","BPSSCRU3",170,0)
 ;31 Wait for retry (insurer asleep)
"RTN","BPSSCRU3",171,0)
 ;40 Packet being built
"RTN","BPSSCRU3",172,0)
 ;50 Waiting for transmit
"RTN","BPSSCRU3",173,0)
 ;51 Wait for retry (comms error)
"RTN","BPSSCRU3",174,0)
 ;60 Transmitting
"RTN","BPSSCRU3",175,0)
 ;70 Receiving Response
"RTN","BPSSCRU3",176,0)
 ;80 Waiting to process response
"RTN","BPSSCRU3",177,0)
 ;90 Processing response
"RTN","BPSSCRU3",178,0)
 ;99 Done
"RTN","BPSSCRU3",179,0)
 ;
"RTN","BPSSCRU3",180,0)
PRCNTG(BP59) ;*/
"RTN","BPSSCRU3",181,0)
 Q +$P($G(^BPST(BP59,0)),U,2)
"RTN","BPSSCRU3",182,0)
 ;
"RTN","BPSSCRU3",183,0)
 ;
"RTN","BPSSCRU3",184,0)
LINE(BPN,BPCH) ;
"RTN","BPSSCRU3",185,0)
 N BP1
"RTN","BPSSCRU3",186,0)
 S $P(BP1,BPCH,BPN+1)=""
"RTN","BPSSCRU3",187,0)
 Q BP1
"RTN","BPSSCRU3",188,0)
 ;
"RTN","BPSSCRU3",189,0)
DTTIME(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",190,0)
 I +X=0 W ""
"RTN","BPSSCRU3",191,0)
 N DATE,YR,BPT,BPM,BPH,BPAP,BPS
"RTN","BPSSCRU3",192,0)
 I $G(X) S YR=$E(X,1,3)+1700
"RTN","BPSSCRU3",193,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",194,0)
 S BPT=$P(X,".",2)
"RTN","BPSSCRU3",195,0)
 I BPT S:$L(BPT)<6 BPT=BPT_$E("000000",1,6-$L(BPT))
"RTN","BPSSCRU3",196,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4),BPS=$E(BPT,5,6)
"RTN","BPSSCRU3",197,0)
 I BPT S DATE=DATE_"@"_BPH_":"_BPM_":"_BPS
"RTN","BPSSCRU3",198,0)
 Q $G(DATE)
"RTN","BPSSCRU3",199,0)
 ;
"RTN","BPSSCRU3",200,0)
 ;call IB API to get insurance data, then select proper insurance by its name
"RTN","BPSSCRU3",201,0)
 ;get its phone number
"RTN","BPSSCRU3",202,0)
 ;input: 
"RTN","BPSSCRU3",203,0)
 ; DFN - patient IEN in #2
"RTN","BPSSCRU3",204,0)
 ; BPDOS - date of service
"RTN","BPSSCRU3",205,0)
 ; BPINSNM - insurance name
"RTN","BPSSCRU3",206,0)
 ;output: insurance ien^insurance name^phone
"RTN","BPSSCRU3",207,0)
GETPHONE(BPDFN,BPDOS,BPINSNM) ;
"RTN","BPSSCRU3",208,0)
 N BPX,BPZZ,BP1,BPPHONE
"RTN","BPSSCRU3",209,0)
 S BPPHONE=""
"RTN","BPSSCRU3",210,0)
 I $$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,6")'=1 Q ""
"RTN","BPSSCRU3",211,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRU3",212,0)
 . I BPINSNM=$P($G(BPZZ("IBBAPI","INSUR",BP1,1)),U,2) S BPPHONE=$G(BPZZ("IBBAPI","INSUR",BP1,6)) Q
"RTN","BPSSCRU3",213,0)
 Q BPPHONE
"RTN","BPSSCRU3",214,0)
 ;
"RTN","BPSSCRU3",215,0)
 ;try to get insurance name and phone from #9002313.59, #9002313.57 and from INSUR^IBBAPI 
"RTN","BPSSCRU3",216,0)
 ;input: BP59 - ien in #9002313.59
"RTN","BPSSCRU3",217,0)
 ;return insurance_name^phone#
"RTN","BPSSCRU3",218,0)
NAMEPHON(BP59) ;
"RTN","BPSSCRU3",219,0)
 N BPHONE,BPINSNM,BPINSID,BP57,BPINSN
"RTN","BPSSCRU3",220,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRU3",221,0)
 S BPINSNM=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),0)),U,7)
"RTN","BPSSCRU3",222,0)
 S BP57=0
"RTN","BPSSCRU3",223,0)
 F  Q:(BPHONE'="")&(BPINSNM'="")  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU3",224,0)
 . S BPINSN=+$G(^BPSTL(BP57,9))
"RTN","BPSSCRU3",225,0)
 . S:BPHONE="" BPHONE=$P($G(^BPSTL(BP57,10,BPINSN,3)),U,2)
"RTN","BPSSCRU3",226,0)
 . S:BPINSNM="" BPINSNM=$P($G(^BPSTL(BP57,10,BPINSN,0)),U,7)
"RTN","BPSSCRU3",227,0)
 ;
"RTN","BPSSCRU3",228,0)
 I (BPINSNM'="")&(BPHONE="") D
"RTN","BPSSCRU3",229,0)
 . S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRU3",230,0)
 . I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRU3",231,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRU3",232,0)
 . S BPHONE=$$GETPHONE(BPDFN,BPDOS,BPINSNM)
"RTN","BPSSCRU3",233,0)
 Q BPINSNM_U_BPHONE
"RTN","BPSSCRU3",234,0)
 ;
"RTN","BPSSCRU5")
0^12^B59880838
"RTN","BPSSCRU5",1,0)
BPSSCRU5 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSSCRU5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRU5",4,0)
 ;USER SCREEN
"RTN","BPSSCRU5",5,0)
 Q
"RTN","BPSSCRU5",6,0)
 ;
"RTN","BPSSCRU5",7,0)
DATETIME(Y) ;EP - convert fileman date.time to printable
"RTN","BPSSCRU5",8,0)
 X ^DD("DD")
"RTN","BPSSCRU5",9,0)
 Q Y
"RTN","BPSSCRU5",10,0)
 ;
"RTN","BPSSCRU5",11,0)
 ;create a history of claims and responses in #9002313.57 file 
"RTN","BPSSCRU5",12,0)
 ;record for the specified transaction in #9002313.59 file
"RTN","BPSSCRU5",13,0)
 ;input:
"RTN","BPSSCRU5",14,0)
 ; BP59 - ptr to #9002313.59
"RTN","BPSSCRU5",15,0)
 ; BPHIST - array to return results
"RTN","BPSSCRU5",16,0)
 ;output:
"RTN","BPSSCRU5",17,0)
 ; Array in BPHIST with the format:
"RTN","BPSSCRU5",18,0)
 ;  BPHIST(type,timedate,PointerToResponseClaimFile)=PointerTo#9002313.57
"RTN","BPSSCRU5",19,0)
 ;  where:
"RTN","BPSSCRU5",20,0)
 ;  type "C" - BPS CLAIM file, "R" - BPS RESPONSE file
"RTN","BPSSCRU5",21,0)
 ;  PointerToResponseClaimFile - pointer to 9002313.03 or 9002313.02
"RTN","BPSSCRU5",22,0)
MKHIST(BP59,BPHIST) ;
"RTN","BPSSCRU5",23,0)
 N BP57,BPLSTCLM,BPLSTRSP,BPDAT57,BP1,BPSSTDT
"RTN","BPSSCRU5",24,0)
 S BP57=0
"RTN","BPSSCRU5",25,0)
 N BPSARR02
"RTN","BPSSCRU5",26,0)
 N BPSARR03
"RTN","BPSSCRU5",27,0)
 ; -- process BPS LOG OF TRANSACTIONS file
"RTN","BPSSCRU5",28,0)
 F  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU5",29,0)
 . ;claim transmissions
"RTN","BPSSCRU5",30,0)
 . S BPDAT57(0)=$G(^BPSTL(BP57,0))
"RTN","BPSSCRU5",31,0)
 . S BPSSTDT=+$P(BPDAT57(0),U,11) ;start time
"RTN","BPSSCRU5",32,0)
 . S BPLSTCLM=+$P(BPDAT57(0),U,4) ;claim
"RTN","BPSSCRU5",33,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",34,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",35,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",36,0)
 . . ;old BPS CLAIMS recs don't have dates, so use START TIME from .57 file but 
"RTN","BPSSCRU5",37,0)
 . . ;only at the very first time (using $D for this)
"RTN","BPSSCRU5",38,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",39,0)
 . . I BP1 S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"C"
"RTN","BPSSCRU5",40,0)
 . S BPLSTRSP=+$P(BPDAT57(0),U,5) ;response
"RTN","BPSSCRU5",41,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",42,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",43,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",44,0)
 . . I BP1 S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"C"
"RTN","BPSSCRU5",45,0)
 . ;reversal transmissions
"RTN","BPSSCRU5",46,0)
 . S BPDAT57(4)=$G(^BPSTL(BP57,4))
"RTN","BPSSCRU5",47,0)
 . S BPLSTCLM=+$P(BPDAT57(4),U,1) ;reversal
"RTN","BPSSCRU5",48,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",49,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",50,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",51,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",52,0)
 . . I BP1 S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"R"
"RTN","BPSSCRU5",53,0)
 . S BPLSTRSP=+$P(BPDAT57(4),U,2) ;reversal response
"RTN","BPSSCRU5",54,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",55,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",56,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",57,0)
 . . I BP1 S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"R"
"RTN","BPSSCRU5",58,0)
 ;--------
"RTN","BPSSCRU5",59,0)
 ;sorting: pairs (send/respond) in reversed chronological order
"RTN","BPSSCRU5",60,0)
 N BPCLDT1,BPCLIEN,BPRSDT1,BPRSIEN,BPCLDT2
"RTN","BPSSCRU5",61,0)
 S BPCLDT1=0
"RTN","BPSSCRU5",62,0)
 F  S BPCLDT1=$O(BPHIST("C",BPCLDT1)) Q:BPCLDT1=""  D
"RTN","BPSSCRU5",63,0)
 . S BPCLIEN=$O(BPHIST("C",BPCLDT1,0)) Q:BPCLIEN=""  D
"RTN","BPSSCRU5",64,0)
 . . S BPCLDT2=+$O(BPHIST("C",BPCLDT1))
"RTN","BPSSCRU5",65,0)
 . . I BPCLDT2=0 S BPCLDT2=9999999
"RTN","BPSSCRU5",66,0)
 . . S BPRSDT1=BPCLDT1
"RTN","BPSSCRU5",67,0)
 . . F  S BPRSDT1=$O(BPHIST("R",BPRSDT1)) Q:BPRSDT1=""!(BPRSDT1>BPCLDT2)  D
"RTN","BPSSCRU5",68,0)
 . . . S BPRSIEN=$O(BPHIST("R",BPRSDT1,0)) Q:BPRSIEN=""  D
"RTN","BPSSCRU5",69,0)
 . . . . S BPHIST("C",BPCLDT1,BPCLIEN,"R",BPRSIEN)=BPHIST("R",BPRSDT1,BPRSIEN)
"RTN","BPSSCRU5",70,0)
 ;
"RTN","BPSSCRU5",71,0)
 Q
"RTN","BPSSCRU5",72,0)
 ;returns text for the transaction code in file #9002313.02 -- BPS CLAIMS FILE
"RTN","BPSSCRU5",73,0)
TRTYPE(BPTRCD) ;
"RTN","BPSSCRU5",74,0)
 I BPTRCD="E1" Q "Eligibility Verification"
"RTN","BPSSCRU5",75,0)
 I BPTRCD="B1" Q "REQUEST"  ;"Billing"
"RTN","BPSSCRU5",76,0)
 I BPTRCD="B2" Q "REVERSAL"  ; "Reversal"
"RTN","BPSSCRU5",77,0)
 I BPTRCD="B3" Q "Rebill"
"RTN","BPSSCRU5",78,0)
 I BPTRCD="P1" Q "P.A. Request & Billing"
"RTN","BPSSCRU5",79,0)
 I BPTRCD="P2" Q "P.A. Reversal"
"RTN","BPSSCRU5",80,0)
 I BPTRCD="P3" Q "P.A. Inquiry"
"RTN","BPSSCRU5",81,0)
 I BPTRCD="P4" Q "P.A. Request Only"
"RTN","BPSSCRU5",82,0)
 I BPTRCD="N1" Q "Information Reporting"
"RTN","BPSSCRU5",83,0)
 I BPTRCD="N2" Q "Information Reporting Reversal"
"RTN","BPSSCRU5",84,0)
 I BPTRCD="N3" Q "Information Reporting Rebill"
"RTN","BPSSCRU5",85,0)
 I BPTRCD="C1" Q "Controlled Substance Reporting"
"RTN","BPSSCRU5",86,0)
 I BPTRCD="C2" Q "Controlled Substance Reporting Reversal"
"RTN","BPSSCRU5",87,0)
 I BPTRCD="C3" Q "Controlled Substance Reporting Rebill"
"RTN","BPSSCRU5",88,0)
 Q ""
"RTN","BPSSCRU5",89,0)
 ;
"RTN","BPSSCRU5",90,0)
 ;get NDC for LOG
"RTN","BPSSCRU5",91,0)
 ;BPIEN02 - IEN in #9002313.02 file
"RTN","BPSSCRU5",92,0)
LNDC(BPIEN02) ;
"RTN","BPSSCRU5",93,0)
 N BPDAT02,BPNDC
"RTN","BPSSCRU5",94,0)
 S BPDAT02(400)=$G(^BPSC(BPIEN02,400,1,400))
"RTN","BPSSCRU5",95,0)
 S BPNDC=$E($P(BPDAT02(400),U,7),3,99)
"RTN","BPSSCRU5",96,0)
 S BPNDC=$E(BPNDC,1,5)_"-"_$E(BPNDC,6,9)_"-"_$E(BPNDC,10,11)
"RTN","BPSSCRU5",97,0)
 Q BPNDC
"RTN","BPSSCRU5",98,0)
 ;prepares array of reject codes
"RTN","BPSSCRU5",99,0)
 ; BPIEN03 - IEN in #9002313.03 file
"RTN","BPSSCRU5",100,0)
 ; BPRCODES - array to return results
"RTN","BPSSCRU5",101,0)
REJCODES(BPIEN03,BPRCODES) ;
"RTN","BPSSCRU5",102,0)
 N BPA,BPR
"RTN","BPSSCRU5",103,0)
 S BPA=0
"RTN","BPSSCRU5",104,0)
 F  S BPA=$O(^BPSR(BPIEN03,1000,1,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU5",105,0)
 . S BPR=$P(^BPSR(BPIEN03,1000,1,511,BPA,0),U)
"RTN","BPSSCRU5",106,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU5",107,0)
 Q
"RTN","BPSSCRU5",108,0)
 ;status of the response
"RTN","BPSSCRU5",109,0)
RESPSTAT(BPIEN03) ;
"RTN","BPSSCRU5",110,0)
 N BP1
"RTN","BPSSCRU5",111,0)
 S BP1=$P($G(^BPSR(BPIEN03,1000,1,110)),U,2)
"RTN","BPSSCRU5",112,0)
 Q:BP1="A" "Approved"
"RTN","BPSSCRU5",113,0)
 Q:BP1="C" "Captured"
"RTN","BPSSCRU5",114,0)
 Q:BP1="D" "Duplicate of Paid"
"RTN","BPSSCRU5",115,0)
 Q:BP1="F" "PA Deferred"
"RTN","BPSSCRU5",116,0)
 Q:BP1="P" "Paid"
"RTN","BPSSCRU5",117,0)
 Q:BP1="Q" "Duplicate of Capture"
"RTN","BPSSCRU5",118,0)
 Q:BP1="R" "Rejected"
"RTN","BPSSCRU5",119,0)
 Q:BP1="S" "Duplicate of Approved"
"RTN","BPSSCRU5",120,0)
 Q ""
"RTN","BPSSCRU5",121,0)
 ;
"RTN","BPSSCRU5",122,0)
 ;Electronic payer - ptr to #9002313.92 
"RTN","BPSSCRU5",123,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",124,0)
PYRIEN(BPIEN02) ;
"RTN","BPSSCRU5",125,0)
 Q $P($G(^BPSF(9002313.92,+$P($G(^BPSC(BPIEN02,0)),U,2),0)),U)
"RTN","BPSSCRU5",126,0)
 ;
"RTN","BPSSCRU5",127,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",128,0)
B2PYRIEN(BPIEN02,BP57) ;
"RTN","BPSSCRU5",129,0)
 N BPX,BPX2
"RTN","BPSSCRU5",130,0)
 S BPX=$G(^BPSF(9002313.92,+$$PYRIEN(BPIEN02),"REVERSAL"))
"RTN","BPSSCRU5",131,0)
 I $L(BPX)=0 D
"RTN","BPSSCRU5",132,0)
 . S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,3)
"RTN","BPSSCRU5",133,0)
 . S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",134,0)
 Q BPX
"RTN","BPSSCRU5",135,0)
 ;
"RTN","BPSSCRU5",136,0)
 ;B3 payer sheet 
"RTN","BPSSCRU5",137,0)
B3PYRIEN(BPIEN02,BP59,BP57) ;
"RTN","BPSSCRU5",138,0)
 N BPX,BPX2
"RTN","BPSSCRU5",139,0)
 S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,4)
"RTN","BPSSCRU5",140,0)
 S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",141,0)
 Q BPX
"RTN","BPSSCRU5",142,0)
 ;
"RTN","BPSSCRU5",143,0)
 ;
"RTN","BPSSCRU5",144,0)
 ;BPLN= line to use in SETLINE
"RTN","BPSSCRU5",145,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",146,0)
 ;BPMLEN - max length
"RTN","BPSSCRU5",147,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",148,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",149,0)
WRAPLN(BPLN,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",150,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",151,0)
 S BPQ=0
"RTN","BPSSCRU5",152,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",153,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",154,0)
 D SETLINE^BPSSCRLG(.BPLN,BPPREFX_BPXX)
"RTN","BPSSCRU5",155,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",156,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",157,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",158,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",159,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",160,0)
 . D SETLINE^BPSSCRLG(.BPLN,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",161,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",162,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",163,0)
 Q
"RTN","BPSSCRU5",164,0)
 ;
"RTN","BPSSCRU5",165,0)
 ;to prepare spaces
"RTN","BPSSCRU5",166,0)
SPACES(BPN) ;
"RTN","BPSSCRU5",167,0)
 N BPX
"RTN","BPSSCRU5",168,0)
 S $P(BPX," ",BPN+1)=""
"RTN","BPSSCRU5",169,0)
 Q BPX
"RTN","BPSSCRU5",170,0)
 ;
"RTN","BPSSCRU5",171,0)
 ;BPN= line counter (index) 
"RTN","BPSSCRU5",172,0)
 ;BPARR - array for lines
"RTN","BPSSCRU5",173,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",174,0)
 ;BPMLEN - mas length
"RTN","BPSSCRU5",175,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",176,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",177,0)
WRAPLN2(BPN,BPARR,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",178,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",179,0)
 S BPQ=0
"RTN","BPSSCRU5",180,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",181,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",182,0)
 D SETLN(.BPN,.BPARR,BPPREFX_BPXX)
"RTN","BPSSCRU5",183,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",184,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",185,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",186,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",187,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",188,0)
 . D SETLN(.BPN,.BPARR,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",189,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",190,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",191,0)
 Q
"RTN","BPSSCRU5",192,0)
 ;
"RTN","BPSSCRU5",193,0)
 ;
"RTN","BPSSCRU5",194,0)
SETLN(BPN,BPARR,BPTXT) ;
"RTN","BPSSCRU5",195,0)
 S BPN=BPN+1,BPARR(BPN)=BPTXT
"RTN","BPSSCRU5",196,0)
 Q
"RTN","BPSSCRU5",197,0)
 ;---
"RTN","BPSSCRU5",198,0)
 ;check 2nd insurance
"RTN","BPSSCRU5",199,0)
 ;if there then ask user and print message
"RTN","BPSSCRU5",200,0)
CH2NDINS(BP59,BPPATNAM,BPINSNAM,BPRXINFO) ;
"RTN","BPSSCRU5",201,0)
 N BPRETV
"RTN","BPSSCRU5",202,0)
 S BPRETV=$$NEXTINS^BPSSCRCL(BP59,BPINSNAM)
"RTN","BPSSCRU5",203,0)
 Q:+BPRETV=0
"RTN","BPSSCRU5",204,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"S")
"RTN","BPSSCRU5",205,0)
 W !!
"RTN","BPSSCRU5",206,0)
 I $$YESNO^BPSSCRRS("Do you want to print the information (above) concerning additional insurance?   (Y/N)")'=1 Q
"RTN","BPSSCRU5",207,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"P")
"RTN","BPSSCRU5",208,0)
 Q
"RTN","BPSSCRU5",209,0)
 ;
"RTN","BPSSCRU5",210,0)
 ;BPPRNFL
"RTN","BPSSCRU5",211,0)
 ; S- print to screen
"RTN","BPSSCRU5",212,0)
PRN(BPPATNAM,BPRETV,BPRXINFO,BPPRNFL) ;
"RTN","BPSSCRU5",213,0)
 I BPPRNFL="S" W @IOF D MS2NDINS Q
"RTN","BPSSCRU5",214,0)
 D PRINT("MS2NDINS^BPSSCRU5","BPS 2ND INSURANCE INFO","BP*")
"RTN","BPSSCRU5",215,0)
 W !!
"RTN","BPSSCRU5",216,0)
 Q
"RTN","BPSSCRU5",217,0)
 ;
"RTN","BPSSCRU5",218,0)
MS2NDINS ;
"RTN","BPSSCRU5",219,0)
 N Y,Z
"RTN","BPSSCRU5",220,0)
 W !,"This patient HAS additional insurance with Rx Coverage that may be"
"RTN","BPSSCRU5",221,0)
 W !,"used to bill this claim.  The system WILL change the CT entry to a"
"RTN","BPSSCRU5",222,0)
 W !,"NON-BILLABLE Episode. If appropriate, please go to Claims Tracking"
"RTN","BPSSCRU5",223,0)
 W !,"to manually create a bill to the additional payer listed below."
"RTN","BPSSCRU5",224,0)
 W !!,"Patient: ",?18,BPPATNAM
"RTN","BPSSCRU5",225,0)
 S Y=$P(BPRETV,U,4)\1 D DD^%DT
"RTN","BPSSCRU5",226,0)
 W !,"Date of service: ",?18,Y
"RTN","BPSSCRU5",227,0)
 W !,"Insurance: ",?18,$P(BPRETV,U,2)
"RTN","BPSSCRU5",228,0)
 W !,"Group number: ",?18,$P(BPRETV,U,3)
"RTN","BPSSCRU5",229,0)
 S Z=0 F  S Z=$O(BPRXINFO(Z)) Q:+Z=0  W !,BPRXINFO(Z)
"RTN","BPSSCRU5",230,0)
 Q
"RTN","BPSSCRU5",231,0)
 ;
"RTN","BPSSCRU5",232,0)
 ;Prints report
"RTN","BPSSCRU5",233,0)
 ;propmpts user to choose device (including queuing)
"RTN","BPSSCRU5",234,0)
 ;TXTSRC - name of the report's entry point
"RTN","BPSSCRU5",235,0)
 ;DESCR - description for the Task Manager
"RTN","BPSSCRU5",236,0)
 ;SAVEVARS - mask for vars that need to be available in the report
"RTN","BPSSCRU5",237,0)
 ;  (exmpl: "BP*")
"RTN","BPSSCRU5",238,0)
PRINT(TXTSRC,DESCR,SAVEVARS) ;
"RTN","BPSSCRU5",239,0)
 N Y,QUITVAR,SCRFLAG
"RTN","BPSSCRU5",240,0)
 S (QUITVAR,SCRFLAG)=0
"RTN","BPSSCRU5",241,0)
 D DEVICE Q:QUITVAR
"RTN","BPSSCRU5",242,0)
 D @TXTSRC
"RTN","BPSSCRU5",243,0)
 D ^%ZISC
"RTN","BPSSCRU5",244,0)
 I QUITVAR W !,"Cancelled"
"RTN","BPSSCRU5",245,0)
 Q
"RTN","BPSSCRU5",246,0)
 ;
"RTN","BPSSCRU5",247,0)
DEVICE ;
"RTN","BPSSCRU5",248,0)
 N DIR,DIRUT,POP
"RTN","BPSSCRU5",249,0)
 N ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS
"RTN","BPSSCRU5",250,0)
 K IO("Q") S %ZIS="QM"
"RTN","BPSSCRU5",251,0)
 W ! D ^%ZIS
"RTN","BPSSCRU5",252,0)
 I POP S QUITVAR=1 Q
"RTN","BPSSCRU5",253,0)
 S SCRFLAG=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSSCRU5",254,0)
 I $D(IO("Q")) D  S QUITVAR=1
"RTN","BPSSCRU5",255,0)
 . S ZTRTN=TXTSRC
"RTN","BPSSCRU5",256,0)
 . S ZTIO=ION
"RTN","BPSSCRU5",257,0)
 . S ZTSAVE(SAVEVARS)=""
"RTN","BPSSCRU5",258,0)
 . S ZTDESC=DESCR
"RTN","BPSSCRU5",259,0)
 . D ^%ZTLOAD
"RTN","BPSSCRU5",260,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSSCRU5",261,0)
 . D HOME^%ZIS
"RTN","BPSSCRU5",262,0)
 U IO
"RTN","BPSSCRU5",263,0)
 Q
"RTN","BPSSCRU5",264,0)
 ;
"RTN","BPSUSCR1")
0^182^B20439548
"RTN","BPSUSCR1",1,0)
BPSUSCR1 ;BHAM ISC/FLS - STRANDED CLAIMS SCREEN ;10-MAR-2005
"RTN","BPSUSCR1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5**;JUN 2004;Build 45
"RTN","BPSUSCR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUSCR1",4,0)
 Q
"RTN","BPSUSCR1",5,0)
 ;
"RTN","BPSUSCR1",6,0)
INIT ; -- init variables and list array
"RTN","BPSUSCR1",7,0)
 N BPLN,BPLM,BP59,BPSORT,BPDUZ7,BPRET,CONT
"RTN","BPSUSCR1",8,0)
 ;get date/time range
"RTN","BPSUSCR1",9,0)
 K ^TMP($J),^TMP("BPSUSCR",$J)
"RTN","BPSUSCR1",10,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",11,0)
 S CONT=1,VALMCNT=0
"RTN","BPSUSCR1",12,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",13,0)
 Q
"RTN","BPSUSCR1",14,0)
 ;
"RTN","BPSUSCR1",15,0)
HELP ; -- help code
"RTN","BPSUSCR1",16,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSUSCR1",17,0)
 K X
"RTN","BPSUSCR1",18,0)
 Q
"RTN","BPSUSCR1",19,0)
 ;
"RTN","BPSUSCR1",20,0)
EXIT ; -- exit code
"RTN","BPSUSCR1",21,0)
 Q
"RTN","BPSUSCR1",22,0)
 ;
"RTN","BPSUSCR1",23,0)
 ; Warning message for 'Transmitting' claims
"RTN","BPSUSCR1",24,0)
MESSAGE() ;
"RTN","BPSUSCR1",25,0)
 W !!!,"Please be aware that if there are claims appearing on the ECME User Screen"
"RTN","BPSUSCR1",26,0)
 W !,"with a status of 'In progress - Transmitting', then there may be a problem"
"RTN","BPSUSCR1",27,0)
 W !,"with HL7 or with system connectivity with the Austin Automation Center (AAC)."
"RTN","BPSUSCR1",28,0)
 W !,"Please contact your IRM to verify that connectivity to the AAC is working"
"RTN","BPSUSCR1",29,0)
 W !,"and the HL7 link BPS NCPDP is processing messages before using this option"
"RTN","BPSUSCR1",30,0)
 W !,"to unstrand claims with a status of 'In progress - Transmitting'.",!
"RTN","BPSUSCR1",31,0)
 N DIR,X,Y,BPQ
"RTN","BPSUSCR1",32,0)
 S BPQ=0
"RTN","BPSUSCR1",33,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue? "
"RTN","BPSUSCR1",34,0)
 S DIR("B")="NO"
"RTN","BPSUSCR1",35,0)
 D ^DIR
"RTN","BPSUSCR1",36,0)
 I Y'=1 S BPQ=1
"RTN","BPSUSCR1",37,0)
 W !!
"RTN","BPSUSCR1",38,0)
 Q BPQ
"RTN","BPSUSCR1",39,0)
 ;
"RTN","BPSUSCR1",40,0)
GETDTS(BPARR) ; Transaction dates to view.
"RTN","BPSUSCR1",41,0)
 N DIR
"RTN","BPSUSCR1",42,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",43,0)
 S DIR(0)="DA^:DT:EX",DIR("A")="FIRST TRANSACTION DATE: "
"RTN","BPSUSCR1",44,0)
 S DIR("B")="T-1"
"RTN","BPSUSCR1",45,0)
 D ^DIR
"RTN","BPSUSCR1",46,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",47,0)
 S BPARR("BDT")=Y_".000001"
"RTN","BPSUSCR1",48,0)
ENDDT ;
"RTN","BPSUSCR1",49,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",50,0)
 S DIR(0)="DA^"_$P(BPARR("BDT"),".",1)_":DT:EX",DIR("A")="LAST TRANSACTION DATE: "
"RTN","BPSUSCR1",51,0)
 S DIR("B")="T"
"RTN","BPSUSCR1",52,0)
 D ^DIR
"RTN","BPSUSCR1",53,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",54,0)
 S BPARR("EDT")=$$EDATE(Y)
"RTN","BPSUSCR1",55,0)
 Q
"RTN","BPSUSCR1",56,0)
 ;
"RTN","BPSUSCR1",57,0)
EDATE(DATE) ;
"RTN","BPSUSCR1",58,0)
 N RTN,%,%H
"RTN","BPSUSCR1",59,0)
 S RTN=DATE_".235959"
"RTN","BPSUSCR1",60,0)
 D NOW^%DTC
"RTN","BPSUSCR1",61,0)
 I $P(%,".")=DATE S $P(%H,",",2)=$P(%H,",",2)-1800 D YX^%DTC S RTN=DATE_%
"RTN","BPSUSCR1",62,0)
 Q RTN
"RTN","BPSUSCR1",63,0)
ALL ; Unstrand all claims currently selected.
"RTN","BPSUSCR1",64,0)
 D FULL^VALM1
"RTN","BPSUSCR1",65,0)
 N D0,DIR,SEQ,LAST
"RTN","BPSUSCR1",66,0)
 S LAST=+$O(^TMP($J,2,""),-1)
"RTN","BPSUSCR1",67,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",68,0)
 . W !,"There are no stranded claims in this date range to unstrand"
"RTN","BPSUSCR1",69,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",70,0)
 S DIR(0)="Y",DIR("A")="ARE YOU SURE? (YES/NO) ",DIR("B")="YES" D ^DIR Q:'Y
"RTN","BPSUSCR1",71,0)
 W !,"PLEASE WAIT"
"RTN","BPSUSCR1",72,0)
 S SEQ=0
"RTN","BPSUSCR1",73,0)
 F  S SEQ=$O(^TMP($J,2,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",74,0)
 .  S D0=""
"RTN","BPSUSCR1",75,0)
 .  F  S D0=$O(^TMP($J,2,SEQ,D0)) Q:'D0  D
"RTN","BPSUSCR1",76,0)
 .  .  D UNSTRAND(D0)
"RTN","BPSUSCR1",77,0)
 .  .  Q
"RTN","BPSUSCR1",78,0)
 .  Q
"RTN","BPSUSCR1",79,0)
 W !,"Done"
"RTN","BPSUSCR1",80,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",81,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",82,0)
 Q
"RTN","BPSUSCR1",83,0)
SELECT ; Select entries from the list and run each through the unstrand function
"RTN","BPSUSCR1",84,0)
 N D0,DIR,I,J,VAR,BPTMPGL,PT,POP,LAST
"RTN","BPSUSCR1",85,0)
 S LAST=+$O(^TMP($J,2,""),-1)
"RTN","BPSUSCR1",86,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",87,0)
 . W !,"There are no stranded claims to select"
"RTN","BPSUSCR1",88,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",89,0)
 K DTOUT,DUOUT
"RTN","BPSUSCR1",90,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",91,0)
 S VAR=""
"RTN","BPSUSCR1",92,0)
 S DIR(0)="LO^1:"_LAST
"RTN","BPSUSCR1",93,0)
 S DIR("A")="Enter a Selection of Stranded Claims",DIR("B")=""
"RTN","BPSUSCR1",94,0)
 D ^DIR
"RTN","BPSUSCR1",95,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","BPSUSCR1",96,0)
 S VAR=Y
"RTN","BPSUSCR1",97,0)
 F I=1:1:$L(VAR,",") S PT=$P(VAR,",",I) D
"RTN","BPSUSCR1",98,0)
 .  Q:PT=""
"RTN","BPSUSCR1",99,0)
 .  I PT'["-" S D0=$O(^TMP($J,2,PT,"")) D UNSTRAND(D0) Q
"RTN","BPSUSCR1",100,0)
 .  F J=$P(PT,"-"):1:$P(PT,"-",2) S D0=$O(^TMP($J,2,J,"")) D UNSTRAND(D0)
"RTN","BPSUSCR1",101,0)
 .  Q
"RTN","BPSUSCR1",102,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",103,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",104,0)
 Q
"RTN","BPSUSCR1",105,0)
PRINT ;
"RTN","BPSUSCR1",106,0)
 N %ZIS
"RTN","BPSUSCR1",107,0)
 S %ZIS="M"
"RTN","BPSUSCR1",108,0)
 S %ZIS("A")="Select Printer: ",%ZIS("B")="" D ^%ZIS
"RTN","BPSUSCR1",109,0)
 Q:IOPAR=""
"RTN","BPSUSCR1",110,0)
 D PHDR
"RTN","BPSUSCR1",111,0)
 D PLINE
"RTN","BPSUSCR1",112,0)
 D ^%ZISC
"RTN","BPSUSCR1",113,0)
 Q
"RTN","BPSUSCR1",114,0)
PHDR ;
"RTN","BPSUSCR1",115,0)
 U IO
"RTN","BPSUSCR1",116,0)
 W !,"Claims Stranded from ",BPBDT," through ",BPEDT
"RTN","BPSUSCR1",117,0)
 ;
"RTN","BPSUSCR1",118,0)
 W !!,?4,"TRANS DT",?15,"PATIENT NAME",?36,"ID",?41,"EXTERN RX#",?54,"RF",?57,"FILL DT",?68,"INS CO"
"RTN","BPSUSCR1",119,0)
 W !,?4,"--------",?15,"------------",?36,"--",?41,"----------",?54,"--",?57,"-------",?68,"------"
"RTN","BPSUSCR1",120,0)
 Q
"RTN","BPSUSCR1",121,0)
PLINE ;
"RTN","BPSUSCR1",122,0)
 N SEQ,LINE
"RTN","BPSUSCR1",123,0)
 S SEQ=0
"RTN","BPSUSCR1",124,0)
 F  S SEQ=$O(^TMP("BPSUSCR",$J,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",125,0)
 .  S LINE=$G(^TMP("BPSUSCR",$J,SEQ,0))
"RTN","BPSUSCR1",126,0)
 .  U IO
"RTN","BPSUSCR1",127,0)
 .  W !,$E(LINE,1,79)
"RTN","BPSUSCR1",128,0)
 .  Q
"RTN","BPSUSCR1",129,0)
 Q
"RTN","BPSUSCR1",130,0)
 ;
"RTN","BPSUSCR1",131,0)
 ; Unstrand the claim
"RTN","BPSUSCR1",132,0)
 ; Fileman read of New Person file (VA(200)) is covered by IA# 10600
"RTN","BPSUSCR1",133,0)
UNSTRAND(IEN59) ;
"RTN","BPSUSCR1",134,0)
 N MES
"RTN","BPSUSCR1",135,0)
 S MES="E STRANDED"
"RTN","BPSUSCR1",136,0)
 I $P($G(^BPST(IEN59,4)),"^",1)!($P($G(^BPST(IEN59,4)),"^",4)]"") S MES="E REVERSAL STRANDED"
"RTN","BPSUSCR1",137,0)
 D SETRESU^BPSOSU(IEN59,99,MES)
"RTN","BPSUSCR1",138,0)
 D SETSTAT^BPSOSU(IEN59,99)
"RTN","BPSUSCR1",139,0)
 S MES=$T(+0)_"-Unstranded"
"RTN","BPSUSCR1",140,0)
 I $G(DUZ) S MES=MES_" by "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","BPSUSCR1",141,0)
 D LOG^BPSOSL(IEN59,MES)
"RTN","BPSUSCR1",142,0)
 Q
"RTN","BPSUTIL")
0^13^B11392543
"RTN","BPSUTIL",1,0)
BPSUTIL ;BHAM ISC/FLS/SS - General Utility functions ;06/01/2004
"RTN","BPSUTIL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5**;JUN 2004;Build 45
"RTN","BPSUTIL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUTIL",4,0)
 ;
"RTN","BPSUTIL",5,0)
 Q
"RTN","BPSUTIL",6,0)
 ;
"RTN","BPSUTIL",7,0)
 ; ECMEON
"RTN","BPSUTIL",8,0)
 ;   Input:
"RTN","BPSUTIL",9,0)
 ;      SITE - Pointer to Outpatient Site file (#59)
"RTN","BPSUTIL",10,0)
 ;   Output
"RTN","BPSUTIL",11,0)
 ;      1 - ECME is turned ON for the Outpatient Site
"RTN","BPSUTIL",12,0)
 ;      0 - ECME is not turned ON for the Outpatient Site.
"RTN","BPSUTIL",13,0)
 ;   Note that ON means that the Outpatient site is linked to an active
"RTN","BPSUTIL",14,0)
 ;     BPS Pharmacy that has a Pharmacy ID.
"RTN","BPSUTIL",15,0)
ECMEON(SITE) ;
"RTN","BPSUTIL",16,0)
 I '$G(SITE) Q 0
"RTN","BPSUTIL",17,0)
 N BPSPHARM,FACID
"RTN","BPSUTIL",18,0)
 S FACID=0
"RTN","BPSUTIL",19,0)
 S BPSPHARM=$$GETPHARM(SITE)
"RTN","BPSUTIL",20,0)
 I BPSPHARM="" Q 0
"RTN","BPSUTIL",21,0)
 S FACID=$$GET1^DIQ(9002313.56,BPSPHARM_",",41.01)
"RTN","BPSUTIL",22,0)
 I FACID="",'$$NPIREQ^BPSNPI(DT) S FACID=$$GET1^DIQ(9002313.56,BPSPHARM_",",.02)
"RTN","BPSUTIL",23,0)
 Q $S(FACID:1,1:0)
"RTN","BPSUTIL",24,0)
 ;
"RTN","BPSUTIL",25,0)
CMOPON(SITE) ; - Returns 1 if CMOP is turned ON for ECME or 0 if not
"RTN","BPSUTIL",26,0)
 ; SITE - Pointer to #59 (OUTPATIENT SITE)
"RTN","BPSUTIL",27,0)
 Q:'$G(SITE) 0
"RTN","BPSUTIL",28,0)
 N PHRM S PHRM=$O(^BPS(9002313.56,"C",SITE,0)) I 'PHRM Q 0
"RTN","BPSUTIL",29,0)
 Q $$GET1^DIQ(9002313.56,PHRM,1,"I")
"RTN","BPSUTIL",30,0)
 ;
"RTN","BPSUTIL",31,0)
 ;Function returns STATUS flag from BPS PHARMACIES (file #56)
"RTN","BPSUTIL",32,0)
 ; Returns '1' for active or '0' for inactive BPS Pharmacy
"RTN","BPSUTIL",33,0)
BPSACTV(BPSPHARM) ; 
"RTN","BPSUTIL",34,0)
 Q:'$G(BPSPHARM) 0
"RTN","BPSUTIL",35,0)
 Q +$P($G(^BPS(9002313.56,BPSPHARM,0)),U,10)
"RTN","BPSUTIL",36,0)
 ;
"RTN","BPSUTIL",37,0)
BPSPLN(RXI,RXR) ; - Returns the insurance PLAN NAME (902.24) field from BPS TRANSACTION
"RTN","BPSUTIL",38,0)
 ;
"RTN","BPSUTIL",39,0)
 ; Input variables -> RXI - Internal Prescription File IEN
"RTN","BPSUTIL",40,0)
 ;                    RXR - Refill Number
"RTN","BPSUTIL",41,0)
 ;                    
"RTN","BPSUTIL",42,0)
 I '$G(RXI) Q ""
"RTN","BPSUTIL",43,0)
 I '$G(RXR) S RXR=0
"RTN","BPSUTIL",44,0)
 N IEN59 S IEN59=$$IEN59^BPSOSRX(RXI,RXR) Q:IEN59="" ""
"RTN","BPSUTIL",45,0)
 N CINS S CINS=$$GET1^DIQ(9002313.59,IEN59,901) Q:'CINS ""
"RTN","BPSUTIL",46,0)
 Q $$GET1^DIQ(9002313.59902,CINS_","_IEN59,902.24)
"RTN","BPSUTIL",47,0)
 ;
"RTN","BPSUTIL",48,0)
 ;API for IB (IA #4146) to select BPS PHARMACY
"RTN","BPSUTIL",49,0)
 ;returns results as a local array BPPHARM
"RTN","BPSUTIL",50,0)
 ; Select the ECME Pharmacy or Pharmacies
"RTN","BPSUTIL",51,0)
 ; 
"RTN","BPSUTIL",52,0)
 ; Input Variable -> BPSPHAR is passed by reference to get the result of user's selection
"RTN","BPSUTIL",53,0)
 ; BPPHARM = 1 One or More Pharmacies Selected
"RTN","BPSUTIL",54,0)
 ;    = 0 User Entered 'ALL'
"RTN","BPSUTIL",55,0)
 ; If BPSPHAR = 1 then the BPSPHAR array will be defined where:
"RTN","BPSUTIL",56,0)
 ;    BPSPHAR(ptr) = ptr ^ BPS PHARMACY NAME and
"RTN","BPSUTIL",57,0)
 ;    ptr = Internal Pointer to BPS PHARMACIES file (#9002313.56)
"RTN","BPSUTIL",58,0)
 ;    
"RTN","BPSUTIL",59,0)
 ; Return Value ->   "" = Valid Entry or Entries Selected
"RTN","BPSUTIL",60,0)
 ;                                        ^ = Exit
"RTN","BPSUTIL",61,0)
SELPHARM(BPSPHAR) ;
"RTN","BPSUTIL",62,0)
 N BPRET,BPPHARM
"RTN","BPSUTIL",63,0)
 S BPRET=$$SELPHARM^BPSRPT3()
"RTN","BPSUTIL",64,0)
 M BPSPHAR=BPPHARM
"RTN","BPSUTIL",65,0)
 Q BPRET
"RTN","BPSUTIL",66,0)
 ;
"RTN","BPSUTIL",67,0)
 ;
"RTN","BPSUTIL",68,0)
 ;API for IB (IA #4146) to determine whether is one or more BPS PHARMACIES in the system
"RTN","BPSUTIL",69,0)
 ;Function returns 
"RTN","BPSUTIL",70,0)
 ;1 - if the site has more than one record in the file #9002313.56
"RTN","BPSUTIL",71,0)
 ;0 - if there are no any divisions
"RTN","BPSUTIL",72,0)
 ;0^NAME OF THE EPHARM - if only one division return 0 and its name 
"RTN","BPSUTIL",73,0)
 ;  to use in the header of the report
"RTN","BPSUTIL",74,0)
MULTPHRM() ;
"RTN","BPSUTIL",75,0)
 N IBX
"RTN","BPSUTIL",76,0)
 S IBX=+$O(^BPS(9002313.56,0))
"RTN","BPSUTIL",77,0)
 I IBX=0 Q 0
"RTN","BPSUTIL",78,0)
 I $O(^BPS(9002313.56,IBX))>0 Q 1
"RTN","BPSUTIL",79,0)
 Q "0^"_$$GET1^DIQ(9002313.56,IBX,.01,"E")
"RTN","BPSUTIL",80,0)
 ;
"RTN","BPSUTIL",81,0)
 ; Function for IB (IA #4146) to return site linked to pharmacy
"RTN","BPSUTIL",82,0)
 ; Input
"RTN","BPSUTIL",83,0)
 ;   BPSDIV - Outpatient Site
"RTN","BPSUTIL",84,0)
 ; Returns
"RTN","BPSUTIL",85,0)
 ;   BPSPHARM - BPS Pharmacy IEN
"RTN","BPSUTIL",86,0)
GETPHARM(BPSDIV) ;
"RTN","BPSUTIL",87,0)
 N BPSPHARM
"RTN","BPSUTIL",88,0)
 I $G(BPSDIV)="" Q ""
"RTN","BPSUTIL",89,0)
 S BPSPHARM=$O(^BPS(9002313.56,"C",BPSDIV,0)) I 'BPSPHARM Q ""
"RTN","BPSUTIL",90,0)
 Q:'$$BPSACTV^BPSUTIL(BPSPHARM) ""
"RTN","BPSUTIL",91,0)
 Q BPSPHARM
"RTN","BPSUTIL",92,0)
 ;
"RTN","BPSUTIL",93,0)
 ;API  for the IB package (IA#4146)
"RTN","BPSUTIL",94,0)
 ;Input parameters:
"RTN","BPSUTIL",95,0)
 ; BPSRX  - Rx ien (file #52)
"RTN","BPSUTIL",96,0)
 ; BPSREFNO - refill number
"RTN","BPSUTIL",97,0)
 ;Returned value:
"RTN","BPSUTIL",98,0)
 ; 1st piece:
"RTN","BPSUTIL",99,0)
 ;  0 - status "non-payable" OR there is no response from the payer for whatever reason OR wasn't submitted OR invalid parameters
"RTN","BPSUTIL",100,0)
 ;  1- status "payable"
"RTN","BPSUTIL",101,0)
 ; 2nd piece:
"RTN","BPSUTIL",102,0)
 ;  amount the payer agreed to pay
"RTN","BPSUTIL",103,0)
 ; 3rd piece:
"RTN","BPSUTIL",104,0)
 ;  Date of Service
"RTN","BPSUTIL",105,0)
 ; 
"RTN","BPSUTIL",106,0)
PAIDAMNT(BPSRX,BPSREFNO) ;
"RTN","BPSUTIL",107,0)
 I ($G(BPSRX)="")!($G(BPSREFNO)="") Q "0^"
"RTN","BPSUTIL",108,0)
 N BPSTAT,BPSRET,IEN59,BPSRESP,BPDOS
"RTN","BPSUTIL",109,0)
 S BPSTAT=$$STATUS^BPSOSRX(BPSRX,BPSREFNO)
"RTN","BPSUTIL",110,0)
 ;The status of the claim should be "payable" in order to get amount of the 3rd party payment
"RTN","BPSUTIL",111,0)
 ;If it was an attempt to reverse the payable claim AND reversal was rejected 
"RTN","BPSUTIL",112,0)
 ;then the claim still is considered as "payable" and we still can get the amount paid by the 3rd party.
"RTN","BPSUTIL",113,0)
 ;In this case we return 1 (payable) in first piece and the amount paid in the 2nd piece of the returned value.
"RTN","BPSUTIL",114,0)
 ;All other statuses mean that we cannot get amount paid so we return 0 = "non payable"
"RTN","BPSUTIL",115,0)
 I $P(BPSTAT,U)'="E PAYABLE",$P(BPSTAT,U)'="E REVERSAL REJECTED",$P(BPSTAT,U)'="E DUPLICATE" Q "0^"
"RTN","BPSUTIL",116,0)
 ;get ien for BPS TRANSACTION file
"RTN","BPSUTIL",117,0)
 S IEN59=+$$IEN59^BPSOSRX(BPSRX,BPSREFNO)
"RTN","BPSUTIL",118,0)
 I IEN59="" Q "0^"  ;BPS Transaction IEN could not be calculated
"RTN","BPSUTIL",119,0)
 S BPSRESP=+$P($G(^BPST(IEN59,0)),U,5)
"RTN","BPSUTIL",120,0)
 ;response from the payer was not found  - either claim was never submitted OR there 
"RTN","BPSUTIL",121,0)
 ;is no response for some reason - either way - we cannot provide the amount paid, so return "0"
"RTN","BPSUTIL",122,0)
 I BPSRESP=0 Q "0^"
"RTN","BPSUTIL",123,0)
 S BPDOS=+$P($G(^BPST(IEN59,12)),U,2)
"RTN","BPSUTIL",124,0)
 S BPSRET=+$$INSPAID^BPSOS03(BPSRESP)
"RTN","BPSUTIL",125,0)
 Q "1^"_BPSRET_U_BPDOS
"RTN","BPSUTIL",126,0)
 ;
"RTN","BPSUTIL",127,0)
 ; NPIEXTR
"RTN","BPSUTIL",128,0)
 ;   This API was written for the NPI extract (XUSNPIX2) and returns
"RTN","BPSUTIL",129,0)
 ;    the NCPDP and STATUS of the associated BPS Pharmacy
"RTN","BPSUTIL",130,0)
 ;   Input:
"RTN","BPSUTIL",131,0)
 ;      SITE - Pointer to Outpatient Site file (#59)
"RTN","BPSUTIL",132,0)
 ;   Output
"RTN","BPSUTIL",133,0)
 ;      NCPDP^STATUS (0 - inactive, 1 - active)
"RTN","BPSUTIL",134,0)
 ;      "" if no SITE passed in or no linkage
"RTN","BPSUTIL",135,0)
NPIEXTR(SITE) ;
"RTN","BPSUTIL",136,0)
 I '$G(SITE) Q ""
"RTN","BPSUTIL",137,0)
 N BPSPHARM,NCPDP,STATUS
"RTN","BPSUTIL",138,0)
 S BPSPHARM=$O(^BPS(9002313.56,"C",SITE,0))
"RTN","BPSUTIL",139,0)
 I 'BPSPHARM Q ""
"RTN","BPSUTIL",140,0)
 S STATUS=$$BPSACTV^BPSUTIL(BPSPHARM)
"RTN","BPSUTIL",141,0)
 S NCPDP=$$GET1^DIQ(9002313.56,BPSPHARM_",",.02)
"RTN","BPSUTIL",142,0)
 Q NCPDP_"^"_STATUS
"RTN","BPSUTIL1")
0^14^B29877020
"RTN","BPSUTIL1",1,0)
BPSUTIL1 ;BHAM ISC/SS - General Utility functions ;08/01/2006
"RTN","BPSUTIL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**5**;JUN 2004;Build 45
"RTN","BPSUTIL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUTIL1",4,0)
 ;
"RTN","BPSUTIL1",5,0)
 Q
"RTN","BPSUTIL1",6,0)
 ;Function to return field data from DRUG file (#50)
"RTN","BPSUTIL1",7,0)
 ; Parameters
"RTN","BPSUTIL1",8,0)
 ;  BPSIEN50 - IEN of DRUG FILE #50
"RTN","BPSUTIL1",9,0)
 ;  BPSFLDN - Field Number(s) (like .01)
"RTN","BPSUTIL1",10,0)
 ;  BPSEXIN - Specifies internal or external value of returned field
"RTN","BPSUTIL1",11,0)
 ;         - optional, defaults to "I"
"RTN","BPSUTIL1",12,0)
 ;  BPSARR50 - Array to return value(s).  Optional.  Pass by reference.
"RTN","BPSUTIL1",13,0)
 ;           See EN^DIQ documentation for variable DIQ
"RTN","BPSUTIL1",14,0)
 ;
"RTN","BPSUTIL1",15,0)
 ; Function returns field data if one field is specified.  If
"RTN","BPSUTIL1",16,0)
 ;   multiple fields, the function will return "" and the field
"RTN","BPSUTIL1",17,0)
 ;   values are returned in BPSARR50
"RTN","BPSUTIL1",18,0)
 ; Example: W $$DRUGDIE^BPSUTIL1(134,25,"E",.ARR)
"RTN","BPSUTIL1",19,0)
DRUGDIE(BPSIEN50,BPSFLDN,BPSEXIN,BPSARR50) ; Return field values for Drug file 
"RTN","BPSUTIL1",20,0)
 I $G(BPSIEN50)=""!($G(BPSFLDN)="") Q ""
"RTN","BPSUTIL1",21,0)
 N DIQ,PSSDIY
"RTN","BPSUTIL1",22,0)
 N BPSDIQ
"RTN","BPSUTIL1",23,0)
 I $G(BPSEXIN)'="E" S BPSEXIN="I"
"RTN","BPSUTIL1",24,0)
 S BPSDIQ="BPSARR50",BPSDIQ(0)=BPSEXIN
"RTN","BPSUTIL1",25,0)
 D EN^PSSDI(50,"BPS",50,.BPSFLDN,.BPSIEN50,.BPSDIQ)
"RTN","BPSUTIL1",26,0)
 Q $G(BPSARR50(50,BPSIEN50,BPSFLDN,BPSEXIN))
"RTN","BPSUTIL1",27,0)
 ;
"RTN","BPSUTIL1",28,0)
 ;Function to do lookup on DRUG file (#50)
"RTN","BPSUTIL1",29,0)
 ; Paramters
"RTN","BPSUTIL1",30,0)
 ;   BPSDIC - Setup per fileman documentation for call to ^DIC
"RTN","BPSUTIL1",31,0)
 ;
"RTN","BPSUTIL1",32,0)
 ; Returns variables as documented for call to ^DIC except X
"RTN","BPSUTIL1",33,0)
 ;   will not be returned.
"RTN","BPSUTIL1",34,0)
DRUGDIC(BPSDIC) ; Look up on DRUG FILE (#50)
"RTN","BPSUTIL1",35,0)
 I '$G(BPSDIC) Q
"RTN","BPSUTIL1",36,0)
 N PSSDIY
"RTN","BPSUTIL1",37,0)
 D DIC^PSSDI(50,"BPS",.BPSDIC)
"RTN","BPSUTIL1",38,0)
 Q
"RTN","BPSUTIL1",39,0)
 ;/*
"RTN","BPSUTIL1",40,0)
 ;Subroutine to return values from MULTIPLE fields of file #52
"RTN","BPSUTIL1",41,0)
 ;DBIA 4858
"RTN","BPSUTIL1",42,0)
 ;input:
"RTN","BPSUTIL1",43,0)
 ; IEN - ien of file #52
"RTN","BPSUTIL1",44,0)
 ; BPSFLDN - one or more fields, for example ".01;2;5"
"RTN","BPSUTIL1",45,0)
 ; BPSRET - contains a name for a local array to return results,
"RTN","BPSUTIL1",46,0)
 ; Note: the name of the array should't be "BPSRET" otherwise it will 
"RTN","BPSUTIL1",47,0)
 ;   be "newed" since the parameter has the same name
"RTN","BPSUTIL1",48,0)
 ; BPFORMAT - 
"RTN","BPSUTIL1",49,0)
 ;  "E" for external format
"RTN","BPSUTIL1",50,0)
 ;  "I" - internal 
"RTN","BPSUTIL1",51,0)
 ;  "N" - do not return nulls
"RTN","BPSUTIL1",52,0)
 ;  default is "E"
"RTN","BPSUTIL1",53,0)
 ;output:
"RTN","BPSUTIL1",54,0)
 ; result will be put into array with the name specified by BPSRET
"RTN","BPSUTIL1",55,0)
 ; examples:
"RTN","BPSUTIL1",56,0)
 ;D RXAPI^BPSUTIL1(504733,".01;1;6","ARR","IE")
"RTN","BPSUTIL1",57,0)
 ;ZW ARR  
"RTN","BPSUTIL1",58,0)
 ;ARR(52,504733,.01,"E")=100004099
"RTN","BPSUTIL1",59,0)
 ;ARR(52,504733,.01,"I")=100004099
"RTN","BPSUTIL1",60,0)
 ;ARR(52,504733,1,"E")="JUL 21, 2006"
"RTN","BPSUTIL1",61,0)
 ;ARR(52,504733,1,"I")=3060721
"RTN","BPSUTIL1",62,0)
 ;ARR(52,504733,6,"E")="ALBUMIN 25% 50ML"
"RTN","BPSUTIL1",63,0)
 ;ARR(52,504733,6,"I")=134
"RTN","BPSUTIL1",64,0)
RXAPI(BPSIEN52,BPSFLDN,BPSRET,BPFORMAT) ;*/
"RTN","BPSUTIL1",65,0)
 I ($G(BPSIEN52)="")!($G(BPSFLDN)="")!($G(BPSRET)="") Q
"RTN","BPSUTIL1",66,0)
 N DIQ,DIC,X,Y,D0,PSODIY
"RTN","BPSUTIL1",67,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","BPSUTIL1",68,0)
 N BPSDIQ
"RTN","BPSUTIL1",69,0)
 S BPSDIQ=$NA(@BPSRET)
"RTN","BPSUTIL1",70,0)
 S BPSDIQ(0)=$S($G(BPFORMAT)="":"E",1:BPFORMAT)
"RTN","BPSUTIL1",71,0)
 D DIQ^PSODI(52,52,.BPSFLDN,.BPSIEN52,.BPSDIQ) ;DBIA 4858
"RTN","BPSUTIL1",72,0)
 Q 
"RTN","BPSUTIL1",73,0)
 ;
"RTN","BPSUTIL1",74,0)
 ;/*
"RTN","BPSUTIL1",75,0)
 ;Function to return a value for a SINGLE field of file #52
"RTN","BPSUTIL1",76,0)
 ;DBIA 4858
"RTN","BPSUTIL1",77,0)
 ;input:
"RTN","BPSUTIL1",78,0)
 ; BPSIEN52 - ien of file #52
"RTN","BPSUTIL1",79,0)
 ; BPSFLDN - one single field, for example ".01"
"RTN","BPSUTIL1",80,0)
 ; BPFORMAT - optional parameter, 
"RTN","BPSUTIL1",81,0)
 ;  "E" for external format
"RTN","BPSUTIL1",82,0)
 ;  "I" - internal 
"RTN","BPSUTIL1",83,0)
 ;  "N" - do not return nulls
"RTN","BPSUTIL1",84,0)
 ;  default is "E"
"RTN","BPSUTIL1",85,0)
 ;output:
"RTN","BPSUTIL1",86,0)
 ; returns a field value or null (empty string) 
"RTN","BPSUTIL1",87,0)
 ; examples:
"RTN","BPSUTIL1",88,0)
 ;W $$RXAPI1^BPSUTIL1(504733,6,"E")
"RTN","BPSUTIL1",89,0)
 ;ALBUMIN 25% 50ML
"RTN","BPSUTIL1",90,0)
 ;W $$RXAPI1^BPSUTIL1(504733,6,"I")
"RTN","BPSUTIL1",91,0)
 ;134
"RTN","BPSUTIL1",92,0)
RXAPI1(BPSIEN52,BPSFLDN,BPFORMAT) ;*/
"RTN","BPSUTIL1",93,0)
 I ($G(BPSIEN52)="")!($G(BPSFLDN)="") Q ""
"RTN","BPSUTIL1",94,0)
 N DIQ,DIC,BPSARR,X,Y,D0,PSODIY
"RTN","BPSUTIL1",95,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","BPSUTIL1",96,0)
 N BPSDIQ
"RTN","BPSUTIL1",97,0)
 S BPSDIQ="BPSARR"
"RTN","BPSUTIL1",98,0)
 S BPSDIQ(0)=$S($G(BPFORMAT)="":"E",1:BPFORMAT)
"RTN","BPSUTIL1",99,0)
 D DIQ^PSODI(52,52,.BPSFLDN,.BPSIEN52,.BPSDIQ) ;DBIA 4858
"RTN","BPSUTIL1",100,0)
 Q $S(BPSDIQ(0)="N":$G(BPSARR(52,BPSIEN52,BPSFLDN)),1:$G(BPSARR(52,BPSIEN52,BPSFLDN,BPSDIQ(0))))
"RTN","BPSUTIL1",101,0)
 ;
"RTN","BPSUTIL1",102,0)
 ;/*
"RTN","BPSUTIL1",103,0)
 ;Subroutine to return values from MULTIPLE fields of a subfile of the file #52
"RTN","BPSUTIL1",104,0)
 ;DBIA 4858
"RTN","BPSUTIL1",105,0)
 ;input:
"RTN","BPSUTIL1",106,0)
 ; BPSIEN52 - ien of file #52
"RTN","BPSUTIL1",107,0)
 ; BPSFLD52 - field # that relates to this subfile
"RTN","BPSUTIL1",108,0)
 ; BPSUBFNO - subfile number (like 52.052311)
"RTN","BPSUTIL1",109,0)
 ; BPSUBIEN - ien of the subfile record you're interested in
"RTN","BPSUTIL1",110,0)
 ; BPSUBFLD - one or more fields, for example ".01;2;5"
"RTN","BPSUTIL1",111,0)
 ; BPSRET - name for a local array to return results 
"RTN","BPSUTIL1",112,0)
 ; BPFORMAT - optional parameter.
"RTN","BPSUTIL1",113,0)
 ;  "E" for external format
"RTN","BPSUTIL1",114,0)
 ;  "I" - internal 
"RTN","BPSUTIL1",115,0)
 ;  "N" - do not return nulls
"RTN","BPSUTIL1",116,0)
 ;  default is "E"
"RTN","BPSUTIL1",117,0)
 ;output:
"RTN","BPSUTIL1",118,0)
 ; returns results in array BPSRET in the form:
"RTN","BPSUTIL1",119,0)
 ; BPSRET (BPSUBFNO, BPSUBIEN, BPSUBFLD,BPFORMAT)=value
"RTN","BPSUTIL1",120,0)
 ; 
"RTN","BPSUTIL1",121,0)
 ;example for (#52311) ICD DIAGNOSIS subfile
"RTN","BPSUTIL1",122,0)
 ;D RXSUBF^BPSUTIL1(504740,52311,52.052311,1,".01;1;2","ARR","I")
"RTN","BPSUTIL1",123,0)
 ;ZW ARR
"RTN","BPSUTIL1",124,0)
 ;ARR(52.052311,1,.01,"I")=816
"RTN","BPSUTIL1",125,0)
 ;ARR(52.052311,1,1,"I")=1
"RTN","BPSUTIL1",126,0)
 ;ARR(52.052311,1,2,"I")=1
"RTN","BPSUTIL1",127,0)
 ;
"RTN","BPSUTIL1",128,0)
RXSUBF(BPSIEN52,BPSFLD52,BPSUBFNO,BPSUBIEN,BPSUBFLD,BPSRET,BPFORMAT) ;
"RTN","BPSUTIL1",129,0)
 I ($G(BPSIEN52)="")!($G(BPSFLD52)="")!($G(BPSUBFNO)="")!($G(BPSUBIEN)="")!($G(BPSUBFLD)="")!($G(BPSRET)="") Q
"RTN","BPSUTIL1",130,0)
 N DIQ,DIC,DA,DR,X,Y,D0,PSODIY
"RTN","BPSUTIL1",131,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","BPSUTIL1",132,0)
 N BPSDIC,BPSDR,BPSDA,BPSDIQ
"RTN","BPSUTIL1",133,0)
 S BPSDIC=52 ;main file #52
"RTN","BPSUTIL1",134,0)
 S BPSDA=BPSIEN52 ;ien in main file #52
"RTN","BPSUTIL1",135,0)
 S BPSDA(BPSUBFNO)=BPSUBIEN ;ien in subfile
"RTN","BPSUTIL1",136,0)
 S BPSDR=BPSFLD52 ;field# of the subfile in the main file
"RTN","BPSUTIL1",137,0)
 S BPSDR(BPSUBFNO)=BPSUBFLD ;field# in the subfile that we need to get a value for
"RTN","BPSUTIL1",138,0)
 S BPSDIQ=$NA(@BPSRET) ;output array
"RTN","BPSUTIL1",139,0)
 S BPSDIQ(0)=$S($G(BPFORMAT)="":"E",1:BPFORMAT)
"RTN","BPSUTIL1",140,0)
 D DIQ^PSODI(52,.BPSDIC,.BPSDR,.BPSDA,.BPSDIQ) ;DBIA 4858
"RTN","BPSUTIL1",141,0)
 Q
"RTN","BPSUTIL1",142,0)
 ;
"RTN","BPSUTIL1",143,0)
 ;/*
"RTN","BPSUTIL1",144,0)
 ;Function to return a value for a SINGLE field of a subfile of the file #52 
"RTN","BPSUTIL1",145,0)
 ;DBIA 4858
"RTN","BPSUTIL1",146,0)
 ;input:
"RTN","BPSUTIL1",147,0)
 ; BPSIEN52 - ien of file #52
"RTN","BPSUTIL1",148,0)
 ; BPSFLD52 - field # that relates to this subfile
"RTN","BPSUTIL1",149,0)
 ; BPSUBFNO - subfile number (like 52.052311)
"RTN","BPSUTIL1",150,0)
 ; BPSUBIEN - ien of the subfile record you're interested in 
"RTN","BPSUTIL1",151,0)
 ; BPSUBFLD - one single field, for example ".01"
"RTN","BPSUTIL1",152,0)
 ; BPFORMAT - optional parameter,
"RTN","BPSUTIL1",153,0)
 ;  "E" for external format
"RTN","BPSUTIL1",154,0)
 ;  "I" - internal 
"RTN","BPSUTIL1",155,0)
 ;  "N" - do not return nulls
"RTN","BPSUTIL1",156,0)
 ;  default is "E"
"RTN","BPSUTIL1",157,0)
 ;output:
"RTN","BPSUTIL1",158,0)
 ; returns a field value or null (empty string) 
"RTN","BPSUTIL1",159,0)
 ;
"RTN","BPSUTIL1",160,0)
 ;example for (#52311) ICD DIAGNOSIS subfile
"RTN","BPSUTIL1",161,0)
 ;W $$RXSUBF1^BPSUTIL1(504740,52311,52.052311,1,1,"I")  
"RTN","BPSUTIL1",162,0)
 ;1
"RTN","BPSUTIL1",163,0)
 ;W $$RXSUBF1^BPSUTIL1(504740,52311,52.052311,1,.01,"E")
"RTN","BPSUTIL1",164,0)
 ;239.1
"RTN","BPSUTIL1",165,0)
 ;
"RTN","BPSUTIL1",166,0)
RXSUBF1(BPSIEN52,BPSFLD52,BPSUBFNO,BPSUBIEN,BPSUBFLD,BPFORMAT) ;*/
"RTN","BPSUTIL1",167,0)
 I ($G(BPSIEN52)="")!($G(BPSFLD52)="")!($G(BPSUBFNO)="")!($G(BPSUBIEN)="")!($G(BPSUBFLD)="") Q ""
"RTN","BPSUTIL1",168,0)
 N DIQ,DIC,BPSARR,DA,DR,X,Y,D0,PSODIY
"RTN","BPSUTIL1",169,0)
 N I,J,C,DRS,DIL,DI,DIQ1
"RTN","BPSUTIL1",170,0)
 N BPSDIC,BPSDA,BPSDR
"RTN","BPSUTIL1",171,0)
 S BPSDIC=52 ;main file #52
"RTN","BPSUTIL1",172,0)
 S BPSDA=BPSIEN52 ;ien in main file #52
"RTN","BPSUTIL1",173,0)
 S BPSDA(BPSUBFNO)=BPSUBIEN ;ien in subfile
"RTN","BPSUTIL1",174,0)
 S BPSDR=BPSFLD52 ;field# of the subfile in the main file
"RTN","BPSUTIL1",175,0)
 S BPSDR(BPSUBFNO)=BPSUBFLD ;field# in the subfile that we need to get a value for
"RTN","BPSUTIL1",176,0)
 S BPSDIQ="BPSARR" ;output array
"RTN","BPSUTIL1",177,0)
 S BPSDIQ(0)=$S($G(BPFORMAT)="":"E",1:BPFORMAT)
"RTN","BPSUTIL1",178,0)
 D DIQ^PSODI(52,.BPSDIC,.BPSDR,.BPSDA,.BPSDIQ) ;DBIA 4858
"RTN","BPSUTIL1",179,0)
 Q $S(BPSDIQ(0)="N":$G(BPSARR(BPSUBFNO,BPSUBIEN,BPSUBFLD)),1:$G(BPSARR(BPSUBFNO,BPSUBIEN,BPSUBFLD,BPSDIQ(0))))
"RTN","BPSUTIL1",180,0)
 ;
"RTN","BPSUTIL1",181,0)
 ;
"RTN","BPSUTIL1",182,0)
 ;Function to return a value for a single field of subfile #52.1
"RTN","BPSUTIL1",183,0)
 ;DBIA 4858
"RTN","BPSUTIL1",184,0)
 ;input:
"RTN","BPSUTIL1",185,0)
 ; BPSIEN52 - ien of file #52
"RTN","BPSUTIL1",186,0)
 ; REFIEN - refill ien of subfile #52.1
"RTN","BPSUTIL1",187,0)
 ; BPSFLDN - one single field, for example ".01"
"RTN","BPSUTIL1",188,0)
 ; BPFORMAT - (optional)
"RTN","BPSUTIL1",189,0)
 ;  "E" for external format
"RTN","BPSUTIL1",190,0)
 ;  "I" - internal 
"RTN","BPSUTIL1",191,0)
 ;  "N" - do not return nulls
"RTN","BPSUTIL1",192,0)
 ;  default is "E"
"RTN","BPSUTIL1",193,0)
 ;output:
"RTN","BPSUTIL1",194,0)
 ; returns a field value or null (empty string) 
"RTN","BPSUTIL1",195,0)
 ; examples:
"RTN","BPSUTIL1",196,0)
 ;W $$REFAPI1^BPSUTIL1(401777,1,.01,"I")
"RTN","BPSUTIL1",197,0)
 ;3000526
"RTN","BPSUTIL1",198,0)
REFAPI1(BPSIEN52,REFIEN,BPSFLDN,BPFORMAT) ;
"RTN","BPSUTIL1",199,0)
 I ($G(BPSIEN52)="")!($G(REFIEN)="")!($G(BPSFLDN)="") Q ""
"RTN","BPSUTIL1",200,0)
 Q $$RXSUBF1(BPSIEN52,52,52.1,REFIEN,BPSFLDN,$G(BPFORMAT))
"RTN","BPSUTIL1",201,0)
 ;
"RTN","BPSUTIL1",202,0)
 ;
"RTN","BPSUTIL1",203,0)
 ;/**
"RTN","BPSUTIL1",204,0)
 ;DBIA 4858
"RTN","BPSUTIL1",205,0)
 ;prompts for RX selection
"RTN","BPSUTIL1",206,0)
 ;input:
"RTN","BPSUTIL1",207,0)
 ;  BPSPROM - prompt message
"RTN","BPSUTIL1",208,0)
 ;  BPSDFLT - default value for the prompt (optional parameter)
"RTN","BPSUTIL1",209,0)
 ;output: 
"RTN","BPSUTIL1",210,0)
 ;  returns selection (IEN of file #52)
"RTN","BPSUTIL1",211,0)
 ;  OR -1 when timeout and/or uparrow
"RTN","BPSUTIL1",212,0)
 ;  OR -2 when incorrect parameters
"RTN","BPSUTIL1",213,0)
 ;Example:
"RTN","BPSUTIL1",214,0)
 ;W $$PROMPTRX^BPSUTIL1("Select RX:",100003784)
"RTN","BPSUTIL1",215,0)
 ;Select RX:: 100003784// ??
"RTN","BPSUTIL1",216,0)
 ;  Choose from:
"RTN","BPSUTIL1",217,0)
 ;200168        200081A     MYLANTA II LIQUID 5 OZ  
"RTN","BPSUTIL1",218,0)
 ;200291        300110B     IBUPROFEN 600MG
"RTN","BPSUTIL1",219,0)
PROMPTRX(BPSPROM,BPSDFLT) ;*/
"RTN","BPSUTIL1",220,0)
 N Y,X,DUOUT,DTOUT,DIROUT,DIC,PSODIY,DILN,I
"RTN","BPSUTIL1",221,0)
 N BPSDIC
"RTN","BPSUTIL1",222,0)
 S BPSDIC=52,X=""
"RTN","BPSUTIL1",223,0)
 S BPSDIC(0)="AEMNQ"
"RTN","BPSUTIL1",224,0)
 S:$L($G(BPSDFLT))>0 BPSDIC("B")=BPSDFLT
"RTN","BPSUTIL1",225,0)
 S:$G(BPSPROM)]"" BPSDIC("A")=BPSPROM_": "
"RTN","BPSUTIL1",226,0)
 D DIC^PSODI(52,.BPSDIC,X) ;DBIA 4858
"RTN","BPSUTIL1",227,0)
 I (Y=-1)!$D(DUOUT)!$D(DTOUT) Q -1
"RTN","BPSUTIL1",228,0)
 Q $P(Y,U)
"RTN","BPSUTIL1",229,0)
 ;
"SEC","^DIC",9002313.02,9002313.02,0,"AUDIT")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DD")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DEL")
@
"SEC","^DIC",9002313.02,9002313.02,0,"LAYGO")
@
"SEC","^DIC",9002313.02,9002313.02,0,"RD")
Pp
"SEC","^DIC",9002313.02,9002313.02,0,"WR")
@
"SEC","^DIC",9002313.12,9002313.12,0,"AUDIT")
@
"SEC","^DIC",9002313.12,9002313.12,0,"DD")
@
"SEC","^DIC",9002313.12,9002313.12,0,"DEL")
@
"SEC","^DIC",9002313.12,9002313.12,0,"LAYGO")
@
"SEC","^DIC",9002313.12,9002313.12,0,"RD")
Pp
"SEC","^DIC",9002313.12,9002313.12,0,"WR")
@
"SEC","^DIC",9002313.31,9002313.31,0,"AUDIT")
@
"SEC","^DIC",9002313.31,9002313.31,0,"DD")
@
"SEC","^DIC",9002313.31,9002313.31,0,"DEL")
@
"SEC","^DIC",9002313.31,9002313.31,0,"LAYGO")
@
"SEC","^DIC",9002313.31,9002313.31,0,"RD")
Pp
"SEC","^DIC",9002313.31,9002313.31,0,"WR")
@
"SEC","^DIC",9002313.56,9002313.56,0,"AUDIT")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DD")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DEL")
@
"SEC","^DIC",9002313.56,9002313.56,0,"LAYGO")
@
"SEC","^DIC",9002313.56,9002313.56,0,"RD")
Pp
"SEC","^DIC",9002313.56,9002313.56,0,"WR")
@
"SEC","^DIC",9002313.57,9002313.57,0,"AUDIT")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DD")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DEL")
@
"SEC","^DIC",9002313.57,9002313.57,0,"LAYGO")
@
"SEC","^DIC",9002313.57,9002313.57,0,"RD")
Pp
"SEC","^DIC",9002313.57,9002313.57,0,"WR")
@
"SEC","^DIC",9002313.58,9002313.58,0,"AUDIT")
@
"SEC","^DIC",9002313.58,9002313.58,0,"DD")
@
"SEC","^DIC",9002313.58,9002313.58,0,"DEL")
@
"SEC","^DIC",9002313.58,9002313.58,0,"LAYGO")
@
"SEC","^DIC",9002313.58,9002313.58,0,"RD")
Pp
"SEC","^DIC",9002313.58,9002313.58,0,"WR")
@
"SEC","^DIC",9002313.59,9002313.59,0,"AUDIT")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DD")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DEL")
@
"SEC","^DIC",9002313.59,9002313.59,0,"LAYGO")
@
"SEC","^DIC",9002313.59,9002313.59,0,"RD")
Pp
"SEC","^DIC",9002313.59,9002313.59,0,"WR")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"AUDIT")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"DD")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"DEL")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"LAYGO")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"RD")
Pp
"SEC","^DIC",9002313.8242,9002313.8242,0,"WR")
@
"SEC","^DIC",9002313.82461,9002313.82461,0,"AUDIT")
@
"SEC","^DIC",9002313.82461,9002313.82461,0,"DD")
@
"SEC","^DIC",9002313.82461,9002313.82461,0,"DEL")
@
"SEC","^DIC",9002313.82461,9002313.82461,0,"LAYGO")
@
"SEC","^DIC",9002313.82461,9002313.82461,0,"RD")
Pp
"SEC","^DIC",9002313.82461,9002313.82461,0,"WR")
@
"SEC","^DIC",9002313.91,9002313.91,0,"AUDIT")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DD")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DEL")
@
"SEC","^DIC",9002313.91,9002313.91,0,"LAYGO")
@
"SEC","^DIC",9002313.91,9002313.91,0,"RD")
Pp
"SEC","^DIC",9002313.91,9002313.91,0,"WR")
@
"SEC","^DIC",9002313.99,9002313.99,0,"AUDIT")
@
"SEC","^DIC",9002313.99,9002313.99,0,"DD")
@
"SEC","^DIC",9002313.99,9002313.99,0,"DEL")
@
"SEC","^DIC",9002313.99,9002313.99,0,"LAYGO")
@
"SEC","^DIC",9002313.99,9002313.99,0,"RD")
Pp
"SEC","^DIC",9002313.99,9002313.99,0,"WR")
@
"VER")
8.0^22.0
"^DD",9002313.02,9002313.02,0)
FIELD^^9999^52
"^DD",9002313.02,9002313.02,0,"DDA")
N
"^DD",9002313.02,9002313.02,0,"DT")
3070625
"^DD",9002313.02,9002313.02,0,"IX","AD",9002313.02,.04)

"^DD",9002313.02,9002313.02,0,"IX","AE",9002313.02,.05)

"^DD",9002313.02,9002313.02,0,"IX","AF",9002313.02,401)

"^DD",9002313.02,9002313.02,0,"IX","AG",9002313.02,902)

"^DD",9002313.02,9002313.02,0,"IX","B",9002313.02,.01)

"^DD",9002313.02,9002313.02,0,"IX","C",9002313.02,1.01)

"^DD",9002313.02,9002313.02,0,"NM","BPS CLAIMS")

"^DD",9002313.02,9002313.02,0,"PT",9002313.03,.01)

"^DD",9002313.02,9002313.02,0,"PT",9002313.31,.03)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,401)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,401)

"^DD",9002313.02,9002313.02,0,"VRPK")
BPS
"^DD",9002313.02,9002313.02,.01,0)
Claim ID^F^^0;1^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,.01,1,0)
^.1
"^DD",9002313.02,9002313.02,.01,1,1,0)
9002313.02^B^MUMPS
"^DD",9002313.02,9002313.02,.01,1,1,1)
S ^BPSC("B",$E(X,1,32),DA)=""
"^DD",9002313.02,9002313.02,.01,1,1,2)
K ^BPSC("B",$E(X,1,32),DA)
"^DD",9002313.02,9002313.02,.01,1,1,"DT")
3030725
"^DD",9002313.02,9002313.02,.01,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,.01,21,0)
^^4^4^3060628^
"^DD",9002313.02,9002313.02,.01,21,1,0)
External Claim ID value.  This value is a concatenation of the text 'VA'
"^DD",9002313.02,9002313.02,.01,21,2,0)
along with the current year, the pharmacy ID, the VA National Plan ID
"^DD",9002313.02,9002313.02,.01,21,3,0)
(without the alpha prefix), and a unique sequence number.  Each of the
"^DD",9002313.02,9002313.02,.01,21,4,0)
four pieces are delimited by the equal sign ("=").
"^DD",9002313.02,9002313.02,.01,"DT")
3060628
"^DD",9002313.02,9002313.02,.02,0)
Electronic payor^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.02,9002313.02,.02,3)
Enter the payer sheet for the claim
"^DD",9002313.02,9002313.02,.02,21,0)
^^1^1^3050729^
"^DD",9002313.02,9002313.02,.02,21,1,0)
This is the payer sheet used by the claim
"^DD",9002313.02,9002313.02,.02,"DT")
3050729
"^DD",9002313.02,9002313.02,.04,0)
Transmit Flag^S^1:YES (BATCH FILE);0:NO;2:YES (POINT OF SALE);^0;4^Q
"^DD",9002313.02,9002313.02,.04,1,0)
^.1
"^DD",9002313.02,9002313.02,.04,1,1,0)
9002313.02^AD
"^DD",9002313.02,9002313.02,.04,1,1,1)
S ^BPSC("AD",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.04,1,1,2)
K ^BPSC("AD",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.04,1,1,"DT")
2950524
"^DD",9002313.02,9002313.02,.04,21,0)
^.001^2^2^3050316^^
"^DD",9002313.02,9002313.02,.04,21,1,0)
Numerical code to indicate a transmit status.  Current values are 0 for 
"^DD",9002313.02,9002313.02,.04,21,2,0)
'No' 1 for 'Yes' Batch and 2 for 'Yes' Point of Sale.
"^DD",9002313.02,9002313.02,.04,"DT")
3031119
"^DD",9002313.02,9002313.02,.05,0)
Transmitted On^DO^^0;5^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.05,.1)
'
"^DD",9002313.02,9002313.02,.05,1,0)
^.1
"^DD",9002313.02,9002313.02,.05,1,1,0)
9002313.02^AE
"^DD",9002313.02,9002313.02,.05,1,1,1)
S ^BPSC("AE",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.05,1,1,2)
K ^BPSC("AE",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.05,1,1,"DT")
2950622
"^DD",9002313.02,9002313.02,.05,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,21,0)
^.001^1^1^3050316^^
"^DD",9002313.02,9002313.02,.05,21,1,0)
Date on which the data was transmitted.
"^DD",9002313.02,9002313.02,.05,"DT")
3031119
"^DD",9002313.02,9002313.02,.06,0)
Created On^DO^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.06,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,21,0)
^^1^1^3031125^^
"^DD",9002313.02,9002313.02,.06,21,1,0)
Date on which this record was created.
"^DD",9002313.02,9002313.02,.06,"DT")
3031125
"^DD",9002313.02,9002313.02,.07,0)
AUTO REVERSE FLAG^S^0:NO;1:UNRELEASED CLAIM;2:INPATIENT CLAIM;^0;7^Q
"^DD",9002313.02,9002313.02,.07,3)
If auto-reversed, enter the type of auto-reversal
"^DD",9002313.02,9002313.02,.07,21,0)
^^3^3^3060105^
"^DD",9002313.02,9002313.02,.07,21,1,0)
This flag is marking ECME Claims that were automatically reversed because 
"^DD",9002313.02,9002313.02,.07,21,2,0)
the Prescription was not released in time or the claim was an inpatient 
"^DD",9002313.02,9002313.02,.07,21,3,0)
claim.
"^DD",9002313.02,9002313.02,.07,"DT")
3060105
"^DD",9002313.02,9002313.02,1.01,0)
Patient Name^F^^1;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.01,1,0)
^.1
"^DD",9002313.02,9002313.02,1.01,1,1,0)
9002313.02^C
"^DD",9002313.02,9002313.02,1.01,1,1,1)
S ^BPSC("C",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,1.01,1,1,2)
K ^BPSC("C",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,1.01,1,1,"DT")
2950606
"^DD",9002313.02,9002313.02,1.01,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.02,1.01,21,0)
^^2^2^3040331^
"^DD",9002313.02,9002313.02,1.01,21,1,0)
Patient name extracted from the VA patient file.  This entry is free text 
"^DD",9002313.02,9002313.02,1.01,21,2,0)
to accommodate the NCPDP formatting requirements.
"^DD",9002313.02,9002313.02,1.01,"DT")
3040331
"^DD",9002313.02,9002313.02,1.04,0)
VA PLAN IEN^P355.3'^IBA(355.3,^1;4^Q
"^DD",9002313.02,9002313.02,1.04,3)
Enter the Group Insurance
"^DD",9002313.02,9002313.02,1.04,21,0)
^^1^1^3061120^
"^DD",9002313.02,9002313.02,1.04,21,1,0)
Internal identifier number for the Group Insurance Record
"^DD",9002313.02,9002313.02,1.04,"DT")
3061120
"^DD",9002313.02,9002313.02,101,0)
BIN Number^F^^100;1^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.02,9002313.02,101,3)
Answer must be 6 characters in length.
"^DD",9002313.02,9002313.02,101,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,101,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.02,9002313.02,101,"DT")
3031124
"^DD",9002313.02,9002313.02,102,0)
Version/Release Number^F^^100;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,102,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,102,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,102,21,1,0)
Code identifying the Enrollment Standard format of the file sent or 
"^DD",9002313.02,9002313.02,102,21,2,0)
received.
"^DD",9002313.02,9002313.02,102,"DT")
3031124
"^DD",9002313.02,9002313.02,103,0)
Transaction Code^F^^100;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,103,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,103,21,0)
^^15^15^3031124^
"^DD",9002313.02,9002313.02,103,21,1,0)
Code to identify the transaction type for this claim.
"^DD",9002313.02,9002313.02,103,21,2,0)
E1=Eligibility Verification
"^DD",9002313.02,9002313.02,103,21,3,0)
B1=Billing
"^DD",9002313.02,9002313.02,103,21,4,0)
B2=Reversal
"^DD",9002313.02,9002313.02,103,21,5,0)
B3=Rebill
"^DD",9002313.02,9002313.02,103,21,6,0)
P1=P.A. Request & Billing
"^DD",9002313.02,9002313.02,103,21,7,0)
P2=P.A. Reversal
"^DD",9002313.02,9002313.02,103,21,8,0)
P3=P.A. Inquiry
"^DD",9002313.02,9002313.02,103,21,9,0)
P4=P.A. Request Only
"^DD",9002313.02,9002313.02,103,21,10,0)
N1=Information Reporting
"^DD",9002313.02,9002313.02,103,21,11,0)
N2=Information Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,12,0)
N3=Information Reporting Rebill
"^DD",9002313.02,9002313.02,103,21,13,0)
C1=Controlled Substance Reporting
"^DD",9002313.02,9002313.02,103,21,14,0)
C2=Controlled Substance Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,15,0)
C3=Controlled Substance Reporting Rebill
"^DD",9002313.02,9002313.02,103,"DT")
3031124
"^DD",9002313.02,9002313.02,104,0)
Processor Control Number^F^^100;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,104,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,104,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,104,21,1,0)
Number which will uniquely identify the submitter of the claim.
"^DD",9002313.02,9002313.02,104,"DT")
3031124
"^DD",9002313.02,9002313.02,109,0)
Transaction Count^F^^100;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,109,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,109,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,109,21,1,0)
Count of transactions in the transmission.
"^DD",9002313.02,9002313.02,109,"DT")
3031124
"^DD",9002313.02,9002313.02,110,0)
Software Vendor/Cert ID^F^^100;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,110,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,110,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,110,21,1,0)
Certification number which Identifies the patients insurance carrier.
"^DD",9002313.02,9002313.02,110,"DT")
3031124
"^DD",9002313.02,9002313.02,201,0)
Service Provider ID^F^^200;1^K:$L(X)>15!($L(X)<12) X
"^DD",9002313.02,9002313.02,201,3)
Answer must be 12-15 characters in length.
"^DD",9002313.02,9002313.02,201,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,201,21,1,0)
ID assigned to a pharmacy or provider.
"^DD",9002313.02,9002313.02,201,"DT")
3031124
"^DD",9002313.02,9002313.02,202,0)
Service Provider ID Qualifier^F^^200;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,202,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,202,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.02,202,21,1,0)
Qualifier indicating which ID number was used.
"^DD",9002313.02,9002313.02,202,"DT")
3020730
"^DD",9002313.02,9002313.02,301,0)
Group ID^F^^300;1^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,301,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,301,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,301,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.02,9002313.02,301,"DT")
3031124
"^DD",9002313.02,9002313.02,302,0)
Cardholder ID^F^^300;2^K:$L(X)>20!($L(X)<18) X
"^DD",9002313.02,9002313.02,302,3)
Answer must be 18-20 characters in length.
"^DD",9002313.02,9002313.02,302,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,302,21,1,0)
Insurance ID assigned to the cardholder.
"^DD",9002313.02,9002313.02,302,"DT")
3031124
"^DD",9002313.02,9002313.02,303,0)
Person Code^F^^300;3^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,303,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.02,303,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,303,21,1,0)
Code assigned to a specific person within a family.
"^DD",9002313.02,9002313.02,303,"DT")
3031124
"^DD",9002313.02,9002313.02,304,0)
Date of Birth^FO^^300;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,304,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,304,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,304,21,1,0)
Patient date of birth in the format CCYYMMDD.
"^DD",9002313.02,9002313.02,304,"DT")
3031124
"^DD",9002313.02,9002313.02,305,0)
Patient Gender Code^FO^^300;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,305,2)
S Y(0)=Y S Y=$S(Y=1:"MALE",Y=2:"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,2.1)
S Y=$S(Y=1:"MALE",Y=2:"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,305,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,305,21,1,0)
One of three codes to indicated the gender of the patient.
"^DD",9002313.02,9002313.02,305,21,2,0)
0 = Not Specific
"^DD",9002313.02,9002313.02,305,21,3,0)
1 = Male
"^DD",9002313.02,9002313.02,305,21,4,0)
2 = Female
"^DD",9002313.02,9002313.02,305,"DT")
3031124
"^DD",9002313.02,9002313.02,306,0)
Patient Relationship Code^FO^^300;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,306,2)
S Y(0)=Y S Y=$S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,2.1)
S Y=$S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,306,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,306,21,1,0)
Code indicating relationship of patient to cardholder.
"^DD",9002313.02,9002313.02,306,"DT")
3031124
"^DD",9002313.02,9002313.02,307,0)
Patient Location^F^^300;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,307,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,307,21,0)
^^14^14^3031124^
"^DD",9002313.02,9002313.02,307,21,1,0)
Code identifying the location of the patient when receiving pharmacy 
"^DD",9002313.02,9002313.02,307,21,2,0)
services.
"^DD",9002313.02,9002313.02,307,21,3,0)
=Not Specified
"^DD",9002313.02,9002313.02,307,21,4,0)
1=Home
"^DD",9002313.02,9002313.02,307,21,5,0)
2=Inter-Care
"^DD",9002313.02,9002313.02,307,21,6,0)
3=Nursing Home
"^DD",9002313.02,9002313.02,307,21,7,0)
4=Long Term/Extended Care
"^DD",9002313.02,9002313.02,307,21,8,0)
5=Rest Home
"^DD",9002313.02,9002313.02,307,21,9,0)
6=Boarding Home
"^DD",9002313.02,9002313.02,307,21,10,0)
7=Skilled Care Facility
"^DD",9002313.02,9002313.02,307,21,11,0)
8=Sub-Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,12,0)
9=Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,13,0)
1=Outpatient
"^DD",9002313.02,9002313.02,307,21,14,0)
11=Hospice
"^DD",9002313.02,9002313.02,307,"DT")
3031124
"^DD",9002313.02,9002313.02,309,0)
Eligibility Clarification Code^F^^300;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,309,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,309,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on 
"^DD",9002313.02,9002313.02,309,21,2,0)
receiving a denial.
"^DD",9002313.02,9002313.02,309,"DT")
3031124
"^DD",9002313.02,9002313.02,310,0)
Patient First Name^F^^300;10^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.02,310,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.02,310,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,310,21,1,0)
First name of patient receiving the prescription.
"^DD",9002313.02,9002313.02,310,"DT")
3031124
"^DD",9002313.02,9002313.02,311,0)
Patient Last Name^F^^300;11^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,311,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,311,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.02,311,21,1,0)
Last Name of patient receiving the prescription.
"^DD",9002313.02,9002313.02,311,"DT")
3040331
"^DD",9002313.02,9002313.02,312,0)
Cardholder First Name^F^^300;12^K:$L(X)>14!($L(X)<1) X
"^DD",9002313.02,9002313.02,312,3)
Answer must be 1-14 characters in length.
"^DD",9002313.02,9002313.02,312,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,312,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.02,9002313.02,312,"DT")
3031124
"^DD",9002313.02,9002313.02,313,0)
Cardholder Last Name^F^^300;13^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.02,9002313.02,313,3)
Answer must be 1-17 characters in length.
"^DD",9002313.02,9002313.02,313,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,313,21,1,0)
Last name of the cardholder/subscriber.
"^DD",9002313.02,9002313.02,313,"DT")
3031124
"^DD",9002313.02,9002313.02,314,0)
Home Plan^F^^300;14^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.02,9002313.02,314,3)
Answer must be 1-5 characters in length.
"^DD",9002313.02,9002313.02,314,21,0)
^^3^3^3031124^
"^DD",9002313.02,9002313.02,314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates 
"^DD",9002313.02,9002313.02,314,21,2,0)
where the member's coverage has been designated. Usually where the member 
"^DD",9002313.02,9002313.02,314,21,3,0)
lives or purchased their coverage.
"^DD",9002313.02,9002313.02,314,"DT")
3031124
"^DD",9002313.02,9002313.02,322,0)
Patient Street Address^F^^321;2^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,322,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,322,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,322,21,1,0)
Free-form text for Patient address information.
"^DD",9002313.02,9002313.02,322,"DT")
3031124
"^DD",9002313.02,9002313.02,323,0)
Patient City Address^F^^321;3^K:$L(X)>22!($L(X)<1) X
"^DD",9002313.02,9002313.02,323,3)
Answer must be 1-22 characters in length.
"^DD",9002313.02,9002313.02,323,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,323,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.02,323,"DT")
3031124
"^DD",9002313.02,9002313.02,324,0)
Patient State/Prov Address^F^^321;4^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.02,9002313.02,324,3)
Answer must be 1-4 characters in length.
"^DD",9002313.02,9002313.02,324,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,324,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.02,9002313.02,324,"DT")
3031124
"^DD",9002313.02,9002313.02,325,0)
Patient Zip/Postal Zone^F^^321;5^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.02,9002313.02,325,3)
Answer must be 1-15 characters in length.
"^DD",9002313.02,9002313.02,325,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,325,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.02,325,21,2,0)
(zip code for US).
"^DD",9002313.02,9002313.02,325,"DT")
3031124
"^DD",9002313.02,9002313.02,326,0)
Patient Phone Number^F^^321;6^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,326,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,326,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,326,21,1,0)
Ten digit  phone number of patient.
"^DD",9002313.02,9002313.02,326,"DT")
3031124
"^DD",9002313.02,9002313.02,331,0)
Patient ID Qualifier^F^^330;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,331,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,331,21,0)
^^6^6^3031124^
"^DD",9002313.02,9002313.02,331,21,1,0)
Code qualifying the 'Patient ID'.
"^DD",9002313.02,9002313.02,331,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,331,21,3,0)
1=Social Security Number
"^DD",9002313.02,9002313.02,331,21,4,0)
2=Driver's License Number
"^DD",9002313.02,9002313.02,331,21,5,0)
3=U.S. Military ID
"^DD",9002313.02,9002313.02,331,21,6,0)
99=Other
"^DD",9002313.02,9002313.02,331,"DT")
3031124
"^DD",9002313.02,9002313.02,332,0)
Patient ID  ^F^^330;2^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.02,332,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.02,332,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,332,21,1,0)
ID assigned to the patient.
"^DD",9002313.02,9002313.02,332,"DT")
3031124
"^DD",9002313.02,9002313.02,333,0)
Employer ID^F^^330;3^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,333,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,333,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,333,21,1,0)
ID assigned to employer.
"^DD",9002313.02,9002313.02,333,"DT")
3031124
"^DD",9002313.02,9002313.02,334,0)
Smoker/Non Smoker^F^^330;4^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,334,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,334,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,334,21,1,0)
Code indicating the patient as a smoker or non-smoker.
"^DD",9002313.02,9002313.02,334,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,334,21,3,0)
1=Non-Smoker
"^DD",9002313.02,9002313.02,334,21,4,0)
2=Smoker
"^DD",9002313.02,9002313.02,334,"DT")
3031124
"^DD",9002313.02,9002313.02,335,0)
Pregnancy Indicator^F^^330;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,335,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,335,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,335,21,1,0)
Code indicating the patient as pregnant or non-pregnant.
"^DD",9002313.02,9002313.02,335,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,335,21,3,0)
1=Not pregnant
"^DD",9002313.02,9002313.02,335,21,4,0)
2=Pregnant
"^DD",9002313.02,9002313.02,335,"DT")
3031124
"^DD",9002313.02,9002313.02,336,0)
Facility ID^F^^330;6^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,336,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,336,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,336,21,1,0)
ID assigned to the patient's clinic/host party.
"^DD",9002313.02,9002313.02,336,"DT")
3031124
"^DD",9002313.02,9002313.02,400,0)
Medication(s)^9002313.0201A^^400;0
"^DD",9002313.02,9002313.02,400,21,0)
^.001^1^1^3070316^^^^
"^DD",9002313.02,9002313.02,400,21,1,0)
Medications included in this prescription.
"^DD",9002313.02,9002313.02,400,"DT")
2950522
"^DD",9002313.02,9002313.02,401,0)
Date of Service^F^^401;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,401,1,0)
^.1
"^DD",9002313.02,9002313.02,401,1,1,0)
9002313.02^AF
"^DD",9002313.02,9002313.02,401,1,1,1)
S ^BPSC("AF",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,401,1,1,2)
K ^BPSC("AF",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,401,1,1,"DT")
2950724
"^DD",9002313.02,9002313.02,401,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,401,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,401,21,1,0)
Date prescription was dispensed.
"^DD",9002313.02,9002313.02,401,"DT")
3031124
"^DD",9002313.02,9002313.02,524,0)
Plan ID^F^^520;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,524,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,524,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,524,21,1,0)
Assigned by the processor to identify a set of parameters, benefit, or 
"^DD",9002313.02,9002313.02,524,21,2,0)
coverage criteria used to adjudicate a claim.
"^DD",9002313.02,9002313.02,524,"DT")
3031124
"^DD",9002313.02,9002313.02,901,0)
CLOSED^S^1:YES;^900;1^Q
"^DD",9002313.02,9002313.02,901,"DT")
3040513
"^DD",9002313.02,9002313.02,902,0)
CLOSED DATE/TIME^D^^900;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,902,1,0)
^.1
"^DD",9002313.02,9002313.02,902,1,1,0)
9002313.02^AG
"^DD",9002313.02,9002313.02,902,1,1,1)
S ^BPSC("AG",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,902,1,1,2)
K ^BPSC("AG",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,902,1,1,"DT")
3040518
"^DD",9002313.02,9002313.02,902,3)
(No range limit on date)
"^DD",9002313.02,9002313.02,902,"DT")
3060118
"^DD",9002313.02,9002313.02,903,0)
CLOSED BY^P200'^VA(200,^900;3^Q
"^DD",9002313.02,9002313.02,903,"DT")
3040513
"^DD",9002313.02,9002313.02,904,0)
CLOSED REASON^*P356.8'^IBE(356.8,^900;4^S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",9002313.02,9002313.02,904,3)
Enter the Claim Close Reason.
"^DD",9002313.02,9002313.02,904,12)
Only ECME-supported non-billable reasons can be entered.
"^DD",9002313.02,9002313.02,904,12.1)
S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)"
"^DD",9002313.02,9002313.02,904,21,0)
^^2^2^3050729^
"^DD",9002313.02,9002313.02,904,21,1,0)
The ECME-supported non-billable reason entered by the user or defaulted by
"^DD",9002313.02,9002313.02,904,21,2,0)
the system.
"^DD",9002313.02,9002313.02,904,"DT")
3050729
"^DD",9002313.02,9002313.02,905,0)
DROP TO PAPER^S^D:DROP TO PAPER;N:NON-BILLABLE;^900;5^Q
"^DD",9002313.02,9002313.02,905,21,0)
^.001^4^4^3050518^^^
"^DD",9002313.02,9002313.02,905,21,1,0)
If close reason is 90 DAY RX FILL NOT COVERED or 
"^DD",9002313.02,9002313.02,905,21,2,0)
NOT A CONTRACTED PROVIDER then user will be prompted:
"^DD",9002313.02,9002313.02,905,21,3,0)
Treat as (N)on-Billable Episode or (D)rop Bill to Paper? 
"^DD",9002313.02,9002313.02,905,21,4,0)
the answer is stored in this field and sent to IB
"^DD",9002313.02,9002313.02,905,"DT")
3050517
"^DD",9002313.02,9002313.02,906,0)
REOPENED DATE/TIME^D^^900;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,906,3)
Enter the date and time when the claim was re-opened
"^DD",9002313.02,9002313.02,906,21,0)
^^1^1^3060523^
"^DD",9002313.02,9002313.02,906,21,1,0)
Date and time when the claim was re-opened.
"^DD",9002313.02,9002313.02,906,"DT")
3060614
"^DD",9002313.02,9002313.02,907,0)
REOPENED BY^P200'^VA(200,^900;7^Q
"^DD",9002313.02,9002313.02,907,3)
Enter the user who re-opened the claim
"^DD",9002313.02,9002313.02,907,21,0)
^^1^1^3060523^
"^DD",9002313.02,9002313.02,907,21,1,0)
The system user who re-opened the claim.
"^DD",9002313.02,9002313.02,907,"DT")
3060614
"^DD",9002313.02,9002313.02,908,0)
REOPENED COMMENT^F^^900;8^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.02,9002313.02,908,3)
Enter the reason for the re-opening of the claim
"^DD",9002313.02,9002313.02,908,21,0)
^^1^1^3060614^
"^DD",9002313.02,9002313.02,908,21,1,0)
User comments for the re-opening of the claim.
"^DD",9002313.02,9002313.02,908,"DT")
3060614
"^DD",9002313.02,9002313.02,9999,0)
RAW DATA SENT^9002313.29999^^M;0
"^DD",9002313.02,9002313.02,9999,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.02,9999,21,1,0)
An exact copy of the record sent via the communications protocol.
"^DD",9002313.02,9002313.0201,0)
Medication(s) SUB-FIELD^^600^105
"^DD",9002313.02,9002313.0201,0,"DT")
3070625
"^DD",9002313.02,9002313.0201,0,"IX","AC",9002313.0201,.03)

"^DD",9002313.02,9002313.0201,0,"IX","B",9002313.0201,.01)

"^DD",9002313.02,9002313.0201,0,"NM","Medication(s)")

"^DD",9002313.02,9002313.0201,0,"UP")
9002313.02
"^DD",9002313.02,9002313.0201,.01,0)
Medication Order^MNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.02,9002313.0201,.01,1,0)
^.1
"^DD",9002313.02,9002313.0201,.01,1,1,0)
9002313.0201^B
"^DD",9002313.02,9002313.0201,.01,1,1,1)
S ^BPSC(DA(1),400,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0201,.01,1,1,2)
K ^BPSC(DA(1),400,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0201,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.02,9002313.0201,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.01,21,1,0)
Free text to indicate meds ordered.
"^DD",9002313.02,9002313.0201,.01,"DT")
3031125
"^DD",9002313.02,9002313.0201,.03,0)
Medication Number^NJ9,0^^0;3^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.02,9002313.0201,.03,1,0)
^.1
"^DD",9002313.02,9002313.0201,.03,1,1,0)
9002313.0201^AC
"^DD",9002313.02,9002313.0201,.03,1,1,1)
S ^BPSC(DA(1),400,"AC",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0201,.03,1,1,2)
K ^BPSC(DA(1),400,"AC",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0201,.03,1,1,"DT")
2950525
"^DD",9002313.02,9002313.0201,.03,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.02,9002313.0201,.03,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.03,21,1,0)
Number of the med ordered.
"^DD",9002313.02,9002313.0201,.03,"DT")
3031125
"^DD",9002313.02,9002313.0201,.04,0)
Medication Name^F^^0;4^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.02,9002313.0201,.04,3)
Answer must be 1-50 characters in length.
"^DD",9002313.02,9002313.0201,.04,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.04,21,1,0)
Name of the med ordered.
"^DD",9002313.02,9002313.0201,.04,"DT")
3031125
"^DD",9002313.02,9002313.0201,.05,0)
PRESCRIPTION #^P52'^PSRX(^0;5^Q
"^DD",9002313.02,9002313.0201,.05,3)
Enter the Prescription for this medication
"^DD",9002313.02,9002313.0201,.05,21,0)
^^1^1^3070227^
"^DD",9002313.02,9002313.0201,.05,21,1,0)
This is the prescription associated with the claim
"^DD",9002313.02,9002313.0201,.05,"DT")
3070227
"^DD",9002313.02,9002313.0201,308,0)
Other Coverage Code^F^^300;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,308,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,308,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.02,9002313.0201,308,"DT")
3031125
"^DD",9002313.02,9002313.0201,315,0)
Employer Name^F^^310;5^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,315,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,315,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,315,21,1,0)
Complete name of employer.
"^DD",9002313.02,9002313.0201,315,"DT")
3031125
"^DD",9002313.02,9002313.0201,316,0)
Employer Street Address^F^^310;6^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,316,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,316,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0201,316,21,1,0)
The Street address of the insured's employer.
"^DD",9002313.02,9002313.0201,316,"DT")
3020731
"^DD",9002313.02,9002313.0201,317,0)
Employer City Address^F^^310;7^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,317,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,317,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,317,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.0201,317,"DT")
3031125
"^DD",9002313.02,9002313.0201,318,0)
Employer State/Prov Address^F^^310;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,318,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,318,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.02,9002313.0201,318,"DT")
3031125
"^DD",9002313.02,9002313.0201,319,0)
Employer Zip/Postal Zone^F^^310;9^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,319,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,319,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.0201,319,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.0201,319,21,2,0)
(zip code for US).
"^DD",9002313.02,9002313.0201,319,"DT")
3031125
"^DD",9002313.02,9002313.0201,320,0)
Employer Phone Number^F^^310;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,320,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,320,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.02,9002313.0201,320,"DT")
3031125
"^DD",9002313.02,9002313.0201,321,0)
Employer Contact Name^F^^320;1^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,321,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,321,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,321,21,1,0)
Employer primary contact.
"^DD",9002313.02,9002313.0201,321,"DT")
3031125
"^DD",9002313.02,9002313.0201,327,0)
Carrier ID^F^^320;7^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,327,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,327,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,327,21,1,0)
Carrier code assigned in Worker's Compensation Program.
"^DD",9002313.02,9002313.0201,327,"DT")
3031125
"^DD",9002313.02,9002313.0201,330,0)
Alternate ID^F^^320;10^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,330,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,330,21,0)
^^3^3^3031125^
"^DD",9002313.02,9002313.0201,330,21,1,0)
Person identifier to be used for controlled product reporting. Identifier 
"^DD",9002313.02,9002313.0201,330,21,2,0)
may be that of the patient or the person picking up the prescription as 
"^DD",9002313.02,9002313.0201,330,21,3,0)
required by the governing body.
"^DD",9002313.02,9002313.0201,330,"DT")
3031125
"^DD",9002313.02,9002313.0201,337,0)
COB/Other Payments Cnt^F^^330;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,337,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,337,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,337,21,1,0)
Count of other payment occurrences.
"^DD",9002313.02,9002313.0201,337,"DT")
3031125
"^DD",9002313.02,9002313.0201,337.01,0)
COB/Other Payments  ^9002313.0401A^^337;0
"^DD",9002313.02,9002313.0201,343,0)
Dispensing Status^F^^340;3^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,343,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,343,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,343,21,1,0)
The status of the medication order at the time the claim was built.
"^DD",9002313.02,9002313.0201,343,"DT")
3020731
"^DD",9002313.02,9002313.0201,344,0)
Qty Intended to be Dispensed^F^^340;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,344,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,344,21,0)
^^2^2^3070625^
"^DD",9002313.02,9002313.0201,344,21,1,0)
The quantity ordered - may differ from qty dispensed depending on stock 
"^DD",9002313.02,9002313.0201,344,21,2,0)
levels
"^DD",9002313.02,9002313.0201,344,"DT")
3070625
"^DD",9002313.02,9002313.0201,345,0)
Days Supply Intd Dispensed^F^^340;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,345,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,345,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,345,21,1,0)
The days supply from the order information.
"^DD",9002313.02,9002313.0201,345,"DT")
3020731
"^DD",9002313.02,9002313.0201,401,0)
Date of Service^FO^^400;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,401,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,2.1)
S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,401,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,401,21,1,0)
The fill/refill date
"^DD",9002313.02,9002313.0201,401,"DT")
3020726
"^DD",9002313.02,9002313.0201,402,0)
Prescription/Service Ref Num^F^^400;2^K:$L(X)>7!($L(X)<1) X
"^DD",9002313.02,9002313.0201,402,3)
Answer must be 1-7 characters in length.
"^DD",9002313.02,9002313.0201,402,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,402,21,1,0)
The first seven digits of the prescription IEN
"^DD",9002313.02,9002313.0201,402,"DT")
3020724
"^DD",9002313.02,9002313.0201,403,0)
Fill Number^FO^^400;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,403,2)
S Y(0)=Y S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,403,2.1)
S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,403,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,403,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,403,21,1,0)
The fill/refill number, starting at 0 for the original fill.
"^DD",9002313.02,9002313.0201,403,"DT")
3020805
"^DD",9002313.02,9002313.0201,405,0)
Days Supply^FO^^400;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,405,2)
S Y(0)=Y S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,405,2.1)
S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,405,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,405,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,405,21,1,0)
The actual days supply dispensed.
"^DD",9002313.02,9002313.0201,405,"DT")
3020805
"^DD",9002313.02,9002313.0201,406,0)
Compound Code^F^^400;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,406,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,406,21,0)
^^2^2^3040331^
"^DD",9002313.02,9002313.0201,406,21,1,0)
Field indicating whether this prescription was a compound (1)
"^DD",9002313.02,9002313.0201,406,21,2,0)
or not a compound (0).
"^DD",9002313.02,9002313.0201,406,"DT")
3040331
"^DD",9002313.02,9002313.0201,407,0)
Product/Service ID^FO^^400;7^K:$L(X)>19!($L(X)<11) X
"^DD",9002313.02,9002313.0201,407,2)
S Y(0)=Y Q:$E(Y,1,1)["D"  S Y=$E(Y,1,5)_"-"_$E(Y,6,9)_"-"_$E(Y,10,11)
"^DD",9002313.02,9002313.0201,407,2.1)
Q:$E(Y,1,1)["D"  S Y=$E(Y,1,5)_"-"_$E(Y,6,9)_"-"_$E(Y,10,11)
"^DD",9002313.02,9002313.0201,407,3)
Answer must be 11-19 characters in length.
"^DD",9002313.02,9002313.0201,407,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,407,21,1,0)
NDC code in our case.
"^DD",9002313.02,9002313.0201,407,"DT")
3020805
"^DD",9002313.02,9002313.0201,408,0)
Dispense as Wrtn/Prd Sel Cd^F^^400;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,408,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,408,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,408,21,1,0)
Indicator for whether the prescription was to be dispensed only as 
"^DD",9002313.02,9002313.0201,408,21,2,0)
written.
"^DD",9002313.02,9002313.0201,408,"DT")
3020726
"^DD",9002313.02,9002313.0201,409,0)
Ingredient Cost Submitted^FO^^400;9^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,409,2)
S Y(0)=Y ;S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.02,9002313.0201,409,2.1)
;S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.02,9002313.0201,409,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,409,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,409,21,1,0)
Cost amount for the ingredients of compounds.
"^DD",9002313.02,9002313.0201,409,"DT")
3020805
"^DD",9002313.02,9002313.0201,411,0)
Prescriber ID^F^^400;11^K:$L(X)>15!($L(X)<10) X
"^DD",9002313.02,9002313.0201,411,3)
Answer must be 10-15 characters in length.
"^DD",9002313.02,9002313.0201,411,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,411,21,1,0)
Prescriber identification number.
"^DD",9002313.02,9002313.0201,411,"DT")
3020726
"^DD",9002313.02,9002313.0201,412,0)
Dispensing Fee Submitted^FO^^400;12^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,412,2)
S Y(0)=Y ;S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,412,2.1)
;S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,412,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,412,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,412,21,1,0)
Add-on fee charged in a retail setting.  This field will probably be used 
"^DD",9002313.02,9002313.0201,412,21,2,0)
when the Tricare functionality is added.
"^DD",9002313.02,9002313.0201,412,"DT")
3020805
"^DD",9002313.02,9002313.0201,414,0)
Date Prescription Written^F^^400;14^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,414,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,414,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,414,21,1,0)
This will be the fill/refill date for local fills, the released date for 
"^DD",9002313.02,9002313.0201,414,21,2,0)
CMOP.
"^DD",9002313.02,9002313.0201,414,"DT")
2950410
"^DD",9002313.02,9002313.0201,415,0)
Number Refills Authorized^F^^400;15^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,415,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,415,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,415,21,1,0)
The number of refills allowed that was entered during order entry.
"^DD",9002313.02,9002313.0201,415,"DT")
2950410
"^DD",9002313.02,9002313.0201,418,0)
Level of Service^F^^400;18^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,418,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,418,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,418,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.02,9002313.0201,418,"DT")
2950410
"^DD",9002313.02,9002313.0201,419,0)
Prescription Origin Code^F^^400;19^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,419,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,419,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,419,21,1,0)
Not used by VA - left in for IHS
"^DD",9002313.02,9002313.0201,419,"DT")
2950410
"^DD",9002313.02,9002313.0201,420,0)
Submission Clarification Code^F^^400;20^K:$L(X)>4!($L(X)<3) X
"^DD",9002313.02,9002313.0201,420,3)
Answer must be 3-4 characters in length.
"^DD",9002313.02,9002313.0201,420,21,0)
^.001^1^1^3070119^^
"^DD",9002313.02,9002313.0201,420,21,1,0)
Submission Clarification Code
"^DD",9002313.02,9002313.0201,420,"DT")
3070213
"^DD",9002313.02,9002313.0201,421,0)
Primary Care Provider ID^F^^400;21^K:$L(X)>15!($L(X)<10) X
"^DD",9002313.02,9002313.0201,421,3)
Answer must be 10-15 characters in length.
"^DD",9002313.02,9002313.0201,421,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,421,21,1,0)
Provider ID number
"^DD",9002313.02,9002313.0201,421,"DT")
3020726
"^DD",9002313.02,9002313.0201,423,0)
Basis of Cost Determination^F^^400;23^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,423,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,423,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,423,21,1,0)
How the amount charged was arrived at.
"^DD",9002313.02,9002313.0201,423,"DT")
2950410
"^DD",9002313.02,9002313.0201,424,0)
Diagnosis Code^F^^400;24^K:$L(X)>15!($L(X)<6) X
"^DD",9002313.02,9002313.0201,424,3)
Answer must be 6-15 characters in length.
"^DD",9002313.02,9002313.0201,424,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,424,21,1,0)
Diagnosis code that applies to this prescription.  
"^DD",9002313.02,9002313.0201,424,21,2,0)
Not used for third party billing as of this date - so it
"^DD",9002313.02,9002313.0201,424,21,3,0)
is not used, but may be used in the future.
"^DD",9002313.02,9002313.0201,424,"DT")
3020726
"^DD",9002313.02,9002313.0201,426,0)
Usual & Customary Charge^F^^400;26^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,426,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,426,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,426,21,1,0)
Amount charged cash
"^DD",9002313.02,9002313.0201,426,21,2,0)
customers for the prescription
"^DD",9002313.02,9002313.0201,426,21,3,0)
exclusive of sales tax or other
"^DD",9002313.02,9002313.0201,426,21,4,0)
amounts claimed.
"^DD",9002313.02,9002313.0201,426,"DT")
3020726
"^DD",9002313.02,9002313.0201,427,0)
Prescriber Last Name^F^^420;27^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.02,9002313.0201,427,3)
Answer must be 1-17 characters in length.
"^DD",9002313.02,9002313.0201,427,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,427,21,1,0)
Last Name of the Prescriber
"^DD",9002313.02,9002313.0201,427,"DT")
3010125
"^DD",9002313.02,9002313.0201,429,0)
Unit Dose Indicator^F^^400;29^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,429,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,429,21,0)
^^7^7^3031203^
"^DD",9002313.02,9002313.0201,429,21,1,0)
Code indicating the type of unit
"^DD",9002313.02,9002313.0201,429,21,2,0)
dose dispensing.
"^DD",9002313.02,9002313.0201,429,21,3,0)
 
"^DD",9002313.02,9002313.0201,429,21,4,0)
=Not Specified
"^DD",9002313.02,9002313.0201,429,21,5,0)
1=Not Unit Dose
"^DD",9002313.02,9002313.0201,429,21,6,0)
2=Manufacturer Unit Dose
"^DD",9002313.02,9002313.0201,429,21,7,0)
3=Pharmacy Unit Dose
"^DD",9002313.02,9002313.0201,429,"DT")
2950410
"^DD",9002313.02,9002313.0201,430,0)
Gross Amount Due^F^^400;30^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,430,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,430,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,430,21,1,0)
Total amount submitted to the
"^DD",9002313.02,9002313.0201,430,21,2,0)
payer.
"^DD",9002313.02,9002313.0201,430,"DT")
3020726
"^DD",9002313.02,9002313.0201,431,0)
Other Payer Amount^F^^430;1^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,431,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,431,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,431,21,1,0)
Amount of any payment known
"^DD",9002313.02,9002313.0201,431,21,2,0)
by the pharmacy from other
"^DD",9002313.02,9002313.0201,431,21,3,0)
sources (including coupons).
"^DD",9002313.02,9002313.0201,431,"DT")
3020726
"^DD",9002313.02,9002313.0201,433,0)
Patient Paid Amount Submitted^F^^430;3^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,433,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,433,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,433,21,1,0)
Amount the pharmacy
"^DD",9002313.02,9002313.0201,433,21,2,0)
received from the patient for
"^DD",9002313.02,9002313.0201,433,21,3,0)
the prescription dispensed.
"^DD",9002313.02,9002313.0201,433,"DT")
3020726
"^DD",9002313.02,9002313.0201,434,0)
Date of Injury^F^^430;4^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.02,9002313.0201,434,3)
Answer must be 1-10 characters in length.
"^DD",9002313.02,9002313.0201,434,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,434,21,1,0)
Date on which the injury
"^DD",9002313.02,9002313.0201,434,21,2,0)
occurred.
"^DD",9002313.02,9002313.0201,434,"DT")
3020726
"^DD",9002313.02,9002313.0201,435,0)
Claim/Ref ID Number^F^^430;5^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.0201,435,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.0201,435,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,435,21,1,0)
Identifies the claim number
"^DD",9002313.02,9002313.0201,435,21,2,0)
assigned by Workers
"^DD",9002313.02,9002313.0201,435,21,3,0)
Compensation Program.
"^DD",9002313.02,9002313.0201,435,"DT")
3020726
"^DD",9002313.02,9002313.0201,436,0)
Product/Service ID Qualifier^F^^430;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.02,9002313.0201,436,3)
Answer must be 1-3 characters in length.
"^DD",9002313.02,9002313.0201,436,21,0)
^^33^33^3031203^
"^DD",9002313.02,9002313.0201,436,21,1,0)
Code qualifying the value in
"^DD",9002313.02,9002313.0201,436,21,2,0)
'Product/Service ID' (47-D7)
"^DD",9002313.02,9002313.0201,436,21,3,0)
 
"^DD",9002313.02,9002313.0201,436,21,4,0)
Not Specified Blank
"^DD",9002313.02,9002313.0201,436,21,5,0)
Not Specified 
"^DD",9002313.02,9002313.0201,436,21,6,0)
Universal Product Code (UPC) 1
"^DD",9002313.02,9002313.0201,436,21,7,0)
Health Related Item (HRI) 2
"^DD",9002313.02,9002313.0201,436,21,8,0)
National Drug Code (NDC) 3
"^DD",9002313.02,9002313.0201,436,21,9,0)
Universal Product Number (UPN) 4
"^DD",9002313.02,9002313.0201,436,21,10,0)
Department of Defense (DOD) 5
"^DD",9002313.02,9002313.0201,436,21,11,0)
Drug Use Review/ Professional Pharmacy Service (DUR/PPS) 6
"^DD",9002313.02,9002313.0201,436,21,12,0)
Common Procedure Terminology (CPT4) 7
"^DD",9002313.02,9002313.0201,436,21,13,0)
Common Procedure Terminology (CPT5) 8
"^DD",9002313.02,9002313.0201,436,21,14,0)
Health Care Financing Administration Common Procedural
"^DD",9002313.02,9002313.0201,436,21,15,0)
Coding System (HCPCS)
"^DD",9002313.02,9002313.0201,436,21,16,0)
9
"^DD",9002313.02,9002313.0201,436,21,17,0)
Pharmacy Practice Activity Classification (PPAC) 1
"^DD",9002313.02,9002313.0201,436,21,18,0)
National Pharmaceutical Product Interface Code(NAPPI) 11
"^DD",9002313.02,9002313.0201,436,21,19,0)
International Article Numbering System(EAN) 12
"^DD",9002313.02,9002313.0201,436,21,20,0)
Drug Identification Number(DIN) 13
"^DD",9002313.02,9002313.0201,436,21,21,0)
Medi-Span GPI 14
"^DD",9002313.02,9002313.0201,436,21,22,0)
First DataBank GCN 15
"^DD",9002313.02,9002313.0201,436,21,23,0)
Medical Economics GPO 16
"^DD",9002313.02,9002313.0201,436,21,24,0)
Medi-Span DDID 17
"^DD",9002313.02,9002313.0201,436,21,25,0)
First DataBank SmartKey 18
"^DD",9002313.02,9002313.0201,436,21,26,0)
Medical Economics GM 19
"^DD",9002313.02,9002313.0201,436,21,27,0)
International Classification of Diseases(ICD9) 2
"^DD",9002313.02,9002313.0201,436,21,28,0)
International Classification of Diseases (ICD10) 21
"^DD",9002313.02,9002313.0201,436,21,29,0)
Medi-Span Diagnosis Code 22
"^DD",9002313.02,9002313.0201,436,21,30,0)
Common Dental Terminology (CDT) 25
"^DD",9002313.02,9002313.0201,436,21,31,0)
American Psychiatric Association Diagnostic Statistical Manual
"^DD",9002313.02,9002313.0201,436,21,32,0)
of Mental Disorders (DSM IV)
"^DD",9002313.02,9002313.0201,436,21,33,0)
Other                       99
"^DD",9002313.02,9002313.0201,436,"DT")
3020726
"^DD",9002313.02,9002313.0201,438,0)
Incentive Amount Submitted^F^^430;8^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,438,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,438,21,0)
^^6^6^3031203^
"^DD",9002313.02,9002313.0201,438,21,1,0)
Amount represents a fee that
"^DD",9002313.02,9002313.0201,438,21,2,0)
is submitted by the pharmacy
"^DD",9002313.02,9002313.0201,438,21,3,0)
for contractually agreed upon
"^DD",9002313.02,9002313.0201,438,21,4,0)
services. This amount is
"^DD",9002313.02,9002313.0201,438,21,5,0)
included in the 'Gross Amount
"^DD",9002313.02,9002313.0201,438,21,6,0)
Due' (43-DU).
"^DD",9002313.02,9002313.0201,438,"DT")
3020726
"^DD",9002313.02,9002313.0201,442,0)
Quantity Dispensed^F^^440;2^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,442,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,442,21,0)
^^1^1^3070625^
"^DD",9002313.02,9002313.0201,442,21,1,0)
Quantity dispensed expressed in metric decimal units.
"^DD",9002313.02,9002313.0201,442,"DT")
3070625
"^DD",9002313.02,9002313.0201,443,0)
Other Payer Date^F^^440;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,443,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,443,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,443,21,1,0)
Payment or denial date of the
"^DD",9002313.02,9002313.0201,443,21,2,0)
claim submitted to the other
"^DD",9002313.02,9002313.0201,443,21,3,0)
payer. Used for coordination of
"^DD",9002313.02,9002313.0201,443,21,4,0)
benefits.
"^DD",9002313.02,9002313.0201,443,"DT")
3020726
"^DD",9002313.02,9002313.0201,444,0)
Provider ID^F^^440;4^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,444,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,444,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,444,21,1,0)
Unique ID assigned to the
"^DD",9002313.02,9002313.0201,444,21,2,0)
person responsible for the
"^DD",9002313.02,9002313.0201,444,21,3,0)
dispensing of the prescription
"^DD",9002313.02,9002313.0201,444,21,4,0)
or provision of the service.
"^DD",9002313.02,9002313.0201,444,"DT")
3020730
"^DD",9002313.02,9002313.0201,445,0)
Orig Pres Prod/Srv Cd^F^^440;5^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.0201,445,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.0201,445,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,445,21,1,0)
Code of the initially prescribed
"^DD",9002313.02,9002313.0201,445,21,2,0)
product or service.
"^DD",9002313.02,9002313.0201,445,"DT")
3020730
"^DD",9002313.02,9002313.0201,446,0)
Originally Prescribed Quantity^F^^440;6^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,446,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,446,21,0)
^^1^1^3070625^
"^DD",9002313.02,9002313.0201,446,21,1,0)
Product initially prescribed amount expressed in metric decimal units.
"^DD",9002313.02,9002313.0201,446,"DT")
3070625
"^DD",9002313.02,9002313.0201,447,0)
Comp Ingred Component Cnt^F^^440;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,447,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,447,21,0)
^.001^4^4^3031216^^
"^DD",9002313.02,9002313.0201,447,21,1,0)
Count of compound product
"^DD",9002313.02,9002313.0201,447,21,2,0)
IDs (both active and inactive)
"^DD",9002313.02,9002313.0201,447,21,3,0)
in the compound mixture
"^DD",9002313.02,9002313.0201,447,21,4,0)
submitted.
"^DD",9002313.02,9002313.0201,447,"DT")
3020730
"^DD",9002313.02,9002313.0201,447.01,0)
Compound Repeating Fields^9002313.0501A^^447;0
"^DD",9002313.02,9002313.0201,447.01,"DT")
3021031
"^DD",9002313.02,9002313.0201,450,0)
Compound Dosage Form Desc Cd^F^^440;10^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,450,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,450,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,450,21,1,0)
Description of the compound ingredients.
"^DD",9002313.02,9002313.0201,450,"DT")
3020730
"^DD",9002313.02,9002313.0201,451,0)
Compound Disp Unit Form Ind^F^^450;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,451,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,451,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,451,21,1,0)
NCPDP standard product
"^DD",9002313.02,9002313.0201,451,21,2,0)
billing codes.
"^DD",9002313.02,9002313.0201,451,"DT")
3020730
"^DD",9002313.02,9002313.0201,452,0)
Compound Route of Admin^F^^450;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,452,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,452,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,452,21,1,0)
Code for the route of
"^DD",9002313.02,9002313.0201,452,21,2,0)
administration of the complete
"^DD",9002313.02,9002313.0201,452,21,3,0)
compound mixture.
"^DD",9002313.02,9002313.0201,452,"DT")
3020730
"^DD",9002313.02,9002313.0201,453,0)
Orig Pres/Serv ID Qual^F^^450;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,453,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,453,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,453,21,1,0)
Code qualifying the value in 'Originally Prescribed
"^DD",9002313.02,9002313.0201,453,21,2,0)
Product/Service Code  (Field 445-EA).
"^DD",9002313.02,9002313.0201,453,"DT")
3020730
"^DD",9002313.02,9002313.0201,454,0)
Scheduled Pres ID Number^F^^450;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,454,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.0201,454,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,454,21,1,0)
The serial number of the prescription blank/form.
"^DD",9002313.02,9002313.0201,454,"DT")
3020730
"^DD",9002313.02,9002313.0201,455,0)
Pres/Srv Ref Number Qual^F^^450;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,455,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,455,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,455,21,1,0)
Indicates the type of billing submitted.
"^DD",9002313.02,9002313.0201,455,"DT")
3020730
"^DD",9002313.02,9002313.0201,456,0)
Assoc Pres/Srv Ref Number^F^^450;6^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.02,9002313.0201,456,3)
Answer must be 7 characters in length.
"^DD",9002313.02,9002313.0201,456,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,456,21,1,0)
Related  Prescription/Service Reference Number  (42-D2)
"^DD",9002313.02,9002313.0201,456,21,2,0)
to which the service is associated.
"^DD",9002313.02,9002313.0201,456,"DT")
3020730
"^DD",9002313.02,9002313.0201,457,0)
Assoc Pres/Srv Date^F^^450;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,457,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,457,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,457,21,1,0)
Date of the Associated Prescription/Service Reference Number.
"^DD",9002313.02,9002313.0201,457,"DT")
3020730
"^DD",9002313.02,9002313.0201,458,0)
Procedure Mod Code Cnt^F^^450;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,458,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,458,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,458,21,1,0)
Count of the  Procedure
"^DD",9002313.02,9002313.0201,458,21,2,0)
Modifier Code  (459-ER)
"^DD",9002313.02,9002313.0201,458,21,3,0)
occurrences.
"^DD",9002313.02,9002313.0201,458,"DT")
3020730
"^DD",9002313.02,9002313.0201,459,0)
Procedure Modifier Code^9002313.201459A^^459;0
"^DD",9002313.02,9002313.0201,459,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0201,459,21,1,0)
Multiple for storing procedure code information.
"^DD",9002313.02,9002313.0201,460,0)
Quantity Prescribed^F^^450;10^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,460,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,460,21,0)
^^1^1^3070625^
"^DD",9002313.02,9002313.0201,460,21,1,0)
Quantity prescribed during order entry.
"^DD",9002313.02,9002313.0201,460,"DT")
3070625
"^DD",9002313.02,9002313.0201,461,0)
Prior Authorization Type Code^F^^460;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,461,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0201,461,21,0)
^.001^1^1^3070316^^
"^DD",9002313.02,9002313.0201,461,21,1,0)
Code clarifying the  Prior Authorization Number  (462- EV).
"^DD",9002313.02,9002313.0201,461,"DT")
3070316
"^DD",9002313.02,9002313.0201,462,0)
Prior Authorization Num Sub^F^^460;2^K:$L(X)>13!($L(X)<13) X
"^DD",9002313.02,9002313.0201,462,3)
Answer must be 13 characters in length.
"^DD",9002313.02,9002313.0201,462,21,0)
^.001^3^3^3070316^^
"^DD",9002313.02,9002313.0201,462,21,1,0)
Number submitted by the
"^DD",9002313.02,9002313.0201,462,21,2,0)
provider to identify the prior
"^DD",9002313.02,9002313.0201,462,21,3,0)
authorization.
"^DD",9002313.02,9002313.0201,462,"DT")
3070316
"^DD",9002313.02,9002313.0201,463,0)
Intermediary Auth Type ID^F^^460;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,463,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,463,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,463,21,1,0)
Value indicating that
"^DD",9002313.02,9002313.0201,463,21,2,0)
authorization occurred for
"^DD",9002313.02,9002313.0201,463,21,3,0)
intermediary processing.
"^DD",9002313.02,9002313.0201,463,"DT")
3020730
"^DD",9002313.02,9002313.0201,464,0)
Intermediary Auth ID^F^^460;4^K:$L(X)>11!($L(X)<11) X
"^DD",9002313.02,9002313.0201,464,3)
Answer must be 11 characters in length.
"^DD",9002313.02,9002313.0201,464,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,464,21,1,0)
Value indicating intermediary
"^DD",9002313.02,9002313.0201,464,21,2,0)
authorization occurred.
"^DD",9002313.02,9002313.0201,464,"DT")
3020730
"^DD",9002313.02,9002313.0201,465,0)
Provider ID Qualifier^F^^460;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,465,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,465,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,465,21,1,0)
Code qualifying the  Provider ID  (444-E9).
"^DD",9002313.02,9002313.0201,465,"DT")
3020730
"^DD",9002313.02,9002313.0201,466,0)
Prescriber ID Qualifier^F^^460;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,466,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,466,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,466,21,1,0)
Code qualifying the  Prescriber ID  (411-DB).
"^DD",9002313.02,9002313.0201,466,"DT")
3020730
"^DD",9002313.02,9002313.0201,467,0)
Prescriber Location Code^F^^460;7^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,467,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,467,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.0201,467,21,1,0)
Location address code
"^DD",9002313.02,9002313.0201,467,21,2,0)
assigned to the prescriber as
"^DD",9002313.02,9002313.0201,467,21,3,0)
identified in the National
"^DD",9002313.02,9002313.0201,467,21,4,0)
Provider System (NPS).
"^DD",9002313.02,9002313.0201,467,"DT")
3020730
"^DD",9002313.02,9002313.0201,468,0)
Primary Care Prov ID Qual^F^^460;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,468,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,468,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,468,21,1,0)
Code qualifying the  Primary Care Provider ID  (421-DL).
"^DD",9002313.02,9002313.0201,468,"DT")
3020730
"^DD",9002313.02,9002313.0201,469,0)
Primary Care Prov Loc Cd^F^^460;9^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,469,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,469,21,0)
^.001^5^5^3031216^^
"^DD",9002313.02,9002313.0201,469,21,1,0)
Location address code
"^DD",9002313.02,9002313.0201,469,21,2,0)
assigned to the primary care
"^DD",9002313.02,9002313.0201,469,21,3,0)
provider as identified in the
"^DD",9002313.02,9002313.0201,469,21,4,0)
National Provider System
"^DD",9002313.02,9002313.0201,469,21,5,0)
(NPS).
"^DD",9002313.02,9002313.0201,469,"DT")
3020730
"^DD",9002313.02,9002313.0201,470,0)
Primary Care Prov Last Name^F^^460;10^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,470,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,470,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0201,470,21,1,0)
Last name of the Primary Care Provider
"^DD",9002313.02,9002313.0201,470,"DT")
3020730
"^DD",9002313.02,9002313.0201,471,0)
Other Payer Reject Count^F^^470;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,471,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,471,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,471,21,1,0)
Count of  Other Payer Reject Code  (472-6E) occurrences.
"^DD",9002313.02,9002313.0201,471,"DT")
3020730
"^DD",9002313.02,9002313.0201,473.01,0)
DUR/PPS Repeating Fields^9002313.1001A^^473.01;0
"^DD",9002313.02,9002313.0201,473.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,473.01,21,1,0)
Count of Drug Utilization sub-records.
"^DD",9002313.02,9002313.0201,477,0)
Professional Srv Fee Submitted^F^^470;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,477,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,477,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,477,21,1,0)
Amount submitted by the
"^DD",9002313.02,9002313.0201,477,21,2,0)
provider for professional
"^DD",9002313.02,9002313.0201,477,21,3,0)
services rendered.
"^DD",9002313.02,9002313.0201,477,"DT")
3020730
"^DD",9002313.02,9002313.0201,478,0)
Other Amt Claimed Sub Cnt^F^^470;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,478,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,478,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,478,21,1,0)
Count of other amount claimed submitted occurrences.
"^DD",9002313.02,9002313.0201,478,"DT")
3020730
"^DD",9002313.02,9002313.0201,478.01,0)
Pricing Repeating Section^9002313.0601A^^478.01;0
"^DD",9002313.02,9002313.0201,478.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,478.01,21,1,0)
Pricing record information counter.
"^DD",9002313.02,9002313.0201,481,0)
Flat Sales Tax Amt Sub^F^^480;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,481,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,481,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,481,21,1,0)
Flat sales tax submitted for prescription. This amount is
"^DD",9002313.02,9002313.0201,481,21,2,0)
included in the  Gross Amount Due  (43-DU).
"^DD",9002313.02,9002313.0201,481,"DT")
3020730
"^DD",9002313.02,9002313.0201,482,0)
Percentage Sales Tax Amt Sub^F^^480;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,482,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,482,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,482,21,1,0)
Percentage sales tax submitted.
"^DD",9002313.02,9002313.0201,482,"DT")
3020730
"^DD",9002313.02,9002313.0201,483,0)
Percentage Sales Tax Rate Sub^F^^480;3^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.02,9002313.0201,483,3)
Answer must be 7 characters in length.
"^DD",9002313.02,9002313.0201,483,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,483,21,1,0)
Percentage sales tax rate used to calculate  Percentage Sales
"^DD",9002313.02,9002313.0201,483,21,2,0)
Tax Amount Submitted  (482- GE
"^DD",9002313.02,9002313.0201,483,"DT")
3020730
"^DD",9002313.02,9002313.0201,484,0)
Percentage Sales Tax Basis Sub^F^^480;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,484,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,484,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,484,21,1,0)
Code indicating the basis for percentage sales tax.
"^DD",9002313.02,9002313.0201,484,"DT")
3020730
"^DD",9002313.02,9002313.0201,485,0)
Coupon Type^F^^480;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,485,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,485,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,485,21,1,0)
Code indicating the type of coupon being used.
"^DD",9002313.02,9002313.0201,485,"DT")
3020730
"^DD",9002313.02,9002313.0201,486,0)
Coupon Number^F^^480;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,486,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,486,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,486,21,1,0)
Unique serial number assigned to the prescription coupons.
"^DD",9002313.02,9002313.0201,486,"DT")
3020730
"^DD",9002313.02,9002313.0201,487,0)
Coupon Value Amount^F^^480;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,487,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,487,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,487,21,1,0)
Value of the coupon.
"^DD",9002313.02,9002313.0201,487,"DT")
3020730
"^DD",9002313.02,9002313.0201,491,0)
Diagnosis Code Count^F^^490;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,491,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,491,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,491,21,1,0)
Count of diagnosis occurrences.
"^DD",9002313.02,9002313.0201,491,"DT")
3020730
"^DD",9002313.02,9002313.0201,491.01,0)
Clinical Diagnosis Repeating^9002313.0701A^^491.01;0
"^DD",9002313.02,9002313.0201,491.01,21,0)
^.001^1^1^3040126^^^
"^DD",9002313.02,9002313.0201,491.01,21,1,0)
Count of Diagnosis sub-records.
"^DD",9002313.02,9002313.0201,493.01,0)
Clinical Information Repeating^9002313.0801A^^493.01;0
"^DD",9002313.02,9002313.0201,493.01,21,0)
^.001^1^1^3040126^^^
"^DD",9002313.02,9002313.0201,493.01,21,1,0)
Count of clinical information sub-records.
"^DD",9002313.02,9002313.0201,498.01,0)
Request Type^F^^498;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,498.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,498.01,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.01,21,1,0)
Code identifying type of prior
"^DD",9002313.02,9002313.0201,498.01,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.01,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.02,0)
Request Period Date-Begin^F^^498;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,498.02,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,498.02,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.02,21,1,0)
Beginning date for a prior
"^DD",9002313.02,9002313.0201,498.02,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.02,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.03,0)
Request Period Date-End^F^^498;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,498.03,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,498.03,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.03,21,1,0)
End date for a prior
"^DD",9002313.02,9002313.0201,498.03,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.03,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.04,0)
Basis of Request^F^^498;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,498.04,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,498.04,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.04,21,1,0)
Code describing the reason for
"^DD",9002313.02,9002313.0201,498.04,21,2,0)
prior authorization request.
"^DD",9002313.02,9002313.0201,498.04,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.05,0)
Authorized Rep First Name^F^^498;5^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,498.05,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.0201,498.05,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.05,21,1,0)
First name of the patients authorized representative.
"^DD",9002313.02,9002313.0201,498.05,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.06,0)
Authorized Rep Last Name^F^^498;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,498.06,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,498.06,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.06,21,1,0)
Last name of the patients authorized representative.
"^DD",9002313.02,9002313.0201,498.06,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.07,0)
Authorized Rep Street Address^F^^498;7^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,498.07,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,498.07,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.07,21,1,0)
Free-form text for address information.
"^DD",9002313.02,9002313.0201,498.07,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.08,0)
Authorized Rep City Address^F^^498;8^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,498.08,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,498.08,21,0)
^.001^1^1^3031204^^
"^DD",9002313.02,9002313.0201,498.08,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.0201,498.08,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.09,0)
Authorized Rep State/Prov^F^^498;9^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,498.09,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,498.09,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.0201,498.09,21,1,0)
Authorized Rep's State or Province
"^DD",9002313.02,9002313.0201,498.09,"DT")
3040331
"^DD",9002313.02,9002313.0201,498.11,0)
Authorized Rep Zip/Postal Zone^F^^498;11^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,498.11,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,498.11,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.0201,498.11,21,1,0)
Authorized Rep's Zip Code
"^DD",9002313.02,9002313.0201,498.11,"DT")
3040331
"^DD",9002313.02,9002313.0201,498.12,0)
Prescriber Phone Number^F^^498;12^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,498.12,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,498.12,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.12,21,1,0)
Ten digit phone number of the
"^DD",9002313.02,9002313.0201,498.12,21,2,0)
prescriber.
"^DD",9002313.02,9002313.0201,498.12,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.13,0)
Prior Auth Supporting Doc^9002313.0901^^498.13;0
"^DD",9002313.02,9002313.0201,498.14,0)
Prior Auth Number Assigned^F^^498;14^K:$L(X)>11!($L(X)<11) X
"^DD",9002313.02,9002313.0201,498.14,3)
Answer must be 11 characters in length.
"^DD",9002313.02,9002313.0201,498.14,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,498.14,21,1,0)
Unique number identifying the
"^DD",9002313.02,9002313.0201,498.14,21,2,0)
prior authorization assigned by
"^DD",9002313.02,9002313.0201,498.14,21,3,0)
the processor.
"^DD",9002313.02,9002313.0201,498.14,"DT")
3020730
"^DD",9002313.02,9002313.0201,503,0)
Authorization Number^F^^500;3^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,503,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,503,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,503,21,1,0)
Unique number identifying the
"^DD",9002313.02,9002313.0201,503,21,2,0)
prior authorization assigned by
"^DD",9002313.02,9002313.0201,503,21,3,0)
the processor.
"^DD",9002313.02,9002313.0201,503,"DT")
3020730
"^DD",9002313.02,9002313.0201,600,0)
Unit of Measure^F^^600;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,600,3)
Enter the Unit of Measure (4 characters)
"^DD",9002313.02,9002313.0201,600,21,0)
^^1^1^3070625^
"^DD",9002313.02,9002313.0201,600,21,1,0)
Unit of measure of the prescription.
"^DD",9002313.02,9002313.0201,600,"DT")
3070625
"^DD",9002313.02,9002313.0401,0)
COB/Other Payments   SUB-FIELD^^472^9
"^DD",9002313.02,9002313.0401,0,"DT")
3020731
"^DD",9002313.02,9002313.0401,0,"IX","B",9002313.0401,.01)

"^DD",9002313.02,9002313.0401,0,"NM","COB/Other Payments  ")

"^DD",9002313.02,9002313.0401,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0401,.01,0)
COB/Other Paymnt Cntr^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0401,.01,1,0)
^.1
"^DD",9002313.02,9002313.0401,.01,1,1,0)
9002313.0401^B
"^DD",9002313.02,9002313.0401,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0401,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0401,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0401,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,.01,21,1,0)
Count of other payment occurrences.
"^DD",9002313.02,9002313.0401,.01,"DT")
3031125
"^DD",9002313.02,9002313.0401,338,0)
Other Payer Coverage Type^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,338,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,338,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,338,21,1,0)
Code identifying the type of 'Other Payer ID' (34).
"^DD",9002313.02,9002313.0401,338,"DT")
3031125
"^DD",9002313.02,9002313.0401,339,0)
Other Payer ID Qualifier^F^^0;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,339,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,339,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,339,21,1,0)
Code qualifying  the 'Other Payer ID' (34).
"^DD",9002313.02,9002313.0401,339,"DT")
3031125
"^DD",9002313.02,9002313.0401,340,0)
Other Payer ID^F^^0;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0401,340,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0401,340,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,340,21,1,0)
ID assigned to the payer.
"^DD",9002313.02,9002313.0401,340,"DT")
3031125
"^DD",9002313.02,9002313.0401,341,0)
Other Payer Amt Paid Cnt^F^^0;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0401,341,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0401,341,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,341,21,1,0)
Count of the payer amount paid occurrences.
"^DD",9002313.02,9002313.0401,341,"DT")
3031125
"^DD",9002313.02,9002313.0401,342,0)
Other Payer Amt Paid Qual^9002313.401342A^^1;0
"^DD",9002313.02,9002313.0401,443,0)
Other Payer Date^F^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0401,443,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0401,443,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.0401,443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used 
"^DD",9002313.02,9002313.0401,443,21,2,0)
for coordination of benefits.
"^DD",9002313.02,9002313.0401,443,"DT")
3031125
"^DD",9002313.02,9002313.0401,471,0)
Other Payer Reject Count^F^^0;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,471,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,471,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,471,21,1,0)
Count of 'Other Payer Reject Code' (472) occurrences.
"^DD",9002313.02,9002313.0401,471,"DT")
3031125
"^DD",9002313.02,9002313.0401,472,0)
Other Payer Reject Code^9002313.401472A^^2;0
"^DD",9002313.02,9002313.0501,0)
Compound Repeating Fields SUB-FIELD^^490^6
"^DD",9002313.02,9002313.0501,0,"DT")
3020731
"^DD",9002313.02,9002313.0501,0,"IX","B",9002313.0501,.01)

"^DD",9002313.02,9002313.0501,0,"NM","Compound Repeating Fields")

"^DD",9002313.02,9002313.0501,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0501,.01,0)
Compound Repeating Count^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0501,.01,1,0)
^.1
"^DD",9002313.02,9002313.0501,.01,1,1,0)
9002313.0501^B
"^DD",9002313.02,9002313.0501,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0501,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0501,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0501,.01,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0501,.01,21,1,0)
Count of Compounds for this medication.
"^DD",9002313.02,9002313.0501,.01,"DT")
3020801
"^DD",9002313.02,9002313.0501,448,0)
Compound Ingredient Quantity^F^^0;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0501,448,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0501,448,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0501,448,21,1,0)
Amount expressed in metric
"^DD",9002313.02,9002313.0501,448,21,2,0)
decimal units of the product
"^DD",9002313.02,9002313.0501,448,21,3,0)
included in the compound
"^DD",9002313.02,9002313.0501,448,21,4,0)
mixture
"^DD",9002313.02,9002313.0501,448,"DT")
3020731
"^DD",9002313.02,9002313.0501,449,0)
Compound Ingredient Drug Cost^F^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0501,449,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0501,449,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0501,449,21,1,0)
Ingredient cost for the metric decimal quantity of the product
"^DD",9002313.02,9002313.0501,449,21,2,0)
included in the compound mixture indicated in Compound Ingredient
"^DD",9002313.02,9002313.0501,449,21,3,0)
Quantity  (Field 448-ED).
"^DD",9002313.02,9002313.0501,449,"DT")
3020731
"^DD",9002313.02,9002313.0501,488,0)
Compound Product ID Qualifier^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0501,488,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0501,488,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0501,488,21,1,0)
Code qualifying the type of
"^DD",9002313.02,9002313.0501,488,21,2,0)
product dispensed.
"^DD",9002313.02,9002313.0501,488,"DT")
3020731
"^DD",9002313.02,9002313.0501,489,0)
Compound Product ID  ^F^^0;3^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.0501,489,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.0501,489,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0501,489,21,1,0)
Product identification of an
"^DD",9002313.02,9002313.0501,489,21,2,0)
ingredient used in a
"^DD",9002313.02,9002313.0501,489,21,3,0)
compound.
"^DD",9002313.02,9002313.0501,489,"DT")
3020731
"^DD",9002313.02,9002313.0501,490,0)
Compound Ingred Basis of Cost^F^^0;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0501,490,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0501,490,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0501,490,21,1,0)
The code for the method of determining the
"^DD",9002313.02,9002313.0501,490,21,2,0)
amount charged.
"^DD",9002313.02,9002313.0501,490,"DT")
3020731
"^DD",9002313.02,9002313.0601,0)
Pricing Repeating Section SUB-FIELD^^480^3
"^DD",9002313.02,9002313.0601,0,"DT")
3020801
"^DD",9002313.02,9002313.0601,0,"IX","B",9002313.0601,.01)

"^DD",9002313.02,9002313.0601,0,"NM","Pricing Repeating Section")

"^DD",9002313.02,9002313.0601,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0601,.01,0)
Pricing Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0601,.01,1,0)
^.1
"^DD",9002313.02,9002313.0601,.01,1,1,0)
9002313.0601^B
"^DD",9002313.02,9002313.0601,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0601,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0601,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0601,.01,21,0)
^^2^2^3040126^
"^DD",9002313.02,9002313.0601,.01,21,1,0)
The number of pricing entries in the sub file.  Used for coordination of
"^DD",9002313.02,9002313.0601,.01,21,2,0)
benefits.
"^DD",9002313.02,9002313.0601,.01,"DT")
3020801
"^DD",9002313.02,9002313.0601,479,0)
Other Amt Claimed Sub Qual^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0601,479,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0601,479,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.0601,479,21,1,0)
Code identifying the additional
"^DD",9002313.02,9002313.0601,479,21,2,0)
incurred cost claimed in  Other
"^DD",9002313.02,9002313.0601,479,21,3,0)
Amount Claimed Submitted 
"^DD",9002313.02,9002313.0601,479,21,4,0)
(48-H9).
"^DD",9002313.02,9002313.0601,479,"DT")
3020801
"^DD",9002313.02,9002313.0601,480,0)
Other Amt Claimed Sub  ^F^^0;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0601,480,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0601,480,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0601,480,21,1,0)
Other amount claimed subtotal
"^DD",9002313.02,9002313.0601,480,"DT")
3020801
"^DD",9002313.02,9002313.0701,0)
Clinical Diagnosis Repeating SUB-FIELD^^492^3
"^DD",9002313.02,9002313.0701,0,"DT")
3020801
"^DD",9002313.02,9002313.0701,0,"IX","B",9002313.0701,.01)

"^DD",9002313.02,9002313.0701,0,"NM","Clinical Diagnosis Repeating")

"^DD",9002313.02,9002313.0701,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0701,.01,0)
Diagnosis Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0701,.01,1,0)
^.1
"^DD",9002313.02,9002313.0701,.01,1,1,0)
9002313.0701^B
"^DD",9002313.02,9002313.0701,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0701,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0701,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0701,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0701,.01,21,1,0)
The number of diagnosis codes defined for this medication order.
"^DD",9002313.02,9002313.0701,.01,"DT")
3020801
"^DD",9002313.02,9002313.0701,424,0)
Diagnosis Code  ^F^^0;3^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0701,424,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0701,424,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0701,424,21,1,0)
Code identifying the diagnosis of the patient.
"^DD",9002313.02,9002313.0701,424,"DT")
3020801
"^DD",9002313.02,9002313.0701,492,0)
Dianosis Code Qualifier^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0701,492,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0701,492,21,0)
^^18^18^3031204^
"^DD",9002313.02,9002313.0701,492,21,1,0)
Code qualifying the  Diagnosis Code  (424-DO).
"^DD",9002313.02,9002313.0701,492,21,2,0)
 
"^DD",9002313.02,9002313.0701,492,21,3,0)
Blank=Not Specified
"^DD",9002313.02,9002313.0701,492,21,4,0)
=Not Specified
"^DD",9002313.02,9002313.0701,492,21,5,0)
1=International Classification of Diseases
"^DD",9002313.02,9002313.0701,492,21,6,0)
(ICD9)
"^DD",9002313.02,9002313.0701,492,21,7,0)
2=International Classification of Diseases
"^DD",9002313.02,9002313.0701,492,21,8,0)
(ICD1)
"^DD",9002313.02,9002313.0701,492,21,9,0)
3=National Criteria Care Institute (NCCI)
"^DD",9002313.02,9002313.0701,492,21,10,0)
4=The Systematized Nomenclature of
"^DD",9002313.02,9002313.0701,492,21,11,0)
Human and Veterinary Medicine
"^DD",9002313.02,9002313.0701,492,21,12,0)
(SNOMED)
"^DD",9002313.02,9002313.0701,492,21,13,0)
5=Common Dental Terminology (CDT)
"^DD",9002313.02,9002313.0701,492,21,14,0)
6=Medi-Span Diagnosis Code
"^DD",9002313.02,9002313.0701,492,21,15,0)
7=American Psychiatric Association
"^DD",9002313.02,9002313.0701,492,21,16,0)
Diagnostic Statistical Manual of Mental
"^DD",9002313.02,9002313.0701,492,21,17,0)
Disorders(DSM IV)
"^DD",9002313.02,9002313.0701,492,21,18,0)
99=Other
"^DD",9002313.02,9002313.0701,492,"DT")
3020801
"^DD",9002313.02,9002313.0801,0)
Clinical Information Repeating SUB-FIELD^^499^6
"^DD",9002313.02,9002313.0801,0,"DT")
3020801
"^DD",9002313.02,9002313.0801,0,"IX","B",9002313.0801,.01)

"^DD",9002313.02,9002313.0801,0,"NM","Clinical Information Repeating")

"^DD",9002313.02,9002313.0801,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0801,.01,0)
(493) Clinical Info Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0801,.01,1,0)
^.1
"^DD",9002313.02,9002313.0801,.01,1,1,0)
9002313.0801^B
"^DD",9002313.02,9002313.0801,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0801,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0801,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0801,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0801,.01,21,1,0)
The number of clinical indicator records for the medication order.
"^DD",9002313.02,9002313.0801,.01,"DT")
3020820
"^DD",9002313.02,9002313.0801,494,0)
Measurement Date^F^^0;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0801,494,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0801,494,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,494,21,1,0)
Date clinical information was collected or measured.
"^DD",9002313.02,9002313.0801,494,"DT")
3020801
"^DD",9002313.02,9002313.0801,495,0)
Measurement Time^F^^0;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0801,495,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0801,495,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,495,21,1,0)
Time clinical information was collected or measured.
"^DD",9002313.02,9002313.0801,495,"DT")
3020801
"^DD",9002313.02,9002313.0801,496,0)
Measurement Dimension^F^^0;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0801,496,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0801,496,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0801,496,21,1,0)
Code indicating the clinical domain of the observed value
"^DD",9002313.02,9002313.0801,496,21,2,0)
in  Measurement Value  (499- H4).
"^DD",9002313.02,9002313.0801,496,"DT")
3020801
"^DD",9002313.02,9002313.0801,497,0)
Measurement Unit^F^^0;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0801,497,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0801,497,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0801,497,21,1,0)
Code indicating the metric or English units used with the
"^DD",9002313.02,9002313.0801,497,21,2,0)
clinical information.
"^DD",9002313.02,9002313.0801,497,"DT")
3020801
"^DD",9002313.02,9002313.0801,499,0)
Measurement Value^F^^0;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0801,499,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0801,499,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,499,21,1,0)
Actual value of clinical information.
"^DD",9002313.02,9002313.0801,499,"DT")
3020801
"^DD",9002313.02,9002313.0901,0)
Prior Auth Supporting Doc SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.0901,0,"DT")
3020801
"^DD",9002313.02,9002313.0901,0,"NM","Prior Auth Supporting Doc")

"^DD",9002313.02,9002313.0901,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0901,.01,0)
Prior Auth Supporting Doc^WL^^0;1^Q
"^DD",9002313.02,9002313.0901,.01,"DT")
3020801
"^DD",9002313.02,9002313.1001,0)
DUR/PPS Repeating Fields SUB-FIELD^^476^7
"^DD",9002313.02,9002313.1001,0,"DT")
3020801
"^DD",9002313.02,9002313.1001,0,"IX","B",9002313.1001,.01)

"^DD",9002313.02,9002313.1001,0,"NM","DUR/PPS Repeating Fields")

"^DD",9002313.02,9002313.1001,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.1001,.01,0)
(473) DUR/PPS Code Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.1001,.01,1,0)
^.1
"^DD",9002313.02,9002313.1001,.01,1,1,0)
9002313.1001^B
"^DD",9002313.02,9002313.1001,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.1001,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.1001,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.1001,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.1001,.01,21,1,0)
The number of DUR messages that were returned in the response message.
"^DD",9002313.02,9002313.1001,.01,"DT")
3020820
"^DD",9002313.02,9002313.1001,439,0)
Reason for Service Code^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,439,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,439,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,439,21,1,0)
Code identifying the type of
"^DD",9002313.02,9002313.1001,439,21,2,0)
utilization conflict detected or
"^DD",9002313.02,9002313.1001,439,21,3,0)
the reason for the pharmacist s
"^DD",9002313.02,9002313.1001,439,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,439,"DT")
3020801
"^DD",9002313.02,9002313.1001,440,0)
Professional Service Code^F^^0;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,440,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,440,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,440,21,1,0)
Code identifying the type of
"^DD",9002313.02,9002313.1001,440,21,2,0)
utilization conflict detected or
"^DD",9002313.02,9002313.1001,440,21,3,0)
the reason for the pharmacist s
"^DD",9002313.02,9002313.1001,440,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,440,"DT")
3020801
"^DD",9002313.02,9002313.1001,441,0)
Result of Service Code^F^^0;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,441,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,441,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,441,21,1,0)
Action taken by a pharmacist
"^DD",9002313.02,9002313.1001,441,21,2,0)
in response to a conflict or the
"^DD",9002313.02,9002313.1001,441,21,3,0)
result of a pharmacist s
"^DD",9002313.02,9002313.1001,441,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,441,"DT")
3020801
"^DD",9002313.02,9002313.1001,474,0)
DUR/PPS Level of Effort^F^^0;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,474,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,474,21,0)
^^6^6^3031204^
"^DD",9002313.02,9002313.1001,474,21,1,0)
Code indicating the level of
"^DD",9002313.02,9002313.1001,474,21,2,0)
effort as determined by the
"^DD",9002313.02,9002313.1001,474,21,3,0)
complexity of decision making
"^DD",9002313.02,9002313.1001,474,21,4,0)
or resources utilized by a
"^DD",9002313.02,9002313.1001,474,21,5,0)
pharmacist to perform a
"^DD",9002313.02,9002313.1001,474,21,6,0)
professional service
"^DD",9002313.02,9002313.1001,474,"DT")
3020801
"^DD",9002313.02,9002313.1001,475,0)
DUR Co-Agent ID Qualifier^F^^0;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,475,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,475,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.1001,475,21,1,0)
Code qualifying the value in DUR Co-Agent ID  (476-H6).
"^DD",9002313.02,9002313.1001,475,"DT")
3020801
"^DD",9002313.02,9002313.1001,476,0)
DUR Co-Agent ID  ^F^^0;7^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.1001,476,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.1001,476,21,0)
^^6^6^3031204^
"^DD",9002313.02,9002313.1001,476,21,1,0)
Identifies the co-existing agent
"^DD",9002313.02,9002313.1001,476,21,2,0)
contributing to the DUR event
"^DD",9002313.02,9002313.1001,476,21,3,0)
(drug or disease conflicting
"^DD",9002313.02,9002313.1001,476,21,4,0)
with the prescribed drug or
"^DD",9002313.02,9002313.1001,476,21,5,0)
prompting pharmacist
"^DD",9002313.02,9002313.1001,476,21,6,0)
professional service).
"^DD",9002313.02,9002313.1001,476,"DT")
3020801
"^DD",9002313.02,9002313.201459,0)
Procedure Modifier Code SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.201459,0,"DT")
3020801
"^DD",9002313.02,9002313.201459,0,"IX","B",9002313.201459,.01)

"^DD",9002313.02,9002313.201459,0,"NM","Procedure Modifier Code")

"^DD",9002313.02,9002313.201459,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.201459,.01,0)
Procedure Modifier Code^F^^0;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.201459,.01,1,0)
^.1
"^DD",9002313.02,9002313.201459,.01,1,1,0)
9002313.201459^B
"^DD",9002313.02,9002313.201459,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.201459,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.201459,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.201459,.01,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.201459,.01,21,1,0)
Count of the  Procedure
"^DD",9002313.02,9002313.201459,.01,21,2,0)
Modifier Code  (459-ER)
"^DD",9002313.02,9002313.201459,.01,21,3,0)
occurrences.
"^DD",9002313.02,9002313.201459,.01,"DT")
3020801
"^DD",9002313.02,9002313.29999,0)
RAW DATA SENT SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.29999,0,"DT")
3000830
"^DD",9002313.02,9002313.29999,0,"NM","RAW DATA SENT")

"^DD",9002313.02,9002313.29999,0,"UP")
9002313.02
"^DD",9002313.02,9002313.29999,.01,0)
RAW DATA SENT^WL^^0;1^Q
"^DD",9002313.02,9002313.29999,.01,21,0)
^^4^4^3031124^^
"^DD",9002313.02,9002313.29999,.01,21,1,0)
A copy of the raw packet is saved here.
"^DD",9002313.02,9002313.29999,.01,21,2,0)
It's intended to be of help in times of dispute.
"^DD",9002313.02,9002313.29999,.01,21,3,0)
This field could be winnowed before the rest of the 9002313.02 is winnowed.
"^DD",9002313.02,9002313.29999,.01,21,4,0)
For instance, it might make sense to only keep a month of these around.
"^DD",9002313.02,9002313.29999,.01,"DT")
3031124
"^DD",9002313.02,9002313.401342,0)
Other Payer Amt Paid Qual SUB-FIELD^^431^2
"^DD",9002313.02,9002313.401342,0,"DT")
3020731
"^DD",9002313.02,9002313.401342,0,"IX","B",9002313.401342,.01)

"^DD",9002313.02,9002313.401342,0,"NM","Other Payer Amt Paid Qual")

"^DD",9002313.02,9002313.401342,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401342,.01,0)
Other Payer Amt Paid Qual^F^^0;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.401342,.01,1,0)
^.1
"^DD",9002313.02,9002313.401342,.01,1,1,0)
9002313.401342^B
"^DD",9002313.02,9002313.401342,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401342,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401342,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.401342,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.401342,.01,21,1,0)
Code qualifying the 'Other Payer Amount Paid' (431).
"^DD",9002313.02,9002313.401342,.01,"DT")
3031125
"^DD",9002313.02,9002313.401342,431,0)
Other Payer Amount Paid^F^^0;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.401342,431,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.401342,431,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.401342,431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including 
"^DD",9002313.02,9002313.401342,431,21,2,0)
coupons).
"^DD",9002313.02,9002313.401342,431,"DT")
3031125
"^DD",9002313.02,9002313.401472,0)
Other Payer Reject Code SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.401472,0,"DT")
3020731
"^DD",9002313.02,9002313.401472,0,"IX","B",9002313.401472,.01)

"^DD",9002313.02,9002313.401472,0,"NM","Other Payer Reject Code")

"^DD",9002313.02,9002313.401472,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401472,.01,0)
Other Payer Reject Code^F^^0;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.401472,.01,1,0)
^.1
"^DD",9002313.02,9002313.401472,.01,1,1,0)
9002313.401472^B
"^DD",9002313.02,9002313.401472,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401472,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401472,.01,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.401472,.01,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.401472,.01,21,1,0)
The error encountered by the previous "Other Payer" in 'Reject Code' 
"^DD",9002313.02,9002313.401472,.01,21,2,0)
(511).
"^DD",9002313.02,9002313.401472,.01,"DT")
3031125
"^DD",9002313.12,9002313.12,0)
FIELD^^10^3
"^DD",9002313.12,9002313.12,0,"DDA")
N
"^DD",9002313.12,9002313.12,0,"DT")
3061114
"^DD",9002313.12,9002313.12,0,"IX","AC",9002313.12,.02)

"^DD",9002313.12,9002313.12,0,"IX","B",9002313.12,.01)

"^DD",9002313.12,9002313.12,0,"NM","BPS LOG")

"^DD",9002313.12,9002313.12,0,"VRPK")
BPS
"^DD",9002313.12,9002313.12,.01,0)
LOG NAME^RF^^0;1^K:$L(X)>20!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.12,9002313.12,.01,1,0)
^.1
"^DD",9002313.12,9002313.12,.01,1,1,0)
9002313.12^B
"^DD",9002313.12,9002313.12,.01,1,1,1)
S ^BPS(9002313.12,"B",$E(X,1,30),DA)=""
"^DD",9002313.12,9002313.12,.01,1,1,2)
K ^BPS(9002313.12,"B",$E(X,1,30),DA)
"^DD",9002313.12,9002313.12,.01,3)
Enter the name of the Log
"^DD",9002313.12,9002313.12,.01,21,0)
^^1^1^3061017^
"^DD",9002313.12,9002313.12,.01,21,1,0)
Enter the name for this particular log.
"^DD",9002313.12,9002313.12,.01,"DT")
3061017
"^DD",9002313.12,9002313.12,.02,0)
LAST UPDATE^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.12,9002313.12,.02,1,0)
^.1
"^DD",9002313.12,9002313.12,.02,1,1,0)
9002313.12^AC
"^DD",9002313.12,9002313.12,.02,1,1,1)
S ^BPS(9002313.12,"AC",$E(X,1,30),DA)=""
"^DD",9002313.12,9002313.12,.02,1,1,2)
K ^BPS(9002313.12,"AC",$E(X,1,30),DA)
"^DD",9002313.12,9002313.12,.02,1,1,"DT")
3061113
"^DD",9002313.12,9002313.12,.02,3)
Enter the date/time of the last update
"^DD",9002313.12,9002313.12,.02,21,0)
^^1^1^3061113^
"^DD",9002313.12,9002313.12,.02,21,1,0)
This is the date and time when the log was last updated
"^DD",9002313.12,9002313.12,.02,"DT")
3061113
"^DD",9002313.12,9002313.12,10,0)
LOG ENTRY^9002313.1201D^^10;0
"^DD",9002313.12,9002313.1201,0)
LOG ENTRY SUB-FIELD^^1^2
"^DD",9002313.12,9002313.1201,0,"DT")
3061114
"^DD",9002313.12,9002313.1201,0,"IX","B",9002313.1201,.01)

"^DD",9002313.12,9002313.1201,0,"NM","LOG ENTRY")

"^DD",9002313.12,9002313.1201,0,"UP")
9002313.12
"^DD",9002313.12,9002313.1201,.01,0)
LOG DATE/TIME^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.12,9002313.1201,.01,1,0)
^.1
"^DD",9002313.12,9002313.1201,.01,1,1,0)
9002313.1201^B
"^DD",9002313.12,9002313.1201,.01,1,1,1)
S ^BPS(9002313.12,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.12,9002313.1201,.01,1,1,2)
K ^BPS(9002313.12,DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.12,9002313.1201,.01,3)
Enter the date and time for the log entry
"^DD",9002313.12,9002313.1201,.01,21,0)
^^1^1^3061220^
"^DD",9002313.12,9002313.1201,.01,21,1,0)
This is the date and time that the log entry was created
"^DD",9002313.12,9002313.1201,.01,"DT")
3061220
"^DD",9002313.12,9002313.1201,1,0)
LOG TEXT^F^^1;1^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.12,9002313.1201,1,3)
Enter the log text (up to 200 characters)
"^DD",9002313.12,9002313.1201,1,"DT")
3061114
"^DD",9002313.31,9002313.31,0)
FIELD^^.04^7
"^DD",9002313.31,9002313.31,0,"DT")
3070314
"^DD",9002313.31,9002313.31,0,"IX","B",9002313.31,.01)

"^DD",9002313.31,9002313.31,0,"NM","BPS CERTIFICATION")

"^DD",9002313.31,9002313.31,0,"PT",9002313.57902,902.23)

"^DD",9002313.31,9002313.31,0,"PT",9002313.59902,902.23)

"^DD",9002313.31,9002313.31,0,"VRPK")
BPS
"^DD",9002313.31,9002313.31,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.31,9002313.31,.01,1,0)
^.1
"^DD",9002313.31,9002313.31,.01,1,1,0)
9002313.31^B
"^DD",9002313.31,9002313.31,.01,1,1,1)
S ^BPS(9002313.31,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.31,.01,1,1,2)
K ^BPS(9002313.31,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.31,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.31,9002313.31,.01,21,0)
^^2^2^3040116^
"^DD",9002313.31,9002313.31,.01,21,1,0)
Name of the certification - typically whichever Processor the 
"^DD",9002313.31,9002313.31,.01,21,2,0)
certification is being done for.
"^DD",9002313.31,9002313.31,.01,"DT")
3040116
"^DD",9002313.31,9002313.31,.03,0)
CLAIM^P9002313.02'^BPSC(^0;3^Q
"^DD",9002313.31,9002313.31,.03,3)
Enter the BPS Claim number
"^DD",9002313.31,9002313.31,.03,21,0)
^^1^1^3070314^
"^DD",9002313.31,9002313.31,.03,21,1,0)
This is the last BPS CLAIMS (#9002313.02) record that was created.
"^DD",9002313.31,9002313.31,.03,"DT")
3070314
"^DD",9002313.31,9002313.31,.04,0)
PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.31,9002313.31,.04,3)
Enter the payer sheet to be used for this certification claim
"^DD",9002313.31,9002313.31,.04,21,0)
^^1^1^3070131^
"^DD",9002313.31,9002313.31,.04,21,1,0)
Enter the Payer Sheet to be used for Certification Testing
"^DD",9002313.31,9002313.31,.04,"DT")
3070131
"^DD",9002313.31,9002313.31,1,0)
NCPDP FIELD #^9002313.311PA^^1;0
"^DD",9002313.31,9002313.31,1,21,0)
^.001^2^2^3040120^^^^
"^DD",9002313.31,9002313.31,1,21,1,0)
Contains field information for any NCPDP fields which need to
"^DD",9002313.31,9002313.31,1,21,2,0)
be defaulted.
"^DD",9002313.31,9002313.31,2,0)
RX IN POSITION #^9002313.312A^^2;0
"^DD",9002313.31,9002313.31,2,21,0)
^.001^2^2^3040120^^^^
"^DD",9002313.31,9002313.31,2,21,1,0)
The prescription order when submitting multiple claims in one 
"^DD",9002313.31,9002313.31,2,21,2,0)
transmission.
"^DD",9002313.31,9002313.31,902,0)
VA PINS MULTIPLE^9002313.31902A^^3;0
"^DD",9002313.31,9002313.31,903,0)
PATIENT IEN^P2'^DPT(^4;2^Q
"^DD",9002313.31,9002313.31,903,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.31,903,21,1,0)
Pointer to the patient file to link the patient being used for 
"^DD",9002313.31,9002313.31,903,21,2,0)
certification to the certification being performed.
"^DD",9002313.31,9002313.31,903,"DT")
3031105
"^DD",9002313.31,9002313.311,0)
NCPDP FIELD # SUB-FIELD^^.02^3
"^DD",9002313.31,9002313.311,0,"DT")
3000928
"^DD",9002313.31,9002313.311,0,"IX","B",9002313.311,.01)

"^DD",9002313.31,9002313.311,0,"NM","NCPDP FIELD #")

"^DD",9002313.31,9002313.311,0,"UP")
9002313.31
"^DD",9002313.31,9002313.311,.01,0)
NCPDP FIELD #^MP9002313.91'^BPSF(9002313.91,^0;1^Q
"^DD",9002313.31,9002313.311,.01,1,0)
^.1
"^DD",9002313.31,9002313.311,.01,1,1,0)
9002313.311^B
"^DD",9002313.31,9002313.311,.01,1,1,1)
S ^BPS(9002313.31,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.311,.01,1,1,2)
K ^BPS(9002313.31,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.311,.01,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.311,.01,21,1,0)
Pointer to the NCPDP fields file, for use in defining special values
"^DD",9002313.31,9002313.311,.01,21,2,0)
used only during certification.
"^DD",9002313.31,9002313.311,.01,"DT")
3000928
"^DD",9002313.31,9002313.311,.0199,0)
FIELD NAME^CJ30^^ ; ^X ^DD(9002313.311,.0199,9.3) S X=$P(Y(9002313.311,.0199,101),U,3) S D0=Y(9002313.311,.0199,80) S D1=Y(9002313.311,.0199,81)
"^DD",9002313.31,9002313.311,.0199,9)
^
"^DD",9002313.31,9002313.311,.0199,9.01)
9002313.91^.03;9002313.311^.01
"^DD",9002313.31,9002313.311,.0199,9.1)
NCPDP FIELD #:Name
"^DD",9002313.31,9002313.311,.0199,9.2)
S Y(9002313.311,.0199,81)=$S($D(D1):D1,1:""),Y(9002313.311,.0199,80)=$S($D(D0):D0,1:""),Y(9002313.311,.0199,1)=$S($D(^BPS(9002313.31,D0,1,D1,0)):^(0),1:"")
"^DD",9002313.31,9002313.311,.0199,9.3)
X ^DD(9002313.311,.0199,9.2) S D0=$P(Y(9002313.311,.0199,1),U,1) S:'$D(^BPSF(9002313.91,+D0,0)) D0=-1 S Y(9002313.311,.0199,101)=$S($D(^BPSF(9002313.91,D0,0)):^(0),1:"")
"^DD",9002313.31,9002313.311,.0199,21,0)
^^1^1^3040120^
"^DD",9002313.31,9002313.311,.0199,21,1,0)
The name of the field being used for certification.
"^DD",9002313.31,9002313.311,.0199,"DT")
3001017
"^DD",9002313.31,9002313.311,.02,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.31,9002313.311,.02,3)
Answer must be 1-200 characters in length.
"^DD",9002313.31,9002313.311,.02,21,0)
^^2^2^3040116^
"^DD",9002313.31,9002313.311,.02,21,1,0)
The value (if any) that the certification information should
"^DD",9002313.31,9002313.311,.02,21,2,0)
be defaulted to.
"^DD",9002313.31,9002313.311,.02,"DT")
3000928
"^DD",9002313.31,9002313.312,0)
RX IN POSITION # SUB-FIELD^^1^2
"^DD",9002313.31,9002313.312,0,"DT")
3000928
"^DD",9002313.31,9002313.312,0,"IX","B",9002313.312,.01)

"^DD",9002313.31,9002313.312,0,"NM","RX IN POSITION #")

"^DD",9002313.31,9002313.312,0,"UP")
9002313.31
"^DD",9002313.31,9002313.312,.01,0)
RX IN POSITION #^MNJ1,0^^0;1^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.31,9002313.312,.01,1,0)
^.1
"^DD",9002313.31,9002313.312,.01,1,1,0)
9002313.312^B
"^DD",9002313.31,9002313.312,.01,1,1,1)
S ^BPS(9002313.31,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.312,.01,1,1,2)
K ^BPS(9002313.31,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.312,.01,3)
Type a Number between 1 and 4, 0 Decimal Digits
"^DD",9002313.31,9002313.312,.01,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.312,.01,21,1,0)
The position within the transmission of the particular prescription
"^DD",9002313.31,9002313.312,.01,21,2,0)
that is being certified.
"^DD",9002313.31,9002313.312,.01,"DT")
3000928
"^DD",9002313.31,9002313.312,1,0)
NCPDP FIELD #^9002313.3121PA^^1;0
"^DD",9002313.31,9002313.312,1,21,0)
^^1^1^3040331^
"^DD",9002313.31,9002313.312,1,21,1,0)
The NCPDP field that needs to be defaulted.
"^DD",9002313.31,9002313.3121,0)
NCPDP FIELD # SUB-FIELD^^.02^3
"^DD",9002313.31,9002313.3121,0,"DT")
3000928
"^DD",9002313.31,9002313.3121,0,"IX","B",9002313.3121,.01)

"^DD",9002313.31,9002313.3121,0,"NM","NCPDP FIELD #")

"^DD",9002313.31,9002313.3121,0,"UP")
9002313.312
"^DD",9002313.31,9002313.3121,.01,0)
NCPDP FIELD #^MP9002313.91'^BPSF(9002313.91,^0;1^Q
"^DD",9002313.31,9002313.3121,.01,1,0)
^.1
"^DD",9002313.31,9002313.3121,.01,1,1,0)
9002313.3121^B
"^DD",9002313.31,9002313.3121,.01,1,1,1)
S ^BPS(9002313.31,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.3121,.01,1,1,2)
K ^BPS(9002313.31,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.3121,.01,21,0)
^.001^1^1^3040120^^
"^DD",9002313.31,9002313.3121,.01,21,1,0)
The numeric part of the NCPDP field ID.
"^DD",9002313.31,9002313.3121,.01,"DT")
3000928
"^DD",9002313.31,9002313.3121,.0199,0)
FIELD NAME^CJ30^^ ; ^X ^DD(9002313.3121,.0199,9.4) S X=$P(Y(9002313.3121,.0199,101),U,3) S D0=Y(9002313.3121,.0199,80) S D1=Y(9002313.3121,.0199,81) S D2=Y(9002313.3121,.0199,82)
"^DD",9002313.31,9002313.3121,.0199,9)
^
"^DD",9002313.31,9002313.3121,.0199,9.01)
9002313.91^.03;9002313.3121^.01
"^DD",9002313.31,9002313.3121,.0199,9.1)
NCPDP FIELD #:Name
"^DD",9002313.31,9002313.3121,.0199,9.2)
S Y(9002313.3121,.0199,82)=$S($D(D2):D2,1:""),Y(9002313.3121,.0199,81)=$S($D(D1):D1,1:""),Y(9002313.3121,.0199,80)=$S($D(D0):D0,1:"")
"^DD",9002313.31,9002313.3121,.0199,9.3)
X ^DD(9002313.3121,.0199,9.2) S Y(9002313.3121,.0199,1)=$S($D(^BPS(9002313.31,D0,2,D1,1,D2,0)):^(0),1:"")
"^DD",9002313.31,9002313.3121,.0199,9.4)
X ^DD(9002313.3121,.0199,9.3) S D0=$P(Y(9002313.3121,.0199,1),U,1) S:'$D(^BPSF(9002313.91,+D0,0)) D0=-1 S Y(9002313.3121,.0199,101)=$S($D(^BPSF(9002313.91,D0,0)):^(0),1:"")
"^DD",9002313.31,9002313.3121,.0199,21,0)
^^1^1^3040120^
"^DD",9002313.31,9002313.3121,.0199,21,1,0)
The name of the field being used for certification.
"^DD",9002313.31,9002313.3121,.02,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.31,9002313.3121,.02,3)
Answer must be 1-200 characters in length.
"^DD",9002313.31,9002313.3121,.02,21,0)
^^1^1^3040116^
"^DD",9002313.31,9002313.3121,.02,21,1,0)
The default value for the field.
"^DD",9002313.31,9002313.3121,.02,"DT")
3000928
"^DD",9002313.31,9002313.31902,0)
VA PINS MULTIPLE SUB-FIELD^^17^17
"^DD",9002313.31,9002313.31902,0,"DT")
3031028
"^DD",9002313.31,9002313.31902,0,"IX","B",9002313.31902,.01)

"^DD",9002313.31,9002313.31902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.31,9002313.31902,0,"UP")
9002313.31
"^DD",9002313.31,9002313.31902,.01,0)
PLAN ID^MF^^0;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,.01,1,0)
^.1
"^DD",9002313.31,9002313.31902,.01,1,1,0)
9002313.31902^B
"^DD",9002313.31,9002313.31902,.01,1,1,1)
S ^BPS(9002313.31,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.31902,.01,1,1,2)
K ^BPS(9002313.31,DA(1),3,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.31902,.01,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,.01,21,0)
^.001^1^1^3031028^^^
"^DD",9002313.31,9002313.31902,.01,21,1,0)
Enter the Plan ID pointer to the IB Insurance file.
"^DD",9002313.31,9002313.31902,.01,"DT")
3031028
"^DD",9002313.31,9002313.31902,1,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.31,9002313.31902,1,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,1,21,1,0)
Enter the payer sheet ien for file 9002313.92.
"^DD",9002313.31,9002313.31902,1,"DT")
3031028
"^DD",9002313.31,9002313.31902,2,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.31,9002313.31902,2,3)
Answer must be 1-10 characters in length.
"^DD",9002313.31,9002313.31902,2,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,2,21,1,0)
Enter the BIN number for the payer.
"^DD",9002313.31,9002313.31902,2,"DT")
3031028
"^DD",9002313.31,9002313.31902,3,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.31,9002313.31902,3,3)
Answer must be 1-10 characters in length.
"^DD",9002313.31,9002313.31902,3,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,3,21,1,0)
Enter the PCN for this payer.
"^DD",9002313.31,9002313.31902,3,"DT")
3031028
"^DD",9002313.31,9002313.31902,4,0)
GROUP ID^F^^1;3^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,4,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,4,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,4,21,1,0)
Enter the insurance group number for the patient.
"^DD",9002313.31,9002313.31902,4,"DT")
3031028
"^DD",9002313.31,9002313.31902,5,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.31,9002313.31902,5,3)
Answer must be 1-20 characters in length.
"^DD",9002313.31,9002313.31902,5,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,5,21,1,0)
Enter the patient's Cardholder ID.
"^DD",9002313.31,9002313.31902,5,"DT")
3031028
"^DD",9002313.31,9002313.31902,6,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.31,9002313.31902,6,3)
Answer must be 1 character in length.
"^DD",9002313.31,9002313.31902,6,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,6,21,1,0)
Enter the patient relationship code.  1=veteran, 2=spouse, 3=child
"^DD",9002313.31,9002313.31902,6,"DT")
3031028
"^DD",9002313.31,9002313.31902,7,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.31,9002313.31902,7,3)
Answer must be 1-12 characters in length.
"^DD",9002313.31,9002313.31902,7,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,7,21,1,0)
Enter the cardholder's first name.
"^DD",9002313.31,9002313.31902,7,"DT")
3031028
"^DD",9002313.31,9002313.31902,8,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,8,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,8,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,8,21,1,0)
Enter the cardholder's last name.
"^DD",9002313.31,9002313.31902,8,"DT")
3031028
"^DD",9002313.31,9002313.31902,9,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.31,9002313.31902,9,3)
Answer must be 1-2 characters in length.
"^DD",9002313.31,9002313.31902,9,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,9,21,1,0)
Enter the home state of the insurance plan.
"^DD",9002313.31,9002313.31902,9,"DT")
3031028
"^DD",9002313.31,9002313.31902,11,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,11,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,11,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,11,21,1,0)
Enter the dollar amount charged.
"^DD",9002313.31,9002313.31902,11,"DT")
3031028
"^DD",9002313.31,9002313.31902,12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,12,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,12,21,1,0)
Enter the amount for the dispensing fee.
"^DD",9002313.31,9002313.31902,12,"DT")
3031028
"^DD",9002313.31,9002313.31902,13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.31,9002313.31902,13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.31,9002313.31902,13,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,13,21,1,0)
Enter the basis of cost determination.  01=AWP, 07=Usual & Customary.
"^DD",9002313.31,9002313.31902,13,"DT")
3031028
"^DD",9002313.31,9002313.31902,14,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,14,21,0)
^^2^2^3031028^
"^DD",9002313.31,9002313.31902,14,21,1,0)
Enter gross amount due which contains the sum of the dispensing fee, 
"^DD",9002313.31,9002313.31902,14,21,2,0)
administrative fee, and Usual & Customary charge.
"^DD",9002313.31,9002313.31902,14,"DT")
3031028
"^DD",9002313.31,9002313.31902,15,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,15,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,15,21,1,0)
Enter the amount of the administrative fee.  Default is zero dollars.
"^DD",9002313.31,9002313.31902,15,"DT")
3031028
"^DD",9002313.31,9002313.31902,16,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.31,9002313.31902,16,3)
Answer must be 1-3 characters in length.
"^DD",9002313.31,9002313.31902,16,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,16,21,1,0)
Enter the fill number from test packet.
"^DD",9002313.31,9002313.31902,16,"DT")
3031028
"^DD",9002313.31,9002313.31902,17,0)
SOFTWARE VENDOR CERT/ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.31,9002313.31902,17,3)
Answer must be 1-30 characters in length.
"^DD",9002313.31,9002313.31902,17,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,17,21,1,0)
Enter the certification ID supplied by the payer.
"^DD",9002313.31,9002313.31902,17,"DT")
3031028
"^DD",9002313.56,9002313.56,0)
FIELD^^13800^50
"^DD",9002313.56,9002313.56,0,"DT")
3070207
"^DD",9002313.56,9002313.56,0,"IX","B",9002313.56,.01)

"^DD",9002313.56,9002313.56,0,"IX","C",9002313.5601,.01)

"^DD",9002313.56,9002313.56,0,"NM","BPS PHARMACIES")

"^DD",9002313.56,9002313.56,0,"PT",366.141,.09)

"^DD",9002313.56,9002313.56,0,"PT",9002313.57,1.07)

"^DD",9002313.56,9002313.56,0,"PT",9002313.59,1.07)

"^DD",9002313.56,9002313.56,0,"VRPK")
BPS
"^DD",9002313.56,9002313.56,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.56,9002313.56,.01,1,0)
^.1
"^DD",9002313.56,9002313.56,.01,1,1,0)
9002313.56^B
"^DD",9002313.56,9002313.56,.01,1,1,1)
S ^BPS(9002313.56,"B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.56,.01,1,1,2)
K ^BPS(9002313.56,"B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.56,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.56,9002313.56,.01,7.5)
I $D(X) S X=$$UP^XLFSTR(X)
"^DD",9002313.56,9002313.56,.01,21,0)
^^1^1^3050729^
"^DD",9002313.56,9002313.56,.01,21,1,0)
This is the name used to distinquish the BPS Pharmacy.
"^DD",9002313.56,9002313.56,.01,"DT")
3050729
"^DD",9002313.56,9002313.56,.02,0)
NCPDP #^F^^0;2^K:$L(X)>10!($L(X)<3) X
"^DD",9002313.56,9002313.56,.02,3)
This is a number assigned to your pharmacy by the NCPDP.  It was previously known as the NABP #.
"^DD",9002313.56,9002313.56,.02,21,0)
^.001^1^1^3060411^^
"^DD",9002313.56,9002313.56,.02,21,1,0)
The NCPDP # is sent as part of the electronic claim header.
"^DD",9002313.56,9002313.56,.02,"DT")
3060412
"^DD",9002313.56,9002313.56,.03,0)
DEFAULT DEA #^RF^^0;3^K:$L(X)>12!($L(X)<3) X
"^DD",9002313.56,9002313.56,.03,3)
Answer must be 3-12 characters in length.
"^DD",9002313.56,9002313.56,.03,21,0)
^^4^4^3050823^
"^DD",9002313.56,9002313.56,.03,21,1,0)
Many insurances require the prescriber's DEA number as part of the 
"^DD",9002313.56,9002313.56,.03,21,2,0)
claim.  If your pharmacy has a DEA # that may be used in case a 
"^DD",9002313.56,9002313.56,.03,21,3,0)
prescriber doesn't have this DEA # on file with you, enter that
"^DD",9002313.56,9002313.56,.03,21,4,0)
default DEA # here.
"^DD",9002313.56,9002313.56,.03,"DT")
3040607
"^DD",9002313.56,9002313.56,.09,0)
AUTO-REVERSE PARAMETER^NJ2,0^^0;9^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.56,9002313.56,.09,3)
You have to enter a number between 0 and 30.
"^DD",9002313.56,9002313.56,.09,21,0)
^.001^11^11^3050830^^
"^DD",9002313.56,9002313.56,.09,21,1,0)
ECME shall use the following AUTO-REVERSE site parameter when
"^DD",9002313.56,9002313.56,.09,21,2,0)
determining whether non-released prescription claims (that have
"^DD",9002313.56,9002313.56,.09,21,3,0)
a PAYABLE payer returned response) are to be automatically REVERSED.
"^DD",9002313.56,9002313.56,.09,21,4,0)
 
"^DD",9002313.56,9002313.56,.09,21,5,0)
The AUTO-REVERSE site parameter is set for the number of days that
"^DD",9002313.56,9002313.56,.09,21,6,0)
ECME will wait before the claim is automatically REVERSED. The user
"^DD",9002313.56,9002313.56,.09,21,7,0)
is allowed to enter a number as follows:
"^DD",9002313.56,9002313.56,.09,21,8,0)
 
"^DD",9002313.56,9002313.56,.09,21,9,0)
0 - ECME Auto-Reverse is turned off, 1 to 30 - ECME will wait the
"^DD",9002313.56,9002313.56,.09,21,10,0)
entered number of days before REVERSING the non-released Rx with a
"^DD",9002313.56,9002313.56,.09,21,11,0)
PAYABLE payer returned response.
"^DD",9002313.56,9002313.56,.09,"DT")
3050830
"^DD",9002313.56,9002313.56,.1,0)
STATUS^RS^1:ACTIVE;0:INACTIVE;^0;10^Q
"^DD",9002313.56,9002313.56,.1,3)
Enter '1' for active or '0' for inactive
"^DD",9002313.56,9002313.56,.1,21,0)
^^2^2^3060601^
"^DD",9002313.56,9002313.56,.1,21,1,0)
Indicates whether a BPS Pharmacy is active or inactive. If active, claims 
"^DD",9002313.56,9002313.56,.1,21,2,0)
will be processed through ECME.
"^DD",9002313.56,9002313.56,.1,"DT")
3060602
"^DD",9002313.56,9002313.56,1,0)
CMOP SWITCH^RS^0:CMOP OFF;1:CMOP ON;^0;8^Q
"^DD",9002313.56,9002313.56,1,3)
Enter ON to process CMOP claims via ECME, OFF to not process CMOP claims via ECME.
"^DD",9002313.56,9002313.56,1,21,0)
^^2^2^3050823^
"^DD",9002313.56,9002313.56,1,21,1,0)
Indicates whether ECME shall process CMOP claims.  If ON, CMOP claims 
"^DD",9002313.56,9002313.56,1,21,2,0)
will be processed.  If OFF, CMOP claims will not be processed.
"^DD",9002313.56,9002313.56,1,"DT")
3050729
"^DD",9002313.56,9002313.56,41.01,0)
NPI^FX^^NPI;1^K:$L(X)>10!($L(X)<10)!'$$CHKDGT^XUSNPI(X) X
"^DD",9002313.56,9002313.56,41.01,3)
Enter a valid NPI (10 numeric digits with proper check digit).
"^DD",9002313.56,9002313.56,41.01,21,0)
^.001^3^3^3060616^^^
"^DD",9002313.56,9002313.56,41.01,21,1,0)
National Provider ID.  This is a unique ID assigned to providers by CMS.  
"^DD",9002313.56,9002313.56,41.01,21,2,0)
It is used as the second piece of the Claim ID field (.01) of BPS CLAIMS
"^DD",9002313.56,9002313.56,41.01,21,3,0)
file (#9002313.02) and is sent as part of the electronic claim header.
"^DD",9002313.56,9002313.56,41.01,"DT")
3060504
"^DD",9002313.56,9002313.56,41.02,0)
DATE/TIME OF LAST NPI CHANGE^D^^NPI;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.56,9002313.56,41.02,3)
Enter the data and time of the last change to the NPI.
"^DD",9002313.56,9002313.56,41.02,21,0)
^^1^1^3060628^
"^DD",9002313.56,9002313.56,41.02,21,1,0)
This is the date and time of the last change to the NPI value.
"^DD",9002313.56,9002313.56,41.02,"DT")
3060628
"^DD",9002313.56,9002313.56,102.03,0)
SITE CITY^RF^^ADDR;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,102.03,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,102.03,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,102.03,21,1,0)
Enter City
"^DD",9002313.56,9002313.56,102.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.01,0)
SITE ADDRESS 1^RF^^ADDR;1^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.01,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,120.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.01,21,1,0)
The site's street address. 
"^DD",9002313.56,9002313.56,120.01,"DT")
3040607
"^DD",9002313.56,9002313.56,120.02,0)
SITE ADDRESS 2^F^^ADDR;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.02,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,120.02,21,0)
^^1^1^3040325^
"^DD",9002313.56,9002313.56,120.02,21,1,0)
Site's address line 2.
"^DD",9002313.56,9002313.56,120.02,"DT")
3040325
"^DD",9002313.56,9002313.56,120.03,0)
SITE ADDRESS NAME^RF^^ADDR;8^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.03,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,120.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.03,21,1,0)
Site's Business name.
"^DD",9002313.56,9002313.56,120.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.04,0)
SITE STATE^RP5'^DIC(5,^ADDR;4^Q
"^DD",9002313.56,9002313.56,120.04,3)

"^DD",9002313.56,9002313.56,120.04,"DT")
3040607
"^DD",9002313.56,9002313.56,120.05,0)
SITE ZIP CODE^RF^^ADDR;5^K:$L(X)>10!($L(X)<5) X
"^DD",9002313.56,9002313.56,120.05,3)
Answer must be 5-10 characters in length.
"^DD",9002313.56,9002313.56,120.05,"DT")
3040607
"^DD",9002313.56,9002313.56,120.06,0)
SITE PHONE^F^^ADDR;6^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.06,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.06,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.06,"DT")
3010331
"^DD",9002313.56,9002313.56,120.07,0)
SITE FAX^F^^ADDR;7^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.07,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.07,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.07,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.07,"DT")
3010331
"^DD",9002313.56,9002313.56,120.11,0)
HOURS OF OPERATION^F^^HOURS;1^K:$L(X)>2!($L(X)<1)!'(X?1N.N) X
"^DD",9002313.56,9002313.56,120.11,3)
Answer must be 0 to 24 hours.
"^DD",9002313.56,9002313.56,120.11,21,0)
^.001^1^1^3040315^^
"^DD",9002313.56,9002313.56,120.11,21,1,0)
Enter the hours of operation for the Pharmacy (0 to 24 hours).
"^DD",9002313.56,9002313.56,120.11,"DT")
3040315
"^DD",9002313.56,9002313.56,120.12,0)
START DAY RANGE^F^^HOURS;2^K:$L(X)>3!($L(X)<3)!'(X?3A) X
"^DD",9002313.56,9002313.56,120.12,3)
Answer must be 3 characters in length
"^DD",9002313.56,9002313.56,120.12,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.12,21,1,0)
Enter the start of the day for this Pharmacy.
"^DD",9002313.56,9002313.56,120.12,"DT")
3040315
"^DD",9002313.56,9002313.56,120.13,0)
END DAY RANGE^F^^HOURS;3^K:$L(X)>3!($L(X)<3)!'(X?3A) X
"^DD",9002313.56,9002313.56,120.13,3)
Answer must be 3 characters in length
"^DD",9002313.56,9002313.56,120.13,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.13,21,1,0)
Enter the end of the day range for this Pharmacy.
"^DD",9002313.56,9002313.56,120.13,"DT")
3040315
"^DD",9002313.56,9002313.56,120.14,0)
START HOUR RANGE^F^^HOURS;4^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",9002313.56,9002313.56,120.14,3)
Answer must be 0000 to 2359
"^DD",9002313.56,9002313.56,120.14,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.14,21,1,0)
Enter the start hour range for this Pharmacy.  
"^DD",9002313.56,9002313.56,120.14,"DT")
3040315
"^DD",9002313.56,9002313.56,120.15,0)
END HOUR RANGE^F^^HOURS;5^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",9002313.56,9002313.56,120.15,3)
Answer must be 0000 to 2359
"^DD",9002313.56,9002313.56,120.15,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.15,21,1,0)
Enter the end hour range for this Pharmacy.
"^DD",9002313.56,9002313.56,120.15,"DT")
3040315
"^DD",9002313.56,9002313.56,120.21,0)
Sunday Open Time^F^^TOPEN;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.21,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.21,21,0)
^.001^1^1^3040521^^
"^DD",9002313.56,9002313.56,120.21,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.21,"DT")
3040521
"^DD",9002313.56,9002313.56,120.22,0)
Monday Open Time^F^^TOPEN;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.22,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.22,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.22,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.22,"DT")
3040521
"^DD",9002313.56,9002313.56,120.23,0)
Tuesday Open Time^F^^TOPEN;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.23,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.23,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.23,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.23,"DT")
3040521
"^DD",9002313.56,9002313.56,120.24,0)
Wednesday Open Time^F^^TOPEN;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.24,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.24,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.24,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.24,"DT")
3040521
"^DD",9002313.56,9002313.56,120.25,0)
Thursday Open Time^F^^TOPEN;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.25,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.25,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.25,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.25,"DT")
3040521
"^DD",9002313.56,9002313.56,120.26,0)
Friday Open Time^F^^TOPEN;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.26,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.26,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.26,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.26,"DT")
3040521
"^DD",9002313.56,9002313.56,120.27,0)
Saturday Open Time^F^^TOPEN;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.27,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.27,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.27,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.27,"DT")
3040521
"^DD",9002313.56,9002313.56,120.31,0)
Sunday Close Time^F^^TCLOSE;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.31,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.31,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.31,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.31,"DT")
3040521
"^DD",9002313.56,9002313.56,120.32,0)
Monday Close Time^F^^TCLOSE;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.32,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.32,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.32,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.32,"DT")
3040521
"^DD",9002313.56,9002313.56,120.33,0)
Tuesday Close Time^F^^TCLOSE;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.33,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.33,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.33,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.33,"DT")
3040521
"^DD",9002313.56,9002313.56,120.34,0)
Wednesday Close Time^F^^TCLOSE;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.34,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.34,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.34,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.34,"DT")
3040521
"^DD",9002313.56,9002313.56,120.35,0)
Thursday Close Time^F^^TCLOSE;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.35,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.35,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.35,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.35,"DT")
3040521
"^DD",9002313.56,9002313.56,120.36,0)
Friday Close Time^F^^TCLOSE;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.36,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.36,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.36,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.36,"DT")
3040521
"^DD",9002313.56,9002313.56,120.37,0)
Saturday Close Time^F^^TCLOSE;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.37,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.37,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.37,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.37,"DT")
3040521
"^DD",9002313.56,9002313.56,130.01,0)
REMITTANCE ADDRESS NAME^RF^^REMIT;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.01,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,130.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.01,21,1,0)
Pharmacy Business Name
"^DD",9002313.56,9002313.56,130.01,"DT")
3040607
"^DD",9002313.56,9002313.56,130.02,0)
REMIT ADDRESS 1^RF^^REMIT;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.02,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.02,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.02,21,1,0)
Street Address (Line 1) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.02,"DT")
3040607
"^DD",9002313.56,9002313.56,130.03,0)
REMIT ADDRESS 2^F^^REMIT;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.03,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,130.03,21,0)
^^1^1^3040326^
"^DD",9002313.56,9002313.56,130.03,21,1,0)
Street Address (Line 2) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.03,"DT")
3040326
"^DD",9002313.56,9002313.56,130.04,0)
REMIT DWELLING NUMBER^F^^REMIT;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.04,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.04,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.04,21,1,0)
Enter the dwelling number for the claim remittance address.
"^DD",9002313.56,9002313.56,130.04,"DT")
3031222
"^DD",9002313.56,9002313.56,130.07,0)
REMIT STATE^RP5'^DIC(5,^REMIT;7^Q
"^DD",9002313.56,9002313.56,130.07,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.07,21,1,0)
Enter the state for the claim remittance address.
"^DD",9002313.56,9002313.56,130.07,"DT")
3040607
"^DD",9002313.56,9002313.56,130.08,0)
REMIT ZIP^RF^^REMIT;8^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.08,3)
Answer must be 1-10 characters in length.
"^DD",9002313.56,9002313.56,130.08,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.08,21,1,0)
Enter the zip for the claim remittance address.
"^DD",9002313.56,9002313.56,130.08,"DT")
3040607
"^DD",9002313.56,9002313.56,130.5,0)
REMIT OTHER DESIGNATION^F^^REMIT;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.5,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.5,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.5,21,1,0)
Enter the other designation for the claim remittance address.
"^DD",9002313.56,9002313.56,130.5,"DT")
3031222
"^DD",9002313.56,9002313.56,130.6,0)
REMIT CITY^RF^^REMIT;6^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.6,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.6,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.6,21,1,0)
Enter the city for the claim remittance address.
"^DD",9002313.56,9002313.56,130.6,"DT")
3040607
"^DD",9002313.56,9002313.56,1830.01,0)
CONTACT NAMES^F^^REP;1^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.01,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.01,21,0)
^^4^4^3000420^
"^DD",9002313.56,9002313.56,1830.01,21,1,0)
You may enter more than one name, separated by "/".
"^DD",9002313.56,9002313.56,1830.01,21,2,0)
Put corresponding phone numbers separated by "/" in the phone number field.
"^DD",9002313.56,9002313.56,1830.01,21,3,0)
A random name-phone combination will appear on each bill and that way
"^DD",9002313.56,9002313.56,1830.01,21,4,0)
the calls get distributed evenly.
"^DD",9002313.56,9002313.56,1830.01,"DT")
3000420
"^DD",9002313.56,9002313.56,1830.02,0)
CONTACT PHONES^F^^REP;2^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.02,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.02,21,0)
^^1^1^3000420^
"^DD",9002313.56,9002313.56,1830.02,21,1,0)
(See CONTACT NAMES description for details about "/"-separated list.)
"^DD",9002313.56,9002313.56,1830.02,"DT")
3000420
"^DD",9002313.56,9002313.56,1900.01,0)
VA CONTACT^RP200'^VA(200,^REP;3^Q
"^DD",9002313.56,9002313.56,1900.01,3)
Pointer to the New Person file for the VA contact information.
"^DD",9002313.56,9002313.56,1900.01,21,0)
^.001^1^1^3040625^^
"^DD",9002313.56,9002313.56,1900.01,21,1,0)
Pointer to the New Person file for the VA contact person information.
"^DD",9002313.56,9002313.56,1900.01,"DT")
3040625
"^DD",9002313.56,9002313.56,1900.02,0)
VA ALTERNATE CONTACT^RP200'^VA(200,^REP;4^Q
"^DD",9002313.56,9002313.56,1900.02,3)
Pointer to the New Person file for the Alternant VA contact.
"^DD",9002313.56,9002313.56,1900.02,21,0)
^.001^1^1^3040625^^^
"^DD",9002313.56,9002313.56,1900.02,21,1,0)
Pointer to the New Person file for the Alternant VA contact.
"^DD",9002313.56,9002313.56,1900.02,"DT")
3040625
"^DD",9002313.56,9002313.56,1900.03,0)
VA LEAD PHARMACIST^RP200'^VA(200,^REP;5^Q
"^DD",9002313.56,9002313.56,1900.03,3)
Pointer to the New Person file for the lead Pharmacists.
"^DD",9002313.56,9002313.56,1900.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,1900.03,21,1,0)
Pointer to the New Person file for the lead Pharmacists. 
"^DD",9002313.56,9002313.56,1900.03,"DT")
3040607
"^DD",9002313.56,9002313.56,1900.04,0)
VA LEAD PHARMACIST LICENSE #^F^^REP1;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,1900.04,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,1900.04,"DT")
3040608
"^DD",9002313.56,9002313.56,13800,0)
OUTPATIENT SITE^9002313.5601P^^OPSITE;0
"^DD",9002313.56,9002313.5601,0)
OUTPATIENT SITE SUB-FIELD^^.01^1
"^DD",9002313.56,9002313.5601,0,"DT")
3070207
"^DD",9002313.56,9002313.5601,0,"IX","B",9002313.5601,.01)

"^DD",9002313.56,9002313.5601,0,"NM","OUTPATIENT SITE")

"^DD",9002313.56,9002313.5601,0,"UP")
9002313.56
"^DD",9002313.56,9002313.5601,.01,0)
OUTPATIENT SITE^MP59'X^PS(59,^0;1^I $D(^BPS(9002313.56,"C",X)) D EN^DDIOL("** This site already linked.") K X
"^DD",9002313.56,9002313.5601,.01,1,0)
^.1^^-1
"^DD",9002313.56,9002313.5601,.01,1,1,0)
9002313.5601^B
"^DD",9002313.56,9002313.5601,.01,1,1,1)
S ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,1,2)
K ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,0)
9002313.56^C
"^DD",9002313.56,9002313.5601,.01,1,2,1)
S ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,2,2)
K ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,"DT")
3010119
"^DD",9002313.56,9002313.5601,.01,3)
Enter one or more OUTPATIENT SITES to associate with this ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,21,0)
^.001^2^2^3070207^^^
"^DD",9002313.56,9002313.5601,.01,21,1,0)
One or more of the VISTA pharmacy package's Outpatient Sites (File 59) 
"^DD",9002313.56,9002313.5601,.01,21,2,0)
must be associated with the ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,"DT")
3060621
"^DD",9002313.57,9002313.57,0)
FIELD^^508^214
"^DD",9002313.57,9002313.57,0,"DDA")
N
"^DD",9002313.57,9002313.57,0,"DT")
3070627
"^DD",9002313.57,9002313.57,0,"IX","AC",9002313.57,5)

"^DD",9002313.57,9002313.57,0,"IX","AE",9002313.57,3)

"^DD",9002313.57,9002313.57,0,"IX","AER",9002313.57,401)

"^DD",9002313.57,9002313.57,0,"IX","AF",9002313.57,4)

"^DD",9002313.57,9002313.57,0,"IX","AFR",9002313.57,402)

"^DD",9002313.57,9002313.57,0,"IX","AG",9002313.57,13)

"^DD",9002313.57,9002313.57,0,"IX","AH",9002313.57,7)

"^DD",9002313.57,9002313.57,0,"IX","B",9002313.57,.01)

"^DD",9002313.57,9002313.57,0,"NM","BPS LOG OF TRANSACTIONS")

"^DD",9002313.57,9002313.57,0,"VRPK")
BPS
"^DD",9002313.57,9002313.57,.01,0)
ENTRY #^RF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57,.01,1,0)
^.1
"^DD",9002313.57,9002313.57,.01,1,1,0)
9002313.57^B
"^DD",9002313.57,9002313.57,.01,1,1,1)
S ^BPSTL("B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,.01,1,1,2)
K ^BPSTL("B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,.01,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57,.01,21,0)
^^1^1^3031208^
"^DD",9002313.57,9002313.57,.01,21,1,0)
Sequential entry number
"^DD",9002313.57,9002313.57,.01,"DT")
3001115
"^DD",9002313.57,9002313.57,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1,21,0)
^^5^5^3070227^
"^DD",9002313.57,9002313.57,1,21,1,0)
The status of the transaction as a percentage of completion.  The text 
"^DD",9002313.57,9002313.57,1,21,2,0)
value can be obtained by running $$STATI^BPSOSU(<Status Number>).  Note 
"^DD",9002313.57,9002313.57,1,21,3,0)
that 99 indicates complete.  Since records are only copied to BPS Log of 
"^DD",9002313.57,9002313.57,1,21,4,0)
Transactions when transactions are complete, all records in this file 
"^DD",9002313.57,9002313.57,1,21,5,0)
should be 99.
"^DD",9002313.57,9002313.57,1,"DT")
3070227
"^DD",9002313.57,9002313.57,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.57,9002313.57,1.07,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,1.07,21,1,0)
Textual description of the Pharmacy involved with this transation.
"^DD",9002313.57,9002313.57,1.07,"DT")
3040331
"^DD",9002313.57,9002313.57,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1.08,21,0)
^^7^7^3031216^
"^DD",9002313.57,9002313.57,1.08,21,1,0)
Type a Number between 1 and 9, 0 Decimal Digits 
"^DD",9002313.57,9002313.57,1.08,21,2,0)
DESCRIPTION:      Pointer to which of the PINS pieces in 
"^DD",9002313.57,9002313.57,1.08,21,3,0)
^(6) is in use for this claim.  Use this to keep track
"^DD",9002313.57,9002313.57,1.08,21,4,0)
of where you are in billing down the line to
"^DD",9002313.57,9002313.57,1.08,21,5,0)
various insurers.   (Probably won't automatically roll over to next
"^DD",9002313.57,9002313.57,1.08,21,6,0)
insurer, but maybe we will have an option to edit
"^DD",9002313.57,9002313.57,1.08,21,7,0)
insurance info, try next insurance, etc.)
"^DD",9002313.57,9002313.57,1.08,"DT")
3010330
"^DD",9002313.57,9002313.57,1.09,0)
PRIOR AUTHORIZATION #^F^^1;9^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.09,3)
Enter the prior authorization number (1-11 characters)
"^DD",9002313.57,9002313.57,1.09,21,0)
^^2^2^3070221^
"^DD",9002313.57,9002313.57,1.09,21,1,0)
Number assigned by the processor to identify a prior authorized
"^DD",9002313.57,9002313.57,1.09,21,2,0)
transaction.
"^DD",9002313.57,9002313.57,1.09,"DT")
3070221
"^DD",9002313.57,9002313.57,1.11,0)
ABSBRXI^P52'^PSRX(^1;11^Q
"^DD",9002313.57,9002313.57,1.11,21,0)
^.001^1^1^3031216^^
"^DD",9002313.57,9002313.57,1.11,21,1,0)
Pointer from the RX file into BPS Transactions.
"^DD",9002313.57,9002313.57,1.11,"DT")
3000711
"^DD",9002313.57,9002313.57,1.1199,0)
RXI-INTERNAL^CJ8^^ ; ^S Y(9002313.57,1.1199,1)=$S($D(^BPSTL(D0,1)):^(1),1:"") S X=$P(Y(9002313.57,1.1199,1),U,11),X=X
"^DD",9002313.57,9002313.57,1.1199,9)
^
"^DD",9002313.57,9002313.57,1.1199,9.01)
9002313.57^1.11
"^DD",9002313.57,9002313.57,1.1199,9.1)
INTERNAL(ABSBRXI)
"^DD",9002313.57,9002313.57,1.1199,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.57,9002313.57,1.12,0)
RESUBMIT AFTER REVERSAL^S^0:DONE;1:RESUBMIT AFTER REVERSAL;2:RESUBMITTING;^1;12^Q
"^DD",9002313.57,9002313.57,1.12,3)
Enter the status of the resubmit
"^DD",9002313.57,9002313.57,1.12,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.57,9002313.57,1.12,"DT")
3051213
"^DD",9002313.57,9002313.57,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.57,9002313.57,1.13,21,0)
^^2^2^3040120^
"^DD",9002313.57,9002313.57,1.13,21,1,0)
Pointer to the overrides file for any fields that are not straight 
"^DD",9002313.57,9002313.57,1.13,21,2,0)
forward, but are required by the payer.
"^DD",9002313.57,9002313.57,1.13,"DT")
3010330
"^DD",9002313.57,9002313.57,1.15,0)
PRIOR AUTHORIZATION TYPE CODE^F^^1;15^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.15,3)
Enter the prior authorization type (1-2 characters)
"^DD",9002313.57,9002313.57,1.15,21,0)
^^1^1^3070221^
"^DD",9002313.57,9002313.57,1.15,21,1,0)
Indicates the type of authorization made before transaction was submitted.
"^DD",9002313.57,9002313.57,1.15,"DT")
3070314
"^DD",9002313.57,9002313.57,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.57,9002313.57,3,1,0)
^.1
"^DD",9002313.57,9002313.57,3,1,1,0)
9002313.57^AE
"^DD",9002313.57,9002313.57,3,1,1,1)
S ^BPSTL("AE",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,3,1,1,2)
K ^BPSTL("AE",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,3,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,3,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3,21,1,0)
Claim number 
"^DD",9002313.57,9002313.57,3,"DT")
3001111
"^DD",9002313.57,9002313.57,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.57,3.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,3.1,1),U,4),X=X
"^DD",9002313.57,9002313.57,3.1,9)
^
"^DD",9002313.57,9002313.57,3.1,9.01)
9002313.57^3
"^DD",9002313.57,9002313.57,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.57,9002313.57,3.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3.1,21,1,0)
Pointer to the BPS claims file - 9002313.02
"^DD",9002313.57,9002313.57,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.57,9002313.57,4,1,0)
^.1
"^DD",9002313.57,9002313.57,4,1,1,0)
9002313.57^AF
"^DD",9002313.57,9002313.57,4,1,1,1)
S ^BPSTL("AF",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,4,1,1,2)
K ^BPSTL("AF",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,4,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,4,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4,21,1,0)
Pointer to the corresponding response in the response file, 9002313.03
"^DD",9002313.57,9002313.57,4,"DT")
3001111
"^DD",9002313.57,9002313.57,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,9)
^
"^DD",9002313.57,9002313.57,4.0098,9.01)

"^DD",9002313.57,9002313.57,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.0098,21,1,0)
Result if the claim had to be reversed for whatever reason.
"^DD",9002313.57,9002313.57,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,9)
^
"^DD",9002313.57,9002313.57,4.0099,9.01)

"^DD",9002313.57,9002313.57,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,4.0099,21,1,0)
Result from the payer - maybe be Paid, rejected, captuured, accepted.
"^DD",9002313.57,9002313.57,4.0099,"DT")
3040331
"^DD",9002313.57,9002313.57,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.57,4.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,4.1,1),U,5),X=X
"^DD",9002313.57,9002313.57,4.1,9)
^
"^DD",9002313.57,9002313.57,4.1,9.01)
9002313.57^4
"^DD",9002313.57,9002313.57,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.57,9002313.57,4.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.1,21,1,0)
Response file record number of any reversals.
"^DD",9002313.57,9002313.57,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.57,9002313.57,5,1,0)
^.1
"^DD",9002313.57,9002313.57,5,1,1,0)
9002313.57^AC
"^DD",9002313.57,9002313.57,5,1,1,1)
S ^BPSTL("AC",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,5,1,1,2)
K ^BPSTL("AC",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,5,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,5,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,5,21,1,0)
The patient this transaction refers to.
"^DD",9002313.57,9002313.57,5,"DT")
3031216
"^DD",9002313.57,9002313.57,6,0)
SUBMIT DATE/TIME^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.57,9002313.57,6,3)
Enter the date/time that the claims was submitted
"^DD",9002313.57,9002313.57,6,21,0)
^^1^1^3070207^
"^DD",9002313.57,9002313.57,6,21,1,0)
This is the date/time that the claim was submitted to ECME.
"^DD",9002313.57,9002313.57,6,"DT")
3070207
"^DD",9002313.57,9002313.57,7,0)
LAST UPDATE^D^^0;8^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,7,1,0)
^.1
"^DD",9002313.57,9002313.57,7,1,1,0)
9002313.57^AH
"^DD",9002313.57,9002313.57,7,1,1,1)
S ^BPSTL("AH",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,7,1,1,2)
K ^BPSTL("AH",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,7,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,7,21,0)
^^2^2^3000418^
"^DD",9002313.57,9002313.57,7,21,1,0)
Date/time the POS transaction completed processing,
"^DD",9002313.57,9002313.57,7,21,2,0)
as copied from 9002313.59 at the time the .57 record was created.
"^DD",9002313.57,9002313.57,7,"DT")
3001111
"^DD",9002313.57,9002313.57,9,0)
ABSBRXR^F^^1;1^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.57,9002313.57,9,3)
Answer must be 1-5 characters in length.
"^DD",9002313.57,9002313.57,9,21,0)
^.001^1^1^3031216^^
"^DD",9002313.57,9002313.57,9,21,1,0)
Point to refill multiple in ^PSRX file 52
"^DD",9002313.57,9002313.57,9,"DT")
3000418
"^DD",9002313.57,9002313.57,10,0)
ABSBNDC^F^^1;2^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57,10,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57,10,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10,21,1,0)
NDC number referenced in this transaction.
"^DD",9002313.57,9002313.57,10,"DT")
3000418
"^DD",9002313.57,9002313.57,10.0099,0)
USER-INTERNAL^CJ8^^ ; ^S Y(9002313.57,10.0099,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,10.0099,1),U,10),X=X
"^DD",9002313.57,9002313.57,10.0099,9)
^
"^DD",9002313.57,9002313.57,10.0099,9.01)
9002313.57^13
"^DD",9002313.57,9002313.57,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.57,9002313.57,10.0099,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,10.0099,21,1,0)
IEN of the user generating the transaction
"^DD",9002313.57,9002313.57,11,0)
ABSBDIV^F^^1;4^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57,11,3)
Answer must be 1-10 characters in length
"^DD",9002313.57,9002313.57,11,21,0)
^^1^1^3061213^
"^DD",9002313.57,9002313.57,11,21,1,0)
Division this transaction is for.
"^DD",9002313.57,9002313.57,11,"DT")
3061213
"^DD",9002313.57,9002313.57,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.57,9002313.57,13,1,0)
^.1
"^DD",9002313.57,9002313.57,13,1,1,0)
9002313.57^AG
"^DD",9002313.57,9002313.57,13,1,1,1)
S ^BPSTL("AG",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,13,1,1,2)
K ^BPSTL("AG",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,13,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,13,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,13,21,1,0)
Who created the ECME claim
"^DD",9002313.57,9002313.57,13,"DT")
3001111
"^DD",9002313.57,9002313.57,14,0)
POSITION IN CLAIM^NJ1,0^^0;9^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,14,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,14,21,0)
^^1^1^3000418^
"^DD",9002313.57,9002313.57,14,21,1,0)
This is the D1 subscript into 9002313.02 and .03
"^DD",9002313.57,9002313.57,14,"DT")
3000418
"^DD",9002313.57,9002313.57,15,0)
START TIME^D^^0;11^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,15,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,15,21,1,0)
Time, including the seconds that the transaction was initiated.
"^DD",9002313.57,9002313.57,15,"DT")
3000418
"^DD",9002313.57,9002313.57,111,0)
COMMENT MULTIPLE^9002313.57111DA^^11;0
"^DD",9002313.57,9002313.57,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57,111,21,1,0)
User's comment
"^DD",9002313.57,9002313.57,111,"DT")
3050627
"^DD",9002313.57,9002313.57,201,0)
RESULT CODE^F^^2;1^K:$L(X)>9!($L(X)<1) X
"^DD",9002313.57,9002313.57,201,3)
Answer must be 1-9 characters in length.
"^DD",9002313.57,9002313.57,201,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,201,21,1,0)
Code indicating whether the claim was successfully
"^DD",9002313.57,9002313.57,201,21,2,0)
billed or rejected.
"^DD",9002313.57,9002313.57,201,"DT")
3000418
"^DD",9002313.57,9002313.57,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>222!($L(X)<1) X
"^DD",9002313.57,9002313.57,202,3)
Answer must be 1-222 characters in length.
"^DD",9002313.57,9002313.57,202,21,0)
^^2^2^3031208^
"^DD",9002313.57,9002313.57,202,21,1,0)
Textual description of the reason for rejection, if the claim was 
"^DD",9002313.57,9002313.57,202,21,2,0)
rejected.
"^DD",9002313.57,9002313.57,202,"DT")
3000418
"^DD",9002313.57,9002313.57,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.57,9002313.57,401,1,0)
^.1
"^DD",9002313.57,9002313.57,401,1,1,0)
9002313.57^AER
"^DD",9002313.57,9002313.57,401,1,1,1)
S ^BPSTL("AER",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,401,1,1,2)
K ^BPSTL("AER",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,401,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,401,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,401,21,1,0)
Pointer to file 9002313.02 BPS CLAIMS file for the reversal
"^DD",9002313.57,9002313.57,401,21,2,0)
transaction.
"^DD",9002313.57,9002313.57,401,"DT")
3001111
"^DD",9002313.57,9002313.57,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.57,9002313.57,402,1,0)
^.1
"^DD",9002313.57,9002313.57,402,1,1,0)
9002313.57^AFR
"^DD",9002313.57,9002313.57,402,1,1,1)
S ^BPSTL("AFR",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,402,1,1,2)
K ^BPSTL("AFR",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,402,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,402,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,402,21,1,0)
Pointer to the BPS responses file 9002313.03 for the 
"^DD",9002313.57,9002313.57,402,21,2,0)
reversal response.
"^DD",9002313.57,9002313.57,402,"DT")
3001111
"^DD",9002313.57,9002313.57,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.57,9002313.57,404,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,404,21,1,0)
Reason for the reversal
"^DD",9002313.57,9002313.57,404,"DT")
3050525
"^DD",9002313.57,9002313.57,501,0)
QUANTITY^NJ12,3^^5;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."4.N) X
"^DD",9002313.57,9002313.57,501,3)
Type a number between 0 and 99999999, 3 Decimal Digits
"^DD",9002313.57,9002313.57,501,21,0)
^^1^1^3070625^
"^DD",9002313.57,9002313.57,501,21,1,0)
Enter the billing quantity for the prescription.
"^DD",9002313.57,9002313.57,501,"DT")
3070625
"^DD",9002313.57,9002313.57,502,0)
UNIT PRICE^NJ18,8^^5;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,502,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,502,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.57,9002313.57,502,"DT")
3000418
"^DD",9002313.57,9002313.57,503,0)
SUBTOTAL^NJ18,8^^5;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,503,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,503,21,0)
^^3^3^3031217^
"^DD",9002313.57,9002313.57,503,21,1,0)
= QUANTITY * UNIT PRICE This is what
"^DD",9002313.57,9002313.57,503,21,2,0)
we want to send as the INGREDIENT COST 
"^DD",9002313.57,9002313.57,503,21,3,0)
field in the NCPDP message.
"^DD",9002313.57,9002313.57,503,"DT")
3000418
"^DD",9002313.57,9002313.57,504,0)
DISPENSING FEE^NJ6,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",9002313.57,9002313.57,504,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",9002313.57,9002313.57,504,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,504,21,1,0)
Service fee the pharmacy charges for dispensing the drug.
"^DD",9002313.57,9002313.57,504,"DT")
3000418
"^DD",9002313.57,9002313.57,505,0)
TOTAL PRICE^NJ12,2^^5;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.57,9002313.57,505,3)
Type a Number between 0 and 999999999, 2 Decimal Digits
"^DD",9002313.57,9002313.57,505,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.57,9002313.57,505,"DT")
3000418
"^DD",9002313.57,9002313.57,508,0)
UNIT OF MEASURE^F^^5;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,508,3)
Enter the Unit of Measure (1-2 characters)
"^DD",9002313.57,9002313.57,508,21,0)
^^2^2^3070627^
"^DD",9002313.57,9002313.57,508,21,1,0)
Enter the Unit of Measure for the drug.  This is usually GR (grams), ML 
"^DD",9002313.57,9002313.57,508,21,2,0)
(milliliters), or EA (Each).
"^DD",9002313.57,9002313.57,508,"DT")
3070627
"^DD",9002313.57,9002313.57,801,0)
RETRY AFTER^D^^8;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,801,21,0)
^^3^3^3031217^
"^DD",9002313.57,9002313.57,801,21,1,0)
 Due to dial out error or insurer asleep, retry this claim no earlier than
"^DD",9002313.57,9002313.57,801,21,2,0)
this time.  (May provide some way to poke it into activity, overriding
"^DD",9002313.57,9002313.57,801,21,3,0)
this.) 
"^DD",9002313.57,9002313.57,801,"DT")
3010330
"^DD",9002313.57,9002313.57,803,0)
RETRY SLEEPING INSURER^P9002313.92'^BPSF(9002313.92,^8;3^Q
"^DD",9002313.57,9002313.57,803,3)
Enter the payer sheet for the sleeping insurer
"^DD",9002313.57,9002313.57,803,21,0)
^^1^1^3061102^
"^DD",9002313.57,9002313.57,803,21,1,0)
This is the payer sheet associated with the sleeping insurer
"^DD",9002313.57,9002313.57,803,"DT")
3061102
"^DD",9002313.57,9002313.57,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57,901,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,901,21,1,0)
This field is used for the 1st patient insurance for a VA prescri
"^DD",9002313.57,9002313.57,901,21,2,0)
and it points to the payer sheet to use.
"^DD",9002313.57,9002313.57,901,"DT")
3040331
"^DD",9002313.57,9002313.57,902,0)
VA PINS MULTIPLE^9002313.57902PA^^10;0
"^DD",9002313.57,9002313.57,902,21,0)
^.001^1^1^3041014^^^^
"^DD",9002313.57,9002313.57,902,21,1,0)
List of VA insurers
"^DD",9002313.57,9002313.57,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.57,9002313.57,1201,3)
Answer must be 1-4 characters in length
"^DD",9002313.57,9002313.57,1201,21,0)
^^3^3^3050629^
"^DD",9002313.57,9002313.57,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.57,9002313.57,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.57,9002313.57,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.57,9002313.57,1201,"DT")
3050629
"^DD",9002313.57,9002313.57,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.57,9002313.57,1202,3)
(No range limit on date)
"^DD",9002313.57,9002313.57,1202,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,1202,21,1,0)
Date used for the 401-D1 (DATE OF SERVICE) in the NCPDP transaction
"^DD",9002313.57,9002313.57,1202,"DT")
3050525
"^DD",9002313.57,9002313.57,1203,0)
SUBMISSION CLARIFICATION CODE^F^^12;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,1203,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57,1203,21,0)
^.001^1^1^3070119^^
"^DD",9002313.57,9002313.57,1203,21,1,0)
Submission Clarification Code
"^DD",9002313.57,9002313.57,1203,"DT")
3070119
"^DD",9002313.57,9002313.57,1300,0)
DUR DATA^9002313.5713^^13;0
"^DD",9002313.57,9002313.57,1300,21,0)
^^3^3^3050628^
"^DD",9002313.57,9002313.57,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.57,9002313.57,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put
"^DD",9002313.57,9002313.57,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.57,9002313.57,9999.92,0)
HRN & FAC^CJ16^^ ; ^N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,9)
^
"^DD",9002313.57,9002313.57,9999.92,9.01)

"^DD",9002313.57,9002313.57,9999.92,9.1)
N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,9999.92,21,1,0)
Health record number and faciltity ID - this is set to 
"^DD",9002313.57,9002313.57,9999.92,21,2,0)
the pointer to the patient file and the division.
"^DD",9002313.57,9002313.57,9999.92,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.93,0)
DRUG NAME^CJ30^^ ; ^N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,9)
^
"^DD",9002313.57,9002313.57,9999.93,9.01)

"^DD",9002313.57,9002313.57,9999.93,9.1)
N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.93,21,1,0)
Drug name from file 50
"^DD",9002313.57,9002313.57,9999.94,0)
DRUG IEN^CJ8^^ ; ^N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,9)
^
"^DD",9002313.57,9002313.57,9999.94,9.01)

"^DD",9002313.57,9002313.57,9999.94,9.1)
N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.94,21,1,0)
The IEN of the drug from file 50.
"^DD",9002313.57,9002313.57,9999.95,0)
RELEASED DATE/TIME (INT)^CJ14^^ ; ^N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,9)
^
"^DD",9002313.57,9002313.57,9999.95,9.01)

"^DD",9002313.57,9002313.57,9999.95,9.1)
N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.95,21,1,0)
Release date and time from the prescription file, 52.
"^DD",9002313.57,9002313.57,9999.95,"DT")
3010410
"^DD",9002313.57,9002313.57,9999.96,0)
NET PAID BY INSURER^CJ8^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,9)
^
"^DD",9002313.57,9002313.57,9999.96,9.01)

"^DD",9002313.57,9002313.57,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,9999.96,21,1,0)
Amount paid after the discounts and deductible have been subtracted.
"^DD",9002313.57,9002313.57,9999.96,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.97,0)
ELAPSED TIME (PRINTABLE)^CJ20^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,9)
^
"^DD",9002313.57,9002313.57,9999.97,9.01)

"^DD",9002313.57,9002313.57,9999.97,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.97,21,1,0)
Elapsed time between submission and response in external format.
"^DD",9002313.57,9002313.57,9999.97,"DT")
3010206
"^DD",9002313.57,9002313.57,9999.98,0)
ELAPSED TIME (SECONDS)^CJ8^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,9)
^
"^DD",9002313.57,9002313.57,9999.98,9.01)

"^DD",9002313.57,9002313.57,9999.98,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,9999.98,21,1,0)
Elapsed time between submission and repsonse expressed as a number of 
"^DD",9002313.57,9002313.57,9999.98,21,2,0)
seconds.
"^DD",9002313.57,9002313.57,9999.98,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,9)
^
"^DD",9002313.57,9002313.57,9999.99,9.01)

"^DD",9002313.57,9002313.57,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,9999.99,21,1,0)
The category of the transmission - accepted, payable, rejected, etc.
"^DD",9002313.57,9002313.57,9999.99,"DT")
3001115
"^DD",9002313.57,9002313.57,10101,0)
BIN NUMBER^CJ6^^ ; ^S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,9)
^
"^DD",9002313.57,9002313.57,10101,9.01)

"^DD",9002313.57,9002313.57,10101,9.1)
S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,21,0)
^^1^1^3040322^
"^DD",9002313.57,9002313.57,10101,21,1,0)
BIN number from the response file.
"^DD",9002313.57,9002313.57,10102,0)
VERSION/RELEASE NUMBER^CJ2^^ ; ^S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,9)
^
"^DD",9002313.57,9002313.57,10102,9.01)

"^DD",9002313.57,9002313.57,10102,9.1)
S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10102,21,1,0)
Version/release number from the BPS claims file.
"^DD",9002313.57,9002313.57,10103,0)
TRANSACTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,9)
^
"^DD",9002313.57,9002313.57,10103,9.01)

"^DD",9002313.57,9002313.57,10103,9.1)
S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10103,21,1,0)
Type of transaction from the claim file.
"^DD",9002313.57,9002313.57,10104,0)
PROCESSOR CONTROL NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,9)
^
"^DD",9002313.57,9002313.57,10104,9.01)

"^DD",9002313.57,9002313.57,10104,9.1)
S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10104,21,1,0)
PCN number from the claims file.
"^DD",9002313.57,9002313.57,10201,0)
PHARMACY NUMBER^CJ12^^ ; ^S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,9)
^
"^DD",9002313.57,9002313.57,10201,9.01)

"^DD",9002313.57,9002313.57,10201,9.1)
S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10201,21,1,0)
The Pharmacy's NABP number from the claims file.
"^DD",9002313.57,9002313.57,10301,0)
GROUP NUMBER^CJ15^^ ; ^S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,9)
^
"^DD",9002313.57,9002313.57,10301,9.01)

"^DD",9002313.57,9002313.57,10301,9.1)
S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10301,21,1,0)
The group number of the insurance used from the BPS claims file.
"^DD",9002313.57,9002313.57,10302,0)
CARDHOLDER ID NUMBER^CJ18^^ ; ^S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,9)
^
"^DD",9002313.57,9002313.57,10302,9.01)

"^DD",9002313.57,9002313.57,10302,9.1)
S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,10302,21,1,0)
The insured person's cardholder identification number from the claims 
"^DD",9002313.57,9002313.57,10302,21,2,0)
file.
"^DD",9002313.57,9002313.57,10302,"DT")
3040322
"^DD",9002313.57,9002313.57,10303,0)
PERSON CODE^CJ3^^ ; ^S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,9)
^
"^DD",9002313.57,9002313.57,10303,9.01)

"^DD",9002313.57,9002313.57,10303,9.1)
S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10303,21,1,0)
The person code from the BPS claims file.
"^DD",9002313.57,9002313.57,10304,0)
DATE OF BIRTH^CJ8^^ ; ^S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,9)
^
"^DD",9002313.57,9002313.57,10304,9.01)

"^DD",9002313.57,9002313.57,10304,9.1)
S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10304,21,1,0)
Date of birth of the patient from the BPS claims file.
"^DD",9002313.57,9002313.57,10305,0)
SEX CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,9)
^
"^DD",9002313.57,9002313.57,10305,9.01)

"^DD",9002313.57,9002313.57,10305,9.1)
S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10305,21,1,0)
Sex of the patient, "M" or "F"
"^DD",9002313.57,9002313.57,10306,0)
RELATIONSHIP CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,9)
^
"^DD",9002313.57,9002313.57,10306,9.01)

"^DD",9002313.57,9002313.57,10306,9.1)
S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10306,21,1,0)
Relationship of the patient to the insured - from the BPS claims file.
"^DD",9002313.57,9002313.57,10307,0)
CUSTOMER LOCATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,9)
^
"^DD",9002313.57,9002313.57,10307,9.01)

"^DD",9002313.57,9002313.57,10307,9.1)
S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10307,21,1,0)
Code identifying the location of the patient when receiving pharmacy
"^DD",9002313.57,9002313.57,10307,21,2,0)
services.  =Not Specified 1=Home 2=Inter-Care 3=Nursing Home 4=Long
"^DD",9002313.57,9002313.57,10307,21,3,0)
Term/Extended Care 5=Rest Home 6=Boarding Home 7=Skilled Care Facility
"^DD",9002313.57,9002313.57,10307,21,4,0)
8=Sub-Acute Care Facility 9=Acute Care Facility 1=Outpatient 11=Hospice
"^DD",9002313.57,9002313.57,10307,21,5,0)
 
"^DD",9002313.57,9002313.57,10307,21,6,0)
from the BPS claims file
"^DD",9002313.57,9002313.57,10308,0)
OTHER COVERAGE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,9)
^
"^DD",9002313.57,9002313.57,10308,9.01)

"^DD",9002313.57,9002313.57,10308,9.1)
S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.57,9002313.57,10309,0)
ELIGIBILITY CLARIFICATION CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,9)
^
"^DD",9002313.57,9002313.57,10309,9.01)

"^DD",9002313.57,9002313.57,10309,9.1)
S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on
"^DD",9002313.57,9002313.57,10309,21,2,0)
receiving a denial. Comes from the BPS claims file.  
"^DD",9002313.57,9002313.57,10310,0)
PATIENT FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,9)
^
"^DD",9002313.57,9002313.57,10310,9.01)

"^DD",9002313.57,9002313.57,10310,9.1)
S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10310,21,1,0)
First name of patient receiving the prescription, from the BPS claims 
"^DD",9002313.57,9002313.57,10310,21,2,0)
file.
"^DD",9002313.57,9002313.57,10311,0)
PATIENT LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,9)
^
"^DD",9002313.57,9002313.57,10311,9.01)

"^DD",9002313.57,9002313.57,10311,9.1)
S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,10311,21,1,0)
Last Name of patient receiving the prescripion from the BPS claims file.
"^DD",9002313.57,9002313.57,10311,"DT")
3040331
"^DD",9002313.57,9002313.57,10312,0)
CARDHOLDER FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,9)
^
"^DD",9002313.57,9002313.57,10312,9.01)

"^DD",9002313.57,9002313.57,10312,9.1)
S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10312,21,1,0)
First name of the Cardholder/Subscriber from the BPS claims file.
"^DD",9002313.57,9002313.57,10313,0)
CARDHOLDER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,9)
^
"^DD",9002313.57,9002313.57,10313,9.01)

"^DD",9002313.57,9002313.57,10313,9.1)
S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10313,21,1,0)
Last name of the Cardholder/Subscriber from the BPS claims file. 
"^DD",9002313.57,9002313.57,10314,0)
HOME PLAN^CJ3^^ ; ^S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,9)
^
"^DD",9002313.57,9002313.57,10314,9.01)

"^DD",9002313.57,9002313.57,10314,9.1)
S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates
"^DD",9002313.57,9002313.57,10314,21,2,0)
where the member's coverage has been designated. Usually where the member
"^DD",9002313.57,9002313.57,10314,21,3,0)
lives or purchased their coverage from the BPS claims file.
"^DD",9002313.57,9002313.57,10315,0)
EMPLOYER NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,9)
^
"^DD",9002313.57,9002313.57,10315,9.01)

"^DD",9002313.57,9002313.57,10315,9.1)
S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10315,21,1,0)
Complete name of employer. 
"^DD",9002313.57,9002313.57,10316,0)
EMPLOYER STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,9)
^
"^DD",9002313.57,9002313.57,10316,9.01)

"^DD",9002313.57,9002313.57,10316,9.1)
S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10316,21,1,0)
Free-form text for address information from the claims file.
"^DD",9002313.57,9002313.57,10317,0)
EMPLOYER CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,9)
^
"^DD",9002313.57,9002313.57,10317,9.01)

"^DD",9002313.57,9002313.57,10317,9.1)
S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10317,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10318,0)
EMPLOYER STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,9)
^
"^DD",9002313.57,9002313.57,10318,9.01)

"^DD",9002313.57,9002313.57,10318,9.1)
S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10319,0)
EMPLOYER ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,9)
^
"^DD",9002313.57,9002313.57,10319,9.01)

"^DD",9002313.57,9002313.57,10319,9.1)
S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10319,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10319,21,2,0)
(zip code for US).
"^DD",9002313.57,9002313.57,10320,0)
EMPLOYER PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,9)
^
"^DD",9002313.57,9002313.57,10320,9.01)

"^DD",9002313.57,9002313.57,10320,9.1)
S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.57,9002313.57,10321,0)
EMPLOYER CONTACT NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,9)
^
"^DD",9002313.57,9002313.57,10321,9.01)

"^DD",9002313.57,9002313.57,10321,9.1)
S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,21,0)
^^1^1^3040322^
"^DD",9002313.57,9002313.57,10321,21,1,0)
Contact persons' name of the cardholders' employer.
"^DD",9002313.57,9002313.57,10321,"DT")
3040322
"^DD",9002313.57,9002313.57,10322,0)
PATIENT STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,9)
^
"^DD",9002313.57,9002313.57,10322,9.01)

"^DD",9002313.57,9002313.57,10322,9.1)
S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10322,21,1,0)
Free-form text for Patient address information.
"^DD",9002313.57,9002313.57,10323,0)
PATIENT CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,9)
^
"^DD",9002313.57,9002313.57,10323,9.01)

"^DD",9002313.57,9002313.57,10323,9.1)
S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,21,0)
^.001^1^1^3031222^^
"^DD",9002313.57,9002313.57,10323,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10323,"DT")
3031222
"^DD",9002313.57,9002313.57,10324,0)
PATIENT STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,9)
^
"^DD",9002313.57,9002313.57,10324,9.01)

"^DD",9002313.57,9002313.57,10324,9.1)
S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10324,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10324,21,2,0)
Comes from the BPS claims file.
"^DD",9002313.57,9002313.57,10325,0)
PATIENT ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,9)
^
"^DD",9002313.57,9002313.57,10325,9.01)

"^DD",9002313.57,9002313.57,10325,9.1)
S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10325,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10325,21,2,0)
(zip code for US). From the BPS claims file.
"^DD",9002313.57,9002313.57,10326,0)
PATIENT PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,9)
^
"^DD",9002313.57,9002313.57,10326,9.01)

"^DD",9002313.57,9002313.57,10326,9.1)
S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10326,21,1,0)
Ten digit  phone number of patient. From the BPS claims file.
"^DD",9002313.57,9002313.57,10327,0)
CARRIER ID NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,9)
^
"^DD",9002313.57,9002313.57,10327,9.01)

"^DD",9002313.57,9002313.57,10327,9.1)
S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10327,21,1,0)
The ID number of the insurance carrier.
"^DD",9002313.57,9002313.57,10328,0)
PATIENT WEIGHT^CJ3^^ ; ^S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,9)
^
"^DD",9002313.57,9002313.57,10328,9.01)

"^DD",9002313.57,9002313.57,10328,9.1)
S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10328,21,1,0)
Patient's weight from the patient file.
"^DD",9002313.57,9002313.57,10329,0)
PATIENT SSN^CJ9^^ ; ^S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,9)
^
"^DD",9002313.57,9002313.57,10329,9.01)

"^DD",9002313.57,9002313.57,10329,9.1)
S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10329,21,1,0)
Patient SSN from the claims file.
"^DD",9002313.57,9002313.57,10401,0)
DATE FILLED^CJ8^^ ; ^S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,9)
^
"^DD",9002313.57,9002313.57,10401,9.01)

"^DD",9002313.57,9002313.57,10401,9.1)
S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10401,21,1,0)
The fill/refill date 
"^DD",9002313.57,9002313.57,10402,0)
PRESCRIPTION NUMBER^CJ7^^ ; ^S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,9)
^
"^DD",9002313.57,9002313.57,10402,9.01)

"^DD",9002313.57,9002313.57,10402,9.1)
S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10402,21,1,0)
  The first seven digits of the prescription IEN 
"^DD",9002313.57,9002313.57,10403,0)
NEW/REFILL CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,9)
^
"^DD",9002313.57,9002313.57,10403,9.01)

"^DD",9002313.57,9002313.57,10403,9.1)
S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10403,21,1,0)
The fill/refill number, starting at 0 for the original fill.
"^DD",9002313.57,9002313.57,10404,0)
METRIC QUANTITY^CJ5^^ ; ^S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,9)
^
"^DD",9002313.57,9002313.57,10404,9.01)

"^DD",9002313.57,9002313.57,10404,9.1)
S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10404,21,1,0)
Metric quantity of the drug.
"^DD",9002313.57,9002313.57,10405,0)
DAYS SUPPLY^CJ3^^ ; ^S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,9)
^
"^DD",9002313.57,9002313.57,10405,9.01)

"^DD",9002313.57,9002313.57,10405,9.1)
S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10405,21,1,0)
The actual days supply dispensed.
"^DD",9002313.57,9002313.57,10406,0)
COMPOUND CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,9)
^
"^DD",9002313.57,9002313.57,10406,9.01)

"^DD",9002313.57,9002313.57,10406,9.1)
S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,10406,21,1,0)
Field indicating whether this prescription was a compound (1) or not a
"^DD",9002313.57,9002313.57,10406,21,2,0)
compund (0). 
"^DD",9002313.57,9002313.57,10406,"DT")
3040331
"^DD",9002313.57,9002313.57,10407,0)
NDC NUMBER^CJ11^^ ; ^S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,9)
^
"^DD",9002313.57,9002313.57,10407,9.01)

"^DD",9002313.57,9002313.57,10407,9.1)
S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10407,21,1,0)
NDC code in our case.
"^DD",9002313.57,9002313.57,10408,0)
DISPENSE AS WRITTEN^CJ1^^ ; ^S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,9)
^
"^DD",9002313.57,9002313.57,10408,9.01)

"^DD",9002313.57,9002313.57,10408,9.1)
S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10408,21,1,0)
Indicator for whether the prescription was to be dispensed only as
"^DD",9002313.57,9002313.57,10408,21,2,0)
written. 
"^DD",9002313.57,9002313.57,10409,0)
INGREDIENT COST^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,9)
^
"^DD",9002313.57,9002313.57,10409,9.01)

"^DD",9002313.57,9002313.57,10409,9.1)
S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10409,21,1,0)
Cost amount for the ingredients of compounds. 
"^DD",9002313.57,9002313.57,10409,"DT")
3010405
"^DD",9002313.57,9002313.57,10410,0)
SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,9)
^
"^DD",9002313.57,9002313.57,10410,9.01)

"^DD",9002313.57,9002313.57,10410,9.1)
S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10410,21,1,0)
 Sales Tax charged (not applicable for VA)
"^DD",9002313.57,9002313.57,10411,0)
PRESCRIBER ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,9)
^
"^DD",9002313.57,9002313.57,10411,9.01)

"^DD",9002313.57,9002313.57,10411,9.1)
S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10411,21,1,0)
Prescriber identification number.  
"^DD",9002313.57,9002313.57,10412,0)
DISPENSING FEE SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,9)
^
"^DD",9002313.57,9002313.57,10412,9.01)

"^DD",9002313.57,9002313.57,10412,9.1)
S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10412,21,1,0)
Add-on fee charged in a retail setting.  This field will probably be used
"^DD",9002313.57,9002313.57,10412,21,2,0)
when the Tricare functionality is added.
"^DD",9002313.57,9002313.57,10414,0)
DATE PRESCRIPTION WRITTEN^CJ8^^ ; ^S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,9)
^
"^DD",9002313.57,9002313.57,10414,9.01)

"^DD",9002313.57,9002313.57,10414,9.1)
S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10414,21,1,0)
This will be the fill/refill date for local fills, the released date for
"^DD",9002313.57,9002313.57,10414,21,2,0)
CMOP.
"^DD",9002313.57,9002313.57,10415,0)
NUMBER OF REFILLS AUTHORIZED^CJ2^^ ; ^S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,9)
^
"^DD",9002313.57,9002313.57,10415,9.01)

"^DD",9002313.57,9002313.57,10415,9.1)
S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10415,21,1,0)
The number of refills allowed that was entered during order entry.
"^DD",9002313.57,9002313.57,10416,0)
PRIOR AUTH/MC CODE AND NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,9)
^
"^DD",9002313.57,9002313.57,10416,9.01)

"^DD",9002313.57,9002313.57,10416,9.1)
S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10416,21,1,0)
 Not used for VA - left in for IHS 
"^DD",9002313.57,9002313.57,10418,0)
LEVEL OF SERVICE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,9)
^
"^DD",9002313.57,9002313.57,10418,9.01)

"^DD",9002313.57,9002313.57,10418,9.1)
S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10418,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10419,0)
PRESCRIPTION ORIGIN CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,9)
^
"^DD",9002313.57,9002313.57,10419,9.01)

"^DD",9002313.57,9002313.57,10419,9.1)
S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10419,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10420,0)
PRESCRIPTION CLARIFICATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,9)
^
"^DD",9002313.57,9002313.57,10420,9.01)

"^DD",9002313.57,9002313.57,10420,9.1)
S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10420,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10421,0)
PRIMARY PRESCRIBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,9)
^
"^DD",9002313.57,9002313.57,10421,9.01)

"^DD",9002313.57,9002313.57,10421,9.1)
S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10421,21,1,0)
Provider ID number
"^DD",9002313.57,9002313.57,10422,0)
CLINIC ID NUMBER^CJ5^^ ; ^S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,9)
^
"^DD",9002313.57,9002313.57,10422,9.01)

"^DD",9002313.57,9002313.57,10422,9.1)
S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10422,21,1,0)
Clinic ID where the prescription was entered.
"^DD",9002313.57,9002313.57,10423,0)
BASIS OF COST DETERMINATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,9)
^
"^DD",9002313.57,9002313.57,10423,9.01)

"^DD",9002313.57,9002313.57,10423,9.1)
S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10423,21,1,0)
How the amount charged was arrived at.
"^DD",9002313.57,9002313.57,10424,0)
DIAGNOSIS CODE^CJ6^^ ; ^S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,9)
^
"^DD",9002313.57,9002313.57,10424,9.01)

"^DD",9002313.57,9002313.57,10424,9.1)
S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10424,21,1,0)
Diagnosis code that applies to this prescription.  Not used for third
"^DD",9002313.57,9002313.57,10424,21,2,0)
party billing as of this date - so it is not used, but may be used in the
"^DD",9002313.57,9002313.57,10424,21,3,0)
future.  
"^DD",9002313.57,9002313.57,10425,0)
DRUG TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,9)
^
"^DD",9002313.57,9002313.57,10425,9.01)

"^DD",9002313.57,9002313.57,10425,9.1)
S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10425,21,1,0)
Code to indicate the type of drug dispensed.  =Not specified 1=Single
"^DD",9002313.57,9002313.57,10425,21,2,0)
source brand 2=Branded generic 3=Generic 4=O.T.C. (over the counter)
"^DD",9002313.57,9002313.57,10426,0)
USUAL AND CUSTOMARY CHARGE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,9)
^
"^DD",9002313.57,9002313.57,10426,9.01)

"^DD",9002313.57,9002313.57,10426,9.1)
S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10426,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57,10426,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57,10426,"DT")
3010405
"^DD",9002313.57,9002313.57,10427,0)
PRESCRIBER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,9)
^
"^DD",9002313.57,9002313.57,10427,9.01)

"^DD",9002313.57,9002313.57,10427,9.1)
S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10427,21,1,0)
Last Name of the Prescriber
"^DD",9002313.57,9002313.57,10428,0)
POSTAGE AMOUNT CLAIMED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,9)
^
"^DD",9002313.57,9002313.57,10428,9.01)

"^DD",9002313.57,9002313.57,10428,9.1)
S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10428,21,1,0)
Dollar amount of postage claimed.
"^DD",9002313.57,9002313.57,10429,0)
UNIT DOSE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,9)
^
"^DD",9002313.57,9002313.57,10429,9.01)

"^DD",9002313.57,9002313.57,10429,9.1)
S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10429,21,1,0)
Code indicating the type of unit dose dispensing. =Not Specified 1=Not
"^DD",9002313.57,9002313.57,10429,21,2,0)
Unit Dose 2=Manufacturer Unit Dose 3=Pharmacy Unit Dose
"^DD",9002313.57,9002313.57,10430,0)
GROSS AMOUNT DUE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,9)
^
"^DD",9002313.57,9002313.57,10430,9.01)

"^DD",9002313.57,9002313.57,10430,9.1)
S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10430,21,1,0)
Total amount submitted to the payer. 
"^DD",9002313.57,9002313.57,10431,0)
OTHER PAYOR AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,9)
^
"^DD",9002313.57,9002313.57,10431,9.01)

"^DD",9002313.57,9002313.57,10431,9.1)
S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including
"^DD",9002313.57,9002313.57,10431,21,2,0)
coupons).
"^DD",9002313.57,9002313.57,10432,0)
BASIS OF DAYS SUPPLY DET^CJ1^^ ; ^S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,9)
^
"^DD",9002313.57,9002313.57,10432,9.01)

"^DD",9002313.57,9002313.57,10432,9.1)
S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10432,21,1,0)
Code indicating the method by which the days supply was determined. =Not
"^DD",9002313.57,9002313.57,10432,21,2,0)
specified 1=Explicit directions 2=PRN directions (take as needed
"^DD",9002313.57,9002313.57,10432,21,3,0)
pharmacist estimate) 3=As directed by physician
"^DD",9002313.57,9002313.57,10433,0)
PATIENT PAID AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,9)
^
"^DD",9002313.57,9002313.57,10433,9.01)

"^DD",9002313.57,9002313.57,10433,9.1)
S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10433,21,1,0)
Amount the pharmacy received from the patient for the prescription
"^DD",9002313.57,9002313.57,10433,21,2,0)
dispensed.
"^DD",9002313.57,9002313.57,10434,0)
DATE OF INJURY^CJ8^^ ; ^S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,9)
^
"^DD",9002313.57,9002313.57,10434,9.01)

"^DD",9002313.57,9002313.57,10434,9.1)
S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10434,21,1,0)
Date on which the injury occurred. 
"^DD",9002313.57,9002313.57,10435,0)
CLAIM/REF ID NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,9)
^
"^DD",9002313.57,9002313.57,10435,9.01)

"^DD",9002313.57,9002313.57,10435,9.1)
S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10435,21,1,0)
Identifies the claim number assigned by Workers Compensation Program.
"^DD",9002313.57,9002313.57,10436,0)
ALT. PRODUCT TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,9)
^
"^DD",9002313.57,9002313.57,10436,9.01)

"^DD",9002313.57,9002313.57,10436,9.1)
S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,21,0)
^^16^16^3031222^
"^DD",9002313.57,9002313.57,10436,21,1,0)
Code qualifying the value in 'Product/Service ID' (47-D7) Not Specified
"^DD",9002313.57,9002313.57,10436,21,2,0)
Blank Not Specified  Universal Product Code (UPC) 1 Health Related Item
"^DD",9002313.57,9002313.57,10436,21,3,0)
(HRI) 2 National Drug Code (NDC) 3 Universal Product Number (UPN) 4
"^DD",9002313.57,9002313.57,10436,21,4,0)
Department of Defense (DOD) 5 Drug Use Review/ Professional Pharmacy
"^DD",9002313.57,9002313.57,10436,21,5,0)
Service (DUR/PPS) 6 Common Procedure Terminology (CPT4) 7 Common
"^DD",9002313.57,9002313.57,10436,21,6,0)
Procedure Terminology (CPT5) 8 Health Care Financing Administration
"^DD",9002313.57,9002313.57,10436,21,7,0)
Common Procedural Coding System (HCPCS) 9 Pharmacy Practice Activity
"^DD",9002313.57,9002313.57,10436,21,8,0)
Classification (PPAC) 1 National Pharmaceutical Product Interface
"^DD",9002313.57,9002313.57,10436,21,9,0)
Code(NAPPI) 11 International Article Numbering System(EAN) 12 Drug
"^DD",9002313.57,9002313.57,10436,21,10,0)
Identification Number(DIN) 13 Medi-Span GPI 14 First DataBank GCN 15
"^DD",9002313.57,9002313.57,10436,21,11,0)
Medical Economics GPO 16 Medi-Span DDID 17 First DataBank SmartKey 18
"^DD",9002313.57,9002313.57,10436,21,12,0)
Medical Economics GM 19 International Classification of Diseases(ICD9) 2
"^DD",9002313.57,9002313.57,10436,21,13,0)
International Classification of Diseases (ICD10) 21 Medi-Span Diagnosis
"^DD",9002313.57,9002313.57,10436,21,14,0)
Code 22 Common Dental Terminology (CDT) 25 American Psychiatric
"^DD",9002313.57,9002313.57,10436,21,15,0)
Association Diagnostic Statistical Manual of Mental Disorders (DSM IV)
"^DD",9002313.57,9002313.57,10436,21,16,0)
Other       99
"^DD",9002313.57,9002313.57,10437,0)
ALT. PRODUCT CODE^CJ13^^ ; ^S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,9)
^
"^DD",9002313.57,9002313.57,10437,9.01)

"^DD",9002313.57,9002313.57,10437,9.1)
S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,21,0)
^^4^4^3031222^
"^DD",9002313.57,9002313.57,10437,21,1,0)
This field identifies the actual product code for the item that was
"^DD",9002313.57,9002313.57,10437,21,2,0)
dispensed.  The type of product is defined by field 436-E1. This field
"^DD",9002313.57,9002313.57,10437,21,3,0)
should only be used if the National Drug Code number is not available. The
"^DD",9002313.57,9002313.57,10437,21,4,0)
code number here is the UPC number or the HRI number
"^DD",9002313.57,9002313.57,10438,0)
INCENTIVE AMOUNT SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,9)
^
"^DD",9002313.57,9002313.57,10438,9.01)

"^DD",9002313.57,9002313.57,10438,9.1)
S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10438,21,1,0)
Amount represents a fee that is submitted by the pharmacy for
"^DD",9002313.57,9002313.57,10438,21,2,0)
contractually agreed upon services. This amount is included in the 'Gross
"^DD",9002313.57,9002313.57,10438,21,3,0)
Amount Due' (43-DU).  
"^DD",9002313.57,9002313.57,10439,0)
DUR CONFLICT CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,9)
^
"^DD",9002313.57,9002313.57,10439,9.01)

"^DD",9002313.57,9002313.57,10439,9.1)
S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10439,21,1,0)
Code identifying the type of utilization conflict detected or the reason
"^DD",9002313.57,9002313.57,10439,21,2,0)
for the pharmacist s professional service.
"^DD",9002313.57,9002313.57,10440,0)
DUR INTERVENTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,9)
^
"^DD",9002313.57,9002313.57,10440,9.01)

"^DD",9002313.57,9002313.57,10440,9.1)
S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10440,21,1,0)
Code to indicate whether an intervention was entered.
"^DD",9002313.57,9002313.57,10441,0)
DUR OUTCOME CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,9)
^
"^DD",9002313.57,9002313.57,10441,9.01)

"^DD",9002313.57,9002313.57,10441,9.1)
S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10441,21,1,0)
The outcome of the DUR - whether the prescription had to be modified.
"^DD",9002313.57,9002313.57,10442,0)
METRIC DECIMAL QUANTITY^CJ9,3^^ ; ^S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,9)
^
"^DD",9002313.57,9002313.57,10442,9.01)

"^DD",9002313.57,9002313.57,10442,9.1)
S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10442,21,1,0)
Quantity dispensed expressed in metric decimal units.
"^DD",9002313.57,9002313.57,10443,0)
OTHER PAYOR DATE^CJ8^^ ; ^S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,9)
^
"^DD",9002313.57,9002313.57,10443,9.01)

"^DD",9002313.57,9002313.57,10443,9.1)
S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used for
"^DD",9002313.57,9002313.57,10443,21,2,0)
coordination of benefits.
"^DD",9002313.57,9002313.57,10444,0)
PHARMACIST ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,9)
^
"^DD",9002313.57,9002313.57,10444,9.01)

"^DD",9002313.57,9002313.57,10444,9.1)
S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10444,21,1,0)
Unique ID assigned to the person responsible for the dispensing of the
"^DD",9002313.57,9002313.57,10444,21,2,0)
prescription or provision of the service.
"^DD",9002313.57,9002313.57,10501,0)
RESPONSE STATUS^CJ1^^ ; ^S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,9)
^
"^DD",9002313.57,9002313.57,10501,9.01)

"^DD",9002313.57,9002313.57,10501,9.1)
S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10501,21,1,0)
Status flag indicating whether the transaction was "P"aid, "R"ejected,
"^DD",9002313.57,9002313.57,10501,21,2,0)
"A"ccepted, or "C"aptured.
"^DD",9002313.57,9002313.57,10503,0)
AUTHORIZATION NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,9)
^
"^DD",9002313.57,9002313.57,10503,9.01)

"^DD",9002313.57,9002313.57,10503,9.1)
S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10503,21,1,0)
Authorization number for pre-authorization requests.
"^DD",9002313.57,9002313.57,10504,0)
MESSAGE^CJ200^^ ; ^S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,9)
^
"^DD",9002313.57,9002313.57,10504,9.01)

"^DD",9002313.57,9002313.57,10504,9.1)
S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10504,21,1,0)
Free form Message.
"^DD",9002313.57,9002313.57,10505,0)
PATIENT PAY AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,9)
^
"^DD",9002313.57,9002313.57,10505,9.01)

"^DD",9002313.57,9002313.57,10505,9.1)
S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10505,21,1,0)
Amount the patient pays (copay).
"^DD",9002313.57,9002313.57,10505,"DT")
3010405
"^DD",9002313.57,9002313.57,10506,0)
INGREDIENT COST PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,9)
^
"^DD",9002313.57,9002313.57,10506,9.01)

"^DD",9002313.57,9002313.57,10506,9.1)
S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10506,21,1,0)
Drug ingredient cost paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10507,0)
CONTRACT FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,9)
^
"^DD",9002313.57,9002313.57,10507,9.01)

"^DD",9002313.57,9002313.57,10507,9.1)
S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10507,21,1,0)
Dispensing fee paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10508,0)
SALES TAX PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,9)
^
"^DD",9002313.57,9002313.57,10508,9.01)

"^DD",9002313.57,9002313.57,10508,9.1)
S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10508,21,1,0)
The amount of sales tax paid for the prescription dispensed.
"^DD",9002313.57,9002313.57,10509,0)
TOTAL AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,9)
^
"^DD",9002313.57,9002313.57,10509,9.01)

"^DD",9002313.57,9002313.57,10509,9.1)
S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10509,21,1,0)
Total amount to be paid by the claims processor (i.e. pharmacy
"^DD",9002313.57,9002313.57,10509,21,2,0)
receivable). Represents a sum of 'Ingredient Cost Paid' (56), 'Dispensing
"^DD",9002313.57,9002313.57,10509,21,3,0)
Fee Paid' (57), 'Flat Sales Tax Amount Paid' (558), 'Percentage Sales Tax
"^DD",9002313.57,9002313.57,10509,21,4,0)
Amount Paid' (559), 'Incentive Amount Paid' (521), 'Professional Service
"^DD",9002313.57,9002313.57,10509,21,5,0)
Fee Paid' (562), 'Other Amount Paid' (565), less 'Patient Pay Amount'
"^DD",9002313.57,9002313.57,10509,21,6,0)
(55) and 'Other Payer Amount Recognized' (566).
"^DD",9002313.57,9002313.57,10510,0)
REJECT COUNT^CJ2^^ ; ^S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,9)
^
"^DD",9002313.57,9002313.57,10510,9.01)

"^DD",9002313.57,9002313.57,10510,9.1)
S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10510,21,1,0)
Count of 'Reject Code' (511) occurrences.
"^DD",9002313.57,9002313.57,10511,0)
REJECT CODES^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,9)
^
"^DD",9002313.57,9002313.57,10511,9.01)

"^DD",9002313.57,9002313.57,10511,9.1)
S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511,21,1,0)
Multiple rejection codes. 
"^DD",9002313.57,9002313.57,10511.01,0)
REJECT CODE #1^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,9)
^
"^DD",9002313.57,9002313.57,10511.01,9.01)

"^DD",9002313.57,9002313.57,10511.01,9.1)
S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.01,21,1,0)
Reject code #1 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.02,0)
REJECT CODE #2^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,9)
^
"^DD",9002313.57,9002313.57,10511.02,9.01)

"^DD",9002313.57,9002313.57,10511.02,9.1)
S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.02,21,1,0)
Reject code #2 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.03,0)
REJECT CODE #3^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,9)
^
"^DD",9002313.57,9002313.57,10511.03,9.01)

"^DD",9002313.57,9002313.57,10511.03,9.1)
S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.03,21,1,0)
Reject code #3 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.04,0)
REJECT CODE #4^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,9)
^
"^DD",9002313.57,9002313.57,10511.04,9.01)

"^DD",9002313.57,9002313.57,10511.04,9.1)
S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.04,21,1,0)
Reject code #4 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.05,0)
REJECT CODE #5^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,9)
^
"^DD",9002313.57,9002313.57,10511.05,9.01)

"^DD",9002313.57,9002313.57,10511.05,9.1)
S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.05,21,1,0)
Reject code #5 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.06,0)
REJECT CODE #6^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,9)
^
"^DD",9002313.57,9002313.57,10511.06,9.01)

"^DD",9002313.57,9002313.57,10511.06,9.1)
S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.06,21,1,0)
Reject code #6 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.07,0)
REJECT CODE #7^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,9)
^
"^DD",9002313.57,9002313.57,10511.07,9.01)

"^DD",9002313.57,9002313.57,10511.07,9.1)
S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.07,21,1,0)
Reject code #7 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.08,0)
REJECT CODE #8^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,9)
^
"^DD",9002313.57,9002313.57,10511.08,9.01)

"^DD",9002313.57,9002313.57,10511.08,9.1)
S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.08,21,1,0)
Reject code #8 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.09,0)
REJECT CODE #9^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,9)
^
"^DD",9002313.57,9002313.57,10511.09,9.01)

"^DD",9002313.57,9002313.57,10511.09,9.1)
S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.09,21,1,0)
Reject code #9 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.1,0)
REJECT CODE #10^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,9)
^
"^DD",9002313.57,9002313.57,10511.1,9.01)

"^DD",9002313.57,9002313.57,10511.1,9.1)
S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.1,21,1,0)
Reject code #10 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.11,0)
REJECT CODE #11^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,9)
^
"^DD",9002313.57,9002313.57,10511.11,9.01)

"^DD",9002313.57,9002313.57,10511.11,9.1)
S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.11,21,1,0)
Reject code #11 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.11,"DT")
3010405
"^DD",9002313.57,9002313.57,10511.12,0)
REJECT CODE #12^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,9)
^
"^DD",9002313.57,9002313.57,10511.12,9.01)

"^DD",9002313.57,9002313.57,10511.12,9.1)
S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.12,21,1,0)
Reject code #12 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.13,0)
REJECT CODE #13^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,9)
^
"^DD",9002313.57,9002313.57,10511.13,9.01)

"^DD",9002313.57,9002313.57,10511.13,9.1)
S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.13,21,1,0)
Reject code #13 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.14,0)
REJECT CODE #14^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,9)
^
"^DD",9002313.57,9002313.57,10511.14,9.01)

"^DD",9002313.57,9002313.57,10511.14,9.1)
S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.14,21,1,0)
Reject code #14 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.15,0)
REJECT CODE #15^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,9)
^
"^DD",9002313.57,9002313.57,10511.15,9.01)

"^DD",9002313.57,9002313.57,10511.15,9.1)
S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.15,21,1,0)
Reject code #15 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.16,0)
REJECT CODE #16^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,9)
^
"^DD",9002313.57,9002313.57,10511.16,9.01)

"^DD",9002313.57,9002313.57,10511.16,9.1)
S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.16,21,1,0)
Reject code #16 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.17,0)
REJECT CODE #17^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,9)
^
"^DD",9002313.57,9002313.57,10511.17,9.01)

"^DD",9002313.57,9002313.57,10511.17,9.1)
S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.17,21,1,0)
Reject code #17 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.18,0)
REJECT CODE #18^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,9)
^
"^DD",9002313.57,9002313.57,10511.18,9.01)

"^DD",9002313.57,9002313.57,10511.18,9.1)
S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.18,21,1,0)
Reject code #18 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.19,0)
REJECT CODE #19^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,9)
^
"^DD",9002313.57,9002313.57,10511.19,9.01)

"^DD",9002313.57,9002313.57,10511.19,9.1)
S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.19,21,1,0)
Reject code #19 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.2,0)
REJECT CODE #20^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,9)
^
"^DD",9002313.57,9002313.57,10511.2,9.01)

"^DD",9002313.57,9002313.57,10511.2,9.1)
S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.2,21,1,0)
Reject code #20 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10512,0)
ACCUMULATED DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,9)
^
"^DD",9002313.57,9002313.57,10512,9.01)

"^DD",9002313.57,9002313.57,10512,9.1)
S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10512,21,1,0)
Amount in dollars met by the patient/family in a deductible plan.
"^DD",9002313.57,9002313.57,10513,0)
REMAINING DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,9)
^
"^DD",9002313.57,9002313.57,10513,9.01)

"^DD",9002313.57,9002313.57,10513,9.1)
S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10513,21,1,0)
Amount not met by the patient/family in the deductible plan.
"^DD",9002313.57,9002313.57,10514,0)
REMAINING BENEFIT AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,9)
^
"^DD",9002313.57,9002313.57,10514,9.01)

"^DD",9002313.57,9002313.57,10514,9.1)
S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10514,21,1,0)
Amount remaining in a patient/family plan with a periodic maximum benefit.
"^DD",9002313.57,9002313.57,10515,0)
POSTAGE AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,9)
^
"^DD",9002313.57,9002313.57,10515,9.01)

"^DD",9002313.57,9002313.57,10515,9.1)
S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10515,21,1,0)
Not applicable to the VA.
"^DD",9002313.57,9002313.57,10516,0)
DRUG DESCRIPTION^CJ30^^ ; ^S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,9)
^
"^DD",9002313.57,9002313.57,10516,9.01)

"^DD",9002313.57,9002313.57,10516,9.1)
S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10516,21,1,0)
Text description for the drug from the drug file 50.
"^DD",9002313.57,9002313.57,10517,0)
AMOUNT APP TO PER DEDUCTIBLE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,9)
^
"^DD",9002313.57,9002313.57,10517,9.01)

"^DD",9002313.57,9002313.57,10517,9.1)
S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10517,21,1,0)
Amount to be collected from a patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10517,21,2,0)
Amount' (55) that is applied to a periodic deductible.
"^DD",9002313.57,9002313.57,10518,0)
AMOUNT OF CO-PAY/CO-INSURANCE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,9)
^
"^DD",9002313.57,9002313.57,10518,9.01)

"^DD",9002313.57,9002313.57,10518,9.1)
S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10518,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10518,21,2,0)
Amount' (55) that is due to a per prescription copay/coinsurance.
"^DD",9002313.57,9002313.57,10519,0)
AMOUNT ATTR TO PRODUCT SELECT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,9)
^
"^DD",9002313.57,9002313.57,10519,9.01)

"^DD",9002313.57,9002313.57,10519,9.1)
S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10519,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10519,21,2,0)
Amount' (55) that is due to the patient's selection of drug product.
"^DD",9002313.57,9002313.57,10520,0)
AMOUNT EXCEED PER BENEFIT MAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,9)
^
"^DD",9002313.57,9002313.57,10520,9.01)

"^DD",9002313.57,9002313.57,10520,9.1)
S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10520,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10520,21,2,0)
Amount' (55) that is due to the patient exceeding a periodic benefit
"^DD",9002313.57,9002313.57,10520,21,3,0)
maximum.
"^DD",9002313.57,9002313.57,10521,0)
INCENTIVE FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,9)
^
"^DD",9002313.57,9002313.57,10521,9.01)

"^DD",9002313.57,9002313.57,10521,9.1)
S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10521,21,1,0)
Amount represents the contractually agreed upon incentive fee paid for
"^DD",9002313.57,9002313.57,10521,21,2,0)
specific services rendered. Amount is included in the 'Total Amount Paid'
"^DD",9002313.57,9002313.57,10521,21,3,0)
(59).
"^DD",9002313.57,9002313.57,10521,"DT")
3010405
"^DD",9002313.57,9002313.57,10522,0)
BASIS OF REIMBURSEMENT DET^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,9)
^
"^DD",9002313.57,9002313.57,10522,9.01)

"^DD",9002313.57,9002313.57,10522,9.1)
S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10522,21,1,0)
Code identifying how the reimbursement amount was calculated for
"^DD",9002313.57,9002313.57,10522,21,2,0)
'Ingredient Cost Paid' (56).
"^DD",9002313.57,9002313.57,10523,0)
AMOUNT ATTRIBUTED TO SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,9)
^
"^DD",9002313.57,9002313.57,10523,9.01)

"^DD",9002313.57,9002313.57,10523,9.1)
S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10523,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10523,21,2,0)
Amount' (55) that is due to sales tax paid.
"^DD",9002313.57,9002313.57,10524,0)
PLAN ID^CJ8^^ ; ^S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,9)
^
"^DD",9002313.57,9002313.57,10524,9.01)

"^DD",9002313.57,9002313.57,10524,9.1)
S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10524,21,1,0)
Plan Identification Number.
"^DD",9002313.57,9002313.57,10525,0)
DUR RESPONSE DATA^CJ160^^ ; ^S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,9)
^
"^DD",9002313.57,9002313.57,10525,9.01)

"^DD",9002313.57,9002313.57,10525,9.1)
S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.57,9002313.57,10525.01,0)
DUR COUNT^CJ1^^ ; ^X ^DD(9002313.57,10525.01,9.5) S X=$S(Y(9002313.57,10525.01,2):Y(9002313.57,10525.01,3),Y(9002313.57,10525.01,5):Y(9002313.57,10525.01,6),Y(9002313.57,10525.01,8):Y(9002313.57,10525.01,9),Y(9002313.57,10525.01,10):X)
"^DD",9002313.57,9002313.57,10525.01,9)
^
"^DD",9002313.57,9002313.57,10525.01,9.01)
9002313.57^10525.3;9002313.57^10525.2;9002313.57^10525.1
"^DD",9002313.57,9002313.57,10525.01,9.1)
$S(DUR #1 RAW DATA="":0,DUR #2 RAW DATA="":1,DUR #3 RAW DATA="":2,1:3)
"^DD",9002313.57,9002313.57,10525.01,9.2)
X $P(^DD(9002313.57,10525.1,0),U,5,99) S Y(9002313.57,10525.01,1)=X X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.01,4)=X
"^DD",9002313.57,9002313.57,10525.01,9.3)
X ^DD(9002313.57,10525.01,9.2) X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.01,7)=X S X=Y(9002313.57,10525.01,1)="",Y(9002313.57,10525.01,2)=X S X=0
"^DD",9002313.57,9002313.57,10525.01,9.4)
X ^DD(9002313.57,10525.01,9.3) S Y(9002313.57,10525.01,3)=X S X=Y(9002313.57,10525.01,4)="",Y(9002313.57,10525.01,5)=X S X=1,Y(9002313.57,10525.01,6)=X
"^DD",9002313.57,9002313.57,10525.01,9.5)
X ^DD(9002313.57,10525.01,9.4) S X=Y(9002313.57,10525.01,7)="",Y(9002313.57,10525.01,8)=X S X=2,Y(9002313.57,10525.01,9)=X S X=1,Y(9002313.57,10525.01,10)=X S X=3
"^DD",9002313.57,9002313.57,10525.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.01,21,1,0)
Number of DUR messages to be displayed.
"^DD",9002313.57,9002313.57,10525.1,0)
DUR #1 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.1,9.5) S X=$S(Y(9002313.57,10525.1,4):Y(9002313.57,10525.1,5),Y(9002313.57,10525.1,6):X)
"^DD",9002313.57,9002313.57,10525.1,9)
^
"^DD",9002313.57,9002313.57,10525.1,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1,9.1)
$S($E(DUR RESPONSE DATA,1,2)="  ":"",1:$E(DUR RESPONSE DATA,1,53))
"^DD",9002313.57,9002313.57,10525.1,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1,1)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,2)=X S X=1,Y(9002313.57,10525.1,3)=X S X=2
"^DD",9002313.57,9002313.57,10525.1,9.3)
X ^DD(9002313.57,10525.1,9.2) S X=$E(Y(9002313.57,10525.1,2),Y(9002313.57,10525.1,3),X)="  ",Y(9002313.57,10525.1,4)=X S X="",Y(9002313.57,10525.1,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.4)
X ^DD(9002313.57,10525.1,9.3) S Y(9002313.57,10525.1,6)=X,Y(9002313.57,10525.1,7)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,8)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.5)
X ^DD(9002313.57,10525.1,9.4) S Y(9002313.57,10525.1,9)=X S X=53,X=$E(Y(9002313.57,10525.1,8),Y(9002313.57,10525.1,9),X)
"^DD",9002313.57,9002313.57,10525.1,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.1,21,1,0)
Raw Data DUR message sent from the payer and stored in the response file.
"^DD",9002313.57,9002313.57,10525.1439,0)
DUR #1 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.1439,9.2) S Y(9002313.57,10525.1439,3)=X S X=2,X=$E(Y(9002313.57,10525.1439,2),Y(9002313.57,10525.1439,3),X)
"^DD",9002313.57,9002313.57,10525.1439,9)
^
"^DD",9002313.57,9002313.57,10525.1439,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1439,9.1)
$E(DUR RESPONSE DATA,1,2)
"^DD",9002313.57,9002313.57,10525.1439,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1439,1)=X S X=Y(9002313.57,10525.1439,1),Y(9002313.57,10525.1439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.1439,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.1439,21,1,0)
Severity level code for the first DUR.
"^DD",9002313.57,9002313.57,10525.1528,0)
DUR #1 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.1528,9.2) S X=$E(Y(9002313.57,10525.1528,2),X)
"^DD",9002313.57,9002313.57,10525.1528,9)
^
"^DD",9002313.57,9002313.57,10525.1528,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1528,9.1)
$E(DUR RESPONSE DATA,3)
"^DD",9002313.57,9002313.57,10525.1528,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1528,1)=X S X=Y(9002313.57,10525.1528,1),Y(9002313.57,10525.1528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.1528,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.1528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.1528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.1528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.1528,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.1529,0)
DUR #1 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1529,9.2) S X=$E(Y(9002313.57,10525.1529,2),X)
"^DD",9002313.57,9002313.57,10525.1529,9)
^
"^DD",9002313.57,9002313.57,10525.1529,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1529,9.1)
$E(DUR RESPONSE DATA,4)
"^DD",9002313.57,9002313.57,10525.1529,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1529,1)=X S X=Y(9002313.57,10525.1529,1),Y(9002313.57,10525.1529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.1529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.1529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.1529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.153,0)
DUR #1 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.153,9.2) S Y(9002313.57,10525.153,3)=X S X=12,X=$E(Y(9002313.57,10525.153,2),Y(9002313.57,10525.153,3),X)
"^DD",9002313.57,9002313.57,10525.153,9)
^
"^DD",9002313.57,9002313.57,10525.153,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.153,9.1)
$E(DUR RESPONSE DATA,5,12)
"^DD",9002313.57,9002313.57,10525.153,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.153,1)=X S X=Y(9002313.57,10525.153,1),Y(9002313.57,10525.153,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.153,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.153,21,1,0)
Previous fill date
"^DD",9002313.57,9002313.57,10525.1531,0)
DUR #1 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.1531,9.2) S Y(9002313.57,10525.1531,3)=X S X=17,X=$E(Y(9002313.57,10525.1531,2),Y(9002313.57,10525.1531,3),X)
"^DD",9002313.57,9002313.57,10525.1531,9)
^
"^DD",9002313.57,9002313.57,10525.1531,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1531,9.1)
$E(DUR RESPONSE DATA,13,17)
"^DD",9002313.57,9002313.57,10525.1531,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1531,1)=X S X=Y(9002313.57,10525.1531,1),Y(9002313.57,10525.1531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.1531,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10525.1531,21,1,0)
The quantity of the previous fill that caused the DUR to be triggered.
"^DD",9002313.57,9002313.57,10525.1532,0)
DUR #1 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.1532,9.2) S X=$E(Y(9002313.57,10525.1532,2),X)
"^DD",9002313.57,9002313.57,10525.1532,9)
^
"^DD",9002313.57,9002313.57,10525.1532,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1532,9.1)
$E(DUR RESPONSE DATA,18)
"^DD",9002313.57,9002313.57,10525.1532,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1532,1)=X S X=Y(9002313.57,10525.1532,1),Y(9002313.57,10525.1532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.1532,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.1532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.1532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.1532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.1532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.1532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.1533,0)
DUR #1 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1533,9.2) S X=$E(Y(9002313.57,10525.1533,2),X)
"^DD",9002313.57,9002313.57,10525.1533,9)
^
"^DD",9002313.57,9002313.57,10525.1533,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1533,9.1)
$E(DUR RESPONSE DATA,19)
"^DD",9002313.57,9002313.57,10525.1533,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1533,1)=X S X=Y(9002313.57,10525.1533,1),Y(9002313.57,10525.1533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.1533,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.1533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.1533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.1533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.1533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.1533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.1544,0)
DUR #1 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.1544,9.2) S Y(9002313.57,10525.1544,3)=X S X=49,X=$E(Y(9002313.57,10525.1544,2),Y(9002313.57,10525.1544,3),X)
"^DD",9002313.57,9002313.57,10525.1544,9)
^
"^DD",9002313.57,9002313.57,10525.1544,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1544,9.1)
$E(DUR RESPONSE DATA,20,49)
"^DD",9002313.57,9002313.57,10525.1544,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1544,1)=X S X=Y(9002313.57,10525.1544,1),Y(9002313.57,10525.1544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.1544,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.1544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.1999,0)
DUR #1 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.1999,9.2) S Y(9002313.57,10525.1999,3)=X S X=53,X=$E(Y(9002313.57,10525.1999,2),Y(9002313.57,10525.1999,3),X)
"^DD",9002313.57,9002313.57,10525.1999,9)
^
"^DD",9002313.57,9002313.57,10525.1999,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1999,9.1)
$E(DUR RESPONSE DATA,50,53)
"^DD",9002313.57,9002313.57,10525.1999,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1999,1)=X S X=Y(9002313.57,10525.1999,1),Y(9002313.57,10525.1999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.1999,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.1999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.2,0)
DUR #2 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.2,9.5) S X=$S(Y(9002313.57,10525.2,4):Y(9002313.57,10525.2,5),Y(9002313.57,10525.2,6):X)
"^DD",9002313.57,9002313.57,10525.2,9)
^
"^DD",9002313.57,9002313.57,10525.2,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.2,9.1)
$S($E(DUR RESPONSE DATA,54,55)="  ":"",1:$E(DUR RESPONSE DATA,54,106))
"^DD",9002313.57,9002313.57,10525.2,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.2,1)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,2)=X S X=54,Y(9002313.57,10525.2,3)=X S X=55
"^DD",9002313.57,9002313.57,10525.2,9.3)
X ^DD(9002313.57,10525.2,9.2) S X=$E(Y(9002313.57,10525.2,2),Y(9002313.57,10525.2,3),X)="  ",Y(9002313.57,10525.2,4)=X S X="",Y(9002313.57,10525.2,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.2,9.4)
X ^DD(9002313.57,10525.2,9.3) S Y(9002313.57,10525.2,6)=X,Y(9002313.57,10525.2,7)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,8)=X S X=54
"^DD",9002313.57,9002313.57,10525.2,9.5)
X ^DD(9002313.57,10525.2,9.4) S Y(9002313.57,10525.2,9)=X S X=106,X=$E(Y(9002313.57,10525.2,8),Y(9002313.57,10525.2,9),X)
"^DD",9002313.57,9002313.57,10525.2,21,0)
^.001^2^2^3040106^^
"^DD",9002313.57,9002313.57,10525.2,21,1,0)
DUR information returned by the payor that has not been formatted
"^DD",9002313.57,9002313.57,10525.2,21,2,0)
yet.
"^DD",9002313.57,9002313.57,10525.2439,0)
DUR #2 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.2439,9.2) S Y(9002313.57,10525.2439,3)=X S X=2,X=$E(Y(9002313.57,10525.2439,2),Y(9002313.57,10525.2439,3),X)
"^DD",9002313.57,9002313.57,10525.2439,9)
^
"^DD",9002313.57,9002313.57,10525.2439,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2439,9.1)
$E(DUR #2 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.2439,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2439,1)=X S X=Y(9002313.57,10525.2439,1),Y(9002313.57,10525.2439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.2439,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.2528,0)
DUR #2 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.2528,9.2) S X=$E(Y(9002313.57,10525.2528,2),X)
"^DD",9002313.57,9002313.57,10525.2528,9)
^
"^DD",9002313.57,9002313.57,10525.2528,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2528,9.1)
$E(DUR #2 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.2528,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2528,1)=X S X=Y(9002313.57,10525.2528,1),Y(9002313.57,10525.2528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.2528,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.2528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.2528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.2529,0)
DUR #2 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2529,9.2) S X=$E(Y(9002313.57,10525.2529,2),X)
"^DD",9002313.57,9002313.57,10525.2529,9)
^
"^DD",9002313.57,9002313.57,10525.2529,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2529,9.1)
$E(DUR #2 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.2529,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2529,1)=X S X=Y(9002313.57,10525.2529,1),Y(9002313.57,10525.2529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.2529,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.253,0)
DUR #2 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.253,9.2) S Y(9002313.57,10525.253,3)=X S X=12,X=$E(Y(9002313.57,10525.253,2),Y(9002313.57,10525.253,3),X)
"^DD",9002313.57,9002313.57,10525.253,9)
^
"^DD",9002313.57,9002313.57,10525.253,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.253,9.1)
$E(DUR #2 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.253,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.253,1)=X S X=Y(9002313.57,10525.253,1),Y(9002313.57,10525.253,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.253,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.253,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.2531,0)
DUR #2 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.2531,9.2) S Y(9002313.57,10525.2531,3)=X S X=17,X=$E(Y(9002313.57,10525.2531,2),Y(9002313.57,10525.2531,3),X)
"^DD",9002313.57,9002313.57,10525.2531,9)
^
"^DD",9002313.57,9002313.57,10525.2531,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2531,9.1)
$E(DUR #2 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.2531,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2531,1)=X S X=Y(9002313.57,10525.2531,1),Y(9002313.57,10525.2531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.2531,21,0)
^.001^1^1^3040106^^^
"^DD",9002313.57,9002313.57,10525.2531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.2532,0)
DUR #2 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.2532,9.2) S X=$E(Y(9002313.57,10525.2532,2),X)
"^DD",9002313.57,9002313.57,10525.2532,9)
^
"^DD",9002313.57,9002313.57,10525.2532,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2532,9.1)
$E(DUR #2 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.2532,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2532,1)=X S X=Y(9002313.57,10525.2532,1),Y(9002313.57,10525.2532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.2532,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.2532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.2532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.2532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.2532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.2532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.2533,0)
DUR #2 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2533,9.2) S X=$E(Y(9002313.57,10525.2533,2),X)
"^DD",9002313.57,9002313.57,10525.2533,9)
^
"^DD",9002313.57,9002313.57,10525.2533,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2533,9.1)
$E(DUR #2 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.2533,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2533,1)=X S X=Y(9002313.57,10525.2533,1),Y(9002313.57,10525.2533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.2533,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.2533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.2533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.2533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.2533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.2533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.2544,0)
DUR #2 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.2544,9.2) S Y(9002313.57,10525.2544,3)=X S X=49,X=$E(Y(9002313.57,10525.2544,2),Y(9002313.57,10525.2544,3),X)
"^DD",9002313.57,9002313.57,10525.2544,9)
^
"^DD",9002313.57,9002313.57,10525.2544,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2544,9.1)
$E(DUR #2 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.2544,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2544,1)=X S X=Y(9002313.57,10525.2544,1),Y(9002313.57,10525.2544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.2544,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.2544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.2999,0)
DUR #2 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.2999,9.2) S Y(9002313.57,10525.2999,3)=X S X=53,X=$E(Y(9002313.57,10525.2999,2),Y(9002313.57,10525.2999,3),X)
"^DD",9002313.57,9002313.57,10525.2999,9)
^
"^DD",9002313.57,9002313.57,10525.2999,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2999,9.1)
$E(DUR #2 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.2999,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2999,1)=X S X=Y(9002313.57,10525.2999,1),Y(9002313.57,10525.2999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.2999,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.2999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.3,0)
DUR #3 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.3,9.5) S X=$S(Y(9002313.57,10525.3,4):Y(9002313.57,10525.3,5),Y(9002313.57,10525.3,6):X)
"^DD",9002313.57,9002313.57,10525.3,9)
^
"^DD",9002313.57,9002313.57,10525.3,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.3,9.1)
$S($E(DUR RESPONSE DATA,107,108)="  ":"",1:$E(DUR RESPONSE DATA,107,159))
"^DD",9002313.57,9002313.57,10525.3,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.3,1)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,2)=X S X=107,Y(9002313.57,10525.3,3)=X S X=108
"^DD",9002313.57,9002313.57,10525.3,9.3)
X ^DD(9002313.57,10525.3,9.2) S X=$E(Y(9002313.57,10525.3,2),Y(9002313.57,10525.3,3),X)="  ",Y(9002313.57,10525.3,4)=X S X="",Y(9002313.57,10525.3,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.3,9.4)
X ^DD(9002313.57,10525.3,9.3) S Y(9002313.57,10525.3,6)=X,Y(9002313.57,10525.3,7)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,8)=X S X=107
"^DD",9002313.57,9002313.57,10525.3,9.5)
X ^DD(9002313.57,10525.3,9.4) S Y(9002313.57,10525.3,9)=X S X=159,X=$E(Y(9002313.57,10525.3,8),Y(9002313.57,10525.3,9),X)
"^DD",9002313.57,9002313.57,10525.3,21,0)
^^2^2^3040106^
"^DD",9002313.57,9002313.57,10525.3,21,1,0)
DUR information returned by the payor that has not been formatted
"^DD",9002313.57,9002313.57,10525.3,21,2,0)
yet.
"^DD",9002313.57,9002313.57,10525.3439,0)
DUR #3 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.3439,9.2) S Y(9002313.57,10525.3439,3)=X S X=2,X=$E(Y(9002313.57,10525.3439,2),Y(9002313.57,10525.3439,3),X)
"^DD",9002313.57,9002313.57,10525.3439,9)
^
"^DD",9002313.57,9002313.57,10525.3439,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3439,9.1)
$E(DUR #3 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.3439,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3439,1)=X S X=Y(9002313.57,10525.3439,1),Y(9002313.57,10525.3439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.3439,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.3528,0)
DUR #3 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.3528,9.2) S X=$E(Y(9002313.57,10525.3528,2),X)
"^DD",9002313.57,9002313.57,10525.3528,9)
^
"^DD",9002313.57,9002313.57,10525.3528,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3528,9.1)
$E(DUR #3 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.3528,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3528,1)=X S X=Y(9002313.57,10525.3528,1),Y(9002313.57,10525.3528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.3528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.3528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.3528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.3529,0)
DUR #3 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3529,9.2) S X=$E(Y(9002313.57,10525.3529,2),X)
"^DD",9002313.57,9002313.57,10525.3529,9)
^
"^DD",9002313.57,9002313.57,10525.3529,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3529,9.1)
$E(DUR #3 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.3529,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3529,1)=X S X=Y(9002313.57,10525.3529,1),Y(9002313.57,10525.3529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.3529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.353,0)
DUR #3 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.353,9.2) S Y(9002313.57,10525.353,3)=X S X=12,X=$E(Y(9002313.57,10525.353,2),Y(9002313.57,10525.353,3),X)
"^DD",9002313.57,9002313.57,10525.353,9)
^
"^DD",9002313.57,9002313.57,10525.353,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.353,9.1)
$E(DUR #3 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.353,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.353,1)=X S X=Y(9002313.57,10525.353,1),Y(9002313.57,10525.353,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.353,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.353,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.3531,0)
DUR #3 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.3531,9.2) S Y(9002313.57,10525.3531,3)=X S X=17,X=$E(Y(9002313.57,10525.3531,2),Y(9002313.57,10525.3531,3),X)
"^DD",9002313.57,9002313.57,10525.3531,9)
^
"^DD",9002313.57,9002313.57,10525.3531,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3531,9.1)
$E(DUR #3 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.3531,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3531,1)=X S X=Y(9002313.57,10525.3531,1),Y(9002313.57,10525.3531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.3531,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.3531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.3531,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.3532,0)
DUR #3 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.3532,9.2) S X=$E(Y(9002313.57,10525.3532,2),X)
"^DD",9002313.57,9002313.57,10525.3532,9)
^
"^DD",9002313.57,9002313.57,10525.3532,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3532,9.1)
$E(DUR #3 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.3532,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3532,1)=X S X=Y(9002313.57,10525.3532,1),Y(9002313.57,10525.3532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.3532,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10525.3532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.3532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.3532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.3532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.3532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.3533,0)
DUR #3 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3533,9.2) S X=$E(Y(9002313.57,10525.3533,2),X)
"^DD",9002313.57,9002313.57,10525.3533,9)
^
"^DD",9002313.57,9002313.57,10525.3533,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3533,9.1)
$E(DUR #3 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.3533,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3533,1)=X S X=Y(9002313.57,10525.3533,1),Y(9002313.57,10525.3533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.3533,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10525.3533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.3533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.3533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.3533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.3533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.3544,0)
DUR #3 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.3544,9.2) S Y(9002313.57,10525.3544,3)=X S X=49,X=$E(Y(9002313.57,10525.3544,2),Y(9002313.57,10525.3544,3),X)
"^DD",9002313.57,9002313.57,10525.3544,9)
^
"^DD",9002313.57,9002313.57,10525.3544,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3544,9.1)
$E(DUR #3 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.3544,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3544,1)=X S X=Y(9002313.57,10525.3544,1),Y(9002313.57,10525.3544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.3544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.3544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.3999,0)
DUR #3 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.3999,9.2) S Y(9002313.57,10525.3999,3)=X S X=53,X=$E(Y(9002313.57,10525.3999,2),Y(9002313.57,10525.3999,3),X)
"^DD",9002313.57,9002313.57,10525.3999,9)
^
"^DD",9002313.57,9002313.57,10525.3999,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3999,9.1)
$E(DUR #3 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.3999,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3999,1)=X S X=Y(9002313.57,10525.3999,1),Y(9002313.57,10525.3999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.3999,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.3999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10526,0)
ADDITIONAL MESSAGE INFORMATION^CJ200^^ ; ^S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,9)
^
"^DD",9002313.57,9002313.57,10526,9.01)

"^DD",9002313.57,9002313.57,10526,9.1)
S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10526,21,1,0)
Free text, additional information from the payor.
"^DD",9002313.57,9002313.57,10528,0)
CLINICAL SIGNIFICANCE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,9)
^
"^DD",9002313.57,9002313.57,10528,9.01)

"^DD",9002313.57,9002313.57,10528,9.1)
S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10529,0)
OTHER PHARMACY INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,9)
^
"^DD",9002313.57,9002313.57,10529,9.01)

"^DD",9002313.57,9002313.57,10529,9.1)
S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10530,0)
PREVIOUS DATE OF FILL^CJ8^^ ; ^S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,9)
^
"^DD",9002313.57,9002313.57,10530,9.01)

"^DD",9002313.57,9002313.57,10530,9.1)
S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10530,21,1,0)
Fill date of the prescription causing the DUR conflict.
"^DD",9002313.57,9002313.57,10531,0)
QUANTITY OF PREVIOUS FILL^CJ5^^ ; ^S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,9)
^
"^DD",9002313.57,9002313.57,10531,9.01)

"^DD",9002313.57,9002313.57,10531,9.1)
S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10531,21,1,0)
Quantity of the prescription causing the conflict.
"^DD",9002313.57,9002313.57,10532,0)
DATABASE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,9)
^
"^DD",9002313.57,9002313.57,10532,9.01)

"^DD",9002313.57,9002313.57,10532,9.1)
S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10533,0)
OTHER PRESCRIBER INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,9)
^
"^DD",9002313.57,9002313.57,10533,9.01)

"^DD",9002313.57,9002313.57,10533,9.1)
S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,21,0)
^^3^3^3040106^
"^DD",9002313.57,9002313.57,10533,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10533,21,2,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10533,21,3,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10535,0)
DUR OVERFLOW^CJ1^^ ; ^S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,9)
^
"^DD",9002313.57,9002313.57,10535,9.01)

"^DD",9002313.57,9002313.57,10535,9.1)
S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,21,0)
^^2^2^3040106^
"^DD",9002313.57,9002313.57,10535,21,1,0)
Additional DUR information that did not fit in the other 
"^DD",9002313.57,9002313.57,10535,21,2,0)
fields provided.
"^DD",9002313.57,9002313.57,10544,0)
FREE TEXT^CJ30^^ ; ^S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,9)
^
"^DD",9002313.57,9002313.57,10544,9.01)

"^DD",9002313.57,9002313.57,10544,9.1)
S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10544,21,1,0)
Even more room for additional free text DUR information.
"^DD",9002313.57,9002313.57111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.57,9002313.57111,0,"DT")
3050527
"^DD",9002313.57,9002313.57111,0,"IX","B",9002313.57111,.01)

"^DD",9002313.57,9002313.57111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.57,9002313.57111,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57111,.01,1,0)
^.1
"^DD",9002313.57,9002313.57111,.01,1,1,0)
9002313.57111^B
"^DD",9002313.57,9002313.57111,.01,1,1,1)
S ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57111,.01,1,1,2)
K ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57111,.01,21,0)
^.001^1^1^3050527^^^
"^DD",9002313.57,9002313.57111,.01,21,1,0)
To store user's comment date
"^DD",9002313.57,9002313.57111,.01,"DT")
3050527
"^DD",9002313.57,9002313.57111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.57,9002313.57111,.02,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57111,.02,21,1,0)
ECME user
"^DD",9002313.57,9002313.57111,.02,"DT")
3050527
"^DD",9002313.57,9002313.57111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.57,9002313.57111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.57,9002313.57111,.03,21,0)
^^1^1^3050527^
"^DD",9002313.57,9002313.57111,.03,21,1,0)
Comment text
"^DD",9002313.57,9002313.57111,.03,"DT")
3050527
"^DD",9002313.57,9002313.5713,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.57,9002313.5713,0,"DT")
3050615
"^DD",9002313.57,9002313.5713,0,"IX","B",9002313.5713,.01)

"^DD",9002313.57,9002313.5713,0,"NM","DUR DATA")

"^DD",9002313.57,9002313.5713,0,"UP")
9002313.57
"^DD",9002313.57,9002313.5713,.01,0)
DUR COUNTER^NJ4,0^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.57,9002313.5713,.01,1,0)
^.1
"^DD",9002313.57,9002313.5713,.01,1,1,0)
9002313.5713^B
"^DD",9002313.57,9002313.5713,.01,1,1,1)
S ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.5713,.01,1,1,2)
K ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.5713,.01,3)
Type a number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.57,9002313.5713,.01,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,.01,21,1,0)
This is the field used to populate the 473-7E field of the claim
"^DD",9002313.57,9002313.5713,.01,"DT")
3050615
"^DD",9002313.57,9002313.5713,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,1,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,1,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,1,21,1,0)
This is the field used to populate the 439-E4 field of the claim
"^DD",9002313.57,9002313.5713,1,"DT")
3050615
"^DD",9002313.57,9002313.5713,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,2,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,2,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,2,21,1,0)
This is the field used to populate the 440-E5 field of the claim
"^DD",9002313.57,9002313.5713,2,"DT")
3050615
"^DD",9002313.57,9002313.5713,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,3,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,3,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,3,21,1,0)
This is the field used to populate the 441-E6 field of the claim
"^DD",9002313.57,9002313.5713,3,"DT")
3050615
"^DD",9002313.57,9002313.57902,0)
VA PINS MULTIPLE SUB-FIELD^^902.27^25
"^DD",9002313.57,9002313.57902,0,"DT")
3061122
"^DD",9002313.57,9002313.57902,0,"IX","B",9002313.57902,.01)

"^DD",9002313.57,9002313.57902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.57,9002313.57902,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.57,9002313.57902,.01,1,0)
^.1
"^DD",9002313.57,9002313.57902,.01,1,1,0)
9002313.57902^B
"^DD",9002313.57,9002313.57902,.01,1,1,1)
S ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57902,.01,1,1,2)
K ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57902,.01,3)
Enter the group insurance record
"^DD",9002313.57,9002313.57902,.01,21,0)
^^1^1^3050727^
"^DD",9002313.57,9002313.57902,.01,21,1,0)
Insurance plan id sent from the IB API
"^DD",9002313.57,9002313.57902,.01,"DT")
3050727
"^DD",9002313.57,9002313.57902,902.02,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.57,9002313.57902,902.02,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.02,21,1,0)
Payer sheet IEN to be used with the associated insurer.
"^DD",9002313.57,9002313.57902,902.02,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.03,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.57,9002313.57902,902.03,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.04,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.04,21,1,0)
Processor control number assigned for the payer sheet.
"^DD",9002313.57,9002313.57902,902.04,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.57,9002313.57902,902.05,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.57,9002313.57902,902.05,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57902,902.06,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.06,21,1,0)
Insured person
"^DD",9002313.57,9002313.57902,902.06,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.07,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.57,9002313.57902,902.07,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.57,9002313.57902,902.07,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.08,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57902,902.08,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.08,21,1,0)
First name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.08,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57902,902.09,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.09,21,1,0)
Last name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.09,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.11,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage.
"^DD",9002313.57,9002313.57902,902.11,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.12,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this
"^DD",9002313.57,9002313.57902,902.12,21,2,0)
prescription. 
"^DD",9002313.57,9002313.57902,902.12,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.13,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.57,9002313.57902,902.13,21,2,0)
calculated.
"^DD",9002313.57,9002313.57902,902.13,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.14,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.14,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57902,902.14,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.15,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.15,21,0)
^^9^9^3031217^
"^DD",9002313.57,9002313.57902,902.15,21,1,0)
 Total price claimed from all sources.  For prescription claim request,
"^DD",9002313.57,9002313.57902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted' (49-D9),
"^DD",9002313.57,9002313.57902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9).
"^DD",9002313.57,9002313.57902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional
"^DD",9002313.57,9002313.57902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,9,0)
'Other Amount Claimed' (48-H9)
"^DD",9002313.57,9002313.57902,902.15,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.16,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.16,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.16,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.57,9002313.57902,902.16,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.17,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.17,3)
Answer must be 1-3 characters in length.
"^DD",9002313.57,9002313.57902,902.17,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.17,21,1,0)
Which fill/refill this transaction is for.
"^DD",9002313.57,9002313.57902,902.17,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.18,0)
SOFTWARE VENDOR/CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57902,902.18,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.18,21,1,0)
Certification number assigned by payer to the sending entity,
"^DD",9002313.57,9002313.57902,902.18,21,2,0)
allowing claims to be sent.
"^DD",9002313.57,9002313.57902,902.18,"DT")
3030729
"^DD",9002313.57,9002313.57902,902.19,0)
B2 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.57,9002313.57902,902.19,3)
Enter the Reversal payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.19,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57902,902.19,21,1,0)
Enter the Reversal payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.19,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.21,0)
B3 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.57,9002313.57902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.21,21,0)
^^1^1^3031112^
"^DD",9002313.57,9002313.57902,902.21,21,1,0)
Enter the Rebill payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.21,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE ON;1:CERTIFY MODE OFF;^0;5^Q
"^DD",9002313.57,9002313.57902,902.22,3)
Enter null or 0 for Certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.57,9002313.57902,902.22,21,0)
^.001^1^1^3040421^^
"^DD",9002313.57,9002313.57902,902.22,21,1,0)
Enter null or 0 for Certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.57,9002313.57902,902.22,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.23,0)
CERTIFICATION IEN^P9002313.31'^BPS(9002313.31,^0;6^Q
"^DD",9002313.57,9002313.57902,902.23,3)
Enter the certification record
"^DD",9002313.57,9002313.57902,902.23,21,0)
^^2^2^3061122^
"^DD",9002313.57,9002313.57902,902.23,21,1,0)
This field is used during certification testing, and contains the pointer 
"^DD",9002313.57,9002313.57902,902.23,21,2,0)
to the Certification file 9002313.31.
"^DD",9002313.57,9002313.57902,902.23,"DT")
3061122
"^DD",9002313.57,9002313.57902,902.24,0)
PLAN NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.57,9002313.57902,902.24,21,0)
^^1^1^3041014^
"^DD",9002313.57,9002313.57902,902.24,21,1,0)
This field is the Plan Name for the insurance being filed.
"^DD",9002313.57,9002313.57902,902.24,"DT")
3041014
"^DD",9002313.57,9002313.57902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.57,9002313.57902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.57,9002313.57902,902.25,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.25,21,1,0)
This is the Group Name for the Group Insurance file
"^DD",9002313.57,9002313.57902,902.25,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.26,0)
INSURANCE CO PHONE #^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.57,9002313.57902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.57,9002313.57902,902.26,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.26,21,1,0)
This is the Claims (RX) phone number from the Insurance Company file
"^DD",9002313.57,9002313.57902,902.26,"DT")
3050615
"^DD",9002313.57,9002313.57902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.57,9002313.57902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.57,9002313.57902,902.27,21,1,0)
This is a ID of the Plan file
"^DD",9002313.57,9002313.57902,902.27,"DT")
3050617
"^DD",9002313.58,9002313.58,0)
FIELD^^208^15
"^DD",9002313.58,9002313.58,0,"DDA")
N
"^DD",9002313.58,9002313.58,0,"DT")
3061101
"^DD",9002313.58,9002313.58,0,"IX","B",9002313.58,.01)

"^DD",9002313.58,9002313.58,0,"NM","BPS STATISTICS")

"^DD",9002313.58,9002313.58,0,"VRPK")
BPS
"^DD",9002313.58,9002313.58,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.58,9002313.58,.01,1,0)
^.1
"^DD",9002313.58,9002313.58,.01,1,1,0)
9002313.58^B
"^DD",9002313.58,9002313.58,.01,1,1,1)
S ^BPSECX("S","B",$E(X,1,30),DA)=""
"^DD",9002313.58,9002313.58,.01,1,1,2)
K ^BPSECX("S","B",$E(X,1,30),DA)
"^DD",9002313.58,9002313.58,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.58,9002313.58,.01,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,.01,21,1,0)
Name of the Statistical group.
"^DD",9002313.58,9002313.58,.01,"DT")
3031217
"^DD",9002313.58,9002313.58,2,0)
Date/Time Cleared^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.58,9002313.58,2,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,2,21,1,0)
Date and time that the claim cleared the queue.
"^DD",9002313.58,9002313.58,2,"DT")
2991111
"^DD",9002313.58,9002313.58,101,0)
Submissions - Total^NJ9,0^^S;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,101,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,101,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,101,21,1,0)
Total number of submissions to ECME.
"^DD",9002313.58,9002313.58,101,"DT")
2991111
"^DD",9002313.58,9002313.58,102,0)
Submissions - Unique^NJ9,0^^S;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,102,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,102,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,102,21,1,0)
Total number of unique claim submissions to ECME.
"^DD",9002313.58,9002313.58,102,"DT")
2991111
"^DD",9002313.58,9002313.58,103,0)
Submissions - Repeat^NJ9,0^^S;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,103,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,103,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,103,21,1,0)
Total number of repeat claim submissions to ECME.
"^DD",9002313.58,9002313.58,103,"DT")
2991111
"^DD",9002313.58,9002313.58,200,0)
Result - Count^CJ9,0^^ ; ^S X=$G(^BPSECX("S",D0,"R")),X=$P(X,U,2)+$P(X,U,3)+$P(X,U,4)+$P(X,U,5)
"^DD",9002313.58,9002313.58,200,9)
^
"^DD",9002313.58,9002313.58,200,9.01)

"^DD",9002313.58,9002313.58,200,9.1)
S X=$G(^BPSECX("S",D0,"R")),X=$P(X,U,2)+$P(X,U,3)+$P(X,U,4)+$P(X,U,5)
"^DD",9002313.58,9002313.58,200,21,0)
^^1^1^3040331^
"^DD",9002313.58,9002313.58,200,21,1,0)
Total number of claims for which a response was received.
"^DD",9002313.58,9002313.58,200,"DT")
3040331
"^DD",9002313.58,9002313.58,201,0)
Result - Unbillable^NJ9,0^^R;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,201,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,201,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,201,21,1,0)
Total number of claims that were unbillable.
"^DD",9002313.58,9002313.58,201,"DT")
2991111
"^DD",9002313.58,9002313.58,202,0)
Result - Rejected^NJ9,0^^R;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,202,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,202,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,202,21,1,0)
Total number of claims that were rejected by the payer.
"^DD",9002313.58,9002313.58,202,"DT")
2991111
"^DD",9002313.58,9002313.58,203,0)
Result - Paid^NJ9,0^^R;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,203,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,203,21,0)
^^1^1^3040322^
"^DD",9002313.58,9002313.58,203,21,1,0)
Total number of claims that were paid by the payer.
"^DD",9002313.58,9002313.58,203,"DT")
2991111
"^DD",9002313.58,9002313.58,204,0)
Result - Duplicate^NJ9,0^^R;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,204,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,204,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,204,21,1,0)
Total number of claims for which a duplicate result was received.
"^DD",9002313.58,9002313.58,204,"DT")
2991111
"^DD",9002313.58,9002313.58,205,0)
Result - Captured^NJ9,0^^R;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,205,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,205,21,0)
^^2^2^3031217^
"^DD",9002313.58,9002313.58,205,21,1,0)
Total number of claims that was captured by the payer but has not been 
"^DD",9002313.58,9002313.58,205,21,2,0)
adjudicated by the payer yet.
"^DD",9002313.58,9002313.58,205,"DT")
2991111
"^DD",9002313.58,9002313.58,206,0)
Result - Accepted Reversal^NJ9,0^^R;6^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.58,9002313.58,206,3)
Enter the number of accepted reversals (0-999,999,999)
"^DD",9002313.58,9002313.58,206,21,0)
^^1^1^3061101^
"^DD",9002313.58,9002313.58,206,21,1,0)
This field holds the number of reversals that are accepted
"^DD",9002313.58,9002313.58,206,"DT")
3061101
"^DD",9002313.58,9002313.58,207,0)
Result - Rejected Reversal^NJ9,0^^R;7^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.58,9002313.58,207,3)
Enter the number of rejected reversals (0-999,999,999)
"^DD",9002313.58,9002313.58,207,21,0)
^^1^1^3061101^
"^DD",9002313.58,9002313.58,207,21,1,0)
This field holds the number of rejected reversals
"^DD",9002313.58,9002313.58,207,"DT")
3061101
"^DD",9002313.58,9002313.58,208,0)
Result - Dropped to Paper^NJ9,0^^R;8^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.58,9002313.58,208,3)
Enter the number of claims dropped to paper (0-999,999,999)
"^DD",9002313.58,9002313.58,208,21,0)
^^1^1^3061101^
"^DD",9002313.58,9002313.58,208,21,1,0)
This field stores the number of claims that were dropped to paper
"^DD",9002313.58,9002313.58,208,"DT")
3061101
"^DD",9002313.58,9002313.58,219,0)
Result - Other^NJ9,0^^R;19^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,219,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,219,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,219,21,1,0)
Total number of claims that did not fall into the other categories.
"^DD",9002313.58,9002313.58,219,"DT")
2991111
"^DD",9002313.59,9002313.59,0)
FIELD^^508^51
"^DD",9002313.59,9002313.59,0,"DDA")
N
"^DD",9002313.59,9002313.59,0,"DT")
3070627
"^DD",9002313.59,9002313.59,0,"IX","AC",9002313.59,5)

"^DD",9002313.59,9002313.59,0,"IX","AD",9002313.59,1)

"^DD",9002313.59,9002313.59,0,"IX","AE",9002313.59,3)

"^DD",9002313.59,9002313.59,0,"IX","AER",9002313.59,401)

"^DD",9002313.59,9002313.59,0,"IX","AF",9002313.59,4)

"^DD",9002313.59,9002313.59,0,"IX","AFR",9002313.59,402)

"^DD",9002313.59,9002313.59,0,"IX","AG",9002313.59,13)

"^DD",9002313.59,9002313.59,0,"IX","AH",9002313.59,7)

"^DD",9002313.59,9002313.59,0,"IX","B",9002313.59,.01)

"^DD",9002313.59,9002313.59,0,"NM","BPS TRANSACTION")

"^DD",9002313.59,9002313.59,0,"PT",9002313.4,101.06)

"^DD",9002313.59,9002313.59,0,"PT",9002313.92,1.11)

"^DD",9002313.59,9002313.59,0,"VRPK")
BPS
"^DD",9002313.59,9002313.59,.01,0)
ENTRY#^RF^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,.01,1,0)
^.1
"^DD",9002313.59,9002313.59,.01,1,1,0)
9002313.59^B
"^DD",9002313.59,9002313.59,.01,1,1,1)
S ^BPST("B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,.01,1,1,2)
K ^BPST("B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,.01,21,0)
^.001^1^1^3040326^^
"^DD",9002313.59,9002313.59,.01,21,1,0)
Transaction entry number.
"^DD",9002313.59,9002313.59,.01,"DT")
3031125
"^DD",9002313.59,9002313.59,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1,1,0)
^.1
"^DD",9002313.59,9002313.59,1,1,1,0)
9002313.59^AD
"^DD",9002313.59,9002313.59,1,1,1,1)
S ^BPST("AD",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,1,1,1,2)
K ^BPST("AD",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,1,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1,21,0)
^^3^3^3070227^
"^DD",9002313.59,9002313.59,1,21,1,0)
The status of the transaction as a percentage of completion.  The text 
"^DD",9002313.59,9002313.59,1,21,2,0)
value can be obtained by running $$STATI^BPSOSU(<Status Number>).  Note 
"^DD",9002313.59,9002313.59,1,21,3,0)
that 99 indicates complete.
"^DD",9002313.59,9002313.59,1,"DT")
3070227
"^DD",9002313.59,9002313.59,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.59,9002313.59,1.07,21,0)
^^1^1^3040322^
"^DD",9002313.59,9002313.59,1.07,21,1,0)
Textual description of the Pharmacy involved with this transaction.
"^DD",9002313.59,9002313.59,1.07,"DT")
3031125
"^DD",9002313.59,9002313.59,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1.08,21,0)
^^5^5^3000318^^
"^DD",9002313.59,9002313.59,1.08,21,1,0)
Pointer to which of the PINS pieces in ^(6) is in use for this claim.
"^DD",9002313.59,9002313.59,1.08,21,2,0)
Use this to keep track of where you are in billing down the line to
"^DD",9002313.59,9002313.59,1.08,21,3,0)
various insurers.   (Probably won't automatically roll over to next
"^DD",9002313.59,9002313.59,1.08,21,4,0)
insurer, but maybe we will have an option to edit insurance info, try next
"^DD",9002313.59,9002313.59,1.08,21,5,0)
insurance, etc.)
"^DD",9002313.59,9002313.59,1.08,"DT")
3000318
"^DD",9002313.59,9002313.59,1.09,0)
PRIOR AUTHORIZATION #^F^^1;9^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.59,9002313.59,1.09,3)
Enter the prior authorization number (1-11 characters)
"^DD",9002313.59,9002313.59,1.09,21,0)
^^2^2^3070221^
"^DD",9002313.59,9002313.59,1.09,21,1,0)
Number assigned by the processor to identify a prior authorized
"^DD",9002313.59,9002313.59,1.09,21,2,0)
transaction.
"^DD",9002313.59,9002313.59,1.09,"DT")
3070221
"^DD",9002313.59,9002313.59,1.11,0)
ABSBRXI^P52'^PSRX(^1;11^Q
"^DD",9002313.59,9002313.59,1.11,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.11,21,1,0)
Pointer from the RX file into BPS Transactions.
"^DD",9002313.59,9002313.59,1.11,"DT")
3031125
"^DD",9002313.59,9002313.59,1.1199,0)
RXI INTERNAL^CJ8^^ ; ^S Y(9002313.59,1.1199,1)=$S($D(^BPST(D0,1)):^(1),1:"") S X=$P(Y(9002313.59,1.1199,1),U,11),X=X
"^DD",9002313.59,9002313.59,1.1199,9)
^
"^DD",9002313.59,9002313.59,1.1199,9.01)
9002313.59^1.11
"^DD",9002313.59,9002313.59,1.1199,9.1)
INTERNAL(ABSBRXI)
"^DD",9002313.59,9002313.59,1.1199,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.59,9002313.59,1.1199,"DT")
3031125
"^DD",9002313.59,9002313.59,1.12,0)
RESUBMIT AFTER REVERSAL^S^1:RESUBMIT AFTER REVERSAL;0:DONE;2:RESUBMITTING;^1;12^Q
"^DD",9002313.59,9002313.59,1.12,3)
Enter the status of the resubmit
"^DD",9002313.59,9002313.59,1.12,21,0)
^.001^1^1^3051207^^^
"^DD",9002313.59,9002313.59,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.59,9002313.59,1.12,"DT")
3051207
"^DD",9002313.59,9002313.59,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.59,9002313.59,1.13,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,1.13,21,1,0)
Override information for the NCPDP fields.
"^DD",9002313.59,9002313.59,1.13,"DT")
3001019
"^DD",9002313.59,9002313.59,1.15,0)
PRIOR AUTHORIZATION TYPE CODE^F^^1;15^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,1.15,3)
Enter the prior authorization type (1-2 characters)
"^DD",9002313.59,9002313.59,1.15,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.15,21,1,0)
Indicates the type of authorization made before transaction was submitted.
"^DD",9002313.59,9002313.59,1.15,"DT")
3070314
"^DD",9002313.59,9002313.59,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.59,9002313.59,3,1,0)
^.1
"^DD",9002313.59,9002313.59,3,1,1,0)
9002313.59^AE
"^DD",9002313.59,9002313.59,3,1,1,1)
S ^BPST("AE",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,3,1,1,2)
K ^BPST("AE",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,3,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,3,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3,21,1,0)
Claim number for this transaction.
"^DD",9002313.59,9002313.59,3,"DT")
3031125
"^DD",9002313.59,9002313.59,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.59,3.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,3.1,1),U,4),X=X
"^DD",9002313.59,9002313.59,3.1,9)
^
"^DD",9002313.59,9002313.59,3.1,9.01)
9002313.59^3
"^DD",9002313.59,9002313.59,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.59,9002313.59,3.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3.1,21,1,0)
Claim internal identifier for this transaction.
"^DD",9002313.59,9002313.59,3.1,"DT")
3031125
"^DD",9002313.59,9002313.59,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.59,9002313.59,4,1,0)
^.1
"^DD",9002313.59,9002313.59,4,1,1,0)
9002313.59^AF
"^DD",9002313.59,9002313.59,4,1,1,1)
S ^BPST("AF",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,4,1,1,2)
K ^BPST("AF",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,4,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,4,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4,21,1,0)
Textual description of the response to this submission.
"^DD",9002313.59,9002313.59,4,"DT")
3031125
"^DD",9002313.59,9002313.59,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,9)
^
"^DD",9002313.59,9002313.59,4.0098,9.01)

"^DD",9002313.59,9002313.59,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0098,21,1,0)
The overall result.
"^DD",9002313.59,9002313.59,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,9)
^
"^DD",9002313.59,9002313.59,4.0099,9.01)

"^DD",9002313.59,9002313.59,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0099,21,1,0)
The result of the transmission.
"^DD",9002313.59,9002313.59,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.59,4.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,4.1,1),U,5),X=X
"^DD",9002313.59,9002313.59,4.1,9)
^
"^DD",9002313.59,9002313.59,4.1,9.01)
9002313.59^4
"^DD",9002313.59,9002313.59,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.59,9002313.59,4.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4.1,21,1,0)
Internal identifier for the response.
"^DD",9002313.59,9002313.59,4.1,"DT")
3031125
"^DD",9002313.59,9002313.59,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.59,9002313.59,5,1,0)
^.1
"^DD",9002313.59,9002313.59,5,1,1,0)
9002313.59^AC
"^DD",9002313.59,9002313.59,5,1,1,1)
S ^BPST("AC",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,5,1,1,2)
K ^BPST("AC",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,5,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,5,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,5,21,1,0)
Patient name.
"^DD",9002313.59,9002313.59,5,"DT")
3040609
"^DD",9002313.59,9002313.59,6,0)
SUBMIT DATE/TIME^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,6,3)
Enter the date/time that the claim was submitted
"^DD",9002313.59,9002313.59,6,21,0)
^^1^1^3070207^
"^DD",9002313.59,9002313.59,6,21,1,0)
This is the date/time that the RX/Fill was submitted to ECME
"^DD",9002313.59,9002313.59,6,"DT")
3070207
"^DD",9002313.59,9002313.59,7,0)
LAST UPDATE^D^^0;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,7,1,0)
^.1
"^DD",9002313.59,9002313.59,7,1,1,0)
9002313.59^AH
"^DD",9002313.59,9002313.59,7,1,1,1)
S ^BPST("AH",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,7,1,1,2)
K ^BPST("AH",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,7,1,1,"DT")
2991028
"^DD",9002313.59,9002313.59,7,3)

"^DD",9002313.59,9002313.59,7,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,7,21,1,0)
Last date this record was updated.
"^DD",9002313.59,9002313.59,7,"DT")
3031125
"^DD",9002313.59,9002313.59,9,0)
ABSBRXR^F^^1;1^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.59,9002313.59,9,3)
Answer must be 1-5 characters in length.
"^DD",9002313.59,9002313.59,9,21,0)
^.001^1^1^3040120^^
"^DD",9002313.59,9002313.59,9,21,1,0)
Prescription number IEN.
"^DD",9002313.59,9002313.59,9,"DT")
2991025
"^DD",9002313.59,9002313.59,10,0)
ABSBNDC^F^^1;2^K:$L(X)>11!($L(X)<5) X
"^DD",9002313.59,9002313.59,10,3)
Answer must be 5-11 characters in length.
"^DD",9002313.59,9002313.59,10,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,10,21,1,0)
The NDC number of the drug involved in this transaction.
"^DD",9002313.59,9002313.59,10,"DT")
3031006
"^DD",9002313.59,9002313.59,10.0099,0)
USER-INTERNAL^CJ8^^ ; ^S Y(9002313.59,10.0099,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,10.0099,1),U,10),X=X
"^DD",9002313.59,9002313.59,10.0099,9)
^
"^DD",9002313.59,9002313.59,10.0099,9.01)
9002313.59^13
"^DD",9002313.59,9002313.59,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.59,9002313.59,10.0099,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,10.0099,21,1,0)
The DUZ of the user who sent the transaction.
"^DD",9002313.59,9002313.59,10.0099,"DT")
3040331
"^DD",9002313.59,9002313.59,11,0)
ABSBDIV^F^^1;4^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.59,9002313.59,11,3)
Answer must be 1-5 characters in length
"^DD",9002313.59,9002313.59,11,21,0)
^^1^1^3061213^
"^DD",9002313.59,9002313.59,11,21,1,0)
The division ID for the transaction.
"^DD",9002313.59,9002313.59,11,"DT")
3061213
"^DD",9002313.59,9002313.59,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.59,9002313.59,13,1,0)
^.1
"^DD",9002313.59,9002313.59,13,1,1,0)
9002313.59^AG
"^DD",9002313.59,9002313.59,13,1,1,1)
S ^BPST("AG",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,13,1,1,2)
K ^BPST("AG",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,13,1,1,"DT")
2991026
"^DD",9002313.59,9002313.59,13,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,13,21,1,0)
User name who entered this tranaction.
"^DD",9002313.59,9002313.59,13,"DT")
3040331
"^DD",9002313.59,9002313.59,14,0)
POSITION IN CLAIM^NJ2,0^^0;9^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,14,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,14,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,14,21,1,0)
Sequential order in the claim transactions.
"^DD",9002313.59,9002313.59,14,"DT")
3031125
"^DD",9002313.59,9002313.59,15,0)
START TIME^D^^0;11^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,15,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,15,21,1,0)
Time this transaction was started.
"^DD",9002313.59,9002313.59,15,"DT")
3031126
"^DD",9002313.59,9002313.59,111,0)
COMMENT MULTIPLE^9002313.59111DA^^11;0
"^DD",9002313.59,9002313.59,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.59,9002313.59,111,21,1,0)
User's comment
"^DD",9002313.59,9002313.59,111,"DT")
3050627
"^DD",9002313.59,9002313.59,201,0)
RESULT CODE^NJ11,7^^2;1^K:+X'=X!(X>999.999)!(X<0)!(X?.E1"."8N.N) X
"^DD",9002313.59,9002313.59,201,3)
Type a Number between 0 and 999.999, 7 Decimal Digits
"^DD",9002313.59,9002313.59,201,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,201,21,1,0)
Code indicated the result of the adjudication of this claim.
"^DD",9002313.59,9002313.59,201,"DT")
3031126
"^DD",9002313.59,9002313.59,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.59,9002313.59,202,3)
Answer must be 1-200 characters in length.
"^DD",9002313.59,9002313.59,202,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,202,21,1,0)
Textual explanation of the result code.
"^DD",9002313.59,9002313.59,202,"DT")
3031126
"^DD",9002313.59,9002313.59,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.59,9002313.59,401,1,0)
^.1
"^DD",9002313.59,9002313.59,401,1,1,0)
9002313.59^AER
"^DD",9002313.59,9002313.59,401,1,1,1)
S ^BPST("AER",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,401,1,1,2)
K ^BPST("AER",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,401,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,401,1,1,"%D",1,0)
^BPST("AER",reversal claim #,IEN59)=""
"^DD",9002313.59,9002313.59,401,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,401,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,401,21,1,0)
Request to reverse this claim.
"^DD",9002313.59,9002313.59,401,"DT")
3031125
"^DD",9002313.59,9002313.59,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.59,9002313.59,402,1,0)
^.1
"^DD",9002313.59,9002313.59,402,1,1,0)
9002313.59^AFR
"^DD",9002313.59,9002313.59,402,1,1,1)
S ^BPST("AFR",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,402,1,1,2)
K ^BPST("AFR",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,402,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,402,1,1,"%D",1,0)
^BPST("AFR",reversal response,IEN59)=""
"^DD",9002313.59,9002313.59,402,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,402,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,402,21,1,0)
Response to reversal message.
"^DD",9002313.59,9002313.59,402,"DT")
3031125
"^DD",9002313.59,9002313.59,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.59,9002313.59,404,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,404,21,1,0)
Reason for the reversal
"^DD",9002313.59,9002313.59,404,"DT")
3050525
"^DD",9002313.59,9002313.59,501,0)
QUANTITY^NJ10,3^^5;1^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."4.N) X
"^DD",9002313.59,9002313.59,501,3)
Type a number between -999999 and 999999, 3 Decimal Digits
"^DD",9002313.59,9002313.59,501,21,0)
^^1^1^3070625^
"^DD",9002313.59,9002313.59,501,21,1,0)
Enter the billing quantity for the prescription.
"^DD",9002313.59,9002313.59,501,"DT")
3070625
"^DD",9002313.59,9002313.59,502,0)
UNIT PRICE^NJ14,6^^5;2^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,502,3)
Type a Number between 0 and 9999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,502,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.59,9002313.59,502,"DT")
3031126
"^DD",9002313.59,9002313.59,503,0)
SUBTOTAL^NJ13,6^^5;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,503,3)
Type a Number between 0 and 999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,503,21,0)
^^3^3^3000313^
"^DD",9002313.59,9002313.59,503,21,1,0)
= QUANTITY * UNIT PRICE
"^DD",9002313.59,9002313.59,503,21,2,0)
This is probably what we want to send as the INGREDIENT COST field in the
"^DD",9002313.59,9002313.59,503,21,3,0)
NCPDP message.
"^DD",9002313.59,9002313.59,503,"DT")
3000313
"^DD",9002313.59,9002313.59,504,0)
DISPENSING FEE^NJ5,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99)!(X<0) X
"^DD",9002313.59,9002313.59,504,3)
Type a Dollar Amount between 0 and 99, 2 Decimal Digits
"^DD",9002313.59,9002313.59,504,21,0)
^^2^2^3000313^
"^DD",9002313.59,9002313.59,504,21,1,0)
Storing it here, since it can vary by insurer (or maybe by Pharmacy, too?
"^DD",9002313.59,9002313.59,504,21,2,0)
maybe we want to put a field in 9002313.56)
"^DD",9002313.59,9002313.59,504,"DT")
3000313
"^DD",9002313.59,9002313.59,505,0)
TOTAL PRICE^NJ9,2O^^5;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<0) X
"^DD",9002313.59,9002313.59,505,2)
S Y(0)=Y S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,2.1)
S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,3)
Type a Dollar Amount between 0 and 999999, 2 Decimal Digits
"^DD",9002313.59,9002313.59,505,21,0)
^^1^1^3000313^
"^DD",9002313.59,9002313.59,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.59,9002313.59,505,"DT")
3040116
"^DD",9002313.59,9002313.59,507,0)
ADMINISTRATIVE FEE^F^^5;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,507,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,507,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,507,21,1,0)
Any fee charged for handling of the paperwork.
"^DD",9002313.59,9002313.59,507,"DT")
3031126
"^DD",9002313.59,9002313.59,508,0)
UNIT OF MEASURE^F^^5;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,508,3)
Enter the Unit of Measure (1-2 characters)
"^DD",9002313.59,9002313.59,508,21,0)
^^2^2^3070627^
"^DD",9002313.59,9002313.59,508,21,1,0)
Enter the Unit of Measure for the drug.  This is usually GR (grams), ML 
"^DD",9002313.59,9002313.59,508,21,2,0)
(milliliters), or EA (Each).
"^DD",9002313.59,9002313.59,508,"DT")
3070627
"^DD",9002313.59,9002313.59,801,0)
RETRY AFTER^D^^8;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,801,21,0)
^^2^2^3000621^
"^DD",9002313.59,9002313.59,801,21,1,0)
Due to dial out error or insurer asleep, retry this claim no earlier than
"^DD",9002313.59,9002313.59,801,21,2,0)
this time.  (May provide some way to poke it into activity, overriding this.)
"^DD",9002313.59,9002313.59,801,"DT")
3000621
"^DD",9002313.59,9002313.59,803,0)
RETRY SLEEPING INSURER^P9002313.92'^BPSF(9002313.92,^8;3^Q
"^DD",9002313.59,9002313.59,803,3)
Enter the payer sheet associated with the sleeping insurer
"^DD",9002313.59,9002313.59,803,21,0)
^^1^1^3061102^
"^DD",9002313.59,9002313.59,803,21,1,0)
This is the payer sheet used by the pharmacy plan that is asleep
"^DD",9002313.59,9002313.59,803,"DT")
3061102
"^DD",9002313.59,9002313.59,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,901,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,901,21,1,0)
The insurer being submitted to currently, if there are Primary, Secondary,
"^DD",9002313.59,9002313.59,901,21,2,0)
and tertiary insurers defined.
"^DD",9002313.59,9002313.59,901,"DT")
3030626
"^DD",9002313.59,9002313.59,902,0)
VA PINS MULTIPLE^9002313.59902PA^^10;0
"^DD",9002313.59,9002313.59,902,21,0)
^.001^1^1^3050119^^^^
"^DD",9002313.59,9002313.59,902,21,1,0)
List of the insurers for the patient.
"^DD",9002313.59,9002313.59,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.59,9002313.59,1201,3)
Answer must be 1-4 characters in length.
"^DD",9002313.59,9002313.59,1201,21,0)
^^3^3^3050629^
"^DD",9002313.59,9002313.59,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.59,9002313.59,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.59,9002313.59,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.59,9002313.59,1201,"DT")
3050629
"^DD",9002313.59,9002313.59,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,1202,3)
(No range limit on date)
"^DD",9002313.59,9002313.59,1202,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,1202,21,1,0)
Date to be used for the 401-D1 (DATE OF SERVICE) field for the claim
"^DD",9002313.59,9002313.59,1202,"DT")
3050525
"^DD",9002313.59,9002313.59,1203,0)
SUBMISSION CLARIFICATION CODE^F^^12;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,1203,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59,1203,21,0)
^.001^1^1^3070119^^^
"^DD",9002313.59,9002313.59,1203,21,1,0)
Submission Clarification Code
"^DD",9002313.59,9002313.59,1203,"DT")
3070119
"^DD",9002313.59,9002313.59,1300,0)
DUR DATA^9002313.5913^^13;0
"^DD",9002313.59,9002313.59,1300,21,0)
^^3^3^3050628^
"^DD",9002313.59,9002313.59,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.59,9002313.59,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put 
"^DD",9002313.59,9002313.59,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.59,9002313.59,9999.96,0)
NET PAID BY INSURER^CJ8,2^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,9)
^
"^DD",9002313.59,9002313.59,9999.96,9.01)

"^DD",9002313.59,9002313.59,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,9999.96,21,1,0)
Amount paid after the discounts and deductable have been subtracted.
"^DD",9002313.59,9002313.59,9999.96,"DT")
3040331
"^DD",9002313.59,9002313.59,9999.97,0)
ELAPSED TIME (PRINTABLE)^CJ8^^ ; ^S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,9)
^
"^DD",9002313.59,9002313.59,9999.97,9.01)

"^DD",9002313.59,9002313.59,9999.97,9.1)
S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,21,0)
^^2^2^3040331^
"^DD",9002313.59,9002313.59,9999.97,21,1,0)
The elapsed time between the filling of the prescription and
"^DD",9002313.59,9002313.59,9999.97,21,2,0)
the return of the response fromt he payer.
"^DD",9002313.59,9002313.59,9999.97,"DT")
3040331
"^DD",9002313.59,9002313.59,9999.98,0)
ELAPSED TIME (SECONDS)^CJ8^^ ; ^S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,9)
^
"^DD",9002313.59,9002313.59,9999.98,9.01)

"^DD",9002313.59,9002313.59,9999.98,9.1)
S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,9999.98,21,1,0)
The number of seconds between the placing of the order and the receipt of
"^DD",9002313.59,9002313.59,9999.98,21,2,0)
the response.
"^DD",9002313.59,9002313.59,9999.98,"DT")
3001020
"^DD",9002313.59,9002313.59,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,9)
^
"^DD",9002313.59,9002313.59,9999.99,9.01)

"^DD",9002313.59,9002313.59,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,21,0)
^.001^5^5^3040405^^
"^DD",9002313.59,9002313.59,9999.99,21,1,0)
The category of the response.
"^DD",9002313.59,9002313.59,9999.99,21,2,0)
 
"^DD",9002313.59,9002313.59,9999.99,21,3,0)
"P"aid
"^DD",9002313.59,9002313.59,9999.99,21,4,0)
"R"ejected
"^DD",9002313.59,9002313.59,9999.99,21,5,0)
"A"ccepted
"^DD",9002313.59,9002313.59,9999.99,"DT")
3040405
"^DD",9002313.59,9002313.59111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.59,9002313.59111,0,"DT")
3050503
"^DD",9002313.59,9002313.59111,0,"IX","B",9002313.59111,.01)

"^DD",9002313.59,9002313.59111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.59,9002313.59111,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59111,.01,1,0)
^.1
"^DD",9002313.59,9002313.59111,.01,1,1,0)
9002313.59111^B
"^DD",9002313.59,9002313.59111,.01,1,1,1)
S ^BPST(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59111,.01,1,1,2)
K ^BPST(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59111,.01,21,0)
^.001^1^1^3050527^^^^
"^DD",9002313.59,9002313.59111,.01,21,1,0)
To store user's comments date
"^DD",9002313.59,9002313.59111,.01,"DT")
3050503
"^DD",9002313.59,9002313.59111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.59,9002313.59111,.02,3)

"^DD",9002313.59,9002313.59111,.02,21,0)
^.001^1^1^3050629^^^
"^DD",9002313.59,9002313.59111,.02,21,1,0)
ECME user
"^DD",9002313.59,9002313.59111,.02,"DT")
3050503
"^DD",9002313.59,9002313.59111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.59,9002313.59111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.59,9002313.59111,.03,21,0)
^^1^1^3050503^
"^DD",9002313.59,9002313.59111,.03,21,1,0)
Comment text
"^DD",9002313.59,9002313.59111,.03,"DT")
3050503
"^DD",9002313.59,9002313.5913,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.59,9002313.5913,0,"DT")
3050614
"^DD",9002313.59,9002313.5913,0,"IX","B",9002313.5913,.01)

"^DD",9002313.59,9002313.5913,0,"NM","DUR DATA")

"^DD",9002313.59,9002313.5913,0,"UP")
9002313.59
"^DD",9002313.59,9002313.5913,.01,0)
DUR COUNTER^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.59,9002313.5913,.01,1,0)
^.1
"^DD",9002313.59,9002313.5913,.01,1,1,0)
9002313.5913^B
"^DD",9002313.59,9002313.5913,.01,1,1,1)
S ^BPST(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.5913,.01,1,1,2)
K ^BPST(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.5913,.01,3)
Enter the DUR counter for the claim
"^DD",9002313.59,9002313.5913,.01,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,.01,21,1,0)
This is the counter that will be used for field 473-7E of the claim
"^DD",9002313.59,9002313.5913,.01,"DT")
3050614
"^DD",9002313.59,9002313.5913,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,1,3)
Enter the professional service code for the claim
"^DD",9002313.59,9002313.5913,1,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,1,21,1,0)
This will be used for field 439-E4 of the claim
"^DD",9002313.59,9002313.5913,1,"DT")
3050614
"^DD",9002313.59,9002313.5913,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,2,3)
Enter the DUR Reason for the Service Code for the claim
"^DD",9002313.59,9002313.5913,2,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,2,21,1,0)
This will be used for field 440-E5 of the claim
"^DD",9002313.59,9002313.5913,2,"DT")
3050614
"^DD",9002313.59,9002313.5913,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,3,3)
Enter the Result of Service Code for the claim
"^DD",9002313.59,9002313.5913,3,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,3,21,1,0)
This will be used for field 441-E6 of the claim
"^DD",9002313.59,9002313.5913,3,"DT")
3050614
"^DD",9002313.59,9002313.59902,0)
VA PINS MULTIPLE SUB-FIELD^^902.27^25
"^DD",9002313.59,9002313.59902,0,"DT")
3061122
"^DD",9002313.59,9002313.59902,0,"IX","B",9002313.59902,.01)

"^DD",9002313.59,9002313.59902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.59,9002313.59902,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.59,9002313.59902,.01,1,0)
^.1
"^DD",9002313.59,9002313.59902,.01,1,1,0)
9002313.59902^B
"^DD",9002313.59,9002313.59902,.01,1,1,1)
S ^BPST(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59902,.01,1,1,2)
K ^BPST(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59902,.01,3)
Enter Group Insurance record
"^DD",9002313.59,9002313.59902,.01,21,0)
^.001^1^1^3041014^^^^
"^DD",9002313.59,9002313.59902,.01,21,1,0)
ID assigned to the insurance plan.
"^DD",9002313.59,9002313.59902,.01,"DT")
3050727
"^DD",9002313.59,9002313.59902,902.02,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.59,9002313.59902,902.02,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.02,21,1,0)
The payer sheet to be used for this particular insurer.
"^DD",9002313.59,9002313.59902,902.02,"DT")
3030626
"^DD",9002313.59,9002313.59902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.03,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.59,9002313.59902,902.03,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.04,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.04,21,1,0)
The prescription number for this claim.
"^DD",9002313.59,9002313.59902,902.04,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.59,9002313.59902,902.05,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.59,9002313.59902,902.05,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59902,902.06,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.06,21,1,0)
ID number assigned to Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.06,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.07,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.59,9002313.59902,902.07,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.59,9002313.59902,902.07,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.08,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.08,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.08,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.08,"DT")
3050119
"^DD",9002313.59,9002313.59902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59902,902.09,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.09,21,1,0)
Last name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.09,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59902,902.11,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage. 
"^DD",9002313.59,9002313.59902,902.11,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.12,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this 
"^DD",9002313.59,9002313.59902,902.12,21,2,0)
prescription.
"^DD",9002313.59,9002313.59902,902.12,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59902,902.13,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.59,9002313.59902,902.13,21,2,0)
calculated.
"^DD",9002313.59,9002313.59902,902.13,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.14,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.14,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax 
"^DD",9002313.59,9002313.59902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.59,9002313.59902,902.14,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.15,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.15,21,0)
^^9^9^3031126^
"^DD",9002313.59,9002313.59902,902.15,21,1,0)
Total price claimed from all sources.  For prescription claim request, 
"^DD",9002313.59,9002313.59902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted'  (49-D9), 
"^DD",9002313.59,9002313.59902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9). 
"^DD",9002313.59,9002313.59902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional 
"^DD",9002313.59,9002313.59902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,9,0)
'Other Amount Claimed' (48-H9).
"^DD",9002313.59,9002313.59902,902.15,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.16,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.16,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.16,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.59,9002313.59902,902.16,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.17,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.17,3)
Answer must be 1-3 characters in length.
"^DD",9002313.59,9002313.59902,902.17,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59902,902.17,21,1,0)
Which fill number this transaction is in reference to.
"^DD",9002313.59,9002313.59902,902.17,21,2,0)
Starts with '0' for the original fill.
"^DD",9002313.59,9002313.59902,902.17,"DT")
3030701
"^DD",9002313.59,9002313.59902,902.18,0)
SOFTWARE VENDOR/CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.18,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.18,21,1,0)
Certification number assigned by the payer for submission of claims.
"^DD",9002313.59,9002313.59902,902.18,"DT")
3030729
"^DD",9002313.59,9002313.59902,902.19,0)
B2 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.59,9002313.59902,902.19,3)
Enter the reversal payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,21,0)
^^1^1^3031112^
"^DD",9002313.59,9002313.59902,902.19,21,1,0)
Enter the Reversal Payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,"DT")
3031112
"^DD",9002313.59,9002313.59902,902.21,0)
B3 Rebill Payer Sheet^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.59,9002313.59902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,21,0)
^^1^1^3031112^
"^DD",9002313.59,9002313.59902,902.21,21,1,0)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,"DT")
3031112
"^DD",9002313.59,9002313.59902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE OFF;1:CERTFIY MODE ON;^0;5^Q
"^DD",9002313.59,9002313.59902,902.22,3)
Enter null or 0 for certify mode off.  Enter 1 for Cerify mode on.
"^DD",9002313.59,9002313.59902,902.22,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59902,902.22,21,1,0)
Enter null or 0 for certify mode off.  Enter 1 for certify mode on.
"^DD",9002313.59,9002313.59902,902.22,23,0)
^^3^3^3031126^
"^DD",9002313.59,9002313.59902,902.22,23,1,0)
^
"^DD",9002313.59,9002313.59902,902.22,23,2,0)
E
"^DD",9002313.59,9002313.59902,902.22,23,3,0)
Y
"^DD",9002313.59,9002313.59902,902.22,"DT")
3040331
"^DD",9002313.59,9002313.59902,902.23,0)
CERTIFICATION IEN^P9002313.31'^BPS(9002313.31,^0;6^Q
"^DD",9002313.59,9002313.59902,902.23,3)
Enter the Certification record
"^DD",9002313.59,9002313.59902,902.23,21,0)
^^2^2^3061122^
"^DD",9002313.59,9002313.59902,902.23,21,1,0)
This field is used during certification testing, and points to the entry 
"^DD",9002313.59,9002313.59902,902.23,21,2,0)
to use to pull certification data.
"^DD",9002313.59,9002313.59902,902.23,"DT")
3061122
"^DD",9002313.59,9002313.59902,902.24,0)
PLAN NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.59,9002313.59902,902.24,21,0)
^^1^1^3041014^
"^DD",9002313.59,9002313.59902,902.24,21,1,0)
This field contains the Plan Name for the insurance being filed.
"^DD",9002313.59,9002313.59902,902.24,"DT")
3041014
"^DD",9002313.59,9002313.59902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.59,9002313.59902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.59,9002313.59902,902.25,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.25,21,1,0)
This is the group name from the Group Insurance File
"^DD",9002313.59,9002313.59902,902.25,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.26,0)
INSURANCE CO PHONE #^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.59,9002313.59902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.59,9002313.59902,902.26,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.26,21,1,0)
This is the Claim (RX) phone number from the Insurance Company file
"^DD",9002313.59,9002313.59902,902.26,"DT")
3050614
"^DD",9002313.59,9002313.59902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.59,9002313.59902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.59,9002313.59902,902.27,21,1,0)
This is a ID of the plan file
"^DD",9002313.59,9002313.59902,902.27,"DT")
3050617
"^DD",9002313.8242,9002313.8242,0)
FIELD^^.02^2
"^DD",9002313.8242,9002313.8242,0,"DDA")
N
"^DD",9002313.8242,9002313.8242,0,"DT")
3070327
"^DD",9002313.8242,9002313.8242,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.8242,9002313.8242,0,"IX","B",9002313.8242,.01)

"^DD",9002313.8242,9002313.8242,0,"IX","C",9002313.8242,.02)

"^DD",9002313.8242,9002313.8242,0,"NM","BPS NCPDP FIELD 420")

"^DD",9002313.8242,9002313.8242,0,"VRPK")
BPS
"^DD",9002313.8242,9002313.8242,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.8242,9002313.8242,.01,1,0)
^.1
"^DD",9002313.8242,9002313.8242,.01,1,1,0)
9002313.8242^B
"^DD",9002313.8242,9002313.8242,.01,1,1,1)
S ^BPSF(9002313.8242,"B",$E(X,1,30),DA)=""
"^DD",9002313.8242,9002313.8242,.01,1,1,2)
K ^BPSF(9002313.8242,"B",$E(X,1,30),DA)
"^DD",9002313.8242,9002313.8242,.01,3)
Answer must be 1-2 characters in length
"^DD",9002313.8242,9002313.8242,.01,21,0)
^^1^1^3070327^
"^DD",9002313.8242,9002313.8242,.01,21,1,0)
Code clarifying the submission.
"^DD",9002313.8242,9002313.8242,.01,"DT")
3070327
"^DD",9002313.8242,9002313.8242,.02,0)
CODE DESCRIPTION^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.8242,9002313.8242,.02,1,0)
^.1
"^DD",9002313.8242,9002313.8242,.02,1,1,0)
9002313.8242^C
"^DD",9002313.8242,9002313.8242,.02,1,1,1)
S ^BPSF(9002313.8242,"C",$E(X,1,30),DA)=""
"^DD",9002313.8242,9002313.8242,.02,1,1,2)
K ^BPSF(9002313.8242,"C",$E(X,1,30),DA)
"^DD",9002313.8242,9002313.8242,.02,1,1,"DT")
3070228
"^DD",9002313.8242,9002313.8242,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.8242,9002313.8242,.02,21,0)
^^1^1^3070327^
"^DD",9002313.8242,9002313.8242,.02,21,1,0)
The NCPDP description of the value stored in the CODE (.01) field.
"^DD",9002313.8242,9002313.8242,.02,"DT")
3070327
"^DD",9002313.82461,9002313.82461,0)
FIELD^^.02^2
"^DD",9002313.82461,9002313.82461,0,"DDA")
N
"^DD",9002313.82461,9002313.82461,0,"DT")
3070327
"^DD",9002313.82461,9002313.82461,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.82461,9002313.82461,0,"IX","B",9002313.82461,.01)

"^DD",9002313.82461,9002313.82461,0,"IX","C",9002313.82461,.02)

"^DD",9002313.82461,9002313.82461,0,"NM","BPS NCPDP FIELD 461")

"^DD",9002313.82461,9002313.82461,0,"VRPK")
BPS
"^DD",9002313.82461,9002313.82461,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82461,9002313.82461,.01,1,0)
^.1
"^DD",9002313.82461,9002313.82461,.01,1,1,0)
9002313.82461^B
"^DD",9002313.82461,9002313.82461,.01,1,1,1)
S ^BPSF(9002313.82461,"B",$E(X,1,30),DA)=""
"^DD",9002313.82461,9002313.82461,.01,1,1,2)
K ^BPSF(9002313.82461,"B",$E(X,1,30),DA)
"^DD",9002313.82461,9002313.82461,.01,3)
Answer must be 1-2 characters in length
"^DD",9002313.82461,9002313.82461,.01,21,0)
^^1^1^3070328^
"^DD",9002313.82461,9002313.82461,.01,21,1,0)
The code clarifying the prior authorization number.
"^DD",9002313.82461,9002313.82461,.01,"DT")
3070328
"^DD",9002313.82461,9002313.82461,.02,0)
CODE DESCRIPTION^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.82461,9002313.82461,.02,1,0)
^.1
"^DD",9002313.82461,9002313.82461,.02,1,1,0)
9002313.82461^C
"^DD",9002313.82461,9002313.82461,.02,1,1,1)
S ^BPSF(9002313.82461,"C",$E(X,1,30),DA)=""
"^DD",9002313.82461,9002313.82461,.02,1,1,2)
K ^BPSF(9002313.82461,"C",$E(X,1,30),DA)
"^DD",9002313.82461,9002313.82461,.02,1,1,"DT")
3070228
"^DD",9002313.82461,9002313.82461,.02,3)
Answer must be 1-50 characters in length.
"^DD",9002313.82461,9002313.82461,.02,21,0)
^^2^2^3070327^
"^DD",9002313.82461,9002313.82461,.02,21,1,0)
The NCPDP standard description of the value stored in the CODE (.01)
"^DD",9002313.82461,9002313.82461,.02,21,2,0)
field.  
"^DD",9002313.82461,9002313.82461,.02,"DT")
3070327
"^DD",9002313.91,9002313.91,0)
FIELD^^40^8
"^DD",9002313.91,9002313.91,0,"DDA")
N
"^DD",9002313.91,9002313.91,0,"DT")
3030512
"^DD",9002313.91,9002313.91,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",9002313.91,9002313.91,0,"IX","B",9002313.91,.01)

"^DD",9002313.91,9002313.91,0,"IX","C",9002313.91,.03)

"^DD",9002313.91,9002313.91,0,"IX","D",9002313.91,.06)

"^DD",9002313.91,9002313.91,0,"NM","BPS NCPDP FIELD DEFS")

"^DD",9002313.91,9002313.91,0,"PT",9002313.311,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.3121,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.5111,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9201,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9202,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9203,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9204,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9205,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9206,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9207,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9208,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9209,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.921,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9213,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9214,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9215,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9216,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9217,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9218,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9219,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.922,.02)

"^DD",9002313.91,9002313.91,0,"VRPK")
BPS
"^DD",9002313.91,9002313.91,.01,0)
Number^RNJ6,2^^0;1^K:+X'=X!(X>800)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.91,9002313.91,.01,1,0)
^.1
"^DD",9002313.91,9002313.91,.01,1,1,0)
9002313.91^B
"^DD",9002313.91,9002313.91,.01,1,1,1)
S ^BPSF(9002313.91,"B",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.01,1,1,2)
K ^BPSF(9002313.91,"B",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.01,3)
Type a Number between 0 and 800, 2 Decimal Digits
"^DD",9002313.91,9002313.91,.01,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.01,21,1,0)
The NCPDP field number from the NCPDP data dictionary.
"^DD",9002313.91,9002313.91,.01,"DT")
3030512
"^DD",9002313.91,9002313.91,.03,0)
Name^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.91,9002313.91,.03,1,0)
^.1
"^DD",9002313.91,9002313.91,.03,1,1,0)
9002313.91^C
"^DD",9002313.91,9002313.91,.03,1,1,1)
S ^BPSF(9002313.91,"C",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.03,1,1,2)
K ^BPSF(9002313.91,"C",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.03,1,1,"DT")
3001007
"^DD",9002313.91,9002313.91,.03,3)
Answer must be 3-30 characters in length.
"^DD",9002313.91,9002313.91,.03,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,.03,21,1,0)
Descriptive name the tells what the field is within the
"^DD",9002313.91,9002313.91,.03,21,2,0)
pharmacy environment.
"^DD",9002313.91,9002313.91,.03,"DT")
3001007
"^DD",9002313.91,9002313.91,.04,0)
Format^S^N:NUMERIC;A/N:ALPHA/NUMERIC;D:SIGNED NUMERIC;^0;4^Q
"^DD",9002313.91,9002313.91,.04,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,.04,21,1,0)
M code goes here to format the field before storing it in the
"^DD",9002313.91,9002313.91,.04,21,2,0)
database.  
"^DD",9002313.91,9002313.91,.04,"DT")
2950406
"^DD",9002313.91,9002313.91,.06,0)
5.1 ID^F^^5;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.91,9002313.91,.06,1,0)
^.1
"^DD",9002313.91,9002313.91,.06,1,1,0)
9002313.91^D
"^DD",9002313.91,9002313.91,.06,1,1,1)
S ^BPSF(9002313.91,"D",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.06,1,1,2)
K ^BPSF(9002313.91,"D",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.06,1,1,"%D",0)
^^3^3^3020807^
"^DD",9002313.91,9002313.91,.06,1,1,"%D",1,0)
Cross reference of the 5.1 Field ID.  This cross reference will be used in
"^DD",9002313.91,9002313.91,.06,1,1,"%D",2,0)
the processing of the response as a means of translating the value to a
"^DD",9002313.91,9002313.91,.06,1,1,"%D",3,0)
field number.
"^DD",9002313.91,9002313.91,.06,1,1,"DT")
3020807
"^DD",9002313.91,9002313.91,.06,3)
Answer must be 2 characters in length.
"^DD",9002313.91,9002313.91,.06,21,0)
^^3^3^3040121^
"^DD",9002313.91,9002313.91,.06,21,1,0)
The same as the .02 field, but for specific use when creating
"^DD",9002313.91,9002313.91,.06,21,2,0)
5.1 claims.  The 5.1 fields were separated because IHS was doing
"^DD",9002313.91,9002313.91,.06,21,3,0)
3.x and 5.1 claims concurrently.
"^DD",9002313.91,9002313.91,.06,"DT")
3020807
"^DD",9002313.91,9002313.91,.07,0)
5.1 Length^NJ4,0^^5;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.91,9002313.91,.07,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.91,9002313.91,.07,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.07,21,1,0)
Length of the field from the 5.1 NCPDP standard.
"^DD",9002313.91,9002313.91,.07,"DT")
3020724
"^DD",9002313.91,9002313.91,10,0)
Get Code^9002313.9101^^10;0
"^DD",9002313.91,9002313.91,10,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,10,21,1,0)
M code that tells the BPS system where to find the 
"^DD",9002313.91,9002313.91,10,21,2,0)
particular piece of data for this field.
"^DD",9002313.91,9002313.91,30,0)
Set Code^9002313.9103^^30;0
"^DD",9002313.91,9002313.91,30,21,0)
^^1^1^3040326^
"^DD",9002313.91,9002313.91,30,21,1,0)
M code to store the data in the appropriate segment within the claim.
"^DD",9002313.91,9002313.91,40,0)
5.1 Format Code^9002313.9104^^25;0
"^DD",9002313.91,9002313.91,40,21,0)
^.001^3^3^3040326^^
"^DD",9002313.91,9002313.91,40,21,1,0)
M code to format the data before storing it in the claim.
"^DD",9002313.91,9002313.91,40,21,2,0)
5.1 was separate within IHS because they were doing 3.2 and
"^DD",9002313.91,9002313.91,40,21,3,0)
5.1 at the same time.
"^DD",9002313.91,9002313.9101,0)
Get Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9101,0,"DT")
2950420
"^DD",9002313.91,9002313.9101,0,"NM","Get Code")

"^DD",9002313.91,9002313.9101,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9101,.01,0)
Get Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9101,.01,"DT")
2950420
"^DD",9002313.91,9002313.9103,0)
Set Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9103,0,"DT")
2950420
"^DD",9002313.91,9002313.9103,0,"NM","Set Code")

"^DD",9002313.91,9002313.9103,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9103,.01,0)
Set Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9103,.01,"DT")
2950420
"^DD",9002313.91,9002313.9104,0)
5.1 Format Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9104,0,"DT")
3020724
"^DD",9002313.91,9002313.9104,0,"NM","5.1 Format Code")

"^DD",9002313.91,9002313.9104,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9104,.01,0)
5.1 Format Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9104,.01,"DT")
3020724
"^DD",9002313.99,9002313.99,0)
FIELD^^2341.01^12
"^DD",9002313.99,9002313.99,0,"DDA")
N
"^DD",9002313.99,9002313.99,0,"DT")
3070131
"^DD",9002313.99,9002313.99,0,"IX","B",9002313.99,.01)

"^DD",9002313.99,9002313.99,0,"NM","BPS SETUP")

"^DD",9002313.99,9002313.99,0,"VRPK")
BPS
"^DD",9002313.99,9002313.99,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.99,9002313.99,.01,1,0)
^.1
"^DD",9002313.99,9002313.99,.01,1,1,0)
9002313.99^B
"^DD",9002313.99,9002313.99,.01,1,1,1)
S ^BPS(9002313.99,"B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.99,.01,1,1,2)
K ^BPS(9002313.99,"B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.99,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.99,9002313.99,.01,"DT")
3050729
"^DD",9002313.99,9002313.99,.04,0)
*M Vendor^S^DTM:DTM;MSM:MSM;CACHE:CACHE;^0;4^Q
"^DD",9002313.99,9002313.99,.04,"DT")
3001016
"^DD",9002313.99,9002313.99,3.01,0)
ECME TIMEOUT^RNJ2,0^^0;2^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,3.01,3)
Type a Number between 0 and 30, 0 Decimal Digits. This is the maximum number of seconds the display will wait for a claims processing status.
"^DD",9002313.99,9002313.99,3.01,21,0)
^.001^4^4^3050929^^^
"^DD",9002313.99,9002313.99,3.01,21,1,0)
This is the maximum number of seconds used for the display of the 
"^DD",9002313.99,9002313.99,3.01,21,2,0)
claims processing status.  After this time, claims processing will 
"^DD",9002313.99,9002313.99,3.01,21,3,0)
continue but the user will not see messages indicating the progress 
"^DD",9002313.99,9002313.99,3.01,21,4,0)
of the claim.
"^DD",9002313.99,9002313.99,3.01,"DT")
3050729
"^DD",9002313.99,9002313.99,3.02,0)
PAYER RESPONSE TEST MODE^S^1:ON;0:OFF;^0;3^Q
"^DD",9002313.99,9002313.99,3.02,3)
Set this to On to enable payer overrides.  Do not enable at production sites.
"^DD",9002313.99,9002313.99,3.02,21,0)
^^2^2^3050720^
"^DD",9002313.99,9002313.99,3.02,21,1,0)
This field enables the testing of Payer Response Overrides - 1 for On, 0 
"^DD",9002313.99,9002313.99,3.02,21,2,0)
(or "") for Off.  This should never be ON at a production site.
"^DD",9002313.99,9002313.99,3.02,"DT")
3050720
"^DD",9002313.99,9002313.99,2341.01,0)
WINNOW TESTING FLAG^S^0:NO;1:YES;^WINNOW;1^Q
"^DD",9002313.99,9002313.99,2341.01,3)
Enter 'YES' to enable WINNOW TEST mode, 'NO' to purge
"^DD",9002313.99,9002313.99,2341.01,21,0)
^^2^2^3070131^
"^DD",9002313.99,9002313.99,2341.01,21,1,0)
This flag controls whether purging is really done or just in test mode.  
"^DD",9002313.99,9002313.99,2341.01,21,2,0)
YES sets test mode on and NO enables purging.
"^DD",9002313.99,9002313.99,2341.01,"DT")
3070131
"^DD",9002313.99,9002313.99,2341.03,0)
WINNOW BPS LOG^NJ4,0^^WINNOW;3^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.99,9002313.99,2341.03,3)
Enter the days of the BPS LOG to keep on the system
"^DD",9002313.99,9002313.99,2341.03,21,0)
^^1^1^3061120^
"^DD",9002313.99,9002313.99,2341.03,21,1,0)
Number of days of the BPS LOG to keep on the system
"^DD",9002313.99,9002313.99,2341.03,"DT")
3061120
"^DD",9002313.99,9002313.99,2500,0)
CERTIFIER^P200'^VA(200,^CERTIFIER;1^Q
"^DD",9002313.99,9002313.99,2500,3)
ENTER THE DUZ OF THE PERSON PERFORMING CERTIFICATION
"^DD",9002313.99,9002313.99,2500,21,0)
^^1^1^3031125^
"^DD",9002313.99,9002313.99,2500,21,1,0)
CONTAINS THE DUZ OF THE PERSON PERFORMING CERTIFICATION.
"^DD",9002313.99,9002313.99,2500,"DT")
3031125
"^DD",9002313.99,9002313.99,6000,0)
VA SITE CONTACT^P200'^VA(200,^VITRIA;1^Q
"^DD",9002313.99,9002313.99,6000,3)
ENTER THE VA CONTACT FOR VITRIA.
"^DD",9002313.99,9002313.99,6000,21,0)
^.001^1^1^3040127^^
"^DD",9002313.99,9002313.99,6000,21,1,0)
Enter the VA Site Contact for Vitria.
"^DD",9002313.99,9002313.99,6000,"DT")
3031030
"^DD",9002313.99,9002313.99,6001,0)
VA Alternate Site Contract^P200'^VA(200,^VITRIA;2^Q
"^DD",9002313.99,9002313.99,6001,3)
ENTER THE VA ALTERNATE SITE CONTACT FOR VITRIA.
"^DD",9002313.99,9002313.99,6001,21,0)
^^1^1^3050907^
"^DD",9002313.99,9002313.99,6001,21,1,0)
Enter the VA Alternate Site Contact for Vitria.
"^DD",9002313.99,9002313.99,6001,"DT")
3050907
"^DD",9002313.99,9002313.99,6003,0)
VITRIA INTERFACE VERSION #^F^^VITRIA;3^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.99,9002313.99,6003,3)
Answer must be 1-35 characters in length.
"^DD",9002313.99,9002313.99,6003,21,0)
^.001^1^1^3040127^^
"^DD",9002313.99,9002313.99,6003,21,1,0)
Enter the Vitria supplied interface verison number.
"^DD",9002313.99,9002313.99,6003,"DT")
3031030
"^DD",9002313.99,9002313.99,9999,0)
SITE TYPE^RS^0:VA;1:IHS;^SITE TYPE;1^Q
"^DD",9002313.99,9002313.99,9999,3)
Enter 0 (zero) for VA or 1 for IHS.
"^DD",9002313.99,9002313.99,9999,21,0)
^^4^4^3030616^
"^DD",9002313.99,9002313.99,9999,21,1,0)
This field is used to determine whether the site is a Veterens 
"^DD",9002313.99,9002313.99,9999,21,2,0)
Administration site or and Indian Health Services Site.  Based on this 
"^DD",9002313.99,9002313.99,9999,21,3,0)
answer, the ECME system will process in two different manners with 
"^DD",9002313.99,9002313.99,9999,21,4,0)
respect to claims generation and data collection methods.
"^DD",9002313.99,9002313.99,9999,"DT")
3030616
"^DD",9002313.99,9002313.99,10000,0)
VA LAST SEQUENCE^NJ10,0^^3;1^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,10000,3)
Type a Number between 0 and 9999999999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,10000,"DT")
3030724
"^DIC",9002313.02,9002313.02,0)
BPS CLAIMS^9002313.02
"^DIC",9002313.02,9002313.02,0,"GL")
^BPSC(
"^DIC",9002313.02,9002313.02,"%",0)
^1.005^1^1
"^DIC",9002313.02,9002313.02,"%",1,0)
BPS
"^DIC",9002313.02,9002313.02,"%","B","ABSP",1)

"^DIC",9002313.02,9002313.02,"%","B","BPS",1)

"^DIC",9002313.02,9002313.02,"%D",0)
^^7^7^3031216^
"^DIC",9002313.02,9002313.02,"%D",1,0)
Intermediate form of claims.  Fields are stored in formatted form.
"^DIC",9002313.02,9002313.02,"%D",2,0)
Raw packet is stored, too.  
"^DIC",9002313.02,9002313.02,"%D",3,0)
 
"^DIC",9002313.02,9002313.02,"%D",4,0)
Most fields are in Free Text format to accommodate NCPDP Standard
"^DIC",9002313.02,9002313.02,"%D",5,0)
formatting criteria and required field lengths.  Fields other than those
"^DIC",9002313.02,9002313.02,"%D",6,0)
with decimals in the number correlate directly to the field numbers
"^DIC",9002313.02,9002313.02,"%D",7,0)
supplied in the NCPDP Data Dictionary.
"^DIC",9002313.02,"B","BPS CLAIMS",9002313.02)

"^DIC",9002313.12,9002313.12,0)
BPS LOG^9002313.12
"^DIC",9002313.12,9002313.12,0,"GL")
^BPS(9002313.12,
"^DIC",9002313.12,9002313.12,"%",0)
^1.005^^0
"^DIC",9002313.12,9002313.12,"%D",0)
^^3^3^3061017^
"^DIC",9002313.12,9002313.12,"%D",1,0)
This is ECME log, which is used to store an audit trail of ECME 
"^DIC",9002313.12,9002313.12,"%D",2,0)
activity.  There are currently two types of logs - one for transactions
"^DIC",9002313.12,9002313.12,"%D",3,0)
and another for purging.
"^DIC",9002313.12,"B","BPS LOG",9002313.12)

"^DIC",9002313.31,9002313.31,0)
BPS CERTIFICATION^9002313.31
"^DIC",9002313.31,9002313.31,0,"GL")
^BPS(9002313.31,
"^DIC",9002313.31,9002313.31,"%",0)
^1.005^1^1
"^DIC",9002313.31,9002313.31,"%",1,0)
BPS
"^DIC",9002313.31,9002313.31,"%","B","ABSP",1)

"^DIC",9002313.31,9002313.31,"%","B","BPS",1)

"^DIC",9002313.31,9002313.31,"%D",0)
^^4^4^3010205^^
"^DIC",9002313.31,9002313.31,"%D",1,0)
Data for development use in certifying software when required by
"^DIC",9002313.31,9002313.31,"%D",2,0)
switches and claims end processors.  
"^DIC",9002313.31,9002313.31,"%D",3,0)
Also contains test claim used by MGR/TEST option.
"^DIC",9002313.31,9002313.31,"%D",4,0)
This file is completely overwritten by installation.
"^DIC",9002313.31,"B","BPS CERTIFICATION",9002313.31)

"^DIC",9002313.56,9002313.56,0)
BPS PHARMACIES^9002313.56
"^DIC",9002313.56,9002313.56,0,"GL")
^BPS(9002313.56,
"^DIC",9002313.56,9002313.56,"%",0)
^1.005^1^1
"^DIC",9002313.56,9002313.56,"%",1,0)
BPS
"^DIC",9002313.56,9002313.56,"%","B","ABSP",1)

"^DIC",9002313.56,9002313.56,"%","B","BPS",1)

"^DIC",9002313.56,9002313.56,"%D",0)
^^2^2^3010205^^^
"^DIC",9002313.56,9002313.56,"%D",1,0)
Pharmacy-specific data -- NCPDP #, default DEA #, etc.
"^DIC",9002313.56,9002313.56,"%D",2,0)
One BPS PHARMACY has a list of one or more OUTPATIENT SITES (file 59)
"^DIC",9002313.56,"B","BPS PHARMACIES",9002313.56)

"^DIC",9002313.57,9002313.57,0)
BPS LOG OF TRANSACTIONS^9002313.57
"^DIC",9002313.57,9002313.57,0,"GL")
^BPSTL(
"^DIC",9002313.57,9002313.57,"%",0)
^1.005^1^1
"^DIC",9002313.57,9002313.57,"%",1,0)
BPS
"^DIC",9002313.57,9002313.57,"%","B","ABSP",1)

"^DIC",9002313.57,9002313.57,"%","B","BPS",1)

"^DIC",9002313.57,9002313.57,"%D",0)
^^2^2^3001120^^^
"^DIC",9002313.57,9002313.57,"%D",1,0)
A copy of 9002313.59.  As each transaction completes, a snapshot of 
"^DIC",9002313.57,9002313.57,"%D",2,0)
9002313.59 entry is placed here in 9002313.57.
"^DIC",9002313.57,"B","BPS LOG OF TRANSACTIONS",9002313.57)

"^DIC",9002313.58,9002313.58,0)
BPS STATISTICS^9002313.58
"^DIC",9002313.58,9002313.58,0,"GL")
^BPSECX("S",
"^DIC",9002313.58,9002313.58,"%",0)
^1.005^1^1
"^DIC",9002313.58,9002313.58,"%",1,0)
BPS
"^DIC",9002313.58,9002313.58,"%","B","ABSP",1)

"^DIC",9002313.58,9002313.58,"%","B","BPS",1)

"^DIC",9002313.58,9002313.58,"%D",0)
^^1^1^3010305^^^^
"^DIC",9002313.58,9002313.58,"%D",1,0)
Statistics, as displayed by List Manager and ^BPSOS2.
"^DIC",9002313.58,"B","BPS STATISTICS",9002313.58)

"^DIC",9002313.59,9002313.59,0)
BPS TRANSACTION^9002313.59
"^DIC",9002313.59,9002313.59,0,"GL")
^BPST(
"^DIC",9002313.59,9002313.59,"%",0)
^1.005^1^1
"^DIC",9002313.59,9002313.59,"%",1,0)
BPS
"^DIC",9002313.59,9002313.59,"%","B","ABSP",1)

"^DIC",9002313.59,9002313.59,"%","B","BPS",1)

"^DIC",9002313.59,9002313.59,"%D",0)
^^2^2^3001120^^^
"^DIC",9002313.59,9002313.59,"%D",1,0)
Transactions in progress.  When complete (status 99), a copy of the
"^DIC",9002313.59,9002313.59,"%D",2,0)
record is placed in 9002313.57.
"^DIC",9002313.59,"B","BPS TRANSACTION",9002313.59)

"^DIC",9002313.8242,9002313.8242,0)
BPS NCPDP FIELD 420^9002313.8242
"^DIC",9002313.8242,9002313.8242,0,"GL")
^BPSF(9002313.8242,
"^DIC",9002313.8242,9002313.8242,"%",0)
^1.005^1^1
"^DIC",9002313.8242,9002313.8242,"%",1,0)
BPS
"^DIC",9002313.8242,9002313.8242,"%","B","ABSP",1)

"^DIC",9002313.8242,9002313.8242,"%","B","BPS",1)

"^DIC",9002313.8242,9002313.8242,"%D",0)
^1.001^3^3^3070316^^
"^DIC",9002313.8242,9002313.8242,"%D",1,0)
Values for NCPDP Field 420, Prescription Clarification Code. No local 
"^DIC",9002313.8242,9002313.8242,"%D",2,0)
changes should ever be made to this file without first obtaining national
"^DIC",9002313.8242,9002313.8242,"%D",3,0)
approval.  
"^DIC",9002313.8242,"B","BPS NCPDP FIELD 420",9002313.8242)

"^DIC",9002313.82461,9002313.82461,0)
BPS NCPDP FIELD 461^9002313.82461
"^DIC",9002313.82461,9002313.82461,0,"GL")
^BPSF(9002313.82461,
"^DIC",9002313.82461,9002313.82461,"%",0)
^1.005^^0
"^DIC",9002313.82461,9002313.82461,"%D",0)
^^3^3^3070315^
"^DIC",9002313.82461,9002313.82461,"%D",1,0)
Code clarifying the 'Prior Authorization Number Submitted' or 
"^DIC",9002313.82461,9002313.82461,"%D",2,0)
benefit/plan exemption. No local changes should ever be made to this file 
"^DIC",9002313.82461,9002313.82461,"%D",3,0)
without first obtaining national approval.
"^DIC",9002313.82461,"B","BPS NCPDP FIELD 461",9002313.82461)

"^DIC",9002313.91,9002313.91,0)
BPS NCPDP FIELD DEFS^9002313.91
"^DIC",9002313.91,9002313.91,0,"GL")
^BPSF(9002313.91,
"^DIC",9002313.91,9002313.91,"%",0)
^1.005^1^1
"^DIC",9002313.91,9002313.91,"%",1,0)
BPS
"^DIC",9002313.91,9002313.91,"%","B","ABSP",1)

"^DIC",9002313.91,9002313.91,"%","B","BPS",1)

"^DIC",9002313.91,9002313.91,"%D",0)
^^3^3^3010205^^^^
"^DIC",9002313.91,9002313.91,"%D",1,0)
The NCPDP Data Dictionary
"^DIC",9002313.91,9002313.91,"%D",2,0)
Individual fields which combine into formatted packets.
"^DIC",9002313.91,9002313.91,"%D",3,0)
Installation overwrites this file, totally.
"^DIC",9002313.91,"B","BPS NCPDP FIELD DEFS",9002313.91)

"^DIC",9002313.99,9002313.99,0)
BPS SETUP^9002313.99
"^DIC",9002313.99,9002313.99,0,"GL")
^BPS(9002313.99,
"^DIC",9002313.99,9002313.99,"%",0)
^1.005^1^1
"^DIC",9002313.99,9002313.99,"%",1,0)
BPS
"^DIC",9002313.99,9002313.99,"%","B","ABSP",1)

"^DIC",9002313.99,9002313.99,"%","B","BPS",1)

"^DIC",9002313.99,9002313.99,"%D",0)
^^2^2^3061220^
"^DIC",9002313.99,9002313.99,"%D",1,0)
Parameters that apply to all of ECME.  There should only be one record 
"^DIC",9002313.99,9002313.99,"%D",2,0)
with IEN=1 and name MAIN SETUP ENTRY.
"^DIC",9002313.99,"B","BPS SETUP",9002313.99)

**INSTALL NAME**
PSO*7.0*260
"BLD",6459,0)
PSO*7.0*260^OUTPATIENT PHARMACY^0^3070822^y
"BLD",6459,4,0)
^9.64PA^52.85^3
"BLD",6459,4,52,0)
52
"BLD",6459,4,52,2,0)
^9.641^52.2551^2
"BLD",6459,4,52,2,52.25,0)
REJECT INFO  (sub-file)
"BLD",6459,4,52,2,52.25,1,0)
^9.6411^26^3
"BLD",6459,4,52,2,52.25,1,24,0)
CLARIFICATION CODE
"BLD",6459,4,52,2,52.25,1,25,0)
PRIOR AUTHORIZATION TYPE
"BLD",6459,4,52,2,52.25,1,26,0)
PRIOR AUTHORIZATION NUMBER
"BLD",6459,4,52,2,52.2551,0)
COMMENTS  (sub-file)
"BLD",6459,4,52,2,52.2551,1,0)
^9.6411^^
"BLD",6459,4,52,222)
y^y^p^^^^n^^n
"BLD",6459,4,52,224)

"BLD",6459,4,52.85,0)
52.85
"BLD",6459,4,52.85,222)
y^y^f^^^^n
"BLD",6459,4,59,0)
59
"BLD",6459,4,59,2,0)
^9.641^59^1
"BLD",6459,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",6459,4,59,2,59,1,0)
^9.6411^101^1
"BLD",6459,4,59,2,59,1,101,0)
NPI INSTITUTION
"BLD",6459,4,59,222)
y^y^p^^^^n^^n
"BLD",6459,4,59,224)

"BLD",6459,4,"APDD",52,52.25)

"BLD",6459,4,"APDD",52,52.25,24)

"BLD",6459,4,"APDD",52,52.25,25)

"BLD",6459,4,"APDD",52,52.25,26)

"BLD",6459,4,"APDD",52,52.2551)

"BLD",6459,4,"APDD",59,59)

"BLD",6459,4,"APDD",59,59,101)

"BLD",6459,4,"B",52,52)

"BLD",6459,4,"B",52.85,52.85)

"BLD",6459,4,"B",59,59)

"BLD",6459,6.3)
84
"BLD",6459,"INID")
^n
"BLD",6459,"INIT")
PSO260PI
"BLD",6459,"KRN",0)
^9.67PA^8989.52^19
"BLD",6459,"KRN",.4,0)
.4
"BLD",6459,"KRN",.401,0)
.401
"BLD",6459,"KRN",.402,0)
.402
"BLD",6459,"KRN",.403,0)
.403
"BLD",6459,"KRN",.5,0)
.5
"BLD",6459,"KRN",.84,0)
.84
"BLD",6459,"KRN",3.6,0)
3.6
"BLD",6459,"KRN",3.8,0)
3.8
"BLD",6459,"KRN",9.2,0)
9.2
"BLD",6459,"KRN",9.8,0)
9.8
"BLD",6459,"KRN",9.8,"NM",0)
^9.68A^30^28
"BLD",6459,"KRN",9.8,"NM",1,0)
PSOBPSU2^^0^B7051944
"BLD",6459,"KRN",9.8,"NM",2,0)
PSOREJP2^^0^B62487288
"BLD",6459,"KRN",9.8,"NM",3,0)
PSOREJP0^^0^B65585833
"BLD",6459,"KRN",9.8,"NM",4,0)
PSOPMP0^^0^B76827234
"BLD",6459,"KRN",9.8,"NM",5,0)
PSONVAVW^^0^B19285655
"BLD",6459,"KRN",9.8,"NM",6,0)
PSOREJP1^^0^B80456147
"BLD",6459,"KRN",9.8,"NM",7,0)
PSOPMPPF^^0^B55558822
"BLD",6459,"KRN",9.8,"NM",8,0)
PSOPMP1^^0^B26858864
"BLD",6459,"KRN",9.8,"NM",10,0)
PSOBPSU1^^0^B46417153
"BLD",6459,"KRN",9.8,"NM",11,0)
PSODAWUT^^0^B2108992
"BLD",6459,"KRN",9.8,"NM",12,0)
PSOORED2^^0^B64502991
"BLD",6459,"KRN",9.8,"NM",13,0)
PSOORED6^^0^B62756399
"BLD",6459,"KRN",9.8,"NM",14,0)
PSORXVW^^0^B66871354
"BLD",6459,"KRN",9.8,"NM",15,0)
PSON52^^0^B62362504
"BLD",6459,"KRN",9.8,"NM",16,0)
PSOR52^^0^B33265182
"BLD",6459,"KRN",9.8,"NM",17,0)
PSORXVW1^^0^B67149111
"BLD",6459,"KRN",9.8,"NM",18,0)
PSOORAL2^^0^B19960223
"BLD",6459,"KRN",9.8,"NM",19,0)
PSOREJP3^^0^B10158946
"BLD",6459,"KRN",9.8,"NM",20,0)
PSOREJU1^^0^B58727208
"BLD",6459,"KRN",9.8,"NM",21,0)
PSOREJUT^^0^B34569551
"BLD",6459,"KRN",9.8,"NM",22,0)
PSOREJU2^^0^B47862203
"BLD",6459,"KRN",9.8,"NM",23,0)
PSORXL1^^0^B42620106
"BLD",6459,"KRN",9.8,"NM",25,0)
PSOORFI1^^0^B72652086
"BLD",6459,"KRN",9.8,"NM",26,0)
PSOOREDT^^0^B64908254
"BLD",6459,"KRN",9.8,"NM",27,0)
PSOBPSUT^^0^B49534340
"BLD",6459,"KRN",9.8,"NM",28,0)
PSOBPSRP^^0^B12525106
"BLD",6459,"KRN",9.8,"NM",29,0)
PSOBPSR1^^0^B37279361
"BLD",6459,"KRN",9.8,"NM",30,0)
PSOSULBL^^0^B64818200
"BLD",6459,"KRN",9.8,"NM","B","PSOBPSR1",29)

"BLD",6459,"KRN",9.8,"NM","B","PSOBPSRP",28)

"BLD",6459,"KRN",9.8,"NM","B","PSOBPSU1",10)

"BLD",6459,"KRN",9.8,"NM","B","PSOBPSU2",1)

"BLD",6459,"KRN",9.8,"NM","B","PSOBPSUT",27)

"BLD",6459,"KRN",9.8,"NM","B","PSODAWUT",11)

"BLD",6459,"KRN",9.8,"NM","B","PSON52",15)

"BLD",6459,"KRN",9.8,"NM","B","PSONVAVW",5)

"BLD",6459,"KRN",9.8,"NM","B","PSOORAL2",18)

"BLD",6459,"KRN",9.8,"NM","B","PSOORED2",12)

"BLD",6459,"KRN",9.8,"NM","B","PSOORED6",13)

"BLD",6459,"KRN",9.8,"NM","B","PSOOREDT",26)

"BLD",6459,"KRN",9.8,"NM","B","PSOORFI1",25)

"BLD",6459,"KRN",9.8,"NM","B","PSOPMP0",4)

"BLD",6459,"KRN",9.8,"NM","B","PSOPMP1",8)

"BLD",6459,"KRN",9.8,"NM","B","PSOPMPPF",7)

"BLD",6459,"KRN",9.8,"NM","B","PSOR52",16)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJP0",3)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJP1",6)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJP2",2)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJP3",19)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJU1",20)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJU2",22)

"BLD",6459,"KRN",9.8,"NM","B","PSOREJUT",21)

"BLD",6459,"KRN",9.8,"NM","B","PSORXL1",23)

"BLD",6459,"KRN",9.8,"NM","B","PSORXVW",14)

"BLD",6459,"KRN",9.8,"NM","B","PSORXVW1",17)

"BLD",6459,"KRN",9.8,"NM","B","PSOSULBL",30)

"BLD",6459,"KRN",19,0)
19
"BLD",6459,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",6459,"KRN",19,"NM",1,0)
PSO PMP^^0
"BLD",6459,"KRN",19,"NM",2,0)
PSO PMP SITE PREFERENCES^^0
"BLD",6459,"KRN",19,"NM",3,0)
PSO EPHARMACY MENU^^2
"BLD",6459,"KRN",19,"NM",4,0)
PSO IGNORED REJECTS REPORT^^0
"BLD",6459,"KRN",19,"NM","B","PSO EPHARMACY MENU",3)

"BLD",6459,"KRN",19,"NM","B","PSO IGNORED REJECTS REPORT",4)

"BLD",6459,"KRN",19,"NM","B","PSO PMP",1)

"BLD",6459,"KRN",19,"NM","B","PSO PMP SITE PREFERENCES",2)

"BLD",6459,"KRN",19.1,0)
19.1
"BLD",6459,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6459,"KRN",101,0)
101
"BLD",6459,"KRN",101,"NM",0)
^9.68A^49^44
"BLD",6459,"KRN",101,"NM",1,0)
PSO PMP DRUG SORT^^0
"BLD",6459,"KRN",101,"NM",2,0)
PSO PMP ISSUE DATE SORT^^0
"BLD",6459,"KRN",101,"NM",3,0)
PSO PMP LAST FILL SORT^^0
"BLD",6459,"KRN",101,"NM",4,0)
PSO PMP MENU^^0
"BLD",6459,"KRN",101,"NM",5,0)
PSO PMP RX SORT^^0
"BLD",6459,"KRN",101,"NM",6,0)
PSO PMP SELECT^^0
"BLD",6459,"KRN",101,"NM",7,0)
PSO PMP SIG DISPLAY^^0
"BLD",6459,"KRN",101,"NM",8,0)
PSO PMP STATUS GROUP^^0
"BLD",6459,"KRN",101,"NM",11,0)
PSO PMP CHANGE VIEW^^0
"BLD",6459,"KRN",101,"NM",12,0)
PSO PMP PATIENT INFORMATION^^0
"BLD",6459,"KRN",101,"NM",14,0)
PSO REJECTS GROUP BY INSURANCE^^0
"BLD",6459,"KRN",101,"NM",15,0)
PSO REJECT DISPLAY MED PROFILE^^0
"BLD",6459,"KRN",101,"NM",16,0)
PSO REJECT DISPLAY ADD COMMENT^^0
"BLD",6459,"KRN",101,"NM",17,0)
PSO REJECT DISPLAY CLARIFICATION CODE^^0
"BLD",6459,"KRN",101,"NM",18,0)
PSO REJECTS MENU^^0
"BLD",6459,"KRN",101,"NM",19,0)
PSO REJECT DISPLAY MENU^^0
"BLD",6459,"KRN",101,"NM",20,0)
PSO REJECT DISPLAY MENU - RESOLVED^^0
"BLD",6459,"KRN",101,"NM",21,0)
PSO REJECT DISPLAY OVERRIDE^^0
"BLD",6459,"KRN",101,"NM",22,0)
PSO REJECT DISPLAY HIDDEN MENU^^0
"BLD",6459,"KRN",101,"NM",23,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^^0
"BLD",6459,"KRN",101,"NM",24,0)
PSO REJECT DISPLAY RX EDIT^^0^
"BLD",6459,"KRN",101,"NM",25,0)
VALM NEXT SCREEN^^0^
"BLD",6459,"KRN",101,"NM",26,0)
VALM PREVIOUS SCREEN^^0^
"BLD",6459,"KRN",101,"NM",27,0)
VALM UP ONE LINE^^0^
"BLD",6459,"KRN",101,"NM",28,0)
VALM DOWN A LINE^^0^
"BLD",6459,"KRN",101,"NM",29,0)
VALM REFRESH^^0^
"BLD",6459,"KRN",101,"NM",30,0)
VALM PRINT SCREEN^^0^
"BLD",6459,"KRN",101,"NM",31,0)
VALM PRINT LIST^^0^
"BLD",6459,"KRN",101,"NM",34,0)
VALM SEARCH LIST^^0^
"BLD",6459,"KRN",101,"NM",35,0)
VALM QUIT^^0^
"BLD",6459,"KRN",101,"NM",36,0)
VALM LAST SCREEN^^0^
"BLD",6459,"KRN",101,"NM",37,0)
VALM FIRST SCREEN^^0^
"BLD",6459,"KRN",101,"NM",38,0)
VALM GOTO PAGE^^0^
"BLD",6459,"KRN",101,"NM",39,0)
VALM TURN ON/OFF MENUS^^0^
"BLD",6459,"KRN",101,"NM",40,0)
PSO REJECT DISPLAY RX VIEW^^0^
"BLD",6459,"KRN",101,"NM",41,0)
PSO REJECT DISPLAY IGNORE^^0^
"BLD",6459,"KRN",101,"NM",42,0)
PSO REJECT DISPLAY RESUBMIT^^0^
"BLD",6459,"KRN",101,"NM",43,0)
PSO REJECT DISPLAY SUSPENSE DATE^^0^
"BLD",6459,"KRN",101,"NM",44,0)
PSO REJECTS PATIENT SORT^^0
"BLD",6459,"KRN",101,"NM",45,0)
PSO REJECTS DRUG SORT^^0
"BLD",6459,"KRN",101,"NM",46,0)
PSO REJECTS REASON SORT^^0
"BLD",6459,"KRN",101,"NM",47,0)
PSO REJECTS REFRESH^^0
"BLD",6459,"KRN",101,"NM",48,0)
PSO REJECTS RX SORT^^0
"BLD",6459,"KRN",101,"NM",49,0)
PSO REJECT DISPLAY REOPEN^^0
"BLD",6459,"KRN",101,"NM","B","PSO PMP CHANGE VIEW",11)

"BLD",6459,"KRN",101,"NM","B","PSO PMP DRUG SORT",1)

"BLD",6459,"KRN",101,"NM","B","PSO PMP ISSUE DATE SORT",2)

"BLD",6459,"KRN",101,"NM","B","PSO PMP LAST FILL SORT",3)

"BLD",6459,"KRN",101,"NM","B","PSO PMP MENU",4)

"BLD",6459,"KRN",101,"NM","B","PSO PMP PATIENT INFORMATION",12)

"BLD",6459,"KRN",101,"NM","B","PSO PMP RX SORT",5)

"BLD",6459,"KRN",101,"NM","B","PSO PMP SELECT",6)

"BLD",6459,"KRN",101,"NM","B","PSO PMP SIG DISPLAY",7)

"BLD",6459,"KRN",101,"NM","B","PSO PMP STATUS GROUP",8)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY ADD COMMENT",16)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY CLARIFICATION CODE",17)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY HIDDEN MENU",22)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY IGNORE",41)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY MED PROFILE",15)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU",19)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU - RESOLVED",20)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY OVERRIDE",21)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY PRIOR AUTHORIZATION",23)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY REOPEN",49)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY RESUBMIT",42)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY RX EDIT",24)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY RX VIEW",40)

"BLD",6459,"KRN",101,"NM","B","PSO REJECT DISPLAY SUSPENSE DATE",43)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS DRUG SORT",45)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS GROUP BY INSURANCE",14)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS MENU",18)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS PATIENT SORT",44)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS REASON SORT",46)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS REFRESH",47)

"BLD",6459,"KRN",101,"NM","B","PSO REJECTS RX SORT",48)

"BLD",6459,"KRN",101,"NM","B","VALM DOWN A LINE",28)

"BLD",6459,"KRN",101,"NM","B","VALM FIRST SCREEN",37)

"BLD",6459,"KRN",101,"NM","B","VALM GOTO PAGE",38)

"BLD",6459,"KRN",101,"NM","B","VALM LAST SCREEN",36)

"BLD",6459,"KRN",101,"NM","B","VALM NEXT SCREEN",25)

"BLD",6459,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",26)

"BLD",6459,"KRN",101,"NM","B","VALM PRINT LIST",31)

"BLD",6459,"KRN",101,"NM","B","VALM PRINT SCREEN",30)

"BLD",6459,"KRN",101,"NM","B","VALM QUIT",35)

"BLD",6459,"KRN",101,"NM","B","VALM REFRESH",29)

"BLD",6459,"KRN",101,"NM","B","VALM SEARCH LIST",34)

"BLD",6459,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",39)

"BLD",6459,"KRN",101,"NM","B","VALM UP ONE LINE",27)

"BLD",6459,"KRN",409.61,0)
409.61
"BLD",6459,"KRN",409.61,"NM",0)
^9.68A^8^8
"BLD",6459,"KRN",409.61,"NM",1,0)
PSO REJECTS VIEW/PROCESS^^0
"BLD",6459,"KRN",409.61,"NM",2,0)
PSO REJECTS WORKLIST^^0
"BLD",6459,"KRN",409.61,"NM",3,0)
PSO PMP MAIN^^0
"BLD",6459,"KRN",409.61,"NM",4,0)
PSO NON-VA MEDS VIEW^^0
"BLD",6459,"KRN",409.61,"NM",5,0)
PSO REJECT DISPLAY^^0
"BLD",6459,"KRN",409.61,"NM",6,0)
PSO REJECT DISPLAY - RESOLVED^^0
"BLD",6459,"KRN",409.61,"NM",7,0)
PSO REJECTS PROCESSING^^1^
"BLD",6459,"KRN",409.61,"NM",8,0)
PSO LM ACTIVITY LOGS^^0
"BLD",6459,"KRN",409.61,"NM","B","PSO LM ACTIVITY LOGS",8)

"BLD",6459,"KRN",409.61,"NM","B","PSO NON-VA MEDS VIEW",4)

"BLD",6459,"KRN",409.61,"NM","B","PSO PMP MAIN",3)

"BLD",6459,"KRN",409.61,"NM","B","PSO REJECT DISPLAY",5)

"BLD",6459,"KRN",409.61,"NM","B","PSO REJECT DISPLAY - RESOLVED",6)

"BLD",6459,"KRN",409.61,"NM","B","PSO REJECTS PROCESSING",7)

"BLD",6459,"KRN",409.61,"NM","B","PSO REJECTS VIEW/PROCESS",1)

"BLD",6459,"KRN",409.61,"NM","B","PSO REJECTS WORKLIST",2)

"BLD",6459,"KRN",771,0)
771
"BLD",6459,"KRN",870,0)
870
"BLD",6459,"KRN",8989.51,0)
8989.51
"BLD",6459,"KRN",8989.52,0)
8989.52
"BLD",6459,"KRN",8994,0)
8994
"BLD",6459,"KRN","B",.4,.4)

"BLD",6459,"KRN","B",.401,.401)

"BLD",6459,"KRN","B",.402,.402)

"BLD",6459,"KRN","B",.403,.403)

"BLD",6459,"KRN","B",.5,.5)

"BLD",6459,"KRN","B",.84,.84)

"BLD",6459,"KRN","B",3.6,3.6)

"BLD",6459,"KRN","B",3.8,3.8)

"BLD",6459,"KRN","B",9.2,9.2)

"BLD",6459,"KRN","B",9.8,9.8)

"BLD",6459,"KRN","B",19,19)

"BLD",6459,"KRN","B",19.1,19.1)

"BLD",6459,"KRN","B",101,101)

"BLD",6459,"KRN","B",409.61,409.61)

"BLD",6459,"KRN","B",771,771)

"BLD",6459,"KRN","B",870,870)

"BLD",6459,"KRN","B",8989.51,8989.51)

"BLD",6459,"KRN","B",8989.52,8989.52)

"BLD",6459,"KRN","B",8994,8994)

"BLD",6459,"QUES",0)
^9.62^^
"BLD",6459,"REQB",0)
^9.611^7^5
"BLD",6459,"REQB",3,0)
PSO*7.0*258^2
"BLD",6459,"REQB",4,0)
PSO*7.0*200^2
"BLD",6459,"REQB",5,0)
PSO*7.0*233^2
"BLD",6459,"REQB",6,0)
PSS*1.0*127^2
"BLD",6459,"REQB",7,0)
PSO*7.0*268^2
"BLD",6459,"REQB","B","PSO*7.0*200",4)

"BLD",6459,"REQB","B","PSO*7.0*233",5)

"BLD",6459,"REQB","B","PSO*7.0*258",3)

"BLD",6459,"REQB","B","PSO*7.0*268",7)

"BLD",6459,"REQB","B","PSS*1.0*127",6)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52.25)
1
"FIA",52,52.25,24)

"FIA",52,52.25,25)

"FIA",52,52.25,26)

"FIA",52,52.25,51)

"FIA",52,52.2551)
0
"FIA",52.85)
EPHARMACY MEDICATION PROFILE PREFERENCES
"FIA",52.85,0)
^PS(52.85,
"FIA",52.85,0,0)
52.85P
"FIA",52.85,0,1)
y^y^f^^^^n
"FIA",52.85,0,10)

"FIA",52.85,0,11)

"FIA",52.85,0,"RLRO")

"FIA",52.85,0,"VR")
7.0^PSO
"FIA",52.85,52.85)
0
"FIA",52.85,52.8551)
0
"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,101)

"INIT")
PSO260PI
"KRN",19,2920221,-1)
2^3
"KRN",19,2920221,0)
PSO EPHARMACY MENU^ePharmacy Menu^^M^520651032^^^^^^^
"KRN",19,2920221,10,0)
^19.01IP^5^5
"KRN",19,2920221,10,3,0)
2920232^MP
"KRN",19,2920221,10,3,"^")
PSO PMP
"KRN",19,2920221,10,4,0)
2920233^PF
"KRN",19,2920221,10,4,"^")
PSO PMP SITE PREFERENCES
"KRN",19,2920221,10,5,0)
2920291^IR
"KRN",19,2920221,10,5,"^")
PSO IGNORED REJECTS REPORT
"KRN",19,2920221,"U")
EPHARMACY MENU
"KRN",19,2920232,-1)
0^1
"KRN",19,2920232,0)
PSO PMP^ePharmacy Medication Profile (View Only)^^A^^^^^^^^^^1
"KRN",19,2920232,20)
D EN^PSOPMP0
"KRN",19,2920232,"U")
EPHARMACY MEDICATION PROFILE (
"KRN",19,2920233,-1)
0^2
"KRN",19,2920233,0)
PSO PMP SITE PREFERENCES^ePharmacy Medication Profile Division Preferences^^A^^PSORPH^^^^^^^^1
"KRN",19,2920233,20)
D ^PSOPMPPF
"KRN",19,2920233,"U")
EPHARMACY MEDICATION PROFILE D
"KRN",19,2920291,-1)
0^4
"KRN",19,2920291,0)
PSO IGNORED REJECTS REPORT^Ignored Rejects Report^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2920291,25)
PSOBPSRP
"KRN",19,2920291,"U")
IGNORED REJECTS REPORT
"KRN",101,1689,-1)
0^25
"KRN",101,1689,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1689,1,0)
^^2^2^2920519^^^
"KRN",101,1689,1,1,0)
This action will allow the user to view the next screen
"KRN",101,1689,1,2,0)
of entries, if any exist.
"KRN",101,1689,2,0)
^101.02A^1^1
"KRN",101,1689,2,1,0)
NX
"KRN",101,1689,2,"B","NX",1)

"KRN",101,1689,15)

"KRN",101,1689,20)
D NEXT^VALM4
"KRN",101,1689,99)
60862,42011
"KRN",101,1690,-1)
0^26
"KRN",101,1690,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1690,1,0)
^^2^2^2920113^^
"KRN",101,1690,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,1690,1,2,0)
of entries, if any exist.
"KRN",101,1690,2,0)
^101.02A^3^2
"KRN",101,1690,2,1,0)
PR
"KRN",101,1690,2,2,0)
BK
"KRN",101,1690,2,3,0)
PR
"KRN",101,1690,2,"B","BK",2)

"KRN",101,1690,2,"B","PR",1)

"KRN",101,1690,2,"B","PR",3)

"KRN",101,1690,20)
D PREV^VALM4
"KRN",101,1690,99)
60862,42011
"KRN",101,1691,-1)
0^29
"KRN",101,1691,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1691,1,0)
^^1^1^2911024^
"KRN",101,1691,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,1691,2,0)
^101.02A^1^1
"KRN",101,1691,2,1,0)
RE
"KRN",101,1691,2,"B","RE",1)

"KRN",101,1691,10,0)
^101.01PA^0^0
"KRN",101,1691,20)
D RE^VALM4
"KRN",101,1691,99)
60862,42011
"KRN",101,1692,-1)
0^36
"KRN",101,1692,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1692,1,0)
^^1^1^2911026^
"KRN",101,1692,1,1,0)
The action will display the last items.
"KRN",101,1692,20)
D LAST^VALM4
"KRN",101,1692,99)
60862,42011
"KRN",101,1693,-1)
0^37
"KRN",101,1693,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1693,1,0)
^^1^1^2960619^^
"KRN",101,1693,1,1,0)
This action will display the first screen.
"KRN",101,1693,15)

"KRN",101,1693,20)
D FIRST^VALM4
"KRN",101,1693,99)
60862,42011
"KRN",101,1694,-1)
0^27
"KRN",101,1694,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1694,1,0)
^^1^1^2911027^
"KRN",101,1694,1,1,0)
Move up a line
"KRN",101,1694,20)
D UP^VALM40
"KRN",101,1694,99)
60862,42011
"KRN",101,1695,-1)
0^28
"KRN",101,1695,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1695,1,0)
^^2^2^2950628^^
"KRN",101,1695,1,1,0)
Move down a line.
"KRN",101,1695,1,2,0)

"KRN",101,1695,3,0)
^101.03P^0^0
"KRN",101,1695,20)
D DOWN^VALM40
"KRN",101,1695,99)
60862,42011
"KRN",101,1697,-1)
0^35
"KRN",101,1697,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1697,.1)
 
"KRN",101,1697,1,0)
^^1^1^2911105^
"KRN",101,1697,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1697,2,0)
^101.02A^2^2
"KRN",101,1697,2,1,0)
EXIT
"KRN",101,1697,2,2,0)
QUIT
"KRN",101,1697,2,"B","EXIT",1)

"KRN",101,1697,2,"B","QUIT",2)

"KRN",101,1697,15)

"KRN",101,1697,20)
Q
"KRN",101,1697,99)
60862,42011
"KRN",101,1698,-1)
0^30
"KRN",101,1698,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1698,1,0)
^^3^3^2920113^^
"KRN",101,1698,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,1698,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,1698,1,3,0)
list are printed.
"KRN",101,1698,20)
D PRT^VALM1
"KRN",101,1698,99)
60862,42011
"KRN",101,1699,-1)
0^31
"KRN",101,1699,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,1699,1,0)
^^2^2^2920113^
"KRN",101,1699,1,1,0)
This action allws the user to print the entire list of
"KRN",101,1699,1,2,0)
entries currently being displayed.
"KRN",101,1699,20)
D PRTL^VALM1
"KRN",101,1699,99)
60862,42011
"KRN",101,1701,-1)
0^39
"KRN",101,1701,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,1701,20)
D MENU^VALM2
"KRN",101,1701,99)
60862,42011
"KRN",101,1703,-1)
0^34
"KRN",101,1703,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,1703,1,0)
^^1^1^2920303^^
"KRN",101,1703,1,1,0)
Finds text in list of entries.
"KRN",101,1703,20)
D FIND^VALM40
"KRN",101,1703,99)
60862,42011
"KRN",101,1713,-1)
0^38
"KRN",101,1713,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,1713,1,0)
^^1^1^2930113^
"KRN",101,1713,1,1,0)

"KRN",101,1713,20)
D GOTO^VALM40
"KRN",101,1713,99)
60862,42011
"KRN",101,7125,-1)
0^18
"KRN",101,7125,0)
PSO REJECTS MENU^Rejects Processing Menu^^M^^^^^^^^
"KRN",101,7125,4)
26^4
"KRN",101,7125,10,0)
^101.01PA^6^6
"KRN",101,7125,10,1,0)
7126^PA^2^
"KRN",101,7125,10,1,"^")
PSO REJECTS PATIENT SORT
"KRN",101,7125,10,2,0)
7127^DR^1^
"KRN",101,7125,10,2,"^")
PSO REJECTS DRUG SORT
"KRN",101,7125,10,3,0)
7128^RE^3^
"KRN",101,7125,10,3,"^")
PSO REJECTS REASON SORT
"KRN",101,7125,10,4,0)
7129^RF^4^
"KRN",101,7125,10,4,"^")
PSO REJECTS REFRESH
"KRN",101,7125,10,5,0)
7131^RX^5^
"KRN",101,7125,10,5,"^")
PSO REJECTS RX SORT
"KRN",101,7125,10,6,0)
7169^GI^6^
"KRN",101,7125,10,6,"^")
PSO REJECTS GROUP BY INSURANCE
"KRN",101,7125,20)

"KRN",101,7125,26)
D SHOW^VALM,HDR^PSOREJP0 S XQORM("#")=$O(^ORD(101,"B","PSO REJECTS SELECT",""))_"^1:"_(VALMCNT\2),XQORM("??")="D HELP^VALM2,HDR^PSOREJP0"
"KRN",101,7125,28)
Select: 
"KRN",101,7125,99)
60862,42011
"KRN",101,7126,-1)
0^44
"KRN",101,7126,0)
PSO REJECTS PATIENT SORT^Sort by Patient^^A^^^^^^^^
"KRN",101,7126,4)
^^^PA
"KRN",101,7126,20)
D PAT^PSOREJP0
"KRN",101,7126,99)
60862,42011
"KRN",101,7127,-1)
0^45
"KRN",101,7127,0)
PSO REJECTS DRUG SORT^Sort by Drug^^A^^^^^^^^
"KRN",101,7127,4)
^^^DR
"KRN",101,7127,20)
D DRG^PSOREJP0
"KRN",101,7127,99)
60862,42011
"KRN",101,7128,-1)
0^46
"KRN",101,7128,0)
PSO REJECTS REASON SORT^Sort by Reason^^A^^^^^^^^
"KRN",101,7128,4)
^^^RE
"KRN",101,7128,20)
D REA^PSOREJP0
"KRN",101,7128,99)
60862,42011
"KRN",101,7129,-1)
0^47
"KRN",101,7129,0)
PSO REJECTS REFRESH^Screen Refresh^^A^^^^^^^^
"KRN",101,7129,4)
^^^SR
"KRN",101,7129,20)
D REF^PSOREJP0
"KRN",101,7129,99)
60862,42011
"KRN",101,7131,-1)
0^48
"KRN",101,7131,0)
PSO REJECTS RX SORT^Sort by Prescription^^A^^^^^^^^
"KRN",101,7131,4)
^^^RX
"KRN",101,7131,20)
D RX^PSOREJP0
"KRN",101,7131,99)
60862,42011
"KRN",101,7132,-1)
0^21
"KRN",101,7132,0)
PSO REJECT DISPLAY OVERRIDE^Submit Override Codes^^A^^^^^^^^
"KRN",101,7132,4)
^^^OVR
"KRN",101,7132,20)
D OVR^PSOREJP1
"KRN",101,7132,99)
60862,42011
"KRN",101,7133,-1)
0^42
"KRN",101,7133,0)
PSO REJECT DISPLAY RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7133,4)
^^^RES
"KRN",101,7133,20)
D RES^PSOREJP1
"KRN",101,7133,99)
60862,42011
"KRN",101,7134,-1)
0^24
"KRN",101,7134,0)
PSO REJECT DISPLAY RX EDIT^Edit Rx^^A^^^^^^^^
"KRN",101,7134,4)
^^^ED
"KRN",101,7134,20)
D EDT^PSOREJP1
"KRN",101,7134,99)
60862,42011
"KRN",101,7135,-1)
0^19
"KRN",101,7135,0)
PSO REJECT DISPLAY MENU^Reject Display Menu^^M^^^^^^^^
"KRN",101,7135,4)
26^4
"KRN",101,7135,10,0)
^101.01PA^8^8
"KRN",101,7135,10,2,0)
7133^RES^4^
"KRN",101,7135,10,2,"^")
PSO REJECT DISPLAY RESUBMIT
"KRN",101,7135,10,3,0)
7132^OVR^5^
"KRN",101,7135,10,3,"^")
PSO REJECT DISPLAY OVERRIDE
"KRN",101,7135,10,4,0)
7138^IGN^3^
"KRN",101,7135,10,4,"^")
PSO REJECT DISPLAY IGNORE
"KRN",101,7135,10,5,0)
7136^VW^1^
"KRN",101,7135,10,5,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7135,10,7,0)
7168^MP^2^
"KRN",101,7135,10,7,"^")
PSO REJECT DISPLAY MED PROFILE
"KRN",101,7135,10,8,0)
7139^CSD^6^
"KRN",101,7135,10,8,"^")
PSO REJECT DISPLAY SUSPENSE DATE
"KRN",101,7135,20)

"KRN",101,7135,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7135,28)
Select: 
"KRN",101,7135,99)
60862,42011
"KRN",101,7136,-1)
0^40
"KRN",101,7136,0)
PSO REJECT DISPLAY RX VIEW^View Rx^^A^^^^^^^^
"KRN",101,7136,20)
D VIEW^PSOREJP1
"KRN",101,7136,99)
60862,42011
"KRN",101,7138,-1)
0^41
"KRN",101,7138,0)
PSO REJECT DISPLAY IGNORE^Ignore Reject^^A^^^^^^^^
"KRN",101,7138,4)
^^^CR
"KRN",101,7138,20)
D CLO^PSOREJP2
"KRN",101,7138,99)
60862,42011
"KRN",101,7139,-1)
0^43
"KRN",101,7139,0)
PSO REJECT DISPLAY SUSPENSE DATE^Change Suspense Date^^A^^^^^^^^
"KRN",101,7139,4)
^^^
"KRN",101,7139,20)
D CHG^PSOREJP2
"KRN",101,7139,99)
60862,42011
"KRN",101,7140,-1)
0^20
"KRN",101,7140,0)
PSO REJECT DISPLAY MENU - RESOLVED^Reject Display Menu - Resolved^^M^^^^^^^^
"KRN",101,7140,4)
26^4
"KRN",101,7140,10,0)
^101.01PA^5^5
"KRN",101,7140,10,1,0)
7136^VW^1^
"KRN",101,7140,10,1,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7140,10,2,0)
7134^ED^4^
"KRN",101,7140,10,2,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7140,10,3,0)
7141^OPN^3^
"KRN",101,7140,10,3,"^")
PSO REJECT DISPLAY REOPEN
"KRN",101,7140,10,4,0)
7168^MP^2^
"KRN",101,7140,10,4,"^")
PSO REJECT DISPLAY MED PROFILE
"KRN",101,7140,10,5,0)
7170^COM^^
"KRN",101,7140,10,5,"^")
PSO REJECT DISPLAY ADD COMMENT
"KRN",101,7140,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7140,28)
Select: 
"KRN",101,7140,99)
60862,42011
"KRN",101,7141,-1)
0^49
"KRN",101,7141,0)
PSO REJECT DISPLAY REOPEN^Reopen Reject^^A^^^^^^^^
"KRN",101,7141,4)
^^^
"KRN",101,7141,20)
D OPN^PSOREJP2
"KRN",101,7141,99)
60862,42011
"KRN",101,7158,-1)
0^4
"KRN",101,7158,0)
PSO PMP MENU^Patient Medication Profile^^M^^^^^^^^
"KRN",101,7158,4)
26^4^^MP
"KRN",101,7158,10,0)
^101.01PA^9^9
"KRN",101,7158,10,1,0)
7160^RX^^
"KRN",101,7158,10,1,"^")
PSO PMP RX SORT
"KRN",101,7158,10,2,0)
7162^LF^^
"KRN",101,7158,10,2,"^")
PSO PMP LAST FILL SORT
"KRN",101,7158,10,3,0)
7161^ID^^
"KRN",101,7158,10,3,"^")
PSO PMP ISSUE DATE SORT
"KRN",101,7158,10,4,0)
7163^DR^^
"KRN",101,7158,10,4,"^")
PSO PMP DRUG SORT
"KRN",101,7158,10,5,0)
7164^GS^^
"KRN",101,7158,10,5,"^")
PSO PMP STATUS GROUP
"KRN",101,7158,10,6,0)
7165^SIG^^
"KRN",101,7158,10,6,"^")
PSO PMP SIG DISPLAY
"KRN",101,7158,10,8,0)
7166^PI^^
"KRN",101,7158,10,8,"^")
PSO PMP PATIENT INFORMATION
"KRN",101,7158,10,9,0)
7167^CV^^
"KRN",101,7158,10,9,"^")
PSO PMP CHANGE VIEW
"KRN",101,7158,26)
D SHOW^VALM,HDR^PSOPMP0 S XQORM("#")=$O(^ORD(101,"B","PSO PMP SELECT",""))_"^1:"_VALMCNT,XQORM("??")="D HELP^VALM2,HDR^PSOPMP0"
"KRN",101,7158,28)
Select: 
"KRN",101,7158,99)
60862,42011
"KRN",101,7159,-1)
0^6
"KRN",101,7159,0)
PSO PMP SELECT^Select a prescription^^A^^^^^^^^
"KRN",101,7159,4)
^^^SP
"KRN",101,7159,20)
D SEL^PSOPMP0
"KRN",101,7159,99)
60862,42011
"KRN",101,7160,-1)
0^5
"KRN",101,7160,0)
PSO PMP RX SORT^Sort by Prescription^^A^^^^^^^^
"KRN",101,7160,2,0)
^101.02A^^0
"KRN",101,7160,4)
^^^RX
"KRN",101,7160,20)
D RX^PSOPMP0
"KRN",101,7160,99)
60862,42011
"KRN",101,7161,-1)
0^2
"KRN",101,7161,0)
PSO PMP ISSUE DATE SORT^Sort by Issue Date^^A^^^^^^^^
"KRN",101,7161,4)
^^^ID
"KRN",101,7161,20)
D ID^PSOPMP0
"KRN",101,7161,99)
60862,42011
"KRN",101,7162,-1)
0^3
"KRN",101,7162,0)
PSO PMP LAST FILL SORT^Sort by Last Fill^^A^^^^^^^^
"KRN",101,7162,4)
^^^LF
"KRN",101,7162,20)
D LF^PSOPMP0
"KRN",101,7162,99)
60862,42011
"KRN",101,7163,-1)
0^1
"KRN",101,7163,0)
PSO PMP DRUG SORT^Sort by Drug^^A^^^^^^^^
"KRN",101,7163,4)
^^^DR
"KRN",101,7163,20)
D DR^PSOPMP0
"KRN",101,7163,99)
60862,42011
"KRN",101,7164,-1)
0^8
"KRN",101,7164,0)
PSO PMP STATUS GROUP^Group by Status^^A^^^^^^^^
"KRN",101,7164,4)
^^^GS
"KRN",101,7164,20)
D GS^PSOPMP0
"KRN",101,7164,99)
60862,42011
"KRN",101,7165,-1)
0^7
"KRN",101,7165,0)
PSO PMP SIG DISPLAY^Show/Hide SIG^^A^^^^^^^^
"KRN",101,7165,4)
^^^SIG
"KRN",101,7165,20)
D SIG^PSOPMP0
"KRN",101,7165,99)
60862,42011
"KRN",101,7166,-1)
0^12
"KRN",101,7166,0)
PSO PMP PATIENT INFORMATION^Patient Information^^A^^^^^^^^
"KRN",101,7166,4)
^^^PI
"KRN",101,7166,20)
D PI^PSOPMP0
"KRN",101,7166,99)
60862,42011
"KRN",101,7167,-1)
0^11
"KRN",101,7167,0)
PSO PMP CHANGE VIEW^Change View^^A^^^^^^^^
"KRN",101,7167,4)
^^^CV
"KRN",101,7167,20)
D CV^PSOPMP0
"KRN",101,7167,99)
60862,42011
"KRN",101,7168,-1)
0^15
"KRN",101,7168,0)
PSO REJECT DISPLAY MED PROFILE^Medication Profile^^A^^^^^^^^
"KRN",101,7168,4)
^^^MP
"KRN",101,7168,20)
D MP^PSOREJP1
"KRN",101,7168,99)
60862,42011
"KRN",101,7169,-1)
0^14
"KRN",101,7169,0)
PSO REJECTS GROUP BY INSURANCE^Group by Insurance^^A^^^^^^^^
"KRN",101,7169,4)
^^^GI
"KRN",101,7169,20)
D GI^PSOREJP0
"KRN",101,7169,99)
60862,42011
"KRN",101,7170,-1)
0^16
"KRN",101,7170,0)
PSO REJECT DISPLAY ADD COMMENT^Add Comments^^A^^^^^^^^
"KRN",101,7170,20)
D ADDCOM^PSOREJP3
"KRN",101,7170,99)
60862,42011
"KRN",101,7171,-1)
0^17
"KRN",101,7171,0)
PSO REJECT DISPLAY CLARIFICATION CODE^Submit Clarif. Code^^A^^^^^^^^
"KRN",101,7171,4)
^^^CLA
"KRN",101,7171,20)
D CLA^PSOREJP1
"KRN",101,7171,99)
60862,42011
"KRN",101,7224,-1)
0^22
"KRN",101,7224,0)
PSO REJECT DISPLAY HIDDEN MENU^Reject Display Hidden Menu^^M^^^^^^^^
"KRN",101,7224,1,0)
^101.06^1^1^3070320^^^^
"KRN",101,7224,1,1,0)
This is the hidden menu option for the Reject Information(UNRESOLVED) [PSO REJECT DISPLAY] ListMan screen.
"KRN",101,7224,4)
26^3
"KRN",101,7224,10,0)
^101.01PA^20^20
"KRN",101,7224,10,1,0)
1689^+^10^
"KRN",101,7224,10,1,"^")
VALM NEXT SCREEN
"KRN",101,7224,10,2,0)
1690^-^11^
"KRN",101,7224,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,7224,10,3,0)
1694^UP^13^
"KRN",101,7224,10,3,"^")
VALM UP ONE LINE
"KRN",101,7224,10,5,0)
1691^RD^19^
"KRN",101,7224,10,5,"^")
VALM REFRESH
"KRN",101,7224,10,6,0)
1698^PS^20^
"KRN",101,7224,10,6,"^")
VALM PRINT SCREEN
"KRN",101,7224,10,7,0)
1699^PL^21^
"KRN",101,7224,10,7,"^")
VALM PRINT LIST
"KRN",101,7224,10,10,0)
1703^SL^22^
"KRN",101,7224,10,10,"^")
VALM SEARCH LIST
"KRN",101,7224,10,11,0)
1697^QU^24^
"KRN",101,7224,10,11,"^")
VALM QUIT
"KRN",101,7224,10,12,0)
1692^LS^17^
"KRN",101,7224,10,12,"^")
VALM LAST SCREEN
"KRN",101,7224,10,13,0)
1693^FS^16^
"KRN",101,7224,10,13,"^")
VALM FIRST SCREEN
"KRN",101,7224,10,14,0)
1713^GO^18^
"KRN",101,7224,10,14,"^")
VALM GOTO PAGE
"KRN",101,7224,10,15,0)
7134^ED^3^
"KRN",101,7224,10,15,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7224,10,16,0)
7171^CLA^2^
"KRN",101,7224,10,16,"^")
PSO REJECT DISPLAY CLARIFICATION CODE
"KRN",101,7224,10,17,0)
7170^COM^1^
"KRN",101,7224,10,17,"^")
PSO REJECT DISPLAY ADD COMMENT
"KRN",101,7224,10,18,0)
1701^ADPL^23^
"KRN",101,7224,10,18,"^")
VALM TURN ON/OFF MENUS
"KRN",101,7224,10,19,0)
7225^PA^4^
"KRN",101,7224,10,19,"^")
PSO REJECT DISPLAY PRIOR AUTHORIZATION
"KRN",101,7224,10,20,0)
1695^DN^12^
"KRN",101,7224,10,20,"^")
VALM DOWN A LINE
"KRN",101,7224,15)

"KRN",101,7224,99)
60862,42011
"KRN",101,7225,-1)
0^23
"KRN",101,7225,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^Submit Prior Auth.^^A^^^^^^^^
"KRN",101,7225,4)
^^^PA
"KRN",101,7225,20)
D PA^PSOREJP1
"KRN",101,7225,99)
60862,42011
"KRN",409.61,343,-1)
0^8
"KRN",409.61,343,0)
PSO LM ACTIVITY LOGS^2^^80^6^21^1^1^^^Rx Activity Log^1^^1
"KRN",409.61,343,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,343,"ARRAY")
 ^TMP("PSOAL",$J)
"KRN",409.61,343,"FNL")
D EXIT^PSOORAL
"KRN",409.61,343,"HDR")
D HDR^PSOLMUTL
"KRN",409.61,343,"HLP")
D HELP^PSOORAL
"KRN",409.61,343,"INIT")
D INIT^PSOORAL
"KRN",409.61,615,-1)
0^5
"KRN",409.61,615,0)
PSO REJECT DISPLAY^1^^80^7^20^0^1^^PSO REJECT DISPLAY MENU^Reject Information(UNRESOLVED)^1^^1
"KRN",409.61,615,1)
^PSO REJECT DISPLAY HIDDEN MENU
"KRN",409.61,615,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,615,"COL",0)
^409.621^^0
"KRN",409.61,615,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,615,"HDR")
D HDR^PSOREJP1
"KRN",409.61,615,"HLP")
D HELP^PSOREJP1
"KRN",409.61,615,"INIT")
D INIT^PSOREJP1
"KRN",409.61,616,-1)
0^6
"KRN",409.61,616,0)
PSO REJECT DISPLAY - RESOLVED^1^^80^7^20^0^1^^PSO REJECT DISPLAY MENU - RESOLVED^Reject Information(RESOLVED)^1^^1
"KRN",409.61,616,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,616,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,616,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,616,"HDR")
D HDR^PSOREJP1
"KRN",409.61,616,"HLP")
D HELP^PSOREJP1
"KRN",409.61,616,"INIT")
D INIT^PSOREJP1
"KRN",409.61,623,-1)
0^2
"KRN",409.61,623,0)
PSO REJECTS WORKLIST^1^^80^5^20^0^1^^PSO REJECTS MENU^Insurance Rejects-Worklist^1^^1
"KRN",409.61,623,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,623,"ARRAY")
 ^TMP("PSOREJP0",$J)
"KRN",409.61,623,"COL",0)
^409.621^^0
"KRN",409.61,623,"FNL")
D EXIT^PSOREJP0
"KRN",409.61,623,"HDR")
D HDR^PSOREJP0
"KRN",409.61,623,"HLP")
D HELP^PSOREJP0
"KRN",409.61,623,"INIT")
D INIT^PSOREJP0
"KRN",409.61,624,-1)
0^1
"KRN",409.61,624,0)
PSO REJECTS VIEW/PROCESS^1^^80^6^20^0^1^^PSO REJECTS MENU^Insurance Rejects-View/Process^1^^1
"KRN",409.61,624,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,624,"ARRAY")
 ^TMP("PSOREJP0",$J)
"KRN",409.61,624,"FNL")
D EXIT^PSOREJP0
"KRN",409.61,624,"HDR")
D HDR^PSOREJP0
"KRN",409.61,624,"HLP")
D HELP^PSOREJP0
"KRN",409.61,624,"INIT")
D INIT^PSOREJP0
"KRN",409.61,625,-1)
0^3
"KRN",409.61,625,0)
PSO PMP MAIN^1^^80^8^19^0^1^^PSO PMP MENU^Patient Medication Profile^1^^1
"KRN",409.61,625,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,625,"ARRAY")
 ^TMP("PSOPMP0",$J)
"KRN",409.61,625,"FNL")
D EXIT^PSOPMP0
"KRN",409.61,625,"HDR")
D HDR^PSOPMP0
"KRN",409.61,625,"HLP")
D HELP^PSOPMP0
"KRN",409.61,625,"INIT")
D INIT^PSOPMP0
"KRN",409.61,626,-1)
0^4
"KRN",409.61,626,0)
PSO NON-VA MEDS VIEW^2^^80^6^21^0^1^^^Non-VA Meds View^1^^1
"KRN",409.61,626,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,626,"ARRAY")
 ^TMP("PSONVAVW",$J)
"KRN",409.61,626,"FNL")
D EXIT^PSONVAVW
"KRN",409.61,626,"HDR")
D HDR^PSONVAVW
"KRN",409.61,626,"HLP")
D HELP^PSONVAVW
"KRN",409.61,626,"INIT")
D INIT^PSONVAVW
"KRN",409.61,645,-1)
1^7
"KRN",409.61,645,0)
PSO REJECTS PROCESSING
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
260^3070822^520651048
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
29
"RTN","PSO260PI")
0^^B23082
"RTN","PSO260PI",1,0)
PSO260PI ;BIRM/MFR - ePharmacy - Patch PSO*7*260 Post-Install ;10/15/04
"RTN","PSO260PI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSO260PI",3,0)
 ; 
"RTN","PSO260PI",4,0)
 ; - This set will prevent users from manually entering rejects because it causes problems
"RTN","PSO260PI",5,0)
 S ^DD(52,52.25,9)="^"
"RTN","PSO260PI",6,0)
 ;
"RTN","PSO260PI",7,0)
 Q
"RTN","PSOBPSR1")
0^29^B37279361
"RTN","PSOBPSR1",1,0)
PSOBPSR1 ;BHM/LE - continued Ignored Claims Report ;03/01/07
"RTN","PSOBPSR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;13 Feb 97;Build 84
"RTN","PSOBPSR1",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSOBPSR1",4,0)
 ;External reference to $$GET1^DIQ is supported by DBIA 2056
"RTN","PSOBPSR1",5,0)
 ;External reference to ^VADPT is supported by DBIA 10061
"RTN","PSOBPSR1",6,0)
 ;External reference to ^XLFDT is supported by DBIA 10103
"RTN","PSOBPSR1",7,0)
 ;External reference to ^%ZISC is supported by DBIA 10089
"RTN","PSOBPSR1",8,0)
 ;
"RTN","PSOBPSR1",9,0)
EN N CLOSE,CDATE,DFN,DRG,RXIEN,PAG,PCNT,PRTD,PNAM,I,II,J,Y,X,XX,S1,S2,S3,S4,S5,FCNT,CBYI
"RTN","PSOBPSR1",10,0)
 N SP1,SP2,SEQ2,CINFO,RDATE,RSEQ,PSORX,RXINFO,DNAMI,CDIV,CDIVN,OCDIV,RXNUMB,PSORXN,RXE
"RTN","PSOBPSR1",11,0)
 U IO K ^TMP("PSOBPSRP",$J),^TMP("PSOBPSRC",$J)
"RTN","PSOBPSR1",12,0)
 S (SP1,SP2)="",$P(SP1,"=",81)="",$P(SP2,"-",81)=""
"RTN","PSOBPSR1",13,0)
 ;
"RTN","PSOBPSR1",14,0)
 ; - Loop through reject dates xref
"RTN","PSOBPSR1",15,0)
 S (RXIEN,PCNT,FCNT,PRTD)=0 K DIRUT
"RTN","PSOBPSR1",16,0)
 S RDATE=PSOSD
"RTN","PSOBPSR1",17,0)
 ;
"RTN","PSOBPSR1",18,0)
DATE ;
"RTN","PSOBPSR1",19,0)
 S RDATE=$O(^PSRX("REJDAT",RDATE)) G NEXT:RDATE=""!(RDATE>PSOED)
"RTN","PSOBPSR1",20,0)
RX ;
"RTN","PSOBPSR1",21,0)
 S RXIEN=$O(^PSRX("REJDAT",RDATE,RXIEN)) G DATE:RXIEN=""
"RTN","PSOBPSR1",22,0)
 S (DFN,DRG,PNAM,DNAM,DNAMI,RXE)=""
"RTN","PSOBPSR1",23,0)
 K RXINFO D GETS^DIQ(52,RXIEN_",",".01;2;6","IE","RXINFO")
"RTN","PSOBPSR1",24,0)
 S PNAM=$G(RXINFO(52,RXIEN_",",2,"E")),DNAM=$G(RXINFO(52,RXIEN_",",6,"E"))
"RTN","PSOBPSR1",25,0)
 S DFN=$G(RXINFO(52,RXIEN_",",2,"I")),DNAMI=$G(RXINFO(52,RXIEN_",",6,"I"))
"RTN","PSOBPSR1",26,0)
 S RXE=$G(RXINFO(52,RXIEN_",",.01,"E"))_" "
"RTN","PSOBPSR1",27,0)
 I '$G(PSOAPT),'$D(PSOPT(DFN)) G RX   ;user selected specific patients
"RTN","PSOBPSR1",28,0)
 I '$G(PSODRUG),'$D(PSODRG(DNAMI)) G RX
"RTN","PSOBPSR1",29,0)
 ;
"RTN","PSOBPSR1",30,0)
 ;look for ignored rejects 
"RTN","PSOBPSR1",31,0)
 S SEQ2=0 F  S SEQ2=$O(^PSRX(RXIEN,"REJ",SEQ2)) Q:'SEQ2&(SEQ2'?1N.N)  D
"RTN","PSOBPSR1",32,0)
 . S (CDATE,CBY,CBYI,CFILL,CDIV)=""
"RTN","PSOBPSR1",33,0)
 . K CLOSE D GETS^DIQ(52.25,SEQ2_","_RXIEN_",","5;10;11;12","IE","CLOSE")
"RTN","PSOBPSR1",34,0)
 . S CDATE=$G(CLOSE(52.25,SEQ2_","_RXIEN_",",10,"I"))
"RTN","PSOBPSR1",35,0)
 . S CFILL=$G(CLOSE(52.25,SEQ2_","_RXIEN_",",5,"I"))
"RTN","PSOBPSR1",36,0)
 . S CDIV=$$RXSITE^PSOBPSUT(RXIEN,CFILL)
"RTN","PSOBPSR1",37,0)
 . I '$G(PSOSIT)&'$D(PSODIV(CDIV)) Q
"RTN","PSOBPSR1",38,0)
 . I $G(CLOSE(52.25,SEQ2_","_RXIEN_",",12,"I"))=6,(CDATE'<PSOSD&(CDATE'>PSOED)) D
"RTN","PSOBPSR1",39,0)
 . . S CBY=$G(CLOSE(52.25,SEQ2_","_RXIEN_",",11,"E"))
"RTN","PSOBPSR1",40,0)
 . . S CBYI=$G(CLOSE(52.25,SEQ2_","_RXIEN_",",11,"I"))
"RTN","PSOBPSR1",41,0)
 . . I '$G(PSOUSER),'$D(PSOU(CBYI)) Q  ;user selected specific user for "ignored by" column in report
"RTN","PSOBPSR1",42,0)
 . . D SET
"RTN","PSOBPSR1",43,0)
 G RX
"RTN","PSOBPSR1",44,0)
 ;
"RTN","PSOBPSR1",45,0)
NEXT ; - If not Sorting (already printed), SKIP, otherwise, print the report
"RTN","PSOBPSR1",46,0)
 I '$D(^TMP("PSOBPSRP")) G NDTP
"RTN","PSOBPSR1",47,0)
 S (S1,S2,S3,DFN,RSEQ,PSORX,PSORXN,RXNUMB,CDIV,OCDIV,CDIVN)=""
"RTN","PSOBPSR1",48,0)
 F  S CDIV=$O(^TMP("PSOBPSRP",$J,CDIV)) Q:CDIV=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",49,0)
 . F  S S1=$O(^TMP("PSOBPSRP",$J,CDIV,S1)) Q:S1=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",50,0)
 . . F  S S2=$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2)) Q:S2=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",51,0)
 . . . F  S S3=$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2,S3)) Q:S3=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",52,0)
 . . . . F  S DFN=$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2,S3,DFN)) Q:DFN=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",53,0)
 . . . . . F  S PSORXN=$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2,S3,DFN,PSORXN)) Q:PSORXN=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",54,0)
 . . . . . . F  S RSEQ=$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2,S3,DFN,PSORXN,RSEQ)) Q:RSEQ=""  D  Q:$D(DIRUT)
"RTN","PSOBPSR1",55,0)
 . . . . . . . I $Y>(IOSL-7)&($E(IOST)="C") D HDR I $D(DIRUT) Q
"RTN","PSOBPSR1",56,0)
 . . . . . . . I $Y>(IOSL-12)&($E(IOST)'="C") D HDR I $D(DIRUT) Q
"RTN","PSOBPSR1",57,0)
 . . . . . . . S (RXNUMB,PSORX)="",RXNUMB=$E(PSORXN,1,$L(PSORXN)-1),PSORX=$O(^PSRX("B",RXNUMB,PSORX))
"RTN","PSOBPSR1",58,0)
 . . . . . . . D PRINT(DFN,PSORX)
"RTN","PSOBPSR1",59,0)
 . . . I '$D(DIRUT),S2'=0,$O(^TMP("PSOBPSRP",$J,CDIV,S1,S2))'="" W SP2
"RTN","PSOBPSR1",60,0)
 . . I '$D(DIRUT),$O(^TMP("PSOBPSRP",$J,CDIV,S1))'="" W !,SP1
"RTN","PSOBPSR1",61,0)
 G CLOSE:$D(DIRUT)
"RTN","PSOBPSR1",62,0)
 ;
"RTN","PSOBPSR1",63,0)
NDTP I 'PRTD D HDR W !!?18,"**********   NO DATA TO PRINT   **********"
"RTN","PSOBPSR1",64,0)
 I $G(PCNT) D
"RTN","PSOBPSR1",65,0)
 . W !,SP1
"RTN","PSOBPSR1",66,0)
 . W !,"Total: ",PCNT," patient",$S(PCNT>1:"s",1:"")
"RTN","PSOBPSR1",67,0)
 . W " and ",FCNT," prescription fill",$S(FCNT>1:"s",1:""),"."
"RTN","PSOBPSR1",68,0)
 ;
"RTN","PSOBPSR1",69,0)
CLOSE ;
"RTN","PSOBPSR1",70,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBPSR1",71,0)
END K ^TMP("PSOBPSRP",$J),^TMP("PSOBPSRC",$J)
"RTN","PSOBPSR1",72,0)
 K PSOAPT,PSODRUG,PSOUSER,PSOU,PSODRG,PSOPT,PSOSRT,PSOED,PSOSD,PSODIV,PSOSIT
"RTN","PSOBPSR1",73,0)
 Q
"RTN","PSOBPSR1",74,0)
 ;
"RTN","PSOBPSR1",75,0)
SET ;
"RTN","PSOBPSR1",76,0)
 S (S1,S2,S3)=0
"RTN","PSOBPSR1",77,0)
 F I=1:1:$L(PSOSRT,",") D
"RTN","PSOBPSR1",78,0)
 . S Y=$P(PSOSRT,",",I)
"RTN","PSOBPSR1",79,0)
 . S @("S"_I)=$S(Y=1:PNAM,Y=2:DNAM,Y=3:CBY)
"RTN","PSOBPSR1",80,0)
 S ^TMP("PSOBPSRP",$J,CDIV,S1,S2,S3,DFN,RXE,SEQ2)=""
"RTN","PSOBPSR1",81,0)
 Q
"RTN","PSOBPSR1",82,0)
 ;
"RTN","PSOBPSR1",83,0)
PRINT(DFN,RXIEN) ; - Print
"RTN","PSOBPSR1",84,0)
 ;Input: DFN-Patient;RXIEN=Prescription IEN
"RTN","PSOBPSR1",85,0)
 N X,XX,K,PNAM,PSSN,II,J,STR,CCOM,PMES,CBY,CREAS,CDAT,CFILL,RXNUM,DNAM,CINFO
"RTN","PSOBPSR1",86,0)
 S (CDAT,CREAS,CBY,DNAM,PNAM,PMES,PSSN,CCOM,CINFO,RXNUM)=""
"RTN","PSOBPSR1",87,0)
 ;
"RTN","PSOBPSR1",88,0)
 I OCDIV'=CDIV!(OCDIV="") D HDR I $D(DIRUT) Q
"RTN","PSOBPSR1",89,0)
 S OCDIV=CDIV
"RTN","PSOBPSR1",90,0)
 ;
"RTN","PSOBPSR1",91,0)
 D DEM^VADPT S PSSN=$P($G(VADM(2)),"^",2) K VADM
"RTN","PSOBPSR1",92,0)
 K RXINFO D GETS^DIQ(52,RXIEN_",",".01;2;6","EI","RXINFO")
"RTN","PSOBPSR1",93,0)
 S PNAM=RXINFO(52,RXIEN_",",2,"E"),DNAM=RXINFO(52,RXIEN_",",6,"E")
"RTN","PSOBPSR1",94,0)
 D GETS^DIQ(52.25,RSEQ_","_RXIEN_",","5;10;11;12;2;13","IE","CINFO")
"RTN","PSOBPSR1",95,0)
 S:$D(RXINFO(52,RXIEN_",",.01,"E")) RXNUM=RXINFO(52,RXIEN_",",.01,"E")
"RTN","PSOBPSR1",96,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",10,"I")) CDAT=CINFO(52.25,RSEQ_","_RXIEN_",",10,"I")
"RTN","PSOBPSR1",97,0)
 S CDAT=$$DT(CDAT)
"RTN","PSOBPSR1",98,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",12,"I")) CREAS=CINFO(52.25,RSEQ_","_RXIEN_",",12,"E")
"RTN","PSOBPSR1",99,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",11,"E")) CBY=CINFO(52.25,RSEQ_","_RXIEN_",",11,"E")
"RTN","PSOBPSR1",100,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",2,"E")) PMES=CINFO(52.25,RSEQ_","_RXIEN_",",2,"E")
"RTN","PSOBPSR1",101,0)
 D TEXT(.PMES,PMES,65)
"RTN","PSOBPSR1",102,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",13,"E")) CCOM=CINFO(52.25,RSEQ_","_RXIEN_",",13,"E")
"RTN","PSOBPSR1",103,0)
 D TEXT(.CCOM,CCOM,65)
"RTN","PSOBPSR1",104,0)
 S:$D(CINFO(52.25,RSEQ_","_RXIEN_",",5,"I")) CFILL=CINFO(52.25,RSEQ_","_RXIEN_",",5,"I")
"RTN","PSOBPSR1",105,0)
 ;
"RTN","PSOBPSR1",106,0)
 W !,RXNUM_"/"_CFILL,?15,$E(DNAM,1,21),?37,$E(PNAM,1,13)_"("_$P(PSSN,"-",3)_")",?57,CDAT,?66,$E(CBY,1,14)
"RTN","PSOBPSR1",107,0)
 S II="" F  S II=$O(CCOM(II)) Q:II=""  D
"RTN","PSOBPSR1",108,0)
 . W:II=1 !,"     Comments: "
"RTN","PSOBPSR1",109,0)
 . W:$D(CCOM(II)) ?15,CCOM(II),!
"RTN","PSOBPSR1",110,0)
 S II="" F  S II=$O(PMES(II)) Q:II=""  D
"RTN","PSOBPSR1",111,0)
 .  W:II=1 "Payer Message: "
"RTN","PSOBPSR1",112,0)
 .  W:$D(PMES(II)) ?15,PMES(II),!
"RTN","PSOBPSR1",113,0)
 ;
"RTN","PSOBPSR1",114,0)
 S:'$D(^TMP("PSOBPSRC",$J,DFN)) PCNT=PCNT+1 S ^TMP("PSOBPSRC",$J,DFN)=""
"RTN","PSOBPSR1",115,0)
 ;
"RTN","PSOBPSR1",116,0)
 S PRTD=1,FCNT=FCNT+1
"RTN","PSOBPSR1",117,0)
 Q
"RTN","PSOBPSR1",118,0)
 ;
"RTN","PSOBPSR1",119,0)
TEXT(TEXT,STR,L) ; Formats STR into TEXT array, lines lenght = L
"RTN","PSOBPSR1",120,0)
 N J,WORD,K S K=+$O(TEXT(""),-1) S:'K K=1
"RTN","PSOBPSR1",121,0)
 F J=1:1:$L(STR," ") D
"RTN","PSOBPSR1",122,0)
 . S WORD=$P(STR," ",J) I ($L($G(TEXT(K))_WORD))>L S K=K+1
"RTN","PSOBPSR1",123,0)
 . S TEXT(K)=$G(TEXT(K))_WORD_" "
"RTN","PSOBPSR1",124,0)
 Q
"RTN","PSOBPSR1",125,0)
 ;
"RTN","PSOBPSR1",126,0)
HDR ; - Prints the Header
"RTN","PSOBPSR1",127,0)
 N X,DIR,CDIVN S PAG=$G(PAG)+1
"RTN","PSOBPSR1",128,0)
 S CDIVN=$$GET1^DIQ(59,$G(CDIV)_",",".01")
"RTN","PSOBPSR1",129,0)
 I PAG>1,$E(IOST)="C" D  Q:$D(DIRUT)
"RTN","PSOBPSR1",130,0)
 . S DIR(0)="E",DIR("A")=" Press ENTER to Continue or ^ to Exit" D ^DIR
"RTN","PSOBPSR1",131,0)
 ;
"RTN","PSOBPSR1",132,0)
 W @IOF,"Ignored Rejects Report",?71,"Page: ",$J(PAG,3)
"RTN","PSOBPSR1",133,0)
 W !,"Sorted by",$$SRT(PSOSRT),?48,"Division: ",CDIVN
"RTN","PSOBPSR1",134,0)
 W !,"Date Range: "_$$DT(PSOSD+1\1)_" - "_$$DT(PSOED\1)
"RTN","PSOBPSR1",135,0)
 W ?48,"Run Date: "_$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","PSOBPSR1",136,0)
 S X="",$P(X,"-",81)="" W !,X
"RTN","PSOBPSR1",137,0)
 W !,"RX#/FILL",?15,"DRUG",?37,"PATIENT",?56,"IGNORE DT",?66,"IGNORED BY"
"RTN","PSOBPSR1",138,0)
 W !,"--------------",?15,"---------------------",?37,"------------------",?56,"---------",?66,"--------------"
"RTN","PSOBPSR1",139,0)
 Q
"RTN","PSOBPSR1",140,0)
 ;
"RTN","PSOBPSR1",141,0)
SRT(ST) ; - Convert the "2,1" (example) to "DRUG,PATIENT"
"RTN","PSOBPSR1",142,0)
 ;Input: ST-String with the Sorting fields by number
"RTN","PSOBPSR1",143,0)
 ;Output: ST-String with the Sorting fields by name
"RTN","PSOBPSR1",144,0)
 N I,X,STR,FLD
"RTN","PSOBPSR1",145,0)
 S STR="PATIENT^DRUG^USER"
"RTN","PSOBPSR1",146,0)
 F I=1:1:$L(ST,",") D
"RTN","PSOBPSR1",147,0)
 . S FLD=+$P(ST,",",I),X=$P(STR,"^",FLD)
"RTN","PSOBPSR1",148,0)
 . S $P(ST,",",I)=" "_X
"RTN","PSOBPSR1",149,0)
 Q ST
"RTN","PSOBPSR1",150,0)
 ;
"RTN","PSOBPSR1",151,0)
DT(DT) ; - Convert FM Date to MM/DD/YYYY
"RTN","PSOBPSR1",152,0)
 I 'DT Q ""
"RTN","PSOBPSR1",153,0)
 I '(DT#10000) Q (1700+$E(DT,1,3))
"RTN","PSOBPSR1",154,0)
 I '(DT#100) Q $E(DT,4,5)_"/"_(1700+$E(DT,1,3))
"RTN","PSOBPSR1",155,0)
 Q $E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E((1700+$E(DT,1,3)),3,4)
"RTN","PSOBPSR1",156,0)
 ;
"RTN","PSOBPSRP")
0^28^B12525106
"RTN","PSOBPSRP",1,0)
PSOBPSRP ;BHM/LE - Ignored Rejects Report ;03/01/07
"RTN","PSOBPSRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;13 Feb 97;Build 84
"RTN","PSOBPSRP",3,0)
 ;
"RTN","PSOBPSRP",4,0)
EN N PSOSD,PSOED,PSOST,PSOSRT,PSOAPT,PSODRUG,PSODIV,PSODRG,PSOST,PSOOC,PSOU,PSOUSER,PSOAPT,I,Y
"RTN","PSOBPSRP",5,0)
 N OK,X,C,%DT,PSOSIT
"RTN","PSOBPSRP",6,0)
 ;
"RTN","PSOBPSRP",7,0)
DIV ; - Ask for Division 
"RTN","PSOBPSRP",8,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSODIV,$$GET1^DIQ(59,+$G(PSOSITE),.01)) Q:$G(PSODIV)="^"
"RTN","PSOBPSRP",9,0)
 I $G(PSODIV)="ALL" S PSOSIT=1 K PSODIV
"RTN","PSOBPSRP",10,0)
 ;
"RTN","PSOBPSRP",11,0)
BEGD ; - Ask for FROM DATE DOCUMENTED
"RTN","PSOBPSRP",12,0)
 S %DT(0)=-DT,%DT="AEP",%DT("A")="BEGIN REJECT DATE: "
"RTN","PSOBPSRP",13,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSOBPSRP",14,0)
 S PSOSD=Y\1-.00001
"RTN","PSOBPSRP",15,0)
 ;
"RTN","PSOBPSRP",16,0)
ENDT ; - Ask for TO DATE DOCUMENTED
"RTN","PSOBPSRP",17,0)
 S %DT(0)=PSOSD+1\1,%DT("A")="END REJECT DATE: "
"RTN","PSOBPSRP",18,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSOBPSRP",19,0)
 S PSOED=Y\1+.99999
"RTN","PSOBPSRP",20,0)
 ;
"RTN","PSOBPSRP",21,0)
SORT ; - Ask for SORT BY
"RTN","PSOBPSRP",22,0)
 K DIR S DIR("B")="PATIENT" D HL1("A")
"RTN","PSOBPSRP",23,0)
SORT1 S PSOSRT="",(PSOAPT)=1,(PSOST,PSOOC)="B"
"RTN","PSOBPSRP",24,0)
 S DIR("A")="SORT BY",DIR(0)="FO" D HL1("?")
"RTN","PSOBPSRP",25,0)
 W ! D ^DIR K DIR I $D(DIRUT) G END
"RTN","PSOBPSRP",26,0)
 ;
"RTN","PSOBPSRP",27,0)
 S OK=1,C=15 W !
"RTN","PSOBPSRP",28,0)
 F I=1:1:$L(Y,",") D
"RTN","PSOBPSRP",29,0)
 . S X=$P(Y,",",I) S:X'?.N X=$$TRNS(X) I PSOSRT[X Q
"RTN","PSOBPSRP",30,0)
 . W !?(C-10),$S(I=1:"SORT BY ",1:"THEN BY ") S C=C+5
"RTN","PSOBPSRP",31,0)
 . I X<1!(X>3) W X,"???",$C(7) S OK=0 Q
"RTN","PSOBPSRP",32,0)
 . W $P("PATIENT^DRUG^USER","^",X)
"RTN","PSOBPSRP",33,0)
 . S PSOSRT=PSOSRT_","_X
"RTN","PSOBPSRP",34,0)
 I 'OK S DIR("B")=Y G SORT1
"RTN","PSOBPSRP",35,0)
 S $E(PSOSRT)=""
"RTN","PSOBPSRP",36,0)
 ;
"RTN","PSOBPSRP",37,0)
 S OK=1
"RTN","PSOBPSRP",38,0)
 F I=1:1:$L(PSOSRT,",") D  I 'OK Q
"RTN","PSOBPSRP",39,0)
 . S X=$P(PSOSRT,",",I) D @("SRT"_X)
"RTN","PSOBPSRP",40,0)
 I 'OK S DIR("B")="PATIENT" G SORT1
"RTN","PSOBPSRP",41,0)
 ;
"RTN","PSOBPSRP",42,0)
DEV W ! K %ZIS,IOP,POP,ZTSK S %ZIS="QM" D ^%ZIS K %ZIS I POP G END
"RTN","PSOBPSRP",43,0)
 ;If user didn't select a particular sort, assume all values for that sort
"RTN","PSOBPSRP",44,0)
 S:'$G(PSOAPT)&('$D(PSOPT)) PSOAPT=1
"RTN","PSOBPSRP",45,0)
 S:'$G(PSODRUG)&('$D(PSODRG)) PSODRUG=1
"RTN","PSOBPSRP",46,0)
 S:'$G(PSOUSER)&('$D(PSOU)) PSOUSER=1
"RTN","PSOBPSRP",47,0)
 ;
"RTN","PSOBPSRP",48,0)
 I $D(IO("Q")) D  G END
"RTN","PSOBPSRP",49,0)
 . N G K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK
"RTN","PSOBPSRP",50,0)
 . S ZTRTN="EN^PSOBPSR1",ZTDESC="Ignored Rejects Report"
"RTN","PSOBPSRP",51,0)
 . F G="PSOSD","PSOED","PSOSRT","PSOPT","PSODRG" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOBPSRP",52,0)
 . F G="PSOST","PSOOC","PSOAPT","PSODRUG","PSOUSER","PSOSIT" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOBPSRP",53,0)
 . S:$D(PSOPT) ZTSAVE("PSOPT(")="" S:$D(PSODRG) ZTSAVE("PSODRG(")=""
"RTN","PSOBPSRP",54,0)
 . S:$D(PSOU) ZTSAVE("PSOU(")="" S:$D(PSODIV) ZTSAVE("PSODIV(")=""
"RTN","PSOBPSRP",55,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print!" K ZTSK
"RTN","PSOBPSRP",56,0)
 ;
"RTN","PSOBPSRP",57,0)
 G EN^PSOBPSR1
"RTN","PSOBPSRP",58,0)
 ;
"RTN","PSOBPSRP",59,0)
END Q
"RTN","PSOBPSRP",60,0)
 ;
"RTN","PSOBPSRP",61,0)
HL1(S) ; - Help for the SORT BY prompt
"RTN","PSOBPSRP",62,0)
 S DIR(S,1)="    Enter the SORT field(s) for this Report:"
"RTN","PSOBPSRP",63,0)
 S DIR(S,2)=" "
"RTN","PSOBPSRP",64,0)
 S DIR(S,3)="       1 - PATIENT"
"RTN","PSOBPSRP",65,0)
 S DIR(S,4)="       2 - DRUG"
"RTN","PSOBPSRP",66,0)
 S DIR(S,5)="       3 - USER"
"RTN","PSOBPSRP",67,0)
 S DIR(S,6)=" "
"RTN","PSOBPSRP",68,0)
 S DIR(S,7)="    Or any combination of the above, separated by comma,"
"RTN","PSOBPSRP",69,0)
 S DIR(S,8)="    as in these examples:"
"RTN","PSOBPSRP",70,0)
 S DIR(S,9)=" "
"RTN","PSOBPSRP",71,0)
 S DIR(S,10)="       2,1  - BY PATIENT, THEN DRUG"
"RTN","PSOBPSRP",72,0)
 S DIR(S,11)="      3,1,2 - BY USER, THEN BY PATIENT, THEN BY DRUG"
"RTN","PSOBPSRP",73,0)
 S DIR(S,12)=" "
"RTN","PSOBPSRP",74,0)
 S DIR(S)=" "
"RTN","PSOBPSRP",75,0)
 Q
"RTN","PSOBPSRP",76,0)
 ;
"RTN","PSOBPSRP",77,0)
SRT1 ; - Selection of PATIENTS to print on the Report
"RTN","PSOBPSRP",78,0)
 K PSOPT S PSOAPT=0
"RTN","PSOBPSRP",79,0)
 D SEL^PSOREJU1("PATIENT","^DPT(",.PSOPT)  I $G(PSOPT)="^" S OK=0 Q
"RTN","PSOBPSRP",80,0)
 I $G(PSOPT)="ALL" S PSOAPT=1 K PSOPT
"RTN","PSOBPSRP",81,0)
 Q
"RTN","PSOBPSRP",82,0)
 ;
"RTN","PSOBPSRP",83,0)
SRT2 ; - Selection of Drugs to print on the Report
"RTN","PSOBPSRP",84,0)
 K PSODRG S PSODRUG=0
"RTN","PSOBPSRP",85,0)
 D SEL^PSOREJU1("DRUG","^PSDRUG(",.PSODRG)  I $G(PSODRG)="^" S OK=0 Q
"RTN","PSOBPSRP",86,0)
 I $G(PSODRG)="ALL" S PSODRUG=1 K PSODRG
"RTN","PSOBPSRP",87,0)
 Q
"RTN","PSOBPSRP",88,0)
 ;
"RTN","PSOBPSRP",89,0)
SRT3 ; - Selection of Users to print on the Report
"RTN","PSOBPSRP",90,0)
 K PSOU S PSOUSER=0
"RTN","PSOBPSRP",91,0)
 D SEL^PSOREJU1("USER","^VA(200,",.PSOU)  I $G(PSOU)="^" S OK=0 Q
"RTN","PSOBPSRP",92,0)
 I $G(PSOU)="ALL" S PSOUSER=1 K PSOU
"RTN","PSOBPSRP",93,0)
 Q
"RTN","PSOBPSRP",94,0)
 ;
"RTN","PSOBPSRP",95,0)
TRNS(X) ; - Translates Alpha into the corresponding Sorting Code
"RTN","PSOBPSRP",96,0)
 N L,UPX S L=$L(X),UPX=$$UP^XLFSTR(X)
"RTN","PSOBPSRP",97,0)
 I $E("PATIENT",1,L)=UPX Q 1
"RTN","PSOBPSRP",98,0)
 I $E("DRUG",1,L)=UPX Q 2
"RTN","PSOBPSRP",99,0)
 I $E("USER",1,L)=UPX Q 3
"RTN","PSOBPSRP",100,0)
 Q X
"RTN","PSOBPSRP",101,0)
 ;
"RTN","PSOBPSU1")
0^10^B46417153
"RTN","PSOBPSU1",1,0)
PSOBPSU1 ;BIRM/MFR - BPS (ECME) Utilities 1 ;10/15/04
"RTN","PSOBPSU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260**;DEC 1997;Build 84
"RTN","PSOBPSU1",3,0)
 ;Reference to $$EN^BPSNCPDP supported by IA 4415
"RTN","PSOBPSU1",4,0)
 ;References to $$NDCFMT^PSSNDCUT,$$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOBPSU1",5,0)
 ;References to $$ECMEON^BPSUTIL,$$CMOPON^BPSUTIL supported by IA 4410
"RTN","PSOBPSU1",6,0)
 ;References to STORESP^IBNCPDP supported by IA 4299
"RTN","PSOBPSU1",7,0)
 ;
"RTN","PSOBPSU1",8,0)
ECMESND(RX,RFL,DATE,FROM,NDC,CMOP,RVTX,OVRC,CNDC,RESP,IGSW,ALTX,CLA,PA) ; - Sends Rx Release information to ECME/IB and 
"RTN","PSOBPSU1",9,0)
 ;                                                       updates NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSU1",10,0)
 ;Reference to routine EN^BPSNCPDP supported by DBIA #4304
"RTN","PSOBPSU1",11,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",12,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",13,0)
 ;       (r) DATE - Date of Service
"RTN","PSOBPSU1",14,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",15,0)
 ;       (o) NDC  - NDC Number (If not passed, will be retrieved from DRUG file)
"RTN","PSOBPSU1",16,0)
 ;       (o) CMOP - CMOP Prescription (1-YES/0-NO) (Default: 0)
"RTN","PSOBPSU1",17,0)
 ;       (o) RVTX - REVERSE text (e.g., RX EDIT, RX RELEASE-NDC CHANGE, etc)
"RTN","PSOBPSU1",18,0)
 ;       (o) OVRC - Set of 3 NCPDP override codes separated by "^": 
"RTN","PSOBPSU1",19,0)
 ;                  Piece 1: NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",20,0)
 ;                  Piece 2: NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",21,0)
 ;                  Piece 3: NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",22,0)
 ;       (o) CNDC - Changed NDC? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",23,0)
 ;       (o) IGSW - Ignore Switches (Master and CMOP)? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",24,0)
 ;       (o) ALTX - Alternative Text to be placed in the Rx ECME Activity Log
"RTN","PSOBPSU1",25,0)
 ;       (o) CLA  - NCPDP Clarification Code for overriding DUR/RTS REJECTS
"RTN","PSOBPSU1",26,0)
 ;       (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOBPSU1",27,0)
 ;Output:    RESP - Response from $$EN^BPSNCPDP api
"RTN","PSOBPSU1",28,0)
 ;
"RTN","PSOBPSU1",29,0)
 ; - Retrieving the NDC code from the DRUG file if not passed in, then save it in the DRUG file
"RTN","PSOBPSU1",30,0)
 N ACT,NDCACT,DA
"RTN","PSOBPSU1",31,0)
 ;
"RTN","PSOBPSU1",32,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",33,0)
 ;
"RTN","PSOBPSU1",34,0)
 ; - ECME is not turned ON for the Rx's Division
"RTN","PSOBPSU1",35,0)
 I '$G(IGSW),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^ECME SWITCH OFF" Q
"RTN","PSOBPSU1",36,0)
 ;
"RTN","PSOBPSU1",37,0)
 ; - ECME CMOP is not turned ON for the Rx's Division
"RTN","PSOBPSU1",38,0)
 I '$G(IGSW),$G(CMOP),'$$CMOPON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^CMOP SWITCH OFF" Q
"RTN","PSOBPSU1",39,0)
 ;
"RTN","PSOBPSU1",40,0)
 ; - Saving the NDC to be displayed on the ECME Activity Log
"RTN","PSOBPSU1",41,0)
 I $G(CNDC) D
"RTN","PSOBPSU1",42,0)
 . I $G(NDC)'="" S NDCACT=NDC Q
"RTN","PSOBPSU1",43,0)
 . S NDCACT=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",44,0)
 ;
"RTN","PSOBPSU1",45,0)
 I $$NDCFMT^PSSNDCUT($G(NDC))="" D
"RTN","PSOBPSU1",46,0)
 . S NDC=$$GETNDC^PSSNDCUT($$GET1^DIQ(52,RX,6,"I"),$$RXSITE^PSOBPSUT(RX,RFL),+$G(CMOP))
"RTN","PSOBPSU1",47,0)
 . I $G(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,NDC,+$G(CMOP))
"RTN","PSOBPSU1",48,0)
 ;
"RTN","PSOBPSU1",49,0)
 ; - Creating ECME Activity Log on the PRESCRIPTION file
"RTN","PSOBPSU1",50,0)
 S ACT="Submitted" I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" S ACT="Reversal/Re-submit sent"
"RTN","PSOBPSU1",51,0)
 S ACT=ACT_" to ECME:"
"RTN","PSOBPSU1",52,0)
 ;
"RTN","PSOBPSU1",53,0)
 ; - Marked any 'unresolved' REJECTS as 'resolved' (Reason: 1 - Claim re-submitted)
"RTN","PSOBPSU1",54,0)
 N CLSCOM,COD1,COD2,COD3
"RTN","PSOBPSU1",55,0)
 S COD2=$P($G(OVRC),"^"),COD1=$P($G(OVRC),"^",2),COD3=$P($G(OVRC),"^",3)
"RTN","PSOBPSU1",56,0)
 I $G(COD3)'="" S CLSCOM="DUR Override Codes "_COD1_"/"_COD2_"/"_COD3_" submitted."
"RTN","PSOBPSU1",57,0)
 I $G(CLA)'="" S CLSCOM="Clarification Code "_CLA_" submitted."
"RTN","PSOBPSU1",58,0)
 I $G(PA)'="" S CLSCOM="Prior Authorization Code ("_$P(PA,"^")_"/"_$P(PA,"^",2)_") submitted."
"RTN","PSOBPSU1",59,0)
 D CLSALL^PSOREJUT(RX,RFL,DUZ,1,$G(CLSCOM),$G(COD1),$G(COD2),$G(COD3),$G(CLA),$G(PA))
"RTN","PSOBPSU1",60,0)
 ;
"RTN","PSOBPSU1",61,0)
 ; - Call to ECME (NEWing STAT because ECME was overwriting it - Important variable for CMOP release PSXVND)
"RTN","PSOBPSU1",62,0)
 N STAT
"RTN","PSOBPSU1",63,0)
 I $G(RVTX)="",FROM="ED" S RVTX="RX EDITED"
"RTN","PSOBPSU1",64,0)
 S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL,.DATE),FROM,NDC,$G(RVTX),$G(OVRC),,$G(CLA),$G(PA))
"RTN","PSOBPSU1",65,0)
 ;
"RTN","PSOBPSU1",66,0)
 ; - Reseting the Re-transmission flag
"RTN","PSOBPSU1",67,0)
 D RETRXF^PSOREJU2(RX,RFL,0)
"RTN","PSOBPSU1",68,0)
 ;
"RTN","PSOBPSU1",69,0)
 ; - Logging ECME Activity Log to the PRESCRIPTION file
"RTN","PSOBPSU1",70,0)
 I $G(ALTX)="" D
"RTN","PSOBPSU1",71,0)
 . N X S X=""
"RTN","PSOBPSU1",72,0)
 . S:FROM="OF" X="WINDOW FILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",73,0)
 . S:FROM="RF" X="WINDOW REFILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",74,0)
 . S:FROM="RN" X="RX RENEWED(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",75,0)
 . S:FROM="PL" X="SUSP LABEL PRINTED(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",76,0)
 . S:FROM="PE"!(FROM="PP") X="PULLED FROM SUSPENSE(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",77,0)
 . S:FROM="PC" X="CMOP TRANSMISSION(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",78,0)
 . S:FROM="RRL" X="RELEASED RX PREVIOUSLY REVERSED"
"RTN","PSOBPSU1",79,0)
 . S:FROM="ED" X="RX EDITED"
"RTN","PSOBPSU1",80,0)
 . S:$G(RVTX)'="" X=RVTX
"RTN","PSOBPSU1",81,0)
 . S:$G(OVRC)'="" X="DUR OVERRIDE CODES("_$G(COD1)_"/"_$G(COD2)_"/"_$G(COD3)_")"
"RTN","PSOBPSU1",82,0)
 . S:$G(CNDC) X=X_"(NDC:"_NDCACT_")" S ACT=ACT_X
"RTN","PSOBPSU1",83,0)
 . S ACT=ACT_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",84,0)
 I $G(ALTX)'="" S ACT=ACT_ALTX_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",85,0)
 I +RESP=2 S ACT="Not ECME Billable: "_$P(RESP,"^",2)
"RTN","PSOBPSU1",86,0)
 I +RESP=10 S ACT="ECME reversed/NOT re-submitted: "_$P(RESP,"^",2)
"RTN","PSOBPSU1",87,0)
 D RXACT^PSOBPSU2(RX,RFL,ACT,"M",DUZ)
"RTN","PSOBPSU1",88,0)
 ;
"RTN","PSOBPSU1",89,0)
 ; -Logs an ECME Activity Log if Rx Quantity is different than Billing Quantity
"RTN","PSOBPSU1",90,0)
 I 'RESP,$T(NCPDPQTY^PSSBPSUT)'="" D
"RTN","PSOBPSU1",91,0)
 . N DRUG,RXQTY,BLQTY,BLDU,Z
"RTN","PSOBPSU1",92,0)
 . S DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSOBPSU1",93,0)
 . S RXQTY=$S('RFL:$$GET1^DIQ(52,RX,7,"I"),1:$$GET1^DIQ(52.1,RFL_","_RX,1))/1
"RTN","PSOBPSU1",94,0)
 . S Z=$$NCPDPQTY^PSSBPSUT(DRUG,RXQTY),BLQTY=Z/1,BLDU=$P(Z,"^",2)
"RTN","PSOBPSU1",95,0)
 . I RXQTY'=BLQTY D
"RTN","PSOBPSU1",96,0)
 . . D RXACT^PSOBPSU2(RX,RFL,"BILLING QUANTITY submitted: "_$J(BLQTY,0,$L($P(BLQTY,".",2)))_" ("_BLDU_")","M",DUZ)
"RTN","PSOBPSU1",97,0)
 ;
"RTN","PSOBPSU1",98,0)
 Q
"RTN","PSOBPSU1",99,0)
 ;
"RTN","PSOBPSU1",100,0)
REVERSE(RX,RFL,FROM,RSN,RTXT,IGRL,NDC) ; - Reverse a claim and close all OPEN/UNRESOLVED Rejects
"RTN","PSOBPSU1",101,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",102,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",103,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",104,0)
 ;       (o) RSN  - Close Reason (2:RX ON HOLD;4: RX RETURNED TO STOCK,5:RX DELETED,etc...)
"RTN","PSOBPSU1",105,0)
 ;       (o) RTXT - Close Reason TEXT (Usually no passed if RSN is passed)
"RTN","PSOBPSU1",106,0)
 ;       (o) IGRL - Ignore RELEASE DATE, reverse anyway  
"RTN","PSOBPSU1",107,0)
 ;       (o) NDC  - NDC number related to the reversal (Note: might be an invalid NDC)
"RTN","PSOBPSU1",108,0)
 ;
"RTN","PSOBPSU1",109,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",110,0)
 ;
"RTN","PSOBPSU1",111,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOBPSU1",112,0)
 ;
"RTN","PSOBPSU1",113,0)
 N RESP,STS,ACT,STAT,DA,STATUS,NOACT S RSN=+$G(RSN),RTXT=$G(RTXT)
"RTN","PSOBPSU1",114,0)
 I RTXT="",RSN D
"RTN","PSOBPSU1",115,0)
 . S:RSN=2 RTXT="RX PLACED ON HOLD" S:RSN=3 RTXT="RX SUSPENDED" S:RSN=4 RTXT="RX RETURNED TO STOCK"
"RTN","PSOBPSU1",116,0)
 . S:RSN=5 RTXT="RX DELETED" S:RSN=7 RTXT="RX DISCONTINUED" S:RSN=8 RTXT="RX EDITED"
"RTN","PSOBPSU1",117,0)
 ;
"RTN","PSOBPSU1",118,0)
 D CLSALL^PSOREJUT(RX,RFL,DUZ,RSN,RTXT)
"RTN","PSOBPSU1",119,0)
 ;
"RTN","PSOBPSU1",120,0)
 I '$G(IGRL),$$RXRLDT^PSOBPSUT(RX,RFL) Q
"RTN","PSOBPSU1",121,0)
 ;
"RTN","PSOBPSU1",122,0)
 ; - Reseting the Re-transmission flag if Rx is being suspended
"RTN","PSOBPSU1",123,0)
 I RSN=3!($$GET1^DIQ(52,RX,100,"I")=5) D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOBPSU1",124,0)
 ;
"RTN","PSOBPSU1",125,0)
 S STATUS=$$STATUS^PSOBPSUT(RX,RFL),NOACT=0
"RTN","PSOBPSU1",126,0)
 I STATUS'="E PAYABLE",STATUS'="IN PROGRESS",STATUS'="E REVERSAL REJECTED",STATUS'="E REVERSAL STRANDED",STATUS'="E DUPLICATE" S NOACT=1
"RTN","PSOBPSU1",127,0)
 ;
"RTN","PSOBPSU1",128,0)
 S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL),FROM,$$GETNDC^PSONDCUT(RX,RFL),RTXT)
"RTN","PSOBPSU1",129,0)
 ;
"RTN","PSOBPSU1",130,0)
 ; - Logging ECME Activity Log
"RTN","PSOBPSU1",131,0)
 I '$G(NOACT) D
"RTN","PSOBPSU1",132,0)
 . S ACT="Reversal sent to ECME: "_RTXT_$S($G(NDC)'="":" ("_NDC_")",1:"")_$$STS(RX,RFL,+RESP)
"RTN","PSOBPSU1",133,0)
 . D RXACT^PSOBPSU2(RX,RFL,ACT,"M",DUZ)
"RTN","PSOBPSU1",134,0)
 ;
"RTN","PSOBPSU1",135,0)
 Q
"RTN","PSOBPSU1",136,0)
 ;
"RTN","PSOBPSU1",137,0)
DOS(RX,RFL,DATE) ; Return the Date Of Service for ECME
"RTN","PSOBPSU1",138,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",139,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",140,0)
 ;       (o) DATE - Possible Date Of Service
"RTN","PSOBPSU1",141,0)
 ;Output:    DOS  - Actual Date Of Service
"RTN","PSOBPSU1",142,0)
 ;
"RTN","PSOBPSU1",143,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",144,0)
 ;
"RTN","PSOBPSU1",145,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",146,0)
 I $G(DATE)="" S DATE=$$RXRLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",147,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",148,0)
 I 'DATE S DATE=$$RXFLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",149,0)
 ; - Future Date not allowed
"RTN","PSOBPSU1",150,0)
 I DATE>DT!'DATE S DATE=DT
"RTN","PSOBPSU1",151,0)
 ;
"RTN","PSOBPSU1",152,0)
 Q (DATE\1)
"RTN","PSOBPSU1",153,0)
 ;
"RTN","PSOBPSU1",154,0)
RELEASE(RX,RFL,USR) ; - Notifies IB that the Rx was RELEASED
"RTN","PSOBPSU1",155,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",156,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",157,0)
 ;       (o) USR  - User responsible for releasing the Rx (Default: .5 - Postmaster)
"RTN","PSOBPSU1",158,0)
 ;
"RTN","PSOBPSU1",159,0)
 N IBAR,RXAR,FLDT,RFAR
"RTN","PSOBPSU1",160,0)
 ;
"RTN","PSOBPSU1",161,0)
 S:'$D(RFL) RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",162,0)
 S:'$D(USR) USR=.5
"RTN","PSOBPSU1",163,0)
 ;
"RTN","PSOBPSU1",164,0)
 D GETS^DIQ(52,RX_",",".01;2;6;7;8;22","I","RXAR")
"RTN","PSOBPSU1",165,0)
 S DFN=+$G(RXAR(52,RX_",",2,"I"))
"RTN","PSOBPSU1",166,0)
 S IBAR("PRESCRIPTION")=RX,IBAR("RX NO")=$G(RXAR(52,RX_",",.01,"I"))
"RTN","PSOBPSU1",167,0)
 S IBAR("CLAIMID")=$E((RX#10000000)+10000000,2,8),IBAR("USER")=USR
"RTN","PSOBPSU1",168,0)
 S IBAR("DRUG")=RXAR(52,RX_",",6,"I"),IBAR("NDC")=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",169,0)
 S FLDT=$$RXFLDT^PSOBPSUT(RX,RFL) I FLDT>DT S FLDT=DT
"RTN","PSOBPSU1",170,0)
 S IBAR("FILL NUMBER")=RFL,IBAR("FILL DATE")=FLDT
"RTN","PSOBPSU1",171,0)
 S IBAR("QTY")=$G(RXAR(52,RX_",",7,"I")),IBAR("DAYS SUPPLY")=$G(RXAR(52,RX_",",8,"I"))
"RTN","PSOBPSU1",172,0)
 ;
"RTN","PSOBPSU1",173,0)
 I RFL D
"RTN","PSOBPSU1",174,0)
 . D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1","I","RFAR")
"RTN","PSOBPSU1",175,0)
 . S IBAR("QTY")=$G(RFAR(52.1,RFL_","_RX_",",1,"I"))
"RTN","PSOBPSU1",176,0)
 . S IBAR("DAYS SUPPLY")=$G(RFAR(52.1,RFL_","_RX_",",1.1,"I"))
"RTN","PSOBPSU1",177,0)
 ;
"RTN","PSOBPSU1",178,0)
 S IBAR("STATUS")="RELEASED" D STORESP^IBNCPDP(DFN,.IBAR)
"RTN","PSOBPSU1",179,0)
 ;
"RTN","PSOBPSU1",180,0)
 Q
"RTN","PSOBPSU1",181,0)
 ;
"RTN","PSOBPSU1",182,0)
LSTRFL(RX) ;  - Returns the latest fill for the Prescription
"RTN","PSOBPSU1",183,0)
 ; Input: (r) RX     - Rx IEN (#52)
"RTN","PSOBPSU1",184,0)
 ;Output:     LSTRFL - Most recent refill #
"RTN","PSOBPSU1",185,0)
 N I,LSTRFL
"RTN","PSOBPSU1",186,0)
 S (I,LSTRFL)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S LSTRFL=I
"RTN","PSOBPSU1",187,0)
 Q LSTRFL
"RTN","PSOBPSU1",188,0)
 ;
"RTN","PSOBPSU1",189,0)
ECMEACT(RX,RFL,COMM,USR) ; - Add an Activity to the ECME Activity Log (PRESCRIPTION file)
"RTN","PSOBPSU1",190,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",191,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",192,0)
 ;       (r) COMM - Comments (up to 75 characters)
"RTN","PSOBPSU1",193,0)
 ;       (o) USR  - User logging the comments (Default: DUZ)
"RTN","PSOBPSU1",194,0)
 ;
"RTN","PSOBPSU1",195,0)
 S:'$D(RFL) RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU1",196,0)
 D RXACT^PSOBPSU2(RX,RFL,COMM,"M",+$G(USR))
"RTN","PSOBPSU1",197,0)
 Q
"RTN","PSOBPSU1",198,0)
 ;
"RTN","PSOBPSU1",199,0)
STS(RX,RFL,RSP) ; Adds the Status to the ECME Activity Log according to Rx/fill claim status Response
"RTN","PSOBPSU1",200,0)
 N STS
"RTN","PSOBPSU1",201,0)
 S STS=$S($$STATUS^PSOBPSUT(RX,RFL)'="IN PROGRESS"&($$STATUS^PSOBPSUT(RX,RFL)'=""):"-"_$$STATUS^PSOBPSUT(RX,RFL),1:"")
"RTN","PSOBPSU1",202,0)
 S:+RSP=1 STS="-NO SUBMISSION THROUGH ECME" S:+RSP=3 STS="-NO REVERSAL NEEDED" S:+RSP=4 STS="-NOT PROCESSED"
"RTN","PSOBPSU1",203,0)
 S:+RSP=5 STS="-SOFTWARE ERROR"
"RTN","PSOBPSU1",204,0)
 I +RSP=2,$$STATUS^PSOBPSUT(RX,RFL)'="" S STS="-NOT BILLABLE:"_$P(RSP,"^",2)
"RTN","PSOBPSU1",205,0)
 Q STS
"RTN","PSOBPSU2")
0^1^B7051944
"RTN","PSOBPSU2",1,0)
PSOBPSU2 ;BIRM/MFR - BPS (ECME) Utilities 2 ;10/15/04
"RTN","PSOBPSU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSOBPSU2",3,0)
 ;Reference to File 200 - NEW PERSON supported by IA 10060
"RTN","PSOBPSU2",4,0)
 ; 
"RTN","PSOBPSU2",5,0)
MWC(RX,RFL) ; Returns wheter a prescription is (M)ail, (W)indow or (C)MOP
"RTN","PSOBPSU2",6,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU2",7,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU2",8,0)
 ;Output: "M": MAIL / "W": WINDOW / "C": CMOP
"RTN","PSOBPSU2",9,0)
 ;
"RTN","PSOBPSU2",10,0)
 N MWC
"RTN","PSOBPSU2",11,0)
 ;
"RTN","PSOBPSU2",12,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU2",13,0)
 ;
"RTN","PSOBPSU2",14,0)
 ; - MAIL/WINDOW fields (Original and Refill)
"RTN","PSOBPSU2",15,0)
 I RFL S MWC=$$GET1^DIQ(52.1,RFL_","_RX,2,"I")
"RTN","PSOBPSU2",16,0)
 E  S MWC=$$GET1^DIQ(52,RX,11,"I")
"RTN","PSOBPSU2",17,0)
 S:MWC="" MWC="W"
"RTN","PSOBPSU2",18,0)
 ;
"RTN","PSOBPSU2",19,0)
 ; - Checking the RX SUSPENSE file (#52.5)
"RTN","PSOBPSU2",20,0)
 I $$GET1^DIQ(52,RX,100,"I")=5 D
"RTN","PSOBPSU2",21,0)
 . N RXS S RXS=+$O(^PS(52.5,"B",RX,0)) Q:'RXS
"RTN","PSOBPSU2",22,0)
 . I $$GET1^DIQ(52.5,RXS,3,"I")'="" S MWC="C" Q
"RTN","PSOBPSU2",23,0)
 . S MWC="M"
"RTN","PSOBPSU2",24,0)
 ;
"RTN","PSOBPSU2",25,0)
 ; - Checking the CMOP EVENT sub-file (#52.01)
"RTN","PSOBPSU2",26,0)
 I MWC'="C" D
"RTN","PSOBPSU2",27,0)
 . N CMP S CMP=0
"RTN","PSOBPSU2",28,0)
 . F  S CMP=$O(^PSRX(RX,4,CMP)) Q:'CMP  D  I MWC="C" Q
"RTN","PSOBPSU2",29,0)
 . . I $$GET1^DIQ(52.01,CMP_","_RX,2,"I")=RFL S MWC="C"
"RTN","PSOBPSU2",30,0)
 ;
"RTN","PSOBPSU2",31,0)
 Q MWC
"RTN","PSOBPSU2",32,0)
 ;
"RTN","PSOBPSU2",33,0)
RXACT(RX,RFL,COMM,TYPE,USR) ; - Add an Activity to the ECME Activity Log (PRESCRIPTION file)
"RTN","PSOBPSU2",34,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU2",35,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU2",36,0)
 ;       (r) COMM - Comments (up to 75 characters)
"RTN","PSOBPSU2",37,0)
 ;       (r) TYPE - Comments type: (M-ECME,E-Edit, etc...) See file #52 DD for all values
"RTN","PSOBPSU2",38,0)
 ;       (o) USR  - User logging the comments (Default: DUZ)
"RTN","PSOBPSU2",39,0)
 ;
"RTN","PSOBPSU2",40,0)
 S:'$D(RFL) RFL=$$LSTRFL^PSOBPSU1(RX) S:'$D(USR) USR=DUZ
"RTN","PSOBPSU2",41,0)
 S:'$D(^VA(200,+USR,0)) USR=DUZ S COMM=$E($G(COMM),1,75)
"RTN","PSOBPSU2",42,0)
 ;
"RTN","PSOBPSU2",43,0)
 I COMM="" Q
"RTN","PSOBPSU2",44,0)
 I '$D(^PSRX(RX)) Q
"RTN","PSOBPSU2",45,0)
 ;
"RTN","PSOBPSU2",46,0)
 N X,DIC,DA,DD,DO,DR,DINUM,Y,DLAYGO
"RTN","PSOBPSU2",47,0)
 S DA(1)=RX,DIC="^PSRX("_RX_",""A"",",DLAYGO=52.3,DIC(0)="L"
"RTN","PSOBPSU2",48,0)
 S DIC("DR")=".02///"_TYPE_";.03////"_USR_";.04///"_$S(TYPE'="M"&(RFL>5):RFL+1,1:RFL)_";.05///"_COMM
"RTN","PSOBPSU2",49,0)
 S X=$$NOW^XLFDT() D FILE^DICN
"RTN","PSOBPSU2",50,0)
 Q
"RTN","PSOBPSU2",51,0)
 ;
"RTN","PSOBPSU2",52,0)
ECMENUM(RX) ; Returns the ECME number for a specific prescription
"RTN","PSOBPSU2",53,0)
 N ECMENUM,STS,RF
"RTN","PSOBPSU2",54,0)
 S ECMENUM=$E(10000000+RX,2,8)
"RTN","PSOBPSU2",55,0)
 S STS=$$STATUS^PSOBPSUT(RX,0)
"RTN","PSOBPSU2",56,0)
 I STS="" D
"RTN","PSOBPSU2",57,0)
 . S RF=0 F  S RF=$O(^PSRX(RX,RF)) Q:'RF  D  I STS'="" Q
"RTN","PSOBPSU2",58,0)
 . . S STS=$$STATUS^PSOBPSUT(RX,RF)
"RTN","PSOBPSU2",59,0)
 I STS="" Q ""
"RTN","PSOBPSU2",60,0)
 Q ECMENUM
"RTN","PSOBPSU2",61,0)
 ;
"RTN","PSOBPSU2",62,0)
RXNUM(ECME) ; Returns the Rx number for a specific ECME number
"RTN","PSOBPSU2",63,0)
 ;
"RTN","PSOBPSU2",64,0)
 N RXNUM,FOUND,MAX,LFT,RAD,I,DIR,RX
"RTN","PSOBPSU2",65,0)
 S MAX=$O(^PSRX(999999999999),-1),LFT=0 I $L(MAX)>7 S LFT=$E(MAX,1,$L(MAX)-7)
"RTN","PSOBPSU2",66,0)
 S FOUND=0
"RTN","PSOBPSU2",67,0)
 F RAD=LFT:-1:0 D
"RTN","PSOBPSU2",68,0)
 . S RX=RAD*10000000+ECME I $D(^PSRX(RX,0)),$$ECMENUM(RX)=ECME S FOUND=FOUND+1,FOUND(FOUND)=RX
"RTN","PSOBPSU2",69,0)
 ;
"RTN","PSOBPSU2",70,0)
 I FOUND<2 D
"RTN","PSOBPSU2",71,0)
 . I FOUND=0 S FOUND=-1 Q
"RTN","PSOBPSU2",72,0)
 . S FOUND=FOUND(1)
"RTN","PSOBPSU2",73,0)
 E  D
"RTN","PSOBPSU2",74,0)
 . W ! F I=1:1:FOUND W !?5,I,". ",$$GET1^DIQ(52,FOUND(I),.01),?25,$$GET1^DIQ(52,FOUND(I),6)
"RTN","PSOBPSU2",75,0)
 . W ! S DIR(0)="NA^1:"_FOUND,DIR("A")="Select one: ",DIR("B")=1
"RTN","PSOBPSU2",76,0)
 . D ^DIR I $D(DIRUT) S FOUND=-1 Q
"RTN","PSOBPSU2",77,0)
 . S FOUND=FOUND(Y)
"RTN","PSOBPSU2",78,0)
 ;
"RTN","PSOBPSU2",79,0)
 Q FOUND
"RTN","PSOBPSUT")
0^27^B49534340
"RTN","PSOBPSUT",1,0)
PSOBPSUT ;BIRM/MFR - BPS (ECME) Utilities ; 07 Jun 2005  8:39 PM
"RTN","PSOBPSUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260**;DEC 1997;Build 84
"RTN","PSOBPSUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOBPSUT",4,0)
 ;Reference to IBSEND^BPSECMP2 supported by IA 4411
"RTN","PSOBPSUT",5,0)
 ;Reference to $$STATUS^BPSOSRX supported by IA 4412
"RTN","PSOBPSUT",6,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSOBPSUT",7,0)
 ;Reference to $$CLAIM^BPSBUTL supported by IA 4719
"RTN","PSOBPSUT",8,0)
 ;Reference to ^PS(55 supported by IA 2228
"RTN","PSOBPSUT",9,0)
 ;Reference to ^PSDRUG( supported by IA 221
"RTN","PSOBPSUT",10,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOBPSUT",11,0)
 ;
"RTN","PSOBPSUT",12,0)
ECME(RX) ; Returns "e" if Rx/Refill is Electronically Billable (3rd party)
"RTN","PSOBPSUT",13,0)
 Q $S($$STATUS^BPSOSRX(RX,$$LSTRFL^PSOBPSU1(RX))'="":"e",1:"")
"RTN","PSOBPSUT",14,0)
 ;
"RTN","PSOBPSUT",15,0)
STATUS(RX,RFL) ; Returns the Rx's ECME Status (calls STATUS^BPSOSRX)
"RTN","PSOBPSUT",16,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",17,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",18,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",19,0)
 Q $P($$STATUS^BPSOSRX(RX,RFL),"^")
"RTN","PSOBPSUT",20,0)
 ;
"RTN","PSOBPSUT",21,0)
SUBMIT(RX,RFL,IGRL,IGCMP) ; Returns whether the Rx should be submitted to ECME at the moment or not
"RTN","PSOBPSUT",22,0)
 ; Input:  (r) RX   - Rx IEN (#52)
"RTN","PSOBPSUT",23,0)
 ;         (o) RFL  - Refill # (Def.: most recent)
"RTN","PSOBPSUT",24,0)
 ;         (o) IGRL - Ignore Release Date? (1-YES/0-NO) (Def.: 0 - NO)
"RTN","PSOBPSUT",25,0)
 ;         (o) IGCMP- Ignore CMOP/Suspense check? (1-YES/0-NO) (Def.: 0 - NO)
"RTN","PSOBPSUT",26,0)
 ;
"RTN","PSOBPSUT",27,0)
 ; - Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",28,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",29,0)
 ; - Not the latest fill for the prescription
"RTN","PSOBPSUT",30,0)
 I RFL'=$$LSTRFL^PSOBPSU1(RX) Q 0
"RTN","PSOBPSUT",31,0)
 ; - Status not ACTIVE
"RTN","PSOBPSUT",32,0)
 I $$GET1^DIQ(52,RX,100,"I")'=0 Q 0
"RTN","PSOBPSUT",33,0)
 ; Will suspend for CMOP
"RTN","PSOBPSUT",34,0)
 I '$G(IGCMP),$$CMOP(RX,RFL) Q 0
"RTN","PSOBPSUT",35,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",36,0)
 I '$$ECMEON^BPSUTIL($$RXSITE(RX,RFL)) Q 0
"RTN","PSOBPSUT",37,0)
 ; - Rx is RELEASED - Do not submit
"RTN","PSOBPSUT",38,0)
 I '$G(IGRL),$$RXRLDT(RX,RFL) Q 0
"RTN","PSOBPSUT",39,0)
 ; - Future Fill/AUTO SUSPENSE ON - will suspend
"RTN","PSOBPSUT",40,0)
 I '$G(IGCMP),$$RXFLDT(RX,RFL)>DT,$$GET1^DIQ(59,$$RXSITE(RX,RFL),.16,"I") Q 0
"RTN","PSOBPSUT",41,0)
 Q 1
"RTN","PSOBPSUT",42,0)
 ;
"RTN","PSOBPSUT",43,0)
CMOP(RX,RFL) ; Returns if the Rx will be a CMOP Rx or not
"RTN","PSOBPSUT",44,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",45,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",46,0)
 ; Output: 1 - CMOP / 0 - NON-CMOP
"RTN","PSOBPSUT",47,0)
 ;
"RTN","PSOBPSUT",48,0)
 N DFN,CMOP,MAIL,MAILEXP,DRUG,WARNS,STATUS,MW,A
"RTN","PSOBPSUT",49,0)
 ; Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",50,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",51,0)
 ; MAIL=MAIL Code, MAILEXP=Mail Code Expiration Date
"RTN","PSOBPSUT",52,0)
 S CMOP=0
"RTN","PSOBPSUT",53,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I"),MAIL=$$GET1^DIQ(55,DFN,.03,"I"),MAILEXP=$$GET1^DIQ(55,DFN,.05,"I")
"RTN","PSOBPSUT",54,0)
 I MAIL>1,MAILEXP=""!(MAILEXP>DT) G QCMOP
"RTN","PSOBPSUT",55,0)
 ; Get drug IEN and cheDRUG if CMOP  ,$S($G(MAILEXP)=""!($G(MAILEXP)>DT):1,1:0)
"RTN","PSOBPSUT",56,0)
 S DRUG=$$GET1^DIQ(52,RX,6,"I") G QCMOP:'DRUG,QCMOP:'$D(^PSDRUG("AQ",DRUG))
"RTN","PSOBPSUT",57,0)
 ; Not marked for O.P.
"RTN","PSOBPSUT",58,0)
 I $$GET1^DIQ(50,DRUG,63)'["O" G QCMOP
"RTN","PSOBPSUT",59,0)
 ; Drug Warning >11
"RTN","PSOBPSUT",60,0)
 S WARNS=$$GET1^DIQ(50,DRUG,8) I $L(WARNS)>11 G QCMOP
"RTN","PSOBPSUT",61,0)
 ; If tradename
"RTN","PSOBPSUT",62,0)
 I $$GET1^DIQ(52,RX,6.5)'="" G QCMOP
"RTN","PSOBPSUT",63,0)
 ; If Cancelled, Expired, Deleted, Hold
"RTN","PSOBPSUT",64,0)
 S STATUS=$$GET1^DIQ(52,RX,100,"I") I STATUS>9!(STATUS=4)!(STATUS=3) G QCMOP
"RTN","PSOBPSUT",65,0)
 ; Rx RELEASED
"RTN","PSOBPSUT",66,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) G QCMOP
"RTN","PSOBPSUT",67,0)
 ; MAIL/WINDOW
"RTN","PSOBPSUT",68,0)
 S MW=$S('RFL:$$GET1^DIQ(52,RX,11,"I"),1:$$GET1^DIQ(52.1,RFL_","_RX,2,"I"))
"RTN","PSOBPSUT",69,0)
 ; IF WINDOW/ORIGINAL/FUTURE FILL SETS MW = MAIL
"RTN","PSOBPSUT",70,0)
 I MW="W",$$RXFLDT^PSOBPSUT(RX,RFL)>DT S MW="M"
"RTN","PSOBPSUT",71,0)
 ; If not MAIL
"RTN","PSOBPSUT",72,0)
 I MW'="M" G QCMOP
"RTN","PSOBPSUT",73,0)
 S CMOP=1
"RTN","PSOBPSUT",74,0)
 ;
"RTN","PSOBPSUT",75,0)
QCMOP Q CMOP
"RTN","PSOBPSUT",76,0)
 ;
"RTN","PSOBPSUT",77,0)
RXRLDT(RX,RFL) ; Returns the Rx Release Date
"RTN","PSOBPSUT",78,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",79,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",80,0)
 ;        
"RTN","PSOBPSUT",81,0)
 ; Output:  RXRLDT - Rx Release Date
"RTN","PSOBPSUT",82,0)
 N RXRLDT
"RTN","PSOBPSUT",83,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",84,0)
 S RXRLDT=$$GET1^DIQ(52,RX,31,"I")
"RTN","PSOBPSUT",85,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",86,0)
 I RFL S RXRLDT=$$GET1^DIQ(52.1,RFL_","_RX,17,"I")
"RTN","PSOBPSUT",87,0)
 Q RXRLDT
"RTN","PSOBPSUT",88,0)
 ;
"RTN","PSOBPSUT",89,0)
RXFLDT(RX,RFL) ; Returns the Rx Fill Date
"RTN","PSOBPSUT",90,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",91,0)
 ;         (o) RFL - Refill # (Default: most recent)      
"RTN","PSOBPSUT",92,0)
 ; Output:  RXFLDT - Rx Fill Date
"RTN","PSOBPSUT",93,0)
 N RXFLDT
"RTN","PSOBPSUT",94,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",95,0)
 S RXFLDT=$$GET1^DIQ(52,RX,22,"I")
"RTN","PSOBPSUT",96,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",97,0)
 I RFL S RXFLDT=$$GET1^DIQ(52.1,RFL_","_RX,.01,"I")
"RTN","PSOBPSUT",98,0)
 Q RXFLDT
"RTN","PSOBPSUT",99,0)
 ;
"RTN","PSOBPSUT",100,0)
RXSUDT(RX,RFL) ; Returns the prescription/fill Suspense Date for the RX/Reject passed in
"RTN","PSOBPSUT",101,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSUT",102,0)
 ;       (o) RFL  - Refill IEN (#52.1)
"RTN","PSOBPSUT",103,0)
 ;Output: SUSPENSE DATE (External format) or <NULL>, if not suspended
"RTN","PSOBPSUT",104,0)
 ;
"RTN","PSOBPSUT",105,0)
 I $G(^PSRX(RX,"STA"))'=5 Q ""
"RTN","PSOBPSUT",106,0)
 N SURX,SURFL
"RTN","PSOBPSUT",107,0)
 S SURX=$O(^PS(52.5,"B",RX,0)) I 'SURX Q ""
"RTN","PSOBPSUT",108,0)
 I $$GET1^DIQ(52.5,SURX,.05,"I") Q ""
"RTN","PSOBPSUT",109,0)
 S SURFL=+$$GET1^DIQ(52.5,SURX,9) I RFL'=SURFL Q ""
"RTN","PSOBPSUT",110,0)
 Q $$GET1^DIQ(52.5,SURX,.02,"I")
"RTN","PSOBPSUT",111,0)
 ;
"RTN","PSOBPSUT",112,0)
RXSITE(RX,RFL) ; Returns the Rx DIVISION
"RTN","PSOBPSUT",113,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",114,0)
 ;         (o) RFL - Refill #
"RTN","PSOBPSUT",115,0)
 ; Output:  SITE - Rx Fill Date
"RTN","PSOBPSUT",116,0)
 ;        
"RTN","PSOBPSUT",117,0)
 N SITE
"RTN","PSOBPSUT",118,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",119,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",120,0)
 I RFL S SITE=$$GET1^DIQ(52.1,RFL_","_RX,8,"I")
"RTN","PSOBPSUT",121,0)
 I 'RFL!'$G(SITE) S SITE=$$GET1^DIQ(52,RX,20,"I")
"RTN","PSOBPSUT",122,0)
 Q SITE
"RTN","PSOBPSUT",123,0)
 ;
"RTN","PSOBPSUT",124,0)
MANREL(RX,RFL,PID) ; ePharmacy Manual Rx Release
"RTN","PSOBPSUT",125,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",126,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",127,0)
 ;       (o) PID - Displays PID/Drug/Rx in the NDC prompts
"RTN","PSOBPSUT",128,0)
 ;Output: "" (null - OK to Release) OR "^" (User entered "^", or no valid NDC on file for ePharmacy Rx)
"RTN","PSOBPSUT",129,0)
 ;       
"RTN","PSOBPSUT",130,0)
 N ACTION
"RTN","PSOBPSUT",131,0)
 ;
"RTN","PSOBPSUT",132,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",133,0)
 ;
"RTN","PSOBPSUT",134,0)
 ; - Checking for REJECTS before proceeding to Rx Release
"RTN","PSOBPSUT",135,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",136,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",137,0)
 ;
"RTN","PSOBPSUT",138,0)
 ; - ePharmacy switch is OFF
"RTN","PSOBPSUT",139,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q ""
"RTN","PSOBPSUT",140,0)
 ;
"RTN","PSOBPSUT",141,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",142,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",143,0)
 ;
"RTN","PSOBPSUT",144,0)
 ; - NDC editing before Rx release
"RTN","PSOBPSUT",145,0)
 S ACTION=$$CHGNDC^PSONDCUT(RX,RFL,$G(PID)) I ACTION="^" D  Q "^"
"RTN","PSOBPSUT",146,0)
 . W !!,$C(7),"A valid NDC must be entered before the Release function can be completed.",! H 1
"RTN","PSOBPSUT",147,0)
 ;
"RTN","PSOBPSUT",148,0)
 ; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects (After possible NDC edit)
"RTN","PSOBPSUT",149,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",150,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",151,0)
 ;
"RTN","PSOBPSUT",152,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",153,0)
 D RELEASE^PSOBPSU1(RX,RFL,DUZ)
"RTN","PSOBPSUT",154,0)
 ;
"RTN","PSOBPSUT",155,0)
 Q ""
"RTN","PSOBPSUT",156,0)
 ;
"RTN","PSOBPSUT",157,0)
AUTOREL(RX,RFL,RLDT,NDC,SRC,STS,HNG) ; Sends Rx Release information to ECME/IB and updates NDC
"RTN","PSOBPSUT",158,0)
 ;                                 in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",159,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",160,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",161,0)
 ;       (r) RLDT- Release Date
"RTN","PSOBPSUT",162,0)
 ;       (r) NDC - NDC Number (Must be 11 digits)
"RTN","PSOBPSUT",163,0)
 ;       (o) SRC - SOURCE: "C" - CMOP / "A" - OPAI
"RTN","PSOBPSUT",164,0)
 ;       (o) STS - Status: (S)uccessful/(U)nsuccessful Release (Default: "S" - Successful)
"RTN","PSOBPSUT",165,0)
 ;       (o) HNG - HANG time after resubmission and before checking the status of the claim (Default: 0)
"RTN","PSOBPSUT",166,0)
 ;       
"RTN","PSOBPSUT",167,0)
 N RXNDC,SITE
"RTN","PSOBPSUT",168,0)
 ;
"RTN","PSOBPSUT",169,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",170,0)
 ;
"RTN","PSOBPSUT",171,0)
 S:'$D(STS) STS="S" S:'$D(SRC) SRC="" S HNG=+$G(HNG)
"RTN","PSOBPSUT",172,0)
 S RXNDC=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSUT",173,0)
 ;
"RTN","PSOBPSUT",174,0)
 ; - Saves the NDC from CMOP/Automated Dispensing Machine in the Prescription file
"RTN","PSOBPSUT",175,0)
 I $$NDCFMT^PSSNDCUT(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),$S(SRC="C":1,1:0))
"RTN","PSOBPSUT",176,0)
 ;
"RTN","PSOBPSUT",177,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",178,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",179,0)
 ;
"RTN","PSOBPSUT",180,0)
 ; - Unsuccessful Release 
"RTN","PSOBPSUT",181,0)
 I STS="U" D  Q
"RTN","PSOBPSUT",182,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLX",,"UNSUCCESSFUL "_$S(SRC="C":"CMOP",1:"EXT INTERFACE")_" RELEASE",1)
"RTN","PSOBPSUT",183,0)
 ;
"RTN","PSOBPSUT",184,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",185,0)
 D RELEASE^PSOBPSU1(RX,RFL)
"RTN","PSOBPSUT",186,0)
 ;
"RTN","PSOBPSUT",187,0)
 ; - Invalid NDC from Automated Dispensing Machine
"RTN","PSOBPSUT",188,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",189,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID EXT INTERFACE NDC",1,NDC)
"RTN","PSOBPSUT",190,0)
 ;
"RTN","PSOBPSUT",191,0)
 ; - Invalid NDC number for CMOP
"RTN","PSOBPSUT",192,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",193,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID CMOP NDC",1,NDC)
"RTN","PSOBPSUT",194,0)
 ;
"RTN","PSOBPSUT",195,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",196,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",197,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"CRLB",$$NDCFMT^PSSNDCUT(NDC),,"AUTO RELEASE",,1,,1)
"RTN","PSOBPSUT",198,0)
 . H HNG
"RTN","PSOBPSUT",199,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",200,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),0,1)
"RTN","PSOBPSUT",201,0)
 ;
"RTN","PSOBPSUT",202,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",203,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",204,0)
 . ; - Reverse/Resubmit with correct NDC
"RTN","PSOBPSUT",205,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"CRLB",$$NDCFMT^PSSNDCUT(NDC),1,"CMOP RELEASE",,1,,1)
"RTN","PSOBPSUT",206,0)
 . ; - Wait for a response from the Payer for the submission above
"RTN","PSOBPSUT",207,0)
 . H HNG
"RTN","PSOBPSUT",208,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",209,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),1,1)
"RTN","PSOBPSUT",210,0)
 ;
"RTN","PSOBPSUT",211,0)
 ; - Calls ECME api responsible for notifying IB to create a BILL
"RTN","PSOBPSUT",212,0)
 D IBSEND(RX,RFL)
"RTN","PSOBPSUT",213,0)
 ;
"RTN","PSOBPSUT",214,0)
 Q
"RTN","PSOBPSUT",215,0)
 ;
"RTN","PSOBPSUT",216,0)
IBSEND(RX,RFL) ; Rx Release: Calls ECME, which will call  IB to create a bill
"RTN","PSOBPSUT",217,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",218,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",219,0)
 ;
"RTN","PSOBPSUT",220,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",221,0)
 ;
"RTN","PSOBPSUT",222,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",223,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q
"RTN","PSOBPSUT",224,0)
 ;
"RTN","PSOBPSUT",225,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",226,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",227,0)
 ;
"RTN","PSOBPSUT",228,0)
 ; - Calls ECME previously reversed, re-submit the claim to the payer
"RTN","PSOBPSUT",229,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E REVERSAL ACCEPTED"!($$STATUS^PSOBPSUT(RX,RFL)="IN PROGRESS") D  Q
"RTN","PSOBPSUT",230,0)
 . D ECMESND^PSOBPSU1(RX,RFL,$$RXRLDT^PSOBPSUT(RX,RFL),"RRL")
"RTN","PSOBPSUT",231,0)
 ;
"RTN","PSOBPSUT",232,0)
 ; - Notifying ECME of a BILLING event 
"RTN","PSOBPSUT",233,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D  Q
"RTN","PSOBPSUT",234,0)
 . N PSOCLAIM S PSOCLAIM=$$CLAIM^BPSBUTL(RX,RFL)
"RTN","PSOBPSUT",235,0)
 . D IBSEND^BPSECMP2($P(PSOCLAIM,"^",2),$P(PSOCLAIM,"^",3),"BILL",DUZ)
"RTN","PSOBPSUT",236,0)
 ;
"RTN","PSOBPSUT",237,0)
 Q
"RTN","PSOBPSUT",238,0)
 ;
"RTN","PSOBPSUT",239,0)
RETRX(RX,RFL) ; - Re-transmit a claim for the prescription/fill?
"RTN","PSOBPSUT",240,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",241,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",242,0)
 ;Output: 1 - Re-transmit  /  0 - Don't re-transmit
"RTN","PSOBPSUT",243,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",244,0)
 ;
"RTN","PSOBPSUT",245,0)
 I RFL Q +$$GET1^DIQ(52.1,RFL_","_RX,82,"I")
"RTN","PSOBPSUT",246,0)
 Q +$$GET1^DIQ(52,RX,82,"I")
"RTN","PSODAWUT")
0^11^B2108992
"RTN","PSODAWUT",1,0)
PSODAWUT ;BIRM/MFR - BPS (ECME) - DAW Utilities ;10/15/04
"RTN","PSODAWUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260**;DEC 1997;Build 84
"RTN","PSODAWUT",3,0)
 ;Reference to $$DAWEXT^PSSDAWUT supported by IA 4708
"RTN","PSODAWUT",4,0)
 ;
"RTN","PSODAWUT",5,0)
GETDAW(RX,RFL) ; Returns the DAW code for a specific Prescription/Fill
"RTN","PSODAWUT",6,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",7,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",8,0)
 ;
"RTN","PSODAWUT",9,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",10,0)
 ;
"RTN","PSODAWUT",11,0)
 I 'RFL Q +$$GET1^DIQ(52,RX,81)
"RTN","PSODAWUT",12,0)
 Q +$$GET1^DIQ(52.1,RFL_","_RX,81)
"RTN","PSODAWUT",13,0)
 ;
"RTN","PSODAWUT",14,0)
SAVDAW(RX,RFL,DAW) ; - Saves the DAW code for a specific Prescription/Fill
"RTN","PSODAWUT",15,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",16,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",17,0)
 ;
"RTN","PSODAWUT",18,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",19,0)
 ;
"RTN","PSODAWUT",20,0)
 I $$GETDAW(RX,RFL)'=DAW D
"RTN","PSODAWUT",21,0)
 . D RXACT^PSOBPSU2(RX,RFL,"DAW CODE changed from "_$$GETDAW(RX,RFL)_" to "_DAW_".","E")
"RTN","PSODAWUT",22,0)
 ;
"RTN","PSODAWUT",23,0)
 N DIE,DA,DR
"RTN","PSODAWUT",24,0)
 S DR="81///"_+DAW
"RTN","PSODAWUT",25,0)
 I 'RFL S DA=RX,DIE="^PSRX(" D ^DIE
"RTN","PSODAWUT",26,0)
 I RFL,$D(^PSRX(RX,1,RFL,0)) S DIE="^PSRX("_RX_",1,",DA(1)=RX,DA=RFL D ^DIE
"RTN","PSODAWUT",27,0)
 Q
"RTN","PSODAWUT",28,0)
 ;
"RTN","PSODAWUT",29,0)
EDTDAW(RX,RFL,DAW) ; - Edits the DAW code for a specific Prescription/Fill W/OUT SAVING IT
"RTN","PSODAWUT",30,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",31,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",32,0)
 ;       (o) DAW - Default DAW code (Default: from Rx file)
"RTN","PSODAWUT",33,0)
 ;Output: $$EDTDAW - DAW code selected or "^" (up arrow) 
"RTN","PSODAWUT",34,0)
 ;       
"RTN","PSODAWUT",35,0)
 N DIR,Y,DA
"RTN","PSODAWUT",36,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",37,0)
 ;
"RTN","PSODAWUT",38,0)
 I '$D(DAW) S DAW=$$GETDAW(RX,RFL)
"RTN","PSODAWUT",39,0)
 ;
"RTN","PSODAWUT",40,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSODAWUT",41,0)
 ;
"RTN","PSODAWUT",42,0)
 S DIR(0)="52,81",DIR("B")=DAW D ^DIR I $D(DIRUT) S DAW="^" Q
"RTN","PSODAWUT",43,0)
 S DAW=Y W " - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSODAWUT",44,0)
 Q
"RTN","PSON52")
0^15^B62362504
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219,148,239,201,268,260**;DEC 1997;Build 84
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
 ;External reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSON52",7,0)
 ;External reference SAVNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSON52",8,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",9,0)
START ;
"RTN","PSON52",10,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",11,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))  D PS55,DIK
"RTN","PSON52",12,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",13,0)
 D FINISH
"RTN","PSON52",14,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",15,0)
END D EOJ
"RTN","PSON52",16,0)
 Q
"RTN","PSON52",17,0)
INIT ;
"RTN","PSON52",18,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",19,0)
 S PSOX("CS")=0
"RTN","PSON52",20,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",21,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",22,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",23,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",24,0)
 I X2<30 D
"RTN","PSON52",25,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",26,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",27,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",28,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",29,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",30,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",31,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",32,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",33,0)
INITX Q
"RTN","PSON52",34,0)
 ;
"RTN","PSON52",35,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",36,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",37,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",38,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO D:+$G(DGI) TECH^PSODGDGI
"RTN","PSON52",39,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",40,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",41,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",42,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",43,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",44,0)
 K PSOX1,PSOY
"RTN","PSON52",45,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",46,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",47,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",48,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",49,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",50,0)
 I $G(SIGOK) D
"RTN","PSON52",51,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",52,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",53,0)
 .K SIG
"RTN","PSON52",54,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",55,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",56,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",57,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",58,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",59,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",60,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",61,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",62,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",63,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",64,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",65,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",66,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",67,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",68,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSON52",69,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1) D
"RTN","PSON52",70,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",71,0)
 D ICD^PSODIAG
"RTN","PSON52",72,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSON52",73,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",74,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",75,0)
 Q
"RTN","PSON52",76,0)
 ;
"RTN","PSON52",77,0)
PS55 ;
"RTN","PSON52",78,0)
 L +^PS(55,PSODFN,"P"):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSON52",79,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",80,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",81,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",82,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",83,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",84,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",85,0)
 K PSOX1
"RTN","PSON52",86,0)
 Q
"RTN","PSON52",87,0)
DIK ;
"RTN","PSON52",88,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",89,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",90,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",91,0)
 Q
"RTN","PSON52",92,0)
FINISH ;
"RTN","PSON52",93,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",94,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",95,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",96,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",97,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSON52",98,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",99,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",100,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",101,0)
 ;
"RTN","PSON52",102,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",103,0)
 ;
"RTN","PSON52",104,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSON52",105,0)
 N ACTION,PSOERX
"RTN","PSON52",106,0)
 S PSOERX=PSOX("IRXN")
"RTN","PSON52",107,0)
 I $$SUBMIT^PSOBPSUT(PSOERX,0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSON52",108,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOERX,0,PSOX("FILL DATE"),"OF")
"RTN","PSON52",109,0)
 . I $$FIND^PSOREJUT(PSOERX,0) D
"RTN","PSON52",110,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOERX,0,"79,88","OF","IOQ","I")
"RTN","PSON52",111,0)
 . I $$STATUS^PSOBPSUT(PSOERX,0)="E PAYABLE" D
"RTN","PSON52",112,0)
 . . D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,PSOERX,6,"I"),$G(PSOSITE),$$GETNDC^PSONDCUT(PSOERX,0))
"RTN","PSON52",113,0)
 ;
"RTN","PSON52",114,0)
FINISHP ;
"RTN","PSON52",115,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",116,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",117,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",118,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",119,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",120,0)
FINISHX ;call to build Rx array for bingo board
"RTN","PSON52",121,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",122,0)
 K PSOX1,PSOX2
"RTN","PSON52",123,0)
 Q
"RTN","PSON52",124,0)
EOJ ;
"RTN","PSON52",125,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",126,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",127,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",128,0)
 Q
"RTN","PSON52",129,0)
 ;
"RTN","PSON52",130,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",131,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",132,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",133,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",134,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",135,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",136,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",137,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",138,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",139,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",140,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",141,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",142,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",143,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",144,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",145,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",146,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",147,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",148,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",149,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",150,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",151,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",152,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",153,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",154,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",155,0)
 ;;PSODRUG("DAW");;EPH;;1
"RTN","PSON52",156,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",157,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",158,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",159,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",160,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",161,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",162,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",163,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",164,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",165,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",166,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",167,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",168,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONVAVW")
0^5^B19285655
"RTN","PSONVAVW",1,0)
PSONVAVW ;BHM/MFR - View Non-VA Med - Listmanager ;10/20/06
"RTN","PSONVAVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;13 Feb 97;Build 84
"RTN","PSONVAVW",3,0)
 ;Reference to File ^PS(55 supported by DBIA 2228
"RTN","PSONVAVW",4,0)
 ;Reference to $$GET1^DIQ is supported by DBIA 2056
"RTN","PSONVAVW",5,0)
 ;Reference to DEM^VADPT is supported by DBIA 10061
"RTN","PSONVAVW",6,0)
 ;Reference to EN6^GMRVUTL is supported by DBIA 1120
"RTN","PSONVAVW",7,0)
 ;
"RTN","PSONVAVW",8,0)
EN(PSODFN,PSORD) ; - Entry point
"RTN","PSONVAVW",9,0)
 N VALMCNT,VALMHDR
"RTN","PSONVAVW",10,0)
 D EN^VALM("PSO NON-VA MEDS VIEW")
"RTN","PSONVAVW",11,0)
 Q
"RTN","PSONVAVW",12,0)
 ;
"RTN","PSONVAVW",13,0)
HDR      ; - Header
"RTN","PSONVAVW",14,0)
 N LINE1,LINE2,LINE3,WT,WTDT,HT,HTDT,VADM,DFN,PNAME,DOB,SEX,X,VADM,WT,HT,GMRVST,GMRVSTR,DOB,PNAME,SEX
"RTN","PSONVAVW",15,0)
 ;
"RTN","PSONVAVW",16,0)
 K VADM S DFN=PSODFN D DEM^VADPT
"RTN","PSONVAVW",17,0)
 S PNAME=VADM(1)
"RTN","PSONVAVW",18,0)
 S DOB=$S(+VADM(3):$P(VADM(3),"^",2)_" ("_$G(VADM(4))_")",1:"UNKNOWN")
"RTN","PSONVAVW",19,0)
 S SEX=$P(VADM(5),"^",2)
"RTN","PSONVAVW",20,0)
 S (WT,X)="",GMRVSTR="WT" D EN6^GMRVUTL I X'="" S WT=$J($P(X,"^",8)/2.2,6,2),WTDT=$$DT($P(X,"^")\1)
"RTN","PSONVAVW",21,0)
 S (HT,X)="",GMRVSTR="HT" D EN6^GMRVUTL I X'="" S HT=$J($P(X,"^",8)*2.54,6,2),HTDT=$$DT($P(X,"^")\1)
"RTN","PSONVAVW",22,0)
 S LINE1=PNAME S LINE1=$$ALLERGY^PSOPMP1(LINE1,DFN,"")
"RTN","PSONVAVW",23,0)
 S LINE2="  PID: "_$P(VADM(2),"^",2),$E(LINE2,50)="HEIGHT(cm): "_$S(HT'="":HT_" ("_HTDT_")",1:"NOT AVAILABLE")
"RTN","PSONVAVW",24,0)
 S LINE3="  DOB: "_DOB,$E(LINE3,30)="SEX: "_SEX,$E(LINE3,50)="WEIGHT(kg): "_$S(WT'="":WT_" ("_WTDT_")",1:"NOT AVAILABLE")
"RTN","PSONVAVW",25,0)
 ;
"RTN","PSONVAVW",26,0)
 K VALMHDR S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2,VALMHDR(3)=LINE3
"RTN","PSONVAVW",27,0)
 ;
"RTN","PSONVAVW",28,0)
 Q
"RTN","PSONVAVW",29,0)
 ;
"RTN","PSONVAVW",30,0)
INIT ;
"RTN","PSONVAVW",31,0)
 N OINAM,DGNAM,CLNAM,LINE,NMSPC,L,DIWL,DIWR,X,I,OCK,PRV,STR,TXT,K,TXT,XX
"RTN","PSONVAVW",32,0)
 S XX=^PS(55,PSODFN,"NVA",PSORD,0),OINAM=$$GET1^DIQ(50.7,+$P(XX,"^"),.01)
"RTN","PSONVAVW",33,0)
 S DGNAM="" I $P(XX,"^",2) S DGNAM=$$GET1^DIQ(50,+$P(XX,"^",2),.01)
"RTN","PSONVAVW",34,0)
 ;
"RTN","PSONVAVW",35,0)
 S LINE=0,NMSPC="PSONVAVW" K ^TMP(NMSPC,$J)
"RTN","PSONVAVW",36,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Non-VA Med: ",23)_OINAM
"RTN","PSONVAVW",37,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Dispense Drug: ",23)_DGNAM
"RTN","PSONVAVW",38,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Dosage: ",23)_$P(XX,"^",3)
"RTN","PSONVAVW",39,0)
 ;
"RTN","PSONVAVW",40,0)
 K ^UTILITY($J,"W")
"RTN","PSONVAVW",41,0)
 S X=$$SCHED^PSONVNEW($$GET1^DIQ(55.05,PSORD_","_PSODFN,4)),DIWL=1,DIWR=60 D ^DIWP
"RTN","PSONVAVW",42,0)
 F L=1:1 Q:'$D(^UTILITY($J,"W",1,L))  D
"RTN","PSONVAVW",43,0)
 . S X="" S:L=1 X=$J("Schedule: ",23) S $E(X,24)=^UTILITY($J,"W",1,L,0)
"RTN","PSONVAVW",44,0)
 . S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=X
"RTN","PSONVAVW",45,0)
 ;
"RTN","PSONVAVW",46,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Med Route: ",23)_$P(XX,"^",4)
"RTN","PSONVAVW",47,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Status: ",23)_$S('$P(XX,"^",6):"ACTIVE",1:"DISCONTINUED on "_$$DT($P(XX,"^",7)))
"RTN","PSONVAVW",48,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("CPRS Order #: ",23)_$P(XX,"^",8)
"RTN","PSONVAVW",49,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Documented By: ",23)_$$GET1^DIQ(200,+$P(XX,"^",11),.01)
"RTN","PSONVAVW",50,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Documented Date: ",23)_$$DT($P(XX,"^",10))
"RTN","PSONVAVW",51,0)
 S CLNAM=$$GET1^DIQ(44,+$P(XX,"^",12),.01)
"RTN","PSONVAVW",52,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Clinic: ",23)_$S($P(XX,"^",12):$P(XX,"^",12)_" - "_CLNAM,1:"")
"RTN","PSONVAVW",53,0)
 S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=$J("Start Date: ",23)_$$DT($P(XX,"^",9))
"RTN","PSONVAVW",54,0)
 ;
"RTN","PSONVAVW",55,0)
 ; - "Order Checks" fields
"RTN","PSONVAVW",56,0)
 W:$D(^PS(55,PSODFN,"NVA",PSORD,"OCK")) !
"RTN","PSONVAVW",57,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",PSORD,"OCK",I)) Q:'I  D
"RTN","PSONVAVW",58,0)
 . S OCK=^PS(55,PSODFN,"NVA",PSORD,"OCK",I,0),STR=$P(OCK,"^"),PRV=+$P(OCK,"^",2)
"RTN","PSONVAVW",59,0)
 . K TXT D TEXT(.TXT,STR,61)
"RTN","PSONVAVW",60,0)
 . D STXT("       Order Check #"_I_": ",.TXT)
"RTN","PSONVAVW",61,0)
 . K TXT
"RTN","PSONVAVW",62,0)
 . F J=0:0 S J=$O(^PS(55,PSODFN,"NVA",PSORD,"OCK",I,"OVR",J)) Q:'J  D
"RTN","PSONVAVW",63,0)
 . . S STR=^PS(55,PSODFN,"NVA",PSORD,"OCK",I,"OVR",J,0)
"RTN","PSONVAVW",64,0)
 . . D TEXT(.TXT,STR,57)
"RTN","PSONVAVW",65,0)
 . D STXT("      Override Reason: ",.TXT)
"RTN","PSONVAVW",66,0)
 . S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)="    Override Provider: "_$S(PRV:$$GET1^DIQ(200,+PRV,.01),1:"")
"RTN","PSONVAVW",67,0)
 ;
"RTN","PSONVAVW",68,0)
 ; - "Statement/Explanation" field
"RTN","PSONVAVW",69,0)
 I $D(^PS(55,PSODFN,"NVA",PSORD,"DSC")) D
"RTN","PSONVAVW",70,0)
 . K TXT
"RTN","PSONVAVW",71,0)
 . F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",PSORD,"DSC",I)) Q:'I  D
"RTN","PSONVAVW",72,0)
 . . S STR=^PS(55,PSODFN,"NVA",PSORD,"DSC",I,0)
"RTN","PSONVAVW",73,0)
 . . D TEXT(.TXT,STR,57)
"RTN","PSONVAVW",74,0)
 . D STXT("Statement/Explanation: ",.TXT)
"RTN","PSONVAVW",75,0)
 ;
"RTN","PSONVAVW",76,0)
 ; - "Comments" field
"RTN","PSONVAVW",77,0)
 I $D(^PS(55,PSODFN,"NVA",PSORD,1)) D
"RTN","PSONVAVW",78,0)
 . K TXT
"RTN","PSONVAVW",79,0)
 . F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",PSORD,1,I)) Q:'I  D
"RTN","PSONVAVW",80,0)
 . . S STR=^PS(55,PSODFN,"NVA",PSORD,1,I,0)
"RTN","PSONVAVW",81,0)
 . . D TEXT(.TXT,STR,57)
"RTN","PSONVAVW",82,0)
 . D STXT("             Comments: ",.TXT)
"RTN","PSONVAVW",83,0)
 ;
"RTN","PSONVAVW",84,0)
 S VALMCNT=LINE
"RTN","PSONVAVW",85,0)
 Q
"RTN","PSONVAVW",86,0)
 ;
"RTN","PSONVAVW",87,0)
TEXT(TEXT,STR,L) ; Formats STR into TEXT array, lines lenght = L
"RTN","PSONVAVW",88,0)
 N J,WORD,K S K=+$O(TEXT(""),-1) S:'K K=1
"RTN","PSONVAVW",89,0)
 F J=1:1:$L(STR," ") D
"RTN","PSONVAVW",90,0)
 . S WORD=$P(STR," ",J) I ($L($G(TEXT(K))_WORD))>L S K=K+1
"RTN","PSONVAVW",91,0)
 . S TEXT(K)=$G(TEXT(K))_WORD_" "
"RTN","PSONVAVW",92,0)
 Q
"RTN","PSONVAVW",93,0)
 ;
"RTN","PSONVAVW",94,0)
STXT(LABEL,TXT) ; Sets text lines
"RTN","PSONVAVW",95,0)
 N K,X
"RTN","PSONVAVW",96,0)
 F K=1:1 Q:'$D(TXT(K))  D
"RTN","PSONVAVW",97,0)
 . S X="" S:K=1 X=LABEL S $E(X,24)=TXT(K)
"RTN","PSONVAVW",98,0)
 . S LINE=LINE+1,^TMP(NMSPC,$J,LINE,0)=X
"RTN","PSONVAVW",99,0)
 Q
"RTN","PSONVAVW",100,0)
 ;
"RTN","PSONVAVW",101,0)
DT(DT) ; - Convert FM Date to MM/DD/YYYY
"RTN","PSONVAVW",102,0)
 I 'DT Q ""
"RTN","PSONVAVW",103,0)
 I '(DT#10000) Q (1700+$E(DT,1,3))
"RTN","PSONVAVW",104,0)
 I '(DT#100) Q $E(DT,4,5)_"/"_(1700+$E(DT,1,3))
"RTN","PSONVAVW",105,0)
 Q $E(DT,4,5)_"/"_$E(DT,6,7)_"/"_(1700+$E(DT,1,3))
"RTN","PSONVAVW",106,0)
 ;
"RTN","PSONVAVW",107,0)
EXIT Q
"RTN","PSONVAVW",108,0)
 ;
"RTN","PSONVAVW",109,0)
HELP Q
"RTN","PSOORAL2")
0^18^B19960223
"RTN","PSOORAL2",1,0)
PSOORAL2 ;BHAM-ISC/SAB -build listman activity logs con't ;04/28/95
"RTN","PSOORAL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**258,260**;DEC 1997;Build 84
"RTN","PSOORAL2",3,0)
RF ;refill log
"RTN","PSOORAL2",4,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSOORAL2",5,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",6,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSOORAL2",7,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSOORAL2",8,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORAL2",9,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSOORAL2",10,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORAL2",11,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORAL2",12,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",13,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORAL2",14,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORAL2",15,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSOORAL2",16,0)
 .I $$STATUS^PSOBPSUT(DA,N)'="",$$RXRLDT^PSOBPSUT(DA,N) S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSOORAL2",17,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSOORAL2",18,0)
 K RTS Q
"RTN","PSOORAL2",19,0)
PAR ;partial log
"RTN","PSOORAL2",20,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSOORAL2",21,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",22,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSOORAL2",23,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSOORAL2",24,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSOORAL2",25,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSOORAL2",26,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSOORAL2",27,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSOORAL2",28,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",29,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSOORAL2",30,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(^VA(200,$P(P1,"^",7),0),"^")
"RTN","PSOORAL2",31,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSOORAL2",32,0)
 Q
"RTN","PSOORAL2",33,0)
HLD ;hold info
"RTN","PSOORAL2",34,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$P(^DD(52,99,0),"^",3),HLDR=$S($P(^PSRX(DA,"H"),"^")'>8:$P(HLDR,";",$P(^PSRX(DA,"H"),"^")),1:$P(HLDR,";",9)),HLDR=$P(HLDR,":",2)
"RTN","PSOORAL2",35,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT S:$P(^PSRX(DA,"H"),"^",2)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$P(^PSRX(DA,"H"),"^",2)
"RTN","PSOORAL2",36,0)
 K RN,DAT,DTT,HLDR
"RTN","PSOORAL2",37,0)
 Q
"RTN","PSOORAL2",38,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORAL2",39,0)
 Q
"RTN","PSOORED2")
0^12^B64502991
"RTN","PSOORED2",1,0)
PSOORED2 ;ISC-BHAM/SAB-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,51,46,78,102,114,117,133,159,148,247,260**;DEC 1997;Build 84
"RTN","PSOORED2",3,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED2",4,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOORED2",5,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED2",6,0)
 Q
"RTN","PSOORED2",7,0)
ISDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Issue Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",8,0)
 S %DT="AEX",%DT(0)=-$P(^PSRX(DA,2),"^",2),Y=$P(RX0,"^",13) X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT I "^"[$E(X) K X,Y,%DT,DTOUT,DUOUT Q
"RTN","PSOORED2",9,0)
 G:Y=-1 ISDT S PSORXED("FLD",1)=Y
"RTN","PSOORED2",10,0)
 ;S DR="1///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",11,0)
 D KV K X,Y,%DT
"RTN","PSOORED2",12,0)
 Q
"RTN","PSOORED2",13,0)
FLDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Fill Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",14,0)
 D KV S Y=$P(^PSRX(DA,2),"^",2) X ^DD("DD") S DIR("A")="FILL DATE",DIR("B")=Y
"RTN","PSOORED2",15,0)
 S DIR(0)="D^"_$P(RX0,"^",13)_":"_$P(PSORXED("RX2"),"^",6)_":EX"
"RTN","PSOORED2",16,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the Issue Date,",DIR("?",2)="the Fill Date cannot be before the Issue Date or past the Expiration Date."
"RTN","PSOORED2",17,0)
 S DIR("?")="Both the month and day are required." D ^DIR
"RTN","PSOORED2",18,0)
 I $D(DIRUT) D KV K PSORXED("FLD",22),X,Y Q
"RTN","PSOORED2",19,0)
 S PSORXED("FLD",22)=Y ;S DR="22R///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",20,0)
 K X,Y
"RTN","PSOORED2",21,0)
KV K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSOORED2",22,0)
 Q
"RTN","PSOORED2",23,0)
CHK I $D(^PSRX("AR",+$P(PSORXED("RX2"),"^",13),PSORXED("IRXN"))) S CMRL=1 Q
"RTN","PSOORED2",24,0)
 F RF=0:0 S RF=$O(^PSRX(PSORXED("IRXN"),1,RF)) Q:'RF  I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,RF,0),"^",18),PSORXED("IRXN"))) S CMRL=1
"RTN","PSOORED2",25,0)
 Q
"RTN","PSOORED2",26,0)
CHK1 I +^PSRX(PSORXED("IRXN"),"STA")=5 D  Q:'$G(CMRL)
"RTN","PSOORED2",27,0)
 .S SURX=$O(^PS(52.5,PSORXED("IRXN"),0)) Q:'SURX  I $P(^PS(52.5,SURX,0),"^",7)']""!($P(^(0),"^",7)="Q") S CMRL=1
"RTN","PSOORED2",28,0)
 .E  S CMRL=0
"RTN","PSOORED2",29,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I '$P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3),$P(^(0),"^",4)<3 S CMRL=0
"RTN","PSOORED2",30,0)
 Q
"RTN","PSOORED2",31,0)
REF ;shows refill info
"RTN","PSOORED2",32,0)
 S RFN=0 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S RFM=N,RFN=RFN+1
"RTN","PSOORED2",33,0)
 ;G:RFM=1 SRF 
"RTN","PSOORED2",34,0)
 W ! K DA,DR D KV S DIR(0)="Y",DIR("B")="No",DIR("A")="There "_$S(RFN>1:"are ",1:"is ")_RFN_" refill"_$S(RFN>1:"s.",1:".")_"  Do you want to edit"
"RTN","PSOORED2",35,0)
 D ^DIR D KV Q:'Y
"RTN","PSOORED2",36,0)
SRF W !!,"#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",! F I=1:1:80 W "="
"RTN","PSOORED2",37,0)
 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORED2",38,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S LOG=DAT,DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORED2",39,0)
 .W !,N_"  "_LOG_"   "_DAT_"      "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"MAIL  ",1:"WINDOW")_"   "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORED2",40,0)
 .W $E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORED2",41,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown") W !,"Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORED2",42,0)
 .W "Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORED2",43,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSOORED2",44,0)
 .W RTS W:$P(P1,"^",3)]"" !,"   Remarks: "_$P(P1,"^",3)
"RTN","PSOORED2",45,0)
 S DA(1)=PSORXED("IRXN") I RFN=1 S Y=RFM G RFM
"RTN","PSOORED2",46,0)
 W ! D KV S DIR("A")="Select a Refill",DIR(0)="NO^1:"_RFM_":0" D ^DIR Q:$D(DIRUT)
"RTN","PSOORED2",47,0)
RFM I '$D(^PSRX(PSORXED("IRXN"),1,Y,0)) W !,$C(7),"Invalid selection.",! G SRF
"RTN","PSOORED2",48,0)
 S CMRL=0 I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,Y,0),"^",18),PSORXED("IRXN"),Y)) S CMRL=1 G RFX
"RTN","PSOORED2",49,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I $P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3)=Y,$P(^(0),"^",4)<3 S CMRL=1
"RTN","PSOORED2",50,0)
RFX N RFL,NDC,DAW,FLDS,QUIT,CHGNDC,CHANGED
"RTN","PSOORED2",51,0)
 W ! S DA=Y,DIE="^PSRX("_DA(1)_",1,",DR=$S('CMRL:".01;1.1",1:"1.2:5;8")
"RTN","PSOORED2",52,0)
 D GETS^DIQ(52.1,DA_","_DA(1)_",",".01;1;1.1;8;11;81","I","FLDS")
"RTN","PSOORED2",53,0)
 S:$D(^PSRX(DA(1),1,DA,0)) PSORXED("RX1")=^PSRX(DA(1),1,DA,0),(RFED,RFL)=DA
"RTN","PSOORED2",54,0)
 D ^DIE S QUIT=$D(Y) K FEV,RFN,RFM,X,Y,DR
"RTN","PSOORED2",55,0)
 I '$G(DA) D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DE",5) K CMRL,RFED D:$D(PSORX("PSOL"))&($G(DI)=.01) RFD Q
"RTN","PSOORED2",56,0)
 I 'CMRL,'QUIT S DR="1;1.2:5;8" D ^DIE S QUIT=$D(Y)
"RTN","PSOORED2",57,0)
 I '$D(^PSRX(PSORXED("IRXN"),1,RFL)) Q
"RTN","PSOORED2",58,0)
 I 'QUIT,$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" D
"RTN","PSOORED2",59,0)
 . S NDC=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)
"RTN","PSOORED2",60,0)
 . D EDTDAW^PSODAWUT(PSORXED("IRXN"),RFL,.DAW) I $G(DAW)="^" Q
"RTN","PSOORED2",61,0)
 . D SAVDAW^PSODAWUT(PSORXED("IRXN"),RFL,+$G(DAW))
"RTN","PSOORED2",62,0)
 . D NDC^PSODRG(PSORXED("IRXN"),RFL,,.NDC) I $G(NDC)="^",$G(NDC)="" Q
"RTN","PSOORED2",63,0)
 . I NDC'=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL) D
"RTN","PSOORED2",64,0)
 . . S CHGNDC=1 D RXACT^PSOBPSU2(PSORXED("IRXN"),RFL,"NDC changed from "_$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)_" to "_NDC_".","E")
"RTN","PSOORED2",65,0)
 . D SAVNDC^PSONDCUT(PSORXED("IRXN"),RFL,NDC)
"RTN","PSOORED2",66,0)
 S CHANGED=$$CHANGED(PSORXED("IRXN"),RFL,.FLDS)
"RTN","PSOORED2",67,0)
 I CHANGED D
"RTN","PSOORED2",68,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(PSORXED("IRXN"),RFL)) D  Q
"RTN","PSOORED2",69,0)
 . . D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DC",99,"REFILL DIVISION CHANGED",1)
"RTN","PSOORED2",70,0)
 . I $$SUBMIT^PSOBPSUT(PSORXED("IRXN"),RFL,1,1) D
"RTN","PSOORED2",71,0)
 . . N RX S RX=PSORXED("IRXN")
"RTN","PSOORED2",72,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOORED2",73,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,"ED",$$GETNDC^PSONDCUT(RX,RFL),,$S($P(CHANGED,"^",2):"REFILL DIVISION CHANGED",1:"REFILL EDITED"),,+$G(CHGNDC))
"RTN","PSOORED2",74,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED2",75,0)
 . . I $$FIND^PSOREJUT(RX,RFL) S X=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","I")
"RTN","PSOORED2",76,0)
 K DIE,CMRL,DA,DR
"RTN","PSOORED2",77,0)
 Q
"RTN","PSOORED2",78,0)
CHANGED(RX,RFL,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED2",79,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED2",80,0)
 ;        (r) RFL   - Refill #
"RTN","PSOORED2",81,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED2",82,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Refill field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED2",83,0)
 N CHANGED,SAVED
"RTN","PSOORED2",84,0)
 S CHANGED=0 D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1;8;11;81","I","SAVED")
"RTN","PSOORED2",85,0)
 F I=.01,1,1.1,11,81 I $G(PRIOR(52.1,RFL_","_RX_",",I,"I"))'=$G(SAVED(52.1,RFL_","_RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED2",86,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52.1,RFL_","_RX_",",8,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52.1,RFL_","_RX_",",8,"I"))) S CHANGED="1^1"
"RTN","PSOORED2",87,0)
 Q CHANGED
"RTN","PSOORED2",88,0)
 ;
"RTN","PSOORED2",89,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORED2",90,0)
 Q
"RTN","PSOORED2",91,0)
DIE S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOORED2",92,0)
 K DIE,DR,X,Y
"RTN","PSOORED2",93,0)
 Q
"RTN","PSOORED2",94,0)
RFD ;check for deleted refill
"RTN","PSOORED2",95,0)
 M PSOZ1("PSOL")=PSORX("PSOL") N I,J,K,PSOX2,PSOX3,PSOX9 S (I,K)=0 D
"RTN","PSOORED2",96,0)
 .F  S I=$O(PSOZ1("PSOL",I)) Q:'I!(K)  S PSOX2=PSOZ1("PSOL",I) I PSOX2[(PSORXED("IRXN")_",") S PSOX9="" D
"RTN","PSOORED2",97,0)
 ..F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOORED2",98,0)
 ...I 'K,PSOX3=PSORXED("IRXN") S K=1
"RTN","PSOORED2",99,0)
 ...E  S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOORED2",100,0)
 ..I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I)
"RTN","PSOORED2",101,0)
 K PSOZ1("PSOL")
"RTN","PSOORED2",102,0)
 Q
"RTN","PSOORED2",103,0)
EDTDOSE ;edit med instructions fields
"RTN","PSOORED2",104,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)) D DOSE^PSOORED5 Q
"RTN","PSOORED2",105,0)
 D ^PSOORED3
"RTN","PSOORED2",106,0)
 Q
"RTN","PSOORED2",107,0)
UPD ;updates dosing array
"RTN","PSOORED2",108,0)
 S HENT=ENT
"RTN","PSOORED2",109,0)
UPD1 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",110,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",111,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED2",112,0)
 .F  Q:'$D(PSORXED("DOSE",(HENT+2)))  D
"RTN","PSOORED2",113,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",114,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",115,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",116,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",117,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",118,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",119,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",120,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",121,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",122,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",123,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+2)))]"" Q
"RTN","PSOORED2",124,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("CONJUNCTION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1))
"RTN","PSOORED2",125,0)
 ..K PSORXED("VERB",(HENT+1)),PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",126,0)
 S PSORXED("ENT")=HENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",127,0)
 Q
"RTN","PSOORED2",128,0)
UPD2 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",129,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",130,0)
 .K PSORXED("CONJUNCTION",(HENT+1)) I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED2",131,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",132,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",133,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",134,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",135,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED2",136,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",137,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",138,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",139,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",140,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",141,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",142,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" Q
"RTN","PSOORED2",143,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1)),PSORXED("VERB",(HENT+1))
"RTN","PSOORED2",144,0)
 ..K PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",145,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED2",146,0)
 S PSORXED("ENT")=SENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",147,0)
 Q
"RTN","PSOORED6")
0^13^B62756399
"RTN","PSOORED6",1,0)
PSOORED6 ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOORED6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**78,104,117,133,143,219,148,247,268,260**;DEC 1997;Build 84
"RTN","PSOORED6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORED6",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED6",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORED6",6,0)
DRG ;select drug
"RTN","PSOORED6",7,0)
 S PSORX("EDIT")=1,RX0HLD=RX0
"RTN","PSOORED6",8,0)
 S PSODRUG("IEN")=$S($G(PSODRUG("IEN"))]"":PSODRUG("IEN"),1:$P(RX0,"^",6)),PSODRUG("NAME")=$S($G(PSODRUG("NAME"))]"":PSODRUG("NAME"),1:$P(^PSDRUG($P(RX0,"^",6),0),"^"))
"RTN","PSOORED6",9,0)
 D ^PSODRG I PSODRUG("IEN")=$P(RX0,"^",6) K PSORXED("FLD",6)
"RTN","PSOORED6",10,0)
 D:PSODRUG("IEN")'=$P(RX0,"^",6)  I $G(PSORX("DFLG")) K PSORXED("FLD",6) S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",11,0)
 .D POST^PSODRG
"RTN","PSOORED6",12,0)
 .I '$O(^PSRX(PSORXED("IRXN"),1,0)) S PSORXED("FLD",17)=$G(PSODRUG("COST"))
"RTN","PSOORED6",13,0)
 .I $G(PSORX("DFLG")) K PSORXED("FLD",6),PSODRUG,PSOOIFLG,PSOSIGFL,VALMSG Q
"RTN","PSOORED6",14,0)
 .D KV S DIR(0)="Y",DIR("B")="YES"
"RTN","PSOORED6",15,0)
 .S DIR("A",1)="You have changed the dispense drug from"
"RTN","PSOORED6",16,0)
 .S DIR("A",2)=$P(^PSDRUG($P(PSORXED("RX0"),"^",6),0),"^")_" to "_$P(^PSDRUG(PSODRUG("IEN"),0),"^")_"."
"RTN","PSOORED6",17,0)
 .I $P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^",2),$O(^PSRX(PSORXED("IRXN"),"SIG1",0)) S DIR("A",3)="" D
"RTN","PSOORED6",18,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S DIR("A",3+I)=$S(I=1:"Current SIG: ",1:"")_$G(^PSRX(PSORXED("IRXN"),"SIG1",I,0))
"RTN","PSOORED6",19,0)
 .S DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",20,0)
 .D ^DIR K DIR I $D(DIRUT) S PSORX("DFLG")=1 D M1
"RTN","PSOORED6",21,0)
 .Q:$D(DIRUT)!('Y)
"RTN","PSOORED6",22,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",23,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",24,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",25,0)
 S RX0=RX0HLD K RX0HLD I $G(PSODRUG("OI"))=$G(PSOI) D  Q
"RTN","PSOORED6",26,0)
 .D:$O(^TMP("PSORXDC",$J,0))
"RTN","PSOORED6",27,0)
 ..W !!,"This edit will discontinue the duplicate Rx & change the dispensed drug!"
"RTN","PSOORED6",28,0)
 ..K DIR,X,Y S DIR("A")="Do You Want to Proceed",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORED6",29,0)
 ..D ^DIR K DIR S:'Y!($D(DIRUT)) PSORXED("DFLG")=1 D:Y DCORD^PSONEW2
"RTN","PSOORED6",30,0)
 .Q:$G(PSORXED("DFLG"))
"RTN","PSOORED6",31,0)
 .I PSODRUG("IEN")'=$P(RX0,"^",6) D
"RTN","PSOORED6",32,0)
 ..S PSORXED("FLD",6)=PSODRUG("IEN"),PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",33,0)
 .S:$G(PSODRUG("TRADE NAME"))]"" PSORXED("FLD",6.5)=PSODRUG("TRADE NAME")
"RTN","PSOORED6",34,0)
 .S:$G(PSODRUG("NDC"))]"" PSORXED("FLD",27)=PSODRUG("NDC")
"RTN","PSOORED6",35,0)
 .S:$G(PSODRUG("DAW"))]"" PSORXED("FLD",81)=PSODRUG("DAW")
"RTN","PSOORED6",36,0)
 W !!,"New Orderable Item selected. This edit will create a new prescription!",! D PAUSE^VALM1 S VALMSG="New Orderable Item selected. This edit will create a new prescription!" S (PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",37,0)
 Q
"RTN","PSOORED6",38,0)
PSOCOU ;patient counseling
"RTN","PSOORED6",39,0)
 K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=41 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",40,0)
 D KV S DIR(0)="52,41" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",41,0)
 I $D(DIRUT) K PSORXED("FLD",41) D KV Q
"RTN","PSOORED6",42,0)
 S PSORXED("FLD",DR)=Y D  K DIRUT
"RTN","PSOORED6",43,0)
 .I Y D  Q
"RTN","PSOORED6",44,0)
 ..K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=42 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",45,0)
 ..K DIR,DIRUT S DIR(0)="52,42" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",46,0)
 ..I $D(DIRUT) K PSORXED("FLD",41),DUOUT,DTOUT Q
"RTN","PSOORED6",47,0)
 ..S PSORXED("FLD",42)=Y
"RTN","PSOORED6",48,0)
 .S PSORXED("FLD",41)=0,PSORXED("FLD",42)="@"
"RTN","PSOORED6",49,0)
 Q
"RTN","PSOORED6",50,0)
PSOI ;select orderable item
"RTN","PSOORED6",51,0)
 W !!,"Current Orderable Item: "_$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORED6",52,0)
 S DIC("B")=$P(^PS(50.7,PSOI,0),"^"),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORED6",53,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORED6",54,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1" D ^DIC I "^"[X S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",55,0)
 G:Y<1 PSOI Q:PSOI=+Y
"RTN","PSOORED6",56,0)
 S PSODRUG("OI")=+Y,PSODRUG("OIN")=Y(0,0) K DIC
"RTN","PSOORED6",57,0)
 I PSOI'=PSODRUG("OI") W !!,"New Orderable Item selected. This edit will create a new prescription!",! D  K PSHOLDD Q
"RTN","PSOORED6",58,0)
 .D PAUSE^VALM1,M2
"RTN","PSOORED6",59,0)
 .S PSHOLDD=$G(PSODRUG("IEN")) K PSODRUG("IEN"),PSODRUG("NAME") S PSODRUG("DEA")="",(PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",60,0)
 .D DREN^PSOORNW2
"RTN","PSOORED6",61,0)
 .I $G(PSHOLDD),$G(PSODRUG("IEN")),$G(PSHOLDD)'=$G(PSODRUG("IEN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSOORED6",62,0)
 ..D FULL^VALM1,POST^PSODRG S VALMBCK="R"
"RTN","PSOORED6",63,0)
 ..I $G(PSORX("DFLG")) K PSODRUG S PSODRUG("IEN")=$G(PSHOLDD),PSODRUG("NAME")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^") K PSOOIFLG,PSOSIGFL S VALMSG=""
"RTN","PSOORED6",64,0)
 .I '$G(PSODRUG("IEN")) W !!,"DRUG NAME REQUIRED!" D 2^PSOORNW1
"RTN","PSOORED6",65,0)
 .I '$G(PSODRUG("IEN")) K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG S PSORXED("DFLG")=1,VALMSG="Dispense Drug NOT Selected!" Q
"RTN","PSOORED6",66,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the Orderable Item from",DIR("A",2)=$P(^PS(50.7,PSOI,0),"^")_" to "_PSODRUG("OIN")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",67,0)
 .D ^DIR K DIR I $D(DIRUT) K PSODRUG("OIN"),PSOOIFLG,PSOSIGFL S PSODRUG("OI")=PSOI,VALMSG="",PSORX("DFLG")=1 Q
"RTN","PSOORED6",68,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSOORED6",69,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",70,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",71,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",72,0)
 S PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",73,0)
 Q
"RTN","PSOORED6",74,0)
NCPDP ;Reverse previously billed Rx on an edited orderable item or drug. 
"RTN","PSOORED6",75,0)
 N RX,NPSOY
"RTN","PSOORED6",76,0)
 S RX=$G(PSORXED("IRXN")) I RX="" D
"RTN","PSOORED6",77,0)
 . S NPSOY=$O(PSONEW("OLD LAST RX#","")),NPSOY=$G(PSONEW("OLD LAST RX#",NPSOY)),RX=$O(^PSRX("B",NPSOY,RX))
"RTN","PSOORED6",78,0)
 I 'RX Q
"RTN","PSOORED6",79,0)
 D REVERSE^PSOBPSU1(RX,,"DC",7) S NCPDPFLG=0
"RTN","PSOORED6",80,0)
 Q
"RTN","PSOORED6",81,0)
UPDATE ;add new data to file
"RTN","PSOORED6",82,0)
 N RXREF,UPDATE,FLDS,CHGNDC
"RTN","PSOORED6",83,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSOORED6",84,0)
 I $O(PSORXED("FLD",0))!($G(^TMP($J,"INS1",0))]"")!($G(INSDEL))!($O(PSORXED("ODOSE",0))) D  G:'Y UPDX
"RTN","PSOORED6",85,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",86,0)
 .S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx "_$P(^PSRX(PSORXED("IRXN"),0),"^"),DIR("B")="Yes"
"RTN","PSOORED6",87,0)
 .D ^DIR K DIR I 'Y D M1 Q
"RTN","PSOORED6",88,0)
 .I $D(^PSRX(PSORXED("IRXN"),1,0))  D
"RTN","PSOORED6",89,0)
 ..S RXREF=$P(^PSRX(PSORXED("IRXN"),0),"^",9)-$P(^PSRX(PSORXED("IRXN"),1,0),"^",4)
"RTN","PSOORED6",90,0)
 .E  S RXREF=0
"RTN","PSOORED6",91,0)
 .K X,DIRUT,DUOUT,DTOUT
"RTN","PSOORED6",92,0)
 I $D(PSORXED("FLD",39.3)) D UPDATE^PSODIAG  ;update ICD's after edit
"RTN","PSOORED6",93,0)
 ; - Retrieving fields before changes that are relevant for 3rd Party Billing
"RTN","PSOORED6",94,0)
 D GETS^DIQ(52,PSORXED("IRXN")_",","4;7;8;20;22;27;81","I","FLDS")
"RTN","PSOORED6",95,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",96,0)
 F  S FLD=$O(PSORXED("FLD",FLD)) Q:'FLD  D
"RTN","PSOORED6",97,0)
 .I FLD=12!(FLD=24)!(FLD=35) D  Q
"RTN","PSOORED6",98,0)
 ..I FLD=12,PSORXED("FLD",12)="@" S $P(^PSRX(DA,3),"^",7)="" Q
"RTN","PSOORED6",99,0)
 ..I FLD=12,PSORXED("FLD",12)]"" S $P(^PSRX(DA,3),"^",7)=PSORXED("FLD",12) Q
"RTN","PSOORED6",100,0)
 ..I FLD=24,PSORXED("FLD",24)="@" S $P(^PSRX(DA,2),"^",4)="" Q
"RTN","PSOORED6",101,0)
 ..I FLD=24,PSORXED("FLD",24)]"" S $P(^PSRX(DA,2),"^",4)=PSORXED("FLD",24) Q
"RTN","PSOORED6",102,0)
 ..I FLD=35,PSORXED("FLD",35)="@" S $P(^PSRX(DA,"MP"),"^")="" Q
"RTN","PSOORED6",103,0)
 ..I FLD=35,PSORXED("FLD",35)]"" S $P(^PSRX(DA,"MP"),"^")=PSORXED("FLD",35) Q
"RTN","PSOORED6",104,0)
 .I FLD=114 D  Q
"RTN","PSOORED6",105,0)
 ..I PSORXED("FLD",114)="@" K ^PSRX(DA,"INS"),^PSRX(DA,"INS1")
"RTN","PSOORED6",106,0)
 ..I PSORXED("FLD",114)'="@" D
"RTN","PSOORED6",107,0)
 ...S ^PSRX(DA,"INS")=PSORXED("FLD",114)
"RTN","PSOORED6",108,0)
 ...S X=PSORXED("FLD",114) D SIG^PSOHELP Q:$G(INS1)']""
"RTN","PSOORED6",109,0)
 ...S PSORXED("SIG",1)=$E(INS1,2,9999999) K ^PSRX(DA,"INS1")
"RTN","PSOORED6",110,0)
 ...S ^PSRX(DA,"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSOORED6",111,0)
 ...S ^PSRX(DA,"INS1",1,0)=PSORXED("SIG",1)
"RTN","PSOORED6",112,0)
 ..D DOLST^PSOORED3 K:PSORXED("FLD",114)="@" PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",113,0)
 .I FLD=27 D  Q
"RTN","PSOORED6",114,0)
 ..I PSORXED("FLD",27)'=$$GETNDC^PSONDCUT(DA,0) D
"RTN","PSOORED6",115,0)
 ...S CHGNDC=1 D RXACT^PSOBPSU2(DA,0,"NDC changed from "_$$GETNDC^PSONDCUT(DA,0)_" to "_PSORXED("FLD",27)_".","E")
"RTN","PSOORED6",116,0)
 ..D SAVNDC^PSONDCUT(DA,0,PSORXED("FLD",27),0,1)
"RTN","PSOORED6",117,0)
 .I FLD=81 D SAVDAW^PSODAWUT(DA,0,PSORXED("FLD",81)) Q
"RTN","PSOORED6",118,0)
 .S DR=FLD_"////"_PSORXED("FLD",FLD) D ^DIE
"RTN","PSOORED6",119,0)
 .I FLD=4 D UDPROV^PSOOREDT Q
"RTN","PSOORED6",120,0)
 ;
"RTN","PSOORED6",121,0)
 ; - Re-submitting Rx to ECME due to edits
"RTN","PSOORED6",122,0)
 D RESUB^PSOORED7
"RTN","PSOORED6",123,0)
 ;
"RTN","PSOORED6",124,0)
 I $G(INSDEL) K ^PSRX(DA,"INS"),^PSRX(DA,"INS1") D DOLST^PSOORED3 K PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3 G UPDX
"RTN","PSOORED6",125,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED6",126,0)
 .K ^PSRX(DA,"INS"),^PSRX(DA,"INS1"),DD,PSORXED("SIG")
"RTN","PSOORED6",127,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S (PSORXED("SIG",I),^PSRX(DA,"INS1",I,0))=^TMP($J,"INS1",I,0),DD=$G(DD)+1
"RTN","PSOORED6",128,0)
 .S ^PSRX(DA,"INS1",0)=^TMP($J,"INS1",0)
"RTN","PSOORED6",129,0)
 .I DD=1 S ^PSRX(DA,"INS")=^PSRX(DA,"INS1",1,0)
"RTN","PSOORED6",130,0)
 .D DOLST^PSOORED3,EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",131,0)
 ;
"RTN","PSOORED6",132,0)
UPDX ;
"RTN","PSOORED6",133,0)
 K DIE,DA,DR,FLD,X,Y,PSORXED("FLD"),DD,^TMP($J,"INS1")
"RTN","PSOORED6",134,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",135,0)
 Q
"RTN","PSOORED6",136,0)
UPD ;updates dosing array
"RTN","PSOORED6",137,0)
 S HENT=ENT
"RTN","PSOORED6",138,0)
UPD1 ;
"RTN","PSOORED6",139,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD
"RTN","PSOORED6",140,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED6",141,0)
 .I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED6",142,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED6",143,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED6",144,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED6",145,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED6",146,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED6",147,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED6",148,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED6",149,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED6",150,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED6",151,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED6",152,0)
 ..K PSORXED("DOSE",(HENT+2)),PSORXED("ODOSE",(HENT+2)),PSORXED("DOSE ORDERED",(HENT+2))
"RTN","PSOORED6",153,0)
 ..K PSORXED("UNITS",(HENT+2)),PSORXED("NOUN",(HENT+2)),PSORXED("DURATION",(HENT+2)),PSORXED("ROUTE",(HENT+2)),PSORXED("SCHEDULE",(HENT+2)),PSORXED("VERB",(HENT+2))
"RTN","PSOORED6",154,0)
 .S HENT=HENT+1
"RTN","PSOORED6",155,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED6",156,0)
 Q
"RTN","PSOORED6",157,0)
 ;
"RTN","PSOORED6",158,0)
M1 D M1^PSOOREDX
"RTN","PSOORED6",159,0)
 Q
"RTN","PSOORED6",160,0)
M2 D M2^PSOOREDX
"RTN","PSOORED6",161,0)
 Q
"RTN","PSOOREDT")
0^26^B64908254
"RTN","PSOOREDT",1,0)
PSOOREDT ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOOREDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,27,37,57,46,78,102,104,119,143,148,260**;DEC 1997;Build 84
"RTN","PSOOREDT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOOREDT",4,0)
 ;External reference to PSSLOCK supported by DBIA 2789
"RTN","PSOOREDT",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOOREDT",6,0)
SEL K PSOISLKD,PSOLOKED S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="" Q
"RTN","PSOOREDT",7,0)
 K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="" Q
"RTN","PSOOREDT",8,0)
 K PSOMSG S PSOLOKED=1
"RTN","PSOOREDT",9,0)
 K PSORX("DFLG"),DIR,DUOUT,DIRUT S DIR("A")="Select fields by number"
"RTN","PSOOREDT",10,0)
 S DIR(0)="LO^1:"_$S($$STATUS^PSOBPSUT($P(PSOLST(ORN),"^",2))'="":21,$G(REF):20,1:19)
"RTN","PSOOREDT",11,0)
 D ^DIR I $D(DIRUT) K DIR,DIRUT,DTOUT S VALMBCK="" D UL K PSOLOKED Q
"RTN","PSOOREDT",12,0)
EDTSEL N VALMCNT K PSOISLKD,PSORX("DFLG"),PSOOIFLG,PSOMRFLG,DIR,DIRUT,DTOUT,DTOUT,ZONE S (PSOEDIT,PSORXED)=1 I +Y S FST=Y D HLDHDR^PSOLMUTL D  G EX ;PSO LM SELECT MENU protocol
"RTN","PSOOREDT",13,0)
 .I '$G(PSOLOKED) S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",14,0)
 .I '$G(PSOLOKED) K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",15,0)
 .K PSOMSG,PSOPLCK S (NEWEDT,PSOLOKED)=1 D EDT
"RTN","PSOOREDT",16,0)
 E  S VALMBCK="",PSODE=1
"RTN","PSOOREDT",17,0)
EX I $G(PSOISLKD) D UL K PSOISLKD G EX2
"RTN","PSOOREDT",18,0)
 I '$G(PSOSIGFL),'$G(PSORXED("DFLG")) D UPDATE^PSOORED6 D LOG^PSORXED,POST^PSORXED G EX1
"RTN","PSOOREDT",19,0)
 I $G(PSOSIGFL)=1 D  Q:$G(PSORX("FN"))
"RTN","PSOOREDT",20,0)
 .N PSOTMP
"RTN","PSOOREDT",21,0)
 .S PSOTMP=$G(PSOFROM),PSOFROM="NEW"
"RTN","PSOOREDT",22,0)
 .S VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOOREDT",23,0)
 .D EN^PSOORED1(.PSORXED)
"RTN","PSOOREDT",24,0)
 .I $G(PSORX("FN")) D  Q
"RTN","PSOOREDT",25,0)
 ..D ^PSOBUILD
"RTN","PSOOREDT",26,0)
 ..K QUIT,PSORX("DFLG"),FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT
"RTN","PSOOREDT",27,0)
 ..K PSORENW,PSOSIGFL,PSOOIFLG,PSOMRFLG,PSODIR,CHK,PSORX("SIG"),PSODE
"RTN","PSOOREDT",28,0)
 ..K PSOTRN,PSORX("EDIT"),PSORXED("FLD"),NEWEDT
"RTN","PSOOREDT",29,0)
 ..D EOJ^PSONEW
"RTN","PSOOREDT",30,0)
 ..D UL K PSOLOKED S VALMBCK="Q"
"RTN","PSOOREDT",31,0)
 .S PSOFROM=PSOTMP I PSOFROM="" K PSOFROM
"RTN","PSOOREDT",32,0)
 ;
"RTN","PSOOREDT",33,0)
EX1 I '$G(PSODE)!('$G(ZONE)) I $G(PSORENW("OIRXN")) D EN^PSOHLSN1(PSORENW("OIRXN"),"XX","","Order edited")
"RTN","PSOOREDT",34,0)
QUIT D UL K PSOLOKED D ^PSOBUILD,ACT^PSOORNE2 D:+^PSRX($P(PSOLST(ORN),"^",2),"STA")=5 EN^PSOCMOPC($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",35,0)
 K:'$O(^PSRX($P(PSOLST(ORN),"^",2),1,0)) REF
"RTN","PSOOREDT",36,0)
EX2 S VALMBCK=$S($G(PSORX("FN")):"Q",$G(ZONE):"Q",1:"R") K PSORXED,FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT,PSORENW,PSOSIGFL,PSODIR,CHK,PSORX("SIG"),PSODE,PSOTRN,PSORX("DFLG"),RFED,ZONE,PSORX("EDIT"),PSOOIFLG,PSOMRFLG,SIG,QUIT
"RTN","PSOOREDT",37,0)
 K NEWEDT I $G(VALMBCK)="R" W ! D CLEAN^PSOVER1 H 2
"RTN","PSOOREDT",38,0)
 Q
"RTN","PSOOREDT",39,0)
 ;
"RTN","PSOOREDT",40,0)
EDT ; Rx Edit (Backdoor)
"RTN","PSOOREDT",41,0)
 K NCPDPFLG
"RTN","PSOOREDT",42,0)
 S I=0 F  S I=$O(^PSRX($P(PSOLST(ORN),"^",2),1,I)) Q:'I  S PSORXED("RX1")=^PSRX($P(PSOLST(ORN),"^",2),1,I,0)
"RTN","PSOOREDT",43,0)
 S (RX0,PSORXED("RX0"))=^PSRX($P(PSOLST(ORN),"^",2),0),PSORXED("RX2")=$G(^(2)),PSORXED("RX3")=$G(^(3)),PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",44,0)
 F FLD=1:1:$L(FST,",") Q:$P(FST,",",FLD)']""!($G(PSORXED("DFLG")))!($G(PSORX("DFLG")))  S FLN=+$P(FST,",",FLD) D
"RTN","PSOOREDT",45,0)
 .S PSORXED("DFLG")=0,(DA,PSORXED("IRXN"),PSORENW("OIRXN"))=$P(PSOLST(ORN),"^",2),RX0=^PSRX(PSORXED("IRXN"),0) S:$G(PSOSIG)="" PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",46,0)
 .I '$G(PSOSIGFL) D
"RTN","PSOOREDT",47,0)
 ..S PSOI=+^PSRX(DA,"OR1"),PSODAYS=$P(RX0,"^",8),PSORXST=+$P($G(^PS(53,$P(RX0,"^",3),0)),"^",7)
"RTN","PSOOREDT",48,0)
 ..I 'PSOI S PSOI=+^PSDRUG($P(RX0,"^",6),2),$P(^PSRX(DA,"OR1"),"^")=PSOI
"RTN","PSOOREDT",49,0)
 ..S:'$G(PSODRUG("IEN")) PSODRUG("IEN")=$P(RX0,"^",6),PSODRUG("NAME")=$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSOOREDT",50,0)
 ..S PSODRUG("OI")=PSOI
"RTN","PSOOREDT",51,0)
 .S PSORX("PROVIDER")=$P(RX0,"^",4),PSORX("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^"),PSOTRN=$G(^PSRX(DA,"TN"))
"RTN","PSOOREDT",52,0)
 .D:'$G(CHK) POP^PSOSIGNO(DA),CHK Q:$G(PSORXED("DFLG"))
"RTN","PSOOREDT",53,0)
 .S FDR="39.2^"_$S($P(PSOPAR,"^",3):"6",1:"")_";6.5^113^114^3^1^22R^24^8^7^9^4^11;"_$S($P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)):"35;",1:"")_"^10.6^5^20^23^12^PSOCOU^RF^81"
"RTN","PSOOREDT",54,0)
 .I FLN=20,'$G(REF) S VALMSG="There is no Refill Data to be edited." Q
"RTN","PSOOREDT",55,0)
 .S DR=$P(FDR,"^",FLN) I DR="RF" D REF^PSOORED2 Q
"RTN","PSOOREDT",56,0)
 .I DR="PSOCOU" D PSOCOU^PSOORED6 Q
"RTN","PSOOREDT",57,0)
 .I FLN=2,'$P(PSOPAR,"^",3),$$RXRLDT^PSOBPSUT(RXN,0),$$STATUS^PSOBPSUT(RXN,0)'="" D  Q
"RTN","PSOOREDT",58,0)
 ..N NDC D NDC^PSODRG(RXN,0,,.NDC) I $G(NDC)="^"!($G(NDC)="") Q
"RTN","PSOOREDT",59,0)
 ..S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSOOREDT",60,0)
 .I FLN'>2,'$P(PSOPAR,"^",3) S VALMSG="Check site parameters, Drug data is not editable." Q
"RTN","PSOOREDT",61,0)
 .I FLN=3 D EDTDOSE^PSOORED2 Q
"RTN","PSOOREDT",62,0)
 .I FLN=4 D INS^PSOORED1 Q
"RTN","PSOOREDT",63,0)
 .I FLN=1 D PSOI^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=$S($D(DA):DA,$D(PSORXED("IRXN")):PSORXED("IRXN"),$D(PSORENW("OIRXN")):PSORENW("OIRXN")) D:'$G(PSORXED("DFLG")) EN^PSODIAG Q
"RTN","PSOOREDT",64,0)
 .I FLN=2 D DRG^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=PSORXED("IRXN") D:'$G(PSORXED("DFLG")) EN^PSODIAG S:$O(^PSRX(PSORXED("IRXN"),1,0)) REF=1 Q
"RTN","PSOOREDT",65,0)
 .I FLN=12 D PROV Q
"RTN","PSOOREDT",66,0)
 .I FLN=6 D ISDT^PSOORED2 Q
"RTN","PSOOREDT",67,0)
 .I FLN=7 D FLDT^PSOORED2 Q
"RTN","PSOOREDT",68,0)
 .I FLN=21,$$STATUS^PSOBPSUT(RXN,0)="" S VALMSG="Invalid selection!" Q
"RTN","PSOOREDT",69,0)
 .I FLN=21 D  Q
"RTN","PSOOREDT",70,0)
 ..N DAW D EDTDAW^PSODAWUT(RXN,0,.DAW) I $G(DAW)="^" Q
"RTN","PSOOREDT",71,0)
 ..S (PSODRUG("DAW"),PSORXED("FLD",81))=DAW
"RTN","PSOOREDT",72,0)
 .I FLN=9!(FLN=10)!(FLN=11) D NOCHG^PSOORED7 Q
"RTN","PSOOREDT",73,0)
 .S DR=+DR
"RTN","PSOOREDT",74,0)
 .K DIR,DIRUT,DIROUT ;S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOOREDT",75,0)
 .K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOOREDT",76,0)
 .S DIR("B")=$S($G(PSORXED("FLD",DR))]"":PSORXED("FLD",DR),1:PSORXED(52,DA,DR)),DIR(0)="52,"_DR D ^DIR
"RTN","PSOOREDT",77,0)
 .I DR=24!(DR=12) S PSORXED("FLD",DR)=X
"RTN","PSOOREDT",78,0)
 .I $D(DIRUT) K DIR,DIRUT,DUOUT,DTOUT,PSORXED(52,DA,DR),PSORXED("FLD",DR) Q
"RTN","PSOOREDT",79,0)
 .I DR'=5,X="@" W !,"Data Required!",! K DIC,DIQ,DR,DA,DIR,DIRUT,PSORXED(52,DA,DR),X,Y Q
"RTN","PSOOREDT",80,0)
 .I DR=5,X'="@" S Y=+Y
"RTN","PSOOREDT",81,0)
 .I DR=3!(DR=20)!(DR=23) S Y=+Y
"RTN","PSOOREDT",82,0)
 .S PSORXED("FLD",DR)=$S(X="@":X,1:Y) K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",83,0)
 .I DR=11,PSORXED("FLD",DR)="W",$P(PSOPAR,"^",12) D
"RTN","PSOOREDT",84,0)
 ..D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",85,0)
 ..S DR=35,DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ,DIRUT,DUOUT,DTOUT
"RTN","PSOOREDT",86,0)
 ..S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR)
"RTN","PSOOREDT",87,0)
 ..S DIR(0)="52,"_(DR) D ^DIR I $D(DIRUT),X'="@" K DIR,DIRUT Q
"RTN","PSOOREDT",88,0)
 ..S PSORXED("FLD",DR)=X K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",89,0)
 .I $G(PSORXED("FLD",DR))]"" D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",90,0)
 Q:$G(PSOSIGFL)
"RTN","PSOOREDT",91,0)
 S (RX1,I,RFD,RFDT)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFD=I,RFDT=$P(^PSRX(PSORXED("IRXN"),1,I,0),"^"),RX1(I)=$G(RX1(I))+1
"RTN","PSOOREDT",92,0)
 Q
"RTN","PSOOREDT",93,0)
CHK S CHK=1 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT S VALMSG="This drug has been inactivated. ",PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",94,0)
 K PSPOP I $G(PSODIV),$P(PSORXED("RX2"),"^",9)'=PSOSITE S PSPRXN=PSORXED("IRXN") D  Q:PSORXED("DFLG")
"RTN","PSOOREDT",95,0)
 .I '$P(PSOSYS,"^",2) S VALMSG="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is not a valid choice. (Different Division)" S PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",96,0)
 .I $P(PSOSYS,"^",3) K DIR,DUOUT,DTOUT D  K DIR,DUOUT,DTOUT Q
"RTN","PSOOREDT",97,0)
 ..W $C(7) S DIR("A",1)="",DIR("A",2)="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is from another division.",DIR("A")="Continue: (Y/N)",DIR(0)="Y",DIR("?",1)="'Y' FOR YES",DIR("?")="'N' FOR NO"
"RTN","PSOOREDT",98,0)
 ..S DIR("B")="N" D ^DIR I 'Y!($D(DIRUT)) S PSORXED("DFLG")=1 W !
"RTN","PSOOREDT",99,0)
 ;
"RTN","PSOOREDT",100,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=14!($P(^("STA"),"^")=15) S PSORXED("DFLG")=1 S VALMSG="Discontinued prescriptions cannot be edited." Q
"RTN","PSOOREDT",101,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=16 S PSORXED("DFLG")=1 S VALMSG="Prescriptions on Provider Hold cannot be edited." Q
"RTN","PSOOREDT",102,0)
CHKX K PSPOP,DIR,DTOUT,DUOUT,Y,X Q
"RTN","PSOOREDT",103,0)
 Q
"RTN","PSOOREDT",104,0)
PROV ;select provider
"RTN","PSOOREDT",105,0)
 S PSORXED("PROVIDER")=$P(RX0,"^",4),PSORXED("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^")
"RTN","PSOOREDT",106,0)
 D PROV^PSODIR(.PSORXED) I PSORXED("PROVIDER")'=$P(RX0,"^",4) D
"RTN","PSOOREDT",107,0)
 .K DIR,DIRUT W ! S DIR(0)="Y",DIR("A",1)="You have changed the name of the provider entered for this Rx."
"RTN","PSOOREDT",108,0)
 .S DIR("A",2)="This edit will cause the provider's name to be update for all fills.",DIR("A")="Do you want to continue" D ^DIR
"RTN","PSOOREDT",109,0)
 .I 'Y!$D(DIRUT) K PSORX("PROVIDER"),PSORX("PROVIDER NAME"),PSORX("COSIGNING PROVIDER") Q
"RTN","PSOOREDT",110,0)
 .S PSORXED("FLD",4)=PSORXED("PROVIDER") K DIR,DIRUT,DUOUT
"RTN","PSOOREDT",111,0)
 .S PSORXED("FLD",109)=$G(PSORXED("COSIGNING PROVIDER"))
"RTN","PSOOREDT",112,0)
 Q
"RTN","PSOOREDT",113,0)
UDPROV ;update provider
"RTN","PSOOREDT",114,0)
 S $P(^PSRX(PSORXED("IRXN"),0),"^",4)=PSORXED("PROVIDER"),$P(^(3),"^",3)=$G(PSORX("COSIGNING PROVIDER"))
"RTN","PSOOREDT",115,0)
 F XTY="1","P" F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),XTY,I)) Q:'I  S $P(^PSRX(PSORXED("IRXN"),XTY,I,0),"^",17)=PSORXED("PROVIDER") S:XTY RFED=I
"RTN","PSOOREDT",116,0)
 K XTY,I
"RTN","PSOOREDT",117,0)
 Q
"RTN","PSOOREDT",118,0)
SIG ;edit medication instructions (SIG)
"RTN","PSOOREDT",119,0)
 S PSOFDR=+$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) I PSOFDR D
"RTN","PSOOREDT",120,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORXED("IRXN"),"SIG1",I,0)
"RTN","PSOOREDT",121,0)
 E  S PSORX("SIG")=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^")
"RTN","PSOOREDT",122,0)
 D SIG^PSODIR1(.PSORX) D:$G(PSORX("SIG"))]"" EN1^PSOSIGNO(PSORXED("IRXN"),PSORX("SIG"))
"RTN","PSOOREDT",123,0)
 I '$G(PSOSIGFL),$G(PSORX("SIG"))]"" S ^PSRX(PSORXED("IRXN"),"SIG")=PSORX("SIG") K ^PSRX(PSORXED("IRXN"),"SIG1") Q
"RTN","PSOOREDT",124,0)
 S PSOMRFLG=1
"RTN","PSOOREDT",125,0)
 Q
"RTN","PSOOREDT",126,0)
UL ;
"RTN","PSOOREDT",127,0)
 I '$G(PSOLOKED) Q
"RTN","PSOOREDT",128,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOOREDT",129,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",130,0)
 Q
"RTN","PSOOREDT",131,0)
SVAL ;Set message for patient lock
"RTN","PSOOREDT",132,0)
 S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.")
"RTN","PSOOREDT",133,0)
 Q
"RTN","PSOOREDT",134,0)
SVALO ;Set message for order lock
"RTN","PSOOREDT",135,0)
 S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.")
"RTN","PSOOREDT",136,0)
 Q
"RTN","PSOOREDT",137,0)
 ;
"RTN","PSOORFI1")
0^25^B72652086
"RTN","PSOORFI1",1,0)
PSOORFI1 ;BIR/SAB - finish OP orders from OE/RR continued ;5/23/05 2:11pm
"RTN","PSOORFI1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,15,23,27,32,44,51,46,71,90,108,131,152,186,210,222,258,260**;DEC 1997;Build 84
"RTN","PSOORFI1",3,0)
 ;Ref. ^PS(50.7 supp. DBIA 2223
"RTN","PSOORFI1",4,0)
 ;Ref. ^PSDRUG( supp. DBIA 221
"RTN","PSOORFI1",5,0)
 ;Ref. L^PSSLOCK supp. DBIA 2789
"RTN","PSOORFI1",6,0)
 ;Ref. ^PS(50.606 supp. DBIA 2174
"RTN","PSOORFI1",7,0)
 ;Ref. ^PS(55 supp. DBIA 2228
"RTN","PSOORFI1",8,0)
 ;Ref. ULK^ORX2 supp. DBIA 867
"RTN","PSOORFI1",9,0)
 ;
"RTN","PSOORFI1",10,0)
 ;PSO*186 add call to function $$DEACHK
"RTN","PSOORFI1",11,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORFI1",12,0)
 ;
"RTN","PSOORFI1",13,0)
 S SIGOK=1
"RTN","PSOORFI1",14,0)
DSPL K ^TMP("PSOPO",$J),CLOZPAT,PSOPRC,PSODSPL
"RTN","PSOORFI1",15,0)
 S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORFI1",16,0)
 I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR G DRG
"RTN","PSOORFI1",17,0)
 I '$P(OR0,"^",9) D DREN^PSOORNW2
"RTN","PSOORFI1",18,0)
DRG I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),"CLOZ1")),"^")="PSOCLO1" D CLOZ^PSOORFI2
"RTN","PSOORFI1",19,0)
 ;PSO*186 modify If/Else below to use DEACHK
"RTN","PSOORFI1",20,0)
 I $G(PSODRUG("DEA"))]"" D
"RTN","PSOORFI1",21,0)
 .S PSOCS=0 K DIR,DIC,PSOX
"RTN","PSOORFI1",22,0)
 .N PSDEA,PSDAYS S PSDEA=PSODRUG("DEA"),PSDAYS=+$P(OR0,"^",22)
"RTN","PSOORFI1",23,0)
 .I $$DEACHK^PSOUTLA1("*",PSDEA,PSDAYS,$G(CLOZPAT),.PSOCS,.PSOMAX)
"RTN","PSOORFI1",24,0)
 E  D
"RTN","PSOORFI1",25,0)
 .S PSOMAX=$S($G(CLOZPAT)=2:3,$G(CLOZPAT)=1:1,1:$P(OR0,"^",11))
"RTN","PSOORFI1",26,0)
ISSDT S (PSOID,Y,PSONEW("ISSUE DATE"))=$S($G(PSONEW("ISSUE DATE")):PSONEW("ISSUE DATE"),$P($G(OR0),"^",6):$E($P(OR0,"^",6),1,7),1:DT)
"RTN","PSOORFI1",27,0)
 X ^DD("DD") S PSONEW("ISSUE DATE")=Y
"RTN","PSOORFI1",28,0)
 D USER^PSOORFI2($P(OR0,"^",4)) S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSORX("CLERK CODE")=USER1
"RTN","PSOORFI1",29,0)
 S (PSONEW("DFLG"),PSONEW("QFLG"))=0,PSODFN=$P(OR0,"^",2),PSONEW("QTY")=$P(OR0,"^",10),PSONEW("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"M",1:"W")
"RTN","PSOORFI1",30,0)
 S:$G(PSONEW("CLINIC"))']"" PSONEW("CLINIC")=+$P(OR0,"^",13),PSORX("CLINIC")=$S($D(^SC(PSONEW("CLINIC"),0)):$P(^SC(PSONEW("CLINIC"),0),"^"),1:"")
"RTN","PSOORFI1",31,0)
 S:$G(PSORX("CLINIC"))']"" PSORX("CLINIC")=$S($D(^SC(+$P(OR0,"^",13),0)):$P(^SC($P(OR0,"^",13),0),"^"),1:"")
"RTN","PSOORFI1",32,0)
 D USER^PSOORFI2($P(OR0,"^",5))
"RTN","PSOORFI1",33,0)
 S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSONEW("PROVIDER")=$P(OR0,"^",5),PSONEW("PROVIDER NAME")=USER1
"RTN","PSOORFI1",34,0)
 S PSONEW("PATIENT STATUS")=$S(+$G(^PS(55,PSODFN,"PS")):+$G(^PS(55,PSODFN,"PS")),1:"")
"RTN","PSOORFI1",35,0)
 S PSONEW("CHCS NUMBER")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="":$P($G(^("EXT")),"^"),1:"")
"RTN","PSOORFI1",36,0)
 S PSONEW("EXTERNAL SYSTEM")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^",3)'="":$P($G(^("EXT")),"^",3),1:"")
"RTN","PSOORFI1",37,0)
 I $P(OR0,"^",22)>0 S PSONEW("DAYS SUPPLY")=$P(OR0,"^",22) G DS
"RTN","PSOORFI1",38,0)
 S PSONEW("DAYS SUPPLY")=$S(+$G(^PS(55,PSODFN,"PS"))&($P($G(^PS(53,+$G(^PS(55,PSODFN,"PS")),0)),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORFI1",39,0)
DS S:$D(CLOZPAT) PSONEW("DAYS SUPPLY")=$S(CLOZPAT=2&(PSONEW("DAYS SUPPLY")>28):28,CLOZPAT=1&(PSONEW("DAYS SUPPLY")>14):14,'CLOZPAT&(PSONEW("DAYS SUPPLY")>7):7,1:PSONEW("DAYS SUPPLY"))
"RTN","PSOORFI1",40,0)
 S IEN=0 D OBX
"RTN","PSOORFI1",41,0)
 D DIN^PSONFI(PSODRUG("OI"),$S($D(PSODRUG("IEN")):PSODRUG("IEN"),1:"")) ;Setup for N/F & DIN indicator
"RTN","PSOORFI1",42,0)
 I $G(PKI1)!($G(PKI)=1) D L1^PSOPKIV1 K:$G(PKI)=1 PKI
"RTN","PSOORFI1",43,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORFI1",44,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",45,0)
 D FULL^VALM1 K LST I $G(PSODRUG("NAME"))]"" D  G PST
"RTN","PSOORFI1",46,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORFI1",47,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",48,0)
 .I $P(^PSDRUG(PSODRUG("IEN"),0),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG^PSOORNEW
"RTN","PSOORFI1",49,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORFI1",50,0)
PST D DOSE^PSOORFI4 K PSOINSFL
"RTN","PSOORFI1",51,0)
 S PSOINSFL=$P($G(^PS(52.41,ORD,"INS")),"^",2)
"RTN","PSOORFI1",52,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D INST^PSOORFI4
"RTN","PSOORFI1",53,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST
"RTN","PSOORFI1",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST
"RTN","PSOORFI1",55,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:" D SIG
"RTN","PSOORFI1",56,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORFI1",57,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORFI1",58,0)
 S (Y,PSONEW("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        (7) Fill Date: "_Y
"RTN","PSOORFI1",59,0)
 I $P(OR0,"^",18) D
"RTN","PSOORFI1",60,0)
 .S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORFI1",61,0)
 D:$D(CLOZPAT) ELIG^PSOORFI2,CLQTY^PSOORFI4
"RTN","PSOORFI1",62,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:"")
"RTN","PSOORFI1",63,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D
"RTN","PSOORFI1",64,0)
 .S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORFI1",65,0)
 .S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORFI1",66,0)
 .S PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX) K RXPT
"RTN","PSOORFI1",67,0)
 .S MPSDY=PSONEW("DAYS SUPPLY")
"RTN","PSOORFI1",68,0)
 .;I PSOMAX=5 S MAXRF=$S(MPSDY<60:5,MPSDY'<60&(MPSDY'>89):2,1:1) I PSONEW("# OF REFILLS")>MAXRF S PSONEW("# OF REFILLS")=MAXRF K MAXRF,MPSDY Q
"RTN","PSOORFI1",69,0)
 .S MAXRF=$S(MPSDY<60:11,MPSDY'<60&(MPSDY'>89):5,MPSDY=90:3,1:0)
"RTN","PSOORFI1",70,0)
 .I PSONEW("# OF REFILLS")>MAXRF S PSONEW("# OF REFILLS")=MAXRF K MAXRF,MPSDY
"RTN","PSOORFI1",71,0)
 E  D
"RTN","PSOORFI1",72,0)
 . I $G(PSOMAX) S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11)) Q
"RTN","PSOORFI1",73,0)
 .S PSONEW("# OF REFILLS")=+$P(OR0,"^",11)
"RTN","PSOORFI1",74,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)_")",1:" (  )")_": "
"RTN","PSOORFI1",75,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$S($D(CLOZPAT):+$G(PSONEW("QTY")),1:$P(OR0,"^",10))
"RTN","PSOORFI1",76,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORFI1",77,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORFI1",78,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORFI1",79,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORFI1",80,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORFI1",81,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_PSONEW("# OF REFILLS")_$E("  ",$L(PSONEW("# OF REFILLS"))+1,2)_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORFI1",82,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORFI1",83,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORFI1",84,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) S PSONEW("COSIGNING PROVIDER")=$P(^("PS"),"^",8) D
"RTN","PSOORFI1",85,0)
 .D USER^PSOORFI2(PSONEW("COSIGNING PROVIDER"))
"RTN","PSOORFI1",86,0)
 .S IEN=IEN+1 S ^TMP("PSOPO",$J,IEN,0)="        Cos-Provider: "_USER1
"RTN","PSOORFI1",87,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: 1"
"RTN","PSOORFI1",88,0)
 S PSONEW("REMARKS")=$S($P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORFI1",89,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks: "_$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),1:"")
"RTN","PSOORFI1",90,0)
 D USER^PSOORFI2($P(OR0,"^",4))
"RTN","PSOORFI1",91,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_USER1_$E(RN,$L(USER1)+1,35)
"RTN","PSOORFI1",92,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORFI1",93,0)
 S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEF",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",94,0)
 ; - PSOACTOV is used to force the Pending Order to be Read-Only (no updates) even if invoked by a Pharmacist
"RTN","PSOORFI1",95,0)
 I $G(PSOACTOV) S PSOACT=""
"RTN","PSOORFI1",96,0)
 D:'$G(ACP) EN^PSOLMPO S:$G(ACP) VALMBCK="Q" D:$G(PKI1)=2 DCP^PSOPKIV1
"RTN","PSOORFI1",97,0)
 Q
"RTN","PSOORFI1",98,0)
POST ;post patient selection
"RTN","PSOORFI1",99,0)
 D POST^PSOORFI2 Q
"RTN","PSOORFI1",100,0)
SIG ;displays possible sig
"RTN","PSOORFI1",101,0)
 D SIG^PSOORFI2 Q
"RTN","PSOORFI1",102,0)
INST ;displays provider comments and pharmacy instructions
"RTN","PSOORFI1",103,0)
 S INST=0 F  S INST=$O(^PS(52.41,ORD,TY,INST)) Q:'INST  D     ;PSO*210
"RTN","PSOORFI1",104,0)
 . S (MIG,INST(INST))=^PS(52.41,ORD,TY,INST,0)
"RTN","PSOORFI1",105,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOPO",$J)),20)
"RTN","PSOORFI1",106,0)
 K INST,TY,MIG,SG
"RTN","PSOORFI1",107,0)
 Q
"RTN","PSOORFI1",108,0)
OBX ;formats obx section
"RTN","PSOORFI1",109,0)
 D OBX^PSOORFI4
"RTN","PSOORFI1",110,0)
 Q
"RTN","PSOORFI1",111,0)
ST ;sort by route or patient
"RTN","PSOORFI1",112,0)
 W !!,"Enter 'PA' to process orders by patients",!,"      'RT' to process orders by route (mail/window)",!,"      'PR' to process orders by priority",!,"      'CL' to process orders by clinic",!,"   or 'E' or '^' to exit" W ! Q
"RTN","PSOORFI1",113,0)
RT ;which route to sort by
"RTN","PSOORFI1",114,0)
 W !!,"Enter 'W' to process window orders first",!,"      'M' to process mail orders first",!,"      'C' to process orders administered in clinic first",!,"   or 'E' or '^' to exit" Q
"RTN","PSOORFI1",115,0)
PT ;process for all or one patient
"RTN","PSOORFI1",116,0)
 W !!,"Enter 'A' to process all patient orders",!,"      'S' to process orders for a patient",!,"      or 'E' or '^' to exit" Q
"RTN","PSOORFI1",117,0)
EP ;continue processing or not
"RTN","PSOORFI1",118,0)
 W !,"If you want to continue processing orders Press RETURN or enter '^' to exit" Q
"RTN","PSOORFI1",119,0)
LOCK S PSOPLCK=$$L^PSSLOCK(PAT,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S POERR("QFLG")=1
"RTN","PSOORFI1",120,0)
 K PSOPLCK
"RTN","PSOORFI1",121,0)
 Q
"RTN","PSOORFI1",122,0)
ULK S X=PAT_";DPT(" D ULK^ORX2 S:$G(PSOQUIT) POERR("QFLG")=1 ; not called anymore
"RTN","PSOORFI1",123,0)
 Q
"RTN","PSOORFI1",124,0)
LOCK1 S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEF",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",125,0)
 Q
"RTN","PSOORFI1",126,0)
EX K DRET,SIG,PSODRUG,PRC,PHI
"RTN","PSOORFI1",127,0)
 K DIR,DIRUT,DUOUT,DIRUT,X,Y,DIC,POERR,PSONEW,PSOSD,MAIL,CLI,WIN,OR0,OR1,OR2,ORD,SRT,PSRT,PSODFN,PSOFROM,T,OR3,PAT,%,%T,%Y,DI,DQ,DR,DRG,STA,I,T1,PSOSORT
"RTN","PSOORFI1",128,0)
 K TO,TC,TZ,PSOCPAY,PSOBILL,PSOIBQS,GROUPCNT,AGROUP,AGROUP1,OBX,%,%I,%H,D0,DFN,PSORX,PSOPTPST,PSOQFLG,PT,RTN,TM,TM1,DIPGM,PSOID,PSOCNT,PSOLK,PSZFIN,PSZFZZ D KVA^VADPT
"RTN","PSOORFI1",129,0)
 K PSOFDR,PSOQUIT,PSOFIN,^TMP("PSOAO",$J),^TMP("PSODA",$J),^TMP("PSOPO",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOHDR",$J),MEDA,MEDP
"RTN","PSOORFI1",130,0)
 K C,CC,CNT,CRIT,D,DGI,DGS,DREN,IT,JJ,LG,MM,NIEN,PSOD,PATA,PSDAYS,PSOACT,PSOBM,PSOCOU,PSOCOUU,PSOFLAG,PSON,PSONOOR,PSOOPT,PSOPF,PSOPI,PSRF,RXFL,SDA,SEG1,SER,SERS,SLPPL,STAT,Z,Z4,ZDA
"RTN","PSOORFI1",131,0)
 D FULL^VALM1
"RTN","PSOORFI1",132,0)
 Q
"RTN","PSOPMP0")
0^4^B76827234
"RTN","PSOPMP0",1,0)
PSOPMP0 ;BIRM/MFR - Patient Medication Profile - Listmanager ;10/28/06
"RTN","PSOPMP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSOPMP0",3,0)
 ;Reference to EN1^GMRADPT supported by IA #10099
"RTN","PSOPMP0",4,0)
 ;Reference to EN6^GMRVUTL supported by IA #1120
"RTN","PSOPMP0",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOPMP0",6,0)
 ;
"RTN","PSOPMP0",7,0)
EN ; - Menu option entry point
"RTN","PSOPMP0",8,0)
 N PSOEXPDC,PSOEXDCE,PSOSRTBY,PSORDER,PSOSIGDP,PSOSTSGP,PSOSTORD,PSORDCNT,PSOSTSEQ,PSORDSEQ,PSOCHNG
"RTN","PSOPMP0",9,0)
 N GRPLN,DIC,Y,DFN,GRPLN,HIGHLN,LASTLINE,VALMCNT
"RTN","PSOPMP0",10,0)
 ;
"RTN","PSOPMP0",11,0)
 ; - Division selection
"RTN","PSOPMP0",12,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! G EXIT
"RTN","PSOPMP0",13,0)
 ;
"RTN","PSOPMP0",14,0)
 ; - Patient selection
"RTN","PSOPMP0",15,0)
 W !! S DIC=2,DIC(0)="QEAM" D ^DIC G EXIT:Y<0  S DFN=+Y
"RTN","PSOPMP0",16,0)
 ;
"RTN","PSOPMP0",17,0)
 D LST(PSOSITE,DFN)
"RTN","PSOPMP0",18,0)
 Q
"RTN","PSOPMP0",19,0)
 ;
"RTN","PSOPMP0",20,0)
LST(SITE,PSODFN) ; - ListManager entry point
"RTN","PSOPMP0",21,0)
 ; Loading Division/User preferences
"RTN","PSOPMP0",22,0)
 D LOAD^PSOPMPPF(SITE,DUZ)
"RTN","PSOPMP0",23,0)
 ;
"RTN","PSOPMP0",24,0)
 W !,"Please wait..."
"RTN","PSOPMP0",25,0)
 D EN^VALM("PSO PMP MAIN")
"RTN","PSOPMP0",26,0)
 D FULL^VALM1
"RTN","PSOPMP0",27,0)
 G EXIT
"RTN","PSOPMP0",28,0)
 ;
"RTN","PSOPMP0",29,0)
HDR      ; - Header
"RTN","PSOPMP0",30,0)
 N LINE,POS,LINE1,LINE2,LINE3,LINE4,WT,WTDT,HT,HTDT,VADM,DFN,PNAME,DOB,SEX,X,GMRAL,ADVREA
"RTN","PSOPMP0",31,0)
 ;
"RTN","PSOPMP0",32,0)
 K VADM S DFN=PSODFN D DEM^VADPT
"RTN","PSOPMP0",33,0)
 S PNAME=VADM(1)
"RTN","PSOPMP0",34,0)
 S DOB=$S(+VADM(3):$P(VADM(3),"^",2)_" ("_$G(VADM(4))_")",1:"UNKNOWN")
"RTN","PSOPMP0",35,0)
 S SEX=$P(VADM(5),"^",2)
"RTN","PSOPMP0",36,0)
 S (WT,X)="",GMRVSTR="WT" D EN6^GMRVUTL I X'="" S WT=$J($P(X,"^",8)/2.2,6,2),WTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",37,0)
 S (HT,X)="",GMRVSTR="HT" D EN6^GMRVUTL I X'="" S HT=$J($P(X,"^",8)*2.54,6,2),HTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",38,0)
 S LINE1=PNAME
"RTN","PSOPMP0",39,0)
 S LINE1=$$ALLERGY^PSOPMP1(LINE1,DFN)
"RTN","PSOPMP0",40,0)
 S LINE2="  PID: "_$P(VADM(2),"^",2),$E(LINE2,50)="HEIGHT(cm): "_$S(HT'="":HT_" ("_HTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",41,0)
 S LINE3="  DOB: "_DOB,$E(LINE3,50)="WEIGHT(kg): "_$S(WT'="":WT_" ("_WTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",42,0)
 S LINE4="  SEX: "_SEX,$E(LINE4,43)="EXP/CANCEL CUTOFF: "_PSOEXDCE_" DAYS"
"RTN","PSOPMP0",43,0)
 ;
"RTN","PSOPMP0",44,0)
 K VALMHDR S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2,VALMHDR(3)=LINE3,VALMHDR(4)=LINE4
"RTN","PSOPMP0",45,0)
 ;
"RTN","PSOPMP0",46,0)
 D SETHDR^PSOPMP1()
"RTN","PSOPMP0",47,0)
 Q
"RTN","PSOPMP0",48,0)
 ;
"RTN","PSOPMP0",49,0)
INIT ; - Populates the Body section for ListMan
"RTN","PSOPMP0",50,0)
 K ^TMP("PSOPMP0",$J)
"RTN","PSOPMP0",51,0)
 ;
"RTN","PSOPMP0",52,0)
 D SETSORT(PSOSRTBY),SETLINE
"RTN","PSOPMP0",53,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOPMP0",54,0)
 Q
"RTN","PSOPMP0",55,0)
 ;
"RTN","PSOPMP0",56,0)
SETLINE ; - Sets the line to be displayed in ListMan
"RTN","PSOPMP0",57,0)
 N TYPE,STS,SUB,SEQ,LINE,Z,TOTAL,I,X,X1,ORDCNT,LBL,LN,IENSUB,GROUP,GRP,QTYL
"RTN","PSOPMP0",58,0)
 I '$D(^TMP("PSOPMPSR",$J)) D  Q
"RTN","PSOPMP0",59,0)
 . F I=1:1:6 S ^TMP("PSOPMP0",$J,I,0)=""
"RTN","PSOPMP0",60,0)
 . S ^TMP("PSOPMP0",$J,7,0)="                    No prescriptions found for this patient."
"RTN","PSOPMP0",61,0)
 . S VALMCNT=1
"RTN","PSOPMP0",62,0)
 ;
"RTN","PSOPMP0",63,0)
 ; - Resetting list to NORMAL video attributes
"RTN","PSOPMP0",64,0)
 F I=1:1:$G(LASTLINE) D RESTORE^VALM10(I)
"RTN","PSOPMP0",65,0)
 K GRPLN,HIGHLN
"RTN","PSOPMP0",66,0)
 ;
"RTN","PSOPMP0",67,0)
 ; - Building the list (line by line)
"RTN","PSOPMP0",68,0)
 S (GROUP,STS,SUB)="",LINE=0 K ^TMP("PSOPMP0",$J)
"RTN","PSOPMP0",69,0)
 F  S GROUP=$O(^TMP("PSOPMPSR",$J,GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",70,0)
 . S GRP=$P(GROUP,"^")
"RTN","PSOPMP0",71,0)
 . I GRP'["R"!('PSOSTSGP&($O(^TMP("PSOPMPSR",$J,GROUP),-1)'="")) D
"RTN","PSOPMP0",72,0)
 . . D GROUP^PSOPMP1($P(GROUP,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP)),.LINE)
"RTN","PSOPMP0",73,0)
 . F  S STS=$O(^TMP("PSOPMPSR",$J,GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",74,0)
 . . I STS'="<NULL>" D
"RTN","PSOPMP0",75,0)
 . . . D GROUP^PSOPMP1($P(STS,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP,STS)),.LINE)
"RTN","PSOPMP0",76,0)
 . . F  S SUB=$O(^TMP("PSOPMPSR",$J,GROUP,STS,SUB),$S(PSORDER="A":1,1:-1)) Q:SUB=""  D
"RTN","PSOPMP0",77,0)
 . . . S Z=$G(^TMP("PSOPMPSR",$J,GROUP,STS,SUB))
"RTN","PSOPMP0",78,0)
 . . . S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOPMP0",79,0)
 . . . S QTYL=$L($P(Z,"^",4)) S:QTYL<5 QTYL=5
"RTN","PSOPMP0",80,0)
 . . . I GRP["R"!(GRP["T") S $E(X1,5)=$P(Z,"^",2),$E(X1,19)=$E($P(Z,"^",3),1,(32-QTYL))
"RTN","PSOPMP0",81,0)
 . . . I GRP["P"!(GRP["N") S $E(X1,5)=$P(Z,"^",3)
"RTN","PSOPMP0",82,0)
 . . . I GRP["N" S $E(X1,49)="Date Documented:"
"RTN","PSOPMP0",83,0)
 . . . I GRP'["N" S $E(X1,52-QTYL)=$J($P(Z,"^",4),QTYL),$E(X1,53)=$P(Z,"^",5),$E(X1,57)=$P(Z,"^",6)
"RTN","PSOPMP0",84,0)
 . . . S $E(X1,66)=$P(Z,"^",7)
"RTN","PSOPMP0",85,0)
 . . . S $E(X1,74)=$J($P(Z,"^",8),3),$E(X1,78)=$J($P(Z,"^",9),3)
"RTN","PSOPMP0",86,0)
 . . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X1,HIGHLN(LINE)=""
"RTN","PSOPMP0",87,0)
 . . . S IENSUB=$S(GRP["R"!(GRP["T"):"RX",GRP["P":"PEN",1:"NVA")
"RTN","PSOPMP0",88,0)
 . . . S ^TMP("PSOPMP0",$J,SEQ,IENSUB)=$P(Z,"^")
"RTN","PSOPMP0",89,0)
 . . . I $G(PSOSIGDP) D SETSIG^PSOPMP1($S(GRP["R"!(GRP["T"):"R",GRP["P":"P",1:"N"),+Z,.LINE,PSODFN)
"RTN","PSOPMP0",90,0)
 ;
"RTN","PSOPMP0",91,0)
 ; - Saving NORMAL video attributes to be reset later
"RTN","PSOPMP0",92,0)
 I LINE>$G(LASTLINE) D
"RTN","PSOPMP0",93,0)
 . F I=($G(LASTLINE)+1):1:LINE D SAVE^VALM10(I)
"RTN","PSOPMP0",94,0)
 . S LASTLINE=LINE
"RTN","PSOPMP0",95,0)
 ;
"RTN","PSOPMP0",96,0)
 D VIDEO^PSOPMP1()
"RTN","PSOPMP0",97,0)
 ;
"RTN","PSOPMP0",98,0)
 S VALMCNT=+$G(LINE)
"RTN","PSOPMP0",99,0)
 Q
"RTN","PSOPMP0",100,0)
 ;
"RTN","PSOPMP0",101,0)
SETSORT(FIELD) ; - Sets the data sorted by the FIELD specified
"RTN","PSOPMP0",102,0)
 N SEQ,RX,RXNUM,DRUG,DRNAME,QTY,STATUS,STS,ISSDT,DOCDAT,LSTFD,REFREM,DAYSUP,SIG,Z,ORD,GRPCNT,GROUP,RFRX,OI
"RTN","PSOPMP0",103,0)
 ;
"RTN","PSOPMP0",104,0)
 K ^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",105,0)
 ;
"RTN","PSOPMP0",106,0)
 ; - Loading prescription (file #55)
"RTN","PSOPMP0",107,0)
 S SEQ=0
"RTN","PSOPMP0",108,0)
 F  S SEQ=$O(^PS(55,PSODFN,"P",SEQ)) Q:'SEQ  D
"RTN","PSOPMP0",109,0)
 . S RX=+$G(^PS(55,PSODFN,"P",SEQ,0)) I 'RX!($G(^PSRX(RX,0))="") Q
"RTN","PSOPMP0",110,0)
 . I $$FILTER^PSOPMP1(RX) Q
"RTN","PSOPMP0",111,0)
 . S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOPMP0",112,0)
 . S DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSOPMP0",113,0)
 . S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",114,0)
 . S QTY=$$GET1^DIQ(52,RX,7)
"RTN","PSOPMP0",115,0)
 . S STATUS=$$STSINFO^PSOPMP1(RX)
"RTN","PSOPMP0",116,0)
 . S ISSDT=$$ISSDT^PSOPMP1(RX,"R")
"RTN","PSOPMP0",117,0)
 . S LSTFD=$$LSTFD^PSOPMP1(RX)
"RTN","PSOPMP0",118,0)
 . S REFREM=$$REFREM^PSOPMP1(RX)
"RTN","PSOPMP0",119,0)
 . S DAYSUP=$$GET1^DIQ(52,RX,8)
"RTN","PSOPMP0",120,0)
 . S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=RXNUM_$$COPAY^PSOPMP1(RX)_$$ECME^PSOBPSUT(RX),$P(Z,"^",3)=$E(DRNAME,1,30)
"RTN","PSOPMP0",121,0)
 . S $P(Z,"^",4)=QTY,$P(Z,"^",5)=$P(STATUS,"^",3)_$$CMOP^PSOPMP1(DRUG,RX),$P(Z,"^",6)=$P(ISSDT,"^",2)
"RTN","PSOPMP0",122,0)
 . S $P(Z,"^",7)=$P(LSTFD,"^",2),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",123,0)
 . S SORT=$S(FIELD="RX":RXNUM_" ",FIELD="DR":DRNAME_RXNUM,FIELD="ID":+ISSDT_RXNUM_" ",FIELD="LF":+LSTFD_RXNUM_" ")
"RTN","PSOPMP0",124,0)
 . S STS="<NULL>" I $G(PSOSTSGP) S STS=$P(STATUS,"^")_"^"_$P(STATUS,"^",2)
"RTN","PSOPMP0",125,0)
 . S GROUP=$P(PSORDSEQ("R"),"^")_"R^"_$P(PSORDSEQ("R"),"^",2)
"RTN","PSOPMP0",126,0)
 . I $$FIND^PSOREJUT(RX) S GROUP=$P(PSORDSEQ("T"),"^")_"T^"_$P(PSORDSEQ("T"),"^",2),STS="<NULL>"
"RTN","PSOPMP0",127,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,STS,SORT)=Z
"RTN","PSOPMP0",128,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1,GRPCNT(GROUP,STS)=$G(GRPCNT(GROUP,STS))+1
"RTN","PSOPMP0",129,0)
 ;
"RTN","PSOPMP0",130,0)
 S GROUP=""
"RTN","PSOPMP0",131,0)
 F  S GROUP=$O(GRPCNT(GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",132,0)
 . S ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",133,0)
 . S STS="" F  S STS=$O(GRPCNT(GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",134,0)
 . . S ^TMP("PSOPMPSR",$J,GROUP,STS)=GRPCNT(GROUP,STS)
"RTN","PSOPMP0",135,0)
 ;
"RTN","PSOPMP0",136,0)
 ; - Loading pending orders (file #52.41)
"RTN","PSOPMP0",137,0)
 S ORD=0,GROUP=$P(PSORDSEQ("P"),"^")_"P^"_$P(PSORDSEQ("P"),"^",2)
"RTN","PSOPMP0",138,0)
 F  S ORD=$O(^PS(52.41,"P",PSODFN,ORD)) Q:'ORD  D
"RTN","PSOPMP0",139,0)
 . S TYPE=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",140,0)
 . I TYPE="DC"!(TYPE="DE")!(TYPE="HD") Q
"RTN","PSOPMP0",141,0)
 . S DRNAME="",DRUG=+$$GET1^DIQ(52.41,ORD,11,"I") I DRUG S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",142,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",143,0)
 . . S OI=$$GET1^DIQ(52.41,ORD,8,"I") I 'OI Q
"RTN","PSOPMP0",144,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",145,0)
 . S QTY=$$GET1^DIQ(52.41,ORD,12)
"RTN","PSOPMP0",146,0)
 . S STATUS=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",147,0)
 . S ISSDT=$$ISSDT^PSOPMP1(ORD,"P")
"RTN","PSOPMP0",148,0)
 . S REFREM=$$GET1^DIQ(52.41,ORD,13)
"RTN","PSOPMP0",149,0)
 . S DAYSUP=$$GET1^DIQ(52.41,ORD,101)
"RTN","PSOPMP0",150,0)
 . S RFRX="" I STATUS="RF" S RFRX=$$GET1^DIQ(52.41,ORD,21,"I") I RFRX S RFRX=$$GET1^DIQ(52,RFRX,.01)
"RTN","PSOPMP0",151,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,45),$P(Z,"^",4)=QTY,$P(Z,"^",5)=$E(STATUS,1,2)_$$CMOP^PSOPMP1(DRUG)
"RTN","PSOPMP0",152,0)
 . S $P(Z,"^",6)=$S(RFRX'="":"Rx#: "_RFRX,1:$P(ISSDT,"^",2)),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",153,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":+ISSDT_ORD,FIELD="LF":+ISSDT_ORD)
"RTN","PSOPMP0",154,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",155,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",156,0)
 ;
"RTN","PSOPMP0",157,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",158,0)
 ;
"RTN","PSOPMP0",159,0)
 ; - Loading Non-VA Med orders (file #55, sub-file #55.05)
"RTN","PSOPMP0",160,0)
 S ORD=0,GROUP=$P(PSORDSEQ("N"),"^")_"N^"_$P(PSORDSEQ("N"),"^",2)
"RTN","PSOPMP0",161,0)
 F  S ORD=$O(^PS(55,PSODFN,"NVA",ORD)) Q:'ORD  D
"RTN","PSOPMP0",162,0)
 . I $$GET1^DIQ(55.05,ORD_","_PSODFN,5,"I") Q
"RTN","PSOPMP0",163,0)
 . S DRNAME=$$GET1^DIQ(55.05,ORD_","_PSODFN,1)
"RTN","PSOPMP0",164,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",165,0)
 . . S OI=$$GET1^DIQ(55.05,ORD_","_PSODFN,.01,"I") I 'OI Q
"RTN","PSOPMP0",166,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",167,0)
 . S DOCDAT=$P($$GET1^DIQ(55.05,ORD_","_PSODFN_",",11,"I"),".")
"RTN","PSOPMP0",168,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,38),$P(Z,"^",7)=$$DAT^PSOPMP1(DOCDAT,"-")
"RTN","PSOPMP0",169,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":DOCDAT_ORD,FIELD="LF":DOCDAT_ORD)
"RTN","PSOPMP0",170,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",171,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",172,0)
 ;
"RTN","PSOPMP0",173,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",174,0)
 ;
"RTN","PSOPMP0",175,0)
 Q
"RTN","PSOPMP0",176,0)
 ;
"RTN","PSOPMP0",177,0)
RX ; - Sort by Rx
"RTN","PSOPMP0",178,0)
 D SORT("RX")
"RTN","PSOPMP0",179,0)
 Q
"RTN","PSOPMP0",180,0)
DR ; - Sort by Drug
"RTN","PSOPMP0",181,0)
 D SORT("DR")
"RTN","PSOPMP0",182,0)
 Q
"RTN","PSOPMP0",183,0)
ID ; - Sort by Issue Date
"RTN","PSOPMP0",184,0)
 D SORT("ID")
"RTN","PSOPMP0",185,0)
 Q
"RTN","PSOPMP0",186,0)
LF ; - Sort by Last Fill Date
"RTN","PSOPMP0",187,0)
 D SORT("LF")
"RTN","PSOPMP0",188,0)
 Q
"RTN","PSOPMP0",189,0)
 ;
"RTN","PSOPMP0",190,0)
SORT(FIELD) ; - Sort entries by FIELD
"RTN","PSOPMP0",191,0)
 I PSOSRTBY=FIELD S PSORDER=$S(PSORDER="A":"D",1:"A")
"RTN","PSOPMP0",192,0)
 E  S PSOSRTBY=FIELD,PSORDER="A"
"RTN","PSOPMP0",193,0)
 D REF
"RTN","PSOPMP0",194,0)
 Q
"RTN","PSOPMP0",195,0)
 ;
"RTN","PSOPMP0",196,0)
REF ; - Screen Refresh
"RTN","PSOPMP0",197,0)
 W ?52,"Please wait..." D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",198,0)
 Q
"RTN","PSOPMP0",199,0)
GS ; - Group by Status
"RTN","PSOPMP0",200,0)
 W ?52,"Please wait..." S PSOSTSGP=$S($G(PSOSTSGP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",201,0)
 Q
"RTN","PSOPMP0",202,0)
 ;
"RTN","PSOPMP0",203,0)
SIG ; - Display SIG
"RTN","PSOPMP0",204,0)
 W ?52,"Please wait..." S PSOSIGDP=$S($G(PSOSIGDP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",205,0)
 I 'PSOSIGDP S VALMBG=VALMBG\2
"RTN","PSOPMP0",206,0)
 I PSOSIGDP S VALMBG=VALMBG*2-1
"RTN","PSOPMP0",207,0)
 S:VALMBG>(VALMCNT-10) VALMBG=VALMCNT-10 S:VALMBG<1 VALMBG=1
"RTN","PSOPMP0",208,0)
 Q
"RTN","PSOPMP0",209,0)
 ;
"RTN","PSOPMP0",210,0)
PI ; - Patient Information
"RTN","PSOPMP0",211,0)
 D EN^PSOLMPI S VALMBCK="R"
"RTN","PSOPMP0",212,0)
 Q
"RTN","PSOPMP0",213,0)
 ;
"RTN","PSOPMP0",214,0)
CV ; - Change View
"RTN","PSOPMP0",215,0)
 D LST^PSOPMPPF(SITE,DUZ) W !?52,"Please wait..." D INIT,HDR
"RTN","PSOPMP0",216,0)
 S VALMBG=1,VALMBCK="R"
"RTN","PSOPMP0",217,0)
 Q
"RTN","PSOPMP0",218,0)
 ;
"RTN","PSOPMP0",219,0)
SEL ; - Process selection of one entry
"RTN","PSOPMP0",220,0)
 N PSOSEL,TYPE,XQORM,ORD,TITLE
"RTN","PSOPMP0",221,0)
 S PSOSEL=+$P($P(Y(1),"^",4),"=",2) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",222,0)
 S TYPE=$O(^TMP("PSOPMP0",$J,PSOSEL,0)) I TYPE="" S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",223,0)
 S ORD=$G(^TMP("PSOPMP0",$J,PSOSEL,TYPE))
"RTN","PSOPMP0",224,0)
 I 'ORD S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",225,0)
 S TITLE=VALM("TITLE")
"RTN","PSOPMP0",226,0)
 ;
"RTN","PSOPMP0",227,0)
 ; - Regular prescription
"RTN","PSOPMP0",228,0)
 I TYPE="RX" D
"RTN","PSOPMP0",229,0)
 . N PSOVDA,PSOSAVE,DA,PS
"RTN","PSOPMP0",230,0)
 . S (PSOVDA,DA)=ORD,PS="REJECT"
"RTN","PSOPMP0",231,0)
 . N LINE,TITLE,PSODFN D DP^PSORXVW
"RTN","PSOPMP0",232,0)
 ;
"RTN","PSOPMP0",233,0)
 ; - Pending Order
"RTN","PSOPMP0",234,0)
 I TYPE="PEN" D
"RTN","PSOPMP0",235,0)
 . N PSOACTOV,OR0
"RTN","PSOPMP0",236,0)
 . S OR0=^PS(52.41,ORD,0),PSOACTOV=""
"RTN","PSOPMP0",237,0)
 . N LINE,TITLE D PENHDR^PSOPMP1(PSODFN),DSPL^PSOORFI1
"RTN","PSOPMP0",238,0)
 ;
"RTN","PSOPMP0",239,0)
 ; - Pending Order
"RTN","PSOPMP0",240,0)
 I TYPE="NVA" D
"RTN","PSOPMP0",241,0)
 . N LINE,TITLE D EN^PSONVAVW(PSODFN,ORD)
"RTN","PSOPMP0",242,0)
 ;
"RTN","PSOPMP0",243,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOPMP0",244,0)
 Q
"RTN","PSOPMP0",245,0)
 ;
"RTN","PSOPMP0",246,0)
EXIT ;
"RTN","PSOPMP0",247,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",248,0)
 Q
"RTN","PSOPMP0",249,0)
 ;
"RTN","PSOPMP0",250,0)
HELP Q
"RTN","PSOPMP1")
0^8^B26858864
"RTN","PSOPMP1",1,0)
PSOPMP1 ;BIRM/MFR - Patient Medication Profile - Listmanager ;04/28/05
"RTN","PSOPMP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSOPMP1",3,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOPMP1",4,0)
 ;Reference to EN1^GMRADPT supported by IA 10099
"RTN","PSOPMP1",5,0)
 ;Reference to ^PSXOPUTL supported by IA 2200
"RTN","PSOPMP1",6,0)
 ;
"RTN","PSOPMP1",7,0)
VIDEO() ; - Changes the Video Attributes for the list
"RTN","PSOPMP1",8,0)
 ;
"RTN","PSOPMP1",9,0)
 ; - Highlighting the PRESCRIPTION line if SIG is displayed
"RTN","PSOPMP1",10,0)
 I $G(PSOSIGDP) D
"RTN","PSOPMP1",11,0)
 . F I=1:1:LINE D
"RTN","PSOPMP1",12,0)
 . . I $D(HIGHLN(I)) D CNTRL^VALM10(I,1,80,IOINHI,IOINORM)
"RTN","PSOPMP1",13,0)
 ;
"RTN","PSOPMP1",14,0)
 ; - Highlighting the group lines (order type and status)
"RTN","PSOPMP1",15,0)
 I $D(GRPLN) D
"RTN","PSOPMP1",16,0)
 . S LN=0 F I=1:1 S LN=$O(GRPLN(LN)) Q:'LN  D
"RTN","PSOPMP1",17,0)
 . . S LBL=GRPLN(LN),POS=41-($L(LBL)\2)
"RTN","PSOPMP1",18,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",19,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IOINORM)
"RTN","PSOPMP1",20,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),81-POS-$L(LBL),IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",21,0)
 Q
"RTN","PSOPMP1",22,0)
 ;
"RTN","PSOPMP1",23,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOPMP1",24,0)
 N HDR,ORD,POS
"RTN","PSOPMP1",25,0)
 ;
"RTN","PSOPMP1",26,0)
 ; - Line 1
"RTN","PSOPMP1",27,0)
 S $E(HDR,57)="ISSUE",$E(HDR,66)="LAST",$E(HDR,74)="REF",$E(HDR,78)="DAY"
"RTN","PSOPMP1",28,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,6)
"RTN","PSOPMP1",29,0)
 ; - Line 2
"RTN","PSOPMP1",30,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,19)="DRUG",$E(HDR,49)="QTY",$E(HDR,53)="ST"
"RTN","PSOPMP1",31,0)
 S $E(HDR,57)="DATE",$E(HDR,66)="FILL",$E(HDR,74)="REM",$E(HDR,78)="SUP"
"RTN","PSOPMP1",32,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,7)
"RTN","PSOPMP1",33,0)
 S ORD=$S(PSORDER="A":"[^]",1:"[v]")
"RTN","PSOPMP1",34,0)
 S:PSOSRTBY="RX" POS=9 S:PSOSRTBY="DR" POS=24 S:PSOSRTBY="ID" POS=61 S:PSOSRTBY="LF" POS=70
"RTN","PSOPMP1",35,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,7)
"RTN","PSOPMP1",36,0)
 Q
"RTN","PSOPMP1",37,0)
 ;
"RTN","PSOPMP1",38,0)
SETSIG(TYPE,RX,LINE,DFN) ; Set the SIG line
"RTN","PSOPMP1",39,0)
 N FSIG,L,X,DIWL,DIWR
"RTN","PSOPMP1",40,0)
 ;
"RTN","PSOPMP1",41,0)
 I TYPE="N" D  Q
"RTN","PSOPMP1",42,0)
 . K ^UTILITY($J,"W")
"RTN","PSOPMP1",43,0)
 . S X=$$SCHED^PSONVNEW($$GET1^DIQ(55.05,RX_","_DFN,4)),DIWL=1,DIWR=71 D ^DIWP
"RTN","PSOPMP1",44,0)
 . F L=1:1 Q:'$D(^UTILITY($J,"W",1,L))  D
"RTN","PSOPMP1",45,0)
 . . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=^UTILITY($J,"W",1,L,0)
"RTN","PSOPMP1",46,0)
 . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",47,0)
 ;
"RTN","PSOPMP1",48,0)
 D FSIG^PSOUTLA(TYPE,+RX,71)
"RTN","PSOPMP1",49,0)
 F L=1:1 Q:'$D(FSIG(L))  D
"RTN","PSOPMP1",50,0)
 . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=FSIG(L)
"RTN","PSOPMP1",51,0)
 . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",52,0)
 Q
"RTN","PSOPMP1",53,0)
 ;
"RTN","PSOPMP1",54,0)
GROUP(LBL,CNT,LINE) ; Sets a group delimiter line
"RTN","PSOPMP1",55,0)
 N X,POS
"RTN","PSOPMP1",56,0)
 S LBL=LBL_$S(PSORDCNT:" ("_CNT_" order"_$S(CNT>1:"s",1:"")_")",1:"")
"RTN","PSOPMP1",57,0)
 S POS=41-($L(LBL)\2)
"RTN","PSOPMP1",58,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOPMP1",59,0)
 S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X,GRPLN(LINE)=LBL
"RTN","PSOPMP1",60,0)
 Q
"RTN","PSOPMP1",61,0)
 ;
"RTN","PSOPMP1",62,0)
PENHDR(DFN) ; Sets the Header in the ^TMP("PSOHDR",$J) global for displaying individual Pending Order
"RTN","PSOPMP1",63,0)
 N VADM,WT,HT,PSOERR,GMRA
"RTN","PSOPMP1",64,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSOPMP1",65,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOPMP1",66,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOPMP1",67,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSOPMP1",68,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$J($P(WT,"^",9),6)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOPMP1",69,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$J($P(HT,"^",9),6)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOPMP1",70,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOPMP1",71,0)
 Q
"RTN","PSOPMP1",72,0)
 ;
"RTN","PSOPMP1",73,0)
FILTER(RX) ; - Filter Rx's that should not be displayed
"RTN","PSOPMP1",74,0)
 I $$GET1^DIQ(52,RX,26,"I")<PSOEXPDC Q 1
"RTN","PSOPMP1",75,0)
 I $$GET1^DIQ(52,RX,26.1,"I")<PSOEXPDC,$$GET1^DIQ(52,RX,100,"I")>11,$$GET1^DIQ(52,RX,100,"I")'=16 Q 1
"RTN","PSOPMP1",76,0)
 I $$GET1^DIQ(52,RX,100,"I")=""!($$GET1^DIQ(52,RX,100,"I")=13) Q 1
"RTN","PSOPMP1",77,0)
 I $$GET1^DIQ(52,RX,.01)="" Q 1
"RTN","PSOPMP1",78,0)
 Q 0
"RTN","PSOPMP1",79,0)
 ;
"RTN","PSOPMP1",80,0)
STSINFO(RX) ; Returns the Rx Status MNEMONIC^NAME
"RTN","PSOPMP1",81,0)
 ; Input: RX - Prescription IEN (#52)
"RTN","PSOPMP1",82,0)
 ;Output: Status Mnemonic ("A","DC",etc.)^Status Name ("ACTIVE","DISCONTINUED",etc.)
"RTN","PSOPMP1",83,0)
 ;
"RTN","PSOPMP1",84,0)
 N STS
"RTN","PSOPMP1",85,0)
 I '$D(^PSRX(RX,"STA")) Q ""
"RTN","PSOPMP1",86,0)
 S STS=$$GET1^DIQ(52,RX,100,"I")
"RTN","PSOPMP1",87,0)
 I STS=0 Q:$$GET1^DIQ(52,RX,26,"I")>DT PSOSTSEQ("A") Q PSOSTSEQ("E")
"RTN","PSOPMP1",88,0)
 I STS=1 Q PSOSTSEQ("N")
"RTN","PSOPMP1",89,0)
 I STS=3 Q PSOSTSEQ("H")
"RTN","PSOPMP1",90,0)
 I STS=5 Q PSOSTSEQ("S")
"RTN","PSOPMP1",91,0)
 I STS=11 Q PSOSTSEQ("E")
"RTN","PSOPMP1",92,0)
 I STS=12 Q PSOSTSEQ("DC")
"RTN","PSOPMP1",93,0)
 I STS=14 Q PSOSTSEQ("DP")
"RTN","PSOPMP1",94,0)
 I STS=15 Q PSOSTSEQ("DE")
"RTN","PSOPMP1",95,0)
 I STS=16 Q PSOSTSEQ("PH")
"RTN","PSOPMP1",96,0)
 Q "99^UNKNOWN^??"
"RTN","PSOPMP1",97,0)
 ; 
"RTN","PSOPMP1",98,0)
ISSDT(IEN,TYPE) ; Returns the Rx ISSUE DATE formatted MM-DD-YY
"RTN","PSOPMP1",99,0)
 ;Input: RX   - PrescrXiption IEN (#52)
"RTN","PSOPMP1",100,0)
 ;       TYPE - "R":Regular Rx, "P":Pending order
"RTN","PSOPMP1",101,0)
 N ISSDT
"RTN","PSOPMP1",102,0)
 I TYPE="R" S ISSDT=$$GET1^DIQ(52,IEN,1,"I")
"RTN","PSOPMP1",103,0)
 I TYPE="P" S ISSDT=$$GET1^DIQ(52.41,IEN,6,"I")
"RTN","PSOPMP1",104,0)
 I ISSDT'="" S ISSDT=ISSDT\1
"RTN","PSOPMP1",105,0)
 ;
"RTN","PSOPMP1",106,0)
 Q (ISSDT_"^"_$$DAT(ISSDT,"-"))
"RTN","PSOPMP1",107,0)
 ;
"RTN","PSOPMP1",108,0)
LSTFD(RX) ; Returns the Rx LAST FILL DATE formatted MM-DD-YY[R], where [R] = Returned to Stock
"RTN","PSOPMP1",109,0)
 ;Input: RX  - Prescription IEN (#52)
"RTN","PSOPMP1",110,0)
 N LSTFD,RTSTK,RFL
"RTN","PSOPMP1",111,0)
 S LSTFD=$$GET1^DIQ(52,RX,101,"I")\1 I LSTFD="" Q ""
"RTN","PSOPMP1",112,0)
 I '$$LSTRFL^PSOBPSU1(RX) D
"RTN","PSOPMP1",113,0)
 . I $$GET1^DIQ(52,RX,32.1,"I") S RTSTK="R"
"RTN","PSOPMP1",114,0)
 E  S RFL=0 F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D
"RTN","PSOPMP1",115,0)
 . I $$RXFLDT^PSOBPSUT(RX,RFL)'=LSTFD Q
"RTN","PSOPMP1",116,0)
 . I $$GET1^DIQ(52.1,RFL_","_RX,14,"I") S RTSTK="R"
"RTN","PSOPMP1",117,0)
 ;
"RTN","PSOPMP1",118,0)
 Q (LSTFD_"^"_$$DAT(LSTFD,"-")_$G(RTSTK))
"RTN","PSOPMP1",119,0)
 ;
"RTN","PSOPMP1",120,0)
REFREM(RX) ; - Returns the number of refills remaining
"RTN","PSOPMP1",121,0)
 N REFREM,RFL
"RTN","PSOPMP1",122,0)
 S REFREM=+$$GET1^DIQ(52,RX,9)
"RTN","PSOPMP1",123,0)
 F RFL=0:1 S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  S REFREM=REFREM-1
"RTN","PSOPMP1",124,0)
 Q $S(REFREM<0:0,1:REFREM)
"RTN","PSOPMP1",125,0)
 ;
"RTN","PSOPMP1",126,0)
 ;
"RTN","PSOPMP1",127,0)
DAT(FMDT,SEP,Y4) ; - Formats FM dates to MM/DD/YY (SEP: Separator:"/","-",etc...)
"RTN","PSOPMP1",128,0)
 ;Input: (r) FMDT - Fileman Date
"RTN","PSOPMP1",129,0)
 ;       (r) SEP  - Separator
"RTN","PSOPMP1",130,0)
 ;       (o) Y4   - 4 digits year flag
"RTN","PSOPMP1",131,0)
 I $G(FMDT)="" Q ""
"RTN","PSOPMP1",132,0)
 I '$E(FMDT,6,7)!'$E(FMDT,4,7) Q $$UP^XLFSTR($TR($$FMTE^XLFDT(FMDT)," ","-"))
"RTN","PSOPMP1",133,0)
 Q ($E(FMDT,4,5)_SEP_$E(FMDT,6,7)_SEP_$S($G(Y4):$E(FMDT,1,3)+1700,1:$E(FMDT,2,3)))
"RTN","PSOPMP1",134,0)
 ;
"RTN","PSOPMP1",135,0)
COPAY(RX) ; Returns "$" is Rx has a copay and "" if not
"RTN","PSOPMP1",136,0)
 Q $S($D(^PSRX(RX,"IB")):"$",1:"")
"RTN","PSOPMP1",137,0)
 ;
"RTN","PSOPMP1",138,0)
CMOP(DRUG,RX) ; Returns the CMOP indicator (">", "T", etc)
"RTN","PSOPMP1",139,0)
 N CMOP,X,DA,PSXZ
"RTN","PSOPMP1",140,0)
 S CMOP="" I $D(^PSDRUG("AQ",DRUG)) S CMOP=">"
"RTN","PSOPMP1",141,0)
 I $G(RX) S DA=RX D ^PSXOPUTL I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S CMOP="T"
"RTN","PSOPMP1",142,0)
 Q CMOP
"RTN","PSOPMP1",143,0)
 ;
"RTN","PSOPMP1",144,0)
ALLERGY(LINE,DFN,POS) ; also called from PSONVAVW & PSOPMP0
"RTN","PSOPMP1",145,0)
 ; Input:  LINE - (r) text to concatenate allergy information to
"RTN","PSOPMP1",146,0)
 ;         DFN - (r) patient IEN used for ^GMRADTP
"RTN","PSOPMP1",147,0)
 ;         POS - (o) position # to include text
"RTN","PSOPMP1",148,0)
 ;Output: LINE - modified text
"RTN","PSOPMP1",149,0)
 N ALLERGY,PSONOAL
"RTN","PSOPMP1",150,0)
 S (PSONOAL,ALLERGY)=""
"RTN","PSOPMP1",151,0)
 D EN1^GMRADPT
"RTN","PSOPMP1",152,0)
 I GMRAL S ALLERGY="<A>"
"RTN","PSOPMP1",153,0)
 E  D ALLERGY^PSOORUT2 I PSONOAL'="" S ALLERGY="<NO ALLERGY ASSESSMENT>"
"RTN","PSOPMP1",154,0)
 S ALLERGY=IORVON_ALLERGY_IOINORM
"RTN","PSOPMP1",155,0)
 I '$G(POS) S POS=80-$L(ALLERGY)
"RTN","PSOPMP1",156,0)
 S LINE=$$SETSTR^VALM1(ALLERGY,LINE,POS,80)
"RTN","PSOPMP1",157,0)
 Q LINE
"RTN","PSOPMPPF")
0^7^B55558822
"RTN","PSOPMPPF",1,0)
PSOPMPPF ;BIRM/MFR - Patient Medication Profile - Preferences ;04/28/05
"RTN","PSOPMPPF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSOPMPPF",3,0)
 ;
"RTN","PSOPMPPF",4,0)
EN ; - Menu option entry point
"RTN","PSOPMPPF",5,0)
 N PSOCHNG,PSOQUIT,DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",6,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOPMPPF",7,0)
 ;
"RTN","PSOPMPPF",8,0)
 D LOAD(PSOSITE),LST(PSOSITE)
"RTN","PSOPMPPF",9,0)
 I '$G(PSOQUIT),$G(PSOCHNG) D SAVE(PSOSITE)
"RTN","PSOPMPPF",10,0)
 ;
"RTN","PSOPMPPF",11,0)
 G END
"RTN","PSOPMPPF",12,0)
 ;
"RTN","PSOPMPPF",13,0)
LST(PSOSITE,PSOUSER) ; - Listmanager entry point
"RTN","PSOPMPPF",14,0)
 N DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",15,0)
 S (PSOCHNG,PSOQUIT)=0,PSOUSER=+$G(PSOUSER) D FULL^VALM1 W !
"RTN","PSOPMPPF",16,0)
 ;
"RTN","PSOPMPPF",17,0)
 ; - Reset user/division preferences
"RTN","PSOPMPPF",18,0)
 I (PSOUSER&$D(^PS(52.85,PSOSITE,"USER",PSOUSER)))!('PSOUSER&($$GET1^DIQ(52.85,PSOSITE,1)'="")) D
"RTN","PSOPMPPF",19,0)
 . D DISPLAY(PSOSITE,PSOUSER)
"RTN","PSOPMPPF",20,0)
 . S DIR("A")="     Delete this default view? "
"RTN","PSOPMPPF",21,0)
 . S DIR(0)="YA",DIR("B")="NO" D ^DIR I $D(DIRUT)!$D(DIROUT) S PSOQUIT=1 Q
"RTN","PSOPMPPF",22,0)
 . I Y=1 D DELETE(PSOSITE,PSOUSER),LOAD(PSOSITE,PSOUSER)
"RTN","PSOPMPPF",23,0)
 . W !
"RTN","PSOPMPPF",24,0)
 E  W !,"Division: ",$$GET1^DIQ(59,PSOSITE,.01),!
"RTN","PSOPMPPF",25,0)
 I PSOQUIT Q
"RTN","PSOPMPPF",26,0)
 ;
"RTN","PSOPMPPF",27,0)
EXPDC ; - Expiration/Discontinued Cutoff Date
"RTN","PSOPMPPF",28,0)
 K DIR,DIRUT,DIROUT,SAVEX
"RTN","PSOPMPPF",29,0)
 S DIR(0)="NA^0:9999",DIR("A")="EXP/CANCEL CUTOFF: ",DIR("B")=PSOEXDCE
"RTN","PSOPMPPF",30,0)
 S DIR("?",1)="Enter the maximum number of days for an expired and/or"
"RTN","PSOPMPPF",31,0)
 S DIR("?")="discontinued prescription to be cut from the profile."
"RTN","PSOPMPPF",32,0)
 D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"EXPDC")
"RTN","PSOPMPPF",33,0)
 W " DAYS" S PSOEXDCE=X,X="T"_$S(X:"-"_X,1:"") D ^%DT S PSOEXPDC=Y
"RTN","PSOPMPPF",34,0)
 D CHANGED(PSOSITE,PSOUSER,"EXPDC",PSOEXDCE)
"RTN","PSOPMPPF",35,0)
 ;
"RTN","PSOPMPPF",36,0)
SRTBY ; - Sort By 
"RTN","PSOPMPPF",37,0)
 K DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",38,0)
 S DIR(0)="SA^RX:Rx#;DR:DRUG NAME;ID:ISSUE DATE;LF:LAST FILL DATE",DIR("B")=PSOSRTBY
"RTN","PSOPMPPF",39,0)
 S DIR("A")="SORT BY: " D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"SRTBY")
"RTN","PSOPMPPF",40,0)
 S PSOSRTBY=Y D CHANGED(PSOSITE,PSOUSER,"SRTBY",PSOSRTBY)
"RTN","PSOPMPPF",41,0)
 ;
"RTN","PSOPMPPF",42,0)
ORDER ; - Sort Order 
"RTN","PSOPMPPF",43,0)
 K DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",44,0)
 S DIR(0)="SA^A:ASCENDING;D:DESCENDING",DIR("B")=$S(PSORDER="A":"ASCENDING",1:"DESCENDING")
"RTN","PSOPMPPF",45,0)
 S DIR("A")="SORT ORDER: " D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"ORDER")
"RTN","PSOPMPPF",46,0)
 S PSORDER=Y D CHANGED(PSOSITE,PSOUSER,"ORDER",PSORDER)
"RTN","PSOPMPPF",47,0)
 ;
"RTN","PSOPMPPF",48,0)
SIGDP ; - Display SIG 
"RTN","PSOPMPPF",49,0)
 K DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",50,0)
 S DIR(0)="SA^ON:ON;OFF:OFF",DIR("B")=$S(PSOSIGDP=1:"ON",1:"OFF")
"RTN","PSOPMPPF",51,0)
 S DIR("A")="DISPLAY SIG: " D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"SIGDP")
"RTN","PSOPMPPF",52,0)
 S Y=$S(X="ON":1,1:0),PSOSIGDP=Y D CHANGED(PSOSITE,PSOUSER,"SIGDP",PSOSIGDP)
"RTN","PSOPMPPF",53,0)
 ;
"RTN","PSOPMPPF",54,0)
STSGP ; - Group By Status 
"RTN","PSOPMPPF",55,0)
 K DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",56,0)
 S DIR(0)="SA^ON:ON;OFF:OFF",DIR("B")=$S(PSOSTSGP=1:"ON",1:"OFF")
"RTN","PSOPMPPF",57,0)
 S DIR("A")="GROUP BY STATUS: " D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"STSGP")
"RTN","PSOPMPPF",58,0)
 S Y=$S(X="ON":1,1:0),PSOSTSGP=Y D CHANGED(PSOSITE,PSOUSER,"STSGP",PSOSTSGP)
"RTN","PSOPMPPF",59,0)
 ;
"RTN","PSOPMPPF",60,0)
ORDCNT ; - Display Order Count 
"RTN","PSOPMPPF",61,0)
 K DIR,DIRUT,DIROUT
"RTN","PSOPMPPF",62,0)
 S DIR(0)="SA^ON:ON;OFF:OFF",DIR("B")=$S(PSORDCNT=1:"ON",1:"OFF")
"RTN","PSOPMPPF",63,0)
 S DIR("A")="DISPLAY ORDER COUNT: " D ^DIR I $D(DIRUT)!$D(DIROUT) G @$$GOTO(X,"ORDCNT")
"RTN","PSOPMPPF",64,0)
 S Y=$S(X="ON":1,1:0),PSORDCNT=Y D CHANGED(PSOSITE,PSOUSER,"ORDCNT",PSORDCNT)
"RTN","PSOPMPPF",65,0)
 ;
"RTN","PSOPMPPF",66,0)
EXIT ; Exit
"RTN","PSOPMPPF",67,0)
 ;
"RTN","PSOPMPPF",68,0)
 ; - Save view?
"RTN","PSOPMPPF",69,0)
 I $G(PSOCHNG),PSOUSER D
"RTN","PSOPMPPF",70,0)
 . W ! S DIR(0)="YA",DIR("B")="NO",DIR("A")="Save as your default View? "
"RTN","PSOPMPPF",71,0)
 . D ^DIR I $D(DIRUT)!$D(DIROUT)!(Y=0) Q
"RTN","PSOPMPPF",72,0)
 . D SAVE(PSOSITE,PSOUSER)
"RTN","PSOPMPPF",73,0)
 ;
"RTN","PSOPMPPF",74,0)
 S VALMBCK="R"
"RTN","PSOPMPPF",75,0)
 ;
"RTN","PSOPMPPF",76,0)
END Q
"RTN","PSOPMPPF",77,0)
 ;
"RTN","PSOPMPPF",78,0)
DISPLAY(SITE,USER) ; - Displays the current view
"RTN","PSOPMPPF",79,0)
 N X,Z,FLG,LN
"RTN","PSOPMPPF",80,0)
 S (X,Z,FLG)=""
"RTN","PSOPMPPF",81,0)
 I $G(USER),$D(^PS(52.85,SITE,"USER",+$G(USER))) D
"RTN","PSOPMPPF",82,0)
 . S X=$$GET1^DIQ(200,USER,.01),Z=^PS(52.85,SITE,"USER",+$G(USER),0),FLG=1
"RTN","PSOPMPPF",83,0)
 E  D
"RTN","PSOPMPPF",84,0)
 . S X=$$GET1^DIQ(59,SITE,.01),Z=$G(^PS(52.85,SITE,0))
"RTN","PSOPMPPF",85,0)
 I Z="" Q
"RTN","PSOPMPPF",86,0)
 S X=X_"'s current default view"_$S(FLG:" ("_$$GET1^DIQ(59,SITE,.01)_")",1:"")_":"
"RTN","PSOPMPPF",87,0)
 S $P(LN,"-",$L(X))="" W !?5,X,!?5,LN
"RTN","PSOPMPPF",88,0)
 W !?5,"EXP/CANCEL CUTOFF  : ",$P(Z,"^",2)," DAYS"
"RTN","PSOPMPPF",89,0)
 S X=$P(Z,"^",3) W !?5,"SORT BY            : "
"RTN","PSOPMPPF",90,0)
 W $S(X="RX":"Rx#",X="DR":"DRUG NAME",X="ID":"ISSUE DATE",X="LF":"LAST FILL DATE",1:"??")
"RTN","PSOPMPPF",91,0)
 W !?5,"SORT ORDER         : ",$S($P(Z,"^",4)="A":"ASCENDING",1:"DESCENDING")
"RTN","PSOPMPPF",92,0)
 W !?5,"DISPLAY SIG        : ",$S($P(Z,"^",5):"ON",1:"OFF")
"RTN","PSOPMPPF",93,0)
 W !?5,"GROUP BY STATUS    : ",$S($P(Z,"^",6):"ON",1:"OFF")
"RTN","PSOPMPPF",94,0)
 W !?5,"DISPLAY ORDER COUNT: ",$S($P(Z,"^",7):"ON",1:"OFF")
"RTN","PSOPMPPF",95,0)
 W !
"RTN","PSOPMPPF",96,0)
 Q 
"RTN","PSOPMPPF",97,0)
 ;
"RTN","PSOPMPPF",98,0)
GOTO(INPUT,HOME) ; - Directed up-arrow
"RTN","PSOPMPPF",99,0)
 N GOTO,TAG,TRGT
"RTN","PSOPMPPF",100,0)
 I $P(INPUT,"^",2)="" S PSOQUIT=1 Q "EXIT"
"RTN","PSOPMPPF",101,0)
 ;
"RTN","PSOPMPPF",102,0)
 S TRGT=$P(INPUT,"^",2)
"RTN","PSOPMPPF",103,0)
 S TAG("EXP/CANCEL CUTOFF")="EXPDC"
"RTN","PSOPMPPF",104,0)
 S TAG("SORT BY")="SRTBY"
"RTN","PSOPMPPF",105,0)
 S TAG("SORT ORDER")="ORDER"
"RTN","PSOPMPPF",106,0)
 S TAG("DISPLAY SIG")="SIGDP"
"RTN","PSOPMPPF",107,0)
 S TAG("GROUP BY STATUS")="STSGP"
"RTN","PSOPMPPF",108,0)
 S TAG("DISPLAY ORDER COUNT")="ORDCNT"
"RTN","PSOPMPPF",109,0)
 ;
"RTN","PSOPMPPF",110,0)
 S GOTO=HOME
"RTN","PSOPMPPF",111,0)
 S TAG="" F  S TAG=$O(TAG(TAG)) Q:TAG=""  I $E(TAG,1,$L(TRGT))=TRGT S GOTO=TAG(TAG) Q
"RTN","PSOPMPPF",112,0)
 I GOTO=HOME W "   ??",$C(7)
"RTN","PSOPMPPF",113,0)
 ;
"RTN","PSOPMPPF",114,0)
 Q GOTO
"RTN","PSOPMPPF",115,0)
 ;
"RTN","PSOPMPPF",116,0)
LOAD(SITE,USER) ; Loading Factory/Division/User preferences
"RTN","PSOPMPPF",117,0)
 ;Input : SITE     - Pointer to OUTPATIENT SITE file (#59)
"RTN","PSOPMPPF",118,0)
 ;        USER     - Pointer to NEW PSERON file (#200)
"RTN","PSOPMPPF",119,0)
 ;Output: PSOEXPDC - Expiration Cutoff Date
"RTN","PSOPMPPF",120,0)
 ;        PSOEXDCE - Expiration Cutoff Date (External)
"RTN","PSOPMPPF",121,0)
 ;        PSOSRTBY - Sort By
"RTN","PSOPMPPF",122,0)
 ;        PSORDER - Sort Order ("A":Asc,"D":Desc)
"RTN","PSOPMPPF",123,0)
 ;        PSOSIGDP - Display SIG (1:ON/0:OFF)
"RTN","PSOPMPPF",124,0)
 ;        PSORDCNT - Display Order Count (1:ON/0:OFF)
"RTN","PSOPMPPF",125,0)
 ;        PSOSTSGP - Group by Status (1:ON/0:OFF)
"RTN","PSOPMPPF",126,0)
 ;        PSOSTSEQ - Status Display Order Array
"RTN","PSOPMPPF",127,0)
 ;        PSORDSEQ - Group Display Order Array
"RTN","PSOPMPPF",128,0)
 ;
"RTN","PSOPMPPF",129,0)
 K PSOEXPDC,PSOEXDCE,PSOSRTBY,PSORDER,PSOSTSGP,PSOSIGDP,PSOSTSEQ,PSORDSEQ
"RTN","PSOPMPPF",130,0)
 ;
"RTN","PSOPMPPF",131,0)
 N X,Y,Z,TMP,STSGRP,STS,ORDGRP,GRPNAM
"RTN","PSOPMPPF",132,0)
 ;
"RTN","PSOPMPPF",133,0)
 ; - Factory Defaults
"RTN","PSOPMPPF",134,0)
 S PSOEXDCE=120,X="T-120" D ^%DT S PSOEXPDC=Y
"RTN","PSOPMPPF",135,0)
 S PSOSRTBY="DR",PSORDER="A",PSORDCNT=1,(PSOSTSGP,PSOSIGDP)=0
"RTN","PSOPMPPF",136,0)
 ; 
"RTN","PSOPMPPF",137,0)
 S PSOSTSEQ("A")="1^ACTIVE^A"             ; Active
"RTN","PSOPMPPF",138,0)
 S PSOSTSEQ("S")="1^ACTIVE^S"             ; Suspended
"RTN","PSOPMPPF",139,0)
 S PSOSTSEQ("E")="1^ACTIVE^E"             ; Expired
"RTN","PSOPMPPF",140,0)
 S PSOSTSEQ("DC")="2^DISCONTINUED^DC"     ; Discontinued
"RTN","PSOPMPPF",141,0)
 S PSOSTSEQ("DP")="2^DISCONTINUED^DP"     ; Discontinued by Provider
"RTN","PSOPMPPF",142,0)
 S PSOSTSEQ("DE")="2^DISCONTINUED^DE"     ; Discontinued on Edit
"RTN","PSOPMPPF",143,0)
 S PSOSTSEQ("H")="3^HOLD^H"               ; Hold
"RTN","PSOPMPPF",144,0)
 S PSOSTSEQ("PH")="3^HOLD^PH"             ; Provider Hold
"RTN","PSOPMPPF",145,0)
 S PSOSTSEQ("N")="4^NON-VERIFIED^N"       ; Non-Verified
"RTN","PSOPMPPF",146,0)
 ;
"RTN","PSOPMPPF",147,0)
 S PSORDSEQ("T")="1^REFILL TOO SOON/DUR REJECTS(Third Party)"
"RTN","PSOPMPPF",148,0)
 S PSORDSEQ("R")="2^CURRENT ORDERS"
"RTN","PSOPMPPF",149,0)
 S PSORDSEQ("P")="3^PENDING"
"RTN","PSOPMPPF",150,0)
 S PSORDSEQ("N")="4^NON-VA MEDS (Not dispensed by VA)"
"RTN","PSOPMPPF",151,0)
 ;
"RTN","PSOPMPPF",152,0)
 ; - User's preferences
"RTN","PSOPMPPF",153,0)
 I $G(USER),$D(^PS(52.85,SITE,"USER",USER,0)) D SET(^PS(52.85,SITE,"USER",USER,0)) Q
"RTN","PSOPMPPF",154,0)
 ;
"RTN","PSOPMPPF",155,0)
 ; - Division's preferences
"RTN","PSOPMPPF",156,0)
 I $D(^PS(52.85,SITE,0)) D SET(^PS(52.85,SITE,0)) Q
"RTN","PSOPMPPF",157,0)
 ;
"RTN","PSOPMPPF",158,0)
 Q
"RTN","PSOPMPPF",159,0)
 ;
"RTN","PSOPMPPF",160,0)
CHANGED(SITE,USER,FIELD,VALUE) ; - Sets PSOCHNG so the list can be refreshed
"RTN","PSOPMPPF",161,0)
 I $G(PSOCHNG) Q
"RTN","PSOPMPPF",162,0)
 ;
"RTN","PSOPMPPF",163,0)
 ; - Saved User's preferences
"RTN","PSOPMPPF",164,0)
 S Z=""
"RTN","PSOPMPPF",165,0)
 I '$G(USER),$P($G(^PS(52.85,SITE,0)),"^",2) S Z=^PS(52.85,SITE,0)
"RTN","PSOPMPPF",166,0)
 I $G(USER),$D(^PS(52.85,SITE,"USER",USER,0)) S Z=^PS(52.85,SITE,"USER",USER,0)
"RTN","PSOPMPPF",167,0)
 ;
"RTN","PSOPMPPF",168,0)
 I FIELD="EXPDC",VALUE'=$P(Z,"^",2) S PSOCHNG=1 Q
"RTN","PSOPMPPF",169,0)
 I FIELD="SRTBY",VALUE'=$P(Z,"^",3) S PSOCHNG=1 Q
"RTN","PSOPMPPF",170,0)
 I FIELD="ORDER",VALUE'=$P(Z,"^",4) S PSOCHNG=1 Q
"RTN","PSOPMPPF",171,0)
 I FIELD="SIGDP",VALUE'=+$P(Z,"^",5) S PSOCHNG=1 Q
"RTN","PSOPMPPF",172,0)
 I FIELD="STSGP",VALUE'=+$P(Z,"^",6) S PSOCHNG=1 Q
"RTN","PSOPMPPF",173,0)
 I FIELD="ORDCNT",VALUE'=+$P(Z,"^",7) S PSOCHNG=1 Q
"RTN","PSOPMPPF",174,0)
 ;
"RTN","PSOPMPPF",175,0)
 Q
"RTN","PSOPMPPF",176,0)
 ;
"RTN","PSOPMPPF",177,0)
 ;
"RTN","PSOPMPPF",178,0)
SET(ZNODE) ;
"RTN","PSOPMPPF",179,0)
 N X,Y
"RTN","PSOPMPPF",180,0)
 S X=+$P(ZNODE,"^",2) I X S PSOEXDCE=X,X="T-"_X D ^%DT S PSOEXPDC=Y
"RTN","PSOPMPPF",181,0)
 S X=$P(ZNODE,"^",3) I X'="" S PSOSRTBY=X
"RTN","PSOPMPPF",182,0)
 S X=$P(ZNODE,"^",4) I X'="" S PSORDER=X
"RTN","PSOPMPPF",183,0)
 S X=$P(ZNODE,"^",5) I X'="" S PSOSIGDP=X
"RTN","PSOPMPPF",184,0)
 S X=$P(ZNODE,"^",6) I X'="" S PSOSTSGP=X
"RTN","PSOPMPPF",185,0)
 S X=$P(ZNODE,"^",7) I X'="" S PSORDCNT=X
"RTN","PSOPMPPF",186,0)
 Q
"RTN","PSOPMPPF",187,0)
 ;
"RTN","PSOPMPPF",188,0)
SAVE(SITE,USER) ; - Saves preferences by Site and/or User
"RTN","PSOPMPPF",189,0)
 N DIE,DR,DA
"RTN","PSOPMPPF",190,0)
 ;
"RTN","PSOPMPPF",191,0)
 W !!,"Saving..."
"RTN","PSOPMPPF",192,0)
 ;
"RTN","PSOPMPPF",193,0)
 I '$D(^PS(52.85,SITE)) D
"RTN","PSOPMPPF",194,0)
 . N %,DIC,DR,DA,X,DINUM,DLAYGO,DD,DO
"RTN","PSOPMPPF",195,0)
 . S DIC="^PS(52.85,",(DINUM,X)=SITE,DIC(0)=""
"RTN","PSOPMPPF",196,0)
 . K DD,DO D FILE^DICN K DD,DO
"RTN","PSOPMPPF",197,0)
 ;
"RTN","PSOPMPPF",198,0)
 I $G(USER),'$D(^PS(52.85,SITE,"USER",USER,0)) D
"RTN","PSOPMPPF",199,0)
 . N %,DIC,DR,DA,X,DINUM,DLAYGO,DD,DO
"RTN","PSOPMPPF",200,0)
 . S DIC="^PS(52.85,"_SITE_",""USER"",",DA(1)=SITE,(DINUM,X)=USER,DIC(0)=""
"RTN","PSOPMPPF",201,0)
 . K DD,DO D FILE^DICN K DD,DO
"RTN","PSOPMPPF",202,0)
 ;
"RTN","PSOPMPPF",203,0)
 S DR="1///"_PSOEXDCE_";2///"_PSOSRTBY_";3///"_PSORDER
"RTN","PSOPMPPF",204,0)
 S DR=DR_";4///"_PSOSIGDP_";5///"_PSOSTSGP_";6///"_PSORDCNT
"RTN","PSOPMPPF",205,0)
 ;
"RTN","PSOPMPPF",206,0)
 I '$G(USER) S DIE="^PS(52.85,",DA=SITE
"RTN","PSOPMPPF",207,0)
 I $G(USER) S DIE="^PS(52.85,"_SITE_",""USER"",",DA(1)=SITE,DA=USER
"RTN","PSOPMPPF",208,0)
 ;
"RTN","PSOPMPPF",209,0)
 D ^DIE H 2 W "OK!"
"RTN","PSOPMPPF",210,0)
 ;
"RTN","PSOPMPPF",211,0)
 Q
"RTN","PSOPMPPF",212,0)
 ;
"RTN","PSOPMPPF",213,0)
DELETE(SITE,USER) ; - Deletes user/division preferences
"RTN","PSOPMPPF",214,0)
 N DIK,DA,DIE,DR,FLD
"RTN","PSOPMPPF",215,0)
 ;
"RTN","PSOPMPPF",216,0)
 W !!,"Deleting..."
"RTN","PSOPMPPF",217,0)
 ;
"RTN","PSOPMPPF",218,0)
 I '$G(SITE) Q
"RTN","PSOPMPPF",219,0)
 I $G(USER) S DIK="^PS(52.85,"_SITE_",""USER"",",DA(1)=SITE,DA=USER D ^DIK H 1 W "OK!" Q
"RTN","PSOPMPPF",220,0)
 I '$D(^PS(52.85,SITE,"USER")) S DIK="^PS(52.85,",DA=SITE D ^DIK H 1 W "OK!" Q
"RTN","PSOPMPPF",221,0)
 S DR="" F FLD=1:1:8 S $P(DR,";",FLD)=FLD_"///@"
"RTN","PSOPMPPF",222,0)
 S DIE="^PS(52.85,",DA=SITE D ^DIE H 1 W "OK!"
"RTN","PSOPMPPF",223,0)
 Q
"RTN","PSOR52")
0^16^B33265182
"RTN","PSOR52",1,0)
PSOR52 ;IHS/DSD/JCM - Files refill entries in prescription file ;03/10/93
"RTN","PSOR52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,22,27,181,148,201,260**;DEC 1997;Build 84
"RTN","PSOR52",3,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOR52",4,0)
 ;Reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOR52",5,0)
 ;Reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSOR52",6,0)
 ;Reference SAVNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSOR52",7,0)
 ; This routine is responsible for the actual
"RTN","PSOR52",8,0)
 ; filling of the refill prescription.
"RTN","PSOR52",9,0)
 ;---------------------------------------------------------   
"RTN","PSOR52",10,0)
EN(PSOX) ;Entry Point
"RTN","PSOR52",11,0)
START ;
"RTN","PSOR52",12,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT monitor
"RTN","PSOR52",13,0)
 D INIT G:PSOR52("QFLG") END
"RTN","PSOR52",14,0)
 D FILE
"RTN","PSOR52",15,0)
 D DIK
"RTN","PSOR52",16,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSOR52",17,0)
 D FINISH
"RTN","PSOR52",18,0)
END D EOJ
"RTN","PSOR52",19,0)
 Q
"RTN","PSOR52",20,0)
 ;---------------------------------------------------------
"RTN","PSOR52",21,0)
 ;
"RTN","PSOR52",22,0)
INIT ;
"RTN","PSOR52",23,0)
 S PSOR52("QFLG")=0
"RTN","PSOR52",24,0)
 S PSOX("QTY")=$P(PSOX("RX0"),"^",7),PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSOR52",25,0)
 S:$G(^PSDRUG($P(PSOX("RX0"),"^",6),660))]"" PSOX("COST")=$P(^PSDRUG($P(PSOX("RX0"),"^",6),660),"^",6)
"RTN","PSOR52",26,0)
 D NOW^%DTC S PSOX("LOGIN DATE")=$E(%,1,7)
"RTN","PSOR52",27,0)
 S X1=PSOX("FILL DATE"),X2=PSOX("DAYS SUPPLY")-10\1 D C^%DTC S PSOX1=X
"RTN","PSOR52",28,0)
 S X1=$P(PSOX("RX2"),"^",2)
"RTN","PSOR52",29,0)
 S X2=PSOX("DAYS SUPPLY")*(PSOX("NUMBER")+1)-10\1
"RTN","PSOR52",30,0)
 D C^%DTC S PSOX2=X
"RTN","PSOR52",31,0)
 S PSOX("NEXT POSSIBLE REFILL")=$S(PSOX1>PSOX2:PSOX1,1:PSOX2)
"RTN","PSOR52",32,0)
 K X,PSOX1,PSOX2
"RTN","PSOR52",33,0)
 S (PSOX("LAST DISPENSED DATE"),PSOX("DISPENSED DATE"))=PSOX("FILL DATE")
"RTN","PSOR52",34,0)
 I PSOX("FILL DATE")>$S($G(PSOX("LOGIN DATE")):$E(PSOX("LOGIN DATE"),1,7),1:DT),$P(PSOPAR,"^",6) D
"RTN","PSOR52",35,0)
 .S PSOX("OLD MAIL/WINDOW")=$S($G(PSOX("MAIL/WINDOW"))]"":PSOX("MAIL/WINDOW"),1:"MAIL"),PSOX("MAIL/WINDOW")="M"
"RTN","PSOR52",36,0)
 I $P(PSOX("RX2"),"^",12)]"" S PSOX("GENERIC PROVIDER")=$P(PSOX("RX2"),"^",12)
"RTN","PSOR52",37,0)
 S PSOX("PROVIDER")=$P(PSOX("RX0"),"^",4)
"RTN","PSOR52",38,0)
 S:'$D(PSOX("CLERK CODE")) PSOX("CLERK CODE")=DUZ
"RTN","PSOR52",39,0)
 S PSOX("DAW")=$$GETDAW^PSODAWUT(+PSOX("IRXN")),PSOX("NDC")=$$GETNDC^PSSNDCUT($P(PSOX("RX0"),"^",6))
"RTN","PSOR52",40,0)
INITX Q
"RTN","PSOR52",41,0)
 ;
"RTN","PSOR52",42,0)
FILE ;     
"RTN","PSOR52",43,0)
 ;L +^PSRX(PSOX("IRXN")):0
"RTN","PSOR52",44,0)
 I '$D(^PSRX(PSOX("IRXN"),1,0)) S ^(0)="^52.1DA^1^1"
"RTN","PSOR52",45,0)
 E  S ^PSRX(PSOX("IRXN"),1,0)=$P(^PSRX(PSOX("IRXN"),1,0),"^",1,2)_"^"_PSOX("NUMBER")_"^"_($P(^(0),"^",4)+1)
"RTN","PSOR52",46,0)
 F PSOX1=1:1 S PSOR52=$P($T(DD+PSOX1),";;",2,4) Q:PSOR52=""  K PSOY S PSOY=$P(PSOR52,";;") I $D(@PSOY) S $P(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),$P(PSOR52,";;",2)),"^",$P(PSOR52,";;",3))=@PSOY
"RTN","PSOR52",47,0)
 K PSOX1,PSOY
"RTN","PSOR52",48,0)
 S PSOX1="" F  S PSOX1=$O(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1)=$G(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1))
"RTN","PSOR52",49,0)
 K PSOX1
"RTN","PSOR52",50,0)
 S:PSOX("STA")=6 $P(^PSRX(PSOX("IRXN"),"STA"),"^")=0
"RTN","PSOR52",51,0)
 S $P(^PSRX(PSOX("IRXN"),3),"^",1,2)=PSOX("LAST DISPENSED DATE")_"^"_PSOX("NEXT POSSIBLE REFILL")
"RTN","PSOR52",52,0)
 S $P(^PSRX(PSOX("IRXN"),3),"^",4)=PSOX("LAST REFILL DATE")
"RTN","PSOR52",53,0)
 I $D(PSOX("METHOD OF PICK-UP")),PSOX("FILL DATE")'>DT S $P(^PSRX(PSOX("IRXN"),"MP"),"^")=PSOX("METHOD OF PICK-UP")
"RTN","PSOR52",54,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),PSOX("NUMBER"))
"RTN","PSOR52",55,0)
 ;L -^PSRX(PSOX("IRXN"))
"RTN","PSOR52",56,0)
 Q
"RTN","PSOR52",57,0)
 ;
"RTN","PSOR52",58,0)
DIK ;
"RTN","PSOR52",59,0)
 K DIK,DA
"RTN","PSOR52",60,0)
 S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSOR52",61,0)
 I +$G(^PSRX(DA,"IB")),$P(^PSRX(DA,1,PSOX("NUMBER"),0),"^",2)="W" S ^PSRX("ACP",$P(^PSRX(DA,0),"^",2),$P(^PSRX(DA,1,PSOX("NUMBER"),0),"^"),PSOX("NUMBER"),DA)="" K DA
"RTN","PSOR52",62,0)
 D:$T(EN^PSOHDR)]"" EN^PSOHDR("PREF",PSOX("IRXN"))
"RTN","PSOR52",63,0)
 Q
"RTN","PSOR52",64,0)
 ;
"RTN","PSOR52",65,0)
FINISH ;
"RTN","PSOR52",66,0)
 I $G(PSOX("QS"))="S" D  G FINISHX
"RTN","PSOR52",67,0)
 . S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",68,0)
 . D SUS^PSORXL K DA
"RTN","PSOR52",69,0)
 ;
"RTN","PSOR52",70,0)
 ; - Previous ePharmacy Refill was Deleted and a new one is being entered
"RTN","PSOR52",71,0)
 I '$$SUBMIT^PSOBPSUT(PSOX("IRXN"),PSOX("NUMBER")),$$STATUS^PSOBPSUT(PSOX("IRXN"),PSOX("NUMBER"))'="" D
"RTN","PSOR52",72,0)
 . D RETRXF^PSOREJU2(PSOX("IRXN"),PSOX("NUMBER"),1)
"RTN","PSOR52",73,0)
 ;
"RTN","PSOR52",74,0)
 I PSOX("FILL DATE")>$S($G(PSOX("LOGIN DATE")):$E(PSOX("LOGIN DATE"),1,7),1:DT),$P(PSOPAR,"^",6) D  G FINISHX
"RTN","PSOR52",75,0)
 .K PSOXRXFL I $D(RXFL(PSOX("IRXN"))) S PSOXRXFL=$G(RXFL(PSOX("IRXN")))
"RTN","PSOR52",76,0)
 .S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",77,0)
 .D SUS^PSORXL K DA
"RTN","PSOR52",78,0)
 .I $G(PSOXRXFL)'="" S RXFL(PSOX("IRXN"))=$G(PSOXRXFL) K PSOXRXFL
"RTN","PSOR52",79,0)
 ;
"RTN","PSOR52",80,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSOR52",81,0)
 N ACTION,PSOERX,PSOERF
"RTN","PSOR52",82,0)
 S PSOERX=PSOX("IRXN"),PSOERF=PSOX("NUMBER")
"RTN","PSOR52",83,0)
 I $$SUBMIT^PSOBPSUT(PSOERX,PSOERF) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOR52",84,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOERX,PSOERF,PSOX("FILL DATE"),"RF")
"RTN","PSOR52",85,0)
 . I $$FIND^PSOREJUT(PSOERX,PSOERF) D
"RTN","PSOR52",86,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOERX,PSOERF,"79,88","OF","IOQ","I")
"RTN","PSOR52",87,0)
 . I $$STATUS^PSOBPSUT(PSOERX,PSOERF)="E PAYABLE" D
"RTN","PSOR52",88,0)
 . . D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,PSOERX,6,"I"),$G(PSOSITE),$$GETNDC^PSONDCUT(PSOERX,PSOERF))
"RTN","PSOR52",89,0)
 ;
"RTN","PSOR52",90,0)
 I $G(PSOX("QS"))="Q" D  G FINISHX
"RTN","PSOR52",91,0)
 . I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSOR52",92,0)
 . S RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",93,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSOR52",94,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSOR52",95,0)
 ;
"RTN","PSOR52",96,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=PSOX("NUMBER") G FINISHX
"RTN","PSOR52",97,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOR52",98,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSOR52",99,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSOR52",100,0)
 S RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",101,0)
 ;
"RTN","PSOR52",102,0)
FINISHX ; 
"RTN","PSOR52",103,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSOR52",104,0)
 K PSOX1,PSOX2
"RTN","PSOR52",105,0)
 Q
"RTN","PSOR52",106,0)
EOJ ;
"RTN","PSOR52",107,0)
 I $D(PSOX("OLD MAIL/WINDOW")) S PSOX("MAIL/WINDOW")=PSOX("OLD MAIL/WINDOW") K PSOX("OLD MAIL/WINDOW")
"RTN","PSOR52",108,0)
 S DA=$O(^PS(52.41,"ARF",PSOX("IRXN"),0)) I DA D  S DIK="^PS(52.41," D ^DIK
"RTN","PSOR52",109,0)
 .S PSORFKL=DA D PSOUL^PSSLOCK(PSORFKL_"S") K PSORFKL
"RTN","PSOR52",110,0)
 K PSOR52,DA,DIK
"RTN","PSOR52",111,0)
 Q
"RTN","PSOR52",112,0)
 ;
"RTN","PSOR52",113,0)
DD ;rx data nodes
"RTN","PSOR52",114,0)
 ;;PSOX("PROVIDER");;0;;17
"RTN","PSOR52",115,0)
 ;;PSOX("QTY");;0;;4
"RTN","PSOR52",116,0)
 ;;PSOX("DAYS SUPPLY");;0;;10
"RTN","PSOR52",117,0)
 ;;PSOX("MAIL/WINDOW");;0;;2
"RTN","PSOR52",118,0)
 ;;PSOX("REMARKS");;0;;3
"RTN","PSOR52",119,0)
 ;;PSOX("CLERK CODE");;0;;7
"RTN","PSOR52",120,0)
 ;;PSOX("COST");;0;;11
"RTN","PSOR52",121,0)
 ;;PSOSITE;;0;;9
"RTN","PSOR52",122,0)
 ;;PSOX("LOGIN DATE");;0;;8
"RTN","PSOR52",123,0)
 ;;PSOX("FILL DATE");;0;;1
"RTN","PSOR52",124,0)
 ;;PSOX("PHARMACIST");;0;;5
"RTN","PSOR52",125,0)
 ;;PSOX("LOT #");;0;;6
"RTN","PSOR52",126,0)
 ;;PSOX("DISPENSED DATE");;0;;19
"RTN","PSOR52",127,0)
 ;;PSOX("NDC");;1;;3
"RTN","PSOR52",128,0)
 ;;PSOX("DAW");;EPH;;1
"RTN","PSOR52",129,0)
 ;;PSOX("MANUFACTURER");;0;;14
"RTN","PSOR52",130,0)
 ;;PSOX("EXPIRATION DATE");;0;;15
"RTN","PSOR52",131,0)
 ;;PSOX("GENERIC PROVIDER");;1;;1
"RTN","PSOR52",132,0)
 ;;PSOX("RELEASED DATE/TIME");;0;;18
"RTN","PSOREJP0")
0^3^B65585833
"RTN","PSOREJP0",1,0)
PSOREJP0 ;BIRM/MFR - Third Party Rejects Processing Screen ;04/28/05
"RTN","PSOREJP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260**;DEC 1997;Build 84
"RTN","PSOREJP0",3,0)
 ;
"RTN","PSOREJP0",4,0)
 N PSOREJST,PSORJSRT,PSORJASC,PSOSTFLT,PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT,PSOINGRP
"RTN","PSOREJP0",5,0)
 N INSLN,HIGHLN,LASTLN
"RTN","PSOREJP0",6,0)
 ;
"RTN","PSOREJP0",7,0)
 ; - Division/Site selection
"RTN","PSOREJP0",8,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST,$$GET1^DIQ(59,+$G(PSOSITE),.01)) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP0",9,0)
 ;
"RTN","PSOREJP0",10,0)
 ; - Initializing global variables
"RTN","PSOREJP0",11,0)
 S PSORJSRT="PA",PSORJASC=1,PSOSTFLT="U",(PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT)="ALL"
"RTN","PSOREJP0",12,0)
 S PSOINGRP=0
"RTN","PSOREJP0",13,0)
 ;
"RTN","PSOREJP0",14,0)
 D LST("W")
"RTN","PSOREJP0",15,0)
 G EXIT
"RTN","PSOREJP0",16,0)
 ;
"RTN","PSOREJP0",17,0)
LST(PSOMENU) ; - Invokes Listmanager
"RTN","PSOREJP0",18,0)
 W !,"Please wait..."
"RTN","PSOREJP0",19,0)
 I PSOMENU="W" D EN^VALM("PSO REJECTS WORKLIST")
"RTN","PSOREJP0",20,0)
 I PSOMENU="VP" D EN^VALM("PSO REJECTS VIEW/PROCESS")
"RTN","PSOREJP0",21,0)
 D FULL^VALM1
"RTN","PSOREJP0",22,0)
 Q
"RTN","PSOREJP0",23,0)
 ;
"RTN","PSOREJP0",24,0)
HDR      ; - Header code
"RTN","PSOREJP0",25,0)
 N LINE1,LINE2,LINE3
"RTN","PSOREJP0",26,0)
 S LINE1=$$SITES() I $L(LINE1)>80 S $E(LINE1,78,999)="..."
"RTN","PSOREJP0",27,0)
 ;
"RTN","PSOREJP0",28,0)
 S LINE2="Selection : ALL "_$S(PSOSTFLT="U":"UNRESOLVED ",PSOSTFLT="R":"RESOLVED ",1:"")_"REJECTS"
"RTN","PSOREJP0",29,0)
 I $G(PSOPTFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("P")
"RTN","PSOREJP0",30,0)
 I $G(PSODRFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("D")
"RTN","PSOREJP0",31,0)
 I $G(PSOINFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("I")
"RTN","PSOREJP0",32,0)
 I $G(PSOINGRP) S LINE2=LINE2_" GROUPED BY INSURANCE"
"RTN","PSOREJP0",33,0)
 S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2
"RTN","PSOREJP0",34,0)
 I PSOMENU="VP" D
"RTN","PSOREJP0",35,0)
 . I $G(PSORXFLT) S LINE3="Rx#       : "_$$NAME("R")
"RTN","PSOREJP0",36,0)
 . E  D
"RTN","PSOREJP0",37,0)
 . . S LINE3="Date Range: "_$$FMTE^XLFDT(+PSODTRNG,2)
"RTN","PSOREJP0",38,0)
 . . I +PSODTRNG'=$P(PSODTRNG,"^",2) S LINE3=LINE3_" THRU "_$$FMTE^XLFDT($P(PSODTRNG,"^",2),2)
"RTN","PSOREJP0",39,0)
 . S VALMHDR(3)=LINE3
"RTN","PSOREJP0",40,0)
 ;
"RTN","PSOREJP0",41,0)
 D SETHDR()
"RTN","PSOREJP0",42,0)
 Q
"RTN","PSOREJP0",43,0)
 ;
"RTN","PSOREJP0",44,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOREJP0",45,0)
 N HDR,ORD
"RTN","PSOREJP0",46,0)
 ;
"RTN","PSOREJP0",47,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,18)="PATIENT(ID)",$E(HDR,43)="DRUG",$E(HDR,64)="REASON"
"RTN","PSOREJP0",48,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,$S(PSOMENU="W":4,1:5))
"RTN","PSOREJP0",49,0)
 S ORD=$S(PSORJASC=1:"[^]",1:"[v]")
"RTN","PSOREJP0",50,0)
 S:PSORJSRT="RX" POS=9 S:PSORJSRT="PA" POS=30 S:PSORJSRT="DR" POS=48 S:PSORJSRT="RE" POS=71
"RTN","PSOREJP0",51,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,$S(PSOMENU="W":4,1:5))
"RTN","PSOREJP0",52,0)
 Q
"RTN","PSOREJP0",53,0)
 ;
"RTN","PSOREJP0",54,0)
INIT ; - Populates the Body section for ListMan
"RTN","PSOREJP0",55,0)
 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",56,0)
 D SETSORT(PSORJSRT),SETLINE
"RTN","PSOREJP0",57,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOREJP0",58,0)
 Q
"RTN","PSOREJP0",59,0)
 ;
"RTN","PSOREJP0",60,0)
SETLINE ; - Sets the line to be displayed in ListMan
"RTN","PSOREJP0",61,0)
 N INS,SUB,SEQ,LINE,Z,I,X,X1,X2
"RTN","PSOREJP0",62,0)
 I '$D(^TMP("PSOREJSR",$J)) D  Q
"RTN","PSOREJP0",63,0)
 . F I=1:1:7 S ^TMP("PSOREJP0",$J,I,0)=""
"RTN","PSOREJP0",64,0)
 . S ^TMP("PSOREJP0",$J,8,0)="               No Clinical Third Party Payer Rejects found."
"RTN","PSOREJP0",65,0)
 . S VALMCNT=1
"RTN","PSOREJP0",66,0)
 ;
"RTN","PSOREJP0",67,0)
 F I=1:1:$G(LASTLN) D RESTORE^VALM10(I)
"RTN","PSOREJP0",68,0)
 K INSLN,HIGHLN
"RTN","PSOREJP0",69,0)
 ;
"RTN","PSOREJP0",70,0)
 S (INS,SUB)="",LINE=0 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",71,0)
 F  S INS=$O(^TMP("PSOREJSR",$J,INS)) Q:INS=""  D
"RTN","PSOREJP0",72,0)
 . I INS'="<NULL>" D
"RTN","PSOREJP0",73,0)
 . . D GROUP(INS,.LINE)
"RTN","PSOREJP0",74,0)
 . F  S SUB=$O(^TMP("PSOREJSR",$J,INS,SUB),PSORJASC) Q:SUB=""  D
"RTN","PSOREJP0",75,0)
 . . S Z=$G(^TMP("PSOREJSR",$J,INS,SUB))
"RTN","PSOREJP0",76,0)
 . . S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOREJP0",77,0)
 . . S $E(X1,5)=$P(Z,"^",3),$E(X1,18)=$P(Z,"^",4),$E(X1,43)=$P(Z,"^",5),$E(X1,64)=$P(Z,"^",6)
"RTN","PSOREJP0",78,0)
 . . S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X1,HIGHLN(LINE)=""
"RTN","PSOREJP0",79,0)
 . . S X2="",$E(X2,5)="Payer Message: "_$P(Z,"^",7)
"RTN","PSOREJP0",80,0)
 . . S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X2
"RTN","PSOREJP0",81,0)
 . . S ^TMP("PSOREJP0",$J,SEQ,"RX")=$P(Z,"^",1,2)
"RTN","PSOREJP0",82,0)
 ;
"RTN","PSOREJP0",83,0)
 I LINE>$G(LASTLN) D
"RTN","PSOREJP0",84,0)
 . F I=($G(LASTLN)+1):1:LINE D SAVE^VALM10(I)
"RTN","PSOREJP0",85,0)
 . S LASTLN=LINE
"RTN","PSOREJP0",86,0)
 ;
"RTN","PSOREJP0",87,0)
 ; - Highlighting the prescription/insurance line
"RTN","PSOREJP0",88,0)
 F LN=1:1:LINE D
"RTN","PSOREJP0",89,0)
 . I $D(HIGHLN(LN)) D  Q
"RTN","PSOREJP0",90,0)
 . . D CNTRL^VALM10(LN,1,80,IOINHI,IOINORM)
"RTN","PSOREJP0",91,0)
 . . D CNTRL^VALM10(LN,64,3,IOUON,IOINORM)
"RTN","PSOREJP0",92,0)
 . . D CNTRL^VALM10(LN,67,80,IOINHI,IOINORM)
"RTN","PSOREJP0",93,0)
 . I $D(INSLN(LN)) D
"RTN","PSOREJP0",94,0)
 . . S LBL=INSLN(LN),POS=41-($L(LBL)/2+.5\1)
"RTN","PSOREJP0",95,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOREJP0",96,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IOINORM)
"RTN","PSOREJP0",97,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),81-POS-$L(LBL),IOUON_IOINHI,IOINORM)
"RTN","PSOREJP0",98,0)
 ;
"RTN","PSOREJP0",99,0)
 S VALMCNT=+$G(LINE)
"RTN","PSOREJP0",100,0)
 Q
"RTN","PSOREJP0",101,0)
 ;
"RTN","PSOREJP0",102,0)
GROUP(LBL,LINE) ; Sets an insurance delimiter line
"RTN","PSOREJP0",103,0)
 N X,POS
"RTN","PSOREJP0",104,0)
 S POS=41-($L(LBL)/2+.5\1)
"RTN","PSOREJP0",105,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOREJP0",106,0)
 S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X,INSLN(LINE)=LBL
"RTN","PSOREJP0",107,0)
 Q
"RTN","PSOREJP0",108,0)
 ;
"RTN","PSOREJP0",109,0)
SETSORT(FIELD) ; - Sets the data sorted by the FIELD specified
"RTN","PSOREJP0",110,0)
 N RX,REJ,STS,DAT
"RTN","PSOREJP0",111,0)
 K ^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",112,0)
 ;
"RTN","PSOREJP0",113,0)
 ; - Worklist
"RTN","PSOREJP0",114,0)
 I PSOMENU="W" D
"RTN","PSOREJP0",115,0)
 . S RX=0 F  S RX=$O(^PSRX("REJSTS",0,RX)) Q:'RX  D
"RTN","PSOREJP0",116,0)
 . . S REJ=0 F  S REJ=$O(^PSRX("REJSTS",0,RX,REJ)) Q:'REJ  D
"RTN","PSOREJP0",117,0)
 . . . D SETTMP(RX,REJ,FIELD)
"RTN","PSOREJP0",118,0)
 ;
"RTN","PSOREJP0",119,0)
 ; - View/Process
"RTN","PSOREJP0",120,0)
 I PSOMENU="VP" D
"RTN","PSOREJP0",121,0)
 . I $G(PSORXFLT)'="ALL" D  Q
"RTN","PSOREJP0",122,0)
 . . S REJ=0 F  S REJ=$O(^PSRX(+PSORXFLT,"REJ",REJ)) Q:'REJ  D
"RTN","PSOREJP0",123,0)
 . . . I $$FLTSTS(+PSORXFLT,REJ) Q
"RTN","PSOREJP0",124,0)
 . . . D SETTMP(+PSORXFLT,REJ,FIELD)
"RTN","PSOREJP0",125,0)
 . S DAT=$P(PSODTRNG,"^")-0.0000001,(RX,REJ)=0
"RTN","PSOREJP0",126,0)
 . F  S DAT=$O(^PSRX("REJDAT",DAT)) Q:'DAT!(DAT>$$ENDT())  D
"RTN","PSOREJP0",127,0)
 . . F  S RX=$O(^PSRX("REJDAT",DAT,RX)) Q:'RX  D
"RTN","PSOREJP0",128,0)
 . . . I $$FILTER(RX) Q
"RTN","PSOREJP0",129,0)
 . . . F  S REJ=$O(^PSRX("REJDAT",DAT,RX,REJ)) Q:'REJ  D
"RTN","PSOREJP0",130,0)
 . . . . I $$FLTSTS(RX,REJ) Q
"RTN","PSOREJP0",131,0)
 . . . . D SETTMP(RX,REJ,FIELD)
"RTN","PSOREJP0",132,0)
 Q
"RTN","PSOREJP0",133,0)
 ;
"RTN","PSOREJP0",134,0)
SETTMP(RX,REJ,FIELD) ; - Sets ^TMP global that will be displayed in the body section
"RTN","PSOREJP0",135,0)
 N REJLST,FILL,CODE,RXNUM,PTNAME,DRNAME,MSG,REASON,MSG,X,Z,SORT,I,INS
"RTN","PSOREJP0",136,0)
 I $G(PSORXFLT)="ALL",$$CLOSED^PSOREJP1(RX,REJ),$$REOPN^PSOREJP1(RX,REJ) Q
"RTN","PSOREJP0",137,0)
 S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJP0",138,0)
 I '$$DIV(RX,FILL) Q
"RTN","PSOREJP0",139,0)
 K REJLST D GET^PSOREJU2(RX,FILL,.REJLST,,1) I '$D(REJLST) Q
"RTN","PSOREJP0",140,0)
 I $$FILTER(,REJLST(REJ,"INSURANCE NAME")) Q
"RTN","PSOREJP0",141,0)
 S PTNAME=$$PTNAME(RX)
"RTN","PSOREJP0",142,0)
 S DRNAME=$$GET1^DIQ(52,RX,6)
"RTN","PSOREJP0",143,0)
 S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOREJP0",144,0)
 S CODE=$G(REJLST(REJ,"CODE"))
"RTN","PSOREJP0",145,0)
 S MSG=$G(REJLST(REJ,"PAYER MESSAGE")) I $L(MSG)>60 S MSG=$E(MSG,1,58)_"..."
"RTN","PSOREJP0",146,0)
 S REASON=$S(CODE=88:"DUR:"_$G(REJLST(REJ,"REASON")),1:"79 :REFILL TOO SOON")
"RTN","PSOREJP0",147,0)
 S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=REJ,$P(Z,"^",3)=RXNUM,$P(Z,"^",4)=PTNAME
"RTN","PSOREJP0",148,0)
 S $P(Z,"^",5)=$E(DRNAME,1,20),$P(Z,"^",6)=$E(REASON,1,17),$P(Z,"^",7)=MSG
"RTN","PSOREJP0",149,0)
 S SORT=$S(FIELD="PA":PTNAME,FIELD="DR":DRNAME,FIELD="RX":RXNUM_" ",1:REASON)_RX_REJ
"RTN","PSOREJP0",150,0)
 S INS="<NULL>" I $G(PSOINGRP) S INS=REJLST(REJ,"INSURANCE NAME") S:INS="" INS="***UNKNOWN***"
"RTN","PSOREJP0",151,0)
 S ^TMP("PSOREJSR",$J,INS,SORT)=Z
"RTN","PSOREJP0",152,0)
 Q
"RTN","PSOREJP0",153,0)
 ;
"RTN","PSOREJP0",154,0)
PAT ; - Sort by Patient
"RTN","PSOREJP0",155,0)
 D SORT("PA")
"RTN","PSOREJP0",156,0)
 Q
"RTN","PSOREJP0",157,0)
DRG ; - Sort by Drug
"RTN","PSOREJP0",158,0)
 D SORT("DR")
"RTN","PSOREJP0",159,0)
 Q
"RTN","PSOREJP0",160,0)
RX ; - Sort by Rx
"RTN","PSOREJP0",161,0)
 D SORT("RX")
"RTN","PSOREJP0",162,0)
 Q
"RTN","PSOREJP0",163,0)
REA ; - Sort by Reason
"RTN","PSOREJP0",164,0)
 D SORT("RE")
"RTN","PSOREJP0",165,0)
 Q
"RTN","PSOREJP0",166,0)
SORT(FIELD) ; - Sort entries by FIELD
"RTN","PSOREJP0",167,0)
 I PSORJSRT=FIELD S PSORJASC=$S(PSORJASC=1:-1,1:1)
"RTN","PSOREJP0",168,0)
 E  S PSORJSRT=FIELD,PSORJASC=1
"RTN","PSOREJP0",169,0)
 D REF
"RTN","PSOREJP0",170,0)
 Q
"RTN","PSOREJP0",171,0)
 ;
"RTN","PSOREJP0",172,0)
REF ; - Screen Refresh
"RTN","PSOREJP0",173,0)
 W ?52,"Please wait..." D INIT S VALMBCK="R"
"RTN","PSOREJP0",174,0)
 Q
"RTN","PSOREJP0",175,0)
GI ; - Group by Insurance
"RTN","PSOREJP0",176,0)
 W ?52,"Please wait..." S PSOINGRP=$S($G(PSOINGRP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOREJP0",177,0)
 Q
"RTN","PSOREJP0",178,0)
 ;
"RTN","PSOREJP0",179,0)
SEL ; - Process selection of one entry
"RTN","PSOREJP0",180,0)
 N PSOSEL,XQORM,Z,RX,REJ,PSOCHNG
"RTN","PSOREJP0",181,0)
 S PSOSEL=+$P($P(Y(1),"^",4),"=",2) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",182,0)
 S Z=$G(^TMP("PSOREJP0",$J,PSOSEL,"RX"))
"RTN","PSOREJP0",183,0)
 S RX=$P(Z,"^"),REJ=$P(Z,"^",2) I 'RX!'REJ S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",184,0)
 S PSOCHNG=0 D EN^PSOREJP1(RX,REJ,.PSOCHNG) I $G(PSOCHNG) D REF
"RTN","PSOREJP0",185,0)
 Q
"RTN","PSOREJP0",186,0)
 ;
"RTN","PSOREJP0",187,0)
EXIT ;
"RTN","PSOREJP0",188,0)
 K ^TMP("PSOREJP0",$J),^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",189,0)
 Q
"RTN","PSOREJP0",190,0)
 ;
"RTN","PSOREJP0",191,0)
HELP Q
"RTN","PSOREJP0",192,0)
 ;
"RTN","PSOREJP0",193,0)
SITES() ; - Returns the list of sites along with their NCPDP #s
"RTN","PSOREJP0",194,0)
 N CNT,SITE,SITES,NAME
"RTN","PSOREJP0",195,0)
 I '$D(PSOREJST) Q ""
"RTN","PSOREJP0",196,0)
 I $G(PSOREJST)="ALL" Q "Divisions : ALL"
"RTN","PSOREJP0",197,0)
 S SITE=0 F  S SITE=$O(PSOREJST(SITE)) Q:'SITE  D
"RTN","PSOREJP0",198,0)
 . S NAME=$$GET1^DIQ(59,SITE,.01)
"RTN","PSOREJP0",199,0)
 . S SITES=$G(SITES)_", "_NAME
"RTN","PSOREJP0",200,0)
 S $E(SITES,1,2)="",SITES="Division"_$S($L(SITES,",")>1:"s",1:" ")_" : "_SITES
"RTN","PSOREJP0",201,0)
 Q SITES
"RTN","PSOREJP0",202,0)
 ;
"RTN","PSOREJP0",203,0)
DIV(RX,FILL) ; - Check if the Division for the Prescription/Fill was selected by the user
"RTN","PSOREJP0",204,0)
 ;
"RTN","PSOREJP0",205,0)
 I $G(PSOREJST)="ALL" Q 1
"RTN","PSOREJP0",206,0)
 I $D(PSOREJST($$RXSITE^PSOBPSUT(RX,FILL))) Q 1
"RTN","PSOREJP0",207,0)
 Q 0
"RTN","PSOREJP0",208,0)
 ;
"RTN","PSOREJP0",209,0)
PTNAME(RX) ; - Returns header displayable - Patient Name (Last 4 SSN)
"RTN","PSOREJP0",210,0)
 N DFN,VADM,PTNAME
"RTN","PSOREJP0",211,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT
"RTN","PSOREJP0",212,0)
 S PTNAME=$E($G(VADM(1)),1,18)_"("_$P($P($G(VADM(2)),"^",2),"-",3)_")"
"RTN","PSOREJP0",213,0)
 Q PTNAME
"RTN","PSOREJP0",214,0)
 ;
"RTN","PSOREJP0",215,0)
FILTER(RX,INS) ; - Filter entries based on user's selection
"RTN","PSOREJP0",216,0)
 N FILTER,NAME
"RTN","PSOREJP0",217,0)
 S FILTER=1
"RTN","PSOREJP0",218,0)
 I $G(PSOPTFLT)'="ALL",$D(RX),'$D(PSOPTFLT($$GET1^DIQ(52,RX,2,"I"))) Q FILTER
"RTN","PSOREJP0",219,0)
 I $G(PSODRFLT)'="ALL",$D(RX),'$D(PSODRFLT($$GET1^DIQ(52,RX,6,"I"))) Q FILTER
"RTN","PSOREJP0",220,0)
 I $G(PSOINFLT)'="ALL",$D(INS) D  Q FILTER
"RTN","PSOREJP0",221,0)
 . S NAME="" F  S NAME=$O(PSOINFLT(NAME)) Q:NAME=""  I $$UP^XLFSTR(INS)[$$UP^XLFSTR(NAME) S FILTER=0 Q
"RTN","PSOREJP0",222,0)
 Q 0
"RTN","PSOREJP0",223,0)
 ;
"RTN","PSOREJP0",224,0)
FLTSTS(RX,REJ) ; - Filter for the Reject Status  
"RTN","PSOREJP0",225,0)
 N STS
"RTN","PSOREJP0",226,0)
 S STS=$$GET1^DIQ(52.25,REJ_","_RX,9,"I")
"RTN","PSOREJP0",227,0)
 I PSOSTFLT="U",STS=1 Q 1
"RTN","PSOREJP0",228,0)
 I PSOSTFLT="R",STS=0 Q 1
"RTN","PSOREJP0",229,0)
 Q 0
"RTN","PSOREJP0",230,0)
 ;
"RTN","PSOREJP0",231,0)
NAME(TYPE) ; - Returns the name if ONE was selected or "MULTIPLE ..."
"RTN","PSOREJP0",232,0)
 N I,CNT
"RTN","PSOREJP0",233,0)
 ;
"RTN","PSOREJP0",234,0)
 I TYPE="P",$O(PSOPTFLT($O(PSOPTFLT(""))))="" Q $$GET1^DIQ(2,$O(PSOPTFLT("")),.01)
"RTN","PSOREJP0",235,0)
 I TYPE="D",$O(PSODRFLT($O(PSODRFLT(""))))="" Q $$GET1^DIQ(50,$O(PSODRFLT("")),.01)
"RTN","PSOREJP0",236,0)
 I TYPE="I",$O(PSOINFLT($O(PSOINFLT(""))))="" Q $O(PSOINFLT(""))
"RTN","PSOREJP0",237,0)
 I TYPE="R" Q $$GET1^DIQ(52,PSORXFLT,.01)
"RTN","PSOREJP0",238,0)
 Q "MULTIPLE "_$S(TYPE="P":"PATIENTS",TYPE="D":"DRUGS",1:"INSURANCE COMPANIES")
"RTN","PSOREJP0",239,0)
 ;
"RTN","PSOREJP0",240,0)
ENDT() ; Returns the upper limit for the date range
"RTN","PSOREJP0",241,0)
 N ENDT
"RTN","PSOREJP0",242,0)
 S ENDT=$P(PSODTRNG,"^",2)
"RTN","PSOREJP0",243,0)
 I '$E(ENDT,4,7) Q (ENDT+10000)
"RTN","PSOREJP0",244,0)
 I '$E(ENDT,6,7) Q (ENDT+100)
"RTN","PSOREJP0",245,0)
 I $P(ENDT,"^",2) Q (ENDT+0.0000001)
"RTN","PSOREJP0",246,0)
 Q (ENDT+.25)
"RTN","PSOREJP1")
0^6^B80456147
"RTN","PSOREJP1",1,0)
PSOREJP1 ;BIRM/MFR - Third Party Reject Display Screen ;04/29/05
"RTN","PSOREJP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260**;DEC 1997;Build 84
"RTN","PSOREJP1",3,0)
 ;Reference to File 9002313.93 - BPS NCPDP REJECT CODES supported by IA 4720
"RTN","PSOREJP1",4,0)
 ;Reference to ^PS(59.7 supported by IA 694
"RTN","PSOREJP1",5,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOREJP1",6,0)
 ;
"RTN","PSOREJP1",7,0)
EN(RX,REJ,CHANGE) ; Entry point
"RTN","PSOREJP1",8,0)
 ;
"RTN","PSOREJP1",9,0)
 ; - DO NOT change the IF logic below as both of them might get executed (intentional)
"RTN","PSOREJP1",10,0)
 N FILL,LASTLN
"RTN","PSOREJP1",11,0)
 S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJP1",12,0)
 I $$CLOSED(RX,REJ) D EN^VALM("PSO REJECT DISPLAY - RESOLVED")
"RTN","PSOREJP1",13,0)
 I '$$CLOSED(RX,REJ) D EN^VALM("PSO REJECT DISPLAY")
"RTN","PSOREJP1",14,0)
 D FULL^VALM1
"RTN","PSOREJP1",15,0)
 Q
"RTN","PSOREJP1",16,0)
 ;
"RTN","PSOREJP1",17,0)
HDR      ; - Builds the Header section
"RTN","PSOREJP1",18,0)
 N LINE1,LINE2,X
"RTN","PSOREJP1",19,0)
 S VALMHDR(1)=$$DVINFO^PSOREJU2(RX,FILL,1),VALMHDR(2)=$$PTINFO^PSOREJU2(RX,1)
"RTN","PSOREJP1",20,0)
 S VALMHDR(3)=$$RXINFO(RX,FILL,1),VALMHDR(4)=$$RXINFO(RX,FILL,2)
"RTN","PSOREJP1",21,0)
 Q
"RTN","PSOREJP1",22,0)
 ;
"RTN","PSOREJP1",23,0)
INIT ; Builds the Body section
"RTN","PSOREJP1",24,0)
 N DATA,LINE
"RTN","PSOREJP1",25,0)
 F I=1:1:$G(LASTLN) D RESTORE^VALM10(I)
"RTN","PSOREJP1",26,0)
 K ^TMP("PSOREJP1",$J) S VALMCNT=0,LINE=0
"RTN","PSOREJP1",27,0)
 D GET^PSOREJU2(RX,FILL,.DATA,REJ,1)
"RTN","PSOREJP1",28,0)
 D REJ                   ; Display the REJECT Information
"RTN","PSOREJP1",29,0)
 D OTH                   ; Display the Other Rejects Information
"RTN","PSOREJP1",30,0)
 D COM^PSOREJP3          ; Display the Comment
"RTN","PSOREJP1",31,0)
 D INS                   ; Display the Insurance Information
"RTN","PSOREJP1",32,0)
 D CLS                   ; Display the Resolution Information
"RTN","PSOREJP1",33,0)
 S VALMCNT=LINE
"RTN","PSOREJP1",34,0)
 Q
"RTN","PSOREJP1",35,0)
 ;
"RTN","PSOREJP1",36,0)
REJ ; - DUR Information
"RTN","PSOREJP1",37,0)
 N TYPE,PFLDT
"RTN","PSOREJP1",38,0)
 D SETLN("REJECT Information",1,1)
"RTN","PSOREJP1",39,0)
 S TYPE=$S($G(DATA(REJ,"CODE"))=79:"79 - REFILL TOO SOON",1:"88 - DUR REJECT")
"RTN","PSOREJP1",40,0)
 D SETLN("Reject Type    : "_TYPE_" received on "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME"))),,,18)
"RTN","PSOREJP1",41,0)
 D SETLN("Reject Status  : "_$G(DATA(REJ,"STATUS")),,,18)
"RTN","PSOREJP1",42,0)
 D SET("PAYER MESSAGE",63)
"RTN","PSOREJP1",43,0)
 D SET("REASON",63)
"RTN","PSOREJP1",44,0)
 S PFLDT=$$FMTE^XLFDT($G(DATA(REJ,"PLAN PREVIOUS FILL DATE")))
"RTN","PSOREJP1",45,0)
 D SET("DUR TEXT",63,$S(PFLDT="":1,1:0))
"RTN","PSOREJP1",46,0)
 I PFLDT'="" D SETLN("Last Fill Date : "_PFLDT_" (from payer)",,1,18)
"RTN","PSOREJP1",47,0)
 Q
"RTN","PSOREJP1",48,0)
 ;
"RTN","PSOREJP1",49,0)
OTH ; - Other Rejects Information
"RTN","PSOREJP1",50,0)
 N LST,I,RJC,J,LAST
"RTN","PSOREJP1",51,0)
 S LST=$G(DATA(REJ,"OTHER REJECTS")) I LST="" Q
"RTN","PSOREJP1",52,0)
 D SETLN()
"RTN","PSOREJP1",53,0)
 D SETLN("OTHER REJECTS",1,1)
"RTN","PSOREJP1",54,0)
 F I=1:1:$L(LST,",") S RJC=$P(LST,",",I) D
"RTN","PSOREJP1",55,0)
 . S LAST=1 F J=(I+1):1:$L(LST,",") I $P(LST,",",J)'="" S LAST=0 Q
"RTN","PSOREJP1",56,0)
 . I RJC'="" D SETLN(RJC_" - "_$$EXP(RJC),,$S(LAST:1,1:0),6)
"RTN","PSOREJP1",57,0)
 Q
"RTN","PSOREJP1",58,0)
 ;
"RTN","PSOREJP1",59,0)
INS ; - Insurance Information
"RTN","PSOREJP1",60,0)
 D SETLN()
"RTN","PSOREJP1",61,0)
 D SETLN("INSURANCE Information",1,1)
"RTN","PSOREJP1",62,0)
 D SETLN("Insurance      : "_$G(DATA(REJ,"INSURANCE NAME")),,,18)
"RTN","PSOREJP1",63,0)
 D SETLN("Contact        : "_$G(DATA(REJ,"PLAN CONTACT")),,,18)
"RTN","PSOREJP1",64,0)
 D SETLN("Group Name     : "_$G(DATA(REJ,"GROUP NAME")),,,18)
"RTN","PSOREJP1",65,0)
 D SETLN("Group Number   : "_$G(DATA(REJ,"GROUP NUMBER")),,,18)
"RTN","PSOREJP1",66,0)
 D SETLN("Cardholder ID  : "_$G(DATA(REJ,"CARDHOLDER ID")),,1,18)
"RTN","PSOREJP1",67,0)
 Q
"RTN","PSOREJP1",68,0)
 ;
"RTN","PSOREJP1",69,0)
CLS ; - Resolution Information
"RTN","PSOREJP1",70,0)
 N X
"RTN","PSOREJP1",71,0)
 I '$$CLOSED(RX,REJ) Q
"RTN","PSOREJP1",72,0)
 D SETLN()
"RTN","PSOREJP1",73,0)
 D SETLN("RESOLUTION Information",1,1)
"RTN","PSOREJP1",74,0)
 D SETLN("Resolved By    : "_$G(DATA(REJ,"CLOSED BY")),,,18)
"RTN","PSOREJP1",75,0)
 D SETLN("Date/Time      : "_$G(DATA(REJ,"CLOSED DATE/TIME")),,,18)
"RTN","PSOREJP1",76,0)
 I $G(DATA(REJ,"CLOSE COMMENTS"))'="" D SET("CLOSE COMMENTS",63)
"RTN","PSOREJP1",77,0)
 I $G(DATA(REJ,"COD1"))'="" D SETLN("Reason for Svc : "_$$OVRX^PSOREJU1(1,$G(DATA(REJ,"COD1"))),,,18)
"RTN","PSOREJP1",78,0)
 I $G(DATA(REJ,"COD2"))'="" D SETLN("Profes. Svc    : "_$$OVRX^PSOREJU1(2,$G(DATA(REJ,"COD2"))),,,18)
"RTN","PSOREJP1",79,0)
 I $G(DATA(REJ,"COD3"))'="" D SETLN("Result of Svc  : "_$$OVRX^PSOREJU1(3,$G(DATA(REJ,"COD3"))),,,18)
"RTN","PSOREJP1",80,0)
 I $G(DATA(REJ,"CLA CODE"))'="" D
"RTN","PSOREJP1",81,0)
 . S X=$$GET1^DIQ(52.25,REJ_","_RX,24,"I")_" - "_(DATA(REJ,"CLA CODE"))
"RTN","PSOREJP1",82,0)
 . D SETLN("Clarific. Code : "_X,,,18)
"RTN","PSOREJP1",83,0)
 I $G(DATA(REJ,"PRIOR AUTH TYPE"))'="" D
"RTN","PSOREJP1",84,0)
 . S X=$$GET1^DIQ(52.25,REJ_","_RX,25,"I")_" - "_(DATA(REJ,"PRIOR AUTH TYPE"))
"RTN","PSOREJP1",85,0)
 . D SETLN("Prior Auth.Type: "_X,,,18),SETLN("Prior Auth. #  : "_DATA(REJ,"PRIOR AUTH NUMBER"),,,18)
"RTN","PSOREJP1",86,0)
 D SETLN("Reason         : "_$G(DATA(REJ,"CLOSE REASON")),,1,18)
"RTN","PSOREJP1",87,0)
 Q
"RTN","PSOREJP1",88,0)
 ;
"RTN","PSOREJP1",89,0)
 ;
"RTN","PSOREJP1",90,0)
SET(FIELD,L,UND) ; Sets the lines for fields that require text wrapping
"RTN","PSOREJP1",91,0)
 N TXT,T
"RTN","PSOREJP1",92,0)
 S TXT=DATA(REJ,FIELD) I $L(TXT)'>L D SETLN($$LABEL(FIELD)_TXT,,$S($G(UND):1,1:0),80-L) Q
"RTN","PSOREJP1",93,0)
 F I=1:1 Q:TXT=""  D
"RTN","PSOREJP1",94,0)
 . I I=1 D SETLN($$LABEL(FIELD)_$E(TXT,1,L),,,80-L) S TXT=$E(TXT,L+1,999) Q
"RTN","PSOREJP1",95,0)
 . S T="",$E(T,81-L)=$E(TXT,1,L) D SETLN(T,,$S($E(TXT,L+1,999)=""&$G(UND):1,1:0),80-L) S TXT=$E(TXT,L+1,999)
"RTN","PSOREJP1",96,0)
 Q
"RTN","PSOREJP1",97,0)
 ;
"RTN","PSOREJP1",98,0)
LABEL(FIELD) ; Sets the label for the field
"RTN","PSOREJP1",99,0)
 I FIELD="REASON" Q "Reason         : "
"RTN","PSOREJP1",100,0)
 I FIELD="PAYER MESSAGE" Q "Payer Message  : "
"RTN","PSOREJP1",101,0)
 I FIELD="DUR TEXT" Q "DUR Text       : "
"RTN","PSOREJP1",102,0)
 I FIELD="CLOSE COMMENTS" Q "Comments       : "
"RTN","PSOREJP1",103,0)
 Q ""
"RTN","PSOREJP1",104,0)
 ;
"RTN","PSOREJP1",105,0)
VIEW ; - Rx View hidden action
"RTN","PSOREJP1",106,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",107,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",108,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",109,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",110,0)
 ;
"RTN","PSOREJP1",111,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",112,0)
 DO
"RTN","PSOREJP1",113,0)
 . N PSOVDA,DA,PS
"RTN","PSOREJP1",114,0)
 . S (PSOVDA,DA)=RX,PS="REJECT"
"RTN","PSOREJP1",115,0)
 . N RX,REJ,FILL,LINE,TITLE D DP^PSORXVW
"RTN","PSOREJP1",116,0)
 ;
"RTN","PSOREJP1",117,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",118,0)
 Q
"RTN","PSOREJP1",119,0)
 ;
"RTN","PSOREJP1",120,0)
EDT ; - Rx Edit hidden action
"RTN","PSOREJP1",121,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",122,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",123,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",124,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",125,0)
 ;
"RTN","PSOREJP1",126,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",127,0)
 DO
"RTN","PSOREJP1",128,0)
 . N PSOSITE,ORN,PSOPAR,PSOLIST
"RTN","PSOREJP1",129,0)
 . S PSOSITE=$$RXSITE^PSOBPSUT(RX,FILL),ORN=RX
"RTN","PSOREJP1",130,0)
 . S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOLIST(1)=ORN_","
"RTN","PSOREJP1",131,0)
 . N RX,REJ,FILL,LINE,TITLE D EPH^PSORXEDT
"RTN","PSOREJP1",132,0)
 ;
"RTN","PSOREJP1",133,0)
 K VALMBCK I $$CLOSED(RX,REJ),$D(PSOSTFLT),PSOSTFLT="U" S CHANGE=1 Q
"RTN","PSOREJP1",134,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",135,0)
 Q
"RTN","PSOREJP1",136,0)
 ;
"RTN","PSOREJP1",137,0)
OVR ; - Override a REJECT action
"RTN","PSOREJP1",138,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",139,0)
 N COD1,COD2,COD3
"RTN","PSOREJP1",140,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",141,0)
 S COD1=$$OVRCOD^PSOREJU1(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" S VALMBCK="R" Q
"RTN","PSOREJP1",142,0)
 S COD2=$$OVRCOD^PSOREJU1(2) I COD2="^" S VALMBCK="R" Q
"RTN","PSOREJP1",143,0)
 S COD3=$$OVRCOD^PSOREJU1(3) I COD3="^" S VALMBCK="R" Q
"RTN","PSOREJP1",144,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3)
"RTN","PSOREJP1",145,0)
 D SEND(COD1,COD2,COD3)
"RTN","PSOREJP1",146,0)
 Q 
"RTN","PSOREJP1",147,0)
 ;
"RTN","PSOREJP1",148,0)
RES ; - Re-submit a claim action
"RTN","PSOREJP1",149,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",150,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",151,0)
 D SEND()
"RTN","PSOREJP1",152,0)
 Q
"RTN","PSOREJP1",153,0)
 ;
"RTN","PSOREJP1",154,0)
CLA ; - Submit Clarification Code
"RTN","PSOREJP1",155,0)
 N CLA
"RTN","PSOREJP1",156,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",157,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",158,0)
 S CLA=$$CLA^PSOREJU1() I CLA="^" S VALMBCK="R" Q
"RTN","PSOREJP1",159,0)
 W ! D SEND(,,,CLA)
"RTN","PSOREJP1",160,0)
 Q
"RTN","PSOREJP1",161,0)
 ;
"RTN","PSOREJP1",162,0)
PA ; - Submit Prior Authorization
"RTN","PSOREJP1",163,0)
 N PA
"RTN","PSOREJP1",164,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",165,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",166,0)
 S PA=$$PA^PSOREJU2() I PA="^" S VALMBCK="R" Q
"RTN","PSOREJP1",167,0)
 W ! D SEND(,,,,PA)
"RTN","PSOREJP1",168,0)
 Q
"RTN","PSOREJP1",169,0)
 ;
"RTN","PSOREJP1",170,0)
SEND(COD1,COD2,COD3,CLA,PA) ; - Sends Claim to ECME and closes Reject 
"RTN","PSOREJP1",171,0)
 N DIR,OVRC,RESP,ALTXT,COM
"RTN","PSOREJP1",172,0)
 S DIR(0)="Y",DIR("A")="     Confirm",DIR("B")="YES"
"RTN","PSOREJP1",173,0)
 S DIR("A",1)="     When you confirm, a new claim will be submitted for"
"RTN","PSOREJP1",174,0)
 S DIR("A",2)="     the prescription and this REJECT will be marked"
"RTN","PSOREJP1",175,0)
 S DIR("A",3)="     resolved."
"RTN","PSOREJP1",176,0)
 S DIR("A",4)=" "
"RTN","PSOREJP1",177,0)
 W ! D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP1",178,0)
 I $G(COD1)'="" S OVRC=$G(COD2)_"^"_$G(COD1)_"^"_$G(COD3)
"RTN","PSOREJP1",179,0)
 S ALTXT="REJECT WORKLIST"
"RTN","PSOREJP1",180,0)
 S:$G(OVRC)'="" ALTXT=ALTXT_"-DUR OVERRIDE CODES("_$G(COD1)_"/"_$G(COD2)_"/"_$G(COD3)_")"
"RTN","PSOREJP1",181,0)
 S:$G(CLA) ALTXT=ALTXT_"(CLARIF. CODE="_CLA_")"
"RTN","PSOREJP1",182,0)
 S:$G(PA) ALTXT=ALTXT_"(PRIOR AUTH.="_$TR(PA,"^","/")_")"
"RTN","PSOREJP1",183,0)
 D ECMESND^PSOBPSU1(RX,FILL,,"ED",$$GETNDC^PSONDCUT(RX,FILL),,,$G(OVRC),,.RESP,,ALTXT,$G(CLA),$G(PA))
"RTN","PSOREJP1",184,0)
 I $G(RESP) D  Q
"RTN","PSOREJP1",185,0)
 . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJP1",186,0)
 . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7) H 2
"RTN","PSOREJP1",187,0)
 ;
"RTN","PSOREJP1",188,0)
 I $$PTLBL^PSOREJP2(RX,FILL) D PRINT(RX,FILL)
"RTN","PSOREJP1",189,0)
 ;
"RTN","PSOREJP1",190,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP1",191,0)
 Q
"RTN","PSOREJP1",192,0)
 ;
"RTN","PSOREJP1",193,0)
MP ; - Patient Medication Profile
"RTN","PSOREJP1",194,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",195,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",196,0)
 N SITE,PATIENT
"RTN","PSOREJP1",197,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",198,0)
 S SITE=+$$RXSITE^PSOBPSUT(RX,FILL) S:$G(PSOSITE) SITE=PSOSITE
"RTN","PSOREJP1",199,0)
 S PATIENT=+$$GET1^DIQ(52,RX,2,"I")
"RTN","PSOREJP1",200,0)
 D LST^PSOPMP0(SITE,PATIENT) S VALMBCK="R"
"RTN","PSOREJP1",201,0)
 Q
"RTN","PSOREJP1",202,0)
 ;
"RTN","PSOREJP1",203,0)
EXIT ;
"RTN","PSOREJP1",204,0)
 K ^TMP("PSOREJP1",$J)
"RTN","PSOREJP1",205,0)
 Q
"RTN","PSOREJP1",206,0)
 ;
"RTN","PSOREJP1",207,0)
SETLN(TEXT,REV,UND,HIG) ; Sets a line to be displayed in the Body section
"RTN","PSOREJP1",208,0)
 N X
"RTN","PSOREJP1",209,0)
 S:$G(TEXT)="" $E(TEXT,80)=""
"RTN","PSOREJP1",210,0)
 S:$L(TEXT)>80 TEXT=$E(TEXT,1,80)
"RTN","PSOREJP1",211,0)
 S LINE=LINE+1,^TMP("PSOREJP1",$J,LINE,0)=$G(TEXT)
"RTN","PSOREJP1",212,0)
 ;
"RTN","PSOREJP1",213,0)
 I LINE>$G(LASTLN) D SAVE^VALM10(LINE) S LASTLN=LINE
"RTN","PSOREJP1",214,0)
 ;
"RTN","PSOREJP1",215,0)
 I $G(REV) D  Q
"RTN","PSOREJP1",216,0)
 . D CNTRL^VALM10(LINE,1,$L(TEXT),IORVON,IOINORM)
"RTN","PSOREJP1",217,0)
 . I $G(UND) D CNTRL^VALM10(LINE,$L(TEXT)+1,80,IOUON,IOINORM)
"RTN","PSOREJP1",218,0)
 I $G(UND) D CNTRL^VALM10(LINE,1,80,IOUON,IOINORM)
"RTN","PSOREJP1",219,0)
 I $G(HIG) D
"RTN","PSOREJP1",220,0)
 . D CNTRL^VALM10(LINE,HIG,80,IOINHI_$S($G(UND):IOUON,1:""),IOINORM)
"RTN","PSOREJP1",221,0)
 Q
"RTN","PSOREJP1",222,0)
HELP ;
"RTN","PSOREJP1",223,0)
 Q
"RTN","PSOREJP1",224,0)
 ;
"RTN","PSOREJP1",225,0)
RXINFO(RX,FILL,LINE) ; Returns header displayable Rx Information
"RTN","PSOREJP1",226,0)
 N TXT,RXINFO,LBL,CMOP,DRG
"RTN","PSOREJP1",227,0)
 I LINE=1 D
"RTN","PSOREJP1",228,0)
 . S RXINFO="Rx#      : "_$$GET1^DIQ(52,RX,.01)_"/"_FILL
"RTN","PSOREJP1",229,0)
 . S $E(RXINFO,30)="ECME#: "_$E(10000000+RX,2,8)
"RTN","PSOREJP1",230,0)
 . S $E(RXINFO,55)="Fill Date: "_$$FMTE^XLFDT($$RXFLDT^PSOBPSUT(RX,FILL))
"RTN","PSOREJP1",231,0)
 I LINE=2 D
"RTN","PSOREJP1",232,0)
 . S DRG=$$GET1^DIQ(52,RX,6,"I"),CMOP=$S($D(^PSDRUG("AQ",DRG)):1,1:0)
"RTN","PSOREJP1",233,0)
 . S RXINFO=$S(CMOP:"CMOP ",1:"")_"Drug",$E(RXINFO,10)=": "_$E($$GET1^DIQ(52,RX,6),1,43)
"RTN","PSOREJP1",234,0)
 . S $E(RXINFO,56)="NDC Code: "_$$GETNDC^PSONDCUT(RX,FILL)
"RTN","PSOREJP1",235,0)
 Q $G(RXINFO)
"RTN","PSOREJP1",236,0)
 ;
"RTN","PSOREJP1",237,0)
CLOSED(RX,REJ,MSG) ; Returns whether the REJECT is RESOLVED or NOT
"RTN","PSOREJP1",238,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,10,"I") D:$G(MSG)  Q 1
"RTN","PSOREJP1",239,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP1",240,0)
 Q 0
"RTN","PSOREJP1",241,0)
 ;
"RTN","PSOREJP1",242,0)
REOPN(RX,REJ) ; Returns whether the REJECT was RE-OPENED or NOT
"RTN","PSOREJP1",243,0)
 Q $S($$GET1^DIQ(52.25,REJ_","_RX,23)="":0,1:1)
"RTN","PSOREJP1",244,0)
 ;
"RTN","PSOREJP1",245,0)
EXP(CODE) ; - Returns the explanation field (.02) for a reject code
"RTN","PSOREJP1",246,0)
 ;  Input:  (r) CODE - .01 field (Code) value from file 9002313.93
"RTN","PSOREJP1",247,0)
 ; Output: .02 field (Explanation) value from file 9002313.93
"RTN","PSOREJP1",248,0)
 N DIC,X,Y
"RTN","PSOREJP1",249,0)
 S DIC=9002313.93,DIC(0)="Z",X=CODE D ^DIC
"RTN","PSOREJP1",250,0)
 Q $P($G(Y(0)),"^",2)
"RTN","PSOREJP1",251,0)
 ;
"RTN","PSOREJP1",252,0)
OUT(RX) ; - Supported call by outside PROTOCOLs to act on specific REJECTs
"RTN","PSOREJP1",253,0)
 N I,RFL,DATA,REJ,PSOBACK,VALMCNT
"RTN","PSOREJP1",254,0)
 S PSOBACK=1
"RTN","PSOREJP1",255,0)
 S (RFL,I)=0 F I=1:1 Q:'$D(^PSRX(RX,1,I))  S RFL=I
"RTN","PSOREJP1",256,0)
 S X=$$FIND^PSOREJUT(RX,RFL,.DATA) S REJ=$O(DATA(""))
"RTN","PSOREJP1",257,0)
 I '$G(REJ) S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP1",258,0)
 D EN(RX,REJ) S VALMBCK="R"
"RTN","PSOREJP1",259,0)
 Q
"RTN","PSOREJP1",260,0)
 ;
"RTN","PSOREJP1",261,0)
PRINT(RX,RFL) ; Print Label for specific Rx/Fill
"RTN","PSOREJP1",262,0)
 N PPL,PSOSITE,PSOPAR,PSOSYS,PSOLAP,PSOBARS,PSOBAR0,PSOBAR1,PSOIOS,PSOBFLAG
"RTN","PSOREJP1",263,0)
 N POP,DFN,PDUZ,RXFL
"RTN","PSOREJP1",264,0)
 ;
"RTN","PSOREJP1",265,0)
 S PSOSITE=$$RXSITE^PSOBPSUT(RX,RFL),PSOPAR=^PS(59,PSOSITE,1)
"RTN","PSOREJP1",266,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I"),PDUZ=DUZ,PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOREJP1",267,0)
 S PPL=RX I RFL S RXFL(RX)=RFL
"RTN","PSOREJP1",268,0)
 W ! S PSOBFLAG=1 D LBL^PSOLSET I $G(PSOQUIT) Q
"RTN","PSOREJP1",269,0)
 ;
"RTN","PSOREJP1",270,0)
 S IOP=PSOLAP D ^%ZIS,DQ^PSOLBL,^%ZISC
"RTN","PSOREJP1",271,0)
 Q
"RTN","PSOREJP2")
0^2^B62487288
"RTN","PSOREJP2",1,0)
PSOREJP2 ;BIRM/MFR - Third Party Rejects View/Process ;04/28/05
"RTN","PSOREJP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260**;DEC 1997;Build 84
"RTN","PSOREJP2",3,0)
 ;Reference to ^PSSLOCK supported by IA #2789
"RTN","PSOREJP2",4,0)
 ; 
"RTN","PSOREJP2",5,0)
 N PSORJSRT,PSOPTFLT,PSODRFLT,PSORXFLT,PSOBYFLD,PSOSTFLT,DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOREJP2",6,0)
 N PSOINFLT,PSODTRNG,PSOINGRP
"RTN","PSOREJP2",7,0)
 S PSORJASC=1,PSOINGRP=0
"RTN","PSOREJP2",8,0)
 ;
"RTN","PSOREJP2",9,0)
 ; - Division/Site selection
"RTN","PSOREJP2",10,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST,$$GET1^DIQ(59,+$G(PSOSITE),.01)) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP2",11,0)
 ;
"RTN","PSOREJP2",12,0)
 ; - Date range selection
"RTN","PSOREJP2",13,0)
 W ! S PSODTRNG=$$DTRNG("T-90","T") I PSODTRNG="^" G EXIT
"RTN","PSOREJP2",14,0)
 ;
"RTN","PSOREJP2",15,0)
SEL ; - Field Selection (Patient/Drug/Rx)
"RTN","PSOREJP2",16,0)
 S DIR(0)="S^P:PATIENT;D:DRUG;R:Rx;I:INSURANCE",DIR("B")="P"
"RTN","PSOREJP2",17,0)
 S DIR("A")="By (P)atient, (D)rug, (R)x or (I)nsurance" D ^DIR I $D(DIRUT) G EXIT
"RTN","PSOREJP2",18,0)
 S PSOBYFLD=Y,DIR("B")=""
"RTN","PSOREJP2",19,0)
 ;
"RTN","PSOREJP2",20,0)
 I PSOBYFLD="P" D  I $G(PSOPTFLT)="^" G SEL
"RTN","PSOREJP2",21,0)
 . S (PSODRFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="DR"
"RTN","PSOREJP2",22,0)
 . D SEL^PSOREJU1("PATIENT","^DPT(",.PSOPTFLT)
"RTN","PSOREJP2",23,0)
 ;
"RTN","PSOREJP2",24,0)
 I PSOBYFLD="D" D  I $G(PSODRFLT)="^" G SEL
"RTN","PSOREJP2",25,0)
 . S (PSOPTFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",26,0)
 . D SEL^PSOREJU1("DRUG","^PSDRUG(",.PSODRFLT)
"RTN","PSOREJP2",27,0)
 ;
"RTN","PSOREJP2",28,0)
 I PSOBYFLD="R" D  I $D(DUOUT)!$D(DTOUT)!'$G(PSORXFLT) G SEL
"RTN","PSOREJP2",29,0)
 . S (PSOPTFLT,PSODRFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",30,0)
 . N DIC,Y,X,OK K PSOSTFLT,PSORXFLT
"RTN","PSOREJP2",31,0)
 . S DIC=52,DIC(0)="QEZA",DIC("A")="PRESCRIPTION: "
"RTN","PSOREJP2",32,0)
 . F  W ! D ^DIC D  Q:$G(OK) 
"RTN","PSOREJP2",33,0)
 . . I $D(DUOUT)!$D(DTOUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",34,0)
 . . I '$O(^PSRX(+Y,"REJ",0)) D  Q
"RTN","PSOREJP2",35,0)
 . . . W !?40,"Prescription does not have rejects!",$C(7)
"RTN","PSOREJP2",36,0)
 . . S PSORXFLT=+Y,OK=1
"RTN","PSOREJP2",37,0)
 ;
"RTN","PSOREJP2",38,0)
 I PSOBYFLD="I" D  I $O(PSOINFLT(""))="" G SEL
"RTN","PSOREJP2",39,0)
 . S (PSOPTFLT,PSODRFLT,PSORXFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",40,0)
 . N DIR,Y,X,OK K PSOINFLT W !
"RTN","PSOREJP2",41,0)
 . S DIR("A",1)="Enter the whole or part of the Insurance Company"
"RTN","PSOREJP2",42,0)
 . S DIR("A",2)="name for which you want to view/process REJECTS."
"RTN","PSOREJP2",43,0)
 . S DIR("A",3)=""
"RTN","PSOREJP2",44,0)
 . S DIR(0)="FO^3:30",DIR("A")="  INSURANCE"
"RTN","PSOREJP2",45,0)
 . F  D ^DIR D  Q:$G(OK) 
"RTN","PSOREJP2",46,0)
 . . I $D(DIRUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",47,0)
 . . S PSOINFLT(X)="" K DIR("A") S DIR("A")="ANOTHER ONE"
"RTN","PSOREJP2",48,0)
 ;
"RTN","PSOREJP2",49,0)
 ; - Status Selection (UNRESOLVED or RESOLVED)
"RTN","PSOREJP2",50,0)
 I $G(PSOSTFLT)="" D  I $D(DIRUT) G EXIT
"RTN","PSOREJP2",51,0)
 . S DIR(0)="S^U:UNRESOLVED;R:RESOLVED;B:BOTH",DIR("B")="B"
"RTN","PSOREJP2",52,0)
 . S DIR("A")="(U)NRESOLVED, (R)RESOLVED or (B)OTH REJECT statuses" D ^DIR
"RTN","PSOREJP2",53,0)
 . S PSOSTFLT=Y
"RTN","PSOREJP2",54,0)
 ;
"RTN","PSOREJP2",55,0)
 D LST^PSOREJP0("VP")
"RTN","PSOREJP2",56,0)
 ;
"RTN","PSOREJP2",57,0)
EXIT Q
"RTN","PSOREJP2",58,0)
 ;
"RTN","PSOREJP2",59,0)
CLO      ; - Ignore a REJECT hidden action
"RTN","PSOREJP2",60,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",61,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",62,0)
 N DIR,COM
"RTN","PSOREJP2",63,0)
 D FULL^VALM1
"RTN","PSOREJP2",64,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",65,0)
 W !
"RTN","PSOREJP2",66,0)
 S COM=$$COM^PSOREJU1() I COM="^" S VALMBCK="R" Q
"RTN","PSOREJP2",67,0)
 W !
"RTN","PSOREJP2",68,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="NO"
"RTN","PSOREJP2",69,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked RESOLVED."
"RTN","PSOREJP2",70,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",71,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",72,0)
 W ?40,"[Closing..." D CLOSE^PSOREJUT(RX,FILL,REJ,DUZ,6,COM) W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",73,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",74,0)
 ;
"RTN","PSOREJP2",75,0)
 I $$PTLBL(RX,FILL) D PRINT^PSOREJP1(RX,FILL)
"RTN","PSOREJP2",76,0)
 ;
"RTN","PSOREJP2",77,0)
 Q
"RTN","PSOREJP2",78,0)
 ;
"RTN","PSOREJP2",79,0)
OPN ; - Re-open a Closed/Resolved Reject
"RTN","PSOREJP2",80,0)
 I '$$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",81,0)
 . S VALMSG="This Reject is NOT marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",82,0)
 N DIR,COM,REJDATA,NEWDATA,X
"RTN","PSOREJP2",83,0)
 D FULL^VALM1
"RTN","PSOREJP2",84,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",85,0)
 W !
"RTN","PSOREJP2",86,0)
 S DIR(0)="Y",DIR("A")="     Confirm",DIR("B")="NO"
"RTN","PSOREJP2",87,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked UNRESOLVED."
"RTN","PSOREJP2",88,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",89,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",90,0)
 ;
"RTN","PSOREJP2",91,0)
 W ?40,"[Re-opening..."
"RTN","PSOREJP2",92,0)
 K REJDATA D GET^PSOREJU2(RX,FILL,.REJDATA,REJ,1) D SETOPN^PSOREJU2(RX,REJ)
"RTN","PSOREJP2",93,0)
 K NEWDATA M NEWDATA=REJDATA(REJ) S NEWDATA("PHARMACIST")=DUZ
"RTN","PSOREJP2",94,0)
 D SAVE^PSOREJUT(RX,FILL,.NEWDATA)
"RTN","PSOREJP2",95,0)
 I $G(NEWDATA("REJECT IEN")),$D(REJDATA(REJ,"COMMENTS")) D
"RTN","PSOREJP2",96,0)
 . S COM=0 F  S COM=$O(REJDATA(REJ,"COMMENTS",COM)) Q:'COM  D
"RTN","PSOREJP2",97,0)
 . . S X(1)=REJDATA(REJ,"COMMENTS",COM,"COMMENTS")
"RTN","PSOREJP2",98,0)
 . . S X(2)=REJDATA(REJ,"COMMENTS",COM,"DATE/TIME")
"RTN","PSOREJP2",99,0)
 . . S X(3)=REJDATA(REJ,"COMMENTS",COM,"USER")
"RTN","PSOREJP2",100,0)
 . . D SAVECOM^PSOREJP3(RX,NEWDATA("REJECT IEN"),X(1),X(2),X(3))
"RTN","PSOREJP2",101,0)
 D RETRXF^PSOREJU2(RX,FILL,0)
"RTN","PSOREJP2",102,0)
 W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",103,0)
 S CHANGE=1
"RTN","PSOREJP2",104,0)
 Q
"RTN","PSOREJP2",105,0)
 ;
"RTN","PSOREJP2",106,0)
CHG ; - Change Suspense Date action
"RTN","PSOREJP2",107,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",108,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP2",109,0)
 ;
"RTN","PSOREJP2",110,0)
 N SUSDT,PSOMSG,Y,SUSRX,%DT,DA,DIE,DR,ISSDT,EXPDT,PSOMSG
"RTN","PSOREJP2",111,0)
 ;
"RTN","PSOREJP2",112,0)
 S RFL=+$$GET1^DIQ(52.25,REJ_","_RX,5),SUSDT=$$RXSUDT^PSOBPSUT(RX,RFL)
"RTN","PSOREJP2",113,0)
 I SUSDT="" S VALMSG="Prescription is not suspended!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",114,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) S VALMSG="Prescription has been released already!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",115,0)
 D PSOL^PSSLOCK(RX) I '$G(PSOMSG) S VALMSG=$P(PSOMSG,"^",2),VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",116,0)
 ;
"RTN","PSOREJP2",117,0)
 S ISSDT=$$GET1^DIQ(52,RX,1,"I"),EXPDT=$$GET1^DIQ(52,RX,26,"I")
"RTN","PSOREJP2",118,0)
 S SUSRX=$O(^PS(52.5,"B",RX,0))
"RTN","PSOREJP2",119,0)
 ;
"RTN","PSOREJP2",120,0)
SUDT ; Asks for the new Suspense Date
"RTN","PSOREJP2",121,0)
 D FULL^VALM1 S %DT("B")=$$FMTE^XLFDT(SUSDT),%DT="EA",%DT("A")="SUSPENSE DATE: "
"RTN","PSOREJP2",122,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) D PSOUL^PSSLOCK(RX) S VALMBCK="R" Q
"RTN","PSOREJP2",123,0)
 I Y<ISSDT D  G SUDT
"RTN","PSOREJP2",124,0)
 . W !!?5,"Suspense Date cannot be before Issue Date: ",$$FMTE^XLFDT(ISSDT),$C(7)
"RTN","PSOREJP2",125,0)
 I Y>EXPDT D  G SUDT
"RTN","PSOREJP2",126,0)
 . W !!?5,"Suspense Date cannot be after Expiration Date: ",$$FMTE^XLFDT(EXPDT),$C(7)
"RTN","PSOREJP2",127,0)
 S SUSDT=Y
"RTN","PSOREJP2",128,0)
 ;
"RTN","PSOREJP2",129,0)
 N DIR,DIRUT W !
"RTN","PSOREJP2",130,0)
 S DIR("A",1)="     When you confirm, this REJECT will be marked resolved. A"
"RTN","PSOREJP2",131,0)
 S DIR("A",2)="     new claim will be re-submitted to the 3rd party payer"
"RTN","PSOREJP2",132,0)
 I $$GET1^DIQ(52.5,SUSRX,3)="" D
"RTN","PSOREJP2",133,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",134,0)
 . . S DIR("A",3)="     when the prescription label for this fill is printed"
"RTN","PSOREJP2",135,0)
 . . S DIR("A",4)="     from suspense on "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",136,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",137,0)
 . . S DIR("A",6)="     Note: THE LABEL FOR THIS PRESCRIPTION FILL WILL NOT BE"
"RTN","PSOREJP2",138,0)
 . . S DIR("A",7)="           PRINTED LOCAL FROM SUSPENSE BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",139,0)
 . E  D
"RTN","PSOREJP2",140,0)
 . . S DIR("A",3)="     the next time local labels are printed from suspense."
"RTN","PSOREJP2",141,0)
 E  D
"RTN","PSOREJP2",142,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",143,0)
 . . S DIR("A",3)="     when the prescription is transmitted to CMOP on "
"RTN","PSOREJP2",144,0)
 . . S DIR("A",4)="     "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",145,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",146,0)
 . . S DIR("A",6)="     Note: THIS PRESCRIPTION FILL WILL NOT BE TRANSMITTED TO"
"RTN","PSOREJP2",147,0)
 . . S DIR("A",7)="           CMOP BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",148,0)
 . E  D
"RTN","PSOREJP2",149,0)
 . . S DIR("A",3)="     when this prescription fill is transmitted to CMOP on"
"RTN","PSOREJP2",150,0)
 . . S DIR("A",4)="     the next CMOP transmission."
"RTN","PSOREJP2",151,0)
    ;
"RTN","PSOREJP2",152,0)
 S DIR("A",$O(DIR("A",""),-1)+1)=" "
"RTN","PSOREJP2",153,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJP2",154,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" D PSOUL^PSSLOCK(RX) Q
"RTN","PSOREJP2",155,0)
 ;
"RTN","PSOREJP2",156,0)
 ; - Suspense/Fill Date updates
"RTN","PSOREJP2",157,0)
 I SUSDT'=$$RXSUDT^PSOBPSUT(RX,RFL) D
"RTN","PSOREJP2",158,0)
 . N DA,DIE,DR,PSOX,SFN,INDT,DEAD
"RTN","PSOREJP2",159,0)
 . S DA=SUSRX,DIE="^PS(52.5,",DR=".02///"_SUSDT D ^DIE
"RTN","PSOREJP2",160,0)
 . S SFN=SUSRX,DEAD=0,INDT=SUSDT D CHANGE^PSOSUCH1(RX,RFL)
"RTN","PSOREJP2",161,0)
 ;
"RTN","PSOREJP2",162,0)
 ; - Flagging the prescription to be re-submitted to ECME on the next CMOP/Print from Suspense
"RTN","PSOREJP2",163,0)
 D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOREJP2",164,0)
 W ?40,"[Closing..."
"RTN","PSOREJP2",165,0)
 D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,8,"Fill Date changed to "_$$FMTE^XLFDT(SUSDT)_". A new claim will be re-submitted on this date.")
"RTN","PSOREJP2",166,0)
 W "OK]",!,$C(7) H 1 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",167,0)
 D PSOUL^PSSLOCK(RX)
"RTN","PSOREJP2",168,0)
 Q
"RTN","PSOREJP2",169,0)
 ;
"RTN","PSOREJP2",170,0)
PTLBL(RX,RFL) ; Returns whether the user should be prompted for 'Print Label?' or not
"RTN","PSOREJP2",171,0)
 N PTLBL,CMP,LBL
"RTN","PSOREJP2",172,0)
 I $$FIND^PSOREJUT(RX,RFL) Q 0       ; Has OPEN/UNRESOLVED 3rd pary payer reject
"RTN","PSOREJP2",173,0)
 I $$GET1^DIQ(52,RX,100,"I") Q 0     ; Rx status not ACTIVE
"RTN","PSOREJP2",174,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) Q 0     ; Rx Released
"RTN","PSOREJP2",175,0)
 ; - CMOP Rx fill?
"RTN","PSOREJP2",176,0)
 S PTLBL=1,CMP=0
"RTN","PSOREJP2",177,0)
 F  S CMP=$O(^PSRX(RX,4,CMP)) Q:'CMP  D  Q:'PTLBL
"RTN","PSOREJP2",178,0)
 . I +$$GET1^DIQ(52.01,CMP_","_RX,2,"I")=RFL S PTLBL=0
"RTN","PSOREJP2",179,0)
 I 'PTLBL Q 0
"RTN","PSOREJP2",180,0)
 ; - Label already printed for Rx fill?
"RTN","PSOREJP2",181,0)
 S LBL=0
"RTN","PSOREJP2",182,0)
 F  S LBL=$O(^PSRX(RX,"L",LBL)) Q:'LBL  D  Q:'PTLBL
"RTN","PSOREJP2",183,0)
 . I +$$GET1^DIQ(52.032,LBL_","_RX,1,"I")'=RFL Q
"RTN","PSOREJP2",184,0)
 . I $$GET1^DIQ(52.032,LBL_","_RX,4,"I") Q
"RTN","PSOREJP2",185,0)
 . I $$GET1^DIQ(52.032,LBL_","_RX,2)["INTERACTION" Q
"RTN","PSOREJP2",186,0)
 . S PTLBL=0
"RTN","PSOREJP2",187,0)
 ;
"RTN","PSOREJP2",188,0)
 I PTLBL D
"RTN","PSOREJP2",189,0)
 . N DIR,DIRUT,Y
"RTN","PSOREJP2",190,0)
 . W ! S DIR(0)="Y",DIR("A")="Print Label? ",DIR("B")="YES"
"RTN","PSOREJP2",191,0)
 . D ^DIR I $G(Y)=0!$D(DIRUT) S PTLBL=0 Q
"RTN","PSOREJP2",192,0)
 ;
"RTN","PSOREJP2",193,0)
 Q PTLBL
"RTN","PSOREJP2",194,0)
 ;
"RTN","PSOREJP2",195,0)
DTRNG(BGN,END) ; Date Range Selection
"RTN","PSOREJP2",196,0)
 ;Input: (o) BGN - Default Begin Date 
"RTN","PSOREJP2",197,0)
 ;       (o) END - Default End Date 
"RTN","PSOREJP2",198,0)
 ;
"RTN","PSOREJP2",199,0)
 N %DT,DTOUT,DUOUT,DTRNG,X,Y
"RTN","PSOREJP2",200,0)
 S DTRNG=""
"RTN","PSOREJP2",201,0)
 S %DT="AEST",%DT("A")="BEGIN REJECT DATE: ",%DT("B")=$G(BGN) K:$G(BGN)="" %DT("B") D ^%DT
"RTN","PSOREJP2",202,0)
 I $G(DUOUT)!$G(DTOUT)!($G(Y)=-1) Q "^"
"RTN","PSOREJP2",203,0)
 S $P(DTRNG,U)=Y
"RTN","PSOREJP2",204,0)
 ;
"RTN","PSOREJP2",205,0)
 W ! K %DT
"RTN","PSOREJP2",206,0)
 S %DT="AEST",%DT("A")="END REJECT DATE: ",%DT("B")=$G(END),%DT(0)=Y K:$G(END)="" %DT("B") D ^%DT
"RTN","PSOREJP2",207,0)
 I $G(DUOUT)!$G(DTOUT)!($G(Y)=-1) Q "^"
"RTN","PSOREJP2",208,0)
 ;
"RTN","PSOREJP2",209,0)
 ;Define Entry
"RTN","PSOREJP2",210,0)
 S $P(DTRNG,U,2)=Y
"RTN","PSOREJP2",211,0)
 ;
"RTN","PSOREJP2",212,0)
 Q DTRNG
"RTN","PSOREJP3")
0^19^B10158946
"RTN","PSOREJP3",1,0)
PSOREJP3 ;ALB/SS - Third Party Reject Display Screen - Comments ;10/27/06
"RTN","PSOREJP3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260**;DEC 1997;Build 84
"RTN","PSOREJP3",3,0)
 ;
"RTN","PSOREJP3",4,0)
COM ; Builds the Comments section in the Reject Display Screen
"RTN","PSOREJP3",5,0)
 I +$O(^PSRX(RX,"REJ",REJ,"COM",0))=0 Q
"RTN","PSOREJP3",6,0)
 D SETLN^PSOREJP1()
"RTN","PSOREJP3",7,0)
 D SETLN^PSOREJP1("COMMENTS",1,1)
"RTN","PSOREJP3",8,0)
 N DIWL,DIWR,LNCNT,MAXLN,PSL
"RTN","PSOREJP3",9,0)
 N I,X,PSI,Y,LAST,PSOCOM,TXTLN
"RTN","PSOREJP3",10,0)
 S PSI=999999
"RTN","PSOREJP3",11,0)
 F  S PSI=$O(^PSRX(RX,"REJ",REJ,"COM",PSI),-1) Q:+PSI=0  D
"RTN","PSOREJP3",12,0)
 . S PSCOM=$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,.01)_" - "
"RTN","PSOREJP3",13,0)
 . S PSCOM=PSCOM_$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,2)
"RTN","PSOREJP3",14,0)
 . S PSCOM=PSCOM_" ("_$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,1)_")"
"RTN","PSOREJP3",15,0)
 . ;display comment
"RTN","PSOREJP3",16,0)
 . K ^UTILITY($J,"W") S X=PSCOM,DIWL=1,DIWR=78 D ^DIWP
"RTN","PSOREJP3",17,0)
 . F PSL=1:1 Q:('$D(^UTILITY($J,"W",1,PSL,0)))  D
"RTN","PSOREJP3",18,0)
 . . S LAST=0 I '$D(^UTILITY($J,"W",1,PSL+1)),'$O(^PSRX(RX,"REJ",REJ,"COM",PSI),-1) S LAST=1
"RTN","PSOREJP3",19,0)
 . . S TXTLN=$G(^UTILITY($J,"W",1,PSL,0))
"RTN","PSOREJP3",20,0)
 . . D SETLN^PSOREJP1($S(PSL=1:"- ",1:"  ")_TXTLN,0,$S(LAST:1,1:0),1)
"RTN","PSOREJP3",21,0)
 K ^UTILITY($J,"W")
"RTN","PSOREJP3",22,0)
 Q
"RTN","PSOREJP3",23,0)
 ;
"RTN","PSOREJP3",24,0)
ADDCOM ; - Add comment worklist action
"RTN","PSOREJP3",25,0)
 N PSCOM
"RTN","PSOREJP3",26,0)
 D FULL^VALM1
"RTN","PSOREJP3",27,0)
 S PSCOM=$$COMMENT("Comment: ",150)
"RTN","PSOREJP3",28,0)
 I $L(PSCOM)>0,PSCOM'["^" D
"RTN","PSOREJP3",29,0)
 . D SAVECOM(RX,REJ,PSCOM) ;save the comment
"RTN","PSOREJP3",30,0)
 . D INIT^PSOREJP1 ;update screen
"RTN","PSOREJP3",31,0)
 S VALMBCK="R"
"RTN","PSOREJP3",32,0)
 Q
"RTN","PSOREJP3",33,0)
 ;
"RTN","PSOREJP3",34,0)
 ;Enter a comment
"RTN","PSOREJP3",35,0)
 ;PSOTR  -prompt string
"RTN","PSOREJP3",36,0)
 ;PSMLEN -maxlen
"RTN","PSOREJP3",37,0)
 ;returns:
"RTN","PSOREJP3",38,0)
 ; "^" - if user chose to quit 
"RTN","PSOREJP3",39,0)
 ; "" - nothing entered or input has been discarded
"RTN","PSOREJP3",40,0)
 ; otherwise - comment's text
"RTN","PSOREJP3",41,0)
COMMENT(PSOTR,PSMLEN) ;*/
"RTN","PSOREJP3",42,0)
 N DIR,DTOUT,DUOUT,PSQ
"RTN","PSOREJP3",43,0)
 I '$D(PSOTR) S PSOTR="Comment "
"RTN","PSOREJP3",44,0)
 I '$D(PSMLEN) S PSMLEN=150
"RTN","PSOREJP3",45,0)
 S DIR(0)="FA^1:150"
"RTN","PSOREJP3",46,0)
 S DIR("A")=PSOTR
"RTN","PSOREJP3",47,0)
 S DIR("?")="Enter a free text comment up to 150 characters long."
"RTN","PSOREJP3",48,0)
 S PSQ=0
"RTN","PSOREJP3",49,0)
 F  D  Q:+PSQ'=0
"RTN","PSOREJP3",50,0)
 . W ! D ^DIR
"RTN","PSOREJP3",51,0)
 . I $D(DUOUT)!($D(DTOUT)) S PSQ=-1 Q
"RTN","PSOREJP3",52,0)
 . I $L(Y)'>PSMLEN S PSQ=1 Q
"RTN","PSOREJP3",53,0)
 . W !!,"Enter a free text comment up to 150 characters long.",!
"RTN","PSOREJP3",54,0)
 . S DIR("B")=$E(Y,1,PSMLEN)
"RTN","PSOREJP3",55,0)
 Q:PSQ<0 "^"
"RTN","PSOREJP3",56,0)
 Q:$L(Y)=0 ""
"RTN","PSOREJP3",57,0)
 S PSQ=$$YESNO("Confirm","YES")
"RTN","PSOREJP3",58,0)
 I PSQ=-1 Q "^"
"RTN","PSOREJP3",59,0)
 I PSQ=0 Q ""
"RTN","PSOREJP3",60,0)
 Q Y
"RTN","PSOREJP3",61,0)
 ;
"RTN","PSOREJP3",62,0)
 ; Ask
"RTN","PSOREJP3",63,0)
 ; Input:
"RTN","PSOREJP3",64,0)
 ;  PSQSTR - question
"RTN","PSOREJP3",65,0)
 ;  PSDFL - default answer
"RTN","PSOREJP3",66,0)
 ; Output: 
"RTN","PSOREJP3",67,0)
 ; 1 YES
"RTN","PSOREJP3",68,0)
 ; 0 NO
"RTN","PSOREJP3",69,0)
 ; -1 if cancelled
"RTN","PSOREJP3",70,0)
YESNO(PSQSTR,PSDFL) ; Default - YES
"RTN","PSOREJP3",71,0)
 N DIR,Y,DUOUT
"RTN","PSOREJP3",72,0)
 S DIR(0)="Y"
"RTN","PSOREJP3",73,0)
 S DIR("A")=PSQSTR
"RTN","PSOREJP3",74,0)
 S:$L($G(PSDFL)) DIR("B")=PSDFL
"RTN","PSOREJP3",75,0)
 W ! D ^DIR
"RTN","PSOREJP3",76,0)
 Q $S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","PSOREJP3",77,0)
 ;
"RTN","PSOREJP3",78,0)
 ;Save comment
"RTN","PSOREJP3",79,0)
SAVECOM(PSRXIEN,PSREJIEN,PSCOMNT,DATETIME,USER) ;
"RTN","PSOREJP3",80,0)
 N PSREC,PSDA,PSERR
"RTN","PSOREJP3",81,0)
 I '$G(DATETIME) D NOW^%DTC S DATETIME=%
"RTN","PSOREJP3",82,0)
 I '$G(USER) S USER=DUZ
"RTN","PSOREJP3",83,0)
 D INSITEM(52.2551,PSRXIEN,PSREJIEN,DATETIME)
"RTN","PSOREJP3",84,0)
 S PSREC=$O(^PSRX(PSRXIEN,"REJ",PSREJIEN,"COM","B",DATETIME,0))
"RTN","PSOREJP3",85,0)
 I PSREC>0 D
"RTN","PSOREJP3",86,0)
 . S PSDA(52.2551,PSREC_","_PSREJIEN_","_PSRXIEN_",",1)=USER
"RTN","PSOREJP3",87,0)
 . S PSDA(52.2551,PSREC_","_PSREJIEN_","_PSRXIEN_",",2)=$G(PSCOMNT)
"RTN","PSOREJP3",88,0)
 . D FILE^DIE("","PSDA","PSERR")
"RTN","PSOREJP3",89,0)
 Q
"RTN","PSOREJP3",90,0)
 ;
"RTN","PSOREJP3",91,0)
 ;/**
"RTN","PSOREJP3",92,0)
 ;PSSFILE - subfile# (52.2551) for comment
"RTN","PSOREJP3",93,0)
 ;PSIEN - ien for file in which the new subfile entry will be inserted
"RTN","PSOREJP3",94,0)
 ;PSVAL01 - .01 value for the new entry
"RTN","PSOREJP3",95,0)
INSITEM(PSSFILE,PSIEN0,PSIEN1,PSVAL01) ;*/
"RTN","PSOREJP3",96,0)
 N PSSSI,PSIENS,PSFDA,PSER
"RTN","PSOREJP3",97,0)
 S PSIENS="+1,"_PSIEN1_","_PSIEN0_","
"RTN","PSOREJP3",98,0)
 S PSFDA(PSSFILE,PSIENS,.01)=PSVAL01
"RTN","PSOREJP3",99,0)
 D UPDATE^DIE("","PSFDA","PSSSI","PSER")
"RTN","PSOREJP3",100,0)
 I $D(PSER) D BMES^XPDUTL(PSER("DIERR",1,"TEXT",1))
"RTN","PSOREJP3",101,0)
 Q
"RTN","PSOREJU1")
0^20^B58727208
"RTN","PSOREJU1",1,0)
PSOREJU1 ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities (1) ;10/15/04
"RTN","PSOREJU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260**;DEC 1997;Build 84
"RTN","PSOREJU1",3,0)
 ;Reference to File 9002313.21 - BPS NCPDP PROFESSIONAL SERVICE CODE supported by IA 4712
"RTN","PSOREJU1",4,0)
 ;Reference to File 9002313.22 - BPS NCPDP RESULT OF SERVICE CODE supported by IA 4713
"RTN","PSOREJU1",5,0)
 ;Reference to File 9002313.23 - BPS NCPDP REASON FOR SERVICE CODE supported by IA 4714
"RTN","PSOREJU1",6,0)
 ;Reference to File 200 - NEW PERSON supported by IA 10060
"RTN","PSOREJU1",7,0)
 ;Reference to SIG^XUSESIG supported by IA 10050
"RTN","PSOREJU1",8,0)
 ;
"RTN","PSOREJU1",9,0)
ACTION(RX,REJ,OPTS,DEF) ;
"RTN","PSOREJU1",10,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOREJU1",11,0)
 ;         (r) REJ  - REJECT ID (IEN)
"RTN","PSOREJU1",12,0)
 ;         (r) OPTS - Available options ("QIO" for QUIT/IGNORE/OVERRIDE)
"RTN","PSOREJU1",13,0)
 ;         (o) DEF  - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",14,0)
 ; Output: ACTION: "I^Comments" - Ignore Reject
"RTN","PSOREJU1",15,0)
 ;                 "O^COD1^COD2^COD3" - Override with the Override codes COD1(Prof.),COD2(Reason) and COD3(Result)
"RTN","PSOREJU1",16,0)
 ;                 "Q" - Quit
"RTN","PSOREJU1",17,0)
 ;                 "^" - Up-arrow entered or timed out
"RTN","PSOREJU1",18,0)
 ;
"RTN","PSOREJU1",19,0)
 N ACTION,COM,OVR,X,DIR,DIRUT,Y
"RTN","PSOREJU1",20,0)
 ;         
"RTN","PSOREJU1",21,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJU1",22,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU1",23,0)
 ;
"RTN","PSOREJU1",24,0)
 ; - Display DUR/79 REJECT information
"RTN","PSOREJU1",25,0)
 D DISPLAY(RX,REJ)
"RTN","PSOREJU1",26,0)
 ;
"RTN","PSOREJU1",27,0)
ASK K ACTION,DIR,DIRUT
"RTN","PSOREJU1",28,0)
 S DIR(0)="SO^",DIR("A")=""
"RTN","PSOREJU1",29,0)
 S:(OPTS["O") DIR(0)=DIR(0)_"O:(O)VERRIDE - RESUBMIT WITH OVERRIDE CODES;",DIR("A")=DIR("A")_"(O)verride,"
"RTN","PSOREJU1",30,0)
 S:(OPTS["I") DIR(0)=DIR(0)_"I:(I)GNORE - FILL Rx WITHOUT CLAIM SUBMISSION;",DIR("A")=DIR("A")_"(I)gnore,"
"RTN","PSOREJU1",31,0)
 S:(OPTS["Q") DIR(0)=DIR(0)_"Q:(Q)UIT - SEND TO WORKLIST (REQUIRES INTERVENTION);",DIR("A")=DIR("A")_"(Q)uit,"
"RTN","PSOREJU1",32,0)
 S $E(DIR(0),$L(DIR(0)))="",$E(DIR("A"),$L(DIR("A")))="",DIR("??")="^D HELP^PSOREJU2("""_OPTS_""")"
"RTN","PSOREJU1",33,0)
 S:$G(DEF)'="" DIR("B")=DEF D ^DIR I $D(DIRUT) W ! Q "Q"
"RTN","PSOREJU1",34,0)
 ;
"RTN","PSOREJU1",35,0)
 ; - STOP/QUIT Action
"RTN","PSOREJU1",36,0)
 S ACTION=Y I ACTION="Q" Q ACTION
"RTN","PSOREJU1",37,0)
 ;
"RTN","PSOREJU1",38,0)
 ; - IGNORE Action 
"RTN","PSOREJU1",39,0)
 K DIR,DIRUT,X
"RTN","PSOREJU1",40,0)
 I ACTION="I" S COM=$$COM() G ASK:COM="^" G ASK:'$$SIG() S ACTION=ACTION_"^"_COM
"RTN","PSOREJU1",41,0)
 ;
"RTN","PSOREJU1",42,0)
 ; - OVERRIDE Action
"RTN","PSOREJU1",43,0)
 I ACTION="O" D  G ASK:OVR="^"
"RTN","PSOREJU1",44,0)
 . S OVR=$$OVR() S ACTION=ACTION_"^"_OVR
"RTN","PSOREJU1",45,0)
 ;
"RTN","PSOREJU1",46,0)
 Q ACTION
"RTN","PSOREJU1",47,0)
 ;
"RTN","PSOREJU1",48,0)
SIG() ; - Get electronic signature
"RTN","PSOREJU1",49,0)
 N CODE,X,X1,Y
"RTN","PSOREJU1",50,0)
 S CODE=$P($G(^VA(200,DUZ,20)),U,4),Y=0 I '$L(CODE) D  Q Y
"RTN","PSOREJU1",51,0)
 . W $C(7),!,"You do not have an electronic signature code."
"RTN","PSOREJU1",52,0)
 . W !,"Please contact your IRM office." H 2
"RTN","PSOREJU1",53,0)
 D SIG^XUSESIG S Y=(X1'="")
"RTN","PSOREJU1",54,0)
 Q Y
"RTN","PSOREJU1",55,0)
 ;
"RTN","PSOREJU1",56,0)
COM() ; - Ask for CLOSE comments
"RTN","PSOREJU1",57,0)
 K COM,DIR,DIRUT,X
"RTN","PSOREJU1",58,0)
 W ! S DIR(0)="F^3:100" S DIR("A")="Comments" D ^DIR
"RTN","PSOREJU1",59,0)
 S COM=X I $D(DIRUT) S COM="^"
"RTN","PSOREJU1",60,0)
 Q COM
"RTN","PSOREJU1",61,0)
 ;
"RTN","PSOREJU1",62,0)
OVR() ; - Ask for OVERRIDE codes
"RTN","PSOREJU1",63,0)
 N COD1,COD2,COD3,DIR,DIRUT W !
"RTN","PSOREJU1",64,0)
 S COD1=$$OVRCOD(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" Q "^"
"RTN","PSOREJU1",65,0)
 S COD2=$$OVRCOD(2) I COD2="^" Q "^"
"RTN","PSOREJU1",66,0)
 S COD3=$$OVRCOD(3) I COD3="^" Q "^"
"RTN","PSOREJU1",67,0)
 ;
"RTN","PSOREJU1",68,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3) W !
"RTN","PSOREJU1",69,0)
 ;
"RTN","PSOREJU1",70,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJU1",71,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) Q "^"
"RTN","PSOREJU1",72,0)
 ;
"RTN","PSOREJU1",73,0)
 Q (COD2_"^"_COD1_"^"_COD3)
"RTN","PSOREJU1",74,0)
 ;
"RTN","PSOREJU1",75,0)
OVRDSP(LST) ; - Display the Override Codes
"RTN","PSOREJU1",76,0)
 N I W !
"RTN","PSOREJU1",77,0)
 F I=1:1:3 D
"RTN","PSOREJU1",78,0)
 . W !?5,$S(I=1:"Reason for Service Code  : ",I=2:"Professional Service Code: ",1:"Result of Service Code   : ")
"RTN","PSOREJU1",79,0)
 . W $E($$OVRX(I,$P(LST,"^",I)),1,48)
"RTN","PSOREJU1",80,0)
 Q
"RTN","PSOREJU1",81,0)
 ;
"RTN","PSOREJU1",82,0)
CLA() ; - Ask for Clarification Code
"RTN","PSOREJU1",83,0)
 N DIR,Y,DIRUT,DIROUT
"RTN","PSOREJU1",84,0)
 S DIR(0)="52.25,24",DIR("A")="Clarification Code" D ^DIR
"RTN","PSOREJU1",85,0)
 I $D(DIRUT)!$D(DIROUT) Q "^"
"RTN","PSOREJU1",86,0)
 Q Y
"RTN","PSOREJU1",87,0)
 ;
"RTN","PSOREJU1",88,0)
DISPLAY(RX,REJ,KEY) ; - Displays REJECT information
"RTN","PSOREJU1",89,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU1",90,0)
 ;         (r) REJ - REJECT ID (IEN)
"RTN","PSOREJU1",91,0)
 ;         (o) KEY - Display "Press any KEY to continue..." (1-YES/0-NO) (Default: 0)
"RTN","PSOREJU1",92,0)
 ;         
"RTN","PSOREJU1",93,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJU1",94,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU1",95,0)
 ;
"RTN","PSOREJU1",96,0)
 N DATA,RFL,LINE,%
"RTN","PSOREJU1",97,0)
 S RFL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJU1",98,0)
 D GET^PSOREJU2(RX,RFL,.DATA,REJ) I '$D(DATA(REJ)) Q
"RTN","PSOREJU1",99,0)
 ;
"RTN","PSOREJU1",100,0)
 W !!?16,"*** REJECT RECEIVED FROM THIRD PARTY PAYER ***"
"RTN","PSOREJU1",101,0)
 S $P(LINE,"-",74)="" W !?3,LINE
"RTN","PSOREJU1",102,0)
 W !?3,$$DVINFO^PSOREJU2(RX,RFL)
"RTN","PSOREJU1",103,0)
 W !?3,$$PTINFO^PSOREJU2(RX)
"RTN","PSOREJU1",104,0)
 W !?3,"Prescription : ",$$GET1^DIQ(52,RX,.01),"/",RFL," - ",$E($$GET1^DIQ(52,RX,6),1,20),?54,"ECME#: ",$E(RX+10000000,2,8)
"RTN","PSOREJU1",105,0)
 W !?3,"Reject Type  : ",DATA(REJ,"CODE")," - ",$S(DATA(REJ,"CODE")=79:"REFILL TOO SOON",1:"DUR REJECT")
"RTN","PSOREJU1",106,0)
 W " received on "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME")))
"RTN","PSOREJU1",107,0)
 I $G(DATA(REJ,"PAYER MESSAGE"))'="" W !?3,"Payer Message: " D PRT^PSOREJU2("PAYER MESSAGE",18,58)
"RTN","PSOREJU1",108,0)
 I $G(DATA(REJ,"REASON"))'="" W !?3,"Reason       : " D PRT^PSOREJU2("REASON",18,58)
"RTN","PSOREJU1",109,0)
 I $G(DATA(REJ,"DUR TEXT"))'="" W !?3,"DUR Text     : ",DATA(REJ,"DUR TEXT")
"RTN","PSOREJU1",110,0)
 W !?3,"Insurance    : ",DATA(REJ,"INSURANCE NAME"),?50,"Contact: ",DATA(REJ,"PLAN CONTACT")
"RTN","PSOREJU1",111,0)
 W !?3,"Group Name   : ",DATA(REJ,"GROUP NAME"),?45,"Group Number: ",DATA(REJ,"GROUP NUMBER")
"RTN","PSOREJU1",112,0)
 I $G(DATA(REJ,"CARDHOLDER ID"))'="" W !?3,"Cardholder ID: ",DATA(REJ,"CARDHOLDER ID")
"RTN","PSOREJU1",113,0)
 I DATA(REJ,"PLAN PREVIOUS FILL DATE")'="" D
"RTN","PSOREJU1",114,0)
 . W !?3,"Last Fill Dt.: ",DATA(REJ,"PLAN PREVIOUS FILL DATE")
"RTN","PSOREJU1",115,0)
 . W:DATA(REJ,"PLAN PREVIOUS FILL DATE")'="" "   (from payer)"
"RTN","PSOREJU1",116,0)
 W !?3,LINE,$C(7) I $G(KEY) W !?3,"Press <RETURN> to continue..." R %:DTIME W !
"RTN","PSOREJU1",117,0)
 Q
"RTN","PSOREJU1",118,0)
 ;
"RTN","PSOREJU1",119,0)
HDLG(RX,RFL,CODES,FROM,OPTS,DEF) ; - REJECT Handling
"RTN","PSOREJU1",120,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",121,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",122,0)
 ;       (r) CODES - List of REJECT CODES to be handled separated by commas (e.g. "79,88")
"RTN","PSOREJU1",123,0)
 ;       (r) FROM  - Same values as BWHERE param. in the EN^BPSNCPDP api
"RTN","PSOREJU1",124,0)
 ;       (r) OPTS  - Available options ("IOQ" for IGNORE/OVERRIDE/QUIT)
"RTN","PSOREJU1",125,0)
 ;       (o) DEF   - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",126,0)
 ;Output: ACTION   - "O"-Override, "I"-Ignore,"Q"-Quit,"^"-Up-arrow entered
"RTN","PSOREJU1",127,0)
 ;       
"RTN","PSOREJU1",128,0)
 N REJDATA,NEWDATA,CODE,ACTION,REJ,RESP,REJCDI S CODE=""
"RTN","PSOREJU1",129,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",130,0)
 F REJCDI=1:1 S CODE=$P(CODES,",",REJCDI) Q:CODE=""  D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",131,0)
 . S ACTION=""
"RTN","PSOREJU1",132,0)
 . I $$FIND^PSOREJUT(RX,RFL,.REJDATA,CODE) D
"RTN","PSOREJU1",133,0)
 . . S REJ=$O(REJDATA(""))
"RTN","PSOREJU1",134,0)
 . . S ACTION=$$ACTION(RX,REJ,OPTS,$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",135,0)
 . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2)) Q
"RTN","PSOREJU1",136,0)
 . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",137,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,FROM,$$GETNDC^PSONDCUT(RX,RFL),,,$P(ACTION,"^",2,4),,.RESP)
"RTN","PSOREJU1",138,0)
 . . I $G(RESP) D  Q
"RTN","PSOREJU1",139,0)
 . . . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJU1",140,0)
 . . . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7)
"RTN","PSOREJU1",141,0)
 . . K NEWDATA I $$FIND^PSOREJUT(RX,RFL,.NEWDATA,CODE) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",142,0)
 . . . S ACTION=$$ACTION(RX,$O(NEWDATA("")),OPTS,$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",143,0)
 . . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2))
"RTN","PSOREJU1",144,0)
 . . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",145,0)
 Q ACTION
"RTN","PSOREJU1",146,0)
 ;
"RTN","PSOREJU1",147,0)
OVRX(TYPE,CODE) ; - Returns the extentend code/description of the NCPDP DUR override codes
"RTN","PSOREJU1",148,0)
 ; Input: (r) TYPE  - 1 (REASON FOR SERVICE), 2 (PROFESSIONAL SERVICE) or 3 (RESULT OF SERVICE)
"RTN","PSOREJU1",149,0)
 ;        (r) CODE  - Table IEN
"RTN","PSOREJU1",150,0)
 ; Output: "CODE - DESCRIPTION"
"RTN","PSOREJU1",151,0)
 N FILE,DIC,X,Y
"RTN","PSOREJU1",152,0)
 S FILE=9002313+$S(TYPE=1:.23,TYPE=2:.21,1:.22)
"RTN","PSOREJU1",153,0)
 S DIC=FILE,X=CODE D ^DIC
"RTN","PSOREJU1",154,0)
 I TYPE=1 Q CODE_" - "_$$GET1^DIQ(9002313.23,+Y,1)
"RTN","PSOREJU1",155,0)
 I TYPE=2 Q CODE_" - "_$$GET1^DIQ(9002313.21,+Y,1)
"RTN","PSOREJU1",156,0)
 I TYPE=3 Q CODE_" - "_$$GET1^DIQ(9002313.22,+Y,1)
"RTN","PSOREJU1",157,0)
 Q ""
"RTN","PSOREJU1",158,0)
 ;
"RTN","PSOREJU1",159,0)
 ;
"RTN","PSOREJU1",160,0)
OVRCOD(TYPE,VALUE) ; - Prompt for NCPDP Override Codes
"RTN","PSOREJU1",161,0)
 N DIC,X,Y,FILE,PRPT
"RTN","PSOREJU1",162,0)
 ; 
"RTN","PSOREJU1",163,0)
 I TYPE=1 S FILE=9002313.23,PRPT="Reason for Service Code  : "
"RTN","PSOREJU1",164,0)
 I TYPE=2 S FILE=9002313.21,PRPT="Professional Service Code: "
"RTN","PSOREJU1",165,0)
 I TYPE=3 S FILE=9002313.22,PRPT="Result of Service Code   : "
"RTN","PSOREJU1",166,0)
 S DIC=FILE,DIC(0)="Z"
"RTN","PSOREJU1",167,0)
 I $G(VALUE)'="" S X=VALUE D ^DIC I Y>0 W !,PRPT,VALUE,"       ",$P(Y(0),"^",2) Q VALUE
"RTN","PSOREJU1",168,0)
 S DIC=FILE,DIC(0)="AQE",DIC("A")=PRPT
"RTN","PSOREJU1",169,0)
 D ^DIC I $D(DTOUT)!$D(DUOUT)!(Y<0) Q "^"
"RTN","PSOREJU1",170,0)
 Q $P(Y,"^",2)
"RTN","PSOREJU1",171,0)
 ;
"RTN","PSOREJU1",172,0)
SEL(FIELD,FILE,ARRAY,DEFAULT) ; - Provides field selection (one, multiple or ALL)
"RTN","PSOREJU1",173,0)
 N DIC,DTOUT,DUOUT,QT,Y,X
"RTN","PSOREJU1",174,0)
 W !!,"You may select a single or multiple "_FIELD_"S,"
"RTN","PSOREJU1",175,0)
 W !,"or enter ^ALL to select all "_FIELD_"S.",!
"RTN","PSOREJU1",176,0)
 K ARRAY S DIC=FILE,DIC(0)="QEZAM",DIC("A")=FIELD_": "
"RTN","PSOREJU1",177,0)
 I $G(DEFAULT)'="" S DIC("B")=DEFAULT
"RTN","PSOREJU1",178,0)
 F  D ^DIC Q:X=""  D  Q:$G(QT)
"RTN","PSOREJU1",179,0)
 . I $$UP^XLFSTR(X)="^ALL" K ARRAY S ARRAY="ALL",QT=1 Q
"RTN","PSOREJU1",180,0)
 . I $D(DTOUT)!$D(DUOUT) K ARRAY S ARRAY="^",QT=1 Q
"RTN","PSOREJU1",181,0)
 . W "   ",$P(Y,"^",2),$S($D(ARRAY(+Y)):"       (already selected)",1:"")
"RTN","PSOREJU1",182,0)
 . W ! S ARRAY(+Y)="",DIC("A")="ANOTHER ONE: " K DIC("B")
"RTN","PSOREJU1",183,0)
 I '$D(ARRAY) S ARRAY="^"
"RTN","PSOREJU1",184,0)
 Q
"RTN","PSOREJU1",185,0)
 ;
"RTN","PSOREJU1",186,0)
LMREJ(RX,RFL,MSG,BCK) ; Used by ListManager hidden actions to detect unresolved 3rd Party Rejects
"RTN","PSOREJU1",187,0)
 ;Input:  (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",188,0)
 ;        (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",189,0)
 ;Output: (o) MSG  - Usually this will be used to set VALMSG variable, which shoud be passed in by ref.
"RTN","PSOREJU1",190,0)
 ;        (o) BCK  - This will be used to set VALMBCK variable, which shoud be passed in by ref.
"RTN","PSOREJU1",191,0)
 ;
"RTN","PSOREJU1",192,0)
 I '$D(^PSRX(+RX)) Q 0
"RTN","PSOREJU1",193,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",194,0)
 I $$FIND^PSOREJUT(RX,RFL) D  Q 1
"RTN","PSOREJU1",195,0)
 . S MSG="NOT ALLOWED! Rx has OPEN 3rd Party Payer Reject.",BCK="R" W $C(7),$C(7)
"RTN","PSOREJU1",196,0)
 Q 0
"RTN","PSOREJU1",197,0)
 ;
"RTN","PSOREJU1",198,0)
DUP(RX,RSP) ; Checks if REJECT has already been logged in the PRESCRIPTION file
"RTN","PSOREJU1",199,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU1",200,0)
 ;         (o) RSP - Response IEN
"RTN","PSOREJU1",201,0)
 ; Output:     DUP - 1: Already logged (duplicate) 
"RTN","PSOREJU1",202,0)
 ;                   0: Not yet logged on PRESCRIPTION file
"RTN","PSOREJU1",203,0)
 N DUP,IDX S (DUP,IDX)=0
"RTN","PSOREJU1",204,0)
 F  S IDX=$O(^PSRX(RX,"REJ",IDX)) Q:'IDX  D  Q:DUP
"RTN","PSOREJU1",205,0)
 . I +RSP=+$$GET1^DIQ(52.25,IDX_","_RX,16,"I") S DUP=1
"RTN","PSOREJU1",206,0)
 Q DUP
"RTN","PSOREJU1",207,0)
 ;
"RTN","PSOREJU1",208,0)
OTH(CODE,LST) ; Removes the current Reject code from the list
"RTN","PSOREJU1",209,0)
 ; Input:  (r) CODE  - Current Reject Code (79 or 88)
"RTN","PSOREJU1",210,0)
 ;         (o) LST   - List of all Reject codes with response (comma separated)
"RTN","PSOREJU1",211,0)
 ; Output:     OTH   - List of OTHER Reject codes (w/out 79 or 88)
"RTN","PSOREJU1",212,0)
 ;
"RTN","PSOREJU1",213,0)
 N I,OTH
"RTN","PSOREJU1",214,0)
 F I=1:1:$L(LST,",") D
"RTN","PSOREJU1",215,0)
 . I $P(LST,",",I),$P(LST,",",I)'=CODE S OTH=$G(OTH)_","_$P(LST,",",I)
"RTN","PSOREJU1",216,0)
 S $E(OTH)=""
"RTN","PSOREJU1",217,0)
 Q OTH
"RTN","PSOREJU1",218,0)
 ;
"RTN","PSOREJU1",219,0)
DAT(DAT) ; - External Date
"RTN","PSOREJU1",220,0)
 S X=$$HL7TFM^XLFDT(DAT) I X<0 Q ""
"RTN","PSOREJU1",221,0)
 Q X
"RTN","PSOREJU1",222,0)
 ;
"RTN","PSOREJU1",223,0)
CLEAN(STR) ; Remove blanks from the end of a string and replaces ";" with ","
"RTN","PSOREJU1",224,0)
 N LEN F LEN=$L(STR):-1:1 Q:$E(STR,LEN)'=" "
"RTN","PSOREJU1",225,0)
 S STR=$TR(STR,";",",")
"RTN","PSOREJU1",226,0)
 Q $E(STR,1,LEN)
"RTN","PSOREJU2")
0^22^B47862203
"RTN","PSOREJU2",1,0)
PSOREJU2 ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities (1) ;10/15/04
"RTN","PSOREJU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260**;DEC 1997;Build 84
"RTN","PSOREJU2",3,0)
 ;Reference to $$NABP^BPSBUTL supported by IA 4719
"RTN","PSOREJU2",4,0)
 ;Reference to File 9002313.23 - BPS NCPDP REASON FOR SERVICE CODE supported by IA 4714
"RTN","PSOREJU2",5,0)
 ;
"RTN","PSOREJU2",6,0)
GET(RX,RFL,REJDATA,REJID,OKCL,CODE) ;
"RTN","PSOREJU2",7,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU2",8,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJU2",9,0)
 ;         (r) REJDATA(REJECT IEN,FIELD) - Array where these Reject fields will be returned:
"RTN","PSOREJU2",10,0)
 ;                       "CODE" - Reject Code (79 or 88)
"RTN","PSOREJU2",11,0)
 ;                       "DATE/TIME" - DATE/TIME Reject was detected
"RTN","PSOREJU2",12,0)
 ;                       "PAYER MESSAGE" - Message returned by the payer
"RTN","PSOREJU2",13,0)
 ;                       "REASON" - Reject Reason description (from payer)
"RTN","PSOREJU2",14,0)
 ;                       "INSURANCE NAME" - Patient's Insurance Company Name
"RTN","PSOREJU2",15,0)
 ;                       "GROUP NAME" - Patient's Insurance Group Name
"RTN","PSOREJU2",16,0)
 ;                       "GROUP NUMBER" - Patient's Insurance Group Number
"RTN","PSOREJU2",17,0)
 ;                       "CARDHOLDER ID" - Patient's Insurance Cardholder ID
"RTN","PSOREJU2",18,0)
 ;                       "PLAN CONTACT" - Plan's Contact (eg., "1-800-...")
"RTN","PSOREJU2",19,0)
 ;                       "PLAN PREVIOUS FILL DATE" - Last time Rx was paid by payer
"RTN","PSOREJU2",20,0)
 ;                       "STATUS" - REJECTS status ("OPEN/UNRESOLVED" or "CLOSED/RESOLVED")
"RTN","PSOREJU2",21,0)
 ;                       "DUR TEXT" - Payer's DUR description
"RTN","PSOREJU2",22,0)
 ;                       "OTHER REJECTS" - Other Rejects on the same response
"RTN","PSOREJU2",23,0)
 ;                       "REASON SVC CODE" - Reason for Service Code
"RTN","PSOREJU2",24,0)
 ;                  If REJECT is closed, the following fields will be returned:
"RTN","PSOREJU2",25,0)
 ;                       "CLA CODE" - Clarification Code submitted
"RTN","PSOREJU2",26,0)
 ;                       "PRIOR AUTH TYPE" - Prior Authorization Type
"RTN","PSOREJU2",27,0)
 ;                       "PRIOR AUTH NUMBER" - Prior Authorization Type
"RTN","PSOREJU2",28,0)
 ;                       "CLOSED DATE/TIME" - DATE/TIME Reject was closed
"RTN","PSOREJU2",29,0)
 ;                       "CLOSED BY" - Name of the user responsible for closing Reject
"RTN","PSOREJU2",30,0)
 ;                       "CLOSE REASON" - Reason for closing Reject (text)
"RTN","PSOREJU2",31,0)
 ;                       "CLOSE COMMENTS" - User entered comments at close
"RTN","PSOREJU2",32,0)
 ;         (o) REJID - REJECT IEN in the PRESCRIPTION file for retrieve this REJECT
"RTN","PSOREJU2",33,0)
 ;         (o) OKCL - If set to 1, CLOSED REJECTs will also be returned
"RTN","PSOREJU2",34,0)
 ;         (o) CODE - Only REJECTs with this CODE should be returned
"RTN","PSOREJU2",35,0)
 ;
"RTN","PSOREJU2",36,0)
 N REJS,ARRAY,REJFLD,IDX,COM,Z
"RTN","PSOREJU2",37,0)
 ;
"RTN","PSOREJU2",38,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU2",39,0)
 ;
"RTN","PSOREJU2",40,0)
 K REJDATA
"RTN","PSOREJU2",41,0)
 I '$O(^PSRX(RX,"REJ",0)) Q
"RTN","PSOREJU2",42,0)
 ;
"RTN","PSOREJU2",43,0)
 K REJS S RFL=+$G(RFL)
"RTN","PSOREJU2",44,0)
 I $G(REJID) D
"RTN","PSOREJU2",45,0)
 . I +$P($G(^PSRX(RX,"REJ",REJID,0)),"^",4)'=RFL Q
"RTN","PSOREJU2",46,0)
 . I '$G(OKCL),$P($G(^PSRX(RX,"REJ",REJID,0)),"^",5) Q
"RTN","PSOREJU2",47,0)
 . S REJS(REJID)=""
"RTN","PSOREJU2",48,0)
 E  D
"RTN","PSOREJU2",49,0)
 . S IDX=999
"RTN","PSOREJU2",50,0)
 . F  S IDX=$O(^PSRX(RX,"REJ",IDX),-1) Q:'IDX  D
"RTN","PSOREJU2",51,0)
 . . I +$P($G(^PSRX(RX,"REJ",IDX,0)),"^",4)'=RFL Q
"RTN","PSOREJU2",52,0)
 . . I '$G(OKCL),$P($G(^PSRX(RX,"REJ",IDX,0)),"^",5) Q
"RTN","PSOREJU2",53,0)
 . . S REJS(IDX)=""
"RTN","PSOREJU2",54,0)
 I '$D(REJS) Q
"RTN","PSOREJU2",55,0)
 ;
"RTN","PSOREJU2",56,0)
 S IDX=0
"RTN","PSOREJU2",57,0)
 F  S IDX=$O(REJS(IDX)) Q:'IDX  D
"RTN","PSOREJU2",58,0)
 . K ARRAY D GETS^DIQ(52.25,IDX_","_RX_",","*","","ARRAY")
"RTN","PSOREJU2",59,0)
 . K REJFLD M REJFLD=ARRAY(52.25,IDX_","_RX_",")
"RTN","PSOREJU2",60,0)
 . I $G(CODE),REJFLD(.01)'=CODE Q
"RTN","PSOREJU2",61,0)
 . S REJDATA(IDX,"CODE")=$G(REJFLD(.01))
"RTN","PSOREJU2",62,0)
 . S REJDATA(IDX,"DATE/TIME")=$G(REJFLD(1))
"RTN","PSOREJU2",63,0)
 . S REJDATA(IDX,"PAYER MESSAGE")=$G(REJFLD(2))
"RTN","PSOREJU2",64,0)
 . S REJDATA(IDX,"REASON")=$G(REJFLD(3))
"RTN","PSOREJU2",65,0)
 . S REJDATA(IDX,"PHARMACIST")=$G(REJFLD(4))
"RTN","PSOREJU2",66,0)
 . S REJDATA(IDX,"INSURANCE NAME")=$G(REJFLD(20))
"RTN","PSOREJU2",67,0)
 . S REJDATA(IDX,"GROUP NAME")=$G(REJFLD(6))
"RTN","PSOREJU2",68,0)
 . S REJDATA(IDX,"GROUP NUMBER")=$G(REJFLD(21))
"RTN","PSOREJU2",69,0)
 . S REJDATA(IDX,"CARDHOLDER ID")=$G(REJFLD(22))
"RTN","PSOREJU2",70,0)
 . S REJDATA(IDX,"PLAN CONTACT")=$G(REJFLD(7))
"RTN","PSOREJU2",71,0)
 . S REJDATA(IDX,"PLAN PREVIOUS FILL DATE")=$G(REJFLD(8))
"RTN","PSOREJU2",72,0)
 . S REJDATA(IDX,"STATUS")=$G(REJFLD(9))
"RTN","PSOREJU2",73,0)
 . S REJDATA(IDX,"OTHER REJECTS")=$G(REJFLD(17))
"RTN","PSOREJU2",74,0)
 . S REJDATA(IDX,"DUR TEXT")=$G(REJFLD(18))
"RTN","PSOREJU2",75,0)
 . S REJDATA(IDX,"REASON SVC CODE")=$G(REJFLD(14))
"RTN","PSOREJU2",76,0)
 . S REJDATA(IDX,"RESPONSE IEN")=$G(REJFLD(16))
"RTN","PSOREJU2",77,0)
 . I '$G(OKCL) Q
"RTN","PSOREJU2",78,0)
 . S REJDATA(IDX,"CLOSED DATE/TIME")=$G(REJFLD(10))
"RTN","PSOREJU2",79,0)
 . S REJDATA(IDX,"CLOSED BY")=$G(REJFLD(11))
"RTN","PSOREJU2",80,0)
 . S REJDATA(IDX,"CLOSE REASON")=$G(REJFLD(12))
"RTN","PSOREJU2",81,0)
 . S REJDATA(IDX,"CLOSE COMMENTS")=$G(REJFLD(13))
"RTN","PSOREJU2",82,0)
 . S REJDATA(IDX,"COD1")=$G(REJFLD(14))
"RTN","PSOREJU2",83,0)
 . S REJDATA(IDX,"COD2")=$G(REJFLD(15))
"RTN","PSOREJU2",84,0)
 . S REJDATA(IDX,"COD3")=$G(REJFLD(19))
"RTN","PSOREJU2",85,0)
 . S REJDATA(IDX,"CLA CODE")=$G(REJFLD(24))
"RTN","PSOREJU2",86,0)
 . S REJDATA(IDX,"PRIOR AUTH TYPE")=$G(REJFLD(25))
"RTN","PSOREJU2",87,0)
 . S REJDATA(IDX,"PRIOR AUTH NUMBER")=$G(REJFLD(26))
"RTN","PSOREJU2",88,0)
 . S COM=0 F  S COM=$O(^PSRX(RX,"REJ",IDX,"COM",COM)) Q:'COM  D
"RTN","PSOREJU2",89,0)
 . . S Z=^PSRX(RX,"REJ",IDX,"COM",COM,0)
"RTN","PSOREJU2",90,0)
 . . S REJDATA(IDX,"COMMENTS",COM,"DATE/TIME")=$P(Z,"^")
"RTN","PSOREJU2",91,0)
 . . S REJDATA(IDX,"COMMENTS",COM,"USER")=$P(Z,"^",2)
"RTN","PSOREJU2",92,0)
 . . S REJDATA(IDX,"COMMENTS",COM,"COMMENTS")=$P(Z,"^",3)
"RTN","PSOREJU2",93,0)
 Q
"RTN","PSOREJU2",94,0)
 ;
"RTN","PSOREJU2",95,0)
HELP(OPTS) ; Display the Help Text for the DUR handling options (OVERRIDE/IGNORE/STOP/QUIT)
"RTN","PSOREJU2",96,0)
 ;
"RTN","PSOREJU2",97,0)
 I OPTS["O" D
"RTN","PSOREJU2",98,0)
 . W !?1,"(O)verride - This option will provide the prompts for the code sets needed to"
"RTN","PSOREJU2",99,0)
 . W !?1,"             override this reject and get a payable 3rd party claim. Before"
"RTN","PSOREJU2",100,0)
 . W !?1,"             you select this option, you may need to call the 3rd party payer"
"RTN","PSOREJU2",101,0)
 . W !?1,"             to determine which code sets are needed to override a particular"
"RTN","PSOREJU2",102,0)
 . W !?1,"             reject. Once the proper override is accepted the label will print"
"RTN","PSOREJU2",103,0)
 . W !?1,"             and the prescription can be filled."
"RTN","PSOREJU2",104,0)
 ;
"RTN","PSOREJU2",105,0)
 I OPTS["I" D
"RTN","PSOREJU2",106,0)
 . W !?1,"(I)gnore   - Choosing Ignore will by-pass 3rd party processing and will allow"
"RTN","PSOREJU2",107,0)
 . W !?1,"             you to print a label and fill the prescription. This essentially"
"RTN","PSOREJU2",108,0)
 . W !?1,"             ignores the clinical safety issues suggested by the 3rd party"
"RTN","PSOREJU2",109,0)
 . W !?1,"             payer and will NOT result in a payable claim."
"RTN","PSOREJU2",110,0)
 ;           
"RTN","PSOREJU2",111,0)
 I OPTS["Q" D
"RTN","PSOREJU2",112,0)
 . W !?1,"(Q)uit     - Choosing Quit will postpone the processing of this prescription"
"RTN","PSOREJU2",113,0)
 . W !?1,"             until this 3rd party reject is resolved. A label will not be"
"RTN","PSOREJU2",114,0)
 . W !?1,"             printed for this prescription and it can not be filled/dispensed"
"RTN","PSOREJU2",115,0)
 . W !?1,"             until this reject is resolved. Rejects can be resolved through"
"RTN","PSOREJU2",116,0)
 . W !?1,"             the Worklist option under the ePharmacy menu."
"RTN","PSOREJU2",117,0)
 Q
"RTN","PSOREJU2",118,0)
 ;
"RTN","PSOREJU2",119,0)
DVINFO(RX,RFL,LM) ; Returns header displayable Division Information
"RTN","PSOREJU2",120,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU2",121,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU2",122,0)
 ;       (o) LM   - ListManager format? (1 - Yes / 0 - No) - Default: 0
"RTN","PSOREJU2",123,0)
 N TXT,DVINFO,NCPNPI
"RTN","PSOREJU2",124,0)
 S DVINFO="Division : "_$$GET1^DIQ(59,+$$RXSITE^PSOBPSUT(RX,RFL),.01)
"RTN","PSOREJU2",125,0)
 S NCPNPI=$P($$NABP^BPSBUTL(RX,RFL)," ")
"RTN","PSOREJU2",126,0)
 S $E(DVINFO,$S($G(LM):58,1:51))=$S($L(NCPNPI)=7:"NCPDP",1:"  NPI")_"#: "_NCPNPI
"RTN","PSOREJU2",127,0)
 Q DVINFO
"RTN","PSOREJU2",128,0)
 ;
"RTN","PSOREJU2",129,0)
PTINFO(RX,LM) ; Returns header displayable Patient Information
"RTN","PSOREJU2",130,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU2",131,0)
 ;       (o) LM   - ListManager format? (1 - Yes / 0 - No) - Default: 0
"RTN","PSOREJU2",132,0)
 N DFN,VADM,PTINFO
"RTN","PSOREJU2",133,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT
"RTN","PSOREJU2",134,0)
 S PTINFO="Patient  : "_$E($G(VADM(1)),1,$S($G(LM):24,1:20))_"("_$P($G(VADM(2)),"^",2)_")"
"RTN","PSOREJU2",135,0)
 S PTINFO=PTINFO_"  Sex: "_$P($G(VADM(5)),"^")
"RTN","PSOREJU2",136,0)
 S $E(PTINFO,$S($G(LM):61,1:54))="DOB: "_$P($G(VADM(3)),"^",2)_"("_$P($G(VADM(4)),"^")_")"
"RTN","PSOREJU2",137,0)
 Q PTINFO
"RTN","PSOREJU2",138,0)
 ;
"RTN","PSOREJU2",139,0)
RETRXF(RX,RFL,ONOFF) ; - Set/Reset the Re-transmission flag
"RTN","PSOREJU2",140,0)
 ;Input: (r) RX    - Rx IEN (#52)
"RTN","PSOREJU2",141,0)
 ;       (r) RFL   - Refill IEN (#52.1)
"RTN","PSOREJU2",142,0)
 ;       (o) ONOFF - Turn flag ON or OFF (1 - ON / 0 - OFF) (Default: OFF) 
"RTN","PSOREJU2",143,0)
 N DA,DIE,DR
"RTN","PSOREJU2",144,0)
 S DR="82///"_$S($G(ONOFF):"YES",1:"@")
"RTN","PSOREJU2",145,0)
 I 'RFL S DA=RX,DIE="^PSRX("
"RTN","PSOREJU2",146,0)
 I RFL S DA(1)=RX,DA=RFL,DIE="^PSRX("_RX_",1,"
"RTN","PSOREJU2",147,0)
 D ^DIE
"RTN","PSOREJU2",148,0)
 Q
"RTN","PSOREJU2",149,0)
 ;
"RTN","PSOREJU2",150,0)
REASON(TXT) ; Extracts the Reason for service code from the REASON text field
"RTN","PSOREJU2",151,0)
 ; Input: (r) TXT  - Reason text (e.g., NN Reason for Service Code Text)
"RTN","PSOREJU2",152,0)
 ;Output:   REASON - NN (if on valid and on file (#9002313.23), null otherwise)
"RTN","PSOREJU2",153,0)
 N REASON,DIC,X,Y
"RTN","PSOREJU2",154,0)
 S REASON=$P(TXT," ") I $L(REASON)'=2 Q ""
"RTN","PSOREJU2",155,0)
 S DIC=9002313.23,X=REASON D ^DIC I Y<0 Q ""
"RTN","PSOREJU2",156,0)
 Q REASON
"RTN","PSOREJU2",157,0)
 ;
"RTN","PSOREJU2",158,0)
SETOPN(RX,REJ) ; - Set the Reject RE-OPENED flag to YES
"RTN","PSOREJU2",159,0)
 ;Input: (r) RX    - Rx IEN (#52)
"RTN","PSOREJU2",160,0)
 ;       (r) REJ   - Reject IEN (#52.25)
"RTN","PSOREJU2",161,0)
 ;       
"RTN","PSOREJU2",162,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU2",163,0)
 N DIE,DA,DR
"RTN","PSOREJU2",164,0)
 S DIE="^PSRX("_RX_",""REJ"",",DA(1)=RX,DA=REJ,DR="23///YES" D ^DIE
"RTN","PSOREJU2",165,0)
 Q
"RTN","PSOREJU2",166,0)
 ;
"RTN","PSOREJU2",167,0)
PRT(FIELD,P,L) ; Sets the lines for fields that require text wrapping
"RTN","PSOREJU2",168,0)
 ;Input: FIELD - Subscript name from the DATA(REJ,FIELD) array
"RTN","PSOREJU2",169,0)
 ;         P   - Position where the content should be printed
"RTN","PSOREJU2",170,0)
 ;         L   - Lenght of the text on each line
"RTN","PSOREJU2",171,0)
 N TXT,I
"RTN","PSOREJU2",172,0)
 S TXT=DATA(REJ,FIELD) I $L(TXT)'>L W ?P,TXT Q
"RTN","PSOREJU2",173,0)
 F I=1:1 Q:TXT=""  D
"RTN","PSOREJU2",174,0)
 . I I=1 W ?P,$E(TXT,1,L),! S TXT=$E(TXT,L+1,999) Q
"RTN","PSOREJU2",175,0)
 . W ?P,$E(TXT,1,L) S TXT=$E(TXT,L+1,999) W:TXT'="" !
"RTN","PSOREJU2",176,0)
 Q
"RTN","PSOREJU2",177,0)
 ;
"RTN","PSOREJU2",178,0)
PA() ; - Ask for Prior Authorization Type and Number
"RTN","PSOREJU2",179,0)
 ;Output:(PAT^PAN) PAT - Prior Authorization Type (See DD File#52,
"RTN","PSOREJU2",180,0)
 ;                         Sub-file#52.25,field#25 for possible values)
"RTN","PSOREJU2",181,0)
 ;                 PAN - Prior Authorization Number (11 digits)
"RTN","PSOREJU2",182,0)
 ;        
"RTN","PSOREJU2",183,0)
 N DIR,Y,DIRUT,DIROUT,PAT,PAN
"RTN","PSOREJU2",184,0)
 S DIR(0)="52.25,25",DIR("A")="  Prior Authorization Type",DIR("B")="0"
"RTN","PSOREJU2",185,0)
 S (DIR("?"),DIR("??"))="^D PAHLP^PSOREJU2"
"RTN","PSOREJU2",186,0)
 D ^DIR I $D(DIRUT)!$D(DIROUT) Q "^"
"RTN","PSOREJU2",187,0)
 S PAT=Y
"RTN","PSOREJU2",188,0)
 K DIR S DIR(0)="52.25,26",DIR("A")="Prior Authorization Number"
"RTN","PSOREJU2",189,0)
 S DIR("?")="^D PANHLP^PSOREJU2",DIR("??")=""
"RTN","PSOREJU2",190,0)
 D ^DIR I (Y["^")!$D(DIROUT) Q "^"
"RTN","PSOREJU2",191,0)
 S PAN=Y
"RTN","PSOREJU2",192,0)
 Q (PAT_"^"_PAN)
"RTN","PSOREJU2",193,0)
 ;
"RTN","PSOREJU2",194,0)
PAHLP ; Prior Authorization Type Help
"RTN","PSOREJU2",195,0)
 W !?9,"EPSDT - Early Periodic Screening Diagnosis Treatment"
"RTN","PSOREJU2",196,0)
 W !?9,"AFDC  - Aid to Family with Dependent Children"
"RTN","PSOREJU2",197,0)
 Q
"RTN","PSOREJU2",198,0)
 ;
"RTN","PSOREJU2",199,0)
PANHLP ; Prior Authorization Number Help
"RTN","PSOREJU2",200,0)
 W "OR you may leave it blank if the claim does not require a number."
"RTN","PSOREJU2",201,0)
 Q
"RTN","PSOREJUT")
0^21^B34569551
"RTN","PSOREJUT",1,0)
PSOREJUT ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities ;06/07/05
"RTN","PSOREJUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260**;DEC 1997;Build 84
"RTN","PSOREJUT",3,0)
 ;Reference to DUR1^BPSNCPD3 supported by IA 4560
"RTN","PSOREJUT",4,0)
 ;Reference to $$ADDCOMM^BPSBUTL supported by IA 4719
"RTN","PSOREJUT",5,0)
 ;
"RTN","PSOREJUT",6,0)
SAVE(RX,RFL,REJ) ; - Saves DUR Information in the PRESCRIPTION file
"RTN","PSOREJUT",7,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",8,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",9,0)
 ;         (r) REJ - Array containing information about the REJECT on the following
"RTN","PSOREJUT",10,0)
 ;                   subscripts:
"RTN","PSOREJUT",11,0)
 ;                   "CODE"   - Reject Code (79 or 88)
"RTN","PSOREJUT",12,0)
 ;                   "DATE/TIME"   - Date/Time Reject Detected
"RTN","PSOREJUT",13,0)
 ;                   "PAYER MESSAGE" - Message returned by Payer (up to 140 chars long)
"RTN","PSOREJUT",14,0)
 ;                   "REASON" - Reject Reason (up to 100 chars long)
"RTN","PSOREJUT",15,0)
 ;                   "DUR TEXT" - Payer's DUR description
"RTN","PSOREJUT",16,0)
 ;                   "INSURANCE NAME" - Patient's Insurance Company Name
"RTN","PSOREJUT",17,0)
 ;                   "GROUP NAME" - Patient's Insurance Group Name
"RTN","PSOREJUT",18,0)
 ;                   "GROUP NUMBER" - Patient's Insurance Group Number
"RTN","PSOREJUT",19,0)
 ;                   "CARDHOLDER ID" - Patient's Insurance Cardholder ID
"RTN","PSOREJUT",20,0)
 ;                   "PLAN CONTACT" - Patient's Insurance Plan Contact (1-800)
"RTN","PSOREJUT",21,0)
 ;                   "PREVIOUS FILL" - Plan's Previous Fill Date
"RTN","PSOREJUT",22,0)
 ;                   "OTHER REJECTS" - Other Rejects with same Response
"RTN","PSOREJUT",23,0)
 ;                   "PHARMACIST" - Pharmacist DUZ
"RTN","PSOREJUT",24,0)
 ;                   "RESPONSE IEN" - Pointer to the RESPONSE file in ECME
"RTN","PSOREJUT",25,0)
 ;                   "REASON SVC CODE" - Reason for Service Code (pointer to BPS NCPDP REASON FOR SERVICE CODE)
"RTN","PSOREJUT",26,0)
 ;                   "RE-OPENED" - Re-Open Flag
"RTN","PSOREJUT",27,0)
 ;Output: REJ("REJECT IEN") 
"RTN","PSOREJUT",28,0)
 ;
"RTN","PSOREJUT",29,0)
 N %,DIC,DR,DA,X,DINUM,DD,DO,DLAYGO
"RTN","PSOREJUT",30,0)
 ;
"RTN","PSOREJUT",31,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",32,0)
 ;
"RTN","PSOREJUT",33,0)
 ; - If Reject Code different than 79 or 88, Quit
"RTN","PSOREJUT",34,0)
 S REJ("CODE")=+$G(REJ("CODE")) I REJ("CODE")'=79,REJ("CODE")'=88 Q
"RTN","PSOREJUT",35,0)
 ;
"RTN","PSOREJUT",36,0)
 S REJ("PAYER MESSAGE")=$E($G(REJ("PAYER MESSAGE")),1,140),REJ("REASON")=$E($G(REJ("REASON")),1,100)
"RTN","PSOREJUT",37,0)
 S REJ("DUR TEXT")=$E($G(REJ("DUR TEXT")),1,100),REJ("GROUP NAME")=$E($G(REJ("GROUP NAME")),1,30)
"RTN","PSOREJUT",38,0)
 S REJ("INSURANCE NAME")=$E($G(REJ("INSURANCE NAME")),1,30),REJ("PLAN CONTACT")=$E($G(REJ("PLAN CONTACT")),1,30)
"RTN","PSOREJUT",39,0)
 S REJ("GROUP NUMBER")=$E($G(REJ("GROUP NUMBER")),1,30),REJ("OTHER REJECTS")=$E($G(REJ("OTHER REJECTS")),1,15)
"RTN","PSOREJUT",40,0)
 S REJ("CARDHOLDER ID")=$E($G(REJ("CARDHOLDER ID")),1,20)
"RTN","PSOREJUT",41,0)
 I $G(REJ("DATE/TIME"))="" D NOW^%DTC S REJ("DATE/TIME")=%
"RTN","PSOREJUT",42,0)
 ;
"RTN","PSOREJUT",43,0)
 S DIC="^PSRX("_RX_",""REJ"",",DA(1)=RX,DIC(0)=""
"RTN","PSOREJUT",44,0)
 S X=+$G(REJ("CODE")),DINUM=$O(^PSRX(RX,"REJ",9999),-1)+1
"RTN","PSOREJUT",45,0)
 S DIC("DR")="1///"_$G(REJ("DATE/TIME"))_";2///"_REJ("PAYER MESSAGE")_";3///"_REJ("REASON")_";4////"_$G(REJ("PHARMACIST"))_";5///"_RFL
"RTN","PSOREJUT",46,0)
 S DIC("DR")=DIC("DR")_";6///"_REJ("GROUP NAME")_";7///"_REJ("PLAN CONTACT")_";8///"_$G(REJ("PREVIOUS FILL"))
"RTN","PSOREJUT",47,0)
 S DIC("DR")=DIC("DR")_";9///0;14///"_$G(REJ("REASON SVC CODE"))_";16///"_$G(REJ("RESPONSE IEN"))
"RTN","PSOREJUT",48,0)
 S DIC("DR")=DIC("DR")_";17///"_$G(REJ("OTHER REJECTS"))_";18///"_REJ("DUR TEXT")_";20///"_REJ("INSURANCE NAME")
"RTN","PSOREJUT",49,0)
 S DIC("DR")=DIC("DR")_";21///"_REJ("GROUP NUMBER")_";22///"_REJ("CARDHOLDER ID")_";23///"_$G(REJ("RE-OPENED"))
"RTN","PSOREJUT",50,0)
 ;
"RTN","PSOREJUT",51,0)
 F  L +^PSRX(RX):5 Q:$T  H 15
"RTN","PSOREJUT",52,0)
 K DD,DO D FILE^DICN K DD,DO S REJ("REJECT IEN")=+Y
"RTN","PSOREJUT",53,0)
 L -^PSRX(RX)
"RTN","PSOREJUT",54,0)
 Q
"RTN","PSOREJUT",55,0)
 ; 
"RTN","PSOREJUT",56,0)
CLSALL(RX,RFL,USR,REA,COM,COD1,COD2,COD3,CLA,PA) ; Close/Resolve All Rejects
"RTN","PSOREJUT",57,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJUT",58,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJUT",59,0)
 ;       (r) REA  - Close REASON code
"RTN","PSOREJUT",60,0)
 ;       (o) COM  - Close COMMENTS
"RTN","PSOREJUT",61,0)
 ;       (o) USR  - User DUZ responsible for closing all rejects
"RTN","PSOREJUT",62,0)
 ;       (o) COD1 - NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",63,0)
 ;       (o) COD2 - NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",64,0)
 ;       (o) COD3 - NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",65,0)
 ;       (o) CLA  - NCPDP Clarification Code for overriding RTS and DUR REJECTS
"RTN","PSOREJUT",66,0)
 ;       (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOREJUT",67,0)
 N REJ,REJDATA,DIE,DR,DA
"RTN","PSOREJUT",68,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",69,0)
 ;
"RTN","PSOREJUT",70,0)
 ; - Closing OPEN/UNRESOLVED rejects
"RTN","PSOREJUT",71,0)
 I $$FIND(RX,RFL,.REJDATA) D
"RTN","PSOREJUT",72,0)
 . S REJ="" F  S REJ=$O(REJDATA(REJ)) Q:'REJ  D
"RTN","PSOREJUT",73,0)
 . . D CLOSE(RX,RFL,REJ,USR,REA,$G(COM),$G(COD1),$G(COD2),$G(COD3),$G(CLA),$G(PA))
"RTN","PSOREJUT",74,0)
 Q
"RTN","PSOREJUT",75,0)
 ;
"RTN","PSOREJUT",76,0)
CLOSE(RX,RFL,REJ,USR,REA,COM,COD1,COD2,COD3,CLA,PA) ; - Mark a DUR/REFILL TOO SOON reject RESOLVED
"RTN","PSOREJUT",77,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",78,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",79,0)
 ;         (r) REJ - REJECT ID (IEN)
"RTN","PSOREJUT",80,0)
 ;         (o) USR - User (file #200 IEN) responsible for closing the REJECT
"RTN","PSOREJUT",81,0)
 ;         (r) REA - Reason for closing the REJECT:
"RTN","PSOREJUT",82,0)
 ;                       1:CLAIM RE-SUBMITTED
"RTN","PSOREJUT",83,0)
 ;                       2:RX ON HOLD
"RTN","PSOREJUT",84,0)
 ;                       3:RX SUSPENDED
"RTN","PSOREJUT",85,0)
 ;                       4:RX RETURNED TO STOCK
"RTN","PSOREJUT",86,0)
 ;                       5:RX DELETED
"RTN","PSOREJUT",87,0)
 ;                       6:OVERRIDEN W/OUT RE-SUBMISSION
"RTN","PSOREJUT",88,0)
 ;                      99:OTHER
"RTN","PSOREJUT",89,0)
 ;         (o) COM  - Close comments manually entered by the user
"RTN","PSOREJUT",90,0)
 ;         (o) COD1 - NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",91,0)
 ;         (o) COD2 - NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",92,0)
 ;         (o) COD3 - NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",93,0)
 ;         (o) CLA  - NCPDP Clarification Code for overriding RTS and DUR REJECTS
"RTN","PSOREJUT",94,0)
 ;         (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOREJUT",95,0)
 ;
"RTN","PSOREJUT",96,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJUT",97,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",98,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJUT",99,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,5)'=+$G(RFL) Q
"RTN","PSOREJUT",100,0)
 S:'$G(REA) REA=99 S COM=$TR($G(COM),";^",",,")
"RTN","PSOREJUT",101,0)
 ;
"RTN","PSOREJUT",102,0)
 N DQ,DA,DIE,DR,X,Y,REJCOM
"RTN","PSOREJUT",103,0)
 D NOW^%DTC
"RTN","PSOREJUT",104,0)
 S REJCOM="AUTOMATICALLY CLOSED" I REA'=1 S REJCOM=COM
"RTN","PSOREJUT",105,0)
 S DA(1)=RX,DA=REJ,DIE="^PSRX("_RX_",""REJ"","
"RTN","PSOREJUT",106,0)
 S DR="9///1;10///"_%_";11////"_$G(USR)_";12///"_REA_";13///"_REJCOM_";14///"_$G(COD1)_";15///"_$G(COD2)
"RTN","PSOREJUT",107,0)
 S DR=DR_";19///"_$G(COD3)_";24///"_$G(CLA)_";25///"_$P($G(PA),"^")_";26///"_$P($G(PA),"^",2)
"RTN","PSOREJUT",108,0)
 ;
"RTN","PSOREJUT",109,0)
 D ^DIE S X=$$ADDCOMM^BPSBUTL(RX,RFL,COM)
"RTN","PSOREJUT",110,0)
 Q
"RTN","PSOREJUT",111,0)
 ;
"RTN","PSOREJUT",112,0)
FIND(RX,RFL,REJDATA,CODE) ; - Returns whether a prescription/fill contains UNRESOLVED rejects
"RTN","PSOREJUT",113,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOREJUT",114,0)
 ;         (o) RFL  - Refill # (If not passed, look original and all refills)
"RTN","PSOREJUT",115,0)
 ;         (o) CODE - Specific Reject Code to be checked
"RTN","PSOREJUT",116,0)
 ;         
"RTN","PSOREJUT",117,0)
 ; Output: 1 - Rx contains unresoveld Rejects 
"RTN","PSOREJUT",118,0)
 ;         0 - Rx does not contain unresolved Rejects
"RTN","PSOREJUT",119,0)
 ;         .REJDATA - Array containing the Reject(s) data (see 
"RTN","PSOREJUT",120,0)
 ;                    GET^PSOREJU2 for fields documentation)
"RTN","PSOREJUT",121,0)
 ;
"RTN","PSOREJUT",122,0)
 I $G(RFL),$$STATUS^PSOBPSUT(RX,RFL)="" Q 0
"RTN","PSOREJUT",123,0)
 ;
"RTN","PSOREJUT",124,0)
 K REJDATA
"RTN","PSOREJUT",125,0)
 I $G(RFL) D
"RTN","PSOREJUT",126,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJUT",127,0)
 E  S RFL=0 D  I '$D(REJDATA) F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D  Q:$D(REJDATA)
"RTN","PSOREJUT",128,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJUT",129,0)
 ;
"RTN","PSOREJUT",130,0)
 Q $S($D(REJDATA):1,1:0)
"RTN","PSOREJUT",131,0)
 ;
"RTN","PSOREJUT",132,0)
SYNC(RX,RFL,USR) ;
"RTN","PSOREJUT",133,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",134,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",135,0)
 ;         (o) USR - User using the system when this routine is called
"RTN","PSOREJUT",136,0)
 ;
"RTN","PSOREJUT",137,0)
 N REJ,REJS,I,IDX,CODE,DATA,TXT
"RTN","PSOREJUT",138,0)
 L +^PSRX("REJ",RX):0 Q:'$T
"RTN","PSOREJUT",139,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",140,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ)
"RTN","PSOREJUT",141,0)
 K REJS S IDX=""
"RTN","PSOREJUT",142,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",143,0)
 . S TXT=$G(REJ(IDX,"REJ CODE LST"))
"RTN","PSOREJUT",144,0)
 . F I=1:1:$L(TXT,",") D
"RTN","PSOREJUT",145,0)
 . . S CODE=+$P(TXT,",",I) I CODE'=79,CODE'=88 Q
"RTN","PSOREJUT",146,0)
 . . I $$DUP^PSOREJU1(RX,+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))) Q
"RTN","PSOREJUT",147,0)
 . . S REJS(IDX,CODE)=""
"RTN","PSOREJUT",148,0)
 I '$D(REJS) L -^PSRX("REJ",RX) Q
"RTN","PSOREJUT",149,0)
 ;
"RTN","PSOREJUT",150,0)
 S (IDX,CODE)=""
"RTN","PSOREJUT",151,0)
 F  S IDX=$O(REJS(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",152,0)
 . F  S CODE=$O(REJS(IDX,CODE)) Q:CODE=""  D
"RTN","PSOREJUT",153,0)
 . . K DATA
"RTN","PSOREJUT",154,0)
 . . S DATA("DUR TEXT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"DUR FREE TEXT DESC")))
"RTN","PSOREJUT",155,0)
 . . S DATA("PAYER MESSAGE")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PAYER MESSAGE")))
"RTN","PSOREJUT",156,0)
 . . S DATA("CODE")=CODE
"RTN","PSOREJUT",157,0)
 . . S DATA("REASON")=$$CLEAN^PSOREJU1($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",158,0)
 . . S DATA("PHARMACIST")=$G(USR)
"RTN","PSOREJUT",159,0)
 . . S DATA("INSURANCE NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"INSURANCE NAME")))
"RTN","PSOREJUT",160,0)
 . . S DATA("GROUP NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NAME")))
"RTN","PSOREJUT",161,0)
 . . S DATA("GROUP NUMBER")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NUMBER")))
"RTN","PSOREJUT",162,0)
 . . S DATA("CARDHOLDER ID")=$$CLEAN^PSOREJU1($G(REJ(IDX,"CARDHOLDER ID")))
"RTN","PSOREJUT",163,0)
 . . S DATA("PLAN CONTACT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PLAN CONTACT")))
"RTN","PSOREJUT",164,0)
 . . S DATA("PREVIOUS FILL")=$$CLEAN^PSOREJU1($$DAT^PSOREJU1($G(REJ(IDX,"PREVIOUS FILL DATE"))))
"RTN","PSOREJUT",165,0)
 . . S DATA("OTHER REJECTS")=$$CLEAN^PSOREJU1($$OTH^PSOREJU1(CODE,$G(REJ(IDX,"REJ CODE LST"))))
"RTN","PSOREJUT",166,0)
 . . S DATA("RESPONSE IEN")=+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))
"RTN","PSOREJUT",167,0)
 . . S DATA("REASON SVC CODE")=$$REASON^PSOREJU2($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",168,0)
 . . D SAVE(RX,RFL,.DATA)
"RTN","PSOREJUT",169,0)
 L -^PSRX("REJ",RX)
"RTN","PSOREJUT",170,0)
 Q
"RTN","PSORXL1")
0^23^B42620106
"RTN","PSORXL1",1,0)
PSORXL1 ;BIR/SAB-action to be taken on prescriptions ;03/01/96
"RTN","PSORXL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**36,46,148,260**;DEC 1997;Build 84
"RTN","PSORXL1",3,0)
S S SPPL="",PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSORXL1",4,0)
S1 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D
"RTN","PSORXL1",5,0)
 .I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D SUS Q
"RTN","PSORXL1",6,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL1",7,0)
 I $G(SPPL)]"" D  K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSORXL1",8,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL1",9,0)
 .I $G(PSOLAP)=""!($G(PSOLAP)=$G(ION)) W !,"Label device must be selected for Drug Interaction label!"
"RTN","PSORXL1",10,0)
 .S PPL=SPPL,DG=1 N PPL1 D Q^PSORXL K DG,SPPL
"RTN","PSORXL1",11,0)
 S SUSPT="SUSPENSE" G D1
"RTN","PSORXL1",12,0)
 Q
"RTN","PSORXL1",13,0)
SUS S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S RXCMOP=$P($G(^PS(52.5,RXS,0)),"^",7) D  Q:$G(DFLG)!($G(PSOWFLG))
"RTN","PSORXL1",14,0)
 .;checks to see if future fill exists
"RTN","PSORXL1",15,0)
 .S PSOWFLG=0 I '$G(RXPR(DA)),$P($G(^PS(52.5,RXS,"P")),"^")=0,$P($G(^PSRX(DA,"STA")),"^")=5 D SWARN Q:$G(PSOWFLG)
"RTN","PSORXL1",16,0)
 .K PSOWFLG I $G(RXPR(DA)),'$P($G(^PS(52.5,RXS,"P")),"^") D WARN Q:$G(DFLG)
"RTN","PSORXL1",17,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN I $P($G(^PSRX(RXN,"STA")),"^")=5 S $P(^("STA"),"^")=0
"RTN","PSORXL1",18,0)
 G:$G(RXRP(DA))!($G(RXPR(DA))) LOCK
"RTN","PSORXL1",19,0)
 I $G(PSXSYS) D SUS1^PSOCMOP I $G(XFLAG)=1 K XFLAG Q
"RTN","PSORXL1",20,0)
LOCK I $P($G(^PSRX(RXN,"STA")),"^")=3 G SUSQ
"RTN","PSORXL1",21,0)
 S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///"_RXP_";.06////"_PSOSITE_";2///0" K DD,DO D FILE^DICN D  I +Y,'$G(RXP),$G(RXRP(RXN)) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",22,0)
 .K DD,DO I +Y,$G(PSOEXREP) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",23,0)
 .I +Y S $P(^PS(52.5,+Y,0),"^",13)=$G(RXFL(RXN))
"RTN","PSORXL1",24,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSORXL1",25,0)
 W !!,$S(RXP:"Partial ",1:"")_"RX# ",$P(^PSRX(RXN,0),"^")_" has been suspended until "_LFD_"."
"RTN","PSORXL1",26,0)
 S VALMSG=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",27,0)
 S COMM=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",28,0)
 D:'$D(^TMP("PSORXN",$J,RXN)) EN^PSOHLSN1(RXN,"SC","ZS",COMM)
"RTN","PSORXL1",29,0)
 S:$D(^TMP("PSORXN",$J,RXN)) $P(^TMP("PSORXN",$J,RXN),"^",4)=COMM
"RTN","PSORXL1",30,0)
 ;
"RTN","PSORXL1",31,0)
 ; - If not a PARTIAL, reverse ECME Claim, if necessary
"RTN","PSORXL1",32,0)
 I '$G(RXP) D REVERSE^PSOBPSU1(RXN,,"DC",3)
"RTN","PSORXL1",33,0)
 K COMM
"RTN","PSORXL1",34,0)
SUSQ Q
"RTN","PSORXL1",35,0)
ACT I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORXL1",36,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSORXL1",37,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXL1",38,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_$S(RXP:"Partial ",1:"")_"RX "_$S($G(RXRP(DA))&('$G(RXP)):"Reprint ",1:"")_"Placed on Suspense until "_LFD K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSORXL1",39,0)
 Q
"RTN","PSORXL1",40,0)
D1 I $O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",$G(PPL1))),PPL=PSORX("PSOL",PPL1) G S1
"RTN","PSORXL1",41,0)
 G:$D(RXRS) RXS^PSORXL
"RTN","PSORXL1",42,0)
 K LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT,DFLG,RXPD,PSOWFLG
"RTN","PSORXL1",43,0)
 Q
"RTN","PSORXL1",44,0)
WARN W ! K DIR,DIRUT,DUOUT,DTOUT,DFLG S Y=$P(^PS(52.5,RXS,0),"^",2) X ^DD("DD") S RXPD=Y,DIR(0)="SA^S:SUSPEND;Q:QUEUE;E:EXIT"
"RTN","PSORXL1",45,0)
 S DIR("A",1)="Rx #"_$P(^PSRX(DA,0),"^")_" is suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_RXPD
"RTN","PSORXL1",46,0)
 I $G(RXCMOP)]"" D  G WARN1
"RTN","PSORXL1",47,0)
 .W !!,"A partial entered for this Rx cannot be suspended."
"RTN","PSORXL1",48,0)
 .W !,"You may pull this fill from suspense or print the label now.",!!
"RTN","PSORXL1",49,0)
 .S DIR("A",2)=" ",DIR("A",3)="   Do you want to Queue to print",DIR("A")="                or Exit: "
"RTN","PSORXL1",50,0)
 S DIR("A",2)=" ",DIR("A",3)="   Do you want to: Suspend Partial",DIR("A",4)="                   Queue to print",DIR("A")="                or Exit:  "
"RTN","PSORXL1",51,0)
WARN1 S DIR("B")="EXIT",DIR("?")="^D HLP^PSORXL1" D ^DIR K DIR
"RTN","PSORXL1",52,0)
 I Y="E"!($D(DIRUT))!(Y="S"&($G(RXCMOP)]"")) S DA(1)=DA,DA=RXPR(DA),DIK="^PSRX("_DA(1)_",""P""," D ^DIK S ^PSRX(DA(1),"TYPE")=0,DFLG=1 W $C(7)," Partial Removed!" Q
"RTN","PSORXL1",53,0)
 I Y="Q" S DPPL=PPL,HOLDPPL1=$G(PPL1),DPI=PI,RXLTOP=1 S PPL=$G(RXN)_"," S PSPARTXX=1 D Q^PSORXL K PSPARTXX S DFLG=1,PPL=DPPL,PI=DPI,PPL1=$G(HOLDPPL1) K HOLDPPL1,DPPL,DPPI,DPI,RXLTOP Q
"RTN","PSORXL1",54,0)
 Q
"RTN","PSORXL1",55,0)
HLP I $G(RXCMOP)']"" W !!,"If you choose to suspend this partial Rx, the current suspended fill will",!,"be replaced by the partial.  You may want to pull this fill early instead.",!
"RTN","PSORXL1",56,0)
 I $G(RXCMOP)]"" W !!,"You cannot suspend a partial when a CMOP fill is in suspense, because the partial will replace the CMOP fill in suspense."
"RTN","PSORXL1",57,0)
 W !,"If you choose to queue this partial, the label will printout on the previous",!,"selected label printer.",!
"RTN","PSORXL1",58,0)
 W !,"You may exit without printing or suspending this partial.  This will also delete",!,"the partial Rx entered."
"RTN","PSORXL1",59,0)
 Q
"RTN","PSORXL1",60,0)
SWARN ;
"RTN","PSORXL1",61,0)
 S PSORXLDA=$G(DA),PSORXZD=$P($G(^PS(52.5,RXS,0)),"^",2)
"RTN","PSORXL1",62,0)
 W $C(7),!!,"Rx "_$P($G(^PSRX(DA,0)),"^")_" is already suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_$E(PSORXZD,4,5)_"-"_$E(PSORXZD,6,7)_"-"_$E(PSORXZD,2,3)_"." K PSORXZD
"RTN","PSORXL1",63,0)
 W !,"By suspending this fill, the fill that is already suspended will be overwritten",!,"and a label will not print for that fill!",!
"RTN","PSORXL1",64,0)
 K DIR S DIR(0)="SA^Q:QUEUE;S:SUSPEND",DIR("B")="Q",DIR("A")="Do you want to Queue to print or Suspend Rx "_$P($G(^PSRX(DA,0)),"^")_": " D ^DIR K DIR
"RTN","PSORXL1",65,0)
 I $G(Y)="S" K RXFL(PSORXLDA) G SWARNQ
"RTN","PSORXL1",66,0)
 I $G(Y)="Q" D  G SWARNQ
"RTN","PSORXL1",67,0)
 . S PSOKSPPL=$G(PPL),PSOZXPPL=$G(PPL1),PSOZXPI=$G(PI),RXLTOP=1
"RTN","PSORXL1",68,0)
 . S PPL=$G(RXN)_"," D SWARS D Q^PSORXL S PSOWFLG=1,PPL=PSOKSPPL
"RTN","PSORXL1",69,0)
 . S PI=PSOZXPI,PPL1=PSOZXPPL K PSOKSPPL,PSOZXPPL,PSOZXPI,RXLTOP,RXFL(+$G(PSORXLDA))
"RTN","PSORXL1",70,0)
 W !!,"Nothing queued to print for Rx "_$P($G(^PSRX(PSORXLDA,0)),"^"),! S PSOWFLG=1
"RTN","PSORXL1",71,0)
SWARNQ ;
"RTN","PSORXL1",72,0)
 S DA=$G(PSORXLDA) K PSORXLDA
"RTN","PSORXL1",73,0)
 Q
"RTN","PSORXL1",74,0)
SWARS ;
"RTN","PSORXL1",75,0)
 S PSOZXFL(PSORXLDA)=+$P($G(^PS(52.5,+$G(RXS),0)),"^",13) I '$G(PSOZXFL(PSORXLDA)) K PSOZXFL Q
"RTN","PSORXL1",76,0)
 S PSOZXFPL=$P(PSOKSPPL,",",+$G(PI),99)
"RTN","PSORXL1",77,0)
 S PSOZXFPN=$L(PSOZXFPL,PPL)-1
"RTN","PSORXL1",78,0)
 I $G(PSOZXFL(PSORXLDA)),$G(PSOZXFPN) S RXFL(PSORXLDA)=$G(PSOZXFL(PSORXLDA))-$G(PSOZXFPN)
"RTN","PSORXL1",79,0)
 K PSOZXFL,PSOZXFPL,PSOZXFPN
"RTN","PSORXL1",80,0)
 Q
"RTN","PSORXL1",81,0)
ECME ; - Looks for DUR/79 REJECTS and send Mail Rx's to ECME that have not been SUSPENDED
"RTN","PSORXL1",82,0)
 N PSOI,PSOJ,PSORX,PSORF,PSOACT,BWH,PPLTMP
"RTN","PSORXL1",83,0)
 S PPLTMP=$G(PPL)
"RTN","PSORXL1",84,0)
 F PSOI=1:1 S PSORX=+$P($G(PPL),",",PSOI) Q:'PSORX  D
"RTN","PSORXL1",85,0)
 . I $G(RXPR(PSORX)) Q
"RTN","PSORXL1",86,0)
 . S PSOACT="",PSORF=$$LSTRFL^PSOBPSU1(PSORX)
"RTN","PSORXL1",87,0)
 . S BWH=$S(PSORF:"RF",1:"OF")
"RTN","PSORXL1",88,0)
 . I $$FIND^PSOREJUT(PSORX,PSORF) D  I PSOACT="Q" D RMV(PSORX,.PPLTMP) Q
"RTN","PSORXL1",89,0)
 . . S PSOACT=$$HDLG^PSOREJU1(PSORX,PSORF,"79,88",BWH,"OIQ","Q")
"RTN","PSORXL1",90,0)
 S:$G(PPLTMP)'="" PPL=PPLTMP
"RTN","PSORXL1",91,0)
 Q
"RTN","PSORXL1",92,0)
RMV(RX,PPL) ; Remove the Rx from the label print queue
"RTN","PSORXL1",93,0)
 N XPPL,I
"RTN","PSORXL1",94,0)
 S XPPL=PPL,PPL="" F I=1:1:$L(XPPL,",") I $P(XPPL,",",I)'="",$P(XPPL,",",I)'=RX S PPL=PPL_$P(XPPL,",",I)_","
"RTN","PSORXL1",95,0)
 I PPL="" K PPL
"RTN","PSORXL1",96,0)
 Q
"RTN","PSORXVW")
0^14^B66871354
"RTN","PSORXVW",1,0)
PSORXVW ;BHAM ISC/SAB - listman view of a prescription ;5/25/05 2:10pm
"RTN","PSORXVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,35,46,96,103,88,117,131,146,156,185,210,148,233,260**;DEC 1997;Build 84
"RTN","PSORXVW",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORXVW",5,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXVW",6,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSORXVW",8,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSORXVW",9,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSORXVW",10,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSORXVW",11,0)
 ;
"RTN","PSORXVW",12,0)
 S PS="VIEW"
"RTN","PSORXVW",13,0)
A1 ; - Prescription prompt
"RTN","PSORXVW",14,0)
 S DIR(0)="FAO^1:30",DIR("A")=PS_" PRESCRIPTION: ",(DIR("?"),DIR("??"))="^D HLP^PSORXVW1"
"RTN","PSORXVW",15,0)
 W ! D ^DIR I X=""!$D(DIRUT) G KILL
"RTN","PSORXVW",16,0)
 S X=$$UP^XLFSTR(X),QUIT=0
"RTN","PSORXVW",17,0)
 I $E(X,1,2)'="E." S (DA,PSOVDA)=+$$LKP^PSORXVW1(X) I DA<0 G A1
"RTN","PSORXVW",18,0)
 I $E(X,1,2)="E." D  I QUIT G A1
"RTN","PSORXVW",19,0)
 . I $L(X)'=9 W !?5,"The ECME# must be 7 digits long!",$C(7) S QUIT=1 Q
"RTN","PSORXVW",20,0)
 . S (DA,PSOVDA)=+$$RXNUM^PSOBPSU2($E(X,3,9)) I DA<0 W " ??" S QUIT=1
"RTN","PSORXVW",21,0)
 ;
"RTN","PSORXVW",22,0)
DP S (PSODFN,DFN)=+$P(^PSRX(DA,0),"^",2) S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORXVW",23,0)
 D ICN^PSODPT(PSODFN)
"RTN","PSORXVW",24,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSORXVW",25,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1)
"RTN","PSORXVW",26,0)
 N PSOBADR,PSOTEMP
"RTN","PSORXVW",27,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN) I PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN) D
"RTN","PSORXVW",28,0)
 .S ^TMP("PSOHDR",$J,1,0)=^TMP("PSOHDR",$J,1,0)_" ** BAD ADDRESS INDICATED-("_$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER")_")"_$S(PSOTEMP:" Active Temporary Address",1:"")
"RTN","PSORXVW",29,0)
 S ^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSORXVW",30,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSORXVW",31,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSORXVW",32,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSORXVW",33,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSORXVW",34,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSORXVW",35,0)
 D DEM^VADPT I +VADM(6) D
"RTN","PSORXVW",36,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !,$C(7),?10,$P(^DPT(PSODFN,0),"^")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_$P(VADM(6),"^",2),!
"RTN","PSORXVW",37,0)
 .W "All Active Medications will be Autocanceled!",! H 2 S PSODEATH=1
"RTN","PSORXVW",38,0)
 .S ACOM="Date of Death "_$P(VADM(6),"^",2)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSORXVW",39,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSORXVW",40,0)
 K ^TMP("PSOAL",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS
"RTN","PSORXVW",41,0)
 S (DA,RXN)=PSOVDA K PSOVDA S RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1"))
"RTN","PSORXVW",42,0)
 I 'RXOR,$P(^PSDRUG($P(RX0,"^",6),2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG($P(RX0,"^",6),2),"^"),RXOR=$P(^PSDRUG($P(RX0,"^",6),2),"^")
"RTN","PSORXVW",43,0)
 S IEN=0,$P(RN," ",12)=" "
"RTN","PSORXVW",44,0)
 N APPND S APPND=$S($G(^PSRX(RXN,"IB")):"$",1:"")
"RTN","PSORXVW",45,0)
 I $$ECMENUM^PSOBPSU2(RXN)'="" S APPND=APPND_$$ECME^PSOBPSUT(RXN)_"  (ECME#: "_$$ECMENUM^PSOBPSU2(RXN)_")"
"RTN","PSORXVW",46,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")_$P(RX0,"^")_APPND_$E(RN,$L($P(RX0,"^")_APPND)+1,12)
"RTN","PSORXVW",47,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"No Pharmacy Orderable Item")
"RTN","PSORXVW",48,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"           CMOP ",1:"                ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSORXVW",49,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSORXVW",50,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSORXVW",51,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSORXVW",52,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Patient Instructions:" I $O(^PSRX(RXN,"INS1",0)) D
"RTN","PSORXVW",53,0)
 . F I=0:0 S I=$O(^PSRX(RXN,"INS1",I)) Q:'I  D
"RTN","PSORXVW",54,0)
 .. S MIG=^PSRX(RXN,"INS1",I,0)
"RTN","PSORXVW",55,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",56,0)
 K MIG,SG
"RTN","PSORXVW",57,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Other Pat. Instruc: "_$S($G(^PSRX(RXN,"INSS"))]"":^PSRX(RXN,"INSS"),1:"")
"RTN","PSORXVW",58,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 SIG:"
"RTN","PSORXVW",59,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) D  G PTST
"RTN","PSORXVW",60,0)
 . S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSORXVW",61,0)
 . D WORDWRAP^PSOUTLA2(SIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",62,0)
 S SIGOK=1
"RTN","PSORXVW",63,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D
"RTN","PSORXVW",64,0)
 . S MIG=^PSRX(RXN,"SIG1",I,0)
"RTN","PSORXVW",65,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",66,0)
 S SIGOK=1 K MIG,SG
"RTN","PSORXVW",67,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSORXVW",68,0)
 S ^TMP("PSOAL",$J,IEN,0)="      Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSORXVW",69,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSORXVW",70,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                 Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSORXVW",71,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",72,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSORXVW",73,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSORXVW",74,0)
  D CMOP^PSOORNE3 S DA=RXN
"RTN","PSORXVW",75,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSORXVW",76,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAL",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)
"RTN","PSORXVW",77,0)
 E  S ^TMP("PSOAL",$J,IEN,0)="   Last Release Date: " D
"RTN","PSORXVW",78,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSORXVW",79,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSORXVW",80,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSORXVW",81,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSORXVW",82,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                     Lot #: "_$P(RX2,"^",4)
"RTN","PSORXVW",83,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSORXVW",84,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                       MFG: "_$P($G(RX2),"^",8)
"RTN","PSORXVW",85,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSORXVW",86,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                        QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSORXVW",87,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSORXVW",88,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSORXVW",89,0)
 .S ^TMP("PSOAL",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSORXVW",90,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                       Remaining: "_REFL
"RTN","PSORXVW",91,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSORXVW",92,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSORXVW",93,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",94,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSORXVW",95,0)
 S:$P(RX0,"^",11)="W" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSORXVW",96,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSORXVW",97,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Division: "_$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")"
"RTN","PSORXVW",98,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSORXVW",99,0)
 S:$P(RX2,"^",10)&('$G(PSOCOPY)) IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Verified By: "_$P(^VA(200,$P(RX2,"^",10),0),"^")
"RTN","PSORXVW",100,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Patient Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSORXVW",101,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Remarks: "_$P(RX3,"^",7)
"RTN","PSORXVW",102,0)
 D PC^PSORXVW1
"RTN","PSORXVW",103,0)
 I $P($G(^PSRX(DA,"OR1")),"^",5) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Finished By: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^")
"RTN","PSORXVW",104,0)
 D ^PSORXVW1 S PSOAL=IEN K IEN,ACT,LBL,LOG
"RTN","PSORXVW",105,0)
 I ST<12,$P(RX2,"^",6)<DT S ST=11
"RTN","PSORXVW",106,0)
 S VALM("TITLE")="Rx View "_"("_$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST+2)_")"
"RTN","PSORXVW",107,0)
 S:$P($G(^PSRX(DA,"PKI")),"^") VALMSG="Digitally Signed Order"
"RTN","PSORXVW",108,0)
 D EN^PSOORAL,KILL G:PS="VIEW" PSORXVW
"RTN","PSORXVW",109,0)
 Q
"RTN","PSORXVW",110,0)
 ;
"RTN","PSORXVW",111,0)
KILL K ^TMP("PSOAL",$J),PSOAL,IEN,^TMP("PSOHDR",$J) K:PS="VIEW" DA
"RTN","PSORXVW",112,0)
 K ST,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSORXVW",113,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT,%,%I,DFN,GMRA,GMRAL,HDR,POERR,PTST,REFL,RF,RLD,RX3
"RTN","PSORXVW",114,0)
 K RXN,RXOR,SG,VA,VADM,VAERR,VALMBCK,VAPA,X,DIC,REA,ZD,PSOHD,PSOBCK,PSODFN
"RTN","PSORXVW",115,0)
 Q
"RTN","PSORXVW1")
0^17^B67149111
"RTN","PSORXVW1",1,0)
PSORXVW1 ;BIR/SAB-view prescription con't ;5/26/05 10:07am
"RTN","PSORXVW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**35,47,46,71,99,117,156,193,210,148,258,260**;DEC 1997;Build 84
"RTN","PSORXVW1",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXVW1",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW1",5,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSORXVW1",6,0)
 ;
"RTN","PSORXVW1",7,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",6) D
"RTN","PSORXVW1",8,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",6) D ^DIC
"RTN","PSORXVW1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           Filled By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",10,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",7) D
"RTN","PSORXVW1",11,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",7) D ^DIC
"RTN","PSORXVW1",12,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Checked By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",13,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(RX0,"^",16) D ^DIC
"RTN","PSORXVW1",14,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Entry By: "_$P(Y,"^",2)_$E(RN,$L($P(Y,"^",2))+1,35)
"RTN","PSORXVW1",15,0)
 S Y=$P(RX2,"^") X ^DD("DD")
"RTN","PSORXVW1",16,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Entry Date: "_$E($P(RX2,"^"),4,5)_"/"_$E($P(RX2,"^"),6,7)_"/"_$E($P(RX2,"^"),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSORXVW1",17,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" " ;,IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",18,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSORXVW1",19,0)
 I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSORXVW1",20,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"      Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW1",21,0)
 I $G(^PSRX(DA,"H"))]"",$P(^("STA"),"^")=3 D HLD
"RTN","PSORXVW1",22,0)
 D RF,PAR,ACT,COPAY^PSORXVW2,LBL,ECME^PSOORAL1,^PSORXVW2:$O(^PSRX(DA,4,0))
"RTN","PSORXVW1",23,0)
 Q
"RTN","PSORXVW1",24,0)
ACT ;activity log
"RTN","PSORXVW1",25,0)
 N CNT
"RTN","PSORXVW1",26,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSORXVW1",27,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",28,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSORXVW1",29,0)
 S CNT=0
"RTN","PSORXVW1",30,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSORXVW1",31,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSORXVW1",32,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2)
"RTN","PSORXVW1",33,0)
 .S REA=$F("HUCELPRWSIVDABXGKNM",REA)-1
"RTN","PSORXVW1",34,0)
 .I REA D
"RTN","PSORXVW1",35,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^ECME^","^",REA)
"RTN","PSORXVW1",36,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSORXVW1",37,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW1",38,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW1",39,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSORXVW1",40,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",3) D ^DIC
"RTN","PSORXVW1",41,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3))
"RTN","PSORXVW1",42,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSORXVW1",43,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSORXVW1",44,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSORXVW1",45,0)
 ..I $L(PSOACBRV)<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_PSOACBRV Q
"RTN","PSORXVW1",46,0)
 ..I $E(PSOACBRV,1,70)'[" " S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,70),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,71,245) Q
"RTN","PSORXVW1",47,0)
 ..F PSOACBRK=245:-1 Q:PSOACBRK=0  I $E(PSOACBRV,PSOACBRK)=" ",PSOACBRK<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,PSOACBRK),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,PSOACBRK,245) Q
"RTN","PSORXVW1",48,0)
 .I $G(^PSRX(DA,"A",N,1))]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P(^PSRX(DA,"A",N,1),"^") I $P(^PSRX(DA,"A",N,1),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P(^PSRX(DA,"A",N,1),"^",2)
"RTN","PSORXVW1",49,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(RXN,"A",N,2,I)) Q:'I  S MIG=^PSRX(RXN,"A",N,2,I,0) D
"RTN","PSORXVW1",50,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSORXVW1",51,0)
 K MIG,SG,I Q
"RTN","PSORXVW1",52,0)
LBL ;label log
"RTN","PSORXVW1",53,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSORXVW1",54,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",55,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSORXVW1",56,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSORXVW1",57,0)
 .S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSORXVW1",58,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(LBL,"^",4) D ^DIC
"RTN","PSORXVW1",59,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P(Y,"^",2),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSORXVW1",60,0)
 K DIC,X,Y Q
"RTN","PSORXVW1",61,0)
RF ;refill log
"RTN","PSORXVW1",62,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSORXVW1",63,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",64,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSORXVW1",65,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSORXVW1",66,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSORXVW1",67,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSORXVW1",68,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSORXVW1",69,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSORXVW1",70,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",5) D ^DIC
"RTN","PSORXVW1",71,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S(+Y:$P(Y,"^",2),1:""),1,16) K DIC,X,Y
"RTN","PSORXVW1",72,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSORXVW1",73,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSORXVW1",74,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSORXVW1",75,0)
 .I $$STATUS^PSOBPSUT(DA,N)'="",$$RXRLDT^PSOBPSUT(DA,N) S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSORXVW1",76,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS
"RTN","PSORXVW1",77,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSORXVW1",78,0)
 K RTS Q
"RTN","PSORXVW1",79,0)
PAR ;partial log
"RTN","PSORXVW1",80,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSORXVW1",81,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",82,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSORXVW1",83,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSORXVW1",84,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSORXVW1",85,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSORXVW1",86,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSORXVW1",87,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSORXVW1",88,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",16) D ^DIC
"RTN","PSORXVW1",89,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S(+Y:$P(Y,"^",2),1:""),1,16)
"RTN","PSORXVW1",90,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSORXVW1",91,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",7) D ^DIC
"RTN","PSORXVW1",92,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",93,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSORXVW1",94,0)
 Q
"RTN","PSORXVW1",95,0)
HLD ;hold info
"RTN","PSORXVW1",96,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$P(^DD(52,99,0),"^",3),HLDR=$S($P(^PSRX(DA,"H"),"^")'>8:$P(HLDR,";",$P(^PSRX(DA,"H"),"^")),1:$P(HLDR,";",9)),HLDR=$P(HLDR,":",2)
"RTN","PSORXVW1",97,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT S:$P(^PSRX(DA,"H"),"^",2)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$P(^PSRX(DA,"H"),"^",2)
"RTN","PSORXVW1",98,0)
 K RN,DAT,DTT,HLDR
"RTN","PSORXVW1",99,0)
 Q
"RTN","PSORXVW1",100,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW1",101,0)
 Q
"RTN","PSORXVW1",102,0)
INST ;formats instruction from front door
"RTN","PSORXVW1",103,0)
 I $O(^PSRX(DA,"PI",0)) D
"RTN","PSORXVW1",104,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Instructions:"
"RTN","PSORXVW1",105,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSORXVW1",106,0)
 ..S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSORXVW1",107,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",108,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",109,0)
 Q
"RTN","PSORXVW1",110,0)
PC ;displays provider comments
"RTN","PSORXVW1",111,0)
 I $O(^PSRX(DA,"PRC",0)) D
"RTN","PSORXVW1",112,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Provider Comments:"
"RTN","PSORXVW1",113,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSORXVW1",114,0)
 ..S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSORXVW1",115,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",116,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",117,0)
 Q
"RTN","PSORXVW1",118,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW1",119,0)
 D DOSE^PSORXVW2
"RTN","PSORXVW1",120,0)
 Q
"RTN","PSORXVW1",121,0)
 ;
"RTN","PSORXVW1",122,0)
HLP ; Help Text for the VIEW PRESCRIPTION prompt 
"RTN","PSORXVW1",123,0)
 W !," You may enter E.NNNNNNN, where NNNNNNN is the"
"RTN","PSORXVW1",124,0)
 W !," prescription ECME# (e.g., E.0289332) or,"
"RTN","PSORXVW1",125,0)
 D LKP("?")
"RTN","PSORXVW1",126,0)
 Q 
"RTN","PSORXVW1",127,0)
LKP(INPUT) ; - Peforms Lookup on the PRESCRIPTION file
"RTN","PSORXVW1",128,0)
 N DIC,X,Y
"RTN","PSORXVW1",129,0)
 S DIC="^PSRX(",DIC(0)="QE",D="B",X=INPUT
"RTN","PSORXVW1",130,0)
 S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")'=13"
"RTN","PSORXVW1",131,0)
 D IX^DIC
"RTN","PSORXVW1",132,0)
 Q Y
"RTN","PSOSULBL")
0^30^B64818200
"RTN","PSOSULBL",1,0)
PSOSULBL ;BHAM ISC/RTR,SAB-Print Suspended labels ;4/8/93
"RTN","PSOSULBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**139,173,174,148,200,260**;DEC 1997;Build 84
"RTN","PSOSULBL",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOSULBL",4,0)
 ;Reference to SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSOSULBL",5,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOSULBL",6,0)
 K PDUZ,REPRINT G ^PSOSULB1
"RTN","PSOSULBL",7,0)
BEG ;
"RTN","PSOSULBL",8,0)
 K PSORUNIN,PSORETRY N BPSCNT
"RTN","PSOSULBL",9,0)
 S PSORUNIN="PSOSUSP"_($G(PSOSITE))
"RTN","PSOSULBL",10,0)
 L +@PSORUNIN:10 I '$T D
"RTN","PSOSULBL",11,0)
 . F PSORETRY=1:1:120 L +@PSORUNIN:60 I $T Q  ;wait Max of 2 hrs before continue
"RTN","PSOSULBL",12,0)
 . Q
"RTN","PSOSULBL",13,0)
 K ^UTILITY($J,"PSOPRO"),^TMP("PSOSBAI",$J) S PSOSEQ=1 F DFN=0:0 S DFN=$O(^PS(52.5,"AC",DFN)) Q:'DFN  D  D:'PSRT PID^VADPT6 D CHKDEAD D:'DEAD&($G(PSOSFLAG)) PRT
"RTN","PSOSULBL",14,0)
 .S PSOSFLAG=0 F ZZ=0:0 S ZZ=$O(^PS(52.5,"AC",DFN,ZZ)) Q:'ZZ!$G(PSOSFLAG)  I ZZ'>PRTDT S PSOSFLAG=1
"RTN","PSOSULBL",15,0)
 D PPL
"RTN","PSOSULBL",16,0)
 D:$D(^UTILITY($J,"PSOPRO"))&($P(PSOPAR,"^",8)) PROF
"RTN","PSOSULBL",17,0)
 G EXIT
"RTN","PSOSULBL",18,0)
PRT F SDT=0:0 S SDT=$O(^PS(52.5,"AC",DFN,SDT)) D:SDT CHK Q:'SDT
"RTN","PSOSULBL",19,0)
 Q
"RTN","PSOSULBL",20,0)
EXIT ;
"RTN","PSOSULBL",21,0)
 I $D(^TMP("PSOSBAI",$J)) D CHKMAIL
"RTN","PSOSULBL",22,0)
 K ^TMP($J),^TMP("PSOSBAI",$J)
"RTN","PSOSULBL",23,0)
 I $D(PSORUNIN) L -@PSORUNIN
"RTN","PSOSULBL",24,0)
 D ^%ZISC
"RTN","PSOSULBL",25,0)
 K %,%ZIS,CNT,COM,DA,DEAD,DFN,DIRUT,DTTM,G,HDPPL,JJ,JJJ,JJJJ,PDUZ,IOP,ORD,PFIOQ,PSLION,PSRT,POP,PRF,PRTDT,PSLIO,PSNP,PSODBQ,PSOSEQ,PSOSFLAG,PSOSU,PSOTIME,PSOOUT,PSOPRFLG,PSOSEQ,PSOSUSPR,PSSPND,PST,PTL,PPLHLD,PSFNIEN,ZTSK
"RTN","PSOSULBL",26,0)
 K PSOBADDR,PSORUNIN,PSORETRY,PSRTONE,PSSRT,PSUSDEA,RF,RFCNT,RX,SDT,SFN,SREC,STOP,SUSPT,VADM,VAPA,X,X1,X2,XAK,XDATE,Y,Z,ZZ,WWW,PSDDDATE,SINRX,RXPR,RXPR1,GGGG,XXX,ZII,ZTDESC,ZTRTN,ZTSAVE,RRRR,RXRP,RXRP1,RXFL,SPR S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOSULBL",27,0)
CHK I SDT'>XDATE D TMP Q
"RTN","PSOSULBL",28,0)
 Q
"RTN","PSOSULBL",29,0)
TMP F SFN=0:0 S SFN=$O(^PS(52.5,"AC",DFN,SDT,SFN)) Q:'SFN  D
"RTN","PSOSULBL",30,0)
 . I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+DFN,0)) Q
"RTN","PSOSULBL",31,0)
 . N RXSITE,PRINTED,PSDFN,RXSTS,RXIEN,RXFILL,PARTIAL,RXEXPDT,RESP
"RTN","PSOSULBL",32,0)
 . S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I"),RXDFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSOSULBL",33,0)
 . S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I"),RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I"),PRINTED=+$$GET1^DIQ(52.5,SFN,2,"I")
"RTN","PSOSULBL",34,0)
 . S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I"),RXEXPDT=$$GET1^DIQ(52,RXIEN,26,"I")
"RTN","PSOSULBL",35,0)
 . S RXFILL=$$GET1^DIQ(52.5,SFN,9,"I") I RXFILL="" S RXFILL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULBL",36,0)
 . I RXSITE=$G(PSOSITE),'PRINTED,RXDFN=DFN,RXSTS<9 D
"RTN","PSOSULBL",37,0)
 . . I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOSULBL",38,0)
 . . I RXEXPDT<DT,RXSTS<11 D  Q
"RTN","PSOSULBL",39,0)
 . . . N RXREC S RXREC=RXIEN D EX^PSOSUTL
"RTN","PSOSULBL",40,0)
 . . . K DIE,DA S DIE=52,DA=RXIEN,DR="100///11" D ^DIE K DIE,DA
"RTN","PSOSULBL",41,0)
 . . . K DIK,DA S DA=SFN,DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOSULBL",42,0)
 . . S PSOBADDR=0 D CHKBAI I PSOBADDR Q
"RTN","PSOSULBL",43,0)
 . . I PSRT="D" D
"RTN","PSOSULBL",44,0)
 . . . S PSSRT=$S($G(PSRTONE)="I":VA("PID"),1:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9))
"RTN","PSOSULBL",45,0)
 . . . S PSUSDEA=$P($G(^PS(52.5,SFN,0)),"^",10)
"RTN","PSOSULBL",46,0)
 . . . S SRT=$S(PSUSDEA["A"!(PSUSDEA["C"):"A-"_PSSRT,PSUSDEA["S":"S-"_PSSRT,1:"Z-"_PSSRT)
"RTN","PSOSULBL",47,0)
 . . I PSRT'="D" D
"RTN","PSOSULBL",48,0)
 . . . S SRT=$S(PSRT:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9),1:VA("PID"))
"RTN","PSOSULBL",49,0)
 . . ; - If not partial fill, sending Rx to ECME for 3rd Party billing
"RTN","PSOSULBL",50,0)
 . . I 'PARTIAL,$$RETRX^PSOBPSUT(RXIEN,RXFILL),SDT>DT Q
"RTN","PSOSULBL",51,0)
 . . I 'PARTIAL D  I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",52,0)
 . . . I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",53,0)
 . . . I '$$RETRX^PSOBPSUT(RXIEN,RXFILL),$$STATUS^PSOBPSUT(RXIEN,RXFILL)'="" Q
"RTN","PSOSULBL",54,0)
 . . . D ECMESND^PSOBPSU1(RXIEN,RXFILL,,"PL",,,,,,.RESP) I $D(RESP),'RESP S BPSCNT=$G(BPSCNT)+1
"RTN","PSOSULBL",55,0)
 . . S ^TMP($J,SRT,SFN)=RXIEN
"RTN","PSOSULBL",56,0)
 Q
"RTN","PSOSULBL",57,0)
PPL ; Wait some time before printing so response from 3rd party payers can be received
"RTN","PSOSULBL",58,0)
 I $G(BPSCNT)>0 H 60+$S((BPSCNT*15)>7200:7200,1:(BPSCNT*15))
"RTN","PSOSULBL",59,0)
 K PPL,PPL1 S ORD="" F  S ORD=$O(^TMP($J,ORD)) Q:ORD=""  D PPL1
"RTN","PSOSULBL",60,0)
 Q
"RTN","PSOSULBL",61,0)
PPL1 ; Printing Labels
"RTN","PSOSULBL",62,0)
 N PARTIAL,REPRINT,REFILL,Z,QUIT
"RTN","PSOSULBL",63,0)
 S (PSOPRFLG,SUSPT)=1 S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSOSULBL",64,0)
 S:'$D(PDUZ) PDUZ=DUZ K RXPR,RXPR1,PPL
"RTN","PSOSULBL",65,0)
 F SFN=0:0 S SFN=$O(^TMP($J,ORD,SFN)) Q:'SFN  D
"RTN","PSOSULBL",66,0)
 .I '$D(^PS(52.5,SFN,0)) Q
"RTN","PSOSULBL",67,0)
 .S Z=$G(^PS(52.5,SFN,0)),SINRX=+$P(Z,"^"),REFILL=+$P(Z,"^",13)
"RTN","PSOSULBL",68,0)
 .S PARTIAL=$P(Z,"^",5),REPRINT=$P(Z,"^",12)
"RTN","PSOSULBL",69,0)
 .; - Screening out OPEN/UNRESOLVED Rejects (3rd Party Payer)
"RTN","PSOSULBL",70,0)
 .S QUIT=0
"RTN","PSOSULBL",71,0)
 .I 'PARTIAL,'REPRINT D  I QUIT Q
"RTN","PSOSULBL",72,0)
 ..I $$FIND^PSOREJUT(SINRX,REFILL) S QUIT=1 Q
"RTN","PSOSULBL",73,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="IN PROGRESS" S QUIT=1 Q
"RTN","PSOSULBL",74,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="E PAYABLE" D
"RTN","PSOSULBL",75,0)
 ...D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,SINRX,6,"I"),$$RXSITE^PSOBPSUT(SINRX,REFILL),$$GETNDC^PSONDCUT(SINRX,REFILL))
"RTN","PSOSULBL",76,0)
 .;
"RTN","PSOSULBL",77,0)
 .I $L($G(PPL))<240 D
"RTN","PSOSULBL",78,0)
 ..S PPL=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL),RXPR(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",79,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP(SINRX)=1
"RTN","PSOSULBL",80,0)
 .E  D
"RTN","PSOSULBL",81,0)
 ..S PPL1=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL1),RXPR1(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",82,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP1(SINRX)=1
"RTN","PSOSULBL",83,0)
 .S DFN=$P(^PS(52.5,SFN,0),"^",3)
"RTN","PSOSULBL",84,0)
 .I $P(PSOPAR,"^",8),'$D(^PSRX($P(^PS(52.5,SFN,0),"^"),1)),'$G(RXPR(SINRX)),'$G(RXPR1(SINRX)) S PSOPRFLG=0
"RTN","PSOSULBL",85,0)
 S PSNP=$S($P(PSOPAR,"^",8):1,1:0)
"RTN","PSOSULBL",86,0)
 I $G(PPL) D
"RTN","PSOSULBL",87,0)
 .S PPLHLD=$G(PPL1),HDPPL=PPL K PPL1 S (PSODBQ,PSOSUSPR)=1
"RTN","PSOSULBL",88,0)
 .F GGGG=0:0 S GGGG=$O(RXPR(GGGG)) Q:'GGGG  K:'$G(RXPR(GGGG)) RXPR(GGGG)
"RTN","PSOSULBL",89,0)
 I $G(PPL) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",90,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",91,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",92,0)
 I $G(PPLHLD) K RXPR S (PPL,HDPPL)=PPLHLD,(PSODBQ,PSOSUSPR)=1,PSNP=0 S:'$D(PDUZ) PDUZ=DUZ F XXX=0:0 S XXX=$O(RXPR1(XXX)) Q:'XXX  S:$G(RXPR1(XXX)) RXPR(XXX)=RXPR1(XXX)
"RTN","PSOSULBL",93,0)
 I $G(PPLHLD) F RRRR=0:0 S RRRR=$O(RXRP1(RRRR)) Q:'RRRR  S:$D(RXRP1(RRRR)) RXRP(RRRR)=1
"RTN","PSOSULBL",94,0)
 I $G(PPLHLD) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",95,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",96,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",97,0)
 K PPL,PPL1,PPLHLD,RXPR,RXPR1,RXFL Q
"RTN","PSOSULBL",98,0)
SEQ ;
"RTN","PSOSULBL",99,0)
 S SQCOUNT=0 F JJJ=1:1:$L(HDPPL) S:$E(HDPPL,JJJ)="," SQCOUNT=SQCOUNT+1
"RTN","PSOSULBL",100,0)
 F JJJJ=1:1:SQCOUNT S PSFNIEN=$P(HDPPL,",",JJJJ) D:PSFNIEN
"RTN","PSOSULBL",101,0)
 .S PSFNIEN=$O(^PS(52.5,"B",PSFNIEN,0)) I PSFNIEN D
"RTN","PSOSULBL",102,0)
 ..S $P(^PS(52.5,PSFNIEN,0),"^",11)=PSOSEQ,PSOSEQ=PSOSEQ+1 S:$P(^PS(52.5,PSFNIEN,0),"^",8)&($P(^(0),"^",9))&($P(^(0),"^",6)) ^PS(52.5,"AS",$P(^PS(52.5,PSFNIEN,0),"^",8),$P(^(0),"^",9),$P(^(0),"^",6),$P(^(0),"^",11),PSFNIEN)=""
"RTN","PSOSULBL",103,0)
 Q
"RTN","PSOSULBL",104,0)
CHKDEAD D DEM^VADPT I VADM(1)="" S DEAD=0 Q
"RTN","PSOSULBL",105,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSULBL",106,0)
 S PSDDDATE=$P(VADM(6),"^",2) F WWW=0:0 S WWW=$O(^PS(55,DFN,"P",WWW)) Q:'WWW  I $D(^PS(55,DFN,"P",WWW,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") S SFN=$O(^PS(52.5,"B",RXREC,0)) I SFN,$D(^PS(52.5,SFN,0)) S RX=$P(^(0),"^") D DEAD
"RTN","PSOSULBL",107,0)
 Q
"RTN","PSOSULBL",108,0)
DEAD S $P(^PSRX(RX,"STA"),"^")=12,COM="Died ("_$G(PSDDDATE)_")",DA(1)=RX
"RTN","PSOSULBL",109,0)
 S DEAD=1 D ARECD^PSOSUTL S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK
"RTN","PSOSULBL",110,0)
 Q
"RTN","PSOSULBL",111,0)
PROF ;
"RTN","PSOSULBL",112,0)
 S ZTRTN="PRPROF^PSOSULBL",ZTDESC="PRINT PROFILES FROM SUSPENSE",ZTDTH=$H,ZTIO=PSOPROP
"RTN","PSOSULBL",113,0)
 S ZTSAVE("^UTILITY($J,""PSOPRO"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSODTCUT")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSOPRPAS")="" D ^%ZTLOAD Q
"RTN","PSOSULBL",114,0)
PRPROF ;
"RTN","PSOSULBL",115,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"PSOPRO",LLL)) Q:'LLL  I $D(^DPT(LLL,0)) S DFN=LLL D DQ^PSOPRFSS
"RTN","PSOSULBL",116,0)
 K PSOPAR,PSODTCUT,PSOSITE,PSOPRPAS,LLL,DFN,^UTILITY($J,"PSOPRO") D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULBL",117,0)
 Q
"RTN","PSOSULBL",118,0)
 ;
"RTN","PSOSULBL",119,0)
CHKBAI ; IF BAD ADDRESS INDICATOR, NO ACTIVE TEMPORARY ADDRESS AND ROUTING OF MAIL, DO NOT SEND TO OPAI AND/OR DO NOT PRINT LABEL
"RTN","PSOSULBL",120,0)
 N PSOBADR,ACTSEQ,XX,PSOFIRST,ACTTYPE
"RTN","PSOSULBL",121,0)
 I '$G(RXFILL),$P(^PSRX(RXIEN,0),"^",11)="W" Q
"RTN","PSOSULBL",122,0)
 I $P($G(^PSRX(RXIEN,1,RXFILL,0)),"^",2)="W" Q
"RTN","PSOSULBL",123,0)
 S ACTTYPE="BAD ADDRESS INDICATOR"
"RTN","PSOSULBL",124,0)
 S PSOBADR=$$CHKRX^PSOBAI(RXIEN)
"RTN","PSOSULBL",125,0)
 ; GOOD PERMANENT OR TEMPORARY ADDRESS - CHECK FOR DO NOT MAIL
"RTN","PSOSULBL",126,0)
 I PSOBADR,'$P(PSOBADR,"^",2) D SETTMP(ACTTYPE) Q
"RTN","PSOSULBL",127,0)
 D NOMAIL
"RTN","PSOSULBL",128,0)
 Q
"RTN","PSOSULBL",129,0)
 ;
"RTN","PSOSULBL",130,0)
SETTMP(ACTTYPE) ;
"RTN","PSOSULBL",131,0)
 N ACTSEQ,XX,PSOFIRST,ZZ
"RTN","PSOSULBL",132,0)
 S PSOFIRST=1
"RTN","PSOSULBL",133,0)
 S PSOBADDR=1
"RTN","PSOSULBL",134,0)
 S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",135,0)
 .S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE S PSOFIRST=0 Q
"RTN","PSOSULBL",136,0)
 I PSOFIRST D
"RTN","PSOSULBL",137,0)
 .S ^TMP("PSOSBAI",$J,RXIEN,+RXFILL)=ACTTYPE
"RTN","PSOSULBL",138,0)
 .D ACT(ACTTYPE)
"RTN","PSOSULBL",139,0)
 Q
"RTN","PSOSULBL",140,0)
 ;
"RTN","PSOSULBL",141,0)
NOMAIL ; SEE IF FILE 55 STATUS IS DO NOT MAIL
"RTN","PSOSULBL",142,0)
 N ACTTYPE,DFN,MAILST,MAILEXP
"RTN","PSOSULBL",143,0)
 S ACTTYPE="DO NOT MAIL"
"RTN","PSOSULBL",144,0)
 S DFN=+$P($G(^PSRX(RXIEN,0)),"^",2),MAILST=$P($G(^PS(55,DFN,0)),"^",3) I MAILST'=2 Q
"RTN","PSOSULBL",145,0)
 S MAILEXP=$P(^PS(55,DFN,0),"^",5)
"RTN","PSOSULBL",146,0)
 I MAILEXP=""!(MAILEXP>DT) D SETTMP(ACTTYPE)
"RTN","PSOSULBL",147,0)
 Q
"RTN","PSOSULBL",148,0)
 ;
"RTN","PSOSULBL",149,0)
CHKMAIL ; SEE IF MAILMAN MESSAGE SHOULD BE SENT FOR BAI/MAIL ROUTING
"RTN","PSOSULBL",150,0)
 N RXIEN,RXFILL,ACTSEQ,XX,DFN,SSN,NAME,ACTTYPE,ZZ
"RTN","PSOSULBL",151,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",152,0)
 S RXIEN=0 F  S RXIEN=$O(^TMP("PSOSBAI",$J,RXIEN)) Q:'RXIEN  D
"RTN","PSOSULBL",153,0)
 .S RXFILL="" F  S RXFILL=$O(^TMP("PSOSBAI",$J,RXIEN,RXFILL)) Q:RXFILL=""  D
"RTN","PSOSULBL",154,0)
 ..S ACTTYPE=^TMP("PSOSBAI",$J,RXIEN,RXFILL)
"RTN","PSOSULBL",155,0)
 ..S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",156,0)
 ...S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE Q
"RTN","PSOSULBL",157,0)
 ...S DFN=$P(^PSRX(RXIEN,0),"^",2),NAME=$P(^DPT(DFN,0),"^"),SSN=$P(^(0),"^",9) I SSN="" S SSN=0
"RTN","PSOSULBL",158,0)
 ...S ^TMP("PSOSM",$J,NAME,SSN,RXIEN,RXFILL)=ACTTYPE
"RTN","PSOSULBL",159,0)
 I $D(^TMP("PSOSM",$J)) D BAIMAIL^PSOSULB1
"RTN","PSOSULBL",160,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",161,0)
 Q
"RTN","PSOSULBL",162,0)
 ;
"RTN","PSOSULBL",163,0)
ACT(ACTTYPE) ;adds activity info for rx not printed from suspense/not sent to OPAI
"RTN","PSOSULBL",164,0)
 N NOW,IR,FDA
"RTN","PSOSULBL",165,0)
 D NOW^%DTC S NOW=%
"RTN","PSOSULBL",166,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RXIEN,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOSULBL",167,0)
 S IR=IR+1,^PSRX(RXIEN,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOSULBL",168,0)
 S ^PSRX(RXIEN,"A",IR,0)=NOW_"^"_"S"_"^"_DUZ_"^"_$S(+RXFILL>5:RXFILL+1,1:+RXFILL)_"^"_"RX not printed from suspense due to "_ACTTYPE
"RTN","PSOSULBL",169,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOSULBL",170,0)
 Q
"SEC","^DIC",52.85,52.85,0,"AUDIT")
@
"SEC","^DIC",52.85,52.85,0,"DD")
@
"SEC","^DIC",52.85,52.85,0,"DEL")
@
"SEC","^DIC",52.85,52.85,0,"LAYGO")
@
"SEC","^DIC",52.85,52.85,0,"RD")
@
"SEC","^DIC",52.85,52.85,0,"WR")
@
"UP",52,52.25,-1)
52^REJ
"UP",52,52.25,0)
52.25
"UP",52,52.2551,-2)
52^REJ
"UP",52,52.2551,-1)
52.25^COM
"UP",52,52.2551,0)
52.2551
"VER")
8.0^22.0
"^DD",52,52.25,24,0)
CLARIFICATION CODE^S^0:NOT SPECIFIED;1:NO OVERRIDE;2:OTHER OVERRIDE;3:VACATION SUPPLY;4:LOST PRESCRIPTION;5:THERAPY CHANGE;6:STARTER DOSE;7:MEDICALLY NECESSARY;8:PROCESS COMPOUND;9:ENCOUNTERS;99:OTHER;^0;15^Q
"^DD",52,52.25,24,"DT")
3061108
"^DD",52,52.25,25,0)
PRIOR AUTHORIZATION TYPE^S^0:NOT SPECIFIED;1:PRIOR AUTHORIZATION;2:MEDICAL CERTIFICATION;3:EPSDT;4:EXEMPTION FROM COPAY;5:EXEMPTION FROM RX LIMITS;6:FAMILY PLANNING INDICATOR;7:AFDC;8:PAYER DEFINED EXEMPTION;^0;16^Q
"^DD",52,52.25,25,4)

"^DD",52,52.25,25,21,0)
^^1^1^3070216^
"^DD",52,52.25,25,21,1,0)
NCPDP Prior Authorization Type.
"^DD",52,52.25,25,"DT")
3070312
"^DD",52,52.25,26,0)
PRIOR AUTHORIZATION NUMBER^NJ12,0^^0;17^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",52,52.25,26,3)
Type a number between 0 and 999999999999, 0 Decimal Digits
"^DD",52,52.25,26,21,0)
^.001^1^1^3070508^^^
"^DD",52,52.25,26,21,1,0)
NCPDP Prior Authorization Number. This field may be left blank if the claim does not require a number.
"^DD",52,52.25,26,"DT")
3070221
"^DD",52,52.25,51,0)
COMMENTS^52.2551DA^^COM;0
"^DD",52,52.2551,0)
COMMENTS SUB-FIELD^^2^3
"^DD",52,52.2551,0,"DIK")
PSOXZA
"^DD",52,52.2551,0,"DT")
3061103
"^DD",52,52.2551,0,"IX","B",52.2551,.01)

"^DD",52,52.2551,0,"NM","COMMENTS")

"^DD",52,52.2551,0,"UP")
52.25
"^DD",52,52.2551,.01,0)
DATE/TIME^D^^0;1^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",52,52.2551,.01,1,0)
^.1
"^DD",52,52.2551,.01,1,1,0)
52.2551^B
"^DD",52,52.2551,.01,1,1,1)
S ^PSRX(DA(2),"REJ",DA(1),"COM","B",$E(X,1,30),DA)=""
"^DD",52,52.2551,.01,1,1,2)
K ^PSRX(DA(2),"REJ",DA(1),"COM","B",$E(X,1,30),DA)
"^DD",52,52.2551,.01,3)
(No range limit on date)
"^DD",52,52.2551,.01,21,0)
^.001^1^1^3061102^^
"^DD",52,52.2551,.01,21,1,0)
Reject comment
"^DD",52,52.2551,.01,23,0)
^^1^1^3061102^
"^DD",52,52.2551,.01,23,1,0)
Date and Time
"^DD",52,52.2551,.01,"DT")
3061103
"^DD",52,52.2551,1,0)
USER^P200'^VA(200,^0;2^Q
"^DD",52,52.2551,1,3)
Enter the user who makes the comment.
"^DD",52,52.2551,1,21,0)
^^1^1^3061102^
"^DD",52,52.2551,1,21,1,0)
The user who makes the comment.
"^DD",52,52.2551,1,"DT")
3061102
"^DD",52,52.2551,2,0)
COMMENTS^F^^0;3^K:$L(X)>150!($L(X)<1) X
"^DD",52,52.2551,2,3)
Answer must be 1-150 characters in length.
"^DD",52,52.2551,2,21,0)
^^1^1^3061102^
"^DD",52,52.2551,2,21,1,0)
Reject comment.
"^DD",52,52.2551,2,"DT")
3061103
"^DD",52.85,52.85,0)
FIELD^^51^8
"^DD",52.85,52.85,0,"DDA")
N
"^DD",52.85,52.85,0,"DT")
3070403
"^DD",52.85,52.85,0,"IX","B",52.85,.01)

"^DD",52.85,52.85,0,"NM","EPHARMACY MEDICATION PROFILE PREFERENCES")

"^DD",52.85,52.85,0,"VRPK")
PSO
"^DD",52.85,52.85,.01,0)
DIVISION^RP59'^PS(59,^0;1^Q
"^DD",52.85,52.85,.01,1,0)
^.1
"^DD",52.85,52.85,.01,1,1,0)
52.85^B
"^DD",52.85,52.85,.01,1,1,1)
S ^PS(52.85,"B",$E(X,1,30),DA)=""
"^DD",52.85,52.85,.01,1,1,2)
K ^PS(52.85,"B",$E(X,1,30),DA)
"^DD",52.85,52.85,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",52.85,52.85,.01,21,0)
^^1^1^3070403^
"^DD",52.85,52.85,.01,21,1,0)
This is the Pharmacy Division for which the division-specific Medication Profile preferences refer to.  
"^DD",52.85,52.85,.01,"DT")
3070403
"^DD",52.85,52.85,1,0)
EXP/CANCEL CUTOFF^NJ4,0^^0;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1.N) X
"^DD",52.85,52.85,1,3)
Type a number between 0 and 9999, 0 Decimal Digits
"^DD",52.85,52.85,1,21,0)
^^4^4^3070403^^
"^DD",52.85,52.85,1,21,1,0)
This is the default cutoff number of days for a expired or discontinued prescription to be displayed in the ePharmacy Medication Profile for the users logged into the Outpatient Pharmacy application under this Pharmacy Division. The number of
"^DD",52.85,52.85,1,21,2,0)
days count from the date the prescription was either expired or discontinued.
"^DD",52.85,52.85,1,21,3,0)
 
"^DD",52.85,52.85,1,21,4,0)
Note: This parameter can be overridden by user specific preferences.
"^DD",52.85,52.85,1,"DT")
3070403
"^DD",52.85,52.85,2,0)
SORT BY^S^RX:RX NUMBER;DR:DRUG NAME;ID:ISSUE DATE;LF:LAST FILL;^0;3^Q
"^DD",52.85,52.85,2,21,0)
^^3^3^3070403^^
"^DD",52.85,52.85,2,21,1,0)
This is the default 'SORT BY' column in the ePharmacy Medication Profile for the users logged into the Outpatient Pharmacy application under this Pharmacy Division.
"^DD",52.85,52.85,2,21,2,0)
 
"^DD",52.85,52.85,2,21,3,0)
Note: This parameter can be overridden by user specific preferences.  
"^DD",52.85,52.85,2,"DT")
3070403
"^DD",52.85,52.85,3,0)
SORT ORDER^S^A:ASCENDING;D:DESCENDING;^0;4^Q
"^DD",52.85,52.85,3,21,0)
^^3^3^3070403^
"^DD",52.85,52.85,3,21,1,0)
This is the default sorting order (Ascending or Descending) column in the ePharmacy Medication Profile for the users logged into the Outpatient Pharmacy application under this Pharmacy Division.  
"^DD",52.85,52.85,3,21,2,0)
 
"^DD",52.85,52.85,3,21,3,0)
Note: This parameter can be overridden by user specific preferences.  
"^DD",52.85,52.85,3,"DT")
3070403
"^DD",52.85,52.85,4,0)
DISPLAY SIG^S^0:OFF;1:ON;^0;5^Q
"^DD",52.85,52.85,4,21,0)
^^4^4^3070403^^
"^DD",52.85,52.85,4,21,1,0)
This is the default value (ON/OFF) that determine whether the SIG will be displayed or not in the ePharmacy Medication Profile for the users logged into the Outpatient Pharmacy application under this Pharmacy Division. When 'ON', the SIG is
"^DD",52.85,52.85,4,21,2,0)
displayed in the line right below its respective prescription.  
"^DD",52.85,52.85,4,21,3,0)
  
"^DD",52.85,52.85,4,21,4,0)
Note: This parameter can be overridden by user specific preferences.  
"^DD",52.85,52.85,4,"DT")
3070403
"^DD",52.85,52.85,5,0)
GROUP BY STATUS^S^0:OFF;1:ON;^0;6^Q
"^DD",52.85,52.85,5,21,0)
^^4^4^3070403^^^
"^DD",52.85,52.85,5,21,1,0)
This is the default value (YES/NO) that determine whether the list of prescription should be group by status (Active, Discontinued, Hold, etc.) or not in the ePharmacy Medication Profile for the users logged into the Outpatient Pharmacy
"^DD",52.85,52.85,5,21,2,0)
application under this Pharmacy Division. When this parameter is set to 'NO', all the regular prescriptions (excludes: Non-VA Meds, Pending Orders and REFILL TOO SOON/DUR prescriptions) are listed under the 'CURRENT ORDERS' group. 
"^DD",52.85,52.85,5,21,3,0)
                                  
"^DD",52.85,52.85,5,21,4,0)
Note: This parameter can be overridden by user specific preferences.  
"^DD",52.85,52.85,5,"DT")
3070403
"^DD",52.85,52.85,6,0)
DISPLAY ORDER COUNT^S^0:OFF;1:ON;^0;7^Q
"^DD",52.85,52.85,6,21,0)
^^4^4^3070403^^
"^DD",52.85,52.85,6,21,1,0)
This is the default value (YES/NO) that determine whether the count of prescriptions listed under a group (Active, Non-VA Meds, Pending Orders, etc.) should be displayed in the header of that group in the ePharmacy Medication Profile for the
"^DD",52.85,52.85,6,21,2,0)
users logged into the Outpatient Pharmacy application under this Pharmacy Division. 
"^DD",52.85,52.85,6,21,3,0)
                                  
"^DD",52.85,52.85,6,21,4,0)
Note: This parameter can be overridden by user specific preferences. 
"^DD",52.85,52.85,6,"DT")
3070403
"^DD",52.85,52.85,51,0)
USER^52.8551P^^USER;0
"^DD",52.85,52.85,51,21,0)
^^1^1^3070403^
"^DD",52.85,52.85,51,21,1,0)
This sub-file contains users and their specific preferences for the ePharmacy Medication Profile. The user-specific preferences in this sub-file override the division's as well as the 'Factory Default' preferences.  
"^DD",52.85,52.8551,0)
USER SUB-FIELD^^6^7
"^DD",52.85,52.8551,0,"DT")
3070403
"^DD",52.85,52.8551,0,"IX","B",52.8551,.01)

"^DD",52.85,52.8551,0,"NM","USER")

"^DD",52.85,52.8551,0,"UP")
52.85
"^DD",52.85,52.8551,.01,0)
USER^P200'^VA(200,^0;1^Q
"^DD",52.85,52.8551,.01,1,0)
^.1
"^DD",52.85,52.8551,.01,1,1,0)
52.8551^B
"^DD",52.85,52.8551,.01,1,1,1)
S ^PS(52.85,DA(1),"USER","B",$E(X,1,30),DA)=""
"^DD",52.85,52.8551,.01,1,1,2)
K ^PS(52.85,DA(1),"USER","B",$E(X,1,30),DA)
"^DD",52.85,52.8551,.01,21,0)
^^1^1^3070403^^
"^DD",52.85,52.8551,.01,21,1,0)
This is the user for which the user-specific ePharmacy Medication Profile preferences refer to.
"^DD",52.85,52.8551,.01,"DT")
3070403
"^DD",52.85,52.8551,1,0)
EXP/CANCEL CUTOFF^NJ4,0^^0;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1.N) X
"^DD",52.85,52.8551,1,3)
Type a number between 0 and 9999, 0 Decimal Digits
"^DD",52.85,52.8551,1,21,0)
^^1^1^3070403^
"^DD",52.85,52.8551,1,21,1,0)
This is the default cutoff number of days for a expired or discontinued prescription to be displayed in the ePharmacy Medication Profile for this user. The number of days count from the date the prescription was either expired or discontinued.  
"^DD",52.85,52.8551,1,"DT")
3070403
"^DD",52.85,52.8551,2,0)
SORT BY^S^RX:RX NUMBER;DR:DRUG NAME;ID:ISSUE DATE;LF:LAST FILL;^0;3^Q
"^DD",52.85,52.8551,2,21,0)
^^1^1^3070403^^
"^DD",52.85,52.8551,2,21,1,0)
This is the default 'SORT BY' column in the ePharmacy Medication Profile for this user.  
"^DD",52.85,52.8551,2,"DT")
3070403
"^DD",52.85,52.8551,3,0)
SORT ORDER^S^A:ASCENDING;D:DESCENDING;^0;4^Q
"^DD",52.85,52.8551,3,21,0)
^^1^1^3070403^
"^DD",52.85,52.8551,3,21,1,0)
This is the default sorting order (Ascending or Descending) column in the ePharmacy Medication Profile for this user.  
"^DD",52.85,52.8551,3,"DT")
3070403
"^DD",52.85,52.8551,4,0)
DISPLAY SIG^S^0:OFF;1:ON;^0;5^Q
"^DD",52.85,52.8551,4,21,0)
^^1^1^3070403^^^
"^DD",52.85,52.8551,4,21,1,0)
This is the default value (ON/OFF) that determine whether the SIG will be displayed or not in the ePharmacy Medication Profile for this user. When 'ON', the SIG is displayed in the line right below its respective prescription.  
"^DD",52.85,52.8551,4,"DT")
3070403
"^DD",52.85,52.8551,5,0)
GROUP BY STATUS^S^0:OFF;1:ON;^0;6^Q
"^DD",52.85,52.8551,5,21,0)
^^2^2^3070403^^
"^DD",52.85,52.8551,5,21,1,0)
This is the default value (YES/NO) that determine whether the list of prescription should be group by status (Active, Discontinued, Hold, etc.) or not in the ePharmacy Medication Profile for this user. When this parameter is set to 'NO', all the
"^DD",52.85,52.8551,5,21,2,0)
regular prescriptions (excludes: Non-VA Meds, Pending Orders and REFILL TOO SOON/DUR prescriptions) are listed under the 'CURRENT ORDERS' group. 
"^DD",52.85,52.8551,5,"DT")
3070403
"^DD",52.85,52.8551,6,0)
DISPLAY ORDER COUNT^S^0:OFF;1:ON;^0;7^Q
"^DD",52.85,52.8551,6,21,0)
^^2^2^3070403^^^
"^DD",52.85,52.8551,6,21,1,0)
This is the default value (YES/NO) that determine whether the count of prescriptions listed under a group (Active, Non-VA Meds, Pending Orders, etc.) should be displayed in the header of that group in the ePharmacy Medication Profile for this
"^DD",52.85,52.8551,6,21,2,0)
user. 
"^DD",52.85,52.8551,6,"DT")
3070403
"^DD",59,59,101,0)
NPI INSTITUTION^P4'^DIC(4,^INI;2^Q
"^DD",59,59,101,3)
Enter 'Y' if your site will be using the multi-RX turn-around document.
"^DD",59,59,101,21,0)
^.001^1^1^3070320^^^^
"^DD",59,59,101,21,1,0)
The value in the field should point to the entry in the INSTITUTION file (#4) that contains the NPI number for the dispensing pharmacy for this Outpatient Pharmacy division.
"^DD",59,59,101,23,0)
^.001^7^7^3070320^^^^
"^DD",59,59,101,23,1,0)
This field points to the corresponding entry in the INSTITUTION file (#4) for this Outpatient Site entry. This field was created for two reasons: 
"^DD",59,59,101,23,2,0)
 
"^DD",59,59,101,23,3,0)
1) Avoid the creation of a new field on this file to store the NPI (National   Provider Identification) number and keep it at the institution level. The INSTITUTION file (#4) is being updated along with the introduction of this new field to
"^DD",59,59,101,23,4,0)
make sure that each entry in the OUTPATIENT SITE (#59) file has an unique corresponding entry in that file.  
"^DD",59,59,101,23,5,0)
 
"^DD",59,59,101,23,6,0)
2) Eventually replace the RELATED INSTITUTION field (#100), which has been   used in different ways by different VA Medical Centers. The NPI INSTITUTION (#101) will establish a consistent relationship between the OUTPATIENT SITE
"^DD",59,59,101,23,7,0)
(#59) and INSTITUTION (#4) files across the VA.
"^DD",59,59,101,"DT")
3070309
"^DIC",52.85,52.85,0)
EPHARMACY MEDICATION PROFILE PREFERENCES^52.85
"^DIC",52.85,52.85,0,"GL")
^PS(52.85,
"^DIC",52.85,52.85,"%",0)
^1.005^1^1
"^DIC",52.85,52.85,"%",1,0)
PSO
"^DIC",52.85,52.85,"%","B","PSO",1)

"^DIC",52.85,52.85,"%D",0)
^^11^11^3070403^
"^DIC",52.85,52.85,"%D",1,0)
This file contains Pharmacy Division specific preferences for the ePharmacy
"^DIC",52.85,52.85,"%D",2,0)
Medication Profile. For divisions without specific preferences in this file,
"^DIC",52.85,52.85,"%D",3,0)
the Outpatient Pharmacy application uses the 'Factory Default', which has the
"^DIC",52.85,52.85,"%D",4,0)
following default values: 
"^DIC",52.85,52.85,"%D",5,0)
 
"^DIC",52.85,52.85,"%D",6,0)
         EXP/CANCEL CUTOFF: 120 DAYS 
"^DIC",52.85,52.85,"%D",7,0)
                   SORT BY: DRUG NAME 
"^DIC",52.85,52.85,"%D",8,0)
                SORT ORDER: ASCENDING 
"^DIC",52.85,52.85,"%D",9,0)
               DISPLAY SIG: OFF 
"^DIC",52.85,52.85,"%D",10,0)
           GROUP BY STATUS: OFF 
"^DIC",52.85,52.85,"%D",11,0)
       DISPLAY ORDER COUNT: ON 
"^DIC",52.85,"B","EPHARMACY MEDICATION PROFILE PREFERENCES",52.85)

**INSTALL NAME**
IB*2.0*363
"BLD",6551,0)
IB*2.0*363^INTEGRATED BILLING^0^3070822^y
"BLD",6551,1,0)
^^3^3^3070604^
"BLD",6551,1,1,0)
The general purpose of this patch is to meet the requirements for the 
"BLD",6551,1,2,0)
VistA Integrated Billing (IB) software application in support of the Phase
"BLD",6551,1,3,0)
4 ePharmacy enhancements, Iteration 1.
"BLD",6551,4,0)
^9.64PA^366.14^1
"BLD",6551,4,366.14,0)
366.14
"BLD",6551,4,366.14,2,0)
^9.641^366.141^1
"BLD",6551,4,366.14,2,366.141,0)
EVENT  (sub-file)
"BLD",6551,4,366.14,2,366.141,1,0)
^9.6411^.408^10
"BLD",6551,4,366.14,2,366.141,1,.09,0)
E-PHARMACY DIVISION
"BLD",6551,4,366.14,2,366.141,1,.15,0)
MEDICAL CENTER DIVISION
"BLD",6551,4,366.14,2,366.141,1,.401,0)
AO
"BLD",6551,4,366.14,2,366.141,1,.402,0)
CV
"BLD",6551,4,366.14,2,366.141,1,.403,0)
SWA
"BLD",6551,4,366.14,2,366.141,1,.404,0)
IR
"BLD",6551,4,366.14,2,366.141,1,.405,0)
MST
"BLD",6551,4,366.14,2,366.141,1,.406,0)
HNC
"BLD",6551,4,366.14,2,366.141,1,.407,0)
SC
"BLD",6551,4,366.14,2,366.141,1,.408,0)
SHAD
"BLD",6551,4,366.14,222)
y^n^p^^^^n^^n
"BLD",6551,4,366.14,224)

"BLD",6551,4,"APDD",366.14,366.141)

"BLD",6551,4,"APDD",366.14,366.141,.09)

"BLD",6551,4,"APDD",366.14,366.141,.15)

"BLD",6551,4,"APDD",366.14,366.141,.401)

"BLD",6551,4,"APDD",366.14,366.141,.402)

"BLD",6551,4,"APDD",366.14,366.141,.403)

"BLD",6551,4,"APDD",366.14,366.141,.404)

"BLD",6551,4,"APDD",366.14,366.141,.405)

"BLD",6551,4,"APDD",366.14,366.141,.406)

"BLD",6551,4,"APDD",366.14,366.141,.407)

"BLD",6551,4,"APDD",366.14,366.141,.408)

"BLD",6551,4,"B",366.14,366.14)

"BLD",6551,6.3)
35
"BLD",6551,"INIT")
EN^IB20P363
"BLD",6551,"KRN",0)
^9.67PA^8989.52^19
"BLD",6551,"KRN",.4,0)
.4
"BLD",6551,"KRN",.401,0)
.401
"BLD",6551,"KRN",.402,0)
.402
"BLD",6551,"KRN",.403,0)
.403
"BLD",6551,"KRN",.5,0)
.5
"BLD",6551,"KRN",.84,0)
.84
"BLD",6551,"KRN",3.6,0)
3.6
"BLD",6551,"KRN",3.8,0)
3.8
"BLD",6551,"KRN",3.8,"NM",0)
^9.68A^2^1
"BLD",6551,"KRN",3.8,"NM",2,0)
IBCNR EPHARM^^0
"BLD",6551,"KRN",3.8,"NM","B","IBCNR EPHARM",2)

"BLD",6551,"KRN",9.2,0)
9.2
"BLD",6551,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",6551,"KRN",9.8,0)
9.8
"BLD",6551,"KRN",9.8,"NM",0)
^9.68A^30^24
"BLD",6551,"KRN",9.8,"NM",6,0)
IBCNSP^^0^B31460590
"BLD",6551,"KRN",9.8,"NM",7,0)
IBCNSP0^^0^B29977117
"BLD",6551,"KRN",9.8,"NM",8,0)
IBCCC3^^0^B9038313
"BLD",6551,"KRN",9.8,"NM",9,0)
IBCBB1^^0^B70812955
"BLD",6551,"KRN",9.8,"NM",11,0)
IBCSC5C^^0^B44500670
"BLD",6551,"KRN",9.8,"NM",12,0)
IBEFUNC3^^0^B7226163
"BLD",6551,"KRN",9.8,"NM",13,0)
IBCF13^^0^B5416483
"BLD",6551,"KRN",9.8,"NM",14,0)
IBNCPDP^^0^B1668933
"BLD",6551,"KRN",9.8,"NM",15,0)
IBNCPDPE^^0^B17542658
"BLD",6551,"KRN",9.8,"NM",16,0)
IBNCPDP2^^0^B35333171
"BLD",6551,"KRN",9.8,"NM",17,0)
IBNCPEV^^0^B83555880
"BLD",6551,"KRN",9.8,"NM",18,0)
IBNCPEV1^^0^B46001454
"BLD",6551,"KRN",9.8,"NM",19,0)
IBNCPLOG^^0^B61207907
"BLD",6551,"KRN",9.8,"NM",20,0)
IB20P363^^0^B9222150
"BLD",6551,"KRN",9.8,"NM",21,0)
IBNCPEB^^0^B27674256
"BLD",6551,"KRN",9.8,"NM",22,0)
IBNCPDP3^^0^B29885103
"BLD",6551,"KRN",9.8,"NM",23,0)
IBNCPUT1^^0^B20040520
"BLD",6551,"KRN",9.8,"NM",24,0)
IBRUTL^^0^B10256030
"BLD",6551,"KRN",9.8,"NM",25,0)
IBJTCA1^^0^B38260395
"BLD",6551,"KRN",9.8,"NM",26,0)
IBCBB11^^0^B14703047
"BLD",6551,"KRN",9.8,"NM",27,0)
IBTRED^^0^B24360829
"BLD",6551,"KRN",9.8,"NM",28,0)
IBNCPDPC^^0^B5379430
"BLD",6551,"KRN",9.8,"NM",29,0)
IBNCPDP1^^0^B56920205
"BLD",6551,"KRN",9.8,"NM",30,0)
IBNCPUT2^^0^B14161327
"BLD",6551,"KRN",9.8,"NM","B","IB20P363",20)

"BLD",6551,"KRN",9.8,"NM","B","IBCBB1",9)

"BLD",6551,"KRN",9.8,"NM","B","IBCBB11",26)

"BLD",6551,"KRN",9.8,"NM","B","IBCCC3",8)

"BLD",6551,"KRN",9.8,"NM","B","IBCF13",13)

"BLD",6551,"KRN",9.8,"NM","B","IBCNSP",6)

"BLD",6551,"KRN",9.8,"NM","B","IBCNSP0",7)

"BLD",6551,"KRN",9.8,"NM","B","IBCSC5C",11)

"BLD",6551,"KRN",9.8,"NM","B","IBEFUNC3",12)

"BLD",6551,"KRN",9.8,"NM","B","IBJTCA1",25)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDP",14)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDP1",29)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDP2",16)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDP3",22)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDPC",28)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPDPE",15)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPEB",21)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPEV",17)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPEV1",18)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPLOG",19)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPUT1",23)

"BLD",6551,"KRN",9.8,"NM","B","IBNCPUT2",30)

"BLD",6551,"KRN",9.8,"NM","B","IBRUTL",24)

"BLD",6551,"KRN",9.8,"NM","B","IBTRED",27)

"BLD",6551,"KRN",19,0)
19
"BLD",6551,"KRN",19,"NM",0)
^9.68A^^
"BLD",6551,"KRN",19.1,0)
19.1
"BLD",6551,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6551,"KRN",101,0)
101
"BLD",6551,"KRN",409.61,0)
409.61
"BLD",6551,"KRN",771,0)
771
"BLD",6551,"KRN",870,0)
870
"BLD",6551,"KRN",8989.51,0)
8989.51
"BLD",6551,"KRN",8989.52,0)
8989.52
"BLD",6551,"KRN",8994,0)
8994
"BLD",6551,"KRN","B",.4,.4)

"BLD",6551,"KRN","B",.401,.401)

"BLD",6551,"KRN","B",.402,.402)

"BLD",6551,"KRN","B",.403,.403)

"BLD",6551,"KRN","B",.5,.5)

"BLD",6551,"KRN","B",.84,.84)

"BLD",6551,"KRN","B",3.6,3.6)

"BLD",6551,"KRN","B",3.8,3.8)

"BLD",6551,"KRN","B",9.2,9.2)

"BLD",6551,"KRN","B",9.8,9.8)

"BLD",6551,"KRN","B",19,19)

"BLD",6551,"KRN","B",19.1,19.1)

"BLD",6551,"KRN","B",101,101)

"BLD",6551,"KRN","B",409.61,409.61)

"BLD",6551,"KRN","B",771,771)

"BLD",6551,"KRN","B",870,870)

"BLD",6551,"KRN","B",8989.51,8989.51)

"BLD",6551,"KRN","B",8989.52,8989.52)

"BLD",6551,"KRN","B",8994,8994)

"BLD",6551,"QUES",0)
^9.62^^
"BLD",6551,"REQB",0)
^9.611^10^5
"BLD",6551,"REQB",2,0)
IB*2.0*63^2
"BLD",6551,"REQB",3,0)
IB*2.0*251^2
"BLD",6551,"REQB",5,0)
IB*2.0*174^2
"BLD",6551,"REQB",9,0)
IB*2.0*349^2
"BLD",6551,"REQB",10,0)
IB*2.0*347^2
"BLD",6551,"REQB","B","IB*2.0*174",5)

"BLD",6551,"REQB","B","IB*2.0*251",3)

"BLD",6551,"REQB","B","IB*2.0*347",10)

"BLD",6551,"REQB","B","IB*2.0*349",9)

"BLD",6551,"REQB","B","IB*2.0*63",2)

"FIA",366.14)
IB NCPDP EVENT LOG
"FIA",366.14,0)
^IBCNR(366.14,
"FIA",366.14,0,0)
366.14D
"FIA",366.14,0,1)
y^n^p^^^^n^^n
"FIA",366.14,0,10)

"FIA",366.14,0,11)

"FIA",366.14,0,"RLRO")

"FIA",366.14,0,"VR")
2.0^IB
"FIA",366.14,366.14)
1
"FIA",366.14,366.141)
1
"FIA",366.14,366.141,.09)

"FIA",366.14,366.141,.15)

"FIA",366.14,366.141,.401)

"FIA",366.14,366.141,.402)

"FIA",366.14,366.141,.403)

"FIA",366.14,366.141,.404)

"FIA",366.14,366.141,.405)

"FIA",366.14,366.141,.406)

"FIA",366.14,366.141,.407)

"FIA",366.14,366.141,.408)

"INIT")
EN^IB20P363
"KRN",3.8,1303,-1)
0^2
"KRN",3.8,1303,0)
IBCNR EPHARM^PU^n^^^^
"KRN",3.8,1303,2,0)
^^2^2^3070309^
"KRN",3.8,1303,2,1,0)
This mail group is forwarded notifications that are associated with
"KRN",3.8,1303,2,2,0)
electronic Pharmacy (ePharmacy) processing of claims.
"KRN",3.8,1303,3)

"MBREQ")
1
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"PKG",230,-1)
1^1
"PKG",230,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",230,20,0)
^9.402P^1^1
"PKG",230,20,1,0)
2^^IBAXDR
"PKG",230,20,1,1)

"PKG",230,20,"B",2,1)

"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
2.0^2940321^2940525
"PKG",230,22,1,"PAH",1,0)
363^3070822^520651034
"PKG",230,22,1,"PAH",1,1,0)
^^3^3^3070822
"PKG",230,22,1,"PAH",1,1,1,0)
The general purpose of this patch is to meet the requirements for the 
"PKG",230,22,1,"PAH",1,1,2,0)
VistA Integrated Billing (IB) software application in support of the Phase
"PKG",230,22,1,"PAH",1,1,3,0)
4 ePharmacy enhancements, Iteration 1.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
24
"RTN","IB20P363")
0^20^B9222150
"RTN","IB20P363",1,0)
IB20P363 ;ALB/SS - POST INIT ACTION ;22-FEB-2007
"RTN","IB20P363",2,0)
 ;;2.0;INTEGRATED BILLING;**363**;21-MAR-94;Build 35
"RTN","IB20P363",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IB20P363",4,0)
 ;
"RTN","IB20P363",5,0)
 Q
"RTN","IB20P363",6,0)
 ;
"RTN","IB20P363",7,0)
EN ;
"RTN","IB20P363",8,0)
 I $$PATCH^XPDUTL("IB*2.0*363") D  Q
"RTN","IB20P363",9,0)
 . D MESSAGE("The post-install process has been skipped since")
"RTN","IB20P363",10,0)
 . D MESSAGE("the patch was previously installed.")
"RTN","IB20P363",11,0)
 . D SNDMAIL("IB*2.0*363 installation has been completed","The post-install process has been skipped since","the patch was previously installed.","")
"RTN","IB20P363",12,0)
 D MESSAGE("Queuing IB*2.0*363 POST-INSTALL process")
"RTN","IB20P363",13,0)
 N X,Y,%DT,ZTDESC,ZTSAVE,ZTIO,ZTDTH,ZTRTN
"RTN","IB20P363",14,0)
 S X="N",%DT="ST"
"RTN","IB20P363",15,0)
 D ^%DT
"RTN","IB20P363",16,0)
 S ZTDTH=Y
"RTN","IB20P363",17,0)
 S ZTIO=""
"RTN","IB20P363",18,0)
 S ZTDESC="IB*2.0*363 POST INSTALL PROCESS"
"RTN","IB20P363",19,0)
 S ZTSAVE("*")=""
"RTN","IB20P363",20,0)
 S ZTRTN="EN1^IB20P363"
"RTN","IB20P363",21,0)
 D ^%ZTLOAD
"RTN","IB20P363",22,0)
 Q
"RTN","IB20P363",23,0)
 ;
"RTN","IB20P363",24,0)
EN1 ; post-install process itself
"RTN","IB20P363",25,0)
 ;D MESSAGE(">>> Populating the field #.09 E-PHARMACY DIVISION in the file #366.14")
"RTN","IB20P363",26,0)
 ;D MESSAGE("    Please wait...")
"RTN","IB20P363",27,0)
 N IBIEN,IBEVIEN,IBZ,IBEPHARM,IBCNT,IBRXIEN,IBCNTOT,IBMSG0,IBMSG1,IBMSG2
"RTN","IB20P363",28,0)
 S IBIEN=0,IBCNT=0,IBCNTOT=0
"RTN","IB20P363",29,0)
 F  S IBIEN=$O(^IBCNR(366.14,IBIEN)) Q:+IBIEN=0  D
"RTN","IB20P363",30,0)
 . S IBEVIEN=0
"RTN","IB20P363",31,0)
 . F  S IBEVIEN=$O(^IBCNR(366.14,IBIEN,1,IBEVIEN)) Q:+IBEVIEN=0  D
"RTN","IB20P363",32,0)
 . . S IBCNTOT=IBCNTOT+1
"RTN","IB20P363",33,0)
 . . I $P($G(^IBCNR(366.14,IBIEN,1,IBEVIEN,0)),U,9)>0 Q
"RTN","IB20P363",34,0)
 . . S IBZ=$G(^IBCNR(366.14,IBIEN,1,IBEVIEN,2))
"RTN","IB20P363",35,0)
 . . S IBRXIEN=+IBZ
"RTN","IB20P363",36,0)
 . . I 'IBRXIEN S IBRXIEN=+$P(IBZ,U,12)
"RTN","IB20P363",37,0)
 . . S IBEPHARM=$$GETEPHRM^BPS01P5C($G(^IBCNR(366.14,IBIEN,0)),IBRXIEN,+$P(IBZ,U,3))
"RTN","IB20P363",38,0)
 . . I IBEPHARM S $P(^IBCNR(366.14,IBIEN,1,IBEVIEN,0),U,9)=IBEPHARM,IBCNT=IBCNT+1
"RTN","IB20P363",39,0)
 S IBMSG0=">>> Populating the field #.09 E-PHARMACY DIVISION in the file #366.14"
"RTN","IB20P363",40,0)
 S IBMSG1=$S(IBCNT=1:">>> 1 record has been populated",1:">>> "_IBCNT_" records have been populated.")
"RTN","IB20P363",41,0)
 S IBMSG2=$S(IBCNTOT=1:">>> 1 record has been examined",1:">>> "_IBCNTOT_" records have been examined.")
"RTN","IB20P363",42,0)
 ;D MESSAGE(IBMSG1)
"RTN","IB20P363",43,0)
 ;D MESSAGE(IBMSG2)
"RTN","IB20P363",44,0)
 D SNDMAIL("IB*2.0*363 installation has been completed",IBMSG0,IBMSG1,IBMSG2)
"RTN","IB20P363",45,0)
 Q
"RTN","IB20P363",46,0)
 ;display message 
"RTN","IB20P363",47,0)
 ;IBMSG - message text
"RTN","IB20P363",48,0)
MESSAGE(IBMSG) ;
"RTN","IB20P363",49,0)
 D BMES^XPDUTL(IBMSG)
"RTN","IB20P363",50,0)
 Q
"RTN","IB20P363",51,0)
 ;send mail to the user
"RTN","IB20P363",52,0)
SNDMAIL(IBSUBJ,IBMESS1,IBMESS2,IBMESS3) ;
"RTN","IB20P363",53,0)
 N DIFROM ;IMPORTANT - if you send e-mail from post-install process (queued or not) !!!
"RTN","IB20P363",54,0)
 N IBTMPARR,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","IB20P363",55,0)
 S IBTMPARR(1)=""
"RTN","IB20P363",56,0)
 S IBTMPARR(2)=IBMESS1
"RTN","IB20P363",57,0)
 S IBTMPARR(3)=IBMESS2
"RTN","IB20P363",58,0)
 S IBTMPARR(4)=IBMESS3
"RTN","IB20P363",59,0)
 S IBTMPARR(5)=""
"RTN","IB20P363",60,0)
 S XMSUB=IBSUBJ
"RTN","IB20P363",61,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE"
"RTN","IB20P363",62,0)
 S XMTEXT="IBTMPARR("
"RTN","IB20P363",63,0)
 S XMY(DUZ)=""
"RTN","IB20P363",64,0)
 D ^XMD
"RTN","IB20P363",65,0)
 Q
"RTN","IB20P363",66,0)
 ;
"RTN","IBCBB1")
0^9^B70812955
"RTN","IBCBB1",1,0)
IBCBB1 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;2-NOV-89
"RTN","IBCBB1",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,80,93,106,51,151,148,153,137,232,280,155,320,343,349,363**;21-MAR-94;Build 35
"RTN","IBCBB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB1",4,0)
 ;
"RTN","IBCBB1",5,0)
 ;MAP TO DGCRBB1
"RTN","IBCBB1",6,0)
 ;
"RTN","IBCBB1",7,0)
% ;Bill Status
"RTN","IBCBB1",8,0)
 N Z,Z0,Z1
"RTN","IBCBB1",9,0)
 I $S(+IBST=0:1,1:"^1^2^3^4^7^"'[(U_IBST_U)) S IBER=IBER_"IB045;"
"RTN","IBCBB1",10,0)
 ;
"RTN","IBCBB1",11,0)
 ;Statement Covers From
"RTN","IBCBB1",12,0)
 I IBFDT="" S IBER=IBER_"IB061;"
"RTN","IBCBB1",13,0)
 I IBFDT]"",IBFDT'?7N&(IBFDT'?7N1".".N) S IBER=IBER_"IB061;"
"RTN","IBCBB1",14,0)
 I IBFDT>IBTDT S IBER=IBER_"IB061;" ; from must be on or before the to date 
"RTN","IBCBB1",15,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",16,0)
 ; if inpat - from date must not be prior to admit date.
"RTN","IBCBB1",17,0)
 I $$INPAT^IBCEF(IBIFN,1),(IBFDT<($P($G(^DGPT(+$P(IBND0,U,8),0)),U,2)\1))  S IBER=IBER_"IB061;"
"RTN","IBCBB1",18,0)
 ;
"RTN","IBCBB1",19,0)
 ;Statement Covers To
"RTN","IBCBB1",20,0)
 I IBTDT="" S IBER=IBER_"IB062;"
"RTN","IBCBB1",21,0)
 I IBTDT]"",IBTDT'?7N&(IBTDT'?7N1".".N) S IBER=IBER_"IB062;"
"RTN","IBCBB1",22,0)
 I IBTDT>DT!(IBTDT<IBFDT) S IBER=IBER_"IB062;"  ; to date must not be >than today's date
"RTN","IBCBB1",23,0)
 S IBTFY=$$FY^IBOUTL(IBTDT)
"RTN","IBCBB1",24,0)
 ;
"RTN","IBCBB1",25,0)
 ;Statement crosses fiscal years
"RTN","IBCBB1",26,0)
 ;I IBTFY'=IBFFY S IBER=IBER_"IB047;"
"RTN","IBCBB1",27,0)
 ;
"RTN","IBCBB1",28,0)
 ;Statement crosses calendar years
"RTN","IBCBB1",29,0)
 ;I $E(IBTDT,1,3)'=$E(IBFDT,1,3) S IBER=IBER_"IB046;"
"RTN","IBCBB1",30,0)
 ;
"RTN","IBCBB1",31,0)
 ;Total Charges
"RTN","IBCBB1",32,0)
 I +IBTC'>0!(+IBTC'=IBTC) S IBER=IBER_"IB064;"
"RTN","IBCBB1",33,0)
 ;
"RTN","IBCBB1",34,0)
 ;Billable charges for secondary claim
"RTN","IBCBB1",35,0)
 I $$MCRONBIL^IBEFUNC(IBIFN)&(($P(IBNDU1,U,1)-$P(IBNDU1,U,2))'>0) S IBER=IBER_"IB094;"
"RTN","IBCBB1",36,0)
 ;Fiscal Year 1
"RTN","IBCBB1",37,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",38,0)
 ;
"RTN","IBCBB1",39,0)
 ;Check provider link for current user, enterer, reviewer and Authorizor
"RTN","IBCBB1",40,0)
 I '$D(^VA(200,DUZ,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",41,0)
 I IBEU]"",'$D(^VA(200,IBEU,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",42,0)
 I IBRU]"",'$D(^VA(200,IBRU,0)) S IBER=IBER_"IB060;"
"RTN","IBCBB1",43,0)
 I IBAU]"",'$D(^VA(200,IBAU,0)) S IBER=IBER_"IB041;"
"RTN","IBCBB1",44,0)
 ;
"RTN","IBCBB1",45,0)
 ;Bill exists and not already new bill
"RTN","IBCBB1",46,0)
 ;I $S('$D(^PRCA(430,IBIFN,0)):1,$P($P(^PRCA(430,IBIFN,0),"^"),"-",2)'=IBBNO:1,1:0) S IBER=IBER_"IB056;"
"RTN","IBCBB1",47,0)
 ;I $P($$BN^PRCAFN(IBIFN),"-",2)'=IBBNO S IBER=IBER_"IB056;"
"RTN","IBCBB1",48,0)
 ;I IBER="",$P(^PRCA(430,IBIFN,0),"^",8)=$O(^PRCA(430.3,"AC",104,"")) S IBER=IBER_"IB040;"
"RTN","IBCBB1",49,0)
 I IBER="",+$$STA^PRCAFN(IBIFN)=104 S IBER=IBER_"IB040;"
"RTN","IBCBB1",50,0)
 ; If ins bill, must have valid COB sequence
"RTN","IBCBB1",51,0)
 I $P(IBND0,U,11)="i",$S($P(IBND0,U,21)="":1,1:"PST"'[$P(IBND0,U,21)) S IBER=IBER_"IB324;"
"RTN","IBCBB1",52,0)
 ;
"RTN","IBCBB1",53,0)
 ; Check for valid sec provider id for current ins
"RTN","IBCBB1",54,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)),Z1=+$$COBN^IBCEF(IBIFN) I $P(Z0,U,4+Z1)'="",$P(Z0,U,11+Z1)'="" D
"RTN","IBCBB1",55,0)
 . I '$$SECIDCK^IBCEF74(IBIFN,Z1,$P(Z0,U,11+Z1),Z) D WARN^IBCBB11("Prov secondary id type for the "_$P("PRIMARY^SECONDARY^TERTIARY",U,Z1)_" "_$$EXTERNAL^DILFD(399.0222,.01,,+Z0)_" is invalid/won't transmit")
"RTN","IBCBB1",56,0)
 ; Check NPIs
"RTN","IBCBB1",57,0)
 D NPICHK^IBCBB11
"RTN","IBCBB1",58,0)
 ;
"RTN","IBCBB1",59,0)
 ; Check taxonomies
"RTN","IBCBB1",60,0)
 D TAXCHK^IBCBB11
"RTN","IBCBB1",61,0)
 ;
"RTN","IBCBB1",62,0)
 ; Check for Physician Name
"RTN","IBCBB1",63,0)
 K IBXDATA D F^IBCEF("N-ATT/REND PHYSICIAN NAME",,,IBIFN)
"RTN","IBCBB1",64,0)
 I $P($G(IBXDATA),U)="" S IBER=IBER_"IB303;"
"RTN","IBCBB1",65,0)
 ;
"RTN","IBCBB1",66,0)
 N FUNCTION,IBINS
"RTN","IBCBB1",67,0)
 S FUNCTION=$S($$FT^IBCEF(IBIFN)=3:4,1:3)
"RTN","IBCBB1",68,0)
 I IBER'["IB303;" D
"RTN","IBCBB1",69,0)
 . F IBINS=1:1:3 D
"RTN","IBCBB1",70,0)
 .. S Z=$$GETTYP^IBCEP2A(IBIFN,IBINS)
"RTN","IBCBB1",71,0)
 .. I Z,$P(Z,U,2) D  ; Rendering/attending prov secondary id required
"RTN","IBCBB1",72,0)
 ... N IBID,IBOK,Q0
"RTN","IBCBB1",73,0)
 ... D PROVINF^IBCEF74(IBIFN,IBINS,.IBID,1,"C")  ; check all as though they were current
"RTN","IBCBB1",74,0)
 ... S IBOK=0
"RTN","IBCBB1",75,0)
 ... S Q0=0 F  S Q0=$O(IBID(1,FUNCTION,Q0)) Q:'Q0  I $P(IBID(1,FUNCTION,Q0),U,9)=+Z S IBOK=1 Q
"RTN","IBCBB1",76,0)
 ... I 'IBOK S IBER=IBER_$S(IBINS=1:"IB236;",IBINS=2:"IB237;",IBINS=3:"IB238;",1:"")
"RTN","IBCBB1",77,0)
 . I $$TXMT^IBCEF4(IBIFN) D
"RTN","IBCBB1",78,0)
 .. D F^IBCEF("N-ALL ATT/REND PROV SSN/EI","IBZ",,IBIFN)
"RTN","IBCBB1",79,0)
 .. I $P(IBZ,U,3)=""&($P(IBZ,U,4)="") S IBER=IBER_"IB321;" ; SSN/IEN required for rend/att
"RTN","IBCBB1",80,0)
 ;
"RTN","IBCBB1",81,0)
 N IBM,IBM1
"RTN","IBCBB1",82,0)
 S IBM=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCBB1",83,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCBB1",84,0)
 I $P(IBM,U),$P($G(^DIC(36,$P(IBM,U),4)),U,6),$P(IBM1,U,2)="" S IBER=IBER_"IB244;"
"RTN","IBCBB1",85,0)
 I $P(IBM,U,2),$P($G(^DIC(36,$P(IBM,U,2),4)),U,6),$P(IBM1,U,3)="" S IBER=IBER_"IB245;"
"RTN","IBCBB1",86,0)
 I $P(IBM,U,3),$P($G(^DIC(36,$P(IBM,U,3),4)),U,6),$P(IBM1,U,4)="" S IBER=IBER_"IB246;"
"RTN","IBCBB1",87,0)
 ;
"RTN","IBCBB1",88,0)
 ; If outside facility, check for ID and qualifier in 355.93
"RTN","IBCBB1",89,0)
 ; 5/15/06 - esg - hard error IB243 turned into warning message instead
"RTN","IBCBB1",90,0)
 S Z=$P($G(^DGCR(399,IBIFN,"U2")),U,10)
"RTN","IBCBB1",91,0)
 I Z D
"RTN","IBCBB1",92,0)
 . I $P($G(^IBA(355.93,Z,0)),U,9)=""!($P($G(^IBA(355.93,Z,0)),U,13)="") D
"RTN","IBCBB1",93,0)
 .. N Z1,Z2
"RTN","IBCBB1",94,0)
 .. S Z1="Missing Lab or Facility Primary ID for non-VA facility, "
"RTN","IBCBB1",95,0)
 .. S Z2=$$EXTERNAL^DILFD(399,232,,Z)
"RTN","IBCBB1",96,0)
 .. I $L(Z2)'>19 D WARN^IBCBB11(Z1_Z2) Q
"RTN","IBCBB1",97,0)
 .. D WARN^IBCBB11(Z1),WARN^IBCBB11("     "_Z2)
"RTN","IBCBB1",98,0)
 .. Q
"RTN","IBCBB1",99,0)
 . Q
"RTN","IBCBB1",100,0)
 ;
"RTN","IBCBB1",101,0)
 ; Must be one and only one division on bill
"RTN","IBCBB1",102,0)
 S IBZ=$$MULTDIV^IBCBB11(IBIFN,IBND0)
"RTN","IBCBB1",103,0)
 I IBZ S IBER=IBER_$S(IBZ=1:"IB095;",IBZ=2:"IB104;",1:"IB105;")
"RTN","IBCBB1",104,0)
 ; Division address must be defined in institution file
"RTN","IBCBB1",105,0)
 I $P(IBND0,U,22) D
"RTN","IBCBB1",106,0)
 . N Z,Z0,Z1
"RTN","IBCBB1",107,0)
 . S Z0=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),0))
"RTN","IBCBB1",108,0)
 . S Z1=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),1))
"RTN","IBCBB1",109,0)
 . I $P(Z0,U,2)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",110,0)
 . F Z=1,3,4 I $P(Z1,U,Z)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",111,0)
 ;
"RTN","IBCBB1",112,0)
 ;CHAMPVA Rate Type and Primary Insurance Carriers Type of Coverage must match
"RTN","IBCBB1",113,0)
 S (IBRTCHV,IBPICHV)=0
"RTN","IBCBB1",114,0)
 I $P($G(^DGCR(399.3,+IBAT,0)),U,1)="CHAMPVA" S IBRTCHV=1
"RTN","IBCBB1",115,0)
 I $P($G(^IBE(355.2,+$P($G(^DIC(36,+IBNDMP,0)),U,13),0)),U,1)="CHAMPVA" S IBPICHV=1
"RTN","IBCBB1",116,0)
 I (+IBRTCHV!+IBPICHV)&('IBRTCHV!'IBPICHV) S IBER=IBER_"IB085;"
"RTN","IBCBB1",117,0)
 ;
"RTN","IBCBB1",118,0)
 N IBZPRC,IBZPRCUB
"RTN","IBCBB1",119,0)
 D F^IBCEF("N-ALL PROCEDURES","IBZPRC",,IBIFN)
"RTN","IBCBB1",120,0)
 ; Procedure Clinic is required for Surgical Procedures Outpt Facility Charges
"RTN","IBCBB1",121,0)
 I +$P(IBND0,U,27)'=2,$$BILLRATE^IBCRU3(IBAT,IBCL,IBEVDT,"RC OUTPATIENT") D
"RTN","IBCBB1",122,0)
 . N Z,Z0,Z1,ZE S (ZE,Z)=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  D  I +ZE S IBER=IBER_"IB320;" Q
"RTN","IBCBB1",123,0)
 .. S Z0=$G(^DGCR(399,IBIFN,"CP",Z,0)),Z1=+Z0 I Z0'[";ICPT(" Q
"RTN","IBCBB1",124,0)
 .. I '((Z1'<10000)&(Z1'>69999))&'((Z1'<93501)&(Z1'>93533)) Q
"RTN","IBCBB1",125,0)
 .. I '$P(Z0,U,7) S ZE=1
"RTN","IBCBB1",126,0)
 ;
"RTN","IBCBB1",127,0)
 ; Extract procedures for UB-04
"RTN","IBCBB1",128,0)
 D F^IBCEF("N-UB-04 PROCEDURES","IBZPRCUB",,IBIFN)
"RTN","IBCBB1",129,0)
 ; Does this bill have ANY prescriptions associated with it?
"RTN","IBCBB1",130,0)
 ; Must bill prescriptions separately from other charges
"RTN","IBCBB1",131,0)
 ;
"RTN","IBCBB1",132,0)
 I $$ISRX^IBCEF1(IBIFN) D
"RTN","IBCBB1",133,0)
 . N IBZ,IBRXDEF
"RTN","IBCBB1",134,0)
 . S IBRXDEF=$P($G(^IBE(350.9,1,1)),U,30),IBZ=0
"RTN","IBCBB1",135,0)
 . F  S IBZ=$O(IBZPRCUB(IBZ)) Q:'IBZ  I IBZPRCUB(IBZ),+$P(IBZPRCUB(IBZ),U)'=IBRXDEF S IBER=IBER_"IB102;" Q
"RTN","IBCBB1",136,0)
 . K IBZ
"RTN","IBCBB1",137,0)
 ;
"RTN","IBCBB1",138,0)
 ; Check that COB sequences are not skipped
"RTN","IBCBB1",139,0)
 K Z
"RTN","IBCBB1",140,0)
 F Z=1:1:3 S:+$G(^DGCR(399,IBIFN,"I"_Z)) Z(Z)=""
"RTN","IBCBB1",141,0)
 F Z=0:1:2 S Z0=$O(Z(Z)) Q:'Z0  I Z0'=(Z+1) S IBER=IBER_"IB322;" Q
"RTN","IBCBB1",142,0)
 K Z
"RTN","IBCBB1",143,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,21)="" S IBER=IBER_"IB323;"
"RTN","IBCBB1",144,0)
 K IBXDATA D F^IBCEF("N-PROCEDURE CODING METHD",,,IBIFN)
"RTN","IBCBB1",145,0)
 ; Coding method should agree with types of procedure codes
"RTN","IBCBB1",146,0)
 S IBOK=$S('$O(IBZPRC(0))!(IBXDATA=""):1,1:0)
"RTN","IBCBB1",147,0)
 I 'IBOK S IBOK=1,IBZ=0 F  S IBZ=$O(IBZPRC(IBZ)) Q:'IBZ  I IBZPRC(IBZ),$P(IBZPRC(IBZ),U)'[$S(IBXDATA=9:"ICD",1:"ICP") S IBOK=0 Q
"RTN","IBCBB1",148,0)
 I 'IBOK D WARN^IBCBB11("Coding Method does not agree with all procedure codes found on bill")
"RTN","IBCBB1",149,0)
 D EDITMRA^IBCBB3(.IBQUIT,.IBER,IBIFN,IBFT)
"RTN","IBCBB1",150,0)
 Q:$G(IBQUIT)
"RTN","IBCBB1",151,0)
 ;
"RTN","IBCBB1",152,0)
 ;Other things that could be added:  Rev Code - calculating charges
"RTN","IBCBB1",153,0)
 ;        Diagnosis Coding, if MT copay - check for other co-payments
"RTN","IBCBB1",154,0)
 ;
"RTN","IBCBB1",155,0)
 I $P(IBNDTX,U,8),$$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB121;"   ; can't force MRAs to print
"RTN","IBCBB1",156,0)
 I $P(IBNDTX,U,8)!$P(IBNDTX,U,9) D WARN^IBCBB11($S($$REQMRA^IBEFUNC(IBIFN)&($P(IBNDTX,U,9)):"MRA Secondary ",1:"")_"Bill has been forced to print "_$S($P(IBNDTX,U,8)=1!($P(IBNDTX,U,9)=1):"locally",1:"at clearinghouse"))
"RTN","IBCBB1",157,0)
 N IBXZ,IBIZ F IBIZ=12,13,14 S IBXZ=$P(IBNDM,U,IBIZ) I +IBXZ S IBXZ=$P($G(^DPT(DFN,.312,IBXZ,0)),U,18) I +IBXZ S IBXZ=$G(^IBA(355.3,+IBXZ,0)) I +$P(IBXZ,U,12) D
"RTN","IBCBB1",158,0)
 . D WARN^IBCBB11($P($G(^DIC(36,+IBXZ,0)),U,1)_" requires Amb Care Certification")
"RTN","IBCBB1",159,0)
 ;
"RTN","IBCBB1",160,0)
 D VALNDC^IBCBB11(IBIFN,DFN)  ;validate NDC#
"RTN","IBCBB1",161,0)
 ;Build AR array if no errors and MRA not needed or already rec'd
"RTN","IBCBB1",162,0)
 I IBER="",$S($$NEEDMRA^IBEFUNC(IBIFN)!($$REQMRA^IBEFUNC(IBIFN)):0,1:1) D ARRAY
"RTN","IBCBB1",163,0)
 ;
"RTN","IBCBB1",164,0)
END ;Don't kill IBIFN, IBER, DFN
"RTN","IBCBB1",165,0)
 I $O(^TMP($J,"BILL-WARN",0)),$G(IBER)="" S IBER="WARN" ;Warnings only
"RTN","IBCBB1",166,0)
 K IBBNO,IBEVDT,IBLOC,IBCL,IBTF,IBAT,IBWHO,IBST,IBFDT,IBTDT,IBTC,IBFY,IBFY1,IBAU,IBRU,IBEU,IBARTP,IBFYC,IBMRA,IBTOB,IBTOB12,IBNDU2,IBNDUF3,IBNDUF31,IBNDTX
"RTN","IBCBB1",167,0)
 K IBNDS,IBND0,IBNDU,IBNDM,IBNDMP,IBNDU1,IBFFY,IBTFY,IBFT,IBRTCHV,IBPICHV,IBXDATA,IBOK
"RTN","IBCBB1",168,0)
 I $D(IBER),IBER="" W !,"No Errors found for National edits"
"RTN","IBCBB1",169,0)
 Q
"RTN","IBCBB1",170,0)
 ;
"RTN","IBCBB1",171,0)
ARRAY ;Build PRCASV(array)
"RTN","IBCBB1",172,0)
 N IBCOBN,X
"RTN","IBCBB1",173,0)
 K PRCASV
"RTN","IBCBB1",174,0)
 Q:$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN))
"RTN","IBCBB1",175,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCBB1",176,0)
 S X=IBIFN
"RTN","IBCBB1",177,0)
 S PRCASV("BDT")=DT,PRCASV("ARREC")=IBIFN
"RTN","IBCBB1",178,0)
 S PRCASV("APR")=DUZ
"RTN","IBCBB1",179,0)
 S PRCASV("PAT")=DFN,PRCASV("CAT")=$P(^DGCR(399.3,IBAT,0),"^",6)
"RTN","IBCBB1",180,0)
 I IBWHO="i" S PRCASV("DEBTOR")=+IBNDMP_";DIC(36,"
"RTN","IBCBB1",181,0)
 S PRCASV("DEBTOR")=$S(IBWHO="p":DFN_";DPT(",IBWHO="o":$P(IBNDM,"^",11)_";DIC(4,",IBWHO="i":PRCASV("DEBTOR"),1:"")
"RTN","IBCBB1",182,0)
 S PRCASV("CARE")=$E($$TOB^IBCEF1(IBIFN),1,2)
"RTN","IBCBB1",183,0)
 S PRCASV("FY")=$$FY^IBOUTL(DT)_U_($P(IBNDU1,U)-$P(IBNDU1,U,2))
"RTN","IBCBB1",184,0)
 ;S PRCASV("FY")=$P(IBNDU1,U,9)_U_$S($P(IBNDU1,U,2)]"":($P(IBNDU1,U,10)-$P(IBNDU1,U,2)),1:$P(IBNDU1,U,10))_$S($P(IBNDU1,U,11)]"":U_$P(IBNDU1,U,11)_U_$P(IBNDU1,U,12),1:"")
"RTN","IBCBB1",185,0)
PLUS I IBWHO="i",$P(IBNDM,"^",2),$D(^DIC(36,$P(IBNDM,"^",2),0)) S PRCASV("2NDINS")=$P(IBNDM,"^",2)
"RTN","IBCBB1",186,0)
 I IBWHO="i",$P(IBNDM,"^",3),$D(^DIC(36,$P(IBNDM,"^",3),0)) S PRCASV("3RDINS")=$P(IBNDM,"^",3)
"RTN","IBCBB1",187,0)
 ;
"RTN","IBCBB1",188,0)
 N IBX S IBX=$P(IBND0,U,21),IBX=$S(IBX="P":"I1",IBX="S":"I2",IBX="T":"I3",1:"") Q:IBX=""
"RTN","IBCBB1",189,0)
 N IBNDI1
"RTN","IBCBB1",190,0)
 Q:'$D(^DGCR(399,IBIFN,IBX))  S IBNDI1=^(IBX)
"RTN","IBCBB1",191,0)
 S:$P(IBNDI1,"^",3)]"" PRCASV("GPNO")=$P(IBNDI1,"^",3)
"RTN","IBCBB1",192,0)
 S:$P(IBNDI1,"^",15)]"" PRCASV("GPNM")=$P(IBNDI1,"^",15)
"RTN","IBCBB1",193,0)
 S:$P(IBNDI1,"^",17)]"" PRCASV("INPA")=$P(IBNDI1,"^",17)
"RTN","IBCBB1",194,0)
 S:$P(IBNDI1,"^",2)]"" PRCASV("IDNO")=$P(IBNDI1,"^",2),PRCASV("INID")=PRCASV("IDNO")
"RTN","IBCBB1",195,0)
 ; Check that this is a secondary or tertiary bill and insurance for previous
"RTN","IBCBB1",196,0)
 ; COB sequence is Medicare WNR and MRA is active --> send data elements to AR
"RTN","IBCBB1",197,0)
 I IBCOBN>1,$$WNRBILL^IBEFUNC(IBIFN,IBCOBN-1),$$EDIACTV^IBCEF4(2) D MRA
"RTN","IBCBB1",198,0)
 Q
"RTN","IBCBB1",199,0)
 ;
"RTN","IBCBB1",200,0)
MRA N IBEOB S IBEOB=0
"RTN","IBCBB1",201,0)
 ;
"RTN","IBCBB1",202,0)
 K PRCASV("MEDURE"),PRCASV("MEDCA")
"RTN","IBCBB1",203,0)
 ; Get EOB data
"RTN","IBCBB1",204,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D
"RTN","IBCBB1",205,0)
 . D MRACALC^IBCEMU2(IBEOB,IBIFN,1,.PRCASV)
"RTN","IBCBB1",206,0)
 Q  ;MRA
"RTN","IBCBB1",207,0)
 ;
"RTN","IBCBB1",208,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB1",209,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11")
0^26^B14703047
"RTN","IBCBB11",1,0)
IBCBB11 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;12 Jun 2006  3:45 PM
"RTN","IBCBB11",2,0)
 ;;2.0;INTEGRATED BILLING;**51,343,363**;21-MAR-94;Build 35
"RTN","IBCBB11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB11",4,0)
 ;
"RTN","IBCBB11",5,0)
WARN(IBDISP) ; Set warning in global
"RTN","IBCBB11",6,0)
 ; DISP = warning text to display
"RTN","IBCBB11",7,0)
 ;
"RTN","IBCBB11",8,0)
 N Z
"RTN","IBCBB11",9,0)
 S Z=+$O(^TMP($J,"BILL-WARN",""),-1)
"RTN","IBCBB11",10,0)
 I Z=0 S ^TMP($J,"BILL-WARN",1)=$J("",5)_"**Warnings**:",Z=1
"RTN","IBCBB11",11,0)
 S Z=Z+1,^TMP($J,"BILL-WARN",Z)=$J("",5)_IBDISP
"RTN","IBCBB11",12,0)
 Q
"RTN","IBCBB11",13,0)
 ;
"RTN","IBCBB11",14,0)
MULTDIV(IBIFN,IBND0) ; Check for multiple divisions on a bill ien IBIFN
"RTN","IBCBB11",15,0)
 ; IBND0 = 0-node of bill
"RTN","IBCBB11",16,0)
 ;
"RTN","IBCBB11",17,0)
 ;  Function returns 1 if more than 1 division found on bill
"RTN","IBCBB11",18,0)
 N Z,Z0,Z1,MULT
"RTN","IBCBB11",19,0)
 S MULT=0,Z1=$P(IBND0,U,22)
"RTN","IBCBB11",20,0)
 I Z1 D
"RTN","IBCBB11",21,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$P(^(Z,0),U,7) I Z0,Z0'=Z1 S MULT=1 Q
"RTN","IBCBB11",22,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=$P(^(Z,0),U,6) I Z0,Z0'=Z1 S MULT=2 Q
"RTN","IBCBB11",23,0)
 I 'Z1 S MULT=3
"RTN","IBCBB11",24,0)
 Q MULT
"RTN","IBCBB11",25,0)
 ;
"RTN","IBCBB11",26,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB11",27,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11",28,0)
 ;
"RTN","IBCBB11",29,0)
 ; Check for required NPIs
"RTN","IBCBB11",30,0)
NPICHK ;
"RTN","IBCBB11",31,0)
 N IBNPIS,IBNONPI,IBNPIREQ,Z
"RTN","IBCBB11",32,0)
 S IBNPIREQ=$$NPIREQ^IBCEP81(DT)  ; Check if NPI is required
"RTN","IBCBB11",33,0)
 ; Check providers
"RTN","IBCBB11",34,0)
 S IBNPIS=$$PROVNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",35,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",36,0)
 . I IBNPIREQ S IBER=IBER_"IB"_(140+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",37,0)
 . D WARN("NPI for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNONPI,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",38,0)
 ; Check organizations
"RTN","IBCBB11",39,0)
 S IBNONPI=""
"RTN","IBCBB11",40,0)
 S IBNPIS=$$ORGNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",41,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",42,0)
 . I IBNPIREQ S IBER=IBER_"IB"_(160+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",43,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",44,0)
 . D WARN("NPI for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNONPI,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",45,0)
 Q
"RTN","IBCBB11",46,0)
 ;
"RTN","IBCBB11",47,0)
 ; Check for required taxonomies
"RTN","IBCBB11",48,0)
TAXCHK ;
"RTN","IBCBB11",49,0)
 N IBTAXS,IBNOTAX,IBTAXREQ,Z
"RTN","IBCBB11",50,0)
 S IBTAXREQ=$$TAXREQ^IBCEP81(DT)  ; Check if taxonomy is required
"RTN","IBCBB11",51,0)
 ; Check providers
"RTN","IBCBB11",52,0)
 S IBTAXS=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",53,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",54,0)
 . I IBTAXREQ S IBER=IBER_"IB"_(250+$P(IBNOTAX,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",55,0)
 . D WARN("Taxonomy for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNOTAX,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",56,0)
 ; Check organizations
"RTN","IBCBB11",57,0)
 S IBNOTAX=""
"RTN","IBCBB11",58,0)
 S IBTAXS=$$ORGTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",59,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",60,0)
 . I IBTAXREQ S IBER=IBER_"IB"_(164+$P(IBNOTAX,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",61,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",62,0)
 . D WARN("Taxonomy for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNOTAX,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",63,0)
 Q
"RTN","IBCBB11",64,0)
 ;
"RTN","IBCBB11",65,0)
VALNDC(IBIFN,IBDFN) ; IB*2*363 - validate NDC# between PRESCRIPTION file (#52) 
"RTN","IBCBB11",66,0)
 ; and IB BILL/CLAIMS PRESCRIPTION REFILL file (#362.4)
"RTN","IBCBB11",67,0)
 ; input - IBIFN = internal entry number of the billing record in the BILL/CLAIMS file (#399)
"RTN","IBCBB11",68,0)
 ;         IBDFN = internal entry number of patient record in the PATIENT file (#2)
"RTN","IBCBB11",69,0)
 N IBX,IBRXCOL
"RTN","IBCBB11",70,0)
 ; call program that determines if NDC differences exist
"RTN","IBCBB11",71,0)
 D VALNDC^IBEFUNC3(IBIFN,IBDFN,.IBRXCOL)
"RTN","IBCBB11",72,0)
 Q:'$D(IBRXCOL)
"RTN","IBCBB11",73,0)
 ; at least one RX on the IB record has an NDC discrepancy 
"RTN","IBCBB11",74,0)
 S IBX=0 F  S IBX=$O(IBRXCOL(IBX)) Q:'IBX  D WARN("NDC# on Bill does not equal the NDC# on Rx "_IBRXCOL(IBX))
"RTN","IBCBB11",75,0)
 Q
"RTN","IBCCC3")
0^8^B9038313
"RTN","IBCCC3",1,0)
IBCCC3 ;ALB/AAS - CANCEL AND CLONE A BILL - CONTINUED ;25-JAN-90
"RTN","IBCCC3",2,0)
 ;;2.0;INTEGRATED BILLING;**363**;21-MAR-94;Build 35
"RTN","IBCCC3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCC3",4,0)
 ;
"RTN","IBCCC3",5,0)
 ;copy entries from table files:
"RTN","IBCCC3",6,0)
 ;passed in: IBIFN=new bill, IBIFN1=old bill
"RTN","IBCCC3",7,0)
 ;
"RTN","IBCCC3",8,0)
 I '$D(^DGCR(399,+$G(IBIFN),0))!'$D(^DGCR(399,+$G(IBIFN1),0)) Q
"RTN","IBCCC3",9,0)
 N IBXR,X,Y,IBX
"RTN","IBCCC3",10,0)
 ;
"RTN","IBCCC3",11,0)
DX ;copy diagnosis' (362.3)
"RTN","IBCCC3",12,0)
 N IBDX,IBDIFN
"RTN","IBCCC3",13,0)
 ;copy diagnosis from old bill
"RTN","IBCCC3",14,0)
 I $D(^IBA(362.3,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",15,0)
 . S IBDX=0 F  S IBDX=$O(^IBA(362.3,IBXR,IBDX)) Q:'IBDX  D
"RTN","IBCCC3",16,0)
 .. S IBDIFN=0 F  S IBDIFN=$O(^IBA(362.3,IBXR,IBDX,IBDIFN)) Q:'IBDIFN  D
"RTN","IBCCC3",17,0)
 ... S IBX=$G(^IBA(362.3,IBDIFN,0)) I 'IBX!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",18,0)
 ... S DIC="^IBA(362.3,",DIC(0)="L",X=+IBX K DA,DO D FILE^DICN
"RTN","IBCCC3",19,0)
 ... S DIE=DIC,DA=+Y,DR=".02////"_IBIFN_";.03////"_$P(IBX,U,3) D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",20,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",21,0)
 ;
"RTN","IBCCC3",22,0)
PRDX ;repoint procedure's associated diagnosis (2,304,10-13 -> 362.3)
"RTN","IBCCC3",23,0)
 N IBCPT,IBDIFN1,IBLN,IBI
"RTN","IBCCC3",24,0)
 S IBCPT=0 F  S IBCPT=$O(^DGCR(399,+IBIFN,"CP",IBCPT)) Q:'IBCPT  D
"RTN","IBCCC3",25,0)
 . S IBLN=$G(^DGCR(399,+IBIFN,"CP",IBCPT,0)) F IBI=11:1:14 S IBDIFN1=$P(IBLN,U,IBI) I +IBDIFN1 D
"RTN","IBCCC3",26,0)
 .. S IBDX=+$G(^IBA(362.3,+IBDIFN1,0)) Q:'IBDX
"RTN","IBCCC3",27,0)
 .. S IBDIFN=$O(^IBA(362.3,"AIFN"_IBIFN,IBDX,0)) Q:'IBDIFN
"RTN","IBCCC3",28,0)
 .. S $P(^DGCR(399,+IBIFN,"CP",IBCPT,0),U,IBI)=IBDIFN
"RTN","IBCCC3",29,0)
 ;
"RTN","IBCCC3",30,0)
RX ;copy rx refills (362.4)
"RTN","IBCCC3",31,0)
 N IBRX,IBRIFN,IBRXDA,IBDATE,IBNDC,IBDFN,IB3624DA
"RTN","IBCCC3",32,0)
 ;copy rx refills from old bill
"RTN","IBCCC3",33,0)
 ; IB*2*363 - get NDC# from PRESCRIPTION file (#52) before creating new
"RTN","IBCCC3",34,0)
 ; record entry in 362.4
"RTN","IBCCC3",35,0)
 I $D(^IBA(362.4,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",36,0)
 . S IBRX=0 F  S IBRX=$O(^IBA(362.4,IBXR,IBRX)) Q:IBRX=""  D
"RTN","IBCCC3",37,0)
 .. S IBRIFN=0 F  S IBRIFN=$O(^IBA(362.4,IBXR,IBRX,IBRIFN)) Q:'IBRIFN  D
"RTN","IBCCC3",38,0)
 ... S IBX=$G(^IBA(362.4,IBRIFN,0)) I IBX=""!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",39,0)
 ... S DIC="^IBA(362.4,",DIC(0)="L",X=$P(IBX,U,1) K DA,DO D FILE^DICN K DA,DO Q:Y'>0
"RTN","IBCCC3",40,0)
 ... S IB3624DA=+Y,IBRXDA=$P(IBX,U,5),IBDATE=$P(IBX,U,3),IBDFN=$$GET1^DIQ(399,IBIFN1,.02,"I")
"RTN","IBCCC3",41,0)
 ... S IBNDC=$$GETNDC^IBEFUNC3(IBDFN,IBRXDA,IBDATE)
"RTN","IBCCC3",42,0)
 ... S DR=".02////"_IBIFN_";.03////"_IBDATE_";.04////"_$P(IBX,U,4)_";.05////"_IBRXDA_";.06////"_$P(IBX,U,6)_";.07////"_$P(IBX,U,7)_";.08////"_IBNDC
"RTN","IBCCC3",43,0)
 ... S DIE=DIC,DA=IB3624DA D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",44,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",45,0)
 ;
"RTN","IBCCC3",46,0)
PROS ;copy prosthetics (362.5)
"RTN","IBCCC3",47,0)
 N IBPR,IBPIFN
"RTN","IBCCC3",48,0)
 ;copy rx refills from old bill
"RTN","IBCCC3",49,0)
 I $D(^IBA(362.5,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",50,0)
 . S IBPR=0 F  S IBPR=$O(^IBA(362.5,IBXR,IBPR)) Q:IBPR=""  D
"RTN","IBCCC3",51,0)
 .. S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.5,IBXR,IBPR,IBPIFN)) Q:'IBPIFN  D
"RTN","IBCCC3",52,0)
 ... S IBX=$G(^IBA(362.5,IBPIFN,0)) I IBX=""!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",53,0)
 ... S DIC="^IBA(362.5,",DIC(0)="L",X=$P(IBX,U,1) K DA,DO D FILE^DICN K DA,DO Q:Y'>0
"RTN","IBCCC3",54,0)
 ... S DR=".02////"_IBIFN_";.03////"_$P(IBX,U,3)_";.04////"_$P(IBX,U,4)
"RTN","IBCCC3",55,0)
 ... S DIE=DIC,DA=+Y D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",56,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",57,0)
 Q
"RTN","IBCCC3",58,0)
 ;IBCCC3
"RTN","IBCF13")
0^13^B5416483
"RTN","IBCF13",1,0)
IBCF13 ;ALB/AAS - PRINT UB-82 FROM A ;8/2/90
"RTN","IBCF13",2,0)
 ;;2.0;INTEGRATED BILLING;**63,363**;21-MAR-94;Build 35
"RTN","IBCF13",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCF13",4,0)
 ;MAP TO DGCRP3
"RTN","IBCF13",5,0)
 ;
"RTN","IBCF13",6,0)
 ;Entry point for AR to print 2nd and 3rd Notice UB-82's
"RTN","IBCF13",7,0)
 ;Device handling to be done by calling routine
"RTN","IBCF13",8,0)
 ;Requires input  - PRCASV("ARREC") = internal number of bill
"RTN","IBCF13",9,0)
 ;                - PRCASV("NOTICE")= number of notice
"RTN","IBCF13",10,0)
 ;ouputs          - IBAR("ERR")    = error message
"RTN","IBCF13",11,0)
 ;                - IBAR("OKAY")   = 1 normal finish, 0 not finished
"RTN","IBCF13",12,0)
 ;
"RTN","IBCF13",13,0)
REPRNT N I,J,DFN ;AR variables that need newing
"RTN","IBCF13",14,0)
 N IBECME
"RTN","IBCF13",15,0)
 K IBAR("ERR")
"RTN","IBCF13",16,0)
 S IBAR("OKAY")=0 I '$D(PRCASV("ARREC"))!('$D(PRCASV("NOTICE"))) S IBAR("ERR")="MISSING INPUT VARIABLES" Q
"RTN","IBCF13",17,0)
 S IBIFN=PRCASV("ARREC"),IB0=$S($D(^DGCR(399,IBIFN,0)):^(0),1:"") I IB0="" S IBAR("ERR")="BILL NON-EXISTANT" Q
"RTN","IBCF13",18,0)
 S DGSTAT=$P(IB0,"^",13) I $S(DGSTAT=3:0,DGSTAT=4:0,1:1) S IBAR("ERR")=$S(DGSTAT=7:"BILL CANCELLED",1:"BILL STATUS INAPPROPRIATE") Q
"RTN","IBCF13",19,0)
 ; IB*2*363 next line was added to prevent the print of forms for ePharmacy bills
"RTN","IBCF13",20,0)
 Q:$P($G(^DGCR(399,IBIFN,"M1")),"^",8)]""  ;ECME number exists so the bill was electronically submitted
"RTN","IBCF13",21,0)
 ; S DFN=$P(IB0,"^",2),IBPNT=PRCASV("NOTICE"),IBAC=4 D ENP^IBCF1
"RTN","IBCF13",22,0)
 ; replaced above line with following 2 lines 4/28/92 RLW
"RTN","IBCF13",23,0)
 ;S DFN=$P(IB0,"^",2),IBAC=4 I $P(^DGCR(399,IBIFN,0),"^",19)>1 D EN2^IBCF G REPRNTQ
"RTN","IBCF13",24,0)
 S DFN=$P(IB0,"^",2),IBAC=4 I $$FT^IBCU3(IBIFN)>1 D EN2^IBCF,EN5^IBCF G REPRNTQ
"RTN","IBCF13",25,0)
 S IBPNT=PRCASV("NOTICE") D ENP^IBCF1
"RTN","IBCF13",26,0)
 S IBAR("OKAY")=1
"RTN","IBCF13",27,0)
REPRNTQ K DFN,I,J
"RTN","IBCF13",28,0)
 K M,X,X2,Y,Z,VADM,VAERR,DR,DA,D1,DGBS,DGCNT,IB,IBBILL,IBBNO,IBBT,IBC,IBCPT,IBEPAR,IBDPT,IBDT,IBF,IBIP,IBLS,IBO,IBPNT,DGSTAT,IBAC,IBIFN,IB0
"RTN","IBCF13",29,0)
 K IBPTF,IBRATY,IBREV,IBREVC,IBST,IBTF,IBU,IBUTL,DGDA,DGLCNT,DGPAG,DGPT,DGRVC,DGRV,DGTOTPAG,DGTEXT,DGTEXT1,IBDI,IBDIN,IBBS,IBCC,IBPT,DGREVC,DGRSPAC,DGSM
"RTN","IBCF13",30,0)
 Q
"RTN","IBCF13",31,0)
 ;
"RTN","IBCF13",32,0)
PRINT ;Entry for A/R to create option to print bills.
"RTN","IBCF13",33,0)
 S IBVIEW=1 D KILL^IBCMENU,GEN^IBCB,KILL^IBCMENU
"RTN","IBCF13",34,0)
 Q
"RTN","IBCNSP")
0^6^B31460590
"RTN","IBCNSP",1,0)
IBCNSP ;ALB/AAS - INSURANCE MANAGEMENT - EXPANDED POLICY ;05-MAR-1993
"RTN","IBCNSP",2,0)
 ;;2.0;INTEGRATED BILLING;**6,28,43,52,85,251,363**;21-MAR-94;Build 35
"RTN","IBCNSP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCNSP",4,0)
% ;
"RTN","IBCNSP",5,0)
EN ; -- main entry point for IBCNS EXPANDED POLICY
"RTN","IBCNSP",6,0)
 K VALMQUIT,IBPPOL
"RTN","IBCNSP",7,0)
 S IBTOP="IBCNSP"
"RTN","IBCNSP",8,0)
 D EN^VALM("IBCNS EXPANDED POLICY")
"RTN","IBCNSP",9,0)
 Q
"RTN","IBCNSP",10,0)
 ;
"RTN","IBCNSP",11,0)
HDR ; -- header code
"RTN","IBCNSP",12,0)
 N W,X,Y,Z
"RTN","IBCNSP",13,0)
 S VALMHDR(1)="Expanded Policy Information for: "_$E($P(^DPT(DFN,0),U),1,20)_"  "_$P($$PT^IBEFUNC(DFN),U,2)
"RTN","IBCNSP",14,0)
 S Z=$G(^DPT(DFN,.312,+$P(IBPPOL,U,4),0))
"RTN","IBCNSP",15,0)
 S W=$P($G(^IBA(355.3,+$P(Z,U,18),0)),U,11)
"RTN","IBCNSP",16,0)
 S Y=$E($P($G(^DIC(36,+Z,0)),U),1,20)_" Insurance Company"
"RTN","IBCNSP",17,0)
 S X="** Plan Currently "_$S(W:"Ina",1:"A")_"ctive **"
"RTN","IBCNSP",18,0)
 S VALMHDR(2)=$$SETSTR^VALM1(X,Y,48,29)
"RTN","IBCNSP",19,0)
 Q
"RTN","IBCNSP",20,0)
 ;
"RTN","IBCNSP",21,0)
INIT ; -- init variables and list array
"RTN","IBCNSP",22,0)
 K VALMQUIT
"RTN","IBCNSP",23,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBCNSP",24,0)
 I '$D(IBPPOL) D PPOL Q:$D(VALMQUIT)
"RTN","IBCNSP",25,0)
 K ^TMP("IBCNSVP",$J)
"RTN","IBCNSP",26,0)
 D BLD,HDR
"RTN","IBCNSP",27,0)
 Q
"RTN","IBCNSP",28,0)
 ;
"RTN","IBCNSP",29,0)
BLD ; -- list builder
"RTN","IBCNSP",30,0)
 K ^TMP("IBCNSVP",$J),^TMP("IBCNSVPDX",$J)
"RTN","IBCNSP",31,0)
 D KILL^VALM10()
"RTN","IBCNSP",32,0)
 F I=1:1:50 D BLANK(.I)
"RTN","IBCNSP",33,0)
 S VALMCNT=50
"RTN","IBCNSP",34,0)
 N IBCDFND,IBCDFND1,IBCDFND2,IBCDFND4
"RTN","IBCNSP",35,0)
 S IBCDFND=$G(^DPT(DFN,.312,$P(IBPPOL,U,4),0)),IBCDFND1=$G(^(1)),IBCDFND2=$G(^(2)),IBCDFND4=$G(^(4))
"RTN","IBCNSP",36,0)
 S IBCPOL=+$P(IBCDFND,U,18),IBCNS=+IBCDFND,IBCDFN=$P(IBPPOL,U,4)
"RTN","IBCNSP",37,0)
 S IBCPOLD=$G(^IBA(355.3,+$P(IBCDFND,U,18),0)),IBCPOLD1=$G(^(1))
"RTN","IBCNSP",38,0)
 S IBCPOLD2=$G(^IBA(355.3,+$G(IBCPOL),6)) ;; Daou/EEN adding BIN and PCN
"RTN","IBCNSP",39,0)
 S IBLCNT=0
"RTN","IBCNSP",40,0)
 D POLICY^IBCNSP0,INS^IBCNSP0,SPON^IBCNSP0,LIMBLD^IBCNSC41(36,2,.IBLCNT)
"RTN","IBCNSP",41,0)
 D CONTACT^IBCNSP0,EFFECT,UR,EMP,VER^IBCNSP01,COMMENT,^IBCNSP01
"RTN","IBCNSP",42,0)
 Q
"RTN","IBCNSP",43,0)
 ;
"RTN","IBCNSP",44,0)
COMMENT ; -- Comment region
"RTN","IBCNSP",45,0)
 N START,OFFSET,IBL,IBI
"RTN","IBCNSP",46,0)
 S START=49+$G(IBLCNT),OFFSET=2,IBL=0
"RTN","IBCNSP",47,0)
 I '$D(@VALMAR@(START-1)) D SET(START-1,OFFSET,"  ")
"RTN","IBCNSP",48,0)
 D SET(START,OFFSET," Comment -- Patient Policy ",IORVON,IORVOFF)
"RTN","IBCNSP",49,0)
 D SET(START+1,OFFSET,$S($P(IBCDFND1,U,8)="":"None",1:$P(IBCDFND1,U,8)))
"RTN","IBCNSP",50,0)
 I '$D(@VALMAR@(START+2)) D SET(START+2,OFFSET,"  ")
"RTN","IBCNSP",51,0)
 D SET(START+3,OFFSET," Comment -- Group Plan ",IORVON,IORVOFF)
"RTN","IBCNSP",52,0)
 S IBI=0 F  S IBI=$O(^IBA(355.3,+IBCPOL,11,IBI)) Q:IBI<1  D
"RTN","IBCNSP",53,0)
 .S IBL=IBL+1
"RTN","IBCNSP",54,0)
 .D SET(START+IBL+3,OFFSET,"  "_$E($G(^IBA(355.3,+IBCPOL,11,IBI,0)),1,80))
"RTN","IBCNSP",55,0)
 S IBLCNT=$G(IBLCNT)+IBL+1 D SET(START+IBL+4,OFFSET,"  ")
"RTN","IBCNSP",56,0)
 Q
"RTN","IBCNSP",57,0)
 ;
"RTN","IBCNSP",58,0)
EFFECT ; -- Effective date region
"RTN","IBCNSP",59,0)
 N START,OFFSET
"RTN","IBCNSP",60,0)
 S START=14,OFFSET=45
"RTN","IBCNSP",61,0)
 D SET(START,OFFSET-4," Effective Dates & Source ",IORVON,IORVOFF)
"RTN","IBCNSP",62,0)
 D SET(START+1,OFFSET," Effective Date: "_$$DAT1^IBOUTL($P(IBCDFND,U,8)))
"RTN","IBCNSP",63,0)
 D SET(START+2,OFFSET,"Expiration Date: "_$$DAT1^IBOUTL($P(IBCDFND,U,4)))
"RTN","IBCNSP",64,0)
 D SET(START+3,OFFSET," Source of Info: "_$$EXPAND^IBTRE(2.312,1.09,$P($G(IBCDFND1),U,9)))
"RTN","IBCNSP",65,0)
 D SET(START+4,OFFSET-4,"Policy Not Billable: "_$S($P($G(^DPT(DFN,.312,IBCDFN,3)),"^",4):"YES",1:"NO"))
"RTN","IBCNSP",66,0)
 Q
"RTN","IBCNSP",67,0)
 ;
"RTN","IBCNSP",68,0)
UR ; -- UR of insurance region
"RTN","IBCNSP",69,0)
 N START,OFFSET
"RTN","IBCNSP",70,0)
 S START=14,OFFSET=2
"RTN","IBCNSP",71,0)
 D SET(START,OFFSET," Utilization Review Info ",IORVON,IORVOFF)
"RTN","IBCNSP",72,0)
 D SET(START+1,OFFSET,"         Require UR: "_$$EXPAND^IBTRE(355.3,.05,$P(IBCPOLD,U,5)))
"RTN","IBCNSP",73,0)
 D SET(START+2,OFFSET,"   Require Amb Cert: "_$$EXPAND^IBTRE(355.3,.12,$P(IBCPOLD,U,12)))
"RTN","IBCNSP",74,0)
 D SET(START+3,OFFSET,"   Require Pre-Cert: "_$$EXPAND^IBTRE(355.3,.06,$P(IBCPOLD,U,6)))
"RTN","IBCNSP",75,0)
 D SET(START+4,OFFSET,"   Exclude Pre-Cond: "_$$EXPAND^IBTRE(355.3,.07,$P(IBCPOLD,U,7)))
"RTN","IBCNSP",76,0)
 D SET(START+5,OFFSET,"Benefits Assignable: "_$$EXPAND^IBTRE(355.3,.08,$P(IBCPOLD,U,8)))
"RTN","IBCNSP",77,0)
 Q
"RTN","IBCNSP",78,0)
EMP ; -- Insurance Employer Region
"RTN","IBCNSP",79,0)
 N OFFSET,START,IBADD
"RTN","IBCNSP",80,0)
 S START=19,OFFSET=40
"RTN","IBCNSP",81,0)
 D SET(START,OFFSET," Subscriber's Employer Information ",IORVON,IORVOFF)
"RTN","IBCNSP",82,0)
 D SET(START+1,OFFSET,"Emp Sponsored Plan: "_$S(+$P(IBCDFND2,U,10):"Yes",1:"No"))
"RTN","IBCNSP",83,0)
 D SET(START+2,OFFSET,"          Employer: "_$P(IBCDFND2,U,9))
"RTN","IBCNSP",84,0)
 D SET(START+3,OFFSET," Employment Status: "_$$EXPAND^IBTRE(2.312,2.11,$P(IBCDFND2,U,11)))
"RTN","IBCNSP",85,0)
 D SET(START+4,OFFSET,"   Retirement Date: "_$$DAT1^IBOUTL($P(IBCDFND2,U,12)))
"RTN","IBCNSP",86,0)
 D SET(START+5,OFFSET,"Claims to Employer: "_$S(+IBCDFND2:"Yes, Send to Employer",1:"No, Send to Insurance Company"))
"RTN","IBCNSP",87,0)
 ;I +IBCDFND2 W !!,"If ROI applies, make sure current consent is signed.",!! D PAUSE^VALM1
"RTN","IBCNSP",88,0)
 ;
"RTN","IBCNSP",89,0)
 D SET(START+6,OFFSET,"            Street: "_$P(IBCDFND2,U,2)) S IBADD=1
"RTN","IBCNSP",90,0)
 I $P(IBCDFND2,U,3)'="" D SET(START+7,OFFSET,"          Street 2: "_$P(IBCDFND2,U,3)) S IBADD=2
"RTN","IBCNSP",91,0)
 I $P(IBCDFND2,U,4)'="" D SET(START+8,OFFSET,"          Street 3: "_$P(IBCDFND2,U,4)) S IBADD=3
"RTN","IBCNSP",92,0)
 D SET(START+6+IBADD,OFFSET,"        City/State: "_$E($P(IBCDFND2,U,5),1,15)_$S($P(IBCDFND2,U,5)="":"",1:", ")_$P($G(^DIC(5,+$P(IBCDFND2,U,6),0)),U,2)_" "_$E($P(IBCDFND2,U,7),1,5))
"RTN","IBCNSP",93,0)
 D SET(START+7+IBADD,OFFSET,"             Phone: "_$P(IBCDFND2,U,8))
"RTN","IBCNSP",94,0)
 ;
"RTN","IBCNSP",95,0)
EMPQ Q
"RTN","IBCNSP",96,0)
 ; 
"RTN","IBCNSP",97,0)
HELP ; -- help code
"RTN","IBCNSP",98,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCNSP",99,0)
 Q
"RTN","IBCNSP",100,0)
 ;
"RTN","IBCNSP",101,0)
EXIT ; -- exit code
"RTN","IBCNSP",102,0)
 K IBPPOL,VALMQUIT,IBCNS,IBCPOL,IBCPOLD,IBCPOLD1,IBCPOLD2,IBCDFND,IBCDFND1,IBCDFND2
"RTN","IBCNSP",103,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","IBCNSP",104,0)
 Q
"RTN","IBCNSP",105,0)
 ;
"RTN","IBCNSP",106,0)
EXPND ; -- expand code
"RTN","IBCNSP",107,0)
 Q
"RTN","IBCNSP",108,0)
 ;
"RTN","IBCNSP",109,0)
PPOL ; -- select patient, select policy
"RTN","IBCNSP",110,0)
 I '$D(DFN) D  G:$D(VALMQUIT) PPOLQ
"RTN","IBCNSP",111,0)
 .S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC
"RTN","IBCNSP",112,0)
 .S DFN=+Y
"RTN","IBCNSP",113,0)
 I $G(DFN)<1 S VALMQUIT="" G PPOLQ
"RTN","IBCNSP",114,0)
 ;
"RTN","IBCNSP",115,0)
 I '$O(^DPT(DFN,.312,0)) W !!,"Patient doesn't have Insurance" K DFN G PPOL
"RTN","IBCNSP",116,0)
 ;
"RTN","IBCNSP",117,0)
 S DIC="^DPT("_DFN_",.312,",DIC(0)="AEQMN",DIC("A")="Select Patient Policy: "
"RTN","IBCNSP",118,0)
 D ^DIC I +Y<1 S VALMQUIT=""
"RTN","IBCNSP",119,0)
 G:$D(VALMQUIT) PPOLQ
"RTN","IBCNSP",120,0)
 S IBPPOL="^2^"_DFN_U_+Y_U_$G(^DPT(DFN,.312,+Y,0))
"RTN","IBCNSP",121,0)
PPOLQ K DIC Q
"RTN","IBCNSP",122,0)
 ;
"RTN","IBCNSP",123,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBCNSP",124,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBCNSP",125,0)
 Q
"RTN","IBCNSP",126,0)
 ;
"RTN","IBCNSP",127,0)
SET(LINE,COL,TEXT,ON,OFF) ; -- set display info in array
"RTN","IBCNSP",128,0)
 I '$D(@VALMAR@(LINE,0)) D BLANK(.LINE) S VALMCNT=$G(VALMCNT)+1
"RTN","IBCNSP",129,0)
 D SET^VALM10(.LINE,$$SETSTR^VALM1(.TEXT,@VALMAR@(LINE,0),.COL,$L(TEXT)))
"RTN","IBCNSP",130,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.LINE,.COL,$L(TEXT),$G(ON),$G(OFF))
"RTN","IBCNSP",131,0)
 W:'(LINE#5) "."
"RTN","IBCNSP",132,0)
 Q
"RTN","IBCNSP0")
0^7^B29977117
"RTN","IBCNSP0",1,0)
IBCNSP0 ;ALB/AAS - INSURANCE MANAGEMENT - EXPANDED POLICY  ;05-MAR-1993
"RTN","IBCNSP0",2,0)
 ;;2.0;INTEGRATED BILLING;**28,43,52,85,93,103,137,229,251,363**;21-MAR-94;Build 35
"RTN","IBCNSP0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCNSP0",4,0)
 ;
"RTN","IBCNSP0",5,0)
 ;
"RTN","IBCNSP0",6,0)
CONTACT ; -- Insurance Contact Information
"RTN","IBCNSP0",7,0)
 N OFFSET,START
"RTN","IBCNSP0",8,0)
 S START=41+$G(IBLCNT),OFFSET=42
"RTN","IBCNSP0",9,0)
 N IBTRC,IBTRCD,IBTCOD
"RTN","IBCNSP0",10,0)
 S IBTCOD=$O(^IBE(356.11,"ACODE",85,0))
"RTN","IBCNSP0",11,0)
 ;
"RTN","IBCNSP0",12,0)
 S IBTRC=0,IBTRCD=""
"RTN","IBCNSP0",13,0)
 F  S IBTRC=$O(^IBT(356.2,"D",DFN,IBTRC)) Q:'IBTRC  D
"RTN","IBCNSP0",14,0)
 .Q:$P($G(^IBT(356.2,+IBTRC,1)),"^",5)'=IBCDFN  ; must be same policy
"RTN","IBCNSP0",15,0)
 .Q:$P($G(^IBT(356.2,+IBTRC,0)),"^",4)'=IBTCOD  ; must be ins. ver. type
"RTN","IBCNSP0",16,0)
 .S IBTRCD=$G(^IBT(356.2,+IBTRC,0))
"RTN","IBCNSP0",17,0)
 ;
"RTN","IBCNSP0",18,0)
 I '$D(@VALMAR@(START-1)) D SET(START-1,OFFSET,"  ")
"RTN","IBCNSP0",19,0)
 D SET(START,OFFSET," Insurance Contact (last) ",IORVON,IORVOFF)
"RTN","IBCNSP0",20,0)
 D SET(START+1,OFFSET," Person Contacted: "_$$EXPAND^IBTRE(356.2,.06,$P(IBTRCD,"^",6)))
"RTN","IBCNSP0",21,0)
 D SET(START+2,OFFSET,"Method of Contact: "_$$EXPAND^IBTRE(356.2,.17,$P(IBTRCD,"^",17)))
"RTN","IBCNSP0",22,0)
 D SET(START+3,OFFSET,"  Contact's Phone: "_$$EXPAND^IBTRE(356.2,.07,$P(IBTRCD,"^",7)))
"RTN","IBCNSP0",23,0)
 D SET(START+4,OFFSET,"    Call Ref. No.: "_$$EXPAND^IBTRE(356.2,.09,$P(IBTRCD,"^",9)))
"RTN","IBCNSP0",24,0)
 D SET(START+5,OFFSET,"     Contact Date: "_$$EXPAND^IBTRE(356.2,.01,$P(IBTRCD,"^")))
"RTN","IBCNSP0",25,0)
 Q
"RTN","IBCNSP0",26,0)
 ;
"RTN","IBCNSP0",27,0)
POLICY ; -- Policy Region
"RTN","IBCNSP0",28,0)
 ; -- if pointer to policy file exists get data from policy file
"RTN","IBCNSP0",29,0)
 N OFFSET,START,IBP,IBX,IBPLNID,IBPLNNM,IBPLNNA,IBPLNLA
"RTN","IBCNSP0",30,0)
 S (IBPLNID,IBPLNNM,IBPLNNA,IBPLNLA)=""
"RTN","IBCNSP0",31,0)
 S START=1,OFFSET=2
"RTN","IBCNSP0",32,0)
 D GPLAN(+IBCPOLD2)
"RTN","IBCNSP0",33,0)
 D SET(START,OFFSET," Plan Information ",IORVON,IORVOFF)
"RTN","IBCNSP0",34,0)
 D SET(START+1,OFFSET,"   Is Group Plan: "_$S($P(IBCPOLD,"^",2)=1:"YES",1:"NO"))
"RTN","IBCNSP0",35,0)
 D SET(START+2,OFFSET,"      Group Name: "_$P(IBCPOLD,"^",3))
"RTN","IBCNSP0",36,0)
 D SET(START+3,OFFSET,"    Group Number: "_$P(IBCPOLD,"^",4))
"RTN","IBCNSP0",37,0)
 D SET(START+4,OFFSET,"             BIN: "_$P(IBCPOLD2,"^",2)) ;;Daou/EEN
"RTN","IBCNSP0",38,0)
 D SET(START+5,OFFSET,"             PCN: "_$P(IBCPOLD2,"^",3)) ;;04/09/04
"RTN","IBCNSP0",39,0)
 D SET(START+6,OFFSET,"    Type of Plan: "_$E($P($G(^IBE(355.1,+$P(IBCPOLD,"^",9),0)),"^"),1,23))
"RTN","IBCNSP0",40,0)
 S IBX=7
"RTN","IBCNSP0",41,0)
 I $P(IBCPOLD,U,14)]"" D
"RTN","IBCNSP0",42,0)
 . D SET(START+IBX,OFFSET,"   Plan Category: "_$$EXPAND^IBTRE(355.3,.14,$P(IBCPOLD,"^",14))) S IBX=IBX+1
"RTN","IBCNSP0",43,0)
 I $P(IBCPOLD,U,15)]"" D
"RTN","IBCNSP0",44,0)
 . D SET(START+IBX,OFFSET," Electronic Type: "_$$EXPAND^IBTRE(355.3,.15,$P(IBCPOLD,"^",15))) S IBX=IBX+1
"RTN","IBCNSP0",45,0)
 D SET(START+IBX,OFFSET,"  Plan Filing TF: "_$P(IBCPOLD,"^",13)) S IBX=IBX+1
"RTN","IBCNSP0",46,0)
 ; -- in case pointer is missing
"RTN","IBCNSP0",47,0)
 D SET(START+IBX,OFFSET,"      ePharmacy Plan ID: "_IBPLNID) S IBX=IBX+1
"RTN","IBCNSP0",48,0)
 D SET(START+IBX,OFFSET,"    ePharmacy Plan Name: "_IBPLNNM) S IBX=IBX+1
"RTN","IBCNSP0",49,0)
 D SET(START+IBX,OFFSET,"  ePharmacy Natl Status: "_IBPLNNA) S IBX=IBX+1
"RTN","IBCNSP0",50,0)
 D SET(START+IBX,OFFSET," ePharmacy Local Status: "_IBPLNLA) S IBX=IBX+1
"RTN","IBCNSP0",51,0)
 I '$G(^IBA(355.3,+$P(IBCDFND,"^",18),0)) D
"RTN","IBCNSP0",52,0)
 .D SET(START+1,OFFSET,"Insurance Number: "_$P(IBCDFND,"^",2))
"RTN","IBCNSP0",53,0)
 .D SET(START+2,OFFSET,"      Group Name: "_$P(IBCDFND,"^",15))
"RTN","IBCNSP0",54,0)
 .D SET(START+3,OFFSET,"    Group Number: "_$P(IBCDFND,"^",3))
"RTN","IBCNSP0",55,0)
 .Q
"RTN","IBCNSP0",56,0)
 Q
"RTN","IBCNSP0",57,0)
 ;
"RTN","IBCNSP0",58,0)
INS ; -- Insurance Co. Region
"RTN","IBCNSP0",59,0)
 N OFFSET,START,IBADD,IBCDFNDA,IBCDFNDB
"RTN","IBCNSP0",60,0)
 S START=1,OFFSET=45
"RTN","IBCNSP0",61,0)
 D SET(START,OFFSET," Insurance Company ",IORVON,IORVOFF)
"RTN","IBCNSP0",62,0)
 D SET(START+1,OFFSET,"   Company: "_$P($G(^DIC(36,+IBCDFND,0)),"^"))
"RTN","IBCNSP0",63,0)
 S IBCDFNDA=$G(^DIC(36,+IBCDFND,.11)),IBCDFNDB=$G(^(.13))
"RTN","IBCNSP0",64,0)
 G:IBCDFNDA="" INSQ
"RTN","IBCNSP0",65,0)
 D SET(START+2,OFFSET,"    Street: "_$P(IBCDFNDA,"^")) S IBADD=1
"RTN","IBCNSP0",66,0)
 I $P(IBCDFNDA,"^",2)'="" D SET(START+3,OFFSET,"  Street 2: "_$P(IBCDFNDA,"^",2)) S IBADD=2
"RTN","IBCNSP0",67,0)
 I $P(IBCDFNDA,"^",3)'="" D SET(START+4,OFFSET,"  Street 3: "_$P(IBCDFNDA,"^",3)) S IBADD=3
"RTN","IBCNSP0",68,0)
 D SET(START+2+IBADD,OFFSET,"City/State: "_$E($P(IBCDFNDA,"^",4),1,15)_$S($P(IBCDFNDA,"^",4)="":"",1:", ")_$P($G(^DIC(5,+$P(IBCDFNDA,"^",5),0)),"^",2)_" "_$E($P(IBCDFNDA,"^",6),1,5))
"RTN","IBCNSP0",69,0)
 D SET(START+3+IBADD,OFFSET,"Billing Ph: "_$P(IBCDFNDB,"^",2))
"RTN","IBCNSP0",70,0)
 D SET(START+4+IBADD,OFFSET,"Precert Ph: "_$$PHONE^IBCNSC01(IBCDFNDB))
"RTN","IBCNSP0",71,0)
 ;
"RTN","IBCNSP0",72,0)
INSQ Q
"RTN","IBCNSP0",73,0)
 ;
"RTN","IBCNSP0",74,0)
SPON ; -- Sponsor (Insured Person) Region
"RTN","IBCNSP0",75,0)
 N IBC3,IBSSN,IBZIP,START,OFFSET,IBA,DA,DR,DIC,DIQ
"RTN","IBCNSP0",76,0)
 S IBC3=$G(^DPT(DFN,.312,IBCDFN,3)),IBSSN=$P(IBC3,"^",5)
"RTN","IBCNSP0",77,0)
 S DA=+$P(IBC3,"^",2),DR=.01,DIQ(0)="E",DIC="^DIC(23,",DIQ="IBA" D EN^DIQ1
"RTN","IBCNSP0",78,0)
 S START=30,OFFSET=4
"RTN","IBCNSP0",79,0)
 D SET(START,OFFSET," Insured Person's Information (use Subscriber Update action) ",IORVON,IORVOFF)
"RTN","IBCNSP0",80,0)
 D SET(START+1,OFFSET,"    Insured's DOB: "_$$DAT3^IBOUTL($P(IBC3,"^")))
"RTN","IBCNSP0",81,0)
 D SET(START+2,OFFSET," Insured's Branch: "_$G(IBA(23,DA,.01,"E")))
"RTN","IBCNSP0",82,0)
 D SET(START+3,OFFSET,"   Insured's Rank: "_$P(IBC3,"^",3))
"RTN","IBCNSP0",83,0)
 D SET(START+4,OFFSET,"    Insured's SSN: "_$S(IBSSN]"":$E(IBSSN,1,3)_"-"_$E(IBSSN,4,5)_"-"_$E(IBSSN,6,9),1:""))
"RTN","IBCNSP0",84,0)
 ;
"RTN","IBCNSP0",85,0)
 S OFFSET=43
"RTN","IBCNSP0",86,0)
 S Y=$P(IBC3,"^",10) D ZIPOUT^VAFADDR S IBZIP=Y
"RTN","IBCNSP0",87,0)
 D SET(START+1,OFFSET," Str 1: "_$P(IBC3,"^",6))
"RTN","IBCNSP0",88,0)
 D SET(START+2,OFFSET," Str 2: "_$P(IBC3,"^",7))
"RTN","IBCNSP0",89,0)
 D SET(START+3,OFFSET,"  City: "_$P(IBC3,"^",8))
"RTN","IBCNSP0",90,0)
 D SET(START+4,OFFSET,"St/Zip: "_$P($G(^DIC(5,+$P(IBC3,"^",9),0)),"^",2)_"  "_IBZIP)
"RTN","IBCNSP0",91,0)
 D SET(START+5,OFFSET," Phone: "_$P(IBC3,"^",11))
"RTN","IBCNSP0",92,0)
 Q
"RTN","IBCNSP0",93,0)
 ;
"RTN","IBCNSP0",94,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBCNSP0",95,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBCNSP0",96,0)
 Q
"RTN","IBCNSP0",97,0)
 ;
"RTN","IBCNSP0",98,0)
SET(LINE,COL,TEXT,ON,OFF) ; -- set display info in array
"RTN","IBCNSP0",99,0)
 D:'$D(@VALMAR@(LINE,0)) BLANK(.LINE)
"RTN","IBCNSP0",100,0)
 D SET^VALM10(.LINE,$$SETSTR^VALM1(.TEXT,@VALMAR@(LINE,0),.COL,$L(TEXT)))
"RTN","IBCNSP0",101,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.LINE,.COL,$L(TEXT),$G(ON),$G(OFF))
"RTN","IBCNSP0",102,0)
 W:'(LINE#5) "."
"RTN","IBCNSP0",103,0)
 Q
"RTN","IBCNSP0",104,0)
GPLAN(IBPLDA) ; get data from PLAN file (#366.03) related to the
"RTN","IBCNSP0",105,0)
 ; GROUP INSURANCE PLAN file (#355.3) and the INSURANCE COMPANY file (#36)
"RTN","IBCNSP0",106,0)
 ; that is associated with the PATIENT
"RTN","IBCNSP0",107,0)
 ; input - IBPLDA - ien of the PLAN file (#366.03)
"RTN","IBCNSP0",108,0)
 N IBPLN0,IBAIEN,IBAPIEN,IBAP0
"RTN","IBCNSP0",109,0)
 S IBPLN0=$G(^IBCNR(366.03,IBPLDA,0)) ;; Q:'$P(IBPLN0,"^",3) ;quit if payer not defined 
"RTN","IBCNSP0",110,0)
 S IBPLNID=$P(IBPLN0,"^"),IBPLNNM=$P(IBPLN0,"^",2)
"RTN","IBCNSP0",111,0)
 S IBAIEN=$O(^IBCNR(366.13,"B","E-PHARM","")) Q:'IBAIEN
"RTN","IBCNSP0",112,0)
 S IBAPIEN=$O(^IBCNR(366.03,IBPLDA,3,"B",IBAIEN,"")) Q:'IBAPIEN
"RTN","IBCNSP0",113,0)
 S IBAP0=$G(^IBCNR(366.03,IBPLDA,3,IBAPIEN,0))
"RTN","IBCNSP0",114,0)
 S IBPLNNA=$S($P(IBAP0,"^",2)=0:"NOT ACTIVE",1:"ACTIVE")
"RTN","IBCNSP0",115,0)
 S IBPLNLA=$S($P(IBAP0,"^",3)=0:"NOT ACTIVE",1:"ACTIVE")
"RTN","IBCNSP0",116,0)
 Q
"RTN","IBCNSP0",117,0)
 ;
"RTN","IBCNSP0",118,0)
 ;IBCNSP0
"RTN","IBCSC5C")
0^11^B44500670
"RTN","IBCSC5C",1,0)
IBCSC5C ;ALB/ARH - ADD/EDIT PRESCRIPTION FILLS (CONTINUED) ;3/4/94
"RTN","IBCSC5C",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,130,51,160,260,309,315,339,347,363**;21-MAR-94;Build 35
"RTN","IBCSC5C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC5C",4,0)
 ;
"RTN","IBCSC5C",5,0)
 ;
"RTN","IBCSC5C",6,0)
DEFAULT(IFN,IBRX) ; add default DX and CPT to a prescription bill
"RTN","IBCSC5C",7,0)
 ; if one is not in PSO.  If there is, use it instead.
"RTN","IBCSC5C",8,0)
 ; IFN = ien of bill entry
"RTN","IBCSC5C",9,0)
 N IBX,IBPAR1,IBDX,IBCPT,IBDT,IBBIL,IBDXIFN,IBCPTIFN,IBY,IB52,IBC,PDFN,LIST,NODE
"RTN","IBCSC5C",10,0)
 S IBDXIFN=0
"RTN","IBCSC5C",11,0)
 S IBPAR1=$G(^IBE(350.9,1,1)),IBDX=$P(IBPAR1,U,29),IBCPT=$P(IBPAR1,U,30)
"RTN","IBCSC5C",12,0)
 S IBBIL=$G(^DGCR(399,+$G(IFN),0)) Q:IBBIL=""
"RTN","IBCSC5C",13,0)
 S IBX=$S($G(IBRX):$P($G(^DGCR(399,IFN,"RC",+IBRX,0)),U,11),1:$O(^IBA(362.4,"C",IFN,0))) Q:'IBX
"RTN","IBCSC5C",14,0)
 S IB52=+$P($G(^IBA(362.4,IBX,0)),"^",5),IBY=0
"RTN","IBCSC5C",15,0)
 S PDFN=$$FILE^IBRXUTL(IB52,2)
"RTN","IBCSC5C",16,0)
 S LIST="IBCSC5CARR"
"RTN","IBCSC5C",17,0)
 S NODE="ICD"
"RTN","IBCSC5C",18,0)
 D RX^PSO52API(PDFN,LIST,IB52,,NODE,,)
"RTN","IBCSC5C",19,0)
 I ^TMP($J,LIST,PDFN,IB52,"ICD",0)>0 D
"RTN","IBCSC5C",20,0)
 .S IBY=0 F  S IBY=$O(^TMP($J,LIST,PDFN,IB52,"ICD",IBY)) Q:IBY'>0  D
"RTN","IBCSC5C",21,0)
 ..S IBDX(IBY)=$$ICD^IBRXUTL1(PDFN,IB52,IBY,LIST)
"RTN","IBCSC5C",22,0)
 ..I 'IBDX(IBY) K IBDX(IBY)
"RTN","IBCSC5C",23,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",24,0)
 I 'IBDX,'IBCPT,$D(IBDX)<10 Q
"RTN","IBCSC5C",25,0)
 S IBDT=$P($G(^IBA(362.4,+IBX,0)),U,3) Q:'IBDT
"RTN","IBCSC5C",26,0)
 ; add dx associated with rx if they are there.
"RTN","IBCSC5C",27,0)
 I $D(IBDX)>9 S (IBC,IBDX,IBY)=0 F  S IBY=$O(IBDX(IBY)) Q:'IBY  D
"RTN","IBCSC5C",28,0)
 . I $D(^IBA(362.3,"AIFN"_IFN,+IBDX(IBY))) Q
"RTN","IBCSC5C",29,0)
 . S IBC=IBC+1
"RTN","IBCSC5C",30,0)
 . S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN_";.03////"_IBC,X=+IBDX(IBY),DLAYGO=362.3
"RTN","IBCSC5C",31,0)
 . K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO
"RTN","IBCSC5C",32,0)
 . S IBDXIFN(IBC)=+Y
"RTN","IBCSC5C",33,0)
 ; add default dx if none found on actual rx.
"RTN","IBCSC5C",34,0)
 I +IBDX,'$D(^IBA(362.3,"AIFN"_IFN,+IBDX)) S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN,X=IBDX,DLAYGO=362.3 K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO S IBDXIFN=+Y
"RTN","IBCSC5C",35,0)
 I +IBCPT D  ;Check if the procedure is already present for the Rx
"RTN","IBCSC5C",36,0)
 . N Z,Z0,DUP
"RTN","IBCSC5C",37,0)
 . S (DUP,Z)=0 F  S Z=$O(^DGCR(399,IFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:DUP
"RTN","IBCSC5C",38,0)
 .. I $P(Z0,U,10)=3,$P(Z0,U,15),$P(Z0,U,11)=IBX S DUP=1
"RTN","IBCSC5C",39,0)
 . Q:DUP
"RTN","IBCSC5C",40,0)
 . I $P($G(^DGCR(399,IFN,0)),U,9)="" S DIE="^DGCR(399,",DA=IFN,DR=".09////5" D ^DIE K DIE,DIC,DA,DR
"RTN","IBCSC5C",41,0)
 . I '$D(^DGCR(399,IFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCSC5C",42,0)
 . S DLAYGO=399,DIC("DR")="1////"_IBDT D
"RTN","IBCSC5C",43,0)
 . . I +IBDXIFN>0 S DIC("DR")=DIC("DR")_";10////"_IBDXIFN Q
"RTN","IBCSC5C",44,0)
 . . I $D(IBDXIFN)>9 F IBY=1:1:4 I $D(IBDXIFN(IBY)) S DIC("DR")=DIC("DR")_";"_(IBY+9)_"////"_IBDXIFN(IBY)
"RTN","IBCSC5C",45,0)
 . S DIC="^DGCR(399,"_IFN_",""CP"",",DIC(0)="L",DA(1)=IFN,X=IBCPT_";ICPT(" K DD,DO D FILE^DICN K DIC,DA,DD,DO,DR,DLAYGO
"RTN","IBCSC5C",46,0)
 . I +Y D
"RTN","IBCSC5C",47,0)
 .. N Z,IBZ
"RTN","IBCSC5C",48,0)
 .. S IBZ=+Y,Z=$S($G(IBREV):IBREV,1:$$FINDREV^IBCSC5A(IFN,3,+IBX))
"RTN","IBCSC5C",49,0)
 .. I Z S DR=".15////"_IBZ_";.06////"_IBCPT,DA=+Z,DA(1)=IFN,DIE="^DGCR(399,"_DA(1)_",""RC""," D ^DIE
"RTN","IBCSC5C",50,0)
 Q
"RTN","IBCSC5C",51,0)
 ;
"RTN","IBCSC5C",52,0)
RXDISP(DFN,DT1,DT2,ARRAY,POARR,RXARR,IBRXALL,NODISP) ; display all rx fills for a patient and date range
"RTN","IBCSC5C",53,0)
 ;RXARR (as defined by SET^IBCSC5A) passed by ref. only to check if rx-fill is on the bill, not necessary not changed
"RTN","IBCSC5C",54,0)
 ;returns: ARRAY(RX #, FILL DT) = RX IFN (52) ^ FILL IFN ^ DRUG ^ DAYS SUPPLY ^ QTY ^ NDC, pass by reference if desired
"RTN","IBCSC5C",55,0)
 ;         POARR(CNT)=RX # ^ FILL DT
"RTN","IBCSC5C",56,0)
 N PIFN,RIFN,IBX,IBY,DTE,DTR,RX,IBCNT,IBRX0,IBRX2,IBS,LIST,LIST2 K ARRAY,POARR S POARR=0,NODISP=+$G(NODISP)
"RTN","IBCSC5C",57,0)
 S IBCNT=0,DT1=$G(DT1)-.0001,DT2=$G(DT2) S:'DT2 DT2=9999999 Q:'$G(DFN)
"RTN","IBCSC5C",58,0)
 ;^PS(55,DFN,"P","A",EXPIRATION DATE, RX) is the best xref available for finding patient fills in a date range
"RTN","IBCSC5C",59,0)
 ;if RX expires/cancelled before start of bill then should not be applicable to bill
"RTN","IBCSC5C",60,0)
 S LIST="IBRXDISPARR"
"RTN","IBCSC5C",61,0)
 D PROF^PSO52API(DFN,LIST,DT1)
"RTN","IBCSC5C",62,0)
 S DTE=0 F  S DTE=$O(^TMP($J,LIST,"B",DTE)) Q:'DTE  D
"RTN","IBCSC5C",63,0)
 . S PIFN=0 F  S PIFN=$O(^TMP($J,LIST,"B",DTE,PIFN)) Q:'PIFN  D
"RTN","IBCSC5C",64,0)
 .. S IBRX0=$$RXZERO^IBRXUTL(DFN,PIFN),IBRX2=$$RXSEC^IBRXUTL(DFN,PIFN)
"RTN","IBCSC5C",65,0)
 .. ; original fill
"RTN","IBCSC5C",66,0)
 .. I +$G(IBRXALL) S DTR=$P(IBRX2,U,2) I DTR'<DT1,DTR'>DT2 D
"RTN","IBCSC5C",67,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",68,0)
 ... S ARRAY($P(IBRX0,U,1),+DTR)=PIFN_U_0_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBRX0,U,7)_U_$$GETNDC^PSONDCUT(PIFN,0)
"RTN","IBCSC5C",69,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",70,0)
 ... Q
"RTN","IBCSC5C",71,0)
 .. ; refills
"RTN","IBCSC5C",72,0)
 .. S LIST2="IBDISPSUB"
"RTN","IBCSC5C",73,0)
 .. S NODE="R"
"RTN","IBCSC5C",74,0)
 .. D RX^PSO52API(DFN,LIST2,PIFN,,NODE,,)
"RTN","IBCSC5C",75,0)
 .. S RIFN=0 F  S RIFN=$O(^TMP($J,LIST2,DFN,PIFN,"RF",RIFN)) Q:RIFN'>0  D
"RTN","IBCSC5C",76,0)
 ... S IBY=$$ZEROSUB^IBRXUTL(DFN,PIFN,RIFN) Q:IBY=""
"RTN","IBCSC5C",77,0)
 ... Q:+IBY<DT1!(+IBY>DT2)
"RTN","IBCSC5C",78,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",79,0)
 ... S ARRAY($P(IBRX0,U,1),+IBY)=PIFN_U_RIFN_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBY,U,4)_U_$$GETNDC^PSONDCUT(PIFN,RIFN)
"RTN","IBCSC5C",80,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",81,0)
 ... Q
"RTN","IBCSC5C",82,0)
 .. K ^TMP($J,LIST2)
"RTN","IBCSC5C",83,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",84,0)
 ;
"RTN","IBCSC5C",85,0)
 S IBX="",IBS=0 F  S IBX=$O(ARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(ARRAY(IBX,IBY)) Q:'IBY  D
"RTN","IBCSC5C",86,0)
 . S IBCNT=IBCNT+1,POARR(IBCNT)=$P(IBX,U,1)_"^"_+IBY,POARR=IBCNT I $D(RXARR(IBX,IBY)) S IBS=IBS+1
"RTN","IBCSC5C",87,0)
 S $P(POARR,U,2)=IBCNT-IBS
"RTN","IBCSC5C",88,0)
 ;
"RTN","IBCSC5C",89,0)
 Q:+NODISP
"RTN","IBCSC5C",90,0)
 W @IOF,?33,"PRESCRIPTIONS IN DATE RANGE",!,"===============================================================================",!
"RTN","IBCSC5C",91,0)
 S IBCNT=0 F  S IBCNT=$O(POARR(IBCNT)) Q:IBCNT=""  S RX=$P(POARR(IBCNT),U,1),DTR=$P(POARR(IBCNT),U,2) I RX'="",DTR'="" D
"RTN","IBCSC5C",92,0)
 . S IBS=$$RXSTAT^IBCU1($P(ARRAY(RX,DTR),U,3),$P(ARRAY(RX,DTR),U,1),DTR)
"RTN","IBCSC5C",93,0)
 . S IBY="" I $D(RXARR(RX,+DTR)) S IBY="*"
"RTN","IBCSC5C",94,0)
 . D ZERO^IBRXUTL(+$P(ARRAY(RX,DTR),U,3))
"RTN","IBCSC5C",95,0)
 . W !,$J(IBCNT,2),")",?5,IBY,?6,RX,?19,$E($G(^TMP($J,"IBDRUG",+$P(ARRAY(RX,DTR),U,3),.01)),1,25),?46,$$DATE(+DTR),?56,$P(IBS,U,1),?61,$P(IBS,U,2),?69,$P(IBS,U,3),?75,$$EXEMPT(+ARRAY(RX,DTR))
"RTN","IBCSC5C",96,0)
 . S IBY=$$RXDUP^IBCU3(RX,DTR,IBIFN) I +IBY W ?73,$P($G(^DGCR(399,+IBY,0)),U,1)
"RTN","IBCSC5C",97,0)
 . K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",98,0)
 Q
"RTN","IBCSC5C",99,0)
DATE(X) Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCSC5C",100,0)
 ;
"RTN","IBCSC5C",101,0)
NEWRX(IBX) ;
"RTN","IBCSC5C",102,0)
 Q:'$G(IBX)  N X,Y K IBLIST W !
"RTN","IBCSC5C",103,0)
NEWRX1 S DIR("?")="Enter the number preceding the RX Fills you want added to the bill. "_$$HTEXT
"RTN","IBCSC5C",104,0)
 S DIR("A")="SELECT NEW RX FILLS TO ADD THE BILL"
"RTN","IBCSC5C",105,0)
 S DIR(0)="LO^1:"_+IBX D ^DIR K DIR G:'Y!$D(DIRUT) NEWRXE
"RTN","IBCSC5C",106,0)
 S IBLIST=Y
"RTN","IBCSC5C",107,0)
 ;
"RTN","IBCSC5C",108,0)
 S DIR("A")="YOU HAVE SELECTED "_IBLIST_" TO BE ADDED TO THE BILL IS THIS CORRECT",DIR("B")="YES"
"RTN","IBCSC5C",109,0)
 S DIR(0)="YO" D ^DIR K DIR I $D(DIRUT) K IBLIST G NEWRXE
"RTN","IBCSC5C",110,0)
 I 'Y K IBLIST G NEWRX1
"RTN","IBCSC5C",111,0)
NEWRXE Q
"RTN","IBCSC5C",112,0)
 ;
"RTN","IBCSC5C",113,0)
ADDNEW(IBIFN,LIST,IBPR,IBPRO) ;
"RTN","IBCSC5C",114,0)
 Q:'LIST  N IBI,IBX,IBRX,IBDT,IBQ,IBY,IBPIFN,IBZ
"RTN","IBCSC5C",115,0)
 F IBI=1:1 S IBX=$P(LIST,",",IBI) Q:'IBX  I $D(IBPRO(IBX)) D
"RTN","IBCSC5C",116,0)
 . S IBRX=$P(IBPRO(IBX),U,1),IBDT=$P(IBPRO(IBX),U,2) Q:IBRX=""
"RTN","IBCSC5C",117,0)
 . S IBQ=0,IBY=$G(IBPR(IBRX,+IBDT)) Q:'IBY
"RTN","IBCSC5C",118,0)
 . S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX,IBPIFN)) Q:'IBPIFN  I $P($G(^IBA(362.4,IBPIFN,0)),U,3)=IBDT S IBQ=1 Q
"RTN","IBCSC5C",119,0)
 . I 'IBQ S IBZ=$G(IBPR(IBRX,IBDT)) I $$ADD^IBCSC5A(IBRX,IBIFN,IBDT,$P(IBZ,U,3),$P(IBZ,U,1),$P(IBZ,U,4,6)) W "."
"RTN","IBCSC5C",120,0)
 Q
"RTN","IBCSC5C",121,0)
 ;
"RTN","IBCSC5C",122,0)
HTEXT() ;
"RTN","IBCSC5C",123,0)
 N X S X="If an Rx fill has been assigned to another bill it will be displayed in the last column. [ORG=Original Fill, NR=Not Released, RTS=Returned to Stock, OTC=Over-the-Counter, INV=Investigational, SUP=Supply Item]"
"RTN","IBCSC5C",124,0)
 Q X
"RTN","IBCSC5C",125,0)
 ;
"RTN","IBCSC5C",126,0)
RXLINK(IBIFN,CPIEN) ; Function returns the ien of the Rx rev code the proc
"RTN","IBCSC5C",127,0)
 ; code is linked to or 0 if no link found.
"RTN","IBCSC5C",128,0)
 Q +$O(^DGCR(399,IBIFN,"RC","ACP",+CPIEN,0))
"RTN","IBCSC5C",129,0)
 ;
"RTN","IBCSC5C",130,0)
EXEMPT(RX) ; Used to look up exemption if any on rx, the return value
"RTN","IBCSC5C",131,0)
 ; will be only the first exemption reason found.
"RTN","IBCSC5C",132,0)
 N IBX,IBZ,IBS,IBR,PDFN,LIST,NODE,ICDCT
"RTN","IBCSC5C",133,0)
 S PDFN=$$FILE^IBRXUTL(RX,2)
"RTN","IBCSC5C",134,0)
 S LIST="IBRXARREX"
"RTN","IBCSC5C",135,0)
 S NODE="ICD"
"RTN","IBCSC5C",136,0)
 D RX^PSO52API(PDFN,LIST,RX,,NODE,,)
"RTN","IBCSC5C",137,0)
 S ICDCT=$G(^TMP($J,LIST,PDFN,RX,"ICD",0))
"RTN","IBCSC5C",138,0)
 S IBR="",(IBS,IBX)=0
"RTN","IBCSC5C",139,0)
 I ICDCT>0 D
"RTN","IBCSC5C",140,0)
 .S IBX=0 F  S IBX=$O(^TMP($J,LIST,PDFN,RX,"ICD",IBX)) Q:IBX'>0!(IBS)  D
"RTN","IBCSC5C",141,0)
 ..S IBZ=$$ICD^IBRXUTL1(PDFN,RX,IBX,LIST) F IBP=2:1:8 Q:IBS  I $P(IBZ,"^",IBP) S IBR=$P($T(EREASON+(IBP-1)),";",3),IBS=1
"RTN","IBCSC5C",142,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",143,0)
 Q IBR
"RTN","IBCSC5C",144,0)
EREASON ;
"RTN","IBCSC5C",145,0)
 ;;AO
"RTN","IBCSC5C",146,0)
 ;;IR
"RTN","IBCSC5C",147,0)
 ;;SC
"RTN","IBCSC5C",148,0)
 ;;SWA
"RTN","IBCSC5C",149,0)
 ;;MST
"RTN","IBCSC5C",150,0)
 ;;HNC
"RTN","IBCSC5C",151,0)
 ;;CV
"RTN","IBCSC5C",152,0)
 ;;SHAD
"RTN","IBCSC5C",153,0)
 ;
"RTN","IBEFUNC3")
0^12^B7226163
"RTN","IBEFUNC3",1,0)
IBEFUNC3 ;ALB/ARH - EXTRINSIC FUNCTIONS ;26-FEB-02
"RTN","IBEFUNC3",2,0)
 ;;2.0;INTEGRATED BILLING;**174,363**;21-MAR-94;Build 35
"RTN","IBEFUNC3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBEFUNC3",4,0)
 ;;
"RTN","IBEFUNC3",5,0)
BDSRC(IBVIFN) ; Check if billable Visit Data Source (9000010,81203)
"RTN","IBEFUNC3",6,0)
 ; only 'PROSTHETICS DATA' is non-billable (patch IB*2*174) (these are item, not visits)
"RTN","IBEFUNC3",7,0)
 ; Input:   IBVIFN pointer to Visit (9000010)
"RTN","IBEFUNC3",8,0)
 ; Returns: true if Billable Data Source
"RTN","IBEFUNC3",9,0)
 N IBDS,IBDSN,IBFLG S IBDSN="",IBFLG=1
"RTN","IBEFUNC3",10,0)
 ;
"RTN","IBEFUNC3",11,0)
 I +$G(IBVIFN) S IBDS=$P($G(^AUPNVSIT(+IBVIFN,812)),U,3) I +IBDS S IBDSN=$P($G(^PX(839.7,+IBDS,0)),U,1) D
"RTN","IBEFUNC3",12,0)
 . I IBDSN="PROSTHETICS DATA" S IBFLG=0
"RTN","IBEFUNC3",13,0)
 Q IBFLG
"RTN","IBEFUNC3",14,0)
 ;
"RTN","IBEFUNC3",15,0)
VALNDC(IBIFN,IBDFN,IBRXARY) ; NDC validation between file 362.4 and 52
"RTN","IBEFUNC3",16,0)
 ; IB*2*363 - NDC from file 352.4 can become out-of-synch with the latest
"RTN","IBEFUNC3",17,0)
 ; NDC# stored in the PRESCRIPTION file (#52) as the NDC can change after
"RTN","IBEFUNC3",18,0)
 ; the bill has been entered.  This algorithm compares the NDC# between
"RTN","IBEFUNC3",19,0)
 ; the 2 files and returns a value which represents whether the NDC# values
"RTN","IBEFUNC3",20,0)
 ; are the same or not the same.
"RTN","IBEFUNC3",21,0)
 ; input - IBIFN = internal entry number of BILL/CLAIMS file (#399)
"RTN","IBEFUNC3",22,0)
 ;         IBDFN = internal entry number of PATIENT file (#2) associated with the billing record
"RTN","IBEFUNC3",23,0)
 ; output - IBRXARY = array (passed in by reference) representing the collection of Rx records
"RTN","IBEFUNC3",24,0)
 ;                    that have different NDC#S between IB and OP files.
"RTN","IBEFUNC3",25,0)
 ; IBARRAY = array containing values returned from the entry in file 362.4
"RTN","IBEFUNC3",26,0)
 ; IBDA = internal entry number of the entry in file 362.4
"RTN","IBEFUNC3",27,0)
 ; IBRXDA = pointer to entry in the PRESCRIPTION file (#52) associated with billing record
"RTN","IBEFUNC3",28,0)
 ; IBDATE = Fill/refill date taken from entry in 362.4
"RTN","IBEFUNC3",29,0)
 ; IBNDC = National Drug Code (NDC) number taken from entry in 362.4
"RTN","IBEFUNC3",30,0)
 ; IB52NDC = NDC number taken from entry in file 52 associated with the billing record 
"RTN","IBEFUNC3",31,0)
 N IBARRAY,IBDA,IBRXDA,IBDATE,IBNDC,IB52DATE,IB52NDC,IBRFL
"RTN","IBEFUNC3",32,0)
 K IBRXARY  ; remove any incoming values
"RTN","IBEFUNC3",33,0)
 K ^TMP($J,"IBEFUNC3")
"RTN","IBEFUNC3",34,0)
 S IBDA=0 F  S IBDA=$O(^IBA(362.4,"C",IBIFN,IBDA)) Q:'IBDA  D
"RTN","IBEFUNC3",35,0)
 . D GETS^DIQ(362.4,IBDA_",",".02;.03;.05;.08","I","IBARRAY")
"RTN","IBEFUNC3",36,0)
 . S IBRXDA=IBARRAY(362.4,IBDA_",",.05,"I"),IBDATE=IBARRAY(362.4,IBDA_",",.03,"I")
"RTN","IBEFUNC3",37,0)
 . I 'IBRXDA Q  ;try next if no RX ien 
"RTN","IBEFUNC3",38,0)
 . S IBNDC=IBARRAY(362.4,IBDA_",",.08,"I")
"RTN","IBEFUNC3",39,0)
 . S IB52NDC=$$GETNDC(IBDFN,IBRXDA,IBDATE)
"RTN","IBEFUNC3",40,0)
 . S:IB52NDC'=IBNDC IBRXARY(IBRXDA)=$$RXAPI1^IBNCPUT1(IBRXDA,.01,"E")
"RTN","IBEFUNC3",41,0)
 Q
"RTN","IBEFUNC3",42,0)
 ;
"RTN","IBEFUNC3",43,0)
GETNDC(IBDFN,IBRXIEN,IBDT) ; get NDC# associated with fill/refill in file 52
"RTN","IBEFUNC3",44,0)
 ; Approved usage of $$GETNDC^PSONDCUT function  (IA 4705)
"RTN","IBEFUNC3",45,0)
 ; Input - IBDFN = internal entry number of PATIENT file (#2) associated with the billing record
"RTN","IBEFUNC3",46,0)
 ;         IBRXIEN = internal entry number of PRESCRIPTION file (#50) associated with the 
"RTN","IBEFUNC3",47,0)
 ;                   billing record
"RTN","IBEFUNC3",48,0)
 ;         IBDT = Fill/refill date taken from entry in 362.4
"RTN","IBEFUNC3",49,0)
 ; Output - IBRXNDC = NDC number taken from sub-entry of REFILL multiple of file 52 associated 
"RTN","IBEFUNC3",50,0)
 ;                    with the billing record
"RTN","IBEFUNC3",51,0)
 ; ; IB52DT = Fill/refill date taken from top entry or refill multiple of 52
"RTN","IBEFUNC3",52,0)
 N IBRXNDC,IB52DT
"RTN","IBEFUNC3",53,0)
 ;  RX^PSO52API returns data existing at the 0, 2, and refill multiple of file 52
"RTN","IBEFUNC3",54,0)
 D RX^PSO52API(IBDFN,"IBEFUNC3",IBRXIEN,,"2,R")
"RTN","IBEFUNC3",55,0)
 S IB52DT=$G(^TMP($J,"IBEFUNC3",IBDFN,IBRXIEN,22))  ; original fill date
"RTN","IBEFUNC3",56,0)
 I +IB52DT=IBDT S IBRXNDC=$G(^TMP($J,"IBEFUNC3",IBDFN,IBRXIEN,27))  ;original fill NDC#
"RTN","IBEFUNC3",57,0)
 E  D 
"RTN","IBEFUNC3",58,0)
 .; data examination needed on the REFILL multiple of file 52
"RTN","IBEFUNC3",59,0)
 .; IBSUBDA = REFILL multiple (52.1) IEN
"RTN","IBEFUNC3",60,0)
 . N IBSUBDA,IBQUIT
"RTN","IBEFUNC3",61,0)
 . S (IBQUIT,IBSUBDA,IBRXNDC)=0
"RTN","IBEFUNC3",62,0)
 . F  S IBSUBDA=$O(^TMP($J,"IBEFUNC3",IBDFN,IBRXIEN,"RF",IBSUBDA)) Q:'IBSUBDA  Q:IBQUIT  D
"RTN","IBEFUNC3",63,0)
 . . S IB52DT=$G(^TMP($J,"IBEFUNC3",IBDFN,IBRXIEN,"RF",IBSUBDA,.01))  ; refill date
"RTN","IBEFUNC3",64,0)
 . . I +IB52DT=IBDT S IBRXNDC=$$GETNDC^PSONDCUT(IBRXIEN,IBSUBDA),IBQUIT=1  ; refill NDC#
"RTN","IBEFUNC3",65,0)
 Q IBRXNDC
"RTN","IBJTCA1")
0^25^B38260395
"RTN","IBJTCA1",1,0)
IBJTCA1 ;ALB/ARH - TPI CLAIMS INFO BUILD ;16-FEB-1995
"RTN","IBJTCA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,106,137,223,276,363**;21-MAR-94;Build 35
"RTN","IBJTCA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTCA1",4,0)
 ;
"RTN","IBJTCA1",5,0)
BLD ; build array for Third Party Joint Inquiry Claims Info screen, IBIFN must be defined
"RTN","IBJTCA1",6,0)
 ;
"RTN","IBJTCA1",7,0)
 N X,IBY,IBZ,IBZ0,IBI,IBT,IBD,IBLN,IBLR,IBD0,IBDI1,IBDM,IBDM1,IBDU,IBDS,IBDU2,IBID0,IBID13,IBNC,IBTC,IBTW,IBSW,IBGRPB,IBGRPE,IBWNR,IBDTX,IBBX19,IBPRVO,IBNABP
"RTN","IBJTCA1",8,0)
 S VALMCNT=0,X="",IBD0=$G(^DGCR(399,+$G(IBIFN),0)) I IBD0="" S VALMQUIT="" G BLDQ
"RTN","IBJTCA1",9,0)
 F IBI="M","M1","U","S","U2","TX" S @("IBD"_IBI)=$G(^DGCR(399,+IBIFN,IBI))
"RTN","IBJTCA1",10,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1") S IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTCA1",11,0)
 S IBID0=$G(^DIC(36,+IBDI1,0)),IBID13=$G(^DIC(36,+IBDI1,.13))
"RTN","IBJTCA1",12,0)
 ;
"RTN","IBJTCA1",13,0)
 ;
"RTN","IBJTCA1",14,0)
 S (IBLN,VALMCNT)=1
"RTN","IBJTCA1",15,0)
 S (IBNC(1),IBTC(1),IBTC(4))=2,IBTC(5)=78,(IBNC(2),IBTC(2))=42,IBNC(3)=35,IBTW(1)=15,IBTW(2)=16,IBTW(4)=12,IBTW(5)=1,IBSW(1)=23,IBSW(2)=21,IBSW(4)=60,IBSW(5)=1
"RTN","IBJTCA1",16,0)
 ;
"RTN","IBJTCA1",17,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",18,0)
 ;
"RTN","IBJTCA1",19,0)
 S IBT="Insurance Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",20,0)
 S IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBJTCA1",21,0)
 S IBNABP=$$NABP^IBNCPDPU(IBIFN)
"RTN","IBJTCA1",22,0)
 S IBT=$S(IBWNR:" *",1:"  ")_"Bill Payer: ",IBD=$P(IBID0,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",23,0)
 S IBT="Claim Address: " D  S IBD=$P(IBDM,U,5) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",24,0)
 . I $P(IBID0,U,1)'=$P(IBDM,U,4) S IBD=$P(IBDM,U,4) S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=""
"RTN","IBJTCA1",25,0)
 I $P(IBDM,U,6)'="" S IBT="",IBD=$P(IBDM,U,6) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",26,0)
 I $P(IBDM1,U,1)'="" S IBT="",IBD=$P(IBDM1,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",27,0)
 S IBT="",IBD=$P(IBDM,U,7),IBD=IBD_$S(IBD'="":", ",1:"")_$P($G(^DIC(5,+$P(IBDM,U,8),0)),U,2)_" "_$P(IBDM,U,9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",28,0)
 S IBT="Claim Phone: ",IBD=$P($$BADD^IBJTU3(+IBIFN),U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",29,0)
 ;
"RTN","IBJTCA1",30,0)
 S IBGRPE=IBLN,IBLN=IBGRPB,IBLR=2
"RTN","IBJTCA1",31,0)
 ;
"RTN","IBJTCA1",32,0)
 S IBT="Subscriber Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",33,0)
 S IBT="Group Number: ",IBD=$P(IBDI1,U,3) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",34,0)
 S IBT="Group Name: ",IBD=$P(IBDI1,U,15) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",35,0)
 S IBT="Subscriber ID: ",IBD=$P(IBDI1,U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",36,0)
 S IBT="Employer: ",IBD=$$EMPL(+DFN) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",37,0)
 S IBT="Insured's Name: ",IBD=$P(IBDI1,U,17) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",38,0)
 S IBT="Relationship: ",IBD=$$EXSET^IBJU1($P(IBDI1,U,16),2.312,16) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",39,0)
 ;
"RTN","IBJTCA1",40,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",41,0)
 S (IBNC(1),IBTC(1))=2,(IBNC(2),IBTC(2))=42,IBNC(3)=29,IBTW(1)=12,IBTW(2)=16,IBSW(1)=26,IBSW(2)=22
"RTN","IBJTCA1",42,0)
 S (IBT,IBD)="" S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",43,0)
 ;
"RTN","IBJTCA1",44,0)
 I $$FT^IBCEF(IBIFN)=2 D
"RTN","IBJTCA1",45,0)
 . N IBXDATA,IBXSAVE K ^TMP("IBXSAVE",$J)
"RTN","IBJTCA1",46,0)
 . D F^IBCEF("N-HCFA 1500 BOX 19",,,IBIFN)
"RTN","IBJTCA1",47,0)
 . I IBXDATA'="" S IBBX19(1)=$E(IBXDATA,1,40) S:$E(IBXDATA,41,$L(IBXDATA))'="" IBBX19(2)=$E(IBXDATA,41,$L(IBXDATA))
"RTN","IBJTCA1",48,0)
 ;
"RTN","IBJTCA1",49,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",50,0)
 S IBT="Claim Information" S IBLN=$$SETN(IBT,IBLN,3,1)
"RTN","IBJTCA1",51,0)
 S IBT="Bill Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,5),399,.05) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",52,0)
 S IBT="Time Frame: ",IBD=$$EXSET^IBJU1($P(IBD0,U,6),399,.06) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",53,0)
 S IBT="Rate Type: ",IBD=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",54,0)
 S IBT="AR Status: ",IBD=$P($$ARSTATA^IBJTU4(IBIFN),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",55,0)
 S IBT=" Sequence: ",IBD=$P($$EXSET^IBJU1($P(IBD0,U,21),399,.21)," ",1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",56,0)
 S IBT="Purch Svc: ",IBD=$S($P(IBDU2,U,11)="":"NO",1:$$EXPAND^IBTRE(399,233,$P(IBDU2,U,11))),IBLN=$$SET(IBT,IBD,IBLN,4)
"RTN","IBJTCA1",57,0)
 I $P(IBDM1,"^",8) S IBT="  ECME No: ",IBD=+$P(IBDM1,"^",8),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",58,0)
 I $L($P(IBDM1,"^",9)) S IBT="ECME Ap No: ",IBD=$P(IBDM1,"^",9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",59,0)
 I IBNABP'="" S IBT=$S(($L($TR(IBNABP," ",""))=7):"  NCPDP No: ",1:"       NPI: "),IBD=IBNABP,IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",60,0)
 I IBWNR S IBT="MRA Status: ",IBD=$S($P(IBDTX,U,5):$P(IBDTX,U,5),1:"NOT RECEIVED"),IBLN=$$SET(IBT,$S(IBD:$$EXPAND^IBTRE(399,24,IBD),1:IBD),IBLN,IBLR)
"RTN","IBJTCA1",61,0)
 I $G(IBBX19(1))'="" D
"RTN","IBJTCA1",62,0)
 . S IBT="   Box 19: ",IBD=IBBX19(1),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",63,0)
 . I $G(IBBX19(2))'="" S IBT=$J("",11),IBD=IBBX19(2),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",64,0)
 ;
"RTN","IBJTCA1",65,0)
 S IBLR=4,IBPRVO=""
"RTN","IBJTCA1",66,0)
 S IBT="Providers: ",IBD="NONE"
"RTN","IBJTCA1",67,0)
 D F^IBCEF("N-ALL PROVIDERS","IBZ",,IBIFN)
"RTN","IBJTCA1",68,0)
 S IBZ0=0
"RTN","IBJTCA1",69,0)
 S Z=0
"RTN","IBJTCA1",70,0)
 F  S Z=$O(IBZ(Z)) Q:'Z  D
"RTN","IBJTCA1",71,0)
 . I $G(IBZ(Z)),$G(IBZ(Z,1))'="" S IBLN=$$SET(IBT,"(OLD PROV DATA) "_IBZ(Z,1),IBLN,IBLR),IBZ0=1 Q
"RTN","IBJTCA1",72,0)
 . I $P($G(IBZ(Z,1)),U)'="" S IBD=$E($$EXPAND^IBTRE(399.0222,.01,Z)_":"_$J("",15),1,15)_$P(IBZ(Z,1),U)_$S($P(IBZ(Z,1),U,4)'="":" ("_$P(IBZ(Z,1),U,4)_")",1:"") S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=$J("",11),IBZ0=1
"RTN","IBJTCA1",73,0)
 I 'IBZ0 S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",74,0)
 ;
"RTN","IBJTCA1",75,0)
 S IBGRPE=IBLN,IBLN=IBGRPB+1,IBLR=2
"RTN","IBJTCA1",76,0)
 ;
"RTN","IBJTCA1",77,0)
 S IBT="Charge Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,27),399,.27) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",78,0)
 S IBT="Service Dates: ",IBD=$$DATE^IBJU1($P(IBDU,U,1))_" - "_$$DATE^IBJU1($P(IBDU,U,2)) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",79,0)
 S IBT="Orig Claim: ",IBD=$$BILL^RCJIBFN2(+IBIFN) S IBLN=$$SET(IBT,$J($P(IBD,U,1),9,2),IBLN,IBLR)
"RTN","IBJTCA1",80,0)
 S IBT="Balance Due: ",IBD=$J($P(IBD,U,3),9,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",81,0)
 I +$P(IBDM,U,2) S IBX=$S($P(IBD0,U,21)="P":2,1:1) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",82,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Primary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",83,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",84,0)
 I +$P(IBDM,U,3) S IBX=$S($P(IBD0,U,21)="T":2,1:3) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",85,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Tertiary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",86,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",87,0)
 S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",88,0)
 I IBWNR S IBT="MRA Rec Date: " D  S IBLN=$$SET(IBT,IBD,IBLN,2)
"RTN","IBJTCA1",89,0)
 . N Z
"RTN","IBJTCA1",90,0)
 . ; find last MRA for receipt date
"RTN","IBJTCA1",91,0)
 . S (IBD,Z)="" F  S Z=$O(^IBM(361.1,"B",IBIFN,Z),-1) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)=1 S IBD=$$DATE^IBJU1($P($P(^IBM(361.1,Z,0),U,6),".")) Q
"RTN","IBJTCA1",92,0)
 F Z=IBLN:1:IBGRPE S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",93,0)
 ;
"RTN","IBJTCA1",94,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",95,0)
 ;
"RTN","IBJTCA1",96,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",97,0)
 D CONT^IBJTCA2
"RTN","IBJTCA1",98,0)
 ;
"RTN","IBJTCA1",99,0)
 S (IBLN,VALMCNT)=IBLN-1
"RTN","IBJTCA1",100,0)
 ;
"RTN","IBJTCA1",101,0)
BLDQ Q
"RTN","IBJTCA1",102,0)
 ;
"RTN","IBJTCA1",103,0)
EMPL(DFN) ; returns employer name
"RTN","IBJTCA1",104,0)
 Q $P($G(^DPT(+DFN,.311)),U,1)
"RTN","IBJTCA1",105,0)
 ;
"RTN","IBJTCA1",106,0)
SET(TTL,DATA,LN,LR) ;
"RTN","IBJTCA1",107,0)
 N IBY
"RTN","IBJTCA1",108,0)
 S IBY=$J(TTL,IBTW(LR))_DATA D SET1(IBY,LN,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJTCA1",109,0)
 S LN=LN+1
"RTN","IBJTCA1",110,0)
 Q LN
"RTN","IBJTCA1",111,0)
 ;
"RTN","IBJTCA1",112,0)
SETN(TTL,LN,LR,RV) ;
"RTN","IBJTCA1",113,0)
 N IBY
"RTN","IBJTCA1",114,0)
 S IBY=" "_TTL_" " D SET1(IBY,LN,IBNC(LR),$L(IBY),$G(RV))
"RTN","IBJTCA1",115,0)
 S LN=LN+1
"RTN","IBJTCA1",116,0)
 Q LN
"RTN","IBJTCA1",117,0)
 ;
"RTN","IBJTCA1",118,0)
SET1(STR,LN,COL,WD,RV) ; set up TMP array with screen data
"RTN","IBJTCA1",119,0)
 N IBX S IBX=$G(^TMP("IBJTCA",$J,LN,0))
"RTN","IBJTCA1",120,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJTCA1",121,0)
 D SET^VALM10(LN,IBX) I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IORVON,IORVOFF)
"RTN","IBJTCA1",122,0)
 Q
"RTN","IBNCPDP")
0^14^B1668933
"RTN","IBNCPDP",1,0)
IBNCPDP ;OAK/ELZ - APIS FOR NCPCP/ECME ;10-JUN-2003
"RTN","IBNCPDP",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,363**;21-MAR-94;Build 35
"RTN","IBNCPDP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP",4,0)
 ;
"RTN","IBNCPDP",5,0)
 ;
"RTN","IBNCPDP",6,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP",7,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP",8,0)
 ; a responce to bill ECME or not with array for billing data elements
"RTN","IBNCPDP",9,0)
 ;
"RTN","IBNCPDP",10,0)
 ; IBD("IEN")         = Prescription IEN
"RTN","IBNCPDP",11,0)
 ;    ("FILL NUMBER") = Fill number (0 is initial)
"RTN","IBNCPDP",12,0)
 ;    ("FILL DATE")   = Fill or refill date
"RTN","IBNCPDP",13,0)
 ;    ("RELEASE DATE")= Date of the Rx release in FileMan format
"RTN","IBNCPDP",14,0)
 ;    ("NDC")         = NDC number for drug
"RTN","IBNCPDP",15,0)
 ;    ("DEA")         = DEA special handling info
"RTN","IBNCPDP",16,0)
 ;    ("COST")        = cost of medication being dispenced
"RTN","IBNCPDP",17,0)
 ;    ("AO")          = Agent Orange (0,1 OR Null)
"RTN","IBNCPDP",18,0)
 ;    ("EC")          = Environmental Contaminant (0,1 OR Null)
"RTN","IBNCPDP",19,0)
 ;    ("HNC")         = Head/neck cancer (0,1 OR Null)
"RTN","IBNCPDP",20,0)
 ;    ("IR")          = Ionizing radiation (0,1 OR Null)
"RTN","IBNCPDP",21,0)
 ;    ("MST")         = Military sexual trauma (0,1 OR Null)
"RTN","IBNCPDP",22,0)
 ;    ("SC")          = Service connected (0,1 OR Null)
"RTN","IBNCPDP",23,0)
 ;    ("CV")          = Combat Veteran (0,1 OR Null)
"RTN","IBNCPDP",24,0)
 ;    ("QTY")         = Quantity of med
"RTN","IBNCPDP",25,0)
 ;    ("EPHARM")      = #9002313.56 ien (E-PHARMACY division)
"RTN","IBNCPDP",26,0)
 ;
"RTN","IBNCPDP",27,0)
 ;
"RTN","IBNCPDP",28,0)
 ; IBD("INS",n,1) = insurance array to bill in n order
"RTN","IBNCPDP",29,0)
 ;                  file 355.3 ien (group)^bin^pcn^payer sheet^group id^
"RTN","IBNCPDP",30,0)
 ;                  cardholder id^patient relationship code^
"RTN","IBNCPDP",31,0)
 ;                  cardholder first name^cardholder last name^
"RTN","IBNCPDP",32,0)
 ;                  home plan state
"RTN","IBNCPDP",33,0)
 ;    ("INS",n,2) = dispensing fee^basis of cost determination^
"RTN","IBNCPDP",34,0)
 ;                  awp or tort rate or cost^gross amount due^
"RTN","IBNCPDP",35,0)
 ;                  administrative fee
"RTN","IBNCPDP",36,0)
 ;
"RTN","IBNCPDP",37,0)
 ;   for basis of cost determination the following is used:
"RTN","IBNCPDP",38,0)
 ;      "07" would be sent for Usual & Customary
"RTN","IBNCPDP",39,0)
 ;      "01" would be sent for AWP
"RTN","IBNCPDP",40,0)
 ;      "05" would be sent for Cost calculations
"RTN","IBNCPDP",41,0)
 ;
"RTN","IBNCPDP",42,0)
 ;    ("INS",n,3) = group name^insurance co^phone number^plan ID
"RTN","IBNCPDP",43,0)
 N IBRES,IBNB
"RTN","IBNCPDP",44,0)
 S IBRES=$$RX^IBNCPDP1(DFN,.IBD)
"RTN","IBNCPDP",45,0)
 ;remove "Not ECME billable: " from the reason text
"RTN","IBNCPDP",46,0)
 S IBNB="Not ECME billable: "
"RTN","IBNCPDP",47,0)
 I IBRES[IBNB S IBRES=$P(IBRES,U)_U_$P($P(IBRES,U,2),IBNB,2)
"RTN","IBNCPDP",48,0)
 Q IBRES
"RTN","IBNCPDP",49,0)
 ;
"RTN","IBNCPDP",50,0)
 ;
"RTN","IBNCPDP",51,0)
STORESP(DFN,IBD) ; this is an API for pharmacy/ecme to use to relay
"RTN","IBNCPDP",52,0)
 ; results of billing using the ecme software.  If electronic billing is
"RTN","IBNCPDP",53,0)
 ; successful, then bills will be established.  If not, then we will
"RTN","IBNCPDP",54,0)
 ; flag the entry in ct for paper or not billable.
"RTN","IBNCPDP",55,0)
 ;
"RTN","IBNCPDP",56,0)
 ; IBD("STATUS")       = Bill status (PAID, REJECTED,REVERSED
"RTN","IBNCPDP",57,0)
 ;                        CLOSED,RELEASED,or SUBMITTED)
"RTN","IBNCPDP",58,0)
 ;    ("FILL DATE")    = Fill Date
"RTN","IBNCPDP",59,0)
 ;    ("PRESCRIPTION") = Prescription IEN from drug file (#52)
"RTN","IBNCPDP",60,0)
 ;    ("FILL NUMBER")  = Fill or refill number
"RTN","IBNCPDP",61,0)
 ;    ("BILLED")       = Amount billed
"RTN","IBNCPDP",62,0)
 ;    ("PAID")         = Amount paid
"RTN","IBNCPDP",63,0)
 ;    ("BCID")         = Reference number to the claim for payment
"RTN","IBNCPDP",64,0)
 ;                       BCID stands for Bill Claim ID
"RTN","IBNCPDP",65,0)
 ;    ("PLAN")         = IEN of the the entry in the GROUP INSURANCE 
"RTN","IBNCPDP",66,0)
 ;                       PLAN file(#355.3)(captured from the 
"RTN","IBNCPDP",67,0)
 ;                       $$RX^IBNCPDP call)
"RTN","IBNCPDP",68,0)
 ;    ("COPAY")        = Patient's copay from ECME response
"RTN","IBNCPDP",69,0)
 ;    ("RX NO")        = RX number from file 52
"RTN","IBNCPDP",70,0)
 ;    ("DRUG")         = IEN of file #50 DRUG
"RTN","IBNCPDP",71,0)
 ;    ("DAYS SUPPLY")  = Days Supply
"RTN","IBNCPDP",72,0)
 ;    ("QTY")          = Quantity
"RTN","IBNCPDP",73,0)
 ;    ("NDC")          = NDC
"RTN","IBNCPDP",74,0)
 ;    ("CLOSE REASON") = Optional, Pointer to the IB file #356.8 
"RTN","IBNCPDP",75,0)
 ;                      "CLAIMS TRACKING NON-BILLABLE REASONS"
"RTN","IBNCPDP",76,0)
 ;    ("CLOSE COMMENT")= Optional, if the close reason is defined 
"RTN","IBNCPDP",77,0)
 ;                       then the Close Comment parameter may be 
"RTN","IBNCPDP",78,0)
 ;                       sent to IB
"RTN","IBNCPDP",79,0)
 ;    ("DROP TO PAPER")= Optional, this parameter may be set to 1(TRUE) 
"RTN","IBNCPDP",80,0)
 ;                       for certain Close Claim Reasons, indicating
"RTN","IBNCPDP",81,0)
 ;                       that that the closed episode still may be 
"RTN","IBNCPDP",82,0)
 ;                       "dropped to paper" - passed to the Autobiller
"RTN","IBNCPDP",83,0)
 ;    ("RELEASE COPAY")= Optional, if the claim is being closed, setting
"RTN","IBNCPDP",84,0)
 ;                       this parameter to 1 (TRUE) indicates that the
"RTN","IBNCPDP",85,0)
 ;                       patients copay should be released off hold
"RTN","IBNCPDP",86,0)
 ;    ("DIVISION")     = Pointer to the MC DIVISION file (#40.8)
"RTN","IBNCPDP",87,0)
 ;    ("AUTH #")       = ECME approval/authorization number
"RTN","IBNCPDP",88,0)
 ;    ("CLAIMID")      = Reference Number to ECME
"RTN","IBNCPDP",89,0)
 ;    ("EPHARM")       = Optional, #9002313.56 ien (E-PHARMACY division)
"RTN","IBNCPDP",90,0)
 ;
"RTN","IBNCPDP",91,0)
 ;
"RTN","IBNCPDP",92,0)
 ; Return is the bill number for success or 1 if not billable.
"RTN","IBNCPDP",93,0)
 ; "0^reason" indicates not success
"RTN","IBNCPDP",94,0)
 ;
"RTN","IBNCPDP",95,0)
 Q $$ECME^IBNCPDP2(DFN,.IBD)
"RTN","IBNCPDP",96,0)
 ;
"RTN","IBNCPDP",97,0)
 ;
"RTN","IBNCPDP",98,0)
UPAWP(IBNDC,IBAWP,IBADT) ; used to update AWPs.  This is an API that
"RTN","IBNCPDP",99,0)
 ; pharmacy will call.
"RTN","IBNCPDP",100,0)
 ;
"RTN","IBNCPDP",101,0)
 ;  IBNDC = NDC number to update with the price.
"RTN","IBNCPDP",102,0)
 ;  IBAWP = average wholesale price of the NDC
"RTN","IBNCPDP",103,0)
 ;  IBADT  = effective date of change (optional, default it today)
"RTN","IBNCPDP",104,0)
 ;
"RTN","IBNCPDP",105,0)
 ;  return will be a positive number indicating success.
"RTN","IBNCPDP",106,0)
 ;  if it is unsuccessful, then "0^reason" will be returned.
"RTN","IBNCPDP",107,0)
 ;
"RTN","IBNCPDP",108,0)
 Q $$UPAWP^IBNCPDP3(IBNDC,IBAWP,$G(IBADT,DT))
"RTN","IBNCPDP",109,0)
 ;
"RTN","IBNCPDP",110,0)
 ;
"RTN","IBNCPDP1")
0^29^B56920205
"RTN","IBNCPDP1",1,0)
IBNCPDP1 ;OAK/ELZ - PROCESSING FOR NEW RX REQUESTS ;20-JUN-2003
"RTN","IBNCPDP1",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,339,363**;21-MAR-94;Build 35
"RTN","IBNCPDP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP1",4,0)
 ;
"RTN","IBNCPDP1",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP1",6,0)
 Q
"RTN","IBNCPDP1",7,0)
 ;
"RTN","IBNCPDP1",8,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP1",9,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP1",10,0)
 ; a response to bill ECME or not with array for billing data elements
"RTN","IBNCPDP1",11,0)
 ;
"RTN","IBNCPDP1",12,0)
 K IBD("SC/EI NO ANSW") ;clean up the list of non-answered SC/Env.indicators questions
"RTN","IBNCPDP1",13,0)
 ;warning: back-billing flag:
"RTN","IBNCPDP1",14,0)
 ;if passed IBSCRES(IBRXN,IBFIL)=1 
"RTN","IBNCPDP1",15,0)
 ; - the the SC Determination is just done by the IB clerk (billable)
"RTN","IBNCPDP1",16,0)
 ;
"RTN","IBNCPDP1",17,0)
 ;retrieve indicators from file #52 and overwrite the indicators in IBD array 
"RTN","IBNCPDP1",18,0)
 D GETINDIC^IBNCPUT2(+IBD("IEN"),.IBD)
"RTN","IBNCPDP1",19,0)
 N IBTRKR,IBARR,IBADT,IBRXN,IBFIL,IBTRKRN,IBRMARK,IBANY,IBX,IBT,IBINS,IBSAVE
"RTN","IBNCPDP1",20,0)
 N IBFEE,IBEABD,IBBI,IBIT,IBPRICE,IBRS,IBRT,IBTRN,IBCHG,IBERMSG,IBRES,IBNEEDS
"RTN","IBNCPDP1",21,0)
 S IBRES="0^Error"
"RTN","IBNCPDP1",22,0)
 K IBD("INS")
"RTN","IBNCPDP1",23,0)
 I '$G(DFN) S IBRES="0^No DFN" G RXQ
"RTN","IBNCPDP1",24,0)
 S (IBEABD,IBADT)=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP1",25,0)
 S IBRXN=+$G(IBD("IEN")) I 'IBRXN S IBRES="0^No Rx IEN" G RXQ
"RTN","IBNCPDP1",26,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G RXQ
"RTN","IBNCPDP1",27,0)
 S IBD("QTY")=+$G(IBD("QTY"))
"RTN","IBNCPDP1",28,0)
 I 'IBD("QTY") S IBRES="0^No Quantity" G RXQ
"RTN","IBNCPDP1",29,0)
 ;
"RTN","IBNCPDP1",30,0)
 ; -- claims tracking info
"RTN","IBNCPDP1",31,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP1",32,0)
 ; date can't be before parameters
"RTN","IBNCPDP1",33,0)
 S $P(IBTRKR,U)=$S('$P(IBTRKR,U,4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP1",34,0)
 ; already in claims tracking
"RTN","IBNCPDP1",35,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP1",36,0)
 I IBTRKRN,$$PAPERBIL(IBTRKRN) S IBRES="0^Existing IB Bill in CT" G RXQ
"RTN","IBNCPDP1",37,0)
 ;
"RTN","IBNCPDP1",38,0)
 I $G(IBD("DEA"))="" D CT S IBRES="0^Null DEA Special Handling field" G RXQ
"RTN","IBNCPDP1",39,0)
 ;
"RTN","IBNCPDP1",40,0)
 ; -- no pharmacy coverage, update ct if applicable, quit
"RTN","IBNCPDP1",41,0)
 I '$$PTCOV^IBCNSU3(DFN,IBADT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED") D:$P(IBTRKR,U,4)=2 CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",42,0)
 ;
"RTN","IBNCPDP1",43,0)
 ;
"RTN","IBNCPDP1",44,0)
 ;  -- check for compound,  NOT BILLABLE 
"RTN","IBNCPDP1",45,0)
 I IBD("DEA")["M"!(IBD("DEA")["0") S IBRMARK="DRUG NOT BILLABLE" D CT S IBRES="0^COMPOUND DRUG" G RXQ
"RTN","IBNCPDP1",46,0)
 ; -- check drug (not investigational, supply, or over the counter drug
"RTN","IBNCPDP1",47,0)
 ;  "E" means always ecme billable
"RTN","IBNCPDP1",48,0)
 I (IBD("DEA")["I"!(IBD("DEA")["S")!(IBD("DEA")["9")),IBD("DEA")'["E" S IBRMARK="DRUG NOT BILLABLE" D CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",49,0)
 ;
"RTN","IBNCPDP1",50,0)
 ; -- process patient exemptions if any (if not already resolved)
"RTN","IBNCPDP1",51,0)
 I $G(IBD("SC/EI OVR"))'=1 D CL^SDCO21(DFN,IBADT,"",.IBARR)
"RTN","IBNCPDP1",52,0)
 ; check out exemptions
"RTN","IBNCPDP1",53,0)
 S IBNEEDS=0 ;flag will be set to 1 if at least one of the questions wasn't answered
"RTN","IBNCPDP1",54,0)
 I $G(IBD("SC/EI OVR"))'=1 I $D(IBARR)>9 F IBX=2:1 S IBT=$P($T(EXEMPT+IBX),";;",2) Q:IBT=""  D:$D(IBARR(+IBT))
"RTN","IBNCPDP1",55,0)
 . I $G(IBD($P(IBT,U,2)))=0 Q
"RTN","IBNCPDP1",56,0)
 . I $G(IBD($P(IBT,U,2))) S IBRMARK=$P(IBT,U,3) Q
"RTN","IBNCPDP1",57,0)
 . I '$G(IBSCRES(IBRXN,IBFIL)) S IBNEEDS=1 D
"RTN","IBNCPDP1",58,0)
 . . S IBD("SC/EI NO ANSW")=$S($G(IBD("SC/EI NO ANSW"))="":$P(IBT,U,2),1:$G(IBD("SC/EI NO ANSW"))_","_$P(IBT,U,2))
"RTN","IBNCPDP1",59,0)
 I '$D(IBRMARK),IBNEEDS=1 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBNCPDP1",60,0)
 I $D(IBRMARK) D CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",61,0)
 ; Clean-up the NEEDS SC DETERMINATION record if resolved
"RTN","IBNCPDP1",62,0)
 ; And check if it is non-billable in CT
"RTN","IBNCPDP1",63,0)
 I IBTRKRN D
"RTN","IBNCPDP1",64,0)
 . N IBNBR,IBNBRT
"RTN","IBNCPDP1",65,0)
 . S IBNBR=$P($G(^IBT(356,+IBTRKRN,0)),U,19) Q:'IBNBR
"RTN","IBNCPDP1",66,0)
 . S IBNBRT=$P($G(^IBE(356.8,IBNBR,0)),U) Q:IBNBRT=""
"RTN","IBNCPDP1",67,0)
 . ; if refill was deleted (not RX) and now the refill is re-entered
"RTN","IBNCPDP1",68,0)
 . ;use $$RXSTATUS^IBNCPRR instead of $G(^PSRX(IBRXN,"STA"))
"RTN","IBNCPDP1",69,0)
 . I IBNBRT="PRESCRIPTION DELETED",$$RXSTATUS^IBNCPRR(DFN,IBRXN)'=13 D  Q
"RTN","IBNCPDP1",70,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",71,0)
 . . ; clean up REASON NOT BILLABLE and ADDITIONAL COMMENT
"RTN","IBNCPDP1",72,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@;1.08////@" D ^DIE
"RTN","IBNCPDP1",73,0)
 . ; Clean up NBR if released
"RTN","IBNCPDP1",74,0)
 . I IBNBRT="PRESCRIPTION NOT RELEASED" D:$G(IBD("RELEASE DATE"))  Q
"RTN","IBNCPDP1",75,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",76,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",77,0)
 . ; Clean up 'Needs SC determ'
"RTN","IBNCPDP1",78,0)
 . I IBNBRT="NEEDS SC DETERMINATION" D  Q
"RTN","IBNCPDP1",79,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",80,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",81,0)
 . S IBRMARK=IBNBRT
"RTN","IBNCPDP1",82,0)
 I $D(IBRMARK) S IBRES="0^Non-Billable in CT: "_IBRMARK G RXQ
"RTN","IBNCPDP1",83,0)
 ;
"RTN","IBNCPDP1",84,0)
 ; -- look up insurance for patient
"RTN","IBNCPDP1",85,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDP1",86,0)
 S IBERMSG="" ; Error message
"RTN","IBNCPDP1",87,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D
"RTN","IBNCPDP1",88,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D
"RTN","IBNCPDP1",89,0)
 .. N IBDAT,IBPL,IBINSN,IBPIEN,IBY,IBZ
"RTN","IBNCPDP1",90,0)
 .. S IBZ=IBINS(IBT,0)
"RTN","IBNCPDP1",91,0)
 .. S IBPL=$P(IBZ,U,18) ; plan
"RTN","IBNCPDP1",92,0)
 .. Q:'IBPL
"RTN","IBNCPDP1",93,0)
 .. Q:'$$PLCOV^IBCNSU3(IBPL,IBADT,3)  ; not covered
"RTN","IBNCPDP1",94,0)
 .. S IBINSN=$P($G(^DIC(36,+$G(^IBA(355.3,+IBPL,0)),0)),U) ; ins name
"RTN","IBNCPDP1",95,0)
 .. S IBPIEN=+$G(^IBA(355.3,+IBPL,6))
"RTN","IBNCPDP1",96,0)
 .. I 'IBPIEN S IBERMSG="Plan not linked to the Payer" Q  ; Not linked
"RTN","IBNCPDP1",97,0)
 .. D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBNCPDP1",98,0)
 .. I $E($G(IBY(1)))'="A" S IBERMSG=$$ERMSG($P($G(IBY(6)),",")) Q  ; not active
"RTN","IBNCPDP1",99,0)
 .. S IBDAT=IBPL ; Plan IEN
"RTN","IBNCPDP1",100,0)
 .. S $P(IBDAT,U,2)=$G(IBY(2)) ; BIN
"RTN","IBNCPDP1",101,0)
 .. S $P(IBDAT,U,3)=$G(IBY(3)) ; PCN
"RTN","IBNCPDP1",102,0)
 .. S $P(IBDAT,U,4)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",1),0)),U) ; Payer Sheet B1
"RTN","IBNCPDP1",103,0)
 .. S $P(IBDAT,U,5)=$P($G(IBINS(IBT,355.3)),U,4) ; Group ID
"RTN","IBNCPDP1",104,0)
 .. S $P(IBDAT,U,6)=$P(IBZ,U,2) ; Cardholder ID
"RTN","IBNCPDP1",105,0)
 .. S $P(IBDAT,U,7)=$P(IBZ,U,16) ; Patient Relationship Code
"RTN","IBNCPDP1",106,0)
 .. S $P(IBDAT,U,8)=$P($P($P(IBZ,U,17),",",2)," ") ; Cardholder First Name
"RTN","IBNCPDP1",107,0)
 .. S $P(IBDAT,U,9)=$P($P(IBZ,U,17),",") ; Cardholder Last Name
"RTN","IBNCPDP1",108,0)
 .. S $P(IBDAT,U,10)=$P($G(^DIC(36,+IBZ,.11)),U,5) ; State
"RTN","IBNCPDP1",109,0)
 .. S $P(IBDAT,U,11)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",2),0)),U) ; Payer Sheet B2
"RTN","IBNCPDP1",110,0)
 .. S $P(IBDAT,U,12)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",3),0)),U) ; Payer Sheet B3
"RTN","IBNCPDP1",111,0)
 .. S $P(IBDAT,U,13)=$G(IBY(4)) ; Software/Vendor Cert ID
"RTN","IBNCPDP1",112,0)
 .. S $P(IBDAT,U,14)=IBINSN ; Ins Name
"RTN","IBNCPDP1",113,0)
 .. S IBD("INS",IBX,1)=IBDAT
"RTN","IBNCPDP1",114,0)
 .. S IBD("INS",IBX,3)=$P($G(IBINS(IBT,355.3)),"^",3)_"^"_$$PHONE(+IBZ)_"^"_$$GET1^DIQ(366.03,IBPIEN_",",.01)   ;group name^ins co ph 3^plan ID
"RTN","IBNCPDP1",115,0)
 I '$D(IBD("INS")),IBERMSG'="" S IBRES="0^Not ECME billable: "_IBERMSG G RXQ
"RTN","IBNCPDP1",116,0)
 I '$D(IBD("INS")) S IBRES="0^No Insurance ECME billable" G RXQ
"RTN","IBNCPDP1",117,0)
 ;
"RTN","IBNCPDP1",118,0)
 ; determine rates/prices to use
"RTN","IBNCPDP1",119,0)
 S IBRT=$$RT^IBNCPDPU(DFN,.IBINS)
"RTN","IBNCPDP1",120,0)
 I 'IBRT D CT S IBRES="0^Cannot determine Rate type" G RXQ
"RTN","IBNCPDP1",121,0)
 S IBBI=$$EVNTITM^IBCRU3(+IBRT,3,"PRESCRIPTION FILL",IBADT,.IBRS)
"RTN","IBNCPDP1",122,0)
 I 'IBBI D CT S IBRES="0^Cannot find Billable Item" G RXQ
"RTN","IBNCPDP1",123,0)
 ;1;BEDSECTION;1^
"RTN","IBNCPDP1",124,0)
 ;IBRS(1,18,5)=
"RTN","IBNCPDP1",125,0)
 S IBRS=+$O(IBRS(+IBBI,0))
"RTN","IBNCPDP1",126,0)
 S IBIT=$$ITPTR^IBCRU2(+IBBI,$S($P(IBRT,U,2)="A":$$NDC^IBNCPDPU($G(IBD("NDC"))),1:"PRESCRIPTION"))
"RTN","IBNCPDP1",127,0)
 I 'IBIT,$P(IBRT,U,2)'="C" D CT S IBRES="0^Cannot find Item Pointer" G RXQ
"RTN","IBNCPDP1",128,0)
 ;8
"RTN","IBNCPDP1",129,0)
 S IBPRICE=+$$BICOST^IBCRCI(+IBRT,3,IBADT,"PRESCRIPTION FILL",+IBIT,,,$S($P(IBRT,U,2)="A":IBD("QTY"),1:1))
"RTN","IBNCPDP1",130,0)
 ;36^2991001
"RTN","IBNCPDP1",131,0)
 ;
"RTN","IBNCPDP1",132,0)
 ; get fees if any, ignore return, don't care about price, just need fees
"RTN","IBNCPDP1",133,0)
 S IBCHG=$$RATECHG^IBCRCC(+IBRS,$S($P(IBRT,U,2)'="C":1,1:IBD("QTY")*IBD("COST")),IBADT,.IBFEE)
"RTN","IBNCPDP1",134,0)
 I $P(IBRT,U,2)="C" S IBPRICE=+IBCHG
"RTN","IBNCPDP1",135,0)
 ;
"RTN","IBNCPDP1",136,0)
 I 'IBPRICE D CT S IBRES="0^Cannot find price for Item" G RXQ
"RTN","IBNCPDP1",137,0)
 ;
"RTN","IBNCPDP1",138,0)
 S IBPRICE=(+$G(IBFEE))_U_$S($P(IBRT,U,2)="A":"01",$P(IBRT,U,2)="C":"05",1:"07")_U_$S($P(IBRT,U,2)="C":IBD("QTY")*IBD("COST"),$P(IBRT,U,2)="A":IBPRICE-$G(IBFEE)-$P($G(IBFEE),U,2),1:IBPRICE)_U_IBPRICE_U_(+$P($G(IBFEE),U,2))
"RTN","IBNCPDP1",139,0)
 S IBX=0 F  S IBX=$O(IBD("INS",IBX)) Q:IBX<1  S IBD("INS",IBX,2)=IBPRICE ;_U_$P(IBPAYER,U,6)
"RTN","IBNCPDP1",140,0)
 ;
"RTN","IBNCPDP1",141,0)
 S IBRES=$S($D(IBRMARK):"0^"_IBRMARK,1:1)
"RTN","IBNCPDP1",142,0)
 I IBRES,'$G(IBD("RELEASE DATE")) S IBRMARK="PRESCRIPTION NOT RELEASED"
"RTN","IBNCPDP1",143,0)
 D CT
"RTN","IBNCPDP1",144,0)
 ;
"RTN","IBNCPDP1",145,0)
RXQ D LOG^IBNCPDP2("BILLABLE STATUS CHECK",IBRES)
"RTN","IBNCPDP1",146,0)
 Q IBRES
"RTN","IBNCPDP1",147,0)
 ;
"RTN","IBNCPDP1",148,0)
 ;
"RTN","IBNCPDP1",149,0)
CT ; files in claims tracking
"RTN","IBNCPDP1",150,0)
 I IBTRKR D CT^IBNCPDPU(DFN,IBRXN,IBFIL,IBADT,$G(IBRMARK))
"RTN","IBNCPDP1",151,0)
 Q
"RTN","IBNCPDP1",152,0)
 ;
"RTN","IBNCPDP1",153,0)
EXEMPT ; exemption reasons
"RTN","IBNCPDP1",154,0)
 ; variable from SD call ^ variable from PSO ^ reason not billable
"RTN","IBNCPDP1",155,0)
 ;;1^AO^AGENT ORANGE
"RTN","IBNCPDP1",156,0)
 ;;2^IR^IONIZING RADIATION
"RTN","IBNCPDP1",157,0)
 ;;3^SC^SC TREATMENT
"RTN","IBNCPDP1",158,0)
 ;;4^SWA^SOUTHWEST ASIA
"RTN","IBNCPDP1",159,0)
 ;;5^MST^MILITARY SEXUAL TRAUMA
"RTN","IBNCPDP1",160,0)
 ;;6^HNC^HEAD/NECK CANCER
"RTN","IBNCPDP1",161,0)
 ;;7^CV^COMBAT VETERAN
"RTN","IBNCPDP1",162,0)
 ;;8^SHAD^PROJECT 112/SHAD
"RTN","IBNCPDP1",163,0)
 ;;
"RTN","IBNCPDP1",164,0)
 ;
"RTN","IBNCPDP1",165,0)
ERMSG(IBSTL) ; Inactive status reason
"RTN","IBNCPDP1",166,0)
 N IBSTA,IBI,IBARR,IBTXT
"RTN","IBNCPDP1",167,0)
 D STATAR^IBCNRU1(.IBARR)
"RTN","IBNCPDP1",168,0)
 F IBI=1:1:$L(IBSTL,",")+1 S IBSTA=+$P(IBSTL,",",IBI) Q:"^100^200^300^400^"'[(U_IBSTA_U)
"RTN","IBNCPDP1",169,0)
 S IBTXT=$G(IBARR(+IBSTA),"Plan is not active.")
"RTN","IBNCPDP1",170,0)
 Q IBTXT
"RTN","IBNCPDP1",171,0)
 ;
"RTN","IBNCPDP1",172,0)
NEEDSC(IBTXT) ; is the CT NBR one of 'needs sc determination'?
"RTN","IBNCPDP1",173,0)
 I IBTXT="NEEDS SC DETERMINATION" Q 1
"RTN","IBNCPDP1",174,0)
 N I,RES,IBT
"RTN","IBNCPDP1",175,0)
 S RES=0
"RTN","IBNCPDP1",176,0)
 F I=2:1 S IBT=$P($P($T(EXEMPT+I),";;",2),U,3) Q:IBT=""  I IBT=IBTXT S RES=1 Q
"RTN","IBNCPDP1",177,0)
 Q RES
"RTN","IBNCPDP1",178,0)
 ;
"RTN","IBNCPDP1",179,0)
PAPERBIL(IBTRKRN) ; 'paper' bill in CT?
"RTN","IBNCPDP1",180,0)
 N IBZ,IBIFN
"RTN","IBNCPDP1",181,0)
 S IBZ=$G(^IBT(356,IBTRKRN,0)) I IBZ="" Q 0
"RTN","IBNCPDP1",182,0)
 S IBIFN=+$P(IBZ,U,11) I 'IBIFN Q 0
"RTN","IBNCPDP1",183,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=7 Q 0  ; cancelled
"RTN","IBNCPDP1",184,0)
 I $P($G(^DGCR(399,IBIFN,"M1")),U,8)'="" Q 0  ; ecme bill
"RTN","IBNCPDP1",185,0)
 Q 1
"RTN","IBNCPDP1",186,0)
 ;
"RTN","IBNCPDP1",187,0)
 ;gets the insurance phone
"RTN","IBNCPDP1",188,0)
 ;input:
"RTN","IBNCPDP1",189,0)
 ; IB36 - ptr to INSURANCE COMPANY File (#36)
"RTN","IBNCPDP1",190,0)
 ;output:
"RTN","IBNCPDP1",191,0)
 ; the phone number
"RTN","IBNCPDP1",192,0)
PHONE(IB36) ;
"RTN","IBNCPDP1",193,0)
 N IB1
"RTN","IBNCPDP1",194,0)
 ;check first CLAIMS (RX) PHONE NUMBER if empty
"RTN","IBNCPDP1",195,0)
 S IB1=$$GET1^DIQ(36,+IB36,.1311,"E")
"RTN","IBNCPDP1",196,0)
 Q:$L(IB1)>0 IB1
"RTN","IBNCPDP1",197,0)
 ;check BILLING PHONE NUMBER if empty - return nothing
"RTN","IBNCPDP1",198,0)
 S IB1=$$GET1^DIQ(36,+IB36,.132,"E")
"RTN","IBNCPDP1",199,0)
 Q IB1
"RTN","IBNCPDP1",200,0)
 ;
"RTN","IBNCPDP1",201,0)
 ;IBNCPDP1
"RTN","IBNCPDP2")
0^16^B35333171
"RTN","IBNCPDP2",1,0)
IBNCPDP2 ;OAK/ELZ - PROCESSING FOR ECME RESP ;20-JUN-2003
"RTN","IBNCPDP2",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,342,347,363**;21-MAR-94;Build 35
"RTN","IBNCPDP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP2",4,0)
 ;
"RTN","IBNCPDP2",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP2",6,0)
 Q
"RTN","IBNCPDP2",7,0)
 ;
"RTN","IBNCPDP2",8,0)
ECME(DFN,IBD) ; function called by STORESP^IBNCPDP
"RTN","IBNCPDP2",9,0)
 ; input - DFN - patient IEN for the prescription
"RTN","IBNCPDP2",10,0)
 ;         IBD array passed in by reference
"RTN","IBNCPDP2",11,0)
 ;      The IBD array is passed to various subroutines depending
"RTN","IBNCPDP2",12,0)
 ;      on the ePharmacy event as evaluated by IBD("STATUS")
"RTN","IBNCPDP2",13,0)
 I $G(IBD("EPHARM"))="" S IBD("EPHARM")=$$EPHARM(+$G(IBD("PRESCRIPTION")),+$G(IBD("FILL NUMBER")))
"RTN","IBNCPDP2",14,0)
 I IBD("STATUS")="PAID" Q $$BILL(DFN,.IBD)
"RTN","IBNCPDP2",15,0)
 I IBD("STATUS")="REVERSED" Q $$REVERSE^IBNCPDP3(DFN,.IBD)
"RTN","IBNCPDP2",16,0)
 I IBD("STATUS")="CLOSED" Q $$CLOSE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",17,0)
 I IBD("STATUS")="RELEASED" Q $$RELEASE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",18,0)
 I IBD("STATUS")="SUBMITTED" Q $$SUBMIT^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",19,0)
 I IBD("STATUS")="REOPEN" Q $$REOPEN^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",20,0)
 D LOG("UNKNOWN")
"RTN","IBNCPDP2",21,0)
 Q "0^Cannot determine ECME event status"
"RTN","IBNCPDP2",22,0)
 ;
"RTN","IBNCPDP2",23,0)
MATCH(BCID) ;
"RTN","IBNCPDP2",24,0)
 N IBX,IBHAVE
"RTN","IBNCPDP2",25,0)
 S IBX=0,IBHAVE=0 F  S IBX=$O(^DGCR(399,"AG",BCID,IBX)) Q:'IBX  S IBHAVE=1 I '$P($G(^DGCR(399,IBX,"S")),U,16) Q
"RTN","IBNCPDP2",26,0)
 I 'IBX,IBHAVE Q ""
"RTN","IBNCPDP2",27,0)
 Q +IBX
"RTN","IBNCPDP2",28,0)
 ;
"RTN","IBNCPDP2",29,0)
 ;
"RTN","IBNCPDP2",30,0)
BILL(DFN,IBD) ; create fi bill
"RTN","IBNCPDP2",31,0)
 N IBRVCD,IBBS,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM,IBAMT,IBY,IBSERV,IBFAC,IBSITE,IBDRX,IB,IBCDFN,IBINS,IBIDS,IBIFN,IBDFN,PRCASV,PRCAERR,IBADT,IBRXN,IBFIL,IBTRKRN,DIE,DA,DR,IBRES,IBLOCK,IBLDT,IBNOW,IBDUZ,RCDUZ,IBPREV,IBQUERY,IBPAID,IBACT
"RTN","IBNCPDP2",32,0)
 ;
"RTN","IBNCPDP2",33,0)
 S IBDUZ=.5 ;POSTMASTER
"RTN","IBNCPDP2",34,0)
 ;I $G(IBD("FILLED BY")),$D(^VA(200,+IBD("FILLED BY"))) S IBDUZ=+IBD("FILLED BY")
"RTN","IBNCPDP2",35,0)
 S RCDUZ=IBDUZ
"RTN","IBNCPDP2",36,0)
 ;
"RTN","IBNCPDP2",37,0)
 S IBY=1,IBLOCK=0
"RTN","IBNCPDP2",38,0)
 I 'DFN S IBY="0^Missing DFN" G BILLQ
"RTN","IBNCPDP2",39,0)
 S IBAMT=+$G(IBD("BILLED")) ;FI portion of charge
"RTN","IBNCPDP2",40,0)
 I 'IBAMT S IBY="-1^Zero amount billed" G BILLQ
"RTN","IBNCPDP2",41,0)
 S IBADT=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP2",42,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^Missing Rx IEN" G BILLQ
"RTN","IBNCPDP2",43,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G BILLQ
"RTN","IBNCPDP2",44,0)
 S IBDIV=+$G(IBD("DIVISION"))
"RTN","IBNCPDP2",45,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="-1^Missing ECME Number" G BILLQ
"RTN","IBNCPDP2",46,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; The BCID#
"RTN","IBNCPDP2",47,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number." G BILLQ
"RTN","IBNCPDP2",48,0)
 S IBLOCK=1
"RTN","IBNCPDP2",49,0)
 S IBLDT=$G(^DGCR(399,"AG",IBD("BCID"))) ;Last time called
"RTN","IBNCPDP2",50,0)
 D NOW^%DTC S IBNOW=%
"RTN","IBNCPDP2",51,0)
 ; 2 calls in 45 sec
"RTN","IBNCPDP2",52,0)
 I $P(IBLDT,"^",2)="B" I $$FMDIFF^XLFDT(IBNOW,+IBLDT,2)<45 S IBY="0^Duplicate billing call" G BILLQ
"RTN","IBNCPDP2",53,0)
 ;
"RTN","IBNCPDP2",54,0)
 I $$MATCH(IBD("BCID")) D   ;cancel the previous bill
"RTN","IBNCPDP2",55,0)
 . N IBARR M IBARR=IBD I $$REVERSE^IBNCPDP3(DFN,.IBARR,2)
"RTN","IBNCPDP2",56,0)
 ;
"RTN","IBNCPDP2",57,0)
 ; derive minimal variables
"RTN","IBNCPDP2",58,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB SITE" G BILLQ
"RTN","IBNCPDP2",59,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBNCPDP2",60,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB SERVICE" G BILLQ
"RTN","IBNCPDP2",61,0)
 I 'IBDIV S IBDIV=$P($$MCDIV^IBNCPEB(IBRXN,IBFIL),U,2)
"RTN","IBNCPDP2",62,0)
 I 'IBDIV S IBDIV=+$P($G(^SC(+$$FILE^IBRXUTL(IBRXN,5),0)),"^",15)
"RTN","IBNCPDP2",63,0)
 I 'IBDIV S IBDIV=+$P($G(^IBE(350.9,1,1)),U,25) ;dflt
"RTN","IBNCPDP2",64,0)
 I IBDIV S IBD("DIVISION")=IBDIV
"RTN","IBNCPDP2",65,0)
 ; - establish a stub claim/receivable
"RTN","IBNCPDP2",66,0)
 D SET^IBR I IBY<0 G BILLQ
"RTN","IBNCPDP2",67,0)
 ;
"RTN","IBNCPDP2",68,0)
 ; set up the following variables for claim establishment:
"RTN","IBNCPDP2",69,0)
 ; .01 BILL #
"RTN","IBNCPDP2",70,0)
 ; .17 ORIG CLAIM
"RTN","IBNCPDP2",71,0)
 ; .2  AUTO?
"RTN","IBNCPDP2",72,0)
 ; .02 DFN
"RTN","IBNCPDP2",73,0)
 ; .06 TIMEFRAME
"RTN","IBNCPDP2",74,0)
 ; .07 RATE TYPE
"RTN","IBNCPDP2",75,0)
 ; .18 SC AT TIME?
"RTN","IBNCPDP2",76,0)
 ; .04 LOCATION
"RTN","IBNCPDP2",77,0)
 ; .22 DIVISION
"RTN","IBNCPDP2",78,0)
 ; .05 BILL CLASSIF  (3)
"RTN","IBNCPDP2",79,0)
 ; .03 EVT DATE (FILL DATE)
"RTN","IBNCPDP2",80,0)
 ; 151 BILL FROM
"RTN","IBNCPDP2",81,0)
 ; 152 BILL TO
"RTN","IBNCPDP2",82,0)
 ; 101 PRIMARY INS CARRIER
"RTN","IBNCPDP2",83,0)
 K IB
"RTN","IBNCPDP2",84,0)
 S (IB(.02),IBDFN)=DFN
"RTN","IBNCPDP2",85,0)
 S IB(.07)=+$$RT^IBNCPDPU(DFN)
"RTN","IBNCPDP2",86,0)
 I 'IB(.07) S IBY="-1^IB RATE TYPE" G BILLQ
"RTN","IBNCPDP2",87,0)
 ;
"RTN","IBNCPDP2",88,0)
 S IBIFN=PRCASV("ARREC")
"RTN","IBNCPDP2",89,0)
 S IB(.01)=$P(PRCASV("ARBIL"),"-",2)
"RTN","IBNCPDP2",90,0)
 S IB(.17)=""
"RTN","IBNCPDP2",91,0)
 S IB(.2)=0
"RTN","IBNCPDP2",92,0)
 S IB(.06)=1
"RTN","IBNCPDP2",93,0)
 S IB(.18)=$$SC^IBCU3(DFN)
"RTN","IBNCPDP2",94,0)
 S IB(.04)=$S(+$P($G(^DG(40.8,+IBDIV,0)),U,3):7,1:1)
"RTN","IBNCPDP2",95,0)
 S:IBDIV IB(.22)=+IBDIV
"RTN","IBNCPDP2",96,0)
 S IB(.05)=3
"RTN","IBNCPDP2",97,0)
 S (IB(.03),IB(151),IB(152))=IBADT
"RTN","IBNCPDP2",98,0)
 S IBINS=$P($G(^IBA(355.3,+$G(IBD("PLAN")),0)),"^") I IBINS S IB(101)=IBINS
"RTN","IBNCPDP2",99,0)
 ;
"RTN","IBNCPDP2",100,0)
 ; set 362.4 node to rx#^p50^days sup^fill date^qty^ndc
"RTN","IBNCPDP2",101,0)
 S IB(362.4,IBRXN,1)=IBD("RX NO")_"^"_IBD("DRUG")_"^"_IBD("DAYS SUPPLY")_"^"_IBD("FILL DATE")_"^"_IBD("QTY")_"^"_IBD("NDC")
"RTN","IBNCPDP2",102,0)
 ;
"RTN","IBNCPDP2",103,0)
 ; call the autobiller module to create the claim with a default
"RTN","IBNCPDP2",104,0)
 ; diagnosis and procedure for prescriptions
"RTN","IBNCPDP2",105,0)
 D EN^IBCD3(.IBQUERY)
"RTN","IBNCPDP2",106,0)
 D CLOSE^IBSDU(.IBQUERY)
"RTN","IBNCPDP2",107,0)
 ;
"RTN","IBNCPDP2",108,0)
 S ^DGCR(399,"AG",IBD("BCID"))=IBNOW_"^B"
"RTN","IBNCPDP2",109,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",110,0)
 ; update the ECME fields
"RTN","IBNCPDP2",111,0)
 S DR="460////^S X=IBD(""BCID"")" S:$L($G(IBD("AUTH #"))) DR=DR_";461////^S X=IBD(""AUTH #"")"
"RTN","IBNCPDP2",112,0)
 D ^DIE K DA,DR,DIE
"RTN","IBNCPDP2",113,0)
 D SETCT ; Set Claims Tracking record
"RTN","IBNCPDP2",114,0)
 ;
"RTN","IBNCPDP2",115,0)
 ; IEN to 2.3121
"RTN","IBNCPDP2",116,0)
 S IBCDFN=$$PLANN^IBNCPDPU(DFN,IBD("PLAN"),IBADT)
"RTN","IBNCPDP2",117,0)
 I 'IBCDFN S IBY="-1^Plan not found in Patient's Profile." G BILLQ
"RTN","IBNCPDP2",118,0)
 ;
"RTN","IBNCPDP2",119,0)
 ; add the payer (fiscal intermediary) to the claim
"RTN","IBNCPDP2",120,0)
 S IBINS=+IBCDFN,IBCDFN=$P(IBCDFN,"^",2)
"RTN","IBNCPDP2",121,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="112////"_IBCDFN
"RTN","IBNCPDP2",122,0)
 D ^DIE K DA,DR,DIE,DGRVRCAL
"RTN","IBNCPDP2",123,0)
 ;
"RTN","IBNCPDP2",124,0)
 ; need to make sure we have computed charges.
"RTN","IBNCPDP2",125,0)
 D BILL^IBCRBC(IBIFN)
"RTN","IBNCPDP2",126,0)
 ;
"RTN","IBNCPDP2",127,0)
 ; update the authorize/print fields
"RTN","IBNCPDP2",128,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",129,0)
 S DR="9////1;12////"_DT D ^DIE
"RTN","IBNCPDP2",130,0)
 K DA,DR,DIE
"RTN","IBNCPDP2",131,0)
 ;
"RTN","IBNCPDP2",132,0)
 ; pass the claim to AR
"RTN","IBNCPDP2",133,0)
 D GVAR^IBCBB,ARRAY^IBCBB1 S PRCASV("APR")=IBDUZ D ^PRCASVC6
"RTN","IBNCPDP2",134,0)
 I 'PRCASV("OKAY") S IBY="-1^Cannot establish receivable in AR." G BILLQ
"RTN","IBNCPDP2",135,0)
 D REL^PRCASVC
"RTN","IBNCPDP2",136,0)
 ;
"RTN","IBNCPDP2",137,0)
 ; update the AR status to Active
"RTN","IBNCPDP2",138,0)
 ;  D AUDITX^PRCAUDT(PRCASV("ARREC"))
"RTN","IBNCPDP2",139,0)
 S PRCASV("STATUS")=16
"RTN","IBNCPDP2",140,0)
 D STATUS^PRCASVC1
"RTN","IBNCPDP2",141,0)
 ;
"RTN","IBNCPDP2",142,0)
 ; decrease adjust bill
"RTN","IBNCPDP2",143,0)
 ; Auto decrease from service Bill#,Tran amt,person,reason,Tran date
"RTN","IBNCPDP2",144,0)
 S IBAMT=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP2",145,0)
 S IBPAID=IBD("PAID")
"RTN","IBNCPDP2",146,0)
 D:IBAMT-IBPAID>.01
"RTN","IBNCPDP2",147,0)
 . D DEC^PRCASER1(PRCASV("ARREC"),IBAMT-IBPAID,IBDUZ,"Adjust based on ECME amount paid.",IBADT)
"RTN","IBNCPDP2",148,0)
 . I 'IBPAID S PRCASV("STATUS")=22 D STATUS^PRCASVC1 ; collected/closed
"RTN","IBNCPDP2",149,0)
 ;
"RTN","IBNCPDP2",150,0)
 D  ; set the user in 399
"RTN","IBNCPDP2",151,0)
 . N IBI,IBT F IBI=2,5,11,13,15 S IBT(399,IBIFN_",",IBI)=IBDUZ
"RTN","IBNCPDP2",152,0)
 . D FILE^DIE("","IBT")
"RTN","IBNCPDP2",153,0)
 ;
"RTN","IBNCPDP2",154,0)
BILLQ S IBRES=$S(IBY<0:"0^"_$S($L($P(IBY,"^",2)):$P(IBY,"^",2),1:$P(IBY,"^",3)),$G(IBIFN):+IBIFN,1:IBY)
"RTN","IBNCPDP2",155,0)
 I $G(IBIFN) S IBD("BILL")=IBIFN
"RTN","IBNCPDP2",156,0)
 D LOG("BILL",IBRES)
"RTN","IBNCPDP2",157,0)
 I IBY<0 D BULL^IBNCPEB($G(DFN),.IBD,IBRES,$G(IBIFN))
"RTN","IBNCPDP2",158,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP2",159,0)
 Q IBRES
"RTN","IBNCPDP2",160,0)
 ;
"RTN","IBNCPDP2",161,0)
 ; update claims tracking saying bill has been billed
"RTN","IBNCPDP2",162,0)
SETCT ;
"RTN","IBNCPDP2",163,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP2",164,0)
 I IBTRKRN S DIE="^IBT(356,",DA=IBTRKRN,DR=".11////^S X=IBIFN;.17///@" D ^DIE
"RTN","IBNCPDP2",165,0)
 I IBTRKRN,IBIFN D CTB^IBCDC(IBTRKRN,IBIFN)
"RTN","IBNCPDP2",166,0)
 Q
"RTN","IBNCPDP2",167,0)
 ;
"RTN","IBNCPDP2",168,0)
 ;/**
"RTN","IBNCPDP2",169,0)
 ;Log values passed into IB by outside applications
"RTN","IBNCPDP2",170,0)
 ;
"RTN","IBNCPDP2",171,0)
 ;implicit input variables/arrays :
"RTN","IBNCPDP2",172,0)
 ; IBD array with values sent to IB (see calling subroutines)
"RTN","IBNCPDP2",173,0)
 ; DFN - patient's IEN (file #2)
"RTN","IBNCPDP2",174,0)
 ; DUZ - user's IEN(file #200)
"RTN","IBNCPDP2",175,0)
 ;explicit parameters:
"RTN","IBNCPDP2",176,0)
 ; PROC - type of event as string, i.e. BILL, REJECT and so on
"RTN","IBNCPDP2",177,0)
 ; RESULT - result of the event processing, format: return_code^message
"RTN","IBNCPDP2",178,0)
LOG(PROC,RESULT) ;Store the data
"RTN","IBNCPDP2",179,0)
 D LOG^IBNCPLOG(.IBD,DFN,PROC,RESULT,$J,$$NOW^XLFDT(),+DUZ)
"RTN","IBNCPDP2",180,0)
 Q
"RTN","IBNCPDP2",181,0)
 ;
"RTN","IBNCPDP2",182,0)
 ;returns ien of #9002313.56 BPS PHARMACIES associated
"RTN","IBNCPDP2",183,0)
 ;with the prescription specified by:
"RTN","IBNCPDP2",184,0)
 ; IBRX - IEN in file #52
"RTN","IBNCPDP2",185,0)
 ; IBREFILL - zero(0) for the original prescription or the refill 
"RTN","IBNCPDP2",186,0)
 ;    number for a refill (IEN of REFILL multiple #52.1)
"RTN","IBNCPDP2",187,0)
EPHARM(IBRX,IBREFILL) ;
"RTN","IBNCPDP2",188,0)
 I +$G(IBRX)=0 Q ""
"RTN","IBNCPDP2",189,0)
 I $G(IBREFILL)="" Q ""
"RTN","IBNCPDP2",190,0)
 N IBDIV59
"RTN","IBNCPDP2",191,0)
 S IBDIV59=+$$RXSITE^PSOBPSUT(+IBRX,+IBREFILL)
"RTN","IBNCPDP2",192,0)
 I IBDIV59>0 Q $$GETPHARM^BPSUTIL(IBDIV59)
"RTN","IBNCPDP2",193,0)
 Q ""
"RTN","IBNCPDP2",194,0)
 ;
"RTN","IBNCPDP2",195,0)
 ;IBNCPDP2
"RTN","IBNCPDP3")
0^22^B29885103
"RTN","IBNCPDP3",1,0)
IBNCPDP3 ;OAK/ELZ - STORES NDC/AWP UPDATES ;20-JUN-2003
"RTN","IBNCPDP3",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,342,363**;21-MAR-94;Build 35
"RTN","IBNCPDP3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP3",4,0)
 ;
"RTN","IBNCPDP3",5,0)
 ;
"RTN","IBNCPDP3",6,0)
UPAWP(IBNDC,IBAWP,IBADT) ; updates AWP prices for NDCs
"RTN","IBNCPDP3",7,0)
 ;
"RTN","IBNCPDP3",8,0)
 N IBITEM,IBCS
"RTN","IBNCPDP3",9,0)
 ;
"RTN","IBNCPDP3",10,0)
 ;
"RTN","IBNCPDP3",11,0)
 S IBCS=$P($G(^IBE(350.9,1,9)),"^",12)
"RTN","IBNCPDP3",12,0)
 I 'IBCS Q "0^Unable to find Charge Set"
"RTN","IBNCPDP3",13,0)
 ;
"RTN","IBNCPDP3",14,0)
 S IBNDC=$$NDC^IBNCPDPU(IBNDC)
"RTN","IBNCPDP3",15,0)
 ;
"RTN","IBNCPDP3",16,0)
 S IBITEM=+$$ADDBI^IBCREF("NDC",IBNDC) I IBITEM Q "0^Unable to add item"
"RTN","IBNCPDP3",17,0)
 ;
"RTN","IBNCPDP3",18,0)
 I '$$ADDCI^IBCREF(IBCS,IBITEM,IBADT,IBAWP) Q "0^Unable to add charge"
"RTN","IBNCPDP3",19,0)
 ;
"RTN","IBNCPDP3",20,0)
 Q 1
"RTN","IBNCPDP3",21,0)
 ;
"RTN","IBNCPDP3",22,0)
 ;
"RTN","IBNCPDP3",23,0)
 ;
"RTN","IBNCPDP3",24,0)
 ;
"RTN","IBNCPDP3",25,0)
REVERSE(DFN,IBD,IBAUTO) ;process reversed claims
"RTN","IBNCPDP3",26,0)
 N IBIFN,I,IB,IBIL,IBCHG,IBCRES,IBY,X,Y,DA,DIE,DR,IBADT,IBLOCK,IBLDT
"RTN","IBNCPDP3",27,0)
 N IBNOW,IBDUZ,IBCR,IBRELC,IBCC,IBPAP,IBRXN,IBFIL,IBRTS,IBARES,IBUSR
"RTN","IBNCPDP3",28,0)
 S IBDUZ=.5
"RTN","IBNCPDP3",29,0)
 ;
"RTN","IBNCPDP3",30,0)
 S IBLOCK=0
"RTN","IBNCPDP3",31,0)
 ; find bill number
"RTN","IBNCPDP3",32,0)
 I 'DFN S IBY="0^No patient" G REVQ
"RTN","IBNCPDP3",33,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="0^Missing ECME Number" G REVQ
"RTN","IBNCPDP3",34,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBY="0^Missing Fill Date" G REVQ
"RTN","IBNCPDP3",35,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^No Rx IEN" G REVQ
"RTN","IBNCPDP3",36,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G REVQ
"RTN","IBNCPDP3",37,0)
 I $E($G(IBD("RESPONSE")),1)="R" D  G REVQ:+'$G(IBRTS)
"RTN","IBNCPDP3",38,0)
 . S IBY="0^REVERSAL rejected by payer"
"RTN","IBNCPDP3",39,0)
 . S IBRTS=$$RTS(IBD("REVERSAL REASON"))
"RTN","IBNCPDP3",40,0)
 ;
"RTN","IBNCPDP3",41,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; BC ID Number
"RTN","IBNCPDP3",42,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number" G REVQ
"RTN","IBNCPDP3",43,0)
 S IBLOCK=1
"RTN","IBNCPDP3",44,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP3",45,0)
 I $D(^DGCR(399,"AG",IBD("BCID"))) S ^(IBD("BCID"))=""
"RTN","IBNCPDP3",46,0)
 S IBIFN=$$MATCH^IBNCPDP2(IBD("BCID"))
"RTN","IBNCPDP3",47,0)
 I $D(IBD("CLOSE REASON")),'$D(IBD("DROP TO PAPER")) S IBD("DROP TO PAPER")=""
"RTN","IBNCPDP3",48,0)
 S IBCR=+$G(IBD("CLOSE REASON"))
"RTN","IBNCPDP3",49,0)
 S IBPAP=$G(IBD("DROP TO PAPER"))
"RTN","IBNCPDP3",50,0)
 S IBRELC=$G(IBD("RELEASE COPAY"))
"RTN","IBNCPDP3",51,0)
 S IBCC=$G(IBD("CLOSE COMMENT"))
"RTN","IBNCPDP3",52,0)
 D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,IBPAP,IBRELC,IBCC,IBUSR)
"RTN","IBNCPDP3",53,0)
 I 'IBIFN S IBY="0^"_$S(IBPAP:"Dropped to paper",IBCR>1:"Set non-billable reason in CT",1:"Cannot find the bill to reverse") G REVQ
"RTN","IBNCPDP3",54,0)
 ;
"RTN","IBNCPDP3",55,0)
 F I=0,"S" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBNCPDP3",56,0)
 I IB(0)="" S IBY="0^No data in bill" G REVQ
"RTN","IBNCPDP3",57,0)
 I +$P(IB("S"),U,16),$P(IB("S"),U,17)]"" S IBY="0^Bill already cancelled" G REVQ
"RTN","IBNCPDP3",58,0)
 ;
"RTN","IBNCPDP3",59,0)
 S:'$D(IBCRES) IBCRES="ECME PRESCRIPTION REVERSED"
"RTN","IBNCPDP3",60,0)
 S DA=IBIFN,DR="16////1;19////"_IBCRES,DIE="^DGCR(399,"
"RTN","IBNCPDP3",61,0)
 D ^DIE K DA,DIE,DR
"RTN","IBNCPDP3",62,0)
 ;
"RTN","IBNCPDP3",63,0)
 ; - decrease out the receivable in AR
"RTN","IBNCPDP3",64,0)
 S IB("U1")=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP3",65,0)
 S IBIL=$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBNCPDP3",66,0)
 S IBCHG=$S(IB("U1")']"":0,$P(IB("U1"),"^",1)]"":$P(IB("U1"),"^",1),1:0)
"RTN","IBNCPDP3",67,0)
 ;
"RTN","IBNCPDP3",68,0)
 S X="21^"_IBCHG_"^"_IBIL_"^"_IBDUZ_"^"_DT_"^"_IBCRES
"RTN","IBNCPDP3",69,0)
 D ^PRCASER1
"RTN","IBNCPDP3",70,0)
 S IBARES=Y
"RTN","IBNCPDP3",71,0)
 I IBARES<0 S IBY=IBARES D BULL
"RTN","IBNCPDP3",72,0)
 ;
"RTN","IBNCPDP3",73,0)
 S IBY=$S(IBARES<0:"0^"_$P(IBARES,"^",2),1:1)
"RTN","IBNCPDP3",74,0)
 ;
"RTN","IBNCPDP3",75,0)
 I IBDUZ'=DUZ D  ; set the real user
"RTN","IBNCPDP3",76,0)
 . N IBI,IBT S IBI=18,IBT(399,IBIFN_",",IBI)=IBDUZ D FILE^DIE("","IBT")
"RTN","IBNCPDP3",77,0)
 ;
"RTN","IBNCPDP3",78,0)
REVQ ; perform end of job tasks  
"RTN","IBNCPDP3",79,0)
 D LOG^IBNCPDP2($S($G(IBAUTO)=1:"AUTO REVERSE",$G(IBAUTO)=2:"BILL CANCELLED",1:"REVERSE"),IBY)
"RTN","IBNCPDP3",80,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP3",81,0)
 I IBY=1,$G(IBIFN) S IBY=+IBIFN
"RTN","IBNCPDP3",82,0)
 Q IBY
"RTN","IBNCPDP3",83,0)
 ;
"RTN","IBNCPDP3",84,0)
RTS(IBRR) ; Return to Stock processing on Released Rx
"RTN","IBNCPDP3",85,0)
 ; input - IBRR = reversal reason
"RTN","IBNCPDP3",86,0)
 ;         IBCRSN = passed in by reference 
"RTN","IBNCPDP3",87,0)
 ; output - 0 = reversal not due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",88,0)
 ;          1 = reversal due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",89,0)
 ;          IBCRSN = charge removal reason
"RTN","IBNCPDP3",90,0)
 I IBRR'="RX RETURNED TO STOCK"&(IBRR'="RX DELETED") Q 0
"RTN","IBNCPDP3",91,0)
 N IBTRKRN,IBLOCK2,IBCMT,DA,DIE,DR
"RTN","IBNCPDP3",92,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP3",93,0)
 I 'IBTRKRN Q 0  ; CT record does not exist
"RTN","IBNCPDP3",94,0)
 I '$P($G(^IBT(356,IBTRKRN,0)),U,11) Q 0  ; BILL does not exist
"RTN","IBNCPDP3",95,0)
 S IBCRES=$$GETRSN(DFN,IBRXN,IBFIL)  ; recorded in file 399 entry
"RTN","IBNCPDP3",96,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP3",97,0)
 S DIE="^IBT(356,",DA=IBTRKRN,IBCMT="Rx RTS - May Need Refund"
"RTN","IBNCPDP3",98,0)
 S DR="1.08////"_IBCMT
"RTN","IBNCPDP3",99,0)
 D ^DIE
"RTN","IBNCPDP3",100,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP3",101,0)
 Q 1
"RTN","IBNCPDP3",102,0)
 ;
"RTN","IBNCPDP3",103,0)
BULL ; Generate a bulletin if there is an error in cancelling the claim.
"RTN","IBNCPDP3",104,0)
 N IBC,IBT,IBPT,IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IBNCPDP3",105,0)
 ;
"RTN","IBNCPDP3",106,0)
 S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBNCPDP3",107,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBNCPDP3",108,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPDP3",109,0)
 S XMY(IBDUZ)=""
"RTN","IBNCPDP3",110,0)
 S XMY("G.IBCNR EPHARM")=""
"RTN","IBNCPDP3",111,0)
 ;
"RTN","IBNCPDP3",112,0)
 S IBT(1)="An error occurred while cancelling the Pharmacy claim from ECME"
"RTN","IBNCPDP3",113,0)
 S IBT(2)="fiscal intermediary for the following patient:"
"RTN","IBNCPDP3",114,0)
 S IBT(3)=" " S IBC=3
"RTN","IBNCPDP3",115,0)
 D PAT^IBAERR1 ; Accepts IBDUZ
"RTN","IBNCPDP3",116,0)
 S IBC=IBC+1,IBT(IBC)="   Bill #: "_IBIL
"RTN","IBNCPDP3",117,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",118,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBNCPDP3",119,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",120,0)
 D ERR^IBAERR1
"RTN","IBNCPDP3",121,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",122,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and decrease"
"RTN","IBNCPDP3",123,0)
 S IBC=IBC+1,IBT(IBC)="out this receivable in Accounts Receivable if necessary."
"RTN","IBNCPDP3",124,0)
 D ^XMD
"RTN","IBNCPDP3",125,0)
 Q
"RTN","IBNCPDP3",126,0)
 ;
"RTN","IBNCPDP3",127,0)
GETRSN(DFN,IBRXN,IBFIL) ;
"RTN","IBNCPDP3",128,0)
 ; retrieve charge removal reason from file 354.71
"RTN","IBNCPDP3",129,0)
 ; input - DFN,IBRXN=Rx ien,IBFIL=fill number
"RTN","IBNCPDP3",130,0)
 ; output - charge removal reason 
"RTN","IBNCPDP3",131,0)
 N IBDT,IBDA,IBXRSN,IBRXFIL,IB0
"RTN","IBNCPDP3",132,0)
 S (IBDT,IBDA)=0,IBXRSN=""
"RTN","IBNCPDP3",133,0)
 S IBRXFIL=$S('IBFIL:IBRXN,1:IBRXN_";"_IBFIL)
"RTN","IBNCPDP3",134,0)
 F  S IBDT=$O(^IBAM(354.71,"AD",DFN,IBDT)) Q:'IBDT  Q:IBXRSN]""  D
"RTN","IBNCPDP3",135,0)
 . F  S IBDA=$O(^IBAM(354.71,"AD",DFN,IBDT,IBDA)) Q:'IBDA  Q:IBXRSN]""  D
"RTN","IBNCPDP3",136,0)
 . . S IB0=^IBAM(354.71,IBDA,0)
"RTN","IBNCPDP3",137,0)
 . . Q:$P(IB0,"^",6)'[IBRXFIL
"RTN","IBNCPDP3",138,0)
 . . S IBXRSN=$$GET1^DIQ(354.71,IBDA_",",.19)
"RTN","IBNCPDP3",139,0)
 S:IBXRSN']"" IBXRSN="CHARGE REMOVAL REASON NOT FOUND"
"RTN","IBNCPDP3",140,0)
 Q "Reversal Rej, no pymt due<>"_IBXRSN
"RTN","IBNCPDP3",141,0)
 ;
"RTN","IBNCPDP3",142,0)
 ;IBNCPDP3
"RTN","IBNCPDPC")
0^28^B5379430
"RTN","IBNCPDPC",1,0)
IBNCPDPC ;DALOI/SS - CLAIMS TRACKING EDITOR for ECME ;27-JUN-2005
"RTN","IBNCPDPC",2,0)
 ;;2.0;INTEGRATED BILLING;**276,339,363**;21-MAR-94;Build 35
"RTN","IBNCPDPC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPC",4,0)
 ;
"RTN","IBNCPDPC",5,0)
 ;
"RTN","IBNCPDPC",6,0)
% ; -- main entry point for IBT CLAIMS TRACKING EDIT
"RTN","IBNCPDPC",7,0)
 ;DFN- patients IEN (file #2)
"RTN","IBNCPDPC",8,0)
 ;IBECMEN - NCPDP/ECME number (last 7 digits of the IEN of file #52)
"RTN","IBNCPDPC",9,0)
 ; that belong to this claim.
"RTN","IBNCPDPC",10,0)
 ;ien in CLAIMS TRACKING file #356  
"RTN","IBNCPDPC",11,0)
 ;
"RTN","IBNCPDPC",12,0)
CT(DFN,IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",13,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPC",14,0)
 Q:'$G(DFN)
"RTN","IBNCPDPC",15,0)
 Q:'$G(IBECMEN)
"RTN","IBNCPDPC",16,0)
 N IBTRN
"RTN","IBNCPDPC",17,0)
 S IBTRN=+$$SELCT(IBECMEN,IBREFNUM)
"RTN","IBNCPDPC",18,0)
 I +IBTRN=0 D  Q
"RTN","IBNCPDPC",19,0)
 . W !,"There is no claims tracking record for this claim."
"RTN","IBNCPDPC",20,0)
 . D PAUSE^VALM1
"RTN","IBNCPDPC",21,0)
 D EN^VALM("IBNCPDP LSTMN CT")
"RTN","IBNCPDPC",22,0)
 Q
"RTN","IBNCPDPC",23,0)
 ;
"RTN","IBNCPDPC",24,0)
EN ; -- main entry point for IBT EXPAND/EDIT TRACKING
"RTN","IBNCPDPC",25,0)
 D EN^IBTRED
"RTN","IBNCPDPC",26,0)
 Q
"RTN","IBNCPDPC",27,0)
 ;
"RTN","IBNCPDPC",28,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPC",29,0)
 D INIT^IBTRED
"RTN","IBNCPDPC",30,0)
 Q
"RTN","IBNCPDPC",31,0)
 ;
"RTN","IBNCPDPC",32,0)
HELP ; -- help code
"RTN","IBNCPDPC",33,0)
 D HELP^IBTRED
"RTN","IBNCPDPC",34,0)
 Q
"RTN","IBNCPDPC",35,0)
 ;
"RTN","IBNCPDPC",36,0)
EXIT ; -- exit code
"RTN","IBNCPDPC",37,0)
 D EXIT^IBTRED
"RTN","IBNCPDPC",38,0)
 Q
"RTN","IBNCPDPC",39,0)
 ;
"RTN","IBNCPDPC",40,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBNCPDPC",41,0)
 D BLANK^IBTRED(.LINE)
"RTN","IBNCPDPC",42,0)
 Q
"RTN","IBNCPDPC",43,0)
 ;
"RTN","IBNCPDPC",44,0)
ETYP(IBTRN) ; -- Expand type of epidose and date
"RTN","IBNCPDPC",45,0)
 Q $$ETYP^IBTRED(IBTRN)
"RTN","IBNCPDPC",46,0)
 ;
"RTN","IBNCPDPC",47,0)
ENCL(IBOE) ; -- output format of classifications
"RTN","IBNCPDPC",48,0)
 Q $$ENCL^IBTRED(IBOE)
"RTN","IBNCPDPC",49,0)
 ;
"RTN","IBNCPDPC",50,0)
SELCT(IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",51,0)
 N IBRET,IB356
"RTN","IBNCPDPC",52,0)
 S (IB356,IBRET)=0
"RTN","IBNCPDPC",53,0)
 F  S IB356=+$O(^IBT(356,"AE",IBECMEN,IB356)) Q:((IB356=0)!(IBRET'=0))  D
"RTN","IBNCPDPC",54,0)
 . I IBREFNUM=+$P($G(^IBT(356,IB356,0)),U,10) S IBRET=IB356
"RTN","IBNCPDPC",55,0)
 Q +IBRET
"RTN","IBNCPDPC",56,0)
 ;
"RTN","IBNCPDPC",57,0)
 ;return RX info 
"RTN","IBNCPDPC",58,0)
 ;IBDFN - patient's DFN
"RTN","IBNCPDPC",59,0)
 ;IBRX - ien in #52
"RTN","IBNCPDPC",60,0)
 ;output in .PSOTMP array
"RTN","IBNCPDPC",61,0)
PSOCPVW(IBDFN,IBRX,PSOTMP) ;
"RTN","IBNCPDPC",62,0)
 Q:($G(IBDFN)=0)!($G(IBRX)=0)
"RTN","IBNCPDPC",63,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",64,0)
 D RX^PSO52API(IBDFN,"IBNCPDP-RXINFO",IBRX,"",0)
"RTN","IBNCPDPC",65,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,.01))
"RTN","IBNCPDPC",66,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),7,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,7))
"RTN","IBNCPDPC",67,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),8,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,8))
"RTN","IBNCPDPC",68,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),6,"E")=$P($G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,6)),U,2)
"RTN","IBNCPDPC",69,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",70,0)
 Q
"RTN","IBNCPDPC",71,0)
 ;
"RTN","IBNCPDPE")
0^15^B17542658
"RTN","IBNCPDPE",1,0)
IBNCPDPE ;DALOI/AAT - NCPDP BILLING EVENTS REPORT ;10-JUN-2003
"RTN","IBNCPDPE",2,0)
 ;;2.0;INTEGRATED BILLING;**276,342,347,363**;21-MAR-94;Build 35
"RTN","IBNCPDPE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPE",4,0)
 ;
"RTN","IBNCPDPE",5,0)
DATE ;
"RTN","IBNCPDPE",6,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPDPE",7,0)
 S %DT="AEX"
"RTN","IBNCPDPE",8,0)
 S %DT("A")="START WITH DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",9,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",10,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",11,0)
 S IBBDT=+Y
"RTN","IBNCPDPE",12,0)
 S %DT="AEX"
"RTN","IBNCPDPE",13,0)
 S %DT("A")="GO TO DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",14,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",15,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",16,0)
 S IBEDT=+Y
"RTN","IBNCPDPE",17,0)
 Q
"RTN","IBNCPDPE",18,0)
 ;
"RTN","IBNCPDPE",19,0)
MODE ;
"RTN","IBNCPDPE",20,0)
 N DIR,DIC,DIRUT,DUOUT,PSOFILE
"RTN","IBNCPDPE",21,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",22,0)
 S DIR(0)="S^P:SINGLE PATIENT;R:SINGLE RX;E:SINGLE ECME #;A:ALL ACTIVITY"
"RTN","IBNCPDPE",23,0)
 S DIR("A")="SINGLE (P)ATIENT, SINGLE (R)X, SINGLE (E)CME #, (A)LL ACTIVITY"
"RTN","IBNCPDPE",24,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",25,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",26,0)
 S IBM1=Y
"RTN","IBNCPDPE",27,0)
 I IBM1="P" S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC Q:$D(DUOUT)  S IBPAT=$S(Y>0:+Y,1:0) I 'IBPAT W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",28,0)
 I IBM1="R" S PSOFILE=52,DIC="^PSRX(",DIC(0)="AEQMN" D DIC^PSODI(PSOFILE,.DIC) Q:$D(DUOUT)  S IBRX=$S(Y>0:+Y,1:0) I 'IBRX W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",29,0)
 K PSODIY
"RTN","IBNCPDPE",30,0)
 I IBM1="E" S DIR(0)="FO^7:7^I X'?1.7N W !!,""Cannot contain alpha characters"" K X",DIR("A")="Enter ECME #" D ^DIR Q:$D(DUOUT)  S IBECME=$S(+Y>0:Y,1:0) I 'IBECME W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",31,0)
 S IBM2="B"
"RTN","IBNCPDPE",32,0)
 ; if "All"
"RTN","IBNCPDPE",33,0)
 I IBM1="A" D  Q:$G(IBQ)
"RTN","IBNCPDPE",34,0)
 .S DIR(0)="S^E:ECME BILLABLE;N:NON ECME BILLABLE;B:BOTH"
"RTN","IBNCPDPE",35,0)
 .S DIR("A")="(E)CME BILLABLE;(N)ON ECME BILLABLE;(B)OTH"
"RTN","IBNCPDPE",36,0)
 .S DIR("B")="BOTH"
"RTN","IBNCPDPE",37,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",38,0)
 .S IBM2=Y
"RTN","IBNCPDPE",39,0)
 ;
"RTN","IBNCPDPE",40,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",41,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",42,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",43,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",44,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",45,0)
 S IBM3=Y
"RTN","IBNCPDPE",46,0)
 ;
"RTN","IBNCPDPE",47,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",48,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",49,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",50,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",51,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",52,0)
 Q
"RTN","IBNCPDPE",53,0)
 ;
"RTN","IBNCPDPE",54,0)
TESTDATA() ;
"RTN","IBNCPDPE",55,0)
 N Y
"RTN","IBNCPDPE",56,0)
 S Y=$$HAVEDATA()
"RTN","IBNCPDPE",57,0)
 I 'Y W !!,"No data found in the specified period.",!
"RTN","IBNCPDPE",58,0)
 Q Y
"RTN","IBNCPDPE",59,0)
 ;
"RTN","IBNCPDPE",60,0)
HAVEDATA() ;
"RTN","IBNCPDPE",61,0)
 N Z
"RTN","IBNCPDPE",62,0)
 I $D(^IBCNR(366.14,"B",IBBDT)) Q 1
"RTN","IBNCPDPE",63,0)
 S Z=+$O(^IBCNR(366.14,"B",IBBDT))
"RTN","IBNCPDPE",64,0)
 I Z=0 Q 0
"RTN","IBNCPDPE",65,0)
 I Z>IBEDT Q 0
"RTN","IBNCPDPE",66,0)
 Q 1
"RTN","IBNCPDPE",67,0)
 ;
"RTN","IBNCPDPE",68,0)
DEVICE ;
"RTN","IBNCPDPE",69,0)
 N DIR,DIRUT,POP,ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS,ZTSK
"RTN","IBNCPDPE",70,0)
 S %ZIS="QM"
"RTN","IBNCPDPE",71,0)
 W ! D ^%ZIS
"RTN","IBNCPDPE",72,0)
 I POP S IBQ=1 Q
"RTN","IBNCPDPE",73,0)
 S IBSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","IBNCPDPE",74,0)
 ;
"RTN","IBNCPDPE",75,0)
 I $D(IO("Q")) D  S IBQ=1
"RTN","IBNCPDPE",76,0)
 . S ZTRTN="START^IBNCPEV"
"RTN","IBNCPDPE",77,0)
 . S ZTIO=ION
"RTN","IBNCPDPE",78,0)
 . S ZTSAVE("IB*")=""
"RTN","IBNCPDPE",79,0)
 . S ZTDESC="IB ECME BILLING EVENTS REPORT"
"RTN","IBNCPDPE",80,0)
 . D ^%ZTLOAD
"RTN","IBNCPDPE",81,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","IBNCPDPE",82,0)
 . D HOME^%ZIS
"RTN","IBNCPDPE",83,0)
 U IO
"RTN","IBNCPDPE",84,0)
 Q
"RTN","IBNCPDPE",85,0)
 ;------ added for the User screen --------
"RTN","IBNCPDPE",86,0)
 ;User Screen Entry point (to call from ECME User Screen)
"RTN","IBNCPDPE",87,0)
 ;IBMODE:
"RTN","IBNCPDPE",88,0)
 ; P-patient
"RTN","IBNCPDPE",89,0)
 ; R-Rx
"RTN","IBNCPDPE",90,0)
 ;IBVAL - patient DFN or RX ien (#52)
"RTN","IBNCPDPE",91,0)
 ;
"RTN","IBNCPDPE",92,0)
USRSCREN(IBMODE,IBVAL) ;
"RTN","IBNCPDPE",93,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPE",94,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS
"RTN","IBNCPDPE",95,0)
 S (IBPAT,IBRX,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS)=0
"RTN","IBNCPDPE",96,0)
 S IBM1=IBMODE
"RTN","IBNCPDPE",97,0)
 I IBM1="P" S IBPAT=+IBVAL
"RTN","IBNCPDPE",98,0)
 I IBM1="R" S IBRX=+IBVAL
"RTN","IBNCPDPE",99,0)
 ;date
"RTN","IBNCPDPE",100,0)
 F  D DATE Q:IBQ  Q:$$TESTDATA
"RTN","IBNCPDPE",101,0)
 Q:IBQ
"RTN","IBNCPDPE",102,0)
 N IBMLTDV S IBMLTDV=$$MULTPHRM^BPSUTIL()
"RTN","IBNCPDPE",103,0)
 I +IBMLTDV=1 S IBDIVS=+$$MULTIDIV^IBNCPEV1(.IBDIVS) S:IBDIVS=0 IBDIVS(0)="0^ALL" I IBDIVS=-1 S IBQ=1 Q
"RTN","IBNCPDPE",104,0)
 I +IBMLTDV=0 S IBDIVS=0,IBDIVS(0)="0^"_$P(IBMLTDV,U,2)
"RTN","IBNCPDPE",105,0)
 D MODE2 Q:IBQ
"RTN","IBNCPDPE",106,0)
 D DEVICE Q:IBQ
"RTN","IBNCPDPE",107,0)
 D START^IBNCPEV
"RTN","IBNCPDPE",108,0)
 D ^%ZISC
"RTN","IBNCPDPE",109,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPDPE",110,0)
 Q
"RTN","IBNCPDPE",111,0)
 ;
"RTN","IBNCPDPE",112,0)
MODE2 ;
"RTN","IBNCPDPE",113,0)
 N DIR,DIC,DIRUT,DUOUT
"RTN","IBNCPDPE",114,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",115,0)
 S IBM2="B"
"RTN","IBNCPDPE",116,0)
 ;
"RTN","IBNCPDPE",117,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",118,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",119,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",120,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",121,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",122,0)
 S IBM3=Y
"RTN","IBNCPDPE",123,0)
 ;
"RTN","IBNCPDPE",124,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",125,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",126,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",127,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",128,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",129,0)
 Q
"RTN","IBNCPDPE",130,0)
 ;IBNCPDPE
"RTN","IBNCPEB")
0^21^B27674256
"RTN","IBNCPEB",1,0)
IBNCPEB ;WOIFO/AAT - BULLETINS FOR NCPDP ;05-NOV-04
"RTN","IBNCPEB",2,0)
 ;;2.0;INTEGRATED BILLING;**276,342,347,363**;21-MAR-94;Build 35
"RTN","IBNCPEB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPEB",4,0)
 Q
"RTN","IBNCPEB",5,0)
 ;
"RTN","IBNCPEB",6,0)
BULL(DFN,IBD,IBERR,IBIFN) ;Process NCPDP Error Messages.
"RTN","IBNCPEB",7,0)
 N IBC,IBT,IBPT,XMSUB,XMY,XMTEXT,XMDUZ,IBMSGT,IBI,IBGRP,IBDUZ,IBRXNO,DRGNM
"RTN","IBNCPEB",8,0)
 ; Input: same as RX^IBNCPDP2()
"RTN","IBNCPEB",9,0)
 ;
"RTN","IBNCPEB",10,0)
 S IBDUZ=$G(IBD("FILLED BY"))
"RTN","IBNCPEB",11,0)
 S IBRXNO=$G(IBD("RX NO"),"UNKNOWN")
"RTN","IBNCPEB",12,0)
 S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBNCPEB",13,0)
 S XMSUB="NCPDP BILLING ERROR - RX #"_IBRXNO
"RTN","IBNCPEB",14,0)
 S IBC=0
"RTN","IBNCPEB",15,0)
 D T("An error occurred while creating IB Third Party Bill for RX #"_IBRXNO)
"RTN","IBNCPEB",16,0)
 I $G(IBIFN) D T("IB Bill #"_$P($G(^DGCR(399,+IBIFN,0)),U)_" created with errors.")
"RTN","IBNCPEB",17,0)
 D T()
"RTN","IBNCPEB",18,0)
 D T("The following error was encountered: "_$P(IBERR,U,2))
"RTN","IBNCPEB",19,0)
 D T()
"RTN","IBNCPEB",20,0)
 D T("      Patient: "_$S($L(IBPT):$P(IBPT,U)_"       Pt. ID: "_$P(IBPT,U,2),1:"Not Defined"))
"RTN","IBNCPEB",21,0)
 D T(" Rx filled by: "_$P($G(^VA(200,+IBDUZ,0)),U))
"RTN","IBNCPEB",22,0)
 D T(" Prescription: "_IBRXNO)
"RTN","IBNCPEB",23,0)
 D T("  Fill Number: "_$G(IBD("FILL NUMBER")))
"RTN","IBNCPEB",24,0)
 D T("    Fill Date: "_$G(IBD("FILL DATE")))
"RTN","IBNCPEB",25,0)
 D T("   Group Plan: "_$P($G(^IBA(355.3,+$G(IBD("PLAN")),0)),U)_"  (IEN="_+$G(IBD("PLAN"))_")")
"RTN","IBNCPEB",26,0)
 D ZERO^IBRXUTL(+$G(IBD("DRUG"))) S DRGNM=^TMP($J,"IBDRUG",+$G(IBD("DRUG")),.01)
"RTN","IBNCPEB",27,0)
 D T("         Drug: "_DRGNM)
"RTN","IBNCPEB",28,0)
 D T("Amount Billed: "_$J($G(IBD("BILLED")),5,2))
"RTN","IBNCPEB",29,0)
 D T("  Amount Paid: "_$J($G(IBD("PAID")),5,2))
"RTN","IBNCPEB",30,0)
 D T()
"RTN","IBNCPEB",31,0)
 D T("Please review the circumstances surrounding this error and make necessary")
"RTN","IBNCPEB",32,0)
 D T("corrections.")
"RTN","IBNCPEB",33,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPEB",34,0)
 S XMY("G.IBCNR EPHARM")=""
"RTN","IBNCPEB",35,0)
 D ZXMD
"RTN","IBNCPEB",36,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBNCPEB",37,0)
 Q
"RTN","IBNCPEB",38,0)
 ;
"RTN","IBNCPEB",39,0)
 ;call mailman in background (using taskman)
"RTN","IBNCPEB",40,0)
ZXMD ;
"RTN","IBNCPEB",41,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC
"RTN","IBNCPEB",42,0)
 N %,%H,%I,X
"RTN","IBNCPEB",43,0)
 D NOW^%DTC
"RTN","IBNCPEB",44,0)
 S ZTIO="",ZTDTH=%,ZTDESC="NCPDP BILLING ERROR BULLETIN"
"RTN","IBNCPEB",45,0)
 S ZTSAVE("IBT*")="",ZTSAVE("XM*")=""
"RTN","IBNCPEB",46,0)
 S ZTRTN="^XMD"
"RTN","IBNCPEB",47,0)
 D ^%ZTLOAD
"RTN","IBNCPEB",48,0)
 Q
"RTN","IBNCPEB",49,0)
 ;
"RTN","IBNCPEB",50,0)
T(IBTXT) ; Add text to the message
"RTN","IBNCPEB",51,0)
 S IBC=IBC+1,IBT(IBC)=$G(IBTXT," ")
"RTN","IBNCPEB",52,0)
 Q
"RTN","IBNCPEB",53,0)
 ;
"RTN","IBNCPEB",54,0)
 ;-------------------------
"RTN","IBNCPEB",55,0)
 ;Release charges off hold bulletin
"RTN","IBNCPEB",56,0)
RELBUL(DFN,IBRX,IBFIL,IBADT,IBACT,IBCR,IBCC,IBIFN,IBRETR) ;
"RTN","IBNCPEB",57,0)
 ; Input:
"RTN","IBNCPEB",58,0)
 ;   DFN - Patient
"RTN","IBNCPEB",59,0)
 ;   IBRX - Rx IEN
"RTN","IBNCPEB",60,0)
 ;   IBFIL - Refill#
"RTN","IBNCPEB",61,0)
 ;   IBADT - Fill date
"RTN","IBNCPEB",62,0)
 ;   IBACT
"RTN","IBNCPEB",63,0)
 ;    -1  if ^IBR error - when the charge was sent to AR
"RTN","IBNCPEB",64,0)
 ;    0   == charge was not found 
"RTN","IBNCPEB",65,0)
 ;   IBCR - Close Reason code (.01 of BPS CLOSE REASON)
"RTN","IBNCPEB",66,0)
 ;   IBCC - Close Reason Comment
"RTN","IBNCPEB",67,0)
 ;   IBIFN - 3rd party bill IEN
"RTN","IBNCPEB",68,0)
 ;   IBRETR - attempt # after which a bulletion was sent
"RTN","IBNCPEB",69,0)
 N IBT,IBC,IBGRP,XMSUB,XMDUZ,XMY,XMTEXT,VAERR,VADM,X,VA
"RTN","IBNCPEB",70,0)
 N IBNAME,IBAGE,IBPID,IBBID,IBRXN
"RTN","IBNCPEB",71,0)
 D DEM^VADPT ; get patient demographic data
"RTN","IBNCPEB",72,0)
 I VAERR K VADM
"RTN","IBNCPEB",73,0)
 S IBNAME=$$PR($G(VADM(1)),26)
"RTN","IBNCPEB",74,0)
 S IBAGE=$$PR($G(VADM(4)),3)
"RTN","IBNCPEB",75,0)
 S IBPID=$G(VA("PID"))
"RTN","IBNCPEB",76,0)
 S IBBID=$G(VA("BID"))
"RTN","IBNCPEB",77,0)
 S XMSUB=$E(IBNAME,1,8)_"("_IBBID_")"_" PATIENT CHRG NOT RELEASED"_"-"_$E($P($$MCDIV(IBRX,IBFIL),U),1,11)
"RTN","IBNCPEB",78,0)
 ;
"RTN","IBNCPEB",79,0)
 S IBC=0
"RTN","IBNCPEB",80,0)
 ;include a standard CHRG NOT RELEASED text
"RTN","IBNCPEB",81,0)
 D T("The following charge has not been released from HOLD. Copay was not released")
"RTN","IBNCPEB",82,0)
 D T("due to technical problems"_$S($G(IBACT)=-1:" with passing the payment to AR.",1:"."))
"RTN","IBNCPEB",83,0)
 D T("Please review manually and release if necessary.")
"RTN","IBNCPEB",84,0)
 ;if release of copay attempt was due to claim closing process - include a close reason
"RTN","IBNCPEB",85,0)
 I IBCR D T("Note: the e-pharmacy claim was closed by OPECC as '"_$$REASON^IBNCPDPU(IBCR)_"'")
"RTN","IBNCPEB",86,0)
 I $G(IBCC)'="" D T("Additional comment: "_IBCC)
"RTN","IBNCPEB",87,0)
 D T()
"RTN","IBNCPEB",88,0)
 D T("Name: "_IBNAME_"   Age    : "_IBAGE_"       Pt. ID: "_IBPID)
"RTN","IBNCPEB",89,0)
 S IBRXN=$$FILE^IBRXUTL(IBRX,.01)
"RTN","IBNCPEB",90,0)
 D T("Rx #: "_$$PR(IBRXN_$S(IBFIL:" ("_IBFIL_")",1:""),28)_" Fill Dt: "_$$DAT1^IBOUTL(IBADT))
"RTN","IBNCPEB",91,0)
 D T()
"RTN","IBNCPEB",92,0)
 D:$G(IBRETR)>0 T("Attempts to release a copay from hold: "_$G(IBRETR))
"RTN","IBNCPEB",93,0)
 ;D CHRG
"RTN","IBNCPEB",94,0)
 ; Transmit mail
"RTN","IBNCPEB",95,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPEB",96,0)
 S XMY("G.IBCNR EPHARM")=""
"RTN","IBNCPEB",97,0)
 D ^XMD
"RTN","IBNCPEB",98,0)
 Q
"RTN","IBNCPEB",99,0)
 ;
"RTN","IBNCPEB",100,0)
CHRG ; gets charge data and sets up charge lines
"RTN","IBNCPEB",101,0)
 N IBTYP,IBFR,IBTO,IBX,IBX1,IBRXN,IBRF,IENS
"RTN","IBNCPEB",102,0)
 S IBX=$G(^IB(IBACT,0))
"RTN","IBNCPEB",103,0)
 S IBX1=$G(^IB(IBACT,1))
"RTN","IBNCPEB",104,0)
 S IBFR=$$DAT1^IBOUTL($S($P(IBX,U,14)'="":($P(IBX,U,14)),1:$P(IBX1,U,2)))
"RTN","IBNCPEB",105,0)
 S IBTO=$$DAT1^IBOUTL($S($P(IBX,U,15)'="":($P(IBX,U,15)),1:$P(IBX1,U,2)))
"RTN","IBNCPEB",106,0)
 S IBRXN=$$FILE^IBRXUTL(IBRX,.01) ;$P($P(IBX,U,8),"-")
"RTN","IBNCPEB",107,0)
 S IBTYP=$P(IBX,U,3)
"RTN","IBNCPEB",108,0)
 S:IBTYP IBTYP=$P($G(^IBE(350.1,IBTYP,0)),U,3)
"RTN","IBNCPEB",109,0)
 S:IBTYP IBTYP=$P($$CATN^PRCAFN(IBTYP),U,2)
"RTN","IBNCPEB",110,0)
 D T("Type: "_$$PR(IBTYP,28)_" Amount : $"_$J(+$P(IBX,U,7),0,2))
"RTN","IBNCPEB",111,0)
 D T("From: "_$$PR(IBFR,28)_" To     : "_IBTO)
"RTN","IBNCPEB",112,0)
 D T("Rx #: "_$$PR(IBRXN_$S(IBFIL:" ("_IBFIL_")",1:""),28)_" Fill Dt: "_$$DAT1^IBOUTL(IBADT))
"RTN","IBNCPEB",113,0)
 D T()
"RTN","IBNCPEB",114,0)
 D T("REFERENCE NUMBER : "_$P(IBX,U))
"RTN","IBNCPEB",115,0)
 D T("FIRST PARTY BILL : "_$P(IBX,U,11))
"RTN","IBNCPEB",116,0)
 I $G(IBIFN) D T("THIRD PARTY BILL : "_$P($G(^PRCA(430,+IBIFN,0)),U))
"RTN","IBNCPEB",117,0)
 Q
"RTN","IBNCPEB",118,0)
 ;
"RTN","IBNCPEB",119,0)
PR(STR,LEN) ; pad right
"RTN","IBNCPEB",120,0)
 N B S STR=$E(STR,1,LEN),$P(B," ",LEN-$L(STR))=" "
"RTN","IBNCPEB",121,0)
 Q STR_$G(B)
"RTN","IBNCPEB",122,0)
 ;
"RTN","IBNCPEB",123,0)
 ;MC Division for the IB
"RTN","IBNCPEB",124,0)
MCDIV(IBRX,IBFIL) ; Get MC DIVISION name from the Rx/Fill
"RTN","IBNCPEB",125,0)
 N IBDIV,IBINST,IBMCDIV,IBNAM,IBUNK,PSOFILE,DIR,DIQ,DA,DR,DFN,DIC
"RTN","IBNCPEB",126,0)
 S IBUNK="DIV UNKNWN"
"RTN","IBNCPEB",127,0)
 ; outpatient division
"RTN","IBNCPEB",128,0)
 S DFN=$$FILE^IBRXUTL(IBRX,2)
"RTN","IBNCPEB",129,0)
 I '$G(IBFIL) S IBDIV=$$FILE^IBRXUTL(IBRX,20)
"RTN","IBNCPEB",130,0)
 E  S IBDIV=+$P($$ZEROSUB^IBRXUTL(DFN,IBRX,IBFIL),U,9)
"RTN","IBNCPEB",131,0)
 I 'IBDIV Q IBUNK
"RTN","IBNCPEB",132,0)
 ; related institution
"RTN","IBNCPEB",133,0)
 S PSOFILE=59,DIC=59,DIQ="IBRXARR",DIQ(0)="I",DA=IBDIV,DR=100
"RTN","IBNCPEB",134,0)
 D DIQ^PSODI(PSOFILE,DIC,DR,DA,.DIQ)
"RTN","IBNCPEB",135,0)
 S IBINST=$G(IBRXARR(59,DA,100,"I")) Q:'IBINST IBUNK
"RTN","IBNCPEB",136,0)
 S IBMCDIV=+$O(^DG(40.8,"AD",IBINST,0)) ; medical center division
"RTN","IBNCPEB",137,0)
 I 'IBMCDIV Q IBUNK
"RTN","IBNCPEB",138,0)
 S IBNAM=$P($G(^DG(40.8,IBMCDIV,0)),U)
"RTN","IBNCPEB",139,0)
 K IBRXARR,PSODIY
"RTN","IBNCPEB",140,0)
 Q $S(IBNAM="":IBUNK,1:IBNAM)_U_IBMCDIV
"RTN","IBNCPEB",141,0)
 ;
"RTN","IBNCPEB",142,0)
 ;IBNCPEB
"RTN","IBNCPEV")
0^17^B83555880
"RTN","IBNCPEV",1,0)
IBNCPEV ;DALOI/SS - NCPDP BILLING EVENTS REPORT ;21-MAR-2006
"RTN","IBNCPEV",2,0)
 ;;2.0;INTEGRATED BILLING;**342,363**;21-MAR-94;Build 35
"RTN","IBNCPEV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPEV",4,0)
 ;
"RTN","IBNCPEV",5,0)
 Q
"RTN","IBNCPEV",6,0)
RPT ;
"RTN","IBNCPEV",7,0)
 ;
"RTN","IBNCPEV",8,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS
"RTN","IBNCPEV",9,0)
 N IBECME
"RTN","IBNCPEV",10,0)
 D SETVARS^IBNCPEV1
"RTN","IBNCPEV",11,0)
 Q:IBQ
"RTN","IBNCPEV",12,0)
 D START
"RTN","IBNCPEV",13,0)
 D ^%ZISC
"RTN","IBNCPEV",14,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPEV",15,0)
 Q
"RTN","IBNCPEV",16,0)
 ;
"RTN","IBNCPEV",17,0)
START ;
"RTN","IBNCPEV",18,0)
 N REF,IBFROM,IBTO,IBI,IBN,IBRX1,IBFN,IBNDX,IB1ST,IBNUM,X,IBSC,IBNB
"RTN","IBNCPEV",19,0)
 N Z,Z1
"RTN","IBNCPEV",20,0)
 ;Constants
"RTN","IBNCPEV",21,0)
 S IBSC="STATUS CHECK",IBNB="Not ECME billable: ",IBNDX="IBNCPDP-"
"RTN","IBNCPEV",22,0)
 ;get the first date
"RTN","IBNCPEV",23,0)
 S IBFROM=$O(^IBCNR(366.14,"B",IBBDT-1)) Q:+IBFROM=0
"RTN","IBNCPEV",24,0)
 ;get the last date
"RTN","IBNCPEV",25,0)
 S IBTO=$O(^IBCNR(366.14,"B",IBEDT+1),-1) Q:+IBTO=0
"RTN","IBNCPEV",26,0)
 ;
"RTN","IBNCPEV",27,0)
 S REF=$NA(^TMP($J,"IBNCPDPE"))
"RTN","IBNCPEV",28,0)
 ;
"RTN","IBNCPEV",29,0)
 K @REF
"RTN","IBNCPEV",30,0)
 ;
"RTN","IBNCPEV",31,0)
 I +$G(IBECME) S IBRX=$$GETRX^IBNCPEV1(IBECME,IBFROM,IBTO) I 'IBRX  W !!,"No data found for the specified date range and ECME #" Q  ; no match with ECME #
"RTN","IBNCPEV",32,0)
 ;collect
"RTN","IBNCPEV",33,0)
 N IBDTIEN,IBRXIEN,IBZ0,IBZ1,IBZ2,IBDFN,IBEVNT,IBP4
"RTN","IBNCPEV",34,0)
 S IBI=IBFROM-1
"RTN","IBNCPEV",35,0)
 F  S IBI=$O(^IBCNR(366.14,"B",IBI)) Q:+IBI=0  Q:IBI>IBTO  D
"RTN","IBNCPEV",36,0)
 . S IBDTIEN=$O(^IBCNR(366.14,"B",IBI,0))
"RTN","IBNCPEV",37,0)
 . S IBN=0 F  S IBN=$O(^IBCNR(366.14,IBDTIEN,1,IBN)) Q:+IBN=0  D
"RTN","IBNCPEV",38,0)
 . . S IBZ0=$G(^IBCNR(366.14,IBDTIEN,1,IBN,0))
"RTN","IBNCPEV",39,0)
 . . ;if not "ALL" was selected IBDIVS>0 AND the division in #366.14 record is among those selected by the user
"RTN","IBNCPEV",40,0)
 . . I IBDIVS>0,$$CHECKDIV^IBNCPEV1(+$P(IBZ0,U,9),.IBDIVS)=0 Q
"RTN","IBNCPEV",41,0)
 . . S IBDFN=+$P(IBZ0,U,3)
"RTN","IBNCPEV",42,0)
 . . Q:IBDFN=0
"RTN","IBNCPEV",43,0)
 . . S IBEVNT=$$GET1^DIQ(366.141,IBN_","_IBDTIEN_",",.01)
"RTN","IBNCPEV",44,0)
 . . S IBZ2=$G(^IBCNR(366.14,IBDTIEN,1,IBN,2))
"RTN","IBNCPEV",45,0)
 . . S IBRXIEN=$P(IBZ2,U,12)
"RTN","IBNCPEV",46,0)
 . . I IBRXIEN="" S IBRXIEN=$P(IBZ2,U,1)
"RTN","IBNCPEV",47,0)
 . . I IBPAT,IBDFN'=IBPAT Q
"RTN","IBNCPEV",48,0)
 . . I IBRX,IBRXIEN'=IBRX Q
"RTN","IBNCPEV",49,0)
 . . I $$RXNUM(IBRXIEN)="" Q
"RTN","IBNCPEV",50,0)
 . . I IBM2="E",IBEVNT[IBSC,'$P(IBZ0,U,7) Q
"RTN","IBNCPEV",51,0)
 . . I IBM2="N",IBEVNT'[IBSC Q
"RTN","IBNCPEV",52,0)
 . . I IBM2="N",IBEVNT[IBSC,$P(IBZ0,U,7) Q
"RTN","IBNCPEV",53,0)
 . . I IBM3'="A",IBM3'=$$RXWMC^IBNCPRR(+IBRXIEN) Q
"RTN","IBNCPEV",54,0)
 . . S @REF@(+IBRXIEN,+$P(IBZ2,U,3),IBDTIEN,IBN)=""
"RTN","IBNCPEV",55,0)
 ;
"RTN","IBNCPEV",56,0)
 I '$D(@REF) W !!,"No data found for the specified input criteria" Q
"RTN","IBNCPEV",57,0)
 ;print
"RTN","IBNCPEV",58,0)
 S IBNUM=0
"RTN","IBNCPEV",59,0)
 U IO D HDR
"RTN","IBNCPEV",60,0)
 S IBRX1="" F  S IBRX1=$O(@REF@(IBRX1)) Q:IBRX1=""  D  Q:IBQ
"RTN","IBNCPEV",61,0)
 .S IBFN="" F  S IBFN=$O(@REF@(IBRX1,IBFN)) Q:IBFN=""  D  Q:IBQ
"RTN","IBNCPEV",62,0)
 ..S IB1ST=1
"RTN","IBNCPEV",63,0)
 ..S IBI="" F  S IBI=$O(@REF@(IBRX1,IBFN,IBI)) Q:IBI=""  D  Q:IBQ
"RTN","IBNCPEV",64,0)
 ...S IBN="" F  S IBN=$O(@REF@(IBRX1,IBFN,IBI,IBN)) Q:IBN=""  D  Q:IBQ
"RTN","IBNCPEV",65,0)
 ....N IBZ,IBD1,IBD2,IBD3,IBD4,IBINS,IBY
"RTN","IBNCPEV",66,0)
 ....;load main
"RTN","IBNCPEV",67,0)
 ....S IBZ=$G(^IBCNR(366.14,IBI,1,IBN,0))
"RTN","IBNCPEV",68,0)
 ....;load IBD array
"RTN","IBNCPEV",69,0)
 ....S IBD1=$G(^IBCNR(366.14,IBI,1,IBN,1))
"RTN","IBNCPEV",70,0)
 ....S IBD2=$G(^IBCNR(366.14,IBI,1,IBN,2))
"RTN","IBNCPEV",71,0)
 ....S IBD3=$G(^IBCNR(366.14,IBI,1,IBN,3))
"RTN","IBNCPEV",72,0)
 ....S IBD4=$G(^IBCNR(366.14,IBI,1,IBN,4))
"RTN","IBNCPEV",73,0)
 ....S IBY=0
"RTN","IBNCPEV",74,0)
 ....;load insurance multiple
"RTN","IBNCPEV",75,0)
 ....F  S IBY=$O(^IBCNR(366.14,IBI,1,IBN,5,IBY)) Q:+IBY=0  D
"RTN","IBNCPEV",76,0)
 .....S IBINS(IBY,0)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,0))
"RTN","IBNCPEV",77,0)
 .....S IBINS(IBY,1)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,1))
"RTN","IBNCPEV",78,0)
 .....S IBINS(IBY,2)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,2))
"RTN","IBNCPEV",79,0)
 .....S IBINS(IBY,3)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,3))
"RTN","IBNCPEV",80,0)
 ....;
"RTN","IBNCPEV",81,0)
 ....I IB1ST D  Q:IBQ
"RTN","IBNCPEV",82,0)
 .....S IBNUM=IBNUM+1 I IBNUM>1 D ULINE("-") Q:IBQ
"RTN","IBNCPEV",83,0)
 .....D CHKP Q:IBQ
"RTN","IBNCPEV",84,0)
 .....W !,IBNUM," ",?4,$$RXNUM(IBRX1)," ",?12,IBFN," ",?16,$$DAT(+$P(IBD2,U,6)) ;RX# Fill# Fiil_date
"RTN","IBNCPEV",85,0)
 .....W " ",?28,$E($$PAT(+$P(IBZ,U,3)),1,21)," ",?50,$E($$DRUG(+$P(IBZ,U,3),IBRX1),1,30)
"RTN","IBNCPEV",86,0)
 .....S IB1ST=0
"RTN","IBNCPEV",87,0)
 ....N IND S IND=6
"RTN","IBNCPEV",88,0)
 ....D CHKP Q:IBQ
"RTN","IBNCPEV",89,0)
 ....S IBEVNT=$$GET1^DIQ(366.141,IBN_","_IBI_",",.01)
"RTN","IBNCPEV",90,0)
 ....W !,?IND,$$EVNT(IBEVNT)," ",?16,$$TIM($P(IBZ,U,5)),?31," Status:",$E($$STAT(IBEVNT,$P(IBZ,U,7)_U_$P(IBZ,U,8),$P(IBD3,U,7),$P(IBD3,U,1)),1,40)
"RTN","IBNCPEV",91,0)
 ....Q:'IBDTL  ; no details
"RTN","IBNCPEV",92,0)
 ....I IBEVNT="BILL" D DBILL Q
"RTN","IBNCPEV",93,0)
 ....I IBEVNT="REJECT" D DREJ Q
"RTN","IBNCPEV",94,0)
 ....I IBEVNT["REVERSE" D DREV Q
"RTN","IBNCPEV",95,0)
 ....I IBEVNT["SUBMIT" D DSUB Q
"RTN","IBNCPEV",96,0)
 ....I IBEVNT["CLOSE" D DCLO Q
"RTN","IBNCPEV",97,0)
 ....I IBEVNT["REOPEN" D REOPEN^IBNCPEV1 Q
"RTN","IBNCPEV",98,0)
 ....I IBEVNT["RELEASE" D DREL Q
"RTN","IBNCPEV",99,0)
 ....I IBEVNT[IBSC D DSTAT^IBNCPEV1(.IBD2,.IBD3,.IBD4,.IBINS) Q
"RTN","IBNCPEV",100,0)
 ....I IBEVNT["BILL CANCELLED" D BCANC Q
"RTN","IBNCPEV",101,0)
 I IBSCR,'IBQ W !,"End of report, press RETURN to continue." R X:DTIME
"RTN","IBNCPEV",102,0)
 K @REF
"RTN","IBNCPEV",103,0)
 Q
"RTN","IBNCPEV",104,0)
 ;
"RTN","IBNCPEV",105,0)
 ;provides STATUS information 
"RTN","IBNCPEV",106,0)
 ;
"RTN","IBNCPEV",107,0)
STAT(X,RES,CR,IBIFN) ;
"RTN","IBNCPEV",108,0)
 N IBSC
"RTN","IBNCPEV",109,0)
 N IBNL
"RTN","IBNCPEV",110,0)
 S IBSC="STATUS CHECK"
"RTN","IBNCPEV",111,0)
 S IBNL="Plan not linked to the Payer"
"RTN","IBNCPEV",112,0)
 I X[IBSC,RES[IBNB S RES="0^"_$P(RES,IBNB,2)
"RTN","IBNCPEV",113,0)
 I X[IBSC,RES[IBNL S RES="0^Plan not linked" ; shorten too long line
"RTN","IBNCPEV",114,0)
 I X[IBSC,'RES,RES["Non-Billable in CT" Q $P(RES,U,2)
"RTN","IBNCPEV",115,0)
 I X[IBSC Q $S(RES:"",1:"non-")_"ECME Billable"_$S(RES:"",$P(RES,U,2)="":"",$P(RES,U,2)="NEEDS SC DETERMINATION":" NEEDS "_$$GETNOANS^IBNCPEV1(IBD4)_" DETERMINATION",1:", "_$P(RES,U,2))
"RTN","IBNCPEV",116,0)
 I X="BILL",'RES,IBIFN Q "Bill "_$$BILL(IBIFN)_" created with ERRORs"
"RTN","IBNCPEV",117,0)
 I X="BILL",'RES Q "Error: "_$P(RES,U,2)
"RTN","IBNCPEV",118,0)
 I X="BILL" Q "Bill# "_$$BILL(+RES)_" created"
"RTN","IBNCPEV",119,0)
 I X["REVERSE",$G(CR)=7,RES=1 Q "set N/B Reason: Rx deleted, no Bill to cancel."
"RTN","IBNCPEV",120,0)
 I X["REVERSE" Q $S(RES=1:"success",RES>1:"Bill# "_$$BILL(+RES)_" cancelled",'RES:"ECME Claim reversed, no Bill to cancel",1:$P(RES,U,2))
"RTN","IBNCPEV",121,0)
 I 'RES Q $P(RES,U,2)
"RTN","IBNCPEV",122,0)
 Q "OK"
"RTN","IBNCPEV",123,0)
 ;
"RTN","IBNCPEV",124,0)
 ;BILL section
"RTN","IBNCPEV",125,0)
 ;input params IBD*, IBZ, IBINS*
"RTN","IBNCPEV",126,0)
DBILL ;
"RTN","IBNCPEV",127,0)
 I '$P(IBZ,U,7),$L($P(IBZ,U,8)),$P(IBD3,U,1) D CHKP Q:IBQ  W !?10,"ERROR DESCRIPTION: ",$P(IBZ,U,8)
"RTN","IBNCPEV",128,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",129,0)
 D SUBHDR
"RTN","IBNCPEV",130,0)
 ;I $P(IBD1,U,5) D CHKP Q:IBQ  W !?10,"MEDICAL CENTER DIVISION: ",$P($G(^DG(40.8,+$P(IBD1,U,5),0)),U)
"RTN","IBNCPEV",131,0)
 I $P(IBD2,U,4) D CHKP Q:IBQ  W !?10,"DRUG:",$$DRUGAPI^IBNCPEV1(+$P(IBD2,U,4),.01)
"RTN","IBNCPEV",132,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",133,0)
 W !,?10,"NDC:",$S($P(IBD2,U,5):$P(IBD2,U,5),1:"No"),", BILLED QTY:",$S($P(IBD2,U,8):$P(IBD2,U,8),1:"No"),", DAYS SUPPLY:",$S($P(IBD2,U,9):$P(IBD2,U,9),1:"No")
"RTN","IBNCPEV",134,0)
 W !,?10,"BILLED:",$J($P(IBD3,U,2),0,2),", "
"RTN","IBNCPEV",135,0)
 W "PAID:",$J($P(IBD3,U,5),0,2)
"RTN","IBNCPEV",136,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",137,0)
 W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",138,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",139,0)
 D DISPUSR
"RTN","IBNCPEV",140,0)
 Q
"RTN","IBNCPEV",141,0)
 ;
"RTN","IBNCPEV",142,0)
 ;reject section
"RTN","IBNCPEV",143,0)
DREJ ;
"RTN","IBNCPEV",144,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",145,0)
 D SUBHDR
"RTN","IBNCPEV",146,0)
 I +$P(IBD3,U,3) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",147,0)
 D CLRS Q:IBQ
"RTN","IBNCPEV",148,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",149,0)
 D DISPUSR
"RTN","IBNCPEV",150,0)
 Q
"RTN","IBNCPEV",151,0)
 ;close
"RTN","IBNCPEV",152,0)
DCLO ;
"RTN","IBNCPEV",153,0)
 D DREJ
"RTN","IBNCPEV",154,0)
 Q
"RTN","IBNCPEV",155,0)
 ;submit
"RTN","IBNCPEV",156,0)
DSUB ;
"RTN","IBNCPEV",157,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",158,0)
 D SUBHDR
"RTN","IBNCPEV",159,0)
 I $L($P(IBD1,U,6)) D CHKP W !?10,"PAYER RESPONSE: ",$P(IBD1,U,6)
"RTN","IBNCPEV",160,0)
 I $L($P(IBD3,U,3)) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",161,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",162,0)
 D DISPUSR
"RTN","IBNCPEV",163,0)
 Q
"RTN","IBNCPEV",164,0)
 ;release
"RTN","IBNCPEV",165,0)
DREL ;
"RTN","IBNCPEV",166,0)
 D DREJ
"RTN","IBNCPEV",167,0)
 Q
"RTN","IBNCPEV",168,0)
 ;reverse
"RTN","IBNCPEV",169,0)
DREV ;
"RTN","IBNCPEV",170,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",171,0)
 D SUBHDR
"RTN","IBNCPEV",172,0)
 I $L($P(IBD1,U,6)),$E($P(IBD1,U,6),1)'="A"&($E($P(IBD1,U,6),1)'="R") S $P(IBD1,U,6)=""  ; only display accepted and rejected on REVERSALS
"RTN","IBNCPEV",173,0)
 I $L($P(IBD1,U,6)) D CHKP W !?10,"PAYER RESPONSE: ",$P(IBD1,U,6)
"RTN","IBNCPEV",174,0)
 I $L($P(IBD3,U,3)) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",175,0)
 D CLRS Q:IBQ
"RTN","IBNCPEV",176,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",177,0)
 D DISPUSR
"RTN","IBNCPEV",178,0)
 W !?10,"REVERSAL REASON:",$P(IBD1,U,7)
"RTN","IBNCPEV",179,0)
 Q
"RTN","IBNCPEV",180,0)
 ;
"RTN","IBNCPEV",181,0)
BCANC ; bill cancellation generated by auto-reversal (duplicate bill)
"RTN","IBNCPEV",182,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",183,0)
 W !?10,"SYSTEM FOUND DUPLICATE BILL WHILE PROCESSING CLAIM"
"RTN","IBNCPEV",184,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",185,0)
 D DISPUSR
"RTN","IBNCPEV",186,0)
 Q
"RTN","IBNCPEV",187,0)
 ;
"RTN","IBNCPEV",188,0)
 ;
"RTN","IBNCPEV",189,0)
RELT(X) I X W ",",?45,"RELEASE DATE:",$$TIM(X)
"RTN","IBNCPEV",190,0)
 Q
"RTN","IBNCPEV",191,0)
CLRS ;
"RTN","IBNCPEV",192,0)
 N TX,PP,RC
"RTN","IBNCPEV",193,0)
 S TX="CLOSE REASON"
"RTN","IBNCPEV",194,0)
 S PP="DROP TO PAPER"
"RTN","IBNCPEV",195,0)
 S RC="RELEASE COPAY"
"RTN","IBNCPEV",196,0)
 I $P(IBD3,U,7)'="" D CHKP Q:IBQ  W !?10,TX,":",$$REASON^IBNCPDPU($P(IBD3,U,7)) W:$P(IBD3,U,8) ", ",PP W:$P(IBD3,U,9) ", ",RC
"RTN","IBNCPEV",197,0)
 S TX="CLOSE COMMENT"
"RTN","IBNCPEV",198,0)
 I $L($P(IBD3,U,6))>2 D CHKP Q:IBQ  W !?10,"COMMENT:",$P(IBD3,U,6)
"RTN","IBNCPEV",199,0)
 Q
"RTN","IBNCPEV",200,0)
 ;
"RTN","IBNCPEV",201,0)
HDR ;header
"RTN","IBNCPEV",202,0)
 W @IOF S IBPAGE=IBPAGE+1 W ?72,"PAGE ",IBPAGE
"RTN","IBNCPEV",203,0)
 W !,$$DISPTITL^IBNCPEV1(IBBDT,IBEDT,IBDTL,.IBDIVS)
"RTN","IBNCPEV",204,0)
 W:IBDIVS'=0 !,$$DISPLDIV^IBNCPEV1(.IBDIVS)
"RTN","IBNCPEV",205,0)
 W !?15
"RTN","IBNCPEV",206,0)
 I IBM1="R" W "SINGLE PRESCRIPTION - ",$$RXNUM(IBRX),"  "
"RTN","IBNCPEV",207,0)
 I IBM1="P" W "SINGLE PATIENT - ",$P($G(^DPT(IBPAT,0)),U),"  "
"RTN","IBNCPEV",208,0)
 I IBM1="E" W "SINGLE ECME # - ",IBECME
"RTN","IBNCPEV",209,0)
 I IBM2="E" W "ECME BILLABLE RX  "
"RTN","IBNCPEV",210,0)
 I IBM2="N" W "NON ECME BILLABLE RX  "
"RTN","IBNCPEV",211,0)
 I IBM3'="A",IBM1'="R" W $S(IBM3="M":"MAIL",IBM3="C":"CMOP",1:"WINDOW")_" PRESCRIPTIONS ONLY"
"RTN","IBNCPEV",212,0)
 W !,?4," RX#   FILL  DATE       PATIENT NAME",?55,"DRUG"
"RTN","IBNCPEV",213,0)
 N I W ! F I=1:1:80 W "="
"RTN","IBNCPEV",214,0)
 Q
"RTN","IBNCPEV",215,0)
 ;
"RTN","IBNCPEV",216,0)
ULINE(X) ;line
"RTN","IBNCPEV",217,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",218,0)
 N I W ! F I=1:1:80 W $G(X,"-")
"RTN","IBNCPEV",219,0)
 Q
"RTN","IBNCPEV",220,0)
CHKP ;Check for EOP
"RTN","IBNCPEV",221,0)
 N Y
"RTN","IBNCPEV",222,0)
 I $Y>(IOSL-4) D:IBSCR PAUSE Q:IBQ  D HDR
"RTN","IBNCPEV",223,0)
 Q
"RTN","IBNCPEV",224,0)
DAT(X,Y) Q $$DAT1^IBOUTL(X,.Y)
"RTN","IBNCPEV",225,0)
TIM(X) N IBT ;time
"RTN","IBNCPEV",226,0)
 S IBT=$$DAT1^IBOUTL(X,1) I $L(IBT," ")<3 Q IBT
"RTN","IBNCPEV",227,0)
 I $P(IBT," ",3)="pm" S IBT=$P(IBT," ",1,2)_"p" Q IBT
"RTN","IBNCPEV",228,0)
 I $P(IBT," ",3)="am" S IBT=$P(IBT," ",1,2)_"a" Q IBT
"RTN","IBNCPEV",229,0)
 Q IBT
"RTN","IBNCPEV",230,0)
 ;
"RTN","IBNCPEV",231,0)
USR(X) ;
"RTN","IBNCPEV",232,0)
 I $D(^VA(200,+X,0)) Q $P(^(0),U)
"RTN","IBNCPEV",233,0)
 Q X
"RTN","IBNCPEV",234,0)
 ;
"RTN","IBNCPEV",235,0)
PAT(DFN) ;
"RTN","IBNCPEV",236,0)
 Q $P($G(^DPT(DFN,0),"?"),"^")
"RTN","IBNCPEV",237,0)
BILL(BN) ;
"RTN","IBNCPEV",238,0)
 Q $P($G(^DGCR(399,BN,0),"?"),"^")
"RTN","IBNCPEV",239,0)
ARBILL(BN) ;
"RTN","IBNCPEV",240,0)
 Q $P($G(^PRCA(430,BN,0),"?"),"^")
"RTN","IBNCPEV",241,0)
 ;/*
"RTN","IBNCPEV",242,0)
 ;Returns 
"RTN","IBNCPEV",243,0)
 ;return DRUG name (#50,.01)
"RTN","IBNCPEV",244,0)
 ;IBDFN - IEN in PATIENT file #2
"RTN","IBNCPEV",245,0)
 ;IBRX - IEN in PRESCRIPTION file #52
"RTN","IBNCPEV",246,0)
DRUG(IBDFN,IBRX) ;
"RTN","IBNCPEV",247,0)
 I +$G(IBDFN)=0 Q ""
"RTN","IBNCPEV",248,0)
 N X1
"RTN","IBNCPEV",249,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPEV",250,0)
 D RX^PSO52API(IBDFN,"IBNCPDP52",IBRX,"",0)
"RTN","IBNCPEV",251,0)
 S X1=+$G(^TMP($J,"IBNCPDP52",IBDFN,IBRX,6))
"RTN","IBNCPEV",252,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPEV",253,0)
 I X1=0 Q ""
"RTN","IBNCPEV",254,0)
 Q $$DRUGNAM^IBNCPEV1(X1)
"RTN","IBNCPEV",255,0)
 ;
"RTN","IBNCPEV",256,0)
EVNT(X) ;Transl
"RTN","IBNCPEV",257,0)
 I X="BILL" Q "BILLING"
"RTN","IBNCPEV",258,0)
 I X="REVERSE" Q "REVERSAL"
"RTN","IBNCPEV",259,0)
 I X="AUTO REVERSE" Q "REVERSAL(A)"
"RTN","IBNCPEV",260,0)
 I X["RELEASE" Q "RELEASE"
"RTN","IBNCPEV",261,0)
 I X["SUBMIT" Q "SUBMIT"
"RTN","IBNCPEV",262,0)
 I X["CLOSE" Q "CLOSE"
"RTN","IBNCPEV",263,0)
 I X[IBSC Q "FINISH"  ;IBSC = "STATUS CHECK"
"RTN","IBNCPEV",264,0)
 Q X
"RTN","IBNCPEV",265,0)
 ;
"RTN","IBNCPEV",266,0)
BOCD(X) ;Basis of Cost Determ
"RTN","IBNCPEV",267,0)
 I +X=7 Q "USUAL & CUSTOMARY"
"RTN","IBNCPEV",268,0)
 I +X=1 Q "AWP"
"RTN","IBNCPEV",269,0)
 I +X=5 Q "COST CALCULATIONS"
"RTN","IBNCPEV",270,0)
 Q X
"RTN","IBNCPEV",271,0)
 ;
"RTN","IBNCPEV",272,0)
PAUSE ;
"RTN","IBNCPEV",273,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" IBQ=1
"RTN","IBNCPEV",274,0)
 U IO
"RTN","IBNCPEV",275,0)
 Q
"RTN","IBNCPEV",276,0)
 ;
"RTN","IBNCPEV",277,0)
SUBHDR ;
"RTN","IBNCPEV",278,0)
 W !?10,"ECME# ",$P(IBD1,U,3),",",?25,"FILL DATE:",$$DAT($P(IBD2,U,6))
"RTN","IBNCPEV",279,0)
 D RELT($P(IBD2,U,7))
"RTN","IBNCPEV",280,0)
 Q
"RTN","IBNCPEV",281,0)
DISPUSR ;
"RTN","IBNCPEV",282,0)
 W !?10,"USER:",$$USR(+$P(IBD3,U,10))
"RTN","IBNCPEV",283,0)
 Q
"RTN","IBNCPEV",284,0)
 ;
"RTN","IBNCPEV",285,0)
 ;/*
"RTN","IBNCPEV",286,0)
 ;Returns RX number (external value: #52,.01)
"RTN","IBNCPEV",287,0)
 ;IBRX - IEN in PRESCRIPTION file #52
"RTN","IBNCPEV",288,0)
RXNUM(IBRX) ;*/
"RTN","IBNCPEV",289,0)
 Q $$RXAPI1^IBNCPUT1(IBRX,.01,"E")
"RTN","IBNCPEV",290,0)
 ;
"RTN","IBNCPEV",291,0)
 ;IBNCPEV
"RTN","IBNCPEV1")
0^18^B46001454
"RTN","IBNCPEV1",1,0)
IBNCPEV1 ;DALOI/SS - NCPDP BILLING EVENTS REPORT ;21-MAR-2006
"RTN","IBNCPEV1",2,0)
 ;;2.0;INTEGRATED BILLING;**342,339,363**;21-MAR-94;Build 35
"RTN","IBNCPEV1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPEV1",4,0)
 ;
"RTN","IBNCPEV1",5,0)
 ;IA# 10155 is used to read ^DD(file,field,0) node
"RTN","IBNCPEV1",6,0)
 Q
"RTN","IBNCPEV1",7,0)
 ;
"RTN","IBNCPEV1",8,0)
SETVARS ;
"RTN","IBNCPEV1",9,0)
 ;newed in IBNCPEV
"RTN","IBNCPEV1",10,0)
 S (IBECME,IBPAT,IBRX,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS)=0
"RTN","IBNCPEV1",11,0)
 ;date
"RTN","IBNCPEV1",12,0)
 F  D DATE^IBNCPDPE Q:IBQ  Q:$$TESTDATA^IBNCPDPE
"RTN","IBNCPEV1",13,0)
 Q:IBQ
"RTN","IBNCPEV1",14,0)
 N IBMLTDV S IBMLTDV=$$MULTPHRM^BPSUTIL()
"RTN","IBNCPEV1",15,0)
 I +IBMLTDV=1 S IBDIVS=+$$MULTIDIV(.IBDIVS) S:IBDIVS=0 IBDIVS(0)="0^ALL" I IBDIVS=-1 S IBQ=1 Q
"RTN","IBNCPEV1",16,0)
 I +IBMLTDV=0 S IBDIVS=0,IBDIVS(0)="0^"_$P(IBMLTDV,U,2)
"RTN","IBNCPEV1",17,0)
 D MODE^IBNCPDPE Q:IBQ
"RTN","IBNCPEV1",18,0)
 D DEVICE^IBNCPDPE Q:IBQ
"RTN","IBNCPEV1",19,0)
 Q
"RTN","IBNCPEV1",20,0)
 ;
"RTN","IBNCPEV1",21,0)
 ;/**
"RTN","IBNCPEV1",22,0)
 ; input - 
"RTN","IBNCPEV1",23,0)
 ;   IBECMENO = ECME #
"RTN","IBNCPEV1",24,0)
 ;   IBST = start date (FM format)
"RTN","IBNCPEV1",25,0)
 ;   IBEND = end date (FM format)
"RTN","IBNCPEV1",26,0)
 ; output - returns internal entry number of file #52 for the earliest date within the date range
"RTN","IBNCPEV1",27,0)
GETRX(IBECMENO,IBST,IBEND) ; get ien of file 52 from #366.14
"RTN","IBNCPEV1",28,0)
 ; array from where the ECME BILLING EVENTS report gets its data
"RTN","IBNCPEV1",29,0)
 ;  This subroutine is called when the user enters an ECME# as
"RTN","IBNCPEV1",30,0)
 ;  part of the search criteria
"RTN","IBNCPEV1",31,0)
 N IBDATE,IBNO,IBIEN
"RTN","IBNCPEV1",32,0)
 S IBDATE=+$O(^IBCNR(366.14,"E",IBECMENO,IBST-1))
"RTN","IBNCPEV1",33,0)
 I IBDATE=0 Q 0
"RTN","IBNCPEV1",34,0)
 I IBDATE>IBEND Q 0
"RTN","IBNCPEV1",35,0)
 S IBNO=+$O(^IBCNR(366.14,"E",IBECMENO,IBDATE,0))
"RTN","IBNCPEV1",36,0)
 I IBNO=0 Q 0
"RTN","IBNCPEV1",37,0)
 S IBIEN=$O(^IBCNR(366.14,"B",IBDATE,0))
"RTN","IBNCPEV1",38,0)
 Q +$P($G(^IBCNR(366.14,IBIEN,1,IBNO,2)),U)
"RTN","IBNCPEV1",39,0)
 ;
"RTN","IBNCPEV1",40,0)
 ;/**
"RTN","IBNCPEV1",41,0)
 ;finish
"RTN","IBNCPEV1",42,0)
 ;input:
"RTN","IBNCPEV1",43,0)
 ;IBD2 - node ^IBCNR(366.14,D0,1,D1,2)
"RTN","IBNCPEV1",44,0)
 ;IBD3 - node ^IBCNR(366.14,D0,1,D1,3)
"RTN","IBNCPEV1",45,0)
 ;IBD4 - node ^IBCNR(366.14,D0,1,D1,4)
"RTN","IBNCPEV1",46,0)
 ;IBINS - multiple of ^IBCNR(366.14,D0,1,D1,5)
"RTN","IBNCPEV1",47,0)
DSTAT(IBD2,IBD3,IBD4,IBINS) ;
"RTN","IBNCPEV1",48,0)
 N IBX,IBT,IBSC,IB1ST,IBNXT,IBEXMPV
"RTN","IBNCPEV1",49,0)
 S IB1ST=1
"RTN","IBNCPEV1",50,0)
 D CHKP^IBNCPEV Q:IBQ
"RTN","IBNCPEV1",51,0)
 W !?10,"ELIGIBILITY: "
"RTN","IBNCPEV1",52,0)
 F IBX=2:1 S IBT=$P($T(EXEMPT+IBX^IBNCPDP1),";",3),IBSC=$P(IBT,U,2) Q:IBSC=""  S IBEXMPV=$$EXMPFLDS(IBSC,IBD4) D:IBEXMPV]""  Q:IBQ!(IBEXMPV=3)
"RTN","IBNCPEV1",53,0)
 . I IBEXMPV=3 W "overridden by the user" Q
"RTN","IBNCPEV1",54,0)
 . I 'IB1ST W "," I $X>70 D CHKP^IBNCPEV Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPEV1",55,0)
 . W " ",IBSC,":",$S(IBEXMPV=1:"Yes",IBEXMPV=0:"No",IBEXMPV=2:"No Answer",1:"?") S IB1ST=0
"RTN","IBNCPEV1",56,0)
 Q:IBQ
"RTN","IBNCPEV1",57,0)
 I $P(IBD2,U,4) D CHKP^IBNCPEV Q:IBQ  W !?10,"DRUG:",$$DRUGNAM(+$P(IBD2,U,4))
"RTN","IBNCPEV1",58,0)
 D CHKP^IBNCPEV Q:IBQ  W !?10
"RTN","IBNCPEV1",59,0)
 W "NDC:",$S($P(IBD2,U,5):$P(IBD2,U,5),1:"No"),", BILLED QTY:",$S($P(IBD2,U,8):$P(IBD2,U,8),1:"No"),", COST:",$S($P(IBD3,U,4):$P(IBD3,U,4),1:"No")
"RTN","IBNCPEV1",60,0)
 I $P(IBD2,U,10)]"" W ", DEA:",$P(IBD2,U,10)
"RTN","IBNCPEV1",61,0)
 S IBX=0,IBNXT=0 F  S IBX=$O(IBINS(IBX)) Q:'IBX  D  Q:IBQ  S IBNXT=1
"RTN","IBNCPEV1",62,0)
 .N Y S Y=$P(IBINS(IBX,0),U,2,8) W:'Y "@@@@" Q:'Y
"RTN","IBNCPEV1",63,0)
 .I IBNXT D CHKP^IBNCPEV Q:IBQ  W !?10,"-----------"
"RTN","IBNCPEV1",64,0)
 .D CHKP^IBNCPEV Q:IBQ  W !?10
"RTN","IBNCPEV1",65,0)
 .W "PLAN:",$P($G(^IBA(355.3,+Y,0)),U,3),"  "
"RTN","IBNCPEV1",66,0)
 .W "INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+Y,0)),0)),U)
"RTN","IBNCPEV1",67,0)
 .D CHKP^IBNCPEV Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPEV1",68,0)
 .I $P(Y,U,2)]"" W "BIN:",$P(Y,U,2) S IB1ST=0
"RTN","IBNCPEV1",69,0)
 .I $P(Y,U,3)]"" W:'IB1ST ", " W "PCN:",$P(Y,U,3) S IB1ST=0
"RTN","IBNCPEV1",70,0)
 .I $P(Y,U,4)]"" W:'IB1ST ", " W "PAYER SHEET B1:",$P(Y,U,4) S IB1ST=0
"RTN","IBNCPEV1",71,0)
 .D CHKP^IBNCPEV Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPEV1",72,0)
 .S Y=IBINS(IBX,1)
"RTN","IBNCPEV1",73,0)
 .I $P(Y,U,4)]"" W "PAYER SHEET B2:",$P(Y,U,4) S IB1ST=0
"RTN","IBNCPEV1",74,0)
 .I $P(Y,U,5)]"" W:'IB1ST ", " W "PAYER SHEET B3:",$P(Y,U,5)
"RTN","IBNCPEV1",75,0)
 .;S Y=$G(Z1("INS",IBX,2)) Q:Y=""
"RTN","IBNCPEV1",76,0)
 .S Y=IBINS(IBX,2) Q:Y=""
"RTN","IBNCPEV1",77,0)
 .D CHKP^IBNCPEV Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPEV1",78,0)
 .I $P(Y,U)]"" W "DISPENSING FEE:",$P(Y,U) S IB1ST=0
"RTN","IBNCPEV1",79,0)
 .I $P(Y,U,2)]"" W:'IB1ST ", " W "BASIS OF COST DETERM:",$$BOCD^IBNCPEV($P(Y,U,2)) S IB1ST=0
"RTN","IBNCPEV1",80,0)
 .D CHKP^IBNCPEV Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPEV1",81,0)
 .I $P(Y,U,3)]"" W "COST:",$J($P(Y,U,3),0,2) S IB1ST=0
"RTN","IBNCPEV1",82,0)
 .I $P(Y,U,4)]"" W:'IB1ST ", " W "GROSS AMT DUE:",$J($P(Y,U,4),0,2) S IB1ST=0
"RTN","IBNCPEV1",83,0)
 .I $P(Y,U,5)]"" W:'IB1ST ", " W "ADMIN FEE:",$J($P(Y,U,5),0,2)
"RTN","IBNCPEV1",84,0)
 Q:IBQ
"RTN","IBNCPEV1",85,0)
 ;
"RTN","IBNCPEV1",86,0)
 D CHKP^IBNCPEV Q:IBQ
"RTN","IBNCPEV1",87,0)
 W !?10,"USER:",$$USR^IBNCPEV(+$P(IBD3,U,10))
"RTN","IBNCPEV1",88,0)
 Q
"RTN","IBNCPEV1",89,0)
 ;
"RTN","IBNCPEV1",90,0)
 ;get Exemption status by name
"RTN","IBNCPEV1",91,0)
 ;IBEXMP - exemption (like "AO","EC", etc)
"RTN","IBNCPEV1",92,0)
 ;IBNODE - node ^IBCNR(366.14,D0,1,D1,4)
"RTN","IBNCPEV1",93,0)
EXMPFLDS(IBEXMP,IBNODE) ;
"RTN","IBNCPEV1",94,0)
 Q:IBEXMP="AO" $P(IBNODE,U,1)
"RTN","IBNCPEV1",95,0)
 Q:IBEXMP="CV" $P(IBNODE,U,2)
"RTN","IBNCPEV1",96,0)
 Q:IBEXMP="SWA" $P(IBNODE,U,3)
"RTN","IBNCPEV1",97,0)
 Q:IBEXMP="IR" $P(IBNODE,U,4)
"RTN","IBNCPEV1",98,0)
 Q:IBEXMP="MST" $P(IBNODE,U,5)
"RTN","IBNCPEV1",99,0)
 Q:IBEXMP="HNC" $P(IBNODE,U,6)
"RTN","IBNCPEV1",100,0)
 Q:IBEXMP="SC" $P(IBNODE,U,7)
"RTN","IBNCPEV1",101,0)
 Q:IBEXMP="SHAD" $P(IBNODE,U,8)
"RTN","IBNCPEV1",102,0)
 Q ""
"RTN","IBNCPEV1",103,0)
 ;returns DFN from file #366.14 by prescription ien of file #50
"RTN","IBNCPEV1",104,0)
GETDFN(IBRX) ;
"RTN","IBNCPEV1",105,0)
 N IB1,IB2
"RTN","IBNCPEV1",106,0)
 S IB1=+$O(^IBCNR(366.14,"I",IBRX,0))
"RTN","IBNCPEV1",107,0)
 I IB1=0 Q 0
"RTN","IBNCPEV1",108,0)
 S IB2=+$O(^IBCNR(366.14,"I",IBRX,IB1,0))
"RTN","IBNCPEV1",109,0)
 I IB2=0 Q 0
"RTN","IBNCPEV1",110,0)
 Q +$P($G(^IBCNR(366.14,IB1,1,IB2,0)),U,3)
"RTN","IBNCPEV1",111,0)
 ;
"RTN","IBNCPEV1",112,0)
 ;return DRUG name (#50,.01)
"RTN","IBNCPEV1",113,0)
 ;IBX1 - ien in file #50
"RTN","IBNCPEV1",114,0)
DRUGNAM(IBX1) ;
"RTN","IBNCPEV1",115,0)
 ;Q $P($G(^PSDRUG(IBX1,0)),U)
"RTN","IBNCPEV1",116,0)
 N X
"RTN","IBNCPEV1",117,0)
 K ^TMP($J,"IBNCPDP50")
"RTN","IBNCPEV1",118,0)
 D DATA^PSS50(IBX1,"","","","","IBNCPDP50")
"RTN","IBNCPEV1",119,0)
 S X=$G(^TMP($J,"IBNCPDP50",IBX1,.01))
"RTN","IBNCPEV1",120,0)
 K ^TMP($J,"IBNCPDP50")
"RTN","IBNCPEV1",121,0)
 Q X
"RTN","IBNCPEV1",122,0)
 ;
"RTN","IBNCPEV1",123,0)
DRUGAPI(DRUGIEN,FLDNUM) ;
"RTN","IBNCPEV1",124,0)
 ;return a DRUG's field value
"RTN","IBNCPEV1",125,0)
 ;input:
"RTN","IBNCPEV1",126,0)
 ; DRUGIEN - ien #50
"RTN","IBNCPEV1",127,0)
 ; FLDNUM - field number (like .01)
"RTN","IBNCPEV1",128,0)
 ;output:
"RTN","IBNCPEV1",129,0)
 ; returned value that contains the external value of the specified field
"RTN","IBNCPEV1",130,0)
 N IBARR,DIQ,DIC
"RTN","IBNCPEV1",131,0)
 S DIQ="IBARR",DIQ(0)="E",DIC=50
"RTN","IBNCPEV1",132,0)
 D EN^PSSDI(50,"IB",DIC,.FLDNUM,.DRUGIEN,.DIQ)
"RTN","IBNCPEV1",133,0)
 Q $G(IBARR(50,DRUGIEN,FLDNUM,"E"))
"RTN","IBNCPEV1",134,0)
 ;
"RTN","IBNCPEV1",135,0)
 ;reopen
"RTN","IBNCPEV1",136,0)
REOPEN ;
"RTN","IBNCPEV1",137,0)
 D CHKP^IBNCPEV Q:IBQ
"RTN","IBNCPEV1",138,0)
 D SUBHDR^IBNCPEV
"RTN","IBNCPEV1",139,0)
 I +$P(IBD3,U,3) D CHKP^IBNCPEV Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV1",140,0)
 I $L($P(IBD3,U,6))>2 D CHKP^IBNCPEV Q:IBQ  W !?10,"REOPEN COMMENTS:",$P(IBD3,U,6)
"RTN","IBNCPEV1",141,0)
 D CHKP^IBNCPEV Q:IBQ
"RTN","IBNCPEV1",142,0)
 D DISPUSR^IBNCPEV
"RTN","IBNCPEV1",143,0)
 Q
"RTN","IBNCPEV1",144,0)
 ;
"RTN","IBNCPEV1",145,0)
 ;Prompts user to select miltiple divisions (BPS PHARMACIES)
"RTN","IBNCPEV1",146,0)
 ; in order to filter the report by division(s) or for ALL divisions
"RTN","IBNCPEV1",147,0)
 ; 
"RTN","IBNCPEV1",148,0)
 ;returns composite value:
"RTN","IBNCPEV1",149,0)
 ;1st piece
"RTN","IBNCPEV1",150,0)
 ; 1 - divisions were selected 
"RTN","IBNCPEV1",151,0)
 ; 0 - divisions were NOT selected 
"RTN","IBNCPEV1",152,0)
 ; -1 if upparrow entered or timeout
"RTN","IBNCPEV1",153,0)
 ;2nd piece
"RTN","IBNCPEV1",154,0)
 ; A-all or D - division(s) in the 
"RTN","IBNCPEV1",155,0)
 ;
"RTN","IBNCPEV1",156,0)
 ;and by reference:
"RTN","IBNCPEV1",157,0)
 ;IBPSPHAR (only if the user selects "D") - a local array with iens and names 
"RTN","IBNCPEV1",158,0)
 ;  of BPS PHARMACY(is) (file #9002313.56) selected by the user
"RTN","IBNCPEV1",159,0)
 ;  IBPSPHAR(ien of file #9002313.56) = ien of file #9002313.56 ^ name of the BPS PHARMACY
"RTN","IBNCPEV1",160,0)
 ;  
"RTN","IBNCPEV1",161,0)
MULTIDIV(IBPSPHAR) ;
"RTN","IBNCPEV1",162,0)
 N IBDIVCNT,IBANSW,IBRETV
"RTN","IBNCPEV1",163,0)
 S IBRETV=$$SELPHARM^BPSUTIL(.IBPSPHAR)
"RTN","IBNCPEV1",164,0)
 I IBRETV="^" Q -1  ;exit
"RTN","IBNCPEV1",165,0)
 I IBRETV="A" Q "0^A"
"RTN","IBNCPEV1",166,0)
 Q "1^D"
"RTN","IBNCPEV1",167,0)
 ;  
"RTN","IBNCPEV1",168,0)
 ;check if ePharmacy division in IB36614 in among those selected by the user
"RTN","IBNCPEV1",169,0)
 ;IBDIVS - a local array (by reference) with divisions selected by the user
"RTN","IBNCPEV1",170,0)
 ;returns 0 - not among selected divisions, 1 - among them
"RTN","IBNCPEV1",171,0)
CHECKDIV(IB36614,IBDIVS) ;
"RTN","IBNCPEV1",172,0)
 I $D(IBDIVS(IB36614)) Q 1
"RTN","IBNCPEV1",173,0)
 Q 0
"RTN","IBNCPEV1",174,0)
 ;
"RTN","IBNCPEV1",175,0)
 ;Compile the string for divisions
"RTN","IBNCPEV1",176,0)
 ;input:
"RTN","IBNCPEV1",177,0)
 ;IBDVS - division local array by reference
"RTN","IBNCPEV1",178,0)
 ;output: 
"RTN","IBNCPEV1",179,0)
 ; return value with the resulting string
"RTN","IBNCPEV1",180,0)
DISPLDIV(IBDVS) ;
"RTN","IBNCPEV1",181,0)
 I ('$D(IBDVS))!($G(IBDVS)="") Q ""  ;invalid parameters
"RTN","IBNCPEV1",182,0)
 I IBDVS=0 Q ""  ;if "all" or single division
"RTN","IBNCPEV1",183,0)
 N IBZ,IBCNT,IBDIVSTR
"RTN","IBNCPEV1",184,0)
 S IBDIVSTR=""
"RTN","IBNCPEV1",185,0)
 S IBZ=0,IBCNT=0
"RTN","IBNCPEV1",186,0)
 F  S IBZ=$O(IBDVS(IBZ)) Q:+IBZ=0  D
"RTN","IBNCPEV1",187,0)
 . I IBCNT>0 S IBDIVSTR=IBDIVSTR_", "
"RTN","IBNCPEV1",188,0)
 . S IBCNT=IBCNT+1
"RTN","IBNCPEV1",189,0)
 . S IBDIVSTR=IBDIVSTR_$P(IBDVS(IBZ),U,2)
"RTN","IBNCPEV1",190,0)
 I $L(IBDIVSTR)'<80 S IBDIVSTR=$E(IBDIVSTR,1,75)_"..."
"RTN","IBNCPEV1",191,0)
 Q $$CENTERIT(IBDIVSTR,80)
"RTN","IBNCPEV1",192,0)
 ;
"RTN","IBNCPEV1",193,0)
 ;Compile the string for title
"RTN","IBNCPEV1",194,0)
 ;input:
"RTN","IBNCPEV1",195,0)
 ;IBBDT - begin date
"RTN","IBNCPEV1",196,0)
 ;IBEDT - end date
"RTN","IBNCPEV1",197,0)
 ;IBDTL - summary/detail mode
"RTN","IBNCPEV1",198,0)
 ;IBDIVS - division local array by reference
"RTN","IBNCPEV1",199,0)
 ;output: 
"RTN","IBNCPEV1",200,0)
 ; return value with the resulting string
"RTN","IBNCPEV1",201,0)
DISPTITL(IBBDT,IBEDT,IBDTL,IBDIVS) ;
"RTN","IBNCPEV1",202,0)
 I ('$D(IBDIVS))!($G(IBDIVS)="")!($G(IBBDT)="")!($G(IBEDT)="")!($G(IBDTL)="") Q ""  ;invalid parameters
"RTN","IBNCPEV1",203,0)
 N IBTITL
"RTN","IBNCPEV1",204,0)
 S IBTITL="BILLING ECME EVENTS ON "_$$DAT^IBNCPEV(IBBDT)
"RTN","IBNCPEV1",205,0)
 I IBBDT'=IBEDT S IBTITL=IBTITL_" TO "_$$DAT^IBNCPEV(IBEDT)
"RTN","IBNCPEV1",206,0)
 S IBTITL=IBTITL_" ("_$S(IBDTL:"DETAILED",1:"SUMMARY")_") for "
"RTN","IBNCPEV1",207,0)
 I IBDIVS'=0 S IBTITL=IBTITL_"SELECTED DIVISIONS:"
"RTN","IBNCPEV1",208,0)
 I IBDIVS=0 S IBTITL=IBTITL_$P(IBDIVS(0),U,2)_" DIVISION" I $P(IBDIVS(0),U,2)="ALL" S IBTITL=IBTITL_"S"
"RTN","IBNCPEV1",209,0)
 Q $$CENTERIT(IBTITL,80)
"RTN","IBNCPEV1",210,0)
 ;
"RTN","IBNCPEV1",211,0)
 ;Center the string (add left pads to center the string)
"RTN","IBNCPEV1",212,0)
 ;input:
"RTN","IBNCPEV1",213,0)
 ;IBSTR - input string
"RTN","IBNCPEV1",214,0)
 ;IBMAXLEN - max len
"RTN","IBNCPEV1",215,0)
 ;output: 
"RTN","IBNCPEV1",216,0)
 ; return value with the resulting string
"RTN","IBNCPEV1",217,0)
CENTERIT(IBSTR,IBMAXLEN) ;
"RTN","IBNCPEV1",218,0)
 I ($G(IBSTR)="")!(+$G(IBMAXLEN)=0) Q ""
"RTN","IBNCPEV1",219,0)
 N IBLEFT,IBSP
"RTN","IBNCPEV1",220,0)
 S IBSTR=$E(IBSTR,1,IBMAXLEN)
"RTN","IBNCPEV1",221,0)
 S IBLEFT=((IBMAXLEN-$L(IBSTR))/2)\1
"RTN","IBNCPEV1",222,0)
 S IBSP=""
"RTN","IBNCPEV1",223,0)
 S $P(IBSP," ",IBLEFT+1)=""
"RTN","IBNCPEV1",224,0)
 Q IBSP_IBSTR
"RTN","IBNCPEV1",225,0)
 ;Get list of indicators that were not answered
"RTN","IBNCPEV1",226,0)
GETNOANS(IBD4) ;
"RTN","IBNCPEV1",227,0)
 N IBX,IBT,IBSC,IBEXMPV,IBQ,IBRET
"RTN","IBNCPEV1",228,0)
 S IBQ=0,IBRET=""
"RTN","IBNCPEV1",229,0)
 F IBX=2:1 S IBT=$P($T(EXEMPT+IBX^IBNCPDP1),";",3),IBSC=$P(IBT,U,2) Q:IBSC=""  S IBEXMPV=$$EXMPFLDS^IBNCPEV1(IBSC,IBD4) D:IBEXMPV]""
"RTN","IBNCPEV1",230,0)
 . I IBEXMPV=2 S IBRET=IBRET_","_IBSC
"RTN","IBNCPEV1",231,0)
 Q $S(IBRET="":"SC",1:$E(IBRET,2,99))
"RTN","IBNCPEV1",232,0)
 ;IBNCPEV1
"RTN","IBNCPLOG")
0^19^B61207907
"RTN","IBNCPLOG",1,0)
IBNCPLOG ;BHAM ISC/SS - IB ECME EVNT REPORT ;22-MAR-2006
"RTN","IBNCPLOG",2,0)
 ;;2.0;INTEGRATED BILLING;**342,339,363**;21-MAR-94;Build 35
"RTN","IBNCPLOG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPLOG",4,0)
 ;
"RTN","IBNCPLOG",5,0)
 ;store data related to the IB calls made by ECME package in the file #366.14
"RTN","IBNCPLOG",6,0)
 ;input:
"RTN","IBNCPLOG",7,0)
 ;.IBIBD - (by referrence) IBD array with parameter sent to IB by ECME
"RTN","IBNCPLOG",8,0)
 ;DFN patient's ien
"RTN","IBNCPLOG",9,0)
 ;IBPROC - type of event. i.e. content of CALL such as BILL, REJECT and so on
"RTN","IBNCPLOG",10,0)
 ;IBRESULT - (optional) result of the event processing, format: return_code^message
"RTN","IBNCPLOG",11,0)
 ;IBJOB - (optional) job, default = $J
"RTN","IBNCPLOG",12,0)
 ;IBDTTM - (optional) datetime, default = "NOW" 
"RTN","IBNCPLOG",13,0)
 ;IBUSR - (optional) user ID, default = DUZ
"RTN","IBNCPLOG",14,0)
 ;output:
"RTN","IBNCPLOG",15,0)
 ;none
"RTN","IBNCPLOG",16,0)
LOG(IBIBD,DFN,IBPROC,IBRESULT,IBJOB,IBDTTM,IBUSR) ;Store the data
"RTN","IBNCPLOG",17,0)
 N NDX,Z,REF,IBDATE,IBDTIEN,IBEVNIEN,IBIBDTYP,IBRETV
"RTN","IBNCPLOG",18,0)
 S IBRESULT=$G(IBRESULT)
"RTN","IBNCPLOG",19,0)
 ;
"RTN","IBNCPLOG",20,0)
 I '$G(IBJOB) S IBJOB=$J
"RTN","IBNCPLOG",21,0)
 I '$G(IBDTTM) S IBDTTM=$$NOW^XLFDT()
"RTN","IBNCPLOG",22,0)
 I '$G(IBUSR) S IBUSR=+DUZ
"RTN","IBNCPLOG",23,0)
 ;       
"RTN","IBNCPLOG",24,0)
 S IBDATE=DT
"RTN","IBNCPLOG",25,0)
 S IBDTIEN=+$O(^IBCNR(366.14,"B",IBDATE,0))
"RTN","IBNCPLOG",26,0)
 L +^IBCNR(366.14):30 E  Q
"RTN","IBNCPLOG",27,0)
 I IBDTIEN=0 S IBDTIEN=+$$ADDDATE(IBDATE)
"RTN","IBNCPLOG",28,0)
 ;create an event
"RTN","IBNCPLOG",29,0)
 S IBEVNIEN=$$NEWEVENT(IBDTIEN,IBPROC)
"RTN","IBNCPLOG",30,0)
 L -^IBCNR(366.14)
"RTN","IBNCPLOG",31,0)
 I IBEVNIEN=0 W !,"New event creation Error : LOG^IBNCPLOG",! Q
"RTN","IBNCPLOG",32,0)
 ;
"RTN","IBNCPLOG",33,0)
 I +$$FILLFLDS^IBNCPUT1(366.141,".03",IBEVNIEN_","_IBDTIEN,DFN) ;DFN
"RTN","IBNCPLOG",34,0)
 I +$$FILLFLDS^IBNCPUT1(366.141,".04",IBEVNIEN_","_IBDTIEN,IBJOB) ;JOB
"RTN","IBNCPLOG",35,0)
 I +$$FILLFLDS^IBNCPUT1(366.141,".05",IBEVNIEN_","_IBDTIEN,IBDTTM) ;DATETIME
"RTN","IBNCPLOG",36,0)
 I +$$FILLFLDS^IBNCPUT1(366.141,".06",IBEVNIEN_","_IBDTIEN,DUZ) ;USER
"RTN","IBNCPLOG",37,0)
 I IBRESULT'="" D
"RTN","IBNCPLOG",38,0)
 . S IBRETV=+$$FILLFLDS^IBNCPUT1(366.141,".07",IBEVNIEN_","_IBDTIEN,+IBRESULT) ;RESULT
"RTN","IBNCPLOG",39,0)
 . S IBRETV=+$$FILLFLDS^IBNCPUT1(366.141,".08",IBEVNIEN_","_IBDTIEN,$P(IBRESULT,U,2)) ;RESULT MESSAGE
"RTN","IBNCPLOG",40,0)
 ;store IBIBD array
"RTN","IBNCPLOG",41,0)
 S IBIBDTYP=""
"RTN","IBNCPLOG",42,0)
 F  S IBIBDTYP=$O(IBIBD(IBIBDTYP)) Q:IBIBDTYP=""  D
"RTN","IBNCPLOG",43,0)
 . D IBD(IBDTIEN,IBEVNIEN,IBIBDTYP,$G(IBIBD(IBIBDTYP)),.IBIBD)
"RTN","IBNCPLOG",44,0)
 ;store "INS" node of IBIBD array
"RTN","IBNCPLOG",45,0)
 I $D(IBIBD("INS")) I $$INS(.IBIBD,IBDTIEN,IBEVNIEN)
"RTN","IBNCPLOG",46,0)
 Q
"RTN","IBNCPLOG",47,0)
 ;
"RTN","IBNCPLOG",48,0)
 ;store IBD array data 
"RTN","IBNCPLOG",49,0)
 ;IBDTIEN -  ien on top [DATE] level  
"RTN","IBNCPLOG",50,0)
 ;IBRECNO - ien in [EVENTS] multiple
"RTN","IBNCPLOG",51,0)
 ;IBIBDTYP - type subscript in IBD array (BILL, PAID, RESPONSE, etc)
"RTN","IBNCPLOG",52,0)
 ;IBVAL - value to store
"RTN","IBNCPLOG",53,0)
 ;IBIBD - array with data passed by reference (for efficiency)
"RTN","IBNCPLOG",54,0)
IBD(IBDTIEN,IBRECNO,IBIBDTYP,IBVAL,IBIBD) ;
"RTN","IBNCPLOG",55,0)
 N IBFLDNO
"RTN","IBNCPLOG",56,0)
 ;W !," - ",IBRECNO," ",IBIBDTYP," = ",IBVAL
"RTN","IBNCPLOG",57,0)
 ;free text like "WEBMD: PAID"
"RTN","IBNCPLOG",58,0)
 I IBIBDTYP="AUTH #" S IBFLDNO=".11",IBVAL=$E(IBVAL,1,30) G EDITIBD
"RTN","IBNCPLOG",59,0)
 ;free text like "0504597;3051229"
"RTN","IBNCPLOG",60,0)
 I IBIBDTYP="BCID" S IBFLDNO=".12" G EDITIBD
"RTN","IBNCPLOG",61,0)
 ;7 digits ECME number - identifier (stored as a text - might have leading zeroes)
"RTN","IBNCPLOG",62,0)
 I IBIBDTYP="CLAIMID" S IBFLDNO=".13" G EDITIBD
"RTN","IBNCPLOG",63,0)
 ;pointer to file #2
"RTN","IBNCPLOG",64,0)
 I IBIBDTYP="DFN" S IBFLDNO=".14" G EDITIBD
"RTN","IBNCPLOG",65,0)
 ;pointer to file #40.8
"RTN","IBNCPLOG",66,0)
 I IBIBDTYP="DIVISION" S IBFLDNO=".15" G EDITIBD
"RTN","IBNCPLOG",67,0)
 ;free text
"RTN","IBNCPLOG",68,0)
 I IBIBDTYP="RESPONSE" S IBFLDNO=".16",IBVAL=$E(IBVAL,1,20) G EDITIBD
"RTN","IBNCPLOG",69,0)
 ;free text
"RTN","IBNCPLOG",70,0)
 I IBIBDTYP="REVERSAL REASON" S IBFLDNO=".17",IBVAL=$E(IBVAL,1,40) G EDITIBD
"RTN","IBNCPLOG",71,0)
 ;1 digit number
"RTN","IBNCPLOG",72,0)
 I IBIBDTYP="RTS-DEL" S IBFLDNO=".18" G EDITIBD
"RTN","IBNCPLOG",73,0)
 ;free text 
"RTN","IBNCPLOG",74,0)
 I IBIBDTYP="STATUS" S IBFLDNO=".19",IBVAL=$E(IBVAL,1,20) G EDITIBD
"RTN","IBNCPLOG",75,0)
 ;Prescription number as a text, might have alpha characters (external value, this is not IEN)
"RTN","IBNCPLOG",76,0)
 I IBIBDTYP="RX NO" S IBFLDNO=".202",IBVAL=$E(IBVAL,1,20) G EDITIBD
"RTN","IBNCPLOG",77,0)
 ;0 - original, 1,2,3,... - refill number
"RTN","IBNCPLOG",78,0)
 I IBIBDTYP="FILL NUMBER" S IBFLDNO=".203" G EDITIBD
"RTN","IBNCPLOG",79,0)
 ;internal identifier number for a DRUG
"RTN","IBNCPLOG",80,0)
 I IBIBDTYP="DRUG" S IBFLDNO=".204" G EDITIBD
"RTN","IBNCPLOG",81,0)
 I IBIBDTYP="NDC" S IBFLDNO=".205" G EDITIBD
"RTN","IBNCPLOG",82,0)
 I IBIBDTYP="FILL DATE" S IBFLDNO=".206" G EDITIBD
"RTN","IBNCPLOG",83,0)
 I IBIBDTYP="RELEASE DATE" S IBFLDNO=".207" G EDITIBD
"RTN","IBNCPLOG",84,0)
 I IBIBDTYP="QTY" S IBFLDNO=".208" G EDITIBD
"RTN","IBNCPLOG",85,0)
 I IBIBDTYP="DAYS SUPPLY" S IBFLDNO=".209" G EDITIBD
"RTN","IBNCPLOG",86,0)
 I IBIBDTYP="DEA" S IBFLDNO=".21" G EDITIBD
"RTN","IBNCPLOG",87,0)
 I IBIBDTYP="FILLED BY" S IBFLDNO=".211" G EDITIBD
"RTN","IBNCPLOG",88,0)
 ; for environmental indicators:
"RTN","IBNCPLOG",89,0)
 ; if IBIBD("SC/EI OVR")=1 - the user overrides any answers (3) 
"RTN","IBNCPLOG",90,0)
 ; if $G(IBIBD("SC/EI NO ANSW")) contains the IBIBDTYP - this question was not answered (2)
"RTN","IBNCPLOG",91,0)
 ; otherwise - use whatever in the IBVAL (0 - NO, 1 -YES) 
"RTN","IBNCPLOG",92,0)
 I IBIBDTYP="AO" S IBFLDNO=".401",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",93,0)
 I IBIBDTYP="CV" S IBFLDNO=".402",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",94,0)
 I IBIBDTYP="SWA" S IBFLDNO=".403",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",95,0)
 I IBIBDTYP="IR" S IBFLDNO=".404",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",96,0)
 I IBIBDTYP="MST" S IBFLDNO=".405",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",97,0)
 I IBIBDTYP="HNC" S IBFLDNO=".406",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",98,0)
 I IBIBDTYP="SC" S IBFLDNO=".407",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",99,0)
 I IBIBDTYP="SHAD" S IBFLDNO=".408",IBVAL=$S($G(IBIBD("SC/EI OVR"))=1:3,(","_$G(IBIBD("SC/EI NO ANSW"))_",")[(","_IBIBDTYP_","):2,1:IBVAL) G EDITIBD
"RTN","IBNCPLOG",100,0)
 I IBIBDTYP="BILL" S IBFLDNO=".301" G EDITIBD
"RTN","IBNCPLOG",101,0)
 I IBIBDTYP="BILLED" S IBFLDNO=".302" G EDITIBD
"RTN","IBNCPLOG",102,0)
 I IBIBDTYP="PLAN" S IBFLDNO=".303" G EDITIBD
"RTN","IBNCPLOG",103,0)
 I IBIBDTYP="COST" S IBFLDNO=".304" G EDITIBD
"RTN","IBNCPLOG",104,0)
 I IBIBDTYP="PAID" S IBFLDNO=".305" G EDITIBD
"RTN","IBNCPLOG",105,0)
 I IBIBDTYP="CLOSE COMMENT" S IBFLDNO=".306" G EDITIBD
"RTN","IBNCPLOG",106,0)
 I IBIBDTYP="REOPEN COMMENT" S IBFLDNO=".306" G EDITIBD
"RTN","IBNCPLOG",107,0)
 I IBIBDTYP="CLOSE REASON" S IBFLDNO=".307" G EDITIBD
"RTN","IBNCPLOG",108,0)
 I IBIBDTYP="DROP TO PAPER" S IBFLDNO=".308" G EDITIBD
"RTN","IBNCPLOG",109,0)
 I IBIBDTYP="RELEASE COPAY" S IBFLDNO=".309" G EDITIBD
"RTN","IBNCPLOG",110,0)
 I IBIBDTYP="USER" S IBFLDNO=".31" G EDITIBD
"RTN","IBNCPLOG",111,0)
 I IBIBDTYP="PRESCRIPTION" S IBFLDNO=".201" G EDITIBD
"RTN","IBNCPLOG",112,0)
 I IBIBDTYP="IEN" S IBFLDNO=".212" G EDITIBD
"RTN","IBNCPLOG",113,0)
 I IBIBDTYP="EPHARM" S IBFLDNO=".09" G EDITIBD
"RTN","IBNCPLOG",114,0)
 Q 0
"RTN","IBNCPLOG",115,0)
EDITIBD ;
"RTN","IBNCPLOG",116,0)
 Q +$$FILLFLDS^IBNCPUT1(366.141,IBFLDNO,IBRECNO_","_IBDTIEN,IBVAL)
"RTN","IBNCPLOG",117,0)
 ;------
"RTN","IBNCPLOG",118,0)
 ;to store IBD("INS") array data
"RTN","IBNCPLOG",119,0)
 ;input:
"RTN","IBNCPLOG",120,0)
 ;IBDARR - IBD array by reference
"RTN","IBNCPLOG",121,0)
 ;IBDTIEN -  ien on top [DATE] level  
"RTN","IBNCPLOG",122,0)
 ;IBRECNO - ien in [EVENTS] multiple
"RTN","IBNCPLOG",123,0)
 ;output:
"RTN","IBNCPLOG",124,0)
 ; record number if success
"RTN","IBNCPLOG",125,0)
 ; 0 if failure
"RTN","IBNCPLOG",126,0)
INS(IBDARR,IBDTIEN,IBRECNO) ;
"RTN","IBNCPLOG",127,0)
 N IBSET1,IBSET2,IBSET3,IBFLDNO,IBINSNO,RECNO,IBVAL
"RTN","IBNCPLOG",128,0)
 S IBINSNO=0
"RTN","IBNCPLOG",129,0)
 F  S IBINSNO=$O(IBDARR("INS",IBINSNO)) Q:+IBINSNO=0  D
"RTN","IBNCPLOG",130,0)
 . S IBSET1=$G(IBDARR("INS",IBINSNO,1))
"RTN","IBNCPLOG",131,0)
 . S IBSET2=$G(IBDARR("INS",IBINSNO,2))
"RTN","IBNCPLOG",132,0)
 . S IBSET3=$G(IBDARR("INS",IBINSNO,3))
"RTN","IBNCPLOG",133,0)
 . S RECNO=$$ADDINS(IBDTIEN,IBRECNO)
"RTN","IBNCPLOG",134,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.02,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,1))
"RTN","IBNCPLOG",135,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.03,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,2))
"RTN","IBNCPLOG",136,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.04,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,3))
"RTN","IBNCPLOG",137,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.05,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,4))
"RTN","IBNCPLOG",138,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.06,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,5))
"RTN","IBNCPLOG",139,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.07,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,6))
"RTN","IBNCPLOG",140,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.08,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,7))
"RTN","IBNCPLOG",141,0)
 . ;
"RTN","IBNCPLOG",142,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.101,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,8))
"RTN","IBNCPLOG",143,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.102,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,9))
"RTN","IBNCPLOG",144,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.103,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,10))
"RTN","IBNCPLOG",145,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.104,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,11))
"RTN","IBNCPLOG",146,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.105,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,12))
"RTN","IBNCPLOG",147,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.106,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,13))
"RTN","IBNCPLOG",148,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.107,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET1,U,14))
"RTN","IBNCPLOG",149,0)
 . ;
"RTN","IBNCPLOG",150,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.201,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET2,U,1))
"RTN","IBNCPLOG",151,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.202,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET2,U,2))
"RTN","IBNCPLOG",152,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.203,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET2,U,3))
"RTN","IBNCPLOG",153,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.204,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET2,U,4))
"RTN","IBNCPLOG",154,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.205,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET2,U,5))
"RTN","IBNCPLOG",155,0)
 . ;
"RTN","IBNCPLOG",156,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.301,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET3,U,1))
"RTN","IBNCPLOG",157,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.302,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET3,U,2))
"RTN","IBNCPLOG",158,0)
 . I +$$FILLFLDS^IBNCPUT1(366.1412,.303,RECNO_","_IBRECNO_","_IBDTIEN,$P(IBSET3,U,3))
"RTN","IBNCPLOG",159,0)
 Q RECNO
"RTN","IBNCPLOG",160,0)
 ;create top level entry in #366.14
"RTN","IBNCPLOG",161,0)
 ;input:
"RTN","IBNCPLOG",162,0)
 ; IBDATE - date in FileMan format
"RTN","IBNCPLOG",163,0)
 ;output
"RTN","IBNCPLOG",164,0)
 ; returns ien created
"RTN","IBNCPLOG",165,0)
ADDDATE(IBDATE) ;
"RTN","IBNCPLOG",166,0)
 N IBIEN
"RTN","IBNCPLOG",167,0)
 S IBIEN=+$O(^IBCNR(366.14,"B",IBDATE,0))
"RTN","IBNCPLOG",168,0)
 I IBIEN>0 Q IBIEN
"RTN","IBNCPLOG",169,0)
 I $$INSITEM^IBNCPUT1(366.14,"",IBDATE,"")
"RTN","IBNCPLOG",170,0)
 Q +$O(^IBCNR(366.14,"B",IBDATE,0))
"RTN","IBNCPLOG",171,0)
 ;
"RTN","IBNCPLOG",172,0)
 ;create EVENT entry in #366.14
"RTN","IBNCPLOG",173,0)
 ;input:
"RTN","IBNCPLOG",174,0)
 ;IBIEN - ien on top [DATE] level  
"RTN","IBNCPLOG",175,0)
 ;EVNTTYPE event type (value for .01)
"RTN","IBNCPLOG",176,0)
 ;returns ien for the event
"RTN","IBNCPLOG",177,0)
 ;or 0 if failed
"RTN","IBNCPLOG",178,0)
NEWEVENT(IBIEN,EVNTTYPE) ;
"RTN","IBNCPLOG",179,0)
 N EVNTRECN
"RTN","IBNCPLOG",180,0)
 S EVNTRECN=$$INSITEM^IBNCPUT1(366.141,IBIEN,$$EXT2INT^IBNCPUT1(EVNTTYPE),"","")
"RTN","IBNCPLOG",181,0)
 I EVNTRECN>0 Q EVNTRECN
"RTN","IBNCPLOG",182,0)
 Q 0
"RTN","IBNCPLOG",183,0)
 ;
"RTN","IBNCPLOG",184,0)
 ;add insurance node
"RTN","IBNCPLOG",185,0)
 ;IBDTIEN - ien on top [DATE] level 
"RTN","IBNCPLOG",186,0)
 ;IBEVIEN - ien in [EVENTS] multiple
"RTN","IBNCPLOG",187,0)
 ;returns : 
"RTN","IBNCPLOG",188,0)
 ; new ien in INSURANCE multiple 
"RTN","IBNCPLOG",189,0)
ADDINS(IBDTIEN,IBEVIEN) ;
"RTN","IBNCPLOG",190,0)
 N IBX,IBX2
"RTN","IBNCPLOG",191,0)
 F IBX=1:1:99999 I '$D(^IBCNR(366.14,IBDTIEN,1,IBEVIEN,5,IBX)) D  Q
"RTN","IBNCPLOG",192,0)
 . S IBX2=$$INSITEM^IBNCPUT1(366.1412,IBEVIEN_","_IBDTIEN,IBX,IBX)
"RTN","IBNCPLOG",193,0)
 Q +$O(^IBCNR(366.14,IBDTIEN,1,IBEVIEN,5,"B",IBX,0))
"RTN","IBNCPLOG",194,0)
 ;
"RTN","IBNCPUT1")
0^23^B20040520
"RTN","IBNCPUT1",1,0)
IBNCPUT1 ;BHAM ISC/SS - IB NCPDP UTILITIES ;22-MAR-2006
"RTN","IBNCPUT1",2,0)
 ;;2.0;INTEGRATED BILLING;**342,363**;21-MAR-94;Build 35
"RTN","IBNCPUT1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPUT1",4,0)
 ;
"RTN","IBNCPUT1",5,0)
 ;Utilities for NPCDP
"RTN","IBNCPUT1",6,0)
 ;/**
"RTN","IBNCPUT1",7,0)
 ;Creates a new entry (or node for multiple with .01 field)
"RTN","IBNCPUT1",8,0)
 ;
"RTN","IBNCPUT1",9,0)
 ;IBFILE - subfile# (9002313.59111) for comment
"RTN","IBNCPUT1",10,0)
 ;IBIEN - ien of the parent file entry in which the new subfile entry will be inserted
"RTN","IBNCPUT1",11,0)
 ;IBVAL01 - .01 value for the new entry
"RTN","IBNCPUT1",12,0)
 ;NEWRECNO -(optional) specify IEN if you want specific value
"RTN","IBNCPUT1",13,0)
 ; Note: "" then the system will assign the entry number itself.
"RTN","IBNCPUT1",14,0)
 ;IBFLGS - FLAGS parameter for UPDATE^DIE
"RTN","IBNCPUT1",15,0)
 ;Examples
"RTN","IBNCPUT1",16,0)
 ;top level:
"RTN","IBNCPUT1",17,0)
 ; D INSITEM(366.14,"",IBDATE,"")
"RTN","IBNCPUT1",18,0)
 ; D INSITEM(366.14,"",IBDATE,45)
"RTN","IBNCPUT1",19,0)
 ; 
"RTN","IBNCPUT1",20,0)
 ;1st level multiple:
"RTN","IBNCPUT1",21,0)
 ; subfile number = #366.141
"RTN","IBNCPUT1",22,0)
 ; parent file #366.14 entry number = 345
"RTN","IBNCPUT1",23,0)
 ; D INSITEM(366.141,345,"SUBMIT","")
"RTN","IBNCPUT1",24,0)
 ; to create mupltiple entry with particular entry number = 23
"RTN","IBNCPUT1",25,0)
 ; D INSITEM(366.141,345,"SUBMIT",23)
"RTN","IBNCPUT1",26,0)
 ;
"RTN","IBNCPUT1",27,0)
 ;2nd level multiple
"RTN","IBNCPUT1",28,0)
 ;parent file #366.14 entry number = 234
"RTN","IBNCPUT1",29,0)
 ;parent multiple entry number = 55
"RTN","IBNCPUT1",30,0)
 ;create mupltiple entry INSURANCE
"RTN","IBNCPUT1",31,0)
 ; D INSITEM(366.1412,"55,234","INS","")
"RTN","IBNCPUT1",32,0)
 ; results in :
"RTN","IBNCPUT1",33,0)
 ; ^IBCNR(366.14,234,1,55,5,0)=^366.1412PA^1^1
"RTN","IBNCPUT1",34,0)
 ; ^IBCNR(366.14,234,1,55,5,1,0)=INS
"RTN","IBNCPUT1",35,0)
 ; ^IBCNR(366.14,234,1,55,5,"B","INS",1)=
"RTN","IBNCPUT1",36,0)
 ;  (DD node for this muptiple =5 ) 
"RTN","IBNCPUT1",37,0)
 ;  
"RTN","IBNCPUT1",38,0)
 ;output :
"RTN","IBNCPUT1",39,0)
 ; positive number - record # created
"RTN","IBNCPUT1",40,0)
 ; <=0 - failure
"RTN","IBNCPUT1",41,0)
 ;  See description above
"RTN","IBNCPUT1",42,0)
INSITEM(IBFILE,IBIEN,IBVAL01,NEWRECNO,IBFLGS) ;*/
"RTN","IBNCPUT1",43,0)
 N IBSSI,IBIENS,IBFDA,IBERR
"RTN","IBNCPUT1",44,0)
 I '$G(NEWRECNO) N NEWRECNO S NEWRECNO=$G(NEWRECNO)
"RTN","IBNCPUT1",45,0)
 I IBIEN'="" S IBIENS="+1,"_IBIEN_"," I $L(NEWRECNO)>0 S IBSSI(1)=+NEWRECNO
"RTN","IBNCPUT1",46,0)
 I IBIEN="" S IBIENS="+1," I $L(NEWRECNO)>0 S IBSSI(1)=+NEWRECNO
"RTN","IBNCPUT1",47,0)
 S IBFDA(IBFILE,IBIENS,.01)=IBVAL01
"RTN","IBNCPUT1",48,0)
 D UPDATE^DIE($G(IBFLGS),"IBFDA","IBSSI","IBERR")
"RTN","IBNCPUT1",49,0)
 I $D(IBERR) D BMES^XPDUTL(IBERR("DIERR",1,"TEXT",1)) Q -1  ;D BMES^XPDUTL(IBERR("DIERR",1,"TEXT",1)) 
"RTN","IBNCPUT1",50,0)
 Q +$G(IBSSI(1))
"RTN","IBNCPUT1",51,0)
 ;
"RTN","IBNCPUT1",52,0)
 ;
"RTN","IBNCPUT1",53,0)
 ;fill fields
"RTN","IBNCPUT1",54,0)
 ;Input:
"RTN","IBNCPUT1",55,0)
 ;FILENO file number
"RTN","IBNCPUT1",56,0)
 ;FLDNO field number
"RTN","IBNCPUT1",57,0)
 ;RECIEN ien string 
"RTN","IBNCPUT1",58,0)
 ;NEWVAL new value to file
"RTN","IBNCPUT1",59,0)
 ;Output:
"RTN","IBNCPUT1",60,0)
 ;0^ NEWVAL^error if failure
"RTN","IBNCPUT1",61,0)
 ;1^ NEWVAL if success
"RTN","IBNCPUT1",62,0)
FILLFLDS(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","IBNCPUT1",63,0)
 N RECIENS,FDA,ERRARR
"RTN","IBNCPUT1",64,0)
 S RECIENS=RECIEN_","
"RTN","IBNCPUT1",65,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","IBNCPUT1",66,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","IBNCPUT1",67,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","IBNCPUT1",68,0)
 Q "1^"_NEWVAL
"RTN","IBNCPUT1",69,0)
 ;
"RTN","IBNCPUT1",70,0)
 ;convert external value of the field EVENT TYPE to its internal value
"RTN","IBNCPUT1",71,0)
 ;IA# 10155
"RTN","IBNCPUT1",72,0)
EXT2INT(IBEXTRN) ;
"RTN","IBNCPUT1",73,0)
 N IBDD,IBZ,IBCNT,IBINTERN
"RTN","IBNCPUT1",74,0)
 S IBINTERN=-1
"RTN","IBNCPUT1",75,0)
 S IBDD=$P($G(^DD(366.141,.01,0)),U,3) ;IA# 10155
"RTN","IBNCPUT1",76,0)
 F IBCNT=1:1 S IBZ=$P(IBDD,";",IBCNT) Q:IBZ=""  D  Q:IBINTERN'<0
"RTN","IBNCPUT1",77,0)
 . I $P(IBZ,":",2)=IBEXTRN S IBINTERN=+IBZ
"RTN","IBNCPUT1",78,0)
 Q:IBINTERN<0 0  ;treat as UNKNOWN
"RTN","IBNCPUT1",79,0)
 Q IBINTERN
"RTN","IBNCPUT1",80,0)
 ;
"RTN","IBNCPUT1",81,0)
 ;
"RTN","IBNCPUT1",82,0)
 ;should RX copay from the entry in file #350 be placed on hold ?
"RTN","IBNCPUT1",83,0)
 ;called from HOLD^IBRUTL
"RTN","IBNCPUT1",84,0)
 ;Input:
"RTN","IBNCPUT1",85,0)
 ; X - zeroth node of file #350 entry
"RTN","IBNCPUT1",86,0)
 ;output:
"RTN","IBNCPUT1",87,0)
 ; 0 - NO - DO NOT PUT ON HOLD
"RTN","IBNCPUT1",88,0)
 ; 1 - this is RX copay but there is no ECME claim, so process it as usual
"RTN","IBNCPUT1",89,0)
 ; 1 - this is ECME RX copay and it should be put on HOLD
"RTN","IBNCPUT1",90,0)
 ; 1 - this is ECME RX copay and it was rejected or reversed 
"RTN","IBNCPUT1",91,0)
 ; 2 - this is not RX copay
"RTN","IBNCPUT1",92,0)
HOLDECME(X) ;
"RTN","IBNCPUT1",93,0)
 N IBRXIEN,IBREFNO,IBRXZ,IBDATE,IBDFN,IBEBCOB,IBRETVAL
"RTN","IBNCPUT1",94,0)
 S IBRETVAL=""
"RTN","IBNCPUT1",95,0)
 S IBRXZ=$P($G(X),U,4),(IBRXIEN,IBREFNO)=0
"RTN","IBNCPUT1",96,0)
 I $P($P(IBRXZ,";"),":")'=52 Q 2  ;follow pre-existing logic
"RTN","IBNCPUT1",97,0)
 S IBRXIEN=+$P($P(IBRXZ,";"),":",2) ;ien in file #52
"RTN","IBNCPUT1",98,0)
 S IBREFNO=+$P($P($P(X,U,4),";",2),":",2) ;refill number (0 - for  original)
"RTN","IBNCPUT1",99,0)
 S IBDFN=+$P($G(X),U,2) ;Patient ien
"RTN","IBNCPUT1",100,0)
 ;if this is OTC "non-e-billable" drug then DO NOT PUT ON HOLD
"RTN","IBNCPUT1",101,0)
 I $$OTCNEBIL(IBRXIEN)=1 Q 0
"RTN","IBNCPUT1",102,0)
 ;if this is non-OTC drug OR if this is OTC drug but marked as e-billable then look if it has zero amount paid
"RTN","IBNCPUT1",103,0)
 I $$AMNTHOLD^IBNCPUT1(IBDFN,IBRXIEN,IBREFNO)=0 Q 0  ;DO NOT PUT ON HOLD
"RTN","IBNCPUT1",104,0)
 Q 1  ;follow pre-existing logic
"RTN","IBNCPUT1",105,0)
 ;
"RTN","IBNCPUT1",106,0)
 ;should RX copay be placed on hold based on the PAID amount?
"RTN","IBNCPUT1",107,0)
 ;input:
"RTN","IBNCPUT1",108,0)
 ; IBDFN - patient's ien
"RTN","IBNCPUT1",109,0)
 ; IBRX - file #52 ien
"RTN","IBNCPUT1",110,0)
 ; IBREF - refill no
"RTN","IBNCPUT1",111,0)
 ;output:
"RTN","IBNCPUT1",112,0)
 ; 1 - YES
"RTN","IBNCPUT1",113,0)
 ; 0 - NO
"RTN","IBNCPUT1",114,0)
AMNTHOLD(IBDFN,IBRX,IBREF) ;
"RTN","IBNCPUT1",115,0)
 N IBPAYRES ;for payer's response
"RTN","IBNCPUT1",116,0)
 N IBADT
"RTN","IBNCPUT1",117,0)
 ;
"RTN","IBNCPUT1",118,0)
 S IBPAYRES=$$PAIDAMNT^BPSUTIL(IBRX,IBREF)
"RTN","IBNCPUT1",119,0)
 ;if payable AND amount paid is zero AND does not have any other Pharmacy insurance 
"RTN","IBNCPUT1",120,0)
 ;THEN return NO - it should not be put on hold
"RTN","IBNCPUT1",121,0)
 I +IBPAYRES=1,$P(IBPAYRES,U,2)=0,'$$MOREINS^IBNCPNB(IBDFN,+$P(IBPAYRES,U,3)) Q 0
"RTN","IBNCPUT1",122,0)
 Q 1
"RTN","IBNCPUT1",123,0)
 ;Is this RX for OTC drug which is NOT E-billiable?
"RTN","IBNCPUT1",124,0)
 ;Input:
"RTN","IBNCPUT1",125,0)
 ; IBRX - ien in file #52
"RTN","IBNCPUT1",126,0)
 ;Output:
"RTN","IBNCPUT1",127,0)
 ; 1 - this is OTC drug and it is NOT marked as e-billable
"RTN","IBNCPUT1",128,0)
 ; 0 - otherwise
"RTN","IBNCPUT1",129,0)
OTCNEBIL(IBRX) ;
"RTN","IBNCPUT1",130,0)
 N ARR,IBSPHNDL,IBDRUG
"RTN","IBNCPUT1",131,0)
 S IBDRUG=+$$RXAPI1^IBNCPUT1(IBRX,6,"I")
"RTN","IBNCPUT1",132,0)
 S IBSPHNDL=$$DRUGDIE^IBNCPUT1(IBDRUG,3,"E",.ARR)
"RTN","IBNCPUT1",133,0)
 I IBSPHNDL'["9" Q 0  ;this is not OTC drug
"RTN","IBNCPUT1",134,0)
 I IBSPHNDL["E" Q 0  ;it is OTC E-billable drug
"RTN","IBNCPUT1",135,0)
 ;it is OTC NON E-billable drug
"RTN","IBNCPUT1",136,0)
 Q 1
"RTN","IBNCPUT1",137,0)
 ;
"RTN","IBNCPUT1",138,0)
 ;Function to return field data from DRUG file (#50)
"RTN","IBNCPUT1",139,0)
 ; Parameters
"RTN","IBNCPUT1",140,0)
 ;  IBIEN50 - IEN of DRUG FILE #50
"RTN","IBNCPUT1",141,0)
 ;  IBFLDN - Field Number(s) (like .01)
"RTN","IBNCPUT1",142,0)
 ;  IBEXIN - Specifies internal or external value of returned field
"RTN","IBNCPUT1",143,0)
 ;         - optional, defaults to "I"
"RTN","IBNCPUT1",144,0)
 ;  IBARR50 - Array to return value(s).  Optional.  Pass by reference.
"RTN","IBNCPUT1",145,0)
 ;           See EN^DIQ documentation for variable DIQ
"RTN","IBNCPUT1",146,0)
 ;
"RTN","IBNCPUT1",147,0)
 ; Function returns field data if one field is specified.  If
"RTN","IBNCPUT1",148,0)
 ;   multiple fields, the function will return "" and the field
"RTN","IBNCPUT1",149,0)
 ;   values are returned in IBARR50
"RTN","IBNCPUT1",150,0)
 ; Example: W $$DRUGDIE^IBNCPUT1(134,25,"E",.ARR)
"RTN","IBNCPUT1",151,0)
DRUGDIE(IBIEN50,IBFLDN,IBEXIN,IBARR50) ; Return field values for Drug file 
"RTN","IBNCPUT1",152,0)
 I $G(IBIEN50)=""!($G(IBFLDN)="") Q ""
"RTN","IBNCPUT1",153,0)
 N DIQ,PSSDIY
"RTN","IBNCPUT1",154,0)
 N IBDIQ
"RTN","IBNCPUT1",155,0)
 I $G(IBEXIN)'="E" S IBEXIN="I"
"RTN","IBNCPUT1",156,0)
 S IBDIQ="IBARR50",IBDIQ(0)=IBEXIN
"RTN","IBNCPUT1",157,0)
 D EN^PSSDI(50,"IB",50,.IBFLDN,.IBIEN50,.IBDIQ)
"RTN","IBNCPUT1",158,0)
 Q $G(IBARR50(50,IBIEN50,IBFLDN,IBEXIN))
"RTN","IBNCPUT1",159,0)
 ;
"RTN","IBNCPUT1",160,0)
 ;/*
"RTN","IBNCPUT1",161,0)
 ;Function to return a value for a SINGLE field of file #52
"RTN","IBNCPUT1",162,0)
 ;DBIA 4858
"RTN","IBNCPUT1",163,0)
 ;input:
"RTN","IBNCPUT1",164,0)
 ; IBIEN52 - ien of file #52
"RTN","IBNCPUT1",165,0)
 ; IBFLDN - one single field, for example ".01"
"RTN","IBNCPUT1",166,0)
 ; IBFORMAT - 
"RTN","IBNCPUT1",167,0)
 ;  "E" for external format
"RTN","IBNCPUT1",168,0)
 ;  "I" - internal 
"RTN","IBNCPUT1",169,0)
 ;  "N" - do not return nulls
"RTN","IBNCPUT1",170,0)
 ;  default is "E"
"RTN","IBNCPUT1",171,0)
 ;output:
"RTN","IBNCPUT1",172,0)
 ; returns a field value or null (empty string) 
"RTN","IBNCPUT1",173,0)
 ; examples:
"RTN","IBNCPUT1",174,0)
 ;W $$RXAPI1^IBNCPUT1(504733,6,"E")
"RTN","IBNCPUT1",175,0)
 ;ALBUMIN 25% 50ML
"RTN","IBNCPUT1",176,0)
 ;W $$RXAPI1^IBNCPUT1(504733,6,"I")
"RTN","IBNCPUT1",177,0)
 ;134
"RTN","IBNCPUT1",178,0)
RXAPI1(IBIEN52,IBFLDN,IBFORMAT) ;*/
"RTN","IBNCPUT1",179,0)
 N DIQ,DIC,IBARR,X,Y,D0,PSODIY
"RTN","IBNCPUT1",180,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","IBNCPUT1",181,0)
 N IBDIQ
"RTN","IBNCPUT1",182,0)
 S IBDIQ="IBARR"
"RTN","IBNCPUT1",183,0)
 S IBDIQ(0)=$S($G(IBFORMAT)="":"E",1:IBFORMAT)
"RTN","IBNCPUT1",184,0)
 D DIQ^PSODI(52,52,.IBFLDN,.IBIEN52,.IBDIQ) ;DBIA 4858
"RTN","IBNCPUT1",185,0)
 Q $S(IBDIQ(0)="N":$G(IBARR(52,IBIEN52,IBFLDN)),1:$G(IBARR(52,IBIEN52,IBFLDN,IBDIQ(0))))
"RTN","IBNCPUT1",186,0)
 ;
"RTN","IBNCPUT1",187,0)
 ;
"RTN","IBNCPUT1",188,0)
 ;IBNCPUT1
"RTN","IBNCPUT2")
0^30^B14161327
"RTN","IBNCPUT2",1,0)
IBNCPUT2 ;BHAM ISC/SS - IB NCPDP UTILITIES ;23-JUL-2007
"RTN","IBNCPUT2",2,0)
 ;;2.0;INTEGRATED BILLING;**363**;21-MAR-94;Build 35
"RTN","IBNCPUT2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPUT2",4,0)
 ;
"RTN","IBNCPUT2",5,0)
 ;Utilities for NPCDP
"RTN","IBNCPUT2",6,0)
 ;
"RTN","IBNCPUT2",7,0)
 ;Subroutine to return values from MULTIPLE fields of file #52
"RTN","IBNCPUT2",8,0)
 ;DBIA 4858
"RTN","IBNCPUT2",9,0)
 ;input:
"RTN","IBNCPUT2",10,0)
 ; IBIEN52 - ien of file #52
"RTN","IBNCPUT2",11,0)
 ; IBFLDN - one or more fields, for example ".01;2;5"
"RTN","IBNCPUT2",12,0)
 ; IBRET - contains a name for a local array to return results,
"RTN","IBNCPUT2",13,0)
 ; Note: the name of the array should't be "BPSRET" otherwise it will 
"RTN","IBNCPUT2",14,0)
 ;   be "newed" since the parameter has the same name
"RTN","IBNCPUT2",15,0)
 ; IBFORMAT - 
"RTN","IBNCPUT2",16,0)
 ;  "E" for external format
"RTN","IBNCPUT2",17,0)
 ;  "I" - internal 
"RTN","IBNCPUT2",18,0)
 ;  "N" - do not return nulls
"RTN","IBNCPUT2",19,0)
 ;  default is "E"
"RTN","IBNCPUT2",20,0)
 ;output:
"RTN","IBNCPUT2",21,0)
 ; result will be put into array with the name specified by BPSRET
"RTN","IBNCPUT2",22,0)
RXAPI(IBIEN52,IBFLDN,IBRET,IBFORMAT) ;
"RTN","IBNCPUT2",23,0)
 I ($G(IBIEN52)="")!($G(IBFLDN)="")!($G(IBRET)="") Q
"RTN","IBNCPUT2",24,0)
 N DIQ,DIC,X,Y,D0,PSODIY
"RTN","IBNCPUT2",25,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","IBNCPUT2",26,0)
 N IBDIQ
"RTN","IBNCPUT2",27,0)
 S IBDIQ=$NA(@IBRET)
"RTN","IBNCPUT2",28,0)
 S IBDIQ(0)=$S($G(IBFORMAT)="":"E",1:IBFORMAT)
"RTN","IBNCPUT2",29,0)
 D DIQ^PSODI(52,52,.IBFLDN,.IBIEN52,.IBDIQ) ;DBIA 4858
"RTN","IBNCPUT2",30,0)
 Q 
"RTN","IBNCPUT2",31,0)
 ;Subroutine to return values from MULTIPLE fields of a subfile of the file #52
"RTN","IBNCPUT2",32,0)
 ;DBIA 4858
"RTN","IBNCPUT2",33,0)
 ;input:
"RTN","IBNCPUT2",34,0)
 ; IBIEN52 - ien of file #52
"RTN","IBNCPUT2",35,0)
 ; IBFLD52 - field # that relates to this subfile
"RTN","IBNCPUT2",36,0)
 ; IBSUBFNO - subfile number (like 52.052311)
"RTN","IBNCPUT2",37,0)
 ; IBSUBIEN - ien of the subfile record you're interested in
"RTN","IBNCPUT2",38,0)
 ; IBSUBFLD - one or more fields, for example ".01;2;5"
"RTN","IBNCPUT2",39,0)
 ; IBRET - name for a local array to return results 
"RTN","IBNCPUT2",40,0)
 ; IBFORMAT - optional parameter.
"RTN","IBNCPUT2",41,0)
 ;  "E" for external format
"RTN","IBNCPUT2",42,0)
 ;  "I" - internal 
"RTN","IBNCPUT2",43,0)
 ;  "N" - do not return nulls
"RTN","IBNCPUT2",44,0)
 ;  default is "E"
"RTN","IBNCPUT2",45,0)
 ;output:
"RTN","IBNCPUT2",46,0)
 ; returns results in array BPSRET in the form:
"RTN","IBNCPUT2",47,0)
 ; IBRET (IBSUBFNO, IBSUBIEN, IBSUBFLD,IBFORMAT)=value
"RTN","IBNCPUT2",48,0)
RXSUBF(IBIEN52,IBFLD52,IBSUBFNO,IBSUBIEN,IBSUBFLD,IBRET,IBFORMAT) ;
"RTN","IBNCPUT2",49,0)
 I ($G(IBIEN52)="")!($G(IBFLD52)="")!($G(IBSUBFNO)="")!($G(IBSUBIEN)="")!($G(IBSUBFLD)="")!($G(IBRET)="") Q
"RTN","IBNCPUT2",50,0)
 N DIQ,DIC,DA,DR,X,Y,D0,PSODIY
"RTN","IBNCPUT2",51,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","IBNCPUT2",52,0)
 N IBDIC,IBDR,IBDA,IBDIQ
"RTN","IBNCPUT2",53,0)
 S IBDIC=52 ;main file #52
"RTN","IBNCPUT2",54,0)
 S IBDA=IBIEN52 ;ien in main file #52
"RTN","IBNCPUT2",55,0)
 S IBDA(IBSUBFNO)=IBSUBIEN ;ien in subfile
"RTN","IBNCPUT2",56,0)
 S IBDR=IBFLD52 ;field# of the subfile in the main file
"RTN","IBNCPUT2",57,0)
 S IBDR(IBSUBFNO)=IBSUBFLD ;field# in the subfile that we need to get a value for
"RTN","IBNCPUT2",58,0)
 S IBDIQ=$NA(@IBRET) ;output array
"RTN","IBNCPUT2",59,0)
 S IBDIQ(0)=$S($G(IBFORMAT)="":"E",1:IBFORMAT)
"RTN","IBNCPUT2",60,0)
 D DIQ^PSODI(52,.IBDIC,.IBDR,.IBDA,.IBDIQ) ;DBIA 4858
"RTN","IBNCPUT2",61,0)
 Q
"RTN","IBNCPUT2",62,0)
 ;
"RTN","IBNCPUT2",63,0)
 ;Retrieve indicators (AO,CV,etc) from the file #52 
"RTN","IBNCPUT2",64,0)
 ;input:
"RTN","IBNCPUT2",65,0)
 ; IBRXIEN - ien of file #52
"RTN","IBNCPUT2",66,0)
 ; .IBARRAY - local array passed by reference 
"RTN","IBNCPUT2",67,0)
 ;output:
"RTN","IBNCPUT2",68,0)
 ; .IBARRAY
"RTN","IBNCPUT2",69,0)
GETINDIC(IBRXIEN,IBARRAY) ;
"RTN","IBNCPUT2",70,0)
 ;set all indicators nodes to null before populating
"RTN","IBNCPUT2",71,0)
 S IBARRAY("AO")="",IBARRAY("EC")="",IBARRAY("HNC")="",IBARRAY("IR")=""
"RTN","IBNCPUT2",72,0)
 S IBARRAY("MST")="",IBARRAY("SC")="",IBARRAY("CV")="",IBARRAY("SWA")="",IBARRAY("SHAD")=""
"RTN","IBNCPUT2",73,0)
 N IBARR,IBFOUND
"RTN","IBNCPUT2",74,0)
 ; Get SC/EI from ICD subfile (new way)
"RTN","IBNCPUT2",75,0)
 D RXSUBF(IBRXIEN,52311,52.052311,1,"1;2;3;4;5;6;7;8","IBARR","I")
"RTN","IBNCPUT2",76,0)
 S IBFOUND=0
"RTN","IBNCPUT2",77,0)
 I $G(IBARR(52.052311,1,1,"I"))'="" S IBARRAY("AO")=IBARR(52.052311,1,1,"I"),IBFOUND=1
"RTN","IBNCPUT2",78,0)
 I $G(IBARR(52.052311,1,2,"I"))'="" S IBARRAY("IR")=IBARR(52.052311,1,2,"I"),IBFOUND=1
"RTN","IBNCPUT2",79,0)
 I $G(IBARR(52.052311,1,3,"I"))'="" S IBARRAY("SC")=IBARR(52.052311,1,3,"I"),IBFOUND=1
"RTN","IBNCPUT2",80,0)
 I $G(IBARR(52.052311,1,4,"I"))'="" S IBARRAY("SWA")=IBARR(52.052311,1,4,"I"),IBFOUND=1
"RTN","IBNCPUT2",81,0)
 I $G(IBARR(52.052311,1,5,"I"))'="" S IBARRAY("MST")=IBARR(52.052311,1,5,"I"),IBFOUND=1
"RTN","IBNCPUT2",82,0)
 I $G(IBARR(52.052311,1,6,"I"))'="" S IBARRAY("HNC")=IBARR(52.052311,1,6,"I"),IBFOUND=1
"RTN","IBNCPUT2",83,0)
 I $G(IBARR(52.052311,1,7,"I"))'="" S IBARRAY("CV")=IBARR(52.052311,1,7,"I"),IBFOUND=1
"RTN","IBNCPUT2",84,0)
 I $G(IBARR(52.052311,1,8,"I"))'="" S IBARRAY("SHAD")=IBARR(52.052311,1,8,"I"),IBFOUND=1
"RTN","IBNCPUT2",85,0)
 Q:IBFOUND=1
"RTN","IBNCPUT2",86,0)
 ; If not available, pull from IBQ node (old way)
"RTN","IBNCPUT2",87,0)
 K IBARR
"RTN","IBNCPUT2",88,0)
 D RXAPI(IBRXIEN,"116;117;118;119;120;121;122;122.01","IBARR","I")
"RTN","IBNCPUT2",89,0)
 S IBARRAY("SC")=IBARR(52,IBRXIEN,116,"I")
"RTN","IBNCPUT2",90,0)
 S IBARRAY("MST")=IBARR(52,IBRXIEN,117,"I")
"RTN","IBNCPUT2",91,0)
 S IBARRAY("AO")=IBARR(52,IBRXIEN,118,"I")
"RTN","IBNCPUT2",92,0)
 S IBARRAY("IR")=IBARR(52,IBRXIEN,119,"I")
"RTN","IBNCPUT2",93,0)
 S IBARRAY("SWA")=IBARR(52,IBRXIEN,120,"I")
"RTN","IBNCPUT2",94,0)
 S IBARRAY("HNC")=IBARR(52,IBRXIEN,121,"I")
"RTN","IBNCPUT2",95,0)
 S IBARRAY("CV")=IBARR(52,IBRXIEN,122,"I")
"RTN","IBNCPUT2",96,0)
 S IBARRAY("SHAD")=$G(IBARR(52,IBRXIEN,122.01,"I"))
"RTN","IBNCPUT2",97,0)
 Q
"RTN","IBNCPUT2",98,0)
 ;IBNCPUT2
"RTN","IBRUTL")
0^24^B10256030
"RTN","IBRUTL",1,0)
IBRUTL ;ALB/CPM-INTEGRATED BILLING - A/R INTERFACE UTILITIES ;03-MAR-92
"RTN","IBRUTL",2,0)
 ;;2.0;INTEGRATED BILLING;**70,82,132,142,176,179,202,223,363**;21-MAR-94;Build 35
"RTN","IBRUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBRUTL",4,0)
 ;
"RTN","IBRUTL",5,0)
IB(IEN,RETN) ; Are there any IB Actions on hold for this bill?
"RTN","IBRUTL",6,0)
 ;         Input:   IEN         -- ien of Bill(#399), A/R(#430)
"RTN","IBRUTL",7,0)
 ;                  RETN (opt)  -- Want array of IB Actions? (1-Yes,0-No)
"RTN","IBRUTL",8,0)
 ;                                 if yes, returns IBA(num)=ibn
"RTN","IBRUTL",9,0)
 ;         Returns: 1 -- Yes, 0 -- No
"RTN","IBRUTL",10,0)
 ;
"RTN","IBRUTL",11,0)
 N ATYPE,BTYPE,BILLS,DFN,IBFR,IB0,IBTO,IBU,IBN,IBND,IBNUM,IBOK
"RTN","IBRUTL",12,0)
 S:'$D(RETN) RETN=0 S BILLS=0
"RTN","IBRUTL",13,0)
 ;
"RTN","IBRUTL",14,0)
 ; - determine patient, bill type and billing dates
"RTN","IBRUTL",15,0)
 S IB0=$G(^DGCR(399,IEN,0)),IBU=$G(^("U")),DFN=+$P(IB0,"^",2)
"RTN","IBRUTL",16,0)
 S BTYPE=$S(+$P(IB0,"^",5)<3:"I",1:"O"),IBFR=+IBU,IBTO=$P(IBU,"^",2)
"RTN","IBRUTL",17,0)
 ;
"RTN","IBRUTL",18,0)
 ; - loop through all bills on hold, and set flag if there is an
"RTN","IBRUTL",19,0)
 ; - IB Action of the same type as the UB-82 which has been billed
"RTN","IBRUTL",20,0)
 ; - within the statement dates of the UB-82.  Store all actions
"RTN","IBRUTL",21,0)
 ; - in the array IBA if required.
"RTN","IBRUTL",22,0)
 S (IBN,IBNUM)=0 F  S IBN=$O(^IB("AH",DFN,IBN)) Q:'IBN  D  I IBOK Q:'RETN  S IBNUM=IBNUM+1,IBA(IBNUM)=IBN
"RTN","IBRUTL",23,0)
 . S IBOK=0,IBND=$G(^IB(IBN,0)) Q:'IBND
"RTN","IBRUTL",24,0)
 . S ATYPE=$S($P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")["OPT":"O",1:"I") Q:ATYPE'=BTYPE
"RTN","IBRUTL",25,0)
 . Q:$P(IBND,"^",15)<IBFR!($P(IBND,"^",14)>IBTO)  S (IBOK,BILLS)=1
"RTN","IBRUTL",26,0)
 ;
"RTN","IBRUTL",27,0)
 Q BILLS
"RTN","IBRUTL",28,0)
 ;
"RTN","IBRUTL",29,0)
 ;
"RTN","IBRUTL",30,0)
HOLD(X,IBN,IBDUZ,IBSEQNO) ; Place IB Action on hold?
"RTN","IBRUTL",31,0)
 ;         Input:        X -- Zeroth node of IB Action
"RTN","IBRUTL",32,0)
 ;                     IBN -- ien of IB Action
"RTN","IBRUTL",33,0)
 ;                   IBDUZ -- User ID
"RTN","IBRUTL",34,0)
 ;                 IBSEQNO -- 1 (New Action), 3 (Update Action)
"RTN","IBRUTL",35,0)
 ;         Returns:      1 -- Yes, 0 -- No
"RTN","IBRUTL",36,0)
 ;
"RTN","IBRUTL",37,0)
 N DFN,IBCOV,IBINDT,IBOUTP,HOLD,IBHOLDP,IBDUZ,I
"RTN","IBRUTL",38,0)
 N IBVDT,IBAT,IBCAT,IBALTC
"RTN","IBRUTL",39,0)
 ;
"RTN","IBRUTL",40,0)
 S HOLD=0
"RTN","IBRUTL",41,0)
 S IBHOLDP=$P($G(^IBE(350.9,1,1)),"^",20) ; Site parameter - HOLD MT BILLS W/INSURANCE
"RTN","IBRUTL",42,0)
 S DFN=+$P(X,"^",2)
"RTN","IBRUTL",43,0)
 ;
"RTN","IBRUTL",44,0)
 ;check if ECME RX copay needs to be placed on HOLD
"RTN","IBRUTL",45,0)
 I $$HOLDECME^IBNCPUT1(X)=0 G HOLDQ
"RTN","IBRUTL",46,0)
 ;
"RTN","IBRUTL",47,0)
 I $P(X,"^",5)=8 G HOLDQ ; action is already on hold
"RTN","IBRUTL",48,0)
 I '$P($G(^IBE(350.1,+$P(X,"^",3),0)),"^",10) G HOLDQ ; action can't be placed on hold
"RTN","IBRUTL",49,0)
 ;
"RTN","IBRUTL",50,0)
 ; - see if patient has insurance on Charge 'To' Date (otherwise Event date)
"RTN","IBRUTL",51,0)
 ; - includes check of plan coverage limitation
"RTN","IBRUTL",52,0)
 S IBINDT=+$P($G(^IB(+$G(IBN),0)),U,15)
"RTN","IBRUTL",53,0)
 I 'IBINDT S IBINDT=+$P($G(^IB(+$P(X,"^",16),0)),"^",17) I 'IBINDT S IBINDT=DT
"RTN","IBRUTL",54,0)
 S IBOUTP=1
"RTN","IBRUTL",55,0)
 D ^IBCNS
"RTN","IBRUTL",56,0)
 S IBVDT=$S(IBINDT'="":IBINDT,1:DT),IBAT=$P(^IBE(350.1,(+$P(X,U,3)),0),U,11)
"RTN","IBRUTL",57,0)
 S IBCAT=$S(IBAT<4:"INPATIENT",IBAT=4:"OUTPATIENT",IBAT=5:"PHARMACY",IBAT=8:"OUTPATIENT",IBAT=9:"INPATIENT",1:"")
"RTN","IBRUTL",58,0)
 S IBCOV="" I IBCAT'="" S IBCOV=$$PTCOV^IBCNSU3(DFN,IBVDT,IBCAT),HOLD=IBCOV
"RTN","IBRUTL",59,0)
 I 'IBCOV,+$$BUFFER^IBCNBU1(DFN) S (IBCOV,HOLD)=1 ; if patient has a buffer entry place charge on hold
"RTN","IBRUTL",60,0)
 ;
"RTN","IBRUTL",61,0)
 ;
"RTN","IBRUTL",62,0)
 ; - generate bulletin if patient has insurance, bulletin not suppressed
"RTN","IBRUTL",63,0)
 I IBCOV,'$P($G(^IBE(350.9,1,0)),"^",15),'$$ECME(IBN) D ^IBRBUL
"RTN","IBRUTL",64,0)
 ;
"RTN","IBRUTL",65,0)
 ; - update action to 'Hold' if parameter is set and vet has insurance
"RTN","IBRUTL",66,0)
 I IBHOLDP,IBCOV S DIE="^IB(",DA=IBN,DR=".05////8" D ^DIE,UP3^IBR:IBSEQNO=3 K DA,DIE,DR
"RTN","IBRUTL",67,0)
 ;
"RTN","IBRUTL",68,0)
HOLDQ Q +$G(HOLD)
"RTN","IBRUTL",69,0)
 ;
"RTN","IBRUTL",70,0)
ECME(IBN) ; return 1 if ECME billed already and bulleting should not go
"RTN","IBRUTL",71,0)
 N IBX,IBR,IBZ
"RTN","IBRUTL",72,0)
 S (IBR,IBX)=0,IBZ=^IB(IBN,0)
"RTN","IBRUTL",73,0)
 F  S IBX=$O(^IBA(362.4,"B",$P($P(IBZ,"^",8),"-"),IBX)) Q:'IBX!(IBR)  I $P($G(^DGCR(399,+$P(^IBA(362.4,IBX,0),"^",2),0)),"^",13)=4,$$FMDIFF^XLFDT($P(IBZ,"^",17),$P(^(0),"^",3),1)<6 S IBR=1
"RTN","IBRUTL",74,0)
 Q IBR
"RTN","IBTRED")
0^27^B24360829
"RTN","IBTRED",1,0)
IBTRED ;ALB/AAS - EXPAND/EDIT CLAIMS TRACKING ENTRY ;01-JUL-1993
"RTN","IBTRED",2,0)
 ;;2.0;INTEGRATED BILLING;**71,91,160,247,309,276,339,363**;21-MAR-94;Build 35
"RTN","IBTRED",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBTRED",4,0)
 ;
"RTN","IBTRED",5,0)
% ;
"RTN","IBTRED",6,0)
EN ; -- main entry point for IBT EXPAND/EDIT TRACKING
"RTN","IBTRED",7,0)
 I '$D(DT) D DT^DICRW
"RTN","IBTRED",8,0)
 K XQORS,VALMEVL,DFN,IBTRN,IBTRV,IBTRC,IBTRD
"RTN","IBTRED",9,0)
 I '$G(IBTRN) G EN^IBTRE Q  ; entry from programmer mode
"RTN","IBTRED",10,0)
 D EN^VALM("IBT EXPAND/EDIT TRACKING")
"RTN","IBTRED",11,0)
 K IBFASTXT
"RTN","IBTRED",12,0)
 Q
"RTN","IBTRED",13,0)
 ;
"RTN","IBTRED",14,0)
HDR ; -- header code
"RTN","IBTRED",15,0)
 D PID^VADPT
"RTN","IBTRED",16,0)
 S VALMHDR(1)="Expanded Claims Tracking Info for: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")_"   ROI: "_$$EXPAND^IBTRE(356,.31,$P(^IBT(356,IBTRN,0),"^",31))
"RTN","IBTRED",17,0)
 S VALMHDR(2)="                              For: "_$$ETYP(IBTRN)
"RTN","IBTRED",18,0)
 Q
"RTN","IBTRED",19,0)
 ;
"RTN","IBTRED",20,0)
INIT ; -- init variables and list array
"RTN","IBTRED",21,0)
 K VALMQUIT
"RTN","IBTRED",22,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBTRED",23,0)
 D BLD,HDR
"RTN","IBTRED",24,0)
 Q
"RTN","IBTRED",25,0)
 ;
"RTN","IBTRED",26,0)
BLD ; -- list builder
"RTN","IBTRED",27,0)
 N IBTRND,IBTRND1,IBTRND2,IBETYP
"RTN","IBTRED",28,0)
 K ^TMP("IBTRED",$J)
"RTN","IBTRED",29,0)
 F I=1:1:30 D BLANK(.I)
"RTN","IBTRED",30,0)
 I '$G(IBTRPRF) S IBTRPRF=123
"RTN","IBTRED",31,0)
 I IBTRPRF<10 S X=$S(IBTRPRF=1:"IBTRED  HR MENU",IBTRPRF=2:"IBTRED  IR MENU",IBTRPRF=3:"IBTRED  BI MENU",1:"IBTRED  MENU") D PROT^IBTRPR(X)
"RTN","IBTRED",32,0)
 D KILL^VALM10()
"RTN","IBTRED",33,0)
 S IBTRND=$G(^IBT(356,IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBTRED",34,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",35,0)
 S VALMCNT=30
"RTN","IBTRED",36,0)
 D VISIT D ^IBTRED0,^IBTRED01
"RTN","IBTRED",37,0)
 Q
"RTN","IBTRED",38,0)
 ;
"RTN","IBTRED",39,0)
VISIT ; -- Visit info Region
"RTN","IBTRED",40,0)
 N OFFSET,START,IBOE,IBOE0
"RTN","IBTRED",41,0)
 S START=1,OFFSET=2
"RTN","IBTRED",42,0)
 D SET^IBCNSP(START,OFFSET," Visit Information ",IORVON,IORVOFF)
"RTN","IBTRED",43,0)
 D SET^IBCNSP(START+1,OFFSET,"    Visit Type: "_$P(IBETYP,"^"))
"RTN","IBTRED",44,0)
 I '$D(IBETYP) N IBETYP S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",45,0)
 S X=$P(IBETYP,"^",3) D @X
"RTN","IBTRED",46,0)
 Q
"RTN","IBTRED",47,0)
1 ; -- visit region for admission or scheduled admission
"RTN","IBTRED",48,0)
 I $P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17) S VAINDT=+$G(^DGPM(+$P(IBTRND,"^",5),0))
"RTN","IBTRED",49,0)
 I '$D(VAIN) S VA200="" D INP^VADPT
"RTN","IBTRED",50,0)
 I VAIN(7)="" S Y=$P(IBTRND,"^",6) D D^DIQ S $P(VAIN(7),"^",2)=Y
"RTN","IBTRED",51,0)
 D SET^IBCNSP(START+2,OFFSET,"Admission Date: "_$P(VAIN(7),"^",2))
"RTN","IBTRED",52,0)
 D SET^IBCNSP(START+3,OFFSET,"          Ward: "_$P(VAIN(4),"^",2))
"RTN","IBTRED",53,0)
 D SET^IBCNSP(START+4,OFFSET,"     Specialty: "_$P(VAIN(3),"^",2))
"RTN","IBTRED",54,0)
 Q
"RTN","IBTRED",55,0)
2 ; -- visit region for  outpatient care
"RTN","IBTRED",56,0)
 S IBOE=$P(IBTRND,"^",4),IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBTRED",57,0)
 D SET^IBCNSP(START+2,OFFSET,"    Visit Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P"))
"RTN","IBTRED",58,0)
 I +IBOE<1 D  Q
"RTN","IBTRED",59,0)
 .D SET^IBCNSP(START+3,OFFSET,"  No Outpatient Encounter Found") Q
"RTN","IBTRED",60,0)
 D SET^IBCNSP(START+3,OFFSET,"        Clinic: "_$P($G(^SC(+$P(IBOE0,"^",4),0)),"^"))
"RTN","IBTRED",61,0)
 D SET^IBCNSP(START+4,OFFSET,"  Appt. Status: "_$$EXPAND^IBTRE(409.68,.12,$P(IBOE0,"^",12)))
"RTN","IBTRED",62,0)
 D SET^IBCNSP(START+5,OFFSET,"    Appt. Type: "_$$EXPAND^IBTRE(409.68,.1,$P(IBOE0,"^",10)))
"RTN","IBTRED",63,0)
 D SET^IBCNSP(START+6,OFFSET,"  Special Cond: "_$$ENCL(IBOE))
"RTN","IBTRED",64,0)
 Q
"RTN","IBTRED",65,0)
 ;
"RTN","IBTRED",66,0)
3 ; -- visit region for rx refill
"RTN","IBTRED",67,0)
 N PSONTALK,PSOTMP,PSOQTY
"RTN","IBTRED",68,0)
 S PSONTALK=1 ;PSORXN=+$P(IBTRND,"^",8),PSOFILL=+$P(IBTRND,"^",10)
"RTN","IBTRED",69,0)
 S X=+$P(IBTRND,"^",8)_"^"_+$P(IBTRND,"^",10) D EN^PSOCPVW
"RTN","IBTRED",70,0)
 ;if refill was deleted and EN^PSOCPVW doesn't return any data use IB API
"RTN","IBTRED",71,0)
 I '$D(PSOTMP) D PSOCPVW^IBNCPDPC(+$P(IBTRND,"^",2),+$P(IBTRND,"^",8),.PSOTMP)
"RTN","IBTRED",72,0)
 S PSOQTY=$$NCPDPQTY^PSSBPSUT(+$$RXAPI1^IBNCPUT1(+$P(IBTRND,"^",8),6,"I"),PSOTMP(52,+$P(IBTRND,"^",8),7,"E"))
"RTN","IBTRED",73,0)
 D SET^IBCNSP(START+2,OFFSET,"Prescription #: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")))
"RTN","IBTRED",74,0)
 ;I $P(IBTRND,"^",10)=0 D SET^IBCNSP(START+3,OFFSET,"     Fill Date: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),22,"E")))
"RTN","IBTRED",75,0)
 ;I +$P(IBTRND,"^",10) D SET^IBCNSP(START+3,OFFSET,"   Refill Date: "_$G(PSOTMP(52.1,+$P(IBTRND,"^",10),.01,"E")))
"RTN","IBTRED",76,0)
 I $P(IBTRND,"^",10)=0 D SET^IBCNSP(START+3,OFFSET,"     Fill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBTRED",77,0)
 I +$P(IBTRND,"^",10) D SET^IBCNSP(START+3,OFFSET,"   Refill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBTRED",78,0)
 D SET^IBCNSP(START+4,OFFSET,"          Drug: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),6,"E")))
"RTN","IBTRED",79,0)
 D SET^IBCNSP(START+5,OFFSET,"   Rx Quantity: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),7,"E")),8))
"RTN","IBTRED",80,0)
 D SET^IBCNSP(START+6,OFFSET," Bill Quantity:  "_$J($P(PSOQTY,"^"),11)_" "_$P(PSOQTY,"^",2))
"RTN","IBTRED",81,0)
 D SET^IBCNSP(START+7,OFFSET,"   Days Supply: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),8,"E")),8))
"RTN","IBTRED",82,0)
 D SET^IBCNSP(START+8,OFFSET,"          NDC#: "_$$GETNDC^PSONDCUT(+$P(IBTRND,"^",8),$P(IBTRND,"^",10)))
"RTN","IBTRED",83,0)
 D SET^IBCNSP(START+9,OFFSET,"     Physician: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),4,"E")))
"RTN","IBTRED",84,0)
 Q
"RTN","IBTRED",85,0)
 ;
"RTN","IBTRED",86,0)
4 ; -- Visit region for prosthetics
"RTN","IBTRED",87,0)
 D 4^IBTRED01
"RTN","IBTRED",88,0)
 Q
"RTN","IBTRED",89,0)
 ;
"RTN","IBTRED",90,0)
HELP ; -- help code
"RTN","IBTRED",91,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBTRED",92,0)
 Q
"RTN","IBTRED",93,0)
 ;
"RTN","IBTRED",94,0)
EXIT ; -- exit code
"RTN","IBTRED",95,0)
 K VALMQUIT,IBTRN
"RTN","IBTRED",96,0)
 D CLEAN^VALM10,FULL^VALM1
"RTN","IBTRED",97,0)
 Q
"RTN","IBTRED",98,0)
 ;
"RTN","IBTRED",99,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBTRED",100,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBTRED",101,0)
 Q
"RTN","IBTRED",102,0)
 ;
"RTN","IBTRED",103,0)
ETYP(IBTRN) ; -- Expand type of epidose and date
"RTN","IBTRED",104,0)
 N IBY S IBY=""
"RTN","IBTRED",105,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)) I IBTRND="" G ETYPQ
"RTN","IBTRED",106,0)
 S IBETYPD=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",107,0)
 I IBETYPD="" G ETYPQ
"RTN","IBTRED",108,0)
 S IBY=$P(IBETYPD,"^")_" on "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P")
"RTN","IBTRED",109,0)
ETYPQ Q IBY
"RTN","IBTRED",110,0)
 ;
"RTN","IBTRED",111,0)
ENCL(IBOE) ; -- output format of classifications
"RTN","IBTRED",112,0)
 N I,X,IBCL,IBCL1 S IBCL=""
"RTN","IBTRED",113,0)
 I '$G(IBOE) G ENCLQ
"RTN","IBTRED",114,0)
 S IBCL1=$$ENCL^IBAMTS2(+IBOE)
"RTN","IBTRED",115,0)
 F I=1:1:8 S X=$P(IBCL1,"^",I) S:X IBCL=IBCL_$S(I=1:"AO",I=2:"IR",I=3:"SC",I=4:"SWA",I=5:"MST",I=6:"HNC",I=7:"CV",I=8:"SHAD",1:"")_"  "
"RTN","IBTRED",116,0)
ENCLQ Q IBCL
"RTN","IBTRED",117,0)
 ;
"UP",366.14,366.141,-1)
366.14^1
"UP",366.14,366.141,0)
366.141
"VER")
8.0^22.0
"^DD",366.14,366.141,.09,0)
E-PHARMACY DIVISION^P9002313.56'^BPS(9002313.56,^0;9^Q
"^DD",366.14,366.141,.09,21,0)
^^1^1^3070216^
"^DD",366.14,366.141,.09,21,1,0)
E-Pharmacy division (BPS PHARMACY).
"^DD",366.14,366.141,.09,"DT")
3070216
"^DD",366.14,366.141,.15,0)
MEDICAL CENTER DIVISION^P40.8'^DG(40.8,^1;5^Q
"^DD",366.14,366.141,.15,3)
Select a division
"^DD",366.14,366.141,.15,21,0)
^.001^1^1^3070216^^^
"^DD",366.14,366.141,.15,21,1,0)
Division identifier
"^DD",366.14,366.141,.15,"DT")
3070216
"^DD",366.14,366.141,.401,0)
AO^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;1^Q
"^DD",366.14,366.141,.401,3)
Enter Agent Orange indicator
"^DD",366.14,366.141,.401,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.401,21,1,0)
Agent Orange indicator
"^DD",366.14,366.141,.401,"DT")
3070730
"^DD",366.14,366.141,.402,0)
CV^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;2^Q
"^DD",366.14,366.141,.402,3)
Enter Combat Veteran indicator
"^DD",366.14,366.141,.402,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.402,21,1,0)
Combat Veteran indicator
"^DD",366.14,366.141,.402,"DT")
3070730
"^DD",366.14,366.141,.403,0)
SWA^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;3^Q
"^DD",366.14,366.141,.403,3)
Enter Southwest Asia indicator
"^DD",366.14,366.141,.403,21,0)
^.001^1^1^3070730^^^
"^DD",366.14,366.141,.403,21,1,0)
Southwest Asia indicator.
"^DD",366.14,366.141,.403,"DT")
3070730
"^DD",366.14,366.141,.404,0)
IR^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;4^Q
"^DD",366.14,366.141,.404,3)
Enter Ionizing radiation exposure indicator
"^DD",366.14,366.141,.404,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.404,21,1,0)
Ionizing radiation exposure indicator
"^DD",366.14,366.141,.404,"DT")
3070730
"^DD",366.14,366.141,.405,0)
MST^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;5^Q
"^DD",366.14,366.141,.405,3)
Enter Military Sexual trauma indicator
"^DD",366.14,366.141,.405,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.405,21,1,0)
Military Sexual trauma indicator
"^DD",366.14,366.141,.405,"DT")
3070730
"^DD",366.14,366.141,.406,0)
HNC^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;6^Q
"^DD",366.14,366.141,.406,3)
Enter Head/neck cancer indicator
"^DD",366.14,366.141,.406,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.406,21,1,0)
Head/neck cancer indicator
"^DD",366.14,366.141,.406,"DT")
3070730
"^DD",366.14,366.141,.407,0)
SC^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;7^Q
"^DD",366.14,366.141,.407,3)
Enter Service Connected indicator
"^DD",366.14,366.141,.407,21,0)
^.001^1^1^3070730^^
"^DD",366.14,366.141,.407,21,1,0)
Service Connected indicator
"^DD",366.14,366.141,.407,"DT")
3070730
"^DD",366.14,366.141,.408,0)
SHAD^S^0:NO;1:YES;2:NO ANSWER;3:OVERRIDDEN;^4;8^Q
"^DD",366.14,366.141,.408,3)
Enter Project 112/SHAD indicator
"^DD",366.14,366.141,.408,21,0)
^.001^1^1^3070803^^
"^DD",366.14,366.141,.408,21,1,0)
Project 112/SHAD indicator
"^DD",366.14,366.141,.408,"DT")
3070803
**END**
**END**
