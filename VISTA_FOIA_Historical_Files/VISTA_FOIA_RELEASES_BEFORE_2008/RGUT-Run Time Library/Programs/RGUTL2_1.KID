KIDS Distribution saved on Mar 22, 1999@08:59:31
BUILT ON 3/22/99
**KIDS**:RUN TIME LIBRARY 2.1^

**INSTALL NAME**
RUN TIME LIBRARY 2.1
"BLD",162,0)
RUN TIME LIBRARY 2.1^RUN TIME LIBRARY^0^2990318^y
"BLD",162,1,0)
^^28^28^2990318^^
"BLD",162,1,1,0)
The pre-init routine will change the name in the package file from
"BLD",162,1,2,0)
CIRN RUN TIME LIBRARY to RUN TIME LIBRARY if it already exists in 
"BLD",162,1,3,0)
the file.
"BLD",162,1,4,0)
 
"BLD",162,1,5,0)
This is the set of routines common to all modules occupying the RG namespace.  
"BLD",162,1,6,0)
They perform generic functions.  
"BLD",162,1,7,0)
 
"BLD",162,1,8,0)
In this release of the runtime library, several routines have been 
"BLD",162,1,9,0)
renamed under the RGUT subnamespace.  The original routines are marked 
"BLD",162,1,10,0)
as obsolete and will be eliminated in a future release (no sooner 
"BLD",162,1,11,0)
than one year after the release date for this version).  The routines 
"BLD",162,1,12,0)
are:
"BLD",162,1,13,0)
 
"BLD",162,1,14,0)
RGCVTDT        Call $$^RGCVTDT replaced by $$ENTRY^RGUTDT; same arguments
"BLD",162,1,15,0)
RGCVTUU        Replaced by RGUTUU; same entry points
"BLD",162,1,16,0)
RGINIT*        Replaced by RGUTIN*
"BLD",162,1,17,0)
RGMSCALR       Replaced by RGUTALR; same entry points
"BLD",162,1,18,0)
RGMSCDAT       Replaced by RGUTDAT; same entry points
"BLD",162,1,19,0)
RGMSCDIC       Call $$^RGMSCDIC replaced by ENTRY^RGUTDIC; same arguments
"BLD",162,1,20,0)
RGMSCEDT       Replaced by RGUTEDT; same entry points
"BLD",162,1,21,0)
RGMSCIMP       Replaced by RGUTIMP; same entry points
"BLD",162,1,22,0)
RGMSCLK*       Replaced by RGUTLK*; same entry points
"BLD",162,1,23,0)
RGMSCMTL       Replaced by RGUTMTL; same entry points
"BLD",162,1,24,0)
RGMSCTSK       Replaced by RGUTTSK; same entry points
"BLD",162,1,25,0)
RGMSCUSR       Replaced by RGUTUSR; same entry points
"BLD",162,1,26,0)
RGXY           $$^RGXY replaced by $$XY^RGUT; same arguments
"BLD",162,1,27,0)
RGZOSF*        Replaced by RGUTOS*; same entry points except for 
"BLD",162,1,28,0)
               elimination of math functions.
"BLD",162,4,0)
^9.64PA^^
"BLD",162,"ABNS",0)
^9.66A^1^1
"BLD",162,"ABNS",1,0)
RG
"BLD",162,"ABNS",1,1,0)
^9.661A^^
"BLD",162,"ABNS","B","RG",1)

"BLD",162,"ABPKG")
n^n
"BLD",162,"INI")
EN^RGUTPRE
"BLD",162,"INIT")
RGUTIN
"BLD",162,"KRN",0)
^9.67PA^771^18
"BLD",162,"KRN",.4,0)
.4
"BLD",162,"KRN",.4,"NM",0)
^9.68A^^
"BLD",162,"KRN",.401,0)
.401
"BLD",162,"KRN",.402,0)
.402
"BLD",162,"KRN",.403,0)
.403
"BLD",162,"KRN",.5,0)
.5
"BLD",162,"KRN",.84,0)
.84
"BLD",162,"KRN",3.6,0)
3.6
"BLD",162,"KRN",3.8,0)
3.8
"BLD",162,"KRN",9.2,0)
9.2
"BLD",162,"KRN",9.8,0)
9.8
"BLD",162,"KRN",9.8,"NM",0)
^9.68A^62^51
"BLD",162,"KRN",9.8,"NM",1,0)
RGCVTDT^^0^B60867
"BLD",162,"KRN",9.8,"NM",2,0)
RGCVTUU^^0^B66644
"BLD",162,"KRN",9.8,"NM",3,0)
RGINIT^^0^B9079
"BLD",162,"KRN",9.8,"NM",4)
^^^
"BLD",162,"KRN",9.8,"NM",4,0)
RGINIT0^^1^B1212009
"BLD",162,"KRN",9.8,"NM",5)
^^^
"BLD",162,"KRN",9.8,"NM",5,0)
RGINIT16^^1^B4750893
"BLD",162,"KRN",9.8,"NM",6)
^^^
"BLD",162,"KRN",9.8,"NM",6,0)
RGINIT8^^1^B5283495
"BLD",162,"KRN",9.8,"NM",7,0)
RGMSCALR^^0^B208970
"BLD",162,"KRN",9.8,"NM",9,0)
RGMSCDAT^^0^B552161
"BLD",162,"KRN",9.8,"NM",10,0)
RGMSCDIC^^0^B68614
"BLD",162,"KRN",9.8,"NM",11,0)
RGMSCEDT^^0^B587454
"BLD",162,"KRN",9.8,"NM",12,0)
RGMSCIMP^^0^B73882
"BLD",162,"KRN",9.8,"NM",13)
^^^
"BLD",162,"KRN",9.8,"NM",13,0)
RGMSCLK2^^1^B47449716
"BLD",162,"KRN",9.8,"NM",14,0)
RGMSCLKP^^0^B780276
"BLD",162,"KRN",9.8,"NM",15,0)
RGMSCMTL^^0^B541269
"BLD",162,"KRN",9.8,"NM",16,0)
RGMSCTSK^^0^B301668
"BLD",162,"KRN",9.8,"NM",17,0)
RGMSCUSR^^0^B99519
"BLD",162,"KRN",9.8,"NM",18,0)
RGUT^^0^B28415462
"BLD",162,"KRN",9.8,"NM",23,0)
RGUTRRC^^0^B4048599
"BLD",162,"KRN",9.8,"NM",24,0)
RGUTRRT^^0^B6342466
"BLD",162,"KRN",9.8,"NM",25)
^^^
"BLD",162,"KRN",9.8,"NM",25,0)
RGUTSCH^^1^B15845555
"BLD",162,"KRN",9.8,"NM",26,0)
RGUTSRV^^0^B1691132
"BLD",162,"KRN",9.8,"NM",27,0)
RGUTSTX^^0^B16763820
"BLD",162,"KRN",9.8,"NM",28,0)
RGUTSTX0^^0^B17598407
"BLD",162,"KRN",9.8,"NM",29,0)
RGUTSTX1^^0^B19881115
"BLD",162,"KRN",9.8,"NM",30,0)
RGXY^^0^B25510
"BLD",162,"KRN",9.8,"NM",31)
^^^
"BLD",162,"KRN",9.8,"NM",31,0)
RGZOSF1^^1^B10236394
"BLD",162,"KRN",9.8,"NM",32)
^^^
"BLD",162,"KRN",9.8,"NM",32,0)
RGINIT18^^1^B2623402
"BLD",162,"KRN",9.8,"NM",33,0)
RGUTALR^^0^B1320524
"BLD",162,"KRN",9.8,"NM",34,0)
RGUTBIG^^0^B14593609
"BLD",162,"KRN",9.8,"NM",35,0)
RGUTDAT^^0^B12975257
"BLD",162,"KRN",9.8,"NM",36,0)
RGUTDIC^^0^B27837575
"BLD",162,"KRN",9.8,"NM",37,0)
RGUTDT^^0^B4487196
"BLD",162,"KRN",9.8,"NM",38,0)
RGUTEDT^^0^B46816238
"BLD",162,"KRN",9.8,"NM",44,0)
RGUTIMP^^0^B10839885
"BLD",162,"KRN",9.8,"NM",45,0)
RGUTIN^^0^B3241713
"BLD",162,"KRN",9.8,"NM",46,0)
RGUTIN0^^0^B1165234
"BLD",162,"KRN",9.8,"NM",47,0)
RGUTIN16^^0^B3261417
"BLD",162,"KRN",9.8,"NM",48,0)
RGUTIN18^^0^B2555614
"BLD",162,"KRN",9.8,"NM",49,0)
RGUTIN8^^0^B3307420
"BLD",162,"KRN",9.8,"NM",50,0)
RGUTLK2^^0^B48245359
"BLD",162,"KRN",9.8,"NM",51,0)
RGUTLKP^^0^B28169983
"BLD",162,"KRN",9.8,"NM",52,0)
RGUTMTL^^0^B13394927
"BLD",162,"KRN",9.8,"NM",53,0)
RGUTOS^^0^B9601175
"BLD",162,"KRN",9.8,"NM",54,0)
RGUTOS1^^0^B9592360
"BLD",162,"KRN",9.8,"NM",56,0)
RGUTRPC^^0^B1136513
"BLD",162,"KRN",9.8,"NM",57,0)
RGUTTSK^^0^B969302
"BLD",162,"KRN",9.8,"NM",58,0)
RGUTUSR^^0^B3690301
"BLD",162,"KRN",9.8,"NM",59,0)
RGUTUU^^0^B1767593
"BLD",162,"KRN",9.8,"NM",60,0)
RGZOSF^^0^B1714601
"BLD",162,"KRN",9.8,"NM",61,0)
RGUTFTP^^0^B5979349
"BLD",162,"KRN",9.8,"NM",62,0)
RGUTPRE^^0^B261071
"BLD",162,"KRN",9.8,"NM","B","RGCVTDT",1)

"BLD",162,"KRN",9.8,"NM","B","RGCVTUU",2)

"BLD",162,"KRN",9.8,"NM","B","RGINIT",3)

"BLD",162,"KRN",9.8,"NM","B","RGINIT0",4)

"BLD",162,"KRN",9.8,"NM","B","RGINIT16",5)

"BLD",162,"KRN",9.8,"NM","B","RGINIT18",32)

"BLD",162,"KRN",9.8,"NM","B","RGINIT8",6)

"BLD",162,"KRN",9.8,"NM","B","RGMSCALR",7)

"BLD",162,"KRN",9.8,"NM","B","RGMSCDAT",9)

"BLD",162,"KRN",9.8,"NM","B","RGMSCDIC",10)

"BLD",162,"KRN",9.8,"NM","B","RGMSCEDT",11)

"BLD",162,"KRN",9.8,"NM","B","RGMSCIMP",12)

"BLD",162,"KRN",9.8,"NM","B","RGMSCLK2",13)

"BLD",162,"KRN",9.8,"NM","B","RGMSCLKP",14)

"BLD",162,"KRN",9.8,"NM","B","RGMSCMTL",15)

"BLD",162,"KRN",9.8,"NM","B","RGMSCTSK",16)

"BLD",162,"KRN",9.8,"NM","B","RGMSCUSR",17)

"BLD",162,"KRN",9.8,"NM","B","RGUT",18)

"BLD",162,"KRN",9.8,"NM","B","RGUTALR",33)

"BLD",162,"KRN",9.8,"NM","B","RGUTBIG",34)

"BLD",162,"KRN",9.8,"NM","B","RGUTDAT",35)

"BLD",162,"KRN",9.8,"NM","B","RGUTDIC",36)

"BLD",162,"KRN",9.8,"NM","B","RGUTDT",37)

"BLD",162,"KRN",9.8,"NM","B","RGUTEDT",38)

"BLD",162,"KRN",9.8,"NM","B","RGUTFTP",61)

"BLD",162,"KRN",9.8,"NM","B","RGUTIMP",44)

"BLD",162,"KRN",9.8,"NM","B","RGUTIN",45)

"BLD",162,"KRN",9.8,"NM","B","RGUTIN0",46)

"BLD",162,"KRN",9.8,"NM","B","RGUTIN16",47)

"BLD",162,"KRN",9.8,"NM","B","RGUTIN18",48)

"BLD",162,"KRN",9.8,"NM","B","RGUTIN8",49)

"BLD",162,"KRN",9.8,"NM","B","RGUTLK2",50)

"BLD",162,"KRN",9.8,"NM","B","RGUTLKP",51)

"BLD",162,"KRN",9.8,"NM","B","RGUTMTL",52)

"BLD",162,"KRN",9.8,"NM","B","RGUTOS",53)

"BLD",162,"KRN",9.8,"NM","B","RGUTOS1",54)

"BLD",162,"KRN",9.8,"NM","B","RGUTPRE",62)

"BLD",162,"KRN",9.8,"NM","B","RGUTRPC",56)

"BLD",162,"KRN",9.8,"NM","B","RGUTRRC",23)

"BLD",162,"KRN",9.8,"NM","B","RGUTRRT",24)

"BLD",162,"KRN",9.8,"NM","B","RGUTSCH",25)

"BLD",162,"KRN",9.8,"NM","B","RGUTSRV",26)

"BLD",162,"KRN",9.8,"NM","B","RGUTSTX",27)

"BLD",162,"KRN",9.8,"NM","B","RGUTSTX0",28)

"BLD",162,"KRN",9.8,"NM","B","RGUTSTX1",29)

"BLD",162,"KRN",9.8,"NM","B","RGUTTSK",57)

"BLD",162,"KRN",9.8,"NM","B","RGUTUSR",58)

"BLD",162,"KRN",9.8,"NM","B","RGUTUU",59)

"BLD",162,"KRN",9.8,"NM","B","RGXY",30)

"BLD",162,"KRN",9.8,"NM","B","RGZOSF",60)

"BLD",162,"KRN",9.8,"NM","B","RGZOSF1",31)

"BLD",162,"KRN",19,0)
19
"BLD",162,"KRN",19,"NM",0)
^9.68A^^0
"BLD",162,"KRN",19.1,0)
19.1
"BLD",162,"KRN",101,0)
101
"BLD",162,"KRN",409.61,0)
409.61
"BLD",162,"KRN",771,0)
771
"BLD",162,"KRN",869.2,0)
869.2
"BLD",162,"KRN",870,0)
870
"BLD",162,"KRN",8994,0)
8994
"BLD",162,"KRN","B",.4,.4)

"BLD",162,"KRN","B",.401,.401)

"BLD",162,"KRN","B",.402,.402)

"BLD",162,"KRN","B",.403,.403)

"BLD",162,"KRN","B",.5,.5)

"BLD",162,"KRN","B",.84,.84)

"BLD",162,"KRN","B",3.6,3.6)

"BLD",162,"KRN","B",3.8,3.8)

"BLD",162,"KRN","B",9.2,9.2)

"BLD",162,"KRN","B",9.8,9.8)

"BLD",162,"KRN","B",19,19)

"BLD",162,"KRN","B",19.1,19.1)

"BLD",162,"KRN","B",101,101)

"BLD",162,"KRN","B",409.61,409.61)

"BLD",162,"KRN","B",771,771)

"BLD",162,"KRN","B",869.2,869.2)

"BLD",162,"KRN","B",870,870)

"BLD",162,"KRN","B",8994,8994)

"BLD",162,"QUES",0)
^9.62^^
"BLD",162,"REQB",0)
^9.611^^
"INI")
EN^RGUTPRE
"INIT")
RGUTIN
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",427,-1)
1^1
"PKG",427,0)
RUN TIME LIBRARY^RGUT^Run Time Library
"PKG",427,20,0)
^9.402P^^
"PKG",427,22,0)
^9.49I^1^1
"PKG",427,22,1,0)
2.1^2990318
"PKG",427,22,1,1,0)
^^28^28^2990322
"PKG",427,22,1,1,1,0)
The pre-init routine will change the name in the package file from
"PKG",427,22,1,1,2,0)
CIRN RUN TIME LIBRARY to RUN TIME LIBRARY if it already exists in 
"PKG",427,22,1,1,3,0)
the file.
"PKG",427,22,1,1,4,0)
 
"PKG",427,22,1,1,5,0)
This is the set of routines common to all modules occupying the RG namespace.  
"PKG",427,22,1,1,6,0)
They perform generic functions.  
"PKG",427,22,1,1,7,0)
 
"PKG",427,22,1,1,8,0)
In this release of the runtime library, several routines have been 
"PKG",427,22,1,1,9,0)
renamed under the RGUT subnamespace.  The original routines are marked 
"PKG",427,22,1,1,10,0)
as obsolete and will be eliminated in a future release (no sooner 
"PKG",427,22,1,1,11,0)
than one year after the release date for this version).  The routines 
"PKG",427,22,1,1,12,0)
are:
"PKG",427,22,1,1,13,0)
 
"PKG",427,22,1,1,14,0)
RGCVTDT        Call $$^RGCVTDT replaced by $$ENTRY^RGUTDT; same arguments
"PKG",427,22,1,1,15,0)
RGCVTUU        Replaced by RGUTUU; same entry points
"PKG",427,22,1,1,16,0)
RGINIT*        Replaced by RGUTIN*
"PKG",427,22,1,1,17,0)
RGMSCALR       Replaced by RGUTALR; same entry points
"PKG",427,22,1,1,18,0)
RGMSCDAT       Replaced by RGUTDAT; same entry points
"PKG",427,22,1,1,19,0)
RGMSCDIC       Call $$^RGMSCDIC replaced by ENTRY^RGUTDIC; same arguments
"PKG",427,22,1,1,20,0)
RGMSCEDT       Replaced by RGUTEDT; same entry points
"PKG",427,22,1,1,21,0)
RGMSCIMP       Replaced by RGUTIMP; same entry points
"PKG",427,22,1,1,22,0)
RGMSCLK*       Replaced by RGUTLK*; same entry points
"PKG",427,22,1,1,23,0)
RGMSCMTL       Replaced by RGUTMTL; same entry points
"PKG",427,22,1,1,24,0)
RGMSCTSK       Replaced by RGUTTSK; same entry points
"PKG",427,22,1,1,25,0)
RGMSCUSR       Replaced by RGUTUSR; same entry points
"PKG",427,22,1,1,26,0)
RGXY           $$^RGXY replaced by $$XY^RGUT; same arguments
"PKG",427,22,1,1,27,0)
RGZOSF*        Replaced by RGUTOS*; same entry points except for 
"PKG",427,22,1,1,28,0)
               elimination of math functions.
"PKG",427,"VERSION")
2.1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
51
"RTN","RGCVTDT")
0^1^B60867
"RTN","RGCVTDT",1,0)
RGCVTDT(RGDAT,RGFMT) ;CAIRO/DKM - FM date to formatted date;30-Jun-1998 08:54;DKM
"RTN","RGCVTDT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGCVTDT",3,0)
 ;=================================================================
"RTN","RGCVTDT",4,0)
 Q $$ENTRY^RGUTDT(.RGDAT,.RGFMT)
"RTN","RGCVTUU")
0^2^B66644
"RTN","RGCVTUU",1,0)
RGCVTUU ;CAIRO/DKM - UUEncode and UUDecode functions.;04-Sep-1998 11:26;DKM
"RTN","RGCVTUU",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGCVTUU",3,0)
 ;=================================================================
"RTN","RGCVTUU",4,0)
ENCODE(X) ;
"RTN","RGCVTUU",5,0)
 Q $$ENCODE^RGUTUU(.X)
"RTN","RGCVTUU",6,0)
DECODE(X) ;
"RTN","RGCVTUU",7,0)
 Q $$DECODE^RGUTUU(.X)
"RTN","RGINIT")
0^3^B9079
"RTN","RGINIT",1,0)
RGINIT ;CAIRO/DKM - Platform specific inits;30-Jun-1998 08:58;DKM
"RTN","RGINIT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGINIT",3,0)
 ;=================================================================
"RTN","RGINIT",4,0)
 G ^RGUTIN
"RTN","RGINIT0")
1^4
"RTN","RGINIT16")
1^5
"RTN","RGINIT18")
1^32
"RTN","RGINIT8")
1^6
"RTN","RGMSCALR")
0^7^B208970
"RTN","RGMSCALR",1,0)
RGMSCALR ;CAIRO/DKM - Send alert to user(s) via kernel or mail;04-Sep-1998 11:26;DKM
"RTN","RGMSCALR",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCALR",3,0)
 ;=================================================================
"RTN","RGMSCALR",4,0)
 ; Old entry point
"RTN","RGMSCALR",5,0)
ALERT(XQAMSG,RGUSR) ;
"RTN","RGMSCALR",6,0)
 D ALERT^RGUTALR(.XQAMSG,.RGUSR)
"RTN","RGMSCALR",7,0)
 Q
"RTN","RGMSCALR",8,0)
MAIL(RGMSG,XMY,XMSUB,XMDUZ) ;
"RTN","RGMSCALR",9,0)
 D MAIL^RGUTALR(.RGMSG,.XMY,.XMSUB,.XMDUZ)
"RTN","RGMSCALR",10,0)
 Q
"RTN","RGMSCDAT")
0^9^B552161
"RTN","RGMSCDAT",1,0)
RGMSCDAT ;CAIRO/DKM - Date range input;04-Sep-1998 11:26;DKM
"RTN","RGMSCDAT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCDAT",3,0)
 ;=================================================================
"RTN","RGMSCDAT",4,0)
 ; Prompt for date range (normal format)
"RTN","RGMSCDAT",5,0)
NORMAL D NORMAL^RGUTDAT
"RTN","RGMSCDAT",6,0)
 Q
"RTN","RGMSCDAT",7,0)
 ; Prompt for date range (inverse format)
"RTN","RGMSCDAT",8,0)
INVRSE D INVRSE^RGUTDAT
"RTN","RGMSCDAT",9,0)
 Q
"RTN","RGMSCDAT",10,0)
 ; Prompt for starting date
"RTN","RGMSCDAT",11,0)
D1(RGOPT) ;
"RTN","RGMSCDAT",12,0)
 D D1^RGUTDAT(.RGOPT)
"RTN","RGMSCDAT",13,0)
 Q
"RTN","RGMSCDAT",14,0)
 ; Prompt for ending date
"RTN","RGMSCDAT",15,0)
D2(RGOPT) ;
"RTN","RGMSCDAT",16,0)
 D D2^RGUTDAT(.RGOPT)
"RTN","RGMSCDAT",17,0)
 Q
"RTN","RGMSCDAT",18,0)
 ; Prompt for a date
"RTN","RGMSCDAT",19,0)
ENTRY(%RGP,%RGOPT,%RGDAT,%RGX,%RGY,%RGTRP,%RGHLP) ;
"RTN","RGMSCDAT",20,0)
 Q $$ENTRY^RGUTDAT(.%RGP,.%RGOPT,.%RGDAT,.%RGX,.%RGY,.%RGTRP,.%RGHLP)
"RTN","RGMSCDIC")
0^10^B68614
"RTN","RGMSCDIC",1,0)
RGMSCDIC(%RGDIC,%RGCMD) ;CAIRO/DKM - Encapsulated FileMan API;30-Jun-1998 08:37;DKM
"RTN","RGMSCDIC",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCDIC",3,0)
 ;=================================================================
"RTN","RGMSCDIC",4,0)
 Q $$ENTRY^RGUTDIC(.%RGDIC,.%RGCMD)
"RTN","RGMSCEDT")
0^11^B587454
"RTN","RGMSCEDT",1,0)
RGMSCEDT ;CAIRO/DKM - Screen-oriented line editor;04-Sep-1998 11:26;DKM
"RTN","RGMSCEDT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCEDT",3,0)
 ;=================================================================
"RTN","RGMSCEDT",4,0)
 ; Old entry point
"RTN","RGMSCEDT",5,0)
ENTRY(RGDATA,RGLEN,RGX,RGY,RGVALD,RGOPT,RGDISV,RGTERM,RGABRT,RGRM,RGQUIT) ;
"RTN","RGMSCEDT",6,0)
 Q $$ENTRY^RGUTEDT(.RGDATA,.RGLEN,.RGX,.RGY,.RGVALD,.RGOPT,.RGDISV,.RGTERM,.RGABRT,.RGRM,.RGQUIT)
"RTN","RGMSCIMP")
0^12^B73882
"RTN","RGMSCIMP",1,0)
RGMSCIMP(RGINP,RGTRACE) ;CAIRO/DKM - Import text into FileMan file;30-Jun-1998 08:38;DKM
"RTN","RGMSCIMP",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCIMP",3,0)
 ;=================================================================
"RTN","RGMSCIMP",4,0)
 Q $$ENTRY^RGUTIMP(.RGINP,.RGTRACE)
"RTN","RGMSCLK2")
1^13
"RTN","RGMSCLKP")
0^14^B780276
"RTN","RGMSCLKP",1,0)
RGMSCLKP ;CAIRO/DKM - File lookup utility;04-Sep-1998 11:26;DKM
"RTN","RGMSCLKP",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCLKP",3,0)
 ;=================================================================
"RTN","RGMSCLKP",4,0)
 ; Old entry point
"RTN","RGMSCLKP",5,0)
ENTRY(%RGDIC,%RGOPT,%RGPRMPT,%RGXRFS,%RGDATA,%RGSCN,%RGMUL,%RGX,%RGY,%RGSID,%RGTRP,%RGHLP) ;
"RTN","RGMSCLKP",6,0)
 Q $$ENTRY^RGUTLKP(.%RGDIC,.%RGOPT,.%RGPRMPT,.%RGXRFS,.%RGDATA,.%RGSCN,.%RGMUL,.%RGX,.%RGY,.%RGSID,.%RGTRP,.%RGHLP)
"RTN","RGMSCMTL")
0^15^B541269
"RTN","RGMSCMTL",1,0)
RGMSCMTL ;CAIRO/DKM - Multi-term lookup support ;04-Sep-1998 11:26;DKM
"RTN","RGMSCMTL",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCMTL",3,0)
 ;=================================================================
"RTN","RGMSCMTL",4,0)
 ; Parse term into component words (KWIC)
"RTN","RGMSCMTL",5,0)
PARSE2(RGTRM,RGRTN,RGMIN) ;
"RTN","RGMSCMTL",6,0)
 Q $$PARSE2^RGUTMTL(.RGTRM,.RGRTN,.RGMIN)
"RTN","RGMSCMTL",7,0)
 ; Parse term into component words
"RTN","RGMSCMTL",8,0)
PARSE(RGTRM,RGRTN,RGMIN) ;
"RTN","RGMSCMTL",9,0)
 Q $$PARSE^RGUTMTL(.RGTRM,.RGRTN,.RGMIN)
"RTN","RGMSCMTL",10,0)
 ; Create/delete an MTL cross reference for term
"RTN","RGMSCMTL",11,0)
XREF(RGRT,RGTRM,RGDA,RGDEL) ;
"RTN","RGMSCMTL",12,0)
 D XREF^RGUTMTL(.RGRT,.RGTRM,.RGDA,.RGDEL)
"RTN","RGMSCMTL",13,0)
 Q
"RTN","RGMSCMTL",14,0)
 ; Lookup a term in an MTL index
"RTN","RGMSCMTL",15,0)
LKP(RGRT,RGTRM,RGRTN,RGABR) ;
"RTN","RGMSCMTL",16,0)
 Q $$LKP^RGUTMTL(.RGRT,.RGTRM,.RGRTN,.RGABR)
"RTN","RGMSCTSK")
0^16^B301668
"RTN","RGMSCTSK",1,0)
RGMSCTSK ;CAIRO/DKM - Encapsulates TaskMan API ;04-Sep-1998 11:26;DKM
"RTN","RGMSCTSK",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCTSK",3,0)
 ;=================================================================
"RTN","RGMSCTSK",4,0)
QUEUE(ZTRTN,ZTDESC,ZTDTH,ZTSAVE,ZTIO,ZTUCI,ZTPRI) ;
"RTN","RGMSCTSK",5,0)
 Q $$QUEUE^RGUTTSK(.ZTRTN,.ZTDESC,.ZTDTH,.ZTSAVE,.ZTIO,.ZTUCI,.ZTPRI)
"RTN","RGMSCUSR")
0^17^B99519
"RTN","RGMSCUSR",1,0)
RGMSCUSR ;CAIRO/DKM - Parse recipient list;04-Sep-1998 11:26;DKM
"RTN","RGMSCUSR",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGMSCUSR",3,0)
 ;=================================================================
"RTN","RGMSCUSR",4,0)
ENTRY(RGUSR,RGOUT,RGLST) ;
"RTN","RGMSCUSR",5,0)
 D ENTRY^RGUTUSR(.RGUSR,.RGOUT,.RGLST)
"RTN","RGMSCUSR",6,0)
 Q
"RTN","RGUT")
0^18^B28415462
"RTN","RGUT",1,0)
RGUT ;CAIRO/DKM - General purpose utilities;17-Sep-1998 14:14;DKM
"RTN","RGUT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUT",3,0)
 ;=================================================================
"RTN","RGUT",4,0)
 ; Replaces delimited arguments in string, returning result
"RTN","RGUT",5,0)
MSG(%RGTXT,%RGDLM) ;
"RTN","RGUT",6,0)
 N %RGZ1,%RGZ2
"RTN","RGUT",7,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUT",8,0)
 S:$G(%RGDLM)="" %RGDLM="%"
"RTN","RGUT",9,0)
 S %RGZ2="",%RGTXT=$TR(%RGTXT,"~","^"),@$$TRAP^RGZOSF("M1^RGUT")
"RTN","RGUT",10,0)
 F  Q:%RGTXT=""  D
"RTN","RGUT",11,0)
 .S %RGZ2=%RGZ2_$P(%RGTXT,%RGDLM),%RGZ1=$P(%RGTXT,%RGDLM,2),%RGTXT=$P(%RGTXT,%RGDLM,3,999)
"RTN","RGUT",12,0)
 .I %RGZ1="" S:%RGTXT'="" %RGZ2=%RGZ2_%RGDLM
"RTN","RGUT",13,0)
 .E  X "S %RGZ2=%RGZ2_("_%RGZ1_")"
"RTN","RGUT",14,0)
M1 Q %RGZ2
"RTN","RGUT",15,0)
 ; Case-insensitive string comparison
"RTN","RGUT",16,0)
 ; Returns 0: X=Y, 1: X>Y, -1: X<Y
"RTN","RGUT",17,0)
STRICMP(X,Y) ;
"RTN","RGUT",18,0)
 S X=$$UP^XLFSTR(X),Y=$$UP^XLFSTR(Y)
"RTN","RGUT",19,0)
 Q $S(X=Y:0,X]]Y:1,1:-1)
"RTN","RGUT",20,0)
 ; Output an underline X bytes long
"RTN","RGUT",21,0)
UND(X) Q $$REPEAT^XLFSTR("-",$G(X,$G(IOM,80)))
"RTN","RGUT",22,0)
 ; Truncate a string if > Y bytes long
"RTN","RGUT",23,0)
TRUNC(X,Y) ;
"RTN","RGUT",24,0)
 Q $S($L(X)'>Y:X,1:$E(X,1,Y-3)_"...")
"RTN","RGUT",25,0)
 ; Formatting for singular/plural
"RTN","RGUT",26,0)
SNGPLR(RGNUM,RGSNG,RGPLR) ;
"RTN","RGUT",27,0)
 N RGZ
"RTN","RGUT",28,0)
 S RGZ=RGSNG?.E1L.E,RGPLR=$G(RGPLR,RGSNG_$S(RGZ:"s",1:"S"))
"RTN","RGUT",29,0)
 Q $S('RGNUM:$S(RGZ:"no ",1:"NO ")_RGPLR,RGNUM=1:"1 "_RGSNG,1:RGNUM_" "_RGPLR)
"RTN","RGUT",30,0)
 ; Convert code to external form from set of codes
"RTN","RGUT",31,0)
SET(RGCODE,RGSET) ;
"RTN","RGUT",32,0)
 N RGZ,RGZ1
"RTN","RGUT",33,0)
 F RGZ=1:1:$L(RGSET,";") D  Q:RGZ1'=""
"RTN","RGUT",34,0)
 .S RGZ1=$P(RGSET,";",RGZ),RGZ1=$S($P(RGZ1,":")=RGCODE:$P(RGZ1,":",2),1:"")
"RTN","RGUT",35,0)
 Q RGZ1
"RTN","RGUT",36,0)
 ; Replace each occurrence of RGOLD in RGSTR with RGNEW
"RTN","RGUT",37,0)
SUBST(RGSTR,RGOLD,RGNEW) ;
"RTN","RGUT",38,0)
 N RGP,RGL1,RGL2
"RTN","RGUT",39,0)
 S RGNEW=$G(RGNEW),RGP=0,RGL1=$L(RGOLD),RGL2=$L(RGNEW)
"RTN","RGUT",40,0)
 F  S RGP=$F(RGSTR,RGOLD,RGP) Q:'RGP  D
"RTN","RGUT",41,0)
 .S RGSTR=$E(RGSTR,1,RGP-RGL1-1)_RGNEW_$E(RGSTR,RGP,9999)
"RTN","RGUT",42,0)
 .S RGP=RGP-RGL1+RGL2
"RTN","RGUT",43,0)
 Q RGSTR
"RTN","RGUT",44,0)
 ; Trim leading (Y=-1)/trailing (Y=1)/leading & trailing (Y=0) spaces
"RTN","RGUT",45,0)
TRIM(X,Y) ;
"RTN","RGUT",46,0)
 N RGZ1,RGZ2
"RTN","RGUT",47,0)
 S Y=+$G(Y),RGZ1=1,RGZ2=$L(X)
"RTN","RGUT",48,0)
 I Y'>0 F RGZ1=1:1 Q:$A(X,RGZ1)'=32
"RTN","RGUT",49,0)
 I Y'<0 F RGZ2=RGZ2:-1 Q:$A(X,RGZ2)'=32
"RTN","RGUT",50,0)
 Q $E(X,RGZ1,RGZ2)
"RTN","RGUT",51,0)
 ; Format a number with commas
"RTN","RGUT",52,0)
FMTNUM(RGNUM) ;
"RTN","RGUT",53,0)
 N RGZ,RGZ1,RGZ2
"RTN","RGUT",54,0)
 S:RGNUM<0 RGNUM=-RGNUM,RGZ2="-"
"RTN","RGUT",55,0)
 F RGZ=$L(RGNUM):-3:1 S RGZ1=$E(RGNUM,RGZ-2,RGZ)_$S($D(RGZ1):","_RGZ1,1:"")
"RTN","RGUT",56,0)
 Q $G(RGZ2)_$G(RGZ1)
"RTN","RGUT",57,0)
 ; Convert X to base Y padded to length L
"RTN","RGUT",58,0)
BASE(X,Y,L) ;
"RTN","RGUT",59,0)
 Q:(Y<2)!(Y>62) ""
"RTN","RGUT",60,0)
 N RGZ,RGZ1
"RTN","RGUT",61,0)
 S RGZ1="",X=$S(X<0:-X,1:X)
"RTN","RGUT",62,0)
 F  S RGZ=X#Y,X=X\Y,RGZ1=$C($S(RGZ<10:RGZ+48,RGZ<36:RGZ+55,1:RGZ+61))_RGZ1 Q:'X
"RTN","RGUT",63,0)
 Q $S('$G(L):RGZ1,1:$$REPEAT^XLFSTR(0,L-$L(RGZ1))_$E(RGZ1,1,L))
"RTN","RGUT",64,0)
 ; Convert a string to its SOUNDEX equivalent
"RTN","RGUT",65,0)
SOUNDEX(RGVALUE) ;
"RTN","RGUT",66,0)
 N RGCODE,RGSOUND,RGPREV,RGCHAR,RGPOS,RGTRANS
"RTN","RGUT",67,0)
 S RGCODE="01230129022455012623019202"
"RTN","RGUT",68,0)
 S RGSOUND=$C($A(RGVALUE)-(RGVALUE?1L.E*32))
"RTN","RGUT",69,0)
 S RGPREV=$E(RGCODE,$A(RGVALUE)-64)
"RTN","RGUT",70,0)
 F RGPOS=2:1 S RGCHAR=$E(RGVALUE,RGPOS) Q:","[RGCHAR  D  Q:$L(RGSOUND)=4
"RTN","RGUT",71,0)
 .Q:RGCHAR'?1A
"RTN","RGUT",72,0)
 .S RGTRANS=$E(RGCODE,$A(RGCHAR)-$S(RGCHAR?1U:64,1:96))
"RTN","RGUT",73,0)
 .Q:RGTRANS=RGPREV!(RGTRANS=9)
"RTN","RGUT",74,0)
 .S RGPREV=RGTRANS
"RTN","RGUT",75,0)
 .S:RGTRANS'=0 RGSOUND=RGSOUND_RGTRANS
"RTN","RGUT",76,0)
 Q $E(RGSOUND_"000",1,4)
"RTN","RGUT",77,0)
 ; Display formatted title
"RTN","RGUT",78,0)
TITLE(RGTTL,RGVER,RGFN) ;
"RTN","RGUT",79,0)
 I '$D(IOM) N IOM,IOF S IOM=80,IOF="#"
"RTN","RGUT",80,0)
 S RGVER=$G(RGVER,"1.0")
"RTN","RGUT",81,0)
 S:RGVER RGVER="Version "_RGVER
"RTN","RGUT",82,0)
 U $G(IO,$I)
"RTN","RGUT",83,0)
 W @IOF,$S(IO=IO(0):$C(27,91,55,109),1:""),*13,$$^RGCVTDT(+$H_","),?(IOM-$L(RGTTL)\2),RGTTL,?(IOM-$L(RGVER)),RGVER,!,$S(IO=IO(0):$C(27,91,109),1:$$UND),!
"RTN","RGUT",84,0)
 W:$D(RGFN) ?(IOM-$L(RGFN)\2),RGFN,!
"RTN","RGUT",85,0)
 Q
"RTN","RGUT",86,0)
 ; Create a unique 8.3 filename
"RTN","RGUT",87,0)
UFN(Y) N X
"RTN","RGUT",88,0)
 S Y=$E($G(Y),1,3),X=$$BASE($R(100)_$J_$TR($H,","),36,$S($L(Y):8,1:11))_Y
"RTN","RGUT",89,0)
 Q $E(X,1,8)_"."_$E(X,9,11)
"RTN","RGUT",90,0)
 ; Return formatted SSN
"RTN","RGUT",91,0)
SSN(X) Q $S(X="":X,1:$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,12))
"RTN","RGUT",92,0)
 ; Performs security check on patient access
"RTN","RGUT",93,0)
DGSEC(Y) N DIC
"RTN","RGUT",94,0)
 S DIC(0)="E"
"RTN","RGUT",95,0)
 D ^DGSEC
"RTN","RGUT",96,0)
 Q $S(Y<1:0,1:Y)
"RTN","RGUT",97,0)
 ; Displays spinning icon to indicate progress
"RTN","RGUT",98,0)
WORKING(RGST,RGP,RGS) ;
"RTN","RGUT",99,0)
 Q:'$D(IO(0))!$D(ZTQUEUED) 0
"RTN","RGUT",100,0)
 N RGZ
"RTN","RGUT",101,0)
 S RGZ(0)=$I,RGS=$G(RGS,"|/-\"),RGST=+$G(RGST)
"RTN","RGUT",102,0)
 S RGST=$S(RGST<0:0,1:RGST#$L(RGS)+1)
"RTN","RGUT",103,0)
 U IO(0)
"RTN","RGUT",104,0)
 W:'$G(RGP) *8,$S(RGST:$E(RGS,RGST),1:" ")
"RTN","RGUT",105,0)
 R *RGZ:0
"RTN","RGUT",106,0)
 U RGZ(0)
"RTN","RGUT",107,0)
 Q RGZ=94
"RTN","RGUT",108,0)
 ; Ask for Y/N response
"RTN","RGUT",109,0)
ASK(RGP,RGD,RGZ) ;
"RTN","RGUT",110,0)
 S RGD=$G(RGD,"N")
"RTN","RGUT",111,0)
 S RGZ=$$GETCH(RGP_"? ","YN")
"RTN","RGUT",112,0)
 S:RGZ="" RGZ=$E(RGD)
"RTN","RGUT",113,0)
 W !
"RTN","RGUT",114,0)
 Q $S(RGZ[U:"",1:RGZ="Y")
"RTN","RGUT",115,0)
 ; Pause for user response
"RTN","RGUT",116,0)
PAUSE(RGP,RGX,RGY) ;
"RTN","RGUT",117,0)
 Q $$GETCH($G(RGP,"Press RETURN or ENTER to continue..."),U,.RGX,.RGY)
"RTN","RGUT",118,0)
 ; Single character read
"RTN","RGUT",119,0)
GETCH(RGP,RGV,RGX,RGY,RGT,RGD) ;
"RTN","RGUT",120,0)
 N RGZ,RGC
"RTN","RGUT",121,0)
 W:$D(RGX)!$D(RGY) $$XY($G(RGX,$X),$G(RGY,$Y))
"RTN","RGUT",122,0)
 W $G(RGP)
"RTN","RGUT",123,0)
 S RGT=$G(RGT,$G(DTIME,999999999999)),RGD=$G(RGD,U),RGC=""
"RTN","RGUT",124,0)
 S:$D(RGV) RGV=$$UP^XLFSTR(RGV)_U
"RTN","RGUT",125,0)
 F  D  Q:'$L(RGZ)
"RTN","RGUT",126,0)
 .R RGZ#1:RGT
"RTN","RGUT",127,0)
 .E  S RGC=RGD Q
"RTN","RGUT",128,0)
 .W *8
"RTN","RGUT",129,0)
 .Q:'$L(RGZ)
"RTN","RGUT",130,0)
 .S RGZ=$$UP^XLFSTR(RGZ)
"RTN","RGUT",131,0)
 .I $D(RGV) D
"RTN","RGUT",132,0)
 ..I RGV[RGZ S RGC=RGZ
"RTN","RGUT",133,0)
 ..E  W *7,*32,*8 S RGC=""
"RTN","RGUT",134,0)
 .E  S RGC=RGZ
"RTN","RGUT",135,0)
 W !
"RTN","RGUT",136,0)
 Q RGC
"RTN","RGUT",137,0)
 ; Position cursor
"RTN","RGUT",138,0)
XY(DX,DY) ;
"RTN","RGUT",139,0)
 D:$G(IOXY)="" HOME^%ZIS
"RTN","RGUT",140,0)
 S DX=$S(+$G(DX)>0:+DX,1:0),DY=$S(+$G(DY)>0:+DY,1:0),$X=0
"RTN","RGUT",141,0)
 X IOXY
"RTN","RGUT",142,0)
 S $X=DX,$Y=DY
"RTN","RGUT",143,0)
 Q ""
"RTN","RGUT",144,0)
 ; Parameterized calls to date routines
"RTN","RGUT",145,0)
%DT(RGD,RGX) ;
"RTN","RGUT",146,0)
 N %D,%P,%C,%H,%I,%X,%Y,RGZ
"RTN","RGUT",147,0)
 D DT^DILF($G(RGX),RGD,.RGZ)
"RTN","RGUT",148,0)
 W:$D(RGZ(0)) RGZ(0),!
"RTN","RGUT",149,0)
 Q $G(RGZ,-1)
"RTN","RGUT",150,0)
%DTC(X1,X2) ;
"RTN","RGUT",151,0)
 N X3
"RTN","RGUT",152,0)
 S X2=$$%DTF(X1)+X2,X1=X1\1,X3=X2\1,X2=X2-X3
"RTN","RGUT",153,0)
 S:X2<0 X3=X3-1,X2=X2+1
"RTN","RGUT",154,0)
 Q $$FMADD^XLFDT(X1,X3)+$J($$%DTT(X2),0,6)
"RTN","RGUT",155,0)
%DTD(X1,X2) ;
"RTN","RGUT",156,0)
 Q $$FMDIFF^XLFDT(X1\1,X2\1)+($$%DTF(X1)-$$%DTF(X2))
"RTN","RGUT",157,0)
%DTF(X) S X=X#1*100
"RTN","RGUT",158,0)
 Q X\1*3600+(X*100#100\1*60)+(X*10000#100)/86400
"RTN","RGUT",159,0)
%DTT(X) S X=X*86400
"RTN","RGUT",160,0)
 Q X\3600*100+(X#3600/3600*60)/10000
"RTN","RGUT",161,0)
 ; THE FOLLOWING ENTRY POINTS WILL BE PHASED OUT IN FAVOR OF
"RTN","RGUT",162,0)
 ; THEIR EQUIVALENTS WITHIN KERNEL
"RTN","RGUT",163,0)
 ; Normalize global root
"RTN","RGUT",164,0)
GBL(RGGBL) ;
"RTN","RGUT",165,0)
 Q $$CREF^DILF(RGGBL)
"RTN","RGUT",166,0)
 ; Convert lower to upper case
"RTN","RGUT",167,0)
UPCASE(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RGUT",168,0)
 ; Convert upper to lower case
"RTN","RGUT",169,0)
LOCASE(X) Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","RGUT",170,0)
 ; Return a string of X repeated Y times
"RTN","RGUT",171,0)
RPT(X,Y) Q $$REPEAT^XLFSTR(X,Y)
"RTN","RGUT",172,0)
%DTDW(X) Q $$DOW^XLFDT(X)
"RTN","RGUT",173,0)
%DTDOW(X) ;
"RTN","RGUT",174,0)
 Q $$DOW^XLFDT(X,1)
"RTN","RGUT",175,0)
%DTNOW() Q $$NOW^XLFDT
"RTN","RGUT",176,0)
%DTH(X) Q $$FMTH^XLFDT(X)
"RTN","RGUT",177,0)
%DTYX(X) Q $$HTFM^XLFDT(X)
"RTN","RGUTALR")
0^33^B1320524
"RTN","RGUTALR",1,0)
RGUTALR ;CAIRO/DKM - Send alert to user(s) via kernel or mail;04-Sep-1998 11:26;DKM
"RTN","RGUTALR",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTALR",3,0)
 ;=================================================================
"RTN","RGUTALR",4,0)
 ; Send an alert.
"RTN","RGUTALR",5,0)
 ;   XQAMSG = Message to send
"RTN","RGUTALR",6,0)
 ;   RGUSR  = A semicolon-delimited list of users to receive alert.
"RTN","RGUTALR",7,0)
 ;=================================================================
"RTN","RGUTALR",8,0)
ALERT(XQAMSG,RGUSR) ;
"RTN","RGUTALR",9,0)
 N XQA,XQAOPT,XQAFLG,XQAROU,XQADATA,XQAID
"RTN","RGUTALR",10,0)
 S @$$TRAP^RGZOSF("EXIT^RGUTALR"),RGUSR=$G(RGUSR,"*"),XQAMSG=$TR(XQAMSG,U,"~")
"RTN","RGUTALR",11,0)
 D ENTRY^RGUTUSR(RGUSR,.XQA),SETUP^XQALERT:$D(XQA)
"RTN","RGUTALR",12,0)
EXIT Q
"RTN","RGUTALR",13,0)
 ;=================================================================
"RTN","RGUTALR",14,0)
 ; Send a mail message
"RTN","RGUTALR",15,0)
 ;   RGMSG  = Message to send (single node or array)
"RTN","RGUTALR",16,0)
 ;   XMY    = A semicolon-delimited list (or array) of users
"RTN","RGUTALR",17,0)
 ;   XMSUB  = Subject line (optional)
"RTN","RGUTALR",18,0)
 ;   XMDUZ  = DUZ of sender (optional)
"RTN","RGUTALR",19,0)
 ;=================================================================
"RTN","RGUTALR",20,0)
MAIL(RGMSG,XMY,XMSUB,XMDUZ) ;
"RTN","RGUTALR",21,0)
 N XMTEXT
"RTN","RGUTALR",22,0)
 S:$D(RGMSG)=1 RGMSG(1)=RGMSG
"RTN","RGUTALR",23,0)
 S XMTEXT="RGMSG(",@$$TRAP^RGZOSF("EXIT^RGUTALR"),XMY=$G(XMY)
"RTN","RGUTALR",24,0)
 S:$G(XMSUB)="" XMSUB=RGMSG
"RTN","RGUTALR",25,0)
 S:$G(XMDUZ)="" XMDUZ=$G(DUZ)
"RTN","RGUTALR",26,0)
 F  Q:'$L(XMY)  S X=$P(XMY,";"),XMY=$P(XMY,";",2,999) S:$L(X) XMY(X)=""
"RTN","RGUTALR",27,0)
 D ^XMD:$D(XMY)>9
"RTN","RGUTALR",28,0)
 Q
"RTN","RGUTBIG")
0^34^B14593609
"RTN","RGUTBIG",1,0)
RGUTBIG ;CAIRO/PLS - Print a banner in large letters;04-Sep-1998 11:26;DKM
"RTN","RGUTBIG",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTBIG",3,0)
 ;=================================================================
"RTN","RGUTBIG",4,0)
 ; Prints RGBIG to the current output device in large letters.
"RTN","RGUTBIG",5,0)
 ; Inputs:
"RTN","RGUTBIG",6,0)
 ;   RGBIG = Big letter string
"RTN","RGUTBIG",7,0)
 ;   RGRPT = # times to repeat (default=2)
"RTN","RGUTBIG",8,0)
 ;   RGTXT = Full text string (optional)
"RTN","RGUTBIG",9,0)
 ;=================================================================
"RTN","RGUTBIG",10,0)
ENTRY(RGBIG,RGRPT,RGTXT) ;
"RTN","RGUTBIG",11,0)
 N RGLT,RGFS,RGZ,RGZ1,RGLEN,RGPF,RGLN
"RTN","RGUTBIG",12,0)
 S RGFS="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789,-/.!#'$()*+?\=^&%"
"RTN","RGUTBIG",13,0)
 S:$D(RGTXT) RGTXT=$$RPT^RGUT("*"_RGTXT,$G(IOM,80)\($L(RGTXT)+1))
"RTN","RGUTBIG",14,0)
 S RGLEN=$L(RGBIG),RGRPT=$G(RGRPT,2)
"RTN","RGUTBIG",15,0)
 W !
"RTN","RGUTBIG",16,0)
 F RGLT=1:1:RGRPT D
"RTN","RGUTBIG",17,0)
 .W !
"RTN","RGUTBIG",18,0)
 .F RGZ=1:8:65 D
"RTN","RGUTBIG",19,0)
 ..W !
"RTN","RGUTBIG",20,0)
 ..F RGZ1=1:1:RGLEN D
"RTN","RGUTBIG",21,0)
 ...S RGLN=$F(RGFS,$E(RGBIG,RGZ1))-1
"RTN","RGUTBIG",22,0)
 ...S RGPF=$P($T(TBL+RGLN),";;",2,99)
"RTN","RGUTBIG",23,0)
 ...W $E(RGPF,RGZ,RGZ+7)
"RTN","RGUTBIG",24,0)
 ...W:RGZ1<RGLEN ?(RGZ1*12)
"RTN","RGUTBIG",25,0)
 .W !!,$G(RGTXT)
"RTN","RGUTBIG",26,0)
 Q
"RTN","RGUTBIG",27,0)
TBL ;; Table of character "raster images"
"RTN","RGUTBIG",28,0)
 ;; AAAAAA AA    AAAA    AAAAAAAAAAAAAAAAAAAA    AAAA    AAAA    AA
"RTN","RGUTBIG",29,0)
 ;;BBBBBBB BB    BBBB    BBBBBBBBB BBBBBBB BB    BBBB    BBBBBBBBB
"RTN","RGUTBIG",30,0)
 ;;CCCCCCCCCC      CC      CC      CC      CC      CC      CCCCCCCC
"RTN","RGUTBIG",31,0)
 ;;DDDDDD  DD   DD DD    DDDD    DDDD    DDDD    DDDD   DD DDDDDD
"RTN","RGUTBIG",32,0)
 ;;EEEEEEEEEE      EE      EEEEEE  EEEEEE  EE      EE      EEEEEEEE
"RTN","RGUTBIG",33,0)
 ;;FFFFFFFFFF      FF      FFFFFF  FFFFFF  FF      FF      FF
"RTN","RGUTBIG",34,0)
 ;;GGGGGGGGGG      GG      GG  GGGGGG  GGGGGG    GGGG    GGGGGGGGGG
"RTN","RGUTBIG",35,0)
 ;;HH    HHHH    HHHH     HHHHHHHHHHHHHHHHHHH    HHHH    HHHH    HH
"RTN","RGUTBIG",36,0)
 ;;IIIIIIII   II      II      II      II      II      II   IIIIIIII
"RTN","RGUTBIG",37,0)
 ;;JJJJJJJJ    JJ      JJ      JJ      JJ      JJ  JJ  JJ  JJJJJJ
"RTN","RGUTBIG",38,0)
 ;;KK    KKKK   KK KK  KK  KKKK    KKKK    KK  KK  KK   KK KK    KK
"RTN","RGUTBIG",39,0)
 ;;LL      LL      LL      LL      LL      LL      LL      LLLLLLLL
"RTN","RGUTBIG",40,0)
 ;;MM    MMMMM  MMMM MMMM MMM MM MMMM    MMMM    MMMM    MMMM    MM
"RTN","RGUTBIG",41,0)
 ;;N     NNNN    NNNNN   NNNN N  NNNN  N NNNN   NNNNN    NNNN     N
"RTN","RGUTBIG",42,0)
 ;; OOOOOO OO    OOOO    OOOO    OOOO    OOOO    OOOO    OO OOOOOO
"RTN","RGUTBIG",43,0)
 ;;PPPPPPP PP    PPPP    PPPPPPPPP PP      PP      PP      PP
"RTN","RGUTBIG",44,0)
 ;; QQQQQQ QQ    QQQQ    QQQQ    QQQQ  Q QQQQ   Q Q QQQQQQ        Q
"RTN","RGUTBIG",45,0)
 ;;RRRRRRR RR    RRRR    RRRRRRRRR RR RR   RR  RR  RR   RR RR    RR
"RTN","RGUTBIG",46,0)
 ;;SSSSSSSSSS      SS      SSSSSSSSSSSSSSSS      SS      SSSSSSSSSS
"RTN","RGUTBIG",47,0)
 ;;TTTTTTTT   TT      TT      TT      TT      TT      TT      TT
"RTN","RGUTBIG",48,0)
 ;;UU    UUUU    UUUU    UUUU    UUUU    UUUU    UUUUUUUUUU UUUUUU
"RTN","RGUTBIG",49,0)
 ;;VV    VVVV    VVVV    VVVV    VV VV  VV  VV  VV   VVVV     VV
"RTN","RGUTBIG",50,0)
 ;;WW    WWWW    WWWW    WWWW    WWWW    WWWW WW WWWWW  WWWWW    WW
"RTN","RGUTBIG",51,0)
 ;;XX    XXXX    XX XX  XX   XXXX     XX     XXXX   XX  XX XX    XX
"RTN","RGUTBIG",52,0)
 ;;YY    YY YY  YY   Y  Y     YY      YY      YY      YY      YY
"RTN","RGUTBIG",53,0)
 ;;ZZZZZZZZZZZZZZZZ     ZZ     ZZ    ZZ      ZZ    ZZZZZZZZZZZZZZZZ
"RTN","RGUTBIG",54,0)
 ;;
"RTN","RGUTBIG",55,0)
 ;;  0000 0 00  00 00   00000  0 0000 0  00000   00 00  00 0 0000
"RTN","RGUTBIG",56,0)
 ;;   11     111    1111      11      11      11      11   1111111
"RTN","RGUTBIG",57,0)
 ;;  2222   22  22 22    22      22    22    22     22     2222222
"RTN","RGUTBIG",58,0)
 ;;3333333      33     33   33333       33       33     33 33333
"RTN","RGUTBIG",59,0)
 ;;      44     444   44 44 44   44 4444444      44      44      44
"RTN","RGUTBIG",60,0)
 ;;5555555555      55      5555555       55      55     55 555555
"RTN","RGUTBIG",61,0)
 ;;   666   66  66 66      66      66 6666 666   66 66   66  6666
"RTN","RGUTBIG",62,0)
 ;;77777777      77     77    77      77     77     77      77
"RTN","RGUTBIG",63,0)
 ;;  8888   88  88 88  88   8888   88  88  88    88 88  88   8888
"RTN","RGUTBIG",64,0)
 ;;  99999 99    9999    99 9999999      99      99     99   9999
"RTN","RGUTBIG",65,0)
 ;;                                         ''        '      '
"RTN","RGUTBIG",66,0)
 ;;                        ----------------
"RTN","RGUTBIG",67,0)
 ;;              //     //     //    //      //      //
"RTN","RGUTBIG",68,0)
 ;;                                         ....    ....    ....
"RTN","RGUTBIG",69,0)
 ;;    !!     !!      !!      !!     !!               ....    ....
"RTN","RGUTBIG",70,0)
 ;;  #  #  ########  #  #  ########  #  #
"RTN","RGUTBIG",71,0)
 ;;
"RTN","RGUTBIG",72,0)
 ;;   $$   $$$$$$$$$$ $$   $$$$$$$$   $$ $$$$$$$$$$   $$
"RTN","RGUTBIG",73,0)
 ;;   ((     ((     ((     ((      ((       ((       ((
"RTN","RGUTBIG",74,0)
 ;;   ))      ))        ))       ))      ))     ))     ))    ))
"RTN","RGUTBIG",75,0)
 ;;*  **  * * ** *   ****  ********  ****   * ** * *  **  *
"RTN","RGUTBIG",76,0)
 ;;           ++      ++   ++++++++++++++++   ++      ++
"RTN","RGUTBIG",77,0)
 ;;  ???   ??   ??      ??     ??     ??      ??     ....    ....
"RTN","RGUTBIG",78,0)
 ;;         \\       \\       \\       \\       \\       \\
"RTN","RGUTBIG",79,0)
 ;;        ================       =================
"RTN","RGUTBIG",80,0)
 ;;    ^      ^^^    ^^ ^^  ^^   ^^
"RTN","RGUTBIG",81,0)
 ;; &&&    &   &   &   &    &&&  &  &&& && &   &&  &   &&   &&&   &
"RTN","RGUTBIG",82,0)
 ;;  %    % % %  %   %  %      %      %      %  %   %  % % %     %
"RTN","RGUTDAT")
0^35^B12975257
"RTN","RGUTDAT",1,0)
RGUTDAT ;CAIRO/DKM - Date range input;12-Oct-1998 12:01;DKM
"RTN","RGUTDAT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTDAT",3,0)
 ;=================================================================
"RTN","RGUTDAT",4,0)
 ; Prompt for date range (normal format)
"RTN","RGUTDAT",5,0)
NORMAL D D1("P1"),D2("P2")
"RTN","RGUTDAT",6,0)
 Q
"RTN","RGUTDAT",7,0)
 ; Prompt for date range (inverse format)
"RTN","RGUTDAT",8,0)
INVRSE D D1("PI1"),D2("PI2")
"RTN","RGUTDAT",9,0)
 Q
"RTN","RGUTDAT",10,0)
 ; Prompt for starting date
"RTN","RGUTDAT",11,0)
D1(RGOPT) ;
"RTN","RGUTDAT",12,0)
 S RGDAT1=$$ENTRY("Start date: ",.RGOPT,"",0,$Y)
"RTN","RGUTDAT",13,0)
 Q
"RTN","RGUTDAT",14,0)
 ; Prompt for ending date
"RTN","RGUTDAT",15,0)
D2(RGOPT) ;
"RTN","RGUTDAT",16,0)
 S RGDAT2=$$ENTRY("End date  : ",.RGOPT,"",0,$Y+1)
"RTN","RGUTDAT",17,0)
 Q
"RTN","RGUTDAT",18,0)
 ; Prompt for a date
"RTN","RGUTDAT",19,0)
ENTRY(%RGP,%RGOPT,%RGDAT,%RGX,%RGY,%RGTRP,%RGHLP) ;
"RTN","RGUTDAT",20,0)
 N %RGD,%RGI,%RGDT,%RGZ,%RGDISV
"RTN","RGUTDAT",21,0)
 S %RGX=$G(%RGX,$X),%RGY=$G(%RGY,$Y),DUZ=+$G(DUZ),IO=$G(IO,$I),DTIME=$G(DTIME,999999999),%RGOPT=$$UP^XLFSTR($G(%RGOPT)),%RGDISV=""
"RTN","RGUTDAT",22,0)
 S %RGTRP=$G(%RGTRP),%RGDAT=$G(%RGDAT)
"RTN","RGUTDAT",23,0)
 S:$G(%RGHLP)="" %RGHLP="HELP^RGUTDAT"
"RTN","RGUTDAT",24,0)
 S:$G(%RGP)="" %RGP="Enter date: "
"RTN","RGUTDAT",25,0)
 F %RGZ=0:1:9 I %RGOPT[%RGZ S %RGDISV="RGDAT"_%RGZ Q
"RTN","RGUTDAT",26,0)
 U IO
"RTN","RGUTDAT",27,0)
DAT1 S %RGDT="",@$$TRAP^RGZOSF("DAT1^RGUTDAT")
"RTN","RGUTDAT",28,0)
 F %RGZ="P","T","F","X" S:%RGOPT[%RGZ %RGDT=%RGDT_%RGZ
"RTN","RGUTDAT",29,0)
 F  D  Q:$D(%RGI)
"RTN","RGUTDAT",30,0)
 .W $$XY^RGUT(%RGX,%RGY)_%RGP,*27,"[J"
"RTN","RGUTDAT",31,0)
 .S $X=%RGX+$L(%RGP)
"RTN","RGUTDAT",32,0)
 .I %RGOPT["E" S %RGI=$$ENTRY^RGUTEDT(%RGDAT,79-$X,$X,$Y,"","R")
"RTN","RGUTDAT",33,0)
 .E  I %RGDAT'="" S %RGI=%RGDAT,%RGDAT=""
"RTN","RGUTDAT",34,0)
 .E  R %RGI:DTIME
"RTN","RGUTDAT",35,0)
 .I $E(%RGI)="?" D  Q
"RTN","RGUTDAT",36,0)
 ..W !
"RTN","RGUTDAT",37,0)
 ..I %RGI["??" D HELP
"RTN","RGUTDAT",38,0)
 ..E  D @%RGHLP
"RTN","RGUTDAT",39,0)
 ..D PAUSE()
"RTN","RGUTDAT",40,0)
 ..K %RGI
"RTN","RGUTDAT",41,0)
 .I %RGI=" " S %RGI=$S(%RGDISV="":"",1:$G(^DISV(DUZ,%RGDISV))) K:%RGI="" RGZ1
"RTN","RGUTDAT",42,0)
 .W $$XY^RGUT(%RGX+$L(%RGP),%RGY),*27,"[K"
"RTN","RGUTDAT",43,0)
 I %RGI="",%RGTRP'="" S %RGI=$G(@%RGTRP@(" "))
"RTN","RGUTDAT",44,0)
 S %RGI=$$UP^XLFSTR(%RGI),%RGD=""
"RTN","RGUTDAT",45,0)
 Q:"^^"[%RGI -$L(%RGI)
"RTN","RGUTDAT",46,0)
 I %RGTRP'="" D  I %RGD'="" S %RGOPT=$TR(%RGOPT,"I") G DAT2
"RTN","RGUTDAT",47,0)
 .I $D(@%RGTRP@(%RGI)) S %RGD=@%RGTRP@(%RGI)
"RTN","RGUTDAT",48,0)
 .E  D
"RTN","RGUTDAT",49,0)
 ..N X
"RTN","RGUTDAT",50,0)
 ..S X=%RGI,%RGZ=""
"RTN","RGUTDAT",51,0)
 ..F  S %RGZ=$O(@%RGTRP@("?",%RGZ)) Q:%RGZ=""  I %RGI?@%RGZ D  Q
"RTN","RGUTDAT",52,0)
 ...S %RGD=$$MSG^RGUT($G(@%RGTRP@("?",%RGZ)))
"RTN","RGUTDAT",53,0)
 S %RGI=$$%DT^RGUT(%RGI,%RGDT)
"RTN","RGUTDAT",54,0)
 G:%RGI=-1 DAT1
"RTN","RGUTDAT",55,0)
 I %RGOPT["+",%RGI<$S(%RGI=%RGI\1:$$DT^XLFDT,1:$$NOW^XLFDT) D  G DAT1
"RTN","RGUTDAT",56,0)
 .D PAUSE("Must be on or after current date.")
"RTN","RGUTDAT",57,0)
 I %RGOPT["-",%RGI>$S(%RGI=%RGI\1:$$DT^XLFDT,1:$$NOW^XLFDT) D  G DAT1
"RTN","RGUTDAT",58,0)
 .D PAUSE("Must be on or before current date.")
"RTN","RGUTDAT",59,0)
 S %RGD=$$^RGCVTDT(%RGI)
"RTN","RGUTDAT",60,0)
DAT2 W %RGD
"RTN","RGUTDAT",61,0)
 S:%RGDISV'="" ^DISV(DUZ,%RGDISV)=%RGI
"RTN","RGUTDAT",62,0)
 Q $S(%RGOPT["I":9999999-%RGI,1:%RGI)
"RTN","RGUTDAT",63,0)
HELP W ?2,"Enter a valid ",$S(%RGOPT["+":"future ",%RGOPT["-":"past ",1:""),"date using one of the following formats:",!!
"RTN","RGUTDAT",64,0)
 W ?5,"Format",?20,"Example",?35,"Explanation",?60,"Comments",!
"RTN","RGUTDAT",65,0)
 W ?5,"------",?20,"-------",?35,"-----------",?60,"--------",!
"RTN","RGUTDAT",66,0)
 W ?5,"mm/dd/yy",?20,"6/20/93",?35,"June 20, 1993",?60,"If you omit the",!
"RTN","RGUTDAT",67,0)
 W ?5,"dd-mmm-yy",?20,"27-JUL-58",?35,"July 27, 1958",?60,"year, the "_$S(%RGOPT["P":"most",%RGOPT["F":"closest",1:"current"),!
"RTN","RGUTDAT",68,0)
 W ?5,"mmddyy",?20,"070457",?35,"July 4, 1957",?60,$S(%RGOPT["P":"recent past date",%RGOPT["F":"future date",1:"calendar year"),!
"RTN","RGUTDAT",69,0)
 W ?5,"mmm dd yyyy",?20,"JAN 5, 1984",?35,"January 5, 1984",?60,"is assumed.",!
"RTN","RGUTDAT",70,0)
 W ?5,"T-n",?20,"T-5",?35,"Today's date - 5 days.",!!
"RTN","RGUTDAT",71,0)
 Q
"RTN","RGUTDAT",72,0)
PAUSE(%RGZ) ;
"RTN","RGUTDAT",73,0)
 W $$XY^RGUT(0,22),$G(%RGZ)
"RTN","RGUTDAT",74,0)
 I $$PAUSE^RGUT
"RTN","RGUTDAT",75,0)
 Q
"RTN","RGUTDIC")
0^36^B27837575
"RTN","RGUTDIC",1,0)
RGUTDIC ;CAIRO/DKM - Encapsulated FileMan API;04-Sep-1998 11:26;DKM
"RTN","RGUTDIC",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTDIC",3,0)
 ;=================================================================
"RTN","RGUTDIC",4,0)
 ; Parameterized routine to add/edit/extract an entry in a
"RTN","RGUTDIC",5,0)
 ; FileMan file.  Encapsulates global structure info so no
"RTN","RGUTDIC",6,0)
 ; need to specify this directly.
"RTN","RGUTDIC",7,0)
 ; Inputs:
"RTN","RGUTDIC",8,0)
 ;    %RGDIC = Global root, file number, or bookmark
"RTN","RGUTDIC",9,0)
 ;    %RGCMD = n    : IEN of entry to process
"RTN","RGUTDIC",10,0)
 ;             0    : Process last IEN referenced
"RTN","RGUTDIC",11,0)
 ;             +n   : Move down to subfile n
"RTN","RGUTDIC",12,0)
 ;             -    : Move up to parent file
"RTN","RGUTDIC",13,0)
 ;             @n   : Delete IEN #n (or last referenced if missing)
"RTN","RGUTDIC",14,0)
 ;             =x;y : Lookup y at current level using options in x
"RTN","RGUTDIC",15,0)
 ;             ?x;y ; Lookup y using RGUTLKP utility with options in x
"RTN","RGUTDIC",16,0)
 ;             >x;y : Read fields specified in y using options in x
"RTN","RGUTDIC",17,0)
 ;             <x;y : Write fields specified in y using options in x
"RTN","RGUTDIC",18,0)
 ;             ~x;y : Same as <, but creates new entry
"RTN","RGUTDIC",19,0)
 ;             %n   : Force DINUM to n
"RTN","RGUTDIC",20,0)
 ; Outputs:
"RTN","RGUTDIC",21,0)
 ;     Returns in the first piece the IEN of the entry or...
"RTN","RGUTDIC",22,0)
 ;      0 = Entry was deleted
"RTN","RGUTDIC",23,0)
 ;     -1 = Entry was rejected
"RTN","RGUTDIC",24,0)
 ;     -2 = Entry locked by another process
"RTN","RGUTDIC",25,0)
 ;     -3 = Unexpected error
"RTN","RGUTDIC",26,0)
 ;=================================================================
"RTN","RGUTDIC",27,0)
ENTRY(%RGDIC,%RGCMD) ;
"RTN","RGUTDIC",28,0)
 S %RGDIC(0)=+$G(DUZ)
"RTN","RGUTDIC",29,0)
 N DUZ,DIC,DINUM,DIE,DIQ,DIQUIET,DIK,%RGX,%RGIEN,%RGARG,%RGN1,%RGN2,%RGZ,X,Y
"RTN","RGUTDIC",30,0)
 N DA,DC,DD,DG,DH,DK,DL,DO,DQ,DR,DU,DV,DW,DY
"RTN","RGUTDIC",31,0)
 S DUZ=%RGDIC(0),DUZ(0)="@",@$$TRAP^RGZOSF("ERROR^RGUTDIC"),%RGCMD=$G(%RGCMD),%RGIEN="",DIQUIET=1
"RTN","RGUTDIC",32,0)
 ; Build the bookmark if a global reference or file # passed
"RTN","RGUTDIC",33,0)
 I %RGDIC'[U D
"RTN","RGUTDIC",34,0)
 .S:%RGDIC'=+%RGDIC %RGDIC=+$O(^DIC("B",%RGDIC,0))
"RTN","RGUTDIC",35,0)
 .S %RGDIC=$$ROOT^DILFD(%RGDIC)_U_U_%RGDIC
"RTN","RGUTDIC",36,0)
 I $P(%RGDIC,U,4)="" D
"RTN","RGUTDIC",37,0)
 .S %RGZ=U_$P(%RGDIC,U,2),%RGZ=$E(%RGZ,1,$L(%RGZ)-1),%RGZ=%RGZ_$S(%RGZ["(":")",1:"")
"RTN","RGUTDIC",38,0)
 .S $P(%RGDIC,U,4)=$P(@%RGZ@(0),U,2)
"RTN","RGUTDIC",39,0)
 F %RGN1=1:1:$L(%RGCMD,"|") S %RGARG=$P(%RGCMD,"|",%RGN1),%RGZ=$E(%RGARG) D  Q:%RGIEN<0
"RTN","RGUTDIC",40,0)
 .S %RGN2=$F("-+=@><~?%",%RGZ)
"RTN","RGUTDIC",41,0)
 .S:%RGN2 %RGN2=%RGN2-1,%RGARG=$E(%RGARG,2,999)
"RTN","RGUTDIC",42,0)
 .D DA,@%RGN2
"RTN","RGUTDIC",43,0)
 .S:%RGIEN>0 $P(%RGDIC,U,3)=%RGIEN
"RTN","RGUTDIC",44,0)
 S $P(%RGDIC,U)=%RGIEN
"RTN","RGUTDIC",45,0)
 Q %RGDIC
"RTN","RGUTDIC",46,0)
 ; Set IEN
"RTN","RGUTDIC",47,0)
0 S:%RGARG'<0 %RGIEN=$S($D(@%RGDIC(2)@(+%RGARG)):+%RGARG,1:0),$P(%RGDIC,U,3)=%RGIEN
"RTN","RGUTDIC",48,0)
 Q
"RTN","RGUTDIC",49,0)
 ; Move up to parent file
"RTN","RGUTDIC",50,0)
1 N %RGX,%RGY
"RTN","RGUTDIC",51,0)
 S $P(%RGDIC,U,4)=$P($P(%RGDIC,U,4),"|",2,999)
"RTN","RGUTDIC",52,0)
 S %RGY=$P(%RGDIC,U,2),%RGX=$L(%RGY,"|"),$P(%RGDIC,U,2)=$P(%RGY,"|",1,%RGX-1)
"RTN","RGUTDIC",53,0)
 S %RGIEN=+$P(%RGY,"|",%RGX),$P(%RGDIC,U,3)=%RGIEN
"RTN","RGUTDIC",54,0)
 D DA
"RTN","RGUTDIC",55,0)
 Q
"RTN","RGUTDIC",56,0)
 ; Move down to subfile
"RTN","RGUTDIC",57,0)
2 N %RGX,%RGY,%RGZ
"RTN","RGUTDIC",58,0)
 I $P(%RGDIC,U,3)'>0 S %RGIEN=-1 Q
"RTN","RGUTDIC",59,0)
 S %RGY=+$P(%RGDIC,U,4)
"RTN","RGUTDIC",60,0)
 S:%RGARG'=+%RGARG %RGARG=+$O(^DD(%RGY,"B",%RGARG,0)),%RGARG=+$P($G(^DD(%RGY,%RGARG,0)),U,2)
"RTN","RGUTDIC",61,0)
 S %RGX=+%RGARG,%RGZ=+$O(^DD(%RGY,"SB",%RGX,0)),%RGZ=$P($P(^DD(%RGY,%RGZ,0),U,4),";"),%RGX=$P(^(0),U,2)
"RTN","RGUTDIC",62,0)
 S:%RGZ'=+%RGZ %RGZ=""""_%RGZ_""""
"RTN","RGUTDIC",63,0)
 S $P(%RGDIC,U,4)=%RGX_"|"_$P(%RGDIC,U,4),$P(%RGDIC,U,2)=$P(%RGDIC,U,2)_"|"_$P(%RGDIC,U,3)_","_%RGZ_","
"RTN","RGUTDIC",64,0)
 S %RGIEN="",$P(%RGDIC,U,3)=""
"RTN","RGUTDIC",65,0)
 D DA
"RTN","RGUTDIC",66,0)
 Q
"RTN","RGUTDIC",67,0)
 ; Lookup an entry
"RTN","RGUTDIC",68,0)
3 N X,Y
"RTN","RGUTDIC",69,0)
 I %RGARG[";" S DIC(0)=$P(%RGARG,";"),%RGARG=$P(%RGARG,";",2,999)
"RTN","RGUTDIC",70,0)
 E  S DIC(0)="XMF"
"RTN","RGUTDIC",71,0)
 S DIC=%RGDIC(1),X=%RGARG
"RTN","RGUTDIC",72,0)
 D ^DIC
"RTN","RGUTDIC",73,0)
 S %RGIEN=+Y
"RTN","RGUTDIC",74,0)
 Q
"RTN","RGUTDIC",75,0)
 ; Delete an entry
"RTN","RGUTDIC",76,0)
4 N X,Y
"RTN","RGUTDIC",77,0)
 S:%RGARG DA=%RGARG
"RTN","RGUTDIC",78,0)
 S DIK=%RGDIC(1),%RGIEN=0
"RTN","RGUTDIC",79,0)
 D ^DIK
"RTN","RGUTDIC",80,0)
 Q
"RTN","RGUTDIC",81,0)
 ; Extract data
"RTN","RGUTDIC",82,0)
5 N %RGZ,%RGZ1,%RGX,%RGY
"RTN","RGUTDIC",83,0)
 I '%RGIEN S %RGIEN=-1 Q
"RTN","RGUTDIC",84,0)
 S DR=""
"RTN","RGUTDIC",85,0)
 F %RGX=2:1:$L(%RGARG,";") D
"RTN","RGUTDIC",86,0)
 .S %RGY=$P(%RGARG,";",%RGX)
"RTN","RGUTDIC",87,0)
 .I %RGY["=" S %RGZ=$$FLD($P(%RGY,"=",2)),%RGZ1(%RGZ,$P(%RGY,"="))="",%RGY=%RGZ
"RTN","RGUTDIC",88,0)
 .S DR=DR_$S($L(DR):";",1:"")_%RGY
"RTN","RGUTDIC",89,0)
 S DIC=%RGDIC(1),DIQ(0)=$P(%RGARG,";")
"RTN","RGUTDIC",90,0)
 S:DIQ(0)="" DIQ(0)="E"
"RTN","RGUTDIC",91,0)
 K ^UTILITY("DIQ1",$J)
"RTN","RGUTDIC",92,0)
 D
"RTN","RGUTDIC",93,0)
 .N X,Y
"RTN","RGUTDIC",94,0)
 .D EN^DIQ1
"RTN","RGUTDIC",95,0)
 F %RGX=0:0 S %RGX=$O(%RGZ1(%RGX)),%RGZ="" Q:'%RGX  D
"RTN","RGUTDIC",96,0)
 .F  S %RGZ=$O(%RGZ1(%RGX,%RGZ)),%RGZ1="" Q:%RGZ=""  D
"RTN","RGUTDIC",97,0)
 ..F %RGY="E","I" D
"RTN","RGUTDIC",98,0)
 ...S:$D(^UTILITY("DIQ1",$J,+$P(%RGDIC,U,4),%RGIEN,%RGX,%RGY)) %RGZ1=%RGZ1_$S($L(%RGZ1):U,1:"")_^(%RGY)
"RTN","RGUTDIC",99,0)
 ..S @%RGZ=%RGZ1
"RTN","RGUTDIC",100,0)
 Q
"RTN","RGUTDIC",101,0)
 ; Edit existing entry
"RTN","RGUTDIC",102,0)
6 S DIC(0)=$P(%RGARG,";"),DIC("P")=$P($P(%RGDIC,U,4),"|"),%RGARG=$P(%RGARG,";",2,999)
"RTN","RGUTDIC",103,0)
 I %RGIEN'>0 S %RGIEN=-1 Q
"RTN","RGUTDIC",104,0)
 S DIE=%RGDIC(1),DR=%RGARG
"RTN","RGUTDIC",105,0)
 L +@%RGDIC(2)@(%RGIEN):$S(DIC(0)["!":9999999,1:0)
"RTN","RGUTDIC",106,0)
 E  S %RGIEN=-2 Q
"RTN","RGUTDIC",107,0)
 D ^DIE
"RTN","RGUTDIC",108,0)
 L -@%RGDIC(2)@(%RGIEN)
"RTN","RGUTDIC",109,0)
 S %RGIEN=+$G(DA)
"RTN","RGUTDIC",110,0)
 Q
"RTN","RGUTDIC",111,0)
 ; Create new entry
"RTN","RGUTDIC",112,0)
7 N X,Y,DD,DO,DLAYGO
"RTN","RGUTDIC",113,0)
 S DIC=%RGDIC(1),DIC(0)=$P(%RGARG,";")_"L",DIC("P")=$P($P(%RGDIC,U,4),"|"),Y=$P(%RGARG,";",2),%RGARG=DIC(0)_";"_$P(%RGARG,";",3,999),DLAYGO=DIC("P")\1
"RTN","RGUTDIC",114,0)
 I +Y'=.01 S %RGIEN=-1 Q
"RTN","RGUTDIC",115,0)
 S X=$P(Y,"/",4)
"RTN","RGUTDIC",116,0)
 S:X="" X=$P(Y,"/",5)
"RTN","RGUTDIC",117,0)
 X:$E(X)=U $E(X,2,999)
"RTN","RGUTDIC",118,0)
 I $P(^DD(+DIC("P"),.01,0),U,2)["W" D
"RTN","RGUTDIC",119,0)
 .D WP
"RTN","RGUTDIC",120,0)
 E  D ^DIC:DIC(0)'["U",FILE^DICN:DIC(0)["U"
"RTN","RGUTDIC",121,0)
 S %RGIEN=+Y
"RTN","RGUTDIC",122,0)
 I %RGIEN>0,$P(%RGARG,";",2,99)'="" D DA,6
"RTN","RGUTDIC",123,0)
 K DINUM
"RTN","RGUTDIC",124,0)
 Q
"RTN","RGUTDIC",125,0)
8 ; Lookup entry
"RTN","RGUTDIC",126,0)
 N %RGOPT,%RGP,RGFN
"RTN","RGUTDIC",127,0)
 S %RGOPT=$P(%RGARG,";"),%RGARG=$P(%RGARG,";",2,999),RGFN=+$P(%RGDIC,U,4)
"RTN","RGUTDIC",128,0)
 S %RGP=+$P(%RGDIC,U,4),%RGP=$P($G(^DD(%RGP,.01,0)),U)
"RTN","RGUTDIC",129,0)
 S:$L(%RGP) %RGP=%RGP_": "
"RTN","RGUTDIC",130,0)
 S %RGIEN=$$ENTRY^RGUTLKP(%RGDIC(2),%RGOPT,%RGP,"",%RGARG,"","",$X,$Y,"","","HLP^RGUTDIC")
"RTN","RGUTDIC",131,0)
 Q
"RTN","RGUTDIC",132,0)
 ; Force DINUM
"RTN","RGUTDIC",133,0)
9 S DINUM=%RGARG
"RTN","RGUTDIC",134,0)
 Q
"RTN","RGUTDIC",135,0)
HLP W $G(^DD(+RGFN,.01,3)),!
"RTN","RGUTDIC",136,0)
 Q
"RTN","RGUTDIC",137,0)
 ; Word processing field (special case of #7)
"RTN","RGUTDIC",138,0)
WP N %RGZ,%RGZ1
"RTN","RGUTDIC",139,0)
 I X="@" D
"RTN","RGUTDIC",140,0)
 .K @%RGDIC(2)
"RTN","RGUTDIC",141,0)
 .S Y=0
"RTN","RGUTDIC",142,0)
 E  D
"RTN","RGUTDIC",143,0)
 .S %RGZ=$G(@%RGDIC(2)@(0)),Y=$G(DINUM,1+$O(^($C(1)),-1))
"RTN","RGUTDIC",144,0)
 .S %RGZ1=+$P(%RGZ,U,4),%RGZ=+$P(%RGZ,U,3)
"RTN","RGUTDIC",145,0)
 .S:Y>%RGZ %RGZ=Y
"RTN","RGUTDIC",146,0)
 .S:'$D(^(Y)) %RGZ1=%RGZ1+1
"RTN","RGUTDIC",147,0)
 .S ^(0)=U_U_%RGZ_U_%RGZ1_U_$G(DT),^(Y,0)=X
"RTN","RGUTDIC",148,0)
 Q:$P(^DD(+DIC("P"),.01,0),U,2)'["a"
"RTN","RGUTDIC",149,0)
 S %RGIEN=Y
"RTN","RGUTDIC",150,0)
 D DA,WPAUDIT^RGCODAUD(+DIC("P"),.DA,X,"")
"RTN","RGUTDIC",151,0)
 Q
"RTN","RGUTDIC",152,0)
 ; Trap unexpected error
"RTN","RGUTDIC",153,0)
ERROR S $P(%RGDIC,U)=-3
"RTN","RGUTDIC",154,0)
 Q %RGDIC
"RTN","RGUTDIC",155,0)
 ; Return field #
"RTN","RGUTDIC",156,0)
FLD(X) Q $S(X=+X:X,1:+$O(^DD(+$P(%RGDIC,U,4),"B",X,0)))
"RTN","RGUTDIC",157,0)
 ; Set up DA array
"RTN","RGUTDIC",158,0)
DA N %RGZ,%RGZ1,%RGZ2
"RTN","RGUTDIC",159,0)
 K DA
"RTN","RGUTDIC",160,0)
 S:'$G(%RGIEN) %RGIEN=$P(%RGDIC,U,3)
"RTN","RGUTDIC",161,0)
 S %RGZ=$P(%RGDIC,U,2),%RGZ2=$L(%RGZ,"|"),DA=%RGIEN
"RTN","RGUTDIC",162,0)
 F %RGZ1=2:1:%RGZ2 S DA(%RGZ2-%RGZ1+1)=+$P(%RGZ,"|",%RGZ1)
"RTN","RGUTDIC",163,0)
 S %RGDIC(1)=U_$TR($P(%RGDIC,U,2),"|"),%RGDIC(2)=$E(%RGDIC(1),1,$L(%RGDIC(1))-1),%RGDIC(2)=%RGDIC(2)_$S(%RGDIC(2)["(":")",1:"")
"RTN","RGUTDIC",164,0)
 Q
"RTN","RGUTDT")
0^37^B4487196
"RTN","RGUTDT",1,0)
RGUTDT ;CAIRO/DKM - FM date to formatted date;04-Sep-1998 12:46;DKM
"RTN","RGUTDT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTDT",3,0)
 ;=================================================================
"RTN","RGUTDT",4,0)
 ; Inputs:
"RTN","RGUTDT",5,0)
 ;   RGDAT = date to format (DHCP format or $H format)
"RTN","RGUTDT",6,0)
 ;   RGFMT = date and time format control (optional)
"RTN","RGUTDT",7,0)
 ;      xxx0 = dd-mmm-yyyy
"RTN","RGUTDT",8,0)
 ;      xxx1 = mmm dd,yyyy
"RTN","RGUTDT",9,0)
 ;      xxx2 = mm/dd/yyyy
"RTN","RGUTDT",10,0)
 ;      xxx3 = mm-dd-yyyy
"RTN","RGUTDT",11,0)
 ;      xx0x = hh:mm
"RTN","RGUTDT",12,0)
 ;      xx1x = hh:mm xx
"RTN","RGUTDT",13,0)
 ;      x0xx = use space to separate date/time
"RTN","RGUTDT",14,0)
 ;      x1xx = use @ to separate date/time
"RTN","RGUTDT",15,0)
 ;      0xxx = allow leading zeros
"RTN","RGUTDT",16,0)
 ;      1xxx = remove leading zeros
"RTN","RGUTDT",17,0)
 ; Outputs:
"RTN","RGUTDT",18,0)
 ;   Returns formatted date
"RTN","RGUTDT",19,0)
 ;=================================================================
"RTN","RGUTDT",20,0)
ENTRY(RGDAT,RGFMT) ;
"RTN","RGUTDT",21,0)
 S RGDAT=$G(RGDAT,$H)
"RTN","RGUTDT",22,0)
 Q:'RGDAT ""
"RTN","RGUTDT",23,0)
 N RGZ1,RGZ2,RGZ3,RGZ4,RGDLM,RGTM
"RTN","RGUTDT",24,0)
 S:RGDAT?1.N1",".N RGDAT=$$HTFM^XLFDT(RGDAT)
"RTN","RGUTDT",25,0)
 S RGFMT=$G(RGFMT)#100000,RGFMT=RGFMT#10000,RGZ4=RGFMT\1000,RGFMT=RGFMT#1000,RGDLM=$S(RGFMT>99:"@",1:" "),RGFMT=RGFMT#100,RGTM=RGFMT\10,RGFMT=RGFMT#10
"RTN","RGUTDT",26,0)
 I RGDAT\1 D
"RTN","RGUTDT",27,0)
 .S RGZ3=RGDAT\1+17000000,RGZ1=$E(RGZ3,7,8),RGZ2=$E(RGZ3,5,6),RGZ3=$E(RGZ3,1,4)
"RTN","RGUTDT",28,0)
 .S:RGZ4 RGZ1=+RGZ1,RGZ2=+RGZ2
"RTN","RGUTDT",29,0)
 .S:RGFMT<2 RGZ2=$P("Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",",",RGZ2)
"RTN","RGUTDT",30,0)
 .S RGZ1=$S('RGFMT:RGZ1_"-"_RGZ2_"-"_RGZ3,RGFMT=1:RGZ2_" "_RGZ1_","_RGZ3,RGFMT=2:RGZ2_"/"_RGZ1_"/"_RGZ3,1:RGZ2_"-"_RGZ1_"-"_RGZ3)
"RTN","RGUTDT",31,0)
 E  S RGZ1=""
"RTN","RGUTDT",32,0)
 S RGZ2=RGDAT#1*10000+10000\1
"RTN","RGUTDT",33,0)
 I RGZ2=10000!(RGZ2>12400) S RGZ2=""
"RTN","RGUTDT",34,0)
 E  D
"RTN","RGUTDT",35,0)
 .S:RGTM RGZ2=$S(RGZ2=12400:RGZ2-1200_" am",RGZ2>11299:RGZ2-1200_" pm",RGZ2>11199:RGZ2_" pm",RGZ2<10099:RGZ2+1200_" am",1:RGZ2_" am")
"RTN","RGUTDT",36,0)
 .S RGZ3=$S(RGZ4:+$E(RGZ2,2,3),1:$E(RGZ2,2,3)),RGZ2=RGZ3_":"_$E(RGZ2,4,8)
"RTN","RGUTDT",37,0)
 Q RGZ1_$S('$L(RGZ2):"",$L(RGZ1):RGDLM,1:"")_RGZ2
"RTN","RGUTEDT")
0^38^B46816238
"RTN","RGUTEDT",1,0)
RGUTEDT ;CAIRO/DKM - Screen-oriented line editor;04-Sep-1998 11:26;DKM
"RTN","RGUTEDT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTEDT",3,0)
 ;=================================================================
"RTN","RGUTEDT",4,0)
 ; Inputs:
"RTN","RGUTEDT",5,0)
 ;   RGDATA  = Data to edit
"RTN","RGUTEDT",6,0)
 ;   RGLEN   = Maximum length of data
"RTN","RGUTEDT",7,0)
 ;   RGX     = Starting column position
"RTN","RGUTEDT",8,0)
 ;   RGY     = Starting row position
"RTN","RGUTEDT",9,0)
 ;   RGVALD  = List of valid inputs (optional)
"RTN","RGUTEDT",10,0)
 ;   RGDISV  = DISV node to save under (optional)
"RTN","RGUTEDT",11,0)
 ;   RGTERM  = Valid input terminators (default=<CR>)
"RTN","RGUTEDT",12,0)
 ;   RGABRT  = Valid input abort characters (default=none)
"RTN","RGUTEDT",13,0)
 ;   RGRM    = Right margin setting (default=IOM or 80)
"RTN","RGUTEDT",14,0)
 ;   RGQUIT  = Exit code (returned)
"RTN","RGUTEDT",15,0)
 ;   RGOPT   = Input options
"RTN","RGUTEDT",16,0)
 ;      C = Mark <CR> with ~
"RTN","RGUTEDT",17,0)
 ;      E = Echo off
"RTN","RGUTEDT",18,0)
 ;      H = Horizontal scroll
"RTN","RGUTEDT",19,0)
 ;      I = No timeout
"RTN","RGUTEDT",20,0)
 ;      L = Lowercase only
"RTN","RGUTEDT",21,0)
 ;      O = Overwrite mode
"RTN","RGUTEDT",22,0)
 ;      Q = Quiet mode
"RTN","RGUTEDT",23,0)
 ;      R = Reverse video
"RTN","RGUTEDT",24,0)
 ;      T = Auto-terminate
"RTN","RGUTEDT",25,0)
 ;      U = Uppercase only
"RTN","RGUTEDT",26,0)
 ;      V = Up/down cursor keys terminate input
"RTN","RGUTEDT",27,0)
 ;      X = Suppress auto-erase
"RTN","RGUTEDT",28,0)
 ; Outputs:
"RTN","RGUTEDT",29,0)
 ;   Return value = Edited data
"RTN","RGUTEDT",30,0)
 ;=================================================================
"RTN","RGUTEDT",31,0)
ENTRY(RGDATA,RGLEN,RGX,RGY,RGVALD,RGOPT,RGDISV,RGTERM,RGABRT,RGRM,RGQUIT) ;
"RTN","RGUTEDT",32,0)
 N RGZ,RGZ1,RGZ2,RGSAVE,RGINS,RGAE,RGBUF,RGTAB,RGPOS,RGEON,RGLEFT,RGBEL,RGMAX,RGRVON,RGRVOFF,RGC,RGW
"RTN","RGUTEDT",33,0)
 S RGVALD=$G(RGVALD),RGOPT=$$UP^XLFSTR($G(RGOPT)),RGBEL=$S(RGOPT'["Q":$C(7),1:""),RGDISV=$G(RGDISV)
"RTN","RGUTEDT",34,0)
 S:$G(RGTERM)="" RGTERM=$C(13)                                         ; Valid line terminators
"RTN","RGUTEDT",35,0)
 S RGABRT=$G(RGABRT)                                                   ; Valid input abort keys
"RTN","RGUTEDT",36,0)
 S RGRVON=$C(27,91,55,109),RGRVOFF=$C(27,91,109)                       ; Reverse video control
"RTN","RGUTEDT",37,0)
 S RGINS=RGOPT'["O"                                                    ; Default mode = insert
"RTN","RGUTEDT",38,0)
 S RGAE=RGOPT'["X"                                                     ; Auto-erase option
"RTN","RGUTEDT",39,0)
 S RGEON=RGOPT'["E"                                                    ; No echo option
"RTN","RGUTEDT",40,0)
 I RGOPT["I"!'$D(DTIME) N DTIME S DTIME=9999999999                                ; Suppress timeout option
"RTN","RGUTEDT",41,0)
 S RGBUF=""
"RTN","RGUTEDT",42,0)
 S RGRM=$G(RGRM,$G(IOM,80))                                            ; Display width
"RTN","RGUTEDT",43,0)
 S RGTAB=$C(9)                                                         ; Tab character
"RTN","RGUTEDT",44,0)
 S RGX=$G(RGX,$X),RGY=$G(RGY,$Y),RGW=RGRM-RGX
"RTN","RGUTEDT",45,0)
 S:RGW'>0 RGW=1
"RTN","RGUTEDT",46,0)
 S:'$G(RGLEN) RGLEN=RGW                                                ; Default field width
"RTN","RGUTEDT",47,0)
 S RGMAX=$S(RGOPT["H":250,1:RGLEN)                                     ; Maximum data length
"RTN","RGUTEDT",48,0)
 S (RGSAVE,RGDATA)=$E($G(RGDATA),1,RGMAX)                              ; Truncate data if too long
"RTN","RGUTEDT",49,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTEDT",50,0)
 S @$$TRAP^RGZOSF("ERROR^RGUTEDT")
"RTN","RGUTEDT",51,0)
 D RM^RGZOSF(0)
"RTN","RGUTEDT",52,0)
 X ^%ZOSF("EOFF")
"RTN","RGUTEDT",53,0)
 F  Q:RGDATA'[RGTAB  S RGZ=$P(RGDATA,RGTAB),RGDATA=RGZ_$J("",8-($L(RGZ)#8))_$P(RGDATA,RGTAB,2,999)
"RTN","RGUTEDT",54,0)
RESTART D RESET
"RTN","RGUTEDT",55,0)
AGAIN F RGQUIT=0:0 Q:RGQUIT  D NXT S RGAE=0
"RTN","RGUTEDT",56,0)
 X ^%ZOSF("EON")
"RTN","RGUTEDT",57,0)
 W $$XY^RGUT(RGX,RGY),$S(RGOPT["R":RGRVOFF,1:"")
"RTN","RGUTEDT",58,0)
 I RGDISV'="" Q:"^^"[RGDATA RGDATA S:RGDATA=" " RGDATA=$G(^DISV(DUZ,RGDISV))
"RTN","RGUTEDT",59,0)
 S:RGDISV'="" ^DISV(DUZ,RGDISV)=RGDATA
"RTN","RGUTEDT",60,0)
 Q RGDATA                                                              ; Return to calling routine
"RTN","RGUTEDT",61,0)
NXT D POSCUR()                                                            ; Position cursor
"RTN","RGUTEDT",62,0)
 R *RGC:DTIME                                                          ; Next character typed
"RTN","RGUTEDT",63,0)
 I RGC=27 D ESC Q:'RGC
"RTN","RGUTEDT",64,0)
 I RGC<1!(RGABRT[$C(RGC)) S RGDATA=U,RGQUIT=1 Q
"RTN","RGUTEDT",65,0)
 I RGTERM[$C(RGC) D TERM Q
"RTN","RGUTEDT",66,0)
 I RGC<28 D:RGC'=27 @("CTL"_$C(RGC+64)) Q
"RTN","RGUTEDT",67,0)
 I RGC=127!(RGC=240) D CTLH Q
"RTN","RGUTEDT",68,0)
 I RGC>64,RGC<91,RGOPT["L" S RGC=RGC+32
"RTN","RGUTEDT",69,0)
 E  I RGC>96,RGC<123,RGOPT["U" S RGC=RGC-32
"RTN","RGUTEDT",70,0)
 I $L(RGVALD),RGVALD'[$C(RGC) D RAISE^RGZOSF()
"RTN","RGUTEDT",71,0)
 D:RGAE CTLK,POSCUR()                                                  ; Erase buffer if auto erase on
"RTN","RGUTEDT",72,0)
 D INSW($C(RGC))
"RTN","RGUTEDT",73,0)
 S RGQUIT=RGPOS=RGLEN&(RGOPT["T")
"RTN","RGUTEDT",74,0)
 Q
"RTN","RGUTEDT",75,0)
CTLA S RGINS='RGINS                                                        ; Toggle insert mode
"RTN","RGUTEDT",76,0)
 Q
"RTN","RGUTEDT",77,0)
CTLB D MOVETO(0)                                                           ; Move cursor to beginning
"RTN","RGUTEDT",78,0)
 Q
"RTN","RGUTEDT",79,0)
CTLX S RGDATA=RGSAVE                                                       ; Restore buffer to original
"RTN","RGUTEDT",80,0)
 G RESET
"RTN","RGUTEDT",81,0)
CTLE D MOVETO($L(RGDATA))                                                  ; Move cursor to end
"RTN","RGUTEDT",82,0)
 Q
"RTN","RGUTEDT",83,0)
CTLI D INSW($J("",8-(RGPOS#8)))                                            ; Insert expanded tab
"RTN","RGUTEDT",84,0)
 Q
"RTN","RGUTEDT",85,0)
CTLJ F RGZ=RGPOS:-1:1 Q:$A(RGDATA,RGZ)'=32                                     ; Find previous nonspace
"RTN","RGUTEDT",86,0)
 F RGZ=RGZ:-1:1 Q:$A(RGDATA,RGZ)=32                                          ; Find previous space
"RTN","RGUTEDT",87,0)
 S RGBUF=$E(RGDATA,RGZ,RGPOS)                                            ; Save deleted portion
"RTN","RGUTEDT",88,0)
 S RGDATA=$E(RGDATA,1,RGZ-1)_$E(RGDATA,RGPOS+1,RGLEN)                    ; Remove word
"RTN","RGUTEDT",89,0)
 D MOVETO(RGZ-1)
"RTN","RGUTEDT",90,0)
 Q
"RTN","RGUTEDT",91,0)
CTLK S RGBUF=RGDATA                                                        ; Save buffer
"RTN","RGUTEDT",92,0)
 S RGDATA=""                                                           ; Erase buffer
"RTN","RGUTEDT",93,0)
 D RESET
"RTN","RGUTEDT",94,0)
 Q
"RTN","RGUTEDT",95,0)
CTLL S RGBUF=$E(RGDATA,RGPOS+1,RGLEN)                                      ; Save deleted portion
"RTN","RGUTEDT",96,0)
 S RGDATA=$E(RGDATA,1,RGPOS)                                           ; Truncate at current position
"RTN","RGUTEDT",97,0)
 D DSPLY(RGPOS)
"RTN","RGUTEDT",98,0)
 Q
"RTN","RGUTEDT",99,0)
CTLM D POSCUR(RGPOS),INSW("~"):RGOPT["C",MOVETO(RGPOS-$X+RGX+RGW)
"RTN","RGUTEDT",100,0)
 Q
"RTN","RGUTEDT",101,0)
CTLR D INSW(RGBUF)                                                         ; Insert at current position
"RTN","RGUTEDT",102,0)
 Q
"RTN","RGUTEDT",103,0)
CTLT D CTLL
"RTN","RGUTEDT",104,0)
 Q
"RTN","RGUTEDT",105,0)
CTLU S RGBUF=$E(RGDATA,1,RGPOS)                                            ; Save deleted portion
"RTN","RGUTEDT",106,0)
 S RGDATA=$E(RGDATA,RGPOS+1,RGLEN)                                     ; Remove to left of cursor
"RTN","RGUTEDT",107,0)
 D RESET
"RTN","RGUTEDT",108,0)
 Q
"RTN","RGUTEDT",109,0)
CTLH I 'RGPOS W RGBEL Q
"RTN","RGUTEDT",110,0)
 D LEFT
"RTN","RGUTEDT",111,0)
CTLD S RGDATA=$E(RGDATA,1,RGPOS)_$E(RGDATA,RGPOS+2,RGMAX)                  ; Delete character to left
"RTN","RGUTEDT",112,0)
 D DSPLY(RGPOS,1)
"RTN","RGUTEDT",113,0)
 Q
"RTN","RGUTEDT",114,0)
TERM S RGQUIT=2
"RTN","RGUTEDT",115,0)
 Q
"RTN","RGUTEDT",116,0)
ESC R *RGZ:1
"RTN","RGUTEDT",117,0)
 R:RGZ>0 *RGZ:1
"RTN","RGUTEDT",118,0)
 S RGC=0
"RTN","RGUTEDT",119,0)
 G UP:RGZ=65,DOWN:RGZ=66,RIGHT:RGZ=67,LEFT:RGZ=68                              ;Execute code
"RTN","RGUTEDT",120,0)
 S RGC=27
"RTN","RGUTEDT",121,0)
 Q
"RTN","RGUTEDT",122,0)
DSPLY(RGP1,RGP2) ;
"RTN","RGUTEDT",123,0)
 Q:'RGEON                                                              ; Refresh buffer display starting at position RGP1
"RTN","RGUTEDT",124,0)
 N RGZ,RGZ1
"RTN","RGUTEDT",125,0)
 S RGP1=+$G(RGP1,RGLEFT),RGZ=$E(RGDATA,RGP1+1,RGLEFT+RGLEN),RGP2=$S($D(RGP2):RGP2+$L(RGZ),1:RGLEN-RGP1+RGLEFT)
"RTN","RGUTEDT",126,0)
 S:RGP2>RGLEN RGP2=RGLEN
"RTN","RGUTEDT",127,0)
 S RGZ=RGZ_$J("",RGP2-$L(RGZ))
"RTN","RGUTEDT",128,0)
 F  D  Q:RGZ=""
"RTN","RGUTEDT",129,0)
 .D POSCUR(RGP1)
"RTN","RGUTEDT",130,0)
 .S RGZ1=RGRM-$X
"RTN","RGUTEDT",131,0)
 .S:RGZ1<1 RGZ1=1
"RTN","RGUTEDT",132,0)
 .W $E(RGZ,1,RGZ1)
"RTN","RGUTEDT",133,0)
 .S RGZ=$E(RGZ,RGZ1+1,999),RGP1=RGP1+RGZ1
"RTN","RGUTEDT",134,0)
 Q
"RTN","RGUTEDT",135,0)
INSW(RGTXT) ;
"RTN","RGUTEDT",136,0)
 S:RGPOS>$L(RGDATA) RGDATA=RGDATA_$J("",RGPOS-$L(RGDATA))              ; Pad if past end of buffer
"RTN","RGUTEDT",137,0)
 S RGDATA=$E($E(RGDATA,1,RGPOS)_RGTXT_$E(RGDATA,RGPOS+2-RGINS,RGMAX),1,RGMAX)
"RTN","RGUTEDT",138,0)
 D DSPLY(RGPOS,0),MOVETO(RGPOS+$L(RGTXT))
"RTN","RGUTEDT",139,0)
 Q
"RTN","RGUTEDT",140,0)
POSCUR(RGP) ;
"RTN","RGUTEDT",141,0)
 N RGZX,RGZY
"RTN","RGUTEDT",142,0)
 S RGP=+$G(RGP,RGPOS),RGZX=RGP-RGLEFT,RGZY=RGZX\RGW+RGY,RGZX=RGZX#RGW+RGX
"RTN","RGUTEDT",143,0)
 W $$XY^RGUT(RGZX,RGZY)
"RTN","RGUTEDT",144,0)
 Q
"RTN","RGUTEDT",145,0)
MOVETO(RGP) ;
"RTN","RGUTEDT",146,0)
 I RGP>RGMAX!(RGP<0) W RGBEL Q
"RTN","RGUTEDT",147,0)
 S RGPOS=RGP,RGP=RGLEFT
"RTN","RGUTEDT",148,0)
 S:RGPOS<RGLEFT RGLEFT=RGPOS-RGW-1
"RTN","RGUTEDT",149,0)
 S:RGLEFT+RGLEN<RGPOS RGLEFT=RGPOS-RGW+1
"RTN","RGUTEDT",150,0)
 S:RGLEFT'<RGMAX RGLEFT=RGMAX-RGW
"RTN","RGUTEDT",151,0)
 S:RGLEFT<0 RGLEFT=0
"RTN","RGUTEDT",152,0)
 D DSPLY():RGLEFT'=RGP,POSCUR()
"RTN","RGUTEDT",153,0)
 Q
"RTN","RGUTEDT",154,0)
UP I RGOPT["V" S RGQUIT=3
"RTN","RGUTEDT",155,0)
 E  D MOVETO(RGPOS-RGW)
"RTN","RGUTEDT",156,0)
 Q
"RTN","RGUTEDT",157,0)
DOWN I RGOPT["V" S RGQUIT=4
"RTN","RGUTEDT",158,0)
 E  D MOVETO(RGPOS+RGW)
"RTN","RGUTEDT",159,0)
 Q
"RTN","RGUTEDT",160,0)
RIGHT D MOVETO(RGPOS+1)
"RTN","RGUTEDT",161,0)
 Q
"RTN","RGUTEDT",162,0)
LEFT D MOVETO(RGPOS-1)
"RTN","RGUTEDT",163,0)
 Q
"RTN","RGUTEDT",164,0)
RESET W $S(RGOPT["R":RGRVON,1:RGRVOFF)
"RTN","RGUTEDT",165,0)
 S (RGPOS,RGLEFT)=0                                                    ; Current edit offset
"RTN","RGUTEDT",166,0)
 D DSPLY()                                                             ; Refresh display
"RTN","RGUTEDT",167,0)
 Q
"RTN","RGUTEDT",168,0)
ERROR W RGBEL                                                               ; Sound bell
"RTN","RGUTEDT",169,0)
 S @$$TRAP^RGZOSF("ERROR^RGUTEDT")
"RTN","RGUTEDT",170,0)
 G AGAIN
"RTN","RGUTFTP")
0^61^B5979349
"RTN","RGUTFTP",1,0)
RGUTFTP ;CAIRO/DKM - FTP support (currently defined only for VMS);12-Oct-1998 15:49;DKM
"RTN","RGUTFTP",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTFTP",3,0)
 ;=================================================================
"RTN","RGUTFTP",4,0)
 ; Should not be invoked directly, but through a call to FTP^RGUTOS
"RTN","RGUTFTP",5,0)
 ;=================================================================
"RTN","RGUTFTP",6,0)
VMS(RGIP,RGMODE,RGSRCF,RGTGTF,RGTGTD,RGUSER,RGPASS) ;
"RTN","RGUTFTP",7,0)
 N RGZ,RGZ1,RGFIL,RGSRCD
"RTN","RGUTFTP",8,0)
 D HOME^%ZIS
"RTN","RGUTFTP",9,0)
 I IO=IO(0) D
"RTN","RGUTFTP",10,0)
 .U IO
"RTN","RGUTFTP",11,0)
 .I "@"[RGIP D
"RTN","RGUTFTP",12,0)
 ..S:RGIP="@" RGIP=$P($ZIO," ",2)
"RTN","RGUTFTP",13,0)
 ..I RGIP="" D  Q:RGIP=""
"RTN","RGUTFTP",14,0)
 ...R "Enter target IP address: ",RGIP:DTIME,!
"RTN","RGUTFTP",15,0)
 ...S:RGIP[U RGIP=""
"RTN","RGUTFTP",16,0)
 .I $G(RGSRCF)="" D  Q:RGSRCF=""
"RTN","RGUTFTP",17,0)
 ..R "Enter source file name : ",RGSRCF:DTIME,!
"RTN","RGUTFTP",18,0)
 ..S:RGSRCF[U RGSRCF=""
"RTN","RGUTFTP",19,0)
 .I $G(RGUSER)="" D  Q:RGUSER=""
"RTN","RGUTFTP",20,0)
 ..R "Enter target user name : ",RGUSER:DTIME,!
"RTN","RGUTFTP",21,0)
 ..S:RGUSER[U RGUSER=""
"RTN","RGUTFTP",22,0)
 .I $G(RGPASS)="" D  Q:RGPASS=""
"RTN","RGUTFTP",23,0)
 ..R "Enter target password  : ",RGPASS:DTIME,!
"RTN","RGUTFTP",24,0)
 ..S:RGPASS[U RGPASS=""
"RTN","RGUTFTP",25,0)
 D:$G(RGIP)="" RAISE^RGUTOS("No IP address")
"RTN","RGUTFTP",26,0)
 D:$G(RGSRCF)="" RAISE^RGUTOS("No source file")
"RTN","RGUTFTP",27,0)
 D:$G(RGUSER)="" RAISE^RGUTOS("No target user")
"RTN","RGUTFTP",28,0)
 D:$G(RGPASS)="" RAISE^RGUTOS("No target password")
"RTN","RGUTFTP",29,0)
 S RGZ=$S(RGMODE["G":"get ",RGMODE["P":"put ",1:""),RGSRCF=$TR(RGSRCF,"\","/"),RGSRCD=""
"RTN","RGUTFTP",30,0)
 S:RGSRCF["/" RGZ1=$L(RGSRCF,"/")-1,RGSRCD=$P(RGSRCF,"/",1,RGZ1)_"/",RGSRCF=$P(RGSRCF,"/",RGZ1+1)
"RTN","RGUTFTP",31,0)
 D:RGZ="" RAISE^RGUTOS("Mode not specified")
"RTN","RGUTFTP",32,0)
 W:IO=IO(0) !,"Beginning file transfer...",!!
"RTN","RGUTFTP",33,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTFTP",34,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTFTP"),RGFIL="FTP"_$J_".TMP",RGMODE=$$UP^XLFSTR($G(RGMODE))
"RTN","RGUTFTP",35,0)
 D OPEN^RGUTOS(.RGFIL,"W")
"RTN","RGUTFTP",36,0)
 U RGFIL
"RTN","RGUTFTP",37,0)
 W:RGSRCD'="" $S(RGMODE["G":"cd ",1:"lcd ")_RGSRCD,!
"RTN","RGUTFTP",38,0)
 W:$G(RGTGTD)'="" $S(RGMODE["G":"lcd ",1:"cd ")_RGTGTD,!
"RTN","RGUTFTP",39,0)
 W $S($G(RGTGTF)="":"m"_RGZ_RGSRCF,1:RGZ_RGSRCF_" "_RGTGTF),!
"RTN","RGUTFTP",40,0)
 W:RGMODE["D"&(RGMODE["G") "mdelete "_RGSRCF,!
"RTN","RGUTFTP",41,0)
 W "quit",!
"RTN","RGUTFTP",42,0)
 D CLOSE^RGUTOS(.RGFIL)
"RTN","RGUTFTP",43,0)
 U IO
"RTN","RGUTFTP",44,0)
 S RGZ=$&ZLIB.%SPAWN("FTP "_RGIP_" /USER="""_RGUSER_"""/PASS="""_RGPASS_"""/INPUT="_RGFIL)
"RTN","RGUTFTP",45,0)
 D DELETE^RGUTOS(RGFIL)
"RTN","RGUTFTP",46,0)
 I RGMODE["P",RGMODE["D" D DELETE^RGUTOS(RGSRCF)
"RTN","RGUTFTP",47,0)
 Q
"RTN","RGUTFTP",48,0)
ERROR I IO=IO(0) D
"RTN","RGUTFTP",49,0)
 .U IO
"RTN","RGUTFTP",50,0)
 .W $$EC^%ZOSV,!!
"RTN","RGUTFTP",51,0)
 E  D ^ZTER
"RTN","RGUTFTP",52,0)
 Q
"RTN","RGUTIMP")
0^44^B10839885
"RTN","RGUTIMP",1,0)
RGUTIMP ;CAIRO/DKM - Import text into FileMan file;04-Sep-1998 11:26;DKM
"RTN","RGUTIMP",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIMP",3,0)
 ;=================================================================
"RTN","RGUTIMP",4,0)
 ; Imports data from a specially formatted text file into a
"RTN","RGUTIMP",5,0)
 ; FileMan file.
"RTN","RGUTIMP",6,0)
 ; Inputs:
"RTN","RGUTIMP",7,0)
 ;   RGINP  = Full input file or global specification.
"RTN","RGUTIMP",8,0)
 ;   RGTRACE= If nonzero, generates a debug trace.
"RTN","RGUTIMP",9,0)
 ; Outputs:
"RTN","RGUTIMP",10,0)
 ;   Returns status code^status message.  Status code of 0 means
"RTN","RGUTIMP",11,0)
 ;   successful completion.
"RTN","RGUTIMP",12,0)
 ;=================================================================
"RTN","RGUTIMP",13,0)
ENTRY(RGINP,RGTRACE) ;
"RTN","RGUTIMP",14,0)
 N RGLN,RGFN,RGLVL,RGBM,RGC,RGLBL,RGQT,RGST,RGIO,RGGBL
"RTN","RGUTIMP",15,0)
 S @$$TRAP^RGZOSF("ERROR^RGUTIMP")
"RTN","RGUTIMP",16,0)
 S RGFN=0,RGLVL=-1,RGTRACE=+$G(RGTRACE),RGST=0,RGIO=$I,U="^",RGC=0,RGGBL=$E(RGINP)=U
"RTN","RGUTIMP",17,0)
 I RGGBL S RGINP=$$CREF^DILF(RGINP)
"RTN","RGUTIMP",18,0)
 E  D OPEN^RGZOSF(.RGINP,"R")
"RTN","RGUTIMP",19,0)
 F  Q:$$READ  D  Q:RGST
"RTN","RGUTIMP",20,0)
 .U RGIO
"RTN","RGUTIMP",21,0)
 .W:RGTRACE=1 RGC,*13
"RTN","RGUTIMP",22,0)
 .W:RGTRACE=2 RGC_": ",$$TRUNC^RGUT(RGLN,$G(IOM,80)-$X-2),!
"RTN","RGUTIMP",23,0)
 .D DOIT(RGLN)
"RTN","RGUTIMP",24,0)
 D:'RGGBL CLOSE^RGZOSF(.RGINP)
"RTN","RGUTIMP",25,0)
 Q RGST
"RTN","RGUTIMP",26,0)
READ() I 'RGGBL S RGC=RGC+1 Q $$READ^RGZOSF(.RGLN,RGINP)
"RTN","RGUTIMP",27,0)
 S RGC=$O(@RGINP@(RGC))
"RTN","RGUTIMP",28,0)
 Q:'RGC 1
"RTN","RGUTIMP",29,0)
 I $D(@RGINP@(RGC))#2 S RGLN=@RGINP@(RGC) Q 0
"RTN","RGUTIMP",30,0)
 I $D(@RGINP@(RGC,0))#2 S RGLN=@RGINP@(RGC,0) Q 0
"RTN","RGUTIMP",31,0)
 Q 1
"RTN","RGUTIMP",32,0)
ERROR D ERR("Fatal error",$$EC^%ZOSV)
"RTN","RGUTIMP",33,0)
 Q RGST
"RTN","RGUTIMP",34,0)
DOIT(RGLN) ;
"RTN","RGUTIMP",35,0)
 N RGZ,RGL,RGFLD,RGWP
"RTN","RGUTIMP",36,0)
 S RGLN=$$TRIM^RGUT(RGLN)
"RTN","RGUTIMP",37,0)
 I ";"[$E(RGLN) W:RGTRACE=3 $P(RGLN,";",2,999),! Q
"RTN","RGUTIMP",38,0)
 F RGL=0:1 Q:$E(RGLN,RGL+1)'="."
"RTN","RGUTIMP",39,0)
 S RGLN=$E(RGLN,RGL+1,999)
"RTN","RGUTIMP",40,0)
 I RGLN'[":" D ERR("Missing label",RGLN) Q
"RTN","RGUTIMP",41,0)
 S RGLBL=$$TRIM^RGUT($P(RGLN,":")),RGLN=$$TRIM^RGUT($P(RGLN,":",2,999))
"RTN","RGUTIMP",42,0)
 I 'RGL S RGFN=$$FILE(RGLN) Q
"RTN","RGUTIMP",43,0)
 I RGL>RGLVL D ERR("Invalid nesting",RGLN) Q
"RTN","RGUTIMP",44,0)
 S RGLVL=RGL,RGFN=+$P(RGBM(RGLVL),U,4)
"RTN","RGUTIMP",45,0)
 S RGFLD=$$FLD(RGLBL,RGFN)
"RTN","RGUTIMP",46,0)
 S RGZ=+$P($G(^DD(RGFN,RGFLD,0)),U,2)
"RTN","RGUTIMP",47,0)
 I RGZ D  Q:RGST
"RTN","RGUTIMP",48,0)
 .S RGLVL=RGLVL+1,RGFN=RGZ,RGBM(RGLVL)=$$ENTRY^RGUTDIC(RGBM(RGLVL-1),"+"_RGFN)
"RTN","RGUTIMP",49,0)
 .I +RGBM(RGLVL)<0 D ERR("Error access subfile entry",RGLBL) Q
"RTN","RGUTIMP",50,0)
 .S RGFLD=$$FLD(.01,RGFN)
"RTN","RGUTIMP",51,0)
 I 'RGFLD D ERR("Unknown field",RGLBL) Q
"RTN","RGUTIMP",52,0)
 I 'RGWP,RGLN="" Q
"RTN","RGUTIMP",53,0)
 ;S:RGLN="+" RGLN=U_$TR($P(RGBM(RGLVL),U,2),"|",",")_"$C(1))",RGLN=1+$O(@RGLN,-1)\1
"RTN","RGUTIMP",54,0)
 I RGFLD=.01!'RGBM(RGLVL)!RGWP D  Q
"RTN","RGUTIMP",55,0)
 .I 'RGWP,RGFLD'=.01 D ERR("First field is not primary index",RGLBL) Q
"RTN","RGUTIMP",56,0)
 .I 'RGWP D
"RTN","RGUTIMP",57,0)
 ..S RGBM(RGLVL)=$$ENTRY^RGUTDIC(RGBM(RGLVL),"="_RGLN)
"RTN","RGUTIMP",58,0)
 ..S:+RGBM(RGLVL)'>0 RGBM(RGLVL)=$$ENTRY^RGUTDIC(RGBM(RGLVL),"="_$$UP^XLFSTR(RGLN))
"RTN","RGUTIMP",59,0)
 .S:+RGBM(RGLVL)'>0!RGWP RGBM(RGLVL)=$$ENTRY^RGUTDIC(RGBM(RGLVL),$S(RGLN="@"&'RGWP:RGLN,1:"~LX;.01///^S X=RGLN"))
"RTN","RGUTIMP",60,0)
 .I +RGBM(RGLVL)'>0,RGLN'="@" D ERR("Error adding entry",RGLN)
"RTN","RGUTIMP",61,0)
 S RGBM(RGLVL)=$$ENTRY^RGUTDIC(RGBM(RGLVL),"<;"_RGFLD_"///^S X=RGLN")
"RTN","RGUTIMP",62,0)
 D:+RGBM(RGLVL)'>0 ERR("Error writing to field",RGLBL)
"RTN","RGUTIMP",63,0)
 Q
"RTN","RGUTIMP",64,0)
FILE(RGFN) ;
"RTN","RGUTIMP",65,0)
 K RGBM
"RTN","RGUTIMP",66,0)
 S RGBM(1)=$$ENTRY^RGUTDIC(RGFN),RGLVL=1
"RTN","RGUTIMP",67,0)
 I +RGBM(1)'<0 S RGFN=+$P(RGBM(1),U,4)
"RTN","RGUTIMP",68,0)
 E  D ERR("Error accessing database",RGFN)
"RTN","RGUTIMP",69,0)
 Q RGFN
"RTN","RGUTIMP",70,0)
FLD(RGNM,RGFN) ;
"RTN","RGUTIMP",71,0)
 N RGZ
"RTN","RGUTIMP",72,0)
 S RGZ=$S(RGNM="":.01,RGNM=+RGNM:RGNM,1:+$O(^DD(RGFN,"B",RGNM,0)))
"RTN","RGUTIMP",73,0)
 I '$D(^DD(RGFN,RGZ,0)) S RGZ=0
"RTN","RGUTIMP",74,0)
 E  S RGWP=$P(^(0),U,2)["W"
"RTN","RGUTIMP",75,0)
 Q RGZ
"RTN","RGUTIMP",76,0)
ERR(RGMSG,RGX) ;
"RTN","RGUTIMP",77,0)
 S RGST=RGC_U_RGMSG_$S($D(RGX):": "_RGX,1:"")
"RTN","RGUTIMP",78,0)
 W:RGTRACE=2 RGC_": "_$P(RGST,U,2,999),!
"RTN","RGUTIMP",79,0)
 Q
"RTN","RGUTIN")
0^45^B3241713
"RTN","RGUTIN",1,0)
RGUTIN ;CAIRO/DKM - Platform specific inits;04-Sep-1998 11:26;DKM
"RTN","RGUTIN",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIN",3,0)
 ;=================================================================
"RTN","RGUTIN",4,0)
 N RGOS,RGD,RGH,X
"RTN","RGUTIN",5,0)
 S U="^",X="ERROR^RGUTIN",@^%ZOSF("TRAP"),RGOS=$P(^%ZOSF("OS"),U,2)
"RTN","RGUTIN",6,0)
 I 'RGOS D
"RTN","RGUTIN",7,0)
 .D HOME^%ZIS,TITLE^RGUT("RTL Platform-specific Inits",1.6)
"RTN","RGUTIN",8,0)
 .S RGD(1)="$$TEST^RGUTIN(""RGUTIN""_%S)"
"RTN","RGUTIN",9,0)
 .S RGH(1)="Enter the name of this MUMPS environment for the RG-namespace"
"RTN","RGUTIN",10,0)
 .S RGH(2)="platform-specific initialization process."
"RTN","RGUTIN",11,0)
 .S RGOS=$$ENTRY^RGMSCLKP("^DD(""OS"")","UX","Operating System: ","B","*","RGD","",0,5,"","","HELP(.RGH)")
"RTN","RGUTIN",12,0)
 .W !!
"RTN","RGUTIN",13,0)
 D:RGOS>0 INIT(RGOS)
"RTN","RGUTIN",14,0)
 Q
"RTN","RGUTIN",15,0)
INIT(RGOS) ;
"RTN","RGUTIN",16,0)
 N I,X,Y,Z
"RTN","RGUTIN",17,0)
 S X="RGUTIN"_RGOS,I=0
"RTN","RGUTIN",18,0)
 I '$$TEST(X) D  Q
"RTN","RGUTIN",19,0)
 .X "ZL RGUTOS1 ZS RGUTOS"
"RTN","RGUTIN",20,0)
 .W !!,"Init not found for specified OS. Will use generic init.",!!
"RTN","RGUTIN",21,0)
 K ^TMP($J)
"RTN","RGUTIN",22,0)
 F Z=0,RGOS F X=$S(Z:3,1:1):1 S Y=$T(+X^@("RGUTIN"_Z)) Q:Y=""  S I=I+1,^TMP($J,I)=Y
"RTN","RGUTIN",23,0)
 S $P(^TMP($J,1),";")="RGUTOS "
"RTN","RGUTIN",24,0)
 X "ZR  F Z=1:1:I ZI ^TMP($J,Z) ZS:Z=I RGUTOS"
"RTN","RGUTIN",25,0)
 W !!,"Initialization completed for "_$P(^DD("OS",RGOS,0),"^")_" operating system.",!!
"RTN","RGUTIN",26,0)
 K ^TMP($J)
"RTN","RGUTIN",27,0)
 Q
"RTN","RGUTIN",28,0)
TEST(X) X ^%ZOSF("TEST")
"RTN","RGUTIN",29,0)
 Q $T
"RTN","RGUTIN",30,0)
ERROR W !!,"An error has occurred during initialization.",!
"RTN","RGUTIN",31,0)
 Q
"RTN","RGUTIN0")
0^46^B1165234
"RTN","RGUTIN0",1,0)
RGUTIN0 ;CAIRO/DKM - Platform-dependent operations;04-Sep-1998 11:26;DKM
"RTN","RGUTIN0",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIN0",3,0)
 ;=================================================================
"RTN","RGUTIN0",4,0)
VER() Q $P($T(+2),";",3)
"RTN","RGUTIN0",5,0)
CVTFN(RGFIL,RGROOT) ;
"RTN","RGUTIN0",6,0)
 N RGZ,RGZ1,RGD
"RTN","RGUTIN0",7,0)
 S RGD=$$DIRDLM,RGROOT=$G(RGROOT)
"RTN","RGUTIN0",8,0)
 S:$E(RGROOT,$L(RGROOT))=$E(RGD,3) RGROOT=$E(RGROOT,1,$L(RGROOT)-1)
"RTN","RGUTIN0",9,0)
 S RGZ=$L(RGFIL,"/"),RGZ1=$P(RGFIL,"/",1,RGZ-1),RGFIL=$P(RGFIL,"/",RGZ)
"RTN","RGUTIN0",10,0)
 S:$L(RGZ1) RGROOT=RGROOT_$E(RGD,$S($L(RGROOT):2,1:1))_$TR(RGZ1,"/.-",$E(RGD,2))
"RTN","RGUTIN0",11,0)
 Q RGROOT_$S($L(RGROOT):$E(RGD,3),1:"")_RGFIL
"RTN","RGUTIN0",12,0)
RM(X) X ^%ZOSF("RM")
"RTN","RGUTIN0",13,0)
 Q
"RTN","RGUTIN0",14,0)
TEST(X) N Z
"RTN","RGUTIN0",15,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTIN0",16,0)
 X ^%ZOSF("TEST")
"RTN","RGUTIN0",17,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTIN0",18,0)
ETRAP() Q $$NEWERR^%ZTER
"RTN","RGUTIN0",19,0)
OPENX(X1,X2) ;
"RTN","RGUTIN0",20,0)
 D OPEN(.X1,.X2)
"RTN","RGUTIN0",21,0)
 Q X1
"RTN","RGUTIN16")
0^47^B3261417
"RTN","RGUTIN16",1,0)
RGUTIN16 ;CAIRO/DKM - Inits for VMS;04-Sep-1998 11:26;DKM
"RTN","RGUTIN16",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIN16",3,0)
OPEN(X1,X2) ;
"RTN","RGUTIN16",4,0)
 N Z
"RTN","RGUTIN16",5,0)
 S Z="X1"_$S("Rr"[$G(X2):":READONLY:0","Ww"[X2:":(NEWVERSION,RECORDSIZE=65535)","Bb"[X2:":(READONLY,BLOCKSIZE=0)",1:"")
"RTN","RGUTIN16",6,0)
 O @Z
"RTN","RGUTIN16",7,0)
 U X1
"RTN","RGUTIN16",8,0)
 S ^TMP("HFS",$J,X1)=""
"RTN","RGUTIN16",9,0)
 Q
"RTN","RGUTIN16",10,0)
CLOSE(X) C X
"RTN","RGUTIN16",11,0)
 K ^TMP("HFS",$J,X)
"RTN","RGUTIN16",12,0)
 Q
"RTN","RGUTIN16",13,0)
CLOSEALL N Z
"RTN","RGUTIN16",14,0)
 S Z=""
"RTN","RGUTIN16",15,0)
 F  S Z=$O(^TMP("HFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTIN16",16,0)
 K ^TMP("HFS",$J)
"RTN","RGUTIN16",17,0)
 Q
"RTN","RGUTIN16",18,0)
EOF U $I:TRAP
"RTN","RGUTIN16",19,0)
 Q
"RTN","RGUTIN16",20,0)
EOFERR() Q $ZE["ENDOFILE"
"RTN","RGUTIN16",21,0)
READ(X,Y) ;
"RTN","RGUTIN16",22,0)
 U $G(Y,$I):NOTRAP
"RTN","RGUTIN16",23,0)
 R X
"RTN","RGUTIN16",24,0)
 Q $ZA=-1
"RTN","RGUTIN16",25,0)
DELETE(X) ;
"RTN","RGUTIN16",26,0)
 O X::0
"RTN","RGUTIN16",27,0)
 C X:DELETE
"RTN","RGUTIN16",28,0)
 Q
"RTN","RGUTIN16",29,0)
RENAME(X1,X2) ;
"RTN","RGUTIN16",30,0)
 O X1:READONLY:0
"RTN","RGUTIN16",31,0)
 C X1:RENAME=X2
"RTN","RGUTIN16",32,0)
 Q
"RTN","RGUTIN16",33,0)
DIR(X1,X2,X3) ;
"RTN","RGUTIN16",34,0)
 N Z,Z1
"RTN","RGUTIN16",35,0)
 S $ZT="DIRX^RGUTOS",X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTIN16",36,0)
 K @X3
"RTN","RGUTIN16",37,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTIN16",38,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  S @X3@($P(Z1,"]",2))=""
"RTN","RGUTIN16",39,0)
DIRX Q
"RTN","RGUTIN16",40,0)
DEFDIR(X) Q $G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN16",41,0)
DIRDLM() Q "[.]"
"RTN","RGUTIN16",42,0)
ERR(X1,X2,X3) ;
"RTN","RGUTIN16",43,0)
 S X1=$P($P($ZE,", ",2),"-",3),X2=$P($P($ZE,", "),":"),X3=$P($ZE,", ",$S(X1="ZTRAP":4,1:3))
"RTN","RGUTIN16",44,0)
 Q
"RTN","RGUTIN16",45,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGUTIN16",46,0)
 D VMS^RGUTFTP(.X1,.X2,.X3,.X4,.X5,.X6,.X7)
"RTN","RGUTIN16",47,0)
 Q
"RTN","RGUTIN16",48,0)
RAISE(X) ZT $G(X)
"RTN","RGUTIN16",49,0)
TRAP(X) Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN16",50,0)
SIZE(X) Q $ZC(%GETFILE,X,"BLS")*$ZC(%GETFILE,X,"EOF")
"RTN","RGUTIN16",51,0)
FREE(X) Q $ZC(%GETDVI,X,"FREEBLOCKS")/2048
"RTN","RGUTIN18")
0^48^B2555614
"RTN","RGUTIN18",1,0)
RGUTIN18 ;CAIRO/DKM - Inits for Open-M;04-Sep-1998 11:26;DKM
"RTN","RGUTIN18",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIN18",3,0)
OPEN(X1,X2) ;
"RTN","RGUTIN18",4,0)
 O X1:$S("Rr"[$G(X2):"RS","Ww"[X2:"WNS","Bb"[X2:"RF",1:""):0
"RTN","RGUTIN18",5,0)
 E  ZT "NOPEN"
"RTN","RGUTIN18",6,0)
 U X1
"RTN","RGUTIN18",7,0)
 S ^TMP("HFS",$J,X1)=""
"RTN","RGUTIN18",8,0)
 Q
"RTN","RGUTIN18",9,0)
CLOSE(X) C X
"RTN","RGUTIN18",10,0)
 K ^TMP("HFS",$J,X)
"RTN","RGUTIN18",11,0)
 Q
"RTN","RGUTIN18",12,0)
CLOSEALL N Z
"RTN","RGUTIN18",13,0)
 S Z=""
"RTN","RGUTIN18",14,0)
 F  S Z=$O(^TMP("HFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTIN18",15,0)
 K ^TMP("HFS",$J)
"RTN","RGUTIN18",16,0)
 Q
"RTN","RGUTIN18",17,0)
EOF ZT:$ZA=-1 "ENDOFFILE"
"RTN","RGUTIN18",18,0)
 Q
"RTN","RGUTIN18",19,0)
EOFERR() Q:$ZE["ENDOFFILE"
"RTN","RGUTIN18",20,0)
READ(X,Y) ;
"RTN","RGUTIN18",21,0)
 S $ZT="READX"
"RTN","RGUTIN18",22,0)
 U $G(Y,$I)
"RTN","RGUTIN18",23,0)
 R X
"RTN","RGUTIN18",24,0)
 Q 0
"RTN","RGUTIN18",25,0)
READX Q 1
"RTN","RGUTIN18",26,0)
DELETE(X) ;
"RTN","RGUTIN18",27,0)
 S X=$ZF(-1,"del """_X_"""")
"RTN","RGUTIN18",28,0)
 Q
"RTN","RGUTIN18",29,0)
RENAME(X1,X2) ;
"RTN","RGUTIN18",30,0)
 S X1=$ZF(-1,"ren """_X1_""" """_X2_"""")
"RTN","RGUTIN18",31,0)
 Q
"RTN","RGUTIN18",32,0)
DIR(X1,X2,X3) ;
"RTN","RGUTIN18",33,0)
 N Z,Z1
"RTN","RGUTIN18",34,0)
 S X3=$G(X3,$NA(^UTILITY("DIR",$J)))
"RTN","RGUTIN18",35,0)
 K @X3
"RTN","RGUTIN18",36,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTIN18",37,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  D
"RTN","RGUTIN18",38,0)
 .S Z1=$P(Z1,"\",$L(Z1,"\"))
"RTN","RGUTIN18",39,0)
 .S:$TR(Z1,".")'="" @X3@(Z1)=""
"RTN","RGUTIN18",40,0)
 Q
"RTN","RGUTIN18",41,0)
DIRDLM() Q "\\\"
"RTN","RGUTIN18",42,0)
DEFDIR(X) ;
"RTN","RGUTIN18",43,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN18",44,0)
 S:$E(X,$L(X))'="\" X=X_"\"
"RTN","RGUTIN18",45,0)
 Q X
"RTN","RGUTIN18",46,0)
ERR(X1,X2,X3) ;
"RTN","RGUTIN18",47,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN18",48,0)
 S:X2["*" X2=""
"RTN","RGUTIN18",49,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN18",50,0)
 Q
"RTN","RGUTIN18",51,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGUTIN18",52,0)
 Q
"RTN","RGUTIN18",53,0)
RAISE(X) ZT $G(X)
"RTN","RGUTIN18",54,0)
TRAP(X) Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN18",55,0)
SIZE(X) Q 0
"RTN","RGUTIN18",56,0)
FREE(X) Q 0
"RTN","RGUTIN8")
0^49^B3307420
"RTN","RGUTIN8",1,0)
RGUTIN8 ;CAIRO/DKM - Inits for MSM;04-Sep-1998 11:26;DKM
"RTN","RGUTIN8",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTIN8",3,0)
OPEN(X1,X2) ;
"RTN","RGUTIN8",4,0)
 N Z
"RTN","RGUTIN8",5,0)
 S X2=$G(X2,"R")
"RTN","RGUTIN8",6,0)
 F Z=51:1:55 I '$D(^TMP("HFS",$J,Z)) D  Q
"RTN","RGUTIN8",7,0)
 .ZT:Z=55 "TMOF"
"RTN","RGUTIN8",8,0)
 .O Z:(X1:$S("RrWw"[X2:X2,1:"R")::::$S("Bb"[X2:"",1:$C(13,10)))
"RTN","RGUTIN8",9,0)
 .U Z
"RTN","RGUTIN8",10,0)
 .ZT:$ZA "OPEN"
"RTN","RGUTIN8",11,0)
 .S ^TMP("HFS",$J,Z)=X1,X1=Z
"RTN","RGUTIN8",12,0)
 Q
"RTN","RGUTIN8",13,0)
CLOSE(X) N Z
"RTN","RGUTIN8",14,0)
 S Z=X,X=$G(^TMP("HFS",$J,X))
"RTN","RGUTIN8",15,0)
 K ^(Z)
"RTN","RGUTIN8",16,0)
 C Z
"RTN","RGUTIN8",17,0)
 Q
"RTN","RGUTIN8",18,0)
CLOSEALL N Z
"RTN","RGUTIN8",19,0)
 F Z=0:0 S Z=$O(^TMP("HFS",$J,Z)) Q:'Z  C Z
"RTN","RGUTIN8",20,0)
 K ^TMP("HFS",$J)
"RTN","RGUTIN8",21,0)
 Q
"RTN","RGUTIN8",22,0)
EOF ZT:$ZC "EOF"
"RTN","RGUTIN8",23,0)
 Q
"RTN","RGUTIN8",24,0)
EOFERR() Q $ZE["ZEOF"
"RTN","RGUTIN8",25,0)
READ(X,Y) ;
"RTN","RGUTIN8",26,0)
 U:$G(Y)'="" Y
"RTN","RGUTIN8",27,0)
 R X
"RTN","RGUTIN8",28,0)
 Q $ZC&'$L(X)
"RTN","RGUTIN8",29,0)
DELETE(X) ;
"RTN","RGUTIN8",30,0)
 S X=$ZOS(2,X)
"RTN","RGUTIN8",31,0)
 Q
"RTN","RGUTIN8",32,0)
RENAME(X1,X2) ;
"RTN","RGUTIN8",33,0)
 N Z
"RTN","RGUTIN8",34,0)
 S Z=$ZOS(3,X1,X2)
"RTN","RGUTIN8",35,0)
 Q
"RTN","RGUTIN8",36,0)
DIR(X1,X2,X3) ;
"RTN","RGUTIN8",37,0)
 N Z
"RTN","RGUTIN8",38,0)
 S X1=$ZOS(12,X1,0),X2=+$G(X2),X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTIN8",39,0)
 K @X3
"RTN","RGUTIN8",40,0)
 F Z=1:1 Q:(X2&(Z>X2))!($P(X1,"^")="")  S @X3@($P(X1,"^"))="",X1=$ZOS(13,X1)
"RTN","RGUTIN8",41,0)
 Q
"RTN","RGUTIN8",42,0)
DEFDIR(X) ;
"RTN","RGUTIN8",43,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN8",44,0)
 S:$E(X,$L(X))'="\" X=X_"\"
"RTN","RGUTIN8",45,0)
 Q X
"RTN","RGUTIN8",46,0)
DIRDLM() Q "\\\"
"RTN","RGUTIN8",47,0)
FREE(X) S X=$ZOS(9,$E(X))
"RTN","RGUTIN8",48,0)
 Q X*$P(X,"^",2)*$P(X,"^",3)/1048576
"RTN","RGUTIN8",49,0)
ERR(X1,X2,X3) ;
"RTN","RGUTIN8",50,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN8",51,0)
 S:X2["*" X2=""
"RTN","RGUTIN8",52,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN8",53,0)
 Q
"RTN","RGUTIN8",54,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGUTIN8",55,0)
 Q
"RTN","RGUTIN8",56,0)
RAISE(X) ZT $G(X)
"RTN","RGUTIN8",57,0)
TRAP(X) Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN8",58,0)
SIZE(X) N I,Y,Z
"RTN","RGUTIN8",59,0)
 S Z=$ZOS(12,X,0),Z=$P(Z,"^",2,999),Y=0
"RTN","RGUTIN8",60,0)
 I Z'="" F I=30:-1:27 S Y=Y*256+$A(Z,I)
"RTN","RGUTIN8",61,0)
 Q Y
"RTN","RGUTLK2")
0^50^B48245359
"RTN","RGUTLK2",1,0)
RGUTLK2 ;CAIRO/DKM - Continuation of RGUTLKP;04-Sep-1998 11:26;DKM
"RTN","RGUTLK2",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTLK2",3,0)
LKP(%RGDX) ;
"RTN","RGUTLK2",4,0)
 N %RGD,%RGZ,%RGN
"RTN","RGUTLK2",5,0)
 S %RGXRN=0,%RGTRUNC=0,%RGIEN="",%RGSCT=0,%RGD=%RGDX
"RTN","RGUTLK2",6,0)
 W:'%RGHTML $$XY(%RGX+$L(%RGPRMPT),%RGY),$S(%RGOPT["X":"",1:%RGD),%RGEOS,!,"Searching"_$S(%RGOPT[U:" (press ^ to abort)",1:"")_"...",*13
"RTN","RGUTLK2",7,0)
 I $E(%RGD)="`" S %RGSLCT=%RGD G:'%RGHTML NR5 D SHOW($E(%RGD,2,999)) Q 1
"RTN","RGUTLK2",8,0)
NXTREF S %RGXRN=%RGXRN+1,%RGXRF=$P(%RGXRFS,U,%RGXRN),%RGD=%RGDX
"RTN","RGUTLK2",9,0)
 I %RGXRF="" G:%RGSCT NR3 W:'%RGHTML *7,*13,%RGEOL,"Not found"_$S(%RGD="":".",1:": ")_$S(%RGD'=+%RGD:%RGD,%RGOPT["D":$$ENTRY^RGUTDT(%RGD),1:%RGD) S %RGD1=$S(%RGOPT["X":U,1:"") Q ""
"RTN","RGUTLK2",10,0)
 S %RGOPT(0)=%RGOPT_%RGXRFS(%RGXRF)
"RTN","RGUTLK2",11,0)
 I %RGOPT(0)["D",$L(%RGDX) D  G:%RGD<1 NXTREF
"RTN","RGUTLK2",12,0)
 .S %RGD=$$%DT^RGUT(%RGDX)
"RTN","RGUTLK2",13,0)
 I %RGOPT(0)["W" D MTL G NXTREF
"RTN","RGUTLK2",14,0)
 S %RGKEY=$S(%RGOPT(0)["P":$P(%RGD," "),1:%RGD)_$S(%RGDIR<0:$C(255),1:""),%RGNUM=$S(%RGKEY=+%RGKEY:%RGKEY,1:"")
"RTN","RGUTLK2",15,0)
 I %RGD'="",$D(@%RGDIC@(%RGXRF,%RGD)) S %=%RGSCT+1 D ADD(%RGD) I %RGSCT=%,%RGOPT(0)["A" D SLCT(%RGSCT) Q %RGIEN
"RTN","RGUTLK2",16,0)
NR2 I %RGOPT(0)[U R %#1:0 I %=U S %RGTRUNC=1 G NR3:%RGSCT Q ""
"RTN","RGUTLK2",17,0)
 S %RGKEY=$O(@%RGDIC@(%RGXRF,%RGKEY),%RGDIR)
"RTN","RGUTLK2",18,0)
 I (%RGNUM="")=(%RGKEY=+%RGKEY),%RGD'="" S %RGKEY=""
"RTN","RGUTLK2",19,0)
 I %RGKEY'="",%RGOPT(0)["P",%RGKEY'=%RGD S %=$$PARTIAL(%RGD,%RGKEY) D ADD(%RGKEY):%>0 G:%'<0 NR2:%RGSCT<100
"RTN","RGUTLK2",20,0)
 I %RGKEY'="",%RGOPT(0)'["P",$E(%RGKEY,1,$L(%RGD))=%RGD D ADD(%RGKEY) G:%RGSCT<100 NR2
"RTN","RGUTLK2",21,0)
 I %RGNUM'="" S %RGKEY=%RGNUM_$C($S(%RGDIR<0:255,1:1)),%RGNUM="" G NR2
"RTN","RGUTLK2",22,0)
 I %RGSCT'<100 W:'%RGHTML *7 S %RGXRALL=0,%RGTRUNC=1
"RTN","RGUTLK2",23,0)
 G:'%RGSCT!%RGXRALL NXTREF
"RTN","RGUTLK2",24,0)
NR3 I %RGSCT=1,%RGOPT(0)[1,'%RGTRUNC D SLCT(1) Q %RGIEN
"RTN","RGUTLK2",25,0)
 S %RGKEY=%RGSLT,%RGSLT=1,%RGSMAX=$S(%RGHTML:99999,1:17-%RGY)
"RTN","RGUTLK2",26,0)
NR4 W:'%RGHTML $$XY(0,%RGY+1),%RGEOS,!
"RTN","RGUTLK2",27,0)
 F %RGN=%RGKEY:1:%RGKEY+%RGSMAX-1 D  Q:%RGN=%RGSCT
"RTN","RGUTLK2",28,0)
 .F %RGZ=0:1:%RGCOL-1 D
"RTN","RGUTLK2",29,0)
 ..S %1=IOM/%RGCOL*%RGZ\1,%RGLAST=%RGZ*%RGSMAX+%RGN
"RTN","RGUTLK2",30,0)
 ..Q:%RGLAST>%RGSCT
"RTN","RGUTLK2",31,0)
 ..W:'%RGHTML $$XY(%1,$Y),%RGEOL,%RGLAST,?5
"RTN","RGUTLK2",32,0)
 ..D SHOW(^TMP(%RGPID,%RGLAST),%1+4)
"RTN","RGUTLK2",33,0)
 .W:'%RGQUIET !
"RTN","RGUTLK2",34,0)
 Q:%RGHTML $S(%RGTRUNC:-%RGSCT,1:%RGSCT)
"RTN","RGUTLK2",35,0)
 W:%RGLAST<%RGSCT !,%RGSCT-%RGLAST," more choice(s)..."
"RTN","RGUTLK2",36,0)
 W:%RGTRUNC "  (list was truncated)",!
"RTN","RGUTLK2",37,0)
 W %RGEOS_%RGBEL,!!
"RTN","RGUTLK2",38,0)
 R "Enter selection: ",%RGSLCT:DTIME
"RTN","RGUTLK2",39,0)
 S:'$T %RGSLCT=U
"RTN","RGUTLK2",40,0)
 W *13
"RTN","RGUTLK2",41,0)
 I %RGOPT["K",%RGSLCT="" Q -1
"RTN","RGUTLK2",42,0)
 I "Nn"[%RGSLCT S %RGKEY=$S(%RGLAST<%RGSCT:%RGLAST+1,1:1) G NR4
"RTN","RGUTLK2",43,0)
 I "Bb"[%RGSLCT S %RGKEY=$S(%RGKEY=1:%RGSCT-%RGSMAX+1,%RGKEY'>%RGSMAX:1,1:%RGKEY-%RGSMAX) S:%RGKEY<1 %RGKEY=1 G NR4
"RTN","RGUTLK2",44,0)
 I "?"[%RGSLCT D HELP2 G NR4
"RTN","RGUTLK2",45,0)
 I "^^"[%RGSLCT S %RGD2="",%RGD1=$S(%RGOPT(0)["X":%RGSLCT,%RGSLCT="^^":%RGSLCT,1:"") Q ""
"RTN","RGUTLK2",46,0)
NR5 F  D  Q:%RGSLCT=""
"RTN","RGUTLK2",47,0)
 .I %RGOPT(0)["M" S %RGD=$P(%RGSLCT,";"),%RGSLCT=$P(%RGSLCT,";",2,999)
"RTN","RGUTLK2",48,0)
 .E  S %RGD=%RGSLCT,%RGSLCT=""
"RTN","RGUTLK2",49,0)
 .Q:'$L(%RGD)
"RTN","RGUTLK2",50,0)
 .I %RGD?1.N D SLCT(%RGD) Q
"RTN","RGUTLK2",51,0)
 .I %RGOPT(0)["M",%RGD?1.N1"-".N D  Q
"RTN","RGUTLK2",52,0)
 ..N %1,%2
"RTN","RGUTLK2",53,0)
 ..S %1=+%RGD,%2=+$P(%RGD,"-",2)
"RTN","RGUTLK2",54,0)
 ..S:'%2 %2=%RGSCT
"RTN","RGUTLK2",55,0)
 ..S:%1>%2 %RGD=%1,%1=%2,%2=%RGD
"RTN","RGUTLK2",56,0)
 ..S:%2>%RGSCT %2=%RGSCT
"RTN","RGUTLK2",57,0)
 ..F %=%1:1:%2 D SLCT(%)
"RTN","RGUTLK2",58,0)
 .I %RGOPT["X",%RGOPT'["L" S (%RGSLCT,%RGD1,%RGIEN)="" Q
"RTN","RGUTLK2",59,0)
 .I $E(%RGD)="`" D  Q
"RTN","RGUTLK2",60,0)
 ..S %RGD=+$E(%RGD,2,999)
"RTN","RGUTLK2",61,0)
 ..I $$VALD(%RGD) D DISV(%RGD) S %RGIEN=%RGD
"RTN","RGUTLK2",62,0)
 .S %RGD1=%RGD1_";"_%RGD
"RTN","RGUTLK2",63,0)
 W $$XY(0,%RGY+1),%RGEOS,!
"RTN","RGUTLK2",64,0)
 Q %RGIEN
"RTN","RGUTLK2",65,0)
 ; Add list selection to output
"RTN","RGUTLK2",66,0)
SLCT(%RGSLCT) ;
"RTN","RGUTLK2",67,0)
 I %RGSLCT>0,%RGSLCT'>%RGSCT D
"RTN","RGUTLK2",68,0)
 .S %RGIEN=+^TMP(%RGPID,+%RGSLCT)
"RTN","RGUTLK2",69,0)
 .D DISV(%RGIEN)
"RTN","RGUTLK2",70,0)
 Q
"RTN","RGUTLK2",71,0)
 ; Add IEN to output
"RTN","RGUTLK2",72,0)
DISV(%RGIEN) ;
"RTN","RGUTLK2",73,0)
 Q:%RGIEN=""
"RTN","RGUTLK2",74,0)
 I %RGMUL'="",'$D(@%RGMUL@(%RGIEN)) S @%RGMUL@(%RGIEN)="" D:'%RGQUIET APP(%RGIEN)
"RTN","RGUTLK2",75,0)
 D:%RGMUL="" APP(%RGIEN)
"RTN","RGUTLK2",76,0)
 Q:%RGOPT(0)["F"
"RTN","RGUTLK2",77,0)
 K:%RGSAME ^DISV(DUZ,%RGDISV)
"RTN","RGUTLK2",78,0)
 S %RGSAME=0,^DISV(DUZ,%RGDISV)=%RGIEN,^(%RGDISV,%RGIEN)=""
"RTN","RGUTLK2",79,0)
 Q
"RTN","RGUTLK2",80,0)
 ; Append primary key to key list
"RTN","RGUTLK2",81,0)
APP(%RGIEN) ;
"RTN","RGUTLK2",82,0)
 N %RGKEY
"RTN","RGUTLK2",83,0)
 S %RGKEY=$S(%RGIEN=+%RGIEN:$P($G(@%RGDIC@(%RGIEN,0)),U),1:%RGIEN)
"RTN","RGUTLK2",84,0)
 S %RGKEY=$$FMT(%RGIEN,%RGKEY)
"RTN","RGUTLK2",85,0)
 Q:'$L(%RGKEY)!($L(%RGKEY)+$L(%RGD2)'<250)
"RTN","RGUTLK2",86,0)
 S %RGD2=%RGD2_$S($L(%RGD2):";",1:"")_%RGKEY
"RTN","RGUTLK2",87,0)
 I %RGOPT(0)'["J",%RGOPT(0)'["M" S %RGD2=%RGD2_"  "_$$SID(%RGIEN)
"RTN","RGUTLK2",88,0)
 Q
"RTN","RGUTLK2",89,0)
 ; Multi-term lookup
"RTN","RGUTLK2",90,0)
MTL N %
"RTN","RGUTLK2",91,0)
 S %=$S(%RGDIC[")":$TR(%RGDIC,")",","),1:%RGDIC_"(")_"%RGXRF)"
"RTN","RGUTLK2",92,0)
 S %=$$LKP^RGUTMTL(%,%RGD,"^TMP(""MTL"",%RGPID)",%RGOPT(0)[U)
"RTN","RGUTLK2",93,0)
 S:%<0 %RGTRUNC=1
"RTN","RGUTLK2",94,0)
 D:% ADD(%RGPID,"^TMP","MTL")
"RTN","RGUTLK2",95,0)
 K ^TMP("MTL",%RGPID)
"RTN","RGUTLK2",96,0)
 Q
"RTN","RGUTLK2",97,0)
 ; Add key to selection list
"RTN","RGUTLK2",98,0)
ADD(%RGKEY,%RGIDX,%RGSUB) ;
"RTN","RGUTLK2",99,0)
 N %S
"RTN","RGUTLK2",100,0)
 S:'$D(%RGIDX) %RGIDX=%RGDIC,%RGSUB=%RGXRF
"RTN","RGUTLK2",101,0)
 F %S=0:0 S %S=$O(@%RGIDX@(%RGSUB,%RGKEY,%S)) Q:'%S  D
"RTN","RGUTLK2",102,0)
 .I %RGOPT(0)["O",$D(^TMP(%RGPID,0,%S)) Q
"RTN","RGUTLK2",103,0)
 .I $$VALD(%S) D
"RTN","RGUTLK2",104,0)
 ..S %RGSCT=%RGSCT+1,^TMP(%RGPID,%RGSCT)=%S_U_$S(%RGOPT(0)["W":"",1:%RGKEY),^(0,%S)=""
"RTN","RGUTLK2",105,0)
 ..I %RGOPT(0)["S",$G(^DISV(DUZ,%RGDISV))=%S S %RGSLT=%RGSCT
"RTN","RGUTLK2",106,0)
 Q
"RTN","RGUTLK2",107,0)
 ; Check entry against screening criteria
"RTN","RGUTLK2",108,0)
VALD(%S) Q:'$D(@%RGDIC@(%S))!'%S 0
"RTN","RGUTLK2",109,0)
 Q:%RGSCN="" 1
"RTN","RGUTLK2",110,0)
 N %,%1
"RTN","RGUTLK2",111,0)
 S %1=1,@$$TRAP^RGUTOS("V3^RGUTLK2")
"RTN","RGUTLK2",112,0)
 F %=0:0 S %=$O(@%RGSCN@(%)) Q:'%  D  Q:%1
"RTN","RGUTLK2",113,0)
 .S %1=0,@$$TRAP^RGUTOS("V2^RGUTLK2")
"RTN","RGUTLK2",114,0)
 .X "S %1="_@%RGSCN@(%)
"RTN","RGUTLK2",115,0)
V2 .Q
"RTN","RGUTLK2",116,0)
 Q %1
"RTN","RGUTLK2",117,0)
V3 Q 0
"RTN","RGUTLK2",118,0)
 ; Show the specified selection
"RTN","RGUTLK2",119,0)
SHOW(%RGSLCT,%RGCOL1,%RGCOL2) ;
"RTN","RGUTLK2",120,0)
 N %S,%Z,%P,%I
"RTN","RGUTLK2",121,0)
 S %S=+%RGSLCT,%Z=$G(@%RGDIC@(%S,0)),%P=$$FMT(%S,$S(%RGOPT["I":$P(%RGSLCT,U,2),1:$P(%Z,U)))
"RTN","RGUTLK2",122,0)
 ;S %I=$$SID(%S,$P(%RGSLCT,U,2)),%I=$S(%I="":%P,1:%I)
"RTN","RGUTLK2",123,0)
 S %I=$$SID(%S,%P),%I=$S(%I="":%P,1:%I)
"RTN","RGUTLK2",124,0)
 I %RGHTML D  Q
"RTN","RGUTLK2",125,0)
 .I '%RGQUIET W $$MSG^RGUT(%RGPRMPT,"|"),!
"RTN","RGUTLK2",126,0)
 .E  D DISV(%S)
"RTN","RGUTLK2",127,0)
 S %RGCOL1=+$G(%RGCOL1,$X)
"RTN","RGUTLK2",128,0)
 I %RGOPT(0)["Y" S %RGCOL2=+$G(%RGCOL2,IOM\%RGCOL+%RGCOL1-8-$L(%I))
"RTN","RGUTLK2",129,0)
 E  S %RGCOL2=+$G(%RGCOL2,IOM\%RGCOL\$S(%RGOPT(0)["D":3,1:2)-3+%RGCOL1)
"RTN","RGUTLK2",130,0)
 W $$XY(%RGCOL1,$Y)
"RTN","RGUTLK2",131,0)
 I %RGOPT(0)'["J",%I'=%P W $$TRUNC^RGUT(%P,IOM\%RGCOL-6),?%RGCOL2," "_$$TRUNC^RGUT(%I,IOM-%RGCOL2-2)
"RTN","RGUTLK2",132,0)
 E  W $$TRUNC^RGUT(%I,IOM\%RGCOL-6)
"RTN","RGUTLK2",133,0)
 Q
"RTN","RGUTLK2",134,0)
 ; Return external form of result
"RTN","RGUTLK2",135,0)
FMT(%S,%RGKEY) ;
"RTN","RGUTLK2",136,0)
 Q:%RGKEY="" %RGKEY
"RTN","RGUTLK2",137,0)
 I %RGTRP'="",$D(@%RGTRP@(%RGKEY)) Q @%RGTRP@(%RGKEY)
"RTN","RGUTLK2",138,0)
 S:%RGOPT(0)["D" %RGKEY=$$ENTRY^RGUTDT(%RGKEY)
"RTN","RGUTLK2",139,0)
 I %RGOPT(0)["Z",%RGSCN'="",$G(@%RGSCN)'="" S @("%RGKEY="_@%RGSCN)
"RTN","RGUTLK2",140,0)
 S:%RGOPT["J" %RGKEY=$$SID(%S,%RGKEY)
"RTN","RGUTLK2",141,0)
 Q %RGKEY
"RTN","RGUTLK2",142,0)
 ; Return secondary identifier
"RTN","RGUTLK2",143,0)
SID(%S,%RGKEY) ;
"RTN","RGUTLK2",144,0)
 S %RGKEY=$G(%RGKEY)
"RTN","RGUTLK2",145,0)
 N %Z
"RTN","RGUTLK2",146,0)
 S %Z=$G(@%RGDIC@(%S,0)),@("%Z="_$S(%RGSID<0:$S(%RGKEY=$$UP^XLFSTR($P(%Z,U)):"""""",1:"%RGKEY"),%RGSID="":"%RGSID",1:%RGSID))
"RTN","RGUTLK2",147,0)
 Q %Z
"RTN","RGUTLK2",148,0)
 ; Partial key lookup
"RTN","RGUTLK2",149,0)
PARTIAL(%RGD,%RGKEY) ;
"RTN","RGUTLK2",150,0)
 N %,%1,%2
"RTN","RGUTLK2",151,0)
 S (%(1),%(2))=0,%1(1)=%RGD,%1(2)=%RGKEY
"RTN","RGUTLK2",152,0)
 F %=1,2 S %1(%)=$TR(%1(%),".,;:?/!-","        ")
"RTN","RGUTLK2",153,0)
P1 S (%2(1),%2(2))=""
"RTN","RGUTLK2",154,0)
 F %=1,2 D
"RTN","RGUTLK2",155,0)
 .F %(%)=%(%)+1:1:$L(%1(%)," ") S %2(%)=$P(%1(%)," ",%(%)) Q:%2(%)'=""
"RTN","RGUTLK2",156,0)
 Q:%2(1)="" 1
"RTN","RGUTLK2",157,0)
 Q:%2(1)'=$E(%2(2),1,$L(%2(1))) -(%(1)=1)
"RTN","RGUTLK2",158,0)
 G P1
"RTN","RGUTLK2",159,0)
HELP(X) ; Application-specific help
"RTN","RGUTLK2",160,0)
 N %
"RTN","RGUTLK2",161,0)
 S %=""
"RTN","RGUTLK2",162,0)
 F  S %=$O(X(%)) Q:%=""  D:$Y>20 PAUSE W $G(X(%)),!
"RTN","RGUTLK2",163,0)
 Q
"RTN","RGUTLK2",164,0)
 ; Generic help
"RTN","RGUTLK2",165,0)
HELP1 N %
"RTN","RGUTLK2",166,0)
 W !!
"RTN","RGUTLK2",167,0)
 D:%RGHLP'="" @%RGHLP
"RTN","RGUTLK2",168,0)
 W !,"Enter a blank line for default action.",!
"RTN","RGUTLK2",169,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",170,0)
 W:%RGOPT'["W" "Enter ?? to see all possible selections.",!
"RTN","RGUTLK2",171,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",172,0)
 W "Enter a space to retrieve previous selection.",!
"RTN","RGUTLK2",173,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",174,0)
 W "Enter a valid identifier for lookup."
"RTN","RGUTLK2",175,0)
 W:(%RGOPT'["*")&(%RGXRFS[U) "  Append a * to include all indices."
"RTN","RGUTLK2",176,0)
 W !
"RTN","RGUTLK2",177,0)
 I %RGOPT["M" D
"RTN","RGUTLK2",178,0)
 .D:$Y>20 PAUSE
"RTN","RGUTLK2",179,0)
 .W "Separate multiple selections by semicolons."
"RTN","RGUTLK2",180,0)
 R !!,"Press any key to continue...",*%:DTIME
"RTN","RGUTLK2",181,0)
 Q
"RTN","RGUTLK2",182,0)
 ; Help at choice prompt
"RTN","RGUTLK2",183,0)
HELP2 N %
"RTN","RGUTLK2",184,0)
 W $$XY(0,16),%RGEOS,!
"RTN","RGUTLK2",185,0)
 W $S(%RGOPT(0)["K":"Enter N for next choices.",1:"Press RETURN for more choices.")
"RTN","RGUTLK2",186,0)
 W ?35,"Enter B for previous choices.",!
"RTN","RGUTLK2",187,0)
 W "Enter ^ to abort lookup.",?35,"Enter choice number to select.",!
"RTN","RGUTLK2",188,0)
 W "Any other entry = new lookup."
"RTN","RGUTLK2",189,0)
 W:%RGOPT(0)["M" ?35,"Separate multiple selections by semicolons."
"RTN","RGUTLK2",190,0)
 R !!,"Press any key to continue...",*%:DTIME
"RTN","RGUTLK2",191,0)
 Q
"RTN","RGUTLK2",192,0)
PAUSE N %
"RTN","RGUTLK2",193,0)
 R !,"Press any key for more...",*%:DTIME
"RTN","RGUTLK2",194,0)
 W $$XY(0,%RGY+2),%RGEOS
"RTN","RGUTLK2",195,0)
 Q
"RTN","RGUTLK2",196,0)
XY(X,Y) Q $S(%RGRS:"",1:$$XY^RGUT(X,Y))
"RTN","RGUTLKP")
0^51^B28169983
"RTN","RGUTLKP",1,0)
RGUTLKP ;CAIRO/DKM - File lookup utility;04-Sep-1998 11:26;DKM
"RTN","RGUTLKP",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTLKP",3,0)
 ;=================================================================
"RTN","RGUTLKP",4,0)
 ; Inputs:
"RTN","RGUTLKP",5,0)
 ;   %RGDIC  = Global root or file #
"RTN","RGUTLKP",6,0)
 ;   %RGOPT  = Options
"RTN","RGUTLKP",7,0)
 ;      A allow automatic selection of exact match
"RTN","RGUTLKP",8,0)
 ;      B sound bell with selection prompt
"RTN","RGUTLKP",9,0)
 ;      C use roll & scroll mode
"RTN","RGUTLKP",10,0)
 ;      D index is in date/time format
"RTN","RGUTLKP",11,0)
 ;      E use line editor
"RTN","RGUTLKP",12,0)
 ;      F forget the entry (i.e., ^DISV not updated)
"RTN","RGUTLKP",13,0)
 ;      G start with prior entry
"RTN","RGUTLKP",14,0)
 ;      H HTML-formatted output
"RTN","RGUTLKP",15,0)
 ;      I show only lookup identifiers
"RTN","RGUTLKP",16,0)
 ;      J show only secondary identifiers
"RTN","RGUTLKP",17,0)
 ;      K null entry at select prompt exits
"RTN","RGUTLKP",18,0)
 ;      L like X, but allows lookup at select prompt
"RTN","RGUTLKP",19,0)
 ;      M allow multiple selection
"RTN","RGUTLKP",20,0)
 ;      O show entry only once
"RTN","RGUTLKP",21,0)
 ;      P partial lookup
"RTN","RGUTLKP",22,0)
 ;      Q silent lookup
"RTN","RGUTLKP",23,0)
 ;      R reverse search through indices
"RTN","RGUTLKP",24,0)
 ;      S start selection list at last selection
"RTN","RGUTLKP",25,0)
 ;      T forget trapped inputs
"RTN","RGUTLKP",26,0)
 ;      U force uppercase translation
"RTN","RGUTLKP",27,0)
 ;      V extended DISV recall (prompt-specific)
"RTN","RGUTLKP",28,0)
 ;      W use multi-term lookup algorithm
"RTN","RGUTLKP",29,0)
 ;      X do not prompt for input
"RTN","RGUTLKP",30,0)
 ;      Y right justify secondary identifiers
"RTN","RGUTLKP",31,0)
 ;      Z perform special formatting of output
"RTN","RGUTLKP",32,0)
 ;      1 automatic selection if one match only
"RTN","RGUTLKP",33,0)
 ;      2-9 # of columns for selection display (default=1)
"RTN","RGUTLKP",34,0)
 ;      * force all indices to be searched
"RTN","RGUTLKP",35,0)
 ;      ^ allow search to be aborted
"RTN","RGUTLKP",36,0)
 ;   %RGPRMPT = Prompt (optional)
"RTN","RGUTLKP",37,0)
 ;   %RGXRFS  = Cross-references to examine (all "B"'s by default)
"RTN","RGUTLKP",38,0)
 ;   %RGDATA  = Data to lookup (optional)
"RTN","RGUTLKP",39,0)
 ;   %RGSCN   = Screening criteria (optional)
"RTN","RGUTLKP",40,0)
 ;   %RGMUL   = Local variable or global reference to
"RTN","RGUTLKP",41,0)
 ;              store multiple hits
"RTN","RGUTLKP",42,0)
 ;   %RGX     = Column position for prompt (optional)
"RTN","RGUTLKP",43,0)
 ;   %RGY     = Row position for prompt (optional)
"RTN","RGUTLKP",44,0)
 ;   %RGSID   = Piece # of secondary identifier (optional)
"RTN","RGUTLKP",45,0)
 ;              or executable M code to display same
"RTN","RGUTLKP",46,0)
 ;   %RGTRP   = Special inputs to trap (optional)
"RTN","RGUTLKP",47,0)
 ;   %RGHLP   = Entry point to invoke help
"RTN","RGUTLKP",48,0)
 ; Outputs:
"RTN","RGUTLKP",49,0)
 ;    Return value = index of selected entry or:
"RTN","RGUTLKP",50,0)
 ;      -1 for forced exit by ^
"RTN","RGUTLKP",51,0)
 ;      -2 for forced exit by ^^
"RTN","RGUTLKP",52,0)
 ;       0 for null entry
"RTN","RGUTLKP",53,0)
 ;=================================================================
"RTN","RGUTLKP",54,0)
ENTRY(%RGDIC,%RGOPT,%RGPRMPT,%RGXRFS,%RGDATA,%RGSCN,%RGMUL,%RGX,%RGY,%RGSID,%RGTRP,%RGHLP) ;
"RTN","RGUTLKP",55,0)
 N %,%1,%N,%S,%Z,%RGPID,%RGXRF,%RGSCT,%RGKEY,%RGKEY1,%RGDISV,%RGSLCT,%RGXRALL,%RGXRN,%RGSMAX,%RGTRUNC,%RGD,%RGD1,%RGD2,%RGBEL,%RGNUM,%RGDIR,%RGSLT,%RGCOL,%RGLAST,%RGSAME,%RGEOS,%RGEOL,%RGHTML,%RGRS,%RGQUIET
"RTN","RGUTLKP",56,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTLKP",57,0)
 S (%RGOPT,%RGOPT(0))=$$UP^XLFSTR($G(%RGOPT)),%RGPID="%RGLKP"_$J,%RGBEL=$S(%RGOPT["B":$C(7),1:""),%RGDIR=$S(%RGOPT["R":-1,1:1),%RGSLT=1,%RGCOL=1,%RGEOS=$C(27,91,74),%RGEOL=$C(27,91,75),%RGHTML=0,%RGLAST=0,%RGRS=%RGOPT["C",%RGQUIET=%RGOPT["Q"
"RTN","RGUTLKP",58,0)
 S:%RGRS (%RGEOL,%RGEOS)=""
"RTN","RGUTLKP",59,0)
 S:%RGQUIET %RGOPT=%RGOPT_"XHM"
"RTN","RGUTLKP",60,0)
 S:%RGOPT["H" (%RGBEL,%RGEOL,%RGEOS)="",%RGOPT=%RGOPT_"X",%RGHTML=1
"RTN","RGUTLKP",61,0)
 S:%RGOPT["L" %RGOPT=%RGOPT_"X"
"RTN","RGUTLKP",62,0)
 S U="^",DUZ=$G(DUZ,0),IO=$G(IO,$I),IOM=$G(IOM,80),%RGMUL=$G(%RGMUL),%RGHLP=$G(%RGHLP),%RGTRP=$G(%RGTRP),%RGSCN=$G(%RGSCN),%RGSAME=%RGOPT["M"&(%RGMUL'="")
"RTN","RGUTLKP",63,0)
 F %=2:1:9 S:%RGOPT[% %RGCOL=%
"RTN","RGUTLKP",64,0)
 S:%RGOPT'["M" %RGMUL=""
"RTN","RGUTLKP",65,0)
 K:%RGMUL'="" @%RGMUL
"RTN","RGUTLKP",66,0)
 S:%RGDIC=+%RGDIC %RGDIC=$$ROOT^DILFD(%RGDIC)
"RTN","RGUTLKP",67,0)
 S:$E(%RGDIC,$L(%RGDIC))="(" %RGDIC=$E(%RGDIC,1,$L(%RGDIC)-1)
"RTN","RGUTLKP",68,0)
 S:$E(%RGDIC,$L(%RGDIC))="," %RGDIC=$E(%RGDIC,1,$L(%RGDIC)-1)
"RTN","RGUTLKP",69,0)
 I %RGDIC["(",$E(%RGDIC,$L(%RGDIC))'=")" S %RGDIC=%RGDIC_")"
"RTN","RGUTLKP",70,0)
 S %RGPRMPT=$G(%RGPRMPT,$S(%RGOPT["X":"",1:"Enter identifier: "))
"RTN","RGUTLKP",71,0)
 S %RGDISV=$S(%RGDIC[")":$TR(%RGDIC,")",","),1:%RGDIC_"(")_$S(%RGOPT["V":";"_%RGPRMPT,1:"")
"RTN","RGUTLKP",72,0)
 S %RGSID=$G(%RGSID),%RGXRFS=$G(%RGXRFS),%RGDATA=$G(%RGDATA)
"RTN","RGUTLKP",73,0)
 S:%RGSID=+%RGSID %RGSID=$S(%RGSID<0:%RGSID,1:"$P(%Z,U,"_%RGSID_")")
"RTN","RGUTLKP",74,0)
 S %RGX=$G(%RGX,0),%RGY=$G(%RGY,3),DTIME=$G(DTIME,999999999)
"RTN","RGUTLKP",75,0)
 W:'%RGHTML $$XY(%RGX,%RGY),%RGEOS,!
"RTN","RGUTLKP",76,0)
 I %RGOPT["G",$G(^DISV(DUZ,%RGDISV))'="" D
"RTN","RGUTLKP",77,0)
 .S %RGDATA=^(%RGDISV)
"RTN","RGUTLKP",78,0)
 .S:+%RGDATA=%RGDATA %RGDATA=$P($G(@%RGDIC@(%RGDATA,0)),U)
"RTN","RGUTLKP",79,0)
 I %RGXRFS="" D
"RTN","RGUTLKP",80,0)
 .S (%,%RGXRFS)="B"
"RTN","RGUTLKP",81,0)
 .F  S %=$O(@%RGDIC@(%)) Q:$E(%)'="B"  S %RGXRFS=%RGXRFS_U_%
"RTN","RGUTLKP",82,0)
 F %=1:1:$L(%RGXRFS,U) S %1=$P(%RGXRFS,U,%) S:%1'="" %RGXRFS($P(%1,":"))=$P(%1,":",2),$P(%RGXRFS,U,%)=$P(%1,":")
"RTN","RGUTLKP",83,0)
 S (%RGD1,%RGD2)=""
"RTN","RGUTLKP",84,0)
 D RM(0)
"RTN","RGUTLKP",85,0)
 S %RGIEN=$$INPUT
"RTN","RGUTLKP",86,0)
 W:'%RGHTML $$XY(%RGX+$L(%RGPRMPT),%RGY),$$TRUNC^RGUT(%RGD2,IOM-$X),%RGEOS
"RTN","RGUTLKP",87,0)
 D RM(IOM)
"RTN","RGUTLKP",88,0)
 K ^TMP(%RGPID)
"RTN","RGUTLKP",89,0)
 Q %RGIEN
"RTN","RGUTLKP",90,0)
INPUT() ;
"RTN","RGUTLKP",91,0)
INP K ^TMP(%RGPID)
"RTN","RGUTLKP",92,0)
 D READ
"RTN","RGUTLKP",93,0)
 S:%RGOPT["U" %RGD=$$UP^XLFSTR(%RGD)
"RTN","RGUTLKP",94,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTLKP")
"RTN","RGUTLKP",95,0)
 I %RGD="",%RGTRP'="" S %RGD=$G(@%RGTRP@(" "))
"RTN","RGUTLKP",96,0)
 Q:"^^"[%RGD -$L(%RGD)
"RTN","RGUTLKP",97,0)
 I "?"[%RGD D HELP1^RGUTLK2 G INP
"RTN","RGUTLKP",98,0)
 I %RGD=" " D SAME G:%RGD="" INP2
"RTN","RGUTLKP",99,0)
 I %RGTRP'="",$D(@%RGTRP@(%RGD)) D  Q %RGD
"RTN","RGUTLKP",100,0)
 .S %RGSAME=1
"RTN","RGUTLKP",101,0)
 .D:%RGOPT'["T" DISV^RGUTLK2(%RGD)
"RTN","RGUTLKP",102,0)
 .S %RGD2=$G(@%RGTRP@(%RGD))
"RTN","RGUTLKP",103,0)
 .S:%RGD2="" %RGD2=%RGD
"RTN","RGUTLKP",104,0)
 S:%RGD="??" %RGD=""
"RTN","RGUTLKP",105,0)
 I $E(%RGD,$L(%RGD))="*" S %RGXRALL=1,%RGD=$E(%RGD,1,$L(%RGD)-1)
"RTN","RGUTLKP",106,0)
 E  S %RGXRALL=%RGOPT["*"
"RTN","RGUTLKP",107,0)
 S %RGIEN=$$LKP^RGUTLK2(%RGD)
"RTN","RGUTLKP",108,0)
INP2 G INP:%RGIEN=""!$L(%RGD1)
"RTN","RGUTLKP",109,0)
 Q %RGIEN
"RTN","RGUTLKP",110,0)
READ S %RGD=""
"RTN","RGUTLKP",111,0)
 F  Q:%RGD'=""!(%RGD1="")  S %RGD=$P(%RGD1,";"),%RGD1=$P(%RGD1,";",2,999)
"RTN","RGUTLKP",112,0)
 Q:$L(%RGD)
"RTN","RGUTLKP",113,0)
 S %RGD=%RGDATA,%RGDATA=""
"RTN","RGUTLKP",114,0)
 W:'%RGHTML $$XY(0,%RGY+2),%RGEOS,$$XY(%RGX,%RGY),%RGPRMPT_%RGEOL
"RTN","RGUTLKP",115,0)
 I %RGOPT["X" S:%RGOPT["E" %RGOPT=$TR(%RGOPT,"X"),%RGDATA=%RGD Q
"RTN","RGUTLKP",116,0)
 I %RGOPT["E" D
"RTN","RGUTLKP",117,0)
 .N %,%1
"RTN","RGUTLKP",118,0)
 .S:%RGD?1"`"1.N %RGD=+$E(%RGD,2,99),%RGD=$$FMT^RGUTLK2(%RGD,$P($G(@%RGDIC@(%RGD,0)),U))
"RTN","RGUTLKP",119,0)
 .S %1=0,%=%RGX+$L(%RGPRMPT),%=$$ENTRY^RGUTEDT(%RGD,IOM-%-1,%,%RGY,"","RHV",,,,,.%1)
"RTN","RGUTLKP",120,0)
 .S:%1=3 %=U
"RTN","RGUTLKP",121,0)
 .S:%="?" %RGDATA=%RGD
"RTN","RGUTLKP",122,0)
 .S %RGD=%
"RTN","RGUTLKP",123,0)
 E  I '$L(%RGD) R %RGD:DTIME S:'$T %RGD=U
"RTN","RGUTLKP",124,0)
 I %RGOPT["M",%RGD[";" S %RGD1=%RGD G READ
"RTN","RGUTLKP",125,0)
 Q
"RTN","RGUTLKP",126,0)
SAME S %RGSAME=0,%RGIEN="",%RGD="",%RGSCT=0
"RTN","RGUTLKP",127,0)
 I %RGMUL'="" D
"RTN","RGUTLKP",128,0)
 .S %=""
"RTN","RGUTLKP",129,0)
 .F  S %=$O(^DISV(DUZ,%RGDISV,%)) Q:%=""  D SM1
"RTN","RGUTLKP",130,0)
 E  S %=$G(^DISV(DUZ,%RGDISV)) D:%'="" SM1
"RTN","RGUTLKP",131,0)
 S:%RGHTML %RGIEN=%RGSCT
"RTN","RGUTLKP",132,0)
 Q
"RTN","RGUTLKP",133,0)
SM1 I %RGTRP'="",$D(@%RGTRP@(%)) S %RGIEN=%,%RGD=%
"RTN","RGUTLKP",134,0)
 E  I $$VALD^RGUTLK2(%) S %RGIEN=%
"RTN","RGUTLKP",135,0)
 I  D DISV^RGUTLK2(%RGIEN) S %RGSCT=%RGSCT+1
"RTN","RGUTLKP",136,0)
 Q
"RTN","RGUTLKP",137,0)
XY(X,Y) Q $S(%RGRS:"",1:$$XY^RGUT(X,Y))
"RTN","RGUTLKP",138,0)
RM(X) X ^%ZOSF("RM")
"RTN","RGUTLKP",139,0)
 Q
"RTN","RGUTLKP",140,0)
ERROR W:'%RGHTML $$XY(0,%RGY+1),*7,%RGEOL,$$EC^%ZOSV
"RTN","RGUTLKP",141,0)
 S (%RGDATA,%RGD1,%RGD2)=""
"RTN","RGUTLKP",142,0)
 G INP
"RTN","RGUTMTL")
0^52^B13394927
"RTN","RGUTMTL",1,0)
RGUTMTL ;CAIRO/DKM - Multi-term lookup support ;04-Sep-1998 11:26;DKM
"RTN","RGUTMTL",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTMTL",3,0)
 ;=================================================================
"RTN","RGUTMTL",4,0)
 ; Parse term into component words (KWIC)
"RTN","RGUTMTL",5,0)
PARSE2(RGTRM,RGRTN,RGMIN) ;
"RTN","RGUTMTL",6,0)
 N X,L,C,%
"RTN","RGUTMTL",7,0)
 K RGRTN
"RTN","RGUTMTL",8,0)
 S %="RGRTN(I)",X=$$UP^XLFSTR(RGTRM),RGMIN=+$G(RGMIN)
"RTN","RGUTMTL",9,0)
 D S^XTLKWIC
"RTN","RGUTMTL",10,0)
 S L="",C=0
"RTN","RGUTMTL",11,0)
 F  S L=$O(RGRTN(L)) Q:L=""  D
"RTN","RGUTMTL",12,0)
 .I $L(L)<RGMIN K RGRTN(L)
"RTN","RGUTMTL",13,0)
 .E  S C=C+1
"RTN","RGUTMTL",14,0)
 Q C
"RTN","RGUTMTL",15,0)
 ; Parse term into component words
"RTN","RGUTMTL",16,0)
PARSE(RGTRM,RGRTN,RGMIN) ;
"RTN","RGUTMTL",17,0)
 N X,Y,Z,L,C
"RTN","RGUTMTL",18,0)
 K RGRTN
"RTN","RGUTMTL",19,0)
 S RGTRM=$$UP^XLFSTR(RGTRM),C=0,RGMIN=+$G(RGMIN,1),Z=""
"RTN","RGUTMTL",20,0)
 F X=1:1 Q:'$L(RGTRM)  D:$E(RGTRM,X)'?1AN
"RTN","RGUTMTL",21,0)
 .S Y=Z,Z=$E(RGTRM,X),L=$E(RGTRM,1,X-1),RGTRM=$E(RGTRM,X+1,999),X=0
"RTN","RGUTMTL",22,0)
 .I $L(L)'<RGMIN,L'=+L,'$D(RGRTN(L)) S RGRTN(L)=Y,C=C+1,Y=""
"RTN","RGUTMTL",23,0)
 Q C
"RTN","RGUTMTL",24,0)
 ; Create/delete an MTL cross reference for term
"RTN","RGUTMTL",25,0)
XREF(RGRT,RGTRM,RGDA,RGDEL) ;
"RTN","RGUTMTL",26,0)
 N RGZ,RGG
"RTN","RGUTMTL",27,0)
 S RGZ=$L(RGRT),RGG=$S($E(RGRT,RGZ)=")":$E(RGRT,1,RGZ-1)_",",1:RGRT_"(")_"RGZ,",RGZ=$C(1)
"RTN","RGUTMTL",28,0)
 F  S RGZ=$O(RGDA(RGZ),-1) Q:'RGZ  S RGG=RGG_""""_RGDA(RGZ)_""","
"RTN","RGUTMTL",29,0)
 S RGG=RGG_""""_RGDA_""")"
"RTN","RGUTMTL",30,0)
 Q:'$$PARSE(RGTRM,.RGZ)
"RTN","RGUTMTL",31,0)
 S RGZ="",RGDEL=''$G(RGDEL)
"RTN","RGUTMTL",32,0)
 L +@RGRT
"RTN","RGUTMTL",33,0)
 F  S RGZ=$O(RGZ(RGZ)) Q:RGZ=""  D
"RTN","RGUTMTL",34,0)
 .I ''$D(@RGG)=RGDEL D
"RTN","RGUTMTL",35,0)
 ..I RGDEL K @RGG  K:$D(@RGRT@(RGZ))<10 @RGRT@(RGZ)
"RTN","RGUTMTL",36,0)
 ..E  D:'$D(@RGRT@(RGZ)) REFNEW(RGZ) S @RGG=""
"RTN","RGUTMTL",37,0)
 ..D REFCNT(RGZ,$S(RGDEL:-1,1:1))
"RTN","RGUTMTL",38,0)
 L -@RGRT
"RTN","RGUTMTL",39,0)
 Q
"RTN","RGUTMTL",40,0)
 ; Increment/decrement reference count for term and its stems
"RTN","RGUTMTL",41,0)
REFCNT(RGX,RGI) ;
"RTN","RGUTMTL",42,0)
 Q:'$L(RGX)
"RTN","RGUTMTL",43,0)
 I $D(@RGRT@(RGX)) D
"RTN","RGUTMTL",44,0)
 .N RGZ
"RTN","RGUTMTL",45,0)
 .S RGZ=$G(@RGRT@(RGX))+RGI
"RTN","RGUTMTL",46,0)
 .I RGZ<1 K @RGRT@(RGX)
"RTN","RGUTMTL",47,0)
 .E  S @RGRT@(RGX)=RGZ
"RTN","RGUTMTL",48,0)
 D REFCNT($E(RGX,1,$L(RGX)-1),RGI)
"RTN","RGUTMTL",49,0)
 Q
"RTN","RGUTMTL",50,0)
 ; Create new term reference
"RTN","RGUTMTL",51,0)
REFNEW(RGX) ;
"RTN","RGUTMTL",52,0)
 N RGZ,RGC,RGABR
"RTN","RGUTMTL",53,0)
 S RGZ=RGX,RGC=0,RGABR=0
"RTN","RGUTMTL",54,0)
 F  S RGZ=$$STEM(RGZ,RGX) Q:'$L(RGZ)  S RGC=RGC+$G(@RGRT@(RGZ)),RGZ=RGZ_$C(255)
"RTN","RGUTMTL",55,0)
 S @RGRT@(RGX)=RGC
"RTN","RGUTMTL",56,0)
 Q
"RTN","RGUTMTL",57,0)
 ; Lookup a term in an MTL index
"RTN","RGUTMTL",58,0)
 ; RGRT  = Root of index (e.g., ^RGCOD(990.9,"AD"))
"RTN","RGUTMTL",59,0)
 ; RGTRM = Term to lookup
"RTN","RGUTMTL",60,0)
 ; RGRTN = Root of returned array (note: killed before populated)
"RTN","RGUTMTL",61,0)
 ; RGABR = If nonzero, user can abort lookup with ^
"RTN","RGUTMTL",62,0)
LKP(RGRT,RGTRM,RGRTN,RGABR) ;
"RTN","RGUTMTL",63,0)
 N RGX,RGY,RGW,RGF,RGIEN,RGL,RGM,RGTRM1
"RTN","RGUTMTL",64,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTMTL",65,0)
 K @RGRTN
"RTN","RGUTMTL",66,0)
 S RGABR=+$G(RGABR),@$$TRAP^RGZOSF("LKP2^RGUTMTL")
"RTN","RGUTMTL",67,0)
 I $$PARSE(RGTRM,.RGTRM)=1 S RGW(1,$O(RGTRM("")))=""
"RTN","RGUTMTL",68,0)
 E  D
"RTN","RGUTMTL",69,0)
 .S RGTRM="",RGM=9999999999
"RTN","RGUTMTL",70,0)
 .F  S RGTRM=$O(RGTRM(RGTRM)) Q:RGTRM=""  D  Q:RGL<0
"RTN","RGUTMTL",71,0)
 ..S RGX=RGTRM(RGTRM)["=",RGY=RGTRM(RGTRM)["~",RGTRM1="",RGL=$S(RGY:9999999999,1:-1)
"RTN","RGUTMTL",72,0)
 ..I 'RGY F  S RGTRM1=$$STEM(RGTRM1,RGTRM,RGX) Q:RGTRM1=""  D:$D(^(RGTRM1))>1  Q:RGL>RGM
"RTN","RGUTMTL",73,0)
 ...S:RGL=-1 RGL=0
"RTN","RGUTMTL",74,0)
 ...S RGL=RGL+$G(^(RGTRM1))
"RTN","RGUTMTL",75,0)
 ...S RGTRM1=RGTRM1_$C(255)
"RTN","RGUTMTL",76,0)
 ..S RGW(RGL,RGTRM)=""
"RTN","RGUTMTL",77,0)
 ..I RGL>0,RGL<RGM S RGM=RGL
"RTN","RGUTMTL",78,0)
 ..D:RGABR ABORT
"RTN","RGUTMTL",79,0)
 Q:$D(RGW(-1)) 0
"RTN","RGUTMTL",80,0)
 S RGW="",RGF=0
"RTN","RGUTMTL",81,0)
 F  S RGW=$O(RGW(RGW)),RGTRM="" Q:RGW=""  D  Q:RGF=-1
"RTN","RGUTMTL",82,0)
 .F  S RGTRM=$O(RGW(RGW,RGTRM)) Q:RGTRM=""  D  Q:RGF=-1
"RTN","RGUTMTL",83,0)
 ..S RGX=RGTRM(RGTRM)["=",RGY=RGTRM(RGTRM)["~"
"RTN","RGUTMTL",84,0)
 ..I RGF D
"RTN","RGUTMTL",85,0)
 ...S RGIEN=0
"RTN","RGUTMTL",86,0)
 ...F  S RGIEN=$O(@RGRTN@(RGIEN)),RGTRM1="" Q:'RGIEN  D  Q:RGF=-1
"RTN","RGUTMTL",87,0)
 ....F  S RGTRM1=$$STEM(RGTRM1,RGTRM,RGX) Q:RGTRM1=""  Q:$D(^(RGTRM1,RGIEN))
"RTN","RGUTMTL",88,0)
 ....I RGY-(RGTRM1="") K @RGRTN@(RGIEN) S:$D(@RGRTN)'>1 RGF=-1
"RTN","RGUTMTL",89,0)
 ..E  D
"RTN","RGUTMTL",90,0)
 ...S RGTRM1="",RGF=1
"RTN","RGUTMTL",91,0)
 ...F  S RGTRM1=$$STEM(RGTRM1,RGTRM,RGX) Q:RGTRM1=""  M @RGRTN=^(RGTRM1)
"RTN","RGUTMTL",92,0)
 ...S:$D(@RGRTN)'>1 RGF=-1
"RTN","RGUTMTL",93,0)
 Q $D(@RGRTN)>1
"RTN","RGUTMTL",94,0)
LKP2 K @RGRTN
"RTN","RGUTMTL",95,0)
 Q -1
"RTN","RGUTMTL",96,0)
 ; Check for user abort
"RTN","RGUTMTL",97,0)
ABORT N RGZ
"RTN","RGUTMTL",98,0)
 R RGZ#1:0
"RTN","RGUTMTL",99,0)
 D:RGZ=U RAISE^RGZOSF()
"RTN","RGUTMTL",100,0)
 Q
"RTN","RGUTMTL",101,0)
 ; Return in successive calls all terms sharing common stem
"RTN","RGUTMTL",102,0)
 ; (sets naked reference)
"RTN","RGUTMTL",103,0)
STEM(RGLAST,RGSTEM,RGF) ;
"RTN","RGUTMTL",104,0)
 D:RGABR ABORT
"RTN","RGUTMTL",105,0)
 I RGLAST="" S RGLAST=RGSTEM Q:$D(@RGRT@(RGLAST)) RGLAST
"RTN","RGUTMTL",106,0)
 Q:$G(RGF) ""
"RTN","RGUTMTL",107,0)
 S RGLAST=$O(@RGRT@(RGLAST))
"RTN","RGUTMTL",108,0)
 Q $S($E(RGLAST,1,$L(RGSTEM))=RGSTEM:RGLAST,1:"")
"RTN","RGUTOS")
0^53^B9601175
"RTN","RGUTOS",1,0)
RGUTOS ;CAIRO/DKM - Platform-dependent operations;12-Oct-1998 16:14;DKM
"RTN","RGUTOS",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTOS",3,0)
 ;=================================================================
"RTN","RGUTOS",4,0)
 ; Return version # of RTL
"RTN","RGUTOS",5,0)
VER() Q +$P($T(RGUTOS+1),";",3)
"RTN","RGUTOS",6,0)
 ; Set right margin
"RTN","RGUTOS",7,0)
RM(X) X ^%ZOSF("RM")
"RTN","RGUTOS",8,0)
 Q
"RTN","RGUTOS",9,0)
 ; Test for routine/tag
"RTN","RGUTOS",10,0)
TEST(X) N Z
"RTN","RGUTOS",11,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTOS",12,0)
 X ^%ZOSF("TEST")
"RTN","RGUTOS",13,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTOS",14,0)
 ; Raise an exception
"RTN","RGUTOS",15,0)
RAISE(X) ZT $G(X)
"RTN","RGUTOS",16,0)
 ; Return code to set error trap
"RTN","RGUTOS",17,0)
TRAP(X) Q $$SUBST^RGUT(^%ZOSF("TRAP"),"X",""""_X_"""")
"RTN","RGUTOS",18,0)
 ; Check for $ET capability
"RTN","RGUTOS",19,0)
ETRAP() Q $$NEWERR^%ZTER
"RTN","RGUTOS",20,0)
 ; Open a file (extrinsic)
"RTN","RGUTOS",21,0)
OPENX(X1,X2) ;
"RTN","RGUTOS",22,0)
 D OPEN(.X1,.X2)
"RTN","RGUTOS",23,0)
 Q X1
"RTN","RGUTOS",24,0)
 ; Open a file
"RTN","RGUTOS",25,0)
OPEN(X1,X2) ;
"RTN","RGUTOS",26,0)
 N IO,POP,X3
"RTN","RGUTOS",27,0)
 D PARSE(.X1,.X3),OPEN^%ZISH(X3_X1,X3,X1,$G(X2,"R"),32767)
"RTN","RGUTOS",28,0)
 I POP ZT "OPEN"
"RTN","RGUTOS",29,0)
 S ^XTMP("RGHFS",$J,IO)=X3_X1,X1=IO
"RTN","RGUTOS",30,0)
 Q
"RTN","RGUTOS",31,0)
 ; Close a file
"RTN","RGUTOS",32,0)
CLOSE(X) N IO
"RTN","RGUTOS",33,0)
 S IO=X,X=$G(^XTMP("RGHFS",$J,IO))
"RTN","RGUTOS",34,0)
 K ^(IO)
"RTN","RGUTOS",35,0)
 D CLOSE^%ZISH(X)
"RTN","RGUTOS",36,0)
 Q
"RTN","RGUTOS",37,0)
 ; Close all open HFS
"RTN","RGUTOS",38,0)
CLOSEALL N Z
"RTN","RGUTOS",39,0)
 S Z=""
"RTN","RGUTOS",40,0)
 F  S Z=$O(^XTMP("RGHFS",$J,Z)) Q:Z=""  D CLOSE(Z)
"RTN","RGUTOS",41,0)
 Q
"RTN","RGUTOS",42,0)
 ; Parse out directory from filename
"RTN","RGUTOS",43,0)
PARSE(X,Y) ;
"RTN","RGUTOS",44,0)
 N D,Z
"RTN","RGUTOS",45,0)
 S D=$E($$DIRDLM,3),Z=$L(X,D),Y=$P(X,D,1,Z-1)_$S(Z>1:D,1:""),X=$P(X,D,Z)
"RTN","RGUTOS",46,0)
 Q
"RTN","RGUTOS",47,0)
 ; Read a line
"RTN","RGUTOS",48,0)
READ(X,Y) ;
"RTN","RGUTOS",49,0)
 N IO,%ZA,%ZB,%ZC,%ZL
"RTN","RGUTOS",50,0)
 S IO=$G(Y,$I)
"RTN","RGUTOS",51,0)
 D READNXT^%ZISH(.X)
"RTN","RGUTOS",52,0)
 U IO
"RTN","RGUTOS",53,0)
 Q $$STATUS^%ZISH&'$L(X)
"RTN","RGUTOS",54,0)
 ; Delete a file
"RTN","RGUTOS",55,0)
DELETE(X) ;
"RTN","RGUTOS",56,0)
 N Z
"RTN","RGUTOS",57,0)
 D PARSE(.X,.Z)
"RTN","RGUTOS",58,0)
 S Z(X)="",Z=$$DEL^%ZISH(Z,"Z")
"RTN","RGUTOS",59,0)
 Q
"RTN","RGUTOS",60,0)
 ; Rename a file
"RTN","RGUTOS",61,0)
RENAME(X1,X2) ;
"RTN","RGUTOS",62,0)
 N X3,X4
"RTN","RGUTOS",63,0)
 D PARSE(.X1,.X3),PARSE(.X2,.X4)
"RTN","RGUTOS",64,0)
 I $$MV^%ZISH(X3,X1,X4,X2)
"RTN","RGUTOS",65,0)
 Q
"RTN","RGUTOS",66,0)
 ; List files
"RTN","RGUTOS",67,0)
DIR(X1,X2,X3) ;
"RTN","RGUTOS",68,0)
 N Z
"RTN","RGUTOS",69,0)
 D PARSE(.X1,.Z)
"RTN","RGUTOS",70,0)
 S Z(X1)="",X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTOS",71,0)
 K @X3
"RTN","RGUTOS",72,0)
 I $$LIST^%ZISH(Z,"Z",X3)
"RTN","RGUTOS",73,0)
 Q
"RTN","RGUTOS",74,0)
 ; Force error if at EOF
"RTN","RGUTOS",75,0)
EOF I $$STATUS^%ZISH ZT "EOF"
"RTN","RGUTOS",76,0)
 Q
"RTN","RGUTOS",77,0)
 ; Returns true if current error is EOF
"RTN","RGUTOS",78,0)
EOFERR() Q $$EC^%ZOSV["EOF"
"RTN","RGUTOS",79,0)
 ; URL format filename-->HFS format
"RTN","RGUTOS",80,0)
CVTFN(RGFIL,RGROOT) ;
"RTN","RGUTOS",81,0)
 N RGZ,RGZ1,RGD
"RTN","RGUTOS",82,0)
 S RGD=$$DIRDLM,RGROOT=$G(RGROOT)
"RTN","RGUTOS",83,0)
 S:$E(RGROOT,$L(RGROOT))=$E(RGD,3) RGROOT=$E(RGROOT,1,$L(RGROOT)-1)
"RTN","RGUTOS",84,0)
 S RGZ=$L(RGFIL,"/"),RGZ1=$P(RGFIL,"/",1,RGZ-1),RGFIL=$P(RGFIL,"/",RGZ)
"RTN","RGUTOS",85,0)
 S:$L(RGZ1) RGROOT=RGROOT_$E(RGD,$S($L(RGROOT):2,1:1))_$TR(RGZ1,"/.-",$E(RGD,2))
"RTN","RGUTOS",86,0)
 Q RGROOT_$S($L(RGROOT):$E(RGD,3),1:"")_RGFIL
"RTN","RGUTOS",87,0)
 ; Return directory delimiters
"RTN","RGUTOS",88,0)
DIRDLM() N X
"RTN","RGUTOS",89,0)
 S X=$$PWD^%ZISH
"RTN","RGUTOS",90,0)
 Q $S(X["[":"[.]",X["\":"\\\",1:"///")
"RTN","RGUTOS",91,0)
 ; FTP file transfer
"RTN","RGUTOS",92,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGUTOS",93,0)
 D:$$VERSION^%ZOSV(1)["DSM" VMS^RGUTFTP(.X1,.X2,.X3,.X4,.X5,.X6,.X7)
"RTN","RGUTOS",94,0)
 Q
"RTN","RGUTOS",95,0)
 ; Parse error data
"RTN","RGUTOS",96,0)
ERR(X1,X2,X3) ;
"RTN","RGUTOS",97,0)
 N X
"RTN","RGUTOS",98,0)
 S X=$$EC^%ZOSV,X1=$$VERSION^%ZOSV(1)
"RTN","RGUTOS",99,0)
 G ERRMSM:X1["MSM",ERRDSM:X1["DSM"
"RTN","RGUTOS",100,0)
 S (X1,X2,X3)=""
"RTN","RGUTOS",101,0)
 Q
"RTN","RGUTOS",102,0)
ERRMSM S X1=$E($P(X,">"),2,99),X2=$P($P(X,">",2),":"),X3=X1
"RTN","RGUTOS",103,0)
 S:X2["*" X2=""
"RTN","RGUTOS",104,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTOS",105,0)
 Q
"RTN","RGUTOS",106,0)
ERRDSM S X1=$P($P(X,", ",2),"-",3),X2=$P($P(X,", "),":"),X3=$$TRIM^RGUT($P(X,", ",$S(X1="ZTRAP":4,1:3)))
"RTN","RGUTOS",107,0)
 Q
"RTN","RGUTOS1")
0^54^B9592360
"RTN","RGUTOS1",1,0)
RGUTOS ;CAIRO/DKM - Platform-dependent operations;12-Oct-1998 16:40;DKM
"RTN","RGUTOS1",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTOS1",3,0)
 ;=================================================================
"RTN","RGUTOS1",4,0)
 ; Return version # of RTL
"RTN","RGUTOS1",5,0)
VER() Q +$P($T(RGUTOS+1),";",3)
"RTN","RGUTOS1",6,0)
 ; Set right margin
"RTN","RGUTOS1",7,0)
RM(X) X ^%ZOSF("RM")
"RTN","RGUTOS1",8,0)
 Q
"RTN","RGUTOS1",9,0)
 ; Test for routine/tag
"RTN","RGUTOS1",10,0)
TEST(X) N Z
"RTN","RGUTOS1",11,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTOS1",12,0)
 X ^%ZOSF("TEST")
"RTN","RGUTOS1",13,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTOS1",14,0)
 ; Raise an exception
"RTN","RGUTOS1",15,0)
RAISE(X) ZT $G(X)
"RTN","RGUTOS1",16,0)
 ; Return code to set error trap
"RTN","RGUTOS1",17,0)
TRAP(X) Q $$SUBST^RGUT(^%ZOSF("TRAP"),"X",""""_X_"""")
"RTN","RGUTOS1",18,0)
 ; Check for $ET capability
"RTN","RGUTOS1",19,0)
ETRAP() Q $$NEWERR^%ZTER
"RTN","RGUTOS1",20,0)
 ; Open a file (extrinsic)
"RTN","RGUTOS1",21,0)
OPENX(X1,X2) ;
"RTN","RGUTOS1",22,0)
 D OPEN(.X1,.X2)
"RTN","RGUTOS1",23,0)
 Q X1
"RTN","RGUTOS1",24,0)
 ; Open a file
"RTN","RGUTOS1",25,0)
OPEN(X1,X2) ;
"RTN","RGUTOS1",26,0)
 N IO,POP,X3
"RTN","RGUTOS1",27,0)
 D PARSE(.X1,.X3),OPEN^%ZISH(X3_X1,X3,X1,$G(X2,"R"),32767)
"RTN","RGUTOS1",28,0)
 I POP ZT "OPEN"
"RTN","RGUTOS1",29,0)
 S ^XTMP("RGHFS",$J,IO)=X3_X1,X1=IO
"RTN","RGUTOS1",30,0)
 Q
"RTN","RGUTOS1",31,0)
 ; Close a file
"RTN","RGUTOS1",32,0)
CLOSE(X) N Y
"RTN","RGUTOS1",33,0)
 S Y=$G(^XTMP("RGHFS",$J,X)),IO=X
"RTN","RGUTOS1",34,0)
 K ^(X)
"RTN","RGUTOS1",35,0)
 D CLOSE^%ZISH(Y)
"RTN","RGUTOS1",36,0)
 Q
"RTN","RGUTOS1",37,0)
 ; Close all open HFS
"RTN","RGUTOS1",38,0)
CLOSEALL N Z
"RTN","RGUTOS1",39,0)
 S Z=""
"RTN","RGUTOS1",40,0)
 F  S Z=$O(^XTMP("RGHFS",$J,Z)) Q:Z=""  D CLOSE(Z)
"RTN","RGUTOS1",41,0)
 Q
"RTN","RGUTOS1",42,0)
 ; Parse out directory from filename
"RTN","RGUTOS1",43,0)
PARSE(X,Y) ;
"RTN","RGUTOS1",44,0)
 N D,Z
"RTN","RGUTOS1",45,0)
 S D=$E($$DIRDLM,3),Z=$L(X,D),Y=$P(X,D,1,Z-1)_$S(Z>1:D,1:""),X=$P(X,D,Z)
"RTN","RGUTOS1",46,0)
 Q
"RTN","RGUTOS1",47,0)
 ; Read a line
"RTN","RGUTOS1",48,0)
READ(X,Y) ;
"RTN","RGUTOS1",49,0)
 N IO,%ZA,%ZB,%ZC,%ZL
"RTN","RGUTOS1",50,0)
 S IO=$G(Y,$I)
"RTN","RGUTOS1",51,0)
 D READNXT^%ZISH(.X)
"RTN","RGUTOS1",52,0)
 U IO
"RTN","RGUTOS1",53,0)
 Q $$STATUS^%ZISH&'$L(X)
"RTN","RGUTOS1",54,0)
 ; Delete a file
"RTN","RGUTOS1",55,0)
DELETE(X) ;
"RTN","RGUTOS1",56,0)
 N Z
"RTN","RGUTOS1",57,0)
 D PARSE(.X,.Z)
"RTN","RGUTOS1",58,0)
 S Z(X)="",Z=$$DEL^%ZISH(Z,"Z")
"RTN","RGUTOS1",59,0)
 Q
"RTN","RGUTOS1",60,0)
 ; Rename a file
"RTN","RGUTOS1",61,0)
RENAME(X1,X2) ;
"RTN","RGUTOS1",62,0)
 N X3,X4
"RTN","RGUTOS1",63,0)
 D PARSE(.X1,.X3),PARSE(.X2,.X4)
"RTN","RGUTOS1",64,0)
 I $$MV^%ZISH(X3,X1,X4,X2)
"RTN","RGUTOS1",65,0)
 Q
"RTN","RGUTOS1",66,0)
 ; List files
"RTN","RGUTOS1",67,0)
DIR(X1,X2,X3) ;
"RTN","RGUTOS1",68,0)
 N Z
"RTN","RGUTOS1",69,0)
 D PARSE(.X1,.Z)
"RTN","RGUTOS1",70,0)
 S Z(X1)="",X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTOS1",71,0)
 K @X3
"RTN","RGUTOS1",72,0)
 I $$LIST^%ZISH(Z,"Z",X3)
"RTN","RGUTOS1",73,0)
 Q
"RTN","RGUTOS1",74,0)
 ; Force error if at EOF
"RTN","RGUTOS1",75,0)
EOF I $$STATUS^%ZISH ZT "EOF"
"RTN","RGUTOS1",76,0)
 Q
"RTN","RGUTOS1",77,0)
 ; Returns true if current error is EOF
"RTN","RGUTOS1",78,0)
EOFERR() Q $$EC^%ZOSV["EOF"
"RTN","RGUTOS1",79,0)
 ; URL format filename-->HFS format
"RTN","RGUTOS1",80,0)
CVTFN(RGFIL,RGROOT) ;
"RTN","RGUTOS1",81,0)
 N RGZ,RGZ1,RGD
"RTN","RGUTOS1",82,0)
 S RGD=$$DIRDLM,RGROOT=$G(RGROOT)
"RTN","RGUTOS1",83,0)
 S:$E(RGROOT,$L(RGROOT))=$E(RGD,3) RGROOT=$E(RGROOT,1,$L(RGROOT)-1)
"RTN","RGUTOS1",84,0)
 S RGZ=$L(RGFIL,"/"),RGZ1=$P(RGFIL,"/",1,RGZ-1),RGFIL=$P(RGFIL,"/",RGZ)
"RTN","RGUTOS1",85,0)
 S:$L(RGZ1) RGROOT=RGROOT_$E(RGD,$S($L(RGROOT):2,1:1))_$TR(RGZ1,"/.-",$E(RGD,2))
"RTN","RGUTOS1",86,0)
 Q RGROOT_$S($L(RGROOT):$E(RGD,3),1:"")_RGFIL
"RTN","RGUTOS1",87,0)
 ; Return directory delimiters
"RTN","RGUTOS1",88,0)
DIRDLM() N X
"RTN","RGUTOS1",89,0)
 S X=$$PWD^%ZISH
"RTN","RGUTOS1",90,0)
 Q $S(X["[":"[.]",X["\":"\\\",1:"///")
"RTN","RGUTOS1",91,0)
 ; FTP file transfer
"RTN","RGUTOS1",92,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGUTOS1",93,0)
 D:$$VERSION^%ZOSV(1)["DSM" VMS^RGUTFTP(.X1,.X2,.X3,.X4,.X5,.X6,.X7)
"RTN","RGUTOS1",94,0)
 Q
"RTN","RGUTOS1",95,0)
 ; Parse error data
"RTN","RGUTOS1",96,0)
ERR(X1,X2,X3) ;
"RTN","RGUTOS1",97,0)
 N X
"RTN","RGUTOS1",98,0)
 S X=$$EC^%ZOSV,X1=$$VERSION^%ZOSV(1)
"RTN","RGUTOS1",99,0)
 G ERRMSM:X1["MSM",ERRDSM:X1["DSM"
"RTN","RGUTOS1",100,0)
 S (X1,X2,X3)=""
"RTN","RGUTOS1",101,0)
 Q
"RTN","RGUTOS1",102,0)
ERRMSM S X1=$E($P(X,">"),2,99),X2=$P($P(X,">",2),":"),X3=X1
"RTN","RGUTOS1",103,0)
 S:X2["*" X2=""
"RTN","RGUTOS1",104,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTOS1",105,0)
 Q
"RTN","RGUTOS1",106,0)
ERRDSM S X1=$P($P(X,", ",2),"-",3),X2=$P($P(X,", "),":"),X3=$$TRIM^RGUT($P(X,", ",$S(X1="ZTRAP":4,1:3)))
"RTN","RGUTOS1",107,0)
 Q
"RTN","RGUTPRE")
0^62^B261071
"RTN","RGUTPRE",1,0)
RGUTPRE ;CAIRO/RJS - PRE-INIT TO RENAME RUN TIME LIBRARY;22-Mar-1999 08:53;RJS
"RTN","RGUTPRE",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTPRE",3,0)
 ;;
"RTN","RGUTPRE",4,0)
EN ;
"RTN","RGUTPRE",5,0)
 N IEN,DATA
"RTN","RGUTPRE",6,0)
 S IEN=$O(^DIC(9.4,"C","RGUT",0))
"RTN","RGUTPRE",7,0)
 Q:'IEN
"RTN","RGUTPRE",8,0)
 S DATA="RUN TIME LIBRARY"
"RTN","RGUTPRE",9,0)
 S DA=IEN,DIE="^DIC(9.4,",DR=".01///^S X=DATA;2///^S X=DATA"
"RTN","RGUTPRE",10,0)
 D ^DIE
"RTN","RGUTPRE",11,0)
 K DIE,DA,DR
"RTN","RGUTPRE",12,0)
 Q
"RTN","RGUTRPC")
0^56^B1136513
"RTN","RGUTRPC",1,0)
RGUTRPC ;CAIRO/DKM - RPC Encapsulations for RGUT routines ;04-Sep-1998 11:26;DKM
"RTN","RGUTRPC",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTRPC",3,0)
 ;=================================================================
"RTN","RGUTRPC",4,0)
 ; RGUTDIC
"RTN","RGUTRPC",5,0)
DIC(RGDATA,RGBM,RGCMD,RGARG) ;
"RTN","RGUTRPC",6,0)
 S RGDATA(0)=$$ENTRY^RGUTDIC(RGBM,RGCMD)
"RTN","RGUTRPC",7,0)
 Q
"RTN","RGUTRPC",8,0)
 ; RGUTSTX
"RTN","RGUTRPC",9,0)
MSYNTAX(RGDATA,RGCODE,RGOPT) ;
"RTN","RGUTRPC",10,0)
 S RGDATA=$$ENTRY^RGUTSTX(RGCODE,.RGOPT)
"RTN","RGUTRPC",11,0)
 Q
"RTN","RGUTRPC",12,0)
 ; Show all entries for a file
"RTN","RGUTRPC",13,0)
FILENT(RGDATA,RGGBL) ;
"RTN","RGUTRPC",14,0)
 N RGZ,RGC
"RTN","RGUTRPC",15,0)
 S:RGGBL=+RGGBL RGGBL=$$ROOT^DILFD(RGGBL,,1)
"RTN","RGUTRPC",16,0)
 S RGC=0,RGDATA=$$TMPGBL^RGCODRPC
"RTN","RGUTRPC",17,0)
 F RGZ=0:0 S RGZ=$O(@RGGBL@(RGZ)) Q:'RGZ  D
"RTN","RGUTRPC",18,0)
 .S @RGDATA@(RGC)=RGZ_U_$P(@RGGBL@(RGZ,0),U),RGC=RGC+1
"RTN","RGUTRPC",19,0)
 Q
"RTN","RGUTRPC",20,0)
 ; Show IEN of next/previous entry in a file
"RTN","RGUTRPC",21,0)
FILNXT(RGDATA,RGGBL,RGIEN) ;
"RTN","RGUTRPC",22,0)
 N RGD
"RTN","RGUTRPC",23,0)
 S:RGGBL=+RGGBL RGGBL=$$ROOT^DILFD(RGGBL,,1)
"RTN","RGUTRPC",24,0)
 I RGIEN<0 S RGIEN=-RGIEN,RGD=-1
"RTN","RGUTRPC",25,0)
 E  S RGD=1
"RTN","RGUTRPC",26,0)
 S RGDATA=+$O(@RGGBL@(RGIEN),RGD)
"RTN","RGUTRPC",27,0)
 Q
"RTN","RGUTRRC")
0^23^B4048599
"RTN","RGUTRRC",1,0)
RGUTRRC ;CAIRO/DKM - Remote routine checksum utility;04-Sep-1998 11:26;DKM
"RTN","RGUTRRC",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTRRC",3,0)
 ;=================================================================
"RTN","RGUTRRC",4,0)
 ; Performs a routine checksum on selected routines across all CPUs.
"RTN","RGUTRRC",5,0)
 ;=================================================================
"RTN","RGUTRRC",6,0)
 N RGX,RGY,RGRTN,RGCPU,RGUCI,RGCS,RGPID,RGZ,RGZ1,X
"RTN","RGUTRRC",7,0)
 S RGPID=$J
"RTN","RGUTRRC",8,0)
 D HOME^%ZIS
"RTN","RGUTRRC",9,0)
 D TITLE^RGUT("Remote Routine Checksum","1.0")
"RTN","RGUTRRC",10,0)
RSEL X ^%ZOSF("RSEL")
"RTN","RGUTRRC",11,0)
 W !!
"RTN","RGUTRRC",12,0)
 Q:'$D(^UTILITY(RGPID))
"RTN","RGUTRRC",13,0)
 K %IS,%ZIS
"RTN","RGUTRRC",14,0)
 D ^%ZIS
"RTN","RGUTRRC",15,0)
 G:POP RSEL
"RTN","RGUTRRC",16,0)
 U IO
"RTN","RGUTRRC",17,0)
 S RGUCI=$P($ZU(0),","),RGCPU=$P($ZU(0),",",2),RGRTN=$C(1)
"RTN","RGUTRRC",18,0)
NXT S RGRTN=$O(^UTILITY(RGPID,RGRTN))
"RTN","RGUTRRC",19,0)
 I RGRTN="" W !! Q
"RTN","RGUTRRC",20,0)
 W RGRTN,"..."
"RTN","RGUTRRC",21,0)
 K RGX,^RGUTL("RRC",RGPID)
"RTN","RGUTRRC",22,0)
 F RGY="CSA","CSB","CSC","PSA","PSB" D:RGY'=RGCPU JOBIT
"RTN","RGUTRRC",23,0)
 S RGCS=$$CHKSUM(RGRTN),RGCNT=0
"RTN","RGUTRRC",24,0)
 W ?15,RGCPU," ",RGCS,!
"RTN","RGUTRRC",25,0)
AGAIN I '$D(RGX) W ! G NXT
"RTN","RGUTRRC",26,0)
 S RGZ="",RGCNT=RGCNT+1
"RTN","RGUTRRC",27,0)
 I RGCNT>20 D FAIL G NXT
"RTN","RGUTRRC",28,0)
 H:RGCNT>1 1
"RTN","RGUTRRC",29,0)
NXT2 S RGZ=$O(RGX(RGZ))
"RTN","RGUTRRC",30,0)
 G:RGZ="" AGAIN
"RTN","RGUTRRC",31,0)
 G:'$D(^RGUTL("RRC",RGPID,RGZ)) NXT2
"RTN","RGUTRRC",32,0)
 S RGZ1=^(RGZ)
"RTN","RGUTRRC",33,0)
 K ^(RGZ),RGX(RGZ)
"RTN","RGUTRRC",34,0)
 I RGCS=RGZ1 W ?15,RGZ," same",!
"RTN","RGUTRRC",35,0)
 E  W ?15,RGZ," different: ",RGZ1,"  ************",!
"RTN","RGUTRRC",36,0)
 G NXT2
"RTN","RGUTRRC",37,0)
FAIL S RGZ=$O(RGX(RGZ))
"RTN","RGUTRRC",38,0)
 Q:RGZ=""
"RTN","RGUTRRC",39,0)
 W ?15,RGZ," failed to report",!
"RTN","RGUTRRC",40,0)
 G FAIL
"RTN","RGUTRRC",41,0)
JOBIT Q:RGY=RGCPU
"RTN","RGUTRRC",42,0)
 S @$$TRAP^RGZOSF("NOCPU^RGUTRRC")
"RTN","RGUTRRC",43,0)
 J JOB^RGUTRRC(RGPID,RGRTN)[RGUCI,RGY]::1
"RTN","RGUTRRC",44,0)
 I '$ZB W "Failed to start remote job on "_RGUCI_","_RGY,!
"RTN","RGUTRRC",45,0)
 E  S RGX(RGY)=""
"RTN","RGUTRRC",46,0)
NOCPU Q
"RTN","RGUTRRC",47,0)
JOB(RGJ,RGRTN) ;
"RTN","RGUTRRC",48,0)
 H 1
"RTN","RGUTRRC",49,0)
 S RGCPU=$P($ZU(0),",",2),@$$TRAP^RGZOSF("JERR^RGUTRRC")
"RTN","RGUTRRC",50,0)
 I $$TEST^RGZOSF(RGRTN) S ^RGUTL("RRC",RGJ,RGCPU)=$$CHKSUM(RGRTN)
"RTN","RGUTRRC",51,0)
 E  S ^RGUTL("RRC",RGJ,RGCPU)=0
"RTN","RGUTRRC",52,0)
 Q
"RTN","RGUTRRC",53,0)
JERR S ^RGUTL("RRC",RGJ,RGCPU)=$$EC^%ZOSV
"RTN","RGUTRRC",54,0)
 Q
"RTN","RGUTRRC",55,0)
CHKSUM(X) ;
"RTN","RGUTRRC",56,0)
 N Y
"RTN","RGUTRRC",57,0)
 X ^%ZOSF("RSUM")
"RTN","RGUTRRC",58,0)
 Q Y
"RTN","RGUTRRT")
0^24^B6342466
"RTN","RGUTRRT",1,0)
RGUTRRT ;CAIRO/DKM - Remote routine transfer;04-Sep-1998 11:26;DKM
"RTN","RGUTRRT",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTRRT",3,0)
 ;=================================================================
"RTN","RGUTRRT",4,0)
 ; Utility to copy routines to all target machines.  A server
"RTN","RGUTRRT",5,0)
 ; runs in the background on all machines to receive new routines.
"RTN","RGUTRRT",6,0)
 ;=================================================================
"RTN","RGUTRRT",7,0)
 ; This is the entry point for interactive use
"RTN","RGUTRRT",8,0)
 D ENTRY(0)
"RTN","RGUTRRT",9,0)
 Q
"RTN","RGUTRRT",10,0)
DELETE D ENTRY(1)
"RTN","RGUTRRT",11,0)
 Q
"RTN","RGUTRRT",12,0)
ENTRY(RGDALL) ;
"RTN","RGUTRRT",13,0)
 D HOME^%ZIS
"RTN","RGUTRRT",14,0)
 D TITLE^RGUT("Remote Routine "_$S(RGDALL:"Delete",1:"Transfer"),"1.0")
"RTN","RGUTRRT",15,0)
 X ^%ZOSF("RSEL")
"RTN","RGUTRRT",16,0)
 I RGDALL D
"RTN","RGUTRRT",17,0)
 .N RGRTN
"RTN","RGUTRRT",18,0)
 .S RGRTN=$C(1)
"RTN","RGUTRRT",19,0)
 .F  S RGRTN=$O(^UTILITY($J,RGRTN)) Q:RGRTN=""  S ^(RGRTN)="DELETE"
"RTN","RGUTRRT",20,0)
 D SAVE
"RTN","RGUTRRT",21,0)
 Q
"RTN","RGUTRRT",22,0)
 ; This entry point allows passing routine names in ^UTILITY
"RTN","RGUTRRT",23,0)
 ; If the data of the ^UTILITY node is "DELETE", the routine is deleted!
"RTN","RGUTRRT",24,0)
SAVE Q:$D(^UTILITY($J))<10
"RTN","RGUTRRT",25,0)
 N RGRTN,RGDEL
"RTN","RGUTRRT",26,0)
 S RGRTN=$C(1),U="^"
"RTN","RGUTRRT",27,0)
 F  S RGRTN=$O(^UTILITY($J,RGRTN)) Q:RGRTN=""  D
"RTN","RGUTRRT",28,0)
 .S RGDEL=^(RGRTN)="DELETE"
"RTN","RGUTRRT",29,0)
 .K ^(RGRTN)
"RTN","RGUTRRT",30,0)
 .D RRT(RGRTN,RGDEL)
"RTN","RGUTRRT",31,0)
 D JOB
"RTN","RGUTRRT",32,0)
 Q
"RTN","RGUTRRT",33,0)
 ; This subroutine remote copies/deletes routine RGRTN
"RTN","RGUTRRT",34,0)
RRT(RGRTN,RGDEL) ;
"RTN","RGUTRRT",35,0)
 Q:RGRTN'?1.8AN!($G(^RGUTL("UCI"))="")
"RTN","RGUTRRT",36,0)
 N RGX,RGZ,RGZ1,RGZ2
"RTN","RGUTRRT",37,0)
 S RGDEL=+$G(RGDEL),U="^"
"RTN","RGUTRRT",38,0)
 L +^XTMP("RGUTSRV",0)
"RTN","RGUTRRT",39,0)
 S RGX=1+$O(^XTMP("RGUTSRV",$C(1)),-1)
"RTN","RGUTRRT",40,0)
 F RGZ=0:0 S RGZ=+$O(^XTMP("RGUTSRV","B",RGRTN,RGZ)) Q:'RGZ  K ^(RGZ),^XTMP("RGUTSRV",RGZ)
"RTN","RGUTRRT",41,0)
 S ^XTMP("RGUTSRV",RGX)=RGRTN,^XTMP("RGUTSRV","B",RGRTN,RGX)=""
"RTN","RGUTRRT",42,0)
 L -^XTMP("RGUTSRV",0)
"RTN","RGUTRRT",43,0)
 X:'RGDEL "ZL "_RGRTN_" F RGZ=1:1 S RGZ1=$T(+RGZ) Q:'$L(RGZ1)  S ^XTMP(""RGUTSRV"",RGX,RGZ)=RGZ1"
"RTN","RGUTRRT",44,0)
 S RGZ2=$$UCI
"RTN","RGUTRRT",45,0)
 F RGZ1=1:1 S RGZ=$$UCI(RGZ1) Q:'$L(RGZ)  S:RGZ'=RGZ2!RGDEL ^XTMP("RGUTSRV",RGX,0,RGZ)=""
"RTN","RGUTRRT",46,0)
 F RGZ1=1:1 S RGZ=$$UCI(RGZ1) Q:'$L(RGZ)  S:RGZ'=RGZ2!RGDEL ^XTMP("RGUTSRV",RGZ,RGX)=""
"RTN","RGUTRRT",47,0)
 Q
"RTN","RGUTRRT",48,0)
 ; Return indexed UCI
"RTN","RGUTRRT",49,0)
UCI(RGN) N RGZ,Y
"RTN","RGUTRRT",50,0)
 I '$G(RGN) X ^%ZOSF("UCI") Q Y
"RTN","RGUTRRT",51,0)
 S U="^",RGZ=$P($G(^RGUTL("UCI")),U,RGN)
"RTN","RGUTRRT",52,0)
 I $L(RGZ),RGZ'["," S RGZ=$P($$UCI,",")_","_RGZ
"RTN","RGUTRRT",53,0)
 Q RGZ
"RTN","RGUTRRT",54,0)
 ; Make sure all remote servers are running
"RTN","RGUTRRT",55,0)
JOB N RGZ,RGUCI
"RTN","RGUTRRT",56,0)
 F RGZ=1:1 S RGUCI=$$UCI(RGZ) Q:'$L(RGUCI)  D
"RTN","RGUTRRT",57,0)
 .L +^XTMP("RGUTSRV",RGUCI):0
"RTN","RGUTRRT",58,0)
 .E  Q
"RTN","RGUTRRT",59,0)
 .L -^XTMP("RGUTSRV",RGUCI)
"RTN","RGUTRRT",60,0)
 .I $$QUEUE^RGUTTSK("^RGUTSRV","Remote Routine Transfer",,,,RGUCI)
"RTN","RGUTRRT",61,0)
 Q
"RTN","RGUTRRT",62,0)
 ; Shutdown remote servers
"RTN","RGUTRRT",63,0)
SHUTDOWN N RGZ,RGUCI
"RTN","RGUTRRT",64,0)
 F RGZ=1:1 S RGUCI=$$UCI(RGZ) Q:'$L(RGUCI)  S ^XTMP("RGUTSRV",RGUCI,0)=1
"RTN","RGUTRRT",65,0)
 Q
"RTN","RGUTSCH")
1^25
"RTN","RGUTSRV")
0^26^B1691132
"RTN","RGUTSRV",1,0)
RGUTSRV ;CAIRO/DKM - Server for remote routine utilities;09-Sep-1998 08:31;DKM
"RTN","RGUTSRV",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTSRV",3,0)
 ;=================================================================
"RTN","RGUTSRV",4,0)
 N RGUCI,RGX,RGRTN,RGZ,X
"RTN","RGUTSRV",5,0)
 S RGUCI=$$UCI^RGUTRRT
"RTN","RGUTSRV",6,0)
 L +^XTMP("RGUTSRV",RGUCI):0
"RTN","RGUTSRV",7,0)
 E  Q
"RTN","RGUTSRV",8,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTSRV",9,0)
 S X=10
"RTN","RGUTSRV",10,0)
 X ^%ZOSF("MAXSIZ")
"RTN","RGUTSRV",11,0)
 F  D  I $G(^XTMP("RGUTSRV",RGUCI,0)) K ^(0) Q
"RTN","RGUTSRV",12,0)
 .F RGX=0:0 S RGX=+$O(^XTMP("RGUTSRV",RGUCI,RGX)) Q:'RGX  D
"RTN","RGUTSRV",13,0)
 ..S @$$TRAP^RGZOSF("ERR^RGUTSRV")
"RTN","RGUTSRV",14,0)
 ..S RGRTN=$G(^XTMP("RGUTSRV",RGX))
"RTN","RGUTSRV",15,0)
 ..I RGRTN'="" D
"RTN","RGUTSRV",16,0)
 ...X "ZR  F RGZ=0:0 S RGZ=$O(^XTMP(""RGUTSRV"",RGX,RGZ)) ZI:RGZ ^(RGZ) I 'RGZ ZS "_RGRTN_" Q"
"RTN","RGUTSRV",17,0)
 ...K ^XTMP("RGUTSRV",RGX,0,RGUCI)
"RTN","RGUTSRV",18,0)
 ...K:'$D(^XTMP("RGUTSRV",RGX,0)) ^XTMP("RGUTSRV",RGX),^XTMP("RGUTSRV","B",RGRTN,RGX)
"RTN","RGUTSRV",19,0)
 ..K ^XTMP("RGUTSRV",RGUCI,RGX)
"RTN","RGUTSRV",20,0)
 .H 5
"RTN","RGUTSRV",21,0)
 L -^XTMP("RGUTSRV",RGUCI)
"RTN","RGUTSRV",22,0)
 Q
"RTN","RGUTSRV",23,0)
ERR S ^XTMP("RGUTSRV",RGX,0,RGUCI)=$$EC^%ZOSV
"RTN","RGUTSRV",24,0)
 Q
"RTN","RGUTSTX")
0^27^B16763820
"RTN","RGUTSTX",1,0)
RGUTSTX ;CAIRO/DKM - M syntax analyzer;22-Oct-1998 10:39;DKM
"RTN","RGUTSTX",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTSTX",3,0)
 ;=================================================================
"RTN","RGUTSTX",4,0)
 ; Perform syntactic analysis of a line of M code.
"RTN","RGUTSTX",5,0)
 ; Inputs:
"RTN","RGUTSTX",6,0)
 ;   RGM = M statement(s)
"RTN","RGUTSTX",7,0)
 ;   RGO = Options:
"RTN","RGUTSTX",8,0)
 ;      L = Line label allowed
"RTN","RGUTSTX",9,0)
 ;      . = Dotted syntax allowed
"RTN","RGUTSTX",10,0)
 ;      N = Do not init parsing tables
"RTN","RGUTSTX",11,0)
 ;      D = Do not delete parsing tables
"RTN","RGUTSTX",12,0)
 ;      Z = Process all Z-extensions as valid
"RTN","RGUTSTX",13,0)
 ; Outputs:
"RTN","RGUTSTX",14,0)
 ;   Returns 0 if successfully parsed.  Otherwise returns E^P^M
"RTN","RGUTSTX",15,0)
 ;   where E is an error code (see ERRORS label), P is the
"RTN","RGUTSTX",16,0)
 ;   character position where the error occurred, and M is the
"RTN","RGUTSTX",17,0)
 ;   error message.
"RTN","RGUTSTX",18,0)
 ;=================================================================
"RTN","RGUTSTX",19,0)
ENTRY(RGM,RGO) ;
"RTN","RGUTSTX",20,0)
 N RGPSN,RGLEN,RGERR,RGRN,RGQT,RGF,RGPID,RGCMD
"RTN","RGUTSTX",21,0)
 S RGM=$$UP^XLFSTR(RGM),RGO=$$UP^XLFSTR($G(RGO)),RGPSN=1,RGLEN=$L(RGM),RGERR=0,RGQT="""",RGF=0,RGPID="RGUTSTX"_$J,U="^"
"RTN","RGUTSTX",22,0)
 D LOAD:RGO'["N",PARSE:RGLEN
"RTN","RGUTSTX",23,0)
 K:RGO'["D" ^TMP(RGPID)
"RTN","RGUTSTX",24,0)
 Q $S(RGERR:RGERR_U_$S(RGPSN>RGLEN:RGLEN,1:RGPSN)_U_$S(RGERR<0:$$EC^%ZOSV,1:$P($T(ERRORS+RGERR),";;",2)),1:0)
"RTN","RGUTSTX",25,0)
PARSE N RGZ,RGZ1
"RTN","RGUTSTX",26,0)
 S @$$TRAP^RGZOSF("ERROR^RGUTSTX")
"RTN","RGUTSTX",27,0)
 I RGO["L" D  Q:RGERR
"RTN","RGUTSTX",28,0)
 .S:$E(RGM)'=" " RGPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX",29,0)
 .I $$NEXT^RGUTSTX0("("),'$$NEXT^RGUTSTX0(")") D
"RTN","RGUTSTX",30,0)
 ..F RGPSN=RGPSN:1 D  Q:$E(RGM,RGPSN)'=","!RGERR
"RTN","RGUTSTX",31,0)
 ...S RGPSN=$$NAME^RGUTSTX0(RGPSN,"L%")
"RTN","RGUTSTX",32,0)
 ..Q:RGERR
"RTN","RGUTSTX",33,0)
 ..S:'$$NEXT^RGUTSTX0(")") RGERR=3
"RTN","RGUTSTX",34,0)
 .S:" "'[$E(RGM,RGPSN) RGERR=2
"RTN","RGUTSTX",35,0)
 I RGO["." F RGPSN=RGPSN:1:RGLEN+1 Q:". "'[$E(RGM,RGPSN)
"RTN","RGUTSTX",36,0)
 F  Q:RGERR  D SKPSPC Q:";"[$E(RGM,RGPSN)  D
"RTN","RGUTSTX",37,0)
 .S RGCMD=""
"RTN","RGUTSTX",38,0)
 .F RGPSN=RGPSN:1 S RGZ=$E(RGM,RGPSN) Q:RGZ'?1A  S RGCMD=RGCMD_RGZ
"RTN","RGUTSTX",39,0)
 .I RGCMD="" S RGERR=4 Q
"RTN","RGUTSTX",40,0)
 .I $D(^TMP(RGPID,"CMD",RGCMD)) S RGCMD=^(RGCMD)
"RTN","RGUTSTX",41,0)
 .E  I RGO["Z" S RGCMD="PC;OPT;ARGS("":M"")"
"RTN","RGUTSTX",42,0)
 .E  S RGERR=4 Q
"RTN","RGUTSTX",43,0)
 .F RGRN=1:1:$L(RGCMD,";") D CMD^RGUTSTX0($P(RGCMD,";",RGRN)) Q:RGERR!'RGRN
"RTN","RGUTSTX",44,0)
 .I 'RGERR," "'[$E(RGM,RGPSN) S RGERR=2
"RTN","RGUTSTX",45,0)
 .E  S RGPSN=RGPSN+1
"RTN","RGUTSTX",46,0)
 Q
"RTN","RGUTSTX",47,0)
 ; Skip over blanks
"RTN","RGUTSTX",48,0)
SKPSPC F  Q:'$$NEXT^RGUTSTX0(" ")
"RTN","RGUTSTX",49,0)
 Q
"RTN","RGUTSTX",50,0)
 ; Load tables
"RTN","RGUTSTX",51,0)
LOAD N RGZ,RGZ1,RGZ2,RGL
"RTN","RGUTSTX",52,0)
 K ^TMP(RGPID)
"RTN","RGUTSTX",53,0)
 F RGL="CMD","FCN","SYS" D
"RTN","RGUTSTX",54,0)
 .F RGZ=1:1 S RGZ1=$P($T(@RGL+RGZ),";;",2,999) Q:RGZ1=""  D
"RTN","RGUTSTX",55,0)
 ..S RGZ2=$P(RGZ1,";"),RGZ1=$P(RGZ1,";",2,999)
"RTN","RGUTSTX",56,0)
 ..F  Q:RGZ2=""  D
"RTN","RGUTSTX",57,0)
 ...S ^TMP(RGPID,RGL,$P(RGZ2,","))=RGZ1,RGZ2=$P(RGZ2,",",2,999)
"RTN","RGUTSTX",58,0)
 Q
"RTN","RGUTSTX",59,0)
ERROR S RGERR=-1
"RTN","RGUTSTX",60,0)
 Q
"RTN","RGUTSTX",61,0)
CMD ;;*Commands*
"RTN","RGUTSTX",62,0)
 ;;B,BREAK;PC;OPT;ARGS()
"RTN","RGUTSTX",63,0)
 ;;C,CLOSE;PC;ARGS(":M")
"RTN","RGUTSTX",64,0)
 ;;D,DO;PC;OPT;LBL(2)
"RTN","RGUTSTX",65,0)
 ;;E,ELSE;NPC;OPT;ARGS()
"RTN","RGUTSTX",66,0)
 ;;F,FOR;NPC;OPT;FOR
"RTN","RGUTSTX",67,0)
 ;;G,GOTO;PC;LBL(1)
"RTN","RGUTSTX",68,0)
 ;;H,HALT,HANG;PC;OPT;EXP()
"RTN","RGUTSTX",69,0)
 ;;I,IF;NPC;OPT;ARGS()
"RTN","RGUTSTX",70,0)
 ;;J,JOB;PC;LBL(2)
"RTN","RGUTSTX",71,0)
 ;;K,KILL;PC;OPT;KILL
"RTN","RGUTSTX",72,0)
 ;;L,LOCK;PC;OPT;LOCK
"RTN","RGUTSTX",73,0)
 ;;M,MERGE;PC;MERGE
"RTN","RGUTSTX",74,0)
 ;;N,NEW;PC;OPT;NEW
"RTN","RGUTSTX",75,0)
 ;;O,OPEN;PC;ARGS(":M")
"RTN","RGUTSTX",76,0)
 ;;Q,QUIT;PC;OPT;EXP()
"RTN","RGUTSTX",77,0)
 ;;R,READ;PC;READ
"RTN","RGUTSTX",78,0)
 ;;S,SET;PC;SET
"RTN","RGUTSTX",79,0)
 ;;U,USE;PC;ARGS(":M")
"RTN","RGUTSTX",80,0)
 ;;V,VIEW;PC;ARGS(":M")
"RTN","RGUTSTX",81,0)
 ;;W,WRITE;PC;WRITE
"RTN","RGUTSTX",82,0)
 ;;X,XECUTE;PC;ARGS(":")
"RTN","RGUTSTX",83,0)
 ;;ZT,ZTRAP;PC;OPT;EXP()
"RTN","RGUTSTX",84,0)
 ;;ZS,ZSAVE;PC;OPT;EXP()
"RTN","RGUTSTX",85,0)
 ;;ZR,ZREMOVE;PC;OPT;LBL(1)
"RTN","RGUTSTX",86,0)
 ;;ZP,ZPRINT
"RTN","RGUTSTX",87,0)
 ;;
"RTN","RGUTSTX",88,0)
FCN ;;*Intrinsic functions*
"RTN","RGUTSTX",89,0)
 ;;A,ASCII;;1-2
"RTN","RGUTSTX",90,0)
 ;;C,CHAR;;1-999
"RTN","RGUTSTX",91,0)
 ;;D,DATA;;1-1;V
"RTN","RGUTSTX",92,0)
 ;;E,EXTRACT;S;1-3
"RTN","RGUTSTX",93,0)
 ;;F,FIND;;2-3
"RTN","RGUTSTX",94,0)
 ;;FN,FNUMBER;;2-3
"RTN","RGUTSTX",95,0)
 ;;G,GET;;1-2;V
"RTN","RGUTSTX",96,0)
 ;;J,JUSTIFY;;1-3
"RTN","RGUTSTX",97,0)
 ;;L,LENGTH;;1-2
"RTN","RGUTSTX",98,0)
 ;;N,NEXT;;1-2
"RTN","RGUTSTX",99,0)
 ;;NA,NAME;;1-2;V
"RTN","RGUTSTX",100,0)
 ;;O,ORDER;;1-2;V
"RTN","RGUTSTX",101,0)
 ;;P,PIECE;S;2-4
"RTN","RGUTSTX",102,0)
 ;;Q,QUERY;;1-2;V
"RTN","RGUTSTX",103,0)
 ;;R,RANDOM;;1-1
"RTN","RGUTSTX",104,0)
 ;;S,SELECT;:;1-999
"RTN","RGUTSTX",105,0)
 ;;T,TEXT;;1-1;L
"RTN","RGUTSTX",106,0)
 ;;TR,TRANSLATE;;2-3
"RTN","RGUTSTX",107,0)
 ;;V,VIEW;;1-999
"RTN","RGUTSTX",108,0)
 ;;
"RTN","RGUTSTX",109,0)
SYS ;;*System variables*
"RTN","RGUTSTX",110,0)
 ;;D,DEVICE
"RTN","RGUTSTX",111,0)
 ;;ET,ETRAP;SN
"RTN","RGUTSTX",112,0)
 ;;H,HOROLOG
"RTN","RGUTSTX",113,0)
 ;;I,IO
"RTN","RGUTSTX",114,0)
 ;;J,JOB
"RTN","RGUTSTX",115,0)
 ;;K,KEY
"RTN","RGUTSTX",116,0)
 ;;P,PRINCIPAL
"RTN","RGUTSTX",117,0)
 ;;S,STORAGE
"RTN","RGUTSTX",118,0)
 ;;SY,SYSTEM
"RTN","RGUTSTX",119,0)
 ;;T,TEST
"RTN","RGUTSTX",120,0)
 ;;TL,TLEVEL
"RTN","RGUTSTX",121,0)
 ;;TR,TRESTART
"RTN","RGUTSTX",122,0)
 ;;X;S
"RTN","RGUTSTX",123,0)
 ;;Y;S
"RTN","RGUTSTX",124,0)
 ;;ZT,ZTRAP;S
"RTN","RGUTSTX",125,0)
 ;;ZE,ZERROR;S
"RTN","RGUTSTX",126,0)
 ;;
"RTN","RGUTSTX",127,0)
ERRORS ;;*Error messages*
"RTN","RGUTSTX",128,0)
 ;;Bad variable name
"RTN","RGUTSTX",129,0)
 ;;Syntax error
"RTN","RGUTSTX",130,0)
 ;;Unbalanced parentheses
"RTN","RGUTSTX",131,0)
 ;;Unrecognized command
"RTN","RGUTSTX",132,0)
 ;;Postconditional not allowed
"RTN","RGUTSTX",133,0)
 ;;Missing operand
"RTN","RGUTSTX",134,0)
 ;;Unrecognized intrinsic function/variable
"RTN","RGUTSTX",135,0)
 ;;Incorrect number of arguments
"RTN","RGUTSTX",136,0)
 ;;Missing closing quote
"RTN","RGUTSTX",137,0)
 ;;Illegal pattern
"RTN","RGUTSTX",138,0)
 ;;Bad label name
"RTN","RGUTSTX",139,0)
 ;;12
"RTN","RGUTSTX0")
0^28^B17598407
"RTN","RGUTSTX0",1,0)
RGUTSTX0 ;CAIRO/DKM - Continuation of RGUTSTX;04-Sep-1998 11:26;DKM
"RTN","RGUTSTX0",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTSTX0",3,0)
 ;=================================================================
"RTN","RGUTSTX0",4,0)
CMD(RGLBL) ;
"RTN","RGUTSTX0",5,0)
 D:RGLBL'="" @RGLBL
"RTN","RGUTSTX0",6,0)
 Q
"RTN","RGUTSTX0",7,0)
 ; Postconditional
"RTN","RGUTSTX0",8,0)
PC D:$$NEXT(":") EXP()
"RTN","RGUTSTX0",9,0)
 Q:RGERR
"RTN","RGUTSTX0",10,0)
 I " "'[$E(RGM,RGPSN) S RGERR=2
"RTN","RGUTSTX0",11,0)
 E  S RGPSN=RGPSN+1
"RTN","RGUTSTX0",12,0)
 Q
"RTN","RGUTSTX0",13,0)
 ; No postconditional
"RTN","RGUTSTX0",14,0)
NPC I $$NEXT(":") S RGERR=5
"RTN","RGUTSTX0",15,0)
 E  I " "'[$E(RGM,RGPSN) S RGERR=2
"RTN","RGUTSTX0",16,0)
 E  S RGPSN=RGPSN+1
"RTN","RGUTSTX0",17,0)
 Q
"RTN","RGUTSTX0",18,0)
 ; Arguments optional
"RTN","RGUTSTX0",19,0)
OPT S:" "[$E(RGM,RGPSN) RGRN=0
"RTN","RGUTSTX0",20,0)
 Q
"RTN","RGUTSTX0",21,0)
 ; Multiple arguments
"RTN","RGUTSTX0",22,0)
ARGS(RGEX) ;
"RTN","RGUTSTX0",23,0)
 S RGEX=$G(RGEX)
"RTN","RGUTSTX0",24,0)
 F  D EXP(RGEX) Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX0",25,0)
 Q
"RTN","RGUTSTX0",26,0)
 ; Expression
"RTN","RGUTSTX0",27,0)
EXP(RGEX) ;
"RTN","RGUTSTX0",28,0)
 D EXP^RGUTSTX1(.RGEX)
"RTN","RGUTSTX0",29,0)
 Q
"RTN","RGUTSTX0",30,0)
 ; Label reference
"RTN","RGUTSTX0",31,0)
LBL(RGA) F  D LBL1(.RGA) Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX0",32,0)
 Q
"RTN","RGUTSTX0",33,0)
LBL1(RGA) ;
"RTN","RGUTSTX0",34,0)
 S RGA=+$G(RGA)
"RTN","RGUTSTX0",35,0)
 D LBL2
"RTN","RGUTSTX0",36,0)
 Q:RGERR
"RTN","RGUTSTX0",37,0)
 D:$$NEXT("+") EXP(")")
"RTN","RGUTSTX0",38,0)
 Q:RGERR
"RTN","RGUTSTX0",39,0)
 D:$$NEXT(U) LBL2
"RTN","RGUTSTX0",40,0)
 I 'RGERR,RGA=2 D PARAMS(".;0-999")
"RTN","RGUTSTX0",41,0)
 I 'RGERR,RGA D EXP(")"):$$NEXT(":")
"RTN","RGUTSTX0",42,0)
 Q
"RTN","RGUTSTX0",43,0)
LBL2 I $$NEXT("@") D
"RTN","RGUTSTX0",44,0)
 .D EXP("=")
"RTN","RGUTSTX0",45,0)
 E  S:$E(RGM,RGPSN)?.1AN.1"%" RGPSN=$$LABEL
"RTN","RGUTSTX0",46,0)
 Q
"RTN","RGUTSTX0",47,0)
 ; Write command
"RTN","RGUTSTX0",48,0)
WRITE F  D  Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX0",49,0)
 .I $$NEXT("!#") D  Q:'$$NEXT("?",0)
"RTN","RGUTSTX0",50,0)
 ..F  Q:'$$NEXT("!#")
"RTN","RGUTSTX0",51,0)
 .I $$NEXT("?*")
"RTN","RGUTSTX0",52,0)
 .D EXP()
"RTN","RGUTSTX0",53,0)
 Q
"RTN","RGUTSTX0",54,0)
 ; Read command
"RTN","RGUTSTX0",55,0)
READ N RGZ
"RTN","RGUTSTX0",56,0)
 F  D  Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX0",57,0)
 .I $$NEXT("!#") D  Q:'$$NEXT("?",0)
"RTN","RGUTSTX0",58,0)
 ..F  Q:'$$NEXT("!#")
"RTN","RGUTSTX0",59,0)
 .I $$NEXT("?") D EXP() Q
"RTN","RGUTSTX0",60,0)
 .I $$NEXT(RGQT) D QT2^RGUTSTX1 Q
"RTN","RGUTSTX0",61,0)
 .S RGZ=$$NEXT("*")
"RTN","RGUTSTX0",62,0)
 .D LVAL("LGS")
"RTN","RGUTSTX0",63,0)
 .I 'RGERR,'RGZ,$$NEXT("#") D EXP()
"RTN","RGUTSTX0",64,0)
 .I 'RGERR,$$NEXT(":") D EXP()
"RTN","RGUTSTX0",65,0)
 Q
"RTN","RGUTSTX0",66,0)
 ; Lock command
"RTN","RGUTSTX0",67,0)
LOCK D LIST("LG+:","LG")
"RTN","RGUTSTX0",68,0)
 Q
"RTN","RGUTSTX0",69,0)
 ; Set command
"RTN","RGUTSTX0",70,0)
SET D LIST("LGS=","LGS")
"RTN","RGUTSTX0",71,0)
 Q
"RTN","RGUTSTX0",72,0)
 ; New command
"RTN","RGUTSTX0",73,0)
NEW D LIST("N","")
"RTN","RGUTSTX0",74,0)
 Q
"RTN","RGUTSTX0",75,0)
 ; Kill command
"RTN","RGUTSTX0",76,0)
KILL D LIST("KGL","")
"RTN","RGUTSTX0",77,0)
 Q
"RTN","RGUTSTX0",78,0)
 ; Merge command
"RTN","RGUTSTX0",79,0)
MERGE D LIST("LG=")
"RTN","RGUTSTX0",80,0)
 Q
"RTN","RGUTSTX0",81,0)
 ; For command
"RTN","RGUTSTX0",82,0)
FOR D LVAL("LGS")
"RTN","RGUTSTX0",83,0)
 I '$$NEXT("=") S RGERR=2 Q
"RTN","RGUTSTX0",84,0)
 F  D  Q:" "[$E(RGM,RGPSN)  I '$$NEXT(",") S RGERR=2 Q
"RTN","RGUTSTX0",85,0)
 .D EXP(),EXP():$$NEXT(":"),EXP():$$NEXT(":")
"RTN","RGUTSTX0",86,0)
 Q
"RTN","RGUTSTX0",87,0)
 ; Evaluate L-value
"RTN","RGUTSTX0",88,0)
 ; RGL: Allowed types:
"RTN","RGUTSTX0",89,0)
 ;     L=Local array
"RTN","RGUTSTX0",90,0)
 ;     G=Global arrays
"RTN","RGUTSTX0",91,0)
 ;     S=Settable intrinsics/system variables
"RTN","RGUTSTX0",92,0)
 ;     N=Newable system variables
"RTN","RGUTSTX0",93,0)
 ;     K=Killable system variables
"RTN","RGUTSTX0",94,0)
LVAL(RGL) ;
"RTN","RGUTSTX0",95,0)
 I $$NEXT("@",0) D  Q
"RTN","RGUTSTX0",96,0)
 .S RGL="="
"RTN","RGUTSTX0",97,0)
 .D EXP(.RGL)
"RTN","RGUTSTX0",98,0)
 S RGL=$G(RGL)
"RTN","RGUTSTX0",99,0)
 I RGL["G",$$NEXT(U) D  Q
"RTN","RGUTSTX0",100,0)
 .N RGF
"RTN","RGUTSTX0",101,0)
 .D GLBL^RGUTSTX1
"RTN","RGUTSTX0",102,0)
 I $TR(RGL,"SNK")'=RGL,$$NEXT("$") D  Q
"RTN","RGUTSTX0",103,0)
 .N RGZ
"RTN","RGUTSTX0",104,0)
 .S RGZ=$$INT(.RGPSN,RGL)
"RTN","RGUTSTX0",105,0)
 .D:'RGERR PARAMS(RGZ)
"RTN","RGUTSTX0",106,0)
 S RGPSN=$$NAME(RGPSN,"%")
"RTN","RGUTSTX0",107,0)
 I 'RGERR,RGL["L" D PARAMS()
"RTN","RGUTSTX0",108,0)
 Q
"RTN","RGUTSTX0",109,0)
 ; Evaluate parameters/subscripts
"RTN","RGUTSTX0",110,0)
PARAMS(RGX) ;
"RTN","RGUTSTX0",111,0)
 D:$$NEXT("(") PLIST^RGUTSTX1(.RGX)
"RTN","RGUTSTX0",112,0)
 Q
"RTN","RGUTSTX0",113,0)
 ; New/Kill/Set/Lock argument list
"RTN","RGUTSTX0",114,0)
LIST(RGL1,RGL2) ;
"RTN","RGUTSTX0",115,0)
 N RGP,RGI
"RTN","RGUTSTX0",116,0)
 S RGP=0
"RTN","RGUTSTX0",117,0)
 F  D  Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX0",118,0)
 .I 'RGP,RGL1["+",$$NEXT("+-")
"RTN","RGUTSTX0",119,0)
 .I $D(RGL2),$$NEXT("(") D  Q:RGERR
"RTN","RGUTSTX0",120,0)
 ..I RGP S RGERR=2 Q
"RTN","RGUTSTX0",121,0)
 ..E  S RGP=1
"RTN","RGUTSTX0",122,0)
 .S RGI=$S(RGP:RGL2,1:RGL1)
"RTN","RGUTSTX0",123,0)
 .D LVAL(.RGI)
"RTN","RGUTSTX0",124,0)
 .Q:RGERR
"RTN","RGUTSTX0",125,0)
 .I $$NEXT(")") D  Q:RGERR
"RTN","RGUTSTX0",126,0)
 ..I RGP S RGP=0
"RTN","RGUTSTX0",127,0)
 ..E  S RGERR=2
"RTN","RGUTSTX0",128,0)
 .I 'RGP,RGL1[":",$$NEXT(":") D EXP()
"RTN","RGUTSTX0",129,0)
 .I 'RGP,RGL1["=" D
"RTN","RGUTSTX0",130,0)
 ..I '$$NEXT("=") S:RGI'["@" RGERR=2
"RTN","RGUTSTX0",131,0)
 ..E  D EXP():$D(RGL2),LVAL(RGL1):'$D(RGL2)
"RTN","RGUTSTX0",132,0)
 I 'RGERR,RGP S RGERR=3
"RTN","RGUTSTX0",133,0)
 Q
"RTN","RGUTSTX0",134,0)
 ; Check for validity of label name
"RTN","RGUTSTX0",135,0)
LABEL(RGP) ;
"RTN","RGUTSTX0",136,0)
 Q $$NAME(.RGP,"L%")
"RTN","RGUTSTX0",137,0)
 ; Check for validity of variable/label name
"RTN","RGUTSTX0",138,0)
NAME(RGP,RGF) ;
"RTN","RGUTSTX0",139,0)
 N RGP1
"RTN","RGUTSTX0",140,0)
 S (RGP,RGP1)=$G(RGP,RGPSN),RGF=$G(RGF)
"RTN","RGUTSTX0",141,0)
 I RGF["$",$E(RGM,RGP)="$" S RGP=RGP+1
"RTN","RGUTSTX0",142,0)
 I RGF["%",$E(RGM,RGP)="%" S RGP=RGP+1
"RTN","RGUTSTX0",143,0)
 F RGP=RGP:1 Q:$E(RGM,RGP)'?@$S(RGF["L":"1AN",RGP=RGP1:"1A",1:"1AN")
"RTN","RGUTSTX0",144,0)
 S:RGP=RGP1 RGERR=$S(RGF["L":11,1:1)
"RTN","RGUTSTX0",145,0)
 Q RGP
"RTN","RGUTSTX0",146,0)
 ; Instrinsic function/system variable
"RTN","RGUTSTX0",147,0)
INT(RGP,RGL) ;
"RTN","RGUTSTX0",148,0)
 N RGP2,RGINT,RGNM
"RTN","RGUTSTX0",149,0)
 S RGP=$G(RGP,RGPSN),RGP2=$$NAME(RGP),RGL=$G(RGL)
"RTN","RGUTSTX0",150,0)
 Q:RGERR ""
"RTN","RGUTSTX0",151,0)
 S RGNM=$E(RGM,RGP,RGP2-1)
"RTN","RGUTSTX0",152,0)
 I $E(RGM,RGP2)="(" S:$D(^TMP(RGPID,"FCN",RGNM)) RGINT=^(RGNM)
"RTN","RGUTSTX0",153,0)
 E  S:$D(^TMP(RGPID,"SYS",RGNM)) RGINT=^(RGNM)
"RTN","RGUTSTX0",154,0)
 I '$D(RGINT),RGO["Z" S RGINT=";0-999"
"RTN","RGUTSTX0",155,0)
 I '$D(RGINT) S RGERR=7
"RTN","RGUTSTX0",156,0)
 E  I RGL'="",$TR(RGL,$P(RGINT,";"))=RGL S RGERR=2,RGINT=""
"RTN","RGUTSTX0",157,0)
 E  S RGP=RGP2
"RTN","RGUTSTX0",158,0)
 Q $G(RGINT)
"RTN","RGUTSTX0",159,0)
 ; Check next character
"RTN","RGUTSTX0",160,0)
NEXT(RGC,RGI) ;
"RTN","RGUTSTX0",161,0)
 I RGPSN'>RGLEN,RGC[$E(RGM,RGPSN) S RGPSN=RGPSN+$G(RGI,1)
"RTN","RGUTSTX0",162,0)
 Q $T
"RTN","RGUTSTX1")
0^29^B19881115
"RTN","RGUTSTX1",1,0)
RGUTSTX1 ;CAIRO/DKM - Continuation of RGUTSTX;04-Sep-1998 11:26;DKM
"RTN","RGUTSTX1",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTSTX1",3,0)
 ;=================================================================
"RTN","RGUTSTX1",4,0)
 ; Parse an expression
"RTN","RGUTSTX1",5,0)
EXP(RGEX) ;
"RTN","RGUTSTX1",6,0)
 N RGF,RGC,RGPN
"RTN","RGUTSTX1",7,0)
 S (RGF,RGPN)=0,RGEX=$G(RGEX)
"RTN","RGUTSTX1",8,0)
 F  D  Q:RGF<0!RGERR
"RTN","RGUTSTX1",9,0)
 .S RGC=$E(RGM,RGPSN),RGPSN=RGPSN+1
"RTN","RGUTSTX1",10,0)
 .D @("OP"_RGF)
"RTN","RGUTSTX1",11,0)
 I 'RGERR,RGPN S RGERR=3
"RTN","RGUTSTX1",12,0)
 S RGEX=$S($G(RGPN(RGPN,"@")):"@",1:"")_RGEX
"RTN","RGUTSTX1",13,0)
 Q
"RTN","RGUTSTX1",14,0)
 ; Operands
"RTN","RGUTSTX1",15,0)
OP0 I RGC'=".",RGEX["." S RGEX=$TR(RGEX,".")
"RTN","RGUTSTX1",16,0)
 G:RGC'="" COLON2:RGC=":",GLBL:RGC=U,DOT:RGC=".",INDIR:RGC="@",FCN:RGC="$",UNARY:"'+-"[RGC,QT:RGC=RGQT,NUM:RGC?1N,OPNPAR:RGC="(",VAR:RGC?1A,VAR:RGC="%"
"RTN","RGUTSTX1",17,0)
 S RGERR=6
"RTN","RGUTSTX1",18,0)
 Q
"RTN","RGUTSTX1",19,0)
 ; Operators
"RTN","RGUTSTX1",20,0)
OP1 G END:RGC="",INDIR2:RGC="@",DONE:RGEX["="&'RGPN!(RGC=" ")
"RTN","RGUTSTX1",21,0)
 K RGPN(RGPN,"@")
"RTN","RGUTSTX1",22,0)
 G COLON:RGC=":",CLSPAR:RGC=")",RBRKT:RGC="]",BINARY:"!#&*-_+=\/<>["[RGC,NOT:RGC="'",PTRN:RGC="?"
"RTN","RGUTSTX1",23,0)
DONE S RGPSN=RGPSN-1
"RTN","RGUTSTX1",24,0)
END S RGF=-1
"RTN","RGUTSTX1",25,0)
 Q
"RTN","RGUTSTX1",26,0)
 ; Negated operator
"RTN","RGUTSTX1",27,0)
NOT S:'$$NEXT("=<>[]?&!",0) RGERR=2
"RTN","RGUTSTX1",28,0)
 Q
"RTN","RGUTSTX1",29,0)
 ; Parse a global reference
"RTN","RGUTSTX1",30,0)
GLBL D:$$NEXT("[") PLIST(";1-2","]")
"RTN","RGUTSTX1",31,0)
 Q:RGERR
"RTN","RGUTSTX1",32,0)
 S:'$$NEXT("(",0) RGPSN=$$NAME^RGUTSTX0(RGPSN,"$%")
"RTN","RGUTSTX1",33,0)
 I 'RGERR,$$NEXT("(") D PLIST(";1-999")
"RTN","RGUTSTX1",34,0)
 S RGF=1
"RTN","RGUTSTX1",35,0)
 Q
"RTN","RGUTSTX1",36,0)
 ; Indirection (prefix)
"RTN","RGUTSTX1",37,0)
INDIR S RGPN(RGPN,"@")=$G(RGPN(RGPN,"@"))+1
"RTN","RGUTSTX1",38,0)
 Q
"RTN","RGUTSTX1",39,0)
 ; Indirection (suffix)
"RTN","RGUTSTX1",40,0)
INDIR2 I +$G(RGPN(RGPN,"@"))'>0 S RGERR=2
"RTN","RGUTSTX1",41,0)
 E  I '$$NEXT("(") S RGERR=2
"RTN","RGUTSTX1",42,0)
 E  D
"RTN","RGUTSTX1",43,0)
 .S RGPN(RGPN,"@")=-(RGPN(RGPN,"@")>1)
"RTN","RGUTSTX1",44,0)
 .D PLIST()
"RTN","RGUTSTX1",45,0)
 Q
"RTN","RGUTSTX1",46,0)
 ; Intrinsic function/system variable
"RTN","RGUTSTX1",47,0)
FCN G:$$NEXT("$") EXT
"RTN","RGUTSTX1",48,0)
INT N RGZ,RGZ1
"RTN","RGUTSTX1",49,0)
 S RGZ1=$E(RGM,RGPSN),RGZ=$$INT^RGUTSTX0(.RGPSN),RGF=1
"RTN","RGUTSTX1",50,0)
 I 'RGERR,$$NEXT("(") D PLIST(RGZ)
"RTN","RGUTSTX1",51,0)
 Q
"RTN","RGUTSTX1",52,0)
 ; Extrinsic function
"RTN","RGUTSTX1",53,0)
EXT S:'$$NEXT(U,0) RGPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX1",54,0)
 Q:RGERR
"RTN","RGUTSTX1",55,0)
 S:$$NEXT(U) RGPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX1",56,0)
 Q:RGERR
"RTN","RGUTSTX1",57,0)
 D:$$NEXT("(") PLIST(".;0-999")
"RTN","RGUTSTX1",58,0)
 S RGF=1
"RTN","RGUTSTX1",59,0)
 Q
"RTN","RGUTSTX1",60,0)
 ; Unary operator
"RTN","RGUTSTX1",61,0)
UNARY Q
"RTN","RGUTSTX1",62,0)
 ; String literal
"RTN","RGUTSTX1",63,0)
QT D QT2
"RTN","RGUTSTX1",64,0)
 S RGF=1
"RTN","RGUTSTX1",65,0)
 Q
"RTN","RGUTSTX1",66,0)
 ; Find matching quote
"RTN","RGUTSTX1",67,0)
QT2 F RGPSN=RGPSN:1:RGLEN I $$NEXT(RGQT),'$$NEXT(RGQT,0) Q
"RTN","RGUTSTX1",68,0)
 S:$E(RGM,RGPSN-1)'=RGQT RGERR=9
"RTN","RGUTSTX1",69,0)
 Q
"RTN","RGUTSTX1",70,0)
 ; Numeric constant
"RTN","RGUTSTX1",71,0)
NUM N RGZ,RGZ1
"RTN","RGUTSTX1",72,0)
 S RGZ=0,RGF=1
"RTN","RGUTSTX1",73,0)
 F RGPSN=RGPSN-1:1 S RGZ1=$E(RGM,RGPSN) D @("NUM"_RGZ) Q:RGZ<0
"RTN","RGUTSTX1",74,0)
 S:RGZ=-2 RGERR=2
"RTN","RGUTSTX1",75,0)
 Q
"RTN","RGUTSTX1",76,0)
NUM0 S RGZ=$S(RGZ1?1N:1,RGZ1=".":2,1:-2)
"RTN","RGUTSTX1",77,0)
 Q
"RTN","RGUTSTX1",78,0)
NUM1 S RGZ=$S(RGZ1?1N:1,RGZ1=".":3,1:-1)
"RTN","RGUTSTX1",79,0)
 Q
"RTN","RGUTSTX1",80,0)
NUM2 S RGZ=$S(RGZ1?1N:3,1:-2)
"RTN","RGUTSTX1",81,0)
 Q
"RTN","RGUTSTX1",82,0)
NUM3 S RGZ=$S(RGZ1?1N:3,RGZ1="E":4,1:-1)
"RTN","RGUTSTX1",83,0)
 Q
"RTN","RGUTSTX1",84,0)
NUM4 S RGZ=$S(RGZ1="+":5,RGZ1="-":5,RGZ1=".":7,RGZ1?1N:6,1:-2)
"RTN","RGUTSTX1",85,0)
 Q
"RTN","RGUTSTX1",86,0)
NUM5 S RGZ=$S(RGZ1?1N:6,RGZ1=".":7,1:-2)
"RTN","RGUTSTX1",87,0)
 Q
"RTN","RGUTSTX1",88,0)
NUM6 S RGZ=$S(RGZ1?1N:6,RGZ1=".":8,1:-1)
"RTN","RGUTSTX1",89,0)
 Q
"RTN","RGUTSTX1",90,0)
NUM7 S RGZ=$S(RGZ1?1N:8,1:-2)
"RTN","RGUTSTX1",91,0)
 Q
"RTN","RGUTSTX1",92,0)
NUM8 S RGZ=$S(RGZ1?1N:8,1:-1)
"RTN","RGUTSTX1",93,0)
 Q
"RTN","RGUTSTX1",94,0)
 ; Open parenthesis
"RTN","RGUTSTX1",95,0)
OPNPAR S RGPN=RGPN+1
"RTN","RGUTSTX1",96,0)
 K RGPN(RGPN)
"RTN","RGUTSTX1",97,0)
 Q
"RTN","RGUTSTX1",98,0)
 ; Period (variable by reference or FP number)
"RTN","RGUTSTX1",99,0)
DOT I RGEX[".",$E(RGM,RGPSN)'?1N D
"RTN","RGUTSTX1",100,0)
 .I '$$NEXT("@") S RGPSN=$$NAME^RGUTSTX0(RGPSN,"%"),RGF=-1
"RTN","RGUTSTX1",101,0)
 .E  D INDIR
"RTN","RGUTSTX1",102,0)
 E  D NUM
"RTN","RGUTSTX1",103,0)
 Q
"RTN","RGUTSTX1",104,0)
 ; Variable name
"RTN","RGUTSTX1",105,0)
VAR S RGPSN=$$NAME^RGUTSTX0(RGPSN-1,"%"),RGF=1
"RTN","RGUTSTX1",106,0)
 D:$$NEXT("(") PLIST()
"RTN","RGUTSTX1",107,0)
 Q
"RTN","RGUTSTX1",108,0)
 ; Closing parenthesis
"RTN","RGUTSTX1",109,0)
CLSPAR I 'RGPN,RGEX[")" G DONE
"RTN","RGUTSTX1",110,0)
 I RGPN S RGPN=RGPN-1
"RTN","RGUTSTX1",111,0)
 E  S RGERR=3
"RTN","RGUTSTX1",112,0)
 Q
"RTN","RGUTSTX1",113,0)
 ; Right bracket (] or ]])
"RTN","RGUTSTX1",114,0)
RBRKT I 'RGPN,RGEX["]" G DONE
"RTN","RGUTSTX1",115,0)
 I $$NEXT(RGC)
"RTN","RGUTSTX1",116,0)
 ; Binary operator
"RTN","RGUTSTX1",117,0)
BINARY S RGF=0
"RTN","RGUTSTX1",118,0)
 Q
"RTN","RGUTSTX1",119,0)
 ; Colon operand
"RTN","RGUTSTX1",120,0)
COLON2 S:RGEX'["M" RGERR=6
"RTN","RGUTSTX1",121,0)
 Q
"RTN","RGUTSTX1",122,0)
 ; Colon operator
"RTN","RGUTSTX1",123,0)
COLON G:RGEX'[":" DONE
"RTN","RGUTSTX1",124,0)
 S RGF=0
"RTN","RGUTSTX1",125,0)
 S:RGEX'["M" RGEX=$TR(RGEX,":")
"RTN","RGUTSTX1",126,0)
 Q
"RTN","RGUTSTX1",127,0)
 ; Pattern match
"RTN","RGUTSTX1",128,0)
PTRN N RGZ,RGZ1
"RTN","RGUTSTX1",129,0)
 I $$NEXT("@") S RGF=0 Q
"RTN","RGUTSTX1",130,0)
 S RGZ=RGPSN,@$$TRAP^RGZOSF("PERR^RGUTSTX1"),RGZ1=0
"RTN","RGUTSTX1",131,0)
 F  D  Q:RGZ1<0!RGERR
"RTN","RGUTSTX1",132,0)
 .D QT2:$$NEXT(RGQT),PTRN1:$$NEXT("("),PTRN2:$$NEXT(")")
"RTN","RGUTSTX1",133,0)
 .I RGZ1,$$NEXT(",")
"RTN","RGUTSTX1",134,0)
 .S:'$$NEXT("ACELNPU.0123456789") RGZ1=-1
"RTN","RGUTSTX1",135,0)
 S:'RGERR RGZ=RGZ?@$E(RGM,RGZ,RGPSN-1)
"RTN","RGUTSTX1",136,0)
 Q
"RTN","RGUTSTX1",137,0)
PTRN1 S RGZ1=RGZ1+1
"RTN","RGUTSTX1",138,0)
 Q
"RTN","RGUTSTX1",139,0)
PTRN2 S RGZ1=RGZ1-1
"RTN","RGUTSTX1",140,0)
 S:RGZ1<0 RGPSN=RGPSN-1
"RTN","RGUTSTX1",141,0)
 Q
"RTN","RGUTSTX1",142,0)
PERR S RGERR=10
"RTN","RGUTSTX1",143,0)
 Q
"RTN","RGUTSTX1",144,0)
 ; Process a parameter list
"RTN","RGUTSTX1",145,0)
PLIST(RGP,RGT) ;
"RTN","RGUTSTX1",146,0)
 N RGC,RGP1,RGP2,RGZ
"RTN","RGUTSTX1",147,0)
 S RGT=$G(RGT,")"),RGP=$G(RGP,";0-999"),RGP2=$P(RGP,";",2),RGP1=+RGP2,RGP2=+$P(RGP2,"-",2),RGC=0,RGZ=$P(RGP,";")
"RTN","RGUTSTX1",148,0)
 I '$$NEXT(RGT,0) D
"RTN","RGUTSTX1",149,0)
 .F RGC=1:1 D  Q:RGERR!'$$NEXT(",")
"RTN","RGUTSTX1",150,0)
 ..D @("PL"_$P(RGP,";",RGC+2))
"RTN","RGUTSTX1",151,0)
 I 'RGERR,RGC<RGP1!(RGC>RGP2) S RGERR=8
"RTN","RGUTSTX1",152,0)
 I 'RGERR,'$$NEXT(RGT) S RGERR=3
"RTN","RGUTSTX1",153,0)
 Q
"RTN","RGUTSTX1",154,0)
PL N RGEX
"RTN","RGUTSTX1",155,0)
 I RGZ=".",$$NEXT(",",0) Q
"RTN","RGUTSTX1",156,0)
 S RGEX=RGT_RGZ
"RTN","RGUTSTX1",157,0)
 D EXP(.RGEX)
"RTN","RGUTSTX1",158,0)
 I RGZ[":",RGEX[":" S RGERR=2
"RTN","RGUTSTX1",159,0)
 Q
"RTN","RGUTSTX1",160,0)
PLV D LVAL^RGUTSTX0("LG")
"RTN","RGUTSTX1",161,0)
 Q
"RTN","RGUTSTX1",162,0)
PLL D LBL1^RGUTSTX0()
"RTN","RGUTSTX1",163,0)
 Q
"RTN","RGUTSTX1",164,0)
 ; Get next character
"RTN","RGUTSTX1",165,0)
NEXT(RGC,RGI) ;
"RTN","RGUTSTX1",166,0)
 Q $$NEXT^RGUTSTX0(RGC,.RGI)
"RTN","RGUTTSK")
0^57^B969302
"RTN","RGUTTSK",1,0)
RGUTTSK ;CAIRO/DKM - Encapsulates TaskMan API ;04-Sep-1998 11:26;DKM
"RTN","RGUTTSK",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTTSK",3,0)
 ;=================================================================
"RTN","RGUTTSK",4,0)
QUEUE(ZTRTN,ZTDESC,ZTDTH,ZTSAVE,ZTIO,ZTUCI,ZTPRI) ;
"RTN","RGUTTSK",5,0)
 N %RGZ,%RGZ1,%RGZ2,ZTKIL,ZTSK,ZTCPU
"RTN","RGUTTSK",6,0)
 S:'$G(ZTDTH) ZTDTH=$H
"RTN","RGUTTSK",7,0)
 S:ZTDTH'?1.N1","1.N ZTDTH=$$FMTH^XLFDT(ZTDTH)
"RTN","RGUTTSK",8,0)
 Q:ZTDTH<0 0
"RTN","RGUTTSK",9,0)
 S:$G(ZTUCI)'="" ZTUCI=$TR(ZTUCI,":",","),ZTCPU=$P(ZTUCI,",",2),ZTUCI=$P(ZTUCI,",")
"RTN","RGUTTSK",10,0)
 S ZTSAVE=$G(ZTSAVE),ZTIO=$G(ZTIO),U="^"
"RTN","RGUTTSK",11,0)
 F %RGZ=1:1:$L(ZTSAVE,U) D
"RTN","RGUTTSK",12,0)
 .S %RGZ1=$P(ZTSAVE,U,%RGZ),%RGZ2=$P(%RGZ1,"=",2,999),%RGZ1=$P(%RGZ1,"=")
"RTN","RGUTTSK",13,0)
 .S:%RGZ1'="" ZTSAVE(%RGZ1)=%RGZ2
"RTN","RGUTTSK",14,0)
 D ^%ZTLOAD
"RTN","RGUTTSK",15,0)
 Q +$G(ZTSK)
"RTN","RGUTUSR")
0^58^B3690301
"RTN","RGUTUSR",1,0)
RGUTUSR ;CAIRO/DKM - Parse recipient list;04-Sep-1998 11:26;DKM
"RTN","RGUTUSR",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTUSR",3,0)
 ;=================================================================
"RTN","RGUTUSR",4,0)
 ; Takes a list of recipients (which may be DUZ #'s, names,
"RTN","RGUTUSR",5,0)
 ; mail groups, or special tokens) as input and produces an
"RTN","RGUTUSR",6,0)
 ; array of DUZ's as output.  If a list element is found in
"RTN","RGUTUSR",7,0)
 ; in the token list RGLST, the value of the token entry will
"RTN","RGUTUSR",8,0)
 ; be substituted.
"RTN","RGUTUSR",9,0)
 ; Inputs:
"RTN","RGUTUSR",10,0)
 ;     RGUSR = Semicolon-delimited list of recipients
"RTN","RGUTUSR",11,0)
 ;     RGLST = Special token list
"RTN","RGUTUSR",12,0)
 ; Outputs:
"RTN","RGUTUSR",13,0)
 ;     RGOUT = Local array to receive DUZ list
"RTN","RGUTUSR",14,0)
 ;=================================================================
"RTN","RGUTUSR",15,0)
ENTRY(RGUSR,RGOUT,RGLST) ;
"RTN","RGUTUSR",16,0)
 N RGZ,RGZ1,RGZ2
"RTN","RGUTUSR",17,0)
 K RGOUT
"RTN","RGUTUSR",18,0)
 F RGZ=1:1:$L(RGUSR,";") S RGZ1=$P(RGUSR,";",RGZ) D:RGZ1'=""  S:RGZ1 RGOUT(+RGZ1)=""
"RTN","RGUTUSR",19,0)
 .S:$D(RGLST(RGZ1)) RGZ1=RGLST(RGZ1)
"RTN","RGUTUSR",20,0)
 .Q:RGZ1?.N
"RTN","RGUTUSR",21,0)
 .I RGZ1?1"-"1.N D MGRP(-RGZ1) S RGZ1=0 Q
"RTN","RGUTUSR",22,0)
 .S RGZ2=$E(RGZ1,1,2)
"RTN","RGUTUSR",23,0)
 .I RGZ2="G." D MGRP($E(RGZ1,3,999)) Q
"RTN","RGUTUSR",24,0)
 .I RGZ2="L." D LIST($E(RGZ1,3,999)) Q
"RTN","RGUTUSR",25,0)
 .S RGZ1=$$LKP(RGZ1)
"RTN","RGUTUSR",26,0)
 Q
"RTN","RGUTUSR",27,0)
LKP(RGNAME) ;
"RTN","RGUTUSR",28,0)
 N RGZ,RGZ1
"RTN","RGUTUSR",29,0)
 I $D(^VA(200,"B",RGNAME)) S RGZ=RGNAME G L1
"RTN","RGUTUSR",30,0)
 S RGZ=$O(^(RGNAME)),RGZ1=$O(^(RGZ))
"RTN","RGUTUSR",31,0)
 Q:(RGZ="")!(RGNAME'=$E(RGZ,1,$L(RGNAME))) 0
"RTN","RGUTUSR",32,0)
 Q:(RGZ1'="")&(RGNAME=$E(RGZ1,1,$L(RGNAME))) 0
"RTN","RGUTUSR",33,0)
L1 S RGZ1=$O(^(RGZ,0)),RGZ=$O(^(RGZ1))
"RTN","RGUTUSR",34,0)
 Q:'RGZ1!RGZ 0
"RTN","RGUTUSR",35,0)
 Q RGZ1
"RTN","RGUTUSR",36,0)
LIST(RGLIST) ;
"RTN","RGUTUSR",37,0)
 Q:RGLIST=""
"RTN","RGUTUSR",38,0)
 S:RGLIST'=+RGLIST RGLIST=+$O(^RGCDSS(993.6,"B",RGLIST,0))
"RTN","RGUTUSR",39,0)
 S @$$TRAP^RGZOSF("LERR^RGUTUSR")
"RTN","RGUTUSR",40,0)
 X:$D(^RGCDSS(993.6,RGLIST,1)) ^(1)
"RTN","RGUTUSR",41,0)
LERR Q
"RTN","RGUTUSR",42,0)
MGRP(RGMGRP) ;
"RTN","RGUTUSR",43,0)
 N RGX
"RTN","RGUTUSR",44,0)
 S RGX(0)=""
"RTN","RGUTUSR",45,0)
 D MGRP2(RGMGRP)
"RTN","RGUTUSR",46,0)
 Q
"RTN","RGUTUSR",47,0)
MGRP2(RGMGRP) ;
"RTN","RGUTUSR",48,0)
 N RGZ,RGZ1
"RTN","RGUTUSR",49,0)
 Q:RGMGRP=""
"RTN","RGUTUSR",50,0)
 S:RGMGRP'=+RGMGRP RGMGRP=+$O(^XMB(3.8,"B",RGMGRP,0))
"RTN","RGUTUSR",51,0)
 Q:$D(RGX(RGMGRP))
"RTN","RGUTUSR",52,0)
 S RGX(RGMGRP)=""
"RTN","RGUTUSR",53,0)
 F RGZ=0:0 S RGZ=+$O(^XMB(3.8,RGMGRP,1,RGZ)) Q:'RGZ  S RGOUT(+^(RGZ,0))=""
"RTN","RGUTUSR",54,0)
 F RGZ=0:0 S RGZ=+$O(^XMB(3.8,RGMGRP,5,RGZ)) Q:'RGZ  D MGRP2(^(RGZ,0))
"RTN","RGUTUSR",55,0)
 Q
"RTN","RGUTUU")
0^59^B1767593
"RTN","RGUTUU",1,0)
RGUTUU ;CAIRO/DKM - UUEncode and UUDecode functions.;04-Sep-1998 11:26;DKM
"RTN","RGUTUU",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGUTUU",3,0)
 ;=================================================================
"RTN","RGUTUU",4,0)
ENCODE(X) ;
"RTN","RGUTUU",5,0)
 N RGZ,RGZ1,RGZ2,RGZ3,RGZ4,RGZ5,RGZ6
"RTN","RGUTUU",6,0)
 S RGZ=$$INIT,RGZ1=""
"RTN","RGUTUU",7,0)
 F RGZ2=1:3:$L(X) D
"RTN","RGUTUU",8,0)
 .S RGZ3=0,RGZ6=""
"RTN","RGUTUU",9,0)
 .F RGZ4=0:1:2 D
"RTN","RGUTUU",10,0)
 ..S RGZ5=$A(X,RGZ2+RGZ4),RGZ3=RGZ3*256+$S(RGZ5<0:0,1:RGZ5)
"RTN","RGUTUU",11,0)
 .F RGZ4=1:1:4 S RGZ6=$E(RGZ,RGZ3#64+2)_RGZ6,RGZ3=RGZ3\64
"RTN","RGUTUU",12,0)
 .S RGZ1=RGZ1_RGZ6
"RTN","RGUTUU",13,0)
 S RGZ2=$L(X)#3
"RTN","RGUTUU",14,0)
 S:RGZ2 RGZ3=$L(RGZ1),$E(RGZ1,RGZ3-2+RGZ2,RGZ3)=$E("==",RGZ2,2)
"RTN","RGUTUU",15,0)
 Q RGZ1
"RTN","RGUTUU",16,0)
DECODE(X) ;
"RTN","RGUTUU",17,0)
 N RGZ,RGZ1,RGZ2,RGZ3,RGZ4,RGZ5,RGZ6
"RTN","RGUTUU",18,0)
 S RGZ=$$INIT,RGZ1=""
"RTN","RGUTUU",19,0)
 F RGZ2=1:4:$L(X) D
"RTN","RGUTUU",20,0)
 .S RGZ3=0,RGZ6=""
"RTN","RGUTUU",21,0)
 .F RGZ4=0:1:3 D
"RTN","RGUTUU",22,0)
 ..S RGZ5=$F(RGZ,$E(X,RGZ2+RGZ4))-3
"RTN","RGUTUU",23,0)
 ..S RGZ3=RGZ3*64+$S(RGZ5<0:0,1:RGZ5)
"RTN","RGUTUU",24,0)
 .F RGZ4=0:1:2 S RGZ6=$C(RGZ3#256)_RGZ6,RGZ3=RGZ3\256
"RTN","RGUTUU",25,0)
 .S RGZ1=RGZ1_RGZ6
"RTN","RGUTUU",26,0)
 Q $E(RGZ1,1,$L(RGZ1)-$L(X,"=")+1)
"RTN","RGUTUU",27,0)
INIT() Q "=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
"RTN","RGXY")
0^30^B25510
"RTN","RGXY",1,0)
RGXY(DX,DY) ;CAIRO/DKM - Positions the cursor to the given coordinates;30-Jun-1998 08:56;DKM
"RTN","RGXY",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGXY",3,0)
 ;=================================================================
"RTN","RGXY",4,0)
 Q $$XY^RGUT(.DX,.DY)
"RTN","RGZOSF")
0^60^B1714601
"RTN","RGZOSF",1,0)
RGZOSF ;CAIRO/DKM - Platform-dependent operations;09-Oct-1998 08:25;DKM
"RTN","RGZOSF",2,0)
 ;;2.1;RUN TIME LIBRARY;;Mar 22, 1999
"RTN","RGZOSF",3,0)
 ;=================================================================
"RTN","RGZOSF",4,0)
CVTFN(RGFIL,RGROOT) ;
"RTN","RGZOSF",5,0)
 Q $$CVTFN^RGUTOS(.RGFIL,.RGROOT)
"RTN","RGZOSF",6,0)
RM(X) D RM^RGUTOS(.X)
"RTN","RGZOSF",7,0)
 Q
"RTN","RGZOSF",8,0)
TEST(X) Q $$TEST^RGUTOS(.X)
"RTN","RGZOSF",9,0)
ETRAP() Q $$ETRAP^RGUTOS
"RTN","RGZOSF",10,0)
OPENX(X1,X2) ;
"RTN","RGZOSF",11,0)
 Q $$OPENX^RGUTOS(.X1,.X2)
"RTN","RGZOSF",12,0)
VER() Q $$VER^RGUTOS
"RTN","RGZOSF",13,0)
OPEN(X1,X2) ;
"RTN","RGZOSF",14,0)
 D OPEN^RGUTOS(.X1,.X2)
"RTN","RGZOSF",15,0)
 Q
"RTN","RGZOSF",16,0)
CLOSE(X) D CLOSE^RGUTOS(.X)
"RTN","RGZOSF",17,0)
 Q
"RTN","RGZOSF",18,0)
CLOSEALL G CLOSEALL^RGUTOS
"RTN","RGZOSF",19,0)
EOF D EOF^RGUTOS
"RTN","RGZOSF",20,0)
 Q
"RTN","RGZOSF",21,0)
EOFERR() Q $$EOFERR^RGUTOS
"RTN","RGZOSF",22,0)
READ(X,Y) ;
"RTN","RGZOSF",23,0)
 Q $$READ^RGUTOS(.X,.Y)
"RTN","RGZOSF",24,0)
DELETE(X) ;
"RTN","RGZOSF",25,0)
 D DELETE^RGUTOS(.X)
"RTN","RGZOSF",26,0)
 Q
"RTN","RGZOSF",27,0)
RENAME(X1,X2) ;
"RTN","RGZOSF",28,0)
 D RENAME^RGUTOS(.X1,.X2)
"RTN","RGZOSF",29,0)
 Q
"RTN","RGZOSF",30,0)
DIR(X1,X2,X3) ;
"RTN","RGZOSF",31,0)
 D DIR^RGUTOS(.X1,.X2,.X3)
"RTN","RGZOSF",32,0)
 Q
"RTN","RGZOSF",33,0)
DIRDLM() Q $$DIRDLM^RGUTOS
"RTN","RGZOSF",34,0)
ERR(X1,X2,X3) ;
"RTN","RGZOSF",35,0)
 D ERR^RGUTOS(.X1,.X2,.X3)
"RTN","RGZOSF",36,0)
 Q
"RTN","RGZOSF",37,0)
FTP(X1,X2,X3,X4,X5,X6,X7) ;
"RTN","RGZOSF",38,0)
 D FTP^RGUTOS(.X1,.X2,.X3,.X4,.X5,.X6,.X7)
"RTN","RGZOSF",39,0)
 Q
"RTN","RGZOSF",40,0)
RAISE(X) D RAISE^RGUTOS(.X)
"RTN","RGZOSF",41,0)
 Q
"RTN","RGZOSF",42,0)
TRAP(X) Q $$TRAP^RGUTOS(.X)
"RTN","RGZOSF",43,0)
SIZE(X) Q $$SIZE^RGUTOS(.X)
"RTN","RGZOSF",44,0)
FREE(X) Q $$FREE^RGUTOS(.X)
"RTN","RGZOSF1")
1^31
"VER")
8.0^21.0
**END**
**END**
