Released QAQ*1.7*5 SEQ #5
Extracted from mail message
**KIDS**:QAQ*1.7*5^

**INSTALL NAME**
QAQ*1.7*5
"BLD",972,0)
QAQ*1.7*5^QUALITY ASSURANCE INTEGRATION^0^^y
"BLD",972,4,0)
^9.64PA^^
"BLD",972,"ABNS",0)
^9.66A^^
"BLD",972,"ABPKG")
n^y
"BLD",972,"KRN",0)
^9.67PA^19^18
"BLD",972,"KRN",.4,0)
.4
"BLD",972,"KRN",.401,0)
.401
"BLD",972,"KRN",.402,0)
.402
"BLD",972,"KRN",.403,0)
.403
"BLD",972,"KRN",.5,0)
.5
"BLD",972,"KRN",.84,0)
.84
"BLD",972,"KRN",3.6,0)
3.6
"BLD",972,"KRN",3.8,0)
3.8
"BLD",972,"KRN",9.2,0)
9.2
"BLD",972,"KRN",9.8,0)
9.8
"BLD",972,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",972,"KRN",9.8,"NM",1,0)
QAQAHOC3^^0^B53934797
"BLD",972,"KRN",9.8,"NM",2,0)
QAQAHOC4^^0^B13384336
"BLD",972,"KRN",9.8,"NM",3,0)
QAQAHOC5^^0^B4639453
"BLD",972,"KRN",9.8,"NM","B","QAQAHOC3",1)

"BLD",972,"KRN",9.8,"NM","B","QAQAHOC4",2)

"BLD",972,"KRN",9.8,"NM","B","QAQAHOC5",3)

"BLD",972,"KRN",19,0)
19
"BLD",972,"KRN",19,"NM",0)
^9.68A^^
"BLD",972,"KRN",19.1,0)
19.1
"BLD",972,"KRN",101,0)
101
"BLD",972,"KRN",409.61,0)
409.61
"BLD",972,"KRN",771,0)
771
"BLD",972,"KRN",869.2,0)
869.2
"BLD",972,"KRN",870,0)
870
"BLD",972,"KRN",8994,0)
8994
"BLD",972,"KRN","B",.4,.4)

"BLD",972,"KRN","B",.401,.401)

"BLD",972,"KRN","B",.402,.402)

"BLD",972,"KRN","B",.403,.403)

"BLD",972,"KRN","B",.5,.5)

"BLD",972,"KRN","B",.84,.84)

"BLD",972,"KRN","B",3.6,3.6)

"BLD",972,"KRN","B",3.8,3.8)

"BLD",972,"KRN","B",9.2,9.2)

"BLD",972,"KRN","B",9.8,9.8)

"BLD",972,"KRN","B",19,19)

"BLD",972,"KRN","B",19.1,19.1)

"BLD",972,"KRN","B",101,101)

"BLD",972,"KRN","B",409.61,409.61)

"BLD",972,"KRN","B",771,771)

"BLD",972,"KRN","B",869.2,869.2)

"BLD",972,"KRN","B",870,870)

"BLD",972,"KRN","B",8994,8994)

"BLD",972,"QUES",0)
^9.62^^
"BLD",972,"REQB",0)
^9.611^1^1
"BLD",972,"REQB",1,0)
QAQ*1.7*2^1
"BLD",972,"REQB","B","QAQ*1.7*2",1)

"PKG",370,-1)
1^1
"PKG",370,0)
QUALITY ASSURANCE INTEGRATION^QAQ^UTILITIES USED IN ALL QUALITY ASSURANCE MODULES
"PKG",370,20,0)
^9.402P^^
"PKG",370,22,0)
^9.49I^1^1
"PKG",370,22,1,0)
1.7^2950725^2950914
"PKG",370,22,1,"PAH",1,0)
5^2980722^83
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","QAQAHOC3")
0^1^B53934797
"RTN","QAQAHOC3",1,0)
QAQAHOC3 ;HISC/DAD-AD HOC REPORTS: MACRO MANAGEMENT ;7/12/93  14:35
"RTN","QAQAHOC3",2,0)
 ;;1.7;QM Integration Module;**1,2,5**;07/25/1995
"RTN","QAQAHOC3",3,0)
 ;
"RTN","QAQAHOC3",4,0)
 S QAQSELOP=$E(QAQSELOP,2,999) S:QAQSELOP?1L QAQSELOP=$C($A(QAQSELOP)-32)
"RTN","QAQAHOC3",5,0)
 I "^S^L^I^D^O^"'[("^"_QAQSELOP_"^") S QAQSELOP=-1 Q
"RTN","QAQAHOC3",6,0)
 W $P($P("^Save^Load^Inquire^Delete^Output^","^"_QAQSELOP,2),"^")," ",$S(QAQSELOP'="O":QAQTYPE(0)_" ",1:""),"macro"
"RTN","QAQAHOC3",7,0)
 I $D(^QA(740.1,0))[0 W *7,!!?3,"The Ad Hoc Macro file does not exist !!" S QAQSELOP=0 R QA:QAQDTIME Q
"RTN","QAQAHOC3",8,0)
 D SETSAVE:QAQSELOP="S",LOAD:QAQSELOP="L",INQUIRE:QAQSELOP="I",DELETE:QAQSELOP="D",EN1^QAQAHOC4:QAQSELOP="O"
"RTN","QAQAHOC3",9,0)
 Q
"RTN","QAQAHOC3",10,0)
SETSAVE ; *** Set the save macro flag
"RTN","QAQAHOC3",11,0)
 S QAQMSAVE=1 W !!?3,"The macro will be saved when you exit the ",QAQTYPE(0)," menu. ",*7 I QAQSEQ=1 R QA:QAQDTIME Q
"RTN","QAQAHOC3",12,0)
SAVEOUT W !!?3,"OK to exit now" S %=1 D YN^DICN I '% W !!?5,QAQYESNO G SAVEOUT
"RTN","QAQAHOC3",13,0)
 S:%=1 QAQNEXT=1 S:%=-1 (QAQNEXT,QAQQUIT)=1
"RTN","QAQAHOC3",14,0)
 Q
"RTN","QAQAHOC3",15,0)
SAVE ; *** Save a sort/print macro
"RTN","QAQAHOC3",16,0)
 K DIC,QAQMACRO(QAQTYPE) S DIC(0)="AELMNQZ",DIC("A")="Save" D ASKMAC Q:Y'>0
"RTN","QAQAHOC3",17,0)
 I $P(Y,"^",3)'>0 W *7 D  G SAVE:QAQREPLC=2 Q:QAQREPLC=-1
"RTN","QAQAHOC3",18,0)
REPLACE . W !!?3,QAQTEMP," already exists, OK to replace"
"RTN","QAQAHOC3",19,0)
 . S %=2 D YN^DICN S QAQREPLC=%  I '% W !!?5,QAQYESNO G REPLACE
"RTN","QAQAHOC3",20,0)
 . Q:%'=1
"RTN","QAQAHOC3",21,0)
 . F QAQD1=0:0 S QAQD1=$O(^QA(740.1,QAQD0,"FLD",QAQD1)) Q:QAQD1'>0  D
"RTN","QAQAHOC3",22,0)
 .. S (D0,DA(1))=QAQD0,(D1,DA)=QAQD1,DIK="^QA(740.1,"_QAQD0_",""FLD"","
"RTN","QAQAHOC3",23,0)
 .. D ^DIK
"RTN","QAQAHOC3",24,0)
 .. Q
"RTN","QAQAHOC3",25,0)
 . Q
"RTN","QAQAHOC3",26,0)
 S (QAQFLDNO,%)=0
"RTN","QAQAHOC3",27,0)
 F QAQORDER=0:0 S QAQORDER=$O(QAQOPTN(QAQTYPE,QAQORDER)) Q:(QAQORDER'>0)!(%=-1)  F QAQFIELD=0:0 S QAQFIELD=$O(QAQOPTN(QAQTYPE,QAQORDER,QAQFIELD)) Q:(QAQFIELD'>0)!(%=-1)  D
"RTN","QAQAHOC3",28,0)
SV . I QAQTYPE="S" W !!?3,"Ask user BEGINNING/ENDING values for ",$P(QAQMENU(QAQFIELD),"^",2) S %=2 D YN^DICN Q:%=-1  I '% W !!?5,QAQYESNO G SV
"RTN","QAQAHOC3",29,0)
 . S X=QAQPREFX(QAQTYPE,QAQORDER)_QAQFIELD_QAQSUFFX(QAQTYPE,QAQORDER)_"^"_QAQOPTN(QAQTYPE,QAQORDER,QAQFIELD)_"^"_$S(QAQTYPE="S":(%=1),1:"")
"RTN","QAQAHOC3",30,0)
 . S ^QA(740.1,QAQD0,"FLD",QAQORDER,0)=X,QAQFLDNO=QAQFLDNO+1
"RTN","QAQAHOC3",31,0)
 . I QAQTYPE="S" S ^QA(740.1,QAQD0,"FLD",QAQORDER,"FRTO")=$S(%=2:QAQBEGIN(QAQORDER)_"^"_QAQEND(QAQORDER),1:"^")
"RTN","QAQAHOC3",32,0)
 . E  K ^QA(740.1,QAQD0,"FLD",QAQORDER,"FRTO")
"RTN","QAQAHOC3",33,0)
 . Q
"RTN","QAQAHOC3",34,0)
 I %=-1 S DIK="^QA(740.1,",DA=QAQD0 D ^DIK S QAQMSAVE=0 W !!?3,"Sort macro ",QAQTEMP," not saved !! ",*7 R QA:QAQDTIME Q
"RTN","QAQAHOC3",35,0)
 S $P(^QA(740.1,QAQD0,0),"^",2,4)=$TR(QAQTYPE,"SP","sp")_"^"_QAQDIC_"^"_QAQCHKSM
"RTN","QAQAHOC3",36,0)
 S ^QA(740.1,QAQD0,"FLD",0)="^"_$P(^DD(740.1,1,0),"^",2)_"^"_QAQFLDNO_"^"_QAQFLDNO,DIK="^QA(740.1,",DA=QAQD0 D IX1^DIK
"RTN","QAQAHOC3",37,0)
 S QAQMACRO(QAQTYPE)=QAQTEMP(QAQTYPE)
"RTN","QAQAHOC3",38,0)
 Q
"RTN","QAQAHOC3",39,0)
LOAD ; *** Load a sort/print macro
"RTN","QAQAHOC3",40,0)
 S QAQMLOAD=0 I QAQSEQ>1 W !!?3,QAQTYPE(1)," macros may only be loaded at the first ",QAQTYPE(0)," selection prompt !! ",*7 R QA:QAQDTIME Q
"RTN","QAQAHOC3",41,0)
 K DIC,QAQMACRO(QAQTYPE) S DIC(0)="AEMNQZ",DIC("A")="Load" D ASKMAC Q:Y'>0
"RTN","QAQAHOC3",42,0)
 S (QAQQUIT,QAQNEXT)=0,QAQMLOAD=1
"RTN","QAQAHOC3",43,0)
 F QAQORDER=0:0 S QAQORDER=$O(^QA(740.1,QAQD0,"FLD",QAQORDER)) Q:QAQORDER'>0!QAQQUIT!QAQNEXT  D
"RTN","QAQAHOC3",44,0)
 . S X=^QA(740.1,QAQD0,"FLD",QAQORDER,0),X("FRTO")=$G(^("FRTO"))
"RTN","QAQAHOC3",45,0)
 . S X(1)=$P($P(X,"^"),";"),QAQFIELD=$TR(X(1),"&!+#-@'")
"RTN","QAQAHOC3",46,0)
 . S QA=$G(QAQMENU(+QAQFIELD))
"RTN","QAQAHOC3",47,0)
 . I (QA="")!((QAQTYPE="S")&(QA'>0)) D  Q
"RTN","QAQAHOC3",48,0)
 .. W !!?3,"Corrupted ",QAQTYPE(0)," macro !! ",*7
"RTN","QAQAHOC3",49,0)
 .. R QA:QAQDTIME S QAQQUIT=1
"RTN","QAQAHOC3",50,0)
 .. Q
"RTN","QAQAHOC3",51,0)
 . S QAQOPTN(QAQTYPE,QAQSEQ,QAQFIELD)=$P(X,"^",2)
"RTN","QAQAHOC3",52,0)
 . I QAQTYPE="S" D
"RTN","QAQAHOC3",53,0)
 .. I $P(X,"^",3)'>0 S FR(QAQSEQ)=$P(X("FRTO"),"^"),TO(QAQSEQ)=$P(X("FRTO"),"^",2) Q
"RTN","QAQAHOC3",54,0)
 .. W !!?3,"Sort by: ",$P(QAQMENU(QAQFIELD),"^",2)
"RTN","QAQAHOC3",55,0)
 .. S QAQDIR(0)=$P(QAQMENU(QAQFIELD),"^",4,99) D ^QAQAHOC2
"RTN","QAQAHOC3",56,0)
 .. Q
"RTN","QAQAHOC3",57,0)
 . S QAQSEQ=QAQSEQ+1
"RTN","QAQAHOC3",58,0)
 I QAQQUIT!QAQNEXT D  Q
"RTN","QAQAHOC3",59,0)
 . S (QAQQUIT,QAQNEXT,QAQMLOAD)=0,QAQSEQ=1 K QAQCHOSN,QAQOPTN(QAQTYPE)
"RTN","QAQAHOC3",60,0)
 . I QAQTYPE="S" K QAQBEGIN,QAQEND
"RTN","QAQAHOC3",61,0)
 . Q
"RTN","QAQAHOC3",62,0)
 S QAQMACRO(QAQTYPE)=QAQTEMP(QAQTYPE)
"RTN","QAQAHOC3",63,0)
 Q
"RTN","QAQAHOC3",64,0)
INQUIRE ; *** Inquire a sort/print macro
"RTN","QAQAHOC3",65,0)
 K DIC S DIC(0)="AEMNQZ",DIC("A")="Inquire" D ASKMAC Q:Y'>0
"RTN","QAQAHOC3",66,0)
INQ2 ;entry point from DISPMAC
"RTN","QAQAHOC3",67,0)
 K QAQUNDL S $P(QAQUNDL,"_",81)="",QAQORDER=0
"RTN","QAQAHOC3",68,0)
 S X=QAQTYPE(1)_" macro: "_QAQTEMP W !!,X,!,$E(QAQUNDL,1,$L(X))
"RTN","QAQAHOC3",69,0)
 F QAQD1=0:0 S QAQD1=$O(^QA(740.1,QAQD0,"FLD",QAQD1)) Q:QAQD1'>0  D
"RTN","QAQAHOC3",70,0)
 . S QA=^QA(740.1,QAQD0,"FLD",QAQD1,0),QAQ=$G(^("FRTO"))
"RTN","QAQAHOC3",71,0)
 . S QAQORDER=QAQORDER+1,X(1)=$P(QA,"^"),QAQFIELD=$P(X(1),";")
"RTN","QAQAHOC3",72,0)
 . S QAQFIELD=$TR(QAQFIELD,"&!+#-@'") S:QAQFIELD'?1.N QAQFIELD=0
"RTN","QAQAHOC3",73,0)
 . F QAI=1,2 S X(QAI+1)=$S(QAQTYPE="P":"",$P(QA,"^",3):"Ask User",$P(QAQ,"^",QAI)]"":$P(QAQ,"^",QAI),QAI=1:"Beginning",1:"Ending")
"RTN","QAQAHOC3",74,0)
 . D PS1^QAQAHOC4:QAQTYPE="S",PP1^QAQAHOC4:QAQTYPE="P"
"RTN","QAQAHOC3",75,0)
 . Q
"RTN","QAQAHOC3",76,0)
 R !,QA:(2*QAQDTIME)
"RTN","QAQAHOC3",77,0)
 Q
"RTN","QAQAHOC3",78,0)
DELETE ; *** Delete a sort/print macro
"RTN","QAQAHOC3",79,0)
 K DIC S DIC(0)="AEMNQZ",DIC("A")="Delete" D ASKMAC Q:Y'>0
"RTN","QAQAHOC3",80,0)
DEL W !!?3,"Delete ",QAQTEMP,", are you sure" S %=2 D YN^DICN I '% W !!?5,QAQYESNO G DEL
"RTN","QAQAHOC3",81,0)
 I %=1 S DIK="^QA(740.1,",DA=QAQD0 D ^DIK
"RTN","QAQAHOC3",82,0)
 Q
"RTN","QAQAHOC3",83,0)
ASKMAC ; *** Prompt user for the name of a sort/print macro
"RTN","QAQAHOC3",84,0)
 S DIC="^QA(740.1,",DIC("A")="   "_DIC("A")_" "_QAQTYPE(0)_" macro name: ",DLAYGO=740.1
"RTN","QAQAHOC3",85,0)
 S DIC("S")="I $P(^(0),""^"",2,3)="""_$TR(QAQTYPE,"SP","sp")_"^"_QAQDIC_""""
"RTN","QAQAHOC3",86,0)
 W ! D ^DIC
"RTN","QAQAHOC3",87,0)
 I Y>0 S QAQD0=+Y,QAQTEMP=Y(0,0),QAQTEMP(QAQTYPE)=Y
"RTN","QAQAHOC3",88,0)
 I Y>0 I "^I^D^O^"[QAQSELOP Q
"RTN","QAQAHOC3",89,0)
 I Y>0 I $P(^QA(740.1,+Y,0),U,4)=QAQCHKSM Q  ;S QAQD0=+Y,QAQTEMP=Y(0,0),QAQTEMP(QAQTYPE)=Y Q
"RTN","QAQAHOC3",90,0)
 I Y>0 I $P(^QA(740.1,+Y,0),U,4)'=QAQCHKSM D
"RTN","QAQAHOC3",91,0)
 . ;if the menu for the ad hoc report has been altered, the old checksum
"RTN","QAQAHOC3",92,0)
 . ;values in file 740.1 will not be the same as those calculated at
"RTN","QAQAHOC3",93,0)
 . ;the beginning of ^QAQAHOC0.
"RTN","QAQAHOC3",94,0)
 . I $P(^QA(740.1,+Y,0),U,4)']""!($G(QAQMSAVE)=1) Q  ;S QAQD0=+Y,QAQTEMP=Y(0,0),QAQTEMP(QAQTYPE)=Y Q
"RTN","QAQAHOC3",95,0)
 . N DIRUT
"RTN","QAQAHOC3",96,0)
 . S DIR(0)="YAO"
"RTN","QAQAHOC3",97,0)
 . S DIR("A")="This macro is not current, would you like to review it? "
"RTN","QAQAHOC3",98,0)
 . S DIR("B")="YES"
"RTN","QAQAHOC3",99,0)
 . S DIR("?")="Enter 'Y' if you want to review this macro now."
"RTN","QAQAHOC3",100,0)
 . D ^DIR I Y=0!($D(DIRUT)) S Y=0 Q
"RTN","QAQAHOC3",101,0)
 . I Y=1 D DISPMAC
"RTN","QAQAHOC3",102,0)
 . Q
"RTN","QAQAHOC3",103,0)
 ;I Y'>0 Q
"RTN","QAQAHOC3",104,0)
 Q
"RTN","QAQAHOC3",105,0)
DISPMAC ;if user wants to review macro, display existing macro,
"RTN","QAQAHOC3",106,0)
 ; allow user to say it's okay, then update the checksum value
"RTN","QAQAHOC3",107,0)
 ; (set it to QAQCHKSM) or edit or start over
"RTN","QAQAHOC3",108,0)
 D INQ2
"RTN","QAQAHOC3",109,0)
 W !!
"RTN","QAQAHOC3",110,0)
 S DIR(0)="NAO^1:2"
"RTN","QAQAHOC3",111,0)
 S DIR("A")="Enter the number of your choice: "
"RTN","QAQAHOC3",112,0)
 S DIR("A",1)="Review the menu line"_$S("Pp"[QAQTYPE:" and ",1:", ")_"field name"_$S("Pp"[QAQTYPE:".",1:" and sort range.")
"RTN","QAQAHOC3",113,0)
 S DIR("A",2)="   Enter '1' if the macro displayed still reflects the desired report."
"RTN","QAQAHOC3",114,0)
 S DIR("A",3)="   Enter '2'if the macro is no longer valid."
"RTN","QAQAHOC3",115,0)
 K DIR("B")
"RTN","QAQAHOC3",116,0)
 S DIR("?",1)="Check the display of the macro.  If it is still valid enter '1'."
"RTN","QAQAHOC3",117,0)
 S DIR("?",2)="If the macro is no longer valid enter '2'."
"RTN","QAQAHOC3",118,0)
 D ^DIR K DIR
"RTN","QAQAHOC3",119,0)
 I $D(DIRUT) S Y=0 Q
"RTN","QAQAHOC3",120,0)
 I Y=1 D UPDMAC
"RTN","QAQAHOC3",121,0)
 I Y=2 D EDITMAC^QAQAHOC5
"RTN","QAQAHOC3",122,0)
 Q
"RTN","QAQAHOC3",123,0)
UPDMAC ;ask user if want to update the macro, if yes, set piece 4 of the
"RTN","QAQAHOC3",124,0)
 ;macro's zero node to QAQCHKSM and check piece 2 of the "FLD" zero node
"RTN","QAQAHOC3",125,0)
 N QAQEE,QAQFLD
"RTN","QAQAHOC3",126,0)
 S DIR(0)="YOA"
"RTN","QAQAHOC3",127,0)
 S DIR("A")="Are you ready to update the "_QAQTEMP_" macro? "
"RTN","QAQAHOC3",128,0)
 S DIR("B")="YES"
"RTN","QAQAHOC3",129,0)
 S DIR=("?")="Enter 'Y' if the macro is valid and ready for updating."
"RTN","QAQAHOC3",130,0)
 D ^DIR K DIR
"RTN","QAQAHOC3",131,0)
 I $D(DIRUT)!(Y'=1) S Y=0 W !!,"Macro '"_QAQTEMP_"' not updated.",!! R X:5 Q
"RTN","QAQAHOC3",132,0)
 S $P(^QA(740.1,QAQD0,0),U,4)=QAQCHKSM ;update the checksum
"RTN","QAQAHOC3",133,0)
 ;then update the macro for field, sub-field settings
"RTN","QAQAHOC3",134,0)
 S QAQEE=0
"RTN","QAQAHOC3",135,0)
 F  S QAQEE=$O(^QA(740.1,QAQD0,"FLD",QAQEE)) Q:QAQEE'>0  D
"RTN","QAQAHOC3",136,0)
 . S (QAQOUT,QAQPF,QAQPF1,QAQPF2,QAQPFALL,QAQPFEND,QAQPM,QAQPFQUL,QAQPM1,QAQPM2)=""
"RTN","QAQAHOC3",137,0)
 . S QAQFLD=$P($P(^QA(740.1,QAQD0,"FLD",QAQEE,0),U),";")
"RTN","QAQAHOC3",138,0)
 . I "'!@#&+-"[$E($G(QAQFLD)) D STRIP^QAQAHOC5
"RTN","QAQAHOC3",139,0)
 . ;will set several variables to compare the field setings in QAQMENU
"RTN","QAQAHOC3",140,0)
 . ;to the field settings in the macro, disregarding qualifiers
"RTN","QAQAHOC3",141,0)
 . ;QAQPF is the piece of the "FLD" node from file 740.1
"RTN","QAQAHOC3",142,0)
 . ;QAQPFEND is the format part of the field from 740.1 (2nd ";" piece)
"RTN","QAQAHOC3",143,0)
 . ;QAQPM is the is the field's piece from QAQMENU
"RTN","QAQAHOC3",144,0)
 . ;QAQPM1 is the 1st "~" piece of the "~" character in the QAQMENU line
"RTN","QAQAHOC3",145,0)
 . ;QAQPM2 is the 2nd "~ piece from QAQMENU
"RTN","QAQAHOC3",146,0)
 . ;QAQPF1 is the piece of QAQPF up to any qualifiers
"RTN","QAQAHOC3",147,0)
 . ;QAQPF2 is the piece of QAQPF after any qualifiers
"RTN","QAQAHOC3",148,0)
 . S QAQPF=$P($P(^QA(740.1,QAQD0,"FLD",QAQEE,0),U,2),";")
"RTN","QAQAHOC3",149,0)
 . S QAQPFEND=$P($P(^QA(740.1,QAQD0,"FLD",QAQEE,0),U,2),";",2,999)
"RTN","QAQAHOC3",150,0)
 . S QAQPM=$P($P(QAQMENU(QAQFLD),U,3),";")
"RTN","QAQAHOC3",151,0)
 . I $G(QAQPF)']""!($G(QAQPM)']"") S QAQOUT=1 Q
"RTN","QAQAHOC3",152,0)
 . S QAQPM1=$P(QAQPM,"~"),QAQPM2=$P(QAQPM,"~",2)
"RTN","QAQAHOC3",153,0)
 . D STRIP2^QAQAHOC5
"RTN","QAQAHOC3",154,0)
 I $G(QAQOUT)=1 W !!,"Macro incomplete, cannot update."  Q
"RTN","QAQAHOC3",155,0)
 W !!,"Macro '"_QAQTEMP_"' updated.",!!
"RTN","QAQAHOC3",156,0)
 Q
"RTN","QAQAHOC4")
0^2^B13384336
"RTN","QAQAHOC4",1,0)
QAQAHOC4 ;HISC/DAD-AD HOC REPORTS: MACRO OUTPUT ;12/30/92  11:30
"RTN","QAQAHOC4",2,0)
 ;;1.7;QM Integration Module;**2,5**;07/25/1995
"RTN","QAQAHOC4",3,0)
EN1 ; *** Set the output macro flag
"RTN","QAQAHOC4",4,0)
 S QAQMOUTP=1 W !!?3,"You will be prompted for an output",!?3,"device when you exit the ",QAQTYPE(0)," menu. ",*7
"RTN","QAQAHOC4",5,0)
 R QA:QAQDTIME
"RTN","QAQAHOC4",6,0)
 Q
"RTN","QAQAHOC4",7,0)
EN2 ; *** Print the macro report
"RTN","QAQAHOC4",8,0)
 K %ZIS,IOP S %ZIS="QM",%ZIS("A")="   Output macro to device: " W ! D ^%ZIS G:POP EXIT I $D(IO("Q")) K IO("Q") D QVAR,^%ZTLOAD G EXIT
"RTN","QAQAHOC4",9,0)
ENTSK K QAQUNDL S QAQEXIT=0,$P(QAQUNDL,"_",81)=""
"RTN","QAQAHOC4",10,0)
 U IO W:$E(IOST)="C" @IOF
"RTN","QAQAHOC4",11,0)
 W !?19,"=========================================="
"RTN","QAQAHOC4",12,0)
 W !?19,"|| AD HOC REPORT GENERATOR MACRO REPORT ||"
"RTN","QAQAHOC4",13,0)
 W !?19,"=========================================="
"RTN","QAQAHOC4",14,0)
 W !!!,"Report name: ",$E(QAQUNDL,1,67)
"RTN","QAQAHOC4",15,0)
 W !!,"Sort fields:",!,"------------"
"RTN","QAQAHOC4",16,0)
 W !!,"Macro: ",$S($D(QAQMACRO("S"))#2:$P(QAQMACRO("S"),"^",2),1:$E(QAQUNDL,1,73))
"RTN","QAQAHOC4",17,0)
 F QAQORDER=1:1:QAQMAXOP("S") S QAQFIELD=$O(QAQOPTN("S",QAQORDER,"")),X=$G(QAQOPTN("S",QAQORDER,+QAQFIELD)) D PS
"RTN","QAQAHOC4",18,0)
 D PAUSE G:QAQEXIT EXIT
"RTN","QAQAHOC4",19,0)
 W !!,"Print fields:",!,"-------------"
"RTN","QAQAHOC4",20,0)
 W !!,"Macro: ",$S($D(QAQMACRO("P"))#2:$P(QAQMACRO("P"),"^",2),1:$E(QAQUNDL,1,73))
"RTN","QAQAHOC4",21,0)
 F QAQORDER=1:1:QAQMAXOP("P") S QAQFIELD=$O(QAQOPTN("P",QAQORDER,"")),X=$G(QAQOPTN("P",QAQORDER,+QAQFIELD)) D PP
"RTN","QAQAHOC4",22,0)
 D PAUSE G:QAQEXIT EXIT
"RTN","QAQAHOC4",23,0)
 W !!,"Header: ",$E(QAQUNDL,1,72)
"RTN","QAQAHOC4",24,0)
 W !!,"Device: ",$E(QAQUNDL,1,72)
"RTN","QAQAHOC4",25,0)
 W:$E(IOST)'="C" @IOF
"RTN","QAQAHOC4",26,0)
EXIT ; *** Exit the macro report
"RTN","QAQAHOC4",27,0)
 D ^%ZISC S QAQMOUTP=0
"RTN","QAQAHOC4",28,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","QAQAHOC4",29,0)
 Q
"RTN","QAQAHOC4",30,0)
PS ; *** Print the macro sort data
"RTN","QAQAHOC4",31,0)
 S X(1)=$P(X,";"),X(1)=$TR(X(1),$TR(X(1),"+-!@'#"))_QAQFIELD_$S($P(X,";")]"":";"_$P(X,";",2,99),1:"")
"RTN","QAQAHOC4",32,0)
 S X(2)=$S($G(FR(QAQORDER))]"":FR(QAQORDER),X(1)]"":"Beginning",1:""),X(3)=$S($G(TO(QAQORDER))]"":TO(QAQORDER),X(1)]"":"Ending",1:"")
"RTN","QAQAHOC4",33,0)
 I $D(QAQMACRO("S")),X(1)]"" D
"RTN","QAQAHOC4",34,0)
 . S QAQD1=0 F QA=$L(X(1),";"):-1:1 D  Q:QAQD1
"RTN","QAQAHOC4",35,0)
 .. S QAQD1=$O(^QA(740.1,+QAQMACRO("S"),"FLD","B",$P(X(1),";",1,QA),0))
"RTN","QAQAHOC4",36,0)
 .. Q
"RTN","QAQAHOC4",37,0)
 . I QAQD1 D
"RTN","QAQAHOC4",38,0)
 .. S QA=$G(^QA(740.1,+QAQMACRO("S"),"FLD",QAQD1,0)),QAQ=$G(^("FRTO"))
"RTN","QAQAHOC4",39,0)
 .. S X(1)=$P(QA,"^")
"RTN","QAQAHOC4",40,0)
 .. F QAI=1,2 S X(QAI+1)=$S($P(QA,"^",3):"Ask User",$P(QAQ,"^",QAI)]"":$E($P(QAQ,"^",QAI),1,30),QAI=1:"Beginning",1:"Ending")
"RTN","QAQAHOC4",41,0)
 .. Q
"RTN","QAQAHOC4",42,0)
 . Q
"RTN","QAQAHOC4",43,0)
PS1 ; *** Inquire sort macro entry point
"RTN","QAQAHOC4",44,0)
 S QA=$G(QAQMENU(+QAQFIELD)),QA=$S(QA'>0:"",1:$P(QA,"^",2))
"RTN","QAQAHOC4",45,0)
 W !!?3,QAQORDER,") Field: ",$S(QA]"":QA,QAQFIELD?1.N:"*** CORRUPTED ***",1:$E(QAQUNDL,1,30))
"RTN","QAQAHOC4",46,0)
 F XX=1:1:$L(X(1)) I "'!@#&+-"[$E(X(1)) S X(1)=$E(X(1),2,999)
"RTN","QAQAHOC4",47,0)
 W !?6,"Entry: ",$S(X(1)]"":X(1),1:$E(QAQUNDL,1,30))
"RTN","QAQAHOC4",48,0)
 W !?6,"From:  ",$E($S(X(2)]"":X(2),1:QAQUNDL),1,30)
"RTN","QAQAHOC4",49,0)
 W ?46,"To: ",$E($S(X(3)]"":X(3),1:QAQUNDL),1,30)
"RTN","QAQAHOC4",50,0)
 Q
"RTN","QAQAHOC4",51,0)
PP ; *** Print the macro print data
"RTN","QAQAHOC4",52,0)
 S X(1)=$P(X,";"),X(1)=$TR(X(1),$TR(X(1),"&!+#"))_QAQFIELD_$S($P(X,";",2)]"":";"_$P(X,";",2,99),1:"")
"RTN","QAQAHOC4",53,0)
 I $D(QAQMACRO("P")),X(1)]"" D
"RTN","QAQAHOC4",54,0)
 . S QAQD1=0 F QA=$L(X(1),";"):-1:1 D  Q:QAQD1
"RTN","QAQAHOC4",55,0)
 .. S QAQD1=$O(^QA(740.1,+QAQMACRO("P"),"FLD","B",$P(X(1),";",1,QA),0))
"RTN","QAQAHOC4",56,0)
 .. Q
"RTN","QAQAHOC4",57,0)
 . I QAQD1 S X(1)=$P($G(^QA(740.1,+QAQMACRO("P"),"FLD",QAQD1,0)),"^")
"RTN","QAQAHOC4",58,0)
 . Q
"RTN","QAQAHOC4",59,0)
PP1 ; *** Inquire print macro entry point
"RTN","QAQAHOC4",60,0)
 S QA=$P($G(QAQMENU(+QAQFIELD)),"^",2)
"RTN","QAQAHOC4",61,0)
 W !!?3,QAQORDER,") Field: ",$S(QA]"":QA,QAQFIELD?1.N:"*** CORRUPTED ***",1:$E(QAQUNDL,1,30))
"RTN","QAQAHOC4",62,0)
 F XX=1:1:$L(X(1)) I "'!@#&+-"[$E(X(1)) S X(1)=$E(X(1),2,999)
"RTN","QAQAHOC4",63,0)
 W !?6,"Entry: ",$S(X(1)]"":X(1),1:$E(QAQUNDL,1,30))
"RTN","QAQAHOC4",64,0)
 Q
"RTN","QAQAHOC4",65,0)
PAUSE ; *** Pause at the end of page
"RTN","QAQAHOC4",66,0)
 I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S QAQEXIT=$S(Y'>0:1,1:0)
"RTN","QAQAHOC4",67,0)
 Q
"RTN","QAQAHOC4",68,0)
QVAR ; *** Save variables for queueing
"RTN","QAQAHOC4",69,0)
 S ZTRTN="ENTSK^QAQAHOC4",ZTDESC="Ad Hoc Report Generator Macro Report"
"RTN","QAQAHOC4",70,0)
 F QA="FR","QAQMAXOP(","QAQMENU(","QAQOPTN(","QAQTEMP","QAQMACRO(","TO" S ZTSAVE(QA)=""
"RTN","QAQAHOC4",71,0)
 Q
"RTN","QAQAHOC5")
0^3^B4639453
"RTN","QAQAHOC5",1,0)
QAQAHOC5 ;WCIOFO/ERC-Continuation of QAQAHOC3 ;7/22/98
"RTN","QAQAHOC5",2,0)
 ;;1.7;QM Integration Module;**5**;07/25/1995
"RTN","QAQAHOC5",3,0)
 ;
"RTN","QAQAHOC5",4,0)
EDITMAC ;if the macro is not valid, display message explaining that user
"RTN","QAQAHOC5",5,0)
 ;should enter the macro again, then either use the same name to
"RTN","QAQAHOC5",6,0)
 ;replace the old macro with the current, valid one, or to use a
"RTN","QAQAHOC5",7,0)
 ;new name.
"RTN","QAQAHOC5",8,0)
 W !!,"Your macro is no longer valid.  Re-enter the macro now, and"
"RTN","QAQAHOC5",9,0)
 W !,"when finished enter '[S' to save it at the prompt for the next"
"RTN","QAQAHOC5",10,0)
 W !,"field.  Enter the old macro name if you want to replace it with"
"RTN","QAQAHOC5",11,0)
 W !,"the new criteria, or enter a completely new name."
"RTN","QAQAHOC5",12,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","QAQAHOC5",13,0)
 S Y=0
"RTN","QAQAHOC5",14,0)
 Q
"RTN","QAQAHOC5",15,0)
STRIP ;if there are qualifiers on QAQFLD,strip them off
"RTN","QAQAHOC5",16,0)
 N X
"RTN","QAQAHOC5",17,0)
 S QAQFLD1=""
"RTN","QAQAHOC5",18,0)
 F X=1:1:$L(QAQFLD) I "'!@#&+-"[$E(QAQFLD) S QAQFLD1=QAQFLD1_$E(QAQFLD),QAQFLD=$E(QAQFLD,2,999)
"RTN","QAQAHOC5",19,0)
 Q
"RTN","QAQAHOC5",20,0)
STRIP2 ;if there are qualifiers on QAQPF, strip them out before comparing
"RTN","QAQAHOC5",21,0)
 ;to QAQPM
"RTN","QAQAHOC5",22,0)
 N QAQFIRST,QAQLAST,QAQLNTH,QAQPFQUL,X
"RTN","QAQAHOC5",23,0)
 S QAQPFQUL=""
"RTN","QAQAHOC5",24,0)
 S (QAQCC,QAQFIRST)=0
"RTN","QAQAHOC5",25,0)
 S QAQPFX=QAQPF
"RTN","QAQAHOC5",26,0)
 F X=1:1:$L(QAQPFX) S:"'!@#&+-"[$E(QAQPFX) QAQLNTH(X)=X,QAQPFQUL=QAQPFQUL_$E(QAQPF,X) S QAQPFX=$E(QAQPFX,2,999)
"RTN","QAQAHOC5",27,0)
 S QAQPM=$TR(QAQPM,"~")
"RTN","QAQAHOC5",28,0)
 I $G(QAQPFQUL)]"" D
"RTN","QAQAHOC5",29,0)
 . F  S QAQCC=$O(QAQLNTH(QAQCC)) Q:QAQCC'>0  S:$G(QAQFIRST)<1 QAQFIRST=QAQCC S QAQLAST=QAQCC
"RTN","QAQAHOC5",30,0)
 . I $G(QAQFIRST)>0 D
"RTN","QAQAHOC5",31,0)
 . . S QAQPF1=$E(QAQPF,1,QAQFIRST-1)
"RTN","QAQAHOC5",32,0)
 . . S QAQPF2=$E(QAQPF,QAQLAST+1,999)
"RTN","QAQAHOC5",33,0)
 . . I $G(QAQPM)'=($G(QAQPF1)_$G(QAQPF2)) S QAQPF1=$G(QAQPM1),QAQPF2=$G(QAQPM2)
"RTN","QAQAHOC5",34,0)
 . . S QAQPFALL=$G(QAQPF1)_$G(QAQPFQUL)_$G(QAQPF2)
"RTN","QAQAHOC5",35,0)
 . . I $G(QAQPFEND)]"" S QAQPFALL=$G(QAQPFALL)_";"_$G(QAQPFEND)
"RTN","QAQAHOC5",36,0)
 I $G(QAQPFQUL)']"" D
"RTN","QAQAHOC5",37,0)
 . I $G(QAQPF)'=$G(QAQPM) S QAQPF=$G(QAQPM)
"RTN","QAQAHOC5",38,0)
 . S QAQPFALL=$G(QAQPF)_$S($G(QAQPFEND)]"":";"_QAQPFEND,1:"")
"RTN","QAQAHOC5",39,0)
 S $P(^QA(740.1,QAQD0,"FLD",QAQEE,0),U,2)=$G(QAQPFALL)
"RTN","QAQAHOC5",40,0)
 Q
"VER")
8.0^21.0
**END**
**END**
