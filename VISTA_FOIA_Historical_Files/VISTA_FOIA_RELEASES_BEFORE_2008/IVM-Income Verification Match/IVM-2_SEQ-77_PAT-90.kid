Released IVM*2*90 SEQ #77
Extracted from mail message
**KIDS**:IVM*2.0*90^

**INSTALL NAME**
IVM*2.0*90
"BLD",4354,0)
IVM*2.0*90^INCOME VERIFICATION MATCH^0^3030917^y
"BLD",4354,1,0)
^^1^1^3030917^
"BLD",4354,1,1,0)
Stop uploading of LTC tests with a date and an invalid Status code.
"BLD",4354,4,0)
^9.64PA^^
"BLD",4354,"ABPKG")
n
"BLD",4354,"KRN",0)
^9.67PA^8989.52^19
"BLD",4354,"KRN",.4,0)
.4
"BLD",4354,"KRN",.401,0)
.401
"BLD",4354,"KRN",.402,0)
.402
"BLD",4354,"KRN",.403,0)
.403
"BLD",4354,"KRN",.5,0)
.5
"BLD",4354,"KRN",.84,0)
.84
"BLD",4354,"KRN",3.6,0)
3.6
"BLD",4354,"KRN",3.8,0)
3.8
"BLD",4354,"KRN",9.2,0)
9.2
"BLD",4354,"KRN",9.8,0)
9.8
"BLD",4354,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4354,"KRN",9.8,"NM",1,0)
IVMCMC^^0^B24384729
"BLD",4354,"KRN",9.8,"NM","B","IVMCMC",1)

"BLD",4354,"KRN",19,0)
19
"BLD",4354,"KRN",19.1,0)
19.1
"BLD",4354,"KRN",101,0)
101
"BLD",4354,"KRN",409.61,0)
409.61
"BLD",4354,"KRN",771,0)
771
"BLD",4354,"KRN",870,0)
870
"BLD",4354,"KRN",8989.51,0)
8989.51
"BLD",4354,"KRN",8989.52,0)
8989.52
"BLD",4354,"KRN",8994,0)
8994
"BLD",4354,"KRN","B",.4,.4)

"BLD",4354,"KRN","B",.401,.401)

"BLD",4354,"KRN","B",.402,.402)

"BLD",4354,"KRN","B",.403,.403)

"BLD",4354,"KRN","B",.5,.5)

"BLD",4354,"KRN","B",.84,.84)

"BLD",4354,"KRN","B",3.6,3.6)

"BLD",4354,"KRN","B",3.8,3.8)

"BLD",4354,"KRN","B",9.2,9.2)

"BLD",4354,"KRN","B",9.8,9.8)

"BLD",4354,"KRN","B",19,19)

"BLD",4354,"KRN","B",19.1,19.1)

"BLD",4354,"KRN","B",101,101)

"BLD",4354,"KRN","B",409.61,409.61)

"BLD",4354,"KRN","B",771,771)

"BLD",4354,"KRN","B",870,870)

"BLD",4354,"KRN","B",8989.51,8989.51)

"BLD",4354,"KRN","B",8989.52,8989.52)

"BLD",4354,"KRN","B",8994,8994)

"BLD",4354,"QUES",0)
^9.62^^
"BLD",4354,"REQB",0)
^9.611^1^1
"BLD",4354,"REQB",1,0)
IVM*2.0*51^1
"BLD",4354,"REQB","B","IVM*2.0*51",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
90^3030917
"PKG",220,22,1,"PAH",1,1,0)
^^1^1^3030917
"PKG",220,22,1,"PAH",1,1,1,0)
Stop uploading of LTC tests with a date and an invalid Status code.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMCMC")
0^1^B24384729
"RTN","IVMCMC",1,0)
IVMCMC ;ALB/SEK,BRM,GN - CHECK INCOME TEST TRANSMISSION SEGMENTS ; 9/17/03 12:54pm
"RTN","IVMCMC",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**17,34,49,51,90**;21-OCT-94
"RTN","IVMCMC",3,0)
 ;
"RTN","IVMCMC",4,0)
 ;IVM*2*90 - stop upload of LTC type 4 test when staus code not valid
"RTN","IVMCMC",5,0)
 ;
"RTN","IVMCMC",6,0)
EN ; Check segment structure of Income Test (Z10) transmission.
"RTN","IVMCMC",7,0)
 ;  Variable input:
"RTN","IVMCMC",8,0)
 ;      IVMDA  --  pointer to an incoming message line in file #772
"RTN","IVMCMC",9,0)
 ;     IVMORF  --  [optional]: set to 1 if Z10 is an ORF message
"RTN","IVMCMC",10,0)
 ;     IVMSEG  --  the MSH segment string
"RTN","IVMCMC",11,0)
 ; 
"RTN","IVMCMC",12,0)
 ;     plus the usual HL7 variables: HLDA, HLFS, HLQ, HLECH
"RTN","IVMCMC",13,0)
 ; 
"RTN","IVMCMC",14,0)
 ;  Variable output:
"RTN","IVMCMC",15,0)
 ;        DFN  --  pointer to the patient in file #2
"RTN","IVMCMC",16,0)
 ;       DGLY  --  Income Year
"RTN","IVMCMC",17,0)
 ;    IVMFLGC  --  Number of Dependent Children
"RTN","IVMCMC",18,0)
 ;    IVMMCI   --  HL7 message control id of query sent to IVM Center
"RTN","IVMCMC",19,0)
 ; 
"RTN","IVMCMC",20,0)
 ;    and the global array ^TMP($J,"IVMCM" which holds the message.
"RTN","IVMCMC",21,0)
 ;
"RTN","IVMCMC",22,0)
 N ERRMSG,DOBP,SEXP,X,Y
"RTN","IVMCMC",23,0)
 ;
"RTN","IVMCMC",24,0)
 ; - message control id from MSH segment
"RTN","IVMCMC",25,0)
 S MSGID=$P(IVMSEG,HLFS,10)
"RTN","IVMCMC",26,0)
 ;
"RTN","IVMCMC",27,0)
 ; - if query response (ORF), do additional edit checks
"RTN","IVMCMC",28,0)
 I $G(IVMORF) D ADDL I $D(HLERR) G ENQ
"RTN","IVMCMC",29,0)
 ;
"RTN","IVMCMC",30,0)
 ; - check the PID segment and get a match on patient
"RTN","IVMCMC",31,0)
 D GET("PIDV") I IVMSEG1'="PID" D PROB("Missing PID segment") G ENQ
"RTN","IVMCMC",32,0)
 S DOBP=$P(IVMSEG,HLFS,8),SEXP=$P(IVMSEG,HLFS,9)
"RTN","IVMCMC",33,0)
 I SEXP'="F"&(SEXP'="M") D PROB("Incorrect value for Sex") G ENQ
"RTN","IVMCMC",34,0)
 S X=$$FMDATE^HLFNC(DOBP),%DT=X D ^%DT I Y<0 D PROB("Invalid Date of Birth") G ENQ
"RTN","IVMCMC",35,0)
 S DFN=$$LOOKUP^IVMUFNC($P(IVMSEG,HLFS,20),Y,SEXP,.ERRMSG)
"RTN","IVMCMC",36,0)
 I 'DFN D PROB(ERRMSG) G ENQ
"RTN","IVMCMC",37,0)
 ;
"RTN","IVMCMC",38,0)
 ; - check for veteran's ZIC and ZIR segments
"RTN","IVMCMC",39,0)
 D GET("ZICV") I IVMSEG1'="ZIC" D PROB("Missing veteran's ZIC segment") G ENQ
"RTN","IVMCMC",40,0)
 S DGLY=$$FMDATE^HLFNC($P(IVMSEG,"^",3)) ; income year
"RTN","IVMCMC",41,0)
 I 'DGLY D PROB("Missing veteran's Income Year") G ENQ
"RTN","IVMCMC",42,0)
 D GET("ZIRV") I IVMSEG1'="ZIR" D PROB("Missing veteran's ZIR segment") G ENQ
"RTN","IVMCMC",43,0)
 ;
"RTN","IVMCMC",44,0)
 ; - check for spouse's ZDP, ZIC, ZIR segments
"RTN","IVMCMC",45,0)
 D GET("ZDPS") I IVMSEG1'="ZDP" D PROB("Missing spouse's ZDP segment") G ENQ
"RTN","IVMCMC",46,0)
 D GET("ZICS") I IVMSEG1'="ZIC" D PROB("Missing spouse's ZIC segment") G ENQ
"RTN","IVMCMC",47,0)
 D GET("ZIRS") I IVMSEG1'="ZIR" D PROB("Missing spouse's ZIR segment") G ENQ
"RTN","IVMCMC",48,0)
 ;
"RTN","IVMCMC",49,0)
 ; - check for dependent children's ZDP, ZIC, ZIR segments and ZMT segment
"RTN","IVMCMC",50,0)
 S IVMFLGC=0
"RTN","IVMCMC",51,0)
 F IVMNBR=1:1 D  I $D(HLERR)!(IVMSEG1="ZMT") Q
"RTN","IVMCMC",52,0)
 .D GET("ZDPC",IVMNBR) I IVMSEG1'="ZDP",IVMSEG1'="ZMT" D PROB("Missing child's ZDP segment or ZMT segment") Q
"RTN","IVMCMC",53,0)
 .I IVMSEG1="ZMT" Q
"RTN","IVMCMC",54,0)
 .I $P(IVMSEG,"^",2)=""!($P(IVMSEG,"^",3)="")!($P(IVMSEG,"^",4)="") D PROB("Missing child data from ZDP segment") Q
"RTN","IVMCMC",55,0)
 .D GET("ZICC",IVMNBR) I IVMSEG1'="ZIC" D PROB("Missing child's ZIC segment") Q
"RTN","IVMCMC",56,0)
 .D GET("ZIRC",IVMNBR) I IVMSEG1'="ZIR" D PROB("Missing child's ZIR segment") Q
"RTN","IVMCMC",57,0)
 .S IVMFLGC=IVMFLGC+1 ; # of children
"RTN","IVMCMC",58,0)
 ;
"RTN","IVMCMC",59,0)
 I $D(HLERR) G ENQ
"RTN","IVMCMC",60,0)
 ;
"RTN","IVMCMC",61,0)
 ; - check for remaining ZMT and ZBT segments
"RTN","IVMCMC",62,0)
 D GET("ZMT2") I IVMSEG1'="ZMT" D PROB("Missing Copay Test ZMT segment") G ENQ
"RTN","IVMCMC",63,0)
 ;
"RTN","IVMCMC",64,0)
 ; ** added ZMT4 lines for LTC phase II (IVM*2*49)
"RTN","IVMCMC",65,0)
 ; uncomment after all sites have installed to enable consistency chk
"RTN","IVMCMC",66,0)
 D GET("ZMT4") I IVMSEG1'="ZMT" D PROB("Missing LTC Test ZMT segment") G ENQ
"RTN","IVMCMC",67,0)
 ;
"RTN","IVMCMC",68,0)
 ; remove next line after all sites have installed
"RTN","IVMCMC",69,0)
 ;D GET("ZMT4") I IVMSEG1'="ZMT" K ^TMP($J,"IVMCM","ZMT4") S IVMDA=IVMDA-1
"RTN","IVMCMC",70,0)
 ;
"RTN","IVMCMC",71,0)
 D GET("ZBT") I IVMSEG1'="ZBT" D PROB("Missing Beneficiary Travel ZBT segment") G ENQ
"RTN","IVMCMC",72,0)
 ;
"RTN","IVMCMC",73,0)
ENQ I IVMSEG1="MSH" S IVMDA=IVMDA-1,HLERR="",IVMTYPE=5
"RTN","IVMCMC",74,0)
 K IVMSEG1,IVMNBR
"RTN","IVMCMC",75,0)
 Q
"RTN","IVMCMC",76,0)
 ;
"RTN","IVMCMC",77,0)
 ;
"RTN","IVMCMC",78,0)
GET(SEG,NUM) ; Get the next HL7 segment.
"RTN","IVMCMC",79,0)
 ;  Formal input:
"RTN","IVMCMC",80,0)
 ;        SEG  --  String with which to build ^TMP($J,"IVMCM"
"RTN","IVMCMC",81,0)
 ;        NUM  --  Number to index child dependent strings [optional]
"RTN","IVMCMC",82,0)
 ;  Required variable input:
"RTN","IVMCMC",83,0)
 ;       HLDA  --  Pointer to the incoming message in file #772
"RTN","IVMCMC",84,0)
 ;      IVMDA  --  Pointer to the next message line within file #772
"RTN","IVMCMC",85,0)
 S IVMDA=$O(^TMP($J,IVMRTN,+IVMDA)),IVMSEG=$G(^(+IVMDA,0))
"RTN","IVMCMC",86,0)
 S IVMSEG1=$E(IVMSEG,1,3)
"RTN","IVMCMC",87,0)
 I $G(SEG)="" G GETQ
"RTN","IVMCMC",88,0)
 I $G(NUM),IVMSEG1'="ZMT" S ^TMP($J,"IVMCM",SEG,NUM)=$P(IVMSEG,HLFS,2,99) G GETQ
"RTN","IVMCMC",89,0)
 I IVMSEG1="ZMT",$E(SEG,1,3)'="ZMT" S SEG="ZMT1"
"RTN","IVMCMC",90,0)
 ;
"RTN","IVMCMC",91,0)
 ;IVM*2*90   don't allow upload of LTC with a date & a bad status code
"RTN","IVMCMC",92,0)
 I SEG="ZMT4",$P(IVMSEG,HLFS,3),$P(IVMSEG,HLFS,4)'=0,$P(IVMSEG,HLFS,4)'=1,$P(IVMSEG,HLFS,4)'="""""" Q
"RTN","IVMCMC",93,0)
 ;
"RTN","IVMCMC",94,0)
 S ^TMP($J,"IVMCM",SEG)=$P(IVMSEG,HLFS,2,99)
"RTN","IVMCMC",95,0)
GETQ Q
"RTN","IVMCMC",96,0)
 ;
"RTN","IVMCMC",97,0)
PROB(ERR) ; Process encountered errors.
"RTN","IVMCMC",98,0)
 ;  Input:  ERR  --  Error text
"RTN","IVMCMC",99,0)
 S HLERR=ERR
"RTN","IVMCMC",100,0)
 D ACK^IVMPREC
"RTN","IVMCMC",101,0)
 Q
"RTN","IVMCMC",102,0)
 ;
"RTN","IVMCMC",103,0)
ADDL ; Perform additional segment checks for ORF messages.
"RTN","IVMCMC",104,0)
 ;
"RTN","IVMCMC",105,0)
 N DOB,ERRMSG,IVMMSA,IVMPAT,IVMQRD,IVMQRF,QARRAY,QRYIEN,SEX,SSN
"RTN","IVMCMC",106,0)
 ;
"RTN","IVMCMC",107,0)
 ; edit checks for MSA, QRD, and QRF segments
"RTN","IVMCMC",108,0)
 D GET("") I IVMSEG1'="MSA" D PROB("Missing required MSA segment") G ADDLQ
"RTN","IVMCMC",109,0)
 S IVMMCI=$P(IVMSEG,"^",3) ; msg control id of msg being acknowledged
"RTN","IVMCMC",110,0)
 S IVMMSA=IVMSEG
"RTN","IVMCMC",111,0)
 ; trace reply back to the original query msg
"RTN","IVMCMC",112,0)
 S QRYIEN=$$FINDMSG^IVMCQ2(IVMMCI)
"RTN","IVMCMC",113,0)
 I 'QRYIEN D PROB("Query not found") G ADDLQ
"RTN","IVMCMC",114,0)
 I QRYIEN,'$$GET^IVMCQ2(QRYIEN,.QARRAY) D PROB("Query not found") G ADDLQ
"RTN","IVMCMC",115,0)
 S DFN=QARRAY("DFN")
"RTN","IVMCMC",116,0)
 ;
"RTN","IVMCMC",117,0)
 D GET("") I IVMSEG1'="QRD" D PROB("Missing required QRD segment") G ADDLQ
"RTN","IVMCMC",118,0)
 S IVMQRD=IVMSEG
"RTN","IVMCMC",119,0)
 S SSN=$P(IVMQRD,HLFS,9)
"RTN","IVMCMC",120,0)
 ;
"RTN","IVMCMC",121,0)
 D GET("") I IVMSEG1'="QRF" D PROB("Missing required QRF segment") G ADDLQ
"RTN","IVMCMC",122,0)
 S IVMQRF=IVMSEG
"RTN","IVMCMC",123,0)
 S DOB=$$FMDATE^HLFNC($P(IVMQRF,HLFS,5))
"RTN","IVMCMC",124,0)
 S SEX=$P(IVMQRF,HLFS,6)
"RTN","IVMCMC",125,0)
 ;
"RTN","IVMCMC",126,0)
 ;
"RTN","IVMCMC",127,0)
 ; if application reject rec'd from HEC (i.e. No income data on file)
"RTN","IVMCMC",128,0)
 I $P(IVMMSA,HLFS,2)="AR" D
"RTN","IVMCMC",129,0)
 .S HLERR=""
"RTN","IVMCMC",130,0)
 .S IVMTYPE=7  ;type 4 is now used for LTC test (IVM*2*49)
"RTN","IVMCMC",131,0)
 .; - if patient identifiers rec'd from HEC incorrect, 
"RTN","IVMCMC",132,0)
 .;   queue off job to send a new query
"RTN","IVMCMC",133,0)
 .I $$GETPAT^IVMUFNC(DFN,.IVMPAT),((SSN'=IVMPAT("SSN"))!(DOB'=IVMPAT("DOB"))!(SEX'=IVMPAT("SEX"))) D QRYQUE^IVMCQ2(DFN)
"RTN","IVMCMC",134,0)
 ;
"RTN","IVMCMC",135,0)
ADDLQ Q
"VER")
8.0^22
**END**
**END**
