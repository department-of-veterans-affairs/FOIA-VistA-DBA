Released SR*3*127 SEQ #127
Extracted from mail message
**KIDS**:SR*3.0*127^

**INSTALL NAME**
SR*3.0*127
"BLD",4790,0)
SR*3.0*127^SURGERY^0^3040730^y
"BLD",4790,1,0)
^^27^27^3040512^
"BLD",4790,1,1,0)
Office of Information Assurance, Office of Information, Veterans Health
"BLD",4790,1,2,0)
Administration (VHA), requested modifications to the VHA Information
"BLD",4790,1,3,0)
Systems and Technical Architecture (VistA) Patient Information Management
"BLD",4790,1,4,0)
System (PIMS) package that would allow for the use of multiple versions of
"BLD",4790,1,5,0)
the code sets employed in financial transactions. This work was completed
"BLD",4790,1,6,0)
in 2003 in the Code Set Versioning (CSV) project that was deployed in
"BLD",4790,1,7,0)
October of 2003. CSV included the Health Information Portability and
"BLD",4790,1,8,0)
Accessibility Act (HIPAA) stipulation that diagnosis and procedure codes
"BLD",4790,1,9,0)
used for billing purposes must be the codes that were applicable at the
"BLD",4790,1,10,0)
time service was provided. Four code sets, (ICD-9-CM, CPT, CPT modifiers,
"BLD",4790,1,11,0)
DRG) for this project were modified as required under HIPAA legislation to
"BLD",4790,1,12,0)
be date-sensitive under the first phase of the project.
"BLD",4790,1,13,0)
 
"BLD",4790,1,14,0)
At the time that CSV was developed, a request was made to defer
"BLD",4790,1,15,0)
applicable text versioning to the next iteration. This deferment of the
"BLD",4790,1,16,0)
short and long-text versions from the CSV project makes up the scope of
"BLD",4790,1,17,0)
this Code Text Descriptor (CTD) project. This follow-up project, CTD,
"BLD",4790,1,18,0)
intends to add the functionality of date-sensitive versioning
"BLD",4790,1,19,0)
for all applicable code text descriptors for the four code sets, effective
"BLD",4790,1,20,0)
with all textual changes occurring since October 1, 2002.
"BLD",4790,1,21,0)
 
"BLD",4790,1,22,0)
This patch addresses the changes done within the Surgery V. 3.0 software
"BLD",4790,1,23,0)
in compliance with the CTD project.
"BLD",4790,1,24,0)
 
"BLD",4790,1,25,0)
The only noticeable difference users may see will occur when a specific
"BLD",4790,1,26,0)
CPT, CPT modifier or ICD9 code descriptor changes base on the date of
"BLD",4790,1,27,0)
operation for the case.
"BLD",4790,4,0)
^9.64PA^^0
"BLD",4790,"KRN",0)
^9.67PA^8989.52^19
"BLD",4790,"KRN",.4,0)
.4
"BLD",4790,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4790,"KRN",.401,0)
.401
"BLD",4790,"KRN",.402,0)
.402
"BLD",4790,"KRN",.403,0)
.403
"BLD",4790,"KRN",.5,0)
.5
"BLD",4790,"KRN",.84,0)
.84
"BLD",4790,"KRN",3.6,0)
3.6
"BLD",4790,"KRN",3.8,0)
3.8
"BLD",4790,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",4790,"KRN",9.2,0)
9.2
"BLD",4790,"KRN",9.8,0)
9.8
"BLD",4790,"KRN",9.8,"NM",0)
^9.68A^40^32
"BLD",4790,"KRN",9.8,"NM",1,0)
SRHLUO^^0^B25491414
"BLD",4790,"KRN",9.8,"NM",2,0)
SRHLUO1^^0^B22777639
"BLD",4790,"KRN",9.8,"NM",3,0)
SRHLUO2^^0^B3872359
"BLD",4790,"KRN",9.8,"NM",4,0)
SRHLUO3^^0^B23683176
"BLD",4790,"KRN",9.8,"NM",5,0)
SRHLVUO^^0^B24398625
"BLD",4790,"KRN",9.8,"NM",6,0)
SRHLVUO1^^0^B23278123
"BLD",4790,"KRN",9.8,"NM",7,0)
SRHLVUO2^^0^B3906684
"BLD",4790,"KRN",9.8,"NM",14,0)
SROACMP^^0^B24648694
"BLD",4790,"KRN",9.8,"NM",16,0)
SROAOSET^^0^B3998437
"BLD",4790,"KRN",9.8,"NM",17,0)
SROAPRT6^^0^B6227160
"BLD",4790,"KRN",9.8,"NM",18,0)
SROAR1^^0^B16973018
"BLD",4790,"KRN",9.8,"NM",19,0)
SROAR2^^0^B14923181
"BLD",4790,"KRN",9.8,"NM",21,0)
SROCPT^^0^B12587576
"BLD",4790,"KRN",9.8,"NM",22,0)
SROESAD1^^0^B34222417
"BLD",4790,"KRN",9.8,"NM",23,0)
SROESNR2^^0^B34159372
"BLD",4790,"KRN",9.8,"NM",24,0)
SROGMTS^^0^B49968701
"BLD",4790,"KRN",9.8,"NM",25,0)
SROICD^^0^B818894
"BLD",4790,"KRN",9.8,"NM",26,0)
SROMOD^^0^B37665201
"BLD",4790,"KRN",9.8,"NM",27,0)
SRONAN1^^0^B9876666
"BLD",4790,"KRN",9.8,"NM",28,0)
SROPCE0A^^0^B45156648
"BLD",4790,"KRN",9.8,"NM",29,0)
SROVER1^^0^B13229258
"BLD",4790,"KRN",9.8,"NM",30,0)
SROVER2^^0^B24130199
"BLD",4790,"KRN",9.8,"NM",31,0)
SROVER3^^0^B21866458
"BLD",4790,"KRN",9.8,"NM",32,0)
SRSCOR^^0^B14585410
"BLD",4790,"KRN",9.8,"NM",33,0)
SROACC^^0^B25143542
"BLD",4790,"KRN",9.8,"NM",34,0)
SROACC1^^0^B15386801
"BLD",4790,"KRN",9.8,"NM",35,0)
SROACC2^^0^B14349621
"BLD",4790,"KRN",9.8,"NM",36,0)
SROACC3^^0^B14708328
"BLD",4790,"KRN",9.8,"NM",37,0)
SROACC4^^0^B13498785
"BLD",4790,"KRN",9.8,"NM",38,0)
SROACC5^^0^B15888183
"BLD",4790,"KRN",9.8,"NM",39,0)
SROACC6^^0^B12947968
"BLD",4790,"KRN",9.8,"NM",40,0)
SROACCM^^0^B7913619
"BLD",4790,"KRN",9.8,"NM","B","SRHLUO",1)

"BLD",4790,"KRN",9.8,"NM","B","SRHLUO1",2)

"BLD",4790,"KRN",9.8,"NM","B","SRHLUO2",3)

"BLD",4790,"KRN",9.8,"NM","B","SRHLUO3",4)

"BLD",4790,"KRN",9.8,"NM","B","SRHLVUO",5)

"BLD",4790,"KRN",9.8,"NM","B","SRHLVUO1",6)

"BLD",4790,"KRN",9.8,"NM","B","SRHLVUO2",7)

"BLD",4790,"KRN",9.8,"NM","B","SROACC",33)

"BLD",4790,"KRN",9.8,"NM","B","SROACC1",34)

"BLD",4790,"KRN",9.8,"NM","B","SROACC2",35)

"BLD",4790,"KRN",9.8,"NM","B","SROACC3",36)

"BLD",4790,"KRN",9.8,"NM","B","SROACC4",37)

"BLD",4790,"KRN",9.8,"NM","B","SROACC5",38)

"BLD",4790,"KRN",9.8,"NM","B","SROACC6",39)

"BLD",4790,"KRN",9.8,"NM","B","SROACCM",40)

"BLD",4790,"KRN",9.8,"NM","B","SROACMP",14)

"BLD",4790,"KRN",9.8,"NM","B","SROAOSET",16)

"BLD",4790,"KRN",9.8,"NM","B","SROAPRT6",17)

"BLD",4790,"KRN",9.8,"NM","B","SROAR1",18)

"BLD",4790,"KRN",9.8,"NM","B","SROAR2",19)

"BLD",4790,"KRN",9.8,"NM","B","SROCPT",21)

"BLD",4790,"KRN",9.8,"NM","B","SROESAD1",22)

"BLD",4790,"KRN",9.8,"NM","B","SROESNR2",23)

"BLD",4790,"KRN",9.8,"NM","B","SROGMTS",24)

"BLD",4790,"KRN",9.8,"NM","B","SROICD",25)

"BLD",4790,"KRN",9.8,"NM","B","SROMOD",26)

"BLD",4790,"KRN",9.8,"NM","B","SRONAN1",27)

"BLD",4790,"KRN",9.8,"NM","B","SROPCE0A",28)

"BLD",4790,"KRN",9.8,"NM","B","SROVER1",29)

"BLD",4790,"KRN",9.8,"NM","B","SROVER2",30)

"BLD",4790,"KRN",9.8,"NM","B","SROVER3",31)

"BLD",4790,"KRN",9.8,"NM","B","SRSCOR",32)

"BLD",4790,"KRN",19,0)
19
"BLD",4790,"KRN",19,"NM",0)
^9.68A^^
"BLD",4790,"KRN",19.1,0)
19.1
"BLD",4790,"KRN",101,0)
101
"BLD",4790,"KRN",409.61,0)
409.61
"BLD",4790,"KRN",771,0)
771
"BLD",4790,"KRN",870,0)
870
"BLD",4790,"KRN",8989.51,0)
8989.51
"BLD",4790,"KRN",8989.52,0)
8989.52
"BLD",4790,"KRN",8994,0)
8994
"BLD",4790,"KRN","B",.4,.4)

"BLD",4790,"KRN","B",.401,.401)

"BLD",4790,"KRN","B",.402,.402)

"BLD",4790,"KRN","B",.403,.403)

"BLD",4790,"KRN","B",.5,.5)

"BLD",4790,"KRN","B",.84,.84)

"BLD",4790,"KRN","B",3.6,3.6)

"BLD",4790,"KRN","B",3.8,3.8)

"BLD",4790,"KRN","B",9.2,9.2)

"BLD",4790,"KRN","B",9.8,9.8)

"BLD",4790,"KRN","B",19,19)

"BLD",4790,"KRN","B",19.1,19.1)

"BLD",4790,"KRN","B",101,101)

"BLD",4790,"KRN","B",409.61,409.61)

"BLD",4790,"KRN","B",771,771)

"BLD",4790,"KRN","B",870,870)

"BLD",4790,"KRN","B",8989.51,8989.51)

"BLD",4790,"KRN","B",8989.52,8989.52)

"BLD",4790,"KRN","B",8994,8994)

"BLD",4790,"QUES",0)
^9.62^^
"BLD",4790,"REQB",0)
^9.611^5^4
"BLD",4790,"REQB",1,0)
SR*3.0*100^1
"BLD",4790,"REQB",3,0)
ICPT*6.0*19^1
"BLD",4790,"REQB",4,0)
ICD*18.0*12^1
"BLD",4790,"REQB",5,0)
SR*3.0*116^1
"BLD",4790,"REQB","B","ICD*18.0*12",4)

"BLD",4790,"REQB","B","ICPT*6.0*19",3)

"BLD",4790,"REQB","B","SR*3.0*100",1)

"BLD",4790,"REQB","B","SR*3.0*116",5)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
127^3040730
"PKG",167,22,1,"PAH",1,1,0)
^^27^27^3040730
"PKG",167,22,1,"PAH",1,1,1,0)
Office of Information Assurance, Office of Information, Veterans Health
"PKG",167,22,1,"PAH",1,1,2,0)
Administration (VHA), requested modifications to the VHA Information
"PKG",167,22,1,"PAH",1,1,3,0)
Systems and Technical Architecture (VistA) Patient Information Management
"PKG",167,22,1,"PAH",1,1,4,0)
System (PIMS) package that would allow for the use of multiple versions of
"PKG",167,22,1,"PAH",1,1,5,0)
the code sets employed in financial transactions. This work was completed
"PKG",167,22,1,"PAH",1,1,6,0)
in 2003 in the Code Set Versioning (CSV) project that was deployed in
"PKG",167,22,1,"PAH",1,1,7,0)
October of 2003. CSV included the Health Information Portability and
"PKG",167,22,1,"PAH",1,1,8,0)
Accessibility Act (HIPAA) stipulation that diagnosis and procedure codes
"PKG",167,22,1,"PAH",1,1,9,0)
used for billing purposes must be the codes that were applicable at the
"PKG",167,22,1,"PAH",1,1,10,0)
time service was provided. Four code sets, (ICD-9-CM, CPT, CPT modifiers,
"PKG",167,22,1,"PAH",1,1,11,0)
DRG) for this project were modified as required under HIPAA legislation to
"PKG",167,22,1,"PAH",1,1,12,0)
be date-sensitive under the first phase of the project.
"PKG",167,22,1,"PAH",1,1,13,0)
 
"PKG",167,22,1,"PAH",1,1,14,0)
At the time that CSV was developed, a request was made to defer
"PKG",167,22,1,"PAH",1,1,15,0)
applicable text versioning to the next iteration. This deferment of the
"PKG",167,22,1,"PAH",1,1,16,0)
short and long-text versions from the CSV project makes up the scope of
"PKG",167,22,1,"PAH",1,1,17,0)
this Code Text Descriptor (CTD) project. This follow-up project, CTD,
"PKG",167,22,1,"PAH",1,1,18,0)
intends to add the functionality of date-sensitive versioning
"PKG",167,22,1,"PAH",1,1,19,0)
for all applicable code text descriptors for the four code sets, effective
"PKG",167,22,1,"PAH",1,1,20,0)
with all textual changes occurring since October 1, 2002.
"PKG",167,22,1,"PAH",1,1,21,0)
 
"PKG",167,22,1,"PAH",1,1,22,0)
This patch addresses the changes done within the Surgery V. 3.0 software
"PKG",167,22,1,"PAH",1,1,23,0)
in compliance with the CTD project.
"PKG",167,22,1,"PAH",1,1,24,0)
 
"PKG",167,22,1,"PAH",1,1,25,0)
The only noticeable difference users may see will occur when a specific
"PKG",167,22,1,"PAH",1,1,26,0)
CPT, CPT modifier or ICD9 code descriptor changes base on the date of
"PKG",167,22,1,"PAH",1,1,27,0)
operation for the case.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
32
"RTN","SRHLUO")
0^1^B25491414
"RTN","SRHLUO",1,0)
SRHLUO ;B'HAM ISC/DLR - Surgery Interface Utilities for building Outgoing HL7 Segment ; [ 05/06/98   7:14 AM ]
"RTN","SRHLUO",2,0)
 ;;3.0; Surgery ;**41,127**;24 Jun 93
"RTN","SRHLUO",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLUO",4,0)
 ; ** ASSUMMED variable list
"RTN","SRHLUO",5,0)
 ; all - INIT^HLTRANS
"RTN","SRHLUO",6,0)
 ; DFN - IEN file #2
"RTN","SRHLUO",7,0)
 ; SRI - incremental variable ^TMP("HLS",$J,SRI) 
"RTN","SRHLUO",8,0)
 ;     - returns the next #
"RTN","SRHLUO",9,0)
 ; CASE- IEN (file 130) case number must be set before the call
"RTN","SRHLUO",10,0)
 ;
"RTN","SRHLUO",11,0)
AL1(SRI,SRENT) ;AL1 segment(s) - allergy information from the generic call to (GMRADPT)
"RTN","SRHLUO",12,0)
 Q:'$D(DFN)
"RTN","SRHLUO",13,0)
 S X="GMRADPT" X ^%ZOSF("TEST") Q:'$T
"RTN","SRHLUO",14,0)
 N TYPE,X,AL1,CNT
"RTN","SRHLUO",15,0)
 ;Allergy package valid entry point returns GMRAL(x)
"RTN","SRHLUO",16,0)
 D ^GMRADPT
"RTN","SRHLUO",17,0)
 S CNT=1
"RTN","SRHLUO",18,0)
 F X=0:0 S X=$O(GMRAL(X)) Q:X'>0  D
"RTN","SRHLUO",19,0)
 .S TYPE=$P(GMRAL(X),"^",3),AL1(X)="AL1"_HL("FS")_$E("0000",$L(CNT)+1,4)_CNT_HL("FS")_$S(TYPE="D":"DA",TYPE="F":"FA",TYPE="O":"MA",1:"")_HL("FS")_HLCOMP_$P(GMRAL(X),"^",2)
"RTN","SRHLUO",20,0)
 .S ^TMP(SRENT,$J,SRI)=AL1(X),SRI=SRI+1,CNT=CNT+1
"RTN","SRHLUO",21,0)
 K GMRAL
"RTN","SRHLUO",22,0)
 Q
"RTN","SRHLUO",23,0)
DG1(SRI,SRENT) ;DG1 segment(s) - surgery diagnosis information
"RTN","SRHLUO",24,0)
 Q:'$D(CASE)
"RTN","SRHLUO",25,0)
 N DG1,I9,X,X1
"RTN","SRHLUO",26,0)
 I $D(^SRF(CASE,34)) I $P(^SRF(CASE,34),U,2)'="" D
"RTN","SRHLUO",27,0)
 .S I9=$$ICDDX^ICDCODE($P(^SRF(CASE,34),U,2),$P($G(^SRF(CASE,0)),"^",9))
"RTN","SRHLUO",28,0)
 .S DG1="DG1"_HL("FS")_"0001"_HL("FS")_"I9"_HL("FS")_$P(I9,U,2)_HL("FS")_$P(I9,U,4)_HL("FS")_HL("FS")_"P" D
"RTN","SRHLUO",29,0)
 ..S ^TMP("HLS",$J,SRI)=DG1,SRI=SRI+1,DG1=""
"RTN","SRHLUO",30,0)
 I $D(^SRF(CASE,33)) I $P(^SRF(CASE,33),U)'="" S DG1="DG1"_HL("FS")_"0001"_HL("FS")_"I9"_HL("FS")_HL("FS")_$P(^SRF(CASE,33),U)_HL("FS")_HL("FS")_"PR" D
"RTN","SRHLUO",31,0)
 .S ^TMP("HLS",$J,SRI)=DG1,SRI=SRI+1,DG1=""
"RTN","SRHLUO",32,0)
 I $D(^SRF(CASE,14,0)) S X1=2 F X=0:0 S X=$O(^SRF(CASE,14,X)) Q:X'>0  D
"RTN","SRHLUO",33,0)
 .I $P(^(0),U,3) S I9=$$ICDDX^ICDCODE($P(^SRF(CASE,14,0),U,3),$P($G(^SRF(CASE,0)),"^",9)) D
"RTN","SRHLUO",34,0)
 ..S ^TMP("HLS",$J,SRI)="DG1"_HL("FS")_$E("0000",$L(X1)+1,4)_X1_HL("FS")_"I9"_HL("FS")_$P(I9,U,2)_HL("FS")_$P(I9,U,4)_HL("FS")_HL("FS")_"PR",X1=X1+1,SRI=SRI+1
"RTN","SRHLUO",35,0)
 Q
"RTN","SRHLUO",36,0)
ERR(SRI,SRERR)     ;ERR segment
"RTN","SRHLUO",37,0)
 ; SRERR = AE error code and location (segment^sequence #^field^error) 
"RTN","SRHLUO",38,0)
 S ^TMP("HLA",$J,SRI)="ERR"_HL("FS")_$G(SRERR(1))_HLCOMP_$G(SRERR(2))_HLCOMP_$G(SRERR),SRI=SRI+1
"RTN","SRHLUO",39,0)
 Q
"RTN","SRHLUO",40,0)
MSA(SRI,SRAC) ;MSA segment
"RTN","SRHLUO",41,0)
 ; SRAC = Acknowledgement code (ID)
"RTN","SRHLUO",42,0)
 ;  AA = Application Accepted (responsed with information)
"RTN","SRHLUO",43,0)
 ;  AE = Application Error (bad data send error response)
"RTN","SRHLUO",44,0)
 ;  AR = Application Reject (no data in date range ... )
"RTN","SRHLUO",45,0)
 ;
"RTN","SRHLUO",46,0)
 N MSA
"RTN","SRHLUO",47,0)
 S MSA(1)=$G(SRAC),MSA(2)=$G(HL("MID")),MSA(3)=$G(SRERR)
"RTN","SRHLUO",48,0)
 S ^TMP("HLA",$J,SRI)="MSA"_HL("FS") F XX=1:1:3 S ^TMP("HLA",$J,SRI)=$G(^TMP("HLA",$J,SRI))_$G(MSA(XX))_$S(XX=3:"",1:HL("FS"))
"RTN","SRHLUO",49,0)
 S SRI=SRI+1
"RTN","SRHLUO",50,0)
 Q
"RTN","SRHLUO",51,0)
OBX(SRI,SRENT) ;OBX segment(s)
"RTN","SRHLUO",52,0)
 ; This segment builds OBX segments for the following Preoperative data
"RTN","SRHLUO",53,0)
 ;  - vitals\measurements ^GMRVUTL routine:   
"RTN","SRHLUO",54,0)
 ;     height, weight, blood pressure, pulse rate, and temperature
"RTN","SRHLUO",55,0)
 ;  - IN\OUT-PATIENT STATUS field in File #130
"RTN","SRHLUO",56,0)
 ;  - CANCEL DATE and CANCEL REASON for cancelled and aborted cases
"RTN","SRHLUO",57,0)
 ;  - SURGICAL SPECIALTY (OR) or MEDICAL SPECIALTY (NON OR)
"RTN","SRHLUO",58,0)
 ;  - SURGEON PGY and ANES SUPERVISE CODE
"RTN","SRHLUO",59,0)
 Q:'$D(CASE)
"RTN","SRHLUO",60,0)
 N OBX,CNT,TYPE,X,Y
"RTN","SRHLUO",61,0)
 S CNT=1
"RTN","SRHLUO",62,0)
 I $D(^SRF(CASE,"NON")) S OBX(2)="CE",OBX(3)=HLCOMP_"MEDICAL SPECIALTY"_HLCOMP,OBX(5)=$P(^("NON"),U,8) I OBX(5)'="" S OBX(5)=HLCOMP_$P(^ECC(723,OBX(5),0),U)_HLCOMP_"99VA723" D SOBX
"RTN","SRHLUO",63,0)
 I $P(^SRF(CASE,0),U,4)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"SURGICAL SPECIALTY"_HLCOMP,OBX(5)=$P(^(0),U,4) I OBX(5)'="" S OBX(5)=HLCOMP_$P(^SRO(137.45,OBX(5),0),U)_HLCOMP_"99VA137.45" D SOBX
"RTN","SRHLUO",64,0)
 I $D(^SRF(CASE,200)) I $P(^SRF(CASE,200),U,52)'="" S OBX(2)="NM",OBX(3)=HLCOMP_"SURGEON PGY"_HLCOMP_"L",OBX(5)=$P(^(200),U,52) D SOBX
"RTN","SRHLUO",65,0)
 I $D(^SRF(CASE,.3)) I $P(^SRF(CASE,.3),U,6)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"ANES SUPERVISE CODE"_HLCOMP_"L",OBX(5)=$P(^(.3),U,6) D SOBX
"RTN","SRHLUO",66,0)
 I $P(^SRF(CASE,0),U,12)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"PATIENT CLASS"_HLCOMP,OBX(5)=$P(^(0),U,12) S C=$P(^DD(130,.011,0),U,2),Y=OBX(5) D Y^DIQ S OBX(5)=HLCOMP_Y_HLCOMP_"L" D SOBX
"RTN","SRHLUO",67,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I $T F TYPE="BP","HT","WT","T","P" S GMRVSTR=TYPE D EN6^GMRVUTL I $G(X)'="" S X1=$P(X,"^"),X2=60,SRX=X D C^%DTC I X'<DT D
"RTN","SRHLUO",68,0)
 .S OBX(2)="CE",OBX(5)=$P(SRX,"^",8),OBX(11)="S",OBX(14)=$$HLDATE^HLFNC($P(SRX,"^")),OBX(16)=$$HNAME^SRHLU($P(SRX,U,6))
"RTN","SRHLUO",69,0)
 .I TYPE="BP" S OBX(3)="1002"_HLCOMP_"BP",OBX(5)=$P(SRX,"^",8) D SOBX
"RTN","SRHLUO",70,0)
 .I TYPE="HT" S OBX(3)="1010.3"_HLCOMP_"Height",OBX(5)=$J(2.54*OBX(5),0,2),OBX(6)="cm" D SOBX
"RTN","SRHLUO",71,0)
 .I TYPE="WT" S OBX(3)="1010.1"_HLCOMP_"Body Weight",OBX(5)=$J(OBX(5)/2.2,0,2),OBX(6)="kg" D SOBX
"RTN","SRHLUO",72,0)
 .I TYPE="T" S OBX(3)="1000"_HLCOMP_"Temperature" S OBX(5)=$J(OBX(5)-32*5/9,0,2),OBX(6)="cel" D SOBX
"RTN","SRHLUO",73,0)
 .I TYPE="P" S OBX(3)="1006.2"_HLCOMP_"HR",OBX(6)="min" D SOBX
"RTN","SRHLUO",74,0)
 I $D(^SRF(CASE,30)),$P($G(^SRF(CASE,31)),U,8)'="" D
"RTN","SRHLUO",75,0)
 .S OBX(2)="CE",OBX(3)=HLCOMP_"CANCEL REASON"_HLCOMP_"L",OBX(5)=HLCOMP_$P(^SRO(135,$P(^SRF(CASE,31),U,8),0),U)_HLCOMP_"L",OBX(14)=$$HLDATE^HLFNC($P(^SRF(CASE,30),U)),OBX(16)=$$HNAME^SRHLU($P(^SRF(CASE,30),U,3)) D SOBX
"RTN","SRHLUO",76,0)
 Q
"RTN","SRHLUO",77,0)
SOBX ;sets the OBX segment
"RTN","SRHLUO",78,0)
 S OBX(11)="S"
"RTN","SRHLUO",79,0)
 S OBX(1)=CNT
"RTN","SRHLUO",80,0)
 S ^TMP(SRENT,$J,SRI)="OBX"_HL("FS") F XX=1:1:16 S ^TMP(SRENT,$J,SRI)=$G(^TMP(SRENT,$J,SRI))_$G(OBX(XX))_$S(XX=16:"",1:HL("FS")),OBX(XX)=""
"RTN","SRHLUO",81,0)
 S SRI=SRI+1,CNT=$G(CNT)+1
"RTN","SRHLUO",82,0)
 Q
"RTN","SRHLUO",83,0)
PID(SRI,SRENT) ;PID segment builder returns patient information
"RTN","SRHLUO",84,0)
 Q:'$D(DFN)
"RTN","SRHLUO",85,0)
 N PID
"RTN","SRHLUO",86,0)
 S ^TMP(SRENT,$J,SRI)=$$EN^VAFHLPID(DFN,"1,2,3,4,5,6,7,8,10,11,13,16,17,19",1)
"RTN","SRHLUO",87,0)
 S SRI=SRI+1
"RTN","SRHLUO",88,0)
 Q
"RTN","SRHLUO1")
0^2^B22777639
"RTN","SRHLUO1",1,0)
SRHLUO1 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 05/20/99   7:14 AM ]
"RTN","SRHLUO1",2,0)
 ;;3.0; Surgery ;**41,88,127**;24 Jun 93
"RTN","SRHLUO1",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLUO1",4,0)
 ;INIT^HLTRANS MUST BE called before calling this routine.
"RTN","SRHLUO1",5,0)
ZCH(SRI,SREVENT,SRSTATUS,SRENT) ;sets ^TMP(SRENT,$J global for sending ZCH Scheduling Appointment Information segment(s)
"RTN","SRHLUO1",6,0)
 N ADD,ADD1,ADDR,PHONE,SRJ,SRM,SRP,SRREP,SRX,XX,ZCH,SROERR
"RTN","SRHLUO1",7,0)
 S (ZCH(1),ZCH(3))=HL("Q")
"RTN","SRHLUO1",8,0)
 S ZCH(2)=CASE
"RTN","SRHLUO1",9,0)
 ;eventid^text(STATUS)^coding scheme^...
"RTN","SRHLUO1",10,0)
 S ZCH(4)=$G(SREVENT)_HLCOMP_$G(SRSTATUS)_HLCOMP_"L"
"RTN","SRHLUO1",11,0)
 I $D(^SRF(CASE,"OP")) S ZCH(5)=$P($G(^("OP")),U,2) I ZCH(5)'="" D
"RTN","SRHLUO1",12,0)
 .S SRX=$$CPT^ICPTCOD(ZCH(5),$P($G(^SRF(CASE,0)),"^",9)),ZCH(5)=$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_"C4"
"RTN","SRHLUO1",13,0)
 .S (SRJ,SRREP)=0 F  S SRJ=$O(^SRF(CASE,"OPMOD",SRJ)) Q:'SRJ  S SRP=$P(^SRF(CASE,"OPMOD",SRJ,0),U),SRM=$$MOD^ICPTMOD(SRP,"I",$P($G(^SRF(CASE,0)),U,9)) D
"RTN","SRHLUO1",14,0)
 ..S ZCH(18)=$G(ZCH(18))_$S(SRREP:HLREP,1:"")_$P(SRM,U,2)_HLCOMP_$P(SRM,U,3)_HLCOMP,SRREP=1
"RTN","SRHLUO1",15,0)
 I $G(ZCH(5))="" S ZCH(5)=HLCOMP_$P($G(^SRF(CASE,"OP")),U)
"RTN","SRHLUO1",16,0)
 I $D(^SRF(CASE,".4")) S ZCH(6)=$P($G(^(.4)),U) I ZCH(6)'="" S ZCH(6)=($P(ZCH(6),":")*60)+($P($G(ZCH(6)),":",2))_HLCOMP_"min"
"RTN","SRHLUO1",17,0)
 I $G(SRSTATUS)="(SCHEDULED)" D
"RTN","SRHLUO1",18,0)
 .S ZCH(7)=HLCOMP_HLCOMP_HLCOMP_$$HLDATE^HLFNC($P($G(^SRF(CASE,31)),U,4))_HLCOMP_$$HLDATE^HLFNC($P($G(^(31)),U,5))_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_$P($G(^SRF(CASE,0)),U,11)
"RTN","SRHLUO1",19,0)
 I $G(SRSTATUS)'="(SCHEDULED)" S ZCH(7)=HLCOMP_HLCOMP_HLCOMP_$$HLDATE^HLFNC($P(^SRF(CASE,0),U,9))_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_$P($G(^SRF(CASE,0)),U,11)
"RTN","SRHLUO1",20,0)
 I $D(^SRF(CASE,"1.0")) S ZCH(12)=$P($G(^("1.0")),U,10) I ZCH(12)'="" S ZCH(12)=$$HNAME^SRHLU($G(ZCH(12)))
"RTN","SRHLUO1",21,0)
 I $D(^SRF(CASE,"CON")) S ZCH(17)=$P($G(^("CON")),U)
"RTN","SRHLUO1",22,0)
 S ^TMP(SRENT,$J,SRI)="ZCH"_HL("FS") F XX=1:1:18 S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_$G(ZCH(XX))_$S(XX=18:"",1:HL("FS"))
"RTN","SRHLUO1",23,0)
 S SRI=SRI+1
"RTN","SRHLUO1",24,0)
 Q
"RTN","SRHLUO1",25,0)
ZIG(SRI,SRENT) ;sets ^TMP(SRENT,$J global for sending ZIG Appointment Information - General Resource Segment(s)
"RTN","SRHLUO1",26,0)
 Q:'$D(^SRF(CASE,27,0))
"RTN","SRHLUO1",27,0)
 N MON,ZIG
"RTN","SRHLUO1",28,0)
 S MON=0 F  S MON=$O(^SRF(CASE,27,MON)) Q:'MON  S ZIG=^SRF(CASE,27,MON,0) D
"RTN","SRHLUO1",29,0)
 .S ZIG(1)=$P(ZIG,U)_HLCOMP_$P($G(^SRO(133.4,$P(ZIG,U),0)),U)_HLCOMP_"99VA133.4"
"RTN","SRHLUO1",30,0)
 .S ZIG(2)=HLCOMP_"MONITOR"_HLCOMP
"RTN","SRHLUO1",31,0)
 .S ^TMP(SRENT,$J,SRI)="ZIG"_HL("FS") F XX=1:1:4 S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_$G(ZIG(XX))_$S(XX=4:"",1:HL("FS")),ZIG(XX)=""
"RTN","SRHLUO1",32,0)
 .S SRI=SRI+1
"RTN","SRHLUO1",33,0)
 Q
"RTN","SRHLUO1",34,0)
ZIL(SRI,SRENT) ;sets ^TMP(SRENT,$J global for sending ZIL Appointment Information - Location Resource Segment(s)
"RTN","SRHLUO1",35,0)
 N FAC,LOC,SRC,X,ZIL
"RTN","SRHLUO1",36,0)
 I '$P(^SRF(CASE,0),U,2),'$D(^SRF(CASE,"NON")) Q
"RTN","SRHLUO1",37,0)
 I $P(^SRF(CASE,0),U,2) S LOC=$P($G(^SRS($P(^SRF(CASE,0),U,2),0)),U) I $G(LOC)'="" S LOC=$P(^SC(LOC,0),U),FAC=$P(^(0),U,4) I $G(FAC)="" S FAC=$P($G(^SRF(CASE,8)),U)
"RTN","SRHLUO1",38,0)
 I $D(^SRF(CASE,"NON")),$P(^("NON"),U,2) S LOC=$P(^SRF(CASE,"NON"),U,2) I $G(LOC)'="" S LOC=$P(^SC(LOC,0),U),FAC=$P(^(0),U,4) I $G(FAC)="" S FAC=$P($G(^SRF(CASE,8)),U)
"RTN","SRHLUO1",39,0)
 S ZIL(1)=$G(FAC)_HLCOMP_HLCOMP_HLCOMP_$G(LOC)
"RTN","SRHLUO1",40,0)
 S ZIL(2)=HLCOMP_$S($P($G(^SRF(CASE,"NON")),U)="Y":"NON OR",1:"OPERATING ROOM")
"RTN","SRHLUO1",41,0)
 S SRC=0 D  S ZIL(6)=$S($G(SRC)=1:"PENDING",1:"CONFIRMED")
"RTN","SRHLUO1",42,0)
 .I $D(^SRF(CASE,"REQ"))&($G(SRSTATUS)="(REQUESTED)") S:^SRF(CASE,"REQ")=1&($P($G(^SRF(CASE,.2)),U,2)="") SRC=1
"RTN","SRHLUO1",43,0)
 .I SRSTATUS="(SCHEDULED)" D STAT
"RTN","SRHLUO1",44,0)
 S ^TMP(SRENT,$J,SRI)="ZIL"_HL("FS") F X=1:1:6 S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_$G(ZIL(X))_$S(X=6:"",1:HL("FS")),ZIL(X)=""
"RTN","SRHLUO1",45,0)
 S SRI=SRI+1
"RTN","SRHLUO1",46,0)
 Q
"RTN","SRHLUO1",47,0)
ZIP(SRI,SRENT) ;sets ^TMP(SRENT,$J,I) global for sending ZIP Appointment Information - Personnel Segment(s)
"RTN","SRHLUO1",48,0)
 N SRC,X,XX,ZIP
"RTN","SRHLUO1",49,0)
 I $D(^SRF(CASE,"NON")) D
"RTN","SRHLUO1",50,0)
 .I $P(^SRF(CASE,"NON"),U,6)'="" S ZIP(1)=$$HNAME^SRHLU($P(^("NON"),U,6)),ZIP(2)=HLCOMP_"PROVIDER"_HLCOMP_"99VA200" D SZIP
"RTN","SRHLUO1",51,0)
 .I $P(^SRF(CASE,"NON"),U,7)'="" S ZIP(1)=$$HNAME^SRHLU($P(^("NON"),U,7)),ZIP(2)=HLCOMP_"ATTEND PROVIDER"_HLCOMP_"99VA200" D SZIP
"RTN","SRHLUO1",52,0)
 I $D(^SRF(CASE,.1)) F X=4,5,6,13 S ZIP(1)=$P($G(^SRF(CASE,.1)),U,X) I $G(ZIP(1))'="" D
"RTN","SRHLUO1",53,0)
 .S ZIP(1)=$$HNAME^SRHLU(ZIP(1)),ZIP(2)=HLCOMP_$S(X=4:"SURGEON",X=5:"1ST ASST.",X=6:"2ND ASST.",X=13:"ATT. SURGEON",1:"")_HLCOMP_"99VA200"
"RTN","SRHLUO1",54,0)
 .D SZIP
"RTN","SRHLUO1",55,0)
 S X=0 F X=1,4 S ZIP(1)=$P($G(^SRF(CASE,.3)),U,X) I $G(ZIP(1))'="" D
"RTN","SRHLUO1",56,0)
 .S ZIP(1)=$$HNAME^SRHLU(ZIP(1)),ZIP(2)=HLCOMP_$S(X=1:"PRIN. ANES.",X=4:"ANES. SUPER.",1:"")_HLCOMP_"99VA200"
"RTN","SRHLUO1",57,0)
 .D SZIP
"RTN","SRHLUO1",58,0)
 Q
"RTN","SRHLUO1",59,0)
SZIP ;set the ZIP segment
"RTN","SRHLUO1",60,0)
 S SRC=0 D  S ZIP(6)=$S($G(SRC)=1:"PENDING",1:"CONFIRMED")
"RTN","SRHLUO1",61,0)
 .I $D(^SRF(CASE,"REQ"))&($G(SRSTATUS)="(REQUESTED)") S:^SRF(CASE,"REQ")=1&($P($G(^SRF(CASE,.2)),U,2)="") SRC=1
"RTN","SRHLUO1",62,0)
 .I SRSTATUS="(SCHEDULED)" D STAT
"RTN","SRHLUO1",63,0)
 S ^TMP(SRENT,$J,SRI)="ZIP"_HL("FS") F XX=1:1:6 S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_$G(ZIP(XX))_$S(XX=6:"",1:HL("FS")),ZIP(XX)=""
"RTN","SRHLUO1",64,0)
 S SRI=SRI+1
"RTN","SRHLUO1",65,0)
 Q
"RTN","SRHLUO1",66,0)
STAT ;check scheduled cases to scheduled close time
"RTN","SRHLUO1",67,0)
 N SRI,SRS,SRTIME,X1,X2
"RTN","SRHLUO1",68,0)
 Q:'$D(^SRF(CASE,31))
"RTN","SRHLUO1",69,0)
 S SRI=$P($G(^SRF(CASE,8)),U),SRS=$O(^SRO(133,"B",SRI,0)),SRTIME=$P(^SRO(133,SRS,0),U,12) S:SRTIME="" SRTIME=1500
"RTN","SRHLUO1",70,0)
 S X1=$E($P(^SRF(CASE,0),U,9),1,7),X2=-1,SRYN="N" D C^%DTC D  Q:X'=DT  S SRTIME=X_"."_SRTIME D NOW^%DTC I %>SRTIME S SRC=0
"RTN","SRHLUO1",71,0)
 .I X'<DT S SRC=1
"RTN","SRHLUO1",72,0)
 .I X<DT S SRC=0
"RTN","SRHLUO1",73,0)
 Q
"RTN","SRHLUO2")
0^3^B3872359
"RTN","SRHLUO2",1,0)
SRHLUO2 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 06/23/99   7:14 AM ]
"RTN","SRHLUO2",2,0)
 ;;3.0; Surgery ;**41,88,127**;24 Jun 93
"RTN","SRHLUO2",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLUO2",4,0)
ZIS(SRI,SRENT) ;sets ^TMP(SRENT,$J,I) global for sending ZIS Appointment Information - Service Segment(s)
"RTN","SRHLUO2",5,0)
 N SRJ,SRM,SRP,SRREP,SRX,X,XX,ZIS
"RTN","SRHLUO2",6,0)
 S X=0 F  S X=$O(^SRF(CASE,13,X)) Q:'X  I $G(^(X,2))'="" D
"RTN","SRHLUO2",7,0)
 .S ZIS(1)=$P(^SRF(CASE,13,X,2),U) I ZIS(1)'="" S SRX=$$CPT^ICPTCOD(ZIS(1),$P($G(^SRF(CASE,0)),"^",9)),ZIS(1)=$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_"C4",ZIS(5)=$S($P(^SRF(CASE,13,X,0),U,3)="Y":"CONFIRMED",1:"PENDING")
"RTN","SRHLUO2",8,0)
 .K ZIS(6) S (SRJ,SRREP)=0 F  S SRJ=$O(^SRF(CASE,13,X,"MOD",SRJ)) Q:'SRJ  S SRP=$P(^SRF(CASE,13,X,"MOD",SRJ,0),U),SRM=$$MOD^ICPTMOD(SRP,"I",$P($G(^SRF(CASE,0)),U,9)) D
"RTN","SRHLUO2",9,0)
 ..S ZIS(6)=$G(ZIS(6))_$S(SRREP:HLREP,1:"")_$P(SRM,U,2)_HLCOMP_$P(SRM,U,3)_HLCOMP,SRREP=1
"RTN","SRHLUO2",10,0)
 .S ^TMP(SRENT,$J,SRI)="ZIS"_HL("FS") F XX=1:1:5 S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_$G(ZIS(XX))_$S(XX=5:"",1:HL("FS"))
"RTN","SRHLUO2",11,0)
 .I $L($G(ZIS(6))) S ^TMP(SRENT,$J,SRI)=^TMP(SRENT,$J,SRI)_HL("FS")_ZIS(6)
"RTN","SRHLUO2",12,0)
 .S SRI=SRI+1
"RTN","SRHLUO2",13,0)
 Q
"RTN","SRHLUO2",14,0)
DSC(SRI) ;DSC segment - not in use at this time
"RTN","SRHLUO2",15,0)
 S ^TMP(SRENT,$J,SRI)="DSC"_HL("FS")
"RTN","SRHLUO2",16,0)
 Q
"RTN","SRHLUO3")
0^4^B23683176
"RTN","SRHLUO3",1,0)
SRHLUO3 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 05/20/99   7:14 AM ]
"RTN","SRHLUO3",2,0)
 ;;3.0; Surgery ;**41,88,127**;24 Jun 93
"RTN","SRHLUO3",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLUO3",4,0)
 ;
"RTN","SRHLUO3",5,0)
 ; Reference to ^PSDRUG supported by DBIA #221
"RTN","SRHLUO3",6,0)
 ;
"RTN","SRHLUO3",7,0)
 ;INIT^HLTRANS MUST BE called before calling this routine.
"RTN","SRHLUO3",8,0)
 ;Mandatory variables
"RTN","SRHLUO3",9,0)
 ;I    - IEN of the entry to be processed
"RTN","SRHLUO3",10,0)
 ;SRI  - next available number in ^TMP(SRENT... global
"RTN","SRHLUO3",11,0)
MFE(SRI,REC,FILE,FIELD,SRENT) ;Master File Entry segment
"RTN","SRHLUO3",12,0)
 N I,ID,SRX,SRY,X
"RTN","SRHLUO3",13,0)
 ;event point processing
"RTN","SRHLUO3",14,0)
 I $G(SRENT)'="" S I=$P(SRENT,U),ID=$P(SRENT,U,2) D SMFE
"RTN","SRHLUO3",15,0)
 ;set of codes
"RTN","SRHLUO3",16,0)
 I $G(SRENT)="",$G(FIELD)'="" S Y="",C=$P(^DD(FILE,FIELD,0),U,2) D Y^DIQ F X=2:1:$L(C,";")-1 S I=X-1,ID=$P($P(C,";",X),":",2) D SMFE
"RTN","SRHLUO3",17,0)
 ;files
"RTN","SRHLUO3",18,0)
 I $G(SRENT)="",$G(FIELD)="" D
"RTN","SRHLUO3",19,0)
 .I FILE=50 S SDT=$$FMADD^XLFDT(DT,-366) F  S SDT=$O(^SRF("AC",SDT)) Q:'SDT!(SDT>DT)  S XIEN=0 F  S XIEN=$O(^SRF("AC",SDT,XIEN)) Q:'XIEN  D
"RTN","SRHLUO3",20,0)
 ..I $D(^SRF(XIEN,22,0)) S X2=0 F  S X2=$O(^SRF(XIEN,22,X2)) Q:'X2  I $D(^(X2,0)) S I=$P(^(0),U) S ^TMP("SRHL",$J,"MED",I)=HLCOMP_$P(^PSDRUG(I,0),U)_HLCOMP
"RTN","SRHLUO3",21,0)
 ..S X2=0 F  S X2=$O(^TMP("SRHL",$J,"MED",X2)) Q:'X2  S ID=^(X2) D SMFE,ZRX
"RTN","SRHLUO3",22,0)
 ..K ^TMP("SRHL",$J,"MED")
"RTN","SRHLUO3",23,0)
 .I FILE=44 S I=0 F  S I=$O(^SC(I)) Q:'I  S ID=$P(^(I,0),U)_HLCOMP_HLCOMP D SMFE
"RTN","SRHLUO3",24,0)
 .I FILE=80 S I=0 F  S I=$O(^ICD9(I)) Q:'I  S ID=$P(^(I,0),U)_HLCOMP_HLCOMP D SMFE,ZI9
"RTN","SRHLUO3",25,0)
 .I FILE=81 S I=0 F  S I=$O(^ICPT("B",I)) Q:I=""  S ID=I_HLCOMP_HLCOMP D SMFE,ZC4
"RTN","SRHLUO3",26,0)
 .I FILE=133.4 S I=0 F  S I=$O(^SRO(133.4,I)) Q:'I  S ID=HLCOMP_$P(^(I,0),U)_HLCOMP D SMFE,ZMN
"RTN","SRHLUO3",27,0)
 .I FILE=133.7 S I=0 F  S I=$O(^SRO(133.7,I)) Q:'I  S ID=HLCOMP_$P(^(I,0),U)_HLCOMP D SMFE,ZRF
"RTN","SRHLUO3",28,0)
 .I FILE=200 S SDT=$$FMADD^XLFDT(DT,-366) F  S SDT=$O(^SRF("AC",SDT)) Q:'SDT!(SDT>DT)  S XIEN=0 F  S XIEN=$O(^SRF("AC",SDT,XIEN)) Q:'XIEN  D
"RTN","SRHLUO3",29,0)
 ..;4-surgeon,5-first asst.,6-second asst.,13-attend surgeon
"RTN","SRHLUO3",30,0)
 ..I $D(^SRF(XIEN,.1)) F XF=4,5,6,13 S I=$P(^SRF(XIEN,.1),U,XF),ROLE=$S(XF=4:"SURGEON",XF=5:"1ST ASST.",XF=6:"2ND ASST.",XF=13:"ATT. SURGEON") D:I'="" XPER
"RTN","SRHLUO3",31,0)
 ..;1-prin. anes.,2-relief anes.,3-asst. anes.,4-anes. super.
"RTN","SRHLUO3",32,0)
 ..I $D(^SRF(XIEN,.3)) F XF=1,2,3,4 S I=$P(^SRF(XIEN,.3),U,XF),ROLE=$S(XF=1:"PRIN. ANES.",XF=2:"RELIEF ANESTHETIST",XF=3:"ASSISTANT ANESTHETIST",XF=4:"ANES. SUPER.") D:I'="" XPER
"RTN","SRHLUO3",33,0)
 ..;tourniquet applied by
"RTN","SRHLUO3",34,0)
 ..I $D(^SRF(XIEN,2,0)) S X2=0 F  S X2=$O(^SRF(XIEN,2,X2)) Q:'X2  S I=$P(^(X2,0),U,3),ROLE="TOURNIQUET APPLIED BY" D:I'="" XPER
"RTN","SRHLUO3",35,0)
 ..;monitor applied by
"RTN","SRHLUO3",36,0)
 ..I $D(^SRF(XIEN,27,0)) S X2=0 F  S X2=$O(^SRF(XIEN,27,X2)) Q:'X2  S I=$P(^(X2,0),U,4),ROLE="MONITOR APPLIED BY" D:I'="" XPER
"RTN","SRHLUO3",37,0)
 ..;extubated by
"RTN","SRHLUO3",38,0)
 ..I $D(^SRF(XIEN,6,0)) S X2=0 F  S X2=$O(^SRF(XIEN,6,X2)) Q:'X2  I $D(^(X2,6)) S I=$P(^(6),U),ROLE="EXTUBATED BY" D:I'="" XPER
"RTN","SRHLUO3",39,0)
 ..;medications administered by, ordered by
"RTN","SRHLUO3",40,0)
 ..I $D(^SRF(XIEN,22,0)) S X2=0 F  S X2=$O(^SRF(XIEN,22,X2)) Q:'X2  I $D(^(X2,0)) F XF=3,4 S I=$P(^(0),U,XF),ROLE=$S(XF=3:"MEDICATION ORDERED BY",XF=4:"MEDICATION ADM BY") D:I'="" XPER
"RTN","SRHLUO3",41,0)
 .S I=0 F  S I=$O(^TMP("SRHL",$J,"PER",I)) Q:'I  S ID=^(I) D SMFE,STF
"RTN","SRHLUO3",42,0)
 .K ^TMP("SRHL",$J,"PER")
"RTN","SRHLUO3",43,0)
 Q
"RTN","SRHLUO3",44,0)
SMFE ;
"RTN","SRHLUO3",45,0)
 S ^TMP("HLS",$J,SRI)="MFE"_HL("FS")_REC_HL("FS")_I_HL("FS")_$E(DT,1,8)_HL("FS")_ID,SRI=SRI+1
"RTN","SRHLUO3",46,0)
 Q
"RTN","SRHLUO3",47,0)
MFI(SRI,ID,FEC,FILE,SRENT) ;Master File Identification segment
"RTN","SRHLUO3",48,0)
 I '$D(ID)!'$D(FEC) W !!,"Invalid Master File Identifier or Event Code.",!! Q
"RTN","SRHLUO3",49,0)
 S ^TMP("HLS",$J,SRI)="MFI"_HL("FS")_HLCOMP_ID_HLCOMP_$S(FILE=80:"I9",FILE=81:"C4",$E(FILE,1,3)'=130:"99VA"_FILE,1:"L")_HL("FS")_HL("FS")_FEC_HL("FS")_HL("FS")_HL("FS")_"AL",SRI=SRI+1
"RTN","SRHLUO3",50,0)
 Q
"RTN","SRHLUO3",51,0)
STF ;staff master file
"RTN","SRHLUO3",52,0)
 S ^TMP("HLS",$J,SRI)="STF"_HL("FS")_$P($G(^VA(200,I,1)),U,9)_HLCOMP_HLCOMP_HL("FS")_HL("FS")_$P($$HNAME^SRHLU(I),HLCOMP,2,3),SRI=SRI+1
"RTN","SRHLUO3",53,0)
 Q
"RTN","SRHLUO3",54,0)
ZI9 ;master file update to ICD-9 (File #80)
"RTN","SRHLUO3",55,0)
 S SRY=$$ICDDX^ICDCODE(I),^TMP("HLS",$J,SRI)="ZI9"_HL("FS")_$P(SRY,U,2)_HLCOMP_$P(SRY,U,4)_HLCOMP_HL("FS")_$S($P(SRY,U,10)'="":$P(SRY,U,10),1:0),SRI=SRI+1
"RTN","SRHLUO3",56,0)
 Q
"RTN","SRHLUO3",57,0)
ZC4 ;master file update to CPT-4 (File #81)
"RTN","SRHLUO3",58,0)
 S SRX=$$CPT^ICPTCOD(I),^TMP("HLS",$J,SRI)="ZC4"_HL("FS")_$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_HL("FS")_$S($P(SRX,U,7)'="":$P(SRX,U,7),1:0),SRI=SRI+1
"RTN","SRHLUO3",59,0)
 Q
"RTN","SRHLUO3",60,0)
ZRX ;master file update to MEDICATION (File #50)
"RTN","SRHLUO3",61,0)
 S ^TMP("HLS",$J,SRI)="ZRX"_HL("FS")_HLCOMP_$P(^PSDRUG(I,0),U)_HLCOMP_HL("FS")_$P($G(^("I")),U)_HL("FS")_$S($P($G(^(2)),U,3)["S":1,1:0),SRI=SRI+1
"RTN","SRHLUO3",62,0)
 Q
"RTN","SRHLUO3",63,0)
ZMN ;master file update to MONITOR (File #133.2)
"RTN","SRHLUO3",64,0)
 S ^TMP("HLS",$J,SRI)="ZMN"_HL("FS")_HLCOMP_$P(^SRO(133.4,I,0),U)_HLCOMP_HL("FS")_$S($P(^(0),U,2)'="":$P(^(0),U,2),1:0),SRI=SRI+1
"RTN","SRHLUO3",65,0)
 Q
"RTN","SRHLUO3",66,0)
ZRF ;master file update to REPLACEMENT FLUIDS (File #133.7)
"RTN","SRHLUO3",67,0)
 S ^TMP("HLS",$J,SRI)="ZRF"_HL("FS")_HLCOMP_$P(^SRO(133.7,I,0),U)_HLCOMP_HL("FS")_$S($P(^(0),U,2)'="":$P(^(0),U,2),1:0),SRI=SRI+1
"RTN","SRHLUO3",68,0)
 Q
"RTN","SRHLUO3",69,0)
 ;cpt4,icd9,medication,monitor,personnel,replacement fluid
"RTN","SRHLUO3",70,0)
 I SRTYP'=3,(SRTYP'=5) D MSG^SRHLMFN(SRTBL,FEC,REC,SRENT)
"RTN","SRHLUO3",71,0)
 Q
"RTN","SRHLUO3",72,0)
XPER ;personnel information extract (SSN) from file 200
"RTN","SRHLUO3",73,0)
 S ^TMP("SRHL",$J,"PER",I)=$$HNAME^SRHLU(I)_"^"_ROLE
"RTN","SRHLUO3",74,0)
 Q
"RTN","SRHLVUO")
0^5^B24398625
"RTN","SRHLVUO",1,0)
SRHLVUO ;B'HAM ISC/DLR - Surgery Interface Utilities for building Outgoing HL7 Segment ; [ 05/06/98   7:14 AM ]
"RTN","SRHLVUO",2,0)
 ;;3.0; Surgery ;**41,127**;24 Jun 93
"RTN","SRHLVUO",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLVUO",4,0)
 ; ** ASSUMMED variable list
"RTN","SRHLVUO",5,0)
 ; all - INIT^HLTRANS
"RTN","SRHLVUO",6,0)
 ; DFN - IEN file #2
"RTN","SRHLVUO",7,0)
 ; SRI - incremental variable ^TMP("HLS",$J,HLSDT,SRI) 
"RTN","SRHLVUO",8,0)
 ;     - returns the next #
"RTN","SRHLVUO",9,0)
 ; CASE- IEN (file 130) case number must be set before the call
"RTN","SRHLVUO",10,0)
 ;
"RTN","SRHLVUO",11,0)
AL1(SRI) ;AL1 segment(s) builder returns allergy information from the generic call to (GMRADPT)
"RTN","SRHLVUO",12,0)
 Q:'$D(DFN)
"RTN","SRHLVUO",13,0)
 S X="GMRADPT" X ^%ZOSF("TEST") Q:'$T
"RTN","SRHLVUO",14,0)
 N TYPE,X,AL1,CNT
"RTN","SRHLVUO",15,0)
 ;Allergy package valid entry point returns GMRAL(x)
"RTN","SRHLVUO",16,0)
 D ^GMRADPT
"RTN","SRHLVUO",17,0)
 S CNT=1
"RTN","SRHLVUO",18,0)
 F X=0:0 S X=$O(GMRAL(X)) Q:X'>0  D
"RTN","SRHLVUO",19,0)
 .S TYPE=$P(GMRAL(X),"^",3),AL1(X)="AL1"_HLFS_$E("0000",$L(CNT)+1,4)_CNT_HLFS_$S(TYPE="D":"DA",TYPE="F":"FA",TYPE="O":"MA",1:"")_HLFS_HLCOMP_$P(GMRAL(X),"^",2)
"RTN","SRHLVUO",20,0)
 .S ^TMP("HLS",$J,HLSDT,SRI)=AL1(X),SRI=SRI+1,CNT=CNT+1
"RTN","SRHLVUO",21,0)
 K GMRAL
"RTN","SRHLVUO",22,0)
 Q
"RTN","SRHLVUO",23,0)
DG1(SRI) ;DG1 segment(s) builder returns surgery diagnosis information
"RTN","SRHLVUO",24,0)
 Q:'$D(CASE)
"RTN","SRHLVUO",25,0)
 N DG1,I9,X,X1
"RTN","SRHLVUO",26,0)
 I $D(^SRF(CASE,34)),$P(^SRF(CASE,34),U,2) D
"RTN","SRHLVUO",27,0)
 .S I9=$$ICDDX^ICDCODE($P(^SRF(CASE,34),U,2),$P($G(^SRF(CASE,0)),"^",9))
"RTN","SRHLVUO",28,0)
 .S DG1="DG1"_HLFS_"0001"_HLFS_"I9"_HLFS_$P(I9,U,2)_HLFS_$P(I9,U,4)_HLFS_HLFS_"P" D
"RTN","SRHLVUO",29,0)
 ..S ^TMP("HLS",$J,HLSDT,SRI)=DG1,SRI=SRI+1,DG1=""
"RTN","SRHLVUO",30,0)
 ..I $D(^SRF(CASE,14,0)) S X1=2 F X=0:0 S X=$O(^SRF(CASE,14,X)) Q:X'>0  D
"RTN","SRHLVUO",31,0)
 ...I $P(^(0),U,3) S I9=$$ICDDX^ICDCODE($P(^SRF(CASE,14,0),U,3),$P($G(^SRF(CASE,0)),"^",9)) D
"RTN","SRHLVUO",32,0)
 ....S ^TMP("HLS",$J,HLSDT,SRI)="DG1"_HLFS_$E("0000",$L(X1)+1,4)_X1_HLFS_"I9"_HLFS_$P(I9,U,2)_HLFS_$P(I9,U,4)_HLFS_HLFS_"PR",X1=X1+1,SRI=SRI+1
"RTN","SRHLVUO",33,0)
 Q
"RTN","SRHLVUO",34,0)
ERR(SRI,SRERR)     ;ERR segment builder
"RTN","SRHLVUO",35,0)
 ; SRERR = error code and location (segment^sequence #^field^error) 
"RTN","SRHLVUO",36,0)
 ;         (ONLY AE Application Errors')
"RTN","SRHLVUO",37,0)
 ;
"RTN","SRHLVUO",38,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="ERR"_HLFS_$G(SRERR(1))_HLCOMP_$G(SRERR(2))_HLCOMP_$G(HLERR),SRI=SRI+1
"RTN","SRHLVUO",39,0)
 Q
"RTN","SRHLVUO",40,0)
MSA(SRI,SRAC) ;MSA segment builder
"RTN","SRHLVUO",41,0)
 ; SRAC = Acknowledgement code (ID)
"RTN","SRHLVUO",42,0)
 ;  AA = Application Accepted (responsed with information)
"RTN","SRHLVUO",43,0)
 ;  AE = Application Error (bad data send error response)
"RTN","SRHLVUO",44,0)
 ;  AR = Application Reject
"RTN","SRHLVUO",45,0)
 ;
"RTN","SRHLVUO",46,0)
 N MSA
"RTN","SRHLVUO",47,0)
 S MSA(1)=$G(SRAC),MSA(2)=$G(HLMID),MSA(3)=$G(SRERR)
"RTN","SRHLVUO",48,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="MSA"_HLFS F XX=1:1:3 S ^TMP("HLS",$J,HLSDT,SRI)=$G(^TMP("HLS",$J,HLSDT,SRI))_$G(MSA(XX))_$S(XX=3:"",1:HLFS)
"RTN","SRHLVUO",49,0)
 S SRI=SRI+1
"RTN","SRHLVUO",50,0)
 Q
"RTN","SRHLVUO",51,0)
OBX(SRI) ;OBX segment(s) builder
"RTN","SRHLVUO",52,0)
 ; This segment builds OBX segments for the following Preoperative data
"RTN","SRHLVUO",53,0)
 ;  - vitals\measurements ^GMRVUTL routine:   
"RTN","SRHLVUO",54,0)
 ;     height, weight, blood pressure, pulse rate, and temperature
"RTN","SRHLVUO",55,0)
 ;  - IN\OUT-PATIENT STATUS field in File #130
"RTN","SRHLVUO",56,0)
 ;  - CANCEL DATE and CANCEL REASON for cancelled and aborted cases
"RTN","SRHLVUO",57,0)
 ;  - SURGICAL SPECIALTY (OR) or MEDICAL SPECIALTY (NON OR)
"RTN","SRHLVUO",58,0)
 ;  - SURGEON PGY and ANES SUPERVISE CODE
"RTN","SRHLVUO",59,0)
 Q:'$D(CASE)
"RTN","SRHLVUO",60,0)
 N OBX,CNT,TYPE,X,Y
"RTN","SRHLVUO",61,0)
 S CNT=1
"RTN","SRHLVUO",62,0)
 I $D(^SRF(CASE,"NON")) S OBX(2)="CE",OBX(3)=HLCOMP_"MEDICAL SPECIALTY"_HLCOMP,OBX(5)=$P(^("NON"),U,8) I OBX(5)'="" S OBX(5)=HLCOMP_$P(^ECC(723,OBX(5),0),U)_HLCOMP_"99VA723" D SOBX
"RTN","SRHLVUO",63,0)
 I $P(^SRF(CASE,0),U,4)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"SURGICAL SPECIALTY"_HLCOMP,OBX(5)=$P(^(0),U,4) I OBX(5)'="" S OBX(5)=HLCOMP_$P(^SRO(137.45,OBX(5),0),U)_HLCOMP_"99VA137.45" D SOBX
"RTN","SRHLVUO",64,0)
 I $D(^SRF(CASE,200)) I $P(^SRF(CASE,200),U,52)'="" S OBX(2)="NM",OBX(3)=HLCOMP_"SURGEON PGY"_HLCOMP_"L",OBX(5)=$P(^(200),U,52) D SOBX
"RTN","SRHLVUO",65,0)
 I $D(^SRF(CASE,.3)) I $P(^SRF(CASE,.3),U,6)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"ANES SUPERVISE CODE"_HLCOMP_"L",OBX(5)=$P(^(.3),U,6) D SOBX
"RTN","SRHLVUO",66,0)
 I $P(^SRF(CASE,0),U,12)'="" S OBX(2)="CE",OBX(3)=HLCOMP_"PATIENT CLASS"_HLCOMP,OBX(5)=$P(^(0),U,12) S C=$P(^DD(130,.011,0),U,2),Y=OBX(5) D Y^DIQ S OBX(5)=HLCOMP_Y_HLCOMP_"L" D SOBX
"RTN","SRHLVUO",67,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I $T F TYPE="BP","HT","WT","T","P" S GMRVSTR=TYPE D EN6^GMRVUTL I $G(X)'="" S X1=$P(X,"^"),X2=60,SRX=X D C^%DTC I X'<DT D
"RTN","SRHLVUO",68,0)
 .S OBX(2)="CE",OBX(5)=$P(SRX,"^",8),OBX(11)="S",OBX(14)=$$HLDATE^HLFNC($P(SRX,"^")),OBX(16)=$$HNAME^SRHLVU($P(SRX,U,6))
"RTN","SRHLVUO",69,0)
 .I TYPE="BP" S OBX(3)="1002"_HLCOMP_"BP",OBX(5)=$P(SRX,"^",8) D SOBX
"RTN","SRHLVUO",70,0)
 .I TYPE="HT" S OBX(3)="1010.3"_HLCOMP_"Height",OBX(5)=$J(2.54*OBX(5),0,2),OBX(6)="cm" D SOBX
"RTN","SRHLVUO",71,0)
 .I TYPE="WT" S OBX(3)="1010.1"_HLCOMP_"Body Weight",OBX(5)=$J(OBX(5)/2.2,0,2),OBX(6)="kg" D SOBX
"RTN","SRHLVUO",72,0)
 .I TYPE="T" S OBX(3)="1000"_HLCOMP_"Temperature" S OBX(5)=$J(OBX(5)-32*5/9,0,2),OBX(6)="cel" D SOBX
"RTN","SRHLVUO",73,0)
 .I TYPE="P" S OBX(3)="1006.2"_HLCOMP_"HR",OBX(6)="min" D SOBX
"RTN","SRHLVUO",74,0)
 I $D(^SRF(CASE,30)),$P($G(^SRF(CASE,31)),U,8)'="" D
"RTN","SRHLVUO",75,0)
 .S OBX(2)="CE",OBX(3)=HLCOMP_"CANCEL REASON"_HLCOMP_"L",OBX(5)=HLCOMP_$P(^SRO(135,$P(^SRF(CASE,31),U,8),0),U)_HLCOMP_"L",OBX(14)=$$HLDATE^HLFNC($P(^SRF(CASE,30),U)),OBX(16)=$$HNAME^SRHLVU($P(^SRF(CASE,30),U,3)) D SOBX
"RTN","SRHLVUO",76,0)
 Q
"RTN","SRHLVUO",77,0)
SOBX ;sets the OBX segment
"RTN","SRHLVUO",78,0)
 S OBX(11)="S"
"RTN","SRHLVUO",79,0)
 S OBX(1)=CNT
"RTN","SRHLVUO",80,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="OBX"_HLFS F XX=1:1:16 S ^TMP("HLS",$J,HLSDT,SRI)=$G(^TMP("HLS",$J,HLSDT,SRI))_$G(OBX(XX))_$S(XX=16:"",1:HLFS),OBX(XX)=""
"RTN","SRHLVUO",81,0)
 S SRI=SRI+1,CNT=$G(CNT)+1
"RTN","SRHLVUO",82,0)
 Q
"RTN","SRHLVUO",83,0)
PID(SRI) ;PID segment builder returns patient information
"RTN","SRHLVUO",84,0)
 Q:'$D(DFN)
"RTN","SRHLVUO",85,0)
 S ^TMP("HLS",$J,HLSDT,SRI)=$$EN^VAFHLPID(DFN,"1,3,4,5,6,7,8,11,13,16,19",1),SRI=SRI+1
"RTN","SRHLVUO",86,0)
 Q
"RTN","SRHLVUO1")
0^6^B23278123
"RTN","SRHLVUO1",1,0)
SRHLVUO1 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 05/20/99   7:14 AM ]
"RTN","SRHLVUO1",2,0)
 ;;3.0; Surgery ;**41,88,127**;24 Jun 93
"RTN","SRHLVUO1",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLVUO1",4,0)
 ;INIT^HLTRANS MUST BE called before calling this routine.
"RTN","SRHLVUO1",5,0)
ZCH(SRI,SREVENT,SRSTATUS) ;sets ^TMP("HLS",$J global for sending ZCH Scheduling Appointment Information segment(s)
"RTN","SRHLVUO1",6,0)
 N ADD,ADD1,ADDR,PHONE,SRJ,SRM,SRP,SRREP,SRX,XX,ZCH,SROERR
"RTN","SRHLVUO1",7,0)
 S (ZCH(1),ZCH(3))=HLQ
"RTN","SRHLVUO1",8,0)
 S ZCH(2)=CASE
"RTN","SRHLVUO1",9,0)
 ;eventid^text(STATUS)^coding scheme^...
"RTN","SRHLVUO1",10,0)
 S ZCH(4)=$G(SREVENT)_HLCOMP_$G(SRSTATUS)_HLCOMP_"L"
"RTN","SRHLVUO1",11,0)
 I $D(^SRF(CASE,"OP")) S ZCH(5)=$P($G(^("OP")),U,2) I ZCH(5)'="" D
"RTN","SRHLVUO1",12,0)
 .S SRX=$$CPT^ICPTCOD(ZCH(5),$P($G(^SRF(CASE,0)),"^",9)),ZCH(5)=$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_"C4"
"RTN","SRHLVUO1",13,0)
 .S (SRJ,SRREP)=0 F  S SRJ=$O(^SRF(CASE,"OPMOD",SRJ)) Q:'SRJ  S SRP=$P(^SRF(CASE,"OPMOD",SRJ,0),U),SRM=$$MOD^ICPTMOD(SRP,"I",$P($G(^SRF(CASE,0)),U,9)) D
"RTN","SRHLVUO1",14,0)
 ..S ZCH(18)=$G(ZCH(18))_$S(SRREP:HLREP,1:"")_$P(SRM,U,2)_HLCOMP_$P(SRM,U,3)_HLCOMP,SRREP=1
"RTN","SRHLVUO1",15,0)
 I $G(ZCH(5))="" S ZCH(5)=HLCOMP_$P($G(^SRF(CASE,"OP")),U)
"RTN","SRHLVUO1",16,0)
 I $D(^SRF(CASE,".4")) S ZCH(6)=$P($G(^(.4)),U) I ZCH(6)'="" S ZCH(6)=($P(ZCH(6),":")*60)+($P($G(ZCH(6)),":",2))_HLCOMP_"min"
"RTN","SRHLVUO1",17,0)
 I $G(SRSTATUS)="(SCHEDULED)" D
"RTN","SRHLVUO1",18,0)
 .S ZCH(7)=HLCOMP_HLCOMP_HLCOMP_$$HLDATE^HLFNC($P($G(^SRF(CASE,31)),U,4))_HLCOMP_$$HLDATE^HLFNC($P($G(^(31)),U,5))_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_$P($G(^SRF(CASE,0)),U,11)
"RTN","SRHLVUO1",19,0)
 I $G(SRSTATUS)'="(SCHEDULED)" S ZCH(7)=HLCOMP_HLCOMP_HLCOMP_$$HLDATE^HLFNC($P(^SRF(CASE,0),U,9))_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_HLCOMP_$P($G(^SRF(CASE,0)),U,11)
"RTN","SRHLVUO1",20,0)
 I $D(^SRF(CASE,"1.0")) S ZCH(12)=$P($G(^("1.0")),U,10) I ZCH(12)'="" S ZCH(12)=$$HNAME^SRHLVU($G(ZCH(12)))
"RTN","SRHLVUO1",21,0)
 I $D(^SRF(CASE,"CON")) S ZCH(17)=$P($G(^("CON")),U)
"RTN","SRHLVUO1",22,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="ZCH"_HLFS F XX=1:1:18 S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_$G(ZCH(XX))_$S(XX=18:"",1:HLFS)
"RTN","SRHLVUO1",23,0)
 S SRI=SRI+1
"RTN","SRHLVUO1",24,0)
 Q
"RTN","SRHLVUO1",25,0)
ZIG(SRI) ;sets ^TMP("HLS",$J global for sending ZIG Appointment Information - General Resource Segment(s)
"RTN","SRHLVUO1",26,0)
 Q:'$D(^SRF(CASE,27,0))
"RTN","SRHLVUO1",27,0)
 N MON,ZIG
"RTN","SRHLVUO1",28,0)
 S MON=0 F  S MON=$O(^SRF(CASE,27,MON)) Q:'MON  S ZIG=^SRF(CASE,27,MON,0) D
"RTN","SRHLVUO1",29,0)
 .S ZIG(1)=$P(ZIG,U)_HLCOMP_$P($G(^SRO(133.4,$P(ZIG,U),0)),U)_HLCOMP_"99VA133.4"
"RTN","SRHLVUO1",30,0)
 .S ZIG(2)=HLCOMP_"MONITOR"_HLCOMP
"RTN","SRHLVUO1",31,0)
 .S ^TMP("HLS",$J,HLSDT,SRI)="ZIG"_HLFS F XX=1:1:4 S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_$G(ZIG(XX))_$S(XX=4:"",1:HLFS),ZIG(XX)=""
"RTN","SRHLVUO1",32,0)
 .S SRI=SRI+1
"RTN","SRHLVUO1",33,0)
 Q
"RTN","SRHLVUO1",34,0)
ZIL(SRI) ;sets ^TMP("HLS",$J global for sending ZIL Appointment Information - Location Resource Segment(s)
"RTN","SRHLVUO1",35,0)
 N FAC,LOC,SRC,X,ZIL
"RTN","SRHLVUO1",36,0)
 I '$P(^SRF(CASE,0),U,2),'$D(^SRF(CASE,"NON")) Q
"RTN","SRHLVUO1",37,0)
 I $P(^SRF(CASE,0),U,2) S LOC=$P($G(^SRS($P(^SRF(CASE,0),U,2),0)),U) I $G(LOC)'="" S LOC=$P(^SC(LOC,0),U),FAC=$P(^(0),U,4) I $G(FAC)="" S FAC=$P($G(^SRF(CASE,8)),U)
"RTN","SRHLVUO1",38,0)
 I $D(^SRF(CASE,"NON")),$P(^("NON"),U,2) S LOC=$P(^SRF(CASE,"NON"),U,2) I $G(LOC)'="" S LOC=$P(^SC(LOC,0),U),FAC=$P(^(0),U,4) I $G(FAC)="" S FAC=$P($G(^SRF(CASE,8)),U)
"RTN","SRHLVUO1",39,0)
 S ZIL(1)=$G(FAC)_HLCOMP_HLCOMP_HLCOMP_$G(LOC)
"RTN","SRHLVUO1",40,0)
 S ZIL(2)=HLCOMP_$S($P($G(^SRF(CASE,"NON")),U,2):"NON OR",1:"OPERATING ROOM")
"RTN","SRHLVUO1",41,0)
 S SRC=0 D  S ZIL(6)=$S($G(SRC)=1:"PENDING",1:"CONFIRMED")
"RTN","SRHLVUO1",42,0)
 .I $D(^SRF(CASE,"REQ"))&($G(SRSTATUS)="(REQUESTED)") S:^SRF(CASE,"REQ")=1&($P($G(^SRF(CASE,.2)),U,2)="") SRC=1
"RTN","SRHLVUO1",43,0)
 .I $G(SRSTATUS)="(SCHEDULED)" D STAT
"RTN","SRHLVUO1",44,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="ZIL"_HLFS F X=1:1:6 S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_$G(ZIL(X))_$S(X=6:"",1:HLFS),ZIL(X)=""
"RTN","SRHLVUO1",45,0)
 S SRI=SRI+1
"RTN","SRHLVUO1",46,0)
 Q
"RTN","SRHLVUO1",47,0)
ZIP(SRI) ;sets ^TMP("HLS",$J,HLSDT,I) global for sending ZIP Appointment Information - Personnel Segment(s)
"RTN","SRHLVUO1",48,0)
 N SRC,X,XX,ZIP
"RTN","SRHLVUO1",49,0)
 I $D(^SRF(CASE,"NON")) D
"RTN","SRHLVUO1",50,0)
 .I $P(^SRF(CASE,"NON"),U,6)'="" S ZIP(1)=$$HNAME^SRHLVU($P(^("NON"),U,6)),ZIP(2)=HLCOMP_"PROVIDER"_HLCOMP_"99VA200" D SZIP
"RTN","SRHLVUO1",51,0)
 .I $P(^SRF(CASE,"NON"),U,7)'="" S ZIP(1)=$$HNAME^SRHLVU($P(^("NON"),U,7)),ZIP(2)=HLCOMP_"ATTEND PROVIDER"_HLCOMP_"99VA200" D SZIP
"RTN","SRHLVUO1",52,0)
 I $D(^SRF(CASE,.1)) F X=4,5,6,13 S ZIP(1)=$P($G(^SRF(CASE,.1)),U,X) I $G(ZIP(1))'="" D
"RTN","SRHLVUO1",53,0)
 .S ZIP(1)=$$HNAME^SRHLVU(ZIP(1)),ZIP(2)=HLCOMP_$S(X=4:"SURGEON",X=5:"1ST ASST.",X=6:"2ND ASST.",X=13:"ATT. SURGEON",1:"")_HLCOMP_"99VA200"
"RTN","SRHLVUO1",54,0)
 .D SZIP
"RTN","SRHLVUO1",55,0)
 S X=0 F X=1,4 S ZIP(1)=$P($G(^SRF(CASE,.3)),U,X) I $G(ZIP(1))'="" D
"RTN","SRHLVUO1",56,0)
 .S ZIP(1)=$$HNAME^SRHLVU(ZIP(1)),ZIP(2)=HLCOMP_$S(X=1:"PRIN. ANES.",X=4:"ANES. SUPER.",1:"")_HLCOMP_"99VA200"
"RTN","SRHLVUO1",57,0)
 .D SZIP
"RTN","SRHLVUO1",58,0)
 Q
"RTN","SRHLVUO1",59,0)
SZIP ;set the ZIP segment
"RTN","SRHLVUO1",60,0)
 S SRC=0 D  S ZIP(6)=$S($G(SRC)=1:"PENDING",1:"CONFIRMED")
"RTN","SRHLVUO1",61,0)
 .I $D(^SRF(CASE,"REQ"))&($G(SRSTATUS)="(REQUESTED)") S:^SRF(CASE,"REQ")=1&($P($G(^SRF(CASE,.2)),U,2)="") SRC=1
"RTN","SRHLVUO1",62,0)
 .I $G(SRSTATUS)="(SCHEDULED)" D STAT
"RTN","SRHLVUO1",63,0)
 S ^TMP("HLS",$J,HLSDT,SRI)="ZIP"_HLFS F XX=1:1:6 S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_$G(ZIP(XX))_$S(XX=6:"",1:HLFS),ZIP(XX)=""
"RTN","SRHLVUO1",64,0)
 S SRI=SRI+1
"RTN","SRHLVUO1",65,0)
 Q
"RTN","SRHLVUO1",66,0)
STAT ;check scheduled cases to scheduled close time
"RTN","SRHLVUO1",67,0)
 N SRI,SRS,SRTIME,X1,X2
"RTN","SRHLVUO1",68,0)
 Q:'$D(^SRF(CASE,31))
"RTN","SRHLVUO1",69,0)
 S SRI=$P($G(^SRF(CASE,8)),U),SRS=$O(^SRO(133,"B",SRI,0)),SRTIME=$P(^SRO(133,SRS,0),U,12) S:SRTIME="" SRTIME=1500
"RTN","SRHLVUO1",70,0)
 S X1=$E($P(^SRF(CASE,0),U,9),1,7),X2=-1,SRYN="N" D C^%DTC D  Q:X'=DT  S SRTIME=X_"."_SRTIME D NOW^%DTC I %>SRTIME S SRC=0
"RTN","SRHLVUO1",71,0)
 .I X'<DT S SRC=1
"RTN","SRHLVUO1",72,0)
 .I X<DT S SRC=0
"RTN","SRHLVUO1",73,0)
 Q
"RTN","SRHLVUO2")
0^7^B3906684
"RTN","SRHLVUO2",1,0)
SRHLVUO2 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 06/23/99   7:14 AM ]
"RTN","SRHLVUO2",2,0)
 ;;3.0; Surgery ;**41,88,127**;24 Jun 93
"RTN","SRHLVUO2",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLVUO2",4,0)
ZIS(SRI) ;sets ^TMP("HLS",$J,HLSDT,I) global for sending ZIS Appointment Information - Service Segment(s)
"RTN","SRHLVUO2",5,0)
 N X,XX,SRJ,SRM,SRP,SRREP,SRX,ZIS
"RTN","SRHLVUO2",6,0)
 S X=0 F  S X=$O(^SRF(CASE,13,X)) Q:'X  I $G(^(X,2))'="" D
"RTN","SRHLVUO2",7,0)
 .S ZIS(1)=$P(^SRF(CASE,13,X,2),U) I ZIS(1)'="" S SRX=$$CPT^ICPTCOD(ZIS(1),$P($G(^SRF(CASE,0)),U,9)),ZIS(1)=$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_"C4",ZIS(5)=$S($P(^SRF(CASE,13,X,0),U,3)="Y":"CONFIRMED",1:"PENDING")
"RTN","SRHLVUO2",8,0)
 .K ZIS(6) S (SRJ,SRREP)=0 F  S SRJ=$O(^SRF(CASE,13,X,"MOD",SRJ)) Q:'SRJ  S SRP=$P(^SRF(CASE,13,X,"MOD",SRJ,0),U),SRM=$$MOD^ICPTMOD(SRP,"I",$P($G(^SRF(CASE,0)),U,9)) D
"RTN","SRHLVUO2",9,0)
 ..S ZIS(6)=$G(ZIS(6))_$S(SRREP:HLREP,1:"")_$P(SRM,U,2)_HLCOMP_$P(SRM,U,3)_HLCOMP,SRREP=1
"RTN","SRHLVUO2",10,0)
 .S ^TMP("HLS",$J,HLSDT,SRI)="ZIS"_HLFS F XX=1:1:5 S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_$G(ZIS(XX))_$S(XX=5:"",1:HLFS)
"RTN","SRHLVUO2",11,0)
 .I $L($G(ZIS(6))) S ^TMP("HLS",$J,HLSDT,SRI)=^TMP("HLS",$J,HLSDT,SRI)_HLFS_ZIS(6)
"RTN","SRHLVUO2",12,0)
 .S SRI=SRI+1
"RTN","SRHLVUO2",13,0)
 Q
"RTN","SROACC")
0^33^B25143542
"RTN","SROACC",1,0)
SROACC ;B'HAM ISC/MAM - CPT ACCURACY ; [ 09/22/98  11:19 AM ]
"RTN","SROACC",2,0)
 ;;3.0; Surgery ;**77,50,127**;24 Jun 93
"RTN","SROACC",3,0)
BEG S (SRFLG,SRSOUT)=0
"RTN","SROACC",4,0)
 W @IOF,!,"Report to Check CPT Coding Accuracy"
"RTN","SROACC",5,0)
START D DATE^SROUTL(.SDATE,.EDATE,.SRSOUT) G:SRSOUT END
"RTN","SROACC",6,0)
 S SDATE1=SDATE-.0001,EDATE1=EDATE+.9999
"RTN","SROACC",7,0)
ASK W @IOF,!,"Print the Report of CPT Coding Accuracy for which cases ?",!!,"1. O.R. Surgical Procedures",!,"2. Non-O.R. Procedures",!,"3. Both O.R. Surgical Procedures and Non-O.R. Procedures (All Specialties)"
"RTN","SROACC",8,0)
 W !!,"Select Number:  1// " R X:DTIME I '$T!(X["^") G END
"RTN","SROACC",9,0)
 S:X="" X=1 I X>3!(X<1)!(X'?.N) D HELP G:SRSOUT END G ASK
"RTN","SROACC",10,0)
 S SRFLG=X
"RTN","SROACC",11,0)
ALL W !!,"Do you want to print the Report of CPT Coding Accuracy for all",!,"CPT Codes ?  YES//  " R SRYN:DTIME I '$T!(SRYN["^") S SRSOUT=1 G END
"RTN","SROACC",12,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SROACC",13,0)
 I "YyNn"'[SRYN W !!,"Enter RETURN if you want to print the report for all codes, or 'NO'",!,"to select a specific CPT Code.",!!,"Press RETURN to continue  " R X:DTIME G ALL
"RTN","SROACC",14,0)
 S SRCPT="ALL"
"RTN","SROACC",15,0)
 I "Nn"[SRYN W !! K DIC S DIC=81,DIC(0)="QEAMZ",DIC("A")="Print the Coding Accuracy Report for which CPT Code ?  ",DIC("S")="I $$CTD^SROACC()" D ^DIC S:Y<0 SRSOUT=1 G:Y<0 END S SRCPT=+Y
"RTN","SROACC",16,0)
 I SRFLG=1 G SPEC
"RTN","SROACC",17,0)
 I SRFLG=2!(SRFLG=3) G MSP
"RTN","SROACC",18,0)
DEV W !!,"This report is designed to use a 132 column format.",!!
"RTN","SROACC",19,0)
 K IOP,%ZIS,POP,IO("Q") S %ZIS("A")="Select Device: ",%ZIS="QM" D ^%ZIS I POP S SRSOUT=1 G END
"RTN","SROACC",20,0)
 I $D(IO("Q")) K IO("Q") S ZTRTN="EN^SROACC",(ZTSAVE("SDATE*"),ZTSAVE("EDATE*"),ZTSAVE("SRCPT"),ZTSAVE("SRFLG"),ZTSAVE("SRSITE*"))="",ZTDESC="REPORT TO CHECK CPT CODING ACCURACY" D ^%ZTLOAD G END
"RTN","SROACC",21,0)
EN ; entry when queued
"RTN","SROACC",22,0)
 K ^TMP("SR",$J) U IO S SRSOUT=0,SRPAGE=1,SRINST=SRSITE("SITE")
"RTN","SROACC",23,0)
 N SRFRTO S Y=SDATE X ^DD("DD") S SRFRTO="FROM: "_Y_"  TO: " S Y=EDATE X ^DD("DD") S SRFRTO=SRFRTO_Y
"RTN","SROACC",24,0)
 I SRCPT="ALL" D ^SROACC5 G END
"RTN","SROACC",25,0)
 D ^SROACC6
"RTN","SROACC",26,0)
END W:$E(IOST)="P" @IOF I $D(ZTQUEUED) K ^TMP("SR",$J) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROACC",27,0)
 I 'SRSOUT,$E(IOST)'="P" W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROACC",28,0)
 D ^%ZISC W @IOF K SRTN D ^SRSKILL
"RTN","SROACC",29,0)
 Q
"RTN","SROACC",30,0)
HELP W !!,"Enter '1' or press <RET> to include only OR surgical procedure cases on the",!,"report.  Enter '2' to include only non-OR procedure cases on the report."
"RTN","SROACC",31,0)
 W !,"Enter '3' to include cases for both OR surgical procedures and non-OR",!,"procedures on the report."
"RTN","SROACC",32,0)
 W !!,"Press <RET> to continue, or '^' to quit.  " R X:DTIME I '$T!(X["^") S SRSOUT=1
"RTN","SROACC",33,0)
 Q
"RTN","SROACC",34,0)
HDR ; print heading
"RTN","SROACC",35,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROACC",36,0)
 I SRHDR,$E(IOST)'="P" W !!,"Press RETURN to continue, or '^' to quit:  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SROACC",37,0)
 W:$Y @IOF W !,?(132-$L(SRINST)\2),SRINST,?126,"PAGE",!,?58,"SURGICAL SERVICE",?126,$J(SRPAGE,4),!,?51,"REPORT OF CPT CODING ACCURACY",?100,"REVIEWED BY:"
"RTN","SROACC",38,0)
 W !,?(132-$L(SRFRTO)\2),SRFRTO,?100,"DATE REVIEWED:"
"RTN","SROACC",39,0)
 W !,$S(SRFLG=1:"O.R. SURGICAL PROCEDURES",SRFLG=2:"NON-O.R. PROCEDURES",1:"O.R. SURGICAL PROCEDURES AND NON-O.R. PROCEDURES")
"RTN","SROACC",40,0)
 W !!,?1,"PROCEDURE DATE",?20,"PATIENT",?60,"PROCEDURES",?111,"SURGEON/PROVIDER",!,?3,"CASE #",?22,"ID#",?111,"ATTEND SURG/PROV",!,?20,"SPECIALTY"
"RTN","SROACC",41,0)
 S SRHDR=1,SRPAGE=SRPAGE+1 Q
"RTN","SROACC",42,0)
SPEC W @IOF,!,"Do you want to sort the Report of CPT Coding Accuracy by",!,"Surgical Specialty ?  YES//  " R SRYN:DTIME I '$T!(SRYN["^") S SRSOUT=1 G END
"RTN","SROACC",43,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SROACC",44,0)
 I "YyNn"'[SRYN W !!,"Enter RETURN if you want to sort the report by specialty, or 'NO'",!,"to sort the report by date only.",!!,"Press RETURN to continue  " R X:DTIME G SPEC
"RTN","SROACC",45,0)
 I "Yy"[SRYN G SPEC^SROACC0
"RTN","SROACC",46,0)
 G DEV
"RTN","SROACC",47,0)
MSP W @IOF,!,"Do you want to sort the Report of CPT Coding Accuracy by",!,$S(SRFLG=2:"Medical",1:"Medical/Surgical")," Specialty ?  YES//  " R SRYN:DTIME I '$T!(SRYN["^") S SRSOUT=1 G END
"RTN","SROACC",48,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SROACC",49,0)
 I "YyNn"'[SRYN W !!,"Enter RETURN if you want to sort the report by specialty, or 'NO'",!,"to sort the report by date only.",!!,"Press RETURN to continue  " R X:DTIME G MSP
"RTN","SROACC",50,0)
 I "Yy"[SRYN G MSP^SROACC0
"RTN","SROACC",51,0)
 G DEV
"RTN","SROACC",52,0)
 Q
"RTN","SROACC",53,0)
CTD() K ICPTVDT
"RTN","SROACC",54,0)
 N SRSDATE S SROK=1,SRSDATE=DT
"RTN","SROACC",55,0)
 I (EDATE) S SRSDATE=EDATE
"RTN","SROACC",56,0)
 S SROK=$P($$CPT^ICPTCOD(Y,SRSDATE),"^",7),ICPTVDT=SRSDATE
"RTN","SROACC",57,0)
 Q SROK
"RTN","SROACC1")
0^34^B15386801
"RTN","SROACC1",1,0)
SROACC1 ;BIR/MAM - CPT ACCURACY ALL CODES AND SPECIALTIES ; [ 05/13/99  3:24 PM ]
"RTN","SROACC1",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC1",3,0)
 ;
"RTN","SROACC1",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC1",5,0)
 ;
"RTN","SROACC1",6,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC1",7,0)
 S (SRSS,SRHDR)=0 F  S SRSS=$O(^TMP("SR",$J,SRSS)) Q:SRSS=""!(SRSOUT)  D HDR^SROACC0 Q:SRSOUT  S SRHDR=1,CPT=0 F  S CPT=$O(^TMP("SR",$J,SRSS,CPT)) Q:CPT=""!(SRSOUT)  D MORE
"RTN","SROACC1",8,0)
 I '$D(^TMP("SR",$J)) D HDR^SROACC0,LINE W $$NODATA^SROUTL0()
"RTN","SROACC1",9,0)
 Q
"RTN","SROACC1",10,0)
MORE ; print CPT description and get cases
"RTN","SROACC1",11,0)
 I $Y+12>IOSL D HDR^SROACC0 I SRSOUT Q
"RTN","SROACC1",12,0)
 S TYPE=0,X=$$CPT^ICPTCOD(CPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC1",13,0)
 F  S TYPE=$O(^TMP("SR",$J,SRSS,CPT,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSS,CPT,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC1",14,0)
 Q
"RTN","SROACC1",15,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSS,CPT,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC1",16,0)
 Q
"RTN","SROACC1",17,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC1",18,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC1",19,0)
 Q
"RTN","SROACC1",20,0)
DESC ; print description
"RTN","SROACC1",21,0)
 Q:SRSOUT  I '$O(^TMP("SR",$J,SRSS,CPT,TYPE,0)) Q
"RTN","SROACC1",22,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC1",23,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC1",24,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC1",25,0)
 K SRDESC S X=$$CPTD^ICPTCOD(CPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC1",26,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC1",27,0)
 Q
"RTN","SROACC1",28,0)
PRINT ; print each case
"RTN","SROACC1",29,0)
 I $Y+5>IOSL D HDR^SROACC0 Q:SRSOUT  D DESC
"RTN","SROACC1",30,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC1",31,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC1",32,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC1",33,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID"),SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC1",34,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC1",35,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC1",36,0)
 D OPER^SROACC0
"RTN","SROACC1",37,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC1",38,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,! W:SRFLG=3&(SRNON) "NON-O.R." I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC1",39,0)
 W ! Q
"RTN","SROACC1",40,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC1",41,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC1",42,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC1",43,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC1",44,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2)
"RTN","SROACC1",45,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4),SRSS=$S('X:"SPECIALTY NOT ENTERED",1:$P(^SRO(137.45,X,0),"^"))
"RTN","SROACC1",46,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8),SRSS=$S(X:$P(^ECC(723,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC1",47,0)
 I CPT S ^TMP("SR",$J,SRSS,CPT,1,SRSDT,SRTN)=""
"RTN","SROACC1",48,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  I $P($G(^SRF(SRTN,13,OP,2)),"^") S CPT=$P(^(2),"^"),^TMP("SR",$J,SRSS,CPT,2,SRSDT,SRTN)=""
"RTN","SROACC1",49,0)
 Q
"RTN","SROACC1",50,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC1",51,0)
 Q
"RTN","SROACC2")
0^35^B14349621
"RTN","SROACC2",1,0)
SROACC2 ;BIR/MAM - CPT ACCURACY ALL CODES AND 1 SPECIALTY ; [ 05/14/99  11:33 AM ]
"RTN","SROACC2",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC2",3,0)
 ;
"RTN","SROACC2",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC2",5,0)
 ;
"RTN","SROACC2",6,0)
 S SRSPEC=SRSS,SRSS=$S(SRFLG=1:$P(^SRO(137.45,SRSS,0),"^"),1:$P(^ECC(723,SRSS,0),"^"))
"RTN","SROACC2",7,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC2",8,0)
 S SRHDR=0 D HDR^SROACC0 S CPT=0 F  S CPT=$O(^TMP("SR",$J,SRSS,CPT)) Q:'CPT!(SRSOUT)  D MORE
"RTN","SROACC2",9,0)
 I '$D(^TMP("SR",$J)) D LINE W $$NODATA^SROUTL0()
"RTN","SROACC2",10,0)
 Q
"RTN","SROACC2",11,0)
MORE ; print CPT description and get cases
"RTN","SROACC2",12,0)
 I $Y+12>IOSL D HDR^SROACC0 I SRSOUT Q
"RTN","SROACC2",13,0)
 S TYPE=0,X=$$CPT^ICPTCOD(CPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC2",14,0)
 F  S TYPE=$O(^TMP("SR",$J,SRSS,CPT,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSS,CPT,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC2",15,0)
 Q
"RTN","SROACC2",16,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSS,CPT,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC2",17,0)
 Q
"RTN","SROACC2",18,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC2",19,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC2",20,0)
 Q
"RTN","SROACC2",21,0)
DESC ; print description
"RTN","SROACC2",22,0)
 Q:SRSOUT  I '$O(^TMP("SR",$J,SRSS,CPT,TYPE,0)) Q
"RTN","SROACC2",23,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC2",24,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC2",25,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC2",26,0)
 K SRDESC S X=$$CPTD^ICPTCOD(CPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC2",27,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC2",28,0)
 Q
"RTN","SROACC2",29,0)
PRINT ; print each case
"RTN","SROACC2",30,0)
 I $Y+5>IOSL D HDR^SROACC0 Q:SRSOUT  D DESC
"RTN","SROACC2",31,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC2",32,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC2",33,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC2",34,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID"),SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC2",35,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC2",36,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC2",37,0)
 D OPER^SROACC0
"RTN","SROACC2",38,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC2",39,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,! W:SRFLG=3&(SRNON) "NON-O.R." I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC2",40,0)
 W ! Q
"RTN","SROACC2",41,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC2",42,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC2",43,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC2",44,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC2",45,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2)
"RTN","SROACC2",46,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4) I X'=SRSPEC Q
"RTN","SROACC2",47,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8) I X'=SRSPEC Q
"RTN","SROACC2",48,0)
 I CPT S ^TMP("SR",$J,SRSS,CPT,1,SRSDT,SRTN)=""
"RTN","SROACC2",49,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  I $P($G(^SRF(SRTN,13,OP,2)),"^") S CPT=$P(^(2),"^"),^TMP("SR",$J,SRSS,CPT,2,SRSDT,SRTN)=""
"RTN","SROACC2",50,0)
 Q
"RTN","SROACC2",51,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC2",52,0)
 Q
"RTN","SROACC3")
0^36^B14708328
"RTN","SROACC3",1,0)
SROACC3 ;BIR/MAM - CPT ACCURACY 1 CODE, ALL SPECIALTIES ; [ 05/14/99  11:33 AM ]
"RTN","SROACC3",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC3",3,0)
 ;
"RTN","SROACC3",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC3",5,0)
 ;
"RTN","SROACC3",6,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC3",7,0)
 S (SRSS,SRHDR)=0 F  S SRSS=$O(^TMP("SR",$J,SRSS)) Q:SRSS=""!(SRSOUT)  D HDR^SROACC0 Q:SRSOUT  S SRHDR=1 D MORE
"RTN","SROACC3",8,0)
 I '$D(^TMP("SR",$J)) D HDR^SROACC0,LINE W $$NODATA^SROUTL0()
"RTN","SROACC3",9,0)
 Q
"RTN","SROACC3",10,0)
MORE ; print CPT description and get cases
"RTN","SROACC3",11,0)
 I $Y+12>IOSL D HDR^SROACC0 I SRSOUT Q
"RTN","SROACC3",12,0)
 S TYPE=0,X=$$CPT^ICPTCOD(SRCPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC3",13,0)
 F  S TYPE=$O(^TMP("SR",$J,SRSS,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSS,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC3",14,0)
 Q
"RTN","SROACC3",15,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSS,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC3",16,0)
 Q
"RTN","SROACC3",17,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC3",18,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC3",19,0)
 Q
"RTN","SROACC3",20,0)
DESC ; print description
"RTN","SROACC3",21,0)
 Q:SRSOUT  I '$O(^TMP("SR",$J,SRSS,TYPE,0)) Q
"RTN","SROACC3",22,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC3",23,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC3",24,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC3",25,0)
 K SRDESC S X=$$CPTD^ICPTCOD(SRCPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC3",26,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC3",27,0)
 Q
"RTN","SROACC3",28,0)
PRINT ; print each case
"RTN","SROACC3",29,0)
 I $Y+5>IOSL D HDR^SROACC0 Q:SRSOUT  D DESC
"RTN","SROACC3",30,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC3",31,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC3",32,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC3",33,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID"),SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC3",34,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC3",35,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC3",36,0)
 D OPER^SROACC0
"RTN","SROACC3",37,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC3",38,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,! W:SRFLG=3&(SRNON) "NON-O.R." I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC3",39,0)
 W ! Q
"RTN","SROACC3",40,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC3",41,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC3",42,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC3",43,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC3",44,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2)
"RTN","SROACC3",45,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4),SRSS=$S('X:"SPECIALTY NOT ENTERED",1:$P(^SRO(137.45,X,0),"^"))
"RTN","SROACC3",46,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8),SRSS=$S(X:$P(^ECC(723,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC3",47,0)
 I CPT=SRCPT S ^TMP("SR",$J,SRSS,1,SRSDT,SRTN)=""
"RTN","SROACC3",48,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  S CPT=$P($G(^SRF(SRTN,13,OP,2)),"^") I CPT=SRCPT S ^TMP("SR",$J,SRSS,2,SRSDT,SRTN)=""
"RTN","SROACC3",49,0)
 Q
"RTN","SROACC3",50,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC3",51,0)
 Q
"RTN","SROACC4")
0^37^B13498785
"RTN","SROACC4",1,0)
SROACC4 ;BIR/MAM - CPT ACCURACY ALL CODES AND 1 SPECIALTY ; [ 05/14/99  11:37 AM ]
"RTN","SROACC4",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC4",3,0)
 ;
"RTN","SROACC4",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC4",5,0)
 ;
"RTN","SROACC4",6,0)
 S SRSPEC=SRSS,SRSS=$S(SRFLG=1:$P(^SRO(137.45,SRSS,0),"^"),1:$P(^ECC(723,SRSS,0),"^"))
"RTN","SROACC4",7,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC4",8,0)
 S SRHDR=0 D HDR^SROACC0 Q:SRSOUT  S SRHDR=1
"RTN","SROACC4",9,0)
 S TYPE=0,X=$$CPT^ICPTCOD(SRCPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC4",10,0)
 F  S TYPE=$O(^TMP("SR",$J,SRSS,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSS,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC4",11,0)
 I '$D(^TMP("SR",$J)) D LINE W $$NODATA^SROUTL0()
"RTN","SROACC4",12,0)
 Q
"RTN","SROACC4",13,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSS,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC4",14,0)
 Q
"RTN","SROACC4",15,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC4",16,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC4",17,0)
 Q
"RTN","SROACC4",18,0)
DESC ; print description
"RTN","SROACC4",19,0)
 Q:SRSOUT  I '$O(^TMP("SR",$J,SRSS,TYPE,0)) Q
"RTN","SROACC4",20,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC4",21,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC4",22,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC4",23,0)
 K SRDESC S X=$$CPTD^ICPTCOD(SRCPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC4",24,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC4",25,0)
 Q
"RTN","SROACC4",26,0)
PRINT ; print each case
"RTN","SROACC4",27,0)
 I $Y+5>IOSL D HDR^SROACC0 Q:SRSOUT  D DESC
"RTN","SROACC4",28,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC4",29,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC4",30,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC4",31,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID"),SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC4",32,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC4",33,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC4",34,0)
 D OPER^SROACC0
"RTN","SROACC4",35,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC4",36,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,! W:SRFLG=3&(SRNON) "NON-O.R." I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC4",37,0)
 W ! Q
"RTN","SROACC4",38,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC4",39,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC4",40,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC4",41,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC4",42,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2)
"RTN","SROACC4",43,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4) I X'=SRSPEC Q
"RTN","SROACC4",44,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8) I X'=SRSPEC Q
"RTN","SROACC4",45,0)
 I CPT=SRCPT S ^TMP("SR",$J,SRSS,1,SRSDT,SRTN)=""
"RTN","SROACC4",46,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  S CPT=$P($G(^SRF(SRTN,13,OP,2)),"^") I CPT=SRCPT S ^TMP("SR",$J,SRSS,2,SRSDT,SRTN)=""
"RTN","SROACC4",47,0)
 Q
"RTN","SROACC4",48,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC4",49,0)
 Q
"RTN","SROACC5")
0^38^B15888183
"RTN","SROACC5",1,0)
SROACC5 ;BIR/MAM - CPT ACCURACY ALL CODES ; [ 05/14/99  11:33 AM ]
"RTN","SROACC5",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC5",3,0)
 ;
"RTN","SROACC5",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC5",5,0)
 ;
"RTN","SROACC5",6,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC5",7,0)
 S SRHDR=0 D HDR^SROACC S CPT=0 F  S CPT=$O(^TMP("SR",$J,CPT)) Q:CPT=""!(SRSOUT)  D MORE
"RTN","SROACC5",8,0)
 I '$D(^TMP("SR",$J)) D LINE W $$NODATA^SROUTL0()
"RTN","SROACC5",9,0)
 Q
"RTN","SROACC5",10,0)
CNT ; get count
"RTN","SROACC5",11,0)
 S X=$S($D(^TMP("SR",$J,CPT))#2:^(CPT),1:0) S ^TMP("SR",$J,CPT)=X+1
"RTN","SROACC5",12,0)
 S X=$S($D(^TMP("SR",$J,CPT,2))#2:^(2),1:0) S ^TMP("SR",$J,CPT,2)=X+1
"RTN","SROACC5",13,0)
 Q
"RTN","SROACC5",14,0)
MORE ; print CPT description and get cases
"RTN","SROACC5",15,0)
 I $Y+12>IOSL D HDR^SROACC I SRSOUT Q
"RTN","SROACC5",16,0)
 S TYPE=0,X=$$CPT^ICPTCOD(CPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC5",17,0)
 F  S TYPE=$O(^TMP("SR",$J,CPT,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,CPT,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC5",18,0)
 Q
"RTN","SROACC5",19,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,CPT,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC5",20,0)
 Q
"RTN","SROACC5",21,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC5",22,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC5",23,0)
 Q
"RTN","SROACC5",24,0)
DESC ; print description
"RTN","SROACC5",25,0)
 Q:SRSOUT  I '$O(^TMP("SR",$J,CPT,TYPE,0)) Q
"RTN","SROACC5",26,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC5",27,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC5",28,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC5",29,0)
 K SRDESC S X=$$CPTD^ICPTCOD(CPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC5",30,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC5",31,0)
 Q
"RTN","SROACC5",32,0)
PRINT ; print each case
"RTN","SROACC5",33,0)
 I $Y+5>IOSL D HDR^SROACC Q:SRSOUT  D DESC
"RTN","SROACC5",34,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC5",35,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC5",36,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4),SRSS=$S(X:$P(^SRO(137.45,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC5",37,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8),SRSS=$S(X:$P(^ECC(723,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC5",38,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC5",39,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID")
"RTN","SROACC5",40,0)
 S SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC5",41,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC5",42,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC5",43,0)
 D OPER^SROACC0
"RTN","SROACC5",44,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC5",45,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,!
"RTN","SROACC5",46,0)
 W:SRFLG=3&(SRNON) "NON-O.R." W ?20,SRSS I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC5",47,0)
 W ! Q
"RTN","SROACC5",48,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC5",49,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC5",50,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC5",51,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC5",52,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2) I CPT S ^TMP("SR",$J,CPT,1,SRSDT,SRTN)="",X=$S($D(^TMP("SR",$J,CPT))#2:^(CPT),1:0),^TMP("SR",$J,CPT)=X+1,X=$S($D(^TMP("SR",$J,CPT,1))#2:^(1),1:0),^TMP("SR",$J,CPT,1)=X+1
"RTN","SROACC5",53,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  I $P($G(^SRF(SRTN,13,OP,2)),"^") S CPT=$P(^(2),"^"),^TMP("SR",$J,CPT,2,SRSDT,SRTN)="" D CNT
"RTN","SROACC5",54,0)
 Q
"RTN","SROACC5",55,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC5",56,0)
 Q
"RTN","SROACC6")
0^39^B12947968
"RTN","SROACC6",1,0)
SROACC6 ;BIR/MAM - CPT ACCURACY ONE CODE ; [ 05/14/99  11:41 AM ]
"RTN","SROACC6",2,0)
 ;;3.0; Surgery ;**37,50,88,127**;24 Jun 93
"RTN","SROACC6",3,0)
 ;
"RTN","SROACC6",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROACC6",5,0)
 ;
"RTN","SROACC6",6,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$P($G(^SRF(SRTN,30)),"^")="",$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACC6",7,0)
 S SRHDR=0 D HDR^SROACC Q:SRSOUT  S SRHDR=1
"RTN","SROACC6",8,0)
 S TYPE=0
"RTN","SROACC6",9,0)
 F  S TYPE=$O(^TMP("SR",$J,TYPE)) Q:TYPE=""  D DESC S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,TYPE,SRSDT)) Q:'SRSDT!(SRSOUT)  D SRTN
"RTN","SROACC6",10,0)
 I '$D(^TMP("SR",$J)) D LINE W $$NODATA^SROUTL0()
"RTN","SROACC6",11,0)
 Q
"RTN","SROACC6",12,0)
SRTN S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,TYPE,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROACC6",13,0)
 Q
"RTN","SROACC6",14,0)
LOOP ; break procedure greater than 50 characters
"RTN","SROACC6",15,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<50  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROACC6",16,0)
 Q
"RTN","SROACC6",17,0)
DESC ; print description
"RTN","SROACC6",18,0)
 Q:SRSOUT  S X=$O(^TMP("SR",$J,TYPE,0)) I 'X Q
"RTN","SROACC6",19,0)
 S X=$$CPT^ICPTCOD(SRCPT,EDATE),CPT1=$P(X,"^",2)_"  "_$P(X,"^",3)
"RTN","SROACC6",20,0)
 D LINE W !!,?(132-$L(CPT1)\2),CPT1
"RTN","SROACC6",21,0)
 I TYPE=1 W !,?50,"PRINCIPAL PROCEDURES"
"RTN","SROACC6",22,0)
 I TYPE=2 W !,?54,"OTHER PROCEDURES"
"RTN","SROACC6",23,0)
 S X=$O(^TMP("SR",$J,TYPE,0))
"RTN","SROACC6",24,0)
 K SRDESC S X=$$CPTD^ICPTCOD(SRCPT,"SRDESC",,EDATE) F I=1:1:X S Y=$S(I=1:"DESCRIPTION: "_SRDESC(I),1:SRDESC(I)) W !,?(132-$L(Y)\2),Y
"RTN","SROACC6",25,0)
 W !! F LINE=1:1:132 W "-"
"RTN","SROACC6",26,0)
 Q
"RTN","SROACC6",27,0)
PRINT ; print each case
"RTN","SROACC6",28,0)
 I $Y+5>IOSL D HDR^SROACC Q:SRSOUT  D DESC
"RTN","SROACC6",29,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC6",30,0)
 S DFN=$P(^SRF(SRTN,0),"^"),Y=SRSDT D D^DIQ S SRDT=Y
"RTN","SROACC6",31,0)
 I 'SRNON S X=$P(^SRF(SRTN,0),"^",4),SRSS=$S(X:$P(^SRO(137.45,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC6",32,0)
 I SRNON S X=$P(^SRF(SRTN,"NON"),"^",8),SRSS=$S(X:$P(^ECC(723,X,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROACC6",33,0)
 S Y=$P(SRDT,"@",2),SRDT=$E(SRSDT,4,5)_"/"_$E(SRSDT,6,7)_"/"_$E(SRSDT,2,3)_" "_Y
"RTN","SROACC6",34,0)
 D DEM^VADPT S SRNAME=VADM(1),SSN=VA("PID")
"RTN","SROACC6",35,0)
 S SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:""),SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)),SRATT=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",7),1:$P(SR(.1),"^",13))
"RTN","SROACC6",36,0)
 I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>20 S SRSUR=$P(SRSUR,",")_", "_$E($P(SRSUR,",",2))
"RTN","SROACC6",37,0)
 I SRATT S SRATT=$P(^VA(200,SRATT,0),"^") I $L(SRATT)>20 S SRATT=$P(SRATT,",")_", "_$E($P(SRATT,",",2))
"RTN","SROACC6",38,0)
 D OPER^SROACC0
"RTN","SROACC6",39,0)
 K SROP,MM,MMM S:$L(SROPER)<51 SROP(1)=SROPER I $L(SROPER)>50 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROACC6",40,0)
 W !,SRDT,?20,SRNAME,?60,SROP(1),?111,SRSUR,!,?3,SRTN,?20,VA("PID") W:$D(SROP(2)) ?60,SROP(2) W ?111,SRATT,!
"RTN","SROACC6",41,0)
 W:SRFLG=3&(SRNON) "NON-O.R." W ?20,SRSS I $D(SROP(3)) W ?60,SROP(3) I $D(SROP(4)) W !,?60,SROP(4) I $D(SROP(5)) W !,?60,SROP(5)
"RTN","SROACC6",42,0)
 W ! Q
"RTN","SROACC6",43,0)
UTIL ; set ^TMP("SR")
"RTN","SROACC6",44,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACC6",45,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACC6",46,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACC6",47,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2) I CPT=SRCPT S ^TMP("SR",$J,1,SRSDT,SRTN)=""
"RTN","SROACC6",48,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  S CPT=$P($G(^SRF(SRTN,13,OP,2)),"^") I CPT=SRCPT S ^TMP("SR",$J,2,SRSDT,SRTN)=""
"RTN","SROACC6",49,0)
 Q
"RTN","SROACC6",50,0)
LINE W ! F LINE=1:1:132 W "="
"RTN","SROACC6",51,0)
 Q
"RTN","SROACCM")
0^40^B7913619
"RTN","SROACCM",1,0)
SROACCM ;BIR/MAM - TOTAL CPTS ; [ 12/15/98  11:34 AM ]
"RTN","SROACCM",2,0)
 ;;3.0; Surgery ;**59,50,88,127**;24 Jun 93
"RTN","SROACCM",3,0)
EN ; entry when queued
"RTN","SROACCM",4,0)
 U IO S SRSOUT=0,SRINST=SRSITE("SITE") K ^TMP("SR",$J)
"RTN","SROACCM",5,0)
 N SRFRTO S Y=SDATE X ^DD("DD") S SRFRTO="FROM: "_Y_"  TO: " S Y=EDATE X ^DD("DD") S SRFRTO=SRFRTO_Y
"RTN","SROACCM",6,0)
 S SRSDT=SDATE1 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:SRSDT>EDATE1!('SRSDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SROACCM",7,0)
 D HDR Q:SRSOUT
"RTN","SROACCM",8,0)
 S CPT=0 F  S CPT=$O(^TMP("SR",$J,CPT)) Q:'CPT!(SRSOUT)  D PRINT
"RTN","SROACCM",9,0)
 I '$D(^TMP("SR",$J)) W $$NODATA^SROUTL0()
"RTN","SROACCM",10,0)
 Q
"RTN","SROACCM",11,0)
PRINT ; print info
"RTN","SROACCM",12,0)
 I $Y+6>IOSL D PAGE I SRSOUT Q
"RTN","SROACCM",13,0)
 S TOT1=$S($D(^TMP("SR",$J,CPT,1)):^(1),1:0),TOT2=$S($D(^TMP("SR",$J,CPT,2)):^(2),1:0),TOT=TOT1+TOT2
"RTN","SROACCM",14,0)
 S Y=$$CPT^ICPTCOD(CPT,EDATE),CPT1=$P(Y,"^",2)_"  "_$P(Y,"^",3)
"RTN","SROACCM",15,0)
 W !,CPT1,?55,TOT,?79,TOT1,?110,TOT2,! F LINE=1:1:132 W "-"
"RTN","SROACCM",16,0)
 Q
"RTN","SROACCM",17,0)
PAGE I $E(IOST)'="P" W !!,"Press RETURN to continue, or '^' to quit:  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SROACCM",18,0)
HDR ; print heading
"RTN","SROACCM",19,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROACCM",20,0)
 W:$Y @IOF W !,?(132-$L(SRINST)\2),SRINST,!,?57,"SURGICAL SERVICE",?100,"REVIEWED BY",!,?50,"CUMULATIVE REPORT OF CPT CODES",?100,"DATE REVIEWED:"
"RTN","SROACCM",21,0)
 W !,?(132-$L(SRFRTO)\2),SRFRTO
"RTN","SROACCM",22,0)
 W !,$S(SRFLG=1:"O.R. SURGICAL PROCEDURES",SRFLG=2:"NON-O.R. PROCEDURES",1:"O.R. SURGICAL PROCEDURES AND NON-O.R. PROCEDURES")
"RTN","SROACCM",23,0)
 W !!,"CPT CODE - SHORT DESCRIPTION",?50,"TOTAL PROCEDURES",?72,"TOTAL PRINCIPAL PROCEDURES",?104,"TOTAL OTHER PROCEDURES",! F LINE=1:1:132 W "="
"RTN","SROACCM",24,0)
 Q
"RTN","SROACCM",25,0)
UTIL ; set ^TMP("SR")
"RTN","SROACCM",26,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROACCM",27,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROACCM",28,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROACCM",29,0)
 I $P($G(^SRF(SRTN,30)),"^")'="" Q
"RTN","SROACCM",30,0)
 S CPT=$P(^SRF(SRTN,"OP"),"^",2) I CPT S X=$S($D(^TMP("SR",$J,CPT,1)):^(1),1:0),^TMP("SR",$J,CPT,1)=X+1
"RTN","SROACCM",31,0)
 S OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  I $D(^SRF(SRTN,13,OP,2)),$P(^(2),"^") S CPT=$P(^(2),"^") I CPT S X=$S($D(^TMP("SR",$J,CPT,2)):^(2),1:0),^TMP("SR",$J,CPT,2)=X+1
"RTN","SROACCM",32,0)
 Q
"RTN","SROACMP")
0^14^B24648694
"RTN","SROACMP",1,0)
SROACMP ;BIR/ADM-M&M Verification Report ; [ 07/27/98   2:33 PM ]
"RTN","SROACMP",2,0)
 ;;3.0; Surgery ;**47,50,127**;24 Jun 93
"RTN","SROACMP",3,0)
 S DFN=0 F  S DFN=$O(^TMP("SR",$J,DFN)) Q:'DFN  S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,DFN,SRTN)) Q:'SRTN  D UTIL
"RTN","SROACMP",4,0)
 I SRFORM=1,SRSP D SS
"RTN","SROACMP",5,0)
 D HDR^SROACMP1 I $D(^TMP("SR",$J)) S SRPAT="" F  S SRPAT=$O(^TMP("SRPAT",$J,SRPAT)) Q:SRPAT=""  D  Q:SRSOUT  S SRNM=0 I $Y+7<IOSL W !! F LINE=1:1:132 W "-"
"RTN","SROACMP",6,0)
 .S SRX=^(SRPAT),SRNAME=">>> "_SRPAT_" ("_$P(SRX,"^",2)_")",SRDEATH=$P(SRX,"^",3)
"RTN","SROACMP",7,0)
 .I SRDEATH S SRNAME=SRNAME_" - DIED "_$E(SRDEATH,4,5)_"/"_$E(SRDEATH,6,7)_"/"_$E(SRDEATH,2,3) S X=$E(SRDEATH,9,12) I X S X=X_"000",SRNAME=SRNAME_"@"_$E(X,1,2)_":"_$E(X,3,4)
"RTN","SROACMP",8,0)
 .I $Y+9>IOSL D HDR^SROACMP1 I SRSOUT Q
"RTN","SROACMP",9,0)
 .W !,SRNAME S SRNM=1,DFN=$P(SRX,"^"),SRTN=0 F  S SRTN=$O(^TMP("SR",$J,DFN,SRTN)) Q:'SRTN!SRSOUT  D SET
"RTN","SROACMP",10,0)
 G:SRSOUT END^SROACMP1 I '$D(^TMP("SR",$J)) W !!,"There are no perioperative occurrences or deaths recorded for ",$S(SRFORM=1:"surgeries performed in the selected date range.",1:"completed assessments not yet transmitted.")
"RTN","SROACMP",11,0)
 D HDR2^SROACMP1,END^SROACMP1
"RTN","SROACMP",12,0)
 Q
"RTN","SROACMP",13,0)
UTIL ; list all cases within 90 days prior to postop occurrence and/or death
"RTN","SROACMP",14,0)
 S SRPOST=0 F  S SRPOST=$O(^SRF(SRTN,16,SRPOST)) Q:'SRPOST  S SRDATE=$E($P(^SRF(SRTN,16,SRPOST,0),"^",7),1,7) I SRDATE S SRBACK=-30 D PRIOR
"RTN","SROACMP",15,0)
 D DEM^VADPT S ^TMP("SRPAT",$J,VADM(1))=DFN_"^"_VA("PID")_"^"_$P(VADM(6),"^")
"RTN","SROACMP",16,0)
 S SRDATE=$P(VADM(6),"^") I SRDATE S SRBACK=-90 D PRIOR
"RTN","SROACMP",17,0)
 Q
"RTN","SROACMP",18,0)
PRIOR ; list cases in 30 days before this occurrence or 90 days before death
"RTN","SROACMP",19,0)
 S X1=SRDATE,X2=SRBACK D C^%DTC S SDATE=X,SRCASE=0 F  S SRCASE=$O(^SRF("B",DFN,SRCASE)) Q:'SRCASE  I '$D(^TMP("SR",$J,DFN,SRCASE)) D
"RTN","SROACMP",20,0)
 .I $D(^XUSEC("SROCHIEF",+DUZ)) Q:'$$MANDIV^SROUTL0(SRINSTP,SRTN)
"RTN","SROACMP",21,0)
 .I '$D(^XUSEC("SROCHIEF",+DUZ)) Q:'$$DIV^SROUTL0(SRTN)
"RTN","SROACMP",22,0)
 .I '$P($G(^SRF(SRCASE,.2)),"^",12)!$P($G(^SRF(SRCASE,30)),"^")!($P($G(^SRF(SRCASE,"NON")),"^")="Y") Q
"RTN","SROACMP",23,0)
 .S SRX=$E($P(^SRF(SRCASE,0),"^",9),1,7) I SRX<SDATE!(SRX>SRDATE) Q
"RTN","SROACMP",24,0)
 .S ^TMP("SR",$J,DFN,SRCASE)=$P(^SRF(SRCASE,0),"^",4)
"RTN","SROACMP",25,0)
 Q
"RTN","SROACMP",26,0)
SET ; set variables to print
"RTN","SROACMP",27,0)
 S SR(0)=^SRF(SRTN,0),(SRD,Y)=$P(SR(0),"^",9),SRSDATE=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3),Y=$P(SR(0),"^",4) I Y S SRSS=$E($P($P(^SRO(137.45,Y,0),"^")," "),1,13),SRSS=$P(SRSS," "),SRSS=$P(SRSS,"(")
"RTN","SROACMP",28,0)
OPS S SROPER=$P(^SRF(SRTN,"OP"),"^"),OPER=0 F  S OPER=$O(^SRF(SRTN,13,OPER)) Q:OPER=""  D OTHER
"RTN","SROACMP",29,0)
 K SRP,Z S:$L(SROPER)<40 SRP(1)=SROPER I $L(SROPER)>39 S SROPER=SROPER_"  " F M=1:1 D OPER Q:Z=""
"RTN","SROACMP",30,0)
 S SRCHK=0 I SRDEATH S X1=SRDEATH,X2=-90 D C^%DTC I SRD<X S SRCHK=1,SRREL="N/A"
"RTN","SROACMP",31,0)
 I 'SRCHK S X=$P($G(^SRF(SRTN,.4)),"^",7),SRREL=$S(SRDEATH="":"N/A",X="U":"NO",X="R":"YES",1:" ?")
"RTN","SROACMP",32,0)
COMP ; perioperative occurrences
"RTN","SROACMP",33,0)
 K SRC S (SRFG,SRIC)=0 F  S SRIC=$O(^SRF(SRTN,10,SRIC)) Q:SRIC=""  S SRFG=SRFG+1,SRO=^SRF(SRTN,10,SRIC,0),SRICD=$P(SRO,"^",3) D
"RTN","SROACMP",34,0)
 .S Y=SRD D DATE S SRCAT=$P(SRO,"^",2) Q:'SRCAT  S SRC(SRFG)=$P(^SRO(136.5,SRCAT,0),"^")_" "_SRY
"RTN","SROACMP",35,0)
 .I SRICD S SRICDN=$$ICDDX^ICDCODE(SRICD,$P($G(^SRF(SRTN,0)),"^",9)),SRFG=SRFG+1,SRC(SRFG)="  ICD: "_$P(SRICDN,"^",2)_"  "_$P(SRICDN,"^",4)
"RTN","SROACMP",36,0)
 S SRPC=0 F  S SRPC=$O(^SRF(SRTN,16,SRPC)) Q:SRPC=""  S SRFG=SRFG+1,SRO=^SRF(SRTN,16,SRPC,0),SRICD=$P(SRO,"^",3) D
"RTN","SROACMP",37,0)
 .S Y=$E($P(SRO,"^",7),1,7) D DATE S SRCAT=$P(SRO,"^",2) Q:'SRCAT  S SRC(SRFG)=$P(^SRO(136.5,SRCAT,0),"^")_" * "_SRY
"RTN","SROACMP",38,0)
 .I SRICD S SRICDN=$$ICDDX^ICDCODE(SRICD,$P($G(^SRF(SRTN,0)),"^",9)),SRFG=SRFG+1,SRC(SRFG)="  ICD: "_$P(SRICDN,"^",2)_"  "_$P(SRICDN,"^",4)
"RTN","SROACMP",39,0)
RA ; risk assessment type and status
"RTN","SROACMP",40,0)
 S SRA=$G(^SRF(SRTN,"RA")),SRSTATUS=$P(SRA,"^"),SRTYPE=$P(SRA,"^",2),SRYN=$P(SRA,"^",6),SRE=$P(SRA,"^",7) D
"RTN","SROACMP",41,0)
 .I SRTYPE="" S SRA="NON-ASSESSED" Q
"RTN","SROACMP",42,0)
 .S SRA=$S(SRTYPE="C":"CARDIAC",SRYN="Y":"NON-CARD",1:"EXCLUDED")_"/"_SRSTATUS
"RTN","SROACMP",43,0)
PRINT ; print case information
"RTN","SROACMP",44,0)
 I $Y+8>IOSL D HDR^SROACMP1 I SRSOUT Q
"RTN","SROACMP",45,0)
 W !!,SRSDATE,?11,SRSS,?25,SRP(1),?69,SRREL W:$D(SRC(1)) ?75,SRC(1) W ?120,SRA
"RTN","SROACMP",46,0)
 F SRC=2:1 Q:'$D(SRP(SRC))&'$D(SRC(SRC))  D  Q:SRSOUT
"RTN","SROACMP",47,0)
 .I $Y+6>IOSL D HDR^SROACMP1 I SRSOUT Q
"RTN","SROACMP",48,0)
 .W ! W:$D(SRP(SRC)) ?25,SRP(SRC) W:$D(SRC(SRC)) ?75,SRC(SRC)
"RTN","SROACMP",49,0)
 Q
"RTN","SROACMP",50,0)
OTHER ; other operations
"RTN","SROACMP",51,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRTN,13,OPER,0),"^"))>250 S SRLONG=0,OPER=999,SROPERS=" ..."
"RTN","SROACMP",52,0)
 I SRLONG S SROPERS=$P(^SRF(SRTN,13,OPER,0),"^")
"RTN","SROACMP",53,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROACMP",54,0)
 Q
"RTN","SROACMP",55,0)
OPER ; break procedure if greater than 40 characters
"RTN","SROACMP",56,0)
 S SRP(M)="" F LOOP=1:1 S Z=$P(SROPER," ") Q:Z=""  Q:$L(SRP(M))+$L(Z)'<40  S SRP(M)=SRP(M)_Z_" ",SROPER=$P(SROPER," ",2,200)
"RTN","SROACMP",57,0)
 Q
"RTN","SROACMP",58,0)
DATE S SRY=$S(Y:" ("_$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)_")",1:" (NO DATE)")
"RTN","SROACMP",59,0)
 Q
"RTN","SROACMP",60,0)
SS ; set up ^TMP for selected specialties
"RTN","SROACMP",61,0)
 K ^TMP("SRSP",$J) S SRQ=0,SRNAME="" F  S SRNAME=$O(^TMP("SRPAT",$J,SRNAME)) Q:SRNAME=""  S DFN=$P(^TMP("SRPAT",$J,SRNAME),"^"),(SRQ,SRTN)=0 D
"RTN","SROACMP",62,0)
 .F  S SRTN=$O(^TMP("SR",$J,DFN,SRTN)) Q:'SRTN  D  Q:SRQ
"RTN","SROACMP",63,0)
 ..S Y=$P(^SRF(SRTN,0),"^",4) S:'Y Y="ZZ" I $D(SRSP(Y)) S ^TMP("SRSP",$J,DFN)="",SRQ=1 Q
"RTN","SROACMP",64,0)
 S SRNAME="" F  S SRNAME=$O(^TMP("SRPAT",$J,SRNAME)) Q:SRNAME=""  S DFN=$P(^TMP("SRPAT",$J,SRNAME),"^") I '$D(^TMP("SRSP",$J,DFN)) K ^TMP("SR",$J,DFN),^TMP("SRPAT",$J,SRNAME)
"RTN","SROACMP",65,0)
 Q
"RTN","SROAOSET")
0^16^B3998437
"RTN","SROAOSET",1,0)
SROAOSET ;B'HAM ISC/MAM - SET SRAO ARRAY ; 17 MAR 1992 1:55 pm
"RTN","SROAOSET",2,0)
 ;;3.0; Surgery ;**127**;24 Jun 93
"RTN","SROAOSET",3,0)
 S SRA(0)=^SRF(SRTN,0),SRA(34)=$G(^SRF(SRTN,34)),X=$P(SRA(34),"^",2) S:X X=$$ICDDX^ICDCODE(X,$P(SRA(0),"^",9)),X=$P(X,"^",2)_"   "_$P(X,"^",4) S SRAO(1)=X_"^66" K SRA(34)
"RTN","SROAOSET",4,0)
 S SRA(205)=$G(^SRF(SRTN,205)),X=$P(SRA(205),"^") S:X X=X_" DAYS" S SRAO(2)=X_"^247"
"RTN","SROAOSET",5,0)
 S X=$P(SRA(205),"^",2),X=$S(X="":"",X=1:"DISCHARGED ALIVE",X=2:"DIED IN HOSPITAL",X=3:"REMAINS IN VAMC FACILITY",X=4:"TRANSFERRED TO ANOTHER VAMC",X=5:"READMITTED",X="NS":"NO STUDY",1:"")
"RTN","SROAOSET",6,0)
 S SRAO(3)=X_"^341"
"RTN","SROAOSET",7,0)
DISP W @IOF,!,SRANAME,?65,"PAGE: 1",! F MOE=1:1:80 W "-"
"RTN","SROAOSET",8,0)
 W !,"1. Postoperative Diagnosis Code (ICD9):",?43,$P(SRAO(1),"^"),!,"2. Length of Postoperative Hospital Stay:",?43,$P(SRAO(2),"^"),!,"3. 30 Day Postoperative Status:",?43,$P(SRAO(3),"^")
"RTN","SROAOSET",9,0)
 W ! F MOE=1:1:80 W "-"
"RTN","SROAOSET",10,0)
 Q
"RTN","SROAOSET",11,0)
YN ;
"RTN","SROAOSET",12,0)
 S SHEMP=$S(NYUK="NS":"NS",NYUK="N":"NO",NYUK="Y":"YES",1:"")
"RTN","SROAOSET",13,0)
 Q
"RTN","SROAPRT6")
0^17^B6227160
"RTN","SROAPRT6",1,0)
SROAPRT6 ;BIR/MAM - PRINT OUTCOME INFO ; [ 08/25/99  1:18 PM ]
"RTN","SROAPRT6",2,0)
 ;;3.0; Surgery ;**38,47,88,127**;24 Jun 93
"RTN","SROAPRT6",3,0)
 K SRA S SRA(34)=$G(^SRF(SRTN,34)),X=$P(SRA(34),"^",2) S:X X=$$ICDDX^ICDCODE(X,$P($G(^SRF(SRTN,0)),"^",9)),X=$P(X,"^",2)_"   "_$P(X,"^",4) S SRAO(1)=X_"^66"
"RTN","SROAPRT6",4,0)
 S SRA(205)=$G(^SRF(SRTN,205)),X=$P(SRA(205),"^") I X'="" S X=$S(X="NA":"NA",1:X_" DAYS")
"RTN","SROAPRT6",5,0)
 S SRAO(2)=X_"^247"
"RTN","SROAPRT6",6,0)
 S Y=$P($G(^DPT(DFN,.35)),"^"),SRDEAD=Y I Y D D^DIQ S SRDEAD=Y
"RTN","SROAPRT6",7,0)
 S SRAO(3)=SRDEAD,NYUK="N",SRET=0 K SRCPT
"RTN","SROAPRT6",8,0)
 F  S SRET=$O(^SRF(SRTN,29,SRET)) Q:'SRET  S CASE=$P(^SRF(SRTN,29,SRET,0),"^"),SRC=$P($G(^SRF(CASE,"OP")),"^",2) I $P($G(^SRF(CASE,.2)),"^",10),SRC D
"RTN","SROAPRT6",9,0)
 .S Y=$P($$CPT^ICPTCOD(SRC),"^",2) D MOD
"RTN","SROAPRT6",10,0)
 .S NYUK="Y",SRCPT(SRC)=Y
"RTN","SROAPRT6",11,0)
 S $P(^SRF(SRTN,205),"^",4)=NYUK D YN S SRAO(4)=SHEMP_"^262" F I="6A","6B","6C","6D","6E","6F","7A","7B","7C","7D","7E","7F" S SRAO(I)=""
"RTN","SROAPRT6",12,0)
DISP ;
"RTN","SROAPRT6",13,0)
 W !,?27,"OUTCOME INFORMATION"
"RTN","SROAPRT6",14,0)
 W !!,$J("Postoperative Diagnosis Code (ICD9): ",39)_$P(SRAO(1),"^"),!,$J("Length of Postoperative Hospital Stay: ",39)_$P(SRAO(2),"^")
"RTN","SROAPRT6",15,0)
 W !,$J("Date of Death: ",39)_$P(SRAO(3),"^")
"RTN","SROAPRT6",16,0)
 I SRAO(3)'="" S X1=$P(^SRF(SRTN,0),"^",9),X2=90 D C^%DTC D
"RTN","SROAPRT6",17,0)
 .I $P($G(^DPT(DFN,.35)),"^")'>X W !,$J("Death Unrelated/Related: ",39)_$S($P($G(^SRF(SRTN,.4)),"^",7)="R":"RELATED",$P($G(^SRF(SRTN,.4)),"^",7)="U":"UNRELATED",1:"")
"RTN","SROAPRT6",18,0)
 .I $P($G(^DPT(DFN,.35)),"^")>X W !,$J("Death Unrelated/Related: ",39)_"N/A"
"RTN","SROAPRT6",19,0)
 W !,$J("Return to OR Within 30 Days: ",39)_$P(SRAO(4),"^")
"RTN","SROAPRT6",20,0)
 D RET W:$E(IOST)="P" ! I $Y+24>IOSL D PAGE^SROAPAS I SRSOUT Q
"RTN","SROAPRT6",21,0)
 D ^SROAPRT7
"RTN","SROAPRT6",22,0)
 Q
"RTN","SROAPRT6",23,0)
MOD ;; append CPT modifiers to CPT code
"RTN","SROAPRT6",24,0)
 N SRTN S SRTN=CASE D SSPRIN^SROCPT
"RTN","SROAPRT6",25,0)
 Q
"RTN","SROAPRT6",26,0)
YN ;
"RTN","SROAPRT6",27,0)
 S SHEMP=$S(NYUK="NS":"NS",NYUK="N":"NO",NYUK="Y":"YES",1:"")
"RTN","SROAPRT6",28,0)
 Q
"RTN","SROAPRT6",29,0)
RET ; print returns
"RTN","SROAPRT6",30,0)
 S X=0 F  S X=$O(SRCPT(X)) Q:'X  W !,?15,"CPT Code: "_SRCPT(X)
"RTN","SROAPRT6",31,0)
 Q
"RTN","SROAR1")
0^18^B16973018
"RTN","SROAR1",1,0)
SROAR1 ;BIR/MAM - ANNUAL REPORT, ALL SPECIALTIES ; [ 11/17/99  6:25 AM ]
"RTN","SROAR1",2,0)
 ;;3.0; Surgery ;**34,50,88,127**;24 Jun 93
"RTN","SROAR1",3,0)
 S (GRAND,GMAJ,GMIN,GMAS,GMAR,GMIS,GMIR)=0 K ^TMP("SR",$J) S PAGE=1
"RTN","SROAR1",4,0)
 D HDR Q:SRHALT  S SRSDATE=SDATE1 F  S SRSDATE=$O(^SRF("AC",SRSDATE)) Q:SRSDATE>EDATE1!('SRSDATE)!SRHALT  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDATE,SRTN)) Q:'SRTN!SRHALT  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D SET
"RTN","SROAR1",5,0)
 S SRSS=0 F  S SRSS=$O(^TMP("SR",$J,SRSS)) Q:SRSS=""!SRHALT  D SPEC S SRCPT=0 F  S SRCPT=$O(^TMP("SR",$J,SRSS,SRCPT)) D:SRCPT="" TOTS Q:SRCPT=""!SRHALT  D OUT
"RTN","SROAR1",6,0)
 W !!! F LINE=1:1:132 W "="
"RTN","SROAR1",7,0)
 D:$Y+6>IOSL HDR Q:SRHALT  W !!,"TOTAL OPERATIONS:",?50,GRAND,?68,GMAS,?77,GMAR,?88,GMAJ,?103,GMIS,?112,GMIR,?124,GMIN,!! F I=1:1:132 W "="
"RTN","SROAR1",8,0)
 Q
"RTN","SROAR1",9,0)
SPEC ; specialty heading
"RTN","SROAR1",10,0)
 D:$Y+5>IOSL HDR Q:SRHALT  W !,?(132-$L(SRSS)\2),SRSS,! F LINE=1:1:132 W "-"
"RTN","SROAR1",11,0)
 S (TOTAL,TOTMAJ,TOTMIN,TOTMAS,TOTMAR,TOTMIS,TOTMIR)=0
"RTN","SROAR1",12,0)
 Q
"RTN","SROAR1",13,0)
HDR ; print heading
"RTN","SROAR1",14,0)
 I $D(ZTQUEUED) D ^SROSTOP Q:SRHALT
"RTN","SROAR1",15,0)
 W:$Y @IOF W !,?(132-$L(SRINST)\2),SRINST,?120,"PAGE: "_PAGE,!,?58,"SURGICAL SERVICE",?100,"REVIEWED BY:",!,?48,"ANNUAL REPORT OF SURGICAL PROCEDURES",?100,"DATE REVIEWED:"
"RTN","SROAR1",16,0)
 W !,?(132-$L(SRFRTO)\2),SRFRTO,?100,SRPRINT
"RTN","SROAR1",17,0)
 W !!,?75,"MAJOR",?110,"MINOR",!,"CPT CODE - OPERATION",?48,"TOTAL",?67,"STAFF",?74,"RESIDENT",?87,"TOTAL",?102,"STAFF",?109,"RESIDENT",?122,"TOTAL",! F I=1:1:132 W "-"
"RTN","SROAR1",18,0)
 S PAGE=PAGE+1
"RTN","SROAR1",19,0)
 Q
"RTN","SROAR1",20,0)
OUT ; print info
"RTN","SROAR1",21,0)
 K MAJR,MAJS,MAJT,MINR,MINS,MINT I $Y+5>IOSL D HDR Q:SRHALT  W !,?(132-$L(SRSS)\2),SRSS,! F LINE=1:1:132 W "-"
"RTN","SROAR1",22,0)
 S SRCPT("NAME")=SRCPT_" "_^TMP("SR",$J,SRSS,SRCPT)
"RTN","SROAR1",23,0)
 S (MAJS,MAJR,MINS,MINR)=0
"RTN","SROAR1",24,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"J","S")) S MAJS=^("S")
"RTN","SROAR1",25,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"J","R")) S MAJR=^("R")
"RTN","SROAR1",26,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"N","S")) S MINS=^("S")
"RTN","SROAR1",27,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"N","R")) S MINR=^("R")
"RTN","SROAR1",28,0)
 S MAJT=MAJR+MAJS,MINT=MINR+MINS,SUBT=MAJT+MINT,TOTAL=TOTAL+SUBT,TOTMAJ=TOTMAJ+MAJT,TOTMIN=TOTMIN+MINT,TOTMAS=TOTMAS+MAJS,TOTMAR=TOTMAR+MAJR,TOTMIS=TOTMIS+MINS,TOTMIR=TOTMIR+MINR
"RTN","SROAR1",29,0)
 W !,SRCPT("NAME"),?50,SUBT,?68,MAJS,?77,MAJR,?88,MAJT,?103,MINS,?112,MINR,?124,MINT
"RTN","SROAR1",30,0)
 Q
"RTN","SROAR1",31,0)
SET ; set local variables
"RTN","SROAR1",32,0)
 Q:'$D(^SRF(SRTN,.2))  I $P(^SRF(SRTN,.2),"^",12)="" Q
"RTN","SROAR1",33,0)
 I $D(^SRF(SRTN,30)),$P(^(30),"^")'="" Q
"RTN","SROAR1",34,0)
 I $D(^SRF(SRTN,31)),$P(^(31),"^",8)'="" Q
"RTN","SROAR1",35,0)
 K CPT S SR(0)=^SRF(SRTN,0),SRSS=$P(SR(0),"^",4) S SRSS=$S(SRSS:$P(^SRO(137.45,SRSS,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SROAR1",36,0)
 S SRMAJ=$P(SR(0),"^",3) S:SRMAJ="" SRMAJ="N"
"RTN","SROAR1",37,0)
 S SRATT=$P($G(^SRF(SRTN,.1)),"^",3) S:SRATT="" SRATT="R"
"RTN","SROAR1",38,0)
 S (CPT,CNT)=0 F  S CPT=$O(^SRF(SRTN,13,CPT)) Q:CPT=""  S CNT=CNT+1 S Y=$P($G(^SRF(SRTN,13,CPT,2)),"^") I Y S X=$$CPT^ICPTCOD(Y,$P(^SRF(SRTN,0),"^",9)),CPT(CNT)=$P(X,"^",2,3)
"RTN","SROAR1",39,0)
 S CPT("*")=$P(^SRF(SRTN,"OP"),"^",2) I CPT("*")'="" S X=$$CPT^ICPTCOD(CPT("*"),$P(^SRF(SRTN,0),"^",9)),CPT("*")=$P(X,"^",2,3)
"RTN","SROAR1",40,0)
 S CPT=0 F  S CPT=$O(CPT(CPT)) Q:CPT=""  I CPT(CPT)'="" D SETUTL
"RTN","SROAR1",41,0)
 Q
"RTN","SROAR1",42,0)
SETUTL ; set ^TMP("SR",$J)
"RTN","SROAR1",43,0)
 S SRCPT=$P(CPT(CPT),"^"),FLAG=0
"RTN","SROAR1",44,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,SRMAJ,SRATT)) S ^TMP("SR",$J,SRSS,SRCPT,SRMAJ,SRATT)=^TMP("SR",$J,SRSS,SRCPT,SRMAJ,SRATT)+1,FLAG=1
"RTN","SROAR1",45,0)
 I FLAG Q
"RTN","SROAR1",46,0)
 S ^TMP("SR",$J,SRSS,SRCPT,SRMAJ,SRATT)=1,^TMP("SR",$J,SRSS,SRCPT)=$P(CPT(CPT),"^",2)
"RTN","SROAR1",47,0)
 Q
"RTN","SROAR1",48,0)
TOTS W !!! F I=1:1:132 W "-"
"RTN","SROAR1",49,0)
 D:$Y+5>IOSL HDR Q:SRHALT  W !,"TOTALS FOR "_SRSS_": ",?50,TOTAL,?68,TOTMAS,?77,TOTMAR,?88,TOTMAJ,?103,TOTMIS,?112,TOTMIR,?124,TOTMIN,! F LINE=1:1:132 W "-"
"RTN","SROAR1",50,0)
GRAND S GRAND=GRAND+TOTAL,GMAS=GMAS+TOTMAS,GMAR=GMAR+TOTMAR,GMIS=GMIS+TOTMIS,GMIR=GMIR+TOTMIR,GMAJ=GMAJ+TOTMAJ,GMIN=GMIN+TOTMIN
"RTN","SROAR1",51,0)
 Q
"RTN","SROAR2")
0^19^B14923181
"RTN","SROAR2",1,0)
SROAR2 ;BIR/MAM - ANNUAL REPORT, ONE SPECIALTY ; [ 11/17/99  6:46 AM ]
"RTN","SROAR2",2,0)
 ;;3.0; Surgery ;**34,60,50,88,127**;24 Jun 93
"RTN","SROAR2",3,0)
 S SRSP=$P(^SRO(137.45,SRSS,0),"^"),(GRAND,GMAJ,GMIN,GMAS,GMAR,GMIS,GMIR)=0,PAGE=1 K ^TMP("SR",$J)
"RTN","SROAR2",4,0)
 D HDR Q:SRHALT  S SRSDATE=SDATE1 F  S SRSDATE=$O(^SRF("AC",SRSDATE)) Q:SRSDATE>EDATE1!('SRSDATE)!SRHALT  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDATE,SRTN)) Q:'SRTN!SRHALT  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D SET
"RTN","SROAR2",5,0)
 W !,?(132-$L(SRSP)\2),SRSP,! F LINE=1:1:132 W "-"
"RTN","SROAR2",6,0)
 S (TOTAL,TOTMAJ,TOTMIN,TOTMAS,TOTMAR,TOTMIS,TOTMIR)=0
"RTN","SROAR2",7,0)
 S SRCPT=0 F  S SRCPT=$O(^TMP("SR",$J,SRSS,SRCPT)) D:SRCPT="" TOTS Q:SRCPT=""  D OUT
"RTN","SROAR2",8,0)
 Q
"RTN","SROAR2",9,0)
HDR ; print heading
"RTN","SROAR2",10,0)
 I $D(ZTQUEUED) D ^SROSTOP Q:SRHALT
"RTN","SROAR2",11,0)
 W:$Y @IOF W !,?(132-$L(SRINST)\2),SRINST,?120,"PAGE: "_PAGE,!,?58,"SURGICAL SERVICE",?100,"REVIEWED BY:",!,?48,"ANNUAL REPORT OF SURGICAL PROCEDURES",?100,"DATE REVIEWED:"
"RTN","SROAR2",12,0)
 W !,?(132-$L(SRFRTO)\2),SRFRTO,?100,SRPRINT
"RTN","SROAR2",13,0)
 W !!,?75,"MAJOR",?110,"MINOR",!,"CPT CODE - OPERATION",?48,"TOTAL",?67,"STAFF",?74,"RESIDENT",?87,"TOTAL",?102,"STAFF",?109,"RESIDENT",?122,"TOTAL",! F I=1:1:132 W "-"
"RTN","SROAR2",14,0)
 S PAGE=PAGE+1
"RTN","SROAR2",15,0)
 Q
"RTN","SROAR2",16,0)
OUT ; print info
"RTN","SROAR2",17,0)
 K MAJR,MAJS,MAJT,MINR,MINS,MINT I $Y+5>IOSL D HDR Q:SRHALT  W !,?(132-$L(SRSS)\2),SRSS,! F LINE=1:1:132 W "-"
"RTN","SROAR2",18,0)
 S SRCPT("NAME")=SRCPT_" "_^TMP("SR",$J,SRSS,SRCPT)
"RTN","SROAR2",19,0)
 S (MAJS,MAJR,MINS,MINR)=0
"RTN","SROAR2",20,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"J","S")) S MAJS=^("S")
"RTN","SROAR2",21,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"J","R")) S MAJR=^("R")
"RTN","SROAR2",22,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"N","S")) S MINS=^("S")
"RTN","SROAR2",23,0)
 I $D(^TMP("SR",$J,SRSS,SRCPT,"N","R")) S MINR=^("R")
"RTN","SROAR2",24,0)
 S MAJT=MAJR+MAJS,MINT=MINR+MINS,SUBT=MAJT+MINT,TOTAL=TOTAL+SUBT,TOTMAJ=TOTMAJ+MAJT,TOTMIN=TOTMIN+MINT,TOTMAS=TOTMAS+MAJS,TOTMAR=TOTMAR+MAJR,TOTMIS=TOTMIS+MINS,TOTMIR=TOTMIR+MINR
"RTN","SROAR2",25,0)
 W !,SRCPT("NAME"),?50,SUBT,?68,MAJS,?77,MAJR,?88,MAJT,?103,MINS,?112,MINR,?124,MINT
"RTN","SROAR2",26,0)
 Q
"RTN","SROAR2",27,0)
SET ; set local variables
"RTN","SROAR2",28,0)
 Q:'$D(^SRF(SRTN,.2))  I $P(^SRF(SRTN,.2),"^",12)="" Q
"RTN","SROAR2",29,0)
 I $D(^SRF(SRTN,30)),$P(^(30),"^")'="" Q
"RTN","SROAR2",30,0)
 I $D(^SRF(SRTN,31)),$P(^(31),"^",8)'="" Q
"RTN","SROAR2",31,0)
 S SR(0)=^SRF(SRTN,0),X=$P(SR(0),"^",4) Q:'X  S SRSPEC=X I SRSPEC'=SRSS Q
"RTN","SROAR2",32,0)
 K CPT S SRMAJ=$P(SR(0),"^",3) S:SRMAJ="" SRMAJ="N"
"RTN","SROAR2",33,0)
 S SRATT=$P($G(^SRF(SRTN,.1)),"^",3) S:SRATT="" SRATT="R"
"RTN","SROAR2",34,0)
 S (CPT,CNT)=0 F  S CPT=$O(^SRF(SRTN,13,CPT)) Q:CPT=""  S CNT=CNT+1 S Y=$P($G(^SRF(SRTN,13,CPT,2)),"^") I Y S X=$$CPT^ICPTCOD(Y,$P(^SRF(SRTN,0),"^",9)),CPT(CNT)=$P(X,"^",2,3)
"RTN","SROAR2",35,0)
 S CPT("*")=$P(^SRF(SRTN,"OP"),"^",2) I CPT("*")'="" S X=$$CPT^ICPTCOD(CPT("*"),$P(^SRF(SRTN,0),"^",9)),CPT("*")=$P(X,"^",2,3)
"RTN","SROAR2",36,0)
 S CPT=0 F  S CPT=$O(CPT(CPT)) Q:CPT=""  I CPT(CPT)'="" D SETUTL
"RTN","SROAR2",37,0)
 Q
"RTN","SROAR2",38,0)
SETUTL ; set ^TMP("SR",$J)
"RTN","SROAR2",39,0)
 S SRCPT=$P(CPT(CPT),"^"),FLAG=0
"RTN","SROAR2",40,0)
 I $D(^TMP("SR",$J,SRSPEC,SRCPT,SRMAJ,SRATT)) S ^TMP("SR",$J,SRSPEC,SRCPT,SRMAJ,SRATT)=^TMP("SR",$J,SRSPEC,SRCPT,SRMAJ,SRATT)+1,FLAG=1
"RTN","SROAR2",41,0)
 I FLAG Q
"RTN","SROAR2",42,0)
 S ^TMP("SR",$J,SRSPEC,SRCPT,SRMAJ,SRATT)=1,^TMP("SR",$J,SRSPEC,SRCPT)=$P(CPT(CPT),"^",2)
"RTN","SROAR2",43,0)
 Q
"RTN","SROAR2",44,0)
TOTS W !!! F I=1:1:132 W "="
"RTN","SROAR2",45,0)
 D:$Y+5>IOSL HDR Q:SRHALT  W !,"TOTALS FOR "_SRSP_": ",?50,TOTAL,?68,TOTMAS,?77,TOTMAR,?88,TOTMAJ,?103,TOTMIS,?112,TOTMIR,?124,TOTMIN,! F LINE=1:1:132 W "="
"RTN","SROAR2",46,0)
GRAND S GRAND=GRAND+TOTAL,GMAS=GMAS+TOTMAS,GMAR=GMAR+TOTMAR,GMIS=GMIS+TOTMIS,GMIR=GMIR+TOTMIR,GMAJ=GMAJ+TOTMAJ,GMIN=GMIN+TOTMIN
"RTN","SROAR2",47,0)
 Q
"RTN","SROCPT")
0^21^B12587576
"RTN","SROCPT",1,0)
SROCPT ;BIR/MAM,ADM - PRINT DESCRIPTION OF CPT CODE ON LOOKUP ; [ 05/14/99  11:28 AM ]
"RTN","SROCPT",2,0)
 ;;3.0; Surgery ;**3,31,88,127**;24 Jun 93
"RTN","SROCPT",3,0)
1 N SRCODE,SRDA,SRDATE,SRDES,SRI,SRX
"RTN","SROCPT",4,0)
 S SRDATE=DT
"RTN","SROCPT",5,0)
 S SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:"")
"RTN","SROCPT",6,0)
 I $G(SRDA) S SRDATE=$P($G(^SRF(SRDA,0)),"^",9)
"RTN","SROCPT",7,0)
 S SRDATE=$S($G(ICPTVDT):ICPTVDT,1:SRDATE)
"RTN","SROCPT",8,0)
 S SRCODE=Y,SRX=$$CPTD^ICPTCOD(SRCODE,"SRDES",,SRDATE)
"RTN","SROCPT",9,0)
 F SRI=1:1:SRX D:$TR(SRDES(SRI)," ")'="" EN^DDIOL(SRDES(SRI),"","!,?1")
"RTN","SROCPT",10,0)
 Q
"RTN","SROCPT",11,0)
DISPLAY ; output principal CPT
"RTN","SROCPT",12,0)
 I $D(Y),Y="" Q
"RTN","SROCPT",13,0)
 N SRCODE,SRCPT,SRDA,SRDES,SRI,SRK,SRP,SRW,SRX,SRY,SRZ
"RTN","SROCPT",14,0)
 S Y=$P($$CPT^ICPTCOD(Y),"^",2),SRDA=$S($D(SRTN):SRTN,1:"") Q:SRDA=""
"RTN","SROCPT",15,0)
 I $D(QPQPQ) D SSPRIN Q
"RTN","SROCPT",16,0)
 D DES I '$O(^SRF(SRDA,"OPMOD",0)) Q
"RTN","SROCPT",17,0)
 S SRCPT="Principal CPT Code: "_SRW D EN^DDIOL(SRCPT,"","!,?6")
"RTN","SROCPT",18,0)
 S SRX="Modifiers: -"
"RTN","SROCPT",19,0)
 S SRI=0 F  S SRI=$O(^SRF(SRDA,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROCPT",20,0)
 .S SRZ=$P(^SRF(SRDA,"OPMOD",SRI,0),"^"),SRY=$$MOD^ICPTMOD(SRZ,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRX=SRX_$P(SRY,"^",2)_" "_$E($P(SRY,"^",3),1,57) D EN^DDIOL(SRX,"","!,?7") S SRX="           -"
"RTN","SROCPT",21,0)
 Q
"RTN","SROCPT",22,0)
OTHDISP ; output other procedure CPT
"RTN","SROCPT",23,0)
 I $D(Y),Y="" Q
"RTN","SROCPT",24,0)
 N SRCODE,SRCPT,SRDA,SRDES,SRI,SRK,SRP,SRW,SRX,SRY,SRZ
"RTN","SROCPT",25,0)
 S SRDA(1)=$S($D(SRTN):SRTN,1:""),SRDA=$S($D(DA):DA,1:"") Q:SRDA(1)=""!(SRDA="")
"RTN","SROCPT",26,0)
 I $D(QPQPQ) D SSOTH Q
"RTN","SROCPT",27,0)
 D DES I '$O(^SRF(SRDA(1),13,SRDA,"MOD",0)) Q
"RTN","SROCPT",28,0)
 S SRCPT="Other CPT Code: "_SRW D EN^DDIOL(SRCPT,"","!,?6")
"RTN","SROCPT",29,0)
 S SRX="Modifiers: -"
"RTN","SROCPT",30,0)
 S SRI=0 F  S SRI=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRI)) Q:'SRI  D
"RTN","SROCPT",31,0)
 .S SRZ=$P(^SRF(SRDA(1),13,SRDA,"MOD",SRI,0),"^"),SRY=$$MOD^ICPTMOD(SRZ,"I",$P($G(^SRF(SRDA(1),0)),"^",9)),SRX=SRX_$P(SRY,"^",2)_" "_$E($P(SRY,"^",3),1,57) D EN^DDIOL(SRX,"","!,?7") S SRX="           -"
"RTN","SROCPT",32,0)
 Q
"RTN","SROCPT",33,0)
DES ; get short name and description
"RTN","SROCPT",34,0)
 N X,Z,SRDAA,SRDD S (SRCODE,SRK)=Y,SRDAA=$S($D(SRTN):SRTN,$D(SRDA(1)):SRDA(1),$D(SRDA):SRDA,1:"")
"RTN","SROCPT",35,0)
 S SRDD=DT I $G(SRDAA) S SRDD=$E($P(^SRF(SRDAA,0),"^",9),1,7)
"RTN","SROCPT",36,0)
 S SRY=$$CPT^ICPTCOD(SRCODE,SRDD),SRW=$P(SRY,"^",2)_"  "_$P(SRY,"^",3)
"RTN","SROCPT",37,0)
 S SRY=$$CPTD^ICPTCOD(SRCODE,"SRDES",,SRDD),SRK=SRK_" " F SRI=1:1:SRY D  Q:$L(SRK_" "_X)>245  S SRK=SRK_" "_X
"RTN","SROCPT",38,0)
 .S X=SRDES(SRI) F  S Z=$F(X,"  ") Q:'Z  S X=$E(X,1,Z-2)_$E(X,Z,255)
"RTN","SROCPT",39,0)
 S Y=SRK
"RTN","SROCPT",40,0)
 Q
"RTN","SROCPT",41,0)
ACTIV(SRTN,SRCODE) ; screen for active CPT codes
"RTN","SROCPT",42,0)
 K ICPTVDT
"RTN","SROCPT",43,0)
 N SROK,SRSDATE S SROK=1,SRSDATE=DT
"RTN","SROCPT",44,0)
 I $G(SRTN) S SRSDATE=$E($P(^SRF(SRTN,0),"^",9),1,7)
"RTN","SROCPT",45,0)
 S SROK=$P($$CPT^ICPTCOD(SRCODE,SRSDATE),"^",7),ICPTVDT=SRSDATE
"RTN","SROCPT",46,0)
 Q SROK
"RTN","SROCPT",47,0)
IN ; check CPT input
"RTN","SROCPT",48,0)
 N SRX,SRCPT K SRCMOD S SRX=X,SRCPT=$P(SRX,"-"),SRCMOD=$P(SRX,"-",2) I SRCMOD="" K SRCMOD
"RTN","SROCPT",49,0)
 S X=SRCPT
"RTN","SROCPT",50,0)
 Q
"RTN","SROCPT",51,0)
SSPRIN ; append CPT modifiers to principal CPT code
"RTN","SROCPT",52,0)
 N SRCMOD,SRCOMMA,SRCPT,SRI,SRM,X I $O(^SRF(SRTN,"OPMOD",0)) D
"RTN","SROCPT",53,0)
 .S (SRCOMMA,SRI)=0,SRCMOD="",SRCPT=Y_"-" F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROCPT",54,0)
 ..S SRM=$P(^SRF(SRTN,"OPMOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROCPT",55,0)
 ..S SRCPT=SRCPT_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROCPT",56,0)
 .S Y=SRCPT
"RTN","SROCPT",57,0)
 Q
"RTN","SROCPT",58,0)
SSOTH ; append CPT modifiers to other CPT code
"RTN","SROCPT",59,0)
 N SRCMOD,SRCOMMA,SRCPT,SRI,SRM,X I $O(^SRF(SRTN,13,SRDA,"MOD",0)) D
"RTN","SROCPT",60,0)
 .S (SRCOMMA,SRI)=0,SRCMOD="",SRCPT=Y_"-" F  S SRI=$O(^SRF(SRTN,13,SRDA,"MOD",SRI)) Q:'SRI  D
"RTN","SROCPT",61,0)
 ..S SRM=$P(^SRF(SRTN,13,SRDA,"MOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROCPT",62,0)
 ..S SRCPT=SRCPT_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROCPT",63,0)
 .S Y=SRCPT
"RTN","SROCPT",64,0)
 Q
"RTN","SROESAD1")
0^22^B34222417
"RTN","SROESAD1",1,0)
SROESAD1 ;BIR/ADM - SURGERY E-SIG UTILITY ; [ 04/16/01  1:03 PM ]
"RTN","SROESAD1",2,0)
 ;;3.0; Surgery ;**100,127**;24 Jun 93
"RTN","SROESAD1",3,0)
 ;
"RTN","SROESAD1",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROESAD1",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROESAD1",6,0)
 ;**         are prohibited.
"RTN","SROESAD1",7,0)
 ;
"RTN","SROESAD1",8,0)
 N SRALN,SRE,SRE1,SRFILE,SRFLD,SRG,SRI,SRJ,SRLN,SRMULT,SRNM,SRNUM,SRPF,SRPRE,SRS,SRSUB,SRTITLE,SRVAL,SRVAL1,SRVAL2,SRX,SRY,X
"RTN","SROESAD1",9,0)
 F SRJ="SRADDEND","SRAD1","SRAD2","SRADM1","SRADM2" K ^TMP(SRJ,$J,SRTN)
"RTN","SROESAD1",10,0)
 S SRI=0,SRG=$NA(^TMP("SRADDEND",$J,SRTN)) K @SRG
"RTN","SROESAD1",11,0)
 D GET^SROESAD
"RTN","SROESAD1",12,0)
SING ; single fields
"RTN","SROESAD1",13,0)
 S SRFLD="" F  S SRFLD=$O(^TMP("SRAD1",$J,SRTN,130,SRFLD)) Q:SRFLD=""  D
"RTN","SROESAD1",14,0)
 .S SRTITLE=$P(SRFLD,"-"),X=$P(SRFLD,"-",2),SRFILE=$P(X,","),SRNUM=$P(X,",",2) I SRNUM[";W" D WPS Q
"RTN","SROESAD1",15,0)
 .S SRVAL1="<NOT ENTERED>",SRY=$G(^TMP("SRAD1",$J,SRTN,130,SRFLD)) I SRY'="" D EXT S SRVAL1=SRX
"RTN","SROESAD1",16,0)
 .S SRVAL2="<DELETED>",SRY=$G(^TMP("SRAD2",$J,SRTN,130,SRFLD)) I SRY'="" D EXT S SRVAL2=SRX
"RTN","SROESAD1",17,0)
 .D LINE(2) S @SRG@(SRI)="The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)="  from "_SRVAL1 D LINE(1) S @SRG@(SRI)="    to "_SRVAL2
"RTN","SROESAD1",18,0)
MULT ; multiples
"RTN","SROESAD1",19,0)
 S SRMULT="" F  S SRMULT=$O(^TMP("SRADM1",$J,SRTN,SRMULT)) Q:SRMULT=""  D
"RTN","SROESAD1",20,0)
 .D LINE(2) S @SRG@(SRI)="The "_SRMULT_" subfile was changed as follows:"
"RTN","SROESAD1",21,0)
 .S SRE=0 F  S SRE=$O(^TMP("SRADM1",$J,SRTN,SRMULT,SRE)) Q:'SRE  D
"RTN","SROESAD1",22,0)
 ..S SRE1="",SRJ=2,SRPF=0 F  S SRE1=$O(^TMP("SRADM1",$J,SRTN,SRMULT,SRE,SRE1)) Q:SRE1=""  D  Q:SRE1=""
"RTN","SROESAD1",23,0)
 ...S SRFLD="" F  S SRFLD=$O(^TMP("SRADM1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) Q:SRFLD=""  D PROC Q:SRFLD=""
"RTN","SROESAD1",24,0)
 Q
"RTN","SROESAD1",25,0)
WPS ; word-processing fields
"RTN","SROESAD1",26,0)
 D LINE(2) S @SRG@(SRI)="The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=" >> from original "_SRTITLE_" text:"
"RTN","SROESAD1",27,0)
 I '$O(^TMP("SRAD1",$J,SRTN,130,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <NO TEXT ENTERED>"
"RTN","SROESAD1",28,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRAD1",$J,SRTN,130,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRAD1",$J,SRTN,130,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)="    "_X
"RTN","SROESAD1",29,0)
WPS2 D LINE(1) S @SRG@(SRI)=" >> to updated "_SRTITLE_" text:" I '$O(^TMP("SRAD2",$J,SRTN,130,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <TEXT DELETED>"
"RTN","SROESAD1",30,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRAD2",$J,SRTN,130,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRAD2",$J,SRTN,130,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)="    "_X
"RTN","SROESAD1",31,0)
 Q
"RTN","SROESAD1",32,0)
EXT ; get external value
"RTN","SROESAD1",33,0)
 S SRX=$$EXTERNAL^DILFD(SRFILE,SRNUM,"",SRY)
"RTN","SROESAD1",34,0)
 I SRFILE=130 D  Q
"RTN","SROESAD1",35,0)
 .I SRNUM=27,SRX'="" S SRX=$E(SRX,1,5) D CPT Q
"RTN","SROESAD1",36,0)
 .I SRNUM=66 D DIAG
"RTN","SROESAD1",37,0)
 I SRFILE=130.16,SRNUM=3,SRX'="" S SRX=$E(SRX,1,5) D CPT Q
"RTN","SROESAD1",38,0)
 I SRFILE=130.18,SRNUM=3 D DIAG
"RTN","SROESAD1",39,0)
 Q
"RTN","SROESAD1",40,0)
DIAG S SRY=$$ICDDX^ICDCODE(SRY,$P($G(^SRF(SRTN,0)),"^",9)),SRX=SRX_"  "_$P(SRY,"^",4)
"RTN","SROESAD1",41,0)
 Q
"RTN","SROESAD1",42,0)
CPT S X=$$CPT^ICPTCOD(SRX,$P($G(^SRF(SRTN,0)),"^",9)),SRX=SRX_"  "_$P(X,"^",3)
"RTN","SROESAD1",43,0)
 Q
"RTN","SROESAD1",44,0)
PROC S SRTITLE=$P(SRFLD,"-",2),X=$P(SRFLD,"-",3),SRFILE=$P(X,","),SRNUM=$P(X,",",2),SRJ=$P(SRFLD,"-",4) I SRNUM[";W" D WPM Q
"RTN","SROESAD1",45,0)
 S SRVAL1="",SRY=$G(^TMP("SRADM1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL1=SRX
"RTN","SROESAD1",46,0)
 S SRVAL2="",SRY=$G(^TMP("SRADM2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL2=SRX
"RTN","SROESAD1",47,0)
 I $P(SRFLD,"-")="01",SRVAL1=""!(SRVAL2="") D FP01 Q
"RTN","SROESAD1",48,0)
 I 'SRPF,$P(SRNUM,";")=.01,SRVAL1=""!(SRVAL2="") D FP01S Q
"RTN","SROESAD1",49,0)
 I SRPF D FPX Q
"RTN","SROESAD1",50,0)
 S:SRVAL1="" SRVAL1="<NOT ENTERED>" S:SRVAL2="" SRVAL2="<DELETED>"
"RTN","SROESAD1",51,0)
 I SRVAL2=SRVAL1 D:$P(SRFLD,"-")="01" LINE(1) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" entry "_SRVAL1_" was changed:" Q
"RTN","SROESAD1",52,0)
 D:$P(SRFLD,"-")="01" LINE(1) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"  from "_SRVAL1 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"    to "_SRVAL2
"RTN","SROESAD1",53,0)
 Q
"RTN","SROESAD1",54,0)
FP01S ; add or delete subfile entry
"RTN","SROESAD1",55,0)
 I SRVAL1="" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was ADDED:" S SRNM=2
"RTN","SROESAD1",56,0)
 I SRVAL2="" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was DELETED:" S SRNM=1
"RTN","SROESAD1",57,0)
 S SRPF=1,SRVAL=$S(SRNM=1:SRVAL1,1:SRVAL2) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_SRTITLE_": "_SRVAL
"RTN","SROESAD1",58,0)
 Q
"RTN","SROESAD1",59,0)
FP01 ; add or delete
"RTN","SROESAD1",60,0)
 I SRVAL1="" D LINE(2) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was ADDED:" S SRNM=2
"RTN","SROESAD1",61,0)
 I SRVAL2="" D LINE(2) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was DELETED:" S SRNM=1
"RTN","SROESAD1",62,0)
 S SRPF=1,SRVAL=$S(SRNM=1:SRVAL1,1:SRVAL2) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_SRTITLE_": "_SRVAL
"RTN","SROESAD1",63,0)
 Q
"RTN","SROESAD1",64,0)
FPX S SRJ=SRJ+2 I SRNUM[";W" D WPM
"RTN","SROESAD1",65,0)
 S SRVAL="",SRY=$G(^TMP("SRADM"_SRNM,$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL=SRX
"RTN","SROESAD1",66,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_SRTITLE_": "_SRVAL
"RTN","SROESAD1",67,0)
 Q
"RTN","SROESAD1",68,0)
FWPM ; word-processing in multiples in added or deleted entries
"RTN","SROESAD1",69,0)
 I '$O(^TMP("SRAD1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S SRS=2
"RTN","SROESAD1",70,0)
 I '$O(^TMP("SRAD2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S SRS=1
"RTN","SROESAD1",71,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_SRTITLE_":" S SRLN=0
"RTN","SROESAD1",72,0)
 F  S SRLN=$O(^TMP("SRADM"_SRS,$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRADM"_SRS,$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_X
"RTN","SROESAD1",73,0)
 Q
"RTN","SROESAD1",74,0)
WPM ; word-processing in multiples
"RTN","SROESAD1",75,0)
 I SRPF S SRJ=SRJ+2 D FWPM Q
"RTN","SROESAD1",76,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_">> from original "_SRTITLE_" text:"
"RTN","SROESAD1",77,0)
 I '$O(^TMP("SRAD1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <NO TEXT ENTERED>" D WPM2 Q
"RTN","SROESAD1",78,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRADM1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRADM1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_X
"RTN","SROESAD1",79,0)
WPM2 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_">> to updated "_SRTITLE_" text:" I '$O(^TMP("SRAD2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <TEXT DELETED>" Q
"RTN","SROESAD1",80,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRADM2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRADM2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_X
"RTN","SROESAD1",81,0)
 Q
"RTN","SROESAD1",82,0)
SPACE(NUM) ; create spaces
"RTN","SROESAD1",83,0)
 ; pass in position, returns number of needed spaces
"RTN","SROESAD1",84,0)
 I '$D(@SRG@(SRI)) S @SRG@(SRI)=""
"RTN","SROESAD1",85,0)
 Q $J("",NUM-$L(@SRG@(SRI)))
"RTN","SROESAD1",86,0)
 Q
"RTN","SROESAD1",87,0)
LINE(NUM) ; create carriage returns
"RTN","SROESAD1",88,0)
 F J=1:1:NUM S SRI=SRI+1,@SRG@(SRI)=""
"RTN","SROESAD1",89,0)
 Q
"RTN","SROESNR2")
0^23^B34159372
"RTN","SROESNR2",1,0)
SROESNR2 ;BIR/ADM - NURSE REPORT E-SIG UTILITY ; [ 03/21/01  6:36 AM
"RTN","SROESNR2",2,0)
 ;;3.0; Surgery ;**100,127**;24 Jun 93
"RTN","SROESNR2",3,0)
 ;
"RTN","SROESNR2",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROESNR2",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROESNR2",6,0)
 ;**         are prohibited.
"RTN","SROESNR2",7,0)
 ;
"RTN","SROESNR2",8,0)
 N SRALN,SRE,SRE1,SRFILE,SRFLD,SRG,SRI,SRJ,SRLN,SRMULT,SRNM,SRNUM,SRPF,SRS,SRTITLE,SRVAL,SRVAL1,SRVAL2,SRX,SRY,X
"RTN","SROESNR2",9,0)
 S SRI=0,SRG=$NA(^TMP("SRNR",$J,SRTN)) K @SRG
"RTN","SROESNR2",10,0)
SING ; single fields
"RTN","SROESNR2",11,0)
 S SRFLD="" F  S SRFLD=$O(^TMP("SRNRAD1",$J,SRTN,130,SRFLD)) Q:SRFLD=""  D
"RTN","SROESNR2",12,0)
 .S SRTITLE=$P(SRFLD,"-"),X=$P(SRFLD,"-",2),SRFILE=$P(X,","),SRNUM=$P(X,",",2) I SRNUM[";W" D WPS Q
"RTN","SROESNR2",13,0)
 .S SRVAL1="<NOT ENTERED>",SRY=$G(^TMP("SRNRAD1",$J,SRTN,130,SRFLD)) I SRY'="" D EXT S SRVAL1=SRX
"RTN","SROESNR2",14,0)
 .S SRVAL2="<DELETED>",SRY=$G(^TMP("SRNRAD2",$J,SRTN,130,SRFLD)) I SRY'="" D EXT S SRVAL2=SRX
"RTN","SROESNR2",15,0)
 .D LINE(2) S @SRG@(SRI)="The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)="  from "_SRVAL1 D LINE(1) S @SRG@(SRI)="    to "_SRVAL2
"RTN","SROESNR2",16,0)
MULT ; multiples
"RTN","SROESNR2",17,0)
 S SRMULT="" F  S SRMULT=$O(^TMP("SRNRMULT1",$J,SRTN,SRMULT)) Q:SRMULT=""  D
"RTN","SROESNR2",18,0)
 .D LINE(2) S @SRG@(SRI)="The "_SRMULT_" subfile was changed as follows:"
"RTN","SROESNR2",19,0)
 .S SRE=0 F  S SRE=$O(^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE)) Q:'SRE  D
"RTN","SROESNR2",20,0)
 ..S SRE1="",SRJ=2,SRPF=0 F  S SRE1=$O(^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE,SRE1)) Q:SRE1=""  D  Q:SRE1=""
"RTN","SROESNR2",21,0)
 ...S SRFLD="" F  S SRFLD=$O(^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) Q:SRFLD=""  D PROC Q:SRFLD=""
"RTN","SROESNR2",22,0)
 Q
"RTN","SROESNR2",23,0)
WPS ; word-processing fields
"RTN","SROESNR2",24,0)
 D LINE(2) S @SRG@(SRI)="The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=" >> from original "_SRTITLE_" text:"
"RTN","SROESNR2",25,0)
 I '$O(^TMP("SRNRAD1",$J,SRTN,130,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <NO TEXT ENTERED>"
"RTN","SROESNR2",26,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRNRAD1",$J,SRTN,130,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRNRAD1",$J,SRTN,130,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)="    "_X
"RTN","SROESNR2",27,0)
WPS2 D LINE(1) S @SRG@(SRI)=" >> to updated "_SRTITLE_" text:" I '$O(^TMP("SRNRAD2",$J,SRTN,130,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <TEXT DELETED>"
"RTN","SROESNR2",28,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRNRAD2",$J,SRTN,130,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRNRAD2",$J,SRTN,130,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)="    "_X
"RTN","SROESNR2",29,0)
 Q
"RTN","SROESNR2",30,0)
EXT ; get external value
"RTN","SROESNR2",31,0)
 S SRX=$$EXTERNAL^DILFD(SRFILE,SRNUM,"",SRY)
"RTN","SROESNR2",32,0)
 I SRFILE=130 D  Q
"RTN","SROESNR2",33,0)
 .I SRNUM=27,SRX'="" S SRX=$E(SRX,1,5) D CPT Q
"RTN","SROESNR2",34,0)
 .I SRNUM=66 D DIAG
"RTN","SROESNR2",35,0)
 I SRFILE=130.16,SRNUM=3,SRX'="" S SRX=$E(SRX,1,5) D CPT Q
"RTN","SROESNR2",36,0)
 I SRFILE=130.18,SRNUM=3 D DIAG
"RTN","SROESNR2",37,0)
 Q
"RTN","SROESNR2",38,0)
DIAG S SRY=$$ICDDX^ICDCODE(SRY,$P($G(^SRF(SRTN,0)),"^",9)) S SRX=SRX_"  "_$P(SRY,"^",4) K SRY
"RTN","SROESNR2",39,0)
 Q
"RTN","SROESNR2",40,0)
CPT S X=$$CPT^ICPTCOD(SRX,$P($G(^SRF(SRTN,0)),"^",9)),SRX=SRX_"  "_$P(X,"^",3)
"RTN","SROESNR2",41,0)
 Q
"RTN","SROESNR2",42,0)
PROC S SRTITLE=$P(SRFLD,"-",2),X=$P(SRFLD,"-",3),SRFILE=$P(X,","),SRNUM=$P(X,",",2),SRJ=$P(SRFLD,"-",4) I SRNUM[";W" D WPM Q
"RTN","SROESNR2",43,0)
 S SRVAL1="",SRY=$G(^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL1=SRX
"RTN","SROESNR2",44,0)
 S SRVAL2="",SRY=$G(^TMP("SRNRMULT2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL2=SRX
"RTN","SROESNR2",45,0)
 I $P(SRFLD,"-")="01",SRVAL1=""!(SRVAL2="") D FP01 Q
"RTN","SROESNR2",46,0)
 I 'SRPF,$P(SRNUM,";")=.01,SRVAL1=""!(SRVAL2="") D FP01S Q
"RTN","SROESNR2",47,0)
 I SRPF D FPX Q
"RTN","SROESNR2",48,0)
 S:SRVAL1="" SRVAL1="<NOT ENTERED>" S:SRVAL2="" SRVAL2="<DELETED>"
"RTN","SROESNR2",49,0)
 I SRVAL2=SRVAL1 D:$P(SRFLD,"-")="01" LINE(1) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" entry "_SRVAL1_" was changed:" Q
"RTN","SROESNR2",50,0)
 D:$P(SRFLD,"-")="01" LINE(1) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"  from "_SRVAL1 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"    to "_SRVAL2
"RTN","SROESNR2",51,0)
 Q
"RTN","SROESNR2",52,0)
FP01S ; add or delete subfile entry
"RTN","SROESNR2",53,0)
 I SRVAL1="" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was ADDED:" S SRNM=2
"RTN","SROESNR2",54,0)
 I SRVAL2="" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was DELETED:" S SRNM=1
"RTN","SROESNR2",55,0)
 S SRPF=1,SRVAL=$S(SRNM=1:SRVAL1,1:SRVAL2) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_SRTITLE_": "_SRVAL
"RTN","SROESNR2",56,0)
 Q
"RTN","SROESNR2",57,0)
FP01 ; add or delete
"RTN","SROESNR2",58,0)
 I SRVAL1="" D LINE(2) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was ADDED:" S SRNM=2
"RTN","SROESNR2",59,0)
 I SRVAL2="" D LINE(2) S @SRG@(SRI)=$$SPACE(SRJ)_"The following "_SRTITLE_" was DELETED:" S SRNM=1
"RTN","SROESNR2",60,0)
 S SRPF=1,SRVAL=$S(SRNM=1:SRVAL1,1:SRVAL2) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_SRTITLE_": "_SRVAL
"RTN","SROESNR2",61,0)
 Q
"RTN","SROESNR2",62,0)
FPX S SRJ=SRJ+2 I SRNUM[";W" D WPM
"RTN","SROESNR2",63,0)
 S SRVAL="",SRY=$G(^TMP("SRNRMULT"_SRNM,$J,SRTN,SRMULT,SRE,SRE1,SRFLD)) I SRY'="" D EXT S SRVAL=SRX
"RTN","SROESNR2",64,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_SRTITLE_": "_SRVAL
"RTN","SROESNR2",65,0)
 Q
"RTN","SROESNR2",66,0)
FWPM ; word-processing in multiples in added or deleted entries
"RTN","SROESNR2",67,0)
 I '$O(^TMP("SRNRAD1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S SRS=2
"RTN","SROESNR2",68,0)
 I '$O(^TMP("SRNRAD2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S SRS=1
"RTN","SROESNR2",69,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_SRTITLE_":" S SRLN=0
"RTN","SROESNR2",70,0)
 F  S SRLN=$O(^TMP("SRNRMULT"_SRS,$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRNRMULT"_SRS,$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_X
"RTN","SROESNR2",71,0)
 Q
"RTN","SROESNR2",72,0)
WPM ; word-processing in multiples
"RTN","SROESNR2",73,0)
 I SRPF S SRJ=SRJ+2 D FWPM Q
"RTN","SROESNR2",74,0)
 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ)_"The "_SRTITLE_" field was changed" D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_">> from original "_SRTITLE_" text:"
"RTN","SROESNR2",75,0)
 I '$O(^TMP("SRNRAD1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <NO TEXT ENTERED>" D WPM2 Q
"RTN","SROESNR2",76,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRNRMULT1",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_X
"RTN","SROESNR2",77,0)
WPM2 D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_">> to updated "_SRTITLE_" text:" I '$O(^TMP("SRNRAD2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,0)) S @SRG@(SRI)=@SRG@(SRI)_" <TEXT DELETED>" Q
"RTN","SROESNR2",78,0)
 S SRLN=0 F  S SRLN=$O(^TMP("SRNRMULT2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN)) Q:'SRLN  S X=^TMP("SRNRMULT2",$J,SRTN,SRMULT,SRE,SRE1,SRFLD,SRLN) D LINE(1) S @SRG@(SRI)=$$SPACE(SRJ+2)_X
"RTN","SROESNR2",79,0)
 Q
"RTN","SROESNR2",80,0)
SPACE(NUM) ; create spaces
"RTN","SROESNR2",81,0)
 ; pass in position, returns number of needed spaces
"RTN","SROESNR2",82,0)
 I '$D(@SRG@(SRI)) S @SRG@(SRI)=""
"RTN","SROESNR2",83,0)
 Q $J("",NUM-$L(@SRG@(SRI)))
"RTN","SROESNR2",84,0)
 Q
"RTN","SROESNR2",85,0)
LINE(NUM) ; create carriage returns
"RTN","SROESNR2",86,0)
 F J=1:1:NUM S SRI=SRI+1,@SRG@(SRI)=""
"RTN","SROESNR2",87,0)
 Q
"RTN","SROGMTS")
0^24^B49968701
"RTN","SROGMTS",1,0)
SROGMTS ;BIR/ADM - SURGERY HEALTH SUMMARY ; [ 08/08/01  7:12 AM ]
"RTN","SROGMTS",2,0)
 ;;3.0; Surgery ;**100,127**;24 Jun 93
"RTN","SROGMTS",3,0)
 ;
"RTN","SROGMTS",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROGMTS",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROGMTS",6,0)
 ;**         are prohibited.
"RTN","SROGMTS",7,0)
 ;
"RTN","SROGMTS",8,0)
 ; Reference to $$MOD^ICPTMOD supported by DBIA #1996
"RTN","SROGMTS",9,0)
 ; Reference to $$CPT^ICPTCOD supported by DBIA #1995
"RTN","SROGMTS",10,0)
 ;
"RTN","SROGMTS",11,0)
 Q
"RTN","SROGMTS",12,0)
HS(X) ; return case information for a surical or non-OR case
"RTN","SROGMTS",13,0)
 ; X - case number (IEN) in file 130
"RTN","SROGMTS",14,0)
 K REC N SRCPTM,SRSG,DA,DR,DIC,DIQ,IEN,IENS,FILE,FLD,FLDS,FLDI
"RTN","SROGMTS",15,0)
 N FLDA,FLDB,FLDR,FLDRT,IEN,SRI,SRRT,SRT,SRS,SRC,SRCS
"RTN","SROGMTS",16,0)
 S SRCPTM=1
"RTN","SROGMTS",17,0)
 Q:'$D(^SRF(X,0))  S (IENS,IEN,X)=+($G(X)),U="^"
"RTN","SROGMTS",18,0)
 S:'$D(DT) DT=$$HTFM^XLFDT($H,1) S:'$D(DTIME) DTIME=300
"RTN","SROGMTS",19,0)
 S (FILE,DIC)=130,DA=+($G(X)),DIQ="REC(",DIQ(0)="IE"
"RTN","SROGMTS",20,0)
 S SRSG=$$SG(IEN),REC(130,IEN,118,"E")=$S(SRSG=0:"YES",1:""),REC(130,IEN,118,"I")=$S(SRSG=0:"Y",1:"")
"RTN","SROGMTS",21,0)
 S:+SRSG DR=".09;.04;.14;.164;.205;.22;.23;.31;10;15;17;26;27;32;34;36;39;43;49;50"
"RTN","SROGMTS",22,0)
 S:'SRSG DR=".09;.31;26;27;33;50;55;59;66;121;122;123;124;125"
"RTN","SROGMTS",23,0)
 D EN^DIQ1 S REC(130,IEN,"STATUS")=$$OS(IEN) S:+SRSG REC(130,IEN,"VERIFIED")=$S($G(REC(130,IEN,43,"I"))'="Y":"(Unverified)",1:"")
"RTN","SROGMTS",24,0)
 S SRM=$G(REC(130,IEN,27,"I")) I SRM>0 D
"RTN","SROGMTS",25,0)
 . S SRC=$$CPT^ICPTCOD(SRM,$P($G(^SRF(IEN,0)),"^",9)),(SRCS,SRS)=$$EN2^SROGMTS0($P(SRC,"^",3))
"RTN","SROGMTS",26,0)
 . S REC(130,IEN,27,"X")=$P(SRC,"^",2)_"^"_$P(SRC,"^",3)
"RTN","SROGMTS",27,0)
 . S SRC=$P(SRC,"^",2),SRT=$$EN2^SROGMTS0($G(REC(130,IEN,26,"E")))
"RTN","SROGMTS",28,0)
 . S:$L(SRS)&(SRS'=SRT) SRT=SRT_" - "_SRS
"RTN","SROGMTS",29,0)
 . S:$L(SRC)=5 SRT=SRT_" (CPT "_SRC_")",SRCS=SRCS_" (CPT "_SRC_")"
"RTN","SROGMTS",30,0)
 . S REC(130,IEN,27,"N")=SRS
"RTN","SROGMTS",31,0)
 . S (REC(130,IEN,26,"S"),REC(130,IEN,27,"S"))=SRT
"RTN","SROGMTS",32,0)
 . S REC(130,IEN,27,"S")=SRCS
"RTN","SROGMTS",33,0)
 D DICT^SROGMTS0,SUB
"RTN","SROGMTS",34,0)
 S:$D(REC(130,IEN,32)) REC(130,IEN,32,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,32,"E")))
"RTN","SROGMTS",35,0)
 S:$D(REC(130,IEN,33)) REC(130,IEN,33,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,33,"E")))
"RTN","SROGMTS",36,0)
 S:$D(REC(130,IEN,34)) REC(130,IEN,34,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,34,"E")))
"RTN","SROGMTS",37,0)
 S:$D(REC(130,IEN,.04)) REC(130,IEN,.04,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,.04,"E")))
"RTN","SROGMTS",38,0)
 S:$D(REC(130,IEN,125)) REC(130,IEN,125,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,125,"E")))
"RTN","SROGMTS",39,0)
 I $L($G(REC(130,IEN,33,"S"))) D
"RTN","SROGMTS",40,0)
 . S:'$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (Unknown)"
"RTN","SROGMTS",41,0)
 . S:$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (ICD "_$G(REC(130,IEN,66,"E"))_")"
"RTN","SROGMTS",42,0)
 S:+($G(REC(130,IEN,.09,"I")))>0 REC(130,IEN,.09,"S")=$$ED^SROGMTS0($G(REC(130,IEN,.09,"I")))
"RTN","SROGMTS",43,0)
 S:+($G(REC(130,IEN,15,"I")))>0 REC(130,IEN,15,"S")=$$EDT^SROGMTS0($G(REC(130,IEN,15,"I")))
"RTN","SROGMTS",44,0)
 S:+($G(REC(130,IEN,39,"I"))) REC(130,IEN,39,"S")=$$EDT^SROGMTS0($G(REC(130,IEN,39,"I")))
"RTN","SROGMTS",45,0)
 S:+SRSG REC(130,IEN,"LAB")=$S($O(REC(130,IEN,49,0))>0:"Yes",1:"")
"RTN","SROGMTS",46,0)
 I 'SRSG D:+($O(REC(130,IEN,55,0)))>0 WP(IEN,55,58) D:+($O(REC(130,IEN,59,0)))>0 WP(IEN,59,58)
"RTN","SROGMTS",47,0)
 Q
"RTN","SROGMTS",48,0)
ED(X) ; external date
"RTN","SROGMTS",49,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","SROGMTS",50,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ")
"RTN","SROGMTS",51,0)
 Q X
"RTN","SROGMTS",52,0)
EDT(X) ; external date and time
"RTN","SROGMTS",53,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","SROGMTS",54,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ")
"RTN","SROGMTS",55,0)
 Q X
"RTN","SROGMTS",56,0)
WP(X,Y,Z) ;
"RTN","SROGMTS",57,0)
 N SRI,SRF,SRW,SRGI,DIWF,DIWL,DIWR
"RTN","SROGMTS",58,0)
 S SRI=+($G(X)) Q:SRI=0!('$D(REC(130,SRI)))
"RTN","SROGMTS",59,0)
 S SRF=+($G(Y)) Q:SRF=0!('$D(REC(130,SRI,SRF)))
"RTN","SROGMTS",60,0)
 S SRW=+($G(Z)) Q:SRW'>0!(SRW>79)
"RTN","SROGMTS",61,0)
 Q:+($O(REC(130,SRI,SRF,0)))'>0
"RTN","SROGMTS",62,0)
 K ^UTILITY($J,"W") S DIWF="C"_SRW,DIWL=0,DIWR=0,SRGI=0
"RTN","SROGMTS",63,0)
 F  S SRGI=$O(REC(130,SRI,SRF,SRGI)) Q:+SRGI=0  D
"RTN","SROGMTS",64,0)
 . S X=$G(REC(130,SRI,SRF,SRGI))
"RTN","SROGMTS",65,0)
 . D ^DIWP
"RTN","SROGMTS",66,0)
 S SRGI=0 F  S SRGI=$O(^UTILITY($J,"W",0,SRGI)) Q:+SRGI=0  D
"RTN","SROGMTS",67,0)
 . S REC(130,SRI,SRF,"S",SRGI)=$G(^UTILITY($J,"W",0,SRGI,0))
"RTN","SROGMTS",68,0)
 . S REC(130,SRI,SRF,"S",0)=$G(REC(130,SRI,SRF,"S",0))+1
"RTN","SROGMTS",69,0)
 K ^UTILITY($J,"W")
"RTN","SROGMTS",70,0)
 Q
"RTN","SROGMTS",71,0)
OS(X) ; Obtains status for OR procedures
"RTN","SROGMTS",72,0)
 N SRN S SRN=+($G(X)) S X="" I $G(REC(130,SRN,118,"I"))="Y" D  Q X
"RTN","SROGMTS",73,0)
 . S:+($G(REC(130,SRN,122,"I")))>0 X="(Completed)"
"RTN","SROGMTS",74,0)
 . S:+($G(REC(130,SRN,121,"I")))>0&(+($G(REC(130,SRN,122,"I")))'>0) X="Incomplete"
"RTN","SROGMTS",75,0)
 . S:X="" X="Unknown"
"RTN","SROGMTS",76,0)
 I +($G(REC(130,SRN,17,"I")))>0 D  Q X
"RTN","SROGMTS",77,0)
 . S X=$S(+($G(REC(130,SRN,.205,"I")))>0:"(Aborted)",1:"Cancelled")
"RTN","SROGMTS",78,0)
 I +($G(REC(130,SRN,.23,"I")))>0 S X="(Completed)" Q X
"RTN","SROGMTS",79,0)
 I +($G(REC(130,SRN,.22,"I")))>0 S X="Incomplete" Q X
"RTN","SROGMTS",80,0)
 I +($G(REC(130,SRN,10,"I")))>0 S X="Scheduled" Q X
"RTN","SROGMTS",81,0)
 I +($G(REC(130,SRN,36,"I")))>0,+($G(REC(130,SRN,.22,"I")))'>0 S X="Requested" Q X
"RTN","SROGMTS",82,0)
 S X="Unknown"
"RTN","SROGMTS",83,0)
 Q X
"RTN","SROGMTS",84,0)
SUB ;
"RTN","SROGMTS",85,0)
 N DA,DR,DIC,DIQ,IENS,FILE,FLD,FLDS,FLDI,FLDA,FLDB,FLDR,FLDRT,SRM,SRC,SRI,SRJ,STXT,SNAM,SCOD,SUB
"RTN","SROGMTS",86,0)
 I +SRSG D
"RTN","SROGMTS",87,0)
 . ;
"RTN","SROGMTS",88,0)
 . ; ^SRF(DO,14,I)                .72  Other Preop Diag    14;0  130.17
"RTN","SROGMTS",89,0)
 . ; $P(^SRF(DO,14,I,0),U)        .01  Other Preop Diag     0;1  Text
"RTN","SROGMTS",90,0)
 . ;
"RTN","SROGMTS",91,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.17,DR=.72,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","SROGMTS",92,0)
 . K REC(SUB) S SRI=0 F  S SRI=$O(^SRF(+($G(IEN)),14,SRI)) Q:+SRI=0  D
"RTN","SROGMTS",93,0)
 . . S DA(SUB)=SRI
"RTN","SROGMTS",94,0)
 . . D EN^DIQ1
"RTN","SROGMTS",95,0)
 . . S REC(130,IEN,130.17,SRI,.01,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,130.17,SRI,.01,"E")))
"RTN","SROGMTS",96,0)
 . ;
"RTN","SROGMTS",97,0)
 . ; ^SRF(DO,15,I)                .74  Other Postop Diags  15;0  130.18
"RTN","SROGMTS",98,0)
 . ; $P(^SRF(DO,15,I,0),U)        .01  Other Postop Diags   0;1  Text
"RTN","SROGMTS",99,0)
 . ;
"RTN","SROGMTS",100,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.18,DR=.74,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","SROGMTS",101,0)
 . K REC(SUB) S SRI=0 F  S SRI=$O(^SRF(+($G(IEN)),15,SRI)) Q:+SRI=0  D
"RTN","SROGMTS",102,0)
 . . S DA(SUB)=SRI
"RTN","SROGMTS",103,0)
 . . D EN^DIQ1
"RTN","SROGMTS",104,0)
 . . S REC(130,IEN,130.18,SRI,.01,"S")=$$EN2^SROGMTS0($G(REC(130,IEN,130.18,SRI,.01,"E")))
"RTN","SROGMTS",105,0)
 ;
"RTN","SROGMTS",106,0)
 ; ^SRF(SRN,"OPMOD",I)           28  Pri Pro CPT Mod  OPMOD;0  130.028
"RTN","SROGMTS",107,0)
 ; $P(^SRF(SRN,"OPMOD",I,0),U)  .01  Pri Pro CPT Mod      0;1  Ptr 81.3
"RTN","SROGMTS",108,0)
 ;
"RTN","SROGMTS",109,0)
 I SRCPTM D
"RTN","SROGMTS",110,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.028,DR=28,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","SROGMTS",111,0)
 . K REC(SUB) S SRI=0 F  S SRI=$O(^SRF(+($G(IEN)),"OPMOD",SRI)) Q:+SRI=0  D
"RTN","SROGMTS",112,0)
 . . S DA(SUB)=SRI
"RTN","SROGMTS",113,0)
 . . D EN^DIQ1
"RTN","SROGMTS",114,0)
 . . S SRM=+($G(REC(130,+($G(IEN)),SUB,+($G(SRI)),.01,"I")))
"RTN","SROGMTS",115,0)
 . . I SRM>0 N SRMOD D
"RTN","SROGMTS",116,0)
 . . . S SRMOD=$$MOD^ICPTMOD(+SRM,"I",$P($G(^SRF(IEN,0)),"^",9))
"RTN","SROGMTS",117,0)
 . . . S SRC=$P(SRMOD,"^",2)
"RTN","SROGMTS",118,0)
 . . . S SRS=$P(SRMOD,"^",3)
"RTN","SROGMTS",119,0)
 . . . S REC(130,IEN,SUB,SRI,.01,"MID")=SRC
"RTN","SROGMTS",120,0)
 . . . S REC(130,IEN,SUB,SRI,.01,"MOD")=SRS
"RTN","SROGMTS",121,0)
 . . . S SRT=$$EN2^SROGMTS0(SRS)
"RTN","SROGMTS",122,0)
 . . . S:$L(SRC) SRT=SRT_" (CPT Mod "_SRC_")"
"RTN","SROGMTS",123,0)
 . . . S REC(130,IEN,SUB,SRI,.01,"S")=SRT
"RTN","SROGMTS",124,0)
 ;
"RTN","SROGMTS",125,0)
 ; ^SRF(DO,13,I)                .42  Other Proc          13;0  130.16
"RTN","SROGMTS",126,0)
 ; $P(^SRF(DO,13,I,0),U)        .01  Other Proc           0;1  Text      
"RTN","SROGMTS",127,0)
 ; $P(^SRF(DO,13,I,2),U)          3  Other Proc CPT Code  2;1  Ptr 81
"RTN","SROGMTS",128,0)
 ;
"RTN","SROGMTS",129,0)
 S DA=IEN,(FILE,DIC)=130,SUB=130.16,DR=.42,DR(SUB)=".01;3",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","SROGMTS",130,0)
 K REC(SUB) S SRI=0 F  S SRI=$O(^SRF(+($G(IEN)),13,SRI)) Q:+SRI=0  D
"RTN","SROGMTS",131,0)
 . S DA(SUB)=SRI
"RTN","SROGMTS",132,0)
 . D EN^DIQ1 S SRM=+($G(REC(130,IEN,130.16,SRI,3,"I")))
"RTN","SROGMTS",133,0)
 . S:SRM>0 REC(130,IEN,130.16,SRI,3,"N")=$P($$CPT^ICPTCOD(+SRM,$P($G(^SRF(IEN,0)),"^",9)),"^",3)
"RTN","SROGMTS",134,0)
 . N SRT,SRS,SRC S SRM=$G(REC(130,IEN,130.16,SRI,3,"I")) I SRM>0 D
"RTN","SROGMTS",135,0)
 . . S SRC=$$CPT^ICPTCOD(SRM,$P($G(^SRF(IEN,0)),"^",9)),(SRCS,SRS)=$$EN2^SROGMTS0($P(SRC,"^",3))
"RTN","SROGMTS",136,0)
 . . S REC(130,IEN,130.16,SRI,3,"X")=$P(SRC,"^",2)_"^"_$P(SRC,"^",3)
"RTN","SROGMTS",137,0)
 . . S SRC=$P(SRC,"^",2)
"RTN","SROGMTS",138,0)
 . . S SRT=$$EN2^SROGMTS0($G(REC(130,IEN,130.16,SRI,.01,"E")))
"RTN","SROGMTS",139,0)
 . . S:$L(SRS)&(SRS'=SRT) SRT=SRT_" - "_$$EN2^SROGMTS0(SRS)
"RTN","SROGMTS",140,0)
 . . S:$L(SRC)=5 SRT=SRT_" (CPT "_SRC_")",SRCS=SRCS_" (CPT "_SRC_")"
"RTN","SROGMTS",141,0)
 . . S REC(130,IEN,130.16,SRI,3,"N")=SRS
"RTN","SROGMTS",142,0)
 . . S REC(130,IEN,130.16,SRI,.01,"S")=SRT
"RTN","SROGMTS",143,0)
 . . S REC(130,IEN,130.16,SRI,3,"S")=SRCS
"RTN","SROGMTS",144,0)
 . ;
"RTN","SROGMTS",145,0)
 . ;     ^SRF(8,13,2,"MOD",0)       4  Oth Proc CPT Mod   MOD;0  130.164
"RTN","SROGMTS",146,0)
 . ;     ^SRF(8,13,2,"MOD",1,0)   .01  Oth Proc CPT Mod     0;1  Ptr 81.3
"RTN","SROGMTS",147,0)
 . ;
"RTN","SROGMTS",148,0)
 . I SRCPTM D
"RTN","SROGMTS",149,0)
 . . N SRJ S SRJ=0 F  S SRJ=$O(^SRF(+($G(IEN)),13,SRI,"MOD",SRJ)) Q:+SRJ=0  D
"RTN","SROGMTS",150,0)
 . . . N DA,FILE,DIC,SUB,DR,DIQ S DA=IEN,DR=.42,FILE=130,SUB=130.16,DR(SUB)="4",DA(SUB)=SRI,SUB=130.164,DR(SUB)=".01",DA(SUB)=SRJ,DIC=130,DIQ="REC(130,"_IEN_",130.16,"_SRI_",",DIQ(0)="IE"
"RTN","SROGMTS",151,0)
 . . . D EN^DIQ1
"RTN","SROGMTS",152,0)
 . . . S SRM=+($G(REC(130,IEN,130.16,SRI,130.164,SRJ,.01,"I")))
"RTN","SROGMTS",153,0)
 . . . I SRM>0 N SRMOD1 D
"RTN","SROGMTS",154,0)
 . . . . S SRMOD1=$$MOD^ICPTMOD(+SRM,"I",$P($G(^SRF(IEN,0)),"^",9))
"RTN","SROGMTS",155,0)
 . . . . S SRC=$P(SRMOD1,"^",2)
"RTN","SROGMTS",156,0)
 . . . . S SRS=$P(SRMOD1,"^",3)
"RTN","SROGMTS",157,0)
 . . . . S REC(130,IEN,130.16,SRI,SUB,SRJ,.01,"MID")=SRC
"RTN","SROGMTS",158,0)
 . . . . S REC(130,IEN,130.16,SRI,SUB,SRJ,.01,"MOD")=SRS
"RTN","SROGMTS",159,0)
 . . . . S REC(130,IEN,130.16,SRI,SUB,SRJ,.01,"X")=SRC_"^"_SRS
"RTN","SROGMTS",160,0)
 . . . . S SRT=$$EN2^SROGMTS0(SRS) S:$L(SRC) SRT=SRT_" (CPT Mod "_SRC_")"
"RTN","SROGMTS",161,0)
 . . . . S REC(130,IEN,130.16,SRI,SUB,SRJ,.01,"S")=SRT
"RTN","SROGMTS",162,0)
 . . . K REC(130,IEN,130.16,SRI,130)
"RTN","SROGMTS",163,0)
 Q
"RTN","SROGMTS",164,0)
SG(X) ; Surgical (Operative) Record
"RTN","SROGMTS",165,0)
 S X=$$GET1^DIQ(130,+($G(X)),118,"I") S X=$S(X["Y":0,1:1) Q X
"RTN","SROICD")
0^25^B818894
"RTN","SROICD",1,0)
SROICD ;BIR/SJA - CODE SET VERSIONING UTILITY ; [ 01/30/03  05:50 PM ]
"RTN","SROICD",2,0)
 ;;3.0; Surgery ;**116,127**;24 Jun 93
"RTN","SROICD",3,0)
 ;
"RTN","SROICD",4,0)
 ;Reference to $$ICDDX^ICDCODE supported by DBIA #3990
"RTN","SROICD",5,0)
 ;
"RTN","SROICD",6,0)
ICDC(SRCODE) ; output principal ICD
"RTN","SROICD",7,0)
 N SRC,SRSDATE,SRDA
"RTN","SROICD",8,0)
 I $D(SRCODE),SRCODE="" Q
"RTN","SROICD",9,0)
 S SRDA=$S($G(SRTN):SRTN,$D(DA(2)):DA(2),$D(DA(1)):DA(1),$D(D0):D0,1:"")
"RTN","SROICD",10,0)
 S SRC=$$ICDDX^ICDCODE(SRCODE,$P($G(^SRF(SRDA,0)),"^",9))
"RTN","SROICD",11,0)
 Q $P(SRC,"^",2,4)
"RTN","SROICD",12,0)
 ;
"RTN","SROICD",13,0)
ACTIV(SRTN,SRCODE) ; screen for active ICD codes
"RTN","SROICD",14,0)
 K ICDVDT
"RTN","SROICD",15,0)
 N SROK,SRSDATE S SROK=1,SRSDATE=DT
"RTN","SROICD",16,0)
 I $G(SRTN) S SRSDATE=$E($P(^SRF(SRTN,0),"^",9),1,7)
"RTN","SROICD",17,0)
 S SROK=$P($$ICDDX^ICDCODE(SRCODE,SRSDATE),"^",10)
"RTN","SROICD",18,0)
 S ICDVDT=SRSDATE
"RTN","SROICD",19,0)
 Q SROK
"RTN","SROMOD")
0^26^B37665201
"RTN","SROMOD",1,0)
SROMOD ;BIR/ADM - CPT Modifier Input ; [ 02/27/01  6:32 AM ]
"RTN","SROMOD",2,0)
 ;;3.0; Surgery ;**88,100,127**;24 Jun 93
"RTN","SROMOD",3,0)
 Q
"RTN","SROMOD",4,0)
DISPLAY ; display name with modifier
"RTN","SROMOD",5,0)
 N SRY,SRDA,SRDATE S SRDATE=DT
"RTN","SROMOD",6,0)
 S SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:"")
"RTN","SROMOD",7,0)
 I $G(SRDA) S SRDATE=$P($G(^SRF(SRDA,0)),"^",9)
"RTN","SROMOD",8,0)
 S SRY=$$MOD^ICPTMOD(Y,"I",SRDATE) Q:$P(SRY,"^")=-1
"RTN","SROMOD",9,0)
 S Y=$P(SRY,"^",2)_"  "_$P(SRY,"^",3)
"RTN","SROMOD",10,0)
 Q
"RTN","SROMOD",11,0)
SCR27() ; screen for acceptable CPT code/modifier pair for principal procedure
"RTN","SROMOD",12,0)
 N SRCODE,SRDA,SRCMOD,SROK,SRSDATE,SRZ D PCHK K SRM
"RTN","SROMOD",13,0)
 Q SROK
"RTN","SROMOD",14,0)
PCHK ; return value of modifier if acceptable for principal procedure
"RTN","SROMOD",15,0)
 N SRSDATE S SRSDATE=DT K ICPTVDT
"RTN","SROMOD",16,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD",17,0)
 I SRDA S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRF(SRDA,"OP")),"^",2)
"RTN","SROMOD",18,0)
 I 'SRCODE Q
"RTN","SROMOD",19,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD",20,0)
 S ICPTVDT=SRSDATE
"RTN","SROMOD",21,0)
 Q
"RTN","SROMOD",22,0)
OTH() ; screen for acceptable CPT code/modifier pair for other procedure
"RTN","SROMOD",23,0)
 N SRCODE,SRDA,SRCMOD,SROK,SROTH,SRSDATE,SRZ D OCHK K SRM
"RTN","SROMOD",24,0)
 Q SROK
"RTN","SROMOD",25,0)
OCHK ; return value of modifier if acceptable for other procedure
"RTN","SROMOD",26,0)
 N SRSDATE S SRSDATE=DT K ICPTVDT
"RTN","SROMOD",27,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(2)):DA(2),$D(DA(1)):DA(1),$D(D0):D0,1:""),SROTH=$S($D(DA):DA,$D(D1):D1,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD",28,0)
 I SRDA&SROTH S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRF(SRDA,13,SROTH,2)),"^")
"RTN","SROMOD",29,0)
 I 'SRCODE Q
"RTN","SROMOD",30,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD",31,0)
 S ICPTVDT=SRSDATE
"RTN","SROMOD",32,0)
 Q
"RTN","SROMOD",33,0)
SPRIN ; set logic for ACPT x-ref
"RTN","SROMOD",34,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")
"RTN","SROMOD",35,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z S (SRQ,SRSOUT)=0,SRCODE=X N X I $D(SRCMOD) D HYPH27
"RTN","SROMOD",36,0)
 S SRDA=DA,SRIEN=$O(^SRF(SRDA,"OPMOD","AAA"),-1) I SRIEN S SRX=$P(^SRF(SRDA,"OPMOD",SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD",37,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD",38,0)
 .S DIR("A")=" Modifier: ",DIR(0)="130.028,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRF(SRDA,"OPMOD",0)) QUES
"RTN","SROMOD",39,0)
 .D ^DIR K DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",40,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRF(SRDA,"OPMOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD",41,0)
 ..S SRSEL=Y(0),DIR(0)="130.028,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD",42,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",43,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRF(SRDA,"OPMOD",SRK)) Q:'SRK  I $P(^SRF(SRDA,"OPMOD",SRK,0),"^")=+Y S SRQ=1 Q
"RTN","SROMOD",44,0)
 ..Q:SRQ  I +Y S $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=+Y,SRQ=1 Q
"RTN","SROMOD",45,0)
 ..I X="@" S SRY(130.028,SRJ_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD",46,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD",47,0)
 .I +Y S SRY(130.028,"+1,"_DA_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD",48,0)
 .I X="@",$D(SRCMOD) S SRY(130.028,SRIEN_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD",49,0)
 Q
"RTN","SROMOD",50,0)
KPRIN ; kill logic for ACPT x-ref
"RTN","SROMOD",51,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")  K ^SRF(DA,"OPMOD")
"RTN","SROMOD",52,0)
 Q
"RTN","SROMOD",53,0)
SOTH ; set logic for ACPT1 x-ref
"RTN","SROMOD",54,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")
"RTN","SROMOD",55,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z S (SRQ,SRSOUT)=0,SRCODE=X N X I $D(SRCMOD) D HYPHOTH
"RTN","SROMOD",56,0)
 S SRDA=DA,SRDA(1)=DA(1),SRIEN=$O(^SRF(SRDA(1),13,SRDA,"MOD","A"),-1) I SRIEN S SRX=$P(^SRF(SRDA(1),13,SRDA,"MOD",SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD",57,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD",58,0)
 .S DIR("A")=" Modifier: ",DIR(0)="130.164,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRF(SRDA(1),13,SRDA,"MOD",0)) QUES1
"RTN","SROMOD",59,0)
 .D ^DIR K DIR S DA=SRDA,DA(1)=SRDA(1) I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",60,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA(1),13,SRDA,"MOD",SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD",61,0)
 ..S SRSEL=Y(0),DIR(0)="130.164,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD",62,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",63,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRK)) Q:'SRK  I $P(^SRF(SRDA(1),13,SRDA,"MOD",SRK,0),"^")=+Y S Y="" Q
"RTN","SROMOD",64,0)
 ..I X="@" S SRY(130.164,SRJ_","_SRDA_","_SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD",65,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD",66,0)
 .I +Y S SRY(130.164,"+1,"_DA_","_DA(1)_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD",67,0)
 .I X="@",$D(SRCMOD) S SRY(130.164,SRIEN_","_SRDA_",",SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD",68,0)
 Q
"RTN","SROMOD",69,0)
KOTH ; kill logic for ACPT1 x-ref
"RTN","SROMOD",70,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")  K ^SRF(DA(1),13,DA,"MOD")
"RTN","SROMOD",71,0)
 Q
"RTN","SROMOD",72,0)
HYPH27 ; input CPT hyphenated modifier for principal procedure
"RTN","SROMOD",73,0)
 N SRCODE,SRDA,SRDUP,SRLIST,SRN,SROK,SRY S SRLIST=SRCMOD
"RTN","SROMOD",74,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD",75,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD",76,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D PCHK K SRM
"RTN","SROMOD",77,0)
 .I 'SROK D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD",78,0)
 .S SRJ=0 F  S SRJ=$O(^SRF(SRDA,"OPMOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD",79,0)
 .I 'SRDUP S SRY(130.028,"+1,"_DA_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD",80,0)
 Q
"RTN","SROMOD",81,0)
HYPHOTH ; input CPT hyphenated modifier for other procedure
"RTN","SROMOD",82,0)
 N SRCODE,SRDA,SRDUP,SRLIST,SRN,SROK,SROTH,SRY S SRLIST=SRCMOD
"RTN","SROMOD",83,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD",84,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD",85,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D OCHK K SRM
"RTN","SROMOD",86,0)
 .I 'SROK D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD",87,0)
 .S SRJ=0 F  S SRJ=$O(^SRF(SRDA,13,SROTH,"MOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,13,SROTH,"MOD",SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD",88,0)
 .I 'SRDUP S SRY(130.164,"+1,"_DA_","_DA(1)_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD",89,0)
 Q
"RTN","SROMOD",90,0)
QUES N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with PRIN. PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD",91,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRF(SRDA,"OPMOD",SRI)) Q:'SRI  S SRMD=$P(^SRF(SRDA,"OPMOD",SRI,0),"^") D
"RTN","SROMOD",92,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD",93,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD",94,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new PRIN. PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD",95,0)
 Q
"RTN","SROMOD",96,0)
QUES1 N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with OTHER PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD",97,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRI)) Q:'SRI  S SRMD=$P(^SRF(SRDA(1),13,SRDA,"MOD",SRI,0),"^") D
"RTN","SROMOD",98,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD",99,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD",100,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new OTHER PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD",101,0)
 Q
"RTN","SROMOD",102,0)
  
"RTN","SRONAN1")
0^27^B9876666
"RTN","SRONAN1",1,0)
SRONAN1 ;BIR/MAM - ANNUAL REPORT NON-O.R. PROCEDURES ; [ 12/16/98  11:46 AM ]
"RTN","SRONAN1",2,0)
 ;;3.0; Surgery ;**50,88,127**;24 Jun 93
"RTN","SRONAN1",3,0)
 ;
"RTN","SRONAN1",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SRONAN1",5,0)
 ;
"RTN","SRONAN1",6,0)
 K ^TMP("SR",$J) S (SRHDR,SRSUMM,SRSOUT)=0,^TMP("SR",$J)=0
"RTN","SRONAN1",7,0)
 F  S SRSD=$O(^SRF("AC",SRSD)) Q:'SRSD!(SRSD>SRED)  S SROP=0 F  S SROP=$O(^SRF("AC",SRSD,SROP)) Q:'SROP  I $P($G(^SRF(SROP,"NON")),"^")="Y",$D(^SRF(SROP,0)),$$DIV^SROUTL0(SROP) D SET
"RTN","SRONAN1",8,0)
 S SRSS=0 F  S SRSS=$O(^TMP("SR",$J,SRSS)) Q:SRSS=""!SRSOUT  D HDR Q:SRSOUT  S SRCPT=0 F  S SRCPT=$O(^TMP("SR",$J,SRSS,SRCPT)) Q:SRCPT=""!SRSOUT  D PRINT
"RTN","SRONAN1",9,0)
 Q:SRSOUT  S SRSUMM=1,SRSS="" D HDR Q:SRSOUT
"RTN","SRONAN1",10,0)
 S SRSS=0 F  S SRSS=$O(^TMP("SR",$J,SRSS)) Q:SRSS=""!(SRSOUT)  D SUM
"RTN","SRONAN1",11,0)
 W:'SRSOUT !!,?9,"TOTAL NON-O.R. PROCEDURES FOR "_SRSITE("SITE")_": "_^TMP("SR",$J)
"RTN","SRONAN1",12,0)
 Q
"RTN","SRONAN1",13,0)
SET ; set local variables
"RTN","SRONAN1",14,0)
 I $P($G(^SRF(SROP,30)),"^") Q
"RTN","SRONAN1",15,0)
 S SRSS=$P(^SRF(SROP,"NON"),"^",8),SRCPT=$P(^SRF(SROP,"OP"),"^",2) I 'SRCPT Q
"RTN","SRONAN1",16,0)
 S SRSPEC=$S(SRSS:$P(^ECC(723,SRSS,0),"^"),1:"SPECIALTY NOT ENTERED")
"RTN","SRONAN1",17,0)
 D CPT,UTIL S SROTH=0 F  S SROTH=$O(^SRF(SROP,13,SROTH)) Q:'SROTH  S SRCPT=$P($G(^SRF(SROP,13,SROTH,2)),"^") I SRCPT D CPT,UTIL
"RTN","SRONAN1",18,0)
 Q
"RTN","SRONAN1",19,0)
UTIL ; set ^TMP("SR",$J
"RTN","SRONAN1",20,0)
 S ^TMP("SR",$J)=^TMP("SR",$J)+1
"RTN","SRONAN1",21,0)
 I '$D(^TMP("SR",$J,SRSPEC)) S ^TMP("SR",$J,SRSPEC)=0
"RTN","SRONAN1",22,0)
 S ^TMP("SR",$J,SRSPEC)=^TMP("SR",$J,SRSPEC)+1
"RTN","SRONAN1",23,0)
 I '$D(^TMP("SR",$J,SRSPEC,SRCPT)) S ^TMP("SR",$J,SRSPEC,SRCPT)=1 Q
"RTN","SRONAN1",24,0)
 S ^TMP("SR",$J,SRSPEC,SRCPT)=^TMP("SR",$J,SRSPEC,SRCPT)+1
"RTN","SRONAN1",25,0)
 Q
"RTN","SRONAN1",26,0)
CPT ; get procedure name and code
"RTN","SRONAN1",27,0)
 S X=$$CPT^ICPTCOD(SRCPT,$P(SRED,".")),SROPER=$P(X,"^",3),SRCPT=$P(X,"^",2)_"   "_SROPER
"RTN","SRONAN1",28,0)
 Q
"RTN","SRONAN1",29,0)
PRINT ; print CPT info
"RTN","SRONAN1",30,0)
 I $Y+5>IOSL D HDR Q:SRSOUT
"RTN","SRONAN1",31,0)
 W !,SRCPT,?66,^TMP("SR",$J,SRSS,SRCPT)
"RTN","SRONAN1",32,0)
 Q
"RTN","SRONAN1",33,0)
SUM ; print summary
"RTN","SRONAN1",34,0)
 I $Y+5>IOSL D HDR Q:SRSOUT
"RTN","SRONAN1",35,0)
 W !,SRSS,?42,"TOTAL NON-O.R. PROCEDURES: ",?67,^TMP("SR",$J,SRSS)
"RTN","SRONAN1",36,0)
 Q
"RTN","SRONAN1",37,0)
HDR1 ; print heading to screen
"RTN","SRONAN1",38,0)
 I SRHDR W !!!!,"Press RETURN to continue, or '^' to quit:  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SRONAN1",39,0)
 W @IOF,!,?22,"ANNUAL REPORT OF NON-O.R. PROCEDURES" I SRSUMM W !,?27,"SUMMARY OF ALL SPECIALTIES"
"RTN","SRONAN1",40,0)
 W !,?(80-$L(SRFRTO)\2),SRFRTO,! F LINE=1:1:80 W "="
"RTN","SRONAN1",41,0)
 W:'SRSUMM&(SRSS'="") !!,?(80-$L(SRSS)\2),SRSS,! S SRHDR=1
"RTN","SRONAN1",42,0)
 Q
"RTN","SRONAN1",43,0)
HDR ; print heading
"RTN","SRONAN1",44,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SRONAN1",45,0)
 I $E(IOST)'="P" D HDR1 Q
"RTN","SRONAN1",46,0)
 W:$Y @IOF W !,?(80-$L(SRINST)\2),SRINST,?65,"REVIEWED BY:",!,?32,"SURGICAL SERVICE",!,?22,"ANNUAL REPORT OF NON-O.R. PROCEDURES",?65,"DATE REVIEWED:"
"RTN","SRONAN1",47,0)
 I SRSUMM W !,?27,"SUMMARY OF ALL SPECIALTIES"
"RTN","SRONAN1",48,0)
 W !,?(80-$L(SRFRTO)\2),SRFRTO I 'SRSUMM W !!,"CPT - PROCEDURE",?30,"SPECIALTY",?65,"TOTAL"
"RTN","SRONAN1",49,0)
 W ! F LINE=1:1:80 W "="
"RTN","SRONAN1",50,0)
 W:'SRSUMM&(SRSS'="") !!,?(80-$L(SRSS)\2),SRSS,! S SRHDR=1
"RTN","SRONAN1",51,0)
 Q
"RTN","SROPCE0A")
0^28^B45156648
"RTN","SROPCE0A",1,0)
SROPCE0A ;BIR/ADM - PCE Filing Status Report, Long Form ; [ 05/17/99  2:10 PM ]
"RTN","SROPCE0A",2,0)
 ;;3.0; Surgery ;**58,62,69,77,50,86,88,127**;24 Jun 93
"RTN","SROPCE0A",3,0)
 ;
"RTN","SROPCE0A",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SROPCE0A",5,0)
 ;
"RTN","SROPCE0A",6,0)
 S (SRFCPT,SRQCPT,SRFICD,SRQICD,SRUCPT,SRUICD)=0
"RTN","SROPCE0A",7,0)
 D HDR F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:'SRSDT!(SRSDT>SRSEDT)!SRSOUT  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN),$P($G(^SRF(SRTN,30)),"^")="" D UTIL Q:SRSOUT
"RTN","SROPCE0A",8,0)
 D:'SRSOUT TOTAL
"RTN","SROPCE0A",9,0)
 Q
"RTN","SROPCE0A",10,0)
TOTAL D:$Y+10>IOSL PAGE Q:SRSOUT  W !,?28,"CPT",?36,"ICD",!,?20,"CASES",?27,"CODES",?35,"CODES",!,?13,"FILED: ",$J(CNT(1),5),?27,$J(SRFCPT,5),?35,$J(SRFICD,5)
"RTN","SROPCE0A",11,0)
 W !,?4,"QUEUED TO FILE: ",$J(CNT(2),5),?27,$J(SRQCPT,5),?35,$J(SRQICD,5),!,?5,"UPDATE QUEUED: ",$J(CNT(3),5),?27,$J(SRUCPT,5),?35,$J(SRUICD,5),!,?8,"NOT QUEUED: "_$J(CNT(4),5) F I=1:1:5 S CNT(6)=CNT(6)+CNT(I)
"RTN","SROPCE0A",12,0)
 W:CNT(5) !,?9,"UNCERTAIN: "_$J(CNT(5),5) W !,?20,"-----",?27,"-----",?35,"-----",!,?13,"TOTAL: ",$J(CNT(6),5),?27,$J(SRFCPT+SRQCPT+SRUCPT,5),?35,$J(SRFICD+SRQICD+SRUICD,5)
"RTN","SROPCE0A",13,0)
 Q
"RTN","SROPCE0A",14,0)
UTIL ; process case
"RTN","SROPCE0A",15,0)
 S SRDIV=$P($G(^SRF(SRTN,8)),"^") I SRDIV S SRSPS=$O(^SRO(133,"B",SRDIV,0))
"RTN","SROPCE0A",16,0)
 I 'SRDIV S SRSPS=SRSITE
"RTN","SROPCE0A",17,0)
 S X=^SRO(133,SRSPS,0),SRPARAM=$P(X,"^",15),SRSR=$P(X,"^",19) I SRPARAM=""!(SRPARAM="N") Q
"RTN","SROPCE0A",18,0)
 S SRINOUT=$P(^SRF(SRTN,0),"^",12) I SRPARAM="O",SRINOUT'="",SRINOUT'="O" Q
"RTN","SROPCE0A",19,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROPCE0A",20,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:'$P($G(^SRF(SRTN,.2)),"^",12)
"RTN","SROPCE0A",21,0)
 I SRFLG=2!(SRFLG=3&SRNON) Q:'$P($G(^SRF(SRTN,"NON")),"^",5)
"RTN","SROPCE0A",22,0)
 Q:SRFLG=2&('SRNON)  Q:SRFLG=1&(SRNON)
"RTN","SROPCE0A",23,0)
 S SRSS=$S('SRNON:$P(^SRF(SRTN,0),"^",4),1:$P(^SRF(SRTN,"NON"),"^",8)) I SRSPEC,SRSPEC'=SRSS Q
"RTN","SROPCE0A",24,0)
 S SRSSNM=$S('SRNON:$P(^SRO(137.45,SRSS,0),"^"),1:$P(^ECC(723,SRSS,0),"^"))
"RTN","SROPCE0A",25,0)
 I SRPARAM="O",SRINOUT="" S SRSTATUS=5,CNT(5)=CNT(5)+1 D CASE,CHK^SROPCE0,MISS Q
"RTN","SROPCE0A",26,0)
 I $P(^SRF(SRTN,0),"^",15) S X=$G(^SRF("APCE",SRTN)),Z=$S(X:3,1:1),SRSTATUS=Z,CNT(Z)=CNT(Z)+1 D CASE,LINE Q
"RTN","SROPCE0A",27,0)
 I $D(^SRF("APCE",SRTN)),^SRF("APCE",SRTN)="" S SRSTATUS=2,CNT(2)=CNT(2)+1 D CASE,LINE Q
"RTN","SROPCE0A",28,0)
 S SRSTATUS=4,CNT(4)=CNT(4)+1 D CASE,CHK^SROPCE0,MISS
"RTN","SROPCE0A",29,0)
 Q
"RTN","SROPCE0A",30,0)
MISS ; list fields missing data
"RTN","SROPCE0A",31,0)
 Q:SRSOUT  S SRFLD="" S SRFLD=$O(SRX(SRFLD)) I SRFLD="" W !,?15,"No Missing Information" D LINE Q
"RTN","SROPCE0A",32,0)
 S SRCT=1,SRFLD="" W !,?15,"Missing Information:" F  S SRFLD=$O(SRX(SRFLD)) Q:SRFLD=""  D:$Y+5>IOSL PAGE Q:SRSOUT  W !,$J(SRCT_". ",20),SRX(SRFLD) S SRCT=SRCT+1
"RTN","SROPCE0A",33,0)
LINE I 'SRSOUT W ! F I=1:1:IOM W "-"
"RTN","SROPCE0A",34,0)
 Q
"RTN","SROPCE0A",35,0)
CASE ; print case info
"RTN","SROPCE0A",36,0)
 D:$Y+9>IOSL PAGE Q:SRSOUT  D DEM,SCHED^SROPCE0B
"RTN","SROPCE0A",37,0)
 W !,SRSDATE,?22,SRSNM,?49,SRPROV,?71,SRSSNM,?113,$S(SRSTATUS=1:"FILED",SRSTATUS=2:"QUEUED TO FILE",SRSTATUS=3:"UPDATE QUEUED",SRSTATUS=4:"NOT QUEUED",1:"UNCERTAIN")
"RTN","SROPCE0A",38,0)
 W !,SRTN,?22,SRSSN_"  ("_SRAGE_")",?49,SRATT,?71,SRDIAG(1),?113,$E(SRSCHED,1,17),!
"RTN","SROPCE0A",39,0)
 W:(SRFLG=3)&SRNON "NON-OR" W ?22,SRPROC(1) W:$D(SRDIAG(2)) ?71,SRDIAG(2) W:$D(SRPROC(2)) !,?22,SRPROC(2) W:$D(SRPROC(3)) !,?22,SRPROC(3) W !
"RTN","SROPCE0A",40,0)
 I "1,2,3"[SRSTATUS F SRI=1:1 Q:'$D(SRCPT(SRI))&'$D(SRDX(SRI))  D:$Y+4>IOSL PAGE Q:SRSOUT  W ! D  W:$D(SRDX(SRI)) ?71,"ICD Diagnosis Code: "_SRDX(SRI)
"RTN","SROPCE0A",41,0)
 .I $D(SRCPT(SRI)) S SRCPT(SRI)=$S($D(SRDX(SRI)):$E(SRCPT(SRI),1,68),1:SRCPT(SRI)) W ?1,SRCPT(SRI)
"RTN","SROPCE0A",42,0)
 Q
"RTN","SROPCE0A",43,0)
DEM ; get patient demographic information
"RTN","SROPCE0A",44,0)
 S SR(0)=^SRF(SRTN,0),DFN=$P(SR(0),"^") D DEM^VADPT S SRSNM=VADM(1),SRSSN=VA("PID"),Y=SRSDT X ^DD("DD") S SRSDATE=Y,X1=$E(SRSDT,1,7),X2=$P(VADM(3),"^"),SRAGE=$E(X1,1,3)-$E(X2,1,3)-($E(X1,4,7)<$E(X2,4,7))
"RTN","SROPCE0A",45,0)
 I $L(SRSNM)>25 S X=SRSNM,SRSNM=$P(X,",")_","_$E($P(X,",",2))_"."
"RTN","SROPCE0A",46,0)
PROC ; get principal procedure and other case information
"RTN","SROPCE0A",47,0)
 K SRPROC S X=$P(^SRF(SRTN,"OP"),"^") I $L(X)<60 S SRPROC(1)=X
"RTN","SROPCE0A",48,0)
 I $L(X)>59 S K=1 F  D  I $L(X)<60 S SRPROC(K)=X Q
"RTN","SROPCE0A",49,0)
 .F I=0:1:58 S J=59-I,Y=$E(X,J) I Y=" " S SRPROC(K)=$E(X,1,J-1),X=$E(X,J+1,$L(X)) S K=K+1 Q
"RTN","SROPCE0A",50,0)
 K SRDIAG S X=$S(SRNON:$P($G(^SRF(SRTN,33)),"^",2),1:$P($G(^SRF(SRTN,34)),"^")) I $L(X)<40 S SRDIAG(1)=X
"RTN","SROPCE0A",51,0)
 I $L(X)>39 S K=1 F  D  I $L(X)<40 S SRDIAG(K)=X Q
"RTN","SROPCE0A",52,0)
 .F I=0:1:38 S J=39-I,Y=$E(X,J) I Y=" " S SRDIAG(K)=$E(X,1,J-1),X=$E(X,J+1,$L(X)) S K=K+1 Q
"RTN","SROPCE0A",53,0)
 I SRDIAG(1)="" S SRDIAG(1)="NOT ENTERED"
"RTN","SROPCE0A",54,0)
 I SRNON S X=$G(^SRF(SRTN,"NON")) S SRPROV=$S($P(X,"^",6):$P(^VA(200,$P(X,"^",6),0),"^"),1:"NOT ENTERED"),SRATT=$S($P(X,"^",7):$P(^VA(200,$P(X,"^",7),0),"^"),1:"NOT ENTERED")
"RTN","SROPCE0A",55,0)
 I 'SRNON S X=$G(^SRF(SRTN,.1)) S SRPROV=$S($P(X,"^",4):$P(^VA(200,$P(X,"^",4),0),"^"),1:"NOT ENTERED"),SRATT=$S($P(X,"^",13):$P(^VA(200,$P(X,"^",13),0),"^"),1:"NOT ENTERED")
"RTN","SROPCE0A",56,0)
 I $L(SRPROV)>20 S X=SRPROV,SRPROV=$P(X,",")_","_$E($P(X,",",2))_"."
"RTN","SROPCE0A",57,0)
 I $L(SRATT)>20 S X=SRATT,SRATT=$P(X,",")_","_$E($P(X,",",2))_"."
"RTN","SROPCE0A",58,0)
 Q:"1,2,3"'[SRSTATUS
"RTN","SROPCE0A",59,0)
CPT ; get CPT codes
"RTN","SROPCE0A",60,0)
 N SRICPT K SRCPT S SRJ=1,X=$P(^SRF(SRTN,"OP"),"^",2) I X D
"RTN","SROPCE0A",61,0)
 .S SRICPT=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT(1)="CPT Code: "_$P(SRICPT,"^",2)_"  "_$P(SRICPT,"^",3),SRJ=SRJ+1
"RTN","SROPCE0A",62,0)
 .S:SRSTATUS=1 SRFCPT=SRFCPT+1 S:SRSTATUS=2 SRQCPT=SRQCPT+1 S:SRSTATUS=3 SRUCPT=SRUCPT+1
"RTN","SROPCE0A",63,0)
 .I X,$O(^SRF(SRTN,"OPMOD",0)) D
"RTN","SROPCE0A",64,0)
 ..N SRI,SRX,SRY,SRZ S SRX=" Modifiers: -"
"RTN","SROPCE0A",65,0)
 ..S SRI=0 F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROPCE0A",66,0)
 ...S SRZ=$P(^SRF(SRTN,"OPMOD",SRI,0),"^"),SRY=$$MOD^ICPTMOD(SRZ,"I",$P($G(^SRF(SRTN,0)),"^",9)),SRX=SRX_$P(SRY,"^",2)_" "_$P(SRY,"^",3)
"RTN","SROPCE0A",67,0)
 ...S SRCPT(SRJ)=SRX,SRJ=SRJ+1,SRX="            -"
"RTN","SROPCE0A",68,0)
 S SROP=0 F  S SROP=$O(^SRF(SRTN,13,SROP)) Q:'SROP  S X=$P($G(^SRF(SRTN,13,SROP,2)),"^") I X D
"RTN","SROPCE0A",69,0)
 .S SRICPT=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT(SRJ)="CPT Code: "_$P(SRICPT,"^",2)_"  "_$P(SRICPT,"^",3),SRJ=SRJ+1
"RTN","SROPCE0A",70,0)
 .I $O(^SRF(SRTN,13,SROP,"MOD",0)) D
"RTN","SROPCE0A",71,0)
 ..N SRI,SRX,SRY,SRZ S SRX=" Modifiers: -"
"RTN","SROPCE0A",72,0)
 ..S SRI=0 F  S SRI=$O(^SRF(SRTN,13,SROP,"MOD",SRI)) Q:'SRI  D
"RTN","SROPCE0A",73,0)
 ...S SRZ=$P(^SRF(SRTN,13,SROP,"MOD",SRI,0),"^"),SRY=$$MOD^ICPTMOD(SRZ,"I",$P($G(^SRF(SRTN,0)),"^",9)),SRX=SRX_$P(SRY,"^",2)_" "_$P(SRY,"^",3)
"RTN","SROPCE0A",74,0)
 ...S SRCPT(SRJ)=SRX,SRJ=SRJ+1,SRX="            -"
"RTN","SROPCE0A",75,0)
 .S:SRSTATUS=1 SRFCPT=SRFCPT+1 S:SRSTATUS=2 SRQCPT=SRQCPT+1 S:SRSTATUS=3 SRUCPT=SRUCPT+1
"RTN","SROPCE0A",76,0)
DX ; get diagnosis and ICD codes
"RTN","SROPCE0A",77,0)
 K SRDX S SRJ=1,X=$P($G(^SRF(SRTN,34)),"^",2) I X D
"RTN","SROPCE0A",78,0)
 .S SRDX(1)=$$ICDDX^ICDCODE(X,$P($G(^SRF(SRTN,0)),"^",9)),SRDX(1)=$P(SRDX(1),"^",2)_"  "_$P(SRDX(1),"^",4),SRJ=SRJ+1
"RTN","SROPCE0A",79,0)
 .S:SRSTATUS=1 SRFICD=SRFICD+1 S:SRSTATUS=2 SRQICD=SRQICD+1 S:SRSTATUS=3 SRUICD=SRUICD+1
"RTN","SROPCE0A",80,0)
 S SRPODX=0 F  S SRPODX=$O(^SRF(SRTN,15,SRPODX)) Q:'SRPODX  S X=$P(^SRF(SRTN,15,SRPODX,0),"^",3) I X D
"RTN","SROPCE0A",81,0)
 .S SRDX(SRJ)=$$ICDDX^ICDCODE(X,$P($G(^SRF(SRTN,0)),"^",9)),SRDX(SRJ)=$P(SRDX(SRJ),"^",2)_"  "_$P(SRDX(SRJ),"^",4),SRJ=SRJ+1
"RTN","SROPCE0A",82,0)
 .S:SRSTATUS=1 SRFICD=SRFICD+1 S:SRSTATUS=2 SRQICD=SRQICD+1 S:SRSTATUS=3 SRUICD=SRUICD+1
"RTN","SROPCE0A",83,0)
 Q
"RTN","SROPCE0A",84,0)
PAGE I $E(IOST)="P"!SRHDR G HDR
"RTN","SROPCE0A",85,0)
 W ! K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROPCE0A",86,0)
HDR ; print heading
"RTN","SROPCE0A",87,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROPCE0A",88,0)
 W:$Y @IOF W:$E(IOST)="P" !,?(IOM-$L(SRINST)\2),SRINST W !,?(IOM-$L(SRRPT)\2),SRRPT,?(IOM-10),$J("PAGE "_SRPAGE,9),!,?(IOM-$L(SRTITLE)\2),SRTITLE,!,?(IOM-$L(SRFRTO)\2),SRFRTO W:$E(IOST)="P" !,?(IOM-$L(SRPRINT)\2),SRPRINT
"RTN","SROPCE0A",89,0)
 W !!,"DATE OF "_$S(SRFLG=1:"OPERATION",SRFLG=2:"PROCEDURE",1:"OP/PROCEDURE"),?22,"PATIENT NAME",?49,$S(SRFLG=1:"SURGEON",SRFLG=2:"PROVIDER",1:"SURGEON/PROVIDER"),?71,"SPECIALTY",?113,"PCE FILING STATUS"
"RTN","SROPCE0A",90,0)
 W !,"CASE #",?22,"PATIENT ID  (AGE)",?49,"ATTENDING",?71,"PRINCIPAL "_$S(SRFLG=1:"POST-OP ",1:"")_"DIAGNOSIS",?113,"SCHED STATUS",!,?22,"PRINCIPAL PROCEDURE"
"RTN","SROPCE0A",91,0)
 S SRHDR=0,SRPAGE=SRPAGE+1 W ! F I=1:1:IOM W "="
"RTN","SROPCE0A",92,0)
 Q
"RTN","SROVER1")
0^29^B13229258
"RTN","SROVER1",1,0)
SROVER1 ;BIR/MAM - EDIT, VERIFICATION SCREEN ; [ 10/01/99  12:55 PM ]
"RTN","SROVER1",2,0)
 ;;3.0; Surgery ;**18,67,88,127**;24 Jun 93
"RTN","SROVER1",3,0)
 S SROVER=1,SRAO(1)=55,SRAO(2)=27,SRAO(3)=26,SRAO(4)="",SRAO(5)=34,SRAO(6)=""
"RTN","SROVER1",4,0)
ASK W !!,"Select Information to Edit: " R X:DTIME I '$T!("^"[X) S SRSOUT=1 Q
"RTN","SROVER1",5,0)
 S:$E(X)="a" X="A" I '$D(SRAO(X)),(X'?.N1":".N),($E(X)'="A") D HELP Q:SRSOUT  G ASK
"RTN","SROVER1",6,0)
 I $E(X)="A" S X="1:6"
"RTN","SROVER1",7,0)
 I X?.N1":".N S Y=$E(X),Z=$P(X,":",2) I Y<1!(Z>6)!(Y>Z) D HELP Q:SRSOUT  G ASK
"RTN","SROVER1",8,0)
 I X?.N1":".N D RANGE Q
"RTN","SROVER1",9,0)
 S EMILY=X D ONE Q
"RTN","SROVER1",10,0)
 Q
"RTN","SROVER1",11,0)
HELP W !!,"Enter the number corresponding to the information you want to update.  You may",!,"enter 'ALL' to update all the information displayed on this screen, or a"
"RTN","SROVER1",12,0)
 W !,"range of numbers separated by a ':' to update more than one item."
"RTN","SROVER1",13,0)
 Q
"RTN","SROVER1",14,0)
RANGE ; range of numbers
"RTN","SROVER1",15,0)
 S SHEMP=$P(X,":"),CURLEY=$P(X,":",2) F EMILY=SHEMP:1:CURLEY Q:SRSOUT  D ONE
"RTN","SROVER1",16,0)
 Q
"RTN","SROVER1",17,0)
ONE ; edit one item
"RTN","SROVER1",18,0)
 W @IOF I EMILY=2 S X=$P(S("OP"),"^",2) I X D  W !
"RTN","SROVER1",19,0)
 .S SRY=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),Y=$P(SRY,"^",2),Z=$P(SRY,"^",3)
"RTN","SROVER1",20,0)
 .W !,"  CPT Code: "_Y_"  ",Z,!,?6,"Description:" D ^SROCPT W ! F I=1:1:80 W "-"
"RTN","SROVER1",21,0)
 I EMILY=4 D POTH Q
"RTN","SROVER1",22,0)
 I EMILY=6 D INTRA^SROCMPS S SRSOUT=0 Q
"RTN","SROVER1",23,0)
 W ! K DR,DIE,DA S DIE=130,DA=SRTN,DR=SRAO(EMILY)_"T" D ^DIE K DR,DIE I $D(Y) S SRSOUT=1
"RTN","SROVER1",24,0)
 Q
"RTN","SROVER1",25,0)
POTH W !,"Other Procedures:",!
"RTN","SROVER1",26,0)
 N SRSHT K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER1",27,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),"^"),X=$P($G(^SRF(SRTN,13,OTH,2)),"^"),CPT="NOT ENTERED",CPT1=""
"RTN","SROVER1",28,0)
 .I X S CPT1=X,Y=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,"^",2),SRSHT=$P(Y,"^",3),CPT=SRCPT_"  "_SRSHT
"RTN","SROVER1",29,0)
 .W !,CNT_". "_OTHER,!,?6,"CPT Code: "_CPT S SRSEL(CNT)=OTH_"^"_OTHER_"^CPT Code: "_CPT_"^"_CPT1
"RTN","SROVER1",30,0)
 .I CPT1,$O(^SRF(SRTN,13,OTH,"MOD",0)) D  W "  ("_SRX_")"
"RTN","SROVER1",31,0)
 ..S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers: -" F  S SRI=$O(^SRF(SRTN,13,OTH,"MOD",SRI)) Q:'SRI  D
"RTN","SROVER1",32,0)
 ...S SRM=$P(^SRF(SRTN,13,OTH,"MOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROVER1",33,0)
 ...S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER1",34,0)
 .S CNT=CNT+1
"RTN","SROVER1",35,0)
 W !,CNT_". Enter NEW Other Procedure",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER1",36,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  W @IOF G POTH
"RTN","SROVER1",37,0)
 .W ?3,$P(SRSEL(SRDA),"^",2),!,?6,$P(SRSEL(SRDA),"^",3)
"RTN","SROVER1",38,0)
 .S OTH=$P(SRSEL(SRDA),"^") K SRDES S CPT1=$P(SRSEL(SRDA),"^",4),X=$$CPTD^ICPTCOD(CPT1,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?6,SRDES(I)
"RTN","SROVER1",39,0)
 .K DA,DIE,DIR,DR W ! S DA=$P(SRSEL(SRDA),"^"),DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR=".01;3" D ^DIE K DA,DIE,DR Q:$D(Y)
"RTN","SROVER1",40,0)
 K DIR S DIR("A")="Enter new OTHER PROCEDURE",DIR(0)="130.16,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") D PH Q
"RTN","SROVER1",41,0)
 K DD,DO S DIC="^SRF(SRTN,13,",X=SRNEW,DIC(0)="L",DIC("P")=$P(^DD(130,.42,0),"^",2) D FILE^DICN K DIC,DD,DO I +Y<0 D PH Q
"RTN","SROVER1",42,0)
 K DA,DIE,DIR,DR S DA=+Y,DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR="3" D ^DIE K DA,DIE,DR Q:$D(Y)
"RTN","SROVER1",43,0)
PH W @IOF G POTH
"RTN","SROVER1",44,0)
 Q
"RTN","SROVER1",45,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROVER1",46,0)
 Q
"RTN","SROVER2")
0^30^B24130199
"RTN","SROVER2",1,0)
SROVER2 ;BIR/ADM - Case Coding and Verification ; [ 03/13/02  1:58 PM ]
"RTN","SROVER2",2,0)
 ;;3.0; Surgery ;**86,88,100,127**;24 Jun 93
"RTN","SROVER2",3,0)
 I '$D(SRSITE) D ^SROVAR I '$D(SRSITE) S XQUIT="" Q
"RTN","SROVER2",4,0)
 I '$G(SRTN) D ^SROPS1 I '$D(SRTN) S XQUIT="" Q
"RTN","SROVER2",5,0)
BEG N SRDES,SRDX,SREDIT,SRMOD,SRNON,SRSEL,SRTXT S (SREDIT,SRMOD,SRSOUT,SRS,SR2)=0 K ^TMP("SRV1",$J),^TMP("SRV2",$J) I $D(^SRF(SRTN,.2)),$P(^(.2),"^",3) S SRS=1
"RTN","SROVER2",6,0)
 S S(0)=^SRF(SRTN,0),Y=$P(S(0),"^",9) D D^DIQ S SRSDATE=Y,DFN=$P(S(0),"^") D DEM^VADPT S SRNM=VADM(1)_"  ("_VA("PID")_")"
"RTN","SROVER2",7,0)
 S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0)
"RTN","SROVER2",8,0)
PRINT ; print information
"RTN","SROVER2",9,0)
 D HDR S S("OP")=^SRF(SRTN,"OP"),CPT=$P(S("OP"),"^",2),SROPER=$P(S("OP"),"^")
"RTN","SROVER2",10,0)
 S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,"OPMOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,"OPMOD",SRJ,0)
"RTN","SROVER2",11,0)
 S ^TMP("SRV1",$J,"OP")=SROPER_"^"_CPT_"^"_Y
"RTN","SROVER2",12,0)
 S SRCPT="" I CPT S Y=$$CPT^ICPTCOD(CPT,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,"^",2)_"  "_$P(Y,"^",3)
"RTN","SROVER2",13,0)
 K SROPS,MM,MMM S:$L(SROPER)<45 SROPS(1)=SROPER I $L(SROPER)>44 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROVER2",14,0)
 W !,"1. Principal Procedure: ",?24,SROPS(1) I $D(SROPS(2)) W !,?24,SROPS(2) I $D(SROPS(3)) W !,?24,SROPS(3)
"RTN","SROVER2",15,0)
 W !,"2. Principal CPT Code: ",?24,$S(CPT:SRCPT,1:"NOT ENTERED")
"RTN","SROVER2",16,0)
 I CPT K SRDES S X=$$CPTD^ICPTCOD(CPT,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?1,SRDES(I)
"RTN","SROVER2",17,0)
 I CPT,$O(^SRF(SRTN,"OPMOD",0)) D  W !,?10,SRX
"RTN","SROVER2",18,0)
 .S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers:  -" F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROVER2",19,0)
 ..S SRM=$P(^SRF(SRTN,"OPMOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2) K SRM
"RTN","SROVER2",20,0)
 ..S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER2",21,0)
 W !!,"3. Other Procedures: "_$S($O(^SRF(SRTN,13,0)):"** INFORMATION ENTERED **",1:"NO OTHER PROCEDURES HAVE BEEN ENTERED")
"RTN","SROVER2",22,0)
 S X=0 F  S X=$O(^SRF(SRTN,13,X)) Q:'X  D  S ^TMP("SRV1",$J,13,X)=$P($G(^SRF(SRTN,13,X,0)),"^")_"^"_$P($G(^SRF(SRTN,13,X,2)),"^")_"^"_Y
"RTN","SROVER2",23,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,13,X,"MOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,13,X,"MOD",SRJ,0)
"RTN","SROVER2",24,0)
 I SRNON S SRTXT=$P($G(^SRF(SRTN,33)),"^",2) W !!,"4. Principal Diagnosis: "_SRTXT
"RTN","SROVER2",25,0)
 I 'SRNON S SRTXT=$P($G(^SRF(SRTN,34)),"^") W !!,"4. Postoperative Diagnosis: "_SRTXT
"RTN","SROVER2",26,0)
 S SRDIAG="NOT ENTERED",SRDX=$P($G(^SRF(SRTN,34)),"^",2) I SRDX S Y=$$ICDDX^ICDCODE(SRDX,$P($G(^SRF(SRTN,0)),"^",9)),SRDIAG=$P(Y,"^",2)_"  "_$P(Y,"^",4)
"RTN","SROVER2",27,0)
 W !,"5. Principal Diagnosis Code: "_SRDIAG S ^TMP("SRV1",$J,34)=SRTXT_"^"_SRDX
"RTN","SROVER2",28,0)
 W !!,"6. Other Postop Diagnosis: "_$S($O(^SRF(SRTN,15,0)):"** INFORMATION ENTERED **",1:"NO OTHER POSTOP DIAGNOSIS HAS BEEN ENTERED")
"RTN","SROVER2",29,0)
 S X=0 F  S X=$O(^SRF(SRTN,15,X)) Q:'X  S Y=$G(^SRF(SRTN,15,X,0)),^TMP("SRV1",$J,15,X)=$P(Y,"^")_"^"_$P(Y,"^",3)
"RTN","SROVER2",30,0)
 W ! F LINE=1:1:80 W "-"
"RTN","SROVER2",31,0)
 N SRLCK S SRLCK=$$LOCK^SROUTL(SRTN) I 'SRLCK G END
"RTN","SROVER2",32,0)
 D ^SROVER3,MOD G:SRSOUT END G:'SREDIT PRINT
"RTN","SROVER2",33,0)
END K ^TMP("SRV1",$J),^TMP("SRV2",$J) S SROERR=SRTN D ^SROERR0,^SRSKILL W @IOF
"RTN","SROVER2",34,0)
 I $G(SRLCK) D UNLOCK^SROUTL(SRTN)
"RTN","SROVER2",35,0)
 Q
"RTN","SROVER2",36,0)
HDR W @IOF,!,SRNM,!,"Operation Date: "_SRSDATE,?40,"Case #",SRTN,! F I=1:1:80 W "-"
"RTN","SROVER2",37,0)
 Q
"RTN","SROVER2",38,0)
LOOP ; break procedure if greater than 45 characters
"RTN","SROVER2",39,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<45  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROVER2",40,0)
 Q
"RTN","SROVER2",41,0)
ORPT ; print operation/procedure report
"RTN","SROVER2",42,0)
 N SRNON S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0) I SRNON D CODE^SRONON Q
"RTN","SROVER2",43,0)
 D CODE^SROPRPT
"RTN","SROVER2",44,0)
 Q
"RTN","SROVER2",45,0)
NRPT ; print nurse intraoperative report
"RTN","SROVER2",46,0)
 N SRNON S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0) I SRNON W !!,?5,"Nurse Intraoperative Report NOT available on Non-OR Procedure",! D PRESS^SROVER3 W @IOF Q
"RTN","SROVER2",47,0)
 D CODE^SRONIN
"RTN","SROVER2",48,0)
 Q
"RTN","SROVER2",49,0)
MOD ; if data changed set coder verification field
"RTN","SROVER2",50,0)
 D CHECK I SRMOD S $P(^SRF(SRTN,"VER"),"^",2)=DUZ
"RTN","SROVER2",51,0)
 Q
"RTN","SROVER2",52,0)
CHECK ; check for changes to data
"RTN","SROVER2",53,0)
 S X=$P(^SRF(SRTN,"OP"),"^",1,2) D  I X'=^TMP("SRV1",$J,"OP") S SRMOD=1 Q
"RTN","SROVER2",54,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,"OPMOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,"OPMOD",SRJ,0)
"RTN","SROVER2",55,0)
 .S X=X_"^"_Y
"RTN","SROVER2",56,0)
 S X=0 F  S X=$O(^SRF(SRTN,13,X)) Q:'X!SRMOD  D  S ^TMP("SRV2",$J,13,X)=$P($G(^SRF(SRTN,13,X,0)),"^")_"^"_$P($G(^SRF(SRTN,13,X,2)),"^")_"^"_Y I ^TMP("SRV2",$J,13,X)'=$G(^TMP("SRV1",$J,13,X)) S SRMOD=1 Q
"RTN","SROVER2",57,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,13,X,"MOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,13,X,"MOD",SRJ,0)
"RTN","SROVER2",58,0)
 Q:SRMOD  S X=0 F  S X=$O(^TMP("SRV1",$J,13,X)) Q:'X!SRMOD  I ^TMP("SRV1",$J,13,X)'=$G(^TMP("SRV2",$J,13,X)) S SRMOD=1 Q
"RTN","SROVER2",59,0)
 Q:SRMOD  I SRNON S X=$P($G(^SRF(SRTN,33)),"^",2)_"^"_$P($G(^SRF(SRTN,34)),"^",2) I X'=^TMP("SRV1",$J,34) S SRMOD=1 Q
"RTN","SROVER2",60,0)
 I 'SRNON S X=$P($G(^SRF(SRTN,34)),"^",1,2) I X'=^TMP("SRV1",$J,34) S SRMOD=1 Q
"RTN","SROVER2",61,0)
 S X=0 F  S X=$O(^SRF(SRTN,15,X)) Q:'X!SRMOD  S Y=$G(^SRF(SRTN,15,X,0)),^TMP("SRV2",$J,15,X)=$P(Y,"^")_"^"_$P(Y,"^",3) I ^TMP("SRV2",$J,15,X)'=$G(^TMP("SRV1",$J,15,X)) S SRMOD=1 Q
"RTN","SROVER2",62,0)
 Q:SRMOD  S X=0 F  S X=$O(^TMP("SRV1",$J,15,X)) Q:'X!SRMOD  I ^TMP("SRV1",$J,15,X)'=$G(^TMP("SRV2",$J,15,X)) S SRMOD=1 Q
"RTN","SROVER2",63,0)
 Q
"RTN","SROVER3")
0^31^B21866458
"RTN","SROVER3",1,0)
SROVER3 ;BIR/ADM - Case Coding and Verification ; [ 09/22/99  12:23 AM ]
"RTN","SROVER3",2,0)
 ;;3.0; Surgery ;**86,88,127**;24 Jun 93
"RTN","SROVER3",3,0)
 S SROVER=1,SRAO(1)=26,SRAO(2)=27,SRAO(3)="",SRAO(4)=$S(SRNON:33,1:34),SRAO(5)=66,SRAO(6)=""
"RTN","SROVER3",4,0)
ASK W ! K DIR S DIR("A")="Select Information to Edit: ",DIR(0)="FOA",DIR("?",1)="Enter the number corresponding to the information you want to update.  You may"
"RTN","SROVER3",5,0)
 S DIR("?",2)="enter 'ALL' to update all the information displayed on this screen, or a",DIR("?")="range of numbers separated by a ':' to update more than one item." D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",6,0)
 I X="" S SREDIT=1 Q
"RTN","SROVER3",7,0)
 S:$E(X)="a" X="A" I '$D(SRAO(X)),(X'?.N1":".N),($E(X)'="A") D HELP Q:SRSOUT  G ASK
"RTN","SROVER3",8,0)
 I $E(X)="A" S X="1:6"
"RTN","SROVER3",9,0)
 I X?.N1":".N S Y=$E(X),Z=$P(X,":",2) I Y<1!(Z>6)!(Y>Z) D HELP Q:SRSOUT  G ASK
"RTN","SROVER3",10,0)
 D HDR^SROVER2 I X?.N1":".N D RANGE Q
"RTN","SROVER3",11,0)
 S EMILY=X D ONE Q
"RTN","SROVER3",12,0)
 Q
"RTN","SROVER3",13,0)
HELP W !!,"Enter the number corresponding to the information you want to update.  You may",!,"enter 'ALL' to update all the information displayed on this screen, or a"
"RTN","SROVER3",14,0)
 W !,"range of numbers separated by a ':' to update more than one item."
"RTN","SROVER3",15,0)
 Q
"RTN","SROVER3",16,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROVER3",17,0)
 Q
"RTN","SROVER3",18,0)
RANGE ; range of numbers
"RTN","SROVER3",19,0)
 S SHEMP=$P(X,":"),CURLEY=$P(X,":",2) F EMILY=SHEMP:1:CURLEY Q:SRSOUT  W ! D ONE
"RTN","SROVER3",20,0)
 Q
"RTN","SROVER3",21,0)
ONE ; edit one item
"RTN","SROVER3",22,0)
 I EMILY=3 D POTH Q
"RTN","SROVER3",23,0)
 I EMILY=6 D DOTH Q
"RTN","SROVER3",24,0)
 W ! K DR,DIE,DA S DIE=130,DA=SRTN,DR=SRAO(EMILY)_"T" D ^DIE K DR,DIE I $D(Y) S SRSOUT=1
"RTN","SROVER3",25,0)
 Q
"RTN","SROVER3",26,0)
POTH W !,"Other Procedures:",!
"RTN","SROVER3",27,0)
 N SRSHT K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER3",28,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),"^"),X=$P($G(^SRF(SRTN,13,OTH,2)),"^"),CPT="NOT ENTERED",CPT1=""
"RTN","SROVER3",29,0)
 .I X S CPT1=X,Y=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,"^",2),SRSHT=$P(Y,"^",3),Y=SRCPT,SRDA=OTH D SSOTH^SROCPT S SRCPT=Y,CPT=SRCPT_"  "_SRSHT
"RTN","SROVER3",30,0)
 .W !,CNT_". "_OTHER,!,?6,"CPT Code: "_CPT S SRSEL(CNT)=OTH_"^"_OTHER_"^CPT Code: "_CPT_"^"_CPT1
"RTN","SROVER3",31,0)
 .S CNT=CNT+1
"RTN","SROVER3",32,0)
 W !,CNT_". Enter NEW Other Procedure",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",33,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  G PH
"RTN","SROVER3",34,0)
 .W ?3,$P(SRSEL(SRDA),"^",2),!,?6,$P(SRSEL(SRDA),"^",3)
"RTN","SROVER3",35,0)
 .S OTH=$P(SRSEL(SRDA),"^") K SRDES S CPT1=$P(SRSEL(SRDA),"^",4),X=$$CPTD^ICPTCOD(CPT1,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?6,SRDES(I)
"RTN","SROVER3",36,0)
 .K DA,DIE,DIR,DR W ! S DA=$P(SRSEL(SRDA),"^"),DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR=".01;3" D ^DIE K DA,DIE,DR Q:$D(Y)  D PRESS
"RTN","SROVER3",37,0)
 K DIR S DIR("A")="Enter new OTHER PROCEDURE",DIR(0)="130.16,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") G PH
"RTN","SROVER3",38,0)
 K DD,DO S DIC="^SRF(SRTN,13,",X=SRNEW,DIC(0)="L",DIC("P")=$P(^DD(130,.42,0),"^",2) D FILE^DICN K DIC,DD,DO I +Y<0 Q
"RTN","SROVER3",39,0)
 K DA,DIE,DIR,DR S DA=+Y,DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR="3" D ^DIE K DA,DIE,DR Q:$D(Y)  D PRESS
"RTN","SROVER3",40,0)
PH D HDR^SROVER2 D POTH
"RTN","SROVER3",41,0)
 Q
"RTN","SROVER3",42,0)
DOTH W !,"Other Postop Diagnosis:",!
"RTN","SROVER3",43,0)
 K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,15,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER3",44,0)
 .S OTHER=$P(^SRF(SRTN,15,OTH,0),"^"),X=$P($G(^SRF(SRTN,15,OTH,0)),"^",3),SRDIAG="NOT ENTERED"
"RTN","SROVER3",45,0)
 .I X S Y=$$ICDDX^ICDCODE(X,$P($G(^SRF(SRTN,9)),"^",9)),SRNUM=$P(Y,"^",2),SRDES=$P(Y,"^",4),SRDIAG=SRNUM_"  "_SRDES
"RTN","SROVER3",46,0)
 .W !,CNT_". "_OTHER,!,?6,"ICD9 Code: "_SRDIAG S SRSEL(CNT)=OTH_"^"_OTHER_"^ICD9 Code: "_SRDIAG
"RTN","SROVER3",47,0)
 .S CNT=CNT+1
"RTN","SROVER3",48,0)
 W !,CNT_". Enter NEW Other Postop Diagnosis",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",49,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  G DH
"RTN","SROVER3",50,0)
 .W ?3,$P(SRSEL(SRDA),"^",2),!,?6,$P(SRSEL(SRDA),"^",3)
"RTN","SROVER3",51,0)
 .K DA,DIE,DIR,DR W ! S DA=$P(SRSEL(SRDA),"^"),DA(1)=SRTN,DIE="^SRF(SRTN,15,",DR=".01;3" D ^DIE K DA,DIE,DR
"RTN","SROVER3",52,0)
 K DIR S DIR("A")="Enter new OTHER POSTOP DIAGNOSIS",DIR(0)="130.18,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") G DH
"RTN","SROVER3",53,0)
 S DIR(0)="130.18,3" D ^DIR K DIR S SRCODE=$P(Y,"^") I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",54,0)
 S SRCODE=Y K DD,DO S DIC="^SRF(SRTN,15,",X=SRNEW,DIC(0)="L",DIC("DR")="3////"_SRCODE,DIC("P")=$P(^DD(130,.74,0),"^",2) D FILE^DICN K DA,DD,DIC,DO,DR
"RTN","SROVER3",55,0)
DH D HDR^SROVER2 D DOTH
"RTN","SROVER3",56,0)
 Q
"RTN","SRSCOR")
0^32^B14585410
"RTN","SRSCOR",1,0)
SRSCOR ;B'HAM ISC/SJA - Surgery/CoreFLS API ; [ 12/6/01  8:59 AM ]
"RTN","SRSCOR",2,0)
 ;;3.0; Surgery ;**107,127**;24 Jun 93
"RTN","SRSCOR",3,0)
 ;
"RTN","SRSCOR",4,0)
 ; Reference to $$MOD^ICPTMOD supported by DBIA #1996
"RTN","SRSCOR",5,0)
 ; Reference to $$BLDSEG^CSLSUR1 is supported by DBIA #3498
"RTN","SRSCOR",6,0)
 ; Reference to ^DIC(45.3 is supported by DBIA #218
"RTN","SRSCOR",7,0)
 ; Reference to ^TMP("CSLSUR1" is supported by DBIA #3498
"RTN","SRSCOR",8,0)
 ;
"RTN","SRSCOR",9,0)
ST(SRTN) S X="CSLSUR1" X ^%ZOSF("TEST") G:'$T EXIT
"RTN","SRSCOR",10,0)
 N DYNOTE,II,JJ,MM,L,LSS,LSSC,LSSN,NSSIEN,OCIEN,OCPT,OMIEN,OR,ORN,PM,PMIEN,SPF,SRNODE0,SRNODE30,SRNODE31,SROP,SURGN,ASURG,SRICN,SRICPT,SRSP,SROP,SROPER
"RTN","SRSCOR",11,0)
 K ^TMP("CSLSUR1",$J)
"RTN","SRSCOR",12,0)
 S SRNODE0=$G(^SRF(SRTN,0)),SRNODE30=$G(^SRF(SRTN,30)),SRNODE31=$G(^SRF(SRTN,31))
"RTN","SRSCOR",13,0)
AR1 ; Schedule ID
"RTN","SRSCOR",14,0)
 S ^TMP("CSLSUR1",$J,1)=SRTN
"RTN","SRSCOR",15,0)
AR2 ; Patient ID (DFN) and ICN
"RTN","SRSCOR",16,0)
 S X="MPIF001",SRICN="" X ^%ZOSF("TEST") I $T S SRICN=$$GETICN^MPIF001($P(SRNODE0,"^"))
"RTN","SRSCOR",17,0)
 S ^TMP("CSLSUR1",$J,2)=$P(SRNODE0,"^")_"^"_$S($P(SRICN,"^")=-1:"",1:SRICN)
"RTN","SRSCOR",18,0)
AR3 ; Type of Action 
"RTN","SRSCOR",19,0)
 S ^TMP("CSLSUR1",$J,3)=SRTYPE
"RTN","SRSCOR",20,0)
 ;$S(SRTYPE=1:"NEW",SRTYPE=2:"EDIT",SRTYPE=3:"CANCEL",SRTYPE=4:"DELETE",1:"")
"RTN","SRSCOR",21,0)
AR4 ; Date/Time of Surgery
"RTN","SRSCOR",22,0)
 S ^TMP("CSLSUR1",$J,4)=$P(SRNODE31,"^",4)_"^"_$P(SRNODE31,"^",5)_"^"_$P(SRNODE0,"^",9)
"RTN","SRSCOR",23,0)
 ;
"RTN","SRSCOR",24,0)
AR5 ; Principle CPT code & Name
"RTN","SRSCOR",25,0)
 S SROP=$G(^SRF(SRTN,"OP")),^TMP("CSLSUR1",$J,5,0)=$P(SROP,"^")
"RTN","SRSCOR",26,0)
 I +$P(SROP,"^",2) S SRICPT=$$CPT^ICPTCOD($P(SROP,"^",2),$P($G(^SRF(SRTN,0)),"^",9)),^TMP("CSLSUR1",$J,5,1)=$P(SRICPT,"^",2)_"^"_$P(SRICPT,"^",3)
"RTN","SRSCOR",27,0)
 ;
"RTN","SRSCOR",28,0)
 ; CPT modifiers for principle code (X = sequential number)
"RTN","SRSCOR",29,0)
 S PM=0 F  S PM=$O(^SRF(SRTN,"OPMOD",PM)) Q:'PM  S PMIEN=$P($G(^(PM,0)),"^") D
"RTN","SRSCOR",30,0)
 .S ^TMP("CSLSUR1",$J,5,1,PM)=$P($$MOD^ICPTMOD(PMIEN,"I",$P($G(^SRF(SRTN,0)),"^",9)),"^",2,3)
"RTN","SRSCOR",31,0)
 ;
"RTN","SRSCOR",32,0)
 ; Other CPT codes and names (N = value greater than 1)
"RTN","SRSCOR",33,0)
 S II=0,JJ=1 F  S II=$O(^SRF(SRTN,13,II)) Q:'II  S OCIEN=$G(^(II,2)) D
"RTN","SRSCOR",34,0)
 .I +OCIEN S OCPT=$$CPT^ICPTCOD(+OCIEN,$P($G(^SRF(SRTN,0)),"^",9)) S JJ=JJ+1,^TMP("CSLSUR1",$J,5,JJ)=$P(OCPT,"^",2)_"^"_$P(OCPT,"^",3)
"RTN","SRSCOR",35,0)
 .;
"RTN","SRSCOR",36,0)
 .;CPT code modifiers
"RTN","SRSCOR",37,0)
 .S MM=0 F  S MM=$O(^SRF(SRTN,13,II,"MOD",MM)) Q:'MM  S OMIEN=$G(^SRF(SRTN,13,II,"MOD",MM,0)),^TMP("CSLSUR1",$J,5,JJ,MM)=$P($$MOD^ICPTMOD(OMIEN,"I",$P($G(^SRF(SRTN,0)),"^",9)),"^",2,3)
"RTN","SRSCOR",38,0)
AR6 ; Surgeon ID & Name
"RTN","SRSCOR",39,0)
 S SURGN=$P($G(^SRF(SRTN,.1)),"^",4)
"RTN","SRSCOR",40,0)
 I +SURGN S ^TMP("CSLSUR1",$J,6)=SURGN_"^"_$P($G(^VA(200,+SURGN,0)),"^")
"RTN","SRSCOR",41,0)
AR7 ; Surgical Specialty Code & Name
"RTN","SRSCOR",42,0)
 S LSSC=+$P(SRNODE0,"^",4),LSS=$G(^SRO(137.45,LSSC,0)),LSSN=$P(LSS,"^")
"RTN","SRSCOR",43,0)
 S NSSIEN=$P(LSS,"^",2)
"RTN","SRSCOR",44,0)
 I +NSSIEN S ^TMP("CSLSUR1",$J,7)=$P($G(^DIC(45.3,+NSSIEN,0)),"^",1,2)
"RTN","SRSCOR",45,0)
AR8 ; Local Surgical Specialty Code & Name
"RTN","SRSCOR",46,0)
 I +LSSC!(LSSN'="") S ^TMP("CSLSUR1",$J,8)=$P(LSS,"^",4)_"^"_LSSN
"RTN","SRSCOR",47,0)
AR9 ; Operating Room
"RTN","SRSCOR",48,0)
 S OR=$P(SRNODE0,"^",2),JJ=$P($G(^SRS(+OR,0)),"^"),ORN=$G(^SC(+JJ,0))
"RTN","SRSCOR",49,0)
 I +JJ S ^TMP("CSLSUR1",$J,9)=JJ_"^"_$P(ORN,"^")
"RTN","SRSCOR",50,0)
AR10 ; SPD Comments
"RTN","SRSCOR",51,0)
 S L=0 F  S L=$O(^SRF(SRTN,80,L)) Q:'L  S X=$G(^SRF(SRTN,80,L,0)) D
"RTN","SRSCOR",52,0)
 .S ^TMP("CSLSUR1",$J,10,L)=X
"RTN","SRSCOR",53,0)
AR11 ; Hospital
"RTN","SRSCOR",54,0)
 S SPF=$P($G(^SRO(133,+$$SITE^SROUTL0(SRTN),0)),"^")
"RTN","SRSCOR",55,0)
 I +SPF S ^TMP("CSLSUR1",$J,11)=SPF_"^"_$$GET1^DIQ(4,+SPF,.01)
"RTN","SRSCOR",56,0)
AR12 ; Scheduled by
"RTN","SRSCOR",57,0)
 S SRSP=$P($G(^SRF(SRTN,"1.0")),"^",10)
"RTN","SRSCOR",58,0)
 I +SRSP S ^TMP("CSLSUR1",$J,12)=SRSP_"^"_$P($G(^VA(200,+SRSP,0)),"^")
"RTN","SRSCOR",59,0)
AR13 ; Entered by
"RTN","SRSCOR",60,0)
 S ^TMP("CSLSUR1",$J,13)=DUZ_"^"_$P($G(^VA(200,+DUZ,0)),"^")
"RTN","SRSCOR",61,0)
AR14 ; IN/OUT-PATIENT STATUS  
"RTN","SRSCOR",62,0)
 I $P(SRNODE0,"^",12)'="" S ^TMP("CSLSUR1",$J,14)=$P(SRNODE0,"^",12)
"RTN","SRSCOR",63,0)
AR15 ; Time Stamp
"RTN","SRSCOR",64,0)
 D NOW^%DTC S ^TMP("CSLSUR1",$J,15)=%
"RTN","SRSCOR",65,0)
AR16 ; Attending Surgeon
"RTN","SRSCOR",66,0)
 S ASURG=$P($G(^SRF(SRTN,.1)),"^",13)
"RTN","SRSCOR",67,0)
 I +ASURG S ^TMP("CSLSUR1",$J,16)=ASURG_"^"_$P($G(^VA(200,+ASURG,0)),"^")
"RTN","SRSCOR",68,0)
 ;
"RTN","SRSCOR",69,0)
SEND ; Call CoreFLS API
"RTN","SRSCOR",70,0)
 S DYNOTE=+$$BLDSEG^CSLSUR1(1)
"RTN","SRSCOR",71,0)
 I '$P(SRNODE31,"^",10) S $P(^SRF(SRTN,31),"^",10)=$S(DYNOTE=1:1,1:0)
"RTN","SRSCOR",72,0)
 S SROP=SRTN,SROPER="" D ^SROP1 I SROPER["REQUESTED" S $P(^SRF(SRTN,31),"^",10)=0
"RTN","SRSCOR",73,0)
EXIT K ^TMP("CSLSUR1",$J)
"RTN","SRSCOR",74,0)
 Q
"RTN","SRSCOR",75,0)
CHKS(SRDA) ; Calculate checksum of SPD COMMENTS field
"RTN","SRSCOR",76,0)
 N J,L,X,SRCSUM S SRCSUM=0
"RTN","SRSCOR",77,0)
 S L=0 F  S L=$O(^SRF(SRDA,80,L)) Q:'L  S X=^SRF(SRDA,80,L,0) F J=1:1:$L(X) S SRCSUM=L*J*$A(X,J)+SRCSUM
"RTN","SRSCOR",78,0)
 Q SRCSUM
"VER")
8.0^22.0
**END**
**END**
