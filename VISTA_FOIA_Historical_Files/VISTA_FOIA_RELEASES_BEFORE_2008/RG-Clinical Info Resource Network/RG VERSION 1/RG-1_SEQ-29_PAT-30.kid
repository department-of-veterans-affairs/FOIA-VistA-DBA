Released RG*1*30 SEQ #29
Extracted from mail message
**KIDS**:RG*1.0*30^

**INSTALL NAME**
RG*1.0*30
"BLD",1739,0)
RG*1.0*30^CLINICAL INFO RESOURCE NETWORK^0^3030421^y
"BLD",1739,1,0)
^^3^3^3030409^
"BLD",1739,1,1,0)
UTILITY REFINEMENTS & FIXES FOR NOIS
"BLD",1739,1,2,0)
Refer to patch RG*1*30 in the FORUM Patch Module for a complete
"BLD",1739,1,3,0)
description.
"BLD",1739,4,0)
^9.64PA^^
"BLD",1739,"ABNS",0)
^9.66A^^
"BLD",1739,"ABPKG")
^^
"BLD",1739,"KRN",0)
^9.67PA^8989.52^19
"BLD",1739,"KRN",.4,0)
.4
"BLD",1739,"KRN",.401,0)
.401
"BLD",1739,"KRN",.402,0)
.402
"BLD",1739,"KRN",.403,0)
.403
"BLD",1739,"KRN",.5,0)
.5
"BLD",1739,"KRN",.84,0)
.84
"BLD",1739,"KRN",3.6,0)
3.6
"BLD",1739,"KRN",3.8,0)
3.8
"BLD",1739,"KRN",9.2,0)
9.2
"BLD",1739,"KRN",9.8,0)
9.8
"BLD",1739,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",1739,"KRN",9.8,"NM",1,0)
RGMTMONT^^0^B32270291
"BLD",1739,"KRN",9.8,"NM",2,0)
RGMTMONX^^0^B66787940
"BLD",1739,"KRN",9.8,"NM",3,0)
RGMTAUDP^^0^B59077738
"BLD",1739,"KRN",9.8,"NM",4,0)
RGEX03^^0^B81384237
"BLD",1739,"KRN",9.8,"NM",5,0)
RGMTAUD^^0^B20411525
"BLD",1739,"KRN",9.8,"NM",6,0)
RGMTETOT^^0^B36933241
"BLD",1739,"KRN",9.8,"NM","B","RGEX03",4)

"BLD",1739,"KRN",9.8,"NM","B","RGMTAUD",5)

"BLD",1739,"KRN",9.8,"NM","B","RGMTAUDP",3)

"BLD",1739,"KRN",9.8,"NM","B","RGMTETOT",6)

"BLD",1739,"KRN",9.8,"NM","B","RGMTMONT",1)

"BLD",1739,"KRN",9.8,"NM","B","RGMTMONX",2)

"BLD",1739,"KRN",19,0)
19
"BLD",1739,"KRN",19.1,0)
19.1
"BLD",1739,"KRN",101,0)
101
"BLD",1739,"KRN",409.61,0)
409.61
"BLD",1739,"KRN",771,0)
771
"BLD",1739,"KRN",870,0)
870
"BLD",1739,"KRN",8989.51,0)
8989.51
"BLD",1739,"KRN",8989.52,0)
8989.52
"BLD",1739,"KRN",8994,0)
8994
"BLD",1739,"KRN","B",.4,.4)

"BLD",1739,"KRN","B",.401,.401)

"BLD",1739,"KRN","B",.402,.402)

"BLD",1739,"KRN","B",.403,.403)

"BLD",1739,"KRN","B",.5,.5)

"BLD",1739,"KRN","B",.84,.84)

"BLD",1739,"KRN","B",3.6,3.6)

"BLD",1739,"KRN","B",3.8,3.8)

"BLD",1739,"KRN","B",9.2,9.2)

"BLD",1739,"KRN","B",9.8,9.8)

"BLD",1739,"KRN","B",19,19)

"BLD",1739,"KRN","B",19.1,19.1)

"BLD",1739,"KRN","B",101,101)

"BLD",1739,"KRN","B",409.61,409.61)

"BLD",1739,"KRN","B",771,771)

"BLD",1739,"KRN","B",870,870)

"BLD",1739,"KRN","B",8989.51,8989.51)

"BLD",1739,"KRN","B",8989.52,8989.52)

"BLD",1739,"KRN","B",8994,8994)

"BLD",1739,"QUES",0)
^9.62^^
"BLD",1739,"REQB",0)
^9.611^1^1
"BLD",1739,"REQB",1,0)
RG*1.0*20^2
"BLD",1739,"REQB","B","RG*1.0*20",1)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
30^3030421
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3030421
"PKG",272,22,1,"PAH",1,1,1,0)
UTILITY REFINEMENTS & FIXES FOR NOIS
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*30 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RGEX03")
0^4^B81384237
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,27,30**;30 Apr 99
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;Reference to NOTICE^DGSEC4 and PTSEC^DGSEC4 supported by IA#3027
"RTN","RGEX03",11,0)
 ;
"RTN","RGEX03",12,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",13,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",14,0)
 Q
"RTN","RGEX03",15,0)
 ;
"RTN","RGEX03",16,0)
HDR ; -- header code
"RTN","RGEX03",17,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",18,0)
 S VALMHDR(2)=""
"RTN","RGEX03",19,0)
 Q
"RTN","RGEX03",20,0)
 ;
"RTN","RGEX03",21,0)
INIT ; -- init variables and list array
"RTN","RGEX03",22,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",23,0)
 K @VALMAR
"RTN","RGEX03",24,0)
 I DATA="" Q
"RTN","RGEX03",25,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",26,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",29,0)
 D ADDTMP
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",32,0)
 D ADDTMP
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",34,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",35,0)
 D ADDTMP
"RTN","RGEX03",36,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",37,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",38,0)
 D ADDTMP
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",40,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",41,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",42,0)
 D ADDTMP
"RTN","RGEX03",43,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",44,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",45,0)
 D ADDTMP
"RTN","RGEX03",46,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",47,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",48,0)
 D ADDTMP
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",50,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",51,0)
 D ADDTMP
"RTN","RGEX03",52,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",53,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",54,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",55,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",57,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",58,0)
 D ADDTMP
"RTN","RGEX03",59,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",60,0)
 D ADDTMP
"RTN","RGEX03",61,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20)
"RTN","RGEX03",62,0)
 D ADDTMP
"RTN","RGEX03",63,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",64,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",65,0)
 S IENS=IEN2_","_IEN_","
"RTN","RGEX03",66,0)
 S N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",67,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  D
"RTN","RGEX03",68,0)
 . S NOTE=NT(L)
"RTN","RGEX03",69,0)
 . S STR=$$SETSTR^VALM1(NOTE,STR,6,74)
"RTN","RGEX03",70,0)
 . D ADDTMP
"RTN","RGEX03",71,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",72,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",73,0)
 S VAFCDFN=DFN
"RTN","RGEX03",74,0)
 K L,NT
"RTN","RGEX03",75,0)
 Q
"RTN","RGEX03",76,0)
ADDTMP ;
"RTN","RGEX03",77,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",78,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",79,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",80,0)
 Q
"RTN","RGEX03",81,0)
 ;
"RTN","RGEX03",82,0)
UPD ;
"RTN","RGEX03",83,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",84,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",85,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",86,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",87,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",88,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",89,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",90,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",91,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",92,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",93,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",94,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",95,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",96,0)
 . D INIT
"RTN","RGEX03",97,0)
 K DIR,DIRUT
"RTN","RGEX03",98,0)
 S VALMBCK="R"
"RTN","RGEX03",99,0)
 Q
"RTN","RGEX03",100,0)
PA ;Patient Audit
"RTN","RGEX03",101,0)
 S PDFN=DFN
"RTN","RGEX03",102,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",103,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",104,0)
 S DFN=PDFN
"RTN","RGEX03",105,0)
 K QFLG,PDFN
"RTN","RGEX03",106,0)
PAQ Q
"RTN","RGEX03",107,0)
HI ;Hinq Inquiry
"RTN","RGEX03",108,0)
 S VALMBCK=""
"RTN","RGEX03",109,0)
 D HINQ^DG10
"RTN","RGEX03",110,0)
 D PAUSE^VALM1
"RTN","RGEX03",111,0)
 S VALMBCK="R"
"RTN","RGEX03",112,0)
 Q
"RTN","RGEX03",113,0)
DISP ; Display Only Query
"RTN","RGEX03",114,0)
 S VALMBCK=""
"RTN","RGEX03",115,0)
 D FULL^VALM1
"RTN","RGEX03",116,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",117,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",118,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",119,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",120,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",121,0)
 D PAUSE^VALM1
"RTN","RGEX03",122,0)
 S VALMBCK="R"
"RTN","RGEX03",123,0)
 K MPIVAR
"RTN","RGEX03",124,0)
 Q
"RTN","RGEX03",125,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",126,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",127,0)
 D FULL^VALM1
"RTN","RGEX03",128,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",129,0)
 D PAUSE^VALM1
"RTN","RGEX03",130,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",131,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",132,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",133,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",134,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",135,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",136,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",137,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",138,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",139,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",140,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",141,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",142,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",143,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",144,0)
 D INIT
"RTN","RGEX03",145,0)
 S VALMBCK="R"
"RTN","RGEX03",146,0)
 Q
"RTN","RGEX03",147,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",148,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",149,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",150,0)
 D FULL^VALM1
"RTN","RGEX03",151,0)
 D ELIG^VADPT
"RTN","RGEX03",152,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",153,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",154,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",155,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",156,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",157,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",158,0)
 .. S VALMBCK="R"
"RTN","RGEX03",159,0)
 . E  D SENS
"RTN","RGEX03",160,0)
 E  D SENS
"RTN","RGEX03",161,0)
 Q
"RTN","RGEX03",162,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",163,0)
 N RESULT,RGSEN
"RTN","RGEX03",164,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RG EXCEPTION HANDLING^MPI/PD Exception Handling")
"RTN","RGEX03",165,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",166,0)
 I RESULT(1)>0 W !!?15,"***PATIENT MARKED SENSITIVE***"
"RTN","RGEX03",167,0)
 I RESULT(1)=3 W !!?15,"Access not allowed on your own PATIENT (#2) file entry" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",168,0)
 I RESULT(1)=4 W !!?15,"Access denied: Your SSN is not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",169,0)
 I RESULT(1)<3 D
"RTN","RGEX03",170,0)
 . I RESULT(1)=1 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",2)
"RTN","RGEX03",171,0)
 . I RESULT(1)=2 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",3)
"RTN","RGEX03",172,0)
 D EDIT
"RTN","RGEX03",173,0)
 Q
"RTN","RGEX03",174,0)
EDIT ; edit patient data
"RTN","RGEX03",175,0)
 S ACCESS=0
"RTN","RGEX03",176,0)
 D REC
"RTN","RGEX03",177,0)
 Q:ACCESS=0
"RTN","RGEX03",178,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",179,0)
 S DR=".01//^S X=NAME;.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",180,0)
 L +^DPT(DFN):10
"RTN","RGEX03",181,0)
 D ^DIE K DIE,DA,DR
"RTN","RGEX03",182,0)
 L -^DPT(DFN)
"RTN","RGEX03",183,0)
 S DATAOLD=DATA
"RTN","RGEX03",184,0)
 D DEATH
"RTN","RGEX03",185,0)
 D DEM^VADPT
"RTN","RGEX03",186,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",187,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",188,0)
 D INIT
"RTN","RGEX03",189,0)
 S VALMBCK="R"
"RTN","RGEX03",190,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",191,0)
QUIT Q
"RTN","RGEX03",192,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",193,0)
 ; check for security key
"RTN","RGEX03",194,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",195,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",196,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",197,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",198,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",199,0)
 . D PAUSE^VALM1
"RTN","RGEX03",200,0)
 . S VALMBCK="R"
"RTN","RGEX03",201,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",202,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",203,0)
 . W !,"own medical record."
"RTN","RGEX03",204,0)
 . D PAUSE^VALM1
"RTN","RGEX03",205,0)
 . S VALMBCK="R"
"RTN","RGEX03",206,0)
 E  S ACCESS=1
"RTN","RGEX03",207,0)
 Q
"RTN","RGEX03",208,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",209,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",210,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",211,0)
 . S DOD=""
"RTN","RGEX03",212,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",213,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",214,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",215,0)
 . D ^DIE
"RTN","RGEX03",216,0)
 . L -^DPT(DFN)
"RTN","RGEX03",217,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",218,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",219,0)
 Q
"RTN","RGEX03",220,0)
INQ ; Patient Inquiry
"RTN","RGEX03",221,0)
 S VALMBCK=""
"RTN","RGEX03",222,0)
 D FULL^VALM1
"RTN","RGEX03",223,0)
 D EN^DGRPD
"RTN","RGEX03",224,0)
 D PAUSE^VALM1
"RTN","RGEX03",225,0)
 D CLEAN^VALM10
"RTN","RGEX03",226,0)
 D INIT
"RTN","RGEX03",227,0)
 S VALMBCK="R"
"RTN","RGEX03",228,0)
 Q
"RTN","RGEX03",229,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",230,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",231,0)
 L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",232,0)
 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11"
"RTN","RGEX03",233,0)
 D ^DIE
"RTN","RGEX03",234,0)
 L -^RGHL7(991.1,IEN)
"RTN","RGEX03",235,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",236,0)
 D INIT
"RTN","RGEX03",237,0)
 S VALMBCK="R"
"RTN","RGEX03",238,0)
 Q
"RTN","RGEX03",239,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",240,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",241,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1
"RTN","RGEX03",242,0)
 S RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH")
"RTN","RGEX03",243,0)
 S RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",244,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",245,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",246,0)
 U IO
"RTN","RGEX03",247,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",248,0)
 N RGXDEL
"RTN","RGEX03",249,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",250,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",251,0)
 S RGXDEL(RGXFILE)=""
"RTN","RGEX03",252,0)
 S X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3)
"RTN","RGEX03",253,0)
 S X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",254,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",255,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",256,0)
 D INIT
"RTN","RGEX03",257,0)
 S VALMBCK="R"
"RTN","RGEX03",258,0)
 K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",259,0)
 Q
"RTN","RGEX03",260,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",261,0)
 K RETURN
"RTN","RGEX03",262,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",263,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",264,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",265,0)
 . I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",266,0)
 .. S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",267,0)
 ... S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",268,0)
 .... I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",269,0)
 ..... S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",270,0)
 ..... S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",271,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",272,0)
QGET ;
"RTN","RGEX03",273,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",274,0)
 Q
"RTN","RGEX03",275,0)
HELP ; -- help code
"RTN","RGEX03",276,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",277,0)
 Q
"RTN","RGEX03",278,0)
 ;
"RTN","RGEX03",279,0)
EXIT ; -- exit code
"RTN","RGEX03",280,0)
 S VALMBCK=""
"RTN","RGEX03",281,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",282,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",283,0)
 Q
"RTN","RGEX03",284,0)
 ;
"RTN","RGEX03",285,0)
EXPND ; -- expand code
"RTN","RGEX03",286,0)
 Q
"RTN","RGEX03",287,0)
 ;
"RTN","RGMTAUD")
0^5^B20411525
"RTN","RGMTAUD",1,0)
RGMTAUD ;BIR/CML-MPI/PD AUDIT FILE PRINT FOR A SPECIFIED PATIENT ;01/06/99
"RTN","RGMTAUD",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,19,20,30**;30 Apr 99
"RTN","RGMTAUD",3,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTAUD",4,0)
 ;is supported by IA #2097 and #2602.
"RTN","RGMTAUD",5,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTAUD",6,0)
 S QFLG=1
"RTN","RGMTAUD",7,0)
BEGIN ;
"RTN","RGMTAUD",8,0)
 W !!,"This option prints information from the AUDIT file (#1.1) for a"
"RTN","RGMTAUD",9,0)
 W !,"selected patient and date range."
"RTN","RGMTAUD",10,0)
 W !!,"For the PATIENT file (#2) entry selected, the report prints the"
"RTN","RGMTAUD",11,0)
 W !,"patient name and DFN, date/time the field was edited, the user who"
"RTN","RGMTAUD",12,0)
 W !,"made the change, the field edited, the old value, and the new value."
"RTN","RGMTAUD",13,0)
 W !,"The option or protocol (if available) will also be displayed."
"RTN","RGMTAUD",14,0)
 ;
"RTN","RGMTAUD",15,0)
ASK1 ;Ask for PATIENT
"RTN","RGMTAUD",16,0)
 W !
"RTN","RGMTAUD",17,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC G:Y<0 QUIT S RGDFN=+Y
"RTN","RGMTAUD",18,0)
 I '$O(^DIA(2,"B",RGDFN,0)) W !!,"This patient has no audit data available for any date." G ASK1
"RTN","RGMTAUD",19,0)
 ;
"RTN","RGMTAUD",20,0)
ASK2 ;Ask for Date Range
"RTN","RGMTAUD",21,0)
 I '$D(RGDFN)&($D(DFN)) S RGDFN=DFN
"RTN","RGMTAUD",22,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUD",23,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT
"RTN","RGMTAUD",24,0)
 S RGBDT=Y,DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTAUD",25,0)
 ;
"RTN","RGMTAUD",26,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUD",27,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("RGDFN")=""
"RTN","RGMTAUD",28,0)
 D EN^XUTMDEVQ("START^RGMTAUD","MPI/PD - Print AUDIT File Data for a Specific Patient",.ZTSAVE) I 'POP Q
"RTN","RGMTAUD",29,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUD",30,0)
 G QUIT
"RTN","RGMTAUD",31,0)
 ;
"RTN","RGMTAUD",32,0)
START ;
"RTN","RGMTAUD",33,0)
 K ^TMP("RGMTAUD",$J) S U="^"
"RTN","RGMTAUD",34,0)
 ;
"RTN","RGMTAUD",35,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUD",36,0)
 S STOP=RGEDT+1
"RTN","RGMTAUD",37,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUD",38,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUD",39,0)
 ..S ^TMP("RGMTAUD",$J,EDITDT,IEN)=""
"RTN","RGMTAUD",40,0)
 ;
"RTN","RGMTAUD",41,0)
PRT ;Print report
"RTN","RGMTAUD",42,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUD",43,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUD",44,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUD",45,0)
 D HDR
"RTN","RGMTAUD",46,0)
 I '$O(^TMP("RGMTAUD",$J,0)) W !!,"No audit data found in this date range for this patient." G QUIT
"RTN","RGMTAUD",47,0)
 S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUD",$J,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUD",48,0)
 .S IEN=0 F  S IEN=$O(^TMP("RGMTAUD",$J,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUD",49,0)
 ..S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUD",50,0)
 ..S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUD",51,0)
 ..K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUD",52,0)
 ..S FLD=$G(RGARR("LABEL"))  Q:FLD=""
"RTN","RGMTAUD",53,0)
 ..S USER=$P(IEN0,U,4)
"RTN","RGMTAUD",54,0)
 ..I 'USER S USER="UNKNOWN"
"RTN","RGMTAUD",55,0)
 ..I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUD",56,0)
 ..S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUD",57,0)
 ..S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUD",58,0)
 ..K OPTDA1,OPTDA2,RGOPTN,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","RGMTAUD",59,0)
 ...S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","RGMTAUD",60,0)
 ...I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S RGOPTN=$G(RGOPTN(19,OPTDA1,.01,"E"))
"RTN","RGMTAUD",61,0)
 ...S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","RGMTAUD",62,0)
 ...I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(RGOPTN(101,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",63,0)
 ...I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(RGOPTN(19,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",64,0)
 ..D:$Y+4>IOSL HDR Q:QFLG  W !!,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUD",65,0)
 ..I $G(RGOPTN)'="" W !?3,RGOPTN ;**20
"RTN","RGMTAUD",66,0)
 ..I $G(OPTNM)'="" W:$G(RGOPTN)="" !?3 W "/",$G(OPTNM) ;**20
"RTN","RGMTAUD",67,0)
 ;
"RTN","RGMTAUD",68,0)
QUIT ;
"RTN","RGMTAUD",69,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUD",70,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",71,0)
 K ^TMP("RGMTAUD",$J)
"RTN","RGMTAUD",72,0)
 K %,%I,DFN,C,RGDFN,EDITDT,FLD,HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,RGOPTN,OPTNM,PG,PRGBDT,PRGEDT,PRTDT
"RTN","RGMTAUD",73,0)
 K QFLG,RGARR,RGBDT,RGEDT,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUD",74,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTAUD",75,0)
 ;
"RTN","RGMTAUD",76,0)
HDR ;HEADER
"RTN","RGMTAUD",77,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",78,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUD",79,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUD",80,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?72,"Page: ",PG
"RTN","RGMTAUD",81,0)
 W !,"Patient: ",$P(^DPT(RGDFN,0),U)," (DFN #",RGDFN,")"
"RTN","RGMTAUD",82,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUD",83,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By"
"RTN","RGMTAUD",84,0)
 W !?20,"Old Value / New Value",!?3,"Option/Protocol",!,LN
"RTN","RGMTAUD",85,0)
 Q
"RTN","RGMTAUDP")
0^3^B59077738
"RTN","RGMTAUDP",1,0)
RGMTAUDP ;BIR/CML,PTD-MPI/PD AUDIT File Print of Patient Data ;01/06/99
"RTN","RGMTAUDP",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19,30**;30 Apr 99
"RTN","RGMTAUDP",3,0)
 ;Reference to ^DD(2 supported by IA #2695.
"RTN","RGMTAUDP",4,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTAUDP",5,0)
 ;supported by IA #2097 and #2602.
"RTN","RGMTAUDP",6,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTAUDP",7,0)
 ;
"RTN","RGMTAUDP",8,0)
BEGIN ;
"RTN","RGMTAUDP",9,0)
 S QFLG=1
"RTN","RGMTAUDP",10,0)
 W @IOF
"RTN","RGMTAUDP",11,0)
 W !,"This option prints a customized report of information stored in the AUDIT"
"RTN","RGMTAUDP",12,0)
 W !,"file (#1.1) for fields being audited in the PATIENT file (#2).  For a"
"RTN","RGMTAUDP",13,0)
 W !,"specified date range, you can view all audited fields or selected fields."
"RTN","RGMTAUDP",14,0)
 W !,"You can also opt to print only edits that were done by a specific user."
"RTN","RGMTAUDP",15,0)
 W !!,"- If selected fields are viewed, you can choose to see data for all or"
"RTN","RGMTAUDP",16,0)
 W !,"  selected patients."
"RTN","RGMTAUDP",17,0)
 W !,"- If ALL audited fields are viewed, you must choose patients to examine."
"RTN","RGMTAUDP",18,0)
 ;
"RTN","RGMTAUDP",19,0)
ASKFLD ;Ask for Data Fields
"RTN","RGMTAUDP",20,0)
 I '$O(^DD(2,"AUDIT",0)) W !!,"No fields are currently being audited in the PATIENT file (#2)." G QUIT
"RTN","RGMTAUDP",21,0)
 W !
"RTN","RGMTAUDP",22,0)
 K DIR S DIR(0)="SAM^A:ALL;S:SELECTED;"
"RTN","RGMTAUDP",23,0)
 S DIR("A")="Do you want to see (A)LL or (S)ELECTED audited fields? "
"RTN","RGMTAUDP",24,0)
 S DIR("B")="A"
"RTN","RGMTAUDP",25,0)
 S DIR("?",1)="Enter:"
"RTN","RGMTAUDP",26,0)
 S DIR("?",2)=" ""A"" to see ALL audited fields in the PATIENT file (#2)."
"RTN","RGMTAUDP",27,0)
 S DIR("?")=" ""S"" to select specific audited fields."
"RTN","RGMTAUDP",28,0)
 D ^DIR G:$D(DIRUT) QUIT S ANS1=Y
"RTN","RGMTAUDP",29,0)
 ;
"RTN","RGMTAUDP",30,0)
FLDLOOP ;
"RTN","RGMTAUDP",31,0)
 W ! K FLD
"RTN","RGMTAUDP",32,0)
 ;stuff all fields
"RTN","RGMTAUDP",33,0)
 I ANS1="A" D  G ASKPAT
"RTN","RGMTAUDP",34,0)
 .S FLD=0 F  S FLD=$O(^DD(2,"AUDIT",FLD)) Q:'FLD  S FLD(FLD)=""
"RTN","RGMTAUDP",35,0)
 ;ask for specific fields
"RTN","RGMTAUDP",36,0)
 K DIR S DIR(0)="NAOC^.0000001:9999999:7^K:'$D(^DD(2,""AUDIT"",X)) X S RGERR=1"
"RTN","RGMTAUDP",37,0)
 S DIR("A")="Select FIELD NUMBER of audited field (enter ""?"" for list): "
"RTN","RGMTAUDP",38,0)
 S DIR("?")="^D FLDLIST^RGMTAUDP"
"RTN","RGMTAUDP",39,0)
 F QQ=0:0 S RGERR=0 D ^DIR Q:$D(DIRUT)  S FLD(+Y)=""
"RTN","RGMTAUDP",40,0)
 ;
"RTN","RGMTAUDP",41,0)
ASKPAT ;Ask for Patient
"RTN","RGMTAUDP",42,0)
 I '$O(FLD(0))!($D(DUOUT)) S QFLG=1 G QUIT
"RTN","RGMTAUDP",43,0)
 I ANS1="A" S ANS2="S" G PATLOOP
"RTN","RGMTAUDP",44,0)
 K DIR S DIR(0)="SAM^A:ALL;S:SELECTED;"
"RTN","RGMTAUDP",45,0)
 S DIR("A")="Do you want to see audited data for (A)LL or (S)ELECTED patients? "
"RTN","RGMTAUDP",46,0)
 S DIR("B")="S"
"RTN","RGMTAUDP",47,0)
 S DIR("?",1)="Enter:"
"RTN","RGMTAUDP",48,0)
 S DIR("?",2)=" ""A"" to see audited fields for ALL patients."
"RTN","RGMTAUDP",49,0)
 S DIR("?")=" ""S"" to select specific patients(s)."
"RTN","RGMTAUDP",50,0)
 W ! D ^DIR G:$D(DIRUT) QUIT S ANS2=Y
"RTN","RGMTAUDP",51,0)
PATLOOP ;
"RTN","RGMTAUDP",52,0)
 W ! K PAT
"RTN","RGMTAUDP",53,0)
 I ANS2="A" S PAT("ALL")="" G ASKDT
"RTN","RGMTAUDP",54,0)
 ;ask for specific patient(s)
"RTN","RGMTAUDP",55,0)
 F QQ=0:0 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC Q:Y<0  S RGDFN=+Y D
"RTN","RGMTAUDP",56,0)
 .I '$O(^DIA(2,"B",RGDFN,0)) W $C(7),!?5,"This patient has no audit data available for any date." Q
"RTN","RGMTAUDP",57,0)
 .S PAT(RGDFN)=""
"RTN","RGMTAUDP",58,0)
 ;
"RTN","RGMTAUDP",59,0)
ASKDT ;Ask for Date Range
"RTN","RGMTAUDP",60,0)
 I '$D(PAT)!($D(DUOUT)) S QFLG=1 G QUIT
"RTN","RGMTAUDP",61,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUDP",62,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT
"RTN","RGMTAUDP",63,0)
 S RGBDT=Y,DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTAUDP",64,0)
 ;
"RTN","RGMTAUDP",65,0)
ASKUSER ;Ask if data is wanted only a specific user
"RTN","RGMTAUDP",66,0)
 K USERSCRN
"RTN","RGMTAUDP",67,0)
 W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to find only the edits made by a specific user"
"RTN","RGMTAUDP",68,0)
 D ^DIR K DIR I +Y'=1 G DEV
"RTN","RGMTAUDP",69,0)
 ;
"RTN","RGMTAUDP",70,0)
 S DIC="^VA(200,",DIC(0)="QEAM",DIC("A")="Select USER: "
"RTN","RGMTAUDP",71,0)
 D ^DIC K DIC G:+Y<0 QUIT S USERSCRN=+Y
"RTN","RGMTAUDP",72,0)
 ;
"RTN","RGMTAUDP",73,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUDP",74,0)
 I ANS2="A" S IOP="Q" W "Because you selected ALL patients, you MUST queue this report.",!!
"RTN","RGMTAUDP",75,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("ANS2")="",ZTSAVE("FLD(")="",ZTSAVE("PAT(")="",%ZIS("B")=""
"RTN","RGMTAUDP",76,0)
 D EN^XUTMDEVQ("START^RGMTAUDP","MPI/PD - Print AUDIT File Data from the PATIENT file",.ZTSAVE,.%ZIS) I 'POP Q
"RTN","RGMTAUDP",77,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUDP",78,0)
 S QFLG=1 G QUIT
"RTN","RGMTAUDP",79,0)
 ;
"RTN","RGMTAUDP",80,0)
START ;
"RTN","RGMTAUDP",81,0)
 K ^TMP("RGMTAUDP",$J),^TMP("RGMTAUDP2",$J) S U="^"
"RTN","RGMTAUDP",82,0)
 S STOP=RGEDT+1
"RTN","RGMTAUDP",83,0)
 I ANS2="A" D
"RTN","RGMTAUDP",84,0)
 .S CNT=0
"RTN","RGMTAUDP",85,0)
 .S RGDFN=0 F  S RGDFN=$O(^DIA(2,"B",RGDFN)) Q:'RGDFN  S CNT=CNT+1 S:'(CNT#10000) ^TMP("RGMTAUDP",$J,"@@@@","CUR DFN")=RGDFN D LOOP
"RTN","RGMTAUDP",86,0)
 I ANS2="S" D
"RTN","RGMTAUDP",87,0)
 .S RGDFN=0 F  S RGDFN=$O(PAT(RGDFN)) Q:'RGDFN  D LOOP
"RTN","RGMTAUDP",88,0)
 G PRT
"RTN","RGMTAUDP",89,0)
 ;
"RTN","RGMTAUDP",90,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUDP",91,0)
 Q:'$D(^DPT(RGDFN,0))
"RTN","RGMTAUDP",92,0)
 I ANS2="S" D
"RTN","RGMTAUDP",93,0)
 . S PATNM=$P(^DPT(RGDFN,0),U)_U_RGDFN
"RTN","RGMTAUDP",94,0)
 . I '$O(^DIA(2,"B",RGDFN,0)) S ^TMP("RGMTAUDP2",$J,"NO AUDIT",PATNM)=" has no audit data available for any date."
"RTN","RGMTAUDP",95,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUDP",96,0)
 .I $D(^DIA(2,IEN,0)) S IEN0=(^(0)),EDITDT=$P(IEN0,U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUDP",97,0)
 ..S FLD=$P(IEN0,U,3) I $D(FLD(FLD)) D
"RTN","RGMTAUDP",98,0)
 ...S USER=$P(IEN0,U,4)
"RTN","RGMTAUDP",99,0)
 ...I $D(USERSCRN) I USER'=USERSCRN Q
"RTN","RGMTAUDP",100,0)
 ...S PATNM=$P(^DPT(RGDFN,0),U)_U_RGDFN,^TMP("RGMTAUDP",$J,PATNM,EDITDT,IEN)=""
"RTN","RGMTAUDP",101,0)
 I ANS2="S" D
"RTN","RGMTAUDP",102,0)
 . I '$D(^TMP("RGMTAUDP",$J,PATNM)) S ^TMP("RGMTAUDP2",$J,"NO AUDIT",PATNM)=" has no audit data available for selected parameters."
"RTN","RGMTAUDP",103,0)
 Q
"RTN","RGMTAUDP",104,0)
 ;
"RTN","RGMTAUDP",105,0)
PRT ;Print report
"RTN","RGMTAUDP",106,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUDP",107,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUDP",108,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUDP",109,0)
 D HDR
"RTN","RGMTAUDP",110,0)
 I '$D(^TMP("RGMTAUDP",$J)) W !!,"No audit data found in this date range for specified parameters." G QUIT
"RTN","RGMTAUDP",111,0)
 S PATNM="@@@@" F  S PATNM=$O(^TMP("RGMTAUDP",$J,PATNM)) Q:PATNM=""  Q:QFLG  D
"RTN","RGMTAUDP",112,0)
 .D:$Y+4>IOSL HDR Q:QFLG
"RTN","RGMTAUDP",113,0)
 .W !!,"==> ",$P(PATNM,U),"  (DFN #",$P(PATNM,U,2),")"
"RTN","RGMTAUDP",114,0)
 .S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUDP",$J,PATNM,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUDP",115,0)
 ..S IEN=0 F  S IEN=$O(^TMP("RGMTAUDP",$J,PATNM,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUDP",116,0)
 ...S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUDP",117,0)
 ...S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUDP",118,0)
 ...K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUDP",119,0)
 ...S FLD=$G(RGARR("LABEL"))  Q:FLD=""
"RTN","RGMTAUDP",120,0)
 ...S USER=$P(IEN0,U,4)
"RTN","RGMTAUDP",121,0)
 ...I 'USER S USER="UNKNOWN"
"RTN","RGMTAUDP",122,0)
 ...I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUDP",123,0)
 ...S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUDP",124,0)
 ...S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUDP",125,0)
 ...K OPTDA1,OPTDA2,OPTION,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","RGMTAUDP",126,0)
 ....S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","RGMTAUDP",127,0)
 ....I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTION=$G(OPTION(19,OPTDA1,.01,"E"))
"RTN","RGMTAUDP",128,0)
 ....S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","RGMTAUDP",129,0)
 ....I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(101,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUDP",130,0)
 ....I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(19,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUDP",131,0)
 ...D:$Y+5>IOSL HDR Q:QFLG  W !!,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUDP",132,0)
 ...I $G(OPTION)'="" W !?3,OPTION I $G(OPTNM)'="" W "/",OPTNM
"RTN","RGMTAUDP",133,0)
 I $D(^TMP("RGMTAUDP2",$J,"NO AUDIT")) D
"RTN","RGMTAUDP",134,0)
 . S PATNM="@@@@",RGNAUD="" F  S PATNM=$O(^TMP("RGMTAUDP2",$J,"NO AUDIT",PATNM)) Q:PATNM=""  D
"RTN","RGMTAUDP",135,0)
 .. Q:QFLG
"RTN","RGMTAUDP",136,0)
 .. S RGNAUD=$P(^TMP("RGMTAUDP2",$J,"NO AUDIT",PATNM),U)
"RTN","RGMTAUDP",137,0)
 .. W !!,"==> ",$P(PATNM,U),"  (DFN #",$P(PATNM,U,2),")"_RGNAUD
"RTN","RGMTAUDP",138,0)
 ;
"RTN","RGMTAUDP",139,0)
QUIT ;
"RTN","RGMTAUDP",140,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUDP",141,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUDP",142,0)
 K ^TMP("RGMTAUDP",$J),^TMP("RGMTAUDP2",$J)
"RTN","RGMTAUDP",143,0)
 K %,%I,ANS1,ANS2,C,CNT,RGDFN,DIR,DIRUT,DTOUT,DUOUT,EDITDT,FLD,FLDLP,FLDNM,HDR
"RTN","RGMTAUDP",144,0)
 K HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,OPTION,OPTNM,PAT,PATNM,PG,PRGBDT,PRGEDT,PRTDT,QFLG,QQ,RGARR,RGBDT,RGNAUD
"RTN","RGMTAUDP",145,0)
 K RGEDT,RGERR,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUDP",146,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTAUDP",147,0)
 ;
"RTN","RGMTAUDP",148,0)
HDR ;HEADER
"RTN","RGMTAUDP",149,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUDP",150,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUDP",151,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUDP",152,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?72,"Page: ",PG
"RTN","RGMTAUDP",153,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUDP",154,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By",!?20,"Old Value / New Value"
"RTN","RGMTAUDP",155,0)
 W !?3,"Option/Protocol",!,LN
"RTN","RGMTAUDP",156,0)
 Q
"RTN","RGMTAUDP",157,0)
 ;
"RTN","RGMTAUDP",158,0)
FLDLIST ;Help for Field # List
"RTN","RGMTAUDP",159,0)
 K RG N DIR S QFLG=0 I RGERR W $C(7)," ??"
"RTN","RGMTAUDP",160,0)
 S HDR="Select a FIELD NUMBER from the audited field(s) in the PATIENT file:"
"RTN","RGMTAUDP",161,0)
 W @IOF,HDR,!
"RTN","RGMTAUDP",162,0)
 S FLDLP=0 F  S FLDLP=$O(^DD(2,"AUDIT",FLDLP)) Q:'FLDLP  Q:QFLG  D
"RTN","RGMTAUDP",163,0)
 .I $Y+6>IOSL D  Q:QFLG
"RTN","RGMTAUDP",164,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUDP",165,0)
 ..E  W @IOF,HDR,!
"RTN","RGMTAUDP",166,0)
 .K RGARR D FIELD^DID(2,FLDLP,"","LABEL","RGARR")
"RTN","RGMTAUDP",167,0)
 .S FLDNM=$G(RGARR("LABEL")) Q:FLDNM=""
"RTN","RGMTAUDP",168,0)
 .W !,FLDLP,?13,FLDNM
"RTN","RGMTAUDP",169,0)
 Q
"RTN","RGMTETOT")
0^6^B36933241
"RTN","RGMTETOT",1,0)
RGMTETOT ;BIR/CML-Compile Totals for Site Exceptions ;11/15/01
"RTN","RGMTETOT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,30**;30 Apr 99
"RTN","RGMTETOT",3,0)
 ;
"RTN","RGMTETOT",4,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTETOT",5,0)
 ;
"RTN","RGMTETOT",6,0)
 ;Variable RGHLMQ cannot be killed in this routine, it is needed for the remote query
"RTN","RGMTETOT",7,0)
 ;
"RTN","RGMTETOT",8,0)
 ;Use this routine to compile totals of a site's exceptions in file #991.1
"RTN","RGMTETOT",9,0)
 S DUMP=0 G START
"RTN","RGMTETOT",10,0)
 ;
"RTN","RGMTETOT",11,0)
DUMP1 ;Use this call to dump all data in ascii format for table
"RTN","RGMTETOT",12,0)
 S DUMP=1 G START
"RTN","RGMTETOT",13,0)
 ;
"RTN","RGMTETOT",14,0)
DUMP2 ;Use this call to dump data in ascii format for table - just for exceptions sites have to deal with
"RTN","RGMTETOT",15,0)
 S DUMP=2
"RTN","RGMTETOT",16,0)
 ;
"RTN","RGMTETOT",17,0)
START ;
"RTN","RGMTETOT",18,0)
 ;do purge of any dups for POTENTIAL MATCH Exceptions
"RTN","RGMTETOT",19,0)
 K TYPEARR,^XTMP("RGMT","HLMQETOT")
"RTN","RGMTETOT",20,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTETOT",21,0)
 D PURGE
"RTN","RGMTETOT",22,0)
 ;create type array from file 991.11
"RTN","RGMTETOT",23,0)
 S TYPE=199 F  S TYPE=$O(^RGHL7(991.11,TYPE)) Q:'TYPE  I TYPE'=218 S TYPEARR(TYPE)=0
"RTN","RGMTETOT",24,0)
 ;
"RTN","RGMTETOT",25,0)
 ;start loop
"RTN","RGMTETOT",26,0)
 S TYPE=199 F  S TYPE=$O(^RGHL7(991.1,"AC",TYPE)) Q:'TYPE  D
"RTN","RGMTETOT",27,0)
 .Q:TYPE=218
"RTN","RGMTETOT",28,0)
 .S IEN1=0 F  S IEN1=$O(^RGHL7(991.1,"AC",TYPE,IEN1)) Q:'IEN1  D
"RTN","RGMTETOT",29,0)
 ..S IEN2=0 F  S IEN2=$O(^RGHL7(991.1,"AC",TYPE,IEN1,IEN2)) Q:'IEN2  D
"RTN","RGMTETOT",30,0)
 ...I '$D(^RGHL7(991.1,IEN1,1,IEN2,0)) Q
"RTN","RGMTETOT",31,0)
 ...S STAT=$P(^RGHL7(991.1,IEN1,1,IEN2,0),"^",5) I STAT<1 S TYPEARR(TYPE)=TYPEARR(TYPE)+1
"RTN","RGMTETOT",32,0)
 ;
"RTN","RGMTETOT",33,0)
PRT ;
"RTN","RGMTETOT",34,0)
 S GRAND=0
"RTN","RGMTETOT",35,0)
 S SITENM=$P($$SITE^VASITE(),"^",2),$P(LN,"-",81)=""
"RTN","RGMTETOT",36,0)
 D NOW^%DTC S RUNDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTETOT",37,0)
 ;
"RTN","RGMTETOT",38,0)
PRT0 I 'DUMP D
"RTN","RGMTETOT",39,0)
 .W !!,"Exception Totals for ",SITENM
"RTN","RGMTETOT",40,0)
 .W !,"Printed ",RUNDT,!,LN
"RTN","RGMTETOT",41,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  I +TYPEARR(TYPE) D
"RTN","RGMTETOT",42,0)
 ..S GRAND=GRAND+TYPEARR(TYPE)
"RTN","RGMTETOT",43,0)
 ..W !!,"TYPE: ",TYPE,?12,$P($T(@TYPE),";;",2),?67,"TOTAL = ",$J(TYPEARR(TYPE),4)
"RTN","RGMTETOT",44,0)
 ..W !,"DESCRIPTION:"
"RTN","RGMTETOT",45,0)
 ..S TXT=0 F  S TXT=$O(^RGHL7(991.11,TYPE,99,TXT)) Q:'TXT  W !,^RGHL7(991.11,TYPE,99,TXT,0)
"RTN","RGMTETOT",46,0)
 .W !!?56,"TOTAL EXCEPTIONS: ",$J(GRAND,5)
"RTN","RGMTETOT",47,0)
 ;
"RTN","RGMTETOT",48,0)
PRT1 I DUMP=1 D
"RTN","RGMTETOT",49,0)
 .W !!,"At this point it is necessary for you to increase the right margin."
"RTN","RGMTETOT",50,0)
 .W !,"At the DEVICE prompt enter=> ;255"
"RTN","RGMTETOT",51,0)
 .W ! D ^%ZIS I POP W !,"DOWNLOAD ABORTED!" Q
"RTN","RGMTETOT",52,0)
 .W !!,"Data string=Site;Run Date;Date CIRN Installed;Exceptions 200-229"
"RTN","RGMTETOT",53,0)
 .S STR=SITENM_";"_RUNDT_";"
"RTN","RGMTETOT",54,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  D
"RTN","RGMTETOT",55,0)
 ..S STR=STR_";"_TYPEARR(TYPE)
"RTN","RGMTETOT",56,0)
 .W !!,STR
"RTN","RGMTETOT",57,0)
 ;
"RTN","RGMTETOT",58,0)
PRT2 I DUMP=2 D
"RTN","RGMTETOT",59,0)
 .S ICN=0,LOCCNT=0 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S LOCCNT=LOCCNT+1
"RTN","RGMTETOT",60,0)
 .S SITEIEN=+$$SITE^VASITE(),STANUM=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTETOT",61,0)
 .I '$D(RGHLMQ) W !!,"Data string:"
"RTN","RGMTETOT",62,0)
 .I '$D(RGHLMQ) W !,"Site;Sta#;;;LocICNs,209,213,214,215,216,217,218,219,223,225,226,227,229"
"RTN","RGMTETOT",63,0)
 .S STR=SITENM_";"_STANUM_";;;"_LOCCNT
"RTN","RGMTETOT",64,0)
 .F TYPE=209,213,214,215,216,217,218,219,226,227,229,233 S STR=STR_";"_TYPEARR(TYPE)
"RTN","RGMTETOT",65,0)
 .I '$D(RGHLMQ) W !!,STR
"RTN","RGMTETOT",66,0)
 .I $D(RGHLMQ) S ^XTMP("RGMT","HLMQETOT",STANUM,1)=STR
"RTN","RGMTETOT",67,0)
 ;
"RTN","RGMTETOT",68,0)
QUIT ;
"RTN","RGMTETOT",69,0)
 K %,CIRNIEN,CNT,DA,DIK,DUMP,DUPCNT,EXCDT,GRAND,ICN,IEN,IEN1,IEN2,LN,LOCCNT,OLDDT,OLDNODE,PTNM
"RTN","RGMTETOT",70,0)
 K RGDFN,RUNDT,SITEIEN,SITENM,STANUM,STAT,STR,TXT,TYPE,XCNT,HOME,DFN,RCNT,VADM
"RTN","RGMTETOT",71,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",72,0)
 Q
"RTN","RGMTETOT",73,0)
 ;
"RTN","RGMTETOT",74,0)
PURGE ;
"RTN","RGMTETOT",75,0)
 I '$D(RGHLMQ) W !!,"...purging duplicate Potential Match Exceptions",!
"RTN","RGMTETOT",76,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",77,0)
 S (RGDFN,CNT,XCNT,DUPCNT)=0,HOME=$$SITE^VASITE()
"RTN","RGMTETOT",78,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGMTETOT",79,0)
 .S IEN=0
"RTN","RGMTETOT",80,0)
 .F  S IEN=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTETOT",81,0)
 ..S IEN2=0
"RTN","RGMTETOT",82,0)
 ..F  S IEN2=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGMTETOT",83,0)
 ...I '$D(^RGHL7(991.1,IEN,0)) Q
"RTN","RGMTETOT",84,0)
 ...S CNT=CNT+1
"RTN","RGMTETOT",85,0)
 ...S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGMTETOT",86,0)
 ...I '$D(^XTMP("RGMT","ETOT",RGDFN)) D  Q
"RTN","RGMTETOT",87,0)
 ....S XCNT=XCNT+1
"RTN","RGMTETOT",88,0)
 ....D SETTMP
"RTN","RGMTETOT",89,0)
 ...I $D(^XTMP("RGMT","ETOT",RGDFN))  D
"RTN","RGMTETOT",90,0)
 ....S OLDNODE=^XTMP("RGMT","ETOT",RGDFN)
"RTN","RGMTETOT",91,0)
 ....S OLDDT=$P(OLDNODE,"^")
"RTN","RGMTETOT",92,0)
 ....I EXCDT>OLDDT D  Q
"RTN","RGMTETOT",93,0)
 .....S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGMTETOT",94,0)
 .....D DELDUP
"RTN","RGMTETOT",95,0)
 .....D SETTMP
"RTN","RGMTETOT",96,0)
 ....I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGMTETOT",97,0)
 .....S DA(1)=IEN,DA=IEN2
"RTN","RGMTETOT",98,0)
 .....D DELDUP
"RTN","RGMTETOT",99,0)
 I '$D(RGHLMQ) W !,DUPCNT," duplicate patient entries for POTENTIAL MATCH exceptions were identified"
"RTN","RGMTETOT",100,0)
 I '$D(RGHLMQ) W !,"and deleted from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGMTETOT",101,0)
 ;
"RTN","RGMTETOT",102,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",103,0)
 S (RCNT,RGDFN)=0
"RTN","RGMTETOT",104,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGMTETOT",105,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGMTETOT",106,0)
 .I $E(ICN,1,3)=$P(HOME,"^",3)!(ICN<0) D
"RTN","RGMTETOT",107,0)
 ..S DFN=RGDFN D DEM^VADPT
"RTN","RGMTETOT",108,0)
 ..I VADM(1)=""!(VADM(2)="") Q
"RTN","RGMTETOT",109,0)
 ..S RCNT=RCNT+1
"RTN","RGMTETOT",110,0)
 ..S ^XTMP("RGMT","ETOT",VADM(1),RGDFN)=$P(VADM(2),"^")_"^"_$P(VADM(3),"^",2)
"RTN","RGMTETOT",111,0)
 ;
"RTN","RGMTETOT",112,0)
 ;count the number of patients who need to be resolved
"RTN","RGMTETOT",113,0)
 S PTNM="",CNT=0
"RTN","RGMTETOT",114,0)
 F  S PTNM=$O(^XTMP("RGMT","ETOT",PTNM)) Q:PTNM=""  D
"RTN","RGMTETOT",115,0)
 .S RGDFN=0
"RTN","RGMTETOT",116,0)
 .F  S RGDFN=$O(^XTMP("RGMT","ETOT",PTNM,RGDFN)) Q:'RGDFN  S CNT=CNT+1
"RTN","RGMTETOT",117,0)
 S TYPEARR(218)=CNT
"RTN","RGMTETOT",118,0)
 Q
"RTN","RGMTETOT",119,0)
 ;
"RTN","RGMTETOT",120,0)
SETTMP ;set TMP global for patient check
"RTN","RGMTETOT",121,0)
 S ^XTMP("RGMT","ETOT",RGDFN)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGMTETOT",122,0)
 Q
"RTN","RGMTETOT",123,0)
 ;
"RTN","RGMTETOT",124,0)
DELDUP ;delete patient dups from file
"RTN","RGMTETOT",125,0)
 S DUPCNT=DUPCNT+1
"RTN","RGMTETOT",126,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGMTETOT",127,0)
 D ^DIK K DIK,DA
"RTN","RGMTETOT",128,0)
 Q
"RTN","RGMTETOT",129,0)
 ;
"RTN","RGMTETOT",130,0)
200 ;;(Missing BHS Segment)
"RTN","RGMTETOT",131,0)
201 ;;(Missing MSH Segment
"RTN","RGMTETOT",132,0)
202 ;;(Missing QAK Segment)
"RTN","RGMTETOT",133,0)
203 ;;(Missing MSA Segment)
"RTN","RGMTETOT",134,0)
204 ;;(Missing RDF Segment)
"RTN","RGMTETOT",135,0)
205 ;;(Missing RDT Segment)
"RTN","RGMTETOT",136,0)
206 ;;(Could Not Create VTQ)
"RTN","RGMTETOT",137,0)
207 ;;(Application Reject Error)
"RTN","RGMTETOT",138,0)
208 ;;(Application Error)
"RTN","RGMTETOT",139,0)
209 ;;(Required field(s) Missing)
"RTN","RGMTETOT",140,0)
210 ;;(Patient DFN Failed)
"RTN","RGMTETOT",141,0)
211 ;;(CMOR Lookup Failed)
"RTN","RGMTETOT",142,0)
212 ;;(TF Update Failed in Pivot file)
"RTN","RGMTETOT",143,0)
213 ;;(SSN Match Failed)
"RTN","RGMTETOT",144,0)
214 ;;(Name Doesn't Match)
"RTN","RGMTETOT",145,0)
215 ;;(Death Entry on MPI not in VISTA)
"RTN","RGMTETOT",146,0)
216 ;;(Death Entry on Vista not in MPI)
"RTN","RGMTETOT",147,0)
217 ;;(Death Entries Mismatch)
"RTN","RGMTETOT",148,0)
218 ;;(Potential Matches Returned)
"RTN","RGMTETOT",149,0)
219 ;;(Missing ICN)
"RTN","RGMTETOT",150,0)
220 ;;(Error Setting Up HL7)
"RTN","RGMTETOT",151,0)
221 ;;(Missing Site/CMOR)
"RTN","RGMTETOT",152,0)
222 ;;(Invalid Event Type)
"RTN","RGMTETOT",153,0)
223 ;;(Missing Excepted Field)
"RTN","RGMTETOT",154,0)
224 ;;(Missing/Unable to get Logical Link)
"RTN","RGMTETOT",155,0)
225 ;;(Have Subscribers)
"RTN","RGMTETOT",156,0)
226 ;;(Not CMOR)
"RTN","RGMTETOT",157,0)
227 ;;(Multiple ICNs)
"RTN","RGMTETOT",158,0)
228 ;;(Patient Does Not Exist)
"RTN","RGMTETOT",159,0)
229 ;;(Duplicate Station Number)
"RTN","RGMTETOT",160,0)
230 ;;(Invalid Sender Of Facility Integration Message)
"RTN","RGMTETOT",161,0)
231 ;;(Treating Facility Not Known To CMOR)
"RTN","RGMTETOT",162,0)
232 ;;(Subscriber Not Known To CMOR)
"RTN","RGMTETOT",163,0)
233 ;;(Cannot Merge Duplicate Pair)
"RTN","RGMTMONT")
0^1^B32270291
"RTN","RGMTMONT",1,0)
RGMTMONT ;BIR/CML,PTD-MPI/PD Monitor HL7 Messaging/Filers and Setups ;07/30/02
"RTN","RGMTMONT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,30**;30 Apr 99
"RTN","RGMTMONT",3,0)
 ;
"RTN","RGMTMONT",4,0)
 ;Reference to OPTION SCHEDULING (#19.2) file supported by IA #3599
"RTN","RGMTMONT",5,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTMONT",6,0)
 ;Reference to $$SEND^VAFHUTL for file DG(43 supported by IA #2624
"RTN","RGMTMONT",7,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTMONT",8,0)
 ;Reference to $$STAT^HLCSLM supported by IA #3574
"RTN","RGMTMONT",9,0)
 ;
"RTN","RGMTMONT",10,0)
EN1 ;Call this routine from the top to do extended checks that include:
"RTN","RGMTMONT",11,0)
 ;- D HLMA1^RGMTUT98
"RTN","RGMTMONT",12,0)
 ;- D EN2^RGMTMONT
"RTN","RGMTMONT",13,0)
 ;- D ^RGMTMONX
"RTN","RGMTMONT",14,0)
 ;
"RTN","RGMTMONT",15,0)
 I $D(RGHLMQ) Q
"RTN","RGMTMONT",16,0)
 ;
"RTN","RGMTMONT",17,0)
 S DEV=0,EN=1 G START
"RTN","RGMTMONT",18,0)
 ;
"RTN","RGMTMONT",19,0)
DEV ;call used by developers to display ^RGMTMONX call
"RTN","RGMTMONT",20,0)
 S DEV=1,EN=2
"RTN","RGMTMONT",21,0)
 ;
"RTN","RGMTMONT",22,0)
START ;
"RTN","RGMTMONT",23,0)
 S CLUP=1
"RTN","RGMTMONT",24,0)
 W @IOF,"Logical Link Monitor:",!,"=====================",!
"RTN","RGMTMONT",25,0)
 D HLMA1^RGMTUT98
"RTN","RGMTMONT",26,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",27,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",28,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",29,0)
 ;
"RTN","RGMTMONT",30,0)
 D EN2
"RTN","RGMTMONT",31,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",32,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",33,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",34,0)
 ;
"RTN","RGMTMONT",35,0)
 I $G(EN)'=1 D ^RGMTMONX
"RTN","RGMTMONT",36,0)
 ;
"RTN","RGMTMONT",37,0)
 K EN,DEV G QUIT
"RTN","RGMTMONT",38,0)
 ;
"RTN","RGMTMONT",39,0)
EN2 ;Monitor Background Job - VAFC BATCH UPDATE
"RTN","RGMTMONT",40,0)
 ;Monitor Background Job - MPIF LOC/MIS ICN RES
"RTN","RGMTMONT",41,0)
 ;Check MAS PARAMETER file, field SEND PIMS HL7 V2.3 MESSAGES
"RTN","RGMTMONT",42,0)
 ;if call is being made from HL7 query, variable RGHLMQ will be defined
"RTN","RGMTMONT",43,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTMONT",44,0)
 K ^XTMP("RGMT","HLMQMONT")
"RTN","RGMTMONT",45,0)
 I '$D(DEV) S DEV=0
"RTN","RGMTMONT",46,0)
 S LOCSITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTMONT",47,0)
 I $D(RGHLMQ) D
"RTN","RGMTMONT",48,0)
 .D NOW^%DTC
"RTN","RGMTMONT",49,0)
 .S ^XTMP("RGMT","HLMQMONT",LOCSITE,"@@ RUNDATE")=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTMONT",50,0)
 I '$D(RGHLMQ) W @IOF,"MPI/PD Process Monitor:",!,"======================="
"RTN","RGMTMONT",51,0)
 S TXTCNT=0
"RTN","RGMTMONT",52,0)
 N BKDA,CUR,MSG,SCHDA,SEND,TIME
"RTN","RGMTMONT",53,0)
CHK1 ;
"RTN","RGMTMONT",54,0)
 S TXT="Checking VAFC BATCH UPDATE background job..." D TXT
"RTN","RGMTMONT",55,0)
 D PIV^RGMTUT98
"RTN","RGMTMONT",56,0)
 S TXTCNT=3
"RTN","RGMTMONT",57,0)
 ;
"RTN","RGMTMONT",58,0)
 S DIC="^DIC(19,",X="VAFC BATCH UPDATE" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",59,0)
 I BKDA<0 S TXT="=> VAFC BATCH UPDATE does not exist in OPTION file." D TXT K BKDA G CHK2
"RTN","RGMTMONT",60,0)
 S TXT="=> VAFC BATCH UPDATE is not currently scheduled to run."
"RTN","RGMTMONT",61,0)
 S DIC="^DIC(19.2,",X="VAFC BATCH UPDATE" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",62,0)
 I SCHDA<0 D TXT K BKDA,TXT,SCHDA G CHK2
"RTN","RGMTMONT",63,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",64,0)
 I TIME="" D TXT K BKDA,TXT,SCHDA,TIME G CHK2
"RTN","RGMTMONT",65,0)
 S TXT="=> VAFC BATCH UPDATE scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",66,0)
 D TXT
"RTN","RGMTMONT",67,0)
 D NOW^%DTC
"RTN","RGMTMONT",68,0)
 S DAY=$E(%,1,7)
"RTN","RGMTMONT",69,0)
 ;
"RTN","RGMTMONT",70,0)
CHK2 ;
"RTN","RGMTMONT",71,0)
 S TXT="" D TXT
"RTN","RGMTMONT",72,0)
 ;
"RTN","RGMTMONT",73,0)
 S ICN=0,CNT=0
"RTN","RGMTMONT",74,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGMTMONT",75,0)
 S TXT="Checking MPIF LOC/MIS ICN RES background job...  (Total Local ICNs = "_CNT_")"
"RTN","RGMTMONT",76,0)
 D TXT
"RTN","RGMTMONT",77,0)
 ;
"RTN","RGMTMONT",78,0)
 S DIC="^DIC(19,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",79,0)
 I BKDA<0 S TXT="=> MPIF LOC/MIS ICN RES does not exist in OPTION file." D TXT K BKDA G CHK2A
"RTN","RGMTMONT",80,0)
 S TXT="=> MPIF LOC/MIS ICN RES is not currently scheduled to run."
"RTN","RGMTMONT",81,0)
 S DIC="^DIC(19.2,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",82,0)
 I SCHDA<0 D TXT K BKDA,SCHDA G CHK2A
"RTN","RGMTMONT",83,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",84,0)
 I TIME="" D TXT K BKDA,SCHDA,TIME G CHK2A
"RTN","RGMTMONT",85,0)
 S TXT="=> MPIF LOC/MIS ICN RES is scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",86,0)
 D TXT
"RTN","RGMTMONT",87,0)
 ;
"RTN","RGMTMONT",88,0)
CHK2A ;check for time local/missing job was last run
"RTN","RGMTMONT",89,0)
 S TIME=$P($G(^RGSITE(991.8,1,0)),"^",4) I TIME'="" D
"RTN","RGMTMONT",90,0)
 .S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGMTMONT",91,0)
 .S TXT="=> MPIF LOC/MIS ICN RES was last run "_TIME_"."
"RTN","RGMTMONT",92,0)
 .D TXT
"RTN","RGMTMONT",93,0)
 ;
"RTN","RGMTMONT",94,0)
CHK3 ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGMTMONT",95,0)
 S TXT="" D TXT
"RTN","RGMTMONT",96,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGMTMONT",97,0)
 S PATAUD=$G(PATAUD("AUDIT")) I PATAUD="" S PATAUD="NOT SET"
"RTN","RGMTMONT",98,0)
 S PATAUD="<<"_PATAUD_">>"
"RTN","RGMTMONT",99,0)
 S TXT="=> Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGMTMONT",100,0)
 D TXT
"RTN","RGMTMONT",101,0)
 K PATAUD
"RTN","RGMTMONT",102,0)
 ;
"RTN","RGMTMONT",103,0)
CHK5 ;
"RTN","RGMTMONT",104,0)
 S TXT="" D TXT
"RTN","RGMTMONT",105,0)
 ;
"RTN","RGMTMONT",106,0)
 S TXT="Checking SEND Parameters for HL7 messaging..."
"RTN","RGMTMONT",107,0)
 D TXT
"RTN","RGMTMONT",108,0)
 ;
"RTN","RGMTMONT",109,0)
 S SEND=$P($$SEND^VAFHUTL,"^",2)
"RTN","RGMTMONT",110,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",111,0)
 S TXT="=> SEND PIMS HL7 V2.3 MESSAGES currently set to << "_CUR_" >>."
"RTN","RGMTMONT",112,0)
 D TXT
"RTN","RGMTMONT",113,0)
 ;
"RTN","RGMTMONT",114,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to "
"RTN","RGMTMONT",115,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGMTMONT",116,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",117,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to << "_CUR_" >>."
"RTN","RGMTMONT",118,0)
 D TXT
"RTN","RGMTMONT",119,0)
 ;
"RTN","RGMTMONT",120,0)
CHK6 ;
"RTN","RGMTMONT",121,0)
 K RGMT
"RTN","RGMTMONT",122,0)
 S LOC=$P($$SITE^VASITE(),"^")
"RTN","RGMTMONT",123,0)
 D LINK^HLUTIL3(LOC,.RGMT)
"RTN","RGMTMONT",124,0)
 S LOCIEN=$O(RGMT(0))
"RTN","RGMTMONT",125,0)
 I 'LOCIEN D  G QUIT
"RTN","RGMTMONT",126,0)
 .S TXT="^DIC(4,""AC"" xref problem.  Check ^DIC(4,""AC"",,"_LOC
"RTN","RGMTMONT",127,0)
 .D TXT
"RTN","RGMTMONT",128,0)
 S LOCLINK=RGMT(LOCIEN)
"RTN","RGMTMONT",129,0)
 ;
"RTN","RGMTMONT",130,0)
 S TXT="" D TXT
"RTN","RGMTMONT",131,0)
 ;
"RTN","RGMTMONT",132,0)
 S TXT="Checking SHUTDOWN LLP? field and TCP/IP SERVICE TYPE for "_LOCLINK_"..."
"RTN","RGMTMONT",133,0)
 D TXT
"RTN","RGMTMONT",134,0)
 ;
"RTN","RGMTMONT",135,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",14)
"RTN","RGMTMONT",136,0)
 S TXT="=> SHUTDOWN LLP? currently set to << "_CUR_" >>."
"RTN","RGMTMONT",137,0)
 D TXT
"RTN","RGMTMONT",138,0)
 ;
"RTN","RGMTMONT",139,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",400.03)
"RTN","RGMTMONT",140,0)
 S TXT="=> TCP/IP SERVICE TYPE currently set to << "_CUR_" >>."
"RTN","RGMTMONT",141,0)
 D TXT
"RTN","RGMTMONT",142,0)
 ;
"RTN","RGMTMONT",143,0)
 ;check MPIVA for LLP TYPE
"RTN","RGMTMONT",144,0)
 S DIC="^HLCS(870,",X="MPIVA" D ^DIC K DIC S MPILL=+Y
"RTN","RGMTMONT",145,0)
 S CUR=$$GET1^DIQ(870,MPILL_",",2)
"RTN","RGMTMONT",146,0)
 S TXT="=> Logical Link MPIVA currently set to << "_CUR_" >>."
"RTN","RGMTMONT",147,0)
 D TXT
"RTN","RGMTMONT",148,0)
 ;
"RTN","RGMTMONT",149,0)
 ;check to see if Link Manager is running
"RTN","RGMTMONT",150,0)
 S LMSTAT=$$STAT^HLCSLM
"RTN","RGMTMONT",151,0)
 S CUR=$S('LMSTAT:"NOT RUNNING",1:"RUNNING")
"RTN","RGMTMONT",152,0)
 S TXT="=> HL LINK MANAGER is currently << "_CUR_" >>."
"RTN","RGMTMONT",153,0)
 D TXT
"RTN","RGMTMONT",154,0)
 ;
"RTN","RGMTMONT",155,0)
 I $D(RGHLMQ) D ^RGMTMONX
"RTN","RGMTMONT",156,0)
 ;
"RTN","RGMTMONT",157,0)
 I $D(CLUP),$D(DIRUT) Q
"RTN","RGMTMONT",158,0)
 ;
"RTN","RGMTMONT",159,0)
QUIT ;
"RTN","RGMTMONT",160,0)
 K %,BKDA,CLUP,CNT,CUR,DAY,DIR,DIRUT,ICN,JJ,LMSTAT,LOC,LOCIEN,LOCLINK
"RTN","RGMTMONT",161,0)
 K LOCSITE,MPILL,MSG,PATAUD,RGHLMQ,RGMT,SCHDA,SEND,SS,TIME,TXT,TXTCNT,X,Y
"RTN","RGMTMONT",162,0)
 Q
"RTN","RGMTMONT",163,0)
 ;
"RTN","RGMTMONT",164,0)
TXT ;
"RTN","RGMTMONT",165,0)
 S TXTCNT=TXTCNT+1
"RTN","RGMTMONT",166,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTMONT",167,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTMONT",168,0)
 Q
"RTN","RGMTMONX")
0^2^B66787940
"RTN","RGMTMONX",1,0)
RGMTMONX ;BIR/CML,PTD-MPI/PD Monitor HL7 Messaging/Filers and Setups (CONT) ;07/30/02
"RTN","RGMTMONX",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,30**;30 Apr 99
"RTN","RGMTMONX",3,0)
 ;
"RTN","RGMTMONX",4,0)
 ;Reference to ^DIC(4,"D", supported by IA #3627
"RTN","RGMTMONX",5,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTMONX",6,0)
 ;Reference to ^DGCN(391.91, supported by IA #2911
"RTN","RGMTMONX",7,0)
 ;
"RTN","RGMTMONX",8,0)
START ;
"RTN","RGMTMONX",9,0)
 I DEV,'$D(RGHLMQ) W @IOF,"Logical Link Monitor:",!,"=====================",!
"RTN","RGMTMONX",10,0)
 ;
"RTN","RGMTMONX",11,0)
 K ^XTMP("RGMT","MONT")
"RTN","RGMTMONX",12,0)
 I '$D(TXTCNT) S TXTCNT=0
"RTN","RGMTMONX",13,0)
 I '$D(LOCSITE) S LOCSITE=$P($$SITE^VASITE(),"^")
"RTN","RGMTMONX",14,0)
 ;
"RTN","RGMTMONX",15,0)
 ;MULTID=# of multiple "D" xrefs in ^DIC(4 for Station #
"RTN","RGMTMONX",16,0)
 ;NOINST=# of VAxxx Links with no INSTITUTION defined
"RTN","RGMTMONX",17,0)
 ;BADINST=# of VAxxx Links that have an incorrect INSTITUTION defined
"RTN","RGMTMONX",18,0)
 ;BADTF=# of patients with invalid Treating Facilities
"RTN","RGMTMONX",19,0)
 ;NONVA=# of non-VAxxx Logical Links with INSTITUTION defined
"RTN","RGMTMONX",20,0)
 ;CNT=# of VAxxx Logical Links processed
"RTN","RGMTMONX",21,0)
 ;
"RTN","RGMTMONX",22,0)
 S (NOINST,BADINST,BADTF,MULTID,NONVA,CNT,DODHOST)=0
"RTN","RGMTMONX",23,0)
 ;
"RTN","RGMTMONX",24,0)
1 ;
"RTN","RGMTMONX",25,0)
 I DEV,'$D(RGHLMQ) W !,"=> Checks 1-3: Checking Link Setups..."
"RTN","RGMTMONX",26,0)
 K LINKARR
"RTN","RGMTMONX",27,0)
 S LINK=""
"RTN","RGMTMONX",28,0)
 F  S LINK=$O(^HLCS(870,"B",LINK)) Q:LINK=""  D
"RTN","RGMTMONX",29,0)
 .I LINK'="MPIVA"&($E(LINK,1,2)'="VA") Q
"RTN","RGMTMONX",30,0)
 .I $E(LINK,1,2)="VA"&($L(LINK," ")>1) Q
"RTN","RGMTMONX",31,0)
 .Q:LINK["-"
"RTN","RGMTMONX",32,0)
 .I $T(@LINK)']"" Q
"RTN","RGMTMONX",33,0)
 .S CNT=CNT+1
"RTN","RGMTMONX",34,0)
 .S VALSTA=$P($P($T(@LINK),";;",2),"^",2)
"RTN","RGMTMONX",35,0)
 .;build array of links with valid station numbers to do check 5
"RTN","RGMTMONX",36,0)
 .S LINKARR(VALSTA)=LINK
"RTN","RGMTMONX",37,0)
2 .;check for multiple "D" xrefs in ^DIC(4 for this station #)
"RTN","RGMTMONX",38,0)
 .S (XCNT,QQ)=0
"RTN","RGMTMONX",39,0)
 .F  S QQ=$O(^DIC(4,"D",VALSTA,QQ)) Q:'QQ  D
"RTN","RGMTMONX",40,0)
 ..S XCNT=XCNT+1
"RTN","RGMTMONX",41,0)
 ..I QQ["." D
"RTN","RGMTMONX",42,0)
 ...S ^XTMP("RGMT","MONT","DECIMEL INST IEN",VALSTA,QQ)=""
"RTN","RGMTMONX",43,0)
 .I XCNT>1 D
"RTN","RGMTMONX",44,0)
 ..S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",45,0)
 ..S MULTID=MULTID+1
"RTN","RGMTMONX",46,0)
 ..S (XCNT,QQ)=0
"RTN","RGMTMONX",47,0)
 ..F  S QQ=$O(^DIC(4,"D",VALSTA,QQ)) Q:'QQ  D
"RTN","RGMTMONX",48,0)
 ...S ^XTMP("RGMT","MONT","MULTI DXREF",VALSTA,QQ)=$$GET1^DIQ(4,QQ_",",.01)_"^"_$$GET1^DIQ(870,LINKIEN_",",.01)_"^"_$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",49,0)
3 .;check for defined INSTITUTION and set (if necessary) AUTOSTART and RESTART for links in file 870
"RTN","RGMTMONX",50,0)
 .S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",51,0)
 .S LINKINST=$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",52,0)
 .I 'LINKINST D  Q
"RTN","RGMTMONX",53,0)
 ..S NOINST=NOINST+1
"RTN","RGMTMONX",54,0)
 ..S ^XTMP("RGMT","MONT","NO INST",LINK)=LINKIEN_"^"_$P($P($T(@LINK),";;",2),"^",1,2)
"RTN","RGMTMONX",55,0)
 ..S TXT="   ** No INSTITUTION defined for "_LINK D TXT
"RTN","RGMTMONX",56,0)
4 .;check for incorrect INSTITUTION
"RTN","RGMTMONX",57,0)
 .S LOCSTA=$P($$NS^XUAF4(LINKINST),"^",2)
"RTN","RGMTMONX",58,0)
 .I LOCSTA'=VALSTA D
"RTN","RGMTMONX",59,0)
 ..S BADINST=BADINST+1
"RTN","RGMTMONX",60,0)
 ..S ^XTMP("RGMT","MONT","BAD INST",LINK)=LOCSTA
"RTN","RGMTMONX",61,0)
 ..S TXT="   ** Bad INSTITUTION of Station #"_LOCSTA_" defined for "_LINK_" - should be Station #"_VALSTA D TXT
"RTN","RGMTMONX",62,0)
 ;
"RTN","RGMTMONX",63,0)
5 ;
"RTN","RGMTMONX",64,0)
 I DEV,'$D(RGHLMQ) W !,"=> Check 4   : Checking for patients with invalid Treating Facilities..."
"RTN","RGMTMONX",65,0)
 S TFIEN=0
"RTN","RGMTMONX",66,0)
 F  S TFIEN=$O(^DGCN(391.91,"C",TFIEN)) Q:'TFIEN  D
"RTN","RGMTMONX",67,0)
 .S TF=$P($$NS^XUAF4(TFIEN),"^",2)
"RTN","RGMTMONX",68,0)
 .I TF="" D  Q
"RTN","RGMTMONX",69,0)
 ..S TFIFN=0 F  S TFIFN=$O(^DGCN(391.91,"C",TFIEN,TFIFN)) Q:'TFIFN  D
"RTN","RGMTMONX",70,0)
 ...S BADTF=BADTF+1
"RTN","RGMTMONX",71,0)
 ...S DFN=$$GET1^DIQ(391.91,TFIFN_",",.01,"I")
"RTN","RGMTMONX",72,0)
 ...I DEV,'$D(RGHLMQ) D
"RTN","RGMTMONX",73,0)
 ....W !?3,"** TF with no station # for ",$P(^DIC(4,TFIEN,0),"^")," for DFN #",DFN," - (TF IEN #",TFIFN,")"
"RTN","RGMTMONX",74,0)
 .I '$D(LINKARR(TF)) D
"RTN","RGMTMONX",75,0)
 ..S IEN=0 F  S IEN=$O(^DGCN(391.91,"C",TFIEN,IEN)) Q:'IEN  D
"RTN","RGMTMONX",76,0)
 ...I TF=200 S DODHOST=DODHOST+1 Q
"RTN","RGMTMONX",77,0)
 ...S DFN=$$GET1^DIQ(391.91,IEN_",",.01,"I")
"RTN","RGMTMONX",78,0)
 ...S BADTF=BADTF+1
"RTN","RGMTMONX",79,0)
 ...S ^XTMP("RGMT","MONT","BAD TF",DFN)=$$GET1^DIQ(4,TFIEN_",",.01)_"^"_IEN
"RTN","RGMTMONX",80,0)
 ...I DEV,'$D(RGHLMQ) W !?3,"** Bad TF of ",$P(^DIC(4,TFIEN,0),"^")," for DFN #",DFN," - (TF IEN #",IEN,")"
"RTN","RGMTMONX",81,0)
 ;
"RTN","RGMTMONX",82,0)
6 ;
"RTN","RGMTMONX",83,0)
 I DEV,'$D(RGHLMQ) W !,"=> Check 5   : Checking for non-VAxxx links with INSTITUTION defined..."
"RTN","RGMTMONX",84,0)
 S LINK=""
"RTN","RGMTMONX",85,0)
 F  S LINK=$O(^HLCS(870,"B",LINK)) Q:LINK=""  I $E(LINK,1,2)'="VA"!($E(LINK,1,4)="VAFC") D
"RTN","RGMTMONX",86,0)
 .Q:LINK="MPIVA"
"RTN","RGMTMONX",87,0)
 .S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",88,0)
 .S LINKINST=$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",89,0)
 .Q:'LINKINST
"RTN","RGMTMONX",90,0)
 .Q:LINKINST'=+$$SITE^VASITE()
"RTN","RGMTMONX",91,0)
 .S NONVA=NONVA+1
"RTN","RGMTMONX",92,0)
 .S ^XTMP("RGMT","MONT","NONVA LINK WITH INSTITUTION",LINK)=""
"RTN","RGMTMONX",93,0)
 .S TXT="   ** Non-VA Link with LOCAL INSTITUTION defined - "_LINK D TXT
"RTN","RGMTMONX",94,0)
 ;
"RTN","RGMTMONX",95,0)
DONE ;
"RTN","RGMTMONX",96,0)
 S TXT="" D TXT
"RTN","RGMTMONX",97,0)
 ;
"RTN","RGMTMONX",98,0)
 S TXT="==============================" D TXT
"RTN","RGMTMONX",99,0)
 S TXT="Check 1: "_MULTID_" VA MPI/PD Links with multiple ""D"" xref in ^DIC(4 for Station #." D TXT
"RTN","RGMTMONX",100,0)
 S TXT="Check 2: "_NOINST_" VA MPI/PD Links without an INSTITUTION defined." D TXT
"RTN","RGMTMONX",101,0)
 S TXT="Check 3: "_BADINST_" VA MPI/PD Links with incorrect INSTITUTION defined."  D TXT
"RTN","RGMTMONX",102,0)
 S TXT="Check 4: "_BADTF_" patients with invalid Treating Facilities. => FHIE Pts: "_DODHOST D TXT
"RTN","RGMTMONX",103,0)
 S TXT="Check 5: "_NONVA_" non-VA MPI/PD Links with an INSTITUTION of local site defined." D TXT
"RTN","RGMTMONX",104,0)
 ;
"RTN","RGMTMONX",105,0)
 K BADINST,BADTF,CNT,DEV,DFN,IEN,LINK,LINKARR,LINKIEN,LINKINST,LOCSITE,LOCSTA,MULTID
"RTN","RGMTMONX",106,0)
 K NOINST,NONVA,QQ,TF,TFIEN,TFIFN,TXT,TXTCNT,VALSTA,XCNT,DODHOST
"RTN","RGMTMONX",107,0)
 Q
"RTN","RGMTMONX",108,0)
 ;
"RTN","RGMTMONX",109,0)
TXT ;
"RTN","RGMTMONX",110,0)
 S TXTCNT=TXTCNT+1
"RTN","RGMTMONX",111,0)
 I DEV,'$D(RGHLMQ) W !,TXT
"RTN","RGMTMONX",112,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTMONX",113,0)
 Q
"RTN","RGMTMONX",114,0)
 ;
"RTN","RGMTMONX",115,0)
LINKS ;
"RTN","RGMTMONX",116,0)
MPIVA ;;MPI^200M
"RTN","RGMTMONX",117,0)
VAALX ;;ALEXANDRIA^502
"RTN","RGMTMONX",118,0)
VAALT ;;ALTOONA^503
"RTN","RGMTMONX",119,0)
VAAMA ;;AMARILLO HCS^504
"RTN","RGMTMONX",120,0)
VAANC ;;ANCHORAGE^463
"RTN","RGMTMONX",121,0)
VAANN ;;ANN ARBOR^506
"RTN","RGMTMONX",122,0)
VAASH ;;ASHEVILLE^637
"RTN","RGMTMONX",123,0)
VAATG ;;ATLANTA^508
"RTN","RGMTMONX",124,0)
VAAUG ;;AUGUSTA^509
"RTN","RGMTMONX",125,0)
VABAC ;;BATTLE CREEK^515
"RTN","RGMTMONX",126,0)
VABAY ;;BAY PINES^516
"RTN","RGMTMONX",127,0)
VABEC ;;BECKLEY^517
"RTN","RGMTMONX",128,0)
VABED ;;BEDFORD^518
"RTN","RGMTMONX",129,0)
VABIL ;;BILOXI^520
"RTN","RGMTMONX",130,0)
VABIR ;;BIRMINGHAM^521
"RTN","RGMTMONX",131,0)
VABHH ;;BLACK HILLS HCS^568
"RTN","RGMTMONX",132,0)
VABOI ;;BOISE^531
"RTN","RGMTMONX",133,0)
VABOS ;;BOSTON HCS^523
"RTN","RGMTMONX",134,0)
VABRX ;;BRONX^526
"RTN","RGMTMONX",135,0)
VABUT ;;BUTLER^529
"RTN","RGMTMONX",136,0)
VACAH ;;CENTRAL ALABAMA HCS^619
"RTN","RGMTMONX",137,0)
VALIT ;;CENTRAL ARKANSAS HCS^598
"RTN","RGMTMONX",138,0)
VAFRE ;;CENTRAL CALIFORNIA HCS^570
"RTN","RGMTMONX",139,0)
VAOMA ;;CENTRAL PLAINS HCS^636
"RTN","RGMTMONX",140,0)
VACTX ;;CENTRAL TEXAS HCS^674
"RTN","RGMTMONX",141,0)
VACHA ;;CHARLESTON^534
"RTN","RGMTMONX",142,0)
VACHY ;;CHEYENNE^442
"RTN","RGMTMONX",143,0)
VACHS ;;CHICAGO HCS^537
"RTN","RGMTMONX",144,0)
VACLL ;;CHILLICOTHE^538
"RTN","RGMTMONX",145,0)
VACIN ;;CINCINNATI^539
"RTN","RGMTMONX",146,0)
VACLA ;;CLARKSBURG^540
"RTN","RGMTMONX",147,0)
VACLE ;;CLEVELAND^541
"RTN","RGMTMONX",148,0)
VACOA ;;COATESVILLE^542
"RTN","RGMTMONX",149,0)
VACMS ;;COLUMBIA^544
"RTN","RGMTMONX",150,0)
VACOS ;;COLUMBUS^757
"RTN","RGMTMONX",151,0)
VACON ;;CONNECTICUT HCS^689
"RTN","RGMTMONX",152,0)
VADAY ;;DAYTON^552
"RTN","RGMTMONX",153,0)
VADEN ;;DENVER^554
"RTN","RGMTMONX",154,0)
VADET ;;DETROIT^553
"RTN","RGMTMONX",155,0)
VADUB ;;DUBLIN^557
"RTN","RGMTMONX",156,0)
VADUR ;;DURHAM^558
"RTN","RGMTMONX",157,0)
VAELP ;;EL PASO^756
"RTN","RGMTMONX",158,0)
VAERI ;;ERIE^562
"RTN","RGMTMONX",159,0)
VAFAR ;;FARGO^437
"RTN","RGMTMONX",160,0)
VAFNC ;;FAYETTEVILLE^565
"RTN","RGMTMONX",161,0)
VAFAV ;;FAYETTEVILLE^564
"RTN","RGMTMONX",162,0)
VAJAC ;;G. V. (SONNY) MONTGOMERY^586
"RTN","RGMTMONX",163,0)
VAGRJ ;;GRAND JUNCTION^575
"RTN","RGMTMONX",164,0)
VAHAM ;;HAMPTON^590
"RTN","RGMTMONX",165,0)
VAHIN ;;HINES^578
"RTN","RGMTMONX",166,0)
VAHON ;;HONOLULU VAMROC^459
"RTN","RGMTMONX",167,0)
VAHOU ;;HOUSTON^580
"RTN","RGMTMONX",168,0)
VAHVH ;;HUDSON VALLEY HCS^620
"RTN","RGMTMONX",169,0)
VAHUN ;;HUNTINGTON^581
"RTN","RGMTMONX",170,0)
VADAN ;;ILLIANA HEALTH CARE SYSTEM^550
"RTN","RGMTMONX",171,0)
VAIND ;;INDIANAPOLIS^583
"RTN","RGMTMONX",172,0)
VAIRO ;;IRON MOUNTAIN^585
"RTN","RGMTMONX",173,0)
VALAS ;;LAS VEGAS^593
"RTN","RGMTMONX",174,0)
VALEB ;;LEBANON^595
"RTN","RGMTMONX",175,0)
VALEX ;;LEXINGTON^596
"RTN","RGMTMONX",176,0)
VALOM ;;LOMA LINDA^605
"RTN","RGMTMONX",177,0)
VALON ;;LONG BEACH HCS^600
"RTN","RGMTMONX",178,0)
VALOU ;;LOUISVILLE^603
"RTN","RGMTMONX",179,0)
VAMAD ;;MADISON^607
"RTN","RGMTMONX",180,0)
VAMAN ;;MANCHESTER^608
"RTN","RGMTMONX",181,0)
VAMPI ;;MANILA^358
"RTN","RGMTMONX",182,0)
VAMWV ;;MARTINSBURG^613
"RTN","RGMTMONX",183,0)
VAMAR ;;MARYLAND HCS^512
"RTN","RGMTMONX",184,0)
VAMEM ;;MEMPHIS^614
"RTN","RGMTMONX",185,0)
VAMIA ;;MIAMI^546
"RTN","RGMTMONX",186,0)
VAMIW ;;MILWAUKEE^695
"RTN","RGMTMONX",187,0)
VAMIN ;;MINNEAPOLIS^618
"RTN","RGMTMONX",188,0)
VAFHM ;;MONTANA HCS^436
"RTN","RGMTMONX",189,0)
VAMOU ;;MOUNTAIN HOME^621
"RTN","RGMTMONX",190,0)
VAMUS ;;MUSKOGEE^623
"RTN","RGMTMONX",191,0)
VAGAI ;;N. FLORIDA/S. GEORGIA HCS^573
"RTN","RGMTMONX",192,0)
VANJH ;;NEW JERSEY HCS^561
"RTN","RGMTMONX",193,0)
VAALB ;;NEW MEXICO HCS^501
"RTN","RGMTMONX",194,0)
VANOL ;;NEW ORLEANS^629
"RTN","RGMTMONX",195,0)
VANYN ;;NEW YORK HARBOR HCS^630
"RTN","RGMTMONX",196,0)
VANCH ;;NORTH CHICAGO^556
"RTN","RGMTMONX",197,0)
VANTH ;;NORTH TEXAS HCS^549
"RTN","RGMTMONX",198,0)
VANHM ;;NORTHAMPTON^631
"RTN","RGMTMONX",199,0)
VAPRE ;;NORTHERN ARIZONA HCS^649
"RTN","RGMTMONX",200,0)
VAMAC ;;NORTHERN CALIFORNIA HCS^612
"RTN","RGMTMONX",201,0)
VANIN ;;NORTHERN INDIANA HCS^610
"RTN","RGMTMONX",202,0)
VANOP ;;NORTHPORT^632
"RTN","RGMTMONX",203,0)
VAOKL ;;OKLAHOMA CITY^635
"RTN","RGMTMONX",204,0)
VAPAL ;;PALO ALTO HCS^640
"RTN","RGMTMONX",205,0)
VAPHI ;;PHILADELPHIA^642
"RTN","RGMTMONX",206,0)
VAPHO ;;PHOENIX^644
"RTN","RGMTMONX",207,0)
VAPTH ;;PITTSBURGH HCS^646
"RTN","RGMTMONX",208,0)
VAPOR ;;PORTLAND^648
"RTN","RGMTMONX",209,0)
VAPRO ;;PROVIDENCE^650
"RTN","RGMTMONX",210,0)
VAPUG ;;PUGET SOUND HCS^663
"RTN","RGMTMONX",211,0)
VARIC ;;RICHMOND^652
"RTN","RGMTMONX",212,0)
VAROS ;;ROSEBURG^653
"RTN","RGMTMONX",213,0)
VASAG ;;SAGINAW^655
"RTN","RGMTMONX",214,0)
VASAM ;;SALEM^658
"RTN","RGMTMONX",215,0)
VASBY ;;SALISBURY^659
"RTN","RGMTMONX",216,0)
VASLC ;;SALT LAKE CITY HCS^660
"RTN","RGMTMONX",217,0)
VASDC ;;SAN DIEGO HCS^664
"RTN","RGMTMONX",218,0)
VASFC ;;SAN FRANCISCO^662
"RTN","RGMTMONX",219,0)
VASAJ ;;SAN JUAN^672
"RTN","RGMTMONX",220,0)
VASHE ;;SHERIDAN^666
"RTN","RGMTMONX",221,0)
VASHR ;;SHREVEPORT^667
"RTN","RGMTMONX",222,0)
VAREN ;;SIERRA NEVADA HCS^654
"RTN","RGMTMONX",223,0)
VASUX ;;SIOUX FALLS^438
"RTN","RGMTMONX",224,0)
VASTX ;;SOUTH TEXAS HCS^671
"RTN","RGMTMONX",225,0)
VATUC ;;SOUTHERN ARIZONA HCS^678
"RTN","RGMTMONX",226,0)
VASPO ;;SPOKANE^668
"RTN","RGMTMONX",227,0)
VASTC ;;ST. CLOUD^656
"RTN","RGMTMONX",228,0)
VATAM ;;TAMPA^673
"RTN","RGMTMONX",229,0)
VANAS ;;TENNESSEE VALLEY HCS^626
"RTN","RGMTMONX",230,0)
VATOG ;;TOGUS^402
"RTN","RGMTMONX",231,0)
VATOM ;;TOMAH^676
"RTN","RGMTMONX",232,0)
VATUA ;;TUSCALOOSA^679
"RTN","RGMTMONX",233,0)
VAWNY ;;UPSTATE NEW YORK HCS^528
"RTN","RGMTMONX",234,0)
VASTL ;;VA HEARTLAND - EAST, VISN 15^657
"RTN","RGMTMONX",235,0)
VAKAN ;;VA HEARTLAND - WEST, VISN 15^589
"RTN","RGMTMONX",236,0)
VAWWW ;;WALLA WALLA^687
"RTN","RGMTMONX",237,0)
VAWAS ;;WASHINGTON^688
"RTN","RGMTMONX",238,0)
VAWLA ;;WEST LA VAMC^691
"RTN","RGMTMONX",239,0)
VAWPB ;;WEST PALM BEACH^548
"RTN","RGMTMONX",240,0)
VABIG ;;WEST TEXAS HCS^519
"RTN","RGMTMONX",241,0)
VAWCO ;;WHITE CITY^692
"RTN","RGMTMONX",242,0)
VAWRJ ;;WHITE RIVER JCT^405
"RTN","RGMTMONX",243,0)
VAWBP ;;WILKES BARRE^693
"RTN","RGMTMONX",244,0)
VAWIM ;;WILMINGTON^460
"RTN","RGMTMONX",245,0)
VAFHIE ;;AUSTIN^200
"RTN","RGMTMONX",246,0)
 ;;***
"VER")
8.0^22.0
**END**
**END**
