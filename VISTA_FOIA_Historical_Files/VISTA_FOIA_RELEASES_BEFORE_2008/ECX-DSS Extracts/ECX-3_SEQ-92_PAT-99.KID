Released ECX*3*99 SEQ #92
Extracted from mail message
**KIDS**:ECX*3.0*99^

**INSTALL NAME**
ECX*3.0*99
"BLD",7071,0)
ECX*3.0*99^DSS EXTRACTS^0^3070501^y
"BLD",7071,1,0)
^^1^1^3061214^
"BLD",7071,1,1,0)
This patch provides a fix to the Surgery Extract routine.
"BLD",7071,4,0)
^9.64PA^^
"BLD",7071,6)
2^
"BLD",7071,6.3)
2
"BLD",7071,"KRN",0)
^9.67PA^8989.52^19
"BLD",7071,"KRN",.4,0)
.4
"BLD",7071,"KRN",.401,0)
.401
"BLD",7071,"KRN",.402,0)
.402
"BLD",7071,"KRN",.403,0)
.403
"BLD",7071,"KRN",.5,0)
.5
"BLD",7071,"KRN",.84,0)
.84
"BLD",7071,"KRN",3.6,0)
3.6
"BLD",7071,"KRN",3.8,0)
3.8
"BLD",7071,"KRN",9.2,0)
9.2
"BLD",7071,"KRN",9.8,0)
9.8
"BLD",7071,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7071,"KRN",9.8,"NM",1,0)
ECXSURG^^0^B59263741
"BLD",7071,"KRN",9.8,"NM","B","ECXSURG",1)

"BLD",7071,"KRN",19,0)
19
"BLD",7071,"KRN",19.1,0)
19.1
"BLD",7071,"KRN",101,0)
101
"BLD",7071,"KRN",409.61,0)
409.61
"BLD",7071,"KRN",771,0)
771
"BLD",7071,"KRN",870,0)
870
"BLD",7071,"KRN",8989.51,0)
8989.51
"BLD",7071,"KRN",8989.52,0)
8989.52
"BLD",7071,"KRN",8994,0)
8994
"BLD",7071,"KRN","B",.4,.4)

"BLD",7071,"KRN","B",.401,.401)

"BLD",7071,"KRN","B",.402,.402)

"BLD",7071,"KRN","B",.403,.403)

"BLD",7071,"KRN","B",.5,.5)

"BLD",7071,"KRN","B",.84,.84)

"BLD",7071,"KRN","B",3.6,3.6)

"BLD",7071,"KRN","B",3.8,3.8)

"BLD",7071,"KRN","B",9.2,9.2)

"BLD",7071,"KRN","B",9.8,9.8)

"BLD",7071,"KRN","B",19,19)

"BLD",7071,"KRN","B",19.1,19.1)

"BLD",7071,"KRN","B",101,101)

"BLD",7071,"KRN","B",409.61,409.61)

"BLD",7071,"KRN","B",771,771)

"BLD",7071,"KRN","B",870,870)

"BLD",7071,"KRN","B",8989.51,8989.51)

"BLD",7071,"KRN","B",8989.52,8989.52)

"BLD",7071,"KRN","B",8994,8994)

"BLD",7071,"QUES",0)
^9.62^^
"BLD",7071,"REQB",0)
^9.611^2^2
"BLD",7071,"REQB",1,0)
SR*3.0*142^2
"BLD",7071,"REQB",2,0)
ECX*3.0*92^2
"BLD",7071,"REQB","B","ECX*3.0*92",2)

"BLD",7071,"REQB","B","SR*3.0*142",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
99^3070501^123456804
"PKG",535,22,1,"PAH",1,1,0)
^^1^1^3070501
"PKG",535,22,1,"PAH",1,1,1,0)
This patch provides a fix to the Surgery Extract routine.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXSURG")
0^1^B59263741^B58013169
"RTN","ECXSURG",1,0)
ECXSURG ;ALB/JA,BIR/DMA,PTD-Surgery Extract for DSS ; 11/2/06 9:00am
"RTN","ECXSURG",2,0)
 ;;3.0;DSS EXTRACTS;**1,11,8,13,25,24,33,39,41,42,46,50,71,84,92,99**;Dec 22, 1997;Build 2
"RTN","ECXSURG",3,0)
BEG ;entry point from option
"RTN","ECXSURG",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSURG",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSURG",6,0)
 Q
"RTN","ECXSURG",7,0)
 ;
"RTN","ECXSURG",8,0)
START ;
"RTN","ECXSURG",9,0)
 S QFLG=0,ECED=ECED+.3,ECD=ECSD1
"RTN","ECXSURG",10,0)
 F  S ECD=$O(^SRF("AC",ECD)),ECD0=0 Q:('ECD)!(ECD>ECED)!(QFLG)  D
"RTN","ECXSURG",11,0)
 .F  S ECD0=$O(^SRF("AC",ECD,ECD0)) Q:'ECD0  D
"RTN","ECXSURG",12,0)
 ..I $D(^SRF(ECD0,0)) S EC=^SRF(ECD0,0),ECXDFN=+$P(EC,U),ECXVISIT=$P(EC,U,15) D STUFF Q:QFLG
"RTN","ECXSURG",13,0)
 Q
"RTN","ECXSURG",14,0)
 ;
"RTN","ECXSURG",15,0)
STUFF ;gather data
"RTN","ECXSURG",16,0)
 N J,X,Y,PP,DATA1,DATA2,DATAOP,ARR,ERR,SUB,MOD,ECXNONL,ECXSTOP,TIMEDIF
"RTN","ECXSURG",17,0)
 N ECPRO,ECXORCT,ECXPTHA,ECXNPRFI,ECXPA,ECXPAPC,ECSRPC,ECATPC,ECSAPC
"RTN","ECXSURG",18,0)
 S ECXDATE=ECD,ECXERR=0,ECXQ=""
"RTN","ECXSURG",19,0)
 Q:'$$PATDEM^ECXUTL2(ECXDFN,ECXDATE,"1;2;3;5;")
"RTN","ECXSURG",20,0)
 I ECXADMDT="" S ECXADD=ECXADMDT
"RTN","ECXSURG",21,0)
 I ECXADMDT'="" S ECXADD=$$ECXDATE^ECXUTL(ECXADMDT,ECXYM)
"RTN","ECXSURG",22,0)
 S EC0=^SRF(ECD0,0)
"RTN","ECXSURG",23,0)
 S DATA1=$S($D(^SRF(ECD0,.1)):^(.1),1:"")
"RTN","ECXSURG",24,0)
 S DATA2=$S($D(^SRF(ECD0,.2)):^(.2),1:"")
"RTN","ECXSURG",25,0)
 ;S DATAOP=$S($D(^SRF(ECD0,"OP")):^("OP"),1:"")
"RTN","ECXSURG",26,0)
 S DATAOP=$S($D(^SRO(136,ECD0,0)):^(0),1:"")
"RTN","ECXSURG",27,0)
 S ECNO=$G(^SRF(ECD0,"NON"))
"RTN","ECXSURG",28,0)
 ;get data
"RTN","ECXSURG",29,0)
 S ECSR=$P(DATA1,U,4),(ECATNPI,ECSANPI,ECSRNPI)="",ECAT=$P(DATA1,U,13)
"RTN","ECXSURG",30,0)
 ;-Time patient in OR room (Nurse Time)
"RTN","ECXSURG",31,0)
 S ECXTM=$$ECXTIME^ECXUTL($P(DATA2,U,10))
"RTN","ECXSURG",32,0)
 S ECXDIV=$S($D(^SRF(ECD0,8)):^(8),1:ECINST)
"RTN","ECXSURG",33,0)
 N ECXPDIV S ECXPDIV=$$RADDIV^ECXDEPT(ECXDIV)  ;Production Division
"RTN","ECXSURG",34,0)
 S ECSA=$P($G(^SRF(ECD0,.3)),U,4),ECO=$P(EC0,U,2)
"RTN","ECXSURG",35,0)
 ;get principle anesthetist and person class DBIA #103
"RTN","ECXSURG",36,0)
 S ECXPA=$P($G(^SRF(ECD0,.3)),U,1)
"RTN","ECXSURG",37,0)
 S ECXPAPC=$$PRVCLASS^ECXUTL(ECXPA,ECXDATE)
"RTN","ECXSURG",38,0)
 S ECORTY=$P($G(^SRS(+ECO,2)),U),ECO=$P($G(^SRS(+ECO,0)),U)
"RTN","ECXSURG",39,0)
 S ECSS=$P($G(^SRO(137.45,+$P(EC0,U,4),0)),U,2)
"RTN","ECXSURG",40,0)
 S ECSS=$$RJ^XLFSTR($P($G(^DIC(45.3,+ECSS,0)),U),3,0)
"RTN","ECXSURG",41,0)
 S:ECSS="000" ECSS="999"
"RTN","ECXSURG",42,0)
 ;get classification information
"RTN","ECXSURG",43,0)
 S (ECXAO,ECXHNC)="" I ECXVISIT'="" D
"RTN","ECXSURG",44,0)
 .D VISIT^ECXSCX1(ECXDFN,ECXVISIT,.ECXVIST,.ECXERR) I ECXERR K ECXERR
"RTN","ECXSURG",45,0)
 .S ECXAO=$G(ECXVIST("AO")),ECXHNC=$G(ECXVIST("HNC"))
"RTN","ECXSURG",46,0)
 ; - Head and Neck Cancer Indicator
"RTN","ECXSURG",47,0)
 S ECXHNCI=$$HNCI^ECXUTL4(ECXDFN)
"RTN","ECXSURG",48,0)
 ;look for non-OR
"RTN","ECXSURG",49,0)
 S (ECNT,ECNL,ECXDSSD,ECXNONL,ECXSTOP)=""
"RTN","ECXSURG",50,0)
 I $P(ECNO,U)="Y" D
"RTN","ECXSURG",51,0)
 .S ECSR=$P(ECNO,U,6),ECAT=$P(ECNO,U,7)
"RTN","ECXSURG",52,0)
 .S ECXTM=$$ECXTIME^ECXUTL($P(ECNO,U,4))
"RTN","ECXSURG",53,0)
 .S A1=$P(ECNO,U,5),A2=$P(ECNO,U,4),TIME="##" D:(A1&A2) TIME S ECNT=TIME
"RTN","ECXSURG",54,0)
 .S (ECXNONL,ECNL)=+$P(ECNO,U,2),ECNL=$P($G(^ECX(728.44,ECNL,0)),U,9)
"RTN","ECXSURG",55,0)
 .S:ECNL="" ECNL="UNKNOWN"
"RTN","ECXSURG",56,0)
 .;
"RTN","ECXSURG",57,0)
 .;- Get DSS Stop Code to use in encounter number
"RTN","ECXSURG",58,0)
 .S ECXSTOP=$P($G(^ECX(728.44,ECXNONL,0)),U,4)
"RTN","ECXSURG",59,0)
 ;
"RTN","ECXSURG",60,0)
 ;- If surgery cancelled/aborted quit and go to next record
"RTN","ECXSURG",61,0)
 S ECCAN=$P($G(^SRF(ECD0,30)),U)
"RTN","ECXSURG",62,0)
 I +ECCAN S ECCAN=$$CANC^ECXUTL4(ECNL,$P(DATA2,U,10))
"RTN","ECXSURG",63,0)
 ;on hold for ECXDSSD and ECXDSSP I $P($G(^SRF(ECD0,30)),U) Q
"RTN","ECXSURG",64,0)
 ;get service of attending surgeon
"RTN","ECXSURG",65,0)
 S ECATSV=$P($G(^DIC(49,+$G(^VA(200,+ECAT,5)),730)),U)
"RTN","ECXSURG",66,0)
 ;
"RTN","ECXSURG",67,0)
 ;get surgeon, attending and anesthesia super person classes
"RTN","ECXSURG",68,0)
 S ECSRPC=$$PRVCLASS^ECXUTL(ECSR,ECXDATE)
"RTN","ECXSURG",69,0)
 S ECATPC=$$PRVCLASS^ECXUTL(ECAT,ECXDATE)
"RTN","ECXSURG",70,0)
 S ECSAPC=$$PRVCLASS^ECXUTL(ECSA,ECXDATE)
"RTN","ECXSURG",71,0)
 ;
"RTN","ECXSURG",72,0)
 ;add leading 2s for pointer to 200
"RTN","ECXSURG",73,0)
 S:ECAT ECAT="2"_ECAT S:ECSR ECSR="2"_ECSR S:ECSA ECSA="2"_ECSA
"RTN","ECXSURG",74,0)
 ;add leading 2 to principle anesthetist IEN
"RTN","ECXSURG",75,0)
 S:ECXPA ECXPA="2"_ECXPA
"RTN","ECXSURG",76,0)
 ;anesthesia technique
"RTN","ECXSURG",77,0)
 S ECANE="",PP=""
"RTN","ECXSURG",78,0)
 I $D(^SRF(ECD0,6,0)) S ECXJ=0 D
"RTN","ECXSURG",79,0)
 .F  S ECXJ=$O(^SRF(ECD0,6,ECXJ)) Q:('ECXJ)!(ECANE]"")  D
"RTN","ECXSURG",80,0)
 ..S PP=$P($G(^(ECXJ,0)),U,3) S:PP="Y" ECANE=$P(^(0),U,1)
"RTN","ECXSURG",81,0)
 .I ECANE="" S ECXJ=$O(^SRF(ECD0,6,0)) I ECXJ S ECANE=$P(^SRF(ECD0,6,ECXJ,0),U,1)
"RTN","ECXSURG",82,0)
 ;get primary procedure
"RTN","ECXSURG",83,0)
 ;ecode0=p^cpt code^^patient time^operation time^anesthesia time
"RTN","ECXSURG",84,0)
 S ECPT=+$P(DATAOP,U,2),ECXCMOD=""
"RTN","ECXSURG",85,0)
 K ARR,ERR D FIELD^DID(130,28,,"LABEL","ARR","ERR") I $D(ARR("LABEL")) D
"RTN","ECXSURG",86,0)
 .K ARR,ERR D FIELD^DID(130,28,,"GLOBAL SUBSCRIPT LOCATION","ARR","ERR")
"RTN","ECXSURG",87,0)
 .Q:$D(ERR("DIERR"))
"RTN","ECXSURG",88,0)
 .S SUB=$P(ARR("GLOBAL SUBSCRIPT LOCATION"),";"),MOD=0
"RTN","ECXSURG",89,0)
 .F  S MOD=$O(^SRF(ECD0,SUB,MOD)) Q:MOD'>0  D
"RTN","ECXSURG",90,0)
 ..S ECXCMOD=ECXCMOD_$P(^(MOD,0),U)_";"
"RTN","ECXSURG",91,0)
 S ECXCPT=$$CPT^ECXUTL3(ECPT,ECXCMOD)
"RTN","ECXSURG",92,0)
 S ECODE0="P"_U_U  ;ECPT_U
"RTN","ECXSURG",93,0)
 F J="10,12","2,3","1,4" D
"RTN","ECXSURG",94,0)
 .N ECNTIME,ECSTIME,ECATIME
"RTN","ECXSURG",95,0)
 .S A2=$P(DATA2,U,$P(J,",")),A1=$P(DATA2,U,$P(J,",",2)),TIME="##"
"RTN","ECXSURG",96,0)
 .I (A1&A2)&(+J=10) D TIME  S ECNTIME=TIME
"RTN","ECXSURG",97,0)
 .I (A1&A2)&(+J=1) D TIME  S ECATIME=TIME
"RTN","ECXSURG",98,0)
 .I (A1&A2)&(+J=2) D
"RTN","ECXSURG",99,0)
 ..;
"RTN","ECXSURG",100,0)
 ..;-Operation Time (Surgeon Time)
"RTN","ECXSURG",101,0)
 ..;-Get time diff (in secs) & set to .5 if < 7.5 minutes (rounds to 1)
"RTN","ECXSURG",102,0)
 ..S TIMEDIF=$$FMDIFF^XLFDT(A1,A2,2)/900
"RTN","ECXSURG",103,0)
 ..S TIMEDIF=$S(TIMEDIF>0&(TIMEDIF<.5):.5,1:TIMEDIF)
"RTN","ECXSURG",104,0)
 ..S TIME=$TR($J(TIMEDIF,4,0)," ")
"RTN","ECXSURG",105,0)
 ..S:TIME<0 TIME="###"
"RTN","ECXSURG",106,0)
 ..S:TIME ECSTIME=TIME
"RTN","ECXSURG",107,0)
 .S ECODE0=ECODE0_U_TIME K TIME
"RTN","ECXSURG",108,0)
 ; -Recovery Room Time
"RTN","ECXSURG",109,0)
 S ECRR=""
"RTN","ECXSURG",110,0)
 I $D(^SRF(ECD0,1.1)) D
"RTN","ECXSURG",111,0)
 .S A1=$P(^(1.1),U,8),A2=$P(^(1.1),U,7),TIME="##" D:(A1&A2) TIME
"RTN","ECXSURG",112,0)
 .S ECRR=TIME K TIME
"RTN","ECXSURG",113,0)
 I ECNL]"" S $P(ECODE0,U,5)=ECNT
"RTN","ECXSURG",114,0)
 ;
"RTN","ECXSURG",115,0)
 ; -OR Clean Time in 15 min increments DBIA #103
"RTN","ECXSURG",116,0)
 S ECXORCT=($$FMDIFF^XLFDT($P($G(DATA2),U,14),$P($G(DATA2),U,13),2)/60)/15
"RTN","ECXSURG",117,0)
 ; -If no OR clean time recorded set it to 2
"RTN","ECXSURG",118,0)
 I ECXORCT'>0 S ECXORCT=2
"RTN","ECXSURG",119,0)
 ;
"RTN","ECXSURG",120,0)
 ; -PT in hold area time in 15 min increments DBIA #103
"RTN","ECXSURG",121,0)
 I $P($G(DATA2),U,10),$P($G(DATA2),U,15) D
"RTN","ECXSURG",122,0)
 .S ECXPTHA=($$FMDIFF^XLFDT($P($G(DATA2),U,10),$P($G(DATA2),U,15),2)/60)/15
"RTN","ECXSURG",123,0)
 .S CON=$P($G(^SRF(ECD0,"CON")),U)
"RTN","ECXSURG",124,0)
 .I CON S ECXPTHA=ECXPTHA/2
"RTN","ECXSURG",125,0)
 .S ECXPTHA=$TR($J(ECXPTHA,3,0)," ")
"RTN","ECXSURG",126,0)
 ; -If hold time is =<0 set it to ""
"RTN","ECXSURG",127,0)
 S:$G(ECXPTHA)'>0 ECXPTHA=""
"RTN","ECXSURG",128,0)
 ;
"RTN","ECXSURG",129,0)
 ;- Observation Patient Indicator (yes/no)
"RTN","ECXSURG",130,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECXA,ECXTS,ECNL)
"RTN","ECXSURG",131,0)
 ;
"RTN","ECXSURG",132,0)
 ;- set national patient record flag if exist
"RTN","ECXSURG",133,0)
 D NPRF^ECXUTL5
"RTN","ECXSURG",134,0)
 ;
"RTN","ECXSURG",135,0)
 ;- If no encounter number don't file record
"RTN","ECXSURG",136,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECXA,ECXSSN,ECXADMDT,ECXDATE,ECXTS,ECXOBS,ECHEAD,ECXSTOP,ECSS) Q:ECXENC=""
"RTN","ECXSURG",137,0)
 ;
"RTN","ECXSURG",138,0)
 D FILE
"RTN","ECXSURG",139,0)
 ;get secondary procedures
"RTN","ECXSURG",140,0)
 ;ecode0=s^cpt code
"RTN","ECXSURG",141,0)
 S ECXJ=0
"RTN","ECXSURG",142,0)
 ;F  S ECXJ=$O(^SRF(ECD0,13,ECXJ)) Q:'ECXJ  I $D(^(ECXJ,0)),$D(^(2)),$P(^(2),U)]"" D
"RTN","ECXSURG",143,0)
 F  S ECXJ=$O(^SRO(136,ECD0,3,ECXJ)) Q:'ECXJ  I $D(^(ECXJ,0)),$D(^(0)),$P(^(0),"^")]"" D
"RTN","ECXSURG",144,0)
 .;S ECPT=$P(^SRF(ECD0,13,ECXJ,2),U),ECXCMOD=""
"RTN","ECXSURG",145,0)
 . S ECPT=$P(^SRO(136,ECD0,3,ECXJ,0),"^"),ECXCMOD=""
"RTN","ECXSURG",146,0)
 .K ARR,ERR
"RTN","ECXSURG",147,0)
 .D FIELD^DID(130.16,4,,"LABEL","ARR","ERR") I $D(ARR("LABEL")) D
"RTN","ECXSURG",148,0)
 ..K ARR,ERR
"RTN","ECXSURG",149,0)
 ..D FIELD^DID(130.16,4,,"GLOBAL SUBSCRIPT LOCATION","ARR","ERR")
"RTN","ECXSURG",150,0)
 ..Q:$D(ERR("DIERR"))
"RTN","ECXSURG",151,0)
 ..S SUB=$P(ARR("GLOBAL SUBSCRIPT LOCATION"),";"),MOD=0
"RTN","ECXSURG",152,0)
 ..F  S MOD=$O(^SRF(ECD0,13,ECXJ,SUB,MOD)) Q:MOD'>0  S ECXCMOD=ECXCMOD_$P(^(MOD,0),U)_";"
"RTN","ECXSURG",153,0)
 .S ECXCPT=$$CPT^ECXUTL3(ECPT,ECXCMOD)
"RTN","ECXSURG",154,0)
 .S ECODE0="S"_U   ;_ECPT
"RTN","ECXSURG",155,0)
 .D FILE
"RTN","ECXSURG",156,0)
 ;get prostheses
"RTN","ECXSURG",157,0)
 ;ecode0=i^^^^^^prosthesis^old qty field (null)
"RTN","ECXSURG",158,0)
 S ECXJ=0
"RTN","ECXSURG",159,0)
 F  S ECXJ=$O(^SRF(ECD0,1,ECXJ)) Q:'ECXJ  I $D(^(ECXJ,0)) D
"RTN","ECXSURG",160,0)
 .S ECXP=+^SRF(ECD0,1,ECXJ,0),ECXQ=$P($G(^(1)),U,2) S:'ECXQ ECXQ=1
"RTN","ECXSURG",161,0)
 .S ECODE0="I"_U_U_U_U_U_U_ECXP_U_U
"RTN","ECXSURG",162,0)
 .D FILE
"RTN","ECXSURG",163,0)
 Q
"RTN","ECXSURG",164,0)
 ;
"RTN","ECXSURG",165,0)
FILE ;file record
"RTN","ECXSURG",166,0)
 ;node0
"RTN","ECXSURG",167,0)
 ;division^dfn^ssn^name^in/out (ECXA)^day^case #^
"RTN","ECXSURG",168,0)
 ;surg specialty^or room #^
"RTN","ECXSURG",169,0)
 ;surgeon^attending^anesthesia supervisor^anesthesia technique^
"RTN","ECXSURG",170,0)
 ;primary/secondary/prostheses^cpt^^pt time^op time^anes time^
"RTN","ECXSURG",171,0)
 ;prostheses^qty^^
"RTN","ECXSURG",172,0)
 ;movement number^treating specialty^cancel/abort (ECCAN)^time^or type^
"RTN","ECXSURG",173,0)
 ;attending's service^non-or dss id^recovery room time^^
"RTN","ECXSURG",174,0)
 ;primary care team^primary care provider^admission date
"RTN","ECXSURG",175,0)
 ;node1
"RTN","ECXSURG",176,0)
 ;mpi^dss dept ECXDSSD^surgeon npi^attending npi^anes supervisor npi^
"RTN","ECXSURG",177,0)
 ;pc provider npi^pc prov person class^
"RTN","ECXSURG",178,0)
 ;assoc pc provider^assoc pc prov person class^assoc pc prov npi^
"RTN","ECXSURG",179,0)
 ;cpt&modifiers ECXCPT^dom ECXDOM^enrollment category ECXCAT^
"RTN","ECXSURG",180,0)
 ;enrollment status ECXSTAT^enrollment priority ECXPRIOR^
"RTN","ECXSURG",181,0)
 ;period of service ECXPOS^purple heart indicator ECXPHI^
"RTN","ECXSURG",182,0)
 ;observ pat ind ECXOBS^encounter num ECXENC^ao loc ECXAOL^
"RTN","ECXSURG",183,0)
 ;production division ECXPDIV^head & neck canc ind ECXHNCI^
"RTN","ECXSURG",184,0)
 ;ethnicity ECXETH^race1 ECXRC1^new quantity ECXQ^
"RTN","ECXSURG",185,0)
 ;^user enrollee ECXUESTA^patient type ECXPTYPE^combat vet elig
"RTN","ECXSURG",186,0)
 ;ECXCVE^combat vet elig end date ECXCVEDT^enc cv eligible ECXCVENC
"RTN","ECXSURG",187,0)
 ;or clean time ECXORCT^time pt in hold area ECXPTHA^national patient
"RTN","ECXSURG",188,0)
 ;record flag ECXNPRFI^princ anesthetist ECXPA^surgeon per class ECSRPC
"RTN","ECXSURG",189,0)
 ;node2
"RTN","ECXSURG",190,0)
 ;atten surgeon per class ECATPC^anesthesia super person class ECSAPC^
"RTN","ECXSURG",191,0)
 ;princ anesthetist PC ECXPAPC^emergency response indicator(FEMA) ECXERI^
"RTN","ECXSURG",192,0)
 ;agent orange indic ECXAO^head/neck cancer ECXHNC
"RTN","ECXSURG",193,0)
 ;
"RTN","ECXSURG",194,0)
 N DA,DIK,STR
"RTN","ECXSURG",195,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSURG",196,0)
 S ECODE=EC7_U_EC23_U_ECXDIV_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXSURG",197,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U_ECD0_U_ECSS_U_ECO_U
"RTN","ECXSURG",198,0)
 S ECODE=ECODE_ECSR_U_ECAT_U_ECSA_U_ECANE_U_ECODE0_U
"RTN","ECXSURG",199,0)
 S STR=ECXMN_U_ECXTS_U_$S(ECCAN'="":ECCAN,1:"")_U_ECXTM_U_ECORTY_U
"RTN","ECXSURG",200,0)
 S STR=STR_ECATSV_U_ECNL_U_ECRR_U_U_ECPTTM_U_ECPTPR_U_ECXADD_U
"RTN","ECXSURG",201,0)
 S $P(ECODE,U,26,38)=STR
"RTN","ECXSURG",202,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECSRNPI_U_ECATNPI_U_ECSANPI_U_ECPTNPI_U
"RTN","ECXSURG",203,0)
 S ECODE1=ECODE1_ECCLAS_U_ECASPR_U_ECCLAS2_U_ECASNPI_U_ECXCPT_U_ECXDOM_U
"RTN","ECXSURG",204,0)
 S ECODE1=ECODE1_ECXCAT_U_ECXSTAT_U_$S(ECXLOGIC<2005:ECXPRIOR,1:"")_U_ECXPOS_U_ECXPHI_U
"RTN","ECXSURG",205,0)
 S ECODE1=ECODE1_ECXOBS_U_ECXENC_U_ECXAOL_U_ECXPDIV_U_ECXHNCI_U
"RTN","ECXSURG",206,0)
 S ECODE1=ECODE1_ECXETH_U_ECXRC1_U_ECXQ_U
"RTN","ECXSURG",207,0)
 I ECXLOGIC>2004 S ECODE1=ECODE1_U_ECXPRIOR_ECXSBGRP_U_ECXUESTA_U_ECXPTYPE_U_ECXCVE_U_ECXCVEDT_U_ECXCVENC_U_ECXORCT_U_ECXPTHA_U_ECXNPRFI
"RTN","ECXSURG",208,0)
 I ECXLOGIC>2005 S ECODE1=ECODE1_U_ECXPA_U_ECSRPC_U,ECODE2=ECATPC_U_ECSAPC_U_ECXPAPC
"RTN","ECXSURG",209,0)
 I ECXLOGIC>2006 S ECODE2=ECODE2_U_ECXERI_U_ECXAO_U_ECXHNC
"RTN","ECXSURG",210,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,^ECX(ECFILE,EC7,2)=ECODE2,ECRN=ECRN+1
"RTN","ECXSURG",211,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXSURG",212,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSURG",213,0)
 ;
"RTN","ECXSURG",214,0)
TIME ; given date/time get increment
"RTN","ECXSURG",215,0)
 ;A1=later, A2=earlier, TIME=difference
"RTN","ECXSURG",216,0)
 N CON,TIMEDIF
"RTN","ECXSURG",217,0)
 S CON=$P($G(^SRF(ECD0,"CON")),U)
"RTN","ECXSURG",218,0)
 ;
"RTN","ECXSURG",219,0)
 ;-Get time diff (in secs) & set to .5 if < 7.5 minutes (rounds to 1)
"RTN","ECXSURG",220,0)
 S TIMEDIF=$$FMDIFF^XLFDT(A1,A2,2)/900
"RTN","ECXSURG",221,0)
 S TIMEDIF=$S(TIMEDIF>0&(TIMEDIF<.5):.5,1:TIMEDIF)
"RTN","ECXSURG",222,0)
 I 'CON D
"RTN","ECXSURG",223,0)
 .S TIME=$J($TR($J(TIMEDIF,4,0)," "),2,1)
"RTN","ECXSURG",224,0)
 .S:TIME>"99.0" TIME="99.0"
"RTN","ECXSURG",225,0)
 I CON D
"RTN","ECXSURG",226,0)
 .S TIME=$J(($TR($J(TIMEDIF,4,0)," ")/2),2,1)
"RTN","ECXSURG",227,0)
 .S:TIME>"99.5" TIME="99.5"
"RTN","ECXSURG",228,0)
 S:TIME<0 TIME="###"
"RTN","ECXSURG",229,0)
 Q
"RTN","ECXSURG",230,0)
 ;
"RTN","ECXSURG",231,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSURG",232,0)
 S ECHEAD="SUR"
"RTN","ECXSURG",233,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSURG",234,0)
 Q
"RTN","ECXSURG",235,0)
 ;
"RTN","ECXSURG",236,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSURG",237,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22.0
"BLD",7071,6)
^92
**END**
**END**
