KIDS Distribution saved on Jun 07, 2006@13:32:49
BLIND REHABILITATION 5.0
**KIDS**:ANRV 5.0^

**INSTALL NAME**
ANRV 5.0
"BLD",5740,0)
ANRV 5.0^VISUAL IMPAIRMENT SERVICE TEAM^0^3060607^y
"BLD",5740,1,0)
^^2^2^3050929^
"BLD",5740,1,1,0)
This build contains the routines, options and rpc's necessary for the 
"BLD",5740,1,2,0)
Blind Rehabilitation/VIST V5.0 Java software.
"BLD",5740,4,0)
^9.64PA^^0
"BLD",5740,6.3)
4
"BLD",5740,"ABNS",0)
^9.66A^1^1
"BLD",5740,"ABNS",1,0)
ANRV
"BLD",5740,"ABNS",1,1,0)
^9.661A^^
"BLD",5740,"ABNS","B","ANRV",1)

"BLD",5740,"ABPKG")
n^n
"BLD",5740,"INID")
^y
"BLD",5740,"INIT")
ANRVJP
"BLD",5740,"KRN",0)
^9.67PA^8989.52^19
"BLD",5740,"KRN",.4,0)
.4
"BLD",5740,"KRN",.401,0)
.401
"BLD",5740,"KRN",.402,0)
.402
"BLD",5740,"KRN",.403,0)
.403
"BLD",5740,"KRN",.5,0)
.5
"BLD",5740,"KRN",.5,"NM",0)
^9.68A^^
"BLD",5740,"KRN",.84,0)
.84
"BLD",5740,"KRN",3.6,0)
3.6
"BLD",5740,"KRN",3.8,0)
3.8
"BLD",5740,"KRN",9.2,0)
9.2
"BLD",5740,"KRN",9.8,0)
9.8
"BLD",5740,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5740,"KRN",9.8,"NM",1,0)
ANRVJ1^^0^B5515859
"BLD",5740,"KRN",9.8,"NM",2,0)
ANRVJP^^0^B873634
"BLD",5740,"KRN",9.8,"NM","B","ANRVJ1",1)

"BLD",5740,"KRN",9.8,"NM","B","ANRVJP",2)

"BLD",5740,"KRN",19,0)
19
"BLD",5740,"KRN",19,"NM",0)
^9.68A^23^14
"BLD",5740,"KRN",19,"NM",1,0)
ANRVJ_BLINDREHAB^^0
"BLD",5740,"KRN",19,"NM",6,0)
ANRV LETTER MENU^^1^
"BLD",5740,"KRN",19,"NM",11,0)
ANRV PATIENT REVIEW^^1^
"BLD",5740,"KRN",19,"NM",12,0)
ANRV ENTER/EDIT CHECKLIST^^1^
"BLD",5740,"KRN",19,"NM",13,0)
ANRV ENTER/EDIT VIST PATIENT^^1^
"BLD",5740,"KRN",19,"NM",14,0)
ANRV ENTER/EDIT REFERRAL^^1^
"BLD",5740,"KRN",19,"NM",15,0)
ANRV ENTER/EDIT INACTIVE VIST^^1^
"BLD",5740,"KRN",19,"NM",16,0)
ANRV ENTER/EDIT VARO CLAIMS^^1^
"BLD",5740,"KRN",19,"NM",17,0)
ANRV ENTER/EDIT VIST PARAMETER^^1^
"BLD",5740,"KRN",19,"NM",18,0)
ANRV DELETE ROSTER^^1^
"BLD",5740,"KRN",19,"NM",19,0)
ANRV DELETE REFERRAL^^1^
"BLD",5740,"KRN",19,"NM",20,0)
ANRV EDIT VIST OPTIONS^^1^
"BLD",5740,"KRN",19,"NM",22,0)
ANRV ENTER/EDIT VIST LETTER^^1^
"BLD",5740,"KRN",19,"NM",23,0)
ANRV EYE DIAG NARRATIVE^^1^
"BLD",5740,"KRN",19,"NM","B","ANRV DELETE REFERRAL",19)

"BLD",5740,"KRN",19,"NM","B","ANRV DELETE ROSTER",18)

"BLD",5740,"KRN",19,"NM","B","ANRV EDIT VIST OPTIONS",20)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT CHECKLIST",12)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT INACTIVE VIST",15)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT REFERRAL",14)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT VARO CLAIMS",16)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT VIST LETTER",22)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT VIST PARAMETER",17)

"BLD",5740,"KRN",19,"NM","B","ANRV ENTER/EDIT VIST PATIENT",13)

"BLD",5740,"KRN",19,"NM","B","ANRV EYE DIAG NARRATIVE",23)

"BLD",5740,"KRN",19,"NM","B","ANRV LETTER MENU",6)

"BLD",5740,"KRN",19,"NM","B","ANRV PATIENT REVIEW",11)

"BLD",5740,"KRN",19,"NM","B","ANRVJ_BLINDREHAB",1)

"BLD",5740,"KRN",19.1,0)
19.1
"BLD",5740,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",5740,"KRN",19.1,"NM",1,0)
ANRVUSERROLE^^0
"BLD",5740,"KRN",19.1,"NM",2,0)
ANRVADMINROLE^^0
"BLD",5740,"KRN",19.1,"NM","B","ANRVADMINROLE",2)

"BLD",5740,"KRN",19.1,"NM","B","ANRVUSERROLE",1)

"BLD",5740,"KRN",101,0)
101
"BLD",5740,"KRN",409.61,0)
409.61
"BLD",5740,"KRN",771,0)
771
"BLD",5740,"KRN",870,0)
870
"BLD",5740,"KRN",8989.51,0)
8989.51
"BLD",5740,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",5740,"KRN",8989.51,"NM",1,0)
ANRV GUI VERSION^^0
"BLD",5740,"KRN",8989.51,"NM","B","ANRV GUI VERSION",1)

"BLD",5740,"KRN",8989.52,0)
8989.52
"BLD",5740,"KRN",8994,0)
8994
"BLD",5740,"KRN",8994,"NM",0)
^9.68A^5^4
"BLD",5740,"KRN",8994,"NM",1,0)
ANRVJ1_RPC_MAIN^^0
"BLD",5740,"KRN",8994,"NM",3,0)
ANRV PROBLEM LIST^^0
"BLD",5740,"KRN",8994,"NM",4,0)
ANRV CREATE ENCOUNTER^^0
"BLD",5740,"KRN",8994,"NM",5,0)
ANRV GET PN TITLES^^0
"BLD",5740,"KRN",8994,"NM","B","ANRV CREATE ENCOUNTER",4)

"BLD",5740,"KRN",8994,"NM","B","ANRV GET PN TITLES",5)

"BLD",5740,"KRN",8994,"NM","B","ANRV PROBLEM LIST",3)

"BLD",5740,"KRN",8994,"NM","B","ANRVJ1_RPC_MAIN",1)

"BLD",5740,"KRN","B",.4,.4)

"BLD",5740,"KRN","B",.401,.401)

"BLD",5740,"KRN","B",.402,.402)

"BLD",5740,"KRN","B",.403,.403)

"BLD",5740,"KRN","B",.5,.5)

"BLD",5740,"KRN","B",.84,.84)

"BLD",5740,"KRN","B",3.6,3.6)

"BLD",5740,"KRN","B",3.8,3.8)

"BLD",5740,"KRN","B",9.2,9.2)

"BLD",5740,"KRN","B",9.8,9.8)

"BLD",5740,"KRN","B",19,19)

"BLD",5740,"KRN","B",19.1,19.1)

"BLD",5740,"KRN","B",101,101)

"BLD",5740,"KRN","B",409.61,409.61)

"BLD",5740,"KRN","B",771,771)

"BLD",5740,"KRN","B",870,870)

"BLD",5740,"KRN","B",8989.51,8989.51)

"BLD",5740,"KRN","B",8989.52,8989.52)

"BLD",5740,"KRN","B",8994,8994)

"BLD",5740,"QUES",0)
^9.62^^
"BLD",5740,"REQB",0)
^9.611^4^4
"BLD",5740,"REQB",1,0)
XOBV 1.5^1
"BLD",5740,"REQB",2,0)
DG*5.3*538^1
"BLD",5740,"REQB",3,0)
DG*5.3*557^1
"BLD",5740,"REQB",4,0)
XU*8.0*329^1
"BLD",5740,"REQB","B","DG*5.3*538",2)

"BLD",5740,"REQB","B","DG*5.3*557",3)

"BLD",5740,"REQB","B","XOBV 1.5",1)

"BLD",5740,"REQB","B","XU*8.0*329",4)

"INIT")
ANRVJP
"KRN",19,16360,-1)
0^1
"KRN",19,16360,0)
ANRVJ_BLINDREHAB^BLIND REHAB/VIST 5.0^^B^^^^^^^^
"KRN",19,16360,1,0)
^19.06^2^2^3050929^^^^
"KRN",19,16360,1,1,0)
This option is for the Rehosted and subsequent versions of Blind Rehabilitation/VIST V5.0.  As of this version the files for VIST 4.0 will be rehosted onto a new platform.  The RPC's contained in this option are necessary to provide data back to
"KRN",19,16360,1,2,0)
 the new platform via VistALink using current DBIA's.
"KRN",19,16360,99)
60418,34892
"KRN",19,16360,99.1)
59618,23352
"KRN",19,16360,"RPC",0)
^19.05P^34^34
"KRN",19,16360,"RPC",13,0)
ANRVJ1_RPC_MAIN
"KRN",19,16360,"RPC",20,0)
TIU SIGN RECORD
"KRN",19,16360,"RPC",24,0)
TIU CREATE RECORD
"KRN",19,16360,"RPC",25,0)
TIU DELETE RECORD
"KRN",19,16360,"RPC",29,0)
ANRV CREATE ENCOUNTER
"KRN",19,16360,"RPC",30,0)
ANRV PROBLEM LIST
"KRN",19,16360,"RPC",31,0)
TIU GET PN TITLES
"KRN",19,16360,"RPC",33,0)
TIU REQUIRES COSIGNATURE
"KRN",19,16360,"RPC",34,0)
ANRV GET PN TITLES
"KRN",19,16360,"U")
BLIND REHAB/VIST 5.0
"KRN",19,16597,-1)
1^6
"KRN",19,16597,0)
ANRV LETTER MENU
"KRN",19,16598,-1)
1^11
"KRN",19,16598,0)
ANRV PATIENT REVIEW
"KRN",19,16599,-1)
1^12
"KRN",19,16599,0)
ANRV ENTER/EDIT CHECKLIST
"KRN",19,16600,-1)
1^13
"KRN",19,16600,0)
ANRV ENTER/EDIT VIST PATIENT
"KRN",19,16601,-1)
1^14
"KRN",19,16601,0)
ANRV ENTER/EDIT REFERRAL
"KRN",19,16602,-1)
1^15
"KRN",19,16602,0)
ANRV ENTER/EDIT INACTIVE VIST
"KRN",19,16603,-1)
1^16
"KRN",19,16603,0)
ANRV ENTER/EDIT VARO CLAIMS
"KRN",19,16604,-1)
1^17
"KRN",19,16604,0)
ANRV ENTER/EDIT VIST PARAMETER
"KRN",19,16605,-1)
1^18
"KRN",19,16605,0)
ANRV DELETE ROSTER
"KRN",19,16606,-1)
1^19
"KRN",19,16606,0)
ANRV DELETE REFERRAL
"KRN",19,16607,-1)
1^20
"KRN",19,16607,0)
ANRV EDIT VIST OPTIONS
"KRN",19,16608,-1)
1^22
"KRN",19,16608,0)
ANRV ENTER/EDIT VIST LETTER
"KRN",19,16609,-1)
1^23
"KRN",19,16609,0)
ANRV EYE DIAG NARRATIVE
"KRN",19.1,768,-1)
0^1
"KRN",19.1,768,0)
ANRVUSERROLE^Blind Rehab User^l^^1
"KRN",19.1,768,1,0)
^19.11^3^3^3050602^^
"KRN",19.1,768,1,1,0)
This key has been established for users of the Web enabled Blind 
"KRN",19.1,768,1,2,0)
Rehabilitation/VIST 5.0 software.  This gives a user full access to 
"KRN",19.1,768,1,3,0)
everything except administrative activity.
"KRN",19.1,769,-1)
0^2
"KRN",19.1,769,0)
ANRVADMINROLE^Blind Rehab Admins^l^^1
"KRN",19.1,769,1,0)
^19.11^3^3^3050602^^
"KRN",19.1,769,1,1,0)
This key has been established to provide security using the KAAJEE 
"KRN",19.1,769,1,2,0)
implementation to give administrators all access to the Blind Rehab/VIST 
"KRN",19.1,769,1,3,0)
5.0 system.
"KRN",8989.51,308,-1)
0^1
"KRN",8989.51,308,0)
ANRV GUI VERSION^Active ANRV Executable^1^Application:Version^Compatible with current server version^0
"KRN",8989.51,308,1)
Y
"KRN",8989.51,308,6)
F^1:30
"KRN",8989.51,308,20,0)
^8989.512^3^3^3020822^^^
"KRN",8989.51,308,20,1,0)
This parameter is used to store the application:version(s) that are 
"KRN",8989.51,308,20,2,0)
compatible with the current server version of ANRV Patient Reviews.  
"KRN",8989.51,308,20,3,0)
Instance format of APPLICATION:VERSION  (example:  ANRV.EXE:0.0.0.0).
"KRN",8989.51,308,30,0)
^8989.513I^1^1
"KRN",8989.51,308,30,1,0)
1^4.2
"KRN",8994,2266,-1)
0^1
"KRN",8994,2266,0)
ANRVJ1_RPC_MAIN^RPC^ANRVJ1^4^R^^^^^^1
"KRN",8994,2266,1,0)
^8994.01^5^5^3060605^^^^
"KRN",8994,2266,1,1,0)
This is the main entry point for calling line tags in routine ANRVJ1.  
"KRN",8994,2266,1,2,0)
The format is:
"KRN",8994,2266,1,3,0)
        Parameter 1 = OPTION (name of the line tag to call)
"KRN",8994,2266,1,4,0)
        Parameter 2 = DFN (value being passed in)
"KRN",8994,2266,1,5,0)
        Parameter 3 = DATA (any additional values to be passed in)
"KRN",8994,2266,2,0)
^8994.02A^3^3
"KRN",8994,2266,2,1,0)
OPTION^1^10^1^1
"KRN",8994,2266,2,1,1,0)
^^1^1^3040420^
"KRN",8994,2266,2,1,1,1,0)
Routine Line tag you wish to call.
"KRN",8994,2266,2,2,0)
DFN^1^^0^2
"KRN",8994,2266,2,2,1,0)
^8994.021^1^1^3040420^^
"KRN",8994,2266,2,2,1,1,0)
Parameter variable to be passed into routine tag.
"KRN",8994,2266,2,3,0)
DATA^1^^0^3
"KRN",8994,2266,2,3,1,0)
^8994.021^1^1^3050608^^^^
"KRN",8994,2266,2,3,1,1,0)
Any additional parameters to be passed into the routine line tag.
"KRN",8994,2266,2,"B","DATA",3)

"KRN",8994,2266,2,"B","DFN",2)

"KRN",8994,2266,2,"B","OPTION",1)

"KRN",8994,2266,2,"PARAMSEQ",1,1)

"KRN",8994,2266,2,"PARAMSEQ",2,2)

"KRN",8994,2266,2,"PARAMSEQ",3,3)

"KRN",8994,2266,3,0)
^8994.03^1^1^3060605^^^^
"KRN",8994,2266,3,1,0)
Results are a global array.
"KRN",8994,2266,605001)
34011
"KRN",8994,2275,-1)
0^4
"KRN",8994,2275,0)
ANRV CREATE ENCOUNTER^ENCNTR^ANRVJ1^2^
"KRN",8994,2275,1,0)
^8994.01^1^1^3050222^^^^
"KRN",8994,2275,1,1,0)
Create an encounter.
"KRN",8994,2275,2,0)
^8994.02A^^0
"KRN",8994,2275,605001)
34011
"KRN",8994,2284,-1)
0^3
"KRN",8994,2284,0)
ANRV PROBLEM LIST^LIST^ORQQPL^2^S^^^^^^1
"KRN",8994,2284,2,0)
^8994.02A^1^1
"KRN",8994,2284,2,1,0)
STATUS^1^2
"KRN",8994,2284,2,"B","STATUS",1)

"KRN",8994,2284,605001)
34011
"KRN",8994,2332,-1)
0^5
"KRN",8994,2332,0)
ANRV GET PN TITLES^NOTES^TIUSRVD^2^S^^^^^^1
"KRN",8994,2332,1,0)
^^5^5^3050624^
"KRN",8994,2332,1,1,0)
This API returns a list of Progress Notes Titles, including a SHORT LIST 
"KRN",8994,2332,1,2,0)
or preferred titles as defined by the user, and a LONG LIST of all titles 
"KRN",8994,2332,1,3,0)
defined at the site.  This has been added to the Blind Rehab software to 
"KRN",8994,2332,1,4,0)
allow the lookup of TIU Document Definitions to set as site parameters 
"KRN",8994,2332,1,5,0)
for the current institution.
"KRN",8994,2332,605001)
34011
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",65,-1)
1^1
"PKG",65,0)
VISUAL IMPAIRMENT SERVICE TEAM^ANRV^HealtheVet routines.
"PKG",65,1,0)
^9.41A^2^2^3060602^^
"PKG",65,1,1,0)
This package contains the routines necessary for the rehosted VIST 4.0 
"PKG",65,1,2,0)
package and has added functionality for Blind Rehabilitation and BROS.
"PKG",65,5)
HINES OIFO
"PKG",65,7)
^^I
"PKG",65,20,0)
^9.402P^^
"PKG",65,22,0)
^9.49I^1^1
"PKG",65,22,1,0)
5.0^3060607
"PKG",65,22,1,1,0)
^^2^2^3060607
"PKG",65,22,1,1,1,0)
This build contains the routines, options and rpc's necessary for the 
"PKG",65,22,1,1,2,0)
Blind Rehabilitation/VIST V5.0 Java software.
"PKG",65,"DEV")

"PKG",65,"VERSION")
5.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ANRVJ1")
0^1^B5515859
"RTN","ANRVJ1",1,0)
ANRVJ1 ; CED/HOIFO - VistALink calls to be used until services are available ; [02-25-2004 9:00]
"RTN","ANRVJ1",2,0)
 ;;5.0;BLIND REHABILITATION;;Jun 02, 2006;Build 4
"RTN","ANRVJ1",3,0)
 ;
"RTN","ANRVJ1",4,0)
 ; Integration Agreements Utilized:
"RTN","ANRVJ1",5,0)
 ; NOW^%DTC                  #10103
"RTN","ANRVJ1",6,0)
 ; GETDFN^MPIF001            #2701
"RTN","ANRVJ1",7,0)
 ; DATA2PCE^PXAPI            #1889
"RTN","ANRVJ1",8,0)
 ; SELECTED^VSIT             #1905
"RTN","ANRVJ1",9,0)
 ; LIST^ORQQPL               #1642
"RTN","ANRVJ1",10,0)
 ; Add to ANRVJ_BLINDREHAB Option:
"RTN","ANRVJ1",11,0)
 ;       1. DGRR GUI PATIENT LOOKUP      #4686
"RTN","ANRVJ1",12,0)
 ;       2. DGRR PATIENT SERVICE QUERY #4686
"RTN","ANRVJ1",13,0)
 ;       Using DBIA #4755 UDATE^DIE in ANRVJP post-init
"RTN","ANRVJ1",14,0)
 ;       Remote Procedure IA's
"RTN","ANRVJ1",15,0)
 ; TIU SIGN RECORD                #1790
"RTN","ANRVJ1",16,0)
 ; TIU REQUIRES COSIGNATURE       #1800
"RTN","ANRVJ1",17,0)
 ; TIU CREATE RECORD              #1806
"RTN","ANRVJ1",18,0)
 ; TIU DELETE RECORD              #1811
"RTN","ANRVJ1",19,0)
 ; TIU GET PN TITLES              #1782
"RTN","ANRVJ1",20,0)
 ;
"RTN","ANRVJ1",21,0)
ADD(X) ; [Procedure] Adds to RESULTS
"RTN","ANRVJ1",22,0)
 S @RESULTS@(+$O(@RESULTS@(""),-1)+1)=X
"RTN","ANRVJ1",23,0)
 Q
"RTN","ANRVJ1",24,0)
 ;
"RTN","ANRVJ1",25,0)
DELPAR ; [Procedure] Delete single parameter value
"RTN","ANRVJ1",26,0)
 ; ("ANRV GUI VERSION","ANRV.EXE:5.0.2.0")
"RTN","ANRVJ1",27,0)
 N ENT,PAR,INST
"RTN","ANRVJ1",28,0)
 S ENT="SYS"
"RTN","ANRVJ1",29,0)
 S PAR=DFN
"RTN","ANRVJ1",30,0)
 S INST=DATA
"RTN","ANRVJ1",31,0)
 D DEL^XPAR(ENT,PAR,INST,.ERR)
"RTN","ANRVJ1",32,0)
 S:'$G(ERR) @RESULTS@(0)="1^Instance Deleted"
"RTN","ANRVJ1",33,0)
 Q
"RTN","ANRVJ1",34,0)
 ;
"RTN","ANRVJ1",35,0)
ELECSIG ; [Procedure] Check Electronic Signature
"RTN","ANRVJ1",36,0)
 ; TODO:  This is being replaced by KAAJEE electronic signature
"RTN","ANRVJ1",37,0)
 N X,X1
"RTN","ANRVJ1",38,0)
 S X=DATA
"RTN","ANRVJ1",39,0)
 S X1=$S($D(DUZ)[0:"",$D(^VA(200,DUZ,20))[0:"",1:$P(^(20),U,4))
"RTN","ANRVJ1",40,0)
 I X1="" S @RESULTS@(0)="-1^Electronic Signature Not Found." Q
"RTN","ANRVJ1",41,0)
 D HASH^XUSHSHP
"RTN","ANRVJ1",42,0)
 I X1'=X S @RESULTS@(0)="0^Electronic Signature Incorrect." Q
"RTN","ANRVJ1",43,0)
 S @RESULTS@(0)="1^Electronic Signature Verified."
"RTN","ANRVJ1",44,0)
 Q
"RTN","ANRVJ1",45,0)
 ;
"RTN","ANRVJ1",46,0)
GETDT ; Return server date/time in FM format
"RTN","ANRVJ1",47,0)
 N NOW
"RTN","ANRVJ1",48,0)
 D NOW^%DTC
"RTN","ANRVJ1",49,0)
 S @RESULTS@(0)=%
"RTN","ANRVJ1",50,0)
 Q
"RTN","ANRVJ1",51,0)
 ;
"RTN","ANRVJ1",52,0)
GETDFN ; Return the DFN given a ICN
"RTN","ANRVJ1",53,0)
 S @RESULTS@(0)=$$GETDFN^MPIF001(DFN)
"RTN","ANRVJ1",54,0)
 Q
"RTN","ANRVJ1",55,0)
 ;
"RTN","ANRVJ1",56,0)
GETLST ; [Procedure] Return all instances of a parameter
"RTN","ANRVJ1",57,0)
 ; ("ANRV GUI VERSION","ANRV.EXE:5.0.1.0")
"RTN","ANRVJ1",58,0)
 N ENT,PAR
"RTN","ANRVJ1",59,0)
 S ENT="SYS"
"RTN","ANRVJ1",60,0)
 S PAR=DFN
"RTN","ANRVJ1",61,0)
 D GETLST^XPAR(.RET,ENT,PAR,"E",.ERR)
"RTN","ANRVJ1",62,0)
 Q:$G(ERR,0)
"RTN","ANRVJ1",63,0)
 S TMP="RET"
"RTN","ANRVJ1",64,0)
 F  S TMP=$Q(@TMP) Q:TMP=""  D
"RTN","ANRVJ1",65,0)
 .S @RESULTS@($O(@RESULTS@(""),-1)+1)=@TMP
"RTN","ANRVJ1",66,0)
 S @RESULTS@(0)=$O(@RESULTS@(""),-1)
"RTN","ANRVJ1",67,0)
 Q
"RTN","ANRVJ1",68,0)
 ;
"RTN","ANRVJ1",69,0)
GETPAR ; Return external value for parameter
"RTN","ANRVJ1",70,0)
 ; 1^YES
"RTN","ANRVJ1",71,0)
 N ENT,PAR,INST,VER
"RTN","ANRVJ1",72,0)
 S ENT="SYS"
"RTN","ANRVJ1",73,0)
 S PAR=DFN
"RTN","ANRVJ1",74,0)
 S INST=DATA
"RTN","ANRVJ1",75,0)
 S VER=$$GET^XPAR(ENT,PAR,INST,"B")
"RTN","ANRVJ1",76,0)
 I VER="" S VER="0^NO"
"RTN","ANRVJ1",77,0)
 S @RESULTS@(0)=VER
"RTN","ANRVJ1",78,0)
 ; S @RESULTS@(0)=$$GET^XPAR(ENT,PAR,INST,"B")
"RTN","ANRVJ1",79,0)
 Q
"RTN","ANRVJ1",80,0)
 ;
"RTN","ANRVJ1",81,0)
GETWP ; [Procedure] Returns WP text for a parameter
"RTN","ANRVJ1",82,0)
 ;
"RTN","ANRVJ1",83,0)
 N ENT,PAR
"RTN","ANRVJ1",84,0)
 S ENT="SYS"
"RTN","ANRVJ1",85,0)
 S PAR=DFN
"RTN","ANRVJ1",86,0)
 S INST=DATA
"RTN","ANRVJ1",87,0)
 D GETWP^XPAR(.RET,ENT,PAR,INST,.ERR)
"RTN","ANRVJ1",88,0)
 Q:$G(ERR,0)
"RTN","ANRVJ1",89,0)
 S TMP="RET"
"RTN","ANRVJ1",90,0)
 F  S TMP=$Q(@TMP) Q:TMP=""  D
"RTN","ANRVJ1",91,0)
 .S @RESULTS@($O(@RESULTS@(""),-1)+1)=@TMP
"RTN","ANRVJ1",92,0)
 S @RESULTS@(0)=$O(@RESULTS@(""),-1)_U_INST
"RTN","ANRVJ1",93,0)
 Q
"RTN","ANRVJ1",94,0)
 ;
"RTN","ANRVJ1",95,0)
ENCNTR(RESULT,DFN,PKG,ENCDT,LOC,ANRVDUZ,PROC,CPTQTY,ICD,SC,AO,IR,EC,MST,HNC,CV)
"RTN","ANRVJ1",96,0)
 ; Creates an encounter in PCE
"RTN","ANRVJ1",97,0)
 N X,Y,ANRVENCT,DIAG,ERR,SOURC,ANRVDATE,LOOP,ANRVUSER,DIC,NOW
"RTN","ANRVJ1",98,0)
 I DFN="" S RESULT(1)="-1^Patient is undefined" Q
"RTN","ANRVJ1",99,0)
 ; D NOW^%DTC S NOW=% removed pending update
"RTN","ANRVJ1",100,0)
 S DIC="^DIC(9.4,",DIC(0)="MZ",X=PKG D ^DIC S PKG=+Y
"RTN","ANRVJ1",101,0)
 ; TODO:  add additional data checks
"RTN","ANRVJ1",102,0)
 I +PKG=-1 S RESULT(1)="-1^VIST Package not registered in PACKAGE file" Q
"RTN","ANRVJ1",103,0)
 I LOC="" S RESULT(1)="-1^Hospital Location is not defined!" Q
"RTN","ANRVJ1",104,0)
 S SOURC=PKG,ANRVUSER=ANRVDUZ
"RTN","ANRVJ1",105,0)
 ;; First, we need to build the local to pass to the encounter.
"RTN","ANRVJ1",106,0)
 S ANRVENCT("ENCOUNTER",1,"ENC D/T")=ENCDT
"RTN","ANRVJ1",107,0)
 ; S ANRVENCT("ENCOUNTER",1,"ENC D/T")=NOW removed pending update
"RTN","ANRVJ1",108,0)
 S ANRVENCT("ENCOUNTER",1,"PATIENT")=DFN
"RTN","ANRVJ1",109,0)
 S ANRVENCT("ENCOUNTER",1,"HOS LOC")=LOC
"RTN","ANRVJ1",110,0)
 S ANRVENCT("ENCOUNTER",1,"SERVICE CATEGORY")="T"
"RTN","ANRVJ1",111,0)
 S ANRVENCT("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","ANRVJ1",112,0)
 S ANRVENCT("ENCOUNTER",1,"SC")=SC
"RTN","ANRVJ1",113,0)
 S ANRVENCT("ENCOUNTER",1,"AO")=AO
"RTN","ANRVJ1",114,0)
 S ANRVENCT("ENCOUNTER",1,"IR")=IR
"RTN","ANRVJ1",115,0)
 S ANRVENCT("ENCOUNTER",1,"EC")=EC
"RTN","ANRVJ1",116,0)
 S ANRVENCT("ENCOUNTER",1,"MST")=MST
"RTN","ANRVJ1",117,0)
 S ANRVENCT("ENCOUNTER",1,"HNC")=HNC
"RTN","ANRVJ1",118,0)
 S ANRVENCT("ENCOUNTER",1,"CV")=CV
"RTN","ANRVJ1",119,0)
 S ANRVENCT("PROVIDER",1,"NAME")=ANRVDUZ
"RTN","ANRVJ1",120,0)
 S ANRVENCT("PROVIDER",1,"PRIMARY")=1
"RTN","ANRVJ1",121,0)
 ;
"RTN","ANRVJ1",122,0)
 S LOOP=0
"RTN","ANRVJ1",123,0)
 F  S LOOP=$O(ICD(LOOP)) Q:LOOP=""  D
"RTN","ANRVJ1",124,0)
 .Q:$P($G(ICD(LOOP)),"^")'="DIAGNOSIS"
"RTN","ANRVJ1",125,0)
 .S DIAG=$$FIND1^DIC(80,"","MX",$P($G(ICD(LOOP)),"^",2),"","","ERR")
"RTN","ANRVJ1",126,0)
 .S ANRVENCT("DX/PL",LOOP,"DIAGNOSIS")=DIAG
"RTN","ANRVJ1",127,0)
 .S:+$P($G(ICD(LOOP)),"^",3)=1 ANRVENCT("DX/PL",LOOP,"PRIMARY")=1
"RTN","ANRVJ1",128,0)
 S ANRVENCT("PROCEDURE",1,"PROCEDURE")=PROC
"RTN","ANRVJ1",129,0)
 S ANRVENCT("PROCEDURE",1,"QTY")=CPTQTY
"RTN","ANRVJ1",130,0)
 ; Now, let's create the encounter.
"RTN","ANRVJ1",131,0)
 S RESULT(1)=$$DATA2PCE^PXAPI("ANRVENCT",PKG,SOURC,,,"^TMP($J,""ANRV"")")
"RTN","ANRVJ1",132,0)
 I +RESULT(1)<1 S RESULT(1)="-1^Unable to create encounter!^"_RESULT(1) Q
"RTN","ANRVJ1",133,0)
 ; find the IEN of the encounter and return it
"RTN","ANRVJ1",134,0)
 D SELECTED^VSIT(DFN,,,,,,,,1) S RESULT(1)=$O(^TMP("VSIT",$J,0))
"RTN","ANRVJ1",135,0)
 K ^TMP($J),^TMP("VSIT",$J)
"RTN","ANRVJ1",136,0)
 Q
"RTN","ANRVJ1",137,0)
 ;
"RTN","ANRVJ1",138,0)
LOCS ; [procedure] Gets a list of locations from file 44
"RTN","ANRVJ1",139,0)
 N I,Y
"RTN","ANRVJ1",140,0)
 D FIND^DIC(44,"","@;.01","CMP",DFN,"","","","","Y")
"RTN","ANRVJ1",141,0)
 S I=0 F  S I=$O(Y("DILIST",I)) Q:'I  S @RESULTS@(I)=Y("DILIST",I,0)_"~"
"RTN","ANRVJ1",142,0)
 D:'$D(@RESULTS)
"RTN","ANRVJ1",143,0)
 .S @RESULTS@(0)=""
"RTN","ANRVJ1",144,0)
 D CLEAN^DILF
"RTN","ANRVJ1",145,0)
 Q
"RTN","ANRVJ1",146,0)
 ;
"RTN","ANRVJ1",147,0)
RPC(RESULTS,OPTION,DFN,DATA) ; [Procedure] Main RPC Call Entry
"RTN","ANRVJ1",148,0)
 S RESULTS=$NA(^TMP($J)) K @RESULTS
"RTN","ANRVJ1",149,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","ANRVJ1",150,0)
 D:'$D(@RESULTS)
"RTN","ANRVJ1",151,0)
 .S @RESULTS@(0)="0^No results returned"
"RTN","ANRVJ1",152,0)
 D CLEAN^DILF
"RTN","ANRVJ1",153,0)
 Q
"RTN","ANRVJ1",154,0)
 ;
"RTN","ANRVJ1",155,0)
SELUSR ; [Procedure] Return selected user.
"RTN","ANRVJ1",156,0)
 ; This is being replaced by KAAJEE
"RTN","ANRVJ1",157,0)
 N IENS
"RTN","ANRVJ1",158,0)
 S IENS=DFN
"RTN","ANRVJ1",159,0)
 S @RESULTS@(0)=DFN_U
"RTN","ANRVJ1",160,0)
 S @RESULTS@(1)=$$GET1^DIQ(200,DFN_",",.01)_U ; Name
"RTN","ANRVJ1",161,0)
 S @RESULTS@(2)=$$GET1^DIQ(200,DFN_",",8)_U ; Title
"RTN","ANRVJ1",162,0)
 S @RESULTS@(3)=+$$FIND1^DIC(4.2,"","QX",$$KSP^XUPARAM("WHERE"))_U ;Domain
"RTN","ANRVJ1",163,0)
 S @RESULTS@(4)=$$KSP^XUPARAM("WHERE")_U ; Domain Name
"RTN","ANRVJ1",164,0)
 S @RESULTS@(5)=+$G(DFN(2))_U ; Division IEN
"RTN","ANRVJ1",165,0)
 S @RESULTS@(6)=$S(+$G(DFN(2)):$$GET1^DIQ(4,DUZ(2)_",",.01),1:"UNKNOWN")_U
"RTN","ANRVJ1",166,0)
 Q
"RTN","ANRVJ1",167,0)
 ;
"RTN","ANRVJ1",168,0)
SETLST ; [Procedure] Set single value into a parameter
"RTN","ANRVJ1",169,0)
 N ANRVINS ; Instance Counter
"RTN","ANRVJ1",170,0)
 N ENT,PAR
"RTN","ANRVJ1",171,0)
 S ENT="SYS"
"RTN","ANRVJ1",172,0)
 S PAR=DFN
"RTN","ANRVJ1",173,0)
 S INST=DATA
"RTN","ANRVJ1",174,0)
 D DELLST(ENT,PAR)
"RTN","ANRVJ1",175,0)
 S ANRVINS=""
"RTN","ANRVJ1",176,0)
 F  S ANRVINS=$O(VAL(ANRVINS)) Q:ANRVINS=""  D
"RTN","ANRVJ1",177,0)
 .D EN^XPAR(ENT,PAR,ANRVINS,VAL(ANRVINS),.ERR)
"RTN","ANRVJ1",178,0)
 S:'$G(ERR) @RESULTS@(0)="1^List "_PAR_" rebuilt"
"RTN","ANRVJ1",179,0)
 Q
"RTN","ANRVJ1",180,0)
 ;
"RTN","ANRVJ1",181,0)
SETPAR ; [Procedure] Set single value into a parameter
"RTN","ANRVJ1",182,0)
 ; add the new parameter, make sure you update the old to active=no
"RTN","ANRVJ1",183,0)
 ; ("ANRV.EXE:5.0.2.0","YES")   
"RTN","ANRVJ1",184,0)
 N ENT,PAR
"RTN","ANRVJ1",185,0)
 S ENT="SYS"
"RTN","ANRVJ1",186,0)
 S PAR="ANRV GUI VERSION"
"RTN","ANRVJ1",187,0)
 S INST=DFN
"RTN","ANRVJ1",188,0)
 S VAL=DATA
"RTN","ANRVJ1",189,0)
 D EN^XPAR(ENT,PAR,INST,VAL,.ERR)
"RTN","ANRVJ1",190,0)
 S:'$G(ERR) @RESULTS@(0)="1^Parameter updated"
"RTN","ANRVJ1",191,0)
 Q
"RTN","ANRVJ1",192,0)
 ;
"RTN","ANRVJ1",193,0)
SETWP ; [Procedure] Set WP text into a parameter
"RTN","ANRVJ1",194,0)
 S TXT=INST,TMP=""
"RTN","ANRVJ1",195,0)
 F  S TMP=$O(VAL(TMP)) Q:TMP=""  D
"RTN","ANRVJ1",196,0)
 .S TXT($O(TXT(""),-1)+1,0)=VAL(TMP)
"RTN","ANRVJ1",197,0)
 D EN^XPAR(ENT,PAR,INST,.TXT,.ERR)
"RTN","ANRVJ1",198,0)
 S:'$G(ERR) @RESULTS@(0)="1^WP Text Saved"
"RTN","ANRVJ1",199,0)
 Q
"RTN","ANRVJ1",200,0)
 ;
"RTN","ANRVJ1",201,0)
SIGNON  ;
"RTN","ANRVJ1",202,0)
 ;This is being replaced by KAAJEE
"RTN","ANRVJ1",203,0)
 ;
"RTN","ANRVJ1",204,0)
 ; OUTPUT:
"RTN","ANRVJ1",205,0)
 ; Result(0) is the users DUZ.
"RTN","ANRVJ1",206,0)
 ; Result(1) is the user name from the .01 field.
"RTN","ANRVJ1",207,0)
 ; Result(2) is the users full name from the name standard file.
"RTN","ANRVJ1",208,0)
 ; Result(3) is the FAMILY (LAST) NAME
"RTN","ANRVJ1",209,0)
 ; Result(4) is the GIVEN (FIRST) NAME
"RTN","ANRVJ1",210,0)
 ; Result(5) is the MIDDLE NAME
"RTN","ANRVJ1",211,0)
 ; Result(6) is the PREFIX
"RTN","ANRVJ1",212,0)
 ; Result(7) is the SUFFIX
"RTN","ANRVJ1",213,0)
 ; Result(8) is the DEGREE
"RTN","ANRVJ1",214,0)
 ; Result(9) is the TITLE
"RTN","ANRVJ1",215,0)
 ; Result(10) is station # of the division that the user is working in.
"RTN","ANRVJ1",216,0)
 ; Result(11) is the station # of the parent facility for the login division
"RTN","ANRVJ1",217,0)
 ; Result(12) is the station # from the KSP site parameters, the parent "computer system"
"RTN","ANRVJ1",218,0)
 ; Result(13) = # of permissible divisions
"RTN","ANRVJ1",219,0)
 ; Result(14-n) are the permissible divisions for user login, in the format:
"RTN","ANRVJ1",220,0)
 ;           IEN of file 4^Station Name^Station Number^default? (1 or 0)
"RTN","ANRVJ1",221,0)
 ;
"RTN","ANRVJ1",222,0)
 N ANRVNC,ANRVNC1,ANRVERR,ANRVRET,ANRVDIVS,ANRVI,ANRVLINE,PARNT,ATITLE,ANRVDEF,DIVLN
"RTN","ANRVJ1",223,0)
 ;
"RTN","ANRVJ1",224,0)
 ; initialize return array
"RTN","ANRVJ1",225,0)
 S @RESULTS@(0)=DUZ_U
"RTN","ANRVJ1",226,0)
 F I=1:1:13 S @RESULTS@(I)=""
"RTN","ANRVJ1",227,0)
 ;
"RTN","ANRVJ1",228,0)
 ; get ptr to Name Components file
"RTN","ANRVJ1",229,0)
 D GETS^DIQ(200,DUZ_",","10.1","I","ANRVNC","ANRVERR")
"RTN","ANRVJ1",230,0)
 I '$D(ANRVERR) D
"RTN","ANRVJ1",231,0)
 .S ANRVNC=ANRVNC(200,DUZ_",",10.1,"I")
"RTN","ANRVJ1",232,0)
 .; get name components -- read access to file 20: DBIA# 3041
"RTN","ANRVJ1",233,0)
 .D GETS^DIQ(20,ANRVNC_",","1:6","","ANRVNC1","ANRVERR")
"RTN","ANRVJ1",234,0)
 .I '$D(ANRVERR) D
"RTN","ANRVJ1",235,0)
 ..S @RESULTS@(3)=ANRVNC1(20,ANRVNC_",",1)_U S:'$L(@RESULTS@(3)) @RESULTS@(3)="^"
"RTN","ANRVJ1",236,0)
 ..S @RESULTS@(4)=ANRVNC1(20,ANRVNC_",",2)_U S:'$L(@RESULTS@(4)) @RESULTS@(4)="^"
"RTN","ANRVJ1",237,0)
 ..S @RESULTS@(5)=ANRVNC1(20,ANRVNC_",",3)_U S:'$L(@RESULTS@(5)) @RESULTS@(5)="^"
"RTN","ANRVJ1",238,0)
 ..S @RESULTS@(6)=ANRVNC1(20,ANRVNC_",",4)_U S:'$L(@RESULTS@(6)) @RESULTS@(6)="^"
"RTN","ANRVJ1",239,0)
 ..S @RESULTS@(7)=ANRVNC1(20,ANRVNC_",",5)_U S:'$L(@RESULTS@(7)) @RESULTS@(7)="^"
"RTN","ANRVJ1",240,0)
 ..S @RESULTS@(8)=ANRVNC1(20,ANRVNC_",",6)_U S:'$L(@RESULTS@(8)) @RESULTS@(8)="^"
"RTN","ANRVJ1",241,0)
 ;
"RTN","ANRVJ1",242,0)
 ; get users title
"RTN","ANRVJ1",243,0)
 S @RESULTS@(9)=$$GET1^DIQ(200,DUZ_",",8)_U ; Title
"RTN","ANRVJ1",244,0)
 ; get .01 New Person name, Name components name, and login division info
"RTN","ANRVJ1",245,0)
 D USERGEN(.ANRVRET)
"RTN","ANRVJ1",246,0)
 S @RESULTS@(2)=ANRVRET(1)_U S:'$L(@RESULTS@(1)) @RESULTS@(1)="^"
"RTN","ANRVJ1",247,0)
 S @RESULTS@(1)=ANRVRET(2)_U S:'$L(@RESULTS@(2)) @RESULTS@(2)="^"
"RTN","ANRVJ1",248,0)
 S @RESULTS@(10)=$P(ANRVRET(3),U,3)_U S:'$L(@RESULTS@(10)) @RESULTS@(9)="0"
"RTN","ANRVJ1",249,0)
 ;
"RTN","ANRVJ1",250,0)
 ; get parent facility 
"RTN","ANRVJ1",251,0)
 S PARNT=$$PRNT^XUAF4(@RESULTS@(10))
"RTN","ANRVJ1",252,0)
 S @RESULTS@(11)=$S(($P(PARNT,U)<1):PARNT,1:$P(PARNT,U))_U
"RTN","ANRVJ1",253,0)
 ;
"RTN","ANRVJ1",254,0)
 ; get the computer system station identifier, what we're truly interested in
"RTN","ANRVJ1",255,0)
 S @RESULTS@(12)=$$STA^XUAF4($$KSP^XUPARAM("INST"))_U
"RTN","ANRVJ1",256,0)
 S:'$L(@RESULTS@(12)) @RESULTS@(12)="0"_U
"RTN","ANRVJ1",257,0)
 ;
"RTN","ANRVJ1",258,0)
 ; get permitted divisions
"RTN","ANRVJ1",259,0)
 ;       S DIVLN=12 ; return array subscript counter for division start point
"RTN","ANRVJ1",260,0)
 S DIVLN=13 ; return array subscript counter for division start point
"RTN","ANRVJ1",261,0)
 D DIVGET(.ANRVDIVS,DUZ)
"RTN","ANRVJ1",262,0)
 I '+ANRVDIVS(0) S @RESULTS@(DIVLN)=1_U,@RESULTS@(DIVLN+1)=ANRVRET(3)_"^1"_U ; only 1 division, so use login division.
"RTN","ANRVJ1",263,0)
 ; TO DO:  add a delimiter to the multi division entry at a later time.
"RTN","ANRVJ1",264,0)
 I +ANRVDIVS(0) S @RESULTS@(DIVLN)=+ANRVDIVS(0) D
"RTN","ANRVJ1",265,0)
 .S ANRVDEF=$O(^VA(200,DUZ,2,"AX1",1,"")) ; default division if any. Should only be 1.
"RTN","ANRVJ1",266,0)
 .S ANRVI=0,ANRVLINE=DIVLN F  S ANRVI=$O(ANRVDIVS(ANRVI)) Q:ANRVI']""  D
"RTN","ANRVJ1",267,0)
 ..S ANRVLINE=ANRVLINE+1,@RESULTS@(ANRVLINE)=ANRVDIVS(ANRVI)
"RTN","ANRVJ1",268,0)
 ..S $P(@RESULTS@(ANRVLINE),U,4)=$S($P(ANRVDIVS(ANRVI),U)=ANRVDEF:1,1:0)
"RTN","ANRVJ1",269,0)
 ;
"RTN","ANRVJ1",270,0)
 Q
"RTN","ANRVJ1",271,0)
 ;
"RTN","ANRVJ1",272,0)
USERGEN(RET) ;generic user information for seeding VistaUser object.
"RTN","ANRVJ1",273,0)
 ;This is being replaced by KAAJEE
"RTN","ANRVJ1",274,0)
 N %,XU1,XU5,XWBSEC
"RTN","ANRVJ1",275,0)
 S RET(0)=DUZ
"RTN","ANRVJ1",276,0)
 F %=1:1:6 S RET(%)="unk"
"RTN","ANRVJ1",277,0)
 I DUZ'>0 S XWBSEC="User not fully sign-on" Q
"RTN","ANRVJ1",278,0)
 S XU1=^VA(200,DUZ,0),XU5=$G(^(5))
"RTN","ANRVJ1",279,0)
 S RET(1)=$P(XU1,"^") ;.01 User name.
"RTN","ANRVJ1",280,0)
 S RET(2)=$$NAME^XUSER(DUZ) ;Return standard name.
"RTN","ANRVJ1",281,0)
 S RET(3)=DUZ(2)_"^"_$$NS^XUAF4(DUZ(2))
"RTN","ANRVJ1",282,0)
 S %=+$P(XU1,U,9),RET(4)=$P($G(^DIC(3.1,%,0)),U) ;Title
"RTN","ANRVJ1",283,0)
 S %=+XU5,RET(5)=$P($G(^DIC(49,%,0)),U) ;Service/Section
"RTN","ANRVJ1",284,0)
 S RET(6)=$G(DUZ("LANG")) ;User language
"RTN","ANRVJ1",285,0)
 S RET(7)=DTIME ;Users DTIME
"RTN","ANRVJ1",286,0)
 Q
"RTN","ANRVJ1",287,0)
 ;
"RTN","ANRVJ1",288,0)
DIVGET(RET,IEN) ;Get Division data
"RTN","ANRVJ1",289,0)
 ;This is being replaced by KAAJEE
"RTN","ANRVJ1",290,0)
 ;IEN is userid (DUZ or username) for future use.
"RTN","ANRVJ1",291,0)
 N %,XUDIV
"RTN","ANRVJ1",292,0)
 S XUDIV=0,%=$$CHKDIV^XUS1(.XUDIV) ;Get users div.
"RTN","ANRVJ1",293,0)
 S:(%>0)&($P(%,U,2)'>0) DUZ(2)=+% ;Set users default div.
"RTN","ANRVJ1",294,0)
 S RET(0)=XUDIV ;RET(0) is number of divisions.
"RTN","ANRVJ1",295,0)
 I XUDIV S %=0 D  S RET(0)=XUDIV
"RTN","ANRVJ1",296,0)
 . ;RET(%) is divison array eg. ien;station name;station#
"RTN","ANRVJ1",297,0)
 . F  S %=$O(XUDIV(%)) Q:(%'>0)  S RET(%)=XUDIV(%)
"RTN","ANRVJ1",298,0)
 Q
"RTN","ANRVJ1",299,0)
DIVSET(RET,DIV) ;Set users Division
"RTN","ANRVJ1",300,0)
 ;This is being replaced by KAAJEE
"RTN","ANRVJ1",301,0)
 S RET=0,DIV=$$FIND1^DIC(200.02,","_DUZ_",","MX",$G(DIV))
"RTN","ANRVJ1",302,0)
 Q:DIV'>0
"RTN","ANRVJ1",303,0)
 I '$D(^VA(200,DUZ,2,DIV,0)) Q
"RTN","ANRVJ1",304,0)
 S DUZ(2)=DIV,RET=1 ;1=set, 0=not set
"RTN","ANRVJ1",305,0)
 Q
"RTN","ANRVJ1",306,0)
 ;
"RTN","ANRVJ1",307,0)
LISTUS        ; [Procedure] User List
"RTN","ANRVJ1",308,0)
 ;  this is being replaced by person lookup.
"RTN","ANRVJ1",309,0)
 N I,IEN
"RTN","ANRVJ1",310,0)
 D FIND^DIC(200,"","","M",DFN)
"RTN","ANRVJ1",311,0)
 S I=0,Y=""
"RTN","ANRVJ1",312,0)
 F  S I=$O(^TMP("DILIST",$J,1,I)) Q:'I  D
"RTN","ANRVJ1",313,0)
 . S IEN=^TMP("DILIST",$J,2,I)
"RTN","ANRVJ1",314,0)
 . S @RESULTS@(I)=^TMP("DILIST",$J,2,I)_"^"_^TMP("DILIST",$J,1,I)_"~"
"RTN","ANRVJ1",315,0)
 Q
"RTN","ANRVJ1",316,0)
 ;
"RTN","ANRVJP")
0^2^B873634
"RTN","ANRVJP",1,0)
ANRVJP ; CED/HOIFO - Post Init Version Control ; [09-24-2004]
"RTN","ANRVJP",2,0)
 ;;5.0;BLIND REHABILITATION;;Jun 02, 2006;Build 4
"RTN","ANRVJP",3,0)
 ;;
"RTN","ANRVJP",4,0)
EN ;
"RTN","ANRVJP",5,0)
 N ANRV,ANRVGUI,ANRVLST
"RTN","ANRVJP",6,0)
 D GETLST^XPAR(.ANRVLST,"SYS","ANRV GUI VERSION")
"RTN","ANRVJP",7,0)
 F ANRV=0:0 S ANRV=$O(ANRVLST(ANRV)) Q:'ANRV  D
"RTN","ANRVJP",8,0)
 .D SETPAR("ANRV GUI VERSION",$P(ANRVLST(ANRV),"^",1),0)
"RTN","ANRVJP",9,0)
 S ANRVGUI="5.0.1.4" D
"RTN","ANRVJP",10,0)
 .D SETPAR("ANRV GUI VERSION","ANRV.EXE:"_ANRVGUI,1)
"RTN","ANRVJP",11,0)
 D SETPROX("ANRVAPPLICATION,PROXY USER")
"RTN","ANRVJP",12,0)
 D ADDOPT
"RTN","ANRVJP",13,0)
 Q
"RTN","ANRVJP",14,0)
 ;
"RTN","ANRVJP",15,0)
SETPAR(PAR,INS,VAL)     ; [Procedure] Set the Parameter
"RTN","ANRVJP",16,0)
 ; Input parameters
"RTN","ANRVJP",17,0)
 ;  1. PAR [Literal/Required] No description
"RTN","ANRVJP",18,0)
 ;  2. INS [Literal/Required] No description
"RTN","ANRVJP",19,0)
 ;  3. VAL [Literal/Required] No description
"RTN","ANRVJP",20,0)
 ;
"RTN","ANRVJP",21,0)
 D EN^XPAR("SYS",PAR,INS,VAL)
"RTN","ANRVJP",22,0)
 Q
"RTN","ANRVJP",23,0)
 ;
"RTN","ANRVJP",24,0)
SETPROX(PROX)
"RTN","ANRVJP",25,0)
 ;
"RTN","ANRVJP",26,0)
 D ADDPROXY(PROX)
"RTN","ANRVJP",27,0)
 ;
"RTN","ANRVJP",28,0)
ADDPROXY(XOBANAME) ; add application proxy if not present
"RTN","ANRVJP",29,0)
 ; depends on XU*8*361
"RTN","ANRVJP",30,0)
 NEW XOBID,XOBMSG,XOBSUBER,XOBSUBTX,XOBLINE,ANRVOPT
"RTN","ANRVJP",31,0)
 ;
"RTN","ANRVJP",32,0)
 ; if already present don't add
"RTN","ANRVJP",33,0)
 QUIT:(+$$APFIND^XUSAP(XOBANAME))>0
"RTN","ANRVJP",34,0)
 ; add menus
"RTN","ANRVJP",35,0)
 S ANRVOPT("ANRVJ_BLINDREHAB")=""
"RTN","ANRVJP",36,0)
 S ANRVOPT("DGRR PATIENT SERVICE QUERY")=""
"RTN","ANRVJP",37,0)
 ;
"RTN","ANRVJP",38,0)
 SET XOBID=$$CREATE^XUSAP(XOBANAME,"",.ANRVOPT,"")
"RTN","ANRVJP",39,0)
 ;
"RTN","ANRVJP",40,0)
 IF (+XOBID)>0 DO
"RTN","ANRVJP",41,0)
 . SET XOBMSG(1)="Added new Application Proxy User '"_XOBANAME_"'."
"RTN","ANRVJP",42,0)
 . DO BMES^XPDUTL(.XOBMSG)
"RTN","ANRVJP",43,0)
 IF (+XOBID)=0 DO
"RTN","ANRVJP",44,0)
 . ; already checked if user present, should never get 0 back
"RTN","ANRVJP",45,0)
 . SET XOBMSG(1)=">>> Error: Could not add Application Proxy User '"_XOBANAME_"' -- Already exists."
"RTN","ANRVJP",46,0)
 . DO BMES^XPDUTL(.XOBMSG)
"RTN","ANRVJP",47,0)
 IF (+XOBID)<0 DO
"RTN","ANRVJP",48,0)
 . SET XOBMSG(1)=">>> Error: Could not add Application Proxy User '"_XOBANAME_"'."
"RTN","ANRVJP",49,0)
 . SET XOBMSG(2)="    DIERR nodes: <start of error(s)>"
"RTN","ANRVJP",50,0)
 . SET XOBLINE=3,XOBSUBER=0 FOR  SET XOBSUBER=$O(^TMP("DIERR",$J,XOBSUBER)) QUIT:(+XOBSUBER)'>0  DO
"RTN","ANRVJP",51,0)
 . . SET XOBMSG(XOBLINE)="    "_^TMP("DIERR",$J,XOBSUBER),XOBLINE=XOBLINE+1
"RTN","ANRVJP",52,0)
 . . SET XOBSUBTX=0 FOR  SET XOBSUBTX=$O(^TMP("DIERR",$J,XOBSUBER,"TEXT",XOBSUBTX)) QUIT:(+XOBSUBTX)'>0  DO
"RTN","ANRVJP",53,0)
 . . . SET XOBMSG(XOBLINE)="    "_^TMP("DIERR",$J,XOBSUBER,"TEXT",XOBSUBTX),XOBLINE=XOBLINE+1
"RTN","ANRVJP",54,0)
 . SET XOBMSG(XOBLINE+1)="    <end of error(s)>"
"RTN","ANRVJP",55,0)
 . DO BMES^XPDUTL(.XOBMSG)
"RTN","ANRVJP",56,0)
 . K ^TMP("DIERR",$J)
"RTN","ANRVJP",57,0)
 ;
"RTN","ANRVJP",58,0)
 QUIT
"RTN","ANRVJP",59,0)
 ;
"RTN","ANRVJP",60,0)
ADDOPT
"RTN","ANRVJP",61,0)
 ; this is being icluded to add foundations to the 
"RTN","ANRVJP",62,0)
 N ANRVOPT,ANRVFDA,ANRVIEN,ANRVERR,ANRVMSG,I,J,K
"RTN","ANRVJP",63,0)
 S ANRVOPT=$$FIND1^DIC(19,,"QX","ANRVJ_BLINDREHAB","B")
"RTN","ANRVJP",64,0)
 S ANRVFDA(19.01,"?+2,"_ANRVOPT_",",.01)="DGRR GUI PATIENT LOOKUP"
"RTN","ANRVJP",65,0)
 S ANRVFDA(19.01,"?+3,"_ANRVOPT_",",.01)="DGRR PATIENT SERVICE QUERY"
"RTN","ANRVJP",66,0)
 D UPDATE^DIE("E","ANRVFDA","ANRVIEN","ANRVERR")
"RTN","ANRVJP",67,0)
 I $D(ANRVERR) D
"RTN","ANRVJP",68,0)
 . S I=0
"RTN","ANRVJP",69,0)
 . F J=0:0 S J=$O(ANRVERR("DIERR",J)) Q:'J  F K=0:0 S K=$O(ANRVERR("DIERR",J,"TEXT",K)) Q:'K  D
"RTN","ANRVJP",70,0)
 . . S I=I+1,ANRVMSG(I)=ANRVERR("DIERR",J,"TEXT",K)
"RTN","ANRVJP",71,0)
 . . Q
"RTN","ANRVJP",72,0)
 . S I=I+1,ANRVMSG(I)=" "
"RTN","ANRVJP",73,0)
 . S ANRVMSG(I+1)="The Patient Services Broker Type Options DGRR GUI PATIENT LOOKUP"
"RTN","ANRVJP",74,0)
 . S ANRVMSG(I+2)="and DGRR PATIENT SERVICE QUERY could not be added to the"
"RTN","ANRVJP",75,0)
 . S ANRVMSG(I+3)="ANRV Option ANRVJ_BLINDREHAB."
"RTN","ANRVJP",76,0)
 . S ANRVMSG(I+4)=" "
"RTN","ANRVJP",77,0)
 . S ANRVMSG(I+5)="Users of the Blind Rehabilitation application will not be able to look up"
"RTN","ANRVJP",78,0)
 . S ANRVMSG(I+6)="patients until this is resolved."
"RTN","ANRVJP",79,0)
 . D MES^XPDUTL(.ANRVMSG)
"RTN","ANRVJP",80,0)
 . Q
"RTN","ANRVJP",81,0)
 Q
"RTN","ANRVJP",82,0)
 ;
"RTN","ANRVJP",83,0)
 ;
"VER")
8.0^22.0
**END**
**END**
