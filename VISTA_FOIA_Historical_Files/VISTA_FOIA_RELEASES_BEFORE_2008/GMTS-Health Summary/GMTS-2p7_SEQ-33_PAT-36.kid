Released GMTS*2.7*36 SEQ #33
Extracted from mail message
**KIDS**:GMTS*2.7*36^

**INSTALL NAME**
GMTS*2.7*36
"BLD",2041,0)
GMTS*2.7*36^HEALTH SUMMARY^0^2991202^y
"BLD",2041,1,0)
^^2^2^2991012^^
"BLD",2041,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",2041,1,2,0)
under GMTS*2.7*36.
"BLD",2041,4,0)
^9.64PA^^
"BLD",2041,"INID")
^y
"BLD",2041,"INIT")
POST^GMTSP36
"BLD",2041,"KRN",0)
^9.67PA^19^18
"BLD",2041,"KRN",.4,0)
.4
"BLD",2041,"KRN",.401,0)
.401
"BLD",2041,"KRN",.402,0)
.402
"BLD",2041,"KRN",.403,0)
.403
"BLD",2041,"KRN",.5,0)
.5
"BLD",2041,"KRN",.84,0)
.84
"BLD",2041,"KRN",3.6,0)
3.6
"BLD",2041,"KRN",3.8,0)
3.8
"BLD",2041,"KRN",9.2,0)
9.2
"BLD",2041,"KRN",9.8,0)
9.8
"BLD",2041,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",2041,"KRN",9.8,"NM",1,0)
GMTSONE^^0^B21969753
"BLD",2041,"KRN",9.8,"NM",2,0)
GMTSP36^^0^B56324891
"BLD",2041,"KRN",9.8,"NM",3,0)
GMTSLOAD^^0^B10802906
"BLD",2041,"KRN",9.8,"NM",4,0)
GMTSRN^^0^B6681602
"BLD",2041,"KRN",9.8,"NM",5,0)
GMTSLRSE^^0^B7241630
"BLD",2041,"KRN",9.8,"NM",6,0)
GMTSADH5^^0^B28313479
"BLD",2041,"KRN",9.8,"NM",7,0)
GMTSRM1^^0^B17534919
"BLD",2041,"KRN",9.8,"NM","B","GMTSADH5",6)

"BLD",2041,"KRN",9.8,"NM","B","GMTSLOAD",3)

"BLD",2041,"KRN",9.8,"NM","B","GMTSLRSE",5)

"BLD",2041,"KRN",9.8,"NM","B","GMTSONE",1)

"BLD",2041,"KRN",9.8,"NM","B","GMTSP36",2)

"BLD",2041,"KRN",9.8,"NM","B","GMTSRM1",7)

"BLD",2041,"KRN",9.8,"NM","B","GMTSRN",4)

"BLD",2041,"KRN",19,0)
19
"BLD",2041,"KRN",19.1,0)
19.1
"BLD",2041,"KRN",101,0)
101
"BLD",2041,"KRN",409.61,0)
409.61
"BLD",2041,"KRN",771,0)
771
"BLD",2041,"KRN",869.2,0)
869.2
"BLD",2041,"KRN",870,0)
870
"BLD",2041,"KRN",8994,0)
8994
"BLD",2041,"KRN","B",.4,.4)

"BLD",2041,"KRN","B",.401,.401)

"BLD",2041,"KRN","B",.402,.402)

"BLD",2041,"KRN","B",.403,.403)

"BLD",2041,"KRN","B",.5,.5)

"BLD",2041,"KRN","B",.84,.84)

"BLD",2041,"KRN","B",3.6,3.6)

"BLD",2041,"KRN","B",3.8,3.8)

"BLD",2041,"KRN","B",9.2,9.2)

"BLD",2041,"KRN","B",9.8,9.8)

"BLD",2041,"KRN","B",19,19)

"BLD",2041,"KRN","B",19.1,19.1)

"BLD",2041,"KRN","B",101,101)

"BLD",2041,"KRN","B",409.61,409.61)

"BLD",2041,"KRN","B",771,771)

"BLD",2041,"KRN","B",869.2,869.2)

"BLD",2041,"KRN","B",870,870)

"BLD",2041,"KRN","B",8994,8994)

"BLD",2041,"QUES",0)
^9.62^^
"BLD",2041,"REQB",0)
^9.611^3^3
"BLD",2041,"REQB",1,0)
GMTS*2.7*7^2
"BLD",2041,"REQB",2,0)
GMTS*2.7*28^2
"BLD",2041,"REQB",3,0)
GMTS*2.7*30^2
"BLD",2041,"REQB","B","GMTS*2.7*28",2)

"BLD",2041,"REQB","B","GMTS*2.7*30",3)

"BLD",2041,"REQB","B","GMTS*2.7*7",1)

"INIT")
POST^GMTSP36
"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
36^2991202^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^2991202
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",126,22,1,"PAH",1,1,2,0)
under GMTS*2.7*36.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","GMTSADH5")
0^6^B28313479
"RTN","GMTSADH5",1,0)
GMTSADH5 ; DCM/SLC - Health Summary Ad Hoc RPC's ; 11/19/1999
"RTN","GMTSADH5",2,0)
 ;;2.7;Health Summary;*36*;Oct 20, 1995
"RTN","GMTSADH5",3,0)
 ;                     
"RTN","GMTSADH5",4,0)
COMP(Y) ;Get ADHOC sub components (FILE 142.1)
"RTN","GMTSADH5",5,0)
 ;  Y(i)=(1)I;IFN^(2)Component Name [Abb]^(3)Occ Limit^
"RTN","GMTSADH5",6,0)
 ;     (4)Time Limit^(5)Header Name^(6)Hosp Loc Disp^
"RTN","GMTSADH5",7,0)
 ;     (7)ICD Text Disp^(8)Prov Narr Disp^(9)Summary Order
"RTN","GMTSADH5",8,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",9,0)
 S Y(1)=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0)) ; DBIA #2961
"RTN","GMTSADH5",10,0)
 I 'Y(1) S Y(1)=-1 Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",11,0)
 S (GMTSC,GMTSI)=0,GMTSII=Y(1)
"RTN","GMTSADH5",12,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",13,0)
 . S GMTSIFN=$P(X,"^",2),X1=$G(^GMT(142.1,+GMTSIFN,0))
"RTN","GMTSADH5",14,0)
 . Q:'$L(X1)  Q:$P(X1,"^",6)="P"  S GMTSC=GMTSC+1
"RTN","GMTSADH5",15,0)
 . S Y(GMTSC)=GMTSI_";"_GMTSIFN_"^"_$P(X1,"^")_" ["_$P(X1,"^",4)_"]"_"^"_$S($P(X1,"^",5)="Y":$P(X,"^",3),1:"")
"RTN","GMTSADH5",16,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",3)="Y":$P(X,"^",4),1:"")
"RTN","GMTSADH5",17,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($L($P(X1,"^",9)):$P(X1,"^",9),1:$P(X,"^",5))_"^"_$S($P(X1,"^",10)="Y":$P(X,"^",6),1:"")
"RTN","GMTSADH5",18,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",11)="Y":$P(X,"^",7),1:"")_"^"_$S($P(X1,"^",12)="Y":$P(X,"^",8),1:"")_"^"_$P(X,"^")
"RTN","GMTSADH5",19,0)
 Q
"RTN","GMTSADH5",20,0)
 ;                     
"RTN","GMTSADH5",21,0)
FILES(Y,GMTSCP)   ; Get Files to select from for a component
"RTN","GMTSADH5",22,0)
 Q:'$G(GMTSCP)  Q:'$D(^GMT(142.1,GMTSCP,1))  N GMTSI,GMTSC,X S (GMTSI,GMTSC)=0
"RTN","GMTSADH5",23,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSCP,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0),GMTSC=GMTSC+1,Y(GMTSC)=GMTSI_"^"_$P($G(^DIC(+X,0)),"^")_"^"_X
"RTN","GMTSADH5",24,0)
 Q
"RTN","GMTSADH5",25,0)
 ;                     
"RTN","GMTSADH5",26,0)
FILESEL(GMTSRT,GMTSFI,GMTSFM,DIR) ; Get file entries
"RTN","GMTSADH5",27,0)
 Q:'$G(GMTSFI)
"RTN","GMTSADH5",28,0)
 K ^TMP("ORDATA",$J)
"RTN","GMTSADH5",29,0)
 N GMTSI,GMTSJ,GMTSC,X,GMTSGL,GMTSGLB,GMTSCNT
"RTN","GMTSADH5",30,0)
 S GMTSI=$G(GMTSFM),GMTSCNT=44,GMTSC=0,GMTSRT=$NA(^TMP("ORDATA",$J,1))
"RTN","GMTSADH5",31,0)
 S:'$D(DIR) DIR=1
"RTN","GMTSADH5",32,0)
 I GMTSFI=60 D  Q  ; DBIA #2387
"RTN","GMTSADH5",33,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^LAB(60,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^LAB(60,"B",GMTSI,GMTSJ)) Q:'GMTSJ  D
"RTN","GMTSADH5",34,0)
 . . I $D(^LAB(60,GMTSJ,0)) S X=^(0) I $P(X,"^",4)="CH","BO"[$P(X,"^",3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_X
"RTN","GMTSADH5",35,0)
 I GMTSFI=9999999.64 D  Q  ; DBIA #1989
"RTN","GMTSADH5",36,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^AUTTHF("B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^AUTTHF("B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^AUTTHF(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",37,0)
 . . I $P(X,"^",10)="C",+$P(X,"^",11)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_X
"RTN","GMTSADH5",38,0)
 I GMTSFI=811.9 D  Q
"RTN","GMTSADH5",39,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^PXD(811.9,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^PXD(811.9,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^PXD(811.9,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",40,0)
 . . I $P(X,"^",6)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_X
"RTN","GMTSADH5",41,0)
 I GMTSFI=8925.1 D  Q
"RTN","GMTSADH5",42,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^TIU(8925.1,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^TIU(8925.1,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^TIU(8925.1,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",43,0)
 . . I $P(X,"^",4)="DOC",$$ISA^TIULX(GMTSJ,3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_X
"RTN","GMTSADH5",44,0)
 ;I GMTSFI=81 D  Q
"RTN","GMTSADH5",45,0)
 ;. F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^ICPT("C",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^ICPT("C",GMTSI,GMTSJ)) Q:'GMTSJ   I $D(^ICPT(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",46,0)
 ;. . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_$P(X,"^",2)_" ["_$P(X,"^")_"]"
"RTN","GMTSADH5",47,0)
 I $D(^DIC(GMTSFI,0,"GL")) S GMTSGL=^("GL"),GMTSGL=$S($E(GMTSGL,$L(GMTSGL))=",":$P(GMTSGL,",")_")",1:$E(GMTSGL,1,$L(GMTSGL)-1)),GMTSGLB=^("GL")_"""B"")" D
"RTN","GMTSADH5",48,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(@GMTSGLB@(GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(@GMTSGLB@(GMTSI,GMTSJ)) Q:'GMTSJ  I $D(@GMTSGL@(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",49,0)
 . . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_X
"RTN","GMTSADH5",50,0)
 Q
"RTN","GMTSADH5",51,0)
 ;                     
"RTN","GMTSADH5",52,0)
REPORT(GMTSEG,GMTSEGC,GMTSEGI,GMTSCPS,DFN) ; Build Report
"RTN","GMTSADH5",53,0)
 ; Uses array of Components passed in GMTSCPS()
"RTN","GMTSADH5",54,0)
 ;   GMTSCPS(i)=array of subcomponents chosen,
"RTN","GMTSADH5",55,0)
 ;   value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","GMTSADH5",56,0)
 Q:'$G(DFN)
"RTN","GMTSADH5",57,0)
 N GMTSCNT,DIC,DIZ,DIW,DIWI,DIWT,DIWTC,X,GMTSI,GMTSJ,GMTSK,GMTSTYP,GMTSTITL
"RTN","GMTSADH5",58,0)
 S X="GMTS HS ADHOC",DIC=142,DIZ(0)="ZF" D ^DIC Q:'Y
"RTN","GMTSADH5",59,0)
 S GMTSTYP=+Y,GMTSTITL="AD HOC",(GMTSJ,GMTSI)=0,GMTSEGC=$O(GMTSCPS(99999999),-1)
"RTN","GMTSADH5",60,0)
 F  S GMTSI=$O(GMTSCPS(GMTSI)) Q:'GMTSI  D
"RTN","GMTSADH5",61,0)
 . N GMTSREC,GMTSS2,GMTSSJ,GMTSEL
"RTN","GMTSADH5",62,0)
 . S GMTSREC=^GMT(142,GMTSTYP,1,+GMTSCPS(GMTSI),0),GMTSJ=GMTSJ+1
"RTN","GMTSADH5",63,0)
 . S GMTSEG(GMTSJ)=GMTSREC,GMTSEGI($P(GMTSREC,U,2))=GMTSJ,GMTSS2=0,GMTSSJ=GMTSJ
"RTN","GMTSADH5",64,0)
 . I $L($P(GMTSCPS(GMTSI),"^",2)) S $P(GMTSEG(GMTSJ),"^",3)=$P(GMTSCPS(GMTSI),"^",2)
"RTN","GMTSADH5",65,0)
 . I $L($P(GMTSCPS(GMTSI),"^",3)) S $P(GMTSEG(GMTSJ),"^",4)=$P(GMTSCPS(GMTSI),"^",3)
"RTN","GMTSADH5",66,0)
 . I $L($P(GMTSCPS(GMTSI),"^",4)) S $P(GMTSEG(GMTSJ),"^",5)=$P(GMTSCPS(GMTSI),"^",4)
"RTN","GMTSADH5",67,0)
 . I $L($P(GMTSCPS(GMTSI),"^",5)) S $P(GMTSEG(GMTSJ),"^",6)=$P(GMTSCPS(GMTSI),"^",5)
"RTN","GMTSADH5",68,0)
 . I $L($P(GMTSCPS(GMTSI),"^",6)) S $P(GMTSEG(GMTSJ),"^",7)=$P(GMTSCPS(GMTSI),"^",6)
"RTN","GMTSADH5",69,0)
 . I $L($P(GMTSCPS(GMTSI),"^",7)) S $P(GMTSEG(GMTSJ),"^",8)=$P(GMTSCPS(GMTSI),"^",7)
"RTN","GMTSADH5",70,0)
 . F  S GMTSS2=$O(^GMT(142,GMTSTYP,1,+GMTSCPS(GMTSI),1,GMTSS2)) Q:'GMTSS2  S GMTSEL=^(GMTSS2,0) D
"RTN","GMTSADH5",71,0)
 . . S GMTSEG(GMTSJ,+$P(@(U_$P(GMTSEL,";",2)_"0)"),U,2),GMTSS2)=$P(GMTSEL,";")
"RTN","GMTSADH5",72,0)
 . . I GMTSS2=1 S GMTSEG(GMTSSJ,+$P(@(U_$P(GMTSEL,";",2)_"0)"),U,2),0)=U_$P(GMTSEL,";",2)
"RTN","GMTSADH5",73,0)
 . S (GMTSCNT,GMTSK)=0
"RTN","GMTSADH5",74,0)
 . F  S GMTSK=$O(GMTSCPS(GMTSK)) Q:'GMTSK  I +GMTSCPS(GMTSI)=+GMTSCPS(GMTSK),$P(GMTSCPS(GMTSK),"^",9),$P(GMTSCPS(GMTSK),"^",10) D
"RTN","GMTSADH5",75,0)
 . . S GMTSCNT=GMTSCNT+1,GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),GMTSCNT)=$P(GMTSCPS(GMTSK),"^",10)
"RTN","GMTSADH5",76,0)
 . . K GMTSCPS(GMTSK)
"RTN","GMTSADH5",77,0)
 Q
"RTN","GMTSADH5",78,0)
 ;                     
"RTN","GMTSADH5",79,0)
SUBITEM(Y,GMTSTEST) ; Get Subitems for a Test Panel
"RTN","GMTSADH5",80,0)
 Q:'$G(GMTSTEST)  N GMTSCNT S GMTSCNT=0
"RTN","GMTSADH5",81,0)
 I '$L($P(^LAB(60,GMTSTEST,0),"^",5)),$O(^LAB(60,GMTSTEST,2,0)) D COMPILE(GMTSTEST,GMTSCNT)
"RTN","GMTSADH5",82,0)
 Q
"RTN","GMTSADH5",83,0)
 ;                     
"RTN","GMTSADH5",84,0)
COMPILE(GMTSTEST,GMTSCNT) ; Expand lab panels
"RTN","GMTSADH5",85,0)
 N GMTSI,GMTSJ,GMTSRT S GMTSI=0
"RTN","GMTSADH5",86,0)
 F  S GMTSI=$O(^LAB(60,GMTSTEST,2,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSADH5",87,0)
 . S GMTSJ=+$G(^LAB(60,GMTSTEST,2,+GMTSI,0))
"RTN","GMTSADH5",88,0)
 . S GMTSRT=$G(^LAB(60,+GMTSJ,0))
"RTN","GMTSADH5",89,0)
 . I $L($P(GMTSRT,U,5)),("BO"[$P(GMTSRT,U,3)) D
"RTN","GMTSADH5",90,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",91,0)
 . . S Y(GMTSCNT)=+GMTSJ_"^"_GMTSRT
"RTN","GMTSADH5",92,0)
 . E  D COMPILE(+$G(^LAB(60,GMTSTEST,2,GMTSI,0)),GMTSCNT)
"RTN","GMTSADH5",93,0)
 Q
"RTN","GMTSLOAD")
0^3^B10802906
"RTN","GMTSLOAD",1,0)
GMTSLOAD ;SLC/JER - Loads Ad Hoc Summary Type ; 11/19/1999
"RTN","GMTSLOAD",2,0)
 ;;2.7;Health Summary;**23,30,36**;Oct 20, 1995
"RTN","GMTSLOAD",3,0)
 ;
"RTN","GMTSLOAD",4,0)
MAIN ; Controls branching and execution
"RTN","GMTSLOAD",5,0)
 N DIC,DIROUT,DIRUT,DIR,GMI,GMW,GMTJ,GMTNM,GMTSEG,GMTSFUNC,GMTSI,GMTSIFN,GMTSWHL,INCLUDE,S2,X,Y
"RTN","GMTSLOAD",6,0)
 W !!,"This option rebuilds the Ad Hoc Health Summary to include ALL components",!
"RTN","GMTSLOAD",7,0)
 W "alphabetized by name.  If you wish, you may exclude DISABLED components.",!
"RTN","GMTSLOAD",8,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("?")="Answer ""Y"" or ""N"", ""NO"" to exit this option." D ^DIR Q:Y=0  W !
"RTN","GMTSLOAD",9,0)
 I $S($D(DIRUT):1,$D(DIROUT):1,1:0) Q
"RTN","GMTSLOAD",10,0)
 S DIR("?")="Answer ""Y"" or ""N"", ""YES"" to include DISABLED components."
"RTN","GMTSLOAD",11,0)
 S DIR("A")="Should DISABLED components be included",DIR("B")="YES" D ^DIR
"RTN","GMTSLOAD",12,0)
 I $S($D(DIRUT):1,$D(DIROUT):1,1:0) Q
"RTN","GMTSLOAD",13,0)
 S INCLUDE=Y
"RTN","GMTSLOAD",14,0)
ENPOST ; Entry point from Post-init
"RTN","GMTSLOAD",15,0)
 ; call with INCLUDE=0 to exclude DISABLED components
"RTN","GMTSLOAD",16,0)
 ; call with INCLUDE=1 to include DISABLED components
"RTN","GMTSLOAD",17,0)
 N NEWREC,GMTSTYP,DLAYGO
"RTN","GMTSLOAD",18,0)
 S DLAYGO=142
"RTN","GMTSLOAD",19,0)
 S DIC=142,DIC(0)="LXF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSLOAD",20,0)
 I +Y'>0 D NOFILE Q
"RTN","GMTSLOAD",21,0)
 S (GMTSIFN,GMTSTYP)=+Y,NEWREC=+$P(Y,U,3)
"RTN","GMTSLOAD",22,0)
 S:'$D(^GMT(142,GMTSIFN,1,0)) ^(0)="^142.01IA^0^0"
"RTN","GMTSLOAD",23,0)
 S GMTNM="" F GMI=1:1 S GMTNM=$O(^GMT(142.1,"B",GMTNM)) Q:GMTNM']""  S GMTJ=$O(^(GMTNM,0)) Q:GMTJ'>0  D LOAD
"RTN","GMTSLOAD",24,0)
 S GMTSI=0 I 'NEWREC F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  D PURGE^GMTSRN
"RTN","GMTSLOAD",25,0)
 D BMES^XPDUTL(" Rebuilding Ad Hoc Summary")
"RTN","GMTSLOAD",26,0)
 D RNMBR^GMTSRN
"RTN","GMTSLOAD",27,0)
 D MES^XPDUTL(" Done")
"RTN","GMTSLOAD",28,0)
 Q
"RTN","GMTSLOAD",29,0)
NOFILE ; Handles case where GMTS HS ADHOC OPTION Summary Type is missing
"RTN","GMTSLOAD",30,0)
 D MES^XPDUTL(" ")
"RTN","GMTSLOAD",31,0)
 D BMES^XPDUTL("** GMTS AD HOC OPTION Summary Type is missing **")
"RTN","GMTSLOAD",32,0)
 Q
"RTN","GMTSLOAD",33,0)
LOAD ; Loads GMTSEG(GMI)=SEQUENCE^COMPONENT^OCCURRENCE LIMIT^TIME LIMIT^
"RTN","GMTSLOAD",34,0)
 ;   NULL^HOSP LOC DISPLAYED^ICD TEXT DISPLAYED^PROVIDER NARR DISPLAYED
"RTN","GMTSLOAD",35,0)
 N OCC,TIME,GMSEQ,HOSPLOC,ICDTEXT,PROVNARR
"RTN","GMTSLOAD",36,0)
 Q:'$D(^GMT(142.1,GMTJ,0))
"RTN","GMTSLOAD",37,0)
 S GMSEQ=$O(^GMT(142,"AE",GMTJ,GMTSTYP,0))
"RTN","GMTSLOAD",38,0)
 I GMSEQ>0 D
"RTN","GMTSLOAD",39,0)
 . S OCC=$S($P(^GMT(142.1,GMTJ,0),U,5)="Y":$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,3),1:"")
"RTN","GMTSLOAD",40,0)
 . S TIME=$S($P(^GMT(142.1,GMTJ,0),U,3)="Y":$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,4),1:"")
"RTN","GMTSLOAD",41,0)
 . S HOSPLOC=$S($P(^GMT(142.1,GMTJ,0),U,10)="Y":$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,6),1:"")
"RTN","GMTSLOAD",42,0)
 . S ICDTEXT=$S($P(^GMT(142.1,GMTJ,0),U,11)="Y":$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,7),1:"")
"RTN","GMTSLOAD",43,0)
 . S PROVNARR=$S($P(^GMT(142.1,GMTJ,0),U,12)="Y":$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,8),1:"")
"RTN","GMTSLOAD",44,0)
 E  D
"RTN","GMTSLOAD",45,0)
 . S OCC=$S($P(^GMT(142.1,GMTJ,0),U,5)="Y":10,1:"")
"RTN","GMTSLOAD",46,0)
 . S TIME=$S($P(^GMT(142.1,GMTJ,0),U,3)="Y":"1Y",1:"")
"RTN","GMTSLOAD",47,0)
 . S HOSPLOC=$S($P(^GMT(142.1,GMTJ,0),U,10)="Y":"Y",1:"")
"RTN","GMTSLOAD",48,0)
 . S ICDTEXT=$S($P(^GMT(142.1,GMTJ,0),U,11)="Y":"L",1:"")
"RTN","GMTSLOAD",49,0)
 . S PROVNARR=$S($P(^GMT(142.1,GMTJ,0),U,12)="Y":"Y",1:"")
"RTN","GMTSLOAD",50,0)
 D SETSEG
"RTN","GMTSLOAD",51,0)
 Q
"RTN","GMTSLOAD",52,0)
SETSEG ; Set GMTSEG(GMI)
"RTN","GMTSLOAD",53,0)
 N OFF
"RTN","GMTSLOAD",54,0)
 S OFF=$S($P(^GMT(142.1,GMTJ,0),U,6)="P":1,$P(^(0),U,6)="T":1,1:0)
"RTN","GMTSLOAD",55,0)
 I (INCLUDE=0),(OFF=1) Q
"RTN","GMTSLOAD",56,0)
 S GMTSEG(GMI)=(5*GMI)_U_GMTJ_U_OCC_U_TIME_U_U_HOSPLOC_U_ICDTEXT_U_PROVNARR
"RTN","GMTSLOAD",57,0)
 I GMSEQ>0 D SETSEL
"RTN","GMTSLOAD",58,0)
 Q
"RTN","GMTSLOAD",59,0)
SETSEL ; Sets up selection items in GMTSEG(GMI,GMSEL)=Selection item
"RTN","GMTSLOAD",60,0)
 N GMSEL,GMITEM,GMW,S2
"RTN","GMTSLOAD",61,0)
 S GMSEL=0 F  S GMSEL=$O(^GMT(142,GMTSTYP,1,+GMSEQ,1,GMSEL)) Q:GMSEL'>0  S GMITEM=^(GMSEL,0) S GMTSEG(GMI,GMSEL)=GMITEM
"RTN","GMTSLOAD",62,0)
 Q
"RTN","GMTSLRSE")
0^5^B7241630
"RTN","GMTSLRSE",1,0)
GMTSLRSE ; SLC/JER,KER/NDBI - Selected Lab Test Extract ; 11/19/1999
"RTN","GMTSLRSE",2,0)
 ;;2.7;Health Summary;**28,36**;Oct 20, 1995
"RTN","GMTSLRSE",3,0)
 ;
"RTN","GMTSLRSE",4,0)
XTRCT ; Call with    LRDFN    lab patient
"RTN","GMTSLRSE",5,0)
 ;              GMTS1    begin date
"RTN","GMTSLRSE",6,0)
 ;              GMTS2    end date
"RTN","GMTSLRSE",7,0)
 ;              MAX      occurence limit
"RTN","GMTSLRSE",8,0)
 ;              SEX      "M" or "F"
"RTN","GMTSLRSE",9,0)
 ;              TEST     IFN to ^LAB(60)
"RTN","GMTSLRSE",10,0)
 ;              RWIDTH   optional
"RTN","GMTSLRSE",11,0)
 ;                     
"RTN","GMTSLRSE",12,0)
 ; Returns      ^TMP("LRS",$J,GMTSI,IDRWDT)=
"RTN","GMTSLRSE",13,0)
 ;              DRWDT^SPEC^TEST^RESULT^FLAG^UNIT^LO^HI
"RTN","GMTSLRSE",14,0)
 ;                     
"RTN","GMTSLRSE",15,0)
 ; Where        GMTSI=Order (1 to MAX)
"RTN","GMTSLRSE",16,0)
 ;              IDRWDT=9999999-Draw Date/time
"RTN","GMTSLRSE",17,0)
 ;              DRWDT=Draw Date/Time (internal)
"RTN","GMTSLRSE",18,0)
 ;              SPEC=Specimen (int;ext)
"RTN","GMTSLRSE",19,0)
 ;              TEST=Test (int;ext)
"RTN","GMTSLRSE",20,0)
 ;              RESULT=Numeric Result
"RTN","GMTSLRSE",21,0)
 ;              FLAG=Reference flag (H,*H,L,*L)
"RTN","GMTSLRSE",22,0)
 ;              UNIT=Unit of measure (ext)
"RTN","GMTSLRSE",23,0)
 ;              LO=Reference/Therapeutic Lower bound
"RTN","GMTSLRSE",24,0)
 ;              HI=Ref/Ther Upper Bound
"RTN","GMTSLRSE",25,0)
 ;
"RTN","GMTSLRSE",26,0)
 N CNT,AGE,COM,GMI,X K ^TMP("LRS",$J,GMTSI) I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRSE",27,0)
 D DEM^GMTSU S AGE=GMTSAGE S CNT=0 D CHEM:$P(^LAB(60,TEST,0),U,4)="CH"
"RTN","GMTSLRSE",28,0)
 Q
"RTN","GMTSLRSE",29,0)
CHEM ; Gets all Chemistry tests w/in time/occurrence constraints
"RTN","GMTSLRSE",30,0)
 N PTR,IDRWDT
"RTN","GMTSLRSE",31,0)
 S PTR=+$P($P(^LAB(60,+TEST,0),U,5),";",2)
"RTN","GMTSLRSE",32,0)
 S IDRWDT=GMTS1
"RTN","GMTSLRSE",33,0)
 F  S IDRWDT=$O(^LR(LRDFN,"CH",IDRWDT)) Q:'IDRWDT!(IDRWDT>GMTS2)!(CNT'<MAX)  I $P(^(IDRWDT,0),U,3),($D(^(PTR))) S CNT=CNT+1 D:CNT'>MAX CHSET
"RTN","GMTSLRSE",34,0)
 Q
"RTN","GMTSLRSE",35,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRSE",36,0)
 N RESULT,FLAG,DRWDT,SITE,SPEC,TNM,DESCR,THER,UNIT,HI,LO,GMIDT
"RTN","GMTSLRSE",37,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDRWDT,PTR),U),FLAG=$P(^(PTR),U,2),DRWDT=9999999-IDRWDT
"RTN","GMTSLRSE",38,0)
 S RESULT=$$RESULT^GMTSLRCE(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRSE",39,0)
 S X=DRWDT D REGDTM4^GMTSU S DRWDT=X K X
"RTN","GMTSLRSE",40,0)
 S SITE=$P(^LR(LRDFN,"CH",IDRWDT,0),U,5),SPEC=SITE_";"_$P(^LAB(61,SITE,0),U)
"RTN","GMTSLRSE",41,0)
 S TNM=TEST_";"_$S($L($P(^LAB(60,TEST,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRSE",42,0)
 I $$NDBI^GMTSU,$P($G(^LAB(60,TEST,.1)),"^")]"" S TNM=TNM_";"_$P(^(.1),"^")
"RTN","GMTSLRSE",43,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRSE",44,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRSE",45,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRSE",46,0)
 I $D(^TMP("LRS",$J,GMTSI,IDRWDT)) S GMIDT=IDRWDT+.0001
"RTN","GMTSLRSE",47,0)
 S GMIDT=IDRWDT
"RTN","GMTSLRSE",48,0)
 S ^TMP("LRS",$J,GMTSI,GMIDT)=DRWDT_U_$E(SPEC,1,10)_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRSE",49,0)
 I $D(^LR(LRDFN,"CH",IDRWDT,1,0)) D
"RTN","GMTSLRSE",50,0)
 . S COM=0
"RTN","GMTSLRSE",51,0)
 . F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDRWDT,1,COM)) Q:+COM'>0  S ^TMP("LRS",$J,"C",GMIDT,GMI)=^LR(LRDFN,"CH",IDRWDT,1,COM,0)
"RTN","GMTSLRSE",52,0)
 Q
"RTN","GMTSONE")
0^1^B21969753
"RTN","GMTSONE",1,0)
GMTSONE ;HINES CIOFO/GWB - Oncology Health Summary Comp ; 11/19/1999
"RTN","GMTSONE",2,0)
 ;;2.7;Health Summary;**36**;Oct 20, 1995
"RTN","GMTSONE",3,0)
 ;
"RTN","GMTSONE",4,0)
EXTRACT ; Extract data for patient DFN
"RTN","GMTSONE",5,0)
 K ^UTILITY("DIQ1",$J) Q:'$D(^ONCO(160,"B",DFN_";DPT("))  S PTIEN=$O(^ONCO(160,"B",DFN_";DPT(",0))
"RTN","GMTSONE",6,0)
 S IEN=0 F  S IEN=$O(^ONCO(165.5,"C",PTIEN,IEN)) Q:IEN=""  D
"RTN","GMTSONE",7,0)
 . S DIC="^ONCO(165.5,",DR="3;20;22;24;29;30;37.1;37.2;37.3;38;85;86;87;88;58.1;58.3;58.2;50;51.2;51;442;125;127;128;53.2;53;54.2;54;55.2;55;346;560;91",DA=IEN D EN^DIQ1
"RTN","GMTSONE",8,0)
DISPLAY ; Display extracted data
"RTN","GMTSONE",9,0)
 S IEN=0 F CNT=1:1 S IEN=$O(^UTILITY("DIQ1",$J,165.5,IEN)) Q:IEN=""  D
"RTN","GMTSONE",10,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",11,0)
 . W " #",CNT," Cancer Identification"
"RTN","GMTSONE",12,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",13,0)
 . W !," ------------------------"
"RTN","GMTSONE",14,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",15,0)
 . W !," Date Dx....................: ",^UTILITY("DIQ1",$J,165.5,IEN,3)
"RTN","GMTSONE",16,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",17,0)
 . W !," ICDO-Topography............: ",^UTILITY("DIQ1",$J,165.5,IEN,20)
"RTN","GMTSONE",18,0)
 . I ^UTILITY("DIQ1",$J,165.5,IEN,91)'="Complete" D  Q
"RTN","GMTSONE",19,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",20,0)
 . . W !," Abstract Status............: ",^UTILITY("DIQ1",$J,165.5,IEN,91)
"RTN","GMTSONE",21,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",22,0)
 . . W !!
"RTN","GMTSONE",23,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",24,0)
 . W !," Histology..................: ",^UTILITY("DIQ1",$J,165.5,IEN,22)
"RTN","GMTSONE",25,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",26,0)
 . W !," Grade/Differentiation......: ",^UTILITY("DIQ1",$J,165.5,IEN,24)
"RTN","GMTSONE",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",28,0)
 . W !
"RTN","GMTSONE",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",30,0)
 . W !," #",CNT," Stage of Disease at Diagnosis"
"RTN","GMTSONE",31,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",32,0)
 . W !," --------------------------------"
"RTN","GMTSONE",33,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",34,0)
 . W !," Size of Tumor..............: ",^UTILITY("DIQ1",$J,165.5,IEN,29)
"RTN","GMTSONE",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",36,0)
 . W !," Clincial T.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.1)
"RTN","GMTSONE",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",38,0)
 . W !," Clincial N.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.2)
"RTN","GMTSONE",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",40,0)
 . W !," Clincial M.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.3)
"RTN","GMTSONE",41,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",42,0)
 . W !," Clinical Stage Group.......: ",^UTILITY("DIQ1",$J,165.5,IEN,38)
"RTN","GMTSONE",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",44,0)
 . W !," Pathologic T...............: ",^UTILITY("DIQ1",$J,165.5,IEN,85)
"RTN","GMTSONE",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",46,0)
 . W !," Pathologic N...............: ",^UTILITY("DIQ1",$J,165.5,IEN,86)
"RTN","GMTSONE",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",48,0)
 . W !," Pathologic M...............: ",^UTILITY("DIQ1",$J,165.5,IEN,87)
"RTN","GMTSONE",49,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",50,0)
 . W !," Pathologic Stage Group.....: ",^UTILITY("DIQ1",$J,165.5,IEN,88)
"RTN","GMTSONE",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",52,0)
 . W !
"RTN","GMTSONE",53,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",54,0)
 . W !," #",CNT," First Course of Treatment"
"RTN","GMTSONE",55,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",56,0)
 . W !," ----------------------------"
"RTN","GMTSONE",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",58,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.1) D TXT
"RTN","GMTSONE",59,0)
 . W !," Non cancer-directed surgery: ",^UTILITY("DIQ1",$J,165.5,IEN,58.3)," ",TXT1
"RTN","GMTSONE",60,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",61,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",62,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",63,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.2) D TXT
"RTN","GMTSONE",64,0)
 . W !," Surgery of primary site....: ",^UTILITY("DIQ1",$J,165.5,IEN,50)," ",TXT1
"RTN","GMTSONE",65,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",66,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",68,0)
 . W !," Radiation..................: ",^UTILITY("DIQ1",$J,165.5,IEN,51)," ",^UTILITY("DIQ1",$J,165.5,IEN,51.2)
"RTN","GMTSONE",69,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",70,0)
 . W !," Regional dose:cGy..........: ",^UTILITY("DIQ1",$J,165.5,IEN,442)
"RTN","GMTSONE",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",72,0)
 . W !," Radiation treatment volume.: ",^UTILITY("DIQ1",$J,165.5,IEN,125)
"RTN","GMTSONE",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",74,0)
 . W !," Intent of radiation........: ",^UTILITY("DIQ1",$J,165.5,IEN,127)
"RTN","GMTSONE",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",76,0)
 . W !," Radiation completion status: ",^UTILITY("DIQ1",$J,165.5,IEN,128)
"RTN","GMTSONE",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",78,0)
 . W !," Chemotherapy...............: ",^UTILITY("DIQ1",$J,165.5,IEN,53)," ",^UTILITY("DIQ1",$J,165.5,IEN,53.2)
"RTN","GMTSONE",79,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",80,0)
 . W !," Hormone therapy............: ",^UTILITY("DIQ1",$J,165.5,IEN,54)," ",^UTILITY("DIQ1",$J,165.5,IEN,54.2)
"RTN","GMTSONE",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",82,0)
 . W !," Immunotherapy..............: ",^UTILITY("DIQ1",$J,165.5,IEN,55)," ",^UTILITY("DIQ1",$J,165.5,IEN,55.2)
"RTN","GMTSONE",83,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",84,0)
 . W !," Protocol eligibility status: ",^UTILITY("DIQ1",$J,165.5,IEN,346)
"RTN","GMTSONE",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",86,0)
 . W !," Protocol participation.....: ",^UTILITY("DIQ1",$J,165.5,IEN,560)
"RTN","GMTSONE",87,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",88,0)
 . W !!
"RTN","GMTSONE",89,0)
 K ^UTILITY("DIQ1",$J),CNT,DA,DIC,DR,IEN,LINE,LOS,NOP,PTIEN,TXT,TXT1,TXT2
"RTN","GMTSONE",90,0)
 Q
"RTN","GMTSONE",91,0)
TXT S (TXT1,TXT2)="",LOS=$L($G(TXT)) I LOS<40 S TXT1=$G(TXT) Q
"RTN","GMTSONE",92,0)
 S NOP=$L($E($G(TXT),1,40)," ")
"RTN","GMTSONE",93,0)
 S TXT1=$P($G(TXT)," ",1,NOP-1),TXT2=$P($G(TXT)," ",NOP,999)
"RTN","GMTSONE",94,0)
 Q
"RTN","GMTSP36")
0^2^B56324891
"RTN","GMTSP36",1,0)
GMTSP36 ; SLC/KER - Oncology HS Comp Post-Install        ; 11/19/1999
"RTN","GMTSP36",2,0)
 ;;2.7;Health Summary;**36**;Oct 20, 1995
"RTN","GMTSP36",3,0)
 ;
"RTN","GMTSP36",4,0)
 Q
"RTN","GMTSP36",5,0)
POST ; Post Install
"RTN","GMTSP36",6,0)
 ;                   
"RTN","GMTSP36",7,0)
 ;  GMTSPKR  Minimum Version required for "Active" Component
"RTN","GMTSP36",8,0)
 ;  GMTSPKV  Package Version in UCI
"RTN","GMTSP36",9,0)
 ;  GMTSDAF  Disable Flag  ""=Active/"T"=Temporary/"P"=Permanent
"RTN","GMTSP36",10,0)
 ;  GMTSOOM  Out of Order Message
"RTN","GMTSP36",11,0)
 ;                                      
"RTN","GMTSP36",12,0)
 I +$$VERSION^XPDUTL("GMTS")<2.7 D HSVNF Q
"RTN","GMTSP36",13,0)
 N GMTSPKR,GMTSPKV,GMTSIOK,GMTSDAF,GMTSOOM,GMTSV1,GMTSV2,GMI,GMTJ,GMTNM,GMTSEG,GMTSI,GMTSIFN
"RTN","GMTSP36",14,0)
 S GMTSIOK=1,GMTSV1=$$VERSION^XPDUTL("ONC"),GMTSV2=$$VERSION^XPDUTL("ONCO")
"RTN","GMTSP36",15,0)
 S GMTSPKV=$S(GMTSV1>GMTSV2:GMTSV1,GMTSV2>GMTSV1:GMTSV2,1:GMTSV1)
"RTN","GMTSP36",16,0)
 S GMTSPKR="2.11",GMTSOOM="",GMTSDAF=""
"RTN","GMTSP36",17,0)
 S:+GMTSPKV<GMTSPKR GMTSDAF="T",GMTSOOM="Oncology Component requires v "_GMTSPKR
"RTN","GMTSP36",18,0)
 D ADD(236,"ONCOLOGY","ONC","EXTRACT","GMTSONE",,,,"Oncology",,,GMTSDAF,GMTSOOM,1)
"RTN","GMTSP36",19,0)
 D:GMTSIOK PDX("ONCOLOGY")
"RTN","GMTSP36",20,0)
 Q
"RTN","GMTSP36",21,0)
ADD(GMTSIEN,GMTSNAME,GMTSABBR,GMTSTAG,GMTSRTN,GMTSTIML,GMTSOCCL,GMTSSKEY,GMTSDHDN,GMTSICDT,GMTSPROV,GMTSDAF,GMTSDOOM,GMTSINCL) ; Add Component
"RTN","GMTSP36",22,0)
 ;                 
"RTN","GMTSP36",23,0)
 ;  ADD( )
"RTN","GMTSP36",24,0)
 ;          GMTSIEN   Internal Entry Number File 142.1
"RTN","GMTSP36",25,0)
 ;          GMTSNAME  Component Name
"RTN","GMTSP36",26,0)
 ;          GMTSABBR  Abbreviation
"RTN","GMTSP36",27,0)
 ;          GMTSTAG   Display Routine Tag
"RTN","GMTSP36",28,0)
 ;          GMTSRTN   Display Routine
"RTN","GMTSP36",29,0)
 ;          GMTSTIML  Time Limits Applicable
"RTN","GMTSP36",30,0)
 ;          GMTSOCCL  Occurrence Limits Applicable
"RTN","GMTSP36",31,0)
 ;          GMTSSKEY  Security Key (Component Locking)
"RTN","GMTSP36",32,0)
 ;          GMTSDHDN  Default Header Name
"RTN","GMTSP36",33,0)
 ;          GMTSICDT  ICD Text Applicable
"RTN","GMTSP36",34,0)
 ;          GMTSPROV  Provider Narrative Text Applicable
"RTN","GMTSP36",35,0)
 ;          GMTSDAF   Disable Flag (null, T or P)
"RTN","GMTSP36",36,0)
 ;          GMTSOOM   Out of Order Message
"RTN","GMTSP36",37,0)
 ;          GMTSINCL  Include Disabled in Ad Hoc (1/0)
"RTN","GMTSP36",38,0)
 ;                          
"RTN","GMTSP36",39,0)
 S GMTSNAME=$G(GMTSNAME),GMTSIEN=+($G(GMTSIEN)),GMTSRTN=$G(GMTSRTN)
"RTN","GMTSP36",40,0)
 D:'$L($G(GMTSNAME))!(+($G(GMTSIEN))'>0)!('$L($G(GMTSRTN))) NOTOK
"RTN","GMTSP36",41,0)
 Q:'$L($G(GMTSNAME))  Q:+($G(GMTSIEN))'>0  Q:'$L($G(GMTSRTN))
"RTN","GMTSP36",42,0)
 N DIE,DIK,DA,DR,DIC,DLAYGO,DINUM,X,Y,INCLUDE,GMTS,GMTSROUT,GMTSTAT
"RTN","GMTSP36",43,0)
 S GMTSROUT="",GMTSTAT=$D(^GMT(142.1,+GMTSIEN,0))
"RTN","GMTSP36",44,0)
 S GMTS=+$O(^GMT(142.1,"B",GMTSNAME,0)) D:GMTS=GMTSIEN ALRDY,NOTOK Q:GMTS=GMTSIEN
"RTN","GMTSP36",45,0)
 D INST S GMTSNAME=$$NAME($G(GMTSNAME)) D:'$L($G(GMTSNAME)) NNAME,NOTOK Q:'$L(GMTSNAME)
"RTN","GMTSP36",46,0)
 S GMTSTAG=$G(GMTSTAG),GMTSRTN=$G(GMTSRTN) S GMTSROUT=$$ROUT((GMTSTAG_";"_GMTSRTN))
"RTN","GMTSP36",47,0)
 D:'$L($G(GMTSROUT)) NRTN,NOTOK Q:'$L(GMTSROUT)  S GMTSTIML=$$TIML($G(GMTSTIML))
"RTN","GMTSP36",48,0)
 S GMTSOCCL=$$OCCL($G(GMTSOCCL)) S GMTSABBR=$$ABBR($G(GMTSABBR)) S GMTSSKEY=$$LOCK($G(GMTSSKEY))
"RTN","GMTSP36",49,0)
 S GMTSDHDN=$$DHDN($G(GMTSDHDN)) S GMTSICDT=$$ICDT($G(GMTSICDT))
"RTN","GMTSP36",50,0)
 S GMTSPROV=$$PROV($G(GMTSPROV)) S GMTSDAF=$$DAF($G(GMTSDAF)) S GMTSOOM=$$OOM($G(GMTSOOM))
"RTN","GMTSP36",51,0)
 S:$L(GMTSDAF)&('$L(GMTSOOM)) GMTSOOM="Component "_GMTSNAME_$S(GMTSDAF="T":" Temporarily",GMTSDAF="P":" Permanently",1:"")_" Disabled"
"RTN","GMTSP36",52,0)
 S DINUM=0,(DIC,DLAYGO)=142.1,DIC(0)="NXL",X=GMTSNAME S:'$D(^GMT(142.1,+($G(GMTSIEN)),0)) DINUM=+($G(GMTSIEN)) I +DINUM'>1 D EXIST,NOTOK Q
"RTN","GMTSP36",53,0)
 D ^DIC D:+($G(Y))'>0 FAILED,NOTOK Q:+($G(Y))'>0  S GMTSNAME=$$NAME($G(GMTSNAME)) D:'$L($G(GMTSNAME)) NNAME,NOTOK Q:'$L(GMTSNAME)
"RTN","GMTSP36",54,0)
 S DIE=DIC,DA=+($G(Y)),DR="1///^S X="""_$G(GMTSTAG)_"""_$C(59)_"""_$G(GMTSRTN)_""""
"RTN","GMTSP36",55,0)
 S:$L($G(GMTSTIML)) DR=DR_";2///"_GMTSTIML S:$L($G(GMTSABBR)) DR=DR_";3///"_GMTSABBR S:$L($G(GMTSOCCL)) DR=DR_";4///"_GMTSOCCL
"RTN","GMTSP36",56,0)
 S:$L($G(GMTSDAF)) DR=DR_";5///"_GMTSDAF S:$L($G(GMTSSKEY)) DR=DR_";6///"_GMTSSKEY S:$L($G(GMTSOOM)) DR=DR_";8///"_GMTSOOM
"RTN","GMTSP36",57,0)
 S:$L($G(GMTSDHDN)) DR=DR_";9///"_GMTSDHDN S:$L($G(GMTSICDT)) DR=DR_";11///"_GMTSICDT S:$L($G(GMTSPROV)) DR=DR_";12///"_GMTSPROV
"RTN","GMTSP36",58,0)
 D ^DIE,DES S DIK=DIE D IX^DIK D:GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESE D:'GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESS
"RTN","GMTSP36",59,0)
 I +($G(GMTSINCL)) S INCLUDE=0 D ENPOST^GMTSLOAD
"RTN","GMTSP36",60,0)
 Q
"RTN","GMTSP36",61,0)
PDX(GMTSCOMP,GMTSTIM,GMTSOCC) ; Install PDX Data Segment
"RTN","GMTSP36",62,0)
 ;                    
"RTN","GMTSP36",63,0)
 ;  PDX( )
"RTN","GMTSP36",64,0)
 ;          GMTSCOMP   Component Name (.01 of 142.1)
"RTN","GMTSP36",65,0)
 ;          GMTSTIM    Time Limits Applicable
"RTN","GMTSP36",66,0)
 ;          GMTSOCC    Occurrence Limits Applicable
"RTN","GMTSP36",67,0)
 ;               
"RTN","GMTSP36",68,0)
 N GMTSNAME,GMTSERR,GMTS Q:'$L(GMTSCOMP)
"RTN","GMTSP36",69,0)
 S (GMTS,GMTSERR)="",GMTSTIM=$G(GMTSTIM),GMTSOCC=$G(GMTSOCC),GMTSNAME=$$FIRSTUP^VAQUTL50(GMTSCOMP)
"RTN","GMTSP36",70,0)
 D INSP S GMTS=+$O(^GMT(142.1,"B",GMTSCOMP,0)) I ('GMTS) D NOPDX Q
"RTN","GMTSP36",71,0)
 S GMTSERR=$$ADDSEG^VAQUTL50(GMTS,GMTSTIM,GMTSOCC) I (GMTSERR<0) D PDXER Q
"RTN","GMTSP36",72,0)
 D PDXOK
"RTN","GMTSP36",73,0)
 Q
"RTN","GMTSP36",74,0)
 ; Check Input
"RTN","GMTSP36",75,0)
NAME(X) ;   Check Name (required)
"RTN","GMTSP36",76,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSP36",77,0)
 I $D(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"RTN","GMTSP36",78,0)
 I $L($G(X)),'$D(^GMT(142.1,+($G(Y)),0)) D
"RTN","GMTSP36",79,0)
 . K:$D(^GMT(142.1,"B",X)) X Q:'$D(X)  Q:+($G(Y))'>0  I $P($G(^GMT(142.1,+($G(Y)),0)),"^",1)'=$G(X) K X
"RTN","GMTSP36",80,0)
 S X=$G(X) Q X
"RTN","GMTSP36",81,0)
ROUT(X) ;   Check Routine (required)
"RTN","GMTSP36",82,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSP36",83,0)
 K:$L(X)>17!($L(X)<3)!'(X?1U1.7UN1";"1U1.7UN) X Q:'$D(X) ""
"RTN","GMTSP36",84,0)
 I @("$L($T("_$P(X,";")_"^"_$P(X,";",2)_"))'>0") K X
"RTN","GMTSP36",85,0)
 S X=$G(X) Q X
"RTN","GMTSP36",86,0)
TIML(X) ;   Check Time Limits
"RTN","GMTSP36",87,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSP36",88,0)
ABBR(X) ;   Check Abbreviation
"RTN","GMTSP36",89,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>4!($L(X)<2)!'(X?2.4UN) X="" Q X
"RTN","GMTSP36",90,0)
OCCL(X) ;   Check Occurrence Limits
"RTN","GMTSP36",91,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSP36",92,0)
LOCK(X) ;   Check Lock
"RTN","GMTSP36",93,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>30!($L(X)<1) X="" Q:'$L(X) "" S:'$D(^DIC(19.1,"B",X)) X="" Q X
"RTN","GMTSP36",94,0)
DHDN(X) ;   Check Default Header Name
"RTN","GMTSP36",95,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>20!($L(X)<2) X="" Q X
"RTN","GMTSP36",96,0)
ICDT(X) ;   Check ICD Text Flag
"RTN","GMTSP36",97,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSP36",98,0)
PROV(X) ;   Check Provider Narrative Flag
"RTN","GMTSP36",99,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSP36",100,0)
DAF(X) ;   Check Disable Flag
"RTN","GMTSP36",101,0)
 S X=$G(X) Q:X="T" "T" Q:X="T" "P" Q ""
"RTN","GMTSP36",102,0)
OOM(X) ;   Check Out of Order Message
"RTN","GMTSP36",103,0)
 S X=$G(X) Q:$L(X)<3 "" Q:$L(X)>78 "" Q X
"RTN","GMTSP36",104,0)
 Q
"RTN","GMTSP36",105,0)
 ;              
"RTN","GMTSP36",106,0)
 ; Messages
"RTN","GMTSP36",107,0)
 ;   Health Summary Type messages
"RTN","GMTSP36",108,0)
HSVNF ;     Health Summary Version not found
"RTN","GMTSP36",109,0)
 N GMTST S GMTST="   Health Summary Version 2.7 not found" D BM(GMTST) Q
"RTN","GMTSP36",110,0)
NNAME ;     No Name
"RTN","GMTSP36",111,0)
 N GMTST S GMTST="   No or invalid Health Summary Component name" D BM(GMTST) D NOTI Q
"RTN","GMTSP36",112,0)
NRTN ;     No Routine
"RTN","GMTSP36",113,0)
 N GMTST S GMTST="   No or invalid Health Summary display routine" D BM(GMTST) D NOTI Q
"RTN","GMTSP36",114,0)
INST ;     Installing Component
"RTN","GMTSP36",115,0)
 N GMTST S GMTST=" Filing "_GMTSNAME_" component in HEALTH SUMMARY COMPONENT FILE (#142.1)" D BM(GMTST) Q
"RTN","GMTSP36",116,0)
NOTI ;     Not Installed
"RTN","GMTSP36",117,0)
 N GMTST S GMTST="   Could not install new component" D M(GMTST) Q
"RTN","GMTSP36",118,0)
EXIST ;     DINUMed entry Exist
"RTN","GMTSP36",119,0)
 N GMTST S GMTST="   Can not add component, DINUM'ed entry already exist" D BM(GMTST) Q
"RTN","GMTSP36",120,0)
ALRDY ;     Component Already Installed
"RTN","GMTSP36",121,0)
 N GMTST S GMTST="   "_GMTSNAME_" component has already been installed" D BM(GMTST) S GMTST="   in the HEALTH SUMMARY COMPONENT FILE (#142.1)" D M(GMTST) Q
"RTN","GMTSP36",122,0)
FAILED ;     Failed Installation
"RTN","GMTSP36",123,0)
 N GMTST S GMTST="   Failed to install "_GMTSNAME_" component" D BM(GMTST) Q
"RTN","GMTSP36",124,0)
SCESS ;     Successfully Installed
"RTN","GMTSP36",125,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSP36",126,0)
 N GMTST S GMTST="   Successfully installed the "_GMTSNAME_" component" D BM(GMTST) Q
"RTN","GMTSP36",127,0)
SCESE ;     Successfully Edited
"RTN","GMTSP36",128,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSP36",129,0)
 N GMTST S GMTST="   Successfully edited/updated the "_GMTSNAME_" component" D BM(GMTST) Q
"RTN","GMTSP36",130,0)
DISAB ;
"RTN","GMTSP36",131,0)
 Q:+($G(GMTSIEN))=0  Q:$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)=""
"RTN","GMTSP36",132,0)
 N GMTSF,GMTSM,GMTST S GMTSF=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)
"RTN","GMTSP36",133,0)
 S GMTSF=$S(GMTSF="T":"Temporarily",GMTSF="P":"Permanently",1:"") Q:'$L(GMTSF)
"RTN","GMTSP36",134,0)
 S GMTSD=1,GMTST="",GMTSM=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",8)
"RTN","GMTSP36",135,0)
 S GMTST="   Componet "_GMTSNAME_" is installed, but "_GMTSF_" disabled" D BM(GMTST)
"RTN","GMTSP36",136,0)
 S GMTST="" S:$L(GMTSM) GMTST="   Out of order message:  """_GMTSM_"""" D:$L(GMTST) M(GMTST)
"RTN","GMTSP36",137,0)
 Q
"RTN","GMTSP36",138,0)
 ;   PDX Messages
"RTN","GMTSP36",139,0)
INSP ;     Installing PDX Segment
"RTN","GMTSP36",140,0)
 N GMTST S GMTST=" Filing "_GMTSCOMP_" component in PDX Data Segments" D BM(GMTST) Q
"RTN","GMTSP36",141,0)
NOPDX ;     No PDX Segment Installed
"RTN","GMTSP36",142,0)
 N GMTST S GMTST="   "_GMTSCOMP_" not found in HEALTH SUMMARY COMPONENT file." D BM(GMTST) S GMTST="   "_GMTSNAME_" not added to VAQ - DATA SEGMENT file." D M(GMTST),M("") Q
"RTN","GMTSP36",143,0)
PDXER ;     Error filing PDX Segment
"RTN","GMTSP36",144,0)
 N GMTST S GMTST=$P($G(GMTSERR),"^",2) Q:'$L(GMTST)  S GMTST="   "_GMTST D BM(GMTST),M("") Q
"RTN","GMTSP36",145,0)
PDXOK ;     PDX Segment filled ok
"RTN","GMTSP36",146,0)
 N GMTST S GMTST="   "_GMTSNAME_" added to VAQ - DATA SEGMENT file (#394.71)." D BM(GMTST),M("") Q
"RTN","GMTSP36",147,0)
 ;   Message Lines
"RTN","GMTSP36",148,0)
NOTOK ;     Install is not OK
"RTN","GMTSP36",149,0)
 S:+($G(GMTSIOK))>0 GMTSIOK=0 Q
"RTN","GMTSP36",150,0)
BM(X) ;     Blank Line with Message
"RTN","GMTSP36",151,0)
 D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSP36",152,0)
M(X) ;     Message
"RTN","GMTSP36",153,0)
 D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSP36",154,0)
 ;                    
"RTN","GMTSP36",155,0)
DES ; Description
"RTN","GMTSP36",156,0)
 Q:+($G(GMTSIEN))=0  Q:+($G(DT))=0  Q:'$D(^GMT(142.1,+GMTSIEN,0))
"RTN","GMTSP36",157,0)
SDES ;   Save Description
"RTN","GMTSP36",158,0)
 N GMTSX,GMTSI,GMTST,GMTSC,GMTSHN,GMTSNN,GMTSHD,GMTSH
"RTN","GMTSP36",159,0)
 S GMTSH="^GMT(142.1,"_GMTSIEN_",3.5)",GMTST="",GMTSC=0
"RTN","GMTSP36",160,0)
 F GMTSI=1:1 D  Q:'$L(GMTST)
"RTN","GMTSP36",161,0)
 . S GMTST="" S GMTSX="S GMTST=$T(DEST+"_GMTSI_"^GMTSP36)" X GMTSX S GMTST=$P(GMTST,";",2) Q:'$L(GMTST)
"RTN","GMTSP36",162,0)
 . S GMTSC=GMTSC+1 K:GMTSC=1 @GMTSH S GMTSHN="^GMT(142.1,"_GMTSIEN_",3.5,0)",GMTSHD="^^"_GMTSC_"^"_GMTSC_"^"_DT_"^",GMTSNN="^GMT(142.1,"_GMTSIEN_",3.5,"_GMTSC_",0)"
"RTN","GMTSP36",163,0)
 . S @GMTSHN=GMTSHD,@GMTSNN=GMTST
"RTN","GMTSP36",164,0)
 Q
"RTN","GMTSP36",165,0)
DEST ;   Description Text
"RTN","GMTSP36",166,0)
 ;This component will extract selected data items from the
"RTN","GMTSP36",167,0)
 ;ONCOLOGY PRIMARY file.  
"RTN","GMTSP36",168,0)
 ;;
"RTN","GMTSRM1")
0^7^B17534919
"RTN","GMTSRM1",1,0)
GMTSRM1 ;SLC/JER,DLT - Create/Modify Health Summary (cont'd) ;10/1/92  10:52
"RTN","GMTSRM1",2,0)
 ;;2.7;Health Summary;**7,36**;Oct 20, 1995
"RTN","GMTSRM1",3,0)
 ;
"RTN","GMTSRM1",4,0)
NXTCMP ; Edit, add, or delete components from existing structure
"RTN","GMTSRM1",5,0)
 N CMP,D0,DI,DIC,DIR,OLDSO,SEL,X,Y K DIRUT
"RTN","GMTSRM1",6,0)
 K DUOUT S GMTSQIT=0,GMTSNEW=0
"RTN","GMTSRM1",7,0)
 S DIC="^GMT(142.1,",DIC(0)="AEMQ",D="B",DIC("W")="W ?40,"" "",$P(^(0),U,4)",DIC("A")="Select COMPONENT: ",DIC("S")="I $P(^(0),U,6)'=""P""" S:$D(GMCMP) DIC("B")=$P(^GMT(142.1,+GMCMP,0),U)
"RTN","GMTSRM1",8,0)
 D ^DIC K DIC S:('$D(DTOUT)&('$D(DUOUT))&(Y=-1)) GMTSQIT=2 S:(Y=-1&(X'="^LOOP")) DUOUT=1
"RTN","GMTSRM1",9,0)
 I $D(DUOUT),(X="^LOOP") K DUOUT D LOOP K DUOUT Q
"RTN","GMTSRM1",10,0)
 I $D(DUOUT) Q
"RTN","GMTSRM1",11,0)
 D CHKCMP Q:$D(DUOUT)!(GMTSQIT)!(GMTSQIT="D")
"RTN","GMTSRM1",12,0)
 S DIR(0)="142.01,.01",DIR("B")=+$G(CNT) D ^DIR K DIR K:$D(DUOUT) DUOUT D:'$D(DIRUT) CHKSO^GMTSRM1A Q:$D(DIRUT)!(GMTSQIT)
"RTN","GMTSRM1",13,0)
 D ASKCMP I $D(GMCMP) S DUOUT=""
"RTN","GMTSRM1",14,0)
 Q
"RTN","GMTSRM1",15,0)
LOOP ; Loop through STRUCTURE multiple and call ASKCMP for each
"RTN","GMTSRM1",16,0)
 N GMI,GMJ
"RTN","GMTSRM1",17,0)
 S GMI=0 F  S GMI=$O(^GMT(142,GMTSIFN,1,GMI))  Q:GMI'>0!$D(DUOUT)!+GMTSQIT!(GMTSQIT="D")  D
"RTN","GMTSRM1",18,0)
 . N CMP,DIR,X,Y
"RTN","GMTSRM1",19,0)
 . S CMP=$P(^GMT(142,GMTSIFN,1,GMI,0),U,2),CMP("NM")=$P($G(^GMT(142.1,+CMP,0)),U),CMP(1)=+CMP
"RTN","GMTSRM1",20,0)
 . S CMP(0)=$G(^GMT(142,+GMTSIFN,1,+GMI,0))
"RTN","GMTSRM1",21,0)
 . S CMP(.01)=GMI
"RTN","GMTSRM1",22,0)
 . S GMJ=0 F  S GMJ=$O(^GMT(142,+GMTSIFN,1,+GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSRM1",23,0)
 . . S CMP(142.14,GMJ)=$G(^GMT(142,GMTSIFN,1,GMI,1,GMJ,0))
"RTN","GMTSRM1",24,0)
 . W !!?3,CMP("NM")
"RTN","GMTSRM1",25,0)
 . S (NXTCMP,NXTCMP(0))=NXTCMP+1 D ASKCMP I $D(Y),'$D(DTOUT) D
"RTN","GMTSRM1",26,0)
 . . S DIR(0)="Y",DIR("A")="WANT TO STOP LOOPING",DIR("B")="YES"
"RTN","GMTSRM1",27,0)
 . . D ^DIR K DIR W ! I +Y S GMTSQIT="D" W !!?4,"LOOP ENDED!",!!
"RTN","GMTSRM1",28,0)
 Q
"RTN","GMTSRM1",29,0)
ASKCMP ; Ask parameters for each component
"RTN","GMTSRM1",30,0)
 N IEN,MAXOCC,TIME,OLDLIM,OLDOCC,OLDHEAD,OLDSO,SELCNT,GMTSNCNT
"RTN","GMTSRM1",31,0)
 N HOSP,ICD,PROV,OLDHOSP,OLDICD,OLDPROV
"RTN","GMTSRM1",32,0)
 S MAXOCC=$S($P(^GMT(142.1,CMP(1),0),U,5)="Y":1,1:0)
"RTN","GMTSRM1",33,0)
 S TIME=$S($P(^GMT(142.1,CMP(1),0),U,3)="Y":1,1:0)
"RTN","GMTSRM1",34,0)
 S HOSP=$S($P(^GMT(142.1,CMP(1),0),U,10)="Y":1,1:0)
"RTN","GMTSRM1",35,0)
 S ICD=$S($P(^GMT(142.1,CMP(1),0),U,11)="Y":1,1:0)
"RTN","GMTSRM1",36,0)
 S PROV=$S($P(^GMT(142.1,CMP(1),0),U,12)="Y":1,1:0)
"RTN","GMTSRM1",37,0)
 S OLDOCC=$P(CMP(0),U,3),OLDLIM=$P(CMP(0),U,4)
"RTN","GMTSRM1",38,0)
 S OLDHOSP=$P(CMP(0),U,6),OLDICD=$P(CMP(0),U,7),OLDPROV=$P(CMP(0),U,8)
"RTN","GMTSRM1",39,0)
 S OLDHEAD=$S($L($P(CMP(0),U,5)):$P(CMP(0),U,5),$L($P(^GMT(142.1,+CMP(1),0),U,9)):$P(^(0),U,9),1:"")
"RTN","GMTSRM1",40,0)
 S SEL=$O(^GMT(142.1,CMP(1),1,0))
"RTN","GMTSRM1",41,0)
 I SEL D
"RTN","GMTSRM1",42,0)
 . S SEL(0)=^GMT(142.1,CMP(1),1,SEL,0),SEL=$P(SEL(0),U),SELCNT=$P(SEL(0),U,2)
"RTN","GMTSRM1",43,0)
 . I SEL S DIC("V")="I +Y(0)=SEL",IEN=0,DIC(0)="AEMQ" F  S IEN=$O(CMP(142.14,IEN)) Q:'IEN  D LOADSEL^GMTSRM1A
"RTN","GMTSRM1",44,0)
 I EXISTS=0 S EXISTS=1
"RTN","GMTSRM1",45,0)
 I '$D(^GMT(142,GMTSIFN,1,0)) S ^(0)="^142.01IA^0^0",GMTSNEW=1
"RTN","GMTSRM1",46,0)
 I GMTSNEW D
"RTN","GMTSRM1",47,0)
 . S DR=".01///^S X=CMP(.01);1///^S X=CMP(1);2///^S X=OLDOCC;3///^S X=OLDLIM;6///^S X=OLDHOSP;7///^S X=OLDICD;8///^S X=OLDPROV;"
"RTN","GMTSRM1",48,0)
 E  S DR="1///^S X=CMP(1);"
"RTN","GMTSRM1",49,0)
 S DR=DR_"I MAXOCC=0 S Y=""@1"";2//"_OLDOCC_";@1;I TIME=0 S Y=""@2"";3//"_OLDLIM_";@2;I HOSP=0 S Y=""@3"";6//"_OLDPROV_";@3"
"RTN","GMTSRM1",50,0)
 S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN,DA=CMP(.01) D ^DIE
"RTN","GMTSRM1",51,0)
 Q:$D(Y)
"RTN","GMTSRM1",52,0)
 S DR(2,142.14)=".01;D EXIT^GMTSRM3 I +SELCNT,(GMTSNCNT'<SELCNT) S DTOUT="""""
"RTN","GMTSRM1",53,0)
 S DR="I ICD=0 S Y=""@1"";7//"_OLDICD_";@1;I PROV=0 S Y=""@2"";8//"_OLDPROV_";@2;5//^S X=$G(OLDHEAD);I 'SEL S Y=0;D EN^GMTSRM3;4"
"RTN","GMTSRM1",54,0)
 D ^DIE
"RTN","GMTSRM1",55,0)
 K DIC("V")
"RTN","GMTSRM1",56,0)
 Q
"RTN","GMTSRM1",57,0)
CHKCMP ; Checks selected component for duplication
"RTN","GMTSRM1",58,0)
 N DIR,SEL,SO,SOACTION
"RTN","GMTSRM1",59,0)
 K OLDSO
"RTN","GMTSRM1",60,0)
 S SOACTION="",CMP=+Y,CMP("NM")=$P(Y,U,2),(NXTCMP(0),NXTCMP)=NXTCMP+1
"RTN","GMTSRM1",61,0)
 I '$D(^GMT(142,GMTSIFN,1,"C",+CMP)) D  Q
"RTN","GMTSRM1",62,0)
 . S CMP(1)=+CMP,CNT=$$GETCNT^GMTSRM(GMTSIFN)
"RTN","GMTSRM1",63,0)
 . I +CMP>300,$O(^GMT(142.1,+CMP(1),1,0)),'$D(CMP(142.14)) D GETSEL^GMTSRM1A(.CMP)
"RTN","GMTSRM1",64,0)
 S SO=$O(^GMT(142,GMTSIFN,1,"C",+CMP,0))
"RTN","GMTSRM1",65,0)
 W !,$P(Y,U,2)," is already a component of this summary."
"RTN","GMTSRM1",66,0)
 S DIR(0)="SO^E:Edit component parameters;D:Delete component from summary;"
"RTN","GMTSRM1",67,0)
 S DIR("A")="Select Action"
"RTN","GMTSRM1",68,0)
 D ^DIR K DIR
"RTN","GMTSRM1",69,0)
 I $D(DUOUT) S NXTCMP=NXTCMP-1 Q
"RTN","GMTSRM1",70,0)
 I $D(DIRUT)&('$D(DTOUT)) S GMTSQIT=$S('$D(GMCMP):"D",1:1) W ! Q
"RTN","GMTSRM1",71,0)
 I $D(DIRUT) S GMTSQIT=1 Q
"RTN","GMTSRM1",72,0)
 S OLDSO=SO I Y="D" S SOACTION="D" D DELCMP^GMTSRM4 W ! S GMTSQIT="D" Q
"RTN","GMTSRM1",73,0)
 S SOACTION="E",CMP(1)=+CMP,CNT=SO K Y
"RTN","GMTSRM1",74,0)
 S CMP(0)=^GMT(142,GMTSIFN,1,SO,0)
"RTN","GMTSRM1",75,0)
 S SEL=0 F  S SEL=$O(^GMT(142,GMTSIFN,1,SO,1,SEL)) Q:+SEL'>0  S CMP(142.14,SEL)=^(SEL,0)
"RTN","GMTSRM1",76,0)
 I +CMP>100,$O(^GMT(142.1,+CMP(1),1,0)),'$D(CMP(142.14)) D
"RTN","GMTSRM1",77,0)
 . D GETSEL^GMTSRM1A(.CMP)
"RTN","GMTSRM1",78,0)
 Q
"RTN","GMTSRN")
0^4^B6681602
"RTN","GMTSRN",1,0)
GMTSRN ;SLC/JER - Renumber Selected Health Summary Type ; 11/19/1999
"RTN","GMTSRN",2,0)
 ;;2.7;Health Summary;**36**;Oct 20, 1995
"RTN","GMTSRN",3,0)
 ;
"RTN","GMTSRN",4,0)
MAIN ; Initializes variables and controls branching
"RTN","GMTSRN",5,0)
 N CHANGE,GMTSIFN,GMTSUM,GMTSEG,GMTSI,GMTSJ,GMTSQIT F  D SELECT Q:$D(GMTSQIT)  D COPY,RNMBR:CHANGE W !
"RTN","GMTSRN",6,0)
 Q
"RTN","GMTSRN",7,0)
SELECT ; Calls Reader to select Health Summary Type
"RTN","GMTSRN",8,0)
 N DIR,GMTSKEY,GMTSMGR,GMTSOWN,X,Y
"RTN","GMTSRN",9,0)
 W ! S DIR(0)="PO^142:AEMQZ" D ^DIR K DIR I $D(DIRUT) S GMTSQIT="" Q
"RTN","GMTSRN",10,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2)
"RTN","GMTSRN",11,0)
 S GMTSKEY=$S($P(^GMT(142,GMTSIFN,0),U,2)]"":$P(^(0),U,2),1:" ZZZ"),GMTSOWN=$S($P(^(0),U,3)>0:$P(^(0),U,3),1:DUZ)
"RTN","GMTSRN",12,0)
 S GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,$D(^XUSEC(GMTSKEY,DUZ)):1,GMTSOWN=DUZ:1,1:0)
"RTN","GMTSRN",13,0)
 I GMTSMGR Q
"RTN","GMTSRN",14,0)
 I '$D(^XUSEC(GMTSKEY,DUZ)) W !,$C(7),"This summary is currently locked to prevent alteration.",! S GMTSQIT="" Q
"RTN","GMTSRN",15,0)
 I GMTSOWN'=DUZ W !,$C(7),"Alteration of this summary is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." S GMTSQIT=""
"RTN","GMTSRN",16,0)
 Q
"RTN","GMTSRN",17,0)
COPY ; Copies Structure multiple into GMTSEG(SEQ,
"RTN","GMTSRN",18,0)
 N GMTSI,SEQ K GMTSEG S (CHANGE,GMTSI)=0 I '$D(^GMT(142,GMTSIFN,1,5)) S CHANGE=1
"RTN","GMTSRN",19,0)
 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  W "." I GMTSI#5'=0 S CHANGE=1
"RTN","GMTSRN",20,0)
 I 'CHANGE Q
"RTN","GMTSRN",21,0)
 S (SEQ,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  I $P(^(GMTSI,0),U,2) S SEQ=SEQ+1,GMTSEG(SEQ)=^(0) D GETSEL,PURGE W "."
"RTN","GMTSRN",22,0)
 Q
"RTN","GMTSRN",23,0)
GETSEL ; Gets Selection Items from multiple
"RTN","GMTSRN",24,0)
 N SN S SN=0 F  S SN=$O(^GMT(142,GMTSIFN,1,GMTSI,1,SN)) Q:SN'>0  S GMTSEG(SEQ,SN)=^(SN,0)
"RTN","GMTSRN",25,0)
 Q
"RTN","GMTSRN",26,0)
PURGE ; Deletes old node from ^GMT(142,GMTSIFN,1,GMTSI, using ^DIK
"RTN","GMTSRN",27,0)
 N DA,DIK S DA(1)=GMTSIFN,DA=GMTSI,DIK="^GMT(142,"_GMTSIFN_",1," D ^DIK
"RTN","GMTSRN",28,0)
 Q
"RTN","GMTSRN",29,0)
RNMBR ; Traverses GMTSEG(SEQ) - Resets ^GMT(142,GMTSIFN,1,
"RTN","GMTSRN",30,0)
 N DA,DR,DIE,ISEQ,SEQ,CCT S (CCT,SEQ)=0 F  S SEQ=$O(GMTSEG(SEQ)) Q:SEQ'>0  K DA S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN D LOADCMP^GMTSRM5 S CCT=CCT+1 W:CCT#2=0 "."
"RTN","GMTSRN",31,0)
 Q
"VER")
8.0^22.0
**END**
**END**
