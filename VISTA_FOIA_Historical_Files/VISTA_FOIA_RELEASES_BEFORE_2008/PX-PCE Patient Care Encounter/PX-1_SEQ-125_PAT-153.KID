Released PX*1*153 SEQ #125
Extracted from mail message
**KIDS**:PX*1.0*153^

**INSTALL NAME**
PX*1.0*153
"BLD",5689,0)
PX*1.0*153^PCE PATIENT CARE ENCOUNTER^0^3050624^y
"BLD",5689,1,0)
^^1^1^3050210^
"BLD",5689,1,1,0)
Unable to Check out Encounters
"BLD",5689,4,0)
^9.64PA^^
"BLD",5689,"KRN",0)
^9.67PA^8989.52^19
"BLD",5689,"KRN",.4,0)
.4
"BLD",5689,"KRN",.401,0)
.401
"BLD",5689,"KRN",.402,0)
.402
"BLD",5689,"KRN",.403,0)
.403
"BLD",5689,"KRN",.5,0)
.5
"BLD",5689,"KRN",.84,0)
.84
"BLD",5689,"KRN",3.6,0)
3.6
"BLD",5689,"KRN",3.8,0)
3.8
"BLD",5689,"KRN",9.2,0)
9.2
"BLD",5689,"KRN",9.8,0)
9.8
"BLD",5689,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",5689,"KRN",9.8,"NM",1,0)
PXDELENC^^0^B51555061
"BLD",5689,"KRN",9.8,"NM",3,0)
PXDELFIX^^0^B19162615
"BLD",5689,"KRN",9.8,"NM","B","PXDELENC",1)

"BLD",5689,"KRN",9.8,"NM","B","PXDELFIX",3)

"BLD",5689,"KRN",19,0)
19
"BLD",5689,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5689,"KRN",19,"NM",1,0)
PX DELETE ENCOUNTERS W/O VISIT^^0^
"BLD",5689,"KRN",19,"NM",2,0)
PXTT TABLE MAINTENANCE^^3
"BLD",5689,"KRN",19,"NM","B","PX DELETE ENCOUNTERS W/O VISIT",1)

"BLD",5689,"KRN",19,"NM","B","PXTT TABLE MAINTENANCE",2)

"BLD",5689,"KRN",19.1,0)
19.1
"BLD",5689,"KRN",101,0)
101
"BLD",5689,"KRN",409.61,0)
409.61
"BLD",5689,"KRN",771,0)
771
"BLD",5689,"KRN",870,0)
870
"BLD",5689,"KRN",8989.51,0)
8989.51
"BLD",5689,"KRN",8989.52,0)
8989.52
"BLD",5689,"KRN",8994,0)
8994
"BLD",5689,"KRN","B",.4,.4)

"BLD",5689,"KRN","B",.401,.401)

"BLD",5689,"KRN","B",.402,.402)

"BLD",5689,"KRN","B",.403,.403)

"BLD",5689,"KRN","B",.5,.5)

"BLD",5689,"KRN","B",.84,.84)

"BLD",5689,"KRN","B",3.6,3.6)

"BLD",5689,"KRN","B",3.8,3.8)

"BLD",5689,"KRN","B",9.2,9.2)

"BLD",5689,"KRN","B",9.8,9.8)

"BLD",5689,"KRN","B",19,19)

"BLD",5689,"KRN","B",19.1,19.1)

"BLD",5689,"KRN","B",101,101)

"BLD",5689,"KRN","B",409.61,409.61)

"BLD",5689,"KRN","B",771,771)

"BLD",5689,"KRN","B",870,870)

"BLD",5689,"KRN","B",8989.51,8989.51)

"BLD",5689,"KRN","B",8989.52,8989.52)

"BLD",5689,"KRN","B",8994,8994)

"BLD",5689,"QUES",0)
^9.62^^
"BLD",5689,"REQB",0)
^9.611^^
"KRN",19,6035,-1)
3^2
"KRN",19,6035,0)
PXTT TABLE MAINTENANCE^PCE Table Maintenance^^M^^^^^^^^
"KRN",19,6035,1,0)
^19.06^18^18^3040714^^^^
"KRN",19,6035,1,1,0)
The options on this menu are used to add or edit the clinical
"KRN",19,6035,1,2,0)
terminology used to represent types of data to be collected by PCE such as
"KRN",19,6035,1,3,0)
Health Factors, Patient Education, Immunizations, Skin Tests, etc.
"KRN",19,6035,1,4,0)
 
"KRN",19,6035,1,5,0)
Once these tables have been defined, the table entries will be selectable
"KRN",19,6035,1,6,0)
for encounter data entry (PCE package) and encounter form definitions
"KRN",19,6035,1,7,0)
(AICS package).  The patient information collected based on these table
"KRN",19,6035,1,8,0)
definitions is viewable on Health Summaries (Health Summary package).
"KRN",19,6035,1,9,0)
  
"KRN",19,6035,1,10,0)
This menu also includes options to edit the Clinical Reminder/Health
"KRN",19,6035,1,11,0)
Maintenance definitions, based on your site's clinical terminology in the
"KRN",19,6035,1,12,0)
tables. Once reminder criteria have been defined, they may be included in
"KRN",19,6035,1,13,0)
the Health Summary Type definitions for the "Clinical Reminder" and
"KRN",19,6035,1,14,0)
"Health Maintenance" Components.
"KRN",19,6035,1,15,0)
  
"KRN",19,6035,1,16,0)
These options may be used in conjunction with the "PCE Information Only"
"KRN",19,6035,1,17,0)
menu options to manage the contents of the files or tables supporting
"KRN",19,6035,1,18,0)
the Patient Care Encounter (PCE) package.
"KRN",19,6035,10,0)
^19.01IP^17^11
"KRN",19,6035,10,17,0)
12125^DEWO
"KRN",19,6035,10,17,"^")
PX DELETE ENCOUNTERS W/O VISIT
"KRN",19,6035,99)
59731,50776
"KRN",19,6035,"U")
PCE TABLE MAINTENANCE
"KRN",19,12125,-1)
0^1
"KRN",19,12125,0)
PX DELETE ENCOUNTERS W/O VISIT^PCE Delete Encounters W/O Visit^^R^^^^^^^^PCE PATIENT CARE ENCOUNTER
"KRN",19,12125,1,0)
^19.06^3^3^3040806^^^^
"KRN",19,12125,1,1,0)
This utility will allow the user's to clean up Encounters that point to a 
"KRN",19,12125,1,2,0)
Visit that does not exist. User will then be able to run the Check Out
"KRN",19,12125,1,3,0)
process without problems.
"KRN",19,12125,25)
EN^PXDELENC
"KRN",19,12125,"U")
PCE DELETE ENCOUNTERS W/O VISI
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
153^3050624
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3050624
"PKG",413,22,1,"PAH",1,1,1,0)
Unable to Check out Encounters
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PXDELENC")
0^1^B51555061
"RTN","PXDELENC",1,0)
PXDELENC ;BAY/RJV-CLEAN UP ENCOUNTERS POINTING TO VISITS THAT DO NOT EXIST. ;14-JUN-2005 
"RTN","PXDELENC",2,0)
 ;;1.0;PCE;**153**;14-JUL-2004
"RTN","PXDELENC",3,0)
EN ;Entry Point.
"RTN","PXDELENC",4,0)
 N DIR,DA,ZTRTN,ZTDESC,PXOPT,ZTSK,ZTQUEUED,ZTIO,POP
"RTN","PXDELENC",5,0)
 S DIR("?")="Please enter 1, 2, 3, or 4."
"RTN","PXDELENC",6,0)
 S DIR("?",1)="Please note: Options 1 -3 work directly from the temporary"
"RTN","PXDELENC",7,0)
 S DIR("?",2)="file created by date range under Option 1 - BUILD."
"RTN","PXDELENC",8,0)
 S DIR("?",3)="While Option 4 works with the individual patient selected."
"RTN","PXDELENC",9,0)
 S DIR("?",4)="Option 4 may show different results than the Build Report"
"RTN","PXDELENC",10,0)
 S DIR("?",5)="displays all existing problem encounters by patient."
"RTN","PXDELENC",11,0)
 S DIR("?",6)=""
"RTN","PXDELENC",12,0)
 S DIR(0)="SO^1:BUILD;2:REPORT;3:FIX ALL BUILD ERRORS;4:FIX INDIVIDUAL"
"RTN","PXDELENC",13,0)
 S DIR("L",1)="Select one of the following:"
"RTN","PXDELENC",14,0)
 S DIR("L",2)=""
"RTN","PXDELENC",15,0)
 S DIR("L",3)="1 Build  2 Report  3 Fix All Build Errors  4 Fix Individual"
"RTN","PXDELENC",16,0)
 D ^DIR
"RTN","PXDELENC",17,0)
 S PXOPT=Y
"RTN","PXDELENC",18,0)
 Q:PXOPT=""
"RTN","PXDELENC",19,0)
 K DIR,DA Q:$D(DIRUT)
"RTN","PXDELENC",20,0)
 I PXOPT=1 D ASKBLD
"RTN","PXDELENC",21,0)
 I PXOPT=2 D PRINT
"RTN","PXDELENC",22,0)
 I PXOPT=3 D FIXALL^PXDELFIX
"RTN","PXDELENC",23,0)
 I PXOPT=4 D FIXIND^PXDELFIX
"RTN","PXDELENC",24,0)
 Q
"RTN","PXDELENC",25,0)
ASKBLD ;
"RTN","PXDELENC",26,0)
 N PXPAT,PXSDATE,PXENC,PXVISIT,PXPRIM,PXSTART,PXEND,PXCOUNT,PXSEC,PXPRI
"RTN","PXDELENC",27,0)
 N PXSDT,PXEDT,PXRANGE,PXREM,Y,%,DIRUT,PXPURGE,PXCREATE,X1,X2,PXATYP
"RTN","PXDELENC",28,0)
 D NOW^%DTC S (PXCREATE,X1)=%,X2=120 D C^%DTC S PXPURGE=X
"RTN","PXDELENC",29,0)
 S ^XTMP("PXDELENC",0)=PXPURGE_"^"_PXCREATE
"RTN","PXDELENC",30,0)
 S Y=$G(^XTMP("PXDELENC","START BUILD")) D DD^%DT S PXSTART=Y
"RTN","PXDELENC",31,0)
 S Y=$G(^XTMP("PXDELENC","END BUILD")) D DD^%DT S PXEND=Y
"RTN","PXDELENC",32,0)
 I PXEND="RUNNING" D  Q
"RTN","PXDELENC",33,0)
 .W !!,"Build started on ",PXSTART," still running!"
"RTN","PXDELENC",34,0)
 .D WAIT
"RTN","PXDELENC",35,0)
 S PXSDT=$P($G(^XTMP("PXDELENC","PXENC",0)),"^",1)
"RTN","PXDELENC",36,0)
 S PXEDT=$P($G(^XTMP("PXDELENC","PXENC",0)),"^",2)
"RTN","PXDELENC",37,0)
 S Y=PXSDT D DD^%DT S PXSDT=Y
"RTN","PXDELENC",38,0)
 S Y=PXEDT D DD^%DT S PXEDT=Y
"RTN","PXDELENC",39,0)
 S PXREM=$G(^XTMP("PXDELENC","PXENC","PXCOUNT"))
"RTN","PXDELENC",40,0)
 I PXEND'="" D
"RTN","PXDELENC",41,0)
 .W !!,"Last Build completed on ",PXEND
"RTN","PXDELENC",42,0)
 .W !,"using a date range of ",PXSDT," thru ",PXEDT
"RTN","PXDELENC",43,0)
 .I PXREM>0 W !!,"This build contains ",PXREM," items to be fixed.",!
"RTN","PXDELENC",44,0)
 .I PXREM=0 W !!,"There are 0 remaining items to be fixed.",!
"RTN","PXDELENC",45,0)
 S DIR("A")="Do you wish to continue with NEW Build? "
"RTN","PXDELENC",46,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","PXDELENC",47,0)
 D ^DIR
"RTN","PXDELENC",48,0)
 K DA,DIR Q:$D(DIRUT)
"RTN","PXDELENC",49,0)
 I Y=0 Q
"RTN","PXDELENC",50,0)
ASKBDT ;
"RTN","PXDELENC",51,0)
 S %DT="AEPX",%DT("A")="Enter Begin date for build: "
"RTN","PXDELENC",52,0)
 D ^%DT S PXSDT=Y
"RTN","PXDELENC",53,0)
 I X="^" Q
"RTN","PXDELENC",54,0)
 I Y=-1 W !!,"Invalid Date!",! G ASKBDT
"RTN","PXDELENC",55,0)
 K %DT,Y
"RTN","PXDELENC",56,0)
ASKEDT ;
"RTN","PXDELENC",57,0)
 S %DT="AEPX",%DT("A")="Enter Ending date for build: "
"RTN","PXDELENC",58,0)
 D ^%DT S PXEDT=Y
"RTN","PXDELENC",59,0)
 I X="^" Q
"RTN","PXDELENC",60,0)
 I Y=-1 W !!,"Invalid Date!",! G ASKEDT
"RTN","PXDELENC",61,0)
 K %DT,Y
"RTN","PXDELENC",62,0)
 K ^XTMP("PXDELENC","PXENC")
"RTN","PXDELENC",63,0)
 S $P(^XTMP("PXDELENC","PXENC",0),"^",1)=PXSDT
"RTN","PXDELENC",64,0)
 S $P(^XTMP("PXDELENC","PXENC",0),"^",2)=PXEDT
"RTN","PXDELENC",65,0)
 D CLEAR^VALM1
"RTN","PXDELENC",66,0)
 S ZTRTN="BUILD^PXDELENC"
"RTN","PXDELENC",67,0)
 S ZTDESC="UTILITY TO LOOK FOR MISSING VISITS"
"RTN","PXDELENC",68,0)
 S ZTSAVE("PX*")="",ZTSAVE("XM*")="",ZTIO=""
"RTN","PXDELENC",69,0)
 D ^%ZTLOAD
"RTN","PXDELENC",70,0)
 I $D(ZTSK) W !,"Request Queued!"
"RTN","PXDELENC",71,0)
 D WAIT
"RTN","PXDELENC",72,0)
 Q
"RTN","PXDELENC",73,0)
BUILD ; Build missing visits enconters.
"RTN","PXDELENC",74,0)
 S PXPAT="",PXENC="",PXATYP=""
"RTN","PXDELENC",75,0)
 D NOW^%DTC S PXSTART=%
"RTN","PXDELENC",76,0)
 S ^XTMP("PXDELENC","START BUILD")=PXSTART
"RTN","PXDELENC",77,0)
 S ^XTMP("PXDELENC","END BUILD")="RUNNING"
"RTN","PXDELENC",78,0)
 S ^XTMP("PXDELENC",0)=$$FMADD^XLFDT(PXSTART,60)_"^"_PXSTART
"RTN","PXDELENC",79,0)
 S PXSDATE=PXSDT
"RTN","PXDELENC",80,0)
 F  S PXSDATE=$O(^SCE("B",PXSDATE)) Q:PXSDATE=""!($P(PXSDATE,".")>PXEDT)  D 
"RTN","PXDELENC",81,0)
 .F  S PXENC=$O(^SCE("B",PXSDATE,PXENC)) Q:PXENC=""  D
"RTN","PXDELENC",82,0)
 ..S PXPAT=$P($G(^SCE(PXENC,0)),"^",2)
"RTN","PXDELENC",83,0)
 ..I $G(PXPAT)="" Q
"RTN","PXDELENC",84,0)
 ..S PXATYP=$P($G(^DPT(PXPAT,"S",PXSDATE,0)),"^",2)
"RTN","PXDELENC",85,0)
 ..I PXATYP["C" Q
"RTN","PXDELENC",86,0)
 ..S PXVISIT=$P($G(^SCE(PXENC,0)),"^",5)
"RTN","PXDELENC",87,0)
 ..S PXPRIM=$P($G(^SCE(PXENC,0)),"^",6)
"RTN","PXDELENC",88,0)
 ..S PXSEC="" I $P($G(^SCE(PXENC+1,0)),"^",6)=PXENC S PXSEC=PXENC+1
"RTN","PXDELENC",89,0)
 ..I $G(PXVISIT)'="" Q
"RTN","PXDELENC",90,0)
 ..I $G(PXVISIT)="",$G(PXPRIM)'="" Q
"RTN","PXDELENC",91,0)
 ..I $G(PXVISIT)="",$D(^DPT(PXPAT,"S",PXSDATE,0)) D
"RTN","PXDELENC",92,0)
 ...S ^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC)=$G(PXSEC)
"RTN","PXDELENC",93,0)
 D NOW^%DTC S PXEND=%
"RTN","PXDELENC",94,0)
 S ^XTMP("PXDELENC","PXENC","PXCOUNT")=$$COUNT()
"RTN","PXDELENC",95,0)
 S ^XTMP("PXDELENC","END BUILD")=PXEND
"RTN","PXDELENC",96,0)
 D PXMAIL
"RTN","PXDELENC",97,0)
 Q
"RTN","PXDELENC",98,0)
PRINT ; Print report of missing visits.
"RTN","PXDELENC",99,0)
 N PXPAT,PXENC,PXSDATE,PXPATNM,PXNUMNM,%ZIS,PXSDTE,PXEND,PXPAGE
"RTN","PXDELENC",100,0)
 N PXPRIM,PXPRIX,PXWARN
"RTN","PXDELENC",101,0)
 S PXPAT=0,PXSDATE="",PXENC="",PXEND="",PXPAGE=0,PXWARN=0
"RTN","PXDELENC",102,0)
 I $G(^XTMP("PXDELENC","END BUILD"))="RUNNING" D  Q
"RTN","PXDELENC",103,0)
 .W !!,"Build is running, please wait until complete!"
"RTN","PXDELENC",104,0)
 .D WAIT
"RTN","PXDELENC",105,0)
 I $G(^XTMP("PXDELENC","PXENC","PXCOUNT"))=0 D  Q
"RTN","PXDELENC",106,0)
 .W !!,"No missing visits found!"
"RTN","PXDELENC",107,0)
 .D WAIT
"RTN","PXDELENC",108,0)
 S %ZIS="Q" D ^%ZIS
"RTN","PXDELENC",109,0)
 I POP Q
"RTN","PXDELENC",110,0)
 I $G(IO("Q"))=1 D  Q
"RTN","PXDELENC",111,0)
 .N ZTRTN,ZTDESC,ZTSAVE
"RTN","PXDELENC",112,0)
 .S ZTRTN="PRINT1^PXDELENC",ZTDESC="MISSING VISIT REPORT"
"RTN","PXDELENC",113,0)
 .S ZTSAVE("PX*")=""
"RTN","PXDELENC",114,0)
 .D ^%ZTLOAD K IO("Q")
"RTN","PXDELENC",115,0)
PRINT1 ;
"RTN","PXDELENC",116,0)
 U IO
"RTN","PXDELENC",117,0)
 D HDR
"RTN","PXDELENC",118,0)
 F  S PXPAT=$O(^XTMP("PXDELENC","PXENC",PXPAT)) Q:PXPAT=""!(PXEND)  D
"RTN","PXDELENC",119,0)
 .F  S PXSDATE=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE)) Q:PXSDATE=""!(PXEND)  D
"RTN","PXDELENC",120,0)
 ..F  S PXENC=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC)) Q:PXENC=""!(PXEND)  D
"RTN","PXDELENC",121,0)
 ...S PXPRIX=""
"RTN","PXDELENC",122,0)
 ...S PXSDTE=PXSDATE
"RTN","PXDELENC",123,0)
 ...S Y=PXSDTE D DD^%DT S PXSDTE=Y
"RTN","PXDELENC",124,0)
 ...S PXPATNM=$P($G(^DPT(PXPAT,0)),"^",1)
"RTN","PXDELENC",125,0)
 ...S PXNUMNM=PXPAT_" - "_PXPATNM
"RTN","PXDELENC",126,0)
 ...S PXSEC=$G(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC))
"RTN","PXDELENC",127,0)
 ...I '$D(^SCE(PXENC)),$G(PXSEC)'="" S PXPRIX="*",PXWARN=1
"RTN","PXDELENC",128,0)
 ...W !,?2,$E(PXNUMNM,1,32),?35,PXSDTE,?55,PXENC,?65,$G(PXSEC)_PXPRIX
"RTN","PXDELENC",129,0)
 ...D HDR:$Y+3>IOSL Q:PXEND
"RTN","PXDELENC",130,0)
 I PXWARN D
"RTN","PXDELENC",131,0)
 .W !!,?15,"* Secondary Encounter exists without Primary!"
"RTN","PXDELENC",132,0)
 .W !,?15,"Please note: Secondary Encounters can only be corrected"
"RTN","PXDELENC",133,0)
 .W !,?15,"by the FIX ALL option as the FIX INDIVIDUAL option requires"
"RTN","PXDELENC",134,0)
 .W !,?15,"the Primary Encounter to exist."
"RTN","PXDELENC",135,0)
 D:'PXEND WAIT
"RTN","PXDELENC",136,0)
 W @IOF
"RTN","PXDELENC",137,0)
 D ^%ZISC
"RTN","PXDELENC",138,0)
 Q
"RTN","PXDELENC",139,0)
HDR ;
"RTN","PXDELENC",140,0)
 N PXSDT,PXEDT
"RTN","PXDELENC",141,0)
 S PXSDT=$P($G(^XTMP("PXDELENC","PXENC",0)),"^",1)
"RTN","PXDELENC",142,0)
 S PXEDT=$P($G(^XTMP("PXDELENC","PXENC",0)),"^",2)
"RTN","PXDELENC",143,0)
 S Y=PXSDT D DD^%DT S PXSDT=Y
"RTN","PXDELENC",144,0)
 S Y=PXEDT D DD^%DT S PXEDT=Y
"RTN","PXDELENC",145,0)
 I PXPAGE>0,$E(IOST,1,2)="C-" S PXEND=$$EOP() Q:PXEND
"RTN","PXDELENC",146,0)
 S PXPAGE=PXPAGE+1
"RTN","PXDELENC",147,0)
 W:PXPAGE'=1 @IOF
"RTN","PXDELENC",148,0)
 W !!,"Missing Visit Report for Date Range of ",$G(PXSDT)_" - "_$G(PXEDT),!!
"RTN","PXDELENC",149,0)
 W !,?2,"Patient IEN - Name",?35,"Appt Date",?55,"Prim Enc",?65,"2nd Enc"
"RTN","PXDELENC",150,0)
 W !,?2,"==================",?35,"=========",?55,"========",?65,"======="
"RTN","PXDELENC",151,0)
 Q
"RTN","PXDELENC",152,0)
EOP() ; End of page check
"RTN","PXDELENC",153,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PXDELENC",154,0)
 I $E(IOST,1,2)'="C-" Q 0  ;NOT TERMINAL
"RTN","PXDELENC",155,0)
 S DIR(0)="E"
"RTN","PXDELENC",156,0)
 D ^DIR
"RTN","PXDELENC",157,0)
 Q 'Y
"RTN","PXDELENC",158,0)
PXMAIL ;Send mail message when build complete.
"RTN","PXDELENC",159,0)
 N XMAIL,XMSUB,XMDUZ,XMTEXT,PXTEXT,Y,XMY,XMMG,XMZ
"RTN","PXDELENC",160,0)
 S Y=$G(PXSTART) D DD^%DT S PXSTART=Y
"RTN","PXDELENC",161,0)
 S Y=$G(PXEND) D DD^%DT S PXEND=Y
"RTN","PXDELENC",162,0)
 S Y=$G(PXSDT) D DD^%DT S PXSDT=Y
"RTN","PXDELENC",163,0)
 S Y=$G(PXEDT) D DD^%DT S PXEDT=Y
"RTN","PXDELENC",164,0)
 S ZTQUEUED=1
"RTN","PXDELENC",165,0)
 S PXTEXT(1)="PCE DELETE ENCOUNTER W/O VISIT is ready to report & fix."
"RTN","PXDELENC",166,0)
 S PXTEXT(2)="Build (PXDELENC) for range of "_$G(PXSDT)_"-"_$G(PXEDT)_" has completed"
"RTN","PXDELENC",167,0)
 S PXTEXT(3)="Start time: "_$G(PXSTART)_" End time: "_$G(PXEND)
"RTN","PXDELENC",168,0)
 S XMSUB="PCE Delete Encounters W/O Visit...Build Completed.."
"RTN","PXDELENC",169,0)
 S XMTEXT="PXTEXT(",XMDUZ=.5,XMY(DUZ)=""
"RTN","PXDELENC",170,0)
 D ^XMD
"RTN","PXDELENC",171,0)
 S ^XTMP("PXDELENC","PXENC","PXMAIL")=$G(XMZ)_"^"_DUZ_"^"_$G(XMMG)
"RTN","PXDELENC",172,0)
 K XMSUB,XMTEXT,XMY
"RTN","PXDELENC",173,0)
 Q
"RTN","PXDELENC",174,0)
WAIT ;
"RTN","PXDELENC",175,0)
 Q:IO'=$G(IO("HOME"))
"RTN","PXDELENC",176,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PXDELENC",177,0)
 W ! S DIR(0)="E" S DIR("A")="Enter RETURN to continue" D ^DIR W !
"RTN","PXDELENC",178,0)
 Q
"RTN","PXDELENC",179,0)
COUNT() ;
"RTN","PXDELENC",180,0)
 N PXCOUNT,PXPAT,PXSDATE,PXENC
"RTN","PXDELENC",181,0)
 S PXCOUNT=0,PXPAT="",PXSDATE="",PXENC=""
"RTN","PXDELENC",182,0)
 F  S PXPAT=$O(^XTMP("PXDELENC","PXENC",PXPAT)) Q:PXPAT=""  D
"RTN","PXDELENC",183,0)
 .F  S PXSDATE=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE)) Q:PXSDATE=""  D
"RTN","PXDELENC",184,0)
 ..F  S PXENC=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC)) Q:PXENC=""  D
"RTN","PXDELENC",185,0)
 ...S PXCOUNT=PXCOUNT+1
"RTN","PXDELENC",186,0)
 Q PXCOUNT
"RTN","PXDELENC",187,0)
 ;
"RTN","PXDELFIX")
0^3^B19162615
"RTN","PXDELFIX",1,0)
PXDELFIX ;BAY/RJV-CLEAN ENCOUNTERS POINTING TO VISITS THAT DON'T EXIST PART 2. ;14-JUN-2005 
"RTN","PXDELFIX",2,0)
 ;;1.0;PCE;**153**;14-JUL-2004
"RTN","PXDELFIX",3,0)
 Q
"RTN","PXDELFIX",4,0)
 ;**********************************************************
"RTN","PXDELFIX",5,0)
 ;Two entry points. FIXALL and FIXIND. Called from PXDELENC.
"RTN","PXDELFIX",6,0)
 ;**********************************************************
"RTN","PXDELFIX",7,0)
FIXALL ; Fix all encounters.
"RTN","PXDELFIX",8,0)
 N DA,DIK,PXPAT,PXSDATE,PXENC,PXSEC,PXCOUNT,PXPATNM,Y
"RTN","PXDELFIX",9,0)
 S PXPAT="",PXSDATE="",PXENC=""
"RTN","PXDELFIX",10,0)
 S PXCOUNT=$G(^XTMP("PXDELENC","PXENC","PXCOUNT"))
"RTN","PXDELFIX",11,0)
 I PXCOUNT=0 D  Q
"RTN","PXDELFIX",12,0)
 .W !!,"There are no build entries to correct!"
"RTN","PXDELFIX",13,0)
 .D WAIT^PXDELENC
"RTN","PXDELFIX",14,0)
 I $G(^XTMP("PXDELENC","END BUILD"))="RUNNING" D  Q
"RTN","PXDELFIX",15,0)
 .W !!,"Build is running, please wait until complete!"
"RTN","PXDELFIX",16,0)
 .D WAIT^PXDELENC
"RTN","PXDELFIX",17,0)
 W !!,"There are "_$G(PXCOUNT)_" entries to correct."
"RTN","PXDELFIX",18,0)
 S DIR("A")="Do you wish to continue? "
"RTN","PXDELFIX",19,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","PXDELFIX",20,0)
 D ^DIR Q:$D(DIRUT)
"RTN","PXDELFIX",21,0)
 Q:Y=0
"RTN","PXDELFIX",22,0)
 K DIR,DA,DIRUT
"RTN","PXDELFIX",23,0)
 F  S PXPAT=$O(^XTMP("PXDELENC","PXENC",PXPAT)) Q:PXPAT=""  D
"RTN","PXDELFIX",24,0)
 .F  S PXSDATE=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE)) Q:PXSDATE=""  D
"RTN","PXDELFIX",25,0)
 ..F  S PXENC=$O(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC)) Q:PXENC=""  D
"RTN","PXDELFIX",26,0)
 ...S PXSEC=$G(^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC))
"RTN","PXDELFIX",27,0)
 ...S PXPATNM=$P($G(^DPT(PXPAT,0)),"^",1)
"RTN","PXDELFIX",28,0)
 ...S $P(^DPT(PXPAT,"S",PXSDATE,0),"^",2)="NT"
"RTN","PXDELFIX",29,0)
 ...S $P(^DPT(PXPAT,"S",PXSDATE,0),"^",20)=""
"RTN","PXDELFIX",30,0)
 ...S DIK="^SCE(",DA=PXENC D ^DIK
"RTN","PXDELFIX",31,0)
 ...I $G(PXSEC)'="" S DIK="^SCE(",DA=PXSEC D ^DIK
"RTN","PXDELFIX",32,0)
 ...S PXCOUNT=PXCOUNT-1
"RTN","PXDELFIX",33,0)
 ...K ^XTMP("PXDELENC","PXENC",PXPAT,PXSDATE,PXENC)
"RTN","PXDELFIX",34,0)
 ...W !!,?3,"Encounter: ",?12,$G(PXENC)_" - "_$G(PXPATNM),?45," Fixed!",!
"RTN","PXDELFIX",35,0)
 ...S DA=PXPAT D FIXIHS
"RTN","PXDELFIX",36,0)
 S ^XTMP("PXDELENC","PXENC","PXCOUNT")=PXCOUNT
"RTN","PXDELFIX",37,0)
 D WAIT^PXDELENC
"RTN","PXDELFIX",38,0)
 Q
"RTN","PXDELFIX",39,0)
FIXIND ; Fix individual encounters.
"RTN","PXDELFIX",40,0)
 N PXPAT,PXSDATE,PXSDTE,PXENC,PXVISIT,PXPRIM,PXEXIST,PXCOUNT,DIC,PXSEC,Y
"RTN","PXDELFIX",41,0)
 I $G(^XTMP("PXDELENC","END BUILD"))="RUNNING" D  Q
"RTN","PXDELFIX",42,0)
 .W !!,"Build is running, please wait until complete!"
"RTN","PXDELFIX",43,0)
 .D WAIT^PXDELENC
"RTN","PXDELFIX",44,0)
 S DIC(0)="AEMQ"
"RTN","PXDELFIX",45,0)
 D ^DPTLK I Y=-1 Q
"RTN","PXDELFIX",46,0)
 Q:$D(DIRUT)
"RTN","PXDELFIX",47,0)
 S PXPAT=$P(Y,"^")
"RTN","PXDELFIX",48,0)
 S PXSDATE=0,PXENC="",PXPRIM="",PXSEC="",PXEXIST=0
"RTN","PXDELFIX",49,0)
 S PXCOUNT=$G(^XTMP("PXDELENC","PXENC","PXCOUNT"))
"RTN","PXDELFIX",50,0)
 W !!,"Processing...."
"RTN","PXDELFIX",51,0)
 D HEADER
"RTN","PXDELFIX",52,0)
DISPLAY ;
"RTN","PXDELFIX",53,0)
 F  S PXSDATE=$O(^SCE("ADFN",PXPAT,PXSDATE)) Q:PXSDATE=""!($D(DIRUT))  D  Q:$D(DIRUT)
"RTN","PXDELFIX",54,0)
 .F  S PXENC=$O(^SCE("ADFN",PXPAT,PXSDATE,PXENC)) Q:PXENC=""!($D(DIRUT))  D
"RTN","PXDELFIX",55,0)
 ..S PXVISIT=$P($G(^SCE(PXENC,0)),"^",5)
"RTN","PXDELFIX",56,0)
 ..S PXPRIM=$P($G(^SCE(PXENC,0)),"^",6)
"RTN","PXDELFIX",57,0)
 ..I $G(PXVISIT)'="" Q
"RTN","PXDELFIX",58,0)
 ..I $G(PXPRIM)'="" Q
"RTN","PXDELFIX",59,0)
 ..I $G(PXVISIT)="",$G(PXPRIM)="",$D(^DPT(PXPAT,"S",PXSDATE,0)) D
"RTN","PXDELFIX",60,0)
 ...S Y=PXSDATE D DD^%DT S PXSDTE=Y,PXEXIST=1
"RTN","PXDELFIX",61,0)
 ...S PXPATNM=$P($G(^DPT(PXPAT,0)),"^",1)
"RTN","PXDELFIX",62,0)
 ...W ?3,PXPAT_" - "_PXPATNM,?35,PXSDTE,?55,PXENC,!
"RTN","PXDELFIX",63,0)
 ...S ^XTMP("PXDELENC","FIXIND",PXPAT,PXSDATE,PXENC)=""
"RTN","PXDELFIX",64,0)
 I $G(PXEXIST)=0 G NONE
"RTN","PXDELFIX",65,0)
 S DIR("A")="This will fix all entries for this Patient. Continue? "
"RTN","PXDELFIX",66,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","PXDELFIX",67,0)
 D ^DIR
"RTN","PXDELFIX",68,0)
 G:$D(DIRUT) FIXIND
"RTN","PXDELFIX",69,0)
 K DIR,DA,DIRUT
"RTN","PXDELFIX",70,0)
 I Y=0 G FIXIND
"RTN","PXDELFIX",71,0)
FIX ;
"RTN","PXDELFIX",72,0)
 N PXPAT,PXSDTE,PXENC
"RTN","PXDELFIX",73,0)
 S PXPAT="",PXSDTE="",PXENC=""
"RTN","PXDELFIX",74,0)
 F  S PXPAT=$O(^XTMP("PXDELENC","FIXIND",PXPAT)) Q:PXPAT=""  D
"RTN","PXDELFIX",75,0)
 .F  S PXSDTE=$O(^XTMP("PXDELENC","FIXIND",PXPAT,PXSDTE)) Q:PXSDTE=""  D
"RTN","PXDELFIX",76,0)
 ..F  S PXENC=$O(^XTMP("PXDELENC","FIXIND",PXPAT,PXSDTE,PXENC)) Q:PXENC=""  D
"RTN","PXDELFIX",77,0)
 ...S $P(^DPT(PXPAT,"S",PXSDTE,0),"^",20)=""
"RTN","PXDELFIX",78,0)
 ...S $P(^DPT(PXPAT,"S",PXSDTE,0),"^",2)="NT"
"RTN","PXDELFIX",79,0)
 ...I $P($G(^SCE(PXENC+1,0)),"^",6)=PXENC S PXSEC=PXENC+1
"RTN","PXDELFIX",80,0)
 ...S DIK="^SCE(",DA=PXENC D ^DIK
"RTN","PXDELFIX",81,0)
 ...I $G(PXSEC)'="" S DIK="^SCE(",DA=PXSEC D ^DIK
"RTN","PXDELFIX",82,0)
 ...I $D(^XTMP("PXDELENC","PXENC",PXPAT,PXSDTE,PXENC)) S PXCOUNT=PXCOUNT-1
"RTN","PXDELFIX",83,0)
 ...K ^XTMP("PXDELENC","PXENC",PXPAT,PXSDTE,PXENC)
"RTN","PXDELFIX",84,0)
 ...K ^XTMP("PXDELENC","FIXIND",PXPAT,PXSDTE,PXENC)
"RTN","PXDELFIX",85,0)
 ...W !!,?3,"Encounter: ",?12,$G(PXENC)_" - "_$G(PXPATNM),?45," Fixed!",!
"RTN","PXDELFIX",86,0)
 ...S DA=PXPAT D FIXIHS
"RTN","PXDELFIX",87,0)
 S ^XTMP("PXDELENC","PXENC","PXCOUNT")=PXCOUNT
"RTN","PXDELFIX",88,0)
 Q:$D(DIRUT)
"RTN","PXDELFIX",89,0)
 I PXEXIST=1 D
"RTN","PXDELFIX",90,0)
 .W !!,"No more missing visits to correct for this patient!"
"RTN","PXDELFIX",91,0)
 .D WAIT^PXDELENC
"RTN","PXDELFIX",92,0)
NONE ;
"RTN","PXDELFIX",93,0)
 I PXEXIST=0 D
"RTN","PXDELFIX",94,0)
 .W !!,"No missing visits found for this patient!"
"RTN","PXDELFIX",95,0)
 .D WAIT^PXDELENC
"RTN","PXDELFIX",96,0)
 K ^XTMP("PXDELENC","FIXIND")
"RTN","PXDELFIX",97,0)
 G FIXIND
"RTN","PXDELFIX",98,0)
 Q
"RTN","PXDELFIX",99,0)
HEADER ;
"RTN","PXDELFIX",100,0)
 W !,?3,"Patient IEN - Name",?35,"Appt Date",?55,"Encounter"
"RTN","PXDELFIX",101,0)
 W !,?3,"==================",?35,"=========",?55,"=========",!
"RTN","PXDELFIX",102,0)
 Q
"RTN","PXDELFIX",103,0)
FIXIHS ; Will fix the IHS Patient (9000001) file entries. 
"RTN","PXDELFIX",104,0)
 N PX
"RTN","PXDELFIX",105,0)
 S U="^"
"RTN","PXDELFIX",106,0)
 D CHECK^PXXDPT Q:'$T
"RTN","PXDELFIX",107,0)
 S PX=$P($G(^DPT(DA,0)),U,9)
"RTN","PXDELFIX",108,0)
 D SETSSN^PXXDPT
"RTN","PXDELFIX",109,0)
 K DR,DIE,DA,PXDA
"RTN","PXDELFIX",110,0)
 Q
"RTN","PXDELFIX",111,0)
 ;
"VER")
8.0^22.0
"BLD",5689,6)
^SEQ #125
**END**
**END**
