Released PSB*3*9 SEQ #6
Extracted from mail message
**KIDS**:PSB*3.0*9^

**INSTALL NAME**
PSB*3.0*9
"BLD",4983,0)
PSB*3.0*9^BAR CODE MED ADMIN^0^3050224^y
"BLD",4983,1,0)
^^99^99^3050224^^
"BLD",4983,1,1,0)
 
"BLD",4983,1,2,0)
 1.  Problem: NOIS CTX-0804-70321
"BLD",4983,1,3,0)
     Large volume IV orders do not show on the Due List Report.  The
"BLD",4983,1,4,0)
     Bar Code Medication Administration (BCMA) Due List Report does
"BLD",4983,1,5,0)
     not display information for large volume IV orders that have
"BLD",4983,1,6,0)
     been created on the date selected for reporting.  
"BLD",4983,1,7,0)
 
"BLD",4983,1,8,0)
     Corrective Action:
"BLD",4983,1,9,0)
     The BCMA Due List Report will display large volume IV data when
"BLD",4983,1,10,0)
     appropriate.
"BLD",4983,1,11,0)
 
"BLD",4983,1,12,0)
 
"BLD",4983,1,13,0)
 2.  Problem: NOIS MIW-0504-40557
"BLD",4983,1,14,0)
     Scheduled administration times are reported and totaled on the
"BLD",4983,1,15,0)
     Ward Administration Times Report per each clock hour.  If an
"BLD",4983,1,16,0)
     order s stop time is between clock hours, that order s final
"BLD",4983,1,17,0)
     scheduled administration is neither reported nor added to the
"BLD",4983,1,18,0)
     report totals.
"BLD",4983,1,19,0)
 
"BLD",4983,1,20,0)
     Corrective Action:
"BLD",4983,1,21,0)
     The BCMA Ward Administration Times Report will report and
"BLD",4983,1,22,0)
     total all appropriate scheduled administration times.    
"BLD",4983,1,23,0)
 
"BLD",4983,1,24,0)
 
"BLD",4983,1,25,0)
 3.  Problem: NOIS LIT-0704-71393
"BLD",4983,1,26,0)
     The initial administration of an order which displays on the BCMA
"BLD",4983,1,27,0)
     Graphical User Interface (GUI) Intravenous/Piggyback (IVPB) Tab 
"BLD",4983,1,28,0)
     may result with an administration status of "GIVEN", "HELD", or
"BLD",4983,1,29,0)
     "REFUSED".  When this same order is administered via the VISTA 
"BLD",4983,1,30,0)
     Manual Medication Entry [PSB MED LOG NEW ENTRY] option, the 
"BLD",4983,1,31,0)
     initial administration status can only be "GIVEN".
"BLD",4983,1,32,0)
 
"BLD",4983,1,33,0)
     Corrective Action:
"BLD",4983,1,34,0)
     The Manual Medication Entry [PSB MED LOG NEW ENTRY] option will
"BLD",4983,1,35,0)
     allow the initial administration of an IVPB order to result in
"BLD",4983,1,36,0)
     an administration status of "GIVEN", "HELD", or "REFUSED".
"BLD",4983,1,37,0)
 
"BLD",4983,1,38,0)
 
"BLD",4983,1,39,0)
 4.  Problem: NOIS UNY-0304-10606
"BLD",4983,1,40,0)
     When the user prints a Medication Administration History (MAH)
"BLD",4983,1,41,0)
     report with a date range exceeding seven (7) days, Pro Re Nata
"BLD",4983,1,42,0)
     (PRN) order activity, which occurred that last day of the
"BLD",4983,1,43,0)
     report s date range, does not display.
"BLD",4983,1,44,0)
 
"BLD",4983,1,45,0)
     Corrective Action:
"BLD",4983,1,46,0)
     PRN activity occurring within the selected MAH report date range
"BLD",4983,1,47,0)
     will display on that MAH report.
"BLD",4983,1,48,0)
 
"BLD",4983,1,49,0)
 
"BLD",4983,1,50,0)
 5.  Problem:
"BLD",4983,1,51,0)
     When creating a MAH report, the administration times of orders
"BLD",4983,1,52,0)
     that have start time between the report's date range do not
"BLD",4983,1,53,0)
     display properly.
"BLD",4983,1,54,0)
 
"BLD",4983,1,55,0)
     Corrective Action:
"BLD",4983,1,56,0)
     The MAH report will display order administration times properly.
"BLD",4983,1,57,0)
 
"BLD",4983,1,58,0)
 
"BLD",4983,1,59,0)
 6.  Problem: NOIS ISB-0105-30190
"BLD",4983,1,60,0)
     When using the GUI Edit Med Log to add a comment for an 
"BLD",4983,1,61,0)
     administration having units given less than 1.0, the message - "When 
"BLD",4983,1,62,0)
     changing the admin status to Given, at least one dispensed drug must 
"BLD",4983,1,63,0)
     have a units given ..."  - is displayed and the comment is not filed.
"BLD",4983,1,64,0)
     This error is due to the value in the Units Given field of the GUI
"BLD",4983,1,65,0)
     Edit Med Log being presented without the "leading zero" when the 
"BLD",4983,1,66,0)
     value is less than 1.0.
"BLD",4983,1,67,0)
 
"BLD",4983,1,68,0)
     Corrective Action:
"BLD",4983,1,69,0)
     When the Units Given value of an administration is less than zero, 
"BLD",4983,1,70,0)
     it will be presented via the GUI Edit Med Log with the leading zero.
"BLD",4983,1,71,0)
 
"BLD",4983,1,72,0)
 
"BLD",4983,1,73,0)
 7.  Problem: NOIS ISB-1104-31950
"BLD",4983,1,74,0)
     The Medication History Report does not display a leading zero in
"BLD",4983,1,75,0)
     its "Units GIVEN" data field when display a numerical fraction.
"BLD",4983,1,76,0)
 
"BLD",4983,1,77,0)
     Corrective Action:
"BLD",4983,1,78,0)
     A leading zero will display in the Medication History Report,
"BLD",4983,1,79,0)
     "Units GIVEN" data field when appropriate.
"BLD",4983,1,80,0)
 
"BLD",4983,1,81,0)
 
"BLD",4983,1,82,0)
 8.  Problem: NOIS BUT-1204-21117
"BLD",4983,1,83,0)
     There are instances when the "Units Of Administration" data field
"BLD",4983,1,84,0)
     of the Medication History Report does not "break" and remain legible.
"BLD",4983,1,85,0)
 
"BLD",4983,1,86,0)
     Corrective Action:
"BLD",4983,1,87,0)
     The "Units Of Administration" data field of the Medication History
"BLD",4983,1,88,0)
     Report will "break" and maintain whole words and legibility.
"BLD",4983,1,89,0)
 
"BLD",4983,1,90,0)
 
"BLD",4983,1,91,0)
 9.  Problem: NOIS UNY-0105-11034
"BLD",4983,1,92,0)
     The heading for the Due List Report, "Future Orders" section is 
"BLD",4983,1,93,0)
     displayed and is not followed by "Future Order" data when at least
"BLD",4983,1,94,0)
     one future active order exists, and no future order has a scheduled 
"BLD",4983,1,95,0)
     administration within the selected report time parameters.     
"BLD",4983,1,96,0)
 
"BLD",4983,1,97,0)
     Corrective Action:
"BLD",4983,1,98,0)
     The heading for the Due List Report, "Future Orders" section will not
"BLD",4983,1,99,0)
     display, unless "Future Order" data is to be displayed.
"BLD",4983,4,0)
^9.64PA^^
"BLD",4983,"ABPKG")
n
"BLD",4983,"KRN",0)
^9.67PA^8989.52^19
"BLD",4983,"KRN",.4,0)
.4
"BLD",4983,"KRN",.401,0)
.401
"BLD",4983,"KRN",.402,0)
.402
"BLD",4983,"KRN",.403,0)
.403
"BLD",4983,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",4983,"KRN",.403,"NM",1,0)
PSB NEW IV ENTRY    FILE #53.79^53.79^0
"BLD",4983,"KRN",.403,"NM","B","PSB NEW IV ENTRY    FILE #53.79",1)

"BLD",4983,"KRN",.5,0)
.5
"BLD",4983,"KRN",.84,0)
.84
"BLD",4983,"KRN",3.6,0)
3.6
"BLD",4983,"KRN",3.8,0)
3.8
"BLD",4983,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",9.2,0)
9.2
"BLD",4983,"KRN",9.8,0)
9.8
"BLD",4983,"KRN",9.8,"NM",0)
^9.68A^31^11
"BLD",4983,"KRN",9.8,"NM",21,0)
PSBODL^^0^B83407747
"BLD",4983,"KRN",9.8,"NM",22,0)
PSBODL1^^0^B27682091
"BLD",4983,"KRN",9.8,"NM",23,0)
PSBOMH^^0^B78896723
"BLD",4983,"KRN",9.8,"NM",24,0)
PSBOMH1^^0^B78481809
"BLD",4983,"KRN",9.8,"NM",25,0)
PSBOWA^^0^B46771592
"BLD",4983,"KRN",9.8,"NM",26,0)
PSBML^^0^B78080179
"BLD",4983,"KRN",9.8,"NM",27,0)
PSBMLEN^^0^B69639468
"BLD",4983,"KRN",9.8,"NM",28,0)
PSBMLEN1^^0^B32688222
"BLD",4983,"KRN",9.8,"NM",29,0)
PSBMLLKU^^0^B59536394
"BLD",4983,"KRN",9.8,"NM",30,0)
PSBOPM^^0^B76255661
"BLD",4983,"KRN",9.8,"NM",31,0)
PSBUTL^^0^B72517837
"BLD",4983,"KRN",9.8,"NM","B","PSBML",26)

"BLD",4983,"KRN",9.8,"NM","B","PSBMLEN",27)

"BLD",4983,"KRN",9.8,"NM","B","PSBMLEN1",28)

"BLD",4983,"KRN",9.8,"NM","B","PSBMLLKU",29)

"BLD",4983,"KRN",9.8,"NM","B","PSBODL",21)

"BLD",4983,"KRN",9.8,"NM","B","PSBODL1",22)

"BLD",4983,"KRN",9.8,"NM","B","PSBOMH",23)

"BLD",4983,"KRN",9.8,"NM","B","PSBOMH1",24)

"BLD",4983,"KRN",9.8,"NM","B","PSBOPM",30)

"BLD",4983,"KRN",9.8,"NM","B","PSBOWA",25)

"BLD",4983,"KRN",9.8,"NM","B","PSBUTL",31)

"BLD",4983,"KRN",19,0)
19
"BLD",4983,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",19.1,0)
19.1
"BLD",4983,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",101,0)
101
"BLD",4983,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",409.61,0)
409.61
"BLD",4983,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",771,0)
771
"BLD",4983,"KRN",771,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",870,0)
870
"BLD",4983,"KRN",870,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",8989.51,0)
8989.51
"BLD",4983,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",8989.52,0)
8989.52
"BLD",4983,"KRN",8989.52,"NM",0)
^9.68A^^0
"BLD",4983,"KRN",8994,0)
8994
"BLD",4983,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",4983,"KRN","B",.4,.4)

"BLD",4983,"KRN","B",.401,.401)

"BLD",4983,"KRN","B",.402,.402)

"BLD",4983,"KRN","B",.403,.403)

"BLD",4983,"KRN","B",.5,.5)

"BLD",4983,"KRN","B",.84,.84)

"BLD",4983,"KRN","B",3.6,3.6)

"BLD",4983,"KRN","B",3.8,3.8)

"BLD",4983,"KRN","B",9.2,9.2)

"BLD",4983,"KRN","B",9.8,9.8)

"BLD",4983,"KRN","B",19,19)

"BLD",4983,"KRN","B",19.1,19.1)

"BLD",4983,"KRN","B",101,101)

"BLD",4983,"KRN","B",409.61,409.61)

"BLD",4983,"KRN","B",771,771)

"BLD",4983,"KRN","B",870,870)

"BLD",4983,"KRN","B",8989.51,8989.51)

"BLD",4983,"KRN","B",8989.52,8989.52)

"BLD",4983,"KRN","B",8994,8994)

"BLD",4983,"QUES",0)
^9.62^^
"BLD",4983,"REQB",0)
^9.611^1^1
"BLD",4983,"REQB",1,0)
PSB*3.0*4^2
"BLD",4983,"REQB","B","PSB*3.0*4",1)

"KRN",.403,93,-1)
0^1
"KRN",.403,93,0)
PSB NEW IV ENTRY^^^^2990323.1252^^^53.79^0^0^1
"KRN",.403,93,11)
S PSBSAVE=0
"KRN",.403,93,14)
S PSBSAVE=1
"KRN",.403,93,20)
S PSBSAVE=0
"KRN",.403,93,40,0)
^.4031I^2^2
"KRN",.403,93,40,1,0)
1^^1,1
"KRN",.403,93,40,1,1)
Page 1
"KRN",.403,93,40,1,40,0)
^.4032IP^323^1
"KRN",.403,93,40,1,40,323,0)
PSB NEW IV ENTRY^1^1,1^e
"KRN",.403,93,40,2,0)
2^^5,5^^^1^15,75
"KRN",.403,93,40,2,1)
Page 2
"KRN",.403,93,40,2,40,0)
^.4032IP^325^2
"KRN",.403,93,40,2,40,324,0)
PSB NEW IV ENTRY ADD HDR^1^1,1^d
"KRN",.403,93,40,2,40,325,0)
PSB NEW IV ENTRY ADD^2^4,3^e
"KRN",.403,93,40,2,40,325,2)
3^B^f^1
"KRN",.404,323,0)
PSB NEW IV ENTRY^53.79
"KRN",.404,323,40,0)
^.4044I^13^13
"KRN",.404,323,40,1,0)
4^^3
"KRN",.404,323,40,1,1)
.01
"KRN",.404,323,40,1,2)
4,16^30
"KRN",.404,323,40,1,4)
0^^^1
"KRN",.404,323,40,2,0)
1^Medication Log Manual Entry - IV Order^1
"KRN",.404,323,40,2,2)
^^1,1
"KRN",.404,323,40,3,0)
2^!M^1
"KRN",.404,323,40,3,.1)
S Y=$TR($J("",IOM)," ","-")
"KRN",.404,323,40,3,2)
^^2,1
"KRN",.404,323,40,4,0)
5^!M^1
"KRN",.404,323,40,4,.1)
S Y="SSN: "_$$GET1^DIQ(2,$P(^PSB(53.79,DA,0),U)_",",.09)
"KRN",.404,323,40,4,2)
^^4,47
"KRN",.404,323,40,5,0)
7^Admin Status^3
"KRN",.404,323,40,5,1)
.09
"KRN",.404,323,40,5,2)
7,18^7^7,2
"KRN",.404,323,40,5,3)
!M
"KRN",.404,323,40,5,3.1)
S:$G(PSBMMEN)=1 Y="GIVEN"
"KRN",.404,323,40,5,4)
^^^0
"KRN",.404,323,40,5,14)
D:$G(PSBMMEN) VALID^PSBMLEN
"KRN",.404,323,40,6,0)
8^Admin Date/Time^3
"KRN",.404,323,40,6,1)
.06
"KRN",.404,323,40,6,2)
7,44^20^7,27
"KRN",.404,323,40,6,4)
1
"KRN",.404,323,40,6,14)
D FDATE^PSBMLEN1
"KRN",.404,323,40,7,0)
10^PRN Reason^3
"KRN",.404,323,40,7,1)
.21
"KRN",.404,323,40,7,2)
10,22^58^10,2
"KRN",.404,323,40,8,0)
11^PRN Effectiveness^3
"KRN",.404,323,40,8,1)
.22
"KRN",.404,323,40,8,2)
11,22^58^11,2
"KRN",.404,323,40,9,0)
13^Comment (Required)^2
"KRN",.404,323,40,9,2)
16,2^78^15,2
"KRN",.404,323,40,9,4)
1
"KRN",.404,323,40,9,20)
F^^1:150
"KRN",.404,323,40,9,23)
D COMMENT^PSBML(DA,X)
"KRN",.404,323,40,10,0)
6^Medication^3
"KRN",.404,323,40,10,1)
.08
"KRN",.404,323,40,10,2)
5,16^40^5,2
"KRN",.404,323,40,10,4)
^^^1
"KRN",.404,323,40,11,0)
3^Patient:^1
"KRN",.404,323,40,11,2)
^^4,2
"KRN",.404,323,40,12,0)
9^Injection Site^3
"KRN",.404,323,40,12,1)
.16
"KRN",.404,323,40,12,2)
8,18^30^8,2
"KRN",.404,323,40,13,0)
12^Additives...^2
"KRN",.404,323,40,13,2)
13,17^1^13,2^1
"KRN",.404,323,40,13,7)
^2
"KRN",.404,323,40,13,20)
F^^1:1
"KRN",.404,324,0)
PSB NEW IV ENTRY ADD HDR^53.79^
"KRN",.404,324,40,0)
^.4044I^3^3
"KRN",.404,324,40,1,0)
1^ Additives ^1
"KRN",.404,324,40,1,2)
^^1,2
"KRN",.404,324,40,2,0)
2^Additives                        Order   Given  Units^1
"KRN",.404,324,40,2,2)
^^3,3
"KRN",.404,324,40,3,0)
3^Units   Units^1
"KRN",.404,324,40,3,2)
^^2,36
"KRN",.404,325,0)
PSB NEW IV ENTRY ADD^53.796
"KRN",.404,325,40,0)
^.4044I^4^4
"KRN",.404,325,40,1,0)
1^^3
"KRN",.404,325,40,1,1)
.01
"KRN",.404,325,40,1,2)
1,1^30
"KRN",.404,325,40,1,4)
^^^1
"KRN",.404,325,40,2,0)
2^^3
"KRN",.404,325,40,2,1)
.02
"KRN",.404,325,40,2,2)
1,33^6
"KRN",.404,325,40,2,4)
^^1^1
"KRN",.404,325,40,3,0)
3^^3
"KRN",.404,325,40,3,1)
.03
"KRN",.404,325,40,3,2)
1,41^6
"KRN",.404,325,40,3,4)
1^^1
"KRN",.404,325,40,4,0)
4^^3
"KRN",.404,325,40,4,1)
.04
"KRN",.404,325,40,4,2)
1,49^10
"KRN",.404,325,40,4,4)
1
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^0
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040318^11874
"PKG",536,22,1,"PAH",1,0)
9^3050224^10000000035
"PKG",536,22,1,"PAH",1,1,0)
^^99^99^3050224
"PKG",536,22,1,"PAH",1,1,1,0)
 
"PKG",536,22,1,"PAH",1,1,2,0)
 1.  Problem: NOIS CTX-0804-70321
"PKG",536,22,1,"PAH",1,1,3,0)
     Large volume IV orders do not show on the Due List Report.  The
"PKG",536,22,1,"PAH",1,1,4,0)
     Bar Code Medication Administration (BCMA) Due List Report does
"PKG",536,22,1,"PAH",1,1,5,0)
     not display information for large volume IV orders that have
"PKG",536,22,1,"PAH",1,1,6,0)
     been created on the date selected for reporting.  
"PKG",536,22,1,"PAH",1,1,7,0)
 
"PKG",536,22,1,"PAH",1,1,8,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,9,0)
     The BCMA Due List Report will display large volume IV data when
"PKG",536,22,1,"PAH",1,1,10,0)
     appropriate.
"PKG",536,22,1,"PAH",1,1,11,0)
 
"PKG",536,22,1,"PAH",1,1,12,0)
 
"PKG",536,22,1,"PAH",1,1,13,0)
 2.  Problem: NOIS MIW-0504-40557
"PKG",536,22,1,"PAH",1,1,14,0)
     Scheduled administration times are reported and totaled on the
"PKG",536,22,1,"PAH",1,1,15,0)
     Ward Administration Times Report per each clock hour.  If an
"PKG",536,22,1,"PAH",1,1,16,0)
     order s stop time is between clock hours, that order s final
"PKG",536,22,1,"PAH",1,1,17,0)
     scheduled administration is neither reported nor added to the
"PKG",536,22,1,"PAH",1,1,18,0)
     report totals.
"PKG",536,22,1,"PAH",1,1,19,0)
 
"PKG",536,22,1,"PAH",1,1,20,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,21,0)
     The BCMA Ward Administration Times Report will report and
"PKG",536,22,1,"PAH",1,1,22,0)
     total all appropriate scheduled administration times.    
"PKG",536,22,1,"PAH",1,1,23,0)
 
"PKG",536,22,1,"PAH",1,1,24,0)
 
"PKG",536,22,1,"PAH",1,1,25,0)
 3.  Problem: NOIS LIT-0704-71393
"PKG",536,22,1,"PAH",1,1,26,0)
     The initial administration of an order which displays on the BCMA
"PKG",536,22,1,"PAH",1,1,27,0)
     Graphical User Interface (GUI) Intravenous/Piggyback (IVPB) Tab 
"PKG",536,22,1,"PAH",1,1,28,0)
     may result with an administration status of "GIVEN", "HELD", or
"PKG",536,22,1,"PAH",1,1,29,0)
     "REFUSED".  When this same order is administered via the VISTA 
"PKG",536,22,1,"PAH",1,1,30,0)
     Manual Medication Entry [PSB MED LOG NEW ENTRY] option, the 
"PKG",536,22,1,"PAH",1,1,31,0)
     initial administration status can only be "GIVEN".
"PKG",536,22,1,"PAH",1,1,32,0)
 
"PKG",536,22,1,"PAH",1,1,33,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,34,0)
     The Manual Medication Entry [PSB MED LOG NEW ENTRY] option will
"PKG",536,22,1,"PAH",1,1,35,0)
     allow the initial administration of an IVPB order to result in
"PKG",536,22,1,"PAH",1,1,36,0)
     an administration status of "GIVEN", "HELD", or "REFUSED".
"PKG",536,22,1,"PAH",1,1,37,0)
 
"PKG",536,22,1,"PAH",1,1,38,0)
 
"PKG",536,22,1,"PAH",1,1,39,0)
 4.  Problem: NOIS UNY-0304-10606
"PKG",536,22,1,"PAH",1,1,40,0)
     When the user prints a Medication Administration History (MAH)
"PKG",536,22,1,"PAH",1,1,41,0)
     report with a date range exceeding seven (7) days, Pro Re Nata
"PKG",536,22,1,"PAH",1,1,42,0)
     (PRN) order activity, which occurred that last day of the
"PKG",536,22,1,"PAH",1,1,43,0)
     report s date range, does not display.
"PKG",536,22,1,"PAH",1,1,44,0)
 
"PKG",536,22,1,"PAH",1,1,45,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,46,0)
     PRN activity occurring within the selected MAH report date range
"PKG",536,22,1,"PAH",1,1,47,0)
     will display on that MAH report.
"PKG",536,22,1,"PAH",1,1,48,0)
 
"PKG",536,22,1,"PAH",1,1,49,0)
 
"PKG",536,22,1,"PAH",1,1,50,0)
 5.  Problem:
"PKG",536,22,1,"PAH",1,1,51,0)
     When creating a MAH report, the administration times of orders
"PKG",536,22,1,"PAH",1,1,52,0)
     that have start time between the report's date range do not
"PKG",536,22,1,"PAH",1,1,53,0)
     display properly.
"PKG",536,22,1,"PAH",1,1,54,0)
 
"PKG",536,22,1,"PAH",1,1,55,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,56,0)
     The MAH report will display order administration times properly.
"PKG",536,22,1,"PAH",1,1,57,0)
 
"PKG",536,22,1,"PAH",1,1,58,0)
 
"PKG",536,22,1,"PAH",1,1,59,0)
 6.  Problem: NOIS ISB-0105-30190
"PKG",536,22,1,"PAH",1,1,60,0)
     When using the GUI Edit Med Log to add a comment for an 
"PKG",536,22,1,"PAH",1,1,61,0)
     administration having units given less than 1.0, the message - "When 
"PKG",536,22,1,"PAH",1,1,62,0)
     changing the admin status to Given, at least one dispensed drug must 
"PKG",536,22,1,"PAH",1,1,63,0)
     have a units given ..."  - is displayed and the comment is not filed.
"PKG",536,22,1,"PAH",1,1,64,0)
     This error is due to the value in the Units Given field of the GUI
"PKG",536,22,1,"PAH",1,1,65,0)
     Edit Med Log being presented without the "leading zero" when the 
"PKG",536,22,1,"PAH",1,1,66,0)
     value is less than 1.0.
"PKG",536,22,1,"PAH",1,1,67,0)
 
"PKG",536,22,1,"PAH",1,1,68,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,69,0)
     When the Units Given value of an administration is less than zero, 
"PKG",536,22,1,"PAH",1,1,70,0)
     it will be presented via the GUI Edit Med Log with the leading zero.
"PKG",536,22,1,"PAH",1,1,71,0)
 
"PKG",536,22,1,"PAH",1,1,72,0)
 
"PKG",536,22,1,"PAH",1,1,73,0)
 7.  Problem: NOIS ISB-1104-31950
"PKG",536,22,1,"PAH",1,1,74,0)
     The Medication History Report does not display a leading zero in
"PKG",536,22,1,"PAH",1,1,75,0)
     its "Units GIVEN" data field when display a numerical fraction.
"PKG",536,22,1,"PAH",1,1,76,0)
 
"PKG",536,22,1,"PAH",1,1,77,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,78,0)
     A leading zero will display in the Medication History Report,
"PKG",536,22,1,"PAH",1,1,79,0)
     "Units GIVEN" data field when appropriate.
"PKG",536,22,1,"PAH",1,1,80,0)
 
"PKG",536,22,1,"PAH",1,1,81,0)
 
"PKG",536,22,1,"PAH",1,1,82,0)
 8.  Problem: NOIS BUT-1204-21117
"PKG",536,22,1,"PAH",1,1,83,0)
     There are instances when the "Units Of Administration" data field
"PKG",536,22,1,"PAH",1,1,84,0)
     of the Medication History Report does not "break" and remain legible.
"PKG",536,22,1,"PAH",1,1,85,0)
 
"PKG",536,22,1,"PAH",1,1,86,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,87,0)
     The "Units Of Administration" data field of the Medication History
"PKG",536,22,1,"PAH",1,1,88,0)
     Report will "break" and maintain whole words and legibility.
"PKG",536,22,1,"PAH",1,1,89,0)
 
"PKG",536,22,1,"PAH",1,1,90,0)
 
"PKG",536,22,1,"PAH",1,1,91,0)
 9.  Problem: NOIS UNY-0105-11034
"PKG",536,22,1,"PAH",1,1,92,0)
     The heading for the Due List Report, "Future Orders" section is 
"PKG",536,22,1,"PAH",1,1,93,0)
     displayed and is not followed by "Future Order" data when at least
"PKG",536,22,1,"PAH",1,1,94,0)
     one future active order exists, and no future order has a scheduled 
"PKG",536,22,1,"PAH",1,1,95,0)
     administration within the selected report time parameters.     
"PKG",536,22,1,"PAH",1,1,96,0)
 
"PKG",536,22,1,"PAH",1,1,97,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,98,0)
     The heading for the Due List Report, "Future Orders" section will not
"PKG",536,22,1,"PAH",1,1,99,0)
     display, unless "Future Order" data is to be displayed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","PSBML")
0^26^B78080179
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ;Mar 2004
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9**;Mar 2004
"RTN","PSBML",3,0)
 ;
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
RPC(RESULTS,PSBHDR,PSBREC) ; BCMA Filing Point
"RTN","PSBML",14,0)
 ; RPC: PSB TRANSACTION
"RTN","PSBML",15,0)
 ; ONLY Place in ALL BCMA an
"RTN","PSBML",16,0)
 ; entry into the MED LOG is made.
"RTN","PSBML",17,0)
 ;
"RTN","PSBML",18,0)
 S PSBEDTFL=0
"RTN","PSBML",19,0)
 N PSBORD,PSBTRAN,PSBFDA
"RTN","PSBML",20,0)
 K PSBIEN,PSBHL7
"RTN","PSBML",21,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",22,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",23,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",24,0)
 S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",25,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",26,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",27,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",28,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",29,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",30,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",31,0)
 I PSBTRAN="UPDATE STATUS" D UPDATED^PSBML2 Q
"RTN","PSBML",32,0)
 I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",33,0)
 ; SAGG track
"RTN","PSBML",34,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",35,0)
 ;  MedPass
"RTN","PSBML",36,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",37,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",38,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",39,0)
 D:PSBTRAN="MEDPASS"
"RTN","PSBML",40,0)
 .I (PSBDOSEF["PATCH"),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",41,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",42,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") S RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled." Q
"RTN","PSBML",43,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;Med Ord buttn admin time
"RTN","PSBML",44,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",45,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",46,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",47,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",48,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",49,0)
 .; On-Call
"RTN","PSBML",50,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",51,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",52,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",53,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",54,0)
 .; 1 Time
"RTN","PSBML",55,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",56,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",57,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",58,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",59,0)
 .; Prn
"RTN","PSBML",60,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",61,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",62,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",63,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",64,0)
 .; C Schd
"RTN","PSBML",65,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",66,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order MUST have admin time")
"RTN","PSBML",67,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",68,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",69,0)
 ..N PSBDTX S PSBDTX=$O(^PSB(53.79,"AORDX",PSBREC(0),PSBREC(1),""),-1)   ; Latest Action/Order Date
"RTN","PSBML",70,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORDX",PSBREC(0),PSBREC(1),PSBDTX,""),-1)    ; Last Action/Order
"RTN","PSBML",71,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",72,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",73,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",74,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",75,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",76,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",77,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",78,0)
 .; Non-Givn Stats
"RTN","PSBML",79,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",80,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comments Required if Not Marked Given")
"RTN","PSBML",81,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comments Required if Not Marked Completed")
"RTN","PSBML",82,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7) ; Updt Commnt
"RTN","PSBML",83,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ; Updt Commnt
"RTN","PSBML",84,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ; Updt Commnt
"RTN","PSBML",85,0)
 .; Valid ?
"RTN","PSBML",86,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1   ; "not given" - UPDATE not CREATE
"RTN","PSBML",87,0)
 .D:PSBIEN="+1"  ; New entry?
"RTN","PSBML",88,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0)) ; Pt IEN
"RTN","PSBML",89,0)
 ..S X=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101)) ;Wrd/RmBed
"RTN","PSBML",90,0)
 ..D VAL(53.79,PSBIEN,.02,X) ; Pt Locatn
"RTN","PSBML",91,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",92,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",93,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1)) ; Div.
"RTN","PSBML",94,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW) ;  Entrd DT
"RTN","PSBML",95,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ) ; Entrd By
"RTN","PSBML",96,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW) ;  Admn D/T
"RTN","PSBML",97,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ) ; Admn By
"RTN","PSBML",98,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4)) ; Ordbl Item
"RTN","PSBML",99,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1)) ;  Ord Type;IEN
"RTN","PSBML",100,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2)) ;  Ord Schd Type
"RTN","PSBML",101,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5)) ;  Schd Admn D/T
"RTN","PSBML",102,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID) ; Uniqu ID #
"RTN","PSBML",103,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"")  ;no Schd Admin for contin, non-PigBack IV
"RTN","PSBML",104,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE) ;UD Dosage
"RTN","PSBML",105,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR) ;IV Infu Rt
"RTN","PSBML",106,0)
 .; Ovrwrt if ordr exsts
"RTN","PSBML",107,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D  ;Givn or Compltd?
"RTN","PSBML",108,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW) ;   Admin D/T
"RTN","PSBML",109,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ) ;  Admin By
"RTN","PSBML",110,0)
 .D:PSBREC(8)]"" VAL(53.79,PSBIEN,.16,PSBREC(8)) ; Injct Ste
"RTN","PSBML",111,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3)) ; Stats of Admin
"RTN","PSBML",112,0)
 .D:PSBREC(6)]"" VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U)),VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2)) ; PRN Reason
"RTN","PSBML",113,0)
 .; Comment?
"RTN","PSBML",114,0)
 .D:PSBREC(7)]""
"RTN","PSBML",115,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7)) ;Comment
"RTN","PSBML",116,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ) ;  Who
"RTN","PSBML",117,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW) ;   When
"RTN","PSBML",118,0)
 .; DD/SOL/ADD
"RTN","PSBML",119,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D  ; Only if givn or infus
"RTN","PSBML",120,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",121,0)
 ..F PSBCNT=10:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",122,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",123,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",124,0)
 ...Q:'PSBDD
"RTN","PSBML",125,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",126,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",127,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",128,0)
 ...D VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML",129,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,20))
"RTN","PSBML",130,0)
 .I $O(RESULTS("")) S RESULTS(0)=1,RESULTS(1)="-1^Error(s) Filing Transaction MEDPASS"  Q
"RTN","PSBML",131,0)
 .D FILEIT
"RTN","PSBML",132,0)
 .D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ; 1 time expired?
"RTN","PSBML",133,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",134,0)
 Q
"RTN","PSBML",135,0)
BCBU ; HL7, Nat. Conting
"RTN","PSBML",136,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",137,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",138,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",139,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",140,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",141,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7 ; HL7 ,Send to BCMA Contingency
"RTN","PSBML",142,0)
 ; *** HDR-VDEF call here *** (copy *3 PSBML)
"RTN","PSBML",143,0)
 Q
"RTN","PSBML",144,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",145,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",146,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",147,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",148,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",149,0)
 Q
"RTN","PSBML",150,0)
FILEIT ;Updt MedLog
"RTN","PSBML",151,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",152,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",153,0)
 D APATCH^PSBML2
"RTN","PSBML",154,0)
 D CLEAN^DILF
"RTN","PSBML",155,0)
 D RESETADM^PSBUTL
"RTN","PSBML",156,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",157,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",158,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",159,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",160,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",161,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",162,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",163,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",164,0)
 D BCBU  ; Nat. Conting
"RTN","PSBML",165,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",166,0)
 Q
"RTN","PSBML",167,0)
ERR(X,Y) ;
"RTN","PSBML",168,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",169,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",170,0)
 Q
"RTN","PSBML",171,0)
COMMENT(DA,PSBCMT) ; from DDS
"RTN","PSBML",172,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",173,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",174,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",175,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",176,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",177,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",178,0)
 D FILEIT
"RTN","PSBML",179,0)
 Q
"RTN","PSBML",180,0)
 ;
"RTN","PSBMLEN")
0^27^B69639468
"RTN","PSBMLEN",1,0)
PSBMLEN ;BIRMINGHAM/EFC-BCMA MEDICATION LOG FUNCTIONS ;Mar 2004
"RTN","PSBMLEN",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,9**;Mar 2004
"RTN","PSBMLEN",3,0)
 ;
"RTN","PSBMLEN",4,0)
 ; Reference/IA
"RTN","PSBMLEN",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBMLEN",6,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBMLEN",7,0)
 ; ENR^PSJBCMA4/3416
"RTN","PSBMLEN",8,0)
 ; ^XUSEC/10076
"RTN","PSBMLEN",9,0)
 ; ^DPT/10035
"RTN","PSBMLEN",10,0)
 ; $$GET^XPAR/2263
"RTN","PSBMLEN",11,0)
 ; HLP^DDSUTL/10150
"RTN","PSBMLEN",12,0)
 ;
"RTN","PSBMLEN",13,0)
EN ;
"RTN","PSBMLEN",14,0)
 N PSBCNT,PSBDT,PSBERR,PSBFORM,PSBMED,PSBNOW,PSBSCHT,PSBVARD,PSBX,PSBFREQ,PSBFLAG
"RTN","PSBMLEN",15,0)
 K ^TMP("PSB",$J),^TMP("PSJ",$J),PSBREC
"RTN","PSBMLEN",16,0)
 W @IOF,!,"Manual Medication Entry",!
"RTN","PSBMLEN",17,0)
 I $D(^XUSEC("PSB READ ONLY",DUZ)) W !,"This option is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN",18,0)
 W !,"Notice: No validation of medications is done with this option."
"RTN","PSBMLEN",19,0)
 W !,"Entries in the Med Log created with this option will reflect this"
"RTN","PSBMLEN",20,0)
 W !,"in the comments.",!!
"RTN","PSBMLEN",21,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select PATIENT: "
"RTN","PSBMLEN",22,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBMLEN",23,0)
 S DFN=+Y
"RTN","PSBMLEN",24,0)
 D EN1
"RTN","PSBMLEN",25,0)
 K ^TMP("PSBO",$J)
"RTN","PSBMLEN",26,0)
 Q
"RTN","PSBMLEN",27,0)
 ;
"RTN","PSBMLEN",28,0)
EN1 ;
"RTN","PSBMLEN",29,0)
 S %DT="AEQ",%DT("B")="Today",%DT("A")="Select Orders From Date: "
"RTN","PSBMLEN",30,0)
 D ^%DT Q:+Y<1  S PSBDT=+Y
"RTN","PSBMLEN",31,0)
 W !,"Searching for Orders..."
"RTN","PSBMLEN",32,0)
 K ^TMP("PSJ",$J)
"RTN","PSBMLEN",33,0)
 D EN^PSJBCMA(DFN,PSBDT,"")
"RTN","PSBMLEN",34,0)
 Q:$G(^TMP("PSJ",$J,1,0))=-1
"RTN","PSBMLEN",35,0)
 S PSBERR=0
"RTN","PSBMLEN",36,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBMLEN",37,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBMLEN",38,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBMLEN",39,0)
 .Q:PSBONX?.N1"P"  ; No Pending Yet
"RTN","PSBMLEN",40,0)
 .I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBMLEN",41,0)
 .I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBMLEN",42,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBMLEN",43,0)
 .I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBMLEN",44,0)
 .K ^TMP("PSBO",$J)
"RTN","PSBMLEN",45,0)
 .S PSBOUT=0
"RTN","PSBMLEN",46,0)
 .D:PSBSCHT="C"
"RTN","PSBMLEN",47,0)
 ..;Calculate admin times based on Frequency from IPM
"RTN","PSBMLEN",48,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBMLEN",49,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBMLEN",50,0)
 ..I PSBYES,PSBADST="" S PSBOUT=1 Q
"RTN","PSBMLEN",51,0)
 ..I PSBSCH?2.4N.E S PSBYES=1
"RTN","PSBMLEN",52,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBMLEN",53,0)
 ..I PSBFREQ="O" S PSBYES=1
"RTN","PSBMLEN",54,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 S PSBOUT=1 Q
"RTN","PSBMLEN",55,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBMLEN",56,0)
 ..I PSBODD,PSBADST'="" S PSBOUT=1 Q
"RTN","PSBMLEN",57,0)
 ..I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBDT)
"RTN","PSBMLEN",58,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBMLEN",59,0)
 ..F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) S PSBOUT=1 Q  ; Validate time(s)
"RTN","PSBMLEN",60,0)
 .Q:PSBOUT
"RTN","PSBMLEN",61,0)
 .Q:PSBOST>PSBNOW  ; Future Start Date
"RTN","PSBMLEN",62,0)
 .I PSBSCHT="O" S (PSBGVN,X,Y)="" D  I (PSBGVN)!(PSBNGF) K PSBGVN,X,Y Q
"RTN","PSBMLEN",63,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBMLEN",64,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)'="N") PSBGVN=1,(X,Y)=0
"RTN","PSBMLEN",65,0)
 .I PSBSCHT="OC" S (PSBGVN,X,Y)="" D  I PSBGVN K PSBGVN,X,Y Q
"RTN","PSBMLEN",66,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBMLEN",67,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)'="N") PSBGVN=1,(X,Y)=0
"RTN","PSBMLEN",68,0)
 ..S PSBGVN=PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) Q:PSBGVN
"RTN","PSBMLEN",69,0)
 ..I PSBOSTS'="A"&(PSBOSTS'="R") S PSBGVN=1 Q
"RTN","PSBMLEN",70,0)
 ..I PSBNGF S PSBGVN=1 Q
"RTN","PSBMLEN",71,0)
 .S ^TMP("PSB",$J,PSBSCHT,PSBOITX,PSBX)=PSBONX_U_PSBADST_U_PSBOST_U_PSBOSP_U_PSBOSTS
"RTN","PSBMLEN",72,0)
 I PSBERR W ! K DIR S DIR(0)="E" D ^DIR Q:Y="^"
"RTN","PSBMLEN",73,0)
 ;
"RTN","PSBMLEN",74,0)
EN2 ;
"RTN","PSBMLEN",75,0)
 W $$HDR() I '$D(^TMP("PSB",$J)) W !!?5,"No Med Orders Found!",!  Q
"RTN","PSBMLEN",76,0)
 S PSBSCHT="",PSBCNT=0
"RTN","PSBMLEN",77,0)
 F  S PSBSCHT=$O(^TMP("PSB",$J,PSBSCHT)) Q:PSBSCHT=""  D
"RTN","PSBMLEN",78,0)
 .W !  ; Line between order types
"RTN","PSBMLEN",79,0)
 .S PSBMED=""
"RTN","PSBMLEN",80,0)
 .F  S PSBMED=$O(^TMP("PSB",$J,PSBSCHT,PSBMED)) Q:PSBMED=""  D
"RTN","PSBMLEN",81,0)
 ..F PSBX=0:0 S PSBX=$O(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX)) Q:'PSBX  D
"RTN","PSBMLEN",82,0)
 ...I $Y>(IOSL-6) W ! K DIR S DIR(0)="E" D ^DIR W:Y $$HDR() I 'Y S PSBSCHT="Z" Q
"RTN","PSBMLEN",83,0)
 ...S PSBCNT=PSBCNT+1
"RTN","PSBMLEN",84,0)
 ...W !,$J(PSBCNT,2),". ",PSBSCHT,?7,PSBMED
"RTN","PSBMLEN",85,0)
 ...W ?40," (",$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,5),")"
"RTN","PSBMLEN",86,0)
 ...S Y=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,3)
"RTN","PSBMLEN",87,0)
 ...W:$X>44 !
"RTN","PSBMLEN",88,0)
 ...W ?45,"Start: ",$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))_" "
"RTN","PSBMLEN",89,0)
 ...W $E($P(Y,".",2)_"0000",1,4)
"RTN","PSBMLEN",90,0)
 ...S Y=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,4)
"RTN","PSBMLEN",91,0)
 ...W !?45," Stop: ",$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))_" "
"RTN","PSBMLEN",92,0)
 ...W $E($P(Y,".",2)_"0000",1,4)
"RTN","PSBMLEN",93,0)
 ...I $P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,2)]"" W !?7,"Admin Times: ",$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,2)
"RTN","PSBMLEN",94,0)
 ...W !
"RTN","PSBMLEN",95,0)
 ...S ^TMP("PSBO",$J,PSBCNT)=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,1)
"RTN","PSBMLEN",96,0)
 F  Q:$Y>(IOSL-5)  W !
"RTN","PSBMLEN",97,0)
 K DIR S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR
"RTN","PSBMLEN",98,0)
 I Y S Y=^TMP("PSBO",$J,Y) D NEW^PSBMLEN1(Y) G EN2
"RTN","PSBMLEN",99,0)
 Q
"RTN","PSBMLEN",100,0)
 ;
"RTN","PSBMLEN",101,0)
 ;
"RTN","PSBMLEN",102,0)
HDR() ;
"RTN","PSBMLEN",103,0)
 W @IOF,"Manual Medication Entry",!," #",?4,"Sc",?7,"Medication",?41,"St"
"RTN","PSBMLEN",104,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",105,0)
 Q ""
"RTN","PSBMLEN",106,0)
 ;
"RTN","PSBMLEN",107,0)
EDIT    ; Edit Medication Log
"RTN","PSBMLEN",108,0)
 N PSBAUDIT
"RTN","PSBMLEN",109,0)
 S PSBAUDIT=1
"RTN","PSBMLEN",110,0)
 W:'$D(^XUSEC("PSB MANAGER",DUZ)) !!?5,"Notice: You are restricted from editing any entries other than",!,"        those that you have created.",!
"RTN","PSBMLEN",111,0)
 S DA=""
"RTN","PSBMLEN",112,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient Name: "
"RTN","PSBMLEN",113,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBMLEN",114,0)
 S DFN=+Y
"RTN","PSBMLEN",115,0)
 D EDIT1
"RTN","PSBMLEN",116,0)
 K PSBCNT,PSBDT,PSBIEN,PSBSRCH,PSBTMP,DA,DFN,DR,DDSFILE
"RTN","PSBMLEN",117,0)
 G EDIT
"RTN","PSBMLEN",118,0)
 ;
"RTN","PSBMLEN",119,0)
EDIT1   ; 
"RTN","PSBMLEN",120,0)
 S %DT="AEQ",%DT("A")="Select Date to Begin Searching Back From: "
"RTN","PSBMLEN",121,0)
 W !! S %DT("B")="TODAY" D ^%DT Q:+Y<1  S PSBDT=Y
"RTN","PSBMLEN",122,0)
 F  D  Q:'PSBDT
"RTN","PSBMLEN",123,0)
 .W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBMLEN",124,0)
 .W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBMLEN",125,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",126,0)
 .S PSBSRCH=PSBDT+.9,PSBCNT=0
"RTN","PSBMLEN",127,0)
 .K PSBTMP
"RTN","PSBMLEN",128,0)
 .F  S PSBSRCH=$O(^PSB(53.79,"AEDT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLEN",129,0)
 ..S PSBIEN=""
"RTN","PSBMLEN",130,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AEDT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:$P(^PSB(53.79,PSBIEN,0),U,7)=DUZ!($D(^XUSEC("PSB MANAGER",DUZ)))
"RTN","PSBMLEN",131,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBMLEN",132,0)
 ...S PSBCNT=PSBCNT+1,PSBTMP(PSBCNT)=PSBIEN
"RTN","PSBMLEN",133,0)
 ...D:$Y>19
"RTN","PSBMLEN",134,0)
 ....W ! S DIR(0)="E" D ^DIR
"RTN","PSBMLEN",135,0)
 ....W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBMLEN",136,0)
 ....W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBMLEN",137,0)
 ....W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",138,0)
 ...W !,$J(PSBCNT,2),". "
"RTN","PSBMLEN",139,0)
 ...W ?5,$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLEN",140,0)
 ...I $$GET1^DIQ(53.79,PSBIEN_",",.26) W ?5," ("_$$GET1^DIQ(53.79,PSBIEN_",",.26)_")"
"RTN","PSBMLEN",141,0)
 ...W ?45,$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBMLEN",142,0)
 ...W ?50,$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBMLEN",143,0)
 ...W ?75,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLEN",144,0)
 .I PSBCNT D  Q:Y
"RTN","PSBMLEN",145,0)
 ..W ! S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR
"RTN","PSBMLEN",146,0)
 ..I Y S DA=PSBTMP(Y),PSBDT=""
"RTN","PSBMLEN",147,0)
 .I 'PSBCNT W !!?5,"No Meds Found!"
"RTN","PSBMLEN",148,0)
 .S X1=PSBDT,X2=-1 D C^%DTC S (PSBDT,Y)=X D D^DIQ
"RTN","PSBMLEN",149,0)
 .W !!,"Continue With ",Y
"RTN","PSBMLEN",150,0)
 .S %=1 D YN^DICN I %'=1 S PSBDT=0
"RTN","PSBMLEN",151,0)
 I DA D
"RTN","PSBMLEN",152,0)
 .S PSBCOMP="",PSBDFN=$$GET1^DIQ(53.79,DA_",",.01,"I"),PSBONX=$$GET1^DIQ(53.79,DA_",",.11),PSBSTUS=$$GET1^DIQ(53.79,DA_",",.09,"I")
"RTN","PSBMLEN",153,0)
 .I PSBONX["V",PSBSTUS'="G" D  Q:PSBCOMP=1
"RTN","PSBMLEN",154,0)
 ..S PSBBAGN=$$GET1^DIQ(53.79,DA_",",.26) D INFUSING^PSBVDLU2 Q:PSBCOMP=0
"RTN","PSBMLEN",155,0)
 ..I $D(PSBPORA(PSBONX)) S X="" F  S X=$O(PSBPORA(PSBONX,X)),PSBBAG2=$P(PSBPORA(PSBONX,X),U,1),PSBBAGST=$P(PSBPORA(PSBONX,X),U,2) Q:PSBBAG2]""
"RTN","PSBMLEN",156,0)
 ..I PSBBAGN=PSBBAG2 S PSBCOMP=0 Q
"RTN","PSBMLEN",157,0)
 ..I (PSBBAGN'=PSBBAG2),PSBBAGST'="C" D 
"RTN","PSBMLEN",158,0)
 ...W !!,"Bag "_PSBBAG2_" is marked as ",$S(PSBBAGST="I":"Infusing",PSBBAGST="S":"Stopped",1:"unk")
"RTN","PSBMLEN",159,0)
 ...W !,"This bag must be completed before bag "_PSBBAGN_" can be edited.",!!
"RTN","PSBMLEN",160,0)
 ...K PSBORA,PSBBAGN,PSBBAG2,PSBBAGST
"RTN","PSBMLEN",161,0)
 .I PSBONX["V" D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBMLEN",162,0)
 .S DDSFILE=53.79 D
"RTN","PSBMLEN",163,0)
 ..I PSBONX["U" S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",164,0)
 ..I PSBIVT["P" S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",165,0)
 ..I PSBIVT["S",PSBISYR=1  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",166,0)
 ..I PSBIVT["C",PSBISYR=1  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",167,0)
 ..I PSBIVT["C",PSBCHEMT="P"  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",168,0)
 ..S DR="[PSB MED LOG EDIT IV]" Q
"RTN","PSBMLEN",169,0)
 .D ^DDS
"RTN","PSBMLEN",170,0)
 .;One time order reinstated if not given
"RTN","PSBMLEN",171,0)
 .D:($P(^PSB(53.79,DA,.1),U,2)="O")&($P(^PSB(53.79,DA,0),U,9)="N") ENR^PSJBCMA4(DFN,$P(^PSB(53.79,DA,.1),U,1))
"RTN","PSBMLEN",172,0)
 .D:($P(^PSB(53.79,DA,.1),U,2)="O")&($P(^PSB(53.79,DA,0),U,9)="G") ENE^PSJBCMA4(DFN,$P(^PSB(53.79,DA,.1),U,1))
"RTN","PSBMLEN",173,0)
 Q
"RTN","PSBMLEN",174,0)
 ;
"RTN","PSBMLEN",175,0)
VALID ;
"RTN","PSBMLEN",176,0)
 I $G(PSBSTUS)="RM","^RM^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Status of Removed cannot be changed.") Q
"RTN","PSBMLEN",177,0)
 I $G(PSBREC(7))'="Entry created with 'Manual Medication Entry' option." D  Q
"RTN","PSBMLEN",178,0)
 .I ($D(^PSB(53.79,DA,.5,1,0))),($P($G(^PSB(53.79,DA,.5,1,0)),U,4)="PATCH") D  Q
"RTN","PSBMLEN",179,0)
 ..I "^G^N^H^R^RM^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Not Given, Held, Refused and Removed.")
"RTN","PSBMLEN",180,0)
 .I "^G^N^H^R^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Not Given, Held, and Refused.")
"RTN","PSBMLEN",181,0)
 I "^G^H^R^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Held, and Refused.") Q
"RTN","PSBMLEN",182,0)
 ;
"RTN","PSBMLEN",183,0)
 ;
"RTN","PSBMLEN1")
0^28^B32688222
"RTN","PSBMLEN1",1,0)
PSBMLEN1 ;BIRMINGHAM/EFC-BCMA MEDICATION LOG FUNCTIONS ;Mar 2004
"RTN","PSBMLEN1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,4,9**;Mar 2004
"RTN","PSBMLEN1",3,0)
 ;
"RTN","PSBMLEN1",4,0)
 ; Reference/IA
"RTN","PSBMLEN1",5,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBMLEN1",6,0)
 ; ^XUSEC/10076
"RTN","PSBMLEN1",7,0)
 ; HLP^DDSUTL/10150
"RTN","PSBMLEN1",8,0)
 ;
"RTN","PSBMLEN1",9,0)
NEW(Y) ; Create the new entry
"RTN","PSBMLEN1",10,0)
 N PSBREC,PSB,PSBADST,PSBFREQ
"RTN","PSBMLEN1",11,0)
 S PSBMMEN=1
"RTN","PSBMLEN1",12,0)
 W @IOF D CLEAN^PSBVT,PSJ1^PSBVT(DFN,Y)
"RTN","PSBMLEN1",13,0)
 D NOW^%DTC
"RTN","PSBMLEN1",14,0)
 I PSBOSP<% D  Q:%'=1
"RTN","PSBMLEN1",15,0)
 .W @IOF,$C(7)
"RTN","PSBMLEN1",16,0)
 .W !,"NOTICE: This order is NOT currently active."
"RTN","PSBMLEN1",17,0)
 .W !,"        Are You Sure You Want To Continue"
"RTN","PSBMLEN1",18,0)
 .S %=2 D YN^DICN
"RTN","PSBMLEN1",19,0)
 I PSBADST="" S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX),PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBDT)
"RTN","PSBMLEN1",20,0)
 E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBMLEN1",21,0)
 W !,"Order:       ",PSBONX
"RTN","PSBMLEN1",22,0)
 W !,"Medication:  ",PSBOITX
"RTN","PSBMLEN1",23,0)
 W !,"Dosage:      ",PSBDOSE
"RTN","PSBMLEN1",24,0)
 W !,"Schedule:    ",PSBSCH
"RTN","PSBMLEN1",25,0)
 W !,"Admin Times: ",PSBADST
"RTN","PSBMLEN1",26,0)
 I $D(^XUSEC("PSB READ ONLY",DUZ)) D  Q
"RTN","PSBMLEN1",27,0)
 .W !!,"Medications CANNOT be administered while in PSB READ ONLY mode.",!! R "Press ENTER KEY to continue. ",PSBCNTNU:5
"RTN","PSBMLEN1",28,0)
 W !!,"Is this the correct Order" S %=1 D YN^DICN Q:%'=1
"RTN","PSBMLEN1",29,0)
 ;
"RTN","PSBMLEN1",30,0)
 ; PRN, One-Time, On Call orders
"RTN","PSBMLEN1",31,0)
 ;
"RTN","PSBMLEN1",32,0)
 I PSBSCHT'="C" D
"RTN","PSBMLEN1",33,0)
 .D VAL^PSBMLVAL(.PSB,DFN,+PSBONX,$E(PSBONX,$L(PSBONX)))
"RTN","PSBMLEN1",34,0)
 .I PSBSCHT="P",($D(PSB(1))) W !!,"Brief Administration History:  ",! S X=$O(PSB(" "),-1),X=$S(X>4:4,1:X) F I=1:1:X W !,?5,PSB(I)
"RTN","PSBMLEN1",35,0)
 .I $D(^XUSEC("PSB READ ONLY",DUZ)) W !,"This operation is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN1",36,0)
 .I ($D(^XUSEC("PSB STUDENT",DUZ))),('$D(^XUSEC("PSB INSTRUCTOR"))) W !,"This operation is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN1",37,0)
 .W !!,"Create an administration for this order" S %=1 D YN^DICN Q:%'=1
"RTN","PSBMLEN1",38,0)
 .I PSBSCHT="P" D  Q:Y=""!(Y["^")
"RTN","PSBMLEN1",39,0)
 ..K DIR S DIR(0)="FB^1:30",DIR("A")="PRN Reason (1-30 characters)"
"RTN","PSBMLEN1",40,0)
 ..W !!,"NOTICE: PRN Reason is Required for ALL PRN Entries",!
"RTN","PSBMLEN1",41,0)
 ..D ^DIR
"RTN","PSBMLEN1",42,0)
 ..I Y=""!(Y["^") W !!,"Sorry, Reason is required, No Entry Made!" Q
"RTN","PSBMLEN1",43,0)
 ..S PSBREC(6)=$P(Y,"|")
"RTN","PSBMLEN1",44,0)
 .; Build the form of dosage to CAP or TAB or null
"RTN","PSBMLEN1",45,0)
 .S:(PSBDOSEF'?1"CAP".E)&(PSBDOSEF'?1"TAB".E)&(PSBDOSEF'?1"PATCH".E) PSBDOSEF=""
"RTN","PSBMLEN1",46,0)
 .; Build the variable dose check #####-#####MG
"RTN","PSBMLEN1",47,0)
 .S PSBVARD=$S(PSBDOSE?1.5N1"-"1.5N.E:1,1:0)
"RTN","PSBMLEN1",48,0)
 .S PSBREC(0)=DFN
"RTN","PSBMLEN1",49,0)
 .S PSBREC(1)=PSBONX
"RTN","PSBMLEN1",50,0)
 .S PSBREC(2)=PSBSCHT
"RTN","PSBMLEN1",51,0)
 .S PSBREC(3)="G"
"RTN","PSBMLEN1",52,0)
 .S PSBREC(4)=PSBOIT
"RTN","PSBMLEN1",53,0)
 .S PSBREC(5)=""
"RTN","PSBMLEN1",54,0)
 .S PSBREC(7)="Entry created with 'Manual Medication Entry' option."
"RTN","PSBMLEN1",55,0)
 .S PSBREC(8)=""
"RTN","PSBMLEN1",56,0)
 .S PSBREC(9)=$S(PSBONX["U":"UDTAB",1:"PBTAB")
"RTN","PSBMLEN1",57,0)
 .S PSBINDX=10
"RTN","PSBMLEN1",58,0)
 .S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSBREC(PSBINDX)=$P(PSBDDA(X),U,1,2)_U_$P(PSBDDA(X),U,4)_U_$P(PSBDDA(X),U,4)_U_PSBDOSEF,PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",59,0)
 .S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBADA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",60,0)
 .S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBSOLA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",61,0)
 .D FILE
"RTN","PSBMLEN1",62,0)
 .I $G(DA),PSBREC(2)="O",$D(^PSB(53.79,DA)) I $P(^PSB(53.79,DA,0),U,9)="G" D ENE^PSJBCMA4(PSBREC(0),PSBREC(1))
"RTN","PSBMLEN1",63,0)
 ;
"RTN","PSBMLEN1",64,0)
 ; Continuous Meds
"RTN","PSBMLEN1",65,0)
 ;
"RTN","PSBMLEN1",66,0)
 I PSBSCHT="C" D
"RTN","PSBMLEN1",67,0)
 .W ! S %DT="AEQ",%DT("A")="Enter the DATE the medication was administered: "
"RTN","PSBMLEN1",68,0)
 .D NOW^%DTC S %DT(0)=(-1)*X,%DT("B")="" D ^%DT K %DT(0) Q:Y<1  S PSBDT=Y D D^DIQ
"RTN","PSBMLEN1",69,0)
 .F PSBXX=0:1 Q:$G(^TMP("PSB",$J,"GETADMIN",PSBXX))=""  D
"RTN","PSBMLEN1",70,0)
 ..S X="",Y=$G(^TMP("PSB",$J,"GETADMIN",PSBXX))
"RTN","PSBMLEN1",71,0)
 ..F Z=1:1:$L(Y,"-") S X=X_$S(X]"":";",1:"")_Z_":"_$P(Y,"-",Z)
"RTN","PSBMLEN1",72,0)
 .K DIR S DIR(0)="S^"_X,DIR("A")="Select Administration Time"
"RTN","PSBMLEN1",73,0)
 .D ^DIR Q:Y<1
"RTN","PSBMLEN1",74,0)
 .S PSBDT=+(PSBDT_"."_Y(0))
"RTN","PSBMLEN1",75,0)
 .S Y=PSBDT D D^DIQ
"RTN","PSBMLEN1",76,0)
 .W !!,"Create an administration for ",Y S %=1 D YN^DICN  Q:%'=1
"RTN","PSBMLEN1",77,0)
FORUM .; Build the form of dosage to CAP or TAB or null
"RTN","PSBMLEN1",78,0)
 .S PSBDOSEF=PSBDOSEF
"RTN","PSBMLEN1",79,0)
 .S:(PSBDOSEF'?1"CAP".E)&(PSBDOSEF'?1"TAB".E)&(PSBDOSEF'?1"PATCH".E) PSBDOSEF=""
"RTN","PSBMLEN1",80,0)
 .; Build the variable dose check #####-#####MG
"RTN","PSBMLEN1",81,0)
 .S PSBVARD=$S(PSBDOSE?1.5N1"-"1.5N.E:1,1:0)
"RTN","PSBMLEN1",82,0)
 .S PSBREC(0)=DFN
"RTN","PSBMLEN1",83,0)
 .S PSBREC(1)=PSBONX
"RTN","PSBMLEN1",84,0)
 .S PSBREC(2)=PSBSCHT
"RTN","PSBMLEN1",85,0)
 .S PSBREC(3)="G"
"RTN","PSBMLEN1",86,0)
 .S PSBREC(4)=PSBOIT
"RTN","PSBMLEN1",87,0)
 .S PSBREC(5)=PSBDT
"RTN","PSBMLEN1",88,0)
 .S PSBREC(6)=""
"RTN","PSBMLEN1",89,0)
 .S PSBREC(7)="Entry created with 'Manual Medication Entry' option."
"RTN","PSBMLEN1",90,0)
 .S PSBREC(8)=""
"RTN","PSBMLEN1",91,0)
 .S PSBREC(9)=$S(PSBONX["U":"UDTAB",1:"PBTAB")
"RTN","PSBMLEN1",92,0)
 .S PSBINDX=10
"RTN","PSBMLEN1",93,0)
 .S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSBREC(PSBINDX)=$P(PSBDDA(X),U,1,2)_U_$P(PSBDDA(X),U,4)_U_$P(PSBDDA(X),U,4)_U_PSBDOSEF,PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",94,0)
 .S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBADA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",95,0)
 .S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBSOLA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",96,0)
 .D FILE
"RTN","PSBMLEN1",97,0)
 Q
"RTN","PSBMLEN1",98,0)
 ;
"RTN","PSBMLEN1",99,0)
FILE ; Call the med log RPC to file it and DDS to edit it
"RTN","PSBMLEN1",100,0)
 N PSB,PSBSAVE,PSBAUDIT
"RTN","PSBMLEN1",101,0)
 D RPC^PSBML(.PSB,"+1^MEDPASS",.PSBREC)
"RTN","PSBMLEN1",102,0)
 I +PSB(1)<1 D  Q
"RTN","PSBMLEN1",103,0)
 .W @IOF,!,"Error(s) Creating Med Log Entry",!
"RTN","PSBMLEN1",104,0)
 .S X=$S(PSB(0)=1:0,1:1) F  S X=$O(PSB(X)) Q:X=""  W !,$J($S(X=1:X,1:X-1),2),". ",$S(X=1:$P(PSB(X),"^",2),1:PSB(X))
"RTN","PSBMLEN1",105,0)
 .W !!,"No Med Log Entry Created.",!!
"RTN","PSBMLEN1",106,0)
 .K DIR S DIR(0)="E" D ^DIR
"RTN","PSBMLEN1",107,0)
 S PSBSAVE=0 S:'$G(PSBMMEN) PSBAUDIT=1
"RTN","PSBMLEN1",108,0)
 S DA=$P(PSB(1),U,3),DDSFILE=53.79
"RTN","PSBMLEN1",109,0)
 I $P(^PSB(53.79,DA,.1),U,1)?.N1"U" S DR="[PSB NEW UD ENTRY]"
"RTN","PSBMLEN1",110,0)
 I $P(^PSB(53.79,DA,.1),U,1)?.N1"V" S DR="[PSB NEW IV ENTRY]"
"RTN","PSBMLEN1",111,0)
 D ^DDS
"RTN","PSBMLEN1",112,0)
 I PSBSAVE'=1 D
"RTN","PSBMLEN1",113,0)
 .W !,"Incomplete Med Log Entry, Deleting...#",DA S A=^PSB(53.79,DA,0),DFN=$P(A,U,1),AADT=$P(A,U,6)
"RTN","PSBMLEN1",114,0)
 .K ^PSB(53.79,"AADT",DFN,AADT,DA) S DIK="^PSB(53.79," D ^DIK
"RTN","PSBMLEN1",115,0)
 I PSBSAVE=1 D
"RTN","PSBMLEN1",116,0)
 .S X=$S($P(PSBIEN,",",2)]"":$P(PSBIEN,",",2),PSBIEN="+1":PSBIEN(1),1:"")
"RTN","PSBMLEN1",117,0)
 .I X]"",($F("HR",$P(^PSB(53.79,X,0),U,9))>1) F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,X,Y,Z,0),U,3)=0
"RTN","PSBMLEN1",118,0)
 Q
"RTN","PSBMLEN1",119,0)
 ;
"RTN","PSBMLEN1",120,0)
FDATE ;Check Admin Time for future date/time.
"RTN","PSBMLEN1",121,0)
 N PSBTIMX
"RTN","PSBMLEN1",122,0)
 S PSBTIMX=X D NOW^%DTC
"RTN","PSBMLEN1",123,0)
 I PSBTIMX>% W $C(7) S (DDSERROR,DDSBR)=1 D HLP^DDSUTL("Future date/time is not allowed")
"RTN","PSBMLEN1",124,0)
 Q
"RTN","PSBMLEN1",125,0)
 ;
"RTN","PSBMLLKU")
0^29^B59536394
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ-BCMA RPC LOOKUP UTLILITIES ;Mar 2004
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9**;Mar 2004
"RTN","PSBMLLKU",3,0)
 ;
"RTN","PSBMLLKU",4,0)
 ; Reference/IA
"RTN","PSBMLLKU",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",6,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",7,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",8,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",9,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",10,0)
 ; File 52.6/436
"RTN","PSBMLLKU",11,0)
 ; File 52.7/437
"RTN","PSBMLLKU",12,0)
 ; File 50/221
"RTN","PSBMLLKU",13,0)
 ;
"RTN","PSBMLLKU",14,0)
 ;
"RTN","PSBMLLKU",15,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",16,0)
 ;
"RTN","PSBMLLKU",17,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",18,0)
 Q
"RTN","PSBMLLKU",19,0)
 ;
"RTN","PSBMLLKU",20,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",21,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",22,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",23,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",24,0)
 ;
"RTN","PSBMLLKU",25,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",26,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",27,0)
 ;
"RTN","PSBMLLKU",28,0)
 ;
"RTN","PSBMLLKU",29,0)
 K RESULTS
"RTN","PSBMLLKU",30,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",31,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",32,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",33,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",34,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",35,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",36,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",37,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",38,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")!($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"")
"RTN","PSBMLLKU",39,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",40,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",41,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",42,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",43,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.09)
"RTN","PSBMLLKU",44,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",45,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",46,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",47,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",48,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",49,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",50,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",51,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",52,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",53,0)
 Q
"RTN","PSBMLLKU",54,0)
 ;
"RTN","PSBMLLKU",55,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",56,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",57,0)
 Q 1
"RTN","PSBMLLKU",58,0)
 ;
"RTN","PSBMLLKU",59,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",60,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",61,0)
 ;
"RTN","PSBMLLKU",62,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",63,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",64,0)
 ;
"RTN","PSBMLLKU",65,0)
 ;
"RTN","PSBMLLKU",66,0)
 K RESULTS
"RTN","PSBMLLKU",67,0)
 S PSBDATA=$E(PSBREC(1),1,30)
"RTN","PSBMLLKU",68,0)
 N PSBINDX
"RTN","PSBMLLKU",69,0)
 S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:"")
"RTN","PSBMLLKU",70,0)
 D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",71,0)
 I $P(^TMP("DILIST",$J,0),U,3) D  Q
"RTN","PSBMLLKU",72,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA_"'. Please be more specific."
"RTN","PSBMLLKU",73,0)
 F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",74,0)
 .S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",75,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA_"'"
"RTN","PSBMLLKU",76,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",77,0)
 Q
"RTN","PSBMLLKU",78,0)
 ;
"RTN","PSBMLLKU",79,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",80,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",81,0)
 N PSBXX
"RTN","PSBMLLKU",82,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",83,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$P(PSBXX,U,9)
"RTN","PSBMLLKU",84,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",85,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",86,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",87,0)
 S $P(PSBXX,U,11)=$$SSN^DPTLK1(DFN)
"RTN","PSBMLLKU",88,0)
 Q PSBXX
"RTN","PSBMLLKU",89,0)
 ;
"RTN","PSBMLLKU",90,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",91,0)
 ;
"RTN","PSBMLLKU",92,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",93,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",94,0)
 ;
"RTN","PSBMLLKU",95,0)
 ;
"RTN","PSBMLLKU",96,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",97,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",98,0)
 ;
"RTN","PSBMLLKU",99,0)
 ;
"RTN","PSBMLLKU",100,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",101,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",102,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",103,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",104,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",105,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",106,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",107,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",108,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",109,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",110,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",111,0)
 .S $P(RESULTS(1),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.09,"I")
"RTN","PSBMLLKU",112,0)
 .;
"RTN","PSBMLLKU",113,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",114,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",115,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",116,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",117,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",118,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",119,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",120,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",121,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",122,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",123,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",124,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",125,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",126,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",127,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",128,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",129,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",130,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",131,0)
 .;
"RTN","PSBMLLKU",132,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",133,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",134,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",135,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",136,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",137,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",138,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",139,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",140,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",141,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",142,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",143,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",144,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",145,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",146,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",147,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",148,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",149,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",150,0)
 Q
"RTN","PSBMLLKU",151,0)
 ;
"RTN","PSBMLLKU",152,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",153,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",154,0)
 ;
"RTN","PSBMLLKU",155,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",156,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT,PSBXTAB
"RTN","PSBMLLKU",157,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",158,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",159,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",160,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBMROUT=$P(^TMP("PSJ1",$J,1),U,4)
"RTN","PSBMLLKU",161,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT) PSBXTAB="PB"
"RTN","PSBMLLKU",162,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",163,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",164,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",165,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",166,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",167,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",168,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",169,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",170,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",171,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",172,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",173,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",174,0)
 Q
"RTN","PSBMLLKU",175,0)
 ;
"RTN","PSBMLLKU",176,0)
KILLAADT ;
"RTN","PSBMLLKU",177,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",178,0)
 ;   Cleansing!
"RTN","PSBMLLKU",179,0)
 ;
"RTN","PSBMLLKU",180,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",181,0)
 Q
"RTN","PSBMLLKU",182,0)
 ;
"RTN","PSBODL")
0^21^B83407747
"RTN","PSBODL",1,0)
PSBODL ;BIRMINGHAM/EFC-DUE LIST ;Mar 2004
"RTN","PSBODL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9**;Mar 2004 
"RTN","PSBODL",3,0)
 ;
"RTN","PSBODL",4,0)
 ; Reference/IA
"RTN","PSBODL",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBODL",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBODL",7,0)
 ; ^XLFDT/10103
"RTN","PSBODL",8,0)
 ;
"RTN","PSBODL",9,0)
EN ; Prt DL
"RTN","PSBODL",10,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG
"RTN","PSBODL",11,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBODL",12,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBODL",13,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBODL",14,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODL",15,0)
 .K PSBHDR
"RTN","PSBODL",16,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBODL",17,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(1)=PSBHDR(1)_Y_"  "
"RTN","PSBODL",18,0)
 .S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)_"-"
"RTN","PSBODL",19,0)
 .S Y=$P(PSBRPT(.1),U,9) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBODL",20,0)
 .S:$P(PSBRPT(.2),U,6) X="IV "
"RTN","PSBODL",21,0)
 .S:$P(PSBRPT(.2),U,7) X=X_$S(X]"":"& ",1:"")_"Unit Dose "
"RTN","PSBODL",22,0)
 .S PSBHDR(2)="Order Type(s): "_X_" -- "
"RTN","PSBODL",23,0)
 .F Y=1:1:4 S:$P(PSBRPT(.2),U,Y) PSBHDR(2)=PSBHDR(2)_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" "
"RTN","PSBODL",24,0)
 .D PRINT(DFN)
"RTN","PSBODL",25,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBODL",26,0)
 Q
"RTN","PSBODL",27,0)
PRINT(DFN) ;^TMP($J.
"RTN","PSBODL",28,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBODATE,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBODL",29,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBODL",30,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG
"RTN","PSBODL",31,0)
 W $$HDR()
"RTN","PSBODL",32,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBODL",33,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBODL",34,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBODL",35,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBODL",36,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBODL",37,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR() Q
"RTN","PSBODL",38,0)
 S PSBINDX=0
"RTN","PSBODL",39,0)
 F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBODL",40,0)
 .S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBODL",41,0)
 .Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pend this ver
"RTN","PSBODL",42,0)
 .S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBODL",43,0)
 .I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,8)) Q
"RTN","PSBODL",44,0)
 .Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBODL",45,0)
 .Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBODL",46,0)
 .S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBODL",47,0)
 .S Y=$P(PSBSTAT,U,2)
"RTN","PSBODL",48,0)
 .Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBODL",49,0)
 .Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBODL",50,0)
 .Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBODL",51,0)
 .Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBODL",52,0)
 .S PSBSCHT=Y
"RTN","PSBODL",53,0)
 .S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBODL",54,0)
 .S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBODL",55,0)
 .S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBODL",56,0)
 .S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBODL",57,0)
 I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR() Q
"RTN","PSBODL",58,0)
 S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBODL",59,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBODL",60,0)
 .K PSBORD,PSBFUTRO
"RTN","PSBODL",61,0)
 .S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBODL",62,0)
 .S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBODL",63,0)
 .S PSBMED=$QS(PSBGBL,6)
"RTN","PSBODL",64,0)
 .S PSBORD=$QS(PSBGBL,7)
"RTN","PSBODL",65,0)
 .D CLEAN^PSBVT
"RTN","PSBODL",66,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL",67,0)
 .D NOW^%DTC S PSBNOW=%
"RTN","PSBODL",68,0)
 .Q:PSBOSP<PSBOSTRT
"RTN","PSBODL",69,0)
 .Q:(PSBOSP<PSBOSTRT)&(PSBSCHT'="O")
"RTN","PSBODL",70,0)
 .S (PSBYES,PSBODD,PSBDAYB,PSBSCBR)=0
"RTN","PSBODL",71,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYB=1
"RTN","PSBODL",72,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBSCBR=1
"RTN","PSBODL",73,0)
 .I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBODL",74,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBODL",75,0)
 .I PSBSCHT="OC" S PSBYES=1
"RTN","PSBODL",76,0)
 .I PSBSCHT="P" S PSBYES=1
"RTN","PSBODL",77,0)
 .I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBODL",78,0)
 .I PSBIVT["S",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",79,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",80,0)
 .I PSBIVT["C",PSBCHEMT="A" S PSBYES=1
"RTN","PSBODL",81,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL",82,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBODL",83,0)
 .I PSBSCHT="P" S PSBFREQ=1440
"RTN","PSBODL",84,0)
 .I PSBSCHT="O" S PSBFREQ=1440
"RTN","PSBODL",85,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",86,0)
 .S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMRAB)
"RTN","PSBODL",87,0)
 .I 'PSBDAYB,'PSBSCBR,PSBSCHT="C",PSBVALB="1",PSBADST'="",PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",88,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL",89,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBODL",90,0)
 .I PSBADST'="" D
"RTN","PSBODL",91,0)
 ..F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBODL",92,0)
 ...D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBODL",93,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBODL",94,0)
 .I PSBSCHT="C",PSBOTYP="U" Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)
"RTN","PSBODL",95,0)
 .I PSBSCHT="C",$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR),'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ) Q
"RTN","PSBODL",96,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBODL",97,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBODL",98,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",99,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",100,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",101,0)
 .S PSBRMN=1
"RTN","PSBODL",102,0)
 .I PSBSCHT="O",PSBOST'=PSBOSP,PSBOSP<PSBOSTRT S PSBRMN=0
"RTN","PSBODL",103,0)
 .Q:'PSBRMN
"RTN","PSBODL",104,0)
 .I PSBOST>$$FMADD^XLFDT(PSBNOW,"","",+($$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)="" Q
"RTN","PSBODL",105,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBODL",106,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBODL",107,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",108,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",109,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",110,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL",111,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL",112,0)
 ..S PSBIEN=""
"RTN","PSBODL",113,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL",114,0)
 ...S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBODL",115,0)
 .S PSBADMIN="" K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL",116,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL",117,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL",118,0)
 ..D:PSBX=""
"RTN","PSBODL",119,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",120,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",121,0)
 ...I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",122,0)
 ...I "HA"[PSBIVT S:PSBIVT]"" PSBX="0000",PSBFLAG=0
"RTN","PSBODL",123,0)
 ..I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",124,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",125,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL",126,0)
 ..I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",127,0)
 ..I PSBX="" S:($G(PSBFREQ)>29)!(PSBFREQ="D") PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL",128,0)
 ..E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL",129,0)
 ..D:PSBX'=""
"RTN","PSBODL",130,0)
 ...F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL",131,0)
 ....F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL",132,0)
 .....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL",133,0)
 .....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)
"RTN","PSBODL",134,0)
 .....D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBODL",135,0)
 .....I (PSBZ(0)<0)&(PSBCNT=1) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",136,0)
 .....;I (PSBOST>PSBOSTRT),(PSBORD'["P"),('PSBFLAG) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",137,0)
 .....I (PSBAT'["."),($G(PSBORD)["V") I (PSBOST<PSBOSTOP),(PSBOST'<PSBOSTRT) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",138,0)
 .....Q:+PSBZ(0)<0
"RTN","PSBODL",139,0)
 .....I $G(PSBOST)'>$G(PSBAT) S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",140,0)
 .....E  I ($P($G(PSBOST),".")'>$P($G(PSBAT),"."))&($P($G(PSBAT),".",2)="") S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",141,0)
 ..I +$G(PSBFREQ)>0,$G(PSBFREQ)<30,PSBADMIN'="0000" S PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL",142,0)
 .I $Y>(IOSL-(12+($L(PSBADMIN)/27))) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR(),$$HDR()
"RTN","PSBODL",143,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL",144,0)
 .E  S PSBSM=""
"RTN","PSBODL",145,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL",146,0)
 .S X="",Y=0
"RTN","PSBODL",147,0)
 .W $$WRAP(14,34,PSBMED)
"RTN","PSBODL",148,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL",149,0)
 .W $$WRAP(50,27,PSBADM),?78,PSBMRAB
"RTN","PSBODL",150,0)
 .W ?85 D:PSBLGDT
"RTN","PSBODL",151,0)
 ..W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3),"@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL",152,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," "),?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," "),?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBODL",153,0)
 .W $S(PSBVNI]"":PSBVNI,1:"***"),!,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL",154,0)
 .W IOINHI
"RTN","PSBODL",155,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL",156,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL",157,0)
 ..W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL",158,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL",159,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL",160,0)
 .W IOINORM ; Hlight Off
"RTN","PSBODL",161,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL",162,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL",163,0)
 .S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBODL",164,0)
 .I $E(X,1)="!"  S $E(X,1)=""
"RTN","PSBODL",165,0)
 .W $$WRAP(14,34,"Spec Inst: "_X),!,$TR($J("",IOM)," ","-")
"RTN","PSBODL",166,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",167,0)
 W $$BLANKS(),$$FTR()
"RTN","PSBODL",168,0)
 S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBODL",169,0)
 I +$G(PSBORD)>0,$P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD)) D EN^PSBODL1
"RTN","PSBODL",170,0)
 Q
"RTN","PSBODL",171,0)
WRAP(X,Y,Z) ;
"RTN","PSBODL",172,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL",173,0)
 .W:$X>X !
"RTN","PSBODL",174,0)
 .W:$X<X ?X
"RTN","PSBODL",175,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL",176,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL",177,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL",178,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL",179,0)
 .S Z=$E(Z,PSB+1,255)
"RTN","PSBODL",180,0)
 Q ""
"RTN","PSBODL",181,0)
FTR() ;
"RTN","PSBODL",182,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL",183,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL",184,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL",185,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL",186,0)
 Q ""
"RTN","PSBODL",187,0)
HDR() ;
"RTN","PSBODL",188,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL",189,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL",190,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL",191,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL",192,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",193,0)
 Q ""
"RTN","PSBODL",194,0)
BLANKS() ;
"RTN","PSBODL",195,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL",196,0)
 W !
"RTN","PSBODL",197,0)
 D:$Y>(IOSL-26)
"RTN","PSBODL",198,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBODL",199,0)
 .W $$FTR(),$$HDR() ; New page - no room for blanks
"RTN","PSBODL",200,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL",201,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL",202,0)
 F X=1:1:4 D
"RTN","PSBODL",203,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",204,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBODL",205,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBODL",206,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBODL",207,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBODL",208,0)
 .W !?20,"Spec"
"RTN","PSBODL",209,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBODL",210,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBODL",211,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBODL",212,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",213,0)
 Q ""
"RTN","PSBODL1")
0^22^B27682091
"RTN","PSBODL1",1,0)
PSBODL1 ;BIRMINGHAM/VRN-DUE LIST ;Mar 2004
"RTN","PSBODL1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9**;Mar 2004 
"RTN","PSBODL1",3,0)
 ;
"RTN","PSBODL1",4,0)
 ; Reference/IA
"RTN","PSBODL1",5,0)
 ; ^XLFDT/10103
"RTN","PSBODL1",6,0)
EN ;
"RTN","PSBODL1",7,0)
 S PSBFOHDR=0
"RTN","PSBODL1",8,0)
 S PSBORD=0 F  S PSBORD=$O(^TMP("PSBO",$J,DFN,PSBORD)) Q:PSBORD=""  S PSBTYPE=$O(^TMP("PSBO",$J,DFN,PSBORD,"")) D
"RTN","PSBODL1",9,0)
 .D CLEAN^PSBVT
"RTN","PSBODL1",10,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL1",11,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL1",12,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL1",13,0)
 ..I PSBX="",PSBONX["V",PSBIVT'="P" S PSBFLAG=0
"RTN","PSBODL1",14,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBODL1",15,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBODL1",16,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBODL1",17,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P"  Q
"RTN","PSBODL1",18,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL1",19,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBODL1",20,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL1",21,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBODL1",22,0)
 ..D:PSBX=""
"RTN","PSBODL1",23,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",24,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",25,0)
 ...I PSBIVT="S",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",26,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",27,0)
 ..I ("SC"[PSBIVT),(PSBISYR=1) S PSBX=""
"RTN","PSBODL1",28,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S PSBX=""
"RTN","PSBODL1",29,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL1",30,0)
 ..I PSBIVT="P",$G(PSBX)=0 S PSBX=""
"RTN","PSBODL1",31,0)
 ..I PSBX="" S PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL1",32,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL1",33,0)
 ..S PSBADMIN=""
"RTN","PSBODL1",34,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL1",35,0)
 ...F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL1",36,0)
 ....Q:($P(PSBX,"-",PSBY)'?2N)&($P(PSBX,"-",PSBY)'?4N)
"RTN","PSBODL1",37,0)
 ....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL1",38,0)
 ....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)  ; Report Window
"RTN","PSBODL1",39,0)
 ....D VAL^PSBMLVAL(.PSBZ,DFN,PSBONX,PSBTYPE,PSBAT)
"RTN","PSBODL1",40,0)
 ....S:$G(PSBFREQ)>29 PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL1",41,0)
 ....S:$G(PSBFREQ)<30 PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL1",42,0)
 .I PSBSCHT'="C" S PSBADMIN=PSBADST
"RTN","PSBODL1",43,0)
 .; Get LAST GIVEN date/time
"RTN","PSBODL1",44,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL1",45,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL1",46,0)
 ..S PSBIEN=""
"RTN","PSBODL1",47,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL1",48,0)
 ...S:"MHNR"'[$P($G(^PSB(53.79,PSBIEN,0)),U,9) PSBLGDT=X
"RTN","PSBODL1",49,0)
 .I $Y>(IOSL-12) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR(),$$HDR()
"RTN","PSBODL1",50,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL1",51,0)
 .E  S PSBSM=""
"RTN","PSBODL1",52,0)
 .I 'PSBFOHDR S PSBFOHDR=1 W $$HDR()
"RTN","PSBODL1",53,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL1",54,0)
 .S X="",Y=0
"RTN","PSBODL1",55,0)
 .W $$WRAP(14,34,PSBOITX)
"RTN","PSBODL1",56,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",57,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",58,0)
 .W ?78,PSBMRAB
"RTN","PSBODL1",59,0)
 .W ?85 I PSBLGDT W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3) W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",60,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBODL1",61,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBODL1",62,0)
 .W ?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/",$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBODL1",63,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",64,0)
 .W IOINHI  ; To Highlight the Dispense Drugs...
"RTN","PSBODL1",65,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",66,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",67,0)
 ..W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",68,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",69,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",70,0)
 .W IOINORM ; Highlight Off
"RTN","PSBODL1",71,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",72,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",73,0)
 .S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBODL1",74,0)
 .I $E(X,1)="!"  S $E(X,1)=""
"RTN","PSBODL1",75,0)
 .W $$WRAP(14,34,"Spec Inst: "_X),!,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",76,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL1",77,0)
 W:PSBFOHDR $$BLANKS(),$$FTR()
"RTN","PSBODL1",78,0)
 Q
"RTN","PSBODL1",79,0)
 ;
"RTN","PSBODL1",80,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBODL1",81,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL1",82,0)
 .W:$X>X !
"RTN","PSBODL1",83,0)
 .W:$X<X ?X
"RTN","PSBODL1",84,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL1",85,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL1",86,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL1",87,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL1",88,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBODL1",89,0)
 Q ""
"RTN","PSBODL1",90,0)
 ;
"RTN","PSBODL1",91,0)
FTR() ; [Extrinsic] Page footer
"RTN","PSBODL1",92,0)
 ;
"RTN","PSBODL1",93,0)
 ; Sub Module Description:
"RTN","PSBODL1",94,0)
 ; (No Description Available)
"RTN","PSBODL1",95,0)
 ;
"RTN","PSBODL1",96,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL1",97,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL1",98,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL1",99,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL1",100,0)
 Q ""
"RTN","PSBODL1",101,0)
 ;
"RTN","PSBODL1",102,0)
HDR() ; Page Header
"RTN","PSBODL1",103,0)
 Q:'PSBFOHDR ""
"RTN","PSBODL1",104,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL1",105,0)
 W !
"RTN","PSBODL1",106,0)
 W !
"RTN","PSBODL1",107,0)
 W !,?(IOM-28\2),"*****   FUTURE ORDERS   *****"
"RTN","PSBODL1",108,0)
 W !
"RTN","PSBODL1",109,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL1",110,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL1",111,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL1",112,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",113,0)
 Q ""
"RTN","PSBODL1",114,0)
 ;
"RTN","PSBODL1",115,0)
BLANKS() ; [Extrinsic] Print blanks at end of printout for changes
"RTN","PSBODL1",116,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL1",117,0)
 W !
"RTN","PSBODL1",118,0)
 I $Y>(IOSL-26) W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)" W $$FTR(),$$HDR() ; Not enough space - new page
"RTN","PSBODL1",119,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL1",120,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL1",121,0)
 F X=1:1:4 D
"RTN","PSBODL1",122,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",123,0)
 .W !!?3,"CON ___ PRN ___",?20,"Drug: ",$TR($J("",22)," ","_"),?50,"Give: ",$TR($J("",42)," ","_"),?100,"Start: _________ Stop: _________"
"RTN","PSBODL1",124,0)
 .W !?20,"Spec"
"RTN","PSBODL1",125,0)
 .W !?3,"OT  ___ OC  ___",?20,"Inst: ",$TR($J("",72)," ","_"),?100,"Initials: ______ Date: _________"
"RTN","PSBODL1",126,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",127,0)
 Q ""
"RTN","PSBODL1",128,0)
 ;
"RTN","PSBOMH")
0^23^B78896723
"RTN","PSBOMH",1,0)
PSBOMH ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9**;Mar 2004
"RTN","PSBOMH",3,0)
 ;
"RTN","PSBOMH",4,0)
 ; Reference/IA
"RTN","PSBOMH",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH",6,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMH",7,0)
 ; File 200/10060
"RTN","PSBOMH",8,0)
 ; ^DIWP/10011
"RTN","PSBOMH",9,0)
 ;
"RTN","PSBOMH",10,0)
EN ; Called from DQ^PSBO
"RTN","PSBOMH",11,0)
 N PSBGBL,DFN
"RTN","PSBOMH",12,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBOMH",13,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOMH",14,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOMH",15,0)
 .S (PSBSTRT,X)=$P(PSBRPT(.1),U,6) D H^%DTC S PSBSTH=%H
"RTN","PSBOMH",16,0)
 .S (PSBSTOP,X)=$P(PSBRPT(.1),U,8)+.235959 D H^%DTC S PSBSPH=%H
"RTN","PSBOMH",17,0)
 .S PSBCNT=0 F I=PSBSTH:1:PSBSPH S PSBAR(I)=PSBSTH+((PSBCNT\7)*7),PSBCNT=PSBCNT+1
"RTN","PSBOMH",18,0)
 .D EN1
"RTN","PSBOMH",19,0)
 K PSBCNT,PSBAR Q
"RTN","PSBOMH",20,0)
EN1 ; Expects DFN,STRT,STOP
"RTN","PSBOMH",21,0)
 N PSBGBL,PSBHDR,PSBX,PSBFLAG
"RTN","PSBOMH",22,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH",23,0)
 S PSBEVDT=PSBSTRT
"RTN","PSBOMH",24,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMH",25,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****" Q  ; No Ord
"RTN","PSBOMH",26,0)
 S PSBX=""
"RTN","PSBOMH",27,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMH",28,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,0),U,3)?.N1"P"  ; No Pnd
"RTN","PSBOMH",29,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,1),U,5)<PSBSTRT!($P(^TMP("PSJ",$J,PSBX,1),U,4)>PSBSTOP)  ;display orders active in date range of report
"RTN","PSBOMH",30,0)
 .S X=$P(^TMP("PSJ",$J,PSBX,1),U,2)
"RTN","PSBOMH",31,0)
 .S ^TMP("PSB",$J,"ORDERS",$P(^TMP("PSJ",$J,PSBX,0),U,3))=X
"RTN","PSBOMH",32,0)
 I '$D(^TMP("PSB",$J,"ORDERS")) D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****" Q    ; No Orders
"RTN","PSBOMH",33,0)
 S PSBMHND="PSBOMH"
"RTN","PSBOMH",34,0)
 ; Act on Orders
"RTN","PSBOMH",35,0)
 S PSBX="" F  S PSBX=$O(^TMP("PSB",$J,"ORDERS",PSBX)) Q:PSBX=""  S PSBTYPE=^(PSBX) D
"RTN","PSBOMH",36,0)
 .S:PSBTYPE'="C" PSBTYPE="P"
"RTN","PSBOMH",37,0)
 .D CLEAN^PSBVT
"RTN","PSBOMH",38,0)
 .D PSJ1^PSBVT(DFN,PSBX)
"RTN","PSBOMH",39,0)
 .S X1=((PSBEVDT)\1)  S X2=-1  D C^%DTC  S PSBCNTST=X
"RTN","PSBOMH",40,0)
 .S X1=((PSBSTOP)\1)  S X2=1  D C^%DTC  S PSBXSTOP=X
"RTN","PSBOMH",41,0)
 .S PSBVALB=""
"RTN","PSBOMH",42,0)
 .S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMRAB)
"RTN","PSBOMH",43,0)
 .S PSBZ=""
"RTN","PSBOMH",44,0)
 .S X1=PSBXSTOP,X2=PSBCNTST D ^%DTC S PSBNCT=X
"RTN","PSBOMH",45,0)
 .F PSBZ=1:1:PSBNCT S X1=PSBCNTST  S X2=1  D C^%DTC  S PSBCNTST=X  D
"RTN","PSBOMH",46,0)
 ..I (PSBX["V")!(PSBX'["V")  D
"RTN","PSBOMH",47,0)
 ...I PSBCNTST'>(PSBOST\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",48,0)
 ...I PSBCNTST=(PSBOST\1)!($G(^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST))) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)
"RTN","PSBOMH",49,0)
 ...I PSBCNTST>(PSBOSP\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",50,0)
 ...I PSBCNTST=(PSBOSP\1)&($G(^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST))) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",51,0)
 ..S PSBDODD=""
"RTN","PSBOMH",52,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBDODD=1
"RTN","PSBOMH",53,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),((PSBDODD="1")&(PSBADST'="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",54,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),('$$OKAY^PSBVDLU1(PSBOST,PSBCNTST,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""  ;W t TMP
"RTN","PSBOMH",55,0)
 .S (PSBYES,PSBODD,PSBFLAG,PSBYTFN,PSBDAYN)=0
"RTN","PSBOMH",56,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYN=1
"RTN","PSBOMH",57,0)
 .I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" Q 
"RTN","PSBOMH",58,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTFN=1
"RTN","PSBOMH",59,0)
 .I (PSBFREQ="O")!(PSBTYPE="P") S PSBYES=1
"RTN","PSBOMH",60,0)
 .I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMH",61,0)
 .;flg / admn t
"RTN","PSBOMH",62,0)
 .S:PSBONX["U" PSBFLAG=1
"RTN","PSBOMH",63,0)
 .I PSBIVT="A" S PSBADST="0000"
"RTN","PSBOMH",64,0)
 .I PSBIVT="H" S PSBADST="0000"
"RTN","PSBOMH",65,0)
 .I PSBIVT="C",PSBCHEMT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",66,0)
 .I PSBIVT="C",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",67,0)
 .I PSBIVT="C",PSBCHEMT="A" S PSBADST="0000"
"RTN","PSBOMH",68,0)
 .I PSBIVT="C",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",69,0)
 .I PSBIVT="P",($G(PSBADST)=0) S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",70,0)
 .I PSBIVT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",71,0)
 .I PSBIVT="S",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",72,0)
 .I PSBIVT="S",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",73,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOMH",74,0)
 .I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMH",75,0)
 .S (PSBEE,PSBZZ)=0
"RTN","PSBOMH",76,0)
 .I (PSBVALB="1")!(PSBX'["V") D  Q:(PSBEE!PSBZZ)=1
"RTN","PSBOMH",77,0)
 ..I PSBSCHT="C",PSBYTFN="1",PSBADST=""  S PSBEE=1
"RTN","PSBOMH",78,0)
 ..I PSBSCHT="C",PSBDAYN'="1",PSBYTFN'="1",PSBADST'="",PSBFREQ<1  S PSBZZ=1
"RTN","PSBOMH",79,0)
 .I 'PSBODD,PSBFLAG,PSBTYPE="C",PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBSTOP)
"RTN","PSBOMH",80,0)
 .E  I PSBADST'="" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOMH",81,0)
 .;Calc adm/frq
"RTN","PSBOMH",82,0)
 .S PSBDT=PSBSTRT
"RTN","PSBOMH",83,0)
 .K PSBO,^UTILITY($J)
"RTN","PSBOMH",84,0)
 .F X=1:1:8 S PSBO(X)=""
"RTN","PSBOMH",85,0)
 .S DIWL=0,DIWR=32,DIWF="C32"
"RTN","PSBOMH",86,0)
 .S X=$P(PSBOSTX," ")_"          "_$P(PSBOSPX," ") D ^DIWP
"RTN","PSBOMH",87,0)
 .S X="@"_$P(PSBOSTX," ",3)_"              @"_$P(PSBOSPX," ",3)_"   " D ^DIWP
"RTN","PSBOMH",88,0)
 .S X="" D ^DIWP
"RTN","PSBOMH",89,0)
 .S X=PSBOITX D ^DIWP
"RTN","PSBOMH",90,0)
 .; DD,SOL,ADD
"RTN","PSBOMH",91,0)
 .S X=""
"RTN","PSBOMH",92,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBDDA(Y),U,3)
"RTN","PSBOMH",93,0)
 .F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBADA(Y),U,3)_" "_$P(PSBADA(Y),U,4)_$P(PSBADA(Y),U,5)
"RTN","PSBOMH",94,0)
 .F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBSOLA(Y),U,3)_" "_$P(PSBSOLA(Y),U,4)
"RTN","PSBOMH",95,0)
 .S X=" "_X,DIWF="I2C32" D ^DIWP S DIWF="C32"
"RTN","PSBOMH",96,0)
 .S PSBTXT=" Give: "_PSBDOSE_" "_PSBMRAB_" "_PSBSCH_" "_PSBIFR
"RTN","PSBOMH",97,0)
 .F  S PSBWORD=$P(PSBTXT," ",1),PSBTXT=$P(PSBTXT," ",2,250) D  Q:PSBTXT=""
"RTN","PSBOMH",98,0)
 ..F  Q:'$L(PSBWORD)  S X=$E(PSBWORD,1,30),PSBWORD=$E(PSBWORD,30,250) D ^DIWP
"RTN","PSBOMH",99,0)
 .K ^TMP("PSJ",$J) D EN^PSJBCMA2(DFN,PSBX) I ^TMP("PSJ",$J,0)'=-1 D   ;get activity log
"RTN","PSBOMH",100,0)
 ..S (PSBDISX,PSBHLDX)=0 F I=1:1:$P(^TMP("PSJ",$J,0),U,4) S X=$G(^TMP("PSJ",$J,I,1)) D  ;loop activities
"RTN","PSBOMH",101,0)
 ...Q:X["EDITED"!(X["VERIF")  ;
"RTN","PSBOMH",102,0)
 ...S Z=0
"RTN","PSBOMH",103,0)
 ...I X'["OFF HOLD",X'["UNHOLD",X'["REINSTATE" S Z=1 ; inc iv's
"RTN","PSBOMH",104,0)
 ...S PSBHLDX=PSBHLDX+$S(Z>0:1,1:0)
"RTN","PSBOMH",105,0)
 ...S $P(PSBHLD(PSBHLDX),U,$S(Z>0:1,1:11))=^TMP("PSJ",$J,I,1)  ;set up for multiple on hold entries save start & stop as pair if exists 
"RTN","PSBOMH",106,0)
 ..F PSBHLDX=1:1 S X=$G(PSBHLD(PSBHLDX)) Q:'X  D  ;if a hold index - process 
"RTN","PSBOMH",107,0)
 ...S PSBHLDN=$P(PSBHLD(PSBHLDX),U,1),PSBHLDF=$P(PSBHLD(PSBHLDX),U,11)  ;get on/off hold, dates, IEN number(for UD orders) of person. 
"RTN","PSBOMH",108,0)
 ...Q:PSBHLDN>PSBSTOP  Q:(PSBHLDF<PSBSTRT)&(PSBHLDF'="") 
"RTN","PSBOMH",109,0)
 ...F PSBHLDT=PSBSTRT\1:1:PSBSTOP\1 I (PSBHLDT'<(PSBHLDN\1)),(PSBHLDT'>PSBSTOP) D
"RTN","PSBOMH",110,0)
 ....I X["DISCONTINUED" K ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT) S ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT)=""
"RTN","PSBOMH",111,0)
 ....I (X["HOLD")&((PSBHLDN\1)'>PSBHLDT)&((PSBHLDF'<PSBHLDT)!(PSBHLDF="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)=""
"RTN","PSBOMH",112,0)
 ....I X["REINSTATE" K ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT) I PSBOSTS="H" S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)=""
"RTN","PSBOMH",113,0)
 ...F PSBHLDXP=1:10:$P(PSBHLD(PSBHLDX),U,11)]""+10 D
"RTN","PSBOMH",114,0)
 ....S PSBDESC=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+3),X=$S(PSBDESC["DISCONTINUE":"***",1:"")
"RTN","PSBOMH",115,0)
 ....S X=" "_X_PSBDESC D ^DIWP  ;output activity text 
"RTN","PSBOMH",116,0)
 ....S X="",PSBHLDI=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+4) I PSBHLDI'="" S X=$$GET1^DIQ(200,PSBHLDI,"INITIAL")
"RTN","PSBOMH",117,0)
 ....S:X="" X="99" ;no init present
"RTN","PSBOMH",118,0)
 ....I X'="99" S X=" "_X D ^DIWP   ;get init & store
"RTN","PSBOMH",119,0)
 ....S Y=$P(PSBHLD(PSBHLDX),U,PSBHLDXP) D DD^%DT S X=Y D ^DIWP  ;format hold date / write 
"RTN","PSBOMH",120,0)
 ..K PSBHLD,PSBHLDF,PSBHLDN,PSBHLDT,PSBHLDX,PSBHLDXP,PSBHLDI,PSBDISX,PSBDISC,PSBDISXP,PSBDISI,PSBDIST,PSBDISN,PSBDESC
"RTN","PSBOMH",121,0)
 .I PSBOTXT]"" D
"RTN","PSBOMH",122,0)
 ..I $E(PSBOTXT,1)="!"  S $E(PSBOTXT,1)=""
"RTN","PSBOMH",123,0)
 ..S PSBOTXT=" Spec Inst: "_PSBOTXT
"RTN","PSBOMH",124,0)
 ..F  S PSBWORD=$P(PSBOTXT," ",1),PSBOTXT=$P(PSBOTXT," ",2,250) D  Q:PSBOTXT=""
"RTN","PSBOMH",125,0)
 ...F  Q:'$L(PSBWORD)  S X=$E(PSBWORD,1,30),PSBWORD=$E(PSBWORD,30,250) D ^DIWP
"RTN","PSBOMH",126,0)
 .F X=0:0 S X=$O(^UTILITY($J,"W",0,X)) Q:'X  S PSBO(X)=$G(^(X,0)) D
"RTN","PSBOMH",127,0)
 .S X=$O(PSBO(""),-1) S X=$S(X<8:8,1:X+1)
"RTN","PSBOMH",128,0)
 .S PSBO(X)=" RPH: "_PSBVPHI_"  RN: "_PSBVNI
"RTN","PSBOMH",129,0)
 .S PSBVAL=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMRAB)
"RTN","PSBOMH",130,0)
 .I PSBODD="1",PSBADST'="" D
"RTN","PSBOMH",131,0)
 ..I (PSBVAL="1")!(PSBX'["V") D   ;checks iv/pb and u dose
"RTN","PSBOMH",132,0)
 ...S PSBO(X+1)=""
"RTN","PSBOMH",133,0)
 ...S PSBO(X+2)="NOTE - ODD SCHEDULE NO LONGER",PSBO(X+3)="       ALLOWS ADMIN TIMES."
"RTN","PSBOMH",134,0)
 .K ^UTILITY($J)
"RTN","PSBOMH",135,0)
 .M ^TMP("PSB",$J,"ORDERS",PSBX,"INST")=PSBO
"RTN","PSBOMH",136,0)
 .D:PSBTYPE="C"
"RTN","PSBOMH",137,0)
 ..F  D  Q:PSBDT>PSBSTOP
"RTN","PSBOMH",138,0)
 ...S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",139,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBONX)=""
"RTN","PSBOMH",140,0)
 ...; Odd schd - msg
"RTN","PSBOMH",141,0)
 ...S PSBIDOW=0 I PSBONX["U"!("PCS"[PSBIVT) S PSBIDOW=1
"RTN","PSBOMH",142,0)
 ...I PSBADST="",PSBIDOW,(PSBODD) D
"RTN","PSBOMH",143,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=7
"RTN","PSBOMH",144,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="odd"
"RTN","PSBOMH",145,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="sched"
"RTN","PSBOMH",146,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBSCH,1,5)
"RTN","PSBOMH",147,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="no"
"RTN","PSBOMH",148,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)="fixed"
"RTN","PSBOMH",149,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",6)="admin"
"RTN","PSBOMH",150,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",7)="times"
"RTN","PSBOMH",151,0)
 ...I PSBADST'="",PSBADST'="0000",+$G(PSBFREQ)>0,+$G(PSBFREQ)<45 D
"RTN","PSBOMH",152,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=5
"RTN","PSBOMH",153,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="Due"
"RTN","PSBOMH",154,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="every"
"RTN","PSBOMH",155,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBFREQ,1,5)
"RTN","PSBOMH",156,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="mins."
"RTN","PSBOMH",157,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)=" "
"RTN","PSBOMH",158,0)
 ...S PSBATCNT=0    ; # times to print...
"RTN","PSBOMH",159,0)
 ...I PSBADST'="",((+$G(PSBFREQ)>44)!(PSBFREQ="")!(PSBADST="0000")) F PSBXX=0:1  Q:$G(^TMP("PSB",$J,"GETADMIN",PSBXX))=""  D
"RTN","PSBOMH",160,0)
 ....S PSBADST2=$G(^TMP("PSB",$J,"GETADMIN",PSBXX))
"RTN","PSBOMH",161,0)
 ....F Y=1:1:$L(PSBADST2,"-") D
"RTN","PSBOMH",162,0)
 .....Q:($P(PSBADST2,"-",Y)'?2N)&($P(PSBADST2,"-",Y)'?4N)  S PSBATCNT=PSBATCNT+1,^TMP("PSB",$J,"ORDERS",PSBONX,"AT",PSBATCNT)=$P(PSBADST2,"-",Y)
"RTN","PSBOMH",163,0)
 ...I PSBADST'="",PSBFREQ>44 S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=PSBATCNT
"RTN","PSBOMH",164,0)
 ...S ^TMP("PSB",$J,PSBWEEK,"SORT",PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",165,0)
 ...F PSBDOW=0:1:6 D  Q:X>(PSBSTOP-1)
"RTN","PSBOMH",166,0)
 ....S %H=PSBWEEK+PSBDOW D YMD^%DTC
"RTN","PSBOMH",167,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBONX,X,0)=0
"RTN","PSBOMH",168,0)
 ....I '$D(^TMP("PSB",$J,PSBWEEK,"HDR",X)) S ^TMP("PSB",$J,PSBWEEK,"HDR",X)=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","PSBOMH",169,0)
 ...S %H=PSBWEEK+7 D YMD^%DTC S PSBDT=X
"RTN","PSBOMH",170,0)
 .D:PSBTYPE'="C"
"RTN","PSBOMH",171,0)
 ..S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",172,0)
 ..S (^TMP("PSB",$J,PSBWEEK,PSBONX),^TMP("PSB",$J,PSBWEEK,PSBONX,"AT",0))="",^TMP("PSB",$J,PSBWEEK,"SORT",PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",173,0)
 D EN^PSBOMH1,EN^PSBOMH2
"RTN","PSBOMH",174,0)
 Q
"RTN","PSBOMH",175,0)
INSTR S PSBINIT=PSBINIT_"*"
"RTN","PSBOMH",176,0)
 S PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."),0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBOMH",177,0)
 Q
"RTN","PSBOMH",178,0)
 ;
"RTN","PSBOMH1")
0^24^B78481809
"RTN","PSBOMH1",1,0)
PSBOMH1 ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,9**;Mar 2004
"RTN","PSBOMH1",3,0)
 ;
"RTN","PSBOMH1",4,0)
 ; Reference/IA
"RTN","PSBOMH1",5,0)
 ; ^DILF/2054
"RTN","PSBOMH1",6,0)
 ; File 200/10060
"RTN","PSBOMH1",7,0)
 ;
"RTN","PSBOMH1",8,0)
EN ;
"RTN","PSBOMH1",9,0)
 ; Load administrations
"RTN","PSBOMH1",10,0)
 S (PSBORD,PSBIEN,PSBR1,PSBADIEN,PSBABR)="",PSBDT=PSBSTRT
"RTN","PSBOMH1",11,0)
 K PSBTSA
"RTN","PSBOMH1",12,0)
 F  S PSBDT=$O(^PSB(53.79,"AADT",DFN,PSBDT)) Q:'PSBDT!(PSBDT>PSBSTOP)  D
"RTN","PSBOMH1",13,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBDT,PSBIEN)) Q:'PSBIEN  Q:'$D(^PSB(53.79,PSBIEN))  L +^PSB(53.79,PSBIEN) D  L -^PSB(53.79,PSBIEN)
"RTN","PSBOMH1",14,0)
 ..Q:'$P($G(^PSB(53.79,PSBIEN,0)),U,6)  ; Bad entry -no event dt
"RTN","PSBOMH1",15,0)
 ..Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"  ;Not Given
"RTN","PSBOMH1",16,0)
 ..S PSBORD=$P($G(^PSB(53.79,PSBIEN,.1)),U,1)
"RTN","PSBOMH1",17,0)
 ..; Continuous  <===*
"RTN","PSBOMH1",18,0)
 ..D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)="C"
"RTN","PSBOMH1",19,0)
 ...S X=PSBDT D H^%DTC S PSBWEEK=PSBAR(%H) D CLEAN^PSBVT,PSJ1^PSBVT($P(^PSB(53.79,PSBIEN,0),U,1),$P(^PSB(53.79,PSBIEN,.1),U,1))
"RTN","PSBOMH1",20,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,6)'=PSBDT,'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR) D  D CLEAN^PSBVT Q  ;check IV audit
"RTN","PSBOMH1",21,0)
 ....S PSBSIEN=PSBIEN
"RTN","PSBOMH1",22,0)
 ....I $P(^PSB(53.79,PSBIEN,0),"^",10)]"" D BAGDTL^PSBRPC2(.PSBAUD,$P(^PSB(53.79,PSBIEN,0),U,10),$P(^PSB(53.79,PSBIEN,.1),U,1))
"RTN","PSBOMH1",23,0)
 ....S PSBIEN=PSBSIEN K PSBSIEN
"RTN","PSBOMH1",24,0)
 ....S X=0 F  S X=$O(PSBAUD(X)) Q:X=""  I $P(PSBAUD(X),U,3)="" K PSBAUD(X)
"RTN","PSBOMH1",25,0)
 ....S X=0 F  S X=$O(PSBAUD(X)) Q:X=""  Q:$P(PSBAUD(X),U,1)=PSBDT
"RTN","PSBOMH1",26,0)
 ....I X="" K PSBAUD Q
"RTN","PSBOMH1",27,0)
 ....I '$D(PSBAUD(X)) K PSBAUD Q
"RTN","PSBOMH1",28,0)
 ....S PSBS=$P(PSBAUD(X),U,3)
"RTN","PSBOMH1",29,0)
 ....I PSBS="GIVEN",$P($G(PSBAUD(X-1)),U,3)="NOT GIVEN" Q
"RTN","PSBOMH1",30,0)
 ....I PSBS="NOT GIVEN" Q
"RTN","PSBOMH1",31,0)
 ....S PSBS=$S(PSBS="INFUSING":"I",PSBS="GIVEN":"G",PSBS="COMPLETED":"C",PSBS="HELD":"H",PSBS="REFUSED":"R",PSBS="REMOVED":"RM",PSBS="STOPPED":"S",PSBS["MISSING":"M",1:"NOACTION")
"RTN","PSBOMH1",32,0)
 ....D PSBSTIV
"RTN","PSBOMH1",33,0)
 ....S X=PSBDT_U_$P(PSBAUD(X),U,2)_U_PSBS_U_PSBIEN
"RTN","PSBOMH1",34,0)
 ....S Y=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,""),-1)+1
"RTN","PSBOMH1",35,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,Y)=X
"RTN","PSBOMH1",36,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,0)=Y
"RTN","PSBOMH1",37,0)
 ....D PSBOUT($P((X),"^",1),$P((X),"^",2))
"RTN","PSBOMH1",38,0)
 ....K PSBAUD
"RTN","PSBOMH1",39,0)
 ...S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBOMH1",40,0)
 ...S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH1",41,0)
 ...I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",42,0)
 ...;get instrct info - audit log
"RTN","PSBOMH1",43,0)
 ...I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",44,0)
 ....D INSTR^PSBOMH
"RTN","PSBOMH1",45,0)
 ....S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",46,0)
 ...I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",47,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,9)="G",PSBDT=$P(^PSB(53.79,PSBIEN,0),U,6)  D PSBCK1^PSBOMH2("A")
"RTN","PSBOMH1",48,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,9)'="G",PSBDT=$P(^PSB(53.79,PSBIEN,0),U,6)  D PSBCK1^PSBOMH2("B")
"RTN","PSBOMH1",49,0)
 ...I PSBDT'=$P(^PSB(53.79,PSBIEN,0),U,6),$P(^PSB(53.79,PSBIEN,0),U,9)="RM" D
"RTN","PSBOMH1",50,0)
 ....D DDAUD
"RTN","PSBOMH1",51,0)
 ....S I="" F  S I=$O(PSBTAR(I),-1) Q:I=""  I $P(PSBTAR(I),U,1)=PSBDT D
"RTN","PSBOMH1",52,0)
 .....S PSBS=$P(PSBTAR(I),U,3)
"RTN","PSBOMH1",53,0)
 .....I PSBS="GIVEN",$P($G(PSBTAR(I-1)),U,3)="NOT GIVEN" Q  ; giv canceled - not given
"RTN","PSBOMH1",54,0)
 .....I PSBS="NOT GIVEN" Q
"RTN","PSBOMH1",55,0)
 .....S PSBS=$S(PSBS="INFUSING":"I",PSBS="GIVEN":"G",PSBS="COMPLETED":"C",PSBS="HELD":"H",PSBS="REFUSED":"R",PSBS="REMOVED":"RM",PSBS="STOPPED":"S",PSBS["MISSING":"M",1:"NO ACTION")
"RTN","PSBOMH1",56,0)
 .....D PSBCTAR
"RTN","PSBOMH1",57,0)
 .....S X=$P(PSBTAR(I),U,1,2)_U_PSBS_U_PSBIEN
"RTN","PSBOMH1",58,0)
 ...Q:$P(X,U,2)=""
"RTN","PSBOMH1",59,0)
 ...S Y=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,""),-1)+1
"RTN","PSBOMH1",60,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,Y)=X
"RTN","PSBOMH1",61,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,0)=Y
"RTN","PSBOMH1",62,0)
 ...D PSBOUT($P((X),"^",1),$P((X),"^",2))
"RTN","PSBOMH1",63,0)
 ...Q
"RTN","PSBOMH1",64,0)
 ..; 1-Time On Call or PRN <===*
"RTN","PSBOMH1",65,0)
 ..D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)'="C"
"RTN","PSBOMH1",66,0)
 ...I PSBDT'=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I") Q
"RTN","PSBOMH1",67,0)
 ...S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBOMH1",68,0)
 ...S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH1",69,0)
 ...I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",70,0)
 ...S (PSBXA,PSBM)=1,(PSBZ,PSBT,PSBFLG)=""
"RTN","PSBOMH1",71,0)
 ...I $$GET1^DIQ(53.79,PSBIEN_",",.09)="REMOVED"  D
"RTN","PSBOMH1",72,0)
 ....F I=1:1 S PSBXA=$O(^PSB(53.79,PSBIEN,.9,PSBXA)) Q:PSBXA=""  I PSBXA?1.3N  S PSBZ=PSBZ+1,PSBT(PSBZ)=^PSB(53.79,PSBIEN,.9,PSBXA,0)
"RTN","PSBOMH1",73,0)
 ....F S=1:1 Q:PSBM<1  S PSBM=PSBZ-S  I (PSBM>0) I (PSBT(PSBM)["GIVEN")  S PSBFLG="1" S PRELINE1=$P(PSBT(PSBM),"'",2)_" "_$$GET1^DIQ(53.79,PSBIEN_",",.04)_" "_$E($P(PSBT(PSBM),"'",4),1,3) Q
"RTN","PSBOMH1",74,0)
 ...I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",75,0)
 ....D INSTR^PSBOMH
"RTN","PSBOMH1",76,0)
 ....S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",77,0)
 ...I '$D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,".")))  D PSBOUT(PSBDT,PSBINIT)
"RTN","PSBOMH1",78,0)
 ...S PSBLINE1=$$GET1^DIQ(53.79,PSBIEN_",",.09)_" "_$$GET1^DIQ(53.79,PSBIEN_",",.06)_" "_PSBINIT_"            "_$$GET1^DIQ(53.79,PSBIEN_",",.21),PSBLINE2=""
"RTN","PSBOMH1",79,0)
 ...I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",80,0)
 ...D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)="P"
"RTN","PSBOMH1",81,0)
 ....I $P($G(^PSB(53.79,PSBIEN,.2)),U,2)="" S PSBLINE2="  Results: <No PRN Results On File>"
"RTN","PSBOMH1",82,0)
 ....E  D
"RTN","PSBOMH1",83,0)
 .....S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","PRN EFFECTIVENESS ENTERED BY:INITIAL")
"RTN","PSBOMH1",84,0)
 .....S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","PRN EFFECTIVENESS ENTERED BY:NAME")
"RTN","PSBOMH1",85,0)
 .....I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",86,0)
 .....I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",87,0)
 ......S PSBINIT=PSBINIT_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."),0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",88,0)
 ......S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",89,0)
 .....I '$D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,".")))  D
"RTN","PSBOMH1",90,0)
 ......D:$D(^PSB(53.79,PSBIEN,.9,0))
"RTN","PSBOMH1",91,0)
 .......S (PSBXA2,PSBFG)=0,PSBEFFDT=$P(^PSB(53.79,PSBIEN,.2),U,4) F  S PSBXA2=$O(^PSB(53.79,PSBIEN,.9,PSBXA2)) Q:+PSBXA2'>0  D  Q:PSBFG=1
"RTN","PSBOMH1",92,0)
 ........D:($P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U)=PSBEFFDT)&($P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,3)["Instruct")&($P(^PSB(53.79,PSBIEN,.2),U,3)=$P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,2))
"RTN","PSBOMH1",93,0)
 .........S PSBINIT=PSBINIT_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",94,0)
 .........S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)="",PSBFG=1
"RTN","PSBOMH1",95,0)
 .....S PSBLINE2="  Results: "_$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBOMH1",96,0)
 .....S PSBRTXTW="     Entered By "_PSBINIT_" on "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",97,0)
 .....I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",98,0)
 ...S X=PSBDT D H^%DTC F PSBWEEK=PSBAR(%H):-7 Q:$D(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",0))!('$D(PSBAR(PSBWEEK)))
"RTN","PSBOMH1",99,0)
 ...S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)+1
"RTN","PSBOMH1",100,0)
 ...I PSBFLG="1" S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X)=PRELINE1
"RTN","PSBOMH1",101,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+1)=PSBLINE1
"RTN","PSBOMH1",102,0)
 ...I $G(PSBLINE2)]"" D
"RTN","PSBOMH1",103,0)
 ....I $L(PSBLINE2)<90 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+2)=PSBLINE2 S:$$GET1^DIQ(53.79,PSBIEN_",",.24)'="" ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+3)="      "_PSBRTXTW
"RTN","PSBOMH1",104,0)
 ....I $L(PSBLINE2)>90 D
"RTN","PSBOMH1",105,0)
 .....S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+2)=$E(PSBLINE2,1,90)
"RTN","PSBOMH1",106,0)
 .....S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+3)="           "_$E(PSBLINE2,91,161)
"RTN","PSBOMH1",107,0)
 .....I $L(PSBLINE2)'>161 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+4)="      "_PSBRTXTW
"RTN","PSBOMH1",108,0)
 .....I $L(PSBLINE2)>161 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+4)="     "_$E(PSBLINE2,162,200),^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+5)="     "_PSBRTXTW
"RTN","PSBOMH1",109,0)
 Q
"RTN","PSBOMH1",110,0)
 ;
"RTN","PSBOMH1",111,0)
DDAUD ;  audits for dispense drugs
"RTN","PSBOMH1",112,0)
 ;
"RTN","PSBOMH1",113,0)
 M PSBMLA=^PSB(53.79,PSBIEN)
"RTN","PSBOMH1",114,0)
 S PSBGA="" I $D(PSBMLA(.9,0)) D
"RTN","PSBOMH1",115,0)
 .F PSBX=1:1 Q:'$D(PSBMLA(.9,PSBX))  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D  Q
"RTN","PSBOMH1",116,0)
 ..I $D(PSBMLA(.9,PSBX-2,0)) D DT^DILF("ENPST",$P(PSBMLA(.9,PSBX-2,0),"'",2),.PSBDATE)
"RTN","PSBOMH1",117,0)
 ..I '$D(PSBMLA(.9,PSBX-2,0)) S PSBDATE=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH1",118,0)
 ..S PSBTMP(10000000-PSBDATE,"B")=PSBDATE_U_$$INITIAL^PSBRPC2($P(PSBMLA(0),U,5))_U_$P(PSBMLA(.9,PSBX,0),"'",2)
"RTN","PSBOMH1",119,0)
 ..S PSBGA=1
"RTN","PSBOMH1",120,0)
 .F PSBX=1:1 Q:'$D(PSBMLA(.9,PSBX))  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D
"RTN","PSBOMH1",121,0)
 ..S PSBTMP(10000000-$P(PSBMLA(.9,PSBX,0),U,1),"B")=$P(PSBMLA(.9,PSBX,0),U,1)_U_$$INITIAL^PSBRPC2($P(PSBMLA(.9,PSBX,0),U,2))_U_$P($P(PSBMLA(.9,PSBX,0),U,3),"'",2)
"RTN","PSBOMH1",122,0)
 ..S PSBGA=1
"RTN","PSBOMH1",123,0)
 I PSBGA'=1 S PSBTMP(10000000-$P(PSBMLA(0),U,6),"A")=$P(PSBMLA(0),U,6)_U_$$INITIAL^PSBRPC2($P(PSBMLA(0),U,7))
"RTN","PSBOMH1",124,0)
 S PSBQRY="PSBTMP",PSBCNT=1 F  S PSBQRY=$Q(@PSBQRY) Q:PSBQRY=""  D  ; does comment go with action
"RTN","PSBOMH1",125,0)
 .S PSBPQRY=$Q(@PSBQRY,-1)
"RTN","PSBOMH1",126,0)
 .I PSBPQRY="" S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; no previous action
"RTN","PSBOMH1",127,0)
 .I $QS(PSBPQRY,2)="C"  S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; previous line is a comment
"RTN","PSBOMH1",128,0)
 .I $QS(PSBQRY,2)="C",$E($P(@$Q(@PSBQRY,-1),U,1),1,12)=$E($P(@PSBQRY,U,1),1,12),$P(@$Q(@PSBQRY,-1),U,2)=$P(@PSBQRY,U,2) D  Q
"RTN","PSBOMH1",129,0)
 ..S X=$P(@PSBQRY,U,4) S:X[":" X=$P(X,":",2) S $P(PSBTAR(PSBCNT-1),U,4)=X Q
"RTN","PSBOMH1",130,0)
 .S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1
"RTN","PSBOMH1",131,0)
 Q
"RTN","PSBOMH1",132,0)
 ;
"RTN","PSBOMH1",133,0)
PSBSTIV ;
"RTN","PSBOMH1",134,0)
 S YB="" F  S YB=$O(PSBAUD(YB)) Q:YB=""  D
"RTN","PSBOMH1",135,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH1",136,0)
 ..I $P(PSBAUD(YB),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH1",137,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH1",138,0)
 ....I $P(PSBAUD(YB),U,2)'["*"  S $P(PSBAUD(YB),U,2)=$P(PSBAUD(YB),U,2)_"*"
"RTN","PSBOMH1",139,0)
 ....D PSBOUT($P(PSBAUD(YB),U,1),$P(PSBAUD(YB),U,2))
"RTN","PSBOMH1",140,0)
 Q
"RTN","PSBOMH1",141,0)
 ;
"RTN","PSBOMH1",142,0)
PSBCTAR   ;
"RTN","PSBOMH1",143,0)
 S YC="" F  S YC=$O(PSBTAR(YC)) Q:YC=""  D
"RTN","PSBOMH1",144,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH1",145,0)
 ..I $P(PSBTAR(YC),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH1",146,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH1",147,0)
 ....S $P(PSBTAR(YC),U,2)=$P(PSBTAR(YC),U,2)_"*"
"RTN","PSBOMH1",148,0)
 ....D PSBOUT($P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1),$P(PSBTAR(YC),U,2))
"RTN","PSBOMH1",149,0)
 Q
"RTN","PSBOMH1",150,0)
 ;
"RTN","PSBOMH1",151,0)
PSBOUT(PSBTET,PSBOT1) ;
"RTN","PSBOMH1",152,0)
 I '$D(^PSB(53.79,PSBIEN,.9,0))  D PSBENT^PSBOMH2(PSBOT1)
"RTN","PSBOMH1",153,0)
 S PSBIDA="" I $P(^PSB(53.79,PSBIEN,0),U,6)=PSBTET S PSBIDA=$P(^PSB(53.79,PSBIEN,0),U,7),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",154,0)
 S PSBXA1=0
"RTN","PSBOMH1",155,0)
 F  S PSBXA1=$O(^PSB(53.79,PSBIEN,.9,PSBXA1)) Q:+PSBXA1'>0  I PSBXA1'=0  D  Q:$G(PSBOT1)["*"
"RTN","PSBOMH1",156,0)
 .I $L(PSBXA1)<4  D
"RTN","PSBOMH1",157,0)
 ..I $P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",1)=PSBTET  D
"RTN","PSBOMH1",158,0)
 ...S:$G(PSBIDA)="" PSBIDA=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",2),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",159,0)
 ...I (PSBIDA=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",2)),$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",3)["Instruct"  D
"RTN","PSBOMH1",160,0)
 ....S INSDD=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",1),Y=INSDD D DD^%DT S INSDD=Y
"RTN","PSBOMH1",161,0)
 ....S PSBOT1=PSBOT1_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),U,3)_" "_INSDD
"RTN","PSBOMH1",162,0)
 I $G(PSBIDA)="",$P(^PSB(53.79,PSBIEN,0),U,4)=PSBTET D
"RTN","PSBOMH1",163,0)
 .S PSBIDA=$P(^PSB(53.79,PSBIEN,0),U,5),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",164,0)
 S:$G(PSBOT1)]"" ^TMP("PSB",$J,"LEGEND",PSBOT1,PSBNAME)="",PSBINIT=PSBOT1,PSBTET=""
"RTN","PSBOMH1",165,0)
 Q
"RTN","PSBOMH1",166,0)
 ;
"RTN","PSBOPM")
0^30^B76255661
"RTN","PSBOPM",1,0)
PSBOPM ;BIRMINGHAM/BSR-BCMA OIT HISTORY ;Mar 2004
"RTN","PSBOPM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9**;Mar 2004
"RTN","PSBOPM",3,0)
 ;
"RTN","PSBOPM",4,0)
 ; Reference/IA
"RTN","PSBOPM",5,0)
 ; File 50.7/2880
"RTN","PSBOPM",6,0)
 ; File 52.6/436
"RTN","PSBOPM",7,0)
 ; File 52.7/437
"RTN","PSBOPM",8,0)
 ; File 200/10060
"RTN","PSBOPM",9,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOPM",10,0)
 ;
"RTN","PSBOPM",11,0)
 ;
"RTN","PSBOPM",12,0)
 ;
"RTN","PSBOPM",13,0)
EN ;
"RTN","PSBOPM",14,0)
 N PSBHDR,DFN
"RTN","PSBOPM",15,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBOPM",16,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOPM",17,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOPM",18,0)
 I '$G(DFN) W !,("Error: No Patient IEN")  Q
"RTN","PSBOPM",19,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOPM",20,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOPM",21,0)
 S PSBCOM=$P(PSBRPT(.2),"^",8)   ;COMMENT FLAG 1 MEANS YES
"RTN","PSBOPM",22,0)
 I PSBSTRT="0" D
"RTN","PSBOPM",23,0)
 .D NOW^%DTC S PSBSTOP=%
"RTN","PSBOPM",24,0)
 .S X1=((PSBSTOP)\1) S X2=-$$GET^XPAR("ALL","PSB MED HIST DAYS BACK")
"RTN","PSBOPM",25,0)
 .S:X2'<0 X2=-30 D C^%DTC  S PSBSTRT=X
"RTN","PSBOPM",26,0)
 .S PSBCOM=$$GET^XPAR("ALL","PSB RPT INCL COMMENTS")
"RTN","PSBOPM",27,0)
 D OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)
"RTN","PSBOPM",28,0)
 Q
"RTN","PSBOPM",29,0)
 ;
"RTN","PSBOPM",30,0)
OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)        ;
"RTN","PSBOPM",31,0)
 D CLEANALL ;CLEAN UP VARIABLES AND TMP ARRAY
"RTN","PSBOPM",32,0)
 ;
"RTN","PSBOPM",33,0)
 ;IF PSBORDNM DOES NOT CONTAIN A "U" OR A "V" ASSUME THAT THE CALL
"RTN","PSBOPM",34,0)
 ;IS PASSING AND ORDERABLE ITEM AND SKIP THE ORDER LOOKUP PORTION
"RTN","PSBOPM",35,0)
 ;THIS MAINTAINS BACKWARD COMPATABILITY WITH HISTORY^PSBMLHS
"RTN","PSBOPM",36,0)
 I PSBORDNM'["U",PSBORDNM'["V" D
"RTN","PSBOPM",37,0)
 .I PSBORDNM]"" S TMP("PSBOIS",$J,PSBORDNM)=""
"RTN","PSBOPM",38,0)
 E  D 
"RTN","PSBOPM",39,0)
 .D GETORDN
"RTN","PSBOPM",40,0)
 .D GETOIS
"RTN","PSBOPM",41,0)
 D GETADSO ;  GET ALL ADDITIVES AND SOLUTIONS
"RTN","PSBOPM",42,0)
 D FINDIENS ; FIND ALL THE MED LOG ENTRIES THAT SHOULD BE ON THE REPORT
"RTN","PSBOPM",43,0)
 D PREOUT ;   WRITE DATA TO GLOBAL
"RTN","PSBOPM",44,0)
 D WRITEOT ;
"RTN","PSBOPM",45,0)
 D CLEANSUM ; CLEAN UP AND LEAVE LIST OF IENS FOR THE REPORT.
"RTN","PSBOPM",46,0)
 Q
"RTN","PSBOPM",47,0)
 ;
"RTN","PSBOPM",48,0)
GETORDN ;
"RTN","PSBOPM",49,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBOPM",50,0)
 D EN^PSJBCMA1(DFN,PSBORDNM,1)
"RTN","PSBOPM",51,0)
 Q
"RTN","PSBOPM",52,0)
 ;
"RTN","PSBOPM",53,0)
GETOIS  ; BUILD LIST OF ALL ORDERABLE ITEMS 
"RTN","PSBOPM",54,0)
 ;  ASSOCIATED WITH THIS ORDER INTO PSBOIS(#) 
"RTN","PSBOPM",55,0)
 ;
"RTN","PSBOPM",56,0)
 ;UNIT DOSE ORDER ONLY HAVE ONE OI
"RTN","PSBOPM",57,0)
 I PSBORDNM["U" D
"RTN","PSBOPM",58,0)
 .S PSBOI=$P(^TMP("PSJ1",$J,2),"^")
"RTN","PSBOPM",59,0)
 .S PSBOI=$S(PSBOI["U":$TR(PSBOI,"U",""),PSBOI["V":$TR(PSBOI,"V",""),1:PSBOI)
"RTN","PSBOPM",60,0)
 .S TMP("PSBOIS",$J,PSBOI)=""
"RTN","PSBOPM",61,0)
 ;
"RTN","PSBOPM",62,0)
 ;IV ORDERS NEED TO USE THE ADDITIVE AND SOLUTION NUMBER TO BACK
"RTN","PSBOPM",63,0)
 ;TRACK TO THE OI ASSOCIATED WITH IT
"RTN","PSBOPM",64,0)
 I PSBORDNM["V" D
"RTN","PSBOPM",65,0)
 .;GET ADDITIVES OFF THE ORDER
"RTN","PSBOPM",66,0)
 .I $G(^TMP("PSJ1",$J,850,0))  D
"RTN","PSBOPM",67,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,850,XXX)) Q:XXX=""  D
"RTN","PSBOPM",68,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,850,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",69,0)
 ....S PSBADD=$P(^TMP("PSJ1",$J,850,XXX,XXY),"^")
"RTN","PSBOPM",70,0)
 ....;
"RTN","PSBOPM",71,0)
 ....;CONVERT ADDITIVE TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",72,0)
 ....S TMP("PSBOIS",$J,$$OFROMA(PSBADD))=""
"RTN","PSBOPM",73,0)
 .;   GET SOLUTIONS OFF THE ORDER
"RTN","PSBOPM",74,0)
 .I $G(^TMP("PSJ1",$J,950,0))  D
"RTN","PSBOPM",75,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,950,XXX)) Q:XXX=""  D
"RTN","PSBOPM",76,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,950,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",77,0)
 ....S PSBSOL=$P(^TMP("PSJ1",$J,950,XXX,XXY),"^")
"RTN","PSBOPM",78,0)
 ....;
"RTN","PSBOPM",79,0)
 ....;CONVERT SOLUTIOIN TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",80,0)
 ....S TMP("PSBOIS",$J,$$OFROMS(PSBSOL))=""
"RTN","PSBOPM",81,0)
 Q
"RTN","PSBOPM",82,0)
 ;
"RTN","PSBOPM",83,0)
OFROMA(PSBADD) ;GET ORDERABLE ITEM FROM AN ADDITIVE
"RTN","PSBOPM",84,0)
 Q $$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOPM",85,0)
 ; 
"RTN","PSBOPM",86,0)
OFROMS(PSBSOL) ; GET ORDERABLE ITEM FROM A SOLUTION
"RTN","PSBOPM",87,0)
 Q $$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOPM",88,0)
 ;
"RTN","PSBOPM",89,0)
GETADSO ; GET ALL ADDITIVES FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",90,0)
 K PSBAOUT,PSBSOUT
"RTN","PSBOPM",91,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",92,0)
 .D LIST^DIC(52.6,"","@;15I","QPI","","","","AOI","","","PSBAOUT")
"RTN","PSBOPM",93,0)
 .S XB=0 F  S XB=$O(PSBAOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",94,0)
 ..I $P(PSBAOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOPM",95,0)
 ...S TMP("PSBADDS",$J,$P(PSBAOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",96,0)
 K PSBAOUT
"RTN","PSBOPM",97,0)
 ;
"RTN","PSBOPM",98,0)
 ; GET ALL SOLUTIONS FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",99,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",100,0)
 .D LIST^DIC(52.7,"","@;9I","QPI","","","","AOI","","","PSBSOUT")
"RTN","PSBOPM",101,0)
 .S XB=0 F  S XB=$O(PSBSOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",102,0)
 ..I $P(PSBSOUT("DILIST",XB,0),"^",1)=XA D
"RTN","PSBOPM",103,0)
 ...S TMP("PSBSOLS",$J,$P(PSBSOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",104,0)
 K PSBSOUT
"RTN","PSBOPM",105,0)
 Q
"RTN","PSBOPM",106,0)
 ;
"RTN","PSBOPM",107,0)
FINDIENS ; USE PSBOIS,PSBADDS AND PSBSOLS TO FIND ALL IENS FOR THE RPT
"RTN","PSBOPM",108,0)
 ;SEARCH FOR UNIT DOSE IENS
"RTN","PSBOPM",109,0)
 I $D(TMP("PSBOIS",$J)) S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",110,0)
 .S PSBDT=PSBSTRT F  S PSBDT=$O(^PSB(53.79,"AOIP",DFN,XA,PSBDT)) Q:PSBDT=""!(PSBDT>PSBSTOP)  D
"RTN","PSBOPM",111,0)
 ..S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,XA,PSBDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",112,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",113,0)
 ...S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",114,0)
 ;
"RTN","PSBOPM",115,0)
 ;SEARCH FOR ADDITIVES
"RTN","PSBOPM",116,0)
 I $D(TMP("PSBADDS",$J)) S XA="" F  S XA=$O(TMP("PSBADDS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",117,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP3",DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",118,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP3",DFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOPM",119,0)
 ...Q:XB'=XA
"RTN","PSBOPM",120,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",121,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOPM",122,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",123,0)
 ;
"RTN","PSBOPM",124,0)
 ;SEARCH FOR SOLUTIONS
"RTN","PSBOPM",125,0)
 I $D(TMP("PSBSOLS",$J)) S XA="" F  S XA=$O(TMP("PSBSOLS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",126,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP4",DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",127,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP4",DFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOPM",128,0)
 ...Q:XB'=XA
"RTN","PSBOPM",129,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",130,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOPM",131,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",132,0)
 Q
"RTN","PSBOPM",133,0)
 ;
"RTN","PSBOPM",134,0)
PREOUT ;
"RTN","PSBOPM",135,0)
 S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,XDT),-1) Q:XDT=""  S I="",I=$O(TMP("PSBIENS",$J,XDT,I)) D
"RTN","PSBOPM",136,0)
 .S PSBIEN=I
"RTN","PSBOPM",137,0)
 .S PSBIENS=PSBIEN_","
"RTN","PSBOPM",138,0)
 .D OUTPUT
"RTN","PSBOPM",139,0)
 Q
"RTN","PSBOPM",140,0)
 ;
"RTN","PSBOPM",141,0)
OUTPUT  ;
"RTN","PSBOPM",142,0)
 S PSBSPC=$J("",80)
"RTN","PSBOPM",143,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOPM",144,0)
 S W=W_$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" "
"RTN","PSBOPM",145,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOPM",146,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOPM",147,0)
 S W=W_$E($$GET1^DIQ(53.79,PSBIENS,"ACTION BY:INITIAL")_PSBSPC,1,10)_" "
"RTN","PSBOPM",148,0)
 S W=W_$$GET1^DIQ(53.79,PSBIENS,.16)
"RTN","PSBOPM",149,0)
 D ADD(W)
"RTN","PSBOPM",150,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOPM",151,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOPM",152,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOPM",153,0)
 ..D WRAPMEDS($$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04))
"RTN","PSBOPM",154,0)
 I PSBCOM=1  D COMNTS   ;GETS COMMENTS
"RTN","PSBOPM",155,0)
 D ADD("")
"RTN","PSBOPM",156,0)
 Q
"RTN","PSBOPM",157,0)
 ;
"RTN","PSBOPM",158,0)
COMNTS  ;
"RTN","PSBOPM",159,0)
 N Z,CNT
"RTN","PSBOPM",160,0)
 S Z="",CNT=0
"RTN","PSBOPM",161,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOPM",162,0)
 .D ADD("")
"RTN","PSBOPM",163,0)
 .D ADD($J("",44)_"Comments: "_$$MAKELINE("-",78))
"RTN","PSBOPM",164,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOPM",165,0)
 ..D:CNT=1 ADD("")
"RTN","PSBOPM",166,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOPM",167,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOPM",168,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOPM",169,0)
 ..S CNT=1
"RTN","PSBOPM",170,0)
 .D ADD($J("",54)_$$MAKELINE("-",78))
"RTN","PSBOPM",171,0)
 Q
"RTN","PSBOPM",172,0)
        ;
"RTN","PSBOPM",173,0)
WRAP(SIZE,ZP,BRIEN)         ;
"RTN","PSBOPM",174,0)
 D ADD($J("",55)_ZP)
"RTN","PSBOPM",175,0)
 D ADD($J("",55)_$E(SIZE,1,75))
"RTN","PSBOPM",176,0)
 I $L(SIZE)>75 D ADD($J("",55)_$E(SIZE,76,150))
"RTN","PSBOPM",177,0)
 Q
"RTN","PSBOPM",178,0)
 ;
"RTN","PSBOPM",179,0)
HEADA ;
"RTN","PSBOPM",180,0)
 W !
"RTN","PSBOPM",181,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Injection Site",?96,"Units",?112,"Units of"
"RTN","PSBOPM",182,0)
 W !,?55,"Medication & Dosage",?96,"GIVEN",?112,"Administration"
"RTN","PSBOPM",183,0)
 W !
"RTN","PSBOPM",184,0)
 W $$MAKELINE("-",132)
"RTN","PSBOPM",185,0)
 Q
"RTN","PSBOPM",186,0)
 ;
"RTN","PSBOPM",187,0)
ADD(XE)  ;
"RTN","PSBOPM",188,0)
 S ^TMP("PSB",$J,$O(^TMP("PSB",$J,""),-1)+1)=XE
"RTN","PSBOPM",189,0)
 Q
"RTN","PSBOPM",190,0)
 ;
"RTN","PSBOPM",191,0)
WRAPMEDS(MED,UG,UOA)  ;
"RTN","PSBOPM",192,0)
 ;MED IS NOT WRAPPED: MAX LENGTH IN PSDRUG/52.6/52.7 IS 40
"RTN","PSBOPM",193,0)
 ;UG/UOA MAX AT 30/40 AND WILL BE WRAPPED AT 15 EACH
"RTN","PSBOPM",194,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOPM",195,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOPM",196,0)
 N UGWRAP
"RTN","PSBOPM",197,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOPM",198,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOPM",199,0)
 F CNT=1:15:45  D
"RTN","PSBOPM",200,0)
 .D PARSE(UOA,CNT)
"RTN","PSBOPM",201,0)
 .S UGWRAP=$E(UG,CNT,(CNT+14))
"RTN","PSBOPM",202,0)
 .I CNT=1 D ADD($J("",55)_MED_" "_$$PAD(UGWRAP,15)_" "_$$PAD(UOA1,15))
"RTN","PSBOPM",203,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",96)_$$PAD(UGWRAP,15)_" "_$$PAD(@("UOA"_CNT),15))
"RTN","PSBOPM",204,0)
 Q
"RTN","PSBOPM",205,0)
 ;
"RTN","PSBOPM",206,0)
PAD(X,CNT) ;
"RTN","PSBOPM",207,0)
 Q $E(X_$J("",CNT),1,CNT)
"RTN","PSBOPM",208,0)
WRITEOT ;
"RTN","PSBOPM",209,0)
 S Y=$P(PSBSTRT,".",1)  D D^DIQ  S PSTRTA=Y
"RTN","PSBOPM",210,0)
 S Y=$P(PSBSTOP,".",1)  D D^DIQ  S PSTP=Y
"RTN","PSBOPM",211,0)
 S PSBHDR(1)="MEDICATION HISTORY for "_PSTRTA_"  to  "_PSTP
"RTN","PSBOPM",212,0)
 D MEDS
"RTN","PSBOPM",213,0)
 D PT^PSBOHDR(DFN,.PSBHDR),HEADA
"RTN","PSBOPM",214,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>")
"RTN","PSBOPM",215,0)
 S EX="" F  S EX=$O(^TMP("PSB",$J,EX)) Q:EX=""  D
"RTN","PSBOPM",216,0)
 .I $Y>(IOSL-5) D
"RTN","PSBOPM",217,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",218,0)
 ..D PT^PSBOHDR(DFN,.PSBHDR),HEADA
"RTN","PSBOPM",219,0)
 .W !,$G(^TMP("PSB",$J,EX))
"RTN","PSBOPM",220,0)
 W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",221,0)
 Q
"RTN","PSBOPM",222,0)
 ;
"RTN","PSBOPM",223,0)
FTR() ;
"RTN","PSBOPM",224,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBOPM",225,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOPM",226,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOPM",227,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOPM",228,0)
 Q ""
"RTN","PSBOPM",229,0)
 ;
"RTN","PSBOPM",230,0)
MEDS ;
"RTN","PSBOPM",231,0)
 N MED,XA,XB
"RTN","PSBOPM",232,0)
 S MED="",XB=3
"RTN","PSBOPM",233,0)
 S PSBHDR(3)="MEDICATIONS SEARCH LIST:"
"RTN","PSBOPM",234,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",235,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01)
"RTN","PSBOPM",236,0)
 .I $L(PSBHDR(XB)_" "_MED)>IOM D
"RTN","PSBOPM",237,0)
 ..S XB=XB+1,PSBHDR(XB)="                         "_MED
"RTN","PSBOPM",238,0)
 .E  S PSBHDR(XB)=PSBHDR(XB)_" "_MED
"RTN","PSBOPM",239,0)
 Q
"RTN","PSBOPM",240,0)
 ;
"RTN","PSBOPM",241,0)
CLEANALL        ; KILL ALL TMP LEVELS USED VARIABLES
"RTN","PSBOPM",242,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOPM",243,0)
 K TMP("PSBIENS",$J)
"RTN","PSBOPM",244,0)
 Q
"RTN","PSBOPM",245,0)
 ;
"RTN","PSBOPM",246,0)
CLEANSUM        ; KILLL ALL BUN THE "PSBIENS" LEVEL
"RTN","PSBOPM",247,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBIENS",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOPM",248,0)
 Q
"RTN","PSBOPM",249,0)
MAKELINE(X,CNT) ;LINE OF WHAT'S PASSED IN CNT TIMES
"RTN","PSBOPM",250,0)
 N Y,Z
"RTN","PSBOPM",251,0)
 S Y=""
"RTN","PSBOPM",252,0)
 F Z=1:1:CNT S Y=Y_X
"RTN","PSBOPM",253,0)
 Q Y
"RTN","PSBOPM",254,0)
 ;
"RTN","PSBOPM",255,0)
PARSE(X,CNT) ;Split text for wrapping.
"RTN","PSBOPM",256,0)
 S CNTX="UOA"_CNT,@CNTX=@CNTX_$E(X,CNT,(CNT+14)),UOAX=""
"RTN","PSBOPM",257,0)
 F  S:$F(@CNTX,", ",+UOAX)>0 UOAX=$F(@CNTX,", ",+UOAX)  Q:'$F(@CNTX,", ",+UOAX)
"RTN","PSBOPM",258,0)
 I UOAX<1 F  S:$F(@CNTX," ",+UOAX)>0 UOAX=$F(@CNTX," ",+UOAX)  Q:'$F(@CNTX," ",+UOAX)
"RTN","PSBOPM",259,0)
 I UOAX>1,(($L(UOA)-(CNT+14))>0) S CNTXX=$E(@CNTX,1,UOAX-1),@("UOA"_(CNT+15))=$E(@CNTX,UOAX,UOAX+14),@CNTX=CNTXX
"RTN","PSBOPM",260,0)
 Q
"RTN","PSBOPM",261,0)
 ;
"RTN","PSBOWA")
0^25^B46771592
"RTN","PSBOWA",1,0)
PSBOWA ;BIRMINGHAM/EFC-WARD ADMINISTRATION TIMES ;Mar 2004
"RTN","PSBOWA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**9**;Mar 2004
"RTN","PSBOWA",3,0)
 ;
"RTN","PSBOWA",4,0)
 ; Reference/IA
"RTN","PSBOWA",5,0)
 ; ^DPT/10035
"RTN","PSBOWA",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOWA",7,0)
 ;
"RTN","PSBOWA",8,0)
EN ;
"RTN","PSBOWA",9,0)
 N PSBHDR,PSBGTOT,PSBTOT,PSBINDX,DFN,PSBX,PSBY,PSBSM,PSBADST,PSBZ
"RTN","PSBOWA",10,0)
 S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ
"RTN","PSBOWA",11,0)
 S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",12,0)
 D:$P(PSBRPT(.1),U)="W"
"RTN","PSBOWA",13,0)
 .F X=0,.01:.01:.24 S PSBGTOT(X)=""
"RTN","PSBOWA",14,0)
 .W $$WRDHDR()
"RTN","PSBOWA",15,0)
 .S PSBINDX=""
"RTN","PSBOWA",16,0)
 .F  S PSBINDX=$O(^TMP("PSBO",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOWA",17,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOWA",18,0)
 ...W:$Y>(IOSL-10) $$WRDHDR()
"RTN","PSBOWA",19,0)
 ...W !,$P(^DPT(DFN,0),U,1),!,"SSN: ",$P(^(0),U,9)
"RTN","PSBOWA",20,0)
 ...W !,"Ward: ",$E($G(^DPT(DFN,.1)),1,25),!,"Room-Bed:  ",$E($G(^(.101)),1,21)
"RTN","PSBOWA",21,0)
 ...W ?32
"RTN","PSBOWA",22,0)
 ...F X=0,.01:.01:.24 S PSBTOT(X)=""
"RTN","PSBOWA",23,0)
 ...K ^TMP("PSJ",$J)
"RTN","PSBOWA",24,0)
 ...D EN^PSJBCMA(DFN,$P(PSBRPT(.1),U,6))
"RTN","PSBOWA",25,0)
 ...F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",26,0)
 ....Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",27,0)
 ....D CLEAN^PSBVT
"RTN","PSBOWA",28,0)
 ....D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",29,0)
 ....Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",30,0)
 ....Q:PSBOSTS'="A"&(PSBOSTS'="R")  ; Active?
"RTN","PSBOWA",31,0)
 ....Q:PSBSM=1  ;Self med?
"RTN","PSBOWA",32,0)
 ....S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",33,0)
 ....S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",34,0)
 ....S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",35,0)
 ....F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",36,0)
 ....I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",37,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",38,0)
 ....I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",39,0)
 ....I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",40,0)
 ....I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",41,0)
 ....I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",42,0)
 ....I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",43,0)
 ....I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",44,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",45,0)
 ....I +PSBFREQ>0 D
"RTN","PSBOWA",46,0)
 .....I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",47,0)
 ....I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",48,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",49,0)
 ....K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",50,0)
 ....I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",51,0)
 ....E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",52,0)
 ....Q:PSBADST=""
"RTN","PSBOWA",53,0)
 ....I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",54,0)
 ....I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",55,0)
 ....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",56,0)
 .....F Y=1:1:$L(PSBADST,"-") S Z=+("."_$E($P(PSBADST,"-",Y),1,2)) D
"RTN","PSBOWA",57,0)
 ......Q:(($P(PSBRPT(.1),U,6)+Z)<$E(PSBOST,1,12))&($G(Z)'=0)  ;Start Date
"RTN","PSBOWA",58,0)
 ......Q:($P(PSBRPT(.1),U,6)+Z)'<$E(PSBOSP,1,12)  ;Stop Date
"RTN","PSBOWA",59,0)
 ......;For invalid admin times
"RTN","PSBOWA",60,0)
 ......D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",61,0)
 .......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",62,0)
 ......S PSBTOT(Z)=PSBTOT(Z)+1
"RTN","PSBOWA",63,0)
 ......S PSBGTOT(Z)=PSBGTOT(Z)+1
"RTN","PSBOWA",64,0)
 ...S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:$G(PSBX)=""  W $J(PSBTOT(PSBX),4)
"RTN","PSBOWA",65,0)
 ...W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",66,0)
 .W !!,$TR($J("",IOM)," ","=")
"RTN","PSBOWA",67,0)
 .W !?32 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",68,0)
 .W !,"Hourly Totals:",?32
"RTN","PSBOWA",69,0)
 .S PSBGTOT=0
"RTN","PSBOWA",70,0)
 .S PSBX="" F  S PSBX=$O(PSBGTOT(PSBX)) Q:$G(PSBX)=""  D
"RTN","PSBOWA",71,0)
 ..W $J(PSBGTOT(PSBX),4)
"RTN","PSBOWA",72,0)
 ..S PSBGTOT=PSBGTOT+PSBGTOT(PSBX)
"RTN","PSBOWA",73,0)
 .W !!,"Ward Total:",?32,$J(PSBGTOT,4)
"RTN","PSBOWA",74,0)
 .W !!,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",75,0)
 .K ^TMP("PSJ",$J)
"RTN","PSBOWA",76,0)
 D:$P(PSBRPT(.1),U)="P"
"RTN","PSBOWA",77,0)
 .S DFN=PSBDFN
"RTN","PSBOWA",78,0)
 .S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",79,0)
 .S Y=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",80,0)
 .W $$PTHDR()
"RTN","PSBOWA",81,0)
 .K ^TMP("PSJ",$J),PSBTOT
"RTN","PSBOWA",82,0)
 .D EN^PSJBCMA(PSBDFN,$P(PSBRPT(.1),U,6),"")
"RTN","PSBOWA",83,0)
 .F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",84,0)
 ..Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",85,0)
 ..D CLEAN^PSBVT
"RTN","PSBOWA",86,0)
 ..D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",87,0)
 ..Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",88,0)
 ..Q:PSBOSTS'="A"&(PSBOSTS'="R")  ; Active?
"RTN","PSBOWA",89,0)
 ..S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",90,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",91,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",92,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",93,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",94,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",95,0)
 ..I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",96,0)
 ..I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",97,0)
 ..I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",98,0)
 ..I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",99,0)
 ..I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",100,0)
 ..I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",101,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",102,0)
 ..I +PSBFREQ>0 D
"RTN","PSBOWA",103,0)
 ...I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",104,0)
 ..I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",105,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",106,0)
 ..K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",107,0)
 ..I PSBADST="",+$G(PSBFREQ)>0,$G(PSBFREQ)<30 S PSBADST="MESSAGE",$P(PSBTOT(PSBADST,PSBOITX,PSBONX),2)="Due every "_PSBFREQ_" Mins" Q
"RTN","PSBOWA",108,0)
 ..I PSBADST="",+$G(PSBFREQ)'<30 S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",109,0)
 ..E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",110,0)
 ..Q:PSBADST=""
"RTN","PSBOWA",111,0)
 ..I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",112,0)
 ..I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",113,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",114,0)
 ...F Y=1:1:$L(PSBADST,"-") S Z=+("."_$P(PSBADST,"-",Y)) D
"RTN","PSBOWA",115,0)
 ....Q:($P(PSBRPT(.1),U,6)+Z)<$E(PSBOST,1,12)  ; Start Date
"RTN","PSBOWA",116,0)
 ....Q:($P(PSBRPT(.1),U,6)+Z)'<$E(PSBOSP,1,12)  ; Stop Date
"RTN","PSBOWA",117,0)
 ....;For Invalid admin times
"RTN","PSBOWA",118,0)
 ....D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",119,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",120,0)
 ....S PSBSM=$S(PSBHSM=1:"HSM",PSBSM=1:"SM",1:"")
"RTN","PSBOWA",121,0)
 ....;*** Local array to include order no
"RTN","PSBOWA",122,0)
 ....S PSBTOT(Z,PSBOITX,PSBONX)=PSBSM_U_"Dosage: "_PSBDOSE_"  Route: "_PSBMR_"  "_PSBIFR
"RTN","PSBOWA",123,0)
 .S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:PSBX=""  D
"RTN","PSBOWA",124,0)
 ..W !
"RTN","PSBOWA",125,0)
 ..S PSBY="" F  S PSBY=$O(PSBTOT(PSBX,PSBY)) Q:PSBY=""  D
"RTN","PSBOWA",126,0)
 ...S PSBZ="" F  S PSBZ=$O(PSBTOT(PSBX,PSBY,PSBZ)) Q:PSBZ=""  D
"RTN","PSBOWA",127,0)
 ....W:$Y>(IOSL-6) $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOWA",128,0)
 ....I PSBX="MESSAGE" W !,$P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY Q
"RTN","PSBOWA",129,0)
 ....W !,$$TIMEOUT^PSBUTL(PSBX),?10
"RTN","PSBOWA",130,0)
 ....W $P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY,?55,$P(PSBTOT(PSBX,PSBY,PSBZ),U,2)
"RTN","PSBOWA",131,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOWA",132,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOWA",133,0)
 Q
"RTN","PSBOWA",134,0)
 ;
"RTN","PSBOWA",135,0)
WRDHDR() ;
"RTN","PSBOWA",136,0)
 S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",137,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOWA",138,0)
 W !,"Patient Name",?72,"Administration Times"
"RTN","PSBOWA",139,0)
 W !,"Room-Bed",?32
"RTN","PSBOWA",140,0)
 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",141,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",142,0)
 Q ""
"RTN","PSBOWA",143,0)
 ;
"RTN","PSBOWA",144,0)
PTHDR() ;
"RTN","PSBOWA",145,0)
 S PSBHDR(1)="PATIENT ADMINISTRATION TIMES"
"RTN","PSBOWA",146,0)
 D PT^PSBOHDR(PSBDFN,.PSBHDR)
"RTN","PSBOWA",147,0)
 W !,"Time",?10,"Self Med",?20,"Medication",?55,"Dose/Route"
"RTN","PSBOWA",148,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",149,0)
 Q ""
"RTN","PSBOWA",150,0)
 ;
"RTN","PSBUTL")
0^31^B72517837
"RTN","PSBUTL",1,0)
PSBUTL ;BIRMINGHAM/EFC-BCMA UTILITIES ;Mar 2004
"RTN","PSBUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9**;Mar 2004
"RTN","PSBUTL",3,0)
 ; 
"RTN","PSBUTL",4,0)
 ; Reference/IA
"RTN","PSBUTL",5,0)
 ; $$PATCH & $$VERSION^XPDUTL/10141
"RTN","PSBUTL",6,0)
 ; File 50/221
"RTN","PSBUTL",7,0)
 ; File 200/10060
"RTN","PSBUTL",8,0)
 ;
"RTN","PSBUTL",9,0)
 ;
"RTN","PSBUTL",10,0)
DIWP(X,Y,PSB,PSBARGN) ; 
"RTN","PSBUTL",11,0)
 K ^UTILITY($J,"W")
"RTN","PSBUTL",12,0)
 S DIWL=0,DIWR=Y,DIWF="C"_Y D ^DIWP
"RTN","PSBUTL",13,0)
 F X=0:0 S X=$O(^UTILITY($J,"W",0,X)) Q:'X  D
"RTN","PSBUTL",14,0)
 .S Y=$O(@PSB@(""),-1)+1
"RTN","PSBUTL",15,0)
 .; Naked Reference below is from two lines above ^UTILITY($J,"W",0,X)
"RTN","PSBUTL",16,0)
 .S @PSB@(Y)=$J("",+$G(PSBARGN))_^(X,0)
"RTN","PSBUTL",17,0)
 S @PSB@(0)=+$O(@PSB@(""),-1)
"RTN","PSBUTL",18,0)
 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF
"RTN","PSBUTL",19,0)
 Q
"RTN","PSBUTL",20,0)
 ;
"RTN","PSBUTL",21,0)
SATURDAY(X,PSBDISP) ; 
"RTN","PSBUTL",22,0)
 S X=X\1 D H^%DTC ; Convert to $H style
"RTN","PSBUTL",23,0)
 S %H=%H+(6-%Y) ;   Set it forward to Saturday
"RTN","PSBUTL",24,0)
 D YMD^%DTC ;       Back to FM Format
"RTN","PSBUTL",25,0)
 I $G(PSBDISP) S PSBDISP=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) D EN^DDIOL("Actual date is Saturday "_PSBDISP)
"RTN","PSBUTL",26,0)
 Q X
"RTN","PSBUTL",27,0)
 ;
"RTN","PSBUTL",28,0)
SUNDAY(X,PSBDISP) ; 
"RTN","PSBUTL",29,0)
 S X=X\1 D H^%DTC ; Convert to $H style
"RTN","PSBUTL",30,0)
 S %H=%H-%Y ;       Set it back to Sunday
"RTN","PSBUTL",31,0)
 D YMD^%DTC ;       Back to FM Format
"RTN","PSBUTL",32,0)
 I $G(PSBDISP) S PSBDISP=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) D EN^DDIOL("Actual date is Sunday "_PSBDISP)
"RTN","PSBUTL",33,0)
 Q X
"RTN","PSBUTL",34,0)
 ;
"RTN","PSBUTL",35,0)
CLOCK(RESULTS,X) ; Verify Client/Server Date/Times are close enough
"RTN","PSBUTL",36,0)
 ;
"RTN","PSBUTL",37,0)
 ; RPC: PSB SERVER CLOCK VARIANCE
"RTN","PSBUTL",38,0)
 ;
"RTN","PSBUTL",39,0)
 ; Description:
"RTN","PSBUTL",40,0)
 ; Returns the variance from the server to the client in minutes
"RTN","PSBUTL",41,0)
 ;
"RTN","PSBUTL",42,0)
 N PSBCLNT,PSBSRVR,PSBDIFF
"RTN","PSBUTL",43,0)
 S %DT="RS" D ^%DT S PSBCLNT=Y
"RTN","PSBUTL",44,0)
 D NOW^%DTC S PSBSRVR=%
"RTN","PSBUTL",45,0)
 S PSBDIFF=$$DIFF(PSBSRVR,PSBCLNT)
"RTN","PSBUTL",46,0)
 S X=$$GET^XPAR("DIV","PSB SERVER CLOCK VARIANCE")
"RTN","PSBUTL",47,0)
 I PSBDIFF>X!(PSBDIFF<(X*-1)) S RESULTS(0)="-1^"_PSBDIFF
"RTN","PSBUTL",48,0)
 E  S RESULTS(0)="1^"_PSBDIFF
"RTN","PSBUTL",49,0)
 Q
"RTN","PSBUTL",50,0)
 ;
"RTN","PSBUTL",51,0)
DIFF(X,X1) ; Difference in minutes between 2 FM dates
"RTN","PSBUTL",52,0)
 ; Code copied from Fileman Function MINUTES
"RTN","PSBUTL",53,0)
 S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S X=X*1440+Y
"RTN","PSBUTL",54,0)
 Q X
"RTN","PSBUTL",55,0)
 ;
"RTN","PSBUTL",56,0)
DRUGINQ ; Drug File Inquiry
"RTN","PSBUTL",57,0)
 N PSBRET,PSBIEN,DIC,DIR,IOINORM,IOINHI
"RTN","PSBUTL",58,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSBUTL",59,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBUTL",60,0)
 S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",D="B^C^VAPN^VAC^NDC^XATC",DIC("A")="Select DRUG: "
"RTN","PSBUTL",61,0)
 ; Display active drugs and those for appl packages IV and Unit Dose
"RTN","PSBUTL",62,0)
 S DIC("S")="I '$G(^PSDRUG(+Y,""I""))!($G(^(""I""))>DT),$P($G(^PSDRUG(+Y,2)),U,3)[""I""!($P($G(^PSDRUG(+Y,2)),U,3)[""U"")"
"RTN","PSBUTL",63,0)
 F  W @IOF,!,"DRUG FILE INQUIRY",! D ^DIC  Q:+Y<1  D
"RTN","PSBUTL",64,0)
 .K PSBRET
"RTN","PSBUTL",65,0)
 .S PSBIEN=+Y_","
"RTN","PSBUTL",66,0)
 .D GETS^DIQ(50,PSBIEN,".01;16;25;51;215;213;101;9*","","PSBRET")
"RTN","PSBUTL",67,0)
 .W @IOF,!,"DRUG NAME: ",IOINHI,PSBRET(50,PSBIEN,.01)
"RTN","PSBUTL",68,0)
 .W "  (IEN: ",+PSBIEN,")",IOINORM,!,$TR($J("",IOM)," ","-"),!
"RTN","PSBUTL",69,0)
 .F X=16,25,51,215,213,101 D
"RTN","PSBUTL",70,0)
 ..D FIELD^DID(50,X,"","LABEL","PSBRET")
"RTN","PSBUTL",71,0)
 ..W !,PSBRET("LABEL"),":",?30,IOINHI
"RTN","PSBUTL",72,0)
 ..D:$L(PSBRET(50,PSBIEN,X))>49
"RTN","PSBUTL",73,0)
 ...F Y=1:1 Q:$L($P(PSBRET(50,PSBIEN,X)," ",1,Y))>49
"RTN","PSBUTL",74,0)
 ...W $P(PSBRET(50,PSBIEN,X)," ",1,Y-1),!?30
"RTN","PSBUTL",75,0)
 ...S PSBRET(50,PSBIEN,X)=$P(PSBRET(50,PSBIEN,X)," ",Y,250)
"RTN","PSBUTL",76,0)
 ..W ?30,PSBRET(50,PSBIEN,X),IOINORM
"RTN","PSBUTL",77,0)
 .W !!,"SYNONYMS:",IOINHI,!?15
"RTN","PSBUTL",78,0)
 .S X="" F  S X=$O(PSBRET(50.1,X)) Q:X=""  W:$X>40 !?15 W:$X>15 ?40 W PSBRET(50.1,X,.01)
"RTN","PSBUTL",79,0)
 .W IOINORM
"RTN","PSBUTL",80,0)
 .F  Q:$Y>(IOSL-3)  W !
"RTN","PSBUTL",81,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSBUTL",82,0)
 Q
"RTN","PSBUTL",83,0)
 ;
"RTN","PSBUTL",84,0)
DPTSET ; Set Logic for pt-merge x-ref on patient field in file 53.79
"RTN","PSBUTL",85,0)
 ;
"RTN","PSBUTL",86,0)
 ; Entered Date/Time
"RTN","PSBUTL",87,0)
 I $P(^PSB(53.79,DA,0),U,4) S ^PSB(53.79,"AEDT",X,$P(^PSB(53.79,DA,0),U,4),DA)=""
"RTN","PSBUTL",88,0)
 ;
"RTN","PSBUTL",89,0)
 ; Administration Date/Time
"RTN","PSBUTL",90,0)
 D:$P(^PSB(53.79,DA,0),U,6)
"RTN","PSBUTL",91,0)
 .S ^PSB(53.79,"AADT",X,$P(^PSB(53.79,DA,0),U,6),DA)=""
"RTN","PSBUTL",92,0)
 .;
"RTN","PSBUTL",93,0)
 .; Orderable Item + Administration Date/Time
"RTN","PSBUTL",94,0)
 .I $P(^PSB(53.79,DA,0),U,8) S ^PSB(53.79,"AOIP",X,$P(^PSB(53.79,DA,0),U,8),$P(^PSB(53.79,DA,0),U,6),DA)=""
"RTN","PSBUTL",95,0)
 ;
"RTN","PSBUTL",96,0)
 ; PRN's by entered date/time
"RTN","PSBUTL",97,0)
 I $P($G(^PSB(53.79,DA,.1)),U,2)="P"&($P(^(0),U,4)) S ^PSB(53.79,"APRN",X,$P(^PSB(53.79,DA,0),U,4),DA)=""
"RTN","PSBUTL",98,0)
 ;
"RTN","PSBUTL",99,0)
 ; Order+Administration Date and Time
"RTN","PSBUTL",100,0)
 I $P($G(^PSB(53.79,DA,.1)),U)]""&($P($G(^PSB(53.79,DA,.1)),U,3)) S ^PSB(53.79,"AORD",X,$P(^PSB(53.79,DA,.1),U),$P(^PSB(53.79,DA,.1),U,3),DA)=""
"RTN","PSBUTL",101,0)
 Q
"RTN","PSBUTL",102,0)
 ;
"RTN","PSBUTL",103,0)
DPTKILL ; Kill Logic for pt-merge x-ref on patient field in file 53.79
"RTN","PSBUTL",104,0)
 ;
"RTN","PSBUTL",105,0)
 ; Entered Date/Time
"RTN","PSBUTL",106,0)
 I $P(^PSB(53.79,DA,0),U,4) K ^PSB(53.79,"AEDT",X,$P(^PSB(53.79,DA,0),U,4),DA)
"RTN","PSBUTL",107,0)
 ;
"RTN","PSBUTL",108,0)
 ; Administration Date/Time
"RTN","PSBUTL",109,0)
 D:$P(^PSB(53.79,DA,0),U,6)
"RTN","PSBUTL",110,0)
 .K ^PSB(53.79,"AADT",X,$P(^PSB(53.79,DA,0),U,6),DA)
"RTN","PSBUTL",111,0)
 .;
"RTN","PSBUTL",112,0)
 .; Orderable Item + Administration Date/Time
"RTN","PSBUTL",113,0)
 .I $P(^PSB(53.79,DA,0),U,8) K ^PSB(53.79,"AOIP",X,$P(^PSB(53.79,DA,0),U,8),$P(^PSB(53.79,DA,0),U,6),DA)
"RTN","PSBUTL",114,0)
 ;
"RTN","PSBUTL",115,0)
 ; PRN's by entered date/time
"RTN","PSBUTL",116,0)
 I $P($G(^PSB(53.79,DA,.1)),U,2)="P"&($P(^(0),U,4)) K ^PSB(53.79,"APRN",X,$P(^PSB(53.79,DA,0),U,4),DA)
"RTN","PSBUTL",117,0)
 ;
"RTN","PSBUTL",118,0)
 ; Order+Administration Date and Time
"RTN","PSBUTL",119,0)
 I $P($G(^PSB(53.79,DA,.1)),U)]""&($P($G(^PSB(53.79,DA,.1)),U,3)) K ^PSB(53.79,"AORD",X,$P(^PSB(53.79,DA,.1),U),$P(^PSB(53.79,DA,.1),U,3),DA)
"RTN","PSBUTL",120,0)
 Q
"RTN","PSBUTL",121,0)
 ;
"RTN","PSBUTL",122,0)
TIMEIN ;
"RTN","PSBUTL",123,0)
 X ^%ZOSF("UPPERCASE") S X=Y
"RTN","PSBUTL",124,0)
 I X="NOON" S X=.12 Q
"RTN","PSBUTL",125,0)
 I X="MID" S X=.24 Q
"RTN","PSBUTL",126,0)
 I (X="NOW")!(X="N") D NOW^%DTC S X=$E($P(%,".",2)_"0000",1,4)
"RTN","PSBUTL",127,0)
 S X="T@"_X,%DT="R" D ^%DT
"RTN","PSBUTL",128,0)
 I Y<1 K X Q
"RTN","PSBUTL",129,0)
 S X=Y-DT
"RTN","PSBUTL",130,0)
 Q
"RTN","PSBUTL",131,0)
 ;
"RTN","PSBUTL",132,0)
TIMEOUT(X) ; 
"RTN","PSBUTL",133,0)
 N HOUR,MIN,AMPM
"RTN","PSBUTL",134,0)
 S X=$E($P(X,".",2)_"0000",1,4)
"RTN","PSBUTL",135,0)
 I X="2400" Q "12:00m"
"RTN","PSBUTL",136,0)
 I X="1200" Q "12:00n"
"RTN","PSBUTL",137,0)
 S HOUR=+$E(X,1,2),MIN=$E(X,3,4)
"RTN","PSBUTL",138,0)
 S AMPM="a"
"RTN","PSBUTL",139,0)
 S AMPM=$S(HOUR<12:"a",HOUR>11:"p",1:"**")
"RTN","PSBUTL",140,0)
 S:HOUR>12 HOUR=HOUR-12
"RTN","PSBUTL",141,0)
 Q HOUR_":"_MIN_AMPM
"RTN","PSBUTL",142,0)
 ;
"RTN","PSBUTL",143,0)
HFSOPEN(HANDLE) ; 
"RTN","PSBUTL",144,0)
 N PSBDIR,PSBFILE
"RTN","PSBUTL",145,0)
 S PSBDIR=$$GET^XPAR("DIV","PSB HFS SCRATCH")
"RTN","PSBUTL",146,0)
 S PSBFILE="PSB"_DUZ_".DAT"
"RTN","PSBUTL",147,0)
 D OPEN^%ZISH(HANDLE,PSBDIR,PSBFILE,"W") Q:POP
"RTN","PSBUTL",148,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","PSBUTL",149,0)
 Q
"RTN","PSBUTL",150,0)
 ;
"RTN","PSBUTL",151,0)
HFSCLOSE(HANDLE) ; 
"RTN","PSBUTL",152,0)
 N PSBDIR,PSBFILE,PSBDEL
"RTN","PSBUTL",153,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","PSBUTL",154,0)
 K ^TMP("PSBO",$J)
"RTN","PSBUTL",155,0)
 S PSBDIR=$$GET^XPAR("DIV","PSB HFS SCRATCH")
"RTN","PSBUTL",156,0)
 S PSBFILE="PSB"_DUZ_".DAT",PSBDEL(PSBFILE)=""
"RTN","PSBUTL",157,0)
 S X=$$FTG^%ZISH(PSBDIR,PSBFILE,$NAME(^TMP("PSBO",$J,2)),3)
"RTN","PSBUTL",158,0)
 S X=$$DEL^%ZISH(PSBDIR,$NA(PSBDEL))
"RTN","PSBUTL",159,0)
 Q
"RTN","PSBUTL",160,0)
 ;
"RTN","PSBUTL",161,0)
AUDIT(PSBREC,PSBDD,PSBFLD,PSBDATA,PSBSK) ; Med Log Audit
"RTN","PSBUTL",162,0)
 ; used by cross references to 53.79 to track changes to fields in Med Log file
"RTN","PSBUTL",163,0)
 ; xref AU05, AU06, AU09, AU16, AU21, AU22 pass the value 53.79 as PSBDD
"RTN","PSBUTL",164,0)
 ; xref AU303, AU304 pass the value 53.795 as PSBDD
"RTN","PSBUTL",165,0)
 ; xref AU603, AU604 pass the value 53.796 as PSBDD
"RTN","PSBUTL",166,0)
 ; xref AU703, AU704 pass the value 53.797 as PSBDD
"RTN","PSBUTL",167,0)
 ;
"RTN","PSBUTL",168,0)
 N PSBDT,PSBTMP
"RTN","PSBUTL",169,0)
 I '$D(PSBOLSTS) S PSBOLSTS=$P(^PSB(53.79,PSBREC,0),U,9)
"RTN","PSBUTL",170,0)
 I '$D(PSBOLDUZ) S PSBOLDUZ=$P(^PSB(53.79,PSBREC,0),U,5)
"RTN","PSBUTL",171,0)
 Q:$G(PSBDATA)=""!('$G(PSBAUDIT))
"RTN","PSBUTL",172,0)
 D NOW^%DTC S PSBDT=%
"RTN","PSBUTL",173,0)
 S PSBDATA=$$EXTERNAL^DILFD(PSBDD,PSBFLD,"",PSBDATA)  ; PSBDD=53.79, 53.795, 53.796, or 53.797 see comment at tag AUDIT
"RTN","PSBUTL",174,0)
 D FIELD^DID(PSBDD,PSBFLD,"","LABEL","PSBTMP")  ; PSBDD=53.79, 53.795, 53.796, or 53.797 see comment at tag AUDIT
"RTN","PSBUTL",175,0)
 S:'$D(^PSB(53.79,PSBREC,.9,0)) ^(0)="^53.799^^"
"RTN","PSBUTL",176,0)
 S Y=$O(^PSB(53.79,PSBREC,.9,""),-1)+1,X=""
"RTN","PSBUTL",177,0)
 I PSBTMP("LABEL")["ACTION STATUS" D  Q
"RTN","PSBUTL",178,0)
 .I PSBSK["K" S XY=Y F  S XY=$O(^PSB(53.79,PSBREC,.9,XY),-1) Q:($D(PSBGOON))!(+XY'>0)  D
"RTN","PSBUTL",179,0)
 ..I ^PSB(53.79,PSBREC,.9,XY,0)["ACTION STATUS Set to '" D  Q
"RTN","PSBUTL",180,0)
 ...S PSBGOON=1,PSBOLDUZ=$P(^PSB(53.79,PSBREC,.9,XY,0),U,2),X=$P(^PSB(53.79,PSBREC,.9,XY,0),"'",2)
"RTN","PSBUTL",181,0)
 .S:$L(X)'>2 X=PSBOLSTS,X=$S(X="G":"GIVEN",X="H":"HELD",X="R":"REFUSED",X="I":"INFUSING",X="C":"COMPLETED",X="S":"STOPPED",X="N":"NOT GIVEN",X="RM":"REMOVED",X="M":"MISSING DOSE",X="":PSBOLSTS)
"RTN","PSBUTL",182,0)
 .I PSBSK["K" S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" '"_PSBDATA_"' by '"_$$GET1^DIQ(200,PSBOLDUZ,"INITIAL")_"' deleted."
"RTN","PSBUTL",183,0)
 .E  S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" Set to '"_PSBDATA_"' by '"_$$GET1^DIQ(200,DUZ,"INITIAL")_"'."_U_PSBDATA
"RTN","PSBUTL",184,0)
 I PSBSK["K" S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" '"_PSBDATA_"' deleted."
"RTN","PSBUTL",185,0)
 E  S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_$S(PSBTMP("LABEL")["DISPENSE DRUG":" Added '",1:" Set to '")_PSBDATA_"'."
"RTN","PSBUTL",186,0)
 K XY,PSBGOON
"RTN","PSBUTL",187,0)
 Q
"RTN","PSBUTL",188,0)
 ;
"RTN","PSBUTL",189,0)
CHECK(RESULTS,PSBWHAT,PSBDATA) ; Checks for KIDS Patch or Build
"RTN","PSBUTL",190,0)
 ; Module added in Patch PSB*1.0*3 DP/TOPEKA 22-DEC-1999 11:51:22 
"RTN","PSBUTL",191,0)
 ; PSBWHAT: B = Returns Build Version for packages by Namespace
"RTN","PSBUTL",192,0)
 ;          P = Returns if Patch is installed
"RTN","PSBUTL",193,0)
 ; PSBDATA: Build/Package namespace (i.e. PSB) or Patch Number
"RTN","PSBUTL",194,0)
 ;         (i.e. PSB*1.0*1)
"RTN","PSBUTL",195,0)
 ;
"RTN","PSBUTL",196,0)
 S RESULTS(0)="-1^Unknown Parameter "_$G(PSBWHAT,"<PSBWHAT Undefined>")
"RTN","PSBUTL",197,0)
 S PSBWHAT=$G(PSBWHAT),PSBDATA=$G(PSBDATA)
"RTN","PSBUTL",198,0)
 D:PSBWHAT="B"
"RTN","PSBUTL",199,0)
 .S X=$$VERSION^XPDUTL(PSBDATA)
"RTN","PSBUTL",200,0)
 .S RESULTS(0)=$S(X="":"-1^Unknown Package/Build",1:"1^"_X)
"RTN","PSBUTL",201,0)
 D:PSBWHAT="P"
"RTN","PSBUTL",202,0)
 .S X=$$PATCH^XPDUTL(PSBDATA)
"RTN","PSBUTL",203,0)
 .S RESULTS(0)=$S(X:"1^Patch Is Installed",1:"-1^Patch Is Not Installed")
"RTN","PSBUTL",204,0)
 Q
"RTN","PSBUTL",205,0)
 ;
"RTN","PSBUTL",206,0)
VERSION() ; [Extrinsic] 
"RTN","PSBUTL",207,0)
 ; Returns V#.# for display purposes
"RTN","PSBUTL",208,0)
 Q "V"_$J(2,0,1)
"RTN","PSBUTL",209,0)
 ;
"RTN","PSBUTL",210,0)
RESETADM ;
"RTN","PSBUTL",211,0)
 ;
"RTN","PSBUTL",212,0)
 ;  This Subroutine will reset a medication order's resources
"RTN","PSBUTL",213,0)
 ;  based on Med Log New Entry  or  Edit Med Log activity.
"RTN","PSBUTL",214,0)
 ;
"RTN","PSBUTL",215,0)
 ;  No input is necessary.  Environment should be setup at call.
"RTN","PSBUTL",216,0)
 ;
"RTN","PSBUTL",217,0)
 I '$G(PSBMMEN) S X=$S($P(PSBIEN,",",2)]"":$P(PSBIEN,",",2),1:+PSBIEN) D CLEAN^PSBVT,PSJ1^PSBVT($P(^PSB(53.79,X,0),U),$P(^PSB(53.79,X,.1),U)) D:($$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)))  D CLEAN^PSBVT
"RTN","PSBUTL",218,0)
 .S X=PSBIEN,X2=X_$S(X="+1":",",1:"") Q:'$D(PSBFDA(53.79,X2,.09))  I $F("HR",PSBFDA(53.79,X2,.09))>1 S PSBFDA(53.79,X2,.26)=""
"RTN","PSBUTL",219,0)
 I $G(PSBMMEN),PSBIEN="+1",$G(PSBONX)["V" S PSBWSID=PSBFDA(53.79,"+1,",.26) K PSBFDA(53.79,"+1,",.26),PSBFDA(53.79,"+1,",.09)
"RTN","PSBUTL",220,0)
 I $G(PSBMMEN) I ($D(PSBWSID))&($G(Y(0))="SAVE") D
"RTN","PSBUTL",221,0)
 .S:(PSBREC(3)="G") PSBFDAX(53.79,X,.26)=PSBWSID
"RTN","PSBUTL",222,0)
 .S:$F("HR",PSBREC(3))>1 PSBFDAX(53.79,X,.26)=""
"RTN","PSBUTL",223,0)
 .S X=$P(PSBIEN,"+1,",2)
"RTN","PSBUTL",224,0)
 .D UPDATE^DIE("","PSBFDAX","X","PSBMSG")
"RTN","PSBUTL",225,0)
 Q
"RTN","PSBUTL",226,0)
 ;
"VER")
8.0^22.0
**END**
**END**
