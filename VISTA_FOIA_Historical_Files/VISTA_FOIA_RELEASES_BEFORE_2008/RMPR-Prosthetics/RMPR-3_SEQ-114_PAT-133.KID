Released RMPR*3*133 SEQ #114
Extracted from mail message
**KIDS**:RMPR*3.0*133^

**INSTALL NAME**
RMPR*3.0*133
"BLD",6461,0)
RMPR*3.0*133^PROSTHETICS^0^3070227^y
"BLD",6461,1,0)
^^10^10^3070124^
"BLD",6461,1,1,0)
1.  CAN+5^RMPR4M removing item from order
"BLD",6461,1,2,0)
 
"BLD",6461,1,3,0)
2.  Two entries in V PROVIDER file from Prosthetics Midnight PCE task
"BLD",6461,1,4,0)
 
"BLD",6461,1,5,0)
3.  Question on data in File 9000010 (Visit File) for field CREATED BY 
"BLD",6461,1,6,0)
    USER
"BLD",6461,1,7,0)
 
"BLD",6461,1,8,0)
4.  Error <SUBSCRIPT>DESP+19^RMPRN6
"BLD",6461,1,9,0)
 
"BLD",6461,1,10,0)
5.  Security Statement - Prosthetics Purchase Order
"BLD",6461,4,0)
^9.64PA^^
"BLD",6461,6.3)
2
"BLD",6461,"ABPKG")
n
"BLD",6461,"KRN",0)
^9.67PA^8989.52^19
"BLD",6461,"KRN",.4,0)
.4
"BLD",6461,"KRN",.401,0)
.401
"BLD",6461,"KRN",.402,0)
.402
"BLD",6461,"KRN",.403,0)
.403
"BLD",6461,"KRN",.5,0)
.5
"BLD",6461,"KRN",.84,0)
.84
"BLD",6461,"KRN",3.6,0)
3.6
"BLD",6461,"KRN",3.8,0)
3.8
"BLD",6461,"KRN",9.2,0)
9.2
"BLD",6461,"KRN",9.8,0)
9.8
"BLD",6461,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",6461,"KRN",9.8,"NM",1,0)
RMPR4M^^0^B29241453
"BLD",6461,"KRN",9.8,"NM",2,0)
RMPR4E21^^0^B60269025
"BLD",6461,"KRN",9.8,"NM",3,0)
RMPRPCEA^^0^B53901671
"BLD",6461,"KRN",9.8,"NM",4,0)
RMPRPCEB^^0^B21783607
"BLD",6461,"KRN",9.8,"NM",5,0)
RMPRN6PL^^0^B16252833
"BLD",6461,"KRN",9.8,"NM",6,0)
RMPRP21^^0^B32044208
"BLD",6461,"KRN",9.8,"NM",7,0)
RMPR4P21^^0^B32742391
"BLD",6461,"KRN",9.8,"NM",8,0)
RMPR9P21^^0^B40804309
"BLD",6461,"KRN",9.8,"NM","B","RMPR4E21",2)

"BLD",6461,"KRN",9.8,"NM","B","RMPR4M",1)

"BLD",6461,"KRN",9.8,"NM","B","RMPR4P21",7)

"BLD",6461,"KRN",9.8,"NM","B","RMPR9P21",8)

"BLD",6461,"KRN",9.8,"NM","B","RMPRN6PL",5)

"BLD",6461,"KRN",9.8,"NM","B","RMPRP21",6)

"BLD",6461,"KRN",9.8,"NM","B","RMPRPCEA",3)

"BLD",6461,"KRN",9.8,"NM","B","RMPRPCEB",4)

"BLD",6461,"KRN",19,0)
19
"BLD",6461,"KRN",19,"NM",0)
^9.68A^^
"BLD",6461,"KRN",19.1,0)
19.1
"BLD",6461,"KRN",101,0)
101
"BLD",6461,"KRN",409.61,0)
409.61
"BLD",6461,"KRN",771,0)
771
"BLD",6461,"KRN",870,0)
870
"BLD",6461,"KRN",8989.51,0)
8989.51
"BLD",6461,"KRN",8989.52,0)
8989.52
"BLD",6461,"KRN",8994,0)
8994
"BLD",6461,"KRN","B",.4,.4)

"BLD",6461,"KRN","B",.401,.401)

"BLD",6461,"KRN","B",.402,.402)

"BLD",6461,"KRN","B",.403,.403)

"BLD",6461,"KRN","B",.5,.5)

"BLD",6461,"KRN","B",.84,.84)

"BLD",6461,"KRN","B",3.6,3.6)

"BLD",6461,"KRN","B",3.8,3.8)

"BLD",6461,"KRN","B",9.2,9.2)

"BLD",6461,"KRN","B",9.8,9.8)

"BLD",6461,"KRN","B",19,19)

"BLD",6461,"KRN","B",19.1,19.1)

"BLD",6461,"KRN","B",101,101)

"BLD",6461,"KRN","B",409.61,409.61)

"BLD",6461,"KRN","B",771,771)

"BLD",6461,"KRN","B",870,870)

"BLD",6461,"KRN","B",8989.51,8989.51)

"BLD",6461,"KRN","B",8989.52,8989.52)

"BLD",6461,"KRN","B",8994,8994)

"BLD",6461,"QUES",0)
^9.62^^
"BLD",6461,"REQB",0)
^9.611^7^7
"BLD",6461,"REQB",1,0)
RMPR*3.0*72^2
"BLD",6461,"REQB",2,0)
RMPR*3.0*90^2
"BLD",6461,"REQB",3,0)
RMPR*3.0*118^2
"BLD",6461,"REQB",4,0)
RMPR*3.0*119^2
"BLD",6461,"REQB",5,0)
RMPR*3.0*129^2
"BLD",6461,"REQB",6,0)
RMPR*3.0*131^2
"BLD",6461,"REQB",7,0)
RMPR*3.0*132^2
"BLD",6461,"REQB","B","RMPR*3.0*118",3)

"BLD",6461,"REQB","B","RMPR*3.0*119",4)

"BLD",6461,"REQB","B","RMPR*3.0*129",5)

"BLD",6461,"REQB","B","RMPR*3.0*131",6)

"BLD",6461,"REQB","B","RMPR*3.0*132",7)

"BLD",6461,"REQB","B","RMPR*3.0*72",1)

"BLD",6461,"REQB","B","RMPR*3.0*90",2)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
133^3070227
"PKG",101,22,1,"PAH",1,1,0)
^^10^10^3070227
"PKG",101,22,1,"PAH",1,1,1,0)
1.  CAN+5^RMPR4M removing item from order
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2.  Two entries in V PROVIDER file from Prosthetics Midnight PCE task
"PKG",101,22,1,"PAH",1,1,4,0)
 
"PKG",101,22,1,"PAH",1,1,5,0)
3.  Question on data in File 9000010 (Visit File) for field CREATED BY 
"PKG",101,22,1,"PAH",1,1,6,0)
    USER
"PKG",101,22,1,"PAH",1,1,7,0)
 
"PKG",101,22,1,"PAH",1,1,8,0)
4.  Error <SUBSCRIPT>DESP+19^RMPRN6
"PKG",101,22,1,"PAH",1,1,9,0)
 
"PKG",101,22,1,"PAH",1,1,10,0)
5.  Security Statement - Prosthetics Purchase Order
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RMPR4E21")
0^2^B60269025^B60190666
"RTN","RMPR4E21",1,0)
RMPR4E21 ;PHX/HNC - CLOSE OUT PURCHASE CARD TRANSACTION ;3/1/1996
"RTN","RMPR4E21",2,0)
 ;;3.0;PROSTHETICS;**3,12,26,28,30,34,41,45,62,111,78,114,118,133**;Feb 09, 1996;Build 2
"RTN","RMPR4E21",3,0)
 ;TH  Patch #78 - 08/04/03 - Add shipment date. Call routine ^RMPR4E23
"RTN","RMPR4E21",4,0)
 ;RVD patch #62 - PCE processing and link to suspense
"RTN","RMPR4E21",5,0)
 ;
"RTN","RMPR4E21",6,0)
 ;I '$D(^PRC(440.5,"H",DUZ)) W !!,"You are not an authorized Purchase Card User, CONTACT FISCAL!" Q
"RTN","RMPR4E21",7,0)
START I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR4E21",8,0)
CL K ^TMP($J,"RMPRPCE")
"RTN","RMPR4E21",9,0)
 K DIC S DIC="664",DIC(0)="AEQM",DIC("W")="D EN2^RMPR4D1",DIC("A")="Select PATIENT: "
"RTN","RMPR4E21",10,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,8)&'$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4E21",11,0)
 W !!,"You may also make a selection by Purchase Card Transaction"
"RTN","RMPR4E21",12,0)
 W !,"(Example, PO number), or Bank Authorization Number (6 digit number).",!
"RTN","RMPR4E21",13,0)
 D ^DIC S (DA,RMPRA)=+Y I Y=-1 G EXIT
"RTN","RMPR4E21",14,0)
 K DIC G:$P(^RMPR(664,RMPRA,0),U,8) M4 G:$P(^(0),U,5) M6
"RTN","RMPR4E21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPR4E21",16,0)
 ;get amis grouper number RGRP1
"RTN","RMPR4E21",17,0)
 S RGRP=0,RGRP1=""
"RTN","RMPR4E21",18,0)
 S RGRP=$O(^RMPR(664,RMPRA,1,RGRP)) G:'RGRP BRK S RGRPP=$P($G(^RMPR(664,RMPRA,1,RGRP,0)),U,13) I 'RGRPP W !!,$C(7),"ERROR** This transaction was not posted to 2319, please contact your IRM..",!! S DIR(0)="E" D ^DIR G EXIT
"RTN","RMPR4E21",19,0)
 S RGRP1=$P($G(^RMPR(660,RGRPP,"AMS")),U,1)
"RTN","RMPR4E21",20,0)
 S (RMPRDFN,DFN)=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17)
"RTN","RMPR4E21",21,0)
 D DEM^VADPT S RMPRSSNE=VA("PID"),RMPRSSN=+VADM(2),RMPRNAM=VADM(1) K VADM
"RTN","RMPR4E21",22,0)
 ;set original value before close-out
"RTN","RMPR4E21",23,0)
 K ^TMP("RM",$J),RM(RMPRA),RHCED S RMPRF=2
"RTN","RMPR4E21",24,0)
 K %X,%Y S %X="^RMPR(664,RMPRA,",%Y="^TMP("_"""RM"""_",$J,RMPRA," D %XY^%RCR
"RTN","RMPR4E21",25,0)
 S RM(RMPRA,0)=$G(^RMPR(664,RMPRA,0)),RM(RMPRA,2)=$G(^(2)),RM(RMPRA,4)=$G(^(4))
"RTN","RMPR4E21",26,0)
 S RMPER=$P(RM(RMPRA,2),U,6),RMBAN=$P(RM(RMPRA,4),U,2),RMSHI=$P(RM(RMPRA,0),U,11),RMSHIEN=$P(RM(RMPRA,0),U,12)
"RTN","RMPR4E21",27,0)
 ;added by #62
"RTN","RMPR4E21",28,0)
 ;collect all items and previous linkage to suspense.
"RTN","RMPR4E21",29,0)
 I $G(RMSHIEN) S:'$D(^RMPR(660,RMSHIEN,10)) RM60LINK(RMSHIEN)=""
"RTN","RMPR4E21",30,0)
 D COL^RMPRPCEL
"RTN","RMPR4E21",31,0)
 ;
"RTN","RMPR4E21",32,0)
L ;**** ask for final posting *****************************************
"RTN","RMPR4E21",33,0)
 D ^RMPR4LI N DIR K RFLG
"RTN","RMPR4E21",34,0)
 S DIR("A")="Ready to Reconcile and Close-Out Transaction",DIR("B")="NO",DIR(0)="Y"
"RTN","RMPR4E21",35,0)
 S DIR("?")="You may now Close-out and Post this Transaction. Please answer Yes or No."
"RTN","RMPR4E21",36,0)
 D ^DIR I Y["^"!($D(DTOUT)) W !,"Transaction NOT Closed-Out!" S:$D(^TMP("RM",$J)) RFLG=1 G:$D(RFLG) POST1 G KTMP
"RTN","RMPR4E21",37,0)
 I Y=1 G POST1
"RTN","RMPR4E21",38,0)
 ;***add/edit transaction**********************************************
"RTN","RMPR4E21",39,0)
L1 K DIR S DIR(0)="FO",DIR("A")="Select ITEM"
"RTN","RMPR4E21",40,0)
 S DIR("?")="^S RFL=1 D ZDSP^RMPR421A"
"RTN","RMPR4E21",41,0)
 D ^DIR G:(Y="^")!(Y="") DS G:$D(DTOUT) L
"RTN","RMPR4E21",42,0)
 G:$D(DIRUT)&($D(^RMPR(664,RMPRA,1))) L
"RTN","RMPR4E21",43,0)
 S DIC=661,DIC(0)="ENMZ" D ^DIC I +Y'>0 W !,"** No Item selected.." G DS
"RTN","RMPR4E21",44,0)
 G:$D(DTOUT)!$D(DUOUT) L
"RTN","RMPR4E21",45,0)
 D PROC G L1
"RTN","RMPR4E21",46,0)
 ;***process items*******************************************************
"RTN","RMPR4E21",47,0)
PROC N NEW S HY=+Y I $D(^RMPR(664,RMPRA,1,"B",+Y)) S DA=$O(^RMPR(664,RMPRA,1,"B",+Y,0)) G CHK
"RTN","RMPR4E21",48,0)
FILE S Y=HY,NUM=$P(^RMPR(664,RMPRA,1,0),U,4)+1,$P(^(0),U,4)=NUM,$P(^(0),U,3)=$P(^(0),U,3)+1,^RMPR(664,RMPRA,1,NUM,0)=+Y,DA=NUM,^RMPR(664,RMPRA,1,"B",+Y,NUM)="" S NEW=1
"RTN","RMPR4E21",49,0)
ENT K DR,DQ S DA(1)=RMPRA,DIE="^RMPR(664,"_RMPRA_",1,"
"RTN","RMPR4E21",50,0)
 ;S DR=$S($D(NEW):"",1:".01;")
"RTN","RMPR4E21",51,0)
 I '$D(NEW),($P(^RMPR(664,RMPRA,1,DA,0),U,7)="") S $P(^(0),U,7)=$P(^(0),U,3)
"RTN","RMPR4E21",52,0)
 S:'$D(NEW) RMDACA=$P(^RMPR(664,RMPRA,1,DA,0),U,13)
"RTN","RMPR4E21",53,0)
 S R4DA=DA
"RTN","RMPR4E21",54,0)
 S DR="8;S RMTYPE=$P(^RMPR(664,RMPRA,1,R4DA,0),U,9);9;.01;"
"RTN","RMPR4E21",55,0)
 S DR=DR_"16R;1;14;17;15;3R;"
"RTN","RMPR4E21",56,0)
 I $D(NEW) S DR=DR_"2R~UNIT COST;"
"RTN","RMPR4E21",57,0)
 E  S DR=DR_"6R;",RHCNEW=$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,16)
"RTN","RMPR4E21",58,0)
 S DR=DR_"4R~UNIT OF ISSUE;7;11////C" D ^DIE
"RTN","RMPR4E21",59,0)
 I $D(NEW) S:$G(DA) ^TMP("RM",$J,"N",R4DA)=$G(^RMPR(664,RMPRA,1,R4DA,0))
"RTN","RMPR4E21",60,0)
 E  S:'$G(DA)&(RMDACA) ^TMP("RM",$J,"C",RMDACA)="" I $G(DA) S ^TMP("RM",$J,"E",DA)=$G(^RMPR(664,RMPRA,1,DA,0)),RHCOLD=$P(^RMPR(664,RMPRA,1,DA,0),U,16),RD660=$P(^(0),U,13) I RHCNEW'=RHCOLD D
"RTN","RMPR4E21",61,0)
 .S RHCED=1
"RTN","RMPR4E21",62,0)
 .I $D(RD660)&(RD660) S DIE="^RMPR(660,",DA=RD660,DR="4.5///^S X=$G(RHCOLD)" D ^DIE
"RTN","RMPR4E21",63,0)
 I $D(R4DA),$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,10)=4 S DA=R4DA,DR=10 D ^DIE
"RTN","RMPR4E21",64,0)
 ;check for Type of Transaction and update the cpt modifier.
"RTN","RMPR4E21",65,0)
 I $D(R4DA),$D(RMTYPE) S RDATA=RMTYPE_"^"_RMPRA_"^"_R4DA D CHKCPT^RMPR4UTL(RDATA)
"RTN","RMPR4E21",66,0)
 Q:$D(DTOUT)  K NUM,R4DA,DA,Y,DR,RD660,RHCOLD,RHCNEW,DIE,RDATA,RMTYPE Q
"RTN","RMPR4E21",67,0)
CHK ;ADD DUPLICATE LINE ITEM
"RTN","RMPR4E21",68,0)
 K DIR,Y S DIR(0)="S^Y:YES;N:NO",DIR("A")="DO YOU WANT TO ADD A DUPLICATE ITEM?",DIR("B")="NO" D ^DIR Q:$D(DIRUT)!($D(DTOUT))  I (X["Y")!(X["y") G FILE
"RTN","RMPR4E21",69,0)
 S RD=0 F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD=RD+1
"RTN","RMPR4E21",70,0)
LKP I RD>1 D  Q:$D(DIRUT)!$D(DTOUT)  I '$D(RD(+Y)) W $C(7) G LKP
"RTN","RMPR4E21",71,0)
 .F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD(RDA)=^RMPR(664,RMPRA,1,RDA,0) W !?5,RDA,?10,$P(^PRC(441,$P(^RMPR(661,$P(RD(RDA),U),0),U),0),U,2),"  $",$S($P(RD(RDA),U,7)'="":$P(RD(RDA),U,7),1:$P(RD(RDA),U,3))
"RTN","RMPR4E21",72,0)
 .K DIR,Y S DIR(0)="N" D ^DIR I +Y S DA=+Y
"RTN","RMPR4E21",73,0)
 G ENT
"RTN","RMPR4E21",74,0)
 ;
"RTN","RMPR4E21",75,0)
DS ;**** update shipping cost, % discount and bank authorization ********
"RTN","RMPR4E21",76,0)
 S (RMPERF,RMBANF,RMSHIF)=0
"RTN","RMPR4E21",77,0)
 I $P(^RMPR(664,RMPRA,0),U,11)="",$P(^(0),U,10) S $P(^(0),U,11)=$P(RM(RMPRA,0),U,10)
"RTN","RMPR4E21",78,0)
 S DA=RMPRA,DIE="^RMPR(664,",DR="12;17;26" D ^DIE
"RTN","RMPR4E21",79,0)
 I RMPER'=$P(^RMPR(664,RMPRA,2),U,6) S RMPERF=1
"RTN","RMPR4E21",80,0)
 I RMBAN'=$P(^RMPR(664,RMPRA,4),U,2) S RMBANF=1
"RTN","RMPR4E21",81,0)
 I RMSHI'=$P(^RMPR(664,RMPRA,0),U,11) S RMSHIF=1
"RTN","RMPR4E21",82,0)
 S:$P(^RMPR(664,RMPRA,0),U,11)="" $P(^(0),U,11)=0
"RTN","RMPR4E21",83,0)
CHK1 ;delete imcomplete items
"RTN","RMPR4E21",84,0)
 S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMPRI=$G(^(I,0)) I $P(RMPRI,U,3)=""!($P(RMPRI,U,4)="")!($P(RMPRI,U,5)="") S DA=I D ^DIK
"RTN","RMPR4E21",85,0)
 G L ;go back to select ITEM
"RTN","RMPR4E21",86,0)
 ;*************************************************************
"RTN","RMPR4E21",87,0)
POST1 ;SET AMOUNT FOR IFCAP AMENDMENT.
"RTN","RMPR4E21",88,0)
 S (R1,RMPR("AMT"),AMT,DCT,RMPRTO)=0
"RTN","RMPR4E21",89,0)
 I $D(^RMPR(664,RMPRA,2)),$P(^(2),U,6) S DCT=$P(^(2),U,6),DCT=DCT/100
"RTN","RMPR4E21",90,0)
 F RI=0:0 S RI=$O(^RMPR(664,RMPRA,1,RI)) Q:RI'>0  D
"RTN","RMPR4E21",91,0)
 .N RMACT
"RTN","RMPR4E21",92,0)
 .S RMX=$G(^RMPR(664,RMPRA,1,RI,0)),RMACT=$P(RMX,U,7),RMQTY=$P(RMX,U,4)
"RTN","RMPR4E21",93,0)
 .I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:$P(RMX,U,3)-$J($P(RMX,U,3)*DCT,0,2)*RMQTY)
"RTN","RMPR4E21",94,0)
 .I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:$P(RMX,U,3)*RMQTY)
"RTN","RMPR4E21",95,0)
 .S RMPR("AMT")=RMPR("AMT")+RMTOT,RMPRTO=RMPR("AMT")
"RTN","RMPR4E21",96,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,11)=0:0,$P(^RMPR(664,RMPRA,0),U,11):$P(^(0),U,11),$P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR4E21",97,0)
 D CHECK^RMPRCT I '$D(RMPRTO) W !,"***** NOT CLOSED-OUT !!!!" G KTMP
"RTN","RMPR4E21",98,0)
 ;**************************************************************
"RTN","RMPR4E21",99,0)
 ;check 4;3,2;8&2;9&4;6 call PRCH7C if needed
"RTN","RMPR4E21",100,0)
 ;if total amount has not changed, then don't need to call ammend
"RTN","RMPR4E21",101,0)
 ;if it is an early record with no ifcap order then don't call ammend
"RTN","RMPR4E21",102,0)
 ;set the reprint flag
"RTN","RMPR4E21",103,0)
 I $FN($P(^RMPR(664,RMPRA,4),U,3),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)&($P(^(2),U,9)="")!($P(^(2),U,9)'="")&($FN($P(^(2),U,9),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)) D  I (X=0)&'$D(^TMP("RM",$J)) W !!,"**** NOT CLOSED-OUT!! ****" G KTMP
"RTN","RMPR4E21",104,0)
 .;call IFCAP AMMEND
"RTN","RMPR4E21",105,0)
 .S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) I RMPR442="" Q
"RTN","RMPR4E21",106,0)
 .D AMEND^PRCH7C(RMPR442,RMPRTO+RMPRSH)
"RTN","RMPR4E21",107,0)
 .I X=1 S $P(^RMPR(664,RMPRA,2),U,8)=DUZ,$P(^RMPR(664,RMPRA,2),U,9)=RMPRTO+RMPRSH,$P(^RMPR(664,RMPRA,2),U,10)=1
"RTN","RMPR4E21",108,0)
 .I X'=1 S $P(^RMPR(664,RMPRA,2),U,10)=""
"RTN","RMPR4E21",109,0)
 ;do posting to 660
"RTN","RMPR4E21",110,0)
 I $D(^TMP("RM",$J))!$G(RMSHIF)!$G(RMPERF)!$G(RMBANF) D POST2^RMPR4M
"RTN","RMPR4E21",111,0)
 I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) S $P(^("AM"),U,2)=1 S $P(^RMPR(664.2,+RMPRWO,0),U,7)=$P(^(0),U,7)+RMPRSH D DA0^RMPR29M(RMPRDA,RMPRA),POST^RMPR29U
"RTN","RMPR4E21",112,0)
 G:$D(RFLG) EXIT
"RTN","RMPR4E21",113,0)
 ;go to exit in above line if not close-out.
"RTN","RMPR4E21",114,0)
 ;close-out remarks
"RTN","RMPR4E21",115,0)
 W ! S DIE="^RMPR(664,",DA=RMPRA,DR="8.1" D ^DIE S RMPRCC=$P($G(^RMPR(664,RMPRA,2)),U,3)
"RTN","RMPR4E21",116,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  I $D(^(R1,0)) D
"RTN","RMPR4E21",117,0)
 .N RM660
"RTN","RMPR4E21",118,0)
 .S RM660=$P($G(^(0)),U,13) I RM660,$P($G(^RMPR(660,RM660,0)),U,18)'[RMPRCC S $P(^(0),U,18)=$P(^(0),U,18)_" "_RMPRCC
"RTN","RMPR4E21",119,0)
 ;
"RTN","RMPR4E21",120,0)
EX ;***reindex record in 664 here
"RTN","RMPR4E21",121,0)
 L -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",122,0)
 ;IFCAP final charge payment
"RTN","RMPR4E21",123,0)
 S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) ;don't call recon if it is an early record, no ifcap order.
"RTN","RMPR4E21",124,0)
 D:RMPR442'="" RECON^PRCH7C(RMPR442,DUZ)
"RTN","RMPR4E21",125,0)
 I (X=0)&(RMPR442'="") W !!,"**** TRANSACTION NOT CLOSED-OUT!! ****" G EX1
"RTN","RMPR4E21",126,0)
 S $P(^RMPR(664,RMPRA,4),U,4)=RMPRTO+RMPRSH
"RTN","RMPR4E21",127,0)
 ;set close out date 
"RTN","RMPR4E21",128,0)
 D NOW^%DTC S $P(^RMPR(664,RMPRA,0),U,8)=%
"RTN","RMPR4E21",129,0)
 ;set closed by
"RTN","RMPR4E21",130,0)
 S $P(^RMPR(664,RMPRA,2),U,7)=DUZ,DA=$P(^RMPR(664,RMPRA,0),U,12)
"RTN","RMPR4E21",131,0)
 I DA'="" S $P(^RMPR(660,DA,0),U,12)=%,DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4E21",132,0)
 S RMPR660=0,DA="",DIK="^RMPR(660,"
"RTN","RMPR4E21",133,0)
 F  S RMPR660=$O(^RMPR(664,RMPRA,1,RMPR660)) Q:RMPR660'>0  D
"RTN","RMPR4E21",134,0)
 .;get pointer from item mult
"RTN","RMPR4E21",135,0)
 .S DA=$P(^RMPR(664,RMPRA,1,RMPR660,0),U,13)
"RTN","RMPR4E21",136,0)
 .;set delivery date
"RTN","RMPR4E21",137,0)
 .I DA'="" S $P(^RMPR(660,DA,0),U,12)=DT D IX1^DIK
"RTN","RMPR4E21",138,0)
 .;Patch #78 - Get IFCAP Transaction Date and prompt for Shipment Date
"RTN","RMPR4E21",139,0)
 .I DA'="" S SKPSHDT=1 D ^RMPR4E23 K SKPSHDT
"RTN","RMPR4E21",140,0)
EX1 ;
"RTN","RMPR4E21",141,0)
 ;added by #62
"RTN","RMPR4E21",142,0)
 D:$D(RM68FG)=1 AUTO^RMPRPCEL D:$D(RM68FG)>1 MAN^RMPRPCEL
"RTN","RMPR4E21",143,0)
 ;
"RTN","RMPR4E21",144,0)
 D EXIT
"RTN","RMPR4E21",145,0)
 W !!,"Enter Next Transaction to Close-out, or <RETURN> to continue."
"RTN","RMPR4E21",146,0)
 G CL
"RTN","RMPR4E21",147,0)
 ;
"RTN","RMPR4E21",148,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPR4E21",149,0)
 L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",150,0)
 K ^TMP($J),^TMP("RM")
"RTN","RMPR4E21",151,0)
 K RGRP,RGRP1,RGRPP,RMBAN,RMBANF
"RTN","RMPR4E21",152,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR4E21",153,0)
 Q
"RTN","RMPR4E21",154,0)
 ;
"RTN","RMPR4E21",155,0)
KTMP S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S DA=I D ^DIK
"RTN","RMPR4E21",156,0)
 S %X="^TMP("_"""RM"""_",$J,RMPRA,",%Y="^RMPR(664,RMPRA," D %XY^%RCR G EX1
"RTN","RMPR4E21",157,0)
BRK W !,$C(7),"INCOMPLETE RECORD..file 664..entry..",RMPRA,"...PLEASE CONTACT YOUR IRM or CANCEL THIS ENTRY!!!" G EX1
"RTN","RMPR4E21",158,0)
UNK W !,$C(7),"UNKNOWN 2319 RECORD TO UPDATE, 2319 NOT UPDATED!" G EXIT
"RTN","RMPR4E21",159,0)
M4 W !,$C(7),"This Transaction has already been CLOSED!" G EXIT
"RTN","RMPR4E21",160,0)
M6 W !,$C(7),"This Transaction has been CANCELED!" G EXIT
"RTN","RMPR4M")
0^1^B29241453^B29129320
"RTN","RMPR4M",1,0)
RMPR4M ;PHX/HNB,RVD - PURCHASE CARD MODULE FUNCTIONS ;3/1/1996
"RTN","RMPR4M",2,0)
 ;;3.0;PROSTHETICS;**3,26,28,30,41,62,90,133**;Feb 09, 1996;Build 2
"RTN","RMPR4M",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RMPR4M",4,0)
 ;
"RTN","RMPR4M",5,0)
 ; RVD patch #62 - pce and suspense link to 2319
"RTN","RMPR4M",6,0)
POST2 ;*** Posting Data to 2319 *******************************************
"RTN","RMPR4M",7,0)
 ;set global to local table/variables
"RTN","RMPR4M",8,0)
 S R190=$G(^RMPR(664,RMPRA,0))
"RTN","RMPR4M",9,0)
 S R192=$G(^RMPR(664,RMPRA,2))
"RTN","RMPR4M",10,0)
 S R193=$G(^RMPR(664,RMPRA,3))
"RTN","RMPR4M",11,0)
 S R194=$G(^RMPR(664,RMPRA,4))
"RTN","RMPR4M",12,0)
 W !,"...now posting to file 660..."
"RTN","RMPR4M",13,0)
ADD ;for adding new entry in 2319
"RTN","RMPR4M",14,0)
 S RMPHC="" I $D(^TMP("RM",$J,"N")) D
"RTN","RMPR4M",15,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)) I RMI D
"RTN","RMPR4M",16,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",17,0)
 ..S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",18,0)
 ..K DD,DO D FILE^DICN
"RTN","RMPR4M",19,0)
 ..S $P(^RMPR(664,RMPRA,1,I,0),U,13)=+Y
"RTN","RMPR4M",20,0)
 ..D TOT
"RTN","RMPR4M",21,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",22,0)
 ..S R19A=+Y
"RTN","RMPR4M",23,0)
 ..S R19I=$G(^RMPR(664,RMPRA,1,I,0))
"RTN","RMPR4M",24,0)
 ..S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",25,0)
 ..S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",26,0)
 ..S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",27,0)
 ..S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",28,0)
 ..S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",29,0)
 ..S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",30,0)
 ..S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",31,0)
 ..S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",32,0)
 ..S R19(660,R19A_",",2)=$P(R19I,U,9)
"RTN","RMPR4M",33,0)
 ..S R19(660,R19A_",",4)=$P(R19I,U,1)
"RTN","RMPR4M",34,0)
 ..S R19(660,R19A_",",5)=$P(R19I,U,4)
"RTN","RMPR4M",35,0)
 ..S R19(660,R19A_",",4.5)=$P(R19I,U,16)
"RTN","RMPR4M",36,0)
 ..S R19(660,R19A_",",4.7)=RMCPT
"RTN","RMPR4M",37,0)
 ..S R19(660,R19A_",",4.1)=RMPHC
"RTN","RMPR4M",38,0)
 ..S R19(660,R19A_",",12)=$P(R19I,U,12)
"RTN","RMPR4M",39,0)
 ..S R19(660,R19A_",",78)=$P(R19I,U,5)
"RTN","RMPR4M",40,0)
 ..S R19(660,R19A_",",16)=$P(R19I,U,8)
"RTN","RMPR4M",41,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",42,0)
 ..S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",43,0)
 ..S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",44,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",45,0)
 ..S R19(660,R19A_",",14)=RMTOT
"RTN","RMPR4M",46,0)
 ..S R19(660,R19A_",",9)=$P(R19I,U,15)
"RTN","RMPR4M",47,0)
 ..S R19(660,R19A_",",11)=14
"RTN","RMPR4M",48,0)
 ..S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",49,0)
 ..S R19(660,R19A_",",8.14)=0
"RTN","RMPR4M",50,0)
 ..D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",51,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,R19A,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",52,0)
 ..MERGE ^RMPR(660,R19A,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",53,0)
 ..S RMPRDFN=$P(R190,U,2)
"RTN","RMPR4M",54,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",55,0)
 ..D CHK
"RTN","RMPR4M",56,0)
 ;
"RTN","RMPR4M",57,0)
EDIT ;for editing entry in 2319
"RTN","RMPR4M",58,0)
 S RMPHC="" I $D(^TMP("RM",$J,"E")) D
"RTN","RMPR4M",59,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"E",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",60,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",61,0)
 ..D TOT
"RTN","RMPR4M",62,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",63,0)
 ..S $P(^RMPR(660,DA,0),U,11)=$P(RMI,U,15)
"RTN","RMPR4M",64,0)
 ..S $P(^RMPR(660,DA,0),U,4)=$P(RMI,U,9)
"RTN","RMPR4M",65,0)
 ..S $P(^RMPR(660,DA,0),U,7)=$P(RMI,U,4)
"RTN","RMPR4M",66,0)
 ..S $P(^RMPR(660,DA,0),U,8)=$P(RMI,U,5)
"RTN","RMPR4M",67,0)
 ..S $P(^RMPR(660,DA,0),U,13)=14
"RTN","RMPR4M",68,0)
 ..S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",69,0)
 ..S $P(^RMPR(660,DA,"AM"),U,3)=$P(RMI,U,10)
"RTN","RMPR4M",70,0)
 ..S $P(^RMPR(660,DA,"AM"),U,4)=$P(RMI,U,11)
"RTN","RMPR4M",71,0)
 ..S $P(^RMPR(660,DA,0),U,22)=RMPHC
"RTN","RMPR4M",72,0)
 ..S $P(^RMPR(660,DA,1),U,4)=$P(RMI,U,16)
"RTN","RMPR4M",73,0)
 ..S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPR4M",74,0)
 ..S $P(^RMPR(660,DA,0),U,18)=$P(RMI,U,8)
"RTN","RMPR4M",75,0)
 ..;update brief descripton field 24 in 660
"RTN","RMPR4M",76,0)
 ..S $P(^RMPR(660,DA,1),U,2)=$P(RMI,U,2)
"RTN","RMPR4M",77,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,DA,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",78,0)
 ..;added by patch #62
"RTN","RMPR4M",79,0)
 ..I $D(^RMPR(660,DA,10)) S RM10STAT=$P(^RMPR(660,DA,10),U,14)
"RTN","RMPR4M",80,0)
 ..I '$D(^RMPR(660,DA,10))!'$G(RM10STAT) D
"RTN","RMPR4M",81,0)
 ...K RM10STAT
"RTN","RMPR4M",82,0)
 ...S RM60LINK(DA)=""
"RTN","RMPR4M",83,0)
 ..MERGE ^RMPR(660,DA,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",84,0)
 ..S DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4M",85,0)
SHIP ;for shipping entry in 2319
"RTN","RMPR4M",86,0)
 I $G(RMSHIF) S DA=$P(R190,U,12) S:$G(DA) $P(^RMPR(660,DA,0),U,17)=$P(R190,U,11),$P(^RMPR(660,DA,0),U,16)=$P(R190,U,11) I '$G(DA) D
"RTN","RMPR4M",87,0)
 .S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",88,0)
 .K DD,DO D FILE^DICN
"RTN","RMPR4M",89,0)
 .S $P(^RMPR(664,RMPRA,0),U,12)=+Y
"RTN","RMPR4M",90,0)
 .S R19IEN=$O(^RMPR(664,RMPRA,1,0)) Q:R19IEN=""
"RTN","RMPR4M",91,0)
 .S R19I=$G(^RMPR(664,RMPRA,1,R19IEN,0))
"RTN","RMPR4M",92,0)
 .S R19A=+Y
"RTN","RMPR4M",93,0)
 .S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",94,0)
 .S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",95,0)
 .S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",96,0)
 .S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",97,0)
 .S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",98,0)
 .S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",99,0)
 .S R19(660,R19A_",",2)="X"
"RTN","RMPR4M",100,0)
 .S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",101,0)
 .S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",102,0)
 .S R19(660,R19A_",",6)=$P(R190,U,11)
"RTN","RMPR4M",103,0)
 .S R19(660,R19A_",",14)=$P(R190,U,11)
"RTN","RMPR4M",104,0)
 .S R19(660,R19A_",",11)=14
"RTN","RMPR4M",105,0)
 .S R19(660,R19A_",",12)="C"
"RTN","RMPR4M",106,0)
 .S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",107,0)
 .S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",108,0)
 .S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",109,0)
 .D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",110,0)
 .I $D(^RMPR(660,R19A,10)) S RM10STAT=$P(^RMPR(660,R19A,10),U,14)
"RTN","RMPR4M",111,0)
 .I '$D(^RMPR(660,R19A,10))!'$G(RM10STAT) D
"RTN","RMPR4M",112,0)
 ..K RM10STAT
"RTN","RMPR4M",113,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",114,0)
 ;
"RTN","RMPR4M",115,0)
CAN ;for CANCELING entry in 2319
"RTN","RMPR4M",116,0)
 ;call pce delete if patient encounter was recorded.
"RTN","RMPR4M",117,0)
 N RMI
"RTN","RMPR4M",118,0)
 I $D(^TMP("RM",$J,"C")) S DIK="^RMPR(660," F RMI=0:0 S RMI=$O(^TMP("RM",$J,"C",RMI)) Q:RMI'>0  D
"RTN","RMPR4M",119,0)
 .I $D(^RMPR(660,RMI,10)),$P(^RMPR(660,RMI,10),U,12) D
"RTN","RMPR4M",120,0)
 ..S RMCHK=0
"RTN","RMPR4M",121,0)
 ..S RMCHK=$$DEL^RMPRPCED(RMI)
"RTN","RMPR4M",122,0)
 .S DA=RMI D ^DIK
"RTN","RMPR4M",123,0)
 ;
"RTN","RMPR4M",124,0)
UPD ; Update Percent discount, Bank Authorization and remove shipping entry.
"RTN","RMPR4M",125,0)
 I $G(RMPERF)!$G(RMBANF) D
"RTN","RMPR4M",126,0)
 .F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMI=$G(^(I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",127,0)
 ..I $G(RMPERF) D TOT S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",128,0)
 ..S:$G(RMBANF) $P(^RMPR(660,DA,4),U,2)=$P(R194,U,2)
"RTN","RMPR4M",129,0)
 I $G(RMSHIF),($P(^RMPR(664,RMPRA,0),U,11)=0) S DA=$P(^(0),U,12),DIK="^RMPR(660," D ^DIK S $P(^RMPR(664,RMPRA,0),U,12)=""
"RTN","RMPR4M",130,0)
 ;
"RTN","RMPR4M",131,0)
KILL K RMTOT,RMI,R19I,R19A,DR,DA,RMPERF,RMBANF,RMSHIF,RMPHC,RMCPT
"RTN","RMPR4M",132,0)
 Q
"RTN","RMPR4M",133,0)
TOT S RMACT=$P(RMI,U,7),RMUNC=$P(RMI,U,3),RMQTY=$P(RMI,U,4)
"RTN","RMPR4M",134,0)
 I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:RMUNC-$J(RMUNC*DCT,0,2)*RMQTY)
"RTN","RMPR4M",135,0)
 I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:RMUNC*RMQTY)
"RTN","RMPR4M",136,0)
 Q
"RTN","RMPR4M",137,0)
CHK I '$D(^RMPR(660,R19A,0)) W !!,$C(7),"**** POSTING TO 2319 FOR ITEM.."_I_" FAILED",!,"PLEASE RUN CLOSE-OUT OPTION AGAIN..." G KTMP^RMPR4E21
"RTN","RMPR4M",138,0)
 Q
"RTN","RMPR4P21")
0^7^B32742391^B31454912
"RTN","RMPR4P21",1,0)
RMPR4P21 ;PHX/HNC,RVD -PRINT PURCHASE CARD ORDER ;3/1/1996
"RTN","RMPR4P21",2,0)
 ;;3.0;PROSTHETICS;**3,15,19,26,55,90,132,133**;Feb 09, 1996;Build 2
"RTN","RMPR4P21",3,0)
 ;
"RTN","RMPR4P21",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace hard code mail route symbol 121
"RTN","RMPR4P21",5,0)
 ;                            with extrinsic call to read site param.
"RTN","RMPR4P21",6,0)
 ;                            (nois AUG-1097-32118)
"RTN","RMPR4P21",7,0)
 ;
"RTN","RMPR4P21",8,0)
 G:$D(RMPRA)&($G(RMPRA)'>0) EN I '$D(RMPR)!'$D(RMPRSITE) D DIV4^RMPRSIT G:$D(X) EX
"RTN","RMPR4P21",9,0)
 I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1) S %ZIS="MQ" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",10,0)
 I $D(RMPRA)&('$P(^RMPR(669.9,RMPRSITE,0),U,5)) G ZIS
"RTN","RMPR4P21",11,0)
EN1(RMPRPTR) ;
"RTN","RMPR4P21",12,0)
 I $D(RMPRPTR) I $D(RMPRA)&($D(^%ZIS(1,RMPRPTR,0))) S IOP="Q;"_$P(^(0),U,1) S %ZIS="MQ" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",13,0)
EN ;ENTRY POINT FOR REPRINTING- Modified in patch 90 HNC
"RTN","RMPR4P21",14,0)
 I '$D(RMPR)!'$D(RMPRSITE) D DIV4^RMPRSIT G:$D(X) EX
"RTN","RMPR4P21",15,0)
 S RMPRACT=1,DIC="^RMPR(664,",DIC(0)="AEQM",DIC("A")="Select Transaction or Patient Name: ",RMPRF=2
"RTN","RMPR4P21",16,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4P21",17,0)
 S DIC("W")="D EN2^RMPR4D1"
"RTN","RMPR4P21",18,0)
 D ^DIC G:Y<0 EX
"RTN","RMPR4P21",19,0)
 S RMPRA=+Y
"RTN","RMPR4P21",20,0)
 ;I $P(^RMPR(664,+Y,0),U,5) D M2^RMPRM
"RTN","RMPR4P21",21,0)
 D PR^RMPR421A I %'>0 G EX
"RTN","RMPR4P21",22,0)
 ;I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1),%ZIS="Q" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",23,0)
ZIS S %ZIS="QM" D ^%ZIS G:POP EX
"RTN","RMPR4P21",24,0)
 I '$D(IO("Q")) U IO G PRT
"RTN","RMPR4P21",25,0)
 S ZTIO=ION
"RTN","RMPR4P21",26,0)
PT S ZTDTH=$H,ZTSAVE("RMPRPN")="",ZTSAVE("RMPRA")="",ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")="",ZTRTN="PRT^RMPR4P21",ZTDESC="PURCHASE CARD ORDER"
"RTN","RMPR4P21",27,0)
  S:$D(RMPRPRIV) ZTSAVE("RMPRPRIV")="" D ^%ZTLOAD W !,$S($D(ZTSK):"<REQUEST QUEUED>",1:"<REQUEST NOT QUEUED>") D HOME^%ZIS H 3 G EX
"RTN","RMPR4P21",28,0)
PRT ;ENTRY POINT TO PRINT
"RTN","RMPR4P21",29,0)
 S %X="^RMPR(664,RMPRA,",%Y="R664(" D %XY^%RCR K %X,%Y
"RTN","RMPR4P21",30,0)
 S RDUZ=$P(R664(0),U,9),RDUZ=$P(^VA(200,RDUZ,0),U,1),DFN=$P(R664(0),U,2),RTN=$P(R664(0),U,7),CP=$P(R664(0),U,6),RMPRPAGE=2
"RTN","RMPR4P21",31,0)
 D ADD^VADPT,DEM^VADPT,ELIG^VADPT
"RTN","RMPR4P21",32,0)
 W:$Y>0 @IOF W ?20,"OMB Number 2900-0188",?50,"PO#: ",$P($G(^RMPR(664,RMPRA,4)),U,5)
"RTN","RMPR4P21",33,0)
 W !,"By receiving this purchase order you agree to take appropriate measures to"
"RTN","RMPR4P21",34,0)
 W !,"secure the information and ensure the confidentiality of the patient information"
"RTN","RMPR4P21",35,0)
 W !,"is maintained. ORIGINAL PO AND INVOICE MUST BE SUBMITTED TO THE VAMC BELOW"
"RTN","RMPR4P21",36,0)
HDR ;PRINT HEADER FOR 2421 ADDRESS INFO
"RTN","RMPR4P21",37,0)
 S (RMPRT,RMPRB)="",$P(RMPRT,"_",IOM)="",$P(RMPRB,"-",IOM)="" W !,RMPRT,!,"Department of Veterans Affairs"_"|"_"Prosthetic Authorization for Items or Services",!,RMPRB
"RTN","RMPR4P21",38,0)
 W !,"1. Name and Address of Vendor",?40,"2. Name and Address of VA Facility"
"RTN","RMPR4P21",39,0)
 S RMPRV=$P(R664(0),U,4),RMPRST=""
"RTN","RMPR4P21",40,0)
 I $D(^PRC(440,RMPRV,0)) S RMPRV=^PRC(440,RMPRV,0) D
"RTN","RMPR4P21",41,0)
 .S RMPRST=$P(RMPRV,U,7),RMPRPHON=$P(RMPRV,U,10)
"RTN","RMPR4P21",42,0)
 .S RMPRAD1=$P(RMPRV,U,2),RMPRAD2=$P(RMPRV,U,3)
"RTN","RMPR4P21",43,0)
 .S RMPRCITY=$P(RMPRV,U,6),RMPR90IP=$P(RMPRV,U,8)
"RTN","RMPR4P21",44,0)
 .S RMPRVACN=$P($G(^PRC(440,$P(R664(0),U,4),2)),U,1)
"RTN","RMPR4P21",45,0)
 I $D(^DIC(5,+RMPRST,0)) S RMPRST=$P(^(0),U,2)
"RTN","RMPR4P21",46,0)
 E  S RMPRST="NO STATE ON FILE"
"RTN","RMPR4P21",47,0)
 W !,?5,$E($P(RMPRV,U,1),1,30),?40
"RTN","RMPR4P21",48,0)
 W $E(RMPR("NAME"),1,28)," ","(",$$STA^RMPRUTIL,"/",$$ROU^RMPRUTIL(RMPRSITE),")"
"RTN","RMPR4P21",49,0)
 W !,?5,$E(RMPRAD1,1,35),?40,$E(RMPR("ADD"),1,39)
"RTN","RMPR4P21",50,0)
 I RMPRAD2'="" W !,?5,$E(RMPRAD2,1,35),?40,RMPR("CITY")
"RTN","RMPR4P21",51,0)
 I RMPRAD2="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP,?40,RMPR("CITY")
"RTN","RMPR4P21",52,0)
 I RMPRAD2'="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP
"RTN","RMPR4P21",53,0)
 W !,?5,RMPRPHON
"RTN","RMPR4P21",54,0)
 ;W:$G(RMPRVACN)'="" ?22,"ACCT # ",RMPRVACN
"RTN","RMPR4P21",55,0)
 W ?40,$P(^RMPR(669.9,RMPRSITE,0),U,4),!,RMPRB
"RTN","RMPR4P21",56,0)
 W !,"3. Veterans Name (Last, First, MI)",?40,"4. Date of Authorization"
"RTN","RMPR4P21",57,0)
 W !,?5,VADM(1) S Y=$P(R664(0),U,1) D DD^%DT W ?45,Y
"RTN","RMPR4P21",58,0)
 I $D(RMPRMOR) W !,RMPRB D HDR1 Q
"RTN","RMPR4P21",59,0)
 W !,RMPRB S RMPRODTE=Y
"RTN","RMPR4P21",60,0)
 S RMPRDELD="" I $D(R664(3)),$P(R664(3),U,2)]"" S Y=$P(R664(3),U,2) D DD^%DT S RMPRDELD=Y
"RTN","RMPR4P21",61,0)
 W !,"5. Veterans Address",?40,"6. Date Required",!,?5,VAPA(1),?45,RMPRDELD,!
"RTN","RMPR4P21",62,0)
 I VAPA(2)="" W ?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,$E(RMPRB,1,40),!,?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR4P21",63,0)
 I VAPA(2)'="" W ?5,VAPA(2),?40,$E(RMPRB,1,40),!,?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR4P21",64,0)
 W !,RMPRB
"RTN","RMPR4P21",65,0)
 W !,"7. Claim Number"_" "_VAEL(7),?40,"8. ID #:"_" "_$P($P(VADM(2),U,2),"-",3),!,RMPRB,!,"10. Statistical Data",?30,"11. FOB Point",?46,"12. Discount",?61,"13. Delivery Time"
"RTN","RMPR4P21",66,0)
 S R664("E")=$O(R664(1,0)),CAT=$P(R664(1,R664("E"),0),U,10)
"RTN","RMPR4P21",67,0)
 S RMPRCAT=$S(CAT=1:"SC/OP",CAT=2:"SC/IP",CAT=3:"NSC/IP",CAT=4:"NSC/OP",1:"")
"RTN","RMPR4P21",68,0)
 S SPE=$P(R664(1,R664("E"),0),U,11)
"RTN","RMPR4P21",69,0)
 S RMPRSCAT=$S(SPE=1:"SPECIAL LEGISLATION",SPE=2:"A&A",SPE=3:"PHC",SPE=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPR4P21",70,0)
 W !,RMPRCAT_" "_RMPRSCAT S:+$P(R664(0),U,10) RMPRFOB=$P(R664(0),U,10) W ?34,$S($D(RMPRFOB):"ORIGIN",1:"DEST"),?49,"% " I $D(R664(2)) W $P(R664(2),U,6)
"RTN","RMPR4P21",71,0)
 I $D(R664(3)) W ?66,$P(R664(3),U,3)_" Days"
"RTN","RMPR4P21",72,0)
 W !,?30,$E(RMPRB,1,50),!,?30,"14. Delivery To: " W:$D(R664(3)) $P(R664(3),U)
"RTN","RMPR4P21",73,0)
 W !,?36,"Attention: "_$P(R664(3),U,4) W !,RMPRB
"RTN","RMPR4P21",74,0)
HDR1 ;HEADER FOR 10-2421
"RTN","RMPR4P21",75,0)
 W !?17,"15. DESCRIPTION OF ITEMS OR SERVICES AUTHORIZED",!,RMPRB,!,"ITEM NUMBER",?23,"DESCRIPTION",?50,"QUANTITY",?60,"UNIT",?66,"UNIT",?73,"AMOUNT",!,?50,"ORDERED",?66,"PRICE",!,RMPRB Q:$D(RMPRMOR)
"RTN","RMPR4P21",76,0)
 D ^RMPR4P22 D:'$D(RMPRMOR1) CON^RMPR4P22
"RTN","RMPR4P21",77,0)
 S RMPRK=RMPRA
"RTN","RMPR4P21",78,0)
 D:$D(RMPRPRIV) ^RMPR4P23
"RTN","RMPR4P21",79,0)
 W:$G(RMPRPN)=1 @IOF,$$EN^RMPR4P24(RMPRK)
"RTN","RMPR4P21",80,0)
EX ;Common Exit Point
"RTN","RMPR4P21",81,0)
 K VADM,CP,DFN,CAT,DIC,R664,RMPRA,RMPACT,RMPRAD1,RMPRAD2,RMPRAMT,RMPRAMT1,RMPRB,RMPRCAT,RMPRCH,RMPRCITY,RMPRDELD,RMPRI,RMPRI1,RMPRIT,RMPRN,RMPRODTE,RMPRST,RMPRPHON,RMPRT,RMPRTOT,RMPRUT,RMPRV,RMPR90IP,RO,RP,J1,RTN,RMPRMOR1,RMPRPRIV
"RTN","RMPR4P21",82,0)
 K SPE,VA,VAEL,VAPA,VAERR,RZZZ,RX,RX1,RDUZ,RC,RMPRACT,RMPRSCAT,RMPRDISC,RMPRAMTN,DIR,DIRUT,RMPRAMT2,RMPRFOB,RMPRDA,RMPRMOR,RMPRPAGE,RMPRPRIV,RMPRX,RMPR90,J,K,N D ^%ZISC Q
"RTN","RMPR9P21")
0^8^B40804309^B40190006
"RTN","RMPR9P21",1,0)
RMPR9P21 ;PHX/SPS,HNC,RVD -SEND DATA TO PC TO PRINT PURCHASE CARD ORDER ;4/27/05
"RTN","RMPR9P21",2,0)
 ;;3.0;PROSTHETICS;**90,116,119,133**;Feb 09, 1996;Build 2
"RTN","RMPR9P21",3,0)
 ;
"RTN","RMPR9P21",4,0)
EN(RMPRA,RMPRSITE,RMPRPTR) ;ENTRY POINT FOR VISTA ROLL AND SCROLL
"RTN","RMPR9P21",5,0)
 G EN2
"RTN","RMPR9P21",6,0)
 ;
"RTN","RMPR9P21",7,0)
PRT(RESULTS,RMPRA,RMPRSITE,RMPRPTR) ;GUI ENTRY POINT TO PRINT
"RTN","RMPR9P21",8,0)
EN2 I RMPRPTR'="WINDOWS" Q
"RTN","RMPR9P21",9,0)
 K ^TMP($J,"RMPRPRT"),RESULTS
"RTN","RMPR9P21",10,0)
 D INF^RMPRSIT
"RTN","RMPR9P21",11,0)
 S %X="^RMPR(664,RMPRA,",%Y="R664(" D %XY^%RCR K %X,%Y,^TMP($J,"RMPRPRT")
"RTN","RMPR9P21",12,0)
 S RDUZ=$P(R664(0),U,9),RDUZ=$P(^VA(200,RDUZ,0),U,1),DFN=$P(R664(0),U,2),RTN=$P(R664(0),U,7),CP=$P(R664(0),U,6),RMPRPAGE=2
"RTN","RMPR9P21",13,0)
 D ADD^VADPT,DEM^VADPT,ELIG^VADPT
"RTN","RMPR9P21",14,0)
 S ^TMP($J,"RMPRPRT",0)="                           OMB Number 2900-0188                    PO#: "_$P($G(^RMPR(664,RMPRA,4)),U,5)
"RTN","RMPR9P21",15,0)
 S ^TMP($J,"RMPRPRT",1)="By receiving this purchase order you agree to take appropriate measures to"
"RTN","RMPR9P21",16,0)
 S ^TMP($J,"RMPRPRT",2)="secure the information and ensure the confidentiality of the patient information"
"RTN","RMPR9P21",17,0)
 S ^TMP($J,"RMPRPRT",3)="is maintained. ORIGINAL PO AND INVOICE MUST BE SUBMITTED TO THE VAMC BELOW"
"RTN","RMPR9P21",18,0)
HDR ;PRINT HEADER FOR 2421 ADDRESS INFO
"RTN","RMPR9P21",19,0)
 S K="" F  S K=$O(^TMP($J,"RMPRPRT",K)) Q:K=""  S CNT=K
"RTN","RMPR9P21",20,0)
 S (RMPRT,RMPRB)="",$P(RMPRT,"_",80)="",$P(RMPRB,"-",80)=""
"RTN","RMPR9P21",21,0)
 S ^TMP($J,"RMPRPRT",CNT+1)=RMPRT
"RTN","RMPR9P21",22,0)
 S ^TMP($J,"RMPRPRT",CNT+2)="Department of Veterans Affairs"_"|"_"Prosthetic Authorization for Items or Services"
"RTN","RMPR9P21",23,0)
 S ^TMP($J,"RMPRPRT",CNT+3)=RMPRB
"RTN","RMPR9P21",24,0)
 S ^TMP($J,"RMPRPRT",CNT+4)="1. Name and Address of Vendor          2. Name and Address of VA Facility"
"RTN","RMPR9P21",25,0)
 S RMPRV=$P(R664(0),U,4),RMPRST=""
"RTN","RMPR9P21",26,0)
 I $D(^PRC(440,RMPRV,0)) S RMPRV=^PRC(440,RMPRV,0) D
"RTN","RMPR9P21",27,0)
 .S RMPRST=$P(RMPRV,U,7),RMPRPHON=$P(RMPRV,U,10)
"RTN","RMPR9P21",28,0)
 .S RMPRAD1=$P(RMPRV,U,2),RMPRAD2=$P(RMPRV,U,3)
"RTN","RMPR9P21",29,0)
 .S RMPRCITY=$P(RMPRV,U,6),RMPR90IP=$P(RMPRV,U,8)
"RTN","RMPR9P21",30,0)
 .S RMPRVACN=$P($G(^PRC(440,$P(R664(0),U,4),2)),U,1)
"RTN","RMPR9P21",31,0)
 I $D(^DIC(5,+RMPRST,0)) S RMPRST=$P(^(0),U,2)
"RTN","RMPR9P21",32,0)
 E  S RMPRST="NO STATE ON FILE"
"RTN","RMPR9P21",33,0)
 S SPACE="",LRMPRV=$L($E($P(RMPRV,U,1),1,30)),$P(SPACE," ",40-LRMPRV)=""
"RTN","RMPR9P21",34,0)
 S ^TMP($J,"RMPRPRT",CNT+5)="    "_$E($P(RMPRV,U,1),1,30)_SPACE_$E(RMPR("NAME"),1,28)_" ,("_$$STA^RMPRUTIL_"/"_$$ROU^RMPRUTIL(RMPRSITE)_")"
"RTN","RMPR9P21",35,0)
 S LRMPRCTY=$L(RMPRCITY),LRMPRST=$L(RMPRST),LRMPRAD1=$L($E(RMPRAD1,1,35))
"RTN","RMPR9P21",36,0)
 S SPACE="",$P(SPACE," ",40-LRMPRAD1)=""
"RTN","RMPR9P21",37,0)
 S ^TMP($J,"RMPRPRT",CNT+6)="    "_$E(RMPRAD1,1,35)_SPACE_$E(RMPR("ADD"),1,39)
"RTN","RMPR9P21",38,0)
 S SPACE="",LRMPRAD2=$L($E(RMPRAD2,1,35)),$P(SPACE," ",45-LRMPRAD1)=""
"RTN","RMPR9P21",39,0)
 I RMPRAD2'="" S ^TMP($J,"RMPRPRT",CNT+7)="    "_$E(RMPRAD2,1,35)_SPACE_RMPR("CITY")
"RTN","RMPR9P21",40,0)
 S SPACE="",$P(SPACE," ",33-LRMPRCTY-LRMPRST)=""
"RTN","RMPR9P21",41,0)
 I RMPRAD2="" S ^TMP($J,"RMPRPRT",CNT+7)="    "_RMPRCITY_","_RMPRST_" "_RMPR90IP_SPACE_RMPR("CITY")
"RTN","RMPR9P21",42,0)
 I RMPRAD2'="" S ^TMP($J,"RMPRPRT",CNT+8)="    "_RMPRCITY_","_RMPRST_" "_RMPR90IP
"RTN","RMPR9P21",43,0)
 S K="" F  S K=$O(^TMP($J,"RMPRPRT",K)) Q:K=""  S CNT=K
"RTN","RMPR9P21",44,0)
 S ^TMP($J,"RMPRPRT",CNT+1)="    "_RMPRPHON_"                          "_$P(^RMPR(669.9,RMPRSITE,0),U,4)
"RTN","RMPR9P21",45,0)
 S ^TMP($J,"RMPRPRT",CNT+2)=RMPRB
"RTN","RMPR9P21",46,0)
 S ^TMP($J,"RMPRPRT",CNT+3)="3. Veterans Name (Last, First, MI)     4. Date of Authorization"
"RTN","RMPR9P21",47,0)
 S SPACE="",VADM1=$L(VADM(1))
"RTN","RMPR9P21",48,0)
 S ^TMP($J,"RMPRPRT",CNT+4)="    "_VADM(1) S Y=$P(R664(0),U,1) D DD^%DT
"RTN","RMPR9P21",49,0)
 S SPACE="",$P(SPACE," ",40-VADM1)=""
"RTN","RMPR9P21",50,0)
 S ^TMP($J,"RMPRPRT",CNT+4)=^TMP($J,"RMPRPRT",CNT+4)_SPACE_Y
"RTN","RMPR9P21",51,0)
 I $D(RMPRMOR) S ^TMP($J,"RMPRPRT",CNT+5)=RMPRB D HDR1 Q
"RTN","RMPR9P21",52,0)
 S ^TMP($J,"RMPRPRT",CNT+5)=RMPRB S RMPRODTE=Y
"RTN","RMPR9P21",53,0)
 S RMPRDELD="" I $D(R664(3)),$P(R664(3),U,2)]"" S Y=$P(R664(3),U,2) D DD^%DT S RMPRDELD=Y
"RTN","RMPR9P21",54,0)
 S ^TMP($J,"RMPRPRT",CNT+6)="5. Veterans Address                    6. Date Required"
"RTN","RMPR9P21",55,0)
 S SPACE="",VAPA1=$L(VAPA(1)),$P(SPACE," ",40-VAPA1)=""
"RTN","RMPR9P21",56,0)
 S ^TMP($J,"RMPRPRT",CNT+7)="    "_VAPA(1)_SPACE_RMPRDELD
"RTN","RMPR9P21",57,0)
 S SPACE="",VAPA4=$L(VAPA(4)),VAPA5=$P($L(VAPA(5)),U,2),VAPA6=$L(VAPA(6)),$P(SPACE," ",27-VAPA4-VAPA5-VAPA6)=""
"RTN","RMPR9P21",58,0)
 I VAPA(2)="" S ^TMP($J,"RMPRPRT",CNT+8)="    "_VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6)_SPACE_$E(RMPRB,1,40)
"RTN","RMPR9P21",59,0)
 I VAPA(2)="" S ^TMP($J,"RMPRPRT",CNT+9)="                                        9. Authority For Issuance  CFR 17.115"
"RTN","RMPR9P21",60,0)
 S SPACE="",VAPA8=$L(VAPA(8)),$P(SPACE," ",40-VAPA8)=""
"RTN","RMPR9P21",61,0)
 I VAPA(2)="" S ^TMP($J,"RMPRPRT",CNT+10)="    "_VAPA(8)_SPACE_"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR9P21",62,0)
 S SPACE="",VAPA2=$L(VAPA(2)),$P(SPACE," ",31-VAPA2)=""
"RTN","RMPR9P21",63,0)
 I VAPA(2)'="" S ^TMP($J,"RMPRPRT",CNT+8)="    "_VAPA(2)_SPACE_$E(RMPRB,1,40)
"RTN","RMPR9P21",64,0)
 S SPACE="",$P(SPACE," ",30-VAPA4-VAPA5-VAPA6)=""
"RTN","RMPR9P21",65,0)
 I VAPA(2)'="" S ^TMP($J,"RMPRPRT",CNT+9)="    "_VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6)_SPACE_"9. Authority For Issuance  CFR 17.115"
"RTN","RMPR9P21",66,0)
 S SPACE="",$P(SPACE," ",40-VAPA8)=""
"RTN","RMPR9P21",67,0)
 I VAPA(2)'="" S ^TMP($J,"RMPRPRT",CNT+10)="    "_VAPA(8)_SPACE_"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR9P21",68,0)
 S ^TMP($J,"RMPRPRT",CNT+11)=RMPRB
"RTN","RMPR9P21",69,0)
 S ^TMP($J,"RMPRPRT",CNT+12)="7. Claim Number   "_VAEL(7)_"             8. ID #:"_" "_$P($P(VADM(2),U,2),"-",3)
"RTN","RMPR9P21",70,0)
 S ^TMP($J,"RMPRPRT",CNT+13)=RMPRB
"RTN","RMPR9P21",71,0)
 S ^TMP($J,"RMPRPRT",CNT+14)="10. Statistical Data         11. FOB Point    12. Discount    13. Delivery Time"
"RTN","RMPR9P21",72,0)
 S R664("E")=$O(R664(1,0)),CAT=$P(R664(1,R664("E"),0),U,10)
"RTN","RMPR9P21",73,0)
 S RMPRCAT=$S(CAT=1:"SC/OP",CAT=2:"SC/IP",CAT=3:"NSC/IP",CAT=4:"NSC/OP",1:"")
"RTN","RMPR9P21",74,0)
 S SPE=$P(R664(1,R664("E"),0),U,11)
"RTN","RMPR9P21",75,0)
 S RMPRSCAT=$S(SPE=1:"SPECIAL LEGISLATION",SPE=2:"A&A",SPE=3:"PHC",SPE=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPR9P21",76,0)
 S ^TMP($J,"RMPRPRT",CNT+15)="    "_RMPRCAT_" "_RMPRSCAT S:+$P(R664(0),U,10) RMPRFOB=$P(R664(0),U,10)
"RTN","RMPR9P21",77,0)
 S SPACE="",LRMPRCAT=$L(RMPRCAT),LRMPSCAT=$L(RMPRSCAT),$P(SPACE," ",29-LRMPRCAT-LRMPSCAT)=""
"RTN","RMPR9P21",78,0)
 S ^TMP($J,"RMPRPRT",CNT+15)=^TMP($J,"RMPRPRT",CNT+15)_SPACE_$S($D(RMPRFOB):"ORIGIN",1:"DEST ")_"              % "
"RTN","RMPR9P21",79,0)
 I $D(R664(2)) S ^TMP($J,"RMPRPRT",CNT+15)=^TMP($J,"RMPRPRT",CNT+15)_$P(R664(2),U,6)
"RTN","RMPR9P21",80,0)
 I $D(R664(3)) S ^TMP($J,"RMPRPRT",CNT+15)=^TMP($J,"RMPRPRT",CNT+15)_"             "_$P(R664(3),U,3)_" Days"
"RTN","RMPR9P21",81,0)
 S ^TMP($J,"RMPRPRT",CNT+16)=RMPRB
"RTN","RMPR9P21",82,0)
 S ^TMP($J,"RMPRPRT",CNT+17)="14. Delivery To: "
"RTN","RMPR9P21",83,0)
 S:$D(R664(3)) ^TMP($J,"RMPRPRT",CNT+17)=^TMP($J,"RMPRPRT",CNT+17)_$P(R664(3),U)
"RTN","RMPR9P21",84,0)
 S ^TMP($J,"RMPRPRT",CNT+18)="      Attention:  "_$P(R664(3),U,4)
"RTN","RMPR9P21",85,0)
 S ^TMP($J,"RMPRPRT",CNT+19)=RMPRB
"RTN","RMPR9P21",86,0)
HDR1 ;HEADER FOR 10-2421
"RTN","RMPR9P21",87,0)
 S K="" F  S K=$O(^TMP($J,"RMPRPRT",K)) Q:K=""  S CNT=K
"RTN","RMPR9P21",88,0)
 S ^TMP($J,"RMPRPRT",CNT+1)="                15. DESCRIPTION OF ITEMS OR SERVICES AUTHORIZED"
"RTN","RMPR9P21",89,0)
 S ^TMP($J,"RMPRPRT",CNT+2)=RMPRB
"RTN","RMPR9P21",90,0)
 S ^TMP($J,"RMPRPRT",CNT+3)="ITEM NUMBER           DESCRIPTION              QUANTITY  UNIT  UNIT     AMOUNT"
"RTN","RMPR9P21",91,0)
 S ^TMP($J,"RMPRPRT",CNT+4)="                                               ORDERED         PRICE"
"RTN","RMPR9P21",92,0)
 S ^TMP($J,"RMPRPRT",CNT+5)=RMPRB
"RTN","RMPR9P21",93,0)
 Q:$D(RMPRMOR)
"RTN","RMPR9P21",94,0)
 S K="" F  S K=$O(^TMP($J,"RMPRPRT",K)) Q:K=""  S CNT=K
"RTN","RMPR9P21",95,0)
 D ^RMPR9P22
"RTN","RMPR9P21",96,0)
 D:'$D(RMPRMOR1) CON^RMPR9P22
"RTN","RMPR9P21",97,0)
 M RESULTS=^TMP($J,"RMPRPRT")
"RTN","RMPR9P21",98,0)
EX ;Common Exit Point
"RTN","RMPR9P21",99,0)
 K VADM,CP,DFN,CAT,DIC,R664,RMPRA,RMPACT,RMPRAD1,RMPRAD2,RMPRAMT,RMPRAMT1,RMPRB,RMPRCAT,RMPRCH,RMPRCITY,RMPRDELD,RMPRI,RMPRI1,RMPRIT,RMPRN,RMPRODTE,RMPRST,RMPRPHON,RMPRT,RMPRTOT,RMPRUT,RMPRV,RMPR90IP,RO,RP,J1,RTN,RMPRMOR1,RMPRPRIV
"RTN","RMPR9P21",100,0)
 K SPE,VA,VAEL,VAPA,VAERR,RZZZ,RX,RX1,RDUZ,RC,RMPRACT,RMPRSCAT,RMPRDISC,RMPRAMTN,DIR,DIRUT,RMPRAMT2,RMPRFOB,RMPRDA,RMPRMOR,RMPRPAGE,RMPRPRIV,RMPRX,RMPR90,J,K,N D ^%ZISC Q
"RTN","RMPRN6PL")
0^5^B16252833^B16111637
"RTN","RMPRN6PL",1,0)
RMPRN6PL ;HINES/HNC -NPPD CALCULATIONS - SINGLE LINE; 02/14/98
"RTN","RMPRN6PL",2,0)
 ;;3.0;PROSTHETICS;**32,34,36,51,70,72,133**;Feb 09, 1996;Build 2
"RTN","RMPRN6PL",3,0)
 ;
"RTN","RMPRN6PL",4,0)
 ;DBIA # 801 - for this routine, the agreement covers the field
"RTN","RMPRN6PL",5,0)
 ;             #.05 Short Description, file #441.
"RTN","RMPRN6PL",6,0)
 ;
"RTN","RMPRN6PL",7,0)
 ;DBIA #10060 - Fileman read of file #200
"RTN","RMPRN6PL",8,0)
 Q
"RTN","RMPRN6PL",9,0)
HOLD ;hold screen
"RTN","RMPRN6PL",10,0)
 K DIR I IOST["C-" W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1
"RTN","RMPRN6PL",11,0)
 Q
"RTN","RMPRN6PL",12,0)
HDR W @IOF S PAGE=PAGE+1
"RTN","RMPRN6PL",13,0)
 W !,LN,!,CODE
"RTN","RMPRN6PL",14,0)
 W ?10,^TMP($J,"RMPRCODE",CODE)
"RTN","RMPRN6PL",15,0)
 W ?35,DATE(3)," - ",DATE(4)
"RTN","RMPRN6PL",16,0)
 W ?70,"Page: ",PAGE
"RTN","RMPRN6PL",17,0)
 W !,LN,!
"RTN","RMPRN6PL",18,0)
 I IOM<119 W "NAME",?10,"SSN",?16,"HCPCS",?22,"QTY",?27,"TYPE",?32,"COST",?42,"DATE",?48,"ITEM",?62,"HCPCS DES",?76,"WHO",!,LN
"RTN","RMPRN6PL",19,0)
 I IOM>119 W "NAME",?10,"SSN",?16,"HCPCS",?22,"QTY",?27,"TYPE",?32,"COST",?42,"DATE",?48,"ITEM",?80,"HCPCS DES",?112,"WHO",?117,"#",!,LN
"RTN","RMPRN6PL",20,0)
 Q
"RTN","RMPRN6PL",21,0)
DESP ;desplay detail records
"RTN","RMPRN6PL",22,0)
 S FL=""
"RTN","RMPRN6PL",23,0)
 ;code is user defined
"RTN","RMPRN6PL",24,0)
 ;F  S CODE=$O(^TMP($J,CODE)) Q:CODE="N"  G:FL=1 EXIT D
"RTN","RMPRN6PL",25,0)
 D HDR
"RTN","RMPRN6PL",26,0)
 S RDX=0
"RTN","RMPRN6PL",27,0)
 F  S RDX=$O(^TMP($J,CODE,RDX)) D:RDX'>0 HOLD Q:RDX'>0  Q:FL=1  D
"RTN","RMPRN6PL",28,0)
 .S DFN=$P(^RMPR(660,RDX,0),U,2) Q:DFN=""
"RTN","RMPRN6PL",29,0)
 .D DEM^VADPT
"RTN","RMPRN6PL",30,0)
 .I $Y+6>IOSL,IOST["C-" K DIR W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1 Q:+Y'>0  D HDR
"RTN","RMPRN6PL",31,0)
 .I $Y+6>IOSL,IOST'["C-" D HDR
"RTN","RMPRN6PL",32,0)
 .W !,$E($P(VADM(1),",",1),1,9)
"RTN","RMPRN6PL",33,0)
 .W ?10,$P(VADM(2),"-",3)
"RTN","RMPRN6PL",34,0)
 .S ITEM="",HCPCSD=""
"RTN","RMPRN6PL",35,0)
 .S TYPE=$P(^RMPR(660,RDX,0),U,4)
"RTN","RMPRN6PL",36,0)
 .S QTY=$P(^RMPR(660,RDX,0),U,7)
"RTN","RMPRN6PL",37,0)
 .S HCPCS=$P($G(^RMPR(660,RDX,1)),U,4)
"RTN","RMPRN6PL",38,0)
 .I HCPCS=""&($P(^RMPR(660,RDX,0),U,17)'="") S HCPCS=2676,ITEM="SHIPPING",HCPCSD="SHIPPING"
"RTN","RMPRN6PL",39,0)
 .I $P(^RMPR(660,RDX,0),U,26)'="" S ITEM="PICKUP/DEL"
"RTN","RMPRN6PL",40,0)
 .I HCPCSD="" S HCPCSD=$P($G(^RMPR(661.1,HCPCS,0)),U,2)
"RTN","RMPRN6PL",41,0)
 .S HCPCS=$P($G(^RMPR(661.1,HCPCS,0)),U,1)
"RTN","RMPRN6PL",42,0)
 .S WHO=$$GET1^DIQ(200,$P($G(^RMPR(660,RDX,0)),U,27),1)
"RTN","RMPRN6PL",43,0)
 .I $G(RDX) S OPEN=$P(^RMPR(660,RDX,0),U,12)
"RTN","RMPRN6PL",44,0)
 .I OPEN="" S OPEN="*"
"RTN","RMPRN6PL",45,0)
 .E  S OPEN=" "
"RTN","RMPRN6PL",46,0)
 .S COST=^TMP($J,CODE,RDX)
"RTN","RMPRN6PL",47,0)
 .S SOURCE=$P(^RMPR(660,RDX,0),U,14)
"RTN","RMPRN6PL",48,0)
 .S DATE=$P(^RMPR(660,RDX,0),U,1),DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)
"RTN","RMPRN6PL",49,0)
 .I ITEM="" S ITEM=$P($G(^PRC(441,+$P($G(^RMPR(661,+$P($G(^RMPR(660,RDX,0)),U,6),0)),U,1),0)),U,2)
"RTN","RMPRN6PL",50,0)
 .I IOM<119 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,11),?61,"|",?62,$E(HCPCSD,1,12),?76,WHO
"RTN","RMPRN6PL",51,0)
 .I IOM>118 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,29),?79,"|",?80,$E(HCPCSD,1,30),?112,WHO,?117,RDX
"RTN","RMPRN6PL",52,0)
 K ITEM,HCPCSD
"RTN","RMPRN6PL",53,0)
 Q
"RTN","RMPRN6PL",54,0)
DESPR ;repair dispaly
"RTN","RMPRN6PL",55,0)
 ;
"RTN","RMPRN6PL",56,0)
 ;S CODE="R1"
"RTN","RMPRN6PL",57,0)
 ;code is user defined
"RTN","RMPRN6PL",58,0)
 F  S CODE=$O(^TMP($J,CODE)) Q:CODE["RMPR"  Q:FL=1  D
"RTN","RMPRN6PL",59,0)
 .D HDR
"RTN","RMPRN6PL",60,0)
 .S RDX=0
"RTN","RMPRN6PL",61,0)
 .F  S RDX=$O(^TMP($J,CODE,RDX)) D:RDX'>0 HOLD Q:RDX'>0  Q:FL=1  D
"RTN","RMPRN6PL",62,0)
 ..S DFN=$P(^RMPR(660,RDX,0),U,2) Q:DFN=""
"RTN","RMPRN6PL",63,0)
 ..D DEM^VADPT
"RTN","RMPRN6PL",64,0)
 ..Q:FL=1
"RTN","RMPRN6PL",65,0)
 ..I $Y+6>IOSL,IOST["C-" K DIR W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1 Q:+Y'>0  D HDR
"RTN","RMPRN6PL",66,0)
 ..I $Y+6>IOSL,IOST'["C-" D HDR
"RTN","RMPRN6PL",67,0)
 ..W !,$E($P(VADM(1),",",1),1,9)
"RTN","RMPRN6PL",68,0)
 ..W ?10,$P(VADM(2),"-",3)
"RTN","RMPRN6PL",69,0)
 ..S TYPE=$P(^RMPR(660,RDX,0),U,4)
"RTN","RMPRN6PL",70,0)
 ..S QTY=$P(^RMPR(660,RDX,0),U,7)
"RTN","RMPRN6PL",71,0)
 ..I $P(^RMPR(660,RDX,0),U,17)'="" S HCPCS="#SHIP",ITEM="SHIPPING"
"RTN","RMPRN6PL",72,0)
 ..S:$G(HCPCS)'["#" HCPCS=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,1)
"RTN","RMPRN6PL",73,0)
 ..S:$G(HCPCS)'["#" HCPCSD=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,2)
"RTN","RMPRN6PL",74,0)
 ..I $G(HCPCS)["#" S HCPCSD="SHIPPING"
"RTN","RMPRN6PL",75,0)
 ..S WHO=$$GET1^DIQ(200,$P($G(^RMPR(660,RDX,0)),U,27),1)
"RTN","RMPRN6PL",76,0)
 ..S OPEN=""
"RTN","RMPRN6PL",77,0)
 ..I $G(RDZ) S OPEN=$P(^RMPR(660,RDZ,0),U,12)
"RTN","RMPRN6PL",78,0)
 ..I OPEN="" S OPEN="*"
"RTN","RMPRN6PL",79,0)
 ..E  S OPEN=" "
"RTN","RMPRN6PL",80,0)
 ..S COST=^TMP($J,CODE,RDX)
"RTN","RMPRN6PL",81,0)
 ..S SOURCE=$P(^RMPR(660,RDX,0),U,14)
"RTN","RMPRN6PL",82,0)
 ..S DATE=$P(^RMPR(660,RDX,0),U,1),DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)
"RTN","RMPRN6PL",83,0)
 ..S:$G(ITEM)'["SHIPPING" ITEM=$P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RDX,0),U,6),0),U,1),0),U,2)
"RTN","RMPRN6PL",84,0)
 ..I IOM<119 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,12),?62,$E(HCPCSD,1,12),?76,WHO
"RTN","RMPRN6PL",85,0)
 ..I IOM>118 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,29),?79,"|",?80,$E(HCPCSD,1,30),?112,WHO,?117,RDX
"RTN","RMPRN6PL",86,0)
 Q
"RTN","RMPRN6PL",87,0)
EXIT ;
"RTN","RMPRN6PL",88,0)
 Q
"RTN","RMPRN6PL",89,0)
 ;END
"RTN","RMPRP21")
0^6^B32044208^B30821456
"RTN","RMPRP21",1,0)
RMPRP21 ;PHX/RFM-PRINT 10-2421 ;8/29/1994
"RTN","RMPRP21",2,0)
 ;;3.0;PROSTHETICS;**3,19,55,90,129,133**;Feb 09, 1996;Build 2
"RTN","RMPRP21",3,0)
 ;
"RTN","RMPRP21",4,0)
 ; ODJ - patch 55 - 1/29/01 - extrinsic to get mail routing code
"RTN","RMPRP21",5,0)
 ;                            from site param. replaces hard code 121
"RTN","RMPRP21",6,0)
 ;                            nois AUG-1097-32118
"RTN","RMPRP21",7,0)
 ;
"RTN","RMPRP21",8,0)
 I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRP21",9,0)
 I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1) S %ZIS="MQ" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPRP21",10,0)
 I $D(RMPRA)&('$P(^RMPR(669.9,RMPRSITE,0),U,5)) G ZIS
"RTN","RMPRP21",11,0)
EN ;ENTRY POINT FOR REPRINTING A 10-2421 FORM
"RTN","RMPRP21",12,0)
 I '$D(RMPR) D DIV4^RMPRSIT G:$D(X) EX
"RTN","RMPRP21",13,0)
 S RMPRACT=1,DIC="^RMPR(664,",DIC(0)="AEQM",DIC("A")="Select Transaction or Patient Name: ",RMPRF=2
"RTN","RMPRP21",14,0)
 S DIC("S")="I $D(^RMPR(664,Y,1)) S RZZZ=$O(^RMPR(664,Y,1,0)) I RZZZ S RX=$P(^(RZZZ,0),U,13) S:$D(^RMPR(660,+RX,0)) RX=$P(^(0),U,13) I RX=2,'$D(^RMPR(664,""AP"",RMPR(""STA""),Y))"
"RTN","RMPRP21",15,0)
 S DIC("W")="D EN2^RMPRD1" D ^DIC G:Y<0 EX S RMPRA=+Y I $P(^RMPR(664,+Y,0),U,5) D M2^RMPRM
"RTN","RMPRP21",16,0)
 D PR^RMPR21A I %'>0 G EX
"RTN","RMPRP21",17,0)
 ;I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1),%ZIS="Q" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPRP21",18,0)
ZIS S %ZIS="QM" D ^%ZIS G:POP EX
"RTN","RMPRP21",19,0)
 I '$D(IO("Q")) U IO G PRT
"RTN","RMPRP21",20,0)
 S ZTIO=ION
"RTN","RMPRP21",21,0)
PT S ZTDTH=$H,ZTSAVE("RMPRPN")="",ZTSAVE("RMPRA")="",ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")="",ZTRTN="PRT^RMPRP21",ZTDESC="2421 FORM"
"RTN","RMPRP21",22,0)
  S:$D(RMPRPRIV) ZTSAVE("RMPRPRIV")="" D ^%ZTLOAD W !,$S($D(ZTSK):"<REQUEST QUEUED>",1:"<REQUEST NOT QUEUED>") D HOME^%ZIS H 3 G EX
"RTN","RMPRP21",23,0)
PRT ;ENTRY POINT TO PRINT 2421S
"RTN","RMPRP21",24,0)
 S %X="^RMPR(664,RMPRA,",%Y="R664(" D %XY^%RCR K %X,%Y
"RTN","RMPRP21",25,0)
 S RDUZ=$P(R664(0),U,9),RDUZ=$P(^VA(200,RDUZ,0),U,1),DFN=$P(R664(0),U,2),RTN=$P(R664(0),U,7),CP=$P(R664(0),U,6),CP=$P(^PRCS(410,CP,0),U,1),RMPRPAGE=2
"RTN","RMPRP21",26,0)
 D ADD^VADPT,DEM^VADPT,ELIG^VADPT
"RTN","RMPRP21",27,0)
 W:$Y>0 @IOF W ?20,"OMB Number 2900-0188",?50,"PO#: "
"RTN","RMPRP21",28,0)
 W !,"By receiving this purchase order you agree to take appropriate measures to"
"RTN","RMPRP21",29,0)
 W !,"secure the information and ensure the confidentiality of the patient information"
"RTN","RMPRP21",30,0)
 W !,"is maintained. ORIGINAL PO AND INVOICE MUST BE SUBMITTED TO THE VAMC BELOW"
"RTN","RMPRP21",31,0)
HDR ;PRINT HEADER FOR 2421 ADDRESS INFO
"RTN","RMPRP21",32,0)
 I $P($G(R664(4)),U,8) W !,?30,"***WORKING COPY***"
"RTN","RMPRP21",33,0)
 S (RMPRT,RMPRB)="",$P(RMPRT,"_",IOM)="",$P(RMPRB,"-",IOM)="" W !,RMPRT,!,"Department of Veterans Affairs"_"|"_"Prosthetic Authorization for Items or Services",!,RMPRB
"RTN","RMPRP21",34,0)
 W !,"1. Name and Address of Vendor",?40,"2. Name and Address of VA Facility"
"RTN","RMPRP21",35,0)
 S RMPRV=$P(R664(0),U,4),RMPRST=""
"RTN","RMPRP21",36,0)
 I $D(^PRC(440,RMPRV,0)) S RMPRV=^PRC(440,RMPRV,0) D
"RTN","RMPRP21",37,0)
 .S RMPRST=$P(RMPRV,U,7),RMPRPHON=$P(RMPRV,U,10)
"RTN","RMPRP21",38,0)
 .S RMPRAD1=$P(RMPRV,U,2),RMPRAD2=$P(RMPRV,U,3)
"RTN","RMPRP21",39,0)
 .S RMPRCITY=$P(RMPRV,U,6),RMPR90IP=$P(RMPRV,U,8)
"RTN","RMPRP21",40,0)
 .S RMPRVACN=$P($G(^PRC(440,$P(R664(0),U,4),2)),U,1)
"RTN","RMPRP21",41,0)
 I $D(^DIC(5,+RMPRST,0)) S RMPRST=$P(^(0),U,2)
"RTN","RMPRP21",42,0)
 E  S RMPRST="NO STATE ON FILE"
"RTN","RMPRP21",43,0)
 W !,?5,$E($P(RMPRV,U,1),1,30),?40
"RTN","RMPRP21",44,0)
 W $E(RMPR("NAME"),1,28)," ","(",$$STA^RMPRUTIL,"/",$$ROU^RMPRUTIL(RMPRSITE),")"
"RTN","RMPRP21",45,0)
 W !,?5,$E(RMPRAD1,1,35),?40,$E(RMPR("ADD"),1,39)
"RTN","RMPRP21",46,0)
 I RMPRAD2'="" W !,?5,$E(RMPRAD2,1,35),?40,RMPR("CITY")
"RTN","RMPRP21",47,0)
 I RMPRAD2="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP,?40,RMPR("CITY")
"RTN","RMPRP21",48,0)
 I RMPRAD2'="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP
"RTN","RMPRP21",49,0)
 W !,?5,RMPRPHON
"RTN","RMPRP21",50,0)
 ;W:$G(RMPRVACN)'="" ?22,"ACCT # ",RMPRVACN
"RTN","RMPRP21",51,0)
 W ?40,$P(^RMPR(669.9,RMPRSITE,0),U,4),!,RMPRB
"RTN","RMPRP21",52,0)
 W !,"3. Veterans Name (Last, First, MI)",?40,"4. Date of Authorization"
"RTN","RMPRP21",53,0)
 W !,?5,VADM(1) S Y=$P(R664(0),U,1) D DD^%DT W ?45,Y
"RTN","RMPRP21",54,0)
 I $D(RMPRMOR) W !,RMPRB D HDR1 Q
"RTN","RMPRP21",55,0)
 W !,RMPRB S RMPRODTE=Y
"RTN","RMPRP21",56,0)
 S RMPRDELD="" I $D(R664(3)),$P(R664(3),U,2)]"" S Y=$P(R664(3),U,2) D DD^%DT S RMPRDELD=Y
"RTN","RMPRP21",57,0)
 W !,"5. Veterans Address",?40,"6. Date Required",!,?5,VAPA(1),?45,RMPRDELD,!
"RTN","RMPRP21",58,0)
 I VAPA(2)="" W ?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,$E(RMPRB,1,40),!,?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPRP21",59,0)
 I VAPA(2)'="" W ?5,VAPA(2),?40,$E(RMPRB,1,40),!,?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPRP21",60,0)
 W !,RMPRB
"RTN","RMPRP21",61,0)
 W !,"7. Claim Number"_" "_VAEL(7),?40,"8. SSN"_" "_$P($P(VADM(2),U,2),"-",3),!,RMPRB,!,"10. Statistical Data",?30,"11. FOB Point",?46,"12. Discount",?61,"13. Delivery Time"
"RTN","RMPRP21",62,0)
 S R664("E")=$O(R664(1,0)),CAT=$P(R664(1,R664("E"),0),U,10)
"RTN","RMPRP21",63,0)
 S RMPRCAT=$S(CAT=1:"SC/OP",CAT=2:"SC/IP",CAT=3:"NSC/IP",CAT=4:"NSC/OP",1:"") S SPE=$P(R664(1,R664("E"),0),U,11)
"RTN","RMPRP21",64,0)
 S RMPRSCAT=$S(SPE=1:"SPECIAL LEGISLATION",SPE=2:"A&A",SPE=3:"PHC",SPE=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRP21",65,0)
 W !,RMPRCAT_" "_RMPRSCAT S:+$P(R664(0),U,10) RMPRFOB=$P(R664(0),U,10) W ?34,$S($D(RMPRFOB):"ORIGIN",1:"DEST"),?49,"% " I $D(R664(2)) W $P(R664(2),U,6)
"RTN","RMPRP21",66,0)
 I $D(R664(3)) W ?66,$P(R664(3),U,3)_" Days"
"RTN","RMPRP21",67,0)
 W !,?30,$E(RMPRB,1,50),!,?30,"14. Delivery To: " W:$D(R664(3)) $P(R664(3),U) W !,RMPRB
"RTN","RMPRP21",68,0)
HDR1 ;HEADER FOR 10-2421
"RTN","RMPRP21",69,0)
 W !?17,"15. DESCRIPTION OF ITEMS OR SERVICES AUTHORIZED",!,RMPRB,!,"ITEM NUMBER",?23,"DESCRIPTION/NOMENCLATURE",?50,"QUANTITY",?60,"UNIT",?66,"UNIT",?73,"AMOUNT",!,?50,"ORDERED",?66,"PRICE",!,RMPRB Q:$D(RMPRMOR)
"RTN","RMPRP21",70,0)
 D ^RMPRP22 D:'$D(RMPRMOR1) CON^RMPRP22
"RTN","RMPRP21",71,0)
 S RMPRK=RMPRA
"RTN","RMPRP21",72,0)
 D:$D(RMPRPRIV) ^RMPRP23
"RTN","RMPRP21",73,0)
 W:$G(RMPRPN)=1 @IOF,$$EN^RMPRP24(RMPRK)
"RTN","RMPRP21",74,0)
EX ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPRP21",75,0)
 K VADM,CP,DFN,CAT,DIC,R664,RMPRA,RMPACT,RMPRAD1,RMPRAD2,RMPRAMT,RMPRAMT1,RMPRB,RMPRCAT,RMPRCH,RMPRCITY,RMPRDELD,RMPRI,RMPRI1,RMPRIT,RMPRN,RMPRODTE,RMPRST,RMPRPHON,RMPRT,RMPRTOT,RMPRUT,RMPRV,RMPR90IP,RO,RP,J1,RTN,RMPRMOR1,RMPRPRIV
"RTN","RMPRP21",76,0)
 K SPE,VA,VAEL,VAPA,VAERR,RZZZ,RX,RX1,RDUZ,RC,RMPRACT,RMPRSCAT,RMPRDISC,RMPRAMTN,DIR,DIRUT,RMPRAMT2,RMPRFOB,RMPRDA,RMPRMOR,RMPRPAGE,RMPRPRIV,RMPRX,RMPR90,J,K,N D ^%ZISC Q
"RTN","RMPRPCEA")
0^3^B53901671^B53474069
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82,78,114,120,128,131,133**;Feb 09, 1996;Build 2
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ; RMS  10/1/03 Patch 78 - Change Service connected, and environmental
"RTN","RMPRPCEA",5,0)
 ;                         indicators (Agent Orange, Ionizing Radiation,
"RTN","RMPRPCEA",6,0)
 ;                         Environmental Contaminants, Military Sexual
"RTN","RMPRPCEA",7,0)
 ;                         Trauma, Head/Neck Cancer, and Combat Veteran
"RTN","RMPRPCEA",8,0)
 ;                         Status) to come from new BA fields if they
"RTN","RMPRPCEA",9,0)
 ;                         exist.
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",12,0)
 ;
"RTN","RMPRPCEA",13,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",14,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",15,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",16,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",17,0)
 ;
"RTN","RMPRPCEA",18,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",19,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",20,0)
 ; D NEWVAR subroutine removed for functionality  01/31/05  WLC
"RTN","RMPRPCEA",21,0)
 ;
"RTN","RMPRPCEA",22,0)
 N RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",23,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",24,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN,RMSCON
"RTN","RMPRPCEA",25,0)
 N RMMST,RMHNC,RMCBV,RMPRTPCE,STOP
"RTN","RMPRPCEA",26,0)
 ; PATCH 78, RMS - 10/1/2003, Billing aware related variables
"RTN","RMPRPCEA",27,0)
 N RMBASCON,RMBAAO,RMBAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV,RMBAICD9,RMLOOP
"RTN","RMPRPCEA",28,0)
 N RMPROV,RMCPDT,DXERR,SICD
"RTN","RMPRPCEA",29,0)
 ;
"RTN","RMPRPCEA",30,0)
 S RMERR=1
"RTN","RMPRPCEA",31,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",32,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",33,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",34,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",35,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",36,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",37,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",38,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",39,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",40,0)
 .S RMERR=-2
"RTN","RMPRPCEA",41,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",42,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",43,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",44,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01),SPACES=""
"RTN","RMPRPCEA",45,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",46,0)
 .F I=1:1:42-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",47,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",48,0)
 .I $G(RMSTA),$D(^DIC(4,RMSTA,99)) S RMSTAW=$P(^DIC(4,RMSTA,99),U)
"RTN","RMPRPCEA",49,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTAW)
"RTN","RMPRPCEA",50,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",51,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",52,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",53,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTAW
"RTN","RMPRPCEA",54,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",55,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",56,0)
 ; initialize temp file.
"RTN","RMPRPCEA",57,0)
 K ^TMP("RMPRPCE1",$J),RMSTAW
"RTN","RMPRPCEA",58,0)
 ;
"RTN","RMPRPCEA",59,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",60,0)
 D GETDATA G:$G(DXERR) SENDPCEX   ;quit if inactive diagnosis RMPR*120
"RTN","RMPRPCEA",61,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",62,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",63,0)
 ;
"RTN","RMPRPCEA",64,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",65,0)
 D BUILD
"RTN","RMPRPCEA",66,0)
 ;
"RTN","RMPRPCEA",67,0)
 ; now send
"RTN","RMPRPCEA",68,0)
 D SENDIT
"RTN","RMPRPCEA",69,0)
 ;
"RTN","RMPRPCEA",70,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",71,0)
 ;
"RTN","RMPRPCEA",72,0)
 ; clear the temp file
"RTN","RMPRPCEA",73,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",74,0)
 ;
"RTN","RMPRPCEA",75,0)
 ; return
"RTN","RMPRPCEA",76,0)
 Q RMERR
"RTN","RMPRPCEA",77,0)
 ;
"RTN","RMPRPCEA",78,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",79,0)
 K RMDA,RMDA2
"RTN","RMPRPCEA",80,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",81,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",82,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",83,0)
 D NOW^%DTC
"RTN","RMPRPCEA",84,0)
 S RMDANOW=%
"RTN","RMPRPCEA",85,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",86,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",87,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",88,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",89,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",90,0)
 S RMSCON=0
"RTN","RMPRPCEA",91,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",92,0)
 ;==============================
"RTN","RMPRPCEA",93,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",94,0)
 S RMETYP="P"
"RTN","RMPRPCEA",95,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",96,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",97,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",98,0)
 S RMPROV=@RMDA2@(8.6,"I")
"RTN","RMPRPCEA",99,0)
 S RMCPDT=@RMDA2@(8.4,"I")
"RTN","RMPRPCEA",100,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",101,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",102,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",103,0)
 ; PATCH 78, RMS - 10/1/2003, billing aware related variables
"RTN","RMPRPCEA",104,0)
 K RMBAICD9,RMBAAO,RMBASCON,RMBAAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV
"RTN","RMPRPCEA",105,0)
 I '$D(^RMPR(660,RMIE60,"BA1")) G GTDT  ; no BA data, skip retrieval
"RTN","RMPRPCEA",106,0)
 F RMLOOP=30:1:33 D
"RTN","RMPRPCEA",107,0)
 . N RMBAREC S RMBAREC=RMLOOP-29
"RTN","RMPRPCEA",108,0)
 . S RMBAICD9(RMBAREC)=@RMDA2@(RMLOOP,"I"),SICD=RMBAICD9(RMBAREC) I SICD'="" S:$P($G(^ICD9(SICD,0)),U,9) DXERR=1
"RTN","RMPRPCEA",109,0)
 . S RMBAAO(RMBAREC)=@RMDA2@((RMLOOP+.1),"I")
"RTN","RMPRPCEA",110,0)
 . S RMBAIR(RMBAREC)=@RMDA2@((RMLOOP+.2),"I")
"RTN","RMPRPCEA",111,0)
 . S RMBASCON(RMBAREC)=@RMDA2@((RMLOOP+.3),"I")
"RTN","RMPRPCEA",112,0)
 . S RMBAEC(RMBAREC)=@RMDA2@((RMLOOP+.4),"I")
"RTN","RMPRPCEA",113,0)
 . S RMBAMST(RMBAREC)=@RMDA2@((RMLOOP+.5),"I")
"RTN","RMPRPCEA",114,0)
 . S RMBAHNC(RMBAREC)=@RMDA2@((RMLOOP+.6),"I")
"RTN","RMPRPCEA",115,0)
 . S RMBACBV(RMBAREC)=@RMDA2@((RMLOOP+.7),"I")
"RTN","RMPRPCEA",116,0)
 ; Retrieve order number
"RTN","RMPRPCEA",117,0)
GTDT S RMPTR123=@RMDA2@(8.9,"I")
"RTN","RMPRPCEA",118,0)
 S RMODENT=$$GET1^DIQ(123,RMPTR123_",",.03)
"RTN","RMPRPCEA",119,0)
 ;get Date of Death.
"RTN","RMPRPCEA",120,0)
 D DEM^VADPT
"RTN","RMPRPCEA",121,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",122,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",123,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",124,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",125,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",126,0)
 ;
"RTN","RMPRPCEA",127,0)
 S RMMST="",RMCBV="",RMHNC=""
"RTN","RMPRPCEA",128,0)
 Q
"RTN","RMPRPCEA",129,0)
 ;
"RTN","RMPRPCEA",130,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",131,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI"),RMAPI
"RTN","RMPRPCEA",132,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",133,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",134,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",135,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",136,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",137,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",138,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",139,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",140,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",141,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",142,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",143,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",144,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",145,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",146,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",147,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",148,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",149,0)
 ; ------------Military Sexual Trauma----------
"RTN","RMPRPCEA",150,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=RMMST
"RTN","RMPRPCEA",151,0)
 ; -------------Head/Neck Cancer---------------
"RTN","RMPRPCEA",152,0)
 S @RMAPI@("ENCOUNTER",1,"HNC")=RMHNC
"RTN","RMPRPCEA",153,0)
 ; --------------Combat Veteran---------
"RTN","RMPRPCEA",154,0)
 S @RMAPI@("ENCOUNTER",1,"CV")=RMCBV
"RTN","RMPRPCEA",155,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",156,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",157,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",158,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",159,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",160,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",161,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",162,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",163,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",164,0)
 ; -------------- procedures -----------------
"RTN","RMPRPCEA",165,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",166,0)
 ; ---------------- Quantity -----------------
"RTN","RMPRPCEA",167,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",168,0)
 ; -------------- Procedures -----------------
"RTN","RMPRPCEA",169,0)
 I ($D(RMBAICD9(1))&($P($G(RMBAICD9(1)),U)=""))!('$D(RMBAICD9(1))) D  Q
"RTN","RMPRPCEA",170,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",171,0)
 ;
"RTN","RMPRPCEA",172,0)
 F RMLOOP=1:1:99 Q:$G(RMBAICD9(RMLOOP))=""  D
"RTN","RMPRPCEA",173,0)
 . S @RMAPI@("DX/PL",RMLOOP,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",174,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL AO")=$G(RMBAAO(RMLOOP))
"RTN","RMPRPCEA",175,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL IR")=$G(RMBAIR(RMLOOP))
"RTN","RMPRPCEA",176,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL SC")=$G(RMBASCON(RMLOOP))
"RTN","RMPRPCEA",177,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL EC")=$G(RMBAEC(RMLOOP))
"RTN","RMPRPCEA",178,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL MST")=$G(RMBAMST(RMLOOP))
"RTN","RMPRPCEA",179,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL HNC")=$G(RMBAHNC(RMLOOP))
"RTN","RMPRPCEA",180,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL CV")=$G(RMBACBV(RMLOOP))
"RTN","RMPRPCEA",181,0)
 . I RMLOOP=1 D  Q
"RTN","RMPRPCEA",182,0)
 . . S @RMAPI@("DX/PL",RMLOOP,"PRIMARY")=RMLOOP
"RTN","RMPRPCEA",183,0)
 . . S RMDIAG=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",184,0)
 . . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",185,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS "_RMLOOP)=$G(RMBAICD9(RMLOOP))  ; only one procedure per send
"RTN","RMPRPCEA",186,0)
 ;
"RTN","RMPRPCEA",187,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",188,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",189,0)
 S @RMAPI@("PROCEDURE",1,"ORD PROVIDER")=RMPROV
"RTN","RMPRPCEA",190,0)
 S @RMAPI@("PROCEDURE",1,"EVENT D/T")=RMCPDT
"RTN","RMPRPCEA",191,0)
 ; ------------- Order Reference -------------
"RTN","RMPRPCEA",192,0)
 S @RMAPI@("PROCEDURE",1,"ORD REFERENCE")=RMODENT
"RTN","RMPRPCEA",193,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",194,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",195,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",196,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",197,0)
 Q
"RTN","RMPRPCEA",198,0)
 ;
"RTN","RMPRPCEA",199,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",200,0)
 K RMPROB,RMPRTPCE,RMPCE
"RTN","RMPRPCEA",201,0)
 S (RMPRCPER,RMPROB,STOP)=0
"RTN","RMPRPCEA",202,0)
 D PRV^RMPRPCED
"RTN","RMPRPCEA",203,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",204,0)
 I RMERR'<1 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",205,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",206,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",207,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",208,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",209,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",210,0)
 I $G(RMPCE),$G(RMPRCPER) S RMPRTPCE=RJ_"^"_RMHLOC,RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",211,0)
 ;
"RTN","RMPRPCEA",212,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",213,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",214,0)
 K RMUPD
"RTN","RMPRPCEA",215,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",216,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",217,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",218,0)
 Q
"RTN","RMPRPCEA",219,0)
 ;
"RTN","RMPRPCEB")
0^4^B21783607^B21611450
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ; 1/23/04 8:09am
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,82,78,114,120,133**;Feb 09, 1996;Build 2
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 ;KAM Patch #82 06/21/2004 - Add more robust text to 'Missing
"RTN","RMPRPCEB",9,0)
 ;                           Prosthetics Clinic PCE error message
"RTN","RMPRPCEB",10,0)
 ;
"RTN","RMPRPCEB",11,0)
 ;WLC Patch #78 02/03/3005 - added NEW statement for error message
"RTN","RMPRPCEB",12,0)
 ;                           variables defined for Patch 82.
"RTN","RMPRPCEB",13,0)
 ;
"RTN","RMPRPCEB",14,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",15,0)
 Q
"RTN","RMPRPCEB",16,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",17,0)
 N RERRMSG,RERRMSG2  ; correction for patch 82  02/03/05 WLC
"RTN","RMPRPCEB",18,0)
 S IO=0,RMAIL=1,SVDUZ=DUZ,DUZ=.5
"RTN","RMPRPCEB",19,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",20,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",21,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",22,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",23,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",24,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",25,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",26,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))-1     ;starts at proper ien RMPR*120
"RTN","RMPRPCEB",27,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",28,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",29,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",30,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",31,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",32,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",33,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",34,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",35,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",36,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",37,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",38,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",39,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",40,0)
 .S RMICD9=$P(RM610,U,8) I RMICD9'="" Q:$P($G(^ICD9(RMICD9,0)),U,9)  ;quit if DX code inactive RMPR*120
"RTN","RMPRPCEB",41,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",42,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",43,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",44,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",45,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",46,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",47,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",48,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",49,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",50,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",51,0)
 ;
"RTN","RMPRPCEB",52,0)
 D PROC
"RTN","RMPRPCEB",53,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",54,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",55,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",56,0)
 G EXIT
"RTN","RMPRPCEB",57,0)
 ;
"RTN","RMPRPCEB",58,0)
PCEFLG ;
"RTN","RMPRPCEB",59,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",60,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",61,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",62,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",63,0)
 Q
"RTN","RMPRPCEB",64,0)
 ;
"RTN","RMPRPCEB",65,0)
PROC ;process
"RTN","RMPRPCEB",66,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",67,0)
 .;call PCE Interface
"RTN","RMPRPCEB",68,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",69,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",70,0)
 . I RMC<1 D
"RTN","RMPRPCEB",71,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",72,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",73,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",74,0)
 ..;Added next line for RMPR*3*82
"RTN","RMPRPCEB",75,0)
 ..I '$G(RMLOC) S ^TMP($J,"RMPRERR",RK)=^TMP($J,"RMPRERR",RK)_$G(RERRMSG)_$G(RERRMSG2)
"RTN","RMPRPCEB",76,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",77,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",78,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",79,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",80,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,999)
"RTN","RMPRPCEB",81,0)
 .....K RMPROB($J,R1,"ERROR1",R2,R3,R4)
"RTN","RMPRPCEB",82,0)
 K RMPROB
"RTN","RMPRPCEB",83,0)
 Q
"RTN","RMPRPCEB",84,0)
 ;
"RTN","RMPRPCEB",85,0)
MES1 ;
"RTN","RMPRPCEB",86,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",87,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",88,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",89,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",90,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",91,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",92,0)
 Q
"RTN","RMPRPCEB",93,0)
MES2 ;
"RTN","RMPRPCEB",94,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",95,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",96,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",97,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",98,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",99,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",100,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",101,0)
 D ^XMD
"RTN","RMPRPCEB",102,0)
 D NOW^%DTC
"RTN","RMPRPCEB",103,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",104,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",105,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",106,0)
 Q
"RTN","RMPRPCEB",107,0)
 ;
"RTN","RMPRPCEB",108,0)
BUILD ;
"RTN","RMPRPCEB",109,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",110,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",111,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",112,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",113,0)
 Q
"RTN","RMPRPCEB",114,0)
 ;
"RTN","RMPRPCEB",115,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",116,0)
 K ^TMP($J)
"RTN","RMPRPCEB",117,0)
 S DUZ=SVDUZ
"RTN","RMPRPCEB",118,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",119,0)
 Q
"VER")
8.0^22.0
"BLD",6461,6)
^114
**END**
**END**
