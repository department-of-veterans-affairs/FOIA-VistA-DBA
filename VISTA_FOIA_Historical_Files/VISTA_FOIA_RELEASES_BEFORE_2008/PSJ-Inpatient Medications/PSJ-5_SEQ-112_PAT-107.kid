Released PSJ*5*107 SEQ #112
Extracted from mail message
**KIDS**:PSJ*5.0*107^

**INSTALL NAME**
PSJ*5.0*107
"BLD",4827,0)
PSJ*5.0*107^INPATIENT MEDICATIONS^0^3040414^y
"BLD",4827,1,0)
^^14^14^3040331^^
"BLD",4827,1,1,0)
1. Joint Commission for Accreditation of Healthcare Organizations (JCAHO)
"BLD",4827,1,2,0)
requires that patients' use of Over-The-Counter (OTC) medications, Herbal
"BLD",4827,1,3,0)
supplements, medications prescribed by Veterans Health Administration 
"BLD",4827,1,4,0)
(VHA) but purchased by the patient at an outside pharmacy, and medications
"BLD",4827,1,5,0)
prescribed by providers outside VHA be documented in patients' medical
"BLD",4827,1,6,0)
records. These four categories of medications will hereafter be referred
"BLD",4827,1,7,0)
to as Non-VA Meds. This patch makes the changes necessary to Inpatient 
"BLD",4827,1,8,0)
Medications V. 5.0 to support Non-VA Meds.
"BLD",4827,1,9,0)
 
"BLD",4827,1,10,0)
2. To accommodate Billing Awareness, it was necessary to modify the 
"BLD",4827,1,11,0)
communication between CPRS and Outpatient Pharmacy V. 7.0 to include 
"BLD",4827,1,12,0)
new diagnosis codes. Inpatient Medications V. 5.0 routes all pharmacy
"BLD",4827,1,13,0)
orders to the appropriate package. This patch makes the changes necessary 
"BLD",4827,1,14,0)
to pass the new diagnosis codes to the appropriate package.
"BLD",4827,4,0)
^9.64PA^^
"BLD",4827,"ABPKG")
n
"BLD",4827,"KRN",0)
^9.67PA^8989.52^19
"BLD",4827,"KRN",.4,0)
.4
"BLD",4827,"KRN",.401,0)
.401
"BLD",4827,"KRN",.402,0)
.402
"BLD",4827,"KRN",.403,0)
.403
"BLD",4827,"KRN",.5,0)
.5
"BLD",4827,"KRN",.84,0)
.84
"BLD",4827,"KRN",3.6,0)
3.6
"BLD",4827,"KRN",3.8,0)
3.8
"BLD",4827,"KRN",9.2,0)
9.2
"BLD",4827,"KRN",9.8,0)
9.8
"BLD",4827,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4827,"KRN",9.8,"NM",1,0)
PSJHL4^^0^B32306771
"BLD",4827,"KRN",9.8,"NM",2,0)
PSJLMUT1^^0^B63891691
"BLD",4827,"KRN",9.8,"NM",3,0)
PSJORUT2^^0^B45776268
"BLD",4827,"KRN",9.8,"NM","B","PSJHL4",1)

"BLD",4827,"KRN",9.8,"NM","B","PSJLMUT1",2)

"BLD",4827,"KRN",9.8,"NM","B","PSJORUT2",3)

"BLD",4827,"KRN",19,0)
19
"BLD",4827,"KRN",19.1,0)
19.1
"BLD",4827,"KRN",101,0)
101
"BLD",4827,"KRN",409.61,0)
409.61
"BLD",4827,"KRN",771,0)
771
"BLD",4827,"KRN",870,0)
870
"BLD",4827,"KRN",8989.51,0)
8989.51
"BLD",4827,"KRN",8989.52,0)
8989.52
"BLD",4827,"KRN",8994,0)
8994
"BLD",4827,"KRN","B",.4,.4)

"BLD",4827,"KRN","B",.401,.401)

"BLD",4827,"KRN","B",.402,.402)

"BLD",4827,"KRN","B",.403,.403)

"BLD",4827,"KRN","B",.5,.5)

"BLD",4827,"KRN","B",.84,.84)

"BLD",4827,"KRN","B",3.6,3.6)

"BLD",4827,"KRN","B",3.8,3.8)

"BLD",4827,"KRN","B",9.2,9.2)

"BLD",4827,"KRN","B",9.8,9.8)

"BLD",4827,"KRN","B",19,19)

"BLD",4827,"KRN","B",19.1,19.1)

"BLD",4827,"KRN","B",101,101)

"BLD",4827,"KRN","B",409.61,409.61)

"BLD",4827,"KRN","B",771,771)

"BLD",4827,"KRN","B",870,870)

"BLD",4827,"KRN","B",8989.51,8989.51)

"BLD",4827,"KRN","B",8989.52,8989.52)

"BLD",4827,"KRN","B",8994,8994)

"BLD",4827,"QUES",0)
^9.62^^
"BLD",4827,"REQB",0)
^9.611^1^1
"BLD",4827,"REQB",1,0)
PSJ*5.0*105^2
"BLD",4827,"REQB","B","PSJ*5.0*105",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
107^3040414^10000000020
"PKG",197,22,1,"PAH",1,1,0)
^^14^14^3040414
"PKG",197,22,1,"PAH",1,1,1,0)
1. Joint Commission for Accreditation of Healthcare Organizations (JCAHO)
"PKG",197,22,1,"PAH",1,1,2,0)
requires that patients' use of Over-The-Counter (OTC) medications, Herbal
"PKG",197,22,1,"PAH",1,1,3,0)
supplements, medications prescribed by Veterans Health Administration 
"PKG",197,22,1,"PAH",1,1,4,0)
(VHA) but purchased by the patient at an outside pharmacy, and medications
"PKG",197,22,1,"PAH",1,1,5,0)
prescribed by providers outside VHA be documented in patients' medical
"PKG",197,22,1,"PAH",1,1,6,0)
records. These four categories of medications will hereafter be referred
"PKG",197,22,1,"PAH",1,1,7,0)
to as Non-VA Meds. This patch makes the changes necessary to Inpatient 
"PKG",197,22,1,"PAH",1,1,8,0)
Medications V. 5.0 to support Non-VA Meds.
"PKG",197,22,1,"PAH",1,1,9,0)
 
"PKG",197,22,1,"PAH",1,1,10,0)
2. To accommodate Billing Awareness, it was necessary to modify the 
"PKG",197,22,1,"PAH",1,1,11,0)
communication between CPRS and Outpatient Pharmacy V. 7.0 to include 
"PKG",197,22,1,"PAH",1,1,12,0)
new diagnosis codes. Inpatient Medications V. 5.0 routes all pharmacy
"PKG",197,22,1,"PAH",1,1,13,0)
orders to the appropriate package. This patch makes the changes necessary 
"PKG",197,22,1,"PAH",1,1,14,0)
to pass the new diagnosis codes to the appropriate package.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSJHL4")
0^1^B32306771
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107**;16 DEC 97
"RTN","PSJHL4",3,0)
 ;
"RTN","PSJHL4",4,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL4",6,0)
 ; Reference to ^%ZOSF is supported by DBIA# 10096.
"RTN","PSJHL4",7,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL4",8,0)
 ; Reference to ^DIK is supported by DBIA# 10013.
"RTN","PSJHL4",9,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL4",10,0)
 ;
"RTN","PSJHL4",11,0)
EN(PSJMSG) ; start here
"RTN","PSJHL4",12,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",13,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",14,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",15,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",16,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN
"RTN","PSJHL4",17,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",18,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",19,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",20,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",21,0)
END ;
"RTN","PSJHL4",22,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",23,0)
 Q
"RTN","PSJHL4",24,0)
 ;
"RTN","PSJHL4",25,0)
DECODE ;break segment down into fields
"RTN","PSJHL4",26,0)
 K FIELD
"RTN","PSJHL4",27,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",28,0)
 S J=0
"RTN","PSJHL4",29,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",30,0)
 .;get fields from segment
"RTN","PSJHL4",31,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",32,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",33,0)
 Q
"RTN","PSJHL4",34,0)
 ;
"RTN","PSJHL4",35,0)
MSH ;
"RTN","PSJHL4",36,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",37,0)
 Q
"RTN","PSJHL4",38,0)
 ;
"RTN","PSJHL4",39,0)
PID ;
"RTN","PSJHL4",40,0)
 S PSJHLDFN=FIELD(3)
"RTN","PSJHL4",41,0)
 Q
"RTN","PSJHL4",42,0)
 ;
"RTN","PSJHL4",43,0)
PV1 ;
"RTN","PSJHL4",44,0)
 N A
"RTN","PSJHL4",45,0)
 S CLASS=FIELD(2),LOC=FIELD(3)
"RTN","PSJHL4",46,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",47,0)
 ;N II K PSJNVA S II="" F  S II=$O(PSJMSG(II)) Q:'II  D  Q:CLASS="O"
"RTN","PSJHL4",48,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",49,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",50,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",51,0)
 .;I $P(X,"|")="ZRN" S PSJNVA=1 D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",52,0)
 ; OBR check - enable outpatient flagging from backdoor
"RTN","PSJHL4",53,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",54,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",55,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",56,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",57,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",58,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",59,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",60,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",61,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",62,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",63,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",64,0)
 Q
"RTN","PSJHL4",65,0)
 ;
"RTN","PSJHL4",66,0)
ORC ;
"RTN","PSJHL4",67,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",68,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",69,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",70,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",71,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",72,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",73,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",74,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",75,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",76,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$P(FIELD(7),"^",8)
"RTN","PSJHL4",77,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3)
"RTN","PSJHL4",78,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",79,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",80,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",81,0)
 I $E(SCHEDULE,1)=" " S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",82,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",83,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",84,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",85,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",86,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",87,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",88,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",89,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",90,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",91,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",92,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",93,0)
 Q
"RTN","PSJHL4",94,0)
OBR ; This segment is used to pass flagging information from CPRS.
"RTN","PSJHL4",95,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",96,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",97,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",98,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",99,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",100,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",101,0)
 S FLCMNT=$G(FIELD(13))
"RTN","PSJHL4",102,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",103,0)
 Q
"RTN","PSJHL4",104,0)
RXC ; IV order
"RTN","PSJHL4",105,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",106,0)
 Q
"RTN","PSJHL4",107,0)
 ;
"RTN","PSJHL4",108,0)
RXO ;
"RTN","PSJHL4",109,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",110,0)
 Q
"RTN","PSJHL4",111,0)
 ;
"RTN","PSJHL4",112,0)
RXR ;
"RTN","PSJHL4",113,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",114,0)
 Q
"RTN","PSJHL4",115,0)
 ;
"RTN","PSJHL4",116,0)
OBX ;
"RTN","PSJHL4",117,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",118,0)
 Q
"RTN","PSJHL4",119,0)
 ;
"RTN","PSJHL4",120,0)
NTE ;
"RTN","PSJHL4",121,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",122,0)
 Q
"RTN","PSJHL4",123,0)
 ;
"RTN","PSJHL4",124,0)
ZRX ;
"RTN","PSJHL4",125,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",126,0)
 Q
"RTN","PSJHL4",127,0)
 ;
"RTN","PSJHL4",128,0)
ZSC ;Service Connected - Not Used by Inpatient
"RTN","PSJHL4",129,0)
 Q
"RTN","PSJHL4",130,0)
 ;
"RTN","PSJHL4",131,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",132,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",133,0)
 Q
"RTN","PSJHL4",134,0)
DG1 ;Billing Awareness - Not used by Inpatient
"RTN","PSJHL4",135,0)
 Q
"RTN","PSJLMUT1")
0^2^B63891691
"RTN","PSJLMUT1",1,0)
PSJLMUT1 ;BIR/MLM-DRUG NAME DISPLAY ;05 Feb 98 / 1:39 PM
"RTN","PSJLMUT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,27,29,49,58,107**;16 DEC 97
"RTN","PSJLMUT1",3,0)
 ;
"RTN","PSJLMUT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJLMUT1",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJLMUT1",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJLMUT1",7,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJLMUT1",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJLMUT1",9,0)
 ;
"RTN","PSJLMUT1",10,0)
DRGDISP(DFN,ON,NL,GL,NAME,DRUGONLY)       ;
"RTN","PSJLMUT1",11,0)
 ;; DRUGONLY = 1/0 - Only the drug name will be returned.
"RTN","PSJLMUT1",12,0)
 ;; NL       = The drug name display length
"RTN","PSJLMUT1",13,0)
 ;; GL       = The give line display length, total length-6 ("Give: ")
"RTN","PSJLMUT1",14,0)
 ;; NAME(X)  = Drug name and give line in displayable format.
"RTN","PSJLMUT1",15,0)
 ;; ON       = IEN#_U/P (U=Unit Dose; P=Pending)
"RTN","PSJLMUT1",16,0)
 ;
"RTN","PSJLMUT1",17,0)
 NEW F,OIND,MARX,MR,NOTGV,SCH,PSGUPDDO,PSGGV,X,PSGX,PSGINS,DRUGNAME
"RTN","PSJLMUT1",18,0)
 K NAME S PSGINS=""
"RTN","PSJLMUT1",19,0)
 S:ON["U" F="^PS(55,DFN,5,+ON,"
"RTN","PSJLMUT1",20,0)
 I ON["P" S F="^PS(53.1,+ON,",X=$G(@(F_".3)")),PSGINS=$S(X]"":X,1:"")
"RTN","PSJLMUT1",21,0)
 I $G(@(F_"0)"))="" S NAME(1)="NOT FOUND" Q
"RTN","PSJLMUT1",22,0)
 S OIND=$G(@(F_".2)")),PSGUPDDO=$P(OIND,U,2),X=@(F_"0)"),NOTGV=$P(X,U,22),MR=$$ENMRN^PSGMI(+$P(X,U,3))
"RTN","PSJLMUT1",23,0)
 I '+OIND,($P(X,U,4)'="U") NEW DRG D GTDRG^PSIVORFA F X="AD","SOL" Q:+OIND  F PSGX=0:0 S PSGX=$O(DRG(X,PSGX)) Q:'PSGX  S OIND=$P(DRG(X,PSGX),U,6) Q:+OIND
"RTN","PSJLMUT1",24,0)
 S SCH=$P($G(@(F_"2)")),U)
"RTN","PSJLMUT1",25,0)
 I +$O(@(F_"1,0)")),'+$O(@(F_"1,1)")),PSGUPDDO="" D DD(F,.DRUGNAME)
"RTN","PSJLMUT1",26,0)
 S:($G(DRUGNAME)=""!($G(DRUGNAME)["NOT FOUND")) DRUGNAME=$$OIDF(OIND)
"RTN","PSJLMUT1",27,0)
 ;S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_PSGINS_PSGUPDDO_" "_MR_" "_SCH
"RTN","PSJLMUT1",28,0)
 S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_$S(('$D(PSJPDDDP)&('$L(PSGUPDDO))):PSGINS,1:PSGUPDDO)_" "_MR_" "_SCH
"RTN","PSJLMUT1",29,0)
 S PSGX=0 K PSJPDDDP
"RTN","PSJLMUT1",30,0)
 D TXT^PSGMUTL(DRUGNAME,NL) F X=0:0 S X=$O(MARX(X)) Q:'X  S NAME(X)=$S(X>1:"  ",1:"")_MARX(X),PSGX=X
"RTN","PSJLMUT1",31,0)
 Q:+DRUGONLY
"RTN","PSJLMUT1",32,0)
 D TXT^PSGMUTL(PSGGV,GL) F X=0:0 S X=$O(MARX(X)) Q:'X  D
"RTN","PSJLMUT1",33,0)
 . I X=1 S NAME(PSGX+X)="Give: "_MARX(X) Q
"RTN","PSJLMUT1",34,0)
 . S NAME(PSGX+X)=$S(X>1:"      ",1:"")_MARX(X)
"RTN","PSJLMUT1",35,0)
 Q
"RTN","PSJLMUT1",36,0)
OIDF(OIND)    ; Return Orderable Item name and Dosage form.
"RTN","PSJLMUT1",37,0)
 ;; +OIND = orderable item IEN
"RTN","PSJLMUT1",38,0)
 NEW X,NAME
"RTN","PSJLMUT1",39,0)
 S X=$G(^PS(50.7,+OIND,0))
"RTN","PSJLMUT1",40,0)
 S:$P(X,U)]"" NAME=$P(X,U)_" "_$P($G(^PS(50.606,+$P(X,U,2),0)),U)
"RTN","PSJLMUT1",41,0)
 Q $S($G(NAME)]"":NAME,1:"NOT FOUND "_+OIND_";PS(50.7")
"RTN","PSJLMUT1",42,0)
 ;
"RTN","PSJLMUT1",43,0)
DD(F,NAME)        ; Return Dispense drug name.
"RTN","PSJLMUT1",44,0)
 ;; F = "^PS(55,DFN,5,+ON," or "^PS(53.1,+ON,"
"RTN","PSJLMUT1",45,0)
 NEW X K NAME
"RTN","PSJLMUT1",46,0)
 S X=$O(@(F_"1,0)")),X=$G(@(F_"1,"_+X_",0)"))
"RTN","PSJLMUT1",47,0)
 I $P(X,U)]"" S NAME=$P($G(^PSDRUG(+X,0)),U)
"RTN","PSJLMUT1",48,0)
 E  S NAME="NOT FOUND "_+X_";PSDRUG"
"RTN","PSJLMUT1",49,0)
 I '$O(@(F_"1,1)")),+$P(X,U,2)>1 S PSGUPDDO=+$P(X,U,2)
"RTN","PSJLMUT1",50,0)
 S PSJPDDDP=1
"RTN","PSJLMUT1",51,0)
 Q
"RTN","PSJLMUT1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y
"RTN","PSJLMUT1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJLMUT1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJLMUT1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMUT1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJLMUT1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJLMUT1",59,0)
 S STAT=$P(NODE0,U,9) I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJLMUT1",60,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJLMUT1",61,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJLMUT1",62,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMUT1",63,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJLMUT1",64,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJLMUT1",65,0)
 . S PSJOC(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJLMUT1",66,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",67,0)
 Q
"RTN","PSJLMUT1",68,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",69,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJLMUT1",70,0)
 S TYP="?" I ON["V" D
"RTN","PSJLMUT1",71,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMUT1",72,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMUT1",73,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",74,0)
 S PSJCT=0,PSJL=""
"RTN","PSJLMUT1",75,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",76,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJLMUT1",77,0)
 Q
"RTN","PSJLMUT1",78,0)
SOL ;
"RTN","PSJLMUT1",79,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJLMUT1",80,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJLMUT1",81,0)
 Q
"RTN","PSJLMUT1",82,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMUT1",83,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMUT1",84,0)
 Q
"RTN","PSJLMUT1",85,0)
 ;
"RTN","PSJLMUT1",86,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMUT1",87,0)
 K PSJIVFLG
"RTN","PSJLMUT1",88,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMUT1",89,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMUT1",90,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMUT1",91,0)
 Q
"RTN","PSJLMUT1",92,0)
SETTMP ;
"RTN","PSJLMUT1",93,0)
 S PSJOC(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",94,0)
 Q
"RTN","PSJLMUT1",95,0)
ORDCHK(DFN,TYPE,PIECE)   ;
"RTN","PSJLMUT1",96,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLMUT1",97,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLMUT1",98,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLMUT1",99,0)
 ;PIECE = The piece order number is return from ^TMP($J,"DD"...
"RTN","PSJLMUT1",100,0)
 ;PSJOC(ON,x) = Array of inpatient orders to be displayed
"RTN","PSJLMUT1",101,0)
 ;
"RTN","PSJLMUT1",102,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLMUT1",103,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLMUT1",104,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLMUT1",105,0)
 . S PSJPACK=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE)
"RTN","PSJLMUT1",106,0)
 . I $G(PSGORD) S PSJORD=PSGORD ; Set PSJORD if PSGORD exists and is not Null
"RTN","PSJLMUT1",107,0)
 . I $G(PSJORD)]"" I $S($D(PSJORD):$G(PSJORD),1:$G(PSGORD))'["V",$P(PSJPACK,";")=$S($D(PSJORD):$G(PSJORD),1:$G(PSGORD)) Q  ; don't flag order that is being renewed as duplicate, only checks Unit Dose orders
"RTN","PSJLMUT1",108,0)
 . ; Don't flag if pending renewal from CPRS
"RTN","PSJLMUT1",109,0)
 . I $G(PSJORD)]"",(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",24)="R"),($P(PSJPACK,";")["U"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",27)="R"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",26)=PSJORD) Q
"RTN","PSJLMUT1",110,0)
 . I $G(PSIVRNFG),$G(ON55)["V",$P(PSJPACK,";")=$G(ON55) Q  ;PSIVRNFG set and kill in R+2^PSIVOPT2. Needed to do dupl. check on new order but not renew.
"RTN","PSJLMUT1",111,0)
 . S PSJORIEN=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE-1)
"RTN","PSJLMUT1",112,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLMUT1",113,0)
 . ; Adding Drug Interactions check for use in Intervention defaults in PSJRXI.
"RTN","PSJLMUT1",114,0)
 . I TYPE="DI" S PSJRXREQ=$S($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL":1,1:2)
"RTN","PSJLMUT1",115,0)
 . ;I $P(PSJPACK,";",2)["O" D  Q
"RTN","PSJLMUT1",116,0)
 . N X S X=$P(PSJPACK,";",2) I X["O" D  Q
"RTN","PSJLMUT1",117,0)
 ..  D:PSJFST=1 PAUSE
"RTN","PSJLMUT1",118,0)
 ..  ;W !!,"The patient has this outpatient order:",!
"RTN","PSJLMUT1",119,0)
 ..  W !!,"The patient has this "_$S($P(PSJPACK,";")["N":"Non-VA Meds",$P(PSJPACK,";",2)["O":"Outpatient",1:"")_" order:",!
"RTN","PSJLMUT1",120,0)
 ..  D EN^PSODRDU2(DFN,PSJPACK),PAUSE S PSJPDRG=1,PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1)
"RTN","PSJLMUT1",121,0)
 . S ON=$P(PSJPACK,";") Q:$D(PSJOC(ON))
"RTN","PSJLMUT1",122,0)
 . I ON=$G(PSIVOCON),+PSJORIEN Q
"RTN","PSJLMUT1",123,0)
 . I ON=$G(PSIVOCON),'+PSJORIEN D SETPSJOC Q
"RTN","PSJLMUT1",124,0)
 . ;S PSJOC=PSJOC+1,PSJPDRG=1 D:PSJOC=1 WRITE(TYPE)
"RTN","PSJLMUT1",125,0)
 . I ON["V" D
"RTN","PSJLMUT1",126,0)
 .. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLMUT1",127,0)
 .. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",128,0)
 . I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",129,0)
 . S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",130,0)
 D:PSJOC WRITE(TYPE)
"RTN","PSJLMUT1",131,0)
 S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1,PSJFST=PSJFST+1 D
"RTN","PSJLMUT1",132,0)
 . F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX) S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLMUT1",133,0)
 W !
"RTN","PSJLMUT1",134,0)
 Q
"RTN","PSJLMUT1",135,0)
SETPSJOC ;Set PSJOC array to be displayed later
"RTN","PSJLMUT1",136,0)
 NEW PIECE S PIECE=$S(TYPE="DC":4,1:2)
"RTN","PSJLMUT1",137,0)
 S X=$$SETSTR^VALM1($P(^TMP($J,TYPE,PSIVX,0),U,PIECE),"",9,40)
"RTN","PSJLMUT1",138,0)
 S X=$$SETSTR^VALM1("* EXISTS IN CURRENT ORDER *",X,50,27)
"RTN","PSJLMUT1",139,0)
 S PSJOC(ON,PSJLINE)=X,PSJLINE=PSJLINE+1,PSJOC=PSJOC+1
"RTN","PSJLMUT1",140,0)
 Q
"RTN","PSJLMUT1",141,0)
WRITE(TYPE)        ;Display order check description
"RTN","PSJLMUT1",142,0)
 S PSJPDRG=1
"RTN","PSJLMUT1",143,0)
 I TYPE="DD" W !!,"This patient is already receiving the following order",$S(PSJOC>1:"s",1:"")," for ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"this drug"),":",!
"RTN","PSJLMUT1",144,0)
 I TYPE="DC" W !!,"This patient is already receiving ",$S(PSJOC>1:"orders",1:"an order")," for the following drug",$S(PSJOC>1:"s",1:"")," in the same",!,"class as ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"the drug selected"),":",!
"RTN","PSJLMUT1",145,0)
 I TYPE="DI" W !!,"This patient is receiving the following medication",$S(PSJOC>1:"s",1:"")," that ha",$S(PSJOC>1:"ve",1:"s")," an interaction",!,"with ",$P($G(^PSDRUG(PSJDD,0)),U),":",!
"RTN","PSJLMUT1",146,0)
 Q
"RTN","PSJLMUT1",147,0)
PAUSE ;
"RTN","PSJLMUT1",148,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT1",149,0)
 Q
"RTN","PSJORUT2")
0^3^B45776268
"RTN","PSJORUT2",1,0)
PSJORUT2 ;BIR/MLM-MISC. PROCEDURE CALLS FOR OE/RR 3.0 (CONT.) ;03 Aug 98 / 8:42 AM
"RTN","PSJORUT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**14,29,50,56,58,107**;16 DEC 97
"RTN","PSJORUT2",3,0)
 ;
"RTN","PSJORUT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJORUT2",5,0)
 ; Reference to ^PS(50.605 is supported by DBIA 2138
"RTN","PSJORUT2",6,0)
 ; References to ^PS(52.6 supported by DBIA 1231
"RTN","PSJORUT2",7,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSJORUT2",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORUT2",9,0)
 ; Reference to ^PSNDF( is supported by DBIA 2195
"RTN","PSJORUT2",10,0)
 ; Reference to ^PSRX( is supported by DBIA 824
"RTN","PSJORUT2",11,0)
 ; Reference to ^PSNAPIS is supported by DBIA 2531
"RTN","PSJORUT2",12,0)
 ;
"RTN","PSJORUT2",13,0)
ENVAC(PN) ; Find VA CLASS of VA Product Name
"RTN","PSJORUT2",14,0)
 ;Input: PN - See above
"RTN","PSJORUT2",15,0)
 ;Output: VA Drug Class^Classification
"RTN","PSJORUT2",16,0)
 ;
"RTN","PSJORUT2",17,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",18,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N PSJC,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),PSJC=$$DCLASS^PSNAPIS(X1,X2) Q PSJC
"RTN","PSJORUT2",19,0)
 ;
"RTN","PSJORUT2",20,0)
 N GDP,PNP S GDP=$P(PN,"."),PNP=$P(PN,".",2)
"RTN","PSJORUT2",21,0)
 S X=+$P($G(^PSNDF(+GDP,5,+PNP,0)),U,2),X=+$P($G(^PSNDF(GDP,2,X,0)),U,3),PSJC=$P($G(^PS(50.605,X,0)),U,2)
"RTN","PSJORUT2",22,0)
 Q $S('X:0,PSJC="":0,1:X_U_PSJC)
"RTN","PSJORUT2",23,0)
 ;
"RTN","PSJORUT2",24,0)
ENVAGN(PN) ; Return VA Generic Name for specified VA Product Name.
"RTN","PSJORUT2",25,0)
 ;Input:  PN - VA Product Name IEN
"RTN","PSJORUT2",26,0)
 ;Output: VA Generic Name IEN^VA Generic Name
"RTN","PSJORUT2",27,0)
 ;
"RTN","PSJORUT2",28,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",29,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N GDP,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),GDP=$$VAGN^PSNAPIS(X1) Q $S(GDP=0:0,1:X1_U_GDP)
"RTN","PSJORUT2",30,0)
 ;
"RTN","PSJORUT2",31,0)
 N GDP,PNP S GDP=+$P(PN,"."),PNP=+$P(PN,".",2)
"RTN","PSJORUT2",32,0)
 S X=$P($G(^PSNDF(GDP,0)),U)
"RTN","PSJORUT2",33,0)
 Q $S('GDP:0,X="":0,1:GDP_U_X)
"RTN","PSJORUT2",34,0)
ENVOL(PN,ARRAY) ;
"RTN","PSJORUT2",35,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",36,0)
 N X,XX,F,INACT,IVFL S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU"
"RTN","PSJORUT2",37,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",38,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",39,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",40,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",41,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",42,0)
 Q
"RTN","PSJORUT2",43,0)
 ;
"RTN","PSJORUT2",44,0)
ENVOL2(PN,ARRAY) ;Only for Med Button IV orders.
"RTN","PSJORUT2",45,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",46,0)
 N X,XX,F,INACT S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU"
"RTN","PSJORUT2",47,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",48,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",49,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",50,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",51,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",52,0)
 Q
"RTN","PSJORUT2",53,0)
 ;
"RTN","PSJORUT2",54,0)
 ;
"RTN","PSJORUT2",55,0)
SENVOL(PN,PSJ) ;Return array listing volume (base only) and volume units for the specified additive or solution.
"RTN","PSJORUT2",56,0)
 ;Input:  PN - IEN_B (Base) or A (Additive)
"RTN","PSJORUT2",57,0)
 ;Output: ARRAY(IEN,A:additive or B:Base)=volume^volume units
"RTN","PSJORUT2",58,0)
 ;        If no volume or units found PSJ=0; If found PSJ=1.
"RTN","PSJORUT2",59,0)
 ;
"RTN","PSJORUT2",60,0)
 N X S PSJ=1,X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU"
"RTN","PSJORUT2",61,0)
 I PN'["A",PN'["B" S PSJ=0 Q
"RTN","PSJORUT2",62,0)
 S PSJ=PSJ+1
"RTN","PSJORUT2",63,0)
 I PN["A" S PSJ(+PN,"A")=U_X(+$P($G(^PS(52.6,+PN,0)),U,3)) Q
"RTN","PSJORUT2",64,0)
 I PN["B" S PSJ(+PN,"B")=+$P($G(^PS(52.7,+PN,0)),U,3)_U_X(1) Q
"RTN","PSJORUT2",65,0)
 Q
"RTN","PSJORUT2",66,0)
 ;
"RTN","PSJORUT2",67,0)
ENREF(PRX) ; Return number of refills remaining.
"RTN","PSJORUT2",68,0)
 ;Input: PRX - Internal prescription number from File #52.
"RTN","PSJORUT2",69,0)
 ;Output: Number of refills remaining.
"RTN","PSJORUT2",70,0)
 ;
"RTN","PSJORUT2",71,0)
 N X,COUNT,CNT S PRX=$P(PRX,"^"),COUNT=0,X=$P(^PSRX(PRX,0),"^",9)
"RTN","PSJORUT2",72,0)
 D:$O(^PSRX(PRX,1,0))
"RTN","PSJORUT2",73,0)
 .F CNT=0:0 S CNT=$O(^PSRX(PRX,1,CNT)) Q:'CNT  S COUNT=COUNT+1
"RTN","PSJORUT2",74,0)
 S:$G(COUNT) X=X-COUNT
"RTN","PSJORUT2",75,0)
 Q X
"RTN","PSJORUT2",76,0)
 ;
"RTN","PSJORUT2",77,0)
ENCHK(DFN,PSJINX)     ; Return dispense drug check array.
"RTN","PSJORUT2",78,0)
 ;Input: DFN      - Patient internal entry number
"RTN","PSJORUT2",79,0)
 ;       PSJINX   - Index number so duplicate drugs will be returned.
"RTN","PSJORUT2",80,0)
 ;       PSGOCHK  - Check should include dispense drugs in 53.45
"RTN","PSJORUT2",81,0)
 ;       PSIVOCHK - Check should include entries in DRG array
"RTN","PSJORUT2",82,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJORUT2",83,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJORUT2",84,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJORUT2",85,0)
 ;
"RTN","PSJORUT2",86,0)
 NEW BDT,DDRUG,DDRUG0,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN
"RTN","PSJORUT2",87,0)
 ;* S BDT=DT,WBDT=BDT_".000001",EDT=9999999
"RTN","PSJORUT2",88,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999
"RTN","PSJORUT2",89,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UD
"RTN","PSJORUT2",90,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJORUT2",91,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) D PIV Q
"RTN","PSJORUT2",92,0)
 . D UD
"RTN","PSJORUT2",93,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IV
"RTN","PSJORUT2",94,0)
 I '$G(PSIVOCON) D NEWIV ; Don't do this when Finishing orders (FN)
"RTN","PSJORUT2",95,0)
 Q
"RTN","PSJORUT2",96,0)
UD ;*** Get the dispense drugs for the Unit Dose orders.
"RTN","PSJORUT2",97,0)
 S PSJORIEN=$P(@(F_ON_",0)"),U,21),DDRUG=0
"RTN","PSJORUT2",98,0)
 I F="^PS(53.1,",($P(@(F_ON_",0)"),U,4)="I") D  Q
"RTN","PSJORUT2",99,0)
 . NEW PSJPD S COD=ON_"P"
"RTN","PSJORUT2",100,0)
 . S PSJPD=+$G(^PS(53.1,ON,.2)) D:$D(^PS(52.6,"AOI",PSJPD)) ENDDIV^PSJORUTL(PSJPD,"A","",.DDRUG) S DDRUG=+DDRUG D:DDRUG DDRUG
"RTN","PSJORUT2",101,0)
 S ON1=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S DDRUG=@(F_ON_",1,"_ON1_",0)") I $P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",102,0)
 I $D(PSGOCHK) F ON1=0:0 S ON1=$O(^PS(53.45,+PSJSYSP,1,ON1)) Q:'ON1  S DDRUG=$G(^PS(53.45,+PSJSYSP,1,ON1,0)) I $P(DDRUG,U,3)=""!@($P(DDRUG,U,3)>BDT) S (COD,PSJORIEN)="" D DDRUG
"RTN","PSJORUT2",103,0)
 I '$O(@(F_ON_",1,"_0_")")) N OI S OI=+$G(@(F_ON_",.2)")) I OI D
"RTN","PSJORUT2",104,0)
 .S DDRUG="" F  S DDRUG=$O(^PSDRUG("ASP",OI,DDRUG)) Q:'DDRUG  D
"RTN","PSJORUT2",105,0)
 ..I ($P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT)) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",106,0)
 Q
"RTN","PSJORUT2",107,0)
PIV ;*** Get the dispense drugs for the Pending IV orders.
"RTN","PSJORUT2",108,0)
 S X=^PS(53.1,+ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,27)="R"
"RTN","PSJORUT2",109,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",110,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",111,0)
 Q
"RTN","PSJORUT2",112,0)
IV ;*** Get the dispense drugs for the IV orders.
"RTN","PSJORUT2",113,0)
 NEW X S X=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,17)="R"
"RTN","PSJORUT2",114,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",115,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",116,0)
 ;*D:$G(PSIVNEW) NEWIV
"RTN","PSJORUT2",117,0)
 Q
"RTN","PSJORUT2",118,0)
NEWIV ;*** Get the dispense drugs for the newly entered IV order.
"RTN","PSJORUT2",119,0)
 NEW PSIVX,ON
"RTN","PSJORUT2",120,0)
 S ON=$O(DRGOC(0)),PSJORIEN="" Q:'+ON
"RTN","PSJORUT2",121,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"AD",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.6,+DRGOC(ON,"AD",PSIVX),0),U,2),COD=ON55 D DDRUG
"RTN","PSJORUT2",122,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"SOL",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.7,+DRGOC(ON,"SOL",PSIVX),0),U,2),COD=ON D DDRUG
"RTN","PSJORUT2",123,0)
 Q
"RTN","PSJORUT2",124,0)
DDRUG ;*** Set PSJ(DDRUG NAME) arrays.
"RTN","PSJORUT2",125,0)
 Q:'DDRUG  S DDRUG0=$G(^PSDRUG(+DDRUG,0)),DDRUGND=$G(^PSDRUG(+DDRUG,"ND"))
"RTN","PSJORUT2",126,0)
 S PSJINX=+$G(PSJINX)+1 ;* ^PSOORDRG calls this entry point.
"RTN","PSJORUT2",127,0)
 I $D(DDRUG)=11,DDRUG[";" D  Q   ; if called from ^PSOORDRG
"RTN","PSJORUT2",128,0)
 .N IPOROP S IPOROP=$P(DDRUG,";",2)
"RTN","PSJORUT2",129,0)
 .S IPOROP=$S(IPOROP="PSO":";O",IPOROP="PSH":"N;O",1:";I")
"RTN","PSJORUT2",130,0)
 .S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$S($G(DDRUG(DDRUG)):DDRUG(DDRUG),1:$G(PSJORIEN))_U_$G(COD)_IPOROP
"RTN","PSJORUT2",131,0)
 S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$G(PSJORIEN)_U_$G(COD)_";I"
"RTN","PSJORUT2",132,0)
 Q
"RTN","PSJORUT2",133,0)
 ;
"RTN","PSJORUT2",134,0)
PRCHK(PSJ) ; Check if authorized to write med orders.
"RTN","PSJORUT2",135,0)
 N %,X
"RTN","PSJORUT2",136,0)
 D NOW^%DTC S X=$G(^VA(200,PSJ,"PS")) I $S('X:1,'$P(%,"^",4):0,1:$P(X,"^",4)'>%) Q 0
"RTN","PSJORUT2",137,0)
 Q PSJ
"RTN","PSJORUT2",138,0)
 ;
"RTN","PSJORUT2",139,0)
ENNG(PSJDPT,PSJNUM)          ; returns 1 if order marked "Not To Be Given"
"RTN","PSJORUT2",140,0)
 ;                                  0 if not marked
"RTN","PSJORUT2",141,0)
 I '$D(^PS(55,PSJDPT,5,+PSJNUM,0)) Q 0
"RTN","PSJORUT2",142,0)
 I $P($G(^PS(55,PSJDPT,5,+PSJNUM,0)),"^",22)=1 Q 1
"RTN","PSJORUT2",143,0)
 Q 0
"VER")
8.0^22.0
**END**
**END**
