Released PSO*7*214 SEQ #210
Extracted from mail message
**KIDS**:PSO*7.0*214^

**INSTALL NAME**
PSO*7.0*214
"BLD",5570,0)
PSO*7.0*214^OUTPATIENT PHARMACY^0^3051103^y
"BLD",5570,1,0)
^^8^8^3051103^^
"BLD",5570,1,1,0)
A site reported a problem with the Outpatient prescription status of 
"BLD",5570,1,2,0)
SUSPENDED. In some cases, it was being interpreted as being 
"BLD",5570,1,3,0)
non-refillable. A patient safety incident was entered regarding this 
"BLD",5570,1,4,0)
problem. The interim solution is to modify the Outpatient Pharmacy V. 7.0 
"BLD",5570,1,5,0)
(OP) Applications Program Interface (API) that returns the prescription
"BLD",5570,1,6,0)
status. Instead of returning SUSPENDED, the API will return ACTIVE/SUSP. 
"BLD",5570,1,7,0)
There will be no change to the display in the OP application.
"BLD",5570,1,8,0)
Remedy Ticket: HD67681
"BLD",5570,4,0)
^9.64PA^^
"BLD",5570,6)
1^
"BLD",5570,"ABPKG")
n
"BLD",5570,"KRN",0)
^9.67PA^8989.52^19
"BLD",5570,"KRN",.4,0)
.4
"BLD",5570,"KRN",.401,0)
.401
"BLD",5570,"KRN",.402,0)
.402
"BLD",5570,"KRN",.403,0)
.403
"BLD",5570,"KRN",.5,0)
.5
"BLD",5570,"KRN",.84,0)
.84
"BLD",5570,"KRN",3.6,0)
3.6
"BLD",5570,"KRN",3.8,0)
3.8
"BLD",5570,"KRN",9.2,0)
9.2
"BLD",5570,"KRN",9.8,0)
9.8
"BLD",5570,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5570,"KRN",9.8,"NM",1,0)
PSOORRL^^0^B56134945
"BLD",5570,"KRN",9.8,"NM",2,0)
PSOHCSUM^^0^B23286979
"BLD",5570,"KRN",9.8,"NM","B","PSOHCSUM",2)

"BLD",5570,"KRN",9.8,"NM","B","PSOORRL",1)

"BLD",5570,"KRN",19,0)
19
"BLD",5570,"KRN",19.1,0)
19.1
"BLD",5570,"KRN",101,0)
101
"BLD",5570,"KRN",409.61,0)
409.61
"BLD",5570,"KRN",771,0)
771
"BLD",5570,"KRN",870,0)
870
"BLD",5570,"KRN",8989.51,0)
8989.51
"BLD",5570,"KRN",8989.52,0)
8989.52
"BLD",5570,"KRN",8994,0)
8994
"BLD",5570,"KRN","B",.4,.4)

"BLD",5570,"KRN","B",.401,.401)

"BLD",5570,"KRN","B",.402,.402)

"BLD",5570,"KRN","B",.403,.403)

"BLD",5570,"KRN","B",.5,.5)

"BLD",5570,"KRN","B",.84,.84)

"BLD",5570,"KRN","B",3.6,3.6)

"BLD",5570,"KRN","B",3.8,3.8)

"BLD",5570,"KRN","B",9.2,9.2)

"BLD",5570,"KRN","B",9.8,9.8)

"BLD",5570,"KRN","B",19,19)

"BLD",5570,"KRN","B",19.1,19.1)

"BLD",5570,"KRN","B",101,101)

"BLD",5570,"KRN","B",409.61,409.61)

"BLD",5570,"KRN","B",771,771)

"BLD",5570,"KRN","B",870,870)

"BLD",5570,"KRN","B",8989.51,8989.51)

"BLD",5570,"KRN","B",8989.52,8989.52)

"BLD",5570,"KRN","B",8994,8994)

"BLD",5570,"QUES",0)
^9.62^^
"BLD",5570,"REQB",0)
^9.611^1^1
"BLD",5570,"REQB",1,0)
PSO*7.0*159^2
"BLD",5570,"REQB","B","PSO*7.0*159",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
214^3051103^11881
"PKG",141,22,1,"PAH",1,1,0)
^^8^8^3051103
"PKG",141,22,1,"PAH",1,1,1,0)
A site reported a problem with the Outpatient prescription status of 
"PKG",141,22,1,"PAH",1,1,2,0)
SUSPENDED. In some cases, it was being interpreted as being 
"PKG",141,22,1,"PAH",1,1,3,0)
non-refillable. A patient safety incident was entered regarding this 
"PKG",141,22,1,"PAH",1,1,4,0)
problem. The interim solution is to modify the Outpatient Pharmacy V. 7.0 
"PKG",141,22,1,"PAH",1,1,5,0)
(OP) Applications Program Interface (API) that returns the prescription
"PKG",141,22,1,"PAH",1,1,6,0)
status. Instead of returning SUSPENDED, the API will return ACTIVE/SUSP. 
"PKG",141,22,1,"PAH",1,1,7,0)
There will be no change to the display in the OP application.
"PKG",141,22,1,"PAH",1,1,8,0)
Remedy Ticket: HD67681
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSOHCSUM")
0^2^B23286979^B22645938
"RTN","PSOHCSUM",1,0)
PSOHCSUM ;BHAM ISC/SAB - gather data for outpatient rx health care summary ;03/01/96 8:29
"RTN","PSOHCSUM",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,35,42,48,54,46,103,132,214**;DEC 1997
"RTN","PSOHCSUM",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSOHCSUM",4,0)
 ;External reference to File ^PSDRUG supported by DBIA 221
"RTN","PSOHCSUM",5,0)
 ;External reference to File ^PS(50.7 supported by DBIA 2223
"RTN","PSOHCSUM",6,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOHCSUM",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSOHCSUM",8,0)
 ;Accepts DFN (assumed to be valid)
"RTN","PSOHCSUM",9,0)
 ;Looks for PSOBEGIN as earliest expiration/cancel date for search
"RTN","PSOHCSUM",10,0)
 ;If $D(PSOBEGIN)=0 use DT as earliest expiration/cancel date
"RTN","PSOHCSUM",11,0)
 ;returns data in ^TMP("PSOO",$J,Inverse last fill date,0)
"RTN","PSOHCSUM",12,0)
 ;data is ISSUE DATE^LAST FILL DATE^DRUG^PROVIDER^STATUS^RX#^QTY^#REFILLS^IFN^COST/FILL^EXP/CANC DATE
"RTN","PSOHCSUM",13,0)
 ;and ^TMP("PSOO",$J,Inverse last fill date,n,0)=SIG
"RTN","PSOHCSUM",14,0)
 ;NON-VA Meds: ^TMP("PSOO",$J,"NVA",n,0)=orderable item_" "_dose form^status (active or discontinued)^start date(fm format)^cprs order # (ptr to 100)^date/time documented (fm format)^documented by (ptr to 200_";"_.01)^dc date/time(fm format)
"RTN","PSOHCSUM",15,0)
 ;^TMP("PSOO",$J,"NVA",n,1,0)=dosage^med route^schedule^drug (file #50_";"_.01)^clinic (file #44_";"_.01)
"RTN","PSOHCSUM",16,0)
 ;^TMP("PSOO",$J,"NVA",n,"DSC",nn,0)=statement/explanation/comments
"RTN","PSOHCSUM",17,0)
 ;
"RTN","PSOHCSUM",18,0)
 ;returns PSOBEGIN (if sent or equal DT if not sent)
"RTN","PSOHCSUM",19,0)
 ;
"RTN","PSOHCSUM",20,0)
 ;If $D(PSOACT) loop thru PS(55,DFN,"P","A") from PSOBEGIN to get actives only
"RTN","PSOHCSUM",21,0)
 ;otherwise loop through entire "P" multiple to get all Rx's
"RTN","PSOHCSUM",22,0)
 ;
"RTN","PSOHCSUM",23,0)
 S ACS=0
"RTN","PSOHCSUM",24,0)
EN K ^TMP("PSOO",$J),PSONV
"RTN","PSOHCSUM",25,0)
 S PSOBEGIN=$S($D(PSOBEGIN):PSOBEGIN,1:DT)
"RTN","PSOHCSUM",26,0)
 I $D(PSOACT) F PSODT=PSOBEGIN-1:0 S PSODT=$O(^PS(55,DFN,"P","A",PSODT)) Q:'PSODT  F PSORXX=0:0 S PSORXX=$O(^PS(55,DFN,"P","A",PSODT,PSORXX)) Q:'PSORXX  D:$G(^PSRX(PSORXX,0))]"" GET
"RTN","PSOHCSUM",27,0)
 I '$D(PSOACT) F PSOI=0:0 S PSOI=$O(^PS(55,DFN,"P",PSOI)) Q:'PSOI  S PSORXX=+^(PSOI,0) D:$G(^PSRX(PSORXX,0))]"" GET
"RTN","PSOHCSUM",28,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S NVA=^PS(55,DFN,"NVA",I,0) D
"RTN","PSOHCSUM",29,0)
 .Q:'$P(NVA,"^")  S PSONV=$G(PSONV)+1
"RTN","PSOHCSUM",30,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,0)=$S($D(^PS(50.7,$P(+NVA,"^"),0)):$P(^PS(50.7,$P(+NVA,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_"^"
"RTN","PSOHCSUM",31,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,0)=^TMP("PSOO",$J,"NVA",PSONV,0)_$S($P(NVA,"^",6):"Discontinued",1:"Active")_"^"_$P(NVA,"^",9)_"^"_$P(NVA,"^",8)_"^"_$P(NVA,"^",10)_"^"_$P(NVA,"^",11)_";"_$P($G(^VA(200,$P(NVA,"^",11),0)),"^")_"^"_$P(NVA,"^",7)
"RTN","PSOHCSUM",32,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,1,0)=$P(NVA,"^",3)_"^"_$P(NVA,"^",4)_"^"_$P(NVA,"^",5)_"^"_$S($P(NVA,"^",2):$P(NVA,"^",2)_";"_$P(^PSDRUG($P(NVA,"^",2),0),"^"),1:"")_"^"
"RTN","PSOHCSUM",33,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,1,0)=^TMP("PSOO",$J,"NVA",PSONV,1,0)_$S($D(^SC(+$P(NVA,"^",12),0)):$P(NVA,"^",12)_";"_$P(^SC($P(NVA,"^",12),0),"^"),1:"")
"RTN","PSOHCSUM",34,0)
 .F S=0:0 S S=$O(^PS(55,DFN,"NVA",I,"DSC",S)) Q:'S  S ^TMP("PSOO",$J,"NVA",PSONV,"DSC",S,0)=^PS(55,DFN,"NVA",I,"DSC",S,0)
"RTN","PSOHCSUM",35,0)
 ;
"RTN","PSOHCSUM",36,0)
END K PSODT,PSOST,PSORXX,PSO0,PSO2,PSOIDD,PSOFD,PSODR,PSOPR,PSOREF,PSORFL,PSOI,PSOJ,PSOX,PSOCF,I,PSONV,NVA
"RTN","PSOHCSUM",37,0)
 Q
"RTN","PSOHCSUM",38,0)
 ;
"RTN","PSOHCSUM",39,0)
GET Q:$P($G(^PSRX(PSORXX,"STA")),"^")=13  S PSO0=^PSRX(PSORXX,0),PSO2=$G(^(2)),PSOFD=+$G(^(3)),PSODR=$P(PSO0,"^",6),PSOPR=$P(PSO0,"^",4),PSOREF=$P(PSO0,"^",9),PSOIDD=$P(PSO0,"^",13)
"RTN","PSOHCSUM",40,0)
 I '$P(PSO0,"^",2)!('PSODR)!('PSOPR) Q
"RTN","PSOHCSUM",41,0)
 I $D(^PS(55,$P(PSO0,"^",2),0)) D:$P($G(^PS(55,$P(PSO0,"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(PSO0,"^",2))
"RTN","PSOHCSUM",42,0)
 S PSOST=$P($G(^PSRX(PSORXX,"STA")),"^")
"RTN","PSOHCSUM",43,0)
 I '$D(PSOACT) D ODT I PSODT<PSOBEGIN Q
"RTN","PSOHCSUM",44,0)
 I $D(PSOACT) Q:PSOST>10&(PSOST<16)
"RTN","PSOHCSUM",45,0)
 I 'PSOFD S PSOFD=$P(PSO0,"^",13) F PSOJ=0:0 S PSOJ=$O(^PSRX(PSORXX,1,PSOJ)) Q:'PSOJ  I $D(^(PSOJ,0)),^(0)>PSOFD S PSOFD=+^(0)
"RTN","PSOHCSUM",46,0)
 S PSOX=$S($D(^PSDRUG(PSODR,0)):$P(^(0),"^"),1:"NOT ON FILE"),PSODR=PSODR_";"_PSOX
"RTN","PSOHCSUM",47,0)
 S PSOX=$G(^VA(200,PSOPR,0)) S PSOPR=PSOPR_";"_$P(PSOX,"^")
"RTN","PSOHCSUM",48,0)
 S PSOX="A;ACTIVE" S:$D(^PS(52.4,PSORXX,0)) PSOX="N;NON-VERIFIED" S:$O(^PS(52.5,"B",PSORXX,0))&($G(^PS(52.5,+$O(^PS(52.5,"B",PSORXX,0)),"P"))'=1) PSOX="S;SUSPENDED"
"RTN","PSOHCSUM",49,0)
 I PSOX["SUSPENDED",$G(ACS) S PSOX="S;ACTIVE/SUSP"
"RTN","PSOHCSUM",50,0)
 S:PSODT<DT PSOX="E;EXPIRED" S:PSOST=4 PSOX="N;NON-VERIFIED" S:PSOST=3!(PSOST=16) PSOX="H;HOLD"
"RTN","PSOHCSUM",51,0)
 S:PSOST=12!(PSOST=14)!(PSOST=15) PSOX="DC;DISCONTINUED"
"RTN","PSOHCSUM",52,0)
 S PSOCF=+$P(PSO0,"^",17)*(+$P(PSO0,"^",7)) ; Cost/Fill
"RTN","PSOHCSUM",53,0)
 S PSORFL=0 F PSOJ=0:0 S PSORFL=$O(^PSRX(PSORXX,1,PSORFL)) Q:PSORFL'>0  S PSOREF=PSOREF-1
"RTN","PSOHCSUM",54,0)
 F PSOJ=9999999-PSOFD:.0001 Q:'$D(^TMP("PSOO",$J,PSOJ))
"RTN","PSOHCSUM",55,0)
 S ^TMP("PSOO",$J,PSOJ,0)=PSOIDD_"^"_PSOFD_"^"_PSODR_"^"_PSOPR_"^"_PSOX_"^"_$P(PSO0,"^")_"^"_$P(PSO0,"^",7)_"^"_PSOREF_"^"_PSORXX_"^"_PSOCF_"^"_PSODT
"RTN","PSOHCSUM",56,0)
 I '$P(^PSRX(PSORXX,"SIG"),"^",2) D SIG Q
"RTN","PSOHCSUM",57,0)
 F I=0:0 S I=$O(^PSRX(PSORXX,"SIG1",I)) Q:'I  S ^TMP("PSOO",$J,PSOJ,I,0)=^PSRX(PSORXX,"SIG1",I,0)
"RTN","PSOHCSUM",58,0)
 Q
"RTN","PSOHCSUM",59,0)
SIG ;formats backdoor SIG
"RTN","PSOHCSUM",60,0)
 S X=$P(^PSRX(PSORXX,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250),ENT=1
"RTN","PSOHCSUM",61,0)
 F SG=1:1:$L(SIG) S:$L($G(^TMP("PSOO",$J,PSOJ,ENT,0))_" "_$P(SIG," ",SG))>80 ENT=ENT+1 S:$P(SIG," ",SG)'="" ^TMP("PSOO",$J,PSOJ,ENT,0)=$G(^TMP("PSOO",$J,PSOJ,ENT,0))_" "_$P(SIG," ",SG)
"RTN","PSOHCSUM",62,0)
 K SIG,ENT,SG,X Q
"RTN","PSOHCSUM",63,0)
ODT ;canceled or expiration date
"RTN","PSOHCSUM",64,0)
 I +PSOST=12!(PSOST=14)!(PSOST=15) D  Q
"RTN","PSOHCSUM",65,0)
 .I $P(^PSRX(PSORXX,3),"^",5) S PSODT=$P(^PSRX(PSORXX,3),"^",5) Q
"RTN","PSOHCSUM",66,0)
 .S PSODT=0 F PSOJ=0:0 S PSOJ=$O(^PSRX(PSORXX,"A",PSOJ)) Q:PSOJ'>0  I $D(^(PSOJ,0)),$P(^(0),"^",2)="C",+$P(^(0),"^")>PSODT S PSODT=+$P(^(0),"^")
"RTN","PSOHCSUM",67,0)
 S PSODT=+$P(PSO2,"^",6)
"RTN","PSOHCSUM",68,0)
 Q
"RTN","PSOHCSUM",69,0)
ACS ;call from OE/RR to get the new active/susp status
"RTN","PSOHCSUM",70,0)
 S ACS=1 D EN
"RTN","PSOHCSUM",71,0)
 Q
"RTN","PSOORRL")
0^1^B56134945^B56071927
"RTN","PSOORRL",1,0)
PSOORRL ;BHAM ISC/SAB - returns patient's outpatient meds ;07/21/96
"RTN","PSOORRL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,9,34,54,82,124,132,159,214**;DEC 1997
"RTN","PSOORRL",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRL",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRL",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRL",10,0)
 ;External reference to OEL^PSJORRE1 supported by DBIA 2384
"RTN","PSOORRL",11,0)
OCL(DFN,BDT,EDT) ;entry point to return condensed list
"RTN","PSOORRL",12,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRL",13,0)
 N SD,SDT,SDT1
"RTN","PSOORRL",14,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRL",15,0)
 K ^TMP("PS",$J) S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRL",16,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRL",17,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRL",18,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRL",19,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRL",20,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRL",21,0)
 .S ^TMP("PS",$J,TFN,0)=IFN_"R;O"_"^"_$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRL",22,0)
 .S ^TMP("PS",$J,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",23,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",24,0)
 .S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUED^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",25,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRL",26,0)
 .S ^TMP("PS",$J,TFN,"SCH",0)=0
"RTN","PSOORRL",27,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PS",$J,TFN,"SCH",0)=^TMP("PS",$J,TFN,"SCH",0)+1
"RTN","PSOORRL",28,0)
 .S ^TMP("PS",$J,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL",29,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL",30,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL",31,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL",32,0)
 ..S ^TMP("PS",$J,TFN,"MDR",0)=^TMP("PS",$J,TFN,"MDR",0)+1
"RTN","PSOORRL",33,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRL",34,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",35,0)
 ..S ^TMP("PS",$J,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",36,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",37,0)
 K PSOELSE
"RTN","PSOORRL",38,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRL",39,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRL",40,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRL",41,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRL",42,0)
 .S TFN=TFN+1,^TMP("PS",$J,TFN,0)=IFN_"P;O^"_$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRL",43,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRL",44,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRL",45,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PS",$J,TFN,"SCH",0)=SD
"RTN","PSOORRL",46,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PS",$J,TFN,"SIG",0)=SD
"RTN","PSOORRL",47,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PS",$J,TFN,"SIO",0)=SD D
"RTN","PSOORRL",48,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PS",$J,TFN,"SIO",0)=SD S ^TMP("PS",$J,TFN,"SIO",IEN,0)=$G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRL",49,0)
 D NVA,OCL^PSJORRE(DFN,BDT,EDT,.TFN),END^PSOORRL1
"RTN","PSOORRL",50,0)
 K SDT,SDT1,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRL",51,0)
 Q
"RTN","PSOORRL",52,0)
OEL(DFN,RXNUM) ;returns expanded list on specific order
"RTN","PSOORRL",53,0)
 I $P(RXNUM,";",2)="I" D OEL^PSJORRE1(DFN,$P(RXNUM,";")) Q
"RTN","PSOORRL",54,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) Q:RXNUM=""
"RTN","PSOORRL",55,0)
 ;BHW;PSO*7*159;New SD
"RTN","PSOORRL",56,0)
 N SD
"RTN","PSOORRL",57,0)
 K INST,IFN,^TMP("PS",$J) S FL=$P(RXNUM,";"),IFN=+FL,RXNUM=$P(RXNUM,";",2)
"RTN","PSOORRL",58,0)
 I $G(FL)["P"!($G(FL)["S") D PEN^PSOORRL1 Q
"RTN","PSOORRL",59,0)
 I $G(FL)["N" D NVA^PSOORRL1 Q
"RTN","PSOORRL",60,0)
 Q:'$D(^PSRX(IFN,0))
"RTN","PSOORRL",61,0)
 S RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2)
"RTN","PSOORRL",62,0)
 S ^TMP("PS",$J,"RXN",0)=$P(RX0,"^")_"^"_$E($P(RX2,"^",13),1,7)_"^"_$S($P(RX0,"^",11)="W":"W",1:"M")_"^"_$P(RX3,"^",7)_"^"_$S($P($G(^PSRX(IFN,"OR1")),"^",5):$P(^PSRX(IFN,"OR1"),"^",5),1:"")_"^"_$E($P(RX2,"^",2),1,7)_"^"_$E($P(RX2,"^",13),1,7)
"RTN","PSOORRL",63,0)
 F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^") D
"RTN","PSOORRL",64,0)
 .S ^TMP("PS",$J,"REF",I,0)=$P(^PSRX(IFN,1,I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",18),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",65,0)
 .I $P(^PSRX(IFN,1,I,0),"^",18) S $P(^TMP("PS",$J,"RXN",0),"^",2)=$E($P(^PSRX(IFN,1,I,0),"^",18),1,7)
"RTN","PSOORRL",66,0)
 .S ^TMP("PS",$J,"REF",0)=$G(^TMP("PS",$J,"REF",0))+1
"RTN","PSOORRL",67,0)
 F I=0:0 S I=$O(^PSRX(IFN,"P",I)) Q:'I  D
"RTN","PSOORRL",68,0)
 .S ^TMP("PS",$J,"PAR",I,0)=$P(^PSRX(IFN,"P",I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",19),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",69,0)
 .S ^TMP("PS",$J,"PAR",0)=$G(^TMP("PS",$J,"PAR",0))+1
"RTN","PSOORRL",70,0)
 S ^TMP("PS",$J,0)=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)
"RTN","PSOORRL",71,0)
 S ^TMP("PS",$J,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",72,0)
 S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",73,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUE^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",74,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^"_($P(RX0,"^",9)-TRM)_"^"_$P(RX0,"^",13)_"^"_ST_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)_"^"_LSTFD_"^^"
"RTN","PSOORRL",75,0)
 S ^TMP("PS",$J,"DD",0)=1,^TMP("PS",$J,"DD",1,0)=$P(RX0,"^",6)_"^^"
"RTN","PSOORRL",76,0)
 S COD=$S('$G(^PSDRUG(+$P(RX0,"^",6),"I")):1,+$G(^PSDRUG(+$P(RX0,"^",6),"I"))>DT:1,1:0)
"RTN","PSOORRL",77,0)
 S ^TMP("PS",$J,"DD",1,0)=^TMP("PS",$J,"DD",1,0)_$S($P($G(^PSDRUG(+$P(RX0,"^",6),2)),"^",3)["U"&(COD):$P(RX0,"^",6),1:"") K COD
"RTN","PSOORRL",78,0)
 S ^TMP("PS",$J,"SCH",0)=0,(SCH,SC)=0
"RTN","PSOORRL",79,0)
 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^") D
"RTN","PSOORRL",80,0)
 .S ^TMP("PS",$J,"SCH",0)=^TMP("PS",$J,"SCH",0)+1
"RTN","PSOORRL",81,0)
 D MDR^PSOORRL1
"RTN","PSOORRL",82,0)
 S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG^PSOORRL1
"RTN","PSOORRL",83,0)
 I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",84,0)
 .S ^TMP("PS",$J,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",85,0)
 .F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",86,0)
 K PSOELSE
"RTN","PSOORRL",87,0)
 S ^TMP("PS",$J,"PC",0)=0,ITFN=0
"RTN","PSOORRL",88,0)
 F I=0:0 S I=$O(^PSRX(IFN,"PRC",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"PC",ITFN,0)=^PSRX(IFN,"PRC",I,0),^TMP("PS",$J,"PC",0)=^TMP("PS",$J,"PC",0)+1
"RTN","PSOORRL",89,0)
 Q
"RTN","PSOORRL",90,0)
 ;
"RTN","PSOORRL",91,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRL",92,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRL",93,0)
 Q
"RTN","PSOORRL",94,0)
 ;
"RTN","PSOORRL",95,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRL",96,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRL",97,0)
 N SDT,SDT1
"RTN","PSOORRL",98,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRL",99,0)
 .Q:'$P(X,"^")
"RTN","PSOORRL",100,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL",101,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRL",102,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRL",103,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",104,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRL",105,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRL",106,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRL",107,0)
 ..D TMPBLD
"RTN","PSOORRL",108,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRL",109,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRL",110,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",111,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",112,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRL",113,0)
 ..D TMPBLD
"RTN","PSOORRL",114,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRL",115,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",116,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRL",117,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",118,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",119,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRL",120,0)
 ..D TMPBLD
"RTN","PSOORRL",121,0)
 Q
"RTN","PSOORRL",122,0)
TMPBLD S TFN=$G(TFN)+1,^TMP("PS",$J,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRL",123,0)
 S $P(^TMP("PS",$J,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRL",124,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=1,^TMP("PS",$J,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRL",125,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=1,^TMP("PS",$J,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRL",126,0)
 Q
"VER")
8.0^22.0
"BLD",5570,6)
^210
**END**
**END**
