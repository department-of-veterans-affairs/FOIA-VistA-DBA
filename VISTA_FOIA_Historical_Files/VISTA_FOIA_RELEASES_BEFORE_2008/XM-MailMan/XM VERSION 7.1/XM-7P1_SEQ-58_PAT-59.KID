Released XM*7.1*59 SEQ #58
Extracted from mail message
**KIDS**:XM*7.1*59^

**INSTALL NAME**
XM*7.1*59
"BLD",39,0)
XM*7.1*59^MAILMAN^0^2980326^y
"BLD",39,1,0)
^^57^57^2980326^^^^
"BLD",39,1,1,0)
MailMan patch XM*7.1*59 addresses problems caused during remote transmission
"BLD",39,1,2,0)
when a message's 'from' address contains illegal characters.
"BLD",39,1,3,0)

"BLD",39,1,4,0)
This patch only addresses locally originating messages which are sent to
"BLD",39,1,5,0)
remote sites.
"BLD",39,1,6,0)

"BLD",39,1,7,0)
As the message is being transmitted to the remote site, MailMan examines
"BLD",39,1,8,0)
the 'from' string.
"BLD",39,1,9,0)
If the 'from' string is enclosed in "<>", the "<>" are stripped off.
"BLD",39,1,10,0)
If the 'from' string contains illegal characters, the 'from' string will be
"BLD",39,1,11,0)
enclosed in quotes.
"BLD",39,1,12,0)

"BLD",39,1,13,0)
The local site will not see the change in the 'from' string.
"BLD",39,1,14,0)
The receiving site will see the change.
"BLD",39,1,15,0)

"BLD",39,1,16,0)
For example:
"BLD",39,1,17,0)

"BLD",39,1,18,0)
'National Patch Module'     will become     '"National Patch Module"'
"BLD",39,1,19,0)
'<Patient Feedback Pkg>'    will become     '"Patient Feedback Pkg"'
"BLD",39,1,20,0)

"BLD",39,1,21,0)
Messages from users will continue to be treated as usual.  That is, if the
"BLD",39,1,22,0)
user's name contains ',' or ' ', all ', .' will become '._+'.
"BLD",39,1,23,0)
If the user's name contains any other illegal characters, such as '()',
"BLD",39,1,24,0)
the entire user's name will be enclosed in quotes.
"BLD",39,1,25,0)

"BLD",39,1,26,0)
===========================================================================
"BLD",39,1,27,0)
This patch should be installed after-hours, when user activity is at a
"BLD",39,1,28,0)
minimum.  You should put the XMUSER option out of order. The filers should
"BLD",39,1,29,0)
be shut down.
"BLD",39,1,30,0)
===========================================================================
"BLD",39,1,31,0)

"BLD",39,1,32,0)
INSTALLATION:
"BLD",39,1,33,0)
1.  DSM Sites: If any of these routines is mapped, disable mapping for the 
"BLD",39,1,34,0)
    affected routine(s).  
"BLD",39,1,35,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads 
"BLD",39,1,36,0)
    the patch into a Transport Global on your system.  
"BLD",39,1,37,0)
3.  On the KIDS:Installation menu, use the following options to install the 
"BLD",39,1,38,0)
    Transport Global: 
"BLD",39,1,39,0)
       Verify Checksums in Transport Global 
"BLD",39,1,40,0)
       Print Transport Global 
"BLD",39,1,41,0)
       Compare Transport Global to Current System 
"BLD",39,1,42,0)
       Backup a Transport Global 
"BLD",39,1,43,0)
       Install Package(s) 
"BLD",39,1,44,0)
4.  DSM Sites: After patch has installed, rebuild your map set.  
"BLD",39,1,45,0)

"BLD",39,1,46,0)
============================================================================ 
"BLD",39,1,47,0)
  
"BLD",39,1,48,0)
ROUTINES:
"BLD",39,1,49,0)
The second line of the routine now looks like:
"BLD",39,1,50,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",39,1,51,0)
 
"BLD",39,1,52,0)
              Before          After
"BLD",39,1,53,0)
Name          Checksum        Checksum        Patch List
"BLD",39,1,54,0)
----------------------------------------------------------
"BLD",39,1,55,0)
XMSMAIL        4652921         5893340        59
"BLD",39,1,56,0)
* Checksums produced by CHECK^XTSUMBLD
"BLD",39,1,57,0)
============================================================================
"BLD",39,4,0)
^9.64PA^^0
"BLD",39,"INI")

"BLD",39,"INIT")

"BLD",39,"KRN",0)
^9.67PA^19^12
"BLD",39,"KRN",.4,0)
.4
"BLD",39,"KRN",.401,0)
.401
"BLD",39,"KRN",.402,0)
.402
"BLD",39,"KRN",.403,0)
.403
"BLD",39,"KRN",.5,0)
.5
"BLD",39,"KRN",.84,0)
.84
"BLD",39,"KRN",3.6,0)
3.6
"BLD",39,"KRN",3.8,0)
3.8
"BLD",39,"KRN",9.2,0)
9.2
"BLD",39,"KRN",9.8,0)
9.8
"BLD",39,"KRN",9.8,"NM",0)
^9.68A^7^1
"BLD",39,"KRN",9.8,"NM",7,0)
XMSMAIL^^0^B10399951
"BLD",39,"KRN",9.8,"NM","B","XMSMAIL",7)

"BLD",39,"KRN",19,0)
19
"BLD",39,"KRN",19,"NM",0)
^9.68A^^0
"BLD",39,"KRN",19.1,0)
19.1
"BLD",39,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",39,"KRN","B",.4,.4)

"BLD",39,"KRN","B",.401,.401)

"BLD",39,"KRN","B",.402,.402)

"BLD",39,"KRN","B",.403,.403)

"BLD",39,"KRN","B",.5,.5)

"BLD",39,"KRN","B",.84,.84)

"BLD",39,"KRN","B",3.6,3.6)

"BLD",39,"KRN","B",3.8,3.8)

"BLD",39,"KRN","B",9.2,9.2)

"BLD",39,"KRN","B",9.8,9.8)

"BLD",39,"KRN","B",19,19)

"BLD",39,"KRN","B",19.1,19.1)

"BLD",39,"QUES",0)
^9.62^^
"BLD",39,"REQB",0)
^9.611^^
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
59^2980326
"PKG",6,22,1,"PAH",1,1,0)
^^57^57^2980326
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan patch XM*7.1*59 addresses problems caused during remote transmission
"PKG",6,22,1,"PAH",1,1,2,0)
when a message's 'from' address contains illegal characters.
"PKG",6,22,1,"PAH",1,1,3,0)

"PKG",6,22,1,"PAH",1,1,4,0)
This patch only addresses locally originating messages which are sent to
"PKG",6,22,1,"PAH",1,1,5,0)
remote sites.
"PKG",6,22,1,"PAH",1,1,6,0)

"PKG",6,22,1,"PAH",1,1,7,0)
As the message is being transmitted to the remote site, MailMan examines
"PKG",6,22,1,"PAH",1,1,8,0)
the 'from' string.
"PKG",6,22,1,"PAH",1,1,9,0)
If the 'from' string is enclosed in "<>", the "<>" are stripped off.
"PKG",6,22,1,"PAH",1,1,10,0)
If the 'from' string contains illegal characters, the 'from' string will be
"PKG",6,22,1,"PAH",1,1,11,0)
enclosed in quotes.
"PKG",6,22,1,"PAH",1,1,12,0)

"PKG",6,22,1,"PAH",1,1,13,0)
The local site will not see the change in the 'from' string.
"PKG",6,22,1,"PAH",1,1,14,0)
The receiving site will see the change.
"PKG",6,22,1,"PAH",1,1,15,0)

"PKG",6,22,1,"PAH",1,1,16,0)
For example:
"PKG",6,22,1,"PAH",1,1,17,0)

"PKG",6,22,1,"PAH",1,1,18,0)
'National Patch Module'     will become     '"National Patch Module"'
"PKG",6,22,1,"PAH",1,1,19,0)
'<Patient Feedback Pkg>'    will become     '"Patient Feedback Pkg"'
"PKG",6,22,1,"PAH",1,1,20,0)

"PKG",6,22,1,"PAH",1,1,21,0)
Messages from users will continue to be treated as usual.  That is, if the
"PKG",6,22,1,"PAH",1,1,22,0)
user's name contains ',' or ' ', all ', .' will become '._+'.
"PKG",6,22,1,"PAH",1,1,23,0)
If the user's name contains any other illegal characters, such as '()',
"PKG",6,22,1,"PAH",1,1,24,0)
the entire user's name will be enclosed in quotes.
"PKG",6,22,1,"PAH",1,1,25,0)

"PKG",6,22,1,"PAH",1,1,26,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,27,0)
This patch should be installed after-hours, when user activity is at a
"PKG",6,22,1,"PAH",1,1,28,0)
minimum.  You should put the XMUSER option out of order. The filers should
"PKG",6,22,1,"PAH",1,1,29,0)
be shut down.
"PKG",6,22,1,"PAH",1,1,30,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,31,0)

"PKG",6,22,1,"PAH",1,1,32,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,33,0)
1.  DSM Sites: If any of these routines is mapped, disable mapping for the 
"PKG",6,22,1,"PAH",1,1,34,0)
    affected routine(s).  
"PKG",6,22,1,"PAH",1,1,35,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads 
"PKG",6,22,1,"PAH",1,1,36,0)
    the patch into a Transport Global on your system.  
"PKG",6,22,1,"PAH",1,1,37,0)
3.  On the KIDS:Installation menu, use the following options to install the 
"PKG",6,22,1,"PAH",1,1,38,0)
    Transport Global: 
"PKG",6,22,1,"PAH",1,1,39,0)
       Verify Checksums in Transport Global 
"PKG",6,22,1,"PAH",1,1,40,0)
       Print Transport Global 
"PKG",6,22,1,"PAH",1,1,41,0)
       Compare Transport Global to Current System 
"PKG",6,22,1,"PAH",1,1,42,0)
       Backup a Transport Global 
"PKG",6,22,1,"PAH",1,1,43,0)
       Install Package(s) 
"PKG",6,22,1,"PAH",1,1,44,0)
4.  DSM Sites: After patch has installed, rebuild your map set.  
"PKG",6,22,1,"PAH",1,1,45,0)

"PKG",6,22,1,"PAH",1,1,46,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,47,0)
  
"PKG",6,22,1,"PAH",1,1,48,0)
ROUTINES:
"PKG",6,22,1,"PAH",1,1,49,0)
The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,50,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,51,0)
 
"PKG",6,22,1,"PAH",1,1,52,0)
              Before          After
"PKG",6,22,1,"PAH",1,1,53,0)
Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,54,0)
----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,55,0)
XMSMAIL        4652921         5893340        59
"PKG",6,22,1,"PAH",1,1,56,0)
* Checksums produced by CHECK^XTSUMBLD
"PKG",6,22,1,"PAH",1,1,57,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XMSMAIL")
0^7^B10399951
"RTN","XMSMAIL",1,0)
XMSMAIL ;(WASH ISC)/THM/CAP-SMTP TRANSMITTER ;03/26/98  12:56
"RTN","XMSMAIL",2,0)
V ;;7.1;MailMan;**59**;Jun 02, 1994
"RTN","XMSMAIL",3,0)
MAIL ;SEND MAIL
"RTN","XMSMAIL",4,0)
 S %DT="T",X="N" D ^%DT
"RTN","XMSMAIL",5,0)
 S XMR=^XMB(3.9,XMZ,0),XMD=Y,XMPOST=20,XMFROM=$P(XMR,U,2)
"RTN","XMSMAIL",6,0)
 I $F(XMFROM,"@"_^XMB("NETNAME"))>$L(XMFROM) S XMFROM=$P(XMFROM,"@"_^XMB("NETNAME"))
"RTN","XMSMAIL",7,0)
 I XMFROM'["@" D
"RTN","XMSMAIL",8,0)
 . S X=XMFROM
"RTN","XMSMAIL",9,0)
 . I +X=X D
"RTN","XMSMAIL",10,0)
 . . ; Use Mail Name.  Lacking that, use real name.
"RTN","XMSMAIL",11,0)
 . . S X=$S($P($G(^XMB(3.7,X,.3)),U)'="":$P(^(.3),U),1:$P(^VA(200,X,0),U))
"RTN","XMSMAIL",12,0)
 . . I $E(X)=$C(34),$E(X,$L(X))=$C(34) Q  ; Ignore if quoted
"RTN","XMSMAIL",13,0)
 . . I X?.E1C.E!($TR(X,$C(34)_"<>()[];:")'=X) S X=$C(34)_X_$C(34) Q  ; Quote if illegal
"RTN","XMSMAIL",14,0)
 . . I X[","!(X[" ") S X=$TR(X,", .","._+")  ; Translate
"RTN","XMSMAIL",15,0)
 . E  I $E(X)'=$C(34),$E(X,$L(X))'=$C(34) D
"RTN","XMSMAIL",16,0)
 . . I $E(X)="<",$E(X,$L(X))=">" D  I $E(X)=$C(34),$E(X,$L(X))=$C(34) Q
"RTN","XMSMAIL",17,0)
 . . . S X=$E(X,2,$L(X)-1)
"RTN","XMSMAIL",18,0)
 . . I X?.E1C.E!($TR(X,$C(34)_" ,<>()[];:")'=X) S X=$C(34)_X_$C(34) ; Quote if illegal
"RTN","XMSMAIL",19,0)
 . S XMFROM="<"_X_"@"_^XMB("NETNAME")_">"
"RTN","XMSMAIL",20,0)
 S XMSG="MAIL FROM:"_XMFROM X XMSEN Q:ER
"RTN","XMSMAIL",21,0)
 I 'XMBT S XMSTIME=300 X XMREC K XMSTIME Q:ER
"RTN","XMSMAIL",22,0)
 I XMBT S XMRG="200 ID:Batch"
"RTN","XMSMAIL",23,0)
 I 'XMBT,$E(XMRG)'=2 D MAILNO^XMSERR,TRASH^XMS S ER=0 Q
"RTN","XMSMAIL",24,0)
 S XMRZ=$P(XMRG,"ID:",2)
"RTN","XMSMAIL",25,0)
LOCK G:'$D(^XMB(3.9,XMZ,4)) RCPT S XMLOCK=^(4),XMSG="LOCK "_XMLOCK X XMSEN Q:ER
"RTN","XMSMAIL",26,0)
 X:'XMBT XMREC Q:ER  I 'XMBT,$E(XMRG)'=2 G LOCKNO^XMSERR
"RTN","XMSMAIL",27,0)
RCPT ;IDENTIFY RECIPIENTS
"RTN","XMSMAIL",28,0)
 S J=0 I $G(XMSDOM) S XMINST=XMSDOM
"RTN","XMSMAIL",29,0)
 D R1 Q:ER  G RESET^XMS:$O(XMJ(0))="",GO^XMS0
"RTN","XMSMAIL",30,0)
R1 ;ENTRY FROM XMSM
"RTN","XMSMAIL",31,0)
 S J=$O(^XMB(3.9,XMZ,1,"AQUEUE",XMINST,J)) Q:'J
"RTN","XMSMAIL",32,0)
 S XMDES=$G(^XMB(3.9,XMZ,1,J,0)) G R1:$P(XMDES,U,7)'=XMINST
"RTN","XMSMAIL",33,0)
 I $G(XMR)="" S XMR=^XMB(3.9,XMZ,0)
"RTN","XMSMAIL",34,0)
 S (Y,XMDER)=$P(XMDES,U),%=$P($P(XMR,U,2),"@",2)
"RTN","XMSMAIL",35,0)
 I $P(Y,"@",2)=$S($L(%):%,1:^XMB("NETNAME")) S $P(XMDES,U,6,7)="^",^XMB(3.9,XMZ,1,J,0)=XMDES G R1
"RTN","XMSMAIL",36,0)
 S Y=$P(Y,"@") I $S($G(XMVA)>4:1,'$G(XMVA):1,1:0) S:Y["," Y=$TR(Y,", .","._+")
"RTN","XMSMAIL",37,0)
 F %=1:1 Q:Y'?.E1C.E  I $E(Y,%)?1C S Y=$E(Y,1,%-1)_$E(Y,%+1,999),%=%-1
"RTN","XMSMAIL",38,0)
 G R2:Y?.A I $E(Y)=$C(34) G R2:$E(Y,$L(Y))=$C(34)
"RTN","XMSMAIL",39,0)
 I Y["," S Y=$P(Y,",")_"."_$P($P(Y,",",2)," ")
"RTN","XMSMAIL",40,0)
 ;Allowed punctuation (without quoting rcpt name is .%_-@+!
"RTN","XMSMAIL",41,0)
 S X=$TR(Y,"()<>@,;:\[]"_$C(34),"") G R:X=Y
"RTN","XMSMAIL",42,0)
 ;
"RTN","XMSMAIL",43,0)
 ;Reformat name for \ and " characters
"RTN","XMSMAIL",44,0)
 S %=-1
"RTN","XMSMAIL",45,0)
S S %=$F(Y,"\",%+2) I % S Y=$E(Y,1,%-2)_"\"_$E(Y,%,$L(Y)) G S
"RTN","XMSMAIL",46,0)
 S %=-1
"RTN","XMSMAIL",47,0)
D S %=$F(Y,"""",%+2) I % S Y=$E(Y,1,%-2)_"\"_$E(Y,%-1,$L(Y)) G D
"RTN","XMSMAIL",48,0)
 ;
"RTN","XMSMAIL",49,0)
R S X=Y_"@"_$P(XMDER,"@",2,99)
"RTN","XMSMAIL",50,0)
 S XMDER=X
"RTN","XMSMAIL",51,0)
R2 S XMSG="RCPT TO:<"_XMDER_">" X XMSEN Q:ER
"RTN","XMSMAIL",52,0)
 I 'XMBT S XMSTIME=300 X XMREC K XMSTIME Q:ER
"RTN","XMSMAIL",53,0)
 I XMBT S XMRG="200 In transit"
"RTN","XMSMAIL",54,0)
 I $E(XMRG)=2 S XMJ(J)="" G R1
"RTN","XMSMAIL",55,0)
R3 S XMSUP=$G(XMSUP)+1 I XMSUP<3 S X=XMDER,XMDER=$S(XMSUP=1:$TR(XMDER,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz"),XMSUP=2:$TR(XMDER,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")) G R2:X'=XMDER,R3
"RTN","XMSMAIL",56,0)
 K XMSUP,^XMB(3.9,XMZ,1,"AQUEUE",XMINST,J)
"RTN","XMSMAIL",57,0)
 G ENTR^XMSM
"VER")
8.0^21.0
**END**
**END**
