Released GMRC*3*30 SEQ #29
Extracted from mail message
**KIDS**:GMRC*3.0*30^

**INSTALL NAME**
GMRC*3.0*30
"BLD",4079,0)
GMRC*3.0*30^CONSULT/REQUEST TRACKING^0^3030114^y
"BLD",4079,1,0)
^^2^2^3021206^
"BLD",4079,1,1,0)
Refer to the National Patch Module for complete details of the 
"BLD",4079,1,2,0)
changes/enhancements included in this patch.
"BLD",4079,4,0)
^9.64PA^^
"BLD",4079,"KRN",0)
^9.67PA^8989.52^19
"BLD",4079,"KRN",.4,0)
.4
"BLD",4079,"KRN",.401,0)
.401
"BLD",4079,"KRN",.402,0)
.402
"BLD",4079,"KRN",.403,0)
.403
"BLD",4079,"KRN",.5,0)
.5
"BLD",4079,"KRN",.84,0)
.84
"BLD",4079,"KRN",3.6,0)
3.6
"BLD",4079,"KRN",3.8,0)
3.8
"BLD",4079,"KRN",9.2,0)
9.2
"BLD",4079,"KRN",9.8,0)
9.8
"BLD",4079,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4079,"KRN",9.8,"NM",1,0)
GMRCIERR^^0^B66408009
"BLD",4079,"KRN",9.8,"NM",2,0)
GMRCIBKG^^0^B38705954
"BLD",4079,"KRN",9.8,"NM",3,0)
GMRCIAIT^^0^B9668267
"BLD",4079,"KRN",9.8,"NM",4,0)
GMRCGUIB^^0^B39084188
"BLD",4079,"KRN",9.8,"NM",5,0)
GMRCSTU^^0^B61626713
"BLD",4079,"KRN",9.8,"NM","B","GMRCGUIB",4)

"BLD",4079,"KRN",9.8,"NM","B","GMRCIAIT",3)

"BLD",4079,"KRN",9.8,"NM","B","GMRCIBKG",2)

"BLD",4079,"KRN",9.8,"NM","B","GMRCIERR",1)

"BLD",4079,"KRN",9.8,"NM","B","GMRCSTU",5)

"BLD",4079,"KRN",19,0)
19
"BLD",4079,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4079,"KRN",19,"NM",1,0)
GMRC IFC INC RPT^^0
"BLD",4079,"KRN",19,"NM","B","GMRC IFC INC RPT",1)

"BLD",4079,"KRN",19.1,0)
19.1
"BLD",4079,"KRN",101,0)
101
"BLD",4079,"KRN",409.61,0)
409.61
"BLD",4079,"KRN",771,0)
771
"BLD",4079,"KRN",870,0)
870
"BLD",4079,"KRN",8989.51,0)
8989.51
"BLD",4079,"KRN",8989.52,0)
8989.52
"BLD",4079,"KRN",8994,0)
8994
"BLD",4079,"KRN","B",.4,.4)

"BLD",4079,"KRN","B",.401,.401)

"BLD",4079,"KRN","B",.402,.402)

"BLD",4079,"KRN","B",.403,.403)

"BLD",4079,"KRN","B",.5,.5)

"BLD",4079,"KRN","B",.84,.84)

"BLD",4079,"KRN","B",3.6,3.6)

"BLD",4079,"KRN","B",3.8,3.8)

"BLD",4079,"KRN","B",9.2,9.2)

"BLD",4079,"KRN","B",9.8,9.8)

"BLD",4079,"KRN","B",19,19)

"BLD",4079,"KRN","B",19.1,19.1)

"BLD",4079,"KRN","B",101,101)

"BLD",4079,"KRN","B",409.61,409.61)

"BLD",4079,"KRN","B",771,771)

"BLD",4079,"KRN","B",870,870)

"BLD",4079,"KRN","B",8989.51,8989.51)

"BLD",4079,"KRN","B",8989.52,8989.52)

"BLD",4079,"KRN","B",8994,8994)

"BLD",4079,"QUES",0)
^9.62^^
"BLD",4079,"REQB",0)
^9.611^2^2
"BLD",4079,"REQB",1,0)
GMRC*3.0*28^2
"BLD",4079,"REQB",2,0)
GMRC*3.0*29^2
"BLD",4079,"REQB","B","GMRC*3.0*28",1)

"BLD",4079,"REQB","B","GMRC*3.0*29",2)

"KRN",19,9030,-1)
0^1
"KRN",19,9030,0)
GMRC IFC INC RPT^Print All Incomplete IFC Transactions^^R^^^^^^^^CONSULT/REQUEST TRACKING^^^
"KRN",19,9030,1,0)
^19.06^2^2^3021218^^^^
"KRN",19,9030,1,1,0)
This option will print all incomplete IFC transactions sorted by Consult 
"KRN",19,9030,1,2,0)
number.
"KRN",19,9030,15)

"KRN",19,9030,20)

"KRN",19,9030,25)
EN^GMRCIAIT
"KRN",19,9030,"U")
PRINT ALL INCOMPLETE IFC TRANS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^13
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
30^3030114
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3030114
"PKG",128,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module for complete details of the 
"PKG",128,22,1,"PAH",1,1,2,0)
changes/enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMRCGUIB")
0^4^B39084188
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA - GUI actions for consults ;11/15/02 07:31
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20,17,22,29,30**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",22,0)
 D ^DIE
"RTN","GMRCGUIB",23,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",24,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",25,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",26,0)
 ;
"RTN","GMRCGUIB",27,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCGUIB",28,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCGUIB",29,0)
 ;
"RTN","GMRCGUIB",30,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",31,0)
 Q
"RTN","GMRCGUIB",32,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult 
"RTN","GMRCGUIB",33,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",34,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",35,0)
 ; GMRCADUZ = array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",36,0)
 ; GMRCWHO = IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",37,0)
 ; GMRCWHN = date time of activity in FM format
"RTN","GMRCGUIB",38,0)
 ;
"RTN","GMRCGUIB",39,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN,GMRCTM,GMRCRP,GMRCUPD
"RTN","GMRCGUIB",40,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",41,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",42,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",43,0)
 D  ;update LAST ACTION field even though no status change
"RTN","GMRCGUIB",44,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCGUIB",45,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCGUIB",46,0)
 . D STATUS^GMRCP
"RTN","GMRCGUIB",47,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",48,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",49,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",50,0)
 S GMRCRP=+$P(^GMR(123,GMRCO,0),U,14)
"RTN","GMRCGUIB",51,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",52,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCGUIB",53,0)
 . S GMRCTM=1
"RTN","GMRCGUIB",54,0)
 I GMRCUPD D  ; alert ord. prov if update users takes action
"RTN","GMRCGUIB",55,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",56,0)
 I '$G(GMRCTM),'GMRCUPD D  ;alert both if not ord. prov or update user
"RTN","GMRCGUIB",57,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",58,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,$G(GMRCTM))
"RTN","GMRCGUIB",59,0)
 Q
"RTN","GMRCGUIB",60,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",61,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",62,0)
 ;Input variables:
"RTN","GMRCGUIB",63,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",64,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",65,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",66,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",67,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",68,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",69,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",70,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",71,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",72,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",73,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",74,0)
 ;
"RTN","GMRCGUIB",75,0)
 ;Output:
"RTN","GMRCGUIB",76,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred
"RTN","GMRCGUIB",77,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",78,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",79,0)
 ;
"RTN","GMRCGUIB",80,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",81,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",82,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",83,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",84,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",85,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",86,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",87,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",88,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",89,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",90,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",91,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",92,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",93,0)
 .Q
"RTN","GMRCGUIB",94,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",95,0)
 .N I
"RTN","GMRCGUIB",96,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",97,0)
 .Q
"RTN","GMRCGUIB",98,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",99,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",100,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",101,0)
 .Q
"RTN","GMRCGUIB",102,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",103,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",104,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",105,0)
 .N DA
"RTN","GMRCGUIB",106,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",107,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",108,0)
 .Q
"RTN","GMRCGUIB",109,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",110,0)
 ;
"RTN","GMRCGUIB",111,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",112,0)
 ;
"RTN","GMRCGUIB",113,0)
 I $S(GMRCA=10:1,(GMRCA=4&($P(^GMR(123,GMRCO,0),U,12)=2)):1,1:0) D
"RTN","GMRCGUIB",114,0)
 . D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",115,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",116,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",117,0)
 ;
"RTN","GMRCGUIB",118,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",119,0)
 ; Input variables:
"RTN","GMRCGUIB",120,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",121,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",122,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",123,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",124,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",125,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",126,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",127,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",128,0)
 ;
"RTN","GMRCGUIB",129,0)
 ;Output:
"RTN","GMRCGUIB",130,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",131,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",132,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",133,0)
        ;
"RTN","GMRCGUIB",134,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",135,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",136,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",137,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",138,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",139,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",140,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",141,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",142,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",143,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",144,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",145,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",146,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",147,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",148,0)
 D  ;send alerts
"RTN","GMRCGUIB",149,0)
 . N TXT
"RTN","GMRCGUIB",150,0)
 . S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",151,0)
 . I $P(^GMR(123,+GMRCO,0),U,14) S GMRCADUZ($P(^(0),U,14))=""
"RTN","GMRCGUIB",152,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",153,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",154,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",155,0)
DOCLIST(GMRCAR,GMRCDA,GMRCMED)  ;return list of linked results
"RTN","GMRCGUIB",156,0)
 ; Input:
"RTN","GMRCGUIB",157,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",158,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",159,0)
 ;  GMRCMED- 1 = include med results; 0 = only TIU docs
"RTN","GMRCGUIB",160,0)
 ;
"RTN","GMRCGUIB",161,0)
 ; Output:
"RTN","GMRCGUIB",162,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",163,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",164,0)
 ;       GMRCAR(50,1)="ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCGUIB",165,0)
 ;       GMRCAR(50,2)="ien;global ref,"
"RTN","GMRCGUIB",166,0)
 ;
"RTN","GMRCGUIB",167,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",168,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",169,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",170,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",171,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCGUIB",172,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCGUIB",173,0)
 . I RES["MCAR" D
"RTN","GMRCGUIB",174,0)
 .. N ARR,STR
"RTN","GMRCGUIB",175,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCGUIB",176,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCGUIB",177,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCGUIB",178,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCGUIB",179,0)
 . S CNT=CNT+1
"RTN","GMRCGUIB",180,0)
 Q
"RTN","GMRCIAIT")
0^3^B9668267
"RTN","GMRCIAIT",1,0)
GMRCIAIT ;SLC/JFR - PRINT ALL INC. IFC TRANSACTIONS; 12/18/02 09:11
"RTN","GMRCIAIT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**30**;DEC 27, 1997
"RTN","GMRCIAIT",3,0)
EN ; get the device to use
"RTN","GMRCIAIT",4,0)
 N %ZIS,POP
"RTN","GMRCIAIT",5,0)
 S %ZIS="QM" D ^%ZIS
"RTN","GMRCIAIT",6,0)
 I POP D HOME^%ZIS Q
"RTN","GMRCIAIT",7,0)
 I $D(IO("Q")) D  D ^%ZISC,HOME^%ZIS Q
"RTN","GMRCIAIT",8,0)
 . N ZTRTN,ZTSK,ZTIO,ZTDTH,ZTDESC
"RTN","GMRCIAIT",9,0)
 . S ZTRTN="RPT^GMRCIAIT",ZTDESC="Incomplete IFC Transaction report"
"RTN","GMRCIAIT",10,0)
 . S ZTIO=ION,ZTDTH=$H
"RTN","GMRCIAIT",11,0)
 . D ^%ZTLOAD
"RTN","GMRCIAIT",12,0)
 . I $G(ZTSK) W !,"Queued to Print, Task # ",ZTSK
"RTN","GMRCIAIT",13,0)
 . E  W !,"Sorry, Try again Later"
"RTN","GMRCIAIT",14,0)
 D RPT
"RTN","GMRCIAIT",15,0)
 D ^%ZISC,HOME^%ZIS
"RTN","GMRCIAIT",16,0)
 Q
"RTN","GMRCIAIT",17,0)
RPT ; sort logic
"RTN","GMRCIAIT",18,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCIAIT",19,0)
 U IO
"RTN","GMRCIAIT",20,0)
 N GMRCDA,GMRCPAGE,GMRCQT
"RTN","GMRCIAIT",21,0)
 S GMRCDA=0,GMRCPAGE=1
"RTN","GMRCIAIT",22,0)
 I '$O(^GMR(123.6,"AC",GMRCDA)) D HDR(.GMRCPAGE),NOREC Q
"RTN","GMRCIAIT",23,0)
 D HDR(.GMRCPAGE)
"RTN","GMRCIAIT",24,0)
 F  S GMRCDA=$O(^GMR(123.6,"AC",GMRCDA)) Q:'GMRCDA!($D(GMRCQT))  D
"RTN","GMRCIAIT",25,0)
 . I $Y>(IOSL-9) D  Q:$D(GMRCQT)
"RTN","GMRCIAIT",26,0)
 .. N DIR,DIRUT,DIROUT,DUOUT,DTOUT
"RTN","GMRCIAIT",27,0)
 .. ;W !
"RTN","GMRCIAIT",28,0)
 .. I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR
"RTN","GMRCIAIT",29,0)
 .. I $D(DIRUT) S GMRCQT=1 Q
"RTN","GMRCIAIT",30,0)
 .. D HDR(.GMRCPAGE)
"RTN","GMRCIAIT",31,0)
 . W !!,?11,"CONSULT/REQUEST #: ",GMRCDA
"RTN","GMRCIAIT",32,0)
 . N GMRCACT,GMRCLOG
"RTN","GMRCIAIT",33,0)
 . S GMRCACT=0
"RTN","GMRCIAIT",34,0)
 . F  S GMRCACT=$O(^GMR(123.6,"AC",GMRCDA,GMRCACT)) Q:'GMRCACT!($D(GMRCQT))  D
"RTN","GMRCIAIT",35,0)
 .. S GMRCLOG=$O(^GMR(123.6,"AC",GMRCDA,GMRCACT,1,0)) Q:'GMRCLOG
"RTN","GMRCIAIT",36,0)
 .. I $Y>(IOSL-8) D  Q:$D(GMRCQT)
"RTN","GMRCIAIT",37,0)
 ... N DIR,DIRUT,DIROUT,DUOUT,DTOUT
"RTN","GMRCIAIT",38,0)
 ... ;W !
"RTN","GMRCIAIT",39,0)
 ... I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR
"RTN","GMRCIAIT",40,0)
 ... I $D(DIRUT) S GMRCQT=1 Q
"RTN","GMRCIAIT",41,0)
 ... D HDR(.GMRCPAGE)
"RTN","GMRCIAIT",42,0)
 .. D PRTLOG(GMRCLOG,GMRCDA,GMRCACT)
"RTN","GMRCIAIT",43,0)
 .. Q
"RTN","GMRCIAIT",44,0)
 . Q
"RTN","GMRCIAIT",45,0)
 Q
"RTN","GMRCIAIT",46,0)
PRTLOG(LOG,CSLT,ACTVT) ;print the formatted entry
"RTN","GMRCIAIT",47,0)
 ;
"RTN","GMRCIAIT",48,0)
 ; Input:
"RTN","GMRCIAIT",49,0)
 ;   LOG   = ien from file 123.6
"RTN","GMRCIAIT",50,0)
 ;   CSLT  = ien from file 123 associated with LOG
"RTN","GMRCIAIT",51,0)
 ;   ACTVT = activity within CSLT that is incomplete
"RTN","GMRCIAIT",52,0)
 ;
"RTN","GMRCIAIT",53,0)
 N GMRCMSG,GMRCPT,GMRCSSN,GMRCERR,GMRCDT
"RTN","GMRCIAIT",54,0)
 N GMRCFAC,GMRCSER,GMRCTRAN,GMRCLOG0,GMRCDTR
"RTN","GMRCIAIT",55,0)
 S GMRCLOG0=$G(^GMR(123.6,LOG,0)) I '$L(GMRCLOG0) Q
"RTN","GMRCIAIT",56,0)
 S GMRCDT=$$FMTE^XLFDT($P(GMRCLOG0,U),2)
"RTN","GMRCIAIT",57,0)
 S GMRCFAC=$$GET1^DIQ(4,$P(GMRCLOG0,U,2),.01)
"RTN","GMRCIAIT",58,0)
 S GMRCMSG=$P(GMRCLOG0,U,3)
"RTN","GMRCIAIT",59,0)
 S GMRCTRAN=$P(GMRCLOG0,U,7)
"RTN","GMRCIAIT",60,0)
 S GMRCERR=$$GET1^DIQ(123.6,LOG,.08)
"RTN","GMRCIAIT",61,0)
 S GMRCSER=$$GET1^DIQ(123,CSLT,1)
"RTN","GMRCIAIT",62,0)
 S GMRCPT=$$GET1^DIQ(123,CSLT,.02,"I")
"RTN","GMRCIAIT",63,0)
 S GMRCDTR=$$FMTE^XLFDT($$GET1^DIQ(123,CSLT,.01,"I"),2)
"RTN","GMRCIAIT",64,0)
 S GMRCSSN=$$GET1^DIQ(2,GMRCPT,.09)
"RTN","GMRCIAIT",65,0)
 S GMRCPT=$$GET1^DIQ(2,GMRCPT,.01)
"RTN","GMRCIAIT",66,0)
 W !!,?2,"Date/Time last transmitted: ",GMRCDT
"RTN","GMRCIAIT",67,0)
 W ?51,"Trans. attempts: ",GMRCTRAN
"RTN","GMRCIAIT",68,0)
 W !,?2,"Facility: ",GMRCFAC,?51,"Message: ",GMRCMSG
"RTN","GMRCIAIT",69,0)
 W !,?2,"Consult #: ",CSLT,?51,"Activity: ",ACTVT
"RTN","GMRCIAIT",70,0)
 W !,?2,"Patient name: ",GMRCPT,?51,"SSN: ",GMRCSSN
"RTN","GMRCIAIT",71,0)
 W !,?2,"Ordered Service: ",$E(GMRCSER,1,31),?51,"Req. date: ",GMRCDTR
"RTN","GMRCIAIT",72,0)
 W !,?2,"Error: ",GMRCERR
"RTN","GMRCIAIT",73,0)
 Q
"RTN","GMRCIAIT",74,0)
NOREC ; print the no records found message
"RTN","GMRCIAIT",75,0)
 W !,?5,"No incomplete IFC Transactions to report",!
"RTN","GMRCIAIT",76,0)
 Q
"RTN","GMRCIAIT",77,0)
HDR(PAGE) ; print the page hdr and increment page number
"RTN","GMRCIAIT",78,0)
 ;
"RTN","GMRCIAIT",79,0)
 W @IOF
"RTN","GMRCIAIT",80,0)
 W "Incomplete IFC Transaction Report"
"RTN","GMRCIAIT",81,0)
 W ?44,$$FMTE^XLFDT($$NOW^XLFDT),?69,"Page: ",PAGE
"RTN","GMRCIAIT",82,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCIAIT",83,0)
 S PAGE=PAGE+1
"RTN","GMRCIAIT",84,0)
 Q
"RTN","GMRCIBKG")
0^2^B38705954
"RTN","GMRCIBKG",1,0)
GMRCIBKG ;SLC/JFR - IFC BACKGROUND ERROR PROCESSOR; 10/29/02 09:20
"RTN","GMRCIBKG",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**22,28,30**;DEC 27, 1997
"RTN","GMRCIBKG",3,0)
 ;
"RTN","GMRCIBKG",4,0)
 ; This routine invokes IA# 3335
"RTN","GMRCIBKG",5,0)
 ;
"RTN","GMRCIBKG",6,0)
EN ;process file 123.6 and take action
"RTN","GMRCIBKG",7,0)
 ;Start background process
"RTN","GMRCIBKG",8,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCIBKG",9,0)
 ;
"RTN","GMRCIBKG",10,0)
 ; OK to run?
"RTN","GMRCIBKG",11,0)
 I '$$GONOGO Q
"RTN","GMRCIBKG",12,0)
 ;
"RTN","GMRCIBKG",13,0)
 ; set start param to NOW and run
"RTN","GMRCIBKG",14,0)
 D EN^XPAR("SYS","GMRC IFC BACKGROUND START",1,$$NOW^XLFDT)
"RTN","GMRCIBKG",15,0)
 ;
"RTN","GMRCIBKG",16,0)
 N GMRCLOG,GMRCTIM,GMRCLOG0
"RTN","GMRCIBKG",17,0)
 S GMRCLOG=0
"RTN","GMRCIBKG",18,0)
 S GMRCTIM=$$FMADD^XLFDT($$NOW^XLFDT,,-1)
"RTN","GMRCIBKG",19,0)
 F  S GMRCLOG=$O(^GMR(123.6,GMRCLOG)) Q:'GMRCLOG  D
"RTN","GMRCIBKG",20,0)
 . S GMRCLOG0=$G(^GMR(123.6,GMRCLOG,0))
"RTN","GMRCIBKG",21,0)
 . ;
"RTN","GMRCIBKG",22,0)
 . ;  v-- resend if couldn't update file immediately
"RTN","GMRCIBKG",23,0)
 . I $P(GMRCLOG0,U,6),$P(GMRCLOG0,U,8)=901 D  Q
"RTN","GMRCIBKG",24,0)
 .. D TRIGR^GMRCIEVT($P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5)) ;re-send activity
"RTN","GMRCIBKG",25,0)
 . ;  v-- wait at least 1 hour on all other errors
"RTN","GMRCIBKG",26,0)
 . I $P(GMRCLOG0,U)>GMRCTIM Q
"RTN","GMRCIBKG",27,0)
 . ;  v-- if incomplete activity is now the earliest, resend it
"RTN","GMRCIBKG",28,0)
 . I $P(GMRCLOG0,U,6),$P(GMRCLOG0,U,8)=902 D  Q
"RTN","GMRCIBKG",29,0)
 .. Q:$O(^GMR(123.6,"AC",$P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5)),-1)
"RTN","GMRCIBKG",30,0)
 .. D DELALRT(GMRCLOG)
"RTN","GMRCIBKG",31,0)
 .. D TRIGR^GMRCIEVT($P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5)) ;re-send activity
"RTN","GMRCIBKG",32,0)
 . ; v-- delete complete entries after # in GMRC RETAIN IFC ACTIVITY DAYS
"RTN","GMRCIBKG",33,0)
 . I '$P(GMRCLOG0,U,6) D  Q
"RTN","GMRCIBKG",34,0)
 .. N DIK,DA,GMRCRETN
"RTN","GMRCIBKG",35,0)
 .. S GMRCRETN=$$GET^XPAR("SYS","GMRC RETAIN IFC ACTIVITY DAYS",1)
"RTN","GMRCIBKG",36,0)
 .. I 'GMRCRETN S GMRCRETN=7
"RTN","GMRCIBKG",37,0)
 .. I $P(GMRCLOG0,U)>$$FMADD^XLFDT(GMRCTIM,(0-GMRCRETN)) Q  ;don't delete
"RTN","GMRCIBKG",38,0)
 .. S DIK="^GMR(123.6,",DA=GMRCLOG
"RTN","GMRCIBKG",39,0)
 .. D ^DIK ;remove old completed entries
"RTN","GMRCIBKG",40,0)
 . ;
"RTN","GMRCIBKG",41,0)
 . ;  v-- resend unknown patient errors after 3 hours
"RTN","GMRCIBKG",42,0)
 . I $P(GMRCLOG0,U,8)=201,GMRCLOG0<$$FMADD^XLFDT($$NOW^XLFDT,,-3) D  Q
"RTN","GMRCIBKG",43,0)
 .. N GMRCSND,GMRCPAR,DOW
"RTN","GMRCIBKG",44,0)
 .. S GMRCPAR=$$GET^XPAR("SYS","GMRC IFC SKIP WEEKEND RE-TRANS",1)
"RTN","GMRCIBKG",45,0)
 .. S DOW=$$DOW^XLFDT(DT,1)
"RTN","GMRCIBKG",46,0)
 .. S GMRCSND=$S('GMRCPAR:1,(+DOW&(DOW<6)):1,1:0)
"RTN","GMRCIBKG",47,0)
 .. I GMRCSND D  ;re-send based on parameter and day of week
"RTN","GMRCIBKG",48,0)
 ... D TRIGR^GMRCIEVT($P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5))
"RTN","GMRCIBKG",49,0)
 .. I '($P(GMRCLOG0,U,7)#8),GMRCSND D
"RTN","GMRCIBKG",50,0)
 ... ;alert CAC's about errors every 24 hrs.
"RTN","GMRCIBKG",51,0)
 ... D DELALRT(GMRCLOG) ;delete previous alerts on same transaction
"RTN","GMRCIBKG",52,0)
 ... D SNDALRT^GMRCIERR(GMRCLOG,"C") ; alert CAC's to patient errors
"RTN","GMRCIBKG",53,0)
 ... D  ; send mail to remote CAC group
"RTN","GMRCIBKG",54,0)
 .... N GMRCLNK,GMRCIQT,HL,HLECH,HLFS,HLQ,PID,DOM,STA,GMRCLNK,OBR
"RTN","GMRCIBKG",55,0)
 .... D INIT^HLFNC2("GMRC IFC ORM EVENT",.HL)
"RTN","GMRCIBKG",56,0)
 .... D  I $D(GMRCIQT) Q  ;build PID seg if nat'l ICN
"RTN","GMRCIBKG",57,0)
 ..... N GMRCDFN S GMRCDFN=$P(^GMR(123,+$P(GMRCLOG0,U,4),0),U,2)
"RTN","GMRCIBKG",58,0)
 ..... I '$G(GMRCDFN) S GMRCIQT=1 Q
"RTN","GMRCIBKG",59,0)
 ..... I $$GETICN^MPIF001(GMRCDFN)<1 S GMRCIQT=1 Q
"RTN","GMRCIBKG",60,0)
 ..... I $$IFLOCAL^MPIF001(GMRCDFN) S GMRCIQT=1 Q
"RTN","GMRCIBKG",61,0)
 ..... S PID=$$EN^VAFCPID(GMRCDFN,"1,2,3,4,5,7,8,19")
"RTN","GMRCIBKG",62,0)
 ..... S PID=$P(PID,"|",2,999)
"RTN","GMRCIBKG",63,0)
 .... D LINK^HLUTIL3($P(GMRCLOG0,U,2),.GMRCLNK)
"RTN","GMRCIBKG",64,0)
 .... S GMRCLNK=$O(GMRCLNK(0)) I 'GMRCLNK Q  ;no link set up
"RTN","GMRCIBKG",65,0)
 .... S DOM=$$GET1^DIQ(870,+GMRCLNK,.03)
"RTN","GMRCIBKG",66,0)
 .... S STA=$$STA^XUAF4($P(GMRCLOG0,U,2))
"RTN","GMRCIBKG",67,0)
 .... S OBR=$E($$OBR^GMRCISG1(+$P(GMRCLOG0,U,4),+$P(GMRCLOG0,U,5)),5,999)
"RTN","GMRCIBKG",68,0)
 .... D PTERRMSG^GMRCIERR(PID,STA,DOM,OBR)
"RTN","GMRCIBKG",69,0)
 . ;
"RTN","GMRCIBKG",70,0)
 . ;  v-- resend local ICN errors after 3 hours
"RTN","GMRCIBKG",71,0)
 . I $P(GMRCLOG0,U,8)=202,GMRCLOG0<$$FMADD^XLFDT($$NOW^XLFDT,,-3) D  Q
"RTN","GMRCIBKG",72,0)
 .. ;re-send based on parameter and day of week
"RTN","GMRCIBKG",73,0)
 .. N GMRCSND,GMRCPAR,DOW
"RTN","GMRCIBKG",74,0)
 .. S GMRCPAR=$$GET^XPAR("SYS","GMRC IFC SKIP WEEKEND RE-TRANS",1)
"RTN","GMRCIBKG",75,0)
 .. S DOW=$$DOW^XLFDT(DT,1)
"RTN","GMRCIBKG",76,0)
 .. S GMRCSND=$S('GMRCPAR:1,(+DOW&(DOW<6)):1,1:0)
"RTN","GMRCIBKG",77,0)
 .. I 'GMRCSND Q  ;don't re-send activity
"RTN","GMRCIBKG",78,0)
 .. D TRIGR^GMRCIEVT($P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5)) ;re-send activity
"RTN","GMRCIBKG",79,0)
 .. I '($P(GMRCLOG0,U,7)#8) D  ;alert CAC's about errors every 24 hrs 
"RTN","GMRCIBKG",80,0)
 ... D DELALRT(GMRCLOG) ;delete previous alerts on same transaction
"RTN","GMRCIBKG",81,0)
 ... D SNDALRT^GMRCIERR(GMRCLOG,"C") ; alert CAC's to patient errors
"RTN","GMRCIBKG",82,0)
 . ;  v-- re-process implementation errors
"RTN","GMRCIBKG",83,0)
 . I $P(GMRCLOG0,U,8)>300,$P(GMRCLOG0,U,8)<702 D  Q
"RTN","GMRCIBKG",84,0)
 .. D DELALRT(GMRCLOG) ;delete previous alerts on same transaction
"RTN","GMRCIBKG",85,0)
 .. D TRIGR^GMRCIEVT($P(GMRCLOG0,U,4),$P(GMRCLOG0,U,5)) ;re-send activity
"RTN","GMRCIBKG",86,0)
 . ;  v-- if incomplete and no error, alert tech group
"RTN","GMRCIBKG",87,0)
 . I '$P(GMRCLOG0,U,8)!($P(GMRCLOG0,U,8)>902) D  Q
"RTN","GMRCIBKG",88,0)
 .. D DELALRT(GMRCLOG) ;delete previous alerts on same transaction
"RTN","GMRCIBKG",89,0)
 .. D SNDALRT^GMRCIERR(GMRCLOG,"T")
"RTN","GMRCIBKG",90,0)
 . Q
"RTN","GMRCIBKG",91,0)
 ;
"RTN","GMRCIBKG",92,0)
 ;  v-- set finish param 
"RTN","GMRCIBKG",93,0)
 D EN^XPAR("SYS","GMRC IFC BACKGROUND FINISH",1,$$NOW^XLFDT)
"RTN","GMRCIBKG",94,0)
 ;  v-- start it again one hour after completing
"RTN","GMRCIBKG",95,0)
 D REQUEUE
"RTN","GMRCIBKG",96,0)
 Q
"RTN","GMRCIBKG",97,0)
 ;
"RTN","GMRCIBKG",98,0)
REQUEUE ;task job to start up again one hour after completing
"RTN","GMRCIBKG",99,0)
 N ZTRTN,ZTSK,ZTIO,ZTDESC,ZTDTH
"RTN","GMRCIBKG",100,0)
 S ZTDESC="IF Consults background error processor"
"RTN","GMRCIBKG",101,0)
 S ZTIO=""
"RTN","GMRCIBKG",102,0)
 S ZTRTN="EN^GMRCIBKG"
"RTN","GMRCIBKG",103,0)
 S ZTDTH=$$FMTH^XLFDT($$FMADD^XLFDT($$NOW^XLFDT,,1))
"RTN","GMRCIBKG",104,0)
 D ^%ZTLOAD
"RTN","GMRCIBKG",105,0)
 Q
"RTN","GMRCIBKG",106,0)
DELALRT(MSGLOG) ;delete obsolete alerts for an entry
"RTN","GMRCIBKG",107,0)
 ; Input:
"RTN","GMRCIBKG",108,0)
 ;   MSGLOG = ien from file 123.6
"RTN","GMRCIBKG",109,0)
 ;
"RTN","GMRCIBKG",110,0)
 N XQAID,XQAKILL
"RTN","GMRCIBKG",111,0)
 S XQAID="GMRCIFC,trans error,"_MSGLOG,XQAKILL=0
"RTN","GMRCIBKG",112,0)
 D DELETEA^XQALERT
"RTN","GMRCIBKG",113,0)
 Q
"RTN","GMRCIBKG",114,0)
 ;
"RTN","GMRCIBKG",115,0)
OVERDUE ; write message for alert to tell IRM job is overdue
"RTN","GMRCIBKG",116,0)
 W @IOF
"RTN","GMRCIBKG",117,0)
 W !,"The Inter-facility Consults background job is overdue."
"RTN","GMRCIBKG",118,0)
 W !,"This is likely due to an error while the job runs. It is suggested"
"RTN","GMRCIBKG",119,0)
 W !,"that you check the systems for errors. If the errors are resolved"
"RTN","GMRCIBKG",120,0)
 W !,"the background job will catch up and run normally. There is a "
"RTN","GMRCIBKG",121,0)
 W !,"remote possibility that the GMRC IFC BACKGROUND... parameters have"
"RTN","GMRCIBKG",122,0)
 W !,"been edited and are out of synch."
"RTN","GMRCIBKG",123,0)
 S XQAKILL=0
"RTN","GMRCIBKG",124,0)
 Q
"RTN","GMRCIBKG",125,0)
 ;
"RTN","GMRCIBKG",126,0)
GONOGO() ; determine if background job should run or not
"RTN","GMRCIBKG",127,0)
 ;Output: 
"RTN","GMRCIBKG",128,0)
 ;  1 = go ahead and run
"RTN","GMRCIBKG",129,0)
 ;  0 = don't run for some reason
"RTN","GMRCIBKG",130,0)
 N GMRCQT
"RTN","GMRCIBKG",131,0)
 S GMRCQT=1
"RTN","GMRCIBKG",132,0)
 D
"RTN","GMRCIBKG",133,0)
 . N GMRCBST,GMRCNOW,GMRCBFI
"RTN","GMRCIBKG",134,0)
 . S GMRCBST=$$GET^XPAR("SYS","GMRC IFC BACKGROUND START",1)
"RTN","GMRCIBKG",135,0)
 . I 'GMRCBST Q  ; has never run or needs to
"RTN","GMRCIBKG",136,0)
 . S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCIBKG",137,0)
 . I GMRCBST>GMRCNOW S GMRCQT=0 Q  ;set to future date/time - don't run
"RTN","GMRCIBKG",138,0)
 . S GMRCBFI=$$GET^XPAR("SYS","GMRC IFC BACKGROUND FINISH",1)
"RTN","GMRCIBKG",139,0)
 . I $$FMDIFF^XLFDT(GMRCNOW,GMRCBFI,2)<3600,GMRCBFI>GMRCBST S GMRCQT=0 Q
"RTN","GMRCIBKG",140,0)
 . ;                 ^--ran < 1 hr ago
"RTN","GMRCIBKG",141,0)
 . I $$FMDIFF^XLFDT(GMRCBST,GMRCBFI,2)>4500 D  Q
"RTN","GMRCIBKG",142,0)
 .. ; >1.5 hrs and job not finishing for some reason, alert techies
"RTN","GMRCIBKG",143,0)
 .. N XQA,XQAMSG,XQAROU,XQAID,XQAKILL
"RTN","GMRCIBKG",144,0)
 .. S XQAID="GMRC IFC BKG",XQAKILL=0 D DELETEA^XQALERT
"RTN","GMRCIBKG",145,0)
 .. S XQA("G.IFC TECH ERRORS")=""
"RTN","GMRCIBKG",146,0)
 .. S XQAMSG="IFC Background job overdue."
"RTN","GMRCIBKG",147,0)
 .. S XQAID="GMRC IFC BKG"
"RTN","GMRCIBKG",148,0)
 .. S XQAROU="OVERDUE^GMRCIBKG"
"RTN","GMRCIBKG",149,0)
 .. D SETUP^XQALERT
"RTN","GMRCIBKG",150,0)
 .. Q
"RTN","GMRCIBKG",151,0)
 . Q
"RTN","GMRCIBKG",152,0)
 Q GMRCQT
"RTN","GMRCIERR")
0^1^B66408009
"RTN","GMRCIERR",1,0)
GMRCIERR ;SLC/JFR - process IFC message error alert ;10/22/02 14:16
"RTN","GMRCIERR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**22,28,30**;DEC 27, 1997
"RTN","GMRCIERR",3,0)
 Q
"RTN","GMRCIERR",4,0)
EN(GMRCLOG,GMRCDA,GMRCACT,GMRCRPT) ;start here
"RTN","GMRCIERR",5,0)
 ;Build ^TMP array for processing alert
"RTN","GMRCIERR",6,0)
 ;
"RTN","GMRCIERR",7,0)
 K ^TMP("GMRCIERR",$J)
"RTN","GMRCIERR",8,0)
 N GMRCPNM,GMRCACTV,GMRCERR,GMRCRP,GMRCEP,GMRCACTM,GMRCCOM,GMRCSS
"RTN","GMRCIERR",9,0)
 N GMRCPROC,GMRCSITE,GMRCFCN,GMRCPT,GMRCSSN,VAHOW,VAROOT
"RTN","GMRCIERR",10,0)
 I '$D(^GMR(123.6,GMRCLOG,0)) D  Q
"RTN","GMRCIERR",11,0)
 . S ^TMP("GMRCIERR",$J,1,0)="Message log entry no longer exists"
"RTN","GMRCIERR",12,0)
 I $P(^GMR(123.6,GMRCLOG,0),U,4)'=GMRCDA D  Q
"RTN","GMRCIERR",13,0)
 . S ^TMP("GMRCIERR",$J,1,0)="Message log entry and Consult# don't match"
"RTN","GMRCIERR",14,0)
 I $P(^GMR(123.6,GMRCLOG,0),U,5)'=GMRCACT D  Q
"RTN","GMRCIERR",15,0)
 . S ^TMP("GMRCIERR",$J,1,0)="Message log entry & activity# don't match"
"RTN","GMRCIERR",16,0)
 S DFN=$P(^GMR(123,GMRCDA,0),U,2),VAROOT="GMRCPT",VAHOW=1
"RTN","GMRCIERR",17,0)
 D DEM^VADPT
"RTN","GMRCIERR",18,0)
 S GMRCPNM=GMRCPT("NM")
"RTN","GMRCIERR",19,0)
 S GMRCSSN=$P(GMRCPT("SS"),U,2)
"RTN","GMRCIERR",20,0)
 S GMRCACTV=$G(^GMR(123,GMRCDA,40,GMRCACT,0))
"RTN","GMRCIERR",21,0)
 S GMRCRP=$$GET1^DIQ(200,+$P(GMRCACTV,U,4),.01)
"RTN","GMRCIERR",22,0)
 S GMRCEP=$$GET1^DIQ(200,+$P(GMRCACTV,U,5),.01)
"RTN","GMRCIERR",23,0)
 S GMRCACTM=$$FMTE^XLFDT($P(GMRCACTV,U,3))
"RTN","GMRCIERR",24,0)
 S GMRCACTV=$$GET1^DIQ(123.1,$P(GMRCACTV,U,2),.01)
"RTN","GMRCIERR",25,0)
 S GMRCCOM=$O(^GMR(123,GMRCDA,40,GMRCACT,1,0))
"RTN","GMRCIERR",26,0)
 S GMRCSS=$$GET1^DIQ(123.5,+$P(^GMR(123,GMRCDA,0),U,5),.01)
"RTN","GMRCIERR",27,0)
 S GMRCPROC=$$GET1^DIQ(123.3,+$P(^GMR(123,GMRCDA,0),U,8),.01)
"RTN","GMRCIERR",28,0)
 S GMRCFCN=$P(^GMR(123,GMRCDA,0),U,22)
"RTN","GMRCIERR",29,0)
 D F4^XUAF4($$STA^XUAF4($P(^GMR(123,GMRCDA,0),U,23)),.GMRCSITE)
"RTN","GMRCIERR",30,0)
 N LN S LN=1
"RTN","GMRCIERR",31,0)
 S ^TMP("GMRCIERR",$J,LN,0)="An error occurred transmitting the following inter-facility consult ",LN=LN+1
"RTN","GMRCIERR",32,0)
 S ^TMP("GMRCIERR",$J,LN,0)="activity to "_GMRCSITE("NAME")_":",LN=LN+1
"RTN","GMRCIERR",33,0)
 S ^TMP("GMRCIERR",$J,LN,0)="",LN=LN+1
"RTN","GMRCIERR",34,0)
 S ^TMP("GMRCIERR",$J,LN,0)="Consult #: "_GMRCDA,LN=LN+1
"RTN","GMRCIERR",35,0)
 S ^TMP("GMRCIERR",$J,LN,0)="Remote Consult #: "_GMRCFCN,LN=LN+1
"RTN","GMRCIERR",36,0)
 S ^TMP("GMRCIERR",$J,LN,0)="Patient Name: "_GMRCPNM,LN=LN+1
"RTN","GMRCIERR",37,0)
 S ^TMP("GMRCIERR",$J,LN,0)="SSN: "_GMRCSSN,LN=LN+1
"RTN","GMRCIERR",38,0)
 S ^TMP("GMRCIERR",$J,LN,0)="To Service: "_GMRCSS,LN=LN+1
"RTN","GMRCIERR",39,0)
 I $L(GMRCPROC) S ^TMP("GMRCIERR",$J,LN,0)="Procedure: "_GMRCPROC,LN=LN+1
"RTN","GMRCIERR",40,0)
 S ^TMP("GMRCIERR",$J,LN,0)="",LN=LN+1
"RTN","GMRCIERR",41,0)
 I '$D(GMRCRPT) D ACTLG(GMRCDA,GMRCACT,GMRCLOG,.LN)
"RTN","GMRCIERR",42,0)
 Q
"RTN","GMRCIERR",43,0)
ACTLG(GMRCDA,GMRCACT,LOG,LN) ;build activity log entry
"RTN","GMRCIERR",44,0)
 N GMRCCT,TAB,GMRCERR,GMRCDIF
"RTN","GMRCIERR",45,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCIERR",46,0)
 S GMRCERR=$T(@("ERR"_$P(^GMR(123.6,LOG,0),U,8)_"^GMRCIUTL"))
"RTN","GMRCIERR",47,0)
 S GMRCERR=$S($L(GMRCERR):$P(GMRCERR,";",2),1:"Technical error")
"RTN","GMRCIERR",48,0)
 S ^TMP("GMRCIERR",$J,LN,0)="Activity #: "_GMRCACT,LN=LN+1
"RTN","GMRCIERR",49,0)
 S ^TMP("GMRCIERR",$J,LN,0)="Activity"_$E(TAB,1,17)_"Date/Time/Zone"_$E(TAB,1,6)_"Responsible Person"_$E(TAB,1,2)_"Entered By",LN=LN+1
"RTN","GMRCIERR",50,0)
 S GMRCCT=LN
"RTN","GMRCIERR",51,0)
 D BLDALN^GMRCSLM4(GMRCDA,GMRCACT)
"RTN","GMRCIERR",52,0)
 S ^TMP("GMRCIERR",$J,LN,0)="",LN=LN+1
"RTN","GMRCIERR",53,0)
 S ^TMP("GMRCIERR",$J,LN,0)="",LN=LN+1
"RTN","GMRCIERR",54,0)
 S ^TMP("GMRCIERR",$J,LN,0)="The error was: "_GMRCERR
"RTN","GMRCIERR",55,0)
 M ^TMP("GMRCIERR",$J)=^TMP("GMRCR",$J,"DT")
"RTN","GMRCIERR",56,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCIERR",57,0)
 Q
"RTN","GMRCIERR",58,0)
 ;
"RTN","GMRCIERR",59,0)
DIALOG(GMRCDATA) ;ask user what to do based on error and activity
"RTN","GMRCIERR",60,0)
 ;Input:
"RTN","GMRCIERR",61,0)
 ;  GMRCDATA  = XQADATA from alert handler
"RTN","GMRCIERR",62,0)
 ;      in form:   IFC_msg_log#|consult#|activity#
"RTN","GMRCIERR",63,0)
 ;
"RTN","GMRCIERR",64,0)
 ;Output:
"RTN","GMRCIERR",65,0)
 ;  value to set XQAKILL to
"RTN","GMRCIERR",66,0)
 N DIR,X,Y,LN,DUOUT,DTOUT
"RTN","GMRCIERR",67,0)
 D EN($P(GMRCDATA,"|"),$P(GMRCDATA,"|",2),$P(GMRCDATA,"|",3))
"RTN","GMRCIERR",68,0)
 W @IOF
"RTN","GMRCIERR",69,0)
 S LN=0 F  S LN=$O(^TMP("GMRCIERR",$J,LN)) Q:'LN  W !,^(LN,0)
"RTN","GMRCIERR",70,0)
 K ^TMP("GMRCIERR",$J)
"RTN","GMRCIERR",71,0)
 W !
"RTN","GMRCIERR",72,0)
 I $O(^TMP("GMRCIERR",$J," "),-1)<2 Q 0 ;some problem so delete alert
"RTN","GMRCIERR",73,0)
 S DIR(0)="E" D ^DIR
"RTN","GMRCIERR",74,0)
 I $D(DTOUT)!($D(DUOUT)) Q "@"
"RTN","GMRCIERR",75,0)
 W !
"RTN","GMRCIERR",76,0)
 I $O(^GMR(123.6,"AC",$P(GMRCDATA,"|",2),$P(GMRCDATA,"|",3)),-1) D  Q "@"
"RTN","GMRCIERR",77,0)
 . W !,"There is at least one earlier incomplete transaction for this"
"RTN","GMRCIERR",78,0)
 . W !,"consult, all incomplete transactions should be processed in "
"RTN","GMRCIERR",79,0)
 . W !,"order.",!
"RTN","GMRCIERR",80,0)
 . W !,"You can use the List incomplete IFC transactions option to"
"RTN","GMRCIERR",81,0)
 . W !,"locate and process the incomplete transactions for this consult."
"RTN","GMRCIERR",82,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMRCIERR",83,0)
 S DIR(0)="YA",DIR("B")="N"
"RTN","GMRCIERR",84,0)
 S DIR("A",1)="If you have corrected this problem you may resend this activity!"
"RTN","GMRCIERR",85,0)
 S DIR("A",2)=" "
"RTN","GMRCIERR",86,0)
 S DIR("A")="Do you want to retransmit this? " D ^DIR
"RTN","GMRCIERR",87,0)
 I $G(Y)=1 D  Q 0
"RTN","GMRCIERR",88,0)
 . D TRIGR^GMRCIEVT($P(GMRCDATA,"|",2),$P(GMRCDATA,"|",3))
"RTN","GMRCIERR",89,0)
 K DIR
"RTN","GMRCIERR",90,0)
 W !
"RTN","GMRCIERR",91,0)
 S DIR(0)="YA",DIR("B")="N"
"RTN","GMRCIERR",92,0)
 S DIR("A")="Do you want to delete this alert for yourself? "
"RTN","GMRCIERR",93,0)
 D ^DIR
"RTN","GMRCIERR",94,0)
 I $G(Y)=1 Q 1
"RTN","GMRCIERR",95,0)
 Q "@"
"RTN","GMRCIERR",96,0)
 ;
"RTN","GMRCIERR",97,0)
FOLLUP ;action to take from alert
"RTN","GMRCIERR",98,0)
 S XQAKILL=$$DIALOG(XQADATA)
"RTN","GMRCIERR",99,0)
 I XQAKILL="@" K XQAKILL
"RTN","GMRCIERR",100,0)
 Q
"RTN","GMRCIERR",101,0)
 ;
"RTN","GMRCIERR",102,0)
SNDALRT(GMRCLOG,TYPE,XQAMSG) ; send an alert on some errors
"RTN","GMRCIERR",103,0)
 ;Input:
"RTN","GMRCIERR",104,0)
 ; GMRCLOG = IFC MESSAGE LOG entry
"RTN","GMRCIERR",105,0)
 ; TYPE    = "C" for a clinical error, "T" for a technical error
"RTN","GMRCIERR",106,0)
 ;
"RTN","GMRCIERR",107,0)
 N XQA,XQAROU,XQADATA,XQAID,GROUP,GMRCACT,GMRCDA,GMRCLOG0
"RTN","GMRCIERR",108,0)
 S GMRCLOG0=$G(^GMR(123.6,GMRCLOG,0)) Q:'$L(GMRCLOG0)
"RTN","GMRCIERR",109,0)
 S GMRCDA=$P(GMRCLOG0,U,4) Q:'GMRCDA
"RTN","GMRCIERR",110,0)
 S GMRCACT=$P(GMRCLOG0,U,5) Q:'GMRCACT
"RTN","GMRCIERR",111,0)
 S GROUP=$S(TYPE="C":"G.IFC CLIN ERRORS",1:"G.IFC TECH ERRORS")
"RTN","GMRCIERR",112,0)
 S XQA(GROUP)=""
"RTN","GMRCIERR",113,0)
 I '$D(XQAMSG) S XQAMSG="Failed IFC transaction"
"RTN","GMRCIERR",114,0)
 S XQAROU="FOLLUP^GMRCIERR"
"RTN","GMRCIERR",115,0)
 S XQAID="GMRCIFC,trans error,"_GMRCLOG
"RTN","GMRCIERR",116,0)
 S XQADATA=GMRCLOG_"|"_GMRCDA_"|"_GMRCACT
"RTN","GMRCIERR",117,0)
 D SETUP^XQALERT
"RTN","GMRCIERR",118,0)
 Q
"RTN","GMRCIERR",119,0)
PTERRMSG(GMRCPID,GMRCSTA,GMRCDOM,GMRCOBR) ;send IFC pt err to mail group
"RTN","GMRCIERR",120,0)
 ;Input:
"RTN","GMRCIERR",121,0)
 ;  GMRCPID = PID seg from IFC message
"RTN","GMRCIERR",122,0)
 ;  GMRCSTA = station # of site where message originated
"RTN","GMRCIERR",123,0)
 ;  GMRCDOM = domain to send the message to, if defined   (optional)
"RTN","GMRCIERR",124,0)
 ;  GMRCOBR = OBR segment from IFC msg  (optional)
"RTN","GMRCIERR",125,0)
 ;
"RTN","GMRCIERR",126,0)
 ;Output:
"RTN","GMRCIERR",127,0)
 ;  mail message containing patient demographics
"RTN","GMRCIERR",128,0)
 ;
"RTN","GMRCIERR",129,0)
 N GMRCGRP,GMRCMSG,GMRCNM,GMRCNAM,GMRCDOB
"RTN","GMRCIERR",130,0)
 N XMERR,GMRCSUB,GMRCSITE,GMRCERR,GMRCICN
"RTN","GMRCIERR",131,0)
 N XMTEXT,XMY,XMDUZ,XMSUB,XMZ,XMMG
"RTN","GMRCIERR",132,0)
 S GMRCNAM=$P(GMRCPID,"|",5)
"RTN","GMRCIERR",133,0)
 S GMRCNM("FAMILY")=$P(GMRCNAM,U),GMRCNM("GIVEN")=$P(GMRCNAM,U,2)
"RTN","GMRCIERR",134,0)
 S GMRCNM("MIDDLE")=$P(GMRCNAM,U,3),GMRCNM("SUFFIX")=$P(GMRCNAM,U,4)
"RTN","GMRCIERR",135,0)
 S GMRCNAM=$$NAMEFMT^XLFNAME(.GMRCNM,"F","CL56Xc")
"RTN","GMRCIERR",136,0)
 S GMRCDOB=$$HL7TFM^XLFDT($P(GMRCPID,"|",7))
"RTN","GMRCIERR",137,0)
 S GMRCDOB=$$FMTE^XLFDT(GMRCDOB)
"RTN","GMRCIERR",138,0)
 S GMRCICN=+$P(GMRCPID,"|",2)
"RTN","GMRCIERR",139,0)
 D F4^XUAF4(GMRCSTA,.GMRCSITE)
"RTN","GMRCIERR",140,0)
 S GMRCMSG(1,0)="An Inter-facility Consult for the following patient has been requested."
"RTN","GMRCIERR",141,0)
 S GMRCMSG(2,0)="The patient has either never been registered at your facility or the national"
"RTN","GMRCIERR",142,0)
 S GMRCMSG(3,0)="MPI ICN for this patient at your site does not match that from the requesting"
"RTN","GMRCIERR",143,0)
 S GMRCMSG(4,0)="site. Please refer to the Master Patient Index/Patient Demographics (MPI/PD)"
"RTN","GMRCIERR",144,0)
 S GMRCMSG(5,0)="User Manual and Master Patient Index/Patient Demographics Exception"
"RTN","GMRCIERR",145,0)
 S GMRCMSG(6,0)="Handling Manuals to resolve this error so the request may be processed."
"RTN","GMRCIERR",146,0)
 S GMRCMSG(7,0)=" ",GMRCMSG(8,0)=" "
"RTN","GMRCIERR",147,0)
 S GMRCMSG(9,0)="Patient demographics from "_GMRCSITE("NAME")
"RTN","GMRCIERR",148,0)
 S GMRCMSG(10,0)="   Patient name: "_GMRCNAM
"RTN","GMRCIERR",149,0)
 S GMRCMSG(11,0)="            SSN: "_$P(GMRCPID,"|",19)
"RTN","GMRCIERR",150,0)
 S GMRCMSG(12,0)="  Date of birth: "_GMRCDOB
"RTN","GMRCIERR",151,0)
 S GMRCMSG(13,0)="            Sex: "_$P(GMRCPID,"|",8)
"RTN","GMRCIERR",152,0)
 S GMRCMSG(14,0)="     Remote ICN: "_GMRCICN
"RTN","GMRCIERR",153,0)
 S GMRCMSG(15,0)=" "
"RTN","GMRCIERR",154,0)
 I $L($G(GMRCOBR)) D
"RTN","GMRCIERR",155,0)
 . N GMRCITM
"RTN","GMRCIERR",156,0)
 . S GMRCITM=$P(GMRCOBR,"|",4)
"RTN","GMRCIERR",157,0)
 . I GMRCITM["VA1235" S GMRCITM="Ordered service: "_$P(GMRCITM,U,2)
"RTN","GMRCIERR",158,0)
 . I GMRCITM["VA1233" S GMRCITM="  Ordered proc.: "_$P(GMRCITM,U,2)
"RTN","GMRCIERR",159,0)
 . S GMRCMSG(16,0)=GMRCITM
"RTN","GMRCIERR",160,0)
 S GMRCMSG(17,0)=" "
"RTN","GMRCIERR",161,0)
 S GMRCMSG(18,0)="   The error is: Unknown Patient (201)"
"RTN","GMRCIERR",162,0)
 ;
"RTN","GMRCIERR",163,0)
 D  ; set XMY to local group or remote group
"RTN","GMRCIERR",164,0)
 . I $D(GMRCDOM) S XMY("G.IFC CLIN ERRORS@"_GMRCDOM)="" Q
"RTN","GMRCIERR",165,0)
 . S XMY("G.IFC PATIENT ERROR MESSAGES")=""
"RTN","GMRCIERR",166,0)
 S XMSUB="Incoming IFC patient error, "_GMRCNAM
"RTN","GMRCIERR",167,0)
 S XMDUZ="Consult/Request Tracking Package"
"RTN","GMRCIERR",168,0)
 S XMTEXT="GMRCMSG("
"RTN","GMRCIERR",169,0)
 D ^XMD
"RTN","GMRCIERR",170,0)
 Q
"RTN","GMRCIERR",171,0)
 ;
"RTN","GMRCIERR",172,0)
PTMPIER(GMRCDFN) ;send IFC local MPI error to MAS mail group
"RTN","GMRCIERR",173,0)
 ;Input:
"RTN","GMRCIERR",174,0)
 ;  GMRCDFN = DFN from file 2 of patient with MPI problem
"RTN","GMRCIERR",175,0)
 ;
"RTN","GMRCIERR",176,0)
 ;Output:
"RTN","GMRCIERR",177,0)
 ;  mail message containing patient demographics
"RTN","GMRCIERR",178,0)
 ;
"RTN","GMRCIERR",179,0)
 N DFN,GMRCPT,GMRCMSG,VAHOW,VAROOT
"RTN","GMRCIERR",180,0)
 N XMTEXT,XMY,XMDUZ,XMSUB,XMZ,XMMG
"RTN","GMRCIERR",181,0)
 S DFN=GMRCDFN,VAHOW=1,VAROOT="GMRCPT"
"RTN","GMRCIERR",182,0)
 D DEM^VADPT
"RTN","GMRCIERR",183,0)
 S GMRCMSG(1,0)="An Inter-facility Consult for the following patient has been requested."
"RTN","GMRCIERR",184,0)
 S GMRCMSG(2,0)="The PATIENT file is either missing an ICN or contains a local ICN."
"RTN","GMRCIERR",185,0)
 S GMRCMSG(3,0)="Please refer to the Master Patient Index/Patient Demographics(MPI/PD) User"
"RTN","GMRCIERR",186,0)
 S GMRCMSG(4,0)="and Master Patient Index/Patient Demographics Exception Handling Manuals"
"RTN","GMRCIERR",187,0)
 S GMRCMSG(5,0)="to resolve this error so request may be processed."
"RTN","GMRCIERR",188,0)
 S GMRCMSG(6,0)=" "
"RTN","GMRCIERR",189,0)
 S GMRCMSG(7,0)="   Patient name: "_GMRCPT("NM")
"RTN","GMRCIERR",190,0)
 S GMRCMSG(8,0)="            SSN: "_$P(GMRCPT("SS"),U,2)
"RTN","GMRCIERR",191,0)
 S GMRCMSG(9,0)="  Date of birth: "_$P(GMRCPT("DB"),U,2)
"RTN","GMRCIERR",192,0)
 S GMRCMSG(10,0)="            Sex: "_$P(GMRCPT("SX"),U,2)
"RTN","GMRCIERR",193,0)
 S GMRCMSG(11,0)="  "
"RTN","GMRCIERR",194,0)
 S GMRCMSG(12,0)="   The error is: Local or unknown MPI identifiers (202)"
"RTN","GMRCIERR",195,0)
 ;
"RTN","GMRCIERR",196,0)
 S XMY("G.IFC PATIENT ERROR MESSAGES")=""
"RTN","GMRCIERR",197,0)
 S XMSUB="Outgoing IFC patient error, "_GMRCPT("NM")
"RTN","GMRCIERR",198,0)
 S XMDUZ="Consult/Request Tracking Package"
"RTN","GMRCIERR",199,0)
 S XMTEXT="GMRCMSG("
"RTN","GMRCIERR",200,0)
 D ^XMD
"RTN","GMRCIERR",201,0)
 Q
"RTN","GMRCIERR",202,0)
 ;
"RTN","GMRCSTU")
0^5^B61626713
"RTN","GMRCSTU",1,0)
GMRCSTU ;SLC/DCM,dee - Statistic Utilities for C/RT ;09/26/02 10:16
"RTN","GMRCSTU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,29,30**;DEC 27, 1997
"RTN","GMRCSTU",3,0)
 Q
"RTN","GMRCSTU",4,0)
 ;
"RTN","GMRCSTU",5,0)
GETDT(GMRCO) ;get the date that the consult/request was accepted by service
"RTN","GMRCSTU",6,0)
 N ND,GMRCDA
"RTN","GMRCSTU",7,0)
 S COMPLDT=9999999
"RTN","GMRCSTU",8,0)
 S ND=0 F  S ND=$O(^GMR(123,GMRCO,40,ND)) Q:ND?1A.E!(ND="")  D
"RTN","GMRCSTU",9,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=21 GMRCDA=$P(^(0),"^",1)
"RTN","GMRCSTU",10,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=1 GMRCDA(1)=$P(^(0),"^",1)
"RTN","GMRCSTU",11,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=15 GMRCDA(15)=$P(^(0),"^",3)
"RTN","GMRCSTU",12,0)
 .I $P(^GMR(123,GMRCO,40,ND,0),"^",2)=10,$P(^(0),"^",3)<COMPLDT S COMPLDT=$P(^(0),"^",3)
"RTN","GMRCSTU",13,0)
 S RCVDT=$S($D(GMRCDA)#2:GMRCDA,$D(GMRCDA(1)):GMRCDA(1),$D(GMRCDA(15)):GMRCDA(15),1:$P(^GMR(123,GMRCO,0),"^",1))
"RTN","GMRCSTU",14,0)
 Q
"RTN","GMRCSTU",15,0)
EN ;
"RTN","GMRCSTU",16,0)
 K ^TMP("GMRCSLIST",$J),GMRCQUT
"RTN","GMRCSTU",17,0)
 ;Get the service/grouper
"RTN","GMRCSTU",18,0)
 D ASRV^GMRCASV
"RTN","GMRCSTU",19,0)
 G:$D(GMRCQUT) KILL
"RTN","GMRCSTU",20,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 G KILL
"RTN","GMRCSTU",21,0)
 ;Get the date range
"RTN","GMRCSTU",22,0)
 D ^GMRCSPD
"RTN","GMRCSTU",23,0)
 G:$D(GMRCQUT) KILL
"RTN","GMRCSTU",24,0)
 Q
"RTN","GMRCSTU",25,0)
 ;
"RTN","GMRCSTU",26,0)
ENOR(RETURN,GMRCSRVC,GMRCDT1,GMRCDT2) ;Entry point for GUI interface.
"RTN","GMRCSTU",27,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTU",28,0)
 ;GMRCSRVC:  Service for which consults are to be displayed.
"RTN","GMRCSTU",29,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTU",30,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTU",31,0)
 ;
"RTN","GMRCSTU",32,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTU",33,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTU",34,0)
 ;            1  grouper only
"RTN","GMRCSTU",35,0)
 ;            2  tracking only
"RTN","GMRCSTU",36,0)
 ;            9  disabled
"RTN","GMRCSTU",37,0)
 ;
"RTN","GMRCSTU",38,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTU",39,0)
 N GMRCWRIT
"RTN","GMRCSTU",40,0)
 S GMRCWRIT=0
"RTN","GMRCSTU",41,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCSTU",42,0)
 S RETURN="^TMP(""GMRCR"",$J,""PRL"")"
"RTN","GMRCSTU",43,0)
 I '($D(GMRCSRVC)#2) S GMRCSRVC=1
"RTN","GMRCSTU",44,0)
 Q:'$D(^GMR(123.5,$G(GMRCSRVC),0))
"RTN","GMRCSTU",45,0)
 ;Build service array
"RTN","GMRCSTU",46,0)
 S GMRCDG=GMRCSRVC
"RTN","GMRCSTU",47,0)
 D SERV1^GMRCASV
"RTN","GMRCSTU",48,0)
 ;Get external form of date range
"RTN","GMRCSTU",49,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTU",50,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTU",51,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTU",52,0)
 G ODTSTR
"RTN","GMRCSTU",53,0)
 ;
"RTN","GMRCSTU",54,0)
ODT ;List Manager entry point
"RTN","GMRCSTU",55,0)
 N GMRCWRIT
"RTN","GMRCSTU",56,0)
 S GMRCWRIT=1
"RTN","GMRCSTU",57,0)
 D WAIT^DICD
"RTN","GMRCSTU",58,0)
 ;
"RTN","GMRCSTU",59,0)
ODTSTR ;Find the mean, standard deviation of how long to complete a consult from when it is accepted in the service to when it is complete
"RTN","GMRCSTU",60,0)
 N RCVDT,COMPLDT,INDEX,TEMPTMP,GROUPER,TAB
"RTN","GMRCSTU",61,0)
 N GMRCDG,GMRCDGT,GMRCDT
"RTN","GMRCSTU",62,0)
 N GMRCGRP,GMRCND,GMRCO,ND,X,X1,X2
"RTN","GMRCSTU",63,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 G KILL
"RTN","GMRCSTU",64,0)
 S INDEX=0
"RTN","GMRCSTU",65,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTU",66,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",67,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",68,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"T")="0^0^0^0^0^0"
"RTN","GMRCSTU",69,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"I")="0^0^0^0^0"
"RTN","GMRCSTU",70,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"O")="0^0^0^0^0"
"RTN","GMRCSTU",71,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"U")="0^0^0^0^0"
"RTN","GMRCSTU",72,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"T")="0^0^0^0^0^0"
"RTN","GMRCSTU",73,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"I")="0^0^0^0^0"
"RTN","GMRCSTU",74,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"O")="0^0^0^0^0"
"RTN","GMRCSTU",75,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"U")="0^0^0^0^0"
"RTN","GMRCSTU",76,0)
 S GMRCND=0
"RTN","GMRCSTU",77,0)
 S INDEX=""
"RTN","GMRCSTU",78,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX),-1) Q:INDEX=""  D
"RTN","GMRCSTU",79,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",80,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",81,0)
 .Q:$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)>0
"RTN","GMRCSTU",82,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",5)'=1 D
"RTN","GMRCSTU",83,0)
 ..S GMRCDT=""
"RTN","GMRCSTU",84,0)
 ..F  S GMRCDT=$O(^GMR(123,"AE",ND,2,GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCSTU",85,0)
 ...S GMRCO=0
"RTN","GMRCSTU",86,0)
 ...F  S GMRCO=$O(^GMR(123,"AE",ND,2,GMRCDT,GMRCO)) Q:GMRCO=""  D  W:GMRCWRIT&'(GMRCND#25) "."
"RTN","GMRCSTU",87,0)
 ....D GETDT(GMRCO)
"RTN","GMRCSTU",88,0)
 ....I COMPLDT<9999999,$S(GMRCDT1="ALL":1,RCVDT'<GMRCDT1&(RCVDT'>GMRCDT2):1,1:0) D
"RTN","GMRCSTU",89,0)
 .....S X1=COMPLDT
"RTN","GMRCSTU",90,0)
 .....S X2=RCVDT
"RTN","GMRCSTU",91,0)
 .....D ^%DTC
"RTN","GMRCSTU",92,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),U)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),U)+X
"RTN","GMRCSTU",93,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)+1
"RTN","GMRCSTU",94,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",3)+(X*X)
"RTN","GMRCSTU",95,0)
 .....I $P(^GMR(123,GMRCO,0),"^",18)="I" D
"RTN","GMRCSTU",96,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",1)+X
"RTN","GMRCSTU",97,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",2)+1
"RTN","GMRCSTU",98,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",3)+(X*X)
"RTN","GMRCSTU",99,0)
 .....E  I $P(^GMR(123,GMRCO,0),"^",18)="O" D
"RTN","GMRCSTU",100,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",1)+X
"RTN","GMRCSTU",101,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",2)+1
"RTN","GMRCSTU",102,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",3)+(X*X)
"RTN","GMRCSTU",103,0)
 .....E  D
"RTN","GMRCSTU",104,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",1)+X
"RTN","GMRCSTU",105,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",2)+1
"RTN","GMRCSTU",106,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",3)+(X*X)
"RTN","GMRCSTU",107,0)
 .....S GMRCND=GMRCND+1
"RTN","GMRCSTU",108,0)
 .D PARENTS^GMRCSTU1(ND,+$P(^TMP("GMRCSLIST",$J,INDEX),"^",3))
"RTN","GMRCSTU",109,0)
 S ND=0
"RTN","GMRCSTU",110,0)
STAT ;Do the statistics
"RTN","GMRCSTU",111,0)
 F  S ND=$O(^TMP("GMRCSVC",$J,2,ND)) Q:ND=""  D
"RTN","GMRCSTU",112,0)
 .I $P($G(^TMP("GMRCSVC",$J,1,ND,"T")),"^",1)>0 D DOSTAT^GMRCSTU1(1,ND)
"RTN","GMRCSTU",113,0)
 .I $P(^TMP("GMRCSVC",$J,2,ND,"T"),"^",1)>0 D DOSTAT^GMRCSTU1(2,ND)
"RTN","GMRCSTU",114,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCSTU",115,0)
 S GMRCCT=0
"RTN","GMRCSTU",116,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTU",117,0)
 S TAB=""
"RTN","GMRCSTU",118,0)
 S $P(TAB," ",40)=""
"RTN","GMRCSTU",119,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",120,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,19)_"Consult/Request Completion Time Statistics"
"RTN","GMRCSTU",121,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",122,0)
 S TEMPTMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTU",123,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,40-($L(TEMPTMP)/2))_TEMPTMP
"RTN","GMRCSTU",124,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",125,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=""
"RTN","GMRCSTU",126,0)
 S INDEX=0
"RTN","GMRCSTU",127,0)
 S GROUPER=0
"RTN","GMRCSTU",128,0)
 S GROUPER(0)=0
"RTN","GMRCSTU",129,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTU",130,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",131,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9&'$D(^TMP("GMRCSVC",$J,2,ND))
"RTN","GMRCSTU",132,0)
 .F  Q:GROUPER(GROUPER)=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)  D
"RTN","GMRCSTU",133,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTU",134,0)
 ..D SERVSTAT^GMRCSTU1(.GMRCCT,2,GROUPER(GROUPER),GROUPER(GROUPER))
"RTN","GMRCSTU",135,0)
 ..;pop grouper from stack
"RTN","GMRCSTU",136,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTU",137,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTU",138,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTU",139,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",140,0)
 ..S TEMPTMP="GROUPER: "_$P(^GMR(123.5,ND,0),"^",1)
"RTN","GMRCSTU",141,0)
 ..S:$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)>0 TEMPTMP=TEMPTMP_"  in Group: "_$P(^GMR(123.5,$P(^TMP("GMRCSLIST",$J,INDEX),"^",3),0),"^",1)
"RTN","GMRCSTU",142,0)
 ..S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,40-(($L(TEMPTMP)/2)+.5))_TEMPTMP
"RTN","GMRCSTU",143,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",144,0)
 ..S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=""
"RTN","GMRCSTU",145,0)
 ..;push new grouper on stack
"RTN","GMRCSTU",146,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTU",147,0)
 ..S GROUPER(GROUPER)=ND
"RTN","GMRCSTU",148,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=1
"RTN","GMRCSTU",149,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",150,0)
 .D SERVSTAT^GMRCSTU1(.GMRCCT,1,ND,GROUPER(GROUPER))
"RTN","GMRCSTU",151,0)
 ;Now list the group totals for the current groups.
"RTN","GMRCSTU",152,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTU",153,0)
 .;End of a group so print the group totals
"RTN","GMRCSTU",154,0)
 .D SERVSTAT^GMRCSTU1(.GMRCCT,2,GROUPER(GROUPER),GROUPER(GROUPER))
"RTN","GMRCSTU",155,0)
 ;Done building list.
"RTN","GMRCSTU",156,0)
 S VALMCNT=GMRCCT,VALMBCK="R"
"RTN","GMRCSTU",157,0)
KILL ;kill variables and exit
"RTN","GMRCSTU",158,0)
 S:$D(GMRCQUT) VALMBCK="Q"
"RTN","GMRCSTU",159,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSTU",160,0)
 Q
"RTN","GMRCSTU",161,0)
PRNT ;print statistics to a printer
"RTN","GMRCSTU",162,0)
 ;Called from a List Manager action
"RTN","GMRCSTU",163,0)
 Q:'$D(^TMP("GMRCR",$J,"PRL",2,0))
"RTN","GMRCSTU",164,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSTU",165,0)
 D PRNTASK
"RTN","GMRCSTU",166,0)
 D PRNTIT("PRL","PRNTQ^GMRCSTU","CONSULT/REQUEST PACKAGE PRINT COMPLETION TIME STATISTICS FROM LIST MANAGER DISPLAY")
"RTN","GMRCSTU",167,0)
 Q
"RTN","GMRCSTU",168,0)
 ;
"RTN","GMRCSTU",169,0)
PRNTASK ;Ask for device
"RTN","GMRCSTU",170,0)
 N POP,%ZIS
"RTN","GMRCSTU",171,0)
 K GMRCQUT
"RTN","GMRCSTU",172,0)
 S POP=0
"RTN","GMRCSTU",173,0)
 S %ZIS="MQ"
"RTN","GMRCSTU",174,0)
 D ^%ZIS
"RTN","GMRCSTU",175,0)
 I POP D  Q
"RTN","GMRCSTU",176,0)
 .S GMRCMSG="Printer Busy. Try Again Later."
"RTN","GMRCSTU",177,0)
 .D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCSTU",178,0)
 .K GMRCMSG
"RTN","GMRCSTU",179,0)
 .S GMRCQUT=1
"RTN","GMRCSTU",180,0)
 Q
"RTN","GMRCSTU",181,0)
 ;
"RTN","GMRCSTU",182,0)
PRNTIT(TMPNAME,QUERTN,QUEDESC) ;Send list to printer
"RTN","GMRCSTU",183,0)
 N ANSWER,INDEX,DOLLARH,ZTRTN,ZTDESC
"RTN","GMRCSTU",184,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCSTU",185,0)
 .S DOLLARH=$H
"RTN","GMRCSTU",186,0)
 .M ^XTMP("GMRCR","$"_$J,DOLLARH,"PRINT")=^TMP("GMRCR",$J,TMPNAME)
"RTN","GMRCSTU",187,0)
 .S ZTRTN=QUERTN
"RTN","GMRCSTU",188,0)
 .S ZTDESC=QUEDESC
"RTN","GMRCSTU",189,0)
 .S ZTSAVE("J")="$"_$J
"RTN","GMRCSTU",190,0)
 .S ZTSAVE("DOLLARH")=""
"RTN","GMRCSTU",191,0)
 .S ZTSAVE("TMPNAME")=""
"RTN","GMRCSTU",192,0)
 .S ZTSAVE("GMRCDG")=""
"RTN","GMRCSTU",193,0)
 .S ZTSAVE("GMRCDT1")=""
"RTN","GMRCSTU",194,0)
 .S ZTSAVE("GMRCDT2")=""
"RTN","GMRCSTU",195,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","GMRCSTU",196,0)
 .K ZTSAVE
"RTN","GMRCSTU",197,0)
 .S VALMBCK="R"
"RTN","GMRCSTU",198,0)
 U IO
"RTN","GMRCSTU",199,0)
 S ANSWER=""
"RTN","GMRCSTU",200,0)
 S INDEX=""
"RTN","GMRCSTU",201,0)
 F  S INDEX=$O(^TMP("GMRCR",$J,TMPNAME,INDEX)) Q:INDEX=""  W ^TMP("GMRCR",$J,TMPNAME,INDEX,0),! I IOST["C-",$S($D(IOSL)#2:$Y>(IOSL-2),1:$Y>22) R "Press <ENTER> To Continue, '^' To Quit: ",ANSWER:DTIME Q:'$T!(ANSWER["^")  W @IOF
"RTN","GMRCSTU",202,0)
 I ANSWER'["^",IOST["C-",$Y>1 R !,"Press <ENTER> To Continue: ",ANSWER:DTIME
"RTN","GMRCSTU",203,0)
 U IO(0)
"RTN","GMRCSTU",204,0)
 D ^%ZISC
"RTN","GMRCSTU",205,0)
 S VALMBCK="R"
"RTN","GMRCSTU",206,0)
 Q
"RTN","GMRCSTU",207,0)
 ;
"RTN","GMRCSTU",208,0)
PRNTQ ;Print Queued report from ^XTMP global then kill off ^XTMP
"RTN","GMRCSTU",209,0)
 N INDEX
"RTN","GMRCSTU",210,0)
 U IO
"RTN","GMRCSTU",211,0)
 S INDEX=""
"RTN","GMRCSTU",212,0)
 F  S INDEX=$O(^XTMP("GMRCR",J,DOLLARH,"PRINT",INDEX)) Q:INDEX=""  W ^XTMP("GMRCR",J,DOLLARH,"PRINT",INDEX,0),!
"RTN","GMRCSTU",213,0)
 K ^XTMP("GMRCR",J,DOLLARH,"PRINT"),J,DOLLARH
"RTN","GMRCSTU",214,0)
 D ^%ZISC
"RTN","GMRCSTU",215,0)
 Q
"VER")
8.0^22.0
**END**
**END**
