Released DG*5.3*683 SEQ #620
Extracted from mail message
**KIDS**:DG*5.3*683^

**INSTALL NAME**
DG*5.3*683
"BLD",6448,0)
DG*5.3*683^REGISTRATION^0^3060512^y
"BLD",6448,4,0)
^9.64PA^42^1
"BLD",6448,4,42,0)
42
"BLD",6448,4,42,2,0)
^9.641^42^1
"BLD",6448,4,42,2,42,0)
WARD LOCATION  (File-top level)
"BLD",6448,4,42,2,42,1,0)
^9.6411^.017^1
"BLD",6448,4,42,2,42,1,.017,0)
SPECIALTY
"BLD",6448,4,42,222)
y^y^p^^^^n^^n
"BLD",6448,4,42,224)

"BLD",6448,4,"APDD",42,42)

"BLD",6448,4,"APDD",42,42,.017)

"BLD",6448,4,"B",42,42)

"BLD",6448,"ABPKG")
n
"BLD",6448,"INID")
^y
"BLD",6448,"INIT")
DG53683P
"BLD",6448,"KRN",0)
^9.67PA^8989.52^19
"BLD",6448,"KRN",.4,0)
.4
"BLD",6448,"KRN",.401,0)
.401
"BLD",6448,"KRN",.402,0)
.402
"BLD",6448,"KRN",.403,0)
.403
"BLD",6448,"KRN",.5,0)
.5
"BLD",6448,"KRN",.84,0)
.84
"BLD",6448,"KRN",3.6,0)
3.6
"BLD",6448,"KRN",3.8,0)
3.8
"BLD",6448,"KRN",9.2,0)
9.2
"BLD",6448,"KRN",9.8,0)
9.8
"BLD",6448,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",6448,"KRN",9.8,"NM",1,0)
DGPTAE02^^0^B19447484
"BLD",6448,"KRN",9.8,"NM",2,0)
DGACT^^0^B715902
"BLD",6448,"KRN",9.8,"NM",3,0)
DGPTFM7^^0^B21153448
"BLD",6448,"KRN",9.8,"NM",4,0)
DGPMV10^^0^B28791536
"BLD",6448,"KRN",9.8,"NM",5,0)
DGPTF4^^0^B22914415
"BLD",6448,"KRN",9.8,"NM",6,0)
DGPTFMO^^0^B26139485
"BLD",6448,"KRN",9.8,"NM",7,0)
DGPTFM^^0^B44316891
"BLD",6448,"KRN",9.8,"NM","B","DGACT",2)

"BLD",6448,"KRN",9.8,"NM","B","DGPMV10",4)

"BLD",6448,"KRN",9.8,"NM","B","DGPTAE02",1)

"BLD",6448,"KRN",9.8,"NM","B","DGPTF4",5)

"BLD",6448,"KRN",9.8,"NM","B","DGPTFM",7)

"BLD",6448,"KRN",9.8,"NM","B","DGPTFM7",3)

"BLD",6448,"KRN",9.8,"NM","B","DGPTFMO",6)

"BLD",6448,"KRN",19,0)
19
"BLD",6448,"KRN",19,"NM",0)
^9.68A^^
"BLD",6448,"KRN",19.1,0)
19.1
"BLD",6448,"KRN",101,0)
101
"BLD",6448,"KRN",409.61,0)
409.61
"BLD",6448,"KRN",771,0)
771
"BLD",6448,"KRN",870,0)
870
"BLD",6448,"KRN",8989.51,0)
8989.51
"BLD",6448,"KRN",8989.52,0)
8989.52
"BLD",6448,"KRN",8994,0)
8994
"BLD",6448,"KRN","B",.4,.4)

"BLD",6448,"KRN","B",.401,.401)

"BLD",6448,"KRN","B",.402,.402)

"BLD",6448,"KRN","B",.403,.403)

"BLD",6448,"KRN","B",.5,.5)

"BLD",6448,"KRN","B",.84,.84)

"BLD",6448,"KRN","B",3.6,3.6)

"BLD",6448,"KRN","B",3.8,3.8)

"BLD",6448,"KRN","B",9.2,9.2)

"BLD",6448,"KRN","B",9.8,9.8)

"BLD",6448,"KRN","B",19,19)

"BLD",6448,"KRN","B",19.1,19.1)

"BLD",6448,"KRN","B",101,101)

"BLD",6448,"KRN","B",409.61,409.61)

"BLD",6448,"KRN","B",771,771)

"BLD",6448,"KRN","B",870,870)

"BLD",6448,"KRN","B",8989.51,8989.51)

"BLD",6448,"KRN","B",8989.52,8989.52)

"BLD",6448,"KRN","B",8994,8994)

"BLD",6448,"QUES",0)
^9.62^^0
"BLD",6448,"REQB",0)
^9.611^7^7
"BLD",6448,"REQB",1,0)
DG*5.3*466^1
"BLD",6448,"REQB",2,0)
IB*2.0*332^1
"BLD",6448,"REQB",3,0)
DG*5.3*594^1
"BLD",6448,"REQB",4,0)
DG*5.3*509^1
"BLD",6448,"REQB",5,0)
DG*5.3*478^1
"BLD",6448,"REQB",6,0)
DG*5.3*606^1
"BLD",6448,"REQB",7,0)
DG*5.3*635^1
"BLD",6448,"REQB","B","DG*5.3*466",1)

"BLD",6448,"REQB","B","DG*5.3*478",5)

"BLD",6448,"REQB","B","DG*5.3*509",4)

"BLD",6448,"REQB","B","DG*5.3*594",3)

"BLD",6448,"REQB","B","DG*5.3*606",6)

"BLD",6448,"REQB","B","DG*5.3*635",7)

"BLD",6448,"REQB","B","IB*2.0*332",2)

"FIA",42)
WARD LOCATION
"FIA",42,0)
^DIC(42,
"FIA",42,0,0)
42I
"FIA",42,0,1)
y^y^p^^^^n^^n
"FIA",42,0,10)

"FIA",42,0,11)

"FIA",42,0,"RLRO")

"FIA",42,0,"VR")
5.3^DG
"FIA",42,42)
1
"FIA",42,42,.017)

"INIT")
DG53683P
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
683^3060512^2503
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3051101
"PKG",5,22,1,"PAH",1,1,1,0)
This patch adds the HOSPICE Nursing Home Care as a new specialty to
"PKG",5,22,1,"PAH",1,1,2,0)
the SPECIALTY (#42.4) file. An entry in the FACILITY TREATING SPECIALTY (#45.7)
"PKG",5,22,1,"PAH",1,1,3,0)
is optional.
"PKG",5,22,1,"PAH",1,1,4,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","DG53683P")
0^^B76546374
"RTN","DG53683P",1,0)
DG53683P ;ALB/DHH - Add NURSING HOME TREATING SPECIALTIES ; 11/01/05
"RTN","DG53683P",2,0)
 ;;5.3;Registration;**683**;Nov 1, 2005
"RTN","DG53683P",3,0)
 ;base program: DG53176P
"RTN","DG53683P",4,0)
 ;
"RTN","DG53683P",5,0)
EN ;Add Treating Specialties to the SPECIALITY file (#42.4)
"RTN","DG53683P",6,0)
 N DGI,DGERR,DGSPEC,DGIFN,DGQUES
"RTN","DG53683P",7,0)
 S DGIFN=0
"RTN","DG53683P",8,0)
 F DGI=1:1 S DGSPEC=$P($T(TRSP+DGI),";;",2) Q:DGSPEC="QUIT"  D
"RTN","DG53683P",9,0)
 .D TSPEC
"RTN","DG53683P",10,0)
 .S DGQUES=$P(DGSPEC,U,9)
"RTN","DG53683P",11,0)
 .D FAC
"RTN","DG53683P",12,0)
 .Q
"RTN","DG53683P",13,0)
 D EDIT
"RTN","DG53683P",14,0)
 D INACT80,INACT
"RTN","DG53683P",15,0)
 Q
"RTN","DG53683P",16,0)
TSPEC ;Add treating specialty to SPECIALTY File (#42.4)
"RTN","DG53683P",17,0)
 D BMES^XPDUTL(">>>"_$P(DGSPEC,U,2)_">>>")
"RTN","DG53683P",18,0)
 N DA,DGFILE,DGMULT,DIC,DIE,DGDA1,DINUM,DLAYGO,DR,X,Y
"RTN","DG53683P",19,0)
 S DGERR=0
"RTN","DG53683P",20,0)
 S DIC="^DIC(42.4,"
"RTN","DG53683P",21,0)
 S DIC(0)="LX"
"RTN","DG53683P",22,0)
 S DINUM=$P(DGSPEC,U)
"RTN","DG53683P",23,0)
 S X=$P(DGSPEC,U,2)
"RTN","DG53683P",24,0)
 S DLAYGO=42.4
"RTN","DG53683P",25,0)
 D ^DIC
"RTN","DG53683P",26,0)
 S (DGIFN,DGDA1)=Y
"RTN","DG53683P",27,0)
 I +DGIFN=-1 D  Q
"RTN","DG53683P",28,0)
 .D MES^XPDUTL("     Entry not added to SPECIALTY File (#42.4).  No further updating will occur.")
"RTN","DG53683P",29,0)
 .D MES^XPDUTL("     Please contact Customer Service for assistance.")
"RTN","DG53683P",30,0)
 .Q
"RTN","DG53683P",31,0)
 I $P(DGIFN,U,3)'=1&(+DGIFN'=$P(DGSPEC,U)) D  Q
"RTN","DG53683P",32,0)
 .D MES^XPDUTL("     Entry exists in SPECIALTY File (#42.4), but with a different PTF Code #.")
"RTN","DG53683P",33,0)
 .D MES^XPDUTL("     No further updating will occur.  Please review entry.")
"RTN","DG53683P",34,0)
 .S DGERR=1
"RTN","DG53683P",35,0)
 .Q 
"RTN","DG53683P",36,0)
 D MES^XPDUTL("     Entry "_$S($P(DGIFN,U,3)=1:"added to",1:"exists in")_" SPECIALTY File (#42.4).")
"RTN","DG53683P",37,0)
 D MES^XPDUTL("     Updating SPECIALTY File fields.")
"RTN","DG53683P",38,0)
 S DIE=DIC
"RTN","DG53683P",39,0)
 S DR="1///"_$P(DGSPEC,U,3)_";3///"_$P(DGSPEC,U,4)_";4///"_$P(DGSPEC,U,5)_";5///"_$P(DGSPEC,U,6)_";6///"_$P(DGSPEC,U,7)
"RTN","DG53683P",40,0)
 S DA=+DGIFN
"RTN","DG53683P",41,0)
 D ^DIE
"RTN","DG53683P",42,0)
 S DGFILE=42.4
"RTN","DG53683P",43,0)
 S DGMULT=10
"RTN","DG53683P",44,0)
 S DIC="^DIC(42.4,"_+DGIFN_",""E"","
"RTN","DG53683P",45,0)
 D MULT
"RTN","DG53683P",46,0)
 Q
"RTN","DG53683P",47,0)
FAC ;Add treating specialty to Facility Treating Specialty file (#45.7)
"RTN","DG53683P",48,0)
 N DA,DGFILE,DGMULT,DIC,DIE,DLAYGO,DR,X,Y
"RTN","DG53683P",49,0)
 S DIC="^DIC(45.7,"
"RTN","DG53683P",50,0)
 S DIC(0)="LXZ"
"RTN","DG53683P",51,0)
 S DLAYGO=45.7
"RTN","DG53683P",52,0)
 S X=$P(DGSPEC,U,2)
"RTN","DG53683P",53,0)
 D ^DIC
"RTN","DG53683P",54,0)
 S DGDA1=Y
"RTN","DG53683P",55,0)
 I +DGDA1=-1 D BMES^XPDUTL("     Entry not added to FACILITY TREATING SPECIALTY File(#45.7).") Q
"RTN","DG53683P",56,0)
 I $P(DGDA1,U,3)'=1&($P(Y(0),U,2)'=$P(DGSPEC,U)) D  Q
"RTN","DG53683P",57,0)
 .D BMES^XPDUTL("     Entry exists in FACILITY TREATING SPECIALTY File (#45.7), but with")
"RTN","DG53683P",58,0)
 .D MES^XPDUTL("     a different PTF Code #.  No further updating will occur.")
"RTN","DG53683P",59,0)
 .D MES^XPDUTL("     Please review entry.")
"RTN","DG53683P",60,0)
 .Q
"RTN","DG53683P",61,0)
 D BMES^XPDUTL("     Entry "_$S($P(DGDA1,U,3)=1:"added to",1:"exists in")_" FACILITY TREATING SPECIALTY File (#45.7).")
"RTN","DG53683P",62,0)
 D MES^XPDUTL("     Updating SPECIALTY field...")
"RTN","DG53683P",63,0)
 S DIE=DIC
"RTN","DG53683P",64,0)
 S DA=+DGDA1
"RTN","DG53683P",65,0)
 S DR="1////"_$P(DGSPEC,U)
"RTN","DG53683P",66,0)
 D ^DIE
"RTN","DG53683P",67,0)
 S DGFILE=45.7
"RTN","DG53683P",68,0)
 S DGMULT=100
"RTN","DG53683P",69,0)
 S DIC="^DIC(45.7,"_+DGDA1_",""E"","
"RTN","DG53683P",70,0)
 D MULT
"RTN","DG53683P",71,0)
 Q
"RTN","DG53683P",72,0)
MULT ;Add Effective Date
"RTN","DG53683P",73,0)
 N DA,DIE,DR
"RTN","DG53683P",74,0)
 S DA(1)=+DGDA1
"RTN","DG53683P",75,0)
 S DIC(0)="LX"
"RTN","DG53683P",76,0)
 S DIC("P")=$P(^DD(DGFILE,DGMULT,0),"^",2)
"RTN","DG53683P",77,0)
 S X=3060701
"RTN","DG53683P",78,0)
 D ^DIC
"RTN","DG53683P",79,0)
 S DA=+Y
"RTN","DG53683P",80,0)
 I +Y=-1 D MES^XPDUTL("     Effective date not added.") Q
"RTN","DG53683P",81,0)
 D MES^XPDUTL("     Effective date added.")
"RTN","DG53683P",82,0)
 S DIE=DIC
"RTN","DG53683P",83,0)
 S DR=".02///Y"
"RTN","DG53683P",84,0)
 D ^DIE
"RTN","DG53683P",85,0)
 Q
"RTN","DG53683P",86,0)
INACT80 ;inactivate code 80
"RTN","DG53683P",87,0)
 N DA,DIE,DR,X
"RTN","DG53683P",88,0)
 S DIC="^DIC(42.4,80,""E"","
"RTN","DG53683P",89,0)
 S DA(1)=80
"RTN","DG53683P",90,0)
 S DIC(0)="LX"
"RTN","DG53683P",91,0)
 S DIC("P")=$P(^DD(42.4,10,0),"^",2)
"RTN","DG53683P",92,0)
 S X=3060802
"RTN","DG53683P",93,0)
 D ^DIC
"RTN","DG53683P",94,0)
 S DA=+Y
"RTN","DG53683P",95,0)
 D BMES^XPDUTL("  ")
"RTN","DG53683P",96,0)
 D BMES^XPDUTL("  ")
"RTN","DG53683P",97,0)
 D BMES^XPDUTL("  ")
"RTN","DG53683P",98,0)
 I +Y=-1 D BMES^XPDUTL(">>>Inactive date not added to 80-NHCU in the Specialty file.") Q
"RTN","DG53683P",99,0)
 D BMES^XPDUTL(">>>Inactive date added to 80-NHCU in the Specialty file.<<<")
"RTN","DG53683P",100,0)
 S DIE=DIC
"RTN","DG53683P",101,0)
 S DR=".02///N"
"RTN","DG53683P",102,0)
 D ^DIE
"RTN","DG53683P",103,0)
 ;
"RTN","DG53683P",104,0)
 ; -- check for NHCU 80 in the Facility Treating Specialty File (45.7
"RTN","DG53683P",105,0)
 ;    add inactivation date of 8/2/2006
"RTN","DG53683P",106,0)
 ;
"RTN","DG53683P",107,0)
 D BMES^XPDUTL("  ")
"RTN","DG53683P",108,0)
 D MES^XPDUTL("     FACILITY TREATING SPECIALTY FILE being checked to see if any entries are")
"RTN","DG53683P",109,0)
 D MES^XPDUTL("     pointing to 80-NHCU.  If so, they will be inactivated.>>>")
"RTN","DG53683P",110,0)
 N DAA F DAA=0:0 S DAA=$O(^DIC(45.7,"ASPEC",80,DAA)) Q:'DAA  D
"RTN","DG53683P",111,0)
 . N DIE,DR,TS,X S TS=""
"RTN","DG53683P",112,0)
 .S TS=$P($G(^DIC(45.7,DAA,0)),"^")
"RTN","DG53683P",113,0)
 .S DIC="^DIC(45.7,"_DAA_",""E"","
"RTN","DG53683P",114,0)
 .S DA(1)=DAA
"RTN","DG53683P",115,0)
 .S DIC(0)="LX"
"RTN","DG53683P",116,0)
 .S X=3060802
"RTN","DG53683P",117,0)
 .D ^DIC
"RTN","DG53683P",118,0)
 .S DA=+Y
"RTN","DG53683P",119,0)
 .I +Y=-1 D BMES^XPDUTL("     Inactive date not added to "_TS_" in the Facility Treating Specialty file.") Q
"RTN","DG53683P",120,0)
 . D BMES^XPDUTL("     Inactive date added to "_TS_" in the Facility Treating Specialty file.")
"RTN","DG53683P",121,0)
 .S DIE=DIC
"RTN","DG53683P",122,0)
 .S DR=".02///N"
"RTN","DG53683P",123,0)
 .D ^DIE
"RTN","DG53683P",124,0)
 Q
"RTN","DG53683P",125,0)
INACT ;inactivate mental health codes
"RTN","DG53683P",126,0)
 N DA,DIE,DR,X,MHCD
"RTN","DG53683P",127,0)
 F MHCD=70,71,76,77,75,90,84 D
"RTN","DG53683P",128,0)
 . S DIC="^DIC(42.4,"_MHCD_",""E"","
"RTN","DG53683P",129,0)
 . S DA(1)=MHCD
"RTN","DG53683P",130,0)
 . S DIC(0)="LX"
"RTN","DG53683P",131,0)
 . S DIC("P")=$P(^DD(42.4,10,0),"^",2)
"RTN","DG53683P",132,0)
 . S X=3060701
"RTN","DG53683P",133,0)
 . D ^DIC
"RTN","DG53683P",134,0)
 . S DA=+Y
"RTN","DG53683P",135,0)
 . I +Y=-1 D BMES^XPDUTL(">>>Inactive date not added to MH code "_MHCD_" in the Specialty file.") Q
"RTN","DG53683P",136,0)
 . D BMES^XPDUTL(">>>Inactive date added to MH code "_MHCD_" in the Specialty file.<<<")
"RTN","DG53683P",137,0)
 . S DIE=DIC
"RTN","DG53683P",138,0)
 . S DR=".02///N"
"RTN","DG53683P",139,0)
 . D ^DIE
"RTN","DG53683P",140,0)
 . ;
"RTN","DG53683P",141,0)
 . ;check for MH CODES in the Facility Treating Specialty File (45.7
"RTN","DG53683P",142,0)
 . ;add inactivation date of 7/1/2006
"RTN","DG53683P",143,0)
 . ;
"RTN","DG53683P",144,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53683P",145,0)
 . D MES^XPDUTL("     FACILITY TREATING SPECIALTY FILE being checked to see if any entries are")
"RTN","DG53683P",146,0)
 . D MES^XPDUTL("     pointing to "_MHCD_".  If so, they will be inactivated.>>>")
"RTN","DG53683P",147,0)
 .N DAA F DAA=0:0 S DAA=$O(^DIC(45.7,"ASPEC",MHCD,DAA)) Q:'DAA  D
"RTN","DG53683P",148,0)
 .. N DIE,DR,TS,X S TS=""
"RTN","DG53683P",149,0)
 ..S TS=$P($G(^DIC(45.7,DAA,0)),"^")
"RTN","DG53683P",150,0)
 ..S DIC="^DIC(45.7,"_DAA_",""E"","
"RTN","DG53683P",151,0)
 ..S DA(1)=DAA
"RTN","DG53683P",152,0)
 ..S DIC(0)="LX"
"RTN","DG53683P",153,0)
 ..S X=3060701
"RTN","DG53683P",154,0)
 ..D ^DIC
"RTN","DG53683P",155,0)
 ..S DA=+Y
"RTN","DG53683P",156,0)
 ..I +Y=-1 D BMES^XPDUTL("     Inactive date not added to "_TS_"in the Facility Treating Specialty file.") Q
"RTN","DG53683P",157,0)
 ..D BMES^XPDUTL("     Inactive date added to "_TS_" in the Facility Treating Specialty file.<<<")
"RTN","DG53683P",158,0)
 ..S DIE=DIC
"RTN","DG53683P",159,0)
 ..S DR=".02///N"
"RTN","DG53683P",160,0)
 ..D ^DIE
"RTN","DG53683P",161,0)
 Q
"RTN","DG53683P",162,0)
EDIT ;Edit treating specialties
"RTN","DG53683P",163,0)
 ;
"RTN","DG53683P",164,0)
 N DS,DIE,DR,DGI
"RTN","DG53683P",165,0)
 S DIE="^DIC(42.4,"
"RTN","DG53683P",166,0)
 S DIC(0)="LX"
"RTN","DG53683P",167,0)
 F DGI=1:1 S DGSPEC=$P($T(ETRSP+DGI),";;",2) Q:DGSPEC="QUIT"  D
"RTN","DG53683P",168,0)
 . S DGERR=0
"RTN","DG53683P",169,0)
 . S DA=$P(DGSPEC,U)
"RTN","DG53683P",170,0)
 . S DR=".01///"_$P(DGSPEC,U,2)_";1///"_$P(DGSPEC,U,3)_";3///"_$P(DGSPEC,U,4)_";4///"_$P(DGSPEC,U,5)_";5///"_$P(DGSPEC,U,6)_";6///"_$P(DGSPEC,U,7)
"RTN","DG53683P",171,0)
 . D ^DIE
"RTN","DG53683P",172,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53683P",173,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53683P",174,0)
 . D BMES^XPDUTL(">>>"_$P(DGSPEC,U)_" code updated to "_$P(DGSPEC,U,2)_" in the Specialty file.>>>")
"RTN","DG53683P",175,0)
 N DS,DIE,DR,DGI,DGII,DGSP,CNT,DGSPEC,DGSPEC1
"RTN","DG53683P",176,0)
 S DIE="^DIC(45.7,"
"RTN","DG53683P",177,0)
 S DIC(0)="LX"
"RTN","DG53683P",178,0)
 F DGI=1:1 S DGSPEC=$P($T(ETRSP+DGI),";;",2) Q:DGSPEC="QUIT"  D
"RTN","DG53683P",179,0)
 . S DGERR=0
"RTN","DG53683P",180,0)
 . S DGSP=$P(DGSPEC,U)
"RTN","DG53683P",181,0)
 . S CNT=0,DGSPEC1=0 F DGII=0:0 S DGSPEC1=$O(^DIC(45.7,"ASPEC",DGSP,DGSPEC1)) Q:'DGSPEC1  S CNT=CNT+1 D
"RTN","DG53683P",182,0)
 .. I CNT=1 D
"RTN","DG53683P",183,0)
 ... I $$ACTIVE^DGACT(45.7,DGSPEC1)'=1 S CNT=0 Q
"RTN","DG53683P",184,0)
 ... S DA=DGSPEC1,DR=".01///"_$P(DGSPEC,U,2)_";99///@"
"RTN","DG53683P",185,0)
 ... D BMES^XPDUTL("     "_$P(^DIC(45.7,DGSPEC1,0),U)_" name has been changed to "_$P(DGSPEC,U,2)_" in the Facility Treating Specialty file.")
"RTN","DG53683P",186,0)
 ... D ^DIE
"RTN","DG53683P",187,0)
 .. E  D
"RTN","DG53683P",188,0)
 ... S TS=""
"RTN","DG53683P",189,0)
 ... S TS=$P($G(^DIC(45.7,DGSPEC1,0)),"^")
"RTN","DG53683P",190,0)
 ... D BMES^XPDUTL("     Please review Facility Treating Specialty "_TS_".  The entry name may need changing or entry may need inactivating since more than one entry points to "_$P(DGSPEC,U,2)_" in the Specialty file.<<<")
"RTN","DG53683P",191,0)
 Q
"RTN","DG53683P",192,0)
TRSP ;PTF code^Speciality^Print Name^Service^Ask Psych^Billing Bedsection^CDR^^Ques#
"RTN","DG53683P",193,0)
 ;;64^NH SHORT STAY REHABILITATION^NH SS REHAB^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",194,0)
 ;;66^NH SHORT STAY RESTORATIVE^NH SS RESTOR^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",195,0)
 ;;67^NH SHORT STAY MAINTENANCE^NH SS MAINT^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",196,0)
 ;;68^NH SHORT STAY PSYCHIATRIC CARE^NH SS PSYCH^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",197,0)
 ;;69^NH SHORT STAY DEMENTIA CARE^NH SS DEMENTIA^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",198,0)
 ;;42^NH LONG STAY DEMENTIA CARE^NH LS DEMENTIA^NH^N^NURSING HOME CARE^1410^^
"RTN","DG53683P",199,0)
 ;;43^NH LONG STAY SKILLED NURSING^NH LS SKILL NUR^NH^N^NURSING HOME CARE^1410^^
"RTN","DG53683P",200,0)
 ;;44^NH LONG STAY MAINTENANCE CARE^NH LS MAINT^NH^N^NURSING HOME CARE^1410^^
"RTN","DG53683P",201,0)
 ;;45^NH LONG STAY PSYCHIATRIC CARE^NH LS PSYCH^NH^N^NURSING HOME CARE^1410^^
"RTN","DG53683P",202,0)
 ;;46^NH LONG STAY SPINAL CORD INJ^NH LS SPINAL^NH^N^NURSING HOME CARE^1410^^
"RTN","DG53683P",203,0)
 ;;47^NH RESPITE CARE (NHCU)^NH RC-NHCU^NH^N^^1430^^
"RTN","DG53683P",204,0)
 ;;QUIT
"RTN","DG53683P",205,0)
 ;
"RTN","DG53683P",206,0)
ETRSP ;;PTF code^Speciality^Print Name^Service^Ask Psych^Billing Bedsection^CDR
"RTN","DG53683P",207,0)
 ;;83^RESPITE CARE (MEDICINE)^RC-MEDICINE^RESPITE CARE^N^^1110^^
"RTN","DG53683P",208,0)
 ;;95^NH SHORT STAY SKILLED NURSING^NH SS SKILL^NH^N^NURSING HOME CARE^1430^^
"RTN","DG53683P",209,0)
 ;;96^NH HOSPICE^NH HOSPICE^NH^N^NURSING HOME CARE^1425^^
"RTN","DG53683P",210,0)
 ;;81^NH GEM NURSING HOME CARE^NH GEM NHC^NH^N^NURSING HOME CARE^1420^^
"RTN","DG53683P",211,0)
 ;;QUIT
"RTN","DG53683P",212,0)
 Q
"RTN","DGACT")
0^2^B715902^B731706
"RTN","DGACT",1,0)
DGACT ;ALB/CAW - Active check for facility TS or Specialty ; 7/27/94
"RTN","DGACT",2,0)
 ;;5.3;Registration;**64,683**;Aug 13, 1993
"RTN","DGACT",3,0)
 ;
"RTN","DGACT",4,0)
 ;
"RTN","DGACT",5,0)
ACTIVE(FILE,IEN,DGDT) ; Extrinsic function to determine if TS entry is active
"RTN","DGACT",6,0)
 ;
"RTN","DGACT",7,0)
 ;     Input -- FILE to determine if checking facility TS or TS
"RTN","DGACT",8,0)
 ;                  FACILITY TREATING SPECIALTY (45.7)
"RTN","DGACT",9,0)
 ;                  SPECIALTY (42.4)
"RTN","DGACT",10,0)
 ;          IEN is the internal IFN of whichever file passed in
"RTN","DGACT",11,0)
 ;       DGDT as 'as of' date (uses DT if undefined)
"RTN","DGACT",12,0)
 ;    Output -- 1 if active, 0 otherwise
"RTN","DGACT",13,0)
 ;
"RTN","DGACT",14,0)
 N DGID,Y,X
"RTN","DGACT",15,0)
 S DGID=$S($G(DGDT):DGDT,1:DT)
"RTN","DGACT",16,0)
 S DGID=$S('$P(DGID,".",2):(DGID)_.2359,1:(DGID)),DGID=-DGID
"RTN","DGACT",17,0)
 S Y=0
"RTN","DGACT",18,0)
 S ID=$O(^DIC(FILE,IEN,"E","ADATE",DGID)) G:'ID ACTIVEQ
"RTN","DGACT",19,0)
 S ID=$O(^DIC(FILE,IEN,"E","ADATE",ID,0))
"RTN","DGACT",20,0)
 S X=$G(^DIC(FILE,IEN,"E",ID,0)) I 'X G ACTIVEQ
"RTN","DGACT",21,0)
 I $P(X,"^",2)=1 S Y=1
"RTN","DGACT",22,0)
ACTIVEQ Q $S(Y:1,1:0)
"RTN","DGPMV10")
0^4^B28791536^B28144594
"RTN","DGPMV10",1,0)
DGPMV10 ;ALB/MRL/MIR - PATIENT MOVEMENT, CONT.; 11 APR 89 ; 4/15/03 5:48pm
"RTN","DGPMV10",2,0)
 ;;5.3;Registration;**84,498,509,683**;Aug 13, 1993
"RTN","DGPMV10",3,0)
CS ;Current Status
"RTN","DGPMV10",4,0)
 ;first print primary care team/practitioner/attending
"RTN","DGPMV10",5,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","DGPMV10",6,0)
 S X=$S('DGPMT:1,DGPMT<4:2,DGPMT>5:2,1:3) ;DGPMT=0 if from pt inq (DGRPD)
"RTN","DGPMV10",7,0)
 I '$D(^DGPM("C",DFN)) W !!,"Status      : PATIENT HAS NO INPATIENT OR LODGER ACTIVITY IN THE COMPUTER",*7 D CS2 Q
"RTN","DGPMV10",8,0)
 S A=$S("^3^5^"[("^"_+DGPMVI(2)_"^"):0,1:+DGPMVI(2)) W !!,"Status      : ",$S('A:"IN",1:""),"ACTIVE ",$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"LODGER",1:"INPATIENT")
"RTN","DGPMV10",9,0)
 G CS1:'A W "-" S X=+DGPMVI(4) I X=1 W "on PASS" G CS1
"RTN","DGPMV10",10,0)
 I "^2^3^25^26^"[("^"_X_"^") W "on ",$S("^2^26^"[X:"A",1:"U"),"A" G CS1
"RTN","DGPMV10",11,0)
 I "^13^43^44^45^"[("^"_X_"^") W "ASIH" G CS1
"RTN","DGPMV10",12,0)
 I X=6 W "OTHER FAC" G CS1
"RTN","DGPMV10",13,0)
 W "on WARD"
"RTN","DGPMV10",14,0)
CS1 I +DGPMVI(2)=3,$D(^DGPM(+DGPMVI(17),0)) W ?39,"Discharge Type : ",$S($D(^DG(405.1,+$P(^(0),"^",4),0)):$P(^(0),"^",1),1:"UNKNOWN")
"RTN","DGPMV10",15,0)
 I "^3^4^5^"'[("^"_+DGPMVI(2)_"^"),$D(^DPT(DFN,"DAC")),($P(^("DAC"),"^",1)="S") W "  (Seriously ill)"
"RTN","DGPMV10",16,0)
 W ! I +DGPMVI(19,1) W "Patient chose not to be included in the Facility Directory for this admission"
"RTN","DGPMV10",17,0)
 W !,$S("^4^5^"'[("^"_+DGPMVI(2)_"^"):"Admitted    ",1:"Checked-in  "),": "_$P(DGPMVI(13,1),"^",2)
"RTN","DGPMV10",18,0)
 W ?39,$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"Checked-out",+DGPMVI(2)=3:"Discharged ",1:"Transferred"),"    : ",$S("^1^4^"'[("^"_+DGPMVI(2)_"^"):$P(DGPMVI(3),"^",2),$P(DGPMVI(3),"^",2)'=$P(DGPMVI(13,1),"^",2):$P(DGPMVI(3),"^",2),1:"")
"RTN","DGPMV10",19,0)
 W !,"Ward        : ",$E($P(DGPMVI(5),"^",2),1,24),?39,"Room-Bed       : ",$E($P(DGPMVI(6),"^",2),1,21) I "^4^5^"'[("^"_+DGPMVI(2)_"^") W !,"Provider    : ",$E($P(DGPMVI(7),"^",2),1,26),?39,"Specialty      : "
"RTN","DGPMV10",20,0)
 N DGTS
"RTN","DGPMV10",21,0)
 S DGTS=$G(^DIC(42.4,+$P($G(^DIC(45.7,+DGPMVI(8),0)),"^",2),0))
"RTN","DGPMV10",22,0)
 W $S($P((DGTS),"^",2)'="":$E($P((DGTS),"^",2),1,21),1:$E($P((DGTS),"^"),1,21))
"RTN","DGPMV10",23,0)
 W !,"Attending   : ",$E($P(DGPMVI(18),"^",2),1,26)
"RTN","DGPMV10",24,0)
 D CS2
"RTN","DGPMV10",25,0)
 S DGPMIFN=DGPMVI(13) I +DGPMVI(2)'=4&(+DGPMVI(2)'=5) D ^DGPMLOS W !!,"Admission LOS: ",+$P(X,"^",5),"  Absence days: ",+$P(X,"^",2),"  Pass Days: ",+$P(X,"^",3),"  ASIH days: ",+$P(X,"^",4)
"RTN","DGPMV10",26,0)
 K A,C,I,J,X
"RTN","DGPMV10",27,0)
 Q
"RTN","DGPMV10",28,0)
 ;
"RTN","DGPMV10",29,0)
CS2 ;-- additional fields for admission screen
"RTN","DGPMV10",30,0)
 Q:DGPMT'=1
"RTN","DGPMV10",31,0)
 S DGHOLD=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","DGPMV10",32,0)
 W !!,"Religion    : ",$S($D(^DIC(13,+$P(DGHOLD,U,8),0)):$E($P(^(0),U),1,24),1:"")
"RTN","DGPMV10",33,0)
 W ?39,"Marital Status : ",$S($D(^DIC(11,+$P(DGHOLD,U,5),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",34,0)
 S DGHOLD=$S($D(^DPT(DFN,.36)):$P(^(.36),U),1:"")
"RTN","DGPMV10",35,0)
 W !,"Eligibility : ",$S($D(^DIC(8,+$P(DGHOLD,U),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",36,0)
 S DGHOLD=$S($D(^DPT(DFN,.361)):^(.361),1:"")
"RTN","DGPMV10",37,0)
 W:$P(DGHOLD,U)]"" " (",$P($P($P(^DD(2,.3611,0),U,3),$P(DGHOLD,U)_":",2),";"),")"
"RTN","DGPMV10",38,0)
 W:$P(DGHOLD,U)']"" " (NOT VERIFIED)"
"RTN","DGPMV10",39,0)
 K DGHOLD
"RTN","DGPMV10",40,0)
 Q
"RTN","DGPMV10",41,0)
 ;
"RTN","DGPMV10",42,0)
LODGER ;set-up necessary variables if getting last lodger episode
"RTN","DGPMV10",43,0)
 ;only need 1,2,13,17 - date/time,TT,check-in IFN,check-out IFN
"RTN","DGPMV10",44,0)
 S I=$O(^DGPM("ATID4",DFN,0)),I=$O(^(+I,0))
"RTN","DGPMV10",45,0)
 S X=$S($D(^DGPM(+I,0)):^(0),1:"") I 'X D NULL Q
"RTN","DGPMV10",46,0)
 I $D(^DGPM(+$P(X,"^",17),0)) S (DGPMDCD,DGPMVI(1))=+^(0),DGPMVI(2)=5,DGPMVI(13)=I,DGPMVI(17)=$P(X,"^",17) Q
"RTN","DGPMV10",47,0)
 S (DGPMDCD,DGPMVI(17))="",DGPMVI(1)=+X,DGPMVI(2)=4,DGPMVI(13)=I
"RTN","DGPMV10",48,0)
 Q
"RTN","DGPMV10",49,0)
NULL S DGPMDCD="" F I=1,2,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",50,0)
 Q
"RTN","DGPMV10",51,0)
 ;
"RTN","DGPMV10",52,0)
INP ;set-up inpt vbls needed (mimic VAIP array)
"RTN","DGPMV10",53,0)
 ;
"RTN","DGPMV10",54,0)
 ;Called from scheduling, too
"RTN","DGPMV10",55,0)
 ;
"RTN","DGPMV10",56,0)
 D NOW^%DTC S (VAX("DAT"),NOW)=%,NOWI=9999999.999999-% I '$D(VAIP("E")) D LAST^VADPT3
"RTN","DGPMV10",57,0)
 F I=1:1:8,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",58,0)
 F I=13,19 S DGPMVI(I,1)=""
"RTN","DGPMV10",59,0)
 S DGPMVI(1)=$S($D(VAIP("E")):VAIP("E"),1:E) ;use ifn of last mvt from VADPT call or one passed from DGPMV
"RTN","DGPMV10",60,0)
 S DGX=$G(^DGPM(+DGPMVI(1),0)),DGPMVI(2)=$P(DGX,"^",2),DGPMVI(4)=$P(DGX,"^",18) S Y=+DGX X ^DD("DD") S DGPMVI(3)=$P(DGX,"^",1)_"^"_Y
"RTN","DGPMV10",61,0)
 S DGPMVI(5)=$P(DGX,"^",6)_"^"_$S($D(^DIC(42,+$P(DGX,"^",6),0)):$P(^(0),"^",1),1:""),DGPMVI(6)=$P(DGX,"^",7)_"^"_$S($D(^DG(405.4,+$P(DGX,"^",7),0)):$P(^(0),"^",1),1:""),DGPMVI(13)=$P(DGX,"^",14)
"RTN","DGPMV10",62,0)
 I "^3^5^"[("^"_DGPMVI(2)_"^") D GETWD ;get from ward if d/c or check-out
"RTN","DGPMV10",63,0)
 S DGX=$G(^DGPM(+DGPMVI(13),0)) I DGX]"" S Y=+DGX X ^DD("DD") S DGPMVI(13,1)=$P(DGX,"^",1)_"^"_Y,DGPMVI(17)=$P(DGX,"^",17) I $D(DGPMSVC) S DGPMSV=$P($G(^DIC(42,+$P(DGX,"^",6),0)),"^",3)
"RTN","DGPMV10",64,0)
 S DGPMDCD=$S($D(^DGPM(+DGPMVI(17),0)):$P(^(0),"^",1),1:"")
"RTN","DGPMV10",65,0)
 S (DGTS,DGPP,DGAP)="" ;t.s., primary care physician, attending
"RTN","DGPMV10",66,0)
 F I=NOWI:0 S I=$O(^DGPM("ATS",DFN,+DGPMVI(13),I)) Q:'I  F J=0:0 S J=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J)) Q:'J  F IFN=0:0 S IFN=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J,IFN)) Q:'IFN  D TS1 G TSQ:DGTS&DGPP&DGAP
"RTN","DGPMV10",67,0)
TSQ S DGPMVI(7)=DGPP,DGPMVI(8)=DGTS,DGPMVI(18)=DGAP
"RTN","DGPMV10",68,0)
 S DGX=$G(^DGPM(+DGPMVI(13),0)) I $P(DGX,"^",2)=1 D
"RTN","DGPMV10",69,0)
 .S DGX=$G(^DGPM(+DGPMVI(13),"DIR"))
"RTN","DGPMV10",70,0)
 .S DGX=$P(DGX,"^",1)
"RTN","DGPMV10",71,0)
 .I DGX="" S DGX=$S('DGPMDCD:1,(DGPMDCD<3030414.999999):"",1:1) Q:DGX=""
"RTN","DGPMV10",72,0)
 .S DGPMVI(19,1)=DGX_"^"_$$EXTERNAL^DILFD(405,41,,DGX)
"RTN","DGPMV10",73,0)
 D Q^VADPT3 K DGAP,DGPP,DGTS,DGX,IFN
"RTN","DGPMV10",74,0)
 Q
"RTN","DGPMV10",75,0)
 ;
"RTN","DGPMV10",76,0)
TS1 ; set DGTS, DGPP, and DGAP
"RTN","DGPMV10",77,0)
 Q:'$D(^DGPM(IFN,0))  S DGX=^(0)
"RTN","DGPMV10",78,0)
 I 'DGPP,$D(^VA(200,+$P(DGX,"^",8),0)) S Y=$P(DGX,"^",8)_"^"_$P(^(0),"^") S DGPP=Y
"RTN","DGPMV10",79,0)
 I 'DGAP,$D(^VA(200,+$P(DGX,"^",19),0)) S Y=$P(DGX,"^",19)_"^"_$P(^(0),"^") S DGAP=Y
"RTN","DGPMV10",80,0)
 I 'DGTS,$D(^DIC(45.7,+$P(DGX,"^",9),0)) S DGTS=$P(DGX,"^",9)_"^"_$P(^(0),"^")
"RTN","DGPMV10",81,0)
 Q
"RTN","DGPMV10",82,0)
GETWD ;get the from ward if last mvt is discharge or check-out
"RTN","DGPMV10",83,0)
 I DGPMVI(2)=5 S J=DGPMVI(13) D SETWD Q
"RTN","DGPMV10",84,0)
 F I=0:0 S I=$O(^DGPM("APMV",DFN,DGPMVI(13),I)) Q:'I!+DGPMVI(5)  F J=0:0 S J=$O(^DGPM("APMV",DFN,DGPMVI(13),I,J)) Q:'J  D SETWD Q:+DGPMVI(5)
"RTN","DGPMV10",85,0)
 Q
"RTN","DGPMV10",86,0)
 ;
"RTN","DGPMV10",87,0)
SETWD ;set ward and room-bed variables for discharge/check-out mvts
"RTN","DGPMV10",88,0)
 S X=$G(^DGPM(J,0))
"RTN","DGPMV10",89,0)
 I $D(^DIC(42,+$P(X,"^",6),0)) S DGPMVI(5)=$P(X,"^",6)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",90,0)
 I $D(^DG(405.4,+$P(X,"^",7),0)) S DGPMVI(6)=$P(X,"^",7)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",91,0)
 Q
"RTN","DGPTAE02")
0^1^B19447484^B19921067
"RTN","DGPTAE02",1,0)
DGPTAE02        ;ALB/MTC - 701 Edit Checks ;11/01/2005
"RTN","DGPTAE02",2,0)
 ;;5.3;Registration;**8,22,39,114,176,251,247,270,446,418,482,466,683**;Aug 13, 1993
"RTN","DGPTAE02",3,0)
 ;10/06/1999 ACS - Added Place of Disposition codes M,Y,Z to the
"RTN","DGPTAE02",4,0)
 ;validity checks
"RTN","DGPTAE02",5,0)
 ;5/15/2000 ACS - Added Treating Specialty 37 as a valid code
"RTN","DGPTAE02",6,0)
 ;5/16/2000 MM  - Added Treating Specialties 38 & 39 as valid codes
"RTN","DGPTAE02",7,0)
 ;5/26/2000 JRP - Place of Disposition code M valid for station
"RTN","DGPTAE02",8,0)
 ;                types 10, 11, 30, and 40
"RTN","DGPTAE02",9,0)
 ;
"RTN","DGPTAE02",10,0)
CHECK ;
"RTN","DGPTAE02",11,0)
 I (DGPTSP1'?1N)!(DGPTSP2'?1N) S DGPTERC=1 Q
"RTN","DGPTAE02",12,0)
 I DGPTSP1="0"&((DGPTSP2'?1N)!(DGPTSP2="0")) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",13,0)
 ; No zero or double zeroes allowed
"RTN","DGPTAE02",14,0)
 I DGPTSP1=1&(DGPTSP2=3) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",15,0)
 ; No codes 13
"RTN","DGPTAE02",16,0)
 ;I DGPTSP1=3&((DGPTSP2="0")!(DGPTSP2>6)) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",17,0)
 I DGPTSP1=3&((DGPTSP2="0")) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",18,0)
 ; No codes 30
"RTN","DGPTAE02",19,0)
 I DGPTSP1=4&(DGPTSP2>7) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",20,0)
 ; No codes 48-49
"RTN","DGPTAE02",21,0)
 I DGPTSP1=5 G EXIT
"RTN","DGPTAE02",22,0)
 ; All codes 50-59 allowable
"RTN","DGPTAE02",23,0)
 I DGPTSP1=7&(DGPTSP2=8) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",24,0)
 ; No code 78
"RTN","DGPTAE02",25,0)
 I DGPTSP1=8&(DGPTSP2=2) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",26,0)
 ; No code 82
"RTN","DGPTAE02",27,0)
 I DGPTSP1=9&(DGPTSP2=7) S DGPTERC=1 G EXIT
"RTN","DGPTAE02",28,0)
 ; No code 97;
"RTN","DGPTAE02",29,0)
 ; New code 95:p-418
"RTN","DGPTAE02",30,0)
 ; New code 96;p-446
"RTN","DGPTAE02",31,0)
EXIT ;
"RTN","DGPTAE02",32,0)
 K DGPTSP1,DGPTSP2
"RTN","DGPTAE02",33,0)
 Q
"RTN","DGPTAE02",34,0)
 ;
"RTN","DGPTAE02",35,0)
DISPTY ;
"RTN","DGPTAE02",36,0)
 N I
"RTN","DGPTAE02",37,0)
 S DGPTERC=0
"RTN","DGPTAE02",38,0)
 Q:"1"[DGPTDTY
"RTN","DGPTAE02",39,0)
 I DGPTDTY=2 S DGPTERC=707 F I=10,11,30,40,42 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE02",40,0)
 I DGPTERC Q
"RTN","DGPTAE02",41,0)
 ;
"RTN","DGPTAE02",42,0)
 ;-- if dis type = To Non-Bed Care then VA aus and Out pat = no
"RTN","DGPTAE02",43,0)
 ;I DGPTDTY=2,((DGPTDVA'=2)!(DGPTDOP'=3)) S DGPTERC=707 Q
"RTN","DGPTAE02",44,0)
 ;
"RTN","DGPTAE02",45,0)
 I DGPTDTY=3&(DGPTSTTY'["^42^") S DGPTERC=707 Q
"RTN","DGPTAE02",46,0)
 ;-- if dis type = Transfer then Out pat cannot be yes
"RTN","DGPTAE02",47,0)
 I DGPTDTY=5,DGPTDOP=1 S DGPTERC=707
"RTN","DGPTAE02",48,0)
 ;-- if dis type = Transfer then Out pat cannot be yes, rec sta'=""
"RTN","DGPTAE02",49,0)
 I DGPTDTY=5,DGPTDOP'=1,'DGPTDRF S DGPTERC=711 Q
"RTN","DGPTAE02",50,0)
 ;-- if dis type irr, death w/aotopsy then va asp, op care, pod = ""
"RTN","DGPTAE02",51,0)
 I "467"[DGPTDTY,(DGPTDOP!DGPTDVA!DGPTDPD) S DGPTERC=707 Q
"RTN","DGPTAE02",52,0)
 Q
"RTN","DGPTAE02",53,0)
OP ;
"RTN","DGPTAE02",54,0)
 Q:"13"'[DGPTDOP
"RTN","DGPTAE02",55,0)
 S DGPTERC=708 F I=10,11,40,42 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE02",56,0)
 Q
"RTN","DGPTAE02",57,0)
POD ;
"RTN","DGPTAE02",58,0)
 N I
"RTN","DGPTAE02",59,0)
 Q:"X012347BCDFGHJKL "[DGPTDPD
"RTN","DGPTAE02",60,0)
 ; if POD NHCU then Out=no VA aus=yes
"RTN","DGPTAE02",61,0)
 I DGPTDPD=5,((DGPTDOP'=3)!(DGPTDVA'=1)) S DGPTERC=710 Q
"RTN","DGPTAE02",62,0)
 ; if POD NHCU then Out=no VA aus=yes, rec station'=""
"RTN","DGPTAE02",63,0)
 I DGPTDPD=5,DGPTDOP=3,DGPTDVA=1,'DGPTDRF S DGPTERC=711 Q
"RTN","DGPTAE02",64,0)
 I "PR"[DGPTDPD,((DGPTSTTY'["^10^")!(DGPTSTTY'["^11^")) S DGPTERC=710 Q
"RTN","DGPTAE02",65,0)
 I DGPTDPD="M" S DGPTERC=710 F I=10,11,30,40 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE02",66,0)
 I DGPTDPD="T" S DGPTERC=710 F I=10,11,40 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE02",67,0)
 I "UYZ"[DGPTDPD S DGPTERC=710 F I=10,11,20:1:27,30,40:1:42 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE02",68,0)
 Q
"RTN","DGPTAE02",69,0)
LEAVE ;
"RTN","DGPTAE02",70,0)
 S DGPTLVDY=0
"RTN","DGPTAE02",71,0)
 S DGPTL3=0 F  S DGPTL3=$O(^TMP("AEDIT",$J,"N501",DGPTL3)) Q:DGPTL3=""  S DGPTLVDY=DGPTLVDY+$E(^TMP("AEDIT",$J,"N501",DGPTL3),49,51)+$E(^TMP("AEDIT",$J,"N501",DGPTL3),52,54)
"RTN","DGPTAE02",72,0)
 I (DGPTLVDY+DGPTDAS)>DGPTELP S DGPTERC=745
"RTN","DGPTAE02",73,0)
 K DGPTL3,DGPTLVDY
"RTN","DGPTAE02",74,0)
 Q
"RTN","DGPTAE02",75,0)
 ;
"RTN","DGPTAE02",76,0)
CANDP ;
"RTN","DGPTAE02",77,0)
 I "12345678"'[DGPTDCP S DGPTERC=714 Q
"RTN","DGPTAE02",78,0)
 ;-- if no POS then no edit
"RTN","DGPTAE02",79,0)
 Q:DGPTPOS2=9
"RTN","DGPTAE02",80,0)
 ;-- if WWI then no edit
"RTN","DGPTAE02",81,0)
 Q:DGPTPOS2=1
"RTN","DGPTAE02",82,0)
 ;-- if POW then no edit
"RTN","DGPTAE02",83,0)
 I $L(DGPTPOW)=1,("23456789AB"[DGPTPOW) Q
"RTN","DGPTAE02",84,0)
 D CONSIS Q:DGPTERC
"RTN","DGPTAE02",85,0)
 D STATYP Q:DGPTERC
"RTN","DGPTAE02",86,0)
 D CPMT Q:DGPTERC
"RTN","DGPTAE02",87,0)
 Q
"RTN","DGPTAE02",88,0)
CONSIS ;
"RTN","DGPTAE02",89,0)
 I ("01234578X"[DGPTPOS2)&("1234567"'[DGPTDCP) S DGPTERC=736 Q
"RTN","DGPTAE02",90,0)
 I ("ABCD"[DGPTPOS2) Q
"RTN","DGPTAE02",91,0)
 I DGPTPOS2="Z"&("1234567"'[DGPTDCP) S DGPTERC=736 Q
"RTN","DGPTAE02",92,0)
 Q:"012345678ABCDXZ"[DGPTPOS2
"RTN","DGPTAE02",93,0)
 S:DGPTDCP'=8 DGPTERC=736
"RTN","DGPTAE02",94,0)
 Q
"RTN","DGPTAE02",95,0)
STATYP ;
"RTN","DGPTAE02",96,0)
 Q:(DGPTSTTY["^30^")!(DGPTSTTY="^")!(DGPTSTTY="")
"RTN","DGPTAE02",97,0)
 ;Note: There is not sufficient information contained in the
"RTN","DGPTAE02",98,0)
 ;station type to adequately perform the error check of Means Test
"RTN","DGPTAE02",99,0)
 ;indicator vs admissions date.  This issue should be revisited in 5.4.
"RTN","DGPTAE02",100,0)
 ;For now, error code 143 (previously set as 744) will not be checked
"RTN","DGPTAE02",101,0)
 ;in order to be sure that an error is not erroneously generated.
"RTN","DGPTAE02",102,0)
 Q
"RTN","DGPTAE02",103,0)
MT ;
"RTN","DGPTAE02",104,0)
 I DGPTMTC="X "&((+DGPTDTS)'<2860701) S DGPTERC=143 Q
"RTN","DGPTAE02",105,0)
 Q:DGPTMTC="X "
"RTN","DGPTAE02",106,0)
 I DGPTDTS<2860701 S DGPTERC=143 Q
"RTN","DGPTAE02",107,0)
 Q
"RTN","DGPTAE02",108,0)
 ;
"RTN","DGPTAE02",109,0)
CPMT ;-- mt and c&p checks
"RTN","DGPTAE02",110,0)
 I DGPTMTC="N ",DGPTDCP'=8 S DGPTERC=753 Q
"RTN","DGPTAE02",111,0)
 I DGPTMTC="AN","24567"'[DGPTDCP S DGPTERC=753 Q
"RTN","DGPTAE02",112,0)
 I ((DGPTMTC="B ")!(DGPTMTC="C ")!(DGPTMTC="G ")),"2467"'[DGPTDCP S DGPTERC=753 Q
"RTN","DGPTAE02",113,0)
 I DGPTMTC="AS","1234567"'[DGPTDCP S DGPTERC=753 Q
"RTN","DGPTAE02",114,0)
 Q
"RTN","DGPTAE02",115,0)
LEG ;
"RTN","DGPTAE02",116,0)
 ;I DGPTDDXE=482.8&("12"'[DGPT70LG) S DGPTERC=731 Q
"RTN","DGPTAE02",117,0)
 Q
"RTN","DGPTAE02",118,0)
SUI ;
"RTN","DGPTAE02",119,0)
 I ($E(DGPTDDXE,1,3)="E95")&("12345678"[$E(DGPTDDXE,4))&("12"'[DGPT70SU) S DGPTERC=732 Q
"RTN","DGPTAE02",120,0)
 Q
"RTN","DGPTAE02",121,0)
DRUG ;
"RTN","DGPTAE02",122,0)
 S DGPTMSX=0
"RTN","DGPTAE02",123,0)
 I ($E(DGPTDDXE,1,4)="304.")&("013456"[$E(DGPTDDXE,5))&("0123"[$E(DGPTDDXE,6)) S DGPTMSX=1
"RTN","DGPTAE02",124,0)
 I ($E(DGPTDDXE,1,4)="305.")&("234579"[$E(DGPTDDXE,5))&("0123"[$E(DGPTDDXE,6)) S DGPTMSX=1
"RTN","DGPTAE02",125,0)
 Q:'DGPTMSX
"RTN","DGPTAE02",126,0)
 I $E(DGPT70DR,1)'="A"!($E(DGPT70DR,2,4)<1)!(+$E(DGPT70DR>16)) S DGPTERC=733
"RTN","DGPTAE02",127,0)
 S DGPTMSX=0 Q
"RTN","DGPTAE02",128,0)
AXIV ;
"RTN","DGPTAE02",129,0)
 I $E(DGPTDDXE,1,3)>295,$E(DGPTDDXE,1,3)<320,"0123456"'[DGPT70X4 S DGPTERC=734
"RTN","DGPTAE02",130,0)
 Q
"RTN","DGPTAE02",131,0)
AXV1 ;
"RTN","DGPTAE02",132,0)
 I (DGPTDXV1<0)!(DGPTDXV1>90) S DGPTERC=735 Q
"RTN","DGPTAE02",133,0)
 Q
"RTN","DGPTAE02",134,0)
AXV2 ;
"RTN","DGPTAE02",135,0)
 Q:DGPTDXV2="  "
"RTN","DGPTAE02",136,0)
 I (DGPTDXV2<0)!(DGPTDXV2>90) S DGPTERC=735 Q
"RTN","DGPTAE02",137,0)
 Q
"RTN","DGPTF4")
0^5^B22914415^B23088100
"RTN","DGPTF4",1,0)
DGPTF4 ;ALB/JDS - PTF ENTRY/EDIT-4 ; 2/19/04 9:33am
"RTN","DGPTF4",2,0)
 ;;5.3;Registration;**114,115,397,510,517,478,683**;Aug 13, 1993
"RTN","DGPTF4",3,0)
 ;
"RTN","DGPTF4",4,0)
WR ;
"RTN","DGPTF4",5,0)
 W @IOF,HEAD,?72 S Z="<701>" D Z^DGPTFM K X S $P(X,"-",81)="" W !,X
"RTN","DGPTF4",6,0)
 Q
"RTN","DGPTF4",7,0)
EN S Y=+B(70) D D^DGPTUTL W ! S Z=5 D Z W $S($P(B(0),U,11)=1:"Date of Disch: ",1:"Census Date  : ") S Z=Y,Z1=20 D Z1 W "Disch Specialty: ",$S($D(^DIC(42.4,+$P(B(70),U,2),0)):$E($P(^(0),U,1),1,25),1:"")
"RTN","DGPTF4",8,0)
 W !,"   Type of Disch: " S L=";"_$P(^DD(45,72,0),U,3),L1=";"_$P(B(70),U,3)_":" W $P($P(L,L1,2),";",1),?41 S L=";"_$P(^DD(45,72.1,0),U,3),L1=";"_$P(B(70),U,14)_":" W "Disch Status: ",$P($P(L,L1,2),";",1)
"RTN","DGPTF4",9,0)
 W !,"   Place of Disp: ",$S($D(^DIC(45.6,+$P(B(70),U,6),0)):$E($P(^(0),U,1),1,21),1:"")
"RTN","DGPTF4",10,0)
 W ?40 S Z=6 D Z W " Out Treat: ",$P("YES^^NO",U,+$P(B(70),U,4))
"RTN","DGPTF4",11,0)
 W !?6,"Means Test: " S L=";"_$P(^DD(45,10,0),U,3),L1=";"_$P(B(0),U,10)_":" W $P($P(L,L1,2),";",1)
"RTN","DGPTF4",12,0)
 W ?42,"VA Auspices: ",$S($P(B(70),U,5)=1:"YES",$P(B(70),U,5)=2:"NO",1:"")
"RTN","DGPTF4",13,0)
 W ! S Z=7 D Z W " Receiv facil: " S Z=$P(B(70),U,12)_$P(B(70),U,13),Z1=18 D Z1 W ?38 S Z="Other Fields" D Z
"RTN","DGPTF4",14,0)
 S DGINC=$P(B(101),U,7)
"RTN","DGPTF4",15,0)
 I DGINC>1000 S DGINC=$E(DGINC,1,$L(DGINC)-3)_","_$E(DGINC,$L(DGINC)-2,$L(DGINC))
"RTN","DGPTF4",16,0)
 W !,"      C&P Status: " S L=";"_$P(^DD(45,78,0),U,3),L1=";"_$P(B(70),U,9)_":" W $E($P($P(L,L1,2),";",1),1,24),?47,"Income: $",DGINC
"RTN","DGPTF4",17,0)
 K DGINC
"RTN","DGPTF4",18,0)
AS ;
"RTN","DGPTF4",19,0)
 N DGRSC
"RTN","DGPTF4",20,0)
 S DGRSC=$S($P(A(.3),U)="Y":$$RTEN^DGPTR4($P(A(.3),U,2)),1:"")
"RTN","DGPTF4",21,0)
 W !,"       ASIH Days: ",$P(B(70),U,8)
"RTN","DGPTF4",22,0)
 W ?40,"SC Percentage: ",$S($P(A(.3),U)="Y":$P(A(.3),U,2)_"%",1:"")
"RTN","DGPTF4",23,0)
 I DGRSC]"",DGRSC'=$P(A(.3),U,2) W ?60,"Transmitted: ["_DGRSC_"%]"
"RTN","DGPTF4",24,0)
 ;W !,?39,"Period Of Serv: ",$S($D(^DIC(21,$S('$D(^DGPM(+$O(^DGPM("APTF",PTF,0)),"ODS")):+$P(A(.32),U,3),+^("ODS"):+$O(^DIC(21,"D",6,0)),1:+$P(A(.32),U,3)),0)):$E($P(^(0),U),1,26),1:""),!
"RTN","DGPTF4",25,0)
 W !,?39,"Period Of Serv: "
"RTN","DGPTF4",26,0)
 W $S($D(^DIC(21,$S('$D(^DGPM(+$O(^DGPM("APTF",PTF,0)),"ODS")):+$$CKPOS^DGPTUTL($P(B(101),U,8),+$P(A(.32),U,3)),+^("ODS"):+$O(^DIC(21,"D",6,0)),1:$$CKPOS^DGPTUTL($P(B(101),U,8),+$P(A(.32),U,3))),0)):$E($P(^(0),U),1,26),1:""),!
"RTN","DGPTF4",27,0)
 Q
"RTN","DGPTF4",28,0)
 ;
"RTN","DGPTF4",29,0)
EN1 ;LOAD AND DISPLAY DIAGNOSES FOR PTF 701 SCREEN
"RTN","DGPTF4",30,0)
 K DRG S B(70)=$S($D(^DGPT(PTF,70)):^(70),1:""),B(71)=$S($D(^DGPT(PTF,71)):^(71),1:"") D WR
"RTN","DGPTF4",31,0)
 S DGPTDAT=$$GETDATE^ICDGTDRG(PTF) ;Get correct effective date
"RTN","DGPTF4",32,0)
 S DGPTTMP=$$ICDDX^ICDCODE(+$P(B(70),U,10),DGPTDAT)
"RTN","DGPTF4",33,0)
 W ! S Z=1 D Z W "  Principal Diagnosis: ",$S(DGPTTMP&$P(DGPTTMP,U,10):$P(DGPTTMP,U,4)_"("_$P(DGPTTMP,U,2)_")",1:"")
"RTN","DGPTF4",34,0)
 S DGPTTMP=$$ICDDX^ICDCODE(+$P(B(70),U,11),DGPTDAT)
"RTN","DGPTF4",35,0)
 W:$P(B(70),U,11)&('$P(B(70),U,10)) !,"  Principal Diag: ",$S(DGPTTMP&$P(DGPTTMP,U,10):$P(DGPTTMP,U,4)_" ("_$P(DGPTTMP,U,2)_")",1:"")
"RTN","DGPTF4",36,0)
 S K=B(70) F I=16:1:24 D DSP
"RTN","DGPTF4",37,0)
 S K=B(71) F I=1:1:4 D DSP
"RTN","DGPTF4",38,0)
 S DGPTF=PTF D:'DGST CHK701^DGPTSCAN,UP701^DGPTSPQ
"RTN","DGPTF4",39,0)
 ; display contents of 300th node 
"RTN","DGPTF4",40,0)
 S DG300=$S($D(^DGPT(PTF,300)):^(300),1:"") D:DG300]"" PRN2^DGPTFM8 K DG300
"RTN","DGPTF4",41,0)
EN2 K DRG
"RTN","DGPTF4",42,0)
 I $D(^DGPT(PTF,0)),$P(^(0),U,11)=1 D
"RTN","DGPTF4",43,0)
 .S DA=DFN
"RTN","DGPTF4",44,0)
 .D EN1^DGPTFD
"RTN","DGPTF4",45,0)
 .I $D(DRG),$D(^DGP(45.84,PTF,0)),$P(^(0),U,6)'=DRG D
"RTN","DGPTF4",46,0)
 ..N DGFDA,DGMSG
"RTN","DGPTF4",47,0)
 ..S DGFDA(45.84,PTF_",",6)=DRG
"RTN","DGPTF4",48,0)
 ..D FILE^DIE("","DGFDA","DGMSG")
"RTN","DGPTF4",49,0)
JUMP K AGE,B,CC,DA,DAM,DOB,DXLS,EXP,I,L1,L2,SEX,DRGCAL,S,DIC,DR,DIE
"RTN","DGPTF4",50,0)
 Q:DGPR
"RTN","DGPTF4",51,0)
 ;F I=$Y:1:18 W !
"RTN","DGPTF4",52,0)
 K X S $P(X,"-",81)="" W X
"RTN","DGPTF4",53,0)
 ;
"RTN","DGPTF4",54,0)
 G O:DGST&(('$D(DRG))!('DGDD)!('$D(^DGP(45.84,PTF))))
"RTN","DGPTF4",55,0)
X G ACT^DGPTF41
"RTN","DGPTF4",56,0)
CLS G NOT:('$D(DRG))!('DGDD)!('DGFC)
"RTN","DGPTF4",57,0)
 ;I DRG=470!(DRG=469) W !!,*7,"Unable to release DRG ",DRG,". Please verify data entered.",*7 D HANG^DGPTUTL G EN1
"RTN","DGPTF4",58,0)
 ;
"RTN","DGPTF4",59,0)
 ;change made to allow release of 470, before grouper released to vamc's
"RTN","DGPTF4",60,0)
 ;  patch 115
"RTN","DGPTF4",61,0)
 I DRG=469 W !!,*7,"Unable to release DRG ",DRG,". Please verify data entered.",*7 D HANG^DGPTUTL G EN1
"RTN","DGPTF4",62,0)
 I $D(DGCST),'DGCST D CEN G EN1:'DGCST
"RTN","DGPTF4",63,0)
 I '$P(^DGPT(PTF,0),"^",4) W !,"Updating TRANSFER DRGs..." S DGADM=$P(^DGPT(PTF,0),U,2) D SUDO1^DGPTSUDO
"RTN","DGPTF4",64,0)
 I DGDD>(DT+1) W !,"Cannot close with Discharge date in future." D HANG^DGPTUTL G EN1
"RTN","DGPTF4",65,0)
 I $D(^DGM("PT",DFN)) F I=0:0 S I=$O(^DGM("PT",DFN,I)) Q:'I  I '$D(^DGM(I,0)) K ^DGM(I),^DGM("PT",DFN,I)
"RTN","DGPTF4",66,0)
 I $D(^DGM("PT",DFN)) W !!,"Not all messages have been cleared up for this patient--cannot close.",*7,*7 S DGPTF=DFN,X="??" K DGALL D HELP^DGPTMSGD K DGPTF G EN1:'$D(DGALL) K DGALL
"RTN","DGPTF4",67,0)
 G CLS^DGPTF2
"RTN","DGPTF4",68,0)
 ;
"RTN","DGPTF4",69,0)
O I '$D(^DGP(45.84,PTF,0)) S DR="6///0",DIE="^DGPT(",DA=PTF,(DGST,DGN)=0 D ^DIE W !,"  NOT CLOSED " D HANG^DGPTUTL G EN1
"RTN","DGPTF4",70,0)
 S (DGST,DGN)=0
"RTN","DGPTF4",71,0)
 S DGPTIFN=PTF,DGRTY=1 D OPEN^DGPTFDEL S DGST=0
"RTN","DGPTF4",72,0)
 K DGPTIFN,DGRTY G EN1
"RTN","DGPTF4",73,0)
 ;
"RTN","DGPTF4",74,0)
Q G Q^DGPTF
"RTN","DGPTF4",75,0)
 ;
"RTN","DGPTF4",76,0)
NOT I 'DGFC S DR="3//^S X=$P($$SITE^VASITE,U,2);5",DIE="^DGPT(",DA=PTF D ^DIE S DGFC=$P(^DGPT(PTF,0),U,3) I DGFC G EN1
"RTN","DGPTF4",77,0)
 W !!,"Unable to close without a ",$S('$D(DRG):"DRG being calculated.",'DGDD:" discharge date.",1:" facility specified"),!!,*7,*7 H 4 G EN1
"RTN","DGPTF4",78,0)
 Q
"RTN","DGPTF4",79,0)
 ;
"RTN","DGPTF4",80,0)
Z D Z^DGPTF5 Q
"RTN","DGPTF4",81,0)
Z1 D Z1^DGPTF5 Q
"RTN","DGPTF4",82,0)
CEN D CEN^DGPTF5 Q
"RTN","DGPTF4",83,0)
DSP S J=$$ICDDX^ICDCODE(+$P(K,U,I),DGPTDAT) I J&$P(J,U,10) D
"RTN","DGPTF4",84,0)
 .I I#2 W ?40,$P(J,U,4)_"("_$P(J,U,2)_")" Q
"RTN","DGPTF4",85,0)
 .W !,$P(J,U,4)_"("_$P(J,U,2)_")"
"RTN","DGPTF4",86,0)
 Q
"RTN","DGPTFM")
0^7^B44316891^B43402022
"RTN","DGPTFM",1,0)
DGPTFM ;ALB/MTC - PTF OP-PRO-DIAG ;7/22/05 9:18am
"RTN","DGPTFM",2,0)
 ;;5.3;Registration;**510,517,590,594,606,635,683**;Aug 13, 1993
"RTN","DGPTFM",3,0)
 K M,S,M1,M2,M3,S1,S2,PS2,SDCLY,^TMP("PTF",$J)
"RTN","DGPTFM",4,0)
GET S I=0 F I1=1:1 S I=$O(^DGPT(PTF,"M",I)) Q:'I  S (M3(I1),M(I1))=^(I,0) I $D(^DGPT(PTF,"M",I,"P")) S $P(M(I1),U,20)=^("P")
"RTN","DGPTFM",5,0)
 K MT D ORDER^DGPTF K MT D GETVAR^DGPTFM6,CL^SDCO21(DFN,$P(^DGPT(PTF,0),U,2),"",.SDCLY),MOB^DGPTFM2
"RTN","DGPTFM",6,0)
 S DGPC=I1-1 D WR K M1,M2,^UTILITY($J) S ST=1,M2=0
"RTN","DGPTFM",7,0)
DIAG K DGZSER,DGZPRO,DGZSUR S DGZDIAG=1 F J=ST:2:PM S NL=1,L5=0,L6=J D WD2 S L5=1,L6=J+1 D:$D(M(L6)) WD2 D WD G PRO1:$Y>16 D WD3^DGPTFM8 G PRO1:$Y>16 W !
"RTN","DGPTFM",8,0)
 S ST=1 G SER
"RTN","DGPTFM",9,0)
WD F J1=1:1:11 I J1'=6 S L=$P(M(J),U,J1+4),L1=0,L3=1 D:+L WD1 S L1=1,L=$S($D(M(J+1)):$P(M(J+1),U,J1+4),1:"") D:+L WD1
"RTN","DGPTFM",10,0)
 Q
"RTN","DGPTFM",11,0)
WD1 S N=$$ICDDX^ICDCODE(+L,$$GETDATE^ICDGTDRG(PTF)),L2=$S(N:$P(N,U,2,99),1:""),M2=M2+1,L4=$P(L2,"^",1),L4=L4_$E("   ",1,3-$L($P(L4,".",2)))
"RTN","DGPTFM",12,0)
 W:L3 ! S:L3 L3=0 W ?L1*40,$J(M2,3)," ",$J(L4,7)," ",$E($P(L2,U,3),1,25) K ^UTILITY($J,"M2",M2) S ^UTILITY($J,"M2",M2)=+M(J+L1)_U_J1 Q
"RTN","DGPTFM",13,0)
WD2 N Z3
"RTN","DGPTFM",14,0)
 X:NL "W ! S NL=0" W ?L5*40,"Move #",+L6 S Z=M(L6),Z3=M3(L6) W:+Z=1 " D/C" S Y=$P(Z,U,10)\1 D D^DGPTUTL W " ",Y," "
"RTN","DGPTFM",15,0)
 W " <",$S($P(Z3,U,18)=1:"",1:"N"),"SC"_$S($P(Z3,U,26)="Y":",AO",1:"")_$S($P(Z3,U,27)="Y":",IR",1:"")_$S($P(Z3,U,28)="Y":",EC",1:"")_">"
"RTN","DGPTFM",16,0)
 I $D(^DIC(42.4,+$P(Z,U,2),0)) D
"RTN","DGPTFM",17,0)
 . I $P(^DIC(42.4,+$P(Z,U,2),0),U,2)'="" W $E($P(^DIC(42.4,+$P(Z,U,2),0),U,2),1,10)
"RTN","DGPTFM",18,0)
 . E  W $E($P(^(0),U,1),1,10)
"RTN","DGPTFM",19,0)
 Q
"RTN","DGPTFM",20,0)
NDG D WR S I=0 K M,M1,M2 S M2=0 F I1=1:1 S I=$O(^DGPT(PTF,"M",I)) Q:I'>0  S M(I1)=^(I,0)
"RTN","DGPTFM",21,0)
 S PM=I1-1 D ORDER^DGPTF K MT G DIAG:$D(ST) G GET S ST=1
"RTN","DGPTFM",22,0)
SER K DGZDIAG,DGZPRO,DGZSUR S DGZSER=1 G PRO1:$Y>19 K S1,S2 S S2=0 G SERV:ST G PRO
"RTN","DGPTFM",23,0)
SERV F J=ST:2:SU S NL=1,L5=0,L6=J D SD2 S L5=1,L6=J+1 D:$D(S(L6)) SD2 D SD G PRO1:$Y>11 D SD3^DGPTFM8 G PRO1:$Y>11 W !
"RTN","DGPTFM",24,0)
 G PRC^DGPTFM0
"RTN","DGPTFM",25,0)
SD F J1=1:1:5 S L=$P(S(J),U,J1+7),L1=0,L3=1 D:+L SD1 S L1=1,L=$S($D(S(J+1)):$P(S(J+1),U,J1+7),1:"") D:+L SD1
"RTN","DGPTFM",26,0)
 Q
"RTN","DGPTFM",27,0)
SD1 S N=$$ICDOP^ICDCODE(+L,$$GETDATE^ICDGTDRG(PTF)),L2=$S(N:$P(N,U,2,99),1:""),S2=S2+1,L4=$P(L2,"^",1),L4=L4_$E("   ",1,3-$L($P(L4,".",2)))
"RTN","DGPTFM",28,0)
 W:L3 ! S:L3 L3=0 W ?L1*40,$J(S2,3)," ",$J(L4,7)," ",$E($P(L2,U,4),1,25) K S2(S2) S S2(S2)=J+L1_U_J1 Q
"RTN","DGPTFM",29,0)
SD2 S Y=+S(L6) D D^DGPTUTL W:NL ! S:NL NL=0 W ?L5*40,L6,"-Surgery date: ",Y
"RTN","DGPTFM",30,0)
 Q
"RTN","DGPTFM",31,0)
NSR K S,S1,S2 S I=0 F I1=1:1 S I=$O(^DGPT(PTF,"S",I)) Q:I'>0  S S(I1)=^(I,0),S(I1,1)=I
"RTN","DGPTFM",32,0)
 S S2=0,SU=I1-1 D WR G SERV
"RTN","DGPTFM",33,0)
 ;
"RTN","DGPTFM",34,0)
WR W @IOF,HEAD,?70 S Z="<MAS>" D Z Q
"RTN","DGPTFM",35,0)
PRO K DGZSER,DGZDIAG,DGZSUR S DGZPRO=1 G PRO1:$Y>14 K P1,P2 S ST=1,P2=0 G NPR:'$D(PROC)
"RTN","DGPTFM",36,0)
PROC D:$Y>14 WR W:PROC]"" !!,"Procedures: ",!
"RTN","DGPTFM",37,0)
 F J1=1:1:5 S L=$P(PROC,"^",J1) I L'="" S P2=P2+1,N=$$ICDOP^ICDCODE(+L,$$GETDATE^ICDGTDRG(PTF)),L2=$S(N:$P(N,U,2,99),1:""),L4=$P(L2,U,1),L4=L4_$E("   ",1,3-$L($P(L4,".",2))) D
"RTN","DGPTFM",38,0)
 .W:$X>5 ?40 W $J(P2,3)," ",$J(L4,7)," ",$E($P(L2,"^",4),1,25) K P2(P2) S P2(P2)=J1 W:$X>45 !
"RTN","DGPTFM",39,0)
 K DGZSER,DGZPRO,DGZDIAG,DGZSUR
"RTN","DGPTFM",40,0)
ENC G PRO1:$Y>7,PRO1:'$P(DGZPRF,U,3)
"RTN","DGPTFM",41,0)
PF S PS2=0,J=+DGZPRF,Y=+DGZPRF(J),DGSTRT=$S(+$P(DGZPRF,U,4):$P(DGZPRF,U,4),1:4),DGLST=0
"RTN","DGPTFM",42,0)
 D CL^SDCO21(DFN,+DGZPRF(J),"",.SDCLY),ICDINFO^DGAPI(DFN,PTF),XREF^DGPTFM21 ; load SCI info and DGN's for this service date
"RTN","DGPTFM",43,0)
 D D^DGPTUTL W !,J,"-CPT Capture Date/Time: ",Y W:($P(DGZPRF,U,2)-1!($G(PGBRK))) " (cont.)"
"RTN","DGPTFM",44,0)
 I $P(DGZPRF(J),U,2) W !,?5,"Referring or Ordering Provider: " S L=$P(DGZPRF(J),U,2) D PRV
"RTN","DGPTFM",45,0)
 W !,?5,"Rendering Provider: " S L=$P(DGZPRF(J),U,3) D PRV
"RTN","DGPTFM",46,0)
 I $P(DGZPRF(J),U,5) W !,?5,"Rendering Location: ",$P($G(^SC($P(DGZPRF(J),U,5),0)),U)
"RTN","DGPTFM",47,0)
 S (L1,PGBRK)=0
"RTN","DGPTFM",48,0)
 F K=$P(DGZPRF,U,2):1 Q:'$D(DGZPRF(J,K))  I '$G(DGZPRF(J,K,9)) S PS2=PS2+1 W !,?2,PS2," " D CPT^DGPTUTL1 D  Q:$Y+$G(DGZPRF(J,K+1,1))>16!($G(PGBRK))
"RTN","DGPTFM",49,0)
 . W !,?4 S $P(DS,"-",27)="" W DS," Related Diagnosis ",DS
"RTN","DGPTFM",50,0)
 . F L1=DGSTRT:1:11 S DGLOC=$S(L1<8:L1,1:L1+7),CD=$P(DGZPRF(J,K),U,DGLOC) I CD D  I $Y+$G(CKSCI)>16 S PGBRK=1 Q
"RTN","DGPTFM",51,0)
 . . S N=$$ICDDX^ICDCODE(CD,$$GETDATE^ICDGTDRG(PTF)),N=$S(N:$P(N,U,2,99),1:"")
"RTN","DGPTFM",52,0)
 . . S CD=$P(N,U) W !,?8,CD,"   ",$P(N,U,3)
"RTN","DGPTFM",53,0)
 . . D CKSCI($P(DGZPRF(J,K),U,DGLOC))
"RTN","DGPTFM",54,0)
 . S PS2(PS2)=J_U_K,CD=1,DGLOC=0,DGSTRT=4
"RTN","DGPTFM",55,0)
 I L1'=11,$S(L1<8:$P($G(DGZPRF(J,K)),U,L1+1,7),1:"")_$P($G(DGZPRF(J,K)),U,$S(L1<8:15,1:L1+8),18)?."^" S L1=11
"RTN","DGPTFM",56,0)
 I L1=11 S $P(DGZPRF,U,1,2)=$S($D(DGZPRF(J,K+1)):J_U_(K+1),1:J+1_U_1),$P(DGZPRF,U,4)="",PGBRK=0
"RTN","DGPTFM",57,0)
 E  S $P(DGZPRF,U,1,2)=J_U_K,$P(DGZPRF,U,4)=L1+1
"RTN","DGPTFM",58,0)
 ;I '$D(DGZPRF(J,K+1)) S $P(DGZPRF,U,1,2)=$S($P($G(DGZPRF(J,K)),U,NXTDGN)'="":J,1:J+1)_U_1,$P(DGZPRF,U,4)=DGLST
"RTN","DGPTFM",59,0)
 ;I $D(DGZPRF(J,K+1)) S $P(DGZPRF,U,1,2)=J_U_(K+1)
"RTN","DGPTFM",60,0)
 K I,K,L,L1,CD,N G PRO1
"RTN","DGPTFM",61,0)
 ;
"RTN","DGPTFM",62,0)
CKSCI(IEN)      ;print SCI for each Diagnosis code
"RTN","DGPTFM",63,0)
 N DGINFO Q:'$D(XREF(IEN))
"RTN","DGPTFM",64,0)
 S DGINFO=$G(^DGICD9(46.1,(XREF(IEN)),0)),CKSCI=0
"RTN","DGPTFM",65,0)
 I 'DGINFO Q
"RTN","DGPTFM",66,0)
 F I=3,7,1,2,4:1:6 I $D(SDCLY(I)) S L=$S(I=3:8,I<4:8+I,1:7+I) D
"RTN","DGPTFM",67,0)
 .W ?45 S M=1,CKSCI=CKSCI+1
"RTN","DGPTFM",68,0)
 .W $P("Treated for AO Condition^Treated for IR Condition^Treated for SC Condition^Exposed to Envir Contaminants^Treatment for MST^Treatment for Head/Neck CA^Related to Combat",U,I)
"RTN","DGPTFM",69,0)
 .I I'=7 W ":",$S($P(DGINFO,U,($S(I<3:I+2,I=3:2,1:I+1))):"YES",1:"NO"),!
"RTN","DGPTFM",70,0)
 .I I=7 W ":",$S($P(DGINFO,U,8)="Y":"YES",1:"NO"),!
"RTN","DGPTFM",71,0)
 Q  ;CKSCI
"RTN","DGPTFM",72,0)
 ;
"RTN","DGPTFM",73,0)
NPR S ST=1,PROC=$S($D(^DGPT(PTF,"401P")):^("401P"),1:"") D WR G PRO
"RTN","DGPTFM",74,0)
 ;
"RTN","DGPTFM",75,0)
NPS D WR G PF
"RTN","DGPTFM",76,0)
 ;
"RTN","DGPTFM",77,0)
DONE G EN1^DGPTF4
"RTN","DGPTFM",78,0)
PRO1 ;SET MENU TYPE AND DISPLAY MENU
"RTN","DGPTFM",79,0)
 N ICDVDT,ICPTVDT
"RTN","DGPTFM",80,0)
 S (ICDVDT,ICPTVDT)=$S($D(PTF):$$GETDATE^ICDGTDRG(PTF),1:DT)
"RTN","DGPTFM",81,0)
 S DGNUM=$S($D(DGZDIAG)!($D(DGZPRO))!($D(DGZSER))!($D(DGZSUR)!(+DGZPRF-1'=$P(DGZPRF,U,3))):"MAS",1:"701") G MAS^DGPTFJC:DGST F X=$Y:1:(IOSL-8) W !
"RTN","DGPTFM",82,0)
 W !! S Z="Patient Movements:" W Z S Z=" "_$S(DGPTFE:"M=Add PM  X=Delete PM",1:"M=Edit Treat Spec/PM ")_"  A=Add Code  D=Delete Code  V=Edit Mov" W Z
"RTN","DGPTFM",83,0)
 W ! S Z="Surgical Episodes:" W Z S Z=" S=Add SE  Z=Delete SE  O=Add Code  C=Delete Code  J=Edit SE" W Z
"RTN","DGPTFM",84,0)
 W ! S Z="Procedure Records:" W Z S Z=" T=Add PR  R=Delete PR  P=Add Code  Q=Delete Code  E=Edit PR" W Z
"RTN","DGPTFM",85,0)
 W ! S Z="801:" W Z S Z=" I=Add 801  Y=Delete 801  N=Add CPT  G=Delete CPT F=Edit 801" W Z K Z
"RTN","DGPTFM",86,0)
 W !,"                   ^=Abort   <RET> to Continue:<",DGNUM,">// " R ANS:DTIME K DGNUM
"RTN","DGPTFM",87,0)
A S Z="^C Delete Code^A Add Code^O Add Code^P Add NOP^S Add SE^D Delete Code^M Add PM^X Delete PM^Z Delete SE^J Edit SE^Q Delete NOP^V Edit Move^"
"RTN","DGPTFM",88,0)
 S Z=Z_"T Add PR^R Delete PR^E Edit PR^I Add 801^Y Delete 801^N Add CPT^G Delete CPT^F Edit 801"
"RTN","DGPTFM",89,0)
 I 'DGPTFE S $P(Z,U,8,9)="M Edit treat Spec/PM"
"RTN","DGPTFM",90,0)
 S X=ANS G Q^DGPTF:ANS="^" G ^DGPTFJ:ANS?1"^".E S (A,X)=ANS,X=$E(X,1) D IN^DGHELP
"RTN","DGPTFM",91,0)
 I $P(^DGPT(PTF,0),U,4),X'="","IYNGF"[X W !,"***WARNING: This is a Fee Basis PTF record*** 801 encounters are not allowed." H 3 G DGPTFM
"RTN","DGPTFM",92,0)
 I ANS="" S (ST,ST1)=J+2 D:$D(DGZSUR) WR G @($S($D(DGZDIAG):"NDG",$D(DGZSER):"NSR",$D(DGZPRO):"NPR",$D(DGZSUR):"EN^DGPTFM0",+DGZPRF-1'=$P(DGZPRF,U,3):"NPS",1:"DONE"))
"RTN","DGPTFM",93,0)
 G HELP^DGPTFM1A:%=-1 S Z=$L(A)-1 G @(X_$S(X="X":"",1:"^DGPTFM1"))
"RTN","DGPTFM",94,0)
PRV I $D(^VA(200,L,0)) W $P(^(0),U) Q
"RTN","DGPTFM",95,0)
 W L Q
"RTN","DGPTFM",96,0)
X ;
"RTN","DGPTFM",97,0)
 I 'Z S:PM=1 RC=1 G X1:PM=1 W !!,"Delete Patient move <1",$S(PM<3:"",1:"-"_(PM-1)),">: " R RC:DTIME G ^DGPTFM:RC["^"!(RC="")
"RTN","DGPTFM",98,0)
 E  S RC=$E(A,2,99) W !
"RTN","DGPTFM",99,0)
 I +RC'=RC!('$D(M(RC))) W !!,"Enter the record # to delete from the PTF file, 1",$S(PM<3:"",1:"-"_(PM-1)) S Z=0 G X
"RTN","DGPTFM",100,0)
X1 I +M(RC)=1 W !,*7,"Cannot delete discharge movement",! H 3 G ^DGPTFM
"RTN","DGPTFM",101,0)
 S DIE="^DGPT("_PTF_",""M"",",DP=45.02,DR=".01///@",DA(1)=PTF,DA=+M(RC) D ^DIE K DR W "  ",RC,"-DELETED***" H 2 G ^DGPTFM
"RTN","DGPTFM",102,0)
Z W @DGVI,Z,@DGVO Q
"RTN","DGPTFM",103,0)
EN D WR G EN^DGPTFM0
"RTN","DGPTFM7")
0^3^B21153448^B19954582
"RTN","DGPTFM7",1,0)
DGPTFM7 ;ALB/MJK - Display Phys. CDR mvts ;4/13/04 1:26pm
"RTN","DGPTFM7",2,0)
 ;;5.3;Registration;**78,590,594,683**;Aug 13, 1993
"RTN","DGPTFM7",3,0)
 ;
"RTN","DGPTFM7",4,0)
EN ; entry pt to display CDR screen
"RTN","DGPTFM7",5,0)
 ; -- PTF and DGPTFMT must be defined
"RTN","DGPTFM7",6,0)
 ;
"RTN","DGPTFM7",7,0)
 S DGMAX=7,DGPTIFN=PTF,DGTOT=0 G BYPASS:DGPTFMT<2
"RTN","DGPTFM7",8,0)
 D FDT^DGPTUTL S DGFMTDT=Y
"RTN","DGPTFM7",9,0)
 F NODE=535,"M" F I=0:0 S I=$O(^DGPT(DGPTIFN,NODE,I)) Q:'I  I $D(^(I,0)) S Y=$S($P(^(0),U,10):$P(^(0),U,10),1:DT+.2359),^UTILITY($J,"DGCDR",Y)=NODE_U_I,^UTILITY($J,"DG"_NODE,Y)=I
"RTN","DGPTFM7",10,0)
 S P=$S('$D(^DGPT(DGPTIFN,0)):DGFMTDT+1,$P(^(0),U,2)>DGFMTDT:$P(^(0),U,2),1:DGFMTDT)
"RTN","DGPTFM7",11,0)
 F I=0:0 S I=$O(^UTILITY($J,"DGCDR",I)) Q:'I  I I>DGFMTDT S DGTOT=DGTOT+1,^(I)=^(I)_"^"_P,P=I
"RTN","DGPTFM7",12,0)
BYPASS S (DGC,DGLDT)=0
"RTN","DGPTFM7",13,0)
LOOP ;
"RTN","DGPTFM7",14,0)
 D HEADER:$Y>(IOSL-15) S DGLAST("DT")=DGLDT,DGLAST("C")=DGC
"RTN","DGPTFM7",15,0)
 I DGPTFMT<2 W !!,"  CDR information not required for this admission."
"RTN","DGPTFM7",16,0)
 F DGLDT=DGLDT:0 S DGLDT=$O(^UTILITY($J,"DGCDR",DGLDT)) Q:'DGLDT  I DGLDT>DGFMTDT S X=^(DGLDT) D PRT I 'DGPR Q:'(DGC#DGMAX)!(DGC=DGTOT)
"RTN","DGPTFM7",17,0)
 I DGPR D KILL Q
"RTN","DGPTFM7",18,0)
 W:DGC<DGTOT !,"...more movements available"
"RTN","DGPTFM7",19,0)
 F I=$Y:1:18 W !
"RTN","DGPTFM7",20,0)
 ;
"RTN","DGPTFM7",21,0)
 K X S $P(X,"-",81)="" W X
"RTN","DGPTFM7",22,0)
 I $D(DGBRCH) G @DGBRCH
"RTN","DGPTFM7",23,0)
 W !,"Enter <RET> to ",$S(DGC'<DGTOT:"go to MAS screen",1:"display more CDR information"),!,"      '^N'  to go to screen N,  or '^' to abort: <",$S(DGC'<DGTOT:"MAS",1:"RET"),">// " R X:DTIME S:'$T X="^",DGPTOUT=""
"RTN","DGPTFM7",24,0)
 I X="^" D KILL G Q^DGPTF
"RTN","DGPTFM7",25,0)
 I X="",DGC<DGTOT G LOOP
"RTN","DGPTFM7",26,0)
 S:X="" X="^MAS"
"RTN","DGPTFM7",27,0)
 I X?1"^".E D KILL S DGPTSCRN="CDR" G ^DGPTFJ
"RTN","DGPTFM7",28,0)
 ;
"RTN","DGPTFM7",29,0)
HELP ; -- screen help
"RTN","DGPTFM7",30,0)
 I DGC<DGTOT W !,"Press return to see more CDR information"
"RTN","DGPTFM7",31,0)
 I DGC'<DGTOT W !,"Press return to go to the 'MAS' screen"
"RTN","DGPTFM7",32,0)
 W !,"        '^'  to stop the display"
"RTN","DGPTFM7",33,0)
 W !,"        '^N' to jump to screen #N (appears in upper right of screen '<N>')"
"RTN","DGPTFM7",34,0)
 R !!,"Enter <RET>: ",X:DTIME
"RTN","DGPTFM7",35,0)
 S DGC=DGLAST("C"),DGLDT=DGLAST("DT") G LOOP
"RTN","DGPTFM7",36,0)
 ;
"RTN","DGPTFM7",37,0)
KILL ; -- kill off locals
"RTN","DGPTFM7",38,0)
 K ^UTILITY($J,"DGCDR"),^("DG535"),^("DGM"),DGCDR,DGC,DGI0,DGICDR,DGLDT,DGLVE,DGPASS,DG5SP,DG5CDR,DGMSP,DGMCDR,DGMDRG,DGMAX,DGTOT,DGWARD,DGPTIFN,DGLAST,DGFMTDT,DGLDTE,DGCDR0,DGM0,DGMTY,P,I
"RTN","DGPTFM7",39,0)
 Q
"RTN","DGPTFM7",40,0)
 ;
"RTN","DGPTFM7",41,0)
HEADER ;
"RTN","DGPTFM7",42,0)
 I DGPR D HEAD^DGPTFMO
"RTN","DGPTFM7",43,0)
 I 'DGPR W @IOF,HEAD,?72 S Z="<CDR>" D Z^DGPTFM
"RTN","DGPTFM7",44,0)
 W !?23,"Rec",?38,"Losing Ward",?54,"PTF"
"RTN","DGPTFM7",45,0)
 W !?4,"Losing Date",?23,"Type",?28,"Ward/DRG",?38,"CDR/Spec",?54,"CDR/Spec",?68,"Lve/Pas/ Los"
"RTN","DGPTFM7",46,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","DGPTFM7",47,0)
 Q
"RTN","DGPTFM7",48,0)
 ;
"RTN","DGPTFM7",49,0)
PRT ; -- collect 501 and 535 data and then print
"RTN","DGPTFM7",50,0)
 ; 
"RTN","DGPTFM7",51,0)
 I $P(X,U)="M" S DGMTY=501,(Z,DGM0)=^DGPT(DGPTIFN,"M",+$P(X,U,2),0),DGMDRG=$S($D(^("P")):$P(^("P"),U),1:""),Y=+$O(^UTILITY($J,"DG535",DGLDT-.0000001)),DGCDR0=$S('$D(^(Y)):"",$D(^DGPT(DGPTIFN,535,+^(Y),0)):^(0),1:"")
"RTN","DGPTFM7",52,0)
 ;
"RTN","DGPTFM7",53,0)
 I $P(X,U)="535" S DGMTY=535,(Z,DGCDR0)=^DGPT(DGPTIFN,535,+$P(X,U,2),0),Y=+$O(^UTILITY($J,"DGM",DGLDT-.0000001)),DGM0=$S('$D(^(Y)):"",$D(^DGPT(DGPTIFN,"M",+^(Y),0)):^(0),1:""),DGMDRG=""
"RTN","DGPTFM7",54,0)
 ;
"RTN","DGPTFM7",55,0)
 N DGLOS S X1=DGLDT,X2=$P(X,U,3) D ^%DTC S X=X-$P(Z,U,3),DGLOS=$J($S(X>0:X,1:1),4)
"RTN","DGPTFM7",56,0)
 S DGC=DGC+1,DGLVE=$J($P(Z,U,3),3),DGPASS=$J($P(Z,U,4),3)
"RTN","DGPTFM7",57,0)
 S Y=DGLDT X ^DD("DD") S DGLDTE=Y
"RTN","DGPTFM7",58,0)
 ;S DGMSP=$E($S($D(^DIC(42.4,+$P(DGM0,U,2),0)):$P(^(0),U),1:"UNKNOWN"),1,14),DGMCDR=$J(+$P(DGM0,U,16),7,2)
"RTN","DGPTFM7",59,0)
 ;S DG5SP=$E($S($D(^DIC(42.4,+$P(DGCDR0,U,2),0)):$P(^(0),U),1:"UNKNOWN"),1,14),DG5CDR=$J(+$P(DGCDR0,U,16),7,2)
"RTN","DGPTFM7",60,0)
 I $D(^DIC(42.4,+$P(DGM0,U,2),0)) D
"RTN","DGPTFM7",61,0)
 . S DGMSP=$P(^DIC(42.4,+$P(DGM0,U,2),0),"^",2)
"RTN","DGPTFM7",62,0)
 . I DGMSP="" S DGMSP=$P(^DIC(42.4,+$P(DGM0,U,2),0),"^")
"RTN","DGPTFM7",63,0)
 . S DGMSP=$E(DGMSP,1,14)
"RTN","DGPTFM7",64,0)
 E  S DGMSP="UNKNOWN"
"RTN","DGPTFM7",65,0)
 S DGMCDR=$J(+$P(DGM0,U,16),7,2)
"RTN","DGPTFM7",66,0)
 I $D(^DIC(42.4,+$P(DGCDR0,U,2),0)) D
"RTN","DGPTFM7",67,0)
 . S DG5SP=$P(^DIC(42.4,+$P(DGCDR0,U,2),0),"^",2)
"RTN","DGPTFM7",68,0)
 . I DG5SP="" S DG5SP=$P(^DIC(42.4,+$P(DGCDR0,U,2),0),"^")
"RTN","DGPTFM7",69,0)
 . S DGMSP=$E(DGMSP,1,14)
"RTN","DGPTFM7",70,0)
 E  S DG5SP="UNKNOWN"
"RTN","DGPTFM7",71,0)
 S DG5CDR=$J(+$P(DGCDR0,U,16),7,2)
"RTN","DGPTFM7",72,0)
 S DGWARD=$E($S($D(^DIC(42,+$P(DGCDR0,U,6),0)):$P(^(0),U),1:"UNKNOWN"),1,8)
"RTN","DGPTFM7",73,0)
 ;
"RTN","DGPTFM7",74,0)
 W !,$J(DGC,3),?4,DGLDTE,?23,DGMTY,?28,DGWARD,?38,DG5CDR,?54,DGMCDR,?68,DGLVE,"/",DGPASS,"/",DGLOS,!?28,DGMDRG,?38,DG5SP,?54,DGMSP
"RTN","DGPTFM7",75,0)
 Q
"RTN","DGPTFM7",76,0)
 ;
"RTN","DGPTFM7",77,0)
INQ ; -- entry point for inquire option
"RTN","DGPTFM7",78,0)
 ;
"RTN","DGPTFM7",79,0)
 S:'$D(DC) DC=0 S PTF=D0,DGPR=1 D EN,KILL K PTF Q:$Y<(IOSL-15)
"RTN","DGPTFM7",80,0)
 I $E(IOST,1)="C" W *7 R X:DTIME I X=U S DN=0 Q
"RTN","DGPTFM7",81,0)
 W @IOF,! X:$D(^UTILITY($J,2)) ^(2) W ! F %=1:1:IOM W "_"
"RTN","DGPTFM7",82,0)
 W !,"("_$P(^DPT(+^DGPT(D0,0),0),U,1)_")",!
"RTN","DGPTFM7",83,0)
 Q
"RTN","DGPTFM7",84,0)
DT I Y W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))," " W:Y#100 $J(Y#100\1,2),"," W Y\10000+1700 W:Y#1 "  ",$E(Y_0,9,10),":",$E(Y_"000",11,12)
"RTN","DGPTFM7",85,0)
 Q
"RTN","DGPTFM7",86,0)
 ;
"RTN","DGPTFMO")
0^6^B26139485^B26073214
"RTN","DGPTFMO",1,0)
DGPTFMO ;ALB/JDS/ADL - DGPTF PRINT TEMPLATE ; 4/13/04 12:11pm
"RTN","DGPTFMO",2,0)
 ;;5.3;Registration;**195,397,510,590,594,606,683**;Aug 13, 1993
"RTN","DGPTFMO",3,0)
 ;;ADL;Updated for CSV Project;;Mar 4, 2003
"RTN","DGPTFMO",4,0)
 ;FOR PTF REPORT CALLED FROM TEMPLATE DGPTF
"RTN","DGPTFMO",5,0)
EN K A,B,AD,ADA,DGDD,DGFC,HEAD,DGPTFE,DGST,DGN,T
"RTN","DGPTFMO",6,0)
 F I=0:0 S I=$O(^DGPT(D0,"M",I)) Q:I'>0  I $D(^(I,0)) S J=+$P(^(0),U,10) S:'J J=999999999 S:$D(T(J)) J=J+.01*I S T(J)=I
"RTN","DGPTFMO",7,0)
 F I=0:0 S I=$O(T(I)) Q:I'>0  S DGM=$S($D(^DGPT(D0,"M",T(I),0)):^(0),1:"") I DGM]"" D WRITE
"RTN","DGPTFMO",8,0)
 K T F I=0:0 S I=$O(^DGPT(D0,"S",I)) Q:I'>0  D SUR
"RTN","DGPTFMO",9,0)
 S DGOP1=$S($D(^DGPT(D0,"401P")):^("401P"),1:"") I DGOP1]"" D HEAD:$Y>(IOSL-10) G Q:'DN D PROC
"RTN","DGPTFMO",10,0)
 I $D(^DGPT(D0,"P")) D HEAD:$Y>(IOSL-10) G Q:'DN F I=0:0 S I=$O(^DGPT(D0,"P",I)) Q:I'>0  S DG601=^DGPT(D0,"P",I,0),Y=+DG601 D D^DGPTUTL W !!," Procedure Date: ",Y D 601
"RTN","DGPTFMO",11,0)
 S DGPT=$G(^DGPT(D0,70)) I DGPT]"" G Q:'DN D DXLS
"RTN","DGPTFMO",12,0)
 K %,DGL,DGM,DGPT,DGOP,DGOP1,DGF,DGP,DXLS,DGICD,L1,S1,T,J,K,DGPR,DGN,AGE,B,DA,DAM,DFN,DGST,DOB,DP,DRG,EXP,NO,P,PTF,DGPTFE,SD1,SEX,TAC,TRS,DGDS,DGTD,DGPROC,DG601,DGPTDAT
"RTN","DGPTFMO",13,0)
 W ! ;F I=$Y:1:IOSL-1 W !
"RTN","DGPTFMO",14,0)
 Q
"RTN","DGPTFMO",15,0)
WRITE D HEAD:$Y>(IOSL-12) G Q:'DN S Y=$P(DGM,U,10),DGL=+$P(DGM,U,2),DGL=$S($D(^DIC(42.4,DGL,0)):^(0),1:""),DGL=$P(DGL,U,1) D D^DGPTUTL
"RTN","DGPTFMO",16,0)
 W !!,"Movement Date: ",Y,?40,"Losing Specialty: ",$E(DGL,1,22),!,"Leave Days: ",$P(DGM,U,3),?40,"Pass Days: ",$P(DGM,U,4)
"RTN","DGPTFMO",17,0)
 W !,"Treated for SC condition: ",$S($P(DGM,U,18)=1:"Yes",1:"No")
"RTN","DGPTFMO",18,0)
 W:$P(DGM,U,31)'="" !,"Potentially Related to Combat: ",$S($P(DGM,U,31)="Y":"Yes",1:"No")
"RTN","DGPTFMO",19,0)
 W:$P(DGM,U,26)'="" !,"Treated for AO condition: ",$S($P(DGM,U,26)="Y":"Yes",1:"No")
"RTN","DGPTFMO",20,0)
 W:$P(DGM,U,27)'="" !,"Treated for IR condition: ",$S($P(DGM,U,27)="Y":"Yes",1:"No")
"RTN","DGPTFMO",21,0)
 W:$P(DGM,U,28)'="" !,"Treated for EC condition: ",$S($P(DGM,U,28)="Y":"Yes",1:"No")
"RTN","DGPTFMO",22,0)
 W:$P(DGM,U,29)'="" !,"Treated for MST condition: ",$S($P(DGM,U,29)="Y":"Yes",$P(DGM,U,29)="N":"No",1:"Declined to answer") ; added 6/17/98 for MST enhancement
"RTN","DGPTFMO",23,0)
 W:$P(DGM,U,30)'="" !,"Treated for HEAD/NECK CA condition: ",$S($P(DGM,U,30)="Y":"Yes",1:"No")
"RTN","DGPTFMO",24,0)
 W:T(I)=1 !,"Discharge "
"RTN","DGPTFMO",25,0)
 S DGF="" F J=5:1:15 I J#10 S DGPTTMP=$$ICDDX^ICDCODE(+$P(DGM,U,J),$$GETDATE^ICDGTDRG(D0)),DGICD=$S(+DGPTTMP>0:$P(DGPTTMP,U,2,99),1:"") I DGICD]"" D 
"RTN","DGPTFMO",26,0)
 . W:DGF="" !!?13,"DX: " W $P(DGICD,U,3)_" ("_$P(DGICD,U)_")",!?17 S DGF=1
"RTN","DGPTFMO",27,0)
 ;-- display expanded codes 
"RTN","DGPTFMO",28,0)
 S DG300=$S($D(^DGPT(D0,"M",T(I),300)):^(300),1:"") I DG300]"" D HEAD:$Y>(IOSL-6) D PRN2^DGPTFM8 W !
"RTN","DGPTFMO",29,0)
 K DG300
"RTN","DGPTFMO",30,0)
 ;Display TRANSFER DRG with description
"RTN","DGPTFMO",31,0)
 Q:'$D(^DGPT(D0,"M",T(I),"P"))  S DGTD=+^("P") Q:'$D(^ICD(DGTD,0))  W !?3,"TRANSFER DRG: ",DGTD," - "
"RTN","DGPTFMO",32,0)
 N DXD,DGDX
"RTN","DGPTFMO",33,0)
 S DXD=$$DRGD^ICDGTDRG(DGTD,"DGDX",,$$GETDATE^ICDGTDRG(D0)),DGDS=0
"RTN","DGPTFMO",34,0)
 F  S DGDS=$O(DGDX(DGDS)) Q:'+DGDS  Q:DGDX(DGDS)=" "  W !,DGDX(DGDS)
"RTN","DGPTFMO",35,0)
 Q
"RTN","DGPTFMO",36,0)
HEAD I $E(IOST,1)="C" W *7 R X:DTIME I X=U S DN=0 Q
"RTN","DGPTFMO",37,0)
 S DC=DC+1 W @IOF,! X:$D(^UTILITY($J,2)) ^(2) W ! F K=1:1:IOM W "_"
"RTN","DGPTFMO",38,0)
 W !,"("_$P(^DPT(+^DGPT(D0,0),0),U,1)_")",!
"RTN","DGPTFMO",39,0)
 Q
"RTN","DGPTFMO",40,0)
SUR D HEAD:$Y>(IOSL-7) G Q:'DN S S1=^DGPT(D0,"S",I,0),Y=+S1 D D^DGPTUTL W !!,"   Date of Surg: ",Y,?45,"Chief Surg: " S L=";"_$P(^DD(45.01,4,0),U,3),L1=";"_$P(S1,U,4)_":" W $P($P(L,L1,2),";",1)
"RTN","DGPTFMO",41,0)
 W !,"    Anesth Tech: " S L=";"_$P(^DD(45.01,6,0),U,3),L1=";"_$P(S1,U,6)_":" W $P($P(L,L1,2),";",1),?45,"First Asst: " S L=";"_$P(^DD(45.01,5,0),U,3),L1=";"_$P(S1,U,5)_":" W $P($P(L,L1,2),";",1)
"RTN","DGPTFMO",42,0)
 W !,"  Source of pay: " S L=";"_$P(^DD(45.01,7,0),U,3),L1=";"_$P(S1,U,7)_":" W $P($P(L,L1,2),";",1)
"RTN","DGPTFMO",43,0)
 W ?46,"Surg spec: ",$S($D(^DIC(45.3,+$P(S1,U,3),0)):$P(^(0),U,2),1:"")
"RTN","DGPTFMO",44,0)
 W !!,?7,"Surg/pro: " F K=1:1:5 S L=$P(S1,U,K+7) I L'="" S DGPTTMP=$$ICDOP^ICDCODE(+L,$$GETDATE^ICDGTDRG(D0)) W $S(+DGPTTMP>0:$P(DGPTTMP,U,5)_" ("_$P(DGPTTMP,U,2)_")",1:"**********-"_L),!?17
"RTN","DGPTFMO",45,0)
 ;-- display expanded codes
"RTN","DGPTFMO",46,0)
 S DG300=$S($D(^DGPT(D0,"S",I,300)):^(300),1:"") I DG300]"" D PRN3^DGPTFM8
"RTN","DGPTFMO",47,0)
 K DG300
"RTN","DGPTFMO",48,0)
 Q
"RTN","DGPTFMO",49,0)
PROC S DGF="" F I=1:1:5 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DGOP1,U,I),$$GETDATE^ICDGTDRG(D0)),DGOP=$S(DGPTTMP>0:$P(DGPTTMP,U,2,99),1:"") I DGOP D 
"RTN","DGPTFMO",50,0)
 . W:'DGF !!?6,"Procedure: " W $P(DGOP,U,4)_" ("_$P(DGOP,U)_")",!?17 S DGF=1
"RTN","DGPTFMO",51,0)
 Q
"RTN","DGPTFMO",52,0)
601 ;print the procedures/dates from the 601 procedure multiple (eff. 10/1/87)
"RTN","DGPTFMO",53,0)
 F J=5:1:9 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DG601,U,J),$$GETDATE^ICDGTDRG(D0)),DGPROC=$S(+DGPTTMP>0:$P(DGPTTMP,U,2,99),1:"") I DGPROC W !?17,$P(DGPROC,U,4)_" ("_$P(DGPROC,U)_")"
"RTN","DGPTFMO",54,0)
 Q
"RTN","DGPTFMO",55,0)
DXLS D HEAD:$Y>(IOSL-16) S DGPTDAT=$$GETDATE^ICDGTDRG(D0)
"RTN","DGPTFMO",56,0)
 S DGPTTMP=$$ICDDX^ICDCODE(+$P(DGPT,U,10),DGPTDAT),DXLS=$S(+DGPTTMP>0:$P(DGPTTMP,U,2,99),1:"") I DXLS]"" W !!?11,"DXLS: ",$P(DXLS,U,3)_" ("_$P(DXLS,U)_")"
"RTN","DGPTFMO",57,0)
 I 'DXLS S DGPTTMP=$$ICDDX^ICDCODE(+$P(DGPT,U,11),DGPTDAT),DGP=$S(+DGPTTMP>0:$P(DGPTTMP,U,2,99),1:"") I DGP]"" W !!," Principal Diag: ",$P(DGP,U,3)_" ("_$P(DGP,U)_")"
"RTN","DGPTFMO",58,0)
 S K=DGPT F I=16:1:24 D DSP
"RTN","DGPTFMO",59,0)
 S K=$G(^DGPT(D0,71)) F I=1:1:4 D DSP
"RTN","DGPTFMO",60,0)
 ;-- display expanded code information
"RTN","DGPTFMO",61,0)
 S DG300=$S($D(^DGPT(D0,300)):^(300),1:"") D:DG300]"" PRN2^DGPTFM8 K DG300
"RTN","DGPTFMO",62,0)
 D EN2^DGPTF4 Q
"RTN","DGPTFMO",63,0)
Q Q
"RTN","DGPTFMO",64,0)
Q1 K ^UTILITY(U,$J),DG1 Q
"RTN","DGPTFMO",65,0)
DT I Y W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))," " W:Y#100 $J(Y#100\1,2),"," W Y\10000+1700 W:Y#1 "  ",$E(Y_0,9,10),":",$E(Y_"000",11,12)
"RTN","DGPTFMO",66,0)
 Q
"RTN","DGPTFMO",67,0)
DSP S J=$$ICDDX^ICDCODE(+$P(K,U,I),DGPTDAT) I J&$P(J,U,10) D
"RTN","DGPTFMO",68,0)
 .I I#2 W ?40,$P(J,U,4)_"("_$P(J,U,2)_")" Q
"RTN","DGPTFMO",69,0)
 .W !,$P(J,U,4)_"("_$P(J,U,2)_")"
"RTN","DGPTFMO",70,0)
 Q
"VER")
8.0^22.0
"^DD",42,42,.017,0)
SPECIALTY^R*P42.4'X^DIC(42.4,^0;12^S DIC("S")="I $G(Y)=80!$$ACTIVE^DGACT(42.4,Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",42,42,.017,3)
Enter this ward's PTF bedsection.  This must be an active treating specialty.
"^DD",42,42,.017,12)
Allows only active treating specialties.
"^DD",42,42,.017,12.1)
S DIC("S")="I $G(Y)=80!$$ACTIVE^DGACT(42.4,Y)"
"^DD",42,42,.017,21,0)
^^4^4^2910723^^
"^DD",42,42,.017,21,1,0)
Enter the PTF specialty that this ward is assign to.  The specialty
"^DD",42,42,.017,21,2,0)
and its CDR number will be transmitted to Austin as part of the N501
"^DD",42,42,.017,21,3,0)
and N535 transactions.  This information is sent in the physcial
"^DD",42,42,.017,21,4,0)
specialty and physcial CDR elements of those transactions.
"^DD",42,42,.017,"DT")
3060307
"BLD",6448,6)
^620
**END**
**END**
