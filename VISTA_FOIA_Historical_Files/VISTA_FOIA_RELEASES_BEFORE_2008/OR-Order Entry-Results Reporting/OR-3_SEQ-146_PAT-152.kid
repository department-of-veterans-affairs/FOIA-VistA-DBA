Released OR*3*152 SEQ #146
Extracted from mail message
**KIDS**:OR*3.0*152^

**INSTALL NAME**
OR*3.0*152
"BLD",2628,0)
OR*3.0*152^ORDER ENTRY/RESULTS REPORTING^0^3020822^y
"BLD",2628,1,0)
^^3^3^3020725^
"BLD",2628,1,1,0)
This patch is in support of the Hui/VHA CIO SD&D Pharmacy Data Interchange
"BLD",2628,1,2,0)
project. The project provides a method for the one-way electronic transfer
"BLD",2628,1,3,0)
of prescription orders from an external system to VistA.
"BLD",2628,4,0)
^9.64PA^^
"BLD",2628,"KRN",0)
^9.67PA^8989.52^19
"BLD",2628,"KRN",.4,0)
.4
"BLD",2628,"KRN",.401,0)
.401
"BLD",2628,"KRN",.402,0)
.402
"BLD",2628,"KRN",.403,0)
.403
"BLD",2628,"KRN",.5,0)
.5
"BLD",2628,"KRN",.84,0)
.84
"BLD",2628,"KRN",3.6,0)
3.6
"BLD",2628,"KRN",3.8,0)
3.8
"BLD",2628,"KRN",9.2,0)
9.2
"BLD",2628,"KRN",9.8,0)
9.8
"BLD",2628,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2628,"KRN",9.8,"NM",1,0)
ORMPS^^0^B63893771
"BLD",2628,"KRN",9.8,"NM",2,0)
ORMPS1^^0^B58076665
"BLD",2628,"KRN",9.8,"NM","B","ORMPS",1)

"BLD",2628,"KRN",9.8,"NM","B","ORMPS1",2)

"BLD",2628,"KRN",19,0)
19
"BLD",2628,"KRN",19.1,0)
19.1
"BLD",2628,"KRN",101,0)
101
"BLD",2628,"KRN",409.61,0)
409.61
"BLD",2628,"KRN",771,0)
771
"BLD",2628,"KRN",870,0)
870
"BLD",2628,"KRN",8989.51,0)
8989.51
"BLD",2628,"KRN",8989.52,0)
8989.52
"BLD",2628,"KRN",8994,0)
8994
"BLD",2628,"KRN","B",.4,.4)

"BLD",2628,"KRN","B",.401,.401)

"BLD",2628,"KRN","B",.402,.402)

"BLD",2628,"KRN","B",.403,.403)

"BLD",2628,"KRN","B",.5,.5)

"BLD",2628,"KRN","B",.84,.84)

"BLD",2628,"KRN","B",3.6,3.6)

"BLD",2628,"KRN","B",3.8,3.8)

"BLD",2628,"KRN","B",9.2,9.2)

"BLD",2628,"KRN","B",9.8,9.8)

"BLD",2628,"KRN","B",19,19)

"BLD",2628,"KRN","B",19.1,19.1)

"BLD",2628,"KRN","B",101,101)

"BLD",2628,"KRN","B",409.61,409.61)

"BLD",2628,"KRN","B",771,771)

"BLD",2628,"KRN","B",870,870)

"BLD",2628,"KRN","B",8989.51,8989.51)

"BLD",2628,"KRN","B",8989.52,8989.52)

"BLD",2628,"KRN","B",8994,8994)

"BLD",2628,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
152^3020822^10
"PKG",110,22,1,"PAH",1,1,0)
^^3^3^3020822
"PKG",110,22,1,"PAH",1,1,1,0)
This patch is in support of the Hui/VHA CIO SD&D Pharmacy Data Interchange
"PKG",110,22,1,"PAH",1,1,2,0)
project. The project provides a method for the one-way electronic transfer
"PKG",110,22,1,"PAH",1,1,3,0)
of prescription orders from an external system to VistA.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORMPS")
0^1^B63893771
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;8/22/02  08:48
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152**;Dec 17, 1997
"RTN","ORMPS",3,0)
EN ; -- entry point for PS messages
"RTN","ORMPS",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",6,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",7,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",8,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",9,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",10,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",11,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",12,0)
 D @ORDCNTRL
"RTN","ORMPS",13,0)
 Q
"RTN","ORMPS",14,0)
 ;
"RTN","ORMPS",15,0)
ZV ; -- Verified
"RTN","ORMPS",16,0)
 N ORDA,ORUSR S ORDA=+$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORMPS",17,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12) Q:'ORUSR
"RTN","ORMPS",19,0)
 D VERIFY^ORCSAVE2(+ORIFN,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",20,0)
 Q
"RTN","ORMPS",21,0)
 ;
"RTN","ORMPS",22,0)
ZP ; -- Purged
"RTN","ORMPS",23,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",24,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",28,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",29,0)
 Q
"RTN","ORMPS",30,0)
 ;
"RTN","ORMPS",31,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",32,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",33,0)
 Q
"RTN","ORMPS",34,0)
 ;
"RTN","ORMPS",35,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",36,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",37,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",38,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",39,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",40,0)
 Q
"RTN","ORMPS",41,0)
 ;
"RTN","ORMPS",42,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMPS",43,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",44,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",45,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",46,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",47,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",48,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",49,0)
ZC1 ; continue ... save responses, post reply
"RTN","ORMPS",50,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",51,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",52,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",53,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",54,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",55,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",56,0)
 Q
"RTN","ORMPS",57,0)
 ;
"RTN","ORMPS",58,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",59,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",60,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",61,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",62,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",63,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",64,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",65,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",66,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",67,0)
SN1 ; continue ... save order, post messsage
"RTN","ORMPS",68,0)
 D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",69,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMPS",70,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",71,0)
 . S TYPE=$S(TYPE="E":1,TYPE="R":2,1:0)
"RTN","ORMPS",72,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",73,0)
 . I $D(^OR(100,ORIG,0)) S $P(^(3),U,6)=ORIFN,EVNT=$P(^(0),U,17) I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",74,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",75,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",76,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",77,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",78,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",79,0)
 S ORSIG=$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",80,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",81,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",82,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",83,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",84,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",85,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",86,0)
 Q
"RTN","ORMPS",87,0)
 ;
"RTN","ORMPS",88,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",89,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",90,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",91,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",92,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",93,0)
 Q
"RTN","ORMPS",94,0)
 ;
"RTN","ORMPS",95,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",96,0)
 N OR0,OR3,ZSC S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",97,0)
 I $P(OR3,U,3)=5,ORSTS=6,$$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 Q
"RTN","ORMPS",98,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",99,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",100,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",101,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",102,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",103,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",104,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",105,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",106,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",107,0)
 Q
"RTN","ORMPS",108,0)
 ;
"RTN","ORMPS",109,0)
STATUS(X) ; -- Returns order status from HL7 code
"RTN","ORMPS",110,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",111,0)
 Q Y
"RTN","ORMPS",112,0)
 ;
"RTN","ORMPS",113,0)
DE ; -- Data Errors in SS msg
"RTN","ORMPS",114,0)
 Q
"RTN","ORMPS",115,0)
 ;
"RTN","ORMPS",116,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",117,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",118,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",119,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",120,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",121,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",122,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",123,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",124,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",125,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",126,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",127,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",128,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",129,0)
 Q
"RTN","ORMPS",130,0)
 ;
"RTN","ORMPS",131,0)
OC ; -- Cancelled (prior to pharmacist's verification)
"RTN","ORMPS",132,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",133,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",134,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",135,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",136,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",137,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",138,0)
 Q
"RTN","ORMPS",139,0)
 ;
"RTN","ORMPS",140,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",141,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",142,0)
 Q
"RTN","ORMPS",143,0)
 ;
"RTN","ORMPS",144,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",145,0)
 S:ORNATR="A" ORWHO="" S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",146,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",147,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",148,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",149,0)
 Q
"RTN","ORMPS",150,0)
 ;
"RTN","ORMPS",151,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",152,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",153,0)
 Q
"RTN","ORMPS",154,0)
 ;
"RTN","ORMPS",155,0)
OH ; -- Held
"RTN","ORMPS",156,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",157,0)
 Q
"RTN","ORMPS",158,0)
 ;
"RTN","ORMPS",159,0)
HR ; -- Held [ack]
"RTN","ORMPS",160,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",161,0)
 Q
"RTN","ORMPS",162,0)
 ;
"RTN","ORMPS",163,0)
RL ; -- Released hold
"RTN","ORMPS",164,0)
OE ; -- Released hold
"RTN","ORMPS",165,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",166,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S ^(2)=ORNOW_U_ORWHO
"RTN","ORMPS",167,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",168,0)
 Q
"RTN","ORMPS",169,0)
 ;
"RTN","ORMPS",170,0)
OR ; -- Released / [ack]
"RTN","ORMPS",171,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",172,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",173,0)
 Q
"RTN","ORMPS",174,0)
 ;
"RTN","ORMPS",175,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMPS",176,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",177,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",178,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",179,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",180,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",181,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",182,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",183,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",184,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",185,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",186,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",187,0)
 Q
"RTN","ORMPS",188,0)
 ;
"RTN","ORMPS",189,0)
RXO() ; -- Return subscript of RXO segment
"RTN","ORMPS",190,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",191,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",192,0)
 Q X
"RTN","ORMPS",193,0)
 ;
"RTN","ORMPS",194,0)
RXE() ; -- Return subscript of RXE segment
"RTN","ORMPS",195,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",196,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",197,0)
 Q X
"RTN","ORMPS",198,0)
 ;
"RTN","ORMPS",199,0)
RXR() ; -- Return subscript of RXR segment
"RTN","ORMPS",200,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",201,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",202,0)
 Q X
"RTN","ORMPS",203,0)
 ;
"RTN","ORMPS",204,0)
RXC() ; -- Return subscript of [first] RXC segment
"RTN","ORMPS",205,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",206,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",207,0)
 Q X
"RTN","ORMPS",208,0)
 ;
"RTN","ORMPS",209,0)
ZRX() ; -- Return subscript of ZRX segment
"RTN","ORMPS",210,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",211,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",212,0)
 Q X
"RTN","ORMPS1")
0^2^B58076665
"RTN","ORMPS1",1,0)
ORMPS1 ;SLC/MKB - Process Pharmacy ORM msgs cont ;8/22/02  08:48
"RTN","ORMPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**86,92,94,116,134,152**;Dec 17, 1997
"RTN","ORMPS1",3,0)
UDOSE ; -- new Unit Dose order
"RTN","ORMPS1",4,0)
 N QT,DRUG,INSTR,DOSE,RTE,SCH,OI,URG,WP,DUR,STR,DRGNM,X,PSOI,PSDD,S0,ID,LDOSE,XC,NTE,S0,RXR
"RTN","ORMPS1",5,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORMPS1",6,0)
 S ORDG=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",0))
"RTN","ORMPS1",7,0)
 S ORPKG=+$$PKG("PSJ")
"RTN","ORMPS1",8,0)
 D GETDLG1^ORCD(ORDIALOG) S QT=$G(ORQT(1))
"RTN","ORMPS1",9,0)
 S DRUG=$$PTR("DISPENSE DRUG"),INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORMPS1",10,0)
 S DOSE=$$PTR("DOSE"),RTE=$$PTR("ROUTE"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",11,0)
 S OI=$$PTR("ORDERABLE ITEM"),URG=$$PTR("URGENCY")
"RTN","ORMPS1",12,0)
 S WP=$$PTR("WORD PROCESSING 1"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",13,0)
 S STR=$$PTR("STRENGTH"),DRGNM=$$PTR("DRUG NAME")
"RTN","ORMPS1",14,0)
 ;
"RTN","ORMPS1",15,0)
UD1 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",16,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",17,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",18,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",19,0)
 S ID=$P(QT,U),LDOSE=$P(QT,U,8) I 'ID,S0 D
"RTN","ORMPS1",20,0)
 . N UNT,PTRN S UNT=$P(S0,"&",2),PTRN="1.N1"""_UNT_""""
"RTN","ORMPS1",21,0)
 . I LDOSE?@PTRN S $P(ID,"&",1,2)=+LDOSE_"&"_UNT Q  ;pre-POE orders
"RTN","ORMPS1",22,0)
 . S:$P(PSOI,U,2)'[S0 ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",23,0)
 I 'ID,'S0 S ORDIALOG(DRGNM,1)=$P(PSDD,U,2)
"RTN","ORMPS1",24,0)
 S:$L(ID) ORDIALOG(DOSE,1)=$P(ID,"&",1,4)_"&"_LDOSE_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",25,0)
 I LDOSE="" D  I LDOSE="" S ORERR="Unable to determine instructions" Q
"RTN","ORMPS1",26,0)
 . I $G(RXC)'>0 D  Q  ;look for units/dose
"RTN","ORMPS1",27,0)
 .. S LDOSE=$P(ID,"&",3),X=$P(ID,"&",4) I 'LDOSE S LDOSE="" Q
"RTN","ORMPS1",28,0)
 .. S:'$L(X) X=$P($$FIND^ORM(+RXE,7),U,5) S:$L(X) LDOSE=LDOSE_" "_X
"RTN","ORMPS1",29,0)
 .. S ORDIALOG(DRGNM,1)=$P(PSDD,U,2) ;force use of DD
"RTN","ORMPS1",30,0)
 . F  D  Q:LDOSE'=""  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",31,0)
 .. S XC=@ORMSG@(RXC) Q:+$P($P(XC,"|",3),U,4)'=+PSOI
"RTN","ORMPS1",32,0)
 .. S LDOSE=$P(XC,"|",4)_$P($P(XC,"|",5),U,5) ;strength_units
"RTN","ORMPS1",33,0)
 S ORDIALOG(INSTR,1)=LDOSE
"RTN","ORMPS1",34,0)
UD2 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",35,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",36,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",37,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",38,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",39,0)
 S RXR=$$RXR^ORMPS I 'RXR S ORERR="Missing or invalid RXR segment" Q
"RTN","ORMPS1",40,0)
 S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4),ORDIALOG(URG,1)=ORURG
"RTN","ORMPS1",41,0)
 S ORDIALOG(SCH,1)=$P(QT,U,2),X=$P(QT,U,3)
"RTN","ORMPS1",42,0)
 I $L(X) D  ;set only if previous order had duration
"RTN","ORMPS1",43,0)
 . N IFN S IFN=$S($G(ORIFN):+ORIFN,$P(ZRX,"|",2):+$P(ZRX,"|",2),1:0)
"RTN","ORMPS1",44,0)
 . S:$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) ORDIALOG(DUR,1)=$$DURATION(X)
"RTN","ORMPS1",45,0)
 D DOSETEXT^ORCDPS2 ;reset Instructions text, SIG
"RTN","ORMPS1",46,0)
 Q
"RTN","ORMPS1",47,0)
 ;
"RTN","ORMPS1",48,0)
OUT ; -- new Outpt order
"RTN","ORMPS1",49,0)
 N OI,SIG,INSTR,DOSE,RTE,SCH,DUR,SC,STR,DRUG,PI,CONJ,PSOI,PSDD,S0,X,I,RXR,J,NTE,ZSC,CNT,PC
"RTN","ORMPS1",50,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORMPS1",51,0)
 S ORDG=+$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORMPS1",52,0)
 S ORPKG=+$$PKG("PSO") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",53,0)
 S OI=$$PTR("ORDERABLE ITEM"),SIG=$$PTR("SIG")
"RTN","ORMPS1",54,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORMPS1",55,0)
 S SCH=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",56,0)
 S RTE=$$PTR("ROUTE"),SC=$$PTR("SERVICE CONNECTED")
"RTN","ORMPS1",57,0)
 S STR=$$PTR("STRENGTH"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMPS1",58,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMPS1",59,0)
 S PC=$$PTR("WORD PROCESSING 1")
"RTN","ORMPS1",60,0)
 ;
"RTN","ORMPS1",61,0)
 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",62,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",63,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",64,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",65,0)
 I S0,$P(PSOI,U,2)'[S0 S ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",66,0)
 I 'S0,'$G(ORQT(1)) S ORDIALOG($$PTR("DRUG NAME"),1)=$P(PSDD,U,2)
"RTN","ORMPS1",67,0)
OUT1 S ORDIALOG($$PTR("QUANTITY"),1)=$$FIND^ORM(+RXE,11)
"RTN","ORMPS1",68,0)
 S ORDIALOG($$PTR("REFILLS"),1)=$$FIND^ORM(+RXE,13)
"RTN","ORMPS1",69,0)
 S X=$$FIND^ORM(+RXE,23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS1",70,0)
 S:X ORDIALOG($$PTR("DAYS SUPPLY"),1)=X
"RTN","ORMPS1",71,0)
 I ZRX S X=$P(ZRX,"|",5) S:$L(X) ORDIALOG($$PTR("ROUTING"),1)=X
"RTN","ORMPS1",72,0)
 S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG F I=1:1:ORQT D
"RTN","ORMPS1",73,0)
 . S ORDIALOG(INSTR,I)=$P(ORQT(I),U,8),X=$P(ORQT(I),U)
"RTN","ORMPS1",74,0)
 . S:$L(X) ORDIALOG(DOSE,I)=$P(X,"&",1,4)_"&"_$P(ORQT(I),U,8)_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",75,0)
 . S X=$P(ORQT(I),U,2) S:$L(X) ORDIALOG(SCH,I)=X
"RTN","ORMPS1",76,0)
 . S X=$P(ORQT(I),U,3) S:$L(X) ORDIALOG(DUR,I)=$$DURATION(X)
"RTN","ORMPS1",77,0)
 . S X=$P(ORQT(I),U,9) S:$L(X) ORDIALOG(CONJ,I)=$S(X="S":"T",1:X)
"RTN","ORMPS1",78,0)
 S RXR=$$RXR^ORMPS I RXR S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4) D
"RTN","ORMPS1",79,0)
 . S I=1,J=+RXR ;look for multiple RXR's
"RTN","ORMPS1",80,0)
 . F  S J=$O(@ORMSG@(J)) Q:J'>0  S RXR=@ORMSG@(J) Q:$E(RXR,1,3)'="RXR"  S I=I+1,ORDIALOG(RTE,I)=$P($P(RXR,"|",2),U,4)
"RTN","ORMPS1",81,0)
OUT2 S NTE=$$NTE(6) I NTE D  ;Prov Comm
"RTN","ORMPS1",82,0)
 . S CNT=1,^TMP("ORWORD",$J,PC,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",83,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PC,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",84,0)
 . S ^TMP("ORWORD",$J,PC,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",85,0)
 . S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS1",86,0)
 S NTE=$$NTE(7) I NTE D  ;Pat Instr
"RTN","ORMPS1",87,0)
 . S CNT=1,^TMP("ORWORD",$J,PI,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",88,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PI,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",89,0)
 . S ^TMP("ORWORD",$J,PI,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",90,0)
 . S ORDIALOG(PI,1)="^TMP(""ORWORD"",$J,"_PI_",1)"
"RTN","ORMPS1",91,0)
 S NTE=$$NTE(21) I NTE D  ;Sig
"RTN","ORMPS1",92,0)
 . S CNT=1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",93,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,SIG,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",94,0)
 . S ^TMP("ORWORD",$J,SIG,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",95,0)
 . S ORDIALOG(SIG,1)="^TMP(""ORWORD"",$J,"_SIG_",1)"
"RTN","ORMPS1",96,0)
 . S ORDIALOG(PI,"FORMAT")="@" ;PI already included in Sig
"RTN","ORMPS1",97,0)
OUT3 I '$G(ORQT(1))!('NTE) D DOSETEXT^ORCDPS2 ;reset Instructions text, Sig
"RTN","ORMPS1",98,0)
 S ZSC=$$ZSC,X=$P(ZSC,"|",2) I X?2.3U S ORDIALOG(SC,1)=$S(X="SC":1,1:0)
"RTN","ORMPS1",99,0)
 Q
"RTN","ORMPS1",100,0)
 ;
"RTN","ORMPS1",101,0)
IV ; -- new IV order
"RTN","ORMPS1",102,0)
 N IVTYP S IVTYP=$P(ZRX,"|",7) I IVTYP="",$$NUMADDS'>1 G UDOSE
"RTN","ORMPS1",103,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,X,X1,X2,I,J,TYPE,OI,WP,NTE,SCH
"RTN","ORMPS1",104,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORMPS1",105,0)
 S ORDG=+$O(^ORD(100.98,"B",$S($P(ZRX,"|",7)="TPN":"TPN",1:"IV RX"),0))
"RTN","ORMPS1",106,0)
 S ORPKG=+$$PKG("PSIV") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",107,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),VOL=$$PTR("VOLUME"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",108,0)
 S RATE=$$PTR("INFUSION RATE") S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMPS1",109,0)
 S WP=$$PTR("WORD PROCESSING 1"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMPS1",110,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMPS1",111,0)
IV1 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",112,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",113,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",114,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",115,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",116,0)
 S ORDIALOG(RATE,1)=$$FIND^ORM(+RXE,24)_" "_$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS1",117,0)
 S (I,J)=0
"RTN","ORMPS1",118,0)
 F  D  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",119,0)
 . S X=@ORMSG@(RXC),TYPE=$P(X,"|",2),OI=$$ORDITEM^ORM($P(X,"|",3)) Q:'OI
"RTN","ORMPS1",120,0)
 . S X1=$P(X,"|",4),X2=$P($P(X,"|",5),U,5)
"RTN","ORMPS1",121,0)
 . I $E(TYPE)="B" S J=J+1,ORDIALOG(SOLN,J)=OI,ORDIALOG(VOL,J)=X1 Q
"RTN","ORMPS1",122,0)
 . S I=I+1,ORDIALOG(ADDS,I)=OI,ORDIALOG(STR,I)=X1,ORDIALOG(UNITS,I)=X2
"RTN","ORMPS1",123,0)
 I IVTYP="" S X=$P($G(ORQT(1)),U,2) S:$L(X) ORDIALOG(SCH,1)=X
"RTN","ORMPS1",124,0)
 Q
"RTN","ORMPS1",125,0)
 ;
"RTN","ORMPS1",126,0)
NTE(ID) ; -- Return subscript of NTE segment for RXE-<ID>
"RTN","ORMPS1",127,0)
 N I,SEG,Y S Y="",I=+RXE S:'$G(ID) ID=21
"RTN","ORMPS1",128,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=@ORMSG@(I) Q:$E(SEG,1,3)="ORC"  I $P(SEG,"|",1,2)=("NTE|"_ID) S Y=I Q
"RTN","ORMPS1",129,0)
 Q Y
"RTN","ORMPS1",130,0)
 ;
"RTN","ORMPS1",131,0)
ZSC() ; -- Return subscript of ZSC segment
"RTN","ORMPS1",132,0)
 N I,SEG,Y S Y="",I=+RXE
"RTN","ORMPS1",133,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZSC" S Y=I_U_@ORMSG@(I) Q
"RTN","ORMPS1",134,0)
 Q Y
"RTN","ORMPS1",135,0)
 ;
"RTN","ORMPS1",136,0)
NUMADDS() ; -- count number of additives to determine type
"RTN","ORMPS1",137,0)
 N CNT,I,X S CNT=0,I=+RXE
"RTN","ORMPS1",138,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S X=@ORMSG@(I) Q:$P(X,"|")="ORC"  I $E(X,1,6)="RXC|A|" S CNT=CNT+1
"RTN","ORMPS1",139,0)
 Q CNT
"RTN","ORMPS1",140,0)
 ;
"RTN","ORMPS1",141,0)
PKG(NMSP) ; -- Return Package file ptr for NMSP
"RTN","ORMPS1",142,0)
 N I S I=0
"RTN","ORMPS1",143,0)
 F  S I=+$O(^DIC(9.4,"C",NMSP,I)) Q:I<1  Q:'$O(^(I,0))  ;no Addl Prefs
"RTN","ORMPS1",144,0)
 Q I
"RTN","ORMPS1",145,0)
 ;
"RTN","ORMPS1",146,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMPS1",147,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMPS1",148,0)
 ;
"RTN","ORMPS1",149,0)
DURATION(X) ; -- Returns "# units" from U# format
"RTN","ORMPS1",150,0)
 N Y,Y1,Y2 I X'?.1U1.N Q ""
"RTN","ORMPS1",151,0)
 S Y1=$E(X),Y2=+$E(X,2,$L(X)) I X=+X S Y1="D",Y2=+X
"RTN","ORMPS1",152,0)
 S Y=Y2_" "_$S(Y1="L":"MONTH",Y1="W":"WEEK",Y1="H":"HOUR",Y1="M":"MINUTE",Y1="S":"SECOND",1:"DAY")_$S(Y2>1:"S",1:"")
"RTN","ORMPS1",153,0)
 Q Y
"RTN","ORMPS1",154,0)
 ;
"RTN","ORMPS1",155,0)
QT ; -- Unpiece the Q/T field from RXE
"RTN","ORMPS1",156,0)
 I 'RXE S ORQT(1)=ORQT,ORQT=1 Q  ; nothing to reset
"RTN","ORMPS1",157,0)
 N X,Y,I,J,P,SEG,DONE K ORQT
"RTN","ORMPS1",158,0)
 S SEG=$G(@ORMSG@(+RXE)),X=$P(SEG,"|",2),(I,J,P,DONE)=0
"RTN","ORMPS1",159,0)
 F  D  Q:DONE
"RTN","ORMPS1",160,0)
 . S P=P+1,Y=$P(X,"~",P) I Y="" S DONE=1 Q
"RTN","ORMPS1",161,0)
 . I P<$L(X,"~") S I=I+1,ORQT(I)=Y Q
"RTN","ORMPS1",162,0)
 . I $L(SEG,"|")>2 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",163,0)
 . S J=+$O(@ORMSG@(+RXE,J)) I J'>0 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",164,0)
 . S SEG=$G(@ORMSG@(+RXE,J)),X=$P(SEG,"|"),P=1,I=I+1,ORQT(I)=Y_$P(X,"~")
"RTN","ORMPS1",165,0)
 S ORQT=I Q:'ORQT  ; else reset ORSTRT, ORSTOP, ORURG
"RTN","ORMPS1",166,0)
 S ORSTRT=$P(ORQT(1),U,4),ORSTOP=$P(ORQT(ORQT),U,5),ORURG=$P(ORQT(1),U,6)
"RTN","ORMPS1",167,0)
 S:ORSTRT ORSTRT=$$FMDATE^ORM(ORSTRT) S:ORSTOP ORSTOP=$$FMDATE^ORM(ORSTOP) S:$L(ORURG) ORURG=$$URGENCY^ORM(ORURG)
"RTN","ORMPS1",168,0)
 Q
"VER")
8.0^22.0
**END**
**END**
