Released GMRC*3*27 SEQ #25
Extracted from mail message
**KIDS**:GMRC*3.0*27^

**INSTALL NAME**
GMRC*3.0*27
"BLD",3796,0)
GMRC*3.0*27^CONSULT/REQUEST TRACKING^0^3020718^y
"BLD",3796,1,0)
^^2^2^3020705^
"BLD",3796,1,1,0)
See the National Patch Module for full details of the changes and/or
"BLD",3796,1,2,0)
enhancements included in this build. 
"BLD",3796,4,0)
^9.64PA^123^1
"BLD",3796,4,123,0)
123
"BLD",3796,4,123,2,0)
^9.641^123.02^1
"BLD",3796,4,123,2,123.02,0)
REQUEST PROCESSING ACTIVITY  (sub-file)
"BLD",3796,4,123,2,123.02,1,0)
^9.6411^2^2
"BLD",3796,4,123,2,123.02,1,.01,0)
DATE/TIME OF ACTION ENTRY
"BLD",3796,4,123,2,123.02,1,2,0)
DATE/TIME OF ACTUAL ACTIVITY
"BLD",3796,4,123,222)
y^n^p^^^^n
"BLD",3796,4,"APDD",123,123.02)

"BLD",3796,4,"APDD",123,123.02,.01)

"BLD",3796,4,"APDD",123,123.02,2)

"BLD",3796,4,"B",123,123)

"BLD",3796,"INIT")
POST^GMRCYP27
"BLD",3796,"KRN",0)
^9.67PA^8989.52^19
"BLD",3796,"KRN",.4,0)
.4
"BLD",3796,"KRN",.401,0)
.401
"BLD",3796,"KRN",.402,0)
.402
"BLD",3796,"KRN",.403,0)
.403
"BLD",3796,"KRN",.5,0)
.5
"BLD",3796,"KRN",.84,0)
.84
"BLD",3796,"KRN",3.6,0)
3.6
"BLD",3796,"KRN",3.8,0)
3.8
"BLD",3796,"KRN",9.2,0)
9.2
"BLD",3796,"KRN",9.8,0)
9.8
"BLD",3796,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3796,"KRN",9.8,"NM",1,0)
GMRCTIU^^0^B25045067
"BLD",3796,"KRN",9.8,"NM",2,0)
GMRCYP27^^0^B583627
"BLD",3796,"KRN",9.8,"NM",3,0)
GMRCP^^0^B12723526
"BLD",3796,"KRN",9.8,"NM","B","GMRCP",3)

"BLD",3796,"KRN",9.8,"NM","B","GMRCTIU",1)

"BLD",3796,"KRN",9.8,"NM","B","GMRCYP27",2)

"BLD",3796,"KRN",19,0)
19
"BLD",3796,"KRN",19.1,0)
19.1
"BLD",3796,"KRN",101,0)
101
"BLD",3796,"KRN",101,"NM",0)
^9.68A^3^3
"BLD",3796,"KRN",101,"NM",1,0)
GMRC QC SELECT SERVICE^^0
"BLD",3796,"KRN",101,"NM",2,0)
GMRC OUTSTD CONSLTS SELECT SERVICE^^0
"BLD",3796,"KRN",101,"NM",3,0)
GMRC COMP STAT SELECT SERVICE^^0
"BLD",3796,"KRN",101,"NM","B","GMRC COMP STAT SELECT SERVICE",3)

"BLD",3796,"KRN",101,"NM","B","GMRC OUTSTD CONSLTS SELECT SERVICE",2)

"BLD",3796,"KRN",101,"NM","B","GMRC QC SELECT SERVICE",1)

"BLD",3796,"KRN",409.61,0)
409.61
"BLD",3796,"KRN",771,0)
771
"BLD",3796,"KRN",870,0)
870
"BLD",3796,"KRN",8989.51,0)
8989.51
"BLD",3796,"KRN",8989.52,0)
8989.52
"BLD",3796,"KRN",8994,0)
8994
"BLD",3796,"KRN","B",.4,.4)

"BLD",3796,"KRN","B",.401,.401)

"BLD",3796,"KRN","B",.402,.402)

"BLD",3796,"KRN","B",.403,.403)

"BLD",3796,"KRN","B",.5,.5)

"BLD",3796,"KRN","B",.84,.84)

"BLD",3796,"KRN","B",3.6,3.6)

"BLD",3796,"KRN","B",3.8,3.8)

"BLD",3796,"KRN","B",9.2,9.2)

"BLD",3796,"KRN","B",9.8,9.8)

"BLD",3796,"KRN","B",19,19)

"BLD",3796,"KRN","B",19.1,19.1)

"BLD",3796,"KRN","B",101,101)

"BLD",3796,"KRN","B",409.61,409.61)

"BLD",3796,"KRN","B",771,771)

"BLD",3796,"KRN","B",870,870)

"BLD",3796,"KRN","B",8989.51,8989.51)

"BLD",3796,"KRN","B",8989.52,8989.52)

"BLD",3796,"KRN","B",8994,8994)

"BLD",3796,"QUES",0)
^9.62^^
"BLD",3796,"REQB",0)
^9.611^1^1
"BLD",3796,"REQB",1,0)
GMRC*3.0*22^2
"BLD",3796,"REQB","B","GMRC*3.0*22",1)

"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^n^p^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,40)

"FIA",123,123.02)
1
"FIA",123,123.02,.01)

"FIA",123,123.02,2)

"INIT")
POST^GMRCYP27
"IX",123,123.02,"AC",0)
123.02^AC^Index on activity, actual date of activity and remote date of activity^R^^R^IR^I^123.02^^^^^S
"IX",123,123.02,"AC",.1,0)
^^4^4^3020307^
"IX",123,123.02,"AC",.1,1,0)
This index will be built using the ACTIVITY (field #1), ACTUAL DATE/TIME
"IX",123,123.02,"AC",.1,2,0)
OF ACTIVITY (field #2) and the REMOTE DATE/TIME OF FILING (field #.25).
"IX",123,123.02,"AC",.1,3,0)
This index will be used to prevent an activity from being filed more than
"IX",123,123.02,"AC",.1,4,0)
once, in case of re-transmission of the activity from the remote site.
"IX",123,123.02,"AC",1)
S ^GMR(123,DA(1),40,"AC",$E(X(1),1,3),$E(X(2),1,17),$E(X(3),1,17),DA)=""
"IX",123,123.02,"AC",2)
K ^GMR(123,DA(1),40,"AC",$E(X(1),1,3),$E(X(2),1,17),$E(X(3),1,17),DA)
"IX",123,123.02,"AC",2.5)
K ^GMR(123,DA(1),40,"AC")
"IX",123,123.02,"AC",11.1,0)
^.114IA^3^3
"IX",123,123.02,"AC",11.1,1,0)
1^F^123.02^1^3^1^F
"IX",123,123.02,"AC",11.1,2,0)
2^F^123.02^.25^17^2^F
"IX",123,123.02,"AC",11.1,3,0)
3^F^123.02^2^17^3^F
"KRN",101,3740,-1)
0^2
"KRN",101,3740,0)
GMRC OUTSTD CONSLTS SELECT SERVICE^Service^^A^^^^^^^^
"KRN",101,3740,1,0)
^^2^2^2991202^^^^
"KRN",101,3740,1,1,0)
List Manager Protocol:  Select a new service for displaying consults
"KRN",101,3740,1,2,0)
still pending resolution (all consults not discontinued or complete.)
"KRN",101,3740,2,0)
^101.02A^1^1
"KRN",101,3740,2,1,0)
SS
"KRN",101,3740,2,"B","SS",1)

"KRN",101,3740,4)
24^2
"KRN",101,3740,15)
S VALMBCK="R"
"KRN",101,3740,20)
D FULL^VALM1,EN^GMRCSTLM Q:$D(GMRCQUT)  S GMRCARRN="CP" D ENORLM^GMRCSTLM(GMRCARRN),INIT^GMRCPC,HDR^GMRCPC S VALMBG=1
"KRN",101,3740,99)
58044,59686
"KRN",101,3742,-1)
0^1
"KRN",101,3742,0)
GMRC QC SELECT SERVICE^List Man. Select New Service For QC Review^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,3742,1,0)
^^2^2^2980304^^^
"KRN",101,3742,1,1,0)
List Manager Protocol: Select a new service to view QC results on how
"KRN",101,3742,1,2,0)
many consults/requests are pending resolution.
"KRN",101,3742,2,0)
^101.02A^1^1
"KRN",101,3742,2,1,0)
SS
"KRN",101,3742,2,"B","SS",1)

"KRN",101,3742,4)
24^2
"KRN",101,3742,10,0)
^101.01PA^0^0
"KRN",101,3742,15)
S VALMBCK="R"
"KRN",101,3742,20)
D FULL^VALM1,EN^GMRCQCST Q:$D(GMRCQUT)  D INIT^GMRCQC,HDR^GMRCQC S VALMCNT=$S(GMRCCT>30:GMRCCT,1:30),VALMBCK="R"
"KRN",101,3742,26)

"KRN",101,3742,99)
56426,34898
"KRN",101,5426,-1)
0^3
"KRN",101,5426,0)
GMRC COMP STAT SELECT SERVICE^Select Service^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5426,1,0)
^^4^4^2990910^^^
"KRN",101,5426,1,1,0)
List Manager Protocol:  Select a new service for displaying 
"KRN",101,5426,1,2,0)
consults Statistics pertaining to how long a service takes to 
"KRN",101,5426,1,3,0)
complete a consult/request, from the time that the consult/request 
"KRN",101,5426,1,4,0)
is accepted by the service to the time it is completed.
"KRN",101,5426,2,0)
^101.02A^1^1
"KRN",101,5426,2,1,0)
SS
"KRN",101,5426,2,"B","SS",1)

"KRN",101,5426,15)
S VALMBCK="R"
"KRN",101,5426,20)
D FULL^VALM1,EN^GMRCSTU,ODT^GMRCSTU,INIT^GMRCST,HDR^GMRCST S VALMBG=1
"KRN",101,5426,21,0)
^101.021A^^0
"KRN",101,5426,99)
57912,42566
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
27^3020718
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3020718
"PKG",128,22,1,"PAH",1,1,1,0)
See the National Patch Module for full details of the changes and/or
"PKG",128,22,1,"PAH",1,1,2,0)
enhancements included in this build. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMRCP")
0^3^B12723526
"RTN","GMRCP",1,0)
GMRCP ;SLC/DLT,DCM - Message audit and status process ;4/19/01  11:52
"RTN","GMRCP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,17,22,27**;DEC 27, 1997
"RTN","GMRCP",3,0)
 ;Processing action on Generic Requests/Consults from OE/RR
"RTN","GMRCP",4,0)
MSG(GMRCDFN,GMRCALRM,GMRCIFN,ORN,GMRCADUZ,FLG) ;send alert notification information to OERR for notification or update
"RTN","GMRCP",5,0)
 ;GMRCDFN=patient's DFN           GMRCORFN=OR file # ^OR(100,GMRCORFN
"RTN","GMRCP",6,0)
 ;GMRCALRM=alert message to be displayed with alert
"RTN","GMRCP",7,0)
 ;GMRCIFN=internal file number of consult in file 123
"RTN","GMRCP",8,0)
 ;GMRCADUZ=set in call to EN^GMRCT=array of providers who will be alerted
"RTN","GMRCP",9,0)
 ;FLG=1 if need to get list of service's providers, 0 if service dc'd.
"RTN","GMRCP",10,0)
 ;ORN=IFN from file ^ORD(100.9, for consult notification action
"RTN","GMRCP",11,0)
 N GMRCSS,GMRCORFN
"RTN","GMRCP",12,0)
 S GMRCORFN=$P(^GMR(123,+GMRCIFN,0),"^",3)
"RTN","GMRCP",13,0)
 S GMRCSS=$P($G(^GMR(123,+GMRCIFN,0)),"^",5)
"RTN","GMRCP",14,0)
 I FLG,GMRCSS D EN^GMRCT(GMRCSS)
"RTN","GMRCP",15,0)
 I $P($G(^GMR(123,+GMRCIFN,12)),U,5)="P" D
"RTN","GMRCP",16,0)
 . Q:ORN=27  ; don't notify requestor if a new order they placed, duh...
"RTN","GMRCP",17,0)
 . I DUZ=+$P(^GMR(123,+GMRCIFN,0),U,14) Q  ; don;t alert on own actions
"RTN","GMRCP",18,0)
 . S GMRCADUZ(+$P(^GMR(123,+GMRCIFN,0),U,14))=""
"RTN","GMRCP",19,0)
 I FLG,$P(^GMR(123,+GMRCIFN,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCP",20,0)
 S:'$D(GMRCADUZ) GMRCADUZ=""
"RTN","GMRCP",21,0)
 D EN^ORB3(ORN,GMRCDFN,GMRCORFN,.GMRCADUZ,GMRCALRM,GMRCIFN)
"RTN","GMRCP",22,0)
 Q
"RTN","GMRCP",23,0)
AUDIT ;Build processing activity audit trail multiple.
"RTN","GMRCP",24,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCP",25,0)
AUDIT0 ;alternate entry with date already defined
"RTN","GMRCP",26,0)
 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCP",27,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCP",28,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCP",29,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCP",30,0)
AUDIT1 ;entry when the DA is not incremented (INCOMPLETE RPT writeovers)
"RTN","GMRCP",31,0)
 S GMRCORNP=$G(GMRCORNP) S:'$D(GMRCOM) GMRCOM=0
"RTN","GMRCP",32,0)
 S GMRCDEV=$G(GMRCDEV),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA)
"RTN","GMRCP",33,0)
 S GMRCAD=$S('$D(GMRCAD):GMRCDT,1:GMRCAD)
"RTN","GMRCP",34,0)
 S GMRCRSLT=$G(GMRCRSLT) ;Added result with GMRC*3.0*4
"RTN","GMRCP",35,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCP",36,0)
 I '$D(^GMR(123,DA(1),40,DA,0)) D
"RTN","GMRCP",37,0)
 . S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP"
"RTN","GMRCP",38,0)
 . I GMRCA'=22 S DR=DR_";4////^S X=DUZ" ;if it's a print, pkg did it
"RTN","GMRCP",39,0)
 . S DR=DR_";6////^S X=GMRCFF;7////^S X=GMRCPA;9////^S X=GMRCRSLT;8///^S X=GMRCDEV"
"RTN","GMRCP",40,0)
 E  D
"RTN","GMRCP",41,0)
 . ;DR string on .01 allows write over, rather than forced new entry
"RTN","GMRCP",42,0)
 . S DR=".01///^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=DUZ;6////^S X=GMRCFF;7////^S X=GMRCPA;9////^S X=GMRCRSLT;8///^S X=GMRCDEV"
"RTN","GMRCP",43,0)
 ;Added result to the DR string
"RTN","GMRCP",44,0)
 D ^DIE
"RTN","GMRCP",45,0)
 ;Enter comment
"RTN","GMRCP",46,0)
 I +$G(GMRCOM) S GMRCOM(0)=DA D
"RTN","GMRCP",47,0)
 . W !,"Enter COMMENT..."
"RTN","GMRCP",48,0)
 . N DIC,DWPK,DWLW,DIWESUB
"RTN","GMRCP",49,0)
 . S DIC=DIE_DA_",1,",DWPK=1,DWLW=74
"RTN","GMRCP",50,0)
 . S DIWESUB="COMMENTS" D EN^DIWE
"RTN","GMRCP",51,0)
 . I $P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,DA,0),U,2),0)),U)="ADDED COMMENT",'$O(^GMR(123,+GMRCO,40,DA,0)) D  Q
"RTN","GMRCP",52,0)
 .. S DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCP",53,0)
 .. Q
"RTN","GMRCP",54,0)
 . I $D(^GMR(123,+GMRCO,40,DA,0)),$O(^GMR(123,+GMRCO,40,DA,0)) S $P(GMRCOM,"^",2)=1
"RTN","GMRCP",55,0)
 . Q
"RTN","GMRCP",56,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCP",57,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCP",58,0)
 I $D(^GMR(123,GMRCO,12)),$L($P(^(12),U,5)) D
"RTN","GMRCP",59,0)
 . Q:'$D(^GMR(123,GMRCO,40,DA)) 
"RTN","GMRCP",60,0)
 . D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCP",61,0)
 ;
"RTN","GMRCP",62,0)
 K DIE,DA,DR,GMRCDEV,GMRCFF,GMRCPA,X,% Q
"RTN","GMRCP",63,0)
 ;
"RTN","GMRCP",64,0)
STATUS ;Update the status for the Request/Consultation File
"RTN","GMRCP",65,0)
 K GMRCQUT
"RTN","GMRCP",66,0)
 Q:'$D(GMRCSTS)!('$D(GMRCA))
"RTN","GMRCP",67,0)
 S DIE=123,DA=+GMRCO
"RTN","GMRCP",68,0)
 I $D(GMRCDR),$L(GMRCDR) S DR=GMRCDR
"RTN","GMRCP",69,0)
 E  S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCP",70,0)
 L +^GMR(123,GMRCO):2 I '$T S GMRCQUT=1,GMRCERR=1,GMRCERMS="Unable to update status and last action - Consult In Use By Another User." Q
"RTN","GMRCP",71,0)
 D ^DIE
"RTN","GMRCP",72,0)
 L -^GMR(123,+GMRCO)
"RTN","GMRCP",73,0)
 K DIE,DA,DR,GMRCDR
"RTN","GMRCP",74,0)
 Q
"RTN","GMRCTIU")
0^1^B25045067
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - Consults - TIU utilities ;2/26/02 11:46
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,18,15,17,22,27**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
 ;
"RTN","GMRCTIU",4,0)
 ; This routine invokes IA #2427,#2638,#2832,#3161
"RTN","GMRCTIU",5,0)
 ;
"RTN","GMRCTIU",6,0)
GET(GMRCO,GMRCTUFN,GMRCTUST,GMRCAUTH) ;update Consult from TIU 
"RTN","GMRCTIU",7,0)
 ;GMRCO=IFN from file 123
"RTN","GMRCTIU",8,0)
 ;GMRCTUFN=TIU IFN
"RTN","GMRCTIU",9,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",10,0)
 ;GMRCAUTH=Author of Document
"RTN","GMRCTIU",11,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCAD
"RTN","GMRCTIU",12,0)
 S GMRCA=$S($G(GMRCTUST)["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9)
"RTN","GMRCTIU",13,0)
 I '+$G(GMRCA) S GMRCA=99,GMRCSTS=99
"RTN","GMRCTIU",14,0)
 D:+$G(GMRCA) STATUS^GMRCTIU1
"RTN","GMRCTIU",15,0)
 K GMRCOM,GMRCND,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS
"RTN","GMRCTIU",16,0)
 Q
"RTN","GMRCTIU",17,0)
 ;
"RTN","GMRCTIU",18,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",19,0)
 ;GMRCTUFN=TIU IEN of results record
"RTN","GMRCTIU",20,0)
 ;LINECT=line count for list manager
"RTN","GMRCTIU",21,0)
 N ND,GMRCARR
"RTN","GMRCTIU",22,0)
 D RPC^TIUSRV(.GMRCARR,GMRCTUFN)
"RTN","GMRCTIU",23,0)
 S ND=0
"RTN","GMRCTIU",24,0)
 F  S ND=$O(@GMRCARR@(ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=@GMRCARR@(ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",25,0)
 ;D CLEAN^VALM10
"RTN","GMRCTIU",26,0)
 K @GMRCARR,RESFL,GMRCTIUY
"RTN","GMRCTIU",27,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",28,0)
 Q
"RTN","GMRCTIU",29,0)
ENTER(GMRCO) ; Complete a consult with TIU note
"RTN","GMRCTIU",30,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",31,0)
 D ENTER^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",32,0)
 Q
"RTN","GMRCTIU",33,0)
 ;
"RTN","GMRCTIU",34,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",35,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",36,0)
 D ADDEND^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",37,0)
 Q
"RTN","GMRCTIU",38,0)
 ;
"RTN","GMRCTIU",39,0)
SEND(DFN,OVRRIDE,CP) ;Get consult list and return in ^TMP for TIU
"RTN","GMRCTIU",40,0)
 ;DFN=Patient's Internal file number from file 2
"RTN","GMRCTIU",41,0)
 ;OVRRIDE=BOOLEAN flag to override user validation
"RTN","GMRCTIU",42,0)
 ;CP=2 if only return entries that may have CP docs attached
"RTN","GMRCTIU",43,0)
 ;
"RTN","GMRCTIU",44,0)
 N GMRCI,TAB
"RTN","GMRCTIU",45,0)
 Q:DFN=""!(DFN<1)
"RTN","GMRCTIU",46,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",47,0)
 K ^TMP("GMRCR",$J,"TIU")
"RTN","GMRCTIU",48,0)
 D GETCONSL(DFN,2,$G(OVRRIDE),$G(CP)) ;2=returns TIU format in ^TMP
"RTN","GMRCTIU",49,0)
 Q
"RTN","GMRCTIU",50,0)
 ;
"RTN","GMRCTIU",51,0)
RPCLIST(GMRCY,DFN) ;Get consult list and return in GMRCY for GUI
"RTN","GMRCTIU",52,0)
 N GMRCI
"RTN","GMRCTIU",53,0)
 I '+$G(DFN) S GMRCY(0)=0
"RTN","GMRCTIU",54,0)
 D GETCONSL(DFN,1) ;1=returns GUI format in GMRCY array
"RTN","GMRCTIU",55,0)
 ; The consults will be returned from GETCONSL in the GMRCY array.
"RTN","GMRCTIU",56,0)
 S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",57,0)
 Q
"RTN","GMRCTIU",58,0)
GETCONSL(DFN,ORIGIN,OVRRIDE,GMRCCP) ;Get the patients consults
"RTN","GMRCTIU",59,0)
 ;ORIGIN is whether the request is for GUI=1 or LM=2.
"RTN","GMRCTIU",60,0)
 ;The logic loops through the "AD" cross-reference to find consults
"RTN","GMRCTIU",61,0)
 ;The output will be formatted in GMRCY for the GUI if ORIGIN is 1.
"RTN","GMRCTIU",62,0)
 ;The output will be formatted in ^TMP("GMRCR",$J,"TIU" if ORIGIN is 2.
"RTN","GMRCTIU",63,0)
 ;GMRCCP = 1 = return only CP entries that can have CP doc attached
"RTN","GMRCTIU",64,0)
 ;
"RTN","GMRCTIU",65,0)
 N GMRCQIT,GMRC,GMRCDA,GMRCDT,GMRCEDT,GMRCYR,GMRCSP,GMRCST,GMRCSTS
"RTN","GMRCTIU",66,0)
 N GMRCTIU,GMRCTIUC,GMRCSS,GMRCSVC,GMRCPROC,GMRCNOTE,Y,GMRCDAT,GMRCAU
"RTN","GMRCTIU",67,0)
 ;
"RTN","GMRCTIU",68,0)
 ; Aug 2000 - MA changed routine to use Parameter global to set the
"RTN","GMRCTIU",69,0)
 ; number of days to look backward when getting a list of consults.
"RTN","GMRCTIU",70,0)
 S GMRCYR=$$FMADD^XLFDT(DT,-$$GET^XPAR("ALL","GMRC CONSULT LIST DAYS"))
"RTN","GMRCTIU",71,0)
 S GMRCYR=9999999-GMRCYR,GMRCDAT=0
"RTN","GMRCTIU",72,0)
 F  S GMRCDAT=$O(^GMR(123,"AD",DFN,GMRCDAT)) Q:'GMRCDAT!(GMRCDAT>GMRCYR)  D
"RTN","GMRCTIU",73,0)
 . S GMRCDA=0
"RTN","GMRCTIU",74,0)
 . F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCDAT,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCTIU",75,0)
 .. S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",76,0)
 .. S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",77,0)
 .. I $P($G(^GMR(123,GMRCDA,12)),U,5)="P" Q  ;can't attach to IFC placer
"RTN","GMRCTIU",78,0)
 .. I "25689"'[GMRCST Q  ;only return statuses c,p,a,s,pr
"RTN","GMRCTIU",79,0)
 .. S GMRCDT=+GMRC(0)
"RTN","GMRCTIU",80,0)
 .. S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",81,0)
 .. I '+$G(OVRRIDE) D  Q:'GMRCAU
"RTN","GMRCTIU",82,0)
 ... S GMRCAU=$$VALID^GMRCAU(GMRCSS,GMRCDA)
"RTN","GMRCTIU",83,0)
 ... I GMRCAU=3 S GMRCAU=0 ;exclude admin users
"RTN","GMRCTIU",84,0)
 .. I '$G(GMRCCP),+$G(^GMR(123,GMRCDA,1)) Q  ;no CP requests for CPRS
"RTN","GMRCTIU",85,0)
 .. I $G(GMRCCP),'+$G(^GMR(123,GMRCDA,1)) Q  ;only return CP requests 
"RTN","GMRCTIU",86,0)
 .. S GMRCTIUC=0
"RTN","GMRCTIU",87,0)
 .. D GETLIST^GMRCTIUL(GMRCDA,0,1,.GMRCTIUC)
"RTN","GMRCTIU",88,0)
 .. I ORIGIN=1 D BLDGMRCY Q
"RTN","GMRCTIU",89,0)
 .. I ORIGIN=2 D BLDTMP Q
"RTN","GMRCTIU",90,0)
 .. Q
"RTN","GMRCTIU",91,0)
 . Q
"RTN","GMRCTIU",92,0)
 Q
"RTN","GMRCTIU",93,0)
 ;
"RTN","GMRCTIU",94,0)
BLDGMRCY ;Build the GMRCY array of existing consults
"RTN","GMRCTIU",95,0)
 S GMRCSTS=$P($G(^ORD(100.01,+GMRCST,0)),"^",1)
"RTN","GMRCTIU",96,0)
 S GMRCSS=$P(GMRC(0),U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U)
"RTN","GMRCTIU",97,0)
 S GMRCPROC=$P($G(^GMR(123.3,+$P(GMRC(0),U,8),0)),U)
"RTN","GMRCTIU",98,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",99,0)
 S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC_U_GMRCSTS_U_+GMRCTIUC(0)
"RTN","GMRCTIU",100,0)
 Q
"RTN","GMRCTIU",101,0)
BLDTMP ;Build TMP global for TIU
"RTN","GMRCTIU",102,0)
 S GMRCSTS=$G(^ORD(100.01,+GMRCST,.1))
"RTN","GMRCTIU",103,0)
 S GMRCSP=$$ORTX^GMRCAU(GMRCDA)
"RTN","GMRCTIU",104,0)
 S GMRCNOTE=$S(GMRCTIUC(0)=1:" note",1:" notes")
"RTN","GMRCTIU",105,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCDT,"D")
"RTN","GMRCTIU",106,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",107,0)
 S ^TMP("GMRCR",$J,"TIU",GMRCI,0)=$J(GMRCI,3)_"> "_$E(GMRCEDT_TAB,1,12)_" C#"_$E(GMRCDA_TAB,1,9)_$E(GMRCSP_TAB,1,21)_$E(GMRCSTS_TAB,1,4)_$E(+GMRCTIUC(0)_GMRCNOTE_TAB,1,10)
"RTN","GMRCTIU",108,0)
 S ^TMP("GMRCR",$J,"TIU","B",GMRCI,GMRCDA)=""
"RTN","GMRCTIU",109,0)
 Q
"RTN","GMRCTIU",110,0)
ANYPENDG(DFN,USER) ; Determine if user can update any unresolved CSLTs
"RTN","GMRCTIU",111,0)
 ; Input:
"RTN","GMRCTIU",112,0)
 ;   DFN  = patient being worked on or the one to check from file 2
"RTN","GMRCTIU",113,0)
 ;   USER = the person to check on from file 200
"RTN","GMRCTIU",114,0)
 ;
"RTN","GMRCTIU",115,0)
 ; Output:
"RTN","GMRCTIU",116,0)
 ;   1 = yes there are unresolved consult that could be completed
"RTN","GMRCTIU",117,0)
 ;   0 = no unresolved consults that USER can update
"RTN","GMRCTIU",118,0)
 ;
"RTN","GMRCTIU",119,0)
 N GMRCYR,GMRCDAT,GMRCDONE,GMRCDA,GMRCST,GMRC,GMRCSS,GMRCDT,GMRCAU
"RTN","GMRCTIU",120,0)
 S GMRCYR=$$FMADD^XLFDT(DT,-$$GET^XPAR("ALL","GMRC CONSULT LIST DAYS"))
"RTN","GMRCTIU",121,0)
 S GMRCYR=9999999-GMRCYR,GMRCDAT=0,GMRCDONE=0
"RTN","GMRCTIU",122,0)
 F  S GMRCDAT=$O(^GMR(123,"AD",DFN,GMRCDAT)) Q:'GMRCDAT!(GMRCDAT>GMRCYR)!(GMRCDONE)  D
"RTN","GMRCTIU",123,0)
 . S GMRCDA=0
"RTN","GMRCTIU",124,0)
 . F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCDAT,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCTIU",125,0)
 .. S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",126,0)
 .. S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",127,0)
 .. I $P($G(^GMR(123,GMRCDA,12)),U,5)="P" Q  ;can't attach to IFC placer
"RTN","GMRCTIU",128,0)
 .. I +$G(^GMR(123,GMRCDA,1)) Q  ;can't complete CP's from NOTES tab
"RTN","GMRCTIU",129,0)
 .. I "568"'[GMRCST Q  ;only return statuses p,a,s
"RTN","GMRCTIU",130,0)
 .. S GMRCDT=+GMRC(0)
"RTN","GMRCTIU",131,0)
 .. S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",132,0)
 .. D  Q:'GMRCAU
"RTN","GMRCTIU",133,0)
 ... S GMRCAU=$$VALID^GMRCAU(GMRCSS,GMRCDA)
"RTN","GMRCTIU",134,0)
 ... I GMRCAU=3 S GMRCAU=0 ;exclude admin users
"RTN","GMRCTIU",135,0)
 ... I GMRCAU S GMRCDONE=1
"RTN","GMRCTIU",136,0)
 Q GMRCDONE
"RTN","GMRCTIU",137,0)
 ;
"RTN","GMRCYP27")
0^2^B583627
"RTN","GMRCYP27",1,0)
GMRCYP27 ;SLC/JFR - Post-Install GMRC*3*27 ; 6/21/02 10:19
"RTN","GMRCYP27",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**27**;DEC 27, 1997
"RTN","GMRCYP27",3,0)
POST ;post intstall entry point
"RTN","GMRCYP27",4,0)
 N GMRCXDT
"RTN","GMRCYP27",5,0)
 S GMRCXDT=" "
"RTN","GMRCYP27",6,0)
 F  S GMRCXDT=$O(^GMR(123,"E",GMRCXDT)) Q:'+GMRCXDT  D
"RTN","GMRCYP27",7,0)
 . N GMRCIEN
"RTN","GMRCYP27",8,0)
 . S GMRCIEN=0
"RTN","GMRCYP27",9,0)
 . F  S GMRCIEN=$O(^GMR(123,"E",GMRCXDT,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCYP27",10,0)
 .. N DIE,DA,DR,GMRCRDT
"RTN","GMRCYP27",11,0)
 .. S GMRCRDT=$P(^GMR(123,GMRCIEN,0),U,7)
"RTN","GMRCYP27",12,0)
 .. S DIE="^GMR(123,",DA=GMRCIEN,DR="3///^S X=GMRCRDT"
"RTN","GMRCYP27",13,0)
 .. D ^DIE
"RTN","GMRCYP27",14,0)
 .. Q
"RTN","GMRCYP27",15,0)
 Q
"UP",123,123.02,-1)
123^40
"UP",123,123.02,0)
123.02
"VER")
8.0^22.0
"^DD",123,123,40,0)
REQUEST PROCESSING ACTIVITY^123.02D^^40;0
"^DD",123,123,40,21,0)
^.001^1^1^3020619^^^^
"^DD",123,123,40,21,1,0)
Maintains history of processing actions.
"^DD",123,123,40,"DT")
3020619
"^DD",123,123.02,0)
REQUEST PROCESSING ACTIVITY SUB-FIELD^^.25^17
"^DD",123,123.02,0,"NM","REQUEST PROCESSING ACTIVITY")

"^DD",123,123.02,.01,0)
DATE/TIME OF ACTION ENTRY^RDX^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",123,123.02,.01,.1)
ACTIVITY ENTRY DATE
"^DD",123,123.02,.01,1,0)
^.1
"^DD",123,123.02,.01,1,1,0)
123.02^B
"^DD",123,123.02,.01,1,1,1)
S ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)=""
"^DD",123,123.02,.01,1,1,2)
K ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)
"^DD",123,123.02,.01,3)
Enter the Date/Time you are entering this activity.
"^DD",123,123.02,.01,21,0)
^.001^2^2^3020619^^^
"^DD",123,123.02,.01,21,1,0)
This is the actual date and time the activity tracking update was added
"^DD",123,123.02,.01,21,2,0)
to the REQUEST PROCESSING ACTIVITY multiple.
"^DD",123,123.02,.01,"DT")
3020619
"^DD",123,123.02,2,0)
DATE/TIME OF ACTUAL ACTIVITY^DX^^0;3^S %DT="ETXS",%DT(0)="-NOW" D ^%DT K %DT(0) S X=Y K:Y<1 X
"^DD",123,123.02,2,.1)

"^DD",123,123.02,2,3)
ENTER BOTH DATE AND TIME.  FUTURE DATE/TIME NOT PERMITTED.
"^DD",123,123.02,2,21,0)
^.001^2^2^3020619^^^^
"^DD",123,123.02,2,21,1,0)
The Date and time the actual activity was done.  This may be different 
"^DD",123,123.02,2,21,2,0)
than the DATE/TIME OF ACTION ENTRY for certain actions.
"^DD",123,123.02,2,"DT")
3020619
**END**
**END**
