Released PSA*3*16 SEQ #12
Extracted from mail message
**KIDS**:PSA*3.0*16^

**INSTALL NAME**
PSA*3.0*16
"BLD",762,0)
PSA*3.0*16^DRUG ACCOUNTABILITY^0^2990629^y
"BLD",762,1,0)
^^3^3^2990629^^^
"BLD",762,1,1,0)
 When the Outstanding Credits [PSA OUTSTANDING CREDITS] option is
"BLD",762,1,2,0)
 executed, and undefined error occurs in routine PSACREDO at line PRINT+17.
"BLD",762,1,3,0)
 The error occurs when all items on a invoice are adjusted to zero.
"BLD",762,"KRN",0)
^9.67PA^^
"BLD",762,"KRN",.4,0)
.4
"BLD",762,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",762,"KRN",.401,0)
.401
"BLD",762,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",762,"KRN",.402,0)
.402
"BLD",762,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",762,"KRN",.403,0)
.403
"BLD",762,"KRN",.5,0)
.5
"BLD",762,"KRN",.84,0)
.84
"BLD",762,"KRN",3.6,0)
3.6
"BLD",762,"KRN",3.8,0)
3.8
"BLD",762,"KRN",9.2,0)
9.2
"BLD",762,"KRN",9.8,0)
9.8
"BLD",762,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",762,"KRN",9.8,"NM",1,0)
PSACREDO^^0^B71811499
"BLD",762,"KRN",9.8,"NM","B","PSACREDO",1)

"BLD",762,"KRN",19,0)
19
"BLD",762,"KRN",19.1,0)
19.1
"BLD",762,"KRN",101,0)
101
"BLD",762,"KRN",409.61,0)
409.61
"BLD",762,"KRN",771,0)
771
"BLD",762,"KRN",869.2,0)
869.2
"BLD",762,"KRN",870,0)
870
"BLD",762,"KRN",8994,0)
8994
"BLD",762,"KRN","B",.4,.4)

"BLD",762,"KRN","B",.401,.401)

"BLD",762,"KRN","B",.402,.402)

"BLD",762,"KRN","B",.403,.403)

"BLD",762,"KRN","B",.5,.5)

"BLD",762,"KRN","B",.84,.84)

"BLD",762,"KRN","B",3.6,3.6)

"BLD",762,"KRN","B",3.8,3.8)

"BLD",762,"KRN","B",9.2,9.2)

"BLD",762,"KRN","B",9.8,9.8)

"BLD",762,"KRN","B",19,19)

"BLD",762,"KRN","B",19.1,19.1)

"BLD",762,"KRN","B",101,101)

"BLD",762,"KRN","B",409.61,409.61)

"BLD",762,"KRN","B",771,771)

"BLD",762,"KRN","B",869.2,869.2)

"BLD",762,"KRN","B",870,870)

"BLD",762,"KRN","B",8994,8994)

"BLD",762,"QUES",0)
^9.62^^
"BLD",762,"REQB",0)
^9.611^1^1
"BLD",762,"REQB",1,0)
PSA*3.0*3^1
"BLD",762,"REQB","B","PSA*3.0*3",1)

"BLD",762,"REQG",0)
^9.611^^
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2990610^2970912^531
"PKG",182,22,1,"PAH",1,0)
16^2990629
"PKG",182,22,1,"PAH",1,1,0)
^^3^3^2990629
"PKG",182,22,1,"PAH",1,1,1,0)
 When the Outstanding Credits [PSA OUTSTANDING CREDITS] option is
"PKG",182,22,1,"PAH",1,1,2,0)
 executed, and undefined error occurs in routine PSACREDO at line PRINT+17.
"PKG",182,22,1,"PAH",1,1,3,0)
 The error occurs when all items on a invoice are adjusted to zero.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSACREDO")
0^1^B71811499
"RTN","PSACREDO",1,0)
PSACREDO ;BIR/JMB-Outstanding Credits ;7/23/97
"RTN","PSACREDO",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**3,16**; 10/24/97
"RTN","PSACREDO",3,0)
 ;This routine prints detailed or summary outstanding credits report.
"RTN","PSACREDO",4,0)
 ;
"RTN","PSACREDO",5,0)
 ;References to ^PSDRUG( are covered by DBIA #2095
"RTN","PSACREDO",6,0)
 ;PSA*3*16 (DAVE B) Changed PSADJQ=0 to PSADJQ=""
"RTN","PSACREDO",7,0)
 ;
"RTN","PSACREDO",8,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSACREDO",9,0)
 I '$O(^PSD(58.811,"AC",1,0)) W !!,"There are no outstanding credit memos." Q
"RTN","PSACREDO",10,0)
 S DIR(0)="S^D:Detailed Report;S:Summary Report",DIR("A")="Print a detailed or summary report",DIR("??")="^D RPT^PSACREDO" D ^DIR K DIR I $G(DIRUT) G EXIT
"RTN","PSACREDO",11,0)
 S PSARPT=Y W:PSARPT="D" !!,"The report must be sent to a 132 column printer."
"RTN","PSACREDO",12,0)
DEVICE W ! S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","PSACREDO",13,0)
 ;I PSARPT="D",$E(IOST,1,2)="C-" W !!,"The report must be sent to a 132 column printer." G DEVICE
"RTN","PSACREDO",14,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSACREDO",15,0)
 .S ZTDESC="Drug Acct. - Print Outstanding Credits",ZTRTN="DQ^PSACREDO"
"RTN","PSACREDO",16,0)
 .S ZTSAVE("PSARPT")="" D ^%ZTLOAD
"RTN","PSACREDO",17,0)
DQ S PSASLN="",$P(PSASLN,"-",80)="",PSALSLN="",$P(PSALSLN,"-",132)=""
"RTN","PSACREDO",18,0)
 S (PSAGDF,PSA,PSAOUT,PSAPG)=0
"RTN","PSACREDO",19,0)
 F  S PSA=+$O(^PSD(58.811,"AC",1,PSA)) Q:'PSA  D  Q:PSAOUT
"RTN","PSACREDO",20,0)
 .Q:'$D(^PSD(58.811,PSA,0))
"RTN","PSACREDO",21,0)
 .S PSAORD=$P(^PSD(58.811,PSA,0),"^"),(PSA1,PSAOECST,PSAODF)=0
"RTN","PSACREDO",22,0)
 .F  S PSA1=+$O(^PSD(58.811,"AC",1,PSA,PSA1)) Q:'PSA1  D  Q:PSAOUT
"RTN","PSACREDO",23,0)
 ..Q:'$D(^PSD(58.811,PSA,1,PSA1,0))
"RTN","PSACREDO",24,0)
 ..S PSAINV=$P(^PSD(58.811,PSA,1,PSA1,0),"^"),(PSACRED,PSAAECST,PSAIECST)=0
"RTN","PSACREDO",25,0)
 ..S PSA2=0 F  S PSA2=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2)) Q:'PSA2!(PSAOUT)  D  Q:PSAOUT
"RTN","PSACREDO",26,0)
 ...Q:'$D(^PSD(58.811,PSA,1,PSA1,1,PSA2,0))
"RTN","PSACREDO",27,0)
 ...S PSADATA=^PSD(58.811,PSA,1,PSA1,1,PSA2,0)
"RTN","PSACREDO",28,0)
 ...D LINE
"RTN","PSACREDO",29,0)
 ..D CREDITS S PSAODF=PSAODF+$G(PSADF),PSAOECST=PSAOECST+PSAAECST
"RTN","PSACREDO",30,0)
 .S PSA(PSAORD)=$J(PSAOECST,$L($P(PSAOECST,".")),2)_"^"_$J(PSAODF,$L($P(PSAODF,".")),2)
"RTN","PSACREDO",31,0)
 .S PSAGDF=PSAGDF+PSAODF
"RTN","PSACREDO",32,0)
 ;
"RTN","PSACREDO",33,0)
 S PSAORD="" F  S PSAORD=$O(PSA(PSAORD)) Q:PSAORD=""  S PSAINV="" F  S PSAINV=$O(^PSD(58.811,"AORD",PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSACREDO",34,0)
 .Q:$D(PSA(PSAORD,PSAINV))  S (PSA,PSAAECST,PSAIECST)=0
"RTN","PSACREDO",35,0)
 .F  S PSA=$O(^PSD(58.811,"AORD",PSAORD,PSAINV,PSA)) Q:'PSA  S PSA1=0 F  S PSA1=$O(^PSD(58.811,"AORD",PSAORD,PSAINV,PSA,PSA1)) Q:'PSA1  D
"RTN","PSACREDO",36,0)
 ..D GETLINE
"RTN","PSACREDO",37,0)
 ..I 'PSAAECST&(+PSAIECST) S $P(PSA(PSAORD),"^")=+$P(PSA(PSAORD),"^")+PSAIECST,$P(PSA(PSAORD),"^")=$J($P(PSA(PSAORD),"^"),$L($P($P(PSA(PSAORD),"^"),".")),2)
"RTN","PSACREDO",38,0)
 ..I PSAAECST S $P(PSA(PSAORD),"^")=+$P(PSA(PSAORD),"^")+PSAAECST,$P(PSA(PSAORD),"^")=$J($P(PSA(PSAORD),"^"),$L($P($P(PSA(PSAORD),"^"),".")),2)
"RTN","PSACREDO",39,0)
 D PRINT
"RTN","PSACREDO",40,0)
 ;
"RTN","PSACREDO",41,0)
EXIT D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSACREDO",42,0)
 K %ZIS,DIR,DIRUT,PSA,PSA1,PSA2,PSAACST,PSAAECST,PSAAVAL,PSAC,PSACRED,PSADATA,PSADF,PSADJ,PSADJD,PSADJP,PSADJQ,PSADRG,PSADT,PSAFLD,PSAGDF,PSAICST
"RTN","PSACREDO",43,0)
 K PSAIDF,PSAIECST,PSAINV,PSAINVDT,PSAIVAL,PSAKK,PSALN,PSALSLN,PSAN,PSAODF,PSAOECST,PSAORD,PSAOUT,PSAPFLD,PSAPG,PSAPRC,PSAPRT,PSAQFLD,PSAREA,PSARPDT,PSARPT,PSASLN,PSASS,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSACREDO",44,0)
 Q
"RTN","PSACREDO",45,0)
 ;
"RTN","PSACREDO",46,0)
LINE ;Get line item data
"RTN","PSACREDO",47,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,".")
"RTN","PSACREDO",48,0)
 S PSARPDT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)_"@"_$P(PSARPDT,".",2)
"RTN","PSACREDO",49,0)
 S (PSADJQ,PSADJP,PSADJD,PSAPFLD,PSAQFLD,PSAREA)="",(PSADRG,PSAACST,PSAICST)=0
"RTN","PSACREDO",50,0)
 S PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","D",0))
"RTN","PSACREDO",51,0)
 I $G(PSADJ) D
"RTN","PSACREDO",52,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0))
"RTN","PSACREDO",53,0)
 .S PSADJD=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:$P(PSAN,"^",2)),PSADRG=PSADJD
"RTN","PSACREDO",54,0)
 .Q:$G(PSADJD)&($L(PSADJD)=+$L(PSADJD))
"RTN","PSACREDO",55,0)
 E  S PSADRG=$P(PSADATA,"^",2)
"RTN","PSACREDO",56,0)
 S PSAICST=$P(PSADATA,"^",3)*$P(PSADATA,"^",5),PSAIECST=PSAIECST+PSAICST
"RTN","PSACREDO",57,0)
 S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","P",0))
"RTN","PSACREDO",58,0)
 I $G(PSADJ) D
"RTN","PSACREDO",59,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSAPRC=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:+$P(PSAN,"^",2)),PSADJP=PSAPRC
"RTN","PSACREDO",60,0)
 .S PSAPFLD="P"
"RTN","PSACREDO",61,0)
 I '$G(PSADJ) S PSAPRC=$P(PSADATA,"^",5)
"RTN","PSACREDO",62,0)
 S PSADJQ="",PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","Q",0))
"RTN","PSACREDO",63,0)
 I $G(PSADJ) D
"RTN","PSACREDO",64,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0))
"RTN","PSACREDO",65,0)
 .S PSADJQ=$S($P(PSAN,"^",6)'="":+$P(PSAN,"^",6),1:+$P(PSAN,"^",2))
"RTN","PSACREDO",66,0)
 .S PSAREA=$S($P(PSAN,"^",7)'="":$P(PSAN,"^",7),1:$P(PSAN,"^",3)),PSAQFLD="Q"
"RTN","PSACREDO",67,0)
 I $G(PSADJQ) S PSAACST=PSADJQ*PSAPRC,PSAAECST=PSAAECST+PSAACST
"RTN","PSACREDO",68,0)
 I '$G(PSADJQ) S PSAACST=$P(PSADATA,"^",3)*PSAPRC,PSAAECST=PSAAECST+PSAACST
"RTN","PSACREDO",69,0)
 I PSAICST'=PSAACST D
"RTN","PSACREDO",70,0)
 .S PSALN=$P(PSADATA,"^")
"RTN","PSACREDO",71,0)
 .S PSADRG=$S(+PSADRG&($P($G(^PSDRUG(PSADRG,0)),"^")'=""):$P(^PSDRUG(PSADRG,0),"^"),'PSADRG:PSADRG,1:"UNKNOWN DRUG")
"RTN","PSACREDO",72,0)
 .I PSAPFLD="P" S PSA(PSAORD,PSAINV,PSALN,PSAPFLD)=PSADRG_"^^"_$J($P(PSADATA,"^",5),$L($P(PSADATA,"^",5)),2)_"^"_$J(PSADJP,$L(PSADJP),2)
"RTN","PSACREDO",73,0)
 .I PSAQFLD="Q" S PSA(PSAORD,PSAINV,PSALN,PSAQFLD)=PSADRG_"^"_$S(PSAREA'="":PSAREA,1:"UNK")_"^"_$P(PSADATA,"^",3)_"^"_PSADJQ
"RTN","PSACREDO",74,0)
 Q
"RTN","PSACREDO",75,0)
 ;
"RTN","PSACREDO",76,0)
GETLINE ;Gets invoice cost from line items
"RTN","PSACREDO",77,0)
 S PSA2=0 F  S PSA2=$O(^PSD(58.811,PSA,1,PSA1,1,PSA2)) Q:'PSA2  D
"RTN","PSACREDO",78,0)
 .Q:'$D(^PSD(58.811,PSA,1,PSA1,1,PSA2,0))
"RTN","PSACREDO",79,0)
 .S PSADATA=^PSD(58.811,PSA,1,PSA1,1,PSA2,0),PSAIECST=PSAIECST+($P(PSADATA,"^",3)*$P(PSADATA,"^",5))
"RTN","PSACREDO",80,0)
 .S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","P",0))
"RTN","PSACREDO",81,0)
 .I +PSADJ S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSAPRC=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:+$P(PSAN,"^",2)),PSADJP=PSAPRC
"RTN","PSACREDO",82,0)
 .S:'+PSADJ PSAPRC=$P(PSADATA,"^",5)
"RTN","PSACREDO",83,0)
 .;
"RTN","PSACREDO",84,0)
 .S PSADJQ="",PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","Q",0))
"RTN","PSACREDO",85,0)
 .S:+PSADJ PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSADJQ=$S($P(PSAN,"^",6)'="":+$P(PSAN,"^",6),1:+$P(PSAN,"^",2))
"RTN","PSACREDO",86,0)
 .S:$G(PSADJQ)'="" PSAAECST=PSAAECST+(PSADJQ*PSAPRC)
"RTN","PSACREDO",87,0)
 .S:$G(PSADJQ)="" PSAAECST=PSAAECST+($P(PSADATA,"^",3)*PSAPRC)
"RTN","PSACREDO",88,0)
 Q
"RTN","PSACREDO",89,0)
 ;
"RTN","PSACREDO",90,0)
CREDITS ;Adds existing credits to adjusted extended cost.
"RTN","PSACREDO",91,0)
 S PSAC=0 F  S PSAC=$O(^PSD(58.811,PSA,1,PSA1,2,PSAC)) Q:'PSAC  D
"RTN","PSACREDO",92,0)
 .Q:'$D(^PSD(58.811,PSA,1,PSA1,2,PSAC,0))
"RTN","PSACREDO",93,0)
 .S PSACRED=PSACRED+$P(^PSD(58.811,PSA,1,PSA1,2,PSAC,0),"^",3)
"RTN","PSACREDO",94,0)
 I PSAAECST'=PSAIECST D
"RTN","PSACREDO",95,0)
 .S PSADF=PSAIECST-(PSAAECST+PSACRED)
"RTN","PSACREDO",96,0)
 .S PSA(PSAORD,PSAINV)=$J(PSAIECST,$L(PSAIECST),2)_"^"_$J(PSAAECST,$L($P(PSAAECST,".")),2)_"^"_$J(PSACRED,$L(PSACRED),2)_"^"_$J(PSADF,$L(PSADF),2)_"^"_+$P($G(^PSD(58.811,PSA,1,PSA1,0)),"^",2)
"RTN","PSACREDO",97,0)
 Q
"RTN","PSACREDO",98,0)
 ;
"RTN","PSACREDO",99,0)
PRINT ;Displays the invoices with outstanding credits
"RTN","PSACREDO",100,0)
 D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET
"RTN","PSACREDO",101,0)
 S PSAORD="" F  S PSAORD=$O(PSA(PSAORD)) Q:PSAORD=""!(PSAOUT)  D
"RTN","PSACREDO",102,0)
 .S PSAODF=$P(PSA(PSAORD),"^",2)
"RTN","PSACREDO",103,0)
 .I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",104,0)
 .W:PSARPT="S" ! W:PSARPT="D" !,PSALSLN W !,"ORDER#: "_PSAORD_" ($"_$P(PSA(PSAORD),"^")_")"
"RTN","PSACREDO",105,0)
 .S PSAINV="" F  S PSAINV=$O(PSA(PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSACREDO",106,0)
 ..S PSAIECST=$P(PSA(PSAORD,PSAINV),"^"),PSAAECST=$P(PSA(PSAORD,PSAINV),"^",2),PSACRED=$P(PSA(PSAORD,PSAINV),"^",3),PSAIDF=$P(PSA(PSAORD,PSAINV),"^",4)
"RTN","PSACREDO",107,0)
 ..S PSAINVDT=$P(PSA(PSAORD,PSAINV),"^",5),PSAINVDT=$E(PSAINVDT,4,5)_"/"_$E(PSAINVDT,6,7)_"/"_$E(PSAINVDT,2,3)
"RTN","PSACREDO",108,0)
 ..S PSAPRT=0,PSALN="" F  S PSALN=$O(PSA(PSAORD,PSAINV,PSALN)) Q:PSALN=""  D
"RTN","PSACREDO",109,0)
 ...S PSAFLD="" F  S PSAFLD=$O(PSA(PSAORD,PSAINV,PSALN,PSAFLD)) Q:PSAFLD=""  D
"RTN","PSACREDO",110,0)
 ....S PSADATA=PSA(PSAORD,PSAINV,PSALN,PSAFLD),PSADRG=$P(PSADATA,"^"),PSAREA=$P(PSADATA,"^",2),PSAIVAL=$P(PSADATA,"^",3),PSAAVAL=$P(PSADATA,"^",4),PSAPRT=PSAPRT+1
"RTN","PSACREDO",111,0)
 ....I PSARPT="D",$Y+5>IOSL D HDRDET Q:PSAOUT
"RTN","PSACREDO",112,0)
 ....I PSARPT="D" D:PSAPRT=1 PRTDLINE D:PSAPRT>1 PRTDLIN1
"RTN","PSACREDO",113,0)
 ..I PSARPT="S",$Y+5>IOSL D HDRSUM Q:PSAOUT
"RTN","PSACREDO",114,0)
 ..D:PSARPT="S" PRTSLINE
"RTN","PSACREDO",115,0)
 .I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",116,0)
 .I PSAODF'=PSADF W !,"ORDER TOTAL" W:PSARPT="D" ?65 W:PSARPT="S" ?69 W $J(PSAODF,9,2)
"RTN","PSACREDO",117,0)
 I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",118,0)
 W ! W:PSARPT="S" PSASLN W:PSARPT="D" PSALSLN
"RTN","PSACREDO",119,0)
 W !,"GRAND TOTAL" W:PSARPT="D" ?65 W:PSARPT="S" ?69 W $J(PSAGDF,9,2),!
"RTN","PSACREDO",120,0)
 I $E(IOST,1,2)="C-" D END^PSAPROC
"RTN","PSACREDO",121,0)
 E  W @IOF
"RTN","PSACREDO",122,0)
 Q
"RTN","PSACREDO",123,0)
 ;
"RTN","PSACREDO",124,0)
HDRDET ;Header for detail report
"RTN","PSACREDO",125,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSACREDO",126,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSACREDO",127,0)
 S PSAPG=PSAPG+1
"RTN","PSACREDO",128,0)
 W ! W:$E(IOST)'="C" "RUN DATE: "_PSARPDT
"RTN","PSACREDO",129,0)
 W ?46,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSACREDO",130,0)
 W !?53,"OUTSTANDING CREDITS REPORT",!?124,"PAGE "_PSAPG
"RTN","PSACREDO",131,0)
 W !!?36,"INVOICE",?46,"ADJUSTED",?58,"RECEIVED",?68,"OUTST.",?84,"DRUG &"
"RTN","PSACREDO",132,0)
 W !,"INVOICE#",?28,"DATE",?39,"COST",?50,"COST",?59,"CREDITS",?68,"CREDIT",?77,"LINE#",?84,"ADJUSTMENT REASON",?117,"INVOICE",?129,"ADJ",!
"RTN","PSACREDO",133,0)
 W:PSAPG'=1 PSALSLN
"RTN","PSACREDO",134,0)
 Q
"RTN","PSACREDO",135,0)
 ;
"RTN","PSACREDO",136,0)
PRTDLINE ;Prints a line of data on the detailed report
"RTN","PSACREDO",137,0)
 W !,PSAINV,?26,PSAINVDT,?30,$J(PSAIECST,9,2),?45,$J(PSAAECST,9,2),?57,$J(PSACRED,9,2),?67,$J(PSAIDF,7,2),?74,$J(PSALN,8,0),?84,$E(PSADRG,1,33),?117,$J(PSAIVAL,7),?125,$J(PSAAVAL,7)
"RTN","PSACREDO",138,0)
 W !?84,$S(PSAFLD="P":"ORDER UNIT PRICE CHANGED ",PSAFLD="Q":"QTY: "_PSAREA,1:"")
"RTN","PSACREDO",139,0)
 Q
"RTN","PSACREDO",140,0)
 ;
"RTN","PSACREDO",141,0)
PRTDLIN1 ;Prints a line of data on the detailed report
"RTN","PSACREDO",142,0)
 W !?74,$J(PSALN,8,0),?84,PSADRG,?117,$J(PSAIVAL,7),?125,$J(PSAAVAL,7)
"RTN","PSACREDO",143,0)
 W !?84,$S(PSAFLD="P":"ORDER UNIT PRICE CHANGED ",PSAFLD="Q":"QTY: "_PSAREA,1:"")
"RTN","PSACREDO",144,0)
 Q
"RTN","PSACREDO",145,0)
 ;
"RTN","PSACREDO",146,0)
HDRSUM ;Header for summary report
"RTN","PSACREDO",147,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSACREDO",148,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSACREDO",149,0)
 S PSAPG=PSAPG+1
"RTN","PSACREDO",150,0)
 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSACREDO",151,0)
 W !?27,"OUTSTANDING CREDITS REPORT",!?72,"PAGE "_PSAPG
"RTN","PSACREDO",152,0)
 W ! W:$E(IOST)'="C" "RUN DATE: "_PSARPDT
"RTN","PSACREDO",153,0)
 W !?36,"INVOICE",?46,"ADJUSTED",?58,"RECEIVED",?72,"OUTST."
"RTN","PSACREDO",154,0)
 W !,"INVOICE#",?28,"DATE",?39,"COST",?50,"COST",?59,"CREDITS",?72,"CREDIT",!,PSASLN
"RTN","PSACREDO",155,0)
 Q
"RTN","PSACREDO",156,0)
 ;
"RTN","PSACREDO",157,0)
PRTSLINE ;Prints a line of data on the summary report
"RTN","PSACREDO",158,0)
 W !,PSAINV,?26,PSAINVDT,?30,$J(PSAIECST,9,2),?45,$J(PSAAECST,9,2),?57,$J(PSACRED,9,2),?71,$J(PSAIDF,7,2)
"RTN","PSACREDO",159,0)
 Q
"RTN","PSACREDO",160,0)
 ;
"RTN","PSACREDO",161,0)
RPT ;Extended help for "Print a detailed or summary report"
"RTN","PSACREDO",162,0)
 W !?5,"Select DETAILED to print the order number, invoice number, invoice date,",!?5,"total invoice cost, adjusted cost, received credits, and Derence."
"RTN","PSACREDO",163,0)
 W !!?5,"Select SUMMARY to print all of the data on the detailed report plus the",!?5,"line item data that created the need for a credit. The line item data is"
"RTN","PSACREDO",164,0)
 W !?5,"the line item number, drug name, quantity invoiced, quantity received,",!?5,"reason for credit."
"RTN","PSACREDO",165,0)
 Q
"VER")
8.0^21.0
**END**
**END**
