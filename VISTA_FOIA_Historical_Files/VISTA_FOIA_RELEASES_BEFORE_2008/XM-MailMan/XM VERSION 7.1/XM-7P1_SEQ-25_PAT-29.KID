Released XM*7.1*29 SEQ #25
Extracted from mail message
**KIDS**:XM*7.1*29^

**INSTALL NAME**
XM*7.1*29
"BLD",9,0)
XM*7.1*29^MAILMAN^0^2960726^n
"BLD",9,1,0)
^^51^51^2960726^^^^
"BLD",9,1,1,0)
 This Mailman patch will set the vaporization date for messages that are
"BLD",9,1,2,0)
 distributed via the XMYB-BROADCAST-VA-WIDE Server Option, for example, 
"BLD",9,1,3,0)
 Secretary Brown's Daily Message. The vaporization date is set only if
"BLD",9,1,4,0)
 the message stays in the users IN BASKET. If a user saves the message to
"BLD",9,1,5,0)
 another Basket, the vaporization date is not maintained. A user can enter
"BLD",9,1,6,0)
 a new vaporization date by entering 'V' at the 'MESSAGE Action' prompt.
"BLD",9,1,7,0)

"BLD",9,1,8,0)
 This patch will not effect broadcast messages that originate locally, but 
"BLD",9,1,9,0)
 only those originated from FORUM. The vaporization date is depended on how
"BLD",9,1,10,0)
 the parameter is set in the Routine field for the XMYB-BROADCAST-VA-WIDE
"BLD",9,1,11,0)
 Option.
"BLD",9,1,12,0)
 
"BLD",9,1,13,0)
 Case #1 - if Routine field looks like: ENT^XMGAPI3("*"), this means
"BLD",9,1,14,0)
 that the message was sent to ALL mail users, then the Vaporization date
"BLD",9,1,15,0)
 will be set to T+7.
"BLD",9,1,16,0)
 
"BLD",9,1,17,0)
 Case #2 - if the Routine entry looks like: ENT^XMAPI3(".6"), this means
"BLD",9,1,18,0)
 that the message was sent to *just* SHARED MAIL's IN BASKET, then the
"BLD",9,1,19,0)
 Vaporization date will be set to T+30.
"BLD",9,1,20,0)
===========================================================================
"BLD",9,1,21,0)

"BLD",9,1,22,0)
 This patch can be installed with users on the system.
"BLD",9,1,23,0)
===========================================================================
"BLD",9,1,24,0)

"BLD",9,1,25,0)
INSTALLATION:
"BLD",9,1,26,0)
  1.  This routine is usually mapped on systems that allow mapping,
"BLD",9,1,27,0)
      so you will need to disable mapping for the effected routine.
"BLD",9,1,28,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",9,1,29,0)
      option will load the KIDS package onto your system.
"BLD",9,1,30,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",9,1,31,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",9,1,32,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",9,1,33,0)
      options:
"BLD",9,1,34,0)
         Print Transport Global
"BLD",9,1,35,0)
         Compare Transport Global to Current System
"BLD",9,1,36,0)
         Verify Checksums in Transport Global
"BLD",9,1,37,0)
         Backup a Transport Global
"BLD",9,1,38,0)
         Install Package(s)
"BLD",9,1,39,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",9,1,40,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",9,1,41,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",9,1,42,0)
===========================================================================  
"BLD",9,1,43,0)
  
"BLD",9,1,44,0)
 ROUTINES:
"BLD",9,1,45,0)
   The second line of the routine now looks like:
"BLD",9,1,46,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",9,1,47,0)
 
"BLD",9,1,48,0)
 Name          Checksum          Patch List
"BLD",9,1,49,0)
 ----------------------------------------------------------
"BLD",9,1,50,0)
 XMGAPI3        2791662           29
"BLD",9,1,51,0)
============================================================================
"BLD",9,4,0)
^9.64PA^^
"BLD",9,"KRN",0)
^9.67PA^19^12
"BLD",9,"KRN",.4,0)
.4
"BLD",9,"KRN",.401,0)
.401
"BLD",9,"KRN",.402,0)
.402
"BLD",9,"KRN",.403,0)
.403
"BLD",9,"KRN",.5,0)
.5
"BLD",9,"KRN",.84,0)
.84
"BLD",9,"KRN",3.6,0)
3.6
"BLD",9,"KRN",3.8,0)
3.8
"BLD",9,"KRN",9.2,0)
9.2
"BLD",9,"KRN",9.8,0)
9.8
"BLD",9,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9,"KRN",9.8,"NM",1,0)
XMGAPI3^^0^B9180387
"BLD",9,"KRN",9.8,"NM","B","XMGAPI3",1)

"BLD",9,"KRN",19,0)
19
"BLD",9,"KRN",19.1,0)
19.1
"BLD",9,"KRN","B",.4,.4)

"BLD",9,"KRN","B",.401,.401)

"BLD",9,"KRN","B",.402,.402)

"BLD",9,"KRN","B",.403,.403)

"BLD",9,"KRN","B",.5,.5)

"BLD",9,"KRN","B",.84,.84)

"BLD",9,"KRN","B",3.6,3.6)

"BLD",9,"KRN","B",3.8,3.8)

"BLD",9,"KRN","B",9.2,9.2)

"BLD",9,"KRN","B",9.8,9.8)

"BLD",9,"KRN","B",19,19)

"BLD",9,"KRN","B",19.1,19.1)

"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
29^2960726
"PKG",6,22,1,"PAH",1,1,0)
^^51^51^2960726
"PKG",6,22,1,"PAH",1,1,1,0)
 This Mailman patch will set the vaporization date for messages that are
"PKG",6,22,1,"PAH",1,1,2,0)
 distributed via the XMYB-BROADCAST-VA-WIDE Server Option, for example, 
"PKG",6,22,1,"PAH",1,1,3,0)
 Secretary Brown's Daily Message. The vaporization date is set only if
"PKG",6,22,1,"PAH",1,1,4,0)
 the message stays in the users IN BASKET. If a user saves the message to
"PKG",6,22,1,"PAH",1,1,5,0)
 another Basket, the vaporization date is not maintained. A user can enter
"PKG",6,22,1,"PAH",1,1,6,0)
 a new vaporization date by entering 'V' at the 'MESSAGE Action' prompt.
"PKG",6,22,1,"PAH",1,1,7,0)

"PKG",6,22,1,"PAH",1,1,8,0)
 This patch will not effect broadcast messages that originate locally, but 
"PKG",6,22,1,"PAH",1,1,9,0)
 only those originated from FORUM. The vaporization date is depended on how
"PKG",6,22,1,"PAH",1,1,10,0)
 the parameter is set in the Routine field for the XMYB-BROADCAST-VA-WIDE
"PKG",6,22,1,"PAH",1,1,11,0)
 Option.
"PKG",6,22,1,"PAH",1,1,12,0)
 
"PKG",6,22,1,"PAH",1,1,13,0)
 Case #1 - if Routine field looks like: ENT^XMGAPI3("*"), this means
"PKG",6,22,1,"PAH",1,1,14,0)
 that the message was sent to ALL mail users, then the Vaporization date
"PKG",6,22,1,"PAH",1,1,15,0)
 will be set to T+7.
"PKG",6,22,1,"PAH",1,1,16,0)
 
"PKG",6,22,1,"PAH",1,1,17,0)
 Case #2 - if the Routine entry looks like: ENT^XMAPI3(".6"), this means
"PKG",6,22,1,"PAH",1,1,18,0)
 that the message was sent to *just* SHARED MAIL's IN BASKET, then the
"PKG",6,22,1,"PAH",1,1,19,0)
 Vaporization date will be set to T+30.
"PKG",6,22,1,"PAH",1,1,20,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,21,0)

"PKG",6,22,1,"PAH",1,1,22,0)
 This patch can be installed with users on the system.
"PKG",6,22,1,"PAH",1,1,23,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,24,0)

"PKG",6,22,1,"PAH",1,1,25,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,26,0)
  1.  This routine is usually mapped on systems that allow mapping,
"PKG",6,22,1,"PAH",1,1,27,0)
      so you will need to disable mapping for the effected routine.
"PKG",6,22,1,"PAH",1,1,28,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",6,22,1,"PAH",1,1,29,0)
      option will load the KIDS package onto your system.
"PKG",6,22,1,"PAH",1,1,30,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",6,22,1,"PAH",1,1,31,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",6,22,1,"PAH",1,1,32,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",6,22,1,"PAH",1,1,33,0)
      options:
"PKG",6,22,1,"PAH",1,1,34,0)
         Print Transport Global
"PKG",6,22,1,"PAH",1,1,35,0)
         Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,36,0)
         Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,37,0)
         Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,38,0)
         Install Package(s)
"PKG",6,22,1,"PAH",1,1,39,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,40,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,41,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,42,0)
===========================================================================  
"PKG",6,22,1,"PAH",1,1,43,0)
  
"PKG",6,22,1,"PAH",1,1,44,0)
 ROUTINES:
"PKG",6,22,1,"PAH",1,1,45,0)
   The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,46,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,47,0)
 
"PKG",6,22,1,"PAH",1,1,48,0)
 Name          Checksum          Patch List
"PKG",6,22,1,"PAH",1,1,49,0)
 ----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,50,0)
 XMGAPI3        2791662           29
"PKG",6,22,1,"PAH",1,1,51,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XMGAPI3")
0^1^B9180387
"RTN","XMGAPI3",1,0)
XMGAPI3 ; WASH ISC/REW & LH - Deliver Broadcast Msg & Mark for Vaporization ;07/23/96  15:39
"RTN","XMGAPI3",2,0)
 ;;7.1;MailMan;**29**;Jun 02, 1994
"RTN","XMGAPI3",3,0)
 ;
"RTN","XMGAPI3",4,0)
 ;This routine exists at a site such that messages may be sent to
"RTN","XMGAPI3",5,0)
 ;an option (server) that this routine is the ROUTINE for.
"RTN","XMGAPI3",6,0)
 Q
"RTN","XMGAPI3",7,0)
ENT(XMDUZ) ;XMDUZ = * if to all employees
"RTN","XMGAPI3",8,0)
 ;  = a DUZ value if only to one person -- typically .6 to route to shared mail
"RTN","XMGAPI3",9,0)
 ;    XQMSG and XMFROM are set in the server invoker
"RTN","XMGAPI3",10,0)
 ;The ENT(X) entry point is an extrinsic function that
"RTN","XMGAPI3",11,0)
 ;returns a zero is it worked properly and a 1 if there
"RTN","XMGAPI3",12,0)
 ;was a problem.
"RTN","XMGAPI3",13,0)
 ;
"RTN","XMGAPI3",14,0)
 ;Do not allow use unless the message was sent
"RTN","XMGAPI3",15,0)
 ;from the Postmaster at FORUM.VA.GOV.
"RTN","XMGAPI3",16,0)
P I $P(XMFROM,"@")'["POSTMASTER"!($P(XMFROM,"@",2)'["FORUM.VA.GOV") G ERR1
"RTN","XMGAPI3",17,0)
 ;
"RTN","XMGAPI3",18,0)
 S XMZ=XQMSG
"RTN","XMGAPI3",19,0)
 ;
"RTN","XMGAPI3",20,0)
 ;Set Info Only Status
"RTN","XMGAPI3",21,0)
I Q:$$INFO(XMZ)
"RTN","XMGAPI3",22,0)
 ;
"RTN","XMGAPI3",23,0)
 ; D ^%ZTER ;4 testing / trap symbol table
"RTN","XMGAPI3",24,0)
 ;
"RTN","XMGAPI3",25,0)
 ;Broadcast to all Mail Boxes, 7 days vaporization
"RTN","XMGAPI3",26,0)
 ;
"RTN","XMGAPI3",27,0)
B I XMDUZ="*" S XMDT=$$DATE(7),XMDV=0 F  D  G Q:'XMDV
"RTN","XMGAPI3",28,0)
 . S XMDV=$O(^XMB(3.7,XMDV)) Q:'XMDV  D  ;Get next user Mail Box
"RTN","XMGAPI3",29,0)
 . . S Y=XMDV Q:'$D(^XMB(3.7,XMDV,2))
"RTN","XMGAPI3",30,0)
 . . D OK ;Deliver to user Mail Box
"RTN","XMGAPI3",31,0)
 . . S X=$$VAP(XMDV,XMZ,XMDT,1)
"RTN","XMGAPI3",32,0)
 . Q
"RTN","XMGAPI3",33,0)
 ;Shared Mail
"RTN","XMGAPI3",34,0)
S G ERR2:'XMDUZ,ERR2:'$D(^XMB(3.7,XMDUZ))
"RTN","XMGAPI3",35,0)
 S XMDT=$$DATE(30) ;30 days vaporization
"RTN","XMGAPI3",36,0)
 D  S XMDUZ=$$VAP(XMDUZ,XMZ,XMDT,1) G Q
"RTN","XMGAPI3",37,0)
 . S Y=+XMDUZ N X D OK
"RTN","XMGAPI3",38,0)
 . Q
"RTN","XMGAPI3",39,0)
 Q
"RTN","XMGAPI3",40,0)
 ;
"RTN","XMGAPI3",41,0)
VAP(A,B,C,D) ;Mark Message for Vaporization in Mail Box
"RTN","XMGAPI3",42,0)
 ;IN-BASKET-PURGE does actual vaporization on or after date
"RTN","XMGAPI3",43,0)
 ;
"RTN","XMGAPI3",44,0)
 ;A=Mail Box
"RTN","XMGAPI3",45,0)
 ;B=Message #
"RTN","XMGAPI3",46,0)
 ;C=Date to Vaporize on or after
"RTN","XMGAPI3",47,0)
 ;D=Mail Basket
"RTN","XMGAPI3",48,0)
 ;
"RTN","XMGAPI3",49,0)
 ;Set date into field in mail box / message / basket
"RTN","XMGAPI3",50,0)
D S $P(^XMB(3.7,A,2,D,1,B,0),U,5)=C
"RTN","XMGAPI3",51,0)
 ;
"RTN","XMGAPI3",52,0)
 ;Set up x-ref for IN-BASKET-PURGE to use
"RTN","XMGAPI3",53,0)
X S ^XMB(3.7,"AC",C,A,D,B)=""
"RTN","XMGAPI3",54,0)
 Q 0
"RTN","XMGAPI3",55,0)
ERR1 ;Send message back to sender if not POSTMASTER@FORUM
"RTN","XMGAPI3",56,0)
 N XMDUZ,A,XMTEXT,XMY,XMSUB,DIC,DIE
"RTN","XMGAPI3",57,0)
NP S XMY(XMFROM)="",XMSUB="SENDER OF MESSAGE TO SERVER UNACCEPTABLE"
"RTN","XMGAPI3",58,0)
 S XMTEXT="A("
"RTN","XMGAPI3",59,0)
 S A(1)="You may not send a message to the S.XMYB-BROADCAST-VA-WIDE"
"RTN","XMGAPI3",60,0)
 S A(2)="server.  Only the Postmaster at FORUM.VA.GOV has"
"RTN","XMGAPI3",61,0)
 S A(3)="this permission."
"RTN","XMGAPI3",62,0)
 D ^XMD
"RTN","XMGAPI3",63,0)
 Q
"RTN","XMGAPI3",64,0)
 ;
"RTN","XMGAPI3",65,0)
ERR2 ;Send a message back to sender if single recipient is invalid
"RTN","XMGAPI3",66,0)
 N XMDUZ,A,XMTEXT,XMY,XMSUB,DIC,DIE
"RTN","XMGAPI3",67,0)
UR S XMY(XMFROM)="",XMSUB="SERVER RECIPIENT UNKNOWN"
"RTN","XMGAPI3",68,0)
 S XMTEXT="A("
"RTN","XMGAPI3",69,0)
 S A(1)="Your message to the S.XMYB-BROADCAST-VA-WIDE server"
"RTN","XMGAPI3",70,0)
 S A(2)="was not accepted because the recipient specified ("_XMDUZ_")"
"RTN","XMGAPI3",71,0)
 S A(3)="in the server ENTRY EXECUTE did not have a Mail Box"
"RTN","XMGAPI3",72,0)
 S A(4)="(an entry in the Mail Box file [3.7])."
"RTN","XMGAPI3",73,0)
 D ^XMD
"RTN","XMGAPI3",74,0)
 Q  ;Invalid local recipient (no mail box)
"RTN","XMGAPI3",75,0)
 ;
"RTN","XMGAPI3",76,0)
OK N %,A,B,Z 
"RTN","XMGAPI3",77,0)
 S Z=XMZ,%=$G(^XMB(3.9,XMZ,1,0)) I %="" S %="^3.91LA"
"RTN","XMGAPI3",78,0)
 S A=$P(%,U,3)+1,$P(%,U,3,4)=A_"^"_A,^XMB(3.9,XMZ,1,0)=%,^(A,0)=Y
"RTN","XMGAPI3",79,0)
 S ^XMB(3.9,XMZ,1,"C",Y,A)="",XME0=Y,XMA0=XMZ
"RTN","XMGAPI3",80,0)
 D NOW^%DTC S %DT=%,XMR=^XMB(3.9,XMZ,0),XMADF=0 ; y=XMDUZ in XMADJF1B
"RTN","XMGAPI3",81,0)
 D OK^XMADJF1B
"RTN","XMGAPI3",82,0)
 Q
"RTN","XMGAPI3",83,0)
Q ;Successfully delivered the message
"RTN","XMGAPI3",84,0)
 ;
"RTN","XMGAPI3",85,0)
 ;Remove from Postmaster Server Basket
"RTN","XMGAPI3",86,0)
 S XMSER="S."_XQSOP D REMSBMSG^XMA1C
"RTN","XMGAPI3",87,0)
 Q
"RTN","XMGAPI3",88,0)
 ;
"RTN","XMGAPI3",89,0)
INFO(DA) ;Set Info Only & Closed statuses
"RTN","XMGAPI3",90,0)
 N DIE,DR S DIE=3.9,DR="1.95///y;1.97///y" D ^DIE
"RTN","XMGAPI3",91,0)
 Q 0
"RTN","XMGAPI3",92,0)
DATE(X2) ;Calculate date for vaporization (T+30)
"RTN","XMGAPI3",93,0)
 S X1=DT D C^%DTC
"RTN","XMGAPI3",94,0)
 Q X
"VER")
8.0^21.0
**END**
**END**
