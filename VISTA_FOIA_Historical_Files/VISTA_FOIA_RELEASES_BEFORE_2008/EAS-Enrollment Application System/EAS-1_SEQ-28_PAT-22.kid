Released EAS*1*22 SEQ #28
Extracted from mail message
**KIDS**:EAS*1.0*22^

**INSTALL NAME**
EAS*1.0*22
"BLD",4437,0)
EAS*1.0*22^ENROLLMENT APPLICATION SYSTEM^0^3030626^y
"BLD",4437,4,0)
^9.64PA^^
"BLD",4437,"INID")
^n
"BLD",4437,"INIT")
EAS122PT
"BLD",4437,"KRN",0)
^9.67PA^8989.52^19
"BLD",4437,"KRN",.4,0)
.4
"BLD",4437,"KRN",.401,0)
.401
"BLD",4437,"KRN",.402,0)
.402
"BLD",4437,"KRN",.403,0)
.403
"BLD",4437,"KRN",.5,0)
.5
"BLD",4437,"KRN",.84,0)
.84
"BLD",4437,"KRN",3.6,0)
3.6
"BLD",4437,"KRN",3.8,0)
3.8
"BLD",4437,"KRN",9.2,0)
9.2
"BLD",4437,"KRN",9.8,0)
9.8
"BLD",4437,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4437,"KRN",9.8,"NM",1,0)
EASMTL2^^0^B25817887
"BLD",4437,"KRN",9.8,"NM",2,0)
EASMTUTL^^0^B61411014
"BLD",4437,"KRN",9.8,"NM",3,0)
EASMTRP2^^0^B11536757
"BLD",4437,"KRN",9.8,"NM",4,0)
EAS122PT^^0^B25064427
"BLD",4437,"KRN",9.8,"NM",5,0)
EASMTL6^^0^B66803136
"BLD",4437,"KRN",9.8,"NM","B","EAS122PT",4)

"BLD",4437,"KRN",9.8,"NM","B","EASMTL2",1)

"BLD",4437,"KRN",9.8,"NM","B","EASMTL6",5)

"BLD",4437,"KRN",9.8,"NM","B","EASMTRP2",3)

"BLD",4437,"KRN",9.8,"NM","B","EASMTUTL",2)

"BLD",4437,"KRN",19,0)
19
"BLD",4437,"KRN",19.1,0)
19.1
"BLD",4437,"KRN",101,0)
101
"BLD",4437,"KRN",409.61,0)
409.61
"BLD",4437,"KRN",771,0)
771
"BLD",4437,"KRN",870,0)
870
"BLD",4437,"KRN",8989.51,0)
8989.51
"BLD",4437,"KRN",8989.52,0)
8989.52
"BLD",4437,"KRN",8994,0)
8994
"BLD",4437,"KRN","B",.4,.4)

"BLD",4437,"KRN","B",.401,.401)

"BLD",4437,"KRN","B",.402,.402)

"BLD",4437,"KRN","B",.403,.403)

"BLD",4437,"KRN","B",.5,.5)

"BLD",4437,"KRN","B",.84,.84)

"BLD",4437,"KRN","B",3.6,3.6)

"BLD",4437,"KRN","B",3.8,3.8)

"BLD",4437,"KRN","B",9.2,9.2)

"BLD",4437,"KRN","B",9.8,9.8)

"BLD",4437,"KRN","B",19,19)

"BLD",4437,"KRN","B",19.1,19.1)

"BLD",4437,"KRN","B",101,101)

"BLD",4437,"KRN","B",409.61,409.61)

"BLD",4437,"KRN","B",771,771)

"BLD",4437,"KRN","B",870,870)

"BLD",4437,"KRN","B",8989.51,8989.51)

"BLD",4437,"KRN","B",8989.52,8989.52)

"BLD",4437,"KRN","B",8994,8994)

"BLD",4437,"QUES",0)
^9.62^^
"BLD",4437,"REQB",0)
^9.611^3^3
"BLD",4437,"REQB",1,0)
EAS*1.0*15^1
"BLD",4437,"REQB",2,0)
EAS*1.0*20^1
"BLD",4437,"REQB",3,0)
EAS*1.0*29^1
"BLD",4437,"REQB","B","EAS*1.0*15",1)

"BLD",4437,"REQB","B","EAS*1.0*20",2)

"BLD",4437,"REQB","B","EAS*1.0*29",3)

"INIT")
EAS122PT
"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^2^1
"PKG",552,20,2,0)
2^^EASXDR
"PKG",552,20,2,1)
 
"PKG",552,20,"B",2,2)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
22^3030626^11984
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","EAS122PT")
0^4^B25064427
"RTN","EAS122PT",1,0)
EAS122PT ; ALB/SCK - POST INSTALL CLEANUP PATCH EAS*1*22 ; 12/13/2002
"RTN","EAS122PT",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**22**;MAR 15,2001
"RTN","EAS122PT",3,0)
 ;
"RTN","EAS122PT",4,0)
QUE ; Queued entry point for post install processing
"RTN","EAS122PT",5,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTSK,ZTIO
"RTN","EAS122PT",6,0)
 ;
"RTN","EAS122PT",7,0)
 S ZTRTN="EN^EAS122PT"
"RTN","EAS122PT",8,0)
 S ZTDESC="PATCH EAS*1*22 POST INSTALL"
"RTN","EAS122PT",9,0)
 S XMDUZ="EAS MT LETTERS"
"RTN","EAS122PT",10,0)
 S ZTSAVE("DUZ")=""
"RTN","EAS122PT",11,0)
 S ZTIO=""
"RTN","EAS122PT",12,0)
 ;
"RTN","EAS122PT",13,0)
 D ^%ZTLOAD
"RTN","EAS122PT",14,0)
 I $D(ZTSK)'>0 D BMES^XPDUTL("Post-Install was not tasked off")
"RTN","EAS122PT",15,0)
 E  D BMES^XPDUTL("Post-Install tasked: ["_$G(ZTSK)_"]")
"RTN","EAS122PT",16,0)
 D HOME^%ZIS
"RTN","EAS122PT",17,0)
 Q
"RTN","EAS122PT",18,0)
 ;
"RTN","EAS122PT",19,0)
EN ; Main entry point for post install processing
"RTN","EAS122PT",20,0)
 K ^TMP("EAS22",$J),^TMP("EAS22A",$J)
"RTN","EAS122PT",21,0)
 D POST
"RTN","EAS122PT",22,0)
 D MAIL1
"RTN","EAS122PT",23,0)
 D MAIL2
"RTN","EAS122PT",24,0)
 K ^TMP("EAS22",$J),^TMP("EAS22A",$J)
"RTN","EAS122PT",25,0)
 Q
"RTN","EAS122PT",26,0)
 ;
"RTN","EAS122PT",27,0)
POST ; Process files and generate cleanup list
"RTN","EAS122PT",28,0)
 N DGIEN,DIK,DA,CNT,DFN,VA,EASMTDT
"RTN","EAS122PT",29,0)
 ;
"RTN","EAS122PT",30,0)
 ; Process EAS MT LETTER STATUS File, (#713.2)
"RTN","EAS122PT",31,0)
 S DGIEN=0
"RTN","EAS122PT",32,0)
 F  S DGIEN=$O(^EAS(713.2,"C",-1,DGIEN)) Q:'DGIEN  D
"RTN","EAS122PT",33,0)
 . S ^TMP("EAS22",$J,DGIEN)=$P($G(^EAS(713.2,DGIEN,0)),U,1)
"RTN","EAS122PT",34,0)
 . I $D(^EAS(713.2,DGIEN)) D  ; if data entry exists, delete it
"RTN","EAS122PT",35,0)
 . . S DIK="^EAS(713.2,",DA=DGIEN
"RTN","EAS122PT",36,0)
 . . D ^DIK
"RTN","EAS122PT",37,0)
 . E  D  ; if no data entry, only xref, kill off the xref
"RTN","EAS122PT",38,0)
 . . K ^EAS(713.2,"C",-1,DGIEN)
"RTN","EAS122PT",39,0)
 ;
"RTN","EAS122PT",40,0)
 I $$S^%ZTLOAD D  Q  ; Check for stop request
"RTN","EAS122PT",41,0)
 . S ^TMP("EAS22",$J,0)="STOP"
"RTN","EAS122PT",42,0)
 ;
"RTN","EAS122PT",43,0)
POST2 ;Process EAS MT PATIENT STATUS File (#713.1)
"RTN","EAS122PT",44,0)
 S DGIEN=0,CNT=1
"RTN","EAS122PT",45,0)
 F  S DGIEN=$O(^EAS(713.1,DGIEN)) Q:'DGIEN  D  Q:$D(^TMP("EAS22",$J,0))
"RTN","EAS122PT",46,0)
 . S CNT=CNT+1 I (CNT#100)=0,$$S^ZTLOAD D  Q  ; Check for stop request
"RTN","EAS122PT",47,0)
 . . S ^TMP("EAS22",$J,0)="STOP"
"RTN","EAS122PT",48,0)
 . Q:$D(^EAS(713.1,"AP",1,DGIEN))
"RTN","EAS122PT",49,0)
 . I '$D(^EAS(713.2,"C",DGIEN)) D
"RTN","EAS122PT",50,0)
 . . S DFN=$P($G(^EAS(713.1,DGIEN,0)),U,1)
"RTN","EAS122PT",51,0)
 . . D PID^VADPT
"RTN","EAS122PT",52,0)
 . . S EASMTDT=$$LST^DGMTU(DFN)
"RTN","EAS122PT",53,0)
 . . I +EASMTDT>0 S EASMTDT=$$FMTE^XLFDT($P(EASMTDT,U,2))
"RTN","EAS122PT",54,0)
 . . I DFN>0 S ^TMP("EAS22A",$J,DGIEN)=$$GET1^DIQ(2,DFN,.01)_" ("_VA("BID")_")"_"   "_EASMTDT
"RTN","EAS122PT",55,0)
 Q
"RTN","EAS122PT",56,0)
 ;
"RTN","EAS122PT",57,0)
MAIL1 ; Generate mail message with number of removed entries
"RTN","EAS122PT",58,0)
 N XMY,XMSUB,XMTEXT,XMDUZ,MSG,DGIEN,DGDT,DGPRCDT,X
"RTN","EAS122PT",59,0)
 ;
"RTN","EAS122PT",60,0)
 S XMSUB="Post Install - EAS*1*22"
"RTN","EAS122PT",61,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EAS122PT",62,0)
 S XMY("DUZ")=""
"RTN","EAS122PT",63,0)
 S XMDUZ="PATCH EAS-1-22"
"RTN","EAS122PT",64,0)
 ;
"RTN","EAS122PT",65,0)
 S DGIEN=0
"RTN","EAS122PT",66,0)
 F  S DGIEN=$O(^TMP("EAS22",$J,DGIEN)) Q:'DGIEN  D
"RTN","EAS122PT",67,0)
 . Q:^TMP("EAS22",$J,DGIEN)'>0  ; Check for valid date value for DGRPCDT
"RTN","EAS122PT",68,0)
 . S DGPRCDT(^TMP("EAS22",$J,DGIEN))=$G(DGPRCDT(^TMP("EAS22",$J,DGIEN)))+1
"RTN","EAS122PT",69,0)
 ;
"RTN","EAS122PT",70,0)
 S MSG(.1)="Entries were removed from the EAS MT LETTER STATUS File (#713.2)"
"RTN","EAS122PT",71,0)
 S MSG(.2)="which did not have a valid pointer to the EAS MT PATIENT STATUS"
"RTN","EAS122PT",72,0)
 S MSG(.3)="File (#713.1).  The entries removed were for the processing dates"
"RTN","EAS122PT",73,0)
 S MSG(.4)="listed below.  This is provided as information only."
"RTN","EAS122PT",74,0)
 S MSG(.5)=""
"RTN","EAS122PT",75,0)
 S X=$$SETSTR^VALM1("Date Processed","",5,18)
"RTN","EAS122PT",76,0)
 S X=$$SETSTR^VALM1("Records Removed",X,25,18)
"RTN","EAS122PT",77,0)
 S MSG(.6)=X
"RTN","EAS122PT",78,0)
 S DGDT=0
"RTN","EAS122PT",79,0)
 F  S DGDT=$O(DGPRCDT(DGDT)) Q:'DGDT  D
"RTN","EAS122PT",80,0)
 . S X=$$SETSTR^VALM1($$FMTE^XLFDT(DGDT,"2D"),"",5,18)
"RTN","EAS122PT",81,0)
 . S X=$$SETSTR^VALM1(+$G(DGPRCDT(DGDT)),X,25,18)
"RTN","EAS122PT",82,0)
 . S MSG(DGDT)=X
"RTN","EAS122PT",83,0)
 S XMTEXT="MSG("
"RTN","EAS122PT",84,0)
 D ^XMD
"RTN","EAS122PT",85,0)
 Q
"RTN","EAS122PT",86,0)
 ;
"RTN","EAS122PT",87,0)
MAIL2 ; Generate file cross-check message on patient names
"RTN","EAS122PT",88,0)
 N XMY,XMSUB,XMTEXT,XMDUZ,MSG,DGIEN,DGDT
"RTN","EAS122PT",89,0)
 ;
"RTN","EAS122PT",90,0)
 S XMSUB="Post Install - EAS*1*22"
"RTN","EAS122PT",91,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EAS122PT",92,0)
 S XMY("DUZ")=""
"RTN","EAS122PT",93,0)
 S XMDUZ="PATCH EAS-1-22"
"RTN","EAS122PT",94,0)
 ;
"RTN","EAS122PT",95,0)
 S ^TMP("EAS22A",$J,.1)="The following patients in the EAS MT PATIENT STATUS File (#713.1)"
"RTN","EAS122PT",96,0)
 S ^TMP("EAS22A",$J,.2)="do not have a corresponding entry in the EAS MT LETTER STATUS File (#713.2)."
"RTN","EAS122PT",97,0)
 S ^TMP("EAS22A",$J,.3)="You can try re-generating the Means Test Letter dates for these"
"RTN","EAS122PT",98,0)
 S ^TMP("EAS22A",$J,.4)="patients by running the REGEN procedure from the post-install"
"RTN","EAS122PT",99,0)
 S ^TMP("EAS22A",$J,.5)="routine by entering 'D REGEN^EAS122PT' at the programmer prompt."
"RTN","EAS122PT",100,0)
 S ^TMP("EAS22A",$J,.6)="See the Patch Instructions for more details."
"RTN","EAS122PT",101,0)
 S ^TMP("EAS22A",$J,.7)=""
"RTN","EAS122PT",102,0)
 S XMTEXT="^TMP(""EAS22A"",$J,"
"RTN","EAS122PT",103,0)
 D ^XMD
"RTN","EAS122PT",104,0)
 Q
"RTN","EAS122PT",105,0)
 ;
"RTN","EAS122PT",106,0)
REGEN ;
"RTN","EAS122PT",107,0)
 N DGIEN,MTLST,MTDT,DFN,CNT,EASDT,EADT,DIR,Y
"RTN","EAS122PT",108,0)
 ;
"RTN","EAS122PT",109,0)
 S DIR(0)="YAO",DIR("B")="NO"
"RTN","EAS122PT",110,0)
 S DIR("A",1)="Re-generate Means Test Letter Dates for patients"
"RTN","EAS122PT",111,0)
 S DIR("A")="identified in patch EAS*1*22 cleanup? "
"RTN","EAS122PT",112,0)
 D ^DIR K DIR
"RTN","EAS122PT",113,0)
 Q:'Y
"RTN","EAS122PT",114,0)
 ;
"RTN","EAS122PT",115,0)
 K ^TMP("EAS22A",$J)
"RTN","EAS122PT",116,0)
 D POST2
"RTN","EAS122PT",117,0)
 ;
"RTN","EAS122PT",118,0)
 S EADT=$$DT^XLFDT
"RTN","EAS122PT",119,0)
 S DGIEN=0
"RTN","EAS122PT",120,0)
 F  S DGIEN=$O(^TMP("EAS22A",$J,DGIEN)) Q:'DGIEN  D
"RTN","EAS122PT",121,0)
 . S DFN=$P($G(^EAS(713.1,DGIEN,0)),U,1)
"RTN","EAS122PT",122,0)
 . S MTLST=$$LST^DGMTU(DFN)
"RTN","EAS122PT",123,0)
 . S MTDT=$P(MTLST,U,2)
"RTN","EAS122PT",124,0)
 . Q:'$G(MTDT)
"RTN","EAS122PT",125,0)
 . S EASDT("ANV")=$$FMADD^XLFDT(MTDT)
"RTN","EAS122PT",126,0)
 . S EASDT("60")=$$FMADD^XLFDT(EASDT("ANV"),305)
"RTN","EAS122PT",127,0)
 . S EASDT("30")=$$FMADD^XLFDT(EASDT("ANV"),335)
"RTN","EAS122PT",128,0)
 . S EASDT("0")=$$FMADD^XLFDT(EASDT("ANV"),365)
"RTN","EAS122PT",129,0)
 . I $$NEWLTR^EASMTL2(DGIEN,.EASDT)
"RTN","EAS122PT",130,0)
 K ^TMP("EAS22A",$J)
"RTN","EAS122PT",131,0)
 Q
"RTN","EASMTL2")
0^1^B25817887
"RTN","EASMTL2",1,0)
EASMTL2 ;MIN/TCM ALB/SCK/AEG - AUTOMATED MEANS TEST LETTER - SEARCH ; 7/3/01
"RTN","EASMTL2",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,12,14,20,22**;MAR 15,2001
"RTN","EASMTL2",3,0)
 ;
"RTN","EASMTL2",4,0)
EN60 ; Entry point for inital 60-day letter search for candidates 
"RTN","EASMTL2",5,0)
 N EASIEN,DFN,VADM,CNT,ANNVDT,EASLAST
"RTN","EASMTL2",6,0)
 ;
"RTN","EASMTL2",7,0)
 K ^TMP("EASERR",$J)
"RTN","EASMTL2",8,0)
 S CNT=0 ; Initialize counter
"RTN","EASMTL2",9,0)
 S ANNVDT=EASDT("ANV")
"RTN","EASMTL2",10,0)
 ; Check for means test data to process, quit if none found
"RTN","EASMTL2",11,0)
 Q:'$D(^DGMT(408.31,"B",ANNVDT))
"RTN","EASMTL2",12,0)
 ;
"RTN","EASMTL2",13,0)
 ; Retieve data for each Means Test entry being processed
"RTN","EASMTL2",14,0)
 S EASIEN=0
"RTN","EASMTL2",15,0)
 F  S EASIEN=$O(^DGMT(408.31,"B",ANNVDT,EASIEN)) Q:EASIEN'>0  D
"RTN","EASMTL2",16,0)
 . ; Quit further processing if means test is not MEANS TEST type
"RTN","EASMTL2",17,0)
 . Q:'$$GET1^DIQ(408.31,EASIEN,.019,"I")=1
"RTN","EASMTL2",18,0)
 . S DFN=$$GET1^DIQ(408.31,EASIEN,.02,"I") ; get patient's DFN
"RTN","EASMTL2",19,0)
 . ; Check conditions; if all passed, add new entry to worklist file, #713.2
"RTN","EASMTL2",20,0)
 . Q:'DFN                         ; Safety check for DFN
"RTN","EASMTL2",21,0)
 . Q:$$TEST(DFN)                  ; Quit if test patient
"RTN","EASMTL2",22,0)
 . S EASLAST=$$LST^DGMTU(DFN)     ; Get last MT on file
"RTN","EASMTL2",23,0)
 . Q:'(+EASLAST=EASIEN)  ; Not the latest MT record for patient
"RTN","EASMTL2",24,0)
 . Q:"L,N"[$P(EASLAST,U,4)        ; Quit, patient no longer requires means test (No Longer Applicable or No Longer Required)
"RTN","EASMTL2",25,0)
 . Q:$$DECEASED^EASMTUTL("",DFN)  ; Quit if patient deceased
"RTN","EASMTL2",26,0)
 . ;  If passed through all condition checks, update files
"RTN","EASMTL2",27,0)
 . Q:$$CHKSTAT(EASIEN,DFN)         ; Check current MT status
"RTN","EASMTL2",28,0)
 . Q:$$FUTURE(DFN)  ; Quit if a future means test is on file
"RTN","EASMTL2",29,0)
 . D NEWSTAT(DFN,.EASPT)
"RTN","EASMTL2",30,0)
 . Q:EASPT'>0  ; Safety check
"RTN","EASMTL2",31,0)
 . Q:'$$NEWLTR(EASPT,.EASDT)  ; Quit if letter status was not updated
"RTN","EASMTL2",32,0)
 . ; Finally, Update the counters
"RTN","EASMTL2",33,0)
 . S CNT=CNT+1
"RTN","EASMTL2",34,0)
 S EAS6CNT(EASPRCDT)=CNT,EAS6CNT=EAS6CNT+CNT
"RTN","EASMTL2",35,0)
 D ERRMSG
"RTN","EASMTL2",36,0)
 K ^TMP("EASERR",$J)
"RTN","EASMTL2",37,0)
 Q
"RTN","EASMTL2",38,0)
 ;
"RTN","EASMTL2",39,0)
NEWLTR(EASPT,EASDT) ; Add new entry to the work list file #713.2.
"RTN","EASMTL2",40,0)
 ; Input
"RTN","EASMTL2",41,0)
 ;   EASPT  - Ptr to 713.1 file
"RTN","EASMTL2",42,0)
 ;   EASDT  - Worklist date array
"RTN","EASMTL2",43,0)
 ;
"RTN","EASMTL2",44,0)
 ; Output
"RTN","EASMTL2",45,0)
 ;   RSLT   - 1 if new letter status entry added
"RTN","EASMTL2",46,0)
 ;            0 if new letter status was not added
"RTN","EASMTL2",47,0)
 ;
"RTN","EASMTL2",48,0)
 N ANNVDT,FDA,RSLT
"RTN","EASMTL2",49,0)
 ;
"RTN","EASMTL2",50,0)
 S ANNVDT=EASDT("ANV")
"RTN","EASMTL2",51,0)
 ;
"RTN","EASMTL2",52,0)
 ; Check for an existing entry for patient and anniversary date
"RTN","EASMTL2",53,0)
 I $D(^EAS(713.2,"AN",EASPT,ANNVDT)) Q 0 ; Quit if duplicate entry
"RTN","EASMTL2",54,0)
 ;
"RTN","EASMTL2",55,0)
 ; Add new entry to the letter status file, #713.2
"RTN","EASMTL2",56,0)
 S FDA(1,713.2,"+1,",.01)=EADT
"RTN","EASMTL2",57,0)
 S FDA(1,713.2,"+1,",2)=EASPT
"RTN","EASMTL2",58,0)
 S FDA(1,713.2,"+1,",3)=ANNVDT
"RTN","EASMTL2",59,0)
 S FDA(1,713.2,"+1,",4)=0
"RTN","EASMTL2",60,0)
 S FDA(1,713.2,"+1,",8)=EASDT("60")
"RTN","EASMTL2",61,0)
 S FDA(1,713.2,"+1,",11)=EASDT("30")
"RTN","EASMTL2",62,0)
 S FDA(1,713.2,"+1,",17)=EASDT("0")
"RTN","EASMTL2",63,0)
 S FDA(1,713.2,"+1,",9)=1
"RTN","EASMTL2",64,0)
 ; Modification for DCD sites which are required to print only the 0-day letters
"RTN","EASMTL2",65,0)
 ;; EAS*1*12
"RTN","EASMTL2",66,0)
 I $$VERSION^XPDUTL("IVMC"),$G(DT)'>3021014 D
"RTN","EASMTL2",67,0)
 . K FDA(1,713.2,"+1,",9)
"RTN","EASMTL2",68,0)
 . S FDA(1,713.2,"+1,",18)=1
"RTN","EASMTL2",69,0)
 ; ***
"RTN","EASMTL2",70,0)
 D UPDATE^DIE("","FDA(1)","","ERRMSG")
"RTN","EASMTL2",71,0)
 Q 1
"RTN","EASMTL2",72,0)
 ;
"RTN","EASMTL2",73,0)
UPDLTR(EAS1,TYPE) ; Update Flagged to print field for letter type
"RTN","EASMTL2",74,0)
 ; Input
"RTN","EASMTL2",75,0)
 ;   EAS1  - Ptr to file 713.2
"RTN","EASMTL2",76,0)
 ;   TYPE  - Letter type (1:60d, 2:30d, 4:0d)
"RTN","EASMTL2",77,0)
 ;
"RTN","EASMTL2",78,0)
 N DGFDA,ERRMSG
"RTN","EASMTL2",79,0)
 ;
"RTN","EASMTL2",80,0)
 S DGFDA(1,713.2,EAS1_",",$S(TYPE=2:12,1:18))=1
"RTN","EASMTL2",81,0)
 D UPDATE^DIE("","DGFDA(1)","","ERRMSG")
"RTN","EASMTL2",82,0)
 Q
"RTN","EASMTL2",83,0)
 ;
"RTN","EASMTL2",84,0)
NEWSTAT(DFN,EASPT) ; Update the Patient status file, #713.1
"RTN","EASMTL2",85,0)
 ; Input
"RTN","EASMTL2",86,0)
 ;   DFN   - Patient's DFN
"RTN","EASMTL2",87,0)
 ;   EASPT - Return Var, New IEN to 713.1 file
"RTN","EASMTL2",88,0)
 ;
"RTN","EASMTL2",89,0)
 N EASIEN,DGFDA,FDAIEN,ERROUT
"RTN","EASMTL2",90,0)
 ;
"RTN","EASMTL2",91,0)
 ; Create new entry in the patient status file
"RTN","EASMTL2",92,0)
 ;
"RTN","EASMTL2",93,0)
 I '$D(^EAS(713.1,"B",DFN)) D  Q
"RTN","EASMTL2",94,0)
 . S DGFDA(1,713.1,"+1,",.01)=DFN
"RTN","EASMTL2",95,0)
 . S DGFDA(1,713.1,"+1,",2)=0
"RTN","EASMTL2",96,0)
 . D UPDATE^DIE("","DGFDA(1)","FDAIEN","ERROUT(1)")
"RTN","EASMTL2",97,0)
 . I $D(ERROUT) D
"RTN","EASMTL2",98,0)
 . . S ^TMP("EASERR",$J,DFN)=ERROUT(1,"DIERR",1)_" - "_ERROUT(1,"DIERR",1,"TEXT",1)
"RTN","EASMTL2",99,0)
 . . S:+$G(FDAIEN(1))'>0 ^TMP("EASERR",$J,DFN)="Unable to generate entry in EAS MT PATIENT STATUS File, #713.1"
"RTN","EASMTL2",100,0)
 . S EASPT=+$G(FDAIEN(1))
"RTN","EASMTL2",101,0)
 ;
"RTN","EASMTL2",102,0)
 I $D(^EAS(713.1,"B",DFN)) D
"RTN","EASMTL2",103,0)
 . Q:'DFN
"RTN","EASMTL2",104,0)
 . S EASPT=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTL2",105,0)
 Q
"RTN","EASMTL2",106,0)
 ;
"RTN","EASMTL2",107,0)
PRNTDT(EARY,ETYPE) ; Retrieve Print date and flagged to print status for letter type
"RTN","EASMTL2",108,0)
 ; Input
"RTN","EASMTL2",109,0)
 ;    EARY  - Data array from Patient Status file, #713.1, MT Anniversary date field, #11
"RTN","EASMTL2",110,0)
 ;    ETYPE - Search type, 30 or 0 day
"RTN","EASMTL2",111,0)
 ;
"RTN","EASMTL2",112,0)
 ; Output
"RTN","EASMTL2",113,0)
 ;    RSLT = Print date ^ Flagged to print status
"RTN","EASMTL2",114,0)
 ;           will be 0^0 if nothing found to return
"RTN","EASMTL2",115,0)
 ;
"RTN","EASMTL2",116,0)
 N RSLT
"RTN","EASMTL2",117,0)
 ;
"RTN","EASMTL2",118,0)
 S RSLT=$S(ETYPE=2:EARY(11,"I"),ETYPE=4:EARY(17,"I"),1:0)
"RTN","EASMTL2",119,0)
 S RSLT=RSLT_"^"_+$S(ETYPE=2:EARY(12,"I"),ETYPE=4:EARY(18,"I"),1:0)
"RTN","EASMTL2",120,0)
 Q RSLT
"RTN","EASMTL2",121,0)
 ;
"RTN","EASMTL2",122,0)
CHKSTAT(EASIEN,DFN) ; Check for means test status, still required or not
"RTN","EASMTL2",123,0)
 ; Input
"RTN","EASMTL2",124,0)
 ;    EASIEN  - Internal Entry Number to the ANNUAL MEANS TEST File, #408.31
"RTN","EASMTL2",125,0)
 ;
"RTN","EASMTL2",126,0)
 ; Output
"RTN","EASMTL2",127,0)
 ;    1 - if means test is no longer required or applicable
"RTN","EASMTL2",128,0)
 ;    0 - if means test is still required
"RTN","EASMTL2",129,0)
 ;
"RTN","EASMTL2",130,0)
 N RSLT,EASTAT
"RTN","EASMTL2",131,0)
 ;
"RTN","EASMTL2",132,0)
 ; If status = "NO LONGER REQUIRED" or "NO LONGER APPLICABLE" then set result to 1
"RTN","EASMTL2",133,0)
 ; The .03 field is a pointer to the MEANS TEST STATUS File, #408.32, checks
"RTN","EASMTL2",134,0)
 ; IEN=3 and IEN=10, NO LONGER REQUIRED and NO LONGER APPLICABLE entries respectively 
"RTN","EASMTL2",135,0)
 ; If the 408.32 file is changed, this code will need to be reviewed and updated if necessary.
"RTN","EASMTL2",136,0)
 ;
"RTN","EASMTL2",137,0)
 S RSLT=0,DFN=$G(DFN)
"RTN","EASMTL2",138,0)
 ;
"RTN","EASMTL2",139,0)
 S EASTAT=$$GET1^DIQ(408.31,EASIEN,.03,"I")
"RTN","EASMTL2",140,0)
 I (EASTAT=3)!(EASTAT=10) S RSLT=1
"RTN","EASMTL2",141,0)
 ;
"RTN","EASMTL2",142,0)
 ;; Check current MT Status from API (Looking for Cat-C, Agree to Pay Dedct, MT later than 10-5-99
"RTN","EASMTL2",143,0)
 I 'RSLT D
"RTN","EASMTL2",144,0)
 . S:'$$MTCHK^EASMTCHK(DFN,"L") RSLT=1
"RTN","EASMTL2",145,0)
 ;
"RTN","EASMTL2",146,0)
 Q $G(RSLT)
"RTN","EASMTL2",147,0)
 ;
"RTN","EASMTL2",148,0)
FUTURE(DFN) ; Future Means Test available?
"RTN","EASMTL2",149,0)
 N RSLT
"RTN","EASMTL2",150,0)
 ;
"RTN","EASMTL2",151,0)
 S RSLT=$$FUT^DGMTU(DFN)
"RTN","EASMTL2",152,0)
 Q $G(RSLT)
"RTN","EASMTL2",153,0)
 ;
"RTN","EASMTL2",154,0)
TEST(DFN) ; Test Patient?
"RTN","EASMTL2",155,0)
 N VAROOT,ZSSN,EASDEM
"RTN","EASMTL2",156,0)
 ;
"RTN","EASMTL2",157,0)
 S VAROOT="EASDEM"
"RTN","EASMTL2",158,0)
 D DEM^VADPT
"RTN","EASMTL2",159,0)
 S ZSSN=$P(EASDEM(2),U,1)
"RTN","EASMTL2",160,0)
 I $E(ZSSN,1,5)["00000" Q 1
"RTN","EASMTL2",161,0)
 ;
"RTN","EASMTL2",162,0)
 Q 0
"RTN","EASMTL2",163,0)
 ;
"RTN","EASMTL2",164,0)
ERRMSG ; Send mail message if any errors were generated during processing
"RTN","EASMTL2",165,0)
 Q:'$D(^TMP("EASERR",$J))
"RTN","EASMTL2",166,0)
 ;
"RTN","EASMTL2",167,0)
 N EASDFN,EASERR,MSG,XMSUB,XMY,XMTEXT,XMDUZ,DFN,VA
"RTN","EASMTL2",168,0)
 ;
"RTN","EASMTL2",169,0)
 S MSG(.1)="The following issues were reported by the Means Test Letter Search Process:"
"RTN","EASMTL2",170,0)
 S MSG(.9)=""
"RTN","EASMTL2",171,0)
 ;
"RTN","EASMTL2",172,0)
 S EASDFN=0
"RTN","EASMTL2",173,0)
 F  S EASDFN=$O(^TMP("EASERR",$J,EASDFN)) Q:'EASDFN  D
"RTN","EASMTL2",174,0)
 . S DFN=EASDFN D PID^VADPT
"RTN","EASMTL2",175,0)
 . S MSG(EASDFN)=$$GET1^DIQ(2,EASDFN,.01)_" ("_VA("BID")_") "_$G(^TMP("EASERR",$J,EASDFN))
"RTN","EASMTL2",176,0)
 . K VA
"RTN","EASMTL2",177,0)
 ;
"RTN","EASMTL2",178,0)
 S XMSUB="MT LETTERS SEARCH ISSUES - "_$$FMTE^XLFDT($$NOW^XLFDT,"D")
"RTN","EASMTL2",179,0)
 S XMTEXT="MSG("
"RTN","EASMTL2",180,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTL2",181,0)
 S XMDUZ="AUTOMATED MT LETTERS"
"RTN","EASMTL2",182,0)
 D ^XMD
"RTN","EASMTL2",183,0)
 Q
"RTN","EASMTL6")
0^5^B66803136
"RTN","EASMTL6",1,0)
EASMTL6 ; ALB/SCK,BRM,LBD - AUTOMATED MEANS TEST LETTER-INTERACTIVE PRINT ; 5/22/03 9:52am
"RTN","EASMTL6",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15,29,25,22**;MAR 15,2001
"RTN","EASMTL6",3,0)
 ;
"RTN","EASMTL6",4,0)
EN ; Main entry point
"RTN","EASMTL6",5,0)
 ; Input, set in option call, if not passed in, or called interactively, user is asked to specify.
"RTN","EASMTL6",6,0)
 ;    EATYP - Used for selective printing of letters and forms
"RTN","EASMTL6",7,0)
 ;         1 : 60-Day
"RTN","EASMTL6",8,0)
 ;         2 : 30-Day
"RTN","EASMTL6",9,0)
 ;         4 :  0-Day
"RTN","EASMTL6",10,0)
 ;
"RTN","EASMTL6",11,0)
 N DIR,DIRUT,POP,EASLOC,Y
"RTN","EASMTL6",12,0)
 ;
"RTN","EASMTL6",13,0)
 ;; Select type of letter to print
"RTN","EASMTL6",14,0)
 I '$G(EATYP) D  Q:$D(DIRUT)
"RTN","EASMTL6",15,0)
 . S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTL6",16,0)
 . S DIR("?")="Select the type of letter to print"
"RTN","EASMTL6",17,0)
 . D ^DIR K DIR
"RTN","EASMTL6",18,0)
 . S EATYP=+Y
"RTN","EASMTL6",19,0)
 ;
"RTN","EASMTL6",20,0)
 ;; Select facility filter if appropriate
"RTN","EASMTL6",21,0)
 S EASLOC=-1
"RTN","EASMTL6",22,0)
 I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
"RTN","EASMTL6",23,0)
 . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
"RTN","EASMTL6",24,0)
 . S DIR("B")="NO"
"RTN","EASMTL6",25,0)
 . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters."
"RTN","EASMTL6",26,0)
 . D ^DIR K DIR
"RTN","EASMTL6",27,0)
 . Q:$D(DIRUT)!('Y)
"RTN","EASMTL6",28,0)
 . S EASLOC=$$FACNUM
"RTN","EASMTL6",29,0)
 ;
"RTN","EASMTL6",30,0)
 K IOP,IO("Q")
"RTN","EASMTL6",31,0)
 ;
"RTN","EASMTL6",32,0)
 S %ZIS="QP",%ZIS("B")=$$GET1^DIQ(713,1,5)
"RTN","EASMTL6",33,0)
 D ^%ZIS K %ZIS
"RTN","EASMTL6",34,0)
 Q:POP
"RTN","EASMTL6",35,0)
 I $D(IO("Q")) D QUE Q
"RTN","EASMTL6",36,0)
 D LTR
"RTN","EASMTL6",37,0)
 D ^%ZISC
"RTN","EASMTL6",38,0)
 K EATYP
"RTN","EASMTL6",39,0)
 Q
"RTN","EASMTL6",40,0)
 ;
"RTN","EASMTL6",41,0)
QUE ; Queue the report
"RTN","EASMTL6",42,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTSK,ZTDTH,ZTQUEUED
"RTN","EASMTL6",43,0)
 ;
"RTN","EASMTL6",44,0)
 S ZTRTN="LTR^EASMTL6"
"RTN","EASMTL6",45,0)
 S ZTDESC="EAS MT LETTERS PRINT JOB"
"RTN","EASMTL6",46,0)
 S ZTSAVE("EATYP")="",ZTSAVE("EASLOC")=""
"RTN","EASMTL6",47,0)
 S ZTDTH="NOW"
"RTN","EASMTL6",48,0)
 ;
"RTN","EASMTL6",49,0)
 D ^%ZTLOAD
"RTN","EASMTL6",50,0)
 I $D(ZTSK)[0 W !!?5,"Letters canceled!"
"RTN","EASMTL6",51,0)
 E  W !!?5,"Letters queued! [ ",ZTSK," ]"
"RTN","EASMTL6",52,0)
 D HOME^%ZIS
"RTN","EASMTL6",53,0)
 Q
"RTN","EASMTL6",54,0)
 ;
"RTN","EASMTL6",55,0)
LTR ; Main entry point
"RTN","EASMTL6",56,0)
 N EASTMP,EASKP
"RTN","EASMTL6",57,0)
 ;
"RTN","EASMTL6",58,0)
 S EASTMP="^TMP(""EASMT"",$J)"
"RTN","EASMTL6",59,0)
 K @EASTMP
"RTN","EASMTL6",60,0)
 ;
"RTN","EASMTL6",61,0)
 I '$D(ZTQUEUED) W !,"...Gathering letters to print...Please wait"
"RTN","EASMTL6",62,0)
 D BLD(EATYP,EASLOC,EASTMP,.EASKP)
"RTN","EASMTL6",63,0)
 D RESULT(.EASKP,EATYP)
"RTN","EASMTL6",64,0)
 I '$D(ZTQUEUED) W !,"...Printing letters..."
"RTN","EASMTL6",65,0)
 D PRINT(EASTMP,EATYP)
"RTN","EASMTL6",66,0)
 K @EASTMP,EATYP
"RTN","EASMTL6",67,0)
 Q
"RTN","EASMTL6",68,0)
 ;
"RTN","EASMTL6",69,0)
RESULT(EASKP,EATYP) ; Send results of letter printing to mail group
"RTN","EASMTL6",70,0)
 N MSG,XMSUB,XMY,XMTEXT,XMDUZ,TOT,X1
"RTN","EASMTL6",71,0)
 ;
"RTN","EASMTL6",72,0)
 S MSG(1)="Letters to print: "_$J($FN(EASKP("CNT"),","),8)
"RTN","EASMTL6",73,0)
 S MSG(2)="Letters where the print date has not reached: "_$J($FN(EASKP("T"),","),8)
"RTN","EASMTL6",74,0)
 S MSG(2.5)=""
"RTN","EASMTL6",75,0)
 S MSG(3)="The following letters were found but not printed for the following reasons:"
"RTN","EASMTL6",76,0)
 S MSG(4)="Incomplete/Bad Addr :                 "_$J($FN(EASKP("I"),","),8)
"RTN","EASMTL6",77,0)
 S MSG(5)="Deceased :                            "_$J($FN(EASKP("D"),","),8)
"RTN","EASMTL6",78,0)
 S MSG(6)="MT Changed:                           "_$J($FN(EASKP("C"),","),8)
"RTN","EASMTL6",79,0)
 S MSG(7)="Prohibit flag set:                    "_$J($FN(EASKP("P"),","),8)
"RTN","EASMTL6",80,0)
 S MSG(8)="Not a User Enrollee:                  "_$J($FN(EASKP("U"),","),8)
"RTN","EASMTL6",81,0)
 S MSG(8.5)="Not a User Enrollee of this facility: "_$J($FN(EASKP("O"),","),8)
"RTN","EASMTL6",82,0)
 S MSG(9)=""
"RTN","EASMTL6",83,0)
 S TOT=0 F X1="I","D","C","P","O","T","U","CNT" S TOT=TOT+EASKP(X1)
"RTN","EASMTL6",84,0)
 S MSG(10)="Total Letters Processed: "_$J($FN(TOT,","),8)_" (MT not returned)"
"RTN","EASMTL6",85,0)
 ;
"RTN","EASMTL6",86,0)
 S XMSUB=$S(EATYP=1:"60-Day",EATYP=2:"30-Day",1:"0-Day")_" Print Letter Results"
"RTN","EASMTL6",87,0)
 S XMTEXT="MSG("
"RTN","EASMTL6",88,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTL6",89,0)
 S XMDUZ="AUTOMATED MT LETTERS"
"RTN","EASMTL6",90,0)
 D ^XMD
"RTN","EASMTL6",91,0)
 Q
"RTN","EASMTL6",92,0)
 ;
"RTN","EASMTL6",93,0)
BLD(EATYP,EASLOC,EASTMP,EASKP) ; Build TMP array of letters to print
"RTN","EASMTL6",94,0)
 N DFN,EASIEN,COUNT,EAX2,EASPTR,EASABRT,EASUE
"RTN","EASMTL6",95,0)
 ;
"RTN","EASMTL6",96,0)
 F EAX2="P","D","C","F","T","I","O","U","CNT" S EASKP(EAX2)=0
"RTN","EASMTL6",97,0)
 S COUNT=0
"RTN","EASMTL6",98,0)
 ;
"RTN","EASMTL6",99,0)
 S EASIEN=0 ; Begin loop through un-returned means tests
"RTN","EASMTL6",100,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",101,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I") ; Pointer to File 713.1
"RTN","EASMTL6",102,0)
 . ; begin checks
"RTN","EASMTL6",103,0)
 . Q:EASPTR<0  ; SAFETY CHECK
"RTN","EASMTL6",104,0)
 . Q:$$LTRTYP^EASMTL6B(EASIEN)'=EATYP  ;  Check for appropriate letter type
"RTN","EASMTL6",105,0)
 . S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I") Q:'DFN
"RTN","EASMTL6",106,0)
 . ;; Filter by site, quit if filter not met
"RTN","EASMTL6",107,0)
 . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
"RTN","EASMTL6",108,0)
 . I $D(^EAS(713.1,"AP",1,EASPTR)) D  Q  ; Check Prohibit letter
"RTN","EASMTL6",109,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",110,0)
 . . S EASKP("P")=EASKP("P")+1
"RTN","EASMTL6",111,0)
 . I $$DECEASED^EASMTUTL(EASIEN) D  Q  ; Check Deceased
"RTN","EASMTL6",112,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",113,0)
 . . S EASKP("D")=EASKP("D")+1
"RTN","EASMTL6",114,0)
 . I $$CHECKMT^EASMTUTL(EASPTR,EASIEN) D  Q  ; Check MT changed?
"RTN","EASMTL6",115,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",116,0)
 . . S EASKP("C")=EASKP("C")+1 Q
"RTN","EASMTL6",117,0)
 . I $$FUTMT^EASMTUTL(EASIEN) D  Q  ; Check for a Future MT
"RTN","EASMTL6",118,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",119,0)
 . . S EASKP("F")=EASKP("F")+1
"RTN","EASMTL6",120,0)
 . I '$$THRSHLD(EATYP,EASIEN) D  Q  ; Quit if letter threshold not reached
"RTN","EASMTL6",121,0)
 . . S EASKP("T")=EASKP("T")+1
"RTN","EASMTL6",122,0)
 . ; Get User Enrollee status (0=not UE; 1=UE; 2=UE, not this site)
"RTN","EASMTL6",123,0)
 . S EASUE=$$UESTAT^EASUER(DFN)
"RTN","EASMTL6",124,0)
 . I 'EASUE D  Q     ; Quit if not User Enrollee
"RTN","EASMTL6",125,0)
 . . D NOPRT(EATYP,EASIEN)
"RTN","EASMTL6",126,0)
 . . S EASKP("U")=EASKP("U")+1
"RTN","EASMTL6",127,0)
 . I EASUE'=1 D  Q   ; Quit if User Enrollee site is not this facility
"RTN","EASMTL6",128,0)
 . . D NOPRT(EATYP,EASIEN)
"RTN","EASMTL6",129,0)
 . . S EASKP("O")=EASKP("O")+1
"RTN","EASMTL6",130,0)
 . I $$CHKADR^EASMTL6A(EASPTR) D  Q  ; Check for valid address
"RTN","EASMTL6",131,0)
 . . S EASKP("I")=EASKP("I")+1
"RTN","EASMTL6",132,0)
 . S @EASTMP@(EASIEN)=EATYP ; Build entry
"RTN","EASMTL6",133,0)
 . S EASKP("CNT")=EASKP("CNT")+1
"RTN","EASMTL6",134,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1
"RTN","EASMTL6",135,0)
 Q
"RTN","EASMTL6",136,0)
 ;
"RTN","EASMTL6",137,0)
OWNED(PTR1,EAIEN) ;  Check - Does this facility "own" this means test
"RTN","EASMTL6",138,0)
 ;  Returns '1' if means test 'owned' by facility
"RTN","EASMTL6",139,0)
 ;          '0' if not owned
"RTN","EASMTL6",140,0)
 ;
"RTN","EASMTL6",141,0)
 N MTNODE,MTLST,MTOWN,RSLT
"RTN","EASMTL6",142,0)
 ;
"RTN","EASMTL6",143,0)
 S RSLT=0
"RTN","EASMTL6",144,0)
 S MTLST=$$LST^DGMTU(PTR1)
"RTN","EASMTL6",145,0)
 I $P(MTLST,U,1)>0 D
"RTN","EASMTL6",146,0)
 . S MTNODE=$G(^DGMT(408.31,$P(MTLST,U,1),0))
"RTN","EASMTL6",147,0)
 . S MTOWN=$$GET1^DIQ(408.34,$P(MTNODE,U,23),.01)
"RTN","EASMTL6",148,0)
 . I MTOWN="VAMC" S RSLT=1 Q
"RTN","EASMTL6",149,0)
 . I MTOWN="DCD",$$VERSION^XPDUTL("IVMC") S RSLT=1
"RTN","EASMTL6",150,0)
 ;
"RTN","EASMTL6",151,0)
 ;; If another facility 'owns' this MT, update MT Status information
"RTN","EASMTL6",152,0)
 I 'RSLT D
"RTN","EASMTL6",153,0)
 . Q:'EAIEN
"RTN","EASMTL6",154,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTL6",155,0)
 . S DR="4///YES;5///TODAY;7///MT 'OWNED' BY ANOTHER FACILITY;9///NO;12///NO;18///NO"
"RTN","EASMTL6",156,0)
 . D ^DIE K DIE
"RTN","EASMTL6",157,0)
 ;
"RTN","EASMTL6",158,0)
 Q RSLT
"RTN","EASMTL6",159,0)
 ;
"RTN","EASMTL6",160,0)
PRINT(EASTMP,EATYP) ; Print letters
"RTN","EASMTL6",161,0)
 N EASIEN,EASABRT,Y
"RTN","EASMTL6",162,0)
 ;
"RTN","EASMTL6",163,0)
 U IO
"RTN","EASMTL6",164,0)
 S EASIEN=0
"RTN","EASMTL6",165,0)
 F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",166,0)
 . D LETTER^EASMTL6A(EASIEN,EATYP) ; Print letter
"RTN","EASMTL6",167,0)
 . D UPDSTAT(EASIEN,EATYP) ; Update Letter status file, #713.2
"RTN","EASMTL6",168,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1 Q
"RTN","EASMTL6",169,0)
 . I '$D(IO("Q")),$E(IOST,1,2)="C-" D
"RTN","EASMTL6",170,0)
 . . S DIR(0)="E"
"RTN","EASMTL6",171,0)
 . . D ^DIR K DIR
"RTN","EASMTL6",172,0)
 . . S:'Y EASABRT=1
"RTN","EASMTL6",173,0)
 Q
"RTN","EASMTL6",174,0)
 ;
"RTN","EASMTL6",175,0)
THRSHLD(EATYP,EASIEN) ; Check threshold for letter types
"RTN","EASMTL6",176,0)
 ; Input
"RTN","EASMTL6",177,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",178,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",179,0)
 ;
"RTN","EASMTL6",180,0)
 ; Output
"RTN","EASMTL6",181,0)
 ;    RSLT = 1: Letter is inside threshold to print
"RTN","EASMTL6",182,0)
 ;           0: Letter is outside threshold (Don't print)
"RTN","EASMTL6",183,0)
 ;
"RTN","EASMTL6",184,0)
 N DIFF,THRESH,RSLT,ANVDT,MTDT
"RTN","EASMTL6",185,0)
 ;
"RTN","EASMTL6",186,0)
 S RSLT=1
"RTN","EASMTL6",187,0)
 Q:'$G(EATYP)
"RTN","EASMTL6",188,0)
 S THRESH=$S(EATYP=1:60,EATYP=2:30,1:0)
"RTN","EASMTL6",189,0)
 S MTDT=$$GET1^DIQ(713.2,EASIEN,3,"I")
"RTN","EASMTL6",190,0)
 S ANVDT=$$FMADD^XLFDT(MTDT,365)
"RTN","EASMTL6",191,0)
 S DIFF=$$FMDIFF^XLFDT(ANVDT,$$DT^XLFDT)
"RTN","EASMTL6",192,0)
 I DIFF>THRESH S RSLT=0
"RTN","EASMTL6",193,0)
 Q RSLT
"RTN","EASMTL6",194,0)
 ;
"RTN","EASMTL6",195,0)
NOPRT(EATYP,EASIEN) ; Letter not printed, update Letter Status file #713.2
"RTN","EASMTL6",196,0)
 ; Input
"RTN","EASMTL6",197,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",198,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",199,0)
 ;
"RTN","EASMTL6",200,0)
 N DIE,DR,DA,LTR
"RTN","EASMTL6",201,0)
 Q:'$G(EATYP)  Q:'$G(EASIEN)
"RTN","EASMTL6",202,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTL6",203,0)
 S LTR=$S(EATYP=1:9,EATYP=2:12,EATYP=4:18,1:0)
"RTN","EASMTL6",204,0)
 Q:'LTR
"RTN","EASMTL6",205,0)
 ; Set current letter print statuses = "N"
"RTN","EASMTL6",206,0)
 S DR=LTR_"///0;"_(LTR+1)_"///0"
"RTN","EASMTL6",207,0)
 ; If current letter is not 0-day letter, set next letter print = "Y"
"RTN","EASMTL6",208,0)
 S:LTR'=18 DR=DR_";"_$S(LTR=9:12,1:18)_"///1"
"RTN","EASMTL6",209,0)
 D ^DIE
"RTN","EASMTL6",210,0)
 Q
"RTN","EASMTL6",211,0)
 ;
"RTN","EASMTL6",212,0)
UPDSTAT(EASN,EAX) ; Update Letter status file, #713.2
"RTN","EASMTL6",213,0)
 N DIE,DR,DA,EAPD,EAFLG,NXTFLG
"RTN","EASMTL6",214,0)
 ;
"RTN","EASMTL6",215,0)
 S DIE="^EAS(713.2,",DA=EASN
"RTN","EASMTL6",216,0)
 S DR=$S(EAX=1:10,EAX=2:13,EAX=4:19,1:0)
"RTN","EASMTL6",217,0)
 Q:'DR
"RTN","EASMTL6",218,0)
 S EAPD=DR_".5",EAFLG=DR-1
"RTN","EASMTL6",219,0)
 S DR=DR_"///1;"_EAPD_"///^S X=$$DT^XLFDT;"_EAFLG_"///0"
"RTN","EASMTL6",220,0)
 S NXTFLG=$S(EAFLG=9:12,EAFLG=12:18,1:0)
"RTN","EASMTL6",221,0)
 S:NXTFLG>0 DR=DR_";"_NXTFLG_"///1"
"RTN","EASMTL6",222,0)
 D ^DIE K DIE
"RTN","EASMTL6",223,0)
 D CLRFLG^EASMTUTL(EAX,EASN)
"RTN","EASMTL6",224,0)
 Q
"RTN","EASMTL6",225,0)
 ;
"RTN","EASMTL6",226,0)
FACNUM() ;  Get facility number
"RTN","EASMTL6",227,0)
 N RSLT,DIR,Y
"RTN","EASMTL6",228,0)
 ;
"RTN","EASMTL6",229,0)
 S DIR(0)="P^4:EMZ"
"RTN","EASMTL6",230,0)
 S DIR("S")="I '$P($G(^DIC(4,Y,99)),U,4)"
"RTN","EASMTL6",231,0)
 D ^DIR K DIR
"RTN","EASMTL6",232,0)
 I $D(DIRUT) S RSLT=0
"RTN","EASMTL6",233,0)
 E  S RSLT=+Y_"^"_$P($G(^DIC(4,+Y,99)),U,1)
"RTN","EASMTL6",234,0)
 ;
"RTN","EASMTL6",235,0)
 Q RSLT
"RTN","EASMTL6",236,0)
 ;
"RTN","EASMTL6",237,0)
GETFAC(EADFN,EASARY) ;  set facility return address information
"RTN","EASMTL6",238,0)
 N EASFAC,EAX,EASF,EAS4
"RTN","EASMTL6",239,0)
 ;
"RTN","EASMTL6",240,0)
 I $$GET1^DIQ(713,1,9,"I") D
"RTN","EASMTL6",241,0)
 . S EASFAC=$$GET1^DIQ(2,EADFN,27.02,"I")
"RTN","EASMTL6",242,0)
 . Q:'EASFAC
"RTN","EASMTL6",243,0)
 . ;; Check for inactive flag
"RTN","EASMTL6",244,0)
 . Q:$$GET1^DIQ(4,EASFAC,101,"I")
"RTN","EASMTL6",245,0)
 . D GETS^DIQ(4,EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",246,0)
 . S EASF=EASFAC_","
"RTN","EASMTL6",247,0)
 . ;; Check for valid address information
"RTN","EASMTL6",248,0)
 . I EAS4(4,EASF,1.01,"E")]"",EAS4(4,EASF,1.03,"E")]"",EAS4(4,EASF,.02,"E")]"" S EASARY("TYP")="P"
"RTN","EASMTL6",249,0)
 ;
"RTN","EASMTL6",250,0)
 I $G(EASARY("TYP"))'="P" D
"RTN","EASMTL6",251,0)
 . S EASFAC=$$SITE^VASITE
"RTN","EASMTL6",252,0)
 . D GETS^DIQ(4,+EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",253,0)
 . S EASARY("TYP")="F"
"RTN","EASMTL6",254,0)
 ;
"RTN","EASMTL6",255,0)
 S EASARY("FACNUM")=+EASFAC
"RTN","EASMTL6",256,0)
 S EASARY("FAC")=$$GET1^DIQ(4,+EASFAC,.01,"I")
"RTN","EASMTL6",257,0)
 F EAX=1.01,1.02,1.03,1.04,100 D
"RTN","EASMTL6",258,0)
 .  S EASARY(EAX)=EAS4(4,+EASFAC_",",EAX,"E")
"RTN","EASMTL6",259,0)
 S EASARY(.02)=EAS4(4,+EASFAC_",",.02,"E")_"^"_$$GET1^DIQ(5,EAS4(4,+EASFAC_",",.02,"I"),1)
"RTN","EASMTL6",260,0)
 Q
"RTN","EASMTRP2")
0^3^B11536757
"RTN","EASMTRP2",1,0)
EASMTRP2 ; ALB/SCK - MEANS TEST REPORTS 2 ; 2/19/02
"RTN","EASMTRP2",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15,22**;MAR 15,2001
"RTN","EASMTRP2",3,0)
 ;
"RTN","EASMTRP2",4,0)
QUE ; Que pending letter count (letters flagged to print)
"RTN","EASMTRP2",5,0)
 N ZTSAVE,DIR,EASUM,Y
"RTN","EASMTRP2",6,0)
 ;
"RTN","EASMTRP2",7,0)
 S DIR(0)="YAO",DIR("A")="Print Summary Only? ",DIR("B")="YES"
"RTN","EASMTRP2",8,0)
 S DIR("?")="'YES' will print a summary total only, 'NO' will print the summary and a detail listing by scheduled print date"
"RTN","EASMTRP2",9,0)
 D ^DIR K DIR
"RTN","EASMTRP2",10,0)
 Q:$D(DIRUT)
"RTN","EASMTRP2",11,0)
 S EASUM=+Y
"RTN","EASMTRP2",12,0)
 S ZTSAVE("EASUM")=""
"RTN","EASMTRP2",13,0)
 D EN^XUTMDEVQ("PEND^EASMTRP2","EAS LETTERS DETAILED PENDING REPORT",.ZTSAVE)
"RTN","EASMTRP2",14,0)
 Q
"RTN","EASMTRP2",15,0)
PEND ; Print report
"RTN","EASMTRP2",16,0)
 N CNT,EASIEN,PCNT,RCNT,EASX,TOT,PAGE,EAS0,EAS4,EAS6,EASPDT,EAX,TOTALS,DUOUT
"RTN","EASMTRP2",17,0)
 ;
"RTN","EASMTRP2",18,0)
 K ^TMP("EASPND",$J)
"RTN","EASMTRP2",19,0)
 F EAX=0,30,60 S TOTALS(EAX)=0
"RTN","EASMTRP2",20,0)
 S EASIEN=0
"RTN","EASMTRP2",21,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D
"RTN","EASMTRP2",22,0)
 . I $P($G(^EAS(713.2,EASIEN,"Z")),U,2) D  Q
"RTN","EASMTRP2",23,0)
 . . S EAS0=$P($G(^EAS(713.2,EASIEN,"Z")),U,1)
"RTN","EASMTRP2",24,0)
 . . S ^TMP("EASPND",$J,EAS0,0)=$G(^TMP("EASPND",$J,EAS0,0))+1
"RTN","EASMTRP2",25,0)
 . . S TOTALS(0)=TOTALS(0)+1
"RTN","EASMTRP2",26,0)
 . ;
"RTN","EASMTRP2",27,0)
 . I $P($G(^EAS(713.2,EASIEN,4)),U,2) D  Q
"RTN","EASMTRP2",28,0)
 . . S EAS4=$P($G(^EAS(713.2,EASIEN,4)),U,1)
"RTN","EASMTRP2",29,0)
 . . S ^TMP("EASPND",$J,EAS4,4)=$G(^TMP("EASPND",$J,EAS4,4))+1
"RTN","EASMTRP2",30,0)
 . . S TOTALS(30)=TOTALS(30)+1
"RTN","EASMTRP2",31,0)
 . ;
"RTN","EASMTRP2",32,0)
 . I $P($G(^EAS(713.2,EASIEN,6)),U,2) D
"RTN","EASMTRP2",33,0)
 . . S EAS6=$P($G(^EAS(713.2,EASIEN,6)),U,1)
"RTN","EASMTRP2",34,0)
 . . S ^TMP("EASPND",$J,EAS6,6)=$G(^TMP("EASPND",$J,EAS6,6))+1
"RTN","EASMTRP2",35,0)
 . . S TOTALS(60)=TOTALS(60)+1
"RTN","EASMTRP2",36,0)
 ;
"RTN","EASMTRP2",37,0)
 D HDR1
"RTN","EASMTRP2",38,0)
 I 'EASUM,$E(IOST,1,2)="C-" D  Q:$D(DUOUT)
"RTN","EASMTRP2",39,0)
 . S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTRP2",40,0)
 . D ^DIR K DIR
"RTN","EASMTRP2",41,0)
 . Q:$D(DUOUT)
"RTN","EASMTRP2",42,0)
 ;
"RTN","EASMTRP2",43,0)
 D:'EASUM DETAIL
"RTN","EASMTRP2",44,0)
 Q
"RTN","EASMTRP2",45,0)
 ;
"RTN","EASMTRP2",46,0)
DETAIL ; Print details section
"RTN","EASMTRP2",47,0)
 N EASPDT,DIRUT
"RTN","EASMTRP2",48,0)
 ;
"RTN","EASMTRP2",49,0)
 D HDR
"RTN","EASMTRP2",50,0)
 S EASPDT=0
"RTN","EASMTRP2",51,0)
 F  S EASPDT=$O(^TMP("EASPND",$J,EASPDT)) Q:'EASPDT  D  Q:$D(DIRUT)
"RTN","EASMTRP2",52,0)
 . I ($Y+4)>IOSL D  Q:$D(DIRUT)
"RTN","EASMTRP2",53,0)
 . . I $E(IOST,1,2)="C-" D  Q:$D(DIRUT)
"RTN","EASMTRP2",54,0)
 . . . S DIR(0)="E"
"RTN","EASMTRP2",55,0)
 . . . D ^DIR K DIR
"RTN","EASMTRP2",56,0)
 . . D HDR
"RTN","EASMTRP2",57,0)
 . W !?4,$$FMTE^XLFDT(EASPDT),?20
"RTN","EASMTRP2",58,0)
 . S TOT=0
"RTN","EASMTRP2",59,0)
 . F EAX=6,4,0 D
"RTN","EASMTRP2",60,0)
 . . S CNT=$G(^TMP("EASPND",$J,EASPDT,EAX))
"RTN","EASMTRP2",61,0)
 . . W $J(+CNT,6),"    "
"RTN","EASMTRP2",62,0)
 . . S TOT=$G(TOT)+(+CNT)
"RTN","EASMTRP2",63,0)
 . W $J(TOT,8)
"RTN","EASMTRP2",64,0)
 ;
"RTN","EASMTRP2",65,0)
 K ^TMP("EASPND",$J)
"RTN","EASMTRP2",66,0)
 Q
"RTN","EASMTRP2",67,0)
 ;
"RTN","EASMTRP2",68,0)
HDR1 ;
"RTN","EASMTRP2",69,0)
 N TAB,LINE,DASH
"RTN","EASMTRP2",70,0)
 ;
"RTN","EASMTRP2",71,0)
 W @IOF
"RTN","EASMTRP2",72,0)
 S LINE(1)="Count of Letters Pending to Print (Flag to Print marked 'YES')"
"RTN","EASMTRP2",73,0)
 S LINE(2)="Printed: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRP2",74,0)
 S LINE(60)="60-Day letters flagged to print:    "_$FN(TOTALS(60),",")
"RTN","EASMTRP2",75,0)
 S LINE(30)="30-Day letters flagged to print:    "_$FN(TOTALS(30),",")
"RTN","EASMTRP2",76,0)
 S LINE(0)=" 0-Day letters flagged to print:    "_$FN(TOTALS(0),",")
"RTN","EASMTRP2",77,0)
 ;
"RTN","EASMTRP2",78,0)
 S TAB=(IOM-$L(LINE(1)))/2
"RTN","EASMTRP2",79,0)
 W !?TAB,LINE(1)
"RTN","EASMTRP2",80,0)
 W !?TAB,LINE(2)
"RTN","EASMTRP2",81,0)
 S $P(DASH,"=",IOM)=""
"RTN","EASMTRP2",82,0)
 W !,DASH
"RTN","EASMTRP2",83,0)
 ;
"RTN","EASMTRP2",84,0)
 F EAX=60,30,0 D
"RTN","EASMTRP2",85,0)
 . S TAB=(IOM-$L(LINE(EAX)))/2
"RTN","EASMTRP2",86,0)
 . W !?TAB,LINE(EAX)
"RTN","EASMTRP2",87,0)
 Q
"RTN","EASMTRP2",88,0)
 ;
"RTN","EASMTRP2",89,0)
HDR ;
"RTN","EASMTRP2",90,0)
 N TAB,LINE
"RTN","EASMTRP2",91,0)
 ;
"RTN","EASMTRP2",92,0)
 W @IOF
"RTN","EASMTRP2",93,0)
 W !,"Detailed List of Letters Flagged to Print"
"RTN","EASMTRP2",94,0)
 W !,"Printed: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRP2",95,0)
 S PAGE=$G(PAGE)+1
"RTN","EASMTRP2",96,0)
 S TAB=IOM-8
"RTN","EASMTRP2",97,0)
 W ?TAB,"PAGE: ",PAGE
"RTN","EASMTRP2",98,0)
 W !!?4,"Sched. Date",?20,"60-Day","    ","30-Day","    "," 0-day","    ","   TOTAL"
"RTN","EASMTRP2",99,0)
 S $P(LINE,"=",IOM)="" W !,LINE
"RTN","EASMTRP2",100,0)
 Q
"RTN","EASMTUTL")
0^2^B61411014
"RTN","EASMTUTL",1,0)
EASMTUTL ; ALB/SCK/BRM - AUTOMATED MEANS TEST LETTERS UTILITIES ; 7/2/01
"RTN","EASMTUTL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15,29,22**;MAR 15,2001
"RTN","EASMTUTL",3,0)
 ;
"RTN","EASMTUTL",4,0)
 ;
"RTN","EASMTUTL",5,0)
PAUSE ;  Screen pause, user must press key to continue
"RTN","EASMTUTL",6,0)
 S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTUTL",7,0)
 D ^DIR K DIR
"RTN","EASMTUTL",8,0)
 Q
"RTN","EASMTUTL",9,0)
 ;
"RTN","EASMTUTL",10,0)
CLRFLG(EAX,DA) ; Clears flags in File #713.2, For development
"RTN","EASMTUTL",11,0)
 N DIE,DR
"RTN","EASMTUTL",12,0)
 ;
"RTN","EASMTUTL",13,0)
 Q:EAX=1
"RTN","EASMTUTL",14,0)
 S:EAX=2 DR="9///0"
"RTN","EASMTUTL",15,0)
 S:EAX=3 DR="9///0;12///0"
"RTN","EASMTUTL",16,0)
 S:EAX=4 DR="9///0;12///0"
"RTN","EASMTUTL",17,0)
 S:EAX=0 DR="9///0;12///0;18///0"
"RTN","EASMTUTL",18,0)
 S DIE="^EAS(713.2,"
"RTN","EASMTUTL",19,0)
 D ^DIE K DIE
"RTN","EASMTUTL",20,0)
 Q
"RTN","EASMTUTL",21,0)
 ;
"RTN","EASMTUTL",22,0)
LOCK(ACTION) ; Flag IN USE field in EAS Parameters file, #713
"RTN","EASMTUTL",23,0)
 ; Input
"RTN","EASMTUTL",24,0)
 ;   ACTION - Locking action
"RTN","EASMTUTL",25,0)
 ;            1 = Flag IN USE for Automated Generator is running
"RTN","EASMTUTL",26,0)
 ;            0 = Flag IN USE for Automated Generator is not running
"RTN","EASMTUTL",27,0)
 ; Output
"RTN","EASMTUTL",28,0)
 ;        1 if action was successful
"RTN","EASMTUTL",29,0)
 ;        0 if action was not successful
"RTN","EASMTUTL",30,0)
 N RSLT
"RTN","EASMTUTL",31,0)
 ;
"RTN","EASMTUTL",32,0)
 I ACTION,$D(^EAS(713,"ALOCK",1)) Q $G(RSLT)
"RTN","EASMTUTL",33,0)
 ;
"RTN","EASMTUTL",34,0)
 S DIE="^EAS(713,",DA=1,DR="30////^S X=ACTION"
"RTN","EASMTUTL",35,0)
 D ^DIE K DIE
"RTN","EASMTUTL",36,0)
 S RSLT=1
"RTN","EASMTUTL",37,0)
 Q +$G(RSLT)
"RTN","EASMTUTL",38,0)
 ;
"RTN","EASMTUTL",39,0)
ALERT(ERRMSG) ; Post an alert message to the EAS Letters Mail group
"RTN","EASMTUTL",40,0)
 N XMY,XMTEXT,XMDUZ,XMSUB,MSG
"RTN","EASMTUTL",41,0)
 ;
"RTN","EASMTUTL",42,0)
 S MSG(1)="Notification:"
"RTN","EASMTUTL",43,0)
 S MSG(2)=ERRMSG
"RTN","EASMTUTL",44,0)
 ;
"RTN","EASMTUTL",45,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",46,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",47,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",48,0)
 S XMSUB="EAS Means Test Letter's Notice"
"RTN","EASMTUTL",49,0)
 D ^XMD
"RTN","EASMTUTL",50,0)
 Q
"RTN","EASMTUTL",51,0)
 ;
"RTN","EASMTUTL",52,0)
ADRERR(EASADD,DFN) ; Error notification for missing or invalid patient address
"RTN","EASMTUTL",53,0)
 N MSG,XMY,XMTEXT,XMDUZ,XMSUB,VAROOT,EASDEM,VA,EASPRF
"RTN","EASMTUTL",54,0)
 ;
"RTN","EASMTUTL",55,0)
 S VAROOT="EASDEM"
"RTN","EASMTUTL",56,0)
 D DEM^VADPT
"RTN","EASMTUTL",57,0)
 D PID^VADPT6
"RTN","EASMTUTL",58,0)
 S EASPRF=$$GET1^DIQ(2,DFN,27.02)
"RTN","EASMTUTL",59,0)
 I EASPRF']"" S EASPRF="No Preferred Facility"
"RTN","EASMTUTL",60,0)
 ;
"RTN","EASMTUTL",61,0)
 S MSG(1)="The following patient does not have a complete permanent mailing"
"RTN","EASMTUTL",62,0)
 S MSG(2)="address.  A means test reminder letter could not be mailed."
"RTN","EASMTUTL",63,0)
 S MSG(3)=" "
"RTN","EASMTUTL",64,0)
 S MSG(4)="       Patient : "_EASDEM(1)
"RTN","EASMTUTL",65,0)
 S MSG(5)="        Last 4 : "_VA("BID")
"RTN","EASMTUTL",66,0)
 S MSG(6)="Address Line 1 : "_EASADD(1)
"RTN","EASMTUTL",67,0)
 S MSG(7)="          City : "_EASADD(4)
"RTN","EASMTUTL",68,0)
 S MSG(8)="         State : "_$P(EASADD(5),U,2)
"RTN","EASMTUTL",69,0)
 S MSG(9)="       Zipcode : "_$P(EASADD(11),U,2)
"RTN","EASMTUTL",70,0)
 S MSG(9.5)="      Bad Addr : "_$P(EASADD("BAI"),U,2)
"RTN","EASMTUTL",71,0)
 S MSG(10)=""
"RTN","EASMTUTL",72,0)
 S MSG(11)="           DFN : "_$G(DFN)
"RTN","EASMTUTL",73,0)
 S MSG(13)=""
"RTN","EASMTUTL",74,0)
 S MSG(14)="This patient's letter entry will stay in 'FLAGGED-TO-PRINT' status until"
"RTN","EASMTUTL",75,0)
 S MSG(15)="the address is corrected."
"RTN","EASMTUTL",76,0)
 ;
"RTN","EASMTUTL",77,0)
 I +EASADD(9)>0!(+EASADD(10)>0) D
"RTN","EASMTUTL",78,0)
 . S MSG(5.5)="** Temporary Address in effect **"
"RTN","EASMTUTL",79,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",80,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",81,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",82,0)
 S XMSUB="Incomplete/Bad Addr: "_EASPRF
"RTN","EASMTUTL",83,0)
 D ^XMD
"RTN","EASMTUTL",84,0)
 Q
"RTN","EASMTUTL",85,0)
 ;
"RTN","EASMTUTL",86,0)
CLRLCK ;  Clears IN USE field of the EAS MT PARAMETERS if an error occurs and locks the field
"RTN","EASMTUTL",87,0)
 N DIE,DR,DA
"RTN","EASMTUTL",88,0)
 ;
"RTN","EASMTUTL",89,0)
 S DA=1,DIE="^EAS(713,",DR="30///0"
"RTN","EASMTUTL",90,0)
 D ^DIE
"RTN","EASMTUTL",91,0)
 Q
"RTN","EASMTUTL",92,0)
 ;
"RTN","EASMTUTL",93,0)
PROHBIT ; Set or delete the Prohibit fields in the Patient Status file, #713.1
"RTN","EASMTUTL",94,0)
 N DIR,DIRUT,EASF,Y,X,EASIEN,DFN,DGFDA,FDAIEN,ERRMSG
"RTN","EASMTUTL",95,0)
 ;
"RTN","EASMTUTL",96,0)
 S DIR(0)="S^S:Set Prohibit Flag;R:Remove Prohibit Flag"
"RTN","EASMTUTL",97,0)
 S DIR("A")="Set or remove the MT Prohibit flag"
"RTN","EASMTUTL",98,0)
 S DIR("?")="Select 'S' to set flag, 'R' to remove the flag"
"RTN","EASMTUTL",99,0)
 D ^DIR K DIR
"RTN","EASMTUTL",100,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",101,0)
 S EASF=Y
"RTN","EASMTUTL",102,0)
 ;
"RTN","EASMTUTL",103,0)
 I EASF="R"!(EASF="r") D  Q:$D(DIRUT) 
"RTN","EASMTUTL",104,0)
 . S DIR(0)="PAO^713.1:EMZ"
"RTN","EASMTUTL",105,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",106,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",107,0)
 . S EASIEN=+Y
"RTN","EASMTUTL",108,0)
 ;
"RTN","EASMTUTL",109,0)
 I EASF="S"!(EASF="s") D  Q:$D(DIRUT)
"RTN","EASMTUTL",110,0)
 . S DIR(0)="PAO^2:EMZ"
"RTN","EASMTUTL",111,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",112,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",113,0)
 . Q:$D(DIRUT)
"RTN","EASMTUTL",114,0)
 . S DFN=+Y
"RTN","EASMTUTL",115,0)
 . I '$D(^EAS(713.1,"B",DFN)) D  Q:$D(DIRUT)
"RTN","EASMTUTL",116,0)
 . . S DIR(0)="Y",DIR("B")="YES"
"RTN","EASMTUTL",117,0)
 . . S DIR("A")="Add patient to the Patient Status File"
"RTN","EASMTUTL",118,0)
 . . D ^DIR K DIR
"RTN","EASMTUTL",119,0)
 . . Q:$D(DIRUT)
"RTN","EASMTUTL",120,0)
 . . I 'Y S DIRUT=1 Q
"RTN","EASMTUTL",121,0)
 . . S DGFDA(1,713.1,"+1,",.01)=DFN
"RTN","EASMTUTL",122,0)
 . . D UPDATE^DIE("","DGFDA(1)","FDAIEN","ERRMSG")
"RTN","EASMTUTL",123,0)
 . . S EASIEN=FDAIEN(1)
"RTN","EASMTUTL",124,0)
 . I $D(^EAS(713.1,"B",DFN)) S EASIEN=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTUTL",125,0)
 ;
"RTN","EASMTUTL",126,0)
 Q:'$G(EASIEN)
"RTN","EASMTUTL",127,0)
 ;
"RTN","EASMTUTL",128,0)
 N DGFDA,DGIEN,DGEFF,DIR,DIRUT,DGERR,DIE
"RTN","EASMTUTL",129,0)
 ;
"RTN","EASMTUTL",130,0)
 S DGIEN=EASIEN_","
"RTN","EASMTUTL",131,0)
 I EASF="S" D
"RTN","EASMTUTL",132,0)
 . S DIR(0)="DAO^"_$$DT^XLFDT_"::EX"
"RTN","EASMTUTL",133,0)
 . S DIR("A")="Effective Date: "
"RTN","EASMTUTL",134,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",135,0)
 . Q:$G(DIRUT)
"RTN","EASMTUTL",136,0)
 . S DGFDA(1,713.1,DGIEN,3)=Y
"RTN","EASMTUTL",137,0)
 . S DGFDA(1,713.1,DGIEN,2)=1
"RTN","EASMTUTL",138,0)
 . S DGFDA(1,713.1,DGIEN,5)=$$NOW^XLFDT
"RTN","EASMTUTL",139,0)
 . S DGFDA(1,713.1,DGIEN,4)=DUZ
"RTN","EASMTUTL",140,0)
 . D:$D(DGFDA) FILE^DIE("","DGFDA(1)","DGERR")
"RTN","EASMTUTL",141,0)
 . I $D(DGERR) D  Q
"RTN","EASMTUTL",142,0)
 . . D DSPLYER(.DGERR)
"RTN","EASMTUTL",143,0)
 . S DIE="^EAS(713.1,",DA=EASIEN,DR="10"
"RTN","EASMTUTL",144,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",145,0)
 ;
"RTN","EASMTUTL",146,0)
 I EASF="R" D
"RTN","EASMTUTL",147,0)
 . S DGFDA(1,713.1,DGIEN,2)=0
"RTN","EASMTUTL",148,0)
 . S DGFDA(1,713.1,DGIEN,3)="@"
"RTN","EASMTUTL",149,0)
 . S DGFDA(1,713.1,DGIEN,5)="@"
"RTN","EASMTUTL",150,0)
 . S DGFDA(1,713.1,DGIEN,4)="@"
"RTN","EASMTUTL",151,0)
 . S DGFDA(1,713.1,DGIEN,10)="@"
"RTN","EASMTUTL",152,0)
 . D:$D(DGFDA) FILE^DIE("","DGFDA(1)","DGERR")
"RTN","EASMTUTL",153,0)
 . I $D(DGERR) D
"RTN","EASMTUTL",154,0)
 . . D DSPLYER(.DGERR)
"RTN","EASMTUTL",155,0)
 . E  W !!?3,"Prohibit Flag Removed from Patient.",!
"RTN","EASMTUTL",156,0)
 ;
"RTN","EASMTUTL",157,0)
 Q
"RTN","EASMTUTL",158,0)
 ;
"RTN","EASMTUTL",159,0)
DSPLYER(ERRARY) ;
"RTN","EASMTUTL",160,0)
 N DGER
"RTN","EASMTUTL",161,0)
 ;
"RTN","EASMTUTL",162,0)
 W !!?3,"The following error(s) occurred:"
"RTN","EASMTUTL",163,0)
 S DGER=0
"RTN","EASMTUTL",164,0)
 F  S DGER=$O(ERRARY("DIERR",DGER)) Q:'DGER  D
"RTN","EASMTUTL",165,0)
 . W !?3,ERRARY("DIERR",DGER)," - ",ERRARY("DIERR",DGER,"TEXT",1)
"RTN","EASMTUTL",166,0)
 W !?3,"Please check, this record update may not have processed completely."
"RTN","EASMTUTL",167,0)
 Q
"RTN","EASMTUTL",168,0)
 ;
"RTN","EASMTUTL",169,0)
EDTLTRS ;
"RTN","EASMTUTL",170,0)
 N DIR,EASIEN
"RTN","EASMTUTL",171,0)
 ;
"RTN","EASMTUTL",172,0)
 S DIR(0)="P^713.3:EMZ"
"RTN","EASMTUTL",173,0)
 S DIR("A")="Select Letter"
"RTN","EASMTUTL",174,0)
 D ^DIR K DIR
"RTN","EASMTUTL",175,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",176,0)
 S EASIEN=+Y
"RTN","EASMTUTL",177,0)
 ;
"RTN","EASMTUTL",178,0)
 S DIE="^EAS(713.3,",DA=EASIEN,DR="4"
"RTN","EASMTUTL",179,0)
 D ^DIE
"RTN","EASMTUTL",180,0)
 Q
"RTN","EASMTUTL",181,0)
 ;
"RTN","EASMTUTL",182,0)
MTRTN ; Update the letter status file, #713.2, with returned Means Test information
"RTN","EASMTUTL",183,0)
 N DIE,DIC,EASIEN,DR,DA,Y
"RTN","EASMTUTL",184,0)
 ;
"RTN","EASMTUTL",185,0)
 S DIC="^EAS(713.2,",DIC(0)="AEQM",DIC("A")="Select the Letter Status entry to update: "
"RTN","EASMTUTL",186,0)
 D ^DIC K DIC
"RTN","EASMTUTL",187,0)
 Q:Y<0
"RTN","EASMTUTL",188,0)
 S EASIEN=+Y
"RTN","EASMTUTL",189,0)
 ;
"RTN","EASMTUTL",190,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",191,0)
 S DR="4;I X=0 S Y=0;5;7;6////^S X=DUZ;9///0;12///0;18///0"
"RTN","EASMTUTL",192,0)
 L +^EAS(713.2,EASIEN):0 I $T D 
"RTN","EASMTUTL",193,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",194,0)
 E  W !,$CHAR(7),"Entry is being edited by another user."
"RTN","EASMTUTL",195,0)
 L -^EAS(713.2,EASIEN)
"RTN","EASMTUTL",196,0)
 ;
"RTN","EASMTUTL",197,0)
 Q
"RTN","EASMTUTL",198,0)
 ;
"RTN","EASMTUTL",199,0)
DECEASED(EASIEN,DFN) ;  Check deceased status for patient
"RTN","EASMTUTL",200,0)
 N RSLT,EADEM,EAS1,VAROOT
"RTN","EASMTUTL",201,0)
 ;
"RTN","EASMTUTL",202,0)
 S EASIEN=$G(EASIEN)
"RTN","EASMTUTL",203,0)
 S DFN=$G(DFN)
"RTN","EASMTUTL",204,0)
 I EASIEN>0 D
"RTN","EASMTUTL",205,0)
 . S EAS1=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",206,0)
 . S DFN=$$GET1^DIQ(713.1,EAS1,.01,"I")
"RTN","EASMTUTL",207,0)
 Q:'DFN 0
"RTN","EASMTUTL",208,0)
 S RSLT=0
"RTN","EASMTUTL",209,0)
 ;
"RTN","EASMTUTL",210,0)
 S VAROOT="EADEM"
"RTN","EASMTUTL",211,0)
 D DEM^VADPT
"RTN","EASMTUTL",212,0)
 S:+EADEM(6) RSLT=1
"RTN","EASMTUTL",213,0)
 D KVA^VADPT
"RTN","EASMTUTL",214,0)
 Q RSLT
"RTN","EASMTUTL",215,0)
 ;
"RTN","EASMTUTL",216,0)
CHECKMT(EASPT,EAIEN) ; Check current MT status
"RTN","EASMTUTL",217,0)
 N DFN,RTN,EACHK,DIE,DR,DA
"RTN","EASMTUTL",218,0)
 ;
"RTN","EASMTUTL",219,0)
 S RTN=0
"RTN","EASMTUTL",220,0)
 I '$G(EASPT) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",221,0)
 S DFN=$$GET1^DIQ(713.1,EASPT,.01,"I") ; Get DFN
"RTN","EASMTUTL",222,0)
 I '$G(DFN) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",223,0)
 ;
"RTN","EASMTUTL",224,0)
 S EACHK=$$MTCHK^EASMTCHK(DFN,"L") ; Check current MT to see if it's changed
"RTN","EASMTUTL",225,0)
 I 'EACHK D  ; If MT no longer required, update letter status file
"RTN","EASMTUTL",226,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTUTL",227,0)
 . S DR="4///YES;5///TODAY;7///AUTO-GENERATED;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",228,0)
 . D ^DIE K DIE ;; Remove before release
"RTN","EASMTUTL",229,0)
 . S RTN=1
"RTN","EASMTUTL",230,0)
 ;
"RTN","EASMTUTL",231,0)
CHKQ Q RTN
"RTN","EASMTUTL",232,0)
 ;
"RTN","EASMTUTL",233,0)
FUTMT(EASIEN) ; Check for a future MT
"RTN","EASMTUTL",234,0)
 ;  Input
"RTN","EASMTUTL",235,0)
 ;    EASIEN - IEN for record in Letter Status file
"RTN","EASMTUTL",236,0)
 ;
"RTN","EASMTUTL",237,0)
 ;  Output
"RTN","EASMTUTL",238,0)
 ;     1 - Future MT exist's (API call)
"RTN","EASMTUTL",239,0)
 ;     0 - Future MT does not exist
"RTN","EASMTUTL",240,0)
 ;
"RTN","EASMTUTL",241,0)
 N EASPTR,DFN,EASFUT
"RTN","EASMTUTL",242,0)
 ;
"RTN","EASMTUTL",243,0)
 S RTN=0
"RTN","EASMTUTL",244,0)
 S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",245,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTUTL",246,0)
 ;
"RTN","EASMTUTL",247,0)
 ;; Call API for future MT check
"RTN","EASMTUTL",248,0)
 S EASFUT=$$FUT^DGMTU(DFN)
"RTN","EASMTUTL",249,0)
 ;
"RTN","EASMTUTL",250,0)
 I +$G(EASFUT) D  ; Turn off letters if future MT present
"RTN","EASMTUTL",251,0)
 . Q:'EASIEN
"RTN","EASMTUTL",252,0)
 . S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",253,0)
 . S DR="4///YES;5///TODAY;7///FUTURE MEANS TEST;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",254,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",255,0)
 . S RTN=1
"RTN","EASMTUTL",256,0)
 Q RTN
"RTN","EASMTUTL",257,0)
 ;
"RTN","EASMTUTL",258,0)
TESTLTR ;
"RTN","EASMTUTL",259,0)
 N EASIEN,EATYP,DIR,DIRUT,ZTSAVE
"RTN","EASMTUTL",260,0)
 ;
"RTN","EASMTUTL",261,0)
 S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTUTL",262,0)
 S DIR("A")="Select letter type to test"
"RTN","EASMTUTL",263,0)
 S DIR("?")="Select the type of letter to print a test output of"
"RTN","EASMTUTL",264,0)
 D ^DIR K DIR
"RTN","EASMTUTL",265,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",266,0)
 S EATYP=+Y
"RTN","EASMTUTL",267,0)
 S EASIEN=-1
"RTN","EASMTUTL",268,0)
 S ZTSAVE("EASIEN")="",ZTSAVE("EATYP")=""
"RTN","EASMTUTL",269,0)
 D EN^XUTMDEVQ("ZTEST^EASMTUTL","EAS MT TEST LETTER",.ZTSAVE)
"RTN","EASMTUTL",270,0)
 Q
"RTN","EASMTUTL",271,0)
 ;
"RTN","EASMTUTL",272,0)
TESTIT ;
"RTN","EASMTUTL",273,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",274,0)
 Q
"RTN","EASMTUTL",275,0)
 ;
"RTN","EASMTUTL",276,0)
ZTEST ;
"RTN","EASMTUTL",277,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",278,0)
 Q
"VER")
8.0^22
**END**
**END**
