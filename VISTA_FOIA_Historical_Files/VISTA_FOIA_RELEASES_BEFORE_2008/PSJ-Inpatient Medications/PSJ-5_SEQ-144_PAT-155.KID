Released PSJ*5*155 SEQ #144
Extracted from mail message
**KIDS**:PSJ*5.0*155^

**INSTALL NAME**
PSJ*5.0*155
"BLD",6143,0)
PSJ*5.0*155^INPATIENT MEDICATIONS^0^3051115^y
"BLD",6143,1,0)
^^25^25^3051115^
"BLD",6143,1,1,0)
 HD0000000106439 - Non-Verified Pending Report showing patients at the
"BLD",6143,1,2,0)
                   Wrong location.
"BLD",6143,1,3,0)
 ------------------------------------------------------------------------
"BLD",6143,1,4,0)
It has been discovered that the Non-Verified Pending report (PSJU VBW)
"BLD",6143,1,5,0)
is showing patients still under the clinic after being admitted to a
"BLD",6143,1,6,0)
ward.  This issue will be resolved by correctly searching the proper
"BLD",6143,1,7,0)
indexes used to determine the patient's current location. 
"BLD",6143,1,8,0)
 
"BLD",6143,1,9,0)
 HD0000000108102 - Expired on hold order cannot be removed
"BLD",6143,1,10,0)
 ------------------------------------------------------------------------
"BLD",6143,1,11,0)
If an order is placed "on hold" and then expires before being "taken 
"BLD",6143,1,12,0)
Off hold" the order will appear on the medication profile's "Active"
"BLD",6143,1,13,0)
List of medications.  If the Rph attempts to "unhold" this order the
"BLD",6143,1,14,0)
message "this order has expired" will be displayed and the order will
"BLD",6143,1,15,0)
remain on the list of Active medications.  This patch will resolve this
"BLD",6143,1,16,0)
issue by allowing the Rph to remove the order from hold.  After the
"BLD",6143,1,17,0)
order is removed from hold, it will immediately be removed from the
"BLD",6143,1,18,0)
active medications list.
"BLD",6143,1,19,0)
 
"BLD",6143,1,20,0)
 HD0000000108826 - Undefined error when exiting Pick list
"BLD",6143,1,21,0)
 ------------------------------------------------------------------------
"BLD",6143,1,22,0)
If you attempt to exit the "Requested Start Time:" prompt in the Pick
"BLD",6143,1,23,0)
List option (PSJU PLUP) you may receive the following error:
"BLD",6143,1,24,0)
<UNDEFINED>UP+6^PSGPLUP
"BLD",6143,1,25,0)
This patch will resolve this issue.
"BLD",6143,4,0)
^9.64PA^^
"BLD",6143,6)
3^
"BLD",6143,"ABPKG")
n
"BLD",6143,"KRN",0)
^9.67PA^8989.52^19
"BLD",6143,"KRN",.4,0)
.4
"BLD",6143,"KRN",.401,0)
.401
"BLD",6143,"KRN",.402,0)
.402
"BLD",6143,"KRN",.403,0)
.403
"BLD",6143,"KRN",.5,0)
.5
"BLD",6143,"KRN",.84,0)
.84
"BLD",6143,"KRN",3.6,0)
3.6
"BLD",6143,"KRN",3.8,0)
3.8
"BLD",6143,"KRN",9.2,0)
9.2
"BLD",6143,"KRN",9.8,0)
9.8
"BLD",6143,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6143,"KRN",9.8,"NM",1,0)
PSGPLUP^^0^B25153452
"BLD",6143,"KRN",9.8,"NM",2,0)
PSGVBW^^0^B60599815
"BLD",6143,"KRN",9.8,"NM",3,0)
PSIVOPT^^0^B56600170
"BLD",6143,"KRN",9.8,"NM","B","PSGPLUP",1)

"BLD",6143,"KRN",9.8,"NM","B","PSGVBW",2)

"BLD",6143,"KRN",9.8,"NM","B","PSIVOPT",3)

"BLD",6143,"KRN",19,0)
19
"BLD",6143,"KRN",19.1,0)
19.1
"BLD",6143,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6143,"KRN",101,0)
101
"BLD",6143,"KRN",409.61,0)
409.61
"BLD",6143,"KRN",771,0)
771
"BLD",6143,"KRN",870,0)
870
"BLD",6143,"KRN",8989.51,0)
8989.51
"BLD",6143,"KRN",8989.52,0)
8989.52
"BLD",6143,"KRN",8994,0)
8994
"BLD",6143,"KRN","B",.4,.4)

"BLD",6143,"KRN","B",.401,.401)

"BLD",6143,"KRN","B",.402,.402)

"BLD",6143,"KRN","B",.403,.403)

"BLD",6143,"KRN","B",.5,.5)

"BLD",6143,"KRN","B",.84,.84)

"BLD",6143,"KRN","B",3.6,3.6)

"BLD",6143,"KRN","B",3.8,3.8)

"BLD",6143,"KRN","B",9.2,9.2)

"BLD",6143,"KRN","B",9.8,9.8)

"BLD",6143,"KRN","B",19,19)

"BLD",6143,"KRN","B",19.1,19.1)

"BLD",6143,"KRN","B",101,101)

"BLD",6143,"KRN","B",409.61,409.61)

"BLD",6143,"KRN","B",771,771)

"BLD",6143,"KRN","B",870,870)

"BLD",6143,"KRN","B",8989.51,8989.51)

"BLD",6143,"KRN","B",8989.52,8989.52)

"BLD",6143,"KRN","B",8994,8994)

"BLD",6143,"QUES",0)
^9.62^^
"BLD",6143,"REQB",0)
^9.611^3^3
"BLD",6143,"REQB",1,0)
PSJ*5.0*129^2
"BLD",6143,"REQB",2,0)
PSJ*5.0*139^2
"BLD",6143,"REQB",3,0)
PSJ*5.0*110^2
"BLD",6143,"REQB","B","PSJ*5.0*110",3)

"BLD",6143,"REQB","B","PSJ*5.0*129",1)

"BLD",6143,"REQB","B","PSJ*5.0*139",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
155^3051115^520645566
"PKG",221,22,1,"PAH",1,1,0)
^^25^25^3051115
"PKG",221,22,1,"PAH",1,1,1,0)
 HD0000000106439 - Non-Verified Pending Report showing patients at the
"PKG",221,22,1,"PAH",1,1,2,0)
                   Wrong location.
"PKG",221,22,1,"PAH",1,1,3,0)
 ------------------------------------------------------------------------
"PKG",221,22,1,"PAH",1,1,4,0)
It has been discovered that the Non-Verified Pending report (PSJU VBW)
"PKG",221,22,1,"PAH",1,1,5,0)
is showing patients still under the clinic after being admitted to a
"PKG",221,22,1,"PAH",1,1,6,0)
ward.  This issue will be resolved by correctly searching the proper
"PKG",221,22,1,"PAH",1,1,7,0)
indexes used to determine the patient's current location. 
"PKG",221,22,1,"PAH",1,1,8,0)
 
"PKG",221,22,1,"PAH",1,1,9,0)
 HD0000000108102 - Expired on hold order cannot be removed
"PKG",221,22,1,"PAH",1,1,10,0)
 ------------------------------------------------------------------------
"PKG",221,22,1,"PAH",1,1,11,0)
If an order is placed "on hold" and then expires before being "taken 
"PKG",221,22,1,"PAH",1,1,12,0)
Off hold" the order will appear on the medication profile's "Active"
"PKG",221,22,1,"PAH",1,1,13,0)
List of medications.  If the Rph attempts to "unhold" this order the
"PKG",221,22,1,"PAH",1,1,14,0)
message "this order has expired" will be displayed and the order will
"PKG",221,22,1,"PAH",1,1,15,0)
remain on the list of Active medications.  This patch will resolve this
"PKG",221,22,1,"PAH",1,1,16,0)
issue by allowing the Rph to remove the order from hold.  After the
"PKG",221,22,1,"PAH",1,1,17,0)
order is removed from hold, it will immediately be removed from the
"PKG",221,22,1,"PAH",1,1,18,0)
active medications list.
"PKG",221,22,1,"PAH",1,1,19,0)
 
"PKG",221,22,1,"PAH",1,1,20,0)
 HD0000000108826 - Undefined error when exiting Pick list
"PKG",221,22,1,"PAH",1,1,21,0)
 ------------------------------------------------------------------------
"PKG",221,22,1,"PAH",1,1,22,0)
If you attempt to exit the "Requested Start Time:" prompt in the Pick
"PKG",221,22,1,"PAH",1,1,23,0)
List option (PSJU PLUP) you may receive the following error:
"PKG",221,22,1,"PAH",1,1,24,0)
<UNDEFINED>UP+6^PSGPLUP
"PKG",221,22,1,"PAH",1,1,25,0)
This patch will resolve this issue.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGPLUP")
0^1^B25153452
"RTN","PSGPLUP",1,0)
PSGPLUP ;BIR/CML3-UPDATE A PICK LIST ;28 JUN 96 / 9:24 AM
"RTN","PSGPLUP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,129,155**;16 DEC 97
"RTN","PSGPLUP",3,0)
 ;
"RTN","PSGPLUP",4,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGPLUP",5,0)
 ;
"RTN","PSGPLUP",6,0)
CHK ;
"RTN","PSGPLUP",7,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGPLUP",8,0)
 F Q=0:0 S Q=$O(^PS(53.5,"AB",Q)) Q:'Q  I $O(^(Q,PSGDT)) Q
"RTN","PSGPLUP",9,0)
 E  W !,"THERE ARE CURRENTLY NO PICK LISTS TO UPDATE." K DIR S DIR(0)="E" D ^DIR K DIR G DONE
"RTN","PSGPLUP",10,0)
 ;
"RTN","PSGPLUP",11,0)
ASK ;
"RTN","PSGPLUP",12,0)
 S PSGPLGF="U",PSGPLG="" R !!,"Select WARD GROUP or PICK LIST: ",X:DTIME W:'$T $C(7) S:'$T X="^" G:"^"[X DONE I X=+X D NL I Y D UP G CHK
"RTN","PSGPLUP",13,0)
 I X?1."?" W !!?2,"Select a Ward Group for which a pick list has been run that you wish to",!,"update.",!?2,"You may also select a Pick List by number, which prints in the upper left",!,"corner of each pick list."
"RTN","PSGPLUP",14,0)
 D DIC,^DIC K DIC G:Y'>0 ASK S PSGPLWG=+Y,PSGPLWGP=$G(^PS(57.5,+Y,5)) D ^PSGPLG I "^"'[PSGPLG D UP D ^%ZISC
"RTN","PSGPLUP",15,0)
 G CHK
"RTN","PSGPLUP",16,0)
 ;
"RTN","PSGPLUP",17,0)
DONE ;
"RTN","PSGPLUP",18,0)
 D ^%ZISC D ENKV^PSGSETU K CML,FD,FFF,FQ,GRP,PSGPLF,PSGPLG,PSGPLGF,PSGPLREN,PSGPLS,PSGPLUPR,PSGPLTND,PSGPLUPD,PSGPLUPF,PSGPLWG,PSGPLWGN,PSGMAR,PSGPLC,SD,TS,UP,WD,XX,PDRG,PSGPLWGP,PSGPLUP Q
"RTN","PSGPLUP",19,0)
 ;
"RTN","PSGPLUP",20,0)
UP ;
"RTN","PSGPLUP",21,0)
 I $D(^PS(53.5,PSGPLG,0)),'$P(^(0),"^",9) W $C(7),$C(7),!!?33,"*** WARNING ***",!,"THIS PICK LIST STARTED TO RUN ",$$ENDTC^PSGMI($P(^(0),"^",10)),", BUT HAS NOT RUN TO COMPLETION."
"RTN","PSGPLUP",22,0)
 I '$$LOCK^PSGPLUTL(PSGPLG,"PSGPL") W $C(7),$C(7),!!?33,"*** WARNING ***",!!?15,"THIS PICK LIST IS CURRENTLY LOCKED BY ANOTHER JOB."
"RTN","PSGPLUP",23,0)
 E  D UNLOCK^PSGPLUTL(PSGPLG,"PSGPL")
"RTN","PSGPLUP",24,0)
 F  R !!,"PRINT THE ENTIRE PICK LIST (P), OR ONLY THE UPDATE (U)? ",UP:DTIME W:'$T $C(7) S:'$T UP="^" D:UP'="^" UPC Q:UP]""
"RTN","PSGPLUP",25,0)
 I UP="^" W !!,"Update terminated." Q
"RTN","PSGPLUP",26,0)
 N PSGPLUP S:$G(UP)="U" PSGPLUP=1
"RTN","PSGPLUP",27,0)
 D DEV Q:POP!$D(IO("Q"))  W !,"...this may take a few minutes..." D QUEUE
"RTN","PSGPLUP",28,0)
 ;
"RTN","PSGPLUP",29,0)
ENQ ;
"RTN","PSGPLUP",30,0)
 N PSGPLREN
"RTN","PSGPLUP",31,0)
 I '$D(PSGPLUPQ) S PSGPLUPD=IO=IO(0)&($E(IOST)'="C") I PSGPLUPD S $P(PSGPLUPD,"^",2)=$G(ION)
"RTN","PSGPLUP",32,0)
 S:$G(UP)="U" PSGPLUP=1
"RTN","PSGPLUP",33,0)
 S PSGPLTND=$G(^PS(53.5,PSGPLG,0)) Q:'PSGPLTND  S PSGPLS=$P(PSGPLTND,"^",3),PSGPLF=$P(PSGPLTND,"^",4),WSF=$P(PSGPLTND,"^",7),PSGPLUPF=$S(UP="U":1,1:"")
"RTN","PSGPLUP",34,0)
 D ENQ^PSGPLUP0
"RTN","PSGPLUP",35,0)
 D ^PSGPLR,^%ZISC I UP="P" Q
"RTN","PSGPLUP",36,0)
 I '$D(PSGPLUPQ) S PSGPLUPR=1 F  W !!,"DO YOU NEED A REPRINT OF THIS UPDATE" S %=2 D YN^DICN Q:%<0  Q:%=2  D:'% RP I % S:PSGPLUPD IOP=$P(PSGPLUPD,"^",2) D DEV Q:POP  I '$D(IO("Q")) U IO D ^PSGPLR D ^%ZISC
"RTN","PSGPLUP",37,0)
 D DONE
"RTN","PSGPLUP",38,0)
 Q
"RTN","PSGPLUP",39,0)
 ;
"RTN","PSGPLUP",40,0)
UPC ;
"RTN","PSGPLUP",41,0)
 I UP?1."?" S UP="" W !!," Enter a 'U' if you wish to print only the new and edited (updated) orders for  this pick list.  Enter a 'P' to print the entire pick list, including the up-   dated orders.  Enter a '^' to terminate this update now." Q
"RTN","PSGPLUP",42,0)
 I UP="U" W "PDATE" Q
"RTN","PSGPLUP",43,0)
 I UP="P" W "ICK LIST" Q
"RTN","PSGPLUP",44,0)
 W $C(7),"  ??" S UP="" Q
"RTN","PSGPLUP",45,0)
 ;
"RTN","PSGPLUP",46,0)
DEV ;
"RTN","PSGPLUP",47,0)
 K PSGPLUPQ,IOP,IO("Q"),%ZIS S PSGION=ION,%ZIS="Q",%ZIS("A")="Print on Device: ",%ZIS("B")="" W ! D ^%ZIS K %ZIS I POP S IOP=PSGION D ^%ZIS K IOP S POP=1 W !,"No device chosen." Q
"RTN","PSGPLUP",48,0)
 ;
"RTN","PSGPLUP",49,0)
QUEUE ;
"RTN","PSGPLUP",50,0)
 Q:'$D(IO("Q"))
"RTN","PSGPLUP",51,0)
 K ZTSAVE S PSGTIR=$S($D(PSGPLUPR):"^PSGPLR",1:"ENQ^PSGPLUP"),ZTDESC="PICK LIST UPDATE",PSGPLUPQ=1
"RTN","PSGPLUP",52,0)
 F X="PSGPLWG","PSGPLWGP","PSGPLG","UP","PSGPLUPF","PSGPLUPQ","PSGPLUP" S ZTSAVE(X)="" S:$D(PSJPRN) ZTSAVE("PSJPRN")=""
"RTN","PSGPLUP",53,0)
 D ENTSK^PSGTI I $D(ZTSK) W !,"Pick list update queued!" K PSGPLUPQ Q
"RTN","PSGPLUP",54,0)
 I '$D(ZTSK) Q
"RTN","PSGPLUP",55,0)
 D ENQ^PSGPLUP
"RTN","PSGPLUP",56,0)
 ;
"RTN","PSGPLUP",57,0)
RP ;
"RTN","PSGPLUP",58,0)
 W !!,"Enter a 'Y' to reprint this update.  Enter an 'N' (or '^') if you do not want to reprint this update." Q
"RTN","PSGPLUP",59,0)
 ;
"RTN","PSGPLUP",60,0)
DIC K DIC S DIC="^PS(57.5,",DIC(0)="EIMQ",DIC("S")="I $D(^PS(57.5,+Y,0)),$P(^(0),""^"",2)=""P"",$O(^PS(53.5,""AB"",+Y,"_PSGDT_"))" Q
"RTN","PSGPLUP",61,0)
 ;
"RTN","PSGPLUP",62,0)
NL ; numeric look-up
"RTN","PSGPLUP",63,0)
 S Y=$G(^PS(53.5,X,0)) I $S('$P(Y,"^",3):1,$P(Y,"^",3)<PSGDT:1,1:'$D(^PS(53.5,"AB",$P(Y,"^",2),+$P(Y,"^",3),X))) S Y=0 Q
"RTN","PSGPLUP",64,0)
 S (GRP,PSGPLG)=X,X=Y,PSGID=$P(X,"^",3),PSGPLWG=$P(X,"^",2),PSGPLWGN=$P($G(^PS(57.5,PSGPLWG,0)),"^"),PSGPLWGP=$G(^(5)) S:PSGPLWGN="" PSGPLWGN=PSGPLWG_";PS(57.5," S Y=$$ENDTC^PSGMI($P(X,"^",3)),PSGOD=$$ENDTC^PSGMI($P(X,"^",4))
"RTN","PSGPLUP",65,0)
 W "  ",PSGPLWGN,!?$L(GRP)+21,Y,"  thru  ",PSGOD S Y=1 Q
"RTN","PSGVBW")
0^2^B60599815
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV-VERIFY ORDERS BY WARD, WARD GROUP, OR PATIENT ;22 Oct 98 / 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,16,39,59,62,67,58,81,80,110,111,133,139,155**;16 DEC 97
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ;
"RTN","PSGVBW",6,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",7,0)
START ;
"RTN","PSGVBW",8,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",9,0)
 ;I ($P(PSJSYSU,";")=3)!($P(PSJSYSU,";",3)=2) 
"RTN","PSGVBW",10,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",11,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",12,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",13,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",14,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",15,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",16,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",17,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",18,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",19,0)
 F  K ^TMP("PSJSELECT",$J) D ^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",20,0)
 ;
"RTN","PSGVBW",21,0)
DONE ;
"RTN","PSGVBW",22,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",23,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF
"RTN","PSGVBW",24,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSGVBW",25,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",26,0)
 ;
"RTN","PSGVBW",27,0)
GO ;
"RTN","PSGVBW",28,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",29,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",30,0)
 D ^PSGVBW0 Q
"RTN","PSGVBW",31,0)
 ;
"RTN","PSGVBW",32,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSGVBW",33,0)
G ;
"RTN","PSGVBW",34,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",35,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",36,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",37,0)
 ;S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: "
"RTN","PSGVBW",38,0)
GDIC ;
"RTN","PSGVBW",39,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",40,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all Outpatient IV orders and orders from the",!,"wards that do not belong to a ward group",!
"RTN","PSGVBW",41,0)
 Q
"RTN","PSGVBW",42,0)
C ;
"RTN","PSGVBW",43,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",44,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",45,0)
CDIC ;
"RTN","PSGVBW",46,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",47,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",48,0)
 Q
"RTN","PSGVBW",49,0)
L ;
"RTN","PSGVBW",50,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",51,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",52,0)
LDIC ;
"RTN","PSGVBW",53,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
W ;
"RTN","PSGVBW",57,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",58,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",59,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",60,0)
WDIC ;
"RTN","PSGVBW",61,0)
 ;S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: "
"RTN","PSGVBW",62,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",63,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",64,0)
 Q
"RTN","PSGVBW",65,0)
P ;
"RTN","PSGVBW",66,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",67,0)
 .S PSJNV=0
"RTN","PSGVBW",68,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",69,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",70,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",71,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",72,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",73,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",74,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",75,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",76,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",77,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",78,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",79,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",80,0)
 Q
"RTN","PSGVBW",81,0)
 ;
"RTN","PSGVBW",82,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",83,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",84,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",85,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W" F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",86,0)
 Q
"RTN","PSGVBW",87,0)
 ;
"RTN","PSGVBW",88,0)
CG S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",89,0)
 Q
"RTN","PSGVBW",90,0)
CL S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",91,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",92,0)
 K PSGCLF
"RTN","PSGVBW",93,0)
 Q
"RTN","PSGVBW",94,0)
WD S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"") I WDN]"" F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  I $S($D(^PS(55,"APV",PSGP)):1,$D(^PS(55,"APIV",PSGP)):1,$O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",95,0)
 Q
"RTN","PSGVBW",96,0)
IF ;BHW;PSJ*5*155;Added PSGCLF and PS(53.1,"AD" Check below.  If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.
"RTN","PSGVBW",97,0)
 W "." I PSJTOO'=1 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON!(($G(PSGCLF))&('$D(^PS(53.1,"AD",+$G(CL),PSGP,+$G(ON)))))  S X=$P($G(^PS(53.1,ON,0)),U,4),Y=0 I "FIU"[X D  G:Y SET
"RTN","PSGVBW",98,0)
 .I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",99,0)
 .I PSJPAC=2 S Y=X'="U" Q 
"RTN","PSGVBW",100,0)
 .I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",101,0)
 Q:PSJTOO=2
"RTN","PSGVBW",102,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  G:XX SET
"RTN","PSGVBW",103,0)
 . NEW ON F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) Q:XX
"RTN","PSGVBW",104,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",105,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  G SET
"RTN","PSGVBW",106,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  G SET
"RTN","PSGVBW",107,0)
 Q
"RTN","PSGVBW",108,0)
 ;
"RTN","PSGVBW",109,0)
IFT ;
"RTN","PSGVBW",110,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",111,0)
 Q
"RTN","PSGVBW",112,0)
 ;
"RTN","PSGVBW",113,0)
IFT2 ;
"RTN","PSGVBW",114,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",115,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4))
"RTN","PSGVBW",116,0)
 I ($P($G(^PS(55,PSGP,"IV",ON,.2)),"^",4)="D")&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4)))  Q
"RTN","PSGVBW",117,0)
 I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",118,0)
 Q
"RTN","PSGVBW",119,0)
SET ;
"RTN","PSGVBW",120,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,WD,1,+$O(^PS(57.7,"AWRT",WD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",121,0)
 ;
"RTN","PSGVBW",122,0)
SETPN ;
"RTN","PSGVBW",123,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID S:PSGSS'="P" ^TMP("PSGVBW",$J,WDN,TM,PN)=""
"RTN","PSGVBW",124,0)
 Q
"RTN","PSGVBW",125,0)
 ;
"RTN","PSGVBW",126,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",127,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",128,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",129,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",130,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",131,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",132,0)
 D GTPAC
"RTN","PSGVBW",133,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",134,0)
 Q
"RTN","PSGVBW",135,0)
GTPAC ;
"RTN","PSGVBW",136,0)
 ;S PSJTOO=$S($L(Y)>2:3,1:$P(Y,",")) Q:PSJTOO=1
"RTN","PSGVBW",137,0)
 ;I $G(PSJRNF) S PSJPAC=1 Q
"RTN","PSGVBW",138,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",139,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",140,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",141,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",142,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",143,0)
 Q
"RTN","PSGVBW",144,0)
EXIT(X) ;
"RTN","PSGVBW",145,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",146,0)
 Q
"RTN","PSGVBW",147,0)
 ;
"RTN","PSGVBW",148,0)
TOH ;
"RTN","PSGVBW",149,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",150,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSIVOPT")
0^3^B56600170
"RTN","PSIVOPT",1,0)
PSIVOPT ;BIR/PR,MLM-OPTION DRIVER ;06 Aug 98 / 2:17 PM
"RTN","PSIVOPT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,27,58,88,104,110,155**;16 DEC 97
"RTN","PSIVOPT",3,0)
 ;
"RTN","PSIVOPT",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSIVOPT",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192        
"RTN","PSIVOPT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231
"RTN","PSIVOPT",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173
"RTN","PSIVOPT",8,0)
 ;
"RTN","PSIVOPT",9,0)
 NEW PSIVLOCK S PSIVLOCK=0
"RTN","PSIVOPT",10,0)
 ;I ON["P" L +^PS(53.1,+ON):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",11,0)
 I ON["V" L +^PS(55,DFN,"IV",+ON55):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",12,0)
 I PSIVLOCK W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",13,0)
 ;W ! L +^PS(55,DFN,"IV",+ON55):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",14,0)
 I PSIVAC="O"!(PSIVAC="H") S PSIVAC=PSIVAC_"(DFN,ON,P(17),P(3))"
"RTN","PSIVOPT",15,0)
 S TEX="Active order ***" I $D(UWLFLAG),UWLFLAG="1.001" S XED=0 D @PSIVAC G K
"RTN","PSIVOPT",16,0)
 S DONE=0 F  D ACT Q:DONE
"RTN","PSIVOPT",17,0)
 ;
"RTN","PSIVOPT",18,0)
UNLOCK ; Unlock order.
"RTN","PSIVOPT",19,0)
 ;I ON["P" L -^PS(53.1,+ON)
"RTN","PSIVOPT",20,0)
 ;E  L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",21,0)
 I ON["V" L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",22,0)
 ;
"RTN","PSIVOPT",23,0)
K ; Kill variables.
"RTN","PSIVOPT",24,0)
 K %,DA,DIE,DIK,DLAYGO,DNE,DR,DRG,DRGI,DRGT,ERR,HELP,J,OD,P,P16,PSIVAL,PSIVC,PSIVLOG,PSIVNOL,PSIVOK,PSIVOPT,PSIVREA,SCRNPRO,TEX,XED
"RTN","PSIVOPT",25,0)
 Q
"RTN","PSIVOPT",26,0)
ACT ; Prompt for order action.
"RTN","PSIVOPT",27,0)
 K PSJIVBD NEW PSGFDX,PSGSDX S (PSJORD,ON)=ON55
"RTN","PSIVOPT",28,0)
 S PSJCOM=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8),1:$P($G(^PS(53.1,+ON,.2)),"^",8))
"RTN","PSIVOPT",29,0)
 D:ON["V" EN^PSJLIORD(DFN,ON)
"RTN","PSIVOPT",30,0)
 I ON["P",($P($G(^PS(53.1,+ON,0)),U,9)="N"),'PSJCOM D GT531^PSIVORFA(DFN,ON),VF^PSIVORC2 S DONE=1 Q
"RTN","PSIVOPT",31,0)
 I ON["P",PSJCOM Q:'$$LOCK^PSJOEA(DFN,PSJCOM)  N PSJO,ON,PSJORD S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  Q:$G(Y)="Q"  S (PSJORD,ON)=PSJO_"P" D
"RTN","PSIVOPT",32,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="N") GT531^PSIVORFA(DFN,ON),VF^PSIVORC2
"RTN","PSIVOPT",33,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="P") EN^PSJLIFN
"RTN","PSIVOPT",34,0)
 I $G(PSJCOM) N PSJORD S PSJORD=PSJCOM D CHK^PSJOEA1
"RTN","PSIVOPT",35,0)
 I ON'["V",'+$G(PSJCOM) D EN^PSJLIFN
"RTN","PSIVOPT",36,0)
 S DONE=1
"RTN","PSIVOPT",37,0)
 Q
"RTN","PSIVOPT",38,0)
 ;
"RTN","PSIVOPT",39,0)
CK ; Check if drugs are still valid.
"RTN","PSIVOPT",40,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVOPT",41,0)
 .S DRG=+$P(DRG(DRGT,DRGI),U),X=$G(^PS(FIL,DRG,"I")) I $S('X:0,DT<X:0,1:1)!$S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG,0)),U,2),"I")):0,^("I")>DT:0,1:1) S ERR=1
"RTN","PSIVOPT",42,0)
 Q
"RTN","PSIVOPT",43,0)
 ;
"RTN","PSIVOPT",44,0)
D ; Discontinue order.
"RTN","PSIVOPT",45,0)
 D D^PSIVOPT2
"RTN","PSIVOPT",46,0)
 Q
"RTN","PSIVOPT",47,0)
 ;
"RTN","PSIVOPT",48,0)
O(DFN,ON,STAT,STOP) ; On/Off Call
"RTN","PSIVOPT",49,0)
 D NOW^%DTC I STAT="H",STOP<% D EXPIR Q
"RTN","PSIVOPT",50,0)
 I "OA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",51,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="O":"O",1:"C"),(P(17),STAT)=$S(PSIVREA="O":"O",1:"A") W:PSIVREA="C" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",52,0)
 D UPSTAT,LOG^PSIVORAL D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",53,0)
 Q
"RTN","PSIVOPT",54,0)
 ;
"RTN","PSIVOPT",55,0)
E ; Entry for Pharmacy edit
"RTN","PSIVOPT",56,0)
 N PSJEDIT1 D E^PSIVOPT1
"RTN","PSIVOPT",57,0)
 Q
"RTN","PSIVOPT",58,0)
 ;
"RTN","PSIVOPT",59,0)
R ; Renew order.
"RTN","PSIVOPT",60,0)
 D R^PSIVOPT2
"RTN","PSIVOPT",61,0)
 Q
"RTN","PSIVOPT",62,0)
 ;
"RTN","PSIVOPT",63,0)
H(DFN,ON,STAT,STOP)          ; Place order on hold.
"RTN","PSIVOPT",64,0)
 D NOW^%DTC I STAT="H" I STOP<% D EXPIR Q
"RTN","PSIVOPT",65,0)
 I "HA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",66,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !!,"Order unchanged." Q
"RTN","PSIVOPT",67,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="H":"H",1:"U"),(P(17),STAT)=$S(PSIVREA="H":"H",1:"A") W:PSIVREA="U" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",68,0)
 D UPSTAT,LOG^PSIVORAL,HOLD^PSIVOE,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(PSIVREA="H":"H1",1:"H0")) D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",69,0)
 Q
"RTN","PSIVOPT",70,0)
 ;
"RTN","PSIVOPT",71,0)
S ; View order.
"RTN","PSIVOPT",72,0)
 D @$S(ON55["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON55_""")") W @IOF D EN^PSIVORV2
"RTN","PSIVOPT",73,0)
 Q
"RTN","PSIVOPT",74,0)
 ;
"RTN","PSIVOPT",75,0)
EXPIR ; Update status of expired orders.
"RTN","PSIVOPT",76,0)
 I STAT="H" S PSIVREA="H",P(17)="E"
"RTN","PSIVOPT",77,0)
 S STAT="E" D UPSTAT,EXPIR^PSIVOE W $C(7),"  This order has expired."
"RTN","PSIVOPT",78,0)
 Q
"RTN","PSIVOPT",79,0)
 ;
"RTN","PSIVOPT",80,0)
UPSTAT ; Update orders status.
"RTN","PSIVOPT",81,0)
 N DA,DR,DIE,PSIVACT S PSIVACT=1,DA=+ON55,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="100///"_P(17)_$S($G(PSIVREA)="H":";149///1",$G(PSIVREA)="U":";149///@",1:"") D ^DIE
"RTN","PSIVOPT",82,0)
 Q
"RTN","PSIVOPT",83,0)
 ;
"RTN","PSIVOPT",84,0)
ENIN ; Entry for inpatient order entry/profile options.
"RTN","PSIVOPT",85,0)
 N DFN,ON,P,PSIVAC S PSIVAC="C" I PSJORD["P" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP D SHOW1^PSIVORC Q
"RTN","PSIVOPT",86,0)
 S (P("PON"),ON,ON55)=+PSJORD_"V",DFN=PSGP D GT55^PSIVORFB,EN^PSIVORV2,PSIVOPT:'$D(PSJPRF)
"RTN","PSIVOPT",87,0)
 L -^PS(55,DFN,"IV",+PSJORD)
"RTN","PSIVOPT",88,0)
 Q
"RTN","PSIVOPT",89,0)
 ;
"RTN","PSIVOPT",90,0)
ENARI(DFN,ON,PSGUOW,PSIVAL) ; Auto-reinstate IV orders if movement is deleted.
"RTN","PSIVOPT",91,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSIVOPT",92,0)
 S PSGORNUM=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,$G(OR55):OR55,1:"")
"RTN","PSIVOPT",93,0)
 I $G(PSGORNUM) D
"RTN","PSIVOPT",94,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,0)),$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6))="" ; Provider
"RTN","PSIVOPT",95,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,2)),$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11))="" ; Entered by
"RTN","PSIVOPT",96,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,4)),$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1))="" ; Verifying Nurse
"RTN","PSIVOPT",97,0)
 ; find pharmacist that finished the IV order
"RTN","PSIVOPT",98,0)
 N PSJX,ENTBY S PSJX=$G(^PS(55,PSGP,"IV",+ON,"A",1,0))
"RTN","PSIVOPT",99,0)
 I $P(PSJX,U,2)="F" S ENTBY=$$VA200($P(PSJX,U,3)) I ENTBY'="" S PSJSENTO($J,ENTBY)=""
"RTN","PSIVOPT",100,0)
 ;
"RTN","PSIVOPT",101,0)
 I $G(PSGALO)'=18530,$G(PSGORNUM),$$IVDUPADD^PSIVOPT(PSGP,+PSGORNUM) S ^TMP("PSJNOTUNDC",$J,PSGP,+PSGORNUM_"V")="" Q
"RTN","PSIVOPT",102,0)
 N DA,DR,DIE,DIK,PSIVREA,PSIVALCK,PSIVOPT,PSIVALT,X,Y
"RTN","PSIVOPT",103,0)
 S X=$G(^PS(55,DFN,"IV",+ON,"ADC")) I X K ^PS(55,"ADC",X,DFN,+ON),^PS(55,DFN,"IV",+ON,"ADC")
"RTN","PSIVOPT",104,0)
 S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H",+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H",1:"100///A")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@"
"RTN","PSIVOPT",105,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSIVOPT",106,0)
 N CHKIT S CHKIT=$G(^PS(55,DFN,"IV",+ON,2)) I $P(CHKIT,U,6)["P",($P(CHKIT,U,9)="R") S DR=DR_";114///@;123///@"
"RTN","PSIVOPT",107,0)
 D ^DIE
"RTN","PSIVOPT",108,0)
 S ^TMP("PSJUNDC",$J,DFN,ON_"V")=""
"RTN","PSIVOPT",109,0)
 S ON55=ON,P(17)="A",PSIVREA=$S($D(PSJUNDC):"AI",1:"I"),PSIVALCK="STOP",(PSIVOPT,PSIVALT)=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U) D LOG^PSIVORAL
"RTN","PSIVOPT",110,0)
 ;* S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),ORIFN=$P(Y,U,21),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",111,0)
 S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",112,0)
 .D EN1^PSJHL2(DFN,"SC",+ON55_"V","AUTO REINSTATED")
"RTN","PSIVOPT",113,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2)
"RTN","PSIVOPT",114,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSIVOPT",115,0)
 I $D(^PS(53.41,1,1,PSGUOW,1,DFN,1,3,1,+ON)) K DIK,DA S DIK="^PS(53.41,1,1,"_PSGUOW_",1,"_DFN_",1,3,1,",DA=+ON,DA(1)=1,DA(2)=PSGP,DA(3)=PSGUOW,DA(4)=3 D ^DIK
"RTN","PSIVOPT",116,0)
 E  K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,3,+ON,"RE")
"RTN","PSIVOPT",117,0)
 Q
"RTN","PSIVOPT",118,0)
 ;
"RTN","PSIVOPT",119,0)
ENINP(DFN,ON) ; Entry from Inpatient Profile.
"RTN","PSIVOPT",120,0)
 N PSIVAC,ON55 S PSIVAC="PRO" D @($S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")")),ENNH^PSIVORV2(ON)
"RTN","PSIVOPT",121,0)
 Q
"RTN","PSIVOPT",122,0)
ENLBL(PSGTOL,PSGUOW,PSGP,PSGTOO,DA,RES) ;
"RTN","PSIVOPT",123,0)
 ;Queue MAR labels for IV orders.
"RTN","PSIVOPT",124,0)
 Q:'$D(^DPT(PSGP,.1))  I '$D(PSJSYSW0) N PSJACPF,PSJACNWP S PSJACPF=11 D WP^PSJAC Q:'PSJSYSL
"RTN","PSIVOPT",125,0)
 N P,X,Y
"RTN","PSIVOPT",126,0)
 S X=$P(PSJSYSW0,U,2),Y=$P($G(^PS(55,PSGP,"IV",DA,0)),U,4)
"RTN","PSIVOPT",127,0)
 S Y=$S(Y="A":4,Y="H":5,Y="C":6,1:3) I X=1!(X[Y) D NOW^%DTC S PSGDT=% D ENL^PSGVDS S ^PS(55,DFN,"IV",DA,7)=PSGDT_U_RES
"RTN","PSIVOPT",128,0)
 Q
"RTN","PSIVOPT",129,0)
 ;
"RTN","PSIVOPT",130,0)
IVDUPADD(PSGP,ORDERNUM) ;
"RTN","PSIVOPT",131,0)
 N PSJCOM
"RTN","PSIVOPT",132,0)
 S DUPLOOP=0
"RTN","PSIVOPT",133,0)
 S DUPFOUND=0
"RTN","PSIVOPT",134,0)
 ;Loop through the additives of order to reinstate
"RTN","PSIVOPT",135,0)
 S PSJCOM=+$P($G(^PS(55,+PSGP,"IV",ORDERNUM,.2)),"^",8) F  S DUPLOOP=$O(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP)) Q:((DUPLOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",136,0)
 .;Get the additive code no.
"RTN","PSIVOPT",137,0)
 .S TARGET=$P(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP,0),"^",1)
"RTN","PSIVOPT",138,0)
 .D NOW^%DTC
"RTN","PSIVOPT",139,0)
 .S DATELOOP=%
"RTN","PSIVOPT",140,0)
 .;Loop through the current orders for the patient by date
"RTN","PSIVOPT",141,0)
 .F  S DATELOOP=$O(^PS(55,PSGP,"IV","AIS",DATELOOP)) Q:((DATELOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",142,0)
 ..S EXISTORD=""
"RTN","PSIVOPT",143,0)
 ..;Loop through the orders for date by order number
"RTN","PSIVOPT",144,0)
 ..F  S EXISTORD=$O(^PS(55,PSGP,"IV","AIS",DATELOOP,EXISTORD)) Q:((EXISTORD="")!(DUPFOUND))  D
"RTN","PSIVOPT",145,0)
 ...;Loop through additives for the existing order
"RTN","PSIVOPT",146,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,"IV",EXISTORD,.2)),"^",8)
"RTN","PSIVOPT",147,0)
 ...S EXISTADD=0
"RTN","PSIVOPT",148,0)
 ...F  S EXISTADD=$O(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD)) Q:((EXISTADD="")!(DUPFOUND))  D 
"RTN","PSIVOPT",149,0)
 ....;Extract the Additive Code number for the Order
"RTN","PSIVOPT",150,0)
 ....S MATCHADD=$P(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD,0),"^",1)
"RTN","PSIVOPT",151,0)
 ....;If the existing order and the order to be reinstated have the same additive code then return FOUND=TRUE
"RTN","PSIVOPT",152,0)
 ....I MATCHADD=TARGET D
"RTN","PSIVOPT",153,0)
 .....S DUPFOUND=1
"RTN","PSIVOPT",154,0)
 Q DUPFOUND
"RTN","PSIVOPT",155,0)
 ;
"RTN","PSIVOPT",156,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSIVOPT",157,0)
 ; X = User name
"RTN","PSIVOPT",158,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSIVOPT",159,0)
 I +Y=-1 Q ""
"RTN","PSIVOPT",160,0)
 Q $P(Y,U)
"VER")
8.0^22.0
"BLD",6143,6)
^144
**END**
**END**
