Released LR*5.2*337 SEQ #281
Extracted from mail message
**KIDS**:LR*5.2*337^

**INSTALL NAME**
LR*5.2*337
"BLD",6269,0)
LR*5.2*337^LAB SERVICE^0^3061228^y
"BLD",6269,1,0)
^^3^3^3061020^^^^
"BLD",6269,1,1,0)
This patch corrects 2 problems with "DELETE TEST" and a problem
"BLD",6269,1,2,0)
with exiting the "INTERIM REPORT".  An issue is also addressed with
"BLD",6269,1,3,0)
"ELECTRONIC CATALOG".
"BLD",6269,4,0)
^9.64PA^^
"BLD",6269,6)
3^
"BLD",6269,6.3)
2
"BLD",6269,"ABPKG")
n
"BLD",6269,"KRN",0)
^9.67PA^8989.52^19
"BLD",6269,"KRN",.4,0)
.4
"BLD",6269,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",6269,"KRN",.4,"NM",1,0)
LA7S PRINT    FILE #60^60^0
"BLD",6269,"KRN",.4,"NM","B","LA7S PRINT    FILE #60",1)
 
"BLD",6269,"KRN",.401,0)
.401
"BLD",6269,"KRN",.402,0)
.402
"BLD",6269,"KRN",.403,0)
.403
"BLD",6269,"KRN",.5,0)
.5
"BLD",6269,"KRN",.84,0)
.84
"BLD",6269,"KRN",3.6,0)
3.6
"BLD",6269,"KRN",3.8,0)
3.8
"BLD",6269,"KRN",9.2,0)
9.2
"BLD",6269,"KRN",9.8,0)
9.8
"BLD",6269,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6269,"KRN",9.8,"NM",1,0)
LRTSTOUT^^0^B60326116
"BLD",6269,"KRN",9.8,"NM",2,0)
LRTSTJAN^^0^B13864468
"BLD",6269,"KRN",9.8,"NM",3,0)
LRRS^^0^B17887705
"BLD",6269,"KRN",9.8,"NM",4,0)
LRBEPEND^^0^B48206085
"BLD",6269,"KRN",9.8,"NM",5,0)
LRBEBA5^^0^B51178400
"BLD",6269,"KRN",9.8,"NM","B","LRBEBA5",5)
 
"BLD",6269,"KRN",9.8,"NM","B","LRBEPEND",4)
 
"BLD",6269,"KRN",9.8,"NM","B","LRRS",3)
 
"BLD",6269,"KRN",9.8,"NM","B","LRTSTJAN",2)
 
"BLD",6269,"KRN",9.8,"NM","B","LRTSTOUT",1)
 
"BLD",6269,"KRN",19,0)
19
"BLD",6269,"KRN",19.1,0)
19.1
"BLD",6269,"KRN",101,0)
101
"BLD",6269,"KRN",409.61,0)
409.61
"BLD",6269,"KRN",771,0)
771
"BLD",6269,"KRN",870,0)
870
"BLD",6269,"KRN",8989.51,0)
8989.51
"BLD",6269,"KRN",8989.52,0)
8989.52
"BLD",6269,"KRN",8994,0)
8994
"BLD",6269,"KRN","B",.4,.4)
 
"BLD",6269,"KRN","B",.401,.401)
 
"BLD",6269,"KRN","B",.402,.402)
 
"BLD",6269,"KRN","B",.403,.403)
 
"BLD",6269,"KRN","B",.5,.5)
 
"BLD",6269,"KRN","B",.84,.84)
 
"BLD",6269,"KRN","B",3.6,3.6)
 
"BLD",6269,"KRN","B",3.8,3.8)
 
"BLD",6269,"KRN","B",9.2,9.2)
 
"BLD",6269,"KRN","B",9.8,9.8)
 
"BLD",6269,"KRN","B",19,19)
 
"BLD",6269,"KRN","B",19.1,19.1)
 
"BLD",6269,"KRN","B",101,101)
 
"BLD",6269,"KRN","B",409.61,409.61)
 
"BLD",6269,"KRN","B",771,771)
 
"BLD",6269,"KRN","B",870,870)
 
"BLD",6269,"KRN","B",8989.51,8989.51)
 
"BLD",6269,"KRN","B",8989.52,8989.52)
 
"BLD",6269,"KRN","B",8994,8994)
 
"BLD",6269,"QUES",0)
^9.62^^
"BLD",6269,"REQB",0)
^9.611^4^3
"BLD",6269,"REQB",2,0)
LR*5.2*221^2
"BLD",6269,"REQB",3,0)
LR*5.2*283^2
"BLD",6269,"REQB",4,0)
LR*5.2*291^2
"BLD",6269,"REQB","B","LR*5.2*221",2)
 
"BLD",6269,"REQB","B","LR*5.2*283",3)
 
"BLD",6269,"REQB","B","LR*5.2*291",4)
 
"KRN",.4,4476,-1)
0^1
"KRN",.4,4476,0)
LA7S PRINT^3010502.1623^^60^^^3061020
"KRN",.4,4476,"DXS",1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),DIP(1)=$S($D(^LAB(60,D0,3,D1,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'D0!'$D(^LAB(62,+D0,0)) D0=-1 S DIP(101)=$S($D(^LAB(62,D0,0)):^(0),1:"")
"KRN",.4,4476,"DXS",2,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),DIP(1)=$S($D(^LAB(60,D0,1,D1,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'D0!'$D(^LAB(61,+D0,0)) D0=-1 S DIP(101)=$S($D(^LAB(61,D0,0)):^(0),1:"")
"KRN",.4,4476,"DXS",3,9)
W:$P(^LAB(60,D0,1,D1,0),U,11)'="" "Therapeutic Low: ",$P(^LAB(60,D0,1,D1,0),U,11),"   "
"KRN",.4,4476,"DXS",4,9)
W:$P(^LAB(60,D0,1,D1,0),U,12)'="" "Therapeutic High: ",$P(^LAB(60,D0,1,D1,0),U,12),"   "
"KRN",.4,4476,"DXS",5,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^LAB(60,D0,64)):^(64),1:""),D0=$P(DIP(1),U,2) S:'D0!'$D(^LAM(+D0,0)) D0=-1 S DIP(101)=$S($D(^LAM(D0,0)):^(0),1:"") S X="NLT Result Code: "
"KRN",.4,4476,"DXS",6,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^LAB(60,D0,64)):^(64),1:""),D0=$P(DIP(1),U,2) S:'D0!'$D(^LAM(+D0,0)) D0=-1 S DIP(101)=$S($D(^LAM(D0,0)):^(0),1:""),DIP(102)=X
"KRN",.4,4476,"DXS",7,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^LAB(60,D0,64)):^(64),1:""),D0=$P(DIP(101),U,2) S:'D0!'$D(^LAM(+D0,0)) D0=-1 S DIP(201)=$S($D(^LAM(D0,0)):^(0),1:"")
"KRN",.4,4476,"DXS",8,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^LAB(60,D0,64)):^(64),1:""),D0=$P(DIP(101),U,2) S:'D0!'$D(^LAM(+D0,0)) D0=-1 S DIP(201)=$S($D(^LAM(D0,0)):^(0),1:"")
"KRN",.4,4476,"DXS",9,9.2)
S I(101,0)=$G(D1),I(100,0)=$G(D0),DIP(101)=$S($D(^LAB(60,D0,1,D1,0)):^(0),1:""),D0=$P(DIP(101),U,1) S:'D0!'$D(^LAB(61,+D0,0)) D0=-1 S DIP(201)=$S($D(^LAB(61,D0,0)):^(0),1:"")
"KRN",.4,4476,"DXS",10,9)
W:$P(^LAB(60,D0,1,D1,0),U,11)'="" "Therapeutic Low: ",$P(^LAB(60,D0,1,D1,0),U,11),"   "
"KRN",.4,4476,"DXS",11,9)
W:$P(^LAB(60,D0,1,D1,0),U,12)'="" "Therapeutic High: ",$P(^LAB(60,D0,1,D1,0),U,12),"   "
"KRN",.4,4476,"DXS",12,9)
S DIP(101)=$S($D(^LAM(D0,5,D1,0)):^(0),1:"") S X="Specimen Cost: ",DIP(102)=X,Y=$P(DIP(101),U,2) X:$D(^DD(64.01,1,2)) ^(2) S X=Y,Y=X,X=DIP(102),X=X_Y
"KRN",.4,4476,"F",1)
.01;C1;""~" ";C1;""~I $$TEST^LA7SUTL(D0)'="" W $$TEST^LA7SUTL(D0);"";C5;Z;"I $$TEST^LA7SUTL(D0)'="" W $$TEST^LA7SUTL(D0)"~110,.01;"";C5~" ";C1;""~
"KRN",.4,4476,"F",2)
300,S DIP(1)=$S($D(^LAB(60,D0,3,D1,0)):^(0),1:"") S X="Collection Tube: "_$S('$D(^LAB(62,+$P(DIP(1),U,1),0)):"",1:$P(^(0),U,1)) W X K DIP;"";C10;C1;"";Z;""Collection Tube: "_#.01"~
"KRN",.4,4476,"F",3)
300,X DXS(1,9.2) S X=$P(DIP(101),U,3) S D0=I(0,0) S D1=I(1,0) W X K DIP;"";C40;Z;".01:3"~
"KRN",.4,4476,"F",4)
300,S X="MIN VOL (in mls.): "_$P($G(^LAB(60,D0,3,D1,0)),U,4) W X K DIP;"";C10;Z;""MIN VOL (in mls.): "_#3"~300,6,.01;"";C10~300,5,.01;"";C10~
"KRN",.4,4476,"F",5)
100,S DIP(1)=$S($D(^LAB(60,D0,1,D1,0)):^(0),1:"") S X="Site/Specimen: "_$S('$D(^LAB(61,+$P(DIP(1),U,1),0)):"",1:$P(^(0),U,1)) W X K DIP;"";"";C10;Z;""Site/Specimen: "_#.01"~
"KRN",.4,4476,"F",6)
100,"LEDI HL7:";"";C12~100,X DXS(2,9.2) S X=$S('$D(^LAB(64.061,+$P(DIP(101),U,9),0)):"",1:$P(^(0),U,1)) S D0=I(0,0) S D1=I(1,0) W X K DIP;"";X;Z;".01:.09"~
"KRN",.4,4476,"F",7)
100," ";C1;""~
"KRN",.4,4476,"F",8)
100,W:$P(^LAB(60,D0,1,D1,0),U,2)'="" "Reference Low: ",$P(^LAB(60,D0,1,D1,0),U,2),"   ";"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,2)'="" "Reference Low: ",$P(^LAB(60,D0,1,D1,0),U,2),"   ""~
"KRN",.4,4476,"F",9)
100,W:$P(^LAB(60,D0,1,D1,0),U,3)'="" "Reference High: ",$P(^LAB(60,D0,1,D1,0),U,3),"   ";"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,3)'="" "Reference High: ",$P(^LAB(60,D0,1,D1,0),U,3),"   ""~
"KRN",.4,4476,"F",10)
100,W:$P(^LAB(60,D0,1,D1,0),U,4)'="" "Critical Low: ",$P(^LAB(60,D0,1,D1,0),U,4),"   ";"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,4)'="" "Critical Low: ",$P(^LAB(60,D0,1,D1,0),U,4),"   ""~
"KRN",.4,4476,"F",11)
100,W:$P(^LAB(60,D0,1,D1,0),U,5)'="" "Critical High: ",$P(^LAB(60,D0,1,D1,0),U,5),"   ";"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,5)'="" "Critical High: ",$P(^LAB(60,D0,1,D1,0),U,5),"   ""~
"KRN",.4,4476,"F",12)
100,X DXS(3,9);"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,11)'="" "Therapeutic Low: ",$P(^LAB(60,D0,1,D1,0),U,11),"   ""~
"KRN",.4,4476,"F",13)
100,X DXS(4,9);"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,12)'="" "Therapeutic High: ",$P(^LAB(60,D0,1,D1,0),U,12),"   ""~
"KRN",.4,4476,"F",14)
100,W:$P(^LAB(60,D0,1,D1,0),U,7)'="" "Units: ",$P(^LAB(60,D0,1,D1,0),U,7),"   ";"";C12;Z;"W:$P(^LAB(60,D0,1,D1,0),U,7)'="" "Units: ",$P(^LAB(60,D0,1,D1,0),U,7),"   ""~
"KRN",.4,4476,"F",15)
100,I +$O(^LAB(60,D0,1,D1,1,0))>0 W "Interpretation:  ";C12;"";Z;"I +$O(^LAB(60,D0,1,D1,1,0))>0 W "Interpretation:  ""~100,5.5,.01;"";C15~
"KRN",.4,4476,"F",16)
-64,^LAM(^^S I(0,0)=D0 S DIP(1)=$S($D(^LAB(60,D0,64)):^(64),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;"64:"~
"KRN",.4,4476,"F",17)
-64,S DIP(101)=$S($D(^LAM(D0,0)):^(0),1:"") S X="NLT Code: "_$P(DIP(101),U,2) W X K DIP;"";C10;Z;""NLT Code: "_#1"~-64,.01;"";C40~
"KRN",.4,4476,"F",18)
X DXS(5,9.2) S X=X_$P(DIP(101),U,2) S D0=I(0,0) W X K DIP;"";C10;Z;"64.1:"NLT Result Code: "_#1"~
"KRN",.4,4476,"F",19)
X DXS(6,9.2) S Y=$P(DIP(101),U,1) X:$D(^DD(64,.01,2)) ^(2) S X=Y S D0=I(0,0) W X K DIP;"";C40;Z;"64.1:PROCEDURE"~" ";C1~
"KRN",.4,4476,"F",20)
I +$O(^LAB(60,D0,2,0))>0 W "LAB TEST(S) IN PANEL";C10;"";Z;"I +$O(^LAB(60,D0,2,0))>0 W "LAB TEST(S) IN PANEL""~200,.01;"";C12;"";C1~
"KRN",.4,4476,"F",21)
200,-60,^LAB(60,^^S I(1,0)=D1 S I(0,0)=D0 S DIP(1)=$S($D(^LAB(60,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~
"KRN",.4,4476,"F",22)
200,-60,I $$TEST^LA7SUTL(D0)'="" W $$TEST^LA7SUTL(D0);"";C12;Z;"I $$TEST^LA7SUTL(D0)'="" W $$TEST^LA7SUTL(D0)"~200,-60," ";"";C1~
"KRN",.4,4476,"F",23)
200,-60,X DXS(7,9.2) S X="NLT Result Code: "_$P(DIP(201),U,2) S D0=I(100,0) W X K DIP;"";C12;Z;"64.1:"NLT Result Code: "_#1"~
"KRN",.4,4476,"F",24)
200,-60,X DXS(8,9.2) S DIP(202)=X,Y=$P(DIP(201),U,1) X:$D(^DD(64,.01,2)) ^(2) S X=Y S D0=I(100,0) W X K DIP;"";C40;Z;"64.1:PROCEDURE"~
"KRN",.4,4476,"F",25)
200,-60,100,S DIP(101)=$S($D(^LAB(60,D0,1,D1,0)):^(0),1:"") S X="Site/Specimen: "_$S('$D(^LAB(61,+$P(DIP(101),U,1),0)):"",1:$P(^(0),U,1)) W X K DIP;"";"";C15;"";Z;""Site/Specimen: "_#.01"~
"KRN",.4,4476,"F",26)
200,-60,100," ";C1;""~200,-60,100,"LEDI HL7: ";"";C17~
"KRN",.4,4476,"F",27)
200,-60,100,X DXS(9,9.2) S X=$S('$D(^LAB(64.061,+$P(DIP(201),U,9),0)):"",1:$P(^(0),U,1)) S D0=I(100,0) S D1=I(101,0) W X K DIP;"";x;Z;".01:.09"~
"KRN",.4,4476,"F",28)
200,-60,100,W:$P(^LAB(60,D0,1,D1,0),U,2)'="" "Reference Low: ",$P(^LAB(60,D0,1,D1,0),U,2),"   ";"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,2)'="" "Reference Low: ",$P(^LAB(60,D0,1,D1,0),U,2),"   ""~
"KRN",.4,4476,"F",29)
200,-60,100,W:$P(^LAB(60,D0,1,D1,0),U,3)'="" "Reference High: ",$P(^LAB(60,D0,1,D1,0),U,3),"   ";"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,3)'="" "Reference High: ",$P(^LAB(60,D0,1,D1,0),U,3),"   ""~
"KRN",.4,4476,"F",30)
200,-60,100,W:$P(^LAB(60,D0,1,D1,0),U,4)'="" "Critical Low: ",$P(^LAB(60,D0,1,D1,0),U,4),"   ";"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,4)'="" "Critical Low: ",$P(^LAB(60,D0,1,D1,0),U,4),"   ""~
"KRN",.4,4476,"F",31)
200,-60,100,W:$P(^LAB(60,D0,1,D1,0),U,5)'="" "Critical High: ",$P(^LAB(60,D0,1,D1,0),U,5),"   ";"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,5)'="" "Critical High: ",$P(^LAB(60,D0,1,D1,0),U,5),"   ""~
"KRN",.4,4476,"F",32)
200,-60,100,X DXS(10,9);"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,11)'="" "Therapeutic Low: ",$P(^LAB(60,D0,1,D1,0),U,11),"   ""~
"KRN",.4,4476,"F",33)
200,-60,100,X DXS(11,9);"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,12)'="" "Therapeutic High: ",$P(^LAB(60,D0,1,D1,0),U,12),"   ""~
"KRN",.4,4476,"F",34)
200,-60,100,W:$P(^LAB(60,D0,1,D1,0),U,7)'="" "Units: ",$P(^LAB(60,D0,1,D1,0),U,7),"   ";"";C17;Z;"W:$P(^LAB(60,D0,1,D1,0),U,7)'="" "Units: ",$P(^LAB(60,D0,1,D1,0),U,7),"   ""~
"KRN",.4,4476,"F",35)
200,-60,100,I +$O(^LAB(60,D0,1,D1,1,0))>0 W "Interpretation:  ";C17;"";Z;"I +$O(^LAB(60,D0,1,D1,1,0))>0 W "Interpretation:  ""~200,-60,100,5.5,.01;"";C20~
"KRN",.4,4476,"F",36)
200,-60,100," ";C1;""~-64,^LAM(^^S I(0,0)=D0 S DIP(1)=$S($D(^LAB(60,D0,64)):^(64),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;"64:"~-64," ";"";C1~
"KRN",.4,4476,"F",37)
-64,S DIP(101)=$S($D(^LAM(D0,0)):^(0),1:"") S X="Default Cost: "_$P(DIP(101),U,10) W X K DIP;C10;"";Z;""Default Cost: "_#7"~
"KRN",.4,4476,"F",38)
-64,S DIP(101)=$S($D(^LAM(D0,0)):^(0),1:"") S X="Default Price: "_$P(DIP(101),U,11) W X K DIP;C40;"";Z;""Default Price: "_#8"~-64,20," ";C1;""~
"KRN",.4,4476,"F",39)
-64,20,S DIP(101)=$S($D(^LAM(D0,5,D1,0)):^(0),1:"") S X="Specimen: "_$S('$D(^LAB(61,+$P(DIP(101),U,1),0)):"",1:$P(^(0),U,1)) W X K DIP;C10;"";Z;""Specimen: "_#.01"~
"KRN",.4,4476,"F",40)
-64,20," ";C1;""~-64,20,X DXS(12,9) W X K DIP;C10;"";Z;""Specimen Cost: "_#1"~
"KRN",.4,4476,"F",41)
-64,20,S DIP(101)=$S($D(^LAM(D0,5,D1,0)):^(0),1:"") S X="Specimen Price: "_$P(DIP(101),U,3) W X K DIP;C40;"";Z;""Specimen Price: "_#2"~" ";C1;""~
"KRN",.4,4476,"H")
Electronic Test Catalog
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)
 
"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
337^3061228^33274
"PKG",26,22,1,"PAH",1,1,0)
^^3^3^3061228
"PKG",26,22,1,"PAH",1,1,1,0)
This patch corrects 2 problems with "DELETE TEST" and a problem
"PKG",26,22,1,"PAH",1,1,2,0)
with exiting the "INTERIM REPORT".  An issue is also addressed with
"PKG",26,22,1,"PAH",1,1,3,0)
"ELECTRONIC CATALOG".
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","LRBEBA5")
0^5^B51178400^B50227072
"RTN","LRBEBA5",1,0)
LRBEBA5 ;DALOI/JAH/FHS - PENDING PANEL ROLLUP TO PCE ;11/26/2005
"RTN","LRBEBA5",2,0)
 ;;5.2;LAB SERVICE;**291,337**;Sep 27, 1994;Build 2
"RTN","LRBEBA5",3,0)
 ;
"RTN","LRBEBA5",4,0)
EN ;Entry point from LRNIGHT
"RTN","LRBEBA5",5,0)
 ;check rollup date
"RTN","LRBEBA5",6,0)
 N LRBEROLL,LRBERLDT,DATX,YY,MM,STARTDT,ENDDT,NEWDT,TOTPAN
"RTN","LRBEBA5",7,0)
 S LRBEROLL=0,LRBERLDT=$P(^LAB(69.9,1,"VSIT"),U,2)
"RTN","LRBEBA5",8,0)
 S YY=$E(LRBERLDT,1,3),MM=+$E(LRBERLDT,4,5)
"RTN","LRBEBA5",9,0)
 S MM=$S(MM=1:12,1:MM-1) S YY=$S(MM=12:YY-1,1:YY) I $L(MM)=1 S MM="0"_MM
"RTN","LRBEBA5",10,0)
 S STARTDT=YY_MM_"01",ENDDT=YY_MM_"31"_".999999"
"RTN","LRBEBA5",11,0)
 S DATX=$O(^LRO(69,"APP",0))
"RTN","LRBEBA5",12,0)
 I DATX<STARTDT S STARTDT=DATX-1
"RTN","LRBEBA5",13,0)
 I LRBERLDT=DT S LRBEROLL=1
"RTN","LRBEBA5",14,0)
 I (LRBERLDT<DT) I DATX<ENDDT S LRBEROLL=1
"RTN","LRBEBA5",15,0)
 I LRBEROLL D
"RTN","LRBEBA5",16,0)
 .K ^TMP("LRROLLUP",$J)
"RTN","LRBEBA5",17,0)
 .S ^TMP("LRROLLUP",$J,0)=$$NOW^XLFDT_"^"
"RTN","LRBEBA5",18,0)
 .D START
"RTN","LRBEBA5",19,0)
 .D NEWDT
"RTN","LRBEBA5",20,0)
 .S ^TMP("LRROLLUP",$J,0)=^TMP("LRROLLUP",$J,0)_$$NOW^XLFDT()
"RTN","LRBEBA5",21,0)
 .D MAILRPT
"RTN","LRBEBA5",22,0)
 Q
"RTN","LRBEBA5",23,0)
 ;
"RTN","LRBEBA5",24,0)
START ;Loop thru pending panel xref in file #69
"RTN","LRBEBA5",25,0)
 N LINE,LRXDT,LRODT,LRSN,LRTN
"RTN","LRBEBA5",26,0)
 S LINE=100,TOTPAN=0
"RTN","LRBEBA5",27,0)
 S LRXDT=STARTDT F  S LRXDT=$O(^LRO(69,"APP",LRXDT)) Q:'LRXDT  Q:LRXDT>ENDDT  D
"RTN","LRBEBA5",28,0)
 .S LRODT=0 F  S LRODT=$O(^LRO(69,"APP",LRXDT,LRODT)) Q:'LRODT  D
"RTN","LRBEBA5",29,0)
 ..S LRSN=0 F  S LRSN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN)) Q:'LRSN  D
"RTN","LRBEBA5",30,0)
 ...S LRTN=0 F  S LRTN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN)) Q:'LRTN  D
"RTN","LRBEBA5",31,0)
 ....D SET
"RTN","LRBEBA5",32,0)
 ....I $D(LRBEY)>1 D BAWRK^LRBEBA(LRODT,LRSN,LRTN,.LRBEY,.LRTEST,"","",LRBEROLL)
"RTN","LRBEBA5",33,0)
 ....I $D(LRBECPT)>1 D SETRPT
"RTN","LRBEBA5",34,0)
 ....D CLEAN
"RTN","LRBEBA5",35,0)
 Q
"RTN","LRBEBA5",36,0)
 ;
"RTN","LRBEBA5",37,0)
SET ;Setup background variables for call to BAWRK^LRBEBA
"RTN","LRBEBA5",38,0)
 N LRBET,LRBEIEN,LRFDA,I,NX,XX
"RTN","LRBEBA5",39,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA5",40,0)
 S LRDFN=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEBA5",41,0)
 S LRORDER=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I")
"RTN","LRBEBA5",42,0)
 S LRBEIEN=LRTN_","_LRSN_","_LRODT_","
"RTN","LRBEBA5",43,0)
 I $$GET1^DIQ(69.03,LRBEIEN,8,"I")="CA" D  Q
"RTN","LRBEBA5",44,0)
 .;clear 'pending panel' xref of not performed panel
"RTN","LRBEBA5",45,0)
 .S LRFDA(1,69.03,LRBEIEN,22.1)=0
"RTN","LRBEBA5",46,0)
 .D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA5",47,0)
 S LRBETST=$$GET1^DIQ(69.03,LRBEIEN,.01,"I")
"RTN","LRBEBA5",48,0)
 I LRBETST="" K ^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN) Q
"RTN","LRBEBA5",49,0)
 S LRAD=+$$GET1^DIQ(69.03,LRBEIEN,2,"I")
"RTN","LRBEBA5",50,0)
 S LRAA=+$$GET1^DIQ(69.03,LRBEIEN,3,"I")
"RTN","LRBEBA5",51,0)
 S LRAN=+$$GET1^DIQ(69.03,LRBEIEN,4,"I")
"RTN","LRBEBA5",52,0)
 S LRUID=$$GET1^DIQ(69.03,LRBEIEN,13,"I")
"RTN","LRBEBA5",53,0)
 S LRBECDT=$$GET1^DIQ(69.03,LRBEIEN,22,"I")
"RTN","LRBEBA5",54,0)
 S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA5",55,0)
 S LRSS=$$GET1^DIQ(68,LRAA,.02,"I")
"RTN","LRBEBA5",56,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBETST,0))="" K ^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN) Q
"RTN","LRBEBA5",57,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRBEBA5",58,0)
 S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LRBEBA5",59,0)
 I I S X=^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0),LRSPEC=$P(X,U,1),LRSAMP=$P(X,U,2)
"RTN","LRBEBA5",60,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEBA5",61,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEBA5",62,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2)
"RTN","LRBEBA5",63,0)
 .;if null XX, possibly another panel
"RTN","LRBEBA5",64,0)
 .I 'XX D ARRS(LRBET,LRBETST) Q
"RTN","LRBEBA5",65,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA5",66,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA5",67,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA5",68,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEBA5",69,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA5",70,0)
 I $D(LRBEY)>1 D
"RTN","LRBEBA5",71,0)
 .S LRTEST(1)=LRBETST_U_^LAB(60,LRBETST,0),LRTEST(1,"P")=LRBETST_U_$$NLT^LRVER1(LRBETST)
"RTN","LRBEBA5",72,0)
 Q
"RTN","LRBEBA5",73,0)
 ;
"RTN","LRBEBA5",74,0)
ARRS(XTEST,PTEST) ;
"RTN","LRBEBA5",75,0)
 N NX,X,XX
"RTN","LRBEBA5",76,0)
 S NX=0 F  S NX=$O(^LAB(60,XTEST,2,NX)) Q:'NX  D
"RTN","LRBEBA5",77,0)
 .S X=+^LAB(60,XTEST,2,NX,0)
"RTN","LRBEBA5",78,0)
 .S XX=$P($P(^LAB(60,X,0),U,5),";",2)
"RTN","LRBEBA5",79,0)
 .Q:'XX
"RTN","LRBEBA5",80,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA5",81,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA5",82,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA5",83,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEBA5",84,0)
 .S LRBEY(PTEST,XX)=""
"RTN","LRBEBA5",85,0)
 Q
"RTN","LRBEBA5",86,0)
 ;
"RTN","LRBEBA5",87,0)
CLEAN ;Clean-up variables
"RTN","LRBEBA5",88,0)
 K DFN,LRBEY,LRTEST,LRSB,LRBECPT,LRDFN,LRBEDFN,LRORDER
"RTN","LRBEBA5",89,0)
 K LRBETST,LRBEVST,LRAA,LRAN,LRAD,LRUID,LRBECDT,LRSS,LRIDT,LRSAMP,LRSPEC
"RTN","LRBEBA5",90,0)
 Q
"RTN","LRBEBA5",91,0)
 ;
"RTN","LRBEBA5",92,0)
SETRPT ;Set veriables into ^TMP( for report
"RTN","LRBEBA5",93,0)
 N SETLN,X,C,N,T,TNM,XCODE,LRPCE,LRBETST,LRBETSTN
"RTN","LRBEBA5",94,0)
 S TOTPAN=TOTPAN+1
"RTN","LRBEBA5",95,0)
 S SETLN="S LINE=LINE+1,^TMP(""LRROLLUP"",$J,LINE,0)=X"
"RTN","LRBEBA5",96,0)
 S LRPCE=$P(^LRO(69,LRODT,1,LRSN,"PCE"),U,1)
"RTN","LRBEBA5",97,0)
 Q:LRPCE=""
"RTN","LRBEBA5",98,0)
 S LRBETST=$P(LRTEST(1),U,1)
"RTN","LRBEBA5",99,0)
 S LRBETSTN=$P(^LAB(60,LRBETST,0),U,1),LRBETSTN="["_LRBETST_"] "_$E(LRBETSTN,1,30)
"RTN","LRBEBA5",100,0)
 S X=$$SETSTR^VALM1(LRORDER,"",1,10),X=$$SETSTR^VALM1(LRUID,X,12,10)
"RTN","LRBEBA5",101,0)
 S X=$$SETSTR^VALM1(LRPCE,X,26,10),X=$$SETSTR^VALM1(LRBETSTN,X,40,38) X SETLN
"RTN","LRBEBA5",102,0)
 S T=0,N=0 F  S T=$O(LRBECPT(T)) Q:'T  D
"RTN","LRBEBA5",103,0)
 . S N=N+1,TNM="["_T_"] "
"RTN","LRBEBA5",104,0)
 . I N=1 S X=$$SETSTR^VALM1("CPT Code(s) passed to PCE:","",12,28)
"RTN","LRBEBA5",105,0)
 . I N>1 S X=""
"RTN","LRBEBA5",106,0)
 . S C=$O(LRBECPT(T,1,0)),XCODE=$P($$CPT^ICPTCOD(C),U,2,3),XCODE=$TR(XCODE,"^"," "),XCODE=$E(XCODE,1,30)
"RTN","LRBEBA5",107,0)
 . S XCODE=TNM_XCODE,X=$$SETSTR^VALM1(XCODE,X,40,38) X SETLN
"RTN","LRBEBA5",108,0)
 S X=" " X SETLN
"RTN","LRBEBA5",109,0)
 Q
"RTN","LRBEBA5",110,0)
 ;
"RTN","LRBEBA5",111,0)
NEWDT ;Set new roll-up date
"RTN","LRBEBA5",112,0)
 N DD,MM,MM2,X1,X,YY
"RTN","LRBEBA5",113,0)
 Q:'$G(LRBERLDT)
"RTN","LRBEBA5",114,0)
 S MM=+$E(LRBERLDT,4,5) S MM2=$S(MM=12:1,1:MM+1) S:$L(MM2)=1 MM2="0"_MM2
"RTN","LRBEBA5",115,0)
 S DD=$E(LRBERLDT,6,7) S YY=$E(LRBERLDT,1,3) S:+MM2=1 YY=YY+1
"RTN","LRBEBA5",116,0)
 S NEWDT=YY_MM2_DD
"RTN","LRBEBA5",117,0)
 S X1=NEWDT,X=+$E(NEWDT,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEBA5",118,0)
 I $E(X1,6,7)'<X S $E(NEWDT,6,7)=X-1
"RTN","LRBEBA5",119,0)
 S $P(^LAB(69.9,1,"VSIT"),U,2)=NEWDT
"RTN","LRBEBA5",120,0)
 Q
"RTN","LRBEBA5",121,0)
 ;
"RTN","LRBEBA5",122,0)
MAILRPT ;Set intro & send rollup report to mail group
"RTN","LRBEBA5",123,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,XMZ,X,X1,Y,SETLN,LINE,DASH
"RTN","LRBEBA5",124,0)
 S ENDDT=$P(ENDDT,".",1),X=ENDDT D
"RTN","LRBEBA5",125,0)
 .S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEBA5",126,0)
 .I $E(X1,6,7)>X S $E(ENDDT,6,7)=X
"RTN","LRBEBA5",127,0)
 S LINE=0,SETLN="S LINE=LINE+1,^TMP(""LRROLLUP"",$J,LINE,0)=X"
"RTN","LRBEBA5",128,0)
 S $P(DASH,"-",78)=""
"RTN","LRBEBA5",129,0)
 S X=" " X SETLN
"RTN","LRBEBA5",130,0)
 S X="Normally, panel tests flagged as 'AMA/Billable' should be reported to PCE" X SETLN
"RTN","LRBEBA5",131,0)
 S X="using the CPT Code of the panel.  In order for the panel CPT Code to be" X SETLN
"RTN","LRBEBA5",132,0)
 S X="sent to PCE, a verified result must be present for each 'required' atomic" X SETLN
"RTN","LRBEBA5",133,0)
 S X="test comprising the panel." X SETLN
"RTN","LRBEBA5",134,0)
 S X=" " X SETLN
"RTN","LRBEBA5",135,0)
 S X="This report provides a listing of AMA/Billable panel tests that were pending" X SETLN
"RTN","LRBEBA5",136,0)
 S X="completion on the Lab Roll-up Date.  The Sample Collection Date for the" X SETLN
"RTN","LRBEBA5",137,0)
 S X="panel test fell within the date range indicated by Start Date and End Date." X SETLN
"RTN","LRBEBA5",138,0)
 S X="One or more of the 'required' atomic tests comprising the panel were still" X SETLN
"RTN","LRBEBA5",139,0)
 S X="pending on the Lab Roll-up Date.  Therefore, those atomic tests that had" X SETLN
"RTN","LRBEBA5",140,0)
 S X="been verified have now been sent to PCE.  If other atomic tests from the" X SETLN
"RTN","LRBEBA5",141,0)
 S X="panels listed are verified later, each will be sent to PCE using the CPT" X SETLN
"RTN","LRBEBA5",142,0)
 S X="Code for the atomic test." X SETLN
"RTN","LRBEBA5",143,0)
 S X=" " X SETLN
"RTN","LRBEBA5",144,0)
 S X=" " X SETLN
"RTN","LRBEBA5",145,0)
 S Y=LRBERLDT D DD^%DT S LRBERLDT=Y
"RTN","LRBEBA5",146,0)
 S X="Lab Roll-up Date         : "_LRBERLDT X SETLN
"RTN","LRBEBA5",147,0)
 S Y=NEWDT D DD^%DT S NEWDT=Y
"RTN","LRBEBA5",148,0)
 S X="Next Lab Roll-up Date    : "_NEWDT X SETLN
"RTN","LRBEBA5",149,0)
 S Y=STARTDT D DD^%DT S STARTDT=Y
"RTN","LRBEBA5",150,0)
 S X="Start Date               : "_STARTDT X SETLN
"RTN","LRBEBA5",151,0)
 S Y=ENDDT D DD^%DT S ENDDT=Y
"RTN","LRBEBA5",152,0)
 S X="End Date                 : "_ENDDT X SETLN
"RTN","LRBEBA5",153,0)
 S X="Total # Panels           : "_TOTPAN X SETLN
"RTN","LRBEBA5",154,0)
 S X=" " X SETLN
"RTN","LRBEBA5",155,0)
 S X=" " X SETLN
"RTN","LRBEBA5",156,0)
 S X=$$SETSTR^VALM1("Unique","",12,10),X=$$SETSTR^VALM1("PCE",X,26,10) X SETLN
"RTN","LRBEBA5",157,0)
 S X=$$SETSTR^VALM1("Order #","",1,10),X=$$SETSTR^VALM1("Identifier",X,12,10),X=$$SETSTR^VALM1("Encounter",X,26,10)
"RTN","LRBEBA5",158,0)
 S X=$$SETSTR^VALM1("Panel Test",X,40,38) X SETLN
"RTN","LRBEBA5",159,0)
 S X=$$SETSTR^VALM1(DASH,"",1,78) X SETLN
"RTN","LRBEBA5",160,0)
 S Y=DT D DD^%DT S XMSUB="Report on Roll-up to PCE for "_Y
"RTN","LRBEBA5",161,0)
 S XMDUZ=.5
"RTN","LRBEBA5",162,0)
 S XMY("G.LMI")=""
"RTN","LRBEBA5",163,0)
 S XMTEXT="^TMP(""LRROLLUP"",$J,"
"RTN","LRBEBA5",164,0)
 D ^XMD
"RTN","LRBEBA5",165,0)
 K ^TMP("LRROLLUP",$J)
"RTN","LRBEBA5",166,0)
 Q
"RTN","LRBEPEND")
0^4^B48206085^B47036238
"RTN","LRBEPEND",1,0)
LRBEPEND ;DALOI/JAH/FHS - PENDING PANEL REPORT ;11/26/2005
"RTN","LRBEPEND",2,0)
 ;;5.2;LAB SERVICE;**291,337**;Sep 27, 1994;Build 2
"RTN","LRBEPEND",3,0)
 ;
"RTN","LRBEPEND",4,0)
EN ;Entry point from menu option LRBE PENDREP
"RTN","LRBEPEND",5,0)
 N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LRBEPEND",6,0)
 S ZTRTN="TASK^LRBEPEND"
"RTN","LRBEPEND",7,0)
 S ZTDESC="Lab Report on Pending AMA/Billable Panels"
"RTN","LRBEPEND",8,0)
 S ZTIO=""
"RTN","LRBEPEND",9,0)
 S ZTSAVE("DUZ")=""
"RTN","LRBEPEND",10,0)
 W !!,"This report option must be queued via TaskManager."
"RTN","LRBEPEND",11,0)
 W !,"The report will be sent to you as a MailMan message.",!
"RTN","LRBEPEND",12,0)
 D ^%ZTLOAD
"RTN","LRBEPEND",13,0)
 I $G(ZTSK) D
"RTN","LRBEPEND",14,0)
 .W !,"Report queued as Task #: ",ZTSK
"RTN","LRBEPEND",15,0)
 W !
"RTN","LRBEPEND",16,0)
 Q
"RTN","LRBEPEND",17,0)
 ;
"RTN","LRBEPEND",18,0)
TASK ;Entry point from Taskmgr
"RTN","LRBEPEND",19,0)
 N LRBERLDT,DATX,YY,MM,STARTDT,ENDDT,TOTPAN
"RTN","LRBEPEND",20,0)
 K ^TMP("LRPENDING",$J)
"RTN","LRBEPEND",21,0)
 S ^TMP("LRPENDING",$J,0)=$$NOW^XLFDT_"^"
"RTN","LRBEPEND",22,0)
 S LRBERLDT=$P(^LAB(69.9,1,"VSIT"),U,2)
"RTN","LRBEPEND",23,0)
 I 'LRBERLDT S (STARTDT,ENDDT)=""
"RTN","LRBEPEND",24,0)
 I LRBERLDT D
"RTN","LRBEPEND",25,0)
 .S YY=$E(LRBERLDT,1,3),MM=+$E(LRBERLDT,4,5)
"RTN","LRBEPEND",26,0)
 .S MM=$S(MM=1:12,1:MM-1) S YY=$S(MM=12:YY-1,1:YY) I $L(MM)=1 S MM="0"_MM
"RTN","LRBEPEND",27,0)
 .S STARTDT=YY_MM_"01",ENDDT=YY_MM_"31"_".999999"
"RTN","LRBEPEND",28,0)
 .S DATX=$O(^LRO(69,"APP",0))
"RTN","LRBEPEND",29,0)
 .I DATX,DATX<STARTDT S STARTDT=DATX
"RTN","LRBEPEND",30,0)
 .D START
"RTN","LRBEPEND",31,0)
 S ^TMP("LRPENDING",$J,0)=^TMP("LRPENDING",$J,0)_$$NOW^XLFDT()
"RTN","LRBEPEND",32,0)
 D MAILRPT
"RTN","LRBEPEND",33,0)
 Q
"RTN","LRBEPEND",34,0)
 ;
"RTN","LRBEPEND",35,0)
START ;Loop thru pending panel xref in file #69
"RTN","LRBEPEND",36,0)
 N LINE,LRXDT,LRODT,LRSN,LRTN
"RTN","LRBEPEND",37,0)
 S LINE=100,TOTPAN=0
"RTN","LRBEPEND",38,0)
 S LRXDT=STARTDT-1 F  S LRXDT=$O(^LRO(69,"APP",LRXDT)) Q:'LRXDT  Q:LRXDT>ENDDT  D
"RTN","LRBEPEND",39,0)
 .S LRODT=0 F  S LRODT=$O(^LRO(69,"APP",LRXDT,LRODT)) Q:'LRODT  D
"RTN","LRBEPEND",40,0)
 ..S LRSN=0 F  S LRSN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN)) Q:'LRSN  D
"RTN","LRBEPEND",41,0)
 ...S LRTN=0 F  S LRTN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN)) Q:'LRTN  D
"RTN","LRBEPEND",42,0)
 ....D SET
"RTN","LRBEPEND",43,0)
 ....I $D(LRBEY)>1 D SETRPT
"RTN","LRBEPEND",44,0)
 ....D CLEAN
"RTN","LRBEPEND",45,0)
 Q
"RTN","LRBEPEND",46,0)
 ;
"RTN","LRBEPEND",47,0)
SET ;Setup background variables for call to BAWRK^LRBEBA
"RTN","LRBEPEND",48,0)
 N I,LRBET,LRBEIEN,NX,XX
"RTN","LRBEPEND",49,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEPEND",50,0)
 S LRDFN=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEPEND",51,0)
 S LRORDER=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I")
"RTN","LRBEPEND",52,0)
 S LRBEIEN=LRTN_","_LRSN_","_LRODT_","
"RTN","LRBEPEND",53,0)
 S LRBETST=$$GET1^DIQ(69.03,LRBEIEN,.01,"I")
"RTN","LRBEPEND",54,0)
 I LRBETST="" K ^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN) Q
"RTN","LRBEPEND",55,0)
 S LRAD=+$$GET1^DIQ(69.03,LRBEIEN,2,"I")
"RTN","LRBEPEND",56,0)
 S LRAA=+$$GET1^DIQ(69.03,LRBEIEN,3,"I")
"RTN","LRBEPEND",57,0)
 S LRAN=+$$GET1^DIQ(69.03,LRBEIEN,4,"I")
"RTN","LRBEPEND",58,0)
 S LRUID=$$GET1^DIQ(69.03,LRBEIEN,13,"I")
"RTN","LRBEPEND",59,0)
 S LRBECDT=$$GET1^DIQ(69.03,LRBEIEN,22,"I")
"RTN","LRBEPEND",60,0)
 S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEPEND",61,0)
 S LRSS=$$GET1^DIQ(68,LRAA,.02,"I")
"RTN","LRBEPEND",62,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBETST,0))="" K ^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN) Q
"RTN","LRBEPEND",63,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRBEPEND",64,0)
 S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LRBEPEND",65,0)
 I I S X=^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0),LRSPEC=$P(X,U,1),LRSAMP=$P(X,U,2)
"RTN","LRBEPEND",66,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEPEND",67,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEPEND",68,0)
 .Q:('$P(^LAB(60,LRBET,0),U,17))
"RTN","LRBEPEND",69,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2)
"RTN","LRBEPEND",70,0)
 .;if null XX, possibly another panel
"RTN","LRBEPEND",71,0)
 .I 'XX D ARRS^LRBEBA5(LRBET,LRBETST) Q
"RTN","LRBEPEND",72,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEPEND",73,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEPEND",74,0)
 .I $P(LRSB(XX),U,1)["canc" K LRSB(XX) Q
"RTN","LRBEPEND",75,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEPEND",76,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEPEND",77,0)
 I $D(LRBEY)>1 D
"RTN","LRBEPEND",78,0)
 .S LRTEST(1)=LRBETST_U_^LAB(60,LRBETST,0),LRTEST(1,"P")=LRBETST_U_$$NLT^LRVER1(LRBETST)
"RTN","LRBEPEND",79,0)
 Q
"RTN","LRBEPEND",80,0)
 ;
"RTN","LRBEPEND",81,0)
CLEAN ;Clean-up variables
"RTN","LRBEPEND",82,0)
 K LRBEY,LRTEST,LRSB,LRBECPT,LRDFN,LRBEDFN,LRORDER
"RTN","LRBEPEND",83,0)
 K LRBETST,LRBEVST,LRAA,LRAN,LRAD,LRUID,LRBECDT,LRSS,LRIDT,LRSAMP,LRSPEC
"RTN","LRBEPEND",84,0)
 Q
"RTN","LRBEPEND",85,0)
 ;
"RTN","LRBEPEND",86,0)
SETRPT ;Set veriables into ^TMP( for report
"RTN","LRBEPEND",87,0)
 N SETLN,X,C,CX,PATNM,XCODE,LRBETST,LRBETSTN
"RTN","LRBEPEND",88,0)
 S TOTPAN=TOTPAN+1
"RTN","LRBEPEND",89,0)
 S SETLN="S LINE=LINE+1,^TMP(""LRPENDING"",$J,LINE,0)=X"
"RTN","LRBEPEND",90,0)
 S X=$P(^DPT(LRBEDFN,0),U,1,9),PATNM=$E($P(X,U,1),1,20)_" ("_$E($P(X,U,9),6,9)_")"
"RTN","LRBEPEND",91,0)
 S LRBETST=$P(LRTEST(1),U,1)
"RTN","LRBEPEND",92,0)
 S LRBETSTN=$P(^LAB(60,LRBETST,0),U,1),LRBETSTN="["_LRBETST_"] "_$E(LRBETSTN,1,26)
"RTN","LRBEPEND",93,0)
 S:$G(LRBECDT)="" LRBECDT=DT D PANEL^LRBEBA4
"RTN","LRBEPEND",94,0)
 S X=$$SETSTR^VALM1(LRUID,"",1,10)
"RTN","LRBEPEND",95,0)
 S X=$$SETSTR^VALM1(PATNM,X,14,28),X=$$SETSTR^VALM1(LRBETSTN,X,44,34) X SETLN
"RTN","LRBEPEND",96,0)
 S C=$O(LRBECPT(LRBETST,1,0))
"RTN","LRBEPEND",97,0)
 I C D
"RTN","LRBEPEND",98,0)
 . S XCODE=$P($$CPT^ICPTCOD(C),U,2,3),XCODE=$TR(XCODE,"^"," "),XCODE=$E(XCODE,1,30)
"RTN","LRBEPEND",99,0)
 . S X=$$SETSTR^VALM1("Panel CPT Code:","",14,16),X=$$SETSTR^VALM1(XCODE,X,32,40) X SETLN
"RTN","LRBEPEND",100,0)
 . S CX=LRBECPT(LRBETST,1,C),X=$$SETSTR^VALM1(CX,"",32,40) X SETLN
"RTN","LRBEPEND",101,0)
 I 'C D
"RTN","LRBEPEND",102,0)
 . S X=$$SETSTR^VALM1("Panel CPT Code:","",14,16),X=$$SETSTR^VALM1("<No active CPT available>",X,32,40) X SETLN
"RTN","LRBEPEND",103,0)
 S X=" " X SETLN
"RTN","LRBEPEND",104,0)
 Q
"RTN","LRBEPEND",105,0)
 ;
"RTN","LRBEPEND",106,0)
MAILRPT ;Set intro & send pending panel report to user
"RTN","LRBEPEND",107,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,XMZ,X,X1,Y,SETLN,LINE,DASH,REPDT
"RTN","LRBEPEND",108,0)
 S STARTDT=$P(STARTDT,".",1)
"RTN","LRBEPEND",109,0)
 I ENDDT S ENDDT=$P(ENDDT,".",1),X=ENDDT D
"RTN","LRBEPEND",110,0)
 .S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEPEND",111,0)
 .I $E(X1,6,7)>X S $E(ENDDT,6,7)=X
"RTN","LRBEPEND",112,0)
 S LINE=0,SETLN="S LINE=LINE+1,^TMP(""LRPENDING"",$J,LINE,0)=X"
"RTN","LRBEPEND",113,0)
 S $P(DASH,"-",78)=""
"RTN","LRBEPEND",114,0)
 S X=" " X SETLN
"RTN","LRBEPEND",115,0)
 S X="This report provides a listing of AMA/Billable panel tests that are pending" X SETLN
"RTN","LRBEPEND",116,0)
 S X="completion as of the Report Date/Time.  The Sample Collection Date for the" X SETLN
"RTN","LRBEPEND",117,0)
 S X="panel test falls within the date range indicated by Start Date and End Date." X SETLN
"RTN","LRBEPEND",118,0)
 S X="One or more of the 'required' atomic tests comprising the panel do not yet" X SETLN
"RTN","LRBEPEND",119,0)
 S X="have a verified result." X SETLN
"RTN","LRBEPEND",120,0)
 S X=" " X SETLN
"RTN","LRBEPEND",121,0)
 S X="Normally, panel tests flagged as 'AMA/Billable' should be reported to PCE" X SETLN
"RTN","LRBEPEND",122,0)
 S X="using the CPT Code of the panel.  In order for the panel CPT Code to be" X SETLN
"RTN","LRBEPEND",123,0)
 S X="sent to PCE, a verified result must be present for each 'required' atomic" X SETLN
"RTN","LRBEPEND",124,0)
 S X="test comprising the panel.  If all required atomic tests have not been" X SETLN
"RTN","LRBEPEND",125,0)
 S X="verified by the Next Lab Roll-up Date, then the CPT Codes for the individual" X SETLN
"RTN","LRBEPEND",126,0)
 S X="atomic tests will be sent to PCE." X SETLN
"RTN","LRBEPEND",127,0)
 S X=" " X SETLN
"RTN","LRBEPEND",128,0)
 S X="Note: This report may not show any panels if it is run after the roll-up to" X SETLN
"RTN","LRBEPEND",129,0)
 S X="PCE but before the end of the month. Please consult the Roll-up to PCE Report" X SETLN
"RTN","LRBEPEND",130,0)
 S X="sent to G.LIM for information on unbundled panels not reported here." X SETLN
"RTN","LRBEPEND",131,0)
 S X=" " X SETLN
"RTN","LRBEPEND",132,0)
 S X=" " X SETLN
"RTN","LRBEPEND",133,0)
 S Y=$$NOW^XLFDT() D DD^%DT S REPDT=Y
"RTN","LRBEPEND",134,0)
 S X="Report Date/Time         : "_REPDT X SETLN
"RTN","LRBEPEND",135,0)
 I LRBERLDT S Y=LRBERLDT D DD^%DT S LRBERLDT=Y
"RTN","LRBEPEND",136,0)
 S X="Next Lab Roll-up Date    : "_LRBERLDT X SETLN
"RTN","LRBEPEND",137,0)
 I STARTDT S Y=STARTDT D DD^%DT S STARTDT=Y
"RTN","LRBEPEND",138,0)
 S X="Start Date               : "_STARTDT X SETLN
"RTN","LRBEPEND",139,0)
 I ENDDT S Y=ENDDT D DD^%DT S ENDDT=Y
"RTN","LRBEPEND",140,0)
 S X="End Date                 : "_ENDDT X SETLN
"RTN","LRBEPEND",141,0)
 S X="Total # Panels           : "_$G(TOTPAN) X SETLN
"RTN","LRBEPEND",142,0)
 S X=" " X SETLN
"RTN","LRBEPEND",143,0)
 S X=" " X SETLN
"RTN","LRBEPEND",144,0)
 S X=$$SETSTR^VALM1("Unique","",1,10) X SETLN
"RTN","LRBEPEND",145,0)
 S X=$$SETSTR^VALM1("Identifier",X,1,10),X=$$SETSTR^VALM1("Patient",X,14,28)
"RTN","LRBEPEND",146,0)
 S X=$$SETSTR^VALM1("Panel Test",X,44,34) X SETLN
"RTN","LRBEPEND",147,0)
 S X=$$SETSTR^VALM1(DASH,"",1,78) X SETLN
"RTN","LRBEPEND",148,0)
 S XMSUB="AMA/Billable Panel Pending List "_REPDT
"RTN","LRBEPEND",149,0)
 S XMDUZ=.5
"RTN","LRBEPEND",150,0)
 S XMY(DUZ)=""
"RTN","LRBEPEND",151,0)
 S XMTEXT="^TMP(""LRPENDING"",$J,"
"RTN","LRBEPEND",152,0)
 D ^XMD
"RTN","LRBEPEND",153,0)
 K ^TMP("LRPENDING",$J)
"RTN","LRBEPEND",154,0)
 Q
"RTN","LRRS")
0^3^B17887705^B16871357
"RTN","LRRS",1,0)
LRRS ;SLC/DCM/BA/DALOI/FHS - INTERIM REPORT BY LOCATION (MANUAL QUEUE) ;2/19/91  11:39
"RTN","LRRS",2,0)
 ;;5.2;LAB SERVICE;**283,337**;Sep 27, 1994;Build 2
"RTN","LRRS",3,0)
 ;from option LRRS
"RTN","LRRS",4,0)
BEGIN D:'$D(LRPARAM) ^LRPARAM G:$G(LREND) ^LRRK Q:$G(LREND)  S:'$D(LRSINGLE) LRSINGLE=0 S:'$D(LRPRTPG) LRPRTPG=0 D LOC
"RTN","LRRS",5,0)
END D ^LRRK
"RTN","LRRS",6,0)
 Q
"RTN","LRRS",7,0)
CUM ;ENTRY POINT FOR CUMULATIVE OPTION LRAC LOC-LOC
"RTN","LRRS",8,0)
 S LRPRTPG=1
"RTN","LRRS",9,0)
 D BEGIN
"RTN","LRRS",10,0)
 Q
"RTN","LRRS",11,0)
LOC K LRLLOC
"RTN","LRRS",12,0)
 S (LREND,LRSTOP)=0,(LRONETST,LRONESPC,LRLLOC,LRFLOC)="",LRELOC="ZZZZZZZZ",LRLAB=$S($D(LRLABKY):1,1:0) K DIC
"RTN","LRRS",13,0)
 K %DT S %DT("A")="DAILY REPORT FOR DAY: ",%DT="EQ" D DATE^LRWU Q:Y<1  K %DT S LRODT=Y,LRSDT=LRODT+.5,LREDT=9999999-LRODT
"RTN","LRRS",14,0)
 I $O(^LRO(69,LRODT,1,"AL",0))="" W !!?10,"No Reports for [ ",$$DTF^LRAFUNC1(LRODT),"] ",!! Q
"RTN","LRRS",15,0)
 I 'LRSINGLE F  R !,"Do you want (A)ll locations, a (R)ange of locations,",!,"or (S)elected locations?  S// ",X:DTIME S:X="" X="S" Q:$L(X)=1&("ARS^"[X)  W !,"Enter 'A', 'R', 'S' or '^' to exit"
"RTN","LRRS",16,0)
 I 'LRSINGLE Q:X[U  S LRLOC=X
"RTN","LRRS",17,0)
ASKPG I 'LRPRTPG D
"RTN","LRRS",18,0)
 .S DIR(0)="Y",DIR("A")="Print address page",DIR("B")="NO"
"RTN","LRRS",19,0)
 .D ^DIR K DIR
"RTN","LRRS",20,0)
 .I Y S LRPRTPG=1
"RTN","LRRS",21,0)
 D @$S(LRLOC="S":"SELECT",LRLOC="R":"RANGE",1:"QUE")
"RTN","LRRS",22,0)
 Q
"RTN","LRRS",23,0)
SELECT N LRLOCX,DIC,LRCNT
"RTN","LRRS",24,0)
 W !! D AL
"RTN","LRRS",25,0)
 Q:$G(LREND)
"RTN","LRRS",26,0)
 I $O(LRLLOC(0))="" W !!?7,"NOTHING SELECTED ",! Q
"RTN","LRRS",27,0)
 D QUE
"RTN","LRRS",28,0)
 Q
"RTN","LRRS",29,0)
AL ;
"RTN","LRRS",30,0)
 S (LRCNT,LRLOCX,LREND)=""
"RTN","LRRS",31,0)
 F  S LRLOCX=$O(^LRO(69,LRODT,1,"AL",LRLOCX)) Q:LRLOCX=""  S LRCNT=LRCNT+1,LRLOCX(LRLOCX)=""
"RTN","LRRS",32,0)
 I 'LRCNT W !,"No Reports for ",$$DTF^LRAFUNC1(LRODT),! Q
"RTN","LRRS",33,0)
 S DIC=44,DIC("S")="I $L($P(^(0),U,2)),$D(LRLOCX($P(^(0),U,2)))",DIC(0)="QEZNM"
"RTN","LRRS",34,0)
AL0 R !,"Select Report Location: ",X:DTIME S:'$T!($E(X)="^") LREND=1 Q:X=""
"RTN","LRRS",35,0)
 Q:$G(LREND)
"RTN","LRRS",36,0)
 I $D(LRLOCX(X)) S LRLLOC(X)="" G AL0
"RTN","LRRS",37,0)
SELLOC D ^DIC G:Y<1 AL0
"RTN","LRRS",38,0)
 S Y1=$P(Y(0),U,2)
"RTN","LRRS",39,0)
 S:$D(LRLOCX(Y1)) LRLLOC(Y1)=""
"RTN","LRRS",40,0)
 Q:$D(DUOUT)
"RTN","LRRS",41,0)
 K DIC
"RTN","LRRS",42,0)
 G AL0
"RTN","LRRS",43,0)
 Q
"RTN","LRRS",44,0)
DIS ;
"RTN","LRRS",45,0)
 N I
"RTN","LRRS",46,0)
 F I=1:1:LRCNT W !,I,?4,LRLOCX(I) S I=I+1 Q:I>LRCNT  W:$D(LRLOCX(I)) ?39," ",I,?44,LRLOCX(I)
"RTN","LRRS",47,0)
 W ! Q
"RTN","LRRS",48,0)
 Q
"RTN","LRRS",49,0)
RANGE W !,"Select STARTING PATIENT LOCATION: " R X:DTIME S:X="" X="^"
"RTN","LRRS",50,0)
 I X["?" W !,"Enter the first patient location (abbreviation) that you want." G RANGE
"RTN","LRRS",51,0)
 S:X="ALL"!(X="all") X="" S LRLLOC=X S LRFLOC=$S(LRLLOC="^":"",1:$E(LRLLOC,1,$L(LRLLOC)-1)_$C($A($E(LRLLOC,$L(LRLLOC)))-1))
"RTN","LRRS",52,0)
RANGE2 W !,"Select ENDING LOCATION: " R X:DTIME S:X="" X="^"
"RTN","LRRS",53,0)
 I X["?" W !,"Enter the last patient location (abbreviation) that you want." G RANGE2
"RTN","LRRS",54,0)
 S:X="ALL"!(X="all") X="" S LRLLOC=X Q:LRLLOC="^"  S LRELOC=$E(LRLLOC,1,15)
"RTN","LRRS",55,0)
QUE S %ZIS="MQ",ZTRTN="DQ^LRRS" D IO^LRWU
"RTN","LRRS",56,0)
 Q
"RTN","LRRS",57,0)
DQ ;dequeued
"RTN","LRRS",58,0)
 S:$D(ZTQUEUED) ZTREQ="@" U IO D @$S(LRLOC="S":"SEL",1:"RNG")
"RTN","LRRS",59,0)
 Q
"RTN","LRRS",60,0)
SEL ;
"RTN","LRRS",61,0)
 S LRLLOC="",LRJ0=1
"RTN","LRRS",62,0)
 F  S LRLLOC=$O(LRLLOC(LRLLOC)) Q:LRLLOC=""  W:'LRJ0 @IOF S LRLTR=LRLLOC D:$E(IOST,1,2)'="C-" ^LRLTR D LNAME S LRJ0=0 Q:LREND
"RTN","LRRS",63,0)
 W @IOF
"RTN","LRRS",64,0)
 Q
"RTN","LRRS",65,0)
RNG ;
"RTN","LRRS",66,0)
 S LRJ0=1
"RTN","LRRS",67,0)
 F  S LRLLOC=$O(^LRO(69,LRODT,1,"AL",LRFLOC)) Q:LREND!(LRLLOC="")!(LRLLOC]LRELOC)  D
"RTN","LRRS",68,0)
 .S LRFLOC=LRLLOC
"RTN","LRRS",69,0)
 .W:'LRJ0 @IOF
"RTN","LRRS",70,0)
 .S LRLTR=$S(LRLLOC="":"UNK",1:LRLLOC)
"RTN","LRRS",71,0)
 .D:$E(IOST,1,2)'="C-" ^LRLTR
"RTN","LRRS",72,0)
 .D LNAME
"RTN","LRRS",73,0)
 .Q:LREND
"RTN","LRRS",74,0)
 W @IOF
"RTN","LRRS",75,0)
 Q
"RTN","LRRS",76,0)
LNAME S LRNAME="" F  S LRNAME=$O(^LRO(69,LRODT,1,"AL",LRLLOC,LRNAME)) Q:LRNAME=""  D PAT Q:LREND
"RTN","LRRS",77,0)
 Q
"RTN","LRRS",78,0)
PAT S LRDFN=0 F  S LRDFN=+$O(^LRO(69,LRODT,1,"AL",LRLLOC,LRNAME,LRDFN)) Q:LRDFN<1  S LRIDT=9999999-LRSDT D DS^LRRP2 S:LRSTOP LREND=1 Q:LREND
"RTN","LRRS",79,0)
 S LRJ0=0
"RTN","LRRS",80,0)
 Q
"RTN","LRRS",81,0)
CUMSGLE ;ENTRY POINT FOR OPTION LRAC LOC
"RTN","LRRS",82,0)
 S LRPRTPG=1
"RTN","LRRS",83,0)
SINGLE ;from option LRRS BY LOC
"RTN","LRRS",84,0)
 S LRSINGLE=1,LRLOC="S" D BEGIN
"RTN","LRRS",85,0)
 Q
"RTN","LRRS",86,0)
SHOW ;Display possible choices of locations
"RTN","LRRS",87,0)
 W !?10,"Select from: " S I="",LREND=0 F A=0:0 S I=$O(^LRO(69,LRODT,1,"AL",I)) Q:I=""  D:$Y>(IOSL-4) WAIT Q:LREND  W ?25,I,!
"RTN","LRRS",88,0)
 K A S (LROK,LREND)=0 W ! Q
"RTN","LRRS",89,0)
WAIT R !!?10,"Press RETURN to continue or '^' to exit: ",X:DTIME S:'$T!($E(X)="^") LREND=1 Q:LREND
"RTN","LRRS",90,0)
 W @IOF,!!?10,"Select from: " Q
"RTN","LRTSTJAN")
0^2^B13864468^B12293894
"RTN","LRTSTJAN",1,0)
LRTSTJAN ;SLC/RWF,DCN-JAM TESTS ONTO (OR OFF) ACCESSIONS PART2 ;8/11/97
"RTN","LRTSTJAN",2,0)
 ;;5.2;LAB SERVICE;**67,100,121,128,202,221,337**;Sep 27, 1994;Build 2
"RTN","LRTSTJAN",3,0)
DELOG ;This tag is no longer available - Routine LRTSTOUT replaces this call.
"RTN","LRTSTJAN",4,0)
 W @IOF,!,$$CJ^XLFSTR(" The ability to DELETE an entire ORDER/ACCESSION ",80)
"RTN","LRTSTJAN",5,0)
 W $$CJ^XLFSTR("has been REPLACED. The test(s) will now be marked",80)
"RTN","LRTSTJAN",6,0)
 W $$CJ^XLFSTR("as Not Performed and a reason for 'NP' will be stored",80)
"RTN","LRTSTJAN",7,0)
 W $$CJ^XLFSTR("with each test. Accession numbers can't be reused",80)
"RTN","LRTSTJAN",8,0)
 W $$CJ^XLFSTR("after it has been assigned to a specimen.",80)
"RTN","LRTSTJAN",9,0)
EN D ^LRPARAM G:$G(LREND) END
"RTN","LRTSTJAN",10,0)
 I '$D(LRLABKY) W !?5,"You are not authorized to change test status.",! G END
"RTN","LRTSTJAN",11,0)
 K LRSCNXB
"RTN","LRTSTJAN",12,0)
EN1 ;
"RTN","LRTSTJAN",13,0)
 N LRTOTL,LRIFN
"RTN","LRTSTJAN",14,0)
 S (LREND,LRNOP)=0 K LRNATURE
"RTN","LRTSTJAN",15,0)
 D FIX^LRTSTOUT G END:$G(LREND) I $G(LRNOP) D END G EN1
"RTN","LRTSTJAN",16,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="  Change Entire accession to Not Perform !! ",DIR("B")="NO" D ^DIR K DIR
"RTN","LRTSTJAN",17,0)
 I $D(DIRUT) G EN1
"RTN","LRTSTJAN",18,0)
 S LRTOTL=Y,LRIFN=0
"RTN","LRTSTJAN",19,0)
 I LRTOTL>0 D
"RTN","LRTSTJAN",20,0)
 .F  S LRIFN=$O(^LR(LRDFN,LRSS,LRIDT,LRIFN)) Q:LRIFN=""  S:$P($G(^LR(LRDFN,LRSS,LRIDT,LRIFN)),U)="pending" $P(^LR(LRDFN,LRSS,LRIDT,LRIFN),U)=""
"RTN","LRTSTJAN",21,0)
 ;I Y=0 D CHG^LRTSTOUT W !!! G EN1
"RTN","LRTSTJAN",22,0)
 I LRTOTL=0 D CHG^LRTSTOUT W !!! G EN1
"RTN","LRTSTJAN",23,0)
 D FX2^LRTSTOUT I $G(LREND) D END W @IOF G EN1
"RTN","LRTSTJAN",24,0)
 D
"RTN","LRTSTJAN",25,0)
 . N LRTSTS
"RTN","LRTSTJAN",26,0)
 . S LRTSTS=0,LRNOW=$$NOW^XLFDT F  S LRTSTS=+$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTSTS)) Q:LRTSTS<1  I $D(^(LRTSTS,0))#2,'$P(^(0),U,5) D
"RTN","LRTSTJAN",27,0)
 . . I $D(^LAB(60,LRTSTS,0)) S LRTNM=$P(^(0),U) D SET^LRTSTOUT
"RTN","LRTSTJAN",28,0)
 L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRTSTJAN",29,0)
 I $L($G(LRSS)) L -^LR(+$G(LRDFN),LRSS,+$G(LRIDT))
"RTN","LRTSTJAN",30,0)
 W @IOF,!!,"All accessioned test(s) changed",!!
"RTN","LRTSTJAN",31,0)
 D END G EN1
"RTN","LRTSTJAN",32,0)
 Q
"RTN","LRTSTJAN",33,0)
END K LRWRD,LRWDT1,LRTREA,LRRB,LRPRAC,LREND,LRAA,LRAD,LRAN,LRACC,LRTEST,LRTSTN,LRNATURE,LRX,LRIDIV,LRSAMP,LRGCOM,LRCOM,LRTCOM,LRDFN,LRDPF,LRACD,LRACN,LRACN0,LRDOC,LRLL,LROD0,LROD1,LROD3,LRODT,LROOS,LROS,LROSD,LROT,LRROD,LRSN,LRTSTS,LRTT,LRWL1
"RTN","LRTSTJAN",34,0)
 K LRF,LRI,LRJ,LRMSTATI
"RTN","LRTSTJAN",35,0)
 K I,X,X1,X2,X3,X4,DA,DR,DIC,DFN,AGE,DOB,PNM,SSN,VAIN,VADM,VAERR,VA,VA200,SSN,SEX
"RTN","LRTSTJAN",36,0)
 D END^LRTSTOUT
"RTN","LRTSTJAN",37,0)
 Q
"RTN","LRTSTJAN",38,0)
ULK ;Unlock ^LRO(68,
"RTN","LRTSTJAN",39,0)
 I ($G(LRAA)&($G(LRAD))&($G(LRAN))) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRTSTJAN",40,0)
 Q
"RTN","LRTSTJAN",41,0)
NEWSTART ;Set new starting accession #
"RTN","LRTSTJAN",42,0)
 N LRAA,LRAD,LRAN,LRIDIV,LRX,LRACC,LREND,LRNEW
"RTN","LRTSTJAN",43,0)
 S LREND=0
"RTN","LRTSTJAN",44,0)
 D ^LRWU4 Q:LRAD<1
"RTN","LRTSTJAN",45,0)
N1 G NEWSTART:'$D(^LRO(68,LRAA,1,LRAD,1,0))
"RTN","LRTSTJAN",46,0)
 R !,"""Next"" accession number: ",LRNEW:DTIME
"RTN","LRTSTJAN",47,0)
 G NEWSTART:LRNEW="^"!(LRNEW="")
"RTN","LRTSTJAN",48,0)
 K:(LRNEW<1)!(LRNEW>999999)!(LRNEW'=+LRNEW) LRNEW S:$D(LRNEW) LRNEW=LRNEW-1
"RTN","LRTSTJAN",49,0)
 I '$D(LRNEW) W !,"Must be whole number between 1 and 999999, accession remains unchanged." G N1
"RTN","LRTSTJAN",50,0)
 S $P(^LRO(68,LRAA,1,LRAD,1,0),U,3)=LRNEW
"RTN","LRTSTJAN",51,0)
 G NEWSTART
"RTN","LRTSTJAN",52,0)
US ;ck if units selected
"RTN","LRTSTJAN",53,0)
 S A=0 F  S A=$O(^LR(LRDFN,1.8,A)) Q:A<1!($D(C))  S B=0 F  S B=$O(^LR(LRDFN,1.8,A,1,B)) Q:B<1!($D(C))  I $P(^(B,0),"^",2)=LRIDT S C=1 Q
"RTN","LRTSTJAN",54,0)
 Q
"RTN","LRTSTJAN",55,0)
OE ;
"RTN","LRTSTJAN",56,0)
 I $$VER^LR7OU1<3 S ORIFN=$P(LRTS,"^",7) I ORIFN D DC^LRCENDE1
"RTN","LRTSTJAN",57,0)
 I $L($G(LRGCOM)),$L($P($G(LRNATURE),"^",5)),$P(LRNATURE,"^",5)'["=>" S $P(LRNATURE,"^",5)=LRCM
"RTN","LRTSTJAN",58,0)
 N I S:$G(LRTS) I(+LRTS)="" D NEW^LR7OB1(LRODT,LRSN,$S($G(LRMSTATI)=""!($G(LRMSTATI)=1):"OC",1:"SC"),$G(LRNATURE),.I,$G(LRMSTATI))
"RTN","LRTSTJAN",59,0)
 Q
"RTN","LRTSTJAN",60,0)
LRACC S LREND=0 D ^LRWU4 S DA(2)=LRAA,DA(1)=LRAD
"RTN","LRTSTJAN",61,0)
 Q
"RTN","LRTSTOUT")
0^1^B60326116^B56895160
"RTN","LRTSTOUT",1,0)
LRTSTOUT ;SLC/CJS-JAM TESTS OFF ACCESSIONS ;8/11/97
"RTN","LRTSTOUT",2,0)
 ;;5.2;LAB SERVICE;**100,121,153,202,221,337**;Sep 27, 1994;Build 2
"RTN","LRTSTOUT",3,0)
 ;Cancel tests - Test are no longer deleted, instead the status is changed to Not Performed.
"RTN","LRTSTOUT",4,0)
EN ;
"RTN","LRTSTOUT",5,0)
 D ^LRPARAM Q:$G(LREND)
"RTN","LRTSTOUT",6,0)
 I '$D(LRLABKY) W !?5,"You are not authorized to change test status.",!,$C(7) S LREND=1 Q
"RTN","LRTSTOUT",7,0)
 K LRXX,LRSCNXB W @IOF
"RTN","LRTSTOUT",8,0)
 F  S (LREND,LRNOP)=0 D FIX D  I $G(LREND) D END Q
"RTN","LRTSTOUT",9,0)
 . I $G(LREND) D END S LREND=1 Q
"RTN","LRTSTOUT",10,0)
 . K DIC D:'$G(LRNOP) CHG D END
"RTN","LRTSTOUT",11,0)
 Q
"RTN","LRTSTOUT",12,0)
FIX S (LREND,LRNOP)=0,LRNOW=$$NOW^XLFDT
"RTN","LRTSTOUT",13,0)
 W ! S LRACC=1 D LRACC Q:$G(LRNOP)
"RTN","LRTSTOUT",14,0)
 K LRACC,LRNATURE I $G(LRAN)<1 S LREND=1 Q
"RTN","LRTSTOUT",15,0)
 I '$P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),0)),U,2) W !?5,"Accession has no Test ",! S LRNOP=1 Q
"RTN","LRTSTOUT",16,0)
 L +^LRO(68,LRAA,1,LRAD,1,LRAN):1 I '$T W !,"Someone else is working on this accession",! S LRNOP=1 Q
"RTN","LRTSTOUT",17,0)
 S LRX=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRACN=$P(^(.2),U),LRUID=$P(^(.3),U)
"RTN","LRTSTOUT",18,0)
 S LRDFN=+LRX,LRSN=+$P(LRX,U,5),LRODT=+$P(LRX,U,4)
"RTN","LRTSTOUT",19,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRTSTOUT",20,0)
 D PT^LRX W !,PNM,?30,SSN
"RTN","LRTSTOUT",21,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5) L +^LR(LRDFN,LRSS,LRIDT):1 I '$T W !,"Someone else is working on this data." L -^LRO(68,LRAA,1,LRAD,1,LRAN) S LRNOP=1 Q
"RTN","LRTSTOUT",22,0)
 I '$G(^LR(LRDFN,LRSS,LRIDT,0)) W !?5," Can't find Lab Data for this accession",! D UNLOCK S LRNOP=1 Q
"RTN","LRTSTOUT",23,0)
 I LRODT,LRSN,$D(^LRO(69,LRODT,1,LRSN,0))#2 D
"RTN","LRTSTOUT",24,0)
 . N LRACN,LRAA,LRAD
"RTN","LRTSTOUT",25,0)
 . D SHOW^LROS
"RTN","LRTSTOUT",26,0)
 K DIR S DIR(0)="E" D ^DIR S:$E(X)=U LRNOP=1 Q:$G(LRNOP)
"RTN","LRTSTOUT",27,0)
FX1 ;
"RTN","LRTSTOUT",28,0)
 D SHOWTST
"RTN","LRTSTOUT",29,0)
 Q
"RTN","LRTSTOUT",30,0)
CHG K LRCTST,DIC W !
"RTN","LRTSTOUT",31,0)
 N LRIFN
"RTN","LRTSTOUT",32,0)
 S:'$D(DIC("A")) DIC("A")="Change which LABORATORY TEST: "
"RTN","LRTSTOUT",33,0)
 S DIC="^LRO(68,"_LRAA_",1,"_LRAD_",1,"_LRAN_",4,",DIC("S")="I '$L($P(^(0),U,5))",DIC(0)="AEMOQ"
"RTN","LRTSTOUT",34,0)
 F  D ^DIC Q:Y<1  S LRCTST(+Y)=$P(^LAB(60,+Y,0),U),DIC("A")="Select another test: "
"RTN","LRTSTOUT",35,0)
 K DIC I '$O(LRCTST(0)) D  Q
"RTN","LRTSTOUT",36,0)
 . L -^LR(LRDFN,LRSS,LRIDT) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRTSTOUT",37,0)
 . W !?5,"No Test Selected",!
"RTN","LRTSTOUT",38,0)
 I '$L(LRODT)&'$L(LRSN) W !,"NO CHANGE" D UNLOCK,END Q
"RTN","LRTSTOUT",39,0)
 K LRCCOM S LRCCOM="",LREND=0 I '$D(^LRO(69,LRODT,1,LRSN,0))#2 W !?5,"There is no Order for this Accession",! D UNLOCK,END Q
"RTN","LRTSTOUT",40,0)
 W @IOF,!!?5,"Change Accession : ",LRACN,?40,"UID: ",LRUID
"RTN","LRTSTOUT",41,0)
 S I=0 F  S I=$O(LRCTST(I)) Q:I<1  W !?10,LRCTST(I)
"RTN","LRTSTOUT",42,0)
 D FX2 Q:$G(LREND)
"RTN","LRTSTOUT",43,0)
 S LRTSTS=0 F  S LRTSTS=$O(LRCTST(LRTSTS)) Q:LRTSTS<1  D
"RTN","LRTSTOUT",44,0)
 . Q:'$D(^LAB(60,LRTSTS,0))#2  S LRTNM=$P(^(0),U)
"RTN","LRTSTOUT",45,0)
 . S LRORDTST=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTSTS,0),U,9) D SET,CLNPENDG
"RTN","LRTSTOUT",46,0)
 . W:'$G(LREND) !?5,"[ "_LRTNM_" ] ",$S('$D(LRLABKY):" Marked Canceled by Floor",1:" Marked Not Performed"),!
"RTN","LRTSTOUT",47,0)
 S LREND=0 K LRCTST
"RTN","LRTSTOUT",48,0)
 Q
"RTN","LRTSTOUT",49,0)
SHOWTST ;
"RTN","LRTSTOUT",50,0)
 N LRI,LRN,DIR,LRY,LRIC,X
"RTN","LRTSTOUT",51,0)
 S DIR(0)="E"
"RTN","LRTSTOUT",52,0)
 D DEMO
"RTN","LRTSTOUT",53,0)
 S LRN=0,LRI=0 F  S LRI=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRI)) Q:LRI<1!($G(LRY))  D
"RTN","LRTSTOUT",54,0)
 . S LRIC=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRI,0)),U,4,6) Q:'$D(^LAB(60,+LRI,0))#2  W !,?5,$P(^(0),U) S LRN=LRN+1 I LRIC  D
"RTN","LRTSTOUT",55,0)
 . . W ?35,"  "_$S($L($P(LRIC,U,3)):$P(LRIC,U,3),1:"Completed")_"  "_$$FMTE^XLFDT($P(LRIC,U,2),"5FMPZ")_" by "_$P(LRIC,U)
"RTN","LRTSTOUT",56,0)
 . I LRN>18 D ^DIR S:$E(X)=U LRY=1 Q:$G(LRY)  D DEMO S LRN=0
"RTN","LRTSTOUT",57,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRODT=$P(X,U,4),LRSN=$P(X,U,5)
"RTN","LRTSTOUT",58,0)
 Q
"RTN","LRTSTOUT",59,0)
DEMO W !,PNM,?50,SSN
"RTN","LRTSTOUT",60,0)
 W !,"TESTS ON ACCESSION: ",LRACN,?40,"UID: ",LRUID
"RTN","LRTSTOUT",61,0)
 Q
"RTN","LRTSTOUT",62,0)
SET ;
"RTN","LRTSTOUT",63,0)
 S:'$G(LRNOW) LRNOW=$$NOW^XLFDT
"RTN","LRTSTOUT",64,0)
 S LRLLOC=$P(^LRO(69,LRODT,1,LRSN,0),U,7) D
"RTN","LRTSTOUT",65,0)
 . N II,X,LRI,LRSTATUS,OCXTRACE
"RTN","LRTSTOUT",66,0)
 . S:$G(LRDBUG) OCXTRACE=1
"RTN","LRTSTOUT",67,0)
 . S LRI=0 F  S LRI=$O(^LRO(69,LRODT,1,LRSN,2,LRI)) Q:LRI<1  I $D(^(LRI,0))#2,LRTSTS=+^(0) S (LRSTATUS,II(LRTSTS))="" D  K II
"RTN","LRTSTOUT",68,0)
 . . Q:$P(^LRO(69,LRODT,1,LRSN,2,LRI,0),U,11)  S ORIFN=$P(^(0),U,7)
"RTN","LRTSTOUT",69,0)
 . . S X=1+$O(^LRO(69,LRODT,1,LRSN,2,LRI,1.1,"A"),-1),X(1)=$P($G(^(0)),U,4)
"RTN","LRTSTOUT",70,0)
 . . S ^LRO(69,LRODT,1,LRSN,2,LRI,1.1,X,0)=$P($G(LRNATURE),U,5)_": "_LRCCOM,X=X+1,X(1)=X(1)+1
"RTN","LRTSTOUT",71,0)
 . . S ^LRO(69,LRODT,1,LRSN,2,LRI,1.1,X,0)=$S($G(LRMERG):"*Merged:",'$D(LRLABKY):"*Cancel by Floor:",1:"*NP Action:")_$$FMTE^XLFDT(LRNOW,"5MZ")
"RTN","LRTSTOUT",72,0)
 . . S ^LRO(69,LRODT,1,LRSN,2,LRI,1.1,0)="^^"_X_"^"_X(1)_"^"_DT
"RTN","LRTSTOUT",73,0)
 . . I $G(ORIFN),$D(II) D NEW^LR7OB1(LRODT,LRSN,$S($G(LRMSTATI)=""!($G(LRMSTATI)=1):"OC",1:"SC"),$G(LRNATURE),.II,LRSTATUS)
"RTN","LRTSTOUT",74,0)
 . . I ORIFN,$$VER^LR7OU1<3 D DC^LRCENDE1
"RTN","LRTSTOUT",75,0)
 . . S $P(^LRO(69,LRODT,1,LRSN,2,LRI,0),"^",9)="CA",$P(^(0),U,10)="L",$P(^(0),U,11)=DUZ
"RTN","LRTSTOUT",76,0)
 . . S:$D(^LRO(69,LRODT,1,LRSN,"PCE")) ^LRO(69,"AE",DUZ,LRODT,LRSN,LRI)=""
"RTN","LRTSTOUT",77,0)
 K ORIFN,ORSTS
"RTN","LRTSTOUT",78,0)
 I $D(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),0))#2,$D(^(4,$G(LRTSTS),0))#2 S $P(^(0),U,4,6)=DUZ_U_LRNOW_U_$S($G(LRMERG):"*Merged",1:"*Not Performed") D
"RTN","LRTSTOUT",79,0)
 . S LROWDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),U,3) I LROWDT,LROWDT'=LRAD D ROL Q
"RTN","LRTSTOUT",80,0)
 . S LROWDT=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,9)) I LROWDT D ROL
"RTN","LRTSTOUT",81,0)
 I $G(LRIDT),$L($G(LRSS)),$L(LRCCOM),$G(^LR(LRDFN,LRSS,LRIDT,0)) D
"RTN","LRTSTOUT",82,0)
 . D 63(LRDFN,LRSS,LRIDT,LRTNM,LRCCOM)
"RTN","LRTSTOUT",83,0)
 . D:'$D(^LRO(68,LRAA,1,LRAD,1,"AD",DT,LRAN)) XREF^LRVER3A
"RTN","LRTSTOUT",84,0)
 D EN^LA7ADL($P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),.3)),"^")) ; Put in list to check for auto download.
"RTN","LRTSTOUT",85,0)
 Q
"RTN","LRTSTOUT",86,0)
ROL ;
"RTN","LRTSTOUT",87,0)
 Q:+$G(^LRO(68,LRAA,1,LROWDT,1,LRAN,0))'=LRDFN  Q:'$D(^(4,LRTSTS,0))#2
"RTN","LRTSTOUT",88,0)
 S $P(^LRO(68,LRAA,1,LROWDT,1,LRAN,4,LRTSTS,0),U,4,6)=DUZ_U_LRNOW_U_"*Not performed"
"RTN","LRTSTOUT",89,0)
 Q
"RTN","LRTSTOUT",90,0)
LRACC K LRAN
"RTN","LRTSTOUT",91,0)
 S LREND=0,LREXMPT=1 D ^LRWU4 K LREXMPT
"RTN","LRTSTOUT",92,0)
 Q:'$G(LRAA)!('$G(LRAN))!('$D(^LRO(68,LRAA,0))#2)
"RTN","LRTSTOUT",93,0)
 S DA(2)=LRAA,DA(1)=LRAD,LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRTSTOUT",94,0)
 I '$L(LRSS) S LRAN=0,LRNOP=1 W !?5,"No Subscript for this Accession Area ",!!
"RTN","LRTSTOUT",95,0)
 Q
"RTN","LRTSTOUT",96,0)
LREND S LREND=1 Q
"RTN","LRTSTOUT",97,0)
UNLOCK ;
"RTN","LRTSTOUT",98,0)
 L -(^LR($G(LRDFN),$G(LRSS),$G(LRIDT)),^LRO(68,$G(LRAA),1,$G(LRAD),1,$G(LRAN))) D END Q
"RTN","LRTSTOUT",99,0)
EXIT ;
"RTN","LRTSTOUT",100,0)
 K LRSCNX,LRNOECHO,LRACN,LRLABRV,LRNOW
"RTN","LRTSTOUT",101,0)
END ;
"RTN","LRTSTOUT",102,0)
 K LRCCOM0,LRCCOM1,LRCCOMX,LREND,LRI,LRL,LRNATURE,LRNOP,LRSCN,LRMSTATI,LRORDTST,LROWDT,LRPRAC,LRTSTS,LRUID
"RTN","LRTSTOUT",103,0)
 K Q9,LRXX,DIR,LRCOM,LRAGE,DI,LRCTST,LRACN,LRACN0,LRDOC,LRLL,LRNOW
"RTN","LRTSTOUT",104,0)
 K LROD0,LROD1,LROD3,LROOS,LROS,LROSD,LROT,LRROD,LRTT,X4
"RTN","LRTSTOUT",105,0)
 D KVA^VADPT,END^LRTSTJAM
"RTN","LRTSTOUT",106,0)
 Q
"RTN","LRTSTOUT",107,0)
FX2 ;
"RTN","LRTSTOUT",108,0)
 S LREND=0
"RTN","LRTSTOUT",109,0)
 I '$L($G(LRNATURE)) D DC^LROR6() I $G(LRNATURE)="-1" W !!,$C(7),"Nothing Changed",! S LREND=1 Q
"RTN","LRTSTOUT",110,0)
 S LRL=52 I '$D(LRLABKY) G FX3
"RTN","LRTSTOUT",111,0)
 K DIR S (LRCOM,LRCCOM1)="" W !
"RTN","LRTSTOUT",112,0)
 S DIR(0)="62.5,5",DIR("A")="Select NP comment Lab Description screen  " S:$L($G(LRSCNXB)) DIR("B")=LRSCNXB
"RTN","LRTSTOUT",113,0)
 S DIR("?")="Select Lab Description file screen to be used to expand your NP reason."
"RTN","LRTSTOUT",114,0)
 S DIR("?",1)=" Press return to accept the default expansion screens."
"RTN","LRTSTOUT",115,0)
 S DIR("?",2)="  "
"RTN","LRTSTOUT",116,0)
 S DIR("?",3)="Select the Lab Description file expansion screen."
"RTN","LRTSTOUT",117,0)
 S DIR("?",4)="The default expansion screens are GENERAL, ORDER and LAB"
"RTN","LRTSTOUT",118,0)
 S DIR("?",5)="You may select addition lab description expansion screens"
"RTN","LRTSTOUT",119,0)
 S DIR("?",6)="Press return if you want to only use the default screens"
"RTN","LRTSTOUT",120,0)
 S DIR("?",7)=" "
"RTN","LRTSTOUT",121,0)
 K LRSCNXB,LRNOECHO
"RTN","LRTSTOUT",122,0)
 S:'$D(LRSCN) LRSCN="AKL"
"RTN","LRTSTOUT",123,0)
 D ^DIR I $E(X)=U S LREND=1 Q
"RTN","LRTSTOUT",124,0)
 I $E(X)="@" S LRSCN="AKL",LRSCNXB="" G FX2
"RTN","LRTSTOUT",125,0)
 I $L(X) S LRSCNXB=Y(0),LRSCN=LRSCN_Y
"RTN","LRTSTOUT",126,0)
FX3 K DIR W !
"RTN","LRTSTOUT",127,0)
 S DIR("A")=$S('$D(LRLABKY):"Reason for Cancel",1:"Not Perform Reason ") S:$L($G(LRXX)) DIR("B")=$G(LRXX)
"RTN","LRTSTOUT",128,0)
 S DIR(0)="FU^1:"_LRL_"^"
"RTN","LRTSTOUT",129,0)
 D ^DIR I $E(X)=U S LREND=1 Q
"RTN","LRTSTOUT",130,0)
 I '$L(X) W !,"You must enter Reason",! G FX2
"RTN","LRTSTOUT",131,0)
 I $D(LRLABKY) S LRXX=Y,Q9="1,"_LRL_","_LRSCN D COM^LRNUM
"RTN","LRTSTOUT",132,0)
 I '$D(X) G FX2
"RTN","LRTSTOUT",133,0)
 I $E(X,$L(X))=" " S X=$E(X,1,($L(X)-1))
"RTN","LRTSTOUT",134,0)
 S (LRCCOM,LRCCOMX)=X
"RTN","LRTSTOUT",135,0)
 I '$D(LRLABKY) W !,"("_LRCCOM_")"
"RTN","LRTSTOUT",136,0)
 K DIR S DIR(0)="Y",DIR("A")="Satisfactory Comment ",DIR("B")="Yes"
"RTN","LRTSTOUT",137,0)
 D ^DIR W ! K DIR
"RTN","LRTSTOUT",138,0)
 I Y'=1 G FX2
"RTN","LRTSTOUT",139,0)
 S LRCCOM=$E($S('$D(LRLABKY):"*Floor Cancel Reason:",1:"*NP Reason:")_LRCCOM,1,68)
"RTN","LRTSTOUT",140,0)
 Q
"RTN","LRTSTOUT",141,0)
 ;
"RTN","LRTSTOUT",142,0)
63(LRDFN,LRSS,LRIDT,LRTNM,LRCCOM) ;
"RTN","LRTSTOUT",143,0)
 N X,Y,D0,D1,DA,DR,DIC,DIE,LRCCOM0,LRNOECHO,DLAYGO
"RTN","LRTSTOUT",144,0)
 S DLAYGO=63,DIC(0)="SL"
"RTN","LRTSTOUT",145,0)
 S:'$G(LRNOW) LRNOW=$$NOW^XLFDT
"RTN","LRTSTOUT",146,0)
 S LRNOECHO=1
"RTN","LRTSTOUT",147,0)
 S LRCCOM0=$E("*"_LRTNM_$S($G(LRMERG):" Merged: ",'$D(LRLABKY):" Floor Canceled: ",1:" Not Performed: ")_$$FMTE^XLFDT(LRNOW,"5FMPZ")_" by "_DUZ,1,68)
"RTN","LRTSTOUT",148,0)
 S DA=LRIDT,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""","
"RTN","LRTSTOUT",149,0)
 S LRCCOM0=$TR(LRCCOM0,";","-") ; Strip ";" - FileMan uses ";" to parse DR string.
"RTN","LRTSTOUT",150,0)
 S DR=".99///^S X="_""""_LRCCOM0_"""" D ^DIE
"RTN","LRTSTOUT",151,0)
 Q:LRSS="MI"
"RTN","LRTSTOUT",152,0)
631 K D0,D1,DA,DR,DIC,DIE
"RTN","LRTSTOUT",153,0)
 S DIC(0)="SL"
"RTN","LRTSTOUT",154,0)
 S DA=LRIDT,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""",",DIC=DIE
"RTN","LRTSTOUT",155,0)
 S LRCCOM=$TR(LRCCOM,";","-") ; Strip ";" - FileMan uses ";" to parse DR string.
"RTN","LRTSTOUT",156,0)
 S LRCCOM=$TR(LRCCOM,"""","'") ; Change " to ' -- " causes FileMan error.
"RTN","LRTSTOUT",157,0)
 S DR=".99///^S X="_""""_LRCCOM_""""
"RTN","LRTSTOUT",158,0)
 D ^DIE
"RTN","LRTSTOUT",159,0)
 Q
"RTN","LRTSTOUT",160,0)
CLNPENDG ;Remove pending from Lab test when set to not performed
"RTN","LRTSTOUT",161,0)
 N LRIFN
"RTN","LRTSTOUT",162,0)
 S LRIFN=$P($G(^LAB(60,LRTSTS,.2)),U)
"RTN","LRTSTOUT",163,0)
 Q:LRIFN=""
"RTN","LRTSTOUT",164,0)
 S:$P($G(^LR(LRDFN,LRSS,LRIDT,LRIFN)),U)="pending" $P(^LR(LRDFN,LRSS,LRIDT,LRIFN),U)=""
"RTN","LRTSTOUT",165,0)
 Q
"VER")
8.0^22.0
"BLD",6269,6)
^281
**END**
**END**
