Released XT*7.3*67 SEQ #56
Extracted from mail message
**KIDS**:XT*7.3*67^

**INSTALL NAME**
XT*7.3*67
"BLD",638,0)
XT*7.3*67^TOOLKIT^0^3030210^y
"BLD",638,1,0)
^^2^2^3021211^^
"BLD",638,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"BLD",638,1,2,0)
Patch XT*7.3*67.
"BLD",638,4,0)
^9.64PA^^
"BLD",638,"KRN",0)
^9.67PA^8989.52^19
"BLD",638,"KRN",.4,0)
.4
"BLD",638,"KRN",.401,0)
.401
"BLD",638,"KRN",.402,0)
.402
"BLD",638,"KRN",.403,0)
.403
"BLD",638,"KRN",.5,0)
.5
"BLD",638,"KRN",.84,0)
.84
"BLD",638,"KRN",3.6,0)
3.6
"BLD",638,"KRN",3.8,0)
3.8
"BLD",638,"KRN",9.2,0)
9.2
"BLD",638,"KRN",9.8,0)
9.8
"BLD",638,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",638,"KRN",9.8,"NM",1,0)
MXMLPRSE^^0^B63106717
"BLD",638,"KRN",9.8,"NM",2,0)
MXMLPRS1^^0^B16288937
"BLD",638,"KRN",9.8,"NM",3,0)
MXMLUTL^^0^B1706569
"BLD",638,"KRN",9.8,"NM","B","MXMLPRS1",2)

"BLD",638,"KRN",9.8,"NM","B","MXMLPRSE",1)

"BLD",638,"KRN",9.8,"NM","B","MXMLUTL",3)

"BLD",638,"KRN",19,0)
19
"BLD",638,"KRN",19.1,0)
19.1
"BLD",638,"KRN",101,0)
101
"BLD",638,"KRN",409.61,0)
409.61
"BLD",638,"KRN",771,0)
771
"BLD",638,"KRN",870,0)
870
"BLD",638,"KRN",8989.51,0)
8989.51
"BLD",638,"KRN",8989.52,0)
8989.52
"BLD",638,"KRN",8994,0)
8994
"BLD",638,"KRN","B",.4,.4)

"BLD",638,"KRN","B",.401,.401)

"BLD",638,"KRN","B",.402,.402)

"BLD",638,"KRN","B",.403,.403)

"BLD",638,"KRN","B",.5,.5)

"BLD",638,"KRN","B",.84,.84)

"BLD",638,"KRN","B",3.6,3.6)

"BLD",638,"KRN","B",3.8,3.8)

"BLD",638,"KRN","B",9.2,9.2)

"BLD",638,"KRN","B",9.8,9.8)

"BLD",638,"KRN","B",19,19)

"BLD",638,"KRN","B",19.1,19.1)

"BLD",638,"KRN","B",101,101)

"BLD",638,"KRN","B",409.61,409.61)

"BLD",638,"KRN","B",771,771)

"BLD",638,"KRN","B",870,870)

"BLD",638,"KRN","B",8989.51,8989.51)

"BLD",638,"KRN","B",8989.52,8989.52)

"BLD",638,"KRN","B",8994,8994)

"BLD",638,"QUES",0)
^9.62^^
"BLD",638,"REQB",0)
^9.611^1^1
"BLD",638,"REQB",1,0)
XT*7.3*58^2
"BLD",638,"REQB","B","XT*7.3*58",1)

"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^2961029^2970513^2
"PKG",6,22,1,"PAH",1,0)
67^3030210
"PKG",6,22,1,"PAH",1,1,0)
^^2^2^3030210
"PKG",6,22,1,"PAH",1,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"PKG",6,22,1,"PAH",1,1,2,0)
Patch XT*7.3*67.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","MXMLPRS1")
0^2^B16288937
"RTN","MXMLPRS1",1,0)
MXMLPRS1 ;SAIC/DKM - XML Parser ;12/04/2002  15:55
"RTN","MXMLPRS1",2,0)
 ;;7.3;TOOLKIT;**58,67**;Apr 25, 1995
"RTN","MXMLPRS1",3,0)
 ;=================================================================
"RTN","MXMLPRS1",4,0)
 ; Initialize tables
"RTN","MXMLPRS1",5,0)
INIT N X,Y,Z
"RTN","MXMLPRS1",6,0)
 F X=0:1 S Y=$P($T(ENTITIES+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",7,0)
 .D SETENT^MXMLPRSE($P(Y,";"),$P(Y,";",2,99))
"RTN","MXMLPRS1",8,0)
 F X=0:1 S Y=$P($T(DTDTAG+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",9,0)
 .S DTD($P(Y,";"))=$P(Y,";",2)
"RTN","MXMLPRS1",10,0)
 F X=0:1 S Y=$P($T(TYPE+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",11,0)
 .S ^TMP(ID,$J,"TYP",$P(Y,";",2))=+Y
"RTN","MXMLPRS1",12,0)
 F X=0:1 S Y=$P($T(MOD+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",13,0)
 .S ^TMP(ID,$J,"MOD",$P(Y,";",2))=+Y
"RTN","MXMLPRS1",14,0)
 F X=0:1 S Y=$P($T(REF+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",15,0)
 .S ^TMP(ID,$J,"REF",$P(Y,";",2))=+Y
"RTN","MXMLPRS1",16,0)
 F X=0:1 S Y=$P($T(CBKARGS+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",17,0)
 .S ^TMP(ID,$J,"CBK",$P(Y,";",2))=+Y
"RTN","MXMLPRS1",18,0)
 F X=0:1 S Y=$P($T(PROLOG+X),";;",2,99) Q:'$L(Y)  D
"RTN","MXMLPRS1",19,0)
 .S Z=$P(Y,";"),^TMP(ID,$J,"ATT","?xml",Z)="1^"_$S('X:1,1:2)
"RTN","MXMLPRS1",20,0)
 .F  S Y=$P(Y,";",2,99) Q:'$L(Y)  S ^TMP(ID,$J,"ATT","?xml",Z,$P(Y,";"))=""
"RTN","MXMLPRS1",21,0)
 Q
"RTN","MXMLPRS1",22,0)
 ; Search parse tree for child element (CHILD) under parent element
"RTN","MXMLPRS1",23,0)
 ; (ELEMENT) starting at specified node (NODE).
"RTN","MXMLPRS1",24,0)
 ; Returns next node # in parse tree or 0
"RTN","MXMLPRS1",25,0)
 ; If validation is disabled, the function always returns 1.
"RTN","MXMLPRS1",26,0)
 ; If parent element is marked as EMPTY, 0 is returned.
"RTN","MXMLPRS1",27,0)
 ; If parent element is marked as ANY, 1 is returned.
"RTN","MXMLPRS1",28,0)
ISCHILD(ELEMENT,CHILD,NODE) ;
"RTN","MXMLPRS1",29,0)
 N TRN
"RTN","MXMLPRS1",30,0)
 S TRN=+$G(^TMP(ID,$J,"ELE",ELEMENT),2)
"RTN","MXMLPRS1",31,0)
 Q $S(OPTION'["V"!'NODE:1,TRN=1:CHILD="*",TRN=2:1,1:$$IC(NODE))
"RTN","MXMLPRS1",32,0)
IC(NODE) N X,Y
"RTN","MXMLPRS1",33,0)
 S X=+$G(^TMP(ID,$J,"ELE",ELEMENT,NODE,CHILD)),Y=0
"RTN","MXMLPRS1",34,0)
 I 'X D
"RTN","MXMLPRS1",35,0)
 .F  S Y=$O(^TMP(ID,$J,"ELE",ELEMENT,NODE,Y)) Q:'Y  D  Q:X
"RTN","MXMLPRS1",36,0)
 ..S:'$D(TRN(NODE,Y)) TRN(NODE,Y)="",X=$$IC(Y)
"RTN","MXMLPRS1",37,0)
 Q X
"RTN","MXMLPRS1",38,0)
 ; Check attribute value for validity
"RTN","MXMLPRS1",39,0)
CHKVAL(ENAME,ANAME,VALUE) ;
"RTN","MXMLPRS1",40,0)
 N TYPE,X,Y,Z
"RTN","MXMLPRS1",41,0)
 Q:'$L(VALUE)
"RTN","MXMLPRS1",42,0)
 I $D(^TMP(ID,$J,"ATT",ENAME,ANAME))>1 D:'$D(^(ANAME,VALUE)) ERROR(38,VALUE) Q
"RTN","MXMLPRS1",43,0)
 S TYPE=+$G(^TMP(ID,$J,"ATT",ENAME,ANAME))
"RTN","MXMLPRS1",44,0)
 Q:'TYPE
"RTN","MXMLPRS1",45,0)
 I TYPE=5 D  Q                                                         ; ID type
"RTN","MXMLPRS1",46,0)
 .I '$$ISNAME(VALUE) D ERROR(38,VALUE) Q
"RTN","MXMLPRS1",47,0)
 .I '$D(^TMP(ID,$J,"ID",VALUE)) D
"RTN","MXMLPRS1",48,0)
 ..S ^(VALUE)=""
"RTN","MXMLPRS1",49,0)
 ..D NOFWD("ID",VALUE)
"RTN","MXMLPRS1",50,0)
 .E  D ERROR(28,VALUE)
"RTN","MXMLPRS1",51,0)
 I TYPE=9!(TYPE=10) D  Q                                               ; ENTITY/ENTITIES type
"RTN","MXMLPRS1",52,0)
 .S X=$S(TYPE=9:"  ",1:" ")
"RTN","MXMLPRS1",53,0)
 .F Z=1:1:$L(VALUE,X) D FWD("UNP",$P(VALUE,X,Z))
"RTN","MXMLPRS1",54,0)
 I TYPE=3!(TYPE=4) D  Q                                                ; NMTOKEN/NMTOKENS type
"RTN","MXMLPRS1",55,0)
 .S X=$S(TYPE=3:"  ",1:" ")
"RTN","MXMLPRS1",56,0)
 .F Z=1:1:$L(VALUE,X) D
"RTN","MXMLPRS1",57,0)
 ..S Y=$P(VALUE,X,Z)
"RTN","MXMLPRS1",58,0)
 ..D:'$$ISNMTKN(Y) ERROR(38,Y)
"RTN","MXMLPRS1",59,0)
 I TYPE=6!(TYPE=7) D  Q                                                ; IDREF/IDREFS type
"RTN","MXMLPRS1",60,0)
 .S X=$S(TYPE=6:"  ",1:" ")
"RTN","MXMLPRS1",61,0)
 .F Z=1:1:$L(VALUE,X) D
"RTN","MXMLPRS1",62,0)
 ..S Y=$P(VALUE,X,Z)
"RTN","MXMLPRS1",63,0)
 ..I '$$ISNAME(Y) D ERROR(38,Y) Q
"RTN","MXMLPRS1",64,0)
 ..D FWD("ID",Y)
"RTN","MXMLPRS1",65,0)
 Q
"RTN","MXMLPRS1",66,0)
 ; Return true if valid name
"RTN","MXMLPRS1",67,0)
ISNAME(VALUE) ;
"RTN","MXMLPRS1",68,0)
 Q VALUE?1(1A,1"_",1":").(1AN,1".",1"-",1"_",1":")
"RTN","MXMLPRS1",69,0)
 ; Return true if valid name token
"RTN","MXMLPRS1",70,0)
ISNMTKN(VALUE) ;
"RTN","MXMLPRS1",71,0)
 Q VALUE?1.(1AN,1".",1"-",1"_",1":")
"RTN","MXMLPRS1",72,0)
 ; Log a forward reference
"RTN","MXMLPRS1",73,0)
FWD(TYPE,VALUE) ;
"RTN","MXMLPRS1",74,0)
 Q:'$L(VALUE)
"RTN","MXMLPRS1",75,0)
 Q:$D(^TMP(ID,$J,TYPE,VALUE))
"RTN","MXMLPRS1",76,0)
 N Z
"RTN","MXMLPRS1",77,0)
 S Z=$O(^TMP(ID,$J,"REF",TYPE,VALUE,""),-1)+1
"RTN","MXMLPRS1",78,0)
 M ^(Z)=ERR
"RTN","MXMLPRS1",79,0)
 Q
"RTN","MXMLPRS1",80,0)
 ; Resolve forward reference
"RTN","MXMLPRS1",81,0)
NOFWD(TYPE,VALUE) ;
"RTN","MXMLPRS1",82,0)
 K ^TMP(ID,$J,"REF",TYPE,VALUE)
"RTN","MXMLPRS1",83,0)
 Q
"RTN","MXMLPRS1",84,0)
 ; Signal unresolved references
"RTN","MXMLPRS1",85,0)
UNRESLV N X,Y,Z,E
"RTN","MXMLPRS1",86,0)
 F X=1:1:LVL D
"RTN","MXMLPRS1",87,0)
 .K ERR
"RTN","MXMLPRS1",88,0)
 .M ERR=LVL(X)
"RTN","MXMLPRS1",89,0)
 .D ERROR(8,LVL(X))
"RTN","MXMLPRS1",90,0)
 S X=""
"RTN","MXMLPRS1",91,0)
 F  S X=$O(^TMP(ID,$J,"REF",X)),Y="" Q:'$L(X)  D                           ; Look for IDREF w/o corresponding ID value
"RTN","MXMLPRS1",92,0)
 .S E=^(X)
"RTN","MXMLPRS1",93,0)
 .F  S Y=$O(^TMP(ID,$J,"REF",X,Y)),Z=0 Q:'$L(Y)  D
"RTN","MXMLPRS1",94,0)
 ..F  S Z=$O(^TMP(ID,$J,"REF",X,Y,Z)) Q:'Z  D
"RTN","MXMLPRS1",95,0)
 ...K ERR
"RTN","MXMLPRS1",96,0)
 ...M ERR=^(Z)
"RTN","MXMLPRS1",97,0)
 ...D ERROR(E,Y)
"RTN","MXMLPRS1",98,0)
 Q
"RTN","MXMLPRS1",99,0)
 ; Log error
"RTN","MXMLPRS1",100,0)
ERROR(X,Y) D ERROR^MXMLPRSE(.X,.Y) Q
"RTN","MXMLPRS1",101,0)
 ; Predefined general entities
"RTN","MXMLPRS1",102,0)
 ; Format=entity name;entity value
"RTN","MXMLPRS1",103,0)
ENTITIES ;;amp;&#38;
"RTN","MXMLPRS1",104,0)
 ;;lt;&#60;
"RTN","MXMLPRS1",105,0)
 ;;gt;>
"RTN","MXMLPRS1",106,0)
 ;;quot;&#34;
"RTN","MXMLPRS1",107,0)
 ;;apos;'
"RTN","MXMLPRS1",108,0)
 ;;
"RTN","MXMLPRS1",109,0)
 ; Callback events
"RTN","MXMLPRS1",110,0)
 ; Format=#args;event type
"RTN","MXMLPRS1",111,0)
CBKARGS ;;0;STARTDOCUMENT
"RTN","MXMLPRS1",112,0)
 ;;0;ENDDOCUMENT
"RTN","MXMLPRS1",113,0)
 ;;3;DOCTYPE
"RTN","MXMLPRS1",114,0)
 ;;1;CHARACTERS
"RTN","MXMLPRS1",115,0)
 ;;2;STARTELEMENT
"RTN","MXMLPRS1",116,0)
 ;;1;ENDELEMENT
"RTN","MXMLPRS1",117,0)
 ;;3;NOTATION
"RTN","MXMLPRS1",118,0)
 ;;2;PI
"RTN","MXMLPRS1",119,0)
 ;;1;COMMENT
"RTN","MXMLPRS1",120,0)
 ;;3;EXTERNAL
"RTN","MXMLPRS1",121,0)
 ;;1;ERROR
"RTN","MXMLPRS1",122,0)
 ;;
"RTN","MXMLPRS1",123,0)
 ; Prolog attributes
"RTN","MXMLPRS1",124,0)
 ; Format=attribute name;val1;val2;...;valn
"RTN","MXMLPRS1",125,0)
PROLOG ;;version;1.0
"RTN","MXMLPRS1",126,0)
 ;;encoding;UTF-8;utf-8
"RTN","MXMLPRS1",127,0)
 ;;standalone;no;yes
"RTN","MXMLPRS1",128,0)
 ;;
"RTN","MXMLPRS1",129,0)
 ; Recognized DTD tags
"RTN","MXMLPRS1",130,0)
 ; Format=tag name;state
"RTN","MXMLPRS1",131,0)
DTDTAG ;;ENTITY;20
"RTN","MXMLPRS1",132,0)
 ;;ELEMENT;30
"RTN","MXMLPRS1",133,0)
 ;;ATTLIST;40
"RTN","MXMLPRS1",134,0)
 ;;NOTATION;50
"RTN","MXMLPRS1",135,0)
 ;;[;60
"RTN","MXMLPRS1",136,0)
 ;;
"RTN","MXMLPRS1",137,0)
 ; Attribute types
"RTN","MXMLPRS1",138,0)
 ; Format=identifier;type
"RTN","MXMLPRS1",139,0)
TYPE ;;1;(
"RTN","MXMLPRS1",140,0)
 ;;2;CDATA
"RTN","MXMLPRS1",141,0)
 ;;3;NMTOKEN
"RTN","MXMLPRS1",142,0)
 ;;4;NMTOKENS
"RTN","MXMLPRS1",143,0)
 ;;5;ID
"RTN","MXMLPRS1",144,0)
 ;;6;IDREF
"RTN","MXMLPRS1",145,0)
 ;;7;IDREFS
"RTN","MXMLPRS1",146,0)
 ;;8;NOTATION
"RTN","MXMLPRS1",147,0)
 ;;9;ENTITY
"RTN","MXMLPRS1",148,0)
 ;;10;ENTITIES
"RTN","MXMLPRS1",149,0)
 ;;
"RTN","MXMLPRS1",150,0)
 ; Default modifiers
"RTN","MXMLPRS1",151,0)
 ; Format=identifier;modifier
"RTN","MXMLPRS1",152,0)
MOD ;;1;#REQUIRED
"RTN","MXMLPRS1",153,0)
 ;;2;#IMPLIED
"RTN","MXMLPRS1",154,0)
 ;;3;#FIXED
"RTN","MXMLPRS1",155,0)
 ;;
"RTN","MXMLPRS1",156,0)
 ; Forward references
"RTN","MXMLPRS1",157,0)
 ; Format=type;error #;type
"RTN","MXMLPRS1",158,0)
REF ;;49;UNP
"RTN","MXMLPRS1",159,0)
 ;;46;NOT
"RTN","MXMLPRS1",160,0)
 ;;26;ELE
"RTN","MXMLPRS1",161,0)
 ;;47;ID
"RTN","MXMLPRS1",162,0)
 ;;
"RTN","MXMLPRSE")
0^1^B63106717
"RTN","MXMLPRSE",1,0)
MXMLPRSE ;SAIC/DKM - XML Parser ;12/04/2002  16:20
"RTN","MXMLPRSE",2,0)
 ;;7.3;TOOLKIT;**58,67**;Apr 25, 1995
"RTN","MXMLPRSE",3,0)
 ;=================================================================
"RTN","MXMLPRSE",4,0)
 ; Main entry point.
"RTN","MXMLPRSE",5,0)
 ; DOC = Closed reference to global array containing document
"RTN","MXMLPRSE",6,0)
 ; CBK = Local array containing entry points for callback interface
"RTN","MXMLPRSE",7,0)
 ; OPTION = Option flags; expected values are:
"RTN","MXMLPRSE",8,0)
 ;   D = Debug mode
"RTN","MXMLPRSE",9,0)
 ;   W = Do not report warnings
"RTN","MXMLPRSE",10,0)
 ;   V = Validate (checks only well-formedness by default)
"RTN","MXMLPRSE",11,0)
 ;   0,1 = Terminate on encountering error at specified level
"RTN","MXMLPRSE",12,0)
EN(DOC,CBK,OPTION) ;
"RTN","MXMLPRSE",13,0)
 N WS,ID,QT,EDC,DTD,LVL,CS,DOCSTK,LLEN,LPOS,CPOS,LCUR,ERR,XML,PFX,SFX,EOD,ST,PATH
"RTN","MXMLPRSE",14,0)
 S ID=$T(+0),WS=$C(9,10,13,32),QT="""",(DOCSTK,EOD,LVL,CS,ST,LPOS,LLEN,LCUR)=0,(CPOS,LVL(0,"N"))=1,OPTION=$G(OPTION),(XML,PFX,SFX)="",PATH=$$PATH(DOC)
"RTN","MXMLPRSE",15,0)
 K ^TMP(ID,$J)
"RTN","MXMLPRSE",16,0)
 D INIT^MXMLPRS1,EPOS,CBK("STARTDOCUMENT"),OPNDOC(DOC)
"RTN","MXMLPRSE",17,0)
 F  Q:EOD  D READ,EPOS,@ST^MXMLPRS0:'EOD
"RTN","MXMLPRSE",18,0)
 D UNRESLV^MXMLPRS1,ERROR(17):ST'=2,CBK("ENDDOCUMENT")
"RTN","MXMLPRSE",19,0)
 K ^TMP(ID,$J)
"RTN","MXMLPRSE",20,0)
 Q
"RTN","MXMLPRSE",21,0)
 ; Open a document
"RTN","MXMLPRSE",22,0)
 ; Saves state of current document on stack.
"RTN","MXMLPRSE",23,0)
 ; DOCREF=Closed reference to array containing document
"RTN","MXMLPRSE",24,0)
 ; PREFIX=Optional prefix to prepend to document
"RTN","MXMLPRSE",25,0)
 ; SUFFIX=Optional suffix to append to document
"RTN","MXMLPRSE",26,0)
OPNDOC(DOCREF,PREFIX,SUFFIX) ;
"RTN","MXMLPRSE",27,0)
 S:$E(DOCREF)'="^" DOCREF=$$EXTRNL(DOCREF)
"RTN","MXMLPRSE",28,0)
 Q:'$L(DOCREF)
"RTN","MXMLPRSE",29,0)
 D SAVRES(1)
"RTN","MXMLPRSE",30,0)
 S DOC=$NA(@DOCREF)
"RTN","MXMLPRSE",31,0)
 I '$D(^TMP(ID,$J,"DOC",DOC)) S ^(DOC)=""
"RTN","MXMLPRSE",32,0)
 E  D ERROR(43)
"RTN","MXMLPRSE",33,0)
 S (LPOS,LLEN,LCUR)=0,CPOS=1,XML="",PFX=$G(PREFIX),SFX=$G(SUFFIX)
"RTN","MXMLPRSE",34,0)
 Q
"RTN","MXMLPRSE",35,0)
 ; Close current document
"RTN","MXMLPRSE",36,0)
 ; Restores state of previous document from stack.
"RTN","MXMLPRSE",37,0)
CLSDOC K ^TMP(ID,$J,"DOC",DOC)
"RTN","MXMLPRSE",38,0)
 D SAVRES(0)
"RTN","MXMLPRSE",39,0)
 Q
"RTN","MXMLPRSE",40,0)
 ; Extract path from filespec
"RTN","MXMLPRSE",41,0)
PATH(DOC) ;
"RTN","MXMLPRSE",42,0)
 N X
"RTN","MXMLPRSE",43,0)
 Q:U[$E(DOC) ""
"RTN","MXMLPRSE",44,0)
 F X="\","/","]",":","" Q:DOC[X
"RTN","MXMLPRSE",45,0)
 Q $P(DOC,X,1,$L(DOC,X)-1)_X
"RTN","MXMLPRSE",46,0)
 ; Save or restore document state
"RTN","MXMLPRSE",47,0)
SAVRES(SAVE) ;
"RTN","MXMLPRSE",48,0)
 N X
"RTN","MXMLPRSE",49,0)
 S:'SAVE DOCSTK=DOCSTK-1,EOD=DOCSTK=0
"RTN","MXMLPRSE",50,0)
 I DOCSTK F X="LLEN","LPOS","CPOS","LCUR","XML","PFX","SFX","DOC" D
"RTN","MXMLPRSE",51,0)
 .I SAVE S DOCSTK(DOCSTK,X)=@X
"RTN","MXMLPRSE",52,0)
 .E  S @X=DOCSTK(DOCSTK,X)
"RTN","MXMLPRSE",53,0)
 I SAVE S DOCSTK=DOCSTK+1
"RTN","MXMLPRSE",54,0)
 E  K DOCSTK(DOCSTK)
"RTN","MXMLPRSE",55,0)
 Q
"RTN","MXMLPRSE",56,0)
 ; Retrieve text from document
"RTN","MXMLPRSE",57,0)
READ Q:CPOS'>LLEN!EOD
"RTN","MXMLPRSE",58,0)
 S LPOS=LPOS+1,CPOS=1,LCUR=$O(@DOC@(LCUR))
"RTN","MXMLPRSE",59,0)
 I 'LCUR D CLSDOC G READ
"RTN","MXMLPRSE",60,0)
 N TMP,X ;*rwf Protect others from changes to X
"RTN","MXMLPRSE",61,0)
 M TMP=@DOC@(LCUR)
"RTN","MXMLPRSE",62,0)
 S TMP=PFX_$G(TMP),PFX="",X="TMP",XML=""
"RTN","MXMLPRSE",63,0)
 F  S XML=XML_@X,X=$Q(@X) Q:'$L(X)
"RTN","MXMLPRSE",64,0)
 S XML=XML_$S($O(@DOC@(LCUR)):"",1:SFX),LLEN=$L(XML) ;*rwf
"RTN","MXMLPRSE",65,0)
 ;S XML=XML_$S($O(@DOC@(LCUR)):$C(10),1:SFX),LLEN=$L(XML) ;*rwf Was
"RTN","MXMLPRSE",66,0)
 W:OPTION["D" !,XML,!
"RTN","MXMLPRSE",67,0)
 Q
"RTN","MXMLPRSE",68,0)
 ; Check next characters
"RTN","MXMLPRSE",69,0)
 ; SEQ=character sequence
"RTN","MXMLPRSE",70,0)
 ; ERN=Error to signal if not found (optional)
"RTN","MXMLPRSE",71,0)
NEXT(SEQ,ERN) ;
"RTN","MXMLPRSE",72,0)
 I SEQ=$E(XML,CPOS,CPOS+$L(SEQ)-1) S CPOS=CPOS+$L(SEQ) Q 1
"RTN","MXMLPRSE",73,0)
 D:$G(ERN) EPOS,ERROR(ERN,SEQ)
"RTN","MXMLPRSE",74,0)
 Q 0
"RTN","MXMLPRSE",75,0)
 ; Parse name
"RTN","MXMLPRSE",76,0)
 ; ERN=Error to signal if invalid (optional)
"RTN","MXMLPRSE",77,0)
NAME(ERN) ;
"RTN","MXMLPRSE",78,0)
 N X
"RTN","MXMLPRSE",79,0)
 D EPOS
"RTN","MXMLPRSE",80,0)
 S X=$E(XML,CPOS)
"RTN","MXMLPRSE",81,0)
 I X'?1A,"_:"'[X D:$G(ERN) ERROR(ERN,X) Q ""
"RTN","MXMLPRSE",82,0)
 Q $$NAMETKN(.ERN)
"RTN","MXMLPRSE",83,0)
 ; Parse name token
"RTN","MXMLPRSE",84,0)
 ; ERN=Error to signal if invalid (optional)
"RTN","MXMLPRSE",85,0)
NAMETKN(ERN) ;
"RTN","MXMLPRSE",86,0)
 N X,Y
"RTN","MXMLPRSE",87,0)
 D EPOS
"RTN","MXMLPRSE",88,0)
 F X=CPOS:1:LLEN+1 S Y=$E(XML,X) I Y'?1AN,".-_:"'[Y Q
"RTN","MXMLPRSE",89,0)
 S Y=$E(XML,CPOS,X-1),CPOS=X
"RTN","MXMLPRSE",90,0)
 I '$L(Y),$G(ERN) D ERROR(ERN,Y)
"RTN","MXMLPRSE",91,0)
 Q Y
"RTN","MXMLPRSE",92,0)
 ; Parse quote-enclosed value
"RTN","MXMLPRSE",93,0)
 ; ERF=If set, signal error if not found
"RTN","MXMLPRSE",94,0)
 ; FLG=Special flag: 0=attribute literal, 1=general entity literal
"RTN","MXMLPRSE",95,0)
 ;     2=parameter entity literal
"RTN","MXMLPRSE",96,0)
 ; Returns value less quotes with normalized whitespace
"RTN","MXMLPRSE",97,0)
VALUE(ERF,FLG) ;
"RTN","MXMLPRSE",98,0)
 N DLM,CHR,RTN,EXC
"RTN","MXMLPRSE",99,0)
 D WS()
"RTN","MXMLPRSE",100,0)
 S DLM=$S($$NEXT(QT):QT,$$NEXT("'"):"'",1:""),RTN="",FLG=+$G(FLG),EXC=$S(FLG=2:"",1:"<")
"RTN","MXMLPRSE",101,0)
 I DLM="" D:$G(ERF) EPOS,ERROR(11) Q RTN
"RTN","MXMLPRSE",102,0)
 F  S CHR=$E(XML,CPOS) Q:DLM=CHR!(EXC[CHR)!EOD  D
"RTN","MXMLPRSE",103,0)
 .I $$NEXT("&#") S RTN=RTN_$$CHENTITY
"RTN","MXMLPRSE",104,0)
 .E  I 'FLG,$$NEXT("&") S RTN=RTN_$$ENTITY
"RTN","MXMLPRSE",105,0)
 .E  S RTN=RTN_CHR,CPOS=CPOS+1
"RTN","MXMLPRSE",106,0)
 .D:CPOS>LLEN READ
"RTN","MXMLPRSE",107,0)
 I DLM=CHR S CPOS=CPOS+1
"RTN","MXMLPRSE",108,0)
 E  D EPOS,ERROR($S('$L(CHR):12,EXC[CHR:13,1:12)) Q ""
"RTN","MXMLPRSE",109,0)
 Q $$NMLWS(RTN)
"RTN","MXMLPRSE",110,0)
 ; Normalize whitespace
"RTN","MXMLPRSE",111,0)
 ; Note: used as input transform for Entity Catalog, so can't depend
"RTN","MXMLPRSE",112,0)
 ; on any environment variables.
"RTN","MXMLPRSE",113,0)
 ; TXT=Text to normalize
"RTN","MXMLPRSE",114,0)
 ; Returns text stripped of leading and trailing whitespace and with
"RTN","MXMLPRSE",115,0)
 ; imbedded contiguous whitespace reduced to single space.
"RTN","MXMLPRSE",116,0)
NMLWS(TXT) ;
"RTN","MXMLPRSE",117,0)
 N Z
"RTN","MXMLPRSE",118,0)
 S TXT=$TR(TXT,$C(9,10,13,32),"    ")
"RTN","MXMLPRSE",119,0)
 F Z=1:1 Q:$E(TXT,Z)'=" "
"RTN","MXMLPRSE",120,0)
 S TXT=$E(TXT,Z,9999)
"RTN","MXMLPRSE",121,0)
 F Z=$L(TXT):-1 Q:$E(TXT,Z)'=" "
"RTN","MXMLPRSE",122,0)
 S TXT=$E(TXT,1,Z)
"RTN","MXMLPRSE",123,0)
 F Z=1:1:$L(TXT) D:$E(TXT,Z)=" "
"RTN","MXMLPRSE",124,0)
 .F  Q:$E(TXT,Z+1)'=" "  S $E(TXT,Z+1)=""
"RTN","MXMLPRSE",125,0)
 Q TXT
"RTN","MXMLPRSE",126,0)
 ; Process parameter entity if found
"RTN","MXMLPRSE",127,0)
DOPARAM F  D WS() Q:EOD!'$$NEXT("%")  I $$ENTITY(1)
"RTN","MXMLPRSE",128,0)
 Q
"RTN","MXMLPRSE",129,0)
 ; Resolve general/parameter/character entity
"RTN","MXMLPRSE",130,0)
 ; PARAM=1: parameter; PARAM=0: general or character (default)
"RTN","MXMLPRSE",131,0)
ENTITY(PARAM) ;
"RTN","MXMLPRSE",132,0)
 N NAME,APND
"RTN","MXMLPRSE",133,0)
 S PARAM=+$G(PARAM)
"RTN","MXMLPRSE",134,0)
 I 'PARAM,$$NEXT("#") Q $$CHENTITY
"RTN","MXMLPRSE",135,0)
 S NAME=$S(PARAM:"%",1:"")_$$NAME(2)
"RTN","MXMLPRSE",136,0)
 Q:'$$NEXT(";",3) ""
"RTN","MXMLPRSE",137,0)
 ;Handle the common ones inline
"RTN","MXMLPRSE",138,0)
 S APND=$S(NAME="amp":"&",NAME="lt":"<",NAME="quot":$C(34),NAME="apos":"'",1:"")
"RTN","MXMLPRSE",139,0)
 Q:$L(APND) APND
"RTN","MXMLPRSE",140,0)
 I $D(^TMP(ID,$J,"UNP",NAME)) D ERROR(40,NAME) Q ""
"RTN","MXMLPRSE",141,0)
 I '$D(^TMP(ID,$J,"ENT",NAME)) D ERROR(14,NAME) Q ""
"RTN","MXMLPRSE",142,0)
 S APND=$S(PARAM:" ",1:"")
"RTN","MXMLPRSE",143,0)
 D OPNDOC(^TMP(ID,$J,"ENT",NAME),APND,APND)
"RTN","MXMLPRSE",144,0)
 Q ""
"RTN","MXMLPRSE",145,0)
 ; Parse character entity reference
"RTN","MXMLPRSE",146,0)
 ; Returns character equivalent
"RTN","MXMLPRSE",147,0)
CHENTITY() ;
"RTN","MXMLPRSE",148,0)
 N DIGIT,BASE,DIGITS,VAL
"RTN","MXMLPRSE",149,0)
 S BASE=$S($$NEXT("x"):16,1:10),DIGITS="0123456789"_$S(BASE=16:"ABCDEF",1:""),VAL=0
"RTN","MXMLPRSE",150,0)
 F CPOS=CPOS:1:LLEN+1 Q:$$NEXT(";")!EOD  D
"RTN","MXMLPRSE",151,0)
 .S DIGIT=$F(DIGITS,$$UP^XLFSTR($E(XML,CPOS)))-2,VAL=VAL*BASE+DIGIT
"RTN","MXMLPRSE",152,0)
 .D:DIGIT<0 ERROR(19)
"RTN","MXMLPRSE",153,0)
 I VAL<32,WS'[$C(VAL) D ERROR(19)
"RTN","MXMLPRSE",154,0)
 Q $C(VAL)
"RTN","MXMLPRSE",155,0)
 ; Set an entity value
"RTN","MXMLPRSE",156,0)
SETENT(NAME,VAL) ;
"RTN","MXMLPRSE",157,0)
 K ^TMP(ID,$J,"ENT",NAME)
"RTN","MXMLPRSE",158,0)
 S ^(NAME)=$NA(^(NAME)),^(NAME,1)=VAL
"RTN","MXMLPRSE",159,0)
 Q
"RTN","MXMLPRSE",160,0)
 ; Process all attributes
"RTN","MXMLPRSE",161,0)
ATTRIBS(ENAME,ATTR) ;
"RTN","MXMLPRSE",162,0)
 N TYP,MOD,DEF,ANAME
"RTN","MXMLPRSE",163,0)
 K ATTR
"RTN","MXMLPRSE",164,0)
 F  Q:'$$ATTRIB(ENAME,.ATTR)
"RTN","MXMLPRSE",165,0)
 I OPTION["V" D
"RTN","MXMLPRSE",166,0)
 .S ANAME="$"
"RTN","MXMLPRSE",167,0)
 .F  S ANAME=$O(^TMP(ID,$J,"ATT",ENAME,ANAME)) Q:'$L(ANAME)  D
"RTN","MXMLPRSE",168,0)
 ..S TYP=^(ANAME),MOD=$P(TYP,"^",2),DEF=$P(TYP,"^",3,9999),TYP=+TYP
"RTN","MXMLPRSE",169,0)
 ..I MOD=1!(MOD=3),'$D(ATTR(ANAME)) D ERROR(36,ANAME) Q
"RTN","MXMLPRSE",170,0)
 ..I MOD=3,ATTR(ANAME)'=DEF D ERROR(37,ATTR(ANAME)) Q
"RTN","MXMLPRSE",171,0)
 ..I MOD=2,'$D(ATTR(ANAME)) Q
"RTN","MXMLPRSE",172,0)
 ..S:'$D(ATTR(ANAME)) ATTR(ANAME)=DEF
"RTN","MXMLPRSE",173,0)
 Q
"RTN","MXMLPRSE",174,0)
 ; Parse attribute=value sequence
"RTN","MXMLPRSE",175,0)
 ; ENAME=Element name to which attribute belongs
"RTN","MXMLPRSE",176,0)
 ; ATTR=Local array (by reference) to receive attribute value.
"RTN","MXMLPRSE",177,0)
 ;      Format is ATTR("<attribute name>")="<attribute value>"
"RTN","MXMLPRSE",178,0)
 ; Returns 1 if successful, 0 if not.
"RTN","MXMLPRSE",179,0)
ATTRIB(ENAME,ATTR) ;
"RTN","MXMLPRSE",180,0)
 N ANAME
"RTN","MXMLPRSE",181,0)
 D WS()
"RTN","MXMLPRSE",182,0)
 S ANAME=$$NAME
"RTN","MXMLPRSE",183,0)
 Q:ANAME="" 0
"RTN","MXMLPRSE",184,0)
 I $D(ATTR(ANAME)) D ERROR(4,ANAME) Q 0
"RTN","MXMLPRSE",185,0)
 D:'$D(^TMP(ID,$J,"ATT",ENAME,ANAME)) ERROR(29,ANAME)
"RTN","MXMLPRSE",186,0)
 D WS()
"RTN","MXMLPRSE",187,0)
 Q:'$$NEXT("=",3) 0
"RTN","MXMLPRSE",188,0)
 D WS()
"RTN","MXMLPRSE",189,0)
 S ATTR(ANAME)=$$VALUE(1)
"RTN","MXMLPRSE",190,0)
 D CHKVAL^MXMLPRS1(ENAME,ANAME,ATTR(ANAME))
"RTN","MXMLPRSE",191,0)
 Q 1
"RTN","MXMLPRSE",192,0)
 ; Skip whitespace
"RTN","MXMLPRSE",193,0)
 ; ERN=Error to signal if not found (optional)
"RTN","MXMLPRSE",194,0)
 ; Optional return value =1 if whitespace found, 0 if not.
"RTN","MXMLPRSE",195,0)
WS(ERN) N CHR,FND
"RTN","MXMLPRSE",196,0)
 D EPOS
"RTN","MXMLPRSE",197,0)
 S FND=0
"RTN","MXMLPRSE",198,0)
 F  D:CPOS>LLEN READ S CHR=$E(XML,CPOS) Q:WS'[CHR!EOD  D
"RTN","MXMLPRSE",199,0)
 .S ERN=0,CPOS=CPOS+1,FND=1
"RTN","MXMLPRSE",200,0)
 D:$G(ERN) ERROR(ERN)
"RTN","MXMLPRSE",201,0)
 Q:$Q FND
"RTN","MXMLPRSE",202,0)
 Q
"RTN","MXMLPRSE",203,0)
 ; Parse a processing instruction
"RTN","MXMLPRSE",204,0)
 ; Returns 1 if PI found, 0 if not.
"RTN","MXMLPRSE",205,0)
PI() N PNAME,ARGS,DONE
"RTN","MXMLPRSE",206,0)
 Q:'$$NEXT("<?") 0
"RTN","MXMLPRSE",207,0)
 S PNAME=$$NAME(2),ARGS=0
"RTN","MXMLPRSE",208,0)
 I $$UP^XLFSTR(PNAME)="XML" D ERROR(9) Q 0
"RTN","MXMLPRSE",209,0)
 D WS(1)
"RTN","MXMLPRSE",210,0)
 F  S DONE=$F(XML,"?>",CPOS) D  Q:DONE!EOD
"RTN","MXMLPRSE",211,0)
 .S ARGS=ARGS+1,ARGS(ARGS)=$E(XML,CPOS,$S(DONE:DONE-3,1:LLEN))
"RTN","MXMLPRSE",212,0)
 .S CPOS=$S(DONE:DONE,1:LLEN+1)
"RTN","MXMLPRSE",213,0)
 .D READ
"RTN","MXMLPRSE",214,0)
 I EOD D ERROR(7) Q 0
"RTN","MXMLPRSE",215,0)
 D CBK("PI",PNAME,.ARGS)
"RTN","MXMLPRSE",216,0)
 Q 1
"RTN","MXMLPRSE",217,0)
 ; Parse a comment
"RTN","MXMLPRSE",218,0)
 ; Returns 1 if comment found, 0 if not.
"RTN","MXMLPRSE",219,0)
COMMENT() Q $$PARSCT("<!--","--",">","COMMENT")
"RTN","MXMLPRSE",220,0)
 ; Parse a CDATA section
"RTN","MXMLPRSE",221,0)
 ; Returns 1 if found, 0 if not.
"RTN","MXMLPRSE",222,0)
CDATA() Q $$PARSCT("<![CDATA[","]]>","","CHARACTERS")
"RTN","MXMLPRSE",223,0)
 ; Parse a section (for CDATA and COMMENT)
"RTN","MXMLPRSE",224,0)
 ; BGN=Beginning delimiter
"RTN","MXMLPRSE",225,0)
 ; END=Ending delimiter
"RTN","MXMLPRSE",226,0)
 ; TRL=Trailing delimiter
"RTN","MXMLPRSE",227,0)
 ; TYP=Event type
"RTN","MXMLPRSE",228,0)
PARSCT(BGN,END,TRL,TYP) ;
"RTN","MXMLPRSE",229,0)
 N X
"RTN","MXMLPRSE",230,0)
 Q:'$$NEXT(BGN) 0
"RTN","MXMLPRSE",231,0)
 D EPOS
"RTN","MXMLPRSE",232,0)
 I 'LVL,TYP'="COMMENT" D ERROR(6) Q 0
"RTN","MXMLPRSE",233,0)
 F  S X=$F(XML,END,CPOS) D  Q:X!EOD
"RTN","MXMLPRSE",234,0)
 .D CBK(TYP,$E(XML,CPOS,$S(X:X-$L(END)-1,1:LLEN)))
"RTN","MXMLPRSE",235,0)
 .S CPOS=$S(X:X,1:LLEN+1)
"RTN","MXMLPRSE",236,0)
 .D READ,EPOS
"RTN","MXMLPRSE",237,0)
 I EOD D ERROR(7) Q 0
"RTN","MXMLPRSE",238,0)
 I $L(TRL),$$NEXT(TRL,3)
"RTN","MXMLPRSE",239,0)
 Q 1
"RTN","MXMLPRSE",240,0)
 ; Execute event callback (if defined)
"RTN","MXMLPRSE",241,0)
 ; EVT=Event name
"RTN","MXMLPRSE",242,0)
 ; Pn=Parameters
"RTN","MXMLPRSE",243,0)
CBK(EVT,P1,P2,P3,P4) ;
"RTN","MXMLPRSE",244,0)
 Q:EOD<0
"RTN","MXMLPRSE",245,0)
 N EN,PNUM
"RTN","MXMLPRSE",246,0)
 S EN=$G(CBK(EVT))
"RTN","MXMLPRSE",247,0)
 Q:EN=""
"RTN","MXMLPRSE",248,0)
 S PNUM=^TMP(ID,$J,"CBK",EVT)
"RTN","MXMLPRSE",249,0)
 D @(EN_$P("(.P1,.P2,.P3,.P4",",",1,PNUM)_$S('PNUM:"",1:")"))
"RTN","MXMLPRSE",250,0)
 Q
"RTN","MXMLPRSE",251,0)
 ; Fetch an external entity from file or entity catalog
"RTN","MXMLPRSE",252,0)
 ; SYS=System identifier (i.e., a URL)
"RTN","MXMLPRSE",253,0)
 ; PUB=Public identifier (i.e., Entity Catalog ID) - optional
"RTN","MXMLPRSE",254,0)
 ; GBL=Optional global root to receive entity content
"RTN","MXMLPRSE",255,0)
 ; Returns global reference or null if error
"RTN","MXMLPRSE",256,0)
EXTRNL(SYS,PUB,GBL) ;
"RTN","MXMLPRSE",257,0)
 N X,Y
"RTN","MXMLPRSE",258,0)
 S PUB=$$NMLWS($G(PUB)),GBL=$G(GBL)
"RTN","MXMLPRSE",259,0)
 I '$L(GBL) D CBK("EXTERNAL",.SYS,.PUB,.GBL) Q:$L(GBL) GBL
"RTN","MXMLPRSE",260,0)
 I $L(PUB) D  Q:X $NA(^MXML(950,X,1))
"RTN","MXMLPRSE",261,0)
 .S Y=$E(PUB,1,30),X=0
"RTN","MXMLPRSE",262,0)
 .F  S X=$O(^MXML(950,"B",Y,X)) Q:'X  Q:$G(^MXML(950,X,0))=PUB
"RTN","MXMLPRSE",263,0)
 S:'$L(GBL) GBL=$$TMPGBL
"RTN","MXMLPRSE",264,0)
 S:$$PATH(SYS)="" SYS=PATH_SYS
"RTN","MXMLPRSE",265,0)
 S X=$S($$FTG^%ZISH(SYS,"",$NA(@GBL@(1)),$QL(GBL)+1):GBL,1:"")
"RTN","MXMLPRSE",266,0)
 D:'$L(X) ERROR(30,$S($L(SYS):SYS,1:PUB))
"RTN","MXMLPRSE",267,0)
 Q X
"RTN","MXMLPRSE",268,0)
 ; Return a unique scratch global reference
"RTN","MXMLPRSE",269,0)
TMPGBL() N SUB
"RTN","MXMLPRSE",270,0)
 S SUB=$O(^TMP(ID,$J,$C(1)),-1)+1,^(SUB)=""
"RTN","MXMLPRSE",271,0)
 Q $NA(^(SUB))
"RTN","MXMLPRSE",272,0)
 ; Returns a SYSTEM and/or PUBLIC id
"RTN","MXMLPRSE",273,0)
 ; SYS=Returned SYSTEM id
"RTN","MXMLPRSE",274,0)
 ; PUB=Returned PUBLIC id
"RTN","MXMLPRSE",275,0)
 ; FLG=If set, SYSTEM id is optional after PUBLIC id
"RTN","MXMLPRSE",276,0)
 ; Optional return value: 0=neither, 1=PUBLIC, 2=SYSTEM
"RTN","MXMLPRSE",277,0)
SYSPUB(SYS,PUB,FLG) ;
"RTN","MXMLPRSE",278,0)
 N RTN
"RTN","MXMLPRSE",279,0)
 I $$NEXT("PUBLIC") D
"RTN","MXMLPRSE",280,0)
 .D WS(1)
"RTN","MXMLPRSE",281,0)
 .S PUB=$$VALUE(1),SYS=$$VALUE('$G(FLG)),RTN=1
"RTN","MXMLPRSE",282,0)
 E  I $$NEXT("SYSTEM") D
"RTN","MXMLPRSE",283,0)
 .D WS(1)
"RTN","MXMLPRSE",284,0)
 .S PUB="",SYS=$$VALUE(1),RTN=2
"RTN","MXMLPRSE",285,0)
 E  S (SYS,PUB)="",RTN=0
"RTN","MXMLPRSE",286,0)
 Q:$Q RTN
"RTN","MXMLPRSE",287,0)
 Q
"RTN","MXMLPRSE",288,0)
 ; Save current document location for error reporting
"RTN","MXMLPRSE",289,0)
EPOS S ERR("XML")=XML,ERR("POS")=CPOS,ERR("LIN")=LPOS
"RTN","MXMLPRSE",290,0)
 Q
"RTN","MXMLPRSE",291,0)
 ; Setup error information
"RTN","MXMLPRSE",292,0)
ERROR(ERN,ARG) ;
"RTN","MXMLPRSE",293,0)
 N DIHELP,DIMSG,DIERR,MSG
"RTN","MXMLPRSE",294,0)
 D BLD^DIALOG(9500000+ERN,"","","MSG","")
"RTN","MXMLPRSE",295,0)
 S ERR("NUM")=ERN
"RTN","MXMLPRSE",296,0)
 S ERR("SEV")=$S($G(DIHELP):0,$G(DIMSG):1,1:2)
"RTN","MXMLPRSE",297,0)
 S ERR("MSG")=$G(MSG(1))
"RTN","MXMLPRSE",298,0)
 S ERR("ARG")=$G(ARG)
"RTN","MXMLPRSE",299,0)
 I OPTION'["W"!ERR("SEV"),OPTION["V"!(ERR("SEV")'=1) D CBK("ERROR",.ERR)
"RTN","MXMLPRSE",300,0)
 S:ERR("SEV")=2!(OPTION[ERR("SEV")) EOD=-1                             ; Stop parsing on severe error
"RTN","MXMLPRSE",301,0)
 Q
"RTN","MXMLUTL")
0^3^B1706569
"RTN","MXMLUTL",1,0)
MXMLUTL ;mjk/alb - MXML Build Utilities ;12/11/2002  15:30
"RTN","MXMLUTL",2,0)
 ;;7.3;TOOLKIT;**67**;Apr 25, 1995
"RTN","MXMLUTL",3,0)
 QUIT
"RTN","MXMLUTL",4,0)
 ;
"RTN","MXMLUTL",5,0)
XMLHDR() ; -- provides current XML standard header 
"RTN","MXMLUTL",6,0)
 QUIT "<?xml version=""1.0"" encoding=""utf-8"" ?>"
"RTN","MXMLUTL",7,0)
 ;
"RTN","MXMLUTL",8,0)
SYMENC(STR) ; -- replace reserved xml symbols with their encoding.
"RTN","MXMLUTL",9,0)
 N A,I,X,Y,Z,NEWSTR,QT
"RTN","MXMLUTL",10,0)
 S (Y,Z)="",QT=""""
"RTN","MXMLUTL",11,0)
 I STR["&" S NEWSTR=STR D  S STR=Y_Z
"RTN","MXMLUTL",12,0)
 . F X=1:1  S Y=Y_$PIECE(NEWSTR,"&",X)_"&amp;",Z=$PIECE(STR,"&",X+1,999) Q:Z'["&"
"RTN","MXMLUTL",13,0)
 I STR["<" F  S STR=$PIECE(STR,"<",1)_"&lt;"_$PIECE(STR,"<",2,99) Q:STR'["<"
"RTN","MXMLUTL",14,0)
 I STR[">" F  S STR=$PIECE(STR,">",1)_"&gt;"_$PIECE(STR,">",2,99) Q:STR'[">"
"RTN","MXMLUTL",15,0)
 I STR["'" F  S STR=$PIECE(STR,"'",1)_"&apos;"_$PIECE(STR,"'",2,99) Q:STR'["'"
"RTN","MXMLUTL",16,0)
 I STR[QT F  S STR=$PIECE(STR,QT,1)_"&quot;"_$PIECE(STR,QT,2,99) Q:STR'[QT
"RTN","MXMLUTL",17,0)
 ;
"RTN","MXMLUTL",18,0)
 F I=1:1:$L(STR) D
"RTN","MXMLUTL",19,0)
 . S X=$E(STR,I)
"RTN","MXMLUTL",20,0)
 . S A=$A(X)
"RTN","MXMLUTL",21,0)
 . IF A<31 S STR=$P(STR,X,1)_$P(STR,X,2,99)
"RTN","MXMLUTL",22,0)
 Q STR
"RTN","MXMLUTL",23,0)
 ;
"VER")
8.0^22.0
**END**
**END**
