EMERGENCY Released OR*3*145 SEQ #128
Extracted from mail message
**KIDS**:OR*3.0*145^

**INSTALL NAME**
OR*3.0*145
"BLD",3620,0)
OR*3.0*145^ORDER ENTRY/RESULTS REPORTING^0^3020405^y
"BLD",3620,1,0)
^^2^2^3020404^
"BLD",3620,1,1,0)
See FORUM for the full description of this patch.  Update to database 
"BLD",3620,1,2,0)
clean up distributed in patch OR*3*138.
"BLD",3620,4,0)
^9.64PA^^
"BLD",3620,"ABPKG")
n
"BLD",3620,"KRN",0)
^9.67PA^8989.52^19
"BLD",3620,"KRN",.4,0)
.4
"BLD",3620,"KRN",.401,0)
.401
"BLD",3620,"KRN",.402,0)
.402
"BLD",3620,"KRN",.403,0)
.403
"BLD",3620,"KRN",.5,0)
.5
"BLD",3620,"KRN",.84,0)
.84
"BLD",3620,"KRN",3.6,0)
3.6
"BLD",3620,"KRN",3.8,0)
3.8
"BLD",3620,"KRN",9.2,0)
9.2
"BLD",3620,"KRN",9.8,0)
9.8
"BLD",3620,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3620,"KRN",9.8,"NM",1,0)
ORY145^^0^B63467333
"BLD",3620,"KRN",9.8,"NM","B","ORY145",1)

"BLD",3620,"KRN",19,0)
19
"BLD",3620,"KRN",19.1,0)
19.1
"BLD",3620,"KRN",101,0)
101
"BLD",3620,"KRN",409.61,0)
409.61
"BLD",3620,"KRN",771,0)
771
"BLD",3620,"KRN",870,0)
870
"BLD",3620,"KRN",8989.51,0)
8989.51
"BLD",3620,"KRN",8989.52,0)
8989.52
"BLD",3620,"KRN",8994,0)
8994
"BLD",3620,"KRN","B",.4,.4)

"BLD",3620,"KRN","B",.401,.401)

"BLD",3620,"KRN","B",.402,.402)

"BLD",3620,"KRN","B",.403,.403)

"BLD",3620,"KRN","B",.5,.5)

"BLD",3620,"KRN","B",.84,.84)

"BLD",3620,"KRN","B",3.6,3.6)

"BLD",3620,"KRN","B",3.8,3.8)

"BLD",3620,"KRN","B",9.2,9.2)

"BLD",3620,"KRN","B",9.8,9.8)

"BLD",3620,"KRN","B",19,19)

"BLD",3620,"KRN","B",19.1,19.1)

"BLD",3620,"KRN","B",101,101)

"BLD",3620,"KRN","B",409.61,409.61)

"BLD",3620,"KRN","B",771,771)

"BLD",3620,"KRN","B",870,870)

"BLD",3620,"KRN","B",8989.51,8989.51)

"BLD",3620,"KRN","B",8989.52,8989.52)

"BLD",3620,"KRN","B",8994,8994)

"BLD",3620,"QUES",0)
^9.62^^
"BLD",3620,"REQB",0)
^9.611^1^1
"BLD",3620,"REQB",1,0)
OR*3.0*138^2
"BLD",3620,"REQB","B","OR*3.0*138",1)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
145^3020405
"PKG",110,22,1,"PAH",1,1,0)
^^2^2^3020405
"PKG",110,22,1,"PAH",1,1,1,0)
See FORUM for the full description of this patch.  Update to database 
"PKG",110,22,1,"PAH",1,1,2,0)
clean up distributed in patch OR*3*138.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORY145")
0^1^B63467333
"RTN","ORY145",1,0)
ORY145 ;SLC/DAN ;4/5/02  07:10
"RTN","ORY145",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**145**;Dec 17, 1997
"RTN","ORY145",3,0)
 ;DBIA 2058 allows read of B xref in DIC(9.4
"RTN","ORY145",4,0)
 ;DBIA 2197 allows reading of install file
"RTN","ORY145",5,0)
 ;
"RTN","ORY145",6,0)
 ;Set missing AE xref, fix incorrect package pointer, and fix incorrect display group (TO field).
"RTN","ORY145",7,0)
 ;
"RTN","ORY145",8,0)
 N ORMSG,ZTSK
"RTN","ORY145",9,0)
 S ORMSG(1)=""
"RTN","ORY145",10,0)
 S ORMSG(2)="Database clean up routine ORY145.  This routine will"
"RTN","ORY145",11,0)
 S ORMSG(3)="run in the background and will fix any known database errors."
"RTN","ORY145",12,0)
 S ORMSG(4)="It will then send a mail message to the initiator indicating what was changed."
"RTN","ORY145",13,0)
 S ORMSG(5)=""
"RTN","ORY145",14,0)
 D MES^XPDUTL(.ORMSG)
"RTN","ORY145",15,0)
 S ZTRTN="DQ^ORY145",ZTDESC="Patch OR*3*145 database clean up",ZTSAVE("DUZ")="",ZTIO=""
"RTN","ORY145",16,0)
 D ^%ZTLOAD
"RTN","ORY145",17,0)
 I $G(ZTSK) D MES^XPDUTL("ORY145 queued to background as task number "_ZTSK_".")
"RTN","ORY145",18,0)
 Q
"RTN","ORY145",19,0)
 ;
"RTN","ORY145",20,0)
DQ ;Enter here for queued task
"RTN","ORY145",21,0)
 N ERR
"RTN","ORY145",22,0)
 K ^TMP("ORFIX",$J)
"RTN","ORY145",23,0)
 D FIXES,FIXPPDG,MAIL
"RTN","ORY145",24,0)
 K ^TMP("ORFIX",$J),^TMP("ORTXT",$J)
"RTN","ORY145",25,0)
 Q
"RTN","ORY145",26,0)
 ;
"RTN","ORY145",27,0)
FIXES ;This section will add missing AE Xrefs from active orders
"RTN","ORY145",28,0)
 N CNT,PAT,DATE,IEN,PTNAME,STOPDT,DA,CURDT,LASTRUN
"RTN","ORY145",29,0)
 S CNT=0
"RTN","ORY145",30,0)
 S PAT=""
"RTN","ORY145",31,0)
 S LASTRUN=$$GET^XPAR("SYS","ORM ORMTIME LAST RUN",1,"I") ;last date/time ORMTIME ran
"RTN","ORY145",32,0)
 S CURDT=$S(LASTRUN'="":LASTRUN,1:$$NOW^XLFDT) ;Set CURDT to last run date/time or current date/time as appropriate
"RTN","ORY145",33,0)
 F  S PAT=$O(^OR(100,"AC",PAT)) Q:PAT=""  D
"RTN","ORY145",34,0)
 .S DATE=0 F  S DATE=$O(^OR(100,"AC",PAT,DATE)) Q:'+DATE  D
"RTN","ORY145",35,0)
 ..S IEN=0 F  S IEN=$O(^OR(100,"AC",PAT,DATE,IEN)) Q:'+IEN  D
"RTN","ORY145",36,0)
 ...Q:$$NMSP^ORCD($P($G(^OR(100,IEN,0)),U,14))'="PS"  ;quit if not pharmacy
"RTN","ORY145",37,0)
 ...I $O(^OR(100,IEN,8,1)) D CHKACT ;If more than one action check to make sure current action is correct
"RTN","ORY145",38,0)
 ...Q:$O(^OR(100,IEN,2,0))  ;No AE for parent orders
"RTN","ORY145",39,0)
 ...S PTNAME=$$PTNM(PAT) Q:PTNAME=-1  ;get patient name quit if referral or couldn't determine name
"RTN","ORY145",40,0)
 ...S STOPDT=+$P($G(^OR(100,IEN,0)),U,9) Q:'+STOPDT!(STOPDT'>CURDT)
"RTN","ORY145",41,0)
 ...Q:$D(^OR(100,"AE",STOPDT,IEN))  ;already has an AE xref
"RTN","ORY145",42,0)
 ...S DA=IEN
"RTN","ORY145",43,0)
 ...D ES^ORDD100A ;Sets AE xref if appropriate
"RTN","ORY145",44,0)
 ...I $D(^OR(100,"AE",STOPDT,IEN)) S ^TMP("ORFIX",$J,PTNAME,IEN,"ES")="",CNT=CNT+1
"RTN","ORY145",45,0)
 S ^TMP("ORFIX",$J,0)=CNT
"RTN","ORY145",46,0)
 Q
"RTN","ORY145",47,0)
 ;
"RTN","ORY145",48,0)
FIXPPDG ;This section will fix incorrect package pointer and display group problems.
"RTN","ORY145",49,0)
 N DATE,IEN,CNT,IPKG,OPKG,IDG,ODG,BADPKG,BADDG,OR0,PTNAME,PCLASS,PKG,TYPE,DG,DIK,DA,EDG,ADMITTED,ENTERED,DIC,DR,ORARRAY
"RTN","ORY145",50,0)
 S DATE=$$INSTDT("OR*3.0*94")
"RTN","ORY145",51,0)
 S DATE=$S(DATE:$$FMADD^XLFDT(DATE,-1,23,59),1:3000815.24) ;If install date not found revert back to 1st possible install date
"RTN","ORY145",52,0)
 S IEN=$$GETIEN(DATE)-1 ;Get first order number for date, subtract one so the first order is reviewed
"RTN","ORY145",53,0)
 I IEN=-1 S ERR="No orders in date range" Q  ;No orders to review
"RTN","ORY145",54,0)
 S CNT=0
"RTN","ORY145",55,0)
 S IPKG=$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0)) ;Inpatient meds package IEN
"RTN","ORY145",56,0)
 S OPKG=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) ;Outpatient meds package IEN
"RTN","ORY145",57,0)
 S IDG=$O(^ORD(100.98,"B","UD RX",0)) ;Inpatient meds display group IEN
"RTN","ORY145",58,0)
 S ODG=$O(^ORD(100.98,"B","O RX",0)) ;Outpatient meds display group IEN
"RTN","ORY145",59,0)
 S BADPKG=$O(^DIC(9.4,"B","PHARMACY DATA MANAGEMENT",0)) ;Bad package IEN
"RTN","ORY145",60,0)
 S BADDG=$O(^ORD(100.98,"B","PHARMACY",0)) ;Bad display group IEN
"RTN","ORY145",61,0)
 I IPKG=""!(OPKG="")!(IDG="")!(ODG="")!(BADPKG="")!(BADDG="") S ERR="Package or display group file entries are missing from the local system." Q  ;missing values
"RTN","ORY145",62,0)
 F  S IEN=$O(^OR(100,IEN)) Q:'+IEN  D
"RTN","ORY145",63,0)
 .S OR0=$G(^OR(100,IEN,0)) Q:OR0=""  ;Missing 0 node
"RTN","ORY145",64,0)
 .S PKG=$P(OR0,U,14) ;Current package
"RTN","ORY145",65,0)
 .I $$NMSP^ORCD(PKG)'="PS" Q  ;Originating package should be a pharmacy type
"RTN","ORY145",66,0)
 .S DG=$P(OR0,U,11) ;Current display group (TO field)
"RTN","ORY145",67,0)
 .I PKG=BADPKG!(DG=BADDG) D  S CNT=CNT+1
"RTN","ORY145",68,0)
 ..S DIC=9.4,DR=".01",DA=PKG,DIQ="ORARRAY" D EN^DIQ1 S PKGN=ORARRAY(9.4,DA,.01) K DIC,DR,DA,DIQ,ORARRAY
"RTN","ORY145",69,0)
 ..S DIC=100.98,DR=".01",DA=DG,DIQ="ORARRAY" D EN^DIQ1 S DGN=ORARRAY(100.98,DA,.01) K DIC,DR,DA,DIQ,ORARRAY
"RTN","ORY145",70,0)
 ..S PTNAME=$$PTNM($P(OR0,U,2))
"RTN","ORY145",71,0)
 ..I PTNAME=-1 Q  ;either patient is referral or is missing
"RTN","ORY145",72,0)
 ..S PCLASS=$P(OR0,U,12)
"RTN","ORY145",73,0)
 ..S TYPE=$S($$VALUE^ORX8(IEN,"REFILLS")'="":"OUT",1:"IN") ;Sets type of order to outpatient if there are refills, else inpatient
"RTN","ORY145",74,0)
 ..I TYPE="OUT" D
"RTN","ORY145",75,0)
 ...I PCLASS'="O" S ^TMP("ORFIX",$J,PTNAME,IEN,"PC")="INPATIENT to OUTPATIENT" S $P(^OR(100,IEN,0),U,12)="O"
"RTN","ORY145",76,0)
 ...I PKG'=OPKG S ^TMP("ORFIX",$J,PTNAME,IEN,"PKG")="from "_PKGN_" to OUTPATIENT PHARMACY" S $P(^OR(100,IEN,0),U,14)=OPKG
"RTN","ORY145",77,0)
 ...I DG'=ODG S ^TMP("ORFIX",$J,PTNAME,IEN,"DG")="from "_DGN_" to O RX" D XREF(IEN,DG,ODG) ;Re-index display group field
"RTN","ORY145",78,0)
 ..;
"RTN","ORY145",79,0)
 ..I TYPE="IN" D
"RTN","ORY145",80,0)
 ...S ENTERED=$P(OR0,U,7) ;Date order entered
"RTN","ORY145",81,0)
 ...S ADMITTED=$$ADM(IEN,ENTERED)
"RTN","ORY145",82,0)
 ...I ADMITTED=-1 Q  ;unable to detemine patient status
"RTN","ORY145",83,0)
 ...I PCLASS'="I" S ^TMP("ORFIX",$J,PTNAME,IEN,"PC")="OUTPATIENT to INPATIENT" S $P(^OR(100,IEN,0),U,12)="I"
"RTN","ORY145",84,0)
 ...I PKG'=IPKG S ^TMP("ORFIX",$J,PTNAME,IEN,"PKG")="from "_PKGN_" to INPATIENT MEDICATIONS" S $P(^OR(100,IEN,0),U,14)=IPKG
"RTN","ORY145",85,0)
 ...S EDG=$S(ADMITTED:IDG,1:ODG) ;Expected display group
"RTN","ORY145",86,0)
 ...I DG'=EDG S ^TMP("ORFIX",$J,PTNAME,IEN,"DG")="from "_DGN_" to "_$S(ADMITTED:"UD RX",1:"O RX") D XREF(IEN,DG,EDG) ;Re-index display group
"RTN","ORY145",87,0)
 S $P(^TMP("ORFIX",$J,0),U,2)=CNT
"RTN","ORY145",88,0)
 Q
"RTN","ORY145",89,0)
 ;
"RTN","ORY145",90,0)
GETIEN(STDT) ;Find first IEN associated with given start date
"RTN","ORY145",91,0)
 N DONE,IEN
"RTN","ORY145",92,0)
 S (DONE,IEN)=0
"RTN","ORY145",93,0)
 F  S STDT=$O(^OR(100,"AF",STDT)) Q:'+STDT!(DONE)  D
"RTN","ORY145",94,0)
 .S IEN=0 F  S IEN=$O(^OR(100,"AF",STDT,IEN)) Q:'+IEN  I $O(^(IEN,0))=1 S DONE=1 Q  ;Find first ORDER that is a new order
"RTN","ORY145",95,0)
 Q IEN
"RTN","ORY145",96,0)
 ;
"RTN","ORY145",97,0)
MAIL ;Send results of cleanup in a mail message to initiator
"RTN","ORY145",98,0)
 N I,XMSUB,XMTEXT,XMDUZ,XMY
"RTN","ORY145",99,0)
 S XMSUB="Patch OR*3*145 Clean up completed"
"RTN","ORY145",100,0)
 S XMDUZ="Patch OR*3*145 Background job"
"RTN","ORY145",101,0)
 S XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY145",102,0)
 S XMTEXT="^TMP(""ORTXT"",$J,"
"RTN","ORY145",103,0)
 K ^TMP("ORTXT",$J)
"RTN","ORY145",104,0)
 S I=1
"RTN","ORY145",105,0)
 S ^TMP("ORTXT",$J,I)="The database clean-up for patch OR*3*145 has completed.",I=I+1
"RTN","ORY145",106,0)
 S ^TMP("ORTXT",$J,I)="Below is a listing of what was changed and any possible error messages.",I=I+1
"RTN","ORY145",107,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY145",108,0)
 S ^TMP("ORTXT",$J,I)=+$P($G(^TMP("ORFIX",$J,0)),U)_" orders had AE cross references added.",I=I+1
"RTN","ORY145",109,0)
 S ^TMP("ORTXT",$J,I)=+$P($G(^TMP("ORFIX",$J,0)),U,2)_" orders had their package, display group, or patient class changed.",I=I+1
"RTN","ORY145",110,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY145",111,0)
 I $D(ERR) D
"RTN","ORY145",112,0)
 .S ^TMP("ORTXT",$J,I)="An error occurred that stopped the package and display group check.",I=I+1
"RTN","ORY145",113,0)
 .S ^TMP("ORTXT",$J,I)="Please log a NOIS and indicate that you received the following error:",I=I+1
"RTN","ORY145",114,0)
 .S ^TMP("ORTXT",$J,I)=ERR,I=I+1
"RTN","ORY145",115,0)
 .S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY145",116,0)
 .S ^TMP("ORTXT",$J,I)="If any AE cross references were added you will still see the results below.",I=I+1
"RTN","ORY145",117,0)
 I '$D(ERR) I $G(^TMP("ORFIX",$J,0))="0^0" S ^TMP("ORTXT",$J,I)="No changes were made to your database.",I=I+1
"RTN","ORY145",118,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY145",119,0)
 S PAT=0 F  S PAT=$O(^TMP("ORFIX",$J,PAT)) Q:PAT=""  D
"RTN","ORY145",120,0)
 .S ^TMP("ORTXT",$J,I)=PAT,I=I+1
"RTN","ORY145",121,0)
 .S ORD=0 F  S ORD=$O(^TMP("ORFIX",$J,PAT,ORD)) Q:ORD=""  D
"RTN","ORY145",122,0)
 ..S ^TMP("ORTXT",$J,I)="   ORDER #: "_ORD,I=I+1
"RTN","ORY145",123,0)
 ..F J="ES","DG","PKG","PC" I $D(^TMP("ORFIX",$J,PAT,ORD,J)) D
"RTN","ORY145",124,0)
 ...S ^TMP("ORTXT",$J,I)="      "_$S(J="ES":"Added AE cross reference ",J="PKG":"Changed package ",J="DG":"Changed display group ",1:"Changed patient class from ")
"RTN","ORY145",125,0)
 ...S ^TMP("ORTXT",$J,I)=$G(^TMP("ORTXT",$J,I))_$G(^TMP("ORFIX",$J,PAT,ORD,J))
"RTN","ORY145",126,0)
 ...S I=I+1
"RTN","ORY145",127,0)
 .S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY145",128,0)
 D ^XMD ;send results
"RTN","ORY145",129,0)
 Q
"RTN","ORY145",130,0)
 ;
"RTN","ORY145",131,0)
INSTDT(PATCH) ;Returns installation date patch first installed at site
"RTN","ORY145",132,0)
 N IEN
"RTN","ORY145",133,0)
 S IEN=$O(^XPD(9.7,"B",PATCH,0)) Q:'+IEN 0 ;Get IEN of first installation
"RTN","ORY145",134,0)
 Q $P($P($G(^XPD(9.7,IEN,1)),U),".")  ;Get date of first install
"RTN","ORY145",135,0)
 ;
"RTN","ORY145",136,0)
ADM(IEN,ENTERED) ;Determine if patient was inpatient when order was entered
"RTN","ORY145",137,0)
 ;returns 1 if inpat, 0 if not inpat, -1 if no DFN or object of order is from referral patient file
"RTN","ORY145",138,0)
 N DFN,VAIN,VAINDT
"RTN","ORY145",139,0)
 S DFN=$P($G(^OR(100,IEN,0)),U,2) ;get object of order
"RTN","ORY145",140,0)
 I +DFN=0!(DFN'["DPT") Q -1  ;No DFN found or not from patient file
"RTN","ORY145",141,0)
 S DFN=+DFN
"RTN","ORY145",142,0)
 S VAINDT=ENTERED
"RTN","ORY145",143,0)
 D INP^VADPT
"RTN","ORY145",144,0)
 Q $S($G(VAIN(1)):1,1:0)  ;If VAIN(1) has a value then patient was an inpatient
"RTN","ORY145",145,0)
 ;
"RTN","ORY145",146,0)
PTNM(IEN) ;Return pt name or -1 if unable to determine
"RTN","ORY145",147,0)
 N DFN,VADM
"RTN","ORY145",148,0)
 I +IEN=0!(IEN'["DPT") Q -1
"RTN","ORY145",149,0)
 S DFN=+IEN
"RTN","ORY145",150,0)
 D ^VADPT
"RTN","ORY145",151,0)
 I $G(VADM(1))="" Q -1
"RTN","ORY145",152,0)
 Q $G(VADM(1))
"RTN","ORY145",153,0)
 ;
"RTN","ORY145",154,0)
XREF(IEN,DG,NDG) ;Update xrefs for TO field
"RTN","ORY145",155,0)
 N DA,DIE,DR
"RTN","ORY145",156,0)
 K ^OR(100,"AW",$P(OR0,U,2),DG,$S($P(OR0,U,8):$P(OR0,U,8),1:9999999),IEN)
"RTN","ORY145",157,0)
 S DIE=100,DA=IEN,DR="23///"_NDG D ^DIE
"RTN","ORY145",158,0)
 Q
"RTN","ORY145",159,0)
 ;
"RTN","ORY145",160,0)
CHKACT ;Compares current action field with actual current action and updates if necessary
"RTN","ORY145",161,0)
 N CURACT,I,ACT
"RTN","ORY145",162,0)
 S CURACT=$P(^OR(100,IEN,3),U,7) Q:'CURACT
"RTN","ORY145",163,0)
 S I="?" F  S I=$O(^OR(100,IEN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S ACT=I Q
"RTN","ORY145",164,0)
 Q:'$D(ACT)  ;Active action not found
"RTN","ORY145",165,0)
 I CURACT'=ACT S $P(^OR(100,IEN,3),U,7)=ACT D SETALL^ORDD100(IEN)
"RTN","ORY145",166,0)
 Q
"VER")
8.0^22.0
**END**
**END**
