Released GMRC*3*13 SEQ #9
Extracted from mail message
**KIDS**:GMRC*3.0*13^

**INSTALL NAME**
GMRC*3.0*13
"BLD",2036,0)
GMRC*3.0*13^CONSULT/REQUEST TRACKING^0^2991105^y
"BLD",2036,1,0)
^^1^1^2991105^
"BLD",2036,1,1,0)
See National Patch Module for full description of enhancements.
"BLD",2036,4,0)
^9.64PA^^
"BLD",2036,"ABPKG")
n
"BLD",2036,"KRN",0)
^9.67PA^19^18
"BLD",2036,"KRN",.4,0)
.4
"BLD",2036,"KRN",.401,0)
.401
"BLD",2036,"KRN",.402,0)
.402
"BLD",2036,"KRN",.403,0)
.403
"BLD",2036,"KRN",.5,0)
.5
"BLD",2036,"KRN",.84,0)
.84
"BLD",2036,"KRN",3.6,0)
3.6
"BLD",2036,"KRN",3.8,0)
3.8
"BLD",2036,"KRN",9.2,0)
9.2
"BLD",2036,"KRN",9.8,0)
9.8
"BLD",2036,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",2036,"KRN",9.8,"NM",1,0)
GMRCP5^^0^B47602075
"BLD",2036,"KRN",9.8,"NM",2,0)
GMRCP5A^^0^B53674611
"BLD",2036,"KRN",9.8,"NM",3,0)
GMRCP5B^^0^B31920873
"BLD",2036,"KRN",9.8,"NM",4,0)
GMRCTIUP^^0^B57515840
"BLD",2036,"KRN",9.8,"NM","B","GMRCP5",1)

"BLD",2036,"KRN",9.8,"NM","B","GMRCP5A",2)

"BLD",2036,"KRN",9.8,"NM","B","GMRCP5B",3)

"BLD",2036,"KRN",9.8,"NM","B","GMRCTIUP",4)

"BLD",2036,"KRN",19,0)
19
"BLD",2036,"KRN",19.1,0)
19.1
"BLD",2036,"KRN",101,0)
101
"BLD",2036,"KRN",409.61,0)
409.61
"BLD",2036,"KRN",771,0)
771
"BLD",2036,"KRN",869.2,0)
869.2
"BLD",2036,"KRN",870,0)
870
"BLD",2036,"KRN",8994,0)
8994
"BLD",2036,"KRN","B",.4,.4)

"BLD",2036,"KRN","B",.401,.401)

"BLD",2036,"KRN","B",.402,.402)

"BLD",2036,"KRN","B",.403,.403)

"BLD",2036,"KRN","B",.5,.5)

"BLD",2036,"KRN","B",.84,.84)

"BLD",2036,"KRN","B",3.6,3.6)

"BLD",2036,"KRN","B",3.8,3.8)

"BLD",2036,"KRN","B",9.2,9.2)

"BLD",2036,"KRN","B",9.8,9.8)

"BLD",2036,"KRN","B",19,19)

"BLD",2036,"KRN","B",19.1,19.1)

"BLD",2036,"KRN","B",101,101)

"BLD",2036,"KRN","B",409.61,409.61)

"BLD",2036,"KRN","B",771,771)

"BLD",2036,"KRN","B",869.2,869.2)

"BLD",2036,"KRN","B",870,870)

"BLD",2036,"KRN","B",8994,8994)

"BLD",2036,"QUES",0)
^9.62^^
"BLD",2036,"REQB",0)
^9.611^1^1
"BLD",2036,"REQB",1,0)
GMRC*3.0*4^2
"BLD",2036,"REQB","B","GMRC*3.0*4",1)

"MBREQ")
0
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
13^2991105
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^2991105
"PKG",128,22,1,"PAH",1,1,1,0)
See National Patch Module for full description of enhancements.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMRCP5")
0^1^B47602075
"RTN","GMRCP5",1,0)
GMRCP5 ;SLC/DCM,RJS - Print Consult form 513 (main entry) ;5/14/98  11:09
"RTN","GMRCP5",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13**;Dec 27, 1997
"RTN","GMRCP5",3,0)
 ;
"RTN","GMRCP5",4,0)
TIUEN(GMRCIEN) ;Entry point for TIU to print 513
"RTN","GMRCP5",5,0)
 ;
"RTN","GMRCP5",6,0)
 N GMRCPLEN,GMRCTASK,GMRCX
"RTN","GMRCP5",7,0)
 ;
"RTN","GMRCP5",8,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",9,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",10,0)
 ;
"RTN","GMRCP5",11,0)
 Q:'+GMRCIEN  D PRNT^GMRCP5A(GMRCIEN,1,0,"",0)
"RTN","GMRCP5",12,0)
 ;
"RTN","GMRCP5",13,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",14,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",15,0)
 Q
"RTN","GMRCP5",16,0)
 ;
"RTN","GMRCP5",17,0)
GUI(ROOT,GMRCIFN) ;Entry point into routine for the GUI
"RTN","GMRCP5",18,0)
 ;
"RTN","GMRCP5",19,0)
 ; GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",20,0)
 ;
"RTN","GMRCP5",21,0)
 N GMRCCPY,GMRCPLEN,GMRCX
"RTN","GMRCP5",22,0)
 ;
"RTN","GMRCP5",23,0)
 S GMRCPLEN=99998
"RTN","GMRCP5",24,0)
 S GMRCCPY="W"
"RTN","GMRCP5",25,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",26,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",27,0)
 ;
"RTN","GMRCP5",28,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,GMRCPLEN)
"RTN","GMRCP5",29,0)
 ;
"RTN","GMRCP5",30,0)
 S ROOT=$NA(^TMP("GMRC",$J,"SF513"))
"RTN","GMRCP5",31,0)
 ;
"RTN","GMRCP5",32,0)
 K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5",33,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",34,0)
 Q
"RTN","GMRCP5",35,0)
 ;
"RTN","GMRCP5",36,0)
EN(GMRCIFN,GMRCCPY,GMRCDEV,GMRCSTAT) ;Entry point into routine -GMRCIFN=IFN from file 123
"RTN","GMRCP5",37,0)
 ;GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",38,0)
 ;
"RTN","GMRCP5",39,0)
 N GMRCPLEN,GMRCTASK
"RTN","GMRCP5",40,0)
 ;
"RTN","GMRCP5",41,0)
 S GMRCSTAT=0
"RTN","GMRCP5",42,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",43,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",44,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCP5",45,0)
 ;
"RTN","GMRCP5",46,0)
 I $D(GMRCDEV) D  Q
"RTN","GMRCP5",47,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY,GMRCDEV)
"RTN","GMRCP5",48,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",49,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",50,0)
 ;
"RTN","GMRCP5",51,0)
 I '$D(GMRCCPY) S GMRCCPY=$$CCOPY Q:(GMRCCPY=U)
"RTN","GMRCP5",52,0)
 Q:'$$DEVICE
"RTN","GMRCP5",53,0)
 ;
"RTN","GMRCP5",54,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",55,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY)
"RTN","GMRCP5",56,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",57,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",58,0)
 .W "  ",$P(GMRCSTAT,U,2) H 2
"RTN","GMRCP5",59,0)
 ;
"RTN","GMRCP5",60,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,0)
"RTN","GMRCP5",61,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",62,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",63,0)
 ;
"RTN","GMRCP5",64,0)
 Q
"RTN","GMRCP5",65,0)
 ;
"RTN","GMRCP5",66,0)
SEL ;Select the consult/request to print
"RTN","GMRCP5",67,0)
 K GMRCQUT,DTOUT,DIRUOUT,GMRCSEL
"RTN","GMRCP5",68,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W $C(7),!,"No Orders To Print!",! S GMRCQUT=1 Q
"RTN","GMRCP5",69,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCP5",70,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK
"RTN","GMRCP5",71,0)
 I $S('$D(GMRCSEL):1,'$L(GMRCSEL):1,1:0) D SEL^GMRCA2 I $D(DTOUT)!($D(DIRUOUT)) S GMRCQUT=1 Q
"RTN","GMRCP5",72,0)
 I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,GMRCSEL="":1,1:0) W $C(7),!,"Select A Number In The Range 1 To "_BLK G SEL
"RTN","GMRCP5",73,0)
 I GMRCSEL="" S GMRCQUT=1 Q
"RTN","GMRCP5",74,0)
 S GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCP5",75,0)
 I $S('$L(GMRCND):1,1:0) S GMRCMSG="The Consult to print is not defined in the list to select from!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCP5",76,0)
 Q
"RTN","GMRCP5",77,0)
 ;
"RTN","GMRCP5",78,0)
QUEUE(GMRCIFN,GMRCCPY,GMRCDEV) ;
"RTN","GMRCP5",79,0)
 ;
"RTN","GMRCP5",80,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",81,0)
 N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",82,0)
 ;
"RTN","GMRCP5",83,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513"
"RTN","GMRCP5",84,0)
 ;
"RTN","GMRCP5",85,0)
 I $D(GMRCDEV) S ZTIO=GMRCDEV
"RTN","GMRCP5",86,0)
 E  S ZTIO=ION
"RTN","GMRCP5",87,0)
 ;
"RTN","GMRCP5",88,0)
 S ZTDTH=$H
"RTN","GMRCP5",89,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCIFN)_",0,1,"""_(GMRCCPY)_""",0)"
"RTN","GMRCP5",90,0)
 D ^%ZTLOAD
"RTN","GMRCP5",91,0)
 D:'$D(GMRCDEV) ^%ZISC
"RTN","GMRCP5",92,0)
 ;
"RTN","GMRCP5",93,0)
 Q $G(ZTSK)
"RTN","GMRCP5",94,0)
 ;
"RTN","GMRCP5",95,0)
CCOPY() ; Determine if this is a "Chart" copy or a "Working" copy
"RTN","GMRCP5",96,0)
 ;
"RTN","GMRCP5",97,0)
 N GMRCSTAT,GMRCX,GMRCDEF
"RTN","GMRCP5",98,0)
 ;
"RTN","GMRCP5",99,0)
 ;  GMRCDEF=1   CHART
"RTN","GMRCP5",100,0)
 ;  GMRCDEF=0   WORKING
"RTN","GMRCP5",101,0)
 ;
"RTN","GMRCP5",102,0)
 S GMRCSTAT=$G(^GMR(123,GMRCIFN,0)) Q:'$L(GMRCSTAT) ""
"RTN","GMRCP5",103,0)
 S GMRCSTAT=$P(GMRCSTAT,U,12)
"RTN","GMRCP5",104,0)
 S GMRCDEF=(GMRCSTAT=2)
"RTN","GMRCP5",105,0)
 ;
"RTN","GMRCP5",106,0)
 F  D  Q:$L(GMRCX)
"RTN","GMRCP5",107,0)
 .;
"RTN","GMRCP5",108,0)
 .W !,$$COPY(GMRCDEF)_" Copy (Y/N)? Y//"
"RTN","GMRCP5",109,0)
 .R GMRCX:DTIME E  S GMRCX=U
"RTN","GMRCP5",110,0)
 .Q:(GMRCX[U)
"RTN","GMRCP5",111,0)
 .;
"RTN","GMRCP5",112,0)
 .S:'$L(GMRCX) GMRCX="Y"
"RTN","GMRCP5",113,0)
 .S GMRCX=$E(GMRCX,1)
"RTN","GMRCP5",114,0)
 .S GMRCX=$TR(GMRCX,"ynwc","YNWC")
"RTN","GMRCP5",115,0)
 .;
"RTN","GMRCP5",116,0)
 .I '("YNWC"[GMRCX) S GMRCX="?"
"RTN","GMRCP5",117,0)
 .;
"RTN","GMRCP5",118,0)
 .I GMRCX["?" D  S GMRCX="" Q
"RTN","GMRCP5",119,0)
 ..W !
"RTN","GMRCP5",120,0)
 ..W !,"    Type 'Y' To Print A '"_$$COPY(GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",121,0)
 ..W !," or Type 'N' To Print A '"_$$COPY('GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",122,0)
 ..W !," or Type 'C' To Print A 'Chart' Copy Of The Form 513,"
"RTN","GMRCP5",123,0)
 ..W !," or Type 'W' To Print A 'Working' Copy Of The Form 513."
"RTN","GMRCP5",124,0)
 ..W !
"RTN","GMRCP5",125,0)
 ;
"RTN","GMRCP5",126,0)
 I (GMRCX="Y") Q $E($$COPY(GMRCDEF),1)
"RTN","GMRCP5",127,0)
 I (GMRCX="N") Q $E($$COPY('GMRCDEF),1)
"RTN","GMRCP5",128,0)
 Q GMRCX
"RTN","GMRCP5",129,0)
 ;
"RTN","GMRCP5",130,0)
COPY(X) Q:X "Chart" Q "Working"
"RTN","GMRCP5",131,0)
 ;
"RTN","GMRCP5",132,0)
DEVICE() ;Ask output device / set up output device print parameters
"RTN","GMRCP5",133,0)
 N POP,%ZIS,%IS
"RTN","GMRCP5",134,0)
 S POP=0,%ZIS="MQ" D ^%ZIS
"RTN","GMRCP5",135,0)
 Q $S(POP:0,IO="":0,1:1)
"RTN","GMRCP5",136,0)
 ;
"RTN","GMRCP5",137,0)
 ;
"RTN","GMRCP5",138,0)
SETUP ;
"RTN","GMRCP5",139,0)
 ;
"RTN","GMRCP5",140,0)
 N LINE,%ZIS,%IS,POP,IOP
"RTN","GMRCP5",141,0)
 ;
"RTN","GMRCP5",142,0)
 W !!,"Print consults printer setup page.",!
"RTN","GMRCP5",143,0)
 K IOP S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","GMRCP5",144,0)
 ;
"RTN","GMRCP5",145,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",146,0)
 .;
"RTN","GMRCP5",147,0)
 .N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",148,0)
 .N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",149,0)
 .;
"RTN","GMRCP5",150,0)
 .S ZTDESC="CONSULT/REQUEST PACKAGE PRINTER TEST PAGE"
"RTN","GMRCP5",151,0)
 .S ZTIO=ION,ZTDTH=$H,ZTRTN="SETPRNT^GMRCP5"
"RTN","GMRCP5",152,0)
 .S ZTSAVE("DUZ")=""
"RTN","GMRCP5",153,0)
 .;
"RTN","GMRCP5",154,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","GMRCP5",155,0)
 .;
"RTN","GMRCP5",156,0)
 .I ZTSK W !!,"Queued as task #",ZTSK
"RTN","GMRCP5",157,0)
 .E  W !!,"  not queued."
"RTN","GMRCP5",158,0)
 ;
"RTN","GMRCP5",159,0)
SETPRNT ;
"RTN","GMRCP5",160,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCP5",161,0)
 N LINE
"RTN","GMRCP5",162,0)
 U IO D
"RTN","GMRCP5",163,0)
 .W @IOF,1
"RTN","GMRCP5",164,0)
 .W !,2
"RTN","GMRCP5",165,0)
 .W !,3,"           *******CONSULTS PRINT SETUP PAGE*******"
"RTN","GMRCP5",166,0)
 .W !,4
"RTN","GMRCP5",167,0)
 .W !,5,?4,$$REPEAT^XLFSTR("*",70)
"RTN","GMRCP5",168,0)
 .W !,6,?4," Printed by: ",$$GET1^DIQ(200,+$G(DUZ),.01)," on "
"RTN","GMRCP5",169,0)
 .W $$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCP5",170,0)
 .W !,7,?4,$$REPEAT^XLFSTR("*",70)
"RTN","GMRCP5",171,0)
 .W !,8
"RTN","GMRCP5",172,0)
 .W !,9,"     Print Device: ",$G(ION)
"RTN","GMRCP5",173,0)
 .W !,10,"    Terminal Type: ",$G(IOST)
"RTN","GMRCP5",174,0)
 .W !,11,"    Defined lines per page for this device: ",+$G(IOSL)
"RTN","GMRCP5",175,0)
 .W !,12,"    Defined margin width for this device: ",+$G(IOM)
"RTN","GMRCP5",176,0)
 .W !,13
"RTN","GMRCP5",177,0)
 .W !,14," There should be numbers listed down the lefthand side of"
"RTN","GMRCP5",178,0)
 .W !,15," this page all the way to the bottom. The number at the"
"RTN","GMRCP5",179,0)
 .W !,16," bottom of the page is the number of lines the PRINTER"
"RTN","GMRCP5",180,0)
 .W !,17," thinks there are on a page. The COMPUTER thinks there are ",+$G(IOSL)
"RTN","GMRCP5",181,0)
 .W !,18," lines on a page. The number at the bottom of the page needs to"
"RTN","GMRCP5",182,0)
 .W !,19," be EQUAL to ",+$G(IOSL)," so the consults program can print"
"RTN","GMRCP5",183,0)
 .W !,20," without running off the end of the page. If the number at the"
"RTN","GMRCP5",184,0)
 .W !,21," bottom of the page is NOT EQUAL to ",+$G(IOSL)," then have"
"RTN","GMRCP5",185,0)
 .W !,22," someone in IRM adjust the"
"RTN","GMRCP5",186,0)
 .W !,23
"RTN","GMRCP5",187,0)
 .W !,24," DEVICE file (file 3.5) *PAGE LENGTH field (#11)"
"RTN","GMRCP5",188,0)
 .W !,25,"           for device: ",$G(ION)
"RTN","GMRCP5",189,0)
 .W !,26
"RTN","GMRCP5",190,0)
 .W !,27," and the TERMINAL TYPE file (file 3.2) PAGE LENGTH field (#3)"
"RTN","GMRCP5",191,0)
 .W !,28,"    for terminal type: ",$G(IOST)
"RTN","GMRCP5",192,0)
 .W !,29
"RTN","GMRCP5",193,0)
 .W !,30," to be a value EQUAL to the number at the bottom of the page."
"RTN","GMRCP5",194,0)
 .F LINE=31:1:100 W !,LINE
"RTN","GMRCP5",195,0)
 U IO(0) D ^%ZISC
"RTN","GMRCP5",196,0)
 ;
"RTN","GMRCP5",197,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5",198,0)
 ;
"RTN","GMRCP5",199,0)
 Q
"RTN","GMRCP5",200,0)
 ;
"RTN","GMRCP5A")
0^2^B53674611
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - TIU Results) ;7/15/98  13:00
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13**;Dec 27, 1997
"RTN","GMRCP5A",3,0)
 ;
"RTN","GMRCP5A",4,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI) ;
"RTN","GMRCP5A",5,0)
 ;
"RTN","GMRCP5A",6,0)
 ; Input Arguments:
"RTN","GMRCP5A",7,0)
 ;
"RTN","GMRCP5A",8,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",9,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",10,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",12,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",13,0)
 ;
"RTN","GMRCP5A",14,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",15,0)
 ;
"RTN","GMRCP5A",16,0)
 I GMRCGUI D FORMAT(80),ASSMBL^GMRCP5C(GMRCGUI,80) Q
"RTN","GMRCP5A",17,0)
 ;
"RTN","GMRCP5A",18,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",19,0)
 ;
"RTN","GMRCP5A",20,0)
 U IO D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM),PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",21,0)
 ;
"RTN","GMRCP5A",22,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",23,0)
 ;
"RTN","GMRCP5A",24,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",25,0)
 ;
"RTN","GMRCP5A",26,0)
 Q
"RTN","GMRCP5A",27,0)
 ;
"RTN","GMRCP5A",28,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",29,0)
 ;
"RTN","GMRCP5A",30,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",31,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",32,0)
 N GMRCFTR,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",33,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",34,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",35,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",36,0)
 ;
"RTN","GMRCP5A",37,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",38,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",39,0)
 Q:'(DFN)
"RTN","GMRCP5A",40,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",41,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",42,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",43,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",44,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",45,0)
 ;
"RTN","GMRCP5A",46,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",47,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",48,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",49,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",50,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",51,0)
 ;
"RTN","GMRCP5A",52,0)
 I +$P(GMRCRD,U,20),(TIUFLG)!($P(GMRCRD,U,12)=2) D PRINT^GMRCTIUP(GMRCIFN,0,0)
"RTN","GMRCP5A",53,0)
 ;
"RTN","GMRCP5A",54,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",55,0)
 .;
"RTN","GMRCP5A",56,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",57,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",58,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",59,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",60,0)
 ;
"RTN","GMRCP5A",61,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",62,0)
 ;
"RTN","GMRCP5A",63,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",64,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",65,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",66,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",67,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",68,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",69,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",70,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",71,0)
 ;
"RTN","GMRCP5A",72,0)
 I $P(GMRCRD,U,12)=1  D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",73,0)
 I '$D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",74,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",75,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",76,0)
 ;
"RTN","GMRCP5A",77,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",78,0)
 .;
"RTN","GMRCP5A",79,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",80,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT
"RTN","GMRCP5A",81,0)
 ..N GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV,GMRCENT,GMRCVIS,GMRCVLOC
"RTN","GMRCP5A",82,0)
 ..;
"RTN","GMRCP5A",83,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT","GMRCVIS","GMRCENT","GMRCVLOC" D
"RTN","GMRCP5A",84,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",85,0)
 ..;
"RTN","GMRCP5A",86,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",87,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",88,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" continued.")
"RTN","GMRCP5A",89,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",90,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",91,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",92,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",93,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",94,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",95,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",96,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",97,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",98,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",99,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",100,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",101,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",102,0)
 ..;extra signers
"RTN","GMRCP5A",103,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",104,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",105,0)
 ... D SUB("F","RES",GMRCNDX," Concurrent Signatures: ")
"RTN","GMRCP5A",106,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",107,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",108,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",109,0)
 ..;
"RTN","GMRCP5A",110,0)
 ..I GMRCNT D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",111,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5A",112,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0))
"RTN","GMRCP5A",113,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",114,0)
 ..I $L($G(GMRCENT)) D
"RTN","GMRCP5A",115,0)
 ...S GMRCX=" Entry Date: "_$$EXDT($G(GMRCENT))
"RTN","GMRCP5A",116,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",117,0)
 ..I $L($G(GMRCVIS)) S GMRCX=" Visit: "_$$EXDT($G(GMRCVIS)) D
"RTN","GMRCP5A",118,0)
 ...I $L($G(GMRCVLOC)) S GMRCX=GMRCX_"   "_GMRCVLOC
"RTN","GMRCP5A",119,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",120,0)
 ..I $L($G(GMRCVLOC)) S GMRCX=GMRCVLOC
"RTN","GMRCP5A",121,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",122,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",123,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",124,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",125,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",126,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",127,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",128,0)
 ..;
"RTN","GMRCP5A",129,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",130,0)
 ..;
"RTN","GMRCP5A",131,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",132,0)
 ;
"RTN","GMRCP5A",133,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",134,0)
 ;
"RTN","GMRCP5A",135,0)
 Q
"RTN","GMRCP5A",136,0)
 ;
"RTN","GMRCP5A",137,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",138,0)
 ;
"RTN","GMRCP5A",139,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",140,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",141,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",142,0)
 I (X[".") S DATE=$P(X,".",1),TIME=1
"RTN","GMRCP5A",143,0)
 E  S DATE=X,TIME=0
"RTN","GMRCP5A",144,0)
 S Y=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","GMRCP5A",145,0)
 I TIME D
"RTN","GMRCP5A",146,0)
 .S TIME=X#1*10000+10000\1
"RTN","GMRCP5A",147,0)
 .S HR=$E(TIME,2,3)
"RTN","GMRCP5A",148,0)
 .S MN=$E(TIME,4,5)
"RTN","GMRCP5A",149,0)
 .S PD="am" S:(HR=12) PD="pm" S:(HR>12) HR=HR-12,PD="pm" S:(HR=0) HR=12
"RTN","GMRCP5A",150,0)
 .S Y=Y_" "_HR_":"_MN_PD
"RTN","GMRCP5A",151,0)
 Q Y
"RTN","GMRCP5A",152,0)
 ;
"RTN","GMRCP5A",153,0)
CENTER(X) ;
"RTN","GMRCP5A",154,0)
 ;
"RTN","GMRCP5A",155,0)
 N TEXT,COL
"RTN","GMRCP5A",156,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",157,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",158,0)
 Q TEXT
"RTN","GMRCP5A",159,0)
 ;
"RTN","GMRCP5A",160,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",161,0)
 ;
"RTN","GMRCP5A",162,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",163,0)
 N LINECNT
"RTN","GMRCP5A",164,0)
 ;
"RTN","GMRCP5A",165,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",166,0)
 ;
"RTN","GMRCP5A",167,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",168,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",169,0)
 ;
"RTN","GMRCP5A",170,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",171,0)
 Q
"RTN","GMRCP5A",172,0)
 ;
"RTN","GMRCP5A",173,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",174,0)
 ;
"RTN","GMRCP5A",175,0)
 N NEXT
"RTN","GMRCP5A",176,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",177,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",178,0)
 Q
"RTN","GMRCP5A",179,0)
 ;
"RTN","GMRCP5A",180,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",181,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",182,0)
 ;
"RTN","GMRCP5B")
0^3^B31920873
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;6/24/98  13:06
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 Q
"RTN","GMRCP5B",5,0)
 ;
"RTN","GMRCP5B",6,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",7,0)
 ;
"RTN","GMRCP5B",8,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",9,0)
 ;
"RTN","GMRCP5B",10,0)
REQUEST ;
"RTN","GMRCP5B",11,0)
 N GMRCX
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",14,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",15,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",16,0)
 ;
"RTN","GMRCP5B",17,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",18,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",19,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"            Care Team: "_GMRCX)
"RTN","GMRCP5B",20,0)
 ;
"RTN","GMRCP5B",21,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",22,0)
 ;
"RTN","GMRCP5B",23,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",24,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",25,0)
 ;
"RTN","GMRCP5B",26,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",27,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",28,0)
 E  D
"RTN","GMRCP5B",29,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",30,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",31,0)
 ;
"RTN","GMRCP5B",32,0)
 Q
"RTN","GMRCP5B",33,0)
PDIAG ;
"RTN","GMRCP5B",34,0)
 ;
"RTN","GMRCP5B",35,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",36,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",37,0)
 ;
"RTN","GMRCP5B",38,0)
 S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",39,0)
 S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",40,0)
 S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",41,0)
 S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",42,0)
 S:$L(GMRCPGR) GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",43,0)
 I '$L(GMRCPGR) S GMRCPGR=$P(GMRCX,U,2) S:$L(GMRCPGR) GMRCPGR="(Phone: "_GMRCPGR_")"
"RTN","GMRCP5B",44,0)
 ;
"RTN","GMRCP5B",45,0)
 S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",46,0)
 S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+GMRCQSTR,8)
"RTN","GMRCP5B",47,0)
 S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",48,0)
 ;
"RTN","GMRCP5B",49,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: "_GMRCPGR)
"RTN","GMRCP5B",50,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",51,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",54,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",58,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",59,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",60,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",61,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",62,0)
 ;
"RTN","GMRCP5B",63,0)
 Q
"RTN","GMRCP5B",64,0)
 ;
"RTN","GMRCP5B",65,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",66,0)
 ;
"RTN","GMRCP5B",67,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,GMRCX,VAIN,VAPA,VAERR
"RTN","GMRCP5B",68,0)
 ;
"RTN","GMRCP5B",69,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",70,0)
 ;
"RTN","GMRCP5B",71,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",72,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",73,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",74,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",75,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",76,0)
 ;
"RTN","GMRCP5B",77,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",78,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",79,0)
 ;
"RTN","GMRCP5B",80,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",81,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",82,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",83,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",84,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",85,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",86,0)
 E  D
"RTN","GMRCP5B",87,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",88,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",89,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",90,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",91,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",92,0)
 ;
"RTN","GMRCP5B",93,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",94,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",95,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",96,0)
 ;
"RTN","GMRCP5B",97,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",98,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",99,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",100,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",101,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",102,0)
 ;
"RTN","GMRCP5B",103,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",104,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",105,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",106,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",107,0)
 ;
"RTN","GMRCP5B",108,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",109,0)
 ;
"RTN","GMRCP5B",110,0)
 F SUB=0,1 D
"RTN","GMRCP5B",111,0)
 .D BLD("FTR",SUB,1,0,$P($G(^DPT(GMRCDFN,0)),U,1)_"  "_GMRCELIG)
"RTN","GMRCP5B",112,0)
 .I 'SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5B",113,0)
 .I SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET  (Continued)")
"RTN","GMRCP5B",114,0)
 .D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",115,0)
 .D BLD("FTR",SUB,0,20,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",116,0)
 .D BLD("FTR",SUB,0,45,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",117,0)
 ;
"RTN","GMRCP5B",118,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",119,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX)) BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",120,0)
 ;
"RTN","GMRCP5B",121,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",122,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",123,0)
 ;
"RTN","GMRCP5B",124,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",125,0)
 ;
"RTN","GMRCP5B",126,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",127,0)
 ;
"RTN","GMRCP5B",128,0)
 Q
"RTN","GMRCP5B",129,0)
 ;
"RTN","GMRCP5B",130,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",131,0)
 ;
"RTN","GMRCP5B",132,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",133,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",134,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",135,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",136,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",137,0)
 ;
"RTN","GMRCP5B",138,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",139,0)
 ;
"RTN","GMRCP5B",140,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",141,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",142,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",143,0)
 I (X[".") S DATE=$P(X,".",1),TIME=1
"RTN","GMRCP5B",144,0)
 E  S DATE=X,TIME=0
"RTN","GMRCP5B",145,0)
 S Y=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","GMRCP5B",146,0)
 I TIME D
"RTN","GMRCP5B",147,0)
 .S TIME=X#1*10000+10000\1
"RTN","GMRCP5B",148,0)
 .S HR=$E(TIME,2,3)
"RTN","GMRCP5B",149,0)
 .S MN=$E(TIME,4,5)
"RTN","GMRCP5B",150,0)
 .S PD="am" S:(HR=12) PD="pm" S:(HR>12) HR=HR-12,PD="pm" S:(HR=0) HR=12
"RTN","GMRCP5B",151,0)
 .S Y=Y_" "_HR_":"_MN_PD
"RTN","GMRCP5B",152,0)
 Q Y
"RTN","GMRCP5B",153,0)
 ;
"RTN","GMRCP5B",154,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",155,0)
 ;
"RTN","GMRCP5B",156,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",157,0)
 ;
"RTN","GMRCP5B",158,0)
 ;
"RTN","GMRCP5B",159,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",160,0)
 ;
"RTN","GMRCP5B",161,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",162,0)
 N LINECNT
"RTN","GMRCP5B",163,0)
 ;
"RTN","GMRCP5B",164,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",165,0)
 ;
"RTN","GMRCP5B",166,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",167,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",168,0)
 ;
"RTN","GMRCP5B",169,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",170,0)
 Q
"RTN","GMRCP5B",171,0)
 ;
"RTN","GMRCP5B",172,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",173,0)
 ;
"RTN","GMRCP5B",174,0)
 N NEXT
"RTN","GMRCP5B",175,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",176,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",177,0)
 Q
"RTN","GMRCP5B",178,0)
 ;
"RTN","GMRCP5B",179,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",180,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",181,0)
 ;
"RTN","GMRCTIUP")
0^4^B57515840
"RTN","GMRCTIUP",1,0)
GMRCTIUP ;SLC/DCM - TIU utilities for exchanging info with Consults ;7/16/98  02:11
"RTN","GMRCTIUP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13**;DEC 27, 1997
"RTN","GMRCTIUP",3,0)
HDR(GMRCTUPR,GMRCGLB,COUNT,FROM) ;Get Source info for header of display
"RTN","GMRCTIUP",4,0)
 ;and place data in ^TMP( global. Do Not Show Any Results
"RTN","GMRCTIUP",5,0)
 ;GMRCTUPR=TIU record being sought
"RTN","GMRCTIUP",6,0)
 ;GMRCGLOB=Global where data goes - i.e., ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,LINECT,0)
"RTN","GMRCTIUP",7,0)
 ;COUNT=Count of where current line is to go in ^TMP( global
"RTN","GMRCTIUP",8,0)
 ;FROM=flag to tell whether to add Addendum TIU # or not 0=NO, Otherwise addendum number
"RTN","GMRCTIUP",9,0)
 N DR,GMRCTMP
"RTN","GMRCTIUP",10,0)
 S:'$D(FROM) FROM=""
"RTN","GMRCTIUP",11,0)
 S DR=".01;.05;.07;.09;1201;1202;1204;1205;1208;1302",GMRCERR=""
"RTN","GMRCTIUP",12,0)
 D EXTRACT^TIULQ(GMRCPTR,"LOCAL",.GMRCERR,DR)
"RTN","GMRCTIUP",13,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",14,0)
 S @GMRCGLB@(COUNT,0)="Source Information",COUNT=COUNT+1,@GMRCGLB@(COUNT,0)=""
"RTN","GMRCTIUP",15,0)
 S @GMRCGLB@(COUNT,0)="  Document Status: "_LOCAL(GMRCPTR,.05,"E"),COUNT=COUNT+1
"RTN","GMRCTIUP",16,0)
 S @GMRCGLB@(COUNT,0)="       Entry Date: "_$P($G(LOCAL(GMRCPTR,1201,"E")),":",1,2),COUNT=COUNT+1
"RTN","GMRCTIUP",17,0)
 S @GMRCGLB@(COUNT,0)="            Visit: "_$G(LOCAL(GMRCPTR,.07,"E"))_"  "_$G(LOCAL(GMRCPTR,1205,"E"))
"RTN","GMRCTIUP",18,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUP",19,0)
 S @GMRCGLB@(COUNT,0)="           Author: "_LOCAL(GMRCPTR,1202,"E")
"RTN","GMRCTIUP",20,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUP",21,0)
 S @GMRCGLB@(COUNT,0)="  Expected Signer: "_$E(LOCAL(GMRCPTR,1204,"E")_TAB,1,22)_$E(TAB,1,5)_"Expected Cosigner: "_$S($L($G(LOCAL(GMRCPTR,1208,"E"))):LOCAL(GMRCPTR,1208,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",22,0)
 S @GMRCGLB@(COUNT,0)="       Entered By: "_$E(LOCAL(GMRCPTR,1302,"E")_TAB,1,30)_"TIU Document #: "_GMRCTUPR,COUNT=COUNT+1
"RTN","GMRCTIUP",23,0)
 S @GMRCGLB@(COUNT,0)=$S(+FROM:"  TIU Addendum Document #: "_FROM,1:"")_$S(+FROM:$E(TAB,1,10),1:"     ")_"     Urgency: "_$S($L($G(LOCAL(GMRCPTR,.09,"E"))):LOCAL(GMRCPTR,.09,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",24,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",25,0)
 ;S GMRCTMP=$G(LOCAL(GMRCPTR,.05,"E")) S GMRCTMP=$S($L(GMRCTMP)&(GMRCTMP'="COMPLETED"):GMRCTMP,GMRCTMP="COMPLETED":"UNVERIFIED",1:"UNSIGNED")
"RTN","GMRCTIUP",26,0)
 ;S @GMRCGLB@(COUNT,0)="You may not VIEW this "_GMRCTMP_" "_$G(LOCAL(GMRCPTR,.01,"E"))_" consult"_$S(+FROM:" Addendum",1:"")_".",COUNT=COUNT+1
"RTN","GMRCTIUP",27,0)
 ;S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",28,0)
 K LOCAL
"RTN","GMRCTIUP",29,0)
 Q
"RTN","GMRCTIUP",30,0)
PRINT(GMRCO,LINECT,GMRCRT) ;get TIU results and prepare them for printing on the 513
"RTN","GMRCTIUP",31,0)
 ;GMRCRT=Flag from RT^GMRCA1 indicating that result request is from there: GMRCRT=0 means 'NO', GRMRCRT=1 means 'YES" (and ES is appended to TIU main result); also, 
"RTN","GMRCTIUP",32,0)
 ;    No result is passed back to print on the 513 if GMRCRT=0.
"RTN","GMRCTIUP",33,0)
 ;GMRCTUFN=IEN of the TIU result from file 8925
"RTN","GMRCTIUP",34,0)
 ;GMRCSIG=signature block name of signer : GMRCSDT=date result was signed
"RTN","GMRCTIUP",35,0)
 ;GMRCSIGT=signers block title : GMRCTUFN=TIU IEN of the result record
"RTN","GMRCTIUP",36,0)
 ;GMRCCSIG=cosigners block name : GMRCCSDT=date cosigner signed
"RTN","GMRCTIUP",37,0)
 ;GMRCCTIT=cosigners block title : GMRCSIGM=Signature mode (E:ELECTRONIC/C:CHART)
"RTN","GMRCTIUP",38,0)
 N GMRCTUFN,TAB
"RTN","GMRCTIUP",39,0)
 S:'$D(GMRCRT) GMRCRT=0
"RTN","GMRCTIUP",40,0)
 D GETRSLTS(GMRCO,.GMRCAR) ;I $D(GMRCQUT) D:$D(GMRCMSG) EXAC^GMRCADC(GMRCMSG) K GMRCMSG,GMRCRT Q
"RTN","GMRCTIUP",41,0)
 S GLOBAL="^TMP(""GMRCR"",$J,""GMRCTIU"")",TAB="",$P(TAB," ",31)=""
"RTN","GMRCTIUP",42,0)
 K ^TMP("GMRCR",$J,"RES"),^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCTIUP",43,0)
 S (GMRCND,GMRCPTR)="" F  K @GLOBAL S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  S GMRCPKG=$P(GMRCND,";",2),GMRCPTR=$P(GMRCND,";",1) D
"RTN","GMRCTIUP",44,0)
 .S DR=".01;.03;.07;1201;1204;1205;1501;1502;1503;1504;1505;1506;1507;1508;1509;1510;1511;1601;1602;1603;1604;1605"
"RTN","GMRCTIUP",45,0)
 .I $E(GMRCPKG,1,3)="TIU" D EXTRACT^TIULQ(GMRCPTR,GLOBAL,.GMRCERR,DR,"",1,"") D
"RTN","GMRCTIUP",46,0)
 ..I '$O(@GLOBAL@(GMRCPTR,"TEXT",0)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="No Results Exist For TIU Record # "_GMRCPTR_"." Q
"RTN","GMRCTIUP",47,0)
 ..;I +$G(GMRCRT) D HDR(GMRCPTR,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""TEXT"")",.LINECT,0)
"RTN","GMRCTIUP",48,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCVIS")=$G(@GLOBAL@(GMRCPTR,.07))
"RTN","GMRCTIUP",49,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCENT")=$G(@GLOBAL@(GMRCPTR,1201))
"RTN","GMRCTIUP",50,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCVLOC")=$G(@GLOBAL@(GMRCPTR,1205))
"RTN","GMRCTIUP",51,0)
 ..S GMRCSIG=$G(@GLOBAL@(GMRCPTR,1503)),GMRCCSIG=$G(@GLOBAL@(GMRCPTR,1509))
"RTN","GMRCTIUP",52,0)
 ..S:$L(GMRCCSIG)&(GMRCRT) GMRCCSIG=$S($G(@GLOBAL@(GMRCPTR,1511))="electronic":"Signature: /es/",1:"")_GMRCCSIG
"RTN","GMRCTIUP",53,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIG")=$S($L(GMRCSIG):GMRCSIG,1:$G(@GLOBAL@(GMRCPTR,1204)))
"RTN","GMRCTIUP",54,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSDT")=$G(@GLOBAL@(GMRCPTR,1501))
"RTN","GMRCTIUP",55,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGT")=$G(@GLOBAL@(GMRCPTR,1504))
"RTN","GMRCTIUP",56,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGM")=$G(@GLOBAL@(GMRCPTR,1505))
"RTN","GMRCTIUP",57,0)
 ..;get xtra signers
"RTN","GMRCTIUP",58,0)
 ..N XTRA,LINE S (XTRA,LINE)=0 F  S XTRA=$O(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA)) Q:'XTRA  D
"RTN","GMRCTIUP",59,0)
 ...S LINE=LINE+1
"RTN","GMRCTIUP",60,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,0)=$$FMTE^XLFDT(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"DATE"))_$$REPEAT^XLFSTR(" ",7)_^("NAME")
"RTN","GMRCTIUP",61,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,1)=$$REPEAT^XLFSTR(" ",28)_$G(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"TITLE"))
"RTN","GMRCTIUP",62,0)
 ..;cosig info
"RTN","GMRCTIUP",63,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSIG")=GMRCCSIG
"RTN","GMRCTIUP",64,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",65,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,1510))
"RTN","GMRCTIUP",66,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,1511))
"RTN","GMRCTIUP",67,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCRPT")=$G(@GLOBAL@(GMRCPTR,.01))
"RTN","GMRCTIUP",68,0)
 ..I $O(@GLOBAL@(GMRCPTR,"TEXT",0)) D
"RTN","GMRCTIUP",69,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"TEXT",ND)) Q:ND=""  S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=@GLOBAL@(GMRCPTR,"TEXT",ND,0),LINECT=LINECT+1 ;S:'$D(NDS) NDS=ND
"RTN","GMRCTIUP",70,0)
 ...I GMRCRT S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="",LINECT=LINECT+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Signature: /es/"_GMRCSIG_"         Date: "_$G(@GLOBAL@(GMRCPTR,1501)),LINECT=LINECT+1 K NDS
"RTN","GMRCTIUP",71,0)
 ...I GMRCRT,$D(@GLOBAL@(GMRCPTR,1509)),$L(^(1509)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Co-signature: /es/ "_@GLOBAL@(GMRCPTR,1509)_"    Date:  "_$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",72,0)
 ...Q
"RTN","GMRCTIUP",73,0)
 ..I $O(@GLOBAL@(GMRCPTR,"ZADD",0)) S GMRCADD=0 F  S GMRCADD=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD)) Q:GMRCADD=""  D
"RTN","GMRCTIUP",74,0)
 ...S ND1=1
"RTN","GMRCTIUP",75,0)
 ...I '$L(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E")) ;D UNSIGN(GMRCADD,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""ADD"",GMRCADD)",ND1,GMRCPTR) K GMRCTXT Q
"RTN","GMRCTIUP",76,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND)) Q:ND=""  S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND,0)
"RTN","GMRCTIUP",77,0)
 ...S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=""
"RTN","GMRCTIUP",78,0)
 ...I +GMRCRT D
"RTN","GMRCTIUP",79,0)
 ....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Signature: "_$S(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E")="electronic":"/es/ ",1:"")_@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1503,"E")
"RTN","GMRCTIUP",80,0)
 ....S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)_$S(GMRCRT=1:"    Date:  "_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E")),1:"")
"RTN","GMRCTIUP",81,0)
 ....I $L($G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))) D
"RTN","GMRCTIUP",82,0)
 .....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Co-signature: /es/ "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1508,"E"))_"    Date:  "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))
"RTN","GMRCTIUP",83,0)
 ....Q
"RTN","GMRCTIUP",84,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCSGNM")=$S(GMRCRT=1:"/es/",1:"")_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E"))
"RTN","GMRCTIUP",85,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",86,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCNMDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E"))
"RTN","GMRCTIUP",87,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",88,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",89,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCMODE")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E"))
"RTN","GMRCTIUP",90,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSIG")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1509,"E"))
"RTN","GMRCTIUP",91,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"I"))
"RTN","GMRCTIUP",92,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1510,"E"))
"RTN","GMRCTIUP",93,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1511,"E"))
"RTN","GMRCTIUP",94,0)
 ...Q
"RTN","GMRCTIUP",95,0)
 ..I +$G(GMRCRT) D HDR(GMRCPTR,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""TEXT"")",.LINECT,0)
"RTN","GMRCTIUP",96,0)
 ..Q
"RTN","GMRCTIUP",97,0)
 .I $E(GMRCPKG,1,4)="MCAR" S GMRCSR=GMRCND,MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  D
"RTN","GMRCTIUP",98,0)
 ..S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8),ORIFN=$P(^GMR(123,GMRCO,0),"^",3),ORACTION=8,MCGLOBAL="^TMP(""GMRCR"",$J,""MCAR"","_GMRCPTR_")"
"RTN","GMRCTIUP",99,0)
 ..D EN^GMRCTIU3(GMRCO,ORIFN,MCGLOBAL,LINECT) K ^TMP("MC",$J)
"RTN","GMRCTIUP",100,0)
 ..Q
"RTN","GMRCTIUP",101,0)
 .Q
"RTN","GMRCTIUP",102,0)
 K DR,GLOGAL,GMRCSR,GMRCAR,GMRCPKG,GMRCPRNM,MCFILE,MCPROC,ORACTION,ORIFN,MCGLOBAL,ND,ND1
"RTN","GMRCTIUP",103,0)
 Q
"RTN","GMRCTIUP",104,0)
GETNOTE(GMRCO,FILE) ;Get the last result added to the record - this is found in $P(^(0),"^",20)
"RTN","GMRCTIUP",105,0)
 ;Function returns last note added to record.
"RTN","GMRCTIUP",106,0)
 ;If it does not contain the file pointer, it is assumed that
"RTN","GMRCTIUP",107,0)
 ;it pointed to the TIU file 8925
"RTN","GMRCTIUP",108,0)
 ;GMRCO=file 123 IEN
"RTN","GMRCTIUP",109,0)
 ;FILE='MCAR' to get last medicine result pointer
"RTN","GMRCTIUP",110,0)
 ;FILE='TIU' to get last TIU result pointer
"RTN","GMRCTIUP",111,0)
 N X
"RTN","GMRCTIUP",112,0)
 I FILE="TIU" S X=$P(^GMR(123,GMRCO,0),"^",20) I $L(X),'$L($P(X,";",2)) S X=X_";TIU(8925,"
"RTN","GMRCTIUP",113,0)
 I FILE="MCAR" S X=$P(^GMR(123,GMRCO,0),"^",15)
"RTN","GMRCTIUP",114,0)
 Q X
"RTN","GMRCTIUP",115,0)
GETRSLTS(GMRCO,ARRAY) ;Get the results from record and return it in array 'ARRAY')
"RTN","GMRCTIUP",116,0)
 ;Looks for results in $P(^(0),"^",20),$P(^(0),"^",15) and Field 50 multiple
"RTN","GMRCTIUP",117,0)
 ;GMRCO=File 123 IEN
"RTN","GMRCTIUP",118,0)
 ;ARRAY=array to return results pointers in
"RTN","GMRCTIUP",119,0)
 ;ARRAY will be returned as ARRAY("IEN;FILE"), as e.g., "1289;^TIU(8925,"
"RTN","GMRCTIUP",120,0)
 N X
"RTN","GMRCTIUP",121,0)
 S X=$$GETNOTE(GMRCO,"TIU") I $L(X) S:$P(X,";",2)="" X=X_";TIU(8925," S ARRAY(X)=""
"RTN","GMRCTIUP",122,0)
 S X=$$GETNOTE(GMRCO,"MCAR") I $L(X) S ARRAY(X)=""
"RTN","GMRCTIUP",123,0)
 S X="" F  S X=$O(^GMR(123,GMRCO,50,"B",X)) Q:X?1A.E!(X="")  S ARRAY(X)=""
"RTN","GMRCTIUP",124,0)
 Q
"VER")
8.0^22.0
**END**
**END**
