KIDS Distribution saved on Jan 11, 2007@07:46:57
Released FH*5.5*5 SEQ #7
**KIDS**:FH*5.5*5^

**INSTALL NAME**
FH*5.5*5
"BLD",5880,0)
FH*5.5*5^DIETETICS^0^3070111^y
"BLD",5880,1,0)
^^2^2^3060417^^
"BLD",5880,1,1,0)
A patch for outpatient standing orders, supplemental feeding
"BLD",5880,1,2,0)
and other fixes.
"BLD",5880,4,0)
^9.64PA^119.6^4
"BLD",5880,4,115,0)
115
"BLD",5880,4,115,2,0)
^9.641^115.017^4
"BLD",5880,4,115,2,115,0)
NUTRITION PERSON  (File-top level)
"BLD",5880,4,115,2,115,1,0)
^9.6411^.01^1
"BLD",5880,4,115,2,115,1,.01,0)
NAME
"BLD",5880,4,115,2,115.016,0)
RECURRING MEALS  (sub-file)
"BLD",5880,4,115,2,115.016,1,0)
^9.6411^^0
"BLD",5880,4,115,2,115.017,0)
SPECIAL MEALS  (sub-file)
"BLD",5880,4,115,2,115.017,1,0)
^9.6411^^
"BLD",5880,4,115,2,115.018,0)
GUEST MEALS  (sub-file)
"BLD",5880,4,115,2,115.018,1,0)
^9.6411^^0
"BLD",5880,4,115,222)
y^y^p^^^^n^^n
"BLD",5880,4,115,224)

"BLD",5880,4,118.2,0)
118.2
"BLD",5880,4,118.2,222)
y^y^f^^^^n
"BLD",5880,4,119.6,0)
119.6
"BLD",5880,4,119.6,222)
y^y^f^^^^n
"BLD",5880,4,119.9,0)
119.9
"BLD",5880,4,119.9,2,0)
^9.641^119.9^1
"BLD",5880,4,119.9,2,119.9,0)
FH SITE PARAMETERS  (File-top level)
"BLD",5880,4,119.9,2,119.9,1,0)
^9.6411^59^15
"BLD",5880,4,119.9,2,119.9,1,9,0)
AUTHORIZOR 1
"BLD",5880,4,119.9,2,119.9,1,10,0)
AUTHORIZOR 2
"BLD",5880,4,119.9,2,119.9,1,11,0)
AUTHORIZOR 3
"BLD",5880,4,119.9,2,119.9,1,12,0)
AUTHORIZOR 4
"BLD",5880,4,119.9,2,119.9,1,13,0)
AUTHORIZOR 5
"BLD",5880,4,119.9,2,119.9,1,50,0)
AUTHORIZOR 6
"BLD",5880,4,119.9,2,119.9,1,51,0)
AUTHORIZOR 7
"BLD",5880,4,119.9,2,119.9,1,52,0)
AUTHORIZOR 8
"BLD",5880,4,119.9,2,119.9,1,53,0)
AUTHORIZOR 9
"BLD",5880,4,119.9,2,119.9,1,54,0)
AUTHORIZOR 10
"BLD",5880,4,119.9,2,119.9,1,55,0)
AUTHORIZOR 11
"BLD",5880,4,119.9,2,119.9,1,56,0)
AUTHORIZOR 12
"BLD",5880,4,119.9,2,119.9,1,57,0)
AUTHORIZOR 13
"BLD",5880,4,119.9,2,119.9,1,58,0)
AUTHORIZOR 14
"BLD",5880,4,119.9,2,119.9,1,59,0)
AUTHORIZOR 15
"BLD",5880,4,119.9,222)
y^y^p^^^^n^^n
"BLD",5880,4,119.9,224)

"BLD",5880,4,"APDD",115,115)

"BLD",5880,4,"APDD",115,115,.01)

"BLD",5880,4,"APDD",115,115.016)

"BLD",5880,4,"APDD",115,115.017)

"BLD",5880,4,"APDD",115,115.018)

"BLD",5880,4,"APDD",119.9,119.9)

"BLD",5880,4,"APDD",119.9,119.9,9)

"BLD",5880,4,"APDD",119.9,119.9,10)

"BLD",5880,4,"APDD",119.9,119.9,11)

"BLD",5880,4,"APDD",119.9,119.9,12)

"BLD",5880,4,"APDD",119.9,119.9,13)

"BLD",5880,4,"APDD",119.9,119.9,50)

"BLD",5880,4,"APDD",119.9,119.9,51)

"BLD",5880,4,"APDD",119.9,119.9,52)

"BLD",5880,4,"APDD",119.9,119.9,53)

"BLD",5880,4,"APDD",119.9,119.9,54)

"BLD",5880,4,"APDD",119.9,119.9,55)

"BLD",5880,4,"APDD",119.9,119.9,56)

"BLD",5880,4,"APDD",119.9,119.9,57)

"BLD",5880,4,"APDD",119.9,119.9,58)

"BLD",5880,4,"APDD",119.9,119.9,59)

"BLD",5880,4,"B",115,115)

"BLD",5880,4,"B",118.2,118.2)

"BLD",5880,4,"B",119.6,119.6)

"BLD",5880,4,"B",119.9,119.9)

"BLD",5880,6.3)
53
"BLD",5880,"INIT")
POST^FH55P5
"BLD",5880,"KRN",0)
^9.67PA^8989.52^19
"BLD",5880,"KRN",.4,0)
.4
"BLD",5880,"KRN",.401,0)
.401
"BLD",5880,"KRN",.402,0)
.402
"BLD",5880,"KRN",.403,0)
.403
"BLD",5880,"KRN",.5,0)
.5
"BLD",5880,"KRN",.84,0)
.84
"BLD",5880,"KRN",3.6,0)
3.6
"BLD",5880,"KRN",3.8,0)
3.8
"BLD",5880,"KRN",9.2,0)
9.2
"BLD",5880,"KRN",9.8,0)
9.8
"BLD",5880,"KRN",9.8,"NM",0)
^9.68A^66^65
"BLD",5880,"KRN",9.8,"NM",1,0)
FHOMTK1^^0^B13719057
"BLD",5880,"KRN",9.8,"NM",2,0)
FHOMUTL^^0^B46250378
"BLD",5880,"KRN",9.8,"NM",3,0)
FHORD6^^0^B21050058
"BLD",5880,"KRN",9.8,"NM",4,0)
FHORD61^^0^B13439670
"BLD",5880,"KRN",9.8,"NM",5,0)
FHASP^^0^B14729349
"BLD",5880,"KRN",9.8,"NM",6,0)
FHASXR^^0^B8943956
"BLD",5880,"KRN",9.8,"NM",7,0)
FHOMSR1^^0^B28707183
"BLD",5880,"KRN",9.8,"NM",8,0)
FHDCR11^^0^B29757298
"BLD",5880,"KRN",9.8,"NM",9,0)
FHDCR1B^^0^B21288577
"BLD",5880,"KRN",9.8,"NM",10,0)
FHDCR1D^^0^B41347253
"BLD",5880,"KRN",9.8,"NM",11,0)
FHMTK1B^^0^B25025382
"BLD",5880,"KRN",9.8,"NM",12,0)
FHMTK7^^0^B81656381
"BLD",5880,"KRN",9.8,"NM",13,0)
FHOMGP1^^0^B14808548
"BLD",5880,"KRN",9.8,"NM",14,0)
FHOMRR1^^0^B37981700
"BLD",5880,"KRN",9.8,"NM",15,0)
FHSP^^0^B75662627
"BLD",5880,"KRN",9.8,"NM",16,0)
FHSP1^^0^B44709788
"BLD",5880,"KRN",9.8,"NM",17,0)
FHSPED^^0^B70827243
"BLD",5880,"KRN",9.8,"NM",18,0)
FHSPTAB^^0^B9597999
"BLD",5880,"KRN",9.8,"NM",19,0)
FHWADM^^0^B23908953
"BLD",5880,"KRN",9.8,"NM",20,0)
FHOMGC1^^0^B10471500
"BLD",5880,"KRN",9.8,"NM",21,0)
FHDCR1A^^0^B45241377
"BLD",5880,"KRN",9.8,"NM",22,0)
FHPRF1^^0^B45228454
"BLD",5880,"KRN",9.8,"NM",23,0)
FHORD9^^0^B40033221
"BLD",5880,"KRN",9.8,"NM",24,0)
FHOMRBL1^^0^B28450165
"BLD",5880,"KRN",9.8,"NM",25,0)
FHPRO3^^0^B35628181
"BLD",5880,"KRN",9.8,"NM",26,0)
FHORD13^^0^B54149113
"BLD",5880,"KRN",9.8,"NM",27,0)
FHSEL2^^0^B27221100
"BLD",5880,"KRN",9.8,"NM",28,0)
FHORT3^^0^B5199954
"BLD",5880,"KRN",9.8,"NM",29,0)
FHWOR6^^0^B17605966
"BLD",5880,"KRN",9.8,"NM",30,0)
FHORD^^0^B9723467
"BLD",5880,"KRN",9.8,"NM",31,0)
FH55P5^^0^B32445798
"BLD",5880,"KRN",9.8,"NM",32,0)
FHOMRL1^^0^B15819957
"BLD",5880,"KRN",9.8,"NM",33,0)
FHOMGR1^^0^B8112125
"BLD",5880,"KRN",9.8,"NM",34,0)
FHOMTK2^^0^B27468276
"BLD",5880,"KRN",9.8,"NM",35,0)
FHOMSP1^^0^B9628591
"BLD",5880,"KRN",9.8,"NM",36,0)
FHOMRO1^^0^B80090398
"BLD",5880,"KRN",9.8,"NM",37,0)
FHOMRC2^^0^B5901029
"BLD",5880,"KRN",9.8,"NM",38,0)
FHOMRMD^^0^B30220610
"BLD",5880,"KRN",9.8,"NM",39,0)
FHOMSS2^^0^B17440516
"BLD",5880,"KRN",9.8,"NM",40,0)
FHOMSS1^^0^B9007486
"BLD",5880,"KRN",9.8,"NM",41,0)
FHNO2^^0^B34765600
"BLD",5880,"KRN",9.8,"NM",42,0)
FHNO21^^0^B15038178
"BLD",5880,"KRN",9.8,"NM",44,0)
FHNO31^^0^B28958638
"BLD",5880,"KRN",9.8,"NM",45,0)
FHNO41^^0^B18764255
"BLD",5880,"KRN",9.8,"NM",46,0)
FHNO5^^0^B75252666
"BLD",5880,"KRN",9.8,"NM",47,0)
FHNO7^^0^B43514527
"BLD",5880,"KRN",9.8,"NM",48,0)
FHNO8^^0^B24504229
"BLD",5880,"KRN",9.8,"NM",49,0)
FHNO6^^0^B67398732
"BLD",5880,"KRN",9.8,"NM",50,0)
FHMTK1A^^0^B8475642
"BLD",5880,"KRN",9.8,"NM",51,0)
FHPRO1^^0^B38822254
"BLD",5880,"KRN",9.8,"NM",52,0)
FHMTK1^^0^B16147899
"BLD",5880,"KRN",9.8,"NM",53,0)
FHORD81^^0^B69864656
"BLD",5880,"KRN",9.8,"NM",54,0)
FHSP11^^0^B6300547
"BLD",5880,"KRN",9.8,"NM",55,0)
FHOMDPA^^0^B5382769
"BLD",5880,"KRN",9.8,"NM",56,0)
FHOMRO2^^0^B53974540
"BLD",5880,"KRN",9.8,"NM",57,0)
FHSYSP^^0^B2820675
"BLD",5880,"KRN",9.8,"NM",58,0)
FHWOR^^0^B30023684
"BLD",5880,"KRN",9.8,"NM",59,0)
FHOMCBRP^^0^B30743180
"BLD",5880,"KRN",9.8,"NM",60,0)
FHORX1A^^0^B15045653
"BLD",5880,"KRN",9.8,"NM",61,0)
FHORT5A^^0^B26922360
"BLD",5880,"KRN",9.8,"NM",62,0)
FHORE21^^0^B29651478
"BLD",5880,"KRN",9.8,"NM",63,0)
FHOMELT^^0^B3319255
"BLD",5880,"KRN",9.8,"NM",64,0)
FHBIR^^0^B17802791
"BLD",5880,"KRN",9.8,"NM",65,0)
FHPRO^^0^B10948850
"BLD",5880,"KRN",9.8,"NM",66,0)
FHOMWOR^^0^B25425575
"BLD",5880,"KRN",9.8,"NM","B","FH55P5",31)

"BLD",5880,"KRN",9.8,"NM","B","FHASP",5)

"BLD",5880,"KRN",9.8,"NM","B","FHASXR",6)

"BLD",5880,"KRN",9.8,"NM","B","FHBIR",64)

"BLD",5880,"KRN",9.8,"NM","B","FHDCR11",8)

"BLD",5880,"KRN",9.8,"NM","B","FHDCR1A",21)

"BLD",5880,"KRN",9.8,"NM","B","FHDCR1B",9)

"BLD",5880,"KRN",9.8,"NM","B","FHDCR1D",10)

"BLD",5880,"KRN",9.8,"NM","B","FHMTK1",52)

"BLD",5880,"KRN",9.8,"NM","B","FHMTK1A",50)

"BLD",5880,"KRN",9.8,"NM","B","FHMTK1B",11)

"BLD",5880,"KRN",9.8,"NM","B","FHMTK7",12)

"BLD",5880,"KRN",9.8,"NM","B","FHNO2",41)

"BLD",5880,"KRN",9.8,"NM","B","FHNO21",42)

"BLD",5880,"KRN",9.8,"NM","B","FHNO31",44)

"BLD",5880,"KRN",9.8,"NM","B","FHNO41",45)

"BLD",5880,"KRN",9.8,"NM","B","FHNO5",46)

"BLD",5880,"KRN",9.8,"NM","B","FHNO6",49)

"BLD",5880,"KRN",9.8,"NM","B","FHNO7",47)

"BLD",5880,"KRN",9.8,"NM","B","FHNO8",48)

"BLD",5880,"KRN",9.8,"NM","B","FHOMCBRP",59)

"BLD",5880,"KRN",9.8,"NM","B","FHOMDPA",55)

"BLD",5880,"KRN",9.8,"NM","B","FHOMELT",63)

"BLD",5880,"KRN",9.8,"NM","B","FHOMGC1",20)

"BLD",5880,"KRN",9.8,"NM","B","FHOMGP1",13)

"BLD",5880,"KRN",9.8,"NM","B","FHOMGR1",33)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRBL1",24)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRC2",37)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRL1",32)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRMD",38)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRO1",36)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRO2",56)

"BLD",5880,"KRN",9.8,"NM","B","FHOMRR1",14)

"BLD",5880,"KRN",9.8,"NM","B","FHOMSP1",35)

"BLD",5880,"KRN",9.8,"NM","B","FHOMSR1",7)

"BLD",5880,"KRN",9.8,"NM","B","FHOMSS1",40)

"BLD",5880,"KRN",9.8,"NM","B","FHOMSS2",39)

"BLD",5880,"KRN",9.8,"NM","B","FHOMTK1",1)

"BLD",5880,"KRN",9.8,"NM","B","FHOMTK2",34)

"BLD",5880,"KRN",9.8,"NM","B","FHOMUTL",2)

"BLD",5880,"KRN",9.8,"NM","B","FHOMWOR",66)

"BLD",5880,"KRN",9.8,"NM","B","FHORD",30)

"BLD",5880,"KRN",9.8,"NM","B","FHORD13",26)

"BLD",5880,"KRN",9.8,"NM","B","FHORD6",3)

"BLD",5880,"KRN",9.8,"NM","B","FHORD61",4)

"BLD",5880,"KRN",9.8,"NM","B","FHORD81",53)

"BLD",5880,"KRN",9.8,"NM","B","FHORD9",23)

"BLD",5880,"KRN",9.8,"NM","B","FHORE21",62)

"BLD",5880,"KRN",9.8,"NM","B","FHORT3",28)

"BLD",5880,"KRN",9.8,"NM","B","FHORT5A",61)

"BLD",5880,"KRN",9.8,"NM","B","FHORX1A",60)

"BLD",5880,"KRN",9.8,"NM","B","FHPRF1",22)

"BLD",5880,"KRN",9.8,"NM","B","FHPRO",65)

"BLD",5880,"KRN",9.8,"NM","B","FHPRO1",51)

"BLD",5880,"KRN",9.8,"NM","B","FHPRO3",25)

"BLD",5880,"KRN",9.8,"NM","B","FHSEL2",27)

"BLD",5880,"KRN",9.8,"NM","B","FHSP",15)

"BLD",5880,"KRN",9.8,"NM","B","FHSP1",16)

"BLD",5880,"KRN",9.8,"NM","B","FHSP11",54)

"BLD",5880,"KRN",9.8,"NM","B","FHSPED",17)

"BLD",5880,"KRN",9.8,"NM","B","FHSPTAB",18)

"BLD",5880,"KRN",9.8,"NM","B","FHSYSP",57)

"BLD",5880,"KRN",9.8,"NM","B","FHWADM",19)

"BLD",5880,"KRN",9.8,"NM","B","FHWOR",58)

"BLD",5880,"KRN",9.8,"NM","B","FHWOR6",29)

"BLD",5880,"KRN",19,0)
19
"BLD",5880,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",5880,"KRN",19,"NM",1,0)
FHOMGC^^0
"BLD",5880,"KRN",19,"NM",2,0)
FHOMGMGR^^2
"BLD",5880,"KRN",19,"NM",3,0)
FHOMSS^^0
"BLD",5880,"KRN",19,"NM",4,0)
FHOMCBRP^^0
"BLD",5880,"KRN",19,"NM",5,0)
FHCDLST^^2
"BLD",5880,"KRN",19,"NM","B","FHCDLST",5)

"BLD",5880,"KRN",19,"NM","B","FHOMCBRP",4)

"BLD",5880,"KRN",19,"NM","B","FHOMGC",1)

"BLD",5880,"KRN",19,"NM","B","FHOMGMGR",2)

"BLD",5880,"KRN",19,"NM","B","FHOMSS",3)

"BLD",5880,"KRN",19.1,0)
19.1
"BLD",5880,"KRN",101,0)
101
"BLD",5880,"KRN",409.61,0)
409.61
"BLD",5880,"KRN",771,0)
771
"BLD",5880,"KRN",870,0)
870
"BLD",5880,"KRN",8989.51,0)
8989.51
"BLD",5880,"KRN",8989.52,0)
8989.52
"BLD",5880,"KRN",8994,0)
8994
"BLD",5880,"KRN","B",.4,.4)

"BLD",5880,"KRN","B",.401,.401)

"BLD",5880,"KRN","B",.402,.402)

"BLD",5880,"KRN","B",.403,.403)

"BLD",5880,"KRN","B",.5,.5)

"BLD",5880,"KRN","B",.84,.84)

"BLD",5880,"KRN","B",3.6,3.6)

"BLD",5880,"KRN","B",3.8,3.8)

"BLD",5880,"KRN","B",9.2,9.2)

"BLD",5880,"KRN","B",9.8,9.8)

"BLD",5880,"KRN","B",19,19)

"BLD",5880,"KRN","B",19.1,19.1)

"BLD",5880,"KRN","B",101,101)

"BLD",5880,"KRN","B",409.61,409.61)

"BLD",5880,"KRN","B",771,771)

"BLD",5880,"KRN","B",870,870)

"BLD",5880,"KRN","B",8989.51,8989.51)

"BLD",5880,"KRN","B",8989.52,8989.52)

"BLD",5880,"KRN","B",8994,8994)

"BLD",5880,"QUES",0)
^9.62^^
"BLD",5880,"REQB",0)
^9.611^3^3
"BLD",5880,"REQB",1,0)
FH*5.5*2^1
"BLD",5880,"REQB",2,0)
FH*5.5*3^1
"BLD",5880,"REQB",3,0)
FH*5.5*1^1
"BLD",5880,"REQB","B","FH*5.5*1",3)

"BLD",5880,"REQB","B","FH*5.5*2",1)

"BLD",5880,"REQB","B","FH*5.5*3",2)

"FIA",115)
NUTRITION PERSON
"FIA",115,0)
^FHPT(
"FIA",115,0,0)
115
"FIA",115,0,1)
y^y^p^^^^n^^n
"FIA",115,0,10)

"FIA",115,0,11)

"FIA",115,0,"RLRO")

"FIA",115,0,"VR")
5.5^FH
"FIA",115,115)
1
"FIA",115,115,.01)

"FIA",115,115,16)

"FIA",115,115,17)

"FIA",115,115,18)

"FIA",115,115.016)
0
"FIA",115,115.017)
0
"FIA",115,115.018)
0
"FIA",115,115.1619)
0
"FIA",115,115.1626)
0
"FIA",115,115.1627)
0
"FIA",118.2)
TUBEFEEDING
"FIA",118.2,0)
^FH(118.2,
"FIA",118.2,0,0)
118.2Is
"FIA",118.2,0,1)
y^y^f^^^^n
"FIA",118.2,0,10)

"FIA",118.2,0,11)

"FIA",118.2,0,"RLRO")

"FIA",118.2,0,"VR")
5.5^FH
"FIA",118.2,118.2)
0
"FIA",118.2,118.21)
0
"FIA",119.6)
NUTRITION LOCATION
"FIA",119.6,0)
^FH(119.6,
"FIA",119.6,0,0)
119.6sI
"FIA",119.6,0,1)
y^y^f^^^^n
"FIA",119.6,0,10)

"FIA",119.6,0,11)

"FIA",119.6,0,"RLRO")

"FIA",119.6,0,"VR")
5.5^FH
"FIA",119.6,119.6)
0
"FIA",119.6,119.61)
0
"FIA",119.6,119.62)
0
"FIA",119.6,119.63)
0
"FIA",119.6,119.64)
0
"FIA",119.6,119.66)
0
"FIA",119.9)
FH SITE PARAMETERS
"FIA",119.9,0)
^FH(119.9,
"FIA",119.9,0,0)
119.9
"FIA",119.9,0,1)
y^y^p^^^^n^^n
"FIA",119.9,0,10)

"FIA",119.9,0,11)

"FIA",119.9,0,"RLRO")

"FIA",119.9,0,"VR")
5.5^FH
"FIA",119.9,119.9)
1
"FIA",119.9,119.9,9)

"FIA",119.9,119.9,10)

"FIA",119.9,119.9,11)

"FIA",119.9,119.9,12)

"FIA",119.9,119.9,13)

"FIA",119.9,119.9,50)

"FIA",119.9,119.9,51)

"FIA",119.9,119.9,52)

"FIA",119.9,119.9,53)

"FIA",119.9,119.9,54)

"FIA",119.9,119.9,55)

"FIA",119.9,119.9,56)

"FIA",119.9,119.9,57)

"FIA",119.9,119.9,58)

"FIA",119.9,119.9,59)

"INIT")
POST^FH55P5
"IX",115,115,"ASPO",0)
115^ASPO^Creates an "ASPO" index for NFS outpatient standing order.^MU^^R^IR^W^115.1626^^^^^A
"IX",115,115,"ASPO",.1,0)
^^2^2^3060927^
"IX",115,115,"ASPO",.1,1,0)
This creates an "ASPO" index for NFS outpatient active standing orders 
"IX",115,115,"ASPO",.1,2,0)
(SO). It is killed when the order is cancelled.
"IX",115,115,"ASPO",1)
I X2(1),X2(2)="" S ^FHPT("ASPO",DA(2),DA(1),DA)=""
"IX",115,115,"ASPO",1.4)

"IX",115,115,"ASPO",2)
I X2(2) K ^FHPT("ASPO",DA(2),DA(1),DA)
"IX",115,115,"ASPO",2.5)
K ^FHPT("ASPO")
"IX",115,115,"ASPO",11.1,0)
^.114IA^2^2
"IX",115,115,"ASPO",11.1,1,0)
1^F^115.1626^1^^^F
"IX",115,115,"ASPO",11.1,2,0)
2^F^115.1626^5^^^F
"KRN",19,2156,-1)
2^5
"KRN",19,2156,0)
FHCDLST^Dietetic Lists/Reports^^M^.5^^^^^^^29
"KRN",19,2156,10,0)
^19.01IP^25^18
"KRN",19,2156,10,25,0)
12523^CR
"KRN",19,2156,10,25,"^")
FHOMCBRP
"KRN",19,2156,"U")
DIETETIC LISTS/REPORTS
"KRN",19,11732,-1)
2^2
"KRN",19,11732,0)
FHOMGMGR^Guest Meals Menu^^M^1901
"KRN",19,11732,10,0)
^19.01IP^3^3
"KRN",19,11732,10,3,0)
12457^CA^3
"KRN",19,11732,10,3,"^")
FHOMGC
"KRN",19,11732,"U")
GUEST MEALS MENU
"KRN",19,11763,-1)
0^3
"KRN",19,11763,0)
FHOMSS^Meal Status Report^^R^^^^^^^^
"KRN",19,11763,1,0)
^19.06^1^1^3060214^^
"KRN",19,11763,1,1,0)
Prints a list of existing special meals and their current status.
"KRN",19,11763,25)
FHOMSS2
"KRN",19,11763,"U")
MEAL STATUS REPORT
"KRN",19,12457,-1)
0^1
"KRN",19,12457,0)
FHOMGC^Cancel a Guest Meal^^R^^^^^^^^
"KRN",19,12457,1,0)
^19.06^1^1^3060214^^
"KRN",19,12457,1,1,0)
Allows the user to cancel guest meals.
"KRN",19,12457,25)
FHOMGC1
"KRN",19,12457,"U")
CANCEL A GUEST MEAL
"KRN",19,12523,-1)
0^4
"KRN",19,12523,0)
FHOMCBRP^Combined Outpatient Meals Report^^R^^^^^^^^DIETETICS
"KRN",19,12523,1,0)
^^3^3^3060720^
"KRN",19,12523,1,1,0)
This report will display all outpatient meals (recurring, special or guest
"KRN",19,12523,1,2,0)
meals) within a specified date range.  The report may be sorted by 
"KRN",19,12523,1,3,0)
location, communication office, production facility or all.
"KRN",19,12523,25)
FHOMCBRP
"KRN",19,12523,"U")
COMBINED OUTPATIENT MEALS REPO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",29,-1)
1^1
"PKG",29,0)
DIETETICS^FH^Dietetics/Nutrition & Food Service System
"PKG",29,20,0)
^9.402P^^
"PKG",29,22,0)
^9.49I^1^1
"PKG",29,22,1,0)
5.5^3050202^3040621^4572
"PKG",29,22,1,"PAH",1,0)
5^3070111^28
"PKG",29,22,1,"PAH",1,1,0)
^^2^2^3070111
"PKG",29,22,1,"PAH",1,1,1,0)
A patch for outpatient standing orders, supplemental feeding
"PKG",29,22,1,"PAH",1,1,2,0)
and other fixes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
65
"RTN","FH55P5")
0^31^B32445798
"RTN","FH55P5",1,0)
FH55P5 ;ALB/TDP - POST-INIT FOR PATCH FH*5.5*5 ;12/13/2005
"RTN","FH55P5",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FH55P5",3,0)
 Q
"RTN","FH55P5",4,0)
POST ;
"RTN","FH55P5",5,0)
 D BMES^XPDUTL("Searching for DIETS (#111) file entries which are out of sync with the")
"RTN","FH55P5",6,0)
 D MES^XPDUTL("   corresponding entry in the ORDERABLE ITEM (#101.43) file...")
"RTN","FH55P5",7,0)
 D DIET
"RTN","FH55P5",8,0)
 D BMES^XPDUTL("Searching for TUBEFEEDING (#118.2) file entries which are out of sync with")
"RTN","FH55P5",9,0)
 D MES^XPDUTL("   the corresponding entry in the ORDERABLE ITEM (#101.43) file...")
"RTN","FH55P5",10,0)
 D TF
"RTN","FH55P5",11,0)
 D BMES^XPDUTL("Searching for DIET PATTERN (#111.1) names which are out of sync with")
"RTN","FH55P5",12,0)
 D MES^XPDUTL("   corresponding DIET ABBREVIATED LABELS...")
"RTN","FH55P5",13,0)
 D UPDPAT
"RTN","FH55P5",14,0)
 D BMES^XPDUTL("Post-init complete.")
"RTN","FH55P5",15,0)
 Q
"RTN","FH55P5",16,0)
 ;
"RTN","FH55P5",17,0)
DIET ;
"RTN","FH55P5",18,0)
 N DIFF,FH0,FHACT,FHFILE,FHFLNM,FHIEN,FHIEN1,FHINACT
"RTN","FH55P5",19,0)
 N FHNM,FHORIEN,FHSYN,FHTYP
"RTN","FH55P5",20,0)
 K ^TMP($J,"FH55P5_nutrition"),^TMP($J,"FH55P5_order")
"RTN","FH55P5",21,0)
 S FHTYP="D"
"RTN","FH55P5",22,0)
 S FHFILE="111",FHFLNM=$P($G(^FH(111,0)),"^",1)
"RTN","FH55P5",23,0)
 S FHNM=""
"RTN","FH55P5",24,0)
 F  S FHNM=$O(^FH(111,"B",FHNM)) Q:FHNM=""  D
"RTN","FH55P5",25,0)
 . S FHIEN=""
"RTN","FH55P5",26,0)
 . F  S FHIEN=$O(^FH(111,"B",FHNM,FHIEN)) Q:FHIEN=""  D
"RTN","FH55P5",27,0)
 .. S DIFF=0
"RTN","FH55P5",28,0)
 .. S FHINACT=$G(^FH(111,+FHIEN,"I")) I FHINACT="N" S FHINACT=""
"RTN","FH55P5",29,0)
 .. S FH0=$G(^FH(111,+FHIEN,0))
"RTN","FH55P5",30,0)
 .. S FHNM=$P(FH0,U,1) I FHNM="" Q
"RTN","FH55P5",31,0)
 .. S ^TMP($J,"FH55P5_nutrition",FHNM)=FHINACT
"RTN","FH55P5",32,0)
 .. F FHIEN1=0:0 S FHIEN1=$O(^FH(111,+FHIEN,"AN",FHIEN1)) Q:FHIEN1<1  D
"RTN","FH55P5",33,0)
 ... S FHSYN=$G(^FH(111,+FHIEN,"AN",FHIEN1,0))
"RTN","FH55P5",34,0)
 ... S:'$D(^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)) ^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)=""
"RTN","FH55P5",35,0)
 .. S FHSYN=$P(FH0,U,2)
"RTN","FH55P5",36,0)
 .. I FHSYN'="" S:'$D(^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)) ^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)=""
"RTN","FH55P5",37,0)
 .. D ORDER
"RTN","FH55P5",38,0)
 .. D COMPARE
"RTN","FH55P5",39,0)
 .. I DIFF D UPDATE
"RTN","FH55P5",40,0)
 .. K ^TMP($J,"FH55P5_nutrition"),^TMP($J,"FH55P5_order")
"RTN","FH55P5",41,0)
 Q
"RTN","FH55P5",42,0)
TF ;
"RTN","FH55P5",43,0)
 N DIFF,FH0,FHACT,FHFILE,FHFLNM,FHIEN,FHIEN1,FHINACT
"RTN","FH55P5",44,0)
 N FHNM,FHORIEN,FHSYN,FHTYP
"RTN","FH55P5",45,0)
 K ^TMP($J,"FH55P5_nutrition"),^TMP($J,"FH55P5_order")
"RTN","FH55P5",46,0)
 S FHTYP="T"
"RTN","FH55P5",47,0)
 S FHFILE="118.2",FHFLNM=$P($G(^FH(118.2,0)),"^",1)
"RTN","FH55P5",48,0)
 S FHNM=""
"RTN","FH55P5",49,0)
 F  S FHNM=$O(^FH(118.2,"B",FHNM)) Q:FHNM=""  D
"RTN","FH55P5",50,0)
 . S FHIEN=""
"RTN","FH55P5",51,0)
 . F  S FHIEN=$O(^FH(118.2,"B",FHNM,FHIEN)) Q:FHIEN=""  D
"RTN","FH55P5",52,0)
 .. S DIFF=0
"RTN","FH55P5",53,0)
 .. S FHINACT=$G(^FH(118.2,+FHIEN,"I")) I FHINACT="N" S FHINACT=""
"RTN","FH55P5",54,0)
 .. S FH0=$G(^FH(118.2,+FHIEN,0))
"RTN","FH55P5",55,0)
 .. S FHNM=$P(FH0,U,1) I FHNM="" Q
"RTN","FH55P5",56,0)
 .. S ^TMP($J,"FH55P5_nutrition",FHNM)=FHINACT
"RTN","FH55P5",57,0)
 .. F FHIEN1=0:0 S FHIEN1=$O(^FH(118.2,+FHIEN,1,FHIEN1)) Q:FHIEN1<1  D
"RTN","FH55P5",58,0)
 ... S FHSYN=$G(^FH(118.2,+FHIEN,1,FHIEN1,0))
"RTN","FH55P5",59,0)
 ... S:'$D(^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)) ^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)=""
"RTN","FH55P5",60,0)
 .. ;S FHSYN=$P(FH0,U,2)
"RTN","FH55P5",61,0)
 .. ;I FHSYN'="" S:'$D(^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)) ^TMP($J,"FH55P5_nutrition",FHNM,FHSYN)=""
"RTN","FH55P5",62,0)
 .. D ORDER
"RTN","FH55P5",63,0)
 .. D COMPARE
"RTN","FH55P5",64,0)
 .. I DIFF D UPDATE
"RTN","FH55P5",65,0)
 .. K ^TMP($J,"FH55P5_nutrition"),^TMP($J,"FH55P5_order")
"RTN","FH55P5",66,0)
 Q
"RTN","FH55P5",67,0)
ORDER ;COMPILE ORD(101.43 DATA RELATED TO DIET ORDER/TF PRODUCT
"RTN","FH55P5",68,0)
 N FHORIN,FHORNM,FHORSYN
"RTN","FH55P5",69,0)
 S FHORIEN=$O(^ORD(101.43,"ID",+FHIEN_";99FH"_FHTYP,0))
"RTN","FH55P5",70,0)
 I +FHORIEN<1 Q
"RTN","FH55P5",71,0)
 S FHORIN=$G(^ORD(101.43,FHORIEN,.1))
"RTN","FH55P5",72,0)
 I FHORIN'="" S FHORIN="Y"
"RTN","FH55P5",73,0)
 S FHORNM=$P($G(^ORD(101.43,FHORIEN,0)),U,1) I FHORNM="" S FHORNM="UNKNOWN NAME (FH55P5)"
"RTN","FH55P5",74,0)
 S ^TMP($J,"FH55P5_order",FHORNM)=FHORIN
"RTN","FH55P5",75,0)
 S FHORSYN=""
"RTN","FH55P5",76,0)
 F  S FHORSYN=$O(^ORD(101.43,FHORIEN,2,"B",FHORSYN)) Q:FHORSYN=""  D
"RTN","FH55P5",77,0)
 . S:'$D(^TMP($J,"FH55P5_order",FHORNM,FHORSYN)) ^TMP($J,"FH55P5_order",FHORNM,FHORSYN)=""
"RTN","FH55P5",78,0)
 Q
"RTN","FH55P5",79,0)
COMPARE ;COMPARE ORD(101.43 ENTRY TO FH(111 OR FH(118.2 ENTRY
"RTN","FH55P5",80,0)
 N FHINACT,FHNM,FHORIN,FHORNM,FHORSYN,FHSYN
"RTN","FH55P5",81,0)
 I '$D(^TMP($J,"FH55P5_order")) Q
"RTN","FH55P5",82,0)
 S (FHACT,FHNM,FHORNM,FHORSYN,FHSYN)=""
"RTN","FH55P5",83,0)
 S FHNM=$O(^TMP($J,"FH55P5_nutrition",FHNM))
"RTN","FH55P5",84,0)
 S FHORNM=$O(^TMP($J,"FH55P5_order",FHORNM))
"RTN","FH55P5",85,0)
 I FHNM'=FHORNM S DIFF=1
"RTN","FH55P5",86,0)
 S FHINACT=$G(^TMP($J,"FH55P5_nutrition",FHNM))
"RTN","FH55P5",87,0)
 S FHORIN=$G(^TMP($J,"FH55P5_order",FHORNM))
"RTN","FH55P5",88,0)
 I FHINACT'=FHORIN S DIFF=1 D
"RTN","FH55P5",89,0)
 . I FHINACT="Y" S FHACT=$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","FH55P5",90,0)
 . I FHINACT'="Y" S FHACT=""
"RTN","FH55P5",91,0)
 I FHINACT=FHORIN,FHINACT="Y" D
"RTN","FH55P5",92,0)
 . S FHACT=$O(^ORD(101.43,"ID",FHIEN_";99FH"_FHTYP,0))
"RTN","FH55P5",93,0)
 . S FHACT=$G(^ORD(101.43,FHACT,.1))
"RTN","FH55P5",94,0)
 . S FHACT=$$FMTHL7^XLFDT(FHACT)
"RTN","FH55P5",95,0)
CLOOP S FHSYN=$O(^TMP($J,"FH55P5_nutrition",FHNM,FHSYN))
"RTN","FH55P5",96,0)
 S FHORSYN=$O(^TMP($J,"FH55P5_order",FHORNM,FHORSYN))
"RTN","FH55P5",97,0)
 I FHSYN'="",FHSYN=FHORSYN G CLOOP
"RTN","FH55P5",98,0)
 I FHSYN'=FHORSYN S DIFF=1
"RTN","FH55P5",99,0)
 Q
"RTN","FH55P5",100,0)
UPDATE ;FORMAT AND SEND UPDATE MESSAGE
"RTN","FH55P5",101,0)
 N CNT,FHNAM,MSG
"RTN","FH55P5",102,0)
 S CNT=1
"RTN","FH55P5",103,0)
 S MSG(CNT)="MSH|^~\&|DIETETICS|"_^DD("SITE",1)_"|||||MFN"
"RTN","FH55P5",104,0)
 ; code MFI
"RTN","FH55P5",105,0)
 S CNT=CNT+1
"RTN","FH55P5",106,0)
 S MSG(CNT)="MFI|"_FHFILE_"^"_FHFLNM_"^99DD||UPD|||NE"
"RTN","FH55P5",107,0)
 S FHNAM=""
"RTN","FH55P5",108,0)
 F  S FHNAM=$O(^TMP($J,"FH55P5_nutrition",FHNAM)) Q:FHNAM=""  D
"RTN","FH55P5",109,0)
 . S CNT=CNT+1
"RTN","FH55P5",110,0)
 . S MSG(CNT)="MFE|MUP||"_FHACT_"|^^^"_FHIEN_"^"_FHNAM_"^99FH"_FHTYP
"RTN","FH55P5",111,0)
 . S CNT=CNT+1
"RTN","FH55P5",112,0)
 . I FHTYP="D" S MSG(CNT)="ZFH|D|"_$P(FH0,U,4)_"||"_$P(FH0,U,3)
"RTN","FH55P5",113,0)
 . I FHTYP="T" S MSG(CNT)="ZFH|T|"
"RTN","FH55P5",114,0)
 . S FHSYN=""
"RTN","FH55P5",115,0)
 . F  S FHSYN=$O(^TMP($J,"FH55P5_nutrition",FHNAM,FHSYN)) Q:FHSYN=""  D
"RTN","FH55P5",116,0)
 .. S CNT=CNT+1,MSG(CNT)="ZSY|"_CNT_"|"_FHSYN
"RTN","FH55P5",117,0)
 I $D(MSG) D SEND
"RTN","FH55P5",118,0)
 Q
"RTN","FH55P5",119,0)
SEND ; Send Message to OE/RR
"RTN","FH55P5",120,0)
 D MSG^XQOR("FH ORDERABLE ITEM UPDATE",.MSG)
"RTN","FH55P5",121,0)
 D BMES^XPDUTL("   Updated ORDERABLE ITEM (#101.43) file entry #"_FHORIEN_" with data")
"RTN","FH55P5",122,0)
 D MES^XPDUTL("      for "_FHNM_" from the "_$S($G(FHTYP)="D":"DIETS (#111) file",1:"TUBEFEEDING (#118.2) file"))
"RTN","FH55P5",123,0)
 K MSG
"RTN","FH55P5",124,0)
 Q
"RTN","FH55P5",125,0)
UPDPAT ; Update Diet Pattern names
"RTN","FH55P5",126,0)
 S FLG=0 F FHDPIEN=0:0 S FHDPIEN=$O(^FH(111.1,FHDPIEN)) Q:FHDPIEN'>0  D
"RTN","FH55P5",127,0)
 .S FHFND=0,FHOLDNM=$P($G(^FH(111.1,FHDPIEN,0)),U,1),FHNEWNM=""
"RTN","FH55P5",128,0)
 .S FHDPDTS=$P($G(^FH(111.1,FHDPIEN,0)),U,2,6)
"RTN","FH55P5",129,0)
 .F FHPCE=1:1:5 D
"RTN","FH55P5",130,0)
 ..S FHDTPTR=$P(FHDPDTS,U,FHPCE) Q:FHDTPTR=""
"RTN","FH55P5",131,0)
 ..S FHNEWNM=FHNEWNM_$S(FHNEWNM="":"",1:", ")
"RTN","FH55P5",132,0)
 ..S FHNEWNM=FHNEWNM_$P($G(^FH(111,FHDTPTR,0)),U,7)
"RTN","FH55P5",133,0)
 .I FHOLDNM=FHNEWNM Q
"RTN","FH55P5",134,0)
 .S FLG=1 D BMES^XPDUTL("   Updated "_FHOLDNM_" to  "_FHNEWNM)
"RTN","FH55P5",135,0)
 .K DIE S DIE="^FH(111.1,",DA=FHDPIEN,DR=".01////^S X=FHNEWNM" D ^DIE
"RTN","FH55P5",136,0)
 Q
"RTN","FHASP")
0^5^B14729349
"RTN","FHASP",1,0)
FHASP ; HISC/REL - Nutrition Profile ;11/16/94  16:55
"RTN","FHASP",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHASP",3,0)
P0 S ALL=1 D ^FHDPA G:'DFN KIL S:WARD="" ADM=""
"RTN","FHASP",4,0)
 ;
"RTN","FHASP",5,0)
 D MONUM^FHOMUTL I FHNUM="" Q
"RTN","FHASP",6,0)
 ;
"RTN","FHASP",7,0)
L0 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHASP",8,0)
 I $D(IO("Q")) S FHPGM="Q0^FHASP",FHLST="FHDFN^DFN^PID^ADM^WARD^FHNUM" D EN2^FH G KIL
"RTN","FHASP",9,0)
 U IO D Q0 D ^%ZISC K %ZIS,IOP G FHASP
"RTN","FHASP",10,0)
Q0 ; Print Profile
"RTN","FHASP",11,0)
 D NOW^%DTC S NOW=%,DT=NOW\1 S FHU=$S($D(^FH(119.9,1,3)):$P(^(3),"^",1),1:"E")
"RTN","FHASP",12,0)
 S Y=^DPT(DFN,0),NAM=$P(Y,"^",1),SEX=$P(Y,"^",2),DOB=$P(Y,"^",3)
"RTN","FHASP",13,0)
 S AGE="" I DOB'="" S AGE=$E(NOW,1,3)-$E(DOB,1,3)-($E(NOW,4,7)<$E(DOB,4,7))
"RTN","FHASP",14,0)
 S LN="",$P(LN,"-",80)="",ANS="",PG=0,S1=$S(IOST?1"C".E:IOSL-2,1:IOSL-7) D HEAD
"RTN","FHASP",15,0)
 W !!,"Status: " I WARD="" W "Outpatient"
"RTN","FHASP",16,0)
 E  S DTP=$P(^DGPM(ADM,0),"^",1) D DTP^FH W "Inpatient admitted ",DTP D ^FHASP2
"RTN","FHASP",17,0)
 S RC="",ASE=$O(^FHPT(FHDFN,"S",0)) I ASE S Y=^(ASE,0),RC=$P(Y,"^",2),DTP=$P(Y,"^",1)
"RTN","FHASP",18,0)
 W !!,"Nutrition Status: " I RC W ?20,$P($G(^FH(115.4,RC,0)),"^",2) D DTP^FH W "  (",$E(DTP,1,9),")"
"RTN","FHASP",19,0)
 D ALG^FHCLN W !!,"Allergies: " S ALG=$S(ALG="":"None on file",1:ALG) D LNE^FHDMP
"RTN","FHASP",20,0)
 W !!?29,"Nutrition Assessments"
"RTN","FHASP",21,0)
 S ASN=$O(^FHPT(FHDFN,"N",0)) I ASN'>0 W !!?5,"No assessments on file." G Q1
"RTN","FHASP",22,0)
 W !!,"Recent Assessments:"
"RTN","FHASP",23,0)
 S N1=0 F K=0:0 S K=$O(^FHPT(FHDFN,"N",K)) Q:K<1  S DTP=$P(^(K,0),"^",1) D DTP^FH W "  ",$E(DTP,1,9) S N1=N1+1 Q:N1=3
"RTN","FHASP",24,0)
 S Y=^FHPT(FHDFN,"N",ASN,0)
"RTN","FHASP",25,0)
 S N1=0 F K=1,4:1:10,20 S N1=N1+1,@$P("ADT HGT HGP WGT WGP DWGT UWGT IBW XD"," ",N1)=$P(Y,"^",K)
"RTN","FHASP",26,0)
 S X1=$S(HGT\12:HGT\12_"'",1:"")_$S(HGT#12:" "_(HGT#12)_"""",1:""),X2=+$J(HGT*2.54,0,0)_" cm"
"RTN","FHASP",27,0)
 W !!,"Height: ",X2 W:HGP'="" " ",HGP W " (",X1,")"
"RTN","FHASP",28,0)
 I UWGT S X1=UWGT_" lbs",X2=+$J(UWGT/2.2,0,1)_" kg"
"RTN","FHASP",29,0)
 W ?27,"Usual Wt: " W:UWGT X2," (",X1,")" W ?58,"Weight/Usual Wt: " W:UWGT $J(WGT/UWGT*100,3,0),"%"
"RTN","FHASP",30,0)
 S X1=WGT_" lbs",X2=+$J(WGT/2.2,0,1)_" kg"
"RTN","FHASP",31,0)
 W !,"Weight: ",X2 W:WGP'="" " ",WGP W " (",X1,")"
"RTN","FHASP",32,0)
 S X1=IBW_" lbs",X2=+$J(IBW/2.2,0,1)_" kg"
"RTN","FHASP",33,0)
 W ?27,"Ideal Wt: ",X2," (",X1,")" W:IBW ?58,"Weight/IBW:      ",$J(WGT/IBW*100,3,0),"%"
"RTN","FHASP",34,0)
 S DTP=DWGT D DTP^FH W !,"Date Taken:   ",DTP
"RTN","FHASP",35,0)
 I XD W !!?5,"Nutrition Class: " W ?20,$P($G(^FH(115.3,XD,0)),"^",1)
"RTN","FHASP",36,0)
Q1 S PX=0 D LAB^FHASM4 S PX=$S(WARD="":0,1:1) D DRUG^FHASM4
"RTN","FHASP",37,0)
 W !!?34,"Medications" S N1=0 F N2=0:0 S N2=$O(PSD(N2)) Q:N2=""  D:$Y'<S1 HF Q:ANS="^"  W:'N1 ! W !?5,PSD(N2) S N1=N1+1
"RTN","FHASP",38,0)
 Q:ANS="^"
"RTN","FHASP",39,0)
 I 'N1 W !!?5,"No current medications in selected drug classes."
"RTN","FHASP",40,0)
 W !!?32,"Laboratory Data"
"RTN","FHASP",41,0)
 S N1=0 F K=0:0 S K=$O(LRTST(K)) Q:K=""  D:$Y'<S1 HF Q:ANS="^"  D LAB
"RTN","FHASP",42,0)
 Q:ANS="^"
"RTN","FHASP",43,0)
 I 'N1 W !!?5,"No selected laboratory data available last ",$S($D(^FH(119.9,1,3)):$P(^(3),"^",2),1:90)," days."
"RTN","FHASP",44,0)
 G ^FHASP1
"RTN","FHASP",45,0)
LAB S X1=$P(LRTST(K),"^",7) Q:X1=""  S DTP=X1\1 D DTP^FH
"RTN","FHASP",46,0)
 I 'N1 W !?5,"Test",?30,"Result    units",?51,"Ref.   range",?67,"Date",!
"RTN","FHASP",47,0)
 S N1=N1+1
"RTN","FHASP",48,0)
 W !?5,$P(LRTST(K),"^",1),?27,$P(LRTST(K),"^",6),?40,$P(LRTST(K),"^",4),?51,$P(LRTST(K),"^",5),?65,DTP Q
"RTN","FHASP",49,0)
HF ; Do Header and Footer
"RTN","FHASP",50,0)
 D FOOT Q:ANS="^"  D HEAD
"RTN","FHASP",51,0)
 Q
"RTN","FHASP",52,0)
HEAD ; Page Header
"RTN","FHASP",53,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1,DTP=DT D DTP^FH
"RTN","FHASP",54,0)
 W !,LN,!,DTP,?31,"NUTRITION PROFILE",?73,"Page ",PG,!,LN
"RTN","FHASP",55,0)
 W !,NAM,?40,$S(SEX="M":"Male",SEX="F":"Female",1:""),?73,"Age ",AGE,! Q
"RTN","FHASP",56,0)
FOOT ; Page Footer
"RTN","FHASP",57,0)
 D PAUSE Q:IOST?1"C".E
"RTN","FHASP",58,0)
 F KK=1:1:IOSL-$Y-6 W !
"RTN","FHASP",59,0)
 D SITE^FH W !,LN,!,NAM W ?(80-$L(SITE)\2),SITE,?67,"VAF 10-9034"
"RTN","FHASP",60,0)
 W ! W:PID'="" PID
"RTN","FHASP",61,0)
 S W1=$G(^DPT(DFN,.1)) S:$D(^DPT(DFN,.101)) W1=W1_"/"_^DPT(DFN,.101) W:W1'="" ?(80-$L(W1)\2),W1 W ?66,"(Vice SF 509)"
"RTN","FHASP",62,0)
 W !,LN,! Q
"RTN","FHASP",63,0)
PAUSE ; Pause For Scroll
"RTN","FHASP",64,0)
 I IOST?1"C".E R !!,"Press RETURN to continue. ",X:DTIME S:'$T!(X["^") ANS="^" Q:ANS="^"  I "^"'[X W !,"Enter a RETURN to Continue." G PAUSE
"RTN","FHASP",65,0)
 Q
"RTN","FHASP",66,0)
KIL ; Final variable kill
"RTN","FHASP",67,0)
 G KILL^XUSCLEAN
"RTN","FHASXR")
0^6^B8943956
"RTN","FHASXR",1,0)
FHASXR ; HISC/REL - Print Screening ;5/10/93  15:10
"RTN","FHASXR",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHASXR",3,0)
F0 R !!,"Print by PATIENT or COMMUNICATION OFFICE or ALL or WARD? WARD// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="W" D TR^FH
"RTN","FHASXR",4,0)
 I $P("PATIENT",X,1)'="",$P("WARD",X,1)'="",$P("COMMUNICATION OFFICE",X,1)'="",$P("ALL",X,1)'="" W *7,"  Answer with P or C or A or W" G F0
"RTN","FHASXR",5,0)
 G P0:X?1"P".E,W0:X?1"W".E I X?1"A".E S (DFN,ADM,WARD)="" G W1
"RTN","FHASXR",6,0)
D0 K DIC S DIC="^FH(119.73,",DIC("A")="Select COMMUNICATION OFFICE: ",DIC(0)="AEQM" W ! D ^DIC K DIC G KIL:"^"[X!$D(DTOUT),D0:Y<1 S WARD=-Y,(DFN,ADM)="" G W1
"RTN","FHASXR",7,0)
W0 K DIC S DIC("A")="Select DIETETIC WARD: ",DIC="^FH(119.6,",DIC(0)="AEQM" W ! D ^DIC K DIC G KIL:"^"[X!$D(DTOUT),W0:Y<1 S WARD=+Y,(DFN,ADM)=""
"RTN","FHASXR",8,0)
W1 R !!,"Admissions since Date/Time: ",X:DTIME G:'$T!("^"[X) KIL S %DT="EXTS",%DT(0)="-NOW" D ^%DT K %DT G:Y<1 W1 S TIM=Y
"RTN","FHASXR",9,0)
 D NOW^%DTC S X1=%\1,X2=-5 D C^%DTC I TIM<X W "  [ DATE CANNOT BE MORE THAN 5 DAYS IN PAST ]" G W1
"RTN","FHASXR",10,0)
 G P1
"RTN","FHASXR",11,0)
P0 S ALL=1 D ^FHDPA G:'DFN KIL S TIM=""
"RTN","FHASXR",12,0)
 I $P($G(^DPT(DFN,.35)),"^",1) W *7,!!?5,"  [ Patient has expired. ]" G KIL
"RTN","FHASXR",13,0)
P1 S NP=$P($G(^FH(119.9,1,3)),"^",3) I NP'="A" G P3
"RTN","FHASXR",14,0)
P2 R !!,"Include Nutrition Profiles? (Y/N): ",NP:DTIME G:'$T!(NP["^") KIL S:NP="" NP="^" S X=NP D TR^FH S NP=X I $P("YES",NP,1)'="",$P("NO",NP,1)'="" W *7,!,"  Answer YES or NO" G P2
"RTN","FHASXR",15,0)
P3 S NP=$S(NP?1"Y".E:1,1:0)
"RTN","FHASXR",16,0)
 I NP=0 S FHNUM=9999 G L0
"RTN","FHASXR",17,0)
 D MONUM^FHOMUTL I FHNUM="" Q
"RTN","FHASXR",18,0)
L0 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHASXR",19,0)
 I $D(IO("Q")) S FHPGM="Q0^FHASXR",FHLST="DFN^ADM^WARD^TIM^NP^FHNUM" D EN2^FH G KIL
"RTN","FHASXR",20,0)
 U IO D Q0 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHASXR",21,0)
Q0 ; Process Screening
"RTN","FHASXR",22,0)
 I DFN S FHZ115="P"_DFN D CHECK^FHOMDPA Q:FHDFN=""  D ^FHASXR1 Q
"RTN","FHASXR",23,0)
 G Q2:WARD<0,Q3:WARD=""
"RTN","FHASXR",24,0)
Q1 F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",WARD,FHDFN)) Q:FHDFN=""  S ADM=$G(^FHPT("AW",WARD,FHDFN)),X=$P($G(^DGPM(+ADM,0)),"^",1) I X'<TIM D PATNAME^FHOMUTL,^FHASXR1 W:$E(IOST,1,2)'="C-" @IOF Q:ANS="^"
"RTN","FHASXR",25,0)
 Q
"RTN","FHASXR",26,0)
Q2 S CF=-WARD,WRD=""
"RTN","FHASXR",27,0)
 F NN=0:0 S WRD=$O(^FH(119.6,"B",WRD)) Q:WRD=""  S WARD=$O(^FH(119.6,"B",WRD,0)) I $P($G(^FH(119.6,+WARD,0)),"^",8)=CF D Q1
"RTN","FHASXR",28,0)
 Q
"RTN","FHASXR",29,0)
Q3 S WRD="" F NN=0:0 S WRD=$O(^FH(119.6,"B",WRD)) Q:WRD=""  S WARD=$O(^(WRD,0)) Q:'WARD  D Q1
"RTN","FHASXR",30,0)
 Q
"RTN","FHASXR",31,0)
KIL G KILL^XUSCLEAN
"RTN","FHBIR")
0^64^B17802791
"RTN","FHBIR",1,0)
FHBIR ; HISC/REL - Birthday List ;1/23/98  16:06
"RTN","FHBIR",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHBIR",3,0)
 ;patch #5 - adding outpt room-bed.
"RTN","FHBIR",4,0)
 S FHP=$O(^FH(119.73,0)) I FHP'<1,$O(^FH(119.73,FHP))<1 S FHP=0 G R1
"RTN","FHBIR",5,0)
R0 ;
"RTN","FHBIR",6,0)
 R !!,"Select COMMUNICATION OFFICE (or ALL): ",X:DTIME G:'$T!("^"[X) KIL D:X="all" TR^FH I X="ALL" S FHP=0
"RTN","FHBIR",7,0)
 E  K DIC S DIC="^FH(119.73,",DIC(0)="EMQ" D ^DIC G:Y<1 R0 S FHP=+Y
"RTN","FHBIR",8,0)
R1 ;
"RTN","FHBIR",9,0)
 S %DT="AEP",%DT("A")="Birthday DATE: " W ! D ^%DT G:Y<1 KIL S DAT=Y
"RTN","FHBIR",10,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHBIR",11,0)
 I $D(IO("Q")) S FHPGM="Q1^FHBIR",FHLST="DAT^FHP" D EN2^FH G KIL
"RTN","FHBIR",12,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHBIR",13,0)
Q1 ; Process Printing Birthday List
"RTN","FHBIR",14,0)
 K ^TMP($J) S PG=0,TYP=$E(DAT,6,7)="00" D NOW^%DTC S NOW=% K %,%H,%I
"RTN","FHBIR",15,0)
 F FHWRD=0:0 S FHWRD=$O(^FH(119.6,FHWRD)) Q:FHWRD'>0  S DP=$P(^(FHWRD,0),"^",8) I 'FHP!(DP=FHP) S WRD=$P(^(0),"^",1) F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",FHWRD,FHDFN)) Q:FHDFN<1  D Q2
"RTN","FHBIR",16,0)
 S PATTYP="INPATIENTS" D HDR S NAM="" F K=0:0 S NAM=$O(^TMP($J,NAM)) Q:NAM=""  F FHDFN=0:0 S FHDFN=$O(^TMP($J,NAM,FHDFN)) Q:FHDFN<1  D Q3
"RTN","FHBIR",17,0)
 D OUTP
"RTN","FHBIR",18,0)
 Q
"RTN","FHBIR",19,0)
Q2 ;
"RTN","FHBIR",20,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHBIR",21,0)
 Q:'$D(^DPT(DFN,.1))
"RTN","FHBIR",22,0)
 S Y0=$G(^DPT(DFN,0)),X=$P(Y0,"^",3) Q:'X
"RTN","FHBIR",23,0)
 I 'TYP Q:$E(X,4,7)'=$E(DAT,4,7)
"RTN","FHBIR",24,0)
 Q:$E(X,4,5)'=$E(DAT,4,5)
"RTN","FHBIR",25,0)
 S BD=$E(X,4,7)_$E($P(Y0,"^",1),1,26),^TMP($J,BD,FHDFN)=X_"^"_WRD Q
"RTN","FHBIR",26,0)
Q3 ;
"RTN","FHBIR",27,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHBIR",28,0)
 S X1=^TMP($J,NAM,FHDFN),DTP=$P(X1,"^",1),WRD=$P(X1,"^",2)
"RTN","FHBIR",29,0)
 S RM=$G(^DPT(DFN,.101))
"RTN","FHBIR",30,0)
 S DTP=$J(+$E(DTP,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(DTP,4,5))_"-"_(1700+$E(DTP,1,3))
"RTN","FHBIR",31,0)
 D:$Y>(IOSL-10) HDR
"RTN","FHBIR",32,0)
 W !,$E(NAM,5,30),?32,$E(WRD,1,10),?44,$E(RM,1,10),?56,DTP Q
"RTN","FHBIR",33,0)
HDR ;
"RTN","FHBIR",34,0)
 N DTP
"RTN","FHBIR",35,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1,DTP=NOW D DTP^FH W !,DTP,?27,"B I R T H D A Y   L I S T",?74,"Page ",PG
"RTN","FHBIR",36,0)
 S DTP=DAT D DTP^FH S DTP=$P(DTP,"-",$S(TYP:2,1:1),2) S:FHP DTP=$P(^FH(119.73,FHP,0),"^",1)_"  "_DTP W !!,PATTYP,?(79-$L(DTP)\2),DTP
"RTN","FHBIR",37,0)
 ;I $G(FHOPFLG)=1 W !!,"Name",?32,"Location",?57,"Birthday",! Q
"RTN","FHBIR",38,0)
 W !!,"Name",?32,"Ward",?44,"Room",?57,"Birthday",! Q
"RTN","FHBIR",39,0)
KIL K ^TMP($J),FHOPFLG G KILL^XUSCLEAN
"RTN","FHBIR",40,0)
 Q
"RTN","FHBIR",41,0)
OUTP ;Add Outpatient Display Here - RTK
"RTN","FHBIR",42,0)
 ;Only birthdays with Recurring, Special, Guest Meals for date selected
"RTN","FHBIR",43,0)
 ;
"RTN","FHBIR",44,0)
 K ^TMP($J) S PATTYP="OUTPATIENTS",FHOPFLG=1
"RTN","FHBIR",45,0)
 I TYP=1 S FHDTQ=$E(DAT,1,5)_"99.999999",FHRM=DAT-.0001
"RTN","FHBIR",46,0)
 I TYP=0 S FHDTQ=DAT_".999999" S X1=DAT,X2=-1 D C^%DTC S FHRM=X
"RTN","FHBIR",47,0)
 S RM=""
"RTN","FHBIR",48,0)
 F FHOMDT=FHRM:0 S FHOMDT=$O(^FHPT("RM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHDTQ)  D
"RTN","FHBIR",49,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHBIR",50,0)
 ..F FHRNUM=0:0 S FHRNUM=$O(^FHPT("RM",FHOMDT,FHDFN,FHRNUM)) Q:FHRNUM=""  D
"RTN","FHBIR",51,0)
 ...S FHLOC=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,3) Q:FHLOC=""
"RTN","FHBIR",52,0)
 ...S RM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,18)
"RTN","FHBIR",53,0)
 ...I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^DG(405.4,RM,0),U,1)
"RTN","FHBIR",54,0)
 ...D CHECK
"RTN","FHBIR",55,0)
 F FHOM=DAT:0 S FHOM=$O(^FHPT("SM",FHOM)) Q:FHOM=""!(FHOM>FHDTQ)  D
"RTN","FHBIR",56,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHOM,FHDFN)) Q:FHDFN=""  D
"RTN","FHBIR",57,0)
 ..S FHLOC=$P($G(^FHPT(FHDFN,"SM",FHOM,0)),U,3) Q:FHLOC=""
"RTN","FHBIR",58,0)
 ..S RM=$P($G(^FHPT(FHDFN,"SM",FHOM,0)),U,13)
"RTN","FHBIR",59,0)
 ..I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^DG(405.4,RM,0),U,1)
"RTN","FHBIR",60,0)
 ..D CHECK
"RTN","FHBIR",61,0)
 F FHOM=DAT:0 S FHOM=$O(^FHPT("GM",FHOM)) Q:FHOM=""!(FHOM>FHDTQ)  D
"RTN","FHBIR",62,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHOM,FHDFN)) Q:FHDFN=""  D
"RTN","FHBIR",63,0)
 ..S FHLOC=$P($G(^FHPT(FHDFN,"GM",FHOM,0)),U,5) Q:FHLOC=""
"RTN","FHBIR",64,0)
 ..S RM=$P($G(^FHPT(FHDFN,"GM",FHOM,0)),U,11)
"RTN","FHBIR",65,0)
 ..I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^DG(405.4,RM,0),U,1)
"RTN","FHBIR",66,0)
 ..D CHECK
"RTN","FHBIR",67,0)
 ;
"RTN","FHBIR",68,0)
 D HDR S NAM="" F K=0:0 S NAM=$O(^TMP($J,NAM)) Q:NAM=""  F FHDFN=0:0 S FHDFN=$O(^TMP($J,NAM,FHDFN)) Q:FHDFN<1  D
"RTN","FHBIR",69,0)
 .S X1=^TMP($J,NAM,FHDFN),DTP=$P(X1,"^",1),WRD=$P(X1,"^",2),RM=$P(X1,"^",3)
"RTN","FHBIR",70,0)
 .S DTP=$J(+$E(DTP,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(DTP,4,5))_"-"_(1700+$E(DTP,1,3))
"RTN","FHBIR",71,0)
 .D:$Y>(IOSL-10) HDR
"RTN","FHBIR",72,0)
 .W !,$E(NAM,5,30),?32,$E(WRD,1,10),?44,$E(RM,1,10),?56,DTP Q
"RTN","FHBIR",73,0)
 W ! K FHOPFLG Q
"RTN","FHBIR",74,0)
CHECK ;
"RTN","FHBIR",75,0)
 D PATNAME^FHOMUTL
"RTN","FHBIR",76,0)
 I 'TYP Q:$E(FHDOB,4,7)'=$E(DAT,4,7)
"RTN","FHBIR",77,0)
 Q:$E(FHDOB,4,5)'=$E(DAT,4,5)
"RTN","FHBIR",78,0)
 S FHCOM=$P($G(^FH(119.6,FHLOC,0)),U,8)
"RTN","FHBIR",79,0)
 I FHP'=0,FHCOM'=FHP Q
"RTN","FHBIR",80,0)
 S FHLNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHBIR",81,0)
 S:'$D(RM) RM=" "
"RTN","FHBIR",82,0)
 S BD=$E(FHDOB,4,7)_$E(FHPTNM,1,26),^TMP($J,BD,FHDFN)=FHDOB_"^"_FHLNM_"^"_RM Q
"RTN","FHDCR11")
0^8^B29757298
"RTN","FHDCR11",1,0)
FHDCR11 ; HISC/REL/NCA/RVD - Build Diet Cards (Cont.) ;3/27/96  10:20
"RTN","FHDCR11",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHDCR11",3,0)
 ;patch #5 - added outpatient SO and fix diet pattern for outpatient.
"RTN","FHDCR11",4,0)
BLD ; Build Diet Card list for a patient
"RTN","FHDCR11",5,0)
 S X1=$G(^FHPT(+FHDFN,"A",+ADM,0)),FHORD=$P(X1,"^",2),SVC=$P(X1,"^",5),SF=$P(X1,"^",7),IS=$P(X1,"^",10),FHD=$P(X1,"^",16),(FHOR,X)=""
"RTN","FHDCR11",6,0)
 I FHPAR'="Y" Q:SVC="C"
"RTN","FHDCR11",7,0)
 I SVC="C" S:SP'=SP1 SP=SP1 Q:'SP
"RTN","FHDCR11",8,0)
 Q:'FHORD  S X=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0))
"RTN","FHDCR11",9,0)
 S MPD=$P(X,"^",13),FHOR=$P(X,"^",2,6) Q:"^^^^"[FHOR
"RTN","FHDCR11",10,0)
 I IS S IS=$G(^FH(119.4,+IS,0)) S:IS'="" SVC=SVC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHDCR11",11,0)
 S:SF SVC=SVC_"  "_"SF"_"("_$S($P($G(^FHPT(FHDFN,"A",ADM,"SF",+SF,0)),"^",34)="Y":"M",1:"I")_")"
"RTN","FHDCR11",12,0)
 I UPD D OLD^FHMTK11 I OLD=FHOR S FLG2=0 D EVT^FHDCR2 Q:'FLG2
"RTN","FHDCR11",13,0)
 S STR=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,2))
"RTN","FHDCR11",14,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHDCR11",15,0)
 F MEAL="B","N","E" D
"RTN","FHDCR11",16,0)
 .K FP(MEAL),MP(MEAL),N2(MEAL) I $P(STR,";",$S(MEAL="B":1,MEAL="N":2,1:3))'="" D DECOD^FHDCR1B
"RTN","FHDCR11",17,0)
 .S PD=MPD
"RTN","FHDCR11",18,0)
 .I DPAT S PD=$P($G(^FH(111.1,DPAT,0)),"^",7) D
"RTN","FHDCR11",19,0)
 ..I $P(STR,";",$S(MEAL="B":1,MEAL="N":2,1:3))="",$O(MP(MEAL,""))="" F X8=0:0 S X8=$O(^FH(111.1,DPAT,MEAL,X8)) Q:X8<1  S Z1=$G(^(X8,0)) D
"RTN","FHDCR11",20,0)
 ...S ZZ=$G(^FH(114.1,+Z1,0)),NAM=$P(ZZ,"^",1)
"RTN","FHDCR11",21,0)
 ...S K4=$P(ZZ,"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHDCR11",22,0)
 ...S MP(MEAL,K4_"~"_+Z1_"~"_NAM)=$P(Z1,"^",2) Q
"RTN","FHDCR11",23,0)
 ..Q
"RTN","FHDCR11",24,0)
 .Q:PD=""  S PD=$P($G(^FH(116.2,PD,0)),"^",2) Q:PD=""
"RTN","FHDCR11",25,0)
 I NBR=2 D PRT^FHDCR1C K ^TMP($J,"MP"),^TMP($J,0),PP,S,TT S NBR=0
"RTN","FHDCR11",26,0)
 Q:PD=""  S NBR=NBR+1 D PID^FHDPA
"RTN","FHDCR11",27,0)
 S Y0=$P($G(^DPT(DFN,0)),"^",1)_" ("_BID_")"_"  "_SVC,N1=0,S(NBR)=0
"RTN","FHDCR11",28,0)
 D CUR^FHORD7
"RTN","FHDCR11",29,0)
 S N1=N1+1 I $L(Y)<60 S PP(N1,NBR)=Y
"RTN","FHDCR11",30,0)
 E  S L=$S($L($P(Y,",",1,4))<60:4,1:3) S PP(N1,NBR)=$P(Y,",",1,L),N1=N1+1,PP(N1,NBR)=$E($P(Y,",",L+1,5),2,99)
"RTN","FHDCR11",31,0)
 S ^TMP($J,0,NBR)=Y0_"^"_WRDN_"^"_RM
"RTN","FHDCR11",32,0)
 I $G(DFN) D ALG^FHCLN S ALG="ALLGS.: "_$S(ALG="":"NONE ON FILE",1:ALG) S J=0 D BRK^FHDCR1B
"RTN","FHDCR11",33,0)
 S S(NBR)=S(NBR)+1
"RTN","FHDCR11",34,0)
 S ^TMP($J,"MP",S(NBR),NBR)="   Breakfast                Noon               Evening"
"RTN","FHDCR11",35,0)
 K NN F MEAL="B","N","E" D
"RTN","FHDCR11",36,0)
 .S X8="" F  S X8=$O(MP(MEAL,X8)) Q:X8=""  S X1=+$G(MP(MEAL,X8)) D
"RTN","FHDCR11",37,0)
 ..;Q:'X1  S Z1=$P(X8,"~",2),QTY=$S(+X1#1>0:$J(+X1,3,1),1:+X1_"  ")_" "
"RTN","FHDCR11",38,0)
 ..Q:'X1  S Z1=$P(X8,"~",2),PAD=$E("    ",1,5-$L(X1)),QTY=+X1_PAD
"RTN","FHDCR11",39,0)
 ..S NN(MEAL,X8)=QTY_$E($P(X8,"~",3),1,15)
"RTN","FHDCR11",40,0)
 ..Q
"RTN","FHDCR11",41,0)
 .Q
"RTN","FHDCR11",42,0)
 K TT,SRT F MEAL="B","N","E" D
"RTN","FHDCR11",43,0)
 .S TT(MEAL)=0
"RTN","FHDCR11",44,0)
 .S X8="" F  S X8=$O(NN(MEAL,X8)) Q:X8=""  D
"RTN","FHDCR11",45,0)
 ..S TT(MEAL)=TT(MEAL)+1,SRT(TT(MEAL),MEAL)=$G(NN(MEAL,X8)) Q
"RTN","FHDCR11",46,0)
 .D SO^FHDCR1B,DISL^FHDCR1B Q
"RTN","FHDCR11",47,0)
 F N1=1:1 Q:'$D(SRT(N1))  D
"RTN","FHDCR11",48,0)
 .S STR="" F MEAL="B","N","E" D
"RTN","FHDCR11",49,0)
 ..I '$D(SRT(N1,MEAL)) S STR=STR_$J("",20) Q
"RTN","FHDCR11",50,0)
 ..S STR=STR_SRT(N1,MEAL)
"RTN","FHDCR11",51,0)
 ..S:MEAL'="E" STR=STR_$J("",20-$L(SRT(N1,MEAL)))
"RTN","FHDCR11",52,0)
 ..Q
"RTN","FHDCR11",53,0)
 .S S(NBR)=S(NBR)+1
"RTN","FHDCR11",54,0)
 .S ^TMP($J,"MP",S(NBR),NBR)=STR
"RTN","FHDCR11",55,0)
 .Q
"RTN","FHDCR11",56,0)
 ;
"RTN","FHDCR11",57,0)
OUT ;OUTPATIENT data
"RTN","FHDCR11",58,0)
 S (SVC,SF,IS)=""
"RTN","FHDCR11",59,0)
 I '$D(FHKDAT)!'$G(FHADM) Q
"RTN","FHDCR11",60,0)
 S X1=FHKDAT
"RTN","FHDCR11",61,0)
 S FHWARD=W1 D LOC
"RTN","FHDCR11",62,0)
 S (FHOR,FHORD)=$P(FHKDAT,U,2),FHD=$P(X1,"^",14)
"RTN","FHDCR11",63,0)
 I FHPAR'="Y" Q:SVC="C"
"RTN","FHDCR11",64,0)
 I SVC="C" S:SP'=SP1 SP=SP1 Q:'SP
"RTN","FHDCR11",65,0)
 I FHORD="" S FHORD=$P(FHKDAT,U,7,11)
"RTN","FHDCR11",66,0)
 S:$D(^FHPT(FHDFN,0)) IS=$P(^FHPT(FHDFN,0),U,5)
"RTN","FHDCR11",67,0)
 I $D(^FHPT(FHDFN,"OP",FHADM,"SF",0)) S SF=$P(^(0),U,3)
"RTN","FHDCR11",68,0)
 I IS S IS=$G(^FH(119.4,+IS,0)) S:IS'="" SVC=SVC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHDCR11",69,0)
 I SF,$D(^FHPT(FHDFN,"OP",FHADM,"SF",SF,0)),'$P(^(0),U,32) S SVC=SVC_"  "_"SF"_"("_$S($P($G(^FHPT(FHDFN,"OP",FHADM,"SF",SF,0)),"^",34)="Y":"M",1:"I")_")"
"RTN","FHDCR11",70,0)
 I UPD D OLD^FHMTK11 I OLD=FHOR S FLG2=0 D EVT^FHDCR2 Q:'FLG2
"RTN","FHDCR11",71,0)
 S STR=""
"RTN","FHDCR11",72,0)
 S:$G(FHOR) FHOR=FHOR_"^^^^"
"RTN","FHDCR11",73,0)
 I FHOR="" S FHOR=$P(FHKDAT,U,7,11)
"RTN","FHDCR11",74,0)
 ;
"RTN","FHDCR11",75,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHDCR11",76,0)
 F MEAL="B","N","E" D
"RTN","FHDCR11",77,0)
 .Q:FHMEAL'=MEAL
"RTN","FHDCR11",78,0)
 .K FP(MEAL),MP(MEAL),N2(MEAL)
"RTN","FHDCR11",79,0)
 .S PD=""
"RTN","FHDCR11",80,0)
 .S:$G(MPD) PD=MPD
"RTN","FHDCR11",81,0)
 .I DPAT S PD=$P($G(^FH(111.1,DPAT,0)),"^",7) D
"RTN","FHDCR11",82,0)
 ..F X8=0:0 S X8=$O(^FH(111.1,DPAT,MEAL,X8)) Q:X8<1  S Z1=$G(^(X8,0)) D
"RTN","FHDCR11",83,0)
 ...S ZZ=$G(^FH(114.1,+Z1,0)),NAM=$P(ZZ,"^",1)
"RTN","FHDCR11",84,0)
 ...S K4=$P(ZZ,"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHDCR11",85,0)
 ...S MP(MEAL,K4_"~"_+Z1_"~"_NAM)=$P(Z1,"^",2)
"RTN","FHDCR11",86,0)
 ..Q
"RTN","FHDCR11",87,0)
 .Q:PD=""  S PD=$P($G(^FH(116.2,PD,0)),"^",2) Q:PD=""
"RTN","FHDCR11",88,0)
 I NBR=2 D PRT^FHDCR1C K ^TMP($J,"MP"),^TMP($J,0),PP,S,TT,SRT S (N1,NBR)=0
"RTN","FHDCR11",89,0)
 Q:PD=""  S NBR=NBR+1 D PATNAME^FHOMUTL
"RTN","FHDCR11",90,0)
 S Y0=FHPTNM_" ("_FHBID_")"_"  "_SVC,N1=0,S(NBR)=0,Y="***"
"RTN","FHDCR11",91,0)
 I '$G(FHDIET) S FHRNUM=FHKD D DIETPAT^FHOMRR1 S Y=$E(FHDIETP,1,18)
"RTN","FHDCR11",92,0)
 S:$G(FHDIET) Y=$P(^FH(111,FHDIET,0),U,7)
"RTN","FHDCR11",93,0)
 S N1=N1+1 I $L(Y)<60 S PP(N1,NBR)=Y
"RTN","FHDCR11",94,0)
 E  S L=$S($L($P(Y,",",1,4))<60:4,1:3) S PP(N1,NBR)=$P(Y,",",1,L),N1=N1+1,PP(N1,NBR)=$E($P(Y,",",L+1,5),2,99)
"RTN","FHDCR11",95,0)
 S ^TMP($J,0,NBR)=Y0_"^"_WRDN_"^"_RM_"^^^^"_FHMEAL
"RTN","FHDCR11",96,0)
 I $G(DFN) D ALG^FHCLN S ALG="ALLGS.: "_$S(ALG="":"NONE ON FILE",1:ALG) S J=0 D BRK^FHDCR1B
"RTN","FHDCR11",97,0)
 S S(NBR)=S(NBR)+1
"RTN","FHDCR11",98,0)
 S ^TMP($J,"MP",S(NBR),NBR)="   Breakfast                Noon               Evening"
"RTN","FHDCR11",99,0)
 K NN F MEAL="B","N","E" D
"RTN","FHDCR11",100,0)
 .S X8="" F  S X8=$O(MP(MEAL,X8)) Q:X8=""  S X1=+$G(MP(MEAL,X8)) D
"RTN","FHDCR11",101,0)
 ..;Q:'X1  S Z1=$P(X8,"~",2),QTY=$S(+X1#1>0:$J(+X1,3,1),1:+X1_"  ")_" "
"RTN","FHDCR11",102,0)
 ..Q:'X1  S Z1=$P(X8,"~",2),PAD=$E("    ",1,5-$L(X1)),QTY=+X1_PAD
"RTN","FHDCR11",103,0)
 ..S NN(MEAL,X8)=QTY_$E($P(X8,"~",3),1,15)
"RTN","FHDCR11",104,0)
 ..Q
"RTN","FHDCR11",105,0)
 .Q
"RTN","FHDCR11",106,0)
 K TT,SRT F MEAL="B","N","E" D
"RTN","FHDCR11",107,0)
 .S TT(MEAL)=0
"RTN","FHDCR11",108,0)
 .S X8="" F  S X8=$O(NN(MEAL,X8)) Q:X8=""  D
"RTN","FHDCR11",109,0)
 ..S TT(MEAL)=TT(MEAL)+1,SRT(TT(MEAL),MEAL)=$G(NN(MEAL,X8)) Q
"RTN","FHDCR11",110,0)
 .D SOUT^FHDCR1B,DISL^FHDCR1B
"RTN","FHDCR11",111,0)
 ;
"RTN","FHDCR11",112,0)
 F N1=1:1 Q:'$D(SRT(N1))  D
"RTN","FHDCR11",113,0)
 .S STR="" F MEAL="B","N","E" D
"RTN","FHDCR11",114,0)
 ..I '$D(SRT(N1,MEAL))!(MEAL'=FHMEAL) S STR=STR_$J("",20) Q
"RTN","FHDCR11",115,0)
 ..S STR=STR_SRT(N1,MEAL)
"RTN","FHDCR11",116,0)
 ..S:MEAL'="E" STR=STR_$J("",20-$L(SRT(N1,MEAL)))
"RTN","FHDCR11",117,0)
 ..Q
"RTN","FHDCR11",118,0)
 .S S(NBR)=S(NBR)+1
"RTN","FHDCR11",119,0)
 .S ^TMP($J,"MP",S(NBR),NBR)=STR
"RTN","FHDCR11",120,0)
 .Q
"RTN","FHDCR11",121,0)
 Q
"RTN","FHDCR11",122,0)
 ;
"RTN","FHDCR11",123,0)
LOC ;get location info
"RTN","FHDCR11",124,0)
 I $G(FHWARD),$D(^FH(119.6,FHWARD,0)) S FHWDAT=^FH(119.6,FHWARD,0) D
"RTN","FHDCR11",125,0)
 .S FHWT=$P(FHWDAT,U,5)
"RTN","FHDCR11",126,0)
 .S FHWC=$P(FHWDAT,U,6)
"RTN","FHDCR11",127,0)
 .S FHWD=$P(FHWDAT,U,7)
"RTN","FHDCR11",128,0)
 .I $G(FHWT),$D(^FH(119.72,FHWT,0)) S SVC=$P(^FH(119.72,FHWT,0),U,2)
"RTN","FHDCR11",129,0)
 .I $G(FHWC),$D(^FH(119.72,FHWC,0)) S SVC=$P(^FH(119.72,FHWC,0),U,2)
"RTN","FHDCR11",130,0)
 .I FHRGS="OP" D
"RTN","FHDCR11",131,0)
 ..S (FHOR,FHDIET)=$P(FHKDAT,U,2)
"RTN","FHDCR11",132,0)
 .I FHRGS="GM" D
"RTN","FHDCR11",133,0)
 ..S FHDIET=$P(FHKDAT,U,6)
"RTN","FHDCR11",134,0)
 .I FHRGS="SM" D
"RTN","FHDCR11",135,0)
 ..S FHDIET=$P(FHKDAT,U,4)
"RTN","FHDCR11",136,0)
 .S:$G(FHDIET) MPD=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHDCR11",137,0)
 Q
"RTN","FHDCR1A")
0^21^B45241377
"RTN","FHDCR1A",1,0)
FHDCR1A ; HISC/REL/NCA/RVD - Build Diet Cards ;1/21/99  14:04
"RTN","FHDCR1A",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHDCR1A",3,0)
 ;patch #5 - added the screen for cancelled Guest meal.
"RTN","FHDCR1A",4,0)
B1 ; Store wards
"RTN","FHDCR1A",5,0)
 K ^TMP($J),NN,N,P S MFLG=0 D Q1^FHDCR1B D NOW^%DTC S (DTP,TIM)=% D DTP^FH S HD=DTP S:MEAL="A" MFLG=1
"RTN","FHDCR1A",6,0)
 S DTP=D1 D DTP^FH S (MDT,MEALDT)=DTP,MEALDT=$J("",62-$L(MEALDT)\2)_MEALDT
"RTN","FHDCR1A",7,0)
 S FHBOT=$P($G(^FH(119.9,1,4)),"^",1)
"RTN","FHDCR1A",8,0)
 S FHD1=D1-.00001,FHD2=D1+.99999
"RTN","FHDCR1A",9,0)
 S FHDFNSAV="",FHW1SAV=W1,FHFHPSAV=FHP,FHMEALSA=MEAL
"RTN","FHDCR1A",10,0)
 S:$G(FHDFN) FHDFNSAV=FHDFN
"RTN","FHDCR1A",11,0)
 I $G(DFN),'$D(^DPT(DFN,.1)) G OUTALL
"RTN","FHDCR1A",12,0)
 I '$G(DFN),$G(FHDFN) G OUTALL
"RTN","FHDCR1A",13,0)
 ;next process inpatient data
"RTN","FHDCR1A",14,0)
DFN I $G(DFN),$G(FHDFN) D  Q
"RTN","FHDCR1A",15,0)
 .S ADM=+$G(^DPT(DFN,.105)),W1=+$P($G(^FHPT(FHDFN,"A",+ADM,0)),"^",8)
"RTN","FHDCR1A",16,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24),RM=$G(^DPT(DFN,.101))
"RTN","FHDCR1A",17,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",18,0)
 .K PP,S,MM S NBR=0
"RTN","FHDCR1A",19,0)
 .I 'TPP D BLD^FHDCR11 D:NBR UPD,PRT^FHDCR1C Q
"RTN","FHDCR1A",20,0)
 .I 'MFLG D BLD^FHDCR1D D:NBR UPD,PRT^FHMTK1C Q
"RTN","FHDCR1A",21,0)
 .F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",22,0)
 .D UPD
"RTN","FHDCR1A",23,0)
 .D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",24,0)
 ;if ward, do specific ward/location;otherwise, do all entry for all
"RTN","FHDCR1A",25,0)
 ;wards/locations and all communication offices.
"RTN","FHDCR1A",26,0)
WARD I W1 S ^TMP($J,"W","01"_$P($G(^FH(119.6,+W1,0)),"^",1))=W1_"^"_$P($G(^FH(119.6,+W1,0)),"^",5,6)_"^"_$P($G(^FH(119.6,+W1,0)),"^",24)
"RTN","FHDCR1A",27,0)
 E  F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D
"RTN","FHDCR1A",28,0)
 .S P0=$G(^FH(119.6,W1,0)),WRDN=$P(P0,"^",1),SP=$P(P0,"^",5,6),D2=$P(P0,"^",8),FHPAR=$P(P0,"^",24),P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHDCR1A",29,0)
 .I FHP,D2'=FHP Q
"RTN","FHDCR1A",30,0)
 .S ^TMP($J,"W",P0_WRDN)=W1_"^"_SP_"^"_FHPAR Q
"RTN","FHDCR1A",31,0)
 S NX="" F  S NX=$O(^TMP($J,"W",NX)) Q:NX=""  S X1=$G(^(NX)),W1=+X1,FHS=$P(X1,"^",2),SP1=$P(X1,"^",3),FHPAR=$P(X1,"^",4),WRDN=$E(NX,3,99) S:'FHS&(FHPAR="Y") FHS=SP1 I FHS K ^TMP($J,"D") D
"RTN","FHDCR1A",32,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",33,0)
 ..D PATNAME^FHOMUTL Q:'$G(DFN)
"RTN","FHDCR1A",34,0)
 ..S ADM=$G(^FHPT("AW",W1,FHDFN))
"RTN","FHDCR1A",35,0)
 ..I SORT="A" S RM=$P($G(^DPT(DFN,0)),"^",1),DL=0,RMB=$G(^DPT(DFN,.101)) S:RMB="" RMB="***"
"RTN","FHDCR1A",36,0)
 ..E  S RI=$G(^DPT(DFN,.108)),RM=$G(^DPT(DFN,.101)) S:RM="" RM="***" S:RI RE=$O(^FH(119.6,"AR",+RI,W1,0)) S:'RI RE="" S DL=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:""),RMB=""
"RTN","FHDCR1A",37,0)
 ..S DL=$S(DL<1:99,DL<10:"0"_DL,1:DL)
"RTN","FHDCR1A",38,0)
 ..S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":DFN,1:RMB))=DFN_"^"_ADM_"^"_FHDFN Q
"RTN","FHDCR1A",39,0)
 .;
"RTN","FHDCR1A",40,0)
 .K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S DFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",41,0)
 ..S FHDFN=$P(FHX6,"^",3)
"RTN","FHDCR1A",42,0)
 ..S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",43,0)
 ..I TPP D  Q
"RTN","FHDCR1A",44,0)
 ...I 'MFLG D BLD^FHDCR1D,UPD Q
"RTN","FHDCR1A",45,0)
 ...F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",46,0)
 ...D UPD
"RTN","FHDCR1A",47,0)
 ...Q
"RTN","FHDCR1A",48,0)
 ..I 'TPP D BLD^FHDCR11 D UPD Q
"RTN","FHDCR1A",49,0)
 .I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",50,0)
 .D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",51,0)
 ;
"RTN","FHDCR1A",52,0)
OUTALL K ^TMP($J,"D")   ;reset/clean-up tmp global outpatient process.
"RTN","FHDCR1A",53,0)
 ;process outpatient data
"RTN","FHDCR1A",54,0)
 ;next recurring
"RTN","FHDCR1A",55,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>FHD2)  D
"RTN","FHDCR1A",56,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",57,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHDCR1A",58,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHDCR1A",59,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",60,0)
 ...S FHRMB=$P(FHKDAT,U,18)
"RTN","FHDCR1A",61,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHDCR1A",62,0)
 ...S:FHDIET="" FHDIET=$E(FHKDAT,7,11)
"RTN","FHDCR1A",63,0)
 ...I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",64,0)
 ...I FHSTAT="C" Q
"RTN","FHDCR1A",65,0)
 ...I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",66,0)
 ...I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",67,0)
 ...S FHLOC="",FHRGS="OP"
"RTN","FHDCR1A",68,0)
 ...Q:'$G(FHW1)
"RTN","FHDCR1A",69,0)
 ...S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",70,0)
 ...I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",71,0)
 ...S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",72,0)
 ...I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",73,0)
 ...I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",74,0)
 ...D OUTW
"RTN","FHDCR1A",75,0)
 ;next guest
"RTN","FHDCR1A",76,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",77,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",78,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHDCR1A",79,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHDCR1A",80,0)
 ..S FHSTAT=$P(FHKDAT,U,9)
"RTN","FHDCR1A",81,0)
 ..Q:FHSTAT="C"
"RTN","FHDCR1A",82,0)
 ..S FHRMB=$P(FHKDAT,U,11)
"RTN","FHDCR1A",83,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",84,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",85,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",86,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",87,0)
 ..S FHLOC="",FHRGS="GM"
"RTN","FHDCR1A",88,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",89,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",90,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",91,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",92,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",93,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",94,0)
 ..D OUTW
"RTN","FHDCR1A",95,0)
 ;next SPECIAL
"RTN","FHDCR1A",96,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",97,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",98,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHDCR1A",99,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",100,0)
 ..S FHRMB=$P(FHKDAT,U,13)
"RTN","FHDCR1A",101,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",102,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHDCR1A",103,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",104,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",105,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",106,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",107,0)
 ..S FHLOC="",FHRGS="SM"
"RTN","FHDCR1A",108,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",109,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",110,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",111,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",112,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",113,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",114,0)
 ..D OUTW
"RTN","FHDCR1A",115,0)
 ;
"RTN","FHDCR1A",116,0)
 K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S FHDFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",117,0)
 .S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",118,0)
 .S FHDFN=$P(FHX6,"^",1),FHRGS=$P(FHX6,"^",2)
"RTN","FHDCR1A",119,0)
 .D PATNAME^FHOMUTL
"RTN","FHDCR1A",120,0)
 .S FHKD=$P(FHX6,"^",3),W1=$P(FHX6,"^",4)
"RTN","FHDCR1A",121,0)
 .Q:$G(FHRGS)!('$G(FHKD))
"RTN","FHDCR1A",122,0)
 .S FHSTAT="",FHADM=FHKD
"RTN","FHDCR1A",123,0)
 .S FHKDAT=$G(^FHPT(FHDFN,""_FHRGS_"",FHKD,0))
"RTN","FHDCR1A",124,0)
 .I FHRGS="GM" S W1=$P(FHKDAT,U,5),FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",125,0)
 .I FHRGS="OP" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHDCR1A",126,0)
 .I FHRGS="SM" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHDCR1A",127,0)
 .;don't process IF STATUS IS cancelled or denied
"RTN","FHDCR1A",128,0)
 .I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",129,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",130,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",131,0)
 .I TPP D  Q
"RTN","FHDCR1A",132,0)
 ..I 'MFLG,'ADM D OUT^FHDCR1D,@FHRGS Q
"RTN","FHDCR1A",133,0)
 ..F MEAL="B","N","E" D:'ADM OUT^FHDCR1D
"RTN","FHDCR1A",134,0)
 ..D:'ADM @FHRGS
"RTN","FHDCR1A",135,0)
 .I 'TPP,'ADM D OUT^FHDCR11 D @FHRGS Q
"RTN","FHDCR1A",136,0)
 I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",137,0)
 D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",138,0)
 Q
"RTN","FHDCR1A",139,0)
 ;
"RTN","FHDCR1A",140,0)
UPD ; Update Date/Time Diet Card was Printed
"RTN","FHDCR1A",141,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",16)=TIM Q
"RTN","FHDCR1A",142,0)
OUTP ;process outpatient using patient
"RTN","FHDCR1A",143,0)
 S RM="***"
"RTN","FHDCR1A",144,0)
 S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",145,0)
 I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",146,0)
 K PP,S,MM S NBR=0,FHADM=FHKD I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S RM=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHDCR1A",147,0)
 I 'TPP D OUT^FHDCR11 D:NBR @FHRGS,PRT^FHDCR1C K ^TMP($J,"MP"),^TMP($J,0),PP,S,TT,SRT Q
"RTN","FHDCR1A",148,0)
 I 'MFLG D OUT^FHDCR1D D:NBR @FHRGS,PRT^FHMTK1C Q
"RTN","FHDCR1A",149,0)
 F MEAL="B","N","E" D OUT^FHDCR1D
"RTN","FHDCR1A",150,0)
 D @FHRGS
"RTN","FHDCR1A",151,0)
 D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",152,0)
 Q
"RTN","FHDCR1A",153,0)
OP S $P(^FHPT(FHDFN,"OP",FHKD,0),"^",14)=TIM Q
"RTN","FHDCR1A",154,0)
GM S $P(^FHPT(FHDFN,"GM",FHKD,0),"^",8)=TIM Q
"RTN","FHDCR1A",155,0)
SM S $P(^FHPT(FHDFN,"SM",FHKD,0),"^",11)=TIM Q
"RTN","FHDCR1A",156,0)
 ;
"RTN","FHDCR1A",157,0)
OUTW ;process outpatient using all and ward.
"RTN","FHDCR1A",158,0)
 ;F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",159,0)
 D PATNAME^FHOMUTL
"RTN","FHDCR1A",160,0)
 S (RM,RMB)="***"
"RTN","FHDCR1A",161,0)
 I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S RMB=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHDCR1A",162,0)
 I SORT="A" S RM=FHPTNM,DL=0
"RTN","FHDCR1A",163,0)
 E  S (RI,RE,DL)="***",RM=RMB
"RTN","FHDCR1A",164,0)
 S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":FHDFN,1:RMB)_FHMEAL)=FHDFN_"^"_FHRGS_"^"_FHKD_"^"_W1
"RTN","FHDCR1A",165,0)
 Q
"RTN","FHDCR1B")
0^9^B21288577
"RTN","FHDCR1B",1,0)
FHDCR1B ; HISC/NCA - Diet Card Utilities ;2/23/00  09:51
"RTN","FHDCR1B",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHDCR1B",3,0)
 ;patch#5 - added outpatient SO.
"RTN","FHDCR1B",4,0)
Q1 ; Store Bread/Beverage default, Food Preference, and Recipes of meal
"RTN","FHDCR1B",5,0)
 S LN=$S(IOST?1"C".E:IOSL-2,1:IOSL-6),FHX4=FHX1 F SP=0:0 S SP=$O(^FH(119.72,SP)) Q:SP<1  S Z=$G(^(SP,0)),^TMP($J,"SRP",SP)=$P(Z,"^",1,4)
"RTN","FHDCR1B",6,0)
 I MEAL'="A" S M1=MEAL D GET Q
"RTN","FHDCR1B",7,0)
 F M1="B","N","E" D GET
"RTN","FHDCR1B",8,0)
 Q
"RTN","FHDCR1B",9,0)
GET F LL=0:0 S LL=$O(^FH(115.2,LL)) Q:LL<1  D
"RTN","FHDCR1B",10,0)
 .S L2=$G(^(LL,0))
"RTN","FHDCR1B",11,0)
 .I $P(L2,"^",2)="D" D  Q
"RTN","FHDCR1B",12,0)
 ..I FLG S ^TMP($J,"X",M1,LL,0)=""
"RTN","FHDCR1B",13,0)
 ..F KK=0:0 S KK=$O(^FH(115.2,LL,"X",KK)) Q:KK<1  S REC=$P($G(^(KK,0)),"^",1) S ^TMP($J,"X",M1,LL,KK)=+REC
"RTN","FHDCR1B",14,0)
 ..Q
"RTN","FHDCR1B",15,0)
 .S REC=$P(L2,"^",4) Q:'REC  S Y=$G(^FH(114,+REC,0)),NAM=$P(Y,"^",1),K3=$P(Y,"^",7) Q:'K3  I $P(L2,"^",5) D
"RTN","FHDCR1B",16,0)
 ..I $P(L2,"^",6)[M1 S:'$D(^TMP($J,"FHDEF",M1,K3,+REC)) ^TMP($J,"FHDEF",M1,K3,+REC)=+REC_"^"_NAM
"RTN","FHDCR1B",17,0)
 ..Q
"RTN","FHDCR1B",18,0)
 .Q
"RTN","FHDCR1B",19,0)
 I FLG D  Q
"RTN","FHDCR1B",20,0)
 .S P1="" F  S P1=$O(^FH(116.2,"C",P1)) Q:P1=""  F P2=0:0 S P2=$O(^FH(116.2,"C",P1,P2)) Q:P2<1  S NN(P1)=+P2
"RTN","FHDCR1B",21,0)
 .F LL=0:0 S LL=$O(^TMP($J,"FHDEF",M1,LL)) Q:LL<1  F NX=0:0 S NX=$O(^TMP($J,"FHDEF",M1,LL,NX)) Q:NX<1  S L1=$G(^TMP($J,"FHDEF",M1,LL,NX)) D
"RTN","FHDCR1B",22,0)
 ..S NAM=$P(L1,"^",2)
"RTN","FHDCR1B",23,0)
 ..S PD="" F  S PD=$O(NN(PD)) Q:PD=""  D
"RTN","FHDCR1B",24,0)
 ...S P4="~" F SP=0:0 S SP=$O(^TMP($J,"SRP",SP)) Q:SP<1  S P4=P4_SP_"~"
"RTN","FHDCR1B",25,0)
 ...S ^TMP($J,"DEF",M1,PD,LL_"~"_NAM)=+L1_"~"_LL_"~"_NAM_P4
"RTN","FHDCR1B",26,0)
 ...Q
"RTN","FHDCR1B",27,0)
 ..Q
"RTN","FHDCR1B",28,0)
 .Q
"RTN","FHDCR1B",29,0)
 S FHX1=$P(FHX4,"^",$F("BNE",M1)) Q:'FHX1
"RTN","FHDCR1B",30,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",M1,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",M1,LL,KK)) Q:KK<1  S X1=+$G(^(KK)),X2=$O(^FH(116.1,FHX1,"RE","B",X1,0)) I X2<1 K ^TMP($J,"X",M1,LL,KK)
"RTN","FHDCR1B",31,0)
 F P1=0:0 S P1=$O(^FH(116.1,FHX1,"RE",P1)) Q:P1<1  S L1=$G(^(P1,0)),Y=$G(^FH(114,+L1,0)),NAM=$P(Y,"^",1) D
"RTN","FHDCR1B",32,0)
 .F CAT=0:0 S CAT=$O(^FH(116.1,FHX1,"RE",P1,"R",CAT)) Q:CAT<1  S MCA=$G(^(CAT,0)) D
"RTN","FHDCR1B",33,0)
 ..S FHPD=$P(MCA,"^",2),K3=+MCA S:'K3 K3=$P(Y,"^",7) S K4=$P($G(^FH(114.1,+K3,0)),"^",3)
"RTN","FHDCR1B",34,0)
 ..Q:'$D(^TMP($J,"FHDEF",M1,K3))
"RTN","FHDCR1B",35,0)
 ..F P2=1:1 S FHX2=$P(FHPD," ",P2) Q:FHX2=""  S PD=$P(FHX2,";",1),P4="~" I PD'="" D
"RTN","FHDCR1B",36,0)
 ...F SP=0:0 S SP=$O(^TMP($J,"SRP",SP)) Q:SP<1  S SRP=$G(^TMP($J,"SRP",SP)),Z1=$G(^FH(116.1,FHX1,"RE",P1,"D",SP,0)),Z1=$P(Z1,"^",2),Z1=$S(Z1="":1,1:Z1) D SRP
"RTN","FHDCR1B",37,0)
 ...S ^TMP($J,"DEF",M1,PD,K3_"~"_NAM)=+L1_"~"_K3_"~"_NAM_P4 Q
"RTN","FHDCR1B",38,0)
 ..Q
"RTN","FHDCR1B",39,0)
 .Q
"RTN","FHDCR1B",40,0)
 Q
"RTN","FHDCR1B",41,0)
DECOD ; Decode code string
"RTN","FHDCR1B",42,0)
 S M1=$S(MEAL="B":1,MEAL="N":2,1:3),ST=$P(STR,";",M1)
"RTN","FHDCR1B",43,0)
 F X4=1:1 Q:$P(ST," ",X4,99)=""  D
"RTN","FHDCR1B",44,0)
 .S X1=$P(ST," ",X4),ZZ=$G(^FH(114.1,+X1,0)),NAM=$P(ZZ,"^",1)
"RTN","FHDCR1B",45,0)
 .S K4=$P(ZZ,"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHDCR1B",46,0)
 .S $P(X1,",",2)=$S($P(X1,",",2)'="":$P(X1,",",2),1:1)
"RTN","FHDCR1B",47,0)
 .S MP(MEAL,K4_"~"_+X1_"~"_NAM)=$P(X1,",",2) Q
"RTN","FHDCR1B",48,0)
 Q
"RTN","FHDCR1B",49,0)
DISL ; Store patient dislikes
"RTN","FHDCR1B",50,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",MEAL,LL)) Q:LL<1  D DL1 F KK=0:0 S KK=$O(^TMP($J,"X",MEAL,LL,KK)) Q:KK<1
"RTN","FHDCR1B",51,0)
 Q
"RTN","FHDCR1B",52,0)
DL1 S X6=$O(^FHPT(FHDFN,"P","B",LL,0)) Q:X6<1
"RTN","FHDCR1B",53,0)
 S X2=$G(^FHPT(FHDFN,"P",X6,0)) Q:$P(X2,"^",2)'[MEAL
"RTN","FHDCR1B",54,0)
 S TT(MEAL)=TT(MEAL)+1
"RTN","FHDCR1B",55,0)
 S SRT(TT(MEAL),MEAL)="    "_$E($P($G(^FH(115.2,+X2,0)),"^",1),1,15)
"RTN","FHDCR1B",56,0)
 Q
"RTN","FHDCR1B",57,0)
CHK ; Check for Patient dislike on meal
"RTN","FHDCR1B",58,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",MEAL,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",MEAL,LL,KK)) Q:KK<1  S X1=+$G(^TMP($J,"X",MEAL,LL,KK)) D
"RTN","FHDCR1B",59,0)
 .S X6=$O(^FHPT(FHDFN,"P","B",LL,0)) Q:X6<1
"RTN","FHDCR1B",60,0)
 .S X2=$G(^FHPT(FHDFN,"P",X6,0)) Q:$P(X2,"^",2)'[MEAL
"RTN","FHDCR1B",61,0)
 .S FP(MEAL,X1)=""
"RTN","FHDCR1B",62,0)
 .Q
"RTN","FHDCR1B",63,0)
 Q
"RTN","FHDCR1B",64,0)
SO ; Store Standing Orders
"RTN","FHDCR1B",65,0)
 F K=0:0 S K=$O(^FHPT("ASP",FHDFN,ADM,K)) Q:K<1  D
"RTN","FHDCR1B",66,0)
 .S X=$G(^FHPT(FHDFN,"A",ADM,"SP",K,0)),Z=$P(X,"^",2),M=$P(X,"^",3) Q:'Z
"RTN","FHDCR1B",67,0)
 .I M[MEAL S TT(MEAL)=TT(MEAL)+1,SRT(TT(MEAL),MEAL)=$S($P(X,"^",8):$P(X,"^",8),1:1)_"   "_$E($P($G(^FH(118.3,+Z,0)),"^",1),1,15) Q
"RTN","FHDCR1B",68,0)
 Q
"RTN","FHDCR1B",69,0)
 ;
"RTN","FHDCR1B",70,0)
SOUT ; Store Outpatient Standing Orders.
"RTN","FHDCR1B",71,0)
 Q:'$G(FHKD)
"RTN","FHDCR1B",72,0)
 S FHOPDAT0=$G(^FHPT(FHDFN,"OP",FHKD,0)) Q:$P(FHOPDAT0,U,15)="C"
"RTN","FHDCR1B",73,0)
 F K=0:0 S K=$O(^FHPT("ASPO",FHDFN,FHKD,K)) Q:K<1  D
"RTN","FHDCR1B",74,0)
 .S X=$G(^FHPT(FHDFN,"OP",FHKD,"SP",K,0)),Z=$P(X,"^",2),M=$P(X,"^",3) Q:'Z
"RTN","FHDCR1B",75,0)
 .I M[MEAL S TT(MEAL)=TT(MEAL)+1,SRT(TT(MEAL),MEAL)=$S($P(X,"^",8):$P(X,"^",8),1:1)_"   "_$E($P($G(^FH(118.3,+Z,0)),"^",1),1,15) Q
"RTN","FHDCR1B",76,0)
 Q
"RTN","FHDCR1B",77,0)
 ;
"RTN","FHDCR1B",78,0)
SRP ; Store service point for each Production Diet of recipe
"RTN","FHDCR1B",79,0)
 I Z1 S:'$F(P4,"~"_SP_"~") P4=P4_SP_"~"
"RTN","FHDCR1B",80,0)
 S FHX3=$P(FHX2,";",2),SC=$S(FHX3'="":$E(FHX3,1),1:""),NUM=$S(SC'="":$P(FHX3,SC,2),1:"")
"RTN","FHDCR1B",81,0)
 I SC=$P(SRP,"^",2),NUM S:'$F(P4,"~"_SP_"~") P4=P4_SP_"~"
"RTN","FHDCR1B",82,0)
 S FHX3=$P(FHX2,";",3),SC=$S(FHX3'="":$E(FHX3,1),1:""),NUM=$S(SC'="":$P(FHX3,SC,2),1:"")
"RTN","FHDCR1B",83,0)
 I SC=$P(SRP,"^",2),NUM S:'$F(P4,"~"_SP_"~") P4=P4_SP_"~"
"RTN","FHDCR1B",84,0)
 Q
"RTN","FHDCR1B",85,0)
BRK ; Break the line if allergies' length >50 chars
"RTN","FHDCR1B",86,0)
 I J>2 S S(NBR)=S(NBR)+1,^TMP($J,"MP",S(NBR),NBR)=$S($L(ALG)<51:ALG,1:$J("",8)_"OTHERS") Q
"RTN","FHDCR1B",87,0)
 I $L(ALG)<51 S S(NBR)=S(NBR)+1,J=J+1,^TMP($J,"MP",S(NBR),NBR)=ALG Q
"RTN","FHDCR1B",88,0)
 F L=52:-1:8 Q:$E(ALG,L-1,L)=", "
"RTN","FHDCR1B",89,0)
 I L=8 S L=50 S S(NBR)=S(NBR)+1,J=J+1,^TMP($J,"MP",S(NBR),NBR)=$E(ALG,1,50)
"RTN","FHDCR1B",90,0)
 E  S S(NBR)=S(NBR)+1,J=J+1,^TMP($J,"MP",S(NBR),NBR)=$E(ALG,1,L-1)
"RTN","FHDCR1B",91,0)
 S ALG=$J("",8)_$E(ALG,L+1,999)
"RTN","FHDCR1B",92,0)
 G BRK
"RTN","FHDCR1D")
0^10^B41347253
"RTN","FHDCR1D",1,0)
FHDCR1D ; HISC/REL/NCA/RVD - Build Separate Meal Diet Card ;2/23/00  09:52
"RTN","FHDCR1D",2,0)
 ;;5.5;DIETETICS;**3,5**;Jan 28, 2005;Build 53
"RTN","FHDCR1D",3,0)
 ;RVD 8/10/05 added logic on Food Preferences for Bread/Beverages default for outpatient.
"RTN","FHDCR1D",4,0)
 ;patch #5 - added outpatient SO and fix diet pattern for outpatient.
"RTN","FHDCR1D",5,0)
BLD ; Build Diet Card list for a patient in three per page format
"RTN","FHDCR1D",6,0)
 S X1=$G(^FHPT(+FHDFN,"A",+ADM,0)),FHORD=$P(X1,"^",2),SVC=$P(X1,"^",5),SF=$P(X1,"^",7),IS=$P(X1,"^",10),FHD=$P(X1,"^",16),(FHOR,X)=""
"RTN","FHDCR1D",7,0)
 I FHPAR'="Y" Q:SVC="C"
"RTN","FHDCR1D",8,0)
 I SVC="C" S:SP'=SP1 SP=SP1 Q:'SP
"RTN","FHDCR1D",9,0)
 Q:'FHORD  S X=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0))
"RTN","FHDCR1D",10,0)
 S PD=$P(X,"^",13),FHOR=$P(X,"^",2,6) Q:"^^^^"[FHOR
"RTN","FHDCR1D",11,0)
 I IS S IS=$G(^FH(119.4,+IS,0)) S:IS'="" SVC=SVC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHDCR1D",12,0)
 S:SF SVC=SVC_"  "_"SF"_"("_$S($P($G(^FHPT(FHDFN,"A",ADM,"SF",+SF,0)),"^",34)="Y":"M",1:"I")_")"
"RTN","FHDCR1D",13,0)
 I UPD D OLD^FHMTK11 I OLD=FHOR S FLG2=0 D EVT^FHDCR2 Q:'FLG2
"RTN","FHDCR1D",14,0)
 S STR=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,2))
"RTN","FHDCR1D",15,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHDCR1D",16,0)
 K FP,MP,N2,NN I $P(STR,";",$S(MEAL="B":1,MEAL="N":2,1:3))'="" D DECOD^FHDCR1B
"RTN","FHDCR1D",17,0)
 I DPAT S PD=$P($G(^FH(111.1,DPAT,0)),"^",7) D
"RTN","FHDCR1D",18,0)
 .I $P(STR,";",$S(MEAL="B":1,MEAL="N":2,1:3))="",$O(MP(MEAL,""))="" F X8=0:0 S X8=$O(^FH(111.1,DPAT,MEAL,X8)) Q:X8<1  S Z1=$G(^(X8,0)) D
"RTN","FHDCR1D",19,0)
 ..S ZZ=$G(^FH(114.1,+Z1,0)),NAM=$P(ZZ,"^",1)
"RTN","FHDCR1D",20,0)
 ..S K4=$P(ZZ,"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHDCR1D",21,0)
 ..S MP(MEAL,K4_"~"_+Z1_"~"_NAM)=$P(Z1,"^",2) Q
"RTN","FHDCR1D",22,0)
 .Q
"RTN","FHDCR1D",23,0)
 Q:PD=""  S PD=$P($G(^FH(116.2,PD,0)),"^",2) Q:PD=""  D CHK^FHMTK1B
"RTN","FHDCR1D",24,0)
 I NBR=3 D PRT^FHMTK1C K MM,PP,S S NBR=0
"RTN","FHDCR1D",25,0)
 S NBR=NBR+1 D PID^FHDPA
"RTN","FHDCR1D",26,0)
 F X6=0:0 S X6=$O(^FHPT(FHDFN,"P","B",X6)) Q:X6<1  F X7=0:0 S X7=$O(^FHPT(FHDFN,"P","B",X6,X7)) Q:X7<1  D
"RTN","FHDCR1D",27,0)
 .S PS=$P($G(^FH(115.2,+X6,0)),"^",4) I PS S P4=$G(^FH(114,+PS,0)),P1=$P(P4,"^",7)_"^"_+PS_"^"_$P(P4,"^",1) I +P1,$D(^TMP($J,"FHDEF",MEAL,+P1)) D
"RTN","FHDCR1D",28,0)
 ..S CHK="" F  S CHK=$O(^TMP($J,"DEF",MEAL,PD,CHK)) Q:CHK=""  S C1=$G(^(CHK)) I +CHK=+P1,$D(^TMP($J,"FHDEF",MEAL,+CHK,+C1)) D  Q
"RTN","FHDCR1D",29,0)
 ...S C2=$G(^FHPT(FHDFN,"P",+X7,0)) Q:$P(C2,"^",2)'[MEAL
"RTN","FHDCR1D",30,0)
 ...S P2=+P1,P3=$P(P1,"^",3) S:'$D(N2(P2,P3)) N2(P2,P3)=+$P(P1,"^",2)_"^"_P3 Q
"RTN","FHDCR1D",31,0)
 ..Q
"RTN","FHDCR1D",32,0)
 S LP="" F  S LP=$O(^TMP($J,"DEF",MEAL,PD,LP)) Q:LP=""  I '$D(N2(+LP)) D
"RTN","FHDCR1D",33,0)
 .S TST=$G(^TMP($J,"DEF",MEAL,PD,LP)),CHK="~"_$P(TST,"~",4,$L(TST,"~")) Q:'$F(CHK,"~"_SP_"~")
"RTN","FHDCR1D",34,0)
 .I '$D(FP(+TST)) S N2(+LP,$P(LP,"~",2))=+TST_"^"_$P(LP,"~",2) Q
"RTN","FHDCR1D",35,0)
 .Q:FLG
"RTN","FHDCR1D",36,0)
 .F X6=0:0 S X6=$O(^FHPT(FHDFN,"P","B",X6)) Q:X6<1  F X7=0:0 S X7=$O(^FHPT(FHDFN,"P","B",X6,X7)) Q:X7<1  D
"RTN","FHDCR1D",37,0)
 ..S PS=$P($G(^FH(115.2,+X6,0)),"^",4) I +PS S P4=$G(^FH(114,+PS,0)),P1=$P(P4,"^",7)_"^"_+PS_"^"_$P(P4,"^",1) I +P1,+P1=+LP D
"RTN","FHDCR1D",38,0)
 ...S C2=$G(^FHPT(FHDFN,"P",+X7,0)) Q:$P(C2,"^",2)'[MEAL
"RTN","FHDCR1D",39,0)
 ...S P2=+P1,P3=$P(P1,"^",3) S:'$D(N2(P2,P3)) N2(P2,P3)=+$P(P1,"^",2)_"^"_P3 Q
"RTN","FHDCR1D",40,0)
 ..Q
"RTN","FHDCR1D",41,0)
 S Y0=$P($G(^DPT(DFN,0)),"^",1)_" ("_BID_")"_"  "_SVC,S(NBR)=0,N1=0
"RTN","FHDCR1D",42,0)
 D CUR^FHORD7 S N1=N1+1 I $L(Y)<40 S PP(N1,NBR)=Y
"RTN","FHDCR1D",43,0)
 E  S L=$S($L($P(Y,",",1,3))<40:3,1:2) S PP(N1,NBR)=$P(Y,",",1,L),N1=N1+1,PP(N1,NBR)=$E($P(Y,",",L+1,5),2,99)
"RTN","FHDCR1D",44,0)
 S MM(0,NBR)=Y0_"^"_WRDN_"^"_RM
"RTN","FHDCR1D",45,0)
 I $G(DFN) D ALG^FHCLN S ALG="ALLGS.: "_$S(ALG="":"NONE ON FILE",1:ALG) S J=0 D BRK^FHMTK1B
"RTN","FHDCR1D",46,0)
 S X8="" F  S X8=$O(MP(MEAL,X8)) Q:X8=""  S X1=+MP(MEAL,X8) D
"RTN","FHDCR1D",47,0)
 .S Z1=+$P(X8,"~",2),QTY="" Q:'X1  S QTY=$S(+X1#1>0:$J(+X1,3,1),1:+X1_"  ")_" "
"RTN","FHDCR1D",48,0)
 .S Z1=+$P(X8,"~",2),QTY="" Q:'X1  S PAD=$E("    ",1,5-$L(X1)),QTY=+X1_PAD
"RTN","FHDCR1D",49,0)
 .I $D(N2(Z1)) D  Q
"RTN","FHDCR1D",50,0)
 ..S X7="" F  S X7=$O(N2(Z1,X7)) Q:X7=""  S C1=$P(X8,"~",1,2)_"~"_X7 I '$D(NN(C1)) S NN(C1)=QTY_X7
"RTN","FHDCR1D",51,0)
 ..Q
"RTN","FHDCR1D",52,0)
 .S NN(X8)=QTY_$P(X8,"~",3)
"RTN","FHDCR1D",53,0)
 .Q
"RTN","FHDCR1D",54,0)
 S X8="" F  S X8=$O(NN(X8)) Q:X8=""  D
"RTN","FHDCR1D",55,0)
 .S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$G(NN(X8)) Q
"RTN","FHDCR1D",56,0)
 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=""
"RTN","FHDCR1D",57,0)
 D SO^FHMTK1B
"RTN","FHDCR1D",58,0)
 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=""
"RTN","FHDCR1D",59,0)
 D DISL
"RTN","FHDCR1D",60,0)
 Q
"RTN","FHDCR1D",61,0)
 ;
"RTN","FHDCR1D",62,0)
OUT ;process outpatient data
"RTN","FHDCR1D",63,0)
 S (SVC,SF,IS)=""
"RTN","FHDCR1D",64,0)
 I '$D(FHKDAT)!'$G(FHADM) Q
"RTN","FHDCR1D",65,0)
 S X1=FHKDAT
"RTN","FHDCR1D",66,0)
 S FHWARD=W1 D LOC^FHDCR11
"RTN","FHDCR1D",67,0)
 S (FHOR,FHORD)=$P(FHKDAT,U,2),FHD=$P(X1,"^",14)
"RTN","FHDCR1D",68,0)
 I FHPAR'="Y" Q:SVC="C"
"RTN","FHDCR1D",69,0)
 I SVC="C" S:SP'=SP1 SP=SP1 Q:'SP
"RTN","FHDCR1D",70,0)
 S:$D(^FHPT(FHDFN,0)) IS=$P(^FHPT(FHDFN,0),U,5)
"RTN","FHDCR1D",71,0)
 I $D(^FHPT(FHDFN,"OP",FHADM,"SF",0)) S SF=$P(^(0),U,3)
"RTN","FHDCR1D",72,0)
 I IS S IS=$G(^FH(119.4,+IS,0)) S:IS'="" SVC=SVC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHDCR1D",73,0)
 I SF,$D(^FHPT(FHDFN,"OP",FHADM,"SF",SF,0)),'$P(^(0),U,32) S SVC=SVC_"  "_"SF"_"("_$S($P($G(^FHPT(FHDFN,"OP",FHADM,"SF",+SF,0)),"^",34)="Y":"M",1:"I")_")"
"RTN","FHDCR1D",74,0)
 S MEAL=FHMEAL
"RTN","FHDCR1D",75,0)
 I UPD D OLD^FHMTK11 I OLD=FHOR S FLG2=0 D EVT^FHDCR2 Q:'FLG2
"RTN","FHDCR1D",76,0)
 S STR=""
"RTN","FHDCR1D",77,0)
 S:$G(FHOR) FHOR=FHOR_"^^^^"
"RTN","FHDCR1D",78,0)
 I FHOR="" S FHOR=$P(FHKDAT,U,7,11)
"RTN","FHDCR1D",79,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHDCR1D",80,0)
 K FP,MP,N2,NN
"RTN","FHDCR1D",81,0)
 S PD=""
"RTN","FHDCR1D",82,0)
 S:$G(MPD) PD=MPD
"RTN","FHDCR1D",83,0)
 I DPAT S PD=$P($G(^FH(111.1,DPAT,0)),"^",7) D
"RTN","FHDCR1D",84,0)
 .F X8=0:0 S X8=$O(^FH(111.1,DPAT,MEAL,X8)) Q:X8<1  S Z1=$G(^(X8,0)) D
"RTN","FHDCR1D",85,0)
 ..S ZZ=$G(^FH(114.1,+Z1,0)),NAM=$P(ZZ,"^",1)
"RTN","FHDCR1D",86,0)
 ..S K4=$P(ZZ,"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHDCR1D",87,0)
 ..S MP(MEAL,K4_"~"_+Z1_"~"_NAM)=$P(Z1,"^",2) Q
"RTN","FHDCR1D",88,0)
 Q:PD=""  S PD=$P($G(^FH(116.2,PD,0)),"^",2) Q:PD=""  D CHK^FHMTK1B
"RTN","FHDCR1D",89,0)
 ;
"RTN","FHDCR1D",90,0)
 I NBR=3 D PRT^FHMTK1C K MM,PP,S S NBR=0
"RTN","FHDCR1D",91,0)
 S NBR=NBR+1 D PATNAME^FHOMUTL
"RTN","FHDCR1D",92,0)
 ;
"RTN","FHDCR1D",93,0)
 F X6=0:0 S X6=$O(^FHPT(FHDFN,"P","B",X6)) Q:X6<1  F X7=0:0 S X7=$O(^FHPT(FHDFN,"P","B",X6,X7)) Q:X7<1  D
"RTN","FHDCR1D",94,0)
 .S PS=$P($G(^FH(115.2,+X6,0)),"^",4) I PS S P4=$G(^FH(114,+PS,0)),P1=$P(P4,"^",7)_"^"_+PS_"^"_$P(P4,"^",1) I +P1,$D(^TMP($J,"FHDEF",MEAL,+P1)) D
"RTN","FHDCR1D",95,0)
 ..S CHK="" F  S CHK=$O(^TMP($J,"DEF",MEAL,PD,CHK)) Q:CHK=""  S C1=$G(^(CHK)) I +CHK=+P1,$D(^TMP($J,"FHDEF",MEAL,+CHK,+C1)) D  Q
"RTN","FHDCR1D",96,0)
 ...S C2=$G(^FHPT(FHDFN,"P",+X7,0)) Q:$P(C2,"^",2)'[MEAL
"RTN","FHDCR1D",97,0)
 ...S P2=+P1,P3=$P(P1,"^",3) S:'$D(N2(P2,P3)) N2(P2,P3)=+$P(P1,"^",2)_"^"_P3 Q
"RTN","FHDCR1D",98,0)
 ..Q
"RTN","FHDCR1D",99,0)
 S LP="" F  S LP=$O(^TMP($J,"DEF",MEAL,PD,LP)) Q:LP=""  I '$D(N2(+LP)) D
"RTN","FHDCR1D",100,0)
 .S TST=$G(^TMP($J,"DEF",MEAL,PD,LP)),CHK="~"_$P(TST,"~",4,$L(TST,"~")) Q:'$F(CHK,"~"_SP_"~")
"RTN","FHDCR1D",101,0)
 .I '$D(FP(+TST)) S N2(+LP,$P(LP,"~",2))=+TST_"^"_$P(LP,"~",2) Q
"RTN","FHDCR1D",102,0)
 .Q:FLG
"RTN","FHDCR1D",103,0)
 .F X6=0:0 S X6=$O(^FHPT(FHDFN,"P","B",X6)) Q:X6<1  F X7=0:0 S X7=$O(^FHPT(FHDFN,"P","B",X6,X7)) Q:X7<1  D
"RTN","FHDCR1D",104,0)
 ..S PS=$P($G(^FH(115.2,+X6,0)),"^",4) I +PS S P4=$G(^FH(114,+PS,0)),P1=$P(P4,"^",7)_"^"_+PS_"^"_$P(P4,"^",1) I +P1,+P1=+LP D
"RTN","FHDCR1D",105,0)
 ...S C2=$G(^FHPT(FHDFN,"P",+X7,0)) Q:$P(C2,"^",2)'[MEAL
"RTN","FHDCR1D",106,0)
 ...S P2=+P1,P3=$P(P1,"^",3) S:'$D(N2(P2,P3)) N2(P2,P3)=+$P(P1,"^",2)_"^"_P3 Q
"RTN","FHDCR1D",107,0)
 ..Q
"RTN","FHDCR1D",108,0)
 ;
"RTN","FHDCR1D",109,0)
 S Y0=FHPTNM_" ("_FHBID_")"_"  "_SVC,S(NBR)=0,N1=0,Y="***"
"RTN","FHDCR1D",110,0)
 I '$G(FHDIET) S FHRNUM=FHKD D DIETPAT^FHOMRR1 S Y=$E(FHDIETP,1,18)
"RTN","FHDCR1D",111,0)
 S:$G(FHDIET) Y=$P(^FH(111,FHDIET,0),U,7)
"RTN","FHDCR1D",112,0)
 S N1=N1+1 I $L(Y)<40 S PP(N1,NBR)=Y
"RTN","FHDCR1D",113,0)
 E  S L=$S($L($P(Y,",",1,3))<40:3,1:2) S PP(N1,NBR)=$P(Y,",",1,L),N1=N1+1,PP(N1,NBR)=$E($P(Y,",",L+1,5),2,99)
"RTN","FHDCR1D",114,0)
 S MM(0,NBR)=Y0_"^"_WRDN_"^"_RM_"^^^^"_FHMEAL
"RTN","FHDCR1D",115,0)
 I $G(DFN) D ALG^FHCLN S ALG="ALLGS.: "_$S(ALG="":"NONE ON FILE",1:ALG) S J=0 D BRK^FHMTK1B
"RTN","FHDCR1D",116,0)
 ;
"RTN","FHDCR1D",117,0)
 S X8="" F  S X8=$O(MP(MEAL,X8)) Q:X8=""  S X1=+MP(MEAL,X8) D
"RTN","FHDCR1D",118,0)
 .S Z1=+$P(X8,"~",2),QTY="" Q:'X1  S QTY=$S(+X1#1>0:$J(+X1,3,1),1:+X1_"  ")_" "
"RTN","FHDCR1D",119,0)
 .S Z1=+$P(X8,"~",2),QTY="" Q:'X1  S PAD=$E("    ",1,5-$L(X1)),QTY=+X1_PAD
"RTN","FHDCR1D",120,0)
 .I $D(N2(Z1)) D  Q
"RTN","FHDCR1D",121,0)
 ..S X7="" F  S X7=$O(N2(Z1,X7)) Q:X7=""  S C1=$P(X8,"~",1,2)_"~"_X7 I '$D(NN(C1)) S NN(C1)=QTY_X7
"RTN","FHDCR1D",122,0)
 ..Q
"RTN","FHDCR1D",123,0)
 .S NN(X8)=QTY_$P(X8,"~",3)
"RTN","FHDCR1D",124,0)
 .Q
"RTN","FHDCR1D",125,0)
 S X8="" F  S X8=$O(NN(X8)) Q:X8=""  D
"RTN","FHDCR1D",126,0)
 .S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$G(NN(X8)) Q
"RTN","FHDCR1D",127,0)
 I $G(FHKD) S ADM=FHKD D SOUT^FHMTK1B   ;get outpatient standing orders.
"RTN","FHDCR1D",128,0)
 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=""
"RTN","FHDCR1D",129,0)
 D DISL
"RTN","FHDCR1D",130,0)
 Q
"RTN","FHDCR1D",131,0)
 ;
"RTN","FHDCR1D",132,0)
DISL ; Store patient dislikes
"RTN","FHDCR1D",133,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",MEAL,LL)) Q:LL<1  D DL1
"RTN","FHDCR1D",134,0)
 Q
"RTN","FHDCR1D",135,0)
DL1 S X6=$O(^FHPT(FHDFN,"P","B",LL,0)) Q:X6<1
"RTN","FHDCR1D",136,0)
 S X2=$G(^FHPT(FHDFN,"P",X6,0)) Q:$P(X2,"^",2)'[MEAL
"RTN","FHDCR1D",137,0)
 S S(NBR)=S(NBR)+1
"RTN","FHDCR1D",138,0)
 S MM(S(NBR),NBR)="    "_$E($P($G(^FH(115.2,+X2,0)),"^",1),1,25)
"RTN","FHDCR1D",139,0)
 Q
"RTN","FHMTK1")
0^52^B16147899
"RTN","FHMTK1",1,0)
FHMTK1 ; HISC/REL/NCA - Tray Tickets ;4/20/95  15:28
"RTN","FHMTK1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHMTK1",3,0)
F0 ;
"RTN","FHMTK1",4,0)
 K FHOMF,DFN,IEN200 S FHBY="",FHTTDFN=0
"RTN","FHMTK1",5,0)
 K DIR S DIR(0)="SBAO^P:Patient;C:Communication Office;L:Location;A:All"
"RTN","FHMTK1",6,0)
 S DIR("B")="COMM"
"RTN","FHMTK1",7,0)
 S DIR("A")="Print by PATIENT, COMMUNICATION OFFICE, LOCATION or ALL? "
"RTN","FHMTK1",8,0)
 D ^DIR I $D(DIRUT) D KIL Q
"RTN","FHMTK1",9,0)
 S FHBY=Y
"RTN","FHMTK1",10,0)
 I FHBY="P" D P0 Q
"RTN","FHMTK1",11,0)
 I FHBY="C" D C0 Q
"RTN","FHMTK1",12,0)
 I FHBY="L" D NL0 Q
"RTN","FHMTK1",13,0)
 I FHBY="A" S (DFN,FHP,W1)="" D S0 Q
"RTN","FHMTK1",14,0)
 Q
"RTN","FHMTK1",15,0)
C0 ; Sort by Communication Office
"RTN","FHMTK1",16,0)
 S FHP=$O(^FH(119.73,0))
"RTN","FHMTK1",17,0)
 I FHP'<1,$O(^FH(119.73,FHP))<1 S (DFN,W1)="" G S0
"RTN","FHMTK1",18,0)
 K DIC S DIC="^FH(119.73,",DIC("A")="Select COMMUNICATION OFFICE: "
"RTN","FHMTK1",19,0)
 S DIC(0)="AEQM" W ! D ^DIC K DIC
"RTN","FHMTK1",20,0)
 G KIL:"^"[X!$D(DTOUT),C0:Y<1 S FHP=+Y,(DFN,W1)="" G S0
"RTN","FHMTK1",21,0)
NL0 ; Sort by Location
"RTN","FHMTK1",22,0)
 K DIC S DIC="^FH(119.6,",DIC("A")="Select NUTRITION LOCATION: "
"RTN","FHMTK1",23,0)
 S DIC(0)="AEQM" W ! D ^DIC K DIC
"RTN","FHMTK1",24,0)
 G KIL:"^"[X!$D(DTOUT),NL0:Y<1 S W1=+Y,(DFN,FHP)="" G S0
"RTN","FHMTK1",25,0)
P0 ; Single patient
"RTN","FHMTK1",26,0)
 S FHALL=1 D ^FHOMDPA S FHTTDFN=FHDFN I 'FHDFN D KIL Q
"RTN","FHMTK1",27,0)
 I 'DFN D P1 Q
"RTN","FHMTK1",28,0)
 I $G(^DPT(DFN,.1))="" D P1 Q
"RTN","FHMTK1",29,0)
 S (FHP,W1)="",SRT="R" G F1
"RTN","FHMTK1",30,0)
 I $P($G(^DPT(DFN,.35)),"^",1) W !!?5,"  [ Patient has expired. ]" G KIL
"RTN","FHMTK1",31,0)
S0 ; Start
"RTN","FHMTK1",32,0)
 I $G(TABREC)="YES" S SRT="A" G F1
"RTN","FHMTK1",33,0)
 R !!,"Sort Patients: (A=Alphabetically  R=Room-Bed) R// ",SRT:DTIME G:'$T!(SRT["^") KIL S:SRT="" SRT="R" I "ar"[SRT S X=SRT D TR^FH S SRT=X
"RTN","FHMTK1",34,0)
 I SRT'?1U!("AR"'[SRT) W *7," Enter A or R" G S0
"RTN","FHMTK1",35,0)
F1 S %DT("A")="Select Date: ",%DT="AEFX",%DT("B")="TODAY",%DT(0)=DT W ! D ^%DT G KIL:"^"[X!$D(DTOUT),F1:Y<1 S (X1,D1)=+Y
"RTN","FHMTK1",36,0)
 D E1^FHPRC1 I FHCY<1 W *7,!!,"No MENU CYCLE Defined for that Date!" G F1
"RTN","FHMTK1",37,0)
 I '$D(^FH(116,FHCY,"DA",FHDA,0)) W *7,!!,"MENU CYCLE DAY Not Defined for that Date!" G F1
"RTN","FHMTK1",38,0)
R1 R !!,"Select MEAL (B,N,E,or ALL): ",MEAL:DTIME G:'$T!("^"[MEAL) KIL S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHMTK1",39,0)
 I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Select B for Breakfast, N for Noon, or E for Evening or ALL for all meals" G R1
"RTN","FHMTK1",40,0)
 S FHOMEAL=MEAL,FHDA=^FH(116,FHCY,"DA",FHDA,0)
"RTN","FHMTK1",41,0)
 I $D(^FH(116.3,D1,0)) S X=^(0) F LL=2:1:4 I $P(X,"^",LL) S $P(FHDA,"^",LL)=$P(X,"^",LL)
"RTN","FHMTK1",42,0)
 I MEAL="A" F LP="B","N","E" S FHX1=$P(FHDA,"^",$F("BNE",LP)) I 'FHX1 W *7,!!,"*** NO MENU DEFINED FOR ",$S(LP="B":"BREAKFAST",LP="N":"NOON",1:"EVENING")," ***" G KIL
"RTN","FHMTK1",43,0)
 S (SUM,UPD)=0 G:MEAL="A" D5
"RTN","FHMTK1",44,0)
 S FHX1=$P(FHDA,"^",$F("BNE",MEAL)) I 'FHX1 W *7,!!,"*** NO MENU DEFINED FOR THIS MEAL ***" G KIL
"RTN","FHMTK1",45,0)
 ;I $G(IEN200)'="",$G(FHOMF)=1 Q
"RTN","FHMTK1",46,0)
 G L0:DFN,R2
"RTN","FHMTK1",47,0)
D5 G:DFN!($G(IEN200)'="") L0 R !!,"Consolidated List? Y// ",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G D5
"RTN","FHMTK1",48,0)
 S SUM=X?1"Y".E
"RTN","FHMTK1",49,0)
R2 I $G(TABREC)="YES" G L0
"RTN","FHMTK1",50,0)
 R !!,"Print Only Ones With Order Changes related to the Tray Ticket? N // ",X:DTIME G:'$T!(X="^") KIL S:X="" X="N" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,!,"  Answer YES or NO" G R2
"RTN","FHMTK1",51,0)
 S UPD=X?1"Y".E
"RTN","FHMTK1",52,0)
L0 ;I $G(FHOMF)=1 Q
"RTN","FHMTK1",53,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHMTK1",54,0)
 I $D(IO("Q")) S FHPGM="B1^FHMTK1A",FHLST="D1^MEAL^IEN200^FHOMEAL^FHOMF^FHBY^FHDFN^FHTTDFN^FHX1^FHP^W1^DFN^FHDA^SUM^UPD^SRT^TABREC" D EN2^FH G KIL
"RTN","FHMTK1",55,0)
 U IO D B1^FHMTK1A D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHMTK1",56,0)
KIL K ^TMP($J),TABREC G KILL^XUSCLEAN
"RTN","FHMTK1",57,0)
 ;
"RTN","FHMTK1",58,0)
TABREC ; Entry point for separate Print Tab Recipes option
"RTN","FHMTK1",59,0)
 S TABREC="YES" D F0
"RTN","FHMTK1",60,0)
 K TABREC Q
"RTN","FHMTK1",61,0)
P1 ; Tray tickets for single outpatient
"RTN","FHMTK1",62,0)
 S (FHP,W1)="",SRT="R",FHOMF=1,NBR=0,MFLG=0
"RTN","FHMTK1",63,0)
 S FHBOT=$P($G(^FH(119.9,1,4)),"^",1) D F1
"RTN","FHMTK1",64,0)
 S LN=$S(IOST?1"C".E:IOSL-2,1:IOSL-6),SL=40
"RTN","FHMTK1",65,0)
 I '$D(MEAL) Q
"RTN","FHMTK1",66,0)
 I MEAL="A" S MFLG=1
"RTN","FHMTK1",67,0)
 D ^FHOMTK1 Q
"RTN","FHMTK1",68,0)
 Q
"RTN","FHMTK1A")
0^50^B8475642
"RTN","FHMTK1A",1,0)
FHMTK1A ; HISC/REL/NCA - Build Tray Tickets ;4/21/95  08:21
"RTN","FHMTK1A",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHMTK1A",3,0)
B1 ; Store wards
"RTN","FHMTK1A",4,0)
 K ^TMP($J),DP,N,P,TP,T1 S ALL=0,MFLG=0 D Q1^FHMTK1B D NOW^%DTC S (DTP,TIM)=% D DTP^FH S HD=DTP
"RTN","FHMTK1A",5,0)
 S DTP=D1 D DTP^FH S MDT=DTP S:MEAL="A" MFLG=1
"RTN","FHMTK1A",6,0)
 I 'FHP,'W1,'DFN S ALL=1
"RTN","FHMTK1A",7,0)
 S FHBOT=$P($G(^FH(119.9,1,4)),"^",1)
"RTN","FHMTK1A",8,0)
 I $G(FHOMF)=1 D ^FHOMTK1 Q
"RTN","FHMTK1A",9,0)
 I DFN D  Q
"RTN","FHMTK1A",10,0)
 .S ADM=+$G(^DPT(DFN,.105)),W1=+$P($G(^FHPT(FHDFN,"A",+ADM,0)),"^",8)
"RTN","FHMTK1A",11,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24),RM=$G(^DPT(DFN,.101))
"RTN","FHMTK1A",12,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHMTK1A",13,0)
 .K MM,PP,S S NBR=0 I MEAL'="A" D BLD^FHMTK11 D:NBR UPD,PRT^FHMTK1C Q
"RTN","FHMTK1A",14,0)
 .F MEAL="B","N","E" D BLD^FHMTK11
"RTN","FHMTK1A",15,0)
 .D UPD
"RTN","FHMTK1A",16,0)
 .D:NBR PRT^FHMTK1C Q
"RTN","FHMTK1A",17,0)
 I W1 S ^TMP($J,"W","01"_$P($G(^FH(119.6,+W1,0)),"^",1))=W1_"^"_$P($G(^FH(119.6,+W1,0)),"^",5,6)_"^"_$P($G(^FH(119.6,+W1,0)),"^",24)
"RTN","FHMTK1A",18,0)
 E  F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D
"RTN","FHMTK1A",19,0)
 .S P0=$G(^FH(119.6,W1,0)),WRDN=$P(P0,"^",1),SP=$P(P0,"^",5,6),D2=$P(P0,"^",8),FHPAR=$P(P0,"^",24),P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHMTK1A",20,0)
 .I FHP,D2'=FHP Q
"RTN","FHMTK1A",21,0)
 .S ^TMP($J,"W",P0_WRDN)=W1_"^"_SP_"^"_FHPAR Q
"RTN","FHMTK1A",22,0)
 S NX="" F  S NX=$O(^TMP($J,"W",NX)) Q:NX=""  S X1=$G(^(NX)),W1=+X1,FHS=$P(X1,"^",2),SP1=$P(X1,"^",3),FHPAR=$P(X1,"^",4),WRDN=$E(NX,3,99) S:'FHS&(FHPAR="Y") FHS=SP1 I FHS K ^TMP($J,"D") D
"RTN","FHMTK1A",23,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHMTK1A",24,0)
 ..D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHMTK1A",25,0)
 ..S ADM=$G(^FHPT("AW",W1,FHDFN))
"RTN","FHMTK1A",26,0)
 ..I SRT="A" S RM=$P($G(^DPT(DFN,0)),"^",1),R0=0,RMB=$G(^DPT(DFN,.101)) S:RMB="" RMB="***"
"RTN","FHMTK1A",27,0)
 ..E  S RI=$G(^DPT(DFN,.108)),RM=$G(^DPT(DFN,.101)) S:RM="" RM="***" S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:""),R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:""),RMB=""
"RTN","FHMTK1A",28,0)
 ..S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHMTK1A",29,0)
 ..S ^TMP($J,"D",R0_"~"_RM_"~"_$S(SRT="R":FHDFN,1:RMB))=FHDFN_"^"_ADM Q
"RTN","FHMTK1A",30,0)
 .K MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHDFN=$P(^(X9),"^",1),ADM=$P(^(X9),"^",2),RM=$S(SRT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS D
"RTN","FHMTK1A",31,0)
 ..D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHMTK1A",32,0)
 ..I 'MFLG D BLD^FHMTK11,UPD Q
"RTN","FHMTK1A",33,0)
 ..F MEAL="B","N","E" D BLD^FHMTK11
"RTN","FHMTK1A",34,0)
 ..D UPD
"RTN","FHMTK1A",35,0)
 ..Q
"RTN","FHMTK1A",36,0)
 .I NBR D PRT^FHMTK1C
"RTN","FHMTK1A",37,0)
 .Q
"RTN","FHMTK1A",38,0)
OMTT ;Display outpatient tray tickets
"RTN","FHMTK1A",39,0)
 K MM,PP,S D ^FHOMTK1
"RTN","FHMTK1A",40,0)
TAB ;Display tabulated recipe list
"RTN","FHMTK1A",41,0)
 D LIST^FHMTK1C
"RTN","FHMTK1A",42,0)
 Q
"RTN","FHMTK1A",43,0)
UPD ; Update the Date/Time Tray Ticket was Printed
"RTN","FHMTK1A",44,0)
 I $G(TABREC)="YES" QUIT
"RTN","FHMTK1A",45,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",15)=TIM Q
"RTN","FHMTK1B")
0^11^B25025382
"RTN","FHMTK1B",1,0)
FHMTK1B ; HISC/NCA - Tray Ticket Utilities ;2/23/00  09:53
"RTN","FHMTK1B",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHMTK1B",3,0)
 ;patch #5 - added outpatient SO.
"RTN","FHMTK1B",4,0)
Q1 ; Store Service Point, Bread/Beverage default, Food Preference,
"RTN","FHMTK1B",5,0)
 ; and Recipes of meal
"RTN","FHMTK1B",6,0)
 S LN=$S(IOST?1"C".E:IOSL-2,1:IOSL-6),SL=40 F SP=0:0 S SP=$O(^FH(119.72,SP)) Q:SP<1  S Z=$G(^(SP,0)),^TMP($J,"SRP",SP)=$P(Z,"^",1,4)
"RTN","FHMTK1B",7,0)
 I MEAL'="A" S M1=MEAL D GET Q
"RTN","FHMTK1B",8,0)
 F M1="B","N","E" S FHX1=$P(FHDA,"^",$F("BNE",M1)) D GET
"RTN","FHMTK1B",9,0)
 Q
"RTN","FHMTK1B",10,0)
GET S LS(M1)=40 F LL=0:0 S LL=$O(^FH(115.2,LL)) Q:LL<1  S L2=$G(^(LL,0)) D
"RTN","FHMTK1B",11,0)
 .I $P(L2,"^",2)="D" D  Q
"RTN","FHMTK1B",12,0)
 ..F KK=0:0 S KK=$O(^FH(115.2,LL,"X",KK)) Q:KK<1  S REC=$P($G(^(KK,0)),"^",1),^TMP($J,"X",M1,LL,KK)=+REC
"RTN","FHMTK1B",13,0)
 ..Q
"RTN","FHMTK1B",14,0)
 .S REC=$P(L2,"^",4) Q:'REC  S Y=$G(^FH(114,+REC,0)),NAM=$P(Y,"^",1),K3=$P(Y,"^",7) I $P(L2,"^",5),$P(L2,"^",6)[M1 D
"RTN","FHMTK1B",15,0)
 ..S:'$D(^TMP($J,"FHDEF",M1,+REC)) ^TMP($J,"FHDEF",M1,+REC)=K3_"^"_+REC_"^"_NAM
"RTN","FHMTK1B",16,0)
 ..Q
"RTN","FHMTK1B",17,0)
 .Q
"RTN","FHMTK1B",18,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",M1,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",M1,LL,KK)) Q:KK<1  S X1=+$G(^(KK)),X2=$O(^FH(116.1,FHX1,"RE","B",X1,0)) I X2<1 K ^TMP($J,"X",M1,LL,KK)
"RTN","FHMTK1B",19,0)
 F P1=0:0 S P1=$O(^FH(116.1,FHX1,"RE",P1)) Q:P1<1  S L1=$G(^(P1,0)),Y=$G(^FH(114,+L1,0)),NAM=$P(Y,"^",1) D
"RTN","FHMTK1B",20,0)
 .F CAT=0:0 S CAT=$O(^FH(116.1,FHX1,"RE",P1,"R",CAT)) Q:CAT<1  S MCA=$G(^(CAT,0)) D
"RTN","FHMTK1B",21,0)
 ..S FHPD=$P(MCA,"^",2),K3=+MCA S:'K3 K3=$P(Y,"^",7)
"RTN","FHMTK1B",22,0)
 ..S CODE=$P($G(^FH(114.1,+K3,0)),"^",2),ZZ1=CODE
"RTN","FHMTK1B",23,0)
 ..I $E(CODE,$L(CODE))="X" S K3=$O(^FH(114.1,"C",$E(CODE,1,$L(CODE)-1),0)) S:'K3 K3=$P(Y,"^",7)
"RTN","FHMTK1B",24,0)
 ..S K4=$P($G(^FH(114.1,+K3,0)),"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHMTK1B",25,0)
 ..F P2=1:1 S FHX2=$P(FHPD," ",P2) Q:FHX2=""  S PD=$P(FHX2,";",1),P4="~" I PD'="" D
"RTN","FHMTK1B",26,0)
 ...F SP=0:0 S SP=$O(^TMP($J,"SRP",SP)) Q:SP<1  S SRP=$G(^TMP($J,"SRP",SP)),Z1=$G(^FH(116.1,FHX1,"RE",P1,"D",SP,0)),Z1=$P(Z1,"^",2),Z1=$S(Z1="":1,1:Z1) D SRP^FHDCR1B
"RTN","FHMTK1B",27,0)
 ...D STOR Q
"RTN","FHMTK1B",28,0)
 ..Q
"RTN","FHMTK1B",29,0)
 .Q
"RTN","FHMTK1B",30,0)
 Q
"RTN","FHMTK1B",31,0)
STOR ; Store Alternate recipes and default recipes
"RTN","FHMTK1B",32,0)
 N CODE S DBX="",CODE=ZZ1 I $E(CODE,$L(CODE))?1"X" D
"RTN","FHMTK1B",33,0)
 .S CODE=$E(CODE,1,$L(CODE)-1),DBX="*** Omit ",LC=0
"RTN","FHMTK1B",34,0)
 .F NX=0:0 S NX=$O(^FH(114,+L1,"DBX",NX)) Q:NX<1  S Z3=^(NX,0),QTY=$S($P(Z3,"^",2):$P(Z3,"^",2),1:1),ZZ=QTY_" "_$P($G(^FH(114.1,+Z3,0)),"^",1)_", " D:$L(DBX)+$L(ZZ)>28 SET S DBX=DBX_ZZ
"RTN","FHMTK1B",35,0)
 .D SET Q
"RTN","FHMTK1B",36,0)
 I $E(CODE,$L(CODE))?1N,$E(CODE,$L(CODE))>1 S ^TMP($J,"ALT",M1,PD,CODE,+L1)=K4_"~"_K3_"~"_NAM_P4
"RTN","FHMTK1B",37,0)
 S ^TMP($J,M1,PD,K4_"~"_K3_"~"_NAM)=+L1_"^"_CODE_"^"_P4
"RTN","FHMTK1B",38,0)
 S:'$D(^TMP($J,"FHPO",NAM)) ^TMP($J,"FHPO",NAM)=K4_"~"_K3_"~"_NAM
"RTN","FHMTK1B",39,0)
 I $D(^TMP($J,"FHDEF",M1,+L1)) S ^TMP($J,"DEF",M1,PD,K3_"~"_NAM)=+L1_"~"_K3_"~"_NAM Q
"RTN","FHMTK1B",40,0)
 Q
"RTN","FHMTK1B",41,0)
SET I $L(DBX)>9 S LC=LC+1,^TMP($J,"DBX",M1,PD,+L1,LC)=$E(DBX,1,$L(DBX)-2),DBX="*** Omit "
"RTN","FHMTK1B",42,0)
 Q
"RTN","FHMTK1B",43,0)
ALT ; Exchange dislike recipe with an alternate recipe
"RTN","FHMTK1B",44,0)
 S R1=$P($G(^TMP($J,MEAL,PD,X8)),"^",2),R2=R1 Q:R1=""
"RTN","FHMTK1B",45,0)
 F  S R2=$O(^TMP($J,"ALT",MEAL,PD,R2)) Q:R2=""!($E(R1,1,$L(R1)-1)'=$E(R2,1,$L(R2)-1))  D A1 Q:X6
"RTN","FHMTK1B",46,0)
 I 'X6 D
"RTN","FHMTK1B",47,0)
 .I $E(R1,1,$L(R1)-1)="E" S MSG="  ** NO ENTREE **",EVT="M^O^^No Entree" D ^FHORX Q
"RTN","FHMTK1B",48,0)
 .S MSG="  ** NO "_$P($G(^FH(114.1,Z1,0)),"^",1)_" - FP" Q
"RTN","FHMTK1B",49,0)
 Q
"RTN","FHMTK1B",50,0)
A1 S R3=0
"RTN","FHMTK1B",51,0)
A2 S R3=$O(^TMP($J,"ALT",MEAL,PD,R2,R3)) Q:R3<1
"RTN","FHMTK1B",52,0)
 S Z=$G(^TMP($J,"ALT",MEAL,PD,R2,R3)),P4="~"_$P(Z,"~",4,$L(Z,"~")) I $F(P4,"~"_SP_"~"),'$D(FP(R3)) S X6=R3 Q
"RTN","FHMTK1B",53,0)
 G A2
"RTN","FHMTK1B",54,0)
DECOD ; Decode code string
"RTN","FHMTK1B",55,0)
 S M1=$S(MEAL="B":1,MEAL="N":2,1:3),STR=$P(STR,";",M1)
"RTN","FHMTK1B",56,0)
 F X4=1:1 Q:$P(STR," ",X4,99)=""  D
"RTN","FHMTK1B",57,0)
 .S X1=$P(STR," ",X4),NAM=$P($G(^FH(114.1,+X1,0)),"^",1),$P(X1,",",2)=$S($P(X1,",",2)'="":$P(X1,",",2),1:1)
"RTN","FHMTK1B",58,0)
 .S MP(+X1)=$P(X1,",",2) Q
"RTN","FHMTK1B",59,0)
 Q
"RTN","FHMTK1B",60,0)
CHK ; Check for Patient dislike on meal
"RTN","FHMTK1B",61,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",MEAL,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",MEAL,LL,KK)) Q:KK<1  S X1=+$G(^TMP($J,"X",MEAL,LL,KK)) D
"RTN","FHMTK1B",62,0)
 .S X6=$O(^FHPT(FHDFN,"P","B",LL,0)) Q:X6<1
"RTN","FHMTK1B",63,0)
 .S X2=$G(^FHPT(FHDFN,"P",X6,0)) Q:$P(X2,"^",2)'[MEAL
"RTN","FHMTK1B",64,0)
 .S FP(X1)=""
"RTN","FHMTK1B",65,0)
 .Q
"RTN","FHMTK1B",66,0)
 Q
"RTN","FHMTK1B",67,0)
SO ; Store Standing Orders
"RTN","FHMTK1B",68,0)
 K ALPHA,SONAME S INDX=1 F K=0:0 S K=$O(^FHPT("ASP",FHDFN,ADM,K)) Q:K<1  D
"RTN","FHMTK1B",69,0)
 .S X=$G(^FHPT(FHDFN,"A",ADM,"SP",K,0)),Z=$P(X,"^",2)
"RTN","FHMTK1B",70,0)
 .S SONAME=$P($G(^FH(118.3,+Z,0)),U,1) I SONAME="" Q
"RTN","FHMTK1B",71,0)
 .I $D(ALPHA(SONAME)) S SONAME=SONAME_INDX,INDX=INDX+1
"RTN","FHMTK1B",72,0)
 .S ALPHA(SONAME)=K_"^"_Z
"RTN","FHMTK1B",73,0)
 .Q
"RTN","FHMTK1B",74,0)
 S SONAME="" F  S SONAME=$O(ALPHA(SONAME)) Q:SONAME=""  D
"RTN","FHMTK1B",75,0)
 .S K=$P(ALPHA(SONAME),U,1)
"RTN","FHMTK1B",76,0)
 .S X=$G(^FHPT(FHDFN,"A",ADM,"SP",K,0)),Z=$P(X,U,2),M=$P(X,U,3) Q:'Z
"RTN","FHMTK1B",77,0)
 .I M[MEAL S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$S($P(X,"^",8):$P(X,"^",8),1:1)_"    "_$P(^FH(118.3,+Z,0),"^",1) Q
"RTN","FHMTK1B",78,0)
 Q
"RTN","FHMTK1B",79,0)
 ;
"RTN","FHMTK1B",80,0)
SOUT ; Store Outpatient Standing Orders.
"RTN","FHMTK1B",81,0)
 Q:'$G(ADM)
"RTN","FHMTK1B",82,0)
 S FHOPDAT0=$G(^FHPT(FHDFN,"OP",ADM,0)) Q:$P(FHOPDAT0,U,15)="C"
"RTN","FHMTK1B",83,0)
 K ALPHA,SONAME S INDX=1 F K=0:0 S K=$O(^FHPT("ASPO",FHDFN,ADM,K)) Q:K<1  D
"RTN","FHMTK1B",84,0)
 .S X=$G(^FHPT(FHDFN,"OP",ADM,"SP",K,0)),Z=$P(X,"^",2)
"RTN","FHMTK1B",85,0)
 .S SONAME=$P($G(^FH(118.3,+Z,0)),U,1) I SONAME="" Q
"RTN","FHMTK1B",86,0)
 .I $D(ALPHA(SONAME)) S SONAME=SONAME_INDX,INDX=INDX+1
"RTN","FHMTK1B",87,0)
 .S ALPHA(SONAME)=K_"^"_Z
"RTN","FHMTK1B",88,0)
 .Q
"RTN","FHMTK1B",89,0)
 S SONAME="" F  S SONAME=$O(ALPHA(SONAME)) Q:SONAME=""  D
"RTN","FHMTK1B",90,0)
 .S K=$P(ALPHA(SONAME),U,1)
"RTN","FHMTK1B",91,0)
 .S X=$G(^FHPT(FHDFN,"OP",ADM,"SP",K,0)),Z=$P(X,U,2),M=$P(X,U,3) Q:'Z
"RTN","FHMTK1B",92,0)
 .I M[MEAL S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$S($P(X,"^",8):$P(X,"^",8),1:1)_"    "_$P(^FH(118.3,+Z,0),"^",1) Q
"RTN","FHMTK1B",93,0)
 Q
"RTN","FHMTK1B",94,0)
 ;
"RTN","FHMTK1B",95,0)
BRK ; Break the line if allergies' length > 35 chars
"RTN","FHMTK1B",96,0)
 I J>2 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$S($L(ALG)<36:ALG,1:$J("",8)_"OTHERS") Q
"RTN","FHMTK1B",97,0)
 I $L(ALG)<36 S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=ALG Q
"RTN","FHMTK1B",98,0)
 F L=37:-1:8 Q:$E(ALG,L-1,L)=", "
"RTN","FHMTK1B",99,0)
 I L=8 S L=35 S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=$E(ALG,1,35)
"RTN","FHMTK1B",100,0)
 E  S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=$E(ALG,1,L-1)
"RTN","FHMTK1B",101,0)
 S ALG=$J("",8)_$E(ALG,L+1,999)
"RTN","FHMTK1B",102,0)
 G BRK
"RTN","FHMTK7")
0^12^B81656381
"RTN","FHMTK7",1,0)
FHMTK7 ; HISC/NCA - Update Diet Restrictions ;12/6/00  15:14
"RTN","FHMTK7",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHMTK7",3,0)
 ; Update the Diet Restrictions For All Inpatients
"RTN","FHMTK7",4,0)
 ; 11/14/05 -P5- added standing order & SF for outpatients.
"RTN","FHMTK7",5,0)
 R !!,"Update All Diet Related Information for Patients? Y // ",X:DTIME Q:'$T!(X["^")
"RTN","FHMTK7",6,0)
 S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,!,"  Answer YES or NO" G FHMTK7
"RTN","FHMTK7",7,0)
 S ANS=X?1"Y".E Q:'ANS
"RTN","FHMTK7",8,0)
 F W1=0:0 S W1=$O(^FHPT("AW",W1)) Q:W1'>0  F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  S ADM=$G(^FHPT("AW",W1,FHDFN)) D:ADM PAT,STORD,SFMENU  ;P30
"RTN","FHMTK7",9,0)
 D SOO    ;update so for outpatient
"RTN","FHMTK7",10,0)
 D SFO    ;update sf for outpt.
"RTN","FHMTK7",11,0)
 Q
"RTN","FHMTK7",12,0)
STORD ;Update Standing orders for a patient, P30
"RTN","FHMTK7",13,0)
 D SO^FHMTK8
"RTN","FHMTK7",14,0)
 Q
"RTN","FHMTK7",15,0)
SFMENU ;Update SF Menu for a patient, P30
"RTN","FHMTK7",16,0)
 D SF^FHMTK8
"RTN","FHMTK7",17,0)
 Q
"RTN","FHMTK7",18,0)
PAT ; Update Restrictions for a patient
"RTN","FHMTK7",19,0)
 S FHORD=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",2) I FHORD<1 S DPAT="" G UPD
"RTN","FHMTK7",20,0)
 S Z=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)),FHOR=$P(Z,"^",2,6) I "^^^^"[FHOR S DPAT="" G UPD
"RTN","FHMTK7",21,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0)) G:DPAT="" UPD
"RTN","FHMTK7",22,0)
 Q:'$D(^TMP($J,+DPAT))
"RTN","FHMTK7",23,0)
 ;
"RTN","FHMTK7",24,0)
UPD ; Update Pattern
"RTN","FHMTK7",25,0)
 S (COM,PP)=""
"RTN","FHMTK7",26,0)
 F SP=0:0 S SP=$O(^FHPT(FHDFN,"P",SP)) Q:SP<1  S M2=$G(^(SP,0)) I $P(M2,"^",4)="Y" D
"RTN","FHMTK7",27,0)
 .S FP=+M2 I $D(^FH(111.1,+DPAT,"RES","B",FP)) Q
"RTN","FHMTK7",28,0)
 .D PURG Q
"RTN","FHMTK7",29,0)
 F R1=0:0 S R1=$O(^FH(111.1,+DPAT,"RES",R1)) Q:R1<1  S M2=$G(^(R1,0)),FP=+M2 I FP D
"RTN","FHMTK7",30,0)
 .S SP=$O(^FHPT(FHDFN,"P","B",FP,0)) I 'SP D ADD Q
"RTN","FHMTK7",31,0)
 .I $P($G(^FHPT(FHDFN,"P",SP,0)),"^",2)=$P(M2,"^",2) Q
"RTN","FHMTK7",32,0)
 .D CHG Q
"RTN","FHMTK7",33,0)
 G FIL
"RTN","FHMTK7",34,0)
CHG ; Change the Diet Restrictions
"RTN","FHMTK7",35,0)
 S MEAL=$P(M2,"^",2)
"RTN","FHMTK7",36,0)
 I $P($G(^FHPT(FHDFN,"P",SP,0)),"^",4)="Y" S M2=MEAL G CHG1 ;diet related
"RTN","FHMTK7",37,0)
 Q:MEAL=""
"RTN","FHMTK7",38,0)
 S M1=$P($G(^FHPT(FHDFN,"P",SP,0)),"^",2) Q:M1=""  S:M1="A" M1="BNE"
"RTN","FHMTK7",39,0)
 S M2="" F LP=1:1:$L(MEAL) I M1'[$E(MEAL,LP) S M2=M2_$E(MEAL,LP)
"RTN","FHMTK7",40,0)
 Q:M2=""
"RTN","FHMTK7",41,0)
 S M1=M1_M2,M2="" S:M1["B" M2="B" S:M1["N" M2=M2_"N" S:M1["E" M2=M2_"E"
"RTN","FHMTK7",42,0)
CHG1 S $P(^FHPT(FHDFN,"P",SP,0),"^",2)=M2
"RTN","FHMTK7",43,0)
 S PP=" Mod 1 "_$P(^FH(115.2,+FP,0),"^",1)_" ("_M2_")"_" (D)" D SET
"RTN","FHMTK7",44,0)
 Q
"RTN","FHMTK7",45,0)
ADD ; Add the Diet Restriction
"RTN","FHMTK7",46,0)
 S MEAL=$P($G(M2),"^",2) Q:MEAL=""
"RTN","FHMTK7",47,0)
 K DIC,DD,DO S DIC="^FHPT(FHDFN,""P"",",DIC(0)="L",DLAYGO=115,DA(1)=FHDFN,X=+FP
"RTN","FHMTK7",48,0)
A1 L +^FHPT(FHDFN,"P",0)
"RTN","FHMTK7",49,0)
 I '$D(^FHPT(FHDFN,"P",0)) S ^FHPT(FHDFN,"P",0)="^115.09PA^^"
"RTN","FHMTK7",50,0)
 S NUM=$P(^FHPT(FHDFN,"P",0),"^",3)+1
"RTN","FHMTK7",51,0)
 S $P(^FHPT(FHDFN,"P",0),"^",3)=NUM
"RTN","FHMTK7",52,0)
 L -^FHPT(FHDFN,"P",0) I $D(^FHPT(FHDFN,"P",NUM,0)) G A1
"RTN","FHMTK7",53,0)
 S DINUM=NUM D FILE^DICN S SP=+Y K DIC,DLAYGO,DINUM
"RTN","FHMTK7",54,0)
 S $P(^FHPT(FHDFN,"P",+SP,0),"^",2,4)=MEAL_"^^Y",PP=" Add 1 "_$P(^FH(115.2,+FP,0),"^",1)_" ("_$P(FP,"^",2)_")"_" (D)" D SET
"RTN","FHMTK7",55,0)
 Q
"RTN","FHMTK7",56,0)
PURG ; Purge the Old Restrictions
"RTN","FHMTK7",57,0)
 S M1=$P($G(^FHPT(FHDFN,"P",SP,0)),"^",2) Q:M1=""  S:M1="A" M1="BNE"
"RTN","FHMTK7",58,0)
 K DIK S DA(1)=FHDFN,DA=+SP,DIK="^FHPT("_DA(1)_",""P""," D ^DIK K DIK,DA S PP=" Del 1 "_$P(^FH(115.2,+FP,0),"^",1)_" ("_M1_")"_" (D)" D SET Q
"RTN","FHMTK7",59,0)
SET I $L(COM)+$L(PP)>120 S EVT="P^O^^"_$E(COM,2,999) D ^FHORX S COM=""
"RTN","FHMTK7",60,0)
 S COM=COM_PP
"RTN","FHMTK7",61,0)
 Q
"RTN","FHMTK7",62,0)
FIL ; File the Event
"RTN","FHMTK7",63,0)
 I COM'="" S EVT="P^O^^"_$E(COM,2,999) D ^FHORX
"RTN","FHMTK7",64,0)
 Q
"RTN","FHMTK7",65,0)
 ;
"RTN","FHMTK7",66,0)
SOO ;OUT SO
"RTN","FHMTK7",67,0)
 S FHCNT=0 K ^TMP("FH",$J)
"RTN","FHMTK7",68,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("OP",FHDFN)) Q:FHDFN'>0  S FHSTADT="" F FHADAT=DT-1:0 S FHADAT=$O(^FHPT(FHDFN,"OP","B",FHADAT)) Q:FHADAT'>0  D
"RTN","FHMTK7",69,0)
 .I FHSTADT="" S DTP=FHADAT D DTP^FH S FHSTADT=DTP
"RTN","FHMTK7",70,0)
 .F FHADM=0:0 S FHADM=$O(^FHPT(FHDFN,"OP","B",FHADAT,FHADM)) Q:FHADM'>0  D
"RTN","FHMTK7",71,0)
 ..S FHSOP=$G(^FHPT(FHDFN,"OP",FHADM,0))
"RTN","FHMTK7",72,0)
 ..Q:$P(FHSOP,U,15)="C"
"RTN","FHMTK7",73,0)
 ..K FHDT,FHCSO
"RTN","FHMTK7",74,0)
 ..S FHDT=$$CURDT(FHDFN,FHADM)
"RTN","FHMTK7",75,0)
 ..Q:'$G(FHDT)
"RTN","FHMTK7",76,0)
 ..I FHDT'<0 Q:'$D(^TMP($J,+FHDT))
"RTN","FHMTK7",77,0)
 ..D CHKSO
"RTN","FHMTK7",78,0)
ADEV F FHDFN=0:0 S FHDFN=$O(^TMP("FH",$J,FHDFN)) Q:FHDFN'>0  F FHACT="C","O" F FHML="B","N","E" D
"RTN","FHMTK7",79,0)
 .S FHSO="" S FHSO=$O(^TMP("FH",$J,FHDFN,FHACT,FHML,FHSO)) Q:FHSO=""  D
"RTN","FHMTK7",80,0)
 ..S FHDATA=^TMP("FH",$J,FHDFN,FHACT,FHML,FHSO)
"RTN","FHMTK7",81,0)
 ..S FHTXT=$P(FHDATA,U,1)_$P(FHDATA,U,2)
"RTN","FHMTK7",82,0)
 ..I $P(FHDATA,U,2)'=$P(FHDATA,U,3) S FHTXT=FHTXT_" to "_$P(FHDATA,U,3)
"RTN","FHMTK7",83,0)
 ..D OPFILE^FHORX
"RTN","FHMTK7",84,0)
 K ^TMP("FH",$J)
"RTN","FHMTK7",85,0)
 Q
"RTN","FHMTK7",86,0)
 ;
"RTN","FHMTK7",87,0)
CHKSO ;compares SO
"RTN","FHMTK7",88,0)
 K FHML,FH,FHSO,FH1,FH2
"RTN","FHMTK7",89,0)
 S FHML=$P(FHSOP,U,4)
"RTN","FHMTK7",90,0)
 F FH1=0:0 S FH1=$O(^FH(111.1,FHDT,FHML_"S",FH1)) Q:FH1'>0  D
"RTN","FHMTK7",91,0)
 .S FHDIPAT=^FH(111.1,FHDT,FHML_"S",FH1,0)
"RTN","FHMTK7",92,0)
 .S FHCSO("N",$P(FHDIPAT,U,1))=FHML_"^"_^FH(111.1,FHDT,FHML_"S",FH1,0)
"RTN","FHMTK7",93,0)
 ;
"RTN","FHMTK7",94,0)
 F FHI=0:0 S FHI=$O(^FHPT(FHDFN,"OP",FHADM,"SP",FHI)) Q:FHI'>0  D
"RTN","FHMTK7",95,0)
 .S FHS1=$G(^FHPT(FHDFN,"OP",FHADM,"SP",FHI,0))
"RTN","FHMTK7",96,0)
 .Q:$P(FHS1,U,6)'=""
"RTN","FHMTK7",97,0)
 .I $P(FHS1,"^",9)="Y" S FHCNT=FHCNT+1,FHCSO("C",FHI)=FHS1
"RTN","FHMTK7",98,0)
 F FH2=0:0 S FH2=$O(FHCSO("C",FH2)) Q:FH2'>0  D
"RTN","FHMTK7",99,0)
 . Q:$P(FHCSO("C",FH2),"^",3)'=FHML  ;diff meal
"RTN","FHMTK7",100,0)
 . S FHSOIEN=$P(FHCSO("C",FH2),U,2)
"RTN","FHMTK7",101,0)
 . I $D(FHCSO("N",FHSOIEN)) D
"RTN","FHMTK7",102,0)
 .. I $P(FHCSO("C",FH2),"^",8)'=$P(FHCSO("N",FHSOIEN),"^",3) D
"RTN","FHMTK7",103,0)
 ... S FHCSO("U",FH2)=FHCSO("C",FH2),$P(FHCSO("U",FH2),"^",8)=$P(FHCSO("N",FHSOIEN),"^",3)
"RTN","FHMTK7",104,0)
 ... K FHCSO("N",FHSOIEN),FHCSO("C",FH2) Q
"RTN","FHMTK7",105,0)
 I $D(FHCSO) D UPDTSO(FHDFN,FHADM,.FHCSO) Q
"RTN","FHMTK7",106,0)
 Q
"RTN","FHMTK7",107,0)
 ;
"RTN","FHMTK7",108,0)
UPDTSO(FHDFN,FHADM,FHUCSO) ;update SO
"RTN","FHMTK7",109,0)
 N FHNOW,FH,FHNEW
"RTN","FHMTK7",110,0)
 I '$D(ADM) N ADM S ADM=FHADM
"RTN","FHMTK7",111,0)
 D NOW^%DTC S FHNOW=%
"RTN","FHMTK7",112,0)
 I '$D(DUZ) W !,"Unknown user" Q
"RTN","FHMTK7",113,0)
 F FH=0:0 S FH=$O(FHUCSO("C",FH)) Q:FH'>0  D
"RTN","FHMTK7",114,0)
 . D CANCSO
"RTN","FHMTK7",115,0)
 F FH=0:0 S FH=$O(FHUCSO("U",FH)) Q:FH'>0  D
"RTN","FHMTK7",116,0)
 . D CANCSO
"RTN","FHMTK7",117,0)
 . S FHNEW=$$ADDSO(FHDFN,FHADM,$P(FHUCSO("U",FH),"^",3),$P(FHUCSO("U",FH),"^",2),$P(FHUCSO("U",FH),"^",8))
"RTN","FHMTK7",118,0)
 F FH=0:0 S FH=$O(FHUCSO("N",FH)) Q:FH'>0  D
"RTN","FHMTK7",119,0)
 . S FHNEW=$$ADDSO(FHDFN,FHADM,$P(FHUCSO("N",FH),"^",1),$P(FHUCSO("N",FH),"^",2),$P(FHUCSO("N",FH),"^",3))
"RTN","FHMTK7",120,0)
 Q
"RTN","FHMTK7",121,0)
 ;
"RTN","FHMTK7",122,0)
CANCSO ;cancel SO
"RTN","FHMTK7",123,0)
 S FHLOCN="",FHLOC=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,3) I $G(FHLOC) S FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHMTK7",124,0)
 S $P(^FHPT(FHDFN,"OP",FHADM,"SP",FH,0),"^",6,7)=FHNOW_"^"_DUZ
"RTN","FHMTK7",125,0)
 S FHSODAT=$G(^FHPT(FHDFN,"OP",FHADM,"SP",FH,0)),FHSO=$P(FHSODAT,U,2),FHML=$P(FHSODAT,U,3),FHN=$P(FHSODAT,U,8)
"RTN","FHMTK7",126,0)
 K ^FHPT("ASPO",FHDFN,FHADM,FH)
"RTN","FHMTK7",127,0)
 S DTP=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,1) D DTP^FH
"RTN","FHMTK7",128,0)
 S FHACT="C",FHTXT="Outpatient Standing Order: "_FHN_" "_$P($G(^FH(118.3,FHSO,0)),U,1)_" ("_FHML_") , "_FHLOCN_", Cancelled "
"RTN","FHMTK7",129,0)
 S ^TMP("FH",$J,FHDFN,"C",FHML,$P($G(^FH(118.3,FHSO,0)),U,1))=FHTXT_U_FHSTADT_U_DTP
"RTN","FHMTK7",130,0)
 Q
"RTN","FHMTK7",131,0)
 ;
"RTN","FHMTK7",132,0)
ADDSO(FHDFN,FHADM,FHML,FHSO,FHN) ;
"RTN","FHMTK7",133,0)
 N FHX,FH
"RTN","FHMTK7",134,0)
 S FHLOCN="",FHLOC=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,3) I $G(FHLOC) S FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHMTK7",135,0)
 S FH=0
"RTN","FHMTK7",136,0)
AGN L +^FHPT(FHDFN,"OP",FHADM,"SP",0)
"RTN","FHMTK7",137,0)
 I '$D(^FHPT(FHDFN,"OP",FHADM,"SP",0)) S ^FHPT(FHDFN,"OP",FHADM,"SP",0)="^115.1626^^"
"RTN","FHMTK7",138,0)
 S FHX=^FHPT(FHDFN,"OP",FHADM,"SP",0),FH=$P(FHX,"^",3)+1,^(0)=$P(FHX,"^",1,2)_"^"_FH_"^"_($P(FHX,"^",4)+1)
"RTN","FHMTK7",139,0)
 L -^FHPT(FHDFN,"OP",FHADM,"SP",0)
"RTN","FHMTK7",140,0)
 G:$D(^FHPT(FHDFN,"OP",FHADM,"SP",FH)) AGN
"RTN","FHMTK7",141,0)
 S ^FHPT(FHDFN,"OP",FHADM,"SP",FH,0)=FH_"^"_FHSO_"^"_FHML_"^"_FHNOW_"^"_DUZ_"^^^"_FHN_"^Y",^FHPT("ASPO",FHDFN,FHADM,FH)=""
"RTN","FHMTK7",142,0)
 S DTP=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,1) D DTP^FH
"RTN","FHMTK7",143,0)
 S FHACT="O",FHTXT="Outpatient Standing Order: "_FHN_" "_$P($G(^FH(118.3,FHSO,0)),U,1)_" ("_FHML_") , "_FHLOCN_", "
"RTN","FHMTK7",144,0)
 S ^TMP("FH",$J,FHDFN,"O",FHML,$P($G(^FH(118.3,FHSO,0)),U,1))=FHTXT_U_FHSTADT_U_DTP
"RTN","FHMTK7",145,0)
 Q FH
"RTN","FHMTK7",146,0)
 ;
"RTN","FHMTK7",147,0)
SFO ;out SFs
"RTN","FHMTK7",148,0)
 S FHCNT=0 K ^TMP("FH",$J)
"RTN","FHMTK7",149,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("OP",FHDFN)) Q:FHDFN'>0  S FHSTADT="" F FHADAT=DT-1:0 S FHADAT=$O(^FHPT(FHDFN,"OP","B",FHADAT)) Q:FHADAT'>0  D
"RTN","FHMTK7",150,0)
 .I FHSTADT="" S DTP=FHADAT D DTP^FH S FHSTADT=DTP
"RTN","FHMTK7",151,0)
 .F FHADM=0:0 S FHADM=$O(^FHPT(FHDFN,"OP","B",FHADAT,FHADM)) Q:FHADM'>0  D
"RTN","FHMTK7",152,0)
 ..S FHSOP=$G(^FHPT(FHDFN,"OP",FHADM,0))
"RTN","FHMTK7",153,0)
 ..Q:$P(FHSOP,U,15)="C"
"RTN","FHMTK7",154,0)
 ..K FHDT,FHCSO
"RTN","FHMTK7",155,0)
 ..S FHDT=$$CURDT(FHDFN,FHADM)
"RTN","FHMTK7",156,0)
 ..Q:'$G(FHDT)
"RTN","FHMTK7",157,0)
 ..I FHDT'<0 Q:'$D(^TMP($J,+FHDT))
"RTN","FHMTK7",158,0)
 ..D DOSF(FHDFN,FHADM)
"RTN","FHMTK7",159,0)
 D ADEV
"RTN","FHMTK7",160,0)
 Q
"RTN","FHMTK7",161,0)
DOSF(FHDFN,FHADM) ;check/update SF
"RTN","FHMTK7",162,0)
 N FHDSF,FH,FHPSF
"RTN","FHMTK7",163,0)
 S FH=$$CURDT(FHDFN,FHADM)
"RTN","FHMTK7",164,0)
 I FH'<0 Q:'$D(^TMP($J,+FH))
"RTN","FHMTK7",165,0)
 S FHDSF=$P($G(^FH(111.1,FH,0)),"^",8)
"RTN","FHMTK7",166,0)
 S FHPSF("N")=$P($G(^FHPT(FHDFN,"OP",FHADM,"SF",0)),U,3)
"RTN","FHMTK7",167,0)
 S FHPSF("E")=$S(FHPSF("N")="":1,1:0)
"RTN","FHMTK7",168,0)
 S:FHPSF("E")=1 FHPSF("N")=$P($G(^FHPT(FHDFN,"OP",FHADM,"SF",0)),"^",3)
"RTN","FHMTK7",169,0)
 S FHPSF=$G(^FHPT(FHDFN,"OP",FHADM,"SF",+FHPSF("N"),0))
"RTN","FHMTK7",170,0)
 S FHPSF("C")=$S($P(FHPSF,"^",32)="":0,1:1)
"RTN","FHMTK7",171,0)
 Q:+$P(FHPSF,"^",4)=1
"RTN","FHMTK7",172,0)
 I $P(FHPSF,"^",34)'="Y" Q:FHDSF=""
"RTN","FHMTK7",173,0)
 I FHPSF("E")=1 Q:FHDSF=""
"RTN","FHMTK7",174,0)
 D UPDSF(FHDFN,FHADM,FHDSF,.FHPSF)
"RTN","FHMTK7",175,0)
 Q
"RTN","FHMTK7",176,0)
 ;
"RTN","FHMTK7",177,0)
UPDSF(FHDFN,FHADM,FHSF,FHPSF) ;
"RTN","FHMTK7",178,0)
 N FHX,FHNO,FHPNO,FHPNN,FHNOW,FHN3
"RTN","FHMTK7",179,0)
 D NOW^%DTC S FHNOW=%
"RTN","FHMTK7",180,0)
 S DTP=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,1) D DTP^FH
"RTN","FHMTK7",181,0)
 I '$D(ADM) N ADM S ADM=FHADM
"RTN","FHMTK7",182,0)
 I '$D(DUZ) W !,"Unknown user" Q
"RTN","FHMTK7",183,0)
 S FHSFDAT=$G(^FHPT(FHDFN,"OP",FHADM,0))
"RTN","FHMTK7",184,0)
 S FHML=$P(FHSFDAT,U,4),FHLOCN=""
"RTN","FHMTK7",185,0)
 S FHLOC=$P(FHSFDAT,U,3) S:FHLOC FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHMTK7",186,0)
 I FHSF="" S FHN3=+FHPSF("N") D:FHN3>0 CANCSF Q
"RTN","FHMTK7",187,0)
 S FHPNO=$G(^FH(118.1,+FHSF,1)) Q:FHPNO=""
"RTN","FHMTK7",188,0)
 G:+FHPSF("N")=0!(FHPSF("C")=1) CONT
"RTN","FHMTK7",189,0)
 G:+$P(FHPSF,"^",4)'=+FHSF CONT
"RTN","FHMTK7",190,0)
 Q:$P(FHPSF,"^",5,29)=FHPNO
"RTN","FHMTK7",191,0)
CONT S FHPNN="^"_FHNOW_"^"_DUZ_"^"_FHSF_"^"_FHPNO
"RTN","FHMTK7",192,0)
 ;
"RTN","FHMTK7",193,0)
TRYSF L +^FHPT(FHDFN,"OP",FHADM,"SF",0)
"RTN","FHMTK7",194,0)
 I '$D(^FHPT(FHDFN,"OP",FHADM,"SF",0)) S ^FHPT(FHDFN,"OP",FHADM,"SF",0)="^115.1627^^"
"RTN","FHMTK7",195,0)
 S FHX=^FHPT(FHDFN,"OP",FHADM,"SF",0),FHN3=+$P(FHX,"^",3),FHNO=FHN3+1,^(0)=$P(FHX,"^",1,2)_"^"_FHNO_"^"_($P(FHX,"^",4)+1)
"RTN","FHMTK7",196,0)
 L -^FHPT(FHDFN,"OP",FHADM,"SF",0) I $D(^FHPT(FHDFN,"OP",FHADM,"SF",FHNO)) G TRYSF
"RTN","FHMTK7",197,0)
 S ^FHPT(FHDFN,"OP",FHADM,"SF",FHNO,0)=FHNO_"^"_$P(FHPNN,"^",2,99)
"RTN","FHMTK7",198,0)
 I FHN3,$D(^FHPT(FHDFN,"OP",FHADM,"SF",FHN3,0)),'$P(^(0),U,32) D CANCSF
"RTN","FHMTK7",199,0)
 S:FHNO $P(^FHPT(FHDFN,"OP",FHADM,"SF",FHNO,0),"^",30,31)=FHNOW_"^"_DUZ
"RTN","FHMTK7",200,0)
 S:FHNO $P(^FHPT(FHDFN,"OP",FHADM,"SF",FHNO,0),"^",34)="Y"
"RTN","FHMTK7",201,0)
 S FHACT="O",FHTXT="Outpatient Supplemental Feeding: "_$P($G(^FH(118.1,+FHSF,0)),U,1)_" ("_FHML_") , "_FHLOCN_", "
"RTN","FHMTK7",202,0)
 S ^TMP("FH",$J,FHDFN,"O",FHML,$P($G(^FH(118.1,FHSF,0)),U,1))=FHTXT_U_FHSTADT_U_DTP
"RTN","FHMTK7",203,0)
 Q
"RTN","FHMTK7",204,0)
CANCSF I FHN3'=0&(FHPSF("C")=0) D
"RTN","FHMTK7",205,0)
 . S $P(^FHPT(FHDFN,"OP",FHADM,"SF",FHN3,0),"^",32,33)=FHNOW_"^"_DUZ
"RTN","FHMTK7",206,0)
 . S $P(^FHPT(FHDFN,"OP",FHADM,0),"^",7)=""
"RTN","FHMTK7",207,0)
 . S FHACT="C",FHTXT="Outpatient Supplemental Feeding: "_$P($G(^FH(118.1,+FHN3,0)),U,1)_" ("_FHML_") , "_FHLOCN_", Cancelled "
"RTN","FHMTK7",208,0)
 . S ^TMP("FH",$J,FHDFN,"C",FHML,$P($G(^FH(118.1,FHN3,0)),U,1))=FHTXT_U_FHSTADT_U_DTP
"RTN","FHMTK7",209,0)
 Q
"RTN","FHMTK7",210,0)
 ;
"RTN","FHMTK7",211,0)
CURDT(FHDFN,FHADM) ;get current patient's diet pattern ien of 111.1
"RTN","FHMTK7",212,0)
 N FHDT,FHOR
"RTN","FHMTK7",213,0)
 S FHOR="",FHDT=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),"^",2)
"RTN","FHMTK7",214,0)
 I FHDT="" S FHOR=$P($G(^FHPT(FHDFN,"OP",FHADM,0)),U,7,11)
"RTN","FHMTK7",215,0)
 I FHOR'["^" S FHOR=FHDT_"^^^^"
"RTN","FHMTK7",216,0)
 S FHDT=$O(^FH(111.1,"AB",FHOR,0)) Q:FHDT="" -1  ;doesn't exist
"RTN","FHMTK7",217,0)
 Q FHDT
"RTN","FHNO2")
0^41^B34765600
"RTN","FHNO2",1,0)
FHNO2 ; HISC/REL/NCA - Supplemental Feeding Labels ;8/26/94  12:01 
"RTN","FHNO2",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO2",3,0)
 ;patch #5 - add outpatient SFs.
"RTN","FHNO2",4,0)
D0 R !!,"Select by S=SUPPLEMENTAL FEEDING SITE or W=WARD: ",XX:DTIME G:'$T!("^"[XX) KIL I "sw"[XX S X=XX D TR^FH S XX=X
"RTN","FHNO2",5,0)
 I XX'?1U!("SW"'[XX) W *7," Enter S or W" G D0
"RTN","FHNO2",6,0)
 I XX="S" S D1=$O(^FH(119.74,0)) I D1'<1,$O(^FH(119.74,D1))<1 G D3
"RTN","FHNO2",7,0)
 I XX="W" S WRD=$O(^FH(119.6,0)) I WRD'<1,$O(^FH(119.6,WRD))<1 G D3
"RTN","FHNO2",8,0)
 I XX="S" G D2
"RTN","FHNO2",9,0)
D1 R !!,"Select WARD: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHNO2",10,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="EMQ" D ^DIC G:Y<1 D1 S W1=+Y
"RTN","FHNO2",11,0)
 S D1=$P($G(^FH(119.6,W1,0)),"^",9) G D3
"RTN","FHNO2",12,0)
D2 R !!,"Select SUPPLEMENTAL FEEDING SITE: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHNO2",13,0)
 K DIC S DIC="^FH(119.74,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S D1=+Y,W1=0
"RTN","FHNO2",14,0)
D3 R !!,"Select Supplemental Feeding Time (10,2,8,ALL): ",TIM:DTIME G KIL:'$T!(U[TIM) I TIM="all" S X=TIM D TR^FH S TIM=X
"RTN","FHNO2",15,0)
 I TIM'=2,TIM'=8,TIM'=10,TIM'="ALL" W *7," Enter a time, 10,2,8, or ALL" G D3
"RTN","FHNO2",16,0)
 W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHNO2",17,0)
 Q:$D(DIRUT)  S LABSTART=Y
"RTN","FHNO2",18,0)
D4 R !!,"Do you want Ingredient list only? N// ",D3:DTIME G:'$T!(D3="^") KIL S:D3="" D3="N" S X=D3 D TR^FH S D3=X I $P("YES",D3,1)'="",$P("NO",D3,1)'="" W *7,"  Answer YES or NO" G D4
"RTN","FHNO2",19,0)
 S D3=$E(D3,1),D3=D3="Y" G:'D3 D6
"RTN","FHNO2",20,0)
D5 R !!,"Consolidated List only? Y// ",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G D5
"RTN","FHNO2",21,0)
 S X=$E(X,1) S:X="Y" D3=D3+1
"RTN","FHNO2",22,0)
D6 I 'D3,'D1,XX="L" W !!,"No Supplemental Feeding Site associated with this location." G KIL
"RTN","FHNO2",23,0)
 W:'D3 !!,"Place Labels in Printer"
"RTN","FHNO2",24,0)
PR K IOP S %ZIS="MQ",%ZIS("A")="Select "_$S('D3:"LABEL",1:"LIST")_" Printer: " W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHNO2",25,0)
 I $D(IO("Q")) S FHPGM="Q1^FHNO2",FHLST="XX^TIM^W1^D1^D3^LABSTART" D EN2^FH G KIL
"RTN","FHNO2",26,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHNO2",27,0)
Q1 ; Process Printing Supplemental Feeding Labels
"RTN","FHNO2",28,0)
 S TIMSAV=TIM
"RTN","FHNO2",29,0)
 D NOW^%DTC S NOW=%,DT=%\1 G:D3=2 SUM
"RTN","FHNO2",30,0)
 I 'D3 Q:'D1  S FHPAR=$G(^FH(119.74,D1,0)),LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHNO2",31,0)
 S COUNT=0,LINE=1 I TIM="ALL" S TIM=10 D Q2 S TIM=2 D Q2 S TIM=8
"RTN","FHNO2",32,0)
 D Q2
"RTN","FHNO2",33,0)
 I $G(LAB)>2 D DPLL^FHLABEL,KIL Q
"RTN","FHNO2",34,0)
 I 'D3 F L=1:1:18 W !
"RTN","FHNO2",35,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHNO2",36,0)
Q2 K ^TMP($J,"L"),^TMP($J,"I"),^TMP($J,"SF"),C S P1=$S(TIM=10:5,TIM=2:13,1:21),T0=$P(DT,".",1)_"."_$S(TIM=10:1,TIM=2:14,1:2),P3=7,N1=0
"RTN","FHNO2",37,0)
 I XX="W" S P0=$P($G(^FH(119.6,W1,0)),"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0) D F0
"RTN","FHNO2",38,0)
 I XX="S" F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0),D2=$P(X,"^",9) I D1=D2 S P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0) D F0
"RTN","FHNO2",39,0)
 D SF0
"RTN","FHNO2",40,0)
 G ^FHNO21:'D3,PRT
"RTN","FHNO2",41,0)
F0 S WRDN=$P(^FH(119.6,W1,0),"^",1),FHDFN=0
"RTN","FHNO2",42,0)
F1 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN'>0  S ADM=$G(^FHPT("AW",W1,FHDFN)) G:ADM<1 F1
"RTN","FHNO2",43,0)
 G:'$D(^FHPT(FHDFN,"A",ADM,0)) F1 S X1=^(0),NO=$P(X1,"^",7) G:'NO F1
"RTN","FHNO2",44,0)
 I 'D3 S IS=$P(X1,"^",10) I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHNO2",45,0)
 D CHK G:'NO F1
"RTN","FHNO2",46,0)
 S Y=$G(^FHPT(FHDFN,"A",ADM,"SF",NO,0))
"RTN","FHNO2",47,0)
 S Y=$P(Y,"^",P1,P1+7) G:Y?."^" F1 D:D3 CALC
"RTN","FHNO2",48,0)
 I 'D3 D
"RTN","FHNO2",49,0)
 .D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHNO2",50,0)
 .S $P(Y,"^",9)=IS
"RTN","FHNO2",51,0)
 .S LNOD=$S(XX="S":D2_"~"_$P($G(^FH(119.74,D2,0)),"^",1),1:P0_"~"_WRDN)
"RTN","FHNO2",52,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHNO2",53,0)
 .S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHNO2",54,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHNO2",55,0)
 .S RM=$G(^DPT(DFN,.101)),PNOD=P0_"~"_R0_RM_"~"_FHDFN,WRD=P0_$E(WRDN,1,27-$L(RM))_"/"_RM
"RTN","FHNO2",56,0)
 .S ^TMP($J,"L",LNOD,PNOD)=Y_"^"_WRD Q
"RTN","FHNO2",57,0)
 G F1
"RTN","FHNO2",58,0)
 Q
"RTN","FHNO2",59,0)
 ;
"RTN","FHNO2",60,0)
CHK S FHORD=$P(X1,"^",2),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHNO2",61,0)
 I X1>1,X1'>T0 G C2
"RTN","FHNO2",62,0)
C0 I '$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHNO2",63,0)
 S X1=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",7) I X1'="",X1'="X" S NO=""
"RTN","FHNO2",64,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHNO2",65,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"AC",K)) Q:K<1!(K>T0)  S A1=K
"RTN","FHNO2",66,0)
 G:'A1 C1 S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0 K ^FHPT(FHDFN,"A",ADM,"AC",A1) G C2
"RTN","FHNO2",67,0)
SUM K C,^TMP($J,"SF") S P0=$S(TIM=2:13,TIM=8:21,1:5),P3=$S(TIM="ALL":23,1:7),N1=0
"RTN","FHNO2",68,0)
 I XX="W" S X=$G(^FH(119.6,W1,0)) D S0
"RTN","FHNO2",69,0)
 I XX="S" F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0),D2=$P(X,"^",9) I D1=D2 D S0
"RTN","FHNO2",70,0)
 D SF0
"RTN","FHNO2",71,0)
 G PRT
"RTN","FHNO2",72,0)
S0 S WRDN=$P(^FH(119.6,W1,0),"^",1),FHDFN=0
"RTN","FHNO2",73,0)
S1 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN=""  S ADM=$G(^FHPT("AW",W1,FHDFN)) G:ADM<1 S1
"RTN","FHNO2",74,0)
 G:'$D(^FHPT(FHDFN,"A",ADM,0)) S1 S X1=^(0),NO=$P(X1,"^",7) G:'NO S1
"RTN","FHNO2",75,0)
 S Y=$P(^FHPT(FHDFN,"A",ADM,"SF",NO,0),"^",P0,P0+P3) G:Y?."^" S1 D CALC
"RTN","FHNO2",76,0)
 G S1
"RTN","FHNO2",77,0)
PRT S DTP=DT D DTP^FH S DTE=DTP_" "_$S(TIM="ALL":"ALL",TIM=10:TIM_" AM",1:TIM_" PM")
"RTN","FHNO2",78,0)
 S Y=$S(XX="S":$P($G(^FH(119.74,D1,0)),"^",1),1:WRDN)
"RTN","FHNO2",79,0)
 W @IOF W:D3=2 !?5,"**** CONSOLIDATED ****" W !?3,"**** INGREDIENTS LIST ****",! W:D3=1 ! W ?(33-$L(Y)\2),Y,!?9,DTE,!!
"RTN","FHNO2",80,0)
 F L=0:0 S L=$O(^FH(118,L)) Q:L<1  S:$D(C(L)) ^TMP($J,"SF",$P($G(^FH(118,L,0)),"^",1),L)=""
"RTN","FHNO2",81,0)
 S A1="" F  S A1=$O(^TMP($J,"SF",A1)) Q:A1=""  F L=0:0 S L=$O(^TMP($J,"SF",A1,L)) Q:L<1  W !,$E(A1,1,26),?28,$J(C(L),5,0)
"RTN","FHNO2",82,0)
 W !!?4,"**** PATIENTS = ",N1," ****",! Q
"RTN","FHNO2",83,0)
CALC S N1=N1+1
"RTN","FHNO2",84,0)
 F L=1:2:P3 S Z=$P(Y,"^",L) I Z'="" S Q=$P(Y,"^",L+1) S:'Q Q=1 S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO2",85,0)
 Q
"RTN","FHNO2",86,0)
 ;
"RTN","FHNO2",87,0)
SF0 ;outpatient SFs
"RTN","FHNO2",88,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",DT,FHDFN)) Q:FHDFN'>0  F ADM=0:0 S ADM=$O(^FHPT("RM",DT,FHDFN,ADM)) Q:ADM'>0  D
"RTN","FHNO2",89,0)
 .S FHODAT=$G(^FHPT(FHDFN,"OP",ADM,0)),FHNO=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",0)),U,3) Q:'$G(FHNO)
"RTN","FHNO2",90,0)
 .S FHMEAL=$P(FHODAT,U,4),FHOWARD=$P(FHODAT,U,3)
"RTN","FHNO2",91,0)
 .S X1=$G(^FH(119.6,FHOWARD,0)),WRDN=$P(X1,U,1)
"RTN","FHNO2",92,0)
 .Q:'FHOWARD!'$D(^FH(119.6,FHOWARD,0))
"RTN","FHNO2",93,0)
 .I XX="W",W1 Q:W1'=FHOWARD
"RTN","FHNO2",94,0)
 .I XX="S" S D2=$P(X1,"^",9) Q:D1'=D2  I D1=D2 S P0=$P(X1,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHNO2",95,0)
 .S P1=$S(FHMEAL="N":13,FHMEAL="E":21,1:5)
"RTN","FHNO2",96,0)
 .I (FHMEAL="B"),(TIM'=10) Q
"RTN","FHNO2",97,0)
 .I (FHMEAL="N"),(TIM'=2) Q
"RTN","FHNO2",98,0)
 .I (FHMEAL="E"),(TIM'=8) Q
"RTN","FHNO2",99,0)
 .I 'D3 S IS=$P($G(^FHPT(FHDFN,0)),"^",5) I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHNO2",100,0)
 .S Y=$G(^FHPT(FHDFN,"OP",ADM,"SF",FHNO,0))
"RTN","FHNO2",101,0)
 .S Y=$P(Y,"^",P1,P1+7) Q:Y?."^"  I D3 D CLC1
"RTN","FHNO2",102,0)
 .S N1=N1+1
"RTN","FHNO2",103,0)
 .S RM="",RMIEN=$P(FHODAT,U,18) I $G(RMIEN),$D(^DG(405.4,RMIEN,0)) S RM=$E($P(^DG(405.4,RMIEN,0),U,1),1,10)
"RTN","FHNO2",104,0)
 .I 'D3 D
"RTN","FHNO2",105,0)
 ..D PATNAME^FHOMUTL
"RTN","FHNO2",106,0)
 ..S $P(Y,"^",9)=IS
"RTN","FHNO2",107,0)
 ..S LNOD=$S(XX="S":D2_"~"_$P($G(^FH(119.74,D2,0)),"^",1),1:P0_"~"_WRDN)
"RTN","FHNO2",108,0)
 ..S RI="***" S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHNO2",109,0)
 ..S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHNO2",110,0)
 ..S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHNO2",111,0)
 ..S PNOD=P0_"~"_R0_RM_"~"_FHDFN,WRD=P0_$E(WRDN,1,20-$L(RM))_"/"_RM
"RTN","FHNO2",112,0)
 ..S ^TMP($J,"L",LNOD,PNOD)=Y_"^"_WRD
"RTN","FHNO2",113,0)
 Q
"RTN","FHNO2",114,0)
CLC1 ;
"RTN","FHNO2",115,0)
 F L=1:2:P3 S Z=$P(Y,"^",L) I Z'="" S Q=$P(Y,"^",L+1) S:'Q Q=1 S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO2",116,0)
 Q
"RTN","FHNO21")
0^42^B15038178
"RTN","FHNO21",1,0)
FHNO21 ; HISC/REL/NCA - Print Feeding Labels ;8/26/94  12:01 
"RTN","FHNO21",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO21",3,0)
 S DTP=DT\1 D DTP^FH S DTE=DTP_" "_TIM_$S(TIM=10:"AM",1:"PM")
"RTN","FHNO21",4,0)
 S S1=$S(LAB=1:6,1:9),S2=LAB=2*5+33
"RTN","FHNO21",5,0)
 K N F L=0:0 S L=$O(^FH(118,L)) Q:L<1  S Y=^(L,0),N1=$P(Y,"^",1),^TMP($J,"I",$E(N1,1,26)_","_L)=L I '$D(^FH(118,L,"I")) S N(L)=$P(Y,"^",1,2)
"RTN","FHNO21",6,0)
 S LNOD="" F  S LNOD=$O(^TMP($J,"L",LNOD)) Q:LNOD=""  D P2
"RTN","FHNO21",7,0)
 Q
"RTN","FHNO21",8,0)
P2 S PNOD="",N1=0 K C F  S PNOD=$O(^TMP($J,"L",LNOD,PNOD)) Q:PNOD=""  S Y2=^(PNOD) D P3
"RTN","FHNO21",9,0)
 I LAB<3 D P5 Q
"RTN","FHNO21",10,0)
 Q
"RTN","FHNO21",11,0)
P3 S N1=N1+1
"RTN","FHNO21",12,0)
 S FHDFN=$P(PNOD,"~",3),WRD=$P(Y2,"^",10)
"RTN","FHNO21",13,0)
 D PATNAME^FHOMUTL I FHPTNM="" Q
"RTN","FHNO21",14,0)
 S NAM=FHPTNM,IS=$P(Y2,"^",9)
"RTN","FHNO21",15,0)
 ;S NAM=$P(^DPT(DFN,0),"^",1),IS=$P(Y2,"^",9) D PID^FHDPA
"RTN","FHNO21",16,0)
 I LAB>2 D LL Q
"RTN","FHNO21",17,0)
 I $P(FHPAR,"^",4)="Y" G P4
"RTN","FHNO21",18,0)
 W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!?$S(LAB=1:3,1:0),FHBID W:IS'="" ?(S2-22),"*NURSE" W ?(S2-15),DTE S LN=2 I LAB=2 W !! S LN=4
"RTN","FHNO21",19,0)
 F L=1:2:7 S Z=$P(Y2,"^",L) I Z'="" D
"RTN","FHNO21",20,0)
 .S Q=$P(Y2,"^",L+1) S:'Q Q=1
"RTN","FHNO21",21,0)
 .W !,$J(Q,2)," "
"RTN","FHNO21",22,0)
 .W $S($D(N(Z)):$P(N(Z),"^",1),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:"")
"RTN","FHNO21",23,0)
 .S LN=LN+1 S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO21",24,0)
 .Q
"RTN","FHNO21",25,0)
 I LN<S1 F L=LN+1:1:S1 W !
"RTN","FHNO21",26,0)
 Q
"RTN","FHNO21",27,0)
P4 F L=1:2:7 S Z=$P(Y2,"^",L) I Z'="",$S($D(N(Z)):$P(N(Z),"^",2),$D(^FH(118,+Z,0)):$P(^(0),"^",2),1:"")'="N" D
"RTN","FHNO21",28,0)
 .S Q=$P(Y2,"^",L+1) S:'Q Q=1
"RTN","FHNO21",29,0)
 .W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!,FHBID
"RTN","FHNO21",30,0)
 .W:IS'="" ?11,"*NURSE"
"RTN","FHNO21",31,0)
 .W ?(S2-15),DTE,!!,$J(Q,2)," "
"RTN","FHNO21",32,0)
 .W $S($D(N(Z)):$P(N(Z),"^",1),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:""),!!
"RTN","FHNO21",33,0)
 .W:LAB=2 !!!
"RTN","FHNO21",34,0)
 .S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO21",35,0)
 .Q
"RTN","FHNO21",36,0)
 Q
"RTN","FHNO21",37,0)
P5 S Y=$S(XX="S":$P($G(^FH(119.74,D1,0)),"^",1),1:$P($G(^FH(119.6,W1,0)),"^",1))
"RTN","FHNO21",38,0)
 W !?3,"**** INGREDIENTS LIST ****",!!?(33-$L(Y)\2),Y,!?9,DTE,!! S LN=6
"RTN","FHNO21",39,0)
 S A1="" F K=0:0 S A1=$O(^TMP($J,"I",A1)) Q:A1=""  S L=^(A1) I $D(C(L)),C(L) W !,$S($D(N(L)):$P(N(L),"^",1),$D(^FH(118,+L,0)):$P(^(0),"^",1),1:""),?28,$J(C(L),5,0) S LN=LN+1
"RTN","FHNO21",40,0)
P6 W !!?4,"**** PATIENTS = ",N1," ****",! S LN=LN+3
"RTN","FHNO21",41,0)
 S LN=LN#S1 I LN F L=LN+1:1:S1 W !
"RTN","FHNO21",42,0)
 Q
"RTN","FHNO21",43,0)
LL ;
"RTN","FHNO21",44,0)
 S FHCOL=$S(LAB=3:3,1:2)
"RTN","FHNO21",45,0)
 I LABSTART>1 F FHLABST=1:1:(LABSTART-1)*FHCOL D  S LABSTART=1
"RTN","FHNO21",46,0)
 .I LAB=3 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6)="" D LL3^FHLABEL
"RTN","FHNO21",47,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6,PCL7,PCL8)="" D LL4^FHLABEL
"RTN","FHNO21",48,0)
 .Q
"RTN","FHNO21",49,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHNO21",50,0)
 S WRD1=$E(WRD,3,99)
"RTN","FHNO21",51,0)
 S NAM=$E(NAM,1,FHTAB-$L(WRD1)),BIDIS=BID I IS="N" S BIDIS=BID_" *NURSE"
"RTN","FHNO21",52,0)
 S LNA=NAM_$J(WRD1,FHTAB+1-$L(NAM)),LNB=BIDIS_$J(DTE,FHTAB+1-$L(BIDIS))
"RTN","FHNO21",53,0)
 I $P(FHPAR,"^",4)="Y" D LL2 Q
"RTN","FHNO21",54,0)
 S NUM=0 F XSF=1:2:7 I $P(Y2,U,XSF)'="" S NUM=NUM+1
"RTN","FHNO21",55,0)
 S INDX=0 F XSF=1:2:7 D
"RTN","FHNO21",56,0)
 .S SFPTR=$P(Y2,U,XSF) I SFPTR="" Q
"RTN","FHNO21",57,0)
 .S QTY=$P(Y2,U,XSF+1),SFNM=$P($G(^FH(118,SFPTR,0)),U,1)
"RTN","FHNO21",58,0)
 .S INDX=INDX+1,ZF(INDX)=$J(QTY,2)_" "_SFNM
"RTN","FHNO21",59,0)
 .Q
"RTN","FHNO21",60,0)
 I LAB=3 D
"RTN","FHNO21",61,0)
 .I NUM=1 S (PCL1,PCL2,PCL6)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1)
"RTN","FHNO21",62,0)
 .I NUM=2 S (PCL1,PCL6)="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2)
"RTN","FHNO21",63,0)
 .I NUM=3 S PCL1="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2),PCL6=ZF(3)
"RTN","FHNO21",64,0)
 .I NUM=4 S PCL1=LNA,PCL2=LNB,PCL3=ZF(1),PCL4=ZF(2),PCL5=ZF(3),PCL6=ZF(4)
"RTN","FHNO21",65,0)
 .D LL3^FHLABEL
"RTN","FHNO21",66,0)
 I LAB=4 D
"RTN","FHNO21",67,0)
 .I NUM=1 S (PCL1,PCL2,PCL3,PCL7,PCL8)="",PCL4=LNA,PCL5=LNB,PCL6=ZF(1)
"RTN","FHNO21",68,0)
 .I NUM=2 S (PCL1,PCL2,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1),PCL6=ZF(2)
"RTN","FHNO21",69,0)
 .I NUM=3 S (PCL1,PCL2,PCL8)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1),PCL6=ZF(2),PCL7=ZF(3)
"RTN","FHNO21",70,0)
 .I NUM=4 S (PCL1,PCL8)="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2),PCL6=ZF(3),PCL7=ZF(4)
"RTN","FHNO21",71,0)
 .D LL4^FHLABEL
"RTN","FHNO21",72,0)
 Q
"RTN","FHNO21",73,0)
LL2 ;
"RTN","FHNO21",74,0)
 F XSF=1:2:7 D
"RTN","FHNO21",75,0)
 .S SFPTR=$P(Y2,U,XSF) I SFPTR="" Q
"RTN","FHNO21",76,0)
 .S QTY=$P(Y2,U,XSF+1),SFNM=$P($G(^FH(118,SFPTR,0)),U,1)
"RTN","FHNO21",77,0)
 .S LNC=$J(QTY,2)_" "_SFNM
"RTN","FHNO21",78,0)
 .I LAB=3 S (PCL1,PCL4,PCL6)="",PCL2=LNA,PCL3=LNB,PCL5=LNC D LL3^FHLABEL
"RTN","FHNO21",79,0)
 .I LAB=4 S (PCL1,PCL2,PCL5,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL6=LNC D LL4^FHLABEL
"RTN","FHNO21",80,0)
 Q
"RTN","FHNO31")
0^44^B28958638
"RTN","FHNO31",1,0)
FHNO31 ; HISC/REL - Supplemental Feeding Lists (cont) ;4/27/93  11:26 
"RTN","FHNO31",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO31",3,0)
 ;patch #5 - add outpatint SFs.
"RTN","FHNO31",4,0)
 K C F L=0:0 S L=$O(^FH(118,L)) Q:L<1  I '$D(^FH(118,L,"I")) S C(L)=$P(^(0),"^",1)
"RTN","FHNO31",5,0)
 D NOW^%DTC S (NOW,DTP)=%,DT=%\1 D DTP^FH S X1=DT,X2=-14 D C^%DTC S OLD=+X
"RTN","FHNO31",6,0)
 K ^TMP("FH",$J) S PG=0
"RTN","FHNO31",7,0)
 F KK=0:0 S KK=$O(^FH(119.6,KK)) Q:KK<1  S X=^(KK,0) D F0
"RTN","FHNO31",8,0)
 S NXW="" F KK=0:0 S NXW=$O(^TMP("FH",$J,NXW)) Q:NXW=""  F WRD=0:0 S WRD=$O(^TMP("FH",$J,NXW,WRD)) Q:WRD<1  D F2
"RTN","FHNO31",9,0)
 Q
"RTN","FHNO31",10,0)
 ;
"RTN","FHNO31",11,0)
F0 I XX="S" S K1=$P(X,"^",9) I WRDS,K1'=WRDS Q
"RTN","FHNO31",12,0)
 I XX="W",WRDS,KK'=WRDS Q
"RTN","FHNO31",13,0)
 S K1=$S(XX="W":"",K1<1:99,K1<10:"0"_K1,1:K1),P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHNO31",14,0)
 S WRDN=$P(^FH(119.6,KK,0),"^",1),^TMP("FH",$J,K1_P0_$E(WRDN,1,26),KK)="" Q
"RTN","FHNO31",15,0)
 ;
"RTN","FHNO31",16,0)
F2 S WRDN=$P(^FH(119.6,WRD,0),"^",1)
"RTN","FHNO31",17,0)
 ;I $O(^FHPT("AW",WRD,0))<1 Q
"RTN","FHNO31",18,0)
 K ^TMP($J) F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",WRD,FHDFN)) Q:FHDFN<1  S ADM=$G(^FHPT("AW",WRD,FHDFN)) D RM
"RTN","FHNO31",19,0)
 ;PROCESS outpatient SF.
"RTN","FHNO31",20,0)
 I '$D(^TMP($J)) D OSF I $D(^TMP($J)) D HDR D OSF1 Q
"RTN","FHNO31",21,0)
 ;
"RTN","FHNO31",22,0)
 Q:'$D(^TMP($J))  D HDR
"RTN","FHNO31",23,0)
 S (NR,RM)="",FHPAR=0 I XX="S",WRDS S FHPAR=$P($G(^FH(119.74,WRDS,0)),"^",5)="Y"
"RTN","FHNO31",24,0)
L2 S NR=$O(^TMP($J,"P",NR)) I NR="" W ! D:FHPAR ING Q
"RTN","FHNO31",25,0)
 S FHDFN=""
"RTN","FHNO31",26,0)
L3 S FHDFN=$O(^TMP($J,"P",NR,FHDFN)) G:FHDFN="" L2 S ADM=$G(^TMP($J,"P",NR,FHDFN)) G:ADM<1 L3 D PATNAME^FHOMUTL G:DFN="" L2 S Y(0)=^DPT(DFN,0) D PID^FHDPA
"RTN","FHNO31",27,0)
 S RM=$S(PRN="R":NR,$D(^DPT(DFN,.101)):^(.101),1:"")
"RTN","FHNO31",28,0)
 S (NO,Y)="" I $D(^FHPT(FHDFN,"A",ADM,0)) S NO=$P(^(0),"^",7),IS=$P(^(0),"^",10)
"RTN","FHNO31",29,0)
 G:'NO L3 S Y=^FHPT(FHDFN,"A",ADM,"SF",NO,0),NM=$P(Y,"^",4),LST=$P(Y,"^",30)\1
"RTN","FHNO31",30,0)
 I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHNO31",31,0)
 I NM S NM=$P(^FH(118.1,NM,0),"^",2) I NM="" S NM=$P(^(0),"^",1)
"RTN","FHNO31",32,0)
 D:$Y>(IOSL-8) HDR W !!,RM,?13,$E($P(Y(0),"^",1),1,24),?38,BID
"RTN","FHNO31",33,0)
 W ?47,$E(NM,1,10) W:IS'="" ?60,"*NURSE" W ?69,$E(LST,4,5),"-",$E(LST,6,7) W:LST<OLD "*"
"RTN","FHNO31",34,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$S($D(C(Z)):C(Z),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:"") I FHPAR D L4
"RTN","FHNO31",35,0)
 F K1=1:1:3 I N(K1)'="" W !?8,$P("10AM; 2PM; 8PM",";",K1),?14,N(K1)
"RTN","FHNO31",36,0)
 G L3
"RTN","FHNO31",37,0)
 ;
"RTN","FHNO31",38,0)
L4 S:'$D(^TMP($J,"I",K1,Z)) ^TMP($J,"I",K1,Z)=0 S ^(Z)=^(Z)+Q Q
"RTN","FHNO31",39,0)
ING Q:'$D(^TMP($J,"I"))  S DTP=DT D DTP^FH W @IOF,!,WRDN," INGREDIENT LIST FOR ",DTP
"RTN","FHNO31",40,0)
 W !!,"--- 10 AM ---",?26,"--- 2 PM ---",?52,"--- 8 PM ---",! S (N(1),N(2),N(3))=.5
"RTN","FHNO31",41,0)
 F L=0:0 Q:(N(1)+N(2)+N(3))=0  W ! F K=1:1:3 S:N(K)>0 N(K)=$O(^TMP($J,"I",K,N(K))) I N(K)>0 S Z=N(K) W ?(K-1*26),$J(^(Z),4,0)," ",$S($D(C(Z)):C(Z),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:"")
"RTN","FHNO31",42,0)
 W ! Q
"RTN","FHNO31",43,0)
RM ;
"RTN","FHNO31",44,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHNO31",45,0)
 Q:'$D(^DPT(DFN,0))  Q:ADM<1
"RTN","FHNO31",46,0)
 Q:'$D(^FHPT(FHDFN,"A",ADM,0))  S X1=^(0),NO=$P(X1,"^",7) Q:'NO
"RTN","FHNO31",47,0)
 D CHK Q:'NO
"RTN","FHNO31",48,0)
 I PRN="R" S RM=$G(^DPT(DFN,.101))
"RTN","FHNO31",49,0)
 E  S RM=$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHNO31",50,0)
 S:RM="" RM=" "
"RTN","FHNO31",51,0)
 S ^TMP($J,"P",RM,FHDFN)=ADM Q
"RTN","FHNO31",52,0)
 ;
"RTN","FHNO31",53,0)
CHK S FHORD=$P(X1,"^",2),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHNO31",54,0)
 I X1>1,X1'>NOW G C2
"RTN","FHNO31",55,0)
C0 I '$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHNO31",56,0)
 S X1=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",7) I X1'="",X1'="X" S NO=""
"RTN","FHNO31",57,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHNO31",58,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"AC",K)) Q:K<1!(K>NOW)  S A1=K
"RTN","FHNO31",59,0)
 G:'A1 C1 S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0
"RTN","FHNO31",60,0)
 K ^FHPT(FHDFN,"A",ADM,"AC",A1) G C2
"RTN","FHNO31",61,0)
 ;
"RTN","FHNO31",62,0)
HDR ; Print Header
"RTN","FHNO31",63,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHNO31",64,0)
 W !?10,"W A R D   S U P P L E M E N T A L   F E E D I N G   L I S T",?72,"Page ",PG
"RTN","FHNO31",65,0)
 W !!,"Ward: ",WRDN,?61,DTP
"RTN","FHNO31",66,0)
 W !!,"ROOM",?13,"PATIENT",?39,"ID#     SUPP MENU",?60,"ISOLAT",?69,"REVIEW" Q
"RTN","FHNO31",67,0)
 ;
"RTN","FHNO31",68,0)
OSF ;outpatient SFs
"RTN","FHNO31",69,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",DT,FHDFN)) Q:FHDFN'>0  F ADM=0:0 S ADM=$O(^FHPT("RM",DT,FHDFN,ADM)) Q:ADM'>0  D
"RTN","FHNO31",70,0)
 .S X1=$G(^FHPT(FHDFN,"OP",ADM,0)),FHNO=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",0)),U,3) Q:'$G(FHNO)
"RTN","FHNO31",71,0)
 .S FHMEAL=$P(X1,U,4),FHOWARD=$P(X1,U,3)
"RTN","FHNO31",72,0)
 .I (WRD'=FHOWARD)!(FHMEAL="") Q
"RTN","FHNO31",73,0)
 .S FHSFDAT=""
"RTN","FHNO31",74,0)
 .I $D(^FHPT(FHDFN,"OP",ADM,"SF",FHNO,0)) S FHSFDAT=^(0)
"RTN","FHNO31",75,0)
 .Q:$P(FHSFDAT,U,32)
"RTN","FHNO31",76,0)
 .S RM=$S(FHMEAL="N":2,FHMEAL="E":3,1:1)
"RTN","FHNO31",77,0)
 .I $G(FHOWARD),($G(^FH(119.6,FHOWARD,0))) S WRDN=$P($G(^FH(119.6,FHOWARD,0)),U,1)
"RTN","FHNO31",78,0)
 .S P1=$S(FHMEAL="N":13,FHMEAL="E":21,1:5)
"RTN","FHNO31",79,0)
 .D PATNAME^FHOMUTL
"RTN","FHNO31",80,0)
 .S RM="",RMIEN=$P(X1,U,18) I $G(RMIEN),$D(^DG(405.4,RMIEN,0)) S RM=$E($P(^DG(405.4,RMIEN,0),U,1),1,10)
"RTN","FHNO31",81,0)
 .S:RM="" RM=" "
"RTN","FHNO31",82,0)
 .I PRN="A" S ^TMP($J,"P",FHPTNM,RM,ADM)=FHDFN
"RTN","FHNO31",83,0)
 .I PRN="R" S ^TMP($J,"P",RM,FHPTNM,ADM)=FHDFN
"RTN","FHNO31",84,0)
 .;S ^TMP($J,"P",FHPTNM,RM,ADM)=FHDFN
"RTN","FHNO31",85,0)
 Q
"RTN","FHNO31",86,0)
 ;
"RTN","FHNO31",87,0)
OSF1 S FHPTN="",FHPAR=0 I XX="S",WRDS S FHPAR=$P($G(^FH(119.74,WRDS,0)),"^",5)="Y"
"RTN","FHNO31",88,0)
OL2 S FHPTN=$O(^TMP($J,"P",FHPTN)) I FHPTN="" W ! D:FHPAR ING Q
"RTN","FHNO31",89,0)
 S NR="",ADM=0
"RTN","FHNO31",90,0)
 ;
"RTN","FHNO31",91,0)
OL3 S NR=$O(^TMP($J,"P",FHPTN,NR)) G:NR="" OL2
"RTN","FHNO31",92,0)
 S RM=$S(PRN="R":FHPTN,1:NR)
"RTN","FHNO31",93,0)
OL4 S ADM=$O(^TMP($J,"P",FHPTN,NR,ADM)) G:ADM<1 OL3 S FHDFN=^TMP($J,"P",FHPTN,NR,ADM) D PATNAME^FHOMUTL
"RTN","FHNO31",94,0)
 S (NO,Y,IS)="" I $D(^FHPT(FHDFN,"OP",ADM,0)) S NO=$P(^FHPT(FHDFN,"OP",ADM,"SF",0),"^",3),IS=$P(^FHPT(FHDFN,0),"^",5)
"RTN","FHNO31",95,0)
 G:'NO OL4 S Y=^FHPT(FHDFN,"OP",ADM,"SF",NO,0),NM=$P(Y,"^",4),LST=$P(Y,"^",30)\1
"RTN","FHNO31",96,0)
 I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHNO31",97,0)
 I NM S NM=$P(^FH(118.1,NM,0),"^",2) I NM="" S NM=$P(^(0),"^",1)
"RTN","FHNO31",98,0)
 D:$Y>(IOSL-8) HDR I $D(FHPTSAV),FHPTSAV'=FHPTN W !
"RTN","FHNO31",99,0)
 W !,RM,?13,$E(FHPTNM,1,24),?38,FHBID
"RTN","FHNO31",100,0)
 W ?47,$E(NM,1,10) W:IS'="" ?60,"*NURSE" W ?69,$E(LST,4,5),"-",$E(LST,6,7) W:LST<OLD "*"
"RTN","FHNO31",101,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$S($D(C(Z)):C(Z),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:"") I FHPAR D L4
"RTN","FHNO31",102,0)
 F K1=1:1:3 I N(K1)'="" W !?8,$P("10AM; 2PM; 8PM",";",K1),?14,N(K1)
"RTN","FHNO31",103,0)
 S FHPTSAV=FHPTN
"RTN","FHNO31",104,0)
 G OL4
"RTN","FHNO41")
0^45^B18764255
"RTN","FHNO41",1,0)
FHNO41 ; HISC/REL/RVD - List Bulk Nourishments ;7/14/93  10:13
"RTN","FHNO41",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO41",3,0)
 ;patch #5 - modify report; print total for every location.
"RTN","FHNO41",4,0)
 S D1=$O(^FH(119.74,0)) I D1'<1,$O(^FH(119.74,D1))<1 G N3
"RTN","FHNO41",5,0)
N2 R !!,"Select SUPPLEMENTAL FEEDING SITE (or ALL): ",X:DTIME G:'$T!("^"[X) KIL I (X="ALL")!(X="all") S D1=0 G N3
"RTN","FHNO41",6,0)
 K DIC S DIC="^FH(119.74,",DIC(0)="EMQ" D ^DIC G:Y<1 N2 S D1=+Y
"RTN","FHNO41",7,0)
N3 R !!,"Do you want Labels? N// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="N" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Enter YES or NO" G N3
"RTN","FHNO41",8,0)
 S X=$E(X,1),LAB=X="Y"
"RTN","FHNO41",9,0)
 S FHLBFLG=1 I LAB D  I FHLBFLG=0 Q
"RTN","FHNO41",10,0)
 .W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHNO41",11,0)
 .I $D(DIRUT) S FHLBFLG=0 Q
"RTN","FHNO41",12,0)
 .S LABSTART=Y Q
"RTN","FHNO41",13,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select "_$S(LAB:"LABEL",1:"LIST")_" Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHNO41",14,0)
 I $D(IO("Q")) S FHPGM="Q1^FHNO41",FHLST="D1^LAB^LABSTART" D EN2^FH G KIL
"RTN","FHNO41",15,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHNO41",16,0)
Q1 ; Process Printing Bulk Nourishments
"RTN","FHNO41",17,0)
 K ^TMP($J) D NOW^%DTC S DTP=% D DTP^FH
"RTN","FHNO41",18,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHNO41",19,0)
 F K=0:0 S K=$O(^FH(119.6,K)) Q:K<1  S X=^(K,0),D2=$P(X,"^",9) I 'D1!(D1=D2),$O(^FH(119.6,K,"BN",0))>0 S P0=$P(X,"^",4) S:P0<1 P0=99 S ^TMP($J,P0,K)=""
"RTN","FHNO41",20,0)
 G:LAB L0
"RTN","FHNO41",21,0)
 S D3=$S('D1:"ALL SITES",1:$P(^FH(119.74,D1,0),"^",1)),PG=0 D HDR
"RTN","FHNO41",22,0)
 K D S C1=0 F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1  F K=0:0 S K=$O(^TMP($J,P0,K)) Q:K<1  D Q4
"RTN","FHNO41",23,0)
 D:$Y>(IOSL-8) HDR W !!?(45-$L(D3)\2),"***** ",D3," TOTAL *****"
"RTN","FHNO41",24,0)
 W !!,"   Qty  Item",?33,"Cost   Vehicle   Other   Total",!
"RTN","FHNO41",25,0)
 S (C(0),C(1))=0 F K=0:0 S K=$O(D(K)) Q:K<1  D:$Y>(IOSL-8) HDR S Y=^FH(118,K,0) D C3 S CT=$P(Y,"^",4)="Y",C(CT)=D(K)*C3+C(CT) W !,$J(D(K),6),"  ",$P(Y,"^",1),?31,$J(C3,6,2) W ?($S(CT:40,1:49)),$J(D(K)*C3,6,2),?57,$J(D(K)*C3,6,2)
"RTN","FHNO41",26,0)
 W !!?8,"Grand Total",?39,$J(C(1),7,2),?48,$J(C(0),7,2),?56,$J(C(0)+C(1),7,2)
"RTN","FHNO41",27,0)
Q3 W ! Q
"RTN","FHNO41",28,0)
Q4 D:$Y>(IOSL-8) HDR W !!,"--- ",$P(^FH(119.6,K,0),"^",1)," ---",?33,"Cost   Vehicle   Other   Total",!
"RTN","FHNO41",29,0)
 S C1=C1+1
"RTN","FHNO41",30,0)
 K FHDX1 S FHCX1(0)=0,FHCX1(1)=0,FHC3X1(1)=0
"RTN","FHNO41",31,0)
 F L=0:0 S L=$O(^FH(119.6,K,"BN",L)) Q:L<1  S X=^(L,0),X1=$P(X,"^",1),X2=$P(X,"^",2) I X1,$D(^FH(118,X1,0)) D:$Y>(IOSL-8) HDR D
"RTN","FHNO41",32,0)
 .W !,$J(X2,6),"  ",$P($G(^FH(118,X1,0)),"^",1) S:'$D(D(X1)) D(X1)=0 S:'$D(FHDX1(X1)) FHDX1(X1)=0 S D(X1)=D(X1)+X2,FHDX1(X1)=FHDX1(X1)+X2
"RTN","FHNO41",33,0)
 .D:$Y>(IOSL-8) HDR S Y=^FH(118,X1,0) D C3 S CT1=$P(Y,"^",4)="Y",FHCX1(CT1)=FHDX1(X1)*C3+FHCX1(CT1),FHC3X1(1)=FHC3X1(1)+C3
"RTN","FHNO41",34,0)
 .W ?31,$J(C3,6,2) W ?($S(CT1:40,1:49)),$J(FHDX1(X1)*C3,6,2),?57,$J(FHDX1(X1)*C3,6,2)
"RTN","FHNO41",35,0)
 D:$Y>(IOSL-8) HDR
"RTN","FHNO41",36,0)
 W !!,?8,"Total for ",$P($G(^FH(119.6,K,0)),"^",1),?39,$J(FHCX1(1),7,2),?48,$J(FHCX1(0),7,2),?56,$J(FHCX1(0)+FHCX1(1),7,2)
"RTN","FHNO41",37,0)
 Q
"RTN","FHNO41",38,0)
HDR ; Print Header
"RTN","FHNO41",39,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHNO41",40,0)
 S X="BULK NOURISHMENTS FOR: "_D3 W !?(80-$L(X)\2),X,?73,"Page ",PG,!!?32,DTP,! Q
"RTN","FHNO41",41,0)
L0 S S2=LAB=2*5+32,S1=$S(LAB=2:9,1:6),COUNT=0,LINE=1
"RTN","FHNO41",42,0)
 K D S C1=0
"RTN","FHNO41",43,0)
 F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1  F K=0:0 S K=$O(^TMP($J,P0,K)) Q:K<1  S WRD=$P(^FH(119.6,K,0),"^",1) F L=0:0 S L=$O(^FH(119.6,K,"BN",L)) Q:L<1  D L3
"RTN","FHNO41",44,0)
 I LAB>2 D DPLL^FHLABEL Q
"RTN","FHNO41",45,0)
 Q:'C1  S LN=6,X="BULK NOURISHMENTS PICK LIST" W !!?(S2-$L(X)\2),X
"RTN","FHNO41",46,0)
 S D3=$S('D1:"ALL SITES",1:$P(^FH(119.74,D1,0),"^",1)) W !!?(S2-$L(D3)\2),D3,!!
"RTN","FHNO41",47,0)
 F K=0:0 S K=$O(D(K)) Q:K<1  W !,$J(D(K),4),"  ",$P(^FH(118,K,0),"^",1) S LN=LN+1
"RTN","FHNO41",48,0)
 S LN=LN#S1 I LN F K=LN+1:1:S1 W !
"RTN","FHNO41",49,0)
 Q
"RTN","FHNO41",50,0)
L3 S X=^FH(119.6,K,"BN",L,0),X1=$P(X,"^",1),X2=$P(X,"^",2) Q:'X1!('$D(^FH(118,X1,0)))
"RTN","FHNO41",51,0)
 S:'$D(D(X1)) D(X1)=0 S D(X1)=D(X1)+X2,C1=C1+1
"RTN","FHNO41",52,0)
 S X1=^FH(118,X1,0),CHK=$P(X1,"^",2) Q:CHK="N"  S X1=$P(X1,"^",1)
"RTN","FHNO41",53,0)
 I LAB>2 D LL Q
"RTN","FHNO41",54,0)
 F C1=1:1:X2 W !!?(S2-$L(X1)\2),X1,!!,WRD,?(S2-$L(DTP)),DTP,!! W:LAB=2 !!!
"RTN","FHNO41",55,0)
 Q
"RTN","FHNO41",56,0)
C3 S C3=$P($G(^FH(114,+$P(Y,"^",7),0)),"^",13) Q
"RTN","FHNO41",57,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHNO41",58,0)
 Q
"RTN","FHNO41",59,0)
LL ;
"RTN","FHNO41",60,0)
 S FHCOL=$S(LAB=3:3,1:2)
"RTN","FHNO41",61,0)
 I LABSTART>1 F FHLABST=1:1:(LABSTART-1)*FHCOL D  S LABSTART=1
"RTN","FHNO41",62,0)
 .I LAB=3 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6)="" D LL3^FHLABEL
"RTN","FHNO41",63,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6,PCL7,PCL8)="" D LL4^FHLABEL
"RTN","FHNO41",64,0)
 .Q
"RTN","FHNO41",65,0)
 F C1=1:1:X2 D
"RTN","FHNO41",66,0)
 .S FHTAB=$S(LAB=3:24,1:37),SPC=$J(" ",70)
"RTN","FHNO41",67,0)
 .S LNA=$E(SPC,1,FHTAB-$L(X1)/2)_X1,LNB=WRD_$J(DTP,FHTAB+1-$L(WRD))
"RTN","FHNO41",68,0)
 .I LAB=3 S (PCL1,PCL2,PCL4,PCL6)="",PCL3=LNA,PCL5=LNB
"RTN","FHNO41",69,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL5,PCL7,PCL8)="",PCL4=LNA,PCL6=LNB
"RTN","FHNO41",70,0)
 .D:LAB=3 LL3^FHLABEL D:LAB=4 LL4^FHLABEL
"RTN","FHNO41",71,0)
 Q
"RTN","FHNO5")
0^46^B75252666
"RTN","FHNO5",1,0)
FHNO5 ; HISC/REL - Enter/Edit Supplemental Fdgs. ;7/27/94  14:45 
"RTN","FHNO5",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO5",3,0)
 ;patch #5 - add SF to outpatient.
"RTN","FHNO5",4,0)
 D NOW^%DTC S NOW=%
"RTN","FHNO5",5,0)
ASK K DIC,X,DFN,FHDFN,FHPTNM,Y S (FHMEAL,ADM,FHIDFLG,FHPNNSV)="",FHALL=1 D ^FHOMDPA
"RTN","FHNO5",6,0)
 G:'FHDFN KIL
"RTN","FHNO5",7,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHNO5",8,0)
 I WARD="" D SFOUT G ASK
"RTN","FHNO5",9,0)
 K ADM
"RTN","FHNO5",10,0)
A0 W !!,"Return for OUTPATIENT or 'C' for CURRENT Admission: " R X:DTIME G:X["^" KIL D:X="c" TR^FH
"RTN","FHNO5",11,0)
 I (X="")&'($D(^FHPT(FHDFN,"OP"))) G ASK
"RTN","FHNO5",12,0)
 I (X="") D SFOUT G ASK
"RTN","FHNO5",13,0)
 I WARD'="",X="C" S ADM=$G(^DPT("CN",WARD,DFN)) G:$G(ADM) S0
"RTN","FHNO5",14,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="EQM" D ^DIC G:Y<1 A0 S ADM=+Y
"RTN","FHNO5",15,0)
 G:'$G(ADM) ASK
"RTN","FHNO5",16,0)
 D S0
"RTN","FHNO5",17,0)
 G ASK
"RTN","FHNO5",18,0)
S0 D LIS^FHNO7 S PNO=Y
"RTN","FHNO5",19,0)
SFA K DIC S FHNNSV="",DIC="^FH(118.1,",DIC(0)="EQM",OLD=$S('NM:"",1:$P(^FH(118.1,NM,0),"^",1))
"RTN","FHNO5",20,0)
 W !!,"Supplemental Feeding Menu: " W:NM OLD," // " R X:DTIME
"RTN","FHNO5",21,0)
 G KIL:'$T Q:X["^"
"RTN","FHNO5",22,0)
 S FHNMSAV=NM
"RTN","FHNO5",23,0)
 S FHXSAV=X
"RTN","FHNO5",24,0)
 I X="" Q:'NM  G S1
"RTN","FHNO5",25,0)
 I X="@" D CAN W "  .. cancelled" Q
"RTN","FHNO5",26,0)
 D ^DIC K DIC G SFA:Y<1 S NM=+Y
"RTN","FHNO5",27,0)
 S FHNMSAV=NM
"RTN","FHNO5",28,0)
S1 Q:'NM
"RTN","FHNO5",29,0)
 S KK=1,PNN="^"_NOW_"^"_DUZ_"^"_NM_"^"_$S(NM=1:$P(PNO,"^",5,29),1:^FH(118.1,NM,1))
"RTN","FHNO5",30,0)
 I WARD="" D   ;if outpatient, only allow SF for specific meal.
"RTN","FHNO5",31,0)
 .S T1=$S(FHMEAL="B":"10am",FHMEAL="N":"2pm",1:"8pm")
"RTN","FHNO5",32,0)
 .S KK=$S(FHMEAL="B":1,FHMEAL="N":5,1:9)
"RTN","FHNO5",33,0)
 .S FHKK9=$S(FHMEAL="B":5,FHMEAL="N":14,1:23)
"RTN","FHNO5",34,0)
 I NM=1,WARD="" D OIS^FHNO7,CAN S FHSFQT9=$P(FHPNNSV,"^",FHKK9,FHKK9+6),PNN=FHPNNSV G:"^^^^^^^^"'[FHSFQT9 ADD
"RTN","FHNO5",35,0)
 I NM'=1 G UPD:$P(PNO,"^",4,29)=$P(PNN,"^",4,29) D CAN G ADD
"RTN","FHNO5",36,0)
 S DIC="^FH(118,",DIC(0)="EQM",DIC("S")="I $P(^(0),U,3)'=""Y"""
"RTN","FHNO5",37,0)
G1 G:KK>12 G5
"RTN","FHNO5",38,0)
 I ((WARD="")&(FHMEAL="B")&(KK>4))!((WARD="")&(FHMEAL="N")&(KK>8)) G G5
"RTN","FHNO5",39,0)
 I WARD'="" S T1=$P("10am^2pm^8pm","^",KK-1\4+1)
"RTN","FHNO5",40,0)
 S T2="#"_(KK-1#4+1),P1=KK*2+3
"RTN","FHNO5",41,0)
 S DIC("A")=T1_" Feeding "_T2_": "
"RTN","FHNO5",42,0)
 S OLD=$P(PNN,"^",P1) I OLD S DIC("A")=DIC("A")_$P(^FH(118,+OLD,0),"^",1)_"// "
"RTN","FHNO5",43,0)
G2 W !!,DIC("A") R X:DTIME G:'$T!(X["^") G5
"RTN","FHNO5",44,0)
 I X="" G:OLD G3 S KK=$S(KK<5:5,KK<9:9,1:13) G G1
"RTN","FHNO5",45,0)
 I OLD,X="@" S $P(PNN,"^",P1)="",$P(PNN,"^",P1+1)="" S KK=KK+1 G G1
"RTN","FHNO5",46,0)
 D ^DIC G:Y<1 G2 S Y=+Y,K1=$S(KK<5:1,KK<9:5,1:9)
"RTN","FHNO5",47,0)
 F L=K1:1:K1+3 I L'=KK,$P(PNN,"^",L*2+3)=Y W *7," .. DUPLICATE OF EXISTING ITEM!" G G2
"RTN","FHNO5",48,0)
 S:OLD'=Y $P(PNN,"^",P1)=Y
"RTN","FHNO5",49,0)
G3 S OLD=$P(PNN,"^",P1+1)
"RTN","FHNO5",50,0)
G4 W !,T1," ",T2," Qty: ",$S(OLD="":1,1:OLD),"// " R X:DTIME G:'$T!(X["^") G5
"RTN","FHNO5",51,0)
 S:X="@" X=0 I X="" S:OLD="" $P(PNN,"^",P1+1)=1 S KK=KK+1 G G1
"RTN","FHNO5",52,0)
 I X'?1N.N!(X>20) W *7," ??" S X="?"
"RTN","FHNO5",53,0)
 I X["?" W !?5,"Enter a whole number between 1 and 20" G G4
"RTN","FHNO5",54,0)
 I 'X S $P(PNN,"^",P1)="",$P(PNN,"^",P1+1)="" S KK=KK+1 G G1
"RTN","FHNO5",55,0)
 S $P(PNN,"^",P1+1)=X,KK=KK+1 G G1
"RTN","FHNO5",56,0)
G5 S KK=3,X="" F T1=0:1:2 S P1=T1*8-1 F T2=1:1:4 S KK=KK+2 I $P(PNN,"^",KK) S P1=P1+2,$P(X,"^",P1,P1+1)=$P(PNN,"^",KK,KK+1)
"RTN","FHNO5",57,0)
 I X="" D CAN Q
"RTN","FHNO5",58,0)
G6 Q:WARD=""
"RTN","FHNO5",59,0)
 S P1=$P(PNN,"^",29) S:P1="" P1="D" W !!,"Dietary or Therapeutic? ",P1,"// " R Y:DTIME S:'$T!("^"[Y) Y=P1
"RTN","FHNO5",60,0)
 S:$P("dietary",Y,1)="" Y="D" S:$P("therapeutic",Y,1)="" Y="T"
"RTN","FHNO5",61,0)
 I $P("DIETARY",Y,1)'="",$P("THERAPEUTIC",Y,1)'="" W *7,!?5," Answer D for Dietary use or T for Therapeutic use" G G6
"RTN","FHNO5",62,0)
 S $P(X,"^",25)=$E(Y,1),PNN=$P(PNN,"^",1,4)_"^"_X
"RTN","FHNO5",63,0)
 G:$P(PNO,"^",5,29)=X UPD D CAN
"RTN","FHNO5",64,0)
ADD ; Add SF
"RTN","FHNO5",65,0)
 Q:'$D(WARD)
"RTN","FHNO5",66,0)
 I WARD="" G ADDOUT
"RTN","FHNO5",67,0)
 L +^FHPT(FHDFN,"A",ADM,"SF",0)
"RTN","FHNO5",68,0)
 I '$D(^FHPT(FHDFN,"A",ADM,"SF",0)) S ^FHPT(FHDFN,"A",ADM,"SF",0)="^115.07^^"
"RTN","FHNO5",69,0)
 S X=^FHPT(FHDFN,"A",ADM,"SF",0),NO=$P(X,"^",3)+1,^(0)=$P(X,"^",1,2)_"^"_NO_"^"_($P(X,"^",4)+1)
"RTN","FHNO5",70,0)
 L -^FHPT(FHDFN,"A",ADM,"SF",0) I $D(^FHPT(FHDFN,"A",ADM,"SF",NO)) G ADD
"RTN","FHNO5",71,0)
 S ^FHPT(FHDFN,"A",ADM,"SF",NO,0)=NO_"^"_$P(PNN,"^",2,99)
"RTN","FHNO5",72,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",7)=NO
"RTN","FHNO5",73,0)
 I NO'="" S EVT="F^O^"_NO D ^FHORX
"RTN","FHNO5",74,0)
UPD Q:'$D(WARD)  I WARD="" G UPDOUT
"RTN","FHNO5",75,0)
 S:NO $P(^FHPT(FHDFN,"A",ADM,"SF",NO,0),"^",30,31)=NOW_"^"_DUZ
"RTN","FHNO5",76,0)
 Q
"RTN","FHNO5",77,0)
CAN ; Cancel SF
"RTN","FHNO5",78,0)
 Q:'$D(WARD)
"RTN","FHNO5",79,0)
 I WARD="" G CANOUT
"RTN","FHNO5",80,0)
 S NO=$P(^FHPT(FHDFN,"A",ADM,0),"^",7),$P(^(0),"^",7)=""
"RTN","FHNO5",81,0)
 S:NO $P(^FHPT(FHDFN,"A",ADM,"SF",NO,0),"^",32,33)=NOW_"^"_DUZ
"RTN","FHNO5",82,0)
 I NO'="" S EVT="F^C^"_NO D ^FHORX
"RTN","FHNO5",83,0)
 Q
"RTN","FHNO5",84,0)
SFOUT ;outpt SF
"RTN","FHNO5",85,0)
 K FHSFLG,FHNMSAV,FHXSAV,X,OLD,FHLOC,FHLOCN
"RTN","FHNO5",86,0)
 D SF^FHNO7
"RTN","FHNO5",87,0)
 I '$G(FHSFLG) W !,"NO OUTPATIENT DATA ON FILE for today's date and the future!!" Q
"RTN","FHNO5",88,0)
 D ASK0
"RTN","FHNO5",89,0)
 Q
"RTN","FHNO5",90,0)
ASK0 ;ask Rec Meal
"RTN","FHNO5",91,0)
 K FHDM14,FHFLG,FHCK,FHDMIEN,FHIEN
"RTN","FHNO5",92,0)
 S (FHTOTML("B"),FHTOTML("N"),FHTOTML("E"),FHTOTML("A"))=0
"RTN","FHNO5",93,0)
 F FHI=DT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:FHI'>0  F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0  D
"RTN","FHNO5",94,0)
 .S FHOPDAT=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHNO5",95,0)
 .Q:$P(FHOPDAT,U,15)="C"
"RTN","FHNO5",96,0)
 .S FHML=$P(FHOPDAT,U,4)
"RTN","FHNO5",97,0)
 .S FHN=0
"RTN","FHNO5",98,0)
 .S:FHML="B" FHN=1
"RTN","FHNO5",99,0)
 .S:FHML="N" FHN=2
"RTN","FHNO5",100,0)
 .S:FHML="E" FHN=3
"RTN","FHNO5",101,0)
 .S FHDM14(FHI,FHN,FHML)=FHI_U_FHJ
"RTN","FHNO5",102,0)
 F FHI=0:0 S FHI=$O(FHDM14(FHI)) Q:FHI'>0  D
"RTN","FHNO5",103,0)
 .F FHN=1,2,3 Q:FHN=""  F FHJ="B","N","E" Q:FHJ=""  D
"RTN","FHNO5",104,0)
 ..I (FHJ="B")&$D(FHDM14(FHI,FHN,FHJ)) S FHTOTML("B")=FHTOTML("B")+1,(FHDMIEN(FHI,FHJ),FHIEN(FHJ))=FHDM14(FHI,FHN,FHJ)
"RTN","FHNO5",105,0)
 ..I (FHJ="N")&$D(FHDM14(FHI,FHN,FHJ)) S FHTOTML("N")=FHTOTML("N")+1,(FHDMIEN(FHI,FHJ),FHIEN(FHJ))=FHDM14(FHI,FHN,FHJ)
"RTN","FHNO5",106,0)
 ..I (FHJ="E")&$D(FHDM14(FHI,FHN,FHJ)) S FHTOTML("E")=FHTOTML("E")+1,(FHDMIEN(FHI,FHJ),FHIEN(FHJ))=FHDM14(FHI,FHN,FHJ)
"RTN","FHNO5",107,0)
 Q:'$D(FHDM14)
"RTN","FHNO5",108,0)
R1 S (FHCNSFF,FHADSFF)=0,(FHLOCN,FHSFMEN)="",(FH1,FHQ,FHDTC)=0,(FHDTML,FHX)="" R !!,"Enter a Meal (B,N,E or ALL): ALL// ",FHDTML:DTIME
"RTN","FHNO5",109,0)
 Q:'$T!(FHDTML["^")
"RTN","FHNO5",110,0)
 S:FHDTML="" FHDTML="ALL"
"RTN","FHNO5",111,0)
 I FHDTML["?" S FHQ=1 G MS1
"RTN","FHNO5",112,0)
 S X=FHDTML D TR^FH S (FHX,FHDTML)=X
"RTN","FHNO5",113,0)
 I FHDTML="A" S FHQ=1 G MS1
"RTN","FHNO5",114,0)
 S FHALML=FHX
"RTN","FHNO5",115,0)
 I FHDTML="ALL" S FHDTML=$E(FHDTML,1),FHALML="BNE"
"RTN","FHNO5",116,0)
 I $L(FHDTML)=3 S:("BNE")'[$E(FHDTML,1) FHQ=1 S:("BNE")'[$E(FHDTML,2) FHQ=1 S:("BNE")'[$E(FHDTML,3) FHQ=1 S FHCK($E(FHDTML,1))="",FHCK($E(FHDTML,2))="",FHCK($E(FHDTML,3))=""
"RTN","FHNO5",117,0)
 I $L(FHDTML)=2 S:("BNE")'[$E(FHDTML,1) FHQ=1 S:("BNE")'[$E(FHDTML,2) FHQ=1 S FHCK($E(FHDTML,1))="",FHCK($E(FHDTML,2))=""
"RTN","FHNO5",118,0)
 I $L(FHDTML)=1 S:("ABNE")'[$E(FHDTML,1) FHQ=1 S FHCK(FHDTML)=""
"RTN","FHNO5",119,0)
 I FHDTML="A" S (FHCK("B"),FHCK("N"),FHCK("E"))=""
"RTN","FHNO5",120,0)
 S:$L(FHDTML)>3 FHQ=1
"RTN","FHNO5",121,0)
 G:FHQ MS1
"RTN","FHNO5",122,0)
 I $L(FHDTML)=3 S:'$G(FHTOTML($E(FHDTML,1))) FH1=1 S:'$G(FHTOTML($E(FHDTML,2))) FH1=1 S:'$G(FHTOTML($E(FHDTML,3))) FH1=1 I FH1 W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHNO5",123,0)
 I $L(FHDTML)=2 S:'$G(FHTOTML($E(FHDTML,1))) FH1=1 S:'$G(FHTOTML($E(FHDTML,2))) FH1=1 I FH1 W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHNO5",124,0)
MS1 I FHQ W *7,!,"Select B for Breakfast, N for Noon, E for Evening or ALL for all meals",!,"Answer may be multiple meals, e.g., BN or NE" G R1
"RTN","FHNO5",125,0)
 S:$L(FHDTML)>1 FHDTML="A"
"RTN","FHNO5",126,0)
 S (FHFLG,FHLIS)=0
"RTN","FHNO5",127,0)
 I (FHDTML'="A"),(FHTOTML(FHDTML)'>0) W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHNO5",128,0)
 I FHDTML'="A",(FHTOTML(FHDTML)=1) F FHI=DT-1:0 S FHI=$O(FHDMIEN(FHI)) G:FHI'>0 EVNT I $D(FHDMIEN(FHI,FHDTML)) S FHDMDAT=FHDMIEN(FHI,FHDTML) D PR1
"RTN","FHNO5",129,0)
 I FHDTML'="A",(FHTOTML(FHDTML)>1) D CHK^FHSPED
"RTN","FHNO5",130,0)
 I 'FHFLG,FHDTML="A" G ALL
"RTN","FHNO5",131,0)
 I $G(FHFLG) F FHI=FHDT1-1:0 S FHI=$O(FHDM14(FHI)) G:(FHI'>0)!(FHI>FHDT2) EVNT F FHN=1,2,3 Q:FHN=""  I $D(FHDM14(FHI,FHN,FHDTML)) S FHDMDAT=FHDM14(FHI,FHN,FHDTML) D PR1
"RTN","FHNO5",132,0)
 Q
"RTN","FHNO5",133,0)
ALL S FHCT=0,(FHDT1,FHDT2,FHDTSV)=DT
"RTN","FHNO5",134,0)
 F FHI=DT-1:0 S FHI=$O(FHDM14(FHI)) S:'FHI FHDT2=FHDTSV Q:FHI'>0  S FHCT=FHCT+1,FHDTSV=FHI S:FHCT=1 FHDT1=FHI F FHN=1,2,3 Q:FHN=""  D
"RTN","FHNO5",135,0)
 .S FHJ="" F  S FHJ=$O(FHDM14(FHI,FHN,FHJ)) Q:FHJ=""  I $D(FHDM14(FHI,FHN,FHJ)) S FHDMDAT=FHDM14(FHI,FHN,FHJ) D PR1
"RTN","FHNO5",136,0)
 ;
"RTN","FHNO5",137,0)
EVNT S:'$D(FHDTP) FHDTP=""
"RTN","FHNO5",138,0)
 I $D(FHDT1) S DTP=FHDT1 D DTP^FH S FHDTP=DTP
"RTN","FHNO5",139,0)
 I $D(FHDT2) S DTP=FHDT2 D DTP^FH S:FHDTP'=DTP FHDTP=FHDTP_" to "_DTP
"RTN","FHNO5",140,0)
 I FHCNSFF=1 S FHACT="C",FHTXT="Outpatient Supplemental Feeding:  ("_FHALML_") , "_FHLOCN_", Cancelled "_FHDTP D OPFILE^FHORX
"RTN","FHNO5",141,0)
 I FHADSFF=1 S FHACT="O",FHTXT="Outpatient Supplemental Feeding: "_FHSFMEN_" ("_FHALML_") , "_FHLOCN_", "_FHDTP D OPFILE^FHORX
"RTN","FHNO5",142,0)
 Q
"RTN","FHNO5",143,0)
PR1 S FHDTE=$P(FHDMDAT,U,1),ADM=$P(FHDMDAT,U,2)
"RTN","FHNO5",144,0)
 I '$G(^FHPT(FHDFN,"OP",ADM,0)) Q
"RTN","FHNO5",145,0)
 S FHDTC=FHDTC+1,DTP=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,1) D DTP^FH S:FHDTC=1 FHDTP=DTP
"RTN","FHNO5",146,0)
 S FHMEAL=$P(^FHPT(FHDFN,"OP",ADM,0),U,4)
"RTN","FHNO5",147,0)
 I $G(FHIDFLG) D CAN S PNN=FHPNNSV,FHKK9=$S(FHMEAL="B":5,FHMEAL="N":14,1:23) S FHSFQT9=$P(FHPNNSV,"^",FHKK9,FHKK9+6) G:"^^^^^^^^"'[FHSFQT9 ADD Q
"RTN","FHNO5",148,0)
 S (PNO,WARD,FHLOCN,FHSFMEN)=""
"RTN","FHNO5",149,0)
 S FHLOC=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,3) S:$G(FHLOC) FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHNO5",150,0)
 I $D(FHXSAV),FHXSAV="@" D CAN W !,"  .. cancelled" Q
"RTN","FHNO5",151,0)
 I $D(X),X="^" Q
"RTN","FHNO5",152,0)
 I $D(FHNMSAV),FHNMSAV'="" D S1 Q
"RTN","FHNO5",153,0)
 D CAD
"RTN","FHNO5",154,0)
 D LIS^FHNO7 S PNO=Y
"RTN","FHNO5",155,0)
 I $G(FHLIS),$G(NO) S PNO=^FHPT(FHDFN,"OP",ADM,"SF",NO,0)
"RTN","FHNO5",156,0)
 I '$G(FHLIS) D SFA S FHLIS=FHLIS+1 Q
"RTN","FHNO5",157,0)
 I $G(FHLIS) S NM=FHNMSAV D S1
"RTN","FHNO5",158,0)
 Q
"RTN","FHNO5",159,0)
CAD ;
"RTN","FHNO5",160,0)
 S FHCFLG=""
"RTN","FHNO5",161,0)
 S NO=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",0)),"^",3)
"RTN","FHNO5",162,0)
 I NO S FHCFLG=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",NO,0)),"^",32)
"RTN","FHNO5",163,0)
 Q
"RTN","FHNO5",164,0)
ADDOUT ; Add outpt SF
"RTN","FHNO5",165,0)
 S FHMEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4),FHSFMEN=""
"RTN","FHNO5",166,0)
 L +^FHPT(FHDFN,"OP",ADM,"SF",0)
"RTN","FHNO5",167,0)
 I '$D(^FHPT(FHDFN,"OP",ADM,"SF",0)) S ^FHPT(FHDFN,"OP",ADM,"SF",0)="^115.1627^^"
"RTN","FHNO5",168,0)
 S X=^FHPT(FHDFN,"OP",ADM,"SF",0),NO=$P(X,"^",3)+1,^(0)=$P(X,"^",1,2)_"^"_NO_"^"_($P(X,"^",4)+1)
"RTN","FHNO5",169,0)
 L -^FHPT(FHDFN,"OP",ADM,"SF",0) I $D(^FHPT(FHDFN,"OP",ADM,"SF",NO)) G ADDOUT
"RTN","FHNO5",170,0)
 I FHMEAL="B" S $P(PNN,U,13,20)="^^^^^^^",$P(PNN,U,21,28)="^^^^^^^"
"RTN","FHNO5",171,0)
 I FHMEAL="N" S $P(PNN,U,5,12)="^^^^^^^",$P(PNN,U,21,28)="^^^^^^^"
"RTN","FHNO5",172,0)
 I FHMEAL="E" S $P(PNN,U,5,12)="^^^^^^^",$P(PNN,U,13,20)="^^^^^^^"
"RTN","FHNO5",173,0)
 S ^FHPT(FHDFN,"OP",ADM,"SF",NO,0)=NO_"^"_$P(PNN,"^",2,99)
"RTN","FHNO5",174,0)
 S:$G(FHNMSAV) FHSFMEN=$P($G(^FH(118.1,FHNMSAV,0)),U,1)
"RTN","FHNO5",175,0)
 S FHADSFF=1
"RTN","FHNO5",176,0)
UPDOUT S:NO $P(^FHPT(FHDFN,"OP",ADM,"SF",NO,0),"^",30,31)=NOW_"^"_DUZ
"RTN","FHNO5",177,0)
 Q
"RTN","FHNO5",178,0)
CANOUT ; Cancel outpt SF
"RTN","FHNO5",179,0)
 S NO=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",0)),"^",3)
"RTN","FHNO5",180,0)
 S:NO $P(^FHPT(FHDFN,"OP",ADM,"SF",NO,0),"^",32,33)=NOW_"^"_DUZ
"RTN","FHNO5",181,0)
 S FHCNSFF=1
"RTN","FHNO5",182,0)
 Q
"RTN","FHNO5",183,0)
KIL G KILL^XUSCLEAN
"RTN","FHNO6")
0^49^B67398732
"RTN","FHNO6",1,0)
FHNO6 ; HISC/REL/NCA - Supplemental Feeding Costs ;2/13/95  13:32 
"RTN","FHNO6",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO6",3,0)
 ;3/7/06 -P5- added outpatient SFs.
"RTN","FHNO6",4,0)
 W @IOF,!!?27,"SUPPLEMENTAL FEEDING COSTS",!!
"RTN","FHNO6",5,0)
D0 R !!,"Select by S=SUPPLEMENTAL FEEDING SITE or W=WARD: ",XX:DTIME G:'$T!("^"[XX) KIL
"RTN","FHNO6",6,0)
 I XX'?1U!("SW"'[XX) W *7," Enter S or W" G D0
"RTN","FHNO6",7,0)
 I XX="S" S WRD=$O(^FH(119.74,0)) I WRD'<1,$O(^FH(119.74,WRD))<1 G S0
"RTN","FHNO6",8,0)
 I XX="W" S WRD=$O(^FH(119.6,0)) I WRD'<1,$O(^FH(119.6,WRD))<1 G S0
"RTN","FHNO6",9,0)
 I XX="S" G D2
"RTN","FHNO6",10,0)
F1 R !!,"Select WARD (or ALL): ",X:DTIME G:'$T!("^"[X) KIL I X="ALL" S WRD=0
"RTN","FHNO6",11,0)
 E  K DIC S DIC="^FH(119.6,",DIC(0)="EQM" D ^DIC G:Y<1 F1 S WRD=+Y
"RTN","FHNO6",12,0)
 G S0
"RTN","FHNO6",13,0)
D2 R !!,"Select SUPPLEMENTAL FEEDING SITE (or ALL): ",X:DTIME G:'$T!("^"[X) KIL I X="ALL" S WRD=0
"RTN","FHNO6",14,0)
 I X'="ALL" K DIC S DIC="^FH(119.74,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S WRD=+Y
"RTN","FHNO6",15,0)
S0 S X="N" I 'WRD R !!,"SUMMARY only? Y// ",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G S0
"RTN","FHNO6",16,0)
 S SUM=X?1"Y".E
"RTN","FHNO6",17,0)
L0 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHNO6",18,0)
 I $D(IO("Q")) S FHPGM="Q1^FHNO6",FHLST="XX^WRD^SUM" D EN2^FH G KIL
"RTN","FHNO6",19,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHNO6",20,0)
Q1 ; Print Supplemental Feeding Cost Report
"RTN","FHNO6",21,0)
 S (FHSUMHD,FHSUM)=0 D NOW^%DTC S DTP=% D DTP^FH S PTIM=DTP,PG=0 K ^TMP($J)
"RTN","FHNO6",22,0)
 I 'SUM,'WRD S FHSUM=1
"RTN","FHNO6",23,0)
 F KK=0:0 S KK=$O(^FH(119.6,KK)) Q:KK<1  S X0=$G(^(KK,0)) D
"RTN","FHNO6",24,0)
 .I XX="W",WRD,WRD'=KK Q
"RTN","FHNO6",25,0)
 .I XX="S",WRD,$P(X0,"^",9)'=WRD Q
"RTN","FHNO6",26,0)
 .S P0=$P(X0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0),TNOD=$S(SUM:"0",XX="S":"99~"_$P($G(^FH(119.74,+$P(X0,"^",9),0)),"^",1),1:P0_"~"_$P(X0,"^",1))
"RTN","FHNO6",27,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",KK,FHDFN)) Q:FHDFN<1  S ADM=$G(^FHPT("AW",KK,FHDFN)) I ADM>0 D
"RTN","FHNO6",28,0)
 ..S $P(^TMP($J,"T",TNOD,0),"^",1)=$P($G(^TMP($J,"T",TNOD,0)),"^",1)+1
"RTN","FHNO6",29,0)
 ..I FHSUM S $P(^TMP($J,"FH","GRAND TOTAL",0),"^",1)=$P($G(^TMP($J,"FH","GRAND TOTAL",0)),"^",1)+1
"RTN","FHNO6",30,0)
 ..S (NO,Y)="" I $D(^FHPT(FHDFN,"A",ADM,0)) S NO=$P(^(0),"^",7)
"RTN","FHNO6",31,0)
 ..Q:'NO  S Y=$G(^FHPT(FHDFN,"A",ADM,"SF",NO,0))
"RTN","FHNO6",32,0)
 ..S PD=$P(Y,"^",29) S:PD="" PD="D"
"RTN","FHNO6",33,0)
 ..S $P(^TMP($J,"T",TNOD,0),"^",PD'="D"+2)=$P(^TMP($J,"T",TNOD,0),"^",PD'="D"+2)+1
"RTN","FHNO6",34,0)
 ..I FHSUM S $P(^TMP($J,"FH","GRAND TOTAL",0),"^",PD'="D"+2)=$P(^TMP($J,"FH","GRAND TOTAL",0),"^",PD'="D"+2)+1
"RTN","FHNO6",35,0)
 ..F L=5:2:28 S Z=$P(Y,"^",L),Q=$P(Y,"^",L+1) I Z'="" S:'Q Q=1 S:'$D(^TMP($J,"T",TNOD,Z,PD)) ^TMP($J,"T",TNOD,Z,PD)=0 S ^(PD)=^(PD)+Q I FHSUM D
"RTN","FHNO6",36,0)
 ...S:'$D(^TMP($J,"FH","GRAND TOTAL",Z,PD)) ^TMP($J,"FH","GRAND TOTAL",Z,PD)=0 S ^(PD)=^(PD)+Q
"RTN","FHNO6",37,0)
 ..Q
"RTN","FHNO6",38,0)
 .Q
"RTN","FHNO6",39,0)
 ;
"RTN","FHNO6",40,0)
 S NAM="" F  S NAM=$O(^FH(118,"B",NAM)) Q:NAM=""  F Z=0:0 S Z=$O(^FH(118,"B",NAM,Z)) Q:Z<1  I $O(^(Z,0))="" S REC=$P($G(^FH(118,Z,0)),"^",7),CU=$P($G(^FH(114,+REC,0)),"^",13),^TMP($J,"P",NAM_"~"_Z)=CU
"RTN","FHNO6",41,0)
 S TNOD="" F  S TNOD=$O(^TMP($J,"T",TNOD)) Q:TNOD=""  D
"RTN","FHNO6",42,0)
 .S FHOUT=0
"RTN","FHNO6",43,0)
 .Q:$O(^TMP($J,"T",TNOD,0))=""  D HDR S (T1,T2)=0
"RTN","FHNO6",44,0)
 .S NAM="" F  S NAM=$O(^TMP($J,"P",NAM)) Q:NAM=""  S CU=^(NAM) D
"RTN","FHNO6",45,0)
 ..S Z=$P(NAM,"~",2) I '$D(^TMP($J,"T",TNOD,Z)) Q
"RTN","FHNO6",46,0)
 ..S A1=$G(^TMP($J,"T",TNOD,Z,"D")),A2=$G(^("T")),T1=A1*CU+T1,T2=A2*CU+T2 D:$Y>(IOSL-8) HDR
"RTN","FHNO6",47,0)
 ..W !,$E($P(NAM,"~",1),1,24),?25,$J(CU,7,3),$J(A1,7),$J(A1*CU,8,2),$J(A2,8),$J(A2*CU,8,2),$J(A1+A2,8),$J(A1+A2*CU,8,2) Q
"RTN","FHNO6",48,0)
 .D:$Y>(IOSL-13) HDR W !!,"Total",?39,$J(T1,8,2),$J(T2,16,2),$J(T1+T2,16,2)
"RTN","FHNO6",49,0)
 .S CTR=$G(^TMP($J,"T",TNOD,0)),WP=$P(CTR,"^",1),WPD=$P(CTR,"^",2),WPT=$P(CTR,"^",3)
"RTN","FHNO6",50,0)
 .W !!,"Cost/Patient:",?32,$J(WP,7),?39,$J(T1/WP,8,2),?47,$J(WP,8),?55,$J(T2/WP,8,2),?63,$J(WP,8),?71,$J(T1+T2/WP,8,2)
"RTN","FHNO6",51,0)
 .W !,"Cost/Recipient:" W:WPD ?32,$J(WPD,7),?39,$J(T1/WPD,8,2) W:WPT ?47,$J(WPT,8),?55,$J(T2/WPT,8,2) W:(WPD+WPT) ?63,$J(WPD+WPT,8),?71,$J(T1+T2/(WPD+WPT),8,2)
"RTN","FHNO6",52,0)
 .W !!,"Recipient %:" W:WPD ?39,$J(WPD/WP*100,8,0) W:WPT ?55,$J(WPT/WP*100,8,0) W:(WPD+WPT) ?71,$J(WPD+WPT/WP*100,8,0) W ! Q
"RTN","FHNO6",53,0)
 I FHSUM D GRD
"RTN","FHNO6",54,0)
 ;
"RTN","FHNO6",55,0)
SFO ;process outpt SFs.
"RTN","FHNO6",56,0)
 K ^TMP($J) S (FHSUM,FHSUMHD)=0
"RTN","FHNO6",57,0)
 S FHDFNSV="",FHOUT=1
"RTN","FHNO6",58,0)
 I 'SUM,'WRD S FHSUM=1
"RTN","FHNO6",59,0)
 F FHI=DT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:(FHI'>0)!(FHI>DT)  F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHI,FHDFN)) Q:FHDFN'>0  D
"RTN","FHNO6",60,0)
 .F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0  I ($P($G(^FHPT(FHDFN,"OP",FHJ,0)),U,15)'="C") D
"RTN","FHNO6",61,0)
 ..S FHDA15=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHNO6",62,0)
 ..S FHMEAL=$P(FHDA15,U,4),FHLOC=$P(FHDA15,U,3) Q:'$G(FHLOC)
"RTN","FHNO6",63,0)
 ..S FHLOX0=$G(^FH(119.6,FHLOC,0))
"RTN","FHNO6",64,0)
 ..I XX="W",WRD,WRD'=FHLOC Q
"RTN","FHNO6",65,0)
 ..I XX="S",WRD,$P(FHLOX0,"^",9)'=WRD Q
"RTN","FHNO6",66,0)
 ..S P0=$P(FHLOX0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0),TNOD=$S(SUM:"0",XX="S":"99~"_$P($G(^FH(119.74,+$P(FHLOX0,"^",9),0)),"^",1),1:P0_"~"_$P(FHLOX0,"^",1))
"RTN","FHNO6",67,0)
 ..;I FHDFNSV'=FHDFN S $P(^TMP($J,"T",TNOD,0),"^",1)=$P($G(^TMP($J,"T",TNOD,0)),"^",1)+1
"RTN","FHNO6",68,0)
 ..S $P(^TMP($J,"T",TNOD,0),"^",1)=$P($G(^TMP($J,"T",TNOD,0)),"^",1)+1
"RTN","FHNO6",69,0)
 ..I FHSUM S $P(^TMP($J,"FH","GRAND TOTAL",0),"^",1)=$P($G(^TMP($J,"FH","GRAND TOTAL",0)),"^",1)+1
"RTN","FHNO6",70,0)
 ..S:$D(^FHPT(FHDFN,"OP",FHJ,"SF",0)) FHSF=$P(^FHPT(FHDFN,"OP",FHJ,"SF",0),U,3)
"RTN","FHNO6",71,0)
 ..Q:'$G(FHSF)
"RTN","FHNO6",72,0)
 ..S FHDA15SF=$G(^FHPT(FHDFN,"OP",FHJ,"SF",FHSF,0))
"RTN","FHNO6",73,0)
 ..Q:$P(FHDA15SF,U,32)
"RTN","FHNO6",74,0)
 ..S PD=$P(FHDA15SF,"^",29) S:PD="" PD="D"
"RTN","FHNO6",75,0)
 ..;S $P(^TMP($J,"T",TNOD,0),"^",1)=$P($G(^TMP($J,"T",TNOD,0)),"^",1)+1
"RTN","FHNO6",76,0)
 ..S $P(^TMP($J,"T",TNOD,0),"^",PD'="D"+2)=$P(^TMP($J,"T",TNOD,0),"^",PD'="D"+2)+1
"RTN","FHNO6",77,0)
 ..I FHSUM S $P(^TMP($J,"FH","GRAND TOTAL",0),"^",PD'="D"+2)=$P(^TMP($J,"FH","GRAND TOTAL",0),"^",PD'="D"+2)+1
"RTN","FHNO6",78,0)
 ..F L=5:2:28 S Z=$P(FHDA15SF,"^",L),Q=$P(FHDA15SF,"^",L+1) I Z'="" S:'Q Q=1 S:'$D(^TMP($J,"T",TNOD,Z,PD)) ^TMP($J,"T",TNOD,Z,PD)=0 S ^(PD)=^(PD)+Q I FHSUM D
"RTN","FHNO6",79,0)
 ...S:'$D(^TMP($J,"FH","GRAND TOTAL",Z,PD)) ^TMP($J,"FH","GRAND TOTAL",Z,PD)=0 S ^(PD)=^(PD)+Q
"RTN","FHNO6",80,0)
 ..S FHDFNSV=FHDFN
"RTN","FHNO6",81,0)
 ;
"RTN","FHNO6",82,0)
 S NAM="" F  S NAM=$O(^FH(118,"B",NAM)) Q:NAM=""  F Z=0:0 S Z=$O(^FH(118,"B",NAM,Z)) Q:Z<1  I $O(^(Z,0))="" S REC=$P($G(^FH(118,Z,0)),"^",7),CU=$P($G(^FH(114,+REC,0)),"^",13),^TMP($J,"P",NAM_"~"_Z)=CU
"RTN","FHNO6",83,0)
 S TNOD="" F  S TNOD=$O(^TMP($J,"T",TNOD)) Q:TNOD=""  D
"RTN","FHNO6",84,0)
 .Q:$O(^TMP($J,"T",TNOD,0))=""  D HDR S (T1,T2)=0
"RTN","FHNO6",85,0)
 .S NAM="" F  S NAM=$O(^TMP($J,"P",NAM)) Q:NAM=""  S CU=^(NAM) D
"RTN","FHNO6",86,0)
 ..S Z=$P(NAM,"~",2) I '$D(^TMP($J,"T",TNOD,Z)) Q
"RTN","FHNO6",87,0)
 ..S A1=$G(^TMP($J,"T",TNOD,Z,"D")),A2=$G(^("T")),T1=A1*CU+T1,T2=A2*CU+T2 D:$Y>(IOSL-8) HDR
"RTN","FHNO6",88,0)
 ..W !,$E($P(NAM,"~",1),1,24),?25,$J(CU,7,3),$J(A1,7),$J(A1*CU,8,2),$J(A2,8),$J(A2*CU,8,2),$J(A1+A2,8),$J(A1+A2*CU,8,2) Q
"RTN","FHNO6",89,0)
 .D:$Y>(IOSL-13) HDR W !!,"Total",?39,$J(T1,8,2),$J(T2,16,2),$J(T1+T2,16,2)
"RTN","FHNO6",90,0)
 .S CTR=$G(^TMP($J,"T",TNOD,0)),WP=$P(CTR,"^",1),WPD=$P(CTR,"^",2),WPT=$P(CTR,"^",3)
"RTN","FHNO6",91,0)
 .W !!,"SF Cost/Patient Meal:",?32,$J(WP,7),?39,$J(T1/WP,8,2),?47,$J(WP,8),?55,$J(T2/WP,8,2),?63,$J(WP,8),?71,$J(T1+T2/WP,8,2)
"RTN","FHNO6",92,0)
 .W !,"SF Cost/Recipient Meal:" W:WPD ?32,$J(WPD,7),?39,$J(T1/WPD,8,2) W:WPT ?47,$J(WPT,8),?55,$J(T2/WPT,8,2) W:(WPD+WPT) ?63,$J(WPD+WPT,8),?71,$J(T1+T2/(WPD+WPT),8,2)
"RTN","FHNO6",93,0)
 .W !!,"Recipient Meal %:" W:WPD ?39,$J(WPD/WP*100,8,0) W:WPT ?55,$J(WPT/WP*100,8,0) W:(WPD+WPT) ?71,$J(WPD+WPT/WP*100,8,0) W ! Q
"RTN","FHNO6",94,0)
 I FHSUM D OGRD
"RTN","FHNO6",95,0)
 Q
"RTN","FHNO6",96,0)
GRD S NAM="" F  S NAM=$O(^FH(118,"B",NAM)) Q:NAM=""  F Z=0:0 S Z=$O(^FH(118,"B",NAM,Z)) Q:Z<1  I $O(^(Z,0))="" S REC=$P($G(^FH(118,Z,0)),"^",7),CU=$P($G(^FH(114,+REC,0)),"^",13),^TMP($J,"P",NAM_"~"_Z)=CU
"RTN","FHNO6",97,0)
 S FHSUMHD=1
"RTN","FHNO6",98,0)
 S TNOD="" F  S TNOD=$O(^TMP($J,"FH",TNOD)) Q:TNOD=""  D
"RTN","FHNO6",99,0)
 .S FHOUT=0
"RTN","FHNO6",100,0)
 .Q:$O(^TMP($J,"FH",TNOD,0))=""  D HDR S (T1,T2)=0
"RTN","FHNO6",101,0)
 .S NAM="" F  S NAM=$O(^TMP($J,"P",NAM)) Q:NAM=""  S CU=^(NAM) D
"RTN","FHNO6",102,0)
 ..S Z=$P(NAM,"~",2) I '$D(^TMP($J,"FH",TNOD,Z)) Q
"RTN","FHNO6",103,0)
 ..S A1=$G(^TMP($J,"FH",TNOD,Z,"D")),A2=$G(^("T")),T1=A1*CU+T1,T2=A2*CU+T2 D:$Y>(IOSL-8) HDR
"RTN","FHNO6",104,0)
 ..W !,$E($P(NAM,"~",1),1,24),?25,$J(CU,7,3),$J(A1,7),$J(A1*CU,8,2),$J(A2,8),$J(A2*CU,8,2),$J(A1+A2,8),$J(A1+A2*CU,8,2) Q
"RTN","FHNO6",105,0)
 .D:$Y>(IOSL-13) HDR W !!,"Grand Total",?39,$J(T1,8,2),$J(T2,16,2),$J(T1+T2,16,2)
"RTN","FHNO6",106,0)
 .S CTR=$G(^TMP($J,"FH",TNOD,0)),WP=$P(CTR,"^",1),WPD=$P(CTR,"^",2),WPT=$P(CTR,"^",3)
"RTN","FHNO6",107,0)
 .W !!,"Cost/Patient:",?32,$J(WP,7),?39,$J(T1/WP,8,2),?47,$J(WP,8),?55,$J(T2/WP,8,2),?63,$J(WP,8),?71,$J(T1+T2/WP,8,2)
"RTN","FHNO6",108,0)
 .W !,"Cost/Recipient:" W:WPD ?32,$J(WPD,7),?39,$J(T1/WPD,8,2) W:WPT ?47,$J(WPT,8),?55,$J(T2/WPT,8,2) W:(WPD+WPT) ?63,$J(WPD+WPT,8),?71,$J(T1+T2/(WPD+WPT),8,2)
"RTN","FHNO6",109,0)
 .W !!,"Recipient %:" W:WPD ?39,$J(WPD/WP*100,8,0) W:WPT ?55,$J(WPT/WP*100,8,0) W:(WPD+WPT) ?71,$J(WPD+WPT/WP*100,8,0) W ! Q
"RTN","FHNO6",110,0)
 Q
"RTN","FHNO6",111,0)
 ;
"RTN","FHNO6",112,0)
OGRD S NAM="" F  S NAM=$O(^FH(118,"B",NAM)) Q:NAM=""  F Z=0:0 S Z=$O(^FH(118,"B",NAM,Z)) Q:Z<1  I $O(^(Z,0))="" S REC=$P($G(^FH(118,Z,0)),"^",7),CU=$P($G(^FH(114,+REC,0)),"^",13),^TMP($J,"P",NAM_"~"_Z)=CU
"RTN","FHNO6",113,0)
 S FHSUMHD=1
"RTN","FHNO6",114,0)
 S TNOD="" F  S TNOD=$O(^TMP($J,"FH",TNOD)) Q:TNOD=""  D
"RTN","FHNO6",115,0)
 .Q:$O(^TMP($J,"FH",TNOD,0))=""  D HDR S (T1,T2)=0
"RTN","FHNO6",116,0)
 .S NAM="" F  S NAM=$O(^TMP($J,"P",NAM)) Q:NAM=""  S CU=^(NAM) D
"RTN","FHNO6",117,0)
 ..S Z=$P(NAM,"~",2) I '$D(^TMP($J,"FH",TNOD,Z)) Q
"RTN","FHNO6",118,0)
 ..S A1=$G(^TMP($J,"FH",TNOD,Z,"D")),A2=$G(^("T")),T1=A1*CU+T1,T2=A2*CU+T2 D:$Y>(IOSL-8) HDR
"RTN","FHNO6",119,0)
 ..W !,$E($P(NAM,"~",1),1,24),?25,$J(CU,7,3),$J(A1,7),$J(A1*CU,8,2),$J(A2,8),$J(A2*CU,8,2),$J(A1+A2,8),$J(A1+A2*CU,8,2) Q
"RTN","FHNO6",120,0)
 .D:$Y>(IOSL-13) HDR W !!,"Grand Total",?39,$J(T1,8,2),$J(T2,16,2),$J(T1+T2,16,2)
"RTN","FHNO6",121,0)
 .S CTR=$G(^TMP($J,"FH",TNOD,0)),WP=$P(CTR,"^",1),WPD=$P(CTR,"^",2),WPT=$P(CTR,"^",3)
"RTN","FHNO6",122,0)
 .W !!,"SF Cost/Patient Meal:",?32,$J(WP,7),?39,$J(T1/WP,8,2),?47,$J(WP,8),?55,$J(T2/WP,8,2),?63,$J(WP,8),?71,$J(T1+T2/WP,8,2)
"RTN","FHNO6",123,0)
 .W !,"SF Cost/Recipient Meal:" W:WPD ?32,$J(WPD,7),?39,$J(T1/WPD,8,2) W:WPT ?47,$J(WPT,8),?55,$J(T2/WPT,8,2) W:(WPD+WPT) ?63,$J(WPD+WPT,8),?71,$J(T1+T2/(WPD+WPT),8,2)
"RTN","FHNO6",124,0)
 .W !!,"Recipient Meal %:" W:WPD ?39,$J(WPD/WP*100,8,0) W:WPT ?55,$J(WPT/WP*100,8,0) W:(WPD+WPT) ?71,$J(WPD+WPT/WP*100,8,0) W ! Q
"RTN","FHNO6",125,0)
 Q
"RTN","FHNO6",126,0)
 ;
"RTN","FHNO6",127,0)
HDR ; Print Header
"RTN","FHNO6",128,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHNO6",129,0)
 W !,PTIM,!!?11,"S U P P L E M E N T A L   F E E D I N G   C O S T S",?73,"Page ",PG
"RTN","FHNO6",130,0)
 W !!,$S(FHOUT=1:"***OUTPATIENT***",1:"***INPATIENT***")
"RTN","FHNO6",131,0)
 I 'FHSUMHD S Y=$S(SUM:"CONSOLIDATED",1:$P(TNOD,"~",2)) W ?(80-$L(Y)\2),Y
"RTN","FHNO6",132,0)
 I FHSUMHD S Y="GRAND TOTAL" W ?(80-$L(Y)\2),Y
"RTN","FHNO6",133,0)
 W !!?38,"DIETARY",?52,"THERAPEUTIC",?71,"TOTAL",!,"Supplemental Feeding",?28,"Cost    Qty   Total     Qty   Total     Qty   Total",! Q
"RTN","FHNO6",134,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHNO7")
0^47^B43514527
"RTN","FHNO7",1,0)
FHNO7 ; HISC/REL - List Supplemental Fdgs. ;12/15/94  09:14 
"RTN","FHNO7",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO7",3,0)
 ;patch #5 - add outpatient SF.
"RTN","FHNO7",4,0)
LIS ; Display Feeding
"RTN","FHNO7",5,0)
 S (FHLOCN,Y)=""
"RTN","FHNO7",6,0)
 I WARD'="" S NAM=$P($G(^DPT(DFN,0)),"^",1) D CUR^FHORD7
"RTN","FHNO7",7,0)
 I WARD="",'$G(ADM) Q
"RTN","FHNO7",8,0)
 I WARD="" D PATNAME^FHOMUTL S NAM=FHPTNM,FHDIET=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,2) D
"RTN","FHNO7",9,0)
 .S:FHDIET Y=$P($G(^FH(111,FHDIET,0)),U,7) I 'FHDIET S FHRNUM=ADM D DIETPAT^FHOMRR1 S Y=FHDIETP
"RTN","FHNO7",10,0)
 .S FHLOC=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,3) S:$G(FHLOC) FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHNO7",11,0)
 W:$E(IOST,1,2)="C-" @IOF W !!,NAM,"  " W:WARD'="" "( ",WARD," )" W:FHLOCN'="" "( ",FHLOCN," )"
"RTN","FHNO7",12,0)
 I WARD="",$D(^FHPT(FHDFN,"OP",ADM,0)) S DTP=$P(^FHPT(FHDFN,"OP",ADM,0),U,1) D DTP^FH W ?50,"Outpatient Date: ",DTP
"RTN","FHNO7",13,0)
 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHNO7",14,0)
 I WARD'="" S NO=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",7),Y=$S('NO:"",1:$G(^FHPT(FHDFN,"A",ADM,"SF",NO,0)))
"RTN","FHNO7",15,0)
 I WARD=""  S NO=$P($G(^FHPT(FHDFN,"OP",ADM,"SF",0)),"^",3),Y=$S('NO:"",1:$G(^FHPT(FHDFN,"OP",ADM,"SF",NO,0))) I $P(Y,"^",32)'="" S (NO,Y)=""
"RTN","FHNO7",16,0)
 I WARD="" W:$D(FHMEAL) ?50,"MEAL: ",$S(FHMEAL="B":"Breakfast",FHMEAL="N":"Noon",1:"Evening")
"RTN","FHNO7",17,0)
L1 ; Display SF Order
"RTN","FHNO7",18,0)
 I '$D(WARD) S WARD=""
"RTN","FHNO7",19,0)
 S NM=$P(Y,"^",4) W !!,"Feeding Menu: ",$S('NM:"None",1:$P(^FH(118.1,NM,0),"^",1)) Q:'NO  S DTP=$P(Y,"^",30) D DTP^FH W ?50,"Reviewed: ",DTP
"RTN","FHNO7",20,0)
 I WARD'="" W !!,"10AM",?26,"2PM",?52,"8PM",!,"-----------------------   -----------------------   -----------------------"
"RTN","FHNO7",21,0)
 I WARD="",$D(FHMEAL),FHMEAL="B" W !!,"10AM",!,"----------------------------------------------------------------------------"
"RTN","FHNO7",22,0)
 I WARD="",$D(FHMEAL),FHMEAL="N" W !!,"2PM",!,"-----------------------------------------------------------------------------"
"RTN","FHNO7",23,0)
 I WARD="",$D(FHMEAL),FHMEAL="E" W !!,"8PM",!,"-----------------------------------------------------------------------------"
"RTN","FHNO7",24,0)
 K N F K1=1:1:3 F K2=1:1:4 S N(K1,K2)=""
"RTN","FHNO7",25,0)
 S L=4 F K1=1:1:3 S K=0 F K2=1:1:4 S Z=$P(Y,"^",L+1),Q=$P(Y,"^",L+2),L=L+2 I Z'="" S:'Q Q=1 S K=K+1,N(K1,K)=$J(Q,2)_" "_$P($G(^FH(118,Z,0)),"^",1)
"RTN","FHNO7",26,0)
 I WARD'="" F K2=1:1:4 W !,N(1,K2),?26,N(2,K2),?52,N(3,K2)
"RTN","FHNO7",27,0)
 I WARD="",$D(FHMEAL) F K2=1:1:4 W !,$S(FHMEAL="B":N(1,K2),FHMEAL="N":N(2,K2),1:N(3,K2))
"RTN","FHNO7",28,0)
 W:$P(Y,"^",34)'="" !!,"Diet Pattern Associated: ",$S($P(Y,"^",34)="Y":"YES",1:"NO")
"RTN","FHNO7",29,0)
 Q
"RTN","FHNO7",30,0)
EN2 ; Supplemental Feeding Inquiry
"RTN","FHNO7",31,0)
 K FHSFLG,FHDFN,FHPTNM,FHMEAL,ADM,NO,Y,X
"RTN","FHNO7",32,0)
 S FHALL=1 D ^FHOMDPA G:'FHDFN KIL
"RTN","FHNO7",33,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1)) I WARD'="" D LIS G EN2
"RTN","FHNO7",34,0)
 I WARD="" D SF
"RTN","FHNO7",35,0)
 I '$G(FHSFLG) W !,"NO OUTPATIENT DATA ON FILE for today's date and the future!!" G EN2
"RTN","FHNO7",36,0)
 D SF0
"RTN","FHNO7",37,0)
 D:$G(ADM) LIS G EN2
"RTN","FHNO7",38,0)
 ;
"RTN","FHNO7",39,0)
SF ;LIST outpatient SF
"RTN","FHNO7",40,0)
 W @IOF,!,"Outpatient Recurring Meals... "
"RTN","FHNO7",41,0)
 S FHQ=0
"RTN","FHNO7",42,0)
 F FHI=DT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:FHI'>0!FHQ  F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0!FHQ  I ($P($G(^FHPT(FHDFN,"OP",FHJ,0)),U,15)'="C") D
"RTN","FHNO7",43,0)
 .S FHDA15=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHNO7",44,0)
 .S FHMEAL=$P(FHDA15,U,4),FHLOC=$P(FHDA15,U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL="B":"Break",FHMEAL="N":"Noon",1:"Even"),FH11=FHMEAL_"  "_FHLOCN
"RTN","FHNO7",45,0)
 .S Y=$P(FHDA15,U,1) X ^DD("DD") S DTP=Y
"RTN","FHNO7",46,0)
 .S (FHCOFLG,FHDATL,FHSF)=0
"RTN","FHNO7",47,0)
 .I $Y>(IOSL-5) K DIR S DIR(0)="E",DIR("A")="Enter RETURN to Continue or '^' to Quit Listing"  D ^DIR W:Y @IOF I 'Y S FHQ=1 Q
"RTN","FHNO7",48,0)
 .S FHSFLG=1
"RTN","FHNO7",49,0)
 .W !,DTP,?12,FH11
"RTN","FHNO7",50,0)
 .S FHDATL=$L(DTP)+13+$L(FH11)
"RTN","FHNO7",51,0)
 .S:$D(^FHPT(FHDFN,"OP",FHJ,"SF",0)) FHSF=$P(^FHPT(FHDFN,"OP",FHJ,"SF",0),U,3)
"RTN","FHNO7",52,0)
 .Q:'$G(FHSF)
"RTN","FHNO7",53,0)
 .S FHDA15SF=$G(^FHPT(FHDFN,"OP",FHJ,"SF",FHSF,0))
"RTN","FHNO7",54,0)
 .Q:$P(FHDA15SF,U,32)
"RTN","FHNO7",55,0)
 .S FHDASFNM=$P($G(^FH(118.1,$P(FHDA15SF,U,4),0)),U,1)
"RTN","FHNO7",56,0)
 .W ?40," (",FHDASFNM,")"
"RTN","FHNO7",57,0)
 W !
"RTN","FHNO7",58,0)
 Q
"RTN","FHNO7",59,0)
 ;
"RTN","FHNO7",60,0)
 ;K DIC
"RTN","FHNO7",61,0)
 ;S DIC("S")="I $P(^FHPT(FHDFN,""OP"",+Y,0),U,1)>(DT-1),($P(^(0),U,15)'=""C"")"
"RTN","FHNO7",62,0)
 ;S DIC("W")="S FHMEAL=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL=""B"":""Break"",FHMEAL=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHNO7",63,0)
 ;S DIC="^FHPT(FHDFN,""OP"",",DIC(0)="Q",DA=FHDFN,X="??" D ^DIC
"RTN","FHNO7",64,0)
SF0 ;ask for outpatient SF.
"RTN","FHNO7",65,0)
 K DIC S DIC(0)="AEQM"
"RTN","FHNO7",66,0)
 S DIC("W")="S FHMEAL=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL=""B"":""Break"",FHMEAL=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHNO7",67,0)
 S DIC("S")="I $P(^FHPT(FHDFN,""OP"",+Y,0),U,1)>(DT-1),($P(^(0),U,15)'=""C"")"
"RTN","FHNO7",68,0)
 S DIC="^FHPT(FHDFN,""OP"","
"RTN","FHNO7",69,0)
 S DIC("?")="Select a Date, '^' to exit"
"RTN","FHNO7",70,0)
 S DIC("A")="Select the Outpatient Date :" D ^DIC K DIC Q:(Y'>0)!$D(DTOUT)
"RTN","FHNO7",71,0)
 S ADM=+Y
"RTN","FHNO7",72,0)
 S FHMEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4)
"RTN","FHNO7",73,0)
 Q
"RTN","FHNO7",74,0)
 ;
"RTN","FHNO7",75,0)
OIS ;Outpatient Individualized SF
"RTN","FHNO7",76,0)
 Q:'NM
"RTN","FHNO7",77,0)
 I '$D(FHX) S FHX="ALL"
"RTN","FHNO7",78,0)
 I (FHX="ALL")!($L(FHX)=3) S FHIDI="BNE"
"RTN","FHNO7",79,0)
 I $L(FHX)=2 S FHIDI=$S(FHX="NB":"BN",FHX="EB":"BE",FHX="EN":"NE",1:FHX)
"RTN","FHNO7",80,0)
 I $L(FHX)=1 S FHIDI=FHX
"RTN","FHNO7",81,0)
 F FHII=1,2,3 S FHMEAL=$E(FHIDI,FHII) Q:FHII'>0!(FHMEAL="")  D G0
"RTN","FHNO7",82,0)
 D G6
"RTN","FHNO7",83,0)
 Q
"RTN","FHNO7",84,0)
G0 ;process each meals for individualized SF.
"RTN","FHNO7",85,0)
 S T1=$S(FHMEAL="B":"10am",FHMEAL="N":"2pm",1:"8pm")
"RTN","FHNO7",86,0)
 S KK=$S(FHMEAL="B":1,FHMEAL="N":5,1:9)
"RTN","FHNO7",87,0)
 ;I NM'=1 D CAN^FHNO5,ADD^FHNO5
"RTN","FHNO7",88,0)
 S DIC="^FH(118,",DIC(0)="EQM",DIC("S")="I $P(^(0),U,3)'=""Y"""
"RTN","FHNO7",89,0)
 ;
"RTN","FHNO7",90,0)
G1 G:KK>12 G5
"RTN","FHNO7",91,0)
 I ((WARD="")&(FHMEAL="B")&(KK>4))!((WARD="")&(FHMEAL="N")&(KK>8)) G G5
"RTN","FHNO7",92,0)
 ;I WARD'="" S T1=$P("10am^2pm^8pm","^",KK-1\4+1)
"RTN","FHNO7",93,0)
 S T2="#"_(KK-1#4+1),P1=KK*2+3
"RTN","FHNO7",94,0)
 S DIC("A")=T1_" Feeding "_T2_": "
"RTN","FHNO7",95,0)
 S OLD=$P(PNN,"^",P1) I OLD S DIC("A")=DIC("A")_$P(^FH(118,+OLD,0),"^",1)_"// "
"RTN","FHNO7",96,0)
 ;
"RTN","FHNO7",97,0)
G2 W !!,DIC("A") R X:DTIME G:'$T!(X["^") G5
"RTN","FHNO7",98,0)
 I X="" G:OLD G3 S KK=$S(KK<5:5,KK<9:9,1:13) G G1
"RTN","FHNO7",99,0)
 I OLD,X="@" S $P(PNN,"^",P1)="",$P(PNN,"^",P1+1)="" S KK=KK+1 G G1
"RTN","FHNO7",100,0)
 D ^DIC G:Y<1 G2 S Y=+Y,K1=$S(KK<5:1,KK<9:5,1:9)
"RTN","FHNO7",101,0)
 F L=K1:1:K1+3 I L'=KK,$P(PNN,"^",L*2+3)=Y W *7," .. DUPLICATE OF EXISTING ITEM!" G G2
"RTN","FHNO7",102,0)
 S:OLD'=Y $P(PNN,"^",P1)=Y
"RTN","FHNO7",103,0)
 ;
"RTN","FHNO7",104,0)
G3 S OLD=$P(PNN,"^",P1+1)
"RTN","FHNO7",105,0)
 ;
"RTN","FHNO7",106,0)
G4 W !,T1," ",T2," Qty: ",$S(OLD="":1,1:OLD),"// " R X:DTIME G:'$T!(X["^") G5
"RTN","FHNO7",107,0)
 S:X="@" X=0 I X="" S:OLD="" $P(PNN,"^",P1+1)=1 S KK=KK+1 G G1
"RTN","FHNO7",108,0)
 I X'?1N.N!(X>20) W *7," ??" S X="?"
"RTN","FHNO7",109,0)
 I X["?" W !?5,"Enter a whole number between 1 and 20" G G4
"RTN","FHNO7",110,0)
 I 'X S $P(PNN,"^",P1)="",$P(PNN,"^",P1+1)="" S KK=KK+1 G G1
"RTN","FHNO7",111,0)
 S $P(PNN,"^",P1+1)=X,KK=KK+1 G G1
"RTN","FHNO7",112,0)
 ;
"RTN","FHNO7",113,0)
G5 S KK=3,X="" F T1=0:1:2 S P1=T1*8-1 F T2=1:1:4 S KK=KK+2 I $P(PNN,"^",KK) S P1=P1+2,$P(X,"^",P1,P1+1)=$P(PNN,"^",KK,KK+1)
"RTN","FHNO7",114,0)
 ;I X="" D CAN^FHNO5 Q
"RTN","FHNO7",115,0)
 Q
"RTN","FHNO7",116,0)
 ;
"RTN","FHNO7",117,0)
G6 S P1=$P(PNN,"^",29) S:P1="" P1="D" W !!,"Dietary or Therapeutic? ",P1,"// " R Y:DTIME S:'$T!("^"[Y) Y=P1
"RTN","FHNO7",118,0)
 S:$P("dietary",Y,1)="" Y="D" S:$P("therapeutic",Y,1)="" Y="T"
"RTN","FHNO7",119,0)
 I $P("DIETARY",Y,1)'="",$P("THERAPEUTIC",Y,1)'="" W *7,!?5," Answer D for Dietary use or T for Therapeutic use" G G6
"RTN","FHNO7",120,0)
 S $P(X,"^",25)=$E(Y,1),PNN=$P(PNN,"^",1,4)_"^"_X
"RTN","FHNO7",121,0)
 ;G:$P(PNO,"^",5,29)=X UPD^FHNO5 D CAN^FHNO5
"RTN","FHNO7",122,0)
 S FHPNNSV=PNN
"RTN","FHNO7",123,0)
 S FHIDFLG=1
"RTN","FHNO7",124,0)
 Q
"RTN","FHNO7",125,0)
 ;
"RTN","FHNO7",126,0)
CPRSF ;check previous SF
"RTN","FHNO7",127,0)
 K PNN
"RTN","FHNO7",128,0)
 S (FHDAT,FHSF)=""
"RTN","FHNO7",129,0)
CPRS1 I FHSF="" S FHSF=$O(^FHPT(FHDFN,"OP",999999999),-1)
"RTN","FHNO7",130,0)
 E  S FHSF=$O(^FHPT(FHDFN,"OP",FHSF),-1)
"RTN","FHNO7",131,0)
 Q:'$G(FHSF)
"RTN","FHNO7",132,0)
 S FHDAT=$G(^FHPT(FHDFN,"OP",FHSF,0)),FHPRML=$P(FHDAT,U,4),FHPRCN=$P(FHDAT,U,15),FHLOCN=$P(FHDAT,U,3)
"RTN","FHNO7",133,0)
 I (FHPRML'=FHMEAL)!(FHPRCN="C")!'$D(^FHPT(FHDFN,"OP",FHSF,"SF",0)) G CPRS1
"RTN","FHNO7",134,0)
 S FHI=$P($G(^FHPT(FHDFN,"OP",FHSF,"SF",0)),U,3) Q:FHI'>0
"RTN","FHNO7",135,0)
 S PNN=$G(^FHPT(FHDFN,"OP",FHSF,"SF",FHI,0)),FHSFCX=$P(PNN,U,32)
"RTN","FHNO7",136,0)
 I $G(FHSFCX) K PNN G CPRS1
"RTN","FHNO7",137,0)
 I $P(PNN,U,34)="Y" K PNN Q
"RTN","FHNO7",138,0)
 S $P(PNN,U,3)=DUZ,FHNMSAV=$P(PNN,U,4)
"RTN","FHNO7",139,0)
 Q
"RTN","FHNO7",140,0)
PPRSF ;PROCESS previous SF
"RTN","FHNO7",141,0)
 Q:'$D(PNN)
"RTN","FHNO7",142,0)
 D NOW^%DTC S NOW=%
"RTN","FHNO7",143,0)
 D ADDOUT^FHNO5
"RTN","FHNO7",144,0)
 Q
"RTN","FHNO7",145,0)
SFEVNT ;
"RTN","FHNO7",146,0)
 S FHDTC=0
"RTN","FHNO7",147,0)
 S FHLOCN="" I $D(FHLOC),$G(FHLOC),$D(^FH(119.6,FHLOC,0)) S FHLOCN=$P(^(0),U,1)
"RTN","FHNO7",148,0)
 S FHDTC=FHDTC+1,DTP=FHOSTDT D DTP^FH S:FHDTC=1 FHDTP=DTP
"RTN","FHNO7",149,0)
 S DTP=$P(ENDT,".",1)  D DTP^FH
"RTN","FHNO7",150,0)
 I DTP'=FHDTP S FHDTP=FHDTP_" to "_DTP
"RTN","FHNO7",151,0)
 I FHADSFF=1 S FHACT="O",FHTXT="Outpatient Supplemental Feeding: "_FHSFMEN_" ("_FHMEAL_") , "_FHLOCN_", "_FHDTP D OPFILE^FHORX
"RTN","FHNO7",152,0)
 Q
"RTN","FHNO7",153,0)
 ;
"RTN","FHNO7",154,0)
KIL G KILL^XUSCLEAN
"RTN","FHNO8")
0^48^B24504229
"RTN","FHNO8",1,0)
FHNO8 ; HISC/REL - History of Supp. Fdgs. ;5/17/93  14:24 
"RTN","FHNO8",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHNO8",3,0)
 ;patch #5 - add outpatient SFs,
"RTN","FHNO8",4,0)
 ;
"RTN","FHNO8",5,0)
SF K FHDFN,X,WARD,SDT,EDT,STDT,ENDT
"RTN","FHNO8",6,0)
 S ADM="",FHALL=1 D ^FHOMDPA
"RTN","FHNO8",7,0)
 G:'FHDFN KIL
"RTN","FHNO8",8,0)
 I $O(^FHPT(FHDFN,"A",0))<1 W !!,"NO ADMISSIONS ON FILE!" G OSF
"RTN","FHNO8",9,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="Q",DA=FHDFN,X="??" D ^DIC
"RTN","FHNO8",10,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHNO8",11,0)
 K ADM
"RTN","FHNO8",12,0)
SF0 W !!,"Select ADMISSION or RETURN for OUTPATIENT ",$S(WARD'="":" (or C for CURRENT)",1:""),": " R X:DTIME G:X["^" KIL D:X="c" TR^FH
"RTN","FHNO8",13,0)
 I (X="")&'($D(^FHPT(FHDFN,"OP"))) W !!,"NO OUTPATIENT DATA ON FILE!" G SF
"RTN","FHNO8",14,0)
 I (X="")&($D(^FHPT(FHDFN,"OP"))) G OSF
"RTN","FHNO8",15,0)
 I WARD'="",X="C" S ADM=$G(^DPT("CN",WARD,DFN)) G CAD:ADM
"RTN","FHNO8",16,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="EQM" D ^DIC G:Y<1 SF0 S ADM=+Y
"RTN","FHNO8",17,0)
CAD I $G(ADM),$G(^FHPT(FHDFN,"A",ADM,0)) G IN
"RTN","FHNO8",18,0)
 ;
"RTN","FHNO8",19,0)
SF1 I '($D(^FHPT(FHDFN,"OP"))) W !!,"NO OUTPATIENT DATA ON FILE!" G SF
"RTN","FHNO8",20,0)
 W !!,"Enter the Start Date and End Date for outpatient data.",!
"RTN","FHNO8",21,0)
 D STDATE^FHOMUTL S SDT=STDT I STDT="" Q
"RTN","FHNO8",22,0)
 S X="T+30" D ^%DT S ENDT=Y
"RTN","FHNO8",23,0)
 D DD^%DT S FHDTDF=Y K DIR
"RTN","FHNO8",24,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT
"RTN","FHNO8",25,0)
 D ^DIR
"RTN","FHNO8",26,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHNO8",27,0)
 D ADM
"RTN","FHNO8",28,0)
 Q
"RTN","FHNO8",29,0)
OSF ;process outpatient SFs.
"RTN","FHNO8",30,0)
 ;
"RTN","FHNO8",31,0)
 S FHSFLG=0
"RTN","FHNO8",32,0)
 S FHSOOP=$O(^FHPT(FHDFN,"OP","B",DT-30))
"RTN","FHNO8",33,0)
 I '$D(^FHPT(FHDFN,"OP"))!'$G(FHSOOP) G FHNO8
"RTN","FHNO8",34,0)
 ;W !!,"Outpatient Recurring Meals... "
"RTN","FHNO8",35,0)
 D ASK0
"RTN","FHNO8",36,0)
 G:'$G(ADM) SF
"RTN","FHNO8",37,0)
 S (N1,LST)=0
"RTN","FHNO8",38,0)
 I $G(ADM) F K=0:0 S K=$O(^FHPT(FHDFN,"OP",ADM,"SF",K)) Q:K<1  S X=^(K,0),LST=K D LIS
"RTN","FHNO8",39,0)
 I $G(ADM),'N1 W !!,"No Supplemental Feedings for this outpatient date!",! K DIR S DIR(0)="E",DIR("A")="Enter RETURN to Continue or '^' to Exit"  D ^DIR Q:'Y  G OSF
"RTN","FHNO8",40,0)
 I $G(ADM),$G(N1) G OSF0
"RTN","FHNO8",41,0)
 G OSF
"RTN","FHNO8",42,0)
OSF0 R !!,"Detailed Display of which Order #? ",X:DTIME G:'$T!("^"[X) FHNO8 I X'?1N.N!(X<1)!(X>LST) W *7," Enter # of Order to List" G OSF0
"RTN","FHNO8",43,0)
 S NO=+X,Y=$G(^FHPT(FHDFN,"OP",ADM,"SF",NO,0)) D:Y'="" L1^FHNO7
"RTN","FHNO8",44,0)
 G SF
"RTN","FHNO8",45,0)
 Q
"RTN","FHNO8",46,0)
ASK0 ;ask for Recurring Meal entry.
"RTN","FHNO8",47,0)
 K ADM
"RTN","FHNO8",48,0)
 W @IOF,!,"Outpatient Recurring Meals... "
"RTN","FHNO8",49,0)
 S FHQ=0,FHSDT=DT-60
"RTN","FHNO8",50,0)
 F FHI=FHSDT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:FHI'>0!FHQ  F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0!FHQ  I ($P($G(^FHPT(FHDFN,"OP",FHJ,0)),U,15)'="C") D
"RTN","FHNO8",51,0)
 .S FHDA15=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHNO8",52,0)
 .S FHMEAL=$P(FHDA15,U,4),FHLOC=$P(FHDA15,U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL="B":"Break",FHMEAL="N":"Noon",1:"Even"),FH11=FHMEAL_"  "_FHLOCN
"RTN","FHNO8",53,0)
 .S Y=$P(FHDA15,U,1) X ^DD("DD") S DTP=Y
"RTN","FHNO8",54,0)
 .S (FHCOFLG,FHDATL,FHSF)=0
"RTN","FHNO8",55,0)
 .I $Y>(IOSL-5) K DIR S DIR(0)="E",DIR("A")="Enter RETURN to Continue or '^' to Quit Listing"  D ^DIR W:Y @IOF I 'Y S FHQ=1 Q
"RTN","FHNO8",56,0)
 .W !,DTP,?12,FH11
"RTN","FHNO8",57,0)
 .S FHDATL=$L(DTP)+13+$L(FH11)
"RTN","FHNO8",58,0)
 .S:$D(^FHPT(FHDFN,"OP",FHJ,"SF",0)) FHSF=$P(^FHPT(FHDFN,"OP",FHJ,"SF",0),U,3)
"RTN","FHNO8",59,0)
 .Q:'$G(FHSF)
"RTN","FHNO8",60,0)
 .S FHDA15SF=$G(^FHPT(FHDFN,"OP",FHJ,"SF",FHSF,0))
"RTN","FHNO8",61,0)
 .Q:$P(FHDA15SF,U,32)
"RTN","FHNO8",62,0)
 .S FHDASFNM=$P($G(^FH(118.1,$P(FHDA15SF,U,4),0)),U,1)
"RTN","FHNO8",63,0)
 .W ?40," (",FHDASFNM,")"
"RTN","FHNO8",64,0)
 W !
"RTN","FHNO8",65,0)
 K DIC S DIC(0)="AEQM"
"RTN","FHNO8",66,0)
 S DIC("W")="S FHMEAL=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL=""B"":""Break"",FHMEAL=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHNO8",67,0)
 S DIC("S")="I $P(^FHPT(FHDFN,""OP"",+Y,0),U,1)>(DT-60)"
"RTN","FHNO8",68,0)
 S DIC="^FHPT(FHDFN,""OP"","
"RTN","FHNO8",69,0)
 S DIC("?")="Select a Date, '^' to exit"
"RTN","FHNO8",70,0)
 S DIC("A")="Select the Outpatient Date :" D ^DIC K DIC Q:(Y'>0)!$D(DTOUT)
"RTN","FHNO8",71,0)
 S ADM=+Y
"RTN","FHNO8",72,0)
 S FHMEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4)    ;outpatient standing orders.
"RTN","FHNO8",73,0)
 Q
"RTN","FHNO8",74,0)
 ;
"RTN","FHNO8",75,0)
 S ALL=1 D ^FHDPA G:'DFN KIL G:'FHDFN KIL
"RTN","FHNO8",76,0)
 I $O(^FHPT(FHDFN,"A",0))<1 W !!,"NO ADMISSIONS ON FILE!" G FHNO8
"RTN","FHNO8",77,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="Q",DA=FHDFN,X="??" D ^DIC
"RTN","FHNO8",78,0)
A0 W !!,"Select ADMISSION",$S($D(^DPT(DFN,.1)):" (or C for CURRENT)",1:""),": " R X:DTIME G:'$T!("^"[X) KIL D:X="c" TR^FH
"RTN","FHNO8",79,0)
 ;
"RTN","FHNO8",80,0)
IN ;D ADM G SF0:ADM'>0
"RTN","FHNO8",81,0)
 ;
"RTN","FHNO8",82,0)
P0 S (N1,LST)=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"SF",K)) Q:K<1  S X=^(K,0),LST=K D LIS
"RTN","FHNO8",83,0)
 I 'N1 W !!,"No Supplemental Feedings for this Admission!" G FHNO8
"RTN","FHNO8",84,0)
P1 R !!,"Detailed Display of which Order #? ",X:DTIME G:'$T!("^"[X) FHNO8 I X'?1N.N!(X<1)!(X>LST) W *7," Enter # of Order to List" G P1
"RTN","FHNO8",85,0)
 S NO=+X,Y=$G(^FHPT(FHDFN,"A",ADM,"SF",NO,0)) D L1^FHNO7
"RTN","FHNO8",86,0)
 G SF
"RTN","FHNO8",87,0)
ADM ;S WARD=$G(^DPT(DFN,.1))
"RTN","FHNO8",88,0)
 ;I WARD="" W *7,!!,"NOT CURRENTLY AN INPATIENT!",! S ADM="" Q
"RTN","FHNO8",89,0)
 ;S ADM=$G(^DPT("CN",WARD,DFN)) Q
"RTN","FHNO8",90,0)
 ;
"RTN","FHNO8",91,0)
LIS I 'N1 W !!,"Ord  Date/Time Ordered  Supplemental Feeding Menu    Date/Time Cancelled",!
"RTN","FHNO8",92,0)
 S N1=N1+1,D1=$P(X,"^",2),NM=$P(X,"^",4),D2=$P(X,"^",32)
"RTN","FHNO8",93,0)
 S DTP=D1 D DTP^FH W !,$J(K,3),"  ",DTP
"RTN","FHNO8",94,0)
 S X=$P($G(^FH(118.1,+NM,0)),"^",1) W:X'="" ?24,X
"RTN","FHNO8",95,0)
 I D2 S DTP=D2 D DTP^FH W ?54,DTP
"RTN","FHNO8",96,0)
 Q
"RTN","FHNO8",97,0)
KIL G KILL^XUSCLEAN
"RTN","FHOMCBRP")
0^59^B30743180
"RTN","FHOMCBRP",1,0)
FHOMCBRP ;Hines OIFO/RTK COMBINED OUTPATIENT MEALS LIST  ;6/30/03  15:45
"RTN","FHOMCBRP",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMCBRP",3,0)
 ;
"RTN","FHOMCBRP",4,0)
 W @IOF,!!,"C O M B I N E D   O U T P A T I E N T   M E A L S   L I S T"
"RTN","FHOMCBRP",5,0)
EN ;
"RTN","FHOMCBRP",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMCBRP",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMCBRP",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMCBRP",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMCBRP",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMCBRP",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMCBRP",12,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLCOM="" Q
"RTN","FHOMCBRP",13,0)
 .S FHSLCOM=+Y
"RTN","FHOMCBRP",14,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMCBRP",15,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMCBRP",16,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLPRO="" Q
"RTN","FHOMCBRP",17,0)
 .S FHSLPRO=+Y
"RTN","FHOMCBRP",18,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMCBRP",19,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMCBRP",20,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X,ENDT=ENDT_.99
"RTN","FHOMCBRP",21,0)
 D DEV,EN Q
"RTN","FHOMCBRP",22,0)
DEV ;get device and set up queue
"RTN","FHOMCBRP",23,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMCBRP",24,0)
 I '$D(IO("Q")) U IO D LIST,^%ZISC,END Q
"RTN","FHOMCBRP",25,0)
 S ZTRTN="LIST^FHOMCBRP",ZTDESC="Combined Outpatient Meals Display"
"RTN","FHOMCBRP",26,0)
 S ZTSAVE("STDT")="",ZTSAVE("STDT1")="",ZTSAVE("ENDT")=""
"RTN","FHOMCBRP",27,0)
 S ZTSAVE("FHLBY")="",ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")=""
"RTN","FHOMCBRP",28,0)
 S ZTSAVE("FHSLPRO")="" D ^%ZTLOAD
"RTN","FHOMCBRP",29,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMCBRP",30,0)
 D END Q
"RTN","FHOMCBRP",31,0)
LIST ; First build data in ^TMP global
"RTN","FHOMCBRP",32,0)
 K ^TMP($J) S NUM=0,EX="",FHPG=0
"RTN","FHOMCBRP",33,0)
 ;Recurring Meals
"RTN","FHOMCBRP",34,0)
 F FHXRDT=STDT1:0 S FHXRDT=$O(^FHPT("RM",FHXRDT)) Q:FHXRDT'>0!(FHXRDT>ENDT)!(EX=U)  D
"RTN","FHOMCBRP",35,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHXRDT,FHDFN)) Q:FHDFN'>0!(EX=U)  D
"RTN","FHOMCBRP",36,0)
 ..F FHRM=0:0 S FHRM=$O(^FHPT("RM",FHXRDT,FHDFN,FHRM)) Q:FHRM'>0!(EX=U)  D
"RTN","FHOMCBRP",37,0)
 ...S FHZN=$G(^FHPT(FHDFN,"OP",FHRM,0)),FHST=$P(FHZN,U,15) I FHST="C" Q
"RTN","FHOMCBRP",38,0)
 ...D PATNAME^FHOMUTL
"RTN","FHOMCBRP",39,0)
 ...S FHLOC=$P(FHZN,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",40,0)
 ...S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",41,0)
 ...S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",42,0)
 ...S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",43,0)
 ...S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",44,0)
 ...S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMCBRP",45,0)
 ...S FHML=$P(FHZN,U,4) Q:FHML=""  S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",46,0)
 ...S ^TMP($J,FHXRDT_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN_"~"_FHRM)="R~"_FHZN
"RTN","FHOMCBRP",47,0)
 ...Q
"RTN","FHOMCBRP",48,0)
 ..Q
"RTN","FHOMCBRP",49,0)
 .Q
"RTN","FHOMCBRP",50,0)
 ;Special Meals
"RTN","FHOMCBRP",51,0)
 S ENDT=ENDT_.99
"RTN","FHOMCBRP",52,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT("SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHOMCBRP",53,0)
 .S FHSMDTX=$E(FHSMDT,1,7)
"RTN","FHOMCBRP",54,0)
 .S FHDFN=$O(^FHPT("SM",FHSMDT,"")) D PATNAME^FHOMUTL
"RTN","FHOMCBRP",55,0)
 .S FHZN=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHSTAT=$P(FHZN,U,2)
"RTN","FHOMCBRP",56,0)
 .I FHSTAT="C" Q
"RTN","FHOMCBRP",57,0)
 .S FHLOC=$P(FHZN,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",58,0)
 .S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",59,0)
 .S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",60,0)
 .S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",61,0)
 .S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",62,0)
 .S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1),FHML=$P(FHZN,U,9) Q:FHML=""
"RTN","FHOMCBRP",63,0)
 .S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",64,0)
 .S ^TMP($J,FHSMDTX_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN)="S~"_FHZN
"RTN","FHOMCBRP",65,0)
 .Q
"RTN","FHOMCBRP",66,0)
 ;Guest Meals
"RTN","FHOMCBRP",67,0)
 F FHGMDT=STDT:0 S FHGMDT=$O(^FHPT("GM",FHGMDT)) Q:FHGMDT'>0!(FHGMDT>ENDT)  D
"RTN","FHOMCBRP",68,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHGMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMCBRP",69,0)
 ..S FHZN=$G(^FHPT(FHDFN,"GM",FHGMDT,0)),FHST=$P(FHZN,U,9) I FHST="C" Q
"RTN","FHOMCBRP",70,0)
 ..D PATNAME^FHOMUTL
"RTN","FHOMCBRP",71,0)
 ..S FHLOC=$P(FHZN,U,5) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",72,0)
 ..S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",73,0)
 ..S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",74,0)
 ..S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",75,0)
 ..S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",76,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMCBRP",77,0)
 ..S FHML=$P(FHZN,U,3) Q:FHML=""  S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",78,0)
 ..S FHGMDTX=$E(FHGMDT,1,7)
"RTN","FHOMCBRP",79,0)
 ..S ^TMP($J,FHGMDTX_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN)="G~"_FHZN
"RTN","FHOMCBRP",80,0)
 ..Q
"RTN","FHOMCBRP",81,0)
 .Q
"RTN","FHOMCBRP",82,0)
 ; Now display data from the ^TMP global
"RTN","FHOMCBRP",83,0)
 I '$D(^TMP($J)) W !!,"NO OUTPATIENT MEALS WITHIN SELECTED PARAMETERS" Q
"RTN","FHOMCBRP",84,0)
 S FHDTML="" F  S FHDTML=$O(^TMP($J,FHDTML)) Q:FHDTML=""!(EX=U)  D
"RTN","FHOMCBRP",85,0)
 .I FHPG<1 D HDR
"RTN","FHOMCBRP",86,0)
 .S FHWDT=$P(FHDTML,"~",1),FHWML=$P(FHDTML,"~",2)
"RTN","FHOMCBRP",87,0)
 .S FHWDT=$$FMTE^XLFDT(FHWDT,"P")
"RTN","FHOMCBRP",88,0)
 .S FHWML=$S(FHWML=1:"Breakfast",FHWML=2:"Noon",1:"Evening")
"RTN","FHOMCBRP",89,0)
 .S FHPG=FHPG+1
"RTN","FHOMCBRP",90,0)
 .S FHLOC="" F  S FHLOC=$O(^TMP($J,FHDTML,FHLOC)) Q:FHLOC=""!(EX=U)  D
"RTN","FHOMCBRP",91,0)
 ..W !!,FHWDT,?14,"- ",FHWML,?28,"LOCATION: "
"RTN","FHOMCBRP",92,0)
 ..W $P(FHLOC,"~",2),!,"Patient Name",?28,"Diet",?55,"Room-Bed"
"RTN","FHOMCBRP",93,0)
 ..W !,"========================",?28,"========================"
"RTN","FHOMCBRP",94,0)
 ..W ?55,"========================"
"RTN","FHOMCBRP",95,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHDTML,FHLOC,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMCBRP",96,0)
 ...S FHNODE=$G(^TMP($J,FHDTML,FHLOC,FHPTN))
"RTN","FHOMCBRP",97,0)
 ...W !,$E($P(FHPTN,"~",1),1,24)
"RTN","FHOMCBRP",98,0)
 ...S FHPCE=2 S:$E(FHNODE,1)="S" FHPCE=4 S:$E(FHNODE,1)="G" FHPCE=6
"RTN","FHOMCBRP",99,0)
 ...S FHDIET=$P(FHNODE,U,FHPCE)
"RTN","FHOMCBRP",100,0)
 ...I FHDIET'="" W ?28,$E($P($G(^FH(111,FHDIET,0)),U,1),1,24)
"RTN","FHOMCBRP",101,0)
 ...I $E(FHNODE,1)="R" I $P($G(^FH(119.6,$P(FHLOC,"~",3),1)),U,4)="Y" S FHDFN=$P(FHPTN,"~",2),FHRNUM=$P(FHPTN,"~",3) D DIETPAT^FHOMRR1 W ?28,$E(FHDIETP,1,24)
"RTN","FHOMCBRP",102,0)
 ...S FHPCE=18 S:$E(FHNODE,1)="S" FHPCE=13 S:$E(FHNODE,1)="G" FHPCE=11
"RTN","FHOMCBRP",103,0)
 ...S FHRMBD=$P(FHNODE,U,FHPCE),FHRMBNM=""
"RTN","FHOMCBRP",104,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,24)
"RTN","FHOMCBRP",105,0)
 ...W ?55,FHRMBNM
"RTN","FHOMCBRP",106,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMCBRP",107,0)
 ...Q
"RTN","FHOMCBRP",108,0)
 ..Q
"RTN","FHOMCBRP",109,0)
 .Q
"RTN","FHOMCBRP",110,0)
 Q
"RTN","FHOMCBRP",111,0)
END ;
"RTN","FHOMCBRP",112,0)
 K DIR,ENDT,STDT,FHGMDT,FHGMDTX,FHRM,FHXRDT,FHSMDT,FHSMDTX,FHML,FHCL
"RTN","FHOMCBRP",113,0)
 K FHCH,FHDIET,FHLOC,FHPTN,FHSELOC,FHSLCOM,FHNODE,FHZN,FHSLPRO,FHPRD
"RTN","FHOMCBRP",114,0)
 K FHDIETP,FHPCE,FHPG
"RTN","FHOMCBRP",115,0)
 Q
"RTN","FHOMCBRP",116,0)
PG ;
"RTN","FHOMCBRP",117,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMCBRP",118,0)
 D HDR Q
"RTN","FHOMCBRP",119,0)
HDR ;
"RTN","FHOMCBRP",120,0)
 W:$Y @IOF
"RTN","FHOMCBRP",121,0)
 W !,"C O M B I N E D   O U T P A T I E N T   M E A L S   L I S T",!!
"RTN","FHOMCBRP",122,0)
 Q
"RTN","FHOMDPA")
0^55^B5382769
"RTN","FHOMDPA",1,0)
FHOMDPA ;Hines OIFO/RTK OUTPATIENT LOOK-UP ;12/3/02  09:46
"RTN","FHOMDPA",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMDPA",3,0)
F1 ;
"RTN","FHOMDPA",4,0)
 ; FHALL=1 - Lookup INPATIENTS or OUTPATIENTS
"RTN","FHOMDPA",5,0)
 ; FHALL=0 - Lookup OUTPATIENTS only (to lookup INPATS only, use FHDPA)
"RTN","FHOMDPA",6,0)
 ; FHDFN=IEN in file #115, FHZ115=.01 in file #115 (ie P27 or N1866)
"RTN","FHOMDPA",7,0)
 ; DFN=IEN in file #2 (or NULL), IEN200=IEN in file #200 (or NULL)
"RTN","FHOMDPA",8,0)
 ;
"RTN","FHOMDPA",9,0)
 S (FHZ115,FHDFN,IEN200)="",FHALL=$G(FHALL)
"RTN","FHOMDPA",10,0)
 R !!,"Select Patient (Name or SSN): ",X:DTIME I '$T!(U[X) D NOP Q
"RTN","FHOMDPA",11,0)
 S XRESP=X
"RTN","FHOMDPA",12,0)
 I XRESP=" " S FHDFN=$G(^DISV(DUZ,"^FHPT(")) I FHDFN'="" D PATNAME^FHOMUTL W FHPTNM K:DFN="" FHALL Q:DFN=""  S Y=DFN D FX1 K FHALL Q
"RTN","FHOMDPA",13,0)
 K DIC S DIC=2,DIC(0)="EZM" D ^DIC K DIC I U[X D NOP Q
"RTN","FHOMDPA",14,0)
 S FHYIEN=+Y,DFN=FHYIEN
"RTN","FHOMDPA",15,0)
FX1 I FHALL=1,$D(^DPT(DFN,.1)) D ENOM^FHDPA K FHALL Q
"RTN","FHOMDPA",16,0)
 I $D(^DPT(DFN,.1)) D MSG K FHALL Q
"RTN","FHOMDPA",17,0)
 I DFN>0 D VER I Y="^" D NOP Q
"RTN","FHOMDPA",18,0)
 I Y=0,XRESP=" " D F1 Q
"RTN","FHOMDPA",19,0)
 I Y=1 S FHZ115="P"_DFN D ADD K FHALL Q
"RTN","FHOMDPA",20,0)
FF11 ;
"RTN","FHOMDPA",21,0)
 S X=XRESP K DIC S DIC=200,DIC(0)="EQZM" D ^DIC K DIC I U[X D NOP Q
"RTN","FHOMDPA",22,0)
 S FHYIEN=+Y,IEN200=FHYIEN
"RTN","FHOMDPA",23,0)
 I IEN200>0 D VER I Y="^"!(Y=0) K FHALL Q
"RTN","FHOMDPA",24,0)
 I IEN200<1 W !!,"NOT FOUND IN 2 OR 200" D F1 K FHALL Q
"RTN","FHOMDPA",25,0)
 S FHZ115="N"_IEN200 D ADD
"RTN","FHOMDPA",26,0)
 K FHALL Q
"RTN","FHOMDPA",27,0)
VER ;
"RTN","FHOMDPA",28,0)
 W ! S DIR(0)="YA",DIR("A")="Correct? ",DIR("B")="Y" D ^DIR
"RTN","FHOMDPA",29,0)
 Q
"RTN","FHOMDPA",30,0)
ADD ; ADD ENTRY IF NOT ALREADY IN FILE 115
"RTN","FHOMDPA",31,0)
 D CHECK I FLAG=1 Q
"RTN","FHOMDPA",32,0)
 K DD,DO S DIC="^FHPT(",DIC(0)="L",X=FHZ115 D FILE^DICN
"RTN","FHOMDPA",33,0)
 S FHDFN=$O(^FHPT("B",FHZ115,"")) I FHDFN="" Q
"RTN","FHOMDPA",34,0)
 S ^DISV(DUZ,"^FHPT(")=FHDFN  ;save SPACEBAR/RETURN value
"RTN","FHOMDPA",35,0)
 S FHPTTYP=$E(FHZ115,1),FHPTR=$E(FHZ115,2,99)
"RTN","FHOMDPA",36,0)
 I FHPTTYP="P" D
"RTN","FHOMDPA",37,0)
 .K DIE S DA=FHDFN,DIE="^FHPT(",DR="14////^S X=FHPTR;15///@" D ^DIE
"RTN","FHOMDPA",38,0)
 I FHPTTYP="N" D
"RTN","FHOMDPA",39,0)
 .K DIE S DA=FHDFN,DIE="^FHPT(",DR="15////^S X=FHPTR;14///@" D ^DIE
"RTN","FHOMDPA",40,0)
 Q
"RTN","FHOMDPA",41,0)
CHECK ; CHECK IF ALREADY IN FILE 115
"RTN","FHOMDPA",42,0)
 S FLAG=0,FHDFN=""
"RTN","FHOMDPA",43,0)
 I $D(^FHPT("B",FHZ115)) D
"RTN","FHOMDPA",44,0)
 .S FLAG=1,FHDFN=$O(^FHPT("B",FHZ115,""))
"RTN","FHOMDPA",45,0)
 .S ^DISV(DUZ,"^FHPT(")=FHDFN  ;save SPACEBAR/RETURN value
"RTN","FHOMDPA",46,0)
 .I $E(FHZ115,1)="P" S DFN=$E(FHZ115,2,99),IEN200=""
"RTN","FHOMDPA",47,0)
 .I $E(FHZ115,1)="N" S IEN200=$E(FHZ115,2,99),DFN=""
"RTN","FHOMDPA",48,0)
 Q
"RTN","FHOMDPA",49,0)
MSG ;
"RTN","FHOMDPA",50,0)
 W !!,"Currently admitted as an Inpatient." D NOP
"RTN","FHOMDPA",51,0)
 Q
"RTN","FHOMDPA",52,0)
NOP ;
"RTN","FHOMDPA",53,0)
 S FHDFN=0,DFN=0,Y=-1 K FHALL Q
"RTN","FHOMDPA",54,0)
 Q
"RTN","FHOMELT")
0^63^B3319255
"RTN","FHOMELT",1,0)
FHOMELT ;Hines OIFO/RTK OUTPATIENT MEALS LIST EARLY/LATE TRAYS  ;5/10/04  12:35
"RTN","FHOMELT",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMELT",3,0)
 ;patch #5 - added outpt room-bed.
"RTN","FHOMELT",4,0)
 ;
"RTN","FHOMELT",5,0)
 ; FHP=PTR to COMM OFFICE, DTE=DATE in FILEMAN FORMAT, MEAL=B,N,E or A
"RTN","FHOMELT",6,0)
 ;K ^TMP($J)
"RTN","FHOMELT",7,0)
 S X1=DTE,X2=-1 D C^%DTC S FHRMDTE=X,X1=DTE,X2=1 D C^%DTC S FHDTQ=X
"RTN","FHOMELT",8,0)
 F FHOMDT=FHRMDTE:0 S FHOMDT=$O(^FHPT("RM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHDTQ)  D
"RTN","FHOMELT",9,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHOMELT",10,0)
 ..F FHRNUM=0:0 S FHRNUM=$O(^FHPT("RM",FHOMDT,FHDFN,FHRNUM)) Q:FHRNUM=""  D
"RTN","FHOMELT",11,0)
 ...I '$D(^FHPT(FHDFN,"OP",FHRNUM,2)) Q
"RTN","FHOMELT",12,0)
 ...S FHELN0=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMELT",13,0)
 ...S FHELN2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMELT",14,0)
 ...I $P(FHELN0,U,15)="C" Q
"RTN","FHOMELT",15,0)
 ...I $P(FHELN2,U,6)="C" Q
"RTN","FHOMELT",16,0)
 ...S FHLOC=$P(FHELN0,U,3) I FHLOC="" Q
"RTN","FHOMELT",17,0)
 ...S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHCOMM="" Q
"RTN","FHOMELT",18,0)
 ...S FHMEAL=$P(FHELN0,U,4) I MEAL'="A",MEAL'=FHMEAL Q
"RTN","FHOMELT",19,0)
 ...I FHP>0,FHP'=FHCOMM Q
"RTN","FHOMELT",20,0)
 ...S RM=$P(FHELN0,U,18)
"RTN","FHOMELT",21,0)
 ...I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^DG(405.4,RM,0),U,1)
"RTN","FHOMELT",22,0)
 ...S FHMLTM=$P(FHELN2,U,1),FHBAG=$P(FHELN2,U,2)
"RTN","FHOMELT",23,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D DIETPAT^FHOMRR1 S FHDIET=FHDIETP
"RTN","FHOMELT",24,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)'="Y" S FHDIET=$P(FHELN0,U,2) I FHDIET'="" S FHDIET=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMELT",25,0)
 ...D PATNAME^FHOMUTL
"RTN","FHOMELT",26,0)
 ...S ^TMP($J,FHMEAL,FHMLTM_"~"_FHPTNM)=FHLOC_"^"_FHDFN_"^"_FHBAG_"^"_FHDIET_"^"_$E(RM,1,10)
"RTN","FHOMELT",27,0)
 ...Q
"RTN","FHOMGC1")
0^20^B10471500
"RTN","FHOMGC1",1,0)
FHOMGC1 ;Hines OIFO/RTK GUEST MEALS CANCEL MEAL  ;11/21/05  12:55
"RTN","FHOMGC1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMGC1",3,0)
 ;
"RTN","FHOMGC1",4,0)
 S X1=DT,X2=-1 D C^%DTC S STDT=X_.99,ENDT=9999999
"RTN","FHOMGC1",5,0)
 D LIST I NUM=0 Q
"RTN","FHOMGC1",6,0)
 W ! K DIR S DIR("A")="Cancel Which Meal(s)?",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMGC1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMGC1",8,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMGC1",9,0)
 Q:$D(DIRUT)  I Y=0 D END Q
"RTN","FHOMGC1",10,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHCDT=FHLIST(FHC) D CAN
"RTN","FHOMGC1",11,0)
 W "  ... done" Q
"RTN","FHOMGC1",12,0)
 K DIR,STDT,ENDT Q
"RTN","FHOMGC1",13,0)
CAN ;
"RTN","FHOMGC1",14,0)
 S FHSTAT="C"
"RTN","FHOMGC1",15,0)
 S DA=$P(FHCDT,U,2),FHDA=DA,DA(1)=$P(FHCDT,U,1),FHDFN=DA(1)
"RTN","FHOMGC1",16,0)
 I '$D(^FHPT(DA(1),"GM",DA,0)) Q
"RTN","FHOMGC1",17,0)
 S DIE="^FHPT("_DA(1)_",""GM"","
"RTN","FHOMGC1",18,0)
 S DR="8////^S X=FHSTAT;9////^S X=DUZ" D ^DIE
"RTN","FHOMGC1",19,0)
 S FHZN=$G(^FHPT(FHDFN,"GM",FHDA,0))
"RTN","FHOMGC1",20,0)
 S FHACT="C",FHOPTY="G",FHOPDT=FHDA D SETGM^FHOMRO2
"RTN","FHOMGC1",21,0)
 Q
"RTN","FHOMGC1",22,0)
END ;
"RTN","FHOMGC1",23,0)
 K FHSTAT Q
"RTN","FHOMGC1",24,0)
 ;
"RTN","FHOMGC1",25,0)
LIST ; Display for cancel screen - First build data in ^TMP global
"RTN","FHOMGC1",26,0)
 K ^TMP($J) S NUM=0,EX=""
"RTN","FHOMGC1",27,0)
 F FHGMDT=STDT:0 S FHGMDT=$O(^FHPT("GM",FHGMDT)) Q:FHGMDT'>0!(FHGMDT>ENDT)  D
"RTN","FHOMGC1",28,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHGMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMGC1",29,0)
 ..S FHZN=$G(^FHPT(FHDFN,"GM",FHGMDT,0)),FHST=$P(FHZN,U,9) I FHST="C" Q
"RTN","FHOMGC1",30,0)
 ..D PATNAME^FHOMUTL I FHDFN="" Q
"RTN","FHOMGC1",31,0)
 ..S FHLOC=$P(FHZN,U,5) Q:FHLOC=""
"RTN","FHOMGC1",32,0)
 ..S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMGC1",33,0)
 ..S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMGC1",34,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMGC1",35,0)
 ..S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHGMDT,FHPTNM_"~"_FHDFN)=FHZN
"RTN","FHOMGC1",36,0)
 ..Q
"RTN","FHOMGC1",37,0)
 .Q
"RTN","FHOMGC1",38,0)
 I '$D(^TMP($J)) W !!,"THERE ARE CURRENTLY NO GUEST MEALS TO CANCEL" Q
"RTN","FHOMGC1",39,0)
 D HDR
"RTN","FHOMGC1",40,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMGC1",41,0)
 .F FHGMDT=STDT:0 S FHGMDT=$O(^TMP($J,FHLSRT,FHGMDT)) Q:FHGMDT'>0!(FHGMDT>ENDT)!(EX=U)  D
"RTN","FHOMGC1",42,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHGMDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMGC1",43,0)
 ...S FHNODE=$G(^TMP($J,FHLSRT,FHGMDT,FHPTN))
"RTN","FHOMGC1",44,0)
 ...S NUM=NUM+1,PAD=$S($L(NUM)=1:" ",1:"") W !,PAD,NUM
"RTN","FHOMGC1",45,0)
 ...S FHDFN=$P(FHPTN,"~",2) D PATNAME^FHOMUTL W ?4,$E(FHPTNM,1,20)
"RTN","FHOMGC1",46,0)
 ...S FHCL=$P(FHNODE,U,2),FHML=$P(FHNODE,U,3),FHCH=$P(FHNODE,U,4)
"RTN","FHOMGC1",47,0)
 ...S FHLPT=$P(FHNODE,U,5) I FHLPT="" Q
"RTN","FHOMGC1",48,0)
 ...S FHRMBD=$P(FHNODE,U,11),FHRMBNM=""
"RTN","FHOMGC1",49,0)
 ...I FHRMBD'="" S FHRMBNM="/"_$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,11)
"RTN","FHOMGC1",50,0)
 ...I FHRMBNM="" S FHLOC=$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,24)
"RTN","FHOMGC1",51,0)
 ...I FHRMBNM'="" S FHLOC=$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,12)
"RTN","FHOMGC1",52,0)
 ...S FHCL=$S(FHCL="E":"EMP",FHCL="G":"GRAT",FHCL="O":"OOD",FHCL="P":"PAID",1:"VOL")
"RTN","FHOMGC1",53,0)
 ...S FHD=$$FMTE^XLFDT(FHGMDT,"P") W ?25,$E(FHD,1,12)
"RTN","FHOMGC1",54,0)
 ...W ?38,FHLOC,FHRMBNM,?64,FHML,?68,FHCL,?74,FHCH
"RTN","FHOMGC1",55,0)
 ...S FHLIST(NUM)=FHDFN_"^"_FHGMDT
"RTN","FHOMGC1",56,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMGC1",57,0)
 ..Q
"RTN","FHOMGC1",58,0)
 .Q
"RTN","FHOMGC1",59,0)
 Q
"RTN","FHOMGC1",60,0)
PG ;
"RTN","FHOMGC1",61,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMGC1",62,0)
 D HDR Q
"RTN","FHOMGC1",63,0)
HDR ;
"RTN","FHOMGC1",64,0)
 W:$Y @IOF
"RTN","FHOMGC1",65,0)
 W !?5,"G U E S T   M E A L   L I S T"
"RTN","FHOMGC1",66,0)
 W !!," # ",?4,"Name",?25,"Date",?38,"Location",?63,"Meal"
"RTN","FHOMGC1",67,0)
 W ?68,"Class",?74,"Charge"
"RTN","FHOMGC1",68,0)
 W !,"===",?4,"====================",?25,"============"
"RTN","FHOMGC1",69,0)
 W ?38,"========================",?63,"====",?68,"=====",?74,"======"
"RTN","FHOMGC1",70,0)
 Q
"RTN","FHOMGP1")
0^13^B14808548
"RTN","FHOMGP1",1,0)
FHOMGP1 ;Hines OIFO/RTK PRINT GUEST MEALS LIST  ;6/30/03  15:45
"RTN","FHOMGP1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMGP1",3,0)
 ;
"RTN","FHOMGP1",4,0)
 W @IOF,!!?20,"G U E S T   M E A L S   L I S T"
"RTN","FHOMGP1",5,0)
EN ;
"RTN","FHOMGP1",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMGP1",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMGP1",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMGP1",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMGP1",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMGP1",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMGP1",12,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLCOM="" Q
"RTN","FHOMGP1",13,0)
 .S FHSLCOM=+Y
"RTN","FHOMGP1",14,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMGP1",15,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMGP1",16,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLPRO="" Q
"RTN","FHOMGP1",17,0)
 .S FHSLPRO=+Y
"RTN","FHOMGP1",18,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMGP1",19,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMGP1",20,0)
 S ENDT=ENDT_.99
"RTN","FHOMGP1",21,0)
 D DEV,EN Q
"RTN","FHOMGP1",22,0)
DEV ;get device and set up queue
"RTN","FHOMGP1",23,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMGP1",24,0)
 I '$D(IO("Q")) U IO D LIST,^%ZISC,END Q
"RTN","FHOMGP1",25,0)
 S ZTRTN="LIST^FHOMGP1"
"RTN","FHOMGP1",26,0)
 S ZTSAVE("STDT")="",ZTSAVE("ENDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMGP1",27,0)
 S ZTSAVE("FHLBY")="",ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")="",ZTSAVE("FHSLPRO")=""
"RTN","FHOMGP1",28,0)
 S ZTDESC="Guest Meals Display" D ^%ZTLOAD
"RTN","FHOMGP1",29,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMGP1",30,0)
 D END Q
"RTN","FHOMGP1",31,0)
LIST ; First build data in ^TMP global
"RTN","FHOMGP1",32,0)
 K ^TMP($J) S NUM=0,EX="",FHPG=0
"RTN","FHOMGP1",33,0)
 F FHGMDT=STDT:0 S FHGMDT=$O(^FHPT("GM",FHGMDT)) Q:FHGMDT'>0!(FHGMDT>ENDT)  D
"RTN","FHOMGP1",34,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHGMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMGP1",35,0)
 ..S FHZN=$G(^FHPT(FHDFN,"GM",FHGMDT,0)),FHST=$P(FHZN,U,9) I FHST="C" Q
"RTN","FHOMGP1",36,0)
 ..D PATNAME^FHOMUTL
"RTN","FHOMGP1",37,0)
 ..S FHLOC=$P(FHZN,U,5) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMGP1",38,0)
 ..S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMGP1",39,0)
 ..S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMGP1",40,0)
 ..S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMGP1",41,0)
 ..S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMGP1",42,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMGP1",43,0)
 ..S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHGMDT,FHPTNM_"~"_FHDFN)=FHZN
"RTN","FHOMGP1",44,0)
 ..Q
"RTN","FHOMGP1",45,0)
 .Q
"RTN","FHOMGP1",46,0)
 ; Now display data from the ^TMP global
"RTN","FHOMGP1",47,0)
 I '$D(^TMP($J)) W !!,"THERE ARE CURRENTLY NO GUEST MEALS TO PRINT" Q
"RTN","FHOMGP1",48,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMGP1",49,0)
 .D:FHPG>0&(IOST?1"C".E) PG Q:EX=U
"RTN","FHOMGP1",50,0)
 .D HDR S FHPG=FHPG+1
"RTN","FHOMGP1",51,0)
 .F FHGMDT=0:0 S FHGMDT=$O(^TMP($J,FHLSRT,FHGMDT)) Q:FHGMDT'>0!(EX=U)  D
"RTN","FHOMGP1",52,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHGMDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMGP1",53,0)
 ...S FHNODE=$G(^TMP($J,FHLSRT,FHGMDT,FHPTN)),FHLOC=$P(FHNODE,U,5)
"RTN","FHOMGP1",54,0)
 ...S FHLOCZN=$G(^FH(119.6,FHLOC,0))
"RTN","FHOMGP1",55,0)
 ...S FHRMBD=$P(FHNODE,U,11),FHRMBNM=""
"RTN","FHOMGP1",56,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,11)
"RTN","FHOMGP1",57,0)
 ...S FHDFN=$P(FHPTN,"~",2)  ;,FHLIST(NUM)=FHDFN_"^"_FHGMDT
"RTN","FHOMGP1",58,0)
 ...S FHCL=$P(FHNODE,U,2),FHML=$P(FHNODE,U,3),FHCH=$P(FHNODE,U,4)
"RTN","FHOMGP1",59,0)
 ...S FHSTAT=$P(FHNODE,U,9),NUM=NUM+1
"RTN","FHOMGP1",60,0)
 ...S FHCL=$S(FHCL="E":"EMP",FHCL="G":"GRAT",FHCL="O":"OOD",FHCL="P":"PAID",1:"VOL")
"RTN","FHOMGP1",61,0)
 ...S FHLOC=$E($P($G(^FH(119.6,FHLOC,0)),U,1),1,12)
"RTN","FHOMGP1",62,0)
 ...; S PAD=$S($L(NUM)=1:" ",1:"") W !,PAD,NUM
"RTN","FHOMGP1",63,0)
 ...D PATNAME^FHOMUTL W !,$E(FHPTNM,1,22)
"RTN","FHOMGP1",64,0)
 ...S FHD=$$FMTE^XLFDT(FHGMDT,"P") W ?22,$E(FHD,1,12)
"RTN","FHOMGP1",65,0)
 ...W ?36,FHLOC,?49,FHRMBNM,?62,FHML,?67,FHCL,?74,FHCH
"RTN","FHOMGP1",66,0)
 ...S FHLIST(NUM)=FHDFN_"^"_FHGMDT
"RTN","FHOMGP1",67,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMGP1",68,0)
 ..Q
"RTN","FHOMGP1",69,0)
 .Q
"RTN","FHOMGP1",70,0)
 Q
"RTN","FHOMGP1",71,0)
END ;
"RTN","FHOMGP1",72,0)
 K DIR,ENDT,STDT,FHGMDT,FHML,FHCL,FHCH,FHSELOC,FHSLCOM,FHNODE,FHZN
"RTN","FHOMGP1",73,0)
 K FHSLPRO,FHPRD
"RTN","FHOMGP1",74,0)
 Q
"RTN","FHOMGP1",75,0)
PG ;
"RTN","FHOMGP1",76,0)
 ;Q:$O(^FHPT(FHDFN,"GM",FHGMDT))'>0
"RTN","FHOMGP1",77,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMGP1",78,0)
 D HDR Q
"RTN","FHOMGP1",79,0)
HDR ;
"RTN","FHOMGP1",80,0)
 W:$Y @IOF
"RTN","FHOMGP1",81,0)
 W !?5,"G U E S T   M E A L   L I S T"
"RTN","FHOMGP1",82,0)
 W !!?5,"LOCATION: ",$P(FHLSRT,"~",2)
"RTN","FHOMGP1",83,0)
 W !!,"Name",?22,"Date",?36,"Location",?49,"Room-Bed",?61,"Meal"
"RTN","FHOMGP1",84,0)
 W ?67,"Class",?74,"Charge"
"RTN","FHOMGP1",85,0)
 W !,"====================",?22,"============"
"RTN","FHOMGP1",86,0)
 W ?36,"============ ===========",?61,"====",?67,"=====",?74,"======"
"RTN","FHOMGP1",87,0)
 Q
"RTN","FHOMGR1")
0^33^B8112125
"RTN","FHOMGR1",1,0)
FHOMGR1 ;Hines OIFO/RTK GUEST MEALS REQUEST MEAL  ;4/17/03  09:45
"RTN","FHOMGR1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMGR1",3,0)
 ;
"RTN","FHOMGR1",4,0)
 D NOW^%DTC S STDT=X,FHDSDT=$$FMTE^XLFDT(STDT,"P") W !!,FHDSDT
"RTN","FHOMGR1",5,0)
 S FHMSG1="G" D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMGR1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMGR1",7,0)
CLASS ;Prompt for classification
"RTN","FHOMGR1",8,0)
 W ! K DIR,DIC S DIR("A")="Select Classification: "
"RTN","FHOMGR1",9,0)
 S DIR(0)="SAO^E:Employee;G:Gratuitous;O:OOD;P:Paid;V:Volunteer"
"RTN","FHOMGR1",10,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMGR1",11,0)
 I Y'=-1 S FHCLASS=Y
"RTN","FHOMGR1",12,0)
LOC ;Prompt for location
"RTN","FHOMGR1",13,0)
 D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMGR1",14,0)
 W ! D RMBED^FHOMUTL
"RTN","FHOMGR1",15,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8)
"RTN","FHOMGR1",16,0)
MEAL ;Prompt for meal
"RTN","FHOMGR1",17,0)
 K DIR,DIC S DIR("A")="Select Meal: "
"RTN","FHOMGR1",18,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMGR1",19,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMGR1",20,0)
 I Y'=-1 S FHMEAL=Y
"RTN","FHOMGR1",21,0)
DIET ;Stuff diet
"RTN","FHOMGR1",22,0)
 S FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHOMGR1",23,0)
 I FHDIET="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMGR1",24,0)
CHARGE ;Get charge
"RTN","FHOMGR1",25,0)
 S FHCHAR=""
"RTN","FHOMGR1",26,0)
 S F=$S(FHCLASS="E":12,FHCLASS="P":13,FHCLASS="O":14,FHCLASS="V":15,1:16)
"RTN","FHOMGR1",27,0)
 S FHYN=$P($G(^FH(119.9,1,0)),U,F) I FHYN'="Y" W ! D SET1 Q
"RTN","FHOMGR1",28,0)
 S F=$S(FHCLASS="E":21,FHCLASS="P":24,FHCLASS="O":27,FHCLASS="V":30,1:33)
"RTN","FHOMGR1",29,0)
 S FHP=F+$S(FHMEAL="B":0,FHMEAL="N":1,1:2)
"RTN","FHOMGR1",30,0)
 S FHCHAR=$P($G(^FH(119.9,1,0)),U,FHP)
"RTN","FHOMGR1",31,0)
 W !!,"Payment amount = $",FHCHAR,!
"RTN","FHOMGR1",32,0)
SET1 K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMGR1",33,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMGR1",34,0)
 S FHGML=1 D SMGM^FHOMRO2 I SKIP=1 Q
"RTN","FHOMGR1",35,0)
SETNODE ;
"RTN","FHOMGR1",36,0)
 S MLT=$S(FHMEAL="B":".08",FHMEAL="N":".13",1:".18")
"RTN","FHOMGR1",37,0)
 S STDTIM=STDT_MLT
"RTN","FHOMGR1",38,0)
 I $D(^FHPT(FHDFN,"GM","B",STDTIM)),$P($G(^FHPT(FHDFN,"GM",STDTIM,0)),U,9)'="C" D MESSAGE Q
"RTN","FHOMGR1",39,0)
 S DA(1)=FHDFN,DA=STDTIM,DIK="^FHPT("_DA(1)_",""GM""," D ^DIK  ;delete if there is a previous canceled GM for this date/meal
"RTN","FHOMGR1",40,0)
 S Y=STDTIM K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""GM"","
"RTN","FHOMGR1",41,0)
 S DIC(0)="L",DIC("P")=$P(^DD(115,18,0),U,2),X=+Y,DINUM=X
"RTN","FHOMGR1",42,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMGR1",43,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""GM"","
"RTN","FHOMGR1",44,0)
 S DA=+Y,FHDA=DA
"RTN","FHOMGR1",45,0)
 S DR="1////^S X=FHCLASS;2////^S X=FHMEAL;3////^S X=FHCHAR;4////^S X=FHLOC;4.5////^S X=FHRMBD;5////^S X=FHDIET"
"RTN","FHOMGR1",46,0)
 D ^DIE,OKMSG^FHOMUTL
"RTN","FHOMGR1",47,0)
 S FHZN=$G(^FHPT(FHDFN,"GM",FHDA,0))
"RTN","FHOMGR1",48,0)
 S FHACT="O",FHOPTY="G",FHOPDT=STDT D SETGM^FHOMRO2 ;set event
"RTN","FHOMGR1",49,0)
 Q
"RTN","FHOMGR1",50,0)
MESSAGE ;
"RTN","FHOMGR1",51,0)
 D PATNAME^FHOMUTL S FHPREDT=$$FMTE^XLFDT(STDT,"P")
"RTN","FHOMGR1",52,0)
 W !!?3,FHPTNM," ALREADY HAS A "
"RTN","FHOMGR1",53,0)
 W $S(FHMEAL="B":"BREAKFAST",FHMEAL="N":"NOON",1:"EVENING")
"RTN","FHOMGR1",54,0)
 W " GUEST MEAL ORDERED FOR ",FHPREDT
"RTN","FHOMGR1",55,0)
 Q
"RTN","FHOMRBL1")
0^24^B28450165
"RTN","FHOMRBL1",1,0)
FHOMRBL1 ;Hines OIFO/RVD-OUTPATIENT REPORT UTILITY2  ;2/03/04  10:05
"RTN","FHOMRBL1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMRBL1",3,0)
 ;
"RTN","FHOMRBL1",4,0)
 ;PATCH #5 - added the cancelled guest meal status and a screen for cancelled meals.
"RTN","FHOMRBL1",5,0)
 ;
"RTN","FHOMRBL1",6,0)
GETGM(FHGDT,FHGCOM,FHGLOC,FHGDFN) ;get guest meals data
"RTN","FHOMRBL1",7,0)
 ;ENTRY POINTS:
"RTN","FHOMRBL1",8,0)
 ;          GETGM - get outpatient guest meals data from starting dt.
"RTN","FHOMRBL1",9,0)
 ;input variable:
"RTN","FHOMRBL1",10,0)
 ;         FHGDT        = starting date
"RTN","FHOMRBL1",11,0)
 ;         FHGCOM       = IEN of communication office, 'ALL' for all.
"RTN","FHOMRBL1",12,0)
 ;                      = if NULL, considered 'ALL'
"RTN","FHOMRBL1",13,0)
 ;         FHGLOC       = IEN of location, 'ALL' for all.
"RTN","FHOMRBL1",14,0)
 ;                      = if NULL, considered 'ALL'
"RTN","FHOMRBL1",15,0)
 ;         FHGDFN       = IEN of file #115, 'ALL' for all.
"RTN","FHOMRBL1",16,0)
 ;                      = if NULL, considered 'ALL'
"RTN","FHOMRBL1",17,0)
 ;
"RTN","FHOMRBL1",18,0)
 ;output variable:
"RTN","FHOMRBL1",19,0)
 ;         ^TMP($J,"OP","G",COMM OFF,PATIENT NAME,DTE)
"RTN","FHOMRBL1",20,0)
 ;
"RTN","FHOMRBL1",21,0)
 ;error:
"RTN","FHOMRBL1",22,0)
 ;         ^TMP($J,"OP","ER")
"RTN","FHOMRBL1",23,0)
 K ^TMP($J,"OP","G")
"RTN","FHOMRBL1",24,0)
 D NEWVAR
"RTN","FHOMRBL1",25,0)
 S:FHGDFN="" FHGDFN="ALL"
"RTN","FHOMRBL1",26,0)
 S:FHGCOM="" FHGCOM="ALL"
"RTN","FHOMRBL1",27,0)
 S:FHGLOC="" FHGLOC="ALL"
"RTN","FHOMRBL1",28,0)
 S FHGDT=FHGDT-.000001
"RTN","FHOMRBL1",29,0)
 I '$O(^FHPT("GM",FHGDT)) S ^TMP($J,"OP","ER")="NO GUEST MEALS FOR THIS DATE RANGE" Q
"RTN","FHOMRBL1",30,0)
 ;
"RTN","FHOMRBL1",31,0)
 F FHGMDT=FHGDT:0 S FHGMDT=$O(^FHPT("GM",FHGMDT)) Q:FHGMDT'>0  D
"RTN","FHOMRBL1",32,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHGMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMRBL1",33,0)
 ..I $G(FHGDFN),(FHGDFN'=FHDFN) Q
"RTN","FHOMRBL1",34,0)
 ..S (FHGCOMN,FHPTNM,FHLOCN)=""
"RTN","FHOMRBL1",35,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"GM",FHGMDT,0))
"RTN","FHOMRBL1",36,0)
 ..S FHCL=$P(FHNODE,U,2)
"RTN","FHOMRBL1",37,0)
 ..S FHML=$P(FHNODE,U,3)
"RTN","FHOMRBL1",38,0)
 ..S FHCH=$P(FHNODE,U,4)
"RTN","FHOMRBL1",39,0)
 ..S FHLPT=$P(FHNODE,U,5)
"RTN","FHOMRBL1",40,0)
 ..S FHDIET=$P(FHNODE,U,6)
"RTN","FHOMRBL1",41,0)
 ..S FHSTAT=$P(FHNODE,U,9)
"RTN","FHOMRBL1",42,0)
 ..I $G(FHGLOC),FHGLOC'=FHLPT Q   ;quit if location is not the same
"RTN","FHOMRBL1",43,0)
 ..S:$G(FHLPT) FHLCOM=$P($G(^FH(119.6,FHLPT,0)),U,8)
"RTN","FHOMRBL1",44,0)
 ..I $G(FHGCOM),FHGCOM'=FHLCOM Q  ;quit if d same communication office
"RTN","FHOMRBL1",45,0)
 ..S:$G(FHLCOM) FHGCOMN=$P($G(^FH(119.73,FHLCOM,0)),U,1)
"RTN","FHOMRBL1",46,0)
 ..S:FHGCOMN="" FHGCOMN="***"
"RTN","FHOMRBL1",47,0)
 ..I $G(FHLPT) D
"RTN","FHOMRBL1",48,0)
 ...S FHLOCN=$P($G(^FH(119.6,FHLPT,0)),U,1)
"RTN","FHOMRBL1",49,0)
 ..S:FHLOCN="" FHLOCN="***"
"RTN","FHOMRBL1",50,0)
 ..;
"RTN","FHOMRBL1",51,0)
 ..S FHCL=$S(FHCL="E":"EMPLOYEE",FHCL="G":"GRATUITOUS",FHCL="O":"OOD",FHCL="P":"PAID",1:"VOLUNTEER")
"RTN","FHOMRBL1",52,0)
 ..S FHD=$$FMTE^XLFDT(FHGMDT,"P")
"RTN","FHOMRBL1",53,0)
 ..S FHD=$E(FHD,1,12)
"RTN","FHOMRBL1",54,0)
 ..D PATNAME^FHOMUTL S FHPTNM=$E(FHPTNM,1,24)
"RTN","FHOMRBL1",55,0)
 ..S:FHPTNM="" FHPTNM="***"
"RTN","FHOMRBL1",56,0)
 ..S ^TMP($J,"OP","G",FHGCOMN,FHLOCN,FHPTNM,FHGMDT)=FHDFN_"^"_FHD_"^"_FHML_"^"_FHCL_"^"_FHCH_"^"_FHDIET_"^"_FHSTAT
"RTN","FHOMRBL1",57,0)
 Q
"RTN","FHOMRBL1",58,0)
 ;
"RTN","FHOMRBL1",59,0)
NEWVAR ;new all variables.
"RTN","FHOMRBL1",60,0)
 N FHPTNM,FHD,FHDIET,FHMEAL,FHELTT,FHELBG,FHDAT,FHSTAT,FHLPT
"RTN","FHOMRBL1",61,0)
 N FHAGE,FHCH,FHCL,FHDOB,FHGMDT,FHML,FHNODE,FHPCZN,FHSEX,FHSSN,FILE
"RTN","FHOMRBL1",62,0)
 N FHDAT,FHDPT,FHEL,FHLPT,FHS,FHSMDT,FHSTAT,FHNN,FH
"RTN","FHOMRBL1",63,0)
 Q
"RTN","FHOMRBL1",64,0)
 ;
"RTN","FHOMRBL1",65,0)
GETOUT ;get outpatient data for TODAY.
"RTN","FHOMRBL1",66,0)
 ;output variables:
"RTN","FHOMRBL1",67,0)
 ;         ^TMP($J,"FH",##LOCATION,PATIENT NAME,DATE)=OP or SM or GM^IEN OF 115^MEAL^
"RTN","FHOMRBL1",68,0)
 ;
"RTN","FHOMRBL1",69,0)
 K ^TMP($J)
"RTN","FHOMRBL1",70,0)
 N FHMEAL,FHDT,DT3,FHI,I,J,FHRMD,FHRMLNM,FHSMD,FHSMSTA,DFN,FHDFN
"RTN","FHOMRBL1",71,0)
 N DTTST,FHSMLNM,FHGMLNM
"RTN","FHOMRBL1",72,0)
 ;recurring meals
"RTN","FHOMRBL1",73,0)
 S FHDT=DT-.00001,DT3=DT+.999999
"RTN","FHOMRBL1",74,0)
 F FHI=FHDT:0 S FHI=$O(^FHPT("RM",FHI)) Q:(FHI>DT3)!(FHI="")  F I=0:0 S I=$O(^FHPT("RM",FHI,I)) Q:I'>0  D
"RTN","FHOMRBL1",75,0)
 .F J=0:0 S J=$O(^FHPT("RM",FHI,I,J)) Q:J'>0  D
"RTN","FHOMRBL1",76,0)
 ..S (FHRMD,FHMEAL)=""
"RTN","FHOMRBL1",77,0)
 ..S FHRMLNM="***"
"RTN","FHOMRBL1",78,0)
 ..I $D(^FHPT(I,"OP",J,0)) S FHRMD=$G(^FHPT(I,"OP",J,0))
"RTN","FHOMRBL1",79,0)
 ..Q:$P(FHRMD,U,15)="C"
"RTN","FHOMRBL1",80,0)
 ..I $D(FHRMD) S FHMEAL=$P(FHRMD,U,2)
"RTN","FHOMRBL1",81,0)
 ..S FHDFN=I D PATNAME^FHOMUTL Q:DFN=""
"RTN","FHOMRBL1",82,0)
 ..S:FHMEAL="" FHMEAL=$P(FHRMD,U,7)
"RTN","FHOMRBL1",83,0)
 ..S:FHMEAL="" FHMEAL=$P(FHRMD,U,8)
"RTN","FHOMRBL1",84,0)
 ..S:FHMEAL="" FHMEAL=$P(FHRMD,U,9)
"RTN","FHOMRBL1",85,0)
 ..S:FHMEAL="" FHMEAL=$P(FHRMD,U,10)
"RTN","FHOMRBL1",86,0)
 ..S:FHMEAL="" FHMEAL=$P(FHRMD,U,11)
"RTN","FHOMRBL1",87,0)
 ..S FHRMLOC=$P(FHRMD,U,3) Q:FHRMLOC=""
"RTN","FHOMRBL1",88,0)
 ..S FHML=$P(FHRMD,U,4)
"RTN","FHOMRBL1",89,0)
 ..I $G(FHRMLOC),$D(^FH(119.6,FHRMLOC,0)) D
"RTN","FHOMRBL1",90,0)
 ...S FHRMLNM=$P(^FH(119.6,FHRMLOC,0),U,1)
"RTN","FHOMRBL1",91,0)
 ...S FHRMPR=$P(^FH(119.6,FHRMLOC,0),U,4)
"RTN","FHOMRBL1",92,0)
 ...S FHRMSTA=$P(^FH(119.6,FHRMLOC,0),U,8)
"RTN","FHOMRBL1",93,0)
 ...S:FHRMPR<10 FHRMPR=0_FHRMPR
"RTN","FHOMRBL1",94,0)
 ...S:FHRMPR="" FHRMPR=99
"RTN","FHOMRBL1",95,0)
 ..S ^TMP($J,"FH",FHRMPR_FHRMLNM,FHPTNM,FHI,J)="OP"_"^"_I_"^"_FHMEAL_"^"_FHRMSTA_"^"_FHML_"^"_FHRMLOC_"^"_J
"RTN","FHOMRBL1",96,0)
SM ;special meals
"RTN","FHOMRBL1",97,0)
 S FHDT=DT-.00001,DTTST=$P(DT,".",1),DT3=DTTST+1
"RTN","FHOMRBL1",98,0)
 F FHI=FHDT:0 S FHI=$O(^FHPT("SM",FHI)) Q:(FHI>DT3)!(FHI="")  F I=0:0 S I=$O(^FHPT("SM",FHI,I)) Q:I'>0  D
"RTN","FHOMRBL1",99,0)
 .F J=0:0 S J=$O(^FHPT("SM",FHI,I,J)) Q:J'>0  D
"RTN","FHOMRBL1",100,0)
 ..S (FHSMD,FHMEAL)=""
"RTN","FHOMRBL1",101,0)
 ..S FHSMSTA=""
"RTN","FHOMRBL1",102,0)
 ..I $D(^FHPT(I,"SM",J,0)) S FHSMD=$G(^FHPT(I,"SM",J,0))
"RTN","FHOMRBL1",103,0)
 ..Q:$P(FHSMD,U,2)'="A"
"RTN","FHOMRBL1",104,0)
 ..I $D(FHSMD) S FHMEAL=$P(FHSMD,U,4)
"RTN","FHOMRBL1",105,0)
 ..S FHDFN=I D PATNAME^FHOMUTL Q:DFN=""
"RTN","FHOMRBL1",106,0)
 ..S FHSMLOC=$P(FHSMD,U,3) Q:FHSMLOC=""
"RTN","FHOMRBL1",107,0)
 ..S FHSMSTA=$P(FHSMD,U,2)
"RTN","FHOMRBL1",108,0)
 ..S FHML=$P(FHSMD,U,9)
"RTN","FHOMRBL1",109,0)
 ..I $G(FHSMLOC),$D(^FH(119.6,FHSMLOC,0)) D
"RTN","FHOMRBL1",110,0)
 ...S FHSMLNM=$P(^FH(119.6,FHSMLOC,0),U,1)
"RTN","FHOMRBL1",111,0)
 ...S FHSMPR=$P(^FH(119.6,FHSMLOC,0),U,4)
"RTN","FHOMRBL1",112,0)
 ...S FHSMSTA=$P(^FH(119.6,FHSMLOC,0),U,8)
"RTN","FHOMRBL1",113,0)
 ...S:FHSMPR<10 FHSMPR=0_FHSMPR
"RTN","FHOMRBL1",114,0)
 ...S:FHSMPR="" FHSMPR=99
"RTN","FHOMRBL1",115,0)
 ..S ^TMP($J,"FH",FHSMPR_FHSMLNM,FHPTNM,J)="SM"_"^"_I_"^"_FHMEAL_"^"_FHSMSTA_"^"_FHML_"^"_FHSMLOC_"^"_J
"RTN","FHOMRBL1",116,0)
 ;guest meals
"RTN","FHOMRBL1",117,0)
 S FHDT=DT-.00001,DTTST=$P(DT,".",1),DT3=DTTST+1
"RTN","FHOMRBL1",118,0)
 F FHI=FHDT:0 S FHI=$O(^FHPT("GM",FHI)) Q:(FHI>DT3)!(FHI="")  F I=0:0 S I=$O(^FHPT("GM",FHI,I)) Q:I'>0  D
"RTN","FHOMRBL1",119,0)
 .F J=0:0 S J=$O(^FHPT("GM",FHI,I,J)) Q:J'>0  D
"RTN","FHOMRBL1",120,0)
 ..S (FHSMD,FHMEAL)=""
"RTN","FHOMRBL1",121,0)
 ..S FHSMSTA=""
"RTN","FHOMRBL1",122,0)
 ..S FHSMLNM="***"
"RTN","FHOMRBL1",123,0)
 ..I $D(^FHPT(I,"GM",J,0)) S FHSMD=$G(^FHPT(I,"GM",J,0))
"RTN","FHOMRBL1",124,0)
 ..Q:$P(FHSMD,U,9)="C"
"RTN","FHOMRBL1",125,0)
 ..I $D(FHSMD) S FHMEAL=$P(FHSMD,U,6)
"RTN","FHOMRBL1",126,0)
 ..S FHDFN=I D PATNAME^FHOMUTL Q:DFN=""
"RTN","FHOMRBL1",127,0)
 ..S FHSMLOC=$P(FHSMD,U,5) Q:FHSMLOC=""
"RTN","FHOMRBL1",128,0)
 ..S FHML=$P(FHSMD,U,3)
"RTN","FHOMRBL1",129,0)
 ..I $G(FHSMLOC),$D(^FH(119.6,FHSMLOC,0)) D
"RTN","FHOMRBL1",130,0)
 ...S FHSMLNM=$P(^FH(119.6,FHSMLOC,0),U,1)
"RTN","FHOMRBL1",131,0)
 ...S FHSMSTA=$P(^FH(119.6,FHSMLOC,0),U,8)
"RTN","FHOMRBL1",132,0)
 ...S FHSMPR=$P(^FH(119.6,FHSMLOC,0),U,4)
"RTN","FHOMRBL1",133,0)
 ...S:FHSMPR<10 FHSMPR=0_FHSMPR
"RTN","FHOMRBL1",134,0)
 ...S:FHSMPR="" FHSMPR=99
"RTN","FHOMRBL1",135,0)
 ..S ^TMP($J,"FH",FHSMPR_FHSMLNM,FHPTNM,J)="GM"_"^"_I_"^"_FHMEAL_"^"_FHSMSTA_"^"_FHML_"^"_FHSMLOC_"^"_J
"RTN","FHOMRBL1",136,0)
 Q
"RTN","FHOMRC2")
0^37^B5901029
"RTN","FHOMRC2",1,0)
FHOMRC2 ;Hines OIFO/RTK BACKDOOR CANCEL OUTPATIENT MEALS  ;4/27/05  10:05
"RTN","FHOMRC2",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHOMRC2",3,0)
 ;
"RTN","FHOMRC2",4,0)
CNRM100 ;Backdoor message to update file #100 with RM cancel order
"RTN","FHOMRC2",5,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,12)
"RTN","FHOMRC2",6,0)
 S FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHOMRC2",7,0)
 S FHDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHOMRC2",8,0)
 S FILL="R;"_FHMPNUM_";"_FHDT_";"_FHDT_";;"
"RTN","FHOMRC2",9,0)
 D CHECK
"RTN","FHOMRC2",10,0)
 I FHACTV=0 D CAN
"RTN","FHOMRC2",11,0)
 I FHACTV=1 D CANOCC
"RTN","FHOMRC2",12,0)
ASSOC I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D CNAO100,CANAO^FHOMRC1
"RTN","FHOMRC2",13,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D CNEL100,CANEL^FHOMRC1
"RTN","FHOMRC2",14,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D CNTF100,CANTF^FHOMRC1
"RTN","FHOMRC2",15,0)
 Q
"RTN","FHOMRC2",16,0)
CNAO100 ;Backdoor message to update file #100 with AO cancel order
"RTN","FHOMRC2",17,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,4),FILL="A;"_FHRNUM D CAN Q
"RTN","FHOMRC2",18,0)
CNEL100 ;Backdoor message to update file #100 with EL cancel order
"RTN","FHOMRC2",19,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,5),FILL="E;"_FHRNUM D CAN Q
"RTN","FHOMRC2",20,0)
CNTF100 ;Backdoor message to update file #100 with TF cancel order
"RTN","FHOMRC2",21,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,4),FILL="T;"_FHRNUM D CAN Q
"RTN","FHOMRC2",22,0)
CNIP100 ;Backdoor message to update file #100 with IP cancel order
"RTN","FHOMRC2",23,0)
 S FHORN=$P($G(^FHPT(FHDFN,0)),U,6),FILL="I;CANCEL" D CAN Q
"RTN","FHOMRC2",24,0)
CNSM100 ;Backdoor message to update file #100 with SM cancel order
"RTN","FHOMRC2",25,0)
 S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12),FILL="S;"_FHDA D CAN
"RTN","FHOMRC2",26,0)
 ;if an SM E/L Tray exists cancel that too:
"RTN","FHOMRC2",27,0)
CNSMEL S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,1)),U,4) I FHORN="" Q
"RTN","FHOMRC2",28,0)
 S FILL="G;"_FHDA D CAN Q
"RTN","FHOMRC2",29,0)
CAN ;
"RTN","FHOMRC2",30,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRC2",31,0)
 Q:'DFN  D MSHCA^FHOMUTL,EVSEND^FHWOR
"RTN","FHOMRC2",32,0)
 Q
"RTN","FHOMRC2",33,0)
CANOCC ; If cancelling occurences of RM (not ALL) then send "XX" message
"RTN","FHOMRC2",34,0)
 ; instead of "OC" which will cancel the entire order in CPRS.
"RTN","FHOMRC2",35,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRC2",36,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRC2",37,0)
 S FHOSTDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHOMRC2",38,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT)
"RTN","FHOMRC2",39,0)
 S MSG(4)="ORC|XX|"_FHORN_"^OR|"_FILL_"^FH||||^^^"_FHOSTDT_"^"_FHOSTDT
"RTN","FHOMRC2",40,0)
 S MSG(5)="ODS|||^^^FH-X^Meal Canceled^99OTH|"
"RTN","FHOMRC2",41,0)
 D EVSEND^FHWOR
"RTN","FHOMRC2",42,0)
 Q
"RTN","FHOMRC2",43,0)
CHECK ; Check if there are other "active" RM's to determine if entire order
"RTN","FHOMRC2",44,0)
 ; should be cancelled
"RTN","FHOMRC2",45,0)
 S FHACTV=0,FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHOMRC2",46,0)
 F FHINDX=0:0 S FHINDX=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHINDX)) Q:FHINDX'>0!(FHACTV=1)  D
"RTN","FHOMRC2",47,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHINDX,0)),U,1)<DT Q
"RTN","FHOMRC2",48,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHINDX,0)),U,15)'="C" S FHACTV=1
"RTN","FHOMRC2",49,0)
 .Q
"RTN","FHOMRC2",50,0)
 Q
"RTN","FHOMRL1")
0^32^B15819957
"RTN","FHOMRL1",1,0)
FHOMRL1 ;Hines OIFO/RTK OUTPATIENT MEALS RECURRING MEALS LIST  ;1/25/05  11:35
"RTN","FHOMRL1",2,0)
 ;;5.5;DIETETICS;**1,5**;Dec 22, 2004;Build 53
"RTN","FHOMRL1",3,0)
 ;
"RTN","FHOMRL1",4,0)
 W @IOF,!!?20,"R E C U R R I N G   M E A L S   L I S T"
"RTN","FHOMRL1",5,0)
START S (FHSELOC,FHSLCOM,FHSLPRO)=""
"RTN","FHOMRL1",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMRL1",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMRL1",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMRL1",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMRL1",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMRL1",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMRL1",12,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLCOM="" Q
"RTN","FHOMRL1",13,0)
 .S FHSLCOM=+Y
"RTN","FHOMRL1",14,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMRL1",15,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMRL1",16,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLPRO="" Q
"RTN","FHOMRL1",17,0)
 .S FHSLPRO=+Y
"RTN","FHOMRL1",18,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMRL1",19,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMRL1",20,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRL1",21,0)
 D DEV,START
"RTN","FHOMRL1",22,0)
 Q
"RTN","FHOMRL1",23,0)
DEV ;get device and set up queue
"RTN","FHOMRL1",24,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMRL1",25,0)
 I '$D(IO("Q")) U IO D DISP,^%ZISC,END Q
"RTN","FHOMRL1",26,0)
 S ZTRTN="DISP^FHOMRL1"
"RTN","FHOMRL1",27,0)
 S ZTSAVE("STDT")="",ZTSAVE("ENDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMRL1",28,0)
 S ZTSAVE("FHLBY")="",ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")="",ZTSAVE("FHSLPRO")=""
"RTN","FHOMRL1",29,0)
 S ZTDESC="Outpatient Meals Recurring Meals List" D ^%ZTLOAD
"RTN","FHOMRL1",30,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMRL1",31,0)
 D END Q
"RTN","FHOMRL1",32,0)
 Q
"RTN","FHOMRL1",33,0)
DISP ; First build data in ^TMP global
"RTN","FHOMRL1",34,0)
 K ^TMP($J) S EX="",FHPG=0
"RTN","FHOMRL1",35,0)
 F FHXRDT=STDT:0 S FHXRDT=$O(^FHPT("RM",FHXRDT)) Q:FHXRDT'>0!(FHXRDT>ENDT)!(EX=U)  D
"RTN","FHOMRL1",36,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHXRDT,FHDFN)) Q:FHDFN'>0!(EX=U)  D
"RTN","FHOMRL1",37,0)
 ..F FHRM=0:0 S FHRM=$O(^FHPT("RM",FHXRDT,FHDFN,FHRM)) Q:FHRM'>0!(EX=U)  D
"RTN","FHOMRL1",38,0)
 ...S FHZN=$G(^FHPT(FHDFN,"OP",FHRM,0)),FHST=$P(FHZN,U,15) I FHST="C" Q
"RTN","FHOMRL1",39,0)
 ...D PATNAME^FHOMUTL
"RTN","FHOMRL1",40,0)
 ...S FHLOC=$P(FHZN,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMRL1",41,0)
 ...S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMRL1",42,0)
 ...S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMRL1",43,0)
 ...S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMRL1",44,0)
 ...S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMRL1",45,0)
 ...S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMRL1",46,0)
 ...S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHXRDT,FHPTNM_"~"_FHRM_"~"_FHDFN)=FHZN
"RTN","FHOMRL1",47,0)
 ...Q
"RTN","FHOMRL1",48,0)
 ..Q
"RTN","FHOMRL1",49,0)
 .Q
"RTN","FHOMRL1",50,0)
 ; Now display data from the ^TMP global
"RTN","FHOMRL1",51,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMRL1",52,0)
 .D:FHPG>0&(IOST?1"C".E) PG Q:EX=U
"RTN","FHOMRL1",53,0)
 .D HDR S FHPG=FHPG+1
"RTN","FHOMRL1",54,0)
 .F FHXRDT=0:0 S FHXRDT=$O(^TMP($J,FHLSRT,FHXRDT)) Q:FHXRDT'>0!(EX=U)  D
"RTN","FHOMRL1",55,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHXRDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMRL1",56,0)
 ...S FHZN=$G(^TMP($J,FHLSRT,FHXRDT,FHPTN)),FHLOC=$P(FHZN,U,3)
"RTN","FHOMRL1",57,0)
 ...S FHLOCZN=$G(^FH(119.6,FHLOC,0)),FHRNUM=$P(FHPTN,"~",2)
"RTN","FHOMRL1",58,0)
 ...S FHRMBD=$P(FHZN,U,18),FHRMBNM=""
"RTN","FHOMRL1",59,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,14)
"RTN","FHOMRL1",60,0)
 ...S FHDFN=$P(FHPTN,"~",3)
"RTN","FHOMRL1",61,0)
 ...W ! S DTP=FHXRDT D DTP^FH W DTP
"RTN","FHOMRL1",62,0)
 ...W ?11,$E($P(FHPTN,"~",1),1,19)
"RTN","FHOMRL1",63,0)
 ...W ?32,$P(FHZN,U,4)
"RTN","FHOMRL1",64,0)
 ...S FHSRV=$P(FHLOCZN,U,10)
"RTN","FHOMRL1",65,0)
 ...S FHSPT=$S(FHSRV["T":$P(FHLOCZN,U,5),FHSRV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRL1",66,0)
 ...S FHSRVPT="" I FHSPT'="" S FHSRVPT=$P($G(^FH(119.72,FHSPT,0)),U,1)
"RTN","FHOMRL1",67,0)
 ...W ?36,$E(FHSRVPT,1,11),?48,FHRMBNM
"RTN","FHOMRL1",68,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D DIETPAT^FHOMRR1 W ?64,$E(FHDIETP,1,16)
"RTN","FHOMRL1",69,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)'="Y" S FHDPTR=$P(FHZN,U,2) Q:FHDPTR=""  W ?64,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,16)
"RTN","FHOMRL1",70,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRL1",71,0)
 Q
"RTN","FHOMRL1",72,0)
PG ;
"RTN","FHOMRL1",73,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRL1",74,0)
 D HDR Q
"RTN","FHOMRL1",75,0)
HDR ;
"RTN","FHOMRL1",76,0)
 W:$Y @IOF
"RTN","FHOMRL1",77,0)
 W !?25,"R E C U R R I N G   M E A L   L I S T"
"RTN","FHOMRL1",78,0)
 W !!?5,"LOCATION: ",$P(FHLSRT,"~",2)
"RTN","FHOMRL1",79,0)
 W !!,"Date",?11,"Patient Name",?31,"Meal",?36,"Service Pnt"
"RTN","FHOMRL1",80,0)
 W ?48,"Room-Bed",?64,"Diet Ordered"
"RTN","FHOMRL1",81,0)
 W !,"=========",?11,"===================",?31,"===="
"RTN","FHOMRL1",82,0)
 W ?36,"===========",?48,"==============",?64,"================"
"RTN","FHOMRL1",83,0)
 Q
"RTN","FHOMRL1",84,0)
END ;
"RTN","FHOMRL1",85,0)
 K ENDT,FHXRDT,FHRM,FHST,FHSLCOM,FHSLPRO,FHZN,STDT Q
"RTN","FHOMRMD")
0^38^B30220610
"RTN","FHOMRMD",1,0)
FHOMRMD ;Hines OIFO/RTK/FAI RECURRING MEALS REVIEW/DISPLAY  ;10/20/04  13:22
"RTN","FHOMRMD",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHOMRMD",3,0)
 ;patch #5 - added outpatient SOs & SFs.
"RTN","FHOMRMD",4,0)
 ;
"RTN","FHOMRMD",5,0)
DISP ;
"RTN","FHOMRMD",6,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRMD",7,0)
 I '$O(^FHPT(FHDFN,"OP","B",STDT)) W !!,"No Recurring Meals to Display" Q
"RTN","FHOMRMD",8,0)
 K FHLIST S EX="",NUM=0 D HDR I $G(ENDT)="" S ENDT=9999999.99
"RTN","FHOMRMD",9,0)
 F FHRMDT=STDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)!(EX=U)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0!(EX=U)  D
"RTN","FHOMRMD",10,0)
 .S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMRMD",11,0)
 .S FHRM=$P(FHNODE,U,1)
"RTN","FHOMRMD",12,0)
 .S NUM=NUM+1,PAD=$S($L(NUM)<3:3-$L(NUM),1:1) W !?PAD,NUM
"RTN","FHOMRMD",13,0)
 .S FHLIST(NUM)=FHRNUM_"^"_FHRM
"RTN","FHOMRMD",14,0)
 .S FHDOW=$$DOW^XLFDT(FHRM),FHDOW=$E(FHDOW,1,3)
"RTN","FHOMRMD",15,0)
 .S FHDTP=$$FMTE^XLFDT(FHRM,"P") W ?6,FHDOW," - ",$E(FHDTP,1,12)
"RTN","FHOMRMD",16,0)
 .S FHLPT=$P(FHNODE,U,3),FHLOCZN=$G(^FH(119.6,FHLPT,0)) D
"RTN","FHOMRMD",17,0)
 ..S FHLOC=$E($P(FHLOCZN,U,1),1,10),FHSERV=$P(FHLOCZN,U,10)
"RTN","FHOMRMD",18,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLOCZN,U,5),FHSERV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRMD",19,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMRMD",20,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMRMD",21,0)
 ..Q
"RTN","FHOMRMD",22,0)
 .W ?26,FHLOC,?38,$E(FHSRVPT,1,9)
"RTN","FHOMRMD",23,0)
 .W ?51,$P(FHNODE,U,4),?56,$P(FHNODE,U,5)
"RTN","FHOMRMD",24,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)="Y" D DIETPAT W ?60,$E(FHDIETP,1,12)
"RTN","FHOMRMD",25,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)'="Y" S FHDPTR=$P(FHNODE,U,2) Q:FHDPTR=""  W ?60,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,12)
"RTN","FHOMRMD",26,0)
 .S FHSTAT=$P(FHNODE,U,15) I FHSTAT="C" W ?76,"C"
"RTN","FHOMRMD",27,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",28,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D
"RTN","FHOMRMD",29,0)
 ..S FHNODE1=$G(^FHPT(FHDFN,"OP",FHRNUM,1))
"RTN","FHOMRMD",30,0)
 ..S FHSTATA=$P(FHNODE1,U,5) I FHSTATA="C" W !?7,"Additional Orders: ",$E($P(FHNODE1,U,1),1,46),?76,"C" Q
"RTN","FHOMRMD",31,0)
 ..W !?7,"Additional Orders: ",$P(FHNODE1,U,1)
"RTN","FHOMRMD",32,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHOMRMD",33,0)
 ..S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMRMD",34,0)
 ..S FHEL=FHNODE2
"RTN","FHOMRMD",35,0)
 ..W !?7,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMRMD",36,0)
 ..W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMRMD",37,0)
 ..S FHSTATE=$P(FHNODE2,U,6) I FHSTATE="C" W ?76,"C"
"RTN","FHOMRMD",38,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHOMRMD",39,0)
 ..S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3))
"RTN","FHOMRMD",40,0)
 ..S FHTU=FHNODE3
"RTN","FHOMRMD",41,0)
 ..W !?7,"Tubefeeding: " S FHSTATT=$P(FHTU,U,5) I FHSTATT="C" W ?76,"C"
"RTN","FHOMRMD",42,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMRMD",43,0)
 ...S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ,0))
"RTN","FHOMRMD",44,0)
 ...S FHTUPTR=$P(FHTUZN,U,1),FHTUSTR=$P(FHTUZN,U,2)
"RTN","FHOMRMD",45,0)
 ...W !?9,$P($G(^FH(118.2,FHTUPTR,0)),U,1),"  Strength: "
"RTN","FHOMRMD",46,0)
 ...W $S(FHTUSTR=1:"1/4",FHTUSTR=2:"1/2",FHTUSTR=3:"3/4",1:"FULL")
"RTN","FHOMRMD",47,0)
 ...I $P(FHTUZN,U,3)["CC" D  ;print ml instead of cc.
"RTN","FHOMRMD",48,0)
 ....S QUA=$P(FHTUZN,U,3)
"RTN","FHOMRMD",49,0)
 ....S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2)
"RTN","FHOMRMD",50,0)
 ....S $P(FHTUZN,U,3)=QUAFI_"ML"_QUASE
"RTN","FHOMRMD",51,0)
 ...W "  Quantity: ",$P(FHTUZN,U,3)
"RTN","FHOMRMD",52,0)
 ..W !?7,"Total ML's: ",$P(FHTU,U,2),"  Total KCALS/DAY: ",$P(FHTU,U,3)
"RTN","FHOMRMD",53,0)
 ..S FHTCOMM=$P(FHTU,U,1) I FHTCOMM'="" W !?7,"Comment: ",FHTCOMM
"RTN","FHOMRMD",54,0)
 .;outpatient SOs.
"RTN","FHOMRMD",55,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,"SP")) D
"RTN","FHOMRMD",56,0)
 ..I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",57,0)
 ..W !,?7,"Standing Orders:"
"RTN","FHOMRMD",58,0)
 ..S FHTZSOL=23,FHTZCNT=0
"RTN","FHOMRMD",59,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"SP",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMRMD",60,0)
 ...S FHTZSO=$G(^FHPT(FHDFN,"OP",FHRNUM,"SP",FHTZ,0))
"RTN","FHOMRMD",61,0)
 ...S FHTZSO2=$P(FHTZSO,U,2)
"RTN","FHOMRMD",62,0)
 ...S FHTZSO6=$P(FHTZSO,U,6)
"RTN","FHOMRMD",63,0)
 ...S FHTZSO8=$P(FHTZSO,U,8)
"RTN","FHOMRMD",64,0)
 ...S FHTZSOCN="" I FHTZSO6'="" S FHTZSOCN=" (C) "
"RTN","FHOMRMD",65,0)
 ...I $G(FHTZSO2),$D(^FH(118.3,FHTZSO2,0)) D
"RTN","FHOMRMD",66,0)
 ....S FHTZSON=$P(^FH(118.3,FHTZSO2,0),U,1)
"RTN","FHOMRMD",67,0)
 ....S FHTZSOL=FHTZSOL+$L(FHTZSON)+$L(FHTZSOCN)+7
"RTN","FHOMRMD",68,0)
 ....I FHTZSOL>80 W !,?23 S FHTZSOL=30+$L(FHTZSON)+$L(FHTZSOCN),FHTZCNT=0
"RTN","FHOMRMD",69,0)
 ....I $G(FHTZCNT) W ", ",FHTZSON,FHTZSOCN," = ",FHTZSO8
"RTN","FHOMRMD",70,0)
 ....E  W " ",FHTZSON,FHTZSOCN," = ",FHTZSO8
"RTN","FHOMRMD",71,0)
 ....S FHTZCNT=FHTZCNT+1
"RTN","FHOMRMD",72,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,"SF")) D
"RTN","FHOMRMD",73,0)
 ..Q:'$D(^FHPT(FHDFN,"OP",FHRNUM,"SF",0))
"RTN","FHOMRMD",74,0)
 ..S SF=""
"RTN","FHOMRMD",75,0)
 ..I $D(^FHPT(FHDFN,"OP",FHRNUM,"SF",0)) S SF=$P(^(0),U,3)
"RTN","FHOMRMD",76,0)
 ..Q:'SF
"RTN","FHOMRMD",77,0)
 ..S FHSFDAT=$G(^FHPT(FHDFN,"OP",FHRNUM,"SF",SF,0))
"RTN","FHOMRMD",78,0)
 ..I SF,$P(FHSFDAT,U,32) Q
"RTN","FHOMRMD",79,0)
 ..I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",80,0)
 ..W !,?7,"Supplemental Feeding: " I $P(FHSFDAT,U,4),$D(^FH(118.1,$P(FHSFDAT,U,4),0)) W $P(^(0),U,1)
"RTN","FHOMRMD",81,0)
 ..S FHSF10=$P(FHSFDAT,U,5,12)
"RTN","FHOMRMD",82,0)
 ..S FHSF2=$P(FHSFDAT,U,13,20)
"RTN","FHOMRMD",83,0)
 ..S FHSF8=$P(FHSFDAT,U,21,28)
"RTN","FHOMRMD",84,0)
 ..I FHSF10'["^^^^^^^" D
"RTN","FHOMRMD",85,0)
 ...W !,?9,"10AM:"
"RTN","FHOMRMD",86,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF10,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF10,U,FHI+1):1,1:$P(FHSF10,U,FHI+1))
"RTN","FHOMRMD",87,0)
 ..I FHSF2'["^^^^^^^" D
"RTN","FHOMRMD",88,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",89,0)
 ...W !,?9,"2PM:"
"RTN","FHOMRMD",90,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF2,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF2,U,FHI+1):1,1:$P(FHSF2,U,FHI+1))
"RTN","FHOMRMD",91,0)
 ..I FHSF8'["^^^^^^^" D
"RTN","FHOMRMD",92,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",93,0)
 ...W !,?9,"8PM:"
"RTN","FHOMRMD",94,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF8,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF8,U,FHI+1):1,1:$P(FHSF8,U,FHI+1))
"RTN","FHOMRMD",95,0)
 .Q
"RTN","FHOMRMD",96,0)
 W ! Q
"RTN","FHOMRMD",97,0)
DIETPAT ;
"RTN","FHOMRMD",98,0)
 S FHDIETS=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,7,11)
"RTN","FHOMRMD",99,0)
 S FHDIETP=""
"RTN","FHOMRMD",100,0)
 F PCE=1:1:5 D
"RTN","FHOMRMD",101,0)
 .S FHDPTR=$P(FHDIETS,U,PCE) I FHDPTR="" Q
"RTN","FHOMRMD",102,0)
 .S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,7)
"RTN","FHOMRMD",103,0)
 .I FHDNM="" S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,1)
"RTN","FHOMRMD",104,0)
 .S FHDIETP=FHDIETP_FHDNM_"," Q
"RTN","FHOMRMD",105,0)
 S FHDIETP=$E(FHDIETP,1,$L(FHDIETP)-1)
"RTN","FHOMRMD",106,0)
 Q
"RTN","FHOMRMD",107,0)
PG ;
"RTN","FHOMRMD",108,0)
 Q:$O(^FHPT(FHDFN,"OP","B",FHRMDT))'>0
"RTN","FHOMRMD",109,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRMD",110,0)
 D HDR Q
"RTN","FHOMRMD",111,0)
HDR ;
"RTN","FHOMRMD",112,0)
 I $G(FHPP)'=1 W:$Y @IOF
"RTN","FHOMRMD",113,0)
 K FHPP W !?15,"R E C U R R I N G   M E A L S"
"RTN","FHOMRMD",114,0)
 W !!?3,"NAME: " D PATNAME^FHOMUTL W FHPTNM,"   ",FHSSN
"RTN","FHOMRMD",115,0)
 W !!?27,"Ordering",?38,"Service"
"RTN","FHOMRMD",116,0)
 W !?2,"#",?6,"Date/Time",?27,"Location",?38,"Point"
"RTN","FHOMRMD",117,0)
 W ?50,"Meal",?55,"Bag",?60,"Diet Ordered",?74,"Status"
"RTN","FHOMRMD",118,0)
 W !?1,"===",?6,"==================",?26,"=========="
"RTN","FHOMRMD",119,0)
 W ?38,"==========",?50,"====",?55,"===",?60,"============",?74,"======"
"RTN","FHOMRMD",120,0)
 Q
"RTN","FHOMRMD",121,0)
END ;
"RTN","FHOMRMD",122,0)
 K EX,FHDIET,FHDIETP,FHDIETS,FHDTP,FHFIND,FHLOC,FHLPT,FHNODE,FHRM
"RTN","FHOMRMD",123,0)
 K FHRNUM,FHDPTR,FHDNM,FHTZCNT,FHTZSON,FHTZSOCN,FHTZSO8,FHTZSOL,FHTZSO2,FHTZSO6,FHTZ,FHTZSO Q
"RTN","FHOMRO1")
0^36^B80090398
"RTN","FHOMRO1",1,0)
FHOMRO1 ;Hines OIFO/RTK RECURRING MEALS ORDER EDIT  ;2/04/03  14:05
"RTN","FHOMRO1",2,0)
 ;;5.5;DIETETICS;**1,2,5**;Jan 28, 2005;Build 53
"RTN","FHOMRO1",3,0)
 ;
"RTN","FHOMRO1",4,0)
 S FHDIET="" F FHDX=1:1:5 S FHDIETX(FHDX)=""
"RTN","FHOMRO1",5,0)
 S FHMSG1="R" D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMRO1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMRO1",7,0)
 D NOW^%DTC S X1=$E(%,1,7),X2=-1 D C^%DTC S FHNOW=X D CHECK
"RTN","FHOMRO1",8,0)
 I FHEXST=1 D ORDEDT,END Q
"RTN","FHOMRO1",9,0)
 D ORDER,END Q
"RTN","FHOMRO1",10,0)
ORDEDT ;
"RTN","FHOMRO1",11,0)
 W !!,"This person has an existing outpatient diet order."
"RTN","FHOMRO1",12,0)
 K DIR S DIR(0)="SBO^E:Edit;O:New Order"
"RTN","FHOMRO1",13,0)
 S DIR("A")="Edit the existing diet or order another one" D ^DIR
"RTN","FHOMRO1",14,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",15,0)
 I Y="O" D ORDER Q
"RTN","FHOMRO1",16,0)
 I Y="E" D EDIT Q
"RTN","FHOMRO1",17,0)
 Q
"RTN","FHOMRO1",18,0)
ORDER ;
"RTN","FHOMRO1",19,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",20,0)
 W ! D RMBED^FHOMUTL
"RTN","FHOMRO1",21,0)
DIETORD ;
"RTN","FHOMRO1",22,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" EXMSG^FHOMUTL Q:FHDIETX(1)=""  D DATE Q
"RTN","FHOMRO1",23,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",24,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMRO1",25,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",26,0)
 S DIC("B")=FHDEF,DIC("S")="I $D(FHDIETS(+Y))" D ^DIC
"RTN","FHOMRO1",27,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",28,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",29,0)
 S FHDIET=+Y
"RTN","FHOMRO1",30,0)
DATE ;
"RTN","FHOMRO1",31,0)
 K DIR S DIR("A")="Select Start Date: ",DIR(0)="DAO^DT" D ^DIR
"RTN","FHOMRO1",32,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",33,0)
 S (FHOSTDT,STDT)=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",34,0)
 S FHMAX=$P($G(^FH(119.6,FHLOC,1)),U,2) I FHMAX="" S FHMAX=999
"RTN","FHOMRO1",35,0)
 D NOW^%DTC S FHTODAY=$E(%,1,7),X1=FHTODAY,X2=FHMAX D C^%DTC S FHCUT=X
"RTN","FHOMRO1",36,0)
 K DIR S DIR("A")="Select End Date: ",DIR(0)="DAO^"_STDT_":"_FHCUT D ^DIR
"RTN","FHOMRO1",37,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",38,0)
 S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",39,0)
DAYS ;
"RTN","FHOMRO1",40,0)
 S FHIFLG=0 D SHDAYS
"RTN","FHOMRO1",41,0)
 K DIR S DIR("A")="Select Days of Week: ",DIR(0)="FAO"
"RTN","FHOMRO1",42,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",43,0)
 S FHDAYS=Y D DAYCHK I FHIFLG=1 D DAYS Q
"RTN","FHOMRO1",44,0)
 K DIR S DIR("A")="Select MEAL: "
"RTN","FHOMRO1",45,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMRO1",46,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",47,0)
 S FHMEAL=Y W !
"RTN","FHOMRO1",48,0)
 I STDT=DT S X=DT D H^%DTC I FHDAYS[$E("XMTWRFS",%Y+1) D CHECKSM I FHSMYES=1 D MSG1 S X1=STDT,X2=1 D C^%DTC S STDT=X I X>ENDT Q
"RTN","FHOMRO1",49,0)
 K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRO1",50,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",51,0)
 S STDTMP=STDT,FHTDTMP=FHTODAY I STDT=DT D CHK1^FHOMRO2
"RTN","FHOMRO1",52,0)
 D SETNODE,UPD100
"RTN","FHOMRO1",53,0)
 I FHSETFLG=0 W !!!?5,"No meals ordered!",! Q
"RTN","FHOMRO1",54,0)
 S FHMSG1="R" D OKMSG^FHOMUTL
"RTN","FHOMRO1",55,0)
 S FHLTFLG=0 I STDTMP=FHTDTMP D CHK2^FHOMRO2
"RTN","FHOMRO1",56,0)
 I FHLTFLG=1 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHTODAY,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",57,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",58,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",59,0)
 .S FHEL="L",FHRMDT=FHTODAY D ORD^FHOMRE1
"RTN","FHOMRO1",60,0)
 Q
"RTN","FHOMRO1",61,0)
SETNODE ;
"RTN","FHOMRO1",62,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1),FHADSFF=0 I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMRO1",63,0)
 S FHMPNUM=FHMPNUM+1,FHSETFLG=0
"RTN","FHOMRO1",64,0)
 K ODAYS S CCC=0,X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRO1",65,0)
 S ENDL=0 F  Q:ENDL=1  D
"RTN","FHOMRO1",66,0)
 .S CCC=CCC+1,X1=STDT,X2=1 D C^%DTC S STDT=X
"RTN","FHOMRO1",67,0)
 .I STDT>ENDT S ENDL=1 Q
"RTN","FHOMRO1",68,0)
 .S X=STDT D DOW^%DTC
"RTN","FHOMRO1",69,0)
 .I FHDAYS[$E("XMTWRFS",Y+1) S ODAYS(STDT)=STDT D SET
"RTN","FHOMRO1",70,0)
 .Q
"RTN","FHOMRO1",71,0)
 S FHACT="O",FHOPTY="R" D SETORX^FHOMRO2   ;creates RM events
"RTN","FHOMRO1",72,0)
 I $G(FHDPATT)="",FHDIET'="@" S FHDPATT=FHDIET_"^^^^"
"RTN","FHOMRO1",73,0)
 D SOSFFP^FHOMRO2   ;created diet related SO's, SF's, FP's
"RTN","FHOMRO1",74,0)
 D SOEVNT^FHSPED    ;creates so events
"RTN","FHOMRO1",75,0)
 D SFEVNT^FHNO7     ;creates sf events
"RTN","FHOMRO1",76,0)
 Q
"RTN","FHOMRO1",77,0)
SET ;
"RTN","FHOMRO1",78,0)
 S FHPREVML=0 D PREV I FHPREVML=1 Q
"RTN","FHOMRO1",79,0)
 S FHSETFLG=1
"RTN","FHOMRO1",80,0)
 ;I $O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",81,0)
 D CPRSO^FHSPED    ;check previous SO
"RTN","FHOMRO1",82,0)
 D CPRSF^FHNO7     ;check previous SF
"RTN","FHOMRO1",83,0)
 S Y=STDT K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",84,0)
 S DIC(0)="L"  ;,DIC("P")=$P(^DD(115,16,0),U,2),X=+Y,DINUM=X
"RTN","FHOMRO1",85,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMRO1",86,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",87,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN),DA=+Y
"RTN","FHOMRO1",88,0)
 S DR="1////^S X=FHDIET;2////^S X=FHLOC;2.5////^S X=FHRMBD;3////^S X=FHMEAL;5////^S X=FHMPNUM;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);.05////^S X=FHORN;24.5////^S X=DUZ" D ^DIE
"RTN","FHOMRO1",89,0)
 S ADM=DA
"RTN","FHOMRO1",90,0)
 D PPRSO^FHSPED    ;process previous SO automatically to the new Recurring meal entry.
"RTN","FHOMRO1",91,0)
 D PPRSF^FHNO7     ;process previous SF automatically.
"RTN","FHOMRO1",92,0)
 Q
"RTN","FHOMRO1",93,0)
MULTDT ;
"RTN","FHOMRO1",94,0)
 S FHDPATT="",FHDIET="@" F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",95,0)
 D ^FHOMRO3 I $O(FHDI(0))="" F FHDX=1:1:5 S FHDIETX(FHDX)="" Q
"RTN","FHOMRO1",96,0)
 S FHDX=0 F FHD0=0:0 S FHD0=$O(FHDI(FHD0)) Q:FHD0=""  S FHDX=FHDX+1,FHDIETX(FHDX)=$P(FHDI(FHD0),"^",1),FHDPATT=FHDPATT_FHDIETX(FHDX)_"^"
"RTN","FHOMRO1",97,0)
 Q
"RTN","FHOMRO1",98,0)
SHDAYS ;
"RTN","FHOMRO1",99,0)
 W !!,"          Mon  Tues  Wed  Thur  Fri  Sat  Sun"
"RTN","FHOMRO1",100,0)
 W !,"           M     T    W     R    F    S    X"
"RTN","FHOMRO1",101,0)
 W !!,"Enter string of characters for desired days of week: e.g., MWF",!
"RTN","FHOMRO1",102,0)
 Q
"RTN","FHOMRO1",103,0)
DAYCHK ;
"RTN","FHOMRO1",104,0)
 S X=FHDAYS D TR^FH S FHDAYS=X
"RTN","FHOMRO1",105,0)
 S X1="" F K=1:1 S Z=$E(FHDAYS,K) Q:Z=""!(FHIFLG=1)  D
"RTN","FHOMRO1",106,0)
 .I X1[Z S FHIFLG=1 Q
"RTN","FHOMRO1",107,0)
 .I "MTWRFSX"'[Z S FHIFLG=1 Q
"RTN","FHOMRO1",108,0)
 .S X1=X1_Z Q
"RTN","FHOMRO1",109,0)
 I FHIFLG=1 W !!,"Please enter the desired days of the week.",!
"RTN","FHOMRO1",110,0)
 Q
"RTN","FHOMRO1",111,0)
PREV ;
"RTN","FHOMRO1",112,0)
 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0!(FHPREVML=1)  D
"RTN","FHOMRO1",113,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",114,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",115,0)
 .D PATNAME^FHOMUTL S FHPREDT=$$FMTE^XLFDT(STDT,"P") I $G(FHHL7)'=1 D
"RTN","FHOMRO1",116,0)
 ..W !!?3,FHPTNM," ALREADY HAS A "
"RTN","FHOMRO1",117,0)
 ..W $S(FHMEAL="B":"BREAKFAST",FHMEAL="N":"NOON",1:"EVENING")
"RTN","FHOMRO1",118,0)
 ..W " MEAL ORDERED FOR ",FHPREDT
"RTN","FHOMRO1",119,0)
 .S FHPREVML=1
"RTN","FHOMRO1",120,0)
 Q
"RTN","FHOMRO1",121,0)
CHECK ;
"RTN","FHOMRO1",122,0)
 S FHEXST=0 I $O(^FHPT(FHDFN,"OP","B",FHNOW)) D
"RTN","FHOMRO1",123,0)
 .F FHRMDT=FHNOW:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)'="C" S FHEXST=1
"RTN","FHOMRO1",124,0)
 Q
"RTN","FHOMRO1",125,0)
CHECKSM ; Check if the OP has an existing SM for this date/meal
"RTN","FHOMRO1",126,0)
 S FHSMYES=0
"RTN","FHOMRO1",127,0)
 F FHZ=DT:0 S FHZ=$O(^FHPT(FHDFN,"SM","B",FHZ)) Q:FHZ'>0  D
"RTN","FHOMRO1",128,0)
 .I $P($G(^FHPT(FHDFN,"SM",FHZ,0)),U,9)'=FHMEAL Q
"RTN","FHOMRO1",129,0)
 .I $P($G(^FHPT(FHDFN,"SM",FHZ,0)),U,2)="C" Q
"RTN","FHOMRO1",130,0)
 .I $P($G(^FHPT(FHDFN,"SM",FHZ,0)),U,2)="D" Q
"RTN","FHOMRO1",131,0)
 .S FHSMYES=1
"RTN","FHOMRO1",132,0)
 Q
"RTN","FHOMRO1",133,0)
MSG1 ;
"RTN","FHOMRO1",134,0)
 W !!,"This patient already has a Special Meal ordered for "
"RTN","FHOMRO1",135,0)
 S DTP=DT D DTP^FH W DTP," "
"RTN","FHOMRO1",136,0)
 W $S(FHMEAL="B":"Breakfast",FHMEAL="N":"Noon",1:"Evening"),! H 1 Q
"RTN","FHOMRO1",137,0)
 ;
"RTN","FHOMRO1",138,0)
END ;Kill local variables before exiting
"RTN","FHOMRO1",139,0)
 D KILL^FHOMRO2
"RTN","FHOMRO1",140,0)
 Q
"RTN","FHOMRO1",141,0)
 ;
"RTN","FHOMRO1",142,0)
EDIT ;
"RTN","FHOMRO1",143,0)
 D NOW^%DTC S STDT=$E(%,1,7),FHDTRLE=%
"RTN","FHOMRO1",144,0)
 D DISP^FHOMRR1
"RTN","FHOMRO1",145,0)
EDT1 K DIR S DIR(0)="NAO^1:"_NUM,DIR("A")="Edit Which Order? " D ^DIR
"RTN","FHOMRO1",146,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",147,0)
 S ORDNUM=Y,Y=$P(FHLIST(ORDNUM),U,2) D DD^%DT W !,Y,!
"RTN","FHOMRO1",148,0)
 S DA=$P(FHLIST(ORDNUM),U,1),DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",149,0)
 I $P($G(^FHPT(FHDFN,"OP",DA,0)),U,15)="C" W !!?3,"The selected order has been cancelled!",! D EDT1 Q
"RTN","FHOMRO1",150,0)
 S FHLPT=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,3),FHMEAL=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,4)
"RTN","FHOMRO1",151,0)
 D OUTLOC I FHLOC="" D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",152,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" UPXMSG^FHOMUTL Q:FHDIETX(1)=""  S FHDIET="@" D SETEDT Q
"RTN","FHOMRO1",153,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",154,0)
 S FHDEF2=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,2) I FHDEF2'="" S FHDEF=$P($G(^FH(111,FHDEF2,0)),U,1)
"RTN","FHOMRO1",155,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",156,0)
 S DIC("B")=FHDEF,DIC("S")="I FHSPDTS[$P(^(0),U)" D ^DIC
"RTN","FHOMRO1",157,0)
 I $D(DUOUT) D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",158,0)
 I Y=-1 D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",159,0)
 S FHDIET=+Y F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",160,0)
SETEDT ;
"RTN","FHOMRO1",161,0)
 W ! S FHZDA=DA,DR="2////^S X=FHLOC;1////^S X=FHDIET;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);25////^S X=FHDTRLE;24.5////^S X=DUZ"
"RTN","FHOMRO1",162,0)
 D ^DIE,UPDMSG^FHOMUTL,ED100
"RTN","FHOMRO1",163,0)
 Q
"RTN","FHOMRO1",164,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMRO1",165,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMRO1",166,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ",DIC("B")=FHLPT
"RTN","FHOMRO1",167,0)
 S DIC("A")="Select OUTPATIENT LOCATION: "
"RTN","FHOMRO1",168,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMRO1",169,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMRO1",170,0)
 S FHLOC=+Y I '$D(^FH(119.6,FHLOC,"L")) S FHLOC="" W !!,"The selected location does not have an Associated Hospital Location."
"RTN","FHOMRO1",171,0)
 Q
"RTN","FHOMRO1",172,0)
UPD100 ;Backdoor message to update file #100 with a new RM order
"RTN","FHOMRO1",173,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRO1",174,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",175,0)
 K N1 S FHODAYS=""
"RTN","FHOMRO1",176,0)
 F N=1:1:7 S FH1=$E(FHDAYS,N) Q:FH1=""  S M=$F("MTWRFSX",FH1)-1,N1(M)=""
"RTN","FHOMRO1",177,0)
 F N=0:0 S N=$O(N1(N)) Q:N'>0  S FHODAYS=FHODAYS_"~QJ"_N
"RTN","FHOMRO1",178,0)
 S FHODAYS=$E(FHODAYS,2,999)
"RTN","FHOMRO1",179,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",180,0)
 I FHDIET'="@" S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",181,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(ENDT)
"RTN","FHOMRO1",182,0)
 S FHOTDAY=$$FMTHL7^XLFDT(FHTODAY)
"RTN","FHOMRO1",183,0)
 S FILL="R;"_FHMPNUM_";"_FHOSTDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMRO1",184,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^"_FHODAYS_"^^"_FHOSTDT_"^"_FHOENDT_"||||||||"_FHOTDAY
"RTN","FHOMRO1",185,0)
 I FHDIET'="@" S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",186,0)
 I FHDIET="@" D
"RTN","FHOMRO1",187,0)
 .F N=0:0 S N=$O(FHDIETX(N)) Q:N'>0  Q:FHDIETX(N)=""  S FHODNM=$P($G(^FH(111,FHDIETX(N),0)),U,1),MSG(N+4)="ODS|D|"_FHOMEAL_"|^^^"_FHDIETX(N)_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",188,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",189,0)
 Q
"RTN","FHOMRO1",190,0)
ED100 ;Backdoor message to update file #100 with an edited RM order
"RTN","FHOMRO1",191,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRO1",192,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",193,0)
 S (FHOSTDT,FHOENDT)=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,1)
"RTN","FHOMRO1",194,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(FHOENDT)
"RTN","FHOMRO1",195,0)
 S FILL="RMEDIT;"_FHZDA,FHORN=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,12)
"RTN","FHOMRO1",196,0)
 S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",197,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",198,0)
 S MSG(4)="ORC|XX|"_FHORN_"^OR|"_FILL_"^FH||||^^^"_FHOSTDT_"^"_FHOENDT_"||||||||"
"RTN","FHOMRO1",199,0)
 S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",200,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",201,0)
 Q
"RTN","FHOMRO2")
0^56^B53974540
"RTN","FHOMRO2",1,0)
FHOMRO2 ;Hines OIFO/RTK CHECK MEAL WINDOW TIMES,FILE OP EVENTS ;2/04/03  14:05
"RTN","FHOMRO2",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMRO2",3,0)
 ;
"RTN","FHOMRO2",4,0)
 ; IF TIME (NOW) IS PAST MEAL SELECTED WINDOW DISPLAY MSG; SKIP TODAY
"RTN","FHOMRO2",5,0)
 ; IF TIME (NOW) IS WITHIN THE MEAL WINDOW (SEE FHORD1A) ASK "DO YOU
"RTN","FHOMRO2",6,0)
 ;   WANT TO ORDER A LATE TRAY" IF YES, LET THEM; IF NO SKIP TODAY
"RTN","FHOMRO2",7,0)
CHK1 ; Check if meal is past for today
"RTN","FHOMRO2",8,0)
 S X=FHTODAY D H^%DTC S FHK=$E("XMTWRFS",%Y+1) I FHDAYS'[FHK Q
"RTN","FHOMRO2",9,0)
 D VARS
"RTN","FHOMRO2",10,0)
 I FHMEAL="B",FHTIME>$P(FHWIND2,U,2) D MSG Q
"RTN","FHOMRO2",11,0)
 I FHMEAL="N",FHTIME>$P(FHWIND2,U,4) D MSG Q
"RTN","FHOMRO2",12,0)
 I FHMEAL="E",FHTIME>$P(FHWIND2,U,6) D MSG Q
"RTN","FHOMRO2",13,0)
 Q
"RTN","FHOMRO2",14,0)
CHK2 ; Check if late tray needs to be ordered
"RTN","FHOMRO2",15,0)
 S X=FHTODAY D H^%DTC S FHK=$E("XMTWRFS",%Y+1) I FHDAYS'[FHK Q
"RTN","FHOMRO2",16,0)
 D VARS
"RTN","FHOMRO2",17,0)
 I FHMEAL="B",FHTIME>$P(FHWIND2,U,1),FHTIME<$P(FHWIND2,U,2) D LATE
"RTN","FHOMRO2",18,0)
 I FHMEAL="N",FHTIME>$P(FHWIND2,U,3),FHTIME<$P(FHWIND2,U,4) D LATE
"RTN","FHOMRO2",19,0)
 I FHMEAL="E",FHTIME>$P(FHWIND2,U,5),FHTIME<$P(FHWIND2,U,6) D LATE
"RTN","FHOMRO2",20,0)
 Q
"RTN","FHOMRO2",21,0)
VARS ;
"RTN","FHOMRO2",22,0)
 S FHWIND1=$G(^FH(119.73,FHCOMM,1)),FHWIND2=$G(^FH(119.73,FHCOMM,2))
"RTN","FHOMRO2",23,0)
 D NOW^%DTC S FHTIME=$E($P(%,".",2),1,4)
"RTN","FHOMRO2",24,0)
 S MLTX=$S(FHMEAL="B":"breakfast",FHMEAL="N":"noon",1:"evening"),SKIP=0
"RTN","FHOMRO2",25,0)
 Q
"RTN","FHOMRO2",26,0)
SMGM ;entry point for Special/Guest meals
"RTN","FHOMRO2",27,0)
 S FHWIND1=$G(^FH(119.73,FHCOMM,1)),FHWIND2=$G(^FH(119.73,FHCOMM,2))
"RTN","FHOMRO2",28,0)
 D NOW^%DTC S FHTIME=$E($P(%,".",2),1,4)
"RTN","FHOMRO2",29,0)
 S MLTX=$S(FHMEAL="B":"breakfast",FHMEAL="N":"noon",1:"evening"),SKIP=0
"RTN","FHOMRO2",30,0)
 I FHMEAL="B",FHTIME>$P(FHWIND2,U,2) D MSG Q
"RTN","FHOMRO2",31,0)
 I FHMEAL="N",FHTIME>$P(FHWIND2,U,4) D MSG Q
"RTN","FHOMRO2",32,0)
 I FHMEAL="E",FHTIME>$P(FHWIND2,U,6) D MSG Q
"RTN","FHOMRO2",33,0)
 I FHMEAL="B",FHTIME>$P(FHWIND2,U,1),FHTIME<$P(FHWIND2,U,2) D LATE
"RTN","FHOMRO2",34,0)
 I FHMEAL="N",FHTIME>$P(FHWIND2,U,3),FHTIME<$P(FHWIND2,U,4) D LATE
"RTN","FHOMRO2",35,0)
 I FHMEAL="E",FHTIME>$P(FHWIND2,U,5),FHTIME<$P(FHWIND2,U,6) D LATE
"RTN","FHOMRO2",36,0)
 Q
"RTN","FHOMRO2",37,0)
MSG ;
"RTN","FHOMRO2",38,0)
 W !!,"The ",MLTX," window has passed for today!  Not ordered for today."
"RTN","FHOMRO2",39,0)
 D SKIP Q
"RTN","FHOMRO2",40,0)
LATE ;
"RTN","FHOMRO2",41,0)
 I $G(FHGML)=1 Q
"RTN","FHOMRO2",42,0)
 W !,"You have missed the ",MLTX," cut-off."
"RTN","FHOMRO2",43,0)
 K DIR S DIR("A")="Do you wish to order a LATE TRAY for today? (Y/N): "
"RTN","FHOMRO2",44,0)
 S DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRO2",45,0)
 I $D(DIRUT) D SKIP Q
"RTN","FHOMRO2",46,0)
 S FHLATE=Y I FHLATE'=1 D SKIP Q
"RTN","FHOMRO2",47,0)
 S FHLTFLG=1
"RTN","FHOMRO2",48,0)
 Q
"RTN","FHOMRO2",49,0)
SKIP ;
"RTN","FHOMRO2",50,0)
 S SKIP=1,X1=STDT,X2=1 D C^%DTC S STDT=X ;add (skip) a day to Start Date
"RTN","FHOMRO2",51,0)
 Q
"RTN","FHOMRO2",52,0)
 ;
"RTN","FHOMRO2",53,0)
 ; Entry points for filing Outpatient Dietetic Events
"RTN","FHOMRO2",54,0)
SETSM ; Set specific variables for SM Events then call SETORX
"RTN","FHOMRO2",55,0)
 S FHDIET=$P(FHZN,U,4),FHLOC=$P(FHZN,U,3),FHMEAL=$P(FHZN,U,9)
"RTN","FHOMRO2",56,0)
 D SETORX Q
"RTN","FHOMRO2",57,0)
SETGM ; Set specific variables for GM Events then call SETORX
"RTN","FHOMRO2",58,0)
 S FHDIET=$P(FHZN,U,6),FHLOC=$P(FHZN,U,5),FHMEAL=$P(FHZN,U,3)
"RTN","FHOMRO2",59,0)
 D SETORX Q
"RTN","FHOMRO2",60,0)
SETAET ; Set specific variables for RM AO, E/L, TF Events then do SETORX
"RTN","FHOMRO2",61,0)
 S FHZN=$G(^FHPT(FHDFN,"OP",+FHRNUM,0)),FHDIET=$P(FHZN,U,2)
"RTN","FHOMRO2",62,0)
 S FHLOC=$P(FHZN,U,3),FHMEAL=$P(FHZN,U,4)
"RTN","FHOMRO2",63,0)
 I $G(FHC) S FHOPDT=$P(FHLIST(FHC),U,2) D SETORX Q
"RTN","FHOMRO2",64,0)
 S FHOPDT=FHRMDT
"RTN","FHOMRO2",65,0)
SETORX ; Set variables for RM Events and call FHORX
"RTN","FHOMRO2",66,0)
 I $G(FHOPDT)'="" S FHOPDT=$P($$FMTE^XLFDT(FHOPDT,"P"),",",1)
"RTN","FHOMRO2",67,0)
 K FHTXT S (FHDDISP,FHLDSP)=""
"RTN","FHOMRO2",68,0)
 I FHDIET'="" S FHDDISP=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO2",69,0)
 I FHLOC'="" S FHLDSP=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMRO2",70,0)
 S FHMLDSP=$S(FHMEAL="B":"Breakfast",FHMEAL="N":"Noon",1:"Evening")
"RTN","FHOMRO2",71,0)
 S FHFROMD=$O(ODAYS("")),FHFROMD=$P($$FMTE^XLFDT(FHFROMD,"P"),",",1)
"RTN","FHOMRO2",72,0)
 S FHTOD=$O(ODAYS(""),-1),FHTOD=$P($$FMTE^XLFDT(FHTOD,"P"),",",1)
"RTN","FHOMRO2",73,0)
 S FHOPTY2="Outpatient "_$S(FHOPTY="R":"Recurring Meal",FHOPTY="S":"Special Meal",FHOPTY="G":"Guest Meal",FHOPTY="I":"Isolation/Precaution",FHOPTY="A":"Add. Order",FHOPTY="E":"E/L Tray",1:"TF")
"RTN","FHOMRO2",74,0)
 S FHACT2=$S(FHACT="O":": ",1:" cancelled: ") I FHOPTY="S" S FHACT2=$S(FHSTAT="A":" authorized: ",FHSTAT="D":" denied: ",1:FHACT2)
"RTN","FHOMRO2",75,0)
 S FHTXT=FHOPTY2_FHACT2_FHDDISP_", "_FHLDSP_", "_FHMLDSP
"RTN","FHOMRO2",76,0)
 I FHOPTY="R",FHACT="O" D DAYS S FHTXT=FHTXT_", "_FHDAZ_", "_FHFROMD_"-"_FHTOD D OPFILE^FHORX Q
"RTN","FHOMRO2",77,0)
 S FHTXT=FHTXT_", "_$G(FHOPDT) I $G(FHAET)'="" S FHTXT=FHTXT_", "_FHAET
"RTN","FHOMRO2",78,0)
 I FHOPTY="I" S FHTXT=$P(FHTXT,":",1)_": "_FHIP
"RTN","FHOMRO2",79,0)
 D OPFILE^FHORX Q
"RTN","FHOMRO2",80,0)
DAYS ; External display of Days
"RTN","FHOMRO2",81,0)
 S FHDAZ="" F A=1:1:7 S B=$E(FHDAYS,A) Q:B=""  S FHDAZ=FHDAZ_$S(B="M":"Mon",B="T":"Tue",B="W":"Wed",B="R":"Thu",B="F":"Fri",B="S":"Sat",1:"Sun")_"/"
"RTN","FHOMRO2",82,0)
 S FHDAZ=$E(FHDAZ,1,$L(FHDAZ)-1)
"RTN","FHOMRO2",83,0)
 Q
"RTN","FHOMRO2",84,0)
SOSFFP ;Add diet (pattern) associated SO's, SF's, FP's for outpatients
"RTN","FHOMRO2",85,0)
 S FHDPT=FHDPATT F ZZZ=1:1:4 I $L(FHDPT,"^")<5 S FHDPT=FHDPT_"^"
"RTN","FHOMRO2",86,0)
 S FHSTADT="",FHDPIEN=$O(^FH(111.1,"AB",FHDPT,0)) I FHDPIEN="" Q
"RTN","FHOMRO2",87,0)
 F FHOPB=FHNOW:0 S FHOPB=$O(^FHPT(FHDFN,"OP","B",FHOPB)) Q:FHOPB'>0  D
"RTN","FHOMRO2",88,0)
 .I FHSTADT="" S DTP=FHOPB D DTP^FH S FHSTADT=DTP
"RTN","FHOMRO2",89,0)
 .F FHOPN=0:0 S FHOPN=$O(^FHPT(FHDFN,"OP","B",FHOPB,FHOPN)) Q:FHOPN'>0  D
"RTN","FHOMRO2",90,0)
 ..S FHZN=$G(^FHPT(FHDFN,"OP",FHOPN,0)) I $P(FHZN,U,15)="C" Q
"RTN","FHOMRO2",91,0)
 ..I $P(FHZN,U,2)'=$P(FHDPT,U,1),$P(FHZN,U,7,11)'=FHDPT Q  ;check dietpat
"RTN","FHOMRO2",92,0)
 ..D NOW^%DTC S FHNNN=%,FHYES="Y"
"RTN","FHOMRO2",93,0)
 ..D SOSET,SFSET,FPSET Q
"RTN","FHOMRO2",94,0)
 Q
"RTN","FHOMRO2",95,0)
SOSET ;Diet related SO's
"RTN","FHOMRO2",96,0)
 F FHMLSO="BS","NS","ES" D
"RTN","FHOMRO2",97,0)
 .F FHSO=0:0 S FHSO=$O(^FH(111.1,FHDPIEN,FHMLSO,FHSO)) Q:FHSO'>0  D
"RTN","FHOMRO2",98,0)
 ..S FHQ=0,FHSOZN=$G(^FH(111.1,FHDPIEN,FHMLSO,FHSO,0))
"RTN","FHOMRO2",99,0)
 ..S FHSIEN=$P(FHSOZN,U,1),FHSQTY=$P(FHSOZN,U,2),FHMLZ=$P(FHZN,U,4)
"RTN","FHOMRO2",100,0)
 ..F FHX=0:0 S FHX=$O(^FHPT(FHDFN,"OP",FHOPN,"SP",FHX)) Q:FHX'>0  D
"RTN","FHOMRO2",101,0)
 ...I $P($G(^FHPT(FHDFN,"OP",FHOPN,"SP",FHX,0)),U,2)=FHSIEN,$P($G(^FHPT(FHDFN,"OP",FHOPN,"SP",FHX,0)),U,9)="Y" S FHQ=1
"RTN","FHOMRO2",102,0)
 ..I FHQ=1 Q
"RTN","FHOMRO2",103,0)
 ..I $P(FHZN,U,4)'=$E(FHMLSO,1) Q  ;check for meal
"RTN","FHOMRO2",104,0)
 ..K DIC,DO S DA(2)=FHDFN,DA(1)=FHOPN
"RTN","FHOMRO2",105,0)
 ..S DIC="^FHPT("_DA(2)_",""OP"","_DA(1)_",""SP"","
"RTN","FHOMRO2",106,0)
 ..S DIC(0)="L",DIC("P")=$P(^DD(115.016,26,0),U,2)
"RTN","FHOMRO2",107,0)
 ..S X=$P($G(^FHPT(FHDFN,"OP",FHOPN,"SP",0)),U,3)+1
"RTN","FHOMRO2",108,0)
 ..D FILE^DICN I Y=-1 Q
"RTN","FHOMRO2",109,0)
 ..K DIE S DA(2)=FHDFN,DA(1)=FHOPN,(DA,FHI)=+Y
"RTN","FHOMRO2",110,0)
 ..S DIE="^FHPT("_DA(2)_",""OP"","_DA(1)_",""SP"","
"RTN","FHOMRO2",111,0)
 ..S DR="1////^S X=FHSIEN;2////^S X=FHMLZ;3////^S X=FHNNN;4////^S X=DUZ;7////^S X=FHSQTY;8////^S X=FHYES"
"RTN","FHOMRO2",112,0)
 ..D ^DIE
"RTN","FHOMRO2",113,0)
 ..S FHSOO(FHI,FHSIEN)=FHSQTY,FHCNSOF=1
"RTN","FHOMRO2",114,0)
 Q
"RTN","FHOMRO2",115,0)
SFSET ;Diet related SF's
"RTN","FHOMRO2",116,0)
 S FHSF=$P($G(^FH(111.1,FHDPIEN,0)),U,8) I FHSF="" Q
"RTN","FHOMRO2",117,0)
 L +^FHPT(FHDFN,"OP",FHOPN,"SF",0)
"RTN","FHOMRO2",118,0)
 I '$D(^FHPT(FHDFN,"OP",FHOPN,"SF",0)) S ^FHPT(FHDFN,"OP",FHOPN,"SF",0)="^115.1627^^"
"RTN","FHOMRO2",119,0)
 S FHX=^FHPT(FHDFN,"OP",FHOPN,"SF",0),FHN3=+$P(FHX,"^",3),FHNO=FHN3+1
"RTN","FHOMRO2",120,0)
 I $P($G(^FHPT(FHDFN,"OP",FHOPN,"SF",FHN3,0)),U,5,28)=$P($G(^FH(118.1,FHSF,1)),U,1,24) Q  ;don't add duplicate
"RTN","FHOMRO2",121,0)
 S ^FHPT(FHDFN,"OP",FHOPN,"SF",0)=$P(FHX,U,1,2)_"^"_FHNO_"^"_($P(FHX,"^",4)+1)
"RTN","FHOMRO2",122,0)
 L -^FHPT(FHDFN,"OP",FHOPN,"SF",0)
"RTN","FHOMRO2",123,0)
 S FHPNO=$G(^FH(118.1,+FHSF,1)) Q:FHPNO=""
"RTN","FHOMRO2",124,0)
 S FHPNN="^"_FHNNN_"^"_DUZ_"^"_FHSF_"^"_FHPNO
"RTN","FHOMRO2",125,0)
 S ^FHPT(FHDFN,"OP",FHOPN,"SF",FHNO,0)=FHNO_"^"_$P(FHPNN,"^",2,99)
"RTN","FHOMRO2",126,0)
 I FHN3,$D(^FHPT(FHDFN,"OP",FHOPN,"SF",FHN3,0)),'$P(^FHPT(FHDFN,"OP",FHOPN,"SF",FHN3,0),U,32) D
"RTN","FHOMRO2",127,0)
 .S $P(^FHPT(FHDFN,"OP",FHOPN,"SF",FHN3,0),"^",32,33)=FHNNN_"^"_DUZ
"RTN","FHOMRO2",128,0)
 S:FHNO $P(^FHPT(FHDFN,"OP",FHOPN,"SF",FHNO,0),"^",30,31)=FHNNN_"^"_DUZ
"RTN","FHOMRO2",129,0)
 S:FHNO $P(^FHPT(FHDFN,"OP",FHOPN,"SF",FHNO,0),"^",34)="Y"
"RTN","FHOMRO2",130,0)
 S FHADSFF=1,FHSFMEN=$P($G(^FH(118.1,+FHSF,0)),U,1)
"RTN","FHOMRO2",131,0)
 Q
"RTN","FHOMRO2",132,0)
FPSET ;Diet related FP's
"RTN","FHOMRO2",133,0)
 F FHFP=0:0 S FHFP=$O(^FH(111.1,FHDPIEN,"RES",FHFP)) Q:FHFP'>0  D
"RTN","FHOMRO2",134,0)
 .S DPAT=FHDPIEN D UPD^FHMTK7
"RTN","FHOMRO2",135,0)
 Q
"RTN","FHOMRO2",136,0)
KILL ;kill variables from FHOMRO1
"RTN","FHOMRO2",137,0)
 K A,AA,AB,CCC,CONT,ENDL,ENDT,FHDFN,FHDAYS,FHDEF,FHDIET,FHDIETS
"RTN","FHOMRO2",138,0)
 K FHDIETX1,FHDIETX2,FHDIETX3,FHDIETX4,FHDIETX5,FHEXST,FHIFLG,FHLOC
"RTN","FHOMRO2",139,0)
 K FHMPNUM,FHSMYES,FHYIEN,FHZ,FLAG,J,FHMEAL,MLT,ODAYS,SPDIETS,STDT,DFN
"RTN","FHOMRO2",140,0)
 K FHSO,FHSOO,FHDAT,FHSODAT,NUM,FHSOI,FHSOQ,FHSOCN,FHPRML,FHPRCN
"RTN","FHOMRO2",141,0)
 K BID,P,LS,LN,SP,NO,DR,DIC,DIR,FHSERV,FHSF1,OCXTSPI,PNN,SKIP,STDTMP
"RTN","FHOMRO2",142,0)
 K FHZ,FHBID,FHSSN,FHDI,FHDIETX,FHDX,FHRMDT,FHMEAL,FHD0,FHDI,FHCK,FHJ
"RTN","FHOMRO2",143,0)
 K EX,FHDIETP,FHDNM,FHDPTR,FHDTRLE,FHLIST,FHLOCZN,FHLPT,FHNODE,FHRM,FHI
"RTN","FHOMRO2",144,0)
 K FHSF10,FHSF2,FHSF8,FHSFDAT,FHSRV,FHSRVPT,FHTZ,FHTZCNT,FHTZSO,FHTZSO2
"RTN","FHOMRO2",145,0)
 K FHTZSO6,FHTZSO8,FHTZSOCN,FHTZSOL,FHTZSON,FHZDA,FHNNN
"RTN","FHOMRO2",146,0)
 K FHAGE,FHCOMM,FHCUT,FHD3,FHD4,FHDOB,FHMAX,FHMSG1,FHMSGML,FHNOW,FHOSTDT
"RTN","FHOMRO2",147,0)
 K FHOUT,FHPCZN,FHPTNM,FHSEX,FHTODAY,FHZ115,FILE,IEN,IEN200,FHODNM
"RTN","FHOMRO2",148,0)
 K J,K,N1,PID,PREC,FHI,FHACT,FHACT2,FHADSFF,FHALML,FHCNSOF,FHDAZ,FHDDISP
"RTN","FHOMRO2",149,0)
 K FHDOW,FHDTC,FHDTM,FHDTP,FHDUR,FHFROMD,FHK,FHLDSP,FHLOCN,FHLTFLG
"RTN","FHOMRO2",150,0)
 K FHMLDSP,FHMPN,FHNMSAV,FHODAYS,FHTYPE,FHWIND1,FHWIND2,FHX,MLTX,N,NOW
"RTN","FHOMRO2",151,0)
 K FHOENDT,FHOLOC,FHOLOCNM,FHOMEAL,FHOPTY,FHOPTY2,FHORN,FHPREVML,FHRNM
"RTN","FHOMRO2",152,0)
 K FHRNUM,FHSETFLG,FHSF,FHSFCX,FHSFMEN,FHTDTMP,FHTIME,FHTOD,FHTXT,FHTYP
"RTN","FHOMRO2",153,0)
 K L,OCXSEG,ORDNUM,ORPC,ORVARY,PAD,PCE,SF,ADM,FH1,FHOTDAY,FILL,M,MEAL
"RTN","FHOMRO2",154,0)
 Q
"RTN","FHOMRR1")
0^14^B37981700
"RTN","FHOMRR1",1,0)
FHOMRR1 ;Hines OIFO/RTK RECURRING MEALS REVIEW/DISPLAY  ;2/04/03  14:05
"RTN","FHOMRR1",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHOMRR1",3,0)
 ;11/30/05 patch 5 - added outpatient standing order & SFs.
"RTN","FHOMRR1",4,0)
 ;
"RTN","FHOMRR1",5,0)
STRT K FHPSDT D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRR1",6,0)
 I STDT="" Q
"RTN","FHOMRR1",7,0)
 D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMRR1",8,0)
 S ENDT=ENDT_.99
"RTN","FHOMRR1",9,0)
 D DEV D STRT Q
"RTN","FHOMRR1",10,0)
 ;I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR Q
"RTN","FHOMRR1",11,0)
 ;
"RTN","FHOMRR1",12,0)
DEV ;get device and set up queue
"RTN","FHOMRR1",13,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMRR1",14,0)
 I '$D(IO("Q")) U IO D DISP,^%ZISC,END Q
"RTN","FHOMRR1",15,0)
 S ZTRTN="DISP^FHOMRR1"
"RTN","FHOMRR1",16,0)
 S ZTSAVE("STDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMRR1",17,0)
 S ZTDESC="Outpatient Meals Recurring Meals Display" D ^%ZTLOAD
"RTN","FHOMRR1",18,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMRR1",19,0)
 D END Q
"RTN","FHOMRR1",20,0)
DISP ;
"RTN","FHOMRR1",21,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRR1",22,0)
 I '$O(^FHPT(FHDFN,"OP","B",STDT)) W !!,"No Recurring Meals to Display" Q
"RTN","FHOMRR1",23,0)
 K FHLIST S EX="",NUM=0 D HDR I $G(ENDT)="" S ENDT=9999999.99
"RTN","FHOMRR1",24,0)
 F FHRMDT=STDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)!(EX=U)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0!(EX=U)  D
"RTN","FHOMRR1",25,0)
 .S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0)) Q:FHNODE=""
"RTN","FHOMRR1",26,0)
 .I $P(FHNODE,U,15)="C" Q
"RTN","FHOMRR1",27,0)
 .S FHRM=$P(FHNODE,U,1)
"RTN","FHOMRR1",28,0)
 .S NUM=NUM+1,PAD=$S($L(NUM)=1:" ",1:"") W !,PAD,NUM
"RTN","FHOMRR1",29,0)
 .S FHLIST(NUM)=FHRNUM_"^"_FHRM
"RTN","FHOMRR1",30,0)
 .S FHDTP=$$FMTE^XLFDT(FHRM,"P") W ?5,$E(FHDTP,1,12)
"RTN","FHOMRR1",31,0)
 .S FHRMBD=$P(FHNODE,U,18),FHRMBNM=""
"RTN","FHOMRR1",32,0)
 .I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,11)
"RTN","FHOMRR1",33,0)
 .S FHLPT=$P(FHNODE,U,3),FHLOCZN=$G(^FH(119.6,FHLPT,0)) D
"RTN","FHOMRR1",34,0)
 ..S FHLOC=$E($P(FHLOCZN,U,1),1,11),FHSERV=$P(FHLOCZN,U,10)
"RTN","FHOMRR1",35,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLOCZN,U,5),FHSERV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRR1",36,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMRR1",37,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMRR1",38,0)
 ..Q
"RTN","FHOMRR1",39,0)
 .W ?19,FHLOC,?31,FHRMBNM,?44,$E(FHSRVPT,1,11),?58,$P(FHNODE,U,4)
"RTN","FHOMRR1",40,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)="Y" D DIETPAT W ?63,$E(FHDIETP,1,17)
"RTN","FHOMRR1",41,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)'="Y" S FHDPTR=$P(FHNODE,U,2) Q:FHDPTR=""  W ?63,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,17)
"RTN","FHOMRR1",42,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",43,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D
"RTN","FHOMRR1",44,0)
 ..S FHNODE1=$G(^FHPT(FHDFN,"OP",FHRNUM,1)) I $P(FHNODE1,U,5)="C" Q
"RTN","FHOMRR1",45,0)
 ..W !?7,"Additional Orders: ",$P(FHNODE1,U,1)
"RTN","FHOMRR1",46,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHOMRR1",47,0)
 ..S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMRR1",48,0)
 ..S FHEL=FHNODE2 I $P(FHNODE2,U,6)="C" Q
"RTN","FHOMRR1",49,0)
 ..W !?7,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMRR1",50,0)
 ..W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMRR1",51,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHOMRR1",52,0)
 ..S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3))
"RTN","FHOMRR1",53,0)
 ..S FHTU=FHNODE3 I $P(FHTU,U,5)="C" Q
"RTN","FHOMRR1",54,0)
 ..W !?7,"Tubefeeding: "
"RTN","FHOMRR1",55,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ)) Q:FHTZ'>0!(EX=U)  D
"RTN","FHOMRR1",56,0)
 ...S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ,0))
"RTN","FHOMRR1",57,0)
 ...S FHTUPTR=$P(FHTUZN,U,1),FHTUSTR=$P(FHTUZN,U,2)
"RTN","FHOMRR1",58,0)
 ...W !?9,$P($G(^FH(118.2,FHTUPTR,0)),U,1),"  Strength: "
"RTN","FHOMRR1",59,0)
 ...W $S(FHTUSTR=1:"1/4",FHTUSTR=2:"1/2",FHTUSTR=3:"3/4",1:"FULL")
"RTN","FHOMRR1",60,0)
 ...I $P(FHTUZN,U,3)["CC" D  ;print ml instead of cc.
"RTN","FHOMRR1",61,0)
 ....S QUA=$P(FHTUZN,U,3)
"RTN","FHOMRR1",62,0)
 ....S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2)
"RTN","FHOMRR1",63,0)
 ....S $P(FHTUZN,U,3)=QUAFI_"ML"_QUASE
"RTN","FHOMRR1",64,0)
 ...W "  Quantity: ",$P(FHTUZN,U,3)
"RTN","FHOMRR1",65,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",66,0)
 ..W !?7,"Total ML's: ",$P(FHTU,U,2),"  Total KCALS/DAY: ",$P(FHTU,U,3)
"RTN","FHOMRR1",67,0)
 ..S FHTCOMM=$P(FHTU,U,1) I FHTCOMM'="" W !?7,"Comment: ",FHTCOMM
"RTN","FHOMRR1",68,0)
 .Q:EX=U  I $D(^FHPT(FHDFN,"OP",FHRNUM,"SP")) D
"RTN","FHOMRR1",69,0)
 ..I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",70,0)
 ..W !,?7,"Standing Orders:"
"RTN","FHOMRR1",71,0)
 ..S FHTZSOL=23,FHTZCNT=0
"RTN","FHOMRR1",72,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"SP",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMRR1",73,0)
 ...S FHTZSO=$G(^FHPT(FHDFN,"OP",FHRNUM,"SP",FHTZ,0))
"RTN","FHOMRR1",74,0)
 ...S FHTZSO2=$P(FHTZSO,U,2)
"RTN","FHOMRR1",75,0)
 ...S FHTZSO6=$P(FHTZSO,U,6)
"RTN","FHOMRR1",76,0)
 ...S FHTZSO8=$P(FHTZSO,U,8)
"RTN","FHOMRR1",77,0)
 ...S FHTZSOCN="" I FHTZSO6'="" QUIT     ;S FHTZSOCN=" (C) "
"RTN","FHOMRR1",78,0)
 ...I $G(FHTZSO2),$D(^FH(118.3,FHTZSO2,0)) D
"RTN","FHOMRR1",79,0)
 ....S FHTZSON=$P(^FH(118.3,FHTZSO2,0),U,1)
"RTN","FHOMRR1",80,0)
 ....S FHTZSOL=FHTZSOL+$L(FHTZSON)+$L(FHTZSOCN)+7
"RTN","FHOMRR1",81,0)
 ....I FHTZSOL>80 W !,?23 S FHTZSOL=30+$L(FHTZSON)+$L(FHTZSOCN),FHTZCNT=0
"RTN","FHOMRR1",82,0)
 ....I $G(FHTZCNT) W ", ",FHTZSON,FHTZSOCN," = ",FHTZSO8
"RTN","FHOMRR1",83,0)
 ....E  W " ",FHTZSON,FHTZSOCN," = ",FHTZSO8
"RTN","FHOMRR1",84,0)
 ....S FHTZCNT=FHTZCNT+1
"RTN","FHOMRR1",85,0)
 .Q:EX=U  I $D(^FHPT(FHDFN,"OP",FHRNUM,"SF")) D
"RTN","FHOMRR1",86,0)
 ..Q:'$D(^FHPT(FHDFN,"OP",FHRNUM,"SF",0))
"RTN","FHOMRR1",87,0)
 ..S SF=""
"RTN","FHOMRR1",88,0)
 ..I $D(^FHPT(FHDFN,"OP",FHRNUM,"SF",0)) S SF=$P(^(0),U,3)
"RTN","FHOMRR1",89,0)
 ..Q:'SF
"RTN","FHOMRR1",90,0)
 ..S FHSFDAT=$G(^FHPT(FHDFN,"OP",FHRNUM,"SF",SF,0))
"RTN","FHOMRR1",91,0)
 ..I SF,$P(FHSFDAT,U,32) Q
"RTN","FHOMRR1",92,0)
 ..I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",93,0)
 ..W !,?7,"Supplemental Feeding: " I $P(FHSFDAT,U,4),$D(^FH(118.1,$P(FHSFDAT,U,4),0)) W $P(^(0),U,1)
"RTN","FHOMRR1",94,0)
 ..S FHSF10=$P(FHSFDAT,U,5,12)
"RTN","FHOMRR1",95,0)
 ..S FHSF2=$P(FHSFDAT,U,13,20)
"RTN","FHOMRR1",96,0)
 ..S FHSF8=$P(FHSFDAT,U,21,28)
"RTN","FHOMRR1",97,0)
 ..I FHSF10'["^^^^^^^" D
"RTN","FHOMRR1",98,0)
 ...W !,?9,"10AM:"
"RTN","FHOMRR1",99,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF10,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF10,U,FHI+1):1,1:$P(FHSF10,U,FHI+1))
"RTN","FHOMRR1",100,0)
 ..I FHSF2'["^^^^^^^" D
"RTN","FHOMRR1",101,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",102,0)
 ...W !,?9,"2PM:"
"RTN","FHOMRR1",103,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF2,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF2,U,FHI+1):1,1:$P(FHSF2,U,FHI+1))
"RTN","FHOMRR1",104,0)
 ..Q:EX=U  I FHSF8'["^^^^^^^" D
"RTN","FHOMRR1",105,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",106,0)
 ...W !,?9,"8PM:"
"RTN","FHOMRR1",107,0)
 ...F FHI=1,3,5,7 S FHSF1=$P(FHSF8,U,FHI) I FHSF1,$D(^FH(118,FHSF1,0)) W " ",$P(^FH(118,FHSF1,0),U,1)," = ",$S('$P(FHSF8,U,FHI+1):1,1:$P(FHSF8,U,FHI+1))
"RTN","FHOMRR1",108,0)
 .Q
"RTN","FHOMRR1",109,0)
 W ! Q
"RTN","FHOMRR1",110,0)
DIETPAT ;
"RTN","FHOMRR1",111,0)
 S FHDIETS=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,7,11)
"RTN","FHOMRR1",112,0)
 S FHDIETP=""
"RTN","FHOMRR1",113,0)
 F PCE=1:1:5 D
"RTN","FHOMRR1",114,0)
 .S FHDPTR=$P(FHDIETS,U,PCE) I FHDPTR="" Q
"RTN","FHOMRR1",115,0)
 .S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,7)
"RTN","FHOMRR1",116,0)
 .I FHDNM="" S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,1)
"RTN","FHOMRR1",117,0)
 .S FHDIETP=FHDIETP_FHDNM_"," Q
"RTN","FHOMRR1",118,0)
 S FHDIETP=$E(FHDIETP,1,$L(FHDIETP)-1)
"RTN","FHOMRR1",119,0)
 Q
"RTN","FHOMRR1",120,0)
PG ;
"RTN","FHOMRR1",121,0)
 Q:$O(^FHPT(FHDFN,"OP","B",FHRMDT))'>0
"RTN","FHOMRR1",122,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRR1",123,0)
 D HDR Q
"RTN","FHOMRR1",124,0)
HDR ;
"RTN","FHOMRR1",125,0)
 I $G(FHPP)'=1 W:$Y @IOF
"RTN","FHOMRR1",126,0)
 K FHPP W !?5,"R E C U R R I N G   M E A L   D I S P L A Y"
"RTN","FHOMRR1",127,0)
 W !!?3,"OUTPATIENT NAME: " D PATNAME^FHOMUTL W FHPTNM,"   ",FHSSN
"RTN","FHOMRR1",128,0)
 W ?65,FHSEX," Age ",FHAGE
"RTN","FHOMRR1",129,0)
 W !!," #",?5,"Date/Time",?19,"Location    Room-Bed",?44,"Service Pnt"
"RTN","FHOMRR1",130,0)
 W ?57,"Meal",?63,"Diet Ordered"
"RTN","FHOMRR1",131,0)
 W !,"===",?5,"============",?19,"=========== ==========="
"RTN","FHOMRR1",132,0)
 W ?44,"===========",?57,"====",?63,"================="
"RTN","FHOMRR1",133,0)
 Q
"RTN","FHOMRR1",134,0)
END ;
"RTN","FHOMRR1",135,0)
 K ENDT,EX,FHDIET,FHDIETP,FHDIETS,FHDTP,FHFIND,FHLOC,FHLPT,FHNODE,FHRM,DIR,BID,DFN,FHDFN
"RTN","FHOMRR1",136,0)
 K FHRNUM,FHDPTR,FHDNM,FHAGE,FHBID,FHDFN,FHDOB,FHDOW,FHDTDF,FHI,FHLIST,FHLOCZN,FHPCZN
"RTN","FHOMRR1",137,0)
 K FHPTNM,FHRMDT,FHSERV,FHSEX,FHSF1,FHSF10,FHSF2,FHSF8,FHSFDAT,FHSRV,FHSRVPT,FHSSN,FHTZ,FHTZCNT,FHTZSO
"RTN","FHOMRR1",138,0)
 K FHTZSO2,FHTZSO6,FHTZSO8,FHTZSOCN,FHTZSOL,FHTZSON,FHZ115,FILE,FLAG,IEN,IEN200,J,NUM,PAD,PCE,PID,POP,SF,STDT
"RTN","FHOMRR1",139,0)
 Q
"RTN","FHOMSP1")
0^35^B9628591
"RTN","FHOMSP1",1,0)
FHOMSP1 ;Hines OIFO/RTK SPECIAL MEALS PRINT MEAL  ;4/11/03  8:05
"RTN","FHOMSP1",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHOMSP1",3,0)
 ;
"RTN","FHOMSP1",4,0)
 S STDT=DT,FHS="AP" D LIST^FHOMSS1 W !
"RTN","FHOMSP1",5,0)
 I NUM=0 W !,"NO AUTHORIZED OR PENDING SPECIAL MEALS TO PRINT" Q
"RTN","FHOMSP1",6,0)
 K DIR S DIR("A")="Print Which Meal(s)?",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMSP1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMSP1",8,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMSP1",9,0)
 Q:$D(DIRUT)  I Y=0 D END Q
"RTN","FHOMSP1",10,0)
 D DEV Q
"RTN","FHOMSP1",11,0)
DEV ;get device and set up queue
"RTN","FHOMSP1",12,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMSP1",13,0)
 I '$D(IO("Q")) U IO D PRINT,^%ZISC,END Q
"RTN","FHOMSP1",14,0)
 S ZTRTN="PRINT^FHOMSP1",ZTSAVE("STDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMSP1",15,0)
 S ZTSAVE("FHS")="",ZTSAVE("FHCDT")="",ZTSAVE("FHREQPR")=""
"RTN","FHOMSP1",16,0)
 S ZTSAVE("NUM")="",ZTSAVE("FHCLST")="",ZTSAVE("FHLIST(")=""
"RTN","FHOMSP1",17,0)
 S ZTDESC="Print Special Meals Voucher" D ^%ZTLOAD
"RTN","FHOMSP1",18,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMSP1",19,0)
 D END Q
"RTN","FHOMSP1",20,0)
PRINT ;
"RTN","FHOMSP1",21,0)
 I $G(FHREQPR)=1 D PR2 Q
"RTN","FHOMSP1",22,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHCDT=FHLIST(FHC) D PR2
"RTN","FHOMSP1",23,0)
 Q
"RTN","FHOMSP1",24,0)
PR2 ;
"RTN","FHOMSP1",25,0)
 S FHDFN=$P(FHCDT,U,1) D PATNAME^FHOMUTL
"RTN","FHOMSP1",26,0)
 S FHD=$P(FHCDT,U,2),FHNODE=$G(^FHPT(FHDFN,"SM",FHD,0))
"RTN","FHOMSP1",27,0)
 D ALG^FHCLN S ALG="Allergies :  "_$S(ALG="":"NONE ON FILE",1:ALG)
"RTN","FHOMSP1",28,0)
 S (LNS,UNLNS)="" F FHA=1:1:80 S LNS=LNS_"-",UNLNS=UNLNS_"_"
"RTN","FHOMSP1",29,0)
 S FHD=$E($$FMTE^XLFDT($P(FHCDT,U,2),"P"),1,12) S X=FHD D TR^FH S FHD=X
"RTN","FHOMSP1",30,0)
 S FHM=$P(FHNODE,U,9),FHSTAT=$P(FHNODE,U,2)
"RTN","FHOMSP1",31,0)
 S FHRQR=$P(FHNODE,U,5) S:FHRQR'="" FHRQR=$P($G(^VA(200,FHRQR,0)),U,1)
"RTN","FHOMSP1",32,0)
 S FHAZR=$P(FHNODE,U,6) S:FHAZR'="" FHAZR=$E($P($G(^VA(200,FHAZR,0)),U,1),1,20)
"RTN","FHOMSP1",33,0)
 S FHTTL=$P(FHNODE,U,6) S:FHTTL'="" FHTTL=$P($G(^VA(200,FHTTL,0)),U,9) I FHTTL'="" S FHTTL=$E($P($G(^DIC(3.1,FHTTL,0)),U,1),1,24)
"RTN","FHOMSP1",34,0)
 S FHMEAL=$S(FHM="B":"BREAKFAST",FHM="N":"NOON",1:"EVENING")
"RTN","FHOMSP1",35,0)
 S FHLPT=$P(FHNODE,U,3),FHLOC=$P($G(^FH(119.6,FHLPT,0)),U,1)
"RTN","FHOMSP1",36,0)
 S FHRMBD=$P(FHNODE,U,13),FHRMBNM=""
"RTN","FHOMSP1",37,0)
 I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,24)
"RTN","FHOMSP1",38,0)
 S FHDPT=$P(FHNODE,U,4),FHDIET=$P($G(^FH(111,FHDPT,0)),U,1)
"RTN","FHOMSP1",39,0)
 W:$Y @IOF
"RTN","FHOMSP1",40,0)
 W !!!!,LNS,!?4," A U T H O R I Z E D   O U T P A T I E N T   M E A L   V O U C H E R",!,LNS
"RTN","FHOMSP1",41,0)
 W !!!,"Name of Pt:  ",$E(FHPTNM,1,20)," (",$E(FHPTNM,1,1),FHBID,")"
"RTN","FHOMSP1",42,0)
 W ?44,"Req Loc  :  ",$E(FHLOC,1,24)
"RTN","FHOMSP1",43,0)
 W !,"Start Date:  ",FHD,?44,"Room-Bed :  ",FHRMBNM
"RTN","FHOMSP1",44,0)
 W !,"Stop Date :  ",FHD,?44,"Requestor:  ",$E(FHRQR,1,24),!,ALG
"RTN","FHOMSP1",45,0)
 W !!?44,"Signature:  ",$S(FHSTAT="A":"/es/"_FHAZR,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",46,0)
 W !!?44,"    Title:  ",$S(FHSTAT="A":FHTTL,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",47,0)
 W !!?44,"     Date:  ",$S(FHSTAT="A":FHD,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",48,0)
 W !!!!,"Pt Authorized a:  ",FHDIET," Meal for ",FHMEAL," meal time"
"RTN","FHOMSP1",49,0)
 W !!!!!!!!!!!!,"ALTERING OR COPYING THIS MEAL VOUCHER IS PROHIBITED."
"RTN","FHOMSP1",50,0)
 W !!!!!!!!!!!!!!!!!!,LNS,!,"In lieu of VA FORM 10-2817",!
"RTN","FHOMSP1",51,0)
 W !,"Facility:  " D SITE^FH W SITE D NOW^%DTC W ?45,$$FMTE^XLFDT(%,"P")
"RTN","FHOMSP1",52,0)
 W !,LNS
"RTN","FHOMSP1",53,0)
 Q
"RTN","FHOMSP1",54,0)
END ;
"RTN","FHOMSP1",55,0)
 K FHLPT,FHDPT,FHDIET,FHLOC,FHSTAT,FHRQR,FHTITL,FHAZR,FHMEAL Q
"RTN","FHOMSR1")
0^7^B28707183
"RTN","FHOMSR1",1,0)
FHOMSR1 ;Hines OIFO/RTK SPECIAL MEALS REQUEST MEAL  ;4/02/03  15:05
"RTN","FHOMSR1",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHOMSR1",3,0)
 ;
"RTN","FHOMSR1",4,0)
 S (FHORN,FHDIET)="",FHKEY=0,FHMSG1="S"
"RTN","FHOMSR1",5,0)
 D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMSR1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMSR1",7,0)
 D SMSTAT^FHOMUTL I FHSTAT="P" D MSG1 Q
"RTN","FHOMSR1",8,0)
 I $D(^XUSEC("FHAUTH",DUZ)) S FHKEY=1
"RTN","FHOMSR1",9,0)
LOC ;Prompt for outpatient location
"RTN","FHOMSR1",10,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",11,0)
 W ! D RMBED^FHOMUTL
"RTN","FHOMSR1",12,0)
DIET ;Prompt for diet
"RTN","FHOMSR1",13,0)
 D DIETLST^FHOMUTL
"RTN","FHOMSR1",14,0)
 I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMSR1",15,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMSR1",16,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMSR1",17,0)
 S DIC("B")=FHDEF,DIC("S")="I $D(FHDIETS(+Y))" D ^DIC
"RTN","FHOMSR1",18,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",19,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",20,0)
 S FHDIET=+Y
"RTN","FHOMSR1",21,0)
MEAL ;Prompt for meal
"RTN","FHOMSR1",22,0)
 K DIR,DIC S DIR("A")="Select Meal: "
"RTN","FHOMSR1",23,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMSR1",24,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",25,0)
 I Y'=-1 S FHMEAL=Y
"RTN","FHOMSR1",26,0)
 D CHECKRM I FHRMYES=1 D MSG2 Q
"RTN","FHOMSR1",27,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMSR1",28,0)
 D ^DIR
"RTN","FHOMSR1",29,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",30,0)
 D NOW^%DTC S FHNOW=%,STDT=DT,FHLTFLG=0 D SMGM^FHOMRO2
"RTN","FHOMSR1",31,0)
 I SKIP=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",32,0)
 S FHQEL=1 I FHLTFLG=1 S FHSM=FHNOW,FHEL="L",FHQEL=0 D LATE I FHQEL=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",33,0)
 S FHSTAT=$S(FHKEY=1:"A",1:"P") D SETNODE,UPD100
"RTN","FHOMSR1",34,0)
 I FHQEL=0 D UPDE100
"RTN","FHOMSR1",35,0)
 D OKMSG^FHOMUTL
"RTN","FHOMSR1",36,0)
 I FHKEY=1 D PRINT
"RTN","FHOMSR1",37,0)
 I FHKEY=0 D ALERT
"RTN","FHOMSR1",38,0)
 D END Q
"RTN","FHOMSR1",39,0)
PRINT ;If user has key allow printing without sending alert to authorizor(s)
"RTN","FHOMSR1",40,0)
 W ! S DIR(0)="YA",DIR("B")="Y",DIR("A")="Print Voucher? " D ^DIR
"RTN","FHOMSR1",41,0)
 Q:$D(DIRUT)  S PRINT=Y I PRINT'=1 Q
"RTN","FHOMSR1",42,0)
 S FHCDT=FHDFN_"^"_FHNOW,FHREQPR=1 D DEV^FHOMSP1 K FHREQPR Q
"RTN","FHOMSR1",43,0)
ALERT ;Send alert to 15 Authorizors set up in file #119.9 (fields 9-13,40-49)
"RTN","FHOMSR1",44,0)
 K XQA,FHAU15 S FHAU15=$P($G(^FH(119.9,1,0)),U,7,11)_"^"_$P($G(^FH(119.9,1,1)),U,11,20)
"RTN","FHOMSR1",45,0)
 F A=1:1:15 S AB=$P(FHAU15,U,A) I AB'="" S XQA(AB)=""
"RTN","FHOMSR1",46,0)
 I '$D(XQA) D
"RTN","FHOMSR1",47,0)
 .W !!?5,"NOTICE: No 'Authorizing Person(s)' defined in site "
"RTN","FHOMSR1",48,0)
 .W !!?5,"parameter (#119.9) file -- NO ALERT SENT",!! Q
"RTN","FHOMSR1",49,0)
 D PATNAME^FHOMUTL
"RTN","FHOMSR1",50,0)
 S XQAMSG=$E(FHPTNM,1,9)_" ("_$E(FHPTNM,1,1)_$P(FHSSN,"-",3)_"): "
"RTN","FHOMSR1",51,0)
 S XQAMSG=XQAMSG_"Special Meal needs authorizing" D SETUP^XQALERT
"RTN","FHOMSR1",52,0)
 Q
"RTN","FHOMSR1",53,0)
SETNODE ;
"RTN","FHOMSR1",54,0)
 S AUDUZ=$S(FHSTAT="A":DUZ,1:""),AUFHNOW=$S(FHSTAT="A":FHNOW,1:"")
"RTN","FHOMSR1",55,0)
 S (FHSMID,Y)=FHNOW K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",56,0)
 S DIC(0)="L",DIC("P")=$P(^DD(115,17,0),U,2),X=+Y,DINUM=X
"RTN","FHOMSR1",57,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMSR1",58,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",59,0)
 S DA=+Y,FHDA=DA
"RTN","FHOMSR1",60,0)
 S DR="1////^S X=FHSTAT;2////^S X=FHLOC;2.5////^S X=FHRMBD;3////^S X=FHDIET;3.5////^S X=FHMEAL;4////^S X=DUZ;5////^S X=AUDUZ;6////^S X=AUFHNOW;14////^S X=FHORN"
"RTN","FHOMSR1",61,0)
 D ^DIE
"RTN","FHOMSR1",62,0)
 I FHQEL=0 D ORDEL
"RTN","FHOMSR1",63,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHOMSR1",64,0)
 S FHACT="O",FHOPTY="S",FHOPDT=$P(FHNOW,".",1) D SETSM^FHOMRO2
"RTN","FHOMSR1",65,0)
 Q
"RTN","FHOMSR1",66,0)
MSG1 ;
"RTN","FHOMSR1",67,0)
 W !!,"This patient already has a pending Special Meal request for "
"RTN","FHOMSR1",68,0)
 S DTP=DT D DTP^FH W DTP," " Q
"RTN","FHOMSR1",69,0)
MSG2 ;
"RTN","FHOMSR1",70,0)
 W !!,"This patient already has a Recurring Meal ordered for "
"RTN","FHOMSR1",71,0)
 S DTP=DT D DTP^FH W DTP," "
"RTN","FHOMSR1",72,0)
 W $S(FHMEAL="B":"Breakfast",FHMEAL="N":"Noon",1:"Evening") Q
"RTN","FHOMSR1",73,0)
CHECKRM ; Check if the OP has an existing RM for this date/meal
"RTN","FHOMSR1",74,0)
 S FHRMYES=0
"RTN","FHOMSR1",75,0)
 F FHZ=0:0 S FHZ=$O(^FHPT(FHDFN,"OP","B",DT,FHZ)) Q:FHZ'>0!(FHZ>DT)  D
"RTN","FHOMSR1",76,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHZ,0)),U,4)'=FHMEAL Q
"RTN","FHOMSR1",77,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHZ,0)),U,15)="C" Q
"RTN","FHOMSR1",78,0)
 .S FHRMYES=1
"RTN","FHOMSR1",79,0)
 Q
"RTN","FHOMSR1",80,0)
END ;Kill local variables before exiting
"RTN","FHOMSR1",81,0)
 K A,AA,AB,BAG,CCC,CONT,DIC,DIR,ENDL,ENDT,FHDFN,FHDAYS,FHDEF
"RTN","FHOMSR1",82,0)
 K FHDIET,FHDIETS,FHSTAT,FHZ,STDT,STDTIM Q
"RTN","FHOMSR1",83,0)
 ;
"RTN","FHOMSR1",84,0)
LATE ;
"RTN","FHOMSR1",85,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMSR1",86,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMSR1",87,0)
TIME S FH3=FH1+2,FHCNT=0 F FHT=FH1:1:FH3 D
"RTN","FHOMSR1",88,0)
 .I $P(FHCOMM1,U,FHT)="" Q
"RTN","FHOMSR1",89,0)
 .S FHCNT=FHCNT+1,FHTM(FHCNT)=$P(FHCOMM1,U,FHT)
"RTN","FHOMSR1",90,0)
 W !,"Select Time: ( " F J=1:1:FHCNT W J,"=",FHTM(J)," "
"RTN","FHOMSR1",91,0)
 R ") ",FHS:DTIME I FHS=""!(FHS["^") S FHQEL=1 Q
"RTN","FHOMSR1",92,0)
 I (FHS'?1N)!(FHS<1)!(FHS>FHCNT) W !!,"Invalid time selection!" D TIME Q
"RTN","FHOMSR1",93,0)
 S FHTIME=FHTM(FHS),X=$E(FHNOW,1,7)_"@"_FHTIME,%DT="XT" D ^%DT S FHTRAY=Y
"RTN","FHOMSR1",94,0)
 D NOW^%DTC I FHTRAY<% W !!,"Cannot order for a time before now!" D TIME Q
"RTN","FHOMSR1",95,0)
 K DIR S DIR(0)="SAO^Y:Yes;N:No",DIR("A")="Bagged Meal? ",DIR("B")="N"
"RTN","FHOMSR1",96,0)
 D ^DIR I $D(DIRUT) S FHQEL=1 Q
"RTN","FHOMSR1",97,0)
 S FHBAG=Y
"RTN","FHOMSR1",98,0)
 Q
"RTN","FHOMSR1",99,0)
ORDEL ;
"RTN","FHOMSR1",100,0)
 S DA=FHSM,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",101,0)
 S DR="8////^S X=FHTIME;9////^S X=FHBAG;10////^S X=DUZ" D ^DIE
"RTN","FHOMSR1",102,0)
 Q
"RTN","FHOMSR1",103,0)
UPD100 ;Backdoor message to update file #100 with a new SM order
"RTN","FHOMSR1",104,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",105,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",106,0)
 S FILL="S;"_FHNOW
"RTN","FHOMSR1",107,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMSR1",108,0)
 S FHDIETNM=$P($G(^FH(111,FHDIET,0)),U,1),FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",109,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHODT
"RTN","FHOMSR1",110,0)
 S MSG(5)="ODS|S|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHDIETNM_"^99FHD|"
"RTN","FHOMSR1",111,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",112,0)
 Q
"RTN","FHOMSR1",113,0)
UPDE100 ;Backdoor message to update file #100 with a new SM Late Tray order
"RTN","FHOMSR1",114,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",115,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",116,0)
 S FILL="G;"_FHNOW,FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",117,0)
 S FHTRAY=$$FMTHL7^XLFDT(FHTRAY)
"RTN","FHOMSR1",118,0)
 S FHOMELN=FHMEAL_"L"_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHOMSR1",119,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHTRAY_"^"_FHTRAY_"||||||||"_FHODT
"RTN","FHOMSR1",120,0)
 S MSG(5)="ODT|LATE|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHOMSR1",121,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",122,0)
 Q
"RTN","FHOMSS1")
0^40^B9007486
"RTN","FHOMSS1",1,0)
FHOMSS1 ;Hines OIFO/RTK SPECIAL MEALS STATUS LIST  ;4/11/03  10:05
"RTN","FHOMSS1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMSS1",3,0)
 ;
"RTN","FHOMSS1",4,0)
LIST ; Display for cancel/print/authorize screens - First build data in ^TMP
"RTN","FHOMSS1",5,0)
 K ^TMP($J),FHLIST S NUM=0,EX="",ENDT=9999999
"RTN","FHOMSS1",6,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT("SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)  D
"RTN","FHOMSS1",7,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHSMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMSS1",8,0)
 ..S FHSMDTX=$E(FHSMDT,1,7)
"RTN","FHOMSS1",9,0)
 ..S FHZN=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHST=$P(FHZN,U,2) I FHST="C" Q
"RTN","FHOMSS1",10,0)
 ..I FHS'[FHST Q
"RTN","FHOMSS1",11,0)
 ..D PATNAME^FHOMUTL I FHDFN="" Q
"RTN","FHOMSS1",12,0)
 ..S FHLOC=$P(FHZN,U,3) Q:FHLOC=""
"RTN","FHOMSS1",13,0)
 ..S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMSS1",14,0)
 ..S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMSS1",15,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1),FHML=$P(FHZN,U,9)
"RTN","FHOMSS1",16,0)
 ..S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMSS1",17,0)
 ..S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHSMDTX_"."_FHML,FHPTNM_"~"_FHDFN)=FHZN
"RTN","FHOMSS1",18,0)
 ..Q
"RTN","FHOMSS1",19,0)
 .Q
"RTN","FHOMSS1",20,0)
 I '$D(^TMP($J)) Q
"RTN","FHOMSS1",21,0)
 D HDR
"RTN","FHOMSS1",22,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMSS1",23,0)
 .F FHSMDT=STDT:0 S FHSMDT=$O(^TMP($J,FHLSRT,FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHOMSS1",24,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHSMDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMSS1",25,0)
 ...S FHNODE=$G(^TMP($J,FHLSRT,FHSMDT,FHPTN)),FHSMDTX=$P(FHNODE,U,1)
"RTN","FHOMSS1",26,0)
 ...S NUM=NUM+1,PAD=$S($L(NUM)=1:" ",1:"") W !,PAD,NUM
"RTN","FHOMSS1",27,0)
 ...S FHDFN=$P(FHPTN,"~",2) D PATNAME^FHOMUTL W ?4,$E(FHPTNM,1,17)
"RTN","FHOMSS1",28,0)
 ...S FHSTAT=$P(FHNODE,U,2),FHSTAT=$S(FHSTAT="P":"PENDING",FHSTAT="A":"AUTH",FHSTAT="D":"DENIED",1:"CANCEL")
"RTN","FHOMSS1",29,0)
 ...S FHD=$$FMTE^XLFDT(FHSMDTX,"P") W ?22,$E(FHD,1,12)
"RTN","FHOMSS1",30,0)
 ...S FHLPT=$P(FHNODE,U,3),FHLOC=$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,9)
"RTN","FHOMSS1",31,0)
 ...S FHRMBD=$P(FHNODE,U,13),FHRMBNM=""
"RTN","FHOMSS1",32,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,9)
"RTN","FHOMSS1",33,0)
 ...W ?35,FHLOC,?45,FHRMBNM
"RTN","FHOMSS1",34,0)
 ...S FHDPT=$P(FHNODE,U,4),FHDIET=$E($P($G(^FH(111,FHDPT,0)),U,1),1,12)
"RTN","FHOMSS1",35,0)
 ...W ?55,FHDIET
"RTN","FHOMSS1",36,0)
 ...S FHMEAL=$P(FHNODE,U,9) W ?69,FHMEAL,?73,FHSTAT
"RTN","FHOMSS1",37,0)
 ...S FHLIST(NUM)=FHDFN_"^"_FHSMDTX
"RTN","FHOMSS1",38,0)
 ...I $E(FHSTAT,1)="D" D
"RTN","FHOMSS1",39,0)
 ....S FHDENY=$P(FHNODE,U,6) W !?6,"Denied by: "
"RTN","FHOMSS1",40,0)
 ....I FHDENY'="" W $P($G(^VA(200,FHDENY,0)),U,1)
"RTN","FHOMSS1",41,0)
 ...S FHCOMM=$P(FHNODE,U,8) I FHCOMM'="" W !?6,"Comment: ",FHCOMM
"RTN","FHOMSS1",42,0)
 ...I $D(^FHPT(FHDFN,"SM",FHSMDTX,1)) D
"RTN","FHOMSS1",43,0)
 ....S FHEL=$G(^FHPT(FHDFN,"SM",FHSMDTX,1))
"RTN","FHOMSS1",44,0)
 ....W !?6,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMSS1",45,0)
 ....W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMSS1",46,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMSS1",47,0)
 .Q
"RTN","FHOMSS1",48,0)
 Q
"RTN","FHOMSS1",49,0)
PG ;
"RTN","FHOMSS1",50,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMSS1",51,0)
 D HDR Q
"RTN","FHOMSS1",52,0)
HDR ;
"RTN","FHOMSS1",53,0)
 W:$Y @IOF
"RTN","FHOMSS1",54,0)
 W !?5,"S P E C I A L    M E A L S    S T A T U S    R E P O R T"
"RTN","FHOMSS1",55,0)
 W !!!?1,"#",?6,"Name",?23,"Date/Time",?35,"Location",?45,"Room-Bed"
"RTN","FHOMSS1",56,0)
 W ?55,"Diet Ordered",?68,"Meal",?73,"Status"
"RTN","FHOMSS1",57,0)
 W !,"===",?4,"=================",?22,"============"
"RTN","FHOMSS1",58,0)
 W ?35,"========= =========",?55,"============",?68,"====",?73,"======="
"RTN","FHOMSS1",59,0)
 Q
"RTN","FHOMSS2")
0^39^B17440516
"RTN","FHOMSS2",1,0)
FHOMSS2 ;Hines OIFO/RTK SPECIAL MEALS STATUS LIST  ;2/07/06  10:05
"RTN","FHOMSS2",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMSS2",3,0)
 ;
"RTN","FHOMSS2",4,0)
 W @IOF,!!?20,"S P E C I A L   M E A L S   S T A T U S   L I S T"
"RTN","FHOMSS2",5,0)
START S (FHSELOC,FHSLCOM,FHSLPRO)=""
"RTN","FHOMSS2",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMSS2",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMSS2",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMSS2",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMSS2",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMSS2",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMSS2",12,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLCOM="" Q
"RTN","FHOMSS2",13,0)
 .S FHSLCOM=+Y
"RTN","FHOMSS2",14,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMSS2",15,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMSS2",16,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLPRO="" Q
"RTN","FHOMSS2",17,0)
 .S FHSLPRO=+Y
"RTN","FHOMSS2",18,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMSS2",19,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMSS2",20,0)
 D DEV,START Q
"RTN","FHOMSS2",21,0)
DEV ;get device and set up queue
"RTN","FHOMSS2",22,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMSS2",23,0)
 I '$D(IO("Q")) U IO D LIST,^%ZISC,END Q
"RTN","FHOMSS2",24,0)
 S ZTSAVE("STDT")="",ZTSAVE("ENDT")="",ZTSAVE("FHLBY")=""
"RTN","FHOMSS2",25,0)
 S ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")="",ZTSAVE("FHSLPRO")=""
"RTN","FHOMSS2",26,0)
 S ZTRTN="LIST^FHOMSS2",ZTDESC="Special Meals Display" D ^%ZTLOAD
"RTN","FHOMSS2",27,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMSS2",28,0)
 D END Q
"RTN","FHOMSS2",29,0)
LIST ; First build data in ^TMP global
"RTN","FHOMSS2",30,0)
 K ^TMP($J) S NUM=0,EX="",FHPG=0,ENDT=ENDT_.99
"RTN","FHOMSS2",31,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT("SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHOMSS2",32,0)
 .S FHSMDTX=$E(FHSMDT,1,7)
"RTN","FHOMSS2",33,0)
 .S FHDFN=$O(^FHPT("SM",FHSMDT,"")) D PATNAME^FHOMUTL
"RTN","FHOMSS2",34,0)
 .S FHNODE=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHSTAT=$P(FHNODE,U,2)
"RTN","FHOMSS2",35,0)
 .I FHSTAT="C" Q
"RTN","FHOMSS2",36,0)
 .S FHLOC=$P(FHNODE,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMSS2",37,0)
 .S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMSS2",38,0)
 .S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMSS2",39,0)
 .S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMSS2",40,0)
 .S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMSS2",41,0)
 .S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1),FHML=$P(FHNODE,U,9)
"RTN","FHOMSS2",42,0)
 .S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMSS2",43,0)
 .S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHSMDTX_"."_FHML,FHPTNM_"~"_FHDFN)=FHNODE
"RTN","FHOMSS2",44,0)
 .Q
"RTN","FHOMSS2",45,0)
 ; Now display data from the ^TMP global
"RTN","FHOMSS2",46,0)
 I '$D(^TMP($J)) W !!,"NO SPECIAL MEALS TO PRINT FOR GIVEN DATE RANGE" Q
"RTN","FHOMSS2",47,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMSS2",48,0)
 .D:FHPG>0&(IOST?1"C".E) PG Q:EX=U
"RTN","FHOMSS2",49,0)
 .D HDR S FHPG=FHPG+1
"RTN","FHOMSS2",50,0)
 .F FHSMDT=0:0 S FHSMDT=$O(^TMP($J,FHLSRT,FHSMDT)) Q:FHSMDT'>0!(EX=U)  D
"RTN","FHOMSS2",51,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHSMDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMSS2",52,0)
 ...S FHNODE=$G(^TMP($J,FHLSRT,FHSMDT,FHPTN)),FHLOC=$P(FHNODE,U,3)
"RTN","FHOMSS2",53,0)
 ...S FHLOCZN=$G(^FH(119.6,FHLOC,0)),FHDFN=$P(FHPTN,"~",2)
"RTN","FHOMSS2",54,0)
 ...S FHSTAT=$P(FHNODE,U,2),FHSTAT=$S(FHSTAT="P":"PENDING",FHSTAT="A":"AUTH",FHSTAT="D":"DENIED",1:"CANCEL")
"RTN","FHOMSS2",55,0)
 ...S NUM=NUM+1 D PATNAME^FHOMUTL W !,$E(FHPTNM,1,20)
"RTN","FHOMSS2",56,0)
 ...S FHSMDTX=$P(FHNODE,U,1)
"RTN","FHOMSS2",57,0)
 ...S FHD=$$FMTE^XLFDT(FHSMDTX,"P") W ?22,$E(FHD,1,12)
"RTN","FHOMSS2",58,0)
 ...S FHLPT=$P(FHNODE,U,3),FHLOC=$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,10)
"RTN","FHOMSS2",59,0)
 ...S FHRMBD=$P(FHNODE,U,13),FHRMBNM=""
"RTN","FHOMSS2",60,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,14)
"RTN","FHOMSS2",61,0)
 ...W ?36,FHRMBNM
"RTN","FHOMSS2",62,0)
 ...S FHDPT=$P(FHNODE,U,4),FHDIET=$E($P($G(^FH(111,FHDPT,0)),U,1),1,15)
"RTN","FHOMSS2",63,0)
 ...W ?52,FHDIET
"RTN","FHOMSS2",64,0)
 ...S FHMEAL=$P(FHNODE,U,9) W ?69,FHMEAL,?73,FHSTAT
"RTN","FHOMSS2",65,0)
 ...I $E(FHSTAT,1)="D" D
"RTN","FHOMSS2",66,0)
 ....S FHDENY=$P(FHNODE,U,6) W !?6,"Denied by: "
"RTN","FHOMSS2",67,0)
 ....I FHDENY'="" W $P($G(^VA(200,FHDENY,0)),U,1)
"RTN","FHOMSS2",68,0)
 ...S FHCMNT=$P(FHNODE,U,8) I FHCMNT'="" W !?6,"Comment: ",FHCMNT
"RTN","FHOMSS2",69,0)
 ...I $D(^FHPT(FHDFN,"SM",FHSMDTX,1)) D
"RTN","FHOMSS2",70,0)
 ....S FHEL=$G(^FHPT(FHDFN,"SM",FHSMDTX,1))
"RTN","FHOMSS2",71,0)
 ....W !?6,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMSS2",72,0)
 ....W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMSS2",73,0)
 ....Q
"RTN","FHOMSS2",74,0)
 ...Q
"RTN","FHOMSS2",75,0)
 ..Q
"RTN","FHOMSS2",76,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMSS2",77,0)
 .Q
"RTN","FHOMSS2",78,0)
 Q
"RTN","FHOMSS2",79,0)
PG ;
"RTN","FHOMSS2",80,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMSS2",81,0)
 D HDR Q
"RTN","FHOMSS2",82,0)
HDR ;
"RTN","FHOMSS2",83,0)
 W:$Y @IOF
"RTN","FHOMSS2",84,0)
 W !?5,"S P E C I A L    M E A L S    S T A T U S    R E P O R T"
"RTN","FHOMSS2",85,0)
 W !!?5,"LOCATION: ",$P(FHLSRT,"~",2)
"RTN","FHOMSS2",86,0)
 W !!!,"Patient Name",?22,"Date",?36,"Room-Bed"
"RTN","FHOMSS2",87,0)
 W ?52,"Diet Ordered",?68,"Meal",?73,"Status"
"RTN","FHOMSS2",88,0)
 W !,"====================",?22,"============",?36,"=============="
"RTN","FHOMSS2",89,0)
 W ?52,"===============",?68,"====",?73,"======="
"RTN","FHOMSS2",90,0)
 Q
"RTN","FHOMSS2",91,0)
END ;
"RTN","FHOMSS2",92,0)
 K STDT,ENDT,EX,FHNODE,FHSELOC,FHSLCOM,FHSLPRO,FHPRD,FHSTAT Q
"RTN","FHOMTK1")
0^1^B13719057
"RTN","FHOMTK1",1,0)
FHOMTK1 ;Hines OIFO/RTK OUTPATIENT MEALS TRAY TICKETS  ;7/02/03  14:05
"RTN","FHOMTK1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMTK1",3,0)
 ;
"RTN","FHOMTK1",4,0)
START S RM="",FHBY=$E($G(FHBY),1) I FHBY="" Q
"RTN","FHOMTK1",5,0)
 S FHDTE=D1
"RTN","FHOMTK1",6,0)
 S X1=D1,X2=-1 D C^%DTC S FHRMDTE=X
"RTN","FHOMTK1",7,0)
 S X1=D1,X2=1 D C^%DTC S FHDTQ=X
"RTN","FHOMTK1",8,0)
 ;NEW CODE FOR SORTING
"RTN","FHOMTK1",9,0)
BLDTMP ; First build data in ^TMP global
"RTN","FHOMTK1",10,0)
 K ^TMP($J,"OPTX")
"RTN","FHOMTK1",11,0)
 ; Recurring Meals
"RTN","FHOMTK1",12,0)
 F FHOMDT=FHRMDTE:0 S FHOMDT=$O(^FHPT("RM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHDTQ)  D
"RTN","FHOMTK1",13,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHOMTK1",14,0)
 ..D PATNAME^FHOMUTL I DFN'="" I $G(^DPT(DFN,.1))'="" Q
"RTN","FHOMTK1",15,0)
 ..F FHRNUM=0:0 S FHRNUM=$O(^FHPT("RM",FHOMDT,FHDFN,FHRNUM)) Q:FHRNUM=""  D
"RTN","FHOMTK1",16,0)
 ...S FHZN=$G(^FHPT(FHDFN,"OP",FHRNUM,0)),FHLOC=$P(FHZN,U,3) Q:FHLOC=""
"RTN","FHOMTK1",17,0)
 ...S FHSTAT=$P(FHZN,U,15) Q:FHSTAT="C"
"RTN","FHOMTK1",18,0)
 ...S FHMEAL=$P(FHZN,U,4)
"RTN","FHOMTK1",19,0)
 ...I FHOMEAL'="A",FHOMEAL'[FHMEAL Q
"RTN","FHOMTK1",20,0)
 ...I FHBY="P",FHDFN'=FHTTDFN Q
"RTN","FHOMTK1",21,0)
 ...I FHBY="L",W1'=FHLOC Q
"RTN","FHOMTK1",22,0)
 ...I FHBY="C" S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHP'=FHCOMM Q
"RTN","FHOMTK1",23,0)
 ...S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1) I FHMEAL="E" S FHMEAL="Z"
"RTN","FHOMTK1",24,0)
 ...I SRT="R" S ^TMP($J,"OPTX",FHLOCNM,FHMEAL_"~"_FHPTNM_"~"_FHDFN_"~R~"_FHRNUM)=FHZN
"RTN","FHOMTK1",25,0)
 ...I SRT'="R" S ^TMP($J,"OPTX",FHPTNM,FHMEAL_"~"_FHLOCNM_"~"_FHDFN_"~R~"_FHRNUM)=FHZN
"RTN","FHOMTK1",26,0)
 ...Q
"RTN","FHOMTK1",27,0)
 ..Q
"RTN","FHOMTK1",28,0)
 .Q
"RTN","FHOMTK1",29,0)
 ; Special Meals
"RTN","FHOMTK1",30,0)
 F FHOMDT=FHDTE:0 S FHOMDT=$O(^FHPT("SM",FHOMDT)) Q:FHOMDT=""!(FHOMDT>FHDTQ)  D
"RTN","FHOMTK1",31,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHOMTK1",32,0)
 ..D PATNAME^FHOMUTL I DFN'="" I $G(^DPT(DFN,.1))'="" Q
"RTN","FHOMTK1",33,0)
 ..S FHZN=$G(^FHPT(FHDFN,"SM",FHOMDT,0)),FHLOC=$P(FHZN,U,3) Q:FHLOC=""
"RTN","FHOMTK1",34,0)
 ..S FHSTAT=$P(FHZN,U,2) Q:FHSTAT'="A"
"RTN","FHOMTK1",35,0)
 ..S FHMEAL=$P(FHZN,U,9)
"RTN","FHOMTK1",36,0)
 ..I FHOMEAL'="A",FHOMEAL'[FHMEAL Q
"RTN","FHOMTK1",37,0)
 ..I FHBY="P",FHDFN'=FHTTDFN Q
"RTN","FHOMTK1",38,0)
 ..I FHBY="L",W1'=FHLOC Q
"RTN","FHOMTK1",39,0)
 ..I FHBY="C" S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHP'=FHCOMM Q
"RTN","FHOMTK1",40,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1) I FHMEAL="E" S FHMEAL="Z"
"RTN","FHOMTK1",41,0)
 ..I SRT="R" S ^TMP($J,"OPTX",FHLOCNM,FHMEAL_"~"_FHPTNM_"~"_FHDFN_"~S")=FHZN
"RTN","FHOMTK1",42,0)
 ..I SRT'="R" S ^TMP($J,"OPTX",FHPTNM,FHMEAL_"~"_FHLOCNM_"~"_FHDFN_"~S")=FHZN
"RTN","FHOMTK1",43,0)
 ..Q
"RTN","FHOMTK1",44,0)
 .Q
"RTN","FHOMTK1",45,0)
 ; Guest Meals
"RTN","FHOMTK1",46,0)
 F FHOMDT=FHDTE:0 S FHOMDT=$O(^FHPT("GM",FHOMDT)) Q:FHOMDT=""!(FHOMDT>FHDTQ)  D
"RTN","FHOMTK1",47,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHOMTK1",48,0)
 ..D PATNAME^FHOMUTL I DFN'="" I $G(^DPT(DFN,.1))'="" Q
"RTN","FHOMTK1",49,0)
 ..S FHZN=$G(^FHPT(FHDFN,"GM",FHOMDT,0)),FHLOC=$P(FHZN,U,5) Q:FHLOC=""
"RTN","FHOMTK1",50,0)
 ..S FHSTAT=$P(FHZN,U,9) Q:FHSTAT="C"
"RTN","FHOMTK1",51,0)
 ..S FHMEAL=$P(FHZN,U,3)
"RTN","FHOMTK1",52,0)
 ..I FHOMEAL'="A",FHOMEAL'[FHMEAL Q
"RTN","FHOMTK1",53,0)
 ..I FHBY="P",FHDFN'=FHTTDFN Q
"RTN","FHOMTK1",54,0)
 ..I FHBY="L",W1'=FHLOC Q
"RTN","FHOMTK1",55,0)
 ..I FHBY="C" S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHP'=FHCOMM Q
"RTN","FHOMTK1",56,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1) I FHMEAL="E" S FHMEAL="Z"
"RTN","FHOMTK1",57,0)
 ..I SRT="R" S ^TMP($J,"OPTX",FHLOCNM,FHMEAL_"~"_FHPTNM_"~"_FHDFN_"~G")=FHZN
"RTN","FHOMTK1",58,0)
 ..I SRT'="R" S ^TMP($J,"OPTX",FHPTNM,FHMEAL_"~"_FHLOCNM_"~"_FHDFN_"~G")=FHZN
"RTN","FHOMTK1",59,0)
 ..Q
"RTN","FHOMTK1",60,0)
 .Q
"RTN","FHOMTK1",61,0)
 ;
"RTN","FHOMTK1",62,0)
 ;Now process sorted OM tray tickets
"RTN","FHOMTK1",63,0)
 I '$D(^TMP($J,"OPTX")) Q
"RTN","FHOMTK1",64,0)
 S FHINDX="" F  S FHINDX=$O(^TMP($J,"OPTX",FHINDX)) Q:FHINDX=""  D
"RTN","FHOMTK1",65,0)
 .S FHINDX2="" F  S FHINDX2=$O(^TMP($J,"OPTX",FHINDX,FHINDX2)) Q:FHINDX2=""  D
"RTN","FHOMTK1",66,0)
 ..S FHZN=$G(^TMP($J,"OPTX",FHINDX,FHINDX2)),FHOMDT=$P(FHZN,U,1)
"RTN","FHOMTK1",67,0)
 ..S FHMEAL=$P(FHINDX2,"~",1)  I FHMEAL="Z" S FHMEAL="E"  ;for sorting
"RTN","FHOMTK1",68,0)
 ..S FHDFN=$P(FHINDX2,"~",3),FHOMTYP=$P(FHINDX2,"~",4)
"RTN","FHOMTK1",69,0)
 ..S FHLOC=$P(FHZN,U,3) I FHOMTYP="G" S FHLOC=$P(FHZN,U,5)
"RTN","FHOMTK1",70,0)
 ..I FHOMTYP="R" S FHRNUM=$P(FHINDX2,"~",5)
"RTN","FHOMTK1",71,0)
 ..I UPD,FHOMTYP="R",$P(FHZN,U,16)<$P(FHZN,U,13) Q
"RTN","FHOMTK1",72,0)
 ..I UPD,FHOMTYP="S",$P(FHZN,U,10)'="" Q
"RTN","FHOMTK1",73,0)
 ..I FHOMEAL'="A" D BLD^FHOMTK2 Q
"RTN","FHOMTK1",74,0)
 ..S MEAL=FHMEAL D BLD^FHOMTK2
"RTN","FHOMTK1",75,0)
 ..Q
"RTN","FHOMTK1",76,0)
 .Q
"RTN","FHOMTK1",77,0)
 I $G(NBR) D PRT^FHMTK1C Q
"RTN","FHOMTK1",78,0)
 K FHTTDFN Q
"RTN","FHOMTK2")
0^34^B27468276
"RTN","FHOMTK2",1,0)
FHOMTK2 ;Hines OIFO/RTK OUTPATIENT MEALS BUILD TRAY TICKETS  ;2/11/04  13:45
"RTN","FHOMTK2",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHOMTK2",3,0)
BLD ; Build Tray Ticket list for a patient
"RTN","FHOMTK2",4,0)
 D GETOPV  ; GET OUTPATIENT VARIABLES - FHDIET, FHLOC, FHLOCNM
"RTN","FHOMTK2",5,0)
 I FHDIET=""!(FHLOC="") W !!,"NO DIET OR NO NUTRITION LOCATION!" Q
"RTN","FHOMTK2",6,0)
 S FHOR=FHDIET F ZZZ=1:1:4 I $L(FHOR,"^")<5 S FHOR=FHOR_"^"
"RTN","FHOMTK2",7,0)
 I FHMEAL'=MEAL Q
"RTN","FHOMTK2",8,0)
 ;  SVC (SERVICE), IS (ISOLATION/PRE), FHD (D/T TICKET LAST PRINTED),
"RTN","FHOMTK2",9,0)
 ;  PD (PRODUCTION DIET), SP (TRAY SERVICE PT), SP1 (CAF SERVICE PT)
"RTN","FHOMTK2",10,0)
 S SVC="T",SX=$E($P($G(^FH(119.6,FHLOC,0)),U,10),1) I "TCD"[SX S SVC=SX
"RTN","FHOMTK2",11,0)
 S SP=$P($G(^FH(119.6,FHLOC,0)),U,5),SP1=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHOMTK2",12,0)
 S FHPAR=$P($G(^FH(119.6,FHLOC,0)),U,24)
"RTN","FHOMTK2",13,0)
 S IS=$P($G(^FHPT(FHDFN,0)),U,5)
"RTN","FHOMTK2",14,0)
 I FHPAR'="Y" Q:SVC="C"
"RTN","FHOMTK2",15,0)
 I SVC="C" S:SP'=SP1 SP=SP1 Q:'SP
"RTN","FHOMTK2",16,0)
 I IS S IS=$G(^FH(119.4,+IS,0)) S:IS'="" SVC=SVC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHOMTK2",17,0)
 I FHOMTYP="R" D
"RTN","FHOMTK2",18,0)
 .S SF=""
"RTN","FHOMTK2",19,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,"SF",0)) S SF=$P(^(0),U,3)
"RTN","FHOMTK2",20,0)
 .I SF,$D(^FHPT(FHDFN,"OP",FHRNUM,"SF",SF,0)),'$P(^(0),U,32) S SVC=SVC_"  "_"SF"_"("_$S($P($G(^FHPT(FHDFN,"OP",FHRNUM,"SF",SF,0)),"^",34)="Y":"M",1:"I")_")"
"RTN","FHOMTK2",21,0)
 K FP,MP,N2,NN,P4,PS
"RTN","FHOMTK2",22,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0)) I DPAT="" W !!,"INVALID DIET PATTERN FOR ",FHPTNM,! Q
"RTN","FHOMTK2",23,0)
 I DPAT S PD=$P($G(^FH(111.1,DPAT,0)),"^",7) I $O(MP(""))="" F X8=0:0 S X8=$O(^FH(111.1,DPAT,MEAL,X8)) Q:X8<1  S Z1=$G(^(X8,0)),MP(+Z1)=$P(Z1,"^",2)
"RTN","FHOMTK2",24,0)
 Q:PD=""  S PD=$P($G(^FH(116.2,PD,0)),"^",2) Q:PD=""  D CHK^FHMTK1B
"RTN","FHOMTK2",25,0)
 I $G(NBR)=3 D PRT^FHMTK1C K MM,PP,S S NBR=0
"RTN","FHOMTK2",26,0)
 S NBR=$G(NBR)+1 ;D PID^FHDPA
"RTN","FHOMTK2",27,0)
 F X6=0:0 S X6=$O(^FHPT(FHDFN,"P","B",X6)) Q:X6<1  F X7=0:0 S X7=$O(^FHPT(FHDFN,"P","B",X6,X7)) Q:X7<1  S PS=$P($G(^FH(115.2,+X6,0)),"^",4) I PS S P4=$G(^FH(114,+PS,0)),P1=$P(P4,"^",7)_"^"_+PS_"^"_$P(P4,"^",1) I +P1 D
"RTN","FHOMTK2",28,0)
 .S CHK="" F  S CHK=$O(^TMP($J,"DEF",MEAL,PD,CHK)) Q:CHK=""  S C1=$G(^(CHK)) I $D(^TMP($J,"FHDEF",MEAL,+C1)),+^TMP($J,"FHDEF",MEAL,+C1)=+P1 D  Q
"RTN","FHOMTK2",29,0)
 ..S C2=$G(^FHPT(FHDFN,"P",+X7,0)) Q:$P(C2,"^",2)'[MEAL
"RTN","FHOMTK2",30,0)
 ..S P2=+CHK,P3=$P(P1,"^",3) S:'$D(N2(P2,+C1,P3)) N2(P2,+C1,P3)=+$P(P1,"^",2)_"^"_P3 Q
"RTN","FHOMTK2",31,0)
 .Q
"RTN","FHOMTK2",32,0)
 S Y0=FHPTNM_" ("_FHBID_")"_"  "_SVC,S(NBR)=0,N1=0
"RTN","FHOMTK2",33,0)
 S N1=N1+1 I $L(Y)<40 S PP(N1,NBR)=Y
"RTN","FHOMTK2",34,0)
 E  S L=$S($L($P(Y,",",1,3))<40:3,1:2) S PP(N1,NBR)=$P(Y,",",1,L),N1=N1+1,PP(N1,NBR)=$E($P(Y,",",L+1,5),2,99)
"RTN","FHOMTK2",35,0)
 S MM(0,NBR)=Y0_"^"_FHLOCNM_"^"_FHRMBNM_"^^^^"_FHMEAL
"RTN","FHOMTK2",36,0)
 D ALG^FHCLN S ALG="ALLGS.: "_$S(ALG="":"NONE ON FILE",1:ALG) S J=0 D BRK^FHMTK1B
"RTN","FHOMTK2",37,0)
 S X8="" F  S X8=$O(^TMP($J,MEAL,PD,X8)) Q:X8=""  S (P4,X1)=^(X8),X1=+X1,P4=$P(P4,"^",3) D
"RTN","FHOMTK2",38,0)
 .S Z1=+$P(X8,"~",2) Q:'$F(P4,"~"_SP_"~")
"RTN","FHOMTK2",39,0)
 .S (MSG,X6)="",CTR=1
"RTN","FHOMTK2",40,0)
 .S QTY="" Q:'$D(MP(Z1))  Q:MP(Z1)=0  S PAD=$E("    ",1,5-$L(MP(Z1))),QTY=MP(Z1)_PAD,CTR=$J(MP(Z1),0,2)
"RTN","FHOMTK2",41,0)
 .S:$G(^TMP($J,"FHPO",$P(X8,"~",3)))="" ^TMP($J,"FHPO",$P(X8,"~",3))=X8 S C2=$G(^TMP($J,"FHPO",$P(X8,"~",3)))
"RTN","FHOMTK2",42,0)
 .I $D(N2(Z1,X1)) D BRD Q
"RTN","FHOMTK2",43,0)
 .I $D(FP(+X1)) D SUB Q
"RTN","FHOMTK2",44,0)
 .S NN(X8)=QTY_$P(X8,"~",3) D CNT
"RTN","FHOMTK2",45,0)
 .I $D(^TMP($J,"DBX",MEAL,PD,+X1)) F LL=0:0 S LL=$O(^TMP($J,"DBX",MEAL,PD,+X1,LL)) Q:LL<1  S NN(X8_" "_LL)=$G(^(LL))
"RTN","FHOMTK2",46,0)
 .Q
"RTN","FHOMTK2",47,0)
 S X8="" F  S X8=$O(NN(X8)) Q:X8=""  D
"RTN","FHOMTK2",48,0)
 .S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$G(NN(X8)) Q
"RTN","FHOMTK2",49,0)
 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=""
"RTN","FHOMTK2",50,0)
 S ADM="" I $G(FHRNUM)'="" S ADM=FHRNUM D SOUT^FHMTK1B ; get op stnd ords
"RTN","FHOMTK2",51,0)
 D NOW^%DTC S (DTP,TIM)=% D DTP^FH S HD=DTP
"RTN","FHOMTK2",52,0)
 S DTP=D1 D DTP^FH S MDT=DTP
"RTN","FHOMTK2",53,0)
 I FHOMTYP="G" Q   ;if not GM set D/T ticket last printed
"RTN","FHOMTK2",54,0)
 I FHOMTYP="R" D NOW^%DTC S $P(^FHPT(FHDFN,"OP",FHRNUM,0),U,13)=%
"RTN","FHOMTK2",55,0)
 I FHOMTYP="S" D NOW^%DTC S $P(^FHPT(FHDFN,"SM",FHOMDT,0),U,10)=%
"RTN","FHOMTK2",56,0)
 Q
"RTN","FHOMTK2",57,0)
SUB ; Get Substitutes
"RTN","FHOMTK2",58,0)
 D ALT^FHMTK1B S:MSG'="" NN(X8)=MSG Q:'X6
"RTN","FHOMTK2",59,0)
 S X1=+X6,XX=Z,Z1=$P(XX,"~",2) I $D(N2(Z1,X1)) D BRD Q
"RTN","FHOMTK2",60,0)
 S:$D(^TMP($J,"FHPO",$P(XX,"~",3))) XX=$G(^TMP($J,"FHPO",$P(XX,"~",3)))
"RTN","FHOMTK2",61,0)
 S NN(XX)=QTY_$P(XX,"~",3)
"RTN","FHOMTK2",62,0)
 S CT=$G(^TMP($J,"CTR",MEAL,XX,SP))
"RTN","FHOMTK2",63,0)
 S CT=CT+CTR,^TMP($J,"CTR",MEAL,XX,SP)=CT D C1
"RTN","FHOMTK2",64,0)
 I SUM S TOT=$G(^TMP($J,"TOT",XX,SP)),TOT=TOT+CTR,^TMP($J,"TOT",XX,SP)=TOT
"RTN","FHOMTK2",65,0)
 I $D(^TMP($J,"DBX",MEAL,PD,+X1)) F LL=0:0 S LL=$O(^TMP($J,"DBX",MEAL,PD,+X1,LL)) Q:LL<1  S NN(XX_" "_LL)=$G(^(LL))
"RTN","FHOMTK2",66,0)
 Q
"RTN","FHOMTK2",67,0)
BRD ; Get Bread/Beverage
"RTN","FHOMTK2",68,0)
 S (X7,XX)="" F  S X7=$O(N2(Z1,X1,X7)) Q:X7=""  D
"RTN","FHOMTK2",69,0)
 .S L1=+N2(Z1,X1,X7),XX=$P(X8,"~",1,2)_"~"_X7
"RTN","FHOMTK2",70,0)
 .I '$D(NN(XX)) S NN(XX)=QTY_X7 S CT=$G(^TMP($J,"CTR",MEAL,XX,SP)),CT=CT+CTR,^TMP($J,"CTR",MEAL,XX,SP)=CT D C1 I SUM S TOT=$G(^TMP($J,"TOT",XX,SP)),TOT=TOT+CTR,^TMP($J,"TOT",XX,SP)=TOT
"RTN","FHOMTK2",71,0)
 .Q
"RTN","FHOMTK2",72,0)
 Q
"RTN","FHOMTK2",73,0)
CNT ; Count Recipe items for Service Points
"RTN","FHOMTK2",74,0)
 S CT=$G(^TMP($J,"CTR",MEAL,C2,SP)),CT=CT+CTR,^TMP($J,"CTR",MEAL,C2,SP)=CT
"RTN","FHOMTK2",75,0)
 I SUM S TOT=$G(^TMP($J,"TOT",C2,SP)),TOT=TOT+CTR,^TMP($J,"TOT",C2,SP)=TOT
"RTN","FHOMTK2",76,0)
C1 ; Setup Service Points Array
"RTN","FHOMTK2",77,0)
 S M1=$G(^TMP($J,"SRP",SP)),M2=$P(M1,"^",1),M3=$P(M1,"^",4)
"RTN","FHOMTK2",78,0)
 S:M3="" M3=$E(M2,1,8) I '$D(DP(MEAL,M3,SP)) S DP(MEAL,M3,SP)=$J(M3,10),LS(MEAL)=LS(MEAL)+10,P(MEAL,M3,SP)=""
"RTN","FHOMTK2",79,0)
 I SUM,'$D(TP(M3,SP)) S TP(M3,SP)=$J(M3,10),SL=SL+10,T1(M3,SP)=""
"RTN","FHOMTK2",80,0)
 Q
"RTN","FHOMTK2",81,0)
GETOPV ; Get outpatient variables
"RTN","FHOMTK2",82,0)
 I FHOMTYP="R" D
"RTN","FHOMTK2",83,0)
 .S FHDIET=$P(FHZN,U,2),FHRMBD=$P(FHZN,U,18)
"RTN","FHOMTK2",84,0)
 .I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" S FHDIET=$P(FHZN,U,7,11)
"RTN","FHOMTK2",85,0)
 .S FHLOC=$P(FHZN,U,3),FHMEAL=$P(FHZN,U,4),FHD=$P(FHZN,U,13)
"RTN","FHOMTK2",86,0)
 I FHOMTYP="S" D
"RTN","FHOMTK2",87,0)
 .S FHDIET=$P(FHZN,U,4),FHRMBD=$P(FHZN,U,13)
"RTN","FHOMTK2",88,0)
 .S FHLOC=$P(FHZN,U,3),FHMEAL=$P(FHZN,U,9),FHD=$P(FHZN,U,10)
"RTN","FHOMTK2",89,0)
 I FHOMTYP="G" D
"RTN","FHOMTK2",90,0)
 .S FHDIET=$P(FHZN,U,6),FHRMBD=$P(FHZN,U,11)
"RTN","FHOMTK2",91,0)
 .S FHLOC=$P(FHZN,U,5),FHMEAL=$P(FHZN,U,3),FHD=$P(FHZN,U,7)
"RTN","FHOMTK2",92,0)
 I FHDIET=""!(FHLOC="") Q
"RTN","FHOMTK2",93,0)
 S FHLD="" ;no WITHHOLD for outpatients
"RTN","FHOMTK2",94,0)
 S Y="" F A1=1:1:5 S D3=$P(FHDIET,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7) ;set Y = diet text
"RTN","FHOMTK2",95,0)
 D PATNAME^FHOMUTL
"RTN","FHOMTK2",96,0)
 S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1) ;set location name
"RTN","FHOMTK2",97,0)
 S FHRMBNM=""
"RTN","FHOMTK2",98,0)
 I FHRMBD'="" S FHRMBNM=$P($G(^DG(405.4,FHRMBD,0)),U,1) ;set room-bed nm
"RTN","FHOMTK2",99,0)
 Q
"RTN","FHOMUTL")
0^2^B46250378
"RTN","FHOMUTL",1,0)
FHOMUTL ;Hines OIFO/RTK OUTPATIENT MEALS UTILITIES  ;2/04/03  15:15
"RTN","FHOMUTL",2,0)
 ;;5.5;DIETETICS;**1,2,5**;Jan 28, 2005;Build 53
"RTN","FHOMUTL",3,0)
 ;
"RTN","FHOMUTL",4,0)
DIV ;ask for Communication office if Multi-division.
"RTN","FHOMUTL",5,0)
 N FHSCNT,FH
"RTN","FHOMUTL",6,0)
 K FHSITE,FHSITENM
"RTN","FHOMUTL",7,0)
 S FHSCNT=0 F FH=0:0 S FH=$O(^FH(119.73,FH)) Q:FH'>0  S FHSCNT=FHSCNT+1,FHSITE=FH,FHSITENM=$P($G(^FH(119.73,FH,0)),U,1)
"RTN","FHOMUTL",8,0)
 I (FHSCNT=1),($P($G(^FH(119.9,1,0)),U,20)'="Y") Q
"RTN","FHOMUTL",9,0)
D2 I FHSCNT>1 K FHSITE,FHSITENM,X R !!,"Select COMMUNICATION OFFICE (or ALL): ALL// ",X:DTIME S:X="" X="ALL" Q:'$T!("^"[X)  D TR^FH I X="ALL" S FHSITE=0
"RTN","FHOMUTL",10,0)
 I X'="ALL" K DIC S DIC="^FH(119.73,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S FHSITE=+Y,FHSITENM=$P(Y,U,2)
"RTN","FHOMUTL",11,0)
 Q
"RTN","FHOMUTL",12,0)
 ;
"RTN","FHOMUTL",13,0)
STDATE ;Prompt for start date (if FHPSDT="N" do not allow past dates)
"RTN","FHOMUTL",14,0)
 S STDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y
"RTN","FHOMUTL",15,0)
 K DIR S DIR("A")="Select Start Date: ",DIR("B")=FHDTDF
"RTN","FHOMUTL",16,0)
 S DIR(0)="DAO" I $G(FHPSDT)="N" S DIR(0)="DAO^FHDTDF"
"RTN","FHOMUTL",17,0)
 D ^DIR Q:$D(DIRUT)  S STDT=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",18,0)
 Q
"RTN","FHOMUTL",19,0)
ENDATE ;Prompt for end date
"RTN","FHOMUTL",20,0)
 S ENDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y K DIR
"RTN","FHOMUTL",21,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT D ^DIR
"RTN","FHOMUTL",22,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",23,0)
 Q
"RTN","FHOMUTL",24,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMUTL",25,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMUTL",26,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ"
"RTN","FHOMUTL",27,0)
 S DIC("A")="Select Outpatient Ordering Location: "
"RTN","FHOMUTL",28,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMUTL",29,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMUTL",30,0)
 S FHLOC=+Y,FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8)
"RTN","FHOMUTL",31,0)
 I '$O(^FH(119.6,FHLOC,"L",0)) S FHLOC="",FHCOMM="" W !!,"The selected location does not have an Associated Hospital Location.  To set",!,"the Associated Hospital Location use option ENTER/EDIT NUTRITION LOCATIONS."
"RTN","FHOMUTL",32,0)
 Q
"RTN","FHOMUTL",33,0)
 ;
"RTN","FHOMUTL",34,0)
RMBED ;Prompt for outpatient room-bed - must be set up for Outpatient Location
"RTN","FHOMUTL",35,0)
 S (FHRMBD,FHRMBSL)=""
"RTN","FHOMUTL",36,0)
 I $G(FHLOC)="" W !!,"No OUTPATIENT LOCATION selected" Q
"RTN","FHOMUTL",37,0)
 I '$D(^FH(119.6,FHLOC,"R")) Q
"RTN","FHOMUTL",38,0)
 F FHRMBI=0:0 S FHRMBI=$O(^FH(119.6,FHLOC,"R",FHRMBI)) Q:FHRMBI'>0  D
"RTN","FHOMUTL",39,0)
 .S FHRMBPT=$P($G(^FH(119.6,FHLOC,"R",FHRMBI,0)),U),FHRMBSL(FHRMBPT)=1
"RTN","FHOMUTL",40,0)
 K DIC S DIC="^DG(405.4,",DIC(0)="AEQZ"
"RTN","FHOMUTL",41,0)
 S DIC("A")="Select Outpatient Room-Bed: "
"RTN","FHOMUTL",42,0)
 S DIC("S")="I $D(FHRMBSL(+Y))" D ^DIC
"RTN","FHOMUTL",43,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMUTL",44,0)
 S FHRMBD=+Y
"RTN","FHOMUTL",45,0)
 Q
"RTN","FHOMUTL",46,0)
GTFHDFN ;Get FHDFN, given DFN
"RTN","FHOMUTL",47,0)
 K DIR S DIR(0)="NAO",DIR("B")="ENTER DFN" D ^DIR Q:$D(DIRUT)  S ZZDFN=Y
"RTN","FHOMUTL",48,0)
 S FHZ115="P"_ZZDFN,FHDFN=$O(^FHPT("B",FHZ115,""))
"RTN","FHOMUTL",49,0)
 I '$D(^DPT(ZZDFN)) W !!,"DFN '",ZZDFN,"' NOT FOUND IN FILE 2",! Q
"RTN","FHOMUTL",50,0)
 I FHDFN="" W !!,"NO CORRESPONDING FHDFN"
"RTN","FHOMUTL",51,0)
 W !!," NAME: ",$P($G(^DPT(ZZDFN,0)),U,1)
"RTN","FHOMUTL",52,0)
 W !?2,"DFN: ",ZZDFN,!,"FHDFN: ",FHDFN,!
"RTN","FHOMUTL",53,0)
 Q
"RTN","FHOMUTL",54,0)
GETOPT ;Select outpatient for recurring meals
"RTN","FHOMUTL",55,0)
 S FHFIND=1 D ^FHOMDPA I FHDFN="" S FHFIND=0 Q
"RTN","FHOMUTL",56,0)
 I '$D(^FHPT(FHDFN,0)) S FHFIND=0 Q  ;W !!,"UNKNOWN SELECTION !"
"RTN","FHOMUTL",57,0)
 I $O(^FHPT(FHDFN,"OP",0))="" W !!,"NO RECURRING MEALS FOR THIS PERSON" S FHFIND=0 Q
"RTN","FHOMUTL",58,0)
 W ! D STDATE I STDT="" S FHFIND=0 Q
"RTN","FHOMUTL",59,0)
 Q
"RTN","FHOMUTL",60,0)
PATNAME ;Get name and demographics of patient/new person
"RTN","FHOMUTL",61,0)
 ;input variable: FHDFN
"RTN","FHOMUTL",62,0)
 S (FHDOB,FHBID,FHSEX,DFN)="" D GETZN
"RTN","FHOMUTL",63,0)
 I FILE="P" S FHPTNM=$P($G(^DPT(IEN,0)),U,1)
"RTN","FHOMUTL",64,0)
 I FILE="N" S FHPTNM=$P($G(^VA(200,IEN,0)),U,1)
"RTN","FHOMUTL",65,0)
 ;Get SSN,Age,DOB,Sex of patient/new person
"RTN","FHOMUTL",66,0)
 I FILE="P" D
"RTN","FHOMUTL",67,0)
 .S DFN=IEN
"RTN","FHOMUTL",68,0)
 .D PID^FHDPA S FHSSN=PID
"RTN","FHOMUTL",69,0)
 .S FHSEX=$P($G(^DPT(DFN,0)),U,2),FHDOB=$P($G(^DPT(DFN,0)),U,3)
"RTN","FHOMUTL",70,0)
 .S FHBID=BID
"RTN","FHOMUTL",71,0)
 I FILE="N" D
"RTN","FHOMUTL",72,0)
 .S IEN200=IEN,FHSSN=$P($G(^VA(200,IEN,1)),U,9)
"RTN","FHOMUTL",73,0)
 .S FHBID=$E(FHSSN,6,$L(FHSSN))
"RTN","FHOMUTL",74,0)
 .S FHSEX=$P($G(^VA(200,IEN,1)),U,2),FHDOB=$P($G(^VA(200,IEN,1)),U,3)
"RTN","FHOMUTL",75,0)
 S FHAGE="" D NOW^%DTC
"RTN","FHOMUTL",76,0)
 I FHDOB'="" S FHAGE=$E(%,1,3)-$E(FHDOB,1,3)-($E(%,4,7)<$E(FHDOB,4,7))
"RTN","FHOMUTL",77,0)
 Q
"RTN","FHOMUTL",78,0)
GETZN ;Get first piece of zero node in 115
"RTN","FHOMUTL",79,0)
 S FHPCZN=$P($G(^FHPT(FHDFN,0)),U,1),FILE=$E(FHPCZN,1)
"RTN","FHOMUTL",80,0)
 S IEN=$E(FHPCZN,2,99)
"RTN","FHOMUTL",81,0)
 Q
"RTN","FHOMUTL",82,0)
DIETVER ;Verify that diet selected is from the allowable diets in 119.9
"RTN","FHOMUTL",83,0)
 D DIETLST I $D(FHDIETS(FHDIET)) Q
"RTN","FHOMUTL",84,0)
 S FHDIET="" W *7," ==> NOT ALLOWED",! D DIETMSG Q
"RTN","FHOMUTL",85,0)
DIETHLP ;Display allowable diets from 119.9
"RTN","FHOMUTL",86,0)
 D DIETLST,DIETMSG Q
"RTN","FHOMUTL",87,0)
DIETLST ;Build list
"RTN","FHOMUTL",88,0)
 K FHDIETS,SPD S FHSPDTS="",SPD=$P($G(^FH(119.9,1,0)),U,2,6)_"^"_$P($G(^FH(119.9,1,1)),U,1,10)
"RTN","FHOMUTL",89,0)
 S FHDEF=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHOMUTL",90,0)
 F A=1:1:15 S AB=$P(SPD,U,A) D
"RTN","FHOMUTL",91,0)
 .I AB="" Q
"RTN","FHOMUTL",92,0)
 .S FHDIETS(AB)=AB
"RTN","FHOMUTL",93,0)
 .S FHSPDTS=FHSPDTS_$P($G(^FH(111,AB,0)),U,1)_"^"
"RTN","FHOMUTL",94,0)
 Q
"RTN","FHOMUTL",95,0)
DIETMSG ;Display message
"RTN","FHOMUTL",96,0)
 W !?3,"You must select from the diets set up in the Site Parameters:"
"RTN","FHOMUTL",97,0)
 S AB="" F  S AB=$O(FHDIETS(AB)) Q:AB'>0  W !?3,$P($G(^FH(111,AB,0)),U)
"RTN","FHOMUTL",98,0)
 W ! Q
"RTN","FHOMUTL",99,0)
 Q
"RTN","FHOMUTL",100,0)
EXMSG ;Display message stating meal NOT ordered
"RTN","FHOMUTL",101,0)
 D TYPE
"RTN","FHOMUTL",102,0)
 W !!?3,FHMSGML," NOT ordered!",! H 2
"RTN","FHOMUTL",103,0)
 Q
"RTN","FHOMUTL",104,0)
OKMSG ;Display message stating meal ordered successfully
"RTN","FHOMUTL",105,0)
 D TYPE
"RTN","FHOMUTL",106,0)
 D PATNAME W !!?3,FHMSGML," ordered for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",107,0)
 Q
"RTN","FHOMUTL",108,0)
TYPE ;
"RTN","FHOMUTL",109,0)
 S FHMSGML=$S(FHMSG1="G":"Guest meal",FHMSG1="S":"Special meal",FHMSG1="R":"Recurring meal",FHMSG1="E":"Early/Late tray",FHMSG1="T":"Tubefeeding",1:"Additional order")
"RTN","FHOMUTL",110,0)
 Q
"RTN","FHOMUTL",111,0)
UPXMSG ;
"RTN","FHOMUTL",112,0)
 W !!?3,"Recurring meal NOT updated! ",! H 2
"RTN","FHOMUTL",113,0)
 Q
"RTN","FHOMUTL",114,0)
UPDMSG ;
"RTN","FHOMUTL",115,0)
 D PATNAME W !!?3,"Recurring meal updated for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",116,0)
 Q
"RTN","FHOMUTL",117,0)
SMSTAT ;Status of last special meal request
"RTN","FHOMUTL",118,0)
 S FHSMNUM=$O(^FHPT(FHDFN,"SM","B",""),-1) I FHSMNUM="" S FHSTAT="" Q
"RTN","FHOMUTL",119,0)
 I $E(FHSMNUM,1,7)'=DT S FHSTAT="" Q
"RTN","FHOMUTL",120,0)
 S FHSTAT=$P($G(^FHPT(FHDFN,"SM",FHSMNUM,0)),U,2)
"RTN","FHOMUTL",121,0)
 Q
"RTN","FHOMUTL",122,0)
RANGE ;Check for validity of range of numbers entered
"RTN","FHOMUTL",123,0)
 S FHCLST="",FLG="",X=FHNUM D TR^FH S FHNUM=X
"RTN","FHOMUTL",124,0)
 I FHNUM="A"!(FHNUM?1"A"1.2"L") S FHNUM="1-"_NUM
"RTN","FHOMUTL",125,0)
 F K=1:1 S K1=$P(FHNUM,",",K) Q:K1=""!(FLG="QUIT")  D
"RTN","FHOMUTL",126,0)
 .S K2=$S(K1["-":$P(K1,"-",2),1:+K1),K1=+K1 D CK I FLG="QUIT" Q
"RTN","FHOMUTL",127,0)
 .F K3=K1:1:K2 S FHCLST=FHCLST_K3_","
"RTN","FHOMUTL",128,0)
 Q
"RTN","FHOMUTL",129,0)
CK I K1<1!(K1>NUM)!(K1'?1N.N) D C1 Q
"RTN","FHOMUTL",130,0)
 I K2<1!(K2>NUM)!(K2'?1N.N) D C1 Q
"RTN","FHOMUTL",131,0)
 Q:K2'<K1
"RTN","FHOMUTL",132,0)
C1 W !,"  Enter numbers or range or ALL (E.G.,  1,3,4 or 3-5 or 1,3-5)" S FLG="QUIT",FHCLST="" Q
"RTN","FHOMUTL",133,0)
 Q
"RTN","FHOMUTL",134,0)
MSHOM ;Code MSG for outpatient orders
"RTN","FHOMUTL",135,0)
 D SITE^FH
"RTN","FHOMUTL",136,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",137,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",138,0)
 S FHOLOC=$O(^FH(119.6,FHLOC,"L",0)) I FHOLOC="" Q  ;RESULTS IN NO BKDOOR
"RTN","FHOMUTL",139,0)
 S FHOLOC=$G(^FH(119.6,FHLOC,"L",FHOLOC,0))
"RTN","FHOMUTL",140,0)
 S FHOLOCNM=$P($G(^SC(FHOLOC,0)),U,1)
"RTN","FHOMUTL",141,0)
 S MSG(3)="PV1||O|"_FHOLOC_"^"_FHOLOCNM_"||||||||||||||||"
"RTN","FHOMUTL",142,0)
 Q
"RTN","FHOMUTL",143,0)
MSHCA ;Code Cancel/Discontinue for outpatient orders
"RTN","FHOMUTL",144,0)
 D NOW^%DTC S FHNOW=% K MSG S ACT="OC" D SITE^FH
"RTN","FHOMUTL",145,0)
 I $G(FHCATXT)="" S FHCATXT="Dietetics Canceled order."
"RTN","FHOMUTL",146,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",147,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",148,0)
 S DATE=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMUTL",149,0)
 S MSG(3)="ORC|"_ACT_"|"_FHORN_"^OR|"_FILL_"^FH|||||||||"_DUZ_"|||"_DATE_"|"_FHCATXT
"RTN","FHOMUTL",150,0)
 Q
"RTN","FHOMUTL",151,0)
MSHSS ;Code MSG for outpatient send status messages
"RTN","FHOMUTL",152,0)
 D SITE^FH
"RTN","FHOMUTL",153,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORR"
"RTN","FHOMUTL",154,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",155,0)
 S MSG(3)="ORC|SR|"_FHORN_"^OR|"_FILL_"||"_FHSTTS
"RTN","FHOMUTL",156,0)
 Q
"RTN","FHOMUTL",157,0)
CONVC ;Convert Amount/Unit in file 118.2, from "C" to "ML".
"RTN","FHOMUTL",158,0)
 F FHII=0:0 S FHII=$O(^FH(118.2,FHII)) Q:FHII'>0  D
"RTN","FHOMUTL",159,0)
 .S FHAU=$P(^FH(118.2,FHII,0),U,3)
"RTN","FHOMUTL",160,0)
 .I FHAU["C" S FHAF=$P(FHAU,"C",1),FHAS=$P(FHAU,"C",2) D
"RTN","FHOMUTL",161,0)
 ..S $P(^FH(118.2,FHII,0),U,3)=FHAF_"ML"_FHAS
"RTN","FHOMUTL",162,0)
 Q
"RTN","FHOMUTL",163,0)
MONUM ;Prompt for number of monitors to display
"RTN","FHOMUTL",164,0)
 W ! K DIR S FHNUM="",DIR("?")="Select ALL to view all monitors, or select a specific number.  For example, enter 20 to display the 20 most recent monitors."
"RTN","FHOMUTL",165,0)
 S DIR(0)="F",DIR("A")="How many monitors would you like to display?"
"RTN","FHOMUTL",166,0)
 S DIR("B")="ALL" D ^DIR
"RTN","FHOMUTL",167,0)
 I $D(DIRUT) S FHNUM="" Q
"RTN","FHOMUTL",168,0)
 S FHNUM=Y I FHNUM'="A",FHNUM'="ALL",FHNUM'?1.5N D MONUM Q
"RTN","FHOMUTL",169,0)
 I FHNUM="A"!(FHNUM="ALL") S FHNUM=99999
"RTN","FHOMUTL",170,0)
 Q
"RTN","FHOMWOR")
0^66^B25425575
"RTN","FHOMWOR",1,0)
FHOMWOR ;Hines OIFO/RTK OUTPATIENT MEALS/HL7 MESSAGING  ;10/21/03  10:15
"RTN","FHOMWOR",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHOMWOR",3,0)
 S FHDFN="",FHZ115="P"_DFN D ADD^FHOMDPA
"RTN","FHOMWOR",4,0)
 I 'FHDFN S TXT="Outpatient not found" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",5,0)
 ;Decode FHMSG(3) - PV1
"RTN","FHOMWOR",6,0)
 S FHX=$G(FHMSG(3))
"RTN","FHOMWOR",7,0)
 I $E(FHX,1,3)'="PV1" S TXT="3rd msg not PV1" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",8,0)
 S FHLOC=$P($P(FHX,"|",4),U,1)
"RTN","FHOMWOR",9,0)
 I FHLOC="" S TXT="Missing Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",10,0)
 S FHLOC=$O(^FH(119.6,"AL",FHLOC,""))
"RTN","FHOMWOR",11,0)
 I 'FHLOC S TXT="Invalid Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",12,0)
 ;Decode FHMSG(4) - ORC
"RTN","FHOMWOR",13,0)
 S FHX=$G(FHMSG(4))
"RTN","FHOMWOR",14,0)
 I $E(FHX,1,3)'="ORC" S TXT="4th msg not ORC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",15,0)
 S FHORN=$P(FHX,"|",3),FHORN=+FHORN,FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",16,0)
 S FHDUR=$P(FHX,"|",8),FHDOW=$P(FHDUR,U,2)
"RTN","FHOMWOR",17,0)
 S DATE=$E($P(FHDUR,U,4),1,8) D CVT^FHWOR S STDT=DATE,FHOSTDT=STDT
"RTN","FHOMWOR",18,0)
 S DATE=$P(FHDUR,U,5) D CVT^FHWOR S ENDT=DATE I ENDT'="" S ENDT=ENDT_.99
"RTN","FHOMWOR",19,0)
 I ENDT="" S ENDT=9999999.99
"RTN","FHOMWOR",20,0)
 S ACT=$P(FHX,"|",2) I ACT="CA"!(ACT="DC") D CANCEL Q
"RTN","FHOMWOR",21,0)
 I ACT="NA" D NA Q
"RTN","FHOMWOR",22,0)
 I ACT="SS" D OMSTAT^FHWORR Q
"RTN","FHOMWOR",23,0)
 I ACT'="NW" S TXT="Action not NW, CA or DC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",24,0)
 D NOW^%DTC S FHNOW=$P(%,".",1)
"RTN","FHOMWOR",25,0)
 I STDT=""!(STDT<FHNOW) S TXT="Start Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",26,0)
 I ENDT<STDT S TXT="End Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",27,0)
 S FHPV=$P(FHX,"|",13),FHEFF=$P(FHX,"|",16)
"RTN","FHOMWOR",28,0)
 I FHEFF="" S TXT="No effective date" D ERR Q
"RTN","FHOMWOR",29,0)
 ;Decode FHMSG(5) - ODS/ODT
"RTN","FHOMWOR",30,0)
 S FHX=$G(FHMSG(5))
"RTN","FHOMWOR",31,0)
 S FHINST=$P(FHX,"|",4),FHBAG="N" I FHINST="bagged" S FHBAG="Y"
"RTN","FHOMWOR",32,0)
 S FHSVCP=$P($P(FHX,"|",3),U,4)
"RTN","FHOMWOR",33,0)
 I $E(FHX,1,3)="ODT" D HL7SET^FHOMRE1 Q  ;EARLY/LATE
"RTN","FHOMWOR",34,0)
 I $E(FHX,1,3)="OBR" D HL7SET^FHOMIP Q  ;ISOLATION/PRECAUTION
"RTN","FHOMWOR",35,0)
 I $E(FHX,1,3)'="ODS" S TXT="5th message not ODT or ODS as expected" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",36,0)
 S FHTYPC=$P(FHX,"|",2) I FHTYPC="ZE" D HL7SET^FHOMRT1 Q  ;TUBEFEEDING
"RTN","FHOMWOR",37,0)
 S FHDTX=$P(FHX,"|",4),FHDIET=$P(FHDTX,U,4),FHDTX=$E(FHDTX,4,$L(FHDTX))
"RTN","FHOMWOR",38,0)
 S FHCOM=$P(FHX,"|",5),FHM3=$P(FHX,"|",3)
"RTN","FHOMWOR",39,0)
 I $E(FHDTX,1,4)="FH-6" D HL7SET^FHOMRA1 Q  ;ADDITIONAL ORDERS
"RTN","FHOMWOR",40,0)
 S FHMEAL=$S(FHM3=1:"B",FHM3=3:"N",FHM3=5:"E",1:"")
"RTN","FHOMWOR",41,0)
 I FHMEAL="" S TXT="Meal missing" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",42,0)
 I FHDIET="" S TXT="Missing diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",43,0)
 I '$D(^FH(111,FHDIET)) S TXT="Invalid diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",44,0)
 I FHTYPC="S" D SM  ;SPECIAL MEAL REQUEST
"RTN","FHOMWOR",45,0)
 I FHTYPC="D" D RM I $G(FHAIL)'="" Q  ;RECURRING MEAL ORDER
"RTN","FHOMWOR",46,0)
 D SEND^FHWOR Q
"RTN","FHOMWOR",47,0)
SM ; Special Meal Request
"RTN","FHOMWOR",48,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",49,0)
 D NOW^%DTC S FHNOW=%
"RTN","FHOMWOR",50,0)
 S FHDUZ=$P($G(FHMSG(4)),"|",11),FHSTAT="P"
"RTN","FHOMWOR",51,0)
 I FHDUZ'="",$D(^XUSEC("FHAUTH",FHDUZ)) S FHSTAT="A"
"RTN","FHOMWOR",52,0)
 S FHQEL=1 D SETNODE^FHOMSR1
"RTN","FHOMWOR",53,0)
 S FILL="S;"_FHSMID
"RTN","FHOMWOR",54,0)
 Q
"RTN","FHOMWOR",55,0)
RM ;
"RTN","FHOMWOR",56,0)
 ; Recurring orders from CPRS will only have ONE diet, not up to 5 like
"RTN","FHOMWOR",57,0)
 ; for NonVA patients/inpatients therefore can set FHDIETX1-5 = NULL
"RTN","FHOMWOR",58,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",59,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1) I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMWOR",60,0)
 S FHMPNUM=FHMPNUM+1
"RTN","FHOMWOR",61,0)
 S (FHAIL,FHRMBD,FHDIETX(1),FHDIETX(2),FHDIETX(3),FHDIETX(4),FHDIETX(5))=""
"RTN","FHOMWOR",62,0)
 S (C,FHENDL)=0,STDTLP=STDT,FHDZ="" F  Q:FHENDL=1  D
"RTN","FHOMWOR",63,0)
 .S X=STDTLP D H^%DTC S:%Y=0 %Y=7 S FHDZ=FHDZ_%Y_"^",X1=STDTLP,X2=1
"RTN","FHOMWOR",64,0)
 .D C^%DTC S STDTLP=X,C=C+1 I STDTLP>ENDT!(C>6) S FHENDL=1 Q
"RTN","FHOMWOR",65,0)
 S FHDAYS="" F FHH=1:1:7 S FHPCE=$P(FHDOW,"~",FHH) Q:FHPCE=""  D
"RTN","FHOMWOR",66,0)
 .S FHD3=$E(FHPCE,3)
"RTN","FHOMWOR",67,0)
 .I FHD3'>0,FHD3'<8 Q
"RTN","FHOMWOR",68,0)
 .I FHDZ'[FHD3 Q
"RTN","FHOMWOR",69,0)
 .S FHDAYS=FHDAYS_$E("MTWRFSX",FHD3)
"RTN","FHOMWOR",70,0)
 I FHDAYS="",$E(STDT,1,7)'=$E(ENDT,1,7) S (TXT,FHAIL)="Day of week invalid or not within date range" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",71,0)
 I FHDAYS="",$E(STDT,1,7)=$E(ENDT,1,7) S X=$E(STDT,1,7) D DOW^%DTC S FHDAYS=$E("XMTWRFS",Y+1)
"RTN","FHOMWOR",72,0)
 D SETNODE^FHOMRO1
"RTN","FHOMWOR",73,0)
 S FILL="R;"_FHMPNUM_";"_STDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMWOR",74,0)
 Q
"RTN","FHOMWOR",75,0)
CANCEL ;Cancel outpatient orders
"RTN","FHOMWOR",76,0)
 S FHENDT=ENDT,FHX=$G(FHMSG(4)),FILL=$P(FHX,"|",4),FHMPNUM=""
"RTN","FHOMWOR",77,0)
 S FHORSAV=FHORN,FHILSAV=FILL,FHACTSV=ACT
"RTN","FHOMWOR",78,0)
 S FHTYPE=$P(FILL,";",1) I FHTYPE="R" S FHMPNUM=$P(FILL,";",2)
"RTN","FHOMWOR",79,0)
 I "AEIGSRT"'[FHTYPE S TXT="Invalid cancel code" D ERR Q
"RTN","FHOMWOR",80,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMWOR",81,0)
 I "AET"[FHTYPE F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>FHENDT)  D
"RTN","FHOMWOR",82,0)
 .F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMWOR",83,0)
 ..I FHTYPE="A" D CANAO^FHOMRC1 Q
"RTN","FHOMWOR",84,0)
 ..I FHTYPE="E" D CANEL^FHOMRC1 Q
"RTN","FHOMWOR",85,0)
 ..I FHTYPE="T" D CANTF^FHOMRC1 Q
"RTN","FHOMWOR",86,0)
 I FHTYPE="R" F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHRNUM)) Q:FHRNUM'>0  S FHRMDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1) D CANRM^FHOMRC1,ASSOC^FHOMRC2
"RTN","FHOMWOR",87,0)
 I FHTYPE="I" D CAN^FHOMIP
"RTN","FHOMWOR",88,0)
 I FHTYPE="S" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CAN^FHOMSC1,CNSMEL^FHOMRC2  ;cancel a SM and associated SM Late Tray
"RTN","FHOMWOR",89,0)
 I FHTYPE="G" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CNSMEL^FHOMRC2  ;cancel a SM Late Tray only
"RTN","FHOMWOR",90,0)
 S FHORN=FHORSAV,FILL=FHILSAV,ACT=FHACTSV D CSEND^FHWOR Q
"RTN","FHOMWOR",91,0)
 Q
"RTN","FHOMWOR",92,0)
NA ;Number assign for outpatient
"RTN","FHOMWOR",93,0)
 S FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",94,0)
 S FHTYPE=$P(FILL,";",1) S (FHMPN,FHRNUM)=+$P(FILL,";",2)
"RTN","FHOMWOR",95,0)
 D NA^FHOMWOR1
"RTN","FHOMWOR",96,0)
 Q
"RTN","FHOMWOR",97,0)
ERR ;
"RTN","FHOMWOR",98,0)
 K MSG D RMSH^FHWOR  ;Sets MSG(1) & MSG(2)
"RTN","FHOMWOR",99,0)
 S ACT="UA" I $P(FHMSG(4),"|",2)="CA" S ACT="U"_$E($P(FHMSG(4),"|",2),1)
"RTN","FHOMWOR",100,0)
 S $P(MSG(3),"|",1,2)="ORC|"_ACT,$P(MSG(3),"|",3)=FHORN
"RTN","FHOMWOR",101,0)
 S $P(MSG(3),"|",4)=$P(FHMSG(3),"|",4)
"RTN","FHOMWOR",102,0)
 S $P(MSG(3),"|",13)=$P(FHMSG(3),"|",13)
"RTN","FHOMWOR",103,0)
 S $P(MSG(3),"|",16)=$P(FHMSG(3),"|",16),$P(MSG(3),"|",17)=TXT
"RTN","FHOMWOR",104,0)
 ;
"RTN","FHOMWOR",105,0)
 ;W ! F RK=0:0 S RK=$O(MSG(RK)) Q:RK'>0  W !,"  MSG"_RK_"= ",MSG(RK)
"RTN","FHOMWOR",106,0)
 ;F RK=0:0 S RK=$O(FHMSG(RK)) Q:RK'>0  W !,"FHMSG"_RK_"= ",FHMSG(RK)
"RTN","FHOMWOR",107,0)
 ;W !!,"TXT=",TXT,!!
"RTN","FHOMWOR",108,0)
 ;
"RTN","FHOMWOR",109,0)
 D EVSEND^FHWOR Q
"RTN","FHOMWOR",110,0)
 Q
"RTN","FHORD")
0^30^B9723467
"RTN","FHORD",1,0)
FHORD ; HISC/REL/NCA - Diet Order Entry ;8/9/96  12:29 ;
"RTN","FHORD",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHORD",3,0)
EN1 ; Edit Diets
"RTN","FHORD",4,0)
 S CHK=0,TYP="D",EVENT="UPD",REC=1,(NOD1,NOD2)="" K ^TMP($J,"FHNOD3")
"RTN","FHORD",5,0)
 S (DIC,DIE)="^FH(111,",DIC(0)="AEQLM",DIC("DR")=".01",DLAYGO=111 W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN1:Y<1
"RTN","FHORD",6,0)
 S FHOLDLB=$P($G(^FH(111,+Y,0)),U,7)
"RTN","FHORD",7,0)
 S IEN=Y,NOD1=$P($G(^FH(111,+IEN,0)),"^",1,4),NOD2=$G(^FH(111,+IEN,"I"))
"RTN","FHORD",8,0)
 F IEN1=0:0 S IEN1=$O(^FH(111,+IEN,"AN",IEN1)) Q:IEN1<1  S:'$D(^TMP($J,"FHNOD3",IEN1)) ^TMP($J,"FHNOD3",IEN1)=$G(^FH(111,+IEN,"AN",IEN1,0))
"RTN","FHORD",9,0)
 ;DR STRING MODIFIED TO ONLY EDIT INACTIVE STATUS IF DIET ORDER INACTIVE
"RTN","FHORD",10,0)
 S DA=+Y,DR="I $G(^FH(111,+IEN,""I""))=""Y"" S Y=99;"_$S(DA'=1:".01:99",1:"1;2;5;6;10"),DIE("NO^")="" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=111 D ^DIE K DIC,DIE,DIDEL I $D(^ORD(101.43)) D UPDATE^FHWOR6
"RTN","FHORD",11,0)
 S FHNEWLB=$P($G(^FH(111,+IEN,0)),U,7)
"RTN","FHORD",12,0)
 I FHOLDLB'=FHNEWLB,FHOLDLB'="" W !!,"The Abbreviated Label for this Diet has been changed to ",$P($G(^FH(111,+IEN,0)),U,7),".",!,"Diet Patterns containing this Diet will now be updated to reflect this change:",! H 2 D UPDPAT
"RTN","FHORD",13,0)
 G EN1
"RTN","FHORD",14,0)
EN2 ; List Diets
"RTN","FHORD",15,0)
 W !!,"The list requires a 132 column printer.",!
"RTN","FHORD",16,0)
 W ! S L=0,DIC="^FH(111,",FLDS="[FHDIETL]",BY="NAME"
"RTN","FHORD",17,0)
 S FR="",TO="",DHD="DIETS LIST" D EN1^DIP,RSET Q
"RTN","FHORD",18,0)
KIL K ^TMP($J),%,ADM,ALL,C,CHK,D,DA,DIC,DIE,DR,FHDFN,DFN,EVENT,FHDR,FHK,I,IEN,IEN1,FHNEWLB,FHNEWNM,FHOLDLB,FHOLDNM,FHFH,FHFND,FHDPIEN,FLG,FHX1,FHX2,FHWF,FHPV,COM,NOD1,NOD2,NOD3,NOW,POP,REC,STR,STR1,TYP,WARD,X Q
"RTN","FHORD",19,0)
RSET K %ZIS S IOP="" D ^%ZIS K %ZIS,IOP,BY,DA,FHDFN,DFN,DHD,DIC,DIE,DR,FLDS,FR,L,TO,X,Y Q
"RTN","FHORD",20,0)
 ;
"RTN","FHORD",21,0)
UPDPAT ; Update Diet Pattern names
"RTN","FHORD",22,0)
 S FLG=0 F FHDPIEN=0:0 S FHDPIEN=$O(^FH(111.1,FHDPIEN)) Q:FHDPIEN'>0  D
"RTN","FHORD",23,0)
 .S FHFND=0,FHOLDNM=$P($G(^FH(111.1,FHDPIEN,0)),U,1)
"RTN","FHORD",24,0)
 .S FHDPDTS=$P($G(^FH(111.1,FHDPIEN,0)),U,2,6)
"RTN","FHORD",25,0)
 .F FHFH=1:1:5 I $P(FHDPDTS,U,FHFH)=+IEN S FHFND=FHFH
"RTN","FHORD",26,0)
 .Q:FHFND=0
"RTN","FHORD",27,0)
 .S FLG=1,FHNEWNM=FHOLDNM S $P(FHNEWNM,",",FHFND)=" "_FHNEWLB
"RTN","FHORD",28,0)
 .I $E(FHNEWNM,1)=" " S FHNEWNM=$E(FHNEWNM,2,99)
"RTN","FHORD",29,0)
 .W !,FHOLDNM," will change to ",FHNEWNM
"RTN","FHORD",30,0)
 .K DIE S DIE="^FH(111.1,",DA=FHDPIEN,DR=".01////^S X=FHNEWNM" D ^DIE
"RTN","FHORD",31,0)
 W !!,$S(FLG=1:"...Diet Patterns have been updated!",1:"...No Diet Patterns needed updating.") Q
"RTN","FHORD13")
0^26^B54149113
"RTN","FHORD13",1,0)
FHORD13 ; HISC/REL/NCA/RVD - Reprint Diet Label ;2/26/96  11:57
"RTN","FHORD13",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHORD13",3,0)
 ;patch #5 - screen for cancelled guest meals and added outpt room-bed.
"RTN","FHORD13",4,0)
 W @IOF,!!?21,"R E P R I N T   D I E T   L A B E L S"
"RTN","FHORD13",5,0)
F0 R !!,"Reprint by COMMUNICATION OFFICE, PATIENT, LOCATION or ALL? PATIENT// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="P" D TR^FH
"RTN","FHORD13",6,0)
 I $P("COMMUNICATION OFFICE",X,1)'="",$P("PATIENT",X,1)'="",$P("LOCATION",X,1)'="",$P("ALL",X,1)'="" W *7,!!,"  Answer with C, L, P or A" G F0
"RTN","FHORD13",7,0)
 S FHPR=$E(X,1),ALL=0,(FHX1,FHX2)="" G P0:FHPR?1"P",D2:FHPR?1"C",P1:FHPR?1"A"
"RTN","FHORD13",8,0)
W0 K DIC S DIC("A")="Select LOCATION: ",DIC="^FH(119.6,",DIC(0)="AEQM" W ! D ^DIC K DIC G KIL:"^"[X!$D(DTOUT),W0:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",9,0)
D2 K DIC S DIC("A")="Select COMMUNICATION OFFICE: ",DIC="^FH(119.73,",DIC(0)="AEMQ" W ! D ^DIC G KIL:"^"[X!$D(DTOUT),D2:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",10,0)
P0 S FHALL=1 D ^FHOMDPA I '$G(FHDFN),FHX1'="" G P1
"RTN","FHORD13",11,0)
 Q:'FHDFN
"RTN","FHORD13",12,0)
 S ADM="*"
"RTN","FHORD13",13,0)
 I 'DFN,$G(FHDFN) G PPT
"RTN","FHORD13",14,0)
 I $D(^DPT(DFN,.1)) S WARD=$G(^DPT(DFN,.1)) D
"RTN","FHORD13",15,0)
 .I $G(^DPT("CN",WARD,DFN)) S ADM=$G(^DPT("CN",WARD,DFN))
"RTN","FHORD13",16,0)
PPT S FHX1=$G(FHX1)_FHDFN_"^",FHX2=$G(FHX2)_ADM_"^" I $L(FHX1)<231,$L(FHX2)<231 G P0
"RTN","FHORD13",17,0)
 G:FHX1="" KIL
"RTN","FHORD13",18,0)
P1 ;
"RTN","FHORD13",19,0)
 W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHORD13",20,0)
 Q:$D(DIRUT)  S LABSTART=Y
"RTN","FHORD13",21,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LABEL Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD13",22,0)
 I $D(IO("Q")) S FHPGM="Q1^FHORD13",FHLST="FHX1^FHX2^FHPR^LABSTART" D EN2^FH G KIL
"RTN","FHORD13",23,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHORD13",24,0)
Q1 ; Reprint the Diet Labels
"RTN","FHORD13",25,0)
 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1 S S2=LAB=2*5+36 D NOW^%DTC S NOW=%
"RTN","FHORD13",26,0)
 S COUNT=0,LINE=1
"RTN","FHORD13",27,0)
 S DTP=NOW D DTP^FH,^FHDEV G:FHX1>0 Q2
"RTN","FHORD13",28,0)
 S WRD=-FHX1 K ^TMP($J)
"RTN","FHORD13",29,0)
 F K1=0:0 S K1=$O(^FH(119.6,K1)) Q:K1<1  S X=^(K1,0) D F1
"RTN","FHORD13",30,0)
 S RM="" F  S RM=$O(^TMP($J,"DL",RM)) Q:RM=""  F DFN=0:0 S DFN=$O(^TMP($J,"DL",RM,DFN)) Q:DFN<1  S ADM=^(DFN) S FHZ115="P"_DFN D CHECK^FHOMDPA Q:FHDFN=""  D:ADM LST
"RTN","FHORD13",31,0)
 ;process outpatient
"RTN","FHORD13",32,0)
 D OUTP
"RTN","FHORD13",33,0)
 D PROUT
"RTN","FHORD13",34,0)
 I LAB>2 D DPLL^FHLABEL G KIL
"RTN","FHORD13",35,0)
 I LAB<3 F K7=1:1:18 W !
"RTN","FHORD13",36,0)
 G KIL
"RTN","FHORD13",37,0)
 ;
"RTN","FHORD13",38,0)
F1 I FHPR="C" S KK=$P(X,"^",8) I WRD,KK'=WRD Q
"RTN","FHORD13",39,0)
 I FHPR="L" S KK=$P(X,"^",1) I WRD,K1'=WRD Q
"RTN","FHORD13",40,0)
 S P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD13",41,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",K1,FHDFN)) Q:FHDFN<1  D
"RTN","FHORD13",42,0)
 .D PATNAME^FHOMUTL Q:DFN=""
"RTN","FHORD13",43,0)
 .S ADM=$G(^FHPT("AW",K1,FHDFN))
"RTN","FHORD13",44,0)
 .S RM=$G(^DPT(DFN,.101))
"RTN","FHORD13",45,0)
 .S:RM="" RM="***"
"RTN","FHORD13",46,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,K1,0)),1:"")
"RTN","FHORD13",47,0)
 .S R0=$S(RE:$P($G(^FH(119.6,K1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORD13",48,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORD13",49,0)
 .S ^TMP($J,"DL",P0_"~"_R0_"~"_RM,DFN)=ADM Q
"RTN","FHORD13",50,0)
 Q
"RTN","FHORD13",51,0)
 ;
"RTN","FHORD13",52,0)
Q2 F K7=1:1 S FHDFN=$P(FHX1,"^",K7) Q:FHDFN<1  D PATNAME^FHOMUTL S ADM=$P(FHX2,"^",K7) D:$G(ADM) LST I '$G(ADM) S FHDFNSAV(FHDFN)=FHDFN
"RTN","FHORD13",53,0)
 ;process outpatient
"RTN","FHORD13",54,0)
 D OUTP
"RTN","FHORD13",55,0)
 D PROUT
"RTN","FHORD13",56,0)
 I LAB>2 D DPLL^FHLABEL G KIL
"RTN","FHORD13",57,0)
Q3 I LAB<3 F K7=1:1:18 W !
"RTN","FHORD13",58,0)
 G KIL
"RTN","FHORD13",59,0)
 ;
"RTN","FHORD13",60,0)
LST ;
"RTN","FHORD13",61,0)
 Q:'$D(^FHPT(FHDFN,"A",ADM,0))  S X0=^(0)
"RTN","FHORD13",62,0)
 S FHORD=$P(X0,"^",2),X1=$P(X0,"^",5) Q:FHORD<1
"RTN","FHORD13",63,0)
 S W1=$P(X0,"^",8),W1=$P($G(^FH(119.6,+W1,0)),"^",1),R1=$G(^DPT(DFN,.101))
"RTN","FHORD13",64,0)
 Q:'$D(^DPT(DFN,0))  S Y0=^(0) D PID^FHDPA
"RTN","FHORD13",65,0)
 S W1=$E(W1,1,15),N1=$E($P(Y0,"^",1),1,22)
"RTN","FHORD13",66,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0))
"RTN","FHORD13",67,0)
 S (Y,X1)="" G:X="" L1 S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORD13",68,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") G:%<1 L1 S Y=$P($E(FHDU,%,999),";",1) G L1
"RTN","FHORD13",69,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORD13",70,0)
 S IS=$P(X0,"^",10),X1=$P(X,"^",8) I IS S IS=^FH(119.4,IS,0),X1=X1_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORD13",71,0)
 ;
"RTN","FHORD13",72,0)
L1 I LAB>2 D LL Q
"RTN","FHORD13",73,0)
 W !,$E(N1,1,S2-5-$L(W1)),?(S2-3-$L(W1)),W1,!,BID W @FHIO("EON") W ?(S2-3\2),X1 W @FHIO("EOF") W ?(S2-3-$L(R1)),R1 W @FHIO("EON") I $L(Y)<S2 W:LAB=2 ! W !!,Y,!!
"RTN","FHORD13",74,0)
 E  S L=$S($L($P(Y,",",1,3))<S2:3,1:2) W !!,$P(Y,",",1,L) W:LAB=2 ! W !,$E($P(Y,",",L+1,5),2,99),!
"RTN","FHORD13",75,0)
 W @FHIO("EOF") W:LAB=2 ?(S2-20),DTP,!! Q
"RTN","FHORD13",76,0)
 ;
"RTN","FHORD13",77,0)
OUTP ;process outpatient dat
"RTN","FHORD13",78,0)
 S (R1,FHW1SAV,FHFHPSAV)=""
"RTN","FHORD13",79,0)
 I FHPR="L" S FHW1SAV=-FHX1
"RTN","FHORD13",80,0)
 I FHPR="C" S FHFHPSAV=-FHX1
"RTN","FHORD13",81,0)
 S FHD1=DT-.00001,FHD2=DT+.99999
"RTN","FHORD13",82,0)
 ;next recurring
"RTN","FHORD13",83,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>FHD2)  D
"RTN","FHORD13",84,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",85,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHORD13",86,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHORD13",87,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHORD13",88,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHORD13",89,0)
 ...I FHSTAT="C" Q
"RTN","FHORD13",90,0)
 ...S FHDIET1=$P(FHKDAT,U,7)
"RTN","FHORD13",91,0)
 ...S FHDIET2=$P(FHKDAT,U,8)
"RTN","FHORD13",92,0)
 ...S FHDIET3=$P(FHKDAT,U,9)
"RTN","FHORD13",93,0)
 ...S FHDIET4=$P(FHKDAT,U,10)
"RTN","FHORD13",94,0)
 ...S FHDIET5=$P(FHKDAT,U,11)
"RTN","FHORD13",95,0)
 ...I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",96,0)
 ...I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",97,0)
 ...I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",98,0)
 ...S FHLOC="",FHRGS="OP"
"RTN","FHORD13",99,0)
 ...S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",100,0)
 ...I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",101,0)
 ...S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",102,0)
 ...S FHRMB=$P(FHKDAT,U,18)
"RTN","FHORD13",103,0)
 ...D OUTW
"RTN","FHORD13",104,0)
 ;next guest
"RTN","FHORD13",105,0)
 K FHDIET1,FHDIET2,FHDIET3,FHDIET4,FHDIET5
"RTN","FHORD13",106,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHORD13",107,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",108,0)
 ..I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",109,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHORD13",110,0)
 ..I $P(FHKDAT,U,9)="C" Q
"RTN","FHORD13",111,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHORD13",112,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHORD13",113,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",114,0)
 ..I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",115,0)
 ..S FHLOC=""
"RTN","FHORD13",116,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",117,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",118,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",119,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",120,0)
 ..S FHRMB=$P(FHKDAT,U,11)
"RTN","FHORD13",121,0)
 ..D OUTW
"RTN","FHORD13",122,0)
 ;next SPECIAL
"RTN","FHORD13",123,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHORD13",124,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",125,0)
 ..I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",126,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHORD13",127,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHORD13",128,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",129,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHORD13",130,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHORD13",131,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",132,0)
 ..I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",133,0)
 ..S FHLOC=""
"RTN","FHORD13",134,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",135,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",136,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",137,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",138,0)
 ..S FHRMB=$P(FHKDAT,U,13)
"RTN","FHORD13",139,0)
 ..D OUTW
"RTN","FHORD13",140,0)
 Q
"RTN","FHORD13",141,0)
 ;
"RTN","FHORD13",142,0)
OUTW ;set all outpt data for printing
"RTN","FHORD13",143,0)
 D PATNAME^FHOMUTL
"RTN","FHORD13",144,0)
 S FHTC=""
"RTN","FHORD13",145,0)
 Q:'$D(^FH(119.6,FHW1,0))
"RTN","FHORD13",146,0)
 S P0=$P(^FH(119.6,FHW1,0),U,4)
"RTN","FHORD13",147,0)
 S P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD13",148,0)
 S FHW1N=$P(^FH(119.6,FHW1,0),U,1)
"RTN","FHORD13",149,0)
 S FHTC5=$P(^FH(119.6,FHW1,0),U,5)
"RTN","FHORD13",150,0)
 S FHTC6=$P(^FH(119.6,FHW1,0),U,6)
"RTN","FHORD13",151,0)
 I $G(FHTC5),$D(^FH(119.72,FHTC5,0)) S FHTC=FHTC_$P(^FH(119.72,FHTC5,0),U,2)
"RTN","FHORD13",152,0)
 I $G(FHTC6),$D(^FH(119.72,FHTC6,0)) S FHTC=FHTC_$P(^FH(119.72,FHTC6,0),U,2)
"RTN","FHORD13",153,0)
 S:$G(FHDIET) FHDIET=$P(^FH(111,FHDIET,0),U,7)
"RTN","FHORD13",154,0)
 I $G(FHDIET1) S FHDIET1=$P(^FH(111,FHDIET1,0),U,7) D
"RTN","FHORD13",155,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET1 Q
"RTN","FHORD13",156,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET1
"RTN","FHORD13",157,0)
 I $G(FHDIET2) S FHDIET2=$P(^FH(111,FHDIET2,0),U,7) D
"RTN","FHORD13",158,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET2 Q
"RTN","FHORD13",159,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET2
"RTN","FHORD13",160,0)
 I $G(FHDIET3) S FHDIET3=$P(^FH(111,FHDIET3,0),U,7) D
"RTN","FHORD13",161,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET3 Q
"RTN","FHORD13",162,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET3
"RTN","FHORD13",163,0)
 I $G(FHDIET4) S FHDIET4=$P(^FH(111,FHDIET4,0),U,7) D
"RTN","FHORD13",164,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET4 Q
"RTN","FHORD13",165,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET4
"RTN","FHORD13",166,0)
 I $G(FHDIET5) S FHDIET5=$P(^FH(111,FHDIET5,0),U,7) D
"RTN","FHORD13",167,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET5 Q
"RTN","FHORD13",168,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET5
"RTN","FHORD13",169,0)
 S FHRM=""
"RTN","FHORD13",170,0)
 I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S FHRM=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHORD13",171,0)
 S:FHRM'="" FHRM=$E(FHRM,1,12)
"RTN","FHORD13",172,0)
 S ^TMP($J,"OUT",P0_"~"_$E(FHW1N,1,20)_"~"_$E(FHPTNM,1,26),FHDFN)=FHPTNM_"^"_FHW1N_"^"_FHBID_"^"_FHDIET_"^"_FHTC_"^"_FHRM
"RTN","FHORD13",173,0)
 Q
"RTN","FHORD13",174,0)
 ;
"RTN","FHORD13",175,0)
PROUT ;print outptlabels
"RTN","FHORD13",176,0)
 S (X1,RM)=""
"RTN","FHORD13",177,0)
 F  S RM=$O(^TMP($J,"OUT",RM)) Q:RM=""  D
"RTN","FHORD13",178,0)
 .F FHDFN=0:0 S FHDFN=$O(^TMP($J,"OUT",RM,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",179,0)
 ..S FHOU=^TMP($J,"OUT",RM,FHDFN)
"RTN","FHORD13",180,0)
 ..S N1=$P(FHOU,U,1)
"RTN","FHORD13",181,0)
 ..S W1=$E($P(FHOU,U,2),1,12)
"RTN","FHORD13",182,0)
 ..S BID=$P(FHOU,U,3)
"RTN","FHORD13",183,0)
 ..S (Y,FHDIET)=$P(FHOU,U,4)
"RTN","FHORD13",184,0)
 ..S X1=$P(FHOU,U,5)
"RTN","FHORD13",185,0)
 ..S R1=$P(FHOU,U,6)
"RTN","FHORD13",186,0)
 ..D L1
"RTN","FHORD13",187,0)
 Q
"RTN","FHORD13",188,0)
 ;
"RTN","FHORD13",189,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHORD13",190,0)
 Q
"RTN","FHORD13",191,0)
LL D LAB^FHLABEL Q
"RTN","FHORD6")
0^3^B21050058
"RTN","FHORD6",1,0)
FHORD6 ; HISC/REL/NCA/JH/RTK - Diet Inquiry ;5/3/01  11:04
"RTN","FHORD6",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHORD6",3,0)
 S FHALL=1 D ^FHOMDPA I 'FHDFN G KIL
"RTN","FHORD6",4,0)
 D MONUM^FHOMUTL I FHNUM="" Q
"RTN","FHORD6",5,0)
 I FHDFN,DFN="" D ^FHOMPP Q  ;profile for file #200 outpatients
"RTN","FHORD6",6,0)
 I FHDFN,$G(^DPT(DFN,.1))="" D ^FHOMPP Q  ;profile for file #2 outpts
"RTN","FHORD6",7,0)
 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD6",8,0)
 I $D(IO("Q")) S FHPGM="F0^FHORD6",FHLST="FHDFN^DFN^PID^ADM^FHNUM" D EN2^FH G KIL
"RTN","FHORD6",9,0)
 U IO D F0 D ^%ZISC K %ZIS,IOP G FHORD6
"RTN","FHORD6",10,0)
F0 ; Display Diet
"RTN","FHORD6",11,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,QT=""
"RTN","FHORD6",12,0)
 S WARD=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",8) S:WARD WARD=$P($G(^FH(119.6,WARD,0)),"^",1)
"RTN","FHORD6",13,0)
 S Y(0)=^DPT(DFN,0),SEX=$P(Y(0),"^",2),DOB=$P(Y(0),"^",3)
"RTN","FHORD6",14,0)
 S AGE=$E(NOW,1,3)-$E(DOB,1,3)-($E(NOW,4,7)<$E(DOB,4,7)),X=$P($G(^DPT(DFN,.101)),"^",1),RM=$E(WARD,1,15) S:X'="" RM=RM_"/"_X
"RTN","FHORD6",15,0)
 S QT="",PG=0 D HDR
"RTN","FHORD6",16,0)
 D ALG^FHCLN I ALG'="" W !!,"Allergies: ",ALG
"RTN","FHORD6",17,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0),M=$P(X,"^",2) S:M="A" M="BNE" D SP
"RTN","FHORD6",18,0)
 I $O(N(""))="" W !!,"No Food Preferences on file",! G A0
"RTN","FHORD6",19,0)
 W !!,"Food Preferences Currently on file",!!?23,"Likes",?57,"Dislikes",!
"RTN","FHORD6",20,0)
 W ! S (M,MM)="" F  S M=$O(N(M)) Q:M=""  I $D(N(M)) W $P(M,"~",2) D  Q:QT="^"  S MM=M ;P32
"RTN","FHORD6",21,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M,"L",P1)) S X1=$S(P1>0:N(M,"L",P1),1:"") S:P2'="" P2=$O(N(M,"D",P2)) S X2=$S(P2>0:N(M,"D",P2),1:"") Q:P1=""&(P2="")  D W0 Q:QT="^"  W:MM'=M ! ;P32
"RTN","FHORD6",22,0)
 .  Q
"RTN","FHORD6",23,0)
 W ! K L,N,M,M1,M2
"RTN","FHORD6",24,0)
 G:QT="^" KIL ;P32
"RTN","FHORD6",25,0)
A0 S X(0)=^FHPT(FHDFN,"A",ADM,0),X=$P(X(0),"^",10) G:X="" F1
"RTN","FHORD6",26,0)
 D:$Y>(IOSL-3) HDR G:QT="^" KIL W !!,"Isolation/Precaution Type is ",$P($G(^FH(119.4,X,0)),"^",1)
"RTN","FHORD6",27,0)
F1 D CUR^FHORD7 D:$Y>(IOSL-6) HDR G:QT="^" KIL W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHORD6",28,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) S COM=^(1) W:COM'="" !,"Comment: ",COM
"RTN","FHORD6",29,0)
 S TYP=$P(X,"^",8) I TYP'="" W !,"Service: ",$S(TYP="T":"Tray",TYP="D":"Dining Room",1:"Cafeteria")
"RTN","FHORD6",30,0)
 S DTP=$P(X(0),"^",3) I DTP D DTP^FH W !,"Expires: ",DTP
"RTN","FHORD6",31,0)
 S TF=$P(X(0),"^",4) G:TF<1 F2
"RTN","FHORD6",32,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHORD6",33,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHORD6",34,0)
 D DTP^FH W !!,"Tubefeed Ordered: ",DTP
"RTN","FHORD6",35,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHORD6",36,0)
 W !,"Total Quantity: ",TQU," ml",?42,"Total KCAL: ",CAL
"RTN","FHORD6",37,0)
 W:COM'="" !,"Comment: ",COM
"RTN","FHORD6",38,0)
F2 S NO=$P(X(0),"^",7),Y=$S('NO:"",1:^FHPT(FHDFN,"A",ADM,"SF",NO,0)) D:$Y>(IOSL-3) HDR G:QT="^" KIL
"RTN","FHORD6",39,0)
 S L=$P(Y,"^",4) W !!,"Supplemental Feeding: ",$S('L:"No Order",1:$P(^FH(118.1,L,0),"^",1)) G:'NO F3
"RTN","FHORD6",40,0)
 S DTP=$P(Y,"^",30) D DTP^FH W ?50,"Reviewed: ",DTP
"RTN","FHORD6",41,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$P(^FH(118,Z,0),"^",1)
"RTN","FHORD6",42,0)
 D:$Y>(IOSL-4) HDR G:QT="^" KIL F K1=1:1:3 I N(K1)'="" W !?5,$P("10am; 2pm; 8pm",";",K1),":",?13,N(K1)
"RTN","FHORD6",43,0)
F3 G ^FHORD61
"RTN","FHORD6",44,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHORD6",45,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORD6",46,0)
 W !,"Product: ",$P($G(^FH(118.2,TUN,0)),"^",1),", ",$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")," Str., ",QUA Q
"RTN","FHORD6",47,0)
SP S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHORD6",48,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHORD6",49,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHORD6",50,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHORD6",51,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHORD6",52,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHORD6",53,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHORD6",54,0)
 Q
"RTN","FHORD6",55,0)
W0 I X1'="" W ?12 S X=X1 D W1 S X1=X
"RTN","FHORD6",56,0)
 I X2'="" W ?46 S X=X2 D W1 S X2=X
"RTN","FHORD6",57,0)
 Q:X1=""&(X2="")  D:$Y'<(IOSL-2) HDR Q:QT="^"  W ! G W0 ;P32
"RTN","FHORD6",58,0)
W1 I $L(X)<34 W X S X="" Q
"RTN","FHORD6",59,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHORD6",60,0)
 W $E(X,1,KK-2) S X=$E(X,KK+1,999) Q
"RTN","FHORD6",61,0)
PAUSE ; Pause For Scroll
"RTN","FHORD6",62,0)
 I $E(IOST,1,2)="C-",PG R !!,"Press return to continue  ",YN:DTIME S:'$T!(YN["^") QT="^" Q:QT="^"  I "^"'[YN W !,"Enter a RETURN to Continue." G PAUSE
"RTN","FHORD6",63,0)
 Q
"RTN","FHORD6",64,0)
HDR ; Print Header
"RTN","FHORD6",65,0)
 D PAUSE Q:QT="^"
"RTN","FHORD6",66,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORD6",67,0)
 W !,PID,?16,$P(Y(0),"^",1),?48,SEX," Age ",AGE,?(79-$L(RM)),RM Q
"RTN","FHORD6",68,0)
KIL ; Final variable kill
"RTN","FHORD6",69,0)
 K %,%H,%I,%T,%ZIS,A1,ADM,AGE,ALG,ALL,BAG,C,CAL,COM,CON,CT,D3,DA,DAS,FHDU,FHDFN,DFN,DOB,DTP,FHOR,FHLD,I,IOP,K,K1,K2,KK,L,L1,LST,MEAL,N,NO,NOW,FHORD,FHWF,FHPV
"RTN","FHORD6",70,0)
 K POP,Q,QUA,QT,QTY,RM,SEX,PID,BID,STR,TYP,TF,TF2,TIM,TQU,TUN,WARD,X,X1,X2,XY,Y,YN,Z,Z1 Q
"RTN","FHORD61")
0^4^B13439670
"RTN","FHORD61",1,0)
FHORD61 ; HISC/REL/NCA - Diet Inquiry (cont) ;3/13/01  15:08
"RTN","FHORD61",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHORD61",3,0)
 S X1=NOW,X2=-1 D C^%DTC S LST=X,CT=0
"RTN","FHORD61",4,0)
 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"OO",K)) Q:K<1  S X=^(K,0) I $P(X,"^",2)'<LST!($P(X,"^",5)="S"),$P(X,"^",5)'="X" D L1 Q:QT="^"
"RTN","FHORD61",5,0)
 G:QT="^" KIL^FHORD6
"RTN","FHORD61",6,0)
 W ! S CT=0 F KK=NOW:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1  S FHORD=$P(^(KK,0),"^",2) D T1 Q:QT="^"
"RTN","FHORD61",7,0)
 G:QT="^" KIL^FHORD6
"RTN","FHORD61",8,0)
 D:$Y>(IOSL-2) HDR^FHORD6 G:QT="^" KIL^FHORD6 I 'CT W !,"No future Diet Orders exist"
"RTN","FHORD61",9,0)
F4 W ! S CT=0 F K=NOW:0 S K=$O(^FHPT(FHDFN,"A",ADM,"EL",K)) Q:K<1  S CT=CT+1,Y=^(K,0) D EL Q:QT="^"
"RTN","FHORD61",10,0)
 G:QT="^" KIL^FHORD6
"RTN","FHORD61",11,0)
 D:$Y>(IOSL-2) HDR^FHORD6 G:QT="^" KIL^FHORD6 I 'CT W !,"No future Early or Late Trays ordered"
"RTN","FHORD61",12,0)
 K N F K=0:0 S K=$O(^FHPT("ASP",FHDFN,ADM,K)) Q:K<1  S X=^FHPT(FHDFN,"A",ADM,"SP",K,0),M=$P(X,"^",3),M=$S(M="BNE":"A",1:$E(M,1)),N(M,K)=$P(X,"^",2,3),$P(N(M,K),"^",3)=$P(X,"^",8)
"RTN","FHORD61",13,0)
 D:$Y>(IOSL-4) HDR^FHORD6 G:QT="^" KIL^FHORD6 I $O(N(""))="" W !!,"No Active Standing Orders" G F5
"RTN","FHORD61",14,0)
 W !!,"Active Standing Orders:",!
"RTN","FHORD61",15,0)
 F M="A","B","N","E" F K=0:0 S K=$O(N(M,K)) Q:K<1  S Z=+N(M,K) I Z D:$Y>(IOSL-2) HDR^FHORD6 Q:QT="^"  D SP S QTY=$P(N(M,K),"^",3) W !?5,M2,?18,$S(QTY:QTY,1:1)," ",$P(^FH(118.3,Z,0),"^",1)
"RTN","FHORD61",16,0)
 G:QT="^" KIL^FHORD6
"RTN","FHORD61",17,0)
 K L,N,M,M1,M2
"RTN","FHORD61",18,0)
F5 S CT=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"DR",K)) Q:K<1  D:$Y>(IOSL-5) HDR^FHORD6 Q:QT="^"  D CD
"RTN","FHORD61",19,0)
 G:QT="^" KIL^FHORD6
"RTN","FHORD61",20,0)
 I 'CT D:$Y>(IOSL-4) HDR^FHORD6 G:QT="^" KIL^FHORD6 W !!,"No Active Consultations for this Admission"
"RTN","FHORD61",21,0)
F6 ;S CT=0 F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"MO","AC",KK)) Q:KK<1!(QT="^")  F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"MO","AC",KK,K)) Q:K<1  D:$Y>(IOSL-5) HDR^FHORD6 Q:QT="^"  D MO
"RTN","FHORD61",22,0)
 S FHTTLM="",FHTTLM=$P($G(^FHPT(FHDFN,"A",ADM,"MO",0)),U,3)
"RTN","FHORD61",23,0)
 I FHTTLM="" W !!,"No Monitors on file" G KIL^FHORD6
"RTN","FHORD61",24,0)
 S FHMONS=$S(FHTTLM-FHNUM<0:0,1:FHTTLM-FHNUM)
"RTN","FHORD61",25,0)
 F NDT=FHMONS:0 S NDT=$O(^FHPT(FHDFN,"A",ADM,"MO",NDT)) Q:NDT<1!(QT="^")  S K=NDT D MO
"RTN","FHORD61",26,0)
 Q:QT="^"  I 'CT W !,"No Monitors on file."
"RTN","FHORD61",27,0)
 I 'CT D:$Y>(IOSL-4) HDR^FHORD6 G:QT="^" KIL^FHORD6 W !!,"No Monitors for this Admission"
"RTN","FHORD61",28,0)
 I $E(IOST,1,2)="C-" R !!,"Press return to continue  ",YN:DTIME
"RTN","FHORD61",29,0)
 W ! G KIL^FHORD6
"RTN","FHORD61",30,0)
SP S M1=$P(N(M,K),"^",2) I M1="BNE" S M2="All Meals" Q
"RTN","FHORD61",31,0)
 S L=$E(M1,1),M2=$S(L="B":"Break",L="N":"Noon",1:"Even")
"RTN","FHORD61",32,0)
 S L=$E(M1,2) Q:L=""  S M2=M2_","_$S(L="B":"Break",L="N":"Noon",1:"Even") Q
"RTN","FHORD61",33,0)
EL S MEAL=$P(Y,"^",2),TIM=$P(Y,"^",3),BAG=$P(Y,"^",4),DTP=K\1 D DTP^FH
"RTN","FHORD61",34,0)
 D:$Y>(IOSL-2) HDR^FHORD6 Q:QT="^"  W !,"Early/Late Meal: ",DTP,?29,$J(TIM,10),"   ",$S(MEAL="B":"Breakfast",MEAL="N":"  Noon ",1:" Evening") W:BAG="Y" ?62,"Bagged Meal" Q
"RTN","FHORD61",35,0)
CD S Y=^FHPT(FHDFN,"A",ADM,"DR",K,0) Q:$P(Y,"^",8)'="A"  S CT=CT+1
"RTN","FHORD61",36,0)
 S CON=$P(Y,"^",2),DTP=$P(Y,"^",1),COM=$P(Y,"^",3)
"RTN","FHORD61",37,0)
 W !!,"Consult: ",$P($G(^FH(119.5,CON,0)),"^",1)
"RTN","FHORD61",38,0)
 W:COM'="" !,"Comment: ",COM
"RTN","FHORD61",39,0)
 D DTP^FH W !,"Ordered: ",DTP Q
"RTN","FHORD61",40,0)
L1 D:$Y>(IOSL-4) HDR^FHORD6 Q:QT="^"  I 'CT W !!,"Additional Orders Saved or Last 24 Hours:",! S CT=1
"RTN","FHORD61",41,0)
 S DTP=$P(X,"^",2) D DTP^FH W !,DTP,?20,$P(X,"^",3) Q
"RTN","FHORD61",42,0)
T1 Q:'$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0))  S DTP=KK D DTP^FH,C2^FHORD7
"RTN","FHORD61",43,0)
 D:$Y>(IOSL-3) HDR^FHORD6 Q:QT="^"  I 'CT W !,"Future Diet Orders:",!
"RTN","FHORD61",44,0)
 S CT=CT+1 W !?5,DTP,?25,Y Q
"RTN","FHORD61",45,0)
MO ; Display Monitors
"RTN","FHORD61",46,0)
 S Y=$G(^FHPT(FHDFN,"A",ADM,"MO",K,0)) Q:Y=""  S CT=CT+1
"RTN","FHORD61",47,0)
 D:$Y'<(IOSL-4) HDR^FHORD6 Q:QT="^"
"RTN","FHORD61",48,0)
 W !!,$P(Y,"^",1) S DTP=$P(Y,"^",2) D DTP^FH W ", ",DTP
"RTN","FHORD61",49,0)
 S COM=$P(Y,"^",3) W:COM'="" !?5,"Action: ",COM Q
"RTN","FHORD81")
0^53^B69864656
"RTN","FHORD81",1,0)
FHORD81 ; HISC/REL/NCA - Diet Order Lists (cont) ;11/30/00  13:55
"RTN","FHORD81",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHORD81",3,0)
 ;patch 5 - added outpatiet SOs & SFs and outpt room-bed.
"RTN","FHORD81",4,0)
 K C,^TMP("FH",$J) F L=0:0 S L=$O(^FH(118,L)) Q:L<1  I '$D(^FH(118,L,"I")) S C(L)=$P(^(0),"^",1)
"RTN","FHORD81",5,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,X1=DT,X2=-14 D C^%DTC S OLN=+X S X1=NOW,X2=-3 D C^%DTC S OLD=+X
"RTN","FHORD81",6,0)
 S X1=DT,X2=2 D C^%DTC S K3=+X
"RTN","FHORD81",7,0)
 F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0) D F0
"RTN","FHORD81",8,0)
 S (PG,REC)=0,NXW="" F  S NXW=$O(^TMP("FH",$J,NXW)) Q:NXW=""  F W1=0:0 S W1=$O(^TMP("FH",$J,NXW,W1)) Q:W1<1  D F2
"RTN","FHORD81",9,0)
 ;
"RTN","FHORD81",10,0)
OUTP ;Outpatient data
"RTN","FHORD81",11,0)
 D GETOUT^FHOMRBL1
"RTN","FHORD81",12,0)
 S (ADM,DTP,FHPTSA,RM,FHLSAV,FHI)=""
"RTN","FHORD81",13,0)
 I SRT="R" D RMS   ;sort by room-bed
"RTN","FHORD81",14,0)
 F  S FHI=$O(^TMP($J,"FH",FHI)) Q:FHI=""  D
"RTN","FHORD81",15,0)
 .S FHJ="" F  S FHJ=$O(^TMP($J,"FH",FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD81",16,0)
 ..S FHPTSA=FHJ
"RTN","FHORD81",17,0)
 ..F FHK=0:0 S FHK=$O(^TMP($J,"FH",FHI,FHJ,FHK)) Q:FHK'>0  D
"RTN","FHORD81",18,0)
 ...S FHDAT=""
"RTN","FHORD81",19,0)
 ...S FHL=$O(^TMP($J,"FH",FHI,FHJ,FHK,0))
"RTN","FHORD81",20,0)
 ...I $G(FHL) D REC Q
"RTN","FHORD81",21,0)
 ...D PROC
"RTN","FHORD81",22,0)
 W ! Q
"RTN","FHORD81",23,0)
 ;
"RTN","FHORD81",24,0)
RMS ;SORT BY ROOM-BED
"RTN","FHORD81",25,0)
 M ^TMP($J,"FHR")=^TMP($J,"FH") K ^TMP($J,"FH")
"RTN","FHORD81",26,0)
 F  S FHI=$O(^TMP($J,"FHR",FHI)) Q:FHI=""  D
"RTN","FHORD81",27,0)
 .S FHJ="" F  S FHJ=$O(^TMP($J,"FHR",FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD81",28,0)
 ..S FHPTSA=FHJ
"RTN","FHORD81",29,0)
 ..F FHK=0:0 S FHK=$O(^TMP($J,"FHR",FHI,FHJ,FHK)) Q:FHK'>0  D
"RTN","FHORD81",30,0)
 ...S FHDAT=""
"RTN","FHORD81",31,0)
 ...S FHL=$O(^TMP($J,"FHR",FHI,FHJ,FHK,0))
"RTN","FHORD81",32,0)
 ...I $G(FHL) D RM1 Q
"RTN","FHORD81",33,0)
 ...D RM2
"RTN","FHORD81",34,0)
 K ^TMP($J,"FHR")
"RTN","FHORD81",35,0)
 Q
"RTN","FHORD81",36,0)
RM1 F FHL=0:0 S FHL=$O(^TMP($J,"FHR",FHI,FHJ,FHK,FHL)) Q:FHL'>0  D
"RTN","FHORD81",37,0)
 .S FHDAT=^TMP($J,"FHR",FHI,FHJ,FHK,FHL)
"RTN","FHORD81",38,0)
 .S FHDFN=$P(FHDAT,U,2)
"RTN","FHORD81",39,0)
 .S RM=""
"RTN","FHORD81",40,0)
 .I $G(FHDFN),$D(^FHPT(FHDFN,"OP",FHL,0)) S RM=$P(^(0),U,18)
"RTN","FHORD81",41,0)
 .I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^(0),U,1)
"RTN","FHORD81",42,0)
 .S:RM'="" RM=$E(RM,1,12)
"RTN","FHORD81",43,0)
 .S:RM="" RM=" "
"RTN","FHORD81",44,0)
 .S ^TMP($J,"FH",FHI,RM,FHK,FHL)=FHDAT
"RTN","FHORD81",45,0)
 Q
"RTN","FHORD81",46,0)
RM2 S FHDAT=^TMP($J,"FHR",FHI,FHJ,FHK)
"RTN","FHORD81",47,0)
 S FHDFN=$P(FHDAT,U,2)
"RTN","FHORD81",48,0)
 S FHTYP=$P(FHDAT,U,1)
"RTN","FHORD81",49,0)
 S RM=""
"RTN","FHORD81",50,0)
 I $G(FHDFN),FHTYP="GM",$D(^FHPT(FHDFN,"GM",FHK,0)) S RM=$P(^(0),U,11)
"RTN","FHORD81",51,0)
 I $G(FHDFN),FHTYP="SM",$D(^FHPT(FHDFN,"SM",FHK,0)) S RM=$P(^(0),U,13)
"RTN","FHORD81",52,0)
 I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^(0),U,1)
"RTN","FHORD81",53,0)
 S:RM'="" RM=$E(RM,1,12)
"RTN","FHORD81",54,0)
 S:RM="" RM=" "
"RTN","FHORD81",55,0)
 S ^TMP($J,"FH",FHI,RM,FHK)=FHDAT
"RTN","FHORD81",56,0)
 Q
"RTN","FHORD81",57,0)
 ;
"RTN","FHORD81",58,0)
PROC ;process/print
"RTN","FHORD81",59,0)
 S FHPLD=0
"RTN","FHORD81",60,0)
 S:FHDAT="" FHDAT=^TMP($J,"FH",FHI,FHJ,FHK)
"RTN","FHORD81",61,0)
 S FHCAT=$P(FHDAT,U,1)
"RTN","FHORD81",62,0)
 S FHDFN=$P(FHDAT,U,2)
"RTN","FHORD81",63,0)
 S FHDIE=$P(FHDAT,U,3)
"RTN","FHORD81",64,0)
 S FHSTA=$P(FHDAT,U,4)
"RTN","FHORD81",65,0)
 S FHMEAL=$P(FHDAT,U,5)
"RTN","FHORD81",66,0)
 S FHLOC=$P(FHDAT,U,6)
"RTN","FHORD81",67,0)
 S FHDAIN=$P(FHDAT,U,7)
"RTN","FHORD81",68,0)
 S (FHSERT,FHSERC,FHSERD,FHSER)=""
"RTN","FHORD81",69,0)
 I $G(FHLOC),$D(^FH(119.6,FHLOC,0)) D
"RTN","FHORD81",70,0)
 .S:$P(^FH(119.6,FHLOC,0),U,5) FHSERT="T"
"RTN","FHORD81",71,0)
 .S:$P(^FH(119.6,FHLOC,0),U,6) FHSERC="C"
"RTN","FHORD81",72,0)
 .S:$P(^FH(119.6,FHLOC,0),U,7) FHSERD="D"
"RTN","FHORD81",73,0)
 .S FHSER=FHSERT_FHSERC_FHSERD
"RTN","FHORD81",74,0)
 I (FHXX="C"),(WRD>0),(WRD'=FHSTA) Q
"RTN","FHORD81",75,0)
 I (FHXX="L"),(WRD>0),(WRD'=FHLOC) Q
"RTN","FHORD81",76,0)
 I (SER'="A"),(FHSER'[SER) Q
"RTN","FHORD81",77,0)
 I FHI'=FHLSAV S FHLSAV=FHI,WRDN=$E(FHI,3,$L(FHI)) D HDR
"RTN","FHORD81",78,0)
 S FHDIET=""
"RTN","FHORD81",79,0)
 D PATNAME^FHOMUTL
"RTN","FHORD81",80,0)
 S RM=""
"RTN","FHORD81",81,0)
 I FHCAT="OP",$D(^FHPT(FHDFN,"OP",FHDAIN,0)) S RM=$P(^(0),U,18)
"RTN","FHORD81",82,0)
 I FHCAT="GM",$D(^FHPT(FHDFN,"GM",FHDAIN,0)) S RM=$P(^(0),U,11)
"RTN","FHORD81",83,0)
 I FHCAT="SM",$D(^FHPT(FHDFN,"SM",FHDAIN,0)) S RM=$P(^(0),U,13)
"RTN","FHORD81",84,0)
 I $G(RM),$D(^DG(405.4,RM,0)) S RM=$P(^DG(405.4,RM,0),U,1)
"RTN","FHORD81",85,0)
 I FHLSAV'=FHI S FHLSAV=FHI D HDR
"RTN","FHORD81",86,0)
 W !!,$E(RM,1,12),?13,$E(FHPTNM,1,24),?38,FHBID,?67,FHSER
"RTN","FHORD81",87,0)
 I $Y>(IOSL-6) D HDR
"RTN","FHORD81",88,0)
 I $D(^FH(111,FHDIE,0)) S FHDIET=$P(^FH(111,FHDIE,0),U,7)
"RTN","FHORD81",89,0)
 S FHTYP=$S(FHCAT="OP":"Recurring",FHCAT="GM":"Guest",FHCAT="SM":"Special",1:"")
"RTN","FHORD81",90,0)
 S DTP=FHK D DTP^FH
"RTN","FHORD81",91,0)
 W !,?14,"Diet Order: ",FHDIET,?40,"Meal: ","(",FHMEAL,")"
"RTN","FHORD81",92,0)
 W !,?14,"Service Type: ",FHTYP,?40,"Date: ",DTP
"RTN","FHORD81",93,0)
 ;S FHDAIN=$O(^FHPT(FHDFN,""_FHCAT_"","B",FHK,0))
"RTN","FHORD81",94,0)
 I $G(FHDAIN),$D(^FHPT(FHDFN,""_FHCAT_"",FHDAIN,"TF")) D OUTF
"RTN","FHORD81",95,0)
 I $G(FHDAIN),FHCAT="OP",$D(^FHPT(FHDFN,"OP",FHDAIN,"SP")) D OSO
"RTN","FHORD81",96,0)
 I $G(FHDAIN),FHCAT="OP",$D(^FHPT(FHDFN,"OP",FHDAIN,"SF")) D OSF
"RTN","FHORD81",97,0)
 S FHPLD=1
"RTN","FHORD81",98,0)
 D:'$G(FHL) ^FHORD83
"RTN","FHORD81",99,0)
 Q
"RTN","FHORD81",100,0)
 ;
"RTN","FHORD81",101,0)
OSO ;process outpt SOs.
"RTN","FHORD81",102,0)
 ;
"RTN","FHORD81",103,0)
 K N F K=0:0 S K=$O(^FHPT(FHDFN,"OP",FHDAIN,"SP",K)) Q:K'>0  S X=^(K,0) Q:$P(X,"^",6)  D
"RTN","FHORD81",104,0)
 .S M=$P(X,"^",3),N(M,K)=$P(X,"^",2,4),$P(N(M,K),"^",4,5)=$P(X,"^",8,9)
"RTN","FHORD81",105,0)
 F M="B","N","E" F K=0:0 S K=$O(N(M,K)) Q:K<1  S Z=+N(M,K) I Z D
"RTN","FHORD81",106,0)
 .I ($Y>(IOSL-6)) D HDR,FLNE^FHORD82
"RTN","FHORD81",107,0)
 .S M2=$S(M="B":"Break",M="N":"Noon",1:"Even") S QTY=$P(N(M,K),"^",4)
"RTN","FHORD81",108,0)
 .W !?13,"Stng. Order: ",M2,?38,$S(QTY:QTY,1:1)," ",$P($G(^FH(118.3,Z,0)),"^",1),$S($P(N(M,K),"^",5)'="Y":" (I)",1:"")
"RTN","FHORD81",109,0)
 .S X=$P(N(M,K),"^",3) D DT W ?72,X Q
"RTN","FHORD81",110,0)
 Q
"RTN","FHORD81",111,0)
 ;
"RTN","FHORD81",112,0)
OSF ;process outpt SFs.
"RTN","FHORD81",113,0)
 S NM=$P($G(^FHPT(FHDFN,"OP",FHDAIN,"SF",0)),U,3) Q:'$G(NM)
"RTN","FHORD81",114,0)
 K L,N,M,M1,M2 Q:'NM  S Y=^FHPT(FHDFN,"OP",FHDAIN,"SF",NM,0) Q:$P(Y,"^",32)
"RTN","FHORD81",115,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$S($D(C(Z)):C(Z),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:" ")
"RTN","FHORD81",116,0)
 S LST=$P(Y,"^",30)\1,X=LST,P1=0 D DT S:LST<OLN X=X_"*"
"RTN","FHORD81",117,0)
 F K1=1:1:3 I N(K1)'="" W !?13,$P("10AM; 2PM; 8PM",";",K1),?19,$E(N(K1),1,52) I 'P1 S P1=1 W ?72,X
"RTN","FHORD81",118,0)
 Q
"RTN","FHORD81",119,0)
 ;
"RTN","FHORD81",120,0)
REC ;set/get recurring data
"RTN","FHORD81",121,0)
 F FHL=0:0 S FHL=$O(^TMP($J,"FH",FHI,FHJ,FHK,FHL)) Q:FHL'>0  D
"RTN","FHORD81",122,0)
 .S FHDAT=^TMP($J,"FH",FHI,FHJ,FHK,FHL)
"RTN","FHORD81",123,0)
 .D PROC
"RTN","FHORD81",124,0)
 D:$G(FHPLD) ^FHORD83
"RTN","FHORD81",125,0)
 Q
"RTN","FHORD81",126,0)
 ;
"RTN","FHORD81",127,0)
OUTF ;outpatient TF
"RTN","FHORD81",128,0)
 S REC=1
"RTN","FHORD81",129,0)
 S (FHTFPR,FHTFQU,FHTFST,FHTFCOM,FHTFTC,FHTFKD,FHTFCN)=""
"RTN","FHORD81",130,0)
 I $G(FHDAIN),$D(^FHPT(FHDFN,"OP",FHDAIN,3)) D
"RTN","FHORD81",131,0)
 .S FHRDAT3=$G(^FHPT(FHDFN,"OP",FHDAIN,3))
"RTN","FHORD81",132,0)
 .S FHTFCOM=$P(FHRDAT3,U,1)
"RTN","FHORD81",133,0)
 .S FHTFTC=$P(FHRDAT3,U,2)
"RTN","FHORD81",134,0)
 .S FHTFTKD=$P(FHRDAT3,U,3)
"RTN","FHORD81",135,0)
 .S FHTFCN=$P(FHRDAT3,U,5)
"RTN","FHORD81",136,0)
 .S:FHTFCN="C" FHTFCN="Cancelled"
"RTN","FHORD81",137,0)
 F FHTFDA=0:0 S FHTFDA=$O(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA)) Q:FHTFDA'>0  D
"RTN","FHORD81",138,0)
 .S FHTFDAT=$G(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA,0))
"RTN","FHORD81",139,0)
 .S FHTFPR=$P(FHTFDAT,U,1)
"RTN","FHORD81",140,0)
 .I $G(FHTFPR),$D(^FH(118.2,FHTFPR,0)) S FHTFPR=$P(^FH(118.2,FHTFPR,0),U,1)
"RTN","FHORD81",141,0)
 .S FHTFST=$P(FHTFDAT,U,2)
"RTN","FHORD81",142,0)
 .S:$G(FHTFST) FHTFST=$S(FHTFST=1:"1/4",FHTFST=2:"1/2",FHTFST=3:"3/4",FHTFST=4:"FULL",1:"")
"RTN","FHORD81",143,0)
 .S FHTFQU=$P(FHTFDAT,U,3)
"RTN","FHORD81",144,0)
 .S FHTFCC=$P(FHTFDAT,U,4)
"RTN","FHORD81",145,0)
 .;I FHAOT'="" S ZZ="  Additional Order: "_FHAOT_" "_FHAOCN_" By: "_FHAOC D LNE^FHORD82
"RTN","FHORD81",146,0)
 .;I FHELTT'="" S ZZ="  Early/Late Tray Time: "_FHELTT_"  Bag Meal: "_FHELTBM D LNE^FHOR82
"RTN","FHORD81",147,0)
 .I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",148,0)
 .W !,?5,"Tubefeed.:"
"RTN","FHORD81",149,0)
 .S ZZ=FHTFCOM_"  TF Total MLs: "_FHTFTC_"  TF Total KCALS/Day: "_FHTFTKD_" "_FHTFCN W ZZ
"RTN","FHORD81",150,0)
 .I FHTFPR'="" D
"RTN","FHORD81",151,0)
 ..I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",152,0)
 ..W !,?5
"RTN","FHORD81",153,0)
 ..S ZZ="TF Product: "_FHTFPR_"  TF Strength: "_FHTFST_"  TF Quantity: "_FHTFQU
"RTN","FHORD81",154,0)
 ..W ZZ
"RTN","FHORD81",155,0)
 ..I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",156,0)
 ..W !,?5
"RTN","FHORD81",157,0)
 ..S ZZ="TF Product ML/Day: "_FHTFCC_" "_FHTFCN
"RTN","FHORD81",158,0)
 ..W ZZ
"RTN","FHORD81",159,0)
 Q
"RTN","FHORD81",160,0)
F0 ;
"RTN","FHORD81",161,0)
 I $P(X,U,3)="O" Q
"RTN","FHORD81",162,0)
 I FHXX="C" S K1=$P(X,"^",8) I WRD,K1'=WRD Q
"RTN","FHORD81",163,0)
 I FHXX="L" S K1=$P(X,"^",1) I WRD,W1'=WRD Q
"RTN","FHORD81",164,0)
 S K1=$S(FHXX="W":"",K1<1:99,K1<10:"0"_K1,1:K1),P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD81",165,0)
 S WRDN=$P(^FH(119.6,W1,0),"^",1),^TMP("FH",$J,K1_P0_$E(WRDN,1,26),W1)="" Q
"RTN","FHORD81",166,0)
F2 S WRDN=$P(^FH(119.6,W1,0),"^",1)
"RTN","FHORD81",167,0)
 K ^TMP($J) F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  S ADM=^(FHDFN) D RM
"RTN","FHORD81",168,0)
 Q:'$D(^TMP($J))  S NX="" D HDR
"RTN","FHORD81",169,0)
L2 S NX=$O(^TMP($J,NX)) I NX="" W ! Q
"RTN","FHORD81",170,0)
 S FHDFN=""
"RTN","FHORD81",171,0)
L3 ; Get Next Patient data
"RTN","FHORD81",172,0)
 S FHDFN=$O(^TMP($J,NX,FHDFN)) G:FHDFN="" L2 S ADM=^(FHDFN)
"RTN","FHORD81",173,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORD81",174,0)
 G:ADM<1 L3 S Y(0)=^DPT(DFN,0) G:'$D(^DGPM(ADM,0)) L3
"RTN","FHORD81",175,0)
 G:'$D(^FHPT(FHDFN,"A",ADM,0)) L3 S LEN=0 D CUR^FHORD7 S MEAL=Y,X0=^FHPT(FHDFN,"A",ADM,0) S:$L(MEAL)>48 LEN=$L($E(MEAL,1,48),",")
"RTN","FHORD81",176,0)
 I SER'="A",$P(X0,"^",5)'=SER G L3
"RTN","FHORD81",177,0)
 D:$Y>(IOSL-6) HDR S DTP=$P(^DGPM(ADM,0),"^",1) D DTP^FH
"RTN","FHORD81",178,0)
 S RM=$S(SRT="R":NX,$D(^DPT(DFN,.101)):^(.101),1:"") D PID^FHDPA
"RTN","FHORD81",179,0)
 W !!,RM,?13,$E($P(Y(0),"^",1),1,24),?38,BID,?47,DTP
"RTN","FHORD81",180,0)
 S Y=$P(X0,"^",5) I Y'="" W ?67,Y
"RTN","FHORD81",181,0)
 D GET I Y'="" W !?13,"Nut. Status: ",Y S X=+X5 D DT W ?72,X
"RTN","FHORD81",182,0)
 D ALG^FHCLN I ALG'="" W !?13,"Allergies: " S ZZ=ALG D LNE^FHORD82
"RTN","FHORD81",183,0)
 I "NO ORDER"'[MEAL!'$P(X0,"^",4) W !?13,"Diet Order: ",$S(LEN:$P(MEAL,",",1,LEN-1)_",",1:MEAL)
"RTN","FHORD81",184,0)
 I  I FHORD S X=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",9) D DT W ?72,X D:FHLD'="" NPO W:LEN !?24,$P(MEAL,",",LEN,999) D COM
"RTN","FHORD81",185,0)
 G ^FHORD82
"RTN","FHORD81",186,0)
GET S Y="",X5=$O(^FHPT(FHDFN,"S",0)) Q:X5=""  S X5=^(X5,0)
"RTN","FHORD81",187,0)
 Q:$P(X5,"^",1)<$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",1)
"RTN","FHORD81",188,0)
 S Y=$P($G(^FH(115.4,+$P(X5,"^",2),0)),"^",2) Q
"RTN","FHORD81",189,0)
NPO S LST=0 F K1=0:0 S K1=$O(^FHPT(FHDFN,"A",ADM,"AC",K1)) Q:K1<1!(K1>NOW)  I $P(^(K1,0),"^",2)=FHORD S LST=K1
"RTN","FHORD81",190,0)
 W:LST<OLD "*" Q
"RTN","FHORD81",191,0)
COM ; List comment if any
"RTN","FHORD81",192,0)
 S COM=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) Q:COM=""  I $L(COM)<51 W !?16,COM Q
"RTN","FHORD81",193,0)
 F LEN=51:-1:1 Q:$E(COM,LEN)=" "
"RTN","FHORD81",194,0)
 W !?16,$E(COM,1,LEN-1) S COM=$E(COM,LEN+1,999)
"RTN","FHORD81",195,0)
 W:COM'="" !?19,COM Q
"RTN","FHORD81",196,0)
DT S X=$J(+$E(X,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(X,4,5)) Q
"RTN","FHORD81",197,0)
RM ;
"RTN","FHORD81",198,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORD81",199,0)
 I SRT="R" S RM=$G(^DPT(DFN,.101))
"RTN","FHORD81",200,0)
 E  S RM=$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHORD81",201,0)
 S:RM="" RM=" " S ^TMP($J,RM,FHDFN)=ADM Q
"RTN","FHORD81",202,0)
HDR ;W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1,DTP=NOW D DTP^FH
"RTN","FHORD81",203,0)
 W @IOF S PG=PG+1,DTP=NOW D DTP^FH
"RTN","FHORD81",204,0)
 W !,DTP,?(67-$L(WRDN)\2),WRDN," DIET ORDERS",?72,"Page ",PG
"RTN","FHORD81",205,0)
 I SER'="A" S X=$S(SER="T":"TRAY",SER="C":"CAFETERIA",1:"DINING ROOM")_" Service Only" W !!?(79-$L(X)\2),X
"RTN","FHORD81",206,0)
 W !!,"Room",?13,"Patient",?39,"ID#",?48,"Admission Date",?66,"Svc",?71,"Ord Date" Q
"RTN","FHORD9")
0^23^B40033221
"RTN","FHORD9",1,0)
FHORD9 ; HISC/REL/NCA/RVD - Diet Order Census ;7/1/94  14:24 
"RTN","FHORD9",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHORD9",3,0)
 ;
"RTN","FHORD9",4,0)
 ;patch #5 - added screen for cancelled guest meals.
"RTN","FHORD9",5,0)
 ;
"RTN","FHORD9",6,0)
 D NOW^%DTC S DT=%\1 K %,^TMP($J)
"RTN","FHORD9",7,0)
 D DIV^FHOMUTL G:'$D(FHSITE) KIL
"RTN","FHORD9",8,0)
 S FHP=$O(^FH(119.71,0)) I FHP'<1,$O(^FH(119.71,FHP))<1 G F0
"RTN","FHORD9",9,0)
D0 R !!,"Select PRODUCTION FACILITY: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHORD9",10,0)
 K DIC S DIC="^FH(119.71,",DIC(0)="EMQ" D ^DIC G:Y<1 D0 S FHP=+Y
"RTN","FHORD9",11,0)
F0 R !!,"Effective Date/Time: ",X:DTIME G:'$T!("^"[X) KIL S %DT="ETSX" D ^%DT G:Y<1 F0 S TIM=Y
"RTN","FHORD9",12,0)
 I (TIM\1)<DT W *7,"  Cannot be before TODAY!" G F0
"RTN","FHORD9",13,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD9",14,0)
 I $D(IO("Q")) S FHPGM="Q1^FHORD9",FHLST="FHP^TIM^FHSITE^FHSITENM" D EN2^FH G KIL
"RTN","FHORD9",15,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHORD9",16,0)
Q1 ; Calculate census
"RTN","FHORD9",17,0)
 K ^TMP($J) S CT=0 D NOW^%DTC S NOW=% K %,D,P
"RTN","FHORD9",18,0)
 F WRD=0:0 S WRD=$O(^FH(119.6,WRD)) Q:WRD<1  S X=^(WRD,0) D
"RTN","FHORD9",19,0)
 .I '$G(FHSITE) D WRD
"RTN","FHORD9",20,0)
 .I ($G(FHSITE)),($P(X,U,8)=FHSITE) D WRD
"RTN","FHORD9",21,0)
 ;
"RTN","FHORD9",22,0)
 ;get outpatient data
"RTN","FHORD9",23,0)
 S:'$G(FHSITE) FHSITE=""
"RTN","FHORD9",24,0)
 S:'$D(FHSITENM) FHSITENM="CONSOLIDATED"
"RTN","FHORD9",25,0)
 D GETSM^FHOMRBLD(TIM,FHSITE,"","")
"RTN","FHORD9",26,0)
 D GETGM^FHOMRBL1(TIM,FHSITE,"","")
"RTN","FHORD9",27,0)
 S FHTIM=$P(TIM,".",1),FHTIM=FHTIM-.000001
"RTN","FHORD9",28,0)
 D GETRM^FHOMRBLD(FHTIM,FHSITE,"","")
"RTN","FHORD9",29,0)
 D PROSG   ;process recurring, special and guest meal from "OP" node
"RTN","FHORD9",30,0)
 G ^FHORD91
"RTN","FHORD9",31,0)
WRD ; Calculate census for ward
"RTN","FHORD9",32,0)
 K S S X1="" F D2=5,6 S N1=$P(X,"^",D2) Q:$G(^FH(119.72,+N1,"I"))="Y"  S N2=$P($G(^FH(119.72,+N1,0)),"^",3) I N2=FHP S S($E("TC",D2-4))=N1,D(N1)="",X1=X1_$E("TC",D2-4)
"RTN","FHORD9",33,0)
 Q:'$D(S)
"RTN","FHORD9",34,0)
 S:$L(X1)>1 X1=$E(X1,1) Q:'$D(S(X1))  S SP=S(X1)
"RTN","FHORD9",35,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",WRD,FHDFN)) Q:FHDFN<1  S ADM=$G(^FHPT("AW",WRD,FHDFN)) I ADM>0 S K=SP D W3
"RTN","FHORD9",36,0)
 Q
"RTN","FHORD9",37,0)
W3 Q:'$D(^FHPT(FHDFN,"A",ADM,0))
"RTN","FHORD9",38,0)
 S X0=^FHPT(FHDFN,"A",ADM,0)
"RTN","FHORD9",39,0)
 S FHORD=$P(X0,"^",2),X1=$P(X0,"^",3),TF=$P(X0,"^",4),N1=$P(X0,"^",5) S:N1="" N1="T"
"RTN","FHORD9",40,0)
 I FHORD<1 S A1=$O(^FHPT(FHDFN,"A",ADM,"AC",0)) G:A1=""!(A1>TIM) W4 D U1 G:'FHORD W4 S X1=""
"RTN","FHORD9",41,0)
 I X1>1,X1'>TIM D U1 G:'FHORD W4
"RTN","FHORD9",42,0)
 I '$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) D U1 G:'FHORD W4
"RTN","FHORD9",43,0)
 S X=^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7),X1=$P(X,"^",8)
"RTN","FHORD9",44,0)
 S:X1="" X1=N1 S:X1="D" X1="T" Q:'$D(S(X1))  S K=S(X1) D CNT
"RTN","FHORD9",45,0)
 I FHLD="" S Z=$P(X,"^",13) S:Z="" FHLD="X" I Z S:'$D(P(Z,K)) P(Z,K)=0 S P(Z,K)=P(Z,K)+1 Q
"RTN","FHORD9",46,0)
 I FHLD="P" S:'$D(P(.8,K)) P(.8,K)=0 S P(.8,K)=P(.8,K)+1 Q
"RTN","FHORD9",47,0)
 I FHLD="N" D  Q
"RTN","FHORD9",48,0)
 .I TF="" S:'$D(P(.5,K)) P(.5,K)=0 S P(.5,K)=P(.5,K)+1 Q
"RTN","FHORD9",49,0)
 .S:'$D(P(.7,K)) P(.7,K)=0 S P(.7,K)=P(.7,K)+1 Q
"RTN","FHORD9",50,0)
 Q:'TF  S:'$D(P(.7,K)) P(.7,K)=0 S P(.7,K)=P(.7,K)+1 Q
"RTN","FHORD9",51,0)
W4 G:'TF CNT S:'$D(P(.7,K)) P(.7,K)=0 S P(.7,K)=P(.7,K)+1
"RTN","FHORD9",52,0)
CNT S:'$D(P(.6,K)) P(.6,K)=0 S P(.6,K)=P(.6,K)+1 Q
"RTN","FHORD9",53,0)
U1 S (A1,FHORD)=0 F K1=0:0 S K1=$O(^FHPT(FHDFN,"A",ADM,"AC",K1)) Q:K1<1!(K1>TIM)  S A1=K1
"RTN","FHORD9",54,0)
 Q:'A1  S X1=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2) G U2:X1<1,U2:'$D(^FHPT(FHDFN,"A",ADM,"DI",X1,0)) S FHORD=X1 Q
"RTN","FHORD9",55,0)
U2 S X1="",A1=0
"RTN","FHORD9",56,0)
U3 S A1=$O(^FHPT(FHDFN,"A",ADM,"AC",A1)) G:A1="" U1 S X2=$P(^(A1,0),"^",2)
"RTN","FHORD9",57,0)
 I X2<1 K ^FHPT(FHDFN,"A",ADM,"AC",A1) G U3
"RTN","FHORD9",58,0)
 I '$D(^FHPT(FHDFN,"A",ADM,"DI",X2,0)) K ^FHPT(FHDFN,"A",ADM,"AC",A1) G U3
"RTN","FHORD9",59,0)
 G U3
"RTN","FHORD9",60,0)
PROSG ;process outpatient data from ^tmp($j global.
"RTN","FHORD9",61,0)
 S FHPLNM=""
"RTN","FHORD9",62,0)
 S:$G(FHSITE) FHPLNM=$P($G(^FH(119.73,FHSITE,0)),U,1)
"RTN","FHORD9",63,0)
REC ;for recurring meals
"RTN","FHORD9",64,0)
 S FHDT=TIM+.999999
"RTN","FHORD9",65,0)
 ;S FHTMPS=$NA(^TMP($J,"OP","R",FHPLNM))
"RTN","FHORD9",66,0)
 S FHTMPS="^TMP($J,""OP"",""R"")"
"RTN","FHORD9",67,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD9",68,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORD9",69,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHORD9",70,0)
 ..S (FHRDAT,FHIJKDAT)=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORD9",71,0)
 ..Q:$P(FHRDAT,U,19)="C"   ;quit if status is cancelled.
"RTN","FHORD9",72,0)
 ..S (FHPDIET,FHDIET,FHSER,FHLOC)="***"
"RTN","FHORD9",73,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORD9",74,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHORD9",75,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHORD9",76,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHORD9",77,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHORD9",78,0)
 ..I $G(FHSITE),$P($G(^FH(119.6,FHLOC,0)),U,8)'=FHSITE Q
"RTN","FHORD9",79,0)
 ..S FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHORD9",80,0)
 ..S FHREIEN=$P(FHIJKDAT,U,1)
"RTN","FHORD9",81,0)
 ..S FHDIETN=$P(FHIJKDAT,U,3)
"RTN","FHORD9",82,0)
 ..S:$D(^FH(111,"B",FHDIETN)) FHDIET=$O(^FH(111,"B",FHDIETN,0))
"RTN","FHORD9",83,0)
 ..S:$D(^FH(111,FHDIET,0)) FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHORD9",84,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHORD9",85,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHORD9",86,0)
 ..S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHORD9",87,0)
 ..;if tubefeeding, also count the TF data.
"RTN","FHORD9",88,0)
 ..I $D(^FHPT(FHREIEN,"OP",FHK,"TF")) D
"RTN","FHORD9",89,0)
 ...I '$D(P(.7,FHSER)) S P(.7,FHSER)=1
"RTN","FHORD9",90,0)
 ...E  S P(.7,FHSER)=P(.7,FHSER)+1
"RTN","FHORD9",91,0)
 ...S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHORD9",92,0)
 ;
"RTN","FHORD9",93,0)
SPEC ;for special meals
"RTN","FHORD9",94,0)
 S FHTMPS="^TMP($J,""OP"",""S"")" I '$D(FHPLNM) S FHPLNM=""
"RTN","FHORD9",95,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD9",96,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORD9",97,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHORD9",98,0)
 ..S (FHRDAT,FHIJKDAT)=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORD9",99,0)
 ..S (FHPDIET,FHDIET,FHSER,FHLOC)="***"
"RTN","FHORD9",100,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORD9",101,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHORD9",102,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHORD9",103,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHORD9",104,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHORD9",105,0)
 ..I $G(FHSITE),$P($G(^FH(119.6,FHLOC,0)),U,8)'=FHSITE Q
"RTN","FHORD9",106,0)
 ..S FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHORD9",107,0)
 ..S FHSTAT=$P(FHIJKDAT,U,3)
"RTN","FHORD9",108,0)
 ..Q:FHSTAT'="A"     ;quit if status is not Authorized
"RTN","FHORD9",109,0)
 ..S FHDIETN=$P(FHIJKDAT,U,4)
"RTN","FHORD9",110,0)
 ..S:$D(^FH(111,"B",FHDIETN)) FHDIET=$O(^FH(111,"B",FHDIETN,0))
"RTN","FHORD9",111,0)
 ..S:$D(^FH(111,FHDIET,0)) FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHORD9",112,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHORD9",113,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHORD9",114,0)
 ..S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHORD9",115,0)
 ;
"RTN","FHORD9",116,0)
GUEST ;for guest meals.
"RTN","FHORD9",117,0)
 ;If no diet, use default outpatient diet in file #119.9.
"RTN","FHORD9",118,0)
 ;S FHTMPS=$NA(^TMP($J,"OP","G",FHPLNM))
"RTN","FHORD9",119,0)
 S FHTMPS="^TMP($J,""OP"",""G"")" I '$D(FHPLNM) S FHPLNM=""
"RTN","FHORD9",120,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD9",121,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORD9",122,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHORD9",123,0)
 ..S (FHRDAT,FHIJKDAT)=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORD9",124,0)
 ..I $P(FHRDAT,U,7)="C" Q
"RTN","FHORD9",125,0)
 ..S (FHPDIET,FHDIET,FHSER,FHLOC)="***"
"RTN","FHORD9",126,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORD9",127,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHORD9",128,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHORD9",129,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHORD9",130,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHORD9",131,0)
 ..I $G(FHSITE),$P($G(^FH(119.6,FHLOC,0)),U,8)'=FHSITE Q
"RTN","FHORD9",132,0)
 ..S FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHORD9",133,0)
 ..S FHDIETN=$P(FHIJKDAT,U,6)
"RTN","FHORD9",134,0)
 ..S:$D(^FH(111,FHDIETN,0)) FHPDIET=$P(^FH(111,FHDIETN,0),U,5)
"RTN","FHORD9",135,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHORD9",136,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHORD9",137,0)
 ..S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHORD9",138,0)
 ;
"RTN","FHORD9",139,0)
 Q
"RTN","FHORD9",140,0)
 ;
"RTN","FHORD9",141,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHORD9",142,0)
 ;K %,%H,%I,%T,%DT,%ZIS,A1,ADM,CHK,CT,D,D1,D2,FHDFN,DFN,DIC,DOW,DTP,FHLD,FHOR,FHP,FHPAR,K,K1,KK,L1,LP,N,N1,N2,N3,NOW,NXW,FHORD,P,P1,POP,S,SP,TF,TIM,TOT,TYP,WRD,WRDN,X,X0,X1,X2,Y,Z K ^TMP($J) Q
"RTN","FHORE21")
0^62^B29651478
"RTN","FHORE21",1,0)
FHORE21 ; HISC/REL/NCA - List Early/Late Trays (cont) ;11/9/94  13:33 
"RTN","FHORE21",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHORE21",3,0)
 ;patch #5 - added outpt room-bed.
"RTN","FHORE21",4,0)
 S D1=DTE,COUNT=0,LINE=1 K ^TMP($J) S ANS=""
"RTN","FHORE21",5,0)
F2 S D1=$O(^FHPT("ADLT",D1)) G:D1<1!(D1\1'=DTE) P0 S FHDFN=0
"RTN","FHORE21",6,0)
F3 S FHDFN=$O(^FHPT("ADLT",D1,FHDFN)) G:FHDFN<1 F2 S ADM=0
"RTN","FHORE21",7,0)
F4 S ADM=$O(^FHPT("ADLT",D1,FHDFN,ADM)) G:ADM<1 F3
"RTN","FHORE21",8,0)
 I $S($D(^DGPM(ADM,0)):$P(^(0),"^",17),1:1) G F7
"RTN","FHORE21",9,0)
 S Y(0)=$G(^FHPT(FHDFN,"A",ADM,"EL",D1,0)) G:Y(0)="" F7
"RTN","FHORE21",10,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,0)),OLW=$P(X,"^",11),IS=$P(X,"^",10)
"RTN","FHORE21",11,0)
 S W1=$P(X,"^",8),X2=$G(^FH(119.6,+W1,0)),WARD=$P(X2,"^",1)
"RTN","FHORE21",12,0)
 G:WARD="" F4 S P0=$P(X2,"^",8) I FHP,P0'=FHP G F4
"RTN","FHORE21",13,0)
 S M1=$P(Y(0),"^",2) I MEAL'="A",M1'=MEAL G F4
"RTN","FHORE21",14,0)
 D CUR G:FHLD'="" F4 S O1=Y
"RTN","FHORE21",15,0)
 S ^TMP($J,"EL",D1_"-"_$P(Y(0),"^",6),FHDFN_"-"_ADM)=WARD_"^"_P0_"^"_OLW_"^"_IS_"^"_O1_"^"_$P(Y(0),"^",2,4) G F4
"RTN","FHORE21",16,0)
P0 D NOW^%DTC S DTP=% D DTP^FH S H1=DTP,DTP=DTE\1 D DTP^FH S L1=DTP
"RTN","FHORE21",17,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHORE21",18,0)
 S S1=LAB=2*5+36
"RTN","FHORE21",19,0)
P1 S M2="Z",PG=0 D:'LAB HDR
"RTN","FHORE21",20,0)
 S N1="" F  S N1=$O(^TMP($J,"EL",N1)) Q:N1=""!(ANS="^")  S N2="" F  S N2=$O(^TMP($J,"EL",N1,N2)) Q:N2=""  S Y=^(N2) D P2 Q:ANS="^"
"RTN","FHORE21",21,0)
 ;
"RTN","FHORE21",22,0)
 D ^FHOMELT  ;List Outpatient (Recurring Meals) Late Trays
"RTN","FHORE21",23,0)
 I LAB<1 W !!
"RTN","FHORE21",24,0)
 S FHPREV="" D:'LAB OPHDR
"RTN","FHORE21",25,0)
 F N1="B","N","E"  D
"RTN","FHORE21",26,0)
 .I '$D(^TMP($J,N1)) Q
"RTN","FHORE21",27,0)
 .S N2="" F  S N2=$O(^TMP($J,N1,N2)) Q:N2=""!(ANS="^")  D
"RTN","FHORE21",28,0)
 ..S FHDATA=$G(^TMP($J,N1,N2)),FHLOC=$P(FHDATA,U,1),FHDFN=$P(FHDATA,U,2)
"RTN","FHORE21",29,0)
 ..S FHBAG=$P(FHDATA,U,3),(O1,FHDIET)=$P(FHDATA,U,4),RM=$P(FHDATA,U,5) D PATNAME^FHOMUTL
"RTN","FHORE21",30,0)
 ..S (WARD,FHLOCNM)=$E($P($G(^FH(119.6,FHLOC,0)),U,1),1,10)
"RTN","FHORE21",31,0)
 ..S FHIP=$P($G(^FHPT(FHDFN,0)),U,5),FHIPD=""
"RTN","FHORE21",32,0)
 ..I FHIP'="" S (IS,FHIPD)=$P($G(^FH(119.4,FHIP,0)),U,2)_$P($G(^FH(119.4,FHIP,0)),U,3)
"RTN","FHORE21",33,0)
 ..S P1=FHPTNM,BID=FHBID,TIM=$P(N2,"~",1),M1=N1
"RTN","FHORE21",34,0)
 ..I LAB<1 D OUTP
"RTN","FHORE21",35,0)
 ..I LAB>0,LAB<3 D P3
"RTN","FHORE21",36,0)
 ..I LAB>2 D LL Q
"RTN","FHORE21",37,0)
 I LAB>2 D DPLL^FHLABEL K ^TMP($J) Q
"RTN","FHORE21",38,0)
 I LAB<3 F K=1:1:$S('LAB:1,1:18) W !
"RTN","FHORE21",39,0)
 Q
"RTN","FHORE21",40,0)
P2 S FHDFN=+N2,WARD=$P(Y,"^",1),P0=$P(Y,"^",2),OLW=$P(Y,"^",3),IS=$P(Y,"^",4),O1=$P(Y,"^",5),M1=$P(Y,"^",6),TIM=$P(Y,"^",7),BAG=$P(Y,"^",8)
"RTN","FHORE21",41,0)
 I IS S IS=^FH(119.4,IS,0),IS=$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORE21",42,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORE21",43,0)
 S Y=^DPT(DFN,0),P1=$P(Y,"^",1) D PID^FHDPA
"RTN","FHORE21",44,0)
 S RM=$G(^DPT(DFN,.101)) I LAB>2 D LL Q
"RTN","FHORE21",45,0)
 G:LAB P3
"RTN","FHORE21",46,0)
 I $Y>(IOSL-10) D HDR Q:ANS="^"  W !!?56,$S(M1="B":"Breakfast ",M1="N":"   Noon ",1:" Evening "),$J(TIM,6),! S M2=M1_TIM
"RTN","FHORE21",47,0)
 S X=M1_TIM I X'=M2 W !!?56,$S(M1="B":"Breakfast ",M1="N":"   Noon ",1:" Evening "),$J(TIM,6),! S M2=X
"RTN","FHORE21",48,0)
 W !,$S(WARD'="":$E(WARD,1,10),1:"")_$S(RM'="":"/"_$E(RM,1,10),1:""),?24,$E(P1,1,22),?50,BID,?61,$S(IS'="":IS,1:""),?67,$S(BAG="Y":"YES",1:""),?73,O1
"RTN","FHORE21",49,0)
 Q
"RTN","FHORE21",50,0)
P3 S P1=$E(P1,1,22),WARD=$E(WARD,1,15),RM=$E(RM,1,10)
"RTN","FHORE21",51,0)
 W !,$S(M1="B":"Breakfast",M1="N":"  Noon ",1:" Evening"),?10,TIM,?(S1-12),L1 W:LAB=2 !
"RTN","FHORE21",52,0)
 W !,$E(P1,1,S1-5-$L(WARD)),?(S1-3-$L(WARD)),WARD
"RTN","FHORE21",53,0)
 W !,BID W:IS'="" ?(S1-3\2),IS W ?(S1-3-$L(RM)),RM W:LAB=2 !
"RTN","FHORE21",54,0)
 I $L(O1)<S1 W !,O1,!!
"RTN","FHORE21",55,0)
 E  S L=$S($L($P(O1,",",1,3))<S1:3,1:2) W !,$P(O1,",",1,L),!,$E($P(O1,",",L+1,5),2,99),!
"RTN","FHORE21",56,0)
 W:LAB=2 ! Q
"RTN","FHORE21",57,0)
OUTP ;
"RTN","FHORE21",58,0)
 I $Y>(IOSL-10) D OPHDR Q:ANS="^"
"RTN","FHORE21",59,0)
 S NEW=N1_$P(N2,"~",1) I FHPREV'=NEW W !!?56,$S(N1="B":"Breakfast ",N1="N":"   Noon ",1:" Evening "),$J($P(N2,"~",1),6),!
"RTN","FHORE21",60,0)
 W !,FHLOCNM
"RTN","FHORE21",61,0)
 D PATNAME^FHOMUTL W "/"_RM,?24,FHPTNM,?50,FHBID
"RTN","FHORE21",62,0)
 W ?61,FHIPD,?67,$S(FHBAG="Y":"YES",1:"")
"RTN","FHORE21",63,0)
 W ?73,FHDIET
"RTN","FHORE21",64,0)
 S FHPREV=N1_$P(N2,"~",1)
"RTN","FHORE21",65,0)
 Q
"RTN","FHORE21",66,0)
F7 K ^FHPT("ADLT",D1,FHDFN,ADM) G F4
"RTN","FHORE21",67,0)
CUR S A1=0,(Y,FHLD,FHOR)="" F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1!(KK>D1)  S A1=KK
"RTN","FHORE21",68,0)
 Q:'A1  S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2),X=^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORE21",69,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORE21",70,0)
 S Y="" F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORE21",71,0)
 Q
"RTN","FHORE21",72,0)
DP K N S Y=$G(^FH(119.73,+P0,1))
"RTN","FHORE21",73,0)
 F KK=1,2,3,7,8,9,13,14,15 S X=$P(Y,"^",KK) I X'="" S N($S(KK<7:"B",KK<13:"N",1:"E"),X)=""
"RTN","FHORE21",74,0)
 Q
"RTN","FHORE21",75,0)
HDR ; Print Header (INPATIENT)
"RTN","FHORE21",76,0)
 I PG,IOST?1"C-".E R !!,"Press RETURN to continue or ""^"" to exit. ",ANS:DTIME S:'$T!(ANS["^") ANS="^" Q:ANS="^"  I "^"'[ANS W !,"Enter Return or ""^""." G HDR
"RTN","FHORE21",77,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORE21",78,0)
 W !?32,"I N P A T I E N T   E A R L Y / L A T E   T R A Y S",?110,H1
"RTN","FHORE21",79,0)
 W !,$S('FHP:"Consolidated",1:$P(^FH(119.73,FHP,0),"^",1)),?61,L1,?121,"Page ",PG
"RTN","FHORE21",80,0)
 W !!,"Ward/Room",?24,"Patient",?50,"ID#",?61,"Iso   Bag   Current-Diet",! Q
"RTN","FHORE21",81,0)
OPHDR ; Print Header (OUTPATIENT)
"RTN","FHORE21",82,0)
 I PG,IOST?1"C-".E R !!,"Press RETURN to continue or ""^"" to exit. ",ANS:DTIME S:'$T!(ANS["^") ANS="^" Q:ANS="^"  I "^"'[ANS W !,"Enter Return or ""^""." G OPHDR
"RTN","FHORE21",83,0)
 W:$E(IOST,1,2)="C-" @IOF S PG=PG+1
"RTN","FHORE21",84,0)
 W !?32,"O U T P A T I E N T   E A R L Y / L A T E   T R A Y S",?110,H1
"RTN","FHORE21",85,0)
 W !,$S('FHP:"Consolidated",1:$P(^FH(119.73,FHP,0),"^",1)),?61,L1,?121,"Page ",PG
"RTN","FHORE21",86,0)
 W !!,"Ward/Room",?24,"Patient",?50,"ID#",?61,"Iso   Bag   Current-Diet",! Q
"RTN","FHORE21",87,0)
LL ;
"RTN","FHORE21",88,0)
 S FHCOL=$S(LAB=3:3,1:2)
"RTN","FHORE21",89,0)
 I LABSTART>1 F FHLABST=1:1:(LABSTART-1)*FHCOL D  S LABSTART=1
"RTN","FHORE21",90,0)
 .I LAB=3 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6)="" D LL3^FHLABEL
"RTN","FHORE21",91,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6,PCL7,PCL8)="" D LL4^FHLABEL
"RTN","FHORE21",92,0)
 .Q
"RTN","FHORE21",93,0)
 S SL1=$S(LAB=3:25,1:38)
"RTN","FHORE21",94,0)
 S MEALTM=$S(M1="B":"Breakfast",M1="N":"Noon",1:"Evening")_"  "_TIM
"RTN","FHORE21",95,0)
 S BIDIS=BID_$E("        ",1,12-$L(BID))_IS
"RTN","FHORE21",96,0)
 S WARD=$E(WARD,1,15),WLN=$L(WARD),RM=$E(RM,1,10)
"RTN","FHORE21",97,0)
 I LAB=3 D
"RTN","FHORE21",98,0)
 .S P1=$E(P1,1,24-WLN)
"RTN","FHORE21",99,0)
 .S (PCL1,PCL6)="",PCL2=MEALTM_$J(L1,25-$L(MEALTM))
"RTN","FHORE21",100,0)
 .S PCL3=P1_$J(WARD,25-$L(P1)),PCL4=BIDIS_$J(RM,25-$L(BIDIS))
"RTN","FHORE21",101,0)
 .S PCL5=$E(O1,1,29) D LL3^FHLABEL
"RTN","FHORE21",102,0)
 I LAB=4 D
"RTN","FHORE21",103,0)
 .S P1=$E(P1,1,37-WLN)
"RTN","FHORE21",104,0)
 .S (PCL1,PCL2,PCL7,PCL8)="",PCL3=MEALTM_$J(L1,38-$L(MEALTM))
"RTN","FHORE21",105,0)
 .S PCL4=P1_$J(WARD,38-$L(P1)),PCL5=BIDIS_$J(RM,38-$L(BIDIS))
"RTN","FHORE21",106,0)
 .S PCL6=$E(O1,1,42) D LL4^FHLABEL
"RTN","FHORE21",107,0)
 Q
"RTN","FHORT3")
0^28^B5199954
"RTN","FHORT3",1,0)
FHORT3 ; HISC/REL/NCA - Tubefeeding Utilities ;8/9/96  11:41 ;
"RTN","FHORT3",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHORT3",3,0)
EN1 ; Edit Tubefeeding Products
"RTN","FHORT3",4,0)
 S CHK=0,TYP="T",EVENT="UPD",REC=1,(NOD1,NOD3)="" K ^TMP($J,"FHNOD2")
"RTN","FHORT3",5,0)
 W ! S (DIC,DIE)="^FH(118.2,",DIC(0)="AEQLM",DIC("DR")=".01",DLAYGO=118.2 W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN1:Y<1
"RTN","FHORT3",6,0)
 S DA=+Y,IEN=Y,NOD1=$P($G(^FH(118.2,+IEN,0)),"^",1),NOD3=$G(^FH(118.2,+IEN,"I"))
"RTN","FHORT3",7,0)
 F IEN1=0:0 S IEN1=$O(^FH(118.2,+IEN,1,IEN1)) Q:IEN1<1  S:'$D(^TMP($J,"FHNOD2",IEN1)) ^TMP($J,"FHNOD2",IEN1)=$G(^FH(118.2,+IEN,1,IEN1,0))
"RTN","FHORT3",8,0)
 ;DR STRING MODIFIED TO ONLY EDIT INACTIVE STATUS IF TF PRODUCT INACTIVE
"RTN","FHORT3",9,0)
 S DR="I $G(^FH(118.2,+IEN,""I""))=""Y"" S Y=99;.01;1;2;S:X[""G"" Y=""@1"";3;@1;10:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=118.2 D ^DIE K DA,DIE,DIDEL,DR I $D(^ORD(101.43)) D UPDATE^FHWOR6
"RTN","FHORT3",10,0)
 G EN1
"RTN","FHORT3",11,0)
EN2 ; List Tubefeeding Products
"RTN","FHORT3",12,0)
 W !!,"The list requires a 132 column printer.",!
"RTN","FHORT3",13,0)
 W ! S L=0,DIC="^FH(118.2,",FLDS="[FHTFLST]",BY="NAME"
"RTN","FHORT3",14,0)
 S FR="",TO="",DHD="TUBEFEEDING PRODUCTS" D EN1^DIP,RSET Q
"RTN","FHORT3",15,0)
RSET K %ZIS S IOP="" D ^%ZIS K %ZIS,IOP,BY,DA,DHD,DIC,DIE,DR,FLDS,FR,L,TO,X,Y Q
"RTN","FHORT3",16,0)
KIL K ^TMP($J),CHK,DIC,DIE,DTOUT,EVENT,IEN,IEN1,NOD1,NOD3,REC,TYP,X,Y Q
"RTN","FHORT3",17,0)
POST ; Generate bulletin
"RTN","FHORT3",18,0)
 S WRD=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",8)
"RTN","FHORT3",19,0)
 Q:'$D(^FH(119.6,+WRD,0))  S XMKK=$P(^(0),"^",2) Q:XMKK<1
"RTN","FHORT3",20,0)
 K XMY,XMB S XMB(1)=$P(^DPT(DFN,0),"^",1),XMB(2)=BID
"RTN","FHORT3",21,0)
 S XMB(4)=$S($D(^DPT(DFN,.101)):^(.101),1:"unknown")
"RTN","FHORT3",22,0)
 S XMB(5)="" I CAN S XMB(5)="Diet Orders"_$S(CAN=2:" and Supplemental Feedings",1:"")_" have been cancelled."
"RTN","FHORT3",23,0)
 S XMB(3)=$P(^FH(119.6,WRD,0),"^",1),XMB="FHDITF",XMY(XMKK)="" D ^XMB K XMY,XMB,XMM,XMDT Q
"RTN","FHORT5A")
0^61^B26922360
"RTN","FHORT5A",1,0)
FHORT5A ; HISC/REL/NCA/RVD - Tubefeeding Reports (cont) ;3/1/04  13:15
"RTN","FHORT5A",2,0)
 ;;5.5;DIETETICS;**1,3,5**;Jan 28, 2005;Build 53
"RTN","FHORT5A",3,0)
 ;
"RTN","FHORT5A",4,0)
Q1 ; Print Tubefeeding Report
"RTN","FHORT5A",5,0)
 S PG=0 D NOW^%DTC S (DTP,NOW)=% D DTP^FH K ^TMP($J)
"RTN","FHORT5A",6,0)
INPAT ;get inpatient data
"RTN","FHORT5A",7,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("ADTF",FHDFN)) Q:FHDFN<1  F ADM=0:0 S ADM=$O(^FHPT("ADTF",FHDFN,ADM)) Q:ADM<1  D PATNAME^FHOMUTL Q:DFN=""  D Q2
"RTN","FHORT5A",8,0)
 ;
"RTN","FHORT5A",9,0)
OUTPAT ;get outpatient data, for today's date.
"RTN","FHORT5A",10,0)
 F FHDFN=0:0  S FHDFN=$O(^FHPT("RM",DT,FHDFN)) Q:FHDFN'>0  F FHFIN=0:0 S FHFIN=$O(^FHPT("RM",DT,FHDFN,FHFIN)) Q:FHFIN'>0  D
"RTN","FHORT5A",11,0)
 .;quit if TF is cancelled
"RTN","FHORT5A",12,0)
 .I $D(^FHPT(FHDFN,"OP",FHFIN,3)),$P(^(3),U,5)="C" Q
"RTN","FHORT5A",13,0)
 .S (FHRMB,RM)=" "
"RTN","FHORT5A",14,0)
 .I $D(^FHPT(FHDFN,"OP",FHFIN,0)) S FHRMB=$P($G(^FHPT(FHDFN,"OP",FHFIN,0)),U,18)
"RTN","FHORT5A",15,0)
 .I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S RM=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHORT5A",16,0)
 .F FHTF=0:0 S FHTF=$O(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF)) Q:FHTF'>0  D
"RTN","FHORT5A",17,0)
 ..Q:'$D(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF,0))
"RTN","FHORT5A",18,0)
 ..S YY=$G(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF,0))
"RTN","FHORT5A",19,0)
 ..;
"RTN","FHORT5A",20,0)
 ..S TF2=FHTF
"RTN","FHORT5A",21,0)
 ..S Z=$G(^FHPT(FHDFN,"OP",FHFIN,0))
"RTN","FHORT5A",22,0)
 ..S XY=$G(^FHPT(FHDFN,"OP",FHFIN,3))
"RTN","FHORT5A",23,0)
 ..S (Z1,Z2)="",W1=$P(Z,"^",3)
"RTN","FHORT5A",24,0)
 ..S P0=$G(^FH(119.6,+W1,0)),Z3=$P(P0,"^",8),WARD=$E($P(P0,"^",1),U,12)
"RTN","FHORT5A",25,0)
 ..S CC=$P($G(^FH(119.73,+Z3,0)),"^",1)
"RTN","FHORT5A",26,0)
 ..I FHXX="C" S D2=$P(P0,"^",8) I FHP,FHP'=D2 Q
"RTN","FHORT5A",27,0)
 ..I FHXX="L" I FHP,FHP'=W1 Q
"RTN","FHORT5A",28,0)
 ..S P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORT5A",29,0)
 ..S TNOD=$S(FHXX="C":"99~"_CC,1:P0_"~"_WARD),CNOD=$S('SUM:TNOD,1:"0")
"RTN","FHORT5A",30,0)
 ..;
"RTN","FHORT5A",31,0)
 ..I FHOPT=3 D
"RTN","FHORT5A",32,0)
 ...S CTR=$G(^TMP($J,"C",CNOD,0))
"RTN","FHORT5A",33,0)
 ...;I "^^^^"[FHOR S:Z2 $P(CTR,"^",1)=$P(CTR,"^",1)+1 S:Z2 $P(CTR,"^",3)=$P(CTR,"^",3)+1
"RTN","FHORT5A",34,0)
 ...S $P(CTR,"^",1)=$P(CTR,"^",1)+1
"RTN","FHORT5A",35,0)
 ...;I "^^^^"'[FHOR,Z1="T" S:'Z2 $P(CTR,"^",2)=$P(CTR,"^",2)+1 S:Z2 $P(CTR,"^",4)=$P(CTR,"^",4)+1
"RTN","FHORT5A",36,0)
 ...S ^TMP($J,"C",CNOD,0)=CTR Q
"RTN","FHORT5A",37,0)
 ..;
"RTN","FHORT5A",38,0)
 ..S TP=$P(YY,"^",4) D PREP
"RTN","FHORT5A",39,0)
 ..;set ^tmp global for specific report.
"RTN","FHORT5A",40,0)
 ..D PATNAME^FHOMUTL
"RTN","FHORT5A",41,0)
 ..S PNOD=P0_"~"_WARD_"~"_FHDFN
"RTN","FHORT5A",42,0)
 ..I "135"[FHOPT S:'$D(^TMP($J,"C",CNOD,TUN,0)) ^(0)="" S $P(^(0),"^",1)=$P(^(0),"^",1)+TU,$P(^(0),"^",2)=$P(^(0),"^",2)+1
"RTN","FHORT5A",43,0)
 ..I "124"[FHOPT D
"RTN","FHORT5A",44,0)
 ...S:'$D(^TMP($J,"T",TNOD,PNOD,0)) ^(0)=$E(FHPTNM,1,22)_"^"_FHBID_"^"_WARD_"^"_RM_"^"_$P(XY,"^",1,3)
"RTN","FHORT5A",45,0)
 ...S ^TMP($J,"T",TNOD,PNOD,TF2,0)=$P(Y0,"^",1)_"^"_$P(Y0,"^",2)_"^"_TP_"^"_TW_"^"_TU_"^"_P1_"^"_STR_"^"_QUA_"^"_TUN
"RTN","FHORT5A",46,0)
 ;
"RTN","FHORT5A",47,0)
PRT ;prints corresponding reports.
"RTN","FHORT5A",48,0)
 I FHOPT=1 D PREP^FHORT5B,PULL^FHORT5C,DEL^FHORT5C Q
"RTN","FHORT5A",49,0)
 I FHOPT=2 D PREP^FHORT5B Q
"RTN","FHORT5A",50,0)
 I FHOPT=3 D CST^FHORT5D Q
"RTN","FHORT5A",51,0)
 I FHOPT=4 D LAB^FHORT5D Q
"RTN","FHORT5A",52,0)
 I FHOPT=5 D PULL^FHORT5C
"RTN","FHORT5A",53,0)
 Q
"RTN","FHORT5A",54,0)
Q2 S Z=$G(^FHPT(FHDFN,"A",ADM,0)),WARD=$P(Z,"^",8) S:WARD WARD=$P($G(^FH(119.6,WARD,0)),"^",1) I WARD="" G Q3
"RTN","FHORT5A",55,0)
 G:'$D(^DPT(DFN,.1)) Q3 S CADM=$G(^DPT("CN",^DPT(DFN,.1),DFN)) G:ADM'=CADM Q3
"RTN","FHORT5A",56,0)
 S TF=$P(Z,"^",4) G:TF<1 Q3
"RTN","FHORT5A",57,0)
 S Z1=$P(Z,"^",5),Z2=$P(Z,"^",7),W1=$P(Z,"^",8),P0=$G(^FH(119.6,+W1,0)),Z3=$P(P0,"^",8),CC=$P($G(^FH(119.73,+Z3,0)),"^",1)
"RTN","FHORT5A",58,0)
 I FHXX="C" S D2=$P(P0,"^",8) I FHP,FHP'=D2 Q
"RTN","FHORT5A",59,0)
 I FHXX="L" I FHP,FHP'=W1 Q
"RTN","FHORT5A",60,0)
 S P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORT5A",61,0)
 S TNOD=$S(FHXX="C":"99~"_CC,1:P0_"~"_WARD),CNOD=$S('SUM:TNOD,1:"0")
"RTN","FHORT5A",62,0)
 D CUR^FHORD7 I FHLD="P" Q
"RTN","FHORT5A",63,0)
 I FHOPT=3 D
"RTN","FHORT5A",64,0)
 .S CTR=$G(^TMP($J,"C",CNOD,0))
"RTN","FHORT5A",65,0)
 .I "^^^^"[FHOR S:'Z2 $P(CTR,"^",1)=$P(CTR,"^",1)+1 S:Z2 $P(CTR,"^",3)=$P(CTR,"^",3)+1
"RTN","FHORT5A",66,0)
 .I "^^^^"'[FHOR,Z1="T" S:'Z2 $P(CTR,"^",2)=$P(CTR,"^",2)+1 S:Z2 $P(CTR,"^",4)=$P(CTR,"^",4)+1
"RTN","FHORT5A",67,0)
 .S ^TMP($J,"C",CNOD,0)=CTR Q
"RTN","FHORT5A",68,0)
 I "124"[FHOPT D
"RTN","FHORT5A",69,0)
 .S RM=$G(^DPT(DFN,.101))
"RTN","FHORT5A",70,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHORT5A",71,0)
 .S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORT5A",72,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORT5A",73,0)
 .S PNOD=P0_"~"_R0_RM_"~"_DFN,X=^DPT(DFN,0) D PID^FHDPA
"RTN","FHORT5A",74,0)
 .S XY=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHORT5A",75,0)
 .S ^TMP($J,"T",TNOD,PNOD,0)=$E($P(X,"^",1),1,22)_"^"_BID_"^"_WARD_"^"_RM_"^"_$P(XY,"^",5,7) Q
"RTN","FHORT5A",76,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S YY=^(TF2,0) D LP
"RTN","FHORT5A",77,0)
 Q
"RTN","FHORT5A",78,0)
LP S TP=$P(YY,"^",4) D PREP
"RTN","FHORT5A",79,0)
 I "135"[FHOPT S:'$D(^TMP($J,"C",CNOD,TUN,0)) ^(0)="" S $P(^(0),"^",1)=$P(^(0),"^",1)+TU,$P(^(0),"^",2)=$P(^(0),"^",2)+1
"RTN","FHORT5A",80,0)
 I "124"[FHOPT S ^TMP($J,"T",TNOD,PNOD,TF2,0)=$P(Y0,"^",1)_"^"_$P(Y0,"^",2)_"^"_TP_"^"_TW_"^"_TU_"^"_P1_"^"_STR_"^"_QUA_"^"_TUN
"RTN","FHORT5A",81,0)
 Q
"RTN","FHORT5A",82,0)
Q3 K ^FHPT("ADTF",FHDFN,ADM)
"RTN","FHORT5A",83,0)
 I $D(^FHPT(FHDFN,"A",ADM,0)) S TF=$P(^(0),"^",4),$P(^(0),"^",4)="" I TF>0,$D(^FHPT(FHDFN,"A",ADM,"TF",TF,0)) S $P(^(0),"^",11)=NOW,ORIFN=$P(^(0),"^",14) I ORIFN S ORSTS=1 D ST^ORX
"RTN","FHORT5A",84,0)
 Q
"RTN","FHORT5A",85,0)
PREP ; Calculate Preparation
"RTN","FHORT5A",86,0)
 S TUN=$P(YY,"^",1),Y0=$G(^FH(118.2,TUN,0)) Q:Y0=""
"RTN","FHORT5A",87,0)
 S STR=$P(YY,"^",2),QUA=$P(YY,"^",3)
"RTN","FHORT5A",88,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORT5A",89,0)
 I $E($P(Y0,"^",3),$L($P(Y0,"^",3)))="G" D GRM Q
"RTN","FHORT5A",90,0)
 S TU=$P(YY,"^",4)/$S(+$P(Y0,"^",3):+$P(Y0,"^",3),1:9999),TW=$P(YY,"^",5)
"RTN","FHORT5A",91,0)
 ;I TW<6 S TP="",TW="",TU=TU+.75\1,P1=TU Q  ;NOIS MWV-0303-21626
"RTN","FHORT5A",92,0)
 I TW<6 S TP="",TW="",(TU,P1)=TU+.9999\1 Q
"RTN","FHORT5A",93,0)
 S TU=TU+.2*4\1/4,TP=$J(TP/10,0)*10,TW=$J(TW/10,0)*10
"RTN","FHORT5A",94,0)
 S P1=$S(TU<1:"",1:TU\1) I TU#1 S:P1 P1=P1_"-" S P2=TU#1,P1=P1_$S(P2<.3:"1/4",P2<.6:"1/2",1:"3/4")
"RTN","FHORT5A",95,0)
 Q
"RTN","FHORT5A",96,0)
GRM ; Calculate Gram
"RTN","FHORT5A",97,0)
 S TW=0,X=QUA D FIX^FHORT10 S Z5="" F L=1:1:$L(X) I $E(X,L)'=" " S Z5=Z5_$E(X,L)
"RTN","FHORT5A",98,0)
 S Z5=$P(Z5,"/",2),Z5=$P(Z5,"X",2)
"RTN","FHORT5A",99,0)
 I 'Z5 S Z5=$P("1,24,2,3,12,8,6,4",",",K) G G1
"RTN","FHORT5A",100,0)
 I Z5'["F" S Z5=$S(K=1:1,K=2:Z5,K=3:2,K=4:3,K=5:Z5\2,K=6:Z5\3,K=7:Z5\4,1:Z5\6)
"RTN","FHORT5A",101,0)
 E  S:K=1 Z5=1
"RTN","FHORT5A",102,0)
G1 S TU=+QUA*Z5
"RTN","FHORT5A",103,0)
 S TU=TU/$S(+$P(Y0,"^",3):+$P(Y0,"^",3),1:9999)
"RTN","FHORT5A",104,0)
 ;S P1=$S(TU<1:"",1:TU\1) I P1="" S TU=TU+.95\1,P1=TU
"RTN","FHORT5A",105,0)
 S P1=$S(TU<1:"",1:TU\1)
"RTN","FHORT5A",106,0)
 I P1="" S TU=TU+.999\1,P1=TU
"RTN","FHORT5A",107,0)
 E  S TU=TU+.999\1
"RTN","FHORT5A",108,0)
 I TU#1 S:P1 P1=P1_"-" S TU=TU#1,P1=P1_$S(TU<.3:"1/4",TU<.6:"1/2",1:"3/4")
"RTN","FHORT5A",109,0)
 Q
"RTN","FHORX1A")
0^60^B15045653
"RTN","FHORX1A",1,0)
FHORX1A ; HISC/REL/NCA/RVD - Diet Activity Report (cont) ;3/17/95  10:06
"RTN","FHORX1A",2,0)
 ;;5.5;DIETETICS;**1,5**;Jan 28, 2005;Build 53
"RTN","FHORX1A",3,0)
 ;
"RTN","FHORX1A",4,0)
 ;process inpatient data.
"RTN","FHORX1A",5,0)
 S PG=0 S FHPIO="** INPATIENT **" D HDR
"RTN","FHORX1A",6,0)
 S P0="",NN=0 F  S P0=$O(^TMP($J,"I",P0)) Q:P0=""  D LST
"RTN","FHORX1A",7,0)
 ;
"RTN","FHORX1A",8,0)
 ;process outpatient data.
"RTN","FHORX1A",9,0)
 S FHPIO="** OUTPATIENT **" D HDR
"RTN","FHORX1A",10,0)
 S (FHUSERNM,P0)="",(FHNMSV,NN)=0 F  S P0=$O(^TMP($J,"O",P0)) Q:P0=""  S (FHBRK,FHNON,FHEVE)=0 D LST1
"RTN","FHORX1A",11,0)
 S:$G(FHP) $P(^FH(119.73,FHP,0),"^",2)=NOW
"RTN","FHORX1A",12,0)
 I '$G(FHP) F FHII=0:0 S FHII=$O(^FH(119.73,FHII)) Q:FHII'>0  S $P(^FH(119.73,FHII,0),"^",2)=NOW
"RTN","FHORX1A",13,0)
 Q
"RTN","FHORX1A",14,0)
 ;
"RTN","FHORX1A",15,0)
LST K PP S NP=0 F DA=0:0 S DA=$O(^TMP($J,"I",P0,DA)) Q:DA<1  S Z=^(DA) D L1
"RTN","FHORX1A",16,0)
 D L2 Q
"RTN","FHORX1A",17,0)
 ;
"RTN","FHORX1A",18,0)
LST1 K PP S NP=0 F DA=0:0 S DA=$O(^TMP($J,"O",P0,DA)) Q:DA'>0  D T1
"RTN","FHORX1A",19,0)
 Q
"RTN","FHORX1A",20,0)
 ;
"RTN","FHORX1A",21,0)
L1 ; Process event
"RTN","FHORX1A",22,0)
 S ADM=$P(Z,"^",1),TYP=$P(Z,"^",2),ACT=$P(Z,"^",3),FHORD=$P(Z,"^",4),TXT=$P(Z,"^",5),CLK=$P(Z,"^",6)
"RTN","FHORX1A",23,0)
 I 'FHORD S NN=NN+1,FHORD=NN
"RTN","FHORX1A",24,0)
 I "DIT"[TYP D
"RTN","FHORX1A",25,0)
 .I TYP="D",FHORD=1 S NP=1
"RTN","FHORX1A",26,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1A",27,0)
 .K PP(TYP) S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK Q
"RTN","FHORX1A",28,0)
 I "OPSF"[TYP D
"RTN","FHORX1A",29,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1A",30,0)
 .S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK Q
"RTN","FHORX1A",31,0)
 I "LM"[TYP S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK
"RTN","FHORX1A",32,0)
 Q
"RTN","FHORX1A",33,0)
 ;
"RTN","FHORX1A",34,0)
L2 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),FHDFN=$P(P0,"~",5)
"RTN","FHORX1A",35,0)
 D PATNAME^FHOMUTL Q:'$G(DFN)
"RTN","FHORX1A",36,0)
 S Y0=$G(^DPT(DFN,0))
"RTN","FHORX1A",37,0)
 S N1=$P(Y0,"^",1)
"RTN","FHORX1A",38,0)
 ;D PID^FHDPA
"RTN","FHORX1A",39,0)
 S TC=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",5),SF=$P($G(^(0)),"^",7),SO=$D(^FHPT("ASP",FHDFN,ADM))
"RTN","FHORX1A",40,0)
 D:$Y>(IOSL-6) HDR W !!,$E(W1_" "_R1,1,20),?22,N1,?50,BID,?63,$S(SF:"SF",1:""),?66,$S(SO:"SO",1:""),?73,TC,!
"RTN","FHORX1A",41,0)
 D ^FHORX1C D:NP NEWP Q
"RTN","FHORX1A",42,0)
 ;
"RTN","FHORX1A",43,0)
T1 ; Process outpatient event
"RTN","FHORX1A",44,0)
 S FHTDAT=$G(^TMP($J,"O",P0,DA))
"RTN","FHORX1A",45,0)
 S FHACTI=$P(FHTDAT,"^",1)
"RTN","FHORX1A",46,0)
 S DTP=$P(FHTDAT,"^",2)
"RTN","FHORX1A",47,0)
 S BID=$P(FHTDAT,"^",3)
"RTN","FHORX1A",48,0)
 S FHDESC=$P(FHTDAT,"^",4)
"RTN","FHORX1A",49,0)
 S FHTC=$P(FHTDAT,"^",5)
"RTN","FHORX1A",50,0)
 ;I FHBRK=1,(FHDESC["Recurring Meal cancelled"),(FHDESC["Break") Q
"RTN","FHORX1A",51,0)
 ;I FHNON=1,(FHDESC["Recurring Meal cancelled"),(FHDESC["Noon") Q
"RTN","FHORX1A",52,0)
 ;I FHEVE=1,(FHDESC["Recurring Meal cancelled"),(FHDESC["Eve") Q
"RTN","FHORX1A",53,0)
 ;I (FHDESC["Recurring Meal cancelled"),(FHDESC["Break") S FHBRK=1
"RTN","FHORX1A",54,0)
 ;I (FHDESC["Recurring Meal cancelled"),(FHDESC["Noon") S FHNON=1
"RTN","FHORX1A",55,0)
 ;I (FHDESC["Recurring Meal cancelled"),(FHDESC["Eve") S FHEVE=1
"RTN","FHORX1A",56,0)
 S FHDES1=$P(FHDESC,",",1)
"RTN","FHORX1A",57,0)
 S FHDIET=$P(FHDES1,":",2),FHDIET=$E(FHDIET,2,$L(FHDIET))
"RTN","FHORX1A",58,0)
 I FHDIET'="",$D(^FH(111,"B",FHDIET)) S FHDIDA=$O(^FH(111,"B",FHDIET,0))
"RTN","FHORX1A",59,0)
 I $G(FHDIDA),$D(^FH(111,FHDIDA,0)) S FHDIET=$P(^FH(111,FHDIDA,0),U,7)
"RTN","FHORX1A",60,0)
 S:FHDIET="" FHDIET="NO ORDER"
"RTN","FHORX1A",61,0)
 S Y=FHDIET
"RTN","FHORX1A",62,0)
 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),(N1,FHDPTN)=$P(P0,"~",5)
"RTN","FHORX1A",63,0)
 ;T2
"RTN","FHORX1A",64,0)
 I $D(^FH(119.8,DA,0)) S FHUSER=$P(^(0),U,9) S:$G(FHUSER) FHUSERN=$P(^VA(200,FHUSER,0),U,1)
"RTN","FHORX1A",65,0)
 ;S EVT=FHDESC_" by "_FHUSERN
"RTN","FHORX1A",66,0)
 I FHDESC["Standing" S FHSO1=$P(FHDESC,":",1),FHDESC="Outpatient SO"_$E(FHDESC,$L(FHSO1)+1,$L(FHDESC))
"RTN","FHORX1A",67,0)
 I FHDESC["Supplemental" S FHSF1=$P(FHDESC,":",1),FHDESC="Outpatient SF"_$E(FHDESC,$L(FHSF1)+1,$L(FHDESC))
"RTN","FHORX1A",68,0)
 S EVT=FHDESC
"RTN","FHORX1A",69,0)
 I $Y>(IOSL-6) D HDR
"RTN","FHORX1A",70,0)
 I (FHNMSV=0)!(FHNMSV'=P0) W !!,$E(W1,1,20),?22,FHDPTN,?50,BID,?73,FHTC,!
"RTN","FHORX1A",71,0)
 S FHNMSV=P0
"RTN","FHORX1A",72,0)
 D LNE
"RTN","FHORX1A",73,0)
 Q
"RTN","FHORX1A",74,0)
 ;
"RTN","FHORX1A",75,0)
HDR ;W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1 W !?20,"D I E T   A C T I V I T Y   R E P O R T",?72,"Page ",PG
"RTN","FHORX1A",76,0)
 W @IOF S PG=PG+1 W !?20,"D I E T   A C T I V I T Y   R E P O R T",?72,"Page ",PG
"RTN","FHORX1A",77,0)
 W !!?(80-$L(H1)\2),H1
"RTN","FHORX1A",78,0)
 W !,?30,FHPIO
"RTN","FHORX1A",79,0)
 W !!,"Location",?22,"Patient",?50,"ID#",?62,"Sup/Std  Service"
"RTN","FHORX1A",80,0)
 Q
"RTN","FHORX1A",81,0)
 ;
"RTN","FHORX1A",82,0)
NEWP K ALG I $G(DFN) D ALG^FHCLN I ALG'="" S EVT="Allergies: "_ALG,TYP="A" D LNE^FHORX1C
"RTN","FHORX1A",83,0)
 Q:'$D(^FHPT(FHDFN,"P"))
"RTN","FHORX1A",84,0)
 S X1="Pref:" F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0) D N1
"RTN","FHORX1A",85,0)
 W:$L(X1)>6 !?12,X1 Q
"RTN","FHORX1A",86,0)
 ;
"RTN","FHORX1A",87,0)
N1 S Y=$G(^FH(115.2,+X,0)) Q:$P(Y,"^",2)'="D"
"RTN","FHORX1A",88,0)
 S Y=" "_$P(Y,"^",1)_" ("_$P(X,"^",2)_")"_$S($P(X,"^",4)="Y":" (D)",1:"") I $L(X1)+$L(Y)>48 W !?12,X1 S X1="Pref:"
"RTN","FHORX1A",89,0)
 S X1=X1_Y Q
"RTN","FHORX1A",90,0)
 ;
"RTN","FHORX1A",91,0)
LNE ; Break line if longer than 58 chars
"RTN","FHORX1A",92,0)
 I $Y>(IOSL-6) D HDR^FHORX1A W !
"RTN","FHORX1A",93,0)
 I $L(EVT)<59 G EX
"RTN","FHORX1A",94,0)
 F KK=59:-1:4 Q:$E(EVT,KK)?1P
"RTN","FHORX1A",95,0)
 I KK=4 S KK=45 W !?5,$E(EVT,1,58)
"RTN","FHORX1A",96,0)
 E  W !?5,$E(EVT,1,KK-1)
"RTN","FHORX1A",97,0)
 S EVT="    "_$E(EVT,KK+1,999) G LNE
"RTN","FHORX1A",98,0)
EX W !?5,EVT Q
"RTN","FHPRF1")
0^22^B45228454
"RTN","FHPRF1",1,0)
FHPRF1 ; HISC/REL/RVD - Calculate Total Forecast ;1/23/98  16:10
"RTN","FHPRF1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHPRF1",3,0)
 ;
"RTN","FHPRF1",4,0)
 ;patch #5 - added screen for cancelled quest meals.
"RTN","FHPRF1",5,0)
 ;
"RTN","FHPRF1",6,0)
 S %DT="X",X="T" D ^%DT S DT=+Y
"RTN","FHPRF1",7,0)
 D DIV^FHOMUTL G:'$D(FHSITE) KIL
"RTN","FHPRF1",8,0)
D1 R !!,"Forecast Date: ",X:DTIME G:'$T!("^"[X) KIL S %DT="EX" D ^%DT G KIL:"^"[X,D1:Y<1 S D1=+Y
"RTN","FHPRF1",9,0)
 S FHP=$O(^FH(119.71,0)) I FHP'<1,$O(^FH(119.71,FHP))<1 G R1
"RTN","FHPRF1",10,0)
R0 R !!,"Select PRODUCTION FACILITY: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHPRF1",11,0)
 K DIC S DIC="^FH(119.71,",DIC(0)="EMQ" D ^DIC G:Y<1 R0 S FHP=+Y
"RTN","FHPRF1",12,0)
R1 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHPRF1",13,0)
 I $D(IO("Q")) S FHPGM="Q1^FHPRF1",FHLST="D1^FHP^FHSITE^FHSITENM" D EN2^FH G KIL
"RTN","FHPRF1",14,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHPRF1",15,0)
Q1 ; Process Census Forecast
"RTN","FHPRF1",16,0)
 D Q2,Q3
"RTN","FHPRF1",17,0)
 ;get outpatient data
"RTN","FHPRF1",18,0)
 S FHD1SAV=D1
"RTN","FHPRF1",19,0)
 S:'$G(FHSITE) FHSITE=""
"RTN","FHPRF1",20,0)
 S:'$D(FHSITENM) FHSITENM="CONSOLIDATED"
"RTN","FHPRF1",21,0)
 D GETSM^FHOMRBLD(D1,FHSITE,"","")
"RTN","FHPRF1",22,0)
 D GETGM^FHOMRBL1(D1,FHSITE,"","")
"RTN","FHPRF1",23,0)
 S D1=D1-.000001
"RTN","FHPRF1",24,0)
 D GETRM^FHOMRBLD(D1,FHSITE,"","")
"RTN","FHPRF1",25,0)
 D PROSG   ;process recurring, special and guest meal from "OP" node
"RTN","FHPRF1",26,0)
 S D1=FHD1SAV
"RTN","FHPRF1",27,0)
 G ^FHPRF1A
"RTN","FHPRF1",28,0)
Q2 ; Calculate Service Point census forecast
"RTN","FHPRF1",29,0)
 S X="T",%DT="X" D ^%DT S DT=+Y
"RTN","FHPRF1",30,0)
 K ^TMP($J) S X=D1 D DOW^%DTC S DOW=Y+1 D BLD,DAT
"RTN","FHPRF1",31,0)
 F W1=0:0 S W1=$O(^TMP($J,"W",W1)) Q:W1<1  D WRD S ^TMP($J,"W",W1)=S1
"RTN","FHPRF1",32,0)
 K D,DC S X1=DT,X2=-1 D C^%DTC S D2=X
"RTN","FHPRF1",33,0)
 F P0=0:0 S P0=$O(^TMP($J,"S",P0)) Q:P0<1  D ADD S ^TMP($J,P0)=S1
"RTN","FHPRF1",34,0)
 Q
"RTN","FHPRF1",35,0)
Q3 F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1  S S1=^(P0) D PER S ^TMP($J,P0)=S0
"RTN","FHPRF1",36,0)
 F K=0:0 S K=$O(D(K)) Q:K<1  S ^TMP($J,0,K)=D(K)
"RTN","FHPRF1",37,0)
 K D,^TMP($J,"W"),^TMP($J,"S") Q
"RTN","FHPRF1",38,0)
WRD S (A,B,CT,S1,S2,S3,S4)=0 F K=1:1:9 S Y=$P($G(^DG(41.9,W1,"C",D(K),0)),"^",2) I Y S CT=CT+1,S0=10-K,S1=S1+S0,S2=S0*S0+S2,S3=S3+Y,S4=S0*Y+S4
"RTN","FHPRF1",39,0)
 G:'CT W1 I CT=1 S S1=S3 G W1
"RTN","FHPRF1",40,0)
 S S0=S1*S1/CT-S2,A=S1*S3/CT-S4/S0,B=S3/CT-(A*S1/CT)
"RTN","FHPRF1",41,0)
 S A=$J(A,0,3),B=$J(B,0,2),S1=10*A+B
"RTN","FHPRF1",42,0)
W1 S (N1,C2,C3)=0 F K=1:1:7 S Y0=$P($G(^DG(41.9,W1,"C",DC(K),0)),"^",2) I Y0 S N1=N1+1,C2=Y0-S1*(4-N1)+C2,C3=4-N1+C3 Q:N1=3
"RTN","FHPRF1",43,0)
 I N1 S C2=C2/C3,S1=S1+C2
"RTN","FHPRF1",44,0)
 S S1=$J(S1,0,0) Q
"RTN","FHPRF1",45,0)
ADD S (S1,CT)=0 F W1=0:0 S W1=$O(^TMP($J,"S",P0,W1)) Q:W1<1  S Z=^(W1),T0=$G(^TMP($J,"W",W1)),CT=CT+T0,S1=Z*T0/100+S1
"RTN","FHPRF1",46,0)
 S S1=$J(S1,0,0)
"RTN","FHPRF1",47,0)
 I '$D(^FH(119.72,P0,"C",D1,0)) S ^(0)=D1 I '$D(^FH(119.72,P0,"C",0)) S ^(0)="^119.722DA^^"
"RTN","FHPRF1",48,0)
 I D1'<DT S C2=$P(^FH(119.72,P0,"C",D1,0),"^",3),$P(^(0),"^",2,5)=CT_"^"_C2_"^"_S1_"^"_DT
"RTN","FHPRF1",49,0)
 Q:'$D(^FH(119.72,P0,"C",DT,0))  S C2=0
"RTN","FHPRF1",50,0)
 F W1=0:0 S W1=$O(^TMP($J,"S",P0,W1)) Q:W1<1  S C2=C2+$P($G(^DG(41.9,W1,"C",D2,0)),"^",2)
"RTN","FHPRF1",51,0)
 S:C2 $P(^FH(119.72,P0,"C",DT,0),"^",3)=C2 Q
"RTN","FHPRF1",52,0)
PER S S0=0 F K=0:0 S K=$O(^FH(119.72,P0,"A",K)) Q:K<1  S Z=$P($G(^(K,0)),"^",DOW+1),Z=$J(Z*S1/100,0,0) I Z S ^TMP($J,P0,K)=Z,S0=S0+Z,D(K)=$G(D(K))+Z
"RTN","FHPRF1",53,0)
 Q
"RTN","FHPRF1",54,0)
DAT ; Build list of dates
"RTN","FHPRF1",55,0)
 K D,DC S X1=D1,X2=-1 D C^%DTC S D2=X
"RTN","FHPRF1",56,0)
 F K=1:1:9 S X1=D2,X2=-7 D C^%DTC S D(K)=X,D2=X
"RTN","FHPRF1",57,0)
 S D2=D1 F K=1:1:7 S X1=D2,X2=-1 D C^%DTC S DC(K)=X,D2=X
"RTN","FHPRF1",58,0)
 Q
"RTN","FHPRF1",59,0)
BLD ; Build list of MAS wards and %'s for each Service Point
"RTN","FHPRF1",60,0)
 K ^TMP($J,"S"),^TMP($J,"W")
"RTN","FHPRF1",61,0)
 F P0=0:0 S P0=$O(^FH(119.72,P0)) Q:P0<1  S X=$G(^(P0,0)) I $P(X,"^",3)=FHP,$G(^FH(119.72,P0,"I"))'="Y" S ^TMP($J,"S",P0)=""
"RTN","FHPRF1",62,0)
 ;F K1=0:0 S K1=$O(^FH(119.6,K1)) Q:K1<1  S X=$G(^(K1,0)) D B1
"RTN","FHPRF1",63,0)
 F K1=0:0 S K1=$O(^FH(119.6,K1)) Q:K1<1  S X=$G(^(K1,0)) D B1:($P(X,U,8)=FHSITE!(FHSITE=0))
"RTN","FHPRF1",64,0)
 Q
"RTN","FHPRF1",65,0)
B1 S Z=$P(X,"^",5) I Z,$D(^TMP($J,"S",Z)) S Z1=$P(X,"^",17) S:$P(X,"^",7) Z1=Z1+$P(X,"^",19) S:'Z1 Z1=100 D B2
"RTN","FHPRF1",66,0)
 S Z=$P(X,"^",6) I Z,$D(^TMP($J,"S",Z)) S Z1=$P(X,"^",18) S:Z1="" Z1=100 D B2
"RTN","FHPRF1",67,0)
 Q
"RTN","FHPRF1",68,0)
B2 F L2=0:0 S L2=$O(^FH(119.6,K1,"W",L2)) Q:L2<1  S ZW=+$G(^(L2,0)) I ZW S ^TMP($J,"W",ZW)="",^TMP($J,"S",Z,ZW)=Z1
"RTN","FHPRF1",69,0)
 Q
"RTN","FHPRF1",70,0)
 ;
"RTN","FHPRF1",71,0)
PROSG ;process outpatient data from ^tmp($j global
"RTN","FHPRF1",72,0)
 S FHPLNM=""
"RTN","FHPRF1",73,0)
 S:$G(FHSITE) FHPLNM=$P($G(^FH(119.73,FHSITE,0)),U,1)
"RTN","FHPRF1",74,0)
RECUR ;recurring meals
"RTN","FHPRF1",75,0)
 S FHDT=D1+.999999
"RTN","FHPRF1",76,0)
 S FHTMPS="^TMP($J,""OP"",""R"")"
"RTN","FHPRF1",77,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHPRF1",78,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHPRF1",79,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHPRF1",80,0)
 ..S (FHPDIET,FHLOC,FHSER,FHDIET)="***"
"RTN","FHPRF1",81,0)
 ..S FHIJKDAT=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHPRF1",82,0)
 ..Q:$P(FHIJKDAT,U,19)="C"   ;quit if status is cancelled.
"RTN","FHPRF1",83,0)
 ..S FHDIET=$P(FHIJKDAT,U,3),FHDIET=$O(^FH(111,"B",FHDIET,0))
"RTN","FHPRF1",84,0)
 ..I $G(FHDIET),$D(^FH(111,FHDIET,0)) S FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHPRF1",85,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHPRF1",86,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHPRF1",87,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHPRF1",88,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHPRF1",89,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRF1",90,0)
 ..S:$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=^TMP($J,FHSER)+1
"RTN","FHPRF1",91,0)
 ..S:'$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=1
"RTN","FHPRF1",92,0)
 ..I $D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",93,0)
 ...S ^TMP($J,FHSER,FHPDIET)=^TMP($J,FHSER,FHPDIET)+1
"RTN","FHPRF1",94,0)
 ..I '$D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",95,0)
 ...S ^TMP($J,FHSER,FHPDIET)=1
"RTN","FHPRF1",96,0)
 ..I $D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=^TMP($J,0,FHPDIET)+1
"RTN","FHPRF1",97,0)
 ..I '$D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=1
"RTN","FHPRF1",98,0)
 ;
"RTN","FHPRF1",99,0)
SPEC ;special meals
"RTN","FHPRF1",100,0)
 S FHTMPS="^TMP($J,""OP"",""S"")"
"RTN","FHPRF1",101,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHPRF1",102,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHPRF1",103,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHPRF1",104,0)
 ..S (FHPDIET,FHLOC,FHSER,FHDIET)="***"
"RTN","FHPRF1",105,0)
 ..S FHIJKDAT=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHPRF1",106,0)
 ..S FHDIET=$P(FHIJKDAT,U,4),FHDIET=$O(^FH(111,"B",FHDIET,0))
"RTN","FHPRF1",107,0)
 ..S:$D(^FH(111,FHDIET,0)) FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHPRF1",108,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHPRF1",109,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHPRF1",110,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHPRF1",111,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHPRF1",112,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRF1",113,0)
 ..S:$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=^TMP($J,FHSER)+1
"RTN","FHPRF1",114,0)
 ..S:'$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=1
"RTN","FHPRF1",115,0)
 ..I $D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",116,0)
 ...S ^TMP($J,FHSER,FHPDIET)=^TMP($J,FHSER,FHPDIET)+1
"RTN","FHPRF1",117,0)
 ..I '$D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",118,0)
 ...S ^TMP($J,FHSER,FHPDIET)=1
"RTN","FHPRF1",119,0)
 ..I $D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=^TMP($J,0,FHPDIET)+1
"RTN","FHPRF1",120,0)
 ..I '$D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=1
"RTN","FHPRF1",121,0)
 ;
"RTN","FHPRF1",122,0)
GUEST ;guest meals
"RTN","FHPRF1",123,0)
 S FHTMPS="^TMP($J,""OP"",""G"")"
"RTN","FHPRF1",124,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHPRF1",125,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHPRF1",126,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>FHDT)  D
"RTN","FHPRF1",127,0)
 ..S (FHPDIET,FHLOC,FHSER,FHDIET)="***"
"RTN","FHPRF1",128,0)
 ..S FHIJKDAT=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHPRF1",129,0)
 ..Q:$P(FHIJKDAT,U,7)="C"
"RTN","FHPRF1",130,0)
 ..S FHDIET=$P($G(^FH(119.9,1,0)),U,2)   ;default diet from 119.9
"RTN","FHPRF1",131,0)
 ..S FHDIETN=$P(FHIJKDAT,U,6)  ;diet from guest meal
"RTN","FHPRF1",132,0)
 ..S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHPRF1",133,0)
 ..S:$G(FHLOC) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5)
"RTN","FHPRF1",134,0)
 ..S:'$G(FHSER) FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6)
"RTN","FHPRF1",135,0)
 ..S:'$G(FHSER) FHSER=$O(^FH(119.72,0))
"RTN","FHPRF1",136,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRF1",137,0)
 ..S:$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=^TMP($J,FHSER)+1
"RTN","FHPRF1",138,0)
 ..S:'$D(^TMP($J,FHSER)) ^TMP($J,FHSER)=1
"RTN","FHPRF1",139,0)
 ..I $G(FHDIETN),($D(^FH(111,FHDIETN,0))) D
"RTN","FHPRF1",140,0)
 ...S FHPDIET=$P(^FH(111,FHDIETN,0),U,5)
"RTN","FHPRF1",141,0)
 ..I $D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",142,0)
 ...S ^TMP($J,FHSER,FHPDIET)=^TMP($J,FHSER,FHPDIET)+1
"RTN","FHPRF1",143,0)
 ..I '$D(^TMP($J,FHSER,FHPDIET)) D
"RTN","FHPRF1",144,0)
 ...S ^TMP($J,FHSER,FHPDIET)=1
"RTN","FHPRF1",145,0)
 ..I $D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=^TMP($J,0,FHPDIET)+1
"RTN","FHPRF1",146,0)
 ..I '$D(^TMP($J,0,FHPDIET)) S ^TMP($J,0,FHPDIET)=1
"RTN","FHPRF1",147,0)
 Q
"RTN","FHPRF1",148,0)
 ;
"RTN","FHPRF1",149,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHPRO")
0^65^B10948850
"RTN","FHPRO",1,0)
FHPRO ; HISC/REL/RTK - Food Production Manager ;4/12/06  15:53
"RTN","FHPRO",2,0)
 ;;5.5;DIETETICS;**4,5**;Jan 28, 2005;Build 53
"RTN","FHPRO",3,0)
EN2 ; Enter/Edit Nutrition Locations (Inpatient Wards/Outpatient Clinics)
"RTN","FHPRO",4,0)
 W ! K DIR,DIC S DIR("A")="Select WARD or OUTPATIENT Location: "
"RTN","FHPRO",5,0)
 S DIR(0)="SAO^W:Ward Location;O:Outpatient Location" D ^DIR Q:$D(DIRUT)
"RTN","FHPRO",6,0)
 I Y'=-1 S FHANS=Y
"RTN","FHPRO",7,0)
 I FHANS="W" D EN2WRD Q
"RTN","FHPRO",8,0)
 I FHANS="O" D EN2OL Q
"RTN","FHPRO",9,0)
 Q
"RTN","FHPRO",10,0)
EN2WRD ;Ward locations
"RTN","FHPRO",11,0)
 K DIC S (DIC,DIE)="^FH(119.6,",DIC(0)="AEQLM",DLAYGO=119.6
"RTN","FHPRO",12,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN2:Y<1
"RTN","FHPRO",13,0)
 S DA=+Y,DR=".01:2.5;3;S:X="""" Y=4;3.5;4;S:X="""" Y=5;4.5;5;S:'X Y=6;5.5;6:29;99;107;107.5;108;108.5;109;109.5;110;110.5;111;111.5;112" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.6 D ^DIE,KIL G EN2
"RTN","FHPRO",14,0)
EN2OL ;Outpatient locations
"RTN","FHPRO",15,0)
 K DIC S (DIC,DIE)="^FH(119.6,",DIC(0)="AEQLM",DLAYGO=119.6
"RTN","FHPRO",16,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN2:Y<1
"RTN","FHPRO",17,0)
 S DA=+Y,DR=".01;2;2.6;3;S:X="""" Y=4;3.5;4;S:X="""" Y=5;4.5;5;S:'X Y=6;5.5;6;7;103:106;11;20:99;107;107.5;108;108.5;109;109.5;110;110.5;111;111.5;112" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.6 D ^DIE,KIL G EN2
"RTN","FHPRO",18,0)
EN3 ; Enter/Edit Production Diets
"RTN","FHPRO",19,0)
 K DIC S (DIC,DIE)="^FH(116.2,",DIC(0)="AEQLM",DLAYGO=116.2
"RTN","FHPRO",20,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN3:Y<1
"RTN","FHPRO",21,0)
 S DA=+Y,DR=$S(DA=1:"1:8",1:".01:7.5;10;S:X'=""Y"" Y=8;11;8;12:99") S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=116.2 D ^DIE I '$D(DA) D KIL G EN3
"RTN","FHPRO",22,0)
 S:$O(^FH(116.2,DA,"R",0))<1 $P(^FH(116.2,DA,0),"^",4)="N" D KIL G EN3
"RTN","FHPRO",23,0)
EN4 ; List Production Diets
"RTN","FHPRO",24,0)
 W !!,"The list requires a 132 column printer.",!
"RTN","FHPRO",25,0)
 W ! S L=0,DIC="^FH(116.2,",FLDS="[FHPROD]",BY="8,.01"
"RTN","FHPRO",26,0)
 S FR="@",TO="",DHD="PRODUCTION DIETS" D EN1^DIP,RSET Q
"RTN","FHPRO",27,0)
EN5 ; Enter/Edit Production Facilities
"RTN","FHPRO",28,0)
 K DIC S (DIC,DIE)="^FH(119.71,",DIC(0)="AEQLM",DLAYGO=119.71
"RTN","FHPRO",29,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN5:Y<1
"RTN","FHPRO",30,0)
 S DA=+Y,DR=".01:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.71 D ^DIE,KIL G EN5
"RTN","FHPRO",31,0)
EN6 ; Enter/Edit Service Points
"RTN","FHPRO",32,0)
 K DIC S (DIC,DIE)="^FH(119.72,",DIC(0)="AEQLM",DLAYGO=119.72
"RTN","FHPRO",33,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN6:Y<1
"RTN","FHPRO",34,0)
 S DA=+Y S DR=".01:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.72 D ^DIE I '$D(DA) D KIL G EN6
"RTN","FHPRO",35,0)
 S DA(1)=DA S DIK="^FH(119.72,DA(1),""A""," F DA=0:0 S DA=$O(^FH(119.72,DA(1),"A",DA)) Q:DA'>0  I $P($G(^(DA,0)),"^",2,8)?."^" D ^DIK
"RTN","FHPRO",36,0)
 S DIK="^FH(119.72,DA(1),""B""," F DA=0:0 S DA=$O(^FH(119.72,DA(1),"B",DA)) Q:DA'>0  I $P($G(^(DA,0)),"^",2,22)?."^" D ^DIK
"RTN","FHPRO",37,0)
 D KIL G EN6
"RTN","FHPRO",38,0)
EN7 ; Enter/Edit Communication Offices
"RTN","FHPRO",39,0)
 K DIC S (DIC,DIE)="^FH(119.73,",DIC(0)="AEQLM",DLAYGO=119.73
"RTN","FHPRO",40,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN7:Y<1
"RTN","FHPRO",41,0)
 S DA=+Y,DR=".01:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.73 D ^DIE,KIL G EN7
"RTN","FHPRO",42,0)
EN8 ; Enter/Edit Supplemental Feeding Sites
"RTN","FHPRO",43,0)
 K DIC S (DIC,DIE)="^FH(119.74,",DIC(0)="AEQLM",DLAYGO=119.74
"RTN","FHPRO",44,0)
 S DIC("DR")=".01" W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN8:Y<1
"RTN","FHPRO",45,0)
 S DA=+Y,DR=".01:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=119.74 D ^DIE,KIL G EN8
"RTN","FHPRO",46,0)
RSET K %ZIS S IOP="" D ^%ZIS
"RTN","FHPRO",47,0)
KIL G KILL^XUSCLEAN
"RTN","FHPRO1")
0^51^B38822254
"RTN","FHPRO1",1,0)
FHPRO1 ; HISC/REL/RVD - Production Processing ;3/6/95  15:45
"RTN","FHPRO1",2,0)
 ;;5.5;DIETETICS;**3,5**;Jan 28, 2005;Build 53
"RTN","FHPRO1",3,0)
 ;Patch #5 adding missing variable FHSITE & process each date seperately for Forecasting.
"RTN","FHPRO1",4,0)
 ;
"RTN","FHPRO1",5,0)
 K ^TMP($J),^TMP("FH")
"RTN","FHPRO1",6,0)
 S FHSITE=""
"RTN","FHPRO1",7,0)
 S FHALL=0   ;if fhall=1, process all data for certain Production Fac.
"RTN","FHPRO1",8,0)
 S FHPFLG=0  ;if fhpflg=1, there is only one Production Facility.
"RTN","FHPRO1",9,0)
 S FHP=$O(^FH(119.71,0)) I FHP'<1,$O(^FH(119.71,FHP))<1 S FHPFLG=1 G CEFO
"RTN","FHPRO1",10,0)
F0 R !!,"Select PRODUCTION FACILITY: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHPRO1",11,0)
 K DIC S DIC="^FH(119.71,",DIC(0)="EMQ" D ^DIC G:Y<1 F0 S FHP=+Y
"RTN","FHPRO1",12,0)
 ;
"RTN","FHPRO1",13,0)
CEFO ;Census and Forcast
"RTN","FHPRO1",14,0)
R0 R !!,"Use CENSUS or FORECAST? (C OR F): ",FHP6:DTIME G:'$T!("^"[FHP6) KIL S X=FHP6 D TR^FH S FHP6=X I $P("CENSUS",FHP6,1)'="",$P("FORECAST",FHP6,1)'="" W *7," Enter C or F" G R0
"RTN","FHPRO1",15,0)
 K M2 S FHP6=$E(FHP6,1),FHP6=$S(FHP6="C":"Census",1:"Forecast") G:FHP6["F" F1
"RTN","FHPRO1",16,0)
 ;
"RTN","FHPRO1",17,0)
CL ;Ask for Communication Office if census is selected.
"RTN","FHPRO1",18,0)
 K FHSITE,FHSITENM,X,DIC
"RTN","FHPRO1",19,0)
 I $G(FHP) S DIC("S")="I $D(^FH(119.73,+Y,0)),$P(^FH(119.73,+Y,0),U,4)=FHP"
"RTN","FHPRO1",20,0)
 R !!,"Select COMMUNICATION OFFICE (or ALL): ALL// ",X:DTIME
"RTN","FHPRO1",21,0)
 S:X="" X="ALL" G:'$T!("^"[X) KIL D TR^FH I X="ALL" S FHSITE=0
"RTN","FHPRO1",22,0)
 I X'="ALL" S DIC="^FH(119.73,",DIC(0)="EMQ" D ^DIC G:Y<1 CL S FHSITE=+Y,FHSITENM=$P(Y,U,2)
"RTN","FHPRO1",23,0)
 G:'$D(FHSITE) KIL
"RTN","FHPRO1",24,0)
 I FHSITE'<1,$O(^FH(119.73,FHP))<1 G F1
"RTN","FHPRO1",25,0)
 ;
"RTN","FHPRO1",26,0)
F1 S %DT("A")="Select Start Date: ",%DT="AEX" W ! D ^%DT G KIL:"^"[X!$D(DTOUT),F1:Y<1 S (X1,D1)=+Y
"RTN","FHPRO1",27,0)
 D E1^FHPRC1 I FHCY<1 W *7,!!,"No MENU CYCLE Defined for that Date!" G F1
"RTN","FHPRO1",28,0)
 I '$D(^FH(116,FHCY,"DA",FHDA,0)) W *7,!!,"MENU CYCLE DAY Not Defined for that Date!" G F1
"RTN","FHPRO1",29,0)
 ;
"RTN","FHPRO1",30,0)
F2 S %DT("A")="Select End Date: ",%DT="AEX" W ! D ^%DT G KIL:"^"[X!$D(DTOUT),F2:Y<1
"RTN","FHPRO1",31,0)
 I +Y<D1 W !!,"***End Date must be on or after Start Date!!!" G F2
"RTN","FHPRO1",32,0)
 S (X1,FHDT2)=+Y S FHERRDT=0
"RTN","FHPRO1",33,0)
 D E1^FHPRC1 I FHCY<1 W *7,!!,"No MENU CYCLE Defined for that Date!" G F2
"RTN","FHPRO1",34,0)
 I '$D(^FH(116,FHCY,"DA",FHDA,0)) W *7,!!,"MENU CYCLE DAY Not Defined for that Date!" G F2
"RTN","FHPRO1",35,0)
 S FHD1SV=D1
"RTN","FHPRO1",36,0)
 F FHDTI=1:1 S X1=FHD1SV,X2=FHDTI-1 D C^%DTC Q:FHDTI'>0!(X>FHDT2)  D
"RTN","FHPRO1",37,0)
 .S (X1,D1,DTP)=X D E1^FHPRC1 I FHCY<1 D DTP^FH W *7,!!,"No MENU CYCLE Defined for Date: ",DTP S FHERRDT=1
"RTN","FHPRO1",38,0)
 .I '$D(^FH(116,FHCY,"DA",FHDA,0)) D DTP^FH W *7,!!,"No MENU CYCLE Defined for Date: ",DTP S FHERRDT=1
"RTN","FHPRO1",39,0)
 S D1=FHD1SV
"RTN","FHPRO1",40,0)
 I $G(FHERRDT) G F2
"RTN","FHPRO1",41,0)
 ;
"RTN","FHPRO1",42,0)
R1 ;R !!,"Select MEAL (B,N,E, or combination of BNE, or ALL): ALL// ",MEAL:DTIME G:'$T!(MEAL["^") KIL S:MEAL="" MEAL="ALL" S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHPRO1",43,0)
 R !!,"Select Starting and Ending MEAL (B, N, E, B-B, B-N, B-E, N-B, N-N, N-E, E-B, E-N, E-E, or ALL): ALL// ",MEAL:DTIME
"RTN","FHPRO1",44,0)
 G:'$T!(MEAL["^") KIL S:MEAL="" MEAL="ALL" S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHPRO1",45,0)
 D CHKML
"RTN","FHPRO1",46,0)
 I '$G(FHMLFLG)!(MEAL["?") W *7,!!,"You may select B for Breakfast, N for Noon, E for Evening, B-N for Breakfast to Noon, N-E for Noon to Evening, or any combination separated by a hyphen, or ALL for all meals" G R1
"RTN","FHPRO1",47,0)
 ;I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Select B for Breakfast, N for Noon, or E for Evening, or any combination of BNE, or ALL for all meals" G R1
"RTN","FHPRO1",48,0)
 S FHDA=^FH(116,FHCY,"DA",FHDA,0)
"RTN","FHPRO1",49,0)
 I $D(^FH(116.3,D1,0)) S X=^(0) F LL=2:1:4 I $P(X,"^",LL) S $P(FHDA,"^",LL)=$P(X,"^",LL)
"RTN","FHPRO1",50,0)
 ;I MEAL'="A" S FHX1=$P(FHDA,"^",$F("BNE",MEAL)) I 'FHX1 W *7,!!,"*** NO MENU DEFINED FOR THIS MEAL ***" G KIL
"RTN","FHPRO1",51,0)
R2 R !!,"Do you want PRODUCTION Summary? (Y/N) N// ",FHP1:DTIME G:'$T!(FHP1["^") KIL S:FHP1="" FHP1="N" S X=FHP1 D TR^FH S FHP1=X I $P("YES",FHP1,1)'="",$P("NO",FHP1,1)'="" W *7,"  Enter YES or NO" G R2
"RTN","FHPRO1",52,0)
 S FHP1=$E(FHP1,1)
"RTN","FHPRO1",53,0)
R3 R !!,"Do you want MEAL SERVICE Summary? (Y/N) N// ",FHP2:DTIME G:'$T!(FHP2["^") KIL S:FHP2="" FHP2="N" S X=FHP2 D TR^FH S FHP2=X I $P("YES",FHP2,1)'="",$P("NO",FHP2,1)'="" W *7,"  Enter YES or NO" G R3
"RTN","FHPRO1",54,0)
 S FHP2=$E(FHP2,1)
"RTN","FHPRO1",55,0)
R4 R !!,"Do you want RECIPE PREPARATION Sheet? (Y/N) N// ",FHP3:DTIME G:'$T!(FHP3["^") KIL S:FHP3="" FHP3="N" S X=FHP3 D TR^FH S FHP3=X I $P("YES",FHP3,1)'="",$P("NO",FHP3,1)'="" W *7,"  Enter YES or NO" G R4
"RTN","FHPRO1",56,0)
 S FHP3=$E(FHP3,1)
"RTN","FHPRO1",57,0)
R5 R !!,"Do you want STOREROOM REQUISITION Sheet? (Y/N) N// ",FHP4:DTIME G:'$T!(FHP4["^") KIL S:FHP4="" FHP4="N" S X=FHP4 D TR^FH S FHP4=X I $P("YES",FHP4,1)'="",$P("NO",FHP4,1)'="" W *7,"  Enter YES or NO" G R5
"RTN","FHPRO1",58,0)
 S FHP4=$E(FHP4,1)
"RTN","FHPRO1",59,0)
R7 R !!,"Do you want PRINTED RECIPES? (Y/N) N// ",FHP5:DTIME G:'$T!(FHP5["^") KIL S:FHP5="" FHP5="N" S X=FHP5 D TR^FH S FHP5=X I $P("YES",FHP5,1)'="",$P("NO",FHP5,1)'="" W *7,"  Enter YES or NO" G R7
"RTN","FHPRO1",60,0)
 S FHP5=$E(FHP5,1)
"RTN","FHPRO1",61,0)
R8 R !!,"Do you want Advance Food Prep? (Y/N) N// ",FHP8:DTIME G:'$T!(FHP8["^") KIL S:FHP8="" FHP8="N" S X=FHP8 D TR^FH S FHP8=X I $P("YES",FHP8,1)'="",$P("NO",FHP8,1)'="" W *7,"  Enter YES or NO" G R8
"RTN","FHPRO1",62,0)
 S FHP8=$E(FHP8,1)
"RTN","FHPRO1",63,0)
R10 R !!,"Do you want Storeroom Requisition for AFP? (Y/N) N// ",FHP10:DTIME G:'$T!(FHP10["^") KIL S:FHP10="" FHP10="N" S X=FHP10 D TR^FH S FHP10=X I $P("YES",FHP10,1)'="",$P("NO",FHP10,1)'="" W *7,"  Enter YES or NO" G R10
"RTN","FHPRO1",64,0)
 S FHP10=$E(FHP10,1)
"RTN","FHPRO1",65,0)
R9 R !!,"Do you want Printed Recipes for AFP? (Y/N) N// ",FHP9:DTIME G:'$T!(FHP9["^") KIL S:FHP9="" FHP9="N" S X=FHP9 D TR^FH S FHP9=X I $P("YES",FHP9,1)'="",$P("NO",FHP9,1)'="" W *7,"  Enter YES or NO" G R9
"RTN","FHPRO1",66,0)
 S FHP9=$E(FHP9,1)
"RTN","FHPRO1",67,0)
 D:FHP6["F" FOR
"RTN","FHPRO1",68,0)
 G:$G(FHQUIT) KIL
"RTN","FHPRO1",69,0)
L0 W !!,"The report requires a 132 column printer.",!
"RTN","FHPRO1",70,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHPRO1",71,0)
 I $D(IO("Q")) S FHPGM="^FHPRO2",FHLST="D1^FHDT2^MEAL^FHDA^FHP^FHP1^FHP2^FHP3^FHP4^FHP5^FHP6^FHP8^FHP9^FHP10^M2(^FHSITE" D EN2^FH G KIL
"RTN","FHPRO1",72,0)
 U IO D ^FHPRO2 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHPRO1",73,0)
 ;Next ask for forcasted amount.
"RTN","FHPRO1",74,0)
FOR S FHD1SAV=D1,FHQUIT=0 ;save the starting date.
"RTN","FHPRO1",75,0)
 S FHSITE=0
"RTN","FHPRO1",76,0)
 F FHDTI=1:1 S X1=FHD1SAV,X2=FHDTI-1 D C^%DTC Q:FHDTI'>0!(X>FHDT2)!$G(FHQUIT)  D
"RTN","FHPRO1",77,0)
 .S FHDTTO=X,D1=X
"RTN","FHPRO1",78,0)
 .W !!,"Forecasting ..." D Q2^FHPRF1
"RTN","FHPRO1",79,0)
 .F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1!$G(FHQUIT)  D
"RTN","FHPRO1",80,0)
 ..S S1=^TMP($J,P0)
"RTN","FHPRO1",81,0)
 ..W !!?5,"Service Point: ",$P(^FH(119.72,P0,0),"^",1)
"RTN","FHPRO1",82,0)
 ..D C1
"RTN","FHPRO1",83,0)
 S D1=FHD1SAV
"RTN","FHPRO1",84,0)
 Q
"RTN","FHPRO1",85,0)
C1 ;
"RTN","FHPRO1",86,0)
 S X=FHDTTO D DOW^%DTC S DOW=Y+1
"RTN","FHPRO1",87,0)
 S FHDAY=$P("SUN^MON^TUES^WEDNES^THURS^FRI^SATUR","^",DOW)
"RTN","FHPRO1",88,0)
 S DTP=FHDTTO D DTP^FH
"RTN","FHPRO1",89,0)
 W !?5,"Forecast Census for ",FHDAY,"DAY, ",DTP," : ",S1," // " R X:DTIME
"RTN","FHPRO1",90,0)
 I '$T!(X["^") S FHQUIT=1 Q
"RTN","FHPRO1",91,0)
 S:X="" X=S1 I X'?1N.N!(X>9999) W *7,"  Must be a number less than 9999" G C1
"RTN","FHPRO1",92,0)
 I '$D(M2(P0)) S M2(P0)=X
"RTN","FHPRO1",93,0)
 E  S M2(P0)=M2(P0)_"^"_X
"RTN","FHPRO1",94,0)
 Q
"RTN","FHPRO1",95,0)
 ;
"RTN","FHPRO1",96,0)
CHKML ;check meal
"RTN","FHPRO1",97,0)
 S FHMLFLG=0
"RTN","FHPRO1",98,0)
 F FHMLCM="B","N","E","B-B","B-N","B-E","A","N-B","N-N","N-E","E-B","E-N","E-E" Q:FHMLCM=MEAL
"RTN","FHPRO1",99,0)
 S:FHMLCM=MEAL FHMLFLG=1
"RTN","FHPRO1",100,0)
 Q
"RTN","FHPRO1",101,0)
 ;
"RTN","FHPRO1",102,0)
KIL K ^TMP($J),^TMP("FH") G KILL^XUSCLEAN
"RTN","FHPRO3")
0^25^B35628181
"RTN","FHPRO3",1,0)
FHPRO3 ; HISC/REL/RVD - Recipe Calculations ;4/14/95  08:05
"RTN","FHPRO3",2,0)
 ;;5.5;DIETETICS;**3,5**;Jan 28, 2005;Build 53
"RTN","FHPRO3",3,0)
 ;RVD 5/20/05 - as part of AFP project.
"RTN","FHPRO3",4,0)
 ;patch #5 -added a screen for cancelled quest meals.
"RTN","FHPRO3",5,0)
 K ^TMP($J,"FH","T"),P,T
"RTN","FHPRO3",6,0)
 I '$G(FHAFLG) K ^TMP($J,"AFP","T")
"RTN","FHPRO3",7,0)
 ;S K3=$F("BNE",MEAL)-1,FHX1=$P(FHDA,"^",K3+1) Q:'FHX1
"RTN","FHPRO3",8,0)
 F L1=0:0 S L1=$O(^FH(116.2,L1)) Q:L1<1  S Z=$P($G(^(L1,0)),"^",2) I Z'="" S P(Z)=L1
"RTN","FHPRO3",9,0)
 F P0=0:0 S P0=$O(^TMP($J,"FH",P0)) Q:P0<1  S Z=$P($G(^FH(119.72,P0,0)),"^",2) I Z'="" S T(P0)=Z
"RTN","FHPRO3",10,0)
 D P1
"RTN","FHPRO3",11,0)
 S FHAFLG=1
"RTN","FHPRO3",12,0)
 G ^FHPRO4
"RTN","FHPRO3",13,0)
P1 F FHI=0:0 S FHI=$O(FHDODAY(FHI)) Q:FHI'>0  S (D1,X1)=FHDODAY(FHI) D FHD,P12
"RTN","FHPRO3",14,0)
 K M,P,T,Y,Z,Z1 Q
"RTN","FHPRO3",15,0)
P12 S K3=$F("BNE",MEAL)-1,FHX1=$P(FHDA,"^",K3+1) Q:'FHX1
"RTN","FHPRO3",16,0)
 Q:'$D(^FH(116.1,FHX1))
"RTN","FHPRO3",17,0)
 F M=0:0 S M=$O(^FH(116.1,FHX1,"RE",M)) Q:M<1  S L1=^(M,0),L1=+L1 D P2
"RTN","FHPRO3",18,0)
 Q
"RTN","FHPRO3",19,0)
P2 S N1=0,X=$G(^FH(114,L1,0)),K4=$P(X,"^",12),K4=$S($D(^FH(114.2,+K4,0)):$P(^(0),"^",3),1:99)
"RTN","FHPRO3",20,0)
 ;S MCA=$O(^FH(116.1,FHX1,"RE",M,"R",0)),LL=$S(MCA:+$G(^FH(116.1,FHX1,"RE",M,"R",MCA,0)),1:99)
"RTN","FHPRO3",21,0)
 ;S FHPD=$P(LL,"^",2),LL=+LL
"RTN","FHPRO3",22,0)
 ;S LL=$S($D(^FH(114.1,+LL,0)):$P(^(0),"^",3),1:99)
"RTN","FHPRO3",23,0)
 ;
"RTN","FHPRO3",24,0)
 S LL=$P(X,"^",7)
"RTN","FHPRO3",25,0)
 I $G(LL) S LL=$S($D(^FH(114.1,+LL,0)):$P(^(0),"^",3),1:99)
"RTN","FHPRO3",26,0)
 S K4=$S(K4<1:99,K4<10:"0"_K4,1:K4)_$S(LL<1:99,LL<10:"0"_LL,1:LL)_$E($P(X,"^",1),1,26)
"RTN","FHPRO3",27,0)
 F P0=0:0 S P0=$O(^TMP($J,"FHD",D1,P0)) Q:P0<1  D R1 ;I N2 S ^TMP($J,"FH","T",K4,L1,P0)=N2,^TMP($J,"AFP","T",K4,L1,P0)=N2
"RTN","FHPRO3",28,0)
 Q:'N1  S:'$G(^TMP($J,"FH","T",K4,L1)) ^TMP($J,"FH","T",K4,L1)=0 S ^(L1)=^(L1)+N1
"RTN","FHPRO3",29,0)
 S:'$G(^TMP($J,"AFP","T",K4,L1)) ^TMP($J,"AFP","T",K4,L1)=0 S ^(L1)=^(L1)+N1
"RTN","FHPRO3",30,0)
 Q
"RTN","FHPRO3",31,0)
R1 S Z1=$P($G(^FH(116.1,FHX1,"RE",M,"D",P0,0)),"^",2),N2=0
"RTN","FHPRO3",32,0)
 F CAT=0:0 S CAT=$O(^FH(116.1,FHX1,"RE",M,"R",CAT)) Q:CAT<1  S FHPD=$P($G(^(CAT,0)),"^",2) D
"RTN","FHPRO3",33,0)
 .F LL=1:1 S FHX2=$P(FHPD," ",LL) Q:FHX2=""  S X=$P(FHX2,";",1) I X'="",$D(P(X)) D P3
"RTN","FHPRO3",34,0)
 .Q
"RTN","FHPRO3",35,0)
 Q
"RTN","FHPRO3",36,0)
P3 S FHPX1=$G(^TMP($J,"FHD",D1,P0,P(X))) Q:'FHPX1
"RTN","FHPRO3",37,0)
 S Y=$P(FHX2,";",2) I Y="" S:Z1'="" FHPX1=$J(Z1*FHPX1/100,0,0) G P4
"RTN","FHPRO3",38,0)
 D P5 S Y=$P(FHX2,";",3) D:Y'="" P5
"RTN","FHPRO3",39,0)
P4 S N1=N1+FHPX1,N2=N2+FHPX1 ;S:FHPX1 ^TMP($J,"FH","T",K4,L1,P0)=FHPX1 Q
"RTN","FHPRO3",40,0)
 I FHPX1 S:'$D(^TMP($J,"FH","T",K4,L1,P0)) ^TMP($J,"FH","T",K4,L1,P0)=0 S ^TMP($J,"FH","T",K4,L1,P0)=^TMP($J,"FH","T",K4,L1,P0)+FHPX1
"RTN","FHPRO3",41,0)
 Q
"RTN","FHPRO3",42,0)
P5 S:$E(Y,1)=T(P0) FHPX1=$J($E(Y,2,99)*FHPX1/100,0,0) Q
"RTN","FHPRO3",43,0)
 ;
"RTN","FHPRO3",44,0)
FHD ;get FHDA
"RTN","FHPRO3",45,0)
 S:$D(FHDA) FHDASV=FHDA
"RTN","FHPRO3",46,0)
 D E1^FHPRC1
"RTN","FHPRO3",47,0)
 I '$G(FHCY)!'$G(FHDA) S FHDA=FHDASV Q
"RTN","FHPRO3",48,0)
 S FHDA=^FH(116,FHCY,"DA",FHDA,0)
"RTN","FHPRO3",49,0)
 I $D(^FH(116.3,D1,0)) S X=^(0) F LL=2:1:4 I $P(X,"^",LL) S $P(FHDA,"^",LL)=$P(X,"^",LL)
"RTN","FHPRO3",50,0)
 Q
"RTN","FHPRO3",51,0)
 ;
"RTN","FHPRO3",52,0)
OUT ;process outpatient data
"RTN","FHPRO3",53,0)
REC S FHTIM=D1-.000001,FHDT299=FHDT2+.99999
"RTN","FHPRO3",54,0)
 F FHIR=FHTIM:0 S FHIR=$O(^FHPT("RM",FHIR)) Q:(FHIR'>0)!(FHIR>(FHDT299))  F FHIDFN=0:0 S FHIDFN=$O(^FHPT("RM",FHIR,FHIDFN)) Q:FHIDFN'>0  D
"RTN","FHPRO3",55,0)
 .F FHIEN=0:0 S FHIEN=$O(^FHPT("RM",FHIR,FHIDFN,FHIEN)) Q:FHIEN'>0  D
"RTN","FHPRO3",56,0)
 ..S FHPX1=FHIR\1
"RTN","FHPRO3",57,0)
 ..S FHREDAT=$G(^FHPT(FHIDFN,"OP",FHIEN,0))
"RTN","FHPRO3",58,0)
 ..Q:$P(FHREDAT,U,4)'=MEAL
"RTN","FHPRO3",59,0)
 ..Q:$P(FHREDAT,U,15)="C"
"RTN","FHPRO3",60,0)
 ..S FHLOC=$P(FHREDAT,U,3) Q:'$G(FHLOC)
"RTN","FHPRO3",61,0)
 ..I $G(FHSITE),$P($G(^FH(119.6,FHLOC,0)),U,8)'=FHSITE Q
"RTN","FHPRO3",62,0)
 ..S FHRDIET=$P(FHREDAT,U,2) Q:'$G(FHRDIET)
"RTN","FHPRO3",63,0)
 ..S FHPDIET=$P($G(^FH(111,FHRDIET,0)),U,5)
"RTN","FHPRO3",64,0)
 ..I $G(FHLOC) D
"RTN","FHPRO3",65,0)
 ...S FHSER=$P($G(^FH(119.6,FHLOC,0)),U,5) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",66,0)
 ...I '$G(FHSER) S FHSER=$P($G(^FH(119.6,FHLOC,0)),U,6) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",67,0)
 ...I '$G(FHSER) S FHSER=$O(^FH(119.72,0)) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",68,0)
 ..Q:'$G(FHSER)
"RTN","FHPRO3",69,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRO3",70,0)
 ..S FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHPRO3",71,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHPRO3",72,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHPRO3",73,0)
 ..S:'$D(^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)) ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=0
"RTN","FHPRO3",74,0)
 ..S ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)+1
"RTN","FHPRO3",75,0)
 ..S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHPRO3",76,0)
 ..;if tubefeeding and not cancelled, also count the TF data.
"RTN","FHPRO3",77,0)
 ..I $D(^FHPT(FHIDFN,"OP",FHIEN,"TF")) D
"RTN","FHPRO3",78,0)
 ...Q:$P(^FHPT(FHIDFN,"OP",FHIEN,3),U,5)="C"
"RTN","FHPRO3",79,0)
 ...I '$D(P(.7,FHSER)) S P(.7,FHSER)=1
"RTN","FHPRO3",80,0)
 ...E  S P(.7,FHSER)=P(.7,FHSER)+1
"RTN","FHPRO3",81,0)
 ...S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHPRO3",82,0)
 ;
"RTN","FHPRO3",83,0)
SPEC ;process special meal
"RTN","FHPRO3",84,0)
 S FHITIM=D1-.00001
"RTN","FHPRO3",85,0)
 F FHI=FHITIM:0 S FHI=$O(^FHPT("SM",FHI)) Q:(FHI'>0)!(FHI>FHDT299)  D
"RTN","FHPRO3",86,0)
 .F FHJ=0:0 S FHJ=$O(^FHPT("SM",FHI,FHJ)) Q:FHJ'>0  D
"RTN","FHPRO3",87,0)
 ..S FHPX1=FHI\1
"RTN","FHPRO3",88,0)
 ..S FHNODE=$G(^FHPT(FHJ,"SM",FHI,0))
"RTN","FHPRO3",89,0)
 ..S FHSTAT=$P(FHNODE,U,2)
"RTN","FHPRO3",90,0)
 ..I FHSTAT'="A",(FHSTAT'="P") Q
"RTN","FHPRO3",91,0)
 ..S FHLPT=$P(FHNODE,U,3)
"RTN","FHPRO3",92,0)
 ..S FHDIET=$P(FHNODE,U,4)
"RTN","FHPRO3",93,0)
 ..S:'$G(FHDIET) FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHPRO3",94,0)
 ..I $G(FHDIET),$D(^FH(111,FHDIET,0)) S FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHPRO3",95,0)
 ..Q:'$G(FHPDIET)
"RTN","FHPRO3",96,0)
 ..I $G(FHSITE) S FHCOM=$P(^FH(119.6,FHLPT,0),U,8) Q:FHSITE'=FHCOM
"RTN","FHPRO3",97,0)
 ..S FHSER=""
"RTN","FHPRO3",98,0)
 ..I $G(FHLPT) D
"RTN","FHPRO3",99,0)
 ...S FHSER=$P($G(^FH(119.6,FHLPT,0)),U,5) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",100,0)
 ...I '$G(FHSER) S FHSER=$P($G(^FH(119.6,FHLPT,0)),U,6) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",101,0)
 ...I '$G(FHSER) S FHSER=$O(^FH(119.72,0)) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",102,0)
 ..Q:FHSER=""
"RTN","FHPRO3",103,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRO3",104,0)
 ..S FHMEAL=$P(FHNODE,U,9)
"RTN","FHPRO3",105,0)
 ..Q:FHMEAL'=MEAL
"RTN","FHPRO3",106,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHPRO3",107,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHPRO3",108,0)
 ..S:'$D(^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)) ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=0
"RTN","FHPRO3",109,0)
 ..S ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)+1
"RTN","FHPRO3",110,0)
 ..;S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHPRO3",111,0)
 ;
"RTN","FHPRO3",112,0)
GUEST ;process GUEST meal
"RTN","FHPRO3",113,0)
 F FHI=FHITIM:0 S FHI=$O(^FHPT("GM",FHI)) Q:(FHI'>0)!(FHI>FHDT299)  D
"RTN","FHPRO3",114,0)
 .F FHJ=0:0 S FHJ=$O(^FHPT("GM",FHI,FHJ)) Q:FHJ'>0  D
"RTN","FHPRO3",115,0)
 ..S FHPX1=FHI\1
"RTN","FHPRO3",116,0)
 ..S FHNODE=$G(^FHPT(FHJ,"GM",FHI,0))
"RTN","FHPRO3",117,0)
 ..S FHMEAL=$P(FHNODE,U,3)
"RTN","FHPRO3",118,0)
 ..Q:FHMEAL'=MEAL
"RTN","FHPRO3",119,0)
 ..Q:$P(FHNODE,U,9)="C"
"RTN","FHPRO3",120,0)
 ..S FHLPT=$P(FHNODE,U,5)
"RTN","FHPRO3",121,0)
 ..S FHDIET=$P(FHNODE,U,6)
"RTN","FHPRO3",122,0)
 ..S:'$G(FHDIET) FHDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHPRO3",123,0)
 ..I $G(FHDIET),$D(^FH(111,FHDIET,0)) S FHPDIET=$P(^FH(111,FHDIET,0),U,5)
"RTN","FHPRO3",124,0)
 ..Q:'$G(FHPDIET)
"RTN","FHPRO3",125,0)
 ..I $G(FHSITE) S FHCOM=$P(^FH(119.6,FHLPT,0),U,8) Q:FHSITE'=FHCOM
"RTN","FHPRO3",126,0)
 ..S FHSER=""
"RTN","FHPRO3",127,0)
 ..I $G(FHLPT) D
"RTN","FHPRO3",128,0)
 ...S FHSER=$P($G(^FH(119.6,FHLPT,0)),U,5) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",129,0)
 ...I '$G(FHSER) S FHSER=$P($G(^FH(119.6,FHLPT,0)),U,6) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",130,0)
 ...I '$G(FHSER) S FHSER=$O(^FH(119.72,0)) S:$G(FHSER) SP(FHSER)=""
"RTN","FHPRO3",131,0)
 ..Q:FHSER=""
"RTN","FHPRO3",132,0)
 ..I $D(^FH(119.72,FHSER,0)),$P(^FH(119.72,FHSER,0),U,3)'=FHP Q
"RTN","FHPRO3",133,0)
 ..S:'$D(P(FHPDIET,FHSER)) P(FHPDIET,FHSER)=0
"RTN","FHPRO3",134,0)
 ..S P(FHPDIET,FHSER)=P(FHPDIET,FHSER)+1
"RTN","FHPRO3",135,0)
 ..S:'$D(^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)) ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=0
"RTN","FHPRO3",136,0)
 ..S ^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)=^TMP($J,"FHD",FHPX1,FHSER,FHPDIET)+1
"RTN","FHPRO3",137,0)
 ..;S:'$D(P(.6,FHSER)) P(.6,FHSER)=0 S P(.6,FHSER)=P(.6,FHSER)+1
"RTN","FHPRO3",138,0)
 Q
"RTN","FHSEL2")
0^27^B27221100
"RTN","FHSEL2",1,0)
FHSEL2 ; HISC/REL/NCA/FAI - Tabulate Patient Preferences ;10/29/04  7:19
"RTN","FHSEL2",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSEL2",3,0)
 ;patch #5 - screen for cancelled guest meals.
"RTN","FHSEL2",4,0)
 S X="T",%DT="X" D ^%DT S DT=+Y
"RTN","FHSEL2",5,0)
 S FHP=$O(^FH(119.72,0)) I FHP'<1,$O(^FH(119.72,FHP))<1 S FHP=0 G D1
"RTN","FHSEL2",6,0)
D0 R !!,"Select SERVICE POINT (or ALL): ",X:DTIME G:'$T!("^"[X) KIL D:X="all" TR^FH I X="ALL" S FHP=0
"RTN","FHSEL2",7,0)
 E  K DIC S DIC="^FH(119.72,",DIC(0)="EMQ" D ^DIC G:Y<1 D0 S FHP=+Y
"RTN","FHSEL2",8,0)
D1 R !!,"Tabulate By Menu Specific? N// ",D3:DTIME G:'$T!(D3="^") KIL
"RTN","FHSEL2",9,0)
 S:D3="" D3="N" S X=D3 D TR^FH S D3=X I $P("YES",D3,1)'="",$P("NO",D3,1)'="" W *7,"  Answer YES or NO" G D1
"RTN","FHSEL2",10,0)
 S D3=$E(D3,1) S:D3="Y" D3=D3="Y" I 'D3 S (D1,FHCY,FHDA)="" G R1
"RTN","FHSEL2",11,0)
F1 S %DT("A")="Select Date: ",%DT="AEX" W ! D ^%DT G KIL:"^"[X!$D(DTOUT),F1:Y<1 S (X1,D1)=+Y
"RTN","FHSEL2",12,0)
 I D1<DT W *7,"  [ Must NOT be before TODAY ]" G F1
"RTN","FHSEL2",13,0)
 D E1^FHPRC1 I FHCY<1 W *7,!!,"No MENU CYCLE Defined for that Date!" G F1
"RTN","FHSEL2",14,0)
 I '$D(^FH(116,FHCY,"DA",FHDA,0)) W *7,!!,"MENU CYCLE DAY Not Defined for that Date!" G F1
"RTN","FHSEL2",15,0)
R1 R !!,"Select MEAL (B,N,E or ALL): ",MEAL:DTIME G:'$T!("^"[MEAL) KIL S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHSEL2",16,0)
 I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Select B for Breakfast, N for Noon, E for Evening or ALL for all meals" G R1
"RTN","FHSEL2",17,0)
R2 R !!,"Break Down By Production Diets? N// ",SRT:DTIME G:'$T!(SRT="^") KIL S:SRT="" SRT="N" S X=SRT D TR^FH S SRT=X I $P("YES",SRT,1)'="",$P("NO",SRT,1)'="" W *7,"  Answer YES or NO" G R2
"RTN","FHSEL2",18,0)
 S SRT=$E(SRT,1),SRT=SRT="Y"
"RTN","FHSEL2",19,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHSEL2",20,0)
 I $D(IO("Q")) S FHPGM="Q1^FHSEL2",FHLST="D1^D3^FHP^FHCY^FHDA^MEAL^SRT" D EN2^FH G KIL
"RTN","FHSEL2",21,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHSEL2",22,0)
Q1 ; Printing Tabulated Patient Preference
"RTN","FHSEL2",23,0)
 S FHMLSAV=MEAL
"RTN","FHSEL2",24,0)
 D NOW^%DTC S NOW=%,PG=0
"RTN","FHSEL2",25,0)
 I MEAL'="A" G Q2
"RTN","FHSEL2",26,0)
 F MEAL="B","N","E" D Q2
"RTN","FHSEL2",27,0)
 Q
"RTN","FHSEL2",28,0)
Q2 K ^TMP($J),D G:'D3 Q3
"RTN","FHSEL2",29,0)
 S FHX1=^FH(116,FHCY,"DA",FHDA,0)
"RTN","FHSEL2",30,0)
 I $D(^FH(116.3,D1,0)) S X=^(0) F LL=2:1:4 I $P(X,"^",LL) S $P(FHX1,"^",LL)=$P(X,"^",LL)
"RTN","FHSEL2",31,0)
 S FHX1=$P(FHX1,"^",$F("BNE",MEAL)) I 'FHX1 Q
"RTN","FHSEL2",32,0)
Q3 S:D1="" D1=NOW\1
"RTN","FHSEL2",33,0)
 S TIM=D1\1_$S(MEAL="B":".07",MEAL="N":".11",1:".17")
"RTN","FHSEL2",34,0)
 F WRD=0:0 S WRD=$O(^FH(119.6,WRD)) Q:WRD<1  S X=^(WRD,0) D D2 I D2'="" S WRDN=$P(X,"^",1) D W2
"RTN","FHSEL2",35,0)
 ;process outpatient
"RTN","FHSEL2",36,0)
 ;next recurring
"RTN","FHSEL2",37,0)
 S FHD1=D1-1
"RTN","FHSEL2",38,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>D1)  D
"RTN","FHSEL2",39,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHSEL2",40,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHSEL2",41,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHSEL2",42,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHSEL2",43,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHSEL2",44,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,7) S:FHDIET="" FHDIET=$P(FHKDAT,U,8)
"RTN","FHSEL2",45,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,9) S:FHDIET="" FHDIET=$P(FHKDAT,U,10)
"RTN","FHSEL2",46,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,11)
"RTN","FHSEL2",47,0)
 ...I (FHMLSAV'="A"),(FHMEAL'=FHMLSAV) Q
"RTN","FHSEL2",48,0)
 ...I FHSTAT="C" Q
"RTN","FHSEL2",49,0)
 ...Q:'$D(^FH(119.6,FHW1,0))
"RTN","FHSEL2",50,0)
 ...D W44
"RTN","FHSEL2",51,0)
 ;next guest
"RTN","FHSEL2",52,0)
 F FHKD=D1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>(D1+1))  D
"RTN","FHSEL2",53,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHSEL2",54,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHSEL2",55,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHSEL2",56,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHSEL2",57,0)
 ..I $P(FHKDAT,U,9)="C" Q
"RTN","FHSEL2",58,0)
 ..I (FHMLSAV'="A"),(FHMEAL'=FHMLSAV) Q
"RTN","FHSEL2",59,0)
 ..Q:'$D(^FH(119.6,FHW1,0))
"RTN","FHSEL2",60,0)
 ..D W44
"RTN","FHSEL2",61,0)
 ;next SPECIAL
"RTN","FHSEL2",62,0)
 F FHKD=D1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>(D1+1))  D
"RTN","FHSEL2",63,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHSEL2",64,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHSEL2",65,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHSEL2",66,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHSEL2",67,0)
 ..I (FHMLSAV'="A"),(FHMEAL'=FHMLSAV) Q
"RTN","FHSEL2",68,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHSEL2",69,0)
 ..Q:'$D(^FH(119.6,FHW1,0))
"RTN","FHSEL2",70,0)
 ..D W44
"RTN","FHSEL2",71,0)
 ;print report
"RTN","FHSEL2",72,0)
 G ^FHSEL3
"RTN","FHSEL2",73,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHSEL2",74,0)
W2 I $O(^FHPT("AW",WRD,0))<1 Q
"RTN","FHSEL2",75,0)
 F DFN=0:0 S DFN=$O(^FHPT("AW",WRD,DFN)) Q:DFN<1  S ADM=^(DFN) I ADM>0 D W3
"RTN","FHSEL2",76,0)
 Q
"RTN","FHSEL2",77,0)
W3 S K2=0 Q:'$D(^FHPT(DFN,"A",ADM,0))  S X0=^(0)
"RTN","FHSEL2",78,0)
 S FHORD=$P(X0,"^",2),X1=$P(X0,"^",3) I FHORD<1 S A1=$O(^FHPT(DFN,"A",ADM,"AC",0)) Q:A1=""!(A1>NOW)  D U1 Q:'FHORD  G W4
"RTN","FHSEL2",79,0)
 I X1>1,X1'>TIM D U1 Q:'FHORD
"RTN","FHSEL2",80,0)
 I '$D(^FHPT(DFN,"A",ADM,"DI",FHORD,0)) D U1 Q:'FHORD
"RTN","FHSEL2",81,0)
W4 S X=$G(^FHPT(DFN,"A",ADM,"DI",FHORD,0))
"RTN","FHSEL2",82,0)
 S TC=$P(X,"^",8) Q:TC=""  S PD=$P(X,"^",13) Q:PD=""  S:TC="D" TC="T" Q:'$D(S(TC))  S:D2[TC K2=1 S:K2 SP=S(TC)
"RTN","FHSEL2",83,0)
 S PD=$S('PD:"",$D(^FH(116.2,+PD,0)):$P(^(0),"^",2),1:"") Q:PD=""
"RTN","FHSEL2",84,0)
 I K2 F K=0:0 S K=$O(^FHPT(DFN,"P",K)) Q:K<1  S Z=^(K,0) D
"RTN","FHSEL2",85,0)
 .S FHMLZ2=$P(Z,U,2)
"RTN","FHSEL2",86,0)
 .I FHMLZ2'[MEAL Q
"RTN","FHSEL2",87,0)
 .S QTY=$P(Z,"^",3),Z=+Z
"RTN","FHSEL2",88,0)
 .Q:'$G(Z)
"RTN","FHSEL2",89,0)
 .S:'$D(^TMP($J,"P",Z,PD,SP)) ^TMP($J,"P",Z,PD,SP)=0 S ^(SP)=^(SP)+$S(QTY:QTY,1:1)
"RTN","FHSEL2",90,0)
 Q
"RTN","FHSEL2",91,0)
 ;sets tmp global for outpatient data.
"RTN","FHSEL2",92,0)
W44 S X=^FH(119.6,FHW1,0)
"RTN","FHSEL2",93,0)
 S (PD,TC)=""
"RTN","FHSEL2",94,0)
 S TC=$P(X,"^",5) S:TC="" TC=$P(X,U,6) Q:TC=""
"RTN","FHSEL2",95,0)
 I FHP,TC'=FHP Q
"RTN","FHSEL2",96,0)
 I $D(^FH(119.72,TC,0)) S SP=TC,TC=$P(^FH(119.72,TC,0),U,2)
"RTN","FHSEL2",97,0)
 S:$D(^FH(111,FHDIET,0)) PD=$P(^FH(111,FHDIET,0),U,5) Q:PD=""
"RTN","FHSEL2",98,0)
 S PD=$S('PD:"",$D(^FH(116.2,+PD,0)):$P(^(0),"^",2),1:"") Q:PD=""
"RTN","FHSEL2",99,0)
 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S Z=^(K,0) D
"RTN","FHSEL2",100,0)
 .S FHMLZ2=$P(Z,U,2)
"RTN","FHSEL2",101,0)
 .I FHMLZ2'[MEAL Q
"RTN","FHSEL2",102,0)
 .S QTY=$P(Z,"^",3),Z=+Z
"RTN","FHSEL2",103,0)
 .Q:'$G(Z)
"RTN","FHSEL2",104,0)
 .S:'$D(^TMP($J,"P",Z,PD,SP)) ^TMP($J,"P",Z,PD,SP)=0 S ^(SP)=^(SP)+$S(QTY:QTY,1:1)
"RTN","FHSEL2",105,0)
 Q
"RTN","FHSEL2",106,0)
D2 K S S D2=""
"RTN","FHSEL2",107,0)
 F L=5,6 S XX=$P(X,"^",L) I XX=FHP!('FHP) S:XX S($E("TC",L-4))=XX,D(XX)="",D2=D2_$E("TC",L-4)
"RTN","FHSEL2",108,0)
 Q
"RTN","FHSEL2",109,0)
U1 S (A1,FHORD)=0 F K=0:0 S K=$O(^FHPT(DFN,"A",ADM,"AC",K)) Q:K<1!(K>TIM)  S A1=K
"RTN","FHSEL2",110,0)
 Q:'A1  S X1=$P(^FHPT(DFN,"A",ADM,"AC",A1,0),"^",2) G U2:X1<1,U2:'$D(^FHPT(DFN,"A",ADM,"DI",X1,0)) S FHORD=X1 Q
"RTN","FHSEL2",111,0)
U2 S X1="",A1=0
"RTN","FHSEL2",112,0)
U3 S A1=$O(^FHPT(DFN,"A",ADM,"AC",A1)) G:A1="" U1 S X2=$P(^(A1,0),"^",2)
"RTN","FHSEL2",113,0)
 I X2<1 K ^FHPT(DFN,"A",ADM,"AC",A1) G U3
"RTN","FHSEL2",114,0)
 I '$D(^FHPT(DFN,"A",ADM,"DI",X2,0)) K ^FHPT(DFN,"A",ADM,"AC",A1) G U3
"RTN","FHSEL2",115,0)
 G U3
"RTN","FHSP")
0^15^B75662627
"RTN","FHSP",1,0)
FHSP ; HISC/REL/NCA - Standing Orders ;2/13/95  14:30 
"RTN","FHSP",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSP",3,0)
 ;11/04/05 - SO PATCH
"RTN","FHSP",4,0)
EN1 ; Enter/Edit Standing Orders
"RTN","FHSP",5,0)
 K DIC W ! S (DIC,DIE)="^FH(118.3,",DIC(0)="AEQLM",DIC("DR")=".01",DLAYGO=118.3 W ! D ^DIC K DIC,DLAYGO G KIL:U[X!$D(DTOUT),EN1:Y<1
"RTN","FHSP",6,0)
 S DA=+Y,DR=".01:99" S:$D(^XUSEC("FHMGR",DUZ)) DIDEL=118.3 D ^DIE K DA,DIE,DIDEL,DR G EN1
"RTN","FHSP",7,0)
EN2 ; List Standing Orders
"RTN","FHSP",8,0)
 W ! S L=0,DIC="^FH(118.3,",FLDS=".01,99,1",BY="NAME"
"RTN","FHSP",9,0)
 S FR="",TO="",DHD="STANDING ORDERS" D EN1^DIP
"RTN","FHSP",10,0)
 K %ZIS S IOP="" D ^%ZIS G KIL
"RTN","FHSP",11,0)
SO ;OutPT SO
"RTN","FHSP",12,0)
 S FHSOOP=$O(^FHPT(FHDFN,"OP","B",DT-1))
"RTN","FHSP",13,0)
 I '$D(^FHPT(FHDFN,"OP"))!'$G(FHSOOP) W !!,"** NO OUTPATIENT DATA ON FILE!  Please enter outpatient meals from Recurring Meals Menu [FHOMRMGR]." Q
"RTN","FHSP",14,0)
 W @IOF,!,"Outpatient Recurring Meals... "
"RTN","FHSP",15,0)
A0 ;Rec Meal entry.
"RTN","FHSP",16,0)
 K FHDM14,FHEDI,FHEDIF,FHIEN,FHMIEN,FHFLG,FHCK
"RTN","FHSP",17,0)
 S FHQ=0
"RTN","FHSP",18,0)
 S (FHTOTML("B"),FHTOTML("N"),FHTOTML("E"),FHTOTML("A"))=0
"RTN","FHSP",19,0)
 F FHI=DT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:FHI'>0!FHQ  F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0!FHQ  I ($P($G(^FHPT(FHDFN,"OP",FHJ,0)),U,15)'="C") D
"RTN","FHSP",20,0)
 .S FHDA15=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHSP",21,0)
 .S FHDM14(FHI,$P(FHDA15,U,4))=FHI_U_FHJ
"RTN","FHSP",22,0)
 .S FHMEAL=$P(FHDA15,U,4),FHLOC=$P(FHDA15,U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL="B":"Break",FHMEAL="N":"Noon",1:"Even"),FH11=FHMEAL_"  "_FHLOCN
"RTN","FHSP",23,0)
 .S Y=$P(FHDA15,U,1) X ^DD("DD") S DTP=Y
"RTN","FHSP",24,0)
 .S (FHCOFLG,FHDATL)=0
"RTN","FHSP",25,0)
 .I $Y>(IOSL-5) K DIR S DIR(0)="E",DIR("A")="Enter RETURN to Continue or '^' to Quit Listing"  D ^DIR W:Y @IOF I 'Y S FHQ=1 Q
"RTN","FHSP",26,0)
 .W !,DTP,?12,FH11,":"
"RTN","FHSP",27,0)
 .S FHDATL=$L(DTP)+13+$L(FH11)
"RTN","FHSP",28,0)
 .F FHSF=0:0 S FHSF=$O(^FHPT(FHDFN,"OP",FHJ,"SP",FHSF)) Q:FHSF'>0  D
"RTN","FHSP",29,0)
 ..S FHDA15SF=$G(^FHPT(FHDFN,"OP",FHJ,"SP",FHSF,0))
"RTN","FHSP",30,0)
 ..Q:$P(FHDA15SF,U,6)
"RTN","FHSP",31,0)
 ..S FHDASFNM=$P($G(^FH(118.3,$P(FHDA15SF,U,2),0)),U,1),FHDASFQT=$P(FHDA15SF,U,8)
"RTN","FHSP",32,0)
 ..I (FHDATL+$L(FHDASFNM)+3+$L(FHDASFQT))>79 W !,?19 S FHDATL=19
"RTN","FHSP",33,0)
 ..I (FHDATL>19),(FHCOFLG=1) W ","
"RTN","FHSP",34,0)
 ..S FHDATL=FHDATL+4+$L(FHDASFNM)+3+$L(FHDASFQT)
"RTN","FHSP",35,0)
 ..W " ",FHDASFNM," = ",FHDASFQT
"RTN","FHSP",36,0)
 ..S FHCOFLG=1
"RTN","FHSP",37,0)
 F FHI=0:0 S FHI=$O(FHDM14(FHI)) Q:FHI'>0  D
"RTN","FHSP",38,0)
 .F FHJ="B","N","E" Q:FHJ=""  D
"RTN","FHSP",39,0)
 ..I (FHJ="B")&$D(FHDM14(FHI,FHJ)) S FHTOTML("B")=FHTOTML("B")+1,FHIEN(FHJ)=FHDM14(FHI,FHJ)
"RTN","FHSP",40,0)
 ..I (FHJ="N")&$D(FHDM14(FHI,FHJ)) S FHTOTML("N")=FHTOTML("N")+1,FHIEN(FHJ)=FHDM14(FHI,FHJ)
"RTN","FHSP",41,0)
 ..I (FHJ="E")&$D(FHDM14(FHI,FHJ)) S FHTOTML("E")=FHTOTML("E")+1,FHIEN(FHJ)=FHDM14(FHI,FHJ)
"RTN","FHSP",42,0)
 I '$D(FHDM14) W !!,"NO OUTPATIENT DATA ON FILE for today's date and the future!!",! Q
"RTN","FHSP",43,0)
 ;
"RTN","FHSP",44,0)
R1 S (FHCNSOF,FH1,FHQ)=0,(FHDTML,FHX,FHALML)="" R !!,"Enter a Meal (B,N,E or ALL): ALL// ",FHDTML:DTIME
"RTN","FHSP",45,0)
 Q:'$T!(FHDTML["^")
"RTN","FHSP",46,0)
 S:FHDTML="" FHDTML="ALL"
"RTN","FHSP",47,0)
 I FHDTML["?" S FHQ=1 G MS1
"RTN","FHSP",48,0)
 S X=FHDTML D TR^FH S (FHX,FHDTML)=X
"RTN","FHSP",49,0)
 I FHDTML="A" S FHQ=1 G MS1
"RTN","FHSP",50,0)
 S FHALML=FHX
"RTN","FHSP",51,0)
 I FHDTML="ALL" S FHDTML=$E(FHDTML,1),FHALML="BNE"
"RTN","FHSP",52,0)
 I $L(FHDTML)=3 S:("BNE")'[$E(FHDTML,1) FHQ=1 S:("BNE")'[$E(FHDTML,2) FHQ=1 S:("BNE")'[$E(FHDTML,3) FHQ=1 S FHCK($E(FHDTML,1))="",FHCK($E(FHDTML,2))="",FHCK($E(FHDTML,3))=""
"RTN","FHSP",53,0)
 I $L(FHDTML)=2 S:("BNE")'[$E(FHDTML,1) FHQ=1 S:("BNE")'[$E(FHDTML,2) FHQ=1 S FHCK($E(FHDTML,1))="",FHCK($E(FHDTML,2))=""
"RTN","FHSP",54,0)
 I $L(FHDTML)=1 S:("ABNE")'[$E(FHDTML,1) FHQ=1 S FHCK(FHDTML)=""
"RTN","FHSP",55,0)
 I FHDTML="A" S (FHCK("B"),FHCK("N"),FHCK("E"))=""
"RTN","FHSP",56,0)
 S:$L(FHDTML)>3 FHQ=1
"RTN","FHSP",57,0)
 G:FHQ MS1
"RTN","FHSP",58,0)
 I $L(FHDTML)=3 S:'$G(FHTOTML($E(FHDTML,1))) FH1=1 S:'$G(FHTOTML($E(FHDTML,2))) FH1=1 S:'$G(FHTOTML($E(FHDTML,3))) FH1=1 I FH1 W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHSP",59,0)
 I $L(FHDTML)=2 S:'$G(FHTOTML($E(FHDTML,1))) FH1=1 S:'$G(FHTOTML($E(FHDTML,2))) FH1=1 I FH1 W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHSP",60,0)
MS1 I FHQ W *7,!,"Select B for Breakfast, N for Noon, E for Evening or ALL for all meals",!,"Answer may be multiple meals, e.g., BN or NE" G R1
"RTN","FHSP",61,0)
 S:$L(FHDTML)>1 FHDTML="A"
"RTN","FHSP",62,0)
 S FHLIS=0
"RTN","FHSP",63,0)
 I (FHDTML'="A"),(FHTOTML(FHDTML)'>0) W !!,"There is no outpatient data for this Meal!!" G R1
"RTN","FHSP",64,0)
 I FHDTML'="A",(FHTOTML(FHDTML)=1) S FHEDI($P(FHIEN(FHDTML),U,2))="" G E0
"RTN","FHSP",65,0)
 I FHDTML="A" G ALL
"RTN","FHSP",66,0)
 I FHDTML'="A",(FHTOTML(FHDTML)>1) D CHK^FHSPED Q:'$G(FHFLG)   ;quit dates are not entered for range.
"RTN","FHSP",67,0)
 I $G(FHFLG) F FHI=FHDT1-1:0 S FHI=$O(FHDM14(FHI)) Q:(FHI'>0)!(FHI>FHDT2)  S:$D(FHDM14(FHI,FHDTML)) FHEDI($P(FHDM14(FHI,FHDTML),U,2))=""
"RTN","FHSP",68,0)
 G E0
"RTN","FHSP",69,0)
ALL S FHCT=0,(FHDT1,FHDT2,FHDTSV)=DT F FHI=DT-1:0 S FHI=$O(FHDM14(FHI)) S:'FHI FHDT2=FHDTSV Q:FHI'>0  S FHCT=FHCT+1,FHDTSV=FHI S:FHCT=1 FHDT1=FHI S FHJ="" F  S FHJ=$O(FHDM14(FHI,FHJ)) Q:FHJ=""  S FHEDI($P(FHDM14(FHI,FHJ),U,2))=""
"RTN","FHSP",70,0)
E0 S ADM=0
"RTN","FHSP",71,0)
E1 W ! S FHLOCN="",ADM=$O(FHEDI(ADM)) Q:'ADM  S NO=1,MEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4),FHLOC=$P($G(^(0)),U,3)
"RTN","FHSP",72,0)
 I FHX'="ALL",FHX'[MEAL G E1
"RTN","FHSP",73,0)
 I $G(FHLOC) S FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHSP",74,0)
 D LIS G:'LN N1
"RTN","FHSP",75,0)
 K DIR W ! S DIR(0)="YA",DIR("A")="Edit a Standing Order? ",DIR("B")="YES" D ^DIR K DIR Q:$D(DIRUT)!$D(DIROUT)  G N1:Y<1
"RTN","FHSP",76,0)
N0 R !!,"Edit which Order #? ",X:DTIME Q:'$T!("^"[X)  I X'?1N.N!(X<1)!(X>LN) W *7," Enter # of Order to Edit" G N0
"RTN","FHSP",77,0)
 S SP=$P(LS,",",+X),SP=$P($G(^FHPT(FHDFN,"OP",ADM,"SP",+SP,0)),"^",2) I $D(P(+X,SP)) S LN=+X  G N1A
"RTN","FHSP",78,0)
 W !!,"Standing Order ",$P($G(^FH(118.3,+SP,0)),"^",1)," added" S LN=LN+1,P(LN,SP)="" G N1A
"RTN","FHSP",79,0)
N1 K DIC W ! S DIC="^FH(118.3,",DIC("A")="Enter Standing Order: ",DIC(0)="AEQM"
"RTN","FHSP",80,0)
 D ^DIC K DIC,DLAYGO Q:"^"[X!$D(DTOUT)  G SO:Y<1 S SP=+Y
"RTN","FHSP",81,0)
 W !!,"Standing Order ",$P($G(^FH(118.3,+SP,0)),"^",1)," added"
"RTN","FHSP",82,0)
 S LN=LN+1,P(LN,SP)=""
"RTN","FHSP",83,0)
N1A W !,"Standing Order: ",$P($G(^FH(118.3,+SP,0)),"^",1)_" // " R X:DTIME G KIL:'$T
"RTN","FHSP",84,0)
 I X="^" G E0
"RTN","FHSP",85,0)
 I X="@" D SO3 W "  .. Done" G E0
"RTN","FHSP",86,0)
 I X'="" W *7,!,"Press Return to take Default or ""@"" to Delete" G N1A
"RTN","FHSP",87,0)
 S $P(P(LN,SP),"^",5)=SP
"RTN","FHSP",88,0)
N2 ;
"RTN","FHSP",89,0)
 S $P(P(LN,SP),"^",6)=MEAL
"RTN","FHSP",90,0)
N2A W !,"Quantity:  ",$S($P(P(LN,SP),"^",4):$P(P(LN,SP),"^",4)_"// ",1:"1// ") R NUM:DTIME S:NUM="" NUM=$S($P(P(LN,SP),"^",4):$P(P(LN,SP),"^",4),1:1) G:'$T!(NUM="^") KIL
"RTN","FHSP",91,0)
 I NUM="@" S $P(P(LN,SP),"^",4)="" G N2A
"RTN","FHSP",92,0)
 I NUM'?1N!(NUM<1) W !,*7,"Enter a number from 1-9." G N2A
"RTN","FHSP",93,0)
 S $P(P(LN,SP),"^",7)=NUM
"RTN","FHSP",94,0)
 S C1=$P(P(LN,SP),"^",2,4),C2=$P(P(LN,SP),"^",5,7)
"RTN","FHSP",95,0)
 Q:C1=C2
"RTN","FHSP",96,0)
N3 W !!,"ADD this Order? Y// " R YN:DTIME G:'$T!(YN="^") KIL S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7,"  Answer YES or NO" G N3
"RTN","FHSP",97,0)
 Q:YN?1"N".E
"RTN","FHSP",98,0)
 I C1'="^^" S OLD=$P(P(LN,SP),"^",1),$P(^FHPT(FHDFN,"OP",ADM,"SP",OLD,0),"^",6,7)=NOW_"^"_DUZ K ^FHPT("ASPO",FHDFN,ADM,OLD) D
"RTN","FHSP",99,0)
 .S DTP=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,1) D DTP^FH
"RTN","FHSP",100,0)
 .S FHACT="O",FHTXT="Outpatient Standing Order: "_NUM_" "_$P($G(^FH(118.3,SP,0)),U,1)_" ("_MEAL_"), "_FHLOCN_", "_DTP D OPFILE^FHORX Q
"RTN","FHSP",101,0)
 S $P(P(LN,SP),"^",2,4)="^^",$P(P(LN,SP),"^",2,4)=$P(P(LN,SP),"^",5,7),$P(P(LN,SP),"^",5,7)="^^"
"RTN","FHSP",102,0)
ADD ; Add SO
"RTN","FHSP",103,0)
 F FHI=0:0 S FHI=$O(FHEDI(FHI)) Q:FHI'>0  S ADM=FHI D AD1
"RTN","FHSP",104,0)
 D EVNT^FHSP1
"RTN","FHSP",105,0)
 G E0
"RTN","FHSP",106,0)
AD1 L +^FHPT(FHDFN,"OP",ADM,"SP",0)
"RTN","FHSP",107,0)
 S FHLOCN="" S:'$D(FHCNSOF) FHCNSOF=0
"RTN","FHSP",108,0)
 S MEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4) Q:'$D(FHCK(MEAL))
"RTN","FHSP",109,0)
 S FHLOC=$P($G(^(0)),U,3) I $G(FHLOC) S FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHSP",110,0)
 I '$D(^FHPT(FHDFN,"OP",ADM,"SP",0)) S ^FHPT(FHDFN,"OP",ADM,"SP",0)="^115.1626^^"
"RTN","FHSP",111,0)
 S X=^FHPT(FHDFN,"OP",ADM,"SP",0),NO=$P(X,"^",3)+1,^(0)=$P(X,"^",1,2)_"^"_NO_"^"_($P(X,"^",4)+1)
"RTN","FHSP",112,0)
 L -^FHPT(FHDFN,"OP",ADM,"SP",0) I $D(^FHPT(FHDFN,"OP",ADM,"SP",NO)) G AD1
"RTN","FHSP",113,0)
 S ^FHPT(FHDFN,"OP",ADM,"SP",NO,0)=NO_"^"_SP_"^"_MEAL_"^"_NOW_"^"_DUZ_"^^^"_NUM,^FHPT("ASPO",FHDFN,ADM,NO)="",LS=LS_NO_","
"RTN","FHSP",114,0)
 S $P(P(LN,SP),"^",1)=NO
"RTN","FHSP",115,0)
 S DTP=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,1) D DTP^FH S FHCNSOF=FHCNSOF+1 S:FHCNSOF=1 FHDTP=DTP
"RTN","FHSP",116,0)
 Q
"RTN","FHSP",117,0)
SO2 ; SO Inquiry
"RTN","FHSP",118,0)
 Q:'$G(ADM)
"RTN","FHSP",119,0)
 S ALL=1 D ^FHOMDPA G:'FHDFN KIL S NO=0 D LIS G SO2
"RTN","FHSP",120,0)
SO3 ; Cancel SO
"RTN","FHSP",121,0)
 S (FHLOCN,FHDTP)="" S:'$D(FHCNSOF) FHCNSOF=0
"RTN","FHSP",122,0)
 F FHI=0:0 S FHI=$O(FHEDI(FHI)) Q:FHI'>0  S ADM=FHI D
"RTN","FHSP",123,0)
 .S MEAL=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,4) Q:'$D(FHCK(MEAL))
"RTN","FHSP",124,0)
 .S FHLOCN=""
"RTN","FHSP",125,0)
 .S FHLOC=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,3) I $G(FHLOC) S FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHSP",126,0)
 .F FHJ=0:0 S FHJ=$O(^FHPT(FHDFN,"OP",ADM,"SP",FHJ)) Q:FHJ'>0  D
"RTN","FHSP",127,0)
 ..S SPD=$P($G(^FHPT(FHDFN,"OP",ADM,"SP",FHJ,0)),U,2)
"RTN","FHSP",128,0)
 ..S NO=""
"RTN","FHSP",129,0)
 ..I SP=SPD,$P($G(^FHPT(FHDFN,"OP",ADM,"SP",FHJ,0)),U,6)="" S NO=FHJ
"RTN","FHSP",130,0)
 ..Q:'NO
"RTN","FHSP",131,0)
 ..S $P(^FHPT(FHDFN,"OP",ADM,"SP",NO,0),"^",6,7)=NOW_"^"_DUZ
"RTN","FHSP",132,0)
 ..S X=^FHPT(FHDFN,"OP",ADM,"SP",NO,0),SP=$P(X,"^",2),MEAL=$P(X,"^",3),NUM=$P(X,"^",8)
"RTN","FHSP",133,0)
 ..K ^FHPT("ASPO",FHDFN,ADM,NO),P(LN,SP)
"RTN","FHSP",134,0)
 ..S DTP=$P($G(^FHPT(FHDFN,"OP",ADM,0)),U,1) D DTP^FH S FHDTP=DTP
"RTN","FHSP",135,0)
 S:'$D(FHDTP) FHDTP=DT
"RTN","FHSP",136,0)
 I $D(FHDT1) S DTP=FHDT1 D DTP^FH S FHDTP=DTP
"RTN","FHSP",137,0)
 I $D(FHDT2) S DTP=FHDT2 D DTP^FH S:FHDTP'=DTP FHDTP=FHDTP_" to "_DTP
"RTN","FHSP",138,0)
 S FHACT="C",FHTXT="Outpatient Standing Order:  "_$P($G(^FH(118.3,SP,0)),U,1)_" ("_FHALML_"), "_FHLOCN_", Cancelled "_FHDTP D OPFILE^FHORX
"RTN","FHSP",139,0)
 Q
"RTN","FHSP",140,0)
LIS ;list outpt SO
"RTN","FHSP",141,0)
 Q:'$G(ADM)
"RTN","FHSP",142,0)
 D PATNAME^FHOMUTL
"RTN","FHSP",143,0)
 S FHDATA0=$G(^FHPT(FHDFN,"OP",ADM,0))
"RTN","FHSP",144,0)
 S DTP=$P(FHDATA0,U,1) D DTP^FH S FHDTST=DTP
"RTN","FHSP",145,0)
 S NAM=FHPTNM,Y="",(FHDIETP,FHDIET,WARD)=""
"RTN","FHSP",146,0)
 S FHDIET=$P(FHDATA0,U,2) I $D(^FH(119.6,$P(FHDATA0,U,3),0)) S WARD=$P(^FH(119.6,$P(FHDATA0,U,3),0),U,1)
"RTN","FHSP",147,0)
 I $G(FHDIET) S Y=$P(^FH(111,FHDIET,0),U,1)
"RTN","FHSP",148,0)
 I FHDIET="" S FHRNUM=ADM D DIETPAT^FHOMRR1 S:$D(FHDIETP) Y=FHDIETP
"RTN","FHSP",149,0)
 W !!,NAM,"  " W:WARD'="" "( ",WARD," )" W:$D(FHDTST) ?40,"Date: ",FHDTST
"RTN","FHSP",150,0)
 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHSP",151,0)
 K N,P S CTR=0
"RTN","FHSP",152,0)
 F K=0:0 S K=$O(^FHPT("ASPO",FHDFN,ADM,K)) Q:K<1  S X=^FHPT(FHDFN,"OP",ADM,"SP",K,0),M=$P(X,"^",3),M=$S(M="BNE":"A",1:$E(M,1)),N(M,K)=$P(X,"^",2,3)_"^"_$P(X,"^",8,9)
"RTN","FHSP",153,0)
 S FHSOFG=1
"RTN","FHSP",154,0)
 S LN=0,LS="" I $O(N(""))="" W !!,"No Active Outpatient Standing Orders." Q
"RTN","FHSP",155,0)
 W !!,"Active Outpatient Standing Orders: ",!
"RTN","FHSP",156,0)
 F M="A","B","N","E" D
"RTN","FHSP",157,0)
 .F K=0:0 S K=$O(N(M,K)) Q:K<1  S Z=+N(M,K) I Z D
"RTN","FHSP",158,0)
 ..S LN=LN+1,LS=LS_K_"," D L1 W ! W:NO $J(LN,2)
"RTN","FHSP",159,0)
 ..S NUM=$P(N(M,K),"^",3)
"RTN","FHSP",160,0)
 ..W ?5,M2,?18,$S(NUM:NUM,1:1)," ",$P(^FH(118.3,Z,0),"^",1)_$S($P(N(M,K),"^",4)'="Y":" (I)",1:"") I $G(^FH(118.3,Z,"I"))="Y" W "     (** INACTIVE **)"
"RTN","FHSP",161,0)
 ..S P(LN,+Z)=K_"^"_$P(N(M,K),"^",1,3) Q
"RTN","FHSP",162,0)
 Q
"RTN","FHSP",163,0)
L1 ; Store SO
"RTN","FHSP",164,0)
 S M1=$P(N(M,K),"^",2) I M1="BNE" S M2="All Meals" Q
"RTN","FHSP",165,0)
 S L=$E(M1,1),M2=$S(L="B":"Break",L="N":"Noon",1:"Even")
"RTN","FHSP",166,0)
 S L=$E(M1,2) Q:L=""  S M2=M2_","_$S(L="B":"Break",L="N":"Noon",1:"Even") Q
"RTN","FHSP",167,0)
 Q
"RTN","FHSP",168,0)
KIL G KILL^XUSCLEAN
"RTN","FHSP1")
0^16^B44709788
"RTN","FHSP1",1,0)
FHSP1 ; HISC/NCA - Consolidated Standing Orders List ;7/28/94  12:59 
"RTN","FHSP1",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSP1",3,0)
 ;11/09/05 - modified for SO patch
"RTN","FHSP1",4,0)
 ;if FHOPT=1, it's consolidated
"RTN","FHSP1",5,0)
 ;if FHOPT=2,it's print labels
"RTN","FHSP1",6,0)
 ;if FHOPT=3, it's tabulated 
"RTN","FHSP1",7,0)
E1 ; Set Consolidated List flag
"RTN","FHSP1",8,0)
 S FHOPT=1 G E3
"RTN","FHSP1",9,0)
E2 ; Set Print Label flag
"RTN","FHSP1",10,0)
 S FHOPT=2
"RTN","FHSP1",11,0)
E3 S FHP=$O(^FH(119.72,0)) I FHP'<1,$O(^FH(119.72,FHP))<1 G D2
"RTN","FHSP1",12,0)
D0 R !!,"Select SERVICE POINT (or ALL): ",X:DTIME G:'$T!("^"[X) KIL D:X="all" TR^FH I X="ALL" S FHP=0
"RTN","FHSP1",13,0)
 E  K DIC S DIC="^FH(119.72,",DIC(0)="EMQ" D ^DIC G:Y<1 D0 S FHP=+Y
"RTN","FHSP1",14,0)
D2 R !!,"Select Meal (B,N,E,or ALL): ",MEAL:DTIME G:'$T!(U[MEAL) KIL S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHSP1",15,0)
 I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Enter B for Breakfast, N for Noon, E for Evening or ALL for all meals" G D2
"RTN","FHSP1",16,0)
 S D3="" G:FHOPT=2 D5
"RTN","FHSP1",17,0)
D3 R !!,"Consolidated List Only? Y//",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G D3
"RTN","FHSP1",18,0)
 S X=$E(X,1),D3=1 S:X="Y" D3=D3+1
"RTN","FHSP1",19,0)
D5 W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHSP1",20,0)
 Q:$D(DIRUT)  S LABSTART=Y
"RTN","FHSP1",21,0)
 W:'D3 !!,"Place Labels in Printer"
"RTN","FHSP1",22,0)
PR K IOP S %ZIS="MQ",%ZIS("A")="Select "_$S('D3:"LABEL",1:"LIST")_" Printer: " W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHSP1",23,0)
 I $D(IO("Q")) S FHPGM="Q1^FHSP1",FHLST="D3^FHOPT^FHP^MEAL^LABSTART" D EN2^FH G KIL
"RTN","FHSP1",24,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHSP1",25,0)
Q1 ; Print Standing Orders List or Labels
"RTN","FHSP1",26,0)
 K ^TMP($J),C,D,N S (CHK,N1,PG)=0 D NOW^%DTC S NOW=%,DT=%\1
"RTN","FHSP1",27,0)
 S COUNT=0,LINE=1,DTP=NOW D DTP^FH S DTR=DTP
"RTN","FHSP1",28,0)
 I FHOPT=2 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHSP1",29,0)
 S FHMLSAV=MEAL
"RTN","FHSP1",30,0)
 I MEAL="A" S MEAL="B" D Q2 S MEAL="N" D Q2 S MEAL="E"
"RTN","FHSP1",31,0)
 D Q2
"RTN","FHSP1",32,0)
 I $G(LAB)>2 D DPLL^FHLABEL Q
"RTN","FHSP1",33,0)
 F L=1:1:$S('D3:18,1:1) W !
"RTN","FHSP1",34,0)
 Q
"RTN","FHSP1",35,0)
Q2 S T0=NOW\1_$S(MEAL="B":".07",MEAL="N":".11",1:".17"),TT=0
"RTN","FHSP1",36,0)
 F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D DP I DP'="" D P0 F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  S ADM=^FHPT("AW",W1,FHDFN) D ADD
"RTN","FHSP1",37,0)
 ;check and include outpatient stnading orders.
"RTN","FHSP1",38,0)
 D ADDO
"RTN","FHSP1",39,0)
 ;
"RTN","FHSP1",40,0)
 G:FHOPT=2 ^FHSP11
"RTN","FHSP1",41,0)
 S DTP=DT D DTP^FH S DTE=DTP_" "_$S(MEAL="B":"Break",MEAL="N":"Noon",1:"Even")
"RTN","FHSP1",42,0)
 G:D3=2 CON
"RTN","FHSP1",43,0)
 K S F K=0:0 S K=$O(D(K)) Q:K=""  S X=$G(^FH(119.72,K,0)),N2=$P(X,"^",1),N3=$P(X,"^",4) S:N3="" N3=$E(N2,1,6) S S(N3,K)=$E(N3,1,6)
"RTN","FHSP1",44,0)
 S A1="" F  S A1=$O(S(A1)) Q:A1=""  F K=0:0 S K=$O(S(A1,K)) Q:K=""  S N2=$G(S(A1,K)) D LST
"RTN","FHSP1",45,0)
 K C,D,N Q
"RTN","FHSP1",46,0)
ADD Q:ADM<1
"RTN","FHSP1",47,0)
 D CHK I K2 F K2=0:0 S K2=$O(^FHPT("ASP",FHDFN,ADM,K2)) Q:K2<1  S Y=^FHPT(FHDFN,"A",ADM,"SP",K2,0) D A1
"RTN","FHSP1",48,0)
 Q
"RTN","FHSP1",49,0)
 ;
"RTN","FHSP1",50,0)
A1 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHSP1",51,0)
 S Y=$P(Y,"^",2,3)_"^"_$P(Y,"^",8) Q:Y?."^"  I FHOPT=2 S Y=Y_"^"_IS,RM=$G(^DPT(DFN,.101)),WRD=P0_$E(WRDN,1,27-$L(RM))_"/"_RM,^TMP($J,"SOL",SP,WRD,FHDFN,K2)=Y Q
"RTN","FHSP1",52,0)
 S FHORD=$P(Y,"^",1),M1=$P(Y,"^",2)
"RTN","FHSP1",53,0)
 I FHORD,M1[MEAL S:'$D(N(FHORD,SP)) N(FHORD,SP)=0 S Q=$P(Y,"^",3),N(FHORD,SP)=N(FHORD,SP)+$S(Q:Q,1:1) S:'$D(C(MEAL,SP)) C(MEAL,SP)=0 I TT'=FHDFN S C(MEAL,SP)=C(MEAL,SP)+1,TT=FHDFN
"RTN","FHSP1",54,0)
 Q
"RTN","FHSP1",55,0)
CHK S K2=0,X1=$G(^FHPT(FHDFN,"A",ADM,0)),FHORD=$P(X1,"^",2),IS=$P(X1,"^",10),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHSP1",56,0)
 I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHSP1",57,0)
 I X1>1,X1'>T0 G C2
"RTN","FHSP1",58,0)
C0 I '$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHSP1",59,0)
 S X1=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",8) I X1="" G C1
"RTN","FHSP1",60,0)
 S:X1="D" X1="T" Q:'$D(S(X1))  S:DP[X1 K2=1 S:K2 SP=S(X1)
"RTN","FHSP1",61,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHSP1",62,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"AC",K)) Q:K<1!(K>T0)  S A1=K
"RTN","FHSP1",63,0)
 G:'A1 C1 S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0 K ^FHPT(FHDFN,"A",ADM,"AC",A1) G C2
"RTN","FHSP1",64,0)
 ;
"RTN","FHSP1",65,0)
DP K S S DP=""
"RTN","FHSP1",66,0)
 F L=5,6 S X=$P($G(^FH(119.6,W1,0)),"^",L) I X=FHP!('FHP) S:X S($E("TC",L-4))=X,D(X)="",DP=DP_$E("TC",L-4)
"RTN","FHSP1",67,0)
 Q
"RTN","FHSP1",68,0)
P0 S X=^FH(119.6,W1,0),P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0),WRDN=$P(X,"^",1) Q
"RTN","FHSP1",69,0)
 ;
"RTN","FHSP1",70,0)
LST D HDR1 S NX="" F  S NX=$O(^FH(118.3,"B",NX)) Q:NX=""  F KK=0:0 S KK=$O(^FH(118.3,"B",NX,KK)) Q:KK<1  S Z=$G(N(KK,K)) D:$Y>(IOSL-6) HDR1 I Z W !?(80-30\2),$J(Z,6)," ",$P(^FH(118.3,KK,0),"^",1)
"RTN","FHSP1",71,0)
 S N1=N1+$G(C(MEAL,K))
"RTN","FHSP1",72,0)
 D PP S N1=0 Q
"RTN","FHSP1",73,0)
CON K S S L1=36
"RTN","FHSP1",74,0)
 F K=0:0 S K=$O(D(K)) Q:K=""  S X=^FH(119.72,K,0),N2=$P(X,"^",1),N3=$P(X,"^",4) S:N3="" N3=$E(N2,1,6) S S(N3,K)=$J(N3,8),L1=L1+8
"RTN","FHSP1",75,0)
 S:L1<80 L1=80 D HDR
"RTN","FHSP1",76,0)
 S NX="" F  S NX=$O(^FH(118.3,"B",NX)) Q:NX=""  F KK=0:0 S KK=$O(^FH(118.3,"B",NX,KK)) Q:KK<1  I $D(N(KK)) D SOR
"RTN","FHSP1",77,0)
 W !!,"# OF PATIENTS",?31
"RTN","FHSP1",78,0)
 S X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  S Z=$G(C(MEAL,K)) W $S(Z:$J(Z,6),1:$J("",6)),"  " S N1=N1+Z
"RTN","FHSP1",79,0)
 W $S(N1:$J(N1,6),1:$J("",6))
"RTN","FHSP1",80,0)
 S N1=0 K C,D,N Q
"RTN","FHSP1",81,0)
SOR D:$Y>(IOSL-6) HDR
"RTN","FHSP1",82,0)
 W !,$P($G(^FH(118.3,KK,0)),"^",1),?31
"RTN","FHSP1",83,0)
 S Z1=0,X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  S Z=$G(N(KK,K)) W $S(Z:$J(Z,6),1:$J("",6)),"  " S Z1=Z1+Z
"RTN","FHSP1",84,0)
 W $S(Z1:$J(Z1,6),1:$J("",6))
"RTN","FHSP1",85,0)
 Q
"RTN","FHSP1",86,0)
PP W !!?(80-21\2),"**** PATIENTS = ",N1," ****",! Q
"RTN","FHSP1",87,0)
HDR ; Header for Consolidated List
"RTN","FHSP1",88,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHSP1",89,0)
 W !,DTR,?(L1-11),"Page ",PG,!!?(L1-55\2),"C O N S O L I D A T E D   S T A N D I N G   O R D E R S",!!?(L1-$L(DTE)\2),DTE,!!?29
"RTN","FHSP1",90,0)
 S X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  W S(X,K)
"RTN","FHSP1",91,0)
 W "   TOTAL",! Q
"RTN","FHSP1",92,0)
HDR1 ; Header for Standing Order List
"RTN","FHSP1",93,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1 W !,DTR,?69,"Page ",PG,!!?20,"S T A N D I N G   O R D E R S   L I S T"
"RTN","FHSP1",94,0)
 W !?(80-$L(N2)\2),N2,!?(80-$L(DTE)\2),DTE,! Q
"RTN","FHSP1",95,0)
 ;
"RTN","FHSP1",96,0)
ADDO ;process outpatient STANDING ORDER for consolidated, print labels and tabulated reports.
"RTN","FHSP1",97,0)
 S IS=""
"RTN","FHSP1",98,0)
 F FHI=0:0 S FHI=$O(^FHPT("ASPO",FHI)) Q:FHI'>0  F FHJ=0:0 S FHJ=$O(^FHPT("ASPO",FHI,FHJ)) Q:FHJ'>0  D
"RTN","FHSP1",99,0)
 .S FHOPDAT=^FHPT(FHI,"OP",FHJ,0)
"RTN","FHSP1",100,0)
 .S FHDATE=$P(FHOPDAT,U,1)
"RTN","FHSP1",101,0)
 .Q:$P(FHOPDAT,U,15)="C"
"RTN","FHSP1",102,0)
 .Q:FHDATE'=DT
"RTN","FHSP1",103,0)
 .S RM="",RMIEN=$P(FHOPDAT,U,18) I $G(RMIEN),$D(^DG(405.4,RMIEN,0)) S RM=$E($P(^DG(405.4,RMIEN,0),U,1),1,10)
"RTN","FHSP1",104,0)
 .S FHLOC=$P(FHOPDAT,U,3)
"RTN","FHSP1",105,0)
 .F K2=0:0 S K2=$O(^FHPT("ASPO",FHI,FHJ,K2)) Q:K2'>0  D
"RTN","FHSP1",106,0)
 ..S Y=^FHPT(FHI,"OP",FHJ,"SP",K2,0),(SP,WRD)="***"
"RTN","FHSP1",107,0)
 ..Q:$P(Y,U,6)   ;quit if cancelled.
"RTN","FHSP1",108,0)
 ..S (FHLODAT,FHSER1,FHSER2,FHSERV,FHSRFLG,WRDN,P0)=""
"RTN","FHSP1",109,0)
 ..I $G(FHLOC),$D(^FH(119.6,FHLOC,0)) S FHLODAT=^FH(119.6,FHLOC,0)
"RTN","FHSP1",110,0)
 ..I FHLODAT'="" S WRDN=$P(FHLODAT,U,1),FHSER1=$P(FHLODAT,U,5),FHSER2=$P(FHLODAT,U,6),P0=$P(FHLODAT,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHSP1",111,0)
 ..I $G(FHSER1) S SP=FHSER1
"RTN","FHSP1",112,0)
 ..I SP="***",$G(FHSER2) S SP=FHSER2
"RTN","FHSP1",113,0)
 ..I $G(FHP),$G(FHSER1),FHP=FHSER1 S FHSRFLG=1
"RTN","FHSP1",114,0)
 ..I $G(FHP),$G(FHSER2),FHP=FHSER2 S FHSRFLG=1
"RTN","FHSP1",115,0)
 ..I $G(FHP),'$G(FHSRFLG) Q
"RTN","FHSP1",116,0)
 ..S FHMLOUT=$P(FHOPDAT,U,4)
"RTN","FHSP1",117,0)
 ..I MEAL'=FHMLOUT Q
"RTN","FHSP1",118,0)
 ..S FHDFN=FHI,ADM=FHJ
"RTN","FHSP1",119,0)
 ..S Y=$P(Y,"^",2,3)_"^"_$P(Y,"^",8) Q:Y?."^"
"RTN","FHSP1",120,0)
 ..I FHOPT=2 S Y=Y_"^"_IS,WRD=P0_$E(WRDN,1,20-$L(RM))_"/"_RM,^TMP($J,"SOL",SP,WRD,FHDFN,K2)=Y Q
"RTN","FHSP1",121,0)
 ..S FHORD=$P(Y,"^",1),M1=$P(Y,"^",2)
"RTN","FHSP1",122,0)
 ..I FHOPT=1,FHORD,M1[MEAL S:'$D(N(FHORD,SP)) N(FHORD,SP)=0 S Q=$P(Y,"^",3),N(FHORD,SP)=N(FHORD,SP)+$S(Q:Q,1:1) S:'$D(C(MEAL,SP)) C(MEAL,SP)=0 I TT'=FHDFN S C(MEAL,SP)=C(MEAL,SP)+1,TT=FHDFN
"RTN","FHSP1",123,0)
 ..I FHOPT=3,FHORD,M1[MEAL S:'$D(N(FHORD)) N(FHORD)=0 S Q=$P(Y,"^",3),N(FHORD)=N(FHORD)+$S(Q:Q,1:1)
"RTN","FHSP1",124,0)
 Q
"RTN","FHSP1",125,0)
 ;
"RTN","FHSP1",126,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHSP1",127,0)
 ;
"RTN","FHSP1",128,0)
EVNT Q:FHCNSOF=0  S:'$D(FHDTP) FHDTP=""
"RTN","FHSP1",129,0)
 I $D(FHDT1) S DTP=FHDT1 D DTP^FH S FHDTP=DTP
"RTN","FHSP1",130,0)
 I $D(FHDT2) S DTP=FHDT2 D DTP^FH S:FHDTP'=DTP FHDTP=FHDTP_" to "_DTP
"RTN","FHSP1",131,0)
 S FHACT="O",FHTXT="Outpatient Standing Order: "_NUM_" "_$P($G(^FH(118.3,SP,0)),U,1)_" ("_FHALML_"), "_FHLOCN_", "_FHDTP D OPFILE^FHORX
"RTN","FHSP1",132,0)
 Q
"RTN","FHSP11")
0^54^B6300547
"RTN","FHSP11",1,0)
FHSP11 ; HISC/NCA,RTK - Print Standing Orders Labels ;2/26/96  09:59
"RTN","FHSP11",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSP11",3,0)
 ;patch #5 - added outpatient SOs.
"RTN","FHSP11",4,0)
 K ^TMP($J,"NAME") F NX=0:0 S NX=$O(^FH(118.3,NX)) Q:NX<1  S Y=^(NX,0),N1=$P(Y,"^",1) I '$D(^FH(118.3,NX,"I")) S ^TMP($J,"NAME",NX)=$P(Y,"^",1)
"RTN","FHSP11",5,0)
 D P1
"RTN","FHSP11",6,0)
 Q
"RTN","FHSP11",7,0)
P1 S DTP=DT D DTP^FH S DTE=DTP_" "_$S(MEAL="B":"BREAK",MEAL="N":"NOON",1:"EVEN"),S1=$S(LAB=1:6,1:9),S2=LAB=2*5+33
"RTN","FHSP11",8,0)
 F SP=0:0 S SP=$O(^TMP($J,"SOL",SP)) Q:SP<1  D P2
"RTN","FHSP11",9,0)
 Q
"RTN","FHSP11",10,0)
P2 S WRD="" F  S WRD=$O(^TMP($J,"SOL",SP,WRD)) Q:WRD=""  D P3
"RTN","FHSP11",11,0)
 Q
"RTN","FHSP11",12,0)
P3 F FHDFN=0:0 S FHDFN=$O(^TMP($J,"SOL",SP,WRD,FHDFN)) Q:FHDFN<1  D PID^FHDPA,P4
"RTN","FHSP11",13,0)
 Q
"RTN","FHSP11",14,0)
P4 F FHL=0:0 S FHL=$O(^TMP($J,"SOL",SP,WRD,FHDFN,FHL)) Q:FHL<1  D P5
"RTN","FHSP11",15,0)
 Q
"RTN","FHSP11",16,0)
P5 S Y=^(FHL)
"RTN","FHSP11",17,0)
 S IS=$P(Y,"^",4),FHORD=$P(Y,"^",1) Q:'FHORD  S M1=$P(Y,"^",2) Q:M1'[MEAL  S Q=$P(Y,"^",3) S:'Q Q=1
"RTN","FHSP11",18,0)
 D PATNAME^FHOMUTL I FHPTNM="" Q
"RTN","FHSP11",19,0)
 Q:$P($G(^FH(118.3,+FHORD,0)),"^",2)'="Y"
"RTN","FHSP11",20,0)
 S NAM=FHPTNM
"RTN","FHSP11",21,0)
 I LAB>2 D LL Q
"RTN","FHSP11",22,0)
 W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!?$S(LAB=1:3,1:0),FHBID W:IS'="" ?(S2-22),"*NURSE" W ?(S2-15),DTE S LN=2 I LAB=2 W !! S LN=4
"RTN","FHSP11",23,0)
 W !,$J(Q,2)," ",$S($D(^TMP($J,"NAME",FHORD)):$P(^TMP($J,"NAME",FHORD),"^",1),$D(^FH(118.3,+FHORD,0)):$P(^(0),"^",1),1:"") S LN=LN+1
"RTN","FHSP11",24,0)
 I LN<S1 F L=LN+1:1:S1 W !
"RTN","FHSP11",25,0)
 Q
"RTN","FHSP11",26,0)
LL ;
"RTN","FHSP11",27,0)
 S FHCOL=$S(LAB=3:3,1:2)
"RTN","FHSP11",28,0)
 I LABSTART>1 F FHLABST=1:1:(LABSTART-1)*FHCOL D  S LABSTART=1
"RTN","FHSP11",29,0)
 .I LAB=3 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6)="" D LL3^FHLABEL
"RTN","FHSP11",30,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6,PCL7,PCL8)="" D LL4^FHLABEL
"RTN","FHSP11",31,0)
 .Q
"RTN","FHSP11",32,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHSP11",33,0)
 S WRD1=$E(WRD,3,99)
"RTN","FHSP11",34,0)
 S NAM=$E(NAM,1,FHTAB-$L(WRD1)),BIDIS=BID I IS="N" S BIDIS=BID_" *NURSE"
"RTN","FHSP11",35,0)
 S LNA=NAM_$J(WRD1,FHTAB+1-$L(NAM)),LNB=BIDIS_$J(DTE,FHTAB+1-$L(BIDIS))
"RTN","FHSP11",36,0)
 S LNC=$J(Q,2)_" "_$P($G(^FH(118.3,+FHORD,0)),U,1)
"RTN","FHSP11",37,0)
 I LAB=3 S (PCL1,PCL4,PCL6)="",PCL2=LNA,PCL3=LNB,PCL5=LNC
"RTN","FHSP11",38,0)
 I LAB=4 S (PCL1,PCL2,PCL5,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL6=LNC
"RTN","FHSP11",39,0)
 D:LAB=3 LL3^FHLABEL D:LAB=4 LL4^FHLABEL
"RTN","FHSP11",40,0)
 Q
"RTN","FHSPED")
0^17^B70827243
"RTN","FHSPED",1,0)
FHSPED ; HISC/REL/NCA - Enter/Cancel Standing Orders ;7/22/94  13:59
"RTN","FHSPED",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSPED",3,0)
 ;11/04/05 - SO patch.
"RTN","FHSPED",4,0)
EN1 ; Enter Standing Orders for Patient
"RTN","FHSPED",5,0)
 D NOW^%DTC S NOW=%
"RTN","FHSPED",6,0)
ASK K DIC,X,DFN,FHDFN,FHPTNM,Y S ADM="",FHALL=1 D ^FHOMDPA
"RTN","FHSPED",7,0)
 G:'FHDFN KIL
"RTN","FHSPED",8,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHSPED",9,0)
 I WARD="" W !!,"** NO CURRENT ADMISSION ON FILE!  If this is an Inpatient, please admit the patient first.",! D SO^FHSP G ASK
"RTN","FHSPED",10,0)
 K ADM
"RTN","FHSPED",11,0)
A0 W !!,"Return for OUTPATIENT or 'C' for CURRENT Admission: " R X:DTIME G:X["^" KIL D:X="c" TR^FH
"RTN","FHSPED",12,0)
 I (X="")&'($D(^FHPT(FHDFN,"OP"))) W !!,"** NO OUTPATIENT DATA ON FILE!  Please enter outpatient meals from Recurring Meals Menu [FHOMRMGR]!!" G ASK
"RTN","FHSPED",13,0)
 I (X="") D SO^FHSP G ASK
"RTN","FHSPED",14,0)
 I WARD'="",X="C" S ADM=$G(^DPT("CN",WARD,DFN)) G CAD:ADM
"RTN","FHSPED",15,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="EQM" D ^DIC G:Y<1 A0 S ADM=+Y
"RTN","FHSPED",16,0)
CAD I ADM,$G(^FHPT(FHDFN,"A",ADM,0)) S (SDT,STDT)=$P(^FHPT(FHDFN,"A",ADM,0),U,1),ENDT=DT G E1:SDT
"RTN","FHSPED",17,0)
 ;
"RTN","FHSPED",18,0)
E1 W ! S NO=1 D LIS G:'$G(LN) N1
"RTN","FHSPED",19,0)
 K DIR W ! S DIR(0)="YA",DIR("A")="Edit a Standing Order? ",DIR("B")="YES" D ^DIR K DIR G:$D(DIRUT)!$D(DIROUT) EN1 G:Y<1 N1
"RTN","FHSPED",20,0)
N0 R !!,"Edit which Order #? ",X:DTIME G:'$T!("^"[X) EN1 I X'?1N.N!(X<1)!(X>LN) W *7," Enter # of Order to Edit" G N0
"RTN","FHSPED",21,0)
 S SP=$P(LS,",",+X),SP=$P($G(^FHPT(FHDFN,"A",ADM,"SP",+SP,0)),"^",2) I $D(P(+X,SP)) S LN=+X  G N1A
"RTN","FHSPED",22,0)
 W !!,"Standing Order ",$P($G(^FH(118.3,+SP,0)),"^",1)," added" S LN=LN+1,P(LN,SP)="" G N1A
"RTN","FHSPED",23,0)
N1 K DIC W ! S DIC="^FH(118.3,",DIC("A")="Enter Standing Order: ",DIC(0)="AEQM"
"RTN","FHSPED",24,0)
 D ^DIC K DIC,DLAYGO G EN1:"^"[X!$D(DTOUT),N1:Y<1 S SP=+Y
"RTN","FHSPED",25,0)
 W !!,"Standing Order ",$P($G(^FH(118.3,+SP,0)),"^",1)," added"
"RTN","FHSPED",26,0)
 S LN=LN+1,P(LN,SP)=""
"RTN","FHSPED",27,0)
N1A W !,"Standing Order: ",$P($G(^FH(118.3,+SP,0)),"^",1)_" // " R X:DTIME G KIL:'$T,FHSPED:X="^"
"RTN","FHSPED",28,0)
 I X="@" D EN3 W "  .. Done" G E1
"RTN","FHSPED",29,0)
 I X'="" W *7,!,"Press Return to take Default or ""@"" to Delete" G N1A
"RTN","FHSPED",30,0)
 S $P(P(LN,SP),"^",5)=SP
"RTN","FHSPED",31,0)
N2 W !,"Select Meal (B,N,E or ALL): ",$S($P(P(LN,SP),"^",3)'="":$P(P(LN,SP),"^",3)_" // ",1:"") R MEAL:DTIME G:'$T!(MEAL="^") KIL
"RTN","FHSPED",32,0)
 I MEAL="" G:$P(P(LN,SP),"^",3)="" KIL S MEAL=$P(P(LN,SP),"^",3),$P(P(LN,SP),"^",6)=MEAL G N2A
"RTN","FHSPED",33,0)
 I MEAL="@" S $P(P(LN,SP),"^",3)="" G N2
"RTN","FHSPED",34,0)
 S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="BNE" S X=MEAL,MEAL="" S:X["B" MEAL="B" S:X["N" MEAL=MEAL_"N" S:X["E" MEAL=MEAL_"E"
"RTN","FHSPED",35,0)
 I $L(X)'=$L(MEAL) W *7,!,"Select B for Breakfast, N for Noon, E for Evening or ALL for all meals",!,"Answer may be multiple meals, e.g., BN or NE" G N2
"RTN","FHSPED",36,0)
 S $P(P(LN,SP),"^",6)=MEAL
"RTN","FHSPED",37,0)
N2A W !,"Quantity:  ",$S($P(P(LN,SP),"^",4):$P(P(LN,SP),"^",4)_"// ",1:"1// ") R NUM:DTIME S:NUM="" NUM=$S($P(P(LN,SP),"^",4):$P(P(LN,SP),"^",4),1:1) G:'$T!(NUM="^") KIL
"RTN","FHSPED",38,0)
 I NUM="@" S $P(P(LN,SP),"^",4)="" G N2A
"RTN","FHSPED",39,0)
 I NUM'?1N!(NUM<1) W !,*7,"Enter a number from 1-9." G N2A
"RTN","FHSPED",40,0)
 S $P(P(LN,SP),"^",7)=NUM
"RTN","FHSPED",41,0)
 S C1=$P(P(LN,SP),"^",2,4),C2=$P(P(LN,SP),"^",5,7) G:C1=C2 E1
"RTN","FHSPED",42,0)
N3 W !!,"ADD this Order? Y// " R YN:DTIME G:'$T!(YN="^") KIL S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7,"  Answer YES or NO" G N3
"RTN","FHSPED",43,0)
 G:YN?1"N".E E1
"RTN","FHSPED",44,0)
 I C1'="^^" S OLD=$P(P(LN,SP),"^",1),$P(^FHPT(FHDFN,"A",ADM,"SP",OLD,0),"^",6,7)=NOW_"^"_DUZ K ^FHPT("ASP",FHDFN,ADM,OLD) S EVT="S^C^"_OLD D ^FHORX
"RTN","FHSPED",45,0)
 S $P(P(LN,SP),"^",2,4)="^^",$P(P(LN,SP),"^",2,4)=$P(P(LN,SP),"^",5,7),$P(P(LN,SP),"^",5,7)="^^"
"RTN","FHSPED",46,0)
ADD ; Add Standing Order
"RTN","FHSPED",47,0)
 L +^FHPT(FHDFN,"A",ADM,"SP",0)
"RTN","FHSPED",48,0)
 I '$D(^FHPT(FHDFN,"A",ADM,"SP",0)) S ^FHPT(FHDFN,"A",ADM,"SP",0)="^115.08^^"
"RTN","FHSPED",49,0)
 S X=^FHPT(FHDFN,"A",ADM,"SP",0),NO=$P(X,"^",3)+1,^(0)=$P(X,"^",1,2)_"^"_NO_"^"_($P(X,"^",4)+1)
"RTN","FHSPED",50,0)
 L -^FHPT(FHDFN,"A",ADM,"SP",0) I $D(^FHPT(FHDFN,"A",ADM,"SP",NO)) G ADD
"RTN","FHSPED",51,0)
 S ^FHPT(FHDFN,"A",ADM,"SP",NO,0)=NO_"^"_SP_"^"_MEAL_"^"_NOW_"^"_DUZ_"^^^"_NUM,^FHPT("ASP",FHDFN,ADM,NO)="",LS=LS_NO_","
"RTN","FHSPED",52,0)
 S $P(P(LN,SP),"^",1)=NO,EVT="S^O^"_NO D ^FHORX W "  .. done" G E1
"RTN","FHSPED",53,0)
EN2 ; Standing Order Inquiry
"RTN","FHSPED",54,0)
 K DIC,X,DFN,FHDFN,FHPTNM S ADM="",FHALL=1 D ^FHOMDPA
"RTN","FHSPED",55,0)
 ;S ALL=0 D ^FHDPA G:'DFN KIL G:'FHDFN KIL S NO=0 D LIS G EN2
"RTN","FHSPED",56,0)
 S (FHSOFG,WARD)="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHSPED",57,0)
 G:'FHDFN KIL S NO=0 D:$G(DFN) LIS
"RTN","FHSPED",58,0)
 I $D(^FHPT("ASPO",FHDFN)) D OUT,LIS^FHSP
"RTN","FHSPED",59,0)
 G EN2
"RTN","FHSPED",60,0)
EN3 ; Cancel Standing Order
"RTN","FHSPED",61,0)
 S NO=$P($G(P(LN,SP)),"^",1) Q:'NO
"RTN","FHSPED",62,0)
 S $P(^FHPT(FHDFN,"A",ADM,"SP",NO,0),"^",6,7)=NOW_"^"_DUZ
"RTN","FHSPED",63,0)
 S X=^FHPT(FHDFN,"A",ADM,"SP",NO,0),SP=$P(X,"^",2),MEAL=$P(X,"^",3),NUM=""
"RTN","FHSPED",64,0)
 K ^FHPT("ASP",FHDFN,ADM,NO),P(LN,SP) S EVT="S^C^"_NO D ^FHORX Q
"RTN","FHSPED",65,0)
LIS ;list SO
"RTN","FHSPED",66,0)
 Q:WARD=""
"RTN","FHSPED",67,0)
 S NAM=$P(^DPT(DFN,0),"^",1) D CUR^FHORD7
"RTN","FHSPED",68,0)
 W !!,NAM,"  " W:WARD'="" "( ",WARD," )"
"RTN","FHSPED",69,0)
 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHSPED",70,0)
 K N,P S CTR=0
"RTN","FHSPED",71,0)
 F K=0:0 S K=$O(^FHPT("ASP",FHDFN,ADM,K)) Q:K<1  S X=^FHPT(FHDFN,"A",ADM,"SP",K,0),M=$P(X,"^",3),M=$S(M="BNE":"A",1:$E(M,1)),N(M,K)=$P(X,"^",2,3)_"^"_$P(X,"^",8,9)
"RTN","FHSPED",72,0)
 S FHSOFG=1
"RTN","FHSPED",73,0)
 S LN=0,LS="" I $O(N(""))="" W !!,"No Active Inpatient Standing Orders." Q
"RTN","FHSPED",74,0)
 W !!,"Active Inpatient Standing Orders: ",!
"RTN","FHSPED",75,0)
 F M="A","B","N","E" D
"RTN","FHSPED",76,0)
 .F K=0:0 S K=$O(N(M,K)) Q:K<1  S Z=+N(M,K) I Z D
"RTN","FHSPED",77,0)
 ..S LN=LN+1,LS=LS_K_"," D L1 W ! W:NO $J(LN,2)
"RTN","FHSPED",78,0)
 ..S NUM=$P(N(M,K),"^",3)
"RTN","FHSPED",79,0)
 ..W ?5,M2,?18,$S(NUM:NUM,1:1)," ",$P(^FH(118.3,Z,0),"^",1)_$S($P(N(M,K),"^",4)'="Y":" (I)",1:"") I $G(^FH(118.3,Z,"I"))="Y" W "     (** INACTIVE **)"
"RTN","FHSPED",80,0)
 ..S P(LN,+Z)=K_"^"_$P(N(M,K),"^",1,3) Q
"RTN","FHSPED",81,0)
 .Q
"RTN","FHSPED",82,0)
 Q
"RTN","FHSPED",83,0)
L1 ; Store Standing Order By Meal
"RTN","FHSPED",84,0)
 S M1=$P(N(M,K),"^",2) I M1="BNE" S M2="All Meals" Q
"RTN","FHSPED",85,0)
 S L=$E(M1,1),M2=$S(L="B":"Break",L="N":"Noon",1:"Even")
"RTN","FHSPED",86,0)
 S L=$E(M1,2) Q:L=""  S M2=M2_","_$S(L="B":"Break",L="N":"Noon",1:"Even") Q
"RTN","FHSPED",87,0)
OUT ;ask for Recurring Meal Entry
"RTN","FHSPED",88,0)
 W @IOF
"RTN","FHSPED",89,0)
 W "Outpatient Recurring Meals..."
"RTN","FHSPED",90,0)
 K FHDM14,FHEDI,FHEDIF,FHIEN,FHMIEN,FHFLG
"RTN","FHSPED",91,0)
 S FHQ=0
"RTN","FHSPED",92,0)
 S (FHTOTML("B"),FHTOTML("N"),FHTOTML("E"),FHTOTML("A"))=0
"RTN","FHSPED",93,0)
 F FHI=DT-1:0 S FHI=$O(^FHPT("RM",FHI)) Q:FHI'>0!FHQ  F FHJ=0:0 S FHJ=$O(^FHPT("RM",FHI,FHDFN,FHJ)) Q:FHJ'>0!FHQ  I ($P($G(^FHPT(FHDFN,"OP",FHJ,0)),U,15)'="C") D
"RTN","FHSPED",94,0)
 .S FHDA15=$G(^FHPT(FHDFN,"OP",FHJ,0))
"RTN","FHSPED",95,0)
 .S FHDM14(FHI,$P(FHDA15,U,4))=FHI_U_FHJ
"RTN","FHSPED",96,0)
 .;
"RTN","FHSPED",97,0)
 .S FHMEAL=$P(FHDA15,U,4),FHLOC=$P(FHDA15,U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL="B":"Break",FHMEAL="N":"Noon",1:"Even"),FH11=FHMEAL_"  "_FHLOCN
"RTN","FHSPED",98,0)
 .S Y=$P(FHDA15,U,1) X ^DD("DD") S DTP=Y
"RTN","FHSPED",99,0)
 .S (FHCOFLG,FHDATL)=0
"RTN","FHSPED",100,0)
 .I $Y>(IOSL-5) K DIR S DIR(0)="E",DIR("A")="Enter RETURN to Continue or '^' to Quit Listing"  D ^DIR W:Y @IOF I 'Y S FHQ=1 Q
"RTN","FHSPED",101,0)
 .W !,DTP,?12,FH11,":"
"RTN","FHSPED",102,0)
 .S FHDATL=$L(DTP)+13+$L(FH11)
"RTN","FHSPED",103,0)
 .F FHSF=0:0 S FHSF=$O(^FHPT(FHDFN,"OP",FHJ,"SP",FHSF)) Q:FHSF'>0  D
"RTN","FHSPED",104,0)
 ..S FHDA15SF=$G(^FHPT(FHDFN,"OP",FHJ,"SP",FHSF,0))
"RTN","FHSPED",105,0)
 ..Q:$P(FHDA15SF,U,6)
"RTN","FHSPED",106,0)
 ..S FHDASFNM=$P($G(^FH(118.3,$P(FHDA15SF,U,2),0)),U,1),FHDASFQT=$P(FHDA15SF,U,8)
"RTN","FHSPED",107,0)
 ..I (FHDATL+$L(FHDASFNM)+3+$L(FHDASFQT))>79 W !,?19 S FHDATL=19
"RTN","FHSPED",108,0)
 ..I (FHDATL>19),(FHCOFLG=1) W ","
"RTN","FHSPED",109,0)
 ..S FHDATL=FHDATL+4+$L(FHDASFNM)+3+$L(FHDASFQT)
"RTN","FHSPED",110,0)
 ..W " ",FHDASFNM," = ",FHDASFQT
"RTN","FHSPED",111,0)
 I '$D(FHDM14) W !!,"NO OUTPATIENT DATA ON FILE for today's date and the future!!",! Q
"RTN","FHSPED",112,0)
 W !
"RTN","FHSPED",113,0)
 ;
"RTN","FHSPED",114,0)
 K DIC S DIC(0)="AEQM"
"RTN","FHSPED",115,0)
 S DIC("W")="S FHMEAL=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHMEAL=""B"":""Break"",FHMEAL=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHSPED",116,0)
 S DIC("S")="I $P(^FHPT(FHDFN,""OP"",+Y,0),U,1)>(DT-1),($P(^(0),U,15)'=""C"")"
"RTN","FHSPED",117,0)
 S DIC="^FHPT(FHDFN,""OP"","
"RTN","FHSPED",118,0)
 S DIC("?")="Select a Date, '^' to exit"
"RTN","FHSPED",119,0)
 S DIC("A")="Select the Outpatient Date :" D ^DIC K DIC Q:(Y'>0)!$D(DTOUT)
"RTN","FHSPED",120,0)
 S ADM=+Y
"RTN","FHSPED",121,0)
 Q
"RTN","FHSPED",122,0)
CHK ;ENTER DATES.
"RTN","FHSPED",123,0)
 K FHDT1,FHDT2
"RTN","FHSPED",124,0)
 S FHFLG=0
"RTN","FHSPED",125,0)
F1 ;START DATE
"RTN","FHSPED",126,0)
 K DIC S DIC(0)="AEQM"
"RTN","FHSPED",127,0)
 W !
"RTN","FHSPED",128,0)
 S DIC("W")="S FHML=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHML=""B"":""Break"",FHML=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHSPED",129,0)
 S DIC("S")="S FHML=$P(^(0),U,4),FHDT1=$P(^(0),U,1) I $P(^(0),U,1)>(DT-1),($P(^(0),U,15)'=""C""),FHML=FHDTML"
"RTN","FHSPED",130,0)
 S DIC="^FHPT(FHDFN,""OP"","
"RTN","FHSPED",131,0)
 S DIC("?")="Enter a Date, '^' to exit"
"RTN","FHSPED",132,0)
 S DIC("A")="Enter a Start Date :" D ^DIC K DIC Q:(Y'>0)!$D(DTOUT)
"RTN","FHSPED",133,0)
 S FHDT1=$P(^FHPT(FHDFN,"OP",+Y,0),U,1)
"RTN","FHSPED",134,0)
F2 ;END DATE
"RTN","FHSPED",135,0)
 K DIC S DIC(0)="AEQM"
"RTN","FHSPED",136,0)
 W !
"RTN","FHSPED",137,0)
 S DIC("W")="S FHML=$P(^(0),U,4),FHLOC=$P(^(0),U,3),FHLOCN=$P($G(^FH(119.6,FHLOC,0)),U,1),FHMEAL=$S(FHML=""B"":""Break"",FHML=""N"":""Noon"",1:""Even""),FH11=FHMEAL_""  ""_FHLOCN D EN^DDIOL(FH11,"""",""?3"")"
"RTN","FHSPED",138,0)
 S DIC("S")="S FHML=$P(^(0),U,4),FHDT2=$P(^(0),U,1) I $P(^(0),U,1)>(FHDT1-1),($P(^(0),U,15)'=""C""),FHML=FHDTML"
"RTN","FHSPED",139,0)
 S DIC="^FHPT(FHDFN,""OP"","
"RTN","FHSPED",140,0)
 S DIC("?")="Enter a Date, '^' to exit"
"RTN","FHSPED",141,0)
 S DIC("A")="Enter an End Date :" D ^DIC K DIC Q:(Y'>0)!$D(DTOUT)
"RTN","FHSPED",142,0)
 S FHDT2=$P(^FHPT(FHDFN,"OP",+Y,0),U,1)
"RTN","FHSPED",143,0)
 I FHDT2<FHDT1 W !!,"***End Date must be on or after Start Date!!!" G F2
"RTN","FHSPED",144,0)
 S FHFLG=1
"RTN","FHSPED",145,0)
 Q
"RTN","FHSPED",146,0)
CPRSO ;check previous SO
"RTN","FHSPED",147,0)
 K FHSOO,FHCK
"RTN","FHSPED",148,0)
 S (FHDAT,FHSO)=""
"RTN","FHSPED",149,0)
CPRS1 I FHSO="" S FHSO=$O(^FHPT("ASPO",FHDFN,""),-1)
"RTN","FHSPED",150,0)
 E  S FHSO=$O(^FHPT("ASPO",FHDFN,FHSO),-1)
"RTN","FHSPED",151,0)
 Q:'$G(FHSO)
"RTN","FHSPED",152,0)
 S FHDAT=$G(^FHPT(FHDFN,"OP",FHSO,0)),FHPRML=$P(FHDAT,U,4),FHPRCN=$P(FHDAT,U,15)
"RTN","FHSPED",153,0)
 I (FHPRML'=FHMEAL)!(FHPRCN="C") G CPRS1
"RTN","FHSPED",154,0)
 S FHCK(FHPRML)=""
"RTN","FHSPED",155,0)
 F FHI=0:0 S FHI=$O(^FHPT(FHDFN,"OP",FHSO,"SP",FHI)) Q:FHI'>0  D
"RTN","FHSPED",156,0)
 .S FHSODAT=$G(^FHPT(FHDFN,"OP",FHSO,"SP",FHI,0)),FHSOI=$P(FHSODAT,U,2),FHSOCN=$P(FHSODAT,U,6),FHSOQ=$P(FHSODAT,U,8)
"RTN","FHSPED",157,0)
 .Q:$P(FHSODAT,U,9)="Y"
"RTN","FHSPED",158,0)
 .I '$G(FHSOI)!$G(FHSOCN) Q
"RTN","FHSPED",159,0)
 .S FHSOO(FHI,FHSOI)=FHSOQ,P(1,FHSOI)=""
"RTN","FHSPED",160,0)
 Q
"RTN","FHSPED",161,0)
PPRSO ;PROCESS previous SO
"RTN","FHSPED",162,0)
 Q:'$D(FHSOO)
"RTN","FHSPED",163,0)
 S (LS,LN)=1
"RTN","FHSPED",164,0)
 D NOW^%DTC S NOW=%
"RTN","FHSPED",165,0)
 F FHI=0:0 S FHI=$O(FHSOO(FHI)) Q:FHI'>0  F FHJ=0:0 S FHJ=$O(FHSOO(FHI,FHJ)) Q:FHJ'>0  S NUM=FHSOO(FHI,FHJ),SP=FHJ D AD1^FHSP
"RTN","FHSPED",166,0)
 Q
"RTN","FHSPED",167,0)
SOEVNT S FHDTC=0
"RTN","FHSPED",168,0)
 S FHLOCN="" I $D(FHLOC),$G(FHLOC),$D(^FH(119.6,FHLOC,0)) S FHLOCN=$P(^(0),U,1)
"RTN","FHSPED",169,0)
 S FHDTC=FHDTC+1,DTP=FHOSTDT D DTP^FH S:FHDTC=1 FHDTP=DTP
"RTN","FHSPED",170,0)
 S DTP=$P(ENDT,".",1)  D DTP^FH
"RTN","FHSPED",171,0)
 I DTP'=FHDTP S FHDTP=FHDTP_" to "_DTP
"RTN","FHSPED",172,0)
 S FHALML=FHMEAL
"RTN","FHSPED",173,0)
 F FHI=0:0 S FHI=$O(FHSOO(FHI)) Q:FHI'>0  F FHJ=0:0 S FHJ=$O(FHSOO(FHI,FHJ)) Q:FHJ'>0  S NUM=FHSOO(FHI,FHJ),SP=FHJ D EVNT^FHSP1
"RTN","FHSPED",174,0)
 Q
"RTN","FHSPED",175,0)
KIL G KILL^XUSCLEAN
"RTN","FHSPTAB")
0^18^B9597999
"RTN","FHSPTAB",1,0)
FHSPTAB ; HISC/REL/NCA - Tabulate Standing Orders ;4/27/93  13:07 
"RTN","FHSPTAB",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHSPTAB",3,0)
 ;11/10/05 modified to add outpatient standing order.
"RTN","FHSPTAB",4,0)
 S FHOPT=3   ;tabulate standing order flag.
"RTN","FHSPTAB",5,0)
 S FHP=$O(^FH(119.72,0)) I FHP'<1,$O(^FH(119.72,FHP))<1 S FHP=0 G R1
"RTN","FHSPTAB",6,0)
R0 R !!,"Select SERVICE POINT (or ALL): ",X:DTIME G:'$T!("^"[X) KIL D:X="all" TR^FH I X="ALL" S FHP=0
"RTN","FHSPTAB",7,0)
 E  K DIC S DIC="^FH(119.72,",DIC(0)="EMQ" D ^DIC G:Y<1 R0 S FHP=+Y
"RTN","FHSPTAB",8,0)
R1 R !!,"Select Meal (B,N,E or ALL): ",MEAL:DTIME G:'$T!("^"[MEAL) KIL S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHSPTAB",9,0)
 I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Enter B for Breakfast, N for Noon , E for Evening or ALL for all meals" G R1
"RTN","FHSPTAB",10,0)
R3 W ! K IOP,%ZIS S %ZIS("A")="Select LIST Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHSPTAB",11,0)
 I $D(IO("Q")) S FHPGM="Q1^FHSPTAB",FHLST="FHP^MEAL^FHOPT" D EN2^FH G KIL
"RTN","FHSPTAB",12,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHSPTAB",13,0)
Q1 ; Print the Tabulated List of Standing Orders
"RTN","FHSPTAB",14,0)
 D NOW^%DTC S NOW=%,PG=0 I MEAL'="A" G Q2
"RTN","FHSPTAB",15,0)
 F MEAL="B","N","E" D Q2
"RTN","FHSPTAB",16,0)
 Q
"RTN","FHSPTAB",17,0)
Q2 S T0=(NOW\1)_$S(MEAL="B":".07",MEAL="N":".11",1:".17")
"RTN","FHSPTAB",18,0)
 K N F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D DP I DP'="" F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  S ADM=^FHPT("AW",W1,FHDFN) D ADD
"RTN","FHSPTAB",19,0)
 ;get outpatient so.
"RTN","FHSPTAB",20,0)
 D ADDO^FHSP1
"RTN","FHSPTAB",21,0)
 D HDR S NX="" F K1=0:0 S NX=$O(^FH(118.3,"B",NX)) Q:NX=""  F K=0:0 S K=$O(^FH(118.3,"B",NX,K)) Q:K<1  I $D(N(K)) D:$Y>56 HDR W !,$J(N(K),6),"       ",$P(^FH(118.3,K,0),"^",1)
"RTN","FHSPTAB",22,0)
 W ! Q
"RTN","FHSPTAB",23,0)
ADD Q:ADM<1  D CHK I K2 F K2=0:0 S K2=$O(^FHPT("ASP",FHDFN,ADM,K2)) Q:K2<1  S X=^FHPT(FHDFN,"A",ADM,"SP",K2,0) D A1
"RTN","FHSPTAB",24,0)
 Q
"RTN","FHSPTAB",25,0)
A1 S FHORD=$P(X,"^",2),M1=$P(X,"^",3) I FHORD,M1[MEAL S:'$D(N(FHORD)) N(FHORD)=0 S Q=$P(X,"^",8),N(FHORD)=N(FHORD)+$S(Q:Q,1:1)
"RTN","FHSPTAB",26,0)
 Q
"RTN","FHSPTAB",27,0)
CHK S K2=0,X1=$G(^FHPT(FHDFN,"A",ADM,0)),FHORD=$P(X1,"^",2),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHSPTAB",28,0)
 I X1>1,X1'>T0 G C2
"RTN","FHSPTAB",29,0)
C0 I '$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHSPTAB",30,0)
 S X1=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",8) I X1="" G C1
"RTN","FHSPTAB",31,0)
 S:X1="D" X1="T" S:DP[X1 K2=1
"RTN","FHSPTAB",32,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHSPTAB",33,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"AC",K)) Q:K<1!(K>T0)  S A1=K
"RTN","FHSPTAB",34,0)
 G:'A1 C1 S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0 K ^FHPT(FHDFN,"A",ADM,"AC",A1) G C2
"RTN","FHSPTAB",35,0)
DP S DP="" I 'FHP S DP="TC" Q
"RTN","FHSPTAB",36,0)
 S X=$P($G(^FH(119.6,W1,0)),"^",5,6) S:$P(X,"^",1)=FHP DP="T" S:$P(X,"^",2)=FHP DP=DP_"C" Q
"RTN","FHSPTAB",37,0)
HDR W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1,DTP=NOW D DTP^FH W !,DTP,?25,"S T A N D I N G   O R D E R S",?74,"Page ",PG
"RTN","FHSPTAB",38,0)
 W !! W:FHP $P(^FH(119.72,FHP,0),"^",1) S Y=$S(MEAL="B":"BREAKFAST",MEAL="N":"NOON",1:"EVENING") W ?(80-$L(Y)\2),Y
"RTN","FHSPTAB",39,0)
 W !!,"Quantity     Order",! Q
"RTN","FHSPTAB",40,0)
KIL G KILL^XUSCLEAN
"RTN","FHSYSP")
0^57^B2820675
"RTN","FHSYSP",1,0)
FHSYSP ; HISC/REL - Site Parameter Edit ;3/20/95  07:53
"RTN","FHSYSP",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHSYSP",3,0)
 S DA=1,DIE="^FH(119.9,"
"RTN","FHSYSP",4,0)
 I '$D(^FH(119.9,DA,0)) S DR=".01///"_DA D ^DIE
"RTN","FHSYSP",5,0)
 W ! S DR="3;22;4;S:X="""" Y=9;5:8;40:49;9:13;50:59;14:18;25:39;100//Y;I X'=""Y"" S Y="""";99" D ^DIE G KIL
"RTN","FHSYSP",6,0)
EN1 ; Display Selected Lab Tests
"RTN","FHSYSP",7,0)
 W ! S L=0,DIC="^FH(119.9,",FLDS="[FHSYP1]",BY="@SITE"
"RTN","FHSYSP",8,0)
 S (FR,TO)=1,DHD="SELECTED LABORATORY TESTS" D EN1^DIP,RSET Q
"RTN","FHSYSP",9,0)
EN2 ; Display Selected Drug Classifications
"RTN","FHSYSP",10,0)
 W ! S L=0,DIC="^FH(119.9,",FLDS="[FHSYP2]",BY="@SITE"
"RTN","FHSYSP",11,0)
 S (FR,TO)=1,DHD="SELECTED DRUG CLASSIFICATIONS" D EN1^DIP,RSET Q
"RTN","FHSYSP",12,0)
EN3 ; Clinical Site Parameters
"RTN","FHSYSP",13,0)
 S DA=1,DIE="^FH(119.9,",DR="[FHSITEC1]" W ! D ^DIE G KIL
"RTN","FHSYSP",14,0)
RSET K %ZIS S IOP="" D ^%ZIS
"RTN","FHSYSP",15,0)
KIL G KILL^XUSCLEAN
"RTN","FHSYSP",16,0)
TIM ; Convert to printable time
"RTN","FHSYSP",17,0)
 I $L(X)>6!($L(X)<2) G ERR
"RTN","FHSYSP",18,0)
 I X'["A",X'["P" G ERR
"RTN","FHSYSP",19,0)
 S:$L(X)<4 X=$E(X,1,$L(X)-1)_"00"_$E(X,$L(X))
"RTN","FHSYSP",20,0)
 I X[":",X?1.2N1":"2N1"A"!(X?1.2N1":"2N1"P") S X=+$P(X,":",1)_$P(X,":",2) G 1
"RTN","FHSYSP",21,0)
 I X'[":",X?3.4N1"A"!(X?3.4N1"P") G 1
"RTN","FHSYSP",22,0)
ERR W *7,"  Enter time as 8:15A or 12:30P" K X Q
"RTN","FHSYSP",23,0)
1 I X#100>59!(X>1259)!(X<1) G ERR
"RTN","FHSYSP",24,0)
 I X<1000 S:$E(X,1) X="0"_X
"RTN","FHSYSP",25,0)
 S X=+$E(X,1,2)_":"_$E(X,3,4)_$S(X["A":"A",1:"P") Q
"RTN","FHSYSP",26,0)
MIL ; Check for AM or PM
"RTN","FHSYSP",27,0)
 S X1=$P(X,":",1)_$P(X,":",2),X1=+X1
"RTN","FHSYSP",28,0)
 I X["P",X1<1200 S X1=X1+1200
"RTN","FHSYSP",29,0)
 I X["A",X1>1200 S X1=X1-1200
"RTN","FHSYSP",30,0)
 Q
"RTN","FHSYSP",31,0)
MIP ; Get the printable time
"RTN","FHSYSP",32,0)
 S Z=$S(Y<1200:"A",1:"P") I Z="P",Y>1259 S Y=Y-1200
"RTN","FHSYSP",33,0)
 S Y=$E("000"_Y,$L(Y),$L(Y)+3),Y=+$E(Y,1,2)_":"_$E(Y,3,4)_Z Q
"RTN","FHWADM")
0^19^B23908953
"RTN","FHWADM",1,0)
FHWADM ; HISC/REL - Set up admission ;12/4/00  10:35
"RTN","FHWADM",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHWADM",3,0)
 ; Changes necessary for new file #115 design:
"RTN","FHWADM",4,0)
 ; The .01 (1 piece of 0 node) for inpatients is now "P"_DFN (ie P7623)
"RTN","FHWADM",5,0)
 ; Therefore this file is no longer DINUMed to file #2.
"RTN","FHWADM",6,0)
 N FHWF S FHWF=$S($D(^ORD(101)):1,1:0)
"RTN","FHWADM",7,0)
 S FHZ115="P"_DFN D ADD^FHOMDPA
"RTN","FHWADM",8,0)
 I '$D(^FHPT(FHDFN,"A",0)) S ^FHPT(FHDFN,"A",0)="^115.01^^"
"RTN","FHWADM",9,0)
 D OPM  ;cancel any existing outpatient meals
"RTN","FHWADM",10,0)
 D NOW^%DTC S (FHNOW,FHX3,X)=$S($D(^DGPM(ADM,0)):$P(^(0),"^",1),1:%)
"RTN","FHWADM",11,0)
 I $D(^FHPT(FHDFN,"A",ADM)) S $P(^(ADM,0),"^",1)=X G:$G(^DPT(DFN,.105))'=ADM KIL G UPD
"RTN","FHWADM",12,0)
 S $P(^FHPT(FHDFN,"A",0),"^",3)=ADM,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","FHWADM",13,0)
 S ^FHPT(FHDFN,"A",ADM,0)=X_"^^^^^^^^"
"RTN","FHWADM",14,0)
 S FHX1=$G(^DPT(DFN,.108)),FHX2=""
"RTN","FHWADM",15,0)
 I FHX1 S FHX1=$O(^FH(119.6,"AR",FHX1,0))
"RTN","FHWADM",16,0)
 E  S FHX1=$G(^DPT(DFN,.1)) I FHX1'="" S FHX1=$O(^DIC(42,"B",FHX1,0)) S:FHX1 FHX1=$O(^FH(119.6,"AW",FHX1,0))
"RTN","FHWADM",17,0)
 S FHX1=$G(^FH(119.6,+FHX1,0))
"RTN","FHWADM",18,0)
 S FHX2=$P(FHX1,"^",16),FHX1=$P(FHX1,"^",15) I 'FHX1,FHX2'="Y" G UPD
"RTN","FHWADM",19,0)
 S X=$S(FHX3>%:FHX3,1:%)
"RTN","FHWADM",20,0)
 S ^FHPT(FHDFN,"A",ADM,"AC",X,0)=X_"^1",^FHPT(FHDFN,"A",ADM,"AC",0)="^115.14^"_X_"^1",^FHPT(FHDFN,"A",ADM,"DI",0)="^115.02A^1^1"
"RTN","FHWADM",21,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",2)=1
"RTN","FHWADM",22,0)
 I 'FHX1 S ^FHPT(FHDFN,"A",ADM,"DI",1,0)="1^^^^^^X^^"_X_"^^"_DUZ_"^"_% S EVT="D^O^1" D ^FHORX G UPD
"RTN","FHWADM",23,0)
 S FHX2=$P($G(^FH(111,FHX1,0)),"^",5)
"RTN","FHWADM",24,0)
 S ^FHPT(FHDFN,"A",ADM,"DI",1,0)="1^"_FHX1_"^^^^^^T^"_X_"^^"_DUZ_"^"_%_"^"_FHX2
"RTN","FHWADM",25,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",5)="T" S EVT="D^O^1" D ^FHORX
"RTN","FHWADM",26,0)
 I 'FHWF S FHOR=FHX1_"^^^^" D ADD K FHOR G UPD
"RTN","FHWADM",27,0)
 S FHNEW="D;"_ADM_";"_1_";"_X_";;;;T;;"_FHX1_";;;;",D1=X,D2="" D NOW^%DTC S NOW=%,FHPV=DUZ,FHOR=FHX1_"^^^^" D DO^FHWOR2
"RTN","FHWADM",28,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",14)="" D WRD D MSG^XQOR("FH EVSEND OR",.MSG) K D1,D2,FHPV,FHNEW,MSG,NOW S $P(^FHPT(FHDFN,"A",ADM,"DI",1,0),"^",15)=6 D ADD K FHOR G KIL
"RTN","FHWADM",29,0)
UPD S $P(^FHPT(FHDFN,"A",ADM,0),"^",14)="" D WRD G KIL
"RTN","FHWADM",30,0)
WRD ; Update Room/Bed & Ward for current admission
"RTN","FHWADM",31,0)
 N FHWRD,FHRMB,WARD D DID^FHDPA Q:WARD=""  S ADM=$G(^DPT("CN",WARD,DFN)) Q:'ADM
"RTN","FHWADM",32,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) Q
"RTN","FHWADM",33,0)
 S WARD=$P(^FHPT(FHDFN,"A",ADM,0),"^",8),EVT="L^"_$S(WARD:"T",1:"A")_"^^"_WARD_"~"_$P(^(0),"^",9) I WARD'=FHWRD G NEW
"RTN","FHWADM",34,0)
 I $P(^FHPT(FHDFN,"A",ADM,0),"^",9)'=FHRMB S $P(^(0),"^",9)=FHRMB S EVT=EVT_"~"_FHWRD_"~"_FHRMB D ^FHORX
"RTN","FHWADM",35,0)
 Q
"RTN","FHWADM",36,0)
NEW ; New Ward
"RTN","FHWADM",37,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",8,9)=FHWRD_"^"_FHRMB
"RTN","FHWADM",38,0)
 K:WARD ^FHPT("AW",WARD,FHDFN) I FHWRD S ^FHPT("AW",FHWRD,FHDFN)=ADM S EVT=EVT_"~"_FHWRD_"~"_FHRMB D ^FHORX
"RTN","FHWADM",39,0)
 ; Update Type of Service
"RTN","FHWADM",40,0)
 S FHX3=$P($G(^FH(119.6,+FHWRD,0)),"^",10) S:FHX3="" FHX3="TCD" I FHX3[$P(^FHPT(FHDFN,"A",ADM,0),"^",5) Q
"RTN","FHWADM",41,0)
 S FHX3=$S($L(FHX3)=1:FHX3,FHX3["D":"D",1:"C"),$P(^FHPT(FHDFN,"A",ADM,0),"^",5)=FHX3
"RTN","FHWADM",42,0)
 S FHX2=$P(^FHPT(FHDFN,"A",ADM,0),"^",2) I FHX2,$P($G(^FHPT(FHDFN,"A",ADM,"DI",+FHX2,0)),"^",8)'="" S $P(^(0),"^",8)=FHX3
"RTN","FHWADM",43,0)
 Q
"RTN","FHWADM",44,0)
ADD ; Add diet associated Diet Restriction
"RTN","FHWADM",45,0)
 D NOW^%DTC S NOW=%
"RTN","FHWADM",46,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHWADM",47,0)
 D UPD^FHMTK7
"RTN","FHWADM",48,0)
 K COM,DPAT,EVT,FP,L,LN,LP,LS,M,M1,M2,MEAL,N,NM,NO,NUM,NX,OPAT,P,PP,PNN,PNO,R1,SF,SP,X3,^TMP($J),Z
"RTN","FHWADM",49,0)
 Q
"RTN","FHWADM",50,0)
OPM ; Delete any future outpatient meals orders upon patient admission
"RTN","FHWADM",51,0)
 I '$D(^FHPT(FHDFN,"OP")),'$D(^FHPT(FHDFN,"SM")),'$D(^FHPT(FHDFN,"GM")) Q
"RTN","FHWADM",52,0)
 S X1=DT,X2=-1 D C^%DTC S FHDT=X_.999
"RTN","FHWADM",53,0)
 F FHRMDT=FHDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D CANRM
"RTN","FHWADM",54,0)
 F FHSM=FHDT:0 S FHSM=$O(^FHPT(FHDFN,"SM",FHSM)) Q:FHSM'>0  D CANSM
"RTN","FHWADM",55,0)
 F FHGM=FHDT:0 S FHGM=$O(^FHPT(FHDFN,"GM",FHGM)) Q:FHGM'>0  D CANGM
"RTN","FHWADM",56,0)
 Q
"RTN","FHWADM",57,0)
CANRM ;
"RTN","FHWADM",58,0)
 D CANRM^FHOMRC1
"RTN","FHWADM",59,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,12)
"RTN","FHWADM",60,0)
 S FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHWADM",61,0)
 S FHDT2=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHWADM",62,0)
 S FILL="R;"_FHMPNUM_";"_FHDT2_";"_FHDT2_";;"
"RTN","FHWADM",63,0)
 D CAN
"RTN","FHWADM",64,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D CNAO100,CANAO^FHOMRC1
"RTN","FHWADM",65,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D CNEL100,CANEL^FHOMRC1
"RTN","FHWADM",66,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D CNTF100,CANTF^FHOMRC1
"RTN","FHWADM",67,0)
 Q
"RTN","FHWADM",68,0)
CNAO100 ;Backdoor message to update file #100 with AO cancel order
"RTN","FHWADM",69,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,4),FILL="A;"_FHRNUM D CAN Q
"RTN","FHWADM",70,0)
CNEL100 ;Backdoor message to update file #100 with EL cancel order
"RTN","FHWADM",71,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,5),FILL="E;"_FHRNUM D CAN Q
"RTN","FHWADM",72,0)
CNTF100 ;Backdoor message to update file #100 with TF cancel order
"RTN","FHWADM",73,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,4),FILL="T;"_FHRNUM D CAN Q
"RTN","FHWADM",74,0)
 ;
"RTN","FHWADM",75,0)
CANSM ;
"RTN","FHWADM",76,0)
 S FHSTAT="C",(DA,FHDA)=FHSM,DA(1)=FHDFN
"RTN","FHWADM",77,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12)
"RTN","FHWADM",78,0)
 I '$D(^FHPT(DA(1),"SM",DA,0)) Q
"RTN","FHWADM",79,0)
 S DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHWADM",80,0)
 S DR="1////^S X=FHSTAT;14////^S X=FHORN;11.5////^S X=FHSTAT" D ^DIE
"RTN","FHWADM",81,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHWADM",82,0)
 S FHACT="C",FHOPTY="S",FHOPDT=FHDA D SETSM^FHOMRO2
"RTN","FHWADM",83,0)
CNSM100 ;Backdoor message to update file #100 with SM cancel order
"RTN","FHWADM",84,0)
 S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12),FILL="S;"_FHDA D CAN
"RTN","FHWADM",85,0)
 ;if an SM E/L Tray exists cancel that too:
"RTN","FHWADM",86,0)
CNSMEL S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,1)),U,4) I FHORN="" Q
"RTN","FHWADM",87,0)
 S FILL="G;"_FHDA D CAN Q
"RTN","FHWADM",88,0)
 ;
"RTN","FHWADM",89,0)
CANGM ;
"RTN","FHWADM",90,0)
 S FHSTAT="C",(DA,FHDA)=FHGM,DA(1)=FHDFN
"RTN","FHWADM",91,0)
 S DIE="^FHPT("_DA(1)_",""GM"","
"RTN","FHWADM",92,0)
 S DR="8////^S X=FHSTAT;9////^S X=DUZ" D ^DIE
"RTN","FHWADM",93,0)
 S FHZN=$G(^FHPT(FHDFN,"GM",FHDA,0))
"RTN","FHWADM",94,0)
 S FHACT="C",FHOPTY="G",FHOPDT=FHDA D SETGM^FHOMRO2 ;set event
"RTN","FHWADM",95,0)
 Q
"RTN","FHWADM",96,0)
CAN ;
"RTN","FHWADM",97,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHWADM",98,0)
 D MSHCA^FHOMUTL,EVSEND^FHWOR
"RTN","FHWADM",99,0)
 Q
"RTN","FHWADM",100,0)
KIL ;
"RTN","FHWADM",101,0)
 K %,%H,%I,DIC,DIE,DIR,FHDT,FHDT2,FHRMDT,FHRNUM,FHNOW,FHX1,FHX2,FHX3
"RTN","FHWADM",102,0)
 K FHRMB,FHWRD,X Q
"RTN","FHWOR")
0^58^B30023684
"RTN","FHWOR",1,0)
FHWOR ; HISC/NCA - Main Routine to Decode HL7 ;10/10/00  14:55
"RTN","FHWOR",2,0)
 ;;5.5;DIETETICS;**2,5**;Jan 28, 2005;Build 53
"RTN","FHWOR",3,0)
EN(MSG) ; Entry Point for OE/RR 3 and pass MSG in FHMSG
"RTN","FHWOR",4,0)
 N ACT,ADM,BID,COM,FHDFN,DFN,EDT,FHPV,FHMSG,FHWF,NOW,SDT,CHK,DA,DATA,DATE,DIET,DUR,FHC,FHD,FHD1,FHD2,FOR,FTYP,IEN,ITVL,LP,MEAL,NAM,PER,PID,SERV,TIM,TIME,TM,TXT,TYPC,WARD,X,XX,YR
"RTN","FHWOR",5,0)
 S TXT="",FHWF=2 ; FHWF=2 - Orders from OE/RR
"RTN","FHWOR",6,0)
 F L=0:0 S L=$O(MSG(L)) Q:L<1  S FHMSG(L)=$G(MSG(L))
"RTN","FHWOR",7,0)
 Q:'$D(FHMSG)
"RTN","FHWOR",8,0)
 ; Decode MSH
"RTN","FHWOR",9,0)
 S X=$G(FHMSG(1)) I $E(X,1,3)'="MSH" S TXT="MSH not first record" D GETOR G ERR
"RTN","FHWOR",10,0)
 ; Check PID
"RTN","FHWOR",11,0)
 S X=$G(FHMSG(2)) I $E(X,1,3)'="PID" S TXT="PID not second record" D GETOR G ERR
"RTN","FHWOR",12,0)
 S NAM=$P(X,"|",6),DFN=$P(X,"|",4)
"RTN","FHWOR",13,0)
 I '$D(^DPT("B",$E(NAM,1,30),DFN)) S TXT="Name/DFN not found" D GETOR G ERR
"RTN","FHWOR",14,0)
 S FHZ115="P"_DFN D ADD^FHOMDPA I FHDFN=""  S TXT="Patient not found in File #115" D GETOR G ERR
"RTN","FHWOR",15,0)
 D PID^VADPT6 S PID=$G(VA("PID")),BID=$G(VA("BID")) K VA
"RTN","FHWOR",16,0)
 S X=$G(FHMSG(3)) I $E(X,1,5)="ORC|Z" G PURGE
"RTN","FHWOR",17,0)
 I $E(X,1,6)="ORC|DE" Q  ;6/2005 quit processing if "DE" returned
"RTN","FHWOR",18,0)
 ;Check for outpatient orders
"RTN","FHWOR",19,0)
 I $P(X,"|",3)="O" D ^FHOMWOR Q
"RTN","FHWOR",20,0)
 S WARD=$G(^DPT(DFN,.1)) I WARD="" D CHK^FHWORR G:CHK CANCEL S:'CHK TXT="Not an inpatient" D GETOR G ERR
"RTN","FHWOR",21,0)
 S ADM=$G(^DPT("CN",WARD,DFN)) I ADM<1 S TXT="Admission not found" D GETOR G ERR
"RTN","FHWOR",22,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) I '$D(^DGPM(ADM,0)) S TXT="Admission not found" D GETOR G ERR
"RTN","FHWOR",23,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) S DA=DFN D ^FHWADM
"RTN","FHWOR",24,0)
 ; Check PV1
"RTN","FHWOR",25,0)
 S X=$G(FHMSG(3)) G:$E(X,1,3)="ORC" CANCEL I $E(X,1,3)'="PV1" S TXT="Third message not ORC or PV1" D GETOR G ERR
"RTN","FHWOR",26,0)
 ; Decode ORC
"RTN","FHWOR",27,0)
 S X=$G(FHMSG(4)) I $E(X,1,3)'="ORC" S TXT="Message 4 not ORC as expected" D GETOR G ERR
"RTN","FHWOR",28,0)
 S ACT=$P(X,"|",2) I ACT'="NW" S TXT="Action not NW as expected" D GETOR G ERR
"RTN","FHWOR",29,0)
 S FHORN=$P(X,"|",3),DUR=$P(X,"|",8)
"RTN","FHWOR",30,0)
 S ITVL=$P(DUR,"^",2),SDT=$P(DUR,"^",4),EDT=$P(DUR,"^",5)
"RTN","FHWOR",31,0)
 S FHPV=$P(X,"|",13),NOW=$P(X,"|",16) I NOW="" S TXT="No Effective Date" G ERR
"RTN","FHWOR",32,0)
 S X=$G(FHMSG(5)) I $E(X,1,3)="ODT" D ^FHWOR3 G KIL
"RTN","FHWOR",33,0)
 I $E(X,1,3)="OBR" D ^FHWOR61 G KIL
"RTN","FHWOR",34,0)
 I $E(X,1,3)'="ODS" S TXT="Message 5 not ODT or ODS as expected" G ERR
"RTN","FHWOR",35,0)
 S TYPC=$P(X,"|",2) I TYPC="ZE" D ^FHWOR5 G KIL
"RTN","FHWOR",36,0)
 S DIET=$P(X,"|",4),DIET=$E(DIET,4,$L(DIET)),COM=$P(X,"|",5)
"RTN","FHWOR",37,0)
 I $E(DIET,1,4)="FH-5" D ^FHWOR4 G KIL
"RTN","FHWOR",38,0)
 I $E(DIET,1,4)="FH-6" D ^FHWOR1 G KIL
"RTN","FHWOR",39,0)
 D ^FHWOR2 G KIL
"RTN","FHWOR",40,0)
CANCEL ; Cancel/Discontinue
"RTN","FHWOR",41,0)
 S DATA=X,FOR=0
"RTN","FHWOR",42,0)
 S ACT=$P(DATA,"|",2)
"RTN","FHWOR",43,0)
 S FHORN=$P(DATA,"|",3),FILL=$P(DATA,"|",4),FTYP=$P(FILL,";",1)
"RTN","FHWOR",44,0)
 I ACT'="CA",ACT'="DC",ACT'="NA",ACT'="DE",ACT'="SS" S TXT="Action not CA, DC, NA, or DE as expected" G CERR
"RTN","FHWOR",45,0)
 I FTYP="R"!(FTYP="S") D OMSTAT^FHWORR Q  ;Status update for outpt meals
"RTN","FHWOR",46,0)
 I "ADEINT"'[FTYP G CSEND:ACT="CA"!(ACT="DC"),KIL
"RTN","FHWOR",47,0)
 S FOR=$S(FTYP="A":1,FTYP="D":2,FTYP="E":3,FTYP="N":4,FTYP="T":5,FTYP="I":6,1:0)
"RTN","FHWOR",48,0)
 I 'FOR G CSEND:ACT="CA"!(ACT="DC"),KIL
"RTN","FHWOR",49,0)
 I ACT="SS" G STATUS^FHWORR
"RTN","FHWOR",50,0)
 I ACT="NA" D NA K ACT,TXT K MSG Q
"RTN","FHWOR",51,0)
 I ACT="DE" K MSG G KIL
"RTN","FHWOR",52,0)
CAN ; Cancel Order From OE
"RTN","FHWOR",53,0)
 I FOR=1 D CAN^FHWOR1 G KIL
"RTN","FHWOR",54,0)
 I FOR=2 D CAN^FHWOR2 G KIL
"RTN","FHWOR",55,0)
 I FOR=3 D CAN^FHWOR3 G KIL
"RTN","FHWOR",56,0)
 I FOR=4 D CAN^FHWOR4 G KIL
"RTN","FHWOR",57,0)
 I FOR=5 D CAN^FHWOR5 G KIL
"RTN","FHWOR",58,0)
 I FOR=6 D CAN^FHWOR61 G KIL
"RTN","FHWOR",59,0)
 G KIL
"RTN","FHWOR",60,0)
PURGE ; Purge OE/RR Orders
"RTN","FHWOR",61,0)
 I $E(X,5,6)'="Z@" G KIL
"RTN","FHWOR",62,0)
 S FHORN=+$P(X,"|",3),FILL=$P(X,"|",4),FTYP=$P(FILL,";",1)
"RTN","FHWOR",63,0)
 S FHDR=+$P(FILL,";",3),ADM=+$P(FILL,";",2)
"RTN","FHWOR",64,0)
 I FTYP="A" S:$P($G(^FHPT(FHDFN,"A",ADM,"OO",FHDR,0)),"^",8)=FHORN $P(^FHPT(FHDFN,"A",ADM,"OO",FHDR,0),"^",8)=""
"RTN","FHWOR",65,0)
 I FTYP="D" S:$P($G(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0),"^",14)=""
"RTN","FHWOR",66,0)
 I FTYP="E" S SDT=$P(FILL,";",4),EDT=$P(FILL,";",5) S:EDT<SDT EDT=SDT D
"RTN","FHWOR",67,0)
 .F EL=SDT\1:0 S EL=$O(^FHPT(FHDFN,"A",ADM,"EL",EL)) Q:EL<1!(EL>EDT)  D
"RTN","FHWOR",68,0)
 ..S:$P($G(^FHPT(FHDFN,"A",ADM,"EL",EL,0)),"^",7)=FHORN $P(^FHPT(FHDFN,"A",ADM,"EL",EL,0),"^",7)=""
"RTN","FHWOR",69,0)
 ..Q
"RTN","FHWOR",70,0)
 .Q
"RTN","FHWOR",71,0)
 I FTYP="N" S:$P($G(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0),"^",14)=""
"RTN","FHWOR",72,0)
 I FTYP="T" S:$P($G(^FHPT(FHDFN,"A",ADM,"TF",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"TF",FHDR,0),"^",14)=""
"RTN","FHWOR",73,0)
 I FTYP="I" S:$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",13)=FHORN $P(^FHPT(FHDFN,"A",ADM,0),"^",13)=""
"RTN","FHWOR",74,0)
 K EL,FHDR
"RTN","FHWOR",75,0)
 S $P(MSG(1),"|",9)="ORR",$P(MSG(3),"|",2)="ZR",$P(MSG(1),"|",3)="DIETETICS" G EVSEND
"RTN","FHWOR",76,0)
NA ; Number Assign
"RTN","FHWOR",77,0)
 I FOR=1 D NA^FHWOR1 G KIL
"RTN","FHWOR",78,0)
 I FOR=2 D NA^FHWOR2 G KIL
"RTN","FHWOR",79,0)
 I FOR=3 D NA^FHWOR3 G KIL
"RTN","FHWOR",80,0)
 I FOR=4 D NA^FHWOR4 G KIL
"RTN","FHWOR",81,0)
 I FOR=5 D NA^FHWOR5 G KIL
"RTN","FHWOR",82,0)
 I FOR=6 D NA^FHWOR61 G KIL
"RTN","FHWOR",83,0)
 Q
"RTN","FHWOR",84,0)
CVT ; Convert HL7 date to FM date
"RTN","FHWOR",85,0)
 Q:DATE=""  S DATE=$$HL7TFM^XLFDT(DATE)
"RTN","FHWOR",86,0)
 I $P(DATE,".",2)=24 S DATE=$$FMADD^XLFDT(DATE,0,0,1)
"RTN","FHWOR",87,0)
 Q
"RTN","FHWOR",88,0)
ERR ; Send error MSG
"RTN","FHWOR",89,0)
 K MSG D RMSH
"RTN","FHWOR",90,0)
 S $P(MSG(3),"|",1,2)="ORC"_"|"_$S($P($G(MSG(3)),"|",1)="ORC":"U"_$E($P($G(MSG(3)),"|",2),1),1:"OC"),$P(MSG(3),"|",3)=FHORN
"RTN","FHWOR",91,0)
 S $P(MSG(3),"|",4)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",4),1:"")
"RTN","FHWOR",92,0)
 S $P(MSG(3),"|",13)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",13),1:$P(FHMSG(4),"|",13))
"RTN","FHWOR",93,0)
 S $P(MSG(3),"|",16)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",16),1:$P(FHMSG(4),"|",16))
"RTN","FHWOR",94,0)
 S $P(MSG(3),"|",17)=TXT G EVSEND
"RTN","FHWOR",95,0)
SEND ; Send OK MSG to OERR
"RTN","FHWOR",96,0)
 K MSG D RMSH
"RTN","FHWOR",97,0)
 S MSG(3)="ORC|OK|"_FHORN_"|"_FILL_"^"_"FH" G EVSEND
"RTN","FHWOR",98,0)
CERR ; Send unable MSG
"RTN","FHWOR",99,0)
 K MSG D RMSH
"RTN","FHWOR",100,0)
 S MSG(3)="ORC|U"_$E(ACT,1)_"|"_FHORN_"|"_FILL_"|||||||||||||"_TXT G EVSEND
"RTN","FHWOR",101,0)
CSEND ; Send Canceled/Discontinued MSG to OERR
"RTN","FHWOR",102,0)
 K MSG D RMSH
"RTN","FHWOR",103,0)
 S MSG(3)="ORC|"_$E(ACT,1)_"R"_"|"_FHORN_"|"_FILL
"RTN","FHWOR",104,0)
EVSEND ; Send Message to OE/RR
"RTN","FHWOR",105,0)
 K ACT,FILL,FHORN,SITE,TXT D MSG^XQOR("FH EVSEND OR",.MSG) K MSG Q
"RTN","FHWOR",106,0)
MSH ; Code MSH message
"RTN","FHWOR",107,0)
 D MSH^FHWORR
"RTN","FHWOR",108,0)
 Q
"RTN","FHWOR",109,0)
RMSH ; Code MSH Return Message
"RTN","FHWOR",110,0)
 D SITE^FH
"RTN","FHWOR",111,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORR"
"RTN","FHWOR",112,0)
 ; code PID
"RTN","FHWOR",113,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHWOR",114,0)
 Q
"RTN","FHWOR",115,0)
GETOR ; Call to Get FHORN
"RTN","FHWOR",116,0)
 D GETOR^FHWORR Q
"RTN","FHWOR",117,0)
KIL ; Kill Variables
"RTN","FHWOR",118,0)
 K ACT,ADM,BID,COM,FHDFN,DFN,EDT,FHPV,FHMSG,FHWF,NOW,SDT,CHK,DA,DATA,DATE,DIET,DUR,FHC,FHD,FHD1,FHD2,FOR,FTYP,IEN,ITVL,LP,MEAL,NAM,PER,PID,SERV,TIM,TIME,TM,TXT,TYPC,WARD,X,XX,YR Q
"RTN","FHWOR6")
0^29^B17605966
"RTN","FHWOR6",1,0)
FHWOR6 ; HISC/NCA - Update Orderable Items For Master File ;5/2/00  10:07
"RTN","FHWOR6",2,0)
 ;;5.5;DIETETICS;**5**;Jan 28, 2005;Build 53
"RTN","FHWOR6",3,0)
UPDATE ; Update Diet Orders and Tubefeedings
"RTN","FHWOR6",4,0)
 K MSG
"RTN","FHWOR6",5,0)
 I TYP="D" D CHKD
"RTN","FHWOR6",6,0)
 I TYP="T" D CHKT
"RTN","FHWOR6",7,0)
 K ACT,FILE,FILNM,K,NAM,N1,N2,PREC,STR,STR1,SYN,Z1
"RTN","FHWOR6",8,0)
 I $D(MSG) D SEND
"RTN","FHWOR6",9,0)
 Q
"RTN","FHWOR6",10,0)
CHKD ; Check which Diet Order transactions
"RTN","FHWOR6",11,0)
 S FILE="111",FILNM=$P($G(^FH(111,0)),"^",1)
"RTN","FHWOR6",12,0)
 I $P(IEN,"^",3) S CHK=1,IEN=+IEN D PROCD S CHK=0 D CHKI Q
"RTN","FHWOR6",13,0)
 S IEN=+IEN
"RTN","FHWOR6",14,0)
 I $G(^FH(111,IEN,0))="" S CHK=2 D PROCD Q
"RTN","FHWOR6",15,0)
 I NOD1'=$P($G(^FH(111,IEN,0)),"^",1,4) S CHK=3 D PROCD S CHK=0
"RTN","FHWOR6",16,0)
 S STR="" F IEN1=0:0 S IEN1=$O(^FH(111,IEN,"AN",IEN1)) Q:IEN1<1  S:STR'="" STR=STR_"," S STR=STR_IEN1
"RTN","FHWOR6",17,0)
 S STR1="" F IEN1=0:0 S IEN1=$O(^TMP($J,"FHNOD3",IEN1)) Q:IEN1<1  S:STR1'="" STR1=STR1_"," S STR1=STR1_IEN1
"RTN","FHWOR6",18,0)
 I $L(STR,",")'=$L(STR1,",") S CHK=3 D PROCD S CHK=0 D CHKI Q
"RTN","FHWOR6",19,0)
 I STR'=STR1 S CHK=3 D PROCD S CHK=0 D CHKI Q
"RTN","FHWOR6",20,0)
 F K=1:1 Q:$P(STR1,",",K)=""  S IEN1=$P(STR,",",K) D CHKD1
"RTN","FHWOR6",21,0)
CHKI I NOD2'="Y",$G(^FH(111,IEN,"I"))="Y" S CHK=4 D PROCD Q
"RTN","FHWOR6",22,0)
 I NOD2="Y",$G(^FH(111,IEN,"I"))'="Y" S CHK=5 D PROCD Q
"RTN","FHWOR6",23,0)
 Q
"RTN","FHWOR6",24,0)
CHKD1 I 'IEN1 S CHK=3 D PROCD S CHK=0 Q
"RTN","FHWOR6",25,0)
 I $G(^FH(111,IEN,"AN",IEN1,0))'=$G(^TMP($J,"FHNOD3",($P(STR1,",",K)))) S CHK=3 D PROCD S CHK=0
"RTN","FHWOR6",26,0)
 Q
"RTN","FHWOR6",27,0)
PROCD ; Process Diet Order Msg.
"RTN","FHWOR6",28,0)
 Q:'CHK
"RTN","FHWOR6",29,0)
 I REC D CODE^FHWORI S REC=0,N1=2
"RTN","FHWOR6",30,0)
 S Z1=$S($G(^FH(111,IEN,0))'="":$G(^FH(111,IEN,0)),1:$P(NOD1,"^",1,4))
"RTN","FHWOR6",31,0)
 G ADD:CHK=1,DLD:CHK=2,UPD:CHK=3,DCD:CHK=4,ACD:CHK=5
"RTN","FHWOR6",32,0)
 Q
"RTN","FHWOR6",33,0)
CHKT ; Check which Tubefeeding Transactions
"RTN","FHWOR6",34,0)
 S FILE="118.2",FILNM=$P($G(^FH(118.2,0)),"^",1)
"RTN","FHWOR6",35,0)
 I $P(IEN,"^",3) S CHK=1 S IEN=+IEN D PROCT S CHK=0 D CHKIN Q
"RTN","FHWOR6",36,0)
 S IEN=+IEN
"RTN","FHWOR6",37,0)
 I $G(^FH(118.2,IEN,0))="" S CHK=2 D PROCT Q
"RTN","FHWOR6",38,0)
 I NOD1'=$P($G(^FH(118.2,IEN,0)),"^",1) S CHK=3 D PROCT S CHK=0 D CHKIN Q
"RTN","FHWOR6",39,0)
 S STR="" F IEN1=0:0 S IEN1=$O(^FH(118.2,IEN,1,IEN1)) Q:IEN1<1  S:STR'="" STR=STR_"," S STR=STR_IEN1
"RTN","FHWOR6",40,0)
 S STR1="" F IEN1=0:0 S IEN1=$O(^TMP($J,"FHNOD2",IEN1)) Q:IEN1<1  S:STR1'="" STR1=STR1_"," S STR1=STR1_IEN1
"RTN","FHWOR6",41,0)
 I $L(STR,",")'=$L(STR1,",") S CHK=3 D PROCT S CHK=0 D CHKIN Q
"RTN","FHWOR6",42,0)
 I STR'=STR1 S CHK=3 D PROCT S CHK=0 D CHKIN Q
"RTN","FHWOR6",43,0)
 F K=1:1 Q:$P(STR1,",",K)=""  S IEN1=$P(STR,",",K) D CHKT1
"RTN","FHWOR6",44,0)
CHKIN ; Check if more than one transaction
"RTN","FHWOR6",45,0)
 I NOD3'="Y",$G(^FH(118.2,IEN,"I"))="Y" S CHK=4 D PROCT Q
"RTN","FHWOR6",46,0)
 I NOD3="Y",$G(^FH(118.2,IEN,"I"))'="Y" S CHK=5 D PROCT Q
"RTN","FHWOR6",47,0)
 Q
"RTN","FHWOR6",48,0)
CHKT1 I 'IEN1 S CHK=3 D PROCT S CHK=0 Q
"RTN","FHWOR6",49,0)
 I $G(^FH(118.2,IEN,1,IEN1,0))'=$G(^TMP($J,"FHNOD2",($P(STR1,",",K)))) S CHK=3 D PROCT S CHK=0
"RTN","FHWOR6",50,0)
 Q
"RTN","FHWOR6",51,0)
PROCT ; Process Tubefeeding Msg.
"RTN","FHWOR6",52,0)
 Q:'CHK
"RTN","FHWOR6",53,0)
 I REC D CODE^FHWORI S REC=0,N1=2
"RTN","FHWOR6",54,0)
 S Z1=$S($G(^FH(118.2,IEN,0))'="":$G(^FH(118.2,IEN,0)),1:NOD1)
"RTN","FHWOR6",55,0)
 G ADT:CHK=1,DLT:CHK=2,UPT:CHK=3,DCT:CHK=4,ACT:CHK=5
"RTN","FHWOR6",56,0)
 Q
"RTN","FHWOR6",57,0)
ADD ; Code Add Diet Order
"RTN","FHWOR6",58,0)
 S ACT="MAD" G DO
"RTN","FHWOR6",59,0)
DLD ; Code Delete Diet Order
"RTN","FHWOR6",60,0)
 S ACT="MDL" G DO
"RTN","FHWOR6",61,0)
UPD ; Code Update Diet Order
"RTN","FHWOR6",62,0)
 S ACT="MUP" G DO
"RTN","FHWOR6",63,0)
DCD ; Code Deactivate Diet Order
"RTN","FHWOR6",64,0)
 S ACT="MDC" G DO
"RTN","FHWOR6",65,0)
ACD ; Code Reactivate Deactivated Diet Order
"RTN","FHWOR6",66,0)
 S ACT="MAC" G DO
"RTN","FHWOR6",67,0)
ADT ; Code Add Tubefeeding
"RTN","FHWOR6",68,0)
 S ACT="MAD" G TF
"RTN","FHWOR6",69,0)
DLT ; Code Delete Tubefeeding
"RTN","FHWOR6",70,0)
 S ACT="MDL" G TF
"RTN","FHWOR6",71,0)
UPT ; Code Update Tubefeeding
"RTN","FHWOR6",72,0)
 S ACT="MUP" G TF
"RTN","FHWOR6",73,0)
DCT ; Code Deactive Tubefeeding
"RTN","FHWOR6",74,0)
 S ACT="MDC" G TF
"RTN","FHWOR6",75,0)
ACT ; Code Reactivate Deactivated Tubefeeding
"RTN","FHWOR6",76,0)
 S ACT="MAC" G TF
"RTN","FHWOR6",77,0)
DO ; Code Diet Order MFE, ZFH, and ZSY
"RTN","FHWOR6",78,0)
 S NAM=$P(Z1,"^",1) Q:NAM=""  S PREC=$P(Z1,"^",4) Q:'PREC
"RTN","FHWOR6",79,0)
 S SYN=$P(Z1,"^",2),N1=N1+1
"RTN","FHWOR6",80,0)
 S MSG(N1)="MFE|"_ACT_"|||^^^"_IEN_"^"_NAM_"^99FHD"
"RTN","FHWOR6",81,0)
 S N1=N1+1,MSG(N1)="ZFH|D|"_PREC_"||"_$P(Z1,"^",3)
"RTN","FHWOR6",82,0)
 I $G(^FH(111,IEN,0))="" S FHK=0 D  Q
"RTN","FHWOR6",83,0)
 .F IEN1=0:0 S IEN1=$O(^TMP($J,"FHNOD3",IEN1)) Q:IEN1<1  S FHK=IEN1 D
"RTN","FHWOR6",84,0)
 ..S SYN1=$G(^TMP($J,"FHNOD3",IEN1)) I SYN1'="" S N1=N1+1,MSG(N1)="ZSY|"_IEN1_"|"_SYN1 Q
"RTN","FHWOR6",85,0)
 .I SYN'="" S N1=N1+1,MSG(N1)="ZSY|"_(FHK+1)_"|"_SYN
"RTN","FHWOR6",86,0)
 .Q
"RTN","FHWOR6",87,0)
 S FHK=0 F IEN1=0:0 S IEN1=$O(^FH(111,IEN,"AN",IEN1)) Q:IEN1<1  S SYN1=$G(^(IEN1,0)) D
"RTN","FHWOR6",88,0)
 .S FHK=IEN1,SYN1=$P(SYN1,"^",1) I SYN1'="" S N1=N1+1,MSG(N1)="ZSY|"_IEN1_"|"_SYN1 Q
"RTN","FHWOR6",89,0)
 I SYN'="" S N1=N1+1,MSG(N1)="ZSY|"_(FHK+1)_"|"_SYN
"RTN","FHWOR6",90,0)
 Q
"RTN","FHWOR6",91,0)
TF ; Code Tubefeeding MFE, ZFH, and ZSY
"RTN","FHWOR6",92,0)
 S NAM=$P(Z1,"^",1) Q:NAM=""  S N1=N1+1
"RTN","FHWOR6",93,0)
 S MSG(N1)="MFE|"_ACT_"|||^^^"_IEN_"^"_NAM_"^99FHT"
"RTN","FHWOR6",94,0)
 S N1=N1+1,MSG(N1)="ZFH|T|"
"RTN","FHWOR6",95,0)
 I $G(^FH(118.2,IEN,0))="" D  Q
"RTN","FHWOR6",96,0)
 .F IEN1=0:0 S IEN1=$O(^TMP($J,"FHNOD2",IEN1)) Q:IEN1<1  D
"RTN","FHWOR6",97,0)
 ..S SYN=$G(^TMP($J,"FHNOD2",IEN1)) I SYN'="" D
"RTN","FHWOR6",98,0)
 ..S N1=N1+1
"RTN","FHWOR6",99,0)
 ..S MSG(N1)="ZSY|"_IEN1_"|"_SYN Q
"RTN","FHWOR6",100,0)
 .Q
"RTN","FHWOR6",101,0)
 F IEN1=0:0 S IEN1=$O(^FH(118.2,IEN,1,IEN1)) Q:IEN1<1  S SYN=$G(^(IEN1,0)) D
"RTN","FHWOR6",102,0)
 .S SYN=$P(SYN,"^",1) Q:SYN=""  S N1=N1+1
"RTN","FHWOR6",103,0)
 .S MSG(N1)="ZSY|"_IEN1_"|"_SYN Q
"RTN","FHWOR6",104,0)
 Q
"RTN","FHWOR6",105,0)
SEND ; Send Message to OE/RR
"RTN","FHWOR6",106,0)
 D MSG^XQOR("FH ORDERABLE ITEM UPDATE",.MSG)
"RTN","FHWOR6",107,0)
 K MSG Q
"SEC","^DIC",118.2,118.2,0,"AUDIT")

"SEC","^DIC",118.2,118.2,0,"DD")
#
"SEC","^DIC",118.2,118.2,0,"DEL")
#f
"SEC","^DIC",118.2,118.2,0,"LAYGO")
#f
"SEC","^DIC",118.2,118.2,0,"RD")
#F
"SEC","^DIC",118.2,118.2,0,"WR")
#f
"SEC","^DIC",119.6,119.6,0,"DD")
#
"SEC","^DIC",119.6,119.6,0,"DEL")
#f
"SEC","^DIC",119.6,119.6,0,"LAYGO")
#f
"SEC","^DIC",119.6,119.6,0,"RD")
#F
"SEC","^DIC",119.6,119.6,0,"WR")
#f
"UP",115,115.016,-1)
115^OP
"UP",115,115.016,0)
115.016
"UP",115,115.017,-1)
115^SM
"UP",115,115.017,0)
115.017
"UP",115,115.018,-1)
115^GM
"UP",115,115.018,0)
115.018
"UP",115,115.1619,-2)
115^OP
"UP",115,115.1619,-1)
115.016^TF
"UP",115,115.1619,0)
115.1619
"UP",115,115.1626,-2)
115^OP
"UP",115,115.1626,-1)
115.016^SP
"UP",115,115.1626,0)
115.1626
"UP",115,115.1627,-2)
115^OP
"UP",115,115.1627,-1)
115.016^SF
"UP",115,115.1627,0)
115.1627
"VER")
8.0^22.0
"^DD",115,115,.01,0)
NAME^RF^^0;1^K:$L(X)>15!($L(X)<2)!'(X?1"P"1.11N!(X?1"N"1.11N)) X
"^DD",115,115,.01,1,0)
^.1
"^DD",115,115,.01,1,1,0)
115^B
"^DD",115,115,.01,1,1,1)
S ^FHPT("B",$E(X,1,30),DA)=""
"^DD",115,115,.01,1,1,2)
K ^FHPT("B",$E(X,1,30),DA)
"^DD",115,115,.01,1,1,"%D",0)
^^2^2^3030219^
"^DD",115,115,.01,1,1,"%D",1,0)
A standard "B" cross-reference on the .01 field for file 115.
"^DD",115,115,.01,1,1,"%D",2,0)
Added 2/19/2003.
"^DD",115,115,.01,1,1,"DT")
3030219
"^DD",115,115,.01,3)
Answer must be 2-15 characters in length.
"^DD",115,115,.01,21,0)
^.001^14^14^3060412^^^^
"^DD",115,115,.01,21,1,0)
Beginning with the Outpatient Meals release this field will simply be a
"^DD",115,115,.01,21,2,0)
free text field.  This file will need to point to either File #2 or File #200
"^DD",115,115,.01,21,3,0)
and those pointer values will be stored in fields #14 & #15 respectively.
"^DD",115,115,.01,21,4,0)
Those 2 fields will be mutually exclusive, ie, each entry in this file must
"^DD",115,115,.01,21,5,0)
have a pointer value in EITHER field #14 OR field #15, BUT NOT BOTH.
"^DD",115,115,.01,21,6,0)

"^DD",115,115,.01,21,7,0)
Previously, this field was a pointer to the main ^DPT file and had the same
"^DD",115,115,.01,21,8,0)
internal number as that file. Thus, the patient's name was the ^DPT name.
"^DD",115,115,.01,21,9,0)
This was no longer feasible since it was necessary to point to file #200 also.
"^DD",115,115,.01,21,10,0)

"^DD",115,115,.01,21,11,0)
This field will now store either "P" followed by a pointer value to file #2
"^DD",115,115,.01,21,12,0)
or an "N" followed by a pointer value to #200.  For example, this field
"^DD",115,115,.01,21,13,0)
might store P27 for IEN #27 in file #2.  Or this field might store N1866 for
"^DD",115,115,.01,21,14,0)
IEN #1866 in file #200.
"^DD",115,115,.01,"DT")
3060412
"^DD",115,115,16,0)
RECURRING MEALS^115.016D^^OP;0
"^DD",115,115,16,21,0)
^.001^1^1^3060926^^^^
"^DD",115,115,16,21,1,0)
This multiple stores the recurring meals data.
"^DD",115,115,16,"DT")
3030417
"^DD",115,115,17,0)
SPECIAL MEALS^115.017D^^SM;0
"^DD",115,115,17,21,0)
^.001^1^1^3060720^^^^
"^DD",115,115,17,21,1,0)
This multiple stores special meals data.
"^DD",115,115,18,0)
GUEST MEALS^115.018D^^GM;0
"^DD",115,115,18,21,0)
^.001^1^1^3060720^^^^
"^DD",115,115,18,21,1,0)
This multiple stores the guest meals data.
"^DD",115,115.016,0)
RECURRING MEALS SUB-FIELD^^2.5^38
"^DD",115,115.016,0,"DT")
3060720
"^DD",115,115.016,0,"IX","B",115.016,.01)

"^DD",115,115.016,0,"IX","C",115.016,5)

"^DD",115,115.016,0,"NM","RECURRING MEALS")

"^DD",115,115.016,0,"UP")
115
"^DD",115,115.016,.01,0)
RECURRING MEAL DATE/TIME^MDX^^0;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,.01,1,0)
^.1
"^DD",115,115.016,.01,1,1,0)
115.016^B
"^DD",115,115.016,.01,1,1,1)
S ^FHPT(DA(1),"OP","B",$E(X,1,30),DA)=""
"^DD",115,115.016,.01,1,1,2)
K ^FHPT(DA(1),"OP","B",$E(X,1,30),DA)
"^DD",115,115.016,.01,1,2,0)
115^OP^MUMPS
"^DD",115,115.016,.01,1,2,1)
S ^FHPT("OP",DA(1),DA)=""
"^DD",115,115.016,.01,1,2,2)
K ^FHPT("OP",DA(1),DA)
"^DD",115,115.016,.01,1,2,"DT")
3030228
"^DD",115,115.016,.01,1,3,0)
115^RM
"^DD",115,115.016,.01,1,3,1)
S ^FHPT("RM",$E(X,1,30),DA(1),DA)=""
"^DD",115,115.016,.01,1,3,2)
K ^FHPT("RM",$E(X,1,30),DA(1),DA)
"^DD",115,115.016,.01,1,3,"%D",0)
^.101^1^1^3041215^^
"^DD",115,115.016,.01,1,3,"%D",1,0)
Cross reference the whole file by recurring meals date.
"^DD",115,115.016,.01,1,3,"DT")
3030702
"^DD",115,115.016,.01,21,0)
^.001^1^1^3040429^^^^
"^DD",115,115.016,.01,21,1,0)
This field will contain the date of the recurring meal.
"^DD",115,115.016,.01,"DT")
3040429
"^DD",115,115.016,.05,0)
RECURRING OE/RR ORDER^P100'^OR(100,^0;12^Q
"^DD",115,115.016,.05,21,0)
^^2^2^3031202^
"^DD",115,115.016,.05,21,1,0)
This field contains a pointer to the OE/RR file order corresponding to this
"^DD",115,115.016,.05,21,2,0)
order.
"^DD",115,115.016,.05,"DT")
3031202
"^DD",115,115.016,1,0)
DIET^P111'X^FH(111,^0;2^Q
"^DD",115,115.016,1,21,0)
^.001^3^3^3030403^^^^
"^DD",115,115.016,1,21,1,0)
This is the DIET ordered for this meal plan.  It contains a pointer to the
"^DD",115,115.016,1,21,2,0)
DIETS (#111) file.  It may contain any one of the 5 diets selected in the
"^DD",115,115.016,1,21,3,0)
Recurring Meals Diet Selection (1-5) site parameter.
"^DD",115,115.016,1,"DT")
3030224
"^DD",115,115.016,2,0)
OUTPATIENT LOCATION^P119.6'^FH(119.6,^0;3^Q
"^DD",115,115.016,2,1,0)
^.1
"^DD",115,115.016,2,1,1,0)
115^C
"^DD",115,115.016,2,1,1,1)
S ^FHPT("C",$E(X,1,30),DA(1),DA)=""
"^DD",115,115.016,2,1,1,2)
K ^FHPT("C",$E(X,1,30),DA(1),DA)
"^DD",115,115.016,2,1,1,"DT")
3030327
"^DD",115,115.016,2,21,0)
^.001^1^1^3030225^^^
"^DD",115,115.016,2,21,1,0)
Pointer to file #119.6 to store the location for this meal.
"^DD",115,115.016,2,"DT")
3030327
"^DD",115,115.016,2.5,0)
ROOM-BED^P405.4'^DG(405.4,^0;18^Q
"^DD",115,115.016,2.5,21,0)
^^2^2^3060720^
"^DD",115,115.016,2.5,21,1,0)
This field will store the ROOM and BED # for the outpatient recurring meal
"^DD",115,115.016,2.5,21,2,0)
being ordered.
"^DD",115,115.016,2.5,"DT")
3060720
"^DD",115,115.016,3,0)
MEAL^S^B:Breakfast;N:Noon;E:Evening;^0;4^Q
"^DD",115,115.016,3,21,0)
^.001^1^1^3030527^^^^
"^DD",115,115.016,3,21,1,0)
This field indicated which meal(s) the recurring meal is ordered for.
"^DD",115,115.016,3,"DT")
3030527
"^DD",115,115.016,4,0)
ZZZDELETE -> BAGGED MEAL^S^Y:Yes;N:No;^0;5^Q
"^DD",115,115.016,4,21,0)
^.001^1^1^3050407^^
"^DD",115,115.016,4,21,1,0)
This field indicates whether or not a bagged meal is desired.
"^DD",115,115.016,4,"DT")
3050407
"^DD",115,115.016,5,0)
MEAL PLAN ORDER NUMBER^NJ3,0^^0;6^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.016,5,1,0)
^.1
"^DD",115,115.016,5,1,1,0)
115.016^C
"^DD",115,115.016,5,1,1,1)
S ^FHPT(DA(1),"OP","C",$E(X,1,30),DA)=""
"^DD",115,115.016,5,1,1,2)
K ^FHPT(DA(1),"OP","C",$E(X,1,30),DA)
"^DD",115,115.016,5,1,1,"%D",0)
^^2^2^3030325^
"^DD",115,115.016,5,1,1,"%D",1,0)
This cross-reference will group together the meal plan dates for each
"^DD",115,115.016,5,1,1,"%D",2,0)
meal plan order if the patient has more than one meal plan.
"^DD",115,115.016,5,1,1,"DT")
3030325
"^DD",115,115.016,5,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",115,115.016,5,21,0)
^.001^2^2^3030416^^
"^DD",115,115.016,5,21,1,0)
This field will be used to tie a meal plan together and distinguish it from
"^DD",115,115.016,5,21,2,0)
other meal plans the person may have.
"^DD",115,115.016,5,"DT")
3030416
"^DD",115,115.016,6,0)
DIET1^P111'^FH(111,^0;7^Q
"^DD",115,115.016,6,21,0)
^.001^2^2^3030324^^
"^DD",115,115.016,6,21,1,0)
This field will store the first of the diet selections for outpatients
"^DD",115,115.016,6,21,2,0)
who are allowed to have up to 5 diets.
"^DD",115,115.016,6,"DT")
3030324
"^DD",115,115.016,7,0)
DIET2^P111'^FH(111,^0;8^Q
"^DD",115,115.016,7,21,0)
^^2^2^3030220^
"^DD",115,115.016,7,21,1,0)
This field will store the second of the diet selections for outpatients
"^DD",115,115.016,7,21,2,0)
who are allowed to have up to 5 diets.
"^DD",115,115.016,7,"DT")
3030324
"^DD",115,115.016,8,0)
DIET3^P111'^FH(111,^0;9^Q
"^DD",115,115.016,8,21,0)
^^2^2^3030220^
"^DD",115,115.016,8,21,1,0)
This field will store the third of the diet selections for outpatients
"^DD",115,115.016,8,21,2,0)
who are allowed to have up to 5 diets.
"^DD",115,115.016,8,"DT")
3030324
"^DD",115,115.016,9,0)
DIET4^P111'^FH(111,^0;10^Q
"^DD",115,115.016,9,21,0)
^^2^2^3030220^
"^DD",115,115.016,9,21,1,0)
This field will store the fourth of the diet selections for outpatients
"^DD",115,115.016,9,21,2,0)
who are allowed to have up to 5 diets.
"^DD",115,115.016,9,"DT")
3030324
"^DD",115,115.016,10,0)
DIET5^P111'^FH(111,^0;11^Q
"^DD",115,115.016,10,21,0)
^^2^2^3030220^
"^DD",115,115.016,10,21,1,0)
This field will store the fifth of the diet selections for outpatients
"^DD",115,115.016,10,21,2,0)
who are allowed to have up to 5 diets.
"^DD",115,115.016,10,"DT")
3030324
"^DD",115,115.016,11,0)
ADDITIONAL ORDERS TEXT^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",115,115.016,11,3)
Answer must be 1-160 characters in length.
"^DD",115,115.016,11,21,0)
^^1^1^3030520^
"^DD",115,115.016,11,21,1,0)
This field stores the text of the additional order.
"^DD",115,115.016,11,"DT")
3030520
"^DD",115,115.016,12,0)
ADDITIONAL ORDERS CLERK^P200'^VA(200,^1;2^Q
"^DD",115,115.016,12,21,0)
^.001^1^1^3050630^^
"^DD",115,115.016,12,21,1,0)
This field stores the clerk who entered the additional order.
"^DD",115,115.016,12,"DT")
3030520
"^DD",115,115.016,13,0)
ADDITIONAL ORDERS DATE/TIME^D^^1;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,13,21,0)
^^1^1^3030520^
"^DD",115,115.016,13,21,1,0)
This field stores the date/time the additional order was entered.
"^DD",115,115.016,13,"DT")
3030520
"^DD",115,115.016,13.5,0)
ADDITIONAL ORDERS OE/RR ORDER^P100'^OR(100,^1;4^Q
"^DD",115,115.016,13.5,21,0)
^^2^2^3031202^
"^DD",115,115.016,13.5,21,1,0)
This field contains a pointer to the OE/RR file order corresponding to this
"^DD",115,115.016,13.5,21,2,0)
order.
"^DD",115,115.016,13.5,"DT")
3031202
"^DD",115,115.016,13.6,0)
ADDITIONAL ORDERS STATUS^S^C:Cancelled;O:Ordered;^1;5^Q
"^DD",115,115.016,13.6,21,0)
^.001^2^2^3040429^^
"^DD",115,115.016,13.6,21,1,0)
Additional orders which are cancelled will be flagged by setting this
"^DD",115,115.016,13.6,21,2,0)
field to C rather than deleting entries from the file.
"^DD",115,115.016,13.6,"DT")
3040429
"^DD",115,115.016,14,0)
EARLY/LATE TRAY TIME^F^^2;1^K:$L(X)>10!($L(X)<1) X
"^DD",115,115.016,14,3)
Answer must be 1-10 characters in length.
"^DD",115,115.016,14,21,0)
^^1^1^3030522^
"^DD",115,115.016,14,21,1,0)
This field will store the time for the early/late tray.
"^DD",115,115.016,14,"DT")
3030522
"^DD",115,115.016,15,0)
EARLY/LATE TRAY BAGGED MEAL^S^N:NO;Y:YES;^2;2^Q
"^DD",115,115.016,15,21,0)
^^1^1^3030522^
"^DD",115,115.016,15,21,1,0)
This field will store whether or not the early/late tray is a bagged meal.
"^DD",115,115.016,15,"DT")
3030522
"^DD",115,115.016,16,0)
EARLY/LATE TRAY CLERK^P200'^VA(200,^2;3^Q
"^DD",115,115.016,16,21,0)
^^1^1^3030522^
"^DD",115,115.016,16,21,1,0)
This field will store the person who entered the early/late tray.
"^DD",115,115.016,16,"DT")
3030522
"^DD",115,115.016,17,0)
EARLY/LATE TRAY ENTRY DATE^D^^2;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,17,21,0)
^.001^1^1^3060720^^
"^DD",115,115.016,17,21,1,0)
This field will store the date/time the early/late tray was entered.
"^DD",115,115.016,17,"DT")
3030522
"^DD",115,115.016,17.5,0)
EARLY/LATE TRAY OE/RR ORDER^P100'^OR(100,^2;5^Q
"^DD",115,115.016,17.5,21,0)
^^2^2^3031202^
"^DD",115,115.016,17.5,21,1,0)
This field contains a pointer to the OE/RR file order corresponding to this
"^DD",115,115.016,17.5,21,2,0)
order.
"^DD",115,115.016,17.5,"DT")
3031202
"^DD",115,115.016,17.6,0)
EARLY/LATE TRAY STATUS^S^C:Cancelled;O:Ordered;^2;6^Q
"^DD",115,115.016,17.6,21,0)
^^2^2^3040429^
"^DD",115,115.016,17.6,21,1,0)
Early/Late trays which are cancelled will be flagged by setting this
"^DD",115,115.016,17.6,21,2,0)
field to C rather than deleting entries from the file.
"^DD",115,115.016,17.6,"DT")
3040429
"^DD",115,115.016,18,0)
TUBEFEEDING COMMENT^F^^3;1^K:$L(X)>160!($L(X)<1) X
"^DD",115,115.016,18,3)
Answer must be 1-160 characters in length.
"^DD",115,115.016,18,21,0)
^^1^1^3030606^
"^DD",115,115.016,18,21,1,0)
This field stores the tubefeeding comment(s) for the recurring meal.
"^DD",115,115.016,18,"DT")
3030606
"^DD",115,115.016,19,0)
TUBEFEEDING PRODUCT^115.1619P^^TF;0
"^DD",115,115.016,19,21,0)
^.001^1^1^3051102^^^
"^DD",115,115.016,19,21,1,0)
This multiple stores the tubefeeding product data for the recurring meal.
"^DD",115,115.016,20,0)
TUBEFEEDING TOTAL ML'S^NJ4,0^^3;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.016,20,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.016,20,21,0)
^^2^2^3050422^
"^DD",115,115.016,20,21,1,0)
This field stores the total ml's of the tubefeeding for the recurring 
"^DD",115,115.016,20,21,2,0)
meal.
"^DD",115,115.016,20,"DT")
3050422
"^DD",115,115.016,21,0)
TUBEFEEDING TOTAL KCALS/DAY^NJ4,0^^3;3^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.016,21,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.016,21,21,0)
^^1^1^3030606^
"^DD",115,115.016,21,21,1,0)
This field stores the total kcals/day of the tubefeeding for the recurring meal.
"^DD",115,115.016,21,"DT")
3030606
"^DD",115,115.016,21.5,0)
TUBEFEEDING OE/RR ORDER^P100'^OR(100,^3;4^Q
"^DD",115,115.016,21.5,21,0)
^^2^2^3031202^
"^DD",115,115.016,21.5,21,1,0)
This field contains a pointer to the OE/RR file order corresponding to this
"^DD",115,115.016,21.5,21,2,0)
order.
"^DD",115,115.016,21.5,"DT")
3031202
"^DD",115,115.016,21.6,0)
TUBEFEEDING STATUS^S^C:Cancelled;O:Ordered;^3;5^Q
"^DD",115,115.016,21.6,21,0)
^^2^2^3040429^
"^DD",115,115.016,21.6,21,1,0)
Tubefeedings which are cancelled will be flagged by setting this
"^DD",115,115.016,21.6,21,2,0)
field to C rather than deleting entries from the file.
"^DD",115,115.016,21.6,"DT")
3040429
"^DD",115,115.016,21.7,0)
TUBEFEEDING CLERK^P200'^VA(200,^3;6^Q
"^DD",115,115.016,21.7,21,0)
^^1^1^3050630^
"^DD",115,115.016,21.7,21,1,0)
This field stores the clerk who entered the tubefeeding order.
"^DD",115,115.016,21.7,"DT")
3050630
"^DD",115,115.016,22,0)
DATE/TIME TICKET LAST PRINTED^D^^0;13^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,22,21,0)
^^2^2^3040224^
"^DD",115,115.016,22,21,1,0)
Stores the last date and time a tray ticket was printed for this
"^DD",115,115.016,22,21,2,0)
outpatient meal.
"^DD",115,115.016,22,"DT")
3040224
"^DD",115,115.016,23,0)
DATE/TIME CARD LAST PRINTED^D^^0;14^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,23,21,0)
^^2^2^3040224^
"^DD",115,115.016,23,21,1,0)
Stores the last date and time a diet card was printed for this
"^DD",115,115.016,23,21,2,0)
outpatient meal.
"^DD",115,115.016,23,"DT")
3040224
"^DD",115,115.016,24,0)
RECURRING MEAL STATUS^S^C:Cancelled;O:Ordered;^0;15^Q
"^DD",115,115.016,24,21,0)
^.001^2^2^3050630^^
"^DD",115,115.016,24,21,1,0)
Recurring meals which are cancelled will be flagged by setting this
"^DD",115,115.016,24,21,2,0)
field to C rather than deleting entries from the file.
"^DD",115,115.016,24,"DT")
3050630
"^DD",115,115.016,24.5,0)
RECURRING MEAL CLERK^P200'^VA(200,^0;17^Q
"^DD",115,115.016,24.5,21,0)
^^1^1^3050630^
"^DD",115,115.016,24.5,21,1,0)
This field stores the clerk who entered the recurring meal order.
"^DD",115,115.016,24.5,"DT")
3050630
"^DD",115,115.016,25,0)
DATE/TIME RM LAST EDITED^D^^0;16^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.016,25,21,0)
^^2^2^3041206^
"^DD",115,115.016,25,21,1,0)
This field stores the last date/time the recurring meal was edited for
"^DD",115,115.016,25,21,2,0)
use with printing the tray tickets.
"^DD",115,115.016,25,"DT")
3041206
"^DD",115,115.016,26,0)
STANDING ORDERS^115.1626^^SP;0
"^DD",115,115.016,26,"DT")
3051108
"^DD",115,115.016,27,0)
SUPPLEMENTAL FEEDING^115.1627^^SF;0
"^DD",115,115.017,0)
SPECIAL MEALS SUB-FIELD^^2.5^18
"^DD",115,115.017,0,"DT")
3060720
"^DD",115,115.017,0,"IX","B",115.017,.01)

"^DD",115,115.017,0,"NM","SPECIAL MEALS")

"^DD",115,115.017,0,"UP")
115
"^DD",115,115.017,.01,0)
SPECIAL MEAL DATE/TIME^MDX^^0;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X I D(X) S DINUM=X
"^DD",115,115.017,.01,1,0)
^.1
"^DD",115,115.017,.01,1,1,0)
115.017^B
"^DD",115,115.017,.01,1,1,1)
S ^FHPT(DA(1),"SM","B",$E(X,1,30),DA)=""
"^DD",115,115.017,.01,1,1,2)
K ^FHPT(DA(1),"SM","B",$E(X,1,30),DA)
"^DD",115,115.017,.01,1,2,0)
115^SM
"^DD",115,115.017,.01,1,2,1)
S ^FHPT("SM",$E(X,1,30),DA(1),DA)=""
"^DD",115,115.017,.01,1,2,2)
K ^FHPT("SM",$E(X,1,30),DA(1),DA)
"^DD",115,115.017,.01,1,2,"%D",0)
^.101^1^1^3030630^^
"^DD",115,115.017,.01,1,2,"%D",1,0)
Cross reference the whole file by special meals.
"^DD",115,115.017,.01,1,2,"DT")
3030421
"^DD",115,115.017,.01,3)

"^DD",115,115.017,.01,21,0)
^.001^1^1^3030429^^^^
"^DD",115,115.017,.01,21,1,0)
This field will contain the date/time of the special meal.
"^DD",115,115.017,.01,"DT")
3030514
"^DD",115,115.017,1,0)
STATUS^S^P:PENDING;C:CANCELLED;A:AUTHORIZED;D:DENIED;^0;2^Q
"^DD",115,115.017,1,1,0)
^.1^^0
"^DD",115,115.017,1,3)

"^DD",115,115.017,1,21,0)
^.001^2^2^3030417^^^^
"^DD",115,115.017,1,21,1,0)
This field will store the status of the special meal request.
"^DD",115,115.017,1,21,2,0)
The allowable statuses are PENDING, CANCELLED, AUTHORIZED or DENIED.
"^DD",115,115.017,1,"DT")
3030429
"^DD",115,115.017,2,0)
LOCATION^P119.6'^FH(119.6,^0;3^Q
"^DD",115,115.017,2,1,0)
^.1^^0
"^DD",115,115.017,2,3)

"^DD",115,115.017,2,21,0)
^.001^2^2^3030408^^^^
"^DD",115,115.017,2,21,1,0)
This field will store the location for a patient who has requested
"^DD",115,115.017,2,21,2,0)
a special "one-time" meal.
"^DD",115,115.017,2,"DT")
3030429
"^DD",115,115.017,2.5,0)
ROOM-BED^P405.4'^DG(405.4,^0;13^Q
"^DD",115,115.017,2.5,21,0)
^^2^2^3060720^
"^DD",115,115.017,2.5,21,1,0)
This field will store the ROOM and BED # for the outpatient special meal
"^DD",115,115.017,2.5,21,2,0)
being ordered.
"^DD",115,115.017,2.5,"DT")
3060720
"^DD",115,115.017,3,0)
DIET^P111'^FH(111,^0;4^Q
"^DD",115,115.017,3,21,0)
^^2^2^3030408^
"^DD",115,115.017,3,21,1,0)
This field will store the diet entered for a patient who has requested
"^DD",115,115.017,3,21,2,0)
a special "one-time" meal.
"^DD",115,115.017,3,"DT")
3030429
"^DD",115,115.017,3.5,0)
MEAL^S^B:Breakfast;N:Noon;E:Evening;^0;9^Q
"^DD",115,115.017,3.5,21,0)
^^1^1^3030827^
"^DD",115,115.017,3.5,21,1,0)
This field will store the meal (breakfast/noon/evening) for the special meal.
"^DD",115,115.017,3.5,"DT")
3030827
"^DD",115,115.017,4,0)
REQUESTOR^P200'^VA(200,^0;5^Q
"^DD",115,115.017,4,3)

"^DD",115,115.017,4,21,0)
^.001^2^2^3030417^^^
"^DD",115,115.017,4,21,1,0)
This field will store the name of the person who has requested the
"^DD",115,115.017,4,21,2,0)
special meal.  This field is a pointer to the NEW PERSON (#200) file.
"^DD",115,115.017,4,"DT")
3030429
"^DD",115,115.017,5,0)
AUTHORIZOR^P200'^VA(200,^0;6^Q
"^DD",115,115.017,5,21,0)
^.001^2^2^3030417^^^
"^DD",115,115.017,5,21,1,0)
This field will store the name of the person who has authorized the
"^DD",115,115.017,5,21,2,0)
special meal.  This field is a pointer to the NEW PERSON (#200) file.
"^DD",115,115.017,5,"DT")
3030429
"^DD",115,115.017,6,0)
AUTHORIZE/DENY DATE/TIME^D^^0;7^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.017,6,21,0)
^.001^1^1^3030429^^
"^DD",115,115.017,6,21,1,0)
This field stores the date/time that the special meal was authorized or denied.
"^DD",115,115.017,6,"DT")
3030429
"^DD",115,115.017,7,0)
COMMENT^F^^0;8^K:$L(X)>80!($L(X)<1) X
"^DD",115,115.017,7,3)
Answer must be 1-80 characters in length.
"^DD",115,115.017,7,21,0)
^^2^2^3030508^
"^DD",115,115.017,7,21,1,0)
If the special meal request is denied the authorizor may enter the reason
"^DD",115,115.017,7,21,2,0)
why it was denied in this comment field.
"^DD",115,115.017,7,"DT")
3030508
"^DD",115,115.017,8,0)
EARLY/LATE TRAY TIME^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",115,115.017,8,3)
Answer must be 1-10 characters in length.
"^DD",115,115.017,8,21,0)
^^1^1^3030915^
"^DD",115,115.017,8,21,1,0)
This field will store the time for the early/late tray.
"^DD",115,115.017,8,"DT")
3030915
"^DD",115,115.017,9,0)
EARLY/LATE TRAY BAGGED MEAL^S^Y:YES;N:NO;^1;2^Q
"^DD",115,115.017,9,21,0)
^^1^1^3030915^
"^DD",115,115.017,9,21,1,0)
This field will store whether or not the early/late tray is a bagged meal.
"^DD",115,115.017,9,"DT")
3030915
"^DD",115,115.017,10,0)
EARLY/LATE TRAY CLERK^P200'^VA(200,^1;3^Q
"^DD",115,115.017,10,21,0)
^^1^1^3030915^
"^DD",115,115.017,10,21,1,0)
This field will store the person who entered the early/late tray.
"^DD",115,115.017,10,"DT")
3030915
"^DD",115,115.017,11,0)
EARLY/LATE TRAY OE/RR ORDER^P100'^OR(100,^1;4^Q
"^DD",115,115.017,11,21,0)
^^2^2^3050822^
"^DD",115,115.017,11,21,1,0)
This field is a pointer to the corresponding entry in the ORDERS (#100) 
"^DD",115,115.017,11,21,2,0)
file.
"^DD",115,115.017,11,"DT")
3050822
"^DD",115,115.017,11.5,0)
EARLY/LATE TRAY STATUS^S^A:ACTIVE;C:CANCELLED;^1;5^Q
"^DD",115,115.017,11.5,21,0)
^^1^1^3050822^
"^DD",115,115.017,11.5,21,1,0)
This field will be "A" for Active or "C" for cancelled.
"^DD",115,115.017,11.5,"DT")
3050822
"^DD",115,115.017,12,0)
DATE/TIME TICKET LAST PRINTED^D^^0;10^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.017,12,21,0)
^^2^2^3040224^
"^DD",115,115.017,12,21,1,0)
Stores the last date and time a tray ticket was printed for this
"^DD",115,115.017,12,21,2,0)
outpatient meal.
"^DD",115,115.017,12,"DT")
3040224
"^DD",115,115.017,13,0)
DATE/TIME CARD LAST PRINTED^D^^0;11^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.017,13,21,0)
^^2^2^3040224^
"^DD",115,115.017,13,21,1,0)
Stores the last date and time a diet card was printed for this
"^DD",115,115.017,13,21,2,0)
outpatient meal.
"^DD",115,115.017,13,"DT")
3040224
"^DD",115,115.017,14,0)
SPECIAL OE/RR ORDER^P100'^OR(100,^0;12^Q
"^DD",115,115.017,14,21,0)
^^1^1^3040608^
"^DD",115,115.017,14,21,1,0)
Pointer to File #100 for Special Meals entered via OE/RR.
"^DD",115,115.017,14,"DT")
3040608
"^DD",115,115.018,0)
GUEST MEALS SUB-FIELD^^4.5^11
"^DD",115,115.018,0,"DT")
3060720
"^DD",115,115.018,0,"IX","B",115.018,.01)

"^DD",115,115.018,0,"NM","GUEST MEALS")

"^DD",115,115.018,0,"UP")
115
"^DD",115,115.018,.01,0)
GUEST MEAL DATE/TIME^MDX^^0;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X I D(X) S DINUM=X
"^DD",115,115.018,.01,1,0)
^.1
"^DD",115,115.018,.01,1,1,0)
115.018^B
"^DD",115,115.018,.01,1,1,1)
S ^FHPT(DA(1),"GM","B",$E(X,1,30),DA)=""
"^DD",115,115.018,.01,1,1,2)
K ^FHPT(DA(1),"GM","B",$E(X,1,30),DA)
"^DD",115,115.018,.01,1,2,0)
115^GM
"^DD",115,115.018,.01,1,2,1)
S ^FHPT("GM",$E(X,1,30),DA(1),DA)=""
"^DD",115,115.018,.01,1,2,2)
K ^FHPT("GM",$E(X,1,30),DA(1),DA)
"^DD",115,115.018,.01,1,2,"%D",0)
^.101^1^1^3030702^^^
"^DD",115,115.018,.01,1,2,"%D",1,0)
Cross reference the whole file by the guest meals date
"^DD",115,115.018,.01,1,2,"DT")
3030701
"^DD",115,115.018,.01,21,0)
^.001^1^1^3030417^^
"^DD",115,115.018,.01,21,1,0)
This field will contain the date/time of the guest meal.
"^DD",115,115.018,.01,"DT")
3030701
"^DD",115,115.018,1,0)
CLASSIFICATION^S^E:EMPLOYEE;G:GRATUITOUS;O:OOD;P:PAID;V:VOLUNTEER;^0;2^Q
"^DD",115,115.018,1,21,0)
^^1^1^3030417^
"^DD",115,115.018,1,21,1,0)
This field will contain the classification type for the guest meal.
"^DD",115,115.018,1,"DT")
3030417
"^DD",115,115.018,2,0)
MEAL^S^B:Breakfast;N:Noon;E:Evening;^0;3^Q
"^DD",115,115.018,2,21,0)
^.001^1^1^3030827^^
"^DD",115,115.018,2,21,1,0)
This field will store the meal (breakfast/noon/evening) for the guest meal.
"^DD",115,115.018,2,"DT")
3030827
"^DD",115,115.018,3,0)
CHARGE^NJ6,2^^0;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",115,115.018,3,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",115,115.018,3,21,0)
^^1^1^3030630^
"^DD",115,115.018,3,21,1,0)
This field stores the charge amount for the guest meal.
"^DD",115,115.018,3,"DT")
3030630
"^DD",115,115.018,4,0)
LOCATION^P119.6'^FH(119.6,^0;5^Q
"^DD",115,115.018,4,21,0)
^.001^1^1^3040218^^
"^DD",115,115.018,4,21,1,0)
This field indicates the location for this guest meal request.
"^DD",115,115.018,4,"DT")
3040218
"^DD",115,115.018,4.5,0)
ROOM-BED^P405.4'^DG(405.4,^0;11^Q
"^DD",115,115.018,4.5,21,0)
^^2^2^3060720^
"^DD",115,115.018,4.5,21,1,0)
This field will store the ROOM and BED # for the outpatient recurring meal
"^DD",115,115.018,4.5,21,2,0)
being ordered.
"^DD",115,115.018,4.5,"DT")
3060720
"^DD",115,115.018,5,0)
DIET^P111'^FH(111,^0;6^Q
"^DD",115,115.018,5,21,0)
^^2^2^3040219^
"^DD",115,115.018,5,21,1,0)
This is the Diet for the guest meal.  The diet will be stuffed from the
"^DD",115,115.018,5,21,2,0)
value set in the OUTPATIENT DIET1 site parameter in file #119.9.
"^DD",115,115.018,5,"DT")
3040219
"^DD",115,115.018,6,0)
DATE/TIME TICKET LAST PRINTED^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.018,6,21,0)
^^2^2^3040224^
"^DD",115,115.018,6,21,1,0)
Stores the last date and time a diet card was printed for this
"^DD",115,115.018,6,21,2,0)
outpatient meal.
"^DD",115,115.018,6,"DT")
3040224
"^DD",115,115.018,7,0)
DATE/TIME CARD LAST PRINTED^D^^0;8^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.018,7,21,0)
^^2^2^3040224^
"^DD",115,115.018,7,21,1,0)
Stores the last date and time a diet card was printed for this
"^DD",115,115.018,7,21,2,0)
outpatient meal.
"^DD",115,115.018,7,"DT")
3040224
"^DD",115,115.018,8,0)
STATUS^S^C:CANCELLED;O:ORDERED;^0;9^Q
"^DD",115,115.018,8,21,0)
^^2^2^3051121^
"^DD",115,115.018,8,21,1,0)
This field stores the status of the guest meal, which is either "ordered"
"^DD",115,115.018,8,21,2,0)
or "cancelled".
"^DD",115,115.018,8,"DT")
3051121
"^DD",115,115.018,9,0)
GUEST MEAL CLERK^P200'^VA(200,^0;10^Q
"^DD",115,115.018,9,21,0)
^^1^1^3051121^
"^DD",115,115.018,9,21,1,0)
This field stores the person who has entered the guest meal.
"^DD",115,115.018,9,"DT")
3051121
"^DD",115,115.1619,0)
TUBEFEEDING PRODUCT SUB-FIELD^^5^6
"^DD",115,115.1619,0,"DT")
3030606
"^DD",115,115.1619,0,"IX","B",115.1619,.01)

"^DD",115,115.1619,0,"NM","TUBEFEEDING PRODUCT")

"^DD",115,115.1619,0,"UP")
115.016
"^DD",115,115.1619,.01,0)
TUBEFEEDING PRODUCT^MP118.2'^FH(118.2,^0;1^Q
"^DD",115,115.1619,.01,1,0)
^.1
"^DD",115,115.1619,.01,1,1,0)
115.1619^B
"^DD",115,115.1619,.01,1,1,1)
S ^FHPT(DA(2),"OP",DA(1),"TF","B",$E(X,1,30),DA)=""
"^DD",115,115.1619,.01,1,1,2)
K ^FHPT(DA(2),"OP",DA(1),"TF","B",$E(X,1,30),DA)
"^DD",115,115.1619,.01,21,0)
^.001^1^1^3030606^^^
"^DD",115,115.1619,.01,21,1,0)
This multiple stores the tubefeeding product(s) for the recurring meal.
"^DD",115,115.1619,.01,"DT")
3030606
"^DD",115,115.1619,1,0)
STRENGTH^S^1:1/4;2:1/2;3:3/4;4:FULL;^0;2^Q
"^DD",115,115.1619,1,21,0)
^.001^1^1^3030606^^
"^DD",115,115.1619,1,21,1,0)
This field stores the strength of the tubefeeding for the recurring meal.
"^DD",115,115.1619,1,"DT")
3030606
"^DD",115,115.1619,2,0)
QUANTITY^F^^0;3^K:$L(X)>20!($L(X)<3) X
"^DD",115,115.1619,2,3)
Answer must be 3-20 characters in length.
"^DD",115,115.1619,2,21,0)
^^1^1^3030606^
"^DD",115,115.1619,2,21,1,0)
This field stores the quantity of the tubefeeding for the recurring meal.
"^DD",115,115.1619,2,"DT")
3030606
"^DD",115,115.1619,3,0)
PRODUCT ML'S/DAY^NJ4,0^^0;4^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1619,3,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1619,3,21,0)
^^2^2^3050422^
"^DD",115,115.1619,3,21,1,0)
This field stores the product ml's per day of this tubefeeding product
"^DD",115,115.1619,3,21,2,0)
for the recurring meal.
"^DD",115,115.1619,3,"DT")
3050422
"^DD",115,115.1619,4,0)
WATER ML'S/DAY^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1619,4,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1619,4,21,0)
^^2^2^3050422^
"^DD",115,115.1619,4,21,1,0)
This field stores the water ml's per day of this tubefeeding product
"^DD",115,115.1619,4,21,2,0)
for the recurring meal.
"^DD",115,115.1619,4,"DT")
3050422
"^DD",115,115.1619,5,0)
KCALS/DAY^NJ4,0^^0;6^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1619,5,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1619,5,21,0)
^.001^2^2^3030606^^
"^DD",115,115.1619,5,21,1,0)
This field stores the kcals per day of this tubefeeding product
"^DD",115,115.1619,5,21,2,0)
for the recurring meal.
"^DD",115,115.1619,5,"DT")
3030606
"^DD",115,115.1626,0)
STANDING ORDERS SUB-FIELD^^8^9
"^DD",115,115.1626,0,"DT")
3051103
"^DD",115,115.1626,0,"NM","STANDING ORDERS")

"^DD",115,115.1626,0,"UP")
115.016
"^DD",115,115.1626,.01,0)
STANDING ORDERS^NJ4,0^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1626,.01,1,0)
^.1^^0
"^DD",115,115.1626,.01,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1626,.01,21,0)
^^2^2^3051103^
"^DD",115,115.1626,.01,21,1,0)
This field contains the sequence number of the outpatient standing order
"^DD",115,115.1626,.01,21,2,0)
and has no meaning beyond that.  
"^DD",115,115.1626,.01,"DT")
3051103
"^DD",115,115.1626,1,0)
ORDER^RP118.3'^FH(118.3,^0;2^Q
"^DD",115,115.1626,1,21,0)
^^2^2^3051103^
"^DD",115,115.1626,1,21,1,0)
This field contains the outpatient standing order from Standing Orders
"^DD",115,115.1626,1,21,2,0)
file (#118.3).
"^DD",115,115.1626,1,"DT")
3060927
"^DD",115,115.1626,2,0)
MEALS^RFX^^0;3^S:$P("ALL",X,1)="" X="BNE" S %=X,X="" S:%["B" X="B" S:%["N" X=X_"N" S:%["E" X=X_"E" K:$L(%)'=$L(X) X K %
"^DD",115,115.1626,2,3)
Answer should be a string of meals (e.g., B  or BN or BNE) or A for all meals
"^DD",115,115.1626,2,21,0)
^^2^2^3051103^
"^DD",115,115.1626,2,21,1,0)
This field contains the meals to which this outpatient standing
"^DD",115,115.1626,2,21,2,0)
order is applicable.
"^DD",115,115.1626,2,"DT")
3051103
"^DD",115,115.1626,3,0)
DATE/TIME ORDERED^RD^^0;4^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.1626,3,21,0)
^^2^2^3051103^
"^DD",115,115.1626,3,21,1,0)
This field contains the date/time at which the outpatient standing
"^DD",115,115.1626,3,21,2,0)
order was entered.  
"^DD",115,115.1626,3,"DT")
3051103
"^DD",115,115.1626,4,0)
ENTERING CLERK^RP200'^VA(200,^0;5^Q
"^DD",115,115.1626,4,21,0)
^^2^2^3051103^
"^DD",115,115.1626,4,21,1,0)
This field contains the user who entered the outpatient
"^DD",115,115.1626,4,21,2,0)
standing order and is automatically captured at the time of entry.
"^DD",115,115.1626,4,"DT")
3051103
"^DD",115,115.1626,5,0)
DATE/TIME CANCELLED^D^^0;6^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.1626,5,21,0)
^^3^3^3051103^
"^DD",115,115.1626,5,21,1,0)
This field contains the date/time the outpatient standing order
"^DD",115,115.1626,5,21,2,0)
was cancelled and is automatically captured at time of
"^DD",115,115.1626,5,21,3,0)
cancellation.
"^DD",115,115.1626,5,"DT")
3060927
"^DD",115,115.1626,6,0)
CANCELLING CLERK^P200'^VA(200,^0;7^Q
"^DD",115,115.1626,6,21,0)
^^2^2^3051103^
"^DD",115,115.1626,6,21,1,0)
This field contains the user who entered the cancellation
"^DD",115,115.1626,6,21,2,0)
and is automatically captured at time of cancellation.  
"^DD",115,115.1626,6,"DT")
3051103
"^DD",115,115.1626,7,0)
QUANTITY^NJ1,0^^0;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1626,7,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",115,115.1626,7,21,0)
^^1^1^3051103^
"^DD",115,115.1626,7,21,1,0)
This is the quantity of the outpatient Standing Order.
"^DD",115,115.1626,7,"DT")
3051103
"^DD",115,115.1626,8,0)
DIET ASSOCIATED?^S^Y:YES;N:NO;^0;9^Q
"^DD",115,115.1626,8,21,0)
^^2^2^3051103^
"^DD",115,115.1626,8,21,1,0)
This field, if answered Yes, means this Standing Order is associated
"^DD",115,115.1626,8,21,2,0)
with a diet order else if answered No, means it is not.  
"^DD",115,115.1626,8,"DT")
3051103
"^DD",115,115.1627,0)
SUPPLEMENTAL FEEDING SUB-FIELD^^33^34
"^DD",115,115.1627,0,"DT")
3051109
"^DD",115,115.1627,0,"NM","SUPPLEMENTAL FEEDING")

"^DD",115,115.1627,0,"UP")
115.016
"^DD",115,115.1627,.01,0)
SUPPLEMENTAL FEEDING^MNJ4,0^^0;1^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",115,115.1627,.01,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",115,115.1627,.01,21,0)
^^2^2^3060926^
"^DD",115,115.1627,.01,21,1,0)
This field is merely the sequence in which various orders for
"^DD",115,115.1627,.01,21,2,0)
outpatient SFs were entered and has no meaning beyond that.
"^DD",115,115.1627,.01,"DT")
3060315
"^DD",115,115.1627,1,0)
DATE/TIME ORDERED^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.1627,1,21,0)
^^2^2^3060306^
"^DD",115,115.1627,1,21,1,0)
This is the date/time at which the order was entered and is
"^DD",115,115.1627,1,21,2,0)
captured automatically.
"^DD",115,115.1627,1,"DT")
3060306
"^DD",115,115.1627,2,0)
ENTERING CLERK^P200'^VA(200,^0;3^Q
"^DD",115,115.1627,2,21,0)
^^2^2^3060306^
"^DD",115,115.1627,2,21,1,0)
This is the person actually entering the order and is captured
"^DD",115,115.1627,2,21,2,0)
automatically at time of entry.
"^DD",115,115.1627,2,"DT")
3060306
"^DD",115,115.1627,3,0)
SF MENU^P118.1'^FH(118.1,^0;4^Q
"^DD",115,115.1627,3,21,0)
^^3^3^3060306^
"^DD",115,115.1627,3,21,1,0)
This is the supplemental feeding menu of the Supplemental Feeding
"^DD",115,115.1627,3,21,2,0)
Menu file (118.1) that was selected.  If other than "Individualized', 
"^DD",115,115.1627,3,21,3,0)
the items from the selected menu were moved into this order.
"^DD",115,115.1627,3,"DT")
3060306
"^DD",115,115.1627,4,0)
10AM FEEDING #1^P118'^FH(118,^0;5^Q
"^DD",115,115.1627,4,21,0)
^^2^2^3060306^
"^DD",115,115.1627,4,21,1,0)
This is the first supplemental feeding ordered for the 10am
"^DD",115,115.1627,4,21,2,0)
feeding time.
"^DD",115,115.1627,4,"DT")
3060306
"^DD",115,115.1627,5,0)
10AM #1 QTY^NJ2,0^^0;6^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,5,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,5,21,0)
^^1^1^2880710^^^
"^DD",115,115.1627,5,21,1,0)
This is the ordered quantity of the first 10am feeding.
"^DD",115,115.1627,5,"DT")
3051109
"^DD",115,115.1627,6,0)
10AM FEEDING #2^P118'^FH(118,^0;7^Q
"^DD",115,115.1627,6,21,0)
^^2^2^2880710^
"^DD",115,115.1627,6,21,1,0)
This is the second supplemental feeding ordered for the 10am
"^DD",115,115.1627,6,21,2,0)
feeding.
"^DD",115,115.1627,6,"DT")
3051109
"^DD",115,115.1627,7,0)
10AM #2 QTY^NJ2,0^^0;8^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,7,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,7,21,0)
^^2^2^3060306^
"^DD",115,115.1627,7,21,1,0)
This is the outpatient Supplemental Feeding ordered
"^DD",115,115.1627,7,21,2,0)
quantity for the second 10am feeding.
"^DD",115,115.1627,7,"DT")
3060306
"^DD",115,115.1627,8,0)
10AM FEEDING #3^P118'^FH(118,^0;9^Q
"^DD",115,115.1627,8,21,0)
^^2^2^3060306^
"^DD",115,115.1627,8,21,1,0)
This is the third supplemental feeding ordered for the 10am
"^DD",115,115.1627,8,21,2,0)
feeding. 
"^DD",115,115.1627,8,"DT")
3060306
"^DD",115,115.1627,9,0)
10AM #3 QTY^NJ2,0^^0;10^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,9,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,9,21,0)
^^1^1^3060306^
"^DD",115,115.1627,9,21,1,0)
This is the ordered quantity for the third 10am feeding. 
"^DD",115,115.1627,9,"DT")
3060306
"^DD",115,115.1627,10,0)
10AM FEEDING #4^P118'^FH(118,^0;11^Q
"^DD",115,115.1627,10,21,0)
^^2^2^3060306^
"^DD",115,115.1627,10,21,1,0)
This is the fourth supplemental feeding ordered for the 10am
"^DD",115,115.1627,10,21,2,0)
feeding. 
"^DD",115,115.1627,10,"DT")
3060306
"^DD",115,115.1627,11,0)
10AM #4 QTY^NJ2,0^^0;12^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,11,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,11,21,0)
^^1^1^3060306^
"^DD",115,115.1627,11,21,1,0)
This is the ordered quantity of the fourth 10am feeding. 
"^DD",115,115.1627,11,"DT")
3060306
"^DD",115,115.1627,12,0)
2PM FEEDING #1^P118'^FH(118,^0;13^Q
"^DD",115,115.1627,12,21,0)
^^2^2^2880710^
"^DD",115,115.1627,12,21,1,0)
This is the first supplemental feeding ordered for the 2pm
"^DD",115,115.1627,12,21,2,0)
feeding.
"^DD",115,115.1627,12,"DT")
3051109
"^DD",115,115.1627,13,0)
2PM #1 QTY^NJ2,0^^0;14^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,13,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,13,21,0)
^^1^1^2880710^
"^DD",115,115.1627,13,21,1,0)
This is the ordered quantity of the first 2pm feeding.
"^DD",115,115.1627,13,"DT")
3051109
"^DD",115,115.1627,14,0)
2PM FEEDING #2^P118'^FH(118,^0;15^Q
"^DD",115,115.1627,14,21,0)
^^2^2^2880710^
"^DD",115,115.1627,14,21,1,0)
This is the second supplemental feeding ordered for the 2pm
"^DD",115,115.1627,14,21,2,0)
feeding.
"^DD",115,115.1627,14,"DT")
3051109
"^DD",115,115.1627,15,0)
2PM #2 QTY^NJ2,0^^0;16^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,15,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,15,21,0)
^^1^1^2880710^
"^DD",115,115.1627,15,21,1,0)
This is the ordered quantity of the second 2pm feeding.
"^DD",115,115.1627,15,"DT")
3051109
"^DD",115,115.1627,16,0)
2PM FEEDING #3^P118'^FH(118,^0;17^Q
"^DD",115,115.1627,16,21,0)
^^2^2^2880710^
"^DD",115,115.1627,16,21,1,0)
This is the third supplemental feeding ordered for the 2pm
"^DD",115,115.1627,16,21,2,0)
feeding.
"^DD",115,115.1627,16,"DT")
3051109
"^DD",115,115.1627,17,0)
2PM #3 QTY^NJ2,0^^0;18^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,17,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,17,21,0)
^^1^1^2880710^
"^DD",115,115.1627,17,21,1,0)
This is the ordered quantity of the third 2pm feeding.
"^DD",115,115.1627,17,"DT")
3051109
"^DD",115,115.1627,18,0)
2PM FEEDING #4^P118'^FH(118,^0;19^Q
"^DD",115,115.1627,18,21,0)
^^2^2^2880710^
"^DD",115,115.1627,18,21,1,0)
This is the fourth supplemental feeding ordered for the 2pm
"^DD",115,115.1627,18,21,2,0)
feeding.
"^DD",115,115.1627,18,"DT")
3051109
"^DD",115,115.1627,19,0)
2PM #4 QTY^NJ2,0^^0;20^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,19,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,19,21,0)
^^1^1^2880710^
"^DD",115,115.1627,19,21,1,0)
This is the ordered quantity of the fourth 2pm feeding.
"^DD",115,115.1627,19,"DT")
3051109
"^DD",115,115.1627,20,0)
8PM FEEDING #1^P118'^FH(118,^0;21^Q
"^DD",115,115.1627,20,21,0)
^^2^2^2880710^
"^DD",115,115.1627,20,21,1,0)
This is the first supplemental feeding ordered for the 8pm
"^DD",115,115.1627,20,21,2,0)
feeding.
"^DD",115,115.1627,20,"DT")
3051109
"^DD",115,115.1627,21,0)
8PM #1 QTY^NJ2,0^^0;22^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,21,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,21,21,0)
^^1^1^2880710^
"^DD",115,115.1627,21,21,1,0)
This is the ordered quantity of the first 8pm feeding.
"^DD",115,115.1627,21,"DT")
3051109
"^DD",115,115.1627,22,0)
8PM FEEDING #2^P118'^FH(118,^0;23^Q
"^DD",115,115.1627,22,21,0)
^^2^2^2880710^
"^DD",115,115.1627,22,21,1,0)
This is the second supplemental feeding ordered for the 8pm
"^DD",115,115.1627,22,21,2,0)
feeding.
"^DD",115,115.1627,22,"DT")
3051109
"^DD",115,115.1627,23,0)
8PM #2 QTY^NJ2,0^^0;24^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,23,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,23,21,0)
^^1^1^2880710^
"^DD",115,115.1627,23,21,1,0)
This is the ordered quantity of the second 8pm feeding.
"^DD",115,115.1627,23,"DT")
3051109
"^DD",115,115.1627,24,0)
8PM FEEDING #3^P118'^FH(118,^0;25^Q
"^DD",115,115.1627,24,21,0)
^^2^2^2880710^
"^DD",115,115.1627,24,21,1,0)
This is the third supplemental feeding ordered for the 8pm
"^DD",115,115.1627,24,21,2,0)
feeding.
"^DD",115,115.1627,24,"DT")
3051109
"^DD",115,115.1627,25,0)
8PM #3 QTY^NJ2,0^^0;26^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,25,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,25,21,0)
^^1^1^2880710^
"^DD",115,115.1627,25,21,1,0)
This is the ordered quantity of the third 8pm feeding.
"^DD",115,115.1627,25,"DT")
3051109
"^DD",115,115.1627,26,0)
8PM FEEDING #4^P118'^FH(118,^0;27^Q
"^DD",115,115.1627,26,21,0)
^^2^2^2880710^
"^DD",115,115.1627,26,21,1,0)
This is the fourth supplemental feeding ordered for the 8pm
"^DD",115,115.1627,26,21,2,0)
feeding.
"^DD",115,115.1627,26,"DT")
3051109
"^DD",115,115.1627,27,0)
8PM #4 QTY^NJ2,0^^0;28^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1627,27,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",115,115.1627,27,21,0)
^^1^1^2880710^
"^DD",115,115.1627,27,21,1,0)
This is the ordered quantity of the fourth 8pm feeding.
"^DD",115,115.1627,27,"DT")
3051109
"^DD",115,115.1627,28,0)
DIETARY OR THERAPEUTIC^S^D:DIETARY;T:THERAPEUTIC;^0;29^Q
"^DD",115,115.1627,28,21,0)
^^2^2^2880710^
"^DD",115,115.1627,28,21,1,0)
This field indicates whether the supplemental feeding was
"^DD",115,115.1627,28,21,2,0)
ordered for dietary or therapeutic reasons.
"^DD",115,115.1627,28,"DT")
3051109
"^DD",115,115.1627,29,0)
DATE/TIME LAST REVIEW^D^^0;30^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.1627,29,21,0)
^^2^2^2880710^
"^DD",115,115.1627,29,21,1,0)
This is the date/time this supplemental feeding order was
"^DD",115,115.1627,29,21,2,0)
last reviewed for appropriateness.
"^DD",115,115.1627,29,"DT")
3051109
"^DD",115,115.1627,30,0)
REVIEW CLERK^P200'^VA(200,^0;31^Q
"^DD",115,115.1627,30,21,0)
^^2^2^2880710^
"^DD",115,115.1627,30,21,1,0)
This is the person conducting the last review and is captured
"^DD",115,115.1627,30,21,2,0)
automatically at time of review.
"^DD",115,115.1627,30,"DT")
3051109
"^DD",115,115.1627,31,0)
DATE/TIME CANCELLED^D^^0;32^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",115,115.1627,31,21,0)
^^1^1^2880710^
"^DD",115,115.1627,31,21,1,0)
This is the date/time this order was cancelled.
"^DD",115,115.1627,31,"DT")
3051109
"^DD",115,115.1627,32,0)
CANCELLING CLERK^P200'^VA(200,^0;33^Q
"^DD",115,115.1627,32,21,0)
^^2^2^2880710^
"^DD",115,115.1627,32,21,1,0)
This is the person cancelling the order and is captured
"^DD",115,115.1627,32,21,2,0)
automatically at time of cancellation.
"^DD",115,115.1627,32,"DT")
3051109
"^DD",115,115.1627,33,0)
DIET ASSOCIATED?^S^Y:YES;N:NO;^0;34^Q
"^DD",115,115.1627,33,21,0)
^^2^2^2940722^
"^DD",115,115.1627,33,21,1,0)
This field, if answered Yes, means this Supplemental Feeding Menu
"^DD",115,115.1627,33,21,2,0)
is associated with a diet order else if answered No, means it is not.
"^DD",115,115.1627,33,"DT")
3051109
"^DD",118.2,118.2,0)
FIELD^^99^8
"^DD",118.2,118.2,0,"DDA")
N
"^DD",118.2,118.2,0,"DT")
2920928
"^DD",118.2,118.2,0,"ID","WRITE")
I $D(^("I")) D EN^DDIOL("(** Inactive **)","","?3")
"^DD",118.2,118.2,0,"IX","AC",118.2,99)

"^DD",118.2,118.2,0,"IX","B",118.2,.01)

"^DD",118.2,118.2,0,"IX","C",118.21,.01)

"^DD",118.2,118.2,0,"NM","TUBEFEEDING")

"^DD",118.2,118.2,0,"PT",115.1,.01)

"^DD",118.2,118.2,0,"PT",115.1619,.01)

"^DD",118.2,118.2,0,"PT",728.451,.01)

"^DD",118.2,118.2,0,"SCR")
I '$D(^FH(118.2,+Y,"I"))!$D(^XUSEC("FHMGR",DUZ))!(DUZ(0)["@")
"^DD",118.2,118.2,0,"VRPK")
FH
"^DD",118.2,118.2,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",118.2,118.2,.01,1,0)
^.1
"^DD",118.2,118.2,.01,1,1,0)
118.2^B
"^DD",118.2,118.2,.01,1,1,1)
S ^FH(118.2,"B",$E(X,1,30),DA)=""
"^DD",118.2,118.2,.01,1,1,2)
K ^FH(118.2,"B",$E(X,1,30),DA)
"^DD",118.2,118.2,.01,1,1,"%D",0)
^^1^1^2911118^
"^DD",118.2,118.2,.01,1,1,"%D",1,0)
This is the normal B cross-reference of the NAME field.
"^DD",118.2,118.2,.01,3)
Answer must be 3-30 characters in length.
"^DD",118.2,118.2,.01,21,0)
^^2^2^2880710^
"^DD",118.2,118.2,.01,21,1,0)
This is the name of the tubefeeding product as it will appear
"^DD",118.2,118.2,.01,21,2,0)
on all lists and displays.
"^DD",118.2,118.2,.01,"DEL",1,0)
I 1 D EN^DDIOL("Cannot delete. Inactivate instead.","","?3")
"^DD",118.2,118.2,.01,"DT")
2920116
"^DD",118.2,118.2,1,0)
DISPENSING UNIT^RF^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",118.2,118.2,1,3)
ANSWER MUST BE 1-10 CHARACTERS IN LENGTH
"^DD",118.2,118.2,1,21,0)
^^2^2^2920814^^^
"^DD",118.2,118.2,1,21,1,0)
This field contains a title for the dispensing unit such
"^DD",118.2,118.2,1,21,2,0)
as bottle, can or package.
"^DD",118.2,118.2,2,0)
AMT/UNIT^RFX^^0;3^S:X[" " X=+X_$P(X," ",2) S:"MG"[$E(X,$L(+X)+1) X=+X_$E(X,$L(+X)+1) S:X["M" X=+X_"ML" K:($L(+X)>10)!($L(X)<1)!(+X>9999)!(+X<0)!("MLG"'[$E(X,$L(X))) X
"^DD",118.2,118.2,2,3)
Enter amount in ML's or in Grams.  Amount cannot exceed 9999.  The following are examples of valid entries 22ML, 40GRAMS, 20 G, or 100 M.
"^DD",118.2,118.2,2,21,0)
^^3^3^3050422^
"^DD",118.2,118.2,2,21,1,0)
This is the number of ml's or grams of product contained in the
"^DD",118.2,118.2,2,21,2,0)
dispensing unit. For products which require reconstitution
"^DD",118.2,118.2,2,21,3,0)
with water, it is the number of ml's after reconstitution.
"^DD",118.2,118.2,2,"DT")
3060727
"^DD",118.2,118.2,3,0)
KCAL/ML^RNJ7,2^^0;4^K:+X'=X!(X>1000)!(X<.1)!(X?.E1"."3N.N) X
"^DD",118.2,118.2,3,3)
Type a Number between .1 and 1000, 2 Decimal Digits
"^DD",118.2,118.2,3,21,0)
^^2^2^3050422^
"^DD",118.2,118.2,3,21,1,0)
This field contains the number of KiloCalories per ml of
"^DD",118.2,118.2,3,21,2,0)
product.
"^DD",118.2,118.2,3,"DT")
3050422
"^DD",118.2,118.2,5,0)
COST^CJ8,2^^ ; ^X ^DD(118.2,5,9.2) S X=$P(Y(118.2,5,101),U,13) S D0=Y(118.2,5,80) S X=$J(X,0,2)
"^DD",118.2,118.2,5,3)
TYPE A NUMBER BETWEEN 0 AND 100
"^DD",118.2,118.2,5,9)
^
"^DD",118.2,118.2,5,9.01)
114^101;118.2^11
"^DD",118.2,118.2,5,9.1)
CORRESPONDING RECIPE:COST/PORTION
"^DD",118.2,118.2,5,9.2)
S Y(118.2,5,80)=$S($D(D0):D0,1:""),Y(118.2,5,1)=$S($D(^FH(118.2,D0,0)):^(0),1:""),D0=$P(Y(118.2,5,1),U,7) S:'$D(^FH(114,+D0,0)) D0=-1 S Y(118.2,5,101)=$S($D(^FH(114,D0,0)):^(0),1:"")
"^DD",118.2,118.2,5,21,0)
^^3^3^2950613^^^^
"^DD",118.2,118.2,5,21,1,0)
This is the portion cost of the tubefeeding and is a
"^DD",118.2,118.2,5,21,2,0)
computed field which obtains the value from the recipe file based
"^DD",118.2,118.2,5,21,3,0)
upon the 'Corresponding Recipe' pointer.
"^DD",118.2,118.2,5,"DT")
2850928
"^DD",118.2,118.2,10,0)
SYNONYM^118.21^^1;0
"^DD",118.2,118.2,10,21,0)
^^3^3^2920818^^
"^DD",118.2,118.2,10,21,1,0)
This multiple contains alternate names or synonyms for the
"^DD",118.2,118.2,10,21,2,0)
product. These names should include any names commonly known
"^DD",118.2,118.2,10,21,3,0)
or used by ward/medical personnel.
"^DD",118.2,118.2,11,0)
CORRESPONDING RECIPE^P114'^FH(114,^0;7^Q
"^DD",118.2,118.2,11,21,0)
^^3^3^2910411^^^
"^DD",118.2,118.2,11,21,1,0)
This field is a pointer to the recipe in file 114 (the Recipe file)
"^DD",118.2,118.2,11,21,2,0)
which contains the ingredients for this feeding. Cost and other data
"^DD",118.2,118.2,11,21,3,0)
for this feeding will be retrieved from the recipe file.
"^DD",118.2,118.2,11,"DT")
2900929
"^DD",118.2,118.2,99,0)
INACTIVE?^S^Y:YES;N:NO;^I;1^Q
"^DD",118.2,118.2,99,1,0)
^.1
"^DD",118.2,118.2,99,1,1,0)
118.2^AC^MUMPS
"^DD",118.2,118.2,99,1,1,1)
K:X'="Y" ^FH(118.2,DA,"I")
"^DD",118.2,118.2,99,1,1,2)
K ^FH(118.2,DA,"I")
"^DD",118.2,118.2,99,1,1,"%D",0)
^^2^2^2940818^
"^DD",118.2,118.2,99,1,1,"%D",1,0)
This cross-reference is used to create an 'I' node for
"^DD",118.2,118.2,99,1,1,"%D",2,0)
inactive entries.
"^DD",118.2,118.2,99,21,0)
^^2^2^2920818^^
"^DD",118.2,118.2,99,21,1,0)
This field, if answered YES, prohibits further selection of
"^DD",118.2,118.2,99,21,2,0)
this item by ward or dietetic personnel.
"^DD",118.2,118.2,99,"DT")
2860813
"^DD",118.2,118.21,0)
SYNONYM SUB-FIELD^NL^.01^1
"^DD",118.2,118.21,0,"NM","SYNONYM")

"^DD",118.2,118.21,0,"UP")
118.2
"^DD",118.2,118.21,.01,0)
SYNONYM^MF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",118.2,118.21,.01,1,0)
^.1
"^DD",118.2,118.21,.01,1,1,0)
118.2^C
"^DD",118.2,118.21,.01,1,1,1)
S ^FH(118.2,"C",$E(X,1,30),DA(1),DA)=""
"^DD",118.2,118.21,.01,1,1,2)
K ^FH(118.2,"C",$E(X,1,30),DA(1),DA)
"^DD",118.2,118.21,.01,3)
ANSWER MUST BE 1-30 CHARACTERS IN LENGTH
"^DD",118.2,118.21,.01,21,0)
^^2^2^2880710^
"^DD",118.2,118.21,.01,21,1,0)
This field contains an alternate name or synonym for the
"^DD",118.2,118.21,.01,21,2,0)
tubefeeding product.
"^DD",118.2,118.21,.01,"DT")
2850709
"^DD",119.6,119.6,0)
FIELD^^112^39
"^DD",119.6,119.6,0,"DDA")
N
"^DD",119.6,119.6,0,"DT")
3060814
"^DD",119.6,119.6,0,"ID","WRITE")
I $D(^("I")) D EN^DDIOL("(** Inactive **)","","?3")
"^DD",119.6,119.6,0,"IX","AC",119.6,99)

"^DD",119.6,119.6,0,"IX","AL",119.64,.01)

"^DD",119.6,119.6,0,"IX","AP",119.6,11)

"^DD",119.6,119.6,0,"IX","AR",119.62,.01)

"^DD",119.6,119.6,0,"IX","AS1",119.6,3)

"^DD",119.6,119.6,0,"IX","AS2",119.6,4)

"^DD",119.6,119.6,0,"IX","AS3",119.6,5)

"^DD",119.6,119.6,0,"IX","AW",119.63,.01)

"^DD",119.6,119.6,0,"IX","B",119.6,.01)

"^DD",119.6,119.6,0,"IX","C",119.6,102)

"^DD",119.6,119.6,0,"IX","CO",119.6,6)

"^DD",119.6,119.6,0,"NM","NUTRITION LOCATION")

"^DD",119.6,119.6,0,"PT",115.01,11)

"^DD",119.6,119.6,0,"PT",115.01,13)

"^DD",119.6,119.6,0,"PT",115.012,5)

"^DD",119.6,119.6,0,"PT",115.016,2)

"^DD",119.6,119.6,0,"PT",115.017,2)

"^DD",119.6,119.6,0,"PT",115.018,4)

"^DD",119.6,119.6,0,"PT",14100045.01,2)

"^DD",119.6,119.6,0,"PT",14100047,.01)

"^DD",119.6,119.6,0,"PT",14100049.01,3)

"^DD",119.6,119.6,0,"SCR")
I '$D(^FH(119.6,+Y,"I"))!$D(^XUSEC("FHMGR",DUZ))!(DUZ(0)["@")
"^DD",119.6,119.6,0,"VRPK")
FH
"^DD",119.6,119.6,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",119.6,119.6,.01,1,0)
^.1
"^DD",119.6,119.6,.01,1,1,0)
119.6^B
"^DD",119.6,119.6,.01,1,1,1)
S ^FH(119.6,"B",$E(X,1,30),DA)=""
"^DD",119.6,119.6,.01,1,1,2)
K ^FH(119.6,"B",$E(X,1,30),DA)
"^DD",119.6,119.6,.01,1,1,"%D",0)
^^1^1^2911118^
"^DD",119.6,119.6,.01,1,1,"%D",1,0)
This is the normal B cross-reference of the NAME field.
"^DD",119.6,119.6,.01,3)
Answer must be 1-30 characters in length.
"^DD",119.6,119.6,.01,21,0)
^^1^1^2920507^^^^
"^DD",119.6,119.6,.01,21,1,0)
This is the name of a ward on which dietetic activity occurs.
"^DD",119.6,119.6,.01,21,2,0)
It is selected from a list of MAS wards.
"^DD",119.6,119.6,.01,"DEL",1,0)
I 1 D EN^DDIOL("Cannot delete. Inactivate instead.","","?3")
"^DD",119.6,119.6,.01,"DT")
2911015
"^DD",119.6,119.6,1,0)
CLINICIAN^RP200'^VA(200,^0;2^Q
"^DD",119.6,119.6,1,21,0)
^.001^3^3^3020930^^^
"^DD",119.6,119.6,1,21,1,0)
This field contains the clinician assigned to the ward and the
"^DD",119.6,119.6,1,21,2,0)
one to whom dietetic consults will be routed and notification
"^DD",119.6,119.6,1,21,3,0)
made of special diet orders and tubefeedings.
"^DD",119.6,119.6,2,0)
ROOM-BED^119.62P^^R;0
"^DD",119.6,119.6,2,21,0)
^.001^2^2^3020930^^^^
"^DD",119.6,119.6,2,21,1,0)
This is a pointer to File 405.4 and indicates that that room-bed
"^DD",119.6,119.6,2,21,2,0)
is to be considered part of this Dietetic Ward.
"^DD",119.6,119.6,2.5,0)
ASSOCIATED MAS WARD^119.63P^^W;0
"^DD",119.6,119.6,2.5,21,0)
^.001^3^3^3040902^^^^
"^DD",119.6,119.6,2.5,21,1,0)
This is a list of MAS wards which are to be used as defaults to this
"^DD",119.6,119.6,2.5,21,2,0)
Dietetic ward for purposes of patient location when the room-bed is
"^DD",119.6,119.6,2.5,21,3,0)
unknown and for purposes of forecasting.
"^DD",119.6,119.6,2.6,0)
ASSOCIATED HOSPITAL LOCATION^119.64P^^L;0
"^DD",119.6,119.6,2.6,21,0)
^.001^2^2^3060814^^^^
"^DD",119.6,119.6,2.6,21,1,0)
This multiple contains the hospital location(s)/clinic(s) associated with
"^DD",119.6,119.6,2.6,21,2,0)
this outpatient nutrition location.
"^DD",119.6,119.6,3,0)
TRAY SERVICE POINT^*P119.72'^FH(119.72,^0;5^S DIC("S")="I $P(^(0),U,2)=""T""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",119.6,119.6,3,1,0)
^.1
"^DD",119.6,119.6,3,1,1,0)
119.6^AS1^MUMPS
"^DD",119.6,119.6,3,1,1,1)
S Y="" S:$P(^FH(119.6,DA,0),"^",5) Y=Y_"T" S:$P(^(0),"^",6) Y=Y_"C" S:$P(^(0),"^",7) Y=Y_"D" S $P(^(0),"^",10)=Y
"^DD",119.6,119.6,3,1,1,2)
D SPKS^FH
"^DD",119.6,119.6,3,1,1,"%D",0)
^.101^3^3^3020514^^^^
"^DD",119.6,119.6,3,1,1,"%D",1,0)
This cross-reference, along with that on Fields 4 and 5, is used to
"^DD",119.6,119.6,3,1,1,"%D",2,0)
set the Services Field. It is a string containing C, T, and/or D
"^DD",119.6,119.6,3,1,1,"%D",3,0)
indicating which services are available for this ward.
"^DD",119.6,119.6,3,1,1,"DT")
3020514
"^DD",119.6,119.6,3,12)
Allows selection only of tray lines
"^DD",119.6,119.6,3,12.1)
S DIC("S")="I $P(^(0),U,2)=""T"""
"^DD",119.6,119.6,3,21,0)
^.001^7^7^3040902^^^^
"^DD",119.6,119.6,3,21,1,0)
This field, if used, indicates that tray service is available to this
"^DD",119.6,119.6,3,21,2,0)
ward and is provided by the indicated Service Point. Note: if a Dining
"^DD",119.6,119.6,3,21,3,0)
Room is also available, then a Tray Service Point must be specified
"^DD",119.6,119.6,3,21,4,0)
as Dining Room trays are prepared there.
"^DD",119.6,119.6,3,21,5,0)

"^DD",119.6,119.6,3,21,6,0)
For outpatient nutrition locations this field indicates the tray Service
"^DD",119.6,119.6,3,21,7,0)
Point available for the location.
"^DD",119.6,119.6,3,"DT")
3020514
"^DD",119.6,119.6,3.5,0)
TRAY FORECAST %^NJ3,0^^0;17^K:+X'=X!(X>120)!(X<0)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,3.5,3)
Type a Number between 0 and 120, 0 Decimal Digits
"^DD",119.6,119.6,3.5,21,0)
^.001^1^1^3020930^^
"^DD",119.6,119.6,3.5,21,1,0)
This is the % of patients on the ward typically receiving tray service.
"^DD",119.6,119.6,3.5,"DT")
2911120
"^DD",119.6,119.6,4,0)
CAFETERIA SERVICE POINT^*P119.72'^FH(119.72,^0;6^S DIC("S")="I $P(^(0),U,2)=""C""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",119.6,119.6,4,1,0)
^.1
"^DD",119.6,119.6,4,1,1,0)
119.6^AS2^MUMPS
"^DD",119.6,119.6,4,1,1,1)
S Y="" S:$P(^FH(119.6,DA,0),"^",5) Y=Y_"T" S:$P(^(0),"^",6) Y=Y_"C" S:$P(^(0),"^",7) Y=Y_"D" S $P(^(0),"^",10)=Y
"^DD",119.6,119.6,4,1,1,2)
D SPKS^FH
"^DD",119.6,119.6,4,1,1,"%D",0)
^.101^3^3^3020514^^^
"^DD",119.6,119.6,4,1,1,"%D",1,0)
This cross-reference, along with that on Fields 3 and 5, is used to
"^DD",119.6,119.6,4,1,1,"%D",2,0)
set the Services Field. It is a string containing C, T, and/or D
"^DD",119.6,119.6,4,1,1,"%D",3,0)
indicating which services are available for this ward.
"^DD",119.6,119.6,4,1,1,"DT")
3020514
"^DD",119.6,119.6,4,12)
Allows selction only of cafeterias
"^DD",119.6,119.6,4,12.1)
S DIC("S")="I $P(^(0),U,2)=""C"""
"^DD",119.6,119.6,4,21,0)
^.001^5^5^3040902^^^^
"^DD",119.6,119.6,4,21,1,0)
This field, if used, indicates that cafeteria service is available
"^DD",119.6,119.6,4,21,2,0)
to this ward and is provided by the indicated Service Point.
"^DD",119.6,119.6,4,21,3,0)

"^DD",119.6,119.6,4,21,4,0)
For outpatient nutrition locations this field indicates the cafeteria
"^DD",119.6,119.6,4,21,5,0)
Service Point available for the location.
"^DD",119.6,119.6,4,"DT")
3020514
"^DD",119.6,119.6,4.5,0)
CAFETERIA FORECAST %^NJ3,0^^0;18^K:+X'=X!(X>120)!(X<0)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,4.5,3)
Type a Number between 0 and 120, 0 Decimal Digits
"^DD",119.6,119.6,4.5,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.6,4.5,21,1,0)
This is the % of patients on the ward typically receiving cafeteria
"^DD",119.6,119.6,4.5,21,2,0)
service.
"^DD",119.6,119.6,4.5,"DT")
2911120
"^DD",119.6,119.6,5,0)
DINING ROOM TRAY SERVICE?^S^1:YES;0:NO;^0;7^Q
"^DD",119.6,119.6,5,1,0)
^.1
"^DD",119.6,119.6,5,1,1,0)
119.6^AS3^MUMPS
"^DD",119.6,119.6,5,1,1,1)
S Y="" S:$P(^FH(119.6,DA,0),"^",5) Y=Y_"T" S:$P(^(0),"^",6) Y=Y_"C" S:$P(^(0),"^",7) Y=Y_"D" S $P(^(0),"^",10)=Y
"^DD",119.6,119.6,5,1,1,2)
D SPKS^FH
"^DD",119.6,119.6,5,1,1,"%D",0)
^.101^3^3^3020514^^^
"^DD",119.6,119.6,5,1,1,"%D",1,0)
This cross-reference, along with that on Fields 3 and 4, is used to
"^DD",119.6,119.6,5,1,1,"%D",2,0)
set the Services Field. It is a string containing C, T, and/or D
"^DD",119.6,119.6,5,1,1,"%D",3,0)
indicating which services are available for this ward.
"^DD",119.6,119.6,5,1,1,"DT")
3020514
"^DD",119.6,119.6,5,3)

"^DD",119.6,119.6,5,21,0)
^.001^4^4^3040902^^^^
"^DD",119.6,119.6,5,21,1,0)
A YES means that Dining Room tray service is available to this ward.
"^DD",119.6,119.6,5,21,2,0)

"^DD",119.6,119.6,5,21,3,0)
For outpatient nutrition locations a YES in this field indicates that
"^DD",119.6,119.6,5,21,4,0)
Dining Room tray service is available for this location.
"^DD",119.6,119.6,5,"DT")
3020514
"^DD",119.6,119.6,5.5,0)
DINING ROOM FORECAST %^NJ3,0^^0;19^K:+X'=X!(X>120)!(X<0)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,5.5,3)
Type a Number between 0 and 120, 0 Decimal Digits
"^DD",119.6,119.6,5.5,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.6,5.5,21,1,0)
This is the % of patients on the ward typically receiving dining room
"^DD",119.6,119.6,5.5,21,2,0)
service.
"^DD",119.6,119.6,5.5,"DT")
2911204
"^DD",119.6,119.6,6,0)
COMMUNICATION OFFICE^RP119.73'^FH(119.73,^0;8^Q
"^DD",119.6,119.6,6,1,0)
^.1
"^DD",119.6,119.6,6,1,1,0)
119.6^CO
"^DD",119.6,119.6,6,1,1,1)
S ^FH(119.6,"CO",$E(X,1,30),DA)=""
"^DD",119.6,119.6,6,1,1,2)
K ^FH(119.6,"CO",$E(X,1,30),DA)
"^DD",119.6,119.6,6,1,1,"%D",0)
^^1^1^3040420^
"^DD",119.6,119.6,6,1,1,"%D",1,0)
Cross reference locations by Communication Office.
"^DD",119.6,119.6,6,1,1,"DT")
3040420
"^DD",119.6,119.6,6,21,0)
^.001^2^2^3040902^^^^
"^DD",119.6,119.6,6,21,1,0)
This field indicates which Communication Office is responsible for
"^DD",119.6,119.6,6,21,2,0)
processing diet requests from this ward or outpatient location.
"^DD",119.6,119.6,6,"DT")
3040420
"^DD",119.6,119.6,7,0)
SUPP. FDG. SITE^P119.74'^FH(119.74,^0;9^Q
"^DD",119.6,119.6,7,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.6,7,21,1,0)
This field indicates which Supplemental Feeding Site is responsible for
"^DD",119.6,119.6,7,21,2,0)
preparing Supplemental Feedings and Bulk Nourishments for this ward.
"^DD",119.6,119.6,7,"DT")
2911204
"^DD",119.6,119.6,11,0)
PRINT ORDER^RNJ2,0^^0;4^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,11,1,0)
^.1
"^DD",119.6,119.6,11,1,1,0)
119.6^AP
"^DD",119.6,119.6,11,1,1,1)
S ^FH(119.6,"AP",$E(X,1,30),DA)=""
"^DD",119.6,119.6,11,1,1,2)
K ^FH(119.6,"AP",$E(X,1,30),DA)
"^DD",119.6,119.6,11,1,1,3)
This field is required
"^DD",119.6,119.6,11,1,1,"DT")
2911029
"^DD",119.6,119.6,11,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 99
"^DD",119.6,119.6,11,21,0)
^.001^3^3^3020930^^^^
"^DD",119.6,119.6,11,21,1,0)
This field represents the print order of this ward. It is used
"^DD",119.6,119.6,11,21,2,0)
to sort the wards for delivery purposes which are then printed
"^DD",119.6,119.6,11,21,3,0)
from low print order to high print order.
"^DD",119.6,119.6,11,"DT")
2911029
"^DD",119.6,119.6,15,0)
DEFAULT ADMISSION DIET^P111'^FH(111,^0;15^Q
"^DD",119.6,119.6,15,21,0)
^.001^3^3^3020930^^^^
"^DD",119.6,119.6,15,21,1,0)
This field is optional. It may contain a diet from the Diets
"^DD",119.6,119.6,15,21,2,0)
file (111) and, if so, the diet will automatically be ordered
"^DD",119.6,119.6,15,21,3,0)
for each patient at the time of admission.
"^DD",119.6,119.6,15,"DT")
2850629
"^DD",119.6,119.6,16,0)
'NO ORDER' DIET ON ADMISSION^S^Y:YES;N:NO;^0;16^Q
"^DD",119.6,119.6,16,21,0)
^.001^3^3^3020930^^^^
"^DD",119.6,119.6,16,21,1,0)
This field is used to indicate whether a 'No Order' Diet
"^DD",119.6,119.6,16,21,2,0)
order should be generated upon admission; this field is
"^DD",119.6,119.6,16,21,3,0)
applicable only if no default admission diet is specified.
"^DD",119.6,119.6,16,"DT")
2880904
"^DD",119.6,119.6,20,0)
BULK NOURISHMENTS^119.61P^^BN;0
"^DD",119.6,119.6,20,21,0)
^.001^2^2^3020930^^^
"^DD",119.6,119.6,20,21,1,0)
This multiple represents bulk nourishments (supplemental feedings)
"^DD",119.6,119.6,20,21,2,0)
delivered to this ward.
"^DD",119.6,119.6,21,0)
# DAYS TO REVIEW NPO^NJ1,0^^0;11^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,21,3)
Type a Number between 1 and 7, 0 Decimal Digits
"^DD",119.6,119.6,21,21,0)
^^2^2^2911204^
"^DD",119.6,119.6,21,21,1,0)
This field indicates the number of days following an NPO order after
"^DD",119.6,119.6,21,21,2,0)
which the patient should be reviewed.
"^DD",119.6,119.6,21,"DT")
2910430
"^DD",119.6,119.6,22,0)
# DAYS TO REVIEW TF^NJ2,0^^0;12^K:+X'=X!(X>30)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,22,3)
Type a Number between 1 and 30, 0 Decimal Digits
"^DD",119.6,119.6,22,21,0)
^^2^2^2911204^
"^DD",119.6,119.6,22,21,1,0)
This field indicates the number of days following a Tubefeeding order
"^DD",119.6,119.6,22,21,2,0)
after which the patient should be reviewed.
"^DD",119.6,119.6,22,"DT")
2910430
"^DD",119.6,119.6,23,0)
# DAYS TO REVIEW SF^NJ2,0^^0;13^K:+X'=X!(X>30)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,23,3)
Type a Number between 1 and 30, 0 Decimal Digits
"^DD",119.6,119.6,23,21,0)
^^2^2^2911204^
"^DD",119.6,119.6,23,21,1,0)
This field indicates the number of days following a Supplemental Feeding
"^DD",119.6,119.6,23,21,2,0)
order after which the patient should be reviewed.
"^DD",119.6,119.6,23,"DT")
2910430
"^DD",119.6,119.6,24,0)
# DAYS FOR STATUS AFTER ADMIT^NJ2,0^^0;14^K:+X'=X!(X>30)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,24,3)
Type a Number between 1 and 30, 0 Decimal Digits
"^DD",119.6,119.6,24,21,0)
^^2^2^2911204^
"^DD",119.6,119.6,24,21,1,0)
This field indicates the number of days following admission after which
"^DD",119.6,119.6,24,21,2,0)
a Nutrition Status evaluation should have been performed.
"^DD",119.6,119.6,24,"DT")
2910517
"^DD",119.6,119.6,25,0)
# DAYS TO REVIEW STATUS I^NJ3,0^^0;20^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,25,3)
Type a Number between 1 and 120, 0 Decimal Digits
"^DD",119.6,119.6,25,21,0)
^^2^2^2920106^^
"^DD",119.6,119.6,25,21,1,0)
This is the number of days after which a patient in this Nutrition
"^DD",119.6,119.6,25,21,2,0)
Status category should be reviewed.
"^DD",119.6,119.6,25,"DT")
2930222
"^DD",119.6,119.6,26,0)
# DAYS TO REVIEW STATUS II^NJ3,0^^0;21^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,26,3)
Type a Number between 1 and 120, 0 Decimal Digits
"^DD",119.6,119.6,26,21,0)
^^2^2^2920106^^
"^DD",119.6,119.6,26,21,1,0)
This is the number of days after which a patient in this Nutrition
"^DD",119.6,119.6,26,21,2,0)
Status category should be reviewed.
"^DD",119.6,119.6,26,"DT")
2930222
"^DD",119.6,119.6,27,0)
# DAYS TO REVIEW STATUS III^NJ3,0^^0;22^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,27,3)
Type a Number between 1 and 120, 0 Decimal Digits
"^DD",119.6,119.6,27,21,0)
^^2^2^2920106^^
"^DD",119.6,119.6,27,21,1,0)
This is the number of days after which a patient in this Nutrition
"^DD",119.6,119.6,27,21,2,0)
Status category should be reviewed.
"^DD",119.6,119.6,27,"DT")
2930222
"^DD",119.6,119.6,28,0)
# DAYS TO REVIEW STATUS IV^NJ3,0^^0;23^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,28,3)
Type a Number between 1 and 120, 0 Decimal Digits
"^DD",119.6,119.6,28,21,0)
^^2^2^2920106^^
"^DD",119.6,119.6,28,21,1,0)
This is the number of days after which a patient in this Nutrition
"^DD",119.6,119.6,28,21,2,0)
Status category should be reviewed.
"^DD",119.6,119.6,28,"DT")
2930222
"^DD",119.6,119.6,29,0)
CAFETERIA ON TRAY TICKET^S^Y:YES;N:NO;^0;24^Q
"^DD",119.6,119.6,29,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.6,29,21,1,0)
This field is optional and it is used to indicate whether patients
"^DD",119.6,119.6,29,21,2,0)
that go to the cafeteria should be included on the tray ticket.
"^DD",119.6,119.6,29,"DT")
2940413
"^DD",119.6,119.6,99,0)
INACTIVE?^S^Y:YES;N:NO;^I;1^Q
"^DD",119.6,119.6,99,1,0)
^.1
"^DD",119.6,119.6,99,1,1,0)
119.6^AC^MUMPS
"^DD",119.6,119.6,99,1,1,1)
K:X'="Y" ^FH(119.6,DA,"I")
"^DD",119.6,119.6,99,1,1,2)
K ^FH(119.6,DA,"I")
"^DD",119.6,119.6,99,1,1,"%D",0)
^^2^2^3000202
"^DD",119.6,119.6,99,1,1,"%D",1,0)
This cross-reference is used to create an 'I' node for
"^DD",119.6,119.6,99,1,1,"%D",2,0)
inactive entries.
"^DD",119.6,119.6,99,21,0)
^.001^2^2^3020930^
"^DD",119.6,119.6,99,21,1,0)
This field, if answered YES, will prohibit
"^DD",119.6,119.6,99,21,2,0)
further selection of this entry.
"^DD",119.6,119.6,99,"DT")
3000223
"^DD",119.6,119.6,101,0)
SERVICES^F^^0;10^K:$L(X)>3!($L(X)<1) X
"^DD",119.6,119.6,101,3)
Answer must be 1-3 characters in length.
"^DD",119.6,119.6,101,21,0)
^.001^2^2^3020930^^^
"^DD",119.6,119.6,101,21,1,0)
This field contains one or more of the characters T, C or D indicating
"^DD",119.6,119.6,101,21,2,0)
tray service, cafeteria service, and/or dining room service is available.
"^DD",119.6,119.6,101,"DT")
2911031
"^DD",119.6,119.6,102,0)
OUTPATIENT LOCATION^V^^1;1^Q
"^DD",119.6,119.6,102,1,0)
^.1
"^DD",119.6,119.6,102,1,1,0)
119.6^C
"^DD",119.6,119.6,102,1,1,1)
S ^FH(119.6,"C",$E(X,1,30),DA)=""
"^DD",119.6,119.6,102,1,1,2)
K ^FH(119.6,"C",$E(X,1,30),DA)
"^DD",119.6,119.6,102,1,1,"DT")
3060404
"^DD",119.6,119.6,102,21,0)
^.001^3^3^3060404^^
"^DD",119.6,119.6,102,21,1,0)
This field is a variable pointer to either the Ward Location (#42) file
"^DD",119.6,119.6,102,21,2,0)
or the Hospital Location (#44) file.  This will be used for outpatient
"^DD",119.6,119.6,102,21,3,0)
locations.
"^DD",119.6,119.6,102,"DT")
3060404
"^DD",119.6,119.6,102,"V",0)
^.12P^2^2
"^DD",119.6,119.6,102,"V",1,0)
44^HOSPITAL LOCATION^1^HL^n^n
"^DD",119.6,119.6,102,"V",2,0)
42^WARD LOCATION^2^WL^n^n
"^DD",119.6,119.6,103,0)
MAX # OF DAYS^NJ3,0^^1;2^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,103,3)
Type a Number between 1 and 365, 0 Decimal Digits
"^DD",119.6,119.6,103,21,0)
^.001^6^6^3040902^^^
"^DD",119.6,119.6,103,21,1,0)
This field is optional.  If used it will be set to the maximum number of
"^DD",119.6,119.6,103,21,2,0)
days ahead a recurring meal plan can be ordered, ie, if this field is set to
"^DD",119.6,119.6,103,21,3,0)
365 then when ordering a recurring meal it cannot be ordered past one year
"^DD",119.6,119.6,103,21,4,0)
from the ordering date.  If the field is left NULL then a default of 999
"^DD",119.6,119.6,103,21,5,0)
days is assumed.  This field will be checked upon entering the FROM/TO dates
"^DD",119.6,119.6,103,21,6,0)
in the Order/Edit Outpatient Meals option.
"^DD",119.6,119.6,103,"DT")
3030313
"^DD",119.6,119.6,104,0)
NUMBER OF DAYS FOR REVIEW^RNJ2,0^^1;3^K:+X'=X!(X>30)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.6,104,3)
Type a Number between 1 and 30, 0 Decimal Digits
"^DD",119.6,119.6,104,21,0)
^.001^5^5^3041109^^^^
"^DD",119.6,119.6,104,21,1,0)
This field will be used for the Outpatient Meals Print Meal Plan Expiration
"^DD",119.6,119.6,104,21,2,0)
List option.  It may be set to a number of days which will be used for
"^DD",119.6,119.6,104,21,3,0)
review by the above option, ie, if this field is set to 7 then when the
"^DD",119.6,119.6,104,21,4,0)
Print Meal Plan Expiration List option is run it will check for recurring
"^DD",119.6,119.6,104,21,5,0)
meal plans that will be expiring within the next 7 days.
"^DD",119.6,119.6,104,"DT")
3041109
"^DD",119.6,119.6,105,0)
NON-VA FACILITY?^S^Y:Yes;N:No;^1;4^Q
"^DD",119.6,119.6,105,21,0)
^.001^6^6^3040902^^^
"^DD",119.6,119.6,105,21,1,0)
This will be an optional YES/NO field that may be set when setting up
"^DD",119.6,119.6,105,21,2,0)
new outpatient locations.  If the field is set to YES the Order/Edit
"^DD",119.6,119.6,105,21,3,0)
Recurring Meal option will use this flag to allow selection of up to 5
"^DD",119.6,119.6,105,21,4,0)
diets from any diet in the Diets (#111) file.  If the field is blank or
"^DD",119.6,119.6,105,21,5,0)
set to NO then the Order/Edit option will only allow selection of 1 diet
"^DD",119.6,119.6,105,21,6,0)
from the 5 allowable diets set up in the site parameters.
"^DD",119.6,119.6,105,"DT")
3030324
"^DD",119.6,119.6,106,0)
INPATIENT/OUTPATIENT^RS^I:Inpatient;O:Outpatient;^0;3^Q
"^DD",119.6,119.6,106,21,0)
^.001^6^6^3040902^^^
"^DD",119.6,119.6,106,21,1,0)
This field will serve as a flag to determine whether the location is an
"^DD",119.6,119.6,106,21,2,0)
inpatient or an outpatient location.  This will be required with the
"^DD",119.6,119.6,106,21,3,0)
Outpatient Meals functionality, since it will be necessary to store 
"^DD",119.6,119.6,106,21,4,0)
inpatient and outpatient locations in this file.
"^DD",119.6,119.6,106,21,5,0)

"^DD",119.6,119.6,106,21,6,0)
For all outpatient locations this field should be set to OUTPATIENT.
"^DD",119.6,119.6,106,"DT")
3030421
"^DD",119.6,119.6,107,0)
ALERT BMI^S^Y:YES;N:NO;^1;5^Q
"^DD",119.6,119.6,107,3)
Do you want to be alerted for BMI value for this location?
"^DD",119.6,119.6,107,21,0)
^^2^2^3060925^
"^DD",119.6,119.6,107,21,1,0)
This field, if set to YES, indicates that a clinicians will be alerted if 
"^DD",119.6,119.6,107,21,2,0)
the Body Mass Index (BMI) is below its level.
"^DD",119.6,119.6,107,"DT")
3060925
"^DD",119.6,119.6,108,0)
ALERT TUBEFEEDING^S^Y:YES;N:NO;^1;6^Q
"^DD",119.6,119.6,108,3)
Do you want to be alerted for Tubefeeding value for this location?
"^DD",119.6,119.6,108,21,0)
^^2^2^3060925^
"^DD",119.6,119.6,108,21,1,0)
This field, if set to YES, indicates that a clinician will be alerted if 
"^DD",119.6,119.6,108,21,2,0)
tubefeeding needs to be reviewed.
"^DD",119.6,119.6,108,"DT")
3060925
"^DD",119.6,119.6,109,0)
ALERT HYPERALS^S^Y:YES;N:NO;^1;7^Q
"^DD",119.6,119.6,109,3)
Do you want to be alerted for Hyperals value for this location?
"^DD",119.6,119.6,109,21,0)
^^2^2^3060925^
"^DD",119.6,119.6,109,21,1,0)
This field, if set to YES, indicates that a clinician will be alerted if 
"^DD",119.6,119.6,109,21,2,0)
certain patient is in hyperals.
"^DD",119.6,119.6,109,"DT")
3060925
"^DD",119.6,119.6,110,0)
ALERT ALBUMIN^S^Y:YES;N:NO;^1;8^Q
"^DD",119.6,119.6,110,3)
Do you want to be alerted for Albumin value for this location?
"^DD",119.6,119.6,110,21,0)
^^2^2^3060925^
"^DD",119.6,119.6,110,21,1,0)
This field, if set to YES, indicates that a clinician will be alerted if 
"^DD",119.6,119.6,110,21,2,0)
the albumin value is below the designated level.
"^DD",119.6,119.6,110,"DT")
3060925
"^DD",119.6,119.6,111,0)
ALERT NPO+CLRLIQ^S^Y:YES;N:NO;^1;9^Q
"^DD",119.6,119.6,111,3)
Do you want to be alerted for NPO+CLRLIQ value for this location?
"^DD",119.6,119.6,111,21,0)
^^3^3^3060925^
"^DD",119.6,119.6,111,21,1,0)
This field, if set to YES, indicates that a clinician will be 
"^DD",119.6,119.6,111,21,2,0)
alerted if certain patient with Nothing by Mouth (NPO) + Clear Liquid
"^DD",119.6,119.6,111,21,3,0)
(CLRLIQ) diet needs to be reviewed.
"^DD",119.6,119.6,111,"DT")
3060925
"^DD",119.6,119.6,112,0)
ALSO SEND ALERTS TO^119.66P^^2;0
"^DD",119.6,119.61,0)
BULK NOURISHMENTS SUB-FIELD^NL^1^2
"^DD",119.6,119.61,0,"NM","BULK NOURISHMENTS")

"^DD",119.6,119.61,0,"UP")
119.6
"^DD",119.6,119.61,.01,0)
BULK NOURISHMENTS^MP118'^FH(118,^0;1^Q
"^DD",119.6,119.61,.01,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.61,.01,21,1,0)
This field contains the name of the bulk nourishment (supplemental
"^DD",119.6,119.61,.01,21,2,0)
feeding) item to be delivered to the ward.
"^DD",119.6,119.61,.01,"DT")
2850604
"^DD",119.6,119.61,1,0)
QUANTITY^RNJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",119.6,119.61,1,3)
TYPE A WHOLE NUMBER BETWEEN 0 AND 99
"^DD",119.6,119.61,1,21,0)
^^2^2^2880717^
"^DD",119.6,119.61,1,21,1,0)
This field represents the quantity of the bulk nourishment
"^DD",119.6,119.61,1,21,2,0)
item to be delivered.
"^DD",119.6,119.61,1,"DT")
2850604
"^DD",119.6,119.62,0)
ROOM-BED SUB-FIELD^^1^2
"^DD",119.6,119.62,0,"DT")
2940127
"^DD",119.6,119.62,0,"IX","B",119.62,.01)

"^DD",119.6,119.62,0,"NM","ROOM-BED")

"^DD",119.6,119.62,0,"UP")
119.6
"^DD",119.6,119.62,.01,0)
ROOM-BED^MP405.4'X^DG(405.4,^0;1^I $D(X) S Y=$O(^FH(119.6,"AR",X,0)) I Y>0,Y-DA(1) W *7,"  Room already assigned to ",$P($G(^FH(119.6,+Y,0)),"^",1) K X
"^DD",119.6,119.62,.01,1,0)
^.1
"^DD",119.6,119.62,.01,1,1,0)
119.62^B
"^DD",119.6,119.62,.01,1,1,1)
S ^FH(119.6,DA(1),"R","B",$E(X,1,30),DA)=""
"^DD",119.6,119.62,.01,1,1,2)
K ^FH(119.6,DA(1),"R","B",$E(X,1,30),DA)
"^DD",119.6,119.62,.01,1,1,"%D",0)
^^1^1^2911118^
"^DD",119.6,119.62,.01,1,1,"%D",1,0)
This is the normal B cross-reference of the ROOM-BED field.
"^DD",119.6,119.62,.01,1,2,0)
119.6^AR
"^DD",119.6,119.62,.01,1,2,1)
S ^FH(119.6,"AR",$E(X,1,30),DA(1),DA)=""
"^DD",119.6,119.62,.01,1,2,2)
K ^FH(119.6,"AR",$E(X,1,30),DA(1),DA)
"^DD",119.6,119.62,.01,1,2,"DT")
2911015
"^DD",119.6,119.62,.01,21,0)
^.001^2^2^3020930^^
"^DD",119.6,119.62,.01,21,1,0)
This field is a pointer to File 405.4 and indicates that this room-bed
"^DD",119.6,119.62,.01,21,2,0)
is to be considered part of this Dietetic Ward.
"^DD",119.6,119.62,.01,"DT")
2911030
"^DD",119.6,119.62,1,0)
DELIVERY ORDER^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",119.6,119.62,1,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",119.6,119.62,1,21,0)
^^3^3^2940127^
"^DD",119.6,119.62,1,21,1,0)
This value will be used to determine the order of printing labels
"^DD",119.6,119.62,1,21,2,0)
or tickets for items to be delivered.  Thus, the value represents
"^DD",119.6,119.62,1,21,3,0)
the order of delivery for beds on the ward.
"^DD",119.6,119.62,1,"DT")
2940127
"^DD",119.6,119.63,0)
ASSOCIATED MAS WARD SUB-FIELD^^.01^1
"^DD",119.6,119.63,0,"DT")
2911018
"^DD",119.6,119.63,0,"IX","B",119.63,.01)

"^DD",119.6,119.63,0,"NM","ASSOCIATED MAS WARD")

"^DD",119.6,119.63,0,"UP")
119.6
"^DD",119.6,119.63,.01,0)
ASSOCIATED MAS WARD^MP42'X^DIC(42,^0;1^I $D(X) S Y=$O(^FH(119.6,"AW",X,0)) I Y>0,Y-DA(1) W *7,"  Ward already assigned to ",$P($G(^FH(119.6,+Y,0)),"^",1) K X
"^DD",119.6,119.63,.01,1,0)
^.1
"^DD",119.6,119.63,.01,1,1,0)
119.63^B
"^DD",119.6,119.63,.01,1,1,1)
S ^FH(119.6,DA(1),"W","B",$E(X,1,30),DA)=""
"^DD",119.6,119.63,.01,1,1,2)
K ^FH(119.6,DA(1),"W","B",$E(X,1,30),DA)
"^DD",119.6,119.63,.01,1,1,"%D",0)
^^1^1^2911118^
"^DD",119.6,119.63,.01,1,1,"%D",1,0)
This is the normal B cross-reference of the ASSOCIATED MAS WARD field.
"^DD",119.6,119.63,.01,1,2,0)
119.6^AW
"^DD",119.6,119.63,.01,1,2,1)
S ^FH(119.6,"AW",$E(X,1,30),DA(1),DA)=""
"^DD",119.6,119.63,.01,1,2,2)
K ^FH(119.6,"AW",$E(X,1,30),DA(1),DA)
"^DD",119.6,119.63,.01,1,2,"DT")
2911018
"^DD",119.6,119.63,.01,21,0)
^.001^5^5^3030903^^^
"^DD",119.6,119.63,.01,21,1,0)
This field indicates that (a) on admission, a patient with no room-bed,
"^DD",119.6,119.63,.01,21,2,0)
but assigned to this MAS ward, will be considered to be on this Dietetic
"^DD",119.6,119.63,.01,21,3,0)
Ward.
"^DD",119.6,119.63,.01,21,4,0)
(b) For forecasting purposes, the census of this MAS ward will be used
"^DD",119.6,119.63,.01,21,5,0)
in calculating the forecasted census for this Dietetic ward.
"^DD",119.6,119.63,.01,"DT")
2911030
"^DD",119.6,119.64,0)
ASSOCIATED HOSPITAL LOCATION SUB-FIELD^^.01^1
"^DD",119.6,119.64,0,"DT")
3060814
"^DD",119.6,119.64,0,"IX","B",119.64,.01)

"^DD",119.6,119.64,0,"NM","ASSOCIATED HOSPITAL LOCATION")

"^DD",119.6,119.64,0,"UP")
119.6
"^DD",119.6,119.64,.01,0)
ASSOCIATED HOSPITAL LOCATION^MRP44'X^SC(^0;1^I $D(X) S Y=$O(^FH(119.6,"AL",X,0)) I Y>0,Y-DA(1) W "  Hospital location already assigned to ",$P($G(^FH(119.6,+Y,0)),"^",1) K X
"^DD",119.6,119.64,.01,1,0)
^.1
"^DD",119.6,119.64,.01,1,1,0)
119.64^B
"^DD",119.6,119.64,.01,1,1,1)
S ^FH(119.6,DA(1),"L","B",$E(X,1,30),DA)=""
"^DD",119.6,119.64,.01,1,1,2)
K ^FH(119.6,DA(1),"L","B",$E(X,1,30),DA)
"^DD",119.6,119.64,.01,1,2,0)
119.6^AL
"^DD",119.6,119.64,.01,1,2,1)
S ^FH(119.6,"AL",$E(X,1,30),DA(1),DA)=""
"^DD",119.6,119.64,.01,1,2,2)
K ^FH(119.6,"AL",$E(X,1,30),DA(1),DA)
"^DD",119.6,119.64,.01,1,2,"%D",0)
^^1^1^3030903^
"^DD",119.6,119.64,.01,1,2,"%D",1,0)
Cross reference the whole file by field #2.6.
"^DD",119.6,119.64,.01,1,2,"DT")
3030903
"^DD",119.6,119.64,.01,21,0)
^^3^3^3060814^
"^DD",119.6,119.64,.01,21,1,0)
This is a pointer to the Hospital Location file to store the hospital
"^DD",119.6,119.64,.01,21,2,0)
location(s) associated with this Nutrition Location.  Outpatient
"^DD",119.6,119.64,.01,21,3,0)
Locations MUST have an Associated Hospital Location set up.
"^DD",119.6,119.64,.01,"DT")
3060814
"^DD",119.6,119.66,0)
ALSO SEND ALERTS TO SUB-FIELD^^.01^1
"^DD",119.6,119.66,0,"DT")
3060626
"^DD",119.6,119.66,0,"IX","B",119.66,.01)

"^DD",119.6,119.66,0,"NM","ALSO SEND ALERTS TO")

"^DD",119.6,119.66,0,"UP")
119.6
"^DD",119.6,119.66,.01,0)
ALSO SEND ALERTS TO^MP200^VA(200,^0;1^Q
"^DD",119.6,119.66,.01,1,0)
^.1
"^DD",119.6,119.66,.01,1,1,0)
119.66^B
"^DD",119.6,119.66,.01,1,1,1)
S ^FH(119.6,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",119.6,119.66,.01,1,1,2)
K ^FH(119.6,DA(1),2,"B",$E(X,1,30),DA)
"^DD",119.6,119.66,.01,3)
This field may be used to add people who need
"^DD",119.6,119.66,.01,21,0)
^^4^4^3060626^
"^DD",119.6,119.66,.01,21,1,0)
This field may be used to add people who need to receive monitor alerts
"^DD",119.6,119.66,.01,21,2,0)
The monitor alerts will automatically go to the Clinician set up for the
"^DD",119.6,119.66,.01,21,3,0)
ward, but this field will allow additional people to receive the same
"^DD",119.6,119.66,.01,21,4,0)
alerts.  
"^DD",119.6,119.66,.01,"DT")
3060626
"^DD",119.9,119.9,9,0)
AUTHORIZOR 1^P200'^VA(200,^0;7^Q
"^DD",119.9,119.9,9,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,9,21,1,0)
This field will be used to store the name of the first authorizor for
"^DD",119.9,119.9,9,21,2,0)
special meals.  When a special meal is requested, if the requestor does
"^DD",119.9,119.9,9,21,3,0)
not have the authorization to print a special meal ticket, an alert will
"^DD",119.9,119.9,9,21,4,0)
be sent to the authorizors for action.  These 15 authorizors will also
"^DD",119.9,119.9,9,21,5,0)
need to be given the FHAUTH security key.
"^DD",119.9,119.9,9,"DT")
3030429
"^DD",119.9,119.9,10,0)
AUTHORIZOR 2^P200'^VA(200,^0;8^Q
"^DD",119.9,119.9,10,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,10,21,1,0)
This field will be used to store the name of the second authorizor for
"^DD",119.9,119.9,10,21,2,0)
special meals.  When a special meal is requested, if the requestor does
"^DD",119.9,119.9,10,21,3,0)
not have the authorization to print a special meal ticket, an alert will
"^DD",119.9,119.9,10,21,4,0)
be sent to the authorizors for action.  These 15 authorizors will also
"^DD",119.9,119.9,10,21,5,0)
need to be given the FHAUTH security key.
"^DD",119.9,119.9,10,"DT")
3030429
"^DD",119.9,119.9,11,0)
AUTHORIZOR 3^P200'^VA(200,^0;9^Q
"^DD",119.9,119.9,11,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,11,21,1,0)
This field will be used to store the name of the third authorizor for
"^DD",119.9,119.9,11,21,2,0)
special meals.  When a special meal is requested, if the requestor does
"^DD",119.9,119.9,11,21,3,0)
not have the authorization to print a special meal ticket, an alert will
"^DD",119.9,119.9,11,21,4,0)
be sent to the authorizors for action.  These 15 authorizors will also
"^DD",119.9,119.9,11,21,5,0)
need to be given the FHAUTH security key.
"^DD",119.9,119.9,11,"DT")
3030429
"^DD",119.9,119.9,12,0)
AUTHORIZOR 4^P200'^VA(200,^0;10^Q
"^DD",119.9,119.9,12,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,12,21,1,0)
This field will be used to store the name of the fourth authorizor for
"^DD",119.9,119.9,12,21,2,0)
special meals.  When a special meal is requested, if the requestor does
"^DD",119.9,119.9,12,21,3,0)
not have the authorization to print a special meal ticket, an alert will
"^DD",119.9,119.9,12,21,4,0)
be sent to the authorizors for action.  These 15 authorizors will also
"^DD",119.9,119.9,12,21,5,0)
need to be given the FHAUTH security key.
"^DD",119.9,119.9,12,"DT")
3030429
"^DD",119.9,119.9,13,0)
AUTHORIZOR 5^P200'^VA(200,^0;11^Q
"^DD",119.9,119.9,13,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,13,21,1,0)
This field will be used to store the name of the fifth authorizor for
"^DD",119.9,119.9,13,21,2,0)
special meals.  When a special meal is requested, if the requestor does
"^DD",119.9,119.9,13,21,3,0)
not have the authorization to print a special meal ticket, an alert will
"^DD",119.9,119.9,13,21,4,0)
be sent to the authorizors for action.  These 15 authorizors will also
"^DD",119.9,119.9,13,21,5,0)
need to be given the FHAUTH security key.
"^DD",119.9,119.9,13,"DT")
3030429
"^DD",119.9,119.9,50,0)
AUTHORIZOR 6^P200'^VA(200,^1;11^Q
"^DD",119.9,119.9,50,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,50,21,1,0)
This field will be used to store the name of the sixth authorizor
"^DD",119.9,119.9,50,21,2,0)
for special meals.  When a special meal is requested, if the requestor
"^DD",119.9,119.9,50,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,50,21,4,0)
an alert will be sent to the authorizors for action.  These 15
"^DD",119.9,119.9,50,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,50,"DT")
3060614
"^DD",119.9,119.9,51,0)
AUTHORIZOR 7^P200'^VA(200,^1;12^Q
"^DD",119.9,119.9,51,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,51,21,1,0)
This field will be used to store the name of the seventh authorizor
"^DD",119.9,119.9,51,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,51,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,51,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,51,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,51,"DT")
3060614
"^DD",119.9,119.9,52,0)
AUTHORIZOR 8^P200'^VA(200,^1;13^Q
"^DD",119.9,119.9,52,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,52,21,1,0)
This field will be used to store the name of the eighth authorizor
"^DD",119.9,119.9,52,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,52,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,52,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,52,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,52,"DT")
3060614
"^DD",119.9,119.9,53,0)
AUTHORIZOR 9^P200'^VA(200,^1;14^Q
"^DD",119.9,119.9,53,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,53,21,1,0)
This field will be used to store the name of the ninth authorizor
"^DD",119.9,119.9,53,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,53,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,53,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,53,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,53,"DT")
3060614
"^DD",119.9,119.9,54,0)
AUTHORIZOR 10^P200'^VA(200,^1;15^Q
"^DD",119.9,119.9,54,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,54,21,1,0)
This field will be used to store the name of the tenth authorizor
"^DD",119.9,119.9,54,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,54,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,54,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,54,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,54,"DT")
3060614
"^DD",119.9,119.9,55,0)
AUTHORIZOR 11^P200'^VA(200,^1;16^Q
"^DD",119.9,119.9,55,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,55,21,1,0)
This field will be used to store the name of the eleventh authorizor
"^DD",119.9,119.9,55,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,55,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,55,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,55,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,55,"DT")
3060614
"^DD",119.9,119.9,56,0)
AUTHORIZOR 12^P200'^VA(200,^1;17^Q
"^DD",119.9,119.9,56,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,56,21,1,0)
This field will be used to store the name of the twelfth authorizor
"^DD",119.9,119.9,56,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,56,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,56,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,56,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,56,"DT")
3060614
"^DD",119.9,119.9,57,0)
AUTHORIZOR 13^P200'^VA(200,^1;18^Q
"^DD",119.9,119.9,57,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,57,21,1,0)
This field will be used to store the name of the thirteenth authorizor
"^DD",119.9,119.9,57,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,57,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,57,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,57,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,57,"DT")
3060614
"^DD",119.9,119.9,58,0)
AUTHORIZOR 14^P200'^VA(200,^1;19^Q
"^DD",119.9,119.9,58,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,58,21,1,0)
This field will be used to store the name of the fourteenth authorizor
"^DD",119.9,119.9,58,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,58,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,58,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,58,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,58,"DT")
3060614
"^DD",119.9,119.9,59,0)
AUTHORIZOR 15^P200'^VA(200,^1;20^Q
"^DD",119.9,119.9,59,21,0)
^^5^5^3060614^
"^DD",119.9,119.9,59,21,1,0)
This field will be used to store the name of the fifteenth authorizor
"^DD",119.9,119.9,59,21,2,0)
for special meals.  When a special meal is requested, if the requestor   
"^DD",119.9,119.9,59,21,3,0)
does not have the authorization to print a special meal ticket,
"^DD",119.9,119.9,59,21,4,0)
an alert will be sent to the authorizors for action.  These 15 
"^DD",119.9,119.9,59,21,5,0)
authorizors will also need to be given the FHAUTH security key.
"^DD",119.9,119.9,59,"DT")
3060614
"^DIC",118.2,118.2,0)
TUBEFEEDING^118.2sI
"^DIC",118.2,118.2,0,"GL")
^FH(118.2,
"^DIC",118.2,118.2,"%",0)
^1.005^^
"^DIC",118.2,118.2,"%D",0)
^1.001^3^3^3060706^^
"^DIC",118.2,118.2,"%D",1,0)
This file contains the products commonly used for tube-feedings
"^DIC",118.2,118.2,"%D",2,0)
as well as their characteristics such as Kcals/ml, cost, and
"^DIC",118.2,118.2,"%D",3,0)
synonyms.
"^DIC",118.2,"B","TUBEFEEDING",118.2)

"^DIC",119.6,119.6,0)
NUTRITION LOCATION^119.6P
"^DIC",119.6,119.6,0,"GL")
^FH(119.6,
"^DIC",119.6,119.6,"%",0)
^1.005^^0
"^DIC",119.6,119.6,"%D",0)
^1.001^8^8^3060925^^^^
"^DIC",119.6,119.6,"%D",1,0)
This file is a list of wards in the hospital and associated room-beds
"^DIC",119.6,119.6,"%D",2,0)
and contains various dietetic specific information such
"^DIC",119.6,119.6,"%D",3,0)
as the assigned clinician, bulk nourishments for the ward, and
"^DIC",119.6,119.6,"%D",4,0)
which Service Point, Communication Office, and Supplemental Feeding
"^DIC",119.6,119.6,"%D",5,0)
Site is assigned responsibility for the ward.
"^DIC",119.6,119.6,"%D",6,0)

"^DIC",119.6,119.6,"%D",7,0)
This file will also be used to store outpatient locations necessary
"^DIC",119.6,119.6,"%D",8,0)
for the outpatient meals enhancement.
"^DIC",119.6,"B","NUTRITION LOCATION",119.6)

**END**
**END**
