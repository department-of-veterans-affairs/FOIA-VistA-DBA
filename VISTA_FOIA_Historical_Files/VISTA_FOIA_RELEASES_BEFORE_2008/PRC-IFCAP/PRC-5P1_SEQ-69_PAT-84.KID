Released PRC*5.1*84 SEQ #69
Extracted from mail message
**KIDS**:PRC*5.1*84^

**INSTALL NAME**
PRC*5.1*84
"BLD",4280,0)
PRC*5.1*84^IFCAP^0^3050614^y
"BLD",4280,1,0)
^^2^2^3050614^
"BLD",4280,1,1,0)
This patch corrects some inconsistencies and M errors associated with
"BLD",4280,1,2,0)
the date range selection for some of the Generic Inventory reports.
"BLD",4280,4,0)
^9.64PA^^
"BLD",4280,"ABPKG")
n
"BLD",4280,"KRN",0)
^9.67PA^8989.52^19
"BLD",4280,"KRN",.4,0)
.4
"BLD",4280,"KRN",.401,0)
.401
"BLD",4280,"KRN",.402,0)
.402
"BLD",4280,"KRN",.403,0)
.403
"BLD",4280,"KRN",.5,0)
.5
"BLD",4280,"KRN",.84,0)
.84
"BLD",4280,"KRN",3.6,0)
3.6
"BLD",4280,"KRN",3.8,0)
3.8
"BLD",4280,"KRN",9.2,0)
9.2
"BLD",4280,"KRN",9.8,0)
9.8
"BLD",4280,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4280,"KRN",9.8,"NM",1,0)
PRCPRSOH^^0^B19184669
"BLD",4280,"KRN",9.8,"NM",2,0)
PRCPRUSE^^0^B26472627
"BLD",4280,"KRN",9.8,"NM",3,0)
PRCPURS2^^0^B7490451
"BLD",4280,"KRN",9.8,"NM","B","PRCPRSOH",1)

"BLD",4280,"KRN",9.8,"NM","B","PRCPRUSE",2)

"BLD",4280,"KRN",9.8,"NM","B","PRCPURS2",3)

"BLD",4280,"KRN",19,0)
19
"BLD",4280,"KRN",19.1,0)
19.1
"BLD",4280,"KRN",101,0)
101
"BLD",4280,"KRN",409.61,0)
409.61
"BLD",4280,"KRN",771,0)
771
"BLD",4280,"KRN",870,0)
870
"BLD",4280,"KRN",8989.51,0)
8989.51
"BLD",4280,"KRN",8989.52,0)
8989.52
"BLD",4280,"KRN",8994,0)
8994
"BLD",4280,"KRN","B",.4,.4)

"BLD",4280,"KRN","B",.401,.401)

"BLD",4280,"KRN","B",.402,.402)

"BLD",4280,"KRN","B",.403,.403)

"BLD",4280,"KRN","B",.5,.5)

"BLD",4280,"KRN","B",.84,.84)

"BLD",4280,"KRN","B",3.6,3.6)

"BLD",4280,"KRN","B",3.8,3.8)

"BLD",4280,"KRN","B",9.2,9.2)

"BLD",4280,"KRN","B",9.8,9.8)

"BLD",4280,"KRN","B",19,19)

"BLD",4280,"KRN","B",19.1,19.1)

"BLD",4280,"KRN","B",101,101)

"BLD",4280,"KRN","B",409.61,409.61)

"BLD",4280,"KRN","B",771,771)

"BLD",4280,"KRN","B",870,870)

"BLD",4280,"KRN","B",8989.51,8989.51)

"BLD",4280,"KRN","B",8989.52,8989.52)

"BLD",4280,"KRN","B",8994,8994)

"BLD",4280,"QUES",0)
^9.62^^
"BLD",4280,"REQB",0)
^9.611^1^1
"BLD",4280,"REQB",1,0)
PRC*5.1*27^2
"BLD",4280,"REQB","B","PRC*5.1*27",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
84^3050614
"PKG",455,22,1,"PAH",1,1,0)
^^2^2^3050614
"PKG",455,22,1,"PAH",1,1,1,0)
This patch corrects some inconsistencies and M errors associated with
"PKG",455,22,1,"PAH",1,1,2,0)
the date range selection for some of the Generic Inventory reports.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCPRSOH")
0^1^B19184669
"RTN","PRCPRSOH",1,0)
PRCPRSOH ;WISC/RFJ-days of stock on hand report ;22 Oct 92
"RTN","PRCPRSOH",2,0)
 ;;5.1;IFCAP;**84**;Oct 20, 2000
"RTN","PRCPRSOH",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPRSOH",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRSOH",5,0)
 N DATEEND,DATEENDD,DATESTRD,DATESTRT,DAYSLEFT,DIR,GROUPALL,PRCPDAYS,PRCPEND,PRCPSTRT,PRCPTYPE,TOTALDAY,X,X1,X2,Y
"RTN","PRCPRSOH",6,0)
 K X S X(1)="The Days Of Stock On Hand Report will print a list of items which have stock on hand less than or greater than a specified number of days."
"RTN","PRCPRSOH",7,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSOH",8,0)
 K X S X(1)="Select the date range which should be used for calculating the daily usage. *** Select by month & year only. ***" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",9,0)
 D MONTHSEL^PRCPURS2 I '$G(DATEEND) Q
"RTN","PRCPRSOH",10,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC S TOTALDAY=X+1
"RTN","PRCPRSOH",11,0)
 S Y=DATEEND D DD^%DT S DATEENDD=Y,Y=DATESTRT D DD^%DT S DATESTRD=Y
"RTN","PRCPRSOH",12,0)
 W !?5,"-- TOTAL NUMBER OF DAYS: ",TOTALDAY
"RTN","PRCPRSOH",13,0)
 ;  select greater or less
"RTN","PRCPRSOH",14,0)
 K X S X(1)="Select the type of report: less than a specified number of days or greater than a specified number of days." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",15,0)
 S DIR(0)="S^1:LESS;2:GREATER",DIR("A")="Print items with GREATER or LESS than 'X' days stock on hand",DIR("B")="LESS"
"RTN","PRCPRSOH",16,0)
 D ^DIR S PRCPTYPE=+Y I 'PRCPTYPE Q
"RTN","PRCPRSOH",17,0)
 ;  select days
"RTN","PRCPRSOH",18,0)
 K X S X(1)="Select the number of days which the current stock on hand should be "_$S(PRCPTYPE=1:"LESS than",1:"GREATER than")_"." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",19,0)
 S DIR(0)="N^1:365",DIR("A")="Print items with stock on hand "_$S(PRCPTYPE=1:"less than",1:"greater than")_" DAYS",DIR("B")=30
"RTN","PRCPRSOH",20,0)
 D ^DIR S PRCPDAYS=+Y I 'PRCPDAYS Q
"RTN","PRCPRSOH",21,0)
 ;  whse sort
"RTN","PRCPRSOH",22,0)
 I PRCP("DPTYPE")="W" D  I '$D(PRCPSTRT) Q
"RTN","PRCPRSOH",23,0)
 .   K X S X(1)="Select the range of NSNs to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",24,0)
 .   D NSNSEL^PRCPURS0
"RTN","PRCPRSOH",25,0)
 ;  prim/seco sort
"RTN","PRCPRSOH",26,0)
 I PRCP("DPTYPE")'="W" D  I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" Q
"RTN","PRCPRSOH",27,0)
 .   K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",28,0)
 .   D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRSOH",29,0)
 ;
"RTN","PRCPRSOH",30,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  Q
"RTN","PRCPRSOH",31,0)
 .   S ZTDESC="Days of Stock On Hand Report",ZTRTN="DQ^PRCPRSOH"
"RTN","PRCPRSOH",32,0)
 .   S ZTSAVE("^TMP($J,""PRCPURS1"",")=""
"RTN","PRCPRSOH",33,0)
 .   S ZTSAVE("DATE*")="",ZTSAVE("GROUP*")="",ZTSAVE("PRCP*")="",ZTSAVE("TOTALDAY")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRSOH",34,0)
 .   D ^%ZTLOAD
"RTN","PRCPRSOH",35,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSOH",36,0)
DQ ;  queue starts here
"RTN","PRCPRSOH",37,0)
 N AVERAGE,DATE,GROUP,GROUPNM,ITEMDA,ITEMDATA,NSN,ONHAND,TOTAL,X,Y
"RTN","PRCPRSOH",38,0)
 K ^TMP($J,"PRCPRSOH")
"RTN","PRCPRSOH",39,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S ITEMDATA=$G(^(ITEMDA,0)) I ITEMDATA'="" D
"RTN","PRCPRSOH",40,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRSOH",41,0)
 .   ;  calculate total usage between dates
"RTN","PRCPRSOH",42,0)
 .   S DATE=$E(DATESTRT,1,5)-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE!(DATE>$E(DATEEND,1,5))  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRSOH",43,0)
 .   S AVERAGE=$J(TOTAL/TOTALDAY,0,2),ONHAND=$P(ITEMDATA,"^",7)+$P(ITEMDATA,"^",19)
"RTN","PRCPRSOH",44,0)
 .   S DAYSLEFT=$S('AVERAGE&(ONHAND):9999999,'AVERAGE:0,1:ONHAND/AVERAGE\1)
"RTN","PRCPRSOH",45,0)
 .   I PRCPTYPE=1,DAYSLEFT'<PRCPDAYS Q
"RTN","PRCPRSOH",46,0)
 .   I PRCPTYPE=2,DAYSLEFT'>PRCPDAYS Q
"RTN","PRCPRSOH",47,0)
 .   ;  sort for whse
"RTN","PRCPRSOH",48,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRSOH",49,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRSOH",50,0)
 .   .   I $E(NSN,1,$L(PRCPSTRT))'=PRCPSTRT,$E(NSN,1,$L(PRCPEND))'=PRCPEND I NSN']PRCPSTRT!(PRCPEND']NSN) Q
"RTN","PRCPRSOH",51,0)
 .   .   S ^TMP($J,"PRCPRSOH",NSN,ITEMDA)=TOTAL_"^"_AVERAGE_"^"_ONHAND_"^"_$P(DAYSLEFT,".")_"^"_$P(ITEMDATA,"^",27)
"RTN","PRCPRSOH",52,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRSOH",53,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPRSOH",54,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRSOH",55,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRSOH",56,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRSOH",57,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRSOH",58,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRSOH",59,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRSOH",60,0)
 .   S ^TMP($J,"PRCPRSOH",GROUPNM,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,15),ITEMDA)=TOTAL_"^"_AVERAGE_"^"_ONHAND_"^"_$P(DAYSLEFT,".")_"^"_$P(ITEMDATA,"^",27)
"RTN","PRCPRSOH",61,0)
 ;
"RTN","PRCPRSOH",62,0)
 D PRINT^PRCPRSO1
"RTN","PRCPRSOH",63,0)
 K ^TMP($J,"PRCPURS1"),^TMP($J,"PRCPRSOH")
"RTN","PRCPRSOH",64,0)
 D ^%ZISC
"RTN","PRCPRSOH",65,0)
 Q
"RTN","PRCPRUSE")
0^2^B26472627
"RTN","PRCPRUSE",1,0)
PRCPRUSE ;WISC/RFJ,DWA-usage demand item report  ;18 Sep 91
"RTN","PRCPRUSE",2,0)
V ;;5.1;IFCAP;**1,27,84**;Oct 20, 2000
"RTN","PRCPRUSE",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPRUSE",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRUSE",5,0)
 ;
"RTN","PRCPRUSE",6,0)
 N DATEEND,DATEENDD,DATESTRD,DATESTRT,DIR,GROUPALL,PRCPALLI,PRCPEND,PRCPSTRT,TOTALDAY,X,X1,X2,Y
"RTN","PRCPRUSE",7,0)
 ;
"RTN","PRCPRUSE",8,0)
 K X S X(1)="The Usage Demand Item Report will show the quantity of items used within a specified date period."
"RTN","PRCPRUSE",9,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRUSE",10,0)
 ;
"RTN","PRCPRUSE",11,0)
 K X S X(1)="Select the date range which should be used for displaying the usage.        *** Select by month & year only. ***"
"RTN","PRCPRUSE",12,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",13,0)
 D MONTHSEL^PRCPURS2
"RTN","PRCPRUSE",14,0)
 I '$G(DATEEND) Q
"RTN","PRCPRUSE",15,0)
 ;
"RTN","PRCPRUSE",16,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC S TOTALDAY=X+1
"RTN","PRCPRUSE",17,0)
 S Y=DATEEND D DD^%DT
"RTN","PRCPRUSE",18,0)
 S DATEENDD=Y,Y=DATESTRT D DD^%DT
"RTN","PRCPRUSE",19,0)
 S DATESTRD=Y
"RTN","PRCPRUSE",20,0)
 W !?5,"-- TOTAL NUMBER OF DAYS: ",TOTALDAY
"RTN","PRCPRUSE",21,0)
 ;
"RTN","PRCPRUSE",22,0)
 ;  item(s)
"RTN","PRCPRUSE",23,0)
 K X S X(1)="Select the items to display."
"RTN","PRCPRUSE",24,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",25,0)
 D ITEMSEL^PRCPURS4
"RTN","PRCPRUSE",26,0)
 I '$G(PRCPALLI),'$O(^TMP($J,"PRCPURS4","")) Q
"RTN","PRCPRUSE",27,0)
 I '$G(PRCPALLI) D  G SORT
"RTN","PRCPRUSE",28,0)
 .   S GROUPALL=1
"RTN","PRCPRUSE",29,0)
 ;
"RTN","PRCPRUSE",30,0)
 ;  whse sort
"RTN","PRCPRUSE",31,0)
 I PRCP("DPTYPE")="W" D  I '$D(PRCPSTRT) Q
"RTN","PRCPRUSE",32,0)
 .   K X S X(1)="Select the range of NSNs to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",33,0)
 .   D NSNSEL^PRCPURS0
"RTN","PRCPRUSE",34,0)
 ;
"RTN","PRCPRUSE",35,0)
 ;  prim/seco sort
"RTN","PRCPRUSE",36,0)
 I PRCP("DPTYPE")'="W" D  I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" Q
"RTN","PRCPRUSE",37,0)
 .   K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",38,0)
 .   D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRUSE",39,0)
 ;
"RTN","PRCPRUSE",40,0)
SORT K X S X(1)="Select the order in which you want the item information to appear."
"RTN","PRCPRUSE",41,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",42,0)
 S DIR(0)="S^1:ITEM DESCRIPTION;2:ITEM NUMBER"
"RTN","PRCPRUSE",43,0)
 S DIR("A")="Sort by"
"RTN","PRCPRUSE",44,0)
 S DIR("B")="ITEM DESCRIPTION"
"RTN","PRCPRUSE",45,0)
 D ^DIR K DIR
"RTN","PRCPRUSE",46,0)
 I Y'=1,Y'=2 Q
"RTN","PRCPRUSE",47,0)
 S PRCPSORT=+Y
"RTN","PRCPRUSE",48,0)
 ;
"RTN","PRCPRUSE",49,0)
QUEUE S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  Q
"RTN","PRCPRUSE",50,0)
 .   S ZTDESC="Usage Demand Item Report",ZTRTN="DQ^PRCPRUSE"
"RTN","PRCPRUSE",51,0)
 .   S ZTSAVE("^TMP($J,""PRCPURS4"",")="",ZTSAVE("^TMP($J,""PRCPURS1"",")=""
"RTN","PRCPRUSE",52,0)
 .   S ZTSAVE("DATE*")="",ZTSAVE("GROUP*")="",ZTSAVE("PRCP*")="",ZTSAVE("TOTALDAY")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRUSE",53,0)
 .   D ^%ZTLOAD
"RTN","PRCPRUSE",54,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRUSE",55,0)
 ;
"RTN","PRCPRUSE",56,0)
DQ ;  queue starts here
"RTN","PRCPRUSE",57,0)
 N %,%H,%I,COLUMN,DATA,DATE,DESCR,GROUP,GROUPNM,ITEMDA,MONYR,NOW,NSN,PAGE,PRCPFLAG,SCREEN,TOTCOST,TOTUSED,TTOTCOST,TTOTUSED,VALUE,X,Y
"RTN","PRCPRUSE",58,0)
 K ^TMP($J,"PRCPRUSE")
"RTN","PRCPRUSE",59,0)
 S ITEMDA=0
"RTN","PRCPRUSE",60,0)
 I $G(PRCPALLI) F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S DATA=$G(^(ITEMDA,0)) I DATA'="" D
"RTN","PRCPRUSE",61,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA)
"RTN","PRCPRUSE",62,0)
 .   S VALUE=DESCR_"^"_$$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/")_"^"_$P(DATA,"^",15)_"^"_$P(DATA,"^",22)_"^"_($P(DATA,"^",7)+$P(DATA,"^",19))
"RTN","PRCPRUSE",63,0)
 .   ;
"RTN","PRCPRUSE",64,0)
 .   ;  sort for whse
"RTN","PRCPRUSE",65,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRUSE",66,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRUSE",67,0)
 .   .   I $E(NSN,1,$L(PRCPSTRT))'=PRCPSTRT,$E(NSN,1,$L(PRCPEND))'=PRCPEND I NSN']PRCPSTRT!(PRCPEND']NSN) Q
"RTN","PRCPRUSE",68,0)
 .   .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",NSN,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",69,0)
 .   .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",NSN,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",70,0)
 .   ;
"RTN","PRCPRUSE",71,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRUSE",72,0)
 .   S GROUP=+$P(DATA,"^",21)
"RTN","PRCPRUSE",73,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRUSE",74,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRUSE",75,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRUSE",76,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRUSE",77,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRUSE",78,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRUSE",79,0)
 .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",GROUPNM,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",80,0)
 .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",GROUPNM,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",81,0)
 ;
"RTN","PRCPRUSE",82,0)
 I '$G(PRCPALLI) F  S ITEMDA=$O(^TMP($J,"PRCPURS4",ITEMDA)) Q:'ITEMDA  S DATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0)) I DATA'="" D
"RTN","PRCPRUSE",83,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA)
"RTN","PRCPRUSE",84,0)
 .   S VALUE=DESCR_"^"_$$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/")_"^"_$P(DATA,"^",15)_"^"_$P(DATA,"^",22)_"^"_($P(DATA,"^",7)+$P(DATA,"^",19))
"RTN","PRCPRUSE",85,0)
 .   ;
"RTN","PRCPRUSE",86,0)
 .   ;  sort for whse
"RTN","PRCPRUSE",87,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRUSE",88,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRUSE",89,0)
 .   .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",NSN,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",90,0)
 .   .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",NSN,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",91,0)
 .   ;
"RTN","PRCPRUSE",92,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRUSE",93,0)
 .   S GROUP=+$P(DATA,"^",21)
"RTN","PRCPRUSE",94,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRUSE",95,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRUSE",96,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRUSE",97,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRUSE",98,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRUSE",99,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRUSE",100,0)
 .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",GROUPNM,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",101,0)
 .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",GROUPNM,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",102,0)
 ;
"RTN","PRCPRUSE",103,0)
 D PRINT^PRCPRUSP
"RTN","PRCPRUSE",104,0)
 Q
"RTN","PRCPURS2")
0^3^B7490451
"RTN","PRCPURS2",1,0)
PRCPURS2 ;WISC/RFJ-select dates ;24 May 93
"RTN","PRCPURS2",2,0)
 ;;5.1;IFCAP;**84**;Oct 20, 2000
"RTN","PRCPURS2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPURS2",4,0)
 Q
"RTN","PRCPURS2",5,0)
 ;
"RTN","PRCPURS2",6,0)
 ;
"RTN","PRCPURS2",7,0)
DATESEL(V1) ;  select starting and ending dates in days
"RTN","PRCPURS2",8,0)
 ;  returns datestrt and dateend
"RTN","PRCPURS2",9,0)
 N %,%DT,%H,%I,DEFAULT,X,Y
"RTN","PRCPURS2",10,0)
 K DATEEND,DATESTRT
"RTN","PRCPURS2",11,0)
START S Y=$E(DT,1,5)_"01" D DD^%DT S DEFAULT=Y
"RTN","PRCPURS2",12,0)
 S %DT("A")="Start with "_$S(V1'="":V1_" ",1:"")_"Date: ",%DT("B")=DEFAULT,%DT="AEP",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","PRCPURS2",13,0)
 I $E(Y,6,7)="00" S Y=$E(Y,1,5)_"01"
"RTN","PRCPURS2",14,0)
 S DATESTRT=Y
"RTN","PRCPURS2",15,0)
 S Y=DT D DD^%DT S DEFAULT=Y
"RTN","PRCPURS2",16,0)
 S %DT("A")="  End with "_$S(V1'="":V1_" ",1:"")_"Date: ",%DT("B")=DEFAULT,%DT="AEP",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","PRCPURS2",17,0)
 I $E(Y,6,7)="00" S Y=$E(Y,1,5)_"01"
"RTN","PRCPURS2",18,0)
 I Y<DATESTRT W !,"END DATE MUST BE GREATER THAN OR EQUAL TO THE START DATE.",! G START
"RTN","PRCPURS2",19,0)
 S DATEEND=Y,Y=DATESTRT D DD^%DT
"RTN","PRCPURS2",20,0)
 W !?5,"***  Selected date range from ",Y," to " S Y=DATEEND D DD^%DT W Y,"  ***"
"RTN","PRCPURS2",21,0)
 Q
"RTN","PRCPURS2",22,0)
 ;
"RTN","PRCPURS2",23,0)
 ;
"RTN","PRCPURS2",24,0)
MONTHSEL ;  select starting and ending dates in months
"RTN","PRCPURS2",25,0)
 ;  returns datestrt and dateend
"RTN","PRCPURS2",26,0)
 ; modified 5/27/05 to actually restrict selections to month & year
"RTN","PRCPURS2",27,0)
 ; and return DATESTRT as 1st of beginning month and DATEEND as last day of ending month. - T. Holloway
"RTN","PRCPURS2",28,0)
 N %,%DT,%H,%I,DEFAULT,PRCLP,PRCMN,X,Y
"RTN","PRCPURS2",29,0)
 K DATEEND,DATESTRT
"RTN","PRCPURS2",30,0)
START1 S X1=DT,X2=-90 D C^%DTC S Y=$E(X,1,5)_"00" D DD^%DT S DEFAULT=Y
"RTN","PRCPURS2",31,0)
 S %DT("A")="Start with Date: ",%DT("B")=DEFAULT,%DT="AEPM",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","PRCPURS2",32,0)
 S DATESTRT=Y
"RTN","PRCPURS2",33,0)
 S Y=$E(DT,1,5)_"00" D DD^%DT S DEFAULT=Y
"RTN","PRCPURS2",34,0)
 S %DT("A")="  End with Date: ",%DT("B")=DEFAULT,%DT="AEPM",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","PRCPURS2",35,0)
 I Y<DATESTRT W !,"END DATE MUST BE GREATER THAN OR EQUAL TO THE START DATE.",! G START1
"RTN","PRCPURS2",36,0)
 S PRCLP=$$LEAP^DIDTC($E(Y,1,3)),PRCMN=+$E(Y,4,5),DATESTRT=DATESTRT+1
"RTN","PRCPURS2",37,0)
 S DATEEND=$E(Y,1,5)_$P("31^28^31^30^31^30^31^31^30^31^30^31","^",PRCMN) ; set end date to last day of month
"RTN","PRCPURS2",38,0)
 S:PRCMN=2 DATEEND=DATEEND+PRCLP ; if February and Leap Year, add 1 to get 29th
"RTN","PRCPURS2",39,0)
 S:DATEEND>DT DATEEND=DT-1 ; if end month is current month, set DATEEND to yesterday
"RTN","PRCPURS2",40,0)
 I $E(DATEEND,6,7)="00" W !,"  You may not include the current month until at least 1 full day",!,"  has passed.",! G START1
"RTN","PRCPURS2",41,0)
 S Y=DATESTRT D DD^%DT
"RTN","PRCPURS2",42,0)
 W !?5,"***  Selected date range from ",Y," to " S Y=DATEEND D DD^%DT W Y,"  ***"
"RTN","PRCPURS2",43,0)
 Q
"VER")
8.0^22.0
"BLD",4280,6)
^SEQ #69
**END**
**END**
