Released IB*2*222 SEQ #249
Extracted from mail message
**KIDS**:IB*2.0*222^

**INSTALL NAME**
IB*2.0*222
"BLD",4806,0)
IB*2.0*222^INTEGRATED BILLING^0^3040317^y
"BLD",4806,1,0)
^^1^1^3030723^
"BLD",4806,1,1,0)
MEANS TEST DATE PROBLEM
"BLD",4806,4,0)
^9.64PA^^
"BLD",4806,"KRN",0)
^9.67PA^8989.52^19
"BLD",4806,"KRN",.4,0)
.4
"BLD",4806,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4806,"KRN",.401,0)
.401
"BLD",4806,"KRN",.402,0)
.402
"BLD",4806,"KRN",.403,0)
.403
"BLD",4806,"KRN",.5,0)
.5
"BLD",4806,"KRN",.84,0)
.84
"BLD",4806,"KRN",3.6,0)
3.6
"BLD",4806,"KRN",3.8,0)
3.8
"BLD",4806,"KRN",9.2,0)
9.2
"BLD",4806,"KRN",9.8,0)
9.8
"BLD",4806,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4806,"KRN",9.8,"NM",1,0)
IBARXEU^^0^B19501479
"BLD",4806,"KRN",9.8,"NM","B","IBARXEU",1)

"BLD",4806,"KRN",19,0)
19
"BLD",4806,"KRN",19,"NM",0)
^9.68A^^
"BLD",4806,"KRN",19.1,0)
19.1
"BLD",4806,"KRN",101,0)
101
"BLD",4806,"KRN",409.61,0)
409.61
"BLD",4806,"KRN",771,0)
771
"BLD",4806,"KRN",870,0)
870
"BLD",4806,"KRN",8989.51,0)
8989.51
"BLD",4806,"KRN",8989.52,0)
8989.52
"BLD",4806,"KRN",8994,0)
8994
"BLD",4806,"KRN","B",.4,.4)

"BLD",4806,"KRN","B",.401,.401)

"BLD",4806,"KRN","B",.402,.402)

"BLD",4806,"KRN","B",.403,.403)

"BLD",4806,"KRN","B",.5,.5)

"BLD",4806,"KRN","B",.84,.84)

"BLD",4806,"KRN","B",3.6,3.6)

"BLD",4806,"KRN","B",3.8,3.8)

"BLD",4806,"KRN","B",9.2,9.2)

"BLD",4806,"KRN","B",9.8,9.8)

"BLD",4806,"KRN","B",19,19)

"BLD",4806,"KRN","B",19.1,19.1)

"BLD",4806,"KRN","B",101,101)

"BLD",4806,"KRN","B",409.61,409.61)

"BLD",4806,"KRN","B",771,771)

"BLD",4806,"KRN","B",870,870)

"BLD",4806,"KRN","B",8989.51,8989.51)

"BLD",4806,"KRN","B",8989.52,8989.52)

"BLD",4806,"KRN","B",8994,8994)

"BLD",4806,"QUES",0)
^9.62^^
"BLD",4806,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
222^3040317
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3040317
"PKG",200,22,1,"PAH",1,1,1,0)
MEANS TEST DATE PROBLEM
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBARXEU")
0^1^B19501479
"RTN","IBARXEU",1,0)
IBARXEU ;AAS/ALB - RX EXEMPTION UTILITY ROUTINE ;2-NOV-92
"RTN","IBARXEU",2,0)
 ;;2.0;INTEGRATED BILLING;**20,222**;21-MAR-94
"RTN","IBARXEU",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEU",4,0)
 ;
"RTN","IBARXEU",5,0)
 ;
"RTN","IBARXEU",6,0)
RXST(DFN,IBDT) ; -- Check rx income exemption status of patient
"RTN","IBARXEU",7,0)
 ;
"RTN","IBARXEU",8,0)
 ;  input = :  dfn  = patient file pointer
"RTN","IBARXEU",9,0)
 ;             ibdt = date to check for (optional) default is today
"RTN","IBARXEU",10,0)
 ;
"RTN","IBARXEU",11,0)
 ;  returns :  -1 if no data   ^text^reason code^reason text^date of test
"RTN","IBARXEU",12,0)
 ;              0 if non exempt
"RTN","IBARXEU",13,0)
 ;              1 if exempt
"RTN","IBARXEU",14,0)
 ;
"RTN","IBARXEU",15,0)
 N X,Y,Z,IBX,IBON
"RTN","IBARXEU",16,0)
 ;
"RTN","IBARXEU",17,0)
 S IBON=$$ON^IBARXEU0 I IBON<1 Q IBON
"RTN","IBARXEU",18,0)
 ;
"RTN","IBARXEU",19,0)
 S IBX=""
"RTN","IBARXEU",20,0)
 I '$G(IBDT) S IBDT=DT
"RTN","IBARXEU",21,0)
 I IBDT>DT S IBDT=DT ; no future dates
"RTN","IBARXEU",22,0)
 ;
"RTN","IBARXEU",23,0)
 ; -- date before legislations
"RTN","IBARXEU",24,0)
 I IBDT<$$STDATE S IBX="0^NON-EXEMPT^^Date is Prior to Legislation^" G RXSTQ ; nobody exempt prior to legislation
"RTN","IBARXEU",25,0)
 ;
"RTN","IBARXEU",26,0)
 ; -- if no data on patient quit
"RTN","IBARXEU",27,0)
 S X=$G(^IBA(354,DFN,0))
"RTN","IBARXEU",28,0)
 I X=""!('$D(^IBA(354.1,"AP",DFN))) S IBX="-1^UNKNOWN^^Medication Copayment Exemption status never determined" G RXSTQ ; no data return -1
"RTN","IBARXEU",29,0)
 ;
"RTN","IBARXEU",30,0)
 ; -- use current status if ibdt not less than current test and
"RTN","IBARXEU",31,0)
 ;    not greater than current test date +365
"RTN","IBARXEU",32,0)
 I IBDT'<$P(X,U,3),IBDT'>$$PLUS^IBARXEU0($P(X,U,3)) S IBX=$$IBX^IBARXEU0(DFN,IBDT) G RXSTQ
"RTN","IBARXEU",33,0)
 ;
"RTN","IBARXEU",34,0)
 ; -- if ibdt not less than current date but greater than
"RTN","IBARXEU",35,0)
 ;    current test +365 is into future
"RTN","IBARXEU",36,0)
 I IBDT'<$P(X,U,3),IBDT>$$PLUS^IBARXEU0($P(X,U,3)) D
"RTN","IBARXEU",37,0)
 .S Y=$$LST^IBARXEU0(DFN,IBDT)
"RTN","IBARXEU",38,0)
 .;
"RTN","IBARXEU",39,0)
 .; -- see if patient was SC>50, can't be updated so don't say previous
"RTN","IBARXEU",40,0)
 .I $L($$ACODE^IBARXEU0(Y))<3 S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3) Q
"RTN","IBARXEU",41,0)
 .;
"RTN","IBARXEU",42,0)
 .S IBX=+$P(X,U,4)_U_"Previously "_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_"Requires new exemption. Previously "_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",43,0)
 ;
"RTN","IBARXEU",44,0)
 ; -- if ibdt less than current date need old exemption data
"RTN","IBARXEU",45,0)
 I IBDT<$P(X,U,3) D  G RXSTQ
"RTN","IBARXEU",46,0)
 .;
"RTN","IBARXEU",47,0)
 .; -- find status of prior test
"RTN","IBARXEU",48,0)
 .S Y=$$LST^IBARXEU0(DFN,IBDT)
"RTN","IBARXEU",49,0)
 .;
"RTN","IBARXEU",50,0)
 .; -- no previous data
"RTN","IBARXEU",51,0)
 .I Y="" D  Q
"RTN","IBARXEU",52,0)
 ..S IBX="-1^UNKNOWN^^No data for date requested."
"RTN","IBARXEU",53,0)
 ..Q
"RTN","IBARXEU",54,0)
 .;
"RTN","IBARXEU",55,0)
 .S Z=$G(^IBA(354,DFN,0)),Z=$P(Z,U,5)_U_$P(Z,U,3) ; get status & date
"RTN","IBARXEU",56,0)
 .;
"RTN","IBARXEU",57,0)
 .; -- if old exemption is current for copay date
"RTN","IBARXEU",58,0)
 .I IBDT'>$$PLUS^IBARXEU0(+Y) D  Q
"RTN","IBARXEU",59,0)
 ..S X=$G(^IBE(354.2,+$P(Y,U,5),0)) ; exemption reason node
"RTN","IBARXEU",60,0)
 ..S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",61,0)
 ..Q
"RTN","IBARXEU",62,0)
 .;
"RTN","IBARXEU",63,0)
 .; -- if ibdt is greater than old exemption + 365
"RTN","IBARXEU",64,0)
 .;    report previous
"RTN","IBARXEU",65,0)
 .I IBDT>$$PLUS^IBARXEU0(+Y) D  Q
"RTN","IBARXEU",66,0)
 ..S X=$G(^IBE(354.2,+$P(Y,U,5),0)) ;exemption reason node
"RTN","IBARXEU",67,0)
 ..;
"RTN","IBARXEU",68,0)
 ..; -- see if patient was SC>50, can't be updated so don't say previous
"RTN","IBARXEU",69,0)
 ..I $L($$ACODE^IBARXEU0(Y))<3 S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3) Q
"RTN","IBARXEU",70,0)
 ..;
"RTN","IBARXEU",71,0)
 ..S IBX=+$P(X,U,4)_U_"Previously "_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_"Requires new exemption. Previously "_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",72,0)
 ..Q
"RTN","IBARXEU",73,0)
 .Q
"RTN","IBARXEU",74,0)
 ;
"RTN","IBARXEU",75,0)
RXSTQ Q IBX
"RTN","IBARXEU",76,0)
 ;
"RTN","IBARXEU",77,0)
DISP(DFN,IBDT,NO,NULL) ; -- formats text to display 
"RTN","IBARXEU",78,0)
 ; -- input =  dfn
"RTN","IBARXEU",79,0)
 ;             ibdt = date to check for
"RTN","IBARXEU",80,0)
 ;             no   = number of lines to print (1, 2, or 3)
"RTN","IBARXEU",81,0)
 ;             null = if zero print unknown, if non-zero quit
"RTN","IBARXEU",82,0)
 ;
"RTN","IBARXEU",83,0)
 I '$G(IBDT) S IBDT=DT
"RTN","IBARXEU",84,0)
 I '$D(NULL) S NULL=1
"RTN","IBARXEU",85,0)
 I IBDT>DT S IBDT=DT ; no future dates
"RTN","IBARXEU",86,0)
 I '$G(NO) S NO=3
"RTN","IBARXEU",87,0)
 S X=$$RXST(DFN,IBDT)
"RTN","IBARXEU",88,0)
 S IBON=$$ON^IBARXEU0 I IBON<1 S X=IBON
"RTN","IBARXEU",89,0)
 I X<0&(NULL) G DISPQ
"RTN","IBARXEU",90,0)
 W !,"Medication Copayment Exemption Status: ",$P(X,U,2) G:NO<2 DISPQ
"RTN","IBARXEU",91,0)
 W !,$P(X,U,4) G:NO<3 DISPQ
"RTN","IBARXEU",92,0)
 I $P(X,U,5) W !,"Last test date: " S Y=$P(X,U,5) D DT^DIQ
"RTN","IBARXEU",93,0)
DISPQ Q
"RTN","IBARXEU",94,0)
 ;
"RTN","IBARXEU",95,0)
STDATE() ; -- legislative start date for income exemption
"RTN","IBARXEU",96,0)
 Q 2921030
"RTN","IBARXEU",97,0)
 ;
"RTN","IBARXEU",98,0)
 ;
"RTN","IBARXEU",99,0)
ACTIVE(IBZ) ; -- SCREEN for active field of billing exemptions file
"RTN","IBARXEU",100,0)
 ;    only one entry per effective date can be active
"RTN","IBARXEU",101,0)
 ;
"RTN","IBARXEU",102,0)
 N IBX,IBY,T
"RTN","IBARXEU",103,0)
 S T=0
"RTN","IBARXEU",104,0)
 S IBZ=$S(IBZ=1:IBZ,$E(IBZ)="A":1,1:0)
"RTN","IBARXEU",105,0)
 I 'IBZ S T=1 G ACTIVEQ
"RTN","IBARXEU",106,0)
 S IBX=$G(^IBA(354.1,DA,0))
"RTN","IBARXEU",107,0)
 S IBY=$O(^IBA(354.1,"AIVDT",+$P(IBX,U,3),+$P(IBX,U,2),-$P(IBX,U),0))
"RTN","IBARXEU",108,0)
 I 'IBY!(IBY=DA) S T=1
"RTN","IBARXEU",109,0)
 W:$D(IBTALK) !!,"Another entry is already Active, You must inactivate it first",!!
"RTN","IBARXEU",110,0)
ACTIVEQ Q T
"VER")
8.0^22
**END**
**END**
