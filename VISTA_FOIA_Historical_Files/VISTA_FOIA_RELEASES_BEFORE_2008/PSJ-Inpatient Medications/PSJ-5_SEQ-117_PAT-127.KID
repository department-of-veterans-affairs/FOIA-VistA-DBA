EMERGENCY Released PSJ*5*127 SEQ #117
Extracted from mail message
**KIDS**:PSJ*5.0*127^

**INSTALL NAME**
PSJ*5.0*127
"BLD",4811,0)
PSJ*5.0*127^INPATIENT MEDICATIONS^0^3050112^y
"BLD",4811,1,0)
^^106^106^3050112^
"BLD",4811,1,1,0)
 1. A site reports that when a nurse verifies a renewed order, the nurse's
"BLD",4811,1,2,0)
 initials do not consistently appear in BCMA. This patch corrects the
"BLD",4811,1,3,0)
 problem by saving the verifying nurse information if the nurse 
"BLD",4811,1,4,0)
 verification occurred after the renewal action. NOIS# NCH-1004-40487.
"BLD",4811,1,5,0)
 
"BLD",4811,1,6,0)
 2. A site reports that IV orders copied using the CO (Copy) action in
"BLD",4811,1,7,0)
 Inpatient Medications V. 5.0 retain the original order's verifying 
"BLD",4811,1,8,0)
 pharmacist, so that an unverified copied IV order may incorrectly appear
"BLD",4811,1,9,0)
 to have been verified by a pharmacist. This patch corrects the problem 
"BLD",4811,1,10,0)
 by removing the original order's verifying pharmacist from the copied
"BLD",4811,1,11,0)
 order. NOIS# CLA-1004-22199
"BLD",4811,1,12,0)
 
"BLD",4811,1,13,0)
 3. A site reports that after discontinuing a complex IV order, a user 
"BLD",4811,1,14,0)
 may be prevented from creating a new IV order until first exiting and 
"BLD",4811,1,15,0)
 then returning to the option. The software treats the new IV order like 
"BLD",4811,1,16,0)
 a complex order and prevents entry of some required fields. This patch 
"BLD",4811,1,17,0)
 corrects the problem by improving the check that determines whether or 
"BLD",4811,1,18,0)
 not the current order is a complex order. NOIS# SAG-1004-41795.
"BLD",4811,1,19,0)
 
"BLD",4811,1,20,0)
 4. When using the SF (Speed Finish) action to finish pending renewal
"BLD",4811,1,21,0)
 orders in the Unit Dose Order Entry [PSJU NE] option, the name of the 
"BLD",4811,1,22,0)
 finishing pharmacist is incorrectly saved as the provider for the order.
"BLD",4811,1,23,0)
 This patch corrects this problem by properly saving the ordering provider
"BLD",4811,1,24,0)
 with the order when SF (Speed Finish) is used. NOIS# AMA-1004-71742.
"BLD",4811,1,25,0)
 
"BLD",4811,1,26,0)
 5. When a component, or child order, of a complex order is created from  
"BLD",4811,1,27,0)
 Computerized Patient Record System (CPRS) V. 1.0 with a schedule of NOW 
"BLD",4811,1,28,0)
 and NOW does not exist in the ADMINISTRATION SCHEDULE (#51.1) file, the 
"BLD",4811,1,29,0)
 order does not appear in the patient's profile in Inpatient Medications 
"BLD",4811,1,30,0)
 V. 5.0. This patch corrects the problem by ensuring child orders with a 
"BLD",4811,1,31,0)
 schedule of NOW appear in Inpatient Medications V. 5.0.
"BLD",4811,1,32,0)
 
"BLD",4811,1,33,0)
 6. Renewed Unit Dose orders do not appear on the updated pick list
"BLD",4811,1,34,0)
 printed using the Update Pick List [PSJU PLUP] option. With this patch
"BLD",4811,1,35,0)
 renewed orders will appear on the updated pick list when appropriate.
"BLD",4811,1,36,0)
 NOIS: NCH-1104-40147
"BLD",4811,1,37,0)
 
"BLD",4811,1,38,0)
 7. When finishing a complex order that was renewed from CPRS, there is a
"BLD",4811,1,39,0)
 prompt for Pre-Exchange Doses, but there is no prompt to print the
"BLD",4811,1,40,0)
 Pre-Exchange Report. A prompt has been added to allow the Pre-Exchange
"BLD",4811,1,41,0)
 report to be printed for renewed complex orders. NOIS: MAR-1004-21942.
"BLD",4811,1,42,0)
 
"BLD",4811,1,43,0)
 8. The SF Speed Finish action in the Unit Dose Order Entry [PSJU NE]
"BLD",4811,1,44,0)
 option prompts for Pre-Exchange Doses, but there is no prompt to print
"BLD",4811,1,45,0)
 the Pre-Exchange Report when finishing a pending renewal order. A prompt
"BLD",4811,1,46,0)
 has been added to allow the Pre-Exchange Report to be printed for orders
"BLD",4811,1,47,0)
 that are finished using the SF Speed Finish action. NOIS: CLE-1004-42151.
"BLD",4811,1,48,0)
 
"BLD",4811,1,49,0)
 9. The initial label printed for renewed continuous IV orders indicates
"BLD",4811,1,50,0)
 it is due at the date and time that the order was renewed, rather than
"BLD",4811,1,51,0)
 at the next scheduled infusion date and time. With this patch, the first
"BLD",4811,1,52,0)
 label printed for this type of order will be due at the next scheduled
"BLD",4811,1,53,0)
 infusion date and time. IND-1104-40485.
"BLD",4811,1,54,0)
 
"BLD",4811,1,55,0)
 10. After finishing IV scripts, the user is prompted for the number of
"BLD",4811,1,56,0)
 labels to print.  The label print code does not limit the user input, so
"BLD",4811,1,57,0)
 if the user enters an excessive number of labels, then this can lead to
"BLD",4811,1,58,0)
 system performance problems.  This patch will apply the limit of 99
"BLD",4811,1,59,0)
 labels at the number of labels prompt. SFC-0603-61734.
"BLD",4811,1,60,0)
 
"BLD",4811,1,61,0)
 11. Complex Orders are not showing on the VDL in BCMA when the order
"BLD",4811,1,62,0)
 initially contains a schedule without a frequency, regardless of edits
"BLD",4811,1,63,0)
 made during finishing. With this patch, the schedule changes made during
"BLD",4811,1,64,0)
 finish will update the complex orders schedule frequency, enabling the
"BLD",4811,1,65,0)
 orders to display in BCMA at the appropriate times. SBY-1104-31772
"BLD",4811,1,66,0)
 
"BLD",4811,1,67,0)
 12. The stop date of a pending renewal order containing a non-standard
"BLD",4811,1,68,0)
 schedule and an orderable item with a day/dose limit cannot be edited
"BLD",4811,1,69,0)
 until after the order is made active. Also, Schedule Type and Unit
"BLD",4811,1,70,0)
 Per Dose edits made during finish of a pending renewal are not applied
"BLD",4811,1,71,0)
 when the order is made active. With this patch, changes made to these
"BLD",4811,1,72,0)
 fields during the finish proces will be applied to the active order.
"BLD",4811,1,73,0)
 ERI-1204-20679
"BLD",4811,1,74,0)
 
"BLD",4811,1,75,0)
 13. One-time orders that are not part of a complex order may be renewed
"BLD",4811,1,76,0)
 from CPRS V.1.0, even after they are given. This patch will prevent this
"BLD",4811,1,77,0)
 problem by preventing all non-complex one-time orders from being renewed.
"BLD",4811,1,78,0)
 Restriction of the renewal of complex one-time orders will be addressed
"BLD",4811,1,79,0)
 in a future CPRS V.1.0 patch. PSI-04-056.
"BLD",4811,1,80,0)
 
"BLD",4811,1,81,0)
 14. This patch modifies the Data Dictionary of the NON-VERIFIED ORDERS
"BLD",4811,1,82,0)
 FILE (#53.1) for the ORDERS FILE PARENT ORDER field (#125). The change
"BLD",4811,1,83,0)
 removes Inpatient Medications from the process of stripping NOW orders
"BLD",4811,1,84,0)
 from Complex Orders. This process is handled exclusively by CPRS.
"BLD",4811,1,85,0)
 
"BLD",4811,1,86,0)
 53.1,125     ORDERS FILE PARENT ORDER .2;8 POINTER TO ORDER FILE (#100)
"BLD",4811,1,87,0)
 
"BLD",4811,1,88,0)
 
"BLD",4811,1,89,0)
 
"BLD",4811,1,90,0)
              LAST EDITED:     DEC 13, 2004
"BLD",4811,1,91,0)
              HELP-PROMPT:     Enter the parent order, if this order is
"BLD",4811,1,92,0)
                               its child order.
"BLD",4811,1,93,0)
              DESCRIPTION:     This is the parent of a CPRS order that
"BLD",4811,1,94,0)
                               may have a parent/child relationship in
"BLD",4811,1,95,0)
                               CPRS.
"BLD",4811,1,96,0)
 
"BLD",4811,1,97,0)
             CROSS-REFERENCE:  53.1^ACX
"BLD",4811,1,98,0)
                               1)= S ^PS(53.1,"ACX",$E(X,1,30),DA)=""
"BLD",4811,1,99,0)
                               2)= K ^PS(53.1,"ACX",$E(X,1,30),DA)
"BLD",4811,1,100,0)
                               This cross reference is created each time a
"BLD",4811,1,101,0)
                               component of a complex order, or child
"BLD",4811,1,102,0)
                               order, is received from CPRS.  This cross
"BLD",4811,1,103,0)
                                reference will not be created for orders
"BLD",4811,1,104,0)
                               with a schedule of NOW, effectively
"BLD",4811,1,105,0)
                               disassociating the NOW order from the other
"BLD",4811,1,106,0)
                               child orders in the complex order.
"BLD",4811,4,0)
^9.64PA^53.1^1
"BLD",4811,4,53.1,0)
53.1
"BLD",4811,4,53.1,2,0)
^9.641^53.1^1
"BLD",4811,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",4811,4,53.1,2,53.1,1,0)
^9.6411^125^1
"BLD",4811,4,53.1,2,53.1,1,125,0)
ORDERS FILE PARENT ORDER
"BLD",4811,4,53.1,222)
y^y^p^^^^n^^n
"BLD",4811,4,53.1,224)

"BLD",4811,4,"APDD",53.1,53.1)

"BLD",4811,4,"APDD",53.1,53.1,125)

"BLD",4811,4,"B",53.1,53.1)

"BLD",4811,"ABPKG")
n
"BLD",4811,"INI")

"BLD",4811,"INID")
^^n
"BLD",4811,"KRN",0)
^9.67PA^8989.52^19
"BLD",4811,"KRN",.4,0)
.4
"BLD",4811,"KRN",.401,0)
.401
"BLD",4811,"KRN",.402,0)
.402
"BLD",4811,"KRN",.403,0)
.403
"BLD",4811,"KRN",.5,0)
.5
"BLD",4811,"KRN",.84,0)
.84
"BLD",4811,"KRN",3.6,0)
3.6
"BLD",4811,"KRN",3.8,0)
3.8
"BLD",4811,"KRN",9.2,0)
9.2
"BLD",4811,"KRN",9.8,0)
9.8
"BLD",4811,"KRN",9.8,"NM",0)
^9.68A^34^32
"BLD",4811,"KRN",9.8,"NM",1,0)
PSJHLV^^0^B21177155
"BLD",4811,"KRN",9.8,"NM",2,0)
PSIVOD^^0^B13277996
"BLD",4811,"KRN",9.8,"NM",3,0)
PSIVORC2^^0^B57115915
"BLD",4811,"KRN",9.8,"NM",4,0)
PSIVEDT^^0^B38742764
"BLD",4811,"KRN",9.8,"NM",5,0)
PSIVOPT1^^0^B39564315
"BLD",4811,"KRN",9.8,"NM",6,0)
PSGOER0^^0^B21348722
"BLD",4811,"KRN",9.8,"NM",7,0)
PSIVORE^^0^B40899731
"BLD",4811,"KRN",9.8,"NM",8,0)
PSJHL7^^0^B47267607
"BLD",4811,"KRN",9.8,"NM",10,0)
PSGOTR^^0^B9466646
"BLD",4811,"KRN",9.8,"NM",11,0)
PSJORREN^^0^B19932169
"BLD",4811,"KRN",9.8,"NM",12,0)
PSGPEN^^0^B38665024
"BLD",4811,"KRN",9.8,"NM",13,0)
PSGPER^^0^B11299259
"BLD",4811,"KRN",9.8,"NM",14,0)
PSGPER1^^0^B7625269
"BLD",4811,"KRN",9.8,"NM",15,0)
PSIVLABL^^0^B28071183
"BLD",4811,"KRN",9.8,"NM",16,0)
PSIVORE1^^0^B26582171
"BLD",4811,"KRN",9.8,"NM",17,0)
PSJCOM1^^0^B47079463
"BLD",4811,"KRN",9.8,"NM",18,0)
PSIVOPT2^^0^B31964183
"BLD",4811,"KRN",9.8,"NM",19,0)
PSGOESF^^0^B25676583
"BLD",4811,"KRN",9.8,"NM",20,0)
PSJO1^^0^B30933706
"BLD",4811,"KRN",9.8,"NM",21,0)
PSIVOREN^^0^B25008100
"BLD",4811,"KRN",9.8,"NM",23,0)
PSGVBW0^^0^B34961273
"BLD",4811,"KRN",9.8,"NM",24,0)
PSJOEA^^0^B27345819
"BLD",4811,"KRN",9.8,"NM",25,0)
PSJOEA1^^0^B29175259
"BLD",4811,"KRN",9.8,"NM",26,0)
PSJCOMR^^0^B74911217
"BLD",4811,"KRN",9.8,"NM",27,0)
PSJAC^^0^B14263824
"BLD",4811,"KRN",9.8,"NM",28,0)
PSJCOMV^^0^B41315630
"BLD",4811,"KRN",9.8,"NM",29,0)
PSJOEA2^^0^B27378204
"BLD",4811,"KRN",9.8,"NM",30,0)
PSGOE82^^0^B18537493
"BLD",4811,"KRN",9.8,"NM",31,0)
PSJOREN^^0^B13957518
"BLD",4811,"KRN",9.8,"NM",32,0)
PSGOE1^^0^B29780888
"BLD",4811,"KRN",9.8,"NM",33,0)
PSJDCU^^0^B4062341
"BLD",4811,"KRN",9.8,"NM",34,0)
PSJORPOE^^0^B26853302
"BLD",4811,"KRN",9.8,"NM","B","PSGOE1",32)

"BLD",4811,"KRN",9.8,"NM","B","PSGOE82",30)

"BLD",4811,"KRN",9.8,"NM","B","PSGOER0",6)

"BLD",4811,"KRN",9.8,"NM","B","PSGOESF",19)

"BLD",4811,"KRN",9.8,"NM","B","PSGOTR",10)

"BLD",4811,"KRN",9.8,"NM","B","PSGPEN",12)

"BLD",4811,"KRN",9.8,"NM","B","PSGPER",13)

"BLD",4811,"KRN",9.8,"NM","B","PSGPER1",14)

"BLD",4811,"KRN",9.8,"NM","B","PSGVBW0",23)

"BLD",4811,"KRN",9.8,"NM","B","PSIVEDT",4)

"BLD",4811,"KRN",9.8,"NM","B","PSIVLABL",15)

"BLD",4811,"KRN",9.8,"NM","B","PSIVOD",2)

"BLD",4811,"KRN",9.8,"NM","B","PSIVOPT1",5)

"BLD",4811,"KRN",9.8,"NM","B","PSIVOPT2",18)

"BLD",4811,"KRN",9.8,"NM","B","PSIVORC2",3)

"BLD",4811,"KRN",9.8,"NM","B","PSIVORE",7)

"BLD",4811,"KRN",9.8,"NM","B","PSIVORE1",16)

"BLD",4811,"KRN",9.8,"NM","B","PSIVOREN",21)

"BLD",4811,"KRN",9.8,"NM","B","PSJAC",27)

"BLD",4811,"KRN",9.8,"NM","B","PSJCOM1",17)

"BLD",4811,"KRN",9.8,"NM","B","PSJCOMR",26)

"BLD",4811,"KRN",9.8,"NM","B","PSJCOMV",28)

"BLD",4811,"KRN",9.8,"NM","B","PSJDCU",33)

"BLD",4811,"KRN",9.8,"NM","B","PSJHL7",8)

"BLD",4811,"KRN",9.8,"NM","B","PSJHLV",1)

"BLD",4811,"KRN",9.8,"NM","B","PSJO1",20)

"BLD",4811,"KRN",9.8,"NM","B","PSJOEA",24)

"BLD",4811,"KRN",9.8,"NM","B","PSJOEA1",25)

"BLD",4811,"KRN",9.8,"NM","B","PSJOEA2",29)

"BLD",4811,"KRN",9.8,"NM","B","PSJOREN",31)

"BLD",4811,"KRN",9.8,"NM","B","PSJORPOE",34)

"BLD",4811,"KRN",9.8,"NM","B","PSJORREN",11)

"BLD",4811,"KRN",19,0)
19
"BLD",4811,"KRN",19,"NM",0)
^9.68A^^
"BLD",4811,"KRN",19.1,0)
19.1
"BLD",4811,"KRN",101,0)
101
"BLD",4811,"KRN",409.61,0)
409.61
"BLD",4811,"KRN",771,0)
771
"BLD",4811,"KRN",870,0)
870
"BLD",4811,"KRN",8989.51,0)
8989.51
"BLD",4811,"KRN",8989.52,0)
8989.52
"BLD",4811,"KRN",8994,0)
8994
"BLD",4811,"KRN","B",.4,.4)

"BLD",4811,"KRN","B",.401,.401)

"BLD",4811,"KRN","B",.402,.402)

"BLD",4811,"KRN","B",.403,.403)

"BLD",4811,"KRN","B",.5,.5)

"BLD",4811,"KRN","B",.84,.84)

"BLD",4811,"KRN","B",3.6,3.6)

"BLD",4811,"KRN","B",3.8,3.8)

"BLD",4811,"KRN","B",9.2,9.2)

"BLD",4811,"KRN","B",9.8,9.8)

"BLD",4811,"KRN","B",19,19)

"BLD",4811,"KRN","B",19.1,19.1)

"BLD",4811,"KRN","B",101,101)

"BLD",4811,"KRN","B",409.61,409.61)

"BLD",4811,"KRN","B",771,771)

"BLD",4811,"KRN","B",870,870)

"BLD",4811,"KRN","B",8989.51,8989.51)

"BLD",4811,"KRN","B",8989.52,8989.52)

"BLD",4811,"KRN","B",8994,8994)

"BLD",4811,"QUES",0)
^9.62^^
"BLD",4811,"REQB",0)
^9.611^1^1
"BLD",4811,"REQB",1,0)
PSJ*5.0*110^2
"BLD",4811,"REQB","B","PSJ*5.0*110",1)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,125)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
127^3050112^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^106^106^3050112
"PKG",197,22,1,"PAH",1,1,1,0)
 1. A site reports that when a nurse verifies a renewed order, the nurse's
"PKG",197,22,1,"PAH",1,1,2,0)
 initials do not consistently appear in BCMA. This patch corrects the
"PKG",197,22,1,"PAH",1,1,3,0)
 problem by saving the verifying nurse information if the nurse 
"PKG",197,22,1,"PAH",1,1,4,0)
 verification occurred after the renewal action. NOIS# NCH-1004-40487.
"PKG",197,22,1,"PAH",1,1,5,0)
 
"PKG",197,22,1,"PAH",1,1,6,0)
 2. A site reports that IV orders copied using the CO (Copy) action in
"PKG",197,22,1,"PAH",1,1,7,0)
 Inpatient Medications V. 5.0 retain the original order's verifying 
"PKG",197,22,1,"PAH",1,1,8,0)
 pharmacist, so that an unverified copied IV order may incorrectly appear
"PKG",197,22,1,"PAH",1,1,9,0)
 to have been verified by a pharmacist. This patch corrects the problem 
"PKG",197,22,1,"PAH",1,1,10,0)
 by removing the original order's verifying pharmacist from the copied
"PKG",197,22,1,"PAH",1,1,11,0)
 order. NOIS# CLA-1004-22199
"PKG",197,22,1,"PAH",1,1,12,0)
 
"PKG",197,22,1,"PAH",1,1,13,0)
 3. A site reports that after discontinuing a complex IV order, a user 
"PKG",197,22,1,"PAH",1,1,14,0)
 may be prevented from creating a new IV order until first exiting and 
"PKG",197,22,1,"PAH",1,1,15,0)
 then returning to the option. The software treats the new IV order like 
"PKG",197,22,1,"PAH",1,1,16,0)
 a complex order and prevents entry of some required fields. This patch 
"PKG",197,22,1,"PAH",1,1,17,0)
 corrects the problem by improving the check that determines whether or 
"PKG",197,22,1,"PAH",1,1,18,0)
 not the current order is a complex order. NOIS# SAG-1004-41795.
"PKG",197,22,1,"PAH",1,1,19,0)
 
"PKG",197,22,1,"PAH",1,1,20,0)
 4. When using the SF (Speed Finish) action to finish pending renewal
"PKG",197,22,1,"PAH",1,1,21,0)
 orders in the Unit Dose Order Entry [PSJU NE] option, the name of the 
"PKG",197,22,1,"PAH",1,1,22,0)
 finishing pharmacist is incorrectly saved as the provider for the order.
"PKG",197,22,1,"PAH",1,1,23,0)
 This patch corrects this problem by properly saving the ordering provider
"PKG",197,22,1,"PAH",1,1,24,0)
 with the order when SF (Speed Finish) is used. NOIS# AMA-1004-71742.
"PKG",197,22,1,"PAH",1,1,25,0)
 
"PKG",197,22,1,"PAH",1,1,26,0)
 5. When a component, or child order, of a complex order is created from  
"PKG",197,22,1,"PAH",1,1,27,0)
 Computerized Patient Record System (CPRS) V. 1.0 with a schedule of NOW 
"PKG",197,22,1,"PAH",1,1,28,0)
 and NOW does not exist in the ADMINISTRATION SCHEDULE (#51.1) file, the 
"PKG",197,22,1,"PAH",1,1,29,0)
 order does not appear in the patient's profile in Inpatient Medications 
"PKG",197,22,1,"PAH",1,1,30,0)
 V. 5.0. This patch corrects the problem by ensuring child orders with a 
"PKG",197,22,1,"PAH",1,1,31,0)
 schedule of NOW appear in Inpatient Medications V. 5.0.
"PKG",197,22,1,"PAH",1,1,32,0)
 
"PKG",197,22,1,"PAH",1,1,33,0)
 6. Renewed Unit Dose orders do not appear on the updated pick list
"PKG",197,22,1,"PAH",1,1,34,0)
 printed using the Update Pick List [PSJU PLUP] option. With this patch
"PKG",197,22,1,"PAH",1,1,35,0)
 renewed orders will appear on the updated pick list when appropriate.
"PKG",197,22,1,"PAH",1,1,36,0)
 NOIS: NCH-1104-40147
"PKG",197,22,1,"PAH",1,1,37,0)
 
"PKG",197,22,1,"PAH",1,1,38,0)
 7. When finishing a complex order that was renewed from CPRS, there is a
"PKG",197,22,1,"PAH",1,1,39,0)
 prompt for Pre-Exchange Doses, but there is no prompt to print the
"PKG",197,22,1,"PAH",1,1,40,0)
 Pre-Exchange Report. A prompt has been added to allow the Pre-Exchange
"PKG",197,22,1,"PAH",1,1,41,0)
 report to be printed for renewed complex orders. NOIS: MAR-1004-21942.
"PKG",197,22,1,"PAH",1,1,42,0)
 
"PKG",197,22,1,"PAH",1,1,43,0)
 8. The SF Speed Finish action in the Unit Dose Order Entry [PSJU NE]
"PKG",197,22,1,"PAH",1,1,44,0)
 option prompts for Pre-Exchange Doses, but there is no prompt to print
"PKG",197,22,1,"PAH",1,1,45,0)
 the Pre-Exchange Report when finishing a pending renewal order. A prompt
"PKG",197,22,1,"PAH",1,1,46,0)
 has been added to allow the Pre-Exchange Report to be printed for orders
"PKG",197,22,1,"PAH",1,1,47,0)
 that are finished using the SF Speed Finish action. NOIS: CLE-1004-42151.
"PKG",197,22,1,"PAH",1,1,48,0)
 
"PKG",197,22,1,"PAH",1,1,49,0)
 9. The initial label printed for renewed continuous IV orders indicates
"PKG",197,22,1,"PAH",1,1,50,0)
 it is due at the date and time that the order was renewed, rather than
"PKG",197,22,1,"PAH",1,1,51,0)
 at the next scheduled infusion date and time. With this patch, the first
"PKG",197,22,1,"PAH",1,1,52,0)
 label printed for this type of order will be due at the next scheduled
"PKG",197,22,1,"PAH",1,1,53,0)
 infusion date and time. IND-1104-40485.
"PKG",197,22,1,"PAH",1,1,54,0)
 
"PKG",197,22,1,"PAH",1,1,55,0)
 10. After finishing IV scripts, the user is prompted for the number of
"PKG",197,22,1,"PAH",1,1,56,0)
 labels to print.  The label print code does not limit the user input, so
"PKG",197,22,1,"PAH",1,1,57,0)
 if the user enters an excessive number of labels, then this can lead to
"PKG",197,22,1,"PAH",1,1,58,0)
 system performance problems.  This patch will apply the limit of 99
"PKG",197,22,1,"PAH",1,1,59,0)
 labels at the number of labels prompt. SFC-0603-61734.
"PKG",197,22,1,"PAH",1,1,60,0)
 
"PKG",197,22,1,"PAH",1,1,61,0)
 11. Complex Orders are not showing on the VDL in BCMA when the order
"PKG",197,22,1,"PAH",1,1,62,0)
 initially contains a schedule without a frequency, regardless of edits
"PKG",197,22,1,"PAH",1,1,63,0)
 made during finishing. With this patch, the schedule changes made during
"PKG",197,22,1,"PAH",1,1,64,0)
 finish will update the complex orders schedule frequency, enabling the
"PKG",197,22,1,"PAH",1,1,65,0)
 orders to display in BCMA at the appropriate times. SBY-1104-31772
"PKG",197,22,1,"PAH",1,1,66,0)
 
"PKG",197,22,1,"PAH",1,1,67,0)
 12. The stop date of a pending renewal order containing a non-standard
"PKG",197,22,1,"PAH",1,1,68,0)
 schedule and an orderable item with a day/dose limit cannot be edited
"PKG",197,22,1,"PAH",1,1,69,0)
 until after the order is made active. Also, Schedule Type and Unit
"PKG",197,22,1,"PAH",1,1,70,0)
 Per Dose edits made during finish of a pending renewal are not applied
"PKG",197,22,1,"PAH",1,1,71,0)
 when the order is made active. With this patch, changes made to these
"PKG",197,22,1,"PAH",1,1,72,0)
 fields during the finish proces will be applied to the active order.
"PKG",197,22,1,"PAH",1,1,73,0)
 ERI-1204-20679
"PKG",197,22,1,"PAH",1,1,74,0)
 
"PKG",197,22,1,"PAH",1,1,75,0)
 13. One-time orders that are not part of a complex order may be renewed
"PKG",197,22,1,"PAH",1,1,76,0)
 from CPRS V.1.0, even after they are given. This patch will prevent this
"PKG",197,22,1,"PAH",1,1,77,0)
 problem by preventing all non-complex one-time orders from being renewed.
"PKG",197,22,1,"PAH",1,1,78,0)
 Restriction of the renewal of complex one-time orders will be addressed
"PKG",197,22,1,"PAH",1,1,79,0)
 in a future CPRS V.1.0 patch. PSI-04-056.
"PKG",197,22,1,"PAH",1,1,80,0)
 
"PKG",197,22,1,"PAH",1,1,81,0)
 14. This patch modifies the Data Dictionary of the NON-VERIFIED ORDERS
"PKG",197,22,1,"PAH",1,1,82,0)
 FILE (#53.1) for the ORDERS FILE PARENT ORDER field (#125). The change
"PKG",197,22,1,"PAH",1,1,83,0)
 removes Inpatient Medications from the process of stripping NOW orders
"PKG",197,22,1,"PAH",1,1,84,0)
 from Complex Orders. This process is handled exclusively by CPRS.
"PKG",197,22,1,"PAH",1,1,85,0)
 
"PKG",197,22,1,"PAH",1,1,86,0)
 53.1,125     ORDERS FILE PARENT ORDER .2;8 POINTER TO ORDER FILE (#100)
"PKG",197,22,1,"PAH",1,1,87,0)
 
"PKG",197,22,1,"PAH",1,1,88,0)
 
"PKG",197,22,1,"PAH",1,1,89,0)
 
"PKG",197,22,1,"PAH",1,1,90,0)
              LAST EDITED:     DEC 13, 2004
"PKG",197,22,1,"PAH",1,1,91,0)
              HELP-PROMPT:     Enter the parent order, if this order is
"PKG",197,22,1,"PAH",1,1,92,0)
                               its child order.
"PKG",197,22,1,"PAH",1,1,93,0)
              DESCRIPTION:     This is the parent of a CPRS order that
"PKG",197,22,1,"PAH",1,1,94,0)
                               may have a parent/child relationship in
"PKG",197,22,1,"PAH",1,1,95,0)
                               CPRS.
"PKG",197,22,1,"PAH",1,1,96,0)
 
"PKG",197,22,1,"PAH",1,1,97,0)
             CROSS-REFERENCE:  53.1^ACX
"PKG",197,22,1,"PAH",1,1,98,0)
                               1)= S ^PS(53.1,"ACX",$E(X,1,30),DA)=""
"PKG",197,22,1,"PAH",1,1,99,0)
                               2)= K ^PS(53.1,"ACX",$E(X,1,30),DA)
"PKG",197,22,1,"PAH",1,1,100,0)
                               This cross reference is created each time a
"PKG",197,22,1,"PAH",1,1,101,0)
                               component of a complex order, or child
"PKG",197,22,1,"PAH",1,1,102,0)
                               order, is received from CPRS.  This cross
"PKG",197,22,1,"PAH",1,1,103,0)
                                reference will not be created for orders
"PKG",197,22,1,"PAH",1,1,104,0)
                               with a schedule of NOW, effectively
"PKG",197,22,1,"PAH",1,1,105,0)
                               disassociating the NOW order from the other
"PKG",197,22,1,"PAH",1,1,106,0)
                               child orders in the complex order.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
32
"RTN","PSGOE1")
0^32^B29780888
"RTN","PSGOE1",1,0)
PSGOE1 ;BIR/CML3-ACTION ON INPATIENT ORDERS ;10 Mar 99 / 10:54 AM
"RTN","PSGOE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,19,26,39,58,85,80,110,127**;16 DEC 97
"RTN","PSGOE1",3,0)
 ;
"RTN","PSGOE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE1",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSGOE1",6,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSGOE1",7,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSGOE1",8,0)
EN ;       
"RTN","PSGOE1",9,0)
 K PSGDFLG,PSGPFLG S PSGOEA="^",PSGACT="",(PSGDI,PSGOENG,PSGPI,PSGRRF)=0
"RTN","PSGOE1",10,0)
 Q:'$G(DUZ)
"RTN","PSGOE1",11,0)
 D @$S(PSGORD["P":"NON",1:"ACT")
"RTN","PSGOE1",12,0)
GO ;
"RTN","PSGOE1",13,0)
 K A,ND,PSGE,PSGR,ST,X,X1,X2,Y I $D(ORACTION) K PSGDI,PSGOENG,PSGPI Q
"RTN","PSGOE1",14,0)
 ;W:$G(PSGPFLG) !!?3,"(THE ORDERABLE ITEM IS CURRENTLY LISTED AS INACTIVE.)" W:$G(PSGDFLG) !!?3,"(ONE OR ALL DISPENSE DRUGS ARE CURRENTLY LISTED AS INACTIVE OR DO NOT MATCH",!?3,"THE ORDERABLE ITEM FOR THIS ORDER.)"
"RTN","PSGOE1",15,0)
 ;I $G(PSGPFLG)!$G(PSGDFLG) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOE1",16,0)
 ;S PSGCANFL=0 ;F  D ACTO W !!,"ACTION"_$S(PSGACTO]"":" ("_PSGACTO_")",1:"")_"? " R PSGOEA:DTIME W:'$T $C(7) S:'$T PSGOEA="^" Q:"^"[PSGOEA  D CHK D:C @PSGOEA Q:PSGCANFL
"RTN","PSGOE1",17,0)
 Q
"RTN","PSGOE1",18,0)
ENACTION(PSGP,PSGORD)        ;
"RTN","PSGOE1",19,0)
 ;Returns string identifying the actions allowed on this order.
"RTN","PSGOE1",20,0)
 D EN
"RTN","PSGOE1",21,0)
 Q PSGACT
"RTN","PSGOE1",22,0)
DONE ;
"RTN","PSGOE1",23,0)
 I PSGORD["U"!(PSGORD["O") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOE1",24,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOE1",25,0)
 K C,PSGACT,PSGDFLG,PSGPFLG,PSGDI,PSGOENG,PSGPI,PSGRRF Q
"RTN","PSGOE1",26,0)
B ; bypass
"RTN","PSGOE1",27,0)
 S PSGCANFL=1
"RTN","PSGOE1",28,0)
 Q
"RTN","PSGOE1",29,0)
C ; copy an order (does NOT discontinue original order)
"RTN","PSGOE1",30,0)
 D ^PSGOD Q
"RTN","PSGOE1",31,0)
D ; discontinue (or delete) an order
"RTN","PSGOE1",32,0)
 I PSGOEAV,'$D(PSGODF) D ENDS^PSGPO Q
"RTN","PSGOE1",33,0)
 D ENO^PSGOEC(PSGP,PSGORD) Q
"RTN","PSGOE1",34,0)
E ; edit orders
"RTN","PSGOE1",35,0)
 D ^PSGOEE Q
"RTN","PSGOE1",36,0)
F ; finish released orders
"RTN","PSGOE1",37,0)
 D ^PSGOEF Q
"RTN","PSGOE1",38,0)
H(PSGP,PSGORD) ; hold
"RTN","PSGOE1",39,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(X,U,12),$P(X,U,13) W $C(7),!!,"WARNING!  THIS ORDER HAS BEEN MARKED FOR CANCELLATION."
"RTN","PSGOE1",40,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9)="H" D ^PSGOEH0 Q
"RTN","PSGOE1",41,0)
 D ^PSGOEH1 Q
"RTN","PSGOE1",42,0)
I ; mark (or unmark) a non-verified order as 'incomplete'
"RTN","PSGOE1",43,0)
 D ^PSGOEI Q
"RTN","PSGOE1",44,0)
L ; display logs
"RTN","PSGOE1",45,0)
 D ^PSGOEL Q
"RTN","PSGOE1",46,0)
N ; mark order as 'not to be given'
"RTN","PSGOE1",47,0)
 D ^PSGOENG Q
"RTN","PSGOE1",48,0)
O ; Outpatient (discharge) med
"RTN","PSGOE1",49,0)
 W !!,"UNDER DEVELOPMENT, NOT CURRENTLY AVAILABLE."
"RTN","PSGOE1",50,0)
 Q
"RTN","PSGOE1",51,0)
P ; print expanded view
"RTN","PSGOE1",52,0)
 D ^PSGVWP Q
"RTN","PSGOE1",53,0)
R ; renew an order
"RTN","PSGOE1",54,0)
 I 'PSJSYSU,$D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",15),$P(^(4),"^",16) W !!,"THIS ORDER IS ALREADY MARKED FOR RENEWAL!" Q
"RTN","PSGOE1",55,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSGOE1",56,0)
 D ^PSGOERI Q
"RTN","PSGOE1",57,0)
S ; show the order again
"RTN","PSGOE1",58,0)
 D EN2^PSGVW Q
"RTN","PSGOE1",59,0)
V ; verify an order
"RTN","PSGOE1",60,0)
 D EN^PSGOEV Q
"RTN","PSGOE1",61,0)
ACT ;
"RTN","PSGOE1",62,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,0)),ND0=X,ND=$G(^(4)),ND2=$G(^(2)),PSGOENG=$P(X,"^",22),PSGR=$E("R",'PSGOENG),PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8)
"RTN","PSGOE1",63,0)
 I 'PSGOENG,PSJCOM S PSGR=$E("R",$$AND^ORX8(PSJCOM)) S:PSGR="R" PSGR=$E("R",$$RNEWOK^PSJUTL2(PSJCOM,PSGP))
"RTN","PSGOE1",64,0)
 S PSGR=$E("R",'$$EXPIRED^PSGOER(PSGP,PSGORD)) S PSGR=$E("R",$P(ND0,"^",7)'="O")
"RTN","PSGOE1",65,0)
 I $P(ND2,U,4)'>PSGDT D OLD Q
"RTN","PSGOE1",66,0)
 S PSGE="E" I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",+$G(^PS(55,PSGP,5,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(55,PSGP,5,+PSGORD,.2)))
"RTN","PSGOE1",67,0)
 S:$P(X,"^",26) (PSGE,PSGR)=""
"RTN","PSGOE1",68,0)
 I '$D(PSGOETOF) S PSGPI=$P(X,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",69,0)
 S ST=$P(X,"^",9)="H"*4 S:ST (PSGE,PSGR)=""
"RTN","PSGOE1",70,0)
 ;S PSGACT="D"_$S(+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",71,0)
 N CMPOK S CMPOK=1 I $$COMPLEX^PSJOE(PSGP,PSGORD) S CMPOK=+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8)
"RTN","PSGOE1",72,0)
 S PSGACT="D"_$S('$G(CMPOK):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",73,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S PSGACT=PSGACT_"V"
"RTN","PSGOE1",74,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",75,0)
 Q
"RTN","PSGOE1",76,0)
OLD ;
"RTN","PSGOE1",77,0)
 S A=$P(ND0,"^",9),PSGACT=$E("H",A="H")_"L" I A'["D",A'["E" Q
"RTN","PSGOE1",78,0)
 I 'PSGOENG,($D(^XUSEC("PSJU MGR",DUZ))!$D(^XUSEC("PSJ RPHARM",DUZ))) S PSGACT="LN"
"RTN","PSGOE1",79,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S:(A'["D")&($G(PSGPRIO)'="DONE") PSGACT="D"_PSGACT S PSGACT=PSGACT_"V" Q
"RTN","PSGOE1",80,0)
 Q:PSGR=""!'PSJPCAF  D NOW^%DTC S (PSGDT,X1)=+$E(%,1,12),X2=-4 D C^%DTC I $S('$P(ND2,"^",4):1,1:$P(ND2,"^",4)'>X) Q
"RTN","PSGOE1",81,0)
 I A="E",$G(PSJPRI)'="D" S PSGACT=PSGACT_PSGR Q
"RTN","PSGOE1",82,0)
 I PSJSYSU,$P(ND,"^",11) S PSGACT=PSGACT_PSGR,PSGRRF=1
"RTN","PSGOE1",83,0)
 Q
"RTN","PSGOE1",84,0)
NON ;
"RTN","PSGOE1",85,0)
 N XND
"RTN","PSGOE1",86,0)
 S (X,XND)=$G(^PS(53.1,+PSGORD,0)) I $P(X,"^",19),$D(^PS(55,PSGP,5,$P(X,"^",19))) L -^PS(53.1,+PSGORD) S PSGORD=$P(X,"^",19)_"U" G ACT
"RTN","PSGOE1",87,0)
 I $S($P(X,"^",26):1,$P(X,"^",9)["D":1,1:$P(X,"^",9)["E") S:$P(X,U,9)="P"&($P(X,U,26)) PSGACT="D" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",88,0)
 I PSGORD["U" S PSGACT="DE" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",89,0)
 I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(53.1,"_+PSGORD_",1,",+$G(^PS(53.1,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(53.1,+PSGORD,.2)))
"RTN","PSGOE1",90,0)
 S DRG=$$STUFFDD^PSGOE2 S:DRG ^PS(53.1,+PSGORD,1,0)="^53.11P^1^1",^PS(53.1,+PSGORD,1,1,0)=DRG,^PS(53.1,+PSGORD,1,"B",DRG,1)=""
"RTN","PSGOE1",91,0)
 F DRG=0:0 S DRG=$O(^PS(53.1,+PSGORD,1,DRG)) Q:'DRG  S DRGPT=^(DRG,0) S INACTDT=$G(^PSDRUG(+DRGPT,"I")) I INACTDT,(INACTDT'>DT) S PSGDFLG=1
"RTN","PSGOE1",92,0)
 I $P(XND,U,9)="P" S PSGACT=$S(+PSJSYSU=3:"BDEF",$G(PSJRNF):"BDEF",1:"") S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",93,0)
 I '$D(PSGOETOF) S PSGPI=$P(XND,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",94,0)
 S PSGACT="DEI" I PSJSYSU,'PSGPI,$P(XND,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",95,0)
 ;* S PSGACT="DEI" I PSJSYSU,'PSGDI,'PSGPI,$P(X,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",96,0)
 S XND2=$G(^PS(53.1,+PSGORD,.2)) I $P(XND2,"^",8),$P(XND,"^",9)="P" S PSGACT=$TR(PSGACT,"V")
"RTN","PSGOE1",97,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",98,0)
 I $P($G(PSGRDTX),U,2)]"",'$D(^PS(53.1,+PSGORD,2.5)) S $P(^PS(53.1,+PSGORD,2.5),U,2)=$P(PSGRDTX,U,2)
"RTN","PSGOE1",99,0)
 Q
"RTN","PSGOE1",100,0)
ACTO ;
"RTN","PSGOE1",101,0)
 S PSGACTO="" I $G(PSGACT)]"" F X=1:1:$L(PSGACT) S PSGACTO=PSGACTO_$S($E(PSGACT,X)="D":"DC",1:$E(PSGACT,X))_" "
"RTN","PSGOE1",102,0)
 S:PSGACTO]"" PSGACTO=$E(PSGACTO,1,$L(PSGACTO)-1) Q
"RTN","PSGOE82")
0^30^B18537493
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 / 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127**;16 DEC 97
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ;
"RTN","PSGOE82",10,0)
1 ; provider
"RTN","PSGOE82",11,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",12,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",13,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",14,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",15,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",16,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE82",17,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",18,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",19,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",20,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",21,0)
 ;
"RTN","PSGOE82",22,0)
5 ; self med
"RTN","PSGOE82",23,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",24,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",25,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",26,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",27,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",28,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",30,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",31,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",32,0)
 ;
"RTN","PSGOE82",33,0)
6 ; hospital supplied self med
"RTN","PSGOE82",34,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",35,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",36,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",37,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",38,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",39,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",40,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",41,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",42,0)
 ;
"RTN","PSGOE82",43,0)
2 ; dispense drug multiple
"RTN","PSGOE82",44,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",45,0)
 N PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE82",46,0)
 N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02" D ^DIE
"RTN","PSGOE82",47,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",48,0)
 D DDOC(PSGX)
"RTN","PSGOE82",49,0)
 NEW PSJDOSE
"RTN","PSGOE82",50,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",51,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",52,0)
 G DONE
"RTN","PSGOE82",53,0)
 ;
"RTN","PSGOE82",54,0)
40 ; comments
"RTN","PSGOE82",55,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",56,0)
 ;
"RTN","PSGOE82",57,0)
66 ; provider comments
"RTN","PSGOE82",58,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",59,0)
 ;
"RTN","PSGOE82",60,0)
DONE ;
"RTN","PSGOE82",61,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",62,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",63,0)
 ;
"RTN","PSGOE82",64,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",65,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",66,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",67,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",68,0)
 ;
"RTN","PSGOE82",69,0)
DEL ; delete entry
"RTN","PSGOE82",70,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",71,0)
 Q
"RTN","PSGOE82",72,0)
 ;
"RTN","PSGOE82",73,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",74,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",75,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",76,0)
 Q
"RTN","PSGOE82",77,0)
DDOC(PSGX) ; Order check on additional dispens drug for allergy and adv. reactions.
"RTN","PSGOE82",78,0)
 N PSGY,PSGND1,PSGND3 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",79,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",80,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",81,0)
 . D IVSOL^PSGSICHK
"RTN","PSGOE82",82,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",83,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",84,0)
 Q
"RTN","PSGOE82",85,0)
 ;
"RTN","PSGOE82",86,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",87,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",88,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",89,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",90,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",91,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",92,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",93,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",94,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",95,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",96,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",97,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGOER0")
0^6^B21348722
"RTN","PSGOER0",1,0)
PSGOER0 ;BIR/CML3-EDIT FIELDS FOR RENEWAL ;05 May 98 / 10:58 AM
"RTN","PSGOER0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,45,47,50,63,64,70,69,58,80,110,127**;16 DEC 97
"RTN","PSGOER0",3,0)
 ;
"RTN","PSGOER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOER0",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSGOER0",6,0)
 ; Reference to ^DD(55.06 is supported by DBIA 2253.
"RTN","PSGOER0",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSGOER0",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSGOER0",9,0)
 ;
"RTN","PSGOER0",10,0)
DATE(PSGP,PSGORD,PSGDT) ;
"RTN","PSGOER0",11,0)
 K PSGFOK,PSJNOO S F1=55.06,PSGWLL=+$G(^PS(55,PSGP,5.1)),PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGPDRG=+$G(^(.2)),PSGOER2=$G(^(2))
"RTN","PSGOER0",12,0)
 NEW XX S XX=$$ACTIVE^PSJORREN(PSGP,PSGORD) S:+XX=2 PSGPDRG=$P(XX,U,2)
"RTN","PSGOER0",13,0)
 I '+XX W !,"No active Orderable Item was found.",! G DONE
"RTN","PSGOER0",14,0)
 S (PSGNEDFD,PSGOERDP)=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)
"RTN","PSGOER0",15,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGST=$P(PSGOER0,"^",7),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6)
"RTN","PSGOER0",16,0)
 S PSGOEPR=+$P(PSGOER0,"^",2),(PSGOPR,PSGPR)=$S($P(PSJSYSU,";",2):DUZ,1:+PSGOEPR)
"RTN","PSGOER0",17,0)
 I $G(PSJSPEED) S PSGPR=$S($P(ND,"^",2):$P(ND,"^",2),1:+PSGOEPR)
"RTN","PSGOER0",18,0)
 S PSGOSD=+$P(PSGOER2,"^",2) S PSGOFD=+$P(PSGOER2,"^",4),PSGPRN=$P($G(^VA(200,PSGPR,0)),"^"),PSGPRI=$S($P(PSJSYSU,";",2):0,1:$P($G(^("PS")),"^",4)),PSGRO=0 S:PSGPRI PSGPRI=PSGPRI'>DT I PSGPRI S (PSGOPR,PSGPR,PSGPRN)=""
"RTN","PSGOER0",19,0)
 S PSGRNSD=$S($G(PSGLI):PSGLI,1:$G(PSGDT))
"RTN","PSGOER0",20,0)
 S PSGSD=$G(PSGOSD)
"RTN","PSGOER0",21,0)
 I PSGSD="" S PSJREN=1,PSGSD=$$ENSD^PSGNE3($S(PSGST["P":"PRN",1:$P(PSGOER2,U)),PSGS0Y,PSGDT,PSGOSD) S:PSGOSD>PSGSD PSGSD=PSGOSD K PSJREN
"RTN","PSGOER0",22,0)
 S PSGSDN=$$ENDD^PSGMI(PSGSD)
"RTN","PSGOER0",23,0)
10 ;
"RTN","PSGOER0",24,0)
 ;W !,"START DATE/TIME: "_PSGSDN
"RTN","PSGOER0",25,0)
O25 ;
"RTN","PSGOER0",26,0)
 N PSGSD,PSGNEFD S PSGSD=PSGDT
"RTN","PSGOER0",27,0)
 D ENWALL^PSGNE3(PSGSD,0,PSGP)
"RTN","PSGOER0",28,0)
 S:'$G(PSGDT) PSGDT=$$DATE2^PSJUTL2($$NOW^XLFDT)
"RTN","PSGOER0",29,0)
 N PSGNESD S PSGNESD=PSGDT D ENFD^PSGNE3(PSGNESD) I $G(PSGNEFD) S (Y,PSGFD)=PSGNEFD
"RTN","PSGOER0",30,0)
 S PSGFOK(10)="" I PSGST="O" S PSGFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGRNSD,PSGP) I PSGFD]"" S Y=PSGRNSD,X=0 G 1
"RTN","PSGOER0",31,0)
D25 K DUR,DURMIN N PKGFLG S PKGFLG=$S(PSGORD["U":5,PSGORD["V":"IV",PSGORD["P":"P",1:"") I PKGFLG]"" S DUR=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),PKGFLG,1) I DUR]"" D
"RTN","PSGOER0",32,0)
 .S DURMIN=($$DURMIN^PSJLIVMD(DUR)\1) I DURMIN>1 S Y=$$FMADD^XLFDT(PSGRNSD,,,DURMIN) I Y>PSGRNSD S PSGFD=Y,X=0
"RTN","PSGOER0",33,0)
 I $P($G(PSGOER2),"^",4)>PSGFD S Y=$P(PSGOER2,"^",4)
"RTN","PSGOER0",34,0)
 I $G(DUR)]"",($G(PSGORD)'["P") S DURMIN=$$DURMIN^PSJLIVMD(DUR)\1 S Y=$$FMADD^XLFDT(PSGDT,,,DURMIN)
"RTN","PSGOER0",35,0)
 S:X&$P(PSJSYSW0,"^",7) $P(Y,".",2)=$P(PSJSYSW0,"^",7) S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",36,0)
25 W !,"STOP DATE/TIME: "_PSGFDN_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",37,0)
 I X="" W "   "_PSGFDN G W25
"RTN","PSGOER0",38,0)
 I $E(X)="^" D FF G:Y>0 @Y G 25
"RTN","PSGOER0",39,0)
 S PSGF2=25 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,25)
"RTN","PSGOER0",40,0)
 I X=+X,X>0,X'>2000000 G 25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X,ND2=PSGOER2,$P(ND2,"^",2)=PSGRNSD W " ...dose limit..." D ENGO^PSGDL
"RTN","PSGOER0",41,0)
 K %DT S %DT="ERTX" D ^%DT K %DT G:Y'>0 25 S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",42,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOER0",43,0)
 I PSGFD<PSGSD W $C(7),!!?3,"*** The STOP date must be AFTER the START date. ***" G 25
"RTN","PSGOER0",44,0)
 S PSGFOK(25)=""
"RTN","PSGOER0",45,0)
 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S PSGFOK(1)="" Q
"RTN","PSGOER0",46,0)
1 ; provider
"RTN","PSGOER0",47,0)
 G:+PSJSYSU<3&$P(PSJSYSU,";",2) CHKDD S PSGF2=1
"RTN","PSGOER0",48,0)
A1 ;
"RTN","PSGOER0",49,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",50,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOER0",51,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) S PSGFOK(1)="" G CHKDD
"RTN","PSGOER0",52,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOER0",53,0)
 I $E(X)="^" D FF G:Y>0 @Y G A1
"RTN","PSGOER0",54,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P((X(1)),""^"",4):1,1:DT<$P((X(1)),""^"",4))" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOER0",55,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOER0",56,0)
CHKDD ;
"RTN","PSGOER0",57,0)
 G:$G(PSGRENEW) 106
"RTN","PSGOER0",58,0)
 I PSGORD["P"!$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",PSGPDRG) G 106
"RTN","PSGOER0",59,0)
 ;I PSGORD["P"!'$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") G 106
"RTN","PSGOER0",60,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q
"RTN","PSGOER0",61,0)
 K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOER0",62,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOER0",63,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOER0",64,0)
 I $G(DUOUT)!'$G(DRG) S COMQUIT=1 Q
"RTN","PSGOER0",65,0)
106 ; nature of order
"RTN","PSGOER0",66,0)
 S PSJNOO=$$ENNOO^PSJUTL5("R") S:PSJNOO<0 COMQUIT=1
"RTN","PSGOER0",67,0)
 S:PSJNOO'<0 PSGFOK(106)=""
"RTN","PSGOER0",68,0)
DONE ;
"RTN","PSGOER0",69,0)
 K F,F0,F1,PSGF2,F3,ND2,PSGDL,PSGDLS,PSGOROE1,PSGRO,SDT Q
"RTN","PSGOER0",70,0)
FF ; "^" to another field
"RTN","PSGOER0",71,0)
 K DIC S DIC="^DD(55.06,",DIC(0)="EQ",DIC("S")="I $D(PSGFOK(+Y))",X=$E(X,2,255) D ^DIC K DIC
"RTN","PSGOER0",72,0)
 S Y=+Y Q
"RTN","PSGOESF")
0^19^B25676583
"RTN","PSGOESF",1,0)
PSGOESF ;BIR/MLM-SPEED FINISH ORDERS ENTERED THROUGH OE/RR ;10 Mar 98 / 2:35 PM
"RTN","PSGOESF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,11,29,35,127**;16 DEC 97
"RTN","PSGOESF",3,0)
 ;
"RTN","PSGOESF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOESF",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGOESF",6,0)
 ;
"RTN","PSGOESF",7,0)
EN ;
"RTN","PSGOESF",8,0)
 I '$$HIDDEN^PSJLMUTL("SPEED") S VALMBCK="R" Q
"RTN","PSGOESF",9,0)
 N CODE,ST,DRG,ON,PSGONF,PSGONF2,PSGSFD
"RTN","PSGOESF",10,0)
 D FULL^VALM1 S PSGLMT=PSJOCNT,(PSGONF,PSGONF2)=0
"RTN","PSGOESF",11,0)
 S CODE="" F  S CODE=$O(^TMP("PSJ",$J,CODE)) Q:CODE=""  D
"RTN","PSGOESF",12,0)
 .S ST="" F  S ST=$O(^TMP("PSJ",$J,CODE,ST)) Q:ST=""  D
"RTN","PSGOESF",13,0)
 ..S DRG="" F  S DRG=$O(^TMP("PSJ",$J,CODE,ST,DRG)) Q:DRG=""  D
"RTN","PSGOESF",14,0)
 ...S ON="" F  S ON=$O(^TMP("PSJ",$J,CODE,ST,DRG,ON)) Q:ON=""  S PSGONF=PSGONF+1 D
"RTN","PSGOESF",15,0)
 ....I CODE="CC" S:$G(PSGONF2)=0 PSGONF2=PSGONF S PSGRLAST=PSGONF ;gets first renewal #
"RTN","PSGOESF",16,0)
 I PSGONF2'>0 W !,"There are no orders which can be Speed Finished at this time.",!,"Only PENDING RENEWALS can be Speed Finished." D PAUSE^VALM1 Q
"RTN","PSGOESF",17,0)
 S PSGONF=PSGONF2_"^"_PSGRLAST
"RTN","PSGOESF",18,0)
 N DIR,L1,L2 S L1=+PSGONF,L2=$P(PSGONF,U,2),DIR(0)="LAO^"_L1_":"_L2,DIR("A")="FINISH which orders ("_L1_"-"_L2_"): ",DIR("?",1)="Select order"_$E("s",L1'=L2)_"to finish: ",DIR("??")="^D HELP^PSGOESF"
"RTN","PSGOESF",19,0)
 D ^DIR K DIR I $D(DIRUT) K X G DONE
"RTN","PSGOESF",20,0)
 I X?1N1"-" Q:$P(PSGONF,U,2)<X  S Y="" F L1=+X:1 S Y=Y_L1_"," Q:L1=$P(PSGONF,U,2)
"RTN","PSGOESF",21,0)
 I 'Y W $C(7),!!,"??" G EN
"RTN","PSGOESF",22,0)
ENCHK ;
"RTN","PSGOESF",23,0)
 S PSJSPEED=1
"RTN","PSGOESF",24,0)
 K PSGODDD S PSGODDD=1,PSGODDD(1)="" F Q=1:1:$L(Y,",") S X1=$P(Y,",",Q) D SET^PSGON Q:'$D(X)
"RTN","PSGOESF",25,0)
 S PSGOSD=0 F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S Y=+^TMP("PSJON",$J,PSGOERS2),F=$G(^PS(53.1,Y,0)),D=$G(^(.2)) D HMSG^PSGOERS I F G EN
"RTN","PSGOESF",26,0)
 I $P(PSJSYSP0,"^",3) D  I '$D(PSGFOK) S X="" G DONE
"RTN","PSGOESF",27,0)
 .S PSGORD=^TMP("PSJON",$J,+PSGODDD(1)),PSGOFD=$P($G(^PS(53.1,+PSGORD,2)),U,4),DA=+PSGORD,DA(1)=PSGP,PSGSFD=$P($G(^PS(53.1,+PSGORD,0)),U,16)
"RTN","PSGOESF",28,0)
 .S PSGORD=$P(^PS(53.1,+PSGORD,0),U,25)
"RTN","PSGOESF",29,0)
 .S PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSGP,5.1)),1:0),PSGOEE="R" W ! D DATE^PSGOER0(PSGP,PSGORD,PSGSFD)
"RTN","PSGOESF",30,0)
 .I '$D(PSGFOK(1)) W $C(7),!,"...order",$E("s",$L(PSGODDD(1),",")>2)," NOT finished..." K PSGFOK Q
"RTN","PSGOESF",31,0)
 .I 'PSGNEDFD,$P(PSJSYSW0,"^",4) D ENWALL^PSGNE3(PSGSD,PSGFD,PSGP)
"RTN","PSGOESF",32,0)
 W ! F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S PSGORD=^TMP("PSJON",$J,PSGOERS2),PSGOEFF=0 D
"RTN","PSGOESF",33,0)
 .I '$$LS^PSSLOCK(PSGP,PSGORD) W !,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P($G(^PS(53.1,+PSGORD,.2)),"^",2),!,"...No action taken on this order...",! H 1 Q
"RTN","PSGOESF",34,0)
 .;K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(53.1,+PSGORD,1,1,0)))
"RTN","PSGOESF",35,0)
 .;I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOESF",36,0)
 .;. F PSGDDI=1:0 S PSGDDI=$O(^PS(53.1,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(53.1,+PSGORD,1,PSGDDI,0)) D IVSOL^PSGSICHK
"RTN","PSGOESF",37,0)
 .D OC531
"RTN","PSGOESF",38,0)
 .I 'PSGOEFF&($D(PSGORQF)) W !!,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P($G(^PS(53.1,+PSGORD,.2)),"^",2),!,"...No action taken on this order...",! H 1 Q
"RTN","PSGOESF",39,0)
 .S X=$G(^PS(53.1,+PSGORD,.2)),PSGPDRGN=$$ENPDN^PSGMI(+X),PSGDO=$P(X,U,2),X=$G(^PS(53.1,+PSGORD,0)),PSGMRN=$$ENMRN^PSGMI($P(X,U,3)),PSGST=$P(X,U,7)
"RTN","PSGOESF",40,0)
 .S PSGSCH=$P($G(^PS(53.1,+PSGORD,2)),U),PSGSI=$G(^(6))
"RTN","PSGOESF",41,0)
 .S $P(^PS(53.1,+PSGORD,2),U,2)=PSGSD,$P(^(2),U,4)=PSGFD,X=+$P($G(^PS(53.1,+PSGORD,0)),U,25)
"RTN","PSGOESF",42,0)
 .I $P($G(^PS(55,PSGP,5,+X,2)),U,4)>PSGSD S $P(^(2),U,3)=$P(^(2),U,4) K DA,DIE,DR S DA(1)=PSGP,DA=X,DR="34////"_PSGSD,DIE="^PS(55,"_DA(1)_",5," D ^DIE
"RTN","PSGOESF",43,0)
 .W !,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," "
"RTN","PSGOESF",44,0)
 .W $P($G(^PS(53.1,+PSGORD,.2)),"^",2)
"RTN","PSGOESF",45,0)
 .D UPDATE
"RTN","PSGOESF",46,0)
 .D EN^PSGOEV(PSGORD)
"RTN","PSGOESF",47,0)
 .D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOESF",48,0)
 ;
"RTN","PSGOESF",49,0)
DONE ; Kill and exit.
"RTN","PSGOESF",50,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOESF",51,0)
 I $G(PSGPXN) D ^PSGPER1
"RTN","PSGOESF",52,0)
 K PSJSPEED,PSGODDD,PSGOERS,PSGORD,PSGOERS2,PSGPDRGN,PSGDO,PSGSCH,PSGSI,NF,Y,PSGRLAST
"RTN","PSGOESF",53,0)
 Q
"RTN","PSGOESF",54,0)
HELP    ; Display help text for select order to be finished prompt."
"RTN","PSGOESF",55,0)
 W !!,"  Select the orders to be speed finished. Only orders listed under the PENDING",!,"RENEWALS heading are selectable. The start and stop date/times specified will"
"RTN","PSGOESF",56,0)
  W !,"be used for all orders selected to be finished using this function.",!
"RTN","PSGOESF",57,0)
 Q
"RTN","PSGOESF",58,0)
UPDATE        ;
"RTN","PSGOESF",59,0)
 N LOOP K ^PS(53.45,PSJSYSP,2)
"RTN","PSGOESF",60,0)
 F LOOP=0:0 S LOOP=$O(^PS(53.1,+PSGORD,1,LOOP)) Q:'LOOP  D
"RTN","PSGOESF",61,0)
 .S ^PS(53.45,PSJSYSP,2,LOOP,0)=^PS(53.1,+PSGORD,1,LOOP,0)
"RTN","PSGOESF",62,0)
 .S PSJJDRUG=$P(^PS(53.1,+PSGORD,1,LOOP,0),"^")
"RTN","PSGOESF",63,0)
 .S ^PS(53.45,PSJSYSP,2,"B",PSJJDRUG,LOOP)=""
"RTN","PSGOESF",64,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"_"^"_LOOP_"^"_LOOP K PSJJDRUG
"RTN","PSGOESF",65,0)
 Q
"RTN","PSGOESF",66,0)
OC531 ;* Order checks for Speed finish and regular finish
"RTN","PSGOESF",67,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSGOESF",68,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOESF",69,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(53.1,+PSGORD,1,1,0)))
"RTN","PSGOESF",70,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOESF",71,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(53.1,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(53.1,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSGOESF",72,0)
 Q
"RTN","PSGOTR")
0^10^B9466646
"RTN","PSGOTR",1,0)
PSGOTR ;BIR/TRANSFERS RENEW DATA FROM 53.1 TO 55 ;23 SEP 03 / 7:54 AM
"RTN","PSGOTR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSGOTR",3,0)
 ;
"RTN","PSGOTR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOTR",5,0)
 ; Reference to SPSPA^PSJXRFS is supported by DBIA 4264.
"RTN","PSGOTR",6,0)
 ;
"RTN","PSGOTR",7,0)
START(ODA,DA) ; lock record, and write
"RTN","PSGOTR",8,0)
 N OFD,PVND4 S OFD=""
"RTN","PSGOTR",9,0)
 S OFD=$P($G(^PS(55,PSGP,5,DA,2)),"^",4) K:OFD ^PS(55,"AUD",+OFD,PSGP,+DA)
"RTN","PSGOTR",10,0)
 S ND2=^PS(53.1,+ODA,2) S ^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOTR",11,0)
 F X=6,7 I $D(^PS(53.1,+ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOTR",12,0)
 I $O(^PS(53.1,+ODA,1,0)) D
"RTN","PSGOTR",13,0)
 .S (C,X)=0 F  S X=$O(^PS(53.1,+ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOTR",14,0)
 .Q:'C  N OC S OC=C I $O(^PS(55,PSGP,5,DA,1,OC)) F  S OC=$O(^PS(55,PSGP,5,DA,1,OC)) Q:'OC  K ^PS(55,PSGP,5,DA,1,OC)
"RTN","PSGOTR",15,0)
 .S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOTR",16,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOTR",17,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,+ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOTR",18,0)
 S $P(^PS(53.1,+ODA,0),"^",19)=DA
"RTN","PSGOTR",19,0)
 S $P(^PS(55,PSGP,5,DA,0),"^",7)=$P(^PS(53.1,+ODA,0),"^",7)
"RTN","PSGOTR",20,0)
 N PSGPND0,PSGPND2,RDUZ,OND14 S PSGPND0=^PS(53.1,+ODA,0),PSGPND2=^(2) S RNWDT=$P(PSGPND0,"^",16),PSGOEPR=$P(PSGPND0,"^",2)
"RTN","PSGOTR",21,0)
 S PSGFD=$P(PSGPND2,"^",4),PSJNOO=$P(^PS(53.1,+ODA,.2),"^",3) S OND14=$$LASTREN^PSJLMPRI(PSGP,+ODA) S RDUZ=$P(OND14,"^",2) S:$P(OND14,"^",3) PSGOEPR=$P(OND14,"^",3)
"RTN","PSGOTR",22,0)
 I '$G(DUOUT) D UPDREN^PSGOER(DA_"U",RNWDT,PSGOEPR,PSGFD,PSJNOO,RDUZ)
"RTN","PSGOTR",23,0)
 S PVND4=$G(^PS(53.1,+ODA,4)) I $P(PVND4,"^"),$P(PVND4,"^",2) D
"RTN","PSGOTR",24,0)
 .N RNDT S RNDT=$$LASTREN^PSJLMPRI(DFN,+ODA_"P") Q:RNDT>$P(PVND4,"^",2)
"RTN","PSGOTR",25,0)
 .S $P(^PS(55,DFN,5,DA,4),"^")=$P(PVND4,"^"),$P(^PS(55,DFN,5,DA,4),"^",2)=$P(PVND4,"^",2)
"RTN","PSGOTR",26,0)
CR ; set x-refs
"RTN","PSGOTR",27,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOTR",28,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOTR",29,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)="" I OFD,OFD'=$P(ND2,"^",4) K ^PS(55,PSGP,5,"AUS",+OFD,DA)
"RTN","PSGOTR",30,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOTR",31,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOTR",32,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOTR",33,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOTR",34,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOTR",35,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOTR",36,0)
 L -^PS(53.1,ODA) L -^PS(55,DFN,5,+PSGORD) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGPEN")
0^12^B38665024
"RTN","PSGPEN",1,0)
PSGPEN ;BIR/CML3-FIND DEFAULT FOR PRE-EXCHANGE NEEDS ;03 Feb 99 / 9:13 AM
"RTN","PSGPEN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**30,37,50,58,115,110,127**;16 DEC 97
"RTN","PSGPEN",3,0)
 ;
"RTN","PSGPEN",4,0)
 ; References to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSGPEN",5,0)
 ; References to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSGPEN",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPEN",7,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGPEN",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGPEN",9,0)
 ;
"RTN","PSGPEN",10,0)
EN(PSGPENO) ;
"RTN","PSGPEN",11,0)
 S PSGPENO=+PSGPENO
"RTN","PSGPEN",12,0)
 N PSJSITE,PSJPRN S PSJSITE=0,PSJSITE=$O(^PS(59.7,PSJSITE)) I $P($G(^(PSJSITE,26)),U,5)=1 S PSJPRN=1
"RTN","PSGPEN",13,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPEN="" S ND=$G(^PS(55,PSGP,5,PSGPENO,0))
"RTN","PSGPEN",14,0)
 S PSGPENWS=0 I PSJPWD F Q=0:0 S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3),($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) S PSGPENWS=1 Q
"RTN","PSGPEN",15,0)
 I PSGPENWS F  S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S:'$D(^PSI(58.1,"D",+ND,PSJPWD))&'$D(^PSD(58.8,"D",+ND,PSJPWD)) PSGPENWS=0 Q:'PSGPENWS  S $P(PSGPENWS,"^",2)=1
"RTN","PSGPEN",16,0)
 I PSGPENWS W !!,"The dispense drug",$E("s",$P(PSGPENWS,"^",2))," for this order ",$S($P(PSGPENWS,"^",2):"are",1:"is a")," WARD STOCK item",$E("s",$P(PSGPENWS,"^",2)),"." S PSGPEN=0
"RTN","PSGPEN",17,0)
 I 'PSGPENWS,PSJPWD S WG=+$O(^PS(57.5,"AB",PSJPWD,0)),PSGPLS=$P($G(^PS(55,PSGP,5,PSGPENO,2)),"^",2) I PSGPLS D
"RTN","PSGPEN",18,0)
 .S PSGPLF=$O(^PS(53.5,"AB",WG,PSGDT))
"RTN","PSGPEN",19,0)
 .N RNDT,OSTP S RNDT=$$LASTREN^PSJLMPRI(PSGP,$S($G(PSJORD)["P":PSJORD,1:"")) S:$G(PSJREN) RNDT=$$DATE^PSJUTL2 I RNDT S PSGPLS=+RNDT
"RTN","PSGPEN",20,0)
 .D:'PSGPLF GF I PSGPLF S PSGPLO=PSGPENO D NCE,^PSGPL0 S:PSGPLC'<0 PSGPEN=PSGPLC
"RTN","PSGPEN",21,0)
 I $G(PSGPRIO)="DONE" S PSGPEN=0
"RTN","PSGPEN",22,0)
 ;
"RTN","PSGPEN",23,0)
UPDD ;
"RTN","PSGPEN",24,0)
 N DIR S DIR(0)="NOA^0:9999:0",DIR("A")="Pre-Exchange DOSES: ",DIR("?")="^D DH^PSGPEN" S:PSGPEN]"" DIR("B")=PSGPEN W ! D ^DIR G:'Y DONE S PSGY=+Y W !!,"...updating dispense drug(s)..."
"RTN","PSGPEN",25,0)
 F FQ=0:0 S FQ=$O(^PS(55,PSGP,5,PSGPENO,1,FQ)) Q:'FQ  S ND=$G(^(FQ,0)),$P(^(0),"^",9)="" I ND,'$P(ND,"^",3) D DD
"RTN","PSGPEN",26,0)
 ;
"RTN","PSGPEN",27,0)
DONE ;
"RTN","PSGPEN",28,0)
 I $P(PSJSYSW0,"^",29)="",$$DEFON^PSGPER1 S $P(PSJSYSW0,"^",29)=0
"RTN","PSGPEN",29,0)
 K PSGID,PSGMAR,PSGOD,PSGPLC,PSGPLF,PSGPLO,PSGPLS,PSGPLUD,WG S:$G(PSJREN) DUOUT=0 Q
"RTN","PSGPEN",30,0)
 ;
"RTN","PSGPEN",31,0)
NCE ;
"RTN","PSGPEN",32,0)
 W !!,"The next cart exchange is ",$$ENDTC^PSGMI(PSGPLF),! Q
"RTN","PSGPEN",33,0)
 ;
"RTN","PSGPEN",34,0)
GF ;
"RTN","PSGPEN",35,0)
 S QQ=0 F Q=0:0 S Q=$O(^PS(53.5,"AB",WG,Q)) Q:'Q  S QQ=Q
"RTN","PSGPEN",36,0)
 I QQ S QQ=$O(^PS(53.5,"AB",WG,QQ,0)) I QQ,$D(^PS(53.5,QQ,0)) S QQ=$P(^(0),"^",4) I QQ>PSGDT S PSGPLF=QQ
"RTN","PSGPEN",37,0)
 Q
"RTN","PSGPEN",38,0)
 ;
"RTN","PSGPEN",39,0)
DD ;
"RTN","PSGPEN",40,0)
 N DA S DRG=$S($P(ND,"^")="":"NOT FOUND",'$D(^PSDRUG(+ND,0)):"NOT FOUND ("_$P(ND,"^")_")",$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^")_";PSDRUG("),UD=$S('$P(ND,"^",2):1,1:$P(ND,"^",2))
"RTN","PSGPEN",41,0)
 W !,"...",DRG,?45,"U/D: ",UD,"..."
"RTN","PSGPEN",42,0)
 S PSGDA=PSGY I 'PSGPENWS,ND,PSJPWD,($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) D PSGPENWS Q:'PSGDA
"RTN","PSGPEN",43,0)
 K DA,DR S PSGDA=$S(UD#1:(PSGDA*((UD\1)+1)),1:PSGDA*UD)
"RTN","PSGPEN",44,0)
 S DIE="^PS(55,"_PSGP_",5,"_PSGPENO_",1,",DA(2)=PSGP,DA(1)=PSGPENO,DA=FQ,DR=".09////"_PSGDA D ^DIE
"RTN","PSGPEN",45,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSGPEN",46,0)
 D:'PSGPXN
"RTN","PSGPEN",47,0)
 .D NOW^%DTC L +^PS(53.4,0):0 S ND=$G(^PS(53.4,0)) S:ND="" ND="PRE-EXCHANGE NEEDS^53.4P" F PSGPXN=$P(ND,"^",3)+1:1 I '$D(^PS(53.4,PSGPXN)) L +^PS(53.4,PSGPXN):0 I  S ^PS(53.4,0)=$P(ND,"^",1,2)_"^"_PSGPXN_"^"_($P(ND,"^",4)+1) L -^PS(53.4,0) Q
"RTN","PSGPEN",48,0)
 .S ^PS(53.4,PSGPXN,0)=DUZ_"^"_%,^PS(53.4,"B",DUZ,PSGPXN)="",^PS(53.4,"AUD",DUZ,%,PSGPXN)="" L -^PS(53.4,PSGPXN) Q
"RTN","PSGPEN",49,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,FQ,0)) S $P(^(0),"^",2)=$P(^(0),"^",2)+PSGDA Q
"RTN","PSGPEN",50,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",51,0)
 S ^(0)=FQ_"^"_PSGDA I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,0)) S $P(^(0),"^",3,4)=FQ_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",52,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",53,0)
 S ^(0)="^53.401101A^"_FQ_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,0))  S ^(0)=PSGPENO
"RTN","PSGPEN",54,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,0)) S $P(^(0),"^",3,4)=PSGPENO_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",55,0)
 ; naked reference below is from line above
"RTN","PSGPEN",56,0)
 S ^(0)="^53.4011A^"_PSGPENO_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,0))  S ^(0)=PSGP
"RTN","PSGPEN",57,0)
 I $D(^PS(53.4,PSGPXN,1,0)) S $P(^(0),"^",3,4)=PSGP_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",58,0)
 ; naked reference below is from line above
"RTN","PSGPEN",59,0)
 S ^(0)="^53.401PA^"_PSGP_"^1" Q
"RTN","PSGPEN",60,0)
 ;
"RTN","PSGPEN",61,0)
DH ;
"RTN","PSGPEN",62,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits."
"RTN","PSGPEN",63,0)
 W !!?2,"Enter the number DOSES needed for this order until the next cart exchange.",!,"This will be the number of times the order will be administered to the patient",!,"from the start of the order until the next cart exchange."
"RTN","PSGPEN",64,0)
 W !!?2,"PLEASE NOTE that this is DOSES, and NOT UNITS.  The doses entered will be",!,"converted to units for each dispense drug of this order, as each dispense drug",!,"may have a different units per dose." Q
"RTN","PSGPEN",65,0)
 ;
"RTN","PSGPEN",66,0)
PSGPENWS ;
"RTN","PSGPEN",67,0)
 W !,"This dispense drug is a WARD STOCK item."
"RTN","PSGPEN",68,0)
 W !,"Would you like to:",!?3,"1 - Enter 0 (no) doses needed for this dispense drug.",!?3,"2 - Enter ",PSGDA," doses needed for this dispense drug.",!?3,"3 - Enter another amount as the doses needed for this dispense drug."
"RTN","PSGPEN",69,0)
 K DIR S DIR(0)="SA^1:0 (no) doses;2:"_PSGDA_" doses;3:another amount",DIR("A")="Select ACTION: ",DIR("?")="^D WH^PSGPEN" W ! D ^DIR I Y=1!'Y S PSGDA=0 Q
"RTN","PSGPEN",70,0)
 Q:Y=2  K DIR S DIR(0)="NA^0:9999:0",DIR("A")="Pre-Exchange DOSES for this dispense drug: ",DIR("?")="^D WDH^PSGPEN" W ! D ^DIR S PSGDA=+Y Q
"RTN","PSGPEN",71,0)
 ;
"RTN","PSGPEN",72,0)
WH ;
"RTN","PSGPEN",73,0)
 S Q="This dispense drug ("_DRG_") is a ward stock item.  Select:"
"RTN","PSGPEN",74,0)
 W !! F Q1=1:1:$L(Q," ") S Q2=$P(Q," ",Q1) W:$X+$L(Q2)>78 ! W Q2," "
"RTN","PSGPEN",75,0)
 W !?3,"1 to enter 0 (no) pre-exchange doses for this dispense drug.",!?3,"2 to enter ",PSGDA," doses for this dispense drug.",!?3,"3 to enter another amount for this dispense drug." Q
"RTN","PSGPEN",76,0)
 ;
"RTN","PSGPEN",77,0)
WDH ;
"RTN","PSGPEN",78,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits.  If you enter an '^' to exit",!,"NO pre-exchange doses will be entered for this dispense drug." Q
"RTN","PSGPER")
0^13^B11299259
"RTN","PSGPER",1,0)
PSGPER ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;04 JAN 95 / 5:08 PM
"RTN","PSGPER",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**95,115,127**;16 DEC 97
"RTN","PSGPER",3,0)
 ;
"RTN","PSGPER",4,0)
 S PSGPERRF=0
"RTN","PSGPER",5,0)
DEV ;
"RTN","PSGPER",6,0)
 S PSGION=ION
"RTN","PSGPER",7,0)
DEV1 ;
"RTN","PSGPER",8,0)
 Q:'$$DEFON^PSGPER1
"RTN","PSGPER",9,0)
 S D=$G(PSGPXDEV) S:'D D=$P(PSJSYSW0,U,29) S:D="" D="HOME" S IOP=$S(D:"`"_D,1:D) K %ZIS S %ZIS="NQ" D ^%ZIS S D=$G(ION)
"RTN","PSGPER",10,0)
 K IOP,%ZIS,IO("Q"),ION S %ZIS="QM",%ZIS("A")="Select DEVICE for PRE-EXCHANGE UNITS REPORT: ",%ZIS("B")=D D ^%ZIS K %ZIS
"RTN","PSGPER",11,0)
 I POP D POP G:%=1 DEV1 G DONE
"RTN","PSGPER",12,0)
 I $G(ION)]"",D'=ION D CURDEF
"RTN","PSGPER",13,0)
 I $D(IO("Q")) K ZTSAVE S PSGTIR="^PSGPER0",ZTDESC="PRE-EXCHANGE UNITS REPORT",ZTDTH=$H,ZTSAVE("PSGPXN")="" D ENTSK^PSGTI G:'$D(ZTSK) DEV K ZTSK G OUT
"RTN","PSGPER",14,0)
 D ENP^PSGPER0:'$G(PSGPXPT),ENPAT^PSGPER0:$G(PSGPXPT),AG
"RTN","PSGPER",15,0)
 I %=1 S PSGPERRF=1 G DEV
"RTN","PSGPER",16,0)
 ;
"RTN","PSGPER",17,0)
DONE ;
"RTN","PSGPER",18,0)
 S DIK="^PS(53.4,",DA=PSGPXN D ^DIK
"RTN","PSGPER",19,0)
 ;
"RTN","PSGPER",20,0)
OUT ;
"RTN","PSGPER",21,0)
 K PSGPERRF,PSGPXN
"RTN","PSGPER",22,0)
 Q:$G(PSJCOM)!$G(PSJPREX)
"RTN","PSGPER",23,0)
 N PSJSYSW0,PSGVBW,PSJPWD,PSJSYSL D  Q
"RTN","PSGPER",24,0)
 . D:'$G(PSGPXPT) ENIVKV^PSGSETU
"RTN","PSGPER",25,0)
 ;
"RTN","PSGPER",26,0)
POP ;
"RTN","PSGPER",27,0)
 S %=2 W:'PSGPERRF !!,"IF A DEVICE IS NOT CHOSEN, NO REPORT WILL BE RUN AND THE DATA WILL NO LONGER BE RETRIEVABLE THROUGH THIS REPORT."
"RTN","PSGPER",28,0)
 I 'PSGPERRF F  W !,"Do you want another chance to choose a device" S %=1 D YN^DICN Q:%  W !?3,"Enter 'YES' to choose a device to print.  Enter 'NO' to quit now."
"RTN","PSGPER",29,0)
 I %'=1 S IOP=PSGION D ^%ZIS S %=2
"RTN","PSGPER",30,0)
 Q
"RTN","PSGPER",31,0)
 ;
"RTN","PSGPER",32,0)
AG ;
"RTN","PSGPER",33,0)
 F  W !!,"DO YOU NEED TO PRINT THIS REPORT AGAIN" S %=2 D YN^DICN Q:%  D AGMSG
"RTN","PSGPER",34,0)
 Q
"RTN","PSGPER",35,0)
 ;
"RTN","PSGPER",36,0)
AGMSG ;
"RTN","PSGPER",37,0)
 I %Y'?1."?" W $C(7),"  ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER",38,0)
 W !,"  Enter 'YES' to print this report again.  Enter 'NO' (or an '^') to quit",!,"now.  PLEASE NOTE that you will NOT be able to retrieve this data at a later",!,"date.  You should print this information now." Q
"RTN","PSGPER",39,0)
CURDEF ;
"RTN","PSGPER",40,0)
 Q:$G(PSGPXDEV)=0
"RTN","PSGPER",41,0)
 N D S D=$O(^%ZIS(1,"B",ION,"")) Q:'D
"RTN","PSGPER",42,0)
 F  W !!,"Keep ",ION," as the PRE-EXCHANGE REPORT DEVICE for this session" S %=0 D YN^DICN S PSGPXDEV=$S(%=1:D,1:0) Q:%  D DEFMSG
"RTN","PSGPER",43,0)
 Q
"RTN","PSGPER",44,0)
 ;
"RTN","PSGPER",45,0)
DEFMSG ;
"RTN","PSGPER",46,0)
 I %Y'?1."?" W !,$C(7),"     ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER",47,0)
 W !!,"  Enter 'YES' to make ",ION," the PRE-EXCHANGE REPORT default DEVICE"
"RTN","PSGPER",48,0)
 W !,"  for the current session. PLEASE NOTE that this will override the ward"
"RTN","PSGPER",49,0)
 W !,"  default PRE-EXCHANGE REPORT DEVICE for this session only."
"RTN","PSGPER",50,0)
 Q
"RTN","PSGPER1")
0^14^B7625269
"RTN","PSGPER1",1,0)
PSGPER1 ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;18 MAR 03 / 5:08 PM
"RTN","PSGPER1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**80,127**;16 DEC 97
"RTN","PSGPER1",3,0)
 ;
"RTN","PSGPER1",4,0)
 S PSGPERRF=0
"RTN","PSGPER1",5,0)
DEV ;
"RTN","PSGPER1",6,0)
 S PSGION=ION
"RTN","PSGPER1",7,0)
DEV1 K IOP,%ZIS,IO("Q") S %ZIS="Q",%ZIS("A")="Select DEVICE for PRE-EXCHANGE UNITS REPORT: ",%ZIS("B")="" W ! D ^%ZIS K %ZIS
"RTN","PSGPER1",8,0)
 I POP D POP G:%=1 DEV1 G DONE
"RTN","PSGPER1",9,0)
 I $D(IO("Q")) K ZTSAVE S PSGTIR="^PSGPER2",ZTDESC="PRE-EXCHANGE UNITS REPORT",ZTDTH=$H,ZTSAVE("PSGPXN")="" D ENTSK^PSGTI G:'$D(ZTSK) DEV K ZTSK G OUT
"RTN","PSGPER1",10,0)
 D ENP^PSGPER2,AG I %=1 S PSGPERRF=1 G DEV
"RTN","PSGPER1",11,0)
 ;
"RTN","PSGPER1",12,0)
DONE ;
"RTN","PSGPER1",13,0)
 S DIK="^PS(53.4,",DA=PSGPXN D ^DIK
"RTN","PSGPER1",14,0)
 ;
"RTN","PSGPER1",15,0)
OUT ;
"RTN","PSGPER1",16,0)
 K PSGPERRF,PSGPXN
"RTN","PSGPER1",17,0)
 Q:$G(PSJCOM)!$G(PSJPREX)
"RTN","PSGPER1",18,0)
 D ENIVKV^PSGSETU,ENCV^PSGSETU
"RTN","PSGPER1",19,0)
 Q
"RTN","PSGPER1",20,0)
 ;
"RTN","PSGPER1",21,0)
POP ;
"RTN","PSGPER1",22,0)
 S %=2 W:'PSGPERRF !!,"IF A DEVICE IS NOT CHOSEN, NO REPORT WILL BE RUN AND THE DATA WILL NO LONGER BE RETRIEVABLE THROUGH THIS REPORT."
"RTN","PSGPER1",23,0)
 I 'PSGPERRF F  W !,"Do you want another chance to choose a device" S %=1 D YN^DICN Q:%  W !?3,"Enter 'YES' to choose a device to print.  Enter 'NO' to quit now."
"RTN","PSGPER1",24,0)
 I %'=1 S IOP=PSGION D ^%ZIS S %=2
"RTN","PSGPER1",25,0)
 Q
"RTN","PSGPER1",26,0)
 ;
"RTN","PSGPER1",27,0)
AG ;
"RTN","PSGPER1",28,0)
 F  W !!,"DO YOU NEED TO PRINT THIS REPORT AGAIN" S %=0 D YN^DICN Q:%  D AGMSG
"RTN","PSGPER1",29,0)
 Q
"RTN","PSGPER1",30,0)
 ;
"RTN","PSGPER1",31,0)
AGMSG ;
"RTN","PSGPER1",32,0)
 I %Y'?1."?" W $C(7),"  ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER1",33,0)
 W !,"  Enter 'YES' to print this report again.  Enter 'NO' (or an '^') to quit",!,"now.  PLEASE NOTE that you will NOT be able to retrieve this data at a later",!,"date.  You should print this information now." Q
"RTN","PSGPER1",34,0)
 ;
"RTN","PSGPER1",35,0)
DEFON() ; All Pre-Exchange Devices have been removed from Ward Parameters - restore previous functionality
"RTN","PSGPER1",36,0)
 N ON,W S ON=0,W=0 F  S W=$O(^PS(59.6,W)) Q:'W!ON  I $P(^(W,0),U,29)]"" S ON=1
"RTN","PSGPER1",37,0)
 I $G(PSJPXDOF) S ON=0 K PSJPXDOF
"RTN","PSGPER1",38,0)
 Q ON
"RTN","PSGVBW0")
0^23^B34961273
"RTN","PSGVBW0",1,0)
PSGVBW0 ;BIR/CML3,MV-SHOW NON-VERFIED ORDERS GATHERED IN PSGVBW ;17 SEP 97 /  1:41 PM
"RTN","PSGVBW0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,39,53,56,95,80,110,127**;16 DEC 97
"RTN","PSGVBW0",3,0)
 ;
"RTN","PSGVBW0",4,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGVBW0",5,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSGVBW0",6,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSGVBW0",7,0)
 ;
"RTN","PSGVBW0",8,0)
START ;
"RTN","PSGVBW0",9,0)
 S (LINE,PSGOEA,PSGOEAV)="",$P(LINE,"-",81)="" S PSGPXN=$G(PSGPXN)
"RTN","PSGVBW0",10,0)
 K ^TMP("PSJLIST",$J) D:PSGSS'="P" DISPLAYW Q:'$O(^TMP("PSJSELECT",$J,0))
"RTN","PSGVBW0",11,0)
PROCESS ; Loop through selected patients and display profile/orders.
"RTN","PSGVBW0",12,0)
 K DIR,PSJPNV S PSJPNV=1
"RTN","PSGVBW0",13,0)
 I $P(PSJSYSU,";")=3 S X=$O(^TMP("PSJSELECT",$J,1)),DIR(0)="Y",DIR("A")="Do you want to print a profile for the"_$S(X:"se",1:"")_" patient"_$S(X:"s",1:""),DIR("B")="NO" D
"RTN","PSGVBW0",14,0)
 .D ^DIR K DIR I Y D ^PSJHVARS,^PSGVBWP,RESTORE^PSJHVARS
"RTN","PSGVBW0",15,0)
 .W !!,"Select profile type for order processing.",!!
"RTN","PSGVBW0",16,0)
 D ENL^PSGOU Q:"SNL"'[PSGOL
"RTN","PSGVBW0",17,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP("PSJSELECT",$J,PSJCNT)) Q:'PSJCNT  D PROCESS1 S PSGOP=PSGP D ENQL^PSGLW:$P(PSJSYSL,"^",2)]"" Q:$G(PSJGOTO)="E"  I $D(^TMP("PSJSELECT",$J,+$G(PSJGOTO))) S PSJCNT=PSJGOTO-1
"RTN","PSGVBW0",18,0)
 Q
"RTN","PSGVBW0",19,0)
PROCESS1 ;
"RTN","PSGVBW0",20,0)
 S PSJPN=$G(^TMP("PSJSELECT",$J,PSJCNT)) K PSJGOTO
"RTN","PSGVBW0",21,0)
 S PSJLK=$$L^PSSLOCK($P(PSJPN,U,2),1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGVBW0",22,0)
 K PSJGOTO D:PSJPN]"" GTORDERS
"RTN","PSGVBW0",23,0)
 I PSJLK D UL^PSSLOCK($P(PSJPN,U,2))
"RTN","PSGVBW0",24,0)
 ;I $G(PSGPXN),$P(PSJSYSW0,U,29)]"" D  K PSGPXPT S PSGPXN=0
"RTN","PSGVBW0",25,0)
 I $G(PSGPXN),$$DEFON^PSGPER1 D  K PSGPXPT S PSGPXN=0
"RTN","PSGVBW0",26,0)
 .S PSGPXPT=PSGP
"RTN","PSGVBW0",27,0)
 .N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER,ENCV^PSGSETU,^PSIVXU
"RTN","PSGVBW0",28,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSGVBW0",29,0)
 Q
"RTN","PSGVBW0",30,0)
 ;
"RTN","PSGVBW0",31,0)
DISPLAYW ; Allow selection of patients on each ward selected.
"RTN","PSGVBW0",32,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1,PSGVBWN="" F  S PSGVBWN=$O(^TMP("PSGVBW",$J,PSGVBWN)) Q:PSGVBWN=""  D DISPLAYT
"RTN","PSGVBW0",33,0)
 Q
"RTN","PSGVBW0",34,0)
 ;
"RTN","PSGVBW0",35,0)
DISPLAYT ;
"RTN","PSGVBW0",36,0)
 NEW PSGPICK  ;PSGPICK=1-->user selected order, stop display the profile
"RTN","PSGVBW0",37,0)
 D HEADER S PSGVBTM="",PSGVBY=0 F  S PSGVBTM=$O(^TMP("PSGVBW",$J,PSGVBWN,PSGVBTM))  Q:(PSGVBTM=""!$G(PSGPICK))  D V2
"RTN","PSGVBW0",38,0)
 I PSJASK,(PSGVBY>0) D ASK
"RTN","PSGVBW0",39,0)
 Q
"RTN","PSGVBW0",40,0)
 ;
"RTN","PSGVBW0",41,0)
GTORDERS ;
"RTN","PSGVBW0",42,0)
 S (PSGP,DFN)=$P(PSJPN,U,2) K PSJACNWP D ^PSJAC
"RTN","PSGVBW0",43,0)
 I PSGOL'="N" D PROFILE Q
"RTN","PSGVBW0",44,0)
 D ENGORD^PSGVBWU
"RTN","PSGVBW0",45,0)
 ;S PSJPRIO="" F  S PSJPRIO=$O(^TMP("PSJON",$J,PSJPRIO)) Q:PSJPRIO=""  S PSJON="" F  S PSJON=$O(^TMP("PSJON",$J,PSJPRIO,PSJON)) Q:PSJON=""  D DISACTIO^PSJOE(DFN,$P(PSJON,U,2),1) Q:$D(PSJGOTO)
"RTN","PSGVBW0",46,0)
 S PSJPRIO="" F  S PSJPRIO=$O(^TMP("PSJON",$J,PSJPRIO)) Q:PSJPRIO=""  S PSJON="" D
"RTN","PSGVBW0",47,0)
 . F  S PSJON=$O(^TMP("PSJON",$J,PSJPRIO,PSJON)) Q:PSJON=""  D
"RTN","PSGVBW0",48,0)
 .. I $P(PSJON,U,2)=+$P(PSJON,U,2) Q:'$$LOCK^PSJOEA(DFN,$P(PSJON,U,2))  D GTORDER2 Q
"RTN","PSGVBW0",49,0)
 .. I '$$LS^PSSLOCK(DFN,$P(PSJON,U,2)) D DISPORD(DFN,$P(PSJON,U,2)) Q
"RTN","PSGVBW0",50,0)
 .. D DISACTIO^PSJOE(DFN,$P(PSJON,U,2),1) Q:$D(PSJGOTO)  D UNL^PSSLOCK(DFN,$P(PSJON,U,2))
"RTN","PSGVBW0",51,0)
 Q
"RTN","PSGVBW0",52,0)
 ;
"RTN","PSGVBW0",53,0)
GTORDER2 ;
"RTN","PSGVBW0",54,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",55,0)
 .D DISACTIO^PSJOE(DFN,PSJO_"P",1) Q:$D(PSJGOTO)
"RTN","PSGVBW0",56,0)
 I $D(^TMP("PSJCOM",$J)) N PSJORD S PSJORD=$P(PSJON,U,2) D CHK^PSJOEA1
"RTN","PSGVBW0",57,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",58,0)
 .D UNL^PSSLOCK(DFN,PSJO_"P") Q:$G(Y)<0
"RTN","PSGVBW0",59,0)
 Q
"RTN","PSGVBW0",60,0)
 ;
"RTN","PSGVBW0",61,0)
PROFILE ; Display the patient's profile and allow order selection.
"RTN","PSGVBW0",62,0)
 S PSGP=DFN,PSJOL=PSGOL F  D EN^VALM("PSJ LM PNV") Q:'$G(PSJORD)&'$G(PSJNEWOE)  S PSJNEWOE=0
"RTN","PSGVBW0",63,0)
 Q
"RTN","PSGVBW0",64,0)
 ;
"RTN","PSGVBW0",65,0)
DONE ;
"RTN","PSGVBW0",66,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJON",$J)
"RTN","PSGVBW0",67,0)
 K CF,DA,LINE,NP,POP,PPN,PR,PSGCANFL,PSGION,PSGOL,PSGOEAV,PSGOENOF,PSGON,PSGONC,PSGONR,PSGLMT,PSGORD,PSGPRF,PSGVBA,PSGVBAF,PSGVBON,PSGVBPN,PSGVBQ,PSGVBQ1,PSGVBSD,PSGVBSS,PSGVBST,PSGVBTM,PSGVBW,PSGVBWN,PSGVBY,QQ,Z
"RTN","PSGVBW0",68,0)
 Q
"RTN","PSGVBW0",69,0)
 ;
"RTN","PSGVBW0",70,0)
V2 ;
"RTN","PSGVBW0",71,0)
 S PSGVBPN="" F  S PSGVBPN=$O(^TMP("PSGVBW",$J,PSGVBWN,PSGVBTM,PSGVBPN)) Q:(PSGVBPN=""!$G(PSGPICK))  S PSGP=$P(PSGVBPN,"^",2),PPN=$P(PSGVBPN,"^") S:PPN="" PPN=PSGP_";DPT(" D WRT
"RTN","PSGVBW0",72,0)
 Q
"RTN","PSGVBW0",73,0)
 ;
"RTN","PSGVBW0",74,0)
WRT ;
"RTN","PSGVBW0",75,0)
 S PSGVBY=PSGVBY+1,PSJASK=1
"RTN","PSGVBW0",76,0)
 W !,$J(PSGVBY,4),?6,$S(PSGVBTM'="zz":PSGVBTM,1:"Not Found"),?27,PPN," (",$P(PSGVBPN,U,3),")" S ^TMP("PSJLIST",$J,PSGVBY)=PSGVBWN_U_PSGVBTM_U_PPN_U_PSGP
"RTN","PSGVBW0",77,0)
 ;I $Y+1>IOSL,(PSGVBY>0) D ASK S PSJASK=0
"RTN","PSGVBW0",78,0)
 ;I $Y+1>IOSL,(PSGVBY>0) D ASK S PSJASK=0 W @IOF
"RTN","PSGVBW0",79,0)
 I $Y+1>IOSL,(PSGVBY>0) NEW DIR S DIR(0)="EA",DIR("A")=" '^' TO QUIT " D ^DIR D
"RTN","PSGVBW0",80,0)
 . I X="^" S PSGPICK=1  Q
"RTN","PSGVBW0",81,0)
 . S PSJASK=0 W @IOF
"RTN","PSGVBW0",82,0)
 Q
"RTN","PSGVBW0",83,0)
 ;
"RTN","PSGVBW0",84,0)
ASK ;
"RTN","PSGVBW0",85,0)
 N DIR,PSGDFN S DIR(0)="LOA^1:"_PSGVBY,DIR("A")="Select 1 - "_PSGVBY_": " D ^DIR I $D(DUOUT)!$D(DTOUT) K ^TMP("PSGVBW",$J) Q
"RTN","PSGVBW0",86,0)
 S:Y]"" PSGPICK=1
"RTN","PSGVBW0",87,0)
 F PSJINDEX=1:1:$L(Y,",")-1 D
"RTN","PSGVBW0",88,0)
 . S X=$G(^TMP("PSJLIST",$J,$P(Y,",",PSJINDEX))),PSGDFN=$P(X,"^",4)_"^"_$P(X,"^",3)
"RTN","PSGVBW0",89,0)
 . D CHK^PSJDPT(.PSGDFN,1) I PSGDFN=-1 Q
"RTN","PSGVBW0",90,0)
 . S:X]"" ^TMP("PSJSELECT",$J,PSJCNT)=$P(X,U,3,4),^TMP("PSJSELECT",$J,"B",$P(X,U,3),PSJCNT)="",PSJCNT=PSJCNT+1
"RTN","PSGVBW0",91,0)
 ;K ^TMP("PSJLIST",$J)
"RTN","PSGVBW0",92,0)
 Q
"RTN","PSGVBW0",93,0)
 ;
"RTN","PSGVBW0",94,0)
H2 ;
"RTN","PSGVBW0",95,0)
 W !!?2,"Select patients either singularly separated by commas (1,2,3), by a range of",!,"patients separated by a dash (1-3), or a combination (1,2,4-6).  To select all",!,"patients, enter 'ALL' or a dash ('-').  You can also enter '-n' to"
"RTN","PSGVBW0",96,0)
 W " select the",!,"first patient through the 'nth' patient or enter 'n-' to select the 'nth'",!,"patient through the last patient.  If a patient is selected more than once,"
"RTN","PSGVBW0",97,0)
 W !,"only the first selection is used.  (Entering '1,2,1' would return '1,2'.)" Q
"RTN","PSGVBW0",98,0)
 ;
"RTN","PSGVBW0",99,0)
HEADER ;
"RTN","PSGVBW0",100,0)
 W:$Y @IOF W !,"ORDERS NOT VERIFIED BY A ",$S($P(PSJSYSU,";",3)>1:"PHARMACIST",1:"NURSE")," - ",$S(PSGVBWN="ZZ":"^OTHER",1:PSGVBWN)
"RTN","PSGVBW0",101,0)
 W !!," No.",?7,"TEAM",?32,"PATIENT",!,LINE K PSGVBY S PSGVBY=0 Q
"RTN","PSGVBW0",102,0)
 Q
"RTN","PSGVBW0",103,0)
 ;
"RTN","PSGVBW0",104,0)
NP ;
"RTN","PSGVBW0",105,0)
 W $C(7) R !!,"ENTER AN '^' TO SELECT ORDERS NOW, OR PRESS THE RETURN KEY TO CONTINUE. ",NP:DTIME E  S NP="^"
"RTN","PSGVBW0",106,0)
 Q
"RTN","PSGVBW0",107,0)
DISPORD(DFN,ON)     ;Display the order that being lock by another user
"RTN","PSGVBW0",108,0)
 NEW PSJLINE,PSJOC,X
"RTN","PSGVBW0",109,0)
 S PSJLINE=1
"RTN","PSGVBW0",110,0)
 D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSGVBW0",111,0)
 W ! F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  W !,PSJOC(ON,X)
"RTN","PSGVBW0",112,0)
 Q
"RTN","PSGVBW0",113,0)
        
"RTN","PSIVEDT")
0^4^B38742764
"RTN","PSIVEDT",1,0)
PSIVEDT ;BIR/MLM-EDIT IV ORDER ;10 Feb 98 / 3:23 PM
"RTN","PSIVEDT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,110,127**;16 DEC 97
"RTN","PSIVEDT",3,0)
 ;
"RTN","PSIVEDT",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVEDT",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVEDT",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVEDT",7,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVEDT",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVEDT",9,0)
 ;
"RTN","PSIVEDT",10,0)
EDIT ;
"RTN","PSIVEDT",11,0)
 I $G(DFN)&($G(PSJORD)["V") I $$COMPLEX^PSJOE(DFN,PSJORD) D
"RTN","PSIVEDT",12,0)
 . N X,Y,PARENT,P2ND S P2ND=$S($G(^PS(55,PSGP,"IV",+PSJORD,.2)):$G(^PS(55,PSGP,"IV",+PSJORD,.2)),1:$G(^PS(55,PSGP,5,+PSJORD,.2)))
"RTN","PSIVEDT",13,0)
 . S PARENT=$P(P2ND,"^",8)
"RTN","PSIVEDT",14,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSJORD)
"RTN","PSIVEDT",15,0)
 S DONE=0
"RTN","PSIVEDT",16,0)
 F PSIVE=1:1 S:DONE&$E(PSIVAC)="C" OREND=1 Q:PSIVE>$L(EDIT,U)!(DONE)  Q:'$L($P(EDIT,U,PSIVE))  D @($P(EDIT,U,PSIVE)) S:$E(PSIVAC,2)="N" PSIVOK=PSIVOK_U_$P(EDIT,U,PSIVE) I $E(X)=U,$L(X)>1 S:PSIVE>1 PSIVE=PSIVE-1 F  D FF Q:Y<0  D @Y Q:$E(X)'=U
"RTN","PSIVEDT",17,0)
 K EDIT,PSIVOK,PSGDI
"RTN","PSIVEDT",18,0)
 Q
"RTN","PSIVEDT",19,0)
 ;
"RTN","PSIVEDT",20,0)
1 ; Provider.
"RTN","PSIVEDT",21,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+$G(ON),0)),"^",24)="R" D  Q
"RTN","PSIVEDT",22,0)
 . W !!?5,"This is Renewal order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",23,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",24,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",25,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",26,0)
 W !,"PROVIDER: "_$S($P(P(6),U,2)]"":$P(P(6),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P(6)) Q
"RTN","PSIVEDT",27,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 1
"RTN","PSIVEDT",28,0)
 I X]"" K DIC S DIC=200,DIC(0)="EQMZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),U,4):1,$P(^(""PS""),U,4)>DT:1,1:0)" D ^DIC K DIC I Y>0 S P(6)=+Y_U_Y(0,0) Q
"RTN","PSIVEDT",29,0)
 S F1=53.1,F2=1 D ENHLP^PSIVORC1 W $C(7),!!,"A Provider must be entered.",!! G 1
"RTN","PSIVEDT",30,0)
 Q
"RTN","PSIVEDT",31,0)
 ;
"RTN","PSIVEDT",32,0)
3 ; Med Route.
"RTN","PSIVEDT",33,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",34,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",35,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",36,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",37,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",38,0)
 I P("MR")="" S X=$O(^PS(51.2,"B","INTRAVENOUS",0)) I $P($G(^PS(51.2,+X,0)),U,4) S P("MR")=+X_U_$P(^(0),U,3)
"RTN","PSIVEDT",39,0)
 W !,"MED ROUTE: "_$S($P(P("MR"),U,2)]"":$P(P("MR"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I X=U!(X=""&P("MR"))!($E(X)=U) Q
"RTN","PSIVEDT",40,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 3
"RTN","PSIVEDT",41,0)
 I X]"" K DIC S DIC=51.2,DIC(0)="EQMZ",DIC("S")="I $P(^(0),U,4)" D ^DIC K DIC I Y>0 S P("MR")=+Y_U_$P(Y(0),U,3) Q
"RTN","PSIVEDT",42,0)
 S F1=53.1,F2=3 D ENHLP^PSIVORC1 W $C(7),!!,"A Med Route must be entered." G 3
"RTN","PSIVEDT",43,0)
 Q
"RTN","PSIVEDT",44,0)
 ;
"RTN","PSIVEDT",45,0)
10 ; Start Date.
"RTN","PSIVEDT",46,0)
 D 10^PSIVEDT1
"RTN","PSIVEDT",47,0)
 Q
"RTN","PSIVEDT",48,0)
 ;
"RTN","PSIVEDT",49,0)
25 ; Stop Date.
"RTN","PSIVEDT",50,0)
 D 25^PSIVEDT1
"RTN","PSIVEDT",51,0)
 Q
"RTN","PSIVEDT",52,0)
26 ; Schedule
"RTN","PSIVEDT",53,0)
 D 26^PSIVEDT1
"RTN","PSIVEDT",54,0)
 Q
"RTN","PSIVEDT",55,0)
 ;
"RTN","PSIVEDT",56,0)
39 ; Admin Times.
"RTN","PSIVEDT",57,0)
 D 39^PSIVEDT1
"RTN","PSIVEDT",58,0)
 Q
"RTN","PSIVEDT",59,0)
 ;
"RTN","PSIVEDT",60,0)
57 ; Additive.
"RTN","PSIVEDT",61,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",62,0)
 . W !!?5,"Additive may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",63,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",64,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",65,0)
 I $E(PSIVAC)="O" W !!,"Only additives marked for use in IV Fluid Order Entry may be selected."
"RTN","PSIVEDT",66,0)
 S FIL=52.6,DRGT="AD",DRGTN="ADDITIVE" D DRG^PSIVEDRG,DKILL
"RTN","PSIVEDT",67,0)
 Q
"RTN","PSIVEDT",68,0)
 ;
"RTN","PSIVEDT",69,0)
58 ; Solution.
"RTN","PSIVEDT",70,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",71,0)
 . W !!?5,"Solution may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",72,0)
 S FIL=52.7,DRGT="SOL",DRGTN="SOLUTION" D DRG^PSIVEDRG
"RTN","PSIVEDT",73,0)
 ;
"RTN","PSIVEDT",74,0)
DKILL ; Kill for drug edit.
"RTN","PSIVEDT",75,0)
 K DRGI,DRGN,DRGT,DRGTN,FIL,PSIVSTR
"RTN","PSIVEDT",76,0)
 Q
"RTN","PSIVEDT",77,0)
 ;
"RTN","PSIVEDT",78,0)
59 ; Infusion Rate.
"RTN","PSIVEDT",79,0)
 D 59^PSIVEDT1
"RTN","PSIVEDT",80,0)
 Q
"RTN","PSIVEDT",81,0)
 ;
"RTN","PSIVEDT",82,0)
62 ; IV Room.
"RTN","PSIVEDT",83,0)
 N DIR S DIR(0)="PA^59.5",DIR("A")="IV Room: ",DIR("??")="^S F1=59.5,F2=.01 D ENHLP^PSIVORC1" S:P("IVRM") DIR("B")=$P(P("IVRM"),U,2)
"RTN","PSIVEDT",84,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 S P("IVRM")=Y W $P($P(Y,U,2),X,2)
"RTN","PSIVEDT",85,0)
 Q
"RTN","PSIVEDT",86,0)
 ;
"RTN","PSIVEDT",87,0)
63 ; Remarks.
"RTN","PSIVEDT",88,0)
 D 63^PSIVEDT1
"RTN","PSIVEDT",89,0)
 Q
"RTN","PSIVEDT",90,0)
 ;
"RTN","PSIVEDT",91,0)
64 ; Other Print Info.
"RTN","PSIVEDT",92,0)
 D 64^PSIVEDT1
"RTN","PSIVEDT",93,0)
 Q
"RTN","PSIVEDT",94,0)
 ;
"RTN","PSIVEDT",95,0)
66 ; Provider's comments.
"RTN","PSIVEDT",96,0)
 N DA,DIE,DIR S DA=PSIVUP,DIE="^PS(53.45,",DR=4 D ^DIE S PSGSI=X,Y=1
"RTN","PSIVEDT",97,0)
 Q
"RTN","PSIVEDT",98,0)
 ;
"RTN","PSIVEDT",99,0)
101 ; Orderable Item.
"RTN","PSIVEDT",100,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",101,0)
 . W !!?5,"This is Renewal order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",102,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",103,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",104,0)
 W !,"Orderable Item: "_$S(P("PD"):$P(P("PD"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P("PD")) Q
"RTN","PSIVEDT",105,0)
 I X]"" N DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("B")=$S(P("PD")]"":+$P(("PD"),U),1:""),DIC("S")="S PSJSCT=1 I $$DRGSC^PSIVUTL(Y,PSJSCT) K PSJSCT" D ^DIC K DIC I Y>0 S P("PD")=Y Q
"RTN","PSIVEDT",106,0)
 W $C(7),!!,"Orderable Item is required!",!! G 101
"RTN","PSIVEDT",107,0)
 Q
"RTN","PSIVEDT",108,0)
109 ; Dosage Ordered.
"RTN","PSIVEDT",109,0)
 W !,"DOSAGE ORDERED: "_$S(P("DO")]"":P("DO")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P("DO")]""&(X="")) Q
"RTN","PSIVEDT",110,0)
 I X="???" D ORFLDS^PSIVEDT1 G 109
"RTN","PSIVEDT",111,0)
 D:X]"" CHK^DIE(53.1,109,"",X,.X) I $G(X)="^" W $C(7),!!,"Enter the dosage in which the Orderable Item entered should be dispensed.",! W "Answer must be 1-20 characters in length." G 109
"RTN","PSIVEDT",112,0)
 S P("DO")=X
"RTN","PSIVEDT",113,0)
 Q
"RTN","PSIVEDT",114,0)
 ;
"RTN","PSIVEDT",115,0)
FF ; up-arrow to another field.
"RTN","PSIVEDT",116,0)
 N DIC S X=$P(X,U,2),DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I U_PSIVOK_U[(U_+Y_U)" D ^DIC K DIC S Y=+Y
"RTN","PSIVEDT",117,0)
 Q
"RTN","PSIVEDT",118,0)
 ;
"RTN","PSIVEDT",119,0)
NEWDRG ; Ask if adding a new drug.
"RTN","PSIVEDT",120,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you adding "_$P(TDRG,U,2)_" as a new "_$S(DRGT="AD":"additive",1:"solution")_" for this order",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSIVEDT",121,0)
 I Y S (DRGI,DRG(DRGT,0))=DRG(DRGT,0)+1,DRG=TDRG,DRG(DRGT,+DRGI)=+DRG_U_$P(DRG,U,2) I DRGT="SOL" S X=$G(^PS(52.7,+DRG,0)),$P(DRG(DRGT,DRG),U,3)=$P(X,U,3)
"RTN","PSIVEDT",122,0)
 Q
"RTN","PSIVLABL")
0^15^B28071183
"RTN","PSIVLABL",1,0)
PSIVLABL ;BIR/PR-PRINT OUT LABELS ;17 Aug 2001  9:33 AM
"RTN","PSIVLABL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,82,104,127**;16 DEC 97
"RTN","PSIVLABL",3,0)
 ;
"RTN","PSIVLABL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABL",8,0)
 ;
"RTN","PSIVLABL",9,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABL",10,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABL",11,0)
 ;the last fill field.
"RTN","PSIVLABL",12,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABL",13,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABL",14,0)
 ;
"RTN","PSIVLABL",15,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABL",16,0)
 N X0,PSJIO,I
"RTN","PSIVLABL",17,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABL",18,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABL",19,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABL",20,0)
 ;
"RTN","PSIVLABL",21,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABL",22,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABL",23,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVLABL",24,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABL",25,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABL",26,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABL",27,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",28,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",29,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABL",30,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABL",31,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABL",32,0)
 Q
"RTN","PSIVLABL",33,0)
ENX ;Print example label
"RTN","PSIVLABL",34,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABL",35,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVLABL",36,0)
 . S LINE=0 D RE
"RTN","PSIVLABL",37,0)
 . Q:$D(PSIVFLAG)
"RTN","PSIVLABL",38,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",39,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",40,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABL",41,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABL",42,0)
Q K PSIV,PSIVDOSE,PSIVWD,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX Q
"RTN","PSIVLABL",43,0)
RE ;
"RTN","PSIVLABL",44,0)
 K DO
"RTN","PSIVLABL",45,0)
 I PSIV1,P(4)="A"!(P(5)=0) S P(16)=PSIV1 I $G(PSIVT)]"" D
"RTN","PSIVLABL",46,0)
 . S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABL",47,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL))
"RTN","PSIVLABL",48,0)
 ;* Only if prt from ward or man list then store BCMA ID to set xref for
"RTN","PSIVLABL",49,0)
 ;* reprint later
"RTN","PSIVLABL",50,0)
 I PSIV1,$G(PSIVWMFL) S PSIVID($P(PSJBCID,"V",2))=""
"RTN","PSIVLABL",51,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABL",52,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABL",53,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVLABL",54,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABL",55,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABL",56,0)
 . D P
"RTN","PSIVLABL",57,0)
 . ;I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",58,0)
 . D MESS
"RTN","PSIVLABL",59,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABL",60,0)
 ; IV BOTTLE functionality, 3rd piece of PS(55,DFN,"IV",+ON,"AD",PSIV,0) dictates labels per LABEL RUN on which the additive will print
"RTN","PSIVLABL",61,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) I ","_$P(Y,U,3)_","[(","_P(16)_",")!('$P(Y,U,3)) D
"RTN","PSIVLABL",62,0)
 . D P
"RTN","PSIVLABL",63,0)
 . I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",64,0)
 . D MESS
"RTN","PSIVLABL",65,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABL",66,0)
 . D SOL1,P I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVLABL",67,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABL",68,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABL",69,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G INF
"RTN","PSIVLABL",70,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABL",71,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABL",72,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABL",73,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABL",74,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABL",75,0)
 I $D(MESS) S X=MESS D P
"RTN","PSIVLABL",76,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABL",77,0)
 S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABL",78,0)
 Q
"RTN","PSIVLABL",79,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",80,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",81,0)
 .. S LINE=1
"RTN","PSIVLABL",82,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",83,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",84,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",85,0)
 . K ZZ
"RTN","PSIVLABL",86,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",87,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",88,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",89,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",90,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",91,0)
 Q
"RTN","PSIVLABL",92,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABL",93,0)
MESS I '$D(MESS) I $P(^PS(52.6,+Y,0),U,9)]"" S MESS=$P(^(0),U,9)
"RTN","PSIVLABL",94,0)
 Q
"RTN","PSIVLABL",95,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABL",96,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABL",97,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABL",98,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABL",99,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABL",100,0)
 Q
"RTN","PSIVLABL",101,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABL",102,0)
 I 'PSJIO D
"RTN","PSIVLABL",103,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABL",104,0)
 . W PSJBCID
"RTN","PSIVLABL",105,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABL",106,0)
 . W !
"RTN","PSIVLABL",107,0)
 I PSJIO D
"RTN","PSIVLABL",108,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",109,0)
 . W PSJBCID
"RTN","PSIVLABL",110,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",111,0)
 Q
"RTN","PSIVOD")
0^2^B13277996
"RTN","PSIVOD",1,0)
PSIVOD ;BIR/JCH-CREATE NEW IV ORDER FROM OLD ONE ;25 Nov 98 / 3:34 PM
"RTN","PSIVOD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSIVOD",3,0)
 ;
"RTN","PSIVOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOD",5,0)
 ; Reference to ^ORX2 is supported by DBIA 867.
"RTN","PSIVOD",6,0)
 ;
"RTN","PSIVOD",7,0)
COPY(DFN,OLDON) ;Ask to enter new order.
"RTN","PSIVOD",8,0)
 N PSIVOORD,OLDP,PSIVCOPY,PSGCOPY M OLDP=P
"RTN","PSIVOD",9,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")  D ^PSJHVARS
"RTN","PSIVOD",10,0)
 I $P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) D  G Q
"RTN","PSIVOD",11,0)
 .W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSIVOD",12,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU S PSIVOORD=PSJORD
"RTN","PSIVOD",13,0)
 D FULL^VALM1
"RTN","PSIVOD",14,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSIVOD",15,0)
 G:%'=1 Q
"RTN","PSIVOD",16,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL,PSJORD=ON55,PSGORD=PSJORD
"RTN","PSIVOD",17,0)
 N OLDACT,PSIVCHG S OLDACT=PSGACT S PSGACT=PSGACT_"E",P(17)="N",(P("LOG"),P("LF"))="",P(21)="" K P("NAT")
"RTN","PSIVOD",18,0)
 S:'$G(PSGDT) PSGDT=$$DATE^PSJUTL2() S P("LOG")=PSGDT,P("PRNTON")=""
"RTN","PSIVOD",19,0)
 D ENT^PSIVCAL,ENSTOP^PSIVCAL S ND4="^^^^" F I=5,6,8,9 S $P(ND2,"^",I)=""
"RTN","PSIVOD",20,0)
 S P(17)=$S($G(PSGOEAV):"A",1:"N") S P("CLRK")=DUZ_"^"_$P($G(^VA(200,+DUZ,0)),"^")
"RTN","PSIVOD",21,0)
 S PSIVCHG=0,PSJNEWOE=0,PSIVCOPY=1,VALMBCK="Q" K PSIVACEP
"RTN","PSIVOD",22,0)
 N PSGORD,ON,ON55,PSJORD D NEW55^PSIVORFB S (PSJORD,ON)=ON55,PSIVCOPY=2
"RTN","PSIVOD",23,0)
 D EN^VALM("PSJ LM IV AC/EDIT")
"RTN","PSIVOD",24,0)
 I $G(P("NAT"))=""&($G(PSJORNAT)="") D  G Q
"RTN","PSIVOD",25,0)
 .D FULL^VALM1 W !!,"Order not copied" D PAUSE^VALM1
"RTN","PSIVOD",26,0)
 W !!,"...copying..."
"RTN","PSIVOD",27,0)
 ;
"RTN","PSIVOD",28,0)
 I '$G(PSGOEAV) D INMED
"RTN","PSIVOD",29,0)
 ;
"RTN","PSIVOD",30,0)
 D FULL^VALM1 W !!?5,"You are finished with the new order.",!,"The following ACTION prompt is for the original order." D PAUSE^VALM1
"RTN","PSIVOD",31,0)
Q ; Kill and exit.
"RTN","PSIVOD",32,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVOD",33,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVOD",34,0)
 S VALMBCK="R"
"RTN","PSIVOD",35,0)
 I '$G(PSGDT) S PSGDT=$$DATE^PSJUTL2
"RTN","PSIVOD",36,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSIVOORD) ; resets PSGACT after copy
"RTN","PSIVOD",37,0)
 D RESTORE^PSJHVARS
"RTN","PSIVOD",38,0)
 K P M P=OLDP
"RTN","PSIVOD",39,0)
 Q
"RTN","PSIVOD",40,0)
 ;
"RTN","PSIVOD",41,0)
INMED ;
"RTN","PSIVOD",42,0)
 K PSJACEPT S VALMBCK="Q",PSIVCOPY=2,PSIVCHG=0 ;D ACEDIT^PSJLIACT
"RTN","PSIVOD",43,0)
 N ON55TMP,P21TMP S ON55TMP=ON55,P21TMP=$G(P(21)) S P(21)="" I $G(ON55)["P",($G(PSJORD)["V") S ON55=PSJORD
"RTN","PSIVOD",44,0)
 D DEL55^PSIVORE2 I $G(ON55TMP)]"" S ON55=ON55TMP,P(21)=P21TMP
"RTN","PSIVOD",45,0)
 ;S (PSJORNAT,P("NAT"))="W"
"RTN","PSIVOD",46,0)
 ;D OK^PSIVORE
"RTN","PSIVOD",47,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVOD",48,0)
 L -^PS(55,DFN,"IV",+ON55) D ULK
"RTN","PSIVOD",49,0)
 I $G(P("NAT"))="" D  G Q
"RTN","PSIVOD",50,0)
 .D FULL^VALM1 W !!,"Order not copied" D PAUSE^VALM1
"RTN","PSIVOD",51,0)
 Q
"RTN","PSIVOD",52,0)
ULK ;
"RTN","PSIVOD",53,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVOD",54,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVOD",55,0)
 Q
"RTN","PSIVOD",56,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVOD",57,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVOD",58,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVOD",59,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVOD",60,0)
 S PSGOP=DFN
"RTN","PSIVOD",61,0)
 Q
"RTN","PSIVOD",62,0)
 ;
"RTN","PSIVOD",63,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVOD",64,0)
 K XXX Q
"RTN","PSIVOD",65,0)
CH ;
"RTN","PSIVOD",66,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,"
"RTN","PSIVOD",67,0)
 W !,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now."
"RTN","PSIVOD",68,0)
 Q
"RTN","PSIVOPT1")
0^5^B39564315
"RTN","PSIVOPT1",1,0)
PSIVOPT1 ;BIR/MLM-EDIT/DC ORDER (BACKDOOR) ;22 OCT 97 / 3:14 PM
"RTN","PSIVOPT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,58,101,110,127**;16 DEC 97
"RTN","PSIVOPT1",3,0)
 ;
"RTN","PSIVOPT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVOPT1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT1",6,0)
 ;
"RTN","PSIVOPT1",7,0)
E ; Edit order through Pharmacy.
"RTN","PSIVOPT1",8,0)
 NEW PSJEDFLG
"RTN","PSIVOPT1",9,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSIVOPT1",10,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVOPT1",11,0)
 Q
"RTN","PSIVOPT1",12,0)
ACCEPT ; To be called by ACCEPT^PSJLIACT
"RTN","PSIVOPT1",13,0)
 I $G(PSJEDFLG) S VALMBCK="" Q
"RTN","PSIVOPT1",14,0)
 I '$G(PSJEDIT1) D CKNEW I PSIVCHG D
"RTN","PSIVOPT1",15,0)
 .S P("OLDON")=ON55,Y=$G(^PS(55,DFN,"IV",+ON55,0)) D NOW^%DTC S P("LOG")=$E(%,1,12)
"RTN","PSIVOPT1",16,0)
 . S P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVOPT1",17,0)
 .I $G(PSGSDX)!$G(PSGFDX) Q
"RTN","PSIVOPT1",18,0)
 .I $P(Y,U,2)=P(2),$P(Y,U,3)=P(3) D ENT^PSIVCAL S X=P(2),%DT="T" D ^%DT S P(2)=$E(Y,1,12),PSJEDIT1=1 D ENSTOP^PSIVCAL
"RTN","PSIVOPT1",19,0)
 K PSJEDFLG
"RTN","PSIVOPT1",20,0)
 D OK^PSIVOPT2
"RTN","PSIVOPT1",21,0)
 I X["N" S VALMBCK="R" Q
"RTN","PSIVOPT1",22,0)
 I X["^" D GT55^PSIVORFB W !,"Order unchanged." Q
"RTN","PSIVOPT1",23,0)
 ;;I $G(P(21))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",24,0)
 I $G(P("21FLG"))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",25,0)
 ;;S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",26,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2)
"RTN","PSIVOPT1",27,0)
 ;D:ON["V" EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",28,0)
 D:ON["V" EN^PSIVORE
"RTN","PSIVOPT1",29,0)
 ;;I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",30,0)
 I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,ON55)
"RTN","PSIVOPT1",31,0)
 S PSIVACEP=1
"RTN","PSIVOPT1",32,0)
 Q
"RTN","PSIVOPT1",33,0)
 ;
"RTN","PSIVOPT1",34,0)
CKNEW ; Check if new order is to be created.
"RTN","PSIVOPT1",35,0)
 N DNE,ND,TDRG S (DRG("DRGC"),DNE,PSIVCHG)=0
"RTN","PSIVOPT1",36,0)
 Q:PSIVCHG  F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S TDRG(DRGT,+$P(DRG(DRGT,DRGI),U),DRGI)=$P(DRG(DRGT,DRGI),U,3) I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVOPT1",37,0)
 F DRGT="AD","SOL" Q:DRGT="SOL"&(P("DTYP")=1)  F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON55,DRGT,DRGI)) Q:'DRGI!DNE  D
"RTN","PSIVOPT1",38,0)
 .S X=$G(^PS(55,DFN,"IV",+ON55,DRGT,DRGI,0)),DRG("DRGC")=$G(DRG("DRGC"))+1
"RTN","PSIVOPT1",39,0)
 .I $D(TDRG(DRGT,+$P(X,U),DRGI)),$P(X,U,2)=$P(TDRG(DRGT,+$P(X,U),DRGI),U) Q
"RTN","PSIVOPT1",40,0)
 .S (PSIVCHG,DNE)=1
"RTN","PSIVOPT1",41,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",42,0)
 I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:+$G(DRG("SOL",0)))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVOPT1",43,0)
 S ND(0)=$G(^PS(55,DFN,"IV",+ON55,0)),ND("PD")=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSIVOPT1",44,0)
 N X S X=$S($P(ND(0),U,8)["@":$P($P(ND(0),U,8),"@"),1:$P(ND(0),U,8))
"RTN","PSIVOPT1",45,0)
 S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",46,0)
 S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",47,0)
 ;* S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":$P(ND(0),U,8)_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",48,0)
 ;* S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":P(8)_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",49,0)
 Q
"RTN","PSIVOPT1",50,0)
 ;
"RTN","PSIVOPT1",51,0)
UPDATE ; Update original order.
"RTN","PSIVOPT1",52,0)
 S PSIVALT=1,PSIVALCK="EN",PSIVREA="E",ON=ON55 K P("OLDON") D LOG^PSIVORAL
"RTN","PSIVOPT1",53,0)
 D SET55^PSIVORFB,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"E")
"RTN","PSIVOPT1",54,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN K X Q:'PSJIVORF
"RTN","PSIVOPT1",55,0)
 S PSJORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'PSJORIFN
"RTN","PSIVOPT1",56,0)
 S P("NAT")=""
"RTN","PSIVOPT1",57,0)
 D EN1^PSJHL2(DFN,"XX",+ON55_"V","UPDATED ORDER")
"RTN","PSIVOPT1",58,0)
 K X
"RTN","PSIVOPT1",59,0)
 Q
"RTN","PSIVOPT1",60,0)
 ;
"RTN","PSIVOPT1",61,0)
NEWORD ; DC orig. order, get new order no.
"RTN","PSIVOPT1",62,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) S X=1 W !,"Order unchanged." Q
"RTN","PSIVOPT1",63,0)
 ;;S P("RES")="E",P("OLDON")=ON55,P(16)="" K ON55 D NEW55^PSIVORFB S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON")
"RTN","PSIVOPT1",64,0)
 S P("RES")="E",P("OLDON")=ON55,P(16)=""
"RTN","PSIVOPT1",65,0)
 Q:$$NONVF()
"RTN","PSIVOPT1",66,0)
 I '($G(PSIVCOPY)=2) K ON55 D NEW55^PSIVORFB
"RTN","PSIVOPT1",67,0)
 S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON") S:($G(PSIVCOPY)=2) P("OLDON")=""
"RTN","PSIVOPT1",68,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",69,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",70,0)
 . ;;S P(21)="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",71,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",72,0)
 . D UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",73,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",74,0)
 .S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR=$S((ON55=P("NEWON")&(+ON55'=+P("OLDON"))):"113////"_P("OLDON")_";122////E",1:"114////"_P("NEWON")_";123////E") D ^DIE
"RTN","PSIVOPT1",75,0)
 .I ON55=P("NEWON") N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+P("OLDON"),"DSS")) D
"RTN","PSIVOPT1",76,0)
 ..S:CLINAPPT DR=DR_";136////"_+CLINAPPT S:$P(CLINAPPT,"^",2) DR=DR_";139////"_$P(CLINAPPT,"^",2)
"RTN","PSIVOPT1",77,0)
 .D ^DIE
"RTN","PSIVOPT1",78,0)
 .Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",79,0)
 .D:ON55=P("NEWON") SET55^PSIVORFB
"RTN","PSIVOPT1",80,0)
 .D:ON55=P("NEWON") VF1^PSJLIACT("","",0)
"RTN","PSIVOPT1",81,0)
 .D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",82,0)
 .S PSIVREA="E",PSIVAL="Order "_$S(ON55=P("OLDON"):"discontinued",1:"created")_" due to edit" S:ON55=P("OLDON") PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",83,0)
 L -^PS(55,DFN,"IV",+P("OLDON")) ;D NEWENT^PSIVORFE
"RTN","PSIVOPT1",84,0)
 K X S ON55=P("NEWON"),P(17)="A" Q:'PSJIVORF  D SET^PSIVORFE
"RTN","PSIVOPT1",85,0)
 Q
"RTN","PSIVOPT1",86,0)
 ;
"RTN","PSIVOPT1",87,0)
NEWSTOP ; Set stop date for DC and renewals.
"RTN","PSIVOPT1",88,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,0)),Y=+$P(ND,U,3),$P(^PS(55,DFN,"IV",+P("OLDON"),2),U,7)=Y,NSTOP=$S(NSTOP>Y:Y,1:NSTOP),$P(^PS(55,DFN,"IV",+ON55,0),U,3)=NSTOP
"RTN","PSIVOPT1",89,0)
 K DA,DIK S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+P("OLDON") D IX^DIK K DA,DIK
"RTN","PSIVOPT1",90,0)
 Q
"RTN","PSIVOPT1",91,0)
NONVF()   ;
"RTN","PSIVOPT1",92,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVOPT1",93,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVOPT1",94,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVOPT1",95,0)
 K DA D ENGNN^PSGOETO S (ON,P("NEWON"))=DA_"P",P(17)="N"
"RTN","PSIVOPT1",96,0)
 S (P("DO"),P("PD"))=""
"RTN","PSIVOPT1",97,0)
 D GTPD^PSIVORE2,PUT531^PSIVORFA
"RTN","PSIVOPT1",98,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",99,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",100,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",101,0)
 . D UNL^PSSLOCK(DFN,+P("OLDON")_"V")
"RTN","PSIVOPT1",102,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",103,0)
 . S DA=+ON55
"RTN","PSIVOPT1",104,0)
 . S:ON55=P("NEWON") DIE="^PS(53.1,",DR="104////"_P("OLDON")_";103////E"
"RTN","PSIVOPT1",105,0)
 . S:ON55=P("OLDON") DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="114////"_P("NEWON")_";123////E"
"RTN","PSIVOPT1",106,0)
 . D ^DIE
"RTN","PSIVOPT1",107,0)
 . Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",108,0)
 . I ON55=P("OLDON") D
"RTN","PSIVOPT1",109,0)
 .. D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",110,0)
 .. S PSIVALT="",PSIVREA="E",PSIVAL="Order discontinued due to edit" S PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",111,0)
 . D:ON55=P("NEWON") NEWNVAL^PSGAL5(ON55,4100,"","")
"RTN","PSIVOPT1",112,0)
 L -^PS(55,DFN,"IV",+P("OLDON"))
"RTN","PSIVOPT1",113,0)
 K X S (ON,ON55)=P("NEWON")
"RTN","PSIVOPT1",114,0)
 D EN1^PSJHL2(DFN,"SN",ON,"ORDER CREATED")
"RTN","PSIVOPT1",115,0)
 S X=$$LS^PSSLOCK(DFN,ON)
"RTN","PSIVOPT1",116,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVOPT1",117,0)
 I ON["P" N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+ON,"DSS")) I CLINAPPT D  K DIE,DA,DR
"RTN","PSIVOPT1",118,0)
 . S:CLINAPPT DR="136////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"139////"_$P(CLINAPPT,"^",2)_";" D ^DIE
"RTN","PSIVOPT1",119,0)
 S VALMBCK="Q"
"RTN","PSIVOPT1",120,0)
 S PSGACT="EL"
"RTN","PSIVOPT1",121,0)
 I P(17)="N",(P("OLDON")=""),(P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVOPT1",122,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVOPT1",123,0)
 Q 1
"RTN","PSIVOPT2")
0^18^B31964183
"RTN","PSIVOPT2",1,0)
PSIVOPT2 ;BIR/PR,MLM-OPTION DRIVER (CONT) ;02 Mar 99 / 9:27 AM
"RTN","PSIVOPT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,58,110,127**;16 DEC 97
"RTN","PSIVOPT2",3,0)
 ;
"RTN","PSIVOPT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVOPT2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT2",6,0)
 ;
"RTN","PSIVOPT2",7,0)
D ; Discontinue order.
"RTN","PSIVOPT2",8,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",9,0)
 ;* 8/2* D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED"),D1
"RTN","PSIVOPT2",10,0)
 I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",11,0)
 I 'PSJCOM D
"RTN","PSIVOPT2",12,0)
 .D D1
"RTN","PSIVOPT2",13,0)
 .S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVOPT2",14,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSIVOPT2",15,0)
 .I ON55'["P" N COMFLG,O,OO S (COMFLG,O)=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSIVOPT2",16,0)
 .. Q:OO=ON55  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVOPT2",17,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVOPT2",18,0)
 .I OO["V" S ON55=OO D D1 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL N PSJORD S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),PSJORD=ON55 D HL^PSIVORA Q
"RTN","PSIVOPT2",19,0)
 .I OO["U" N PSGORD,PSJORD,PSJNOO K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,PSGP=DFN,DA=+OO,DA(1)=PSGP,(PSGORD,PSJORD)=OO,PSJNOO=P("NAT") D
"RTN","PSIVOPT2",20,0)
 ..S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))  D ASET^PSGOEC,AC^PSGOEC
"RTN","PSIVOPT2",21,0)
 Q
"RTN","PSIVOPT2",22,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSIVOPT2",23,0)
 S NSTOP=$$DATE^PSJUTL2(),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSIVOPT2",24,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSIVOPT2",25,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSIVOPT2",26,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSIVOPT2",27,0)
 Q
"RTN","PSIVOPT2",28,0)
 ;
"RTN","PSIVOPT2",29,0)
R ; Renew order.
"RTN","PSIVOPT2",30,0)
 ;I PSJCOM D RIV^PSJCOMR Q
"RTN","PSIVOPT2",31,0)
 I PSJCOM D ^PSJCOMR Q
"RTN","PSIVOPT2",32,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." I $G(ERR)<2 S COMQUIT=1 Q
"RTN","PSIVOPT2",33,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG W !
"RTN","PSIVOPT2",34,0)
 I $G(PSGORQF) S COMQUIT=1 Q
"RTN","PSIVOPT2",35,0)
 ;
"RTN","PSIVOPT2",36,0)
R1 ;
"RTN","PSIVOPT2",37,0)
 I $$EXPIRED^PSGOER(DFN,ON55) D  Q
"RTN","PSIVOPT2",38,0)
 .W !?3,"  THIS ORDER HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED ADMINISTRATIONS"
"RTN","PSIVOPT2",39,0)
 .W !?20,"  AND CANNOT BE RENEWED!"
"RTN","PSIVOPT2",40,0)
 N PSJRNWDT,PSJOSTOP,OREASON S PSJRNWDT=$$DATE2^PSJUTL2(PSGDT) S:$G(ON55) PSJOSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) I '(PSJOSTOP>P(2)),$G(PSGDT) S PSJOSTOP=PSGDT
"RTN","PSIVOPT2",41,0)
 S (PSIVOK,EDIT)="25^1" S P2=P(2),P(2)=PSJRNWDT D EDIT^PSIVEDT S P(2)=P2 K P2 I X="^" Q
"RTN","PSIVOPT2",42,0)
 S P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+ON55,2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSIVOPT2",43,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSIVOPT2",44,0)
 S PSIVCHG=2
"RTN","PSIVOPT2",45,0)
 S P(17)="A",OREASON=P("RES"),P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSIVOPT2",46,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD Q
"RTN","PSIVOPT2",47,0)
 .S ON=ON55
"RTN","PSIVOPT2",48,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",P("RES")=OREASON D SET55^PSIVORFB
"RTN","PSIVOPT2",49,0)
 D:$P(^PS(55,DFN,"IV",+ON55,0),U,17)="A" RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSIVOPT2",50,0)
 I PSJIVORF,$P(^PS(55,DFN,"IV",+ON55,0),U,17)'="A" S X=$$LS^PSSLOCK(DFN,+ON55_"V") D
"RTN","PSIVOPT2",51,0)
 .D EXPOE^PSGOER(DFN,ON55)
"RTN","PSIVOPT2",52,0)
 .S P("RES")="R",PSJREN=1
"RTN","PSIVOPT2",53,0)
 .D ENUDTX^PSJOREN(DFN,ON55,"NR"),EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED"),UPDREN(DFN,ON55,PSJRNWDT,P(6),PSJOSTOP,P("NAT"))
"RTN","PSIVOPT2",54,0)
 S OD=P(2)
"RTN","PSIVOPT2",55,0)
 D VF1^PSJLIACT("","",1),UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT2",56,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSIVOPT2",57,0)
 I $G(PSJOSTOP),$G(ON55),$G(DFN) D STIX^PSIVOREN(PSJOSTOP,ON55,DFN)
"RTN","PSIVOPT2",58,0)
 Q
"RTN","PSIVOPT2",59,0)
 ;
"RTN","PSIVOPT2",60,0)
RD ; Delete for renew.
"RTN","PSIVOPT2",61,0)
 ;Q:'$G(PSJVFY)
"RTN","PSIVOPT2",62,0)
 ;D DEL55^PSIVORE2 S (ON55,P("OLDON"))=P("PON") D GT55^PSIVORFB
"RTN","PSIVOPT2",63,0)
 Q
"RTN","PSIVOPT2",64,0)
 ;
"RTN","PSIVOPT2",65,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVOPT2",66,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSIVOPT2",67,0)
 D ^PSIVCHK I $D(DUOUT) S X="^",COMQUIT=1 Q
"RTN","PSIVOPT2",68,0)
 I ERR=1 S X="N",COMQUIT=1 Q
"RTN","PSIVOPT2",69,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVOPT2",70,0)
 I $G(PSIVCHG),($G(PSIVREA)'="R") W !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVOPT2",71,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVOPT2",72,0)
 Q
"RTN","PSIVOPT2",73,0)
 ;
"RTN","PSIVOPT2",74,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSIVOPT2",75,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSIVOPT2",76,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSIVOPT2",77,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSIVOPT2",78,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSIVOPT2",79,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSIVOPT2",80,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSIVOPT2",81,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSIVOPT2",82,0)
 Q
"RTN","PSIVOPT2",83,0)
 ;
"RTN","PSIVOPT2",84,0)
UPDREN(DFN,ORD,RNWDT,PROV,OSTOPDT,PSJNOO) ;
"RTN","PSIVOPT2",85,0)
 Q:'DFN!'ORD!'RNWDT!'PROV!'OSTOPDT!(PSJNOO="")
"RTN","PSIVOPT2",86,0)
 K DR,DA,DIC,DIE,DD,DO N ND0,PSGOEORD
"RTN","PSIVOPT2",87,0)
 S DIC="^PS(55,"_DFN_",""IV"","_+ORD S ND0=$G(@(DIC_",0)")),PSGOEORD=$P(ND0,"^",21)
"RTN","PSIVOPT2",88,0)
 S DIC=DIC_",14,",DIC(0)="L",DIC("P")="55.1138DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=DFN,DA(1)=+ORD D
"RTN","PSIVOPT2",89,0)
 .S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$G(DUZ)_";2////"_$G(PROV)_";3////"_$G(OSTOPDT)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSIVOPT2",90,0)
 .Q
"RTN","PSIVORC2")
0^3^B57115915
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,49,50,65,58,85,101,110,127**;16 DEC 97
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORC2",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORC2",9,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",10,0)
 ;
"RTN","PSIVORC2",11,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",12,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",13,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",14,0)
 ;;S:PSIVCHG P(21)=""
"RTN","PSIVORC2",15,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",16,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",17,0)
 Q:$$NONVF()
"RTN","PSIVORC2",18,0)
ACTIVE ;
"RTN","PSIVORC2",19,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",20,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",21,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",22,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") S PSJOSTOP="" D RUPDATE^PSIVOREN(DFN,ON,P(2))
"RTN","PSIVORC2",23,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",24,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",25,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",26,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",27,0)
 I $G(^PS(55,DFN,"IV",+ON55,4)) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVORC2",28,0)
 L -^PS(53.1,+$G(PSJORD)) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",29,0)
 Q
"RTN","PSIVORC2",30,0)
 ;
"RTN","PSIVORC2",31,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",32,0)
 I $G(PSIVCOPY) S PSIVCHG=0 Q
"RTN","PSIVORC2",33,0)
 N ND S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",34,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",35,0)
 S ND=$S($E(P("OT"))="I":P(8)_U_$P($G(^PS(53.1,+ON,2)),U)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_$P($G(^PS(53.1,+ON,2)),U)_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",36,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",37,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_P(9)_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1  Q
"RTN","PSIVORC2",38,0)
 Q:P(17)="P"
"RTN","PSIVORC2",39,0)
 N DNE,ND,TDRG S (DRG("DRGC"),DNE)=0
"RTN","PSIVORC2",40,0)
 Q:PSIVCHG  F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S TDRG(DRGT,+$P(DRG(DRGT,DRGI),U),DRGI)=$P(DRG(DRGT,DRGI),U,3) I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVORC2",41,0)
 F DRGT="AD","SOL" Q:DRGT="SOL"&(P("DTYP")=1)  F DRGI=0:0 S DRGI=$O(^PS(53.1,+ON,DRGT,DRGI)) Q:'DRGI!DNE  D
"RTN","PSIVORC2",42,0)
 .S X=$G(^PS(53.1,+ON,DRGT,DRGI,0)),DRG("DRGC")=$G(DRG("DRGC"))+1
"RTN","PSIVORC2",43,0)
 .I $D(TDRG(DRGT,+$P(X,U),DRGI)),$P(X,U,2)=$P(TDRG(DRGT,+$P(X,U),DRGI),U) Q
"RTN","PSIVORC2",44,0)
 .S (PSIVCHG,DNE)=1
"RTN","PSIVORC2",45,0)
 Q:PSIVCHG
"RTN","PSIVORC2",46,0)
 I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:DRG("SOL",0))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVORC2",47,0)
CKPC ;
"RTN","PSIVORC2",48,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",49,0)
 .;
"RTN","PSIVORC2",50,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",51,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",52,0)
 ..N ND,TDRG F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",53,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",54,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",55,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",56,0)
 Q
"RTN","PSIVORC2",57,0)
 ;
"RTN","PSIVORC2",58,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",59,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",60,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",61,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",62,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",63,0)
 .;I P("OLDON")["P",$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",64,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",65,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",66,0)
 Q
"RTN","PSIVORC2",67,0)
 ;
"RTN","PSIVORC2",68,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",69,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",70,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",71,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",72,0)
 ;;I PSJIVORF D SET^PSIVORFE D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",73,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",74,0)
 Q
"RTN","PSIVORC2",75,0)
 ;
"RTN","PSIVORC2",76,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",77,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",78,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",79,0)
 K PSIVOI NEW FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",80,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",81,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",82,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2","QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",83,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",84,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",85,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",86,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",87,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",88,0)
 .. D RESET
"RTN","PSIVORC2",89,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",90,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",91,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",92,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",93,0)
 Q
"RTN","PSIVORC2",94,0)
 ;
"RTN","PSIVORC2",95,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",96,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",97,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",98,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",99,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",100,0)
 Q:$G(DONE)
"RTN","PSIVORC2",101,0)
 I $G(^ORD(101,+$P($G(VALM("PROTOCOL")),";"),0))["PSJ PC IV AC/EDIT ACTION" S PSIVENO=1
"RTN","PSIVORC2",102,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",103,0)
 ;;K ON55 D COMPLTE^PSIVORC1
"RTN","PSIVORC2",104,0)
 Q
"RTN","PSIVORC2",105,0)
 ;
"RTN","PSIVORC2",106,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",107,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",108,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",109,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",110,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",111,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",112,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",113,0)
 Q
"RTN","PSIVORC2",114,0)
NONVF() ; Updated 53.1 status to non-verfied after finish.
"RTN","PSIVORC2",115,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",116,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",117,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",118,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",119,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",120,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",121,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",122,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",123,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",124,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",125,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",126,0)
 D EN1^PSJHL2(DFN,"XX",ON,"UPDATED ORDER")
"RTN","PSIVORC2",127,0)
 D VF
"RTN","PSIVORC2",128,0)
 Q 1
"RTN","PSIVORC2",129,0)
NWNONVF ;Create non-vf due to edit
"RTN","PSIVORC2",130,0)
 ;D NATURE^PSIVOREN I '$D(P("NAT")) Q
"RTN","PSIVORC2",131,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",132,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",133,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",134,0)
 S P("RES")="E"
"RTN","PSIVORC2",135,0)
 ;D:P("DO")="" GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",136,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",137,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",138,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",139,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",140,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",141,0)
 D VF
"RTN","PSIVORC2",142,0)
 Q
"RTN","PSIVORC2",143,0)
VF ; Display Verify screen
"RTN","PSIVORC2",144,0)
 Q:ON'["P"
"RTN","PSIVORC2",145,0)
 K PSJIVBD
"RTN","PSIVORC2",146,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",147,0)
 S PSGACT="EL"
"RTN","PSIVORC2",148,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",149,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",150,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",151,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",152,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",153,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",154,0)
 Q
"RTN","PSIVORC2",155,0)
 ;
"RTN","PSIVORC2",156,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",157,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",158,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",159,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",160,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",161,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",162,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",163,0)
 K LYN
"RTN","PSIVORC2",164,0)
 Q
"RTN","PSIVORE")
0^7^B40899731
"RTN","PSIVORE",1,0)
PSIVORE ;BIR/PR,MLM-ORDER ENTRY ;25 Nov 98 / 3:34 PM
"RTN","PSIVORE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**18,29,50,56,58,81,110,127**;16 DEC 97
"RTN","PSIVORE",3,0)
 ;
"RTN","PSIVORE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORE",5,0)
 ; Reference to ^ORX2 is supported by DBIA #867
"RTN","PSIVORE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORE",7,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSIVORE",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSIVORE",9,0)
 ; Reference to EN^VALM is supported by DBIA 10118.
"RTN","PSIVORE",10,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSIVORE",11,0)
 ;
"RTN","PSIVORE",12,0)
 N PSJNEW,PSJOUT,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSIVORE",13,0)
 ;
"RTN","PSIVORE",14,0)
 D SITE Q:'$G(PSIVQ)  K PSIVQ S PSGOP=""
"RTN","PSIVORE",15,0)
 ;
"RTN","PSIVORE",16,0)
BEG ;Get patient and make sure he is living.
"RTN","PSIVORE",17,0)
 L +^PS(53.45,DUZ):1 E  D LOCKERR^PSJOE G Q
"RTN","PSIVORE",18,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  D ASK
"RTN","PSIVORE",19,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S X=DFN_";DPT(" D LK^ORX2 Q:'Y  D ASK S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIVORE",20,0)
 NEW PSJLK
"RTN","PSIVORE",21,0)
 F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S PSJLK='$$L^PSSLOCK(DFN,1) Q:PSJLK  D ASK,UL^PSSLOCK(DFN)
"RTN","PSIVORE",22,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSIVORE",23,0)
 G Q
"RTN","PSIVORE",24,0)
 ;
"RTN","PSIVORE",25,0)
ASK ;See if patient has been admitted.
"RTN","PSIVORE",26,0)
 I VADM(6) W !?5,"Patient has died." Q
"RTN","PSIVORE",27,0)
 I 'VAIN(4) K DIK S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("??")="^S HELP=""ADMYN"" D ^PSIVHLP1" W !,"This patient has not been admitted." D ^DIR K DIR Q:'Y
"RTN","PSIVORE",28,0)
 S:VAIN(4) WSCHADM=+VAIN(4)
"RTN","PSIVORE",29,0)
 ;
"RTN","PSIVORE",30,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSIVORE",31,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD
"RTN","PSIVORE",32,0)
 .; Mark PSJ and PSO as converted
"RTN","PSIVORE",33,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSIVORE",34,0)
 S PSJNARC=1
"RTN","PSIVORE",35,0)
 S PSGP=DFN,PSJPWD=+VAIN(4),PSIVAC="P",PSIVBR="D ^PSIVOPT" D HK,ENCHS1^PSIV Q:'$D(DFN)
"RTN","PSIVORE",36,0)
 Q
"RTN","PSIVORE",37,0)
 ;
"RTN","PSIVORE",38,0)
NEW ;Ask to enter new order.
"RTN","PSIVORE",39,0)
 D:'$D(VADM(1)) DEM^VADPT
"RTN","PSIVORE",40,0)
 K P,PSIVCHG,PSIVTYPE,PSJOE,DIR S DIR(0)="Y",DIR("A")="New order for "_VADM(1),DIR("B")="YES",DIR("??")="^S HELP=""NEWORD"" D ^PSIVHLP" D ^DIR K DIR Q:'Y
"RTN","PSIVORE",41,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVORE",42,0)
INMED K ON55,PSJOUT S (P(4),P("OT"),P("FRES"))="" D NEW55^PSIVORFB I '$D(ON55) D ULK G:'$D(PSJOE)&('$D(PSJOUT)) NEW G Q
"RTN","PSIVORE",43,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL D NEW^PSIVORE2 I $G(P(2))="" D DEL55^PSIVORE2 D ULK G:'$D(PSJOE) NEW Q
"RTN","PSIVORE",44,0)
 D OK L -^PS(55,DFN,"IV",+ON55) D ULK G:'$D(PSJOE) NEW
"RTN","PSIVORE",45,0)
 ;
"RTN","PSIVORE",46,0)
Q ; Kill and exit.
"RTN","PSIVORE",47,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVORE",48,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVORE",49,0)
 Q
"RTN","PSIVORE",50,0)
 ;
"RTN","PSIVORE",51,0)
ULK ;
"RTN","PSIVORE",52,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVORE",53,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVORE",54,0)
 Q
"RTN","PSIVORE",55,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVORE",56,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVORE",57,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVORE",58,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORE",59,0)
 S PSGOP=DFN
"RTN","PSIVORE",60,0)
 Q
"RTN","PSIVORE",61,0)
 ;
"RTN","PSIVORE",62,0)
SITE ;See if site parameters are ok.
"RTN","PSIVORE",63,0)
 K PSIVQ D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVORE",64,0)
 I '$D(PSIVSN)!('$D(PSIVSITE)) W $C(7),$C(7),!!,"You have no IV ROOM parameters ... PLEASE ... PLEASE ...",!,"Exit this package and reenter properly !!",!! Q
"RTN","PSIVORE",65,0)
 D ORPARM^PSIVOREN S PSIVQ=1
"RTN","PSIVORE",66,0)
 Q
"RTN","PSIVORE",67,0)
 ;
"RTN","PSIVORE",68,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVORE",69,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I $G(P("PD"))="" D GTPD^PSIVORE2
"RTN","PSIVORE",70,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" G DOA
"RTN","PSIVORE",71,0)
 I ERR=1 S X="N" G BAD
"RTN","PSIVORE",72,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORE",73,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORE",74,0)
 I '$G(PSIVCOPY) G:PSIVAC["R" OK1 S X="Is this O.K.: ^"_$S(ERR:"NO",1:"YES")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV
"RTN","PSIVORE",75,0)
 S PSJIVBD=1 ;var use to indicate order enter from back door
"RTN","PSIVORE",76,0)
BAD ;; I X["N" D GSTRING^PSIVORE1,^PSIVORV2,GTFLDS^PSIVORFE G OK
"RTN","PSIVORE",77,0)
 I ON55["V",($G(P(21))="") S P(17)="N"
"RTN","PSIVORE",78,0)
 I X["N" NEW PSGEBN,PSGLI S (P("INS"),PSGEBN,PSGLI)="",(PSJORD,ON)=ON55 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q" Q
"RTN","PSIVORE",79,0)
 I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVORE",80,0)
DOA I X["^" D DEL55^PSIVORE2 Q
"RTN","PSIVORE",81,0)
 Q:$$NONVF("SN")
"RTN","PSIVORE",82,0)
OK1 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),P(17)="A",ORSTS=6,ON=ON55,PSJORNP=+P(6)
"RTN","PSIVORE",83,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN
"RTN","PSIVORE",84,0)
 I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) D DEL55^PSIVORE2 Q
"RTN","PSIVORE",85,0)
 D SET55^PSIVORFB
"RTN","PSIVORE",86,0)
 I PSJIVORF,($G(P(22))=.5) D CLINIC^PSIVOREN
"RTN","PSIVORE",87,0)
 I PSJIVORF D SET^PSIVORFE S ORNATR=P("NAT"),ON=+ON55,OD=P(2) D EN1^PSJHL2(DFN,"SN",+ON55_"V","SEND ORDER NUMBER") ;,EN1^PSJHL2(DFN,"SC",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORE",88,0)
 D VF1^PSJLIACT("V","ORDER ENTERED AS ACTIVE BY ",1)
"RTN","PSIVORE",89,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORE",90,0)
 ;
"RTN","PSIVORE",91,0)
CAL ;Calculate doses.
"RTN","PSIVORE",92,0)
 ;S OD=P(2) D EN,^PSIVORE1,^PSIVOPT
"RTN","PSIVORE",93,0)
 S OD=P(2) D EN,^PSIVOPT
"RTN","PSIVORE",94,0)
 Q
"RTN","PSIVORE",95,0)
 ;
"RTN","PSIVORE",96,0)
EN ;UPdate schedual interval P(15) only on continous orders.
"RTN","PSIVORE",97,0)
 ;This includes Hyp/Adm/Continuous Syringes/Chemos =>P(5)=0
"RTN","PSIVORE",98,0)
 Q:'$D(DFN)!('$D(ON55))  Q:$P(^PS(55,DFN,"IV",+ON55,0),U,4)="P"!($P(^(0),U,5))!($P(^(0),U,23)="P")
"RTN","PSIVORE",99,0)
 D SPSOL S XXX=$P(^PS(55,DFN,"IV",+ON55,0),U,8) G:'SPSOL ENQ I XXX?1N.N.1"."1N.N1" ml/hr" S P(15)=$S('XXX:0,1:SPSOL\XXX*60+(SPSOL#XXX/XXX*60+.5)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15) G ENQ
"RTN","PSIVORE",100,0)
 S P(15)=$S('$P(XXX,"@",2):0,1:1440/$P(XXX,"@",2)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15)
"RTN","PSIVORE",101,0)
ENQ K SPSOL,XXX Q
"RTN","PSIVORE",102,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVORE",103,0)
 K XXX Q
"RTN","PSIVORE",104,0)
ENIN ;Entry for Combined IV/UD order entry. Called by PSJOE0.
"RTN","PSIVORE",105,0)
 D HOLDHDR^PSJOE
"RTN","PSIVORE",106,0)
 W !
"RTN","PSIVORE",107,0)
 N PSJOUT S (DONE,FLAG)=0,PSIVAC="PN"
"RTN","PSIVORE",108,0)
ENIN1 ;
"RTN","PSIVORE",109,0)
 N DA,DIR,PSJOE,PSJPCAF,PSJSYSL,WSCHADM S:$G(VAIN(4)) WSCHADM=VAIN(4)
"RTN","PSIVORE",110,0)
 K P,PSIVCHG,PSJCOM
"RTN","PSIVORE",111,0)
 S PSJOE=1,DIR(0)="55.01,.04O",DIR("A")="Select IV TYPE" D ^DIR
"RTN","PSIVORE",112,0)
 I X]"",X'="^",$P("^PROFILE",X)="" S PSJOEPF=X Q
"RTN","PSIVORE",113,0)
 S:$D(DTOUT) X="^" I "^"[X S PSJORQF=PSJORQF+$S(X="^":2,$G(FLAG):0,1:1),X="." Q
"RTN","PSIVORE",114,0)
 S FLAG=1,PSIVTYPE=Y,(P(5),P(23))="" I "SC"[Y D @(Y_"^PSIVORC1") S $P(PSIVTYPE,U,2)=P(23)
"RTN","PSIVORE",115,0)
 D INMED G:'$D(PSJOUT) ENIN S:$D(PSJOUT) PSJORQF=2
"RTN","PSIVORE",116,0)
 Q
"RTN","PSIVORE",117,0)
NONVF(PSJOC)  ;If file at NonVF then quit with 1
"RTN","PSIVORE",118,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORE",119,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORE",120,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORE",121,0)
 K DA D ENGNN^PSGOETO S ON=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORE",122,0)
 D GTPD^PSIVORE2
"RTN","PSIVORE",123,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) D:ON55["V" DEL55 Q 1
"RTN","PSIVORE",124,0)
 D:$G(VAIN(4))="" CLINIC^PSIVOREN
"RTN","PSIVORE",125,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORE",126,0)
 D PUT531^PSIVORFA
"RTN","PSIVORE",127,0)
 D:$G(PSJOC)]"" EN1^PSJHL2(DFN,PSJOC,ON,"SEND ORDER NUMBER")
"RTN","PSIVORE",128,0)
 D:ON55["V" DEL55
"RTN","PSIVORE",129,0)
 NEW PSJORD S (ON55,PSJORD)=ON
"RTN","PSIVORE",130,0)
 D VF^PSIVORC2
"RTN","PSIVORE",131,0)
 Q 1
"RTN","PSIVORE",132,0)
DEL55 ;
"RTN","PSIVORE",133,0)
 Q:ON55["P"
"RTN","PSIVORE",134,0)
 S X=$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORE",135,0)
 I $P(X,U,21)]"",($G(^PS(55,DFN,"IV",+ON55,2))]"") S $P(^(2),U,6)=ON,$P(^PS(53.1,+ON,0),U,25)=ON55 Q
"RTN","PSIVORE",136,0)
 NEW PSIVORFA S PSIVORFA=1
"RTN","PSIVORE",137,0)
 D DEL55^PSIVORE2
"RTN","PSIVORE",138,0)
 Q 
"RTN","PSIVORE1")
0^16^B26582171
"RTN","PSIVORE1",1,0)
PSIVORE1 ;BIR/RGY,PR,MLM-ACT,NEW ORDER ;07 AUG 97 / 2:45 PM
"RTN","PSIVORE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,110,127**;16 DEC 97
"RTN","PSIVORE1",3,0)
 ;
"RTN","PSIVORE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORE1",5,0)
 ;
"RTN","PSIVORE1",6,0)
S ;
"RTN","PSIVORE1",7,0)
 Q:+PSJSYSU'=3
"RTN","PSIVORE1",8,0)
 I $G(ON),$G(DFN) N RNDT,OP2 S RNDT=+$$LASTREN^PSJLMPRI(DFN,ON) I RNDT D
"RTN","PSIVORE1",9,0)
 .N PSGSA,CD S OD=P(2),CD=P(3) D ENP3^PSIVWL
"RTN","PSIVORE1",10,0)
 .N NEXTX,DL,NXTLBL,DAY,LBLPC S NXTLBL=0 S DAY=0,BEG=$P(+PSGSA,".") F LBLPC=1:1:$L(PSGSA," ") S NEXTX=$P(PSGSA," ",LBLPC) D
"RTN","PSIVORE1",11,0)
 ..;S:LBLPC=1 OLDX=NEXTX S:$E($P(NEXTX,".",2),1,2)<$E($P($G(OLDX),".",2),1,2) DAY=DAY+1 S:$E($P(NEXTX,".",2),1,2)>$E($P($G(OLDX),".",2),1,2) DAY($$FMADD^XLFDT(BEG,DAY)_"."_$P(NEXTX,".",2))=LBLPC
"RTN","PSIVORE1",12,0)
 ..S:LBLPC=1 OLDX=NEXTX S:$E($P(NEXTX,".",2),1,2)<$E($P($G(OLDX),".",2),1,2) DAY=DAY+1 S DAY($$FMADD^XLFDT(BEG,DAY)_"."_$P(NEXTX,".",2))=LBLPC
"RTN","PSIVORE1",13,0)
 .S D=0 F  S D=$O(DAY(D)) Q:'D!$G(NXTLBL)  D
"RTN","PSIVORE1",14,0)
 ..I D>RNDT S NXTLBL=D
"RTN","PSIVORE1",15,0)
 .I $G(NXTLBL) S OP2=P(2) S (OD,P(2))=NXTLBL Q
"RTN","PSIVORE1",16,0)
 .S (OD,P(2))=RNDT
"RTN","PSIVORE1",17,0)
 ;
"RTN","PSIVORE1",18,0)
 D NOW^%DTC S Y=% Q:P(4)=""!(P(2)="")  S:'$D(OD) OD=$S(P(2)>Y:P(2),1:Y) S PSGCNT=0,PNOW=DT K PSGSA
"RTN","PSIVORE1",19,0)
STR ;
"RTN","PSIVORE1",20,0)
 ;
"RTN","PSIVORE1",21,0)
 K PSI F I=0:0 S I=$O(^PS(59.5,PSIVSN,2,"AC",P(4),I)) Q:'I  S PSI("E",+(PNOW_"."_$P(^PS(59.5,+PSIVSN,2,I,0),U,4)))=+(PNOW_"."_$P(^(0),U))_U_I,PSI("S",+(PNOW_"."_$P(^(0),U)))=I
"RTN","PSIVORE1",22,0)
 ;
"RTN","PSIVORE1",23,0)
EC ;
"RTN","PSIVORE1",24,0)
 S PSIVEC=$O(PSI("E",Y)) I PSIVEC="" S X1=PNOW,X2=1 D C^%DTC S PNOW=X G STR
"RTN","PSIVORE1",25,0)
 I $O(PSI("S",PSIVEC))="" S X1=$O(PSI("S",0)),X2=1 D C^%DTC S X=$P(X,".") S PSI("S",+(X_"."_$P($O(PSI("S",0)),".",2)))=PSI("S",$O(PSI("S",0)))
"RTN","PSIVORE1",26,0)
 I $P(^PS(59.5,+PSIVSN,2,PSI("S",$O(PSI("S",PSIVEC))),0),U,6)=$O(PSI("S",PSIVEC)) S Y=PSIVEC G EC
"RTN","PSIVORE1",27,0)
 I PSIVEC'<P(2) S CD=$S(P(3)>PSIVEC:PSIVEC,1:P(3)) S:OD=CD CD=CD+.0001 D ENP3^PSIVWL
"RTN","PSIVORE1",28,0)
P ;
"RTN","PSIVORE1",29,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVORE1",30,0)
 ;* W:PSGCNT !!,PSGCNT," Label",$E("s",PSGCNT>1)," needed for dose",$E("s",PSGCNT>1)," due at ...",!! F Y=1:1 S X=$P(PSGSA," ",Y) D:$E(X)="." CONVER^PSIVORE2 Q:X=""  W $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)_" : "
"RTN","PSIVORE1",31,0)
 D FULL^VALM1
"RTN","PSIVORE1",32,0)
 W:PSGCNT !!,PSGCNT," Label",$E("s",PSGCNT>1)," needed for dose",$E("s",PSGCNT>1)," due at ...",!!
"RTN","PSIVORE1",33,0)
 F Y=1:1 S X=$P(PSGSA," ",Y) S:$E(X)="." X=$$CONVER^PSIVORE2(X,Y) Q:X=""  W $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)_" : "
"RTN","PSIVORE1",34,0)
 W ! D:$P(PSIVSITE,U,8) TL^PSIVORE2 D NOW^%DTC S Y=% S PNOW=Y I $D(^PS(59.5,PSIVSN,3,"AT")) W !!,"Next delivery time is " S X=$O(^PS(59.5,PSIVSN,3,"AT",PNOW#1)) S:X="" X=$O(^(X)) S X=$P(X,".",2)_$E("000",1,5-$L(X)) W X," ***" G B1
"RTN","PSIVORE1",35,0)
ACT ; Prompt and process label action.
"RTN","PSIVORE1",36,0)
B I PSGCNT<1 S:($G(RNDT)&$G(OP2)) P(2)=OP2 G K^PSIVORE2
"RTN","PSIVORE1",37,0)
B1 ;
"RTN","PSIVORE1",38,0)
 W ! S X="Action (PB"_$S($P(PSIVSITE,U,2):"S",1:"")_")^"_$S(PSGCNT<1:"B",$G(PSJPRI)="D":"B",$P(PSIVSITE,U,2)&$D(X):"S",1:"P")_"^^PRINT LABELS,BYPASS"_$S($P(PSIVSITE,U,2):",SUSPEND LABELS",1:"")
"RTN","PSIVORE1",39,0)
 D ENQ^PSIV S X=$E(X) S:X["?" HELP="ANSWER" D:X["?" ^PSIVHLP G:X["?" B1 I "B^"[X G K^PSIVORE2
"RTN","PSIVORE1",40,0)
 I "S"[X,$D(^PS(55,"PSIVSUS",PSIVSN,DFN,ON)) D C^PSIVORE2 W !!,"There ",$S(SNM>1:"are",1:"is")," already ",SNM," LABEL",$E("S",SNM>1)," suspended for this order." K SNM,DAT
"RTN","PSIVORE1",41,0)
SS ;
"RTN","PSIVORE1",42,0)
 S PSIVA=X,X="# of labels^"_PSGCNT_"^^^QUX=+QUX&(QUX?1N.N)" D ENQ^PSIV W !!
"RTN","PSIVORE1",43,0)
 S PSIVLABN=X I X["?"!(X>99) S X=PSIVA W !,"Enter # labels, less than 100, to act on." G SS
"RTN","PSIVORE1",44,0)
 I 'X W " No action taken ***" G B1
"RTN","PSIVORE1",45,0)
 I PSIVA="S",$D(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)) W $C(7),"NO Labels suspended, Wait 8 seconds and try again." D NOW^%DTC S Y=% S PNOW=Y G B1
"RTN","PSIVORE1",46,0)
 S $P(^(0),U,16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)+X,PSIVNOL=+X,PSGCNT=PSGCNT-X,PSIVDOSE=$P(PSGSA," ",1,X),PLAST=$P(PSGSA," "),PLAST="."_$P(PLAST,".",2),PSGSA=$P(PSGSA," ",X+1,999) I PLAST>$P(PSGSA," ") S UP1=1
"RTN","PSIVORE1",47,0)
 S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)
"RTN","PSIVORE1",48,0)
 I $D(UP1) S:$D(X1)#2 XX1=X1 S:$D(X2)#2 XX2=X2 S X1=$E(PSIVDOSE,1,7),X2=1 D C^%DTC S PSGSA=X_PSGSA S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 K XX2,XX1
"RTN","PSIVORE1",49,0)
 I '$D(UP1) S PSGSA=$E(PSIVDOSE,1,7)_PSGSA
"RTN","PSIVORE1",50,0)
 K UP1 I PSIVA="S" S ^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)=PSIVLABN_U_PSIVDOSE_U_P(16),Y=0,P(16)=P(16)+X W " ... ",PSIVLABN," Label",$E("s",PSIVLABN>1)," suspended !" S ACTION=5,PSIVNOL=PSIVLABN,TRACK=4 D ^PSIVLTR,NOW^%DTC S Y=% S PNOW=Y K X G B
"RTN","PSIVORE1",51,0)
 S IONOFF="" I PSIVPL=ION S P16=P(16),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:"APSC"[P(4) S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16) G B
"RTN","PSIVORE1",52,0)
 W ! S P16=P(16),P(16)=P(16)+X,ZTDTH=$H,ZTIO=PSIVPL F Y="IONOFF","P16","PSIVDOSE","PSIVSITE","PSIVSN","PSIVNOL","DFN","ON","PSJSYSL","PSJSYSW0","PSJSYSW","PSJSYSP","PSJSYSP0","PSJSYSU" S ZTSAVE(Y)=""
"RTN","PSIVORE1",53,0)
 S ZTDESC="PRINT IV LABELS",ZTRTN="DEQ^PSIVORE2" D ^%ZTLOAD G B
"RTN","PSIVORE1",54,0)
GSTRING ; Setup edit "^" string.
"RTN","PSIVORE1",55,0)
 S PSIVOK="57^58^59^10^3^25^26^39^1^64^63"_$S($E(P("OT"))="I":"^101",1:"")
"RTN","PSIVORE1",56,0)
 S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("OT")="I":"101^",1:"")_"64^63"
"RTN","PSIVORE1",57,0)
 ;* S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("DTYP")=1:"101^",1:"")_"64^63"
"RTN","PSIVORE1",58,0)
 Q
"RTN","PSIVOREN")
0^21^B25008100
"RTN","PSIVOREN",1,0)
PSIVOREN ;BIR/MLM-UTILITIES FOR IV FLUIDS - OE/RR INTERFACE ; 25 Sep 98 / 2:00 PM
"RTN","PSIVOREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,69,110,127**;16 DEC 97
"RTN","PSIVOREN",3,0)
 ;
"RTN","PSIVOREN",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOREN",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVOREN",6,0)
 ; Reference to ^DIE is suppoted by DBIA 10018.
"RTN","PSIVOREN",7,0)
 ;
"RTN","PSIVOREN",8,0)
ENCPP ; Check Package Parameter
"RTN","PSIVOREN",9,0)
 D ORPARM I 'PSJORF W !!,"Inpatient Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV or Unit Dose orders."
"RTN","PSIVOREN",10,0)
 I 'PSJIVORF W !!,"IV Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV orders."
"RTN","PSIVOREN",11,0)
 I 'PSJORF!'PSJIVORF S PSJIVORF="" D DONE^PSIVORA1 Q
"RTN","PSIVOREN",12,0)
 S PSJORL=ORL,PSJORPF=0,P("OT")="F^",PSJORNP=ORNP
"RTN","PSIVOREN",13,0)
 ;; S PSJORL=ORL,PSJORPF=0,P("OT")="F^"_$O(^ORD(101,"B","PSJI OR PAT FLUID OE",0))_";ORD(101,",PSJORNP=ORNP
"RTN","PSIVOREN",14,0)
 Q
"RTN","PSIVOREN",15,0)
 ;
"RTN","PSIVOREN",16,0)
PS ; Check if MD is authorized to write med. orders.
"RTN","PSIVOREN",17,0)
 S PSJORPF=0 S:PSJORNP X=$G(^VA(200,+PSJORNP,"PS")) Q:$S('PSJORNP:0,'X:0,'$P(X,U,4):1,$P(X,U,4)>DT:1,1:0)  D
"RTN","PSIVOREN",18,0)
 .W !?2,"(The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications.)"
"RTN","PSIVOREN",19,0)
 .K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSIV=$G(^(""PS"")) I PSIV,$S($P(PSIV,""^"",4)="""":1,DT<$P(PSIV,""^"",4):1,1:0)" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSIVOREN",20,0)
 .K DIC S:Y'>0 PSJORPF=11 S:Y>0 (ORNP,PSJORNP)=+Y Q
"RTN","PSIVOREN",21,0)
 Q
"RTN","PSIVOREN",22,0)
 ;
"RTN","PSIVOREN",23,0)
RUPDATE(DFN,ON,NSTRT) ;
"RTN","PSIVOREN",24,0)
 ; Update renewal orders (called from Pharmacy options).
"RTN","PSIVOREN",25,0)
 N DA,DIE,DR,ND,NSTOP,OSTOP,NOO,ORETURN,PSIVACT,PSIVAL,PSIVALCK,PSJOSTRT S DIE="^PS(55,"_DFN_","
"RTN","PSIVOREN",26,0)
 I ON["P" S OLDON=$P($G(^PS(53.1,+ON,0)),"^",25),NOO=$P($G(^PS(53.1,+ON,.2)),"^",3)
"RTN","PSIVOREN",27,0)
 I ON["V" S OLDON=ON,NOO=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",5)
"RTN","PSIVOREN",28,0)
 I ON["U" S OLDON=$P($G(^PS(55,DFN,5,+ON,0)),U,25)
"RTN","PSIVOREN",29,0)
 I OLDON["P" S OLDON=$P($G(^PS(53.1,+OLDON,0)),U,25)
"RTN","PSIVOREN",30,0)
 I OLDON["V" S ON55=OLDON,X=$G(^PS(55,DFN,"IV",+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$S(($G(PSJOSTOP)>PSJOSTRT):PSJOSTOP,1:$P($G(^(0)),U,3)),DIE=DIE_"""IV"",",DR="100////A",PSIVACT=1
"RTN","PSIVOREN",31,0)
 I OLDON["U" S X=$G(^PS(55,DFN,5,+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$P(X,U,4),DIE=DIE_"5,"
"RTN","PSIVOREN",32,0)
 S NSTOP=+$S($G(P(3)):P(3),1:0),DA=+OLDON,DA(1)=DFN I 'NSTOP W !,"CAN'T RENEW THIS ORDER!" D PAUSE^VALM1 Q
"RTN","PSIVOREN",33,0)
 ;I OSTOP>NSTOP W !,"NEW STOP DATE IS LESS THAN PREVIOUS STOP DATE" D PAUSE^VALM1
"RTN","PSIVOREN",34,0)
 ;
"RTN","PSIVOREN",35,0)
 I ON["V"!(ON["P") D EXPOE^PSGOER(DFN,ON)
"RTN","PSIVOREN",36,0)
 ;
"RTN","PSIVOREN",37,0)
 S DR=DR_";"_$S(OLDON["V":.03,OLDON["U":34,1:25)_"////"_NSTOP_";"_$S(OLDON["V":"114////@;123////@",1:"105////@;107////@") D ^DIE
"RTN","PSIVOREN",38,0)
 I ON["P" S DIE="^PS(53.1,",DR="28////A;105////@;",DA=+ON D ^DIE D
"RTN","PSIVOREN",39,0)
 .N NOEORD,VN,VNDT S NOEORD=$P(^PS(53.1,+ON,0),U,21) S VN=$P($G(^PS(53.1,+ON,4)),"^") I VN S VNDT=$P($G(^PS(53.1,+ON,4)),"^",2)
"RTN","PSIVOREN",40,0)
 .I NOEORD K DA,DR,DIE S DIE="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55,DR="110////"_+NOEORD D
"RTN","PSIVOREN",41,0)
 ..S DR=DR_";16////"_$S($G(VN):VN,1:"@")_";17////"_$S($G(VNDT):VNDT,1:"@")_";" D ^DIE I NOEORD[";" S $P(^PS(53.1,+ON,0),U,21)=NOEORD
"RTN","PSIVOREN",42,0)
 ..I $G(VN) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVOREN",43,0)
 I ON["V" S DIE="^PS(55,DFN,""IV"",",DR="100////A;114////@;16////@;17////@",DA=+ON55 D ^DIE
"RTN","PSIVOREN",44,0)
 N RDT S RDT=$P($G(@("^PS(53.1,"_+ON_",14,0)")),U,3) S:RDT RDT=+(^(RDT,0)) S RDT=$S(RDT:RDT,1:$$DATE^PSJUTL2) I RDT D UPDREN^PSIVOPT2(DFN,OLDON,RDT,+P(6),+$G(OSTOP),$G(NOO))
"RTN","PSIVOREN",45,0)
 ;
"RTN","PSIVOREN",46,0)
 I OLDON["V" S (ON,ON55)=OLDON,PSIVAL="",PSIVALCK="STOP",(P("FRES"),PSIVREA)="R" D LOG^PSIVORAL D
"RTN","PSIVOREN",47,0)
 .I $G(ON55),$G(OSTOP),$G(DFN) D STIX(OSTOP,OLDON,DFN)
"RTN","PSIVOREN",48,0)
 .I $G(PSJOSTOP),$G(NSTOP) I NSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),"^",3),$D(^PS(55,"AIV",NSTOP,DFN,+ON55)) K ^PS(55,"AIV",PSJOSTOP,DFN,+ON55)
"RTN","PSIVOREN",49,0)
 D:'$D(PSJIVORF) ORPARM Q:'PSJIVORF
"RTN","PSIVOREN",50,0)
 Q
"RTN","PSIVOREN",51,0)
 ;
"RTN","PSIVOREN",52,0)
RUPTXT(DFN,OLDON) ;
"RTN","PSIVOREN",53,0)
 ;Update ORTX( in OE/RR
"RTN","PSIVOREN",54,0)
 I OLDON'["V" ;; D ENUDTX^PSJOREN(DFN,OLDON,"OR") S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",55,0)
 I OLDON["V" S P("FRES")="R" D GTPC^PSIVORFB(OLDON),SORTX^PSIVORFE S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",56,0)
 ;; F X=0:0 S X=$O(ORTX(X)) Q:'X  S ORETURN("ORTX",X)=ORTX(X)
"RTN","PSIVOREN",57,0)
 Q
"RTN","PSIVOREN",58,0)
 ;
"RTN","PSIVOREN",59,0)
ORPARM ;Check if inpatient pkges are on.
"RTN","PSIVOREN",60,0)
 S (PSJORF,PSJIVORF)=1
"RTN","PSIVOREN",61,0)
 Q
"RTN","PSIVOREN",62,0)
 ;
"RTN","PSIVOREN",63,0)
NATURE ; Ask nature of order.
"RTN","PSIVOREN",64,0)
 I '+$G(PSJSYSU) S P("NAT")="W" Q
"RTN","PSIVOREN",65,0)
 K P("NAT") NEW X
"RTN","PSIVOREN",66,0)
 I $D(XQORNOD(0)) S X=$E($P(XQORNOD(0),U,3),1,1) S:X="" X="E"
"RTN","PSIVOREN",67,0)
 ;* S:'$D(X) X="N" S:X="A" X="E"
"RTN","PSIVOREN",68,0)
 S:'$D(X) X="N" S:"AF"[X X="E"
"RTN","PSIVOREN",69,0)
 I $G(PSIVCOPY) S X="N"
"RTN","PSIVOREN",70,0)
 S P("NAT")=$$ENNOO^PSJUTL5(X)
"RTN","PSIVOREN",71,0)
 K:P("NAT")=-1 P("NAT")
"RTN","PSIVOREN",72,0)
 Q
"RTN","PSIVOREN",73,0)
CLINIC ;Ask clinic where outpt is being seen for DSS
"RTN","PSIVOREN",74,0)
 K P("CLIN") NEW X1,X2,X,PSJDT,DIC,Y
"RTN","PSIVOREN",75,0)
 S X1=DT,X2=-7 D C^%DTC S PSJDT=X
"RTN","PSIVOREN",76,0)
 S DIC("S")="I $P($G(^SC(Y,0)),U,3)=""C"",$S('$P($G(^(""I"")),U):1,($P($G(^(""I"")),U)>PSJDT):1,(($P($G(^(""I"")),U)<PSJDT)&($P($G(^(""I"")),U,2)]"""")&(DT>$P($G(^(""I"")),U,2))):1,1:0)"
"RTN","PSIVOREN",77,0)
 S DIC=44,DIC(0)="QEAZ",DIC("A")="Select CLINIC LOCATION: " D ^DIC
"RTN","PSIVOREN",78,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,1:0) Q
"RTN","PSIVOREN",79,0)
 S:+Y>0 P("CLIN")=+Y,$P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=+Y
"RTN","PSIVOREN",80,0)
 Q
"RTN","PSIVOREN",81,0)
 ;
"RTN","PSIVOREN",82,0)
STIX(OST,OON,DFN) ; Check start index, cleanup old start
"RTN","PSIVOREN",83,0)
 I $G(OST),$G(OON) S OS="" F  S OS=$O(^PS(55,DFN,"IV","AIS",OS)) Q:'OS  D
"RTN","PSIVOREN",84,0)
 . Q:'$D(^PS(55,DFN,"IV","AIS",OS,+OON))
"RTN","PSIVOREN",85,0)
 . I $P($G(^PS(55,DFN,"IV",+OON,0)),"^",3)'=OS K ^PS(55,DFN,"IV","AIS",OS,+OON)
"RTN","PSIVOREN",86,0)
 Q
"RTN","PSJAC")
0^27^B14263824
"RTN","PSJAC",1,0)
PSJAC ;BIR/CML3-INPATIENT INFORMATION ;28 Apr 98 / 9:02 AM
"RTN","PSJAC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,10,50,127**;16 DEC 97
"RTN","PSJAC",3,0)
 ;
"RTN","PSJAC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJAC",5,0)
 ;
"RTN","PSJAC",6,0)
 S DFN=PSGP,PSJACPF=1 G CHK
"RTN","PSJAC",7,0)
 ;
"RTN","PSJAC",8,0)
ENBOTH ;
"RTN","PSJAC",9,0)
 S PSJACPF=11 G CHK
"RTN","PSJAC",10,0)
 ;
"RTN","PSJAC",11,0)
ENIV ;
"RTN","PSJAC",12,0)
 N I,J,JJ,ON,PSJRBXX,X,X1,X2,X,Y S PSJACPF=10,PSGP=DFN
"RTN","PSJAC",13,0)
 ;
"RTN","PSJAC",14,0)
CHK ;
"RTN","PSJAC",15,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJAC",16,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,$S($E(IOST,1)="C":1,1:0))
"RTN","PSJAC",17,0)
 ;/Commented out in PSJ*5*50.  No longer needed
"RTN","PSJAC",18,0)
 ;/F  S PSJRBXX=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+PSJRBXX'<0  D
"RTN","PSJAC",19,0)
 ;/.I +PSJRBXX=-1 W:$E(IOST,1)="C" !,$P(PSJRBXX,"^",2) H 4
"RTN","PSJAC",20,0)
 ;Converting IV order to new OI with POE if not done so when installed PSJ*5*50
"RTN","PSJAC",21,0)
 D CNIV^PSJUTL1(DFN)
"RTN","PSJAC",22,0)
 ;I $D(^PS(55,DFN,0)),'$P($G(^PS(55,DFN,0)),U,6) D EN^PSOHLUP(DFN)
"RTN","PSJAC",23,0)
 S VA200=1 D INP^VADPT
"RTN","PSJAC",24,0)
 I VAIN(4) S:PSJACPF#2 PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJAC",25,0)
 S VAIP("D")="L" D IN5^VADPT G:PSJACPF[0 CNV
"RTN","PSJAC",26,0)
 S PSJPCAF="",PSJPAD=+VAIP(13,1)
"RTN","PSJAC",27,0)
 S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_$$ENDTC^PSGMI(PSGID) S:X PSJPDD=PSJPDD_"^1"
"RTN","PSJAC",28,0)
 ;
"RTN","PSJAC",29,0)
CNV ;
"RTN","PSJAC",30,0)
 D DEM^VADPT,HTWT(PSGP)
"RTN","PSJAC",31,0)
 I PSJACPF#2 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJAC",32,0)
 I PSJACPF#2 D
"RTN","PSJAC",33,0)
 .I $D(PSJY2K) D  Q
"RTN","PSJAC",34,0)
 ..F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC2^PSGMI(+@X)
"RTN","PSJAC",35,0)
 .F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJAC",36,0)
 ;
"RTN","PSJAC",37,0)
WP ; ward parameters
"RTN","PSJAC",38,0)
 G:$D(PSJACNWP) DONE S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJAC",39,0)
 ;S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$P(PSJSYSW0,"^",X*4+12) G:$D(PSJACND) DONE
"RTN","PSJAC",40,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16)) G:$D(PSJACND) DONE
"RTN","PSJAC",41,0)
 I PSJSYSL D
"RTN","PSJAC",42,0)
 .S:X X='$P($G(PSJSYSP0),"^",10) S IOP=$S($P($G(PSJSYSP0),"^",13)]"":$P($G(PSJSYSP0),"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJAC",43,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJAC",44,0)
 ;
"RTN","PSJAC",45,0)
DONE ;
"RTN","PSJAC",46,0)
 I PSJACPF<10 K VADM,VAIN,VAIP
"RTN","PSJAC",47,0)
 K PSJACPF,PSGID,PSGOD,VA200,X
"RTN","PSJAC",48,0)
 Q
"RTN","PSJAC",49,0)
HTWT(DFN) ; Get patient's height and weight from Vitals.
"RTN","PSJAC",50,0)
 S (PSJPWTD,PSJPHTD)=""
"RTN","PSJAC",51,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I  S GMRVSTR="HT" D
"RTN","PSJAC",52,0)
 . D EN6^GMRVUTL S PSJPHT=$P(X,U,8) S:PSJPHT PSJPHT=$J(2.54*PSJPHT,0,2),PSJPHTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",53,0)
 . S GMRVSTR="WT" D EN6^GMRVUTL S PSJPWT=$P(X,U,8) S:PSJPWT PSJPWT=$J(PSJPWT/2.2,0,2),PSJPWTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",54,0)
 F X="PSJPWT","PSJPHT" S:'$G(@X) @X="______"
"RTN","PSJAC",55,0)
 F X="PSJPWTD","PSJPHTD" S:$G(@X)="" @X="(________)"
"RTN","PSJAC",56,0)
 Q
"RTN","PSJAC",57,0)
PSJAC2(PSJY2K)     ;
"RTN","PSJAC",58,0)
 D PSJAC Q
"RTN","PSJCOM1")
0^17^B47079463
"RTN","PSJCOM1",1,0)
PSJCOM1 ;BIR/CML3-DISPLAY COMPLEX ORDERS FOR DISCONTINUE ;02 Feb 2001  12:20 PM
"RTN","PSJCOM1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSJCOM1",3,0)
 ;
"RTN","PSJCOM1",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM1",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM1",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJCOM1",8,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSJCOM1",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM1",10,0)
 ;
"RTN","PSJCOM1",11,0)
CMPLX(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",12,0)
 D PAUSE K PSJCM
"RTN","PSJCOM1",13,0)
 N PSJLINE,PSX,PSCM
"RTN","PSJCOM1",14,0)
 S PSJLINE=1
"RTN","PSJCOM1",15,0)
 I PSGORD["P" N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",ON,PSJO)) Q:'PSJO  D
"RTN","PSJCOM1",16,0)
 .Q:PSJO=+PSGORD  S PSJOO=PSGORD D DSPLORDU(PSGP,PSJO_"P") S PSJCM(PSJO_"P",PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",17,0)
 I PSGORD'["P" N PSJO,PSJOO S PSJOO="",PSJO=0 F  S PSJO=$O(^PS(55,"ACX",ON,PSJO)) Q:'PSJO  F  S PSJOO=$O(^PS(55,"ACX",ON,PSJO,PSJOO)) Q:PSJOO=""  D
"RTN","PSJCOM1",18,0)
 .Q:PSJOO=PSGORD  D:PSJOO["U" DSPLORDU(PSGP,PSJOO) D:PSJOO["V" DSPLORDV(PSGP,PSJOO) S PSJCM(PSJOO,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",19,0)
 N ON S ON="" F  S ON=$O(PSJCM(ON)) Q:ON=""  D
"RTN","PSJCOM1",20,0)
 .W ! F PSX=0:0 S PSX=$O(PSJCM(ON,PSX)) Q:'PSX  D
"RTN","PSJCOM1",21,0)
 ..W !,PSJCM(ON,PSX) D:'(PSX#6) PAUSE
"RTN","PSJCOM1",22,0)
 W !
"RTN","PSJCOM1",23,0)
 Q
"RTN","PSJCOM1",24,0)
 ;
"RTN","PSJCOM1",25,0)
CMPLX2(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",26,0)
 Q:$G(PSGORD)'["U"
"RTN","PSJCOM1",27,0)
 N PSJLINE S PSJLINE=0
"RTN","PSJCOM1",28,0)
 D FULL^VALM1
"RTN","PSJCOM1",29,0)
 D DSPLORDU(PSGP,PSGORD)
"RTN","PSJCOM1",30,0)
 W ! S PSJLINE="" F  S PSJLINE=$O(PSJCM(PSGORD,PSJLINE)) Q:PSJLINE=""  W !,PSJCM(PSGORD,PSJLINE) D:'((PSJLINE+1)#6) PAUSE
"RTN","PSJCOM1",31,0)
 D EN^PSGPEN(PSGORD)
"RTN","PSJCOM1",32,0)
 W !
"RTN","PSJCOM1",33,0)
 Q
"RTN","PSJCOM1",34,0)
 ;
"RTN","PSJCOM1",35,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJCOM1",36,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJCOM1",37,0)
 Q
"RTN","PSJCOM1",38,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJCOM1",39,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJCOM1",40,0)
 Q
"RTN","PSJCOM1",41,0)
 ;
"RTN","PSJCOM1",42,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJCOM1",43,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y K PSJCM
"RTN","PSJCOM1",44,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJCOM1",45,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJCOM1",46,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJCOM1",47,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJCOM1",48,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJCOM1",49,0)
 S STAT=$P(NODE0,U,9)
"RTN","PSJCOM1",50,0)
 D NOW^%DTC I "A"[STAT I $P(NODE2,U,4)<% D EXPIRE S STAT="E"
"RTN","PSJCOM1",51,0)
 I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJCOM1",52,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJCOM1",53,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJCOM1",54,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJCOM1",55,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJCOM1",56,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJCOM1",57,0)
 . S PSJCM(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJCOM1",58,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJCOM1",59,0)
 Q
"RTN","PSJCOM1",60,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJCOM1",61,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJCOM1",62,0)
 S TYP="?" I ON["V" D
"RTN","PSJCOM1",63,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJCOM1",64,0)
 .D NOW^%DTC I "A"[P(17) I P(3)<% D EXPIRE S P(17)="E"
"RTN","PSJCOM1",65,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJCOM1",66,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",67,0)
 S PSJCT=0,PSJL=""
"RTN","PSJCOM1",68,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",69,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJCOM1",70,0)
 Q
"RTN","PSJCOM1",71,0)
SOL ;
"RTN","PSJCOM1",72,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJCOM1",73,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJCOM1",74,0)
 Q
"RTN","PSJCOM1",75,0)
PIVAD ; Print IV Additives.
"RTN","PSJCOM1",76,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJCOM1",77,0)
 Q
"RTN","PSJCOM1",78,0)
 ;
"RTN","PSJCOM1",79,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJCOM1",80,0)
 K PSJIVFLG
"RTN","PSJCOM1",81,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJCOM1",82,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJCOM1",83,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJCOM1",84,0)
 Q
"RTN","PSJCOM1",85,0)
SETTMP ;
"RTN","PSJCOM1",86,0)
 S PSJCM(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJCOM1",87,0)
 Q
"RTN","PSJCOM1",88,0)
PAUSE ;
"RTN","PSJCOM1",89,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJCOM1",90,0)
 Q
"RTN","PSJCOM1",91,0)
NEW ;
"RTN","PSJCOM1",92,0)
 Q:'PSJCOM
"RTN","PSJCOM1",93,0)
 Q:PSGORD'["P"
"RTN","PSJCOM1",94,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM1",95,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCOM1",96,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",27)="E",$P(^(0),"^",9)="DE"
"RTN","PSJCOM1",97,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSJCOM1",98,0)
 ;I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSJCOM1",99,0)
 K ND4,DA D NOW^%DTC S PSGDT=+$E(%,1,12),DA=+PSGORD
"RTN","PSJCOM1",100,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM1",101,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSJCOM1",102,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSJCOM1",103,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJCOM1",104,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSJCOM1",105,0)
 ;I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSJCOM1",106,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSJCOM1",107,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSJCOM1",108,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSJCOM1",109,0)
 S F="^TMP(""PSJCOM2"","_$J_","_DA_",",@(F_"0)")=ND
"RTN","PSJCOM1",110,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",111,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2) S:PSJCOM]"" $P(^(.2),"^",8)=PSJCOM
"RTN","PSJCOM1",112,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSJCOM1",113,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",114,0)
 S @(F_"2)")=$P(ND2,"^",1,6),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSJCOM1",115,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",116,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSJCOM1",117,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSJCOM1",118,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",119,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSJCOM1",120,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSJCOM1",121,0)
 S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSJCOM1",122,0)
 W "."
"RTN","PSJCOM1",123,0)
OUT ;
"RTN","PSJCOM1",124,0)
 K PSGOETOF
"RTN","PSJCOM1",125,0)
DONE ;
"RTN","PSJCOM1",126,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSJCOM1",127,0)
 Q
"RTN","PSJCOM1",128,0)
EXPIRE ;Change status of order to expired and send notice to OE/RR
"RTN","PSJCOM1",129,0)
 N DA,DIE,DR,PSGPO,PSIVACT
"RTN","PSJCOM1",130,0)
 Q:'$G(PSJOO)!($G(PSJOO)["P")
"RTN","PSJCOM1",131,0)
 S STATUS="E",(PSGPO,PSIVACT)=1,DA=+PSJOO,DA(1)=PSGP,DIE=$S(PSJOO["V":"^PS(55,"_PSGP_",""IV"",",1:"^PS(55,"_PSGP_",5,"),DR=$S(PSJOO["V":"100////E",1:"28////E") D ^DIE
"RTN","PSJCOM1",132,0)
 D EN1^PSJHL2(PSGP,"SC",PSJOO)
"RTN","PSJCOM1",133,0)
 Q
"RTN","PSJCOMR")
0^26^B74911217
"RTN","PSJCOMR",1,0)
PSJCOMR ;BIR/CML3-RENEW A COMPLEX ORDER SERIES ;07 MAR 96 / 1:23 PM
"RTN","PSJCOMR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSJCOMR",3,0)
 ;
"RTN","PSJCOMR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSJCOMR",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSJCOMR",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSJCOMR",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMR",8,0)
 ;
"RTN","PSJCOMR",9,0)
 ; renew a complex order series
"RTN","PSJCOMR",10,0)
 Q:'PSJCOM  K COMQUIT
"RTN","PSJCOMR",11,0)
 W !!,"This order is part of a complex order. If you "_$S($P(PSJSYSP0,"^",3):"RENEW",1:"MARK")_" this order the",!,"following orders will be "_$S($P(PSJSYSP0,"^",3):"RENEWED",1:"MARKED")_" too." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSJCOMR",12,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS COMPLEX ORDER SERIES",1:"MARK THIS COMPLEX ORDER SERIES FOR RENEWAL"),DIR("B")="YES"
"RTN","PSJCOMR",13,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this complex order series",1:"mark this complex order series for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR K DIR
"RTN","PSJCOMR",14,0)
 I 'Y N DIR D ABORT G DONE
"RTN","PSJCOMR",15,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSJCOMR",16,0)
 I '$D(DIRUT),PSJSYSU I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSJCOMR",17,0)
 D DONE,ABORT^PSGOEE
"RTN","PSJCOMR",18,0)
 Q
"RTN","PSJCOMR",19,0)
 ;
"RTN","PSJCOMR",20,0)
UNMARK ;  
"RTN","PSJCOMR",21,0)
 W !!,"THIS COMPLEX ORDER SERIES HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSJCOMR",22,0)
 S DIR("?",1)="  Answer 'YES' to unmark this complex order series.  Answer 'NO' (or '^') to leave the complex",DIR("?")="order series marked.  (An answer is required.)" D ^DIR
"RTN","PSJCOMR",23,0)
 I 'Y N DIR D ABORT^PSGOEE G DONE
"RTN","PSJCOMR",24,0)
 N PSGORD,XX,X S XX=0,X="" F  S XX=$O(^PS(55,"ACX",PSJCOM,XX)) Q:'XX  F  S X=$O(^PS(55,"ACX",PSJCOM,XX,X)) Q:X=""  S PSGORD=X D
"RTN","PSJCOMR",25,0)
 .S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJCOMR",26,0)
 .S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSJCOMR",27,0)
 ;
"RTN","PSJCOMR",28,0)
DONE ;
"RTN","PSJCOMR",29,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSJCOMR",30,0)
 ;
"RTN","PSJCOMR",31,0)
NEW ; get info, write record
"RTN","PSJCOMR",32,0)
 K ^TMP("PSJCOMR",$J)
"RTN","PSJCOMR",33,0)
 N DUOUT,PSGORD,TMPP,TMPO,PS55ACX,TMPDUZ,TMPOE,COMQUIT S TMPP=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",34,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP!$G(COMQUIT)  D
"RTN","PSJCOMR",35,0)
 . S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""!$G(COMQUIT)  S PSGORD=TMPO D:PSGORD["U" NEWUD  I PSGORD["V" D NEWIV
"RTN","PSJCOMR",36,0)
 I $G(COMQUIT)!$G(DUOUT)  W !!,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJCOMR",37,0)
 I '$G(COMQUIT)&'$G(DUOUT) S TMPOE=0 F  S TMPOE=$O(^PS(55,"ACX",PSJCOM,TMPOE)) Q:TMPOE=""  S TMPO=0 F  S TMPO=$O(^PS(55,"ACX",PSJCOM,TMPOE,TMPO)) Q:'TMPO!$G(COMQUIT)  S PSGORD=TMPO D
"RTN","PSJCOMR",38,0)
 . K VSTRING S VSTRING=$G(^TMP("PSJCOMR",$J,PSJCOM,TMPO)) I PSGORD'=$P(VSTRING,"^",2) S COMQUIT=1 Q
"RTN","PSJCOMR",39,0)
 . S PSGP=$P(VSTRING,"^"),PSGDT=$P(VSTRING,"^",3),PSGOEPR=$P(VSTRING,"^",4),PSGOFD=$P(VSTRING,"^",5),PSGFD=$P(VSTRING,"^",6),PSJNOO=$P(VSTRING,"^",7),TMPDUZ=$P(VSTRING,"^",8)
"RTN","PSJCOMR",40,0)
 . D:PSGORD["U" FILEUD D:PSGORD["V" FILEIV
"RTN","PSJCOMR",41,0)
 K ^TMP("PSJCOMR",$J),VSTRING
"RTN","PSJCOMR",42,0)
 Q
"RTN","PSJCOMR",43,0)
NEWUD N PSJABT,PSGDRG,PSJREN,X,XX,PSGORDP,UDSTRING S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSJCOMR",44,0)
 D OC55
"RTN","PSJCOMR",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSJCOMR",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSJCOMR",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSJCOMR",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSJCOMR",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I '$D(PSGFOK(106)) D DONE,ABORT^PSGOEE S VALMBCK="R" Q
"RTN","PSJCOMR",50,0)
 W !!,"...updating order..." N PSGOEAV S PSGOEAV=+PSJSYSU,PSGOORD=PSGORD,PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGSI=$G(^(6)) W "."
"RTN","PSJCOMR",51,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6)
"RTN","PSJCOMR",52,0)
 S PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG),PSGDO=$P(PSGOER1,"^",2),PSGSCH=$P(PSGOER2,"^")
"RTN","PSJCOMR",53,0)
 S PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSJCOMR",54,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSJCOMR",55,0)
 S UDSTRING=PSGP_"^"_PSGORD_"^"_PSGDT_"^"_PSGOEPR_"^"_PSGOFD_"^"_PSGFD_"^"_PSJNOO F II=1:1:$L(UDSTRING,"^") I $P(UDSTRING,"^",II)="" K UDSTRING
"RTN","PSJCOMR",56,0)
 I '$D(UDSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",57,0)
 S:$G(DUZ) UDSTRING=UDSTRING_"^"_DUZ D TEMP(UDSTRING)
"RTN","PSJCOMR",58,0)
 Q
"RTN","PSJCOMR",59,0)
 ;
"RTN","PSJCOMR",60,0)
FILEUD ;
"RTN","PSJCOMR",61,0)
 ;Changed the reference to the type "O" for order numbers previously in v4.5
"RTN","PSJCOMR",62,0)
 N X,PSJORD,PSGOERDP,PSGOREAS,PSGRZERO S PSJORD=PSGORD K PSJPREX
"RTN","PSJCOMR",63,0)
 S X=$$LS^PSSLOCK(PSGP,PSGORD)  S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOREAS=$P(@(PSGRZERO),"^",24) D
"RTN","PSJCOMR",64,0)
 . S $P(@PSGRZERO,"^",24)="R" D UPDREN^PSGOER(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO,$G(TMPDUZ)),UPDRENOE^PSGOER(PSGP,PSGORD) S $P(@PSGRZERO,"^",24)=PSGOREAS
"RTN","PSJCOMR",65,0)
 I +$G(PSJSYSU)=3,$G(PSJCOM) D CMPLX2^PSJCOM1(PSGP,PSJCOM,PSGORD) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJCOMR",66,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSJCOMR",67,0)
 I '$G(PSGOERDP),$P(PSJSYSW0,"^",4) I $G(PSGFD),$G(PSGWLL),(PSGFD'<PSGWLL) S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSJCOMR",68,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSJCOMR",69,0)
 W ".DONE!" S VALMBCK="Q"
"RTN","PSJCOMR",70,0)
 Q
"RTN","PSJCOMR",71,0)
 ;
"RTN","PSJCOMR",72,0)
MARK ;
"RTN","PSJCOMR",73,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSJCOMR",74,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSJCOMR",75,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSJCOMR",76,0)
 Q
"RTN","PSJCOMR",77,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSJCOMR",78,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSJCOMR",79,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSJCOMR",80,0)
 Q
"RTN","PSJCOMR",81,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSJCOMR",82,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSJCOMR",83,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSJCOMR",84,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSJCOMR",85,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSJCOMR",86,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSJCOMR",87,0)
 Q
"RTN","PSJCOMR",88,0)
 ;
"RTN","PSJCOMR",89,0)
RIV ; Renew order.
"RTN","PSJCOMR",90,0)
 Q:'PSJCOM  N PSGORD,TMPP,TMPO S (TMPP,TMPO)=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",91,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP  S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""  D
"RTN","PSJCOMR",92,0)
 . S PSGORD=TMPO D:PSGORD["U" NEWUD  D:PSGORD["V" NEWIV
"RTN","PSJCOMR",93,0)
 Q
"RTN","PSJCOMR",94,0)
NEWIV ;Renew complex IV orders
"RTN","PSJCOMR",95,0)
 N X,XX
"RTN","PSJCOMR",96,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." Q:$G(ERR)<2
"RTN","PSJCOMR",97,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG Q:$G(PSGORQF)  W !
"RTN","PSJCOMR",98,0)
 I $G(PSGORD)["V" S ON55=PSGORD S P("OLDON")=$P(^PS(55,DFN,"IV",+PSGORD,2),"^",5) S:'P("OLDON") P("OLDON")=ON55
"RTN","PSJCOMR",99,0)
 ;
"RTN","PSJCOMR",100,0)
R1 N PSIVND0,PSIVND2,PSIVREAS,PSIVOFD,IVSTRING,P2,PSJBKDR S PSJBKDR=1
"RTN","PSJCOMR",101,0)
 S P("NEWON")=ON55,(PSIVOK,EDIT)="25^1",P2=P(2) S P(2)=$$DATE^PSJUTL2 D EDIT^PSIVEDT S P(2)=P2 I X="^" D RD Q
"RTN","PSJCOMR",102,0)
 S:+VAIN(4)'=$P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10) P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSJCOMR",103,0)
 S PSIVCHG=2
"RTN","PSJCOMR",104,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSJCOMR",105,0)
 S P(17)="A",P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSJCOMR",106,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD S COMQUIT=1 Q
"RTN","PSJCOMR",107,0)
 .S ON=ON55 ;D SET^PSIVORFE
"RTN","PSJCOMR",108,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",PSIVOFD=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",3)
"RTN","PSJCOMR",109,0)
 S IVSTRING=DFN_"^"_ON55_"^"_$$DATE^PSJUTL2()_"^"_+$G(P(6))_"^"_PSIVOFD_"^"_P(3)_"^"_P("NAT") F II=1:1:$L(IVSTRING,"^") I $P(IVSTRING,"^",II)="" K IVSTRING
"RTN","PSJCOMR",110,0)
 I '$D(IVSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",111,0)
 S:$G(DUZ) IVSTRING=IVSTRING_"^"_DUZ D TEMP(IVSTRING)
"RTN","PSJCOMR",112,0)
 Q
"RTN","PSJCOMR",113,0)
 ;
"RTN","PSJCOMR",114,0)
FILEIV ;
"RTN","PSJCOMR",115,0)
 N X,ON,ON55,PSJORD,P,PSIVTMP,PSIVZERO,OREAS
"RTN","PSJCOMR",116,0)
 S X=$$LS^PSSLOCK(DFN,+PSGORD_"V") S PSIVZERO="^PS(55,"_DFN_",""IV"","_+PSGORD_",0)" S PSIVTMP0=$G(@PSIVZERO) Q:'PSIVTMP0
"RTN","PSJCOMR",117,0)
 S PSIVTMP2="^PS(55,"_DFN_",""IV"","_+PSGORD_",2)",OREAS=$P(PSIVTMP2,"^",8),$P(@PSIVTMP2,"^",8)="R"
"RTN","PSJCOMR",118,0)
 F I=1:1:$L(PSIVTMP0,"^") S P(I)=$P(PSIVTMP0,"^",I)
"RTN","PSJCOMR",119,0)
 S (ON,ON55,PSJORD)=PSGORD,P(3)=PSGFD,P(6)=PSGOEPR,P("NAT")=PSJNOO,PSIVOFD=PSGOFD D RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSJCOMR",120,0)
 Q:'PSJIVORF
"RTN","PSJCOMR",121,0)
 D EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED")
"RTN","PSJCOMR",122,0)
 S OD=P(2) D EN^PSIVORE
"RTN","PSJCOMR",123,0)
 D VF1^PSJLIACT("","",0),UNL^PSSLOCK(DFN,+ON55_"V") S $P(@PSIVTMP2,"^",8)=OREAS
"RTN","PSJCOMR",124,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSJCOMR",125,0)
 Q
"RTN","PSJCOMR",126,0)
 ;
"RTN","PSJCOMR",127,0)
TEMP(VARS) ;
"RTN","PSJCOMR",128,0)
 Q:'PSJCOM  S ^TMP("PSJCOMR",$J,PSJCOM,PSGORD)=VARS
"RTN","PSJCOMR",129,0)
 Q
"RTN","PSJCOMR",130,0)
 ;
"RTN","PSJCOMR",131,0)
RD ; Delete for renew.
"RTN","PSJCOMR",132,0)
 D DEL55^PSIVORE2 S (ON55,P("PON"))=P("OLDON") D GT55^PSIVORFB
"RTN","PSJCOMR",133,0)
 Q
"RTN","PSJCOMR",134,0)
 ;
"RTN","PSJCOMR",135,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSJCOMR",136,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSJCOMR",137,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" Q
"RTN","PSJCOMR",138,0)
 I ERR=1 S X="N" Q
"RTN","PSJCOMR",139,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSJCOMR",140,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSJCOMR",141,0)
 Q
"RTN","PSJCOMR",142,0)
 ;
"RTN","PSJCOMR",143,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSJCOMR",144,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSJCOMR",145,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSJCOMR",146,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSJCOMR",147,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSJCOMR",148,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSJCOMR",149,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSJCOMR",150,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSJCOMR",151,0)
 Q
"RTN","PSJCOMR",152,0)
 ;
"RTN","PSJCOMR",153,0)
ABORT ; No changes
"RTN","PSJCOMR",154,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSJCOMR",155,0)
 Q
"RTN","PSJCOMV")
0^28^B41315630
"RTN","PSJCOMV",1,0)
PSJCOMV ;BIR/CML3-FINISH COMPLEX IV ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOMV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSJCOMV",3,0)
 ;
"RTN","PSJCOMV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOMV",5,0)
 ; Reference to ^%DTC is supported by DBIA 10000..
"RTN","PSJCOMV",6,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMV",7,0)
 ;
"RTN","PSJCOMV",8,0)
 ;
"RTN","PSJCOMV",9,0)
IV ; Move IV data in local variables to ^TMP
"RTN","PSJCOMV",10,0)
 Q:'PSJCOM  Q:ON'["P"
"RTN","PSJCOMV",11,0)
 M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",12,0)
 S P(17)="N"
"RTN","PSJCOMV",13,0)
 ;I PSIVCHG D NEWIV Q
"RTN","PSJCOMV",14,0)
 K ND S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",15,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",16,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",17,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",18,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",19,0)
 S:'+$G(^TMP("PSJCOM",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",20,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJCOMV",21,0)
 ;K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSJCOMV",22,0)
 ;K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSJCOMV",23,0)
 I '+$P(PSJSYSP0,"^",9) D NEWNVAL^PSJCOM(ON,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOMV",24,0)
 I +PSJSYSU=3,+$P(PSJSYSP0,U,9) D VFYIV Q
"RTN","PSJCOMV",25,0)
 I +PSJSYSU=1,+$P(PSJSYSP0,U,9),$G(PSJIRNF) D VFYIV
"RTN","PSJCOMV",26,0)
 I $G(PSIVENO),($P(^PS(53.1,+PSJORD,0),U,9)="N") D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",27,0)
 Q
"RTN","PSJCOMV",28,0)
 ;
"RTN","PSJCOMV",29,0)
VFYIV ;
"RTN","PSJCOMV",30,0)
 Q:'PSJCOM
"RTN","PSJCOMV",31,0)
 I '$D(^TMP("PSJCOM",$J,+ON)) M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON) D
"RTN","PSJCOMV",32,0)
 . N CHILD,ORDER S ORDER=0 F  S ORDER=$O(^PS(53.1,"ACX",PSJCOM,ORDER)) Q:'ORDER  D
"RTN","PSJCOMV",33,0)
 .. I '$D(^TMP("PSJCOM",$J,+ORDER)) M ^TMP("PSJCOM",$J,+ORDER)=^PS(53.1,+ORDER)
"RTN","PSJCOMV",34,0)
 I ON["P" D
"RTN","PSJCOMV",35,0)
 . S P(17)="A"
"RTN","PSJCOMV",36,0)
 . S PSGORDP=ON ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOMV",37,0)
 . NEW PSGX S PSGX=$S($D(^TMP("PSJCOM2",$J,+ON,2.5)):$G(^TMP("PSJCOM2",$J,+ON,2.5)),1:$G(^TMP("PSJCOM2",$J,+ON,2.5))),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOMV",38,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM2",$J,+ON,0),"^",9)=P(17) S:'$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM",$J,+ON,0),"^",9)=P(17) W "." ;D ^PSGOT
"RTN","PSJCOMV",39,0)
 D NEWNVAL^PSJCOM(ON,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOMV",40,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+ON)):$G(^TMP("PSJCOM",$J,+ON,4)),1:$G(^TMP("PSJCOM2",$J,+ON,4)))
"RTN","PSJCOMV",41,0)
 S VND2P5=$$GETDUR^PSJLIVMD(DFN,ON,$E(ON,$L(ON)),1) I VND2P5]"" D
"RTN","PSJCOMV",42,0)
 . S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,2.5)="^"_VND2P5 Q
"RTN","PSJCOMV",43,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,2.5)="^"_VND2P5
"RTN","PSJCOMV",44,0)
 I $G(PSGRSD) D
"RTN","PSJCOMV",45,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL^PSJCOM(ON,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOMV",46,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL^PSJCOM(ON,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOMV",47,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOMV",48,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOMV",49,0)
 I +PSJSYSU=3,ON'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ; D EN^PSGPEN(+ON)
"RTN","PSJCOMV",50,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOMV",51,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^TMP("PSJCOM",$J,+ON,4)=VND4
"RTN","PSJCOMV",52,0)
 S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,4)=VND4
"RTN","PSJCOMV",53,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOMV",54,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOMV",55,0)
 S VALMBCK="Q"
"RTN","PSJCOMV",56,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J)="A" Q
"RTN","PSJCOMV",57,0)
 ;
"RTN","PSJCOMV",58,0)
PTD531 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",59,0)
 K ^TMP("PSJCOM",$J,DRGT) S ^TMP("PSJCOM",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",60,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",61,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",62,0)
 .S ^TMP("PSJCOM",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",63,0)
 Q
"RTN","PSJCOMV",64,0)
 ;
"RTN","PSJCOMV",65,0)
NEWIV ;Create new IV order in appropriate file format
"RTN","PSJCOMV",66,0)
 M ^TMP("PSJCOM2",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",67,0)
 S $P(^TMP("PSJCOM",$J,+ON,0),"^",9)="DE",P("OLDON")=+ON_"P",P("RES")="E"
"RTN","PSJCOMV",68,0)
 I +$P(PSJSYSP0,U,9) D NEWAIV Q
"RTN","PSJCOMV",69,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",70,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",71,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",72,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",73,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",74,0)
 S:'+$G(^TMP("PSJCOM2",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",75,0)
 I $G(P("PRNTON"))]"" S $P(^TMP("PSJCOM2",$J,+ON,.2),"^",8)=$G(P("PRNTON"))
"RTN","PSJCOMV",76,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD5312
"RTN","PSJCOMV",77,0)
 ;K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSJCOMV",78,0)
 ;K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSJCOMV",79,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",80,0)
 Q
"RTN","PSJCOMV",81,0)
 ;
"RTN","PSJCOMV",82,0)
PTD5312 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",83,0)
 K ^TMP("PSJCOM2",$J,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",84,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",85,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",86,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",87,0)
 Q
"RTN","PSJCOMV",88,0)
 ;
"RTN","PSJCOMV",89,0)
NEWAIV ;Creates new IV order in the file 55 format
"RTN","PSJCOMV",90,0)
 N DA,DIK,ND,PSIVACT
"RTN","PSJCOMV",91,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOMV",92,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSJCOMV",93,0)
 S ND(.3)=$G(P("INS"))
"RTN","PSJCOMV",94,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSJCOMV",95,0)
 F X=0,1,3,.2,.3 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",96,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSJCOMV",97,0)
 ;S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSJCOMV",98,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,11)=+P("CLRK")
"RTN","PSJCOMV",99,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",100,0)
 S:+$G(P("NINIT")) ^TMP("PSJCOM2",$J,+ON,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSJCOMV",101,0)
 I +PSJSYSU=3 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",4)=DUZ,$P(^TMP("PSJCOM2",$J,+ON,4),"^",5)=PSGDT,$P(^TMP("PSJCOM2",$J,+ON,4),"^",9)=1
"RTN","PSJCOMV",102,0)
 I +PSJSYSU=1 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",10)=1
"RTN","PSJCOMV",103,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(55,DFN,"IV",+ON55,5) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSJCOMV",104,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSJCOMV",105,0)
 ;K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSJCOMV",106,0)
 Q
"RTN","PSJCOMV",107,0)
 ;
"RTN","PSJCOMV",108,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSJCOMV",109,0)
 K ^TMP("PSJCOM2",$J,+ON,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSJCOMV",110,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",111,0)
 .S Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",112,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",113,0)
 Q
"RTN","PSJDCU")
0^33^B4062341
"RTN","PSJDCU",1,0)
PSJDCU ;BIR/JLC-DATE CALCULATION UTILITY ;09/07/00
"RTN","PSJDCU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,63,66,69,58,95,127**;16 DEC 97
"RTN","PSJDCU",3,0)
 ;
"RTN","PSJDCU",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJDCU",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181
"RTN","PSJDCU",6,0)
 ; Reference to ^%DTC is supported by DBIA# 10000
"RTN","PSJDCU",7,0)
 ; Reference to ^PSBAPIPM is supported by DBIA# 3564
"RTN","PSJDCU",8,0)
 ;
"RTN","PSJDCU",9,0)
DSTART(PSJDFN,PSJORD) ;calculate default start date
"RTN","PSJDCU",10,0)
 I $G(PSJSPEED) Q ""
"RTN","PSJDCU",11,0)
 I $G(PSJORD)["U",$G(PSGORD)["P" I $P($G(^PS(53.1,+PSGORD,0)),"^",24,25)="R^"_PSJORD Q $P($G(^PS(55,+$G(PSJDFN),5,+PSJORD,2)),"",2)
"RTN","PSJDCU",12,0)
 N LAST,LASTH,NOW,FREQ,X,Y,%H,%T,NEW,SCH,ADM,STOP
"RTN","PSJDCU",13,0)
 S Y=$$EN^PSBAPIPM(PSJDFN,PSJORD)
"RTN","PSJDCU",14,0)
 I Y=""!("GR"'[$P(Y,U,3)) Q ""
"RTN","PSJDCU",15,0)
 S (SCH,X)=$P(Y,U) D H^%DTC S LAST=%H*86400+%T,LASTH=%H_","_%T
"RTN","PSJDCU",16,0)
 D NOW^%DTC S NOW=%
"RTN","PSJDCU",17,0)
 I PSJORD["U" S X=^PS(55,PSJDFN,5,+PSJORD,2),STOP=$P(X,U,4),ADM=$P(X,U,5),FREQ=$P(X,U,6)
"RTN","PSJDCU",18,0)
 I PSJORD["V" S X=^PS(55,PSJDFN,"IV",+PSJORD,0),STOP=$P(X,U,3),ADM=$P(X,U,11),FREQ=$P(X,U,15)
"RTN","PSJDCU",19,0)
 I FREQ="O" Q ""
"RTN","PSJDCU",20,0)
 I ADM="" S SCH="",X=$P(Y,U,2) D H^%DTC S LAST=%H*86400+%T
"RTN","PSJDCU",21,0)
 S FREQ=$S(FREQ="D":1440,FREQ="O":0,1:FREQ)*60
"RTN","PSJDCU",22,0)
 S NEW=LAST+FREQ+$S(SCH]"":0,1:3599),%H=NEW\86400_","_(NEW#86400)
"RTN","PSJDCU",23,0)
 I $P(%H,",",2)<3600 S %H=$S(+%H=+LASTH:+%H,1:%H-1)_",86400"
"RTN","PSJDCU",24,0)
 D YMD^%DTC
"RTN","PSJDCU",25,0)
 S NEW=X_+$E(%,1,3)
"RTN","PSJDCU",26,0)
 I NOW>NEW Q ""
"RTN","PSJDCU",27,0)
 I $G(ORENEW)!($G(PSJREN)) I ADM]"",NEW>STOP S NEW=STOP
"RTN","PSJDCU",28,0)
 I ADM]"",NEW>STOP Q ""
"RTN","PSJDCU",29,0)
 Q NEW
"RTN","PSJDCU",30,0)
ENOSD(PSJWP,PSJSD,DFN) ;calculate one-time stop date from ward/system parameters
"RTN","PSJDCU",31,0)
 ;Input:  PSJWP - Inpatient Ward Parameters for the patient's ward
"RTN","PSJDCU",32,0)
 ;        PSJSD - Start date for the order
"RTN","PSJDCU",33,0)
 ;        DFN   - Internal entry number for the patient
"RTN","PSJDCU",34,0)
 N PSJOP,PSJST,VAIP,%,I,X,Y,W,Z,E
"RTN","PSJDCU",35,0)
 S PSJWP=$G(PSJWP),PSJSD=$G(PSJSD),DFN=$G(DFN)
"RTN","PSJDCU",36,0)
 D NOW^%DTC I PSJSD="" S PSJSD=%
"RTN","PSJDCU",37,0)
 I DFN]"" S VAIP("D")=% D IN5^VADPT I VAIP(5)="" S PSJWP=""
"RTN","PSJDCU",38,0)
 S PSJOP=$P(PSJWP,"^",28) I PSJOP="" S PSJOP=$P($G(^PS(59.7,1,26)),"^",6)
"RTN","PSJDCU",39,0)
 I PSJOP="" Q ""
"RTN","PSJDCU",40,0)
 S PSJST=$$FMADD^XLFDT(PSJSD,PSJOP)  Q PSJST
"RTN","PSJHL7")
0^8^B47267607
"RTN","PSJHL7",1,0)
PSJHL7 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;29 AUG 96 / 11:18 AM
"RTN","PSJHL7",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**42,47,50,70,82,110,127**;16 DEC 97
"RTN","PSJHL7",3,0)
 ;
"RTN","PSJHL7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL7",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL7",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL7",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL7",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL7",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL7",10,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL7",11,0)
 ; Reference to ^TMP("PSB" is supported by DBIA# 3564.
"RTN","PSJHL7",12,0)
 ; 
"RTN","PSJHL7",13,0)
RENEW ;Renew orders from OE/RR
"RTN","PSJHL7",14,0)
 N PSJSYSW0,PSJSYSW,WRDPTR,PSJOSTOP
"RTN","PSJHL7",15,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(LOC) S WRDPTR=$G(^SC(+LOC,42)) S:WRDPTR]"" PSJSYSW=+$O(^PS(59.6,"B",WRDPTR,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJHL7",16,0)
 I PREON["V" D IVSET G DONE
"RTN","PSJHL7",17,0)
 N ND,ND1,ND2,PSGSI,PSGMR,PSGSM,PSGHSM,PSGST,OIDRG,PSGDO,PSGSCH,PSGSOY,PSGOXT,PSGNEDFD,DRUGS
"RTN","PSJHL7",18,0)
 S ND=$G(^PS(55,PSJHLDFN,5,+PREON,0)),ND1=$G(^(.2)),ND2=$G(^(2)),PSGSI=$G(^(6)),PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSJHLDFN,5.1)),1:0)
"RTN","PSJHL7",19,0)
 I +PSITEM>0,PSITEM'=+$P(ND1,"^") S $P(ND1,"^")=PSITEM
"RTN","PSJHL7",20,0)
 S PSGMR=$P(ND,"^",3),PSGSM=$P(ND,"^",5),PSGHSM=$P(ND,"^",6),PSGST=$P(ND,"^",7),OIDRG=$P(ND1,"^"),PSGDO=$P(ND1,"^",2),DOSE=$P(ND1,"^",5),UNIT=$P(ND1,"^",6),PSGSCH=$P(ND2,"^")
"RTN","PSJHL7",21,0)
 S PSGSOY=$P(ND2,"^",5),PSGOXT=$P(ND2,"^",6),PSGNEDFD=$P($$GTNEDFD^PSGOE7("UI",OIDRG),"^")
"RTN","PSJHL7",22,0)
 S:$P(LOC,"^")'=$P(ND2,"^",10) PSGSOY=$$ENRNAT^PSJHL7($P(ND2,"^",10),+LOC,PSGSCH,PSGSOY)
"RTN","PSJHL7",23,0)
 S X=$O(^PS(55,PSJHLDFN,5,+PREON,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSJHLDFN,5,+PREON,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,DRUGS(Q1)=$P(ND,"^",1,3)
"RTN","PSJHL7",24,0)
 S (PSGNESD,PSGNEFD)="" D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSJHLDFN)
"RTN","PSJHL7",25,0)
 I PSGOXT="D",'PSGSOY S PSGSOY=+$E(PSGNESD_"00011",9,12)
"RTN","PSJHL7",26,0)
 S ND=NEWORDER_U_PROVIDER_U_PSGMR_U_"U"_U_PSGSM_U_PSGHSM_U_PSGST_"^^P^^^^^"_LOGIN_U_PSJHLDFN_U_LOGIN S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJHL7",27,0)
 S $P(ND,U,21)=$P(ORDER,U),$P(ND,U,24,25)=ROC_U_PREON
"RTN","PSJHL7",28,0)
 F X="PSGNESD","PSGNEFD" S:@X]"" @X=+@X
"RTN","PSJHL7",29,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGSOY_U_PSGOXT
"RTN","PSJHL7",30,0)
 S F="^PS(53.1,"_NEWORDER_",",@(F_"0)")=ND,^(.2)=OIDRG_U_PSGDO_U_ORDCON_U_PRIORITY_U_DOSE_U_UNIT_U_U_$G(PRNTON),^(2)=ND2 S:$G(PSGSI)]"" ^(6)=PSGSI
"RTN","PSJHL7",31,0)
 I $D(DRUGS) D
"RTN","PSJHL7",32,0)
 .I $D(@(F_"1,0)")) K @(F_"1)")
"RTN","PSJHL7",33,0)
 .; Naked reference below refers to full reference to ^PS(53.1,+NEWORDER in variable F created using indirection.
"RTN","PSJHL7",34,0)
 .I '$D(@(F_"1,0)")) S ^(0)="^53.11P^0^0"
"RTN","PSJHL7",35,0)
 .S JJ=0 F  S JJ=$O(DRUGS(JJ)) Q:'JJ  I $S('$P(DRUGS(JJ),U,3):1,1:$P(DRUGS(JJ),U,3)>DT) S $P(@(F_"1,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"1,"_JJ_",0)")=$P(DRUGS(JJ),U,1,2),@(F_"1,""B"","_+DRUGS(JJ)_","_JJ_")")=""
"RTN","PSJHL7",36,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",5,"_+$G(PREON)_",2)")),PSJOSTOP=$P(PSJOSTOP,"^",4) D REN531(NEWORDER,$P(ND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",37,0)
 ;
"RTN","PSJHL7",38,0)
DONE ;
"RTN","PSJHL7",39,0)
 N DA,DR,DIE,PSIVACT,PSIVALT,ON55,PSIVREA
"RTN","PSJHL7",40,0)
 S DIE=$S(PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=PSJHLDFN,DR=$S(PREON["V":"100////R;123////R;114////"_PSJORDER,1:"28////R;107////R;105////"_PSJORDER)
"RTN","PSJHL7",41,0)
 I PREON["A"!(PREON["U") S PSGAL("C")=18000 D ^PSGAL5
"RTN","PSJHL7",42,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="R"
"RTN","PSJHL7",43,0)
 D ^DIE
"RTN","PSJHL7",44,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL7",45,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",PREON) S PSJHLMTN="ORR",PSOC="NW"
"RTN","PSJHL7",46,0)
 Q
"RTN","PSJHL7",47,0)
IVSET ;
"RTN","PSJHL7",48,0)
 N DRG,DRGN,P
"RTN","PSJHL7",49,0)
 S P("RES")="R",P("REN")="",Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSJHL7",50,0)
 S P("PON")=PREON,P(21)=$P(ORDER,U),P(6)=PROVIDER_U_$P($G(^VA(200,+PROVIDER,0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,PSJHLDFN,"IV",+PREON,1))
"RTN","PSJHL7",51,0)
 S Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),P("LOG")=LOGIN
"RTN","PSJHL7",52,0)
 S P("CLRK")=CLERK_U_$P($G(^VA(200,+CLERK,0)),U),P("RES")=ROC,P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,PSJHLDFN,"IV",+PREON,3))
"RTN","PSJHL7",53,0)
 S ND=$G(^PS(55,PSJHLDFN,"IV",+PREON,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2)
"RTN","PSJHL7",54,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U))
"RTN","PSJHL7",55,0)
 D GTDRG
"RTN","PSJHL7",56,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"I",1:"I")
"RTN","PSJHL7",57,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSJHL7",58,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSJHL7",59,0)
 N IVLIM,IVLIMIT S IVLIM=$$GETDUR^PSJLIVMD(PSJHLDFN,+PREON,$E(PREON,$L(PREON)),1) I IVLIM]"",$G(IVLIMIT) S $P(^PS(53.1,+NEWORDER,2.5),U,4)=IVLIM
"RTN","PSJHL7",60,0)
 S ND(0)=+NEWORDER_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_P("OT")_U_U_U_"C",$P(ND(0),U,9)="P"
"RTN","PSJHL7",61,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_PSJHLDFN_U_P("LOG"),$P(ND(0),U,21)=P(21),$P(ND(0),U,24,26)=$G(P("RES"))_U_P("PON")
"RTN","PSJHL7",62,0)
 S ND(2)=P(9)_U_U_U_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJHL7",63,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJHL7",64,0)
 F X=0,2,4,8,9 S ^PS(53.1,+NEWORDER,X)=ND(X)
"RTN","PSJHL7",65,0)
 S:+P("PD") ^PS(53.1,+NEWORDER,.2)=+P("PD")_U_P("DO")
"RTN","PSJHL7",66,0)
 S $P(^PS(53.1,+NEWORDER,.2),"^",3,4)=ORDCON_U_PRIORITY
"RTN","PSJHL7",67,0)
 ;I $G(PRNTON) I $$UP^XLFSTR($G(PSGSCH))="NOW" S PRNTON=""
"RTN","PSJHL7",68,0)
 I $G(PRNTON) S $P(^PS(53.1,+NEWORDER,.2),"^",8)=PRNTON
"RTN","PSJHL7",69,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJHL7",70,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)")),PSJOSTOP=$P(PSJOSTOP,"^",3) D
"RTN","PSJHL7",71,0)
 .N IVND S IVND=$G(^PS(53.1,+NEWORDER,0)) D REN531(NEWORDER,$P(IVND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",72,0)
 Q
"RTN","PSJHL7",73,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSJHL7",74,0)
 K ^PS(53.1,+NEWORDER,DRGT) S ^PS(53.1,+NEWORDER,DRGT,0)=$S(DRGT="AD":"^53.157PA^0^0",1:"^53.158PA^0^0")
"RTN","PSJHL7",75,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJHL7",76,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+NEWORDER,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL7",77,0)
 .S ^PS(53.1,+NEWORDER,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+NEWORDER,DRGT,+DRG,0)=Y,^PS(53.1,+NEWORDER,DRGT,"B",+X1,+DRG)=""
"RTN","PSJHL7",78,0)
 I $G(P("RES"))="R",($G(ND(0))]"") D REN531(+NEWORDER,$P(ND(0),"^",14),$P(ND(0),"^",2),$G(P(3)),$G(DFN))
"RTN","PSJHL7",79,0)
 Q
"RTN","PSJHL7",80,0)
 ;
"RTN","PSJHL7",81,0)
ENRNAT(OWD,NWD,SC,OAT) ;Determine admin times for renewal orders.
"RTN","PSJHL7",82,0)
 ;OWD=ORIGINAL W,NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSJHL7",83,0)
 N OWAT,SCP,X,Y
"RTN","PSJHL7",84,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSJHL7",85,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSJHL7",86,0)
 I OAT'=WAT Q OOAT
"RTN","PSJHL7",87,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSJHL7",88,0)
 Q OOAT
"RTN","PSJHL7",89,0)
 ;
"RTN","PSJHL7",90,0)
GTDRG ; Get drug info and place in DRG(. 
"RTN","PSJHL7",91,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) Q:'Y  D
"RTN","PSJHL7",92,0)
 .;Naked reference ^(Y,0) below refers to full global reference ^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) above at GTDRG+1
"RTN","PSJHL7",93,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1,DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJHL7",94,0)
 Q
"RTN","PSJHL7",95,0)
 ;
"RTN","PSJHL7",96,0)
REN531(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSGP) ;
"RTN","PSJHL7",97,0)
 Q:'PSGORD!'PSGDT!'PSGOEPR!'PSGOFD!'PSGP
"RTN","PSJHL7",98,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(53.1,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="53.1114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSJHL7",99,0)
 . S DIC("DR")=".01////"_$G(PSGDT)_";1////"_$G(DUZ)_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD),X=$G(PSGDT) D FILE^DICN
"RTN","PSJHL7",100,0)
 Q
"RTN","PSJHL7",101,0)
 ;
"RTN","PSJHL7",102,0)
CHK(X,Y,Z) ;Check for required fields
"RTN","PSJHL7",103,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL7",104,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL7",105,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL7",106,0)
 S:'$D(^PS(50.7,+Y,0)) CHK=1
"RTN","PSJHL7",107,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHL7",108,0)
 E  S CHK=CHK_$S($P(X,"^",3):"",1:2)_$S($P(X,"^",7)]"":"",1:3)
"RTN","PSJHL7",109,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHL7",110,0)
 S:'$$DDOK^PSJHL10("^TMP(""PSB"","_$J_",700,",+Y) CHK=CHK_7
"RTN","PSJHL7",111,0)
 ;
"RTN","PSJHL7",112,0)
CHKM ;
"RTN","PSJHL7",113,0)
 Q:'CHK
"RTN","PSJHL7",114,0)
 S MSG="THE FOLLOWING "_$S($L(CHK)>1:"ARE",1:"IS")_" EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 S:CHK[X MSG2=$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSJHL7",115,0)
 S PSREASON=MSG_MSG2
"RTN","PSJHL7",116,0)
 Q
"RTN","PSJHLV")
0^1^B21177155
"RTN","PSJHLV",1,0)
PSJHLV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ;4/8/99  08:16
"RTN","PSJHLV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**39,42,78,92,127**;16 DEC 97
"RTN","PSJHLV",3,0)
 ;
"RTN","PSJHLV",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHLV",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHLV",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHLV",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSJHLV",8,0)
 ;
"RTN","PSJHLV",9,0)
EN(PSJHLDFN,PSGORD) ;
"RTN","PSJHLV",10,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJHLV",11,0)
 N PSJPWD,VAIP,DFN,PSGP,PSGORDP S (DFN,PSGP)=PSJHLDFN D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5) G:VAIP(5)']"" DONE
"RTN","PSJHLV",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,4)'="U" D IV Q
"RTN","PSJHLV",13,0)
 N PSJSYSP S PSJSYSP=+NURSEACK
"RTN","PSJHLV",14,0)
 N PSGDT D NOW^%DTC S PSGDT=%
"RTN","PSJHLV",15,0)
 S CHK=0 D DDCHK G:CHK DONE
"RTN","PSJHLV",16,0)
 D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSJHLV",17,0)
 G:CHK DONE
"RTN","PSJHLV",18,0)
 S PSGORDP=PSGORD
"RTN","PSJHLV",19,0)
 ;
"RTN","PSJHLV",20,0)
 N PSJRPND0 S PSJRPND0=^PS(53.1,+PSGORD,0) I $P(PSJRPND0,U,24)="R" D
"RTN","PSJHLV",21,0)
 .N PSGORDR,PSJPRIO,PSJSCHED,FILE55N0
"RTN","PSJHLV",22,0)
 .S PSGORDR=$P(PSJRPND0,U,25)
"RTN","PSJHLV",23,0)
 .Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJHLV",24,0)
 .N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_PSJHLDFN_$S($P(PSJRPND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)",FILE55N2=FILE55_+PSGORDR_",2)"
"RTN","PSJHLV",25,0)
 .S OEORD=$P(PSJRPND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD N PSGSD S PSGSD=$P(@FILE55N2,"^",2) D
"RTN","PSJHLV",26,0)
 ..D EXPOE^PSGOER(PSJHLDFN,PSGORD,+$$LASTREN^PSJLMPRI(PSJHLDFN,PSGORD))
"RTN","PSJHLV",27,0)
 .K DA,DR,DIE S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJHLV",28,0)
 .D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSJHLV",29,0)
 ..K DA,DR,DIE S DA(1)=PSJHLDFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJHLV",30,0)
 ..D EN1^PSJHL2(PSJHLDFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJHLV",31,0)
 ..S PSGORD=PSGORDR
"RTN","PSJHLV",32,0)
 ;
"RTN","PSJHLV",33,0)
 S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" D ^DIE I $P(PSJRPND0,U,24)'="R" D ^PSGOT
"RTN","PSJHLV",34,0)
 S DA=+PSGORD,DA(1)=PSJHLDFN,PSGAL("C")=22010
"RTN","PSJHLV",35,0)
 D ^PSGAL5 S VND4=$G(^PS(55,PSJHLDFN,5,DA,4)) I $P(PSJRPND0,U,24)="R",$P(VND4,U,4) D
"RTN","PSJHLV",36,0)
 .K DA,DIE,DR I $P(VND4,U,4)<$$LASTREN^PSJLMPRI(PSJHLDFN,PSGORDP) S DIE="^PS(55,"_PSJHLDFN_",5,",DA(1)=PSJHLDFN,DA=+PSGORD,DR="18////@;19////@" D ^DIE
"RTN","PSJHLV",37,0)
 .S $P(VND4,U,3,4)=""
"RTN","PSJHLV",38,0)
 S $P(VND4,"^",10)=1
"RTN","PSJHLV",39,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",1,2)=+NURSEACK_"^"_PSGDT,^PS(55,PSJHLDFN,5,+PSGORD,4)=VND4
"RTN","PSJHLV",40,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSJHLDFN,+PSGORD)=""
"RTN","PSJHLV",41,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSJHLDFN,+PSGORD)=""
"RTN","PSJHLV",42,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSJHLDFN,+PSGORD)
"RTN","PSJHLV",43,0)
 D:$D(PSGORDP) ACTLOG^PSGOEV(PSGORDP,PSJHLDFN,PSGORD)
"RTN","PSJHLV",44,0)
 D EN1^PSJHL2(PSJHLDFN,"SC",+PSGORD_"U")
"RTN","PSJHLV",45,0)
 Q
"RTN","PSJHLV",46,0)
 ;
"RTN","PSJHLV",47,0)
IV ;
"RTN","PSJHLV",48,0)
 NEW DRG,DRGI,DRGN,DRGT,FIL,ON,ON55,P,PSJORD,VADM,VAIN
"RTN","PSJHLV",49,0)
 S ON=PSGORD,PSIVCHG=0,PSJSYSU=1
"RTN","PSJHLV",50,0)
 D INP^VADPT
"RTN","PSJHLV",51,0)
 D GT531^PSIVORFA(PSJHLDFN,PSGORD),ACTIVE^PSIVORC2
"RTN","PSJHLV",52,0)
 K PSIVCHG,PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJPINIT,PSJSYSL,PSJSYSU,PSJSYSW,PSJSYSW0
"RTN","PSJHLV",53,0)
 Q
"RTN","PSJHLV",54,0)
DONE ;
"RTN","PSJHLV",55,0)
 K CHK,DA,DIE,DRGF,DP,DR,ND,PSGAL,PSGODA,PSGPD,VND4 Q
"RTN","PSJHLV",56,0)
 ;
"RTN","PSJHLV",57,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSJHLV",58,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSJHLV",59,0)
 ;        DRG - ^(.2)
"RTN","PSJHLV",60,0)
 ;        ND2 - ^(2)
"RTN","PSJHLV",61,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSJHLV",62,0)
 E  S CHK=1
"RTN","PSJHLV",63,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHLV",64,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSJHLV",65,0)
 ;The naked reference on the line below refers to the variable ND
"RTN","PSJHLV",66,0)
 ;which is ^PS(53.1,PSGORD,0).
"RTN","PSJHLV",67,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSJHLV",68,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSJHLV",69,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSJHLV",70,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHLV",71,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSJHLV",72,0)
 Q
"RTN","PSJHLV",73,0)
 ;
"RTN","PSJHLV",74,0)
DDCHK ; dispense drug check
"RTN","PSJHLV",75,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSJHLDFN_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJHLV",76,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJHLV",77,0)
 S CHK=$S('$$DDOK(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJHLV",78,0)
 Q
"RTN","PSJHLV",79,0)
 ;
"RTN","PSJHLV",80,0)
DDOK(PSJF,OI) ;Check to be sure all dispense drugs that are active in the
"RTN","PSJHLV",81,0)
  ;order are valid.
"RTN","PSJHLV",82,0)
  ; Input: PSJF - File root of the order including all but the IEN of 
"RTN","PSJHLV",83,0)
  ;               the drug. (EX "^PS(53.1,X,1,")
"RTN","PSJHLV",84,0)
  ;        OI   - IEN of the order's orderable item
"RTN","PSJHLV",85,0)
  ; Output: 1 - all active DD's in the order are valid
"RTN","PSJHLV",86,0)
  ;         0 - no DD's active DD's or at least one active is invalid
"RTN","PSJHLV",87,0)
  N DDCNT,ND,PSJ,X S (X,DDCNT)=0
"RTN","PSJHLV",88,0)
  I '$O(@(PSJF_"0)")) Q 1
"RTN","PSJHLV",89,0)
  F PSJ=0:0 S PSJ=$O(@(PSJF_PSJ_")")) Q:'PSJ!X  S ND=$G(@(PSJF_PSJ_",0)"))  D
"RTN","PSJHLV",90,0)
  .I $P(ND,U,3),($P(ND,U,3)'>PSGDT) Q
"RTN","PSJHLV",91,0)
  .S DDCNT=DDCNT+1
"RTN","PSJHLV",92,0)
  .S X=$S('$D(^PSDRUG(+ND,0)):1,$P($G(^(2)),U,3)'["U":1,+$G(^(2))'=+OI:1,$G(^("I"))="":0,1:^("I")'>PSGDT)
"RTN","PSJHLV",93,0)
  Q $S('DDCNT:0,X=1:0,1:1)
"RTN","PSJO1")
0^20^B30933706
"RTN","PSJO1",1,0)
PSJO1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ;15 May 98 / 9:28 AM
"RTN","PSJO1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,47,56,58,109,110,127**;16 DEC 97
"RTN","PSJO1",3,0)
 ;
"RTN","PSJO1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJO1",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJO1",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJO1",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJO1",8,0)
 ;
"RTN","PSJO1",9,0)
ECHK ;
"RTN","PSJO1",10,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJO1",11,0)
 I +START>PSGDT,(STOP>PSGDT) G SET
"RTN","PSJO1",12,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJO1",13,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJO1",14,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJO1",15,0)
 ;
"RTN","PSJO1",16,0)
SET ;
"RTN","PSJO1",17,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",18,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJO1",19,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJO1",20,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJO1",21,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",22,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJO1",23,0)
 ;
"RTN","PSJO1",24,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJO1",25,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND
"RTN","PSJO1",26,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJO1",27,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJO1",28,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJO1",29,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJO1",30,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",31,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJO1",32,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJO1",33,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",34,0)
 ;* I $G(ORTX)=""!(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",35,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJO1",36,0)
 ;
"RTN","PSJO1",37,0)
IVSET1 ;
"RTN","PSJO1",38,0)
 ;* S TYP=$S(P(2)=P(3):"O",1:"C"),STAT=$S("ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",39,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJO1",40,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",41,0)
 I P(17)="P" S STAT="C"_$S($P($G(^PS(53.1,+ON,.2)),U,8)]"":"D",$P($G(^PS(53.1,+ON,.2)),U,4)="S":"A",$P($G(^(0)),U,24)="R":"C",1:"B")
"RTN","PSJO1",42,0)
 I ON["P",$G(P("PRNTON"))]"",PRNTON=+P("PRNTON") Q
"RTN","PSJO1",43,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",44,0)
 S ^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJO1",45,0)
 Q
"RTN","PSJO1",46,0)
 ;
"RTN","PSJO1",47,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJO1",48,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJO1",49,0)
ENUNM ;
"RTN","PSJO1",50,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJO1",51,0)
 .; naked ref below refers to line above
"RTN","PSJO1",52,0)
 .S $P(^(0),"^",9)="E",ORIFN=$P(^(0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQ_"U")
"RTN","PSJO1",53,0)
 K UPD Q
"RTN","PSJO1",54,0)
 ;
"RTN","PSJO1",55,0)
EN(PSJPTYP) ; enter here
"RTN","PSJO1",56,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJO1",57,0)
 N PSJX,PSJY
"RTN","PSJO1",58,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJO1",59,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJO1",60,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJO1",61,0)
 S PSJOCNT=0 I PSJPTYP>1 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJO1",62,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJO1",63,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJO1",64,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJO1",65,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJO1",66,0)
 .I $S($G(PSJPRI)="D":1,PSJY="P":0,PSJOL="L":1,1:"DPE"'[PSJY) S ON=+PSJORD_"V" D IVSET K PSJPRI
"RTN","PSJO1",67,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJO1",68,0)
 D ENUNM
"RTN","PSJO1",69,0)
 I PSJPTYP'=2 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJO1",70,0)
 Q:$D(PSGONNV)
"RTN","PSJO1",71,0)
 ;I PSJPTYP'=2 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",72,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",73,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S O=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",74,0)
 N PRNTON S (PRNTON,O)=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",75,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJO1",76,0)
 Q
"RTN","PSJO1",77,0)
 ;
"RTN","PSJO1",78,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJO1",79,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJO1",80,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",81,0)
 I $P(ND,U,15),$G(PSGP) I PSGP'=$P(ND,U,15) D  Q
"RTN","PSJO1",82,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",83,0)
 I $P(ND,U,9)["D" D  Q
"RTN","PSJO1",84,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",85,0)
 .N ND2 S ND2=$G(^PS(53.1,O,.2)) I $P(ND2,U,8) K ^PS(53.1,"ACX",$P(ND2,U,8))
"RTN","PSJO1",86,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJO1",87,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJO1",88,0)
 ;I C="CC" S C=$$CKPC^PSGOU(PSGP,+$P($G(^PS(53.1,O,0)),U,25),O)
"RTN","PSJO1",89,0)
 D SET
"RTN","PSJO1",90,0)
 Q
"RTN","PSJO1",91,0)
 ;
"RTN","PSJO1",92,0)
KILL ;
"RTN","PSJO1",93,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJO1",94,0)
 Q
"RTN","PSJO1",95,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJO1",96,0)
 S OK=0
"RTN","PSJO1",97,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJO1",98,0)
 I PSJCOM=""  Q OK
"RTN","PSJO1",99,0)
 I PSJPTYP="" Q OK
"RTN","PSJO1",100,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJO1",101,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJO1",102,0)
 N PSJON S PSJON=""
"RTN","PSJO1",103,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJO1",104,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",9)["D" K ^PS(53.1,"ACX",PSJCOM)
"RTN","PSJO1",105,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJO1",106,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJO1",107,0)
 Q OK
"RTN","PSJOEA")
0^24^B27345819
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSJOEA",3,0)
 ;
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOEA",8,0)
 ;
"RTN","PSJOEA",9,0)
LOCK(DFN,PSJORD) ; Check to see if the order is already locked
"RTN","PSJOEA",10,0)
 N Q S Q=0
"RTN","PSJOEA",11,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",12,0)
 I Q Q 1
"RTN","PSJOEA",13,0)
 Q 0
"RTN","PSJOEA",14,0)
 ;
"RTN","PSJOEA",15,0)
SELECT ;
"RTN","PSJOEA",16,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",17,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",18,0)
 .S PSGORD=""
"RTN","PSJOEA",19,0)
 .S ON=PSJO_"P"
"RTN","PSJOEA",20,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",21,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",22,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",23,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",24,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") Q:$G(Y)<0
"RTN","PSJOEA",25,0)
 Q
"RTN","PSJOEA",26,0)
 ;
"RTN","PSJOEA",27,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",28,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",29,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",30,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",31,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55
"RTN","PSJOEA",32,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",33,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",34,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",35,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",36,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",37,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",38,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",39,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",40,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",41,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",42,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",43,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",44,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",45,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",46,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",47,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",48,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1 Q
"RTN","PSJOEA",49,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",50,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",51,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",52,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOEA",53,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",54,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",55,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",56,0)
 ;I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOEA",57,0)
 ;I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOEA",58,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",59,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",60,0)
 ;D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOEA",61,0)
 Q
"RTN","PSJOEA",62,0)
 ;
"RTN","PSJOEA",63,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",64,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",65,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",66,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",67,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",68,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",69,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55,09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",70,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",71,0)
 Q
"RTN","PSJOEA",72,0)
 ;
"RTN","PSJOEA",73,0)
UD ;
"RTN","PSJOEA",74,0)
 N DA,DR,DIE D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA",75,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+DA_"U")
"RTN","PSJOEA",76,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2
"RTN","PSJOEA",77,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,DA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,DA,0)),"^",7)
"RTN","PSJOEA",78,0)
 S ND2=$G(^PS(55,PSGP,5,DA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",79,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO) K PSJPREX
"RTN","PSJOEA",80,0)
 I $G(DA) D CMPLX2^PSJCOM1(PSGP,PSJORD,+DA_"U") I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA",81,0)
 Q
"RTN","PSJOEA",82,0)
IV ; 
"RTN","PSJOEA",83,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",84,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",85,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",86,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",87,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",88,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK K DA,DIK
"RTN","PSJOEA",89,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",90,0)
 Q
"RTN","PSJOEA1")
0^25^B29175259
"RTN","PSJOEA1",1,0)
PSJOEA1 ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127**;16 DEC 97
"RTN","PSJOEA1",3,0)
 ;
"RTN","PSJOEA1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA1",6,0)
 ;
"RTN","PSJOEA1",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed.
"RTN","PSJOEA1",8,0)
 N COMQUIT,PSJCOMV,PSJOT,PSJSTAT,PSJSTAT2,PSGND2P5,DUR,ND14,PSJPREX S (PSJCOMV,COMQUIT)=0,PSJSTAT2=""
"RTN","PSJOEA1",9,0)
 I '$D(^TMP("PSJCOM",$J)) Q
"RTN","PSJOEA1",10,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:COMQUIT  S PSJOT=$P(^PS(53.1,PSJO,0),"^",4) D
"RTN","PSJOEA1",11,0)
 . I '$D(^TMP("PSJCOM",$J,PSJO,0)) M ^TMP("PSJCOM",$J,PSJO)=^PS(53.1,PSJO) I '$D(^TMP("PSJCOM",$J,PSJO,0)) S COMQUIT=2 Q:COMQUIT
"RTN","PSJOEA1",12,0)
 . S PSJSTAT=$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)
"RTN","PSJOEA1",13,0)
 . I PSJSTAT="DE" S PSJSTAT=$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9) I PSJSTAT="" S COMQUIT=1 Q
"RTN","PSJOEA1",14,0)
 . S:PSJSTAT2="" PSJSTAT2=PSJSTAT S:PSJSTAT'=PSJSTAT2 COMQUIT=2 Q:COMQUIT  S PSJSTAT2=PSJSTAT
"RTN","PSJOEA1",15,0)
 I COMQUIT,PSJOT="U",$G(^TMP("PSJCOM",$J))'="A" S:$G(PSJOWALL)]"" $P(^PS(55,PSGP,5.1),U)=PSJOWALL
"RTN","PSJOEA1",16,0)
 I (COMQUIT=2)!(COMQUIT&($G(^TMP("PSJCOM",$J))'="A")) W !,"By not finishing all the orders, none of the orders will be updated." D PAUSE^VALM1 Q
"RTN","PSJOEA1",17,0)
 I 'COMQUIT N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA1",18,0)
 .S PSGS0Y=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5),PSGS0XT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",6)
"RTN","PSJOEA1",19,0)
 .N EDITS0Y,EDITS0XT S EDITS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5),EDITS0XT=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",6) D
"RTN","PSJOEA1",20,0)
 ..S:EDITS0Y PSGS0Y=EDITS0Y I EDITS0XT!(",O,D,"[(","_EDITS0XT_",")) S PSGS0XT=EDITS0XT
"RTN","PSJOEA1",21,0)
 .N DIE,DA,DR S DR="28////^S X=$P(^TMP(""PSJCOM"",$J,+PSJO,0),""^"",9)",DA=+PSJO,DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",22,0)
 .N DIK,DA S DIK="^PS(53.1,",DA=+PSJO S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA1",23,0)
 .M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO)
"RTN","PSJOEA1",24,0)
 .S PSGND=$G(^PS(53.1,+PSJO,0)),PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2),ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P")
"RTN","PSJOEA1",25,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,24)="R" D
"RTN","PSJOEA1",26,0)
 ..N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D
"RTN","PSJOEA1",27,0)
 ...S:'$G(PSGP) PSGP=$G(DFN) Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",28,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA1",29,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA1",30,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA1",31,0)
 ...D START^PSGOTR(+PSJO_"P",+PSGORDR) I OEORD D
"RTN","PSJOEA1",32,0)
 ....K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD
"RTN","PSJOEA1",33,0)
 ....S:$P(PNDP2,U,8) DR=DR_";125////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA1",34,0)
 ....D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(DFN,PSGORDR)
"RTN","PSJOEA1",35,0)
 ..I '$G(COMQUIT) S ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P") I $G(ND14) S DA=+$P(PSGND,U,25) I DA D UPDREN^PSGOER(DA,$P(ND14,U),$P(ND14,U,3),$P(ND14,U,4),$P($G(^PS(53.1,+PSJO,.2)),U,3),$P(ND14,U,2)) D
"RTN","PSJOEA1",36,0)
 ...K PSJPREX I $G(PSGORDR)["U" I $G(PSJORD)=+$G(PSJORD) D CMPLX2^PSJCOM1(DFN,PSJORD,PSGORDR) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA1",37,0)
 .I '$G(PSGP) S:$G(DFN) PSGP=DFN
"RTN","PSJOEA1",38,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,24)="R",$P(PSGND,U,25),$P($G(^PS(53.1,+PSJO,2)),U,2)<$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3) D
"RTN","PSJOEA1",39,0)
 ..K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",""IV"",",DR=".03////"_$P($G(^PS(53.1,+PSJO,2)),U,2)_";116////"_$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3)
"RTN","PSJOEA1",40,0)
 ..D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25)) L -^PS(53.1,+PSJO)
"RTN","PSJOEA1",41,0)
 .I $P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),(",N,A,"[$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)) D
"RTN","PSJOEA1",42,0)
 ..S:'$G(PSGP) PSGP=DFN S PSGS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",43,0)
 ..N DA,DR,DIE D ENGNN^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"P",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA1",44,0)
 ..S DR="28////^S X=$P(^TMP(""PSJCOM2"",$J,+PSJO,0),""^"",9)",DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",45,0)
 ..M ^PS(53.1,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^TMP("PSJCOM2",$J,DA)=^TMP("PSJCOM2",$J,+PSJO) N PSJOCHIL S PSJOCHIL=$P(^PS(53.1,DA,.2),"^",8) I PSJOCHIL S ^PS(53.1,"ACX",+PSJOCHIL,DA)=""
"RTN","PSJOEA1",46,0)
 ..I $P(^PS(53.1,+PSJO,2),"^",5)'=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5) S $P(^PS(53.1,+PSJO,2),"^",5)=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5)
"RTN","PSJOEA1",47,0)
 ..D EN1^PSJHL2(PSGP,"OD",+PSJO_"P"),EN1^PSJHL2(PSGP,"SN",+DA_"P")
"RTN","PSJOEA1",48,0)
 ..K ^PS(53.1,"ACX",PSJORD,PSJO) L -^PS(53.1,+PSJO) L -^PS(53.1,DA)
"RTN","PSJOEA1",49,0)
 I '$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:PSJCOMV  D
"RTN","PSJOEA1",50,0)
 .I '$D(^TMP("PSJCOM",$J,PSJO)) D  Q:$G(PSJCOMV)
"RTN","PSJOEA1",51,0)
 ..N EDITND0,PREV,REAS S EDITND0=$G(^PS(53.1,+PSJO,0)) S PREV=$P(EDITND0,"^",25),REAS=$P(EDITND0,"^",24)
"RTN","PSJOEA1",52,0)
 ..I PREV,REAS="E" I $P($G(^PS(53.1,+PREV,0)),"^",9)="DE" M ^TMP("PSJCOM",$J,+PSJO)=^PS(53.1,+PSJO) K ^TMP("PSJCOM",$J,+PREV),^PS(53.1,"ACX",+PREV) Q
"RTN","PSJOEA1",53,0)
 ..S PSJCOMV=1
"RTN","PSJOEA1",54,0)
 .I $P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",'$D(^TMP("PSJCOM2",$J,PSJO,0)) S PSJCOMV=1 Q
"RTN","PSJOEA1",55,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9)'="A" S PSJCOMV=1 Q
"RTN","PSJOEA1",56,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)'="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",17)'="A" S PSJCOMV=1
"RTN","PSJOEA1",57,0)
 I ($G(COMQUIT)=2)!(($G(COMQUIT)!PSJCOMV)&$G(^TMP("PSJCOM",$J))="A") K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J) W !,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJOEA1",58,0)
 ; 
"RTN","PSJOEA1",59,0)
 D CHK^PSJOEA2
"RTN","PSJOEA1",60,0)
 Q
"RTN","PSJOEA2")
0^29^B27378204
"RTN","PSJOEA2",1,0)
PSJOEA2 ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**127**;16 DEC 97
"RTN","PSJOEA2",3,0)
 ;
"RTN","PSJOEA2",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA2",6,0)
 ;
"RTN","PSJOEA2",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed, continued.
"RTN","PSJOEA2",8,0)
 I 'PSJCOMV,'$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  S PSGORD=+PSJO_"P",PSGND=$G(^PS(53.1,+PSJO,0)) D
"RTN","PSJOEA2",9,0)
 .S PSGP=$P(PSGND,"^",15)
"RTN","PSJOEA2",10,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="A",($P(PSGND,U,24)'="R") D ^PSGOT D  Q
"RTN","PSJOEA2",11,0)
 ..M ^PS(55,PSGP,5,+PSGORD,4)=^PS(53.1,PSJO,4)
"RTN","PSJOEA2",12,0)
 ..N PSGND2P5 S PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2) I $G(DUR)]"" N DA,DR,DIE S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,DR="126////"_$G(DUR) D ^DIE
"RTN","PSJOEA2",13,0)
 ..D ACTLOG^PSJOEA(PSJO,PSGP,PSGORD)
"RTN","PSJOEA2",14,0)
 ..S VND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJOEA2",15,0)
 ..I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSJOEA2",16,0)
 ..S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSJOEA2",17,0)
 ..I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSJOEA2",18,0)
 ..I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSJOEA2",19,0)
 ..I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSJOEA2",20,0)
 ..S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSJOEA2",21,0)
 ..S PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO) S $P(^PS(55,PSGP,5,+PSGORD,4),"^",9)=1
"RTN","PSJOEA2",22,0)
 ..D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSJOEA2",23,0)
 ..D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSJOEA2",24,0)
 ..S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,PSGORD) K PSJPREX
"RTN","PSJOEA2",25,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="A" D GT531^PSIVORFA(PSGP,PSJO_"P") D  Q
"RTN","PSJOEA2",26,0)
 ..S ON55="" I $P(PSGND,"^",24)="R" S ON55=$P(PSGND,"^",25) D
"RTN","PSJOEA2",27,0)
 ...N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0),PSGORDR=$P(PND0,U,25)
"RTN","PSJOEA2",28,0)
 ...Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",29,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_",""IV"",",FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA2",30,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA2",31,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA2",32,0)
 ...Q:'$G(OEORD)  K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=110_"////"_+OEORD
"RTN","PSJOEA2",33,0)
 ...S:$P(PNDP2,U,8) DR=DR_";150////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA2",34,0)
 ...D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",35,0)
 ..I 'ON55 D SETNEW^PSIVORFB
"RTN","PSJOEA2",36,0)
 ..S (P("NEWON"),ON)=ON55,PSGP=$P(PSGND,U,15)
"RTN","PSJOEA2",37,0)
 ..S VND4=$G(^TMP("PSJCOM",$J,+PSJO,4)) D
"RTN","PSJOEA2",38,0)
 ...N PSJRN,PSJRNDT,PSJRPH,PSJRPHD,PSJPVFL,PSJNVFL,DR,DIE,DA
"RTN","PSJOEA2",39,0)
 ...S (PSJPVFL,PSJNVFL)=""
"RTN","PSJOEA2",40,0)
 ...S PSJRN=$P(VND4,U,1),PSJRNDT=$P(VND4,U,2),PSJRPH=$P(VND4,U,3),PSJRPHD=$P(VND4,U,4),PSJPVFL=$P(VND4,U,16) S:PSJRN]"" PSJNVFL=1
"RTN","PSJOEA2",41,0)
 ...S DR="16////"_PSJRN_";17////"_PSJRNDT_";140////"_PSJRPH_";141////"_PSJRPHD_";142////"_PSJPVFL_";143////"_PSJNVFL
"RTN","PSJOEA2",42,0)
 ...S DA(1)=PSGP,DA=+ON55,DIE="^PS(55,"_PSGP_",""IV""," D ^DIE
"RTN","PSJOEA2",43,0)
 ..D:P("RES")="R" RUPDATE^PSIVOREN(PSGP,ON,P(2))
"RTN","PSJOEA2",44,0)
 ..I +PSJSYSU=3 K OD D ^PSIVORE1 ;LABEL STUFF
"RTN","PSJOEA2",45,0)
 ..I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D  Q
"RTN","PSJOEA2",46,0)
 ...NEW DIC,DA,X,Y,XX D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJOEA2",47,0)
 ...S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJOEA2",48,0)
 ...S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJOEA2",49,0)
 ...S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJOEA2",50,0)
 ...D FILE^DICN
"RTN","PSJOEA2",51,0)
 ...N DIK,DA,PSIVACT S DIK="^PS(55,"_DFN_",""IV"",",DA=+ON,PSIVACT="" S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA2",52,0)
 ...S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO)
"RTN","PSJOEA2",53,0)
 ...D EN1^PSJHL2(DFN,"SC",ON)
"RTN","PSJOEA2",54,0)
 ...D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON) L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",55,0)
 ..L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",56,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",57,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",58,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",59,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",60,0)
 K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJOWALL
"RTN","PSJOEA2",61,0)
 Q
"RTN","PSJOREN")
0^31^B13957518
"RTN","PSJOREN",1,0)
PSJOREN ;BIR/CML3-INTERFACE FOR INPATIENT PHARMACY AND OE/RR ;07 AUG 97 / 3:21 PM
"RTN","PSJOREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**109,127**;16 DEC 97
"RTN","PSJOREN",3,0)
 ;
"RTN","PSJOREN",4,0)
 ;Reference to ^ORD(100.98 supported by DBIA 873
"RTN","PSJOREN",5,0)
 ;Reference to ^PS(51.2 supported by DBIA 2178
"RTN","PSJOREN",6,0)
 ;Reference to ^PS(55 supported by DBIA 2191
"RTN","PSJOREN",7,0)
 ;
"RTN","PSJOREN",8,0)
ENTRY ;
"RTN","PSJOREN",9,0)
 K PSGOEE,PSGOES
"RTN","PSJOREN",10,0)
 ;S PSJORPF=0 S:ORNP PSJORPV=ORNP,PSJORPVN=$P(^VA(200,+ORNP,0),"^"),X=$G(^("PS")) I $S('ORNP:1,'X:1,'$P(X,"^",4):0,1:$P(X,"^",4)'>DT) D PS I PSJORPF G OUT
"RTN","PSJOREN",11,0)
 I '$D(^DPT(+ORVP,.1)) W !!,"THIS PATIENT HAS NOT BEEN ADMITTED.",!,"(Any non-IV orders entered will be discontinued by the pharmacist...)"
"RTN","PSJOREN",12,0)
 ;
"RTN","PSJOREN",13,0)
GO ; get orders
"RTN","PSJOREN",14,0)
 ; S PSJORPCL=XQORNOD,PSJORNS=+XQORNOD,PSJORL=ORL,PSJORTS=ORTS,PSJORVP=ORVP
"RTN","PSJOREN",15,0)
 S PSGOEORF=1,PSGOEAV=0,PSJORTOU=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",0)),PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=PSJORPV
"RTN","PSJOREN",16,0)
 F  S PSGOEOS="U" D ^PSGOE7 Q:Y<0  D:X?1"S."1.E ^PSGOES I X'?1."S."1.E D ^PSGOE6 K PSGOEE D:$D(Y) ^PSGOETO
"RTN","PSJOREN",17,0)
 ;
"RTN","PSJOREN",18,0)
DONE ;
"RTN","PSJOREN",19,0)
 ; I $P(PSJSYSL,"^",2)]"" S PSGOP=PSGP D ENQL^PSGLW
"RTN","PSJOREN",20,0)
 ;
"RTN","PSJOREN",21,0)
OUT ;
"RTN","PSJOREN",22,0)
 ; S PSJNKF=1 D ENIVKV^PSGSETU K PSJORPCL,PSJORTOI,PSJORTOU,PSJORPV,PSJORPVN,PSJORNS,PSJORVP,PSJORL,PSJORTS,PSGOEORF,PSGOEAV,PSJORPF,PSJORQF,PSJPV,PSGOEOS Q
"RTN","PSJOREN",23,0)
 Q  ;
"RTN","PSJOREN",24,0)
PS ;
"RTN","PSJOREN",25,0)
 W $C(7),!!,"The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications."
"RTN","PSJOREN",26,0)
 K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSG=$G(^(""PS"")) I PSG,$S('$P(PSG,""^"",4):1,1:DT<$P(PSG,""^"",4))" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSJOREN",27,0)
 K DIC S:Y'>0 PSJORPF=11 S:Y>0 PSJORPV=+Y,PSJORPVN=Y(0,0) Q
"RTN","PSJOREN",28,0)
 Q
"RTN","PSJOREN",29,0)
ENBKOUT(DFN,ON) ; Undo Renew.
"RTN","PSJOREN",30,0)
 Q:'$G(ON)
"RTN","PSJOREN",31,0)
 N PSJOLD,PSJRES,PSJOC,PSJOC2,PSIVACT,PSIVALT,PSIVREA,ON55,PSGAL,DA,PSIVAL,PSJUNDC
"RTN","PSJOREN",32,0)
 S PSJOC=PSOC,PSJOC2=PSJHLMTN,PSIVAL=24000
"RTN","PSJOREN",33,0)
 S X=$G(^PS(53.1,+ON,0)) Q:'X
"RTN","PSJOREN",34,0)
 S PSJRES=$P(X,U,24),(X,PSJOLD)=$P(X,U,25)
"RTN","PSJOREN",35,0)
 I PSJOLD["V" S:$D(^PS(55,DFN,"IV",+PSJOLD,2)) $P(^(2),U,6)="",$P(^(2),U,9)="",$P(^(0),U,17)="A",PSIVACT=1,PSIVALT=$S(PSOC="CR":2,1:1),PSJUNDC=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U),PSIVREA="PNRD",ON55=PSJOLD D LOG^PSIVORAL
"RTN","PSJOREN",36,0)
 I PSJOLD["U" S:$D(^PS(55,DFN,5,+PSJOLD,0)) $P(^(0),U,26,27)=U,$P(^(0),U,9)="A",PSGAL("C")=24000,DA=+PSJOLD,DA(1)=DFN D ^PSGAL5
"RTN","PSJOREN",37,0)
 S PSOC="SC",PSJHLMTN="ORM" D EN1^PSJHL2(DFN,PSOC,PSJOLD) S PSOC=PSJOC,PSJHLMTN=PSJOC2
"RTN","PSJOREN",38,0)
 Q
"RTN","PSJOREN",39,0)
 ;
"RTN","PSJOREN",40,0)
ENUDTX(DFN,ON,RES) ; Set up ORTX( Array for UD orders.
"RTN","PSJOREN",41,0)
 K ORTX N DO,MRN,ND0,NDP1,ND2,PD,ST,SCH
"RTN","PSJOREN",42,0)
 S Y=2 I ON["A"!(ON["O") S ND0=$G(^PS(55,DFN,5,+ON,0)),NDP1=$G(^(.1)),ND2=$G(^(2)),Y=2 F X=0:0 S X=$O(^PS(55,DFN,5,+ON,12,X)) Q:'X  S Y=Y+1,ORTX(Y)=$G(^(X,0))
"RTN","PSJOREN",43,0)
 E  S ND0=$G(^PS(53.1,+ON,0)),NDP1=$G(^(.1)),ND2=$G(^(2)),Y=2 F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Y=Y+1,ORTX(Y)=$G(^(X,0))
"RTN","PSJOREN",44,0)
 S ORTX(1)=$S($G(RES)="NR":"RENEWAL -",$G(RES)="OR":"RENEWED -",1:"")_$P($G(^PS(50.3,+NDP1,0)),U)
"RTN","PSJOREN",45,0)
 S ORTX(2)=" Give: "_$S($P(NDP1,U,2)]"":$P(NDP1,U,2)_" ",1:"")_$P($G(^PS(51.2,+$P(ND0,U,3),0)),U,3)_" "_$P(ND2,U)_$S($P(ND2,U)["PRN":"",$P(ND0,U,7)="P":" PRN",1:"")
"RTN","PSJOREN",46,0)
 I $G(DFN),$G(ON) S:ON["U" ^PS(55,"AUE",DFN,+ON)=""
"RTN","PSJOREN",47,0)
 Q
"RTN","PSJORPOE")
0^34^B26853302
"RTN","PSJORPOE",1,0)
PSJORPOE ;BIR/MLM,LDT-MISC. PROCEDURE CALLS FOR OE/RR 3.0 ;24 Feb 99 / 10:43 AM
"RTN","PSJORPOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,56,92,80,110,127**;16 DEC 97
"RTN","PSJORPOE",3,0)
 ;
"RTN","PSJORPOE",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJORPOE",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJORPOE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJORPOE",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJORPOE",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJORPOE",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJORPOE",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJORPOE",11,0)
 ;
"RTN","PSJORPOE",12,0)
STARTSTP(PSGP,SCH,OI,PSJPWD,PSGORD) ;
"RTN","PSJORPOE",13,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",14,0)
 ; SCH=Schedule
"RTN","PSJORPOE",15,0)
 ; OI=Orderable Item        
"RTN","PSJORPOE",16,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",17,0)
 ; PSGORD=Pharmacy Order Number if the order being placed is a Renewal (Optional)
"RTN","PSJORPOE",18,0)
 ;
"RTN","PSJORPOE",19,0)
 Q:+PSGP'>0 ""
"RTN","PSJORPOE",20,0)
 Q:SCH']"" ""
"RTN","PSJORPOE",21,0)
 Q:+OI'>0 ""
"RTN","PSJORPOE",22,0)
 I SCH?.E1L.E S SCH=$$ENLU^PSGMI(SCH)
"RTN","PSJORPOE",23,0)
 K DFN,PSGNEFDO,PSGNEFD,PSGST,PSGSCH,PSGNEDFD,PSGNESD,PSJSYSW,PSJSYSW0
"RTN","PSJORPOE",24,0)
 S:'$D(PSGS0XT) PSGS0XT="" S:'$D(PSGS0Y) PSGSOY=""
"RTN","PSJORPOE",25,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",26,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",27,0)
 S RESULT=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",28,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",29,0)
 N %,PSGXSCH D NOW^%DTC S PSGDT=%,DFN=PSGP,(PSGSCH,PSGXSCH)=SCH
"RTN","PSJORPOE",30,0)
 S X=PSGSCH D ADMIN
"RTN","PSJORPOE",31,0)
 I $G(PSGORD)]"" D
"RTN","PSJORPOE",32,0)
 .S PSGNESD=$$DSTART^PSJDCU(PSGP,PSGORD) I PSGNESD]"" S RESULT=RESULT_"^"_PSGNESD Q
"RTN","PSJORPOE",33,0)
 .S ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,2)),1:$G(^PS(55,PSGP,"IV",+PSGORD,0)))
"RTN","PSJORPOE",34,0)
 .N PSJADM,PSJSTRT S PSJADM=$S(PSGORD["U":$P(ND,"^",5),1:$P(ND,"^",11)),PSJSTRT=$P(ND,"^",2),PSJREN=1
"RTN","PSJORPOE",35,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",36,0)
 I $G(PSGNESD)="" S RESULT=RESULT_"^"_$$ENSD^PSGNE3(PSGSCH,$S($G(PSJADM)]"":$G(PSJADM),1:PSGS0Y),PSGDT,$S($G(PSJSTRT)]"":$G(PSJSTRT),1:PSGDT))
"RTN","PSJORPOE",37,0)
 ;S Y=$P(RESULT,"^",2) X ^DD("DD") S RESULT=RESULT_"^"_Y
"RTN","PSJORPOE",38,0)
 S PSGNESD=$P(RESULT,"^",2)
"RTN","PSJORPOE",39,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",OI)
"RTN","PSJORPOE",40,0)
 K PSGODF,PSGOES,PSJREN
"RTN","PSJORPOE",41,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",42,0)
 D ENFD^PSGNE3(PSGDT) S RESULT=RESULT_"^"_$G(PSGNEFD) ;_"^"_$G(PSGNEFDO)
"RTN","PSJORPOE",43,0)
 N DATE S DATE=$$FMDIFF^XLFDT($P(RESULT,"^",3),$P(RESULT,"^",2),3)
"RTN","PSJORPOE",44,0)
 S $P(RESULT,"^",3)=$S($G(PSGST)="O":0,+DATE>0:+DATE_"D",$P($P(DATE," ",2),":")>0:$P($P(DATE," ",2),":")_"H",1:0)
"RTN","PSJORPOE",45,0)
 ;S RESULT=RESULT_"^"_$P($$RESOLVE(PSGP,SCH,OI,"NEXT"),"^",2)
"RTN","PSJORPOE",46,0)
 N STRING S STRING=PSGNESD_U_PSGNEFD_U_$G(PSGSCH)_U_$G(PSGST)_U_$G(OI) I ($P($G(ZZND),U,2)]"") S STRING=STRING_U_$P(ZZND,U,2)
"RTN","PSJORPOE",47,0)
 S RESULT=RESULT_"^"_$$ENQ^PSJORP2(PSGP,STRING)
"RTN","PSJORPOE",48,0)
 D KVAR^VADPT K LYN,ND,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ
"RTN","PSJORPOE",49,0)
 ;RESULT=WARD PARAMETER^DEFAULT START DATE/TIME^#_D(NUMBER OF DAYS ORDER LASTS) OR #_H(NUMBER OF HOURS ORDER LASTS)^EXPECTED FIRST DOSE
"RTN","PSJORPOE",50,0)
 Q RESULT
"RTN","PSJORPOE",51,0)
 ;
"RTN","PSJORPOE",52,0)
RESOLVE(PSGP,SCH,OI,PCH,PSJPWD) ;
"RTN","PSJORPOE",53,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",54,0)
 ; SCH=Schedule
"RTN","PSJORPOE",55,0)
 ; OI=Orderable Item
"RTN","PSJORPOE",56,0)
 ; PCH=Providers Choice
"RTN","PSJORPOE",57,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",58,0)
 ;
"RTN","PSJORPOE",59,0)
 N PSJSYSW0,PSJSYSW,PSGSCH,PSGOES,PSGS0Y,DFN
"RTN","PSJORPOE",60,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",61,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",62,0)
 S $P(PSJSYSW0,"^",5)=$S($$ONE(SCH):2,PCH="NEXT":1,1:0)
"RTN","PSJORPOE",63,0)
 S RESULT1=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",64,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",65,0)
 N % D NOW^%DTC S PSGDT=%,DFN=PSGP,PSGSCH=SCH
"RTN","PSJORPOE",66,0)
 S X=PSGSCH D ADMIN
"RTN","PSJORPOE",67,0)
 S RESULT1=RESULT1_"^"_$$ENSD^PSGNE3(SCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSJORPOE",68,0)
 D KVAR^VADPT K LYN,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ,PSGS0XT,PSGS0Y
"RTN","PSJORPOE",69,0)
 Q RESULT1
"RTN","PSJORPOE",70,0)
 ;
"RTN","PSJORPOE",71,0)
SCHREQ(MR,OI,DD)  ;
"RTN","PSJORPOE",72,0)
 ; MR=Medication Route from 51.2 (Required)
"RTN","PSJORPOE",73,0)
 ; OI=Orderable Item from 50.7 (Optional)
"RTN","PSJORPOE",74,0)
 ; DD=Dispense Drug from 50 (Optional)
"RTN","PSJORPOE",75,0)
 N ADDITIVE,SOLUTION S REQ=0,(SOLUTION,ADDITIVE)=""
"RTN","PSJORPOE",76,0)
 I '+$G(MR) S REQ=1 Q REQ
"RTN","PSJORPOE",77,0)
 I '+$G(OI),'+$G(DD) S REQ=1 Q REQ
"RTN","PSJORPOE",78,0)
 I +$G(DD) S:$P($G(^PSDRUG(+DD,2)),U,3)["U" REQ=1 Q REQ
"RTN","PSJORPOE",79,0)
 I '$D(PS(51.2,+MR,0)) S REQ=1 Q REQ
"RTN","PSJORPOE",80,0)
 I $P($G(^PS(51.2,+MR,0)),"^",6)=1 D
"RTN","PSJORPOE",81,0)
 .I +$G(OI) D
"RTN","PSJORPOE",82,0)
 ..I '$D(^PS(50.7,+OI,0)) S REQ=1 Q
"RTN","PSJORPOE",83,0)
 ..F  S SOLUTION=$O(^PS(52.7,"AOI",+OI,SOLUTION)) Q:'SOLUTION  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.7,SOLUTION,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",84,0)
 ..F  S ADDITIVE=$O(^PS(52.6,"AOI",+OI,ADDITIVE)) Q:'ADDITIVE  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.6,ADDITIVE,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",85,0)
 Q REQ
"RTN","PSJORPOE",86,0)
 ;
"RTN","PSJORPOE",87,0)
ADMIN ; Get admin times associated with schedule
"RTN","PSJORPOE",88,0)
 S PSGS0Y="",ZZ=0
"RTN","PSJORPOE",89,0)
 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSJORPOE",90,0)
 S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) I $G(PSJPWD) D
"RTN","PSJORPOE",91,0)
 . N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y
"RTN","PSJORPOE",92,0)
 S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSJORPOE",93,0)
 I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2)
"RTN","PSJORPOE",94,0)
 Q:PSGS0Y]""  S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  Q:PSGS0Y]""  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSJORPOE",95,0)
 Q
"RTN","PSJORPOE",96,0)
 ;
"RTN","PSJORPOE",97,0)
ONE(SCH) ;
"RTN","PSJORPOE",98,0)
 ; SCH=Admin Schedule
"RTN","PSJORPOE",99,0)
 ; Returns 0 = (zero) Not a one time schedule.
"RTN","PSJORPOE",100,0)
 ;         1 =  One time schedule. 
"RTN","PSJORPOE",101,0)
 Q:$G(SCH)="" 0
"RTN","PSJORPOE",102,0)
 N X,SCHLST
"RTN","PSJORPOE",103,0)
 S SCHLST=",TODAY,ONCE,NOW,ONE TIME,ONETIME,ONE-TIME,1TIME,1 TIME,1-TIME,STAT,"
"RTN","PSJORPOE",104,0)
 I SCHLST[(","_SCH_",") Q 1
"RTN","PSJORPOE",105,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="O":1,1:0)
"RTN","PSJORPOE",106,0)
 Q 0
"RTN","PSJORREN")
0^11^B19932169
"RTN","PSJORREN",1,0)
PSJORREN ;BIR/MV-RENEWAL FLAG ;6 DEC 00 / 3:11 PM 
"RTN","PSJORREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,70,58,89,91,110,127**;16 DEC 97
"RTN","PSJORREN",3,0)
 ;
"RTN","PSJORREN",4,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180
"RTN","PSJORREN",5,0)
 ; References to ^PS(52.6 supported by DBIA #1231
"RTN","PSJORREN",6,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSJORREN",7,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSJORREN",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORREN",9,0)
 ;
"RTN","PSJORREN",10,0)
ACTIVE(DFN,ON) ;
"RTN","PSJORREN",11,0)
 ;DFN: Patient IEN
"RTN","PSJORREN",12,0)
 ;ON : Order number_"U/V/P"
"RTN","PSJORREN",13,0)
 ;Output: 0^reason not renewable (Can't renew)
"RTN","PSJORREN",14,0)
 ;        2^New OI (Need to create a new order as in edit)
"RTN","PSJORREN",15,0)
 ;          note: with PSJ*5*70 - instead of 2, IV order will return 0
"RTN","PSJORREN",16,0)
 ;        1 (OK to renew)
"RTN","PSJORREN",17,0)
 NEW PSJRT,PSJEXP
"RTN","PSJORREN",18,0)
 D:ON["U" UD
"RTN","PSJORREN",19,0)
 D:ON["V" IV
"RTN","PSJORREN",20,0)
 I (+$G(PSJRT)=1) S PSJEXP=$$EXPIRED^PSGOER(DFN,ON) I PSJEXP S PSJRT="0^Expired Time Limit Exceeded"
"RTN","PSJORREN",21,0)
 Q $G(PSJRT)
"RTN","PSJORREN",22,0)
UD ;
"RTN","PSJORREN",23,0)
 ;If both PSJRT(2) & (3) existed it meant order has multiple DDs and one
"RTN","PSJORREN",24,0)
 ;is tied to a different OI. It's best to not allow renewal of the order.
"RTN","PSJORREN",25,0)
 ;
"RTN","PSJORREN",26,0)
 NEW PSJDD,PSJDDOI,PSJDDX,PSJACT,PSJOI,PSJOIACT,PSJUSE,PSJPRI,X,ND2
"RTN","PSJORREN",27,0)
 K PSJRT
"RTN","PSJORREN",28,0)
 S PSJOI=+^PS(55,DFN,5,+ON,.2)
"RTN","PSJORREN",29,0)
 S PSJPRI=$P(^PS(55,DFN,5,+ON,.2),"^",4)
"RTN","PSJORREN",30,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",31,0)
 S ND0=$G(^PS(55,DFN,5,+ON,0)) I $P(ND0,"^",7)="O" S PSJRT="0^One Time orders may not be renewed" Q
"RTN","PSJORREN",32,0)
 N PSJCANT,PSJDAD,NDP2,PSJORKID,PSJKID S NDP2=$G(^PS(55,DFN,5,+ON,.2)),PSJDAD=$P(NDP2,"^",8) I PSJDAD D
"RTN","PSJORREN",33,0)
 .S PSJORKID="" F  S PSJORKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID)) Q:'PSJORKID!$G(PSJCANT)  S PSJKID="" F  S PSJKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID,PSJKID)) Q:'PSJKID!$G(PSJCANT)  D
"RTN","PSJORREN",34,0)
 ..S ND0=$G(^PS(55,DFN,5,+PSJKID,2)) I $P(ND0,"^",7)="O" S PSJRT="0^Complex Orders with One-Time doses may not be renewed",PSJCANT=1
"RTN","PSJORREN",35,0)
 Q:$G(PSJCANT)
"RTN","PSJORREN",36,0)
 F PSJDD=0:0 S PSJDD=$O(^PS(55,DFN,5,+ON,1,PSJDD)) Q:('PSJDD!$D(PSJRT(1)))  D
"RTN","PSJORREN",37,0)
 . S (PSJACT,PSJOIACT)=0 S PSJDDX=^PS(55,DFN,5,+ON,1,PSJDD,0)
"RTN","PSJORREN",38,0)
 . S X=$P(PSJDDX,U,3) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",39,0)
 . S X=$G(^PSDRUG(+PSJDDX,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",40,0)
 . S X=$G(^PSDRUG(+PSJDDX,2)),PSJUSE=$P(X,U,3)["U",PSJDDOI=+X I '+PSJDDOI S PSJRT(3)="0^Dispense drug is not matched to an Orderable Item" Q
"RTN","PSJORREN",41,0)
 . S X=$P($G(^PS(50.7,+PSJDDOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",42,0)
 . I 'PSJACT,PSJUSE D  Q
"RTN","PSJORREN",43,0)
 .. I PSJOI=PSJDDOI D  Q
"RTN","PSJORREN",44,0)
 ... I 'PSJOIACT S PSJRT(1)=1 Q
"RTN","PSJORREN",45,0)
 ... S:PSJOIACT PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",46,0)
 .. I +PSJDDOI,(PSJOI'=PSJDDOI) D
"RTN","PSJORREN",47,0)
 ... S:'PSJOIACT PSJRT(2)="2"_U_PSJDDOI
"RTN","PSJORREN",48,0)
 ... S:PSJOIACT PSJRT(3)="0^Dispense drug ties to an inactive Orderable Item"
"RTN","PSJORREN",49,0)
 . I PSJACT S PSJRT(3)="0^This drug has been Inactivated"
"RTN","PSJORREN",50,0)
 . I 'PSJUSE S PSJRT(3)="0^Drug is No longer used in Inpatient Meds"
"RTN","PSJORREN",51,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",52,0)
 I $D(PSJRT(2)),$D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",53,0)
 I '$D(PSJRT) S PSJRT="0^Order has no Dispense drug" Q
"RTN","PSJORREN",54,0)
 S X=$O(PSJRT(0)),PSJRT=$G(PSJRT(X))
"RTN","PSJORREN",55,0)
 Q
"RTN","PSJORREN",56,0)
IV ;
"RTN","PSJORREN",57,0)
 NEW FIL,PSJACT,PSJAS,PSJASNO,PSJASOI,PSJCNT,PSJIEN,PSJOI,PSJOIACT,PSJPRI,X
"RTN","PSJORREN",58,0)
 K PSJRT
"RTN","PSJORREN",59,0)
 S PSJCNT=0
"RTN","PSJORREN",60,0)
 S PSJOI=+$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJORREN",61,0)
 S PSJPRI=$P(^PS(55,DFN,"IV",+ON,.2),"^",4)
"RTN","PSJORREN",62,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",63,0)
 N ND2,PSBACT,IVSCHED
"RTN","PSJORREN",64,0)
 S ND0=$G(^PS(55,DFN,"IV",+ON,0)) I ($P(ND0,"^",4)="P")!($P(ND0,"^",23)="P")!$P(ND0,"^",5) D  Q:$G(PSJRT)]""
"RTN","PSJORREN",65,0)
 .N X,PSGOES,ZZND S PSGOES=2,X=$P(ND0,"^",9) D ENOS^PSGS0 Q:($G(X)="")!($P($G(ZZND),"^",5)'="O")
"RTN","PSJORREN",66,0)
 .S PSJRT="0^This One-Time order may not be renewed"
"RTN","PSJORREN",67,0)
 F FIL="AD","SOL"  F PSJAS=0:0 S PSJAS=$O(^PS(55,DFN,"IV",+ON,FIL,PSJAS)) Q:'PSJAS  D
"RTN","PSJORREN",68,0)
 . S (PSJACT,PSJOIACT)=0
"RTN","PSJORREN",69,0)
 . S PSJASNO=$S(FIL="AD":52.6,1:52.7)
"RTN","PSJORREN",70,0)
 . S PSJIEN=+^PS(55,DFN,"IV",+ON,FIL,PSJAS,0)
"RTN","PSJORREN",71,0)
 . S X=$G(^PS(PSJASNO,+PSJIEN,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",72,0)
 . S PSJASOI=$P(^PS(PSJASNO,PSJIEN,0),U,11)
"RTN","PSJORREN",73,0)
 . S X=$P($G(^PS(50.7,+PSJASOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",74,0)
 . I PSJACT S PSJCNT=PSJCNT+1,PSJRT(3)="0^Inactive "_$S(FIL="AD":"Additive",1:"Solution") Q
"RTN","PSJORREN",75,0)
 . I PSJOI=PSJASOI D  Q
"RTN","PSJORREN",76,0)
 .. I 'PSJOIACT S PSJRT(1)="" Q
"RTN","PSJORREN",77,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",78,0)
 . I PSJOI'=PSJASOI D
"RTN","PSJORREN",79,0)
 .. I 'PSJOIACT S PSJCNT=PSJCNT+1,PSJRT(2)=2_U_PSJASOI
"RTN","PSJORREN",80,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",81,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",82,0)
 I $D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",83,0)
 ;I $D(PSJRT(2)),PSJCNT=1 S PSJRT=PSJRT(2) Q
"RTN","PSJORREN",84,0)
 I $D(PSJRT(2)),PSJCNT=1 S PSJRT="0^New Orderable Item" Q
"RTN","PSJORREN",85,0)
 S PSJRT="0^Inactive drug"
"RTN","PSJORREN",86,0)
 Q
"VER")
8.0^22.0
"^DD",53.1,53.1,125,0)
ORDERS FILE PARENT ORDER^P100'^OR(100,^.2;8^Q
"^DD",53.1,53.1,125,1,0)
^.1^^-1
"^DD",53.1,53.1,125,1,1,0)
53.1^ACX
"^DD",53.1,53.1,125,1,1,1)
S ^PS(53.1,"ACX",$E(X,1,30),DA)=""
"^DD",53.1,53.1,125,1,1,2)
K ^PS(53.1,"ACX",$E(X,1,30),DA)
"^DD",53.1,53.1,125,1,1,"%D",0)
^^5^5^3041213^
"^DD",53.1,53.1,125,1,1,"%D",1,0)
This cross reference is created each time a component of a complex order, 
"^DD",53.1,53.1,125,1,1,"%D",2,0)
or child order, is received from CPRS.
"^DD",53.1,53.1,125,1,1,"%D",3,0)
This cross reference will not be created for orders with a schedule of
"^DD",53.1,53.1,125,1,1,"%D",4,0)
NOW, effectively disassociating the NOW order from the other child orders
"^DD",53.1,53.1,125,1,1,"%D",5,0)
in the complex order.
"^DD",53.1,53.1,125,1,1,"DT")
3030716
"^DD",53.1,53.1,125,3)
Enter the parent order, if this order is its child order.
"^DD",53.1,53.1,125,21,0)
^^2^2^3041213^
"^DD",53.1,53.1,125,21,1,0)
This is the parent of a CPRS order that may have a parent/child
"^DD",53.1,53.1,125,21,2,0)
relationship in CPRS
"^DD",53.1,53.1,125,"AUDIT")

"^DD",53.1,53.1,125,"DT")
3041213
**END**
**END**
