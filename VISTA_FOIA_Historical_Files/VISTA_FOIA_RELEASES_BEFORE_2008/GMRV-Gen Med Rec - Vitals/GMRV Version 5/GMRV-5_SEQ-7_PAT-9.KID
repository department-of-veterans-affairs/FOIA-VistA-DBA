Released GMRV*5*9 SEQ #7
Extracted from mail message
**KIDS**:GMRV*5.0*9^

**INSTALL NAME**
GMRV*5.0*9
"BLD",5489,0)
GMRV*5.0*9^GEN. MED. REC. - VITALS^0^3050805^y
"BLD",5489,1,0)
^^1^1^3050128^
"BLD",5489,1,1,0)
ENTRY OF MIDNIGHT AND MULTIPLE ENTRY SECONDS ISSUES
"BLD",5489,4,0)
^9.64PA^^
"BLD",5489,"INI")
PRE^GMRVP59
"BLD",5489,"INIT")

"BLD",5489,"KRN",0)
^9.67PA^8989.52^19
"BLD",5489,"KRN",.4,0)
.4
"BLD",5489,"KRN",.401,0)
.401
"BLD",5489,"KRN",.402,0)
.402
"BLD",5489,"KRN",.403,0)
.403
"BLD",5489,"KRN",.5,0)
.5
"BLD",5489,"KRN",.84,0)
.84
"BLD",5489,"KRN",3.6,0)
3.6
"BLD",5489,"KRN",3.8,0)
3.8
"BLD",5489,"KRN",9.2,0)
9.2
"BLD",5489,"KRN",9.8,0)
9.8
"BLD",5489,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5489,"KRN",9.8,"NM",1,0)
GMVDCSAV^^0^B19291667
"BLD",5489,"KRN",9.8,"NM","B","GMVDCSAV",1)

"BLD",5489,"KRN",19,0)
19
"BLD",5489,"KRN",19,"NM",0)
^9.68A^^
"BLD",5489,"KRN",19.1,0)
19.1
"BLD",5489,"KRN",101,0)
101
"BLD",5489,"KRN",409.61,0)
409.61
"BLD",5489,"KRN",771,0)
771
"BLD",5489,"KRN",870,0)
870
"BLD",5489,"KRN",8989.51,0)
8989.51
"BLD",5489,"KRN",8989.52,0)
8989.52
"BLD",5489,"KRN",8994,0)
8994
"BLD",5489,"KRN","B",.4,.4)

"BLD",5489,"KRN","B",.401,.401)

"BLD",5489,"KRN","B",.402,.402)

"BLD",5489,"KRN","B",.403,.403)

"BLD",5489,"KRN","B",.5,.5)

"BLD",5489,"KRN","B",.84,.84)

"BLD",5489,"KRN","B",3.6,3.6)

"BLD",5489,"KRN","B",3.8,3.8)

"BLD",5489,"KRN","B",9.2,9.2)

"BLD",5489,"KRN","B",9.8,9.8)

"BLD",5489,"KRN","B",19,19)

"BLD",5489,"KRN","B",19.1,19.1)

"BLD",5489,"KRN","B",101,101)

"BLD",5489,"KRN","B",409.61,409.61)

"BLD",5489,"KRN","B",771,771)

"BLD",5489,"KRN","B",870,870)

"BLD",5489,"KRN","B",8989.51,8989.51)

"BLD",5489,"KRN","B",8989.52,8989.52)

"BLD",5489,"KRN","B",8994,8994)

"BLD",5489,"PRE")
GMRVP59
"BLD",5489,"QUES",0)
^9.62^^
"BLD",5489,"REQB",0)
^9.611^^
"INI")
PRE^GMRVP59
"MBREQ")
0
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,20,0)
^9.402P^^
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
5.0^3021029
"PKG",44,22,1,"PAH",1,0)
9^3050805
"PKG",44,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",44,22,1,"PAH",1,1,1,0)
ENTRY OF MIDNIGHT AND MULTIPLE ENTRY SECONDS ISSUES
"PRE")
GMRVP59
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRVP59")
0^^B2736545
"RTN","GMRVP59",1,0)
GMRVP59 ;BAY/KAM-Patch GMRV*5*9 Install Utility Routine ; 8/5/05 7:14am
"RTN","GMRVP59",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**9**;Apr 15, 2003
"RTN","GMRVP59",3,0)
 ;
"RTN","GMRVP59",4,0)
ENV ;Main Entry point for Environment Check
"RTN","GMRVP59",5,0)
 S XPDABORT=""
"RTN","GMRVP59",6,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","GMRVP59",7,0)
 I XPDABORT="" K XPDABORT
"RTN","GMRVP59",8,0)
 Q
"RTN","GMRVP59",9,0)
PROGCHK(XPDABORT) ; checks for necessary programmer variables
"RTN","GMRVP59",10,0)
 ;
"RTN","GMRVP59",11,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^")  D
"RTN","GMRVP59",12,0)
 . D BMES^XPDUTL("****")
"RTN","GMRVP59",13,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","GMRVP59",14,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","GMRVP59",15,0)
 . D MES^XPDUTL("*****")
"RTN","GMRVP59",16,0)
 . S XPDABORT=2
"RTN","GMRVP59",17,0)
 Q
"RTN","GMRVP59",18,0)
PRE ;Add 1 second to all entries in File 120.5 that do not contain a time
"RTN","GMRVP59",19,0)
 ;entry in piece one
"RTN","GMRVP59",20,0)
 N GMRIEN,DATETIME,X1,X2
"RTN","GMRVP59",21,0)
 K ^XTMP("GMRVP59",$J)
"RTN","GMRVP59",22,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","GMRVP59",23,0)
 I '$D(^XTMP("GMRVP59")) S X1=DT,X2=+90 D C^%DTC S ^XTMP("GMRVP59",0)=$G(X)_"^"_DT
"RTN","GMRVP59",24,0)
 S GMRIEN=""
"RTN","GMRVP59",25,0)
 F  S GMRIEN=$O(^GMR(120.5,GMRIEN)) Q:GMRIEN=""!(GMRIEN'?1.N)  D
"RTN","GMRVP59",26,0)
 . S DATETIME=$P($G(^GMR(120.5,GMRIEN,0)),"^")
"RTN","GMRVP59",27,0)
 . I +$P(DATETIME,".",2)'>0 D
"RTN","GMRVP59",28,0)
 .. S $P(^XTMP("GMRVP59",$J,120.5,GMRIEN),"^")=$G(DATETIME) ; Before
"RTN","GMRVP59",29,0)
 .. N GMRFDA
"RTN","GMRVP59",30,0)
 .. S DATETIME=$$FMADD^XLFDT(DATETIME,"","","",1)
"RTN","GMRVP59",31,0)
 .. S $P(^XTMP("GMRVP59",$J,120.5,GMRIEN),"^",2)=$G(DATETIME) ; After
"RTN","GMRVP59",32,0)
 .. S GMRFDA(120.5,GMRIEN_",",.01)=DATETIME
"RTN","GMRVP59",33,0)
 .. D UPDATE^DIE("","GMRFDA")
"RTN","GMRVP59",34,0)
 Q
"RTN","GMVDCSAV")
0^1^B19291667
"RTN","GMVDCSAV",1,0)
GMVDCSAV ;HOIFO/DAD-VITALS COMPONENT: SAVE DATA ; 8/5/05 7:01am
"RTN","GMVDCSAV",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**9**;Apr 15, 2003
"RTN","GMVDCSAV",3,0)
 ;
"RTN","GMVDCSAV",4,0)
 ; This routine uses the following IAs:
"RTN","GMVDCSAV",5,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","GMVDCSAV",6,0)
 ;
"RTN","GMVDCSAV",7,0)
 ; 01/28/2005 KAM GMRV*5*9 Record midnight with 1 second added
"RTN","GMVDCSAV",8,0)
 ;                         Stop adding second on multiple patent entry
"RTN","GMVDCSAV",9,0)
 ;
"RTN","GMVDCSAV",10,0)
EN1(RESULT,GMVDATA) ; GMV ADD VM [RPC entry point]
"RTN","GMVDCSAV",11,0)
 ; Saves vitals data
"RTN","GMVDCSAV",12,0)
 N GMVCNT,GMVD0,GMVFDA,GMVINUM,GMVQNUM,GMVRNUM,GMVIEN,GMVDUN
"RTN","GMVDCSAV",13,0)
 N GMVVNUM,GMVVMEAS,GMVVQUAL,GMVVREAS
"RTN","GMVDCSAV",14,0)
 D QUALTWO
"RTN","GMVDCSAV",15,0)
 Q
"RTN","GMVDCSAV",16,0)
 ;I $O(@GMVDATA@("V",0))>0 D VITMEA
"RTN","GMVDCSAV",17,0)
 ;I $O(@GMVDATA@("I",0))>0 D ENTERR
"RTN","GMVDCSAV",18,0)
 ;I $G(RESULT(0))="OK" D MSG("OK: Data saved")
"RTN","GMVDCSAV",19,0)
 ;Q
"RTN","GMVDCSAV",20,0)
 ;
"RTN","GMVDCSAV",21,0)
VITMEA ; *** Save vital measurement data ***
"RTN","GMVDCSAV",22,0)
 S GMVVNUM=0 K GMVFDA
"RTN","GMVDCSAV",23,0)
 S GMVCNT=+$O(@GMVDATA@("V",1E25),-1)
"RTN","GMVDCSAV",24,0)
 F  S GMVVNUM=$O(@GMVDATA@("V",GMVVNUM)) Q:GMVVNUM'>0  D
"RTN","GMVDCSAV",25,0)
 . S GMVVMEAS=$G(@GMVDATA@("V",GMVVNUM))
"RTN","GMVDCSAV",26,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.01)=GMVDTDUN ; Date time taken
"RTN","GMVDCSAV",27,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.02)=GMVDFN   ; Patient
"RTN","GMVDCSAV",28,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.03)=$P(GMVVMEAS,U) ;
"RTN","GMVDCSAV",29,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.04)=GMVDTENT  ; Date Time entered
"RTN","GMVDCSAV",30,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.05)=GMVHOSPL  ; Hospital
"RTN","GMVDCSAV",31,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.06)=GMVENTBY  ; Entered by (DUZ)
"RTN","GMVDCSAV",32,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",1.2)=$P($P(GMVVMEAS,U,2),";",1) ; Rate
"RTN","GMVDCSAV",33,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",1.4)=$P($P(GMVVMEAS,U,2),";",2) ; Sup 02
"RTN","GMVDCSAV",34,0)
 . S GMVQNUM=0
"RTN","GMVDCSAV",35,0)
 . F  S GMVQNUM=$O(@GMVDATA@("Q",GMVVNUM,GMVQNUM)) Q:GMVQNUM'>0  D
"RTN","GMVDCSAV",36,0)
 .. S GMVVQUAL=$G(@GMVDATA@("Q",GMVVNUM,GMVQNUM))
"RTN","GMVDCSAV",37,0)
 .. S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",38,0)
 .. S GMVFDA(120.505,"+"_GMVCNT_",","+"_GMVVNUM_",",.01)=GMVVQUAL
"RTN","GMVDCSAV",39,0)
 .. Q
"RTN","GMVDCSAV",40,0)
 . Q
"RTN","GMVDCSAV",41,0)
 D UPDATE^DIE("","GMVFDA"),FMERROR
"RTN","GMVDCSAV",42,0)
 S RESULT(0)="OK"
"RTN","GMVDCSAV",43,0)
 Q
"RTN","GMVDCSAV",44,0)
 ;
"RTN","GMVDCSAV",45,0)
ENTERR ; *** Save entered in error data ***
"RTN","GMVDCSAV",46,0)
 S GMVINUM=0 K GMVFDA
"RTN","GMVDCSAV",47,0)
 S GMVCNT=+$O(@GMVDATA@("I",1E25),-1)
"RTN","GMVDCSAV",48,0)
 F  S GMVINUM=$O(@GMVDATA@("I",GMVINUM)) Q:GMVINUM'>0  D
"RTN","GMVDCSAV",49,0)
 . S GMVD0=$G(@GMVDATA@("I",GMVINUM))
"RTN","GMVDCSAV",50,0)
 . S GMVFDA(120.5,GMVD0_",",2)=1
"RTN","GMVDCSAV",51,0)
 . S GMVFDA(120.5,GMVD0_",",3)=GMVERRBY
"RTN","GMVDCSAV",52,0)
 . S GMVRNUM=0
"RTN","GMVDCSAV",53,0)
 . F  S GMVRNUM=$O(@GMVDATA@("R",GMVINUM,GMVRNUM)) Q:GMVRNUM'>0  D
"RTN","GMVDCSAV",54,0)
 .. S GMVVREAS=$G(@GMVDATA@("R",GMVINUM,GMVRNUM))
"RTN","GMVDCSAV",55,0)
 .. S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",56,0)
 .. S GMVFDA(120.506,"+"_GMVCNT_","_GMVD0_",",.01)=GMVVREAS
"RTN","GMVDCSAV",57,0)
 .. Q
"RTN","GMVDCSAV",58,0)
 . Q
"RTN","GMVDCSAV",59,0)
 D UPDATE^DIE("","GMVFDA"),FMERROR
"RTN","GMVDCSAV",60,0)
 S RESULT(0)="OK"
"RTN","GMVDCSAV",61,0)
 Q
"RTN","GMVDCSAV",62,0)
QUALTWO ; Add a new entry to FILE 120.5
"RTN","GMVDCSAV",63,0)
 S GMVVNUM=0 K GMVFDA
"RTN","GMVDCSAV",64,0)
 S GMVVMEAS=$P(GMVDATA,"*",1) ; 
"RTN","GMVDCSAV",65,0)
 S GMVDTDUN=$P(GMVVMEAS,"^",1) ; Date time
"RTN","GMVDCSAV",66,0)
 ;01/28/2005 KAM GMRV*5*9 Added next Line PAL-0105-60940 
"RTN","GMVDCSAV",67,0)
 I +$P(GMVDTDUN,".",2)'>0 S GMVDTDUN=$$FMADD^XLFDT(GMVDTDUN,"","","",1)
"RTN","GMVDCSAV",68,0)
 S GMVDFN=$P(GMVVMEAS,"^",2) ; Patient DFN
"RTN","GMVDCSAV",69,0)
 S GMVVTYP=$P(GMVVMEAS,"^",3) ; Vital type
"RTN","GMVDCSAV",70,0)
 S GMVDTDUN=$$CHKDT(GMVDTDUN,$P(GMVVTYP,";",1))
"RTN","GMVDCSAV",71,0)
 S GMVDTENT=$$NOW^XLFDT ; Current date time
"RTN","GMVDCSAV",72,0)
 S GMVHOSPL=$P(GMVVMEAS,"^",4) ; Hospital
"RTN","GMVDCSAV",73,0)
 S GMVENTBY=$P(GMVVMEAS,"^",5) ; DUZ
"RTN","GMVDCSAV",74,0)
 S GMVFDA(120.5,"+1,",.01)=GMVDTDUN ; Date time taken
"RTN","GMVDCSAV",75,0)
 S GMVFDA(120.5,"+1,",.02)=GMVDFN   ; Patient
"RTN","GMVDCSAV",76,0)
 S GMVFDA(120.5,"+1,",.03)=$P(GMVVTYP,";",1)   ; Vital Type
"RTN","GMVDCSAV",77,0)
 S GMVFDA(120.5,"+1,",.04)=GMVDTENT  ; Date Time entered
"RTN","GMVDCSAV",78,0)
 S GMVFDA(120.5,"+1,",.05)=GMVHOSPL  ; Hospital
"RTN","GMVDCSAV",79,0)
 S GMVFDA(120.5,"+1,",.06)=GMVENTBY  ; Entered by (DUZ)
"RTN","GMVDCSAV",80,0)
 S GMVFDA(120.5,"+1,",1.2)=$P(GMVVTYP,";",2) ; Rate
"RTN","GMVDCSAV",81,0)
 S GMVFDA(120.5,"+1,",1.4)=$P(GMVVTYP,";",3) ; Sup 02
"RTN","GMVDCSAV",82,0)
 S GMVIEN=""
"RTN","GMVDCSAV",83,0)
 D UPDATE^DIE("","GMVFDA","GMVIEN"),FMERROR
"RTN","GMVDCSAV",84,0)
 S GMVCNT=1
"RTN","GMVDCSAV",85,0)
 S GMVQUALS=$P(GMVDATA,"*",2)
"RTN","GMVDCSAV",86,0)
 F GMVLOOP=1:1:$L(GMVQUALS,":")+1 D
"RTN","GMVDCSAV",87,0)
 . S GMVVQUAL=$P(GMVQUALS,":",GMVLOOP)
"RTN","GMVDCSAV",88,0)
 . Q:GMVVQUAL=""
"RTN","GMVDCSAV",89,0)
 . S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",90,0)
 . D ADDQUAL^GMVGETQ(.GMVRES,GMVIEN(1)_"^"_GMVVQUAL)
"RTN","GMVDCSAV",91,0)
 . Q
"RTN","GMVDCSAV",92,0)
 Q 
"RTN","GMVDCSAV",93,0)
 ;
"RTN","GMVDCSAV",94,0)
CHKDT(GMVDT,GMVSAV) ;Check id there ios a vital entered for that date and time
"RTN","GMVDCSAV",95,0)
 N GMVA,GMVQ
"RTN","GMVDCSAV",96,0)
 S GMVQ=0
"RTN","GMVDCSAV",97,0)
 S GMVA=""
"RTN","GMVDCSAV",98,0)
 F  S GMVA=$O(^GMR(120.5,"B",GMVDT,GMVA)) Q:GMVA=""  D
"RTN","GMVDCSAV",99,0)
 . ;01/28/2005 KAM GMRV*5*9 Added next Line BHS-0504-10643 
"RTN","GMVDCSAV",100,0)
 . I GMVDFN'=$P($G(^GMR(120.5,GMVA,0)),U,2) Q
"RTN","GMVDCSAV",101,0)
 . S GMVTY=$P($G(^GMR(120.5,GMVA,0)),"^",3)
"RTN","GMVDCSAV",102,0)
 . I GMVTY=GMVSAV D
"RTN","GMVDCSAV",103,0)
 . . S GMVDT=$$FMADD^XLFDT(GMVDT,"","","",1)
"RTN","GMVDCSAV",104,0)
 . . Q
"RTN","GMVDCSAV",105,0)
 . Q
"RTN","GMVDCSAV",106,0)
 Q GMVDT
"RTN","GMVDCSAV",107,0)
MSG(X) ; *** Add a line to the message array ***
"RTN","GMVDCSAV",108,0)
 S (GMVMSG,RESULT(-1))=1+$G(RESULT(-1),0)
"RTN","GMVDCSAV",109,0)
 S RESULT(GMVMSG)=X
"RTN","GMVDCSAV",110,0)
 I $P(X,":")="ERROR" S RESULT(0)="ERROR"
"RTN","GMVDCSAV",111,0)
 Q
"RTN","GMVDCSAV",112,0)
 ;
"RTN","GMVDCSAV",113,0)
FMERROR ;
"RTN","GMVDCSAV",114,0)
 I $O(^TMP("DIERR",$J,0))>0 D
"RTN","GMVDCSAV",115,0)
 . N GMVER1,GMVER2
"RTN","GMVDCSAV",116,0)
 . S GMVER1=0
"RTN","GMVDCSAV",117,0)
 . F  S GMVER1=$O(^TMP("DIERR",$J,GMVER1)) Q:GMVER1'>0  D
"RTN","GMVDCSAV",118,0)
 .. S GMVER2=0
"RTN","GMVDCSAV",119,0)
 .. F  S GMVER2=$O(^TMP("DIERR",$J,GMVER1,"TEXT",GMVER2)) Q:GMVER2'>0  D
"RTN","GMVDCSAV",120,0)
 ... D MSG("ERROR: "_$G(^TMP("DIERR",$J,GMVER1,"TEXT",GMVER2)))
"RTN","GMVDCSAV",121,0)
 ... Q
"RTN","GMVDCSAV",122,0)
 .. Q
"RTN","GMVDCSAV",123,0)
 . Q
"RTN","GMVDCSAV",124,0)
 D CLEAN^DILF
"RTN","GMVDCSAV",125,0)
 Q
"VER")
8.0^22.0
"BLD",5489,6)
^SEQ #7
**END**
**END**
