Released EC*2*50 SEQ #53
Extracted from mail message
**KIDS**:EC*2.0*50^

**INSTALL NAME**
EC*2.0*50
"BLD",5128,0)
EC*2.0*50^EVENT CAPTURE^0^3040121^y
"BLD",5128,1,0)
^^2^2^3031105^
"BLD",5128,1,1,0)
This patch addresses NOISes related to the Event
"BLD",5128,1,2,0)
Capture GUI and roll-n-scroll.
"BLD",5128,4,0)
^9.64PA^^
"BLD",5128,"KRN",0)
^9.67PA^8989.52^19
"BLD",5128,"KRN",.4,0)
.4
"BLD",5128,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5128,"KRN",.401,0)
.401
"BLD",5128,"KRN",.402,0)
.402
"BLD",5128,"KRN",.403,0)
.403
"BLD",5128,"KRN",.5,0)
.5
"BLD",5128,"KRN",.84,0)
.84
"BLD",5128,"KRN",3.6,0)
3.6
"BLD",5128,"KRN",3.8,0)
3.8
"BLD",5128,"KRN",9.2,0)
9.2
"BLD",5128,"KRN",9.8,0)
9.8
"BLD",5128,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5128,"KRN",9.8,"NM",1,0)
ECED1^^0^B36950524
"BLD",5128,"KRN",9.8,"NM",2,0)
ECMUTL1^^0^B51938252
"BLD",5128,"KRN",9.8,"NM",3,0)
ECBEN1B^^0^B23877823
"BLD",5128,"KRN",9.8,"NM",4,0)
ECUERPC2^^0^B3503395
"BLD",5128,"KRN",9.8,"NM","B","ECBEN1B",3)

"BLD",5128,"KRN",9.8,"NM","B","ECED1",1)

"BLD",5128,"KRN",9.8,"NM","B","ECMUTL1",2)

"BLD",5128,"KRN",9.8,"NM","B","ECUERPC2",4)

"BLD",5128,"KRN",19,0)
19
"BLD",5128,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5128,"KRN",19,"NM",1,0)
EC GUI CONTEXT^^0
"BLD",5128,"KRN",19,"NM","B","EC GUI CONTEXT",1)

"BLD",5128,"KRN",19.1,0)
19.1
"BLD",5128,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5128,"KRN",101,0)
101
"BLD",5128,"KRN",101,"NM",0)
^9.68A^^
"BLD",5128,"KRN",409.61,0)
409.61
"BLD",5128,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5128,"KRN",771,0)
771
"BLD",5128,"KRN",870,0)
870
"BLD",5128,"KRN",8989.51,0)
8989.51
"BLD",5128,"KRN",8989.52,0)
8989.52
"BLD",5128,"KRN",8994,0)
8994
"BLD",5128,"KRN","B",.4,.4)

"BLD",5128,"KRN","B",.401,.401)

"BLD",5128,"KRN","B",.402,.402)

"BLD",5128,"KRN","B",.403,.403)

"BLD",5128,"KRN","B",.5,.5)

"BLD",5128,"KRN","B",.84,.84)

"BLD",5128,"KRN","B",3.6,3.6)

"BLD",5128,"KRN","B",3.8,3.8)

"BLD",5128,"KRN","B",9.2,9.2)

"BLD",5128,"KRN","B",9.8,9.8)

"BLD",5128,"KRN","B",19,19)

"BLD",5128,"KRN","B",19.1,19.1)

"BLD",5128,"KRN","B",101,101)

"BLD",5128,"KRN","B",409.61,409.61)

"BLD",5128,"KRN","B",771,771)

"BLD",5128,"KRN","B",870,870)

"BLD",5128,"KRN","B",8989.51,8989.51)

"BLD",5128,"KRN","B",8989.52,8989.52)

"BLD",5128,"KRN","B",8994,8994)

"BLD",5128,"QUES",0)
^9.62^^
"BLD",5128,"REQB",0)
^9.611^^0
"KRN",19,11187,-1)
0^1
"KRN",19,11187,0)
EC GUI CONTEXT^EC GUI Context version 2.0.10.1^^B^^^^^^^^EVENT CAPTURE
"KRN",19,11187,1,0)
^19.06^1^1^3040121^^^^
"KRN",19,11187,1,1,0)
This is the Broker Client/Server type option for the Event Capture GUI option
"KRN",19,11187,99)
58583,58456
"KRN",19,11187,99.1)
58981,55862
"KRN",19,11187,"RPC",0)
^19.05P^53^53
"KRN",19,11187,"RPC",1,0)
EC DSSCATCHECK
"KRN",19,11187,"RPC",2,0)
EC FILER
"KRN",19,11187,"RPC",3,0)
EC GETBATPROCS
"KRN",19,11187,"RPC",4,0)
EC GETCAT
"KRN",19,11187,"RPC",5,0)
EC GETCPTLST
"KRN",19,11187,"RPC",6,0)
EC GETDSSECS
"KRN",19,11187,"RPC",7,0)
EC GETDSSUNIT
"KRN",19,11187,"RPC",8,0)
EC GETDSSUNITUSRS
"KRN",19,11187,"RPC",9,0)
EC GETECLOC
"KRN",19,11187,"RPC",10,0)
EC GETECSCATS
"KRN",19,11187,"RPC",11,0)
EC GETECSCREEN
"KRN",19,11187,"RPC",12,0)
EC GETECSDETAIL
"KRN",19,11187,"RPC",13,0)
EC GETECSPROCS
"KRN",19,11187,"RPC",14,0)
EC GETENCDXS
"KRN",19,11187,"RPC",15,0)
EC GETIEN
"KRN",19,11187,"RPC",16,0)
EC GETLIST
"KRN",19,11187,"RPC",17,0)
EC GETLOC
"KRN",19,11187,"RPC",18,0)
EC GETNATPX
"KRN",19,11187,"RPC",19,0)
EC GETPATCLASTAT
"KRN",19,11187,"RPC",20,0)
EC GETPATELIG
"KRN",19,11187,"RPC",21,0)
EC GETPATINFO
"KRN",19,11187,"RPC",22,0)
EC GETPATPROCS
"KRN",19,11187,"RPC",23,0)
EC GETPRODEFS
"KRN",19,11187,"RPC",24,0)
EC GETPROVIDER
"KRN",19,11187,"RPC",25,0)
EC GETPXLST
"KRN",19,11187,"RPC",26,0)
EC GETPXMODIFIER
"KRN",19,11187,"RPC",27,0)
EC GETPXREASON
"KRN",19,11187,"RPC",28,0)
EC GETSCNHELP
"KRN",19,11187,"RPC",29,0)
EC GETUSRDSSUNIT
"KRN",19,11187,"RPC",30,0)
EC REPORTS
"KRN",19,11187,"RPC",31,0)
EC VALIDATE SPREADSHEET DATA
"KRN",19,11187,"RPC",32,0)
ORWU USERINFO
"KRN",19,11187,"RPC",33,0)
ORWU HASKEY
"KRN",19,11187,"RPC",34,0)
ORWU DEVICE
"KRN",19,11187,"RPC",35,0)
SC PATIENT LOOKUP
"KRN",19,11187,"RPC",36,0)
ORWU NEWPERS
"KRN",19,11187,"RPC",37,0)
DDR GET DD HELP
"KRN",19,11187,"RPC",38,0)
DDR FINDER
"KRN",19,11187,"RPC",39,0)
DDR FIND1
"KRN",19,11187,"RPC",40,0)
DDR LISTER
"KRN",19,11187,"RPC",41,0)
EC GETDATE
"KRN",19,11187,"RPC",42,0)
EC CLASHELP
"KRN",19,11187,"RPC",43,0)
DDR GETS ENTRY DATA
"KRN",19,11187,"RPC",44,0)
DG CHK BS5 XREF Y/N
"KRN",19,11187,"RPC",45,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11187,"RPC",46,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11187,"RPC",47,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,11187,"RPC",48,0)
EC SPACEBAR
"KRN",19,11187,"RPC",49,0)
EC DIEDON
"KRN",19,11187,"RPC",50,0)
EC GETPATCH
"KRN",19,11187,"RPC",51,0)
EC GETVISITINFO
"KRN",19,11187,"RPC",52,0)
EC GETVERSION
"KRN",19,11187,"RPC",53,0)
ORWU DT
"KRN",19,11187,"U")
EC GUI CONTEXT VERSION 2.0.10.
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
50^3040121
"PKG",486,22,1,"PAH",1,1,0)
^^2^2^3040121
"PKG",486,22,1,"PAH",1,1,1,0)
This patch addresses NOISes related to the Event
"PKG",486,22,1,"PAH",1,1,2,0)
Capture GUI and roll-n-scroll.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ECBEN1B")
0^3^B23877823
"RTN","ECBEN1B",1,0)
ECBEN1B ;BIR/MAM,JPW-Batch Enter Procedures (cont'd) ;1 May 96
"RTN","ECBEN1B",2,0)
 ;;2.0; EVENT CAPTURE ;**4,5,10,13,17,23,41,42,50**;8 May 96
"RTN","ECBEN1B",3,0)
EN ;entry pt
"RTN","ECBEN1B",4,0)
 D HDR
"RTN","ECBEN1B",5,0)
 S CNT=0
"RTN","ECBEN1B",6,0)
PATS ; get patients
"RTN","ECBEN1B",7,0)
 W ! Q:ECOUT=1  K ECADD
"RTN","ECBEN1B",8,0)
 K DIC,DUOUT S DIC=2,DIC(0)="QEAMZ",DIC("A")=$S($D(ECPT):"Select Next Patient: ",1:"Select Patient: ")
"RTN","ECBEN1B",9,0)
 D ^DIC K DIC S OK=0
"RTN","ECBEN1B",10,0)
 I $D(DUOUT)!($D(DTOUT)) S ECOUT=1 Q
"RTN","ECBEN1B",11,0)
 I Y<0,CNT=0 S ECOUT=2 Q
"RTN","ECBEN1B",12,0)
 I Y<0 D  G PATS
"RTN","ECBEN1B",13,0)
 .D LIST Q:ECOUT=1  Q:'$O(ECPT(0))  Q:$G(ECADD)="A"
"RTN","ECBEN1B",14,0)
 .S ECTWO=0 K ECHOICE D ^ECBEN2A
"RTN","ECBEN1B",15,0)
 .I ECOUT=2 D KILL,HDR
"RTN","ECBEN1B",16,0)
 I $O(ECPT(0)) S JJ="" F  S JJ=$O(ECPT(JJ)) Q:'JJ!(OK=1)  I +$G(ECPT(JJ))=+Y S OK=1 W !!,"Patient already selected.  Please select another patient.",!
"RTN","ECBEN1B",17,0)
 I OK=1 G PATS
"RTN","ECBEN1B",18,0)
 N YY,ECUP D  I $G(ECUP)="^" G PATS
"RTN","ECBEN1B",19,0)
 . S YY=Y,DFN=+Y D 2^VADPT S Y=YY I +VADM(6) D
"RTN","ECBEN1B",20,0)
 . . ; NOIS MWV-0603-21781:line below changed by VMP.
"RTN","ECBEN1B",21,0)
 . . W !!,"WARNING "_"[PATIENT DIED ON "_$P(VADM(6),U,2)_"] ",!!
"RTN","ECBEN1B",22,0)
 . . R "Press Return to Continue or ^ to Deselect: ",ECUP:DTIME
"RTN","ECBEN1B",23,0)
 S CNT=CNT+1,CNT1=CNT,ECPT(CNT)=+Y_"^"_$P(Y,"^",2) D DIAG
"RTN","ECBEN1B",24,0)
 G PATS
"RTN","ECBEN1B",25,0)
 ;
"RTN","ECBEN1B",26,0)
LIST ; list patients
"RTN","ECBEN1B",27,0)
 K ECADD
"RTN","ECBEN1B",28,0)
 W @IOF,!,"Patients Selected for Batch Entry: ",! F I=0:0 S I=$O(ECPT(I)) Q:'I  W:I#2 ! W:I#2=0 ?40 W I_".  "_$P(ECPT(I),"^",2)
"RTN","ECBEN1B",29,0)
 W !!,"Is this list correct ?  YES//  " R ECYN:DTIME I '$T!(ECYN="^") S ECOUT=1 Q
"RTN","ECBEN1B",30,0)
 S ECYN=$E(ECYN) S:ECYN="" ECYN="Y" I "YyNn"'[ECYN W !!,"Enter <RET> if this list is complete, or NO to add or delete",!,"patients on the list.",!!,"Press <RET> to continue  " R X:DTIME G LIST
"RTN","ECBEN1B",31,0)
 I "Yy"[ECYN Q:$O(ECPT(0))  D NOBODY Q:ECOUT
"RTN","ECBEN1B",32,0)
ADD W !!,"Add or Delete Patients ?  ADD//  " R ECADD:DTIME I '$T!(ECADD="^") S ECOUT=1 Q
"RTN","ECBEN1B",33,0)
 S ECADD=$E(ECADD) S:ECADD="" ECADD="A" I "AaDd"'[ECADD W !!,"Enter <RET> to make additions to the list, or ""D"" to delete a ",!,"patient from the list." G ADD
"RTN","ECBEN1B",34,0)
 I "Aa"[ECADD Q
"RTN","ECBEN1B",35,0)
DEL ; delete patients from list
"RTN","ECBEN1B",36,0)
 I '$D(ECPT(1)) D NOBODY Q:ECOUT  G LIST
"RTN","ECBEN1B",37,0)
 W !!,"Select Number:  " R X:DTIME I '$T!(X="^") S ECOUT=1 Q
"RTN","ECBEN1B",38,0)
 I X="" Q
"RTN","ECBEN1B",39,0)
 I '$D(ECPT(X)) W !!,"Select the number corresponding to the patient that you would like",!,"to remove from the list.",!!,"Press <RET> to continue  " R X:DTIME S ECMORE=1 D LIST Q:ECOUT  G DEL
"RTN","ECBEN1B",40,0)
 F I=X+1:1:CNT S ECPT(I-1)=ECPT(I)
"RTN","ECBEN1B",41,0)
 K ECPT(CNT),I S CNT=CNT-1
"RTN","ECBEN1B",42,0)
 W !!,"Patient deleted.",!!,"Press <RET> to continue " R X:DTIME
"RTN","ECBEN1B",43,0)
 G LIST
"RTN","ECBEN1B",44,0)
 Q
"RTN","ECBEN1B",45,0)
HDR ;
"RTN","ECBEN1B",46,0)
 W @IOF,!,"Location: "_ECLN
"RTN","ECBEN1B",47,0)
 W !,"DSS Unit: "_ECDN
"RTN","ECBEN1B",48,0)
 W !,"Ordering Section: ",ECON
"RTN","ECBEN1B",49,0)
 W !,"Procedure Date: ",ECDATE
"RTN","ECBEN1B",50,0)
 W !!,"Provider:",?14,$P(ECU,"^",2),!?16,$P(ECU,"^",3)
"RTN","ECBEN1B",51,0)
 I +ECU2 W !,"Provider #2:",?14,$P(ECU2,"^",2),!?16,$P(ECU2,"^",3)
"RTN","ECBEN1B",52,0)
 I +ECU3 W !,"Provider #3:",?14,$P(ECU3,"^",2),!?16,$P(ECU3,"^",3)
"RTN","ECBEN1B",53,0)
 W !
"RTN","ECBEN1B",54,0)
 Q
"RTN","ECBEN1B",55,0)
 ;
"RTN","ECBEN1B",56,0)
NOBODY ;No patients selected
"RTN","ECBEN1B",57,0)
 I $D(ECADD),ECADD="D" W !!,"You cannot delete patients when your patient list is empty."
"RTN","ECBEN1B",58,0)
 I $G(ECADD)'="D" W !!,"You have selected no patients."
"RTN","ECBEN1B",59,0)
 R !!,"Do you wish to quit?  Y//",X:DTIME S X=$E(X) I '$T!(X="^") S ECOUT=1 Q
"RTN","ECBEN1B",60,0)
 S:X="" X="Y" I "yY"[X S ECOUT=1 Q
"RTN","ECBEN1B",61,0)
 I "nN"'[X W !,"Answer N to continue selection, or enter return to quit",! G NOBODY
"RTN","ECBEN1B",62,0)
 Q
"RTN","ECBEN1B",63,0)
 ;
"RTN","ECBEN1B",64,0)
ADCAT ;add category/procedures for patients
"RTN","ECBEN1B",65,0)
 D ^ECBEN2A I ECOUT=1 Q
"RTN","ECBEN1B",66,0)
 Q
"RTN","ECBEN1B",67,0)
KILL ;kill arrays
"RTN","ECBEN1B",68,0)
 K ECA,ECHOICE,ECJLP,ECPT,ECC,ECCN,ECP,ECPN,ECV,NATN,NODE,SYN,SYS,VOL
"RTN","ECBEN1B",69,0)
 K ^TMP("ECPRO",$J),ECDX,ECDXN,ECINP,ECVST,ECSC,ECAO,ECIR,ECZEC,EC4,EC4N
"RTN","ECBEN1B",70,0)
 K ECID,ECMST,ECDXS,ECDXIEN,ECHNC
"RTN","ECBEN1B",71,0)
 S ECOUT=0
"RTN","ECBEN1B",72,0)
 Q
"RTN","ECBEN1B",73,0)
DIAG ;ask dx, etc. questions
"RTN","ECBEN1B",74,0)
 S (ECDX,ECDXN,ECINP,ECVST,ECSC,ECAO,ECIR,ECZEC,ECMST,ECHNC)=""
"RTN","ECBEN1B",75,0)
 S ECDFN=$P(ECPT(CNT),U)
"RTN","ECBEN1B",76,0)
 ;- Determine inpatient/outpatient status
"RTN","ECBEN1B",77,0)
 S ECPTSTAT=$$INOUTPT^ECUTL0(+$G(ECPT(CNT)),+$G(ECDT))
"RTN","ECBEN1B",78,0)
 I ECPTSTAT="" D INOUTERR^ECUTL0 Q
"RTN","ECBEN1B",79,0)
 ;- Determine patient eligibility
"RTN","ECBEN1B",80,0)
 I $$CHKDSS^ECUTL0(+$G(ECD),ECPTSTAT) D
"RTN","ECBEN1B",81,0)
 . I $$MULTELG^ECUTL0(+$G(ECPT(CNT))) S ECELIG=+$$ELGLST^ECUTL0
"RTN","ECBEN1B",82,0)
 . E  S ECELIG=+$G(VAEL(1))
"RTN","ECBEN1B",83,0)
 K VAEL
"RTN","ECBEN1B",84,0)
 D DSPSTAT^ECUTL0(ECPTSTAT)
"RTN","ECBEN1B",85,0)
 I '$D(EC4) S EC4="",EC4N="NO ASSOCIATED CLINIC"
"RTN","ECBEN1B",86,0)
 I '$D(ECID) S ECID=""
"RTN","ECBEN1B",87,0)
 I $P(ECPCE,"~",2)="N" G SETDX
"RTN","ECBEN1B",88,0)
 D PCEQST^ECBEN2U
"RTN","ECBEN1B",89,0)
 I ECOUT D DELPT(.CNT) Q
"RTN","ECBEN1B",90,0)
SETDX ;set dx, etc. in pat array
"RTN","ECBEN1B",91,0)
 S EC4N=$S($P($G(^SC(+EC4,0)),"^")]"":$P(^(0),"^"),1:"NO ASSOCIATED CLINIC"),ECID=$P($G(^SC(+EC4,0)),"^",7)
"RTN","ECBEN1B",92,0)
 S ECPT(CNT)=ECPT(CNT)_"^"_ECDX_"^"_$S(ECINP="":$G(ECPTSTAT),1:ECINP)_"^"_ECVST_"^"_ECSC_"^"_ECAO_"^"_ECIR_"^"_ECZEC_"^"_EC4_"^"_ECID_"^"_ECMST_"^"_ECHNC
"RTN","ECBEN1B",93,0)
 I $D(ECDXS) M ECPT(CNT,"DXS")=ECDXS K ECDXS
"RTN","ECBEN1B",94,0)
 Q
"RTN","ECBEN1B",95,0)
 ;
"RTN","ECBEN1B",96,0)
DELPT(CNT) ;deselect patient due to missing required data
"RTN","ECBEN1B",97,0)
 N DIR,Y
"RTN","ECBEN1B",98,0)
 K ECPT(CNT) S CNT=CNT-1
"RTN","ECBEN1B",99,0)
 W !,"Required data missing.",!,"Patient deselected...",!
"RTN","ECBEN1B",100,0)
 S ECOUT=0
"RTN","ECBEN1B",101,0)
 S DIR(0)="E",DIR("A")="Press RETURN to continue"
"RTN","ECBEN1B",102,0)
 D ^DIR
"RTN","ECBEN1B",103,0)
 W !
"RTN","ECBEN1B",104,0)
 Q
"RTN","ECED1")
0^1^B36950524
"RTN","ECED1",1,0)
ECED1 ;BIR/MAM,JPW-Event Capture Data Entry (cont'd) ;6 Mar 96
"RTN","ECED1",2,0)
 ;;2.0; EVENT CAPTURE ;**4,5,8,10,18,23,41,47,50**;8 May 96
"RTN","ECED1",3,0)
CAT ;cat & set unit info
"RTN","ECED1",4,0)
 W !!,"Location: "_ECLN,!,"DSS Unit: "_ECDN,!
"RTN","ECED1",5,0)
 D CATS^ECHECK1
"RTN","ECED1",6,0)
 S NODE=$G(^ECD(ECD,0)),ECS=+$P(NODE,"^",2),ECM=+$P(NODE,"^",3),ECDDT=$P(NODE,"^",12),ECDDT=$S(ECDDT="T":"NOW",ECDDT="N":"NOW",1:"")
"RTN","ECED1",7,0)
 S ECSN=$S($P($G(^DIC(49,ECS,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),ECMN=$S($P($G(^ECC(723,ECM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","ECED1",8,0)
 S ECPCE="U~"_$S($P(NODE,"^",14)]"":$P(NODE,"^",14),1:"N")
"RTN","ECED1",9,0)
PAT ;get pat
"RTN","ECED1",10,0)
 S (ECJLP,ECOUT)=0
"RTN","ECED1",11,0)
 K EC,^TMP("ECLKUP",$J) S CNT=0 K DIC S DIC=2,DIC(0)="QEAMZ",DIC("A")="Select Patient: " D ^DIC K DIC Q:Y<0  S ECDFN=+Y,ECPAT=$P(Y,"^",2),ECOUT=0
"RTN","ECED1",12,0)
 N ECUP S DFN=ECDFN D 2^VADPT I +VADM(6) D  I $G(ECUP)="^" G PAT
"RTN","ECED1",13,0)
 . ; NOIS MWV-0603-21781: line below changed by VMP.
"RTN","ECED1",14,0)
 . W !!,"WARNING "_"[PATIENT DIED ON "_$P(VADM(6),U,2)_"] ",!!
"RTN","ECED1",15,0)
 . R "Press Return to Continue or ^ to Deselect: ",ECUP:DTIME
"RTN","ECED1",16,0)
ASKD ;get proc date
"RTN","ECED1",17,0)
 D DATE Q:ECOUT
"RTN","ECED1",18,0)
 ;
"RTN","ECED1",19,0)
 ;- Determine inpatient/outpatient status
"RTN","ECED1",20,0)
 S ECPTSTAT=$$INOUTPT^ECUTL0(+$G(ECDFN),+$G(ECDT))
"RTN","ECED1",21,0)
 I ECPTSTAT="" D INOUTERR^ECUTL0 Q
"RTN","ECED1",22,0)
 ;
"RTN","ECED1",23,0)
 ;- Display inpatient/outpatient status message
"RTN","ECED1",24,0)
 D DSPSTAT^ECUTL0(ECPTSTAT) S ECIOFLG=1
"RTN","ECED1",25,0)
 ;
"RTN","ECED1",26,0)
PR S X=$E(ECDT,1,7)-.0001 F I=0:0 S X=$O(^ECH("ADT",ECL,ECDFN,ECD,X)) Q:X>ECDT1!('X)  S ECFN=0 F I=0:0 S ECFN=$O(^ECH("ADT",ECL,ECDFN,ECD,X,ECFN)) Q:'ECFN  S CNT=CNT+1,EC(CNT)=ECFN D SET
"RTN","ECED1",27,0)
 S CNT=0 I '$O(EC(0))&ECOUT=99 S ECOUT=0 Q
"RTN","ECED1",28,0)
PROS ; display procedures
"RTN","ECED1",29,0)
 I ECOUT K ECPAT D HDR W ! G PAT
"RTN","ECED1",30,0)
 I '$D(EC(1)) S ECJLP=1 D DATE Q:ECOUT  D NEW^ECED2 S CNT=0 K EC G PR
"RTN","ECED1",31,0)
 ;
"RTN","ECED1",32,0)
 ;- Prevents inpat/outpat status from scrolling off screen before heading
"RTN","ECED1",33,0)
 ;  clears screen and prints at top
"RTN","ECED1",34,0)
 I $D(EC(1)),(+$G(ECIOFLG)) D MSG1^ECMUTL1 K ECIOFLG
"RTN","ECED1",35,0)
 D HDR K ECHOICE F I=0:0 S CNT=$O(EC(CNT)) Q:'CNT!($D(ECHOICE))  S CNT1=CNT D LIST
"RTN","ECED1",36,0)
 I ECOUT K ECPAT D HDR W ! G PAT
"RTN","ECED1",37,0)
 I $D(ECHOICE),ECHOICE S EC=ECHOICE D EDIT^ECED3 S CNT=0 K EC G PR
"RTN","ECED1",38,0)
 I $D(ECHOICE),ECHOICE="N" S ECJLP=1 D DATE Q:ECOUT  D NEW^ECED2 S CNT=0 K EC G PR
"RTN","ECED1",39,0)
SELP W !!!,"Select a number to edit/delete, or enter N to create a New Procedure:  " R X:DTIME I '$T!("^"[X) K ECPAT D HDR G PAT
"RTN","ECED1",40,0)
 I "Nn"[X S ECJLP=1 D DATE Q:ECOUT  D NEW^ECED2 S CNT=0 K EC G PR
"RTN","ECED1",41,0)
 I '$D(EC(X)) W !!,"Enter N to create a new procedure, or the number corresponding to the",!,"procedure that you want to edit or delete.  Enter ^ quit.",!!,"Press <RET> to continue  " R X:DTIME S CNT=CNT1-5 G PROS
"RTN","ECED1",42,0)
 S EC=X D EDIT^ECED3 S CNT=0 K EC G PR
"RTN","ECED1",43,0)
 ;
"RTN","ECED1",44,0)
LIST ; list procedures
"RTN","ECED1",45,0)
 I $Y+8>IOSL D SEL Q:$D(ECHOICE)!(X="")
"RTN","ECED1",46,0)
 S ECDTM=$$FMTE^XLFDT($P(EC(CNT),"^",10),2)
"RTN","ECED1",47,0)
 W !!,CNT_".",?5,"Category : "_$E($P(EC(CNT),"^",2),1,23),?41,"Pr. Date: ",ECDTM,?67,$P(EC(CNT),"^",4),!,?5,"Procedure: "_$E($P(EC(CNT),"^",3),1,50)_" ("_$P(EC(CNT),"^",6)_")",?67,$E($P(EC(CNT),"^",5),1,13)
"RTN","ECED1",48,0)
 I $O(EC(CNT,"MOD",""))'="" D
"RTN","ECED1",49,0)
 . N MOD S MOD="" F  S MOD=$O(EC(CNT,"MOD",MOD)) Q:MOD=""  D
"RTN","ECED1",50,0)
 . . W !?6,"Modifier: ","    - ",MOD," ",$E(EC(CNT,"MOD",MOD),1,55)
"RTN","ECED1",51,0)
 I $P(EC(CNT),"^",9)]"" W !?5,"Procedure Reason: "_$P(EC(CNT),"^",9)
"RTN","ECED1",52,0)
 Q
"RTN","ECED1",53,0)
HDR ; heading
"RTN","ECED1",54,0)
 W @IOF,!,"Location: "_ECLN,?40,"Service: "_ECSN,!,"Section: "_ECMN,?40,"DSS Unit: "_ECDN I $D(ECPAT) W !,"Patient: "_ECPAT,?40,"Procedure Date: "_ECDATE
"RTN","ECED1",55,0)
 Q
"RTN","ECED1",56,0)
SEL ; select procedure
"RTN","ECED1",57,0)
 W !!!,"Select a number to edit, enter N for a New Procedure, or press <RET> to ",!,"continue listing procedures:  " R X:DTIME I '$T!(X="^") S (ECOUT,ECHOICE)=1 Q
"RTN","ECED1",58,0)
 I X="" S CNT=CNT-1 D HDR Q
"RTN","ECED1",59,0)
 I "Na"[X S ECHOICE="N" Q
"RTN","ECED1",60,0)
 I $D(EC(X)) S ECHOICE=X Q
"RTN","ECED1",61,0)
 W !!,"To create a new procedure, type N.  If you would like to edit or delete",!,"one of the procedures listed, enter the corresponding number.  Press <RET>",!,"to continue the list, or ^ to quit."
"RTN","ECED1",62,0)
 W !!,"Press <RET> to continue  " R X:DTIME S X="",CNT=CNT-6 D HDR
"RTN","ECED1",63,0)
 Q
"RTN","ECED1",64,0)
SET ; set EC array
"RTN","ECED1",65,0)
 N ECPXD
"RTN","ECED1",66,0)
 I '$D(^ECH(EC(CNT),0)) W !!,"Event Capture patient data missing.",!! S ECOUT=1 Q
"RTN","ECED1",67,0)
 S ECCH=$G(^ECH(EC(CNT),0)),(ECPSYN,ECPTCD)="",ECDTM=$P(ECCH,"^",3)
"RTN","ECED1",68,0)
 S ECTEMP=+$P(ECCH,"^",8),ECCN=$S($P($G(^EC(726,ECTEMP,0)),"^")]"":$P(^(0),"^"),1:"None")
"RTN","ECED1",69,0)
 S ECTEMP=$P(ECCH,"^",9),ECTEST="^"_$P(ECTEMP,";",2),ECTEMP=+ECTEMP
"RTN","ECED1",70,0)
 I $P(ECCH,"^",4)'="",$P(ECCH,"^",7)'="",$P(ECCH,"^",8)'="",$P(ECCH,"^",9)'="" D
"RTN","ECED1",71,0)
 . S ECPSY=+$O(^ECJ("AP",$P(ECCH,"^",4),$P(ECCH,"^",7),$P(ECCH,"^",8),$P(ECCH,"^",9),""))
"RTN","ECED1",72,0)
 . I ECPSY'="" S ECPSYN=$P($G(^ECJ(ECPSY,"PRO")),"^",2)
"RTN","ECED1",73,0)
 S ECCPT=$S(ECTEST["EC":$P($G(^EC(725,ECTEMP,0)),"^",5),1:ECTEMP)
"RTN","ECED1",74,0)
 S (ECPTCD,ECPXD)="" I ECCPT'="" D
"RTN","ECED1",75,0)
 . S ECPXD=$$CPT^ICPTCOD(ECCPT,ECDTM) I +ECPXD>0 S ECPTCD=$P(ECPXD,U,2)
"RTN","ECED1",76,0)
 I $D(^ECH(EC(CNT),"MOD")) D  K MOD,ARR,ECMODF
"RTN","ECED1",77,0)
 . K ARR,ECMOD S ECMODF=$$MOD^ECUTL(EC(CNT),"E",.ARR) I 'ECMODF Q
"RTN","ECED1",78,0)
 . S MOD="" F  S MOD=$O(ARR(MOD)) Q:MOD=""  S ECMOD(MOD)=$P(ARR(MOD),U,3)
"RTN","ECED1",79,0)
 I ECTEST["EC" D  G SET1
"RTN","ECED1",80,0)
 . S ECPN=$S($P($G(^EC(725,ECTEMP,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","ECED1",81,0)
 I ECTEST["ICPT" D  G SET1
"RTN","ECED1",82,0)
 . S ECPN=$S($P(ECPXD,U,3)]"":$P(ECPXD,U,3),1:"UNKNOWN")
"RTN","ECED1",83,0)
 S ECPN="UNKNOWN"
"RTN","ECED1",84,0)
SET1 S ECPN=ECPTCD_" "_ECPN_$S(ECPSYN="":"",1:"  ["_ECPSYN_"]")
"RTN","ECED1",85,0)
 S ECTEMP=+$P(ECCH,"^",12)
"RTN","ECED1",86,0)
 S ECON=$S($P($G(^ECC(723,ECTEMP,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","ECED1",87,0)
 S ECV=$P(ECCH,"^",10),EC4=$P(ECCH,"^",19),ECID=$P(ECCH,"^",20)
"RTN","ECED1",88,0)
 S EC4N=$S($P($G(^SC(+EC4,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","ECED1",89,0)
 S ECUN1=+$P(ECCH,"^",11),ECUN=$S($P($G(^VA(200,ECUN1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","ECED1",90,0)
 ;
"RTN","ECED1",91,0)
 ;- Check for and display procedure reason
"RTN","ECED1",92,0)
 I +$P(ECCH,"^",23) S ECPRS=+$P(ECCH,"^",23),ECPRSL=$P($G(^ECL(ECPRS,0)),"^"),ECPRSN=$P($G(^ECR(ECPRSL,0)),"^")
"RTN","ECED1",93,0)
 S EC(CNT)=EC(CNT)_"^"_ECCN_"^"_ECPN_"^"_$S(ECUN[",":$P(ECUN,",")_", "_$E($P(ECUN,",",2)),1:ECUN)_"^"_$E(ECON,1,15)_"^"_ECV_"^"_EC4_"^"_ECID_$S($G(ECPRSN)]"":"^"_ECPRSN,1:"")
"RTN","ECED1",94,0)
 S $P(EC(CNT),"^",10)=ECDTM
"RTN","ECED1",95,0)
 I $O(ECMOD(""))'="" D
"RTN","ECED1",96,0)
 . M EC(CNT,"MOD")=ECMOD
"RTN","ECED1",97,0)
 K ECPRS,ECPRSN,ECPRSL,ECMOD
"RTN","ECED1",98,0)
 Q
"RTN","ECED1",99,0)
DATE ;ask date
"RTN","ECED1",100,0)
 I ECJLP,$D(ECDT),$P(ECDT,".",2)]"" Q
"RTN","ECED1",101,0)
 I ECJLP,$D(ECDT),$P(ECDT,".",2)']"" W !!,"You must enter both DATE and TIME to create a new procedure record.",!!
"RTN","ECED1",102,0)
 ;
"RTN","ECED1",103,0)
 ;- Prevent future dates from being entered
"RTN","ECED1",104,0)
 K %DT S %DT="EAXR",%DT("A")="Enter Date and Time of Procedure: ",%DT(0)="-NOW" S:ECDDT]"" %DT("B")=ECDDT D ^%DT K %DT I Y<0 S ECOUT=1 Q
"RTN","ECED1",105,0)
 S ECDT=+Y,ECDT1=$E(Y,1,7)+.9999,ECDATE=$$FMTE^XLFDT(ECDT)
"RTN","ECED1",106,0)
 Q
"RTN","ECMUTL1")
0^2^B51938252
"RTN","ECMUTL1",1,0)
ECMUTL1 ;ALB/ESD - Utilities for Multiple Dates/Mult Procs ;20 AUG 1997 13:56
"RTN","ECMUTL1",2,0)
 ;;2.0; EVENT CAPTURE ;**5,10,15,13,17,23,41,42,50**;8 May 96
"RTN","ECMUTL1",3,0)
 ;
"RTN","ECMUTL1",4,0)
 ;
"RTN","ECMUTL1",5,0)
ASKPAT(ECPAT) ; Ask patient
"RTN","ECMUTL1",6,0)
 ;
"RTN","ECMUTL1",7,0)
 ;      Input:  ECPAT = patient DFN and name (passed by reference)
"RTN","ECMUTL1",8,0)
 ;
"RTN","ECMUTL1",9,0)
 ;     Output:      1 = successful
"RTN","ECMUTL1",10,0)
 ;                 -1 = unsuccessful (timed out or uparrowed)
"RTN","ECMUTL1",11,0)
 ;                 -2 = unsuccessful (returned out)
"RTN","ECMUTL1",12,0)
 ;
"RTN","ECMUTL1",13,0)
 N DIC,DUOUT,DTOUT,Y,YY,ECDUP,ECI,ECUP
"RTN","ECMUTL1",14,0)
SEL ;
"RTN","ECMUTL1",15,0)
 S (ECDUP,ECI)=0
"RTN","ECMUTL1",16,0)
 S DIC="^DPT(",DIC(0)="QEAMZ"
"RTN","ECMUTL1",17,0)
 S DIC("A")="Select Patient: "
"RTN","ECMUTL1",18,0)
 D ^DIC
"RTN","ECMUTL1",19,0)
 I Y=-1!($D(DUOUT))!($D(DTOUT)) G ASKPATQ
"RTN","ECMUTL1",20,0)
 ;
"RTN","ECMUTL1",21,0)
 ;- Create ECPLST local array to track duplicate names
"RTN","ECMUTL1",22,0)
 I $O(^TMP("ECPLST",$J,0)) D
"RTN","ECMUTL1",23,0)
 . F  S ECI=$O(^TMP("ECPLST",$J,ECI)) Q:'ECI  D
"RTN","ECMUTL1",24,0)
 .. I +$G(^TMP("ECPLST",$J,ECI))=+Y D
"RTN","ECMUTL1",25,0)
 ... S ECDUP=1
"RTN","ECMUTL1",26,0)
 ... W !!,"Patient already selected.  Please select another patient.",!
"RTN","ECMUTL1",27,0)
 I ECDUP G SEL
"RTN","ECMUTL1",28,0)
 I 'ECDUP D  I $G(ECUP)="^" G SEL
"RTN","ECMUTL1",29,0)
 . S ECPAT=+Y_"^"_$P(Y,"^",2)
"RTN","ECMUTL1",30,0)
 . S YY=Y,DFN=+Y,ECUP="" D 2^VADPT S Y=YY I +VADM(6) D  I ECUP="^" Q
"RTN","ECMUTL1",31,0)
 .. ;NOIS MWV-0603-21781: line below changed by VMP.
"RTN","ECMUTL1",32,0)
 .. W !!,"WARNING "_"[PATIENT DIED ON "_$P(VADM(6),U,2)_"] ",!!
"RTN","ECMUTL1",33,0)
 .. R "Press Return to Continue or ^ to Deselect: ",ECUP:DTIME
"RTN","ECMUTL1",34,0)
 . S ^TMP("ECPLST",$J,($S('$O(^TMP("ECPLST",$J,0)):1,1:$O(^TMP("ECPLST",$J,""),-1)+1)))=+Y_"^"_$P(Y,"^",2)
"RTN","ECMUTL1",35,0)
ASKPATQ Q $S((Y=-1)&($D(DUOUT)!$D(DTOUT)):-1,(Y=-1)&('$D(DUOUT))&('$D(DTOUT)):-2,1:1)
"RTN","ECMUTL1",36,0)
 ;
"RTN","ECMUTL1",37,0)
 ;
"RTN","ECMUTL1",38,0)
ASKORD() ; Ask ordering section
"RTN","ECMUTL1",39,0)
 ;
"RTN","ECMUTL1",40,0)
 ;      Input:   None
"RTN","ECMUTL1",41,0)
 ;
"RTN","ECMUTL1",42,0)
 ;     Output:   Ordering Section ien if successful
"RTN","ECMUTL1",43,0)
 ;               0 if not successful
"RTN","ECMUTL1",44,0)
 ;
"RTN","ECMUTL1",45,0)
 N DIR,DIRUT,Y,ECORD
"RTN","ECMUTL1",46,0)
 S ECORD=0
"RTN","ECMUTL1",47,0)
 S DIR(0)="721,11",DIR("A")="Ordering Section"
"RTN","ECMUTL1",48,0)
 D ^DIR
"RTN","ECMUTL1",49,0)
 I Y=""!($D(DIRUT)) G ASKORDQ
"RTN","ECMUTL1",50,0)
 S ECORD=+Y
"RTN","ECMUTL1",51,0)
ASKORDQ Q +ECORD
"RTN","ECMUTL1",52,0)
 ;
"RTN","ECMUTL1",53,0)
 ;
"RTN","ECMUTL1",54,0)
PCEDAT(ECUNIT,ECSCR,ECPCE) ;get needed PCE data
"RTN","ECMUTL1",55,0)
 ;
"RTN","ECMUTL1",56,0)
 ;   input
"RTN","ECMUTL1",57,0)
 ;   ECUNIT = ien of DSS unit in file #724 (required)
"RTN","ECMUTL1",58,0)
 ;   ECSCR = ien of event code screen in file #720.3 (required);
"RTN","ECMUTL1",59,0)
 ;           but may be null value
"RTN","ECMUTL1",60,0)
 ;   ECPCE  = array, passed by reference (required)
"RTN","ECMUTL1",61,0)
 ;
"RTN","ECMUTL1",62,0)
 ;   output
"RTN","ECMUTL1",63,0)
 ;   ECPCE("CLIN") = associated clinic ien in file #44^clinic name
"RTN","ECMUTL1",64,0)
 ;   ECPCE("DX")   = ien in file #80^icd code
"RTN","ECMUTL1",65,0)
 ;   ECPCE("DXS",) = array of multiple secondary diagnosis, where
"RTN","ECMUTL1",66,0)
 ;                 = ecpce("dxs",n)=v n=dx code and v=dx ien
"RTN","ECMUTL1",67,0)
 ;   ECPCE("AO")   = agent orange indicator
"RTN","ECMUTL1",68,0)
 ;   ECPCE("IR")  = ionizing radiation indicator
"RTN","ECMUTL1",69,0)
 ;   ECPCE("ENV")  = environmental contaminants indicator
"RTN","ECMUTL1",70,0)
 ;   ECPCE("SC")   = service connected indicator (Y/N)
"RTN","ECMUTL1",71,0)
 ;   ECPCE("MST")  = military sexual trauma indicator (Y/N)
"RTN","ECMUTL1",72,0)
 ;   ECPCE("HNC")  = Head/Neck Cancer indicator (Y/N)
"RTN","ECMUTL1",73,0)
 ;
"RTN","ECMUTL1",74,0)
 ;   returns
"RTN","ECMUTL1",75,0)
 ;   ECOUT  = if normal user input, then "0"
"RTN","ECMUTL1",76,0)
 ;            if user times-out, then "1"
"RTN","ECMUTL1",77,0)
 ;            if user up-arrows out, then "2"
"RTN","ECMUTL1",78,0)
 ;
"RTN","ECMUTL1",79,0)
 N SEND,ECOUT,EC4,EC4N,ECPCL,ECPCID,ECPCRD
"RTN","ECMUTL1",80,0)
 S ECOUT=0
"RTN","ECMUTL1",81,0)
 S ECSCR=+$G(ECSCR)
"RTN","ECMUTL1",82,0)
 S SEND=$P(^ECD(+ECUNIT,0),"^",14)
"RTN","ECMUTL1",83,0)
 I SEND="" S SEND="N"
"RTN","ECMUTL1",84,0)
 S ECPCE("CLIN")="",ECPCE("DX")="",ECPCE("AO")="",ECPCE("IR")=""
"RTN","ECMUTL1",85,0)
 S ECPCE("ENV")="",ECPCE("SC")="",ECPCE("MST")="",ECPCE("HNC")=""
"RTN","ECMUTL1",86,0)
 K ECPCE("DXS")
"RTN","ECMUTL1",87,0)
 I "AO"[SEND D
"RTN","ECMUTL1",88,0)
 .;- Don't write message if Send to PCE = "O" and patient is an inpatient
"RTN","ECMUTL1",89,0)
 .I SEND="A"!(SEND="O"&(ECPCE("I/O")="O")) D
"RTN","ECMUTL1",90,0)
 ..W !!,?5,"Please Note: The following prompt(s) cannot be by-passed with"
"RTN","ECMUTL1",91,0)
 ..W !,?5,"<cr>, since the data is sent to PCE for workload reporting."
"RTN","ECMUTL1",92,0)
 ..W !,?5,"If data cannot be provided, respond with ""^"".  This will"
"RTN","ECMUTL1",93,0)
 ..W !,?5,"remove the current patient from the selected patient list.",!
"RTN","ECMUTL1",94,0)
 .D CLINIC I $G(ECOUT) D MSGCLN Q
"RTN","ECMUTL1",95,0)
 .D ASKDX I $G(ECOUT) D MSGDX Q
"RTN","ECMUTL1",96,0)
 .D VISIT I $G(ECOUT) D CLMSG Q
"RTN","ECMUTL1",97,0)
 I ECSCR,(ECPCE("CLIN")=""),('$G(ECOUT)) D
"RTN","ECMUTL1",98,0)
 .Q:'$D(^ECJ(ECSCR))
"RTN","ECMUTL1",99,0)
 .I ECUNIT'=$P($P(^ECJ(ECSCR,0),"^",1),"-",2) Q
"RTN","ECMUTL1",100,0)
 .S EC4=$P($G(^ECJ(ECSCR,"PRO")),"^",4) I +EC4 D
"RTN","ECMUTL1",101,0)
 ..S EC4N=$P($G(^SC(+EC4,0)),"^",1)
"RTN","ECMUTL1",102,0)
 ..D CLIN(EC4,.ECPCL)
"RTN","ECMUTL1",103,0)
 ..S:ECPCL ECPCE("CLIN")=EC4_"^"_EC4N
"RTN","ECMUTL1",104,0)
 ..S:'ECPCL ECPCE("CLIN")=""
"RTN","ECMUTL1",105,0)
 Q ECOUT
"RTN","ECMUTL1",106,0)
 ;
"RTN","ECMUTL1",107,0)
ASKDX ;ask dx
"RTN","ECMUTL1",108,0)
 N ECDX,ECDXN,DTOUT,DUOUT,DIRUT,DIR,Y,EC4,ECDXS
"RTN","ECMUTL1",109,0)
 S (ECDX,ECDXN)="",EC4=$P(ECPCE("CLIN"),U)
"RTN","ECMUTL1",110,0)
 D PDX^ECUTL2 I ECOUT Q
"RTN","ECMUTL1",111,0)
 S ECPCE("DX")=ECDX_"^"_ECDXN
"RTN","ECMUTL1",112,0)
 D SDX^ECUTL2 I ECOUT Q
"RTN","ECMUTL1",113,0)
 M ECPCE("DXS")=ECDXS
"RTN","ECMUTL1",114,0)
 Q
"RTN","ECMUTL1",115,0)
 ;
"RTN","ECMUTL1",116,0)
CLINIC ;get associated clinic
"RTN","ECMUTL1",117,0)
 N ECDATA,EC4,EC4N,ECID,ECPCL,DTOUT,DUOUT,DIRUT,DIR,Y
"RTN","ECMUTL1",118,0)
 Q:SEND="O"&(ECPCE("I/O")'="O")
"RTN","ECMUTL1",119,0)
 F  D  Q:$G(ECOUT)  Q:$G(ECPCL) 
"RTN","ECMUTL1",120,0)
 .K DA,DIR,DIRUT,DTOUT,DUOUT
"RTN","ECMUTL1",121,0)
 .S (EC4,ECPCL)=0,EC4N=""
"RTN","ECMUTL1",122,0)
 .S DIR(0)="721,26",DIR("A")="Associated Clinic",DIR("?")="An active clinic is required. Enter an active clinic or an ^ to exit"
"RTN","ECMUTL1",123,0)
 .D ^DIR
"RTN","ECMUTL1",124,0)
 .S:$D(DTOUT) ECOUT=1 S:$D(DUOUT) ECOUT=2
"RTN","ECMUTL1",125,0)
 .Q:$G(ECOUT)
"RTN","ECMUTL1",126,0)
 .I 'Y W !!?5,"You must enter an active clinic now.",! Q
"RTN","ECMUTL1",127,0)
 .I Y S EC4=+Y,ECDATA=$G(^SC(+EC4,0)),ECID=$P(ECDATA,"^",7),EC4N=$P(ECDATA,"^",1)
"RTN","ECMUTL1",128,0)
 .I $G(EC4) D CLIN(EC4,.ECPCL) I 'ECPCL D
"RTN","ECMUTL1",129,0)
 ..W !!,?5,"The clinic you selected is inactive."
"RTN","ECMUTL1",130,0)
 ..W !,?5,"Workload data cannot be sent to PCE for Event"
"RTN","ECMUTL1",131,0)
 ..W !,?5,"Capture procedures without an active clinic."
"RTN","ECMUTL1",132,0)
 .I 'ECPCL W !!?5,"You must enter an active clinic now.",!
"RTN","ECMUTL1",133,0)
 Q:'$G(ECPCL)
"RTN","ECMUTL1",134,0)
 S ECPCE("CLIN")=EC4_"^"_EC4N
"RTN","ECMUTL1",135,0)
 Q
"RTN","ECMUTL1",136,0)
 ;
"RTN","ECMUTL1",137,0)
 ;
"RTN","ECMUTL1",138,0)
VISIT ;ask visit info
"RTN","ECMUTL1",139,0)
 N ECFLG,ECCLFLDS,ECCLVAR,ECX,ECAO,ECIR,ECMST,ECMST,ECSC,ECZEC,ECHNC
"RTN","ECMUTL1",140,0)
 Q:ECPCE("I/O")="I"
"RTN","ECMUTL1",141,0)
 S (ECAO,ECIR,ECSC,ECZEC,ECX,ECMST,ECHNC)=""
"RTN","ECMUTL1",142,0)
 ;
"RTN","ECMUTL1",143,0)
 ;- Ask classification questions applicable to patient and file in #721
"RTN","ECMUTL1",144,0)
 I $$ASKCLASS^ECUTL1(+$G(ECPAT),.ECCLFLDS,.ECOUT,SEND,ECPCE("I/O")),($O(ECCLFLDS(""))]"") D SETCLASS^ECUTL1(.ECCLFLDS)
"RTN","ECMUTL1",145,0)
 Q:+$G(ECOUT)
"RTN","ECMUTL1",146,0)
 ;
"RTN","ECMUTL1",147,0)
 ;- Store classification variables into ECPCE array
"RTN","ECMUTL1",148,0)
 F ECCLVAR="ECAO","ECIR","ECZEC","ECSC","ECMST","ECHNC" I @($G(ECCLVAR))]"" S ECPCE($S($E(ECCLVAR,3,$L(ECCLVAR))'="ZEC":$E(ECCLVAR,3,$L(ECCLVAR)),1:"ENV"))=@ECCLVAR
"RTN","ECMUTL1",149,0)
 Q
"RTN","ECMUTL1",150,0)
 ;
"RTN","ECMUTL1",151,0)
 ;
"RTN","ECMUTL1",152,0)
CLIN(EC4,ECPCL) ;check for active associated clinic
"RTN","ECMUTL1",153,0)
 N ECPCID,ECPCRD
"RTN","ECMUTL1",154,0)
 D CLIN^ECPCEU
"RTN","ECMUTL1",155,0)
 Q
"RTN","ECMUTL1",156,0)
 ;
"RTN","ECMUTL1",157,0)
 ;
"RTN","ECMUTL1",158,0)
MSGDX ;if ecout & essential data missing, display msg
"RTN","ECMUTL1",159,0)
 Q:SEND="N"  Q:SEND="O"&(ECPCE("I/O")'="O")
"RTN","ECMUTL1",160,0)
 I ECPCE("DX")="" D  Q
"RTN","ECMUTL1",161,0)
 .W !!,?5,"Please note that data cannot be sent to PCE"
"RTN","ECMUTL1",162,0)
 .W !,?5,"for workload reporting without an ICD-9 code.",!
"RTN","ECMUTL1",163,0)
 .D MSG1
"RTN","ECMUTL1",164,0)
 Q
"RTN","ECMUTL1",165,0)
 ;
"RTN","ECMUTL1",166,0)
MSGCLN ;if ecout & essential data missing, display msg
"RTN","ECMUTL1",167,0)
 Q:SEND="N"  Q:SEND="O"&(ECPCE("I/O")'="O")
"RTN","ECMUTL1",168,0)
 I ECPCE("CLIN")="" D  Q
"RTN","ECMUTL1",169,0)
 .W !!,?5,"Please note that data cannot be sent to PCE for workload"
"RTN","ECMUTL1",170,0)
 .W !,?5,"reporting without an active associated clinic.",!
"RTN","ECMUTL1",171,0)
 .D MSG1
"RTN","ECMUTL1",172,0)
 Q
"RTN","ECMUTL1",173,0)
 ;
"RTN","ECMUTL1",174,0)
CLMSG ; Display classification questions error message
"RTN","ECMUTL1",175,0)
 Q:SEND="N"  Q:ECPCE("I/O")'="O"
"RTN","ECMUTL1",176,0)
 W !!,?5,"Please note that data cannot be sent to PCE for workload reporting"
"RTN","ECMUTL1",177,0)
 W !,?5,"unless the classification questions are answered.",!
"RTN","ECMUTL1",178,0)
 D MSG1
"RTN","ECMUTL1",179,0)
 Q
"RTN","ECMUTL1",180,0)
 ;
"RTN","ECMUTL1",181,0)
 ;
"RTN","ECMUTL1",182,0)
MSG1 ;Error message display
"RTN","ECMUTL1",183,0)
 N DIR,Y
"RTN","ECMUTL1",184,0)
 S DIR(0)="E",DIR("A")="Press RETURN to continue"
"RTN","ECMUTL1",185,0)
 D ^DIR
"RTN","ECMUTL1",186,0)
 W !
"RTN","ECMUTL1",187,0)
 Q
"RTN","ECMUTL1",188,0)
 ;
"RTN","ECMUTL1",189,0)
 ;
"RTN","ECMUTL1",190,0)
INOUT(ECPTIEN,ECARRY) ; Determine inpatient/outpatient status
"RTN","ECMUTL1",191,0)
 ;
"RTN","ECMUTL1",192,0)
 N ECOUT
"RTN","ECMUTL1",193,0)
 S ECOUT=0
"RTN","ECMUTL1",194,0)
 S ECARRY=$G(ECARRY)
"RTN","ECMUTL1",195,0)
 S ECPTIEN=+$G(ECPTIEN)
"RTN","ECMUTL1",196,0)
 ;
"RTN","ECMUTL1",197,0)
 ; - If ECARRY not defined, use ^TMP("ECMPIDX",$J)
"RTN","ECMUTL1",198,0)
 S:(ECARRY="") ECARRY="^TMP(""ECMPIDX"",$J)"
"RTN","ECMUTL1",199,0)
 ;
"RTN","ECMUTL1",200,0)
 S ECPCE("I/O")=$$INOUTPT^ECUTL0(ECPTIEN,+$P(@ECARRY@(+$O(@ECARRY@(""),-1)),"^",2))
"RTN","ECMUTL1",201,0)
 I ECPCE("I/O")="" D INOUTERR^ECUTL0
"RTN","ECMUTL1",202,0)
 Q $S(+$G(ECOUT)=0:1,1:0)
"RTN","ECMUTL1",203,0)
 ;
"RTN","ECMUTL1",204,0)
 ;
"RTN","ECMUTL1",205,0)
ASKELIG(ECDSS,ECIO,ECPTIEN) ; Determine patient eligibility
"RTN","ECMUTL1",206,0)
 ;
"RTN","ECMUTL1",207,0)
 ;   Input:
"RTN","ECMUTL1",208,0)
 ;      ECDSS - DSS Unit IEN
"RTN","ECMUTL1",209,0)
 ;      ECIO - Inpatient or Outpatient
"RTN","ECMUTL1",210,0)
 ;      ECPTIEN - DFN of Patient file (#2)
"RTN","ECMUTL1",211,0)
 ;
"RTN","ECMUTL1",212,0)
 ;  Output:
"RTN","ECMUTL1",213,0)
 ;      ECPCE("ELIG") - containing patient eligibility
"RTN","ECMUTL1",214,0)
 ;
"RTN","ECMUTL1",215,0)
 N VAEL
"RTN","ECMUTL1",216,0)
 S ECDSS=+$G(ECDSS)
"RTN","ECMUTL1",217,0)
 S ECIO=$G(ECIO)
"RTN","ECMUTL1",218,0)
 S ECPTIEN=+$G(ECPTIEN)
"RTN","ECMUTL1",219,0)
 ;
"RTN","ECMUTL1",220,0)
 ;- Get elig if Send to PCE="A" or Send to PCE="O" and outpatient
"RTN","ECMUTL1",221,0)
 I $$CHKDSS^ECUTL0(+$G(ECDSS),ECIO) D
"RTN","ECMUTL1",222,0)
 . ;
"RTN","ECMUTL1",223,0)
 . ;- If dual elig, ask user to select otherwise use primary elig
"RTN","ECMUTL1",224,0)
 . I $$MULTELG^ECUTL0(+$G(ECPTIEN)) S ECPCE("ELIG")=+$$ELGLST^ECUTL0
"RTN","ECMUTL1",225,0)
 . E  S ECPCE("ELIG")=+$G(VAEL(1))
"RTN","ECMUTL1",226,0)
 Q
"RTN","ECMUTL1",227,0)
 ;
"RTN","ECMUTL1",228,0)
REMOVE(ECPAT) ; Remove patient from selected patient list because required data missing
"RTN","ECMUTL1",229,0)
 N DFN,ECI
"RTN","ECMUTL1",230,0)
 S DFN=+ECPAT,ECI=0
"RTN","ECMUTL1",231,0)
 F  S ECI=$O(^TMP("ECPLST",$J,ECI)) Q:'ECI  D
"RTN","ECMUTL1",232,0)
 .I +$G(^TMP("ECPLST",$J,ECI))=DFN D
"RTN","ECMUTL1",233,0)
 ..K ^TMP("ECPLST",$J,ECI),^TMP("ECMPTIDX",$J,ECI),^TMP("ECPAT",$J,DFN)
"RTN","ECMUTL1",234,0)
 ..W !?5,"Patient deselected because required data missing.",!
"RTN","ECMUTL1",235,0)
 ..D MSG1
"RTN","ECMUTL1",236,0)
 Q
"RTN","ECUERPC2")
0^4^B3503395
"RTN","ECUERPC2",1,0)
ECUERPC2 ;ALB/JAM;Event Capture Data Entry Broker Utilities ;Apr 24, 2002
"RTN","ECUERPC2",2,0)
 ;;2.0; EVENT CAPTURE ;**41,39,50**;8 May 96
"RTN","ECUERPC2",3,0)
 ;
"RTN","ECUERPC2",4,0)
ECDOD(RESULTS,ECARY) ;RPC Broker entry point to get a patient's date of death
"RTN","ECUERPC2",5,0)
 ;        RPC: EC DIEDON
"RTN","ECUERPC2",6,0)
 ;INPUTS   ECARY - Contains the following elements as input
"RTN","ECUERPC2",7,0)
 ;          ECDFN - Patient DFN
"RTN","ECUERPC2",8,0)
 ;
"RTN","ECUERPC2",9,0)
 ;OUTPUTS  RESULTS - Fileman Internal Date of Patient date of Death^
"RTN","ECUERPC2",10,0)
 ;                   Message with Patient External Date of Death
"RTN","ECUERPC2",11,0)
 ;
"RTN","ECUERPC2",12,0)
 N ECDFN,DFN,VADM
"RTN","ECUERPC2",13,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC2",14,0)
 S ECDFN=$P(ECARY,U),RESULTS="^"
"RTN","ECUERPC2",15,0)
 I ECDFN="" S RESULTS="0^Patient DFN not defined" Q
"RTN","ECUERPC2",16,0)
 ;NOIS MWV-0603-21781: line below changed by VMP
"RTN","ECUERPC2",17,0)
 S DFN=ECDFN D 2^VADPT I +VADM(6) S RESULTS=$P(VADM(6),U)_"^"_"[PATIENT DIED ON "_$P(VADM(6),U,2)_"]"
"RTN","ECUERPC2",18,0)
 Q
"RTN","ECUERPC2",19,0)
VISINFO(RESULTS,ECARY) ;
"RTN","ECUERPC2",20,0)
 ;
"RTN","ECUERPC2",21,0)
 ;Broker call returns the EC values based on a Visit Number
"RTN","ECUERPC2",22,0)
 ;        RPC: EC GETVISITINFO
"RTN","ECUERPC2",23,0)
 ;INPUTS   ECARY - Contains the following subscripted elements
"RTN","ECUERPC2",24,0)
 ;          ECVSN - Visit Number, IEN in file (#9000010)
"RTN","ECUERPC2",25,0)
 ;
"RTN","ECUERPC2",26,0)
 ;OUTPUTS  RESULTS - Contains the following data:-
"RTN","ECUERPC2",27,0)
 ;          Location IEN^DSS Unit IEN^Proc Date/Time Fileman^
"RTN","ECUERPC2",28,0)
 ;           Procedure Date/Time Readable^Patient DFN
"RTN","ECUERPC2",29,0)
 ;          0^Error Message (if error)
"RTN","ECUERPC2",30,0)
 ;
"RTN","ECUERPC2",31,0)
 N ECLOC,ECUNT,NODE,Y,ECPXDT,DA,ECVSN,ECDFN,DSSF,LOC,UNT
"RTN","ECUERPC2",32,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC2",33,0)
 S ECVSN=$P(ECARY,U) I ECVSN="" S RESULTS=0_"^Visit undefined" Q
"RTN","ECUERPC2",34,0)
 K ^TMP($J,"ECVISINFO")
"RTN","ECUERPC2",35,0)
 S DA=$O(^ECH("C",ECVSN,0)) I 'DA D  Q
"RTN","ECUERPC2",36,0)
 . S RESULTS=0_"^Visit not on File"
"RTN","ECUERPC2",37,0)
 S NODE=$G(^ECH(DA,0)) I NODE="" D  Q
"RTN","ECUERPC2",38,0)
 . S RESULTS=0_"No corresponding EC procedures found for Visit"
"RTN","ECUERPC2",39,0)
 S ECLOC=$P(NODE,U,4),ECUNT=$P(NODE,U,7),ECPXDT=$P(NODE,U,3)
"RTN","ECUERPC2",40,0)
 S LOC=$P($G(^DIC(4,ECLOC,0)),U),UNT=$G(^ECD(ECUNT,0)),DSSF=$P(UNT,U,14)
"RTN","ECUERPC2",41,0)
 S UNT=$P(UNT,U) S:DSSF="" DSSF="N"
"RTN","ECUERPC2",42,0)
 S ECDFN=$P(NODE,U,2),Y=ECPXDT X ^DD("DD")
"RTN","ECUERPC2",43,0)
 S RESULTS=ECLOC_U_LOC_U_ECUNT_U_UNT_U_DSSF_U_ECPXDT_U_Y_U_ECDFN
"RTN","ECUERPC2",44,0)
 Q
"VER")
8.0^22
**END**
**END**
