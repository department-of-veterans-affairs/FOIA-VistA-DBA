Released SR*3*123 SEQ #115
Extracted from mail message
**KIDS**:SR*3.0*123^

**INSTALL NAME**
SR*3.0*123
"BLD",1405,0)
SR*3.0*123^SURGERY^0^3030922^y
"BLD",1405,1,0)
^^12^12^3030922^
"BLD",1405,1,1,0)
As a follow-up enhancement to Surgery patch SR*3*115 (released April 8, 
"BLD",1405,1,2,0)
2003), this patch updates the Quarterly Report by adding the Compliance 
"BLD",1405,1,3,0)
Summary portion of the Ensuring Correct Surgery Compliance Report (made 
"BLD",1405,1,4,0)
available by patch SR*3*120) to the end of the existing Quarterly Report.
"BLD",1405,1,5,0)
This additional information will be transmitted as part of the Quarterly
"BLD",1405,1,6,0)
Report that goes to Surgical Service, Central Office.
"BLD",1405,1,7,0)
 
"BLD",1405,1,8,0)
A post-install process will automatically transmit the Quarterly Report 
"BLD",1405,1,9,0)
for the third quarter of Fiscal Year 2003. If this patch is installed
"BLD",1405,1,10,0)
after November 13, 2003, the Quarterly Report for the fourth quarter of
"BLD",1405,1,11,0)
Fiscal Year 2003 will also be automatically transmitted by a post-install
"BLD",1405,1,12,0)
process.
"BLD",1405,4,0)
^9.64PA^^
"BLD",1405,"ABPKG")
n
"BLD",1405,"INID")
^y
"BLD",1405,"INIT")
SR123UTL
"BLD",1405,"KRN",0)
^9.67PA^8989.52^19
"BLD",1405,"KRN",.4,0)
.4
"BLD",1405,"KRN",.401,0)
.401
"BLD",1405,"KRN",.402,0)
.402
"BLD",1405,"KRN",.403,0)
.403
"BLD",1405,"KRN",.5,0)
.5
"BLD",1405,"KRN",.84,0)
.84
"BLD",1405,"KRN",3.6,0)
3.6
"BLD",1405,"KRN",3.8,0)
3.8
"BLD",1405,"KRN",9.2,0)
9.2
"BLD",1405,"KRN",9.8,0)
9.8
"BLD",1405,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",1405,"KRN",9.8,"NM",1,0)
SROQ0^^0^B25679575
"BLD",1405,"KRN",9.8,"NM",2,0)
SROQ1^^0^B21719694
"BLD",1405,"KRN",9.8,"NM",3,0)
SROQ2^^0^B32314400
"BLD",1405,"KRN",9.8,"NM",4,0)
SROQM^^0^B13125257
"BLD",1405,"KRN",9.8,"NM",5,0)
SROQT^^0^B23713383
"BLD",1405,"KRN",9.8,"NM","B","SROQ0",1)

"BLD",1405,"KRN",9.8,"NM","B","SROQ1",2)

"BLD",1405,"KRN",9.8,"NM","B","SROQ2",3)

"BLD",1405,"KRN",9.8,"NM","B","SROQM",4)

"BLD",1405,"KRN",9.8,"NM","B","SROQT",5)

"BLD",1405,"KRN",19,0)
19
"BLD",1405,"KRN",19.1,0)
19.1
"BLD",1405,"KRN",101,0)
101
"BLD",1405,"KRN",409.61,0)
409.61
"BLD",1405,"KRN",771,0)
771
"BLD",1405,"KRN",870,0)
870
"BLD",1405,"KRN",8989.51,0)
8989.51
"BLD",1405,"KRN",8989.52,0)
8989.52
"BLD",1405,"KRN",8994,0)
8994
"BLD",1405,"KRN","B",.4,.4)

"BLD",1405,"KRN","B",.401,.401)

"BLD",1405,"KRN","B",.402,.402)

"BLD",1405,"KRN","B",.403,.403)

"BLD",1405,"KRN","B",.5,.5)

"BLD",1405,"KRN","B",.84,.84)

"BLD",1405,"KRN","B",3.6,3.6)

"BLD",1405,"KRN","B",3.8,3.8)

"BLD",1405,"KRN","B",9.2,9.2)

"BLD",1405,"KRN","B",9.8,9.8)

"BLD",1405,"KRN","B",19,19)

"BLD",1405,"KRN","B",19.1,19.1)

"BLD",1405,"KRN","B",101,101)

"BLD",1405,"KRN","B",409.61,409.61)

"BLD",1405,"KRN","B",771,771)

"BLD",1405,"KRN","B",870,870)

"BLD",1405,"KRN","B",8989.51,8989.51)

"BLD",1405,"KRN","B",8989.52,8989.52)

"BLD",1405,"KRN","B",8994,8994)

"BLD",1405,"QUES",0)
^9.62^^
"BLD",1405,"REQB",0)
^9.611^2^2
"BLD",1405,"REQB",1,0)
SR*3.0*95^2
"BLD",1405,"REQB",2,0)
SR*3.0*120^2
"BLD",1405,"REQB","B","SR*3.0*120",2)

"BLD",1405,"REQB","B","SR*3.0*95",1)

"INIT")
SR123UTL
"MBREQ")
0
"PKG",161,-1)
1^1
"PKG",161,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",161,20,0)
^9.402P^^
"PKG",161,22,0)
^9.49I^1^1
"PKG",161,22,1,0)
3.0^2930624^2940921
"PKG",161,22,1,"PAH",1,0)
123^3030922^517
"PKG",161,22,1,"PAH",1,1,0)
^^12^12^3030922
"PKG",161,22,1,"PAH",1,1,1,0)
As a follow-up enhancement to Surgery patch SR*3*115 (released April 8, 
"PKG",161,22,1,"PAH",1,1,2,0)
2003), this patch updates the Quarterly Report by adding the Compliance 
"PKG",161,22,1,"PAH",1,1,3,0)
Summary portion of the Ensuring Correct Surgery Compliance Report (made 
"PKG",161,22,1,"PAH",1,1,4,0)
available by patch SR*3*120) to the end of the existing Quarterly Report.
"PKG",161,22,1,"PAH",1,1,5,0)
This additional information will be transmitted as part of the Quarterly
"PKG",161,22,1,"PAH",1,1,6,0)
Report that goes to Surgical Service, Central Office.
"PKG",161,22,1,"PAH",1,1,7,0)
 
"PKG",161,22,1,"PAH",1,1,8,0)
A post-install process will automatically transmit the Quarterly Report 
"PKG",161,22,1,"PAH",1,1,9,0)
for the third quarter of Fiscal Year 2003. If this patch is installed
"PKG",161,22,1,"PAH",1,1,10,0)
after November 13, 2003, the Quarterly Report for the fourth quarter of
"PKG",161,22,1,"PAH",1,1,11,0)
Fiscal Year 2003 will also be automatically transmitted by a post-install
"PKG",161,22,1,"PAH",1,1,12,0)
process.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","SR123UTL")
0^^B1796183
"RTN","SR123UTL",1,0)
SR123UTL ;BIR/ADM-Utility routine for patch SR*3*123; [08/07/03  10:33 AM ]
"RTN","SR123UTL",2,0)
 ;;3.0; Surgery ;**123**;24 Jun 93
"RTN","SR123UTL",3,0)
POST ; post-install action for SR*3*123
"RTN","SR123UTL",4,0)
 ; transmit quarterly reports for 3rd and 4th quarters of FY03
"RTN","SR123UTL",5,0)
 S (SRFLG,SRT)=1 D NOW^%DTC S SRNOW=$E(%,1,12)
"RTN","SR123UTL",6,0)
 S SRSTART=3030401,SREND=3030630 D TSK S SRQTR="3" D MSG
"RTN","SR123UTL",7,0)
 I DT>3031113 S SRSTART=3030701,SREND=3030930 D TSK S SRQTR="4" D MSG
"RTN","SR123UTL",8,0)
 K SREND,SRFLG,SRNOW,SRQTR,SRSTART
"RTN","SR123UTL",9,0)
 Q
"RTN","SR123UTL",10,0)
TSK S ZTDTH=SRNOW,ZTIO="",ZTDESC="Surgery Quarterly Report",(ZTSAVE("SRSTART"),ZTSAVE("SREND"),ZTSAVE("SRFLG"),ZTSAVE("SRT"))="",ZTRTN="EN^SROQT" D ^%ZTLOAD
"RTN","SR123UTL",11,0)
 Q
"RTN","SR123UTL",12,0)
MSG D MES^XPDUTL("  Surgery Quarterly Report for Quarter #"_SRQTR_" of FY03 queued...")
"RTN","SR123UTL",13,0)
 Q
"RTN","SROQ0")
0^1^B25679575
"RTN","SROQ0",1,0)
SROQ0 ;B'HAM ISC/ADM - QUARTERLY REPORT (CONTINUED) ; [ 07/03/03  12:43 PM ]
"RTN","SROQ0",2,0)
 ;;3.0; Surgery ;**62,70,77,50,95,123**;24 Jun 93
"RTN","SROQ0",3,0)
 ;
"RTN","SROQ0",4,0)
 ; Reference to ^DIC(45.3 supported by DBIA #218
"RTN","SROQ0",5,0)
 ;
"RTN","SROQ0",6,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROQ0",7,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROQ0",8,0)
 ;**         are prohibited.
"RTN","SROQ0",9,0)
 ;
"RTN","SROQ0",10,0)
 S SR(0)=^SRF(SRTN,0),DFN=$P(SR(0),"^") I '$D(^TMP("SRDPT",$J,DFN)) S ^TMP("SRDPT",$J,DFN)="",SRDPT=SRDPT+1
"RTN","SROQ0",11,0)
 D DEM^VADPT S X1=SRSD,X2=$P(VADM(3),"^"),SRAGE=$E(X1,1,3)-$E(X2,1,3)-($E(X1,4,7)<$E(X2,4,7)) I SRAGE>60 S SR60=SR60+1
"RTN","SROQ0",12,0)
 S SRDEATH=0,SRREL="" I $P(VADM(6),"^"),SRSD<$P(VADM(6),"^") S X1=SRSD,X2=30 D C^%DTC I $P(VADM(6),"^")'>X S SRDEATH=1
"RTN","SROQ0",13,0)
 I SRDEATH S ^TMP("SRDTH",$J,DFN)=""
"RTN","SROQ0",14,0)
 S SRMM=$P(SR(0),"^",3) I SRMM="J" S SRMAJOR=SRMAJOR+1
"RTN","SROQ0",15,0)
 S SRIOSTAT=$P(SR(0),"^",12) I SRIOSTAT'="I"&(SRIOSTAT'="O") S VAIP("D")=SRSD D IN5^VADPT S SRIOSTAT=$S(VAIP(13):"I",1:"O") K VAIP
"RTN","SROQ0",16,0)
 I SRIOSTAT="I" S SRINPAT=SRINPAT+1
"RTN","SROQ0",17,0)
 S Y=$P($G(^SRF(SRTN,1.1)),"^",3),C=$P(^DD(130,1.13,0),"^",2) D:Y'="" Y^DIQ S SRASA=$P(Y,"-")
"RTN","SROQ0",18,0)
 S SREM=$P(SR(0),"^",10) I SREM="EM"!(SRASA["E") S SREMERG=SREMERG+1
"RTN","SROQ0",19,0)
COMP ; check for post-op complications
"RTN","SROQ0",20,0)
 S SRPOC=0 I $O(^SRF(SRTN,16,0)) S SRPOC=1,SRCOMP=SRCOMP+1
"RTN","SROQ0",21,0)
ASA ; find ASA class for major procedures
"RTN","SROQ0",22,0)
 I SRMM="J" S Z=$E(SRASA) S:Z="" Z=7 S SRASA(Z)=SRASA(Z)+1
"RTN","SROQ0",23,0)
SP ; find specialty data
"RTN","SROQ0",24,0)
 S X=$P(SR(0),"^",4),Y=$S(X:$P(^SRO(137.45,X,0),"^",2),1:"ZZ") S SRSS=$S(Y:$P(^DIC(45.3,Y,0),"^"),1:Y) I '$D(SRSPEC(SRSS)) S SRSS="ZZ"
"RTN","SROQ0",25,0)
 F I=1:1:4 S SRP(I)=$P(^TMP("SRSS",$J,SRSS),"^",I)
"RTN","SROQ0",26,0)
 I '$D(^TMP("SRDPT",$J,DFN,SRSS)) S ^TMP("SRDPT",$J,DFN,SRSS)="",SRP(1)=SRP(1)+1
"RTN","SROQ0",27,0)
 S SRP(2)=SRP(2)+1 S:SRMM="J" SRP(3)=SRP(3)+1 S:SRMM'="J" SRP(4)=SRP(4)+1
"RTN","SROQ0",28,0)
 S ^TMP("SRSS",$J,SRSS)=SRP(1)_"^"_SRP(2)_"^"_SRP(3)_"^"_SRP(4) K SRP
"RTN","SROQ0",29,0)
 D ^SROQ0A
"RTN","SROQ0",30,0)
WC ; clean wound ?
"RTN","SROQ0",31,0)
 S SRCLEAN=0 I $P($G(^SRF(SRTN,"1.0")),"^",8)="C" S SRWC=SRWC+1,SRCLEAN=1
"RTN","SROQ0",32,0)
CAT ; complication categories
"RTN","SROQ0",33,0)
 S SRW=0
"RTN","SROQ0",34,0)
 I SRPOC S SRC=0 F  S SRC=$O(^SRF(SRTN,16,SRC)) Q:'SRC  S SRCAT=$P(^SRF(SRTN,16,SRC,0),"^",2) I SRCAT D
"RTN","SROQ0",35,0)
 .S SRCAT=$S(SRCAT=33:29,SRCAT=34:32,1:SRCAT)
"RTN","SROQ0",36,0)
 .S SRC(SRCAT)=SRC(SRCAT)+1 I SRCLEAN,(SRCAT=1!(SRCAT=2)) S SRW=1
"RTN","SROQ0",37,0)
 I $O(^SRF(SRTN,10,0)) S SRC=0 F  S SRC=$O(^SRF(SRTN,10,SRC)) Q:'SRC  S SRCAT=$P(^SRF(SRTN,10,SRC,0),"^",2) I SRCAT S SRC(SRCAT)=SRC(SRCAT)+1 I SRCLEAN,(SRCAT=1!(SRCAT=2)) S SRW=1
"RTN","SROQ0",38,0)
 I SRW S SRIN=SRIN+1
"RTN","SROQ0",39,0)
ENSURE ; check ensuring correct surgery compliance
"RTN","SROQ0",40,0)
 S SRVER=$G(^SRF(SRTN,"VER"))
"RTN","SROQ0",41,0)
TOV ; process time out verified field
"RTN","SROQ0",42,0)
 S SR71=$P(SRVER,"^",3) D
"RTN","SROQ0",43,0)
 .I SR71="Y" S SRTOV=SRTOV+1 Q
"RTN","SROQ0",44,0)
 .I SR71="N" S SRTONO=SRTONO+1 Q
"RTN","SROQ0",45,0)
 .S SRTONE=SRTONE+1
"RTN","SROQ0",46,0)
IC ; process imaging confirmed field
"RTN","SROQ0",47,0)
 S SR72=$P(SRVER,"^",4) D
"RTN","SROQ0",48,0)
 .I SR72="Y" S SRICY=SRICY+1 Q
"RTN","SROQ0",49,0)
 .I SR72="N" S SRICNO=SRICNO+1 Q
"RTN","SROQ0",50,0)
 .I SR72="NA" S SRICNA=SRICNA+1 Q
"RTN","SROQ0",51,0)
 .S SRICNE=SRICNE+1
"RTN","SROQ0",52,0)
 Q
"RTN","SROQ0",53,0)
HDR ; print page header
"RTN","SROQ0",54,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROQ0",55,0)
 I SRHDR,$E(IOST)="C" W !!,"Press RETURN to continue, or '^' to quit: " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SROQ0",56,0)
 S SRHDR=1 I $E(IOST)'="P" W @IOF Q
"RTN","SROQ0",57,0)
 S SRPAGE=SRPAGE+1 I 'SRFLG D HDR1 Q
"RTN","SROQ0",58,0)
 W:$Y @IOF W !,?23,"QUARTERLY REPORT - SURGICAL SERVICE",?76,"PAGE",!,?35,"VERSION 3.0",?78,SRPAGE
"RTN","SROQ0",59,0)
 I SRINST["ALL DIV" W !!,?(80-$L("Hospital: "_SRINST)\2),"Hospital: ",SRINST,!,?30,"Station Number: ",SRSTATN
"RTN","SROQ0",60,0)
 I SRINST'["ALL DIV" W !!,?3,"Hospital: ",SRINST,?55,"Station Number: ",SRSTATN
"RTN","SROQ0",61,0)
 W !,?3,"For Dates: ",SRSD,?32,"to: ",SRED,?55,"Fiscal Year: ",SRYR,! F I=1:1:80 W "="
"RTN","SROQ0",62,0)
 Q
"RTN","SROQ0",63,0)
HDR1 ; print header if not quarterly report
"RTN","SROQ0",64,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROQ0",65,0)
 W:$Y @IOF W !,?24,"SUMMARY REPORT - SURGICAL SERVICE",?76,"PAGE",!,?35,"VERSION 3.0",?78,SRPAGE
"RTN","SROQ0",66,0)
 W !!,?(80-$L("Hospital: "_SRINST)\2),"Hospital: ",SRINST,!,?30,"Station Number: ",SRSTATN
"RTN","SROQ0",67,0)
 W !,?20,"For Dates: ",SRSD,"  to: ",SRED I $E(IOST)="P" W ! F I=1:1:80 W "="
"RTN","SROQ0",68,0)
 Q
"RTN","SROQ0",69,0)
QTR D CHECK I '$D(X) D HELP
"RTN","SROQ0",70,0)
 K SRX,SRY
"RTN","SROQ0",71,0)
 Q
"RTN","SROQ0",72,0)
CHECK I ($L(X)'=4&($L(X)'=6))!(X'["-") K X Q
"RTN","SROQ0",73,0)
 I $P(X,"-",2)?1N,"1243"'[$P(X,"-",2) K X Q
"RTN","SROQ0",74,0)
 I $L(X)=4 D FOUR Q
"RTN","SROQ0",75,0)
 I X'?4N1"-"1N K X Q
"RTN","SROQ0",76,0)
 S SRX=$P(X,"-") I SRX<1996!(SRX>2010) K X Q
"RTN","SROQ0",77,0)
 S SRY=$P(X,"-",2) I "1234"'[SRY K X Q
"RTN","SROQ0",78,0)
 S X=SRX_SRY
"RTN","SROQ0",79,0)
 Q
"RTN","SROQ0",80,0)
HELP K SRHELP S SRHELP(1)="",SRHELP(2)="Answer must be in format :  FISCAL YEAR-QUARTER",SRHELP(3)="",SRHELP(4)="NOTE:  A hyphen (-) must separate FISCAL YEAR and QUARTER.  The FISCAL"
"RTN","SROQ0",81,0)
 S SRHELP(5)="       YEAR must be in the range 1996 to 2010.",SRHELP(6)="",SRHELP(7)="FISCAL YEAR portion of answer may be entered in either 2 or 4 digit",SRHELP(8)="format, for example, 1996 or 96 for FISCAL YEAR 1996."
"RTN","SROQ0",82,0)
 S SRHELP(9)="",SRHELP(10)="QUARTER must be a number, (1, 2, 3 or 4).",SRHELP(11)="",SRHELP(12)="Example:  For second quarter of fiscal year 1996, enter 1996-2 or 96-2.",SRHELP(13)="" D EN^DDIOL(.SRHELP) K SRHELP
"RTN","SROQ0",83,0)
 Q
"RTN","SROQ0",84,0)
FOUR I X'?2N1"-"1N K X Q
"RTN","SROQ0",85,0)
 S SRX=$P(X,"-") I SRX>9&(SRX<96) K X Q
"RTN","SROQ0",86,0)
 S SRX=$S($E(X)=9:"19"_SRX,1:"20"_SRX),SRY=$P(X,"-",2),X=SRX_SRY
"RTN","SROQ0",87,0)
 Q
"RTN","SROQ1")
0^2^B21719694
"RTN","SROQ1",1,0)
SROQ1 ;B'HAM ISC/ADM - QUARTERLY REPORT (CONTINUED) ; [ 07/03/03  11:43 AM ]
"RTN","SROQ1",2,0)
 ;;3.0; Surgery ;**38,62,70,50,95,123**;24 Jun 93
"RTN","SROQ1",3,0)
 ;
"RTN","SROQ1",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROQ1",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROQ1",6,0)
 ;**         are prohibited.
"RTN","SROQ1",7,0)
 ;
"RTN","SROQ1",8,0)
 Q:SRSOUT  U IO S (SRHDR,SRPAGE)=0 D HDR^SROQ0 Q:SRSOUT
"RTN","SROQ1",9,0)
TOT W !!,?35,"Total Cases",?55,"% of Total",!,?35,"-----------",?55,"----------"
"RTN","SROQ1",10,0)
 W !,?5,"Surgical Cases",?37,$J(SRCASES,6) W:SRCASES ?57,"100.0" S SRALL=SRCASES I 'SRALL S SRALL=1
"RTN","SROQ1",11,0)
 W !,?5,"Major Procedures",?37,$J(SRMAJOR,6),?57,$J(((SRMAJOR/SRALL)*100),5,1) S SRMAJ=SRMAJOR I 'SRMAJOR S SRMAJ=1
"RTN","SROQ1",12,0)
ASA F I=1:1:6 W !,?9,"ASA Class ("_I_")",?37,$J(SRASA(I),6),?57,$J(((SRASA(I)/SRMAJ)*100),5,1)
"RTN","SROQ1",13,0)
 I SRASA(7) W !,?9,"ASA Class (Not Entered)",?37,$J(SRASA(7),6),?57,$J(((SRASA(7)/SRMAJ)*100),5,1)
"RTN","SROQ1",14,0)
 W !,?5,"Postoperative Deaths",?37,$J(SRMORT,6),?57,$J(((SRMORT/SRALL)*100),5,1),!,?9,"Ambulatory: "_SROPD
"RTN","SROQ1",15,0)
 W !,?5,"Postoperative Occurrences",?37,$J(SRCOMP,6),?57,$J(((SRCOMP/SRALL)*100),5,1)
"RTN","SROQ1",16,0)
 W !,?5,"Ambulatory Procedures",?37,$J((SRCASES-SRINPAT),6),?57,$J((((SRCASES-SRINPAT)/SRALL)*100),5,1)
"RTN","SROQ1",17,0)
 W !,?9,"Admitted Within 14 Days: "_SRADMT
"RTN","SROQ1",18,0)
 W !,?9,"Invasive Diagnostic: "_SRINV("O")
"RTN","SROQ1",19,0)
 W !,?5,"Inpatient Procedures",?37,$J(SRINPAT,6),?57,$J(((SRINPAT/SRALL)*100),5,1)
"RTN","SROQ1",20,0)
 W !,?5,"Emergency Procedures",?37,$J(SREMERG,6),?57,$J(((SREMERG/SRALL)*100),5,1)
"RTN","SROQ1",21,0)
 W !,?5,"Age>60 Years",?37,$J(SR60,6),?57,$J(((SR60/SRALL)*100),5,1)
"RTN","SROQ1",22,0)
SP D:$E(IOST)="C" HDR^SROQ0 Q:SRSOUT  W:$E(IOST)'="C" !
"RTN","SROQ1",23,0)
 W !!,?30,"SPECIALTY PROCEDURES",!,?30,"--------------------",!,?66,"---DEATHS---"
"RTN","SROQ1",24,0)
 W !,?27,"PATIENTS   CASES    MAJOR    MINOR     TOTAL    %"
"RTN","SROQ1",25,0)
 W !,?27,"--------   -----    -----    -----     -----   ----"
"RTN","SROQ1",26,0)
SRSS ; print data for each specialty
"RTN","SROQ1",27,0)
 S SRPTF=50,SRSP="GENERAL" D SPOUT
"RTN","SROQ1",28,0)
 S SRPTF=51,SRSP="GYNECOLOGY" D SPOUT
"RTN","SROQ1",29,0)
 S SRPTF=52,SRSP="NEUROSURGERY" D SPOUT
"RTN","SROQ1",30,0)
 S SRPTF=53,SRSP="OPHTHALMOLOGY" D SPOUT
"RTN","SROQ1",31,0)
 S SRPTF=54,SRSP="ORTHOPEDICS" D SPOUT
"RTN","SROQ1",32,0)
 S SRPTF=55,SRSP="OTORHINOLARYNGOLOGY" D SPOUT
"RTN","SROQ1",33,0)
 S SRPTF=56,SRSP="PLASTIC SURGERY" D SPOUT
"RTN","SROQ1",34,0)
 S SRPTF=57,SRSP="PROCTOLOGY" D SPOUT
"RTN","SROQ1",35,0)
 S SRPTF=58,SRSP="THORACIC SURGERY" D SPOUT
"RTN","SROQ1",36,0)
 S SRPTF=59,SRSP="UROLOGY" D SPOUT
"RTN","SROQ1",37,0)
 S SRPTF=60,SRSP="ORAL SURGERY" D SPOUT
"RTN","SROQ1",38,0)
 S SRPTF=61,SRSP="PODIATRY" D SPOUT
"RTN","SROQ1",39,0)
 S SRPTF=62,SRSP="PERIPHERAL VASCULAR" D SPOUT
"RTN","SROQ1",40,0)
 S SRPTF=500,SRSP="CARDIAC SURGERY" D SPOUT
"RTN","SROQ1",41,0)
 S SRPTF=501,SRSP="TRANSPLANTATION" D SPOUT
"RTN","SROQ1",42,0)
 S SRPTF=502,SRSP="ANESTHESIOLOGY" D SPOUT
"RTN","SROQ1",43,0)
 I +^TMP("SRSS",$J,"ZZ") S SRPTF="ZZ",SRSP="SPECIALTY NOT ENTERED" D SPOUT
"RTN","SROQ1",44,0)
RES ; resident supervision
"RTN","SROQ1",45,0)
 I $E(IOST)="C" D HDR^SROQ0 Q:SRSOUT
"RTN","SROQ1",46,0)
 W !!!,?24,"LEVEL OF RESIDENT SUPERVISION (%)",!,?24,"---------------------------------",!,?42,"MAJOR     MINOR"
"RTN","SROQ1",47,0)
 S SRIX=SRCASES-SRMAJOR,SRMAJ=SRMAJOR S:'SRIX SRIX=1 S:'SRMAJ SRMAJ=1 F I=0:1:3 W !,?24,"Level ",I,?42,$J(((SRATT("J",I)/SRMAJ)*100),5,1),?52,$J(((SRATT("N",I)/SRIX)*100),5,1)
"RTN","SROQ1",48,0)
 I SRATT("N",4)!SRATT("J",4) W !,?24,"Level Not Entered",?42,$J(((SRATT("J",4)/SRMAJ)*100),5,1),?52,$J(((SRATT("N",4)/SRIX)*100),5,1)
"RTN","SROQ1",49,0)
NDEX ; print data for index procedures
"RTN","SROQ1",50,0)
 D HDR^SROQ0 Q:SRSOUT
"RTN","SROQ1",51,0)
 W !!,?32,"INDEX PROCEDURES",!,?32,"----------------"
"RTN","SROQ1",52,0)
 W !,?54,"CASES WITH",!,?30,"CASES        DEATHS     OCCURRENCES"
"RTN","SROQ1",53,0)
 W !,?30,"-----        -------    -----------"
"RTN","SROQ1",54,0)
 F J=1:1:12 D IX
"RTN","SROQ1",55,0)
 D ^SROQ1A
"RTN","SROQ1",56,0)
ENSURE ; ensuring correct surgery compliance
"RTN","SROQ1",57,0)
 D HDR^SROQ0 Q:SRSOUT
"RTN","SROQ1",58,0)
 W !!,?17,"ENSURING CORRECT SURGERY - COMPLIANCE SUMMARY",!,?17,"---------------------------------------------"
"RTN","SROQ1",59,0)
 W !!,?42,"CASES    % OF TOTAL",!,?42,"-----    ----------"
"RTN","SROQ1",60,0)
 W !,?18,"TOTAL CASES PERFORMED:"_$J(SRCASES,6) W:SRCASES ?53,"100.0"
"RTN","SROQ1",61,0)
 W !,?19,"TIME OUT VERIFIED",!,?36,"YES:"_$J(SRTOV,6) W:SRCASES ?53,$J(((SRTOV/SRCASES)*100),5,1)
"RTN","SROQ1",62,0)
 W !,?37,"NO:"_$J(SRTONO,6) W:SRCASES ?53,$J(((SRTONO/SRCASES)*100),5,1)
"RTN","SROQ1",63,0)
 W !,?28,"NOT ENTERED:"_$J(SRTONE,6) W:SRCASES ?53,$J(((SRTONE/SRCASES)*100),5,1)
"RTN","SROQ1",64,0)
 W !,?19,"IMAGING CONFIRMED",!,?36,"YES:"_$J(SRICY,6) W:SRCASES ?53,$J(((SRICY/SRCASES)*100),5,1)
"RTN","SROQ1",65,0)
 W !,?37,"NO:"_$J(SRICNO,6) W:SRCASES ?53,$J(((SRICNO/SRCASES)*100),5,1)
"RTN","SROQ1",66,0)
 W !,?25,"NOT APPLICABLE:"_$J(SRICNA,6) W:SRCASES ?53,$J(((SRICNA/SRCASES)*100),5,1)
"RTN","SROQ1",67,0)
 W !,?28,"NOT ENTERED:"_$J(SRICNE,6) W:SRCASES ?53,$J(((SRICNE/SRCASES)*100),5,1)
"RTN","SROQ1",68,0)
 W !!,?20,"OVERALL COMPLIANCE FOR THIS DATE RANGE",!,?20,"--------------------------------------"
"RTN","SROQ1",69,0)
 W !,?25," TIME OUT VERIFIED: " W:SRCASES $J(((SRTOV/SRCASES)*100),5,1),"%"
"RTN","SROQ1",70,0)
 W !,?25," IMAGING CONFIRMED: " W:SRCASES $J((((SRICY+SRICNA)/SRCASES)*100),5,1),"%"
"RTN","SROQ1",71,0)
 Q
"RTN","SROQ1",72,0)
IX ; break out index procedure data from ^TMP
"RTN","SROQ1",73,0)
 F K=1:1:3 S SRP(K)=$P(^TMP("SRPROC",$J,J),"^",K)
"RTN","SROQ1",74,0)
 D IXOUT^SROQ0A D
"RTN","SROQ1",75,0)
 .I SROP["," W:J=7 !,?5,$P(SROP,",") S SROP=$P(SROP,",",2)
"RTN","SROQ1",76,0)
 .W !,?5,SROP,?29,$J(SRP(1),6),?42,$J(SRP(3),6),?55,$J(SRP(2),6)
"RTN","SROQ1",77,0)
 Q
"RTN","SROQ1",78,0)
SPOUT ; break out data for each specialty from ^TMP
"RTN","SROQ1",79,0)
 F K=1:1:5 S SRP(K)=$P(^TMP("SRSS",$J,SRPTF),"^",K)
"RTN","SROQ1",80,0)
 I SRPTF="ZZ" S SRPTF=""
"RTN","SROQ1",81,0)
 W !,$J(SRPTF,3),?6,SRSP,?27,$J(SRP(1),6),?37,$J(SRP(2),6),?46,$J(SRP(3),6),?55,$J(SRP(4),6),?64,$J(SRP(5),6),?73,$J(((SRP(5)/$S(SRP(2):SRP(2),1:1))*100),5,1)
"RTN","SROQ1",82,0)
 Q
"RTN","SROQ2")
0^3^B32314400
"RTN","SROQ2",1,0)
SROQ2 ;B'HAM ISC/ADM - SUMMARY REPORT ; [ 07/03/03  11:44 AM ]
"RTN","SROQ2",2,0)
 ;;3.0; Surgery ;**38,62,70,50,95,123**;24 Jun 93
"RTN","SROQ2",3,0)
 ;
"RTN","SROQ2",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROQ2",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROQ2",6,0)
 ;**         are prohibited.
"RTN","SROQ2",7,0)
 ;
"RTN","SROQ2",8,0)
 S SRSOUT=0 W @IOF,!,"SUMMARY REPORT FOR SURGICAL SERVICE"
"RTN","SROQ2",9,0)
 W !!,"Enter date range for data to be included on report."
"RTN","SROQ2",10,0)
SDATE ; enter starting date
"RTN","SROQ2",11,0)
 W !,"Start with date:  " R X:DTIME I '$T!(X["^")!(X="") S SRSOUT=1 G END
"RTN","SROQ2",12,0)
 I X["?" W !,"Enter the EARLIEST date for data to be included in this report." S X="?",%DT="EX" D ^%DT G SDATE
"RTN","SROQ2",13,0)
 S %DT="EXP" D ^%DT G SDATE:Y<1 S SRSTART=Y
"RTN","SROQ2",14,0)
 I SRSTART>DT W !!,"Cannot report on operations for future dates !",! G SDATE
"RTN","SROQ2",15,0)
 S SRAC=$O(^SRF("AC",0)) I SRSTART<SRAC S Y=SRAC D DD^%DT S SRAC1=$E(Y,1,12) W !!,"NOTE: ",$S(SRAC:"No surgical case data exists before "_SRAC1_".",1:"There are no surgical cases on record !")
"RTN","SROQ2",16,0)
EDATE ; enter ending date
"RTN","SROQ2",17,0)
 W !!,"End with date:  " R X:DTIME I '$T!(X["^")!(X="") S SRSOUT=1 G END
"RTN","SROQ2",18,0)
 I X["?" W !,"Enter the LATEST date for data to be included in this report." S X="?",%DT="EX" D ^%DT G EDATE
"RTN","SROQ2",19,0)
 S %DT="EXP" D ^%DT G EDATE:Y<1 S SREND=Y
"RTN","SROQ2",20,0)
 I SRSTART>SREND W !!,"The ENDING date must be later than the BEGINNING date.  Please try again.",! G SDATE
"RTN","SROQ2",21,0)
 I SREND>DT W !!,"Cannot report on operations for future dates !",! G EDATE
"RTN","SROQ2",22,0)
 S SRFLG=0
"RTN","SROQ2",23,0)
 N SRINSTP S SRINST=$$INST^SROUTL0() G:SRINST="^" END S SRINSTP=$P(SRINST,U),SRINST=$S(SRINST["ALL DIVISIONS":SRINST,1:$P(SRINST,U,2))
"RTN","SROQ2",24,0)
IO W ! K %ZIS,IO("Q"),POP S %ZIS("A")="Print report on which Device: ",%ZIS="Q" D ^%ZIS I POP S SRSOUT=1 G END
"RTN","SROQ2",25,0)
 I $D(IO("Q")) K IO("Q") S ZTDESC="Summary Report - Surgical Service",(ZTSAVE("SRSTART"),ZTSAVE("SRINSTP"),ZTSAVE("SREND"),ZTSAVE("SRFLG"))="",ZTRTN="EN^SROQ2" D ^%ZTLOAD S SRSOUT=1 G END
"RTN","SROQ2",26,0)
EN ; entry point when queued
"RTN","SROQ2",27,0)
 D SET,^SROQ1,END
"RTN","SROQ2",28,0)
 Q
"RTN","SROQ2",29,0)
SET ; collect data
"RTN","SROQ2",30,0)
 S SRSD=SRSTART-.0001,SRED=SREND+.9999 D ZERO
"RTN","SROQ2",31,0)
 N SRXX S SRXX=$$SITE^SROVAR
"RTN","SROQ2",32,0)
 I SRFLG=1 D
"RTN","SROQ2",33,0)
 .I SRMULT D  Q
"RTN","SROQ2",34,0)
 ..S:'SRIEN SRINST=$P(SRXX,"^",2),SRSTATN=$P(SRXX,"^",3)
"RTN","SROQ2",35,0)
 ..S:'$D(SRINSTP) SRINSTP="ALL DIVISIONS",SRINST=SRINST_" - ALL DIVISIONS"
"RTN","SROQ2",36,0)
 .S SRINSTP=$P(SRXX,"^"),SRINST=$P(SRXX,"^",2),SRSTATN=+$P(SRXX,"^",3)
"RTN","SROQ2",37,0)
 I 'SRFLG D
"RTN","SROQ2",38,0)
 .I SRINSTP["ALL DIV" S SRINST=$P(SRXX,"^",2)_" - ALL DIVISIONS",SRSTATN=$P(SRXX,"^",3) Q
"RTN","SROQ2",39,0)
 .S SRINST=$$GET1^DIQ(4,SRINSTP,.01),SRSTATN=$$GET1^DIQ(4,SRINSTP,99)
"RTN","SROQ2",40,0)
 F  S SRSD=$O(^SRF("AC",SRSD)) Q:SRSD>SRED!('SRSD)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSD,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$$MANDIV^SROUTL0(SRINSTP,SRTN) D CASE
"RTN","SROQ2",41,0)
 D MORT^SROQ1A,DEATH S Y=SRSTART D DD^%DT S SRSD=$E(Y,1,12) S Y=SREND D DD^%DT S SRED=$E(Y,1,12),SRYR=$E(Y,9,12) I SRFLG,$E(SRSTART,4,5)=10 S SRYR=SRYR+1
"RTN","SROQ2",42,0)
 Q
"RTN","SROQ2",43,0)
END W ! I 'SRSOUT,$E(IOST)="C" W !!,"Press <RET> to continue  " R X:DTIME
"RTN","SROQ2",44,0)
 D KTMP W:$E(IOST)="P" @IOF I $D(ZTQUEUED) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROQ2",45,0)
 D ^SRSKILL K SR14,SR71,SR72,SRADMT,SRHOSP,SRICNA,SRICNE,SRICNO,SRICY,SRIDP,SRINSTP,SRINV,SRIOSTAT,SRTN,SRTONE,SRTONO,SRTOV,SRVER D ^%ZISC W @IOF
"RTN","SROQ2",46,0)
 Q
"RTN","SROQ2",47,0)
KTMP F I="SRDEATH","SRDPT","SRDREL","SRDTH","SREXP","SRINOUT","SRIOD","SRP","SRPROC","SRREL","SRSP","SRSS","SRTN" K ^TMP(I,$J)
"RTN","SROQ2",48,0)
 Q
"RTN","SROQ2",49,0)
CASE ;  examine case
"RTN","SROQ2",50,0)
 Q:$P($G(^SRF(SRTN,30)),"^")!'$P($G(^SRF(SRTN,.2)),"^",12)!($P($G(^SRF(SRTN,"NON")),"^")="Y")
"RTN","SROQ2",51,0)
 S SRCASES=SRCASES+1 D ^SROQ0
"RTN","SROQ2",52,0)
 Q
"RTN","SROQ2",53,0)
ZERO ; set counters to 0
"RTN","SROQ2",54,0)
 S (SRTOV,SRTONO,SRTONE,SRICY,SRICNO,SRICNA,SRICNE)=0
"RTN","SROQ2",55,0)
 D KTMP S (SR60,SRADMT,SRCASES,SRCOMP,SRDPT,SREMERG,SRIN,SRINPAT,SRIX,SRMAJOR,SRMORT,SROPD,SRSOUT,SRWC)=0 F I=1:1:7 S SRASA(I)=0
"RTN","SROQ2",56,0)
 S SRSS=0 F I=50:1:62,500,501,502 S SRSPEC(I)=I,^TMP("SRSS",$J,I)="0^0^0^0",SREXP(I)=0
"RTN","SROQ2",57,0)
 S ^TMP("SRSS",$J,"ZZ")="0^0^0^0",SREXP("ZZ")=0
"RTN","SROQ2",58,0)
 F I=0:1:4 S (SRATT(I),SRATT("J",I),SRATT("N",I))=0
"RTN","SROQ2",59,0)
 F SRPROC=1:1:12 S ^TMP("SRPROC",$J,SRPROC)="0^0",SRDEATH(SRPROC)=0
"RTN","SROQ2",60,0)
 S (SRINV("I"),SRINV("O"))=0 F I=1:1:32 S SRC(I)=0
"RTN","SROQ2",61,0)
 Q
"RTN","SROQ2",62,0)
DEATH ; tabulate deaths
"RTN","SROQ2",63,0)
 S SRED=SREND+.9999,SRSD=SRSTART-.0001,DFN=0 F  S DFN=$O(^TMP("SREXP",$J,DFN)) Q:'DFN  D SPEC
"RTN","SROQ2",64,0)
 S SRSS=0 F  S SRSS=$O(SREXP(SRSS)) Q:SRSS=""  S ^TMP("SRSS",$J,SRSS)=^TMP("SRSS",$J,SRSS)_"^"_SREXP(SRSS)
"RTN","SROQ2",65,0)
 S DFN=0 F  S DFN=$O(^TMP("SRDEATH",$J,DFN)) Q:'DFN  D IP
"RTN","SROQ2",66,0)
 F J=1:1:12 S ^TMP("SRPROC",$J,J)=^TMP("SRPROC",$J,J)_"^"_SRDEATH(J)
"RTN","SROQ2",67,0)
 S DFN=0 F  S DFN=$O(^TMP("SRIOD",$J,DFN)) Q:'DFN  D INOUT
"RTN","SROQ2",68,0)
 Q
"RTN","SROQ2",69,0)
SPEC ; determine related specialty
"RTN","SROQ2",70,0)
 I $O(^TMP("SRSP",$J,DFN,0))="" S Y=^TMP("SREXP",$J,DFN),SRTN=$P(Y,"^"),SRSS=$P(Y,"^",2),SRDT=$P(^SRF(SRTN,0),"^",9) Q:SRDT>SRED!(SRDT<SRSD)  S SREXP(SRSS)=SREXP(SRSS)+1,SRMORT=SRMORT+1 Q
"RTN","SROQ2",71,0)
 S SRDT=$O(^TMP("SRSP",$J,DFN,0)) I (9999999-SRDT)'>SRED&((9999999-SRDT)'<SRSD) S SRSS=^TMP("SRSP",$J,DFN,SRDT),SREXP(SRSS)=SREXP(SRSS)+1,SRMORT=SRMORT+1
"RTN","SROQ2",72,0)
 Q
"RTN","SROQ2",73,0)
IP ; determine related index procedure (if any)
"RTN","SROQ2",74,0)
 I $O(^TMP("SRP",$J,DFN,0))="" S Y=^TMP("SRDEATH",$J,DFN),SRTN=$P(Y,"^"),SRPROC=$P(Y,"^",2),SRDT=$P(^SRF(SRTN,0),"^",9) Q:SRDT>SRED!(SRDT<SRSD)  S SRDEATH(SRPROC)=SRDEATH(SRPROC)+1 Q
"RTN","SROQ2",75,0)
 S SRDT=$O(^TMP("SRP",$J,DFN,0)) I (9999999-SRDT)'>SRED&((9999999-SRDT)'<SRSD) S SRPROC=^TMP("SRP",$J,DFN,SRDT),SRDEATH(SRPROC)=SRDEATH(SRPROC)+1
"RTN","SROQ2",76,0)
 Q
"RTN","SROQ2",77,0)
INOUT ; decide if death is in or out-pat surgery death
"RTN","SROQ2",78,0)
 S SRIOSTAT="" I $O(^TMP("SRINOUT",$J,DFN,0))="" S Y=^TMP("SRIOD",$J,DFN),SRTN=$P(Y,"^"),SRIOSTAT=$P(Y,"^",2),SRDT=$P(^SRF(SRTN,0),"^",9) Q:SRDT>SRED!(SRDT<SRSD)!(SRIOSTAT'="O")  S SROPD=SROPD+1 Q
"RTN","SROQ2",79,0)
 S SRDT=$O(^TMP("SRINOUT",$J,DFN,0)) S SRIOSTAT=^TMP("SRINOUT",$J,DFN,SRDT) I (9999999-SRDT)'>SRED&((9999999-SRDT)'<SRSD)&(SRIOSTAT="O") S SROPD=SROPD+1
"RTN","SROQ2",80,0)
 Q
"RTN","SROQM")
0^4^B13125257
"RTN","SROQM",1,0)
SROQM ;B'HAM ISC/ADM - QUARTERLY REPORT (CONTINUED) ; [ 07/03/03  9:59 AM ]
"RTN","SROQM",2,0)
 ;;3.0; Surgery ;**62,82,95,123**; Jun 93
"RTN","SROQM",3,0)
 ;
"RTN","SROQM",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROQM",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROQM",6,0)
 ;**         are prohibited.
"RTN","SROQM",7,0)
 ;
"RTN","SROQM",8,0)
 S (SRCNT,SRPAGE)=1 K ^TMP("SRMSG",$J) D HDR Q:SRSOUT  D ^SROQM0,HDR Q:SRSOUT  D ^SROQM1 Q:SRSOUT  F I=1:1:3 D BLANK
"RTN","SROQM",9,0)
 D HDR,ENSURE
"RTN","SROQM",10,0)
 S XMSUB="QUARTERLY REPORT - SURGICAL SERVICE",XMDUZ="SURGERY DATA MANAGER"
"RTN","SROQM",11,0)
 S XMY("G.SR-QUARTERLY@"_SRD)=""
"RTN","SROQM",12,0)
 S XMTEXT="^TMP(""SRMSG"",$J," N I D ^XMD
"RTN","SROQM",13,0)
 K XMDUZ,^TMP("SRMSG",$J)
"RTN","SROQM",14,0)
 Q
"RTN","SROQM",15,0)
HDR ; write page header
"RTN","SROQM",16,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROQM",17,0)
 S SRBLANK="" F I=1:1:22 S SRBLANK=SRBLANK_" "
"RTN","SROQM",18,0)
 S SRLINE=SRBLANK_"QUARTERLY REPORT - SURGICAL SERVICE",SRBLANK="" F I=1:1:(75-$L(SRLINE)) S SRBLANK=SRBLANK_" "
"RTN","SROQM",19,0)
 S SRLINE=SRLINE_SRBLANK_"PAGE" D LINE
"RTN","SROQM",20,0)
 S SRBLANK="" F I=1:1:34 S SRBLANK=SRBLANK_" "
"RTN","SROQM",21,0)
 S SRLINE=SRBLANK_"VERSION 3.0",SRBLANK="" F I=1:1:(77-$L(SRLINE)) S SRBLANK=SRBLANK_" "
"RTN","SROQM",22,0)
 S SRLINE=SRLINE_SRBLANK_SRPAGE D LINE
"RTN","SROQM",23,0)
 D BLANK S SRLINE=" Hospital: "_$E(SRINST,1,44),SRBLANK="" F I=1:1:(57-$L(SRLINE)) S SRBLANK=SRBLANK_" "
"RTN","SROQM",24,0)
 S SRLINE=SRLINE_SRBLANK_"Station Number: "_SRSTATN D LINE
"RTN","SROQM",25,0)
 S SRLINE=" For Dates: "_SRSD_"     to: "_SRED_"            Fiscal Year: "_SRYR D LINE
"RTN","SROQM",26,0)
 S SRLINE="" F I=1:1:79 S SRLINE=SRLINE_"="
"RTN","SROQM",27,0)
 D LINE S SRPAGE=SRPAGE+1
"RTN","SROQM",28,0)
 Q
"RTN","SROQM",29,0)
BLANK ; blank line
"RTN","SROQM",30,0)
 S ^TMP("SRMSG",$J,SRCNT)="",SRCNT=SRCNT+1
"RTN","SROQM",31,0)
 Q
"RTN","SROQM",32,0)
LINE ; store line in ^TMP
"RTN","SROQM",33,0)
 S ^TMP("SRMSG",$J,SRCNT)=SRLINE,SRCNT=SRCNT+1
"RTN","SROQM",34,0)
 Q
"RTN","SROQM",35,0)
ENSURE ; ensure correct surgery cpmpliance
"RTN","SROQM",36,0)
 D BLANK S SRBLANK="" F I=1:1:17 S SRBLANK=SRBLANK_" "
"RTN","SROQM",37,0)
 S SRLINE=SRBLANK_"ENSURING CORRECT SURGERY - COMPLIANCE SUMMARY" D LINE
"RTN","SROQM",38,0)
 S SRLINE=SRBLANK_"---------------------------------------------" D LINE
"RTN","SROQM",39,0)
 D BLANK F I=1:1:25 S SRBLANK=SRBLANK_" "
"RTN","SROQM",40,0)
 S SRLINE=SRBLANK_"CASES    % OF TOTAL" D LINE
"RTN","SROQM",41,0)
 S SRLINE=SRBLANK_"-----    ----------" D LINE
"RTN","SROQM",42,0)
 S SRBLANK="" F I=1:1:18 S SRBLANK=SRBLANK_" "
"RTN","SROQM",43,0)
 S SRLINE=SRBLANK_"TOTAL CASES PERFORMED:"_$J(SRCASES,6)_"       "
"RTN","SROQM",44,0)
 S:SRCASES SRLINE=SRLINE_"100.0" D LINE
"RTN","SROQM",45,0)
 S SRLINE=SRBLANK_" TIME OUT VERIFIED" D LINE
"RTN","SROQM",46,0)
 S SRLINE=SRBLANK_SRBLANK_"YES:"_$J(SRTOV,6)_"       "
"RTN","SROQM",47,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRTOV/SRCASES)*100),5,1) D LINE
"RTN","SROQM",48,0)
 S SRLINE=SRBLANK_SRBLANK_" NO:"_$J(SRTONO,6)_"       "
"RTN","SROQM",49,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRTONO/SRCASES)*100),5,1) D LINE
"RTN","SROQM",50,0)
 S SRLINE=SRBLANK_"          NOT ENTERED:"_$J(SRTONE,6)_"       "
"RTN","SROQM",51,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRTONE/SRCASES)*100),5,1) D LINE
"RTN","SROQM",52,0)
 S SRLINE=SRBLANK_" IMAGING CONFIRMED" D LINE
"RTN","SROQM",53,0)
 S SRLINE=SRBLANK_SRBLANK_"YES:"_$J(SRICY,6)_"       "
"RTN","SROQM",54,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRICY/SRCASES)*100),5,1) D LINE
"RTN","SROQM",55,0)
 S SRLINE=SRBLANK_SRBLANK_" NO:"_$J(SRICNO,6)_"       "
"RTN","SROQM",56,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRICNO/SRCASES)*100),5,1) D LINE
"RTN","SROQM",57,0)
 S SRLINE=SRBLANK_"       NOT APPLICABLE:"_$J(SRICNA,6)_"       "
"RTN","SROQM",58,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRICNA/SRCASES)*100),5,1) D LINE
"RTN","SROQM",59,0)
 S SRLINE=SRBLANK_"          NOT ENTERED:"_$J(SRICNE,6)_"       "
"RTN","SROQM",60,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRICNE/SRCASES)*100),5,1) D LINE D BLANK
"RTN","SROQM",61,0)
 S SRLINE=SRBLANK_"  OVERALL COMPLIANCE FOR THIS DATE RANGE" D LINE
"RTN","SROQM",62,0)
 S SRLINE=SRBLANK_"  --------------------------------------" D LINE
"RTN","SROQM",63,0)
 S SRLINE=SRBLANK_"      TIME OUT VERIFIED:"
"RTN","SROQM",64,0)
 S:SRCASES SRLINE=SRLINE_$J(((SRTOV/SRCASES)*100),5,1)_"%" D LINE
"RTN","SROQM",65,0)
 S SRLINE=SRBLANK_"      IMAGING CONFIRMED:"
"RTN","SROQM",66,0)
 S:SRCASES SRLINE=SRLINE_$J((((SRICY+SRICNA)/SRCASES)*100),5,1)_"%" D LINE
"RTN","SROQM",67,0)
 Q
"RTN","SROQT")
0^5^B23713383
"RTN","SROQT",1,0)
SROQT ;B'HAM ISC/ADM - QTRLY RPT MESSAGE TO SERVER ; [ 07/03/03  12:48 PM ]
"RTN","SROQT",2,0)
 ;;3.0; Surgery ;**38,43,62,67,70,77,50,95,123**;24 Jun 93
"RTN","SROQT",3,0)
 ;
"RTN","SROQT",4,0)
 ;** NOTICE: This routine is part of an implementation of a nationally
"RTN","SROQT",5,0)
 ;**         controlled procedure.  Local modifications to this routine
"RTN","SROQT",6,0)
 ;**         are prohibited.
"RTN","SROQT",7,0)
 ;
"RTN","SROQT",8,0)
 S SRD=^XMB("NETNAME"),ISC=0 I $E(SRD,1,3)="FO-"!(SRD["ISC-")!(SRD["ISC.")!(SRD["FORUM")!(SRD["TST")!(SRD[".FO-") S ISC=1
"RTN","SROQT",9,0)
 K ^TMP("SRQTR",$J) N SRDIV S SRDIV=$P($$SITE^SROVAR,"^",3)_$S(SRIEN:"-"_SRIEN,1:"")
"RTN","SROQT",10,0)
 S SRSMO=$E(SRSTART,4,5),SRQTR=$S(SRSMO=10:1,SRSMO="01":2,SRSMO="04":3,1:4),SRFYR=$S(SRQTR=1:$E(SRSTART,1,3)+1,1:$E(SRSTART,1,3))+1700,SRFQ=SRFYR_SRQTR
"RTN","SROQT",11,0)
 S SRNODE=SRDIV_"^1^"_SRFQ_"^"_DT_"^"_SRCASES_"^"_SRMAJOR_"^"_SRMORT_"^"_SRCOMP_"^"_SRINPAT_"^"_SREMERG_"^"_SR60 F I=1:1:7 S SRNODE=SRNODE_"^"_SRASA(I)
"RTN","SROQT",12,0)
 S SRNODE=SRNODE_"^"_SROPD_"^"_SRINV("O")_"^"_SRINV("I")_"^"_SRADMT
"RTN","SROQT",13,0)
 I SRIEN S SRNODE=SRNODE_"^"_SRINST_"^"_SRSTATN
"RTN","SROQT",14,0)
 S ^TMP("SRQTR",$J,1)=SRNODE
"RTN","SROQT",15,0)
SP S SRNODE=SRDIV_"^2" F SRSS=50:1:55 S SRNODE=SRNODE_"^"_^TMP("SRSS",$J,SRSS)
"RTN","SROQT",16,0)
 S ^TMP("SRQTR",$J,2)=SRNODE
"RTN","SROQT",17,0)
 S SRNODE=SRDIV_"^3" F SRSS=56:1:61 S SRNODE=SRNODE_"^"_^TMP("SRSS",$J,SRSS)
"RTN","SROQT",18,0)
 S ^TMP("SRQTR",$J,3)=SRNODE
"RTN","SROQT",19,0)
 S SRNODE=SRDIV_"^4" F SRSS=62,500,501,502,"ZZ" S SRNODE=SRNODE_"^"_^TMP("SRSS",$J,SRSS)
"RTN","SROQT",20,0)
 S ^TMP("SRQTR",$J,4)=SRNODE
"RTN","SROQT",21,0)
IX S SRNODE=SRDIV_"^5" F J=1:1:6 D PROC
"RTN","SROQT",22,0)
 S SRNODE=SRNODE_"^^^" F J=9:1:12 D PROC
"RTN","SROQT",23,0)
 S ^TMP("SRQTR",$J,5)=SRNODE
"RTN","SROQT",24,0)
COMP S SRNODE=SRDIV_"^6" F I=1:1:32 S SRNODE=SRNODE_"^"_SRC(I)
"RTN","SROQT",25,0)
 S ^TMP("SRQTR",$J,6)=SRNODE
"RTN","SROQT",26,0)
 S SRNODE=SRDIV_"^7^"_SRWC F I=0:1:4 S SRNODE=SRNODE_"^"_SRATT(I)
"RTN","SROQT",27,0)
 S SRNODE=SRNODE_"^"_SRIN F I="J","N" F J=0:1:4 S SRNODE=SRNODE_"^"_SRATT(I,J)
"RTN","SROQT",28,0)
 S ^TMP("SRQTR",$J,7)=SRNODE
"RTN","SROQT",29,0)
HIP S SRNODE=SRDIV_"^8" F J=7,8 D PROC
"RTN","SROQT",30,0)
 S SRNODE=SRNODE_"^"_SRTOV_"^"_SRTONO_"^"_SRTONE_"^"_SRICY_"^"_SRICNO_"^"_SRICNA_"^"_SRICNE
"RTN","SROQT",31,0)
 S ^TMP("SRQTR",$J,8)=SRNODE
"RTN","SROQT",32,0)
MSG ; create mail message to server
"RTN","SROQT",33,0)
 S XMSUB="QUARTERLY REPORT - SURGICAL SERVICE",XMDUZ="SURGERY DATA MANAGER"
"RTN","SROQT",34,0)
 I 'ISC S (XMY("S.SRCOSERV@FO-HINES.MED.VA.GOV"),XMY("G.SRCOSERV@FO-HINES.MED.VA.GOV"))=""
"RTN","SROQT",35,0)
 I ISC S XMY("G.SR-QUARTERLY@"_SRD)=""
"RTN","SROQT",36,0)
 S XMTEXT="^TMP(""SRQTR"",$J," N I D ^XMD K ^TMP("SRQTR",$J),XMY,XMTEXT
"RTN","SROQT",37,0)
 Q:SRIEN
"RTN","SROQT",38,0)
MSG1 S XMY("G.SR-QUARTERLY@"_SRD)="",XMSUB="QUARTERLY REPORT TRANSMISSION"
"RTN","SROQT",39,0)
 S SRMSG(1)="The Quarterly Report for quarter #"_$E(SRFQ,5)_" of fiscal year "_$E(SRFQ,1,4)_" has been"
"RTN","SROQT",40,0)
 S SRMSG(2)="transmitted to the central database of Surgical Service, VHA Headquarters."
"RTN","SROQT",41,0)
 S XMTEXT="SRMSG(" N I D ^XMD K XMY,XMTEXT
"RTN","SROQT",42,0)
 D ^SROQM,SITE
"RTN","SROQT",43,0)
 Q
"RTN","SROQT",44,0)
PROC S X=^TMP("SRPROC",$J,J),SRNODE=SRNODE_"^"_$P(X,"^")_"^"_$P(X,"^",3)_"^"_$P(X,"^",2)
"RTN","SROQT",45,0)
 Q
"RTN","SROQT",46,0)
QUE ; queue creation of report to central database
"RTN","SROQT",47,0)
 W ! K %DT S %DT("A")="Queue report to run at what date/time ? ",%DT(0)="NOW",%DT("B")="NOW",%DT="AEFXT" D ^%DT I Y=-1 S SRSOUT=1 G END^SROQ
"RTN","SROQT",48,0)
 D TSK G END^SROQ
"RTN","SROQT",49,0)
TSK S ZTDTH=Y,ZTIO="",ZTDESC="Surgery Quarterly Report",(ZTSAVE("SRSTART"),ZTSAVE("SREND"),ZTSAVE("SRFLG"),ZTSAVE("SRT"))="",ZTRTN="EN^SROQT" D ^%ZTLOAD
"RTN","SROQT",50,0)
 Q
"RTN","SROQT",51,0)
EN ; entry point when queued to generate mail report only
"RTN","SROQT",52,0)
 K SRINSTP N SRDVSN,SRIEN,SRMULT S SRDVSN="",(SRCOUNT,SRIEN,SRMULT,X)=0 D
"RTN","SROQT",53,0)
 .F  S X=$O(^SRO(133,X)) Q:'X  I '$P($G(^SRO(133,X,0)),"^",21) S SRCOUNT=SRCOUNT+1,SRDVSN(X)=$P(^SRO(133,X,0),"^")
"RTN","SROQT",54,0)
 .I SRCOUNT>1 S SRMULT=1
"RTN","SROQT",55,0)
 D SET^SROQ2,SROQT I SRMULT D
"RTN","SROQT",56,0)
 .S SRIEN=0 F  S SRIEN=$O(SRDVSN(SRIEN)) Q:'SRIEN  D
"RTN","SROQT",57,0)
 ..S SRINSTP=SRDVSN(SRIEN),SRINST=$$GET1^DIQ(4,SRINSTP,.01),SRSTATN=$$GET1^DIQ(4,SRINSTP,99)
"RTN","SROQT",58,0)
 ..D SET^SROQ2,SROQT
"RTN","SROQT",59,0)
 F I="SRDEATH","SRDPT","SRDREL","SRDTH","SREXP","SRINOUT","SRIOD","SRP","SRPROC","SRREL","SRSP","SRSS","SRTN" K ^TMP(I,$J)
"RTN","SROQT",60,0)
 S ZTREQ="@"
"RTN","SROQT",61,0)
 Q
"RTN","SROQT",62,0)
SITE ; update site parameters file
"RTN","SROQT",63,0)
 S X=$E(SRSTART,4,7),Y=$S(X="1001":1,X="0101":2,X="0401":3,1:4),SRLATE=SRYR_Y
"RTN","SROQT",64,0)
 S SRE=0 F  S SRE=$O(^SRO(133,SRE)) Q:'SRE  I $P(^SRO(133,SRE,0),"^",18)<SRLATE S $P(^(0),"^",18)=SRLATE
"RTN","SROQT",65,0)
DALERT ; delete alert
"RTN","SROQT",66,0)
 S XQAID="SRQTR-"_SRLATE,XQAKILL=0 D DELETEA^XQALERT
"RTN","SROQT",67,0)
 Q
"RTN","SROQT",68,0)
NIGHT ; determine if current quarterly report has been transmitted
"RTN","SROQT",69,0)
 D CURRENT S SRYR=SRYR+1700,SRFQ=SRYR_SRQTR,SRE=0 S SRE=$O(^SRO(133,SRE)) I $P(^SRO(133,SRE,0),"^",18)'<SRFQ Q
"RTN","SROQT",70,0)
 S SRALERT=0 I SRDAY>206&(SRDAY<214)!(SRDAY>507&(SRDAY<515))!(SRDAY>806&(SRDAY<814))!(SRDAY>1106&(SRDAY<1114)) S SRALERT=1
"RTN","SROQT",71,0)
 D:SRALERT ALERT^SROQ1A D:'SRALERT AUTO
"RTN","SROQT",72,0)
 Q
"RTN","SROQT",73,0)
CURRENT ; get current reporting quarter
"RTN","SROQT",74,0)
 S SRYR=$E(DT,1,3),SRDAY=$E(DT,4,7),SRQTR=4 I SRDAY>206 S SRQTR=$S(SRDAY<508:1,SRDAY<807:2,SRDAY<1107:3,1:4)
"RTN","SROQT",75,0)
 I SRQTR=4,SRDAY<207 S SRYR=SRYR-1
"RTN","SROQT",76,0)
 Q
"RTN","SROQT",77,0)
DATES ; get start and end dates
"RTN","SROQT",78,0)
 S SRSMO=$S(SRQTR=1:"1001",SRQTR=2:"0101",SRQTR=3:"0401",1:"0701"),SREMO=$S(SRQTR=1:"1231",SRQTR=2:"0331",SRQTR=3:"0630",1:"0930"),SRSTART=$S(SRQTR=1:SRYR-1,1:SRYR)_SRSMO,SREND=$S(SRQTR=1:SRYR-1,1:SRYR)_SREMO
"RTN","SROQT",79,0)
 Q
"RTN","SROQT",80,0)
VAR ; set report variables for non-interactive calls     
"RTN","SROQT",81,0)
 D CURRENT,DATES S SRFLG=1
"RTN","SROQT",82,0)
 Q
"RTN","SROQT",83,0)
AUTO ; automatic transmission of report
"RTN","SROQT",84,0)
 D VAR S (SRT,SRSOUT)=1 D NOW^%DTC S Y=$E(%,1,12) D TSK
"RTN","SROQT",85,0)
 Q
"VER")
8.0^22.0
**END**
**END**
