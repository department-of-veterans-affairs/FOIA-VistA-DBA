Released XU*8*65 SEQ #56
Extracted from mail message
**KIDS**:XU*8.0*65^

**INSTALL NAME**
XU*8.0*65
"BLD",13,0)
XU*8.0*65^KERNEL^0^2970828^y
"BLD",13,1,0)
^^98^98^2971125^
"BLD",13,1,1,0)
HUN-0396-21050  XQAL*   Fix several small problems that cause errors in 
"BLD",13,1,2,0)
HUN-0996-21721          special cases. Changed to use TMP from XUTL.
"BLD",13,1,3,0)
Forum 24021577          If the user has a mix of Info and action alerts,
"BLD",13,1,4,0)
                        during processing of alerts the display will 
"BLD",13,1,5,0)
                        stop before doing an action that could cause
"BLD",13,1,6,0)
                        info to scroll off the top.
"BLD",13,1,7,0)
                      
"BLD",13,1,8,0)
CIRN            ZISHMSM  Fix the way that %ZISH under MSM open's multiple
"BLD",13,1,9,0)
                         host files.
"BLD",13,1,10,0)

"BLD",13,1,11,0)
TUA-0997-30470  ZISH*    Fix to use the DEFAULT DIRECTORY FOR HFS field
"BLD",13,1,12,0)
CHY-1097-52881           in file 8989.3 (KSP). Fix use of recordsize to
"BLD",13,1,13,0)
                         match CIRN.
"BLD",13,1,14,0)
                         
"BLD",13,1,15,0)
LAK-0897-30499           DEVICE file $I field length increased to 40 char.          
"BLD",13,1,16,0)
                         
"BLD",13,1,17,0)
AXP TEAM        ZOSFVXD  Disable priority changing, This has caused performance
"BLD",13,1,18,0)
                ZOSVVXD  problems when lower priority jobs hold locks on
"BLD",13,1,19,0)
                         critical code sections.
"BLD",13,1,20,0)
                         
"BLD",13,1,21,0)
CHY-0597-50132   XUS91   Made a fix to make the code more robust.
"BLD",13,1,22,0)

"BLD",13,1,23,0)
                         Fix description for rescheduling frequency. 
"BLD",13,1,24,0)

"BLD",13,1,25,0)
               XUWORKDY  Fix problem if HOLIDAY file is missing.
"BLD",13,1,26,0)
  
"BLD",13,1,27,0)
                 Checksum
"BLD",13,1,28,0)
Routine         Old       New      2nd Line
"BLD",13,1,29,0)
XQALDEL      13827021  12561210    **6,24,65**
"BLD",13,1,30,0)
XQALDOIT     10428734   9852030    **1,6,65**
"BLD",13,1,31,0)
XQALERT       5798541   5307017    **1,65**
"BLD",13,1,32,0)
XQALERT1     19524336  18178207    **20,65**
"BLD",13,1,33,0)
XQALFWD      10036386  10058961    **6,65**
"BLD",13,1,34,0)
XQALSET      13085815  12680442    **1,6,65**
"BLD",13,1,35,0)
XUINPCH       3256791   3950316    **20,36,43,49,63,65**
"BLD",13,1,36,0)
XUPARAM                 1006391    **65**
"BLD",13,1,37,0)
XUS91                   8526517    **18,65**
"BLD",13,1,38,0)
XUTMG43                  921517    **18,65**
"BLD",13,1,39,0)
XUWORKDY      1331031   1179273    **65**
"BLD",13,1,40,0)
ZISHMSM       5354551   5685657    **24,36,49,65**
"BLD",13,1,41,0)
ZISHONT                 5001907    **34,65**
"BLD",13,1,42,0)
ZISHVXD                 6891389    **24,36,65**
"BLD",13,1,43,0)
ZOSFVXD       7401132   7407077    **65**
"BLD",13,1,44,0)
ZOSVVXD       7519714   7658715    **13,65**
"BLD",13,1,45,0)
ZTPTCH        4509174   4561379    **44,65**
"BLD",13,1,46,0)
                                              
"BLD",13,1,47,0)
========================================================================= 
"BLD",13,1,48,0)
Installation:
"BLD",13,1,49,0)

"BLD",13,1,50,0)
 1.  Some of these routines are usually mapped on systems that allow mapping,
"BLD",13,1,51,0)
     so you will need to disable mapping for the effected routines. 
"BLD",13,1,52,0)
     
"BLD",13,1,53,0)
 2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",13,1,54,0)
     option will load the KIDS package onto your system.
"BLD",13,1,55,0)
     
"BLD",13,1,56,0)
 3.  The patch has now been loaded into a Transport global on your
"BLD",13,1,57,0)
     system. You now need to use KIDS to install the Transport global.
"BLD",13,1,58,0)
     
"BLD",13,1,59,0)
 4.  Inhibit users from login into the system. (If you install when few
"BLD",13,1,60,0)
      user are on the system and the possibility of some CLOBER/EDITED
"BLD",13,1,61,0)
      errors is acceptable then users can stay on the system.)
"BLD",13,1,62,0)

"BLD",13,1,63,0)
     
"BLD",13,1,64,0)
 5.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",13,1,65,0)
     options:
"BLD",13,1,66,0)
     
"BLD",13,1,67,0)
        Verify Checksum's in Transport Global
"BLD",13,1,68,0)
        Print Transport Global
"BLD",13,1,69,0)
        Compare Transport Global to Current System      
"BLD",13,1,70,0)
        Backup a Transport Global
"BLD",13,1,71,0)
        Install Package(s)  'XU*8.0*65'
"BLD",13,1,72,0)
                             =========
"BLD",13,1,73,0)
        
"BLD",13,1,74,0)
 6.  After installing this patch, 
"BLD",13,1,75,0)
      DSM/MSM sites - you need to move several routines from 
"BLD",13,1,76,0)
      your production account to each manager account:
"BLD",13,1,77,0)
      OpenM Sites - you don't need to move anything, skip this step.
"BLD",13,1,78,0)

"BLD",13,1,79,0)
      ZISHMSM
"BLD",13,1,80,0)
      ZISHONT
"BLD",13,1,81,0)
      ZISHVXD
"BLD",13,1,82,0)
      ZOSFVXD
"BLD",13,1,83,0)
      ZOSVVXD
"BLD",13,1,84,0)
    
"BLD",13,1,85,0)
      And in the manager account,  (OpenM sites remain in VAH)
"BLD",13,1,86,0)
      
"BLD",13,1,87,0)
      All sites:
"BLD",13,1,88,0)
      DO RELOAD^ZTMGRSET
"BLD",13,1,89,0)
      Select the System
"BLD",13,1,90,0)
      Patch number to load: 65
"BLD",13,1,91,0)
                            ==
"BLD",13,1,92,0)

"BLD",13,1,93,0)
 7.  DSM Sites, after patch has installed, rebuild your map set.
"BLD",13,1,94,0)

"BLD",13,1,95,0)
 8.   Enable user's login.
"BLD",13,1,96,0)

"BLD",13,1,97,0)
 =========================================================================
"BLD",13,1,98,0)

"BLD",13,4,0)
^9.64PA^19.2^2
"BLD",13,4,3.5,0)
3.5
"BLD",13,4,3.5,2,0)
^9.641^3.5^1
"BLD",13,4,3.5,2,3.5,0)
DEVICE  (File-top level)
"BLD",13,4,3.5,2,3.5,1,0)
^9.6411^1^1
"BLD",13,4,3.5,2,3.5,1,1,0)
$I
"BLD",13,4,3.5,222)
y^y^p^^^^n
"BLD",13,4,19.2,0)
19.2
"BLD",13,4,19.2,2,0)
^9.641^19.2^1
"BLD",13,4,19.2,2,19.2,0)
OPTION SCHEDULING  (File-top level)
"BLD",13,4,19.2,2,19.2,1,0)
^9.6411^6^1
"BLD",13,4,19.2,2,19.2,1,6,0)
RESCHEDULING FREQUENCY
"BLD",13,4,19.2,222)
y^y^p^^^^n
"BLD",13,4,"APDD",3.5,3.5)

"BLD",13,4,"APDD",3.5,3.5,1)

"BLD",13,4,"APDD",19.2,19.2)

"BLD",13,4,"APDD",19.2,19.2,6)

"BLD",13,4,"B",3.5,3.5)

"BLD",13,4,"B",19.2,19.2)

"BLD",13,"INIT")
POST65^XUINPCH
"BLD",13,"KRN",0)
^9.67PA^19^13
"BLD",13,"KRN",.4,0)
.4
"BLD",13,"KRN",.401,0)
.401
"BLD",13,"KRN",.402,0)
.402
"BLD",13,"KRN",.403,0)
.403
"BLD",13,"KRN",.5,0)
.5
"BLD",13,"KRN",.84,0)
.84
"BLD",13,"KRN",3.6,0)
3.6
"BLD",13,"KRN",3.8,0)
3.8
"BLD",13,"KRN",9.2,0)
9.2
"BLD",13,"KRN",9.8,0)
9.8
"BLD",13,"KRN",9.8,"NM",0)
^9.68A^23^16
"BLD",13,"KRN",9.8,"NM",2,0)
XQALDEL^^0^B26204186
"BLD",13,"KRN",9.8,"NM",6,0)
XQALSET^^0^B22231736
"BLD",13,"KRN",9.8,"NM",7,0)
XQALERT1^^0^B31504358
"BLD",13,"KRN",9.8,"NM",8,0)
XQALERT^^0^B9940054
"BLD",13,"KRN",9.8,"NM",9,0)
XQALDOIT^^0^B15647712
"BLD",13,"KRN",9.8,"NM",10,0)
XQALFWD^^0^B16824103
"BLD",13,"KRN",9.8,"NM",11,0)
ZISHMSM^^0^B30406588
"BLD",13,"KRN",9.8,"NM",13,0)
ZTPTCH^^0^B7219777
"BLD",13,"KRN",9.8,"NM",15,0)
ZOSFVXD^^0^B17537927
"BLD",13,"KRN",9.8,"NM",16,0)
ZOSVVXD^^0^B16644601
"BLD",13,"KRN",9.8,"NM",18,0)
XUPARAM^^0^B1956835
"BLD",13,"KRN",9.8,"NM",19,0)
XUTMG43^^0^B1658564
"BLD",13,"KRN",9.8,"NM",20,0)
XUWORKDY^^0^B1646710
"BLD",13,"KRN",9.8,"NM",21,0)
XUS91^^0^B12562792
"BLD",13,"KRN",9.8,"NM",22,0)
ZISHONT^^0^B27324349
"BLD",13,"KRN",9.8,"NM",23,0)
ZISHVXD^^0^B39451042
"BLD",13,"KRN",9.8,"NM","B","XQALDEL",2)

"BLD",13,"KRN",9.8,"NM","B","XQALDOIT",9)

"BLD",13,"KRN",9.8,"NM","B","XQALERT",8)

"BLD",13,"KRN",9.8,"NM","B","XQALERT1",7)

"BLD",13,"KRN",9.8,"NM","B","XQALFWD",10)

"BLD",13,"KRN",9.8,"NM","B","XQALSET",6)

"BLD",13,"KRN",9.8,"NM","B","XUPARAM",18)

"BLD",13,"KRN",9.8,"NM","B","XUS91",21)

"BLD",13,"KRN",9.8,"NM","B","XUTMG43",19)

"BLD",13,"KRN",9.8,"NM","B","XUWORKDY",20)

"BLD",13,"KRN",9.8,"NM","B","ZISHMSM",11)

"BLD",13,"KRN",9.8,"NM","B","ZISHONT",22)

"BLD",13,"KRN",9.8,"NM","B","ZISHVXD",23)

"BLD",13,"KRN",9.8,"NM","B","ZOSFVXD",15)

"BLD",13,"KRN",9.8,"NM","B","ZOSVVXD",16)

"BLD",13,"KRN",9.8,"NM","B","ZTPTCH",13)

"BLD",13,"KRN",19,0)
19
"BLD",13,"KRN",19.1,0)
19.1
"BLD",13,"KRN",101,0)
101
"BLD",13,"KRN","B",.4,.4)

"BLD",13,"KRN","B",.401,.401)

"BLD",13,"KRN","B",.402,.402)

"BLD",13,"KRN","B",.403,.403)

"BLD",13,"KRN","B",.5,.5)

"BLD",13,"KRN","B",.84,.84)

"BLD",13,"KRN","B",3.6,3.6)

"BLD",13,"KRN","B",3.8,3.8)

"BLD",13,"KRN","B",9.2,9.2)

"BLD",13,"KRN","B",9.8,9.8)

"BLD",13,"KRN","B",19,19)

"BLD",13,"KRN","B",19.1,19.1)

"BLD",13,"KRN","B",101,101)

"BLD",13,"QUES",0)
^9.62^^
"BLD",13,"REQB",0)
^9.611^^0
"FIA",3.5)
DEVICE
"FIA",3.5,0)
^%ZIS(1,
"FIA",3.5,0,0)
3.5Is
"FIA",3.5,0,1)
y^y^p^^^^n
"FIA",3.5,0,10)

"FIA",3.5,0,11)

"FIA",3.5,0,"RLRO")

"FIA",3.5,0,"VR")
8.0^XU
"FIA",3.5,3.5)
1
"FIA",3.5,3.5,1)

"FIA",19.2)
OPTION SCHEDULING
"FIA",19.2,0)
^DIC(19.2,
"FIA",19.2,0,0)
19.2PI
"FIA",19.2,0,1)
y^y^p^^^^n
"FIA",19.2,0,10)

"FIA",19.2,0,11)

"FIA",19.2,0,"RLRO")

"FIA",19.2,0,"VR")
8.0^XU
"FIA",19.2,19.2)
1
"FIA",19.2,19.2,6)

"INIT")
POST65^XUINPCH
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
65^2970828^2
"PKG",3,22,1,"PAH",1,1,0)
^^98^98^2971125
"PKG",3,22,1,"PAH",1,1,1,0)
HUN-0396-21050  XQAL*   Fix several small problems that cause errors in 
"PKG",3,22,1,"PAH",1,1,2,0)
HUN-0996-21721          special cases. Changed to use TMP from XUTL.
"PKG",3,22,1,"PAH",1,1,3,0)
Forum 24021577          If the user has a mix of Info and action alerts,
"PKG",3,22,1,"PAH",1,1,4,0)
                        during processing of alerts the display will 
"PKG",3,22,1,"PAH",1,1,5,0)
                        stop before doing an action that could cause
"PKG",3,22,1,"PAH",1,1,6,0)
                        info to scroll off the top.
"PKG",3,22,1,"PAH",1,1,7,0)
                      
"PKG",3,22,1,"PAH",1,1,8,0)
CIRN            ZISHMSM  Fix the way that %ZISH under MSM open's multiple
"PKG",3,22,1,"PAH",1,1,9,0)
                         host files.
"PKG",3,22,1,"PAH",1,1,10,0)

"PKG",3,22,1,"PAH",1,1,11,0)
TUA-0997-30470  ZISH*    Fix to use the DEFAULT DIRECTORY FOR HFS field
"PKG",3,22,1,"PAH",1,1,12,0)
CHY-1097-52881           in file 8989.3 (KSP). Fix use of recordsize to
"PKG",3,22,1,"PAH",1,1,13,0)
                         match CIRN.
"PKG",3,22,1,"PAH",1,1,14,0)
                         
"PKG",3,22,1,"PAH",1,1,15,0)
LAK-0897-30499           DEVICE file $I field length increased to 40 char.          
"PKG",3,22,1,"PAH",1,1,16,0)
                         
"PKG",3,22,1,"PAH",1,1,17,0)
AXP TEAM        ZOSFVXD  Disable priority changing, This has caused performance
"PKG",3,22,1,"PAH",1,1,18,0)
                ZOSVVXD  problems when lower priority jobs hold locks on
"PKG",3,22,1,"PAH",1,1,19,0)
                         critical code sections.
"PKG",3,22,1,"PAH",1,1,20,0)
                         
"PKG",3,22,1,"PAH",1,1,21,0)
CHY-0597-50132   XUS91   Made a fix to make the code more robust.
"PKG",3,22,1,"PAH",1,1,22,0)

"PKG",3,22,1,"PAH",1,1,23,0)
                         Fix description for rescheduling frequency. 
"PKG",3,22,1,"PAH",1,1,24,0)

"PKG",3,22,1,"PAH",1,1,25,0)
               XUWORKDY  Fix problem if HOLIDAY file is missing.
"PKG",3,22,1,"PAH",1,1,26,0)
  
"PKG",3,22,1,"PAH",1,1,27,0)
                 Checksum
"PKG",3,22,1,"PAH",1,1,28,0)
Routine         Old       New      2nd Line
"PKG",3,22,1,"PAH",1,1,29,0)
XQALDEL      13827021  12561210    **6,24,65**
"PKG",3,22,1,"PAH",1,1,30,0)
XQALDOIT     10428734   9852030    **1,6,65**
"PKG",3,22,1,"PAH",1,1,31,0)
XQALERT       5798541   5307017    **1,65**
"PKG",3,22,1,"PAH",1,1,32,0)
XQALERT1     19524336  18178207    **20,65**
"PKG",3,22,1,"PAH",1,1,33,0)
XQALFWD      10036386  10058961    **6,65**
"PKG",3,22,1,"PAH",1,1,34,0)
XQALSET      13085815  12680442    **1,6,65**
"PKG",3,22,1,"PAH",1,1,35,0)
XUINPCH       3256791   3950316    **20,36,43,49,63,65**
"PKG",3,22,1,"PAH",1,1,36,0)
XUPARAM                 1006391    **65**
"PKG",3,22,1,"PAH",1,1,37,0)
XUS91                   8526517    **18,65**
"PKG",3,22,1,"PAH",1,1,38,0)
XUTMG43                  921517    **18,65**
"PKG",3,22,1,"PAH",1,1,39,0)
XUWORKDY      1331031   1179273    **65**
"PKG",3,22,1,"PAH",1,1,40,0)
ZISHMSM       5354551   5685657    **24,36,49,65**
"PKG",3,22,1,"PAH",1,1,41,0)
ZISHONT                 5001907    **34,65**
"PKG",3,22,1,"PAH",1,1,42,0)
ZISHVXD                 6891389    **24,36,65**
"PKG",3,22,1,"PAH",1,1,43,0)
ZOSFVXD       7401132   7407077    **65**
"PKG",3,22,1,"PAH",1,1,44,0)
ZOSVVXD       7519714   7658715    **13,65**
"PKG",3,22,1,"PAH",1,1,45,0)
ZTPTCH        4509174   4561379    **44,65**
"PKG",3,22,1,"PAH",1,1,46,0)
                                              
"PKG",3,22,1,"PAH",1,1,47,0)
========================================================================= 
"PKG",3,22,1,"PAH",1,1,48,0)
Installation:
"PKG",3,22,1,"PAH",1,1,49,0)

"PKG",3,22,1,"PAH",1,1,50,0)
 1.  Some of these routines are usually mapped on systems that allow mapping,
"PKG",3,22,1,"PAH",1,1,51,0)
     so you will need to disable mapping for the effected routines. 
"PKG",3,22,1,"PAH",1,1,52,0)
     
"PKG",3,22,1,"PAH",1,1,53,0)
 2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",3,22,1,"PAH",1,1,54,0)
     option will load the KIDS package onto your system.
"PKG",3,22,1,"PAH",1,1,55,0)
     
"PKG",3,22,1,"PAH",1,1,56,0)
 3.  The patch has now been loaded into a Transport global on your
"PKG",3,22,1,"PAH",1,1,57,0)
     system. You now need to use KIDS to install the Transport global.
"PKG",3,22,1,"PAH",1,1,58,0)
     
"PKG",3,22,1,"PAH",1,1,59,0)
 4.  Inhibit users from login into the system. (If you install when few
"PKG",3,22,1,"PAH",1,1,60,0)
      user are on the system and the possibility of some CLOBER/EDITED
"PKG",3,22,1,"PAH",1,1,61,0)
      errors is acceptable then users can stay on the system.)
"PKG",3,22,1,"PAH",1,1,62,0)

"PKG",3,22,1,"PAH",1,1,63,0)
     
"PKG",3,22,1,"PAH",1,1,64,0)
 5.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",3,22,1,"PAH",1,1,65,0)
     options:
"PKG",3,22,1,"PAH",1,1,66,0)
     
"PKG",3,22,1,"PAH",1,1,67,0)
        Verify Checksum's in Transport Global
"PKG",3,22,1,"PAH",1,1,68,0)
        Print Transport Global
"PKG",3,22,1,"PAH",1,1,69,0)
        Compare Transport Global to Current System      
"PKG",3,22,1,"PAH",1,1,70,0)
        Backup a Transport Global
"PKG",3,22,1,"PAH",1,1,71,0)
        Install Package(s)  'XU*8.0*65'
"PKG",3,22,1,"PAH",1,1,72,0)
                             =========
"PKG",3,22,1,"PAH",1,1,73,0)
        
"PKG",3,22,1,"PAH",1,1,74,0)
 6.  After installing this patch, 
"PKG",3,22,1,"PAH",1,1,75,0)
      DSM/MSM sites - you need to move several routines from 
"PKG",3,22,1,"PAH",1,1,76,0)
      your production account to each manager account:
"PKG",3,22,1,"PAH",1,1,77,0)
      OpenM Sites - you don't need to move anything, skip this step.
"PKG",3,22,1,"PAH",1,1,78,0)

"PKG",3,22,1,"PAH",1,1,79,0)
      ZISHMSM
"PKG",3,22,1,"PAH",1,1,80,0)
      ZISHONT
"PKG",3,22,1,"PAH",1,1,81,0)
      ZISHVXD
"PKG",3,22,1,"PAH",1,1,82,0)
      ZOSFVXD
"PKG",3,22,1,"PAH",1,1,83,0)
      ZOSVVXD
"PKG",3,22,1,"PAH",1,1,84,0)
    
"PKG",3,22,1,"PAH",1,1,85,0)
      And in the manager account,  (OpenM sites remain in VAH)
"PKG",3,22,1,"PAH",1,1,86,0)
      
"PKG",3,22,1,"PAH",1,1,87,0)
      All sites:
"PKG",3,22,1,"PAH",1,1,88,0)
      DO RELOAD^ZTMGRSET
"PKG",3,22,1,"PAH",1,1,89,0)
      Select the System
"PKG",3,22,1,"PAH",1,1,90,0)
      Patch number to load: 65
"PKG",3,22,1,"PAH",1,1,91,0)
                            ==
"PKG",3,22,1,"PAH",1,1,92,0)

"PKG",3,22,1,"PAH",1,1,93,0)
 7.  DSM Sites, after patch has installed, rebuild your map set.
"PKG",3,22,1,"PAH",1,1,94,0)

"PKG",3,22,1,"PAH",1,1,95,0)
 8.   Enable user's login.
"PKG",3,22,1,"PAH",1,1,96,0)

"PKG",3,22,1,"PAH",1,1,97,0)
 =========================================================================
"PKG",3,22,1,"PAH",1,1,98,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","XQALDEL")
0^2^B26204186
"RTN","XQALDEL",1,0)
XQALDEL ;ISC-SF.SEA/JLI - DELETE ALERTS ;09/11/97  13:40
"RTN","XQALDEL",2,0)
 ;;8.0;KERNEL;**6,24,65**;Jul 10, 1995
"RTN","XQALDEL",3,0)
 ;;
"RTN","XQALDEL",4,0)
 Q
"RTN","XQALDEL",5,0)
 ;
"RTN","XQALDEL",6,0)
DELETE ;
"RTN","XQALDEL",7,0)
 Q:'$D(XQAID)  Q:XQAID=""  S:'$D(XQAKILL) XQAKILL=0 S:$P(XQAID,";")="NO-ID" XQAKILL=1
"RTN","XQALDEL",8,0)
 S XQADAT=$$NOW^XLFDT()
"RTN","XQALDEL",9,0)
 I '$D(XQAUSER) N XQAUSER S XQAUSER=DUZ
"RTN","XQALDEL",10,0)
 I $D(XQAKILL) S XQXX=$O(^XTV(8992.1,"B",XQAID,0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",XQAUSER,0)) I XQXY>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,4)=XQADAT
"RTN","XQALDEL",11,0)
 K XQXX,XQXY
"RTN","XQALDEL",12,0)
 I '$D(^XTV(8992,"AXQA",XQAID,XQAUSER)) D KILLOC
"RTN","XQALDEL",13,0)
 F XQX=$S('XQAKILL:0,1:XQAUSER-.01):0 S XQX=$O(^XTV(8992,"AXQA",XQAID,XQX)) Q:XQX'>0  D  Q:XQAKILL
"RTN","XQALDEL",14,0)
 . F XQK=0:0 S XQK=$O(^XTV(8992,"AXQA",XQAID,XQX,XQK)) Q:XQK'>0  K ^(XQK),^XTV(8992,"AXQAN",$P(XQAID,";"),XQX,XQK) S XQAID1=XQAID D:$D(^XTV(8992,XQX,"XQA",XQK,0)) DELA S XQAID=XQAID1
"RTN","XQALDEL",15,0)
 K XQAID,XQX,XQJ,XQK,XQAID1,XQAKILL
"RTN","XQALDEL",16,0)
 Q
"RTN","XQALDEL",17,0)
 ;
"RTN","XQALDEL",18,0)
DELETEA ;
"RTN","XQALDEL",19,0)
 Q:'$D(XQAID)  Q:XQAID=""  S XQA1=$P(XQAID,";")
"RTN","XQALDEL",20,0)
 S XQADAT=$$NOW^XLFDT()
"RTN","XQALDEL",21,0)
 I '$D(XQAUSER) N XQAUSER S XQAUSER=DUZ
"RTN","XQALDEL",22,0)
 I '$D(^XTV(8992,"AXQAN",XQA1,XQAUSER)) D KILLOC
"RTN","XQALDEL",23,0)
 I $D(XQAKILL) S XQXX=$O(^XTV(8992.1,"B",XQAID,0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",XQAUSER,0)) I XQXY>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,4)=XQADAT
"RTN","XQALDEL",24,0)
 S:'$D(XQAKILL) XQAKILL=0 G:$P(XQAID,";")="NO-ID" DELETE S XQX=$S('XQAKILL:0,1:XQAUSER-.01)
"RTN","XQALDEL",25,0)
 I $P(XQAID,",",2)'=""!($P(XQAID,";",2)="") F XQX=XQX:0 S XQX=$O(^XTV(8992,"AXQAN",XQA1,XQX)) Q:XQX'>0  D  Q:XQAKILL
"RTN","XQALDEL",26,0)
 . F XQK=0:0 S XQK=$O(^XTV(8992,"AXQAN",XQA1,XQX,XQK)) Q:XQK'>0  K ^(XQK) I $D(^XTV(8992,XQX,"XQA",XQK,0)) D DELA
"RTN","XQALDEL",27,0)
 I $P(XQAID,",",2)=""&($P(XQAID,";",2)'="") F XQX=XQX:0 S XQX=$O(^XTV(8992,"AXQA",XQAID,XQX)) Q:XQX'>0  D  Q:XQAKILL
"RTN","XQALDEL",28,0)
 . S XQK=$O(^XTV(8992,"AXQA",XQAID,XQX,0)) Q:XQK'>0  K ^(XQK),^XTV(8992,"AXQAN",XQA1,XQX,XQK) I $D(^XTV(8992,XQX,"XQA",XQK,0)) D DELA
"RTN","XQALDEL",29,0)
 K XQAID,XQA1,XQX,XQK,XQAKILL
"RTN","XQALDEL",30,0)
 Q
"RTN","XQALDEL",31,0)
DELA ;
"RTN","XQALDEL",32,0)
 N XQ11,XQK1 S XQAID=$P(^XTV(8992,XQX,"XQA",XQK,0),U,2),XQ11=$P(^(0),U) K ^XTV(8992,XQX,"XQA",XQK),^XTV(8992,"AXQA",XQAID,XQX,XQK)
"RTN","XQALDEL",33,0)
 D COUNT(-1,XQX)
"RTN","XQALDEL",34,0)
 K ^XTV(8992,"AXQAN",$P(XQAID,";"),XQX,XQK),^XTV(8992,XQX,"XQA","B",XQ11,XQK)
"RTN","XQALDEL",35,0)
 S XQXX=$O(^XTV(8992.1,"B",XQAID,0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",XQX,0)) I XQXY>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,5)=XQADAT
"RTN","XQALDEL",36,0)
 K XQXX,XQXY
"RTN","XQALDEL",37,0)
 Q
"RTN","XQALDEL",38,0)
 ;
"RTN","XQALDEL",39,0)
COUNT(%1,%2) ;Change the count on the zero node, (amount, user)
"RTN","XQALDEL",40,0)
 Q:$G(%2)'>0
"RTN","XQALDEL",41,0)
 L +^XTV(8992,%2):10
"RTN","XQALDEL",42,0)
 I %1 S %=$P($G(^XTV(8992,%2,"XQA",0)),U,4)+%1 S:%'<0 $P(^(0),U,4)=%
"RTN","XQALDEL",43,0)
 I '%1 D
"RTN","XQALDEL",44,0)
 . N % S %1=0,%=0 F  S %=$O(^XTV(8992,%2,"XQA",%)) Q:%'>0  S %1=%1+1
"RTN","XQALDEL",45,0)
 . S $P(^XTV(8992,%2,"XQA",0),U,4)=%1
"RTN","XQALDEL",46,0)
 L -^XTV(8992,%2)
"RTN","XQALDEL",47,0)
 Q
"RTN","XQALDEL",48,0)
KILLOC ;
"RTN","XQALDEL",49,0)
 S XQX=XQAUSER F XQK=0:0 S XQK=$O(^XTV(8992,XQAUSER,"XQA",XQK)) Q:XQK'>0  I $P(^(XQK,0),U,2)=XQAID D
"RTN","XQALDEL",50,0)
 . N XQAID D DELA
"RTN","XQALDEL",51,0)
 Q
"RTN","XQALDEL",52,0)
 ;
"RTN","XQALDEL",53,0)
OLDDEL ;
"RTN","XQALDEL",54,0)
 ;
"RTN","XQALDEL",55,0)
 S XQADAT=$$NOW^XLFDT()
"RTN","XQALDEL",56,0)
 S X2=-15 I $G(ZTQPARAM)>0 S X2=-ZTQPARAM
"RTN","XQALDEL",57,0)
 S XQDAT=$$FMADD^XLFDT(DT,X2)
"RTN","XQALDEL",58,0)
 ;Loop thru users (XQ1) levels
"RTN","XQALDEL",59,0)
 F XQ1=0:0 S XQ1=$O(^XTV(8992,XQ1)) Q:XQ1'>0  D OLDDEL1
"RTN","XQALDEL",60,0)
 D KILLARCH
"RTN","XQALDEL",61,0)
 K X1,X2,X,XQ1,XQ2,XQDAT,XQA,XQADAT
"RTN","XQALDEL",62,0)
 Q
"RTN","XQALDEL",63,0)
OLDDEL1 ;Loop thru the Alert (XQ2) level
"RTN","XQALDEL",64,0)
 L +^XTV(8992,XQ1):10
"RTN","XQALDEL",65,0)
 F XQ2=0:0 S XQ2=$O(^XTV(8992,XQ1,"XQA",XQ2)) Q:XQ2'>0  S X=^(XQ2,0) D
"RTN","XQALDEL",66,0)
 . I $P(X,U,13)>0 I $$FMADD^XLFDT($P($P(X,U,2),";",3),+$P(X,U,13))\1=DT D
"RTN","XQALDEL",67,0)
 . . N XQA,I,XQAUSER S XQAUSER=XQ1 F I=0:0 S I=$O(^XMB(3.7,XQAUSER,9,I)) Q:I'>0  S XQA(I)=+^(I,0)
"RTN","XQALDEL",68,0)
 . . Q:'$D(XQA)  D FORWARD^XQALFWD($P(X,U,2),.XQA,"A","ALERT NOT PROCESSED BY "_$P(^VA(200,XQAUSER,0),U))
"RTN","XQALDEL",69,0)
 . I $P(X,U,14)>0 I $$FMADD^XLFDT($P($P(X,U,2),";",3),+$P(X,U,14))\1=DT D
"RTN","XQALDEL",70,0)
 . . N XQA,I,XQAUSER S XQAUSER=XQ1 S I=$P($G(^VA(200,XQAUSER,5)),U) I I>0 S I=$P($G(^DIC(49,+I,0)),U,3) I I>0,$D(^VA(200,+I,0)) S XQA=+I
"RTN","XQALDEL",71,0)
 . . I $D(XQA) D FORWARD^XQALFWD($P(X,U,2),XQA,"A","ALERT NOT PROCESSED BY "_$P(^VA(200,XQAUSER,0),U))
"RTN","XQALDEL",72,0)
 . I XQ2'>XQDAT  D OLDDEL2
"RTN","XQALDEL",73,0)
 K:$O(^XTV(8992,XQ1,"XQA",0))="" ^XTV(8992,XQ1,"XQA")
"RTN","XQALDEL",74,0)
 L -^XTV(8992,XQ1)
"RTN","XQALDEL",75,0)
 Q
"RTN","XQALDEL",76,0)
OLDDEL2 ;
"RTN","XQALDEL",77,0)
 S XQA=$P(^XTV(8992,XQ1,"XQA",XQ2,0),U,2) K ^XTV(8992,XQ1,"XQA",XQ2) K:XQA'="" ^XTV(8992,"AXQA",XQA,XQ1),^XTV(8992,"AXQAN",$P(XQA,";"),XQ1)
"RTN","XQALDEL",78,0)
 D COUNT(-1,XQ1)
"RTN","XQALDEL",79,0)
 I XQA'="" S XQXX=$O(^XTV(8992.1,"B",XQA,0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",XQ1,0)) I XQXY>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,6)=XQADAT
"RTN","XQALDEL",80,0)
 Q
"RTN","XQALDEL",81,0)
 ;
"RTN","XQALDEL",82,0)
KILLARCH ;
"RTN","XQALDEL",83,0)
 N DA,DIK
"RTN","XQALDEL",84,0)
 S XQDAT=$$FMADD^XLFDT(DT,-30)
"RTN","XQALDEL",85,0)
 F XQ1=0:0 S XQ1=$O(^XTV(8992.1,XQ1)) Q:XQ1'>0  D
"RTN","XQALDEL",86,0)
 . S X1=$P(^XTV(8992.1,XQ1,0),U,2),X2=$P(^(0),U,8)
"RTN","XQALDEL",87,0)
 . S DA=XQ1 I X2="",X1>XQDAT Q
"RTN","XQALDEL",88,0)
 . I X2>0,DT<X2 Q
"RTN","XQALDEL",89,0)
 . S DIK="^XTV(8992.1," D ^DIK
"RTN","XQALDEL",90,0)
 Q
"RTN","XQALDEL",91,0)
 ;
"RTN","XQALDEL",92,0)
USERDEL ; Delete undesired alerts for a user
"RTN","XQALDEL",93,0)
 N DA,DIC
"RTN","XQALDEL",94,0)
 S DIC("A")="Select NEW PERSON entry for deletion of alerts: "
"RTN","XQALDEL",95,0)
 S DIC(0)="AEQM",DIC=200
"RTN","XQALDEL",96,0)
 D ^DIC K DIC Q:Y'>0  S XQAUSER=+Y
"RTN","XQALDEL",97,0)
 S XQALDELE=1
"RTN","XQALDEL",98,0)
 K XQX1
"RTN","XQALDEL",99,0)
 D DOIT^XQALERT1
"RTN","XQALDEL",100,0)
 K XQALDELE
"RTN","XQALDEL",101,0)
 I $D(XQX1),XQX1>0 D
"RTN","XQALDEL",102,0)
 . F  Q:XQX1=""  S DA=+XQX1,XQX1=$P(XQX1,",",2,99) D  I XQX1="" S Y=$O(XQX1(0)) I Y>0 S XQX1=XQX1(Y) K XQX1(Y)
"RTN","XQALDEL",103,0)
 . . S XQAID=$P(^TMP("XQ",$J,"XQA1",DA),U,2),XQAKILL=1
"RTN","XQALDEL",104,0)
 . . I XQAID="" K ^XTV(8992,XQAUSER,"XQA",+^TMP("XQ",$J,"XQA1",DA,1))
"RTN","XQALDEL",105,0)
 . . I XQAID'="" D DELETE
"RTN","XQALDEL",106,0)
 . . K ^TMP("XQ",$J,"XQA1",DA),^TMP("XQ",$J,"XQA",(999999-DA))
"RTN","XQALDEL",107,0)
 K XQAUSER,XQX1
"RTN","XQALDEL",108,0)
 Q
"RTN","XQALDOIT")
0^9^B15647712
"RTN","XQALDOIT",1,0)
XQALDOIT ;ISC-SF.SEA/JLI - ALERT HANDLER ;09/08/97  16:55
"RTN","XQALDOIT",2,0)
 ;;8.0;KERNEL;**1,6,65**;Jul 10, 1995
"RTN","XQALDOIT",3,0)
 ;
"RTN","XQALDOIT",4,0)
EN ;
"RTN","XQALDOIT",5,0)
 S XQAEXIT="DOIT^XQALERT1"
"RTN","XQALDOIT",6,0)
 S XQX=^TMP("XQ",$J,"XQA1",+XQX1),XQI=^(+XQX1,1),XQZ=^(2)
"RTN","XQALDOIT",7,0)
EN1 ;
"RTN","XQALDOIT",8,0)
 S XQADATA=$S(XQZ'="":XQZ,1:$P(XQX,U,9,99)),XQAID=$P(XQX,U,2),XQA1=$P(XQAID,";"),XQX2=+XQX1,XQX1=$P(XQX1,",",2,200) I XQX1'>0 S XQK=$O(XQX1(0)) I XQK>0 S XQX1=XQX1(XQK) K XQX1(XQK)
"RTN","XQALDOIT",9,0)
 S XQAROU=""
"RTN","XQALDOIT",10,0)
 S XQAKILL=1 I XQX2,$P(XQX,U,8)'="" S XQAROU=$P(XQX,U,7,8) K:XQA1="" ^XTV(8992,DUZ,"XQA",XQI)
"RTN","XQALDOIT",11,0)
 I XQAID'="" D
"RTN","XQALDOIT",12,0)
 . S XQXX=$O(^XTV(8992.1,"B",XQAID,0)),XQXY=0,XQADAT=$$NOW^XLFDT()
"RTN","XQALDOIT",13,0)
 . I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",DUZ,0)) I XQXY>0,$P(^XTV(8992.1,XQXX,20,XQXY,0),U,3)="" S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,3)=XQADAT
"RTN","XQALDOIT",14,0)
 . I $P(XQAID,";")="NO-ID" D
"RTN","XQALDOIT",15,0)
 . . I XQXY>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,4)=XQADAT,$P(^(0),U,5)=XQADAT
"RTN","XQALDOIT",16,0)
 . . K ^XTV(8992,XQAUSER,"XQA",XQI),^XTV(8992,"AXQA",XQAID,XQAUSER,XQI),^XTV(8992,"AXQAN",$P(XQAID,";"),XQAUSER,XQI),^XTV(8992,XQAUSER,"XQA","B",$P(XQX,U),XQI),XQAID,XQAKILL
"RTN","XQALDOIT",17,0)
 . K XQXX,XQXY
"RTN","XQALDOIT",18,0)
 I XQAROU'="",XQAROU'="^ " D @XQAROU G @XQAEXIT
"RTN","XQALDOIT",19,0)
 I XQAROU'="" W !!,"Processed Alert Number ",XQX2,!?4,$P(XQX,U,3),! G @XQAEXIT
"RTN","XQALDOIT",20,0)
 I XQX2 S XQMM("J")=$P(XQX,U,7)_";"_$P(^DIC(19,XQY,0),U),XQRB=0 K:XQA1="" ^XTV(8992,DUZ,"XQA",XQI)
"RTN","XQALDOIT",21,0)
 K XQI,XQX,XQJ,XQK,XQXOUT,XQ1,XQII,XQA1,XQAREV,XQACNT,XQAROU,XQX2,%ZIS
"RTN","XQALDOIT",22,0)
 ;Need to reset count in zero node
"RTN","XQALDOIT",23,0)
 Q
"RTN","XQALDOIT",24,0)
 ;
"RTN","XQALDOIT",25,0)
ACTION(ALERTID) ;
"RTN","XQALDOIT",26,0)
 N XQAUSER
"RTN","XQALDOIT",27,0)
 S XQI=$O(^XTV(8992,"AXQA",ALERTID,DUZ,0))
"RTN","XQALDOIT",28,0)
 Q:XQI'>0
"RTN","XQALDOIT",29,0)
 S XQX=$G(^XTV(8992,DUZ,"XQA",XQI,0)) Q:XQX=""  S XQAUSER=DUZ
"RTN","XQALDOIT",30,0)
 S XQZ=$G(^XTV(8992,DUZ,"XQA",XQI,1))
"RTN","XQALDOIT",31,0)
 I $D(XQAGETAC) Q  ; just get data to return
"RTN","XQALDOIT",32,0)
 S XQAEXIT="ENDACT",XQX1=XQI
"RTN","XQALDOIT",33,0)
 I $P(XQX,U,8)'="" G EN1
"RTN","XQALDOIT",34,0)
 D EN1
"RTN","XQALDOIT",35,0)
ENDACT ;
"RTN","XQALDOIT",36,0)
 I $D(XQMM("J")) S XQMM("J")=$P(XQMM("J"),";")_";",XQALEXIT=1 D  D ^XQ74 K XQALEXIT,XQALMENU
"RTN","XQALDOIT",37,0)
 . K XQALMENU
"RTN","XQALDOIT",38,0)
 . N X S X=$P(XQMM("J"),";")
"RTN","XQALDOIT",39,0)
 . I X=+X S:$P(^DIC(19,X,0),U,4)="M" XQALMENU="" Q
"RTN","XQALDOIT",40,0)
 . S X=$O(^DIC(19,"B",X,0)) S:$P($G(^DIC(19,+X,0)),U,4)="M" XQALMENU=""
"RTN","XQALDOIT",41,0)
 I $D(XQX1),XQX1'>0 K XQX1
"RTN","XQALDOIT",42,0)
 I $D(XQAKILL) D DELETEA^XQALERT
"RTN","XQALDOIT",43,0)
 K XQAKILL,XQAROU,XQAID,XQADATA
"RTN","XQALDOIT",44,0)
 Q
"RTN","XQALDOIT",45,0)
DOOPT(OPTION) ;
"RTN","XQALDOIT",46,0)
 N XQX1,XQAKILL,XQAROU,XQADATA,XQAID,XQMM
"RTN","XQALDOIT",47,0)
 S XQMM("J")=OPTION
"RTN","XQALDOIT",48,0)
 D ENDACT
"RTN","XQALDOIT",49,0)
 Q
"RTN","XQALDOIT",50,0)
 ;
"RTN","XQALDOIT",51,0)
PRINT ;
"RTN","XQALDOIT",52,0)
 S XQIJ=$$NOW^XLFDT(),%ZIS="MQ" D ^%ZIS Q:POP  I $D(IO("Q")) K IO("Q") S ZTRTN="DQ^XQALDOIT",ZTIO=ION,ZTSAVE("XQIJ")="",ZTSAVE("^TMP(""XQ"",$J,""XQA2"",")="" D ^%ZTLOAD K ZTSK,ZTRTN,ZTIO,ZTSAVE Q
"RTN","XQALDOIT",53,0)
DQ ;
"RTN","XQALDOIT",54,0)
 U IO W @IOF,!!?10,"PENDING ALERTS  "_$P(^VA(200,+^XTV(8992,DUZ,0),0),U)_"   "_$E(XQIJ,4,5)_"/"_$E(XQIJ,6,7)_"/"_$E(XQIJ,2,3)_"  "_$E($P(XQIJ,".",2)_"00",1,2)_":"_$E($P(XQIJ,".",2)_"0000",3,4),!!
"RTN","XQALDOIT",55,0)
 F XQIJ=0:0 S XQIJ=$O(^TMP("XQ",$J,"XQA2",XQIJ)) Q:XQIJ'>0  W !,^(XQIJ)
"RTN","XQALDOIT",56,0)
 D ^%ZISC K XQIJ W:'$D(ZTQUEUED) !!
"RTN","XQALDOIT",57,0)
 Q
"RTN","XQALDOIT",58,0)
MORP K ^TMP("XQ",$J,"XQA2") S XQIK=0 F XQIJ=0:0 S XQIJ=$O(^TMP("XQ",$J,"XQA",XQIJ)) Q:XQIJ'>0  S XQIK=XQIK+1,XQIX=^(XQIJ),^TMP("XQ",$J,"XQA2",XQIK)=$J(XQIK,3)_". "_$P(XQIX,U,3)
"RTN","XQALDOIT",59,0)
 K XQIK,XQIX,XQIJ
"RTN","XQALDOIT",60,0)
 Q
"RTN","XQALDOIT",61,0)
MAIL ;
"RTN","XQALDOIT",62,0)
 S XMTEXT="^TMP(""XQ"",$J,""XQA2"",",XMSUB="LIST OF PENDING ALERTS",XMY(DUZ)="",XMDUZ=.5 D ^XMD K XMTEXT,XMSUB,XMDUZ,XMY W !!,"Message will be delivered as NEW mail to YOU.",!!
"RTN","XQALDOIT",63,0)
 Q
"RTN","XQALERT")
0^8^B9940054
"RTN","XQALERT",1,0)
XQALERT ;ISC-SF.SEA/JLI - ALERT HANDLER ;09/11/97  13:44
"RTN","XQALERT",2,0)
 ;;8.0;KERNEL;**1,65**;Jul 05, 1995
"RTN","XQALERT",3,0)
 ;;
"RTN","XQALERT",4,0)
 Q
"RTN","XQALERT",5,0)
 ;
"RTN","XQALERT",6,0)
SETUP ;SR.
"RTN","XQALERT",7,0)
 D SETUP^XQALSET
"RTN","XQALERT",8,0)
 Q
"RTN","XQALERT",9,0)
 ;
"RTN","XQALERT",10,0)
DISPLAY ;SR. Display any new alerts
"RTN","XQALERT",11,0)
 Q:$O(^XTV(8992,DUZ,"XQA",0))'>0
"RTN","XQALERT",12,0)
 N X,XQI,XQX,XQX1,DIR,XQA,Y S XQX=0,XQX1=0,Y=1,DIR(0)="E"
"RTN","XQALERT",13,0)
 F XQI=0:0 D:XQX1&'(XQX1#20) ^DIR Q:'Y  S XQI=$O(^XTV(8992,DUZ,"XQA",XQI)) Q:XQI'>0  S XQX=XQX+1,X=$G(^XTV(8992,DUZ,"XQA",XQI,0)) I $P(X,U,4) D
"RTN","XQALERT",14,0)
 . N XQXXX,XQXX,XQXY
"RTN","XQALERT",15,0)
 . S XQXXX=X,(XQXX,XQXY)=0,XQXX=$P(X,U,2) I XQXX'="" S XQXX=$O(^XTV(8992.1,"B",$E(XQXX,1,30),0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",DUZ,0)) I XQXY>0 S XQXDAT=$$NOW^XLFDT(),$P(^XTV(8992.1,XQXX,20,XQXY,0),U,2)=XQXDAT
"RTN","XQALERT",16,0)
 . S X=XQXXX W:XQX1=0 $C(7) W !,$P(X,U,3) S XQX1=XQX1+1,$P(^XTV(8992,DUZ,"XQA",XQI,0),U,4)="" I $D(^(2)) S X1=^(2) D
"RTN","XQALERT",17,0)
 . . S X2=$P(X1,U,3)
"RTN","XQALERT",18,0)
 . . W !?5,"*** FORWARDED BY: ",$P(^VA(200,+X1,0),U),"   Generated: " S X1=$P($P(X,U,2),";",3) W $$DAT8(X1,1)
"RTN","XQALERT",19,0)
 . . I X2'="" W !?5,X2
"RTN","XQALERT",20,0)
 . I $P(X,U,5)="D" S XQA=$P(X,U,2) K ^XTV(8992,DUZ,"XQA",XQI) D  S XQX=XQX-1 D:XQA'="" D
"RTN","XQALERT",21,0)
 . . I $G(XQXX)>0,$G(XQXY)>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,5)=XQXDAT
"RTN","XQALERT",22,0)
 . K XQXX,XQXY
"RTN","XQALERT",23,0)
 I XQX>0 W:XQX1=0 !!,"You have PENDING ALERTS" W !?10,"Enter  ""VA   VIEW ALERTS     to review alerts",!
"RTN","XQALERT",24,0)
 W:XQX1>0 !
"RTN","XQALERT",25,0)
 K XQI,XQX,XQX1,DIR,XQA,Y
"RTN","XQALERT",26,0)
 Q
"RTN","XQALERT",27,0)
D K ^XTV(8992,"AXQA",XQA,DUZ),^XTV(8992,"AXQAN",$P(XQA,";"),DUZ)
"RTN","XQALERT",28,0)
 Q
"RTN","XQALERT",29,0)
 ;
"RTN","XQALERT",30,0)
 ;
"RTN","XQALERT",31,0)
DAT8(FMDAT,TFLG) ;
"RTN","XQALERT",32,0)
 N X
"RTN","XQALERT",33,0)
 S X=$E(FMDAT,4,5)_"/"_$E(FMDAT,6,7)_"/"_$E(FMDAT,2,3)
"RTN","XQALERT",34,0)
 I $G(TFLG)>0 S FMDAT=FMDAT_"0000000",X=X_" "_$E(FMDAT,9,10)_":"_$E(FMDAT,11,12)_":"_$E(FMDAT,13,14)
"RTN","XQALERT",35,0)
 Q X
"RTN","XQALERT",36,0)
DOIT ;OPT. Process Alerts
"RTN","XQALERT",37,0)
 N XQALAST,XQALFWD,XQAUSER
"RTN","XQALERT",38,0)
 S XQAUSER=DUZ D DOIT^XQALERT1,COUNT^XQALDEL(0,XQAUSER)
"RTN","XQALERT",39,0)
 Q
"RTN","XQALERT",40,0)
 ;
"RTN","XQALERT",41,0)
DELETE ;
"RTN","XQALERT",42,0)
 D DELETE^XQALDEL
"RTN","XQALERT",43,0)
 Q
"RTN","XQALERT",44,0)
 ;
"RTN","XQALERT",45,0)
DELETEA ;
"RTN","XQALERT",46,0)
 D DELETEA^XQALDEL
"RTN","XQALERT",47,0)
 Q
"RTN","XQALERT",48,0)
 ;
"RTN","XQALERT",49,0)
OLDDEL ;OPT.
"RTN","XQALERT",50,0)
 D OLDDEL^XQALDEL
"RTN","XQALERT",51,0)
 Q
"RTN","XQALERT",52,0)
 ;
"RTN","XQALERT",53,0)
USERDEL ;OPT.
"RTN","XQALERT",54,0)
 D USERDEL^XQALDEL
"RTN","XQALERT",55,0)
 Q
"RTN","XQALERT",56,0)
 ;
"RTN","XQALERT",57,0)
USER(ROOT,XQAUSER,FRSTDATE,LASTDATE) ; Returns current alerts for the user in an array located under root
"RTN","XQALERT",58,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALERT",59,0)
 D GETUSER^XQALDATA(ROOT,XQAUSER,$G(FRSTDATE),$G(LASTDATE))
"RTN","XQALERT",60,0)
 Q
"RTN","XQALERT",61,0)
 ;
"RTN","XQALERT",62,0)
PATIENT(ROOT,PATIENT,FRSTDATE,LASTDATE) ;
"RTN","XQALERT",63,0)
 I $G(PATIENT)'>0 Q
"RTN","XQALERT",64,0)
 D GETPAT^XQALDATA(ROOT,PATIENT,$G(FRSTDATE),$G(LASTDATE))
"RTN","XQALERT",65,0)
 Q
"RTN","XQALERT",66,0)
ACTION(ALERTID) ;
"RTN","XQALERT",67,0)
 D ACTION^XQALDOIT(ALERTID)
"RTN","XQALERT",68,0)
 Q
"RTN","XQALERT",69,0)
GETACT(ALERTID) ; Return to calling routine the information needed to act on
"RTN","XQALERT",70,0)
 ; the specified alert.
"RTN","XQALERT",71,0)
 ; On return the following variables are defined:
"RTN","XQALERT",72,0)
 ;  XQAID = the full alert id
"RTN","XQALERT",73,0)
 ;  XQADATA = Any data passed as XQADATA at the time the alert was generated
"RTN","XQALERT",74,0)
 ;  XQAROU  = Indicates routine to be run (includes tag if necessary)
"RTN","XQALERT",75,0)
 ;    This value may have three meanings
"RTN","XQALERT",76,0)
 ;      1.  A null value indicates no routine to be used (XQAOPT contains
"RTN","XQALERT",77,0)
 ;          option name to be run)
"RTN","XQALERT",78,0)
 ;      2.  A value of ^<space>  indicates that the alert is information
"RTN","XQALERT",79,0)
 ;          only (no routine or option action involved).
"RTN","XQALERT",80,0)
 ;      3.  The name of the routine as ^ROUTINE  or TAG^ROUTINE
"RTN","XQALERT",81,0)
 ;  XQAOPT  = Indicates the name of the option to be run if not null.
"RTN","XQALERT",82,0)
 ;
"RTN","XQALERT",83,0)
 N XQX,XQZ,XQAGETAC
"RTN","XQALERT",84,0)
 S XQAGETAC=1
"RTN","XQALERT",85,0)
 D ACTION^XQALDOIT(ALERTID)
"RTN","XQALERT",86,0)
 S XQAID=$P(XQX,U,2)
"RTN","XQALERT",87,0)
 S XQADATA=$S(XQZ'="":XQZ,1:$P(XQX,U,9,99))
"RTN","XQALERT",88,0)
 S XQAROU=$S($P(XQX,U,8)="":"",1:$P(XQX,U,7,8))
"RTN","XQALERT",89,0)
 S XQAOPT=$S($P(XQX,U,8)="":$P(XQX,U,7),1:"")
"RTN","XQALERT",90,0)
 Q
"RTN","XQALERT",91,0)
 Q
"RTN","XQALERT1")
0^7^B31504358
"RTN","XQALERT1",1,0)
XQALERT1 ;ISC-SF.SEA/JLI - ALERT HANDLER ;11/19/97  14:22
"RTN","XQALERT1",2,0)
 ;;8.0;KERNEL;**20,65**;Jul 10, 1995
"RTN","XQALERT1",3,0)
 ;;
"RTN","XQALERT1",4,0)
 Q
"RTN","XQALERT1",5,0)
 ;
"RTN","XQALERT1",6,0)
DOIT I $D(XQX1),XQX1'>0 K XQX1
"RTN","XQALERT1",7,0)
 I $D(XQAKILL) D DELETEA^XQALERT
"RTN","XQALERT1",8,0)
 I '$D(XQX1),$O(^XTV(8992,XQAUSER,"XQA",0))'>0,$G(XQAROU)="^ " S XQAROU=""
"RTN","XQALERT1",9,0)
 I ($D(XQX1)&$S('$D(XQAROU):1,XQAROU="":1,XQAROU="^ ":0,1:1))!('$D(XQX1)&$S('$D(XQAROU):0,XQAROU="^ ":1,1:0)) W !! S DIR(0)="Y",DIR("A")="Continue Processing ALERTS ",DIR("B")="Y" D ^DIR K DIR G:'Y EXIT
"RTN","XQALERT1",10,0)
 S XQAREV=1,XQXOUT=0,XQK=0,XQACNT=0 K XQADATA,XQAID,XQAROU,XQAKILL
"RTN","XQALERT1",11,0)
 I '$D(XQX1) S XQX1=0 K ^TMP("XQ",$J,"XQA"),^("XQA1"),^("XQA2") I $O(^XTV(8992,XQAUSER,"XQA",0))'>0 K XQX1 G EXIT
"RTN","XQALERT1",12,0)
 ;Sort and remove display only
"RTN","XQALERT1",13,0)
 I 'XQX1 W !!! D SORT
"RTN","XQALERT1",14,0)
 ;Now display them.
"RTN","XQALERT1",15,0)
 S XQK=0 F XQI=0:0 Q:XQX1!XQXOUT  S XQI=$O(^TMP("XQ",$J,"XQA",XQI)) Q:XQI'>0  S XQX=^(XQI),XQII=^(XQI,1),XQZ=^(2),XQZ1=^(3) D DOIT1
"RTN","XQALERT1",16,0)
 S:'$D(XQXOUT) XQXOUT=0 G:XQXOUT EXIT G:XQK'>0&'XQX1 EXIT I 'XQX1 D ASK G:XQXOUT EXIT
"RTN","XQALERT1",17,0)
 G:+XQX1=0 EXIT I XQX1<0 S XQX1=0 G DOIT
"RTN","XQALERT1",18,0)
 I $D(XQALDELE)!$D(XQALFWD) Q
"RTN","XQALERT1",19,0)
 D WAIT(+XQX1) G:XQXOUT EXIT
"RTN","XQALERT1",20,0)
 G EN^XQALDOIT
"RTN","XQALERT1",21,0)
 ;
"RTN","XQALERT1",22,0)
EXIT ;
"RTN","XQALERT1",23,0)
 I $G(XQALAST)="I",$G(DUZ("AUTO")) D WAIT2
"RTN","XQALERT1",24,0)
 K ^TMP("XQ",$J,"XQA"),^("XQA1"),^("XQA2"),XQI,XQX,XQJ,XQK,XQX1,XQX2,XQXOUT,XQ1,XQII,XQACNT,XQA1,XQAREV,%ZIS,XQAROU,XQALAST
"RTN","XQALERT1",25,0)
 Q
"RTN","XQALERT1",26,0)
 ;
"RTN","XQALERT1",27,0)
DOIT1 ;
"RTN","XQALERT1",28,0)
 I XQK=0,'$D(XQALFWD) W @IOF
"RTN","XQALERT1",29,0)
 S XQK=XQK+1 W !,$J(XQK,2),".",$S($P(XQX,U,8)=" ":"I",1:" "),"  ",$E($P(XQX,U,3),1,70) D:XQZ1'=""
"RTN","XQALERT1",30,0)
 . W !?8,"Forwarded by: ",$P(^VA(200,+XQZ1,0),U),"  Generated: ",$$DAT8^XQALERT(+$P($P(XQX,U,2),";",3),1)
"RTN","XQALERT1",31,0)
 . I $P(XQZ1,U,3)'="" W !?8,$P(XQZ1,U,3)
"RTN","XQALERT1",32,0)
 S ^TMP("XQ",$J,"XQA1",XQK)=XQX,^(XQK,1)=XQII,^(2)=XQZ,^(3)=XQZ1
"RTN","XQALERT1",33,0)
 I ($Y+4)>IOSL D ASK0(XQI) Q:XQX1!(XQXOUT)  W @IOF
"RTN","XQALERT1",34,0)
 Q
"RTN","XQALERT1",35,0)
 ;
"RTN","XQALERT1",36,0)
ASK0(XQI) ;Stack XQI
"RTN","XQALERT1",37,0)
ASK S XQ1=0,XQXOUT=0 W !?10,"Select from 1 to ",XQK,!?10,"or enter ?, A " W:'$D(XQALDELE)&'$D(XQALFWD) "I, F, P, M, R, " W "or ^ to exit" I XQI>0,$O(^XTV(8992,XQAUSER,"XQA",XQI))>0 W !?10,"or RETURN to continue" S XQ1=1
"RTN","XQALERT1",38,0)
 R ": ",XQII:DTIME S:'$T!(XQII[U)!(XQII=""&'XQ1) XQXOUT=1 Q:XQXOUT
"RTN","XQALERT1",39,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"PpMm"[$E(XQII_".") D MORP^XQALDOIT D:"Pp"[$E(XQII_".") PRINT^XQALDOIT D:"Mm"[$E(XQII_".") MAIL^XQALDOIT K ^TMP("XQ",$J,"XQA2") G ASK
"RTN","XQALERT1",40,0)
 I XQII'="",XQII["?" D HELP G ASK
"RTN","XQALERT1",41,0)
 Q:XQII=""&XQ1  I "IiAaFfRr"'[$E(XQII_"."),(XQII<1)!(XQII>XQK) W $C(7),"  ??",! G ASK
"RTN","XQALERT1",42,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"Ff"[$E(XQII) D FWRD^XQALFWD S XQX1=-1 Q
"RTN","XQALERT1",43,0)
 I '$D(XQALDELE),"Rr"[$E(XQII) S XQX1=-1 Q
"RTN","XQALERT1",44,0)
 I "Aa"[$E(XQII) S X="1-"_XQACNT,DIR(0)="LV^1:"_XQACNT D ^DIR K DIR,XQX1 M XQX1=Y S XQII="" K Y ;Merge list from Y
"RTN","XQALERT1",45,0)
 I XQII'="","Ii"[$E(XQII) S XQX1(0)="",XQX2=0,XQII="" F XQK=0:0 S XQK=$O(^TMP("XQ",$J,"XQA1",XQK)) S:XQK'>0 XQX1=XQX1(0) Q:XQK'>0  I $P(^(XQK),U,7,8)="^ " S XQX1(XQX2)=XQX1(XQX2)_XQK_"," S:$L(XQX1(XQX2))>240 XQX2=XQX2+1,XQX1(XQX2)=""
"RTN","XQALERT1",46,0)
 I XQII="" Q
"RTN","XQALERT1",47,0)
 S X=XQII,DIR(0)="LV^1:"_XQK D ^DIR I '$D(Y) W $C(7),"  ??" D HELP G ASK ;Use of 'LV' is special
"RTN","XQALERT1",48,0)
 K XQX1 M XQX1=Y K Y S Y=XQX1 ;Merge list from Y
"RTN","XQALERT1",49,0)
 Q
"RTN","XQALERT1",50,0)
WAIT(IFN) ;Wait for user input if last alert is INFO and next isn't.
"RTN","XQALERT1",51,0)
 N X,YY Q:$G(XQXOUT)
"RTN","XQALERT1",52,0)
 S X=$G(^TMP("XQ",$J,"XQA1",IFN)),YY=$P(X,U,7,8),YY=$S(YY="^ ":"I",YY="^":"O",1:"R")
"RTN","XQALERT1",53,0)
 I $G(XQALAST)="I","OR"[YY D WAIT2
"RTN","XQALERT1",54,0)
 I YY="I",$Y+4>IOSL D WAIT2 W @IOF
"RTN","XQALERT1",55,0)
 S XQALAST=YY
"RTN","XQALERT1",56,0)
 Q
"RTN","XQALERT1",57,0)
WAIT2 ;Wait for user input before continuing
"RTN","XQALERT1",58,0)
 N DIR,Y,DIROUT,DIRUT S DIR(0)="E",DIR("?")="The next ALERT may cause the lost info on the screen."
"RTN","XQALERT1",59,0)
 D ^DIR S:$D(DIRUT) XQXOUT=1
"RTN","XQALERT1",60,0)
 Q
"RTN","XQALERT1",61,0)
 ;
"RTN","XQALERT1",62,0)
HELP W !!,"YOU MAY ENTER:",!?3,$S(XQK>1:"One or more numbers",1:"A number")," in the range 1 to ",XQK," to select specific alert(s)"
"RTN","XQALERT1",63,0)
 W !?6,"for "_$S($D(XQALDELE):"DELETION.",$D(XQALFWD):"FORWARDING",1:"processing.") W:XQK>1 "  This may be a series of numbers, e.g., 2,3,6-9"
"RTN","XQALERT1",64,0)
 W !?3,"A to "_$S($D(XQALDELE):"DELETE",$D(XQALFWD):"FORWARD",1:"process")," all of the pending alerts in the order shown."
"RTN","XQALERT1",65,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"I to process all of the INFORMATION ONLY alerts, if any, without further ado."
"RTN","XQALERT1",66,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"F to forward one or more specific alerts.  Forwarding may be as an ALERT",!,"to specific user(s) and/or mail group(s), or as a MAIL MESSAGE, or to a",!,"specific PRINTER."
"RTN","XQALERT1",67,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"P to print a copy of the pending alerts on a printer"
"RTN","XQALERT1",68,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"M to receive a MailMan message containing a copy of these pending alerts"
"RTN","XQALERT1",69,0)
 W:'$D(XQALDELE) !?3,"R to Redisplay the available alerts"
"RTN","XQALERT1",70,0)
 W !?3,"^ to exit"
"RTN","XQALERT1",71,0)
 I XQI W !?5,"or RETURN to see additional pending ALERTS"
"RTN","XQALERT1",72,0)
 W !!
"RTN","XQALERT1",73,0)
 Q
"RTN","XQALERT1",74,0)
 ;
"RTN","XQALERT1",75,0)
SORT ;Sort and remove display only
"RTN","XQALERT1",76,0)
 F XQI=0:0 S XQI=$O(^XTV(8992,XQAUSER,"XQA",XQI)) Q:XQI'>0  S XQX=^(XQI,0),XQZ=$G(^(1)),XQZ1=$G(^(2)) S XQJ=$P(XQX,U,7,8) K:XQJ=U ^XTV(8992,XQAUSER,"XQA",XQI) I XQJ'=U D
"RTN","XQALERT1",77,0)
 . S XQACNT=XQACNT+1,XQJ=$S(XQAREV:999999-XQACNT,1:XQACNT),^TMP("XQ",$J,"XQA",XQJ)=XQX,^(XQJ,1)=XQI,^(2)=XQZ,^(3)=XQZ1
"RTN","XQALERT1",78,0)
 S XQK=0 F XQI=0:0 S XQI=$O(^TMP("XQ",$J,"XQA",XQI)) Q:XQI'>0  S XQK=XQK+1 M ^TMP("XQ",$J,"XQA1",XQK)=^TMP("XQ",$J,"XQA",XQI)
"RTN","XQALERT1",79,0)
 Q
"RTN","XQALFWD")
0^10^B16824103
"RTN","XQALFWD",1,0)
XQALFWD ;ISC-SF.SEA/JLI - FORWARD ALERTS ;05/13/97  14:34
"RTN","XQALFWD",2,0)
 ;;8.0;KERNEL;**6,65**;Jul 10, 1995
"RTN","XQALFWD",3,0)
 Q
"RTN","XQALFWD",4,0)
FWRD ; ENTRY POINT FOR SELECTION FROM 'VIEW ALERTS' SCREEN
"RTN","XQALFWD",5,0)
 ; USER NEEDS TO SELECT ALERT(S) FOR FORWARDING
"RTN","XQALFWD",6,0)
 ; TYPE (ALERT, MAIL MESSAGE, OR PRINT)
"RTN","XQALFWD",7,0)
 ; AND RECIPIENT(S) OR DEVICE
"RTN","XQALFWD",8,0)
 ; AND COMMENT IF ANY TO BE DISPLAYED WITH ALERT
"RTN","XQALFWD",9,0)
 ;
"RTN","XQALFWD",10,0)
 W !,"Enter RETURN to continue:" R X:DTIME Q:'$T  W @IOF,!,"You may now Select the alert or alerts that you want forwarded:",!
"RTN","XQALFWD",11,0)
 N XQI,XQK,XQACNT,XQAREV,DIR
"RTN","XQALFWD",12,0)
 S XQALFWD=1 S XQX1=-1 D DOIT^XQALERT1
"RTN","XQALFWD",13,0)
 K XQALFWDL
"RTN","XQALFWD",14,0)
 S:'$D(XQX1) XQX1=-1 S:'$D(XQXOUT) XQXOUT=0
"RTN","XQALFWD",15,0)
 F  Q:XQX1'>0  S XQALFWDL(+XQX1)=$P(^TMP("XQ",$J,"XQA1",+XQX1),U,2),XQX1=$P(XQX1,",",2,200)
"RTN","XQALFWD",16,0)
 G:'$D(XQALFWDL) EXIT
"RTN","XQALFWD",17,0)
 K DIR S DIR(0)="S^A:ALERT;M:MAIL MESSAGE;P:PRINT COPY;",DIR("A")="Select the method of forwarding desired",DIR("B")="ALERT" D ^DIR K DIR G:$D(DIRUT) EXIT S XQATYP=Y
"RTN","XQALFWD",18,0)
 I XQATYP="A"!(XQATYP="M") D LOOP1^XQALMAKE G:'$D(XQA) EXIT S I="" F  S I=$O(XQA(I)) Q:I=""  S XQAARR(I)=I K XQA(I)
"RTN","XQALFWD",19,0)
 I XQATYP="P" S DIC=3.5,DIC(0)="AEQM",DIC("A")="Select the DEVICE to print on" D ^DIC K DIC G:Y'>0 EXIT S XQAARR="`"_(+Y)
"RTN","XQALFWD",20,0)
 W !,"You may enter a comment to be associated with the forwarded alert if you wish",!,"Comment (optional): " R XQACOMNT:DTIME G:'$T!(XQACOMNT[U) EXIT
"RTN","XQALFWD",21,0)
 K XQALFWD
"RTN","XQALFWD",22,0)
 D FORWARD(.XQALFWDL,.XQAARR,XQATYP,XQACOMNT)
"RTN","XQALFWD",23,0)
EXIT S XQX1=-1 W !!,"You will now return to PROCESSING ALERTS, enter RETURN to continue:" R X:DTIME
"RTN","XQALFWD",24,0)
 K XQALFWDL,XQAARR,XQATYP,XQACOMNT,DIRUT,XQALFWD
"RTN","XQALFWD",25,0)
 Q
"RTN","XQALFWD",26,0)
 ;
"RTN","XQALFWD",27,0)
 Q
"RTN","XQALFWD",28,0)
FORWARD(XQALST,XQARECIP,XQATYPE,XQACOMNT) ;
"RTN","XQALFWD",29,0)
 Q:'$D(XQALST)  Q:'$D(XQARECIP)
"RTN","XQALFWD",30,0)
 N I,XQAVALS
"RTN","XQALFWD",31,0)
 S XQATYPE=$G(XQATYPE)
"RTN","XQALFWD",32,0)
 I XQATYPE="A" D
"RTN","XQALFWD",33,0)
 . S I="" F  S I=$O(XQALST(I)) Q:I=""  D SETXQA D RESETUP^XQALSET(XQALST(I),.XQAVALS,XQACOMNT)
"RTN","XQALFWD",34,0)
 . I $O(XQALST(""))="",$D(XQALST)=1,XQALST'="" D SETXQA D RESETUP^XQALSET(XQALST,.XQAVALS,XQACOMNT)
"RTN","XQALFWD",35,0)
 I XQATYPE="M" D
"RTN","XQALFWD",36,0)
 . D MAIL1
"RTN","XQALFWD",37,0)
 I XQATYPE="P" D
"RTN","XQALFWD",38,0)
 . S IOP=XQAARR D ^%ZIS Q:POP
"RTN","XQALFWD",39,0)
 . D PRNT D ^%ZISC
"RTN","XQALFWD",40,0)
 Q
"RTN","XQALFWD",41,0)
 ;
"RTN","XQALFWD",42,0)
SETXQA ;
"RTN","XQALFWD",43,0)
 I $D(XQARECIP)=1 S XQAVALS(XQARECIP)="" Q
"RTN","XQALFWD",44,0)
 S J="" F  S J=$O(XQARECIP(J)) Q:J=""  S XQAVALS(XQARECIP(J))=""
"RTN","XQALFWD",45,0)
 Q
"RTN","XQALFWD",46,0)
 ;
"RTN","XQALFWD",47,0)
SETXMY ;
"RTN","XQALFWD",48,0)
 I $D(XQARECIP)=1 S XMY(XQARECIP)="" Q
"RTN","XQALFWD",49,0)
 S J="" F  S J=$O(XQARECIP(J)) Q:J=""  S XMY(XQARECIP(J))=""
"RTN","XQALFWD",50,0)
 Q
"RTN","XQALFWD",51,0)
 ;
"RTN","XQALFWD",52,0)
MAIL1 ;
"RTN","XQALFWD",53,0)
 N I,XMY,XMSUB,XMTEXT
"RTN","XQALFWD",54,0)
 S I="" F  S I=$O(XQALST(I)) Q:I=""  S X=$O(^XTV(8992,"AXQA",XQALST(I),XQAUSER,0)) I X'="" S X=$G(^XTV(8992,XQAUSER,"XQA",X,0)) I X'="" D SETXMY D MAIL
"RTN","XQALFWD",55,0)
 I $D(XQALST)=1,XQALST>0 S X=$O(^XTV(8992,"AXQA",XQALST,XQAUSER,0)) I X'="" S X=$G(^XTV(8992,XQAUSER,"XQA",X,0)) I X'="" D SETXMY D MAIL
"RTN","XQALFWD",56,0)
 Q
"RTN","XQALFWD",57,0)
MAIL ;
"RTN","XQALFWD",58,0)
 K ^TMP($J,"XQAL") S XMSUB="ALERT: "_$P(X,U,3),XMTEXT="^TMP($J,""XQAL"","
"RTN","XQALFWD",59,0)
 S ^TMP($J,"XQAL",1)=$P(X,U,3),^TMP($J,"XQAL",2)="  Forwarded by: "_$P(^VA(200,XQAUSER,0),U)_"       Generated: "_$$DAT8^XQALERT($P($P(X,U,2),";",3),1) S:$G(XQACOMNT)'="" ^TMP($J,"XQAL",3)=XQACOMNT
"RTN","XQALFWD",60,0)
 D ^XMD
"RTN","XQALFWD",61,0)
 Q
"RTN","XQALFWD",62,0)
 ;
"RTN","XQALFWD",63,0)
PRNT ;
"RTN","XQALFWD",64,0)
 I $D(XQALST)=1,XQALST>0 S X=$O(^XTV(8992,"AXQA",XQALST,XQAUSER,0)) I X'="" S X=$G(^XTV(8992,XQAUSER,"XQA",X,0)) I X'="" D PRNT1
"RTN","XQALFWD",65,0)
 S I="" F  S I=$O(XQALST(I)) Q:I=""  S X=$O(^XTV(8992,"AXQA",XQALST(I),XQAUSER,0)) I X'="" S X=$G(^XTV(8992,XQAUSER,"XQA",X,0)) I X'="" D PRNT1
"RTN","XQALFWD",66,0)
 Q
"RTN","XQALFWD",67,0)
PRNT1 ;
"RTN","XQALFWD",68,0)
 U IO W @IOF
"RTN","XQALFWD",69,0)
 W !!,"ALERT:  "_$P(X,U,3),!!,"   Forwarded by: ",$P(^VA(200,XQAUSER,0),U),"    Generated on: ",$$DAT8^XQALERT($P($P(X,U,2),";",3)),!!,$G(XQACOMNT)
"RTN","XQALFWD",70,0)
 Q
"RTN","XQALSET")
0^6^B22231736
"RTN","XQALSET",1,0)
XQALSET ;ISC-SF.SEA/JLI - SETUP ALERTS ;09/08/97  11:29
"RTN","XQALSET",2,0)
 ;;8.0;KERNEL;**1,6,65**;Jul 10, 1995
"RTN","XQALSET",3,0)
 ;;
"RTN","XQALSET",4,0)
 Q
"RTN","XQALSET",5,0)
 ;
"RTN","XQALSET",6,0)
SETUP Q:$O(XQA(0))=""  Q:'($D(XQAMSG)#2)  Q:XQAMSG=""
"RTN","XQALSET",7,0)
 N X,XQI,XQJ,XQX,XQK,XQACOMNT,XQARESET,DA
"RTN","XQALSET",8,0)
 S XQAOPT1=$S('($D(XQAROU)#2):U,XQAROU'[U:U_XQAROU,1:XQAROU),XQAOPT1=$S(XQAOPT1'=U:XQAOPT1,$D(XQAOPT)#2:XQAOPT_U,1:XQAOPT1) S:XQAOPT1=U XQAOPT1=U_" "
"RTN","XQALSET",9,0)
NOW S XQX=$$NOW^XLFDT()
"RTN","XQALSET",10,0)
 S:$S('$D(XQAID):1,XQAID="":1,1:0) XQAID="NO-ID" S:XQAID[";" XQAID=$P(XQAID,";") S XQA1=XQAID,XQI=XQX
"RTN","XQALSET",11,0)
 I XQA1'="" F  S XQAID=XQA1_";"_DUZ_";"_XQI L +^XTV(8992,"AXQA",XQAID) D  L -^XTV(8992,"AXQA",XQAID) Q:XQI=""  S XQI=XQI+.00000001
"RTN","XQALSET",12,0)
 . I $D(^XTV(8992,"AXQA",XQAID)) Q
"RTN","XQALSET",13,0)
 . S ^XTV(8992,"AXQA",XQAID,0,0)="",XQI=""
"RTN","XQALSET",14,0)
 I XQAID'="" D
"RTN","XQALSET",15,0)
 . N FDA,IENS,XQA2,DIERR
"RTN","XQALSET",16,0)
 . S XQA2=XQA1 I XQA2[",",$P(XQA2,",",3)'="" S XQA2=$P(XQA2,",")_","_$P(XQA2,",",3)
"RTN","XQALSET",17,0)
 . F  D  Q:'$D(DIERR)  Q:'$D(^TMP("DIERR",$J,"E",111))
"RTN","XQALSET",18,0)
 . . K DIERR,^TMP("DIERR",$J)
"RTN","XQALSET",19,0)
 . . S FDA=$NA(^TMP($J,"XQALSET")) K @FDA
"RTN","XQALSET",20,0)
 . . S @FDA@(8992.1,"+1,",.01)=XQAID D UPDATE^DIE("",FDA,"IENS")
"RTN","XQALSET",21,0)
 . . K @FDA
"RTN","XQALSET",22,0)
 . I $D(DIERR) S XQDIERR1=DIERR M XQDIERR=^TMP("DIERR",$J) Q
"RTN","XQALSET",23,0)
 . Q:IENS(1)'>0  S (DA,XQADA)=IENS(1)
"RTN","XQALSET",24,0)
 . S IENS=IENS(1)_",",@FDA@(8992.1,IENS,.02)=XQX,^(.03)=XQA2,^(.05)=DUZ,^(1.01)=XQAMSG
"RTN","XQALSET",25,0)
 . I $D(XQAARCH) S X=$$FMADD^XLFDT(DT,XQAARCH) I X>DT S @FDA@(8992.1,IENS,.08)=X
"RTN","XQALSET",26,0)
 . I $P(XQA1,",",2)>0 S @FDA@(8992.1,IENS,.04)=$P(XQA1,",",2)
"RTN","XQALSET",27,0)
 . I $D(ZTQUEUED) S @FDA@(8992.1,IENS,.06)=1
"RTN","XQALSET",28,0)
 . I $D(XQAOPT)#2 S @FDA@(8992.1,IENS,1.02)=XQAOPT
"RTN","XQALSET",29,0)
 . I $D(XQAROU)#2 S XQAXX=$S(XQAROU[U:XQAROU,1:U_XQAROU) I $P(XQAXX,U,2)'="" S:$P(XQAXX,U)'="" @FDA@(8992.1,IENS,1.03)=$P(XQAXX,U) S @FDA@(8992.1,IENS,1.04)=$P(XQAXX,U,2)
"RTN","XQALSET",30,0)
 . I $D(XQACTMSG) S @FDA@(8992.1,IENS,1.05)=XQACTMSG
"RTN","XQALSET",31,0)
 . I $D(XQADATA) S @FDA@(8992.1,IENS,2)=XQADATA
"RTN","XQALSET",32,0)
 . D FILE^DIE("KS",FDA)
"RTN","XQALSET",33,0)
REENT S XQALIN1=$S($D(XQAID)#2:XQAID,1:"")_U_$E(XQAMSG,1,80)_"^1^"_$S(XQAOPT1=U:"D",1:"R")_U_$S($D(XQACTMSG):$E(XQACTMSG,1,40),1:"")_U_XQAOPT1 S:$D(XQASURO) $P(XQALIN1,U,12)=XQASURO S:$D(XQASUPV) $P(XQALIN1,U,13)=XQASUPV
"RTN","XQALSET",34,0)
 S XQALIN=XQX_U_XQALIN1,XQJ=0
"RTN","XQALSET",35,0)
 K XQALIN1 S:$D(XQADATA) XQALIN1=XQADATA
"RTN","XQALSET",36,0)
LOOP1 S XQJ=$O(XQA(" ")) I XQJ'="" K:"G.g."'[$E(XQJ_",,",1,2) XQA(XQJ) D:$D(XQA(XQJ)) GROUP G LOOP1
"RTN","XQALSET",37,0)
 S XQJ=0
"RTN","XQALSET",38,0)
LOOP S XQJ=$O(XQA(XQJ)) G:XQJ="" WRAP
"RTN","XQALSET",39,0)
 I $G(XQADA)>0 L +^XTV(8992.1,XQADA):10 D
"RTN","XQALSET",40,0)
 . S XQATOP=$S($D(^XTV(8992.1,XQADA,20,0)):$P(^(0),U,4),1:0)+1 S ^(0)="^8992.11^"_XQJ_U_XQATOP
"RTN","XQALSET",41,0)
 . S ^XTV(8992.1,XQADA,20,XQATOP,0)=XQJ,^XTV(8992.1,"R",XQJ,XQADA,XQATOP)="",^XTV(8992.1,XQADA,20,"B",XQJ,XQATOP)="" I $D(XQARESET) S $P(^XTV(8992.1,XQADA,20,XQATOP,0),U,7,8)=XQAUSER_U_XQX
"RTN","XQALSET",42,0)
 I '$D(^XTV(8992,XQJ,0)) D
"RTN","XQALSET",43,0)
 . N FDA,IENS
"RTN","XQALSET",44,0)
 . F  D  Q:'$D(DIERR)  Q:'$D(^TMP("DIERR",$J,"E",110))&'$D(^TMP("DIERR",$J,"E",111))
"RTN","XQALSET",45,0)
 . . K DIERR,^TMP("DIERR",$J)
"RTN","XQALSET",46,0)
 . . S FDA=$NA(^TMP($J,"XQALSET")) K @FDA S @FDA@(8992,"+1,",.01)=XQJ
"RTN","XQALSET",47,0)
 . . S IENS(1)=XQJ
"RTN","XQALSET",48,0)
 . . D UPDATE^DIE("S",FDA,"IENS")
"RTN","XQALSET",49,0)
 L +^XTV(8992,XQJ):10 S XQXI=XQX S:'$D(^XTV(8992,XQJ,"XQA",0)) ^(0)="^8992.01DA^"
"RTN","XQALSET",50,0)
REP I $D(^XTV(8992,XQJ,"XQA",XQXI,0)) S XQXI=XQXI+.00000001 G REP
"RTN","XQALSET",51,0)
 S ^XTV(8992,XQJ,"XQA",XQXI,0)=XQALIN S:$D(XQALIN1) ^(1)=XQALIN1 S:$D(XQARESET) ^(2)=XQAUSER_U_XQX_U_$G(XQACOMNT) S ^(0)=$P(^XTV(8992,XQJ,"XQA",0),U,1,2)_U_XQXI_U_($P(^(0),U,4)+1)
"RTN","XQALSET",52,0)
 L -^XTV(8992,XQJ) L:$G(XQADA)>0 -^XTV(8992.1,XQADA)
"RTN","XQALSET",53,0)
 K XQA(XQJ) S:XQAID'="" ^XTV(8992,"AXQA",XQAID,XQJ,XQXI)="",^XTV(8992,"AXQAN",XQA1,XQJ,XQXI)=""
"RTN","XQALSET",54,0)
 G LOOP
"RTN","XQALSET",55,0)
WRAP K:XQAID'="" ^XTV(8992,"AXQA",XQAID,0,0) K XQA,XQALIN,XQALIN1,XQAMSG,XQAID,XQAFLG,XQAOPT,XQAOPT1,XQAROU,XQADATA,XQI,XQX,XQJ,XQK,XQA1,XQACTMSG,XQJ,XQXI,XQAARCH
"RTN","XQALSET",56,0)
 Q
"RTN","XQALSET",57,0)
 ;
"RTN","XQALSET",58,0)
GROUP S XQL="" F XQI=3:1:$L(XQJ) S XQL1=$E(XQJ,XQI) S:XQL1?1L XQL1=$C($A(XQL1)-32) S XQL=XQL_XQL1
"RTN","XQALSET",59,0)
 S XQI=$O(^XMB(3.8,"B",XQL,0)) I XQI'>0 S XQL1=$O(^XMB(3.8,"B",XQL)) I $E(XQL1,1,$L(XQL))=XQL S XQL2=$O(^(XQL1)) I $E(XQL2,1,$L(XQL))'=XQL S XQI=$O(^(XQL1,0))
"RTN","XQALSET",60,0)
 I XQI>0 F XQL=0:0 S XQL=$O(^XMB(3.8,XQI,1,XQL)) Q:XQL'>0  S XQA(+^(XQL,0))=""
"RTN","XQALSET",61,0)
 K XQA(XQJ),XQI,XQL,XQL1,XQL2
"RTN","XQALSET",62,0)
 Q
"RTN","XQALSET",63,0)
 ;
"RTN","XQALSET",64,0)
RESETUP(XQAIDVAL,XQA,XQACOMNT) ;
"RTN","XQALSET",65,0)
 N XQAIEN,DA,XQI,XQJ,XQK,XQX
"RTN","XQALSET",66,0)
 S:'$D(XQAUSER) XQAUSER=DUZ
"RTN","XQALSET",67,0)
 S XQARESET=1
"RTN","XQALSET",68,0)
 S XQAIEN=$O(^XTV(8992,"AXQA",XQAIDVAL,XQAUSER,0))
"RTN","XQALSET",69,0)
 S X=$G(^XTV(8992,XQAUSER,"XQA",XQAIEN,0)),X1=$G(^(1))
"RTN","XQALSET",70,0)
 Q:X=""
"RTN","XQALSET",71,0)
 S XQAID=$P(X,U,2),XQA1=$P(XQAID,";"),XQADA=$O(^XTV(8992.1,"B",XQAID,0))
"RTN","XQALSET",72,0)
 S XQAOPT1=$P(X,U,7,8),XQAMSG=$P(X,U,3),XQACTMSG=$P(X,U,6)
"RTN","XQALSET",73,0)
 S XQADATA=$S(X1'="":X1,1:$P(X,U,9,100))
"RTN","XQALSET",74,0)
 S XQX=$$NOW^XLFDT()
"RTN","XQALSET",75,0)
 D REENT
"RTN","XQALSET",76,0)
 Q
"RTN","XUINPCH")
0^^B8610476
"RTN","XUINPCH",1,0)
XUINPCH ;SF/RWF - RE-INDEX NEW X-REF ON FILE 200 ;11/25/97  11:32
"RTN","XUINPCH",2,0)
 ;;8.0;KERNEL;**20,36,43,49,63,65**;Feb. 9, 1996
"RTN","XUINPCH",3,0)
 Q
"RTN","XUINPCH",4,0)
POST1 ;Post init for patch XU*8*20 to reindex new X-ref on file 200.
"RTN","XUINPCH",5,0)
 N XU,DA,DIK
"RTN","XUINPCH",6,0)
 F XU=0:0 S XU=$O(^VA(200,XU)) Q:XU'>0  I $D(^VA(200,XU,203,0)) D
"RTN","XUINPCH",7,0)
 . S DA(1)=XU,DIK="^VA(200,"_XU_",203,",DIK(1)=".01^4"
"RTN","XUINPCH",8,0)
 . D ENALL^DIK
"RTN","XUINPCH",9,0)
 . Q
"RTN","XUINPCH",10,0)
 Q
"RTN","XUINPCH",11,0)
POST14 ;Post INIT for patch XU*8*14 to seed the E-sig last changed date.
"RTN","XUINPCH",12,0)
 N DA,%,%H,LT S DA=.5,%H=$H,LT=$$KSP^XUPARAM("LIFETIME")
"RTN","XUINPCH",13,0)
 F  S DA=$O(^VA(200,DA)) Q:DA'>0  S %=$G(^VA(200,DA,20)) I $L(%) D
"RTN","XUINPCH",14,0)
 . Q:'$L($P(%,U,4))!$P(%,U,1)
"RTN","XUINPCH",15,0)
 . S $P(^VA(200,DA,20),U,1)=+$$HADD^XLFDT(%H,($R(LT)+30),0,0,0)
"RTN","XUINPCH",16,0)
 . Q
"RTN","XUINPCH",17,0)
 Q
"RTN","XUINPCH",18,0)
 ;
"RTN","XUINPCH",19,0)
POST36 ;Post INIT for patch XU*8*36
"RTN","XUINPCH",20,0)
 N I,X
"RTN","XUINPCH",21,0)
 ;Cleanup some old data in file 4.
"RTN","XUINPCH",22,0)
 F I=0:0 S I=$O(^DIC(4,I)) Q:I'>0  I $D(^DIC(4,I,1,"B"))>2 K ^DIC(4,I,1,"B")
"RTN","XUINPCH",23,0)
 ;See that we have the current ID nodes for file 200
"RTN","XUINPCH",24,0)
 F I=1,2,3 S X=$T(ID200+I) I $P(X,";",3)]"" S ^DD(200,0,"ID",$P(X,";",3))=$P(X,";",4,99)
"RTN","XUINPCH",25,0)
 Q
"RTN","XUINPCH",26,0)
ID200 ;;
"RTN","XUINPCH",27,0)
 ;;1;D EN^DDIOL("   "_$P(^(0),U,2),"","?0")
"RTN","XUINPCH",28,0)
 ;;28;D:$D(^(5)) EN^DDIOL("   "_$P(^(5),U,2),"","?0")
"RTN","XUINPCH",29,0)
 ;;W8;D:$P(^(0),U,9) EN^DDIOL("   "_$$EXTERNAL^DILFD(200,8,"",$P(^(0),U,9)),"","?0")
"RTN","XUINPCH",30,0)
 ;
"RTN","XUINPCH",31,0)
POST43 ;Post INIT for patch 43, Inst file support for CIRN/VISN
"RTN","XUINPCH",32,0)
 N FDA,IEN S FDA(4.1,"?+1,",.01)="VISN",FDA(4.1,"?+1,",1)="VETERANS INTEGRATED SERVICE NETWORK"
"RTN","XUINPCH",33,0)
 D UPDATE^DIE("E","FDA","IEN")
"RTN","XUINPCH",34,0)
 Q
"RTN","XUINPCH",35,0)
POST49 ;Post INIT for patch XU*8*49
"RTN","XUINPCH",36,0)
 N I,X
"RTN","XUINPCH",37,0)
 ;See that we have the current ID nodes for file 3.2 and 3.5
"RTN","XUINPCH",38,0)
 F I=1:1:4 S X=$T(ID49+I) I $P(X,";",3)]"" S ^DD($P(X,";",3),0,"ID",$P(X,";",4))=$P(X,";",5,99)
"RTN","XUINPCH",39,0)
 Q
"RTN","XUINPCH",40,0)
ID49 ;;
"RTN","XUINPCH",41,0)
 ;;3.2;W99;N % S %=$P($G(^(9)),U,1) D:$L(%) EN^DDIOL("  "_%,"",$S($S($X>30:$X,1:30)+$L(%)>76:"!?8",1:"?30"))
"RTN","XUINPCH",42,0)
 ;;3.5;.02;N % S %=$P($G(^(1)),U) D:$L(%) EN^DDIOL("  "_%,"",$S($X+$L(%)>76:"!?"_(77-$L(%)),1:"?0"))
"RTN","XUINPCH",43,0)
 ;;3.5;1;D EN^DDIOL("   "_$P(^(0),U,2),"","?0")
"RTN","XUINPCH",44,0)
 ;;3.5;1.9;D EN^DDIOL("   "_$P(^(0),U,9),"","?0")
"RTN","XUINPCH",45,0)
 ;
"RTN","XUINPCH",46,0)
POST63 ;Post INIT for patch xu*8*63
"RTN","XUINPCH",47,0)
 ;Move taskman screens to error message file.
"RTN","XUINPCH",48,0)
 N X1,X2,X3,ZDF,ZDA,DIE,DR,DA S X1=""
"RTN","XUINPCH",49,0)
 F X3=1:1 S X1=$O(^%ZTSCH("ES",X1)) Q:X1=""  D
"RTN","XUINPCH",50,0)
 . S X2=$O(^%ZTER(2,"B",X1,0)) I X2 S DA=X2,DR=".03////2",DIE="3.076" D ^DIE Q
"RTN","XUINPCH",51,0)
 . S ZDA="?+1,",ZDF(3.076,ZDA,.01)="LOCAL_"_X3,ZDF(3.076,ZDA,.02)="L",ZDF(3.076,ZDA,.03)=2,ZDF(3.076,ZDA,2)=X1
"RTN","XUINPCH",52,0)
 . D UPDATE^DIE("","ZDF","") K ZDF Q
"RTN","XUINPCH",53,0)
 . Q
"RTN","XUINPCH",54,0)
 K ^%ZTSCH("ES")
"RTN","XUINPCH",55,0)
 Q
"RTN","XUINPCH",56,0)
 ;
"RTN","XUINPCH",57,0)
POST65 ;Post INIT for patch XU*8*65
"RTN","XUINPCH",58,0)
 ;Remove extra CPU field from sign-on file.
"RTN","XUINPCH",59,0)
 I $D(^DD(3.081,60,0)) S DIK="^DD(3.081,",DA=60,DA(1)=3.081 D ^DIK
"RTN","XUINPCH",60,0)
 Q
"RTN","XUINPCH",61,0)
POST69 ;Post init for patch XU*8*69
"RTN","XUINPCH",62,0)
 ;Remove extra node from Option file set by patch 49
"RTN","XUINPCH",63,0)
 N DA,DIK,DF,X,Y,Z,N
"RTN","XUINPCH",64,0)
 K ^DD(19,.01,7.5),^DD(19,.01,4)
"RTN","XUINPCH",65,0)
 ;Delete extra data from the device file
"RTN","XUINPCH",66,0)
 F DF=0:0 S DF=$O(^%ZIS(1,DF)) Q:DF'>0  S X=$G(^%ZIS(1,DF,91)),Y=+$G(^("SUBTYPE")) D
"RTN","XUINPCH",67,0)
 . S Z=$G(^%ZIS(2,Y,1)),N=""
"RTN","XUINPCH",68,0)
 . I X>0,$P(X,U,1,4)'=$P(Z,U,1,4) S:X>0 N=+X S:$P(X,U,3)]"" $P(N,U,3)=$P(X,U,3)
"RTN","XUINPCH",69,0)
 . K ^%ZIS(1,DF,91) S:N]"" ^(91)=N
"RTN","XUINPCH",70,0)
 . Q
"RTN","XUINPCH",71,0)
 ;Remove fields 10 and 12 from file 3.5
"RTN","XUINPCH",72,0)
 F DA=10,12 S DIK="^DD(3.5,",DA(1)=3.5 D ^DIK
"RTN","XUINPCH",73,0)
 ;Remove X-ref from SUBTYPE field.
"RTN","XUINPCH",74,0)
 I $D(^DD(3.5,3,1,1,0)) S DIK="^DD(3.5,3,1,",DA=1,DA(1)=3,DA(2)=3.5 D ^DIK
"RTN","XUINPCH",75,0)
 Q
"RTN","XUPARAM")
0^18^B1956835
"RTN","XUPARAM",1,0)
XUPARAM ;SF/RWF - Lookup parameter substitute ;12/9/96  09:20
"RTN","XUPARAM",2,0)
 ;;8.0;KERNEL;**65**;Jul 10, 1995
"RTN","XUPARAM",3,0)
 Q
"RTN","XUPARAM",4,0)
GET(%X,STYLE) ;Get substitute value
"RTN","XUPARAM",5,0)
 ;Style, N will return call name as default
"RTN","XUPARAM",6,0)
 ;       V will return null as default
"RTN","XUPARAM",7,0)
 ;otherwize will return zero as default
"RTN","XUPARAM",8,0)
 N %1,%2,%Y S STYLE=$G(STYLE),%Y=$S(STYLE="N":%X,STYLE="V":"",1:0)
"RTN","XUPARAM",9,0)
 S %1=$$LKUP(%X) I %1'>0 Q %Y
"RTN","XUPARAM",10,0)
 S %2=$G(^XTV(8989.2,%1,0))
"RTN","XUPARAM",11,0)
 I $P(%2,"^",4)]"" Q $P(%2,"^",4)
"RTN","XUPARAM",12,0)
 I $P(%2,"^",3)]"" Q $P(%2,"^",3)
"RTN","XUPARAM",13,0)
 Q %Y
"RTN","XUPARAM",14,0)
SET(%X,VALUE) ;Set parameter value
"RTN","XUPARAM",15,0)
 N %1
"RTN","XUPARAM",16,0)
 S %1=$$LKUP(%X,"A") Q:%1'>0
"RTN","XUPARAM",17,0)
 Q:'$D(VALUE)
"RTN","XUPARAM",18,0)
 S $P(^XTV(8989.2,%1,0),"^",4)=VALUE
"RTN","XUPARAM",19,0)
 Q
"RTN","XUPARAM",20,0)
LKUP(X,ACTION) ;
"RTN","XUPARAM",21,0)
 N E
"RTN","XUPARAM",22,0)
 S E=$O(^XTV(8989.2,"B",X,0)) I E>0 Q E
"RTN","XUPARAM",23,0)
 I $G(ACTION)'["A" Q -1
"RTN","XUPARAM",24,0)
 N DA,DIC,DLAYGO,Y
"RTN","XUPARAM",25,0)
 S DIC="^XTV(8989.2,",DIC(0)="ML",DLAYGO=8989.2 D FILE^DICN
"RTN","XUPARAM",26,0)
 Q +Y
"RTN","XUPARAM",27,0)
KSP(NAME) ;To return data from KSP file.
"RTN","XUPARAM",28,0)
 N NM S NM=$P(NAME," ")
"RTN","XUPARAM",29,0)
 Q:$T(@NM)="" ""  G @NM
"RTN","XUPARAM",30,0)
SPOOL Q $P($G(^XTV(8989.3,1,"SPL")),"^",$S(NAME["LINE":1,NAME["DOC":2,NAME["LIFE":3,1:1))
"RTN","XUPARAM",31,0)
WHERE Q $G(^XMB("NETNAME"))
"RTN","XUPARAM",32,0)
INST Q $P($G(^XTV(8989.3,1,"XUS")),U,17)
"RTN","XUPARAM",33,0)
LIFETIME Q $P($G(^XTV(8989.3,1,"XUS")),U,15) ;Verify code lifetime
"RTN","XUS91")
0^21^B12562792
"RTN","XUS91",1,0)
XUS91 ;SF/STAFF -  REPORT OF USERS SIGNED ON ;9/18/97  14:24
"RTN","XUS91",2,0)
 ;;8.0;KERNEL;**18,65**;Jul 10, 1995
"RTN","XUS91",3,0)
 S U="^",XUSUCI="" I $D(^%ZOSF("UCI")) X ^%ZOSF("UCI") S XUSUCI=Y
"RTN","XUS91",4,0)
 S XQHDR="    USER STATUS REPORT      "_XUSUCI
"RTN","XUS91",5,0)
 S %H=$H D YMD^%DTC S DT=X
"RTN","XUS91",6,0)
 W !,"Lookup pass " K ^TMP($J) S XQJN=0
"RTN","XUS91",7,0)
 F I=0:0 S XQJN=$O(^XUTL("XQ",XQJN)) Q:XQJN'>0  S X=XQJN X ^%ZOSF("JOBPARAM") S XQK=$P(Y,U,1) D:(XUSUCI=XQK)!(XQK="UNKNOWN") PASS1
"RTN","XUS91",8,0)
 S IOP="" D ^%ZIS K IOP S XQPG=0,XQUI=0 D NEWPG
"RTN","XUS91",9,0)
PRINT S XQUN=-1 F I=0:0 S XQUN=$O(^TMP($J,XQUN)) Q:(XQUN="")!XQUI  S XQJN=0 F J=0:0 S XQJN=$O(^TMP($J,XQUN,XQJN)) Q:(XQJN="")!XQUI  S XQV=^(XQJN) D LIST
"RTN","XUS91",10,0)
 G END
"RTN","XUS91",11,0)
PASS1 ;
"RTN","XUS91",12,0)
 W "." S XQUN="UNKNOWN" I $D(^XUTL("XQ",XQJN,"DUZ")) S XQUN=^("DUZ"),XQUN=$S($D(^VA(200,XQUN,0)):$P(^(0),U,1),1:"UNKNOWN")
"RTN","XUS91",13,0)
 S XQV="UNKNOWN" I $D(^XUTL("XQ",XQJN,0)) S XQV=$P(^(0),".",2)_"00",XQV=$E(XQV,1,2)_":"_$E(XQV,3,4)
"RTN","XUS91",14,0)
 S XQV=XQV_U_$S('$D(^XUTL("XQ",XQJN,"IO")):"UNKNOWN",1:^("IO"))
"RTN","XUS91",15,0)
 S XQK="UNKNOWN" I $D(^XUTL("XQ",XQJN,"T")),^("T") S XQK=^("T") I $D(^(XQK)) S XQK=$E($P(^(XQK),U,3),1,29)
"RTN","XUS91",16,0)
 I XQK="UNKNOWN",$D(^XUTL("XQ",XQJN,"ZTSK")) S XQJ=^("ZTSK") S:$D(^("XQM")) XQJ=$P(^DIC(19,^("XQM"),0),U,2) S XQK=$E(XQJ,1,18)_" *Tasked"
"RTN","XUS91",17,0)
 S ^TMP($J,XQUN,XQJN)=XQV_U_XQK
"RTN","XUS91",18,0)
 Q
"RTN","XUS91",19,0)
LIST ;
"RTN","XUS91",20,0)
 D:$Y>19 NEWPG Q:XQUI  S (X,Y)=XQJN,X1=16 S:X>32768 Y=$$CNV^XLFUTL(X,16)
"RTN","XUS91",21,0)
 W !,Y,?12,$E(XQUN,1,19),?33,$P(XQV,U,1),?42,$P(XQV,U,2) W:$X>49 ! W ?50,$P(XQV,U,3,99)
"RTN","XUS91",22,0)
 Q
"RTN","XUS91",23,0)
NEWPG ;
"RTN","XUS91",24,0)
 I XQPG,$E(IOST,1)="C" D CON S XQUI=(X="^") Q:XQUI
"RTN","XUS91",25,0)
 D HDR Q
"RTN","XUS91",26,0)
CON ;
"RTN","XUS91",27,0)
 W !!,"Press return to continue or '^' to escape " R X:DTIME S:'$T X=U
"RTN","XUS91",28,0)
 Q
"RTN","XUS91",29,0)
HDR ;
"RTN","XUS91",30,0)
 W @IOF S XQPG=XQPG+1
"RTN","XUS91",31,0)
 S Y=$P($H,",",2)\60,Y=(Y#60/100+(Y\60)/100+DT) D DT^DIO2
"RTN","XUS91",32,0)
 W ?22,XQHDR,?71,"PAGE ",XQPG
"RTN","XUS91",33,0)
 W !!,"JOB NUMBER  USER NAME            TIME ON  DEVICE  CURRENT MENU OPTION"
"RTN","XUS91",34,0)
 W !,"----------  -------------------  -------  ------  ------------------------------"
"RTN","XUS91",35,0)
 Q
"RTN","XUS91",36,0)
END ;
"RTN","XUS91",37,0)
 K XQI,XQJN,XQUN,XUSUCI,ZJ,XQJ,XQK,XQUI,XQPG,XQHDR,XQV,D,J,X,XQM,XQT,Y,Z,^TMP($J)
"RTN","XUS91",38,0)
 Q
"RTN","XUS91",39,0)
 Q
"RTN","XUS91",40,0)
TESTM ;
"RTN","XUS91",41,0)
 W !!,"This option will allow you to simulate signing on as another user to test their",!,"menus and keys.  You can step through menus, but cannot execute options.",!,"Return to your own identity by entering a '*'.",!
"RTN","XUS91",42,0)
 S DIC=200,DIC(0)="AEQMZ" D ^DIC Q:Y<0
"RTN","XUS91",43,0)
 I $S('$D(^VA(200,+Y,201)):1,($P(^VA(200,+Y,201),U,1)=""):1,1:0) W !!,*7,"This user has no primary menu." Q
"RTN","XUS91",44,0)
 S XQY=+^VA(200,+Y,201),DUZ("SAV")=DUZ_U_DUZ(0),DUZ=+Y,DUZ(0)=$P(Y(0),U,4),%=$P(^VA(200,+Y,0),U,1),DUZ("SAV")=DUZ("SAV")_U_$P(%,",",2)_" "_$P(%,",",1) G ^XQ
"RTN","XUS91",45,0)
 Q
"RTN","XUS91",46,0)
TESTN ;
"RTN","XUS91",47,0)
 S DUZ=+DUZ("SAV"),DUZ(0)=$P(DUZ("SAV"),U,2),XQY=+^VA(200,DUZ,201) K DUZ("SAV"),XQUR,XMDUZ
"RTN","XUS91",48,0)
 W !!,"OK...  Returning to your own identity." L  ;Clear all locks
"RTN","XUS91",49,0)
 G ^XQ
"RTN","XUTMG43")
0^19^B1658564
"RTN","XUTMG43",1,0)
XUTMG43 ;SEA/RDS - TaskMan: Globals: X-Refs For File 8989.3 ;05/09/97  10:57
"RTN","XUTMG43",2,0)
 ;;8.0;KERNEL;**18,65**;Jul 03, 1995
"RTN","XUTMG43",3,0)
 ;
"RTN","XUTMG43",4,0)
SET ;set logic entry point
"RTN","XUTMG43",5,0)
 N ZTLOG S ZTLOG=(X="Y") G UPDATE
"RTN","XUTMG43",6,0)
 ;
"RTN","XUTMG43",7,0)
KILL ;kill logic entry point
"RTN","XUTMG43",8,0)
 N ZTLOG S ZTLOG=0 G UPDATE
"RTN","XUTMG43",9,0)
 ;
"RTN","XUTMG43",10,0)
UPDATE ;shared logic for MUMPS X-ref: Tell MGR to adjust resource logging
"RTN","XUTMG43",11,0)
 N X,ZTM,ZTN,ZTV
"RTN","XUTMG43",12,0)
 S ZTV=0
"RTN","XUTMG43",13,0)
 I $D(^%ZTSCH) D
"RTN","XUTMG43",14,0)
 . L +^%ZTSCH("LOGRSRC") S:ZTLOG ^%ZTSCH("LOGRSRC")=1 K:'ZTLOG ^%ZTSCH("LOGRSRC") L -^[ZTM,ZTN]%ZTSCH("LOGRSRC")
"RTN","XUTMG43",15,0)
U1 ;
"RTN","XUTMG43",16,0)
 F  S ZTV=$O(^%ZIS(14.5,ZTV)) Q:'ZTV  D
"RTN","XUTMG43",17,0)
 . S ZTREC=$G(^%ZIS(14.5,ZTV,0))
"RTN","XUTMG43",18,0)
 . I ZTREC="" Q
"RTN","XUTMG43",19,0)
 . I $P(ZTREC,U,3)="N" Q
"RTN","XUTMG43",20,0)
 . I $P(ZTREC,U,4)="Y" Q
"RTN","XUTMG43",21,0)
 . S X="TRAP^XUTMG43",@^%ZOSF("TRAP")
"RTN","XUTMG43",22,0)
 . S ZTN=$P(ZTREC,U)
"RTN","XUTMG43",23,0)
 . S ZTM=$P(ZTREC,U,6)
"RTN","XUTMG43",24,0)
 . I '$D(^[ZTM,ZTN]%ZTSCH) Q
"RTN","XUTMG43",25,0)
 . L +^[ZTM,ZTN]%ZTSCH("LOGRSRC")
"RTN","XUTMG43",26,0)
 . I ZTLOG S ^[ZTM,ZTN]%ZTSCH("LOGRSRC")=1
"RTN","XUTMG43",27,0)
 . E  K ^[ZTM,ZTN]%ZTSCH("LOGRSRC")
"RTN","XUTMG43",28,0)
 . L -^[ZTM,ZTN]%ZTSCH("LOGRSRC") Q
"RTN","XUTMG43",29,0)
 Q
"RTN","XUTMG43",30,0)
 ;
"RTN","XUTMG43",31,0)
TRAP ;UPDATE--trap link errors, which represent unaccessible links
"RTN","XUTMG43",32,0)
 G U1
"RTN","XUTMG43",33,0)
 ;
"RTN","XUWORKDY")
0^20^B1646710
"RTN","XUWORKDY",1,0)
XUWORKDY ;SF/GJL - WORKDAYS ;05/05/97  11:27
"RTN","XUWORKDY",2,0)
 ;;8.0;KERNEL;**65**;Jul 10, 1995
"RTN","XUWORKDY",3,0)
 ;X,X1 are any two dates (YYYMMDD). X=Working Days Between
"RTN","XUWORKDY",4,0)
A N %A,%B,%D,%H,%I,%J,%K,%M,%Y,%Z
"RTN","XUWORKDY",5,0)
 S %A=X,%B=X1,%Z=1 I %A>%B S X=%B,%B=%A,%A=X,%Z=-1
"RTN","XUWORKDY",6,0)
 S X=%A D HDTC I %Y<0 S X="" G EXIT ;Imprecise date
"RTN","XUWORKDY",7,0)
 S %J=%H,X=%B D HDTC I %Y<0 S X="" G EXIT
"RTN","XUWORKDY",8,0)
 S %K=%H,%H=0,X=(%J+3#7>4)&(%K+3#7>4) ;I $O(^HOLIDAY(2000000))'>0 S X="" G EXIT
"RTN","XUWORKDY",9,0)
 S %Y=%A-1 F %I=1:1 S %Y=$O(^HOLIDAY(%Y)) Q:(%Y'>0)!(%Y>%B)  S %H=%H+1
"RTN","XUWORKDY",10,0)
 F %J=%J:1 S %Y=%J#7 Q:((%Y=3)!(%J=%K))  S:%Y-2 X=X+1
"RTN","XUWORKDY",11,0)
 F %K=%K:-1 S %Y=%K#7 Q:((%Y=3)!(%K=%J))  S:%Y-2 X=X+1
"RTN","XUWORKDY",12,0)
 S %I=%K-%J I '%I S %Y=%J#7 S:(%Y'=2)&(%Y'=3) X=X+1
"RTN","XUWORKDY",13,0)
 S X=(X+%I-%H-(%I\7*2))*%Z S:X X=X-%Z
"RTN","XUWORKDY",14,0)
EXIT K X1
"RTN","XUWORKDY",15,0)
 Q
"RTN","XUWORKDY",16,0)
HDTC ;Taken from H^%DTC
"RTN","XUWORKDY",17,0)
 S %Y=$E(X,1,3),%M=$E(X,4,5),%D=$E(X,6,7) I '%M!'%D S %Y=-1 Q
"RTN","XUWORKDY",18,0)
 S %H=%M>2&'(%Y#4)+$P("^31^59^90^120^151^181^212^243^273^304^334","^",%M)+%D
"RTN","XUWORKDY",19,0)
 S %Y=%Y-141,%H=%H+(%Y*365)+(%Y\4)-(%Y>59),%Y=%H+4#7
"RTN","XUWORKDY",20,0)
 Q
"RTN","XUWORKDY",21,0)
EN(X,X1) ;Function entry point
"RTN","XUWORKDY",22,0)
 D A Q X
"RTN","ZISHMSM")
0^11^B30406588
"RTN","ZISHMSM",1,0)
%ZISH ;IHS\PR,SFISC/AC - Host File Control for MSM ;11/25/97  10:45
"RTN","ZISHMSM",2,0)
 ;;8.0;KERNEL;**24,36,49,65**;JUL 10, 1995
"RTN","ZISHMSM",3,0)
 ;
"RTN","ZISHMSM",4,0)
OPEN(X1,X2,X3,X4,X5)    ;SR. Open Host File
"RTN","ZISHMSM",5,0)
 ;X1=handle name
"RTN","ZISHMSM",6,0)
 ;X2=directory name \dir\
"RTN","ZISHMSM",7,0)
 ;X3=file name
"RTN","ZISHMSM",8,0)
 ;X4=file access mode e.g.: W for write, R for read, A for append, B for block.
"RTN","ZISHMSM",9,0)
 ;X5=Max record size for a new file
"RTN","ZISHMSM",10,0)
 N %,%1,%2,%I,%P1,%P2,%P6,%T,%ZA,%ZISHIO
"RTN","ZISHMSM",11,0)
 S %I=$I,%T=0,POP=0,X2=$$DEFDIR($G(X2)),%Q=$C(34) M %ZISHIO=IO
"RTN","ZISHMSM",12,0)
 S %P2=$S(X4["RW":"RW",X4["W":"W",X4["N":"W",1:"R")
"RTN","ZISHMSM",13,0)
 S %P1=X2_X3,%P6=$S(X4["B":%Q_%Q,1:$C(13,10))
"RTN","ZISHMSM",14,0)
 F %2=51:1:54 I '$D(IO(1,%2)) O %2:(%P1:%P2::::%P6):0 I $T S %T=%2 Q
"RTN","ZISHMSM",15,0)
 I '%T S POP=1 Q
"RTN","ZISHMSM",16,0)
 ;S %1=$$MODE^%ZISF(X2_X3,X4)
"RTN","ZISHMSM",17,0)
 U %2 S %ZA=$ZA
"RTN","ZISHMSM",18,0)
 I %ZA=-1 U:%I]"" %I C %2 S POP=1 Q
"RTN","ZISHMSM",19,0)
 S IO=%2,IO(1,IO)="",IOT="HFS",POP=0
"RTN","ZISHMSM",20,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHMSM",21,0)
 Q
"RTN","ZISHMSM",22,0)
 ;
"RTN","ZISHMSM",23,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHMSM",24,0)
 ;X=HANDLE NAME, IO=Device
"RTN","ZISHMSM",25,0)
 N %
"RTN","ZISHMSM",26,0)
 I $G(IO)]"" C IO K IO(1,IO)
"RTN","ZISHMSM",27,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHMSM",28,0)
 D HOME^%ZIS
"RTN","ZISHMSM",29,0)
 Q
"RTN","ZISHMSM",30,0)
 ;
"RTN","ZISHMSM",31,0)
OPENERR ;
"RTN","ZISHMSM",32,0)
 Q 0
"RTN","ZISHMSM",33,0)
 ;
"RTN","ZISHMSM",34,0)
DEL(%ZX1,%ZX2) ;SR. Del fl(s)
"RTN","ZISHMSM",35,0)
 ;S Y=$$DEL^ZOSHMSM("\dir\","fl")
"RTN","ZISHMSM",36,0)
 ;                         ,.array)
"RTN","ZISHMSM",37,0)
 ;Changed %ZX2 to a $NAME string
"RTN","ZISHMSM",38,0)
 N %,%ZH,ZOSHDA,ZOSHF,ZOSHX,ZOSHQ,ZOSHDF,ZOSHC
"RTN","ZISHMSM",39,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHMSM",40,0)
 ;Get fls to act on
"RTN","ZISHMSM",41,0)
 ;No '*' allowed
"RTN","ZISHMSM",42,0)
 S %ZH="" F  S %ZH=$O(@%ZX2@(%ZH)) Q:'%ZH  I %ZH["*" S ZOSHQ=1 Q
"RTN","ZISHMSM",43,0)
 Q:$D(ZOSHQ) 0
"RTN","ZISHMSM",44,0)
 S %ZH="" F   S %ZH=$O(@%ZX2@(%ZH)) Q:%ZH=""  D
"RTN","ZISHMSM",45,0)
 .;S ZOSHC="rm "_X1_%
"RTN","ZISHMSM",46,0)
 .S ZOSHC=$ZOS(2,%ZX1_%ZH) ;Use system function to delete file
"RTN","ZISHMSM",47,0)
 Q 1
"RTN","ZISHMSM",48,0)
 ;
"RTN","ZISHMSM",49,0)
LIST(%ZX1,%ZX2,%ZX3) ;SR. Create a local array holding fl names
"RTN","ZISHMSM",50,0)
 ;S Y=$$LIST^ZOSHDOS("\dir\","fl",".return array")
"RTN","ZISHMSM",51,0)
 ;                           "fl*",
"RTN","ZISHMSM",52,0)
 ;                           .array,
"RTN","ZISHMSM",53,0)
 ;
"RTN","ZISHMSM",54,0)
 ;Change X2 = $NAME OF CLOSE ROOT
"RTN","ZISHMSM",55,0)
 ;Change X3 = $NAME OF CLOSE ROOT
"RTN","ZISHMSM",56,0)
 ;
"RTN","ZISHMSM",57,0)
 N %ZISH,%ZISHN,%ZX,%ZISHY
"RTN","ZISHMSM",58,0)
 S %ZISHN=0,%ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHMSM",59,0)
 ;Get fls to act on
"RTN","ZISHMSM",60,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHMSM",61,0)
 .S %ZX=%ZX1_%ZISH
"RTN","ZISHMSM",62,0)
 .F %ZISHN=1:1 D  Q:$P(%ZISHY,"^")=""!(%ZISHY<0)  S @%ZX3@($P(%ZISHY,"^"))="" ;S @%ZX3@(%ZISHN)=$P(%ZISHY,"^")
"RTN","ZISHMSM",63,0)
 ..I %ZISHN>1 S %ZISHY=$ZOS(13,%ZISHY)
"RTN","ZISHMSM",64,0)
 ..E  S %ZISHY=$ZOS(12,%ZX,0)
"RTN","ZISHMSM",65,0)
 Q $O(@%ZX3@(""))]""
"RTN","ZISHMSM",66,0)
 ;
"RTN","ZISHMSM",67,0)
MV(X1,X2,Y1,Y2) ;SR. Rename a fl
"RTN","ZISHMSM",68,0)
 ;S Y=$$MV^ZOSHDOS("\dir\","fl","\dir\","fl")
"RTN","ZISHMSM",69,0)
 ;
"RTN","ZISHMSM",70,0)
 N %ZB,%ZC,%ZISHDV1,%ZISHDV2,%ZISHFN1,%ZISHFN2,%ZISHPCT,%ZISHSIZ,%ZISHX,X,Y
"RTN","ZISHMSM",71,0)
 S X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHMSM",72,0)
 I X1=Y1 Q $ZOS(3,X,Y)'<0
"RTN","ZISHMSM",73,0)
 S X=X1_X2,Y=Y1_Y2
"RTN","ZISHMSM",74,0)
 ;
"RTN","ZISHMSM",75,0)
 S %ZISHDV1=51,%ZISHDV2=52,%ZISHFN1=X,%ZISHFN2=Y
"RTN","ZISHMSM",76,0)
 O %ZISHDV1:(%ZISHFN1)
"RTN","ZISHMSM",77,0)
 O %ZISHDV2:(%ZISHFN2:"W")
"RTN","ZISHMSM",78,0)
 U %ZISHDV1:(::0:2) S %ZISHSIZ=$ZB U %ZISHDV1:(::0:0) S (%ZISHPCT,%ZB,%ZC)=0
"RTN","ZISHMSM",79,0)
 D SLOWCOPY S %ZISHX(X2)="" S Y=$$DEL^%ZISH(X1,$NA(%ZISHX))
"RTN","ZISHMSM",80,0)
 Q 1
"RTN","ZISHMSM",81,0)
 ;
"RTN","ZISHMSM",82,0)
SLOWCOPY ; Copy without view buffer
"RTN","ZISHMSM",83,0)
 N X,Y
"RTN","ZISHMSM",84,0)
 O %ZISHDV1:(%ZISHFN1:"R"::::""),%ZISHDV2:(%ZISHFN2:"W"::::"")
"RTN","ZISHMSM",85,0)
 FOR  DO  Q:%ZC!(%ZB=%ZISHSIZ)
"RTN","ZISHMSM",86,0)
 . U %ZISHDV1 R X#1024 Q:$L(X)=0
"RTN","ZISHMSM",87,0)
 . U %ZISHDV2 W X S %ZB=$ZB,%ZC=$ZC Q:%ZC
"RTN","ZISHMSM",88,0)
 . I %ZB=%ZISHSIZ C %ZISHDV2 S %ZC=($ZA=-1)
"RTN","ZISHMSM",89,0)
 . S X=%ZB/%ZISHSIZ*100\1 ; %done
"RTN","ZISHMSM",90,0)
 . Q:X=%ZISHPCT  S %ZISHPCT=X
"RTN","ZISHMSM",91,0)
 . Q  ;U 0 W $J(%ZISHPCT,3),*13
"RTN","ZISHMSM",92,0)
 Q
"RTN","ZISHMSM",93,0)
 ;
"RTN","ZISHMSM",94,0)
PWD() ;SR. Print working directory
"RTN","ZISHMSM",95,0)
 N Y
"RTN","ZISHMSM",96,0)
 S Y=$ZOS(11,$ZOS(14))
"RTN","ZISHMSM",97,0)
 Q:Y<0 ""
"RTN","ZISHMSM",98,0)
 S Y=Y_$S($E(Y,$L(Y))'="\":"\",1:"")
"RTN","ZISHMSM",99,0)
 Q $ZOS(14)_":"_Y
"RTN","ZISHMSM",100,0)
 ;
"RTN","ZISHMSM",101,0)
JW ;Call dos $ZOS
"RTN","ZISHMSM",102,0)
 S ZOSHX=$ZOS(ZOSHNUM,ZOSHC)
"RTN","ZISHMSM",103,0)
 Q
"RTN","ZISHMSM",104,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHMSM",105,0)
 Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHMSM",106,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV")) S DF=$TR(DF,"/","\")
"RTN","ZISHMSM",107,0)
 I $E(DF,$L(DF))'="\" S DF=DF_"\"
"RTN","ZISHMSM",108,0)
 Q DF
"RTN","ZISHMSM",109,0)
FL(X) ;Fl len
"RTN","ZISHMSM",110,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHMSM",111,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHMSM",112,0)
 I $L(ZOSHP1)>8 S X=4 Q
"RTN","ZISHMSM",113,0)
 I $L(ZOSHP2)>3 S X=4 Q
"RTN","ZISHMSM",114,0)
 Q
"RTN","ZISHMSM",115,0)
READNXT(REC) ;Read any sized record into array.
"RTN","ZISHMSM",116,0)
 N T,I,X,LB
"RTN","ZISHMSM",117,0)
 U IO S LB=$ZB R REC#255 S %ZA=$ZA,%ZB=$ZB,%ZC=$ZC,%ZL=%ZA Q:$$EOF(%ZC)
"RTN","ZISHMSM",118,0)
 Q:%ZA<255
"RTN","ZISHMSM",119,0)
 F I=1:1 S LB=LB+%ZA Q:LB<%ZB  R X#255 S %ZA=$ZA,%ZB=$ZB,%ZC=$ZC Q:$$EOF(%ZC)!('$L(X))  S REC(I)=X
"RTN","ZISHMSM",120,0)
 Q
"RTN","ZISHMSM",121,0)
STATUS() ;SR. Return EOF status
"RTN","ZISHMSM",122,0)
 U $I
"RTN","ZISHMSM",123,0)
 Q $$EOF($ZC)
"RTN","ZISHMSM",124,0)
 ;
"RTN","ZISHMSM",125,0)
EOF(X) ;Eof flag, pass in $ZC
"RTN","ZISHMSM",126,0)
 Q (X=-1)
"RTN","ZISHMSM",127,0)
 ;
"RTN","ZISHMSM",128,0)
READREC(X) ;Read record from host file.
"RTN","ZISHMSM",129,0)
 N Y
"RTN","ZISHMSM",130,0)
 U IO R X S Y=$ZC
"RTN","ZISHMSM",131,0)
 U $P
"RTN","ZISHMSM",132,0)
 Q Y
"RTN","ZISHMSM",133,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHMSM",134,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHMSM",135,0)
 N I,F,MX
"RTN","ZISHMSM",136,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHMSM",137,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHMSM",138,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHMSM",139,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHMSM",140,0)
 I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHMSM",141,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHMSM",142,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHMSM",143,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHMSM",144,0)
 Q
"RTN","ZISHMSM",145,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;SR. Unload contents of host file into global
"RTN","ZISHMSM",146,0)
 ;p1=host file directory 
"RTN","ZISHMSM",147,0)
 ;p2=host file name
"RTN","ZISHMSM",148,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHMSM",149,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHMSM",150,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHMSM",151,0)
 N %ZA,%ZB,%ZC,%ZL,%OVFCNT,%CONT,%XX
"RTN","ZISHMSM",152,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY,POP,%ZISUB
"RTN","ZISHMSM",153,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHMSM",154,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHMSM",155,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHMSM",156,0)
 I POP Q 0
"RTN","ZISHMSM",157,0)
 S X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHMSM",158,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF(%ZC)  D
"RTN","ZISHMSM",159,0)
 . S @%ZISHF=%XX
"RTN","ZISHMSM",160,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHMSM",161,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHMSM",162,0)
 . Q
"RTN","ZISHMSM",163,0)
 D CLOSE() ;Normal exit
"RTN","ZISHMSM",164,0)
 Q 1
"RTN","ZISHMSM",165,0)
 ;
"RTN","ZISHMSM",166,0)
ERREOF D CLOSE() ;Error close and exit
"RTN","ZISHMSM",167,0)
 Q 0
"RTN","ZISHMSM",168,0)
 ;
"RTN","ZISHMSM",169,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Load contents of global to host file.
"RTN","ZISHMSM",170,0)
 ;Previously name LOAD
"RTN","ZISHMSM",171,0)
 ;p1=$NAME of global reference
"RTN","ZISHMSM",172,0)
 ;p2=incrementing subscript
"RTN","ZISHMSM",173,0)
 ;p3=host file directory, p4=host file name
"RTN","ZISHMSM",174,0)
 N %ZISHY,%ZISHOX
"RTN","ZISHMSM",175,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"W")
"RTN","ZISHMSM",176,0)
 Q %ZISHY
"RTN","ZISHMSM",177,0)
 ;
"RTN","ZISHMSM",178,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Append to host file.
"RTN","ZISHMSM",179,0)
 ;
"RTN","ZISHMSM",180,0)
 ;p1=$NAME of global reference
"RTN","ZISHMSM",181,0)
 ;p2=incrementing subscript
"RTN","ZISHMSM",182,0)
 ;p3=host file directory
"RTN","ZISHMSM",183,0)
 ;p4=host file name
"RTN","ZISHMSM",184,0)
 N %ZISHY
"RTN","ZISHMSM",185,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"A")
"RTN","ZISHMSM",186,0)
 Q %ZISHY
"RTN","ZISHMSM",187,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHMSM",188,0)
 ;p1=$NAME of global reference
"RTN","ZISHMSM",189,0)
 ;p2=incrementing subscript
"RTN","ZISHMSM",190,0)
 ;p3=host file directory
"RTN","ZISHMSM",191,0)
 ;p4=host file name
"RTN","ZISHMSM",192,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHS,%ZISHOX,IO,%ZX,Y
"RTN","ZISHMSM",193,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHMSM",194,0)
 D OPEN^%ZISH(,%ZX3,%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHMSM",195,0)
 I POP Q 0
"RTN","ZISHMSM",196,0)
 N X
"RTN","ZISHMSM",197,0)
 S X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHMSM",198,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHMSM",199,0)
 D CLOSE()
"RTN","ZISHMSM",200,0)
 Q 1
"RTN","ZISHMSM",201,0)
 ;
"RTN","ZISHONT")
0^22^B27324349
"RTN","ZISHONT",1,0)
%ZISH ;IHS\PR,SFISC/AC - Host File Control for OpenM for NT ;11/24/97  16:42
"RTN","ZISHONT",2,0)
 ;;8.0;KERNEL;**34,65**;JUL 10, 1995
"RTN","ZISHONT",3,0)
OPEN(X1,X2,X3,X4,X5)    ;SR. Open Host File
"RTN","ZISHONT",4,0)
 ;X1=handle name
"RTN","ZISHONT",5,0)
 ;X2=directory name \dir\
"RTN","ZISHONT",6,0)
 ;X3=file name
"RTN","ZISHONT",7,0)
 ;X4=file access mode e.g.: W for write, R for read, A for append.
"RTN","ZISHONT",8,0)
 ;X5=Max record size for a new file
"RTN","ZISHONT",9,0)
 N %,%1,%2,%I,%T,%ZA,%ZISHIO
"RTN","ZISHONT",10,0)
 S %I=$I,%T=0,POP=0,X2=$$DEFDIR($G(X2)) M %ZISHIO=IO
"RTN","ZISHONT",11,0)
 S %1=$S(X4["A":"AW",X4["W":"WN",1:"R")_$S(X4["B":"U",1:"S") ;$$MODE^%ZISF(X2_X3,X4)
"RTN","ZISHONT",12,0)
 S %=X2_X3 O %:(%1):2 I '$T S POP=1 Q
"RTN","ZISHONT",13,0)
 U % S %ZA=$ZA
"RTN","ZISHONT",14,0)
 I %ZA=-1 U:%I]"" %I C % S POP=1 Q
"RTN","ZISHONT",15,0)
 S IO=%,IO(1,IO)="",IOT="HFS",POP=0
"RTN","ZISHONT",16,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHONT",17,0)
 Q
"RTN","ZISHONT",18,0)
 ;
"RTN","ZISHONT",19,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHONT",20,0)
 ;X=HANDLE NAME
"RTN","ZISHONT",21,0)
 ;IO=Device
"RTN","ZISHONT",22,0)
 N %
"RTN","ZISHONT",23,0)
 I $G(IO)]"" C IO K IO(1,IO)
"RTN","ZISHONT",24,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHONT",25,0)
 D HOME^%ZIS
"RTN","ZISHONT",26,0)
 Q
"RTN","ZISHONT",27,0)
 ;
"RTN","ZISHONT",28,0)
OPENERR ;
"RTN","ZISHONT",29,0)
 Q 0
"RTN","ZISHONT",30,0)
 ;
"RTN","ZISHONT",31,0)
DEL(%ZX1,%ZX2) ;SR. Del fl(s)
"RTN","ZISHONT",32,0)
 ;S Y=$$DEL^ZOSHMSM("\dir\",$NA(array))
"RTN","ZISHONT",33,0)
 N %,%ZISH,ZOSHDA,ZOSHF,ZOSHX,ZOSHQ,ZOSHDF,ZOSHC
"RTN","ZISHONT",34,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHONT",35,0)
 ;Get fls to act on
"RTN","ZISHONT",36,0)
 ;No '*' allowed
"RTN","ZISHONT",37,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:'%ZISH  I %ZISH["*" S ZOSHQ=1 Q
"RTN","ZISHONT",38,0)
 I $D(ZOSHQ) Q 0
"RTN","ZISHONT",39,0)
 S %ZISH="" F   S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",40,0)
 . S %=$S(%ZISH[%ZX1:%ZISH,1:%ZX1_%ZISH)
"RTN","ZISHONT",41,0)
 . S %=$ZF(-1,"del "_%)
"RTN","ZISHONT",42,0)
 Q 1
"RTN","ZISHONT",43,0)
 ;
"RTN","ZISHONT",44,0)
LIST(%ZX1,%ZX2,%ZX3) ;SR. Create a local array holding fl names
"RTN","ZISHONT",45,0)
 ;S Y=$$LIST^ZOSHDOS("\dir\",$NA(array),$NA(return array))
"RTN","ZISHONT",46,0)
 ;
"RTN","ZISHONT",47,0)
 N %ZISH,%ZISHN,%ZX,%ZISHY,%ZY
"RTN","ZISHONT",48,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHONT",49,0)
 ;Get fls to act on
"RTN","ZISHONT",50,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",51,0)
 .S %ZX=%ZX1_%ZISH,%ZISHY=$$UP^XLFSTR($P(%ZX,"*"))
"RTN","ZISHONT",52,0)
 .F %ZISHN=0:1 D  Q:(%ZX="") 
"RTN","ZISHONT",53,0)
 .. S %ZX=$ZSEARCH($S(%ZISHN:"",1:%ZX))
"RTN","ZISHONT",54,0)
 .. Q:(%ZX="")!($$UP^XLFSTR(%ZX)'[%ZISHY)!(%ZX?.E1.2".")
"RTN","ZISHONT",55,0)
 .. S %ZY=$P(%ZX,"\",$L(%ZX,"\")),@%ZX3@(%ZY)=""
"RTN","ZISHONT",56,0)
 Q $O(@%ZX3@(""))]""
"RTN","ZISHONT",57,0)
 ;
"RTN","ZISHONT",58,0)
MV(X1,X2,Y1,Y2) ;SR. Rename a fl
"RTN","ZISHONT",59,0)
 ;S Y=$$MV^ZOSHDOS("\dir\","fl","\dir\","fl")
"RTN","ZISHONT",60,0)
 ;
"RTN","ZISHONT",61,0)
 N %,%ZB,%ZC,%ZISHDV1,%ZISHDV2,%ZISHFN1,%ZISHFN2,%ZISHPCT,%ZISHSIZ,%ZISHX,X,Y
"RTN","ZISHONT",62,0)
 S X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHONT",63,0)
 S X=X1_X2,Y=Y1_Y2
"RTN","ZISHONT",64,0)
 S %=$ZF(-1,"copy "_X1_" "_Y1) ;Use NT copy
"RTN","ZISHONT",65,0)
 S %ZISHX(X2)="" S Y=$$DEL^%ZISH(X1,$NA(%ZISHX))
"RTN","ZISHONT",66,0)
 Q 1
"RTN","ZISHONT",67,0)
 ;
"RTN","ZISHONT",68,0)
 S (%ZISHPCT,%ZB,%ZC)=0
"RTN","ZISHONT",69,0)
 D SLOWCOPY S %ZISHX(X2)="" S Y=$$DEL^%ZISH(X1,$NA(%ZISHX))
"RTN","ZISHONT",70,0)
 Q 1
"RTN","ZISHONT",71,0)
 ;
"RTN","ZISHONT",72,0)
SLOWCOPY ; Copy without view buffer
"RTN","ZISHONT",73,0)
 N X,Y
"RTN","ZISHONT",74,0)
 O %ZISHDV1:(%ZISHFN1:"R"::::""),%ZISHDV2:(%ZISHFN2:"W"::::"")
"RTN","ZISHONT",75,0)
 FOR  DO  Q:%ZC!(%ZB=%ZISHSIZ)
"RTN","ZISHONT",76,0)
 . U %ZISHDV1 R X#1024 Q:$L(X)=0
"RTN","ZISHONT",77,0)
 . U %ZISHDV2 W X S %ZB=$ZB,%ZC=$ZC Q:%ZC
"RTN","ZISHONT",78,0)
 . I %ZB=%ZISHSIZ C %ZISHDV2 S %ZC=($ZA=-1)
"RTN","ZISHONT",79,0)
 . S X=%ZB/%ZISHSIZ*100\1 ; %done
"RTN","ZISHONT",80,0)
 . Q:X=%ZISHPCT  S %ZISHPCT=X
"RTN","ZISHONT",81,0)
 . Q  ;U 0 W $J(%ZISHPCT,3),*13
"RTN","ZISHONT",82,0)
 Q
"RTN","ZISHONT",83,0)
 ;
"RTN","ZISHONT",84,0)
PWD() ;SR. Print working directory
"RTN","ZISHONT",85,0)
 N Y
"RTN","ZISHONT",86,0)
 S Y=$ZSEARCH("*")
"RTN","ZISHONT",87,0)
 Q $P(Y,".",1)
"RTN","ZISHONT",88,0)
 ;
"RTN","ZISHONT",89,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHONT",90,0)
 Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHONT",91,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV")) S DF=$TR(DF,"/","\")
"RTN","ZISHONT",92,0)
 I $E(DF,$L(DF))'="\" S DF=DF_"\"
"RTN","ZISHONT",93,0)
 Q DF
"RTN","ZISHONT",94,0)
DF(X) ;Dir frmt
"RTN","ZISHONT",95,0)
 Q:X=""
"RTN","ZISHONT",96,0)
 S X=$TR(X,"/","\")
"RTN","ZISHONT",97,0)
 I $E(X,$L(X))'="\" S X=X_"\"
"RTN","ZISHONT",98,0)
 Q
"RTN","ZISHONT",99,0)
FL(X) ;Fl len
"RTN","ZISHONT",100,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHONT",101,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHONT",102,0)
 I $L(ZOSHP1)>8 S X=4 Q
"RTN","ZISHONT",103,0)
 I $L(ZOSHP2)>3 S X=4 Q
"RTN","ZISHONT",104,0)
 Q
"RTN","ZISHONT",105,0)
READNXT(REC) ;Read any sized record into array.
"RTN","ZISHONT",106,0)
 N %,I,X S %ZA=0,$ZT="READNX"
"RTN","ZISHONT",107,0)
 U IO R X S %ZB=$A($ZB),REC=$E(X,1,255)
"RTN","ZISHONT",108,0)
 Q:$L(X)<256
"RTN","ZISHONT",109,0)
 S %=256 F I=1:1 Q:$L(X)<%  S REC(I)=$E(X,%,%+254),%=%+255
"RTN","ZISHONT",110,0)
 Q
"RTN","ZISHONT",111,0)
READNX ;Check for EOF
"RTN","ZISHONT",112,0)
 I $ZE["ENDOFFILE" S %ZA=-1
"RTN","ZISHONT",113,0)
 Q
"RTN","ZISHONT",114,0)
STATUS() ;SR. Return EOF status
"RTN","ZISHONT",115,0)
 U $I
"RTN","ZISHONT",116,0)
 Q $$EOF($ZA)
"RTN","ZISHONT",117,0)
 ;
"RTN","ZISHONT",118,0)
EOF(X) ;Eof flag, pass in $ZC
"RTN","ZISHONT",119,0)
 Q (X=-1)
"RTN","ZISHONT",120,0)
 ;
"RTN","ZISHONT",121,0)
READREC(X) ;Read record from host file.
"RTN","ZISHONT",122,0)
 N Y
"RTN","ZISHONT",123,0)
 U IO R X S Y=$ZC
"RTN","ZISHONT",124,0)
 U $P
"RTN","ZISHONT",125,0)
 Q Y
"RTN","ZISHONT",126,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHONT",127,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHONT",128,0)
 N I,F,MX
"RTN","ZISHONT",129,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHONT",130,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHONT",131,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHONT",132,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHONT",133,0)
%ZX I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHONT",134,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHONT",135,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHONT",136,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHONT",137,0)
 Q
"RTN","ZISHONT",138,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;SR. Unload contents of host file into global
"RTN","ZISHONT",139,0)
 ;p1=hostf file directory 
"RTN","ZISHONT",140,0)
 ;p2=host file name
"RTN","ZISHONT",141,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHONT",142,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHONT",143,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHONT",144,0)
 N %ZA,%ZB,X,%OVFCNT,%ZISHF,%ZISHO,POP,%ZISUB
"RTN","ZISHONT",145,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY
"RTN","ZISHONT",146,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHONT",147,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHONT",148,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHONT",149,0)
 I POP Q 0
"RTN","ZISHONT",150,0)
 S X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHONT",151,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF(%ZA)  D
"RTN","ZISHONT",152,0)
 . S @%ZISHF=%XX
"RTN","ZISHONT",153,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHONT",154,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHONT",155,0)
 . Q
"RTN","ZISHONT",156,0)
 D CLOSE() ;Normal exit
"RTN","ZISHONT",157,0)
 Q 1
"RTN","ZISHONT",158,0)
 ;
"RTN","ZISHONT",159,0)
ERREOF D CLOSE() ;Error close and exit
"RTN","ZISHONT",160,0)
 Q 0
"RTN","ZISHONT",161,0)
 ;
"RTN","ZISHONT",162,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Load contents of global to host file.
"RTN","ZISHONT",163,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",164,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",165,0)
 ;p3=host file directory
"RTN","ZISHONT",166,0)
 ;p4=host file name
"RTN","ZISHONT",167,0)
 N %ZISHY,%ZISHOX
"RTN","ZISHONT",168,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"W")
"RTN","ZISHONT",169,0)
 Q %ZISHY
"RTN","ZISHONT",170,0)
 ;
"RTN","ZISHONT",171,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Append to host file.
"RTN","ZISHONT",172,0)
 ;
"RTN","ZISHONT",173,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",174,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",175,0)
 ;p3=host file directory
"RTN","ZISHONT",176,0)
 ;p4=host file name
"RTN","ZISHONT",177,0)
 N %ZISHY
"RTN","ZISHONT",178,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"A")
"RTN","ZISHONT",179,0)
 Q %ZISHY
"RTN","ZISHONT",180,0)
 ;
"RTN","ZISHONT",181,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHONT",182,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",183,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",184,0)
 ;p3=host file directory
"RTN","ZISHONT",185,0)
 ;p4=host file name
"RTN","ZISHONT",186,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHS,%ZISHOX,IO,%ZX,Y
"RTN","ZISHONT",187,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHONT",188,0)
 D OPEN^%ZISH(,$G(%ZX3),%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHONT",189,0)
 I POP Q 0
"RTN","ZISHONT",190,0)
 N X
"RTN","ZISHONT",191,0)
 S X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHONT",192,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHONT",193,0)
 D CLOSE()
"RTN","ZISHONT",194,0)
 Q 1
"RTN","ZISHONT",195,0)
 ;
"RTN","ZISHVXD")
0^23^B39451042
"RTN","ZISHVXD",1,0)
ZISHVXD ;IHS/PR - VAX DSM Host file Control ;11/19/97  15:51
"RTN","ZISHVXD",2,0)
 ;;8.0;KERNEL;**24,36,65**;JUL 10, 1995
"RTN","ZISHVXD",3,0)
 ;
"RTN","ZISHVXD",4,0)
OPENERR ;
"RTN","ZISHVXD",5,0)
 Q 0
"RTN","ZISHVXD",6,0)
 ;
"RTN","ZISHVXD",7,0)
OPEN(X1,X2,X3,X4,X5) ;SR. Open file
"RTN","ZISHVXD",8,0)
 ;X1=handle name
"RTN","ZISHVXD",9,0)
 ;X2=directory
"RTN","ZISHVXD",10,0)
 ;X3=filename
"RTN","ZISHVXD",11,0)
 ;X4=access mode
"RTN","ZISHVXD",12,0)
 ;X5=new file max record size
"RTN","ZISHVXD",13,0)
 ;
"RTN","ZISHVXD",14,0)
 N %,%1,%2,%IO,%I2,%P,%T,X,Y
"RTN","ZISHVXD",15,0)
 S X="OPNERR^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",16,0)
 S X2=$$DEFDIR($G(X2)),X4=$$UP^XLFSTR(X4)
"RTN","ZISHVXD",17,0)
 S Y=$S(X4["A":"",X4["R":"READONLY",X4["W":"NEWVERSION",1:"READONLY")
"RTN","ZISHVXD",18,0)
 S Y=Y_$S($G(X5)&(X4["W"):":RECORDSIZE="_+X5,X4["B":":BLOCKSIZE=512",1:"")
"RTN","ZISHVXD",19,0)
 S:$E(Y)=":" Y=$E(Y,2,999) S %IO=X2_X3,%I2="%IO:("_Y_"):3"
"RTN","ZISHVXD",20,0)
 O @%I2 S %T=$T
"RTN","ZISHVXD",21,0)
 I '%T S POP=1 Q
"RTN","ZISHVXD",22,0)
 S IO=%IO,IO(1,IO)="",IOT="HFS",POP=0
"RTN","ZISHVXD",23,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHVXD",24,0)
 U IO:NOTRAP U $P ;Enable use of $ZA to test EOF condition.
"RTN","ZISHVXD",25,0)
 Q
"RTN","ZISHVXD",26,0)
OPNERR ;error on open
"RTN","ZISHVXD",27,0)
 S POP=1
"RTN","ZISHVXD",28,0)
 U:$G(%P)]"" %P
"RTN","ZISHVXD",29,0)
 Q
"RTN","ZISHVXD",30,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHVXD",31,0)
 ;X1=Handle name, IO=device
"RTN","ZISHVXD",32,0)
 I IO]"" C IO K IO(1,IO)
"RTN","ZISHVXD",33,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHVXD",34,0)
 D HOME^%ZIS
"RTN","ZISHVXD",35,0)
 Q
"RTN","ZISHVXD",36,0)
DEL(%ZX1,%ZX2) ;SR. Del fl(s)
"RTN","ZISHVXD",37,0)
 ;S Y=$$DEL^ZOSHMSM("/dir/",namevalue)
"RTN","ZISHVXD",38,0)
 N %ZISH,%ZISHLGR,%ZXIT,X
"RTN","ZISHVXD",39,0)
 N $ETRAP S $ZT="DELERR^%ZISH"
"RTN","ZISHVXD",40,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHVXD",41,0)
 ;Get fls to act on
"RTN","ZISHVXD",42,0)
 ;No '*' allowed
"RTN","ZISHVXD",43,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:'%ZISH  I %ZISH["*" S %ZXIT=1 Q
"RTN","ZISHVXD",44,0)
 Q:$D(%ZXIT) 0
"RTN","ZISHVXD",45,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  S %ZX=%ZX1_%ZISH D
"RTN","ZISHVXD",46,0)
 .O %ZX:READONLY:0 I $T C %ZX:DELETE
"RTN","ZISHVXD",47,0)
 Q 1
"RTN","ZISHVXD",48,0)
DELERR ;TRAP READ/DELETE ERROR
"RTN","ZISHVXD",49,0)
 Q 0
"RTN","ZISHVXD",50,0)
 ;%ZX
"RTN","ZISHVXD",51,0)
LIST(%ZX1,%ZX2,%ZX3) ;SR. Set local array holding fl names
"RTN","ZISHVXD",52,0)
 ;S Y=$$LIST^ZOSHMSM("/dir/","list_root","return_root")
"RTN","ZISHVXD",53,0)
 ;list_root can have XX("A*"), XX("test.com")...
"RTN","ZISHVXD",54,0)
 ;Both arrays passed as $NA values (closed roots).
"RTN","ZISHVXD",55,0)
 ;--------------------------------------
"RTN","ZISHVXD",56,0)
 N %IO,%X,%ZISH,%ZISH1,%ZISHIO,%ZX,POP,X,ZISHAUTO,ZISHTMP
"RTN","ZISHVXD",57,0)
 M %ZISHIO=IO N $ETRAP S $ETRAP="",%ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHVXD",58,0)
 S %IO=$I,ZISHAUTO="ZISH"_$J_".TMPA",ZISHTMP="ZISH"_$J_".TMPB"
"RTN","ZISHVXD",59,0)
 S $ZT="SPAWNERR^%ZISH"
"RTN","ZISHVXD",60,0)
 ;Init ZISHAUTO, ZISHTMP by deleteing them
"RTN","ZISHVXD",61,0)
 ;O ZISHAUTO::0 I  C ZISHAUTO:DELETE
"RTN","ZISHVXD",62,0)
 ;O ZISHTMP::0 I  C ZISHTMP:DELETE
"RTN","ZISHVXD",63,0)
 I $ZSEARCH(ZISHAUTO)["ZISH" S Y=$&ZLIB.%SPAWN("DEL "_ZISHAUTO_";*")
"RTN","ZISHVXD",64,0)
 I $ZSEARCH(ZISHTMP)["ZISH" S Y=$&ZLIB.%SPAWN("DEL "_ZISHTMP_";*")
"RTN","ZISHVXD",65,0)
 ;Get fls to act on
"RTN","ZISHVXD",66,0)
 ;Append listing to ZISHAUTO
"RTN","ZISHVXD",67,0)
 S %ZISH1=0,%ZISH=""
"RTN","ZISHVXD",68,0)
 F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  S Y=$$LIST1(%ZX1_%ZISH)
"RTN","ZISHVXD",69,0)
 ;I $ZSEARCH(ZISHTMP)]"" S Y=$&ZLIB.%SPAWN("DEL "_ZISHTMP_";*")
"RTN","ZISHVXD",70,0)
 ;Open ZISHAUTO.$J to read.
"RTN","ZISHVXD",71,0)
 D OPEN(,"",ZISHAUTO,"R") I POP Q 0
"RTN","ZISHVXD",72,0)
 S X="LSTEOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",73,0)
 U ZISHAUTO:NOTRAP R %ZX,%ZX,%ZX
"RTN","ZISHVXD",74,0)
 I $ZA=-1 Q
"RTN","ZISHVXD",75,0)
 F  R %ZX G LSTEOF:$ZA=-1 I %ZX]"" S %X=$P(%ZX,$C(32)) D
"RTN","ZISHVXD",76,0)
 . I %ZX'["Total of",%ZX'?.E1".DIR;".N,%ZX'?1"Directory".E D
"RTN","ZISHVXD",77,0)
 . . I (%X[ZISHAUTO)!(%X[ZISHTMP) Q
"RTN","ZISHVXD",78,0)
 . . S @%ZX3@(%X)=""
"RTN","ZISHVXD",79,0)
LSTEOF C ZISHAUTO:DELETE
"RTN","ZISHVXD",80,0)
 U:$D(IO(1,%IO)) %IO
"RTN","ZISHVXD",81,0)
 K IO M IO=%ZISHIO
"RTN","ZISHVXD",82,0)
 I $ZSEARCH(ZISHTMP)]"" S Y=$&ZLIB.%SPAWN("DEL "_ZISHTMP_";*")
"RTN","ZISHVXD",83,0)
 I $ZSEARCH(ZISHAUTO)]"" S Y=$&ZLIB.%SPAWN("DEL "_ZISHAUTO_";*")
"RTN","ZISHVXD",84,0)
 Q ($Q(@%ZX3)]"")
"RTN","ZISHVXD",85,0)
 ;
"RTN","ZISHVXD",86,0)
LIST1(%ZX) ;Get one part of the list
"RTN","ZISHVXD",87,0)
 S $ZT="LSTERR^%ZISH"
"RTN","ZISHVXD",88,0)
 I %ZISH1 D
"RTN","ZISHVXD",89,0)
 . S Y=$&ZLIB.%SPAWN("DIR/COL=1 "_%ZX,,ZISHTMP)
"RTN","ZISHVXD",90,0)
 . I Y S Y=$&ZLIB.%SPAWN("APPEND "_ZISHTMP_" "_ZISHAUTO)
"RTN","ZISHVXD",91,0)
 I '%ZISH1 S Y=$&ZLIB.%SPAWN("DIR/COL=1 "_%ZX,,ZISHAUTO),%ZISH1=1
"RTN","ZISHVXD",92,0)
 Q 1
"RTN","ZISHVXD",93,0)
LSTERR ;Error in list
"RTN","ZISHVXD",94,0)
 I $ZSEARCH(ZISHTMP)["ZISH" S Y=$&ZLIB.%SPAWN("DEL "_ZISHTMP_";*")
"RTN","ZISHVXD",95,0)
 Q 0
"RTN","ZISHVXD",96,0)
 ;
"RTN","ZISHVXD",97,0)
SPAWNERR ;TRAP ERROR OF SPAWN
"RTN","ZISHVXD",98,0)
 O ZISHAUTO:READONLY:1
"RTN","ZISHVXD",99,0)
 I $T C ZISHAUTO:DELETE
"RTN","ZISHVXD",100,0)
 Q 0
"RTN","ZISHVXD",101,0)
 ;
"RTN","ZISHVXD",102,0)
MV(X1,X2,Y1,Y2) ;SR. Rename a fl
"RTN","ZISHVXD",103,0)
 ;S Y=$$MV^ZOSHMSM("/dir/","fl","/dir/","fl")
"RTN","ZISHVXD",104,0)
 N X,ZISHAUTO
"RTN","ZISHVXD",105,0)
 S ZISHAUTO="ZISH"_$J_".TMPA",X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHVXD",106,0)
 S X="SPAWNERR^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",107,0)
 ;Pbv or qit
"RTN","ZISHVXD",108,0)
 I $O(X2(0))!$O(X4(0)) X "I $G(%ZISHLGR)]"""",$D(@%ZISHLGR)" Q 0
"RTN","ZISHVXD",109,0)
 I X1=Y1 D
"RTN","ZISHVXD",110,0)
 .O @(""""_X1_X2_"""")
"RTN","ZISHVXD",111,0)
 .C @(""""_X1_X2_""":RENAME="_""""_Y1_Y2_"""")
"RTN","ZISHVXD",112,0)
 E  D
"RTN","ZISHVXD",113,0)
 .S Y=$&ZLIB.%SPAWN("COPY "_X1_X2_" "_Y1_Y2,,ZISHAUTO)
"RTN","ZISHVXD",114,0)
 .O ZISHAUTO:READONLY:1
"RTN","ZISHVXD",115,0)
 .I $T C ZISHAUTO:DELETE
"RTN","ZISHVXD",116,0)
 .S X=$&ZLIB.%PARSE(X1_X2)
"RTN","ZISHVXD",117,0)
 .S Y=$&ZLIB.%SPAWN("DEL "_X,,ZISHAUTO)
"RTN","ZISHVXD",118,0)
 .O ZISHAUTO:READONLY:1
"RTN","ZISHVXD",119,0)
 .I $T C ZISHAUTO:DELETE
"RTN","ZISHVXD",120,0)
 Q 1
"RTN","ZISHVXD",121,0)
PWD() ;SR. Print working directory
"RTN","ZISHVXD",122,0)
 N Y
"RTN","ZISHVXD",123,0)
 S Y=$&ZLIB.%PARSE("TMP.TMP",,,"DEVICE")_$&ZLIB.%DIRECTORY
"RTN","ZISHVXD",124,0)
 Q Y
"RTN","ZISHVXD",125,0)
 ;
"RTN","ZISHVXD",126,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHVXD",127,0)
 Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHVXD",128,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV")) ;S DF=$TR(DF,"/","\")
"RTN","ZISHVXD",129,0)
 ;I $E(DF,$L(DF))'="\" S DF=DF_"\"
"RTN","ZISHVXD",130,0)
 Q DF
"RTN","ZISHVXD",131,0)
STATUS() ;SR. Return EOF status
"RTN","ZISHVXD",132,0)
 U $I:NOTRAP
"RTN","ZISHVXD",133,0)
 Q $$EOF($ZA)
"RTN","ZISHVXD",134,0)
 ;
"RTN","ZISHVXD",135,0)
EOF(X) ;Eof flag, Pass in $ZA
"RTN","ZISHVXD",136,0)
 Q (X=-1)
"RTN","ZISHVXD",137,0)
QL(X) ;Qlfrs
"RTN","ZISHVXD",138,0)
 Q:X=""
"RTN","ZISHVXD",139,0)
 S:$E(X)'="-" X="-"_X
"RTN","ZISHVXD",140,0)
 Q
"RTN","ZISHVXD",141,0)
FL(X) ;Fl len
"RTN","ZISHVXD",142,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHVXD",143,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHVXD",144,0)
 I $L(ZOSHP1)>14 S X=4 Q
"RTN","ZISHVXD",145,0)
 I $L(ZOSHP2)>8 S X=4 Q
"RTN","ZISHVXD",146,0)
 Q
"RTN","ZISHVXD",147,0)
 ;
"RTN","ZISHVXD",148,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHVXD",149,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHVXD",150,0)
 N I,F,MX
"RTN","ZISHVXD",151,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHVXD",152,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHVXD",153,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHVXD",154,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHVXD",155,0)
 I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHVXD",156,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHVXD",157,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHVXD",158,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHVXD",159,0)
 Q
"RTN","ZISHVXD",160,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;SR. Unload contents of host file into global
"RTN","ZISHVXD",161,0)
 ;p1=host file directory 
"RTN","ZISHVXD",162,0)
 ;p2=host file name
"RTN","ZISHVXD",163,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHVXD",164,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHVXD",165,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHVXD",166,0)
 N %ZA,%ZB,%ZC,%ZL,X,%OVFCNT,%CONT
"RTN","ZISHVXD",167,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHLGR,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY,POP,%ZISUB
"RTN","ZISHVXD",168,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHVXD",169,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHVXD",170,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHVXD",171,0)
 I POP Q 0
"RTN","ZISHVXD",172,0)
 N $ETRAP S $ETRAP="",X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",173,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF(%ZA)  D
"RTN","ZISHVXD",174,0)
 . S @%ZISHF=%XX
"RTN","ZISHVXD",175,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHVXD",176,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHVXD",177,0)
 . Q
"RTN","ZISHVXD",178,0)
 D CLOSE() ;Normal exit
"RTN","ZISHVXD",179,0)
 Q 1
"RTN","ZISHVXD",180,0)
 ;
"RTN","ZISHVXD",181,0)
ERREOF D CLOSE() ;Got error Reading file
"RTN","ZISHVXD",182,0)
 Q 0
"RTN","ZISHVXD",183,0)
 ;
"RTN","ZISHVXD",184,0)
READNXT(REC) ;
"RTN","ZISHVXD",185,0)
 N T,I,X
"RTN","ZISHVXD",186,0)
 U IO:NOTRAP R REC#255 S %ZA=$ZA,%ZB=$ZB,%ZL=%ZA Q:$$EOF(%ZA)
"RTN","ZISHVXD",187,0)
 F I=1:1:%ZL\255 R X#255 S %ZA=$ZA Q:$$EOF(%ZA)  S REC(I)=X
"RTN","ZISHVXD",188,0)
 Q
"RTN","ZISHVXD",189,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Load contents of global to host file.
"RTN","ZISHVXD",190,0)
 ;Previously name LOAD
"RTN","ZISHVXD",191,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",192,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",193,0)
 ;p3=host file directory
"RTN","ZISHVXD",194,0)
 ;p4=host file name
"RTN","ZISHVXD",195,0)
 N %ZISHY,%ZISHLGR,%ZISHOX
"RTN","ZISHVXD",196,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,$G(%ZX3),%ZX4,"W")
"RTN","ZISHVXD",197,0)
 Q %ZISHY
"RTN","ZISHVXD",198,0)
 ;
"RTN","ZISHVXD",199,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;SR. Append to host file.
"RTN","ZISHVXD",200,0)
 ;
"RTN","ZISHVXD",201,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",202,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",203,0)
 ;p3=host file directory
"RTN","ZISHVXD",204,0)
 ;p4=host file name
"RTN","ZISHVXD",205,0)
 N %ZISHY
"RTN","ZISHVXD",206,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,$G(%ZX3),%ZX4,"A")
"RTN","ZISHVXD",207,0)
 Q %ZISHY
"RTN","ZISHVXD",208,0)
 ;
"RTN","ZISHVXD",209,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHVXD",210,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",211,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",212,0)
 ;p3=host file directory
"RTN","ZISHVXD",213,0)
 ;p4=host file name
"RTN","ZISHVXD",214,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHLGR,%ZISHS,%ZISHOX,IO,%ZX,Y
"RTN","ZISHVXD",215,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHVXD",216,0)
 D OPEN^%ZISH(,%ZX3,%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHVXD",217,0)
 I POP Q 0
"RTN","ZISHVXD",218,0)
 N X
"RTN","ZISHVXD",219,0)
 N $ETRAP S $ETRAP="",X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",220,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHVXD",221,0)
 D CLOSE() ;Normal Exit
"RTN","ZISHVXD",222,0)
 Q 1
"RTN","ZISHVXD",223,0)
 ;
"RTN","ZOSFVXD")
0^15^B17537927
"RTN","ZOSFVXD",1,0)
ZOSFVXD ;SFISC/MVB - ZOSF TABLE FOR VAX DSM V3.3, V4 & V6 ;06/30/97  15:23
"RTN","ZOSFVXD",2,0)
 ;;8.0;KERNEL;**65**;JUL 03, 1995
"RTN","ZOSFVXD",3,0)
 ;Remember to update XGKB for escape processing.
"RTN","ZOSFVXD",4,0)
 S %Y=1 K ^%ZOSF("MASTER"),^%ZOSF("SIGNOFF")
"RTN","ZOSFVXD",5,0)
 I '$D(^%ZOSF("VOL")) S ^%ZOSF("VOL")=$P($ZC(%UCI),",",4)
"RTN","ZOSFVXD",6,0)
 K ZO F I="MGR","PROD","VOL" S:$D(^%ZOSF(I)) ZO(I)=^%ZOSF(I)
"RTN","ZOSFVXD",7,0)
 F I=1:2 S Z=$P($T(Z+I),";;",2) Q:Z=""  S X=$P($T(Z+1+I),";;",2,99) S:Z="OS" $P(^%ZOSF(Z),"^")=X I Z'="OS" S ^%ZOSF(Z)=$S($D(ZO(Z)):ZO(Z),1:X)
"RTN","ZOSFVXD",8,0)
 ;
"RTN","ZOSFVXD",9,0)
OS S:'$P(^%ZOSF("OS"),"^",2) $P(^%ZOSF("OS"),"^",2)=16
"RTN","ZOSFVXD",10,0)
MGR W !,"NAME OF MANAGER'S UCI,VOLUME SET: "_^%ZOSF("MGR")_"// " R X:$S($G(DTIME):DTIME,1:9999) I X]"" X ^("UCICHECK") G MGR:0[Y S ^%ZOSF("MGR")=X
"RTN","ZOSFVXD",11,0)
PROD W !,"PRODUCTION (SIGN-ON) UCI,VOLUME SET: "_^%ZOSF("PROD")_"// " R X:$S($G(DTIME):DTIME,1:9999) I X]"" X ^("UCICHECK") G PROD:0[Y S ^%ZOSF("PROD")=Y
"RTN","ZOSFVXD",12,0)
VOL W !,"NAME OF VOLUME SET: "_^%ZOSF("VOL")_"//" R X:$S($G(DTIME):DTIME,1:9999) I X]"" S:X?3U ^%ZOSF("VOL")=X I X'?3U W "MUST BE 3 Upper case." G VOL
"RTN","ZOSFVXD",13,0)
 W ! Q
"RTN","ZOSFVXD",14,0)
V4 S $P(^%ZOSF("OS"),"^",1)="VAX DSM(V4)"
"RTN","ZOSFVXD",15,0)
 S ^("JOBPARAM")="S Y="""" Q" ; S Y=JOB X'S UCI,VOLUMESET
"RTN","ZOSFVXD",16,0)
 S ^("TEST")="N %,Y S %=$P($ZC(%PGMSHOW),"","") O %:(INDEXED:READONLY) U %:KEY=$E($C(0)_X_$C(0,0,0,0,0,0,0,0),1,9) R Y C % I $L(Y)"
"RTN","ZOSFVXD",17,0)
 Q
"RTN","ZOSFVXD",18,0)
Z ;
"RTN","ZOSFVXD",19,0)
 ;;ACTJ
"RTN","ZOSFVXD",20,0)
 ;;S Y=$$ACTJ^%ZOSV()
"RTN","ZOSFVXD",21,0)
 ;;AVJ
"RTN","ZOSFVXD",22,0)
 ;;S Y=$$AVJ^%ZOSV()
"RTN","ZOSFVXD",23,0)
 ;;BRK
"RTN","ZOSFVXD",24,0)
 ;;U $I:CENABLE
"RTN","ZOSFVXD",25,0)
 ;;DEL
"RTN","ZOSFVXD",26,0)
 ;;X "ZR  ZS @X"
"RTN","ZOSFVXD",27,0)
 ;;EOFF
"RTN","ZOSFVXD",28,0)
 ;;U $I:NOECHO
"RTN","ZOSFVXD",29,0)
 ;;EON
"RTN","ZOSFVXD",30,0)
 ;;U $I:ECHO
"RTN","ZOSFVXD",31,0)
 ;;EOT
"RTN","ZOSFVXD",32,0)
 ;;S Y=$ZA\1024#2
"RTN","ZOSFVXD",33,0)
 ;;ERRTN
"RTN","ZOSFVXD",34,0)
 ;;^%ZTER
"RTN","ZOSFVXD",35,0)
 ;;ETRP
"RTN","ZOSFVXD",36,0)
 ;;Q
"RTN","ZOSFVXD",37,0)
 ;;GD
"RTN","ZOSFVXD",38,0)
 ;;G ^%GD
"RTN","ZOSFVXD",39,0)
 ;;JOBPARAM
"RTN","ZOSFVXD",40,0)
 ;;S Y=$$INFO^%SY(X),Y=$P(Y,",",1,2)
"RTN","ZOSFVXD",41,0)
 ;;LABOFF
"RTN","ZOSFVXD",42,0)
 ;;U IO:NOECHO
"RTN","ZOSFVXD",43,0)
 ;;LOAD
"RTN","ZOSFVXD",44,0)
 ;;S %N=0 X "ZL @X F XCNP=XCNP+1:1 S %N=%N+1,%=$T(+%N) Q:$L(%)=0  S @(DIF_XCNP_"",0)"")=%"
"RTN","ZOSFVXD",45,0)
 ;;LPC
"RTN","ZOSFVXD",46,0)
 ;;S Y=$ZC(%LPC,X)
"RTN","ZOSFVXD",47,0)
 ;;MAGTAPE
"RTN","ZOSFVXD",48,0)
 ;;S %MT("BS")="*1",%MT("FS")="*2",%MT("WTM")="*3",%MT("WB")="*4",%MT("REW")="*5",%MT("RB")="*6",%MT("REL")="*7",%MT("WHL")="*8",%MT("WEL")="*9"
"RTN","ZOSFVXD",49,0)
 ;;MAXSIZ
"RTN","ZOSFVXD",50,0)
 ;;Q
"RTN","ZOSFVXD",51,0)
 ;;MGR
"RTN","ZOSFVXD",52,0)
 ;;MGR,AAA
"RTN","ZOSFVXD",53,0)
 ;;MTBOT
"RTN","ZOSFVXD",54,0)
 ;;S Y=$ZA\32#2
"RTN","ZOSFVXD",55,0)
 ;;MTERR
"RTN","ZOSFVXD",56,0)
 ;;S Y=$ZA\32768#2
"RTN","ZOSFVXD",57,0)
 ;;MTONLINE
"RTN","ZOSFVXD",58,0)
 ;;S Y=$ZA\64#2
"RTN","ZOSFVXD",59,0)
 ;;MTWPROT
"RTN","ZOSFVXD",60,0)
 ;;S Y=$ZA\4#2
"RTN","ZOSFVXD",61,0)
 ;;NBRK
"RTN","ZOSFVXD",62,0)
 ;;U $I:NOCENABLE
"RTN","ZOSFVXD",63,0)
 ;;NO-PASSALL
"RTN","ZOSFVXD",64,0)
 ;;G NOPASS^%ZOSV
"RTN","ZOSFVXD",65,0)
 ;;NO-TYPE-AHEAD
"RTN","ZOSFVXD",66,0)
 ;;U $I:NOTYPE
"RTN","ZOSFVXD",67,0)
 ;;OS
"RTN","ZOSFVXD",68,0)
 ;;VAX DSM(V6)
"RTN","ZOSFVXD",69,0)
 ;;PASSALL
"RTN","ZOSFVXD",70,0)
 ;;G PASSALL^%ZOSV
"RTN","ZOSFVXD",71,0)
 ;;PRIINQ
"RTN","ZOSFVXD",72,0)
 ;;S Y=$$PRIINQ^%ZOSV()
"RTN","ZOSFVXD",73,0)
 ;;PRIORITY
"RTN","ZOSFVXD",74,0)
 ;;Q  ;G PRIORITY^%ZOSV
"RTN","ZOSFVXD",75,0)
 ;;PROD
"RTN","ZOSFVXD",76,0)
 ;;VAH,AAA
"RTN","ZOSFVXD",77,0)
 ;;PROGMODE
"RTN","ZOSFVXD",78,0)
 ;;S Y=$$PROGMODE^%ZOSV()
"RTN","ZOSFVXD",79,0)
 ;;RD
"RTN","ZOSFVXD",80,0)
 ;;G ^%RD
"RTN","ZOSFVXD",81,0)
 ;;RESJOB
"RTN","ZOSFVXD",82,0)
 ;;Q:'$D(DUZ)  Q:'$D(^XUSEC("XUMGR",+DUZ))  N XQZ S XQZ="^FORCEX[MGR]" D DO^%XUCI
"RTN","ZOSFVXD",83,0)
 ;;RM
"RTN","ZOSFVXD",84,0)
 ;;U $I:WIDTH=$S(X<256:X,1:0)
"RTN","ZOSFVXD",85,0)
 ;;RSEL
"RTN","ZOSFVXD",86,0)
 ;;K ^UTILITY($J) D ^%RSEL M ^UTILITY($J)=%UTILITY K %UTILITY
"RTN","ZOSFVXD",87,0)
 ;;RSUM
"RTN","ZOSFVXD",88,0)
 ;;ZL @X S Y=0 F %=1,3:1 S %1=$T(+%),%3=$F(%1," ") Q:'%3  S %3=$S($E(%1,%3)'=";":$L(%1),$E(%1,%3+1)=";":$L(%1),1:%3-2) F %2=1:1:%3 S Y=$A(%1,%2)*%2+Y
"RTN","ZOSFVXD",89,0)
 ;;SS
"RTN","ZOSFVXD",90,0)
 ;;G ^%SY
"RTN","ZOSFVXD",91,0)
 ;;SAVE
"RTN","ZOSFVXD",92,0)
 ;;S XCS="F XCM=1:1 S XCN=$O(@(DIE_XCN_"")"")) Q:+XCN'=XCN  S %=^(XCN,0) Q:$E(%,1)=""$""  I $E(%,1)'="";"" ZI %" X "ZR  X XCS ZS @X" S ^UTILITY("ROU",X)="" K XCS
"RTN","ZOSFVXD",93,0)
 ;;SIZE
"RTN","ZOSFVXD",94,0)
 ;;S Y=0 F I=1:1 S %=$T(+I) Q:%=""  S Y=Y+$L(%)+2
"RTN","ZOSFVXD",95,0)
 ;;TEST
"RTN","ZOSFVXD",96,0)
 ;;I $D(^ (X))!$D(^!(X))
"RTN","ZOSFVXD",97,0)
 ;;TMK
"RTN","ZOSFVXD",98,0)
 ;;S Y=$ZA\16384#2
"RTN","ZOSFVXD",99,0)
 ;;TRAP
"RTN","ZOSFVXD",100,0)
 ;;$ZT=X
"RTN","ZOSFVXD",101,0)
 ;;TRMOFF
"RTN","ZOSFVXD",102,0)
 ;;U $I:TERM=""
"RTN","ZOSFVXD",103,0)
 ;;TRMON
"RTN","ZOSFVXD",104,0)
 ;;U $I:TERM=$C(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,127)
"RTN","ZOSFVXD",105,0)
 ;;TRMRD
"RTN","ZOSFVXD",106,0)
 ;;S Y=$ZB
"RTN","ZOSFVXD",107,0)
 ;;TYPE-AHEAD
"RTN","ZOSFVXD",108,0)
 ;;U $I:TYPE
"RTN","ZOSFVXD",109,0)
 ;;UCI
"RTN","ZOSFVXD",110,0)
 ;;S Y=$ZC(%UCI),Y=$P(Y,",",1)_","_$P(Y,",",4)
"RTN","ZOSFVXD",111,0)
 ;;UCICHECK
"RTN","ZOSFVXD",112,0)
 ;;S Y=$$UCICHECK^%ZOSV(X)
"RTN","ZOSFVXD",113,0)
 ;;UPPERCASE
"RTN","ZOSFVXD",114,0)
 ;;S Y=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZOSFVXD",115,0)
 ;;XY
"RTN","ZOSFVXD",116,0)
 ;;S $X=DX,$Y=DY
"RTN","ZOSFVXD",117,0)
 ;;VOL
"RTN","ZOSFVXD",118,0)
 ;;AAA
"RTN","ZOSFVXD",119,0)
 ;;ZD
"RTN","ZOSFVXD",120,0)
 ;;N % S Y=$ZC(%CDATASC,+X,1) F %=1:1:3 I $L($P(Y,"/",%))<2 S $P(Y,"/",%)=0_$P(Y,"/",%)
"RTN","ZOSVVXD")
0^16^B16644601
"RTN","ZOSVVXD",1,0)
%ZOSV ;SFISC/AC - View commands & special functions. ;06/30/97  15:24
"RTN","ZOSVVXD",2,0)
 ;;8.0;KERNEL;**13,65**;Jul 05, 1995
"RTN","ZOSVVXD",3,0)
ACTJ() ; # active jobs
"RTN","ZOSVVXD",4,0)
 Q $P($$JOBS^%SY,",",2)
"RTN","ZOSVVXD",5,0)
 ;
"RTN","ZOSVVXD",6,0)
AVJ() ; # available jobs
"RTN","ZOSVVXD",7,0)
 N Y S Y=$$JOBS^%SY Q +Y-$P(Y,",",2)
"RTN","ZOSVVXD",8,0)
 ;
"RTN","ZOSVVXD",9,0)
T0 ; start RT clock
"RTN","ZOSVVXD",10,0)
 S %ZH0=$ZH,%=$P(%ZH0,",",3) S:$E($ZV,10,12)>5.1 %=$E(%,13,23) S XRT0=+$H_","_($P(%,":")*3600+($P(%,":",2)*60)+$P(%,":",3)) Q
"RTN","ZOSVVXD",11,0)
 ;
"RTN","ZOSVVXD",12,0)
T1 ; store RT datum w/ZHDIF
"RTN","ZOSVVXD",13,0)
 S %ZH1=$ZH,%=$P(%ZH1,",",3) S:$E($ZV,10,12)>5.1 %=$E(%,13,23) S XRT1=+$H_","_($P(%,":")*3600+($P(%,":",2)*60)+$P(%,":",3))
"RTN","ZOSVVXD",14,0)
 S ^%ZRTL(3,XRTL,+XRT1,XRTN,$P(XRT1,",",2))=XRT0_"^^"_($P(%ZH1,",")-$P(%ZH0,","))_"^"_($P(%ZH1,",",7)-$P(%ZH0,",",7))_"^"_($P(%ZH1,",",8)-$P(%ZH0,",",8)) K XRT0,%ZH0,%ZH1 Q
"RTN","ZOSVVXD",15,0)
 ;
"RTN","ZOSVVXD",16,0)
PASSALL ;
"RTN","ZOSVVXD",17,0)
 S Y=$ZC(%SPAWN,"SET TERM/PASTHRU "_$I) U $I:NOTERM Q
"RTN","ZOSVVXD",18,0)
NOPASS ;
"RTN","ZOSVVXD",19,0)
 S Y=$ZC(%SPAWN,"SET TERM/NOPASTHRU "_$I) U $I:TERM="" Q
"RTN","ZOSVVXD",20,0)
 ;
"RTN","ZOSVVXD",21,0)
PRGMODE ;
"RTN","ZOSVVXD",22,0)
 W ! S ZTPAC=$S($D(^VA(200,+DUZ,.1))#10:$P(^(.1),"^",5),1:""),XUVOL=^%ZOSF("VOL")
"RTN","ZOSVVXD",23,0)
 S X="" X ^%ZOSF("EOFF") R:ZTPAC]"" !,"PAC: ",X:60 D LC^XUS X ^%ZOSF("EON") I X'=ZTPAC W "??",*7 Q
"RTN","ZOSVVXD",24,0)
 K XMB,XMTEXT,XMY S XMB="XUPROGMODE",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB
"RTN","ZOSVVXD",25,0)
 I '$$PROGMODE() D UCI S XUCI=Y,XQZ="PRGM^ZUA[MGR]",XUSLNT=1 D DO^%XUCI ZESCAPE
"RTN","ZOSVVXD",26,0)
 E  S $ECODE=",<<PROG>>,"
"RTN","ZOSVVXD",27,0)
 ;
"RTN","ZOSVVXD",28,0)
PROGMODE() ;
"RTN","ZOSVVXD",29,0)
 Q ($V($V($V(0)))#2=0)
"RTN","ZOSVVXD",30,0)
 ;
"RTN","ZOSVVXD",31,0)
UCI ;
"RTN","ZOSVVXD",32,0)
 S Y=$ZC(%UCI),Y=$P(Y,",",1)_","_$P(Y,",",4) Q
"RTN","ZOSVVXD",33,0)
 ;
"RTN","ZOSVVXD",34,0)
UCICHECK(X) ;
"RTN","ZOSVVXD",35,0)
 N %,%1,U,V,Y
"RTN","ZOSVVXD",36,0)
 I '(X?3U!(X?3U1","3U)) Q ""
"RTN","ZOSVVXD",37,0)
 S U=$ZC(%UCI),V=$P(U,",",4),U=$P(U,","),%1=$P(X,",",2),%=$P(X,",")
"RTN","ZOSVVXD",38,0)
 S Y=$ZC(%SETUCI,%,%1),Y=$S(Y:%_","_$S(%1]"":%1,1:V),1:""),V=$ZC(%SETUCI,U,V)
"RTN","ZOSVVXD",39,0)
 Q Y
"RTN","ZOSVVXD",40,0)
 ;
"RTN","ZOSVVXD",41,0)
PRIORITY ;
"RTN","ZOSVVXD",42,0)
 Q  ;Q:X>10!(X<1)  S X=(X+1)\2-1,Y=$ZC(%SETPRI,X) Q  ;Let VSM do it's thing.
"RTN","ZOSVVXD",43,0)
 ;
"RTN","ZOSVVXD",44,0)
PRIINQ() ;
"RTN","ZOSVVXD",45,0)
 Q $ZC(%GETJPI,0,"PRIB")*2+2
"RTN","ZOSVVXD",46,0)
 ;
"RTN","ZOSVVXD",47,0)
BAUD S X="UNKNOWN" Q
"RTN","ZOSVVXD",48,0)
 ;
"RTN","ZOSVVXD",49,0)
LGR() Q $ZR ;Last global ref.
"RTN","ZOSVVXD",50,0)
 ;
"RTN","ZOSVVXD",51,0)
EC() Q $ZE ;Error code
"RTN","ZOSVVXD",52,0)
 ;
"RTN","ZOSVVXD",53,0)
DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVVXD",54,0)
 S Y="%" F  S Y=$ZSORT(@Y) Q:Y=""  D  ;code from DEC
"RTN","ZOSVVXD",55,0)
 . I $D(@Y)#2 S @(X_"Y)="_Y)
"RTN","ZOSVVXD",56,0)
 . I $D(@Y)>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",57,0)
 K %X,%Y,Y Q
"RTN","ZOSVVXD",58,0)
 ;
"RTN","ZOSVVXD",59,0)
ORDER ;SAVE PARTS OF SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVVXD",60,0)
 ;PARTS INDICATED BY X1("NAMESPACE*")="" ARRAY
"RTN","ZOSVVXD",61,0)
 I $D(X1("*"))#2 D DOLRO Q
"RTN","ZOSVVXD",62,0)
 S X1="" F  S X1=$O(X1(X1)) Q:X1=""  D
"RTN","ZOSVVXD",63,0)
 . S (Y,Y1)=$P(X1,"*") I $D(@Y)=0 F  S Y=$ZSORT(@Y) Q:Y=""!(Y[Y1)
"RTN","ZOSVVXD",64,0)
 . Q:Y=""  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",65,0)
 . F  S Y=$ZSORT(@Y) Q:Y=""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVVXD",66,0)
 . Q
"RTN","ZOSVVXD",67,0)
 K %,%X,%Y,Y,Y1 Q
"RTN","ZOSVVXD",68,0)
 ;
"RTN","ZOSVVXD",69,0)
PARSIZ ;
"RTN","ZOSVVXD",70,0)
 S X=3 Q
"RTN","ZOSVVXD",71,0)
 ;
"RTN","ZOSVVXD",72,0)
NOLOG ;
"RTN","ZOSVVXD",73,0)
 S Y=0 Q
"RTN","ZOSVVXD",74,0)
 ;
"RTN","ZOSVVXD",75,0)
DEVOPN G DEVOPN^%ZOSV1
"RTN","ZOSVVXD",76,0)
DEVOK G DEVOK^%ZOSV1
"RTN","ZOSVVXD",77,0)
RES G RES^%ZOSV1
"RTN","ZOSVVXD",78,0)
 ;
"RTN","ZOSVVXD",79,0)
GETENV ;Get environment Return Y='UCI^VOL/DIR^NODE^BOX LOOKUP'
"RTN","ZOSVVXD",80,0)
 S Y=$P($ZU(0),",",1)_"^"_$P($ZU(0),",",2)_"^"_$P($ZC(%GETSYI),",",4)
"RTN","ZOSVVXD",81,0)
 S $P(Y,"^",4)=$P(Y,"^",2)_":"_$P(Y,"^",3)
"RTN","ZOSVVXD",82,0)
 Q
"RTN","ZOSVVXD",83,0)
VERSION(X) ;return OS version, X=1 - return OS
"RTN","ZOSVVXD",84,0)
 Q $S($G(X):$P($ZV," V"),1:$P($ZV," V",2))
"RTN","ZOSVVXD",85,0)
 ;
"RTN","ZOSVVXD",86,0)
SETNM(X) ;Set name, Trap dup's, Fall into SETENV
"RTN","ZOSVVXD",87,0)
 N $ETRAP S $ETRAP="S $ECODE="""" Q"
"RTN","ZOSVVXD",88,0)
SETENV ;Set environment X='PROCESS NAME^ '
"RTN","ZOSVVXD",89,0)
 S %=$ZC(%SETPRN,$P(X,"^")) Q
"RTN","ZOSVVXD",90,0)
 ;
"RTN","ZOSVVXD",91,0)
ZHDIF ;Display dif of two $ZH's
"RTN","ZOSVVXD",92,0)
 W !," CPU=",$J($P(%ZH1,",")-$P(%ZH0,","),6,2),?14," ET=",$J($P(%ZH1,",",2)-$P(%ZH0,",",2),6,1),?27," DIO=",$J($P(%ZH1,",",7)-$P(%ZH0,",",7),5),?40," BIO=",$J($P(%ZH1,",",8)-$P(%ZH0,",",8),5),! Q
"RTN","ZOSVVXD",93,0)
 ;
"RTN","ZOSVVXD",94,0)
LOGRSRC(OPT) ;record resource usage in ^XTMP("XUCP"
"RTN","ZOSVVXD",95,0)
 N %,%D,%H,%M,%Y,C,H,U,X S C=",",U="^",%=$ZH,H=$P(%,C,3) S:$E($ZV,10,12)>5.1 H=$E(H,13,23) S H=$P($H,C)_C_($P(H,":")*3600+($P(H,":",2)*60)+$P(H,":",3))
"RTN","ZOSVVXD",96,0)
 S ^XTMP("XUCP",$P($ZC(%GETSYI),C,4),$P(H,C),$J,$P(H,C,2))=$P(%,C)_U_$P(%,C,7)_U_$P(%,C,8)_U_$P(%,C,4)_U_OPT_U_$P(%,C,3)
"RTN","ZOSVVXD",97,0)
 S %H=$H I $P(%H,C,2)#1000=0 S %=%H>21608+%H-.1,%Y=%\365.25+141,%=%#365.25\1,%D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1,X=%Y_"00"+%M_"00"+%D,^XTMP("XUCP",0)=X+10000_U_X
"RTN","ZOSVVXD",98,0)
 Q
"RTN","ZOSVVXD",99,0)
 ;
"RTN","ZOSVVXD",100,0)
SETTRM(X) ;Turn on specified terminators.
"RTN","ZOSVVXD",101,0)
 U $I:TERM=X
"RTN","ZOSVVXD",102,0)
 Q 1
"RTN","ZTPTCH")
0^13^B7219777
"RTN","ZTPTCH",1,0)
ZTPTCH ;557/THM,SFISC/RSD-DISPLAY PATCHES FOR SELECTED ROUTINES ;08/06/97  10:52
"RTN","ZTPTCH",2,0)
 ;;8.0;KERNEL;**44,65**;Jul 10, 1995
"RTN","ZTPTCH",3,0)
 N ZTSK,%ZIS,IOP
"RTN","ZTPTCH",4,0)
 K ^UTILITY($J)
"RTN","ZTPTCH",5,0)
 W !,"Display Patches for Selected Routines",!!
"RTN","ZTPTCH",6,0)
 X ^%ZOSF("RSEL") I '$D(^UTILITY($J)) W !!,*7,"No routines were selected.",!! H 2 G EXIT
"RTN","ZTPTCH",7,0)
 W !! S %ZIS="MQ" D ^%ZIS G:POP EXIT
"RTN","ZTPTCH",8,0)
 I $D(IO("Q")) K IO("Q") S ZTDESC="Installed Patch Listing",ZTRTN="TASK^ZTPTCH",ZTSAVE("^UTILITY($J,")="" D ^%ZTLOAD
"RTN","ZTPTCH",9,0)
 I $D(ZTSK) W !!,"Request queued.",!! G EXIT
"RTN","ZTPTCH",10,0)
 ;
"RTN","ZTPTCH",11,0)
TASK ;
"RTN","ZTPTCH",12,0)
 N CNT,CNTR,DATE,LINE,PNUM,PG,QUIT,RTN,UCI,X,Y,Z,Z1
"RTN","ZTPTCH",13,0)
 K ^TMP("ZTPTCH",$J)
"RTN","ZTPTCH",14,0)
 W:'$D(ZTQUEUED) !!,"Processing routines..."
"RTN","ZTPTCH",15,0)
 S RTN=0 F  S RTN=$O(^UTILITY($J,RTN)) Q:RTN=""  D  W:'$D(ZTQUEUED) "."
"RTN","ZTPTCH",16,0)
 .S X=$T(+2^@RTN) Q:X=""  S Y=$P(X,"**",2)
"RTN","ZTPTCH",17,0)
 .F Z=1:1 S Z1=$P(Y,",",Z) Q:(Z1="")  S ^TMP("ZTPTCH",$J,Z1,RTN)=""
"RTN","ZTPTCH",18,0)
 ;
"RTN","ZTPTCH",19,0)
 S U="^" D NOW^%DTC S Y=% D DD^%ZTPP S DATE=Y
"RTN","ZTPTCH",20,0)
 X ^%ZOSF("UCI") S UCI=Y,$P(LINE,"-",IOM)=""
"RTN","ZTPTCH",21,0)
 S (CNT,CNTR,PG,QUIT)=0
"RTN","ZTPTCH",22,0)
 U IO D HDR S PNUM=""
"RTN","ZTPTCH",23,0)
 F  S PNUM=$O(^TMP("ZTPTCH",$J,PNUM)) Q:PNUM=""!QUIT  W !! S RTN="",Z1=0 F Z=2:1 S RTN=$O(^TMP("ZTPTCH",$J,PNUM,RTN)) Q:RTN=""  D  Q:QUIT
"RTN","ZTPTCH",24,0)
 .I Z1=0 W PNUM S CNT=CNT+1
"RTN","ZTPTCH",25,0)
 .W ?Z-1#8*10,RTN S CNTR=CNTR+1
"RTN","ZTPTCH",26,0)
 .I (Z#8)=0,$O(^TMP("ZTPTCH",$J,PNUM,RTN))]"" D:$Y>(IOSL-6) HDR S Z=1 W !?Z-1#8*10 ;end of line
"RTN","ZTPTCH",27,0)
 .I $Y>(IOSL-6),(Z#8)=0,$O(^TMP("ZTPTCH",$J,PNUM,RTN))]"" D HDR S Z=1 W !?Z-1#8*10 ;end of page, more of same patch
"RTN","ZTPTCH",28,0)
 .I $Y>(IOSL-6),$O(^TMP("ZTPTCH",$J,PNUM,RTN))="" D HDR S Z=1 W !?Z-1#8*10 ;end of page, no more on same patch.
"RTN","ZTPTCH",29,0)
 .S Z1=1
"RTN","ZTPTCH",30,0)
 .Q
"RTN","ZTPTCH",31,0)
 W !!?10,"Total Patches = ",CNT,"  Total Routines = ",CNTR
"RTN","ZTPTCH",32,0)
 I IOST?1"C-".E,'QUIT S X=$$RD(0)
"RTN","ZTPTCH",33,0)
EXIT K ^UTILITY($J),^TMP("ZTPTCH",$J)
"RTN","ZTPTCH",34,0)
 D ^%ZISC
"RTN","ZTPTCH",35,0)
 Q
"RTN","ZTPTCH",36,0)
RD(X) ;
"RTN","ZTPTCH",37,0)
 W !!,"Enter RETURN to "_$S(X:"continue or '^' to exit: ",1:"end: ")
"RTN","ZTPTCH",38,0)
 R X:300
"RTN","ZTPTCH",39,0)
 Q ($E(X)="^")
"RTN","ZTPTCH",40,0)
 ;
"RTN","ZTPTCH",41,0)
HDR I IOST?1"C-".E,PG'=0,'$D(ZTQUEUED),$$RD(1) S QUIT=1 Q
"RTN","ZTPTCH",42,0)
 W:PG>0 @IOF S PG=PG+1 W !,"Installed Patches for Selected Routines ",UCI,?(IOM-8),"Page: ",PG,!,?60,DATE,!
"RTN","ZTPTCH",43,0)
 W "Patch #",?9,"|",$E(LINE,1,29)," Routines ",$E(LINE,1,29),"|",!
"RTN","ZTPTCH",44,0)
 Q
"VER")
8.0^21.0
"^DD",3.5,3.5,1,0)
$I^RFX^^0;2^K:$L(X)>40 X I $D(X) N % S %=$G(^("TYPE")) I $D(^%ZIS(1,"C",X)) D EN^DDIOL(" This $I in use by other Devices."_$C(7),"","?30") K:%="RES" X
"^DD",3.5,3.5,1,.1)
DEVICE $I
"^DD",3.5,3.5,1,1,0)
^.1
"^DD",3.5,3.5,1,1,1,0)
3.5^C
"^DD",3.5,3.5,1,1,1,1)
S ^%ZIS(1,"C",X,DA)=""
"^DD",3.5,3.5,1,1,1,2)
K ^%ZIS(1,"C",X,DA)
"^DD",3.5,3.5,1,1,2,0)
3.5^AD^MUMPS
"^DD",3.5,3.5,1,1,2,1)
I $D(ZISOX) K:'$D(^%ZIS(1,DA,0))!(ZISOX=X) ZISOX I $D(ZISOX) K:$P(^(0),U,2)="" ZISOX I $D(ZISOX) K ^%ZIS(1,"G","SYS."_$P(^(0),U,9)_"."_ZISOX,DA) X ^DD(3.5,1,9.2) K ZISOX
"^DD",3.5,3.5,1,1,2,2)
S ZISOX=X
"^DD",3.5,3.5,1,1,2,"%D",0)
^^1^1^2920518^^^^
"^DD",3.5,3.5,1,1,2,"%D",1,0)
This sets up the 'G' cross-reference used to identify the primary device.
"^DD",3.5,3.5,1,1,3,0)
3.5^ACPU^MUMPS
"^DD",3.5,3.5,1,1,3,1)
S:$S($D(^%ZIS(1,DA,0)):$S(X]"":1,1:0),1:0) ^%ZIS(1,"CPU",$P(^(0),U,9)_"."_X,DA)=""
"^DD",3.5,3.5,1,1,3,2)
K:$S($D(^%ZIS(1,DA,0)):$S(X]"":1,1:0),1:0) ^%ZIS(1,"CPU",$P(^(0),U,9)_"."_X,DA)
"^DD",3.5,3.5,1,1,3,"%D",0)
^^2^2^2920518^^^^
"^DD",3.5,3.5,1,1,3,"%D",1,0)
This sets up the 'CPU' cross-reference used to find devices
"^DD",3.5,3.5,1,1,3,"%D",2,0)
that have a particular $I on a specified VOLUME SET(CPU).
"^DD",3.5,3.5,1,1,4,0)
^^TRIGGER^3.54^.01
"^DD",3.5,3.5,1,1,4,1)
X ^DD(3.5,1,1,4,1.3) I X S X=DIV X ^DD(3.5,1,1,4,89.2) S Y(101)=$S($D(^%ZISL(3.54,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S DIU=X K Y S X=DIV S X=DIV X ^DD(3.5,1,1,4,1.4)
"^DD",3.5,3.5,1,1,4,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^%ZIS(1,D0,"TYPE")):^("TYPE"),1:"") S X=$P(Y(1),U,1),X=X S X=X="RES"
"^DD",3.5,3.5,1,1,4,1.4)
S DIH=$S($D(^%ZISL(3.54,DIV(0),0)):^(0),1:""),DIV=X I $D(^(0)) S $P(^(0),U,1)=DIV,DIH=3.54,DIG=.01 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",3.5,3.5,1,1,4,2)
Q
"^DD",3.5,3.5,1,1,4,89.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^%ZIS(1,D0,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S X=X K DIC S DIC="^%ZISL(3.54,",DIC(0)="NMFL",X=""""_X_"""" D ^DIC S (D,D0,DIV(0))=+Y
"^DD",3.5,3.5,1,1,4,"%D",0)
^^4^4^2930414^^^^
"^DD",3.5,3.5,1,1,4,"%D",1,0)
Whenever the $I is edited, the new value of $I is triggered
"^DD",3.5,3.5,1,1,4,"%D",2,0)
into the name field of the RESOURCE File(#3.54).
"^DD",3.5,3.5,1,1,4,"%D",3,0)
This ensures that an entry in the RESOURCE File(#3.54)
"^DD",3.5,3.5,1,1,4,"%D",4,0)
is established for every device entry of TYPE RESOURCE.
"^DD",3.5,3.5,1,1,4,"CREATE CONDITION")
INTERNAL(#2)="RES"
"^DD",3.5,3.5,1,1,4,"CREATE VALUE")
#1
"^DD",3.5,3.5,1,1,4,"DELETE VALUE")
NO EFFECT
"^DD",3.5,3.5,1,1,4,"DIC")
LOOKUP
"^DD",3.5,3.5,1,1,4,"DT")
2931029
"^DD",3.5,3.5,1,1,4,"FIELD")
#1:RESOURCE:#.01
"^DD",3.5,3.5,1,3)
on DSM, M+, and MSM $I must be numeric if it is for a local port.
"^DD",3.5,3.5,1,4)
W !,"If the '$I' value is zero ('0'), then",!?4,"the Device will be understood to be a slave device on the current port",!
"^DD",3.5,3.5,1,9.2)
I X]"",$P(^%ZIS(1,DA,0),U,11) X:$D(^%ZIS(1,"G","SYS."_$P(^(0),U,9)_"."_X))>9 ^DD(3.5,1,9.3) I $P(^%ZIS(1,DA,0),U,11) S ^%ZIS(1,"G","SYS."_$P(^(0),U,9)_"."_X,DA)=""
"^DD",3.5,3.5,1,9.3)
S $P(^%ZIS(1,DA,0),U,11)="" W !,*7,"CONFLICT OCCURRED.  DELETING "_$P(^DD(3.5,1.95,0),U,1)_" FROM DEVICE "_$P(^%ZIS(1,DA,0),U,1)
"^DD",3.5,3.5,1,21,0)
^^6^6^2940718^^^^
"^DD",3.5,3.5,1,21,1,0)
This field holds the Hardware port name that the OS can identify when
"^DD",3.5,3.5,1,21,2,0)
referencing a port on a CPU.
"^DD",3.5,3.5,1,21,3,0)
On layered systems where opening of host files is supported,
"^DD",3.5,3.5,1,21,4,0)
this field may hold the host file name.
"^DD",3.5,3.5,1,21,5,0)
When defining a spool device entry(TYPE="SPL") on VAX DSM or MSM-Unix,
"^DD",3.5,3.5,1,21,6,0)
enter the name of directory where spool host files will be created.
"^DD",3.5,3.5,1,"DT")
2931029
"^DD",19.2,19.2,6,0)
RESCHEDULING FREQUENCY^FX^^0;6^D IT6^XUTMG19
"^DD",19.2,19.2,6,.1)
FREQUENCY WITH WHICH THIS OPTION WILL BE AUTOMATICALLY RESCHEDULED TO RUN
"^DD",19.2,19.2,6,3)
FOR AUTOMATIC RE-QUEUING, ANSWER WITH INCREMENT OF HOURS, DAYS, OR MONTHS
"^DD",19.2,19.2,6,4)
N % S %(1)="Examples:",%(2)=" 120S = job will be re-run every two minutes",%(3)="   1H = job will be rerun every hour",%(4)="   7D = job will be re-run every week",%(5)="   3M = job will be run once a quarter" D EN^DDIOL(.%)
"^DD",19.2,19.2,6,21,0)
^^30^30^2970527^^
"^DD",19.2,19.2,6,21,1,0)
This field has a value only if the OPTION is to be re-queued automatically
"^DD",19.2,19.2,6,21,2,0)
for a subsequent run every time it is run by the TaskManager.
"^DD",19.2,19.2,6,21,3,0)
Valid codes are:
"^DD",19.2,19.2,6,21,4,0)
       Every n seconds         nS
"^DD",19.2,19.2,6,21,5,0)
       Every n hours           nH
"^DD",19.2,19.2,6,21,6,0)
       Every n days            nD
"^DD",19.2,19.2,6,21,7,0)
       Every n months          nM
"^DD",19.2,19.2,6,21,8,0)
       Day of Week             day[@time]
"^DD",19.2,19.2,6,21,9,0)
       weekday                 D[@time] 
"^DD",19.2,19.2,6,21,10,0)
       weekend day             E[@time] (saturday, sunday)
"^DD",19.2,19.2,6,21,11,0)
       Different days in month nM(sch...)
"^DD",19.2,19.2,6,21,12,0)
 
"^DD",19.2,19.2,6,21,13,0)
           sch:    dd[@time]       day of month ie: 15
"^DD",19.2,19.2,6,21,14,0)
                   nDay[@time]     day of week in month
"^DD",19.2,19.2,6,21,15,0)
                                   ie: 1W,3W  first and third wednesday
"^DD",19.2,19.2,6,21,16,0)
                   L               last
"^DD",19.2,19.2,6,21,17,0)
 
"^DD",19.2,19.2,6,21,18,0)
       day:=   M       monday
"^DD",19.2,19.2,6,21,19,0)
               T       tusday
"^DD",19.2,19.2,6,21,20,0)
               W       wednesday
"^DD",19.2,19.2,6,21,21,0)
               R       thursday
"^DD",19.2,19.2,6,21,22,0)
               F       friday
"^DD",19.2,19.2,6,21,23,0)
               S       saturday
"^DD",19.2,19.2,6,21,24,0)
               U       sunday
"^DD",19.2,19.2,6,21,25,0)
       Examples:
"^DD",19.2,19.2,6,21,26,0)
               1M(1,15)        The first and 15th of the month.
"^DD",19.2,19.2,6,21,27,0)
               1M(L)           The last day of the month.
"^DD",19.2,19.2,6,21,28,0)
               1M(LS)          The last saturday of the month.
"^DD",19.2,19.2,6,21,29,0)
               W@4pm           Each wednesday at 4 pm.
"^DD",19.2,19.2,6,21,30,0)
               D               Each weekday
"^DD",19.2,19.2,6,"DT")
2910220
**END**
**END**
