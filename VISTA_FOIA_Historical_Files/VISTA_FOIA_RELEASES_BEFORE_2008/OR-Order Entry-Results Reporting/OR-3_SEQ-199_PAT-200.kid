Released OR*3*200 SEQ #199
Extracted from mail message
**KIDS**:OR*3.0*200^

**INSTALL NAME**
OR*3.0*200
"BLD",4597,0)
OR*3.0*200^ORDER ENTRY/RESULTS REPORTING^0^3040223^y
"BLD",4597,4,0)
^9.64PA^^
"BLD",4597,"KRN",0)
^9.67PA^8989.52^19
"BLD",4597,"KRN",.4,0)
.4
"BLD",4597,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4597,"KRN",.401,0)
.401
"BLD",4597,"KRN",.402,0)
.402
"BLD",4597,"KRN",.403,0)
.403
"BLD",4597,"KRN",.5,0)
.5
"BLD",4597,"KRN",.84,0)
.84
"BLD",4597,"KRN",3.6,0)
3.6
"BLD",4597,"KRN",3.8,0)
3.8
"BLD",4597,"KRN",9.2,0)
9.2
"BLD",4597,"KRN",9.8,0)
9.8
"BLD",4597,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4597,"KRN",9.8,"NM",1,0)
ORB3USER^^0^B65970771
"BLD",4597,"KRN",9.8,"NM",2,0)
ORB3REG^^0^B15788132
"BLD",4597,"KRN",9.8,"NM","B","ORB3REG",2)

"BLD",4597,"KRN",9.8,"NM","B","ORB3USER",1)

"BLD",4597,"KRN",19,0)
19
"BLD",4597,"KRN",19.1,0)
19.1
"BLD",4597,"KRN",101,0)
101
"BLD",4597,"KRN",409.61,0)
409.61
"BLD",4597,"KRN",771,0)
771
"BLD",4597,"KRN",870,0)
870
"BLD",4597,"KRN",8989.51,0)
8989.51
"BLD",4597,"KRN",8989.52,0)
8989.52
"BLD",4597,"KRN",8994,0)
8994
"BLD",4597,"KRN","B",.4,.4)

"BLD",4597,"KRN","B",.401,.401)

"BLD",4597,"KRN","B",.402,.402)

"BLD",4597,"KRN","B",.403,.403)

"BLD",4597,"KRN","B",.5,.5)

"BLD",4597,"KRN","B",.84,.84)

"BLD",4597,"KRN","B",3.6,3.6)

"BLD",4597,"KRN","B",3.8,3.8)

"BLD",4597,"KRN","B",9.2,9.2)

"BLD",4597,"KRN","B",9.8,9.8)

"BLD",4597,"KRN","B",19,19)

"BLD",4597,"KRN","B",19.1,19.1)

"BLD",4597,"KRN","B",101,101)

"BLD",4597,"KRN","B",409.61,409.61)

"BLD",4597,"KRN","B",771,771)

"BLD",4597,"KRN","B",870,870)

"BLD",4597,"KRN","B",8989.51,8989.51)

"BLD",4597,"KRN","B",8989.52,8989.52)

"BLD",4597,"KRN","B",8994,8994)

"BLD",4597,"QUES",0)
^9.62^^
"BLD",4597,"REQB",0)
^9.611^2^2
"BLD",4597,"REQB",1,0)
OR*3.0*139^2
"BLD",4597,"REQB",2,0)
XU*8.0*285^2
"BLD",4597,"REQB","B","OR*3.0*139",1)

"BLD",4597,"REQB","B","XU*8.0*285",2)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
200^3040223
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORB3REG")
0^2^B15788132
"RTN","ORB3REG",1,0)
ORB3REG ; slc/CLA - Support routine for ORB3 ;6/28/00  12:00 [ 04/02/97  2:16 PM ]
"RTN","ORB3REG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,88,105,139,200**;Dec 17, 1997
"RTN","ORB3REG",3,0)
REGULAR(ORN,XQA,ORBU,ORBUI,ORBDEV,ORBDFN) ;get recips who always get notif
"RTN","ORB3REG",4,0)
 ; ORN: notif ien
"RTN","ORB3REG",5,0)
 ; XQA: DUZ array
"RTN","ORB3REG",6,0)
 ; ORBU: recip debug array
"RTN","ORB3REG",7,0)
 ; ORBUI: ORBU cntr
"RTN","ORB3REG",8,0)
 ; ORBDEV: device recips array
"RTN","ORB3REG",9,0)
 ; ORBDFN: patient ien
"RTN","ORB3REG",10,0)
 ;
"RTN","ORB3REG",11,0)
 N ORBX,ORLST,ORERR,ORBZ,ORBE,ORBDUZ,ORBDIV,ORBDIVX,ORBSUR
"RTN","ORB3REG",12,0)
 I $D(ORBU) D
"RTN","ORB3REG",13,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",14,0)
 .S ORBU(ORBUI)="Default recipient users and teams:",ORBUI=ORBUI+1
"RTN","ORB3REG",15,0)
 S ORBE=0,ORBX=0
"RTN","ORB3REG",16,0)
 ;
"RTN","ORB3REG",17,0)
 ;process default recip users & teams:
"RTN","ORB3REG",18,0)
 D ENVAL^XPAR(.ORLST,"ORB DEFAULT RECIPIENTS",ORN,.ORERR)
"RTN","ORB3REG",19,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORB3REG",20,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)) I ORLST(ORBE,ORN)=1 D
"RTN","ORB3REG",21,0)
 ..S ORBZ=$P(ORBE,";",2)
"RTN","ORB3REG",22,0)
 ..I ORBZ="VA(200," S ORBDUZ=$P(ORBE,";") I $L($G(ORBDUZ)) D
"RTN","ORB3REG",23,0)
 ...;
"RTN","ORB3REG",24,0)
 ...I '$D(ORBU) D
"RTN","ORB3REG",25,0)
 ....D PREALERT^ORB3USER(ORBDUZ,ORN,ORBDFN)
"RTN","ORB3REG",26,0)
 ....S XQA(ORBDUZ)=""
"RTN","ORB3REG",27,0)
 ...;
"RTN","ORB3REG",28,0)
 ...I $D(ORBU) N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L($G(NODE)) D
"RTN","ORB3REG",29,0)
 ....S ORBU(ORBUI)="   "_$P(NODE,U)_": ON because",ORBUI=ORBUI+1
"RTN","ORB3REG",30,0)
 ....S ORBU(ORBUI)="     Default Recipient (USER) parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",31,0)
 ....;
"RTN","ORB3REG",32,0)
 ....S ORBSUR=$$ACTVSURO^XQALSURO(ORBDUZ)  ;DBIA #2790
"RTN","ORB3REG",33,0)
 ....I +$G(ORBSUR)>0 D
"RTN","ORB3REG",34,0)
 .....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3REG",35,0)
 ..;
"RTN","ORB3REG",36,0)
 ..I ORBZ="OR(100.21," D REGTEAM(ORBE)
"RTN","ORB3REG",37,0)
 ;
"RTN","ORB3REG",38,0)
 ;process SYSTEM default devices:
"RTN","ORB3REG",39,0)
 S ORBZ=$$GET^XPAR("SYS","ORB DEFAULT RECIPIENT DEVICES",ORN,"E")
"RTN","ORB3REG",40,0)
 I $L($G(ORBZ)) D
"RTN","ORB3REG",41,0)
 .I '$D(ORBU) S ORBDEV(ORBZ)=""
"RTN","ORB3REG",42,0)
 .I $D(ORBU) D
"RTN","ORB3REG",43,0)
 ..S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",44,0)
 ..S ORBU(ORBUI)="Default device: "_ORBZ_" because",ORBUI=ORBUI+1
"RTN","ORB3REG",45,0)
 ..S ORBU(ORBUI)="  Default System Device parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",46,0)
 ;
"RTN","ORB3REG",47,0)
 ;process DIVISION default devices:
"RTN","ORB3REG",48,0)
 I +$G(DUZ)>1,($L($G(DUZ(2)))) S ORBDIV($G(DUZ(2)))=$G(DUZ(2))
"RTN","ORB3REG",49,0)
 E  D DIVS(.ORBDIV)
"RTN","ORB3REG",50,0)
 S ORBDIVX="" F  S ORBDIVX=$O(ORBDIV(ORBDIVX)) Q:'ORBDIVX  D
"RTN","ORB3REG",51,0)
 .S ORBZ=$$GET^XPAR("DIV.`"_ORBDIVX,"ORB DEFAULT RECIPIENT DEVICES",ORN,"E")
"RTN","ORB3REG",52,0)
 .I $L($G(ORBZ)) D
"RTN","ORB3REG",53,0)
 ..I '$D(ORBU) S ORBDEV(ORBZ)=""
"RTN","ORB3REG",54,0)
 ..I $D(ORBU) D
"RTN","ORB3REG",55,0)
 ...S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",56,0)
 ...S ORBU(ORBUI)="Default device: "_ORBZ_" because",ORBUI=ORBUI+1
"RTN","ORB3REG",57,0)
 ...S ORBU(ORBUI)="  Default Division Device parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",58,0)
 Q
"RTN","ORB3REG",59,0)
REGTEAM(ORBE) ;get team recips
"RTN","ORB3REG",60,0)
 N ORBLST,IJ,ORBTD,ORBSUR
"RTN","ORB3REG",61,0)
 D TEAMPROV^ORQPTQ1(.ORBLST,$P(ORBE,";"))
"RTN","ORB3REG",62,0)
 I $D(ORBU) N TNODE S TNODE=$G(^OR(100.21,$P(ORBE,";"),0)) I $L($G(TNODE)) D
"RTN","ORB3REG",63,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",64,0)
 .S ORBU(ORBUI)="  Default team recipients from team "_$P(TNODE,U)_":",ORBUI=ORBUI+1
"RTN","ORB3REG",65,0)
 I +$G(ORBLST(1))>0 S IJ="" F  S IJ=$O(ORBLST(IJ)) Q:IJ=""  D
"RTN","ORB3REG",66,0)
 .S ORBDUZ=$P(ORBLST(IJ),U) I $L($G(ORBDUZ)) D
"RTN","ORB3REG",67,0)
 ..I '$D(ORBU) D
"RTN","ORB3REG",68,0)
 ...D PREALERT^ORB3USER(ORBDUZ,ORN,ORBDFN)
"RTN","ORB3REG",69,0)
 ...S XQA(ORBDUZ)=""
"RTN","ORB3REG",70,0)
 ..I $D(ORBU) N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L($G(NODE)) D
"RTN","ORB3REG",71,0)
 ...S ORBU(ORBUI)="   "_$P(NODE,U)_": ON because",ORBUI=ORBUI+1
"RTN","ORB3REG",72,0)
 ...S ORBU(ORBUI)="     Default Recipient (TEAM) parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",73,0)
 ...S ORBSUR=$$ACTVSURO^XQALSURO(ORBDUZ)  ;DBIA #2790
"RTN","ORB3REG",74,0)
 ...I +$G(ORBSUR)>0 D
"RTN","ORB3REG",75,0)
 ....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3REG",76,0)
 ;
"RTN","ORB3REG",77,0)
 S ORBTD=$P($$TMDEV^ORB31($P(ORBE,";")),U,2)  ;tm device
"RTN","ORB3REG",78,0)
 I $L(ORBTD) D
"RTN","ORB3REG",79,0)
 .S ORBDEV(ORBTD)=""
"RTN","ORB3REG",80,0)
 .I $D(ORBU) D
"RTN","ORB3REG",81,0)
 ..S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3REG",82,0)
 ;
"RTN","ORB3REG",83,0)
 I $D(ORBU) S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",84,0)
 Q
"RTN","ORB3REG",85,0)
DIVS(DIVS) ;get all possible divisions
"RTN","ORB3REG",86,0)
 ; DIVS - rtn array in format:
"RTN","ORB3REG",87,0)
 ; DIVS(div #)=div #
"RTN","ORB3REG",88,0)
 ;
"RTN","ORB3REG",89,0)
 N DIV
"RTN","ORB3REG",90,0)
 S DIV=0 F  S DIV=$O(^DG(40.8,"AD",DIV)) Q:'DIV  D
"RTN","ORB3REG",91,0)
 .S DIVS(DIV)=DIV
"RTN","ORB3REG",92,0)
 Q
"RTN","ORB3USER")
0^1^B65970771
"RTN","ORB3USER",1,0)
ORB3USER ; slc/CLA - Alert recipient algorithms for OE/RR 3 notifications; 1/19/00 14:45
"RTN","ORB3USER",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**74,91,105,139,200**;Dec 17, 1997
"RTN","ORB3USER",3,0)
USER(XQA,ORBDUZ,ORN,ORBU,ORBUI,ORBDFN) ;called from ORB3
"RTN","ORB3USER",4,0)
 ;check to see if potential recip (ORBDUZ) should be an alert recip
"RTN","ORB3USER",5,0)
 ;XQA     array of alert recips passed to Kernel Alert Utility
"RTN","ORB3USER",6,0)
 ;ORBDUZ  duz of current potential alert recipient
"RTN","ORB3USER",7,0)
 ;ORN     notif ien from file 100.9
"RTN","ORB3USER",8,0)
 ;ORBU    array of info for utility displaying recip who and why
"RTN","ORB3USER",9,0)
 ;ORBUI   counter for utility array
"RTN","ORB3USER",10,0)
 ;ORBDFN  patient ien from Patient file [#2]
"RTN","ORB3USER",11,0)
 ;
"RTN","ORB3USER",12,0)
 N ORBNODE,ORBSUR,ORBTM,ORBTMF,ORBTEAM,ORBON,ORBDUP
"RTN","ORB3USER",13,0)
 I $G(ORBDUZ)["G." S XQA(ORBDUZ)="" Q
"RTN","ORB3USER",14,0)
 Q:+$G(ORBDUZ)<.5
"RTN","ORB3USER",15,0)
 ;
"RTN","ORB3USER",16,0)
 S ORBTM=$P(ORBDUZ,U,2) I $L(ORBTM) D  ;if user recip via team
"RTN","ORB3USER",17,0)
 .S ORBTMF=$$GET^XPAR(ORBTM_";OR(100.21,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",18,0)
 .S ORBTEAM=ORBTMF_U_$P(^OR(100.21,ORBTM,0),U)
"RTN","ORB3USER",19,0)
 .I $D(ORBU) D
"RTN","ORB3USER",20,0)
 ..S ORBU(ORBUI)="   User "_$P(^VA(200,+ORBDUZ,0),U)_" is a potential recipient via team "_$P(ORBTEAM,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",21,0)
 ;
"RTN","ORB3USER",22,0)
 I '$D(ORBU) D
"RTN","ORB3USER",23,0)
 .I $L($G(ORBTMF))=0 D
"RTN","ORB3USER",24,0)
 ..S:$D(^XTMP("ORBUSER",$J,+ORBDUZ)) ORBDUP=1
"RTN","ORB3USER",25,0)
 ..S ^XTMP("ORBUSER",$J,+ORBDUZ)=""
"RTN","ORB3USER",26,0)
 Q:$G(ORBDUP)=1  ;quit if user already processed and no team param value
"RTN","ORB3USER",27,0)
 ;
"RTN","ORB3USER",28,0)
 S ORBDUZ=$P(ORBDUZ,U)
"RTN","ORB3USER",29,0)
 ;
"RTN","ORB3USER",30,0)
 S:$G(ORBTEAM)="" ORBTEAM="^"
"RTN","ORB3USER",31,0)
 S ORBON=$$ONOFF(ORN,ORBDUZ,ORBDFN,ORBTEAM)
"RTN","ORB3USER",32,0)
 I $D(ORBU) D
"RTN","ORB3USER",33,0)
 .S ORBNODE=$G(^VA(200,ORBDUZ,0)) I $L($G(ORBNODE)) D
"RTN","ORB3USER",34,0)
 ..S ORBU(ORBUI)="   "_$P(ORBNODE,U)_": "_$P(ORBON,U)_" because ",ORBUI=ORBUI+1
"RTN","ORB3USER",35,0)
 ..S ORBU(ORBUI)="     "_$P(ORBON,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",36,0)
 I $D(ORBU),($P(ORBON,U)="ON"),($G(ORBDUZ)'["G.") D
"RTN","ORB3USER",37,0)
 .S ORBSUR=$$ACTVSURO^XQALSURO(ORBDUZ)  ;DBIA 2790 Alert surrogate
"RTN","ORB3USER",38,0)
 .I +$G(ORBSUR)>0 D
"RTN","ORB3USER",39,0)
 ..S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3USER",40,0)
 Q:$P(ORBON,U)="OFF"  ;quit if user is disabled for this notif
"RTN","ORB3USER",41,0)
 Q:$D(ORBU)           ;quit if entered rtn via UTL (do not sent alert)
"RTN","ORB3USER",42,0)
 D PREALERT(ORBDUZ,ORN,ORBDFN)  ;if user has undel prev alert, delete it
"RTN","ORB3USER",43,0)
 S XQA(ORBDUZ)=""  ;send alert to the user
"RTN","ORB3USER",44,0)
 Q
"RTN","ORB3USER",45,0)
 ;
"RTN","ORB3USER",46,0)
PREALERT(ORBDUZ,ORN,ORBDFN) ;if user (ORBDUZ) has an undeleted previous
"RTN","ORB3USER",47,0)
 ;version of this alert (ORN) for patient (ORBDFN), delete it
"RTN","ORB3USER",48,0)
 ;
"RTN","ORB3USER",49,0)
 Q:$P(^ORD(100.9,ORN,0),U,4)'="NOT"  ;quit if not a "NOT" notif/alert
"RTN","ORB3USER",50,0)
 N XQAID,XQAKILL,XQAUSER,ORBDT
"RTN","ORB3USER",51,0)
 S XQAID="OR,"_ORBDFN_","_ORN
"RTN","ORB3USER",52,0)
 I $D(^XTV(8992,"AXQAN",XQAID,ORBDUZ)) D  ;DBIA# 2689
"RTN","ORB3USER",53,0)
 .S ORBDT=0,ORBDT=$O(^XTV(8992,"AXQAN",XQAID,ORBDUZ,ORBDT))
"RTN","ORB3USER",54,0)
 .I $G(ORBDT)>0 D
"RTN","ORB3USER",55,0)
 ..S XQAUSER=ORBDUZ
"RTN","ORB3USER",56,0)
 ..S XQAKILL=1
"RTN","ORB3USER",57,0)
 ..D DELETEA^XQALERT
"RTN","ORB3USER",58,0)
 Q
"RTN","ORB3USER",59,0)
 ;
"RTN","ORB3USER",60,0)
ONOFF(ORN,ORBUSR,ORBPT,ORBTEAM) ;Extrinsic function to check param file
"RTN","ORB3USER",61,0)
 ;determines if user ORBUSR should receive notification ORN for patient
"RTN","ORB3USER",62,0)
 ;patient ORBPT. If ORBUSR was derived via teams, ORBTEAM may be used.
"RTN","ORB3USER",63,0)
 ;ORN      notification ien from file 100.9 (req'd)
"RTN","ORB3USER",64,0)
 ;ORBUSR   user ien from file 200 (req'd)
"RTN","ORB3USER",65,0)
 ;ORBPT    patient ien from file 2 (not req'd)
"RTN","ORB3USER",66,0)
 ;ORBTEAM  processing flag^name for team assoc. w/ORBUSR (not req'd)
"RTN","ORB3USER",67,0)
 N NODE,ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN
"RTN","ORB3USER",68,0)
 S (ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN)=""
"RTN","ORB3USER",69,0)
 N ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE
"RTN","ORB3USER",70,0)
 S (ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE)=""
"RTN","ORB3USER",71,0)
 N ORBCLS,ORBCLSF,ORBCLSN,ORBLST,ORBI
"RTN","ORB3USER",72,0)
 S (ORBCLS,ORBCLSF,ORBCLSN)=""
"RTN","ORB3USER",73,0)
 N ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF
"RTN","ORB3USER",74,0)
 S (ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF)=""
"RTN","ORB3USER",75,0)
 ;
"RTN","ORB3USER",76,0)
 ;get notification name:
"RTN","ORB3USER",77,0)
 S NODE=$G(^ORD(100.9,ORN,0)) S:$L($G(NODE)) ORBNOTN=$P(NODE,U)
"RTN","ORB3USER",78,0)
 ;
"RTN","ORB3USER",79,0)
 ;get user name:
"RTN","ORB3USER",80,0)
 S NODE=$G(^VA(200,ORBUSR,0)) S:$L($G(NODE)) ORBUSRN=$P(NODE,U)
"RTN","ORB3USER",81,0)
 ;
"RTN","ORB3USER",82,0)
 ;get patient name:
"RTN","ORB3USER",83,0)
 S:$L($G(ORBPT)) NODE=$G(^DPT(ORBPT,0)) S:$L($G(NODE)) ORBPTN=$P(NODE,U)
"RTN","ORB3USER",84,0)
 ;
"RTN","ORB3USER",85,0)
 ;get division flag and name:
"RTN","ORB3USER",86,0)
 S ORBDIV=$$DIVF(ORBUSR,ORN)
"RTN","ORB3USER",87,0)
 I $L(ORBDIV) D
"RTN","ORB3USER",88,0)
 .S ORBDIVF=$P(ORBDIV,U,2),ORBDIV=$P(ORBDIV,U),NODE=$G(^DIC(4,ORBDIV,0))
"RTN","ORB3USER",89,0)
 .S:$L($G(NODE)) ORBDIVN=$P(NODE,U)
"RTN","ORB3USER",90,0)
 ;
"RTN","ORB3USER",91,0)
 ;get system flag:
"RTN","ORB3USER",92,0)
 S ORBSYSF=$$GET^XPAR("SYS","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",93,0)
 ;
"RTN","ORB3USER",94,0)
 ;get OE/RR package-export flag:
"RTN","ORB3USER",95,0)
 S ORBPKGF=$$GET^XPAR("PKG","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",96,0)
 ;
"RTN","ORB3USER",97,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORB3USER",98,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORB3USER",99,0)
 I +$G(ORBPT)>0 D
"RTN","ORB3USER",100,0)
 .N DFN S DFN=ORBPT,VA200="" D OERR^VADPT
"RTN","ORB3USER",101,0)
 .S ORBLOC=+$G(^DIC(42,+VAIN(4),44)) I +$G(ORBLOC)>0 D
"RTN","ORB3USER",102,0)
 ..S ORBLOCN=$P(^SC(+ORBLOC,0),U)
"RTN","ORB3USER",103,0)
 ..S ORBLOCF=$$GET^XPAR(+$G(ORBLOC)_";SC(","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",104,0)
 K VA200,VAIN
"RTN","ORB3USER",105,0)
 ;
"RTN","ORB3USER",106,0)
 ;get user's service/section flag:
"RTN","ORB3USER",107,0)
 S ORBSRV=$G(^VA(200,ORBUSR,5)) I +ORBSRV>0 S ORBSRV=$P(ORBSRV,U) D
"RTN","ORB3USER",108,0)
 .S NODE=$G(^DIC(49,ORBSRV,0)) S:$L($G(NODE)) ORBSRVN=$P(NODE,U)
"RTN","ORB3USER",109,0)
 .S:+$G(ORBSRV)>0 ORBSRVF=$$GET^XPAR(ORBSRV_";DIC(49,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",110,0)
 ;
"RTN","ORB3USER",111,0)
 ;get user's team flag:
"RTN","ORB3USER",112,0)
 I $L($G(ORBTEAM)) S ORBTEAF=$P(ORBTEAM,U),ORBTEAN=$P(ORBTEAM,U,2)
"RTN","ORB3USER",113,0)
 ;
"RTN","ORB3USER",114,0)
 ;get class flag for the user's most recently active ASU class
"RTN","ORB3USER",115,0)
 ;S ORBCLS=$$RECENT(ORBUSR) I $L($G(ORBCLS))>0 D
"RTN","ORB3USER",116,0)
 ;.S ORBCLSN=$P(ORBCLS,U,2),ORBCLS=$P(ORBCLS,U)
"RTN","ORB3USER",117,0)
 ;.S:+$G(ORBCLS)>0 ORBCLSF=$$GET^XPAR(ORBCLS_";USR(8930,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",118,0)
 ;
"RTN","ORB3USER",119,0)
 ;get user's flag:
"RTN","ORB3USER",120,0)
 S ORBUSRF=$$GET^XPAR(ORBUSR_";VA(200,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",121,0)
 ;
"RTN","ORB3USER",122,0)
 ;determine overall flag:
"RTN","ORB3USER",123,0)
 I $G(ORBUSRF)="M" Q "ON^User "_ORBUSRN_" is Mandatory.^User value is Mandatory"
"RTN","ORB3USER",124,0)
 I $G(ORBUSRF)="E" Q "ON^User "_ORBUSRN_" is Enabled.^User value is Enabled"
"RTN","ORB3USER",125,0)
 ;I $G(ORBCLSF)="M" Q "ON^User's class "_ORBCLSN_" is Mandatory.^User's class "_ORBCLSN_" value is Mandatory"
"RTN","ORB3USER",126,0)
 I $G(ORBTEAF)="M" Q "ON^User's team "_ORBTEAN_" is Mandatory.^User's team "_ORBTEAN_" value is Mandatory"
"RTN","ORB3USER",127,0)
 I $G(ORBTEAF)="D" Q "OFF^User's team "_ORBTEAN_" is Disabled.^User's team "_ORBTEAN_" value is Disabled"
"RTN","ORB3USER",128,0)
 I $G(ORBSRVF)="M" Q "ON^User's service "_ORBSRVN_" is Mandatory.^User's service "_ORBSRVN_" value is Mandatory"
"RTN","ORB3USER",129,0)
 I $G(ORBLOCF)="M" Q "ON^Patient's location "_ORBLOCN_" is Mandatory.^Pt's location "_ORBLOCN_" value is Mandatory"
"RTN","ORB3USER",130,0)
 I $G(ORBLOCF)="D" Q "OFF^Patient's location "_ORBLOCN_" is Disabled.^Pt's location "_ORBLOCN_" value is Disabled"
"RTN","ORB3USER",131,0)
 I $G(ORBDIVF)="M",($G(ORBLOCF)="") Q "ON^Division "_ORBDIVN_" is Mandatory, no Pt Location value.^Division "_ORBDIVN_" value is Mandatory"
"RTN","ORB3USER",132,0)
 I $G(ORBSYSF)="M",($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^System default is Mandatory, no Division or Pt Location values.^System value is Mandatory"
"RTN","ORB3USER",133,0)
 I $G(ORBPKGF)="M",($G(ORBSYSF)=""),($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^OERR default is Mandatory, no Division, System, or Pt Location values.^OERR value is Mandatory"
"RTN","ORB3USER",134,0)
 I $G(ORBUSRF)="D" Q "OFF^User "_ORBUSRN_" is Disabled - no Mandatory values found.^User value is Disabled"
"RTN","ORB3USER",135,0)
 ;I $G(ORBCLSF)="D" Q "OFF^User's class "_ORBCLSN_" is Disabled - no Mandatory values found.^User's class "_ORBCLSN_" value is Disabled""
"RTN","ORB3USER",136,0)
 I $G(ORBTEAF)="E" Q "ON^User's team "_ORBTEAN_" is Enabled.^User's team "_ORBTEAN_" value is Enabled"
"RTN","ORB3USER",137,0)
 I $G(ORBSRVF)="D" Q "OFF^User's service "_ORBSRVN_" is Disabled.^User's service "_ORBSRVN_" value is Disabled"
"RTN","ORB3USER",138,0)
 I $G(ORBSRVF)="E" Q "ON^User's service "_ORBSRVN_" is Enabled.^User's service "_ORBSRVN_" value is Enabled"
"RTN","ORB3USER",139,0)
 I $G(ORBLOCF)="E" Q "ON^Patient's location "_ORBLOCN_" is Enabled.^Pt's location "_ORBLOCN_" value is Enabled"
"RTN","ORB3USER",140,0)
 I $G(ORBDIVF)="D" Q "OFF^Division "_ORBDIVN_" is Disabled.^Division "_ORBDIVN_" value is Disabled"
"RTN","ORB3USER",141,0)
 I $G(ORBDIVF)="E" Q "ON^Division "_ORBDIVN_" is Enabled.^Division "_ORBDIVN_" value is Enabled"
"RTN","ORB3USER",142,0)
 I $G(ORBSYSF)="D" Q "OFF^System default is Disabled.^System value is Disabled"
"RTN","ORB3USER",143,0)
 I $G(ORBSYSF)="E" Q "ON^System default is Enabled.^System value is Enabled"
"RTN","ORB3USER",144,0)
 I $G(ORBPKGF)="D" Q "OFF^OERR default is Disabled.^OERR value is Disabled"
"RTN","ORB3USER",145,0)
 I $G(ORBPKGF)="E" Q "ON^OERR default is Enabled.^OERR value is Enabled"
"RTN","ORB3USER",146,0)
 Q "OFF^No Mandatory, Disabled or Enabled values found.^No Mandatory/Disabled/Enabled values"
"RTN","ORB3USER",147,0)
 ;
"RTN","ORB3USER",148,0)
RECENT(USER) ;ext funct rtns a user's most recent, active user class
"RTN","ORB3USER",149,0)
 Q:+$G(USER)<1 "^Error: User not identified."
"RTN","ORB3USER",150,0)
 N CLS,CLASS,INACT,ACT,ORX,INVDT,RESULT
"RTN","ORB3USER",151,0)
 ;call api to determine user's class(es)
"RTN","ORB3USER",152,0)
 Q:'$L($G(CLS(0))) "^No user classes found."
"RTN","ORB3USER",153,0)
 D NOW^%DTC
"RTN","ORB3USER",154,0)
 S CLASS="" F  S CLASS=$O(CLS(CLASS)) Q:CLASS=""  D
"RTN","ORB3USER",155,0)
 .S INACT=$P(CLS(CLASS),U,5),ACT=$P(CLS(CLASS),U,4)
"RTN","ORB3USER",156,0)
 .I INACT,(INACT<%) Q  ;quit if class has an inactive date before now
"RTN","ORB3USER",157,0)
 .Q:'ACT     ;quit if class has no active date
"RTN","ORB3USER",158,0)
 .S ORX("DT",9999999-ACT)=$P(CLS(CLASS),U)_U_CLASS
"RTN","ORB3USER",159,0)
 S INVDT="",INVDT=$O(ORX("DT",INVDT))
"RTN","ORB3USER",160,0)
 I INVDT S RESULT=ORX("DT",INVDT)
"RTN","ORB3USER",161,0)
 E  S RESULT="^No user classes found."
"RTN","ORB3USER",162,0)
 K %
"RTN","ORB3USER",163,0)
 Q RESULT
"RTN","ORB3USER",164,0)
DIVF(USER,ORN) ;ext funct rtns user's division value for ORB PROCESSING FLAG
"RTN","ORB3USER",165,0)
 N DIV,DIVF,MDIVF,EDIVF,DDIVF
"RTN","ORB3USER",166,0)
 S DIV=0,(DIVF,MDIVF,EDIVF,DDIVF)=""
"RTN","ORB3USER",167,0)
 F  S DIV=$O(^VA(200,USER,2,"B",DIV)) Q:+$G(DIV)<1!(DIVF="M")  D
"RTN","ORB3USER",168,0)
 .S DIVF=$$GET^XPAR(DIV_";DIC(4,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",169,0)
 .I DIVF="M" S MDIVF=DIV_U_DIVF
"RTN","ORB3USER",170,0)
 .I DIVF="E" S EDIVF=DIV_U_DIVF
"RTN","ORB3USER",171,0)
 .I DIVF="D" S DDIVF=DIV_U_DIVF
"RTN","ORB3USER",172,0)
 Q:$L(MDIVF) MDIVF
"RTN","ORB3USER",173,0)
 Q:$L(EDIVF) EDIVF
"RTN","ORB3USER",174,0)
 Q:$L(DDIVF) DDIVF
"RTN","ORB3USER",175,0)
 Q ""
"VER")
8.0^22.0
**END**
**END**
