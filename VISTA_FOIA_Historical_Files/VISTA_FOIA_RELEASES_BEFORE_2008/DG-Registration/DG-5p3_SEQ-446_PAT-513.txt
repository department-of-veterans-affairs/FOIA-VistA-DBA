$TXT Created by MULLER,RICHARD at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Tuesday, 05/13/03 at 08:35
=============================================================================
Run Date: MAY 28, 2003                     Designation: DG*5.3*513
Package : DG - REGISTRATION                    Priority: Mandatory
Version : 5.3       SEQ #446                     Status: Released
                  Compliance Date: JUN 28, 2003
=============================================================================

Associated patches: (v)DG*5.3*244  <<= must be installed BEFORE `DG*5.3*513'
                    (v)DG*5.3*326  <<= must be installed BEFORE `DG*5.3*513'
                    (v)DG*5.3*431  <<= must be installed BEFORE `DG*5.3*513'
                    (v)DG*5.3*491  <<= must be installed BEFORE `DG*5.3*513'
                    (v)DG*5.3*498  <<= must be installed BEFORE `DG*5.3*513'

Subject: FIX PATIENT LOOK-UP PROBLEM

Category: 
  - Routine

Description: 
============

  
 Issue #1: 
 =========
 Using any of the registration menu options that display veterans 
 enrollment information, may cause the Enrollment Ended warning message to 
 be erroneously displayed.
  
 A record with a rejected status is displayed, the next record is 
 displayed which does not have a rejected status, the warning message from 
 the previous record is displaying.  Here is an example of the message:
  
                            *** WARNING ***
          *** PATIENT ENROLLMENT ENDED EFFECTIVE 01/31/2003 ***
  
 If site exits out of all the screens, then re-enters and displays the 
 second veteran, the record does not display the warning message.
  
  
 Resolution #1:
 ==============
 The patient look-up functionality, that is incorrectly projecting the 
 previous veteran's information into the current veteran's display, will 
 be modified.  
  
 The software, that was not correctly identifying the veteran, will now be 
 passed the Internal Entry Number (IEN) of the PATIENT File (#2) for the 
 veteran.  Adding the record's IEN as a required parameter for the patient 
 look-up, will protect against any data being carried over.
  
  
 Issue #2:
 =========
 The Document Comments On a Means Test [DG MEANS TEST COMMENTS] menu 
 option only lists the Primary Means Test, for each Income Year on file, 
 in the ANNUAL MEANS TEST File(408.31).  Because Future Dated Income Tests 
 are Non-Primary, they are excluded from the list of available Means Tests.
  
 Resolution #2:
 ==============
 The check for Means Tests by Income Year will be modified to include 
 future dated income tests.  If no Primary Means Test exists for the 
 current income year, and there is a Non-Primary Means Test containing a 
 future dated DATE OF TEST (field #.01 in file #408.31), it will be added 
 to the list of tests available to be selected.
  
 If there are multiple Non-Primary Means Test records containing a future 
 dated DATE OF TEST for the current income year, the last record added to 
 the ANNUAL MEANS TEST File (#408.31) will be added to the list of tests 
 available to be selected.
  
  
 Issue #3:
 =========
 The warning message described in issue #1 scrolls off the screen during 
 patient inquiry.  The warning message displays after the Enrollment 
 information and before displaying the next screen of the Patient 
 information.
  
 Resolution #3:
 ==============
 The prompt 'Press ENTER to continue' has been added to hold the warning 
 message to allow the user to see it before continuing on to the next 
 screen.
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch.
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
  
 IVM-0303-31425: Warning Message Displaying Incorrectly on VAMC screen
 MAD-0403-41995: Document Comments on Means Test
 LIT-0303-70961: WARNING SCROLLS OFF SCREEN in patient inquiry
  
 Overview of NOIS Message(s):
 ---------------------------
  
 NOIS: IVM-0303-31425 Warning Message Displaying Incorrectly on VAMC screen
  
 Problem:  When a record with a rejected status is viewed through any 
 patient look-up menu option, the subsequent record when viewed, which 
 does not have a rejected status, displays the message from the previous 
 record.
  
 Resolution:  Correct the code that is incorrectly displaying a warning 
 message for the veteran.
  
  
 NOIS: MAD-0403-41995 Document Comments on Means Test
  
 Problem: The Document Comments On a Means Test [DG MEANS TEST COMMENTS] 
 menu option does not recognize future dated income tests.
  
 Resolution: This menu option has not been updated since before future 
 dated Means Tests were established.  The algorithm needs to be changed to 
 look for either the Primary Test for the income Year or the current 
 Future Dated Test, when there is no Primary Test for the current Income 
 Year.
  
  
 NOIS: LIT-0303-70961 WARNING SCROLLS OFF SCREEN in patient inquiry
  
 Problem: The Warning messages scroll off the screen before the user has a 
 chance to read them.
  
 Resolution:
 Add the prompt, 'Press ENTER to continue', so the user can see the 
 warning message before continuing.
  
  
  
 Test Sites:
 -----------
  MADISON
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following menu options (File #19) and all of their descendants be 
 disabled to prevent possible conflicts while running the KIDS Install. 
  
          EGT Impact Report [DGEN EGT IMPACT REPORT]
  
 If installed during the normal workday, it is recommended that the patch 
 be installed during a time with a minimal amount of users on the system.  
 There are numerous menu options that utilize the routines in this patch 
 to display patient data.  Using one of these menu options during the 
 installation of this patch may result in a "NO SOURCE" error.
  
 You may wish to stop the HL7 filers prior to the install to prevent
 possible 'No Source Errors' from occurring. No transmissions will be lost
 if the filers are not stopped first, they will be picked up once the
 filers are restarted.
  
  
 Install Time - 30 minutes
  
  
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
       
 NOTE:  If the routines included in this patch are not currently in 
               your mapped routine set, please skip this step.
   
   3.   COMPONENTS SENT WITH PATCH 
        ------------------------
        The following is a list of the routines included in this patch.  
        The second line of each of these routines now looks like: 
   
            ;;5.3;Registration;**[patch list]**;Aug 13, 1993 
   
                            CHECK^XTSUMBLD results
  
        Routine         Before Patch     After Patch    Patch List 
        -------         ------------     -----------    ----------
        DG10            6376645          6436217        32,109,139,149,182
                                                        326,513
        DGENA6          6800415          6820701        232,327,417,491,513
        DGENEGT1        8991774          9100872        232,417,454,491,513
        DGENRPT1        6617652          6627754        232,306,417,456,491
                                                        513
        DGENRPT2        9938456          9948558        232,306,417,456,491
                                                        513
        DGENRPT3        8694106          8704208        232,306,417,456,491
                                                        513
        DGENRPT4        12053952         12064054       232,306,417,456,491
                                                        513
        DGENUPL7        9768141          9861479        232,367,397,417,379
                                                        431,513
        DGMTREM         2639046          3015537        45,182,513
        DGREG           17732767         17932097       1,32,108,147,149
                                                        182,245,250,513
        DGRPD           21626120         22003456       109,124,121,57,161
                                                        149,286,358,436,445
                                                        489,498,506,513
        DGRPTU          2227574          2291308        108,513
        DPTLK           16844003         16895547       32,72,93,73,136
                                                        157,197,232,265,277
                                                        223,327,244,513
  
         Total number of routines - 13 
   
  
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
    
   5.   Select Installation Option: 
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter DG*5.3*513):
       
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ----------------
        **This is the step to start the installation of this KIDS patch: 
    
        a.  Choose the Install Package(s) option to start the patch
            install.
        b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
            YES//' answer NO (unless otherwise indicated)
        c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
      Options, and Protocols? YES//' answer YES (unless otherwise
      indicated)
        d.  When prompted 'Enter options you wish to mark as 'Out Of
            Order':'  Enter the following options:
   
             EGT Impact Report [DGEN EGT IMPACT REPORT]
  
        e.  When prompted 'Enter protocols you wish to mark as 'Out Of 
            Order':' press <return>.
  
   7.    REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch
        in the mapped routine set.
      
        NOTE: This step is only necessary if you performed step 2 or 
              if you wish to include the routines in your mapped set.
  
   8.  When the installation is complete, be sure to re-start the filers 
       if you chose to stop them.

Routine Information:
====================

Routine Name:
  - DG10


Routine Checksum:

Routine Name:
  - DGENA6

 Before:
   .;If patient's enrollment status not above enrollment group threshold
   .;set status to Rejected:  Initial Application by VAMC)
   .I $G(PRIORITY)'="",'$$ABOVE2^DGENEGT1($G(APP),PRIORITY,$P(PRIGRP,
 U,2)) D  Q
   ..;Find patient's current enrollment record
  
 After:
   .;If patient's enrollment status not above enrollment group threshold
   .;set status to Rejected:  Initial Application by VAMC)
   .I $G(PRIORITY)'="",'$$ABOVE2^DGENEGT1(DFN,$G(APP),PRIORITY,$P(PRIGRP,
 U,2)) D  Q
   ..;Find patient's current enrollment record

Routine Checksum:

Routine Name:
  - DGENEGT1

 Before:
   ;
   ABOVE(ENRPRI,ENRGRP,EGTPRI,EGTGRP,EGTFLG);
   ;Description: This function will determine if the enrollment is above 
 the threshold.
   ;
  
 After:
   ;
   ABOVE(DPTDFN,ENRPRI,ENRGRP,EGTPRI,EGTGRP,EGTFLG);
   ; Description: This function will determine if the enrollment is above
   ; the threshold.
   ;
  
 Removed:
   ; IMPORTANT NOTE:
   ; ===============
   ; Due to the timeline of MEGA Regulations Phase I, changes could
   ; not be made to ^DPTLK to support modifications to the parameters
   ; being passed into this function.
   ;
   ; DO NOT REMOVE THE EGTPRI AND EGTGRP PARAMETERS UNTIL ENR^DPTLK HAS
   ; BEEN MODIFIED !!!
   ;
   ; As a work-around, the EGT settings will be obtained here in order
   ; to support modifications to the EGT type 2 (STOP NEW ENROLLMENTS)
   ; logic.  At a future date, the EGT parameters should be removed as
   ; they are no longer necessary. [ALB/BRM October 11, 2001]
   ;
  
 Before:
   ;Input:
   ; ENRPRI - Enrollment Priority
   ; ENRGRP - Enrollment Sub-Group
   ; EGTPRI - EGT Priority (optional) - not used
   ; EGTGRP - EGT Sub-Group (optional) - not used
   ; EGTFLG - Flag to bypass additional EGT type 2 check (optional)
   ;          It is used by $$ABOVE2 to prevent re-entering the
   ;          sub-priority API ($$SUBPRI^DGENELA4)
   ; Output:
   ; Returns 1 if above 0 below.
   ;
  
 After:
   ;Input:
   ; DPTDFN - Patient File IEN
   ; ENRPRI - Enrollment Priority
   ; ENRGRP - Enrollment Sub-Group
   ; EGTPRI - EGT Priority (optional) - not used
   ; EGTGRP - EGT Sub-Group (optional) - not used
   ; EGTFLG - Flag to bypass additional EGT type 2 check (optional)
   ;          It is used by $$ABOVE2 to prevent re-entering the
   ;          sub-priority API ($$SUBPRI^DGENELA4)
   ; Output:
   ; Returns 1 if above 0 below.
   ;
  
 Before:
   ;EGT type 2 - Stop New Enrollments
   ; or EGT type 4 - Enrollment Decision (ESP DG*5.3*491)
   I EGT("TYPE")=2!(EGT("TYPE")=4) D  Q ABOVE
   .S:'$G(DFN) DFN=+$G(DPTDFN)
   .S ABOVE=0
   .;do check for priorities 7 and 8
   .I ENRPRI>6&(ENRPRI=EGT("PRIORITY")) D  Q
   ..I ENRGRP'>EGT("SUBGRP") S ABOVE=1
   ..Q:$G(EGTFLG)
   ..I EGT("TYPE")=4,ENRPRI=EGT("PRIORITY"),ENRGRP'=$$SUBPRI^DGENELA4
 (DFN,ENRPRI,ENRGRP) S ABOVE=0 Q
   ..I ENRGRP=EGT("SUBGRP"),ENRGRP'=$$SUBPRI^DGENELA4(DFN,ENRPRI,ENRGRP) 
 S ABOVE=0
   .I ENRPRI'>EGT("PRIORITY") S ABOVE=1 Q
   ;
  
 After:
   ;EGT type 2 - Stop New Enrollments
   ; or EGT type 4 - Enrollment Decision (ESP DG*5.3*491)
   I EGT("TYPE")=2!(EGT("TYPE")=4) D  Q ABOVE
   .S ABOVE=0
   .;do check for priorities 7 and 8
   .I ENRPRI>6&(ENRPRI=EGT("PRIORITY")) D  Q
   ..I ENRGRP'>EGT("SUBGRP") S ABOVE=1
   ..Q:$G(EGTFLG)
   ..I EGT("TYPE")=4,ENRPRI=EGT("PRIORITY"),ENRGRP'=$$SUBPRI^DGENELA4
 (DPTDFN,ENRPRI,ENRGRP) S ABOVE=0 Q
   ..I 
 ENRGRP=EGT("SUBGRP"),ENRGRP'=$$SUBPRI^DGENELA4(DPTDFN,ENRPRI,ENRGRP) S 
 ABOVE=0
   .I ENRPRI'>EGT("PRIORITY") S ABOVE=1 Q
   ;
  
 Before:
   ;
   ABOVE2(ENRDT,PRIORITY,SUBGRP);
   ;
   ; Input: ENRDT     - enrollment effective date
   ;        PRIORITY  - enrollment priority
   ;        SUBGRP    - enrollment sub-priority (internal numeric value)
   ;
  
 After:
   ;
   ABOVE2(DPTDFN,ENRDT,PRIORITY,SUBGRP);
   ;
   ; Input: DPTDFN    - Patient File IEN
   ;        ENRDT     - enrollment effective date
   ;        PRIORITY  - enrollment priority
   ;        SUBGRP    - enrollment sub-priority (internal numeric value)
   ;
  
 Before:
   Q:TODAY<EGT("EFFDATE") 1 
   Q:EGT("TYPE")#2 $$ABOVE(PRIORITY,SUBGRP,"","",1)  ;If EGT type 1 or 3
   I '$$ABOVE(PRIORITY,SUBGRP,"","",1) Q 0
   I PRIORITY=EGT("PRIORITY"),ENRDT,ENRDT'<EGT("EFFDATE") D
  
 After:
   Q:TODAY<EGT("EFFDATE") 1
   Q:EGT("TYPE")#2 $$ABOVE(DPTDFN,PRIORITY,SUBGRP,"","",1)  ;If EGT type 1 
 or 3
   I '$$ABOVE(DPTDFN,PRIORITY,SUBGRP,"","",1) Q 0
   I PRIORITY=EGT("PRIORITY"),ENRDT,ENRDT'<EGT("EFFDATE") D

Routine Checksum:

Routine Name:
  - DGENRPT1


Routine Checksum:

Routine Name:
  - DGENRPT2


Routine Checksum:

Routine Name:
  - DGENRPT3


Routine Checksum:

Routine Name:
  - DGENRPT4


Routine Checksum:

Routine Name:
  - DGENUPL7


Routine Checksum:

Routine Name:
  - DGMTREM


Routine Checksum:

Routine Name:
  - DGRPTU


Routine Checksum:

Routine Name:
  - DPTLK


Routine Checksum:

Routine Name:
  - DGRPD


Routine Checksum:

Routine Name:
  - DGREG


Routine Checksum:

=============================================================================
User Information:                               
Entered By  : MULLER,RICHARD                 Date Entered : APR 17, 2003
Completed By: HUA,PATRICK                   Date Completed: MAY 28, 2003
Released By : GROOMS,ANTHONY E             Date Released : MAY 28, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
