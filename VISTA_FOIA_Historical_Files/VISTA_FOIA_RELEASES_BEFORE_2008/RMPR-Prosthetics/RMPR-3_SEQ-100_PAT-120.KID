Released RMPR*3*120 SEQ #100
Extracted from mail message
**KIDS**:RMPR*3.0*120^

**INSTALL NAME**
RMPR*3.0*120
"BLD",5984,0)
RMPR*3.0*120^PROSTHETICS^0^3060301^y
"BLD",5984,1,0)
^^8^8^3060301^^^
"BLD",5984,1,1,0)
1. Up-arrow out of option [RMPR INQ SUSPENSE] and going to option [RMPR 
"BLD",5984,1,2,0)
   SUSP] will use the same patient from the initial inquiry, instead of
"BLD",5984,1,3,0)
   prompting for new patient name.
"BLD",5984,1,4,0)
 
"BLD",5984,1,5,0)
2. Consult cloning carries over inactive ICD9 diagnosis codes.
"BLD",5984,1,6,0)
 
"BLD",5984,1,7,0)
3. Bad entries (null) in the VISIT File (9000010) when RMPR PCE 
"BLD",5984,1,8,0)
   BACKGROUND job running. 
"BLD",5984,4,0)
^9.64PA^^
"BLD",5984,6.3)
2
"BLD",5984,"ABPKG")
n
"BLD",5984,"KRN",0)
^9.67PA^8989.52^19
"BLD",5984,"KRN",.4,0)
.4
"BLD",5984,"KRN",.401,0)
.401
"BLD",5984,"KRN",.402,0)
.402
"BLD",5984,"KRN",.403,0)
.403
"BLD",5984,"KRN",.5,0)
.5
"BLD",5984,"KRN",.84,0)
.84
"BLD",5984,"KRN",3.6,0)
3.6
"BLD",5984,"KRN",3.8,0)
3.8
"BLD",5984,"KRN",9.2,0)
9.2
"BLD",5984,"KRN",9.8,0)
9.8
"BLD",5984,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5984,"KRN",9.8,"NM",1,0)
RMPRS^^0^30300353
"BLD",5984,"KRN",9.8,"NM",2,0)
RMPRPCEA^^0^52102527
"BLD",5984,"KRN",9.8,"NM",3,0)
RMPRPCEB^^0^21611450
"BLD",5984,"KRN",9.8,"NM","B","RMPRPCEA",2)

"BLD",5984,"KRN",9.8,"NM","B","RMPRPCEB",3)

"BLD",5984,"KRN",9.8,"NM","B","RMPRS",1)

"BLD",5984,"KRN",19,0)
19
"BLD",5984,"KRN",19,"NM",0)
^9.68A^^
"BLD",5984,"KRN",19.1,0)
19.1
"BLD",5984,"KRN",101,0)
101
"BLD",5984,"KRN",409.61,0)
409.61
"BLD",5984,"KRN",771,0)
771
"BLD",5984,"KRN",870,0)
870
"BLD",5984,"KRN",8989.51,0)
8989.51
"BLD",5984,"KRN",8989.52,0)
8989.52
"BLD",5984,"KRN",8994,0)
8994
"BLD",5984,"KRN","B",.4,.4)

"BLD",5984,"KRN","B",.401,.401)

"BLD",5984,"KRN","B",.402,.402)

"BLD",5984,"KRN","B",.403,.403)

"BLD",5984,"KRN","B",.5,.5)

"BLD",5984,"KRN","B",.84,.84)

"BLD",5984,"KRN","B",3.6,3.6)

"BLD",5984,"KRN","B",3.8,3.8)

"BLD",5984,"KRN","B",9.2,9.2)

"BLD",5984,"KRN","B",9.8,9.8)

"BLD",5984,"KRN","B",19,19)

"BLD",5984,"KRN","B",19.1,19.1)

"BLD",5984,"KRN","B",101,101)

"BLD",5984,"KRN","B",409.61,409.61)

"BLD",5984,"KRN","B",771,771)

"BLD",5984,"KRN","B",870,870)

"BLD",5984,"KRN","B",8989.51,8989.51)

"BLD",5984,"KRN","B",8989.52,8989.52)

"BLD",5984,"KRN","B",8994,8994)

"BLD",5984,"QUES",0)
^9.62^^
"BLD",5984,"REQB",0)
^9.611^2^1
"BLD",5984,"REQB",2,0)
RMPR*3.0*114^2
"BLD",5984,"REQB","B","RMPR*3.0*114",2)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
120^3060301
"PKG",101,22,1,"PAH",1,1,0)
^^8^8^3060301
"PKG",101,22,1,"PAH",1,1,1,0)
1. Up-arrow out of option [RMPR INQ SUSPENSE] and going to option [RMPR 
"PKG",101,22,1,"PAH",1,1,2,0)
   SUSP] will use the same patient from the initial inquiry, instead of
"PKG",101,22,1,"PAH",1,1,3,0)
   prompting for new patient name.
"PKG",101,22,1,"PAH",1,1,4,0)
 
"PKG",101,22,1,"PAH",1,1,5,0)
2. Consult cloning carries over inactive ICD9 diagnosis codes.
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
3. Bad entries (null) in the VISIT File (9000010) when RMPR PCE 
"PKG",101,22,1,"PAH",1,1,8,0)
   BACKGROUND job running. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RMPRPCEA")
0^2^B52102527^B50015987
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82,78,114,120**;Feb 09, 1996
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ; RMS  10/1/03 Patch 78 - Change Service connected, and environmental
"RTN","RMPRPCEA",5,0)
 ;                         indicators (Agent Orange, Ionizing Radiation,
"RTN","RMPRPCEA",6,0)
 ;                         Environmental Contaminants, Military Sexual
"RTN","RMPRPCEA",7,0)
 ;                         Trauma, Head/Neck Cancer, and Combat Veteran
"RTN","RMPRPCEA",8,0)
 ;                         Status) to come from new BA fields if they
"RTN","RMPRPCEA",9,0)
 ;                         exist.
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",12,0)
 ;
"RTN","RMPRPCEA",13,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",14,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",15,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",16,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",17,0)
 ;
"RTN","RMPRPCEA",18,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",19,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",20,0)
 ; D NEWVAR subroutine removed for functionality  01/31/05  WLC
"RTN","RMPRPCEA",21,0)
 ;
"RTN","RMPRPCEA",22,0)
 N RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",23,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",24,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN,RMSCON
"RTN","RMPRPCEA",25,0)
 N RMMST,RMHNC,RMCBV,RMPRTPCE
"RTN","RMPRPCEA",26,0)
 ; PATCH 78, RMS - 10/1/2003, Billing aware related variables
"RTN","RMPRPCEA",27,0)
 N RMBASCON,RMBAAO,RMBAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV,RMBAICD9,RMLOOP
"RTN","RMPRPCEA",28,0)
 N RMPROV,RMCPDT,DXERR,SICD
"RTN","RMPRPCEA",29,0)
 ;
"RTN","RMPRPCEA",30,0)
 S RMERR=1
"RTN","RMPRPCEA",31,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",32,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",33,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",34,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",35,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",36,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",37,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",38,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",39,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",40,0)
 .S RMERR=-2
"RTN","RMPRPCEA",41,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",42,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",43,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",44,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01),SPACES=""
"RTN","RMPRPCEA",45,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",46,0)
 .F I=1:1:42-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",47,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",48,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTA)
"RTN","RMPRPCEA",49,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",50,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",51,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",52,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTA
"RTN","RMPRPCEA",53,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",54,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",55,0)
 ; initialize temp file.
"RTN","RMPRPCEA",56,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",57,0)
 ;
"RTN","RMPRPCEA",58,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",59,0)
 D GETDATA G:$G(DXERR) SENDPCEX   ;quit if inactive diagnosis RMPR*120
"RTN","RMPRPCEA",60,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",61,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",62,0)
 ;
"RTN","RMPRPCEA",63,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",64,0)
 D BUILD
"RTN","RMPRPCEA",65,0)
 ;
"RTN","RMPRPCEA",66,0)
 ; now send
"RTN","RMPRPCEA",67,0)
 D SENDIT
"RTN","RMPRPCEA",68,0)
 ;
"RTN","RMPRPCEA",69,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",70,0)
 ;
"RTN","RMPRPCEA",71,0)
 ; clear the temp file
"RTN","RMPRPCEA",72,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",73,0)
 ;
"RTN","RMPRPCEA",74,0)
 ; return
"RTN","RMPRPCEA",75,0)
 Q RMERR
"RTN","RMPRPCEA",76,0)
 ;
"RTN","RMPRPCEA",77,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",78,0)
 K RMDA,RMDA2
"RTN","RMPRPCEA",79,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",80,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",81,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",82,0)
 D NOW^%DTC
"RTN","RMPRPCEA",83,0)
 S RMDANOW=%
"RTN","RMPRPCEA",84,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",85,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",86,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",87,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",88,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",89,0)
 S RMSCON=0
"RTN","RMPRPCEA",90,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",91,0)
 ;==============================
"RTN","RMPRPCEA",92,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",93,0)
 S RMETYP="P"
"RTN","RMPRPCEA",94,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",95,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",96,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",97,0)
 S RMPROV=@RMDA2@(8.6,"I")
"RTN","RMPRPCEA",98,0)
 S RMCPDT=@RMDA2@(8.4,"I")
"RTN","RMPRPCEA",99,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",100,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",101,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",102,0)
 ; PATCH 78, RMS - 10/1/2003, billing aware related variables
"RTN","RMPRPCEA",103,0)
 K RMBAICD9,RMBAAO,RMBASCON,RMBAAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV
"RTN","RMPRPCEA",104,0)
 I '$D(^RMPR(660,RMIE60,"BA1")) G GTDT  ; no BA data, skip retrieval
"RTN","RMPRPCEA",105,0)
 F RMLOOP=30:1:33 D
"RTN","RMPRPCEA",106,0)
 . N RMBAREC S RMBAREC=RMLOOP-29
"RTN","RMPRPCEA",107,0)
 . S RMBAICD9(RMBAREC)=@RMDA2@(RMLOOP,"I"),SICD=RMBAICD9(RMBAREC) I SICD'="" S:$P($G(^ICD9(SICD,0)),U,9) DXERR=1
"RTN","RMPRPCEA",108,0)
 . S RMBAAO(RMBAREC)=@RMDA2@((RMLOOP+.1),"I")
"RTN","RMPRPCEA",109,0)
 . S RMBAIR(RMBAREC)=@RMDA2@((RMLOOP+.2),"I")
"RTN","RMPRPCEA",110,0)
 . S RMBASCON(RMBAREC)=@RMDA2@((RMLOOP+.3),"I")
"RTN","RMPRPCEA",111,0)
 . S RMBAEC(RMBAREC)=@RMDA2@((RMLOOP+.4),"I")
"RTN","RMPRPCEA",112,0)
 . S RMBAMST(RMBAREC)=@RMDA2@((RMLOOP+.5),"I")
"RTN","RMPRPCEA",113,0)
 . S RMBAHNC(RMBAREC)=@RMDA2@((RMLOOP+.6),"I")
"RTN","RMPRPCEA",114,0)
 . S RMBACBV(RMBAREC)=@RMDA2@((RMLOOP+.7),"I")
"RTN","RMPRPCEA",115,0)
 ; Retrieve order number
"RTN","RMPRPCEA",116,0)
GTDT S RMPTR123=@RMDA2@(8.9,"I")
"RTN","RMPRPCEA",117,0)
 S RMODENT=$$GET1^DIQ(123,RMPTR123_",",.03)
"RTN","RMPRPCEA",118,0)
 ;get Date of Death.
"RTN","RMPRPCEA",119,0)
 D DEM^VADPT
"RTN","RMPRPCEA",120,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",121,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",122,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",123,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",124,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",125,0)
 ;
"RTN","RMPRPCEA",126,0)
 S RMMST="",RMCBV="",RMHNC=""
"RTN","RMPRPCEA",127,0)
 Q
"RTN","RMPRPCEA",128,0)
 ;
"RTN","RMPRPCEA",129,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",130,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI"),RMAPI
"RTN","RMPRPCEA",131,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",132,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",133,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",134,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",135,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",136,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",137,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",138,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",139,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",140,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",141,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",142,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",143,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",144,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",145,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",146,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",147,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",148,0)
 ; ------------Military Sexual Trauma----------
"RTN","RMPRPCEA",149,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=RMMST
"RTN","RMPRPCEA",150,0)
 ; -------------Head/Neck Cancer---------------
"RTN","RMPRPCEA",151,0)
 S @RMAPI@("ENCOUNTER",1,"HNC")=RMHNC
"RTN","RMPRPCEA",152,0)
 ; --------------Combat Veteran---------
"RTN","RMPRPCEA",153,0)
 S @RMAPI@("ENCOUNTER",1,"CV")=RMCBV
"RTN","RMPRPCEA",154,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",155,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",156,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",157,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",158,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",159,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",160,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",161,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",162,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",163,0)
 ; -------------- procedures -----------------
"RTN","RMPRPCEA",164,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",165,0)
 ; ---------------- Quantity -----------------
"RTN","RMPRPCEA",166,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",167,0)
 ; -------------- Procedures -----------------
"RTN","RMPRPCEA",168,0)
 I '$D(RMBAICD9(1)) D  G BLD1
"RTN","RMPRPCEA",169,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",170,0)
 ;
"RTN","RMPRPCEA",171,0)
 F RMLOOP=1:1:99 Q:$G(RMBAICD9(RMLOOP))=""  D
"RTN","RMPRPCEA",172,0)
 . S @RMAPI@("DX/PL",RMLOOP,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",173,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL AO")=$G(RMBAAO(RMLOOP))
"RTN","RMPRPCEA",174,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL IR")=$G(RMBAIR(RMLOOP))
"RTN","RMPRPCEA",175,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL SC")=$G(RMBASCON(RMLOOP))
"RTN","RMPRPCEA",176,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL EC")=$G(RMBAEC(RMLOOP))
"RTN","RMPRPCEA",177,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL MST")=$G(RMBAMST(RMLOOP))
"RTN","RMPRPCEA",178,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL HNC")=$G(RMBAHNC(RMLOOP))
"RTN","RMPRPCEA",179,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL CV")=$G(RMBACBV(RMLOOP))
"RTN","RMPRPCEA",180,0)
 . I RMLOOP=1 D  Q
"RTN","RMPRPCEA",181,0)
 . . S @RMAPI@("DX/PL",RMLOOP,"PRIMARY")=RMLOOP
"RTN","RMPRPCEA",182,0)
 . . S RMDIAG=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",183,0)
 . . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",184,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS "_RMLOOP)=$G(RMBAICD9(RMLOOP))  ; only one procedure per send
"RTN","RMPRPCEA",185,0)
 ;
"RTN","RMPRPCEA",186,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",187,0)
BLD1 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",188,0)
 S @RMAPI@("PROCEDURE",1,"ORD PROVIDER")=RMPROV
"RTN","RMPRPCEA",189,0)
 S @RMAPI@("PROCEDURE",1,"EVENT D/T")=RMCPDT
"RTN","RMPRPCEA",190,0)
 ; ------------- Order Reference -------------
"RTN","RMPRPCEA",191,0)
 S @RMAPI@("PROCEDURE",1,"ORD REFERENCE")=RMODENT
"RTN","RMPRPCEA",192,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",193,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",194,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",195,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",196,0)
 Q
"RTN","RMPRPCEA",197,0)
 ;
"RTN","RMPRPCEA",198,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",199,0)
 K RMPROB,RMPRTPCE
"RTN","RMPRPCEA",200,0)
 S (RMPRCPER,RMPROB)=0
"RTN","RMPRPCEA",201,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",202,0)
 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",203,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",204,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",205,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",206,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",207,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",208,0)
 I $G(RMPCE),$G(RMPRCPER) S RMPRTPCE=RJ_"^"_RMHLOC,RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",209,0)
 ;
"RTN","RMPRPCEA",210,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",211,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",212,0)
 K RMUPD
"RTN","RMPRPCEA",213,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",214,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",215,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",216,0)
 Q
"RTN","RMPRPCEA",217,0)
 ;
"RTN","RMPRPCEB")
0^3^B21611450^B20818586
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ; 1/23/04 8:09am
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,82,78,114,120**;Feb 09, 1996
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 ;KAM Patch #82 06/21/2004 - Add more robust text to 'Missing
"RTN","RMPRPCEB",9,0)
 ;                           Prosthetics Clinic PCE error message
"RTN","RMPRPCEB",10,0)
 ;
"RTN","RMPRPCEB",11,0)
 ;WLC Patch #78 02/03/3005 - added NEW statement for error message
"RTN","RMPRPCEB",12,0)
 ;                           variables defined for Patch 82.
"RTN","RMPRPCEB",13,0)
 ;
"RTN","RMPRPCEB",14,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",15,0)
 Q
"RTN","RMPRPCEB",16,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",17,0)
 N RERRMSG,RERRMSG2  ; correction for patch 82  02/03/05 WLC
"RTN","RMPRPCEB",18,0)
 S IO=0,RMAIL=1
"RTN","RMPRPCEB",19,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",20,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",21,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",22,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",23,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",24,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",25,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",26,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))-1     ;starts at proper ien RMPR*120
"RTN","RMPRPCEB",27,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",28,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",29,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",30,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",31,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",32,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",33,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",34,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",35,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",36,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",37,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",38,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",39,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",40,0)
 .S RMICD9=$P(RM610,U,8) I RMICD9'="" Q:$P($G(^ICD9(RMICD9,0)),U,9)  ;quit if DX code inactive RMPR*120
"RTN","RMPRPCEB",41,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",42,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",43,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",44,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",45,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",46,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",47,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",48,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",49,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",50,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",51,0)
 ;
"RTN","RMPRPCEB",52,0)
 D PROC
"RTN","RMPRPCEB",53,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",54,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",55,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",56,0)
 G EXIT
"RTN","RMPRPCEB",57,0)
 ;
"RTN","RMPRPCEB",58,0)
PCEFLG ;
"RTN","RMPRPCEB",59,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",60,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",61,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",62,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",63,0)
 Q
"RTN","RMPRPCEB",64,0)
 ;
"RTN","RMPRPCEB",65,0)
PROC ;process
"RTN","RMPRPCEB",66,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",67,0)
 .;call PCE Interface
"RTN","RMPRPCEB",68,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",69,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",70,0)
 . I RMC<1 D
"RTN","RMPRPCEB",71,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",72,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",73,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",74,0)
 ..;Added next line for RMPR*3*82
"RTN","RMPRPCEB",75,0)
 ..I '$G(RMLOC) S ^TMP($J,"RMPRERR",RK)=^TMP($J,"RMPRERR",RK)_$G(RERRMSG)_$G(RERRMSG2)
"RTN","RMPRPCEB",76,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",77,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",78,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",79,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",80,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,65)
"RTN","RMPRPCEB",81,0)
 .....K RMPROB($J,R1,"ERROR1",R2,R3,R4)
"RTN","RMPRPCEB",82,0)
 K RMPROB
"RTN","RMPRPCEB",83,0)
 Q
"RTN","RMPRPCEB",84,0)
 ;
"RTN","RMPRPCEB",85,0)
MES1 ;
"RTN","RMPRPCEB",86,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",87,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",88,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",89,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",90,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",91,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",92,0)
 Q
"RTN","RMPRPCEB",93,0)
MES2 ;
"RTN","RMPRPCEB",94,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",95,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",96,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",97,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",98,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",99,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",100,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",101,0)
 D ^XMD
"RTN","RMPRPCEB",102,0)
 D NOW^%DTC
"RTN","RMPRPCEB",103,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",104,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",105,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",106,0)
 Q
"RTN","RMPRPCEB",107,0)
 ;
"RTN","RMPRPCEB",108,0)
BUILD ;
"RTN","RMPRPCEB",109,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",110,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",111,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",112,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",113,0)
 Q
"RTN","RMPRPCEB",114,0)
 ;
"RTN","RMPRPCEB",115,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",116,0)
 K ^TMP($J)
"RTN","RMPRPCEB",117,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",118,0)
 Q
"RTN","RMPRS")
0^1^B30300353^B30115630
"RTN","RMPRS",1,0)
RMPRS ;PHX/HNC/RFM,RVD-ADD SUSPENSE RECORD ;8/29/1994
"RTN","RMPRS",2,0)
 ;;3.0;PROSTHETICS;**26,28,30,45,52,62,120**;Feb 09, 1996
"RTN","RMPRS",3,0)
 ;
"RTN","RMPRS",4,0)
 ;  HNC - patch 52 - 9/22/00 Modify INQ - sub.
"RTN","RMPRS",5,0)
 ;                           Add KILL^XUSCLEAN on exit to kill
"RTN","RMPRS",6,0)
 ;                           all variables.
"RTN","RMPRS",7,0)
 ;  HNC - patch 52 - 10/5/00 New RMPR,RMPRNAM,RMPRDOB,RMPRSSN,RMPRSSNE
"RTN","RMPRS",8,0)
 ;                           RMPRCNUM before appt mgt
"RTN","RMPRS",9,0)
 ;  RVD - patch 62 - 10/13/01 remove link to Patient Management
"RTN","RMPRS",10,0)
 ;                            call rotine RMPREOL
"RTN","RMPRS",11,0)
 ;                            suspense print message
"RTN","RMPRS",12,0)
 ;
"RTN","RMPRS",13,0)
EN ;ADD SUSPENSE RECORD
"RTN","RMPRS",14,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRS",15,0)
 S DIC="^DPT(",DIC(0)="AEQM" D ^DIC G:Y'>0 EXIT S RMPRDFN=+Y
"RTN","RMPRS",16,0)
 S X=DT,DIC="^RMPR(668,",DIC(0)="AEQLM",DLAYGO=668,DIC("DR")="1////^S X=RMPRDFN;8////^S X=DUZ;2////^S X=RMPR(""STA"")" K DINUM,D0,DD,DO D FILE^DICN K DLAYGO G:Y'>0 EX S (RDA,DA)=+Y
"RTN","RMPRS",17,0)
 S DIE="^RMPR(668,",DR="3;4"
"RTN","RMPRS",18,0)
 L +^RMPR(668,RDA,0):1 I $T=0 W $C(7),?5,!,"Someone else is editing this record" G EX
"RTN","RMPRS",19,0)
 D ^DIE L -^RMPR(668,RDA,0)
"RTN","RMPRS",20,0)
 I '$P(^RMPR(668,RDA,0),U,3) S DA=RDA,DIK="^RMPR(668," D ^DIK W !,$C(7),?5,"Deleted..."
"RTN","RMPRS",21,0)
EX K X,DIC,DIE,DR,Y,RMPRDFN G EN
"RTN","RMPRS",22,0)
CL ;CLOSE OUT SUSPENSE RECORD
"RTN","RMPRS",23,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRS",24,0)
 K DIE,DR,Y,DA,RMPRA,^TMP("RMSU",$J)
"RTN","RMPRS",25,0)
 S RMPRCLOS=1 D DICDPT S (I,RMTOI)=0 G:Y<0!($D(DTOUT))!(Y="^") EXIT
"RTN","RMPRS",26,0)
 F  S I=$O(^RMPR(668,"C",+Y,I)) Q:I'>0  I $D(^RMPR(668,I,0)) S:'$P(^(0),U,5) ^TMP("RMSU",$J,9999999-$P($G(^RMPR(668,I,0)),"^",1),I)=I,RMTOI=RMTOI+1
"RTN","RMPRS",27,0)
 D ENT G:'IEN EXIT  L +^RMPR(668,IEN,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRS",28,0)
 S RMPRA=IEN,DR="2;4;7",DA=IEN,DIE=DIC D ^DIE G:$D(Y) EX1
"RTN","RMPRS",29,0)
 S DR="5//^S X=DT;6////^S X=DUZ",DA=RMPRA D ^DIE L -^RMPR(668,RMPRA,0)
"RTN","RMPRS",30,0)
EX1 I '$P(^RMPR(668,RMPRA,0),U,5) W !!,"SUSPENSE RECORD WAS NOT CLOSED OUT",$C(7) S $P(^(0),U,6)=""
"RTN","RMPRS",31,0)
 W ! G CL
"RTN","RMPRS",32,0)
EXIT W:$D(FL1) @IOF K %,RMPRCLOS,DIC,DIE,DR,CITN,IEN,Y,DA,RDA,FL1,RB,RD,RT,RIE,RO,RP,RR,RZ,RX,RMPRFLAG,^TMP("RMSU",$J),RMI,RMIEN,RML,RMTOI,I,J,RMDES,RMQUIT,RMSEL Q
"RTN","RMPRS",33,0)
EN2 ;EDIT SUSPENSE RECORD
"RTN","RMPRS",34,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRS",35,0)
 D DICDPT G:Y<0!($D(DTOUT))!(Y="^") EXIT
"RTN","RMPRS",36,0)
 ;
"RTN","RMPRS",37,0)
 ;
"RTN","RMPRS",38,0)
REV ;reverse look-up.--HNC--change to $O(^RMPR(668,"C",ien,n),-1)
"RTN","RMPRS",39,0)
ENT ;sort/display
"RTN","RMPRS",40,0)
 S (RMI,RML,RMTOI,RMQUIT,IEN,RMSEL,OUT)=0
"RTN","RMPRS",41,0)
 W !,"CHOOSE FROM:"
"RTN","RMPRS",42,0)
 S RMPRJ=""
"RTN","RMPRS",43,0)
 F  S RMPRJ=$O(^RMPR(668,"C",RMPRDFN,RMPRJ),-1) Q:RMPRJ=""  Q:OUT=1  Q:IEN>0  D
"RTN","RMPRS",44,0)
 .S RMTOI=RMTOI+1
"RTN","RMPRS",45,0)
 .S RMI=RMI+1
"RTN","RMPRS",46,0)
 .;S RML=RML+1
"RTN","RMPRS",47,0)
 .S ^TMP("RMSU",$J,RMI)=RMPRDFN_U_RMPRJ
"RTN","RMPRS",48,0)
 .I $Y>20 D DIS W @IOF Q
"RTN","RMPRS",49,0)
 .D WRI
"RTN","RMPRS",50,0)
 .Q:(RMQUIT)!(IEN)!(RMSEL)
"RTN","RMPRS",51,0)
 G:RMSEL ENT
"RTN","RMPRS",52,0)
 G:IEN PROC
"RTN","RMPRS",53,0)
 I 'RMI W !!,"***** PATIENT HAS NO SUSPENSE RECORD!!!!" Q
"RTN","RMPRS",54,0)
 ;I RMQUIT W !!,"***** NO SELECTION MADE!!!" Q
"RTN","RMPRS",55,0)
 D DIS
"RTN","RMPRS",56,0)
 ;W !!,"[<return> or '^' to Quit] or Choose Number 1-",RMI W ": " R X:DTIME I '$T Q
"RTN","RMPRS",57,0)
 ;I X=""!(X="^")!('$D(X)) W !!,"***** NO SELECTION MADE!!!" Q
"RTN","RMPRS",58,0)
 ;I '$D(^TMP("RMSU",$J,+X)) W !,$C(7),"****INVALID RESPONSE, Please choose a NUMBER within the range!!!!" G ENT
"RTN","RMPRS",59,0)
 ;S IEN=$P(^TMP("RMSU",$J,+X),U,2)
"RTN","RMPRS",60,0)
 Q
"RTN","RMPRS",61,0)
 ;
"RTN","RMPRS",62,0)
PROC ;
"RTN","RMPRS",63,0)
 L +^RMPR(668,IEN,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPRS",64,0)
 ;
"RTN","RMPRS",65,0)
 S Y=""
"RTN","RMPRS",66,0)
 S RO=$G(^RMPR(668,+IEN,0)),Y=$P(^(0),U,1)
"RTN","RMPRS",67,0)
 W "   ",$$DAT1^RMPRUTL1(Y)
"RTN","RMPRS",68,0)
 S DFN=RMPRDFN D DEM^VADPT
"RTN","RMPRS",69,0)
 W "  ",VADM(1)
"RTN","RMPRS",70,0)
 W "  ",$$STATUS^RMPREOU(+IEN)
"RTN","RMPRS",71,0)
 S Y=+IEN
"RTN","RMPRS",72,0)
 S DIC="^RMPR(668,"
"RTN","RMPRS",73,0)
 Q:$D(RMPRFLAG)!$D(RMPRCLOS)!$D(FLAG)
"RTN","RMPRS",74,0)
 S DIE=DIC,DA=Y,DR=".01;2R;1R;3;5;I $P(^RMPR(668,DA,0),U,5),'$P(^(0),U,6) S $P(^(0),U,6)=DUZ;4;7" D ^DIE I $D(DA),$P(^RMPR(668,DA,0),U,5)="" S $P(^(0),U,6)=""
"RTN","RMPRS",75,0)
 L -^RMPR(668,IEN,0) G EN2
"RTN","RMPRS",76,0)
 ;
"RTN","RMPRS",77,0)
INQ ;Inquire to Suspense entry point
"RTN","RMPRS",78,0)
 ;
"RTN","RMPRS",79,0)
 W @IOF
"RTN","RMPRS",80,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRS",81,0)
 D HOME^%ZIS
"RTN","RMPRS",82,0)
 S RMPRFLAG=1
"RTN","RMPRS",83,0)
 ;get patient dfn
"RTN","RMPRS",84,0)
 D DICDPT I Y'>0!($D(DTOUT))!(Y="^") K RMPRDFN G EXIT
"RTN","RMPRS",85,0)
 S RMPRDFN=+Y
"RTN","RMPRS",86,0)
 D REV I 'IEN K RMPRDFN G EXIT
"RTN","RMPRS",87,0)
 ;call new suspense processing
"RTN","RMPRS",88,0)
 N RMPREOY,DA
"RTN","RMPRS",89,0)
 S (RMPREOY,DA)=IEN D VIEWCP^RMPREO23
"RTN","RMPRS",90,0)
 ;clean up - patch 52
"RTN","RMPRS",91,0)
 D KILL^XUSCLEAN
"RTN","RMPRS",92,0)
 Q
"RTN","RMPRS",93,0)
 ;
"RTN","RMPRS",94,0)
EXT S RO=0 F  S RO=$O(^RMPR(668,IEN,2,RO)) Q:RO'>0  W !,^RMPR(668,IEN,2,RO,0)
"RTN","RMPRS",95,0)
 Q
"RTN","RMPRS",96,0)
 ;
"RTN","RMPRS",97,0)
ACT W !!,"ACTION TAKEN: "
"RTN","RMPRS",98,0)
 I $D(^RMPR(668,IEN,3,0)) S RO=0 F  S RO=$O(^RMPR(668,IEN,3,RO)) Q:RO'>0  W !,^RMPR(668,IEN,3,RO,0)
"RTN","RMPRS",99,0)
 E  W "NONE RECORDED"
"RTN","RMPRS",100,0)
 W ! Q
"RTN","RMPRS",101,0)
LINK ;CLOSE OUT SUSPENSE ENTRY FOR SELECTED PATIENT
"RTN","RMPRS",102,0)
 ;call routine RMPREOL if PCE link to suspense, patch #62.
"RTN","RMPRS",103,0)
SUSP I $D(^TMP($J,"RMPRPCE",660)) D EN^RMPREOL,FULL^VALM1 Q
"RTN","RMPRS",104,0)
 I '$D(^TMP($J,"RMPRPCE",660)) D EN^RMPREO
"RTN","RMPRS",105,0)
 D FULL^VALM1
"RTN","RMPRS",106,0)
 Q
"RTN","RMPRS",107,0)
 ;add new module HNC 3-2-00
"RTN","RMPRS",108,0)
 N Y,RO,RR,RT,RX,RZ,J,RB,RIE,RD,RI,FLAG K ^TMP("RMSU",$J)
"RTN","RMPRS",109,0)
 Q:'$D(RMPRDFN)  Q:'$D(^RMPR(668,"C",RMPRDFN))
"RTN","RMPRS",110,0)
 S RZ="S RX=$P(RO,U,3),RR=$S(RX=1:""PSC"",RX=2:""2421"",RX=3:""2237"",RX=4:""2529-3"",RX=5:""2529-7"",RX=6:""2474"",RX=7:""2431"",RX=8:""2914"",RX=9:""OTHER"",RX=10:""2520"",RX=11:""STOCK ISSUE"",1:""NONE"")"
"RTN","RMPRS",111,0)
 S (RD,RI)=0 F  S RD=$O(^RMPR(668,"C",RMPRDFN,RD)) Q:RD'>0  I $P(^RMPR(668,RD,0),U,5)="" S FLAG=1
"RTN","RMPRS",112,0)
 Q:'$D(FLAG)
"RTN","RMPRS",113,0)
 S %=1 W $C(7),!,"Suspense Records exist on this Patient.  Do you wish to View/Edit them" D YN^DICN G:%=-1!(%=2)!($D(DTOUT)) EXIT I %=0 W !,"Answer `YES` or `NO`" G LINK
"RTN","RMPRS",114,0)
 S Y=RMPRDFN,(I,RMTOI)=0 F  S I=$O(^RMPR(668,"C",+Y,I)) Q:I'>0  I $D(^RMPR(668,I,0)) S:'$P(^(0),U,5) ^TMP("RMSU",$J,9999999-$P($G(^RMPR(668,I,0)),"^",1),I)=I,RMTOI=RMTOI+1
"RTN","RMPRS",115,0)
 D ENT G:'IEN EXIT S DIE="^RMPR(668,",DA=IEN,DR="2R;5R;4;7" D ^DIE I $P(^RMPR(668,IEN,0),U,5) S $P(^(0),U,6)=DUZ
"RTN","RMPRS",116,0)
 I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","RMPRS",117,0)
 G LINK
"RTN","RMPRS",118,0)
 ;
"RTN","RMPRS",119,0)
WRI ;write
"RTN","RMPRS",120,0)
 ;called from ENT, rmprdfn, rmprj defined
"RTN","RMPRS",121,0)
 N RMPR668
"RTN","RMPRS",122,0)
 S RO=$G(^RMPR(668,RMPRJ,0)),RMPR668=RMPRJ,Y=$P(^(0),U,1)
"RTN","RMPRS",123,0)
 W !,RMI,".",?5,$$DAT1^RMPRUTL1(Y)
"RTN","RMPRS",124,0)
 S DFN=$P(RO,U,2) D DEM^VADPT
"RTN","RMPRS",125,0)
 W ?16,$E(VADM(1),1,19)
"RTN","RMPRS",126,0)
 W ?37,$$STATUS^RMPREOU(RMPR668,9)
"RTN","RMPRS",127,0)
 ;display first part of description
"RTN","RMPRS",128,0)
 I $D(^RMPR(668,RMPR668,2,1,0)) W ?48,$E(^RMPR(668,RMPR668,2,1,0),1,31)
"RTN","RMPRS",129,0)
 Q
"RTN","RMPRS",130,0)
DIS ;continue
"RTN","RMPRS",131,0)
 K DIR S DIR(0)="NO^1:"_RMI_":0" D ^DIR
"RTN","RMPRS",132,0)
 I $D(DUOUT) S OUT=1 Q
"RTN","RMPRS",133,0)
 I Y>0 S IEN=$P(^TMP("RMSU",$J,+Y),U,2)
"RTN","RMPRS",134,0)
 Q
"RTN","RMPRS",135,0)
 ;
"RTN","RMPRS",136,0)
DICDPT ;ask patient from file #2
"RTN","RMPRS",137,0)
 ;
"RTN","RMPRS",138,0)
 K DIC,^TMP("RMSU",$J)
"RTN","RMPRS",139,0)
 S DIC="^DPT(",DIC(0)="AEQMZ"
"RTN","RMPRS",140,0)
 S DIC("A")="Select PATIENT: " D ^DIC Q
"RTN","RMPRS",141,0)
 ;
"RTN","RMPRS",142,0)
 ;added in patch #62
"RTN","RMPRS",143,0)
SMESS ;print message for mandatory suspense entry.
"RTN","RMPRS",144,0)
 ;W !!,"*********************************************************"
"RTN","RMPRS",145,0)
 ;W !,"** No suspense record has been selected for this       **"
"RTN","RMPRS",146,0)
 ;W !,"** transaction.  You must POST INITIAL ACTION, POST    **"
"RTN","RMPRS",147,0)
 ;W !,"** OTHER ACTION or POST COMPLETE suspense in order to  **"
"RTN","RMPRS",148,0)
 ;W !,"** complete this transaction, otherwise transaction    **"
"RTN","RMPRS",149,0)
 ;W !,"** will not be linked to SUSPENSE..................    **"
"RTN","RMPRS",150,0)
 ;W !,"*********************************************************"
"RTN","RMPRS",151,0)
 ;W !!
"RTN","RMPRS",152,0)
 ;K DIR
"RTN","RMPRS",153,0)
 ;S DIR(0)="SBO^L:LINK Suspense to Patient Record;E:EXIT without linking to Suspense"
"RTN","RMPRS",154,0)
 ;S DIR("A")="Would you like to LINK Suspense or EXIT without linking"
"RTN","RMPRS",155,0)
 ;S DIR("B")="L"
"RTN","RMPRS",156,0)
 ;S DIR("?")="Answer `L` to Link to suspense, 'E' to exit without link to suspense"
"RTN","RMPRS",157,0)
 ;D ^DIR S RMENTSUS=Y
"RTN","RMPRS",158,0)
 ;I $D(DIRUT)!$D(DUOUT)!$D(DTOUT) S RMENTSUS="E"
"RTN","RMPRS",159,0)
 ;W !! K DIR
"RTN","RMPRS",160,0)
 ;Q
"VER")
8.0^22.0
"BLD",5984,6)
^100
**END**
**END**
