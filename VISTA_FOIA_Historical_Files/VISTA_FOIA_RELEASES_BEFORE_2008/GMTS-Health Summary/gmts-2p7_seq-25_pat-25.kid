Released GMTS*2.7*25 SEQ #25
Extracted from mail message
**KIDS**:GMTS*2.7*25^

**INSTALL NAME**
GMTS*2.7*25
"BLD",656,0)
GMTS*2.7*25^HEALTH SUMMARY^0^^y
"BLD",656,1,0)
^^3^3^2980213^^
"BLD",656,1,1,0)
Patch GMTS*2.7*25 fixes various components in the health summary
"BLD",656,1,2,0)
package.  For a complete description of the changes see the
"BLD",656,1,3,0)
NATIONAL PATCH MODULE.
"BLD",656,4,0)
^9.64PA^^
"BLD",656,"ABPKG")
n
"BLD",656,"KRN",0)
^9.67PA^19^18
"BLD",656,"KRN",.4,0)
.4
"BLD",656,"KRN",.401,0)
.401
"BLD",656,"KRN",.402,0)
.402
"BLD",656,"KRN",.403,0)
.403
"BLD",656,"KRN",.5,0)
.5
"BLD",656,"KRN",.84,0)
.84
"BLD",656,"KRN",3.6,0)
3.6
"BLD",656,"KRN",3.8,0)
3.8
"BLD",656,"KRN",9.2,0)
9.2
"BLD",656,"KRN",9.8,0)
9.8
"BLD",656,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",656,"KRN",9.8,"NM",1,0)
GMTSFH^^0^B20547847
"BLD",656,"KRN",9.8,"NM",2,0)
GMTSRAE^^0^B26213868
"BLD",656,"KRN",9.8,"NM",3,0)
GMTSRAS^^0^B17556976
"BLD",656,"KRN",9.8,"NM",4,0)
GMTSLRME^^0^B20883294
"BLD",656,"KRN",9.8,"NM",5,0)
GMTSLRM1^^0^B14841245
"BLD",656,"KRN",9.8,"NM",6,0)
GMTSLRMB^^0^B20040210
"BLD",656,"KRN",9.8,"NM","B","GMTSFH",1)

"BLD",656,"KRN",9.8,"NM","B","GMTSLRM1",5)

"BLD",656,"KRN",9.8,"NM","B","GMTSLRMB",6)

"BLD",656,"KRN",9.8,"NM","B","GMTSLRME",4)

"BLD",656,"KRN",9.8,"NM","B","GMTSRAE",2)

"BLD",656,"KRN",9.8,"NM","B","GMTSRAS",3)

"BLD",656,"KRN",19,0)
19
"BLD",656,"KRN",19,"NM",0)
^9.68A^^
"BLD",656,"KRN",19.1,0)
19.1
"BLD",656,"KRN",101,0)
101
"BLD",656,"KRN",409.61,0)
409.61
"BLD",656,"KRN",771,0)
771
"BLD",656,"KRN",869.2,0)
869.2
"BLD",656,"KRN",870,0)
870
"BLD",656,"KRN",8994,0)
8994
"BLD",656,"KRN","B",.4,.4)

"BLD",656,"KRN","B",.401,.401)

"BLD",656,"KRN","B",.402,.402)

"BLD",656,"KRN","B",.403,.403)

"BLD",656,"KRN","B",.5,.5)

"BLD",656,"KRN","B",.84,.84)

"BLD",656,"KRN","B",3.6,3.6)

"BLD",656,"KRN","B",3.8,3.8)

"BLD",656,"KRN","B",9.2,9.2)

"BLD",656,"KRN","B",9.8,9.8)

"BLD",656,"KRN","B",19,19)

"BLD",656,"KRN","B",19.1,19.1)

"BLD",656,"KRN","B",101,101)

"BLD",656,"KRN","B",409.61,409.61)

"BLD",656,"KRN","B",771,771)

"BLD",656,"KRN","B",869.2,869.2)

"BLD",656,"KRN","B",870,870)

"BLD",656,"KRN","B",8994,8994)

"BLD",656,"QUES",0)
^9.62^^
"BLD",656,"REQB",0)
^9.611^1^1
"BLD",656,"REQB",1,0)
GMTS*2.7*14^1
"BLD",656,"REQB","B","GMTS*2.7*14",1)

"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,20,0)
^9.402P^^
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
25^2980223^125
"PKG",187,22,1,"PAH",1,1,0)
^^3^3^2980902
"PKG",187,22,1,"PAH",1,1,1,0)
Patch GMTS*2.7*25 fixes various components in the health summary
"PKG",187,22,1,"PAH",1,1,2,0)
package.  For a complete description of the changes see the
"PKG",187,22,1,"PAH",1,1,3,0)
NATIONAL PATCH MODULE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMTSFH")
0^1^B20547847
"RTN","GMTSFH",1,0)
GMTSFH ;SLC/JER,MKB - Dietetics Component ;2/13/98  14:13
"RTN","GMTSFH",2,0)
 ;;2.7;Health Summary;**25**;Oct 20, 1995
"RTN","GMTSFH",3,0)
MAIN ; Controls branching and execution
"RTN","GMTSFH",4,0)
 N GMI
"RTN","GMTSFH",5,0)
 I '$D(GMTSNDM) S GMTSNDM=999
"RTN","GMTSFH",6,0)
 I $D(GMTSNDM),GMTSNDM<0 S GMTSNDM=999
"RTN","GMTSFH",7,0)
 D ^FHWHEA I '$D(^UTILITY($J)) Q
"RTN","GMTSFH",8,0)
 F GMI="DI","NS","SF","TF","EN" D @GMI
"RTN","GMTSFH",9,0)
 K ^UTILITY($J),STR,COL,TX,STRT,STP,CNTR
"RTN","GMTSFH",10,0)
 Q
"RTN","GMTSFH",11,0)
DI ; Diet Orders
"RTN","GMTSFH",12,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",13,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "DIETS:",!
"RTN","GMTSFH",14,0)
 I '$D(^UTILITY($J,"DI")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "No diet orders available.",! Q
"RTN","GMTSFH",15,0)
 N GMW,GMIDT
"RTN","GMTSFH",16,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"DI",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D DIWRT
"RTN","GMTSFH",17,0)
 Q
"RTN","GMTSFH",18,0)
DIWRT ; Writes Diet Orders
"RTN","GMTSFH",19,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",20,0)
 N GMZ S GMZ=^UTILITY($J,"DI",GMIDT,0)
"RTN","GMTSFH",21,0)
 S X=+$P(GMZ,U) D REGDT^GMTSU S STRT=X
"RTN","GMTSFH",22,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",23,0)
 E  S X=+$P(GMZ,U,2) D REGDT^GMTSU S STP=X
"RTN","GMTSFH",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,?21
"RTN","GMTSFH",25,0)
 S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No diet orders on file.")
"RTN","GMTSFH",26,0)
 I $L(STR)<40 W STR
"RTN","GMTSFH",27,0)
 E  S COL=27 D WRAP
"RTN","GMTSFH",28,0)
 W:$P(GMZ,U,5)'="" ?61,"("_$P(GMZ,U,5)_")" W !
"RTN","GMTSFH",29,0)
 I $P(GMZ,U,4)'="" D DICOM
"RTN","GMTSFH",30,0)
 Q
"RTN","GMTSFH",31,0)
DICOM ; Writes comments for DI
"RTN","GMTSFH",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "           Comments: "
"RTN","GMTSFH",33,0)
 I $L($P(GMZ,U,4))<55 W $P(GMZ,U,4),!
"RTN","GMTSFH",34,0)
 E  S STR=$P(GMZ,U,4),COL=45 D WRAP W !
"RTN","GMTSFH",35,0)
 Q
"RTN","GMTSFH",36,0)
NS ; Nutritional status
"RTN","GMTSFH",37,0)
 I '$D(^UTILITY($J,"NS")) Q
"RTN","GMTSFH",38,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"NUTRITIONAL STATUS:",!
"RTN","GMTSFH",40,0)
 N GMW,GMIDT
"RTN","GMTSFH",41,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"NS",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D NSWRT
"RTN","GMTSFH",42,0)
 Q
"RTN","GMTSFH",43,0)
NSWRT ; Writes Nutritional Status
"RTN","GMTSFH",44,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",45,0)
 N GMZ S GMZ=^UTILITY($J,"NS",GMIDT,0)
"RTN","GMTSFH",46,0)
 S X=+$P(GMZ,U) D REGDTM^GMTSU S STRT=X
"RTN","GMTSFH",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSFH",48,0)
 W STRT,?21,$S($P(GMZ,U,2)'="":$P(GMZ,U,2),1:"No status on file."),!
"RTN","GMTSFH",49,0)
 Q
"RTN","GMTSFH",50,0)
SF ; Supplemental feeding
"RTN","GMTSFH",51,0)
 I '$D(^UTILITY($J,"SF")) Q
"RTN","GMTSFH",52,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"SUPPLEMENTAL FEEDINGS:",!
"RTN","GMTSFH",54,0)
 N GMW,GMIDT
"RTN","GMTSFH",55,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"SF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D SFWRT
"RTN","GMTSFH",56,0)
 Q
"RTN","GMTSFH",57,0)
SFWRT ; Writes Supplemental Feedings
"RTN","GMTSFH",58,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",59,0)
 N GMZ S GMZ=^UTILITY($J,"SF",GMIDT,0)
"RTN","GMTSFH",60,0)
 S X=+$P(GMZ,U) D REGDT^GMTSU S STRT=X
"RTN","GMTSFH",61,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",62,0)
 E  S X=+$P(GMZ,U,2) D REGDT^GMTSU S STP=X
"RTN","GMTSFH",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"10 Am  " S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No order")
"RTN","GMTSFH",65,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",66,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 2 Pm  " S STR=$S($P(GMZ,U,4)'="":$P(GMZ,U,4),1:"No order")
"RTN","GMTSFH",68,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",69,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 8 Pm  " S STR=$S($P(GMZ,U,5)'="":$P(GMZ,U,5),1:"No order")
"RTN","GMTSFH",71,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",72,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",73,0)
 Q
"RTN","GMTSFH",74,0)
TF ; Tubefeeding
"RTN","GMTSFH",75,0)
 I '$D(^UTILITY($J,"TF")) Q
"RTN","GMTSFH",76,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"TUBE FEEDINGS:",!
"RTN","GMTSFH",78,0)
 N GMW,GMIDT
"RTN","GMTSFH",79,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"TF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D TFWRT
"RTN","GMTSFH",80,0)
 Q
"RTN","GMTSFH",81,0)
TFWRT ; Writes tubefeeding
"RTN","GMTSFH",82,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",83,0)
 N GMZ S GMZ=^UTILITY($J,"TF",GMIDT,0)
"RTN","GMTSFH",84,0)
 S X=+$P(GMZ,U) D REGDT^GMTSU S STRT=X
"RTN","GMTSFH",85,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",86,0)
 E  S X=+$P(GMZ,U,2) D REGDT^GMTSU S STP=X
"RTN","GMTSFH",87,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",88,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Product: ",$P(GMZ,U,3),!
"RTN","GMTSFH",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Strength: ",$P(GMZ,U,4),?51,"Quantity: ",$P(GMZ,U,5),!
"RTN","GMTSFH",90,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Daily CC's: ",$P(GMZ,U,6),?47,"Daily KCal's: ",$P(GMZ,U,7),!
"RTN","GMTSFH",91,0)
 I $P(GMZ,U,8)'="" D TFCOM
"RTN","GMTSFH",92,0)
 Q
"RTN","GMTSFH",93,0)
TFCOM ; Writes comments for TF
"RTN","GMTSFH",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Comments: "
"RTN","GMTSFH",95,0)
 I $L($P(GMZ,U,8))<55 W $P(GMZ,U,8),!
"RTN","GMTSFH",96,0)
 E  S STR=$P(GMZ,U,8),COL=45 D WRAP W !
"RTN","GMTSFH",97,0)
 Q
"RTN","GMTSFH",98,0)
WRAP ; Controls wrap-around feature for comments, etc.
"RTN","GMTSFH",99,0)
 S TX=$F(STR," ",COL) W $E(STR,1,TX-1),!
"RTN","GMTSFH",100,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$E(STR,TX,$L(STR))
"RTN","GMTSFH",101,0)
 Q
"RTN","GMTSFH",102,0)
EN ; Dietetic Encounters
"RTN","GMTSFH",103,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",104,0)
 Q:'$D(^UTILITY($J,"EN"))
"RTN","GMTSFH",105,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"DIETETIC ENCOUNTERS:",!
"RTN","GMTSFH",106,0)
 N GMW,GMIDT
"RTN","GMTSFH",107,0)
 S GMIDT=GMTS1
"RTN","GMTSFH",108,0)
 F  S GMIDT=$O(^UTILITY($J,"EN",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D
"RTN","GMTSFH",109,0)
 . S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",110,0)
 . N GMZ
"RTN","GMTSFH",111,0)
 . S GMZ=^UTILITY($J,"EN",GMIDT,0)
"RTN","GMTSFH",112,0)
 . S X=+$P(GMZ,U) D REGDT^GMTSU S STRT=X
"RTN","GMTSFH",113,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT,?9,$P(GMZ,U,2),!
"RTN","GMTSFH",114,0)
 . I $P(GMZ,U,3)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,3),!
"RTN","GMTSFH",115,0)
 . I $P(GMZ,U,4)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,4),!
"RTN","GMTSFH",116,0)
 Q
"RTN","GMTSLRM1")
0^5^B14841245
"RTN","GMTSLRM1",1,0)
GMTSLRM1 ;SLC/SBW - Microbiology Component Continue ;2/13/98  14:15
"RTN","GMTSLRM1",2,0)
 ;;2.7;Health Summary;**25**;Oct 20, 1995
"RTN","GMTSLRM1",3,0)
REMARKS ; Write remarks
"RTN","GMTSLRM1",4,0)
 N RPT,NUM,FIRST
"RTN","GMTSLRM1",5,0)
 S NUM="",FIRST=1
"RTN","GMTSLRM1",6,0)
 F  S NUM=$O(^TMP("LRM",$J,GMZ,GMK,NUM)) Q:+NUM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",7,0)
 . S RPT=^TMP("LRM",$J,GMZ,GMK,NUM)
"RTN","GMTSLRM1",8,0)
 . I $L(RPT)>58 S RPT=$$WRAP^GMTSORC(RPT,58)
"RTN","GMTSLRM1",9,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",10,0)
 . I FIRST W ?12,"Remarks:" S FIRST=0
"RTN","GMTSLRM1",11,0)
 . W ?21,$P(RPT,"|"),!
"RTN","GMTSLRM1",12,0)
 . I $L($P(RPT,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(RPT,"|",2),!
"RTN","GMTSLRM1",13,0)
 Q
"RTN","GMTSLRM1",14,0)
COMMENT ; Write comment
"RTN","GMTSLRM1",15,0)
 Q:+$D(^TMP("LRM",$J,GMZ,GMK,"COM"))'>0
"RTN","GMTSLRM1",16,0)
 N REC,COM
"RTN","GMTSLRM1",17,0)
 S REC=0
"RTN","GMTSLRM1",18,0)
 F  S REC=$O(^TMP("LRM",$J,GMZ,GMK,"COM",REC)) Q:REC'>0  D
"RTN","GMTSLRM1",19,0)
 . S COM=^TMP("LRM",$J,GMZ,GMK,"COM",REC)
"RTN","GMTSLRM1",20,0)
 . I $L(COM)>55 S COM=$$WRAP^GMTSORC(COM,55)
"RTN","GMTSLRM1",21,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",22,0)
 . W ?25,$P(COM,"|"),!
"RTN","GMTSLRM1",23,0)
 . I $L($P(COM,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?27,$P(COM,"|",2),!
"RTN","GMTSLRM1",24,0)
 Q
"RTN","GMTSLRM1",25,0)
PARACOMM ; Write comment for parasite
"RTN","GMTSLRM1",26,0)
 Q:+$D(^TMP("LRM",$J,GMZ,GMK,GML,"COM"))'>0
"RTN","GMTSLRM1",27,0)
 N REC,COM
"RTN","GMTSLRM1",28,0)
 S REC=0
"RTN","GMTSLRM1",29,0)
 F  S REC=$O(^TMP("LRM",$J,GMZ,GMK,GML,"COM",REC)) Q:REC'>0  D
"RTN","GMTSLRM1",30,0)
 . S COM=^TMP("LRM",$J,GMZ,GMK,GML,"COM",REC)
"RTN","GMTSLRM1",31,0)
 . I $L(COM)>53 S COM=$$WRAP^GMTSORC(COM,53)
"RTN","GMTSLRM1",32,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",33,0)
 . W ?27,$P(COM,"|"),!
"RTN","GMTSLRM1",34,0)
 . I $L($P(COM,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?29,$P(COM,"|",2),!
"RTN","GMTSLRM1",35,0)
 Q
"RTN","GMTSLRM1",36,0)
WRTGRM ; Writes Gram Stain Results
"RTN","GMTSLRM1",37,0)
 N GMGRAM
"RTN","GMTSLRM1",38,0)
 S GMGRAM=^TMP("LRM",$J,GMZ,GMK)
"RTN","GMTSLRM1",39,0)
 S:$L(GMGRAM)>58 GMGRAM=$$WRAP^GMTSORC(GMGRAM,58)
"RTN","GMTSLRM1",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMK=1 ?15,"Gram:" W ?21,$P(GMGRAM,"|"),!
"RTN","GMTSLRM1",41,0)
 I $L($P(GMGRAM,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(GMGRAM,"|",2),!
"RTN","GMTSLRM1",42,0)
 Q
"RTN","GMTSLRM1",43,0)
ANTIBX ; Writes Antibiotic susceptability data
"RTN","GMTSLRM1",44,0)
 N GML,GMCNT,ANAM,ANLEN,ANEXT,GMSUB
"RTN","GMTSLRM1",45,0)
 S GMABX=1
"RTN","GMTSLRM1",46,0)
 F GMSUB="S","I","R","O" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",47,0)
 . Q:+$D(^TMP("LRM",$J,GMZ,GMK,"SUSC",GMSUB))'>0
"RTN","GMTSLRM1",48,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",49,0)
 . W:GMSUB="S" ?5,"Susceptible to: "
"RTN","GMTSLRM1",50,0)
 . W:GMSUB="I" ?7,"Intermediate: "
"RTN","GMTSLRM1",51,0)
 . W:GMSUB="R" ?7,"Resistant to: "
"RTN","GMTSLRM1",52,0)
 . W:GMSUB="O" ?7,"       Other: "
"RTN","GMTSLRM1",53,0)
 . S ANLEN=21,GML=""
"RTN","GMTSLRM1",54,0)
 . F  S GML=$O(^TMP("LRM",$J,GMZ,GMK,"SUSC",GMSUB,GML)) Q:GML=""  S ANAM=$P($P(^(GML),U),";",2)_$S(GMSUB="O":"("_$P(^(GML),U,2)_"/"_$P(^(GML),U,3)_")",1:""),ANEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",55,0)
 . . I $L(ANAM)+ANLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?21 S ANLEN=21
"RTN","GMTSLRM1",56,0)
 . . W ANAM,$S(ANEXT]"":", ",1:"") S ANLEN=ANLEN+$L(ANAM)+2
"RTN","GMTSLRM1",57,0)
 . W !
"RTN","GMTSLRM1",58,0)
 Q
"RTN","GMTSLRM1",59,0)
WRTTEST ; Writes Lab Test for Accession
"RTN","GMTSLRM1",60,0)
 N GML,GMCNT,TNAM,TLEN,TNEXT
"RTN","GMTSLRM1",61,0)
 Q:'$D(^TMP("LRM",$J,GMZ,"TEST"))
"RTN","GMTSLRM1",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Test(s) ordered: "
"RTN","GMTSLRM1",63,0)
 S TLEN=21,GML=""
"RTN","GMTSLRM1",64,0)
 F  S GML=$O(^TMP("LRM",$J,GMZ,"TEST",GML)) Q:GML=""  S TNAM=$P($G(^(GML)),U),TNEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",65,0)
 . I $L(TNAM)+TLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?21 S TLEN=21
"RTN","GMTSLRM1",66,0)
 . W TNAM,$S(TNEXT]"":", ",1:"") S TLEN=TLEN+$L(TNAM)+2
"RTN","GMTSLRM1",67,0)
 W !
"RTN","GMTSLRM1",68,0)
 Q
"RTN","GMTSLRM1",69,0)
WRTSTER ; Writes sterility control data
"RTN","GMTSLRM1",70,0)
 N STER,GML
"RTN","GMTSLRM1",71,0)
 S STER=$G(^TMP("LRM",$J,"BSTER",0))
"RTN","GMTSLRM1",72,0)
 Q:STER']""
"RTN","GMTSLRM1",73,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",74,0)
 W ?2,"Sterility Control:",?21,STER,!
"RTN","GMTSLRM1",75,0)
 S GML=0
"RTN","GMTSLRM1",76,0)
 F  S GML=$O(^TMP("LRM",$J,GMZ,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",77,0)
 . D CKP^GMTSUP I $D(GMTSQIT)
"RTN","GMTSLRM1",78,0)
 . W ?13,"Number:",?21,GML,?44,"Results: ",$P(^TMP("LRM",$J,GMZ,GML),U),!
"RTN","GMTSLRM1",79,0)
 Q
"RTN","GMTSLRM1",80,0)
TBSUSC ;Display TB Susceptiblities
"RTN","GMTSLRM1",81,0)
 Q:+$D(^TMP("LRM",$J,GMZ,GMK,"SUSC"))'>0
"RTN","GMTSLRM1",82,0)
 N GMTB,QTY
"RTN","GMTSLRM1",83,0)
 S GMTB=0
"RTN","GMTSLRM1",84,0)
 F  S GMTB=$O(^TMP("LRM",$J,GMZ,GMK,"SUSC",GMTB)) Q:GMTB'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM1",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM1",86,0)
 . W ?21,$P(^TMP("LRM",$J,GMZ,GMK,"SUSC",GMTB),U)
"RTN","GMTSLRM1",87,0)
 . S QTY=$P(^TMP("LRM",$J,GMZ,GMK,"SUSC",GMTB),U,2)
"RTN","GMTSLRM1",88,0)
 . I $L(QTY)>36 S QTY=$$WRAP^GMTSORC(QTY,36)
"RTN","GMTSLRM1",89,0)
 . W ?44,$P(QTY,"|"),!
"RTN","GMTSLRM1",90,0)
 . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?44,$P(QTY,"|",2),!
"RTN","GMTSLRM1",91,0)
 Q
"RTN","GMTSLRMB")
0^6^B20040210
"RTN","GMTSLRMB",1,0)
GMTSLRMB ;SLC/JER - Microbiology Component Driver ;2/13/98  14:16
"RTN","GMTSLRMB",2,0)
 ;;2.7;Health Summary;**25**;Oct 20, 1995
"RTN","GMTSLRMB",3,0)
MAIN N IX0,IX,LRDFN,MAX,D1,D2,D3
"RTN","GMTSLRMB",4,0)
 I '$D(^DPT(DFN,"LR")) Q
"RTN","GMTSLRMB",5,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLRMB",6,0)
 I $S('$D(^LR(LRDFN,"MI",0)):1,'$O(^LR(LRDFN,"MI",GMTS1)):1,$O(^LR(LRDFN,"MI",GMTS1))>GMTS2:1,1:0) Q
"RTN","GMTSLRMB",7,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRMB",8,0)
 E  S MAX=999
"RTN","GMTSLRMB",9,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^LR(LRDFN,"MI",IX)) Q:IX=""!(IX>GMTS2)  D:IX0>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:IX0>1&'GMTSNPG ! D ^GMTSLRME,INTRP:$D(^TMP("LRM",$J)) K ^TMP("LRM",$J)
"RTN","GMTSLRMB",10,0)
 Q
"RTN","GMTSLRMB",11,0)
INTRP ; Interprets ^TMP("LRM",$J, and calls WRT to print component
"RTN","GMTSLRMB",12,0)
 N GMTSJ,GMK,GMW,SMEAR,GMABX
"RTN","GMTSLRMB",13,0)
 S (GMTSJ,GMK)=""
"RTN","GMTSLRMB",14,0)
 F  S GMTSJ=$O(^TMP("LRM",$J,GMTSJ)) Q:GMTSJ=""!$D(GMTSQIT)  D RDNODE
"RTN","GMTSLRMB",15,0)
 Q
"RTN","GMTSLRMB",16,0)
RDNODE ; Reads current node of GMTSLRMI
"RTN","GMTSLRMB",17,0)
 Q:GMTSJ="BSTER"
"RTN","GMTSLRMB",18,0)
 I GMTSJ=0 D  Q
"RTN","GMTSLRMB",19,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P($P(^TMP("LRM",$J,GMTSJ),U)," "),?10,$P(^TMP("LRM",$J,GMTSJ),U,3),!
"RTN","GMTSLRMB",20,0)
 . D WRTTEST
"RTN","GMTSLRMB",21,0)
 S GMK=""
"RTN","GMTSLRMB",22,0)
 F  S GMK=$O(^TMP("LRM",$J,GMTSJ,GMK)) Q:GMK=""!$D(GMTSQIT)  D WRTNODE
"RTN","GMTSLRMB",23,0)
 I GMTSJ="TB" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",24,0)
 . I $P(^TMP("LRM",$J,GMTSJ,0),U,2)]"" D
"RTN","GMTSLRMB",25,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",26,0)
 . . W "AFB Sme:",?10,$E($P(^TMP("LRM",$J,GMTSJ,0),U,2),1,20),!
"RTN","GMTSLRMB",27,0)
 . . I $P(^TMP("LRM",$J,GMTSJ,0),U,3)]"" D
"RTN","GMTSLRMB",28,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",29,0)
 . . . W ?10,$P(^TMP("LRM",$J,GMTSJ,0),U,3),!
"RTN","GMTSLRMB",30,0)
 I $D(^TMP("LRM",$J,GMTSJ,"SMEAR")) D
"RTN","GMTSLRMB",31,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",32,0)
 . W ?2,"Smear:"
"RTN","GMTSLRMB",33,0)
 . S SMEAR=0
"RTN","GMTSLRMB",34,0)
 . F  S SMEAR=$O(^TMP("LRM",$J,GMTSJ,"SMEAR",SMEAR)) Q:SMEAR'>0  W ?10,^(SMEAR),! I +$O(^TMP("LRM",$J,"SMEAR",SMEAR)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",35,0)
 Q
"RTN","GMTSLRMB",36,0)
WRTNODE ; Writes current node of GMTSLRMI
"RTN","GMTSLRMB",37,0)
 N GML
"RTN","GMTSLRMB",38,0)
 I GMK=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Report:",?10,$P(^TMP("LRM",$J,GMTSJ,GMK),U),! Q
"RTN","GMTSLRMB",39,0)
 I GMTSJ="GRAM" D WRTGRM Q
"RTN","GMTSLRMB",40,0)
 Q:GMK="SMEAR"
"RTN","GMTSLRMB",41,0)
 I GMK="R" D REMARKS Q
"RTN","GMTSLRMB",42,0)
 I GMTSJ'="CABXL" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Organsm:",?10,$P(^TMP("LRM",$J,GMTSJ,GMK),U),!
"RTN","GMTSLRMB",44,0)
 . I $P(^TMP("LRM",$J,GMTSJ,GMK),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"QTY:",?10,$P(^TMP("LRM",$J,GMTSJ,GMK),U,2),!
"RTN","GMTSLRMB",45,0)
 I GMTSJ="CABXL" D
"RTN","GMTSLRMB",46,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",47,0)
 . W:GMK=1 "Ser Abx:"
"RTN","GMTSLRMB",48,0)
 . W ?10,$E($P(^TMP("LRM",$J,GMTSJ,GMK),U),1,18),?30,$$DRAW^GMTSLRM($P(^TMP("LRM",$J,GMTSJ,GMK),U,2)),?38,$P(^(GMK),U,3)," ug/ml",!
"RTN","GMTSLRMB",49,0)
 I GMTSJ="BACT",$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC")) D ANTIBX Q
"RTN","GMTSLRMB",50,0)
 I GMTSJ="PARA",$D(^TMP("LRM",$J,GMTSJ,GMK))=11 D
"RTN","GMTSLRMB",51,0)
 . S GML=""
"RTN","GMTSLRMB",52,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",53,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",54,0)
 . . W ?12,$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U)
"RTN","GMTSLRMB",55,0)
 . . S QTY=$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U,2)
"RTN","GMTSLRMB",56,0)
 . . I $L(QTY)>46 S QTY=$$WRAP^GMTSORC(QTY,46)
"RTN","GMTSLRMB",57,0)
 . . W ?33,$P(QTY,"|"),!
"RTN","GMTSLRMB",58,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?33,$P(QTY,"|",2),!
"RTN","GMTSLRMB",59,0)
 Q
"RTN","GMTSLRMB",60,0)
REMARKS ; Write remarks
"RTN","GMTSLRMB",61,0)
 N NUM,FIRST
"RTN","GMTSLRMB",62,0)
 S NUM="",FIRST=1
"RTN","GMTSLRMB",63,0)
 F  S NUM=$O(^TMP("LRM",$J,GMTSJ,GMK,NUM)) Q:+NUM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",64,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",65,0)
 . W:$X>0 !
"RTN","GMTSLRMB",66,0)
 . I FIRST W "Remarks:" S FIRST=0
"RTN","GMTSLRMB",67,0)
 . W ?10,^TMP("LRM",$J,GMTSJ,GMK,NUM),!
"RTN","GMTSLRMB",68,0)
 Q
"RTN","GMTSLRMB",69,0)
WRTGRM ; Writes Gram Stain Results
"RTN","GMTSLRMB",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$X>0 ! W:GMK=1 ?3,"Gram:" W ?10,$E(^TMP("LRM",$J,GMTSJ,GMK),1,69),!
"RTN","GMTSLRMB",71,0)
 Q
"RTN","GMTSLRMB",72,0)
ANTIBX ; Writes Antibiotic susceptability data
"RTN","GMTSLRMB",73,0)
 N GML,GMCNT,ANAM,ANLEN,ANEXT,GMSUB
"RTN","GMTSLRMB",74,0)
 S GMABX=1
"RTN","GMTSLRMB",75,0)
 F GMSUB="S","I","R","O" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",76,0)
 . Q:+$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB))'>0
"RTN","GMTSLRMB",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",78,0)
 . W:GMSUB="S" "Susc to:  "
"RTN","GMTSLRMB",79,0)
 . W:GMSUB="I" "Interme:  "
"RTN","GMTSLRMB",80,0)
 . W:GMSUB="R" "Resista:  "
"RTN","GMTSLRMB",81,0)
 . W:GMSUB="O" "  Other:  "
"RTN","GMTSLRMB",82,0)
 . S ANLEN=10,GML=""
"RTN","GMTSLRMB",83,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB,GML)) Q:GML=""  S ANAM=$P($P(^(GML),U),";",2)_$S(GMSUB="O":"("_$P(^(GML),U,2)_"/"_$P(^(GML),U,3)_")",1:""),ANEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",84,0)
 . . I $L(ANAM)+ANLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?10 S ANLEN=10
"RTN","GMTSLRMB",85,0)
 . . W ANAM,$S(ANEXT]"":", ",1:"") S ANLEN=ANLEN+$L(ANAM)+2
"RTN","GMTSLRMB",86,0)
 . W !
"RTN","GMTSLRMB",87,0)
 Q
"RTN","GMTSLRMB",88,0)
WRTTEST ; Writes Lab Test for Accession
"RTN","GMTSLRMB",89,0)
 N GML,GMCNT,TNAM,TLEN,TNEXT
"RTN","GMTSLRMB",90,0)
 Q:'$D(^TMP("LRM",$J,GMTSJ,"TEST"))
"RTN","GMTSLRMB",91,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Test(s):  "
"RTN","GMTSLRMB",92,0)
 S TLEN=10,GML=""
"RTN","GMTSLRMB",93,0)
 F  S GML=$O(^TMP("LRM",$J,GMTSJ,"TEST",GML)) Q:GML=""  S TNAM=$P($G(^(GML)),U),TNEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",94,0)
 . I $L(TNAM)+TLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?10 S TLEN=10
"RTN","GMTSLRMB",95,0)
 . W TNAM,$S(TNEXT]"":", ",1:"") S TLEN=TLEN+$L(TNAM)+2
"RTN","GMTSLRMB",96,0)
 W !
"RTN","GMTSLRMB",97,0)
 Q
"RTN","GMTSLRME")
0^4^B20883294
"RTN","GMTSLRME",1,0)
GMTSLRME ;SLC/JER - Microbiology Extract Routine ;2/13/98  14:15
"RTN","GMTSLRME",2,0)
 ;;2.7;Health Summary;**25**;Oct 20, 1995
"RTN","GMTSLRME",3,0)
XTRCT N ACC,CDT,SS,CS,X,DIC,DIQ,DA,DR,MICRO,LOC,RDT,MICCOM
"RTN","GMTSLRME",4,0)
 K ^TMP("LRM",$J)
"RTN","GMTSLRME",5,0)
 S X=$P(^LR(LRDFN,"MI",IX,0),U),RDT=$P(^(0),U,3),ACC=$P(^(0),U,6),LOC=$P(^(0),U,8) D REGDTM^GMTSU S CDT=X K X
"RTN","GMTSLRME",6,0)
 D LABTEST($P(^LR(LRDFN,"MI",IX,0),U),ACC)
"RTN","GMTSLRME",7,0)
 ; External format of site/specimen, collection sample, and comment
"RTN","GMTSLRME",8,0)
 S DIC=63,DIQ="MICRO",DIQ(0)="E",DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=".05;.055;.99"
"RTN","GMTSLRME",9,0)
 D EN^DIQ1
"RTN","GMTSLRME",10,0)
 S SS=MICRO(63.05,IX,.05,"E")
"RTN","GMTSLRME",11,0)
 S CS=MICRO(63.05,IX,.055,"E"),MICCOM=MICRO(63.05,IX,.99,"E")
"RTN","GMTSLRME",12,0)
 S ^TMP("LRM",$J,0)=CDT_U_ACC_U_SS I $D(EXPAND) S ^TMP("LRM",$J,0)=^TMP("LRM",$J,0)_U_RDT_U_LOC
"RTN","GMTSLRME",13,0)
 S $P(^TMP("LRM",$J,0),U,6)=CS_U_MICCOM
"RTN","GMTSLRME",14,0)
 D ABXLEV,BACT,GRAM,STER,PARA^GMTSLRMX,MYCO^GMTSLRMX,TB^GMTSLRMX,VIRO^GMTSLRMX
"RTN","GMTSLRME",15,0)
 Q
"RTN","GMTSLRME",16,0)
BACT ; Get Bacteriology Work-up
"RTN","GMTSLRME",17,0)
 N DA,DIC,DIQ,DR,STATUS,ISO,ORG,RMK,COM,SMEAR
"RTN","GMTSLRME",18,0)
 I $D(^LR(LRDFN,"MI",IX,1)) D
"RTN","GMTSLRME",19,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)="11.5;11.51;11.57;11.58",DIQ="STATUS"
"RTN","GMTSLRME",20,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRME",21,0)
 . ;Include Status, sputum screen, and urine screen
"RTN","GMTSLRME",22,0)
 . S ^TMP("LRM",$J,"BACT",0)=$E($P(STATUS(63.05,IX,11.5,"E")," ",1),1,6)_U_STATUS(63.05,IX,11.58,"E")_U_STATUS(63.05,IX,11.57,"E")
"RTN","GMTSLRME",23,0)
 . ; Include sterility control
"RTN","GMTSLRME",24,0)
 . S ^TMP("LRM",$J,"BSTER",0)=STATUS(63.05,IX,11.51,"E")
"RTN","GMTSLRME",25,0)
 S ISO=0
"RTN","GMTSLRME",26,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,3,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRME",27,0)
 . D ORGNSM S ^TMP("LRM",$J,"BACT",ISO)=$S($D(EXPAND):ISO_";"_ORG,1:ORG) I $O(^LR(LRDFN,"MI",IX,3,ISO,1)) D ANTIBX
"RTN","GMTSLRME",28,0)
 . ;comment
"RTN","GMTSLRME",29,0)
 . S COM=0
"RTN","GMTSLRME",30,0)
 . F  S COM=$O(^LR(LRDFN,"MI",IX,3,ISO,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"BACT",ISO,"COM",COM)=^(COM,0)
"RTN","GMTSLRME",31,0)
 ; Bacteriology smear/prep
"RTN","GMTSLRME",32,0)
 S SMEAR=0
"RTN","GMTSLRME",33,0)
 F  S SMEAR=$O(^LR(LRDFN,"MI",IX,25,SMEAR)) Q:SMEAR'>0  S ^TMP("LRM",$J,"BACT","SMEAR",SMEAR)=^(SMEAR,0)
"RTN","GMTSLRME",34,0)
 ; remark
"RTN","GMTSLRME",35,0)
 S RMK=0
"RTN","GMTSLRME",36,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,4,RMK)) Q:RMK=""  S ^TMP("LRM",$J,"BACT","R",RMK)=^(RMK,0)
"RTN","GMTSLRME",37,0)
 Q
"RTN","GMTSLRME",38,0)
ORGNSM N QTY
"RTN","GMTSLRME",39,0)
 S ORG=+^LR(LRDFN,"MI",IX,3,ISO,0),QTY=$P(^(0),U,2),ORG=$P(^LAB(61.2,ORG,0),U)
"RTN","GMTSLRME",40,0)
 S ORG=ORG_U_QTY
"RTN","GMTSLRME",41,0)
 Q
"RTN","GMTSLRME",42,0)
ANTIBX ; Get Antibitiotic susceptibility results on demand
"RTN","GMTSLRME",43,0)
 N ABX
"RTN","GMTSLRME",44,0)
 S ABX=1
"RTN","GMTSLRME",45,0)
 F  S ABX=$O(^LR(LRDFN,"MI",IX,3,ISO,ABX)) Q:ABX=""!(ABX'<3)  D ABXSET
"RTN","GMTSLRME",46,0)
 Q
"RTN","GMTSLRME",47,0)
ABXSET ; Set Antibiotic Susceptability data, when appropriate
"RTN","GMTSLRME",48,0)
 ; Separate out by Susceptable, Intermediate, and Resistant
"RTN","GMTSLRME",49,0)
 N ABXN,FOUND,GMTSR,GMABX
"RTN","GMTSLRME",50,0)
 S ABXN=ABX_";"_$P($G(^LAB(62.06,+$O(^LAB(62.06,"AD",ABX,"")),0)),U)
"RTN","GMTSLRME",51,0)
 I $P(ABXN,";",2)']"" S $P(ABXN,";",2)="UNKNOWN"
"RTN","GMTSLRME",52,0)
 I ("A"[$P(^LR(LRDFN,"MI",IX,3,ISO,ABX),U,3)) D
"RTN","GMTSLRME",53,0)
 . S GMABX=$G(^LR(LRDFN,"MI",IX,3,ISO,ABX))
"RTN","GMTSLRME",54,0)
 .;Check for interpreted result being S, I, or R first
"RTN","GMTSLRME",55,0)
 .S FOUND=0
"RTN","GMTSLRME",56,0)
 .S GMTSR=$P(GMABX,U,2) D SAVE Q:FOUND
"RTN","GMTSLRME",57,0)
 .;If not found then check reported result for S, I, or R
"RTN","GMTSLRME",58,0)
 .S GMTSR=$P(GMABX,U) D SAVE Q:FOUND
"RTN","GMTSLRME",59,0)
 .;Neither interpreted nor reported result equaled S, I, or R so we'll store it in the "other" list provided that reported and interpreted are both not null
"RTN","GMTSLRME",60,0)
 .S:$P(GMABX,U)'=""&($P(GMABX,U,2)'="") ^TMP("LRM",$J,"BACT",ISO,"SUSC","O",$P($P(ABXN,U),";",2))=ABXN_U_GMABX
"RTN","GMTSLRME",61,0)
 Q
"RTN","GMTSLRME",62,0)
ABXLEV ; Get Serum antibiotic level
"RTN","GMTSLRME",63,0)
 N GMI
"RTN","GMTSLRME",64,0)
 Q:'$D(^LR(LRDFN,"MI",IX,14))
"RTN","GMTSLRME",65,0)
 S GMI=0
"RTN","GMTSLRME",66,0)
 F  S GMI=$O(^LR(LRDFN,"MI",IX,14,GMI)) Q:GMI'>0  S ^TMP("LRM",$J,"CABXL",GMI)=$G(^(GMI,0))
"RTN","GMTSLRME",67,0)
 Q
"RTN","GMTSLRME",68,0)
STER ; Get sterility results if they exist
"RTN","GMTSLRME",69,0)
 N RESULT,STER
"RTN","GMTSLRME",70,0)
 S STER=0
"RTN","GMTSLRME",71,0)
 F  S STER=$O(^LR(LRDFN,"MI",IX,31,STER)) Q:STER'>0  D
"RTN","GMTSLRME",72,0)
 . S DIQ(0)="E",DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=11.52
"RTN","GMTSLRME",73,0)
 . S DR(63.292)=.01,DIQ="RESULT"
"RTN","GMTSLRME",74,0)
 . S DA(63.292)=STER
"RTN","GMTSLRME",75,0)
 . D EN^DIQ1
"RTN","GMTSLRME",76,0)
 . S ^TMP("LRM",$J,"BSTER",STER)=RESULT(63.292,STER,.01,"E")
"RTN","GMTSLRME",77,0)
 Q
"RTN","GMTSLRME",78,0)
GRAM ; Get Gram Stain Results
"RTN","GMTSLRME",79,0)
 N ISO
"RTN","GMTSLRME",80,0)
 Q:'$D(^LR(LRDFN,"MI",IX,2))
"RTN","GMTSLRME",81,0)
 S ISO=0
"RTN","GMTSLRME",82,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,2,ISO)) Q:ISO=""  S ^TMP("LRM",$J,"GRAM",ISO)=^(ISO,0)
"RTN","GMTSLRME",83,0)
 Q
"RTN","GMTSLRME",84,0)
LABTEST(SDT,LRACC) ;Get lab test names and results
"RTN","GMTSLRME",85,0)
 N X,Y,LRAA,LRAN,LRAD,LRBRR,LRTSTS,LRTS
"RTN","GMTSLRME",86,0)
 S LRAD=+$E(SDT)_$P(LRACC," ",2)_"0000",X=$P(LRACC," "),DIC=68,DIC(0)="M"
"RTN","GMTSLRME",87,0)
 Q:'$L(X)  D ^DIC S LRAA=+Y,LRAN=+$P(LRACC," ",3)
"RTN","GMTSLRME",88,0)
 S LRBRR=0
"RTN","GMTSLRME",89,0)
 F  S LRBRR=+$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR)) Q:LRBRR'>0  D
"RTN","GMTSLRME",90,0)
 . S LRTS=+^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR,0),LRTS(1)=$P(^(0),U,5)
"RTN","GMTSLRME",91,0)
 . Q:"BO"'[$P($G(^LAB(60,LRTS,0)),U,3)
"RTN","GMTSLRME",92,0)
 . S LRTSTS=$S($D(^LAB(60,LRTS,0)):$P(^(0),U),1:"deleted test")
"RTN","GMTSLRME",93,0)
 . ;Lab test name and results in print order
"RTN","GMTSLRME",94,0)
 . S ^TMP("LRM",$J,0,"TEST",$S($D(^LAB(60,LRTS,.1)):$P(^(.1),U,6),1:"")_","_U_LRBRR)=LRTSTS_U_LRTS(1)
"RTN","GMTSLRME",95,0)
 Q
"RTN","GMTSLRME",96,0)
SAVE ;If result = S, I, or R then save
"RTN","GMTSLRME",97,0)
 I $S(GMTSR="I":1,GMTSR="R":1,GMTSR="S":1,1:0) S ^TMP("LRM",$J,"BACT",ISO,"SUSC",GMTSR,$P($P(ABXN,U),";",2))=ABXN_U_GMABX S FOUND=1
"RTN","GMTSLRME",98,0)
 Q
"RTN","GMTSRAE")
0^2^B26213868
"RTN","GMTSRAE",1,0)
GMTSRAE ;SLC/JER HIRMFO/GJC Selected Radiology Extract ;2/13/98  14:14
"RTN","GMTSRAE",2,0)
 ;;2.7;Health Summary;**14,25**;Oct 20, 1995
"RTN","GMTSRAE",3,0)
MAINSEL(MODE,TEST) ; Controls branching and execution for components with
"RTN","GMTSRAE",4,0)
 ; selection items
"RTN","GMTSRAE",5,0)
 N GMIDT,GMCNT,GMPN
"RTN","GMTSRAE",6,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAE",7,0)
 S GMCNT=0,GMIDT=GMTS1+.9999,GMTS2=GMTS2+.9999
"RTN","GMTSRAE",8,0)
 F  S GMIDT=$O(^RADPT(DFN,"DT","AP",TEST,GMIDT)) Q:GMIDT'>0!(GMIDT>GMTS2)!(GMCNT=MAX)  D
"RTN","GMTSRAE",9,0)
 . Q:'$D(^RADPT(DFN,"DT",GMIDT,0))  ; missing data node, quit
"RTN","GMTSRAE",10,0)
 . N GM7002,GMPSET,GMXSET
"RTN","GMTSRAE",11,0)
 . S GM7002=$G(^RADPT(DFN,"DT",GMIDT,0)),GMXSET=+$P(GM7002,"^",5)
"RTN","GMTSRAE",12,0)
 . S GMPN=0 F  S GMPN=$O(^RADPT(DFN,"DT","AP",TEST,GMIDT,GMPN)) Q:GMPN'>0!(GMCNT=MAX)  D
"RTN","GMTSRAE",13,0)
 . . S GMCNT=GMCNT+1 D GET
"RTN","GMTSRAE",14,0)
 Q
"RTN","GMTSRAE",15,0)
MAIN(MODE) ; Controls branching and execution
"RTN","GMTSRAE",16,0)
 N GMIDT,GMCNT,GMPN
"RTN","GMTSRAE",17,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAE",18,0)
 S GMCNT=0,GMIDT=GMTS1+.9999,GMTS2=GMTS2+.9999
"RTN","GMTSRAE",19,0)
 F  S GMIDT=$O(^RADPT(DFN,"DT",GMIDT)) Q:GMIDT'>0!(GMIDT>GMTS2)!(GMCNT=MAX)  D
"RTN","GMTSRAE",20,0)
 . Q:'$D(^RADPT(DFN,"DT",GMIDT,0))  ; missing data node, quit
"RTN","GMTSRAE",21,0)
 . N GM7002,GMPSET,GMXSET
"RTN","GMTSRAE",22,0)
 . S GM7002=$G(^RADPT(DFN,"DT",GMIDT,0)),GMXSET=+$P(GM7002,"^",5)
"RTN","GMTSRAE",23,0)
 . S GMPN=0 F  S GMPN=$O(^RADPT(DFN,"DT",GMIDT,"P",GMPN)) Q:GMPN'>0!(GMCNT=MAX)  D
"RTN","GMTSRAE",24,0)
 . . S GMCNT=GMCNT+1 D GET
"RTN","GMTSRAE",25,0)
 Q
"RTN","GMTSRAE",26,0)
GET ; Gets data associated with study and sets ^TMP("RAE",$J,
"RTN","GMTSRAE",27,0)
 ; global variable definitions:
"RTN","GMTSRAE",28,0)
 ; where: GMIDT=reverse exam date/time & GMPN=case ien
"RTN","GMTSRAE",29,0)
 ;
"RTN","GMTSRAE",30,0)
 ; ^TMP("RAE",$J,GMIDT,"EXAMSET")  indicates if all exams for this
"RTN","GMTSRAE",31,0)
 ;                                 date/time are part of an exam set
"RTN","GMTSRAE",32,0)
 ;
"RTN","GMTSRAE",33,0)
 ; ^TMP("RAE",$J,GMIDT,"PRINTSET") indicates if all exams for this
"RTN","GMTSRAE",34,0)
 ;                                 exam set share the same report
"RTN","GMTSRAE",35,0)
 ;
"RTN","GMTSRAE",36,0)
 ; only if the report is verified -OR- released will these nodes be set
"RTN","GMTSRAE",37,0)
 ;
"RTN","GMTSRAE",38,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"D",seq #) = Dx codes (seq # = 1: Pri. Dx)
"RTN","GMTSRAE",39,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"D",seq #) = Dx codes (seq # > 1: Sec. Dx)
"RTN","GMTSRAE",40,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"H",line #)= Clinical History line #
"RTN","GMTSRAE",41,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"I",line #)= Impression Text line #
"RTN","GMTSRAE",42,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"R",line #)= Report Text line #
"RTN","GMTSRAE",43,0)
 ;
"RTN","GMTSRAE",44,0)
 N DA,DIC,DIQ,DR,GMCPT,GMED,GMRP,GMRPI,GMST,GMPTR,GMRSTAT,GMIRSTAT,GMI
"RTN","GMTSRAE",45,0)
 N GMRAD,GMRRAD,GMSRAD,GMTECH
"RTN","GMTSRAE",46,0)
 S GMED=+$P(GM7002,"^")
"RTN","GMTSRAE",47,0)
 S:GMXSET&('$D(^TMP("RAE",$J,GMIDT,"EXAMSET"))) ^TMP("RAE",$J,GMIDT,"EXAMSET")=""
"RTN","GMTSRAE",48,0)
 S DIC="^RADPT("_DFN_",""DT"","_GMIDT_",""P"",",DA=GMPN,DIQ="GMRAD("
"RTN","GMTSRAE",49,0)
 S DIQ(0)="IE",DR="2;3;12;13;15;17;25"
"RTN","GMTSRAE",50,0)
 S GMTECH=+$O(^RADPT(DFN,"DT",GMIDT,"P",GMPN,"TC",0)) ; grab first tech
"RTN","GMTSRAE",51,0)
 I GMTECH S DR=DR_";175",DR(70.12)=.01,DA(70.12)=GMTECH
"RTN","GMTSRAE",52,0)
 D EN^DIQ1
"RTN","GMTSRAE",53,0)
 S GMRP=$G(GMRAD(70.03,GMPN,2,"E")),GMRPI=$G(GMRAD(70.03,GMPN,2,"I")),GMST=$G(GMRAD(70.03,GMPN,3,"E"))
"RTN","GMTSRAE",54,0)
 I GMTECH S GMTECH(0)=$E($G(GMRAD(70.12,GMTECH,.01,"E")),1,18)
"RTN","GMTSRAE",55,0)
 S GMRRAD=$E($G(GMRAD(70.03,GMPN,12,"E")),1,18)
"RTN","GMTSRAE",56,0)
 S GMSRAD=$E($G(GMRAD(70.03,GMPN,15,"E")),1,18)
"RTN","GMTSRAE",57,0)
 S GMPTR=$G(GMRAD(70.03,GMPN,17,"I"))
"RTN","GMTSRAE",58,0)
 S GMPSET=$G(GMRAD(70.03,GMPN,25,"I")) ; if GMPSET="":single exam
"RTN","GMTSRAE",59,0)
 ; if GMPSET=1:exam set, single rpt if GMPSET=2:exam set, combined rpt
"RTN","GMTSRAE",60,0)
 S DIC=DIC_DA_",""M"",",DA=0 F  S DA=$O(@(DIC_DA_")")) Q:+DA'>0  D
"RTN","GMTSRAE",61,0)
 . S DR=".01" D EN^DIQ1
"RTN","GMTSRAE",62,0)
 I +GMPTR>0 S DIC="^RARPT(",DA=GMPTR,DIQ="GMRAD(",DIQ(0)="IE",DR="5" D EN^DIQ1
"RTN","GMTSRAE",63,0)
 S GMRSTAT=$G(GMRAD(74,+GMPTR,5,"E"))
"RTN","GMTSRAE",64,0)
 S GMIRSTAT=$G(GMRAD(74,+GMPTR,5,"I"))
"RTN","GMTSRAE",65,0)
 I $L(GMIRSTAT),("VR"[$E(GMIRSTAT)) D GETDX(GMPN_","_GMIDT_","_DFN_",")
"RTN","GMTSRAE",66,0)
 S GMCPT=$P($G(^RAMIS(71,+GMRPI,0)),U,9)
"RTN","GMTSRAE",67,0)
 S ^TMP("RAE",$J,GMIDT,GMPN,0)=GMED_U_GMRP_U_GMST_U_GMRSTAT_U_GMRRAD_U_GMSRAD_U_GMCPT_U_$G(GMTECH(0))
"RTN","GMTSRAE",68,0)
 S GMI=0 F  S GMI=$O(GMRAD(70.1,GMI)) Q:+GMI'>0  D
"RTN","GMTSRAE",69,0)
 . S ^TMP("RAE",$J,GMIDT,GMPN,"M",GMI)=$G(GMRAD(70.1,GMI,.01,"E"))
"RTN","GMTSRAE",70,0)
 I GMIRSTAT'="V",($E(IOST)="P") D  Q  ; Only verified reports can be printed
"RTN","GMTSRAE",71,0)
 . S:GMPSET=2 ^TMP("RAE",$J,GMIDT,"PRINTSET")="" ; still needs to be set
"RTN","GMTSRAE",72,0)
 . Q
"RTN","GMTSRAE",73,0)
 I $S(GMIRSTAT="V":0,GMIRSTAT="R":0,1:1) D  Q  ; Only verified and Released/Unverified can be seen on the terminal
"RTN","GMTSRAE",74,0)
 . S:GMPSET=2 ^TMP("RAE",$J,GMIDT,"PRINTSET")="" ; still needs to be set
"RTN","GMTSRAE",75,0)
 . Q
"RTN","GMTSRAE",76,0)
 Q:$D(^TMP("RAE",$J,GMIDT,"PRINTSET"))  ; Print set, same report
"RTN","GMTSRAE",77,0)
 I $D(^RARPT(+GMPTR,"I",0)) D GETIMP
"RTN","GMTSRAE",78,0)
 I $G(MODE)=2,$D(^RARPT(+GMPTR,"H",0)) D GETHIS
"RTN","GMTSRAE",79,0)
 I $G(MODE)=2,$D(^RARPT(+GMPTR,"R",0)) D GETREP
"RTN","GMTSRAE",80,0)
 S:GMPSET=2 ^TMP("RAE",$J,GMIDT,"PRINTSET")=""
"RTN","GMTSRAE",81,0)
 Q
"RTN","GMTSRAE",82,0)
GETIMP ; Gets Radiologist's Impression
"RTN","GMTSRAE",83,0)
 N GMLN,X
"RTN","GMTSRAE",84,0)
 K ^UTILITY($J,"W") S GMLN=0 F  S GMLN=$O(^RARPT(GMPTR,"I",GMLN)) Q:GMLN'>0  S X=^RARPT(GMPTR,"I",GMLN,0) D FORMAT
"RTN","GMTSRAE",85,0)
 I $D(^UTILITY($J,"W")) F GMLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMIDT,GMPN,"I",GMLN)=^UTILITY($J,"W",3,GMLN,0)
"RTN","GMTSRAE",86,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRAE",87,0)
 Q
"RTN","GMTSRAE",88,0)
GETHIS ; Gets Clinical History
"RTN","GMTSRAE",89,0)
 N GMLN,X
"RTN","GMTSRAE",90,0)
 K ^UTILITY($J,"W") S GMLN=0 F  S GMLN=$O(^RARPT(GMPTR,"H",GMLN)) Q:GMLN'>0  S X=^RARPT(GMPTR,"H",GMLN,0) D FORMAT
"RTN","GMTSRAE",91,0)
 I $D(^UTILITY($J,"W")) F GMLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMIDT,GMPN,"H",GMLN)=^UTILITY($J,"W",3,GMLN,0)
"RTN","GMTSRAE",92,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRAE",93,0)
 Q
"RTN","GMTSRAE",94,0)
GETREP ; Gets Radiologist's Report
"RTN","GMTSRAE",95,0)
 N GMLN,X
"RTN","GMTSRAE",96,0)
 K ^UTILITY($J,"W") S GMLN=0 F  S GMLN=$O(^RARPT(GMPTR,"R",GMLN)) Q:GMLN'>0  S X=^RARPT(GMPTR,"R",GMLN,0) D FORMAT
"RTN","GMTSRAE",97,0)
 I $D(^UTILITY($J,"W")) F GMLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMIDT,GMPN,"R",GMLN)=^UTILITY($J,"W",3,GMLN,0)
"RTN","GMTSRAE",98,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRAE",99,0)
 Q
"RTN","GMTSRAE",100,0)
FORMAT ; Calls ^DIWP to format each line of text
"RTN","GMTSRAE",101,0)
 N DIWF,DIWL,DIWR,I,J,Y,Z
"RTN","GMTSRAE",102,0)
 S DIWL=3,DIWR=($S(MODE=1:76,1:80))
"RTN","GMTSRAE",103,0)
 D ^DIWP
"RTN","GMTSRAE",104,0)
 Q
"RTN","GMTSRAE",105,0)
GETDX(GMIEN) ; Set the data node with diagnostic code info.
"RTN","GMTSRAE",106,0)
 ;
"RTN","GMTSRAE",107,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"D",seq #) = Dx codes (seq # = 1: Pri. Dx)
"RTN","GMTSRAE",108,0)
 ; ^TMP("RAE",$J,GMIDT,GMPN,"D",seq #) = Dx codes (seq # > 1: Sec. Dx)
"RTN","GMTSRAE",109,0)
 ; Input: GMIEN=case ien_","_rev exam date/time_","_patient dfn_","
"RTN","GMTSRAE",110,0)
 ;
"RTN","GMTSRAE",111,0)
 S ^TMP("RAE",$J,$P(GMIEN,",",2),$P(GMIEN,","),"D",1)=$G(GMRAD(70.03,$P(GMIEN,","),13,"E")) ; Get the Primary Dx code
"RTN","GMTSRAE",112,0)
 N GMI,GMII,GMSDX S GMI=1
"RTN","GMTSRAE",113,0)
 D GETS^DIQ(70.03,GMIEN,"13.1*","E","GMSDX") S GMII=""
"RTN","GMTSRAE",114,0)
 F  S GMII=$O(GMSDX(70.14,GMII)) Q:GMII=""  D
"RTN","GMTSRAE",115,0)
 . S GMI=GMI+1
"RTN","GMTSRAE",116,0)
 . S ^TMP("RAE",$J,$P(GMIEN,",",2),$P(GMIEN,","),"D",GMI)=$G(GMSDX(70.14,GMII,.01,"E")) ; Get the Secondary Dx code
"RTN","GMTSRAE",117,0)
 . Q
"RTN","GMTSRAE",118,0)
 Q
"RTN","GMTSRAS")
0^3^B17556976
"RTN","GMTSRAS",1,0)
GMTSRAS ;SLC/JER HIRMFO/GJC - Radiology Profile Component  ;2/13/98  14:13
"RTN","GMTSRAS",2,0)
 ;;2.7;Health Summary;**14,25**;Oct 20, 1995
"RTN","GMTSRAS",3,0)
ENSRA ; Controls branching
"RTN","GMTSRAS",4,0)
 N GMDATA,GMTSI,GMW,MAX,TEST
"RTN","GMTSRAS",5,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAS",6,0)
 I '$D(^RADPT(DFN,0)) Q
"RTN","GMTSRAS",7,0)
 D MAIN^GMTSRAE(2)
"RTN","GMTSRAS",8,0)
 I '$D(^TMP("RAE",$J)) Q
"RTN","GMTSRAS",9,0)
 D LOOP
"RTN","GMTSRAS",10,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAS",11,0)
 Q
"RTN","GMTSRAS",12,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRAS",13,0)
 N GMW,GMIDT,GMPN,GMLN,GMPSET,GMXSET
"RTN","GMTSRAS",14,0)
 S GMIDT=0 F  S GMIDT=$O(^TMP("RAE",$J,GMIDT)) Q:GMIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",15,0)
 . S GMPSET=$S($D(^TMP("RAE",$J,GMIDT,"PRINTSET")):1,1:0)
"RTN","GMTSRAS",16,0)
 . S GMXSET=$S($D(^TMP("RAE",$J,GMIDT,"EXAMSET")):1,1:0)
"RTN","GMTSRAS",17,0)
 . S GMPN=0 F  S GMPN=$O(^TMP("RAE",$J,GMIDT,GMPN)) Q:GMPN'>0  D
"RTN","GMTSRAS",18,0)
 . . D WRT
"RTN","GMTSRAS",19,0)
 . . I +$O(^TMP("RAE",$J,GMIDT,GMPN)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAS",20,0)
 . I +$O(^TMP("RAE",$J,GMIDT)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAS",21,0)
 Q
"RTN","GMTSRAS",22,0)
WRT ; Writes component data
"RTN","GMTSRAS",23,0)
 N X,GMEDT,GMI,GMPROC,GMRCPT,GMSTAT,GMTXT,GMRSTAT,GMRRAD,GMSRAD
"RTN","GMTSRAS",24,0)
 N GMTECH,GMTMP S GMDATA=1,GMTMP=$G(^TMP("RAE",$J,GMIDT,GMPN,0))
"RTN","GMTSRAS",25,0)
 S X=+GMTMP D REGDT^GMTSU S GMEDT=X
"RTN","GMTSRAS",26,0)
 S GMPROC=$P(GMTMP,U,2),GMSTAT=$P(GMTMP,U,3)
"RTN","GMTSRAS",27,0)
 S GMRCPT=$P(GMTMP,U,7),GMTECH=$P(GMTMP,U,8)
"RTN","GMTSRAS",28,0)
 S GMRSTAT=$P(GMTMP,U,4),GMRRAD=$P(GMTMP,U,5)
"RTN","GMTSRAS",29,0)
 S GMSRAD=$P(GMTMP,U,6)
"RTN","GMTSRAS",30,0)
 I $L(GMPROC)>35 S GMPROC=$$WRAP^GMTSORC(GMPROC,35)
"RTN","GMTSRAS",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",32,0)
 W:'GMXSET GMEDT ; for non-examsets
"RTN","GMTSRAS",33,0)
 W:GMXSET&(GMPN=$O(^TMP("RAE",$J,GMIDT,0))) GMEDT
"RTN","GMTSRAS",34,0)
 W ?12,GMPROC,! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",35,0)
 I 'GMPSET D  ; handle output for single exams/examsets (non-printsets)
"RTN","GMTSRAS",36,0)
 . W ?12,"CPT Code: ",GMRCPT,?39,"Interpreting Staff: ",GMSRAD,!
"RTN","GMTSRAS",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",38,0)
 . W ?12,"Status: ",$E(GMSTAT,1,18),?39,"Interpreting Res. : ",GMRRAD,!
"RTN","GMTSRAS",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",40,0)
 . W ?12,"Rpt Status: ",$E(GMRSTAT,1,18),?45,"Technologist: ",GMTECH,!
"RTN","GMTSRAS",41,0)
 . I $D(^TMP("RAE",$J,GMIDT,GMPN,"M")) D MODS
"RTN","GMTSRAS",42,0)
 . Q
"RTN","GMTSRAS",43,0)
 E  D  Q  ; GMPSET=1 handle output for printsets
"RTN","GMTSRAS",44,0)
 . W ?12,"CPT Code: ",GMRCPT,?39,"Status: ",$E(GMSTAT,1,18),!
"RTN","GMTSRAS",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Technologist: ",GMTECH
"RTN","GMTSRAS",46,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D MODS W:'$D(^TMP("RAE",$J,GMIDT,GMPN,"M")) ! ;Line feed if no mods
"RTN","GMTSRAS",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",48,0)
 . I '+$O(^TMP("RAE",$J,GMIDT,GMPN)) D
"RTN","GMTSRAS",49,0)
 .. ;last case in printset display rpt status, int'g staff/resident data 
"RTN","GMTSRAS",50,0)
 .. W ?12,"Rpt Status: ",$E(GMRSTAT,1,18),!
"RTN","GMTSRAS",51,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",52,0)
 .. W ?12,"Interpreting Staff: ",GMSRAD,!
"RTN","GMTSRAS",53,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",54,0)
 .. W ?12,"Interpreting Res. : ",GMRRAD,!
"RTN","GMTSRAS",55,0)
 .. N GMPN S GMPN=$O(^TMP("RAE",$J,GMIDT,0)) D:GMPN RPTXT
"RTN","GMTSRAS",56,0)
 .. Q
"RTN","GMTSRAS",57,0)
 . Q
"RTN","GMTSRAS",58,0)
RPTXT ; Display word processing fields associated with a Rad/Nuc Med Report
"RTN","GMTSRAS",59,0)
 ; Such fields are Clinical History, Report Text and Impression Text.
"RTN","GMTSRAS",60,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"H")) W "History: ",! D
"RTN","GMTSRAS",61,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"H",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"H",GMTXT),!
"RTN","GMTSRAS",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"R")) W !,"Report: ",! D
"RTN","GMTSRAS",63,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"R",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"R",GMTXT),!
"RTN","GMTSRAS",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"I")) W !,"Impression: ",! D
"RTN","GMTSRAS",65,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT),!
"RTN","GMTSRAS",66,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"D")) W !,"DX Codes: ",! D
"RTN","GMTSRAS",67,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"D",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"D",GMTXT),!
"RTN","GMTSRAS",68,0)
 . Q
"RTN","GMTSRAS",69,0)
 Q
"RTN","GMTSRAS",70,0)
MODS ; Display modifiers
"RTN","GMTSRAS",71,0)
 W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",72,0)
 W:+$G(GMPSET) ?12 W "Modifier: " S GMI=0
"RTN","GMTSRAS",73,0)
 F  S GMI=$O(^TMP("RAE",$J,GMIDT,GMPN,"M",GMI)) Q:+GMI'>0  D
"RTN","GMTSRAS",74,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",75,0)
 . W ?$S('+$G(GMPSET):10,1:22),^TMP("RAE",$J,GMIDT,GMPN,"M",GMI),!
"RTN","GMTSRAS",76,0)
 Q
"VER")
8.0^21.0
**END**
**END**
