Released GMRC*3*39 SEQ #40
Extracted from mail message
**KIDS**:GMRC*3.0*39^

**INSTALL NAME**
GMRC*3.0*39
"BLD",5728,0)
GMRC*3.0*39^CONSULT/REQUEST TRACKING^0^3050711^y
"BLD",5728,1,0)
^^1^1^3050427^^^^
"BLD",5728,1,1,0)
LIST MANAGER ALLOWS FORWARDING AND CANCELING USING TERMINATED USER
"BLD",5728,4,0)
^9.64PA^^
"BLD",5728,6)
5^
"BLD",5728,"KRN",0)
^9.67PA^8989.52^19
"BLD",5728,"KRN",.4,0)
.4
"BLD",5728,"KRN",.401,0)
.401
"BLD",5728,"KRN",.402,0)
.402
"BLD",5728,"KRN",.403,0)
.403
"BLD",5728,"KRN",.5,0)
.5
"BLD",5728,"KRN",.84,0)
.84
"BLD",5728,"KRN",3.6,0)
3.6
"BLD",5728,"KRN",3.8,0)
3.8
"BLD",5728,"KRN",9.2,0)
9.2
"BLD",5728,"KRN",9.8,0)
9.8
"BLD",5728,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5728,"KRN",9.8,"NM",1,0)
GMRCAFRD^^0^B39413623
"BLD",5728,"KRN",9.8,"NM",2,0)
GMRCADC^^0^B13902691
"BLD",5728,"KRN",9.8,"NM","B","GMRCADC",2)
 
"BLD",5728,"KRN",9.8,"NM","B","GMRCAFRD",1)
 
"BLD",5728,"KRN",19,0)
19
"BLD",5728,"KRN",19.1,0)
19.1
"BLD",5728,"KRN",101,0)
101
"BLD",5728,"KRN",409.61,0)
409.61
"BLD",5728,"KRN",771,0)
771
"BLD",5728,"KRN",870,0)
870
"BLD",5728,"KRN",8989.51,0)
8989.51
"BLD",5728,"KRN",8989.52,0)
8989.52
"BLD",5728,"KRN",8994,0)
8994
"BLD",5728,"KRN","B",.4,.4)
 
"BLD",5728,"KRN","B",.401,.401)
 
"BLD",5728,"KRN","B",.402,.402)
 
"BLD",5728,"KRN","B",.403,.403)
 
"BLD",5728,"KRN","B",.5,.5)
 
"BLD",5728,"KRN","B",.84,.84)
 
"BLD",5728,"KRN","B",3.6,3.6)
 
"BLD",5728,"KRN","B",3.8,3.8)
 
"BLD",5728,"KRN","B",9.2,9.2)
 
"BLD",5728,"KRN","B",9.8,9.8)
 
"BLD",5728,"KRN","B",19,19)
 
"BLD",5728,"KRN","B",19.1,19.1)
 
"BLD",5728,"KRN","B",101,101)
 
"BLD",5728,"KRN","B",409.61,409.61)
 
"BLD",5728,"KRN","B",771,771)
 
"BLD",5728,"KRN","B",870,870)
 
"BLD",5728,"KRN","B",8989.51,8989.51)
 
"BLD",5728,"KRN","B",8989.52,8989.52)
 
"BLD",5728,"KRN","B",8994,8994)
 
"BLD",5728,"QUES",0)
^9.62^^
"BLD",5728,"REQB",0)
^9.611^1^1
"BLD",5728,"REQB",1,0)
GMRC*3.0*35^1
"BLD",5728,"REQB","B","GMRC*3.0*35",1)
 
"MBREQ")
0
"PKG",406,-1)
1^1
"PKG",406,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",406,20,0)
^9.402P^^
"PKG",406,22,0)
^9.49I^1^1
"PKG",406,22,1,0)
3.0^2980101^2981113^1
"PKG",406,22,1,"PAH",1,0)
39^3050711^520637438
"PKG",406,22,1,"PAH",1,1,0)
^^1^1^3050711
"PKG",406,22,1,"PAH",1,1,1,0)
LIST MANAGER ALLOWS FORWARDING USING TERMINATED USER
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRCADC")
0^2^B13902691
"RTN","GMRCADC",1,0)
GMRCADC ;SLC/DLT/DCM - DC taken from List Manager ; 7/11/05 1:40pm
"RTN","GMRCADC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,10,12,35,39**;DEC 27, 1997
"RTN","GMRCADC",3,0)
EXAC(MSG) ;Exit message asking for user to press <ENTER>; EXAC=Exit Action
"RTN","GMRCADC",4,0)
 N ND,X
"RTN","GMRCADC",5,0)
 W $C(7),!,MSG I $O(MSG(0)) S ND=0 F  S ND=$O(MSG(ND)) Q:ND=""  D
"RTN","GMRCADC",6,0)
 . W !,MSG(ND)
"RTN","GMRCADC",7,0)
 W !,"Press <RETURN> to continue: " R X:DTIME W !!
"RTN","GMRCADC",8,0)
 Q
"RTN","GMRCADC",9,0)
DC(GMRCO,GMRCA) ;Discontinue a consult logic from DC^GMRCA1
"RTN","GMRCADC",10,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCADC",11,0)
 N GMRCDA,GMRCACTM,GMRCADUZ,GMRCSERV,GMRCAD,GMRC
"RTN","GMRCADC",12,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCADC",13,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCADC",14,0)
 I '+$G(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",15,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D  Q
"RTN","GMRCADC",16,0)
 . N DIR
"RTN","GMRCADC",17,0)
 . W !,"The requesting facility may not take this action on an "
"RTN","GMRCADC",18,0)
 . W "inter-facility consult."
"RTN","GMRCADC",19,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMRCADC",20,0)
 . S GMRCQUT=1
"RTN","GMRCADC",21,0)
 I '$$LOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",22,0)
 ;
"RTN","GMRCADC",23,0)
 S GMRC(0)=^GMR(123,GMRCO,0),GMRCDA=GMRCO
"RTN","GMRCADC",24,0)
 S (GMRCDFN,DFN)=$P(GMRC(0),"^",2)
"RTN","GMRCADC",25,0)
 I $D(GMRCA),+GMRCA S GMRCACTM=$S(GMRCA=6:"Discontinued",GMRCA=19:"Cancelled",1:$P($G(^GMR(123.1,+GMRCA,0)),"^",1))
"RTN","GMRCADC",26,0)
 ;
"RTN","GMRCADC",27,0)
 D PROC I $D(GMRCQUT) D UNLOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",28,0)
 ;send 513 back to service printer if request DC'd or Cancelled
"RTN","GMRCADC",29,0)
 I GMRCA=6,$$DCPRNT^GMRCUTL1(+GMRCO,DUZ) D
"RTN","GMRCADC",30,0)
 . D PRNT^GMRCUTL1(+$P(GMRC(0),U,5),+GMRCO)
"RTN","GMRCADC",31,0)
 S GMRCTRLC=$S(GMRCA=19:"OC",1:"OD")
"RTN","GMRCADC",32,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCADC",33,0)
 D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCADC",34,0)
 Q
"RTN","GMRCADC",35,0)
 ;
"RTN","GMRCADC",36,0)
PROC ;Check validity of action and if valid process the discontinue action
"RTN","GMRCADC",37,0)
 N DIROUT,DTOUT,DUOUT,GMRCMSG,GMRCFL,GMRCACT
"RTN","GMRCADC",38,0)
 I $P(GMRC(0),"^",12)=1 S GMRCMSG="This consult has already been discontinued!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",39,0)
 I $P(GMRC(0),"^",12)=2 S GMRCMSG="This consult has already been completed!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",40,0)
 I $P(GMRC(0),"^",12)=9 S GMRCMSG="Action invalid. This consult has partial results!",GMRCMSG(1)="Remove the associated results and then discontinue." D EXAC(.GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",41,0)
 I $P(GMRC(0),"^",12)=13 S GMRCMSG="This consult has already been cancelled!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",42,0)
 ;
"RTN","GMRCADC",43,0)
 S GMRCORVP=GMRCDFN_";DPT("
"RTN","GMRCADC",44,0)
 N GETPROV
"RTN","GMRCADC",45,0)
FRGTPRV D GETPROV^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) S GMRCQUT=1 Q
"RTN","GMRCADC",46,0)
 S GMRCACT=$$PROVIDER^XUSER(GMRCORNP) I $P(GMRCACT,U)'=1 D  G FRGTPRV
"RTN","GMRCADC",47,0)
 .W !!,"***User account is TERMINATED please choose another responsible user.***"
"RTN","GMRCADC",48,0)
 S GMRCAD=$$GETDT^GMRCUTL1 ;Returns GMRCAD as the entered date
"RTN","GMRCADC",49,0)
 I GMRCAD="^" S GMRCQUT=1 Q
"RTN","GMRCADC",50,0)
 S GMRCSTS=$S(GMRCA=6:1,1:13),$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCADC",51,0)
 S GMRCOM=1
"RTN","GMRCADC",52,0)
 D STATUS^GMRCP
"RTN","GMRCADC",53,0)
 D AUDIT^GMRCP
"RTN","GMRCADC",54,0)
 ;
"RTN","GMRCADC",55,0)
 S GMRCORTX=$S($L($G(GMRCACTM)):GMRCACTM,+GMRCA:$P(^GMR(123.1,GMRCA,0),U,1),1:"ACTION UNKNOWN FOR")_" consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCADC",56,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCADC",57,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),+$P(^(0),"^",14)'=DUZ S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCADC",58,0)
 ;I +$P($G(^GMR(123,+GMRCO,0)),"^",14)=DUZ S GMRCFL=1
"RTN","GMRCADC",59,0)
 I GMRCA=6 S GMRCFL=$$DCNOTE(GMRCO,DUZ) ;check NOTIFY SERVICE ON DC
"RTN","GMRCADC",60,0)
 I GMRCA=19 S GMRCFL=1
"RTN","GMRCADC",61,0)
 ;send notification info to routine to be sent to OERR
"RTN","GMRCADC",62,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCADC",63,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCADC",64,0)
 Q
"RTN","GMRCADC",65,0)
DCNOTE(IEN,USER) ;determine if service users receive alerts based on 1.04
"RTN","GMRCADC",66,0)
 N SERV,DCFLG
"RTN","GMRCADC",67,0)
 S SERV=$P(^GMR(123,IEN,0),U,5)
"RTN","GMRCADC",68,0)
 S DCFLG=$P($G(^GMR(123.5,SERV,1)),U,4)
"RTN","GMRCADC",69,0)
 I 'DCFLG Q 1
"RTN","GMRCADC",70,0)
 I DCFLG=2 Q 0
"RTN","GMRCADC",71,0)
 I DCFLG=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCADC",72,0)
 Q 0
"RTN","GMRCAFRD")
0^1^B39413623
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM,JFR - LM FORWARD ACTION ;7/11/03 14:02
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,15,22,35,39**;DEC 27, 1997
"RTN","GMRCAFRD",3,0)
 ;
"RTN","GMRCAFRD",4,0)
 ; This routine invokes IA #2395
"RTN","GMRCAFRD",5,0)
 ;
"RTN","GMRCAFRD",6,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",7,0)
 N ORVP,GMRCLCK,DFN,GMRCACT
"RTN","GMRCAFRD",8,0)
 W !!,"Forward Request To Another Service For Action."
"RTN","GMRCAFRD",9,0)
 W !,"Select the service to send the consult to.",!
"RTN","GMRCAFRD",10,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",11,0)
 N GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCAD,GMRCTO,GMRCADUZ
"RTN","GMRCAFRD",12,0)
 K GMRCQUT,GMRCSEL,GMRCSSS
"RTN","GMRCAFRD",13,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",14,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",15,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D  Q
"RTN","GMRCAFRD",16,0)
 . N DIR
"RTN","GMRCAFRD",17,0)
 . W !,"The requesting facility may not take this action on an "
"RTN","GMRCAFRD",18,0)
 . W "inter-facility consult."
"RTN","GMRCAFRD",19,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMRCAFRD",20,0)
 . D END
"RTN","GMRCAFRD",21,0)
 . S GMRCQUT=1
"RTN","GMRCAFRD",22,0)
 I '$$LOCK^GMRCA1(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",23,0)
 S GMRCLCK=1
"RTN","GMRCAFRD",24,0)
 ;
"RTN","GMRCAFRD",25,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",26,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",27,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=9 D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",28,0)
 .S GMRCMSG="Invalid action. This consult has partial results."
"RTN","GMRCAFRD",29,0)
 .S GMRCMSG(1)="Remove the associated results before forwarding."
"RTN","GMRCAFRD",30,0)
 .D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",31,0)
 ;
"RTN","GMRCAFRD",32,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",33,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",34,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",35,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",36,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",37,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",38,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",39,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",40,0)
FRGTPRV D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",41,0)
 S GMRCACT=$$PROVIDER^XUSER(GMRCORNP) I $P(GMRCACT,U)'=1 D  G FRGTPRV
"RTN","GMRCAFRD",42,0)
 .W !!,"***User account is TERMINATED please choose another responsible user.***"
"RTN","GMRCAFRD",43,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",44,0)
 I '$G(GMRCAD) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCAFRD",45,0)
 N GMRCSS,GMRCSSNM,GMRCA,GMRCMSG,GMRCIROL,GMRCINM,GMRCIROU,ORSTS
"RTN","GMRCAFRD",46,0)
 D DEFAULT
"RTN","GMRCAFRD",47,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",48,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",49,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",50,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",51,0)
 S GMRCA=17,DR=""
"RTN","GMRCAFRD",52,0)
 I $D(^GMR(123.5,+GMRCSS,"IFC")) D  ; if fwd to IFC serv, get extra flds
"RTN","GMRCAFRD",53,0)
 . S GMRCIROU=$P(^GMR(123.5,+GMRCSS,"IFC"),U) Q:GMRCIROU=""  ;no rout fac
"RTN","GMRCAFRD",54,0)
 . S GMRCINM=$P(^GMR(123.5,+GMRCSS,"IFC"),U,2) Q:GMRCINM=""  ;no serv nm
"RTN","GMRCAFRD",55,0)
 . S GMRCA=25,GMRCIROL="P"
"RTN","GMRCAFRD",56,0)
 . S DR=".07////^S X=GMRCIROU;.125////^S X=GMRCIROL;.131///^S X=GMRCINM;"
"RTN","GMRCAFRD",57,0)
 S DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",58,0)
 S DR=DR_"1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA;.1///@"
"RTN","GMRCAFRD",59,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",60,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",61,0)
 S GMRCOM=1 D AUDIT^GMRCP ;GMRCORNP is the responsible provider here
"RTN","GMRCAFRD",62,0)
 ;
"RTN","GMRCAFRD",63,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO) ;unlk before FWD changes order #
"RTN","GMRCAFRD",64,0)
 ;
"RTN","GMRCAFRD",65,0)
FRMSG ; Common logic used by GUI and List Manager to process the HL7 message
"RTN","GMRCAFRD",66,0)
 ; to update the order in OE/RR and then forward an alert to recipients
"RTN","GMRCAFRD",67,0)
 ; is passed in as the DUZ instead of the responsible provider
"RTN","GMRCAFRD",68,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX^FORWARD",$G(DUZ),$G(VISIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAFRD",69,0)
 S GMRCADUZ=""
"RTN","GMRCAFRD",70,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",71,0)
 I +$G(GMRCORNP) S GMRCADUZ(+GMRCORNP)="" ;alert original provider of forward
"RTN","GMRCAFRD",72,0)
 S GMRCORTX="Forwarded consult "_$$ORTX^GMRCAU(+GMRCO)_" ("_GMRCURG_")"
"RTN","GMRCAFRD",73,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,1) ;GMRCO=IEN of consult from file 123; 27 is notification entry from file ORD(100.9
"RTN","GMRCAFRD",74,0)
 K GMRCOM
"RTN","GMRCAFRD",75,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",76,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",77,0)
 D END
"RTN","GMRCAFRD",78,0)
 Q
"RTN","GMRCAFRD",79,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",80,0)
 N X,Y,XQORM,DIROUT,DTOUT,DIRUT,DUOUT
"RTN","GMRCAFRD",81,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",82,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",83,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",84,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",85,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",86,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",87,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",88,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D EN^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",89,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",90,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",91,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",92,0)
 Q
"RTN","GMRCAFRD",93,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",94,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",95,0)
 N GMRC,GMRCDIC,GMRCPLI,GMRCPRI
"RTN","GMRCAFRD",96,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",97,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",98,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",99,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",100,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",101,0)
 S GMRCPRI=$P(GMRC(0),"^",8) I GMRCPRI["ORD(101" D
"RTN","GMRCAFRD",102,0)
 . S GMRCPR=$$GET1^DIQ(101,+GMRCPRI,1)
"RTN","GMRCAFRD",103,0)
 I $L(GMRCPRI),GMRCPRI'["ORD(101" D  ;ZPROC
"RTN","GMRCAFRD",104,0)
 . S GMRCPR=$$GET1^DIQ(123.3,+GMRCPRI,.01)
"RTN","GMRCAFRD",105,0)
TYPE ;This entry point is used when the only default needed is the GMRCTYPE
"RTN","GMRCAFRD",106,0)
 ;Called by GMRCGUIA to get variables ready for FRMSG call.
"RTN","GMRCAFRD",107,0)
 S GMRCTYPE=$$GET1^DIQ(123,+GMRCO,13,"I") ;ZPROC (P or C)
"RTN","GMRCAFRD",108,0)
 Q
"RTN","GMRCAFRD",109,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",110,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCAFRD",111,0)
 K GETPROV,GMRCDG,GMRCDEV,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP
"RTN","GMRCAFRD",112,0)
 K GMRCTYPE,GMRCORTX,GMRCPL,GMRCPR,GMRCSEL,GMRCURG,GMRCADUZ,Y
"RTN","GMRCAFRD",113,0)
 K DTOUT,DIROUT,DUOUT,GMRCURGI
"RTN","GMRCAFRD",114,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",115,0)
 Q
"VER")
8.0^22.0
"BLD",5728,6)
^SEQ #40
**END**
**END**
