Released TIU*1*178 SEQ #167
Extracted from mail message
**KIDS**:TIU*1.0*178^

**INSTALL NAME**
TIU*1.0*178
"BLD",4742,0)
TIU*1.0*178^TEXT INTEGRATION UTILITIES^0^3040316^y
"BLD",4742,1,0)
^^2^2^3031028^
"BLD",4742,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",4742,1,2,0)
under patch TIU*1.0*178.
"BLD",4742,4,0)
^9.64PA^^
"BLD",4742,"KRN",0)
^9.67PA^8989.52^19
"BLD",4742,"KRN",.4,0)
.4
"BLD",4742,"KRN",.401,0)
.401
"BLD",4742,"KRN",.402,0)
.402
"BLD",4742,"KRN",.403,0)
.403
"BLD",4742,"KRN",.5,0)
.5
"BLD",4742,"KRN",.84,0)
.84
"BLD",4742,"KRN",3.6,0)
3.6
"BLD",4742,"KRN",3.8,0)
3.8
"BLD",4742,"KRN",9.2,0)
9.2
"BLD",4742,"KRN",9.8,0)
9.8
"BLD",4742,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4742,"KRN",9.8,"NM",1,0)
TIULS^^0^B18317479
"BLD",4742,"KRN",9.8,"NM",2,0)
TIUSRVA^^0^B21540173
"BLD",4742,"KRN",9.8,"NM","B","TIULS",1)

"BLD",4742,"KRN",9.8,"NM","B","TIUSRVA",2)

"BLD",4742,"KRN",19,0)
19
"BLD",4742,"KRN",19.1,0)
19.1
"BLD",4742,"KRN",101,0)
101
"BLD",4742,"KRN",409.61,0)
409.61
"BLD",4742,"KRN",771,0)
771
"BLD",4742,"KRN",870,0)
870
"BLD",4742,"KRN",8989.51,0)
8989.51
"BLD",4742,"KRN",8989.52,0)
8989.52
"BLD",4742,"KRN",8994,0)
8994
"BLD",4742,"KRN","B",.4,.4)

"BLD",4742,"KRN","B",.401,.401)

"BLD",4742,"KRN","B",.402,.402)

"BLD",4742,"KRN","B",.403,.403)

"BLD",4742,"KRN","B",.5,.5)

"BLD",4742,"KRN","B",.84,.84)

"BLD",4742,"KRN","B",3.6,3.6)

"BLD",4742,"KRN","B",3.8,3.8)

"BLD",4742,"KRN","B",9.2,9.2)

"BLD",4742,"KRN","B",9.8,9.8)

"BLD",4742,"KRN","B",19,19)

"BLD",4742,"KRN","B",19.1,19.1)

"BLD",4742,"KRN","B",101,101)

"BLD",4742,"KRN","B",409.61,409.61)

"BLD",4742,"KRN","B",771,771)

"BLD",4742,"KRN","B",870,870)

"BLD",4742,"KRN","B",8989.51,8989.51)

"BLD",4742,"KRN","B",8989.52,8989.52)

"BLD",4742,"KRN","B",8994,8994)

"BLD",4742,"QUES",0)
^9.62^^
"BLD",4742,"REQB",0)
^9.611^1^1
"BLD",4742,"REQB",1,0)
TIU*1.0*160^2
"BLD",4742,"REQB","B","TIU*1.0*160",1)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
178^3040316
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3040316
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under patch TIU*1.0*178.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIULS")
0^1^B18317479
"RTN","TIULS",1,0)
TIULS ; SLC/JER - String Library functions ;10/7/94  17:18 [1/5/04 11:29am]
"RTN","TIULS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**178**;Jun 20, 1997
"RTN","TIULS",3,0)
 ;
"RTN","TIULS",4,0)
 ;                   **** WARNING ****
"RTN","TIULS",5,0)
 ;
"RTN","TIULS",6,0)
 ; Any patch which makes ANY changes to this rtn must include a
"RTN","TIULS",7,0)
 ;note in the patch desc reminding sites to update the Imaging
"RTN","TIULS",8,0)
 ;Gateway.  See IA # 3622.
"RTN","TIULS",9,0)
 ; IN ADDITION, if changes are made to components used by Imaging,
"RTN","TIULS",10,0)
 ;namely, MIXED, backward compatibility may not be enough. If
"RTN","TIULS",11,0)
 ;changes call additional rtns, TIU should consult with Imaging
"RTN","TIULS",12,0)
 ;on need to add additional rtns to list of TIU rtns copied for
"RTN","TIULS",13,0)
 ;Imaging Gateway.
"RTN","TIULS",14,0)
 ;                         ****
"RTN","TIULS",15,0)
 ;
"RTN","TIULS",16,0)
TIME(X,FMT) ; Recieves X as 2910419.01 and FMT=Return Format of time (HH:MM:SS).
"RTN","TIULS",17,0)
 N HR,MIN,SEC,TIUI
"RTN","TIULS",18,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="HR:MIN"
"RTN","TIULS",19,0)
 S X=$P(X,".",2),HR=$E(X,1,2)_$E("00",0,2-$L($E(X,1,2))),MIN=$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),SEC=$E(X,5,6)_$E("00",0,2-$L($E(X,5,6)))
"RTN","TIULS",20,0)
 F TIUI="HR","MIN","SEC" S:FMT[TIUI FMT=$P(FMT,TIUI)_@TIUI_$P(FMT,TIUI,2)
"RTN","TIULS",21,0)
 Q FMT
"RTN","TIULS",22,0)
DATE(X,FMT) ; Call with X=2910419.01 and FMT=Return Format of date ("MM/DD")
"RTN","TIULS",23,0)
 N AMTH,MM,CC,DD,YY,TIUI,TIUTMP
"RTN","TIULS",24,0)
 I +X'>0 S $P(TIUTMP," ",$L($G(FMT))+1)="",FMT=TIUTMP G QDATE
"RTN","TIULS",25,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="MM/DD/YY"
"RTN","TIULS",26,0)
 S MM=$E(X,4,5),DD=$E(X,6,7),YY=$E(X,2,3),CC=17+$E(X)
"RTN","TIULS",27,0)
 S:FMT["AMTH" AMTH=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+MM)
"RTN","TIULS",28,0)
 F TIUI="AMTH","MM","DD","CC","YY" S:FMT[TIUI FMT=$P(FMT,TIUI)_@TIUI_$P(FMT,TIUI,2)
"RTN","TIULS",29,0)
 I FMT["HR" S FMT=$$TIME(X,FMT)
"RTN","TIULS",30,0)
QDATE Q FMT
"RTN","TIULS",31,0)
NAME(X,FMT) ; Call with X="LAST,FIRST MI", FMT=Return Format ("LAST, FI")
"RTN","TIULS",32,0)
 N TIULAST,TIULI,TIUFIRST,TIUFI,TIUMI,TIUI
"RTN","TIULS",33,0)
 I X']"" S FMT="" G NAMEX
"RTN","TIULS",34,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="LAST,FIRST"
"RTN","TIULS",35,0)
 S FMT=$$LOWER(FMT)
"RTN","TIULS",36,0)
 S TIULAST=$P(X,","),TIULI=$E(TIULAST),TIUFIRST=$P(X,",",2)
"RTN","TIULS",37,0)
 S TIUFI=$E(TIUFIRST)
"RTN","TIULS",38,0)
 S TIUMI=$S($P(TIUFIRST," ",2)'="NMI":$E($P(TIUFIRST," ",2)),1:"")
"RTN","TIULS",39,0)
 S TIUFIRST=$P(TIUFIRST," ")
"RTN","TIULS",40,0)
 F TIUI="last","li","first","fi","mi" I FMT[TIUI S FMT=$P(FMT,TIUI)_@("TIU"_$$UPPER(TIUI))_$P(FMT,TIUI,2)
"RTN","TIULS",41,0)
NAMEX Q FMT
"RTN","TIULS",42,0)
INAME(X) ; Call with X="FIRST MI[.] LAST[,M.D.]", RETURNS "LAST,FIRST MI"
"RTN","TIULS",43,0)
 N LAST,FIRST,MIDDLE,NAME,MI
"RTN","TIULS",44,0)
 I X'?1.A1" ".E S NAME=X G INAMEX
"RTN","TIULS",45,0)
 S NAME=$P(X,","),FIRST=$P(NAME," "),MIDDLE=$S($L(NAME," ")=3:$P(NAME," ",2),1:"")
"RTN","TIULS",46,0)
 S LAST=$P(NAME," ",$L(NAME," ")),MI=$S($L(MIDDLE):$E(MIDDLE),1:"")
"RTN","TIULS",47,0)
 S NAME=LAST_","_FIRST_$S($L(MI):" "_MI,1:"")
"RTN","TIULS",48,0)
INAMEX Q NAME
"RTN","TIULS",49,0)
WORD(X,FMT) ; Call with X=Word Processing array root, FMT=Wrap Width
"RTN","TIULS",50,0)
 N X,DIWL,DIWF,TIUI K ^UTILITY($J,"W")
"RTN","TIULS",51,0)
 S DIWL=2,DIWF="WRC"_FMT
"RTN","TIULS",52,0)
 S TIUI=0 F  S TIUI=$O(@X@(TIUI)) Q:TIUI'>0  S X=^(TIUI,0) D ^DIWP
"RTN","TIULS",53,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIULS",54,0)
 Q ""
"RTN","TIULS",55,0)
UPPER(X) ; Convert lower case X to UPPER CASE
"RTN","TIULS",56,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","TIULS",57,0)
LOWER(X) ; Convert UPPER CASE X to lower case
"RTN","TIULS",58,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","TIULS",59,0)
MIXED(X) ; Return Mixed Case X
"RTN","TIULS",60,0)
 N TIUI,WORD,TMP
"RTN","TIULS",61,0)
 S TMP="" F TIUI=1:1:$L(X," ") S WORD=$$UPPER($E($P(X," ",TIUI)))_$$LOWER($E($P(X," ",TIUI),2,$L($P(X," ",TIUI)))),TMP=$S(TMP="":WORD,1:TMP_" "_WORD)
"RTN","TIULS",62,0)
 Q TMP
"RTN","TIULS",63,0)
STRIP(TEXT) ; Strips white space from text
"RTN","TIULS",64,0)
 N TIUTI,TIUX
"RTN","TIULS",65,0)
 ; First remove TABS
"RTN","TIULS",66,0)
 F TIUTI=1:1:$L(TEXT) S:$A(TEXT,TIUTI)=9 TEXT=$E(TEXT,1,(TIUTI-1))_" "_$E(TEXT,(TIUTI+1),$L(TEXT))
"RTN","TIULS",67,0)
 S TIUX="" F TIUTI=1:1:$L(TEXT," ") S:$A($P(TEXT," ",TIUTI))>0 TIUX=TIUX_$S(TIUTI=1:"",1:" ")_$P(TEXT," ",TIUTI)
"RTN","TIULS",68,0)
 S TEXT=TIUX S:$P(TEXT," ")']"" TEXT=$P(TEXT," ",2,$L(TEXT," "))
"RTN","TIULS",69,0)
 Q TEXT
"RTN","TIULS",70,0)
SIGNAME(TIUDA) ; Get/Return Signature Block Printed Name
"RTN","TIULS",71,0)
 Q $P($G(^VA(200,+TIUDA,20)),U,2)
"RTN","TIULS",72,0)
SIGTITL(TIUDA) ; Get/Return Signature Block Printed Name
"RTN","TIULS",73,0)
 Q $P($G(^VA(200,+TIUDA,20)),U,3)
"RTN","TIULS",74,0)
CENTER(X) ; Center X
"RTN","TIULS",75,0)
 N SP
"RTN","TIULS",76,0)
 S $P(SP," ",((IOM-$L(X))\2))=""
"RTN","TIULS",77,0)
 Q $G(SP)_X
"RTN","TIULS",78,0)
URGENCY(X) ; Input transform for urgency codes
"RTN","TIULS",79,0)
 Q $S($$UPPER(X)="STAT":"P",1:$E(X))
"RTN","TIULS",80,0)
FILL(X,Y,LEN) ; Append ", "_X to Y, unless Y would excede LEN
"RTN","TIULS",81,0)
 Q $S('$L(Y):X,($L(Y_$C(44)_" "_X)'>LEN):Y_$C(44)_" "_X,1:X)
"RTN","TIULS",82,0)
PARSE(X,Y) ; Parse string X, return array Y with list of words from X
"RTN","TIULS",83,0)
 N I,WORD
"RTN","TIULS",84,0)
 F I=1:1:$L(X," ") D
"RTN","TIULS",85,0)
 . S WORD=$P(X," ",I),WORD=$TR(WORD,".,!&?/|\{}[];:=+*^%$#@~`""><")
"RTN","TIULS",86,0)
 . S:WORD]"" Y(I)=$$UPPER(WORD)
"RTN","TIULS",87,0)
 Q
"RTN","TIULS",88,0)
HASNUM(X) ; Boolean - evaluates whether X contains a number
"RTN","TIULS",89,0)
 N I,Y F I=0:1:9 I X[I S Y=1
"RTN","TIULS",90,0)
 Q +$G(Y)
"RTN","TIULS",91,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings of length LENGTH
"RTN","TIULS",92,0)
 N TIUI,TIUJ,LINE,TIUX,TIUX1,TIUX2,TIUY
"RTN","TIULS",93,0)
 I $G(TEXT)']"" Q ""
"RTN","TIULS",94,0)
 F TIUI=1:1 D  Q:TIUI=$L(TEXT," ")
"RTN","TIULS",95,0)
 . S TIUX=$P(TEXT," ",TIUI)
"RTN","TIULS",96,0)
 . I $L(TIUX)>LENGTH D
"RTN","TIULS",97,0)
 . . S TIUX1=$E(TIUX,1,LENGTH),TIUX2=$E(TIUX,LENGTH+1,$L(TIUX))
"RTN","TIULS",98,0)
 . . S $P(TEXT," ",TIUI)=TIUX1_" "_TIUX2
"RTN","TIULS",99,0)
 S LINE=1,TIUX(1)=$P(TEXT," ")
"RTN","TIULS",100,0)
 F TIUI=2:1 D  Q:TIUI'<$L(TEXT," ")
"RTN","TIULS",101,0)
 . S:$L($G(TIUX(LINE))_" "_$P(TEXT," ",TIUI))>LENGTH LINE=LINE+1,TIUY=1
"RTN","TIULS",102,0)
 . S TIUX(LINE)=$G(TIUX(LINE))_$S(+$G(TIUY):"",1:" ")_$P(TEXT," ",TIUI),TIUY=0
"RTN","TIULS",103,0)
 S TIUJ=0,TEXT="" F TIUI=1:1 S TIUJ=$O(TIUX(TIUJ)) Q:+TIUJ'>0  S TEXT=TEXT_$S(TIUI=1:"",1:"|")_TIUX(TIUJ)
"RTN","TIULS",104,0)
 Q TEXT
"RTN","TIUSRVA")
0^2^B21540173
"RTN","TIUSRVA",1,0)
TIUSRVA ; SLC/JER,AJB - API's for Authorization ; 12/03/03
"RTN","TIUSRVA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,47,80,100,116,152,160,178**;Jun 20, 1997
"RTN","TIUSRVA",3,0)
 ;
"RTN","TIUSRVA",4,0)
 ;External reference to File ^AUPNVSIT supported by DBIA 3580
"RTN","TIUSRVA",5,0)
REQCOS(TIUY,TIUTYP,TIUDA,TIUSER) ; Evaluate cosignature requirement
"RTN","TIUSRVA",6,0)
 ; Initialize return value
"RTN","TIUSRVA",7,0)
 N TIUDPRM
"RTN","TIUSRVA",8,0)
 S TIUY=0
"RTN","TIUSRVA",9,0)
 I +$G(TIUTYP)'>0,'+$G(TIUDA) Q
"RTN","TIUSRVA",10,0)
 I +$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$G(TIUDA),0))
"RTN","TIUSRVA",11,0)
 S:'+$G(TIUSER) TIUSER=+$G(DUZ)
"RTN","TIUSRVA",12,0)
 S TIUY=+$$REQCOSIG^TIULP(TIUTYP,+$G(TIUDA),+$G(TIUSER))
"RTN","TIUSRVA",13,0)
 Q
"RTN","TIUSRVA",14,0)
URGENCY(Y) ; -- retrieve set values from dd for discharge summary urgency
"RTN","TIUSRVA",15,0)
 N TIUDD,I,X
"RTN","TIUSRVA",16,0)
 D FIELD^DID(8925,.09,"","POINTER","TIUDD")
"RTN","TIUSRVA",17,0)
 F I=1:1 S X=$P(TIUDD("POINTER"),";",I) Q:X=""   S Y(I)=$TR(X,":","^")
"RTN","TIUSRVA",18,0)
 Q
"RTN","TIUSRVA",19,0)
CANDO(Y,TIUDA,TIUACT) ; Boolean function to evaluate privilege
"RTN","TIUSRVA",20,0)
 N TIUPOP,TIUDPRM S TIUPOP=0
"RTN","TIUSRVA",21,0)
 ; **152** code added to prevent editing a completed document.
"RTN","TIUSRVA",22,0)
 I $P($G(^TIU(8925,TIUDA,0)),U,5)>6,(TIUACT="EDIT RECORD") S Y="0^ You may not edit a completed document" Q
"RTN","TIUSRVA",23,0)
 I $S(TIUACT["SIGN":1,TIUACT="EDIT RECORD":1,TIUACT="DELETE RECORD":1,1:0) D  Q:+TIUPOP=1
"RTN","TIUSRVA",24,0)
 . L +^TIU(8925,+TIUDA):1
"RTN","TIUSRVA",25,0)
 . E  S Y="0^ Another session is editing this entry.",TIUPOP=1
"RTN","TIUSRVA",26,0)
 . L -^TIU(8925,+TIUDA)
"RTN","TIUSRVA",27,0)
 I TIUACT["SIGN",+$$NEEDCS(TIUDA) S Y="0^ You must name a cosigner before signing this document." Q
"RTN","TIUSRVA",28,0)
 S Y=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVA",29,0)
 Q
"RTN","TIUSRVA",30,0)
NEEDCS(TIUDA) ; Does user need a cosigner?
"RTN","TIUSRVA",31,0)
 N TIUD0,TIUD12,TIUY,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",32,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUSRVA",33,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8),XTRASGNR=0
"RTN","TIUSRVA",34,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",35,0)
 I +XTRASGNR S TIUY=0
"RTN","TIUSRVA",36,0)
 E  I +$$REQCOSIG^TIULP(+TIUD0,TIUDA,DUZ),(+$P(TIUD12,U,8)'>0) S TIUY=1
"RTN","TIUSRVA",37,0)
 Q +$G(TIUY)
"RTN","TIUSRVA",38,0)
USRINACT(TIUY,TIUDA) ; Is user inactive?
"RTN","TIUSRVA",39,0)
 S TIUY=+$$GET1^DIQ(200,TIUDA_",",7,"I")
"RTN","TIUSRVA",40,0)
 Q
"RTN","TIUSRVA",41,0)
AUTHSIGN(TIUY,TIUDA,TIUUSR) ; Has Author signed?
"RTN","TIUSRVA",42,0)
 ; if TIUY = 
"RTN","TIUSRVA",43,0)
 ; 0 = Author has NOT signed & TIUUSR = Expected Cosigner
"RTN","TIUSRVA",44,0)
 ; 1 = Author HAS signed or TIUUSR '= Expected Cosigner
"RTN","TIUSRVA",45,0)
 ;
"RTN","TIUSRVA",46,0)
 N TIUD12,TIUD15
"RTN","TIUSRVA",47,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD15=$G(^(15))
"RTN","TIUSRVA",48,0)
 S TIUY=1
"RTN","TIUSRVA",49,0)
 D:$P(TIUD12,U,8)=TIUUSR  Q
"RTN","TIUSRVA",50,0)
 . S:$P(TIUD12,U,2)'=$P(TIUD15,U,2) TIUY=0
"RTN","TIUSRVA",51,0)
 Q
"RTN","TIUSRVA",52,0)
TIUVISIT(TIUY,DOCTYP,DFN,VISIT) ;  DK - Check for a 1 time only doc
"RTN","TIUSRVA",53,0)
 ;  TIUY    =    return value
"RTN","TIUSRVA",54,0)
 ;          = 0 if can add more than one or none already exist
"RTN","TIUSRVA",55,0)
 ;          = 1 if cannot add more than one and one already exists
"RTN","TIUSRVA",56,0)
 ;  DOCTYP  =    Pointer to ^TUI(8925.1,   TIU DOCUMENT DEFINITION
"RTN","TIUSRVA",57,0)
 ;  DFN     =    Patient IEN
"RTN","TIUSRVA",58,0)
 ;  VISIT   =    Visit String "LOC;VDATE;VTYP"
"RTN","TIUSRVA",59,0)
 I $$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",60,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",61,0)
 . N TIUDPRM,TIUTEST
"RTN","TIUSRVA",62,0)
 . D DOCPRM^TIULC1(DOCTYP,.TIUDPRM)
"RTN","TIUSRVA",63,0)
 . S TIUY=$S($P(TIUDPRM(0),U,10)="":1,1:$P(TIUDPRM(0),U,10))
"RTN","TIUSRVA",64,0)
 . I TIUY=1 S TIUY=0 Q
"RTN","TIUSRVA",65,0)
 . I $L(VISIT,";")=3 D
"RTN","TIUSRVA",66,0)
 . . S TIUTEST=$$EXIST^TIUEDI3(DFN,DOCTYP,VISIT)
"RTN","TIUSRVA",67,0)
 . . I TIUTEST S TIUY=1
"RTN","TIUSRVA",68,0)
 . . I 'TIUTEST S TIUY=0
"RTN","TIUSRVA",69,0)
 I '$$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",70,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",71,0)
 . N X3
"RTN","TIUSRVA",72,0)
 . S X3=+$O(^TIU(8925.95,"B",DOCTYP,""))
"RTN","TIUSRVA",73,0)
 . S TIUY=$P($G(^TIU(8925.95,X3,0)),U,10) S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",74,0)
 . Q:'TIUY
"RTN","TIUSRVA",75,0)
 . S VISIT=((9999999-$P(VISIT,"."))_"."_$P(VISIT,".",2))
"RTN","TIUSRVA",76,0)
 . S VISIT=+$O(^AUPNVSIT("AA",DFN,VISIT,""))
"RTN","TIUSRVA",77,0)
 . S TIUY=$S($D(^TIU(8925,"AV",DFN,DOCTYP,VISIT)):0,1:1)
"RTN","TIUSRVA",78,0)
 . S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",79,0)
 Q
"RTN","TIUSRVA",80,0)
WHATACT(Y,TIUDA) ; Evaluate/return whether signature or cosignature
"RTN","TIUSRVA",81,0)
 N TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",82,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVA",83,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVA",84,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",85,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVA",86,0)
 S Y=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVA",87,0)
 Q
"RTN","TIUSRVA",88,0)
CANCHCOS(Y,TIUDA) ; Evaluate/return whether user can change cosigner
"RTN","TIUSRVA",89,0)
 S Y=$$MAYCHNG^TIURA1(TIUDA)
"RTN","TIUSRVA",90,0)
 Q
"RTN","TIUSRVA",91,0)
NEEDJUST(Y,TIUDA) ; Is justification required for deletion?
"RTN","TIUSRVA",92,0)
 N TIUD0 S TIUD0=$G(^TIU(8925,+TIUDA,0)),Y=0
"RTN","TIUSRVA",93,0)
 I +$P(TIUD0,U,5)'<6 S Y=1
"RTN","TIUSRVA",94,0)
 Q
"RTN","TIUSRVA",95,0)
GETTITLE(Y,TIUDA) ; Get the title from a TIU Document Record
"RTN","TIUSRVA",96,0)
 S Y=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVA",97,0)
 Q
"RTN","TIUSRVA",98,0)
CANATTCH(Y,TIUDA) ; Can this document be attached as an ID Child
"RTN","TIUSRVA",99,0)
 N TITLEDA,PARENTDA
"RTN","TIUSRVA",100,0)
 S TITLEDA=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVA",101,0)
 I TITLEDA'>0 S Y="0^Document #"_TIUDA_" does not exist." Q
"RTN","TIUSRVA",102,0)
 S PARENTDA=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVA",103,0)
 S Y=$$POSSPRNT^TIULP(TITLEDA)
"RTN","TIUSRVA",104,0)
 I +Y S Y="-1"_U_$P(Y,U,2) Q
"RTN","TIUSRVA",105,0)
 I +$$ISCWAD^TIULX(TITLEDA) D  Q
"RTN","TIUSRVA",106,0)
 . S Y="0^ CWAD Documents may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",107,0)
 I +$$ISA^TIULX(TITLEDA,+$$CLASS^TIUCNSLT) D  Q
"RTN","TIUSRVA",108,0)
 . S Y="0^ Consult Results may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",109,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH TO ID NOTE")
"RTN","TIUSRVA",110,0)
 I PARENTDA D  ; action must be "detach"
"RTN","TIUSRVA",111,0)
 . I 'Y S Y="0^ You may not detach this note from an interdisciplinary note." Q
"RTN","TIUSRVA",112,0)
 . S Y=$$CANDO^TIULP(PARENTDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",113,0)
 . I 'Y S Y="0^ You may not detach this note from its interdisciplinary note."
"RTN","TIUSRVA",114,0)
 Q
"RTN","TIUSRVA",115,0)
CANRCV(Y,TIUDA) ; Can this document receive an ID Child?
"RTN","TIUSRVA",116,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",117,0)
 Q
"VER")
8.0^22.0
**END**
**END**
