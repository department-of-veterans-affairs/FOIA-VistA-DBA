Released SD*5.3*466 SEQ #406
Extracted from mail message
**KIDS**:SD*5.3*466^

**INSTALL NAME**
SD*5.3*466
"BLD",6543,0)
SD*5.3*466^SCHEDULING^0^3070208^y
"BLD",6543,4,0)
^9.64PA^^
"BLD",6543,6)
6^
"BLD",6543,6.3)
2
"BLD",6543,"KRN",0)
^9.67PA^8989.52^19
"BLD",6543,"KRN",.4,0)
.4
"BLD",6543,"KRN",.401,0)
.401
"BLD",6543,"KRN",.402,0)
.402
"BLD",6543,"KRN",.403,0)
.403
"BLD",6543,"KRN",.5,0)
.5
"BLD",6543,"KRN",.84,0)
.84
"BLD",6543,"KRN",3.6,0)
3.6
"BLD",6543,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",6543,"KRN",3.6,"NM",1,0)
SCDX AMBCARE TO NPCDB SUMMARY^^0
"BLD",6543,"KRN",3.6,"NM","B","SCDX AMBCARE TO NPCDB SUMMARY",1)

"BLD",6543,"KRN",3.8,0)
3.8
"BLD",6543,"KRN",9.2,0)
9.2
"BLD",6543,"KRN",9.8,0)
9.8
"BLD",6543,"KRN",9.8,"NM",0)
^9.68A^31^23
"BLD",6543,"KRN",9.8,"NM",1,0)
SCDXMSG^^0^B46406425
"BLD",6543,"KRN",9.8,"NM",2,0)
SCDXMSG2^^0^B39213682
"BLD",6543,"KRN",9.8,"NM",3,0)
SDCO3^^0^B3913935
"BLD",6543,"KRN",9.8,"NM",4,0)
SDCO4^^0^B3130065
"BLD",6543,"KRN",9.8,"NM",6,0)
SCRPW51^^0^B27049366
"BLD",6543,"KRN",9.8,"NM",7,0)
SCRPW54^^0^B51348670
"BLD",6543,"KRN",9.8,"NM",8,0)
SCRPW56^^0^B23791675
"BLD",6543,"KRN",9.8,"NM",9,0)
SCRPW57^^0^B28798675
"BLD",6543,"KRN",9.8,"NM",10,0)
SCRPW58^^0^B18449848
"BLD",6543,"KRN",9.8,"NM",11,0)
SCRPW59^^0^B19196477
"BLD",6543,"KRN",9.8,"NM",12,0)
SCRPW16^^0^B43551884
"BLD",6543,"KRN",9.8,"NM",18,0)
SCRPW7^^0^B15183173
"BLD",6543,"KRN",9.8,"NM",19,0)
SCRPW6^^0^B35810056
"BLD",6543,"KRN",9.8,"NM",20,0)
SCRPW52^^0^B6909008
"BLD",6543,"KRN",9.8,"NM",21,0)
SDAMOL1^^0^B12779195
"BLD",6543,"KRN",9.8,"NM",22,0)
SDAM1^^0^B29444378
"BLD",6543,"KRN",9.8,"NM",23,0)
SCRPW8^^0^B65233961
"BLD",6543,"KRN",9.8,"NM",24,0)
SCMSVUT2^^0^B30881760
"BLD",6543,"KRN",9.8,"NM",27,0)
SCRPW9^^0^B56812091
"BLD",6543,"KRN",9.8,"NM",28,0)
SDAMQ3^^0^B13578010
"BLD",6543,"KRN",9.8,"NM",29,0)
SDCOM^^0^B5826254
"BLD",6543,"KRN",9.8,"NM",30,0)
SCRPW50^^0^B6421337
"BLD",6543,"KRN",9.8,"NM",31,0)
SCRPW18^^0^B56544520
"BLD",6543,"KRN",9.8,"NM","B","SCDXMSG",1)

"BLD",6543,"KRN",9.8,"NM","B","SCDXMSG2",2)

"BLD",6543,"KRN",9.8,"NM","B","SCMSVUT2",24)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW16",12)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW18",31)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW50",30)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW51",6)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW52",20)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW54",7)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW56",8)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW57",9)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW58",10)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW59",11)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW6",19)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW7",18)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW8",23)

"BLD",6543,"KRN",9.8,"NM","B","SCRPW9",27)

"BLD",6543,"KRN",9.8,"NM","B","SDAM1",22)

"BLD",6543,"KRN",9.8,"NM","B","SDAMOL1",21)

"BLD",6543,"KRN",9.8,"NM","B","SDAMQ3",28)

"BLD",6543,"KRN",9.8,"NM","B","SDCO3",3)

"BLD",6543,"KRN",9.8,"NM","B","SDCO4",4)

"BLD",6543,"KRN",9.8,"NM","B","SDCOM",29)

"BLD",6543,"KRN",19,0)
19
"BLD",6543,"KRN",19,"NM",0)
^9.68A^7^7
"BLD",6543,"KRN",19,"NM",1,0)
SCRPW DVM IP DSS ID REPORTS^^0
"BLD",6543,"KRN",19,"NM",2,0)
SCRPW DVM IP MEANS TEST SUM^^0
"BLD",6543,"KRN",19,"NM",3,0)
SCRPW DVM IP CPT FREQUENCY^^0
"BLD",6543,"KRN",19,"NM",4,0)
SCRPW DVM IP DX FREQUENCY^^0
"BLD",6543,"KRN",19,"NM",5,0)
SCRPW DVM IP PRACT TYPE FREQ^^0
"BLD",6543,"KRN",19,"NM",6,0)
SCRPW DVM IP STATS BY COUNTY^^0
"BLD",6543,"KRN",19,"NM",7,0)
SCRPW DATA VALIDATION MENU^^2
"BLD",6543,"KRN",19,"NM","B","SCRPW DATA VALIDATION MENU",7)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP CPT FREQUENCY",3)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP DSS ID REPORTS",1)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP DX FREQUENCY",4)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP MEANS TEST SUM",2)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP PRACT TYPE FREQ",5)

"BLD",6543,"KRN",19,"NM","B","SCRPW DVM IP STATS BY COUNTY",6)

"BLD",6543,"KRN",19.1,0)
19.1
"BLD",6543,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6543,"KRN",101,0)
101
"BLD",6543,"KRN",409.61,0)
409.61
"BLD",6543,"KRN",771,0)
771
"BLD",6543,"KRN",870,0)
870
"BLD",6543,"KRN",8989.51,0)
8989.51
"BLD",6543,"KRN",8989.52,0)
8989.52
"BLD",6543,"KRN",8994,0)
8994
"BLD",6543,"KRN","B",.4,.4)

"BLD",6543,"KRN","B",.401,.401)

"BLD",6543,"KRN","B",.402,.402)

"BLD",6543,"KRN","B",.403,.403)

"BLD",6543,"KRN","B",.5,.5)

"BLD",6543,"KRN","B",.84,.84)

"BLD",6543,"KRN","B",3.6,3.6)

"BLD",6543,"KRN","B",3.8,3.8)

"BLD",6543,"KRN","B",9.2,9.2)

"BLD",6543,"KRN","B",9.8,9.8)

"BLD",6543,"KRN","B",19,19)

"BLD",6543,"KRN","B",19.1,19.1)

"BLD",6543,"KRN","B",101,101)

"BLD",6543,"KRN","B",409.61,409.61)

"BLD",6543,"KRN","B",771,771)

"BLD",6543,"KRN","B",870,870)

"BLD",6543,"KRN","B",8989.51,8989.51)

"BLD",6543,"KRN","B",8989.52,8989.52)

"BLD",6543,"KRN","B",8994,8994)

"BLD",6543,"QUES",0)
^9.62^^
"BLD",6543,"REQB",0)
^9.611^5^5
"BLD",6543,"REQB",1,0)
SD*5.3*336^2
"BLD",6543,"REQB",2,0)
SD*5.3*387^2
"BLD",6543,"REQB",3,0)
SD*5.3*393^2
"BLD",6543,"REQB",4,0)
SD*5.3*445^2
"BLD",6543,"REQB",5,0)
SD*5.3*478^2
"BLD",6543,"REQB","B","SD*5.3*336",1)

"BLD",6543,"REQB","B","SD*5.3*387",2)

"BLD",6543,"REQB","B","SD*5.3*393",3)

"BLD",6543,"REQB","B","SD*5.3*445",4)

"BLD",6543,"REQB","B","SD*5.3*478",5)

"KRN",3.6,109,-1)
0^1
"KRN",3.6,109,0)
SCDX AMBCARE TO NPCDB SUMMARY^Transmission of data to NPCDB completed
"KRN",3.6,109,1,0)
^3.61A^11^11^3051109^^^^
"KRN",3.6,109,1,1,0)
Transmission of data to the National Patient Care Database has completed.
"KRN",3.6,109,1,2,0)
 
"KRN",3.6,109,1,3,0)
A total of |1| Encounters were sent.
"KRN",3.6,109,1,4,0)
A total of |3| Outpatient Encounters were sent.
"KRN",3.6,109,1,5,0)
A total of |4| Inpatient Encounters were sent.
"KRN",3.6,109,1,6,0)
 
"KRN",3.6,109,1,7,0)
A total of |2| Encounters were not sent.
"KRN",3.6,109,1,8,0)
A total of |5| Outpatient Encounters were not sent. 
"KRN",3.6,109,1,9,0)
A total of |6| Inpatient Encounters were not sent.
"KRN",3.6,109,1,10,0)
 
"KRN",3.6,109,1,11,0)
Please review the IEMM Error listing for further details.
"KRN",3.6,109,3,0)
^3.63^3^3^3051109^^^^
"KRN",3.6,109,3,1,0)
Bulletin sent at the [un]successful completion of generating workload
"KRN",3.6,109,3,2,0)
information to be transmitted to the National Patient Care Database via
"KRN",3.6,109,3,3,0)
HL7.
"KRN",3.6,109,4,0)
^3.64A^6^6
"KRN",3.6,109,4,1,0)
1
"KRN",3.6,109,4,1,1,0)
^3.65^1^1^3051109^^^
"KRN",3.6,109,4,1,1,1,0)
Number of encounters that were successfully sent to NPCDB.
"KRN",3.6,109,4,2,0)
2
"KRN",3.6,109,4,2,1,0)
^3.65^1^1^3051109^^^^
"KRN",3.6,109,4,2,1,1,0)
Number of encounters that were not sent to NPCDB.
"KRN",3.6,109,4,3,0)
3
"KRN",3.6,109,4,3,1,0)
^3.65^1^1^3051109^^^^
"KRN",3.6,109,4,3,1,1,0)
Number of outpatient encounters that were successfully sent to NPCDB.
"KRN",3.6,109,4,4,0)
4
"KRN",3.6,109,4,4,1,0)
^3.65^1^1^3051109^^
"KRN",3.6,109,4,4,1,1,0)
Number of inpatient encounters that were successfully sent to NPCDB.
"KRN",3.6,109,4,5,0)
5
"KRN",3.6,109,4,5,1,0)
^3.65^1^1^3051109^^^
"KRN",3.6,109,4,5,1,1,0)
Number of outpatient encounters that were not sent to NPCDB.
"KRN",3.6,109,4,6,0)
6
"KRN",3.6,109,4,6,1,0)
^3.65^1^1^3051109^^^^
"KRN",3.6,109,4,6,1,1,0)
Number of inpatient encounters that were not sent to NPCDB.
"KRN",19,7653,-1)
2^7
"KRN",19,7653,0)
SCRPW DATA VALIDATION MENU^Data Validation Menu^^M^66481^^^^^^^16
"KRN",19,7653,10,0)
^19.01IP^12^12
"KRN",19,7653,10,7,0)
12831^IP0
"KRN",19,7653,10,7,"^")
SCRPW DVM IP DSS ID REPORTS
"KRN",19,7653,10,8,0)
12832^IP3
"KRN",19,7653,10,8,"^")
SCRPW DVM IP MEANS TEST SUM
"KRN",19,7653,10,9,0)
12833^IP6
"KRN",19,7653,10,9,"^")
SCRPW DVM IP CPT FREQUENCY
"KRN",19,7653,10,10,0)
12834^IP7
"KRN",19,7653,10,10,"^")
SCRPW DVM IP DX FREQUENCY
"KRN",19,7653,10,11,0)
12835^IP8
"KRN",19,7653,10,11,"^")
SCRPW DVM IP PRACT TYPE FREQ
"KRN",19,7653,10,12,0)
12836^IP9
"KRN",19,7653,10,12,"^")
SCRPW DVM IP STATS BY COUNTY
"KRN",19,7653,"U")
DATA VALIDATION MENU
"KRN",19,12831,-1)
0^1
"KRN",19,12831,0)
SCRPW DVM IP DSS ID REPORTS^Enc. by IP DSS ID/DSS ID by Freq. (IP0, IP1, IP2)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12831,1,0)
^19.06^2^2^3060103^^^^
"KRN",19,12831,1,1,0)
Option for producing inpatient statistics by DSS Identifier in a format
"KRN",19,12831,1,2,0)
that matches the Austin IP0, IP1 and IP2 reports.
"KRN",19,12831,15)
K SDSTA
"KRN",19,12831,20)
S SDSTA=8
"KRN",19,12831,25)
SCRPW51
"KRN",19,12831,"U")
ENC. BY IP DSS ID/DSS ID BY FR
"KRN",19,12832,-1)
0^2
"KRN",19,12832,0)
SCRPW DVM IP MEANS TEST SUM^Means Test IP Visits & Uniques (IP3, IP4, IP5)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12832,1,0)
^^2^2^3051220^
"KRN",19,12832,1,1,0)
Option for producing a summary of inpatient Means Test visits and uniques
"KRN",19,12832,1,2,0)
in a format that matches the Austin IP3, IP4 and IP5 reports.
"KRN",19,12832,15)
K SDSTA
"KRN",19,12832,20)
S SDSTA=8
"KRN",19,12832,25)
SCRPW54
"KRN",19,12832,"U")
MEANS TEST IP VISITS & UNIQUES
"KRN",19,12833,-1)
0^3
"KRN",19,12833,0)
SCRPW DVM IP CPT FREQUENCY^Most Frequent 50 IP CPT Codes (IP6)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12833,1,0)
^19.06^3^3^3060120^^^^
"KRN",19,12833,1,1,0)
Option for listing the 50 most frequent inpatient ambulatory procedure
"KRN",19,12833,1,2,0)
codes with associated provider type frequency in a format that matches the
"KRN",19,12833,1,3,0)
Austin IP6 report.
"KRN",19,12833,15)
K SDSTA
"KRN",19,12833,20)
S SDSTA=8
"KRN",19,12833,25)
SCRPW56
"KRN",19,12833,"U")
MOST FREQUENT 50 IP CPT CODES 
"KRN",19,12834,-1)
0^4
"KRN",19,12834,0)
SCRPW DVM IP DX FREQUENCY^Most Frequent 50 IP ICD-9-CM Codes (IP7)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12834,1,0)
^19.06^3^3^3051220^^
"KRN",19,12834,1,1,0)
Option for listing the 50 most frequent inpatient diagnoses with
"KRN",19,12834,1,2,0)
associated provider type frequency in a format that matches the Austin IP7
"KRN",19,12834,1,3,0)
report.
"KRN",19,12834,15)
K SDSTA
"KRN",19,12834,20)
S SDSTA=8
"KRN",19,12834,25)
SCRPW57
"KRN",19,12834,"U")
MOST FREQUENT 50 IP ICD-9-CM C
"KRN",19,12835,-1)
0^5
"KRN",19,12835,0)
SCRPW DVM IP PRACT TYPE FREQ^Most Frequent 20 IP Practitioner Types (IP8)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12835,1,0)
^^2^2^3051220^
"KRN",19,12835,1,1,0)
Option for producing inpatient practitioner type frequency statistics that
"KRN",19,12835,1,2,0)
matches the Austin IP8 report in format.
"KRN",19,12835,15)
K SDSTA
"KRN",19,12835,20)
S SDSTA=8
"KRN",19,12835,25)
SCRPW58
"KRN",19,12835,"U")
MOST FREQUENT 20 IP PRACTITION
"KRN",19,12836,-1)
0^6
"KRN",19,12836,0)
SCRPW DVM IP STATS BY COUNTY^Visits and Unique IP SSNs by County (IP9)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,12836,1,0)
^^2^2^3051220^
"KRN",19,12836,1,1,0)
Option for producing counts of inpatient encounters, visits and uniques by
"KRN",19,12836,1,2,0)
state and county in a format that matches the Austin IP9 report.
"KRN",19,12836,15)
K SDSTA
"KRN",19,12836,20)
S SDSTA=8
"KRN",19,12836,25)
SCRPW59
"KRN",19,12836,"U")
VISITS AND UNIQUE IP SSNS BY C
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
466^3070208^100817
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
23
"RTN","SCDXMSG")
0^1^B46406425^B44667997
"RTN","SCDXMSG",1,0)
SCDXMSG ;ALB/JRP - AMB CARE TRANSMISSION BUILDER;06-MAY-1996 ; 12/20/01 4:46pm
"RTN","SCDXMSG",2,0)
 ;;5.3;Scheduling;**44,56,70,77,85,96,121,128,66,247,245,387,466**;AUG 13, 1993;Build 2
"RTN","SCDXMSG",3,0)
 ;
"RTN","SCDXMSG",4,0)
SNDZ00 ;Main entry point for the sending of ADT-Z00 batch messages to
"RTN","SCDXMSG",5,0)
 ; the National Patient Care Database
"RTN","SCDXMSG",6,0)
 ;
"RTN","SCDXMSG",7,0)
 ;Input  : None
"RTN","SCDXMSG",8,0)
 ;Output : None
"RTN","SCDXMSG",9,0)
 ;
"RTN","SCDXMSG",10,0)
SD70 ; added w/ patch SD*5.3*70 to reset transmit flags if needed
"RTN","SCDXMSG",11,0)
 N SDEND,SDSTA D EN^SCDXUTL5
"RTN","SCDXMSG",12,0)
 ;
"RTN","SCDXMSG",13,0)
 ;Declare variables
"RTN","SCDXMSG",14,0)
 N X,X1,X2,%H
"RTN","SCDXMSG",15,0)
 N XMITPTR,NOACKBY,XMITDATE,SCDXEVNT,MAXBATCH,MAXLINE,BATCHCNT,MSGNUM
"RTN","SCDXMSG",16,0)
 N LINECNT,MSHLINE,XMITLIST,XMITERR,HL7XMIT,ERROR,IPCNT
"RTN","SCDXMSG",17,0)
 N HLEID,HL,HLECH,HLFS,HLQ,HLMID,HLMTIEN,HLDT,HLDT1,MSGID,HLRESLT,HLP
"RTN","SCDXMSG",18,0)
 ;Set message count limit for batch message
"RTN","SCDXMSG",19,0)
 S MAXBATCH=100
"RTN","SCDXMSG",20,0)
 ;Set line count limit for batch message Note max 160K char. MM Message
"RTN","SCDXMSG",21,0)
 S MAXLINE=$P($G(^SD(404.91,1,"AMB")),U,8) S:'MAXLINE MAXLINE=2000
"RTN","SCDXMSG",22,0)
 ;Initialize global locations
"RTN","SCDXMSG",23,0)
 S XMITERR="^TMP(""SCDX-XMIT-BLD"","_$J_",""ERRORS"")"
"RTN","SCDXMSG",24,0)
 S HL7XMIT="^TMP(""HLS"","_$J_")"
"RTN","SCDXMSG",25,0)
 K @XMITERR,@HL7XMIT
"RTN","SCDXMSG",26,0)
 ;Get lag time for acks from NPCDB (default to T-LAG)
"RTN","SCDXMSG",27,0)
 S NOACKBY=+$P($G(^SD(404.91,1,"AMB")),"^",4)
"RTN","SCDXMSG",28,0)
 S:('NOACKBY) NOACKBY=2
"RTN","SCDXMSG",29,0)
 ;Determine T-LAG @ 11:59:59 PM
"RTN","SCDXMSG",30,0)
 S X1=$$DT^XLFDT()
"RTN","SCDXMSG",31,0)
 S X2=0-NOACKBY
"RTN","SCDXMSG",32,0)
 S NOACKBY=$$FMADD^XLFDT(X1,X2)_".235959"
"RTN","SCDXMSG",33,0)
 ;Flag transmissions that haven't been acked by T-LAG for retransmission
"RTN","SCDXMSG",34,0)
 S XMITDATE=""
"RTN","SCDXMSG",35,0)
 F  S XMITDATE=+$O(^SD(409.73,"AACNOACK",XMITDATE)) Q:(('XMITDATE)!(XMITDATE>NOACKBY))  D
"RTN","SCDXMSG",36,0)
 .S XMITPTR=""
"RTN","SCDXMSG",37,0)
 .F  S XMITPTR=+$O(^SD(409.73,"AACNOACK",XMITDATE,XMITPTR)) Q:('XMITPTR)  D
"RTN","SCDXMSG",38,0)
 ..;Mark entry with retransmit event (POSTMASTER is causer of event)
"RTN","SCDXMSG",39,0)
 ..D STREEVNT^SCDXFU01(XMITPTR,0,"",.5)
"RTN","SCDXMSG",40,0)
 ..;Can no longer receive database credit - delete x-ref and quit
"RTN","SCDXMSG",41,0)
 ..I +$$XMIT4DBC^SCDXFU04(XMITPTR)>3 K ^SD(409.73,"AACNOACK",XMITDATE,XMITPTR) Q  ;SD*5.3*247
"RTN","SCDXMSG",42,0)
 ..;Turn transmission flag on
"RTN","SCDXMSG",43,0)
 ..D XMITFLAG^SCDXFU01(XMITPTR)
"RTN","SCDXMSG",44,0)
 ;Get pointer to sending event
"RTN","SCDXMSG",45,0)
 S HLEID=+$O(^ORD(101,"B","SCDX AMBCARE SEND SERVER FOR ADT-Z00",0))
"RTN","SCDXMSG",46,0)
 ;Sending event not found - send error bulletin - done
"RTN","SCDXMSG",47,0)
 I ('HLEID) D ERRBULL^SCDXMSG2("Unable to initialize HL7 variables - protocol not found") Q
"RTN","SCDXMSG",48,0)
 ;Initialze HL7 variables
"RTN","SCDXMSG",49,0)
 D INIT^HLFNC2(HLEID,.HL)
"RTN","SCDXMSG",50,0)
 ;Unable to initialize HL7 variables - send error bulletin - done
"RTN","SCDXMSG",51,0)
 I ($O(HL(""))="") D ERRBULL^SCDXMSG2($P(HL,"^",2)) Q
"RTN","SCDXMSG",52,0)
 ;Create batch message
"RTN","SCDXMSG",53,0)
 D CREATE^HLTF(.HLMID,.HLMTIEN,.HLDT,.HLDT1)
"RTN","SCDXMSG",54,0)
 ;Unable to create batch message - send error bulletin - done
"RTN","SCDXMSG",55,0)
 I ('HLMTIEN) D ERRBULL^SCDXMSG2("Unable to create batch HL7 message") Q
"RTN","SCDXMSG",56,0)
 ;Initialize message count
"RTN","SCDXMSG",57,0)
 S BATCHCNT=0,IPCNT=0
"RTN","SCDXMSG",58,0)
 ;Initialize message number
"RTN","SCDXMSG",59,0)
 S MSGNUM=1
"RTN","SCDXMSG",60,0)
 ;Initialize line count
"RTN","SCDXMSG",61,0)
 S LINECNT=1
"RTN","SCDXMSG",62,0)
 N VALER,VALERR
"RTN","SCDXMSG",63,0)
 ;this global contains the validation errors if any.
"RTN","SCDXMSG",64,0)
 S VALER="^TMP(""SCDXVALID"",$J)"
"RTN","SCDXMSG",65,0)
 ;Loop through list of [deleted] encounters requiring transmission
"RTN","SCDXMSG",66,0)
 S SCDXEVNT=""
"RTN","SCDXMSG",67,0)
 F  S SCDXEVNT=+$O(^SD(409.73,"AACXMIT",SCDXEVNT)) Q:('SCDXEVNT)  D
"RTN","SCDXMSG",68,0)
 .S XMITPTR=""
"RTN","SCDXMSG",69,0)
 .F  S XMITPTR=+$O(^SD(409.73,"AACXMIT",SCDXEVNT,XMITPTR)) Q:('XMITPTR)  D
"RTN","SCDXMSG",70,0)
 ..N OENODE,PARENT,FILERR
"RTN","SCDXMSG",71,0)
 ..S VALERR="^TMP(""SCDXVALID"",$J,"_XMITPTR_")"
"RTN","SCDXMSG",72,0)
 ..;Bad entry in cross reference - delete cross reference and quit
"RTN","SCDXMSG",73,0)
 ..I ('$D(^SD(409.73,XMITPTR))) K ^SD(409.73,"AACXMIT",SCDXEVNT,XMITPTR) Q
"RTN","SCDXMSG",74,0)
 ..;Make sure entry points to an existing encounter - delete entry
"RTN","SCDXMSG",75,0)
 ..; and quit if it doesn't
"RTN","SCDXMSG",76,0)
 ..S X=^SD(409.73,XMITPTR,0)
"RTN","SCDXMSG",77,0)
 ..S X1=+$P(X,"^",2)
"RTN","SCDXMSG",78,0)
 ..S X2=+$P(X,"^",3)
"RTN","SCDXMSG",79,0)
 ..S OENODE=$S($G(^SCE(+X1,0)):^(0),1:$G(^SD(409.74,+X2,1))),PARENT=$P(OENODE,"^",6)
"RTN","SCDXMSG",80,0)
 ..I (((X1)&('$D(^SCE(X1))))!((X2)&('$D(^SD(409.74,X2))))) S ERROR=$$DELXMIT^SCDXFU03(XMITPTR) Q
"RTN","SCDXMSG",81,0)
 ..; if SD*5.3*70 cleanup not complete, recheck date of encounter for range
"RTN","SCDXMSG",82,0)
 ..I $G(SDEND) Q:$$CHKD(X1,X2)
"RTN","SCDXMSG",83,0)
 ..;If inpatient appointment, delete entry and quit
"RTN","SCDXMSG",84,0)
 ..;Commented to allow transmission of inpatient to NPCD; SD*5.3*387
"RTN","SCDXMSG",85,0)
 ..;I ($$INPATENC^SCDXUTL(XMITPTR)) S ERROR=$$DELXMIT^SCDXFU03(XMITPTR) Q
"RTN","SCDXMSG",86,0)
 ..;If test patient, delete entry and quit
"RTN","SCDXMSG",87,0)
 ..I $$TESTPAT^VADPT($P($$EZN4XMIT^SCDXFU11(XMITPTR),"^",2)) S ERROR=$$DELXMIT^SCDXFU03(XMITPTR) Q
"RTN","SCDXMSG",88,0)
 ..;If child encounter, delete entry, flag parent for xmit, and quit
"RTN","SCDXMSG",89,0)
 ..I PARENT D  Q
"RTN","SCDXMSG",90,0)
 ...S ERROR=$$DELXMIT^SCDXFU03(XMITPTR)
"RTN","SCDXMSG",91,0)
 ..;NPCD will not accept for database credit - clean up and quit
"RTN","SCDXMSG",92,0)
 ..I +$$XMIT4DBC^SCDXFU04(XMITPTR)>3 D  Q  ;SD*5.3*247
"RTN","SCDXMSG",93,0)
 ...;Past database close-out date - delete previously reported errors
"RTN","SCDXMSG",94,0)
 ...D DELAERR^SCDXFU02(XMITPTR)
"RTN","SCDXMSG",95,0)
 ...;Turn off transmission flag
"RTN","SCDXMSG",96,0)
 ...D XMITFLAG^SCDXFU01(XMITPTR,1)
"RTN","SCDXMSG",97,0)
 ..;Calculate message control ID
"RTN","SCDXMSG",98,0)
 ..S MSGID=HLMID_"-"_MSGNUM
"RTN","SCDXMSG",99,0)
 ..;Put [deleted] encounter into transmission
"RTN","SCDXMSG",100,0)
 ..S ERROR=$$BUILDHL7^SCDXMSG0(XMITPTR,.HL,MSGID,HL7XMIT,LINECNT,VALERR)
"RTN","SCDXMSG",101,0)
 ..;[Deleted] encounter not added to transmission
"RTN","SCDXMSG",102,0)
 ..I ERROR<0,$O(@VALERR@(0))']"" D VALIDATE^SCMSVUT0("INTERNAL","","V900",VALERR,0)
"RTN","SCDXMSG",103,0)
 ..D DELAERR^SCDXFU02(XMITPTR,0)
"RTN","SCDXMSG",104,0)
 ..I $O(@VALERR@(0))]"" S FILERR=$$FILEVERR^SCMSVUT2(XMITPTR,VALERR)
"RTN","SCDXMSG",105,0)
 ..I ERROR<0 Q
"RTN","SCDXMSG",106,0)
 ..;Increment line count
"RTN","SCDXMSG",107,0)
 ..S LINECNT=LINECNT+ERROR
"RTN","SCDXMSG",108,0)
 ..;Increment message count
"RTN","SCDXMSG",109,0)
 ..S BATCHCNT=BATCHCNT+1
"RTN","SCDXMSG",110,0)
 ..;Increment message number
"RTN","SCDXMSG",111,0)
 ..S MSGNUM=MSGNUM+1
"RTN","SCDXMSG",112,0)
 ..;Increment inpatient count
"RTN","SCDXMSG",113,0)
 ..I $$INPATENC^SCDXUTL(XMITPTR) S IPCNT=IPCNT+1
"RTN","SCDXMSG",114,0)
 ..;Create entry in ACRP Transmission History file (#409.77)
"RTN","SCDXMSG",115,0)
 ..S X=$$CRTHIST^SCDXFU10(XMITPTR,HLDT,MSGID,HLMID)
"RTN","SCDXMSG",116,0)
 ..;Update transmission info for [deleted] encounter
"RTN","SCDXMSG",117,0)
 ..D XMITDATA^SCDXFU03(XMITPTR,HLDT,MSGID,HLMID)
"RTN","SCDXMSG",118,0)
 ..;Turn off transmission flag for [deleted] encounter
"RTN","SCDXMSG",119,0)
 ..D XMITFLAG^SCDXFU01(XMITPTR,1)
"RTN","SCDXMSG",120,0)
 ..;Delete all errors previously reported for [deleted] encounter
"RTN","SCDXMSG",121,0)
 ..D DELAERR^SCDXFU02(XMITPTR)
"RTN","SCDXMSG",122,0)
 ..;Reached max size for batch
"RTN","SCDXMSG",123,0)
 ..I ((MSGNUM>MAXBATCH)!(LINECNT>MAXLINE)) D
"RTN","SCDXMSG",124,0)
 ...;Send batch message - immediate priority
"RTN","SCDXMSG",125,0)
 ...S HLP("PRIORITY")="I"
"RTN","SCDXMSG",126,0)
 ...D GENERATE^HLMA(HLEID,"GB",1,.HLRESLT,HLMTIEN,.HLP)
"RTN","SCDXMSG",127,0)
 ...;Re-initialize HL7 message
"RTN","SCDXMSG",128,0)
 ...K @HL7XMIT
"RTN","SCDXMSG",129,0)
 ...;Re-initialize HL7 variables
"RTN","SCDXMSG",130,0)
 ...K HL,HLRESLT,HLP,HLMID,HLMTIEN,HLDT,HLDT1
"RTN","SCDXMSG",131,0)
 ...S HLEID=+$O(^ORD(101,"B","SCDX AMBCARE SEND SERVER FOR ADT-Z00",0))
"RTN","SCDXMSG",132,0)
 ...D INIT^HLFNC2(HLEID,.HL)
"RTN","SCDXMSG",133,0)
 ...;Create new batch message
"RTN","SCDXMSG",134,0)
 ...D CREATE^HLTF(.HLMID,.HLMTIEN,.HLDT,.HLDT1)
"RTN","SCDXMSG",135,0)
 ...;Re-initialize line count
"RTN","SCDXMSG",136,0)
 ...S LINECNT=1
"RTN","SCDXMSG",137,0)
 ...;Re-initialize message number
"RTN","SCDXMSG",138,0)
 ...S MSGNUM=1
"RTN","SCDXMSG",139,0)
 ;Check for unsent batch message
"RTN","SCDXMSG",140,0)
 I ($O(@HL7XMIT@(0))) D
"RTN","SCDXMSG",141,0)
 .;Send batch message - immediate priority
"RTN","SCDXMSG",142,0)
 .S HLP("PRIORITY")="I"
"RTN","SCDXMSG",143,0)
 .D GENERATE^HLMA(HLEID,"GB",1,.HLRESLT,HLMTIEN,.HLP)
"RTN","SCDXMSG",144,0)
 N ERRCNT,IPERR
"RTN","SCDXMSG",145,0)
 S ERRCNT=$$COUNT^SCMSVUT2(VALER)
"RTN","SCDXMSG",146,0)
 S IPERR=$$IPERR^SCMSVUT2(VALER)
"RTN","SCDXMSG",147,0)
 ;Send completion bulletin
"RTN","SCDXMSG",148,0)
 D CMPLBULL^SCDXMSG2(BATCHCNT,ERRCNT,IPCNT,IPERR)
"RTN","SCDXMSG",149,0)
 ;Clean up global arrays used
"RTN","SCDXMSG",150,0)
 K @XMITERR,@HL7XMIT,@VALER
"RTN","SCDXMSG",151,0)
 ;Determine if updating of Hospital Location file hasn't completed AND
"RTN","SCDXMSG",152,0)
 ; if today is past the OPC to HL7 cut over date
"RTN","SCDXMSG",153,0)
 I ('$P($G(^SD(404.91,1,"AMB")),"^",7)) I ($$DATE^SCDXUTL(DT)) D
"RTN","SCDXMSG",154,0)
 .;Task updating of Hospital Location file
"RTN","SCDXMSG",155,0)
 .N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","SCDXMSG",156,0)
 .S ZTRTN="HOPUP^SCMSP"
"RTN","SCDXMSG",157,0)
 .S ZTDESC="REQUIRE PROVIDER AND DIAGNOSIS FOR CHECKOUT FROM CLINICS"
"RTN","SCDXMSG",158,0)
 .S ZTDTH="NOW"
"RTN","SCDXMSG",159,0)
 .S ZTIO=""
"RTN","SCDXMSG",160,0)
 .D ^%ZTLOAD
"RTN","SCDXMSG",161,0)
 ;Done
"RTN","SCDXMSG",162,0)
 Q
"RTN","SCDXMSG",163,0)
 ;
"RTN","SCDXMSG",164,0)
CHKD(X1,X2) ; if clean-up still in progress for SD*5.3*70, check date
"RTN","SCDXMSG",165,0)
 N SDELE
"RTN","SCDXMSG",166,0)
 I X1,+$G(^SCE(X1,0))>SDEND Q 1
"RTN","SCDXMSG",167,0)
 I X2 S SDELE=+$G(^SD(409.74,X2,1)) I SDELE>SDSTA D:SDELE<SDEND  Q 1
"RTN","SCDXMSG",168,0)
 . D KILL^SCDXUTL5("^SD(409.74,",X2)
"RTN","SCDXMSG",169,0)
 . D KILL^SCDXUTL5("^SD(409.73,",XMITPTR)
"RTN","SCDXMSG",170,0)
 Q 0
"RTN","SCDXMSG2")
0^2^B39213682^B37416727
"RTN","SCDXMSG2",1,0)
SCDXMSG2 ;ALB/JRP - AMB CARE TRANSMISSION BULLETINS;01-JUL-1996 ; 1/17/02 5:07pm
"RTN","SCDXMSG2",2,0)
 ;;5.3;Scheduling;**44,121,128,66,132,247,393,466**;AUG 13, 1993;Build 2
"RTN","SCDXMSG2",3,0)
 ;
"RTN","SCDXMSG2",4,0)
CMPLBULL(SENT,ERRCNT,IPCNT,IPERR) ;Send completion bulletin
"RTN","SCDXMSG2",5,0)
 ;
"RTN","SCDXMSG2",6,0)
 ;Input  : SENT - Number of encounters sent to NPCDB (Defaults to 0)
"RTN","SCDXMSG2",7,0)
 ;         ERRCNT - Contains the number of errored encounters
"RTN","SCDXMSG2",8,0)
 ;         IPCNT  - Number of inpatient encounters
"RTN","SCDXMSG2",9,0)
 ;         IPERR  - Contains the number of inpatient errored encounters
"RTN","SCDXMSG2",10,0)
 ;Output : None
"RTN","SCDXMSG2",11,0)
 ;
"RTN","SCDXMSG2",12,0)
 ;Declare variables
"RTN","SCDXMSG2",13,0)
 N MSGTXT,XMB,XMTEXT,XMY,XMDUZ,XMDT,XMZ,XMITPTR,LINE
"RTN","SCDXMSG2",14,0)
 N ENCPTR,DELPTR,ENCDATE,ENCLOC,NAME,TMP,ENCZERO,SSN,PATZERO
"RTN","SCDXMSG2",15,0)
 ;Deliver bulletin
"RTN","SCDXMSG2",16,0)
 S XMB="SCDX AMBCARE TO NPCDB SUMMARY"
"RTN","SCDXMSG2",17,0)
 S XMB(1)=+$G(SENT)
"RTN","SCDXMSG2",18,0)
 S XMB(2)=+$G(ERRCNT)
"RTN","SCDXMSG2",19,0)
 S XMB(3)=+$G(SENT)-(+$G(IPCNT))
"RTN","SCDXMSG2",20,0)
 S XMB(4)=+$G(IPCNT)
"RTN","SCDXMSG2",21,0)
 S XMB(5)=+$G(ERRCNT)-(+$G(IPERR))
"RTN","SCDXMSG2",22,0)
 S XMB(6)=+$G(IPERR)
"RTN","SCDXMSG2",23,0)
 D ^XMB
"RTN","SCDXMSG2",24,0)
 Q
"RTN","SCDXMSG2",25,0)
 ;
"RTN","SCDXMSG2",26,0)
ERRBULL(REASON) ;Send error bulletin
"RTN","SCDXMSG2",27,0)
 ;
"RTN","SCDXMSG2",28,0)
 ;Input  : REASON - Why transmission of data could not be completed
"RTN","SCDXMSG2",29,0)
 ;Output : None
"RTN","SCDXMSG2",30,0)
 ;
"RTN","SCDXMSG2",31,0)
 ;Check input
"RTN","SCDXMSG2",32,0)
 S REASON=$G(REASON)
"RTN","SCDXMSG2",33,0)
 ;Declare variables
"RTN","SCDXMSG2",34,0)
 N MSGTXT,XMB,XMTEXT,XMY,XMDUZ,XMDT,XMZ
"RTN","SCDXMSG2",35,0)
 ;Set message text
"RTN","SCDXMSG2",36,0)
 S MSGTXT(1)="Transmission of data to the National Patient Care Database"
"RTN","SCDXMSG2",37,0)
 S MSGTXT(2)=" "
"RTN","SCDXMSG2",38,0)
 S MSGTXT(3)="could not be completed for the following reason:"
"RTN","SCDXMSG2",39,0)
 S MSGTXT(4)=" "
"RTN","SCDXMSG2",40,0)
 S MSGTXT(5)="  "_REASON
"RTN","SCDXMSG2",41,0)
 ;Set bulletin subject
"RTN","SCDXMSG2",42,0)
 S XMB(1)="** TRANSMISSION OF DATA TO NPCDB NOT COMPLETED **"
"RTN","SCDXMSG2",43,0)
 ;Deliver bulletin
"RTN","SCDXMSG2",44,0)
 S XMB="SCDX AMBCARE TO NPCDB SUMMARY"
"RTN","SCDXMSG2",45,0)
 S XMTEXT="MSGTXT("
"RTN","SCDXMSG2",46,0)
 D ^XMB
"RTN","SCDXMSG2",47,0)
 ;Done
"RTN","SCDXMSG2",48,0)
 Q
"RTN","SCDXMSG2",49,0)
 ;
"RTN","SCDXMSG2",50,0)
LATEACT(XMITPTR,ACT,USER,DATE) ;Send late activity bulletin
"RTN","SCDXMSG2",51,0)
 ;
"RTN","SCDXMSG2",52,0)
 ;Input :  XMITPTR - Pointer to TRANSMITTED OUTPATIENT ENCOUNTER file
"RTN","SCDXMSG2",53,0)
 ;                   (#409.73) that was acted upon
"RTN","SCDXMSG2",54,0)
 ;         ACT - Late activity that occurred
"RTN","SCDXMSG2",55,0)
 ;               Free text (defaults to transmission event of XMITPTR)
"RTN","SCDXMSG2",56,0)
 ;         USER - Who did the activity
"RTN","SCDXMSG2",57,0)
 ;                Pointer to NEW PERSON file (#200)
"RTN","SCDXMSG2",58,0)
 ;                (defaults to causer of event of XMITPTR)
"RTN","SCDXMSG2",59,0)
 ;         DATE - Date/time activity took place
"RTN","SCDXMSG2",60,0)
 ;                FileMan format (defaults to event date of XMITPTR)
"RTN","SCDXMSG2",61,0)
 ;Output : None
"RTN","SCDXMSG2",62,0)
 ;Notes  : Late activity bulletin will be sent to members of the mail
"RTN","SCDXMSG2",63,0)
 ;         group contained in the LATE ACTIVITY MAIL GROUP field (#217)
"RTN","SCDXMSG2",64,0)
 ;         of the MAS PARAMETER file (#43).  The bulletin will not be
"RTN","SCDXMSG2",65,0)
 ;         sent if this mail group has not been defined.
"RTN","SCDXMSG2",66,0)
 ;       : POSTMASTER (DUZ=.5) will be converted to 'ACRP NIGHTLY
"RTN","SCDXMSG2",67,0)
 ;         TRANSMISSION BUILDER' as the causer of the event
"RTN","SCDXMSG2",68,0)
 ;       : Bulletin will default to a transmission event if no ACT
"RTN","SCDXMSG2",69,0)
 ;         is specified
"RTN","SCDXMSG2",70,0)
 ;
"RTN","SCDXMSG2",71,0)
 ;Check input
"RTN","SCDXMSG2",72,0)
 S XMITPTR=+$G(XMITPTR)
"RTN","SCDXMSG2",73,0)
 Q:('$D(^SD(409.73,XMITPTR,0)))
"RTN","SCDXMSG2",74,0)
 S ACT=$G(ACT)
"RTN","SCDXMSG2",75,0)
 S USER=+$G(USER)
"RTN","SCDXMSG2",76,0)
 S DATE=+$G(DATE)
"RTN","SCDXMSG2",77,0)
 ;Declare variables
"RTN","SCDXMSG2",78,0)
 N NODE,ENCPTR,DELPTR,ENCDATE,XMDUZ,XMTEXT,XMSUB,XMY,MSGL,SMTB,SMTN
"RTN","SCDXMSG2",79,0)
 N CLOSED,DFN,CLINIC,DIV,VA,LASTXMIT,LASTACK,LASTCODE,HISTARR
"RTN","SCDXMSG2",80,0)
 ;Send bulletin to site specified mail group
"RTN","SCDXMSG2",81,0)
 ; Don't send if mail group not defined or is invalid
"RTN","SCDXMSG2",82,0)
 S NODE=$G(^DG(43,1,"SCLR"))
"RTN","SCDXMSG2",83,0)
 Q:('$P(NODE,"^",17))
"RTN","SCDXMSG2",84,0)
 D XMY^SDUTL2($P(NODE,"^",17),0,0)
"RTN","SCDXMSG2",85,0)
 Q:('$D(XMY))
"RTN","SCDXMSG2",86,0)
 ;Get zero node of transmission file
"RTN","SCDXMSG2",87,0)
 S NODE=$G(^SD(409.73,XMITPTR,0))
"RTN","SCDXMSG2",88,0)
 ;Set default values (if applicable)
"RTN","SCDXMSG2",89,0)
 I (ACT="") D  Q:(ACT="")
"RTN","SCDXMSG2",90,0)
 .S ACT=+$P(NODE,"^",5)
"RTN","SCDXMSG2",91,0)
 .I (ACT=1)!(ACT=2) S ACT="Creation/Editing of encounter" Q
"RTN","SCDXMSG2",92,0)
 .I (ACT=3) S ACT="Deletion of encounter" Q
"RTN","SCDXMSG2",93,0)
 .S ACT="Retransmission of encounter"
"RTN","SCDXMSG2",94,0)
 I ('USER) D
"RTN","SCDXMSG2",95,0)
 .S USER=+$P(NODE,"^",7)
"RTN","SCDXMSG2",96,0)
 .S:('USER) USER=+$G(DUZ)
"RTN","SCDXMSG2",97,0)
 S:(USER=.5) USER="ACRP NIGHTLY TRANSMISSION BUILDER"
"RTN","SCDXMSG2",98,0)
 I ('DATE) S DATE=+$P(NODE,"^",6) S:('DATE) DATE=$$DT^XLFDT()
"RTN","SCDXMSG2",99,0)
 ;Get pointer to encounter and deleted encounter
"RTN","SCDXMSG2",100,0)
 S ENCPTR=+$P(NODE,"^",2)
"RTN","SCDXMSG2",101,0)
 S DELPTR=+$P(NODE,"^",3)
"RTN","SCDXMSG2",102,0)
 ;Get zero node of [deleted] encounter
"RTN","SCDXMSG2",103,0)
 S NODE=""
"RTN","SCDXMSG2",104,0)
 S:(ENCPTR) NODE=$G(^SCE(ENCPTR,0))
"RTN","SCDXMSG2",105,0)
 S:('ENCPTR) NODE=$G(^SD(409.74,DELPTR,1))
"RTN","SCDXMSG2",106,0)
 ;Get date/time of encounter
"RTN","SCDXMSG2",107,0)
 S ENCDATE=+NODE
"RTN","SCDXMSG2",108,0)
 ;Get DFN
"RTN","SCDXMSG2",109,0)
 S DFN=+$P(NODE,"^",2)
"RTN","SCDXMSG2",110,0)
 ;Get clinic pointer
"RTN","SCDXMSG2",111,0)
 S CLINIC=+$P(NODE,"^",4)
"RTN","SCDXMSG2",112,0)
 ;Get division
"RTN","SCDXMSG2",113,0)
 S DIV=+$P(NODE,"^",11)
"RTN","SCDXMSG2",114,0)
 ;Get transmission history
"RTN","SCDXMSG2",115,0)
 S (LASTXMIT,LASTACK,LASTCODE)=""
"RTN","SCDXMSG2",116,0)
 S HISTARR=$NA(^TMP("SCDXMSG2",$J,"HIST"))
"RTN","SCDXMSG2",117,0)
 K @HISTARR
"RTN","SCDXMSG2",118,0)
 I ($$HST4XMIT^SCDXFU13(XMITPTR,HISTARR,1)) D
"RTN","SCDXMSG2",119,0)
 .;Get last xmit date
"RTN","SCDXMSG2",120,0)
 .S LASTXMIT=+$O(@HISTARR@(""),-1)
"RTN","SCDXMSG2",121,0)
 .Q:('LASTXMIT)
"RTN","SCDXMSG2",122,0)
 .;Get ack info for last xmit
"RTN","SCDXMSG2",123,0)
 .S LASTACK=$G(@HISTARR@(LASTXMIT))
"RTN","SCDXMSG2",124,0)
 .S LASTCODE=$P(LASTACK,"^",3)
"RTN","SCDXMSG2",125,0)
 .S LASTACK=$P(LASTACK,"^",2)
"RTN","SCDXMSG2",126,0)
 K @HISTARR
"RTN","SCDXMSG2",127,0)
 ;Determine the level of acceptance for data base credit and/or
"RTN","SCDXMSG2",128,0)
 ;workload credit
"RTN","SCDXMSG2",129,0)
 S MSGL=$$XMIT4DBC^SCDXFU04(XMITPTR)
"RTN","SCDXMSG2",130,0)
 Q:MSGL<1!(MSGL>4)  ; Only four levels of messages are defined
"RTN","SCDXMSG2",131,0)
 ; 0 - no message, transmit
"RTN","SCDXMSG2",132,0)
 ; 5 - no transmit; error 
"RTN","SCDXMSG2",133,0)
 ;Build message
"RTN","SCDXMSG2",134,0)
 S SMTB="The following activity occurred "
"RTN","SCDXMSG2",135,0)
 S XMTEXT(1)=SMTB_"after the National Patient Care"
"RTN","SCDXMSG2",136,0)
 S XMTEXT(2)="Database was closed"
"RTN","SCDXMSG2",137,0)
 I MSGL=4 S XMTEXT(2)=XMTEXT(2)_"."
"RTN","SCDXMSG2",138,0)
 I MSGL=3 D
"RTN","SCDXMSG2",139,0)
 .S XMTEXT(2)=XMTEXT(2)_" for yearly workload credit but will be sent"
"RTN","SCDXMSG2",140,0)
 .S XMTEXT(3)="to the NPCD for historical accuracy of the database."
"RTN","SCDXMSG2",141,0)
 I MSGL=2 D
"RTN","SCDXMSG2",142,0)
 .S XMTEXT(2)=XMTEXT(2)_" for monthly workload credit but will be sent"
"RTN","SCDXMSG2",143,0)
 .S XMTEXT(3)="to the NPCD to be included in the fiscal year totals."
"RTN","SCDXMSG2",144,0)
 I MSGL=1 D
"RTN","SCDXMSG2",145,0)
 .; the rolling 20-day message is based on setup of ROLLD=19 in
"RTN","SCDXMSG2",146,0)
 .; CLOSEOUT^SCDXFU04
"RTN","SCDXMSG2",147,0)
 .S XMTEXT(1)=SMTB_"20 or more days after the encounter"
"RTN","SCDXMSG2",148,0)
 .S XMTEXT(2)="date but is valid for workload credit and will be sent"
"RTN","SCDXMSG2",149,0)
 .S XMTEXT(3)="to the National Patient Care Database."
"RTN","SCDXMSG2",150,0)
 S SMTN=$S(MSGL=4:3,1:4) S XMTEXT(SMTN)=" "
"RTN","SCDXMSG2",151,0)
 S XMTEXT(SMTN+1)="  Activity: "_ACT
"RTN","SCDXMSG2",152,0)
 S XMTEXT(SMTN+2)="Entered By: "_$S(USER:$P($G(^VA(200,USER,0)),"^",1),1:USER)
"RTN","SCDXMSG2",153,0)
 S XMTEXT(SMTN+3)="Entered On: "_$$FMTE^XLFDT(DATE)
"RTN","SCDXMSG2",154,0)
 S XMTEXT(SMTN+4)=" "
"RTN","SCDXMSG2",155,0)
 S XMTEXT(SMTN+5)="        Encounter Date: "_$$FMTE^XLFDT(ENCDATE)_"  (#"_$S(ENCPTR:ENCPTR,1:DELPTR)_")"
"RTN","SCDXMSG2",156,0)
 S:('ENCPTR) XMTEXT(SMTN+5)=XMTEXT(SMTN+5)_"  ** Deleted Encounter **"
"RTN","SCDXMSG2",157,0)
 S XMTEXT(SMTN+6)="Last NPCD Transmission: "_$S(LASTXMIT:$$FMTE^XLFDT(LASTXMIT),1:"Encounter data never transmitted ")_"  (#"_XMITPTR_")"
"RTN","SCDXMSG2",158,0)
 S XMTEXT(SMTN+7)="Last NPCD Ack Received: "_$S(LASTACK:$$FMTE^XLFDT(+LASTACK),1:"Acknowledgement not received")
"RTN","SCDXMSG2",159,0)
 S:(LASTACK) XMTEXT(SMTN+7)=XMTEXT(SMTN+7)_"  ("_$S((LASTCODE'=""):$$EXTERNAL^DILFD(409.73,15,"",LASTCODE),1:"Status unknown")_")"
"RTN","SCDXMSG2",160,0)
 S XMTEXT(SMTN+8)=" "
"RTN","SCDXMSG2",161,0)
 S XMTEXT(SMTN+9)=" Clinic: "_$P($G(^SC(CLINIC,0)),"^",1)
"RTN","SCDXMSG2",162,0)
 D PID^VADPT6
"RTN","SCDXMSG2",163,0)
 S XMTEXT(SMTN+10)="Patient: "_$P($G(^DPT(DFN,0)),"^",1)_"  ("_VA("BID")_")"
"RTN","SCDXMSG2",164,0)
 ;Send message
"RTN","SCDXMSG2",165,0)
 S XMSUB="Late ACRP Related Activity"_$$DIV^SDAMEVT1(DIV)
"RTN","SCDXMSG2",166,0)
 S XMTEXT="XMTEXT("
"RTN","SCDXMSG2",167,0)
 S XMDUZ=.5
"RTN","SCDXMSG2",168,0)
 S:(USER) XMY(USER)=""
"RTN","SCDXMSG2",169,0)
 D ^XMD    ; REMOVE COMMENT
"RTN","SCDXMSG2",170,0)
 ;Done
"RTN","SCDXMSG2",171,0)
 Q
"RTN","SCMSVUT2")
0^24^B30881760^B28593958
"RTN","SCMSVUT2",1,0)
SCMSVUT2 ;ALB/JLU;Utility routine for AMBCARE;06/28/99
"RTN","SCMSVUT2",2,0)
 ;;5.3;Scheduling;**66,180,254,293,325,466**;AUG 13,1993;Build 2
"RTN","SCMSVUT2",3,0)
 ;06/28/99 ACS Added CPT modifier validation
"RTN","SCMSVUT2",4,0)
 ;
"RTN","SCMSVUT2",5,0)
COUNT(VALER) ;counts the number of errored encounters found.
"RTN","SCMSVUT2",6,0)
 ;INPUT VALER - The array containing the errors.
"RTN","SCMSVUT2",7,0)
 ;OUTPUT the number of errors
"RTN","SCMSVUT2",8,0)
 ;
"RTN","SCMSVUT2",9,0)
 N VAR,CNT
"RTN","SCMSVUT2",10,0)
 S VAR="",CNT=0
"RTN","SCMSVUT2",11,0)
 F  S VAR=$O(@VALER@(VAR)) Q:VAR']""  S CNT=CNT+1
"RTN","SCMSVUT2",12,0)
 Q CNT
"RTN","SCMSVUT2",13,0)
 ;
"RTN","SCMSVUT2",14,0)
IPERR(VALER) ;counts the number of inpatient errored encounters found.
"RTN","SCMSVUT2",15,0)
 ;INPUT VALER - The array containing the errors.
"RTN","SCMSVUT2",16,0)
 ;OUTPUT the number of errors
"RTN","SCMSVUT2",17,0)
 ;
"RTN","SCMSVUT2",18,0)
 N VAR,CNT
"RTN","SCMSVUT2",19,0)
 S VAR="",CNT=0
"RTN","SCMSVUT2",20,0)
 F  S VAR=$O(@VALER@(VAR)) Q:VAR']""  D
"RTN","SCMSVUT2",21,0)
 .I $$INPATENC^SCDXUTL(VAR) S CNT=CNT+1
"RTN","SCMSVUT2",22,0)
 Q CNT
"RTN","SCMSVUT2",23,0)
 ;
"RTN","SCMSVUT2",24,0)
FILEVERR(PTR,VALERR) ;files the errors found for an encounter
"RTN","SCMSVUT2",25,0)
 ;INPUT  PTR - The pointer to the entry in the transmission file 409.73
"RTN","SCMSVUT2",26,0)
 ;      VALERR - The array holding the errors for the encounter.
"RTN","SCMSVUT2",27,0)
 ;OUTPUT  0 - did not file
"RTN","SCMSVUT2",28,0)
 ;        1 - did file
"RTN","SCMSVUT2",29,0)
 N SEG,FILE
"RTN","SCMSVUT2",30,0)
 I '$D(VALERR) Q 0
"RTN","SCMSVUT2",31,0)
 S SEG="",FILE=-1
"RTN","SCMSVUT2",32,0)
 F  S SEG=$O(@VALERR@(SEG)) Q:SEG']""  D FILE(VALERR,SEG,PTR,.FILE)
"RTN","SCMSVUT2",33,0)
 Q $S(FILE=1:1,1:0)
"RTN","SCMSVUT2",34,0)
 ;
"RTN","SCMSVUT2",35,0)
FILE(VALERR,SEG,PTR,FILE) ;
"RTN","SCMSVUT2",36,0)
 N NBR
"RTN","SCMSVUT2",37,0)
 S NBR=0
"RTN","SCMSVUT2",38,0)
 F  S NBR=$O(@VALERR@(SEG,NBR)) Q:'NBR  DO
"RTN","SCMSVUT2",39,0)
 .N CODPTR,CODE
"RTN","SCMSVUT2",40,0)
 .S CODE=$G(@VALERR@(SEG,NBR))
"RTN","SCMSVUT2",41,0)
 .I CODE']"" Q
"RTN","SCMSVUT2",42,0)
 .S CODPTR=$O(^SD(409.76,"B",CODE,""))
"RTN","SCMSVUT2",43,0)
 .I 'CODPTR Q
"RTN","SCMSVUT2",44,0)
 .I $D(^SD(409.75,"AER",PTR,CODPTR)) S FILE=1 Q
"RTN","SCMSVUT2",45,0)
 .S FILE=$$CRTERR^SCDXFU02(PTR,CODE)
"RTN","SCMSVUT2",46,0)
 .Q
"RTN","SCMSVUT2",47,0)
 Q
"RTN","SCMSVUT2",48,0)
 ;
"RTN","SCMSVUT2",49,0)
VALWL(CLIN) ;WORKLOAD VALIDATION AT CHECK OUT
"RTN","SCMSVUT2",50,0)
 ;INPUT CLIN - IEN OF CLINIC
"RTN","SCMSVUT2",51,0)
 ;OUTPUT 0 - DO NOT VALIDATE WORKLOAD
"RTN","SCMSVUT2",52,0)
 ;       1 - VALIDATE CLINIC WORKLOAD
"RTN","SCMSVUT2",53,0)
 N A1
"RTN","SCMSVUT2",54,0)
 I '$D(CLIN) S CLIN=0
"RTN","SCMSVUT2",55,0)
 S A1=$P($G(^SC(+CLIN,0)),U,30)
"RTN","SCMSVUT2",56,0)
 Q $S(A1=1:1,1:0)
"RTN","SCMSVUT2",57,0)
 ;
"RTN","SCMSVUT2",58,0)
VALIDATE(XMITPTR) ;validates data that has a entry in the transmit file.
"RTN","SCMSVUT2",59,0)
 ;
"RTN","SCMSVUT2",60,0)
 ;INPUT    XMITPTR - This is the point to an entry in file 409.73.
"RTN","SCMSVUT2",61,0)
 ;
"RTN","SCMSVUT2",62,0)
 ;OUTPUT    -1 - the was a problem with the inputs
"RTN","SCMSVUT2",63,0)
 ;           0 - no errors were found
"RTN","SCMSVUT2",64,0)
 ;           1 - errors were found
"RTN","SCMSVUT2",65,0)
 ;
"RTN","SCMSVUT2",66,0)
 N VALERR,ERR,HL,HLEID,DFN
"RTN","SCMSVUT2",67,0)
 S ANS=-1
"RTN","SCMSVUT2",68,0)
 S XMITPTR=+$G(XMITPTR)
"RTN","SCMSVUT2",69,0)
 I $G(^SD(409.73,XMITPTR,0))']"" G VALQ
"RTN","SCMSVUT2",70,0)
 D PATDFN^SCDXUTL2(XMITPTR)
"RTN","SCMSVUT2",71,0)
 ;
"RTN","SCMSVUT2",72,0)
 S HL7XMIT="^TMP(""HLS"","_$J_")",VALERR="^TMP(""SCDXVALID"","_$J_","_XMITPTR_")"
"RTN","SCMSVUT2",73,0)
 ;Initialze HL7 variables
"RTN","SCMSVUT2",74,0)
 S HLEID=+$O(^ORD(101,"B","SCDX AMBCARE SEND SERVER FOR ADT-Z00",0))
"RTN","SCMSVUT2",75,0)
 I ('HLEID) G VALQ
"RTN","SCMSVUT2",76,0)
 D INIT^HLFNC2(HLEID,.HL)
"RTN","SCMSVUT2",77,0)
 I ($O(HL(""))="") G VALQ
"RTN","SCMSVUT2",78,0)
 ;
"RTN","SCMSVUT2",79,0)
 S ERR=$$BUILDHL7^SCDXMSG0(XMITPTR,.HL,1,HL7XMIT,1,VALERR)
"RTN","SCMSVUT2",80,0)
 ;
"RTN","SCMSVUT2",81,0)
 I ERR<0,$O(@VALERR@(0))']"" D VALIDATE^SCMSVUT0("INTERNAL","","V900",VALERR,0)
"RTN","SCMSVUT2",82,0)
 S ANS=0
"RTN","SCMSVUT2",83,0)
 D DELAERR^SCDXFU02(XMITPTR,0)
"RTN","SCMSVUT2",84,0)
 D DEMUPDT(DFN,VALERR,"DEMO")
"RTN","SCMSVUT2",85,0)
 I $O(@VALERR@(0))]"" DO
"RTN","SCMSVUT2",86,0)
 .N FILE
"RTN","SCMSVUT2",87,0)
 .S ANS=1
"RTN","SCMSVUT2",88,0)
 .S FILE=$$FILEVERR(XMITPTR,VALERR)
"RTN","SCMSVUT2",89,0)
 .Q
"RTN","SCMSVUT2",90,0)
 ;
"RTN","SCMSVUT2",91,0)
 K @VALERR,@HL7XMIT
"RTN","SCMSVUT2",92,0)
 ;
"RTN","SCMSVUT2",93,0)
VALQ Q ANS
"RTN","SCMSVUT2",94,0)
 ;
"RTN","SCMSVUT2",95,0)
DEMUPDT(DFN,VALERR,TYP) ;
"RTN","SCMSVUT2",96,0)
 ;This entry point updates all the other encoutners for this patient
"RTN","SCMSVUT2",97,0)
 ;that HAVE errors with a new set or demographic errors or deletes all
"RTN","SCMSVUT2",98,0)
 ;the demographic errors if none were found.
"RTN","SCMSVUT2",99,0)
 ;INPUT DFN - The patient's DFN
"RTN","SCMSVUT2",100,0)
 ;   VALERR - errors to log
"RTN","SCMSVUT2",101,0)
 ;      TYP - The type of errors to delete and log.
"RTN","SCMSVUT2",102,0)
 ;            Right now demographic errors are the only kind "DEMO"
"RTN","SCMSVUT2",103,0)
 ;
"RTN","SCMSVUT2",104,0)
 S DFN=$G(DFN),TYP=$G(TYP),VALERR=$G(VALERR)
"RTN","SCMSVUT2",105,0)
 I DFN=""!(TYP="")!(VALERR="") Q
"RTN","SCMSVUT2",106,0)
 N PTRS,RNG,LP,PTR
"RTN","SCMSVUT2",107,0)
 S RNG=$P($T(@(TYP)),";;",2),PTRS=""
"RTN","SCMSVUT2",108,0)
 D CLEAN(DFN,RNG,.PTRS)
"RTN","SCMSVUT2",109,0)
 I '$D(@VALERR@("PID")) Q
"RTN","SCMSVUT2",110,0)
 I PTRS']"" Q
"RTN","SCMSVUT2",111,0)
 F LP=1:1 S PTR=$P(PTRS,U,LP) Q:PTR']""  DO
"RTN","SCMSVUT2",112,0)
 .I '$D(^SD(409.73,PTR,0)) Q
"RTN","SCMSVUT2",113,0)
 .N FILE
"RTN","SCMSVUT2",114,0)
 .D FILE(VALERR,"PID",PTR,.FILE)
"RTN","SCMSVUT2",115,0)
 .Q
"RTN","SCMSVUT2",116,0)
 Q
"RTN","SCMSVUT2",117,0)
 ;
"RTN","SCMSVUT2",118,0)
CLEAN(DFN,RNG,PTRS) ;This subroutine cleans out all errors for a pateint
"RTN","SCMSVUT2",119,0)
 ;and returns a string of which entries in 409.73 were cleaned of errors
"RTN","SCMSVUT2",120,0)
 ;
"RTN","SCMSVUT2",121,0)
 N LP,COD,LP2,IEN
"RTN","SCMSVUT2",122,0)
 F LP=1:1 S COD=$P(RNG,U,LP) Q:COD']""  I $D(^SD(409.75,"ACOD",DFN,COD)) S IEN="" F LP2=1:1 S IEN=$O(^SD(409.75,"ACOD",DFN,COD,IEN)) Q:IEN']""  DO
"RTN","SCMSVUT2",123,0)
 .N VAR,RES
"RTN","SCMSVUT2",124,0)
 .S VAR=$P($G(^SD(409.75,IEN,0)),U,1)_"^"
"RTN","SCMSVUT2",125,0)
 .I $P(VAR,U,1)="" S PTR="" Q
"RTN","SCMSVUT2",126,0)
 .S RES=$$DELERR^SCDXFU02(IEN)
"RTN","SCMSVUT2",127,0)
 .I PTRS[VAR Q
"RTN","SCMSVUT2",128,0)
 .S PTRS=PTRS_VAR
"RTN","SCMSVUT2",129,0)
 .Q
"RTN","SCMSVUT2",130,0)
 Q
"RTN","SCMSVUT2",131,0)
 ;
"RTN","SCMSVUT2",132,0)
MODCODE(DATA,ENCDT) ;
"RTN","SCMSVUT2",133,0)
 ;
"RTN","SCMSVUT2",134,0)
 ;---------------------------------------------------------------
"RTN","SCMSVUT2",135,0)
 ;    VALIDATE MODIFIER AND CPT+MODIFIER COMBINATION
"RTN","SCMSVUT2",136,0)
 ;
"RTN","SCMSVUT2",137,0)
 ; INPUT: DATA - The procedure and modifier code to be checked 
"RTN","SCMSVUT2",138,0)
 ;               format: CPT~modifier
"RTN","SCMSVUT2",139,0)
 ;       ENCDT - The date of the encounter
"RTN","SCMSVUT2",140,0)
 ;
"RTN","SCMSVUT2",141,0)
 ;OUTPUT:    1 - valid modifier and CPT+modifier combination
"RTN","SCMSVUT2",142,0)
 ;           0 - invalid modifier or CPT+modifier combination
"RTN","SCMSVUT2",143,0)
 ;
"RTN","SCMSVUT2",144,0)
 ;**NOTE**   This call makes the assumption that leading zeros are
"RTN","SCMSVUT2",145,0)
 ;           intact in the input.
"RTN","SCMSVUT2",146,0)
 ;---------------------------------------------------------------
"RTN","SCMSVUT2",147,0)
 ;
"RTN","SCMSVUT2",148,0)
 ;- validate modifier only
"RTN","SCMSVUT2",149,0)
 N DATAMOD
"RTN","SCMSVUT2",150,0)
 S DATAMOD=$P(DATA,"~",2)
"RTN","SCMSVUT2",151,0)
 I '$D(DATAMOD) Q 0
"RTN","SCMSVUT2",152,0)
 I $$MOD^ICPTMOD(DATAMOD,"E",ENCDT,1)'>0 Q 0
"RTN","SCMSVUT2",153,0)
 ;
"RTN","SCMSVUT2",154,0)
 ;- validate CPT+modifier pair
"RTN","SCMSVUT2",155,0)
 N DATAPROC
"RTN","SCMSVUT2",156,0)
 S DATAPROC=$P(DATA,"~",1)
"RTN","SCMSVUT2",157,0)
 I '$D(DATAPROC) Q 0
"RTN","SCMSVUT2",158,0)
 I $$MODP^ICPTMOD(DATAPROC,DATAMOD,"E",ENCDT,1)'>0 Q 0
"RTN","SCMSVUT2",159,0)
 Q 1
"RTN","SCMSVUT2",160,0)
 ;
"RTN","SCMSVUT2",161,0)
MODMETH(DATA) ;
"RTN","SCMSVUT2",162,0)
 ;
"RTN","SCMSVUT2",163,0)
 ;---------------------------------------------------------------
"RTN","SCMSVUT2",164,0)
 ;    VALIDATE MODIFIER CODING METHOD
"RTN","SCMSVUT2",165,0)
 ;
"RTN","SCMSVUT2",166,0)
 ; INPUT: DATA - The modifier coding method to be checked 
"RTN","SCMSVUT2",167,0)
 ;
"RTN","SCMSVUT2",168,0)
 ;OUTPUT:    1 - valid modifier coding method
"RTN","SCMSVUT2",169,0)
 ;           0 - invalid modifier coding method
"RTN","SCMSVUT2",170,0)
 ;
"RTN","SCMSVUT2",171,0)
 ; Valid modifier coding methods: C and H
"RTN","SCMSVUT2",172,0)
 ;---------------------------------------------------------------
"RTN","SCMSVUT2",173,0)
 ;
"RTN","SCMSVUT2",174,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT2",175,0)
 S DATA=","_DATA_","
"RTN","SCMSVUT2",176,0)
 I ",C,H,"'[DATA Q 0
"RTN","SCMSVUT2",177,0)
 Q 1
"RTN","SCMSVUT2",178,0)
 ;
"RTN","SCMSVUT2",179,0)
ETHNIC(DATA)    ;
"RTN","SCMSVUT2",180,0)
 ;INPUT  DATA - the ethnicity code to be validated (NNNN-C-XXX)
"RTN","SCMSVUT2",181,0)
 ;
"RTN","SCMSVUT2",182,0)
 N VAL,MTHD
"RTN","SCMSVUT2",183,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT2",184,0)
 I DATA="" Q 1
"RTN","SCMSVUT2",185,0)
 S VAL=$P(DATA,"-",1,2)
"RTN","SCMSVUT2",186,0)
 S MTHD=$P(DATA,"-",3)
"RTN","SCMSVUT2",187,0)
 I VAL'?4N1"-"1N Q 0
"RTN","SCMSVUT2",188,0)
 I ",SLF,UNK,PRX,OBS,"'[MTHD Q 0
"RTN","SCMSVUT2",189,0)
 Q 1
"RTN","SCMSVUT2",190,0)
CONFDT(DATA,SUB)    ;CONFIDENTIAL ADDRESS START/STOP DATE
"RTN","SCMSVUT2",191,0)
 N X,Y,%DT,DTOUT,STDT,ENDT
"RTN","SCMSVUT2",192,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT2",193,0)
 S STDT=$P(DATA,SUB,1)
"RTN","SCMSVUT2",194,0)
 S ENDT=$P(DATA,SUB,2)
"RTN","SCMSVUT2",195,0)
 I STDT="" Q 0
"RTN","SCMSVUT2",196,0)
 S STDT=$$FMDATE^HLFNC(STDT)
"RTN","SCMSVUT2",197,0)
 S X=STDT D ^%DT I Y=-1 Q 0
"RTN","SCMSVUT2",198,0)
 I ENDT="" Q 1
"RTN","SCMSVUT2",199,0)
 S ENDT=$$FMDATE^HLFNC(ENDT)
"RTN","SCMSVUT2",200,0)
 S X=ENDT D ^%DT I Y=-1 Q 0
"RTN","SCMSVUT2",201,0)
 I $$FMDIFF^XLFDT(ENDT,STDT,1)<0 Q 0
"RTN","SCMSVUT2",202,0)
 Q 1
"RTN","SCMSVUT2",203,0)
 ;
"RTN","SCMSVUT2",204,0)
CONFCAT(DATA)             ;CONFIDENTIAL ADDRESS CATEGORY TYPE
"RTN","SCMSVUT2",205,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT2",206,0)
 I DATA="" Q 0
"RTN","SCMSVUT2",207,0)
 N VAL,GOOD
"RTN","SCMSVUT2",208,0)
 S GOOD=0
"RTN","SCMSVUT2",209,0)
 F VAL="VACAA","VACAC","VACAE","VACAM","VACAO" I DATA=VAL S GOOD=1 Q
"RTN","SCMSVUT2",210,0)
 Q GOOD
"RTN","SCMSVUT2",211,0)
 ;
"RTN","SCMSVUT2",212,0)
CVEDT(DATA) ;Combat vet end date (ZEL.38)
"RTN","SCMSVUT2",213,0)
 ;Input  : DATA - CombatVetIndicator ^ CombatVetEndDate
"RTN","SCMSVUT2",214,0)
 ;Output : 1 = Good / 0 = Bad
"RTN","SCMSVUT2",215,0)
 ;
"RTN","SCMSVUT2",216,0)
 N CVI,CVEDT
"RTN","SCMSVUT2",217,0)
 S DATA=$G(DATA)
"RTN","SCMSVUT2",218,0)
 S CVI=$P(DATA,"^",1)
"RTN","SCMSVUT2",219,0)
 S CVEDT=$P(DATA,"^",2)
"RTN","SCMSVUT2",220,0)
 I 'CVI Q $S(CVEDT="":1,1:0)
"RTN","SCMSVUT2",221,0)
 Q CVEDT?8N
"RTN","SCMSVUT2",222,0)
 ;
"RTN","SCMSVUT2",223,0)
CLCV(DATA,SDOE) ;Cross check for combat vet classification question
"RTN","SCMSVUT2",224,0)
 ;Input  : DATA - Answer to classification question
"RTN","SCMSVUT2",225,0)
 ;         SDOE - Pointer to encounter (file # 409.68)
"RTN","SCMSVUT2",226,0)
 ;Output : 1 = Good / 0 = Bad
"RTN","SCMSVUT2",227,0)
 ;
"RTN","SCMSVUT2",228,0)
 S DATA=$G(DATA)
"RTN","SCMSVUT2",229,0)
 Q:(DATA'=1) 1
"RTN","SCMSVUT2",230,0)
 N VET,SDDT,SDOE0
"RTN","SCMSVUT2",231,0)
 S SDOE=$G(SDOE) Q:'SDOE 0
"RTN","SCMSVUT2",232,0)
 S SDOE0=$G(^SCE(SDOE,0))
"RTN","SCMSVUT2",233,0)
 S SDDT=+SDOE0 Q:'SDDT 0
"RTN","SCMSVUT2",234,0)
 S DFN=+$P(SDOE0,"^",2) Q:'DFN 0
"RTN","SCMSVUT2",235,0)
 S VET=$P($$EL^SDCO22(DFN,SDOE),"^",5)
"RTN","SCMSVUT2",236,0)
 I VET'="Y" Q 0
"RTN","SCMSVUT2",237,0)
 S VET=+$$CVEDT^DGCV(DFN,SDDT)
"RTN","SCMSVUT2",238,0)
 Q $S(VET=1:1,1:0)
"RTN","SCMSVUT2",239,0)
 ;
"RTN","SCMSVUT2",240,0)
DEMO ;;2000^2030^2050^2100^2150^2200^2210^2220^2230^2240^2250^2300^2330^2360
"RTN","SCRPW16")
0^12^B43551884^B42185215
"RTN","SCRPW16",1,0)
SCRPW16 ;RENO/KEITH - Encounter 'Action Required' Report ; 01 Jan 99  9:27 PM
"RTN","SCRPW16",2,0)
 ;;5.3;Scheduling;**139,144,155,161,336,466**;AUG 13, 1993;Build 2
"RTN","SCRPW16",3,0)
 N SD,SDDIV,ZTSAVE,%DT,DIR,DTOUT,DUOUT,X,Y
"RTN","SCRPW16",4,0)
 D TITL^SCRPW50("Encounter 'Action Required' Report")
"RTN","SCRPW16",5,0)
 G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW16",6,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW16",7,0)
 W ! S %DT="AEPX",%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT S SD("BDT")=Y
"RTN","SCRPW16",8,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT
"RTN","SCRPW16",9,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","SCRPW16",10,0)
 S SD("EDT")=Y_.999999
"RTN","SCRPW16",11,0)
 D SUBT^SCRPW50("*** Report Format Selection ***")
"RTN","SCRPW16",12,0)
 S DIR(0)="S^D:DETAILED REPORT;S:STATISTICS ONLY",DIR("A")="Select report type",DIR("B")="DETAILED REPORT" D ^DIR G:($D(DTOUT)!$D(DUOUT)) EXIT S SD("STAT")=Y
"RTN","SCRPW16",13,0)
 G:'$$ASK^SCRPW17(0,0,.SD,"",$S(SD("STAT")="D":"A",1:"A^1"),1) EXIT
"RTN","SCRPW16",14,0)
 I SD("STAT")="D" K DIR S DIR(0)="Y",DIR("A")="Would you like a separate page for every clinic",DIR("B")="NO" W ! D ^DIR G:($D(DTOUT)!$D(DUOUT)) EXIT S SD("PAGE")=Y
"RTN","SCRPW16",15,0)
 W !!,"This report requires 132 column output.",! S ZTSAVE("SDDIV")="",ZTSAVE("SDDIV(")="",ZTSAVE("SD(")="" D EN^XUTMDEVQ("RUN^SCRPW16","Enc. 'Act. Req.' Rpt.",.ZTSAVE) G EXIT
"RTN","SCRPW16",16,0)
 ;
"RTN","SCRPW16",17,0)
RUN ;Print report
"RTN","SCRPW16",18,0)
 K ^TMP("SCRPW",$J),SDSEG,SDSTR,SDT S (SDOUT,SDLK)=0
"RTN","SCRPW16",19,0)
 ;If date range includes TODAY, update appointment status
"RTN","SCRPW16",20,0)
 I SD("BDT")'>DT,SD("EDT")'<DT D  G:SDOUT EXIT
"RTN","SCRPW16",21,0)
 .D LOCK Q:SDOUT!'SDLK
"RTN","SCRPW16",22,0)
 .N SDBEG,SDEND,X,%,%H,%I D NOW^%DTC S SDBEG=DT,SDEND=%
"RTN","SCRPW16",23,0)
 .S SDEND=($P(SDEND,".")-1)_"."_999999
"RTN","SCRPW16",24,0)
 .D EN^SDAMQ3(SDBEG,SDEND) K ^TMP("SDSTATS",$J) L -^SCRPW16("ACTION REQUIRED REPORT") Q
"RTN","SCRPW16",25,0)
 S SDT(2)=$$T2^SCRPW18(),SDDT=SD("BDT"),SDSEG=$$SEGS^SCRPW18(.SDSEG) D STR^SCRPW18(.SDSTR) S (SDOUT,SDSTOP)=0,SDMD="",SDMD=$O(SDDIV(SDMD)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW16",26,0)
 F  S SDDT=$O(^SCE("B",SDDT)) Q:'SDDT!(SDDT>SD("EDT"))!SDOUT  S SDOE=0 F  S SDOE=$O(^SCE("B",SDDT,SDOE)) Q:'SDOE!SDOUT  D EVAL
"RTN","SCRPW16",27,0)
 G:SDOUT EXIT
"RTN","SCRPW16",28,0)
 S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP Q:SDOUT  D
"RTN","SCRPW16",29,0)
 .S SDFCT(SDIV)=0,SDCG="" F  S SDCG=$O(^TMP("SCRPW",$J,SDIV,1,SDCG)) Q:SDCG=""  S SDTCT=0 D CT1 S ^TMP("SCRPW",$J,SDIV,1,SDCG)=SDTCT
"RTN","SCRPW16",30,0)
 .Q
"RTN","SCRPW16",31,0)
 G:SDOUT EXIT
"RTN","SCRPW16",32,0)
 S SDIV="" F  S SDIV=$O(SDDIV(SDIV)) Q:'SDIV  S SDIV(SDDIV(SDIV))=SDIV
"RTN","SCRPW16",33,0)
 I 'SDDIV,$P(SDDIV,U,2)'="ALL DIVISIONS" S SDIV($P(SDDIV,U,2))=$$PRIM^VASITE()
"RTN","SCRPW16",34,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:$L(SDX) SDIV(SDX)=SDI
"RTN","SCRPW16",35,0)
 D HD1^SCRPW18 D:$E(IOST)="C" DISP0^SCRPW23 I '$O(^TMP("SCRPW",$J,0)) S SDIV=0 D DHDR^SCRPW40(3,.SDT) D HDR^SCRPW18(.SDT,"") Q:SDOUT  S SDX="No activity found within selected report parameters!" W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW16",36,0)
 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW16",37,0)
 S SDI=0,SDI=$O(^TMP("SCRPW",$J,SDI)),SDMD=$O(^TMP("SCRPW",$J,SDI))
"RTN","SCRPW16",38,0)
 G:SDOUT EXIT I SDMD S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW16",39,0)
 I 'SDOUT,$E(IOST)="C" N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW16",40,0)
EXIT K SD,SDARY,SDBDAY,SDCCT,SDCL,SDCLN,SDCT,SDDPT,SDDT,SDEDAY,SDFCT,SDFF,SDI,SDLINE,SDOE,SDOE0,SDORD,SDPAGE,SDPNOW,DFN,SDPT0,SDPTNA,SDR,SDSN,SDSTR
"RTN","SCRPW16",41,0)
 K SDT,SDTCT,SDCG,SDX,SDMD,SDSTOP,%,SDFOUND,SDDEF,SDCO,SDAP0,SDDIV,SDIV,SDIVN,SDCI,SDCLPT,SDCLPTC,SDDIS,SDV,SDSDV,SDSDVC0,SDSEG,SDTY,SDY,%DT
"RTN","SCRPW16",42,0)
 K SDLK,SCRPW16,SDCS,SDCO,SDZ,SDOUT,DIR,DTOUT,DUOUT,X,Y,ZTSAVE D KVA^VADPT,END^SCRPW50 Q
"RTN","SCRPW16",43,0)
 ;
"RTN","SCRPW16",44,0)
LOCK ;Prevent simultaneous runs of the appointment status update
"RTN","SCRPW16",45,0)
 F SDI=1:1 L +^SCRPW16("ACTION REQUIRED REPORT"):1 D  Q:SDI>600!SDOUT!SDLK
"RTN","SCRPW16",46,0)
 .I $T S SDLK=1 Q
"RTN","SCRPW16",47,0)
 .D:SDI#60=0 STOP
"RTN","SCRPW16",48,0)
 .Q
"RTN","SCRPW16",49,0)
 Q
"RTN","SCRPW16",50,0)
 ;
"RTN","SCRPW16",51,0)
DPRT(SDIV) ;Print report for a division
"RTN","SCRPW16",52,0)
 D DHDR^SCRPW40(3,.SDT) I '$D(^TMP("SCRPW",$J,SDIV)) D HDR^SCRPW18(.SDT,"") Q:SDOUT  S X="No 'action required' activity found for this division!" W !!?(132-$L(X)\2),X Q
"RTN","SCRPW16",53,0)
 D:SDIV&(SD("STAT")="D") DET^SCRPW18 Q:SDOUT  D STAT^SCRPW18 Q
"RTN","SCRPW16",54,0)
 ;
"RTN","SCRPW16",55,0)
STOP ;Check for stop task request
"RTN","SCRPW16",56,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW16",57,0)
 ;
"RTN","SCRPW16",58,0)
EVAL S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP Q:SDOUT
"RTN","SCRPW16",59,0)
 S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) Q:$P(SDOE0,U,6)!'SDIV  Q:$$STCK(SDOE0)  Q:'$$DIV(SDIV)
"RTN","SCRPW16",60,0)
 S SDCL=+$P(SDOE0,U,4),SDCLN=$S('SDCL:"**NONE**",1:$P(^SC(SDCL,0),U)),SDCG=$P($G(^SC(SDCL,0)),U,31),SDCG=$S(SD("FORMAT")'["G":"**NONE**",SDCG:$P(^SD(409.67,SDCG,0),U),1:"**NONE**")
"RTN","SCRPW16",61,0)
 I SD("FORMAT")="SC",'$D(SD("CLINIC",SDCLN)) Q
"RTN","SCRPW16",62,0)
 I SD("FORMAT")="RC",(($O(SD("CLINIC",""))]SDCLN)!(SDCLN]$O(SD("CLINIC",""),-1))) Q
"RTN","SCRPW16",63,0)
 I "SS^RS"[SD("FORMAT"),'$$STCO() Q
"RTN","SCRPW16",64,0)
 I SD("FORMAT")="SG",$P(SD("GROUP"),U,2)'=SDCG Q
"RTN","SCRPW16",65,0)
 S DFN=$P(SDOE0,U,2) Q:'DFN  D DEM^VADPT M SDDPT=VADM
"RTN","SCRPW16",66,0)
 I SD("ORDER")="A" S SDORD=SDDPT(1)
"RTN","SCRPW16",67,0)
 I SD("ORDER")="D" S SDORD=$P(SDOE0,U)
"RTN","SCRPW16",68,0)
 I SD("ORDER")="T" S SDSN=$P(SDDPT(2),U),SDORD=$E(SDSN,8,9)_$E(SDSN,6,7)_$E(SDSN,4,5)_$E(SDSN,1,3)_"."
"RTN","SCRPW16",69,0)
 K SDARY M SDARY=SDSEG S (SDFOUND,SDY)=0 I $$CHEK^SCRPW18(SDOE,.SDARY,.SDSTR) S SDI="" F  S SDI=$O(SDARY(SDI)) Q:SDI=""  S SDX="" F  S SDX=$O(SDARY(SDI,SDX)) Q:SDX=""  D SET(SDX)
"RTN","SCRPW16",70,0)
 K SDX D CLASK^SDCO2(SDOE,.SDX)
"RTN","SCRPW16",71,0)
 ; SD*5.3*336 so all existing and future classification types are pulled
"RTN","SCRPW16",72,0)
 I $D(SDX) S SDI=0 F  S SDI=$O(SDX(SDI)) Q:'SDI  I $P(SDX(SDI),U,2)="" D
"RTN","SCRPW16",73,0)
 . I '$D(^SD(409.41,SDI,0)) S SDX="Classification required" D SET(SDX) Q
"RTN","SCRPW16",74,0)
 . S SDX=$P($G(^SD(409.41,SDI,0)),U,1)_" classification required"
"RTN","SCRPW16",75,0)
 . D SET(SDX)
"RTN","SCRPW16",76,0)
 I 'SDFOUND,$P(SDOE0,U,8)=1,'$$CODT^SDCOU(DFN,SDDT,SDCL) S SDI=1,SDX="No check-out date" D SET(SDX)
"RTN","SCRPW16",77,0)
 I 'SDFOUND S SDCO="" D EN^SDCOM(SDOE,0,,.SDCO) Q:SDCO>0
"RTN","SCRPW16",78,0)
 I 'SDFOUND D
"RTN","SCRPW16",79,0)
 .K SDZ D GETDX^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No diagnosis on file")
"RTN","SCRPW16",80,0)
 .K SDZ D GETPRV^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No provider on file")
"RTN","SCRPW16",81,0)
 .K SDZ D GETCPT^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No procedure code on file")
"RTN","SCRPW16",82,0)
 I 'SDFOUND S SDX="Unknown reason" D SET(SDX)
"RTN","SCRPW16",83,0)
 D EV1(SDIV) D:SDMD EV1(0)
"RTN","SCRPW16",84,0)
 Q
"RTN","SCRPW16",85,0)
 ;
"RTN","SCRPW16",86,0)
STCK(SDOE0) ;Check Status for action required
"RTN","SCRPW16",87,0)
 ;Returns 0 if status=action required (14) or
"RTN","SCRPW16",88,0)
 ;             status=inpatients (8) and check out date=""
"RTN","SCRPW16",89,0)
 ;        1 if non-count clinic, OOS and otherwise
"RTN","SCRPW16",90,0)
 I $P(SDOE0,U,4),'$$CLINIC^SDAMU($P(SDOE0,U,4)) Q 1
"RTN","SCRPW16",91,0)
 I $P(SDOE0,U,12)=8,$P(SDOE0,U,7)="" Q 0
"RTN","SCRPW16",92,0)
 I $P(SDOE0,U,12)'=14 Q 1
"RTN","SCRPW16",93,0)
 Q 0
"RTN","SCRPW16",94,0)
 ;
"RTN","SCRPW16",95,0)
EV1(SDIV) S ^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE)=SDOE0,^TMP("SCRPW",$J,SDIV,3,DFN)=SDDPT(1)_U_SDDPT(2)
"RTN","SCRPW16",96,0)
 Q
"RTN","SCRPW16",97,0)
 ;
"RTN","SCRPW16",98,0)
DIV(SDIV) ;Evaluate division
"RTN","SCRPW16",99,0)
 ;Required input: SDIV=division ifn
"RTN","SCRPW16",100,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW16",101,0)
 ;
"RTN","SCRPW16",102,0)
STCO() ;Evaluate Stop Code
"RTN","SCRPW16",103,0)
 Q:'SDCL 0  S SDCS=$P($G(^SC(SDCL,0)),U,7) Q:'SDCS 0  S SDCS=$P($G(^DIC(40.7,SDCS,0)),U,2) Q:'SDCS 0
"RTN","SCRPW16",104,0)
 I SD("FORMAT")="SS" Q $D(SD("STOPCODE",SDCS))
"RTN","SCRPW16",105,0)
 I (($O(SD("STOPCODE",""))]SDCS)!(SDCS]$O(SD("STOPCODE",""),-1))) Q 0
"RTN","SCRPW16",106,0)
 Q 1
"RTN","SCRPW16",107,0)
 ;
"RTN","SCRPW16",108,0)
SET(SDX) D SET1(SDIV) D:SDMD SET1(0) Q
"RTN","SCRPW16",109,0)
 ;
"RTN","SCRPW16",110,0)
SET1(SDIV) S SDY=SDY+1,^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE,SDY)=SDX
"RTN","SCRPW16",111,0)
 S ^TMP("SCRPW",$J,SDIV,2,SDCG,SDX)=$G(^TMP("SCRPW",$J,SDIV,2,SDCG,SDX))+1,SDFOUND=1
"RTN","SCRPW16",112,0)
 Q
"RTN","SCRPW16",113,0)
 ;
"RTN","SCRPW16",114,0)
CT1 S SDCLN="" F  S SDCLN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)) Q:SDCLN=""  S SDCCT=0 D CT2 S ^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)=SDCCT
"RTN","SCRPW16",115,0)
 Q
"RTN","SCRPW16",116,0)
 ;
"RTN","SCRPW16",117,0)
CT2 S SDORD="" F  S SDORD=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD)) Q:SDORD=""  S DFN="" F  S DFN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN)) Q:DFN=""  D CT3
"RTN","SCRPW16",118,0)
 Q
"RTN","SCRPW16",119,0)
 ;
"RTN","SCRPW16",120,0)
CT3 S SDOE=0 F  S SDOE=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE)) Q:'SDOE  S SDFCT(SDIV)=SDFCT(SDIV)+1,SDTCT=SDTCT+1,SDCCT=SDCCT+1
"RTN","SCRPW16",121,0)
 Q
"RTN","SCRPW18")
0^31^B56544520^B55681496
"RTN","SCRPW18",1,0)
SCRPW18 ;RENO/KEITH/MRY - ACRP encounter consistency checker ; 21 JUL 2000  2:17 PM
"RTN","SCRPW18",2,0)
 ;;5.3;Scheduling;**139,144,155,222,387,466**;AUG 13, 1993;Build 2
"RTN","SCRPW18",3,0)
CHEK(ENCPTR,SDARY,SDSTR) ;Consistency checker for outpatient encounter transactions
"RTN","SCRPW18",4,0)
 ;Required input: ENCPTR=OUTPATIENT ENCOUNTER record IEN
"RTN","SCRPW18",5,0)
 ;Required input: SDARY=array (passed by reference) of HL7 segments to 
"RTN","SCRPW18",6,0)
 ;                check in the format SDARY(segmentname)="".  Returns
"RTN","SCRPW18",7,0)
 ;                SDARY(segmentname)="", if no errors for that segment.
"RTN","SCRPW18",8,0)
 ;                If errors exist for a specific segment, returns:
"RTN","SCRPW18",9,0)
 ;
"RTN","SCRPW18",10,0)
 ;  SDARY(segment)="-1^Element in xxx segment failed validity check"
"RTN","SCRPW18",11,0)
 ;  SDARY(segment,errorcode)=error code description (from file #409.76)
"RTN","SCRPW18",12,0)
 ;
"RTN","SCRPW18",13,0)
 ;                If passed in as an undefined array, all segments will
"RTN","SCRPW18",14,0)
 ;                be checked; otherwise, only segment names
"RTN","SCRPW18",15,0)
 ;                in the array subscript will be checked.
"RTN","SCRPW18",16,0)
 ;Optional input: SDSTR array as established by SEG^SCRPW18
"RTN","SCRPW18",17,0)
 ;Output: 1=inconsistencies found, 0=no inconsistencies found
"RTN","SCRPW18",18,0)
 ;
"RTN","SCRPW18",19,0)
 N HL,HLEID,ENCDT,EVNTDATE,EVNTHL7,SEG,DELPTR,SDERR,DFN,VAFSTR,NODE,SDE1,SDI,SDX,VALERR,XMITPTR,ENCNDT S VALERR="SDE1",XMITPTR=""
"RTN","SCRPW18",20,0)
 D:$D(SDSTR)<10 STR(.SDSTR) I $D(SDARY)<10 S SEG="" F  S SEG=$O(SDSTR(SEG)) Q:SEG=""  S SDARY(SEG)=""
"RTN","SCRPW18",21,0)
 S NODE=$$GETOE^SDOE(ENCPTR) Q:'$L(NODE) 0  S DFN=$P(NODE,U,2)
"RTN","SCRPW18",22,0)
 S SDERR=0,DELPTR="",HLEID=+$O(^ORD(101,"B","SCDX AMBCARE SEND SERVER FOR ADT-Z00",0)),ENCDT=$P($P(NODE,U),"."),EVNTDATE=$P(NODE,U),ENCNDT=EVNTDATE,EVNTHL7="A08" D INIT^HLFNC2(HLEID,.HL)
"RTN","SCRPW18",23,0)
 S SEG="" F  S SEG=$O(SDARY(SEG)) Q:SEG=""  S VAFSTR=$G(SDSTR(SEG)) I $L(VAFSTR) D VER(SEG,VAFSTR,.SDARY,.SDERR) K @("VAF"_SEG)
"RTN","SCRPW18",24,0)
 Q SDERR
"RTN","SCRPW18",25,0)
 ;
"RTN","SCRPW18",26,0)
VER(SEG,VAFSTR,SDARY,SDERR) ;Verify a segment
"RTN","SCRPW18",27,0)
 ;Required input: SEG=segment name
"RTN","SCRPW18",28,0)
 ;Required input: VAFSTR=segment string
"RTN","SCRPW18",29,0)
 ;Required input: SDARY=array for error return
"RTN","SCRPW18",30,0)
 ;Required input: SDERR=variable to return error status (pass by reference)
"RTN","SCRPW18",31,0)
 ;Output: SDARY(SEG)=error (if one exists)
"RTN","SCRPW18",32,0)
 N VAFARRY,TAG,ERROR,ERRSUB S SDARY(SEG)=""
"RTN","SCRPW18",33,0)
 K ^TMP("SCRPWVER",$J) S VAFARRY="^TMP(""SCRPWVER"","_$J_","""_SEG_""")" S ERROR=0 F TAG="BLD"_SEG_"^SCDXMSG1","VLD"_SEG_"^SCDXMSG1" D @TAG
"RTN","SCRPW18",34,0)
 K ^TMP("SCRPWVER",$J) I ERROR'=0 S SDARY(SEG)=ERROR,SDERR=1,SDI="" F  S SDI=$O(SDE1(SEG,SDI)) Q:SDI=""  S SDX=SDE1(SEG,SDI),SDARY(SEG,SDX)=$P($G(^SD(409.76,+$O(^SD(409.76,"B",SDX,"")),1)),U)
"RTN","SCRPW18",35,0)
 Q
"RTN","SCRPW18",36,0)
 ;
"RTN","SCRPW18",37,0)
STR(SDSTR) ;Create segment string
"RTN","SCRPW18",38,0)
 ;Required input: SDSEG=array to return segment strings (pass by reference)
"RTN","SCRPW18",39,0)
 ;Output: array of segments and strings in the format SDSTR(segment)=segment string
"RTN","SCRPW18",40,0)
 N SDI,SDSEG
"RTN","SCRPW18",41,0)
 D SEGMENTS^SCDXMSG1("A08","SDSTR") S SDI=0 F  S SDI=$O(SDSTR(SDI)) Q:'SDI  S SDSEG=$O(SDSTR(SDI,"")),SDSTR(SDSEG)=SDSTR(SDI,SDSEG) K SDSTR(SDI,SDSEG)
"RTN","SCRPW18",42,0)
 Q
"RTN","SCRPW18",43,0)
 ;
"RTN","SCRPW18",44,0)
SEGS(SDARY) ;Return segments to validate
"RTN","SCRPW18",45,0)
 ;Optional input: SDARY=array to return list of segments in
"RTN","SCRPW18",46,0)
 ;Output: string of HL7 segments to validate
"RTN","SCRPW18",47,0)
 N SD,SDS,SDL
"RTN","SCRPW18",48,0)
 S SDS="PID^ZIR^ZEL^ZPD^ZSP^DG1^PR1^ZCL^ZSC^ROL^"
"RTN","SCRPW18",49,0)
 K SDARY F SDL=1:1 S SD=$P(SDS,U,SDL) Q:SD=""  S SDARY(SD)=""
"RTN","SCRPW18",50,0)
 Q SDS
"RTN","SCRPW18",51,0)
 ;
"RTN","SCRPW18",52,0)
 ;Modules to print the Encounter 'Action Required' Report
"RTN","SCRPW18",53,0)
DET ;Print detail
"RTN","SCRPW18",54,0)
 S SDT(1)="<*>  ENCOUNTER 'ACTION REQUIRED' REPORT  <*>",SDFF=0,SDCG="" F  S SDCG=$O(^TMP("SCRPW",$J,SDIV,1,SDCG)) Q:SDCG=""  D HDR(.SDT,"D") Q:SDOUT  W:SD("FORMAT")="AG" !?2,"Clinic group: ",SDCG D TPRT
"RTN","SCRPW18",55,0)
 Q
"RTN","SCRPW18",56,0)
 ;
"RTN","SCRPW18",57,0)
TPRT S SDCLN="" F  S SDCLN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)) Q:SDCLN=""!SDOUT  D:(SDFF&$G(SD("PAGE"))!($Y>(IOSL-6))) HDR(.SDT,"D") Q:SDOUT  W !!?8,"Clinic: ",SDCLN S SDFF=1 D PPRT
"RTN","SCRPW18",58,0)
 Q
"RTN","SCRPW18",59,0)
 ;
"RTN","SCRPW18",60,0)
PPRT S SDORD="" F  S SDORD=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD)) Q:SDORD=""!SDOUT  S DFN="" F  S DFN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN)) Q:DFN=""!SDOUT  D PP1
"RTN","SCRPW18",61,0)
 Q
"RTN","SCRPW18",62,0)
 ;
"RTN","SCRPW18",63,0)
PP1 S SDPT0=^TMP("SCRPW",$J,SDIV,3,DFN),SDPTNA=$P(SDPT0,U),SDSN=$P(SDPT0,U,3)
"RTN","SCRPW18",64,0)
 S SDOE=0 F  S SDOE=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0) D ETCO,PP2
"RTN","SCRPW18",65,0)
 Q
"RTN","SCRPW18",66,0)
 ;
"RTN","SCRPW18",67,0)
PP2 S SDCT=2,SDI="" F  S SDI=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE,SDI)) Q:SDI=""  S SDCT=SDCT+1
"RTN","SCRPW18",68,0)
 D:$Y>(IOSL-SDCT) HDR(.SDT,"D") Q:SDOUT  W !!,$E(SDPTNA,1,24),?26,SDSN S Y=$P(SDOE0,U) X ^DD("DD") W ?39,$P(Y,":",1,2),?58,SDTY,?81,$E(SDCI,1,25),?107,$E(SDCO,1,25),!,?26,"Status: ",$P($G(^SD(409.63,+$P(SDOE0,U,12),0)),U)
"RTN","SCRPW18",69,0)
 S SDCT=0,SDI="" F  S SDI=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE,SDI)) Q:SDI=""!SDOUT  D
"RTN","SCRPW18",70,0)
 .W ! W:'SDCT ?8,"Required elements:" S SDX=^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE,SDI) W ?27,$$DEF(SDX,104) S SDCT=SDCT+1
"RTN","SCRPW18",71,0)
 .Q
"RTN","SCRPW18",72,0)
 Q
"RTN","SCRPW18",73,0)
 ;
"RTN","SCRPW18",74,0)
ETCO S (SDTY,SDCI,SDCO)="" D:$P(SDOE0,U,8)=1 ETAP D:$P(SDOE0,U,8)=2 ETAE D:$P(SDOE0,U,8)=3 ETDIS Q
"RTN","SCRPW18",75,0)
 ;
"RTN","SCRPW18",76,0)
ETDIS S SDTY="DISPOSITION",SDDIS=$P(SDOE0,U,9),SDDIS=$G(^DPT(DFN,"DIS",+SDDIS,0)),SDCI=$P(SDDIS,U,5),SDCI=$P($G(^VA(200,+SDCI,0)),U),SDCO=$P(SDDIS,U,9),SDCO=$P($G(^VA(200,+SDCO,0)),U) Q
"RTN","SCRPW18",77,0)
 ;
"RTN","SCRPW18",78,0)
ETAP S SDAP0=$G(^DPT(DFN,"S",$P(SDOE0,U),0)) Q:'$L(SDAP0)  S SDCL=$P(SDAP0,U) Q:SDCL'=$P(SDOE0,U,4)
"RTN","SCRPW18",79,0)
 S X=$P(SDAP0,U,7),SDTY=$S(X=3:"SCHEDULED APPOINTMENT",X=4:"UNSCHEDULED VISIT",X=2:"10-10 VISIT",X=1:"C&P APPOINTMENT",1:"")
"RTN","SCRPW18",80,0)
 S SDCLPT=0 F  S SDCLPT=$O(^SC(SDCL,"S",$P(SDOE0,U),1,SDCLPT)) Q:'SDCLPT  Q:$P(^SC(SDCL,"S",$P(SDOE0,U),1,SDCLPT,0),U)=DFN
"RTN","SCRPW18",81,0)
 Q:'SDCLPT  I SDTY["UNSCH" S SDCI=$P(^SC(SDCL,"S",$P(SDOE0,U),1,SDCLPT,0),U,6) S:SDCI SDCI=$P($G(^VA(200,SDCI,0)),U)
"RTN","SCRPW18",82,0)
 S SDCLPTC=$G(^SC(SDCL,"S",$P(SDOE0,U),1,SDCLPT,"C")) Q:'$L(SDCLPTC)  I $P(SDCLPTC,U,2) S SDCI=$P($G(^VA(200,+$P(SDCLPTC,U,2),0)),U)
"RTN","SCRPW18",83,0)
 I $P(SDCLPTC,U,4) S SDCO=$P($G(^VA(200,+$P(SDCLPTC,U,4),0)),U)
"RTN","SCRPW18",84,0)
 Q
"RTN","SCRPW18",85,0)
 ;
"RTN","SCRPW18",86,0)
ETAE S SDTY="ADD/EDIT ENCOUNTER",SDV=$P(SDOE0,U,5),SDCO=$P($G(^AUPNVSIT(+SDV,0)),U,23),SDCO=$P($G(^VA(200,+SDCO,0)),U)
"RTN","SCRPW18",87,0)
 Q
"RTN","SCRPW18",88,0)
 ;
"RTN","SCRPW18",89,0)
T2() Q:SD("FORMAT")="AC" "For all clinics"  Q:SD("FORMAT")="SC" "For selected clinics"
"RTN","SCRPW18",90,0)
 I SD("FORMAT")="RC" N SDC,SDX S SDC=$O(SD("CLINIC","")),SDX="For range of clinics: "_SDC,SDC=$O(SD("CLINIC",SDC)) Q SDX_" to "_SDC
"RTN","SCRPW18",91,0)
 I SD("FORMAT")="SS" N SDX,SDI S SDX="" D  Q SDX
"RTN","SCRPW18",92,0)
 .S SDI=0 F  S SDI=$O(SD("STOPCODE",SDI)) Q:'SDI  S SDX=SDX_", "_SDI
"RTN","SCRPW18",93,0)
 .S SDI=$S($L(SDX,", ")>11:", <more>",1:"")
"RTN","SCRPW18",94,0)
 .S SDX="For selected Stop Codes: "_$P(SDX,", ",2,11)_SDI
"RTN","SCRPW18",95,0)
 .Q
"RTN","SCRPW18",96,0)
 I SD("FORMAT")="RS" N SDX,SDI S SDI=$O(SD("STOPCODE","")),SDX="For range of Stop Codes: "_SDI,SDI=$O(SD("STOPCODE",SDI)) Q SDX_" to "_SDI
"RTN","SCRPW18",97,0)
 Q:SD("FORMAT")="AG" "For all clinic groups"  Q "For clinic group: "_$P(SD("GROUP"),U,2)
"RTN","SCRPW18",98,0)
 ;
"RTN","SCRPW18",99,0)
HD1 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDLINE="",$P(SDLINE,"-",133)="",Y=SD("BDT") X ^DD("DD") S SDBDAY=Y,Y=$P(SD("EDT"),".") X ^DD("DD") S SDEDAY=Y,SDPAGE=1 Q
"RTN","SCRPW18",100,0)
 ;
"RTN","SCRPW18",101,0)
HDR(SDT,SDR) ;Print header
"RTN","SCRPW18",102,0)
 ;Required input: SDT=array of report titles
"RTN","SCRPW18",103,0)
 ;Required input: SDR=report type
"RTN","SCRPW18",104,0)
 D STOP^SCRPW16 Q:SDOUT
"RTN","SCRPW18",105,0)
 I $E(IOST)="C",SDPAGE>1 N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW18",106,0)
 N SDI W:SDPAGE'=1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE S SDI=0 F  S SDI=$O(SDT(SDI)) Q:'SDI  W !?(132-$L(SDT(SDI))\2),SDT(SDI)
"RTN","SCRPW18",107,0)
 W !,SDLINE,!,"For date range: ",SDBDAY," to ",SDEDAY,!,"Date printed: ",SDPNOW,?(126-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1
"RTN","SCRPW18",108,0)
 I SDR="D" W !,"Patient:",?26,"SSN:",?39,"Date/time:",?58,"Type:",?81,"Check-in user:",?107,"Check-out user:",!,SDLINE
"RTN","SCRPW18",109,0)
 Q
"RTN","SCRPW18",110,0)
 ;
"RTN","SCRPW18",111,0)
STAT ;Print statistics
"RTN","SCRPW18",112,0)
 S SDT(1)="<*>  ENCOUNTER 'ACTION REQUIRED' STATISTICS  <*>" D HDR(.SDT,"S") S SDCG="" F  S SDCG=$O(^TMP("SCRPW",$J,SDIV,1,SDCG)) Q:SDCG=""  D ST1
"RTN","SCRPW18",113,0)
 D:$Y>(IOSL-3) HDR(.SDT,"S") W !!?35,$S(SDIV:"DIVISION",1:"TOTAL")," 'ACTION REQUIRED' ENCOUNTERS IDENTIFIED: ",SDFCT(SDIV) Q
"RTN","SCRPW18",114,0)
 ;
"RTN","SCRPW18",115,0)
ST1 I SD("FORMAT")["G" D:$Y>(IOSL-7) HDR(.SDT,"S") S SDX="Clinic group: "_SDCG W !!?(132-$L(SDX)\2),SDX,!
"RTN","SCRPW18",116,0)
 D REASON D:$Y>(IOSL-4) HDR(.SDT,"S") W !!?35,"Clinic:"
"RTN","SCRPW18",117,0)
 S SDCLN="" F  S SDCLN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)) Q:SDCLN=""  D:$Y>(IOSL-2) HDR(.SDT,"S") W !?35,SDCLN,?89,$J(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN),6)
"RTN","SCRPW18",118,0)
 I SD("FORMAT")["G" D:$Y>(IOSL-3) HDR(.SDT,"S") S SDX="Total for clinic group "_SDCG_": "_^TMP("SCRPW",$J,SDIV,1,SDCG) W !!?(132-$L(SDX)\2),SDX,!?35,$E(SDLINE,1,60),!
"RTN","SCRPW18",119,0)
 Q
"RTN","SCRPW18",120,0)
 ;
"RTN","SCRPW18",121,0)
REASON D:$Y>(IOSL-4) HDR(.SDT,"S") W !?35,"Reason:" S SDI=""
"RTN","SCRPW18",122,0)
 F  S SDI=$O(^TMP("SCRPW",$J,SDIV,2,SDCG,SDI)) Q:SDI=""  D:$Y>(IOSL-3) HDR(.SDT,"S") W !?35,$$DEF(SDI,52),?89,$J(^TMP("SCRPW",$J,SDIV,2,SDCG,SDI),6)
"RTN","SCRPW18",123,0)
 W ! Q
"RTN","SCRPW18",124,0)
 ;
"RTN","SCRPW18",125,0)
DEF(SDX,SDL) ;Produce deficiency external value
"RTN","SCRPW18",126,0)
 ;Required input: SDX=error code or value
"RTN","SCRPW18",127,0)
 ;Required input; SDL=maximum length of output string
"RTN","SCRPW18",128,0)
 Q:'$D(^SD(409.76,"B",SDX)) $E(SDX,1,SDL)
"RTN","SCRPW18",129,0)
 N SDERR S SDERR=$$ERRSUB^SCRPW17(SDX) I SDERR'="" Q $E(SDERR,1,SDL)
"RTN","SCRPW18",130,0)
 N SDV S SDV=$P($G(^SD(409.76,+$O(^SD(409.76,"B",SDX,"")),1)),U)
"RTN","SCRPW18",131,0)
 Q $S($L(SDV):$E(SDV,1,SDL),1:$E(SDX,1,SDL))
"RTN","SCRPW50")
0^30^B6421337^B6203052
"RTN","SCRPW50",1,0)
SCRPW50 ;RENO/KEITH - ACRP Data Validation Reports ; 15 Jul 98  4:31 PM
"RTN","SCRPW50",2,0)
 ;;5.3;Scheduling;**144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW50",3,0)
RQUE(SDROU,SDES,SD132) ;Queue data validation reports
"RTN","SCRPW50",4,0)
 ;Required input: SDROU=routine entry point to que
"RTN","SCRPW50",5,0)
 ;Required input: SDES=report name
"RTN","SCRPW50",6,0)
 ;Optional input: SD132='1' to flag for 132 column output
"RTN","SCRPW50",7,0)
 N SD,SDDIV,ZTSAVE D TITL(SDES)
"RTN","SCRPW50",8,0)
 G:'$$DIVA^SCRPW17(.SDDIV) EXIT S SDMD=$O(SDDIV("")),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW50",9,0)
DATE N %DT S %DT="AEPX",%DT(0)="-NOW",%DT("A")="Produce report for Fiscal Year workload through (date): " W ! D ^%DT G:Y<1 EXIT
"RTN","SCRPW50",10,0)
 I Y<2961001 W !!,$C(7),"This date cannot be prior to OCT 1, 1996!" K Y G DATE
"RTN","SCRPW50",11,0)
 S SD("MOD")=$E(Y,1,5)_"00",SD("EDT")=Y_.99,SD("FYD")=$E(Y,1,3)_1001 S:SD("FYD")>SD("EDT") SD("FYD")=SD("FYD")-10000 X ^DD("DD") S SD("PEDT")=Y
"RTN","SCRPW50",12,0)
 F X="SD(","SDDIV","SDDIV(","SDMD" S ZTSAVE(X)=""
"RTN","SCRPW50",13,0)
 I $D(SDSTA) S ZTSAVE("SDSTA")="" ;encounter status
"RTN","SCRPW50",14,0)
 I $G(SD132) W !!,"This report requires 132 column output."
"RTN","SCRPW50",15,0)
 W ! D EN^XUTMDEVQ(SDROU,SDES,.ZTSAVE)
"RTN","SCRPW50",16,0)
EXIT D END K SDMD,SD132,SDROU,SDES,SD,SDDIV,X,Y,%DT,SDX Q
"RTN","SCRPW50",17,0)
 ;
"RTN","SCRPW50",18,0)
XY(X,SDI,SDZ) ;Maintain $X, $Y
"RTN","SCRPW50",19,0)
 ;Required input: X=screen handling variable
"RTN","SCRPW50",20,0)
 ;Optional input: SDI=1 if indirection is needed
"RTN","SCRPW50",21,0)
 ;Optional input: SDZ=0 if $X & $Y are to be zeroed
"RTN","SCRPW50",22,0)
 N DX,DY S DX=$X,DY=$Y S:$G(SDZ)=0 (DX,DY)=0
"RTN","SCRPW50",23,0)
 I $G(SDI),$L(X) W @X X ^%ZOSF("XY") Q ""
"RTN","SCRPW50",24,0)
 W X X ^%ZOSF("XY") Q ""
"RTN","SCRPW50",25,0)
 ;
"RTN","SCRPW50",26,0)
TITL(SDES) ;Display report title
"RTN","SCRPW50",27,0)
 ;Required input: SDES=report descriptive title
"RTN","SCRPW50",28,0)
 N X,SDX
"RTN","SCRPW50",29,0)
 D ENS^%ZISS S X=0 X ^%ZOSF("RM")
"RTN","SCRPW50",30,0)
 I $E(IOST)'="C" W $$XY(IOF,1,0),?(IOM-$L(SDES)\2),SDES,! Q
"RTN","SCRPW50",31,0)
 S:$L(SDES)#1 SDES=SDES_" " S IOTM=3,IOBM=IOSL,SDX="",$P(SDX," ",(80-$L(SDES)\2+1))="",SDX=SDX_SDES_SDX W $$XY(IOF,1,0),$$XY(IORVON),SDX,$$XY(IORVOFF),$$XY(IOSTBM,1),!
"RTN","SCRPW50",32,0)
 Q
"RTN","SCRPW50",33,0)
 ;
"RTN","SCRPW50",34,0)
SUBT(SDX) ;Display subtitle
"RTN","SCRPW50",35,0)
 ;Required input: SDX=subtitle text
"RTN","SCRPW50",36,0)
 W !!?(80-$L(SDX)\2),$$XY(IORVON),SDX,$$XY(IORVOFF) Q
"RTN","SCRPW50",37,0)
 ;
"RTN","SCRPW50",38,0)
END ;Clean up
"RTN","SCRPW50",39,0)
 N X S X=IOM X ^%ZOSF("RM") D DISP0^SCRPW23,KILL^%ZISS K ^TMP("SCRPW",$J) Q
"RTN","SCRPW50",40,0)
 ;
"RTN","SCRPW50",41,0)
PROV(SDOE,SDARY) ;Create array of provider types for an encounter
"RTN","SCRPW50",42,0)
 ;Required input: SDOE=outpatient encounter ifn
"RTN","SCRPW50",43,0)
 ;Required input: SDARY=array to return list (pass by reference)
"RTN","SCRPW50",44,0)
 ;Output:         SDARY(providerifn)=VA code of person class
"RTN","SCRPW50",45,0)
 K SDARY N SDAR1,SDPR,SDPRA,SDI D GETPRV^SDOE(SDOE,"SDPR")
"RTN","SCRPW50",46,0)
 S SDI=0 F  S SDI=$O(SDPR(SDI)) Q:'SDI  S SDPR=$P(SDPR(SDI),U) I SDPR D
"RTN","SCRPW50",47,0)
 .K SDAR1 D ROLE^VAFHLRO3(SDPR,"SDAR1","")
"RTN","SCRPW50",48,0)
 .I $L($G(SDAR1(1))) S SDARY(SDPR)=SDAR1(1)
"RTN","SCRPW50",49,0)
 .Q
"RTN","SCRPW50",50,0)
 Q
"RTN","SCRPW51")
0^6^B27049366^B24998789
"RTN","SCRPW51",1,0)
SCRPW51 ;RENO/KEITH - Encounters by DSS Identifier/DSS ID by Frequency (OP0, OP1, OP2) ; 15 Jul 98  02:38PM
"RTN","SCRPW51",2,0)
 ;;5.3;Scheduling;**144,339,466**;AUG 13, 1993;Build 2
"RTN","SCRPW51",3,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW51",4,0)
 S SDHD1="Encounters by DSS Identifier/DSS ID by Frequency "
"RTN","SCRPW51",5,0)
 S SDHD1=SDHD1_$S(SDSTA=8:"(IP0, IP1, IP2)",1:"(OP0, OP1, OP2)")
"RTN","SCRPW51",6,0)
 D RQUE^SCRPW50("START^SCRPW51",SDHD1) Q
"RTN","SCRPW51",7,0)
 ;
"RTN","SCRPW51",8,0)
START ;Print report
"RTN","SCRPW51",9,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW51",10,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW51",11,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW51",12,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D DLIST,STOP Q:SDOUT  D SUB0 S SDSC="" F  S SDSC=$O(^TMP("SCRPW",$J,SDIV,SDSC)) Q:'SDSC!SDOUT  F SDMF="M","F" D SUBT
"RTN","SCRPW51",13,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  ENCOUNTERS BY DSS IDENTIFIER "_$S(SDSTA=8:"(IP0, IP1, IP2)",1:"(OP0, OP1, OP2)")_"  <*>",SDPG=0 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW51",14,0)
 S SDFY=1700+(100*$E(SD("FYD")))+$E(SD("FYD"),2,3)
"RTN","SCRPW51",15,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." S SDIV=0 D DHDR^SCRPW40(1,.SDTIT),HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT  ;SD*5.3*339 added required input parameters to SCRPW40 call
"RTN","SCRPW51",16,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW51",17,0)
 G:SDOUT EXIT I SDVCT>1 S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW51",18,0)
EXIT G EXIT^SCRPW52
"RTN","SCRPW51",19,0)
 ;
"RTN","SCRPW51",20,0)
SUB0 F SDMF="M","F" D
"RTN","SCRPW51",21,0)
 .S (SDCT,DFN)=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDMF,DFN)) Q:'DFN  S SDCT=SDCT+1
"RTN","SCRPW51",22,0)
 .S ^TMP("SCRPW",$J,SDIV,SDMF,"UNI")=SDCT Q
"RTN","SCRPW51",23,0)
 Q
"RTN","SCRPW51",24,0)
 ;
"RTN","SCRPW51",25,0)
SUBT S (SDUNI,DFN)=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDSC,"SEX",SDMF,DFN)) Q:'DFN  S SDUNI=SDUNI+1
"RTN","SCRPW51",26,0)
 S ^TMP("SCRPW",$J,SDIV,SDSC,"SEX",SDMF,"UNI")=SDUNI
"RTN","SCRPW51",27,0)
 Q
"RTN","SCRPW51",28,0)
 ;
"RTN","SCRPW51",29,0)
DPRT(SDIV) ;Print division
"RTN","SCRPW51",30,0)
 ;Required input: SDIV=division ifn or '0' for combined divisions
"RTN","SCRPW51",31,0)
 D DHDR^SCRPW40(2,.SDTIT) S SDTIT(1)="<*>  ENCOUNTERS BY DSS IDENTIFIER "_$S(SDSTA=8:"(IP0, IP1)",1:"(OP0, 0P1)")_"  <*>"
"RTN","SCRPW51",32,0)
 F SDI=0:1:11 S SDRTOT(SDI)=0
"RTN","SCRPW51",33,0)
 S SDGTOT=0,SDPAGE=1 D HDR,HD1 Q:SDOUT  S SDSC=0 F  S SDSC=$O(^TMP("SCRPW",$J,SDIV,SDSC)) Q:'SDSC!SDOUT  D PLINE
"RTN","SCRPW51",34,0)
 Q:SDOUT  W ! F SDI=1:1:132 W "="
"RTN","SCRPW51",35,0)
 W !,"TOTAL:" F SDYMO=0:1:11 W ?(9+(9*SDYMO)),$J(SDRTOT(SDYMO),7,0)
"RTN","SCRPW51",36,0)
 W ?117,$J(SDGTOT,15,0)
"RTN","SCRPW51",37,0)
 D ^SCRPW52
"RTN","SCRPW51",38,0)
 Q
"RTN","SCRPW51",39,0)
 ;
"RTN","SCRPW51",40,0)
PLINE ;Print output line
"RTN","SCRPW51",41,0)
 Q:'$D(^TMP("SCRPW",$J,SDIV,SDSC,"P"))  N SDYMO
"RTN","SCRPW51",42,0)
 S SDYMO=0 F  S SDYMO=$O(^TMP("SCRPW",$J,SDIV,SDSC,"P","YMO",SDYMO)) Q:'SDYMO  S SDYMO($$MO())=^TMP("SCRPW",$J,SDIV,SDSC,"P","YMO",SDYMO)
"RTN","SCRPW51",43,0)
 D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW51",44,0)
 S SDTCT=0 W !?2,SDSC F SDYMO=0:1:11 D
"RTN","SCRPW51",45,0)
 .S SDCT=+$G(SDYMO(SDYMO)),SDTCT=SDTCT+SDCT,SDRTOT(SDYMO)=SDRTOT(SDYMO)+SDCT,SDGTOT=SDGTOT+SDCT W ?(9+(9*SDYMO)),$J(SDCT,7,0) Q
"RTN","SCRPW51",46,0)
 W ?117,$J(SDTCT,15,0)
"RTN","SCRPW51",47,0)
 Q
"RTN","SCRPW51",48,0)
 ;
"RTN","SCRPW51",49,0)
MO() ;Determine FY month
"RTN","SCRPW51",50,0)
 N X S X=+$E(SDYMO,4,5),X=$S(X>9:$E(X,2),1:X+2) Q X
"RTN","SCRPW51",51,0)
 ;
"RTN","SCRPW51",52,0)
HDR ;Print header
"RTN","SCRPW51",53,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW51",54,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW51",55,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW51",56,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW51",57,0)
 ;
"RTN","SCRPW51",58,0)
HD1 ;Print subheader
"RTN","SCRPW51",59,0)
 Q:SDOUT  W !,"DSS ID",?9 S SDM1=0 F SDMO=10,11,12,"01","02","03","04","05","06","07","08","09" D
"RTN","SCRPW51",60,0)
 .W ?(9+(9*SDM1)),SDMO,"/",$S(SDM1<3:SDFY,1:SDFY+1) S SDM1=SDM1+1 Q
"RTN","SCRPW51",61,0)
 W ?122,"FYTD TOTAL",!,"-------" F SDM1=0:1:11 W ?(9+(9*SDM1)),"-------"
"RTN","SCRPW51",62,0)
 W ?117,"---------------" Q
"RTN","SCRPW51",63,0)
 ;
"RTN","SCRPW51",64,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW51",65,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW51",66,0)
 ;
"RTN","SCRPW51",67,0)
VALID() ;Check encounter record
"RTN","SCRPW51",68,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW51",69,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW51",70,0)
 Q 0
"RTN","SCRPW51",71,0)
 ;
"RTN","SCRPW51",72,0)
DIV() ;Check division
"RTN","SCRPW51",73,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW51",74,0)
 ;
"RTN","SCRPW51",75,0)
STOP ;Check for stop task request
"RTN","SCRPW51",76,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW51",77,0)
 ;
"RTN","SCRPW51",78,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW51",79,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW51",80,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW51",81,0)
 N SDX,SDI,SDPSC,SDSSC
"RTN","SCRPW51",82,0)
 D SCPC^SCRPW25(.SDX) S SDI=$O(SDX("")),SDPSC=$P(SDX(SDI),U) Q:'SDPSC
"RTN","SCRPW51",83,0)
 K SDX D SCSC^SCRPW25(.SDX) S SDI=$O(SDX("")),SDSSC=$P(SDX(SDI),U)
"RTN","SCRPW51",84,0)
 S SDMF=$P($G(^DPT($P(SDOE0,U,2),0)),U,2) I '$L(SDMF)!("MF"'[SDMF) Q
"RTN","SCRPW51",85,0)
 S SDSCN=$P($G(^DIC(40.7,+SDPSC,0)),U,2) D:SDSCN SET1(SDSCN,"P")
"RTN","SCRPW51",86,0)
 S SDSCN=$P($G(^DIC(40.7,+SDSSC,0)),U,2) D:SDSCN SET1(SDSCN,"S")
"RTN","SCRPW51",87,0)
 Q
"RTN","SCRPW51",88,0)
 ;
"RTN","SCRPW51",89,0)
SET1(SDC,SDPS) ;Set TMP global
"RTN","SCRPW51",90,0)
 ;Required input: SDC=stop code AMIS number
"RTN","SCRPW51",91,0)
 ;Optional input: SDPS='P' or 'S' to indicate primary or secondary
"RTN","SCRPW51",92,0)
 S ^TMP("SCRPW",$J,SDIV,SDC,SDPS,"ENC")=$G(^TMP("SCRPW",$J,SDIV,SDC,SDPS,"ENC"))+1
"RTN","SCRPW51",93,0)
 S ^TMP("SCRPW",$J,SDIV,SDC,"SEX",SDMF)=$G(^TMP("SCRPW",$J,SDIV,SDC,"SEX",SDMF))+1
"RTN","SCRPW51",94,0)
 S ^TMP("SCRPW",$J,SDIV,SDC,"SEX",SDMF,$P(SDOE0,U,2))=""
"RTN","SCRPW51",95,0)
 S ^TMP("SCRPW",$J,SDIV,SDMF,$P(SDOE0,U,2))="" Q:SDPS="S"
"RTN","SCRPW51",96,0)
 S ^TMP("SCRPW",$J,SDIV,SDMF,"ENC")=$G(^TMP("SCRPW",$J,SDIV,SDMF,"ENC"))+1
"RTN","SCRPW51",97,0)
 S ^TMP("SCRPW",$J,SDIV,SDC,SDPS,"YMO",+$E(SDOE0,1,5))=$G(^TMP("SCRPW",$J,SDIV,SDC,SDPS,"YMO",+$E(SDOE0,1,5)))+1 Q
"RTN","SCRPW52")
0^20^B6909008^B6700090
"RTN","SCRPW52",1,0)
SCRPW52 ;RENO/KEITH - Encounters by DSS Identifier/DSS ID by Frequency (OP0, OP1, OP2) (cont.) ; 15 Jul 98  02:38PM
"RTN","SCRPW52",2,0)
 ;;5.3;Scheduling;**144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW52",3,0)
 S SDTIT(1)="<*>  DSS ID BY FREQUENCY "_$S(SDSTA=8:"(IP2)",1:"(OP2)")_"  <*>" F SDI=0:1:7 S SDRTOT(SDI)=0
"RTN","SCRPW52",4,0)
 S SDPAGE=1 D HDR,HD1 Q:SDOUT  S SDSC=0 F  S SDSC=$O(^TMP("SCRPW",$J,SDIV,SDSC)) Q:'SDSC!SDOUT  D PLINE
"RTN","SCRPW52",5,0)
 Q:SDOUT  W !?14 F SDI=1:1:103 W "="
"RTN","SCRPW52",6,0)
 S SDRTOT(3)=+$G(^TMP("SCRPW",$J,SDIV,"M","UNI")),SDRTOT(5)=+$G(^TMP("SCRPW",$J,SDIV,"F","UNI")),SDRTOT(7)=SDRTOT(3)+SDRTOT(5),SDRTOT(6)=SDRTOT(0)
"RTN","SCRPW52",7,0)
 S SDRTOT(2)=+$G(^TMP("SCRPW",$J,SDIV,"M","ENC")),SDRTOT(4)=+$G(^TMP("SCRPW",$J,SDIV,"F","ENC"))
"RTN","SCRPW52",8,0)
 W !?14,"TOTAL:" F SDI=0:1:7 W ?(23+(12*SDI)),$J(SDRTOT(SDI),10,0)
"RTN","SCRPW52",9,0)
 Q
"RTN","SCRPW52",10,0)
 ;
"RTN","SCRPW52",11,0)
PLINE ;Print output line
"RTN","SCRPW52",12,0)
 K SDCT S SDCT(0)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"P","ENC"))
"RTN","SCRPW52",13,0)
 S SDCT(1)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"S","ENC"))
"RTN","SCRPW52",14,0)
 S SDCT(2)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"SEX","M"))
"RTN","SCRPW52",15,0)
 S SDCT(3)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"SEX","M","UNI"))
"RTN","SCRPW52",16,0)
 S SDCT(4)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"SEX","F"))
"RTN","SCRPW52",17,0)
 S SDCT(5)=+$G(^TMP("SCRPW",$J,SDIV,SDSC,"SEX","F","UNI"))
"RTN","SCRPW52",18,0)
 S SDCT(6)=SDCT(0)+SDCT(1),SDCT(7)=SDCT(3)+SDCT(5)
"RTN","SCRPW52",19,0)
 F SDI=0,1 S SDRTOT(SDI)=SDRTOT(SDI)+SDCT(SDI)
"RTN","SCRPW52",20,0)
 D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW52",21,0)
 W !?16,SDSC F SDI=0:1:7 W ?(23+(12*SDI)),$J(SDCT(SDI),10,0)
"RTN","SCRPW52",22,0)
 Q
"RTN","SCRPW52",23,0)
 ;
"RTN","SCRPW52",24,0)
HDR D HDR^SCRPW51 Q
"RTN","SCRPW52",25,0)
 ;
"RTN","SCRPW52",26,0)
HD1 ;Print subheader
"RTN","SCRPW52",27,0)
 Q:SDOUT  W !?24,"FREQUENCY",?36,"FREQUENCY",?51,"# MALE",?63,"# MALE",?73,"# FEMALE",?85,"# FEMALE",?100,"TOTAL",?112,"TOTAL"
"RTN","SCRPW52",28,0)
 W !?14,"DSS ID",?23,"AS PRIMARY",?36,"AS CREDIT",?47,"ENCOUNTERS",?62,"UNIQUES",?71,"ENCOUNTERS",?86,"UNIQUES",?95,"ENCOUNTERS",?110,"UNIQUES"
"RTN","SCRPW52",29,0)
 W !?14,"-------" F SDI=0:1:7 W ?(23+(12*SDI)),$E(SDLINE,1,10)
"RTN","SCRPW52",30,0)
 Q
"RTN","SCRPW52",31,0)
 ;
"RTN","SCRPW52",32,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW52",33,0)
 K ^TMP("SCRPW",$J),%,%I,%H,DFN,DIR,SD,SDC,SDCT,SDDIV,SDFY,SDGTOT,SDI,SDIV,SDIVN,SDLINE,SDM1,SDMD,SDMF,SDMO,SDOE,SDOE0,SDOUT,SDPAGE,SDPG
"RTN","SCRPW52",34,0)
 K SDPNOW,SDPS,SDPSC,SDRTOT,SDSC,SDSCN,SDSSC,SDSTOP,SDT,SDTCT,SDTIT,SDUNI,SDIV,SDVCT,SDX,SDYMO,X,Y,SDSTA Q
"RTN","SCRPW54")
0^7^B51348670^B49394786
"RTN","SCRPW54",1,0)
SCRPW54 ;RENO/KEITH - Means Test Summary of Visits & Uniques (OP3, OP4, OP5) or (IP3, IP4, IP5) ; 5/21/01 3:32pm
"RTN","SCRPW54",2,0)
 ;;5.3;Scheduling;**144,258,466**;AUG 13, 1993;Build 2
"RTN","SCRPW54",3,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW54",4,0)
 D RQUE^SCRPW50("START^SCRPW54","Means Test Summary of Visits & Uniques "_$S(SDSTA=8:"(IP3, IP4, IP5)",1:"(OP3, OP4, OP5)"),1) Q
"RTN","SCRPW54",5,0)
 ;
"RTN","SCRPW54",6,0)
START ;Print report
"RTN","SCRPW54",7,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT,DFN)=0
"RTN","SCRPW54",8,0)
 F  S DFN=$O(^SCE("ADFN",DFN)) Q:'DFN!SDOUT  S SDT=SD("FYD") F  S SDT=$O(^SCE("ADFN",DFN,SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("ADFN",DFN,SDT,SDOE)) Q:'SDOE!SDOUT  D
"RTN","SCRPW54",9,0)
 .S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW54",10,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW54",11,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D DLIST,STOP Q:SDOUT  D
"RTN","SCRPW54",12,0)
 .F SDMT="N","C","G","X","AN","AS" D
"RTN","SCRPW54",13,0)
 ..S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDMT,DFN)) Q:'DFN  D
"RTN","SCRPW54",14,0)
 ...S SDT=0 F  S SDT=$O(^TMP("SCRPW",$J,SDIV,SDMT,DFN,SDT)) Q:'SDT  S ^TMP("SCRPW",$J,SDIV,0,DFN,SDT)=SDMT
"RTN","SCRPW54",15,0)
 ...Q
"RTN","SCRPW54",16,0)
 ..Q
"RTN","SCRPW54",17,0)
 .S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,0,DFN)) Q:'DFN  S SDFV=1,SDT="" F  S SDT=$O(^TMP("SCRPW",$J,SDIV,0,DFN,SDT),-1) Q:SDT=""  S SDMT=^TMP("SCRPW",$J,SDIV,0,DFN,SDT) D S1(SDMT) S SDFV=0
"RTN","SCRPW54",18,0)
 .S SDMT=0 F  S SDMT=$O(^TMP("SCRPW",$J,SDIV,SDMT)) Q:SDMT=""  D
"RTN","SCRPW54",19,0)
 ..I '$G(^TMP("SCRPW",$J,SDIV,SDMT,"TOTAL")) S (^TMP("SCRPW",$J,SDIV,SDMT,"TOTAL"),^TMP("SCRPW",$J,SDIV,SDMT,"AVERAGE AGE"))=0 Q
"RTN","SCRPW54",20,0)
 ..S ^TMP("SCRPW",$J,SDIV,SDMT,"AVERAGE AGE")=^TMP("SCRPW",$J,SDIV,SDMT,"AVERAGE AGE")\^TMP("SCRPW",$J,SDIV,SDMT,"TOTAL")
"RTN","SCRPW54",21,0)
 ..Q
"RTN","SCRPW54",22,0)
 .D AA(SDIV) Q
"RTN","SCRPW54",23,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  MEANS TEST SUMMARY OF VISITS & UNIQUES "_$S(SDSTA=8:"(IP3, IP4, IP5)",1:"(OP3, OP4, OP5)")_"  <*>",SDPG=0
"RTN","SCRPW54",24,0)
 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW54",25,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW54",26,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW54",27,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW54",28,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW54",29,0)
 K ^TMP("SCRPW",$J),%,%H,%I,DFN,DIR,SD,SDAGE,SDDIV,SDFAA,SDFTOT,SDFV,SDH,SDI,SDIV,SDIVN,SDLAB,SDLINE,SDLT,SDMD,SDMO,SDMOTO,SDMT,SDOE,SDOE0,SDSTA
"RTN","SCRPW54",30,0)
 K SDPAGE,SDOUT,SDPATE,SDPG,SDPNOW,SDPT0,SDR,SDSC,SDSTOP,SDT,SDTIT,SDTOT,SDV,SDVCT,SDX,SDYR,SDYRTO,X,Y Q
"RTN","SCRPW54",31,0)
 ;
"RTN","SCRPW54",32,0)
AA(SDIV) ;Average age
"RTN","SCRPW54",33,0)
 I '$G(SDFTOT(SDIV)) S (SDFAA(SDIV),SDFTOT(SDIV))=0 Q
"RTN","SCRPW54",34,0)
 S SDFAA(SDIV)=SDFAA(SDIV)\SDFTOT(SDIV) Q
"RTN","SCRPW54",35,0)
 ;
"RTN","SCRPW54",36,0)
DPRT(SDV) ;Print division
"RTN","SCRPW54",37,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW54",38,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW54",39,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW54",40,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW54",41,0)
 .Q
"RTN","SCRPW54",42,0)
 S SDPAGE=1 D HDR,HD1(1) Q:SDOUT  S SDSC=0 D PLINE1(1) Q:SDOUT
"RTN","SCRPW54",43,0)
 W ! D:$Y>(IOSL-8) HDR Q:SDOUT  D HD1(2) D PLINE1(2) Q:SDOUT
"RTN","SCRPW54",44,0)
 W ! D:$Y>(IOSL-8) HDR Q:SDOUT  D HD2
"RTN","SCRPW54",45,0)
 F SDLT="MALE","FEMALE","TOTAL","POW STATUS","AVERAGE AGE","UNDER 24","25 - 34","35 - 44","45 - 54","55 - 64","65 - 74","75 - 84","85 - 94","95 & ABOVE" D PLINE2(SDLT) Q:SDOUT
"RTN","SCRPW54",46,0)
 Q
"RTN","SCRPW54",47,0)
 ;
"RTN","SCRPW54",48,0)
PLINE1(SDH) ;Print output line
"RTN","SCRPW54",49,0)
 ;Required input: SDH=subheader number
"RTN","SCRPW54",50,0)
 S (SDMOTO,SDYRTO)=0
"RTN","SCRPW54",51,0)
 ;D PL("CATEGORY A SERVICE CONNECTED","AS") Q:SDOUT
"RTN","SCRPW54",52,0)
 D PL("SC - MT COPAY EXEMPT","AS") Q:SDOUT
"RTN","SCRPW54",53,0)
 ;D PL("CATEGORY A NON-SERVICE CONNECTED","AN") Q:SDOUT
"RTN","SCRPW54",54,0)
 D PL("NSC - MT COPAY EXEMPT","AN") Q:SDOUT
"RTN","SCRPW54",55,0)
 ;D PL("TOTAL CATEGORY A MEANS TEST","TA") Q:SDOUT
"RTN","SCRPW54",56,0)
 D PL("TOTAL MT COPAY EXEMPT","TA") Q:SDOUT
"RTN","SCRPW54",57,0)
 ;D PL("CATEGORY C","C") Q:SDOUT
"RTN","SCRPW54",58,0)
 D PL("MT COPAY REQUIRED","C") Q:SDOUT
"RTN","SCRPW54",59,0)
 D PL("GMT COPAY REQUIRED","G") Q:SDOUT
"RTN","SCRPW54",60,0)
 D PL("NON VETERAN","N") Q:SDOUT
"RTN","SCRPW54",61,0)
 D PL("NON APPLICABLE","X") Q:SDOUT
"RTN","SCRPW54",62,0)
 S SDX="CURRENT MONTH % OF YEAR TO DATE TOTALS: "_$S('SDYRTO:0,1:SDMOTO*100\SDYRTO)_"%" W !!?(132-$L(SDX)\2),SDX
"RTN","SCRPW54",63,0)
 Q
"RTN","SCRPW54",64,0)
 ;
"RTN","SCRPW54",65,0)
PL(SDLAB,SDMT) ;Print line
"RTN","SCRPW54",66,0)
 I $Y>(IOSL-4) D HDR Q:SDOUT  D HD1(SDH)
"RTN","SCRPW54",67,0)
 S SDMO=+$G(^TMP("SCRPW",$J,SDV,SDMT,$S(SDH=1:"MOVIS",1:"MOTOT")))
"RTN","SCRPW54",68,0)
 S SDYR=+$G(^TMP("SCRPW",$J,SDV,SDMT,$S(SDH=1:"VIS",1:"TOTAL")))
"RTN","SCRPW54",69,0)
 S SDMOTO=SDMOTO+SDMO,SDYRTO=SDYRTO+SDYR
"RTN","SCRPW54",70,0)
 W !?18,$J(SDLAB_":",33),?54,$J(SDMO,9,0),?69,$J(SDLAB_":",33),?105,$J(SDYR,9,0)
"RTN","SCRPW54",71,0)
 Q
"RTN","SCRPW54",72,0)
 ;
"RTN","SCRPW54",73,0)
PLINE2(SDLT) ;Print output line
"RTN","SCRPW54",74,0)
 ;Required input: SDLT=output line tag
"RTN","SCRPW54",75,0)
 I $Y>(IOSL-4) D HDR Q:SDOUT  D HD2
"RTN","SCRPW54",76,0)
 W !?6,$J(SDLT_":",12) S (SDTOT,SDI)=0 F SDMT="AS","AN","TA","C","G","N","X" S SDX=+$G(^TMP("SCRPW",$J,SDV,SDMT,SDLT)) W ?(20+(12*SDI)),$J(SDX,10,0) S SDI=SDI+1 S:SDI'=3 SDTOT=SDTOT+SDX
"RTN","SCRPW54",77,0)
 S:SDLT="AVERAGE AGE" SDTOT=SDFAA(SDV) W ?104,$J(SDTOT,10,0) Q
"RTN","SCRPW54",78,0)
 ;
"RTN","SCRPW54",79,0)
HDR ;Print header
"RTN","SCRPW54",80,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW54",81,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW54",82,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW54",83,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW54",84,0)
 ;
"RTN","SCRPW54",85,0)
HD1(SDR) ;Print subheader
"RTN","SCRPW54",86,0)
 Q:SDOUT  S SDX="**** MEANS TEST VISIT SUMMARY"_$S(SDR=2:" (UNIQUE SSNS BASED ON LATEST VISIT)",1:"")_" ****" W !!?(132-$L(SDX)\2),$E(SDLINE,1,$L(SDX)),!?(132-$L(SDX)\2),SDX,!?(132-$L(SDX)\2),$E(SDLINE,1,$L(SDX))
"RTN","SCRPW54",87,0)
 S SDX="CURRENT MONTH MEANS TEST "_$S(SDR=1:"VISITS",1:"UNIQUES") W !!?18,$J(SDX_":",33),?58,"TOTAL"
"RTN","SCRPW54",88,0)
 S SDX="YEAR TO DATE MEANS TEST "_$S(SDR=1:"VISITS",1:"UNIQUES") W ?69,$J(SDX_":",33),?109,"TOTAL",!?18,$E(SDLINE,1,45),?69,$E(SDLINE,1,45)
"RTN","SCRPW54",89,0)
 Q
"RTN","SCRPW54",90,0)
 ;
"RTN","SCRPW54",91,0)
HD2 ;Print subheader
"RTN","SCRPW54",92,0)
 Q:SDOUT  S SDX="**** MEANS TEST UNIQUES BY GENDER, POW STATUS AND AGE ****" W !!?(132-$L(SDX)\2),$E(SDLINE,1,$L(SDX)),!?(132-$L(SDX)\2),SDX,!?(132-$L(SDX)\2),$E(SDLINE,1,$L(SDX))
"RTN","SCRPW54",93,0)
 W !?24,"SC",?35,"NSC",?45,"TOTAL"
"RTN","SCRPW54",94,0)
 W !?20,"MT COPAY",?32,"MT COPAY",?44,"MT COPAY",?56,"MT COPAY",?68,"GMT COPAY",?87,"NON",?99,"NOT",?109,"GRAND"
"RTN","SCRPW54",95,0)
 W !?10,"UNIQUES:",?21,"EXEMPT",?33,"EXEMPT",?45,"EXEMPT",?56,"REQUIRED",?68,"REQUIRED",?83,"VETERAN",?92,"APPLICABLE",?109,"TOTAL"
"RTN","SCRPW54",96,0)
 W !?6,$E(SDLINE,1,12) F SDI=0:1:7 W ?(20+(12*SDI)),$E(SDLINE,1,10)
"RTN","SCRPW54",97,0)
 Q
"RTN","SCRPW54",98,0)
 ;
"RTN","SCRPW54",99,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW54",100,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="**** UNKNOWN ****" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW54",101,0)
 ;
"RTN","SCRPW54",102,0)
VALID() ;Check encounter record
"RTN","SCRPW54",103,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW54",104,0)
 I SDIV,$$DIV(),$P(SDOE0,U),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA,$P(SDOE0,U,10),$P(SDOE0,U,13) Q 1
"RTN","SCRPW54",105,0)
 Q 0
"RTN","SCRPW54",106,0)
 ;
"RTN","SCRPW54",107,0)
DIV() ;Check division
"RTN","SCRPW54",108,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW54",109,0)
 ;
"RTN","SCRPW54",110,0)
STOP ;Check for stop task request
"RTN","SCRPW54",111,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW54",112,0)
 ;
"RTN","SCRPW54",113,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW54",114,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW54",115,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW54",116,0)
 S SDMT=$$MTI^SCDXUTL0(DFN,$P(SDOE0,U),$P(SDOE0,U,13),$P(SDOE0,U,10),SDOE) Q:SDMT="U"  S ^TMP("SCRPW",$J,SDIV,SDMT,DFN,$P(SDT,"."))=""
"RTN","SCRPW54",117,0)
 Q
"RTN","SCRPW54",118,0)
 ;
"RTN","SCRPW54",119,0)
S1(SDMT) S ^TMP("SCRPW",$J,SDIV,SDMT,"VIS")=$G(^TMP("SCRPW",$J,SDIV,SDMT,"VIS"))+1
"RTN","SCRPW54",120,0)
 S:SDT>SD("MOD") ^TMP("SCRPW",$J,SDIV,SDMT,"MOVIS")=$G(^TMP("SCRPW",$J,SDIV,SDMT,"MOVIS"))+1
"RTN","SCRPW54",121,0)
 D:(SDMT="AN"!(SDMT="AS")) S1("TA") Q:'SDFV
"RTN","SCRPW54",122,0)
 S SDPT0=$G(^DPT(DFN,0)) S SDX=$$SEX()_U_"TOTAL"_U_$$AGE()_$$POW()_$$MOT()
"RTN","SCRPW54",123,0)
 F SDI=1:1:$L(SDX,U) S ^TMP("SCRPW",$J,SDIV,SDMT,$P(SDX,U,SDI))=$G(^TMP("SCRPW",$J,SDIV,SDMT,$P(SDX,U,SDI)))+1
"RTN","SCRPW54",124,0)
 Q
"RTN","SCRPW54",125,0)
 ;
"RTN","SCRPW54",126,0)
MOT() Q $S(SDT>SD("MOD"):"^MOTOT",1:"")
"RTN","SCRPW54",127,0)
 ;
"RTN","SCRPW54",128,0)
SEX() Q $S($P(SDPT0,U,2)="M":"MALE",1:"FEMALE")
"RTN","SCRPW54",129,0)
 ;
"RTN","SCRPW54",130,0)
POW() Q $S($P($G(^DPT(DFN,.52)),U,5)="Y":"^POW STATUS",1:"")
"RTN","SCRPW54",131,0)
 ;
"RTN","SCRPW54",132,0)
AGE() S SDAGE=$P(SDPT0,U,3),SDAGE=$E(SDT,1,3)-$E(SDAGE,1,3)-($E(SDT,4,7)<$E(SDAGE,4,7)),^TMP("SCRPW",$J,SDIV,SDMT,"AVERAGE AGE")=$G(^TMP("SCRPW",$J,SDIV,SDMT,"AVERAGE AGE"))+SDAGE
"RTN","SCRPW54",133,0)
 I SDMT'="TA" S SDFAA(SDIV)=$G(SDFAA(SDIV))+SDAGE,SDFTOT(SDIV)=$G(SDFTOT(SDIV))+1
"RTN","SCRPW54",134,0)
 Q $S(SDAGE<25:"UNDER 24",SDAGE<35:"25 - 34",SDAGE<45:"35 - 44",SDAGE<55:"45 - 54",SDAGE<65:"55 - 64",SDAGE<75:"65 - 74",SDAGE<85:"75 - 84",SDAGE<95:"85 - 94",1:"95 & ABOVE")
"RTN","SCRPW56")
0^8^B23791675^B22562832
"RTN","SCRPW56",1,0)
SCRPW56 ;RENO/KEITH - Most Frequent 50 CPT Codes (OP6) or (IP6) ;06/22/99
"RTN","SCRPW56",2,0)
 ;;5.3;Scheduling;**144,180,466**;AUG 13, 1993;Build 2
"RTN","SCRPW56",3,0)
 ;06/22/99 ACS - Added CPT modifier API calls
"RTN","SCRPW56",4,0)
 ;
"RTN","SCRPW56",5,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW56",6,0)
 D RQUE^SCRPW50("START^SCRPW56","Most Frequent 50 CPT Codes "_$S(SDSTA=2:"(OP6)",1:"(IP6)"),1) Q
"RTN","SCRPW56",7,0)
 ;
"RTN","SCRPW56",8,0)
START ;Print report
"RTN","SCRPW56",9,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW56",10,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW56",11,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW56",12,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""!SDOUT  D STOP,DLIST S SDCPT="" F  S SDCPT=$O(^TMP("SCRPW",$J,SDIV,0,SDCPT)) Q:SDCPT=""!SDOUT  S SDI=^TMP("SCRPW",$J,SDIV,0,SDCPT),^TMP("SCRPW",$J,SDIV,1,SDI,SDCPT)=""
"RTN","SCRPW56",13,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  MOST FREQUENT 50 CPT CODES "_$S(SDSTA=2:"(OP6)",1:"(IP6)")_"  <*>",SDPG=0 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW56",14,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW56",15,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW56",16,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW56",17,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW56",18,0)
 K ^TMP("SCRPW",$J),%,%H,%I,DIR,SD,SDCPT,SDDIV,SDFL,SDI,SDII,SDIII,SDIV,SDIVN,SDLINE,SDMD,SDOE,SDOE0,SDOUT,SDPAGE,SDPG,SDPNOW,SDPROC,SDPRTY,SDPT,SDPTN,SDQTY,SDSTOP,SDT,SDTIT,SDV,SDVCT,SDX,X,Y Q
"RTN","SCRPW56",19,0)
 ;
"RTN","SCRPW56",20,0)
DPRT(SDV) ;Print division
"RTN","SCRPW56",21,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW56",22,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW56",23,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW56",24,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW56",25,0)
 .Q
"RTN","SCRPW56",26,0)
 S SDPAGE=1 D HDR Q:SDOUT  S (SDI,SDII)="" F  S SDI=$O(^TMP("SCRPW",$J,SDV,1,SDI),-1) Q:SDI=""!SDOUT!(SDII>49)  S SDCPT="" F  S SDCPT=$O(^TMP("SCRPW",$J,SDV,1,SDI,SDCPT)) Q:SDCPT=""!SDOUT!(SDII>49)  D PLINE
"RTN","SCRPW56",27,0)
 Q
"RTN","SCRPW56",28,0)
 ;
"RTN","SCRPW56",29,0)
PLINE ;Print output line
"RTN","SCRPW56",30,0)
 D:$Y>(IOSL-8) HDR Q:SDOUT  D HD1
"RTN","SCRPW56",31,0)
 ;S SDPROC=$G(^ICPT(SDCPT,0)),SDPROC=$P(SDPROC,U)_"  "_$P(SDPROC,U,2),SDII=SDII+1
"RTN","SCRPW56",32,0)
 N CPTINFO,CPTCODE,CPTTEXT
"RTN","SCRPW56",33,0)
 S CPTINFO=$$CPT^ICPTCOD(SDCPT,,1)
"RTN","SCRPW56",34,0)
 Q:CPTINFO'>0
"RTN","SCRPW56",35,0)
 S CPTCODE=$P(CPTINFO,"^",2)
"RTN","SCRPW56",36,0)
 S CPTTEXT=$P(CPTINFO,"^",3)
"RTN","SCRPW56",37,0)
 S SDPROC=CPTCODE_" "_CPTTEXT
"RTN","SCRPW56",38,0)
 S SDII=SDII+1
"RTN","SCRPW56",39,0)
 W !?7,$J(SDII,3),?13,SDPROC,?50,$J(SDI,10,0) D  W !
"RTN","SCRPW56",40,0)
 .S (SDFL,SDPT)="" F  S SDPT=$O(^TMP("SCRPW",$J,SDV,0,SDCPT,SDPT)) Q:SDPT=""!SDOUT  D
"RTN","SCRPW56",41,0)
 ..I $Y>(IOSL-3) D HDR,HD1 Q:SDOUT  S SDFL=1
"RTN","SCRPW56",42,0)
 ..S SDPTN=$$CODE2TXT^XUA4A72(SDPT),SDPTN=$P(SDPT,"V",2)_"  "_$P(SDPTN,U,2)
"RTN","SCRPW56",43,0)
 ..W:SDFL ! W ?62,$E(SDPTN,1,50),?114,$J(^TMP("SCRPW",$J,SDV,0,SDCPT,SDPT),10,0) S SDFL=SDFL+1
"RTN","SCRPW56",44,0)
 ..Q
"RTN","SCRPW56",45,0)
 .Q
"RTN","SCRPW56",46,0)
 Q
"RTN","SCRPW56",47,0)
 ;
"RTN","SCRPW56",48,0)
HDR ;Print header
"RTN","SCRPW56",49,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW56",50,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW56",51,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW56",52,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW56",53,0)
 ;
"RTN","SCRPW56",54,0)
HD1 ;Print subheader
"RTN","SCRPW56",55,0)
 Q:SDOUT  W !?52,"CPT Code",?114,"Prov. Type",!?7,"Rank",?13,"CPT Code",?51,"Frequency",?62,"Provider Type",?115,"Frequency"
"RTN","SCRPW56",56,0)
 W !?7,"----",?13,$E(SDLINE,1,35),?50,$E(SDLINE,1,10),?62,$E(SDLINE,1,50),?114,$E(SDLINE,1,10) Q
"RTN","SCRPW56",57,0)
 ;
"RTN","SCRPW56",58,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW56",59,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW56",60,0)
 ;
"RTN","SCRPW56",61,0)
VALID() ;Check encounter record
"RTN","SCRPW56",62,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW56",63,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW56",64,0)
 Q 0
"RTN","SCRPW56",65,0)
 ;
"RTN","SCRPW56",66,0)
DIV() ;Check division
"RTN","SCRPW56",67,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW56",68,0)
 ;
"RTN","SCRPW56",69,0)
STOP ;Check for stop task request
"RTN","SCRPW56",70,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW56",71,0)
 ;
"RTN","SCRPW56",72,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW56",73,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW56",74,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW56",75,0)
 N SDPROC,SDPRTY,SDI,SDII,SDIII,SDX
"RTN","SCRPW56",76,0)
 D GETCPT^SDOE(SDOE,"SDPROC"),PROV^SCRPW50(SDOE,.SDPRTY)
"RTN","SCRPW56",77,0)
 S SDI=0 F  S SDI=$O(SDPROC(SDI)) Q:'SDI  S SDCPT=$P(SDPROC(SDI),U),SDQTY=$P(SDPROC(SDI),U,16) S:'SDQTY SDQTY=1 I SDCPT D
"RTN","SCRPW56",78,0)
 .S ^TMP("SCRPW",$J,SDIV,0,SDCPT)=$G(^TMP("SCRPW",$J,SDIV,0,SDCPT))+SDQTY
"RTN","SCRPW56",79,0)
 .S SDII=0 F  S SDII=$O(SDPRTY(SDII)) Q:'SDII  S SDX=SDPRTY(SDII) I $L(SDX) D
"RTN","SCRPW56",80,0)
 ..S ^TMP("SCRPW",$J,SDIV,0,SDCPT,SDX)=$G(^TMP("SCRPW",$J,SDIV,0,SDCPT,SDX))+1
"RTN","SCRPW56",81,0)
 ..Q
"RTN","SCRPW56",82,0)
 .Q
"RTN","SCRPW56",83,0)
 Q
"RTN","SCRPW57")
0^9^B28798675^B27385265
"RTN","SCRPW57",1,0)
SCRPW57 ;RENO/KEITH - Most Frequent 50 ICD-9-CM Codes (OP7) or (IP7) ; 5/6/03 1:18pm
"RTN","SCRPW57",2,0)
 ;;5.3;Scheduling;**144,295,466**;AUG 13, 1993;Build 2
"RTN","SCRPW57",3,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW57",4,0)
 D RQUE^SCRPW50("START^SCRPW57","Most Frequent 50 ICD-9-CM Codes "_$S(SDSTA=2:"(OP7)",1:"(IP7)"),1) Q
"RTN","SCRPW57",5,0)
 ;
"RTN","SCRPW57",6,0)
START ;Print report
"RTN","SCRPW57",7,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW57",8,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW57",9,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW57",10,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP,DLIST Q:SDOUT  D
"RTN","SCRPW57",11,0)
 .S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN)) Q:'DFN  D
"RTN","SCRPW57",12,0)
 ..S SDDX=0 F  S SDDX=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX)) Q:'SDDX  S SDPT="" F  S SDPT=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDPT)) Q:SDPT=""  D
"RTN","SCRPW57",13,0)
 ...S $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT),U,2)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT)),U,2)+1
"RTN","SCRPW57",14,0)
 ...S:$D(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDPT,"P")) $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT),U)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT)),U)+1
"RTN","SCRPW57",15,0)
 ...Q
"RTN","SCRPW57",16,0)
 ..Q
"RTN","SCRPW57",17,0)
 .S SDDX=0 F  S SDDX=$O(^TMP("SCRPW",$J,SDIV,0,SDDX)) Q:'SDDX  S SDI=^TMP("SCRPW",$J,SDIV,0,SDDX),^TMP("SCRPW",$J,SDIV,1,SDI,SDDX)=""
"RTN","SCRPW57",18,0)
 .Q
"RTN","SCRPW57",19,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  MOST FREQUENT 50 ICD-9-CM CODES "_$S(SDSTA=2:"(OP7)",1:"(IP7)")_"  <*>",SDPG=0 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW57",20,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW57",21,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW57",22,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW57",23,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW57",24,0)
 K ^TMP("SCRPW",$J),%,%H,%I,DIR,DFN,SD,SDDX,SDDXP,SDDIV,SDFL,SDI,SDII,SDIII,SDIV,SDIVN,SDLINE,SDMD,SDOE,SDOE0,SDOUT,SDPAGE,SDPG,SDPNOW,SDDIAG,SDPRTY,SDPT,SDPTN,SDPTV,SDSTOP,SDT,SDTIT,SDV,SDVCT,SDX,X,Y,SDSTA Q
"RTN","SCRPW57",25,0)
 ;
"RTN","SCRPW57",26,0)
DPRT(SDV) ;Print division
"RTN","SCRPW57",27,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW57",28,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW57",29,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW57",30,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW57",31,0)
 .Q
"RTN","SCRPW57",32,0)
 S SDPAGE=1 D HDR Q:SDOUT  S (SDI,SDII)="" F  S SDI=$O(^TMP("SCRPW",$J,SDV,1,SDI),-1) Q:SDI=""!SDOUT!(SDII>49)  S SDDX="" F  S SDDX=$O(^TMP("SCRPW",$J,SDV,1,SDI,SDDX)) Q:SDDX=""!SDOUT!(SDII>49)  D PLINE
"RTN","SCRPW57",33,0)
 Q
"RTN","SCRPW57",34,0)
 ;
"RTN","SCRPW57",35,0)
PLINE ;Print output line
"RTN","SCRPW57",36,0)
 D:$Y>(IOSL-8) HDR Q:SDOUT  D HD1
"RTN","SCRPW57",37,0)
 ;S SDDIAG=$G(^ICD9(SDDX,0)),SDDIAG=$P(SDDIAG,U)_"  "_$P(SDDIAG,U,3),SDII=SDII+1
"RTN","SCRPW57",38,0)
 S SDDIAG=$$ICDDX^ICDCODE(SDDX,,,1),SDDIAG=$P(SDDIAG,U,2)_"  "_$P(SDDIAG,U,4),SDII=SDII+1
"RTN","SCRPW57",39,0)
 W !,$J(SDII,3),?6,$E(SDDIAG,1,38) D  W !
"RTN","SCRPW57",40,0)
 .S (SDFL,SDPT)="" F  S SDPT=$O(^TMP("SCRPW",$J,SDV,0,SDDX,SDPT)) Q:SDPT=""!SDOUT  D
"RTN","SCRPW57",41,0)
 ..I $Y>(IOSL-3) D HDR,HD1 Q:SDOUT  S SDFL=1
"RTN","SCRPW57",42,0)
 ..S SDPTV=^TMP("SCRPW",$J,SDV,0,SDDX,SDPT)
"RTN","SCRPW57",43,0)
 ..S SDPTN=$$CODE2TXT^XUA4A72(SDPT),SDPTN=$P(SDPT,"V",2)_"  "_$P(SDPTN,U,2)
"RTN","SCRPW57",44,0)
 ..W:SDFL ! W ?46,$E(SDPTN,1,38) D  S SDFL=SDFL+1
"RTN","SCRPW57",45,0)
 ...F SDIII=1:1:4 W ?(86+(12*(SDIII-1))),$J($P(SDPTV,U,SDIII),10,0)
"RTN","SCRPW57",46,0)
 ..Q
"RTN","SCRPW57",47,0)
 .Q
"RTN","SCRPW57",48,0)
 Q
"RTN","SCRPW57",49,0)
 ;
"RTN","SCRPW57",50,0)
HDR ;Print header
"RTN","SCRPW57",51,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW57",52,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW57",53,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW57",54,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW57",55,0)
 ;
"RTN","SCRPW57",56,0)
HD1 ;Print subheader
"RTN","SCRPW57",57,0)
 Q:SDOUT  W !?87,"Prim. Dx.",?103,"Total",?111,"Prim. Dx.",?127,"Total",!,"Rank  IDC-9-DM Diagnosis code",?48,"Provider Type",?89,"Uniques",?101,"Uniques",?110,"Encounters",?122,"Encounters"
"RTN","SCRPW57",58,0)
 N SDI W !,"----",?6,$E(SDLINE,1,38),?46,$E(SDLINE,1,38) F SDI=0:1:3 W ?(86+(12*SDI)),$E(SDLINE,1,10)
"RTN","SCRPW57",59,0)
 Q
"RTN","SCRPW57",60,0)
 ;
"RTN","SCRPW57",61,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW57",62,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW57",63,0)
 ;
"RTN","SCRPW57",64,0)
VALID() ;Check encounter record
"RTN","SCRPW57",65,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW57",66,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW57",67,0)
 Q 0
"RTN","SCRPW57",68,0)
 ;
"RTN","SCRPW57",69,0)
DIV() ;Check division
"RTN","SCRPW57",70,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW57",71,0)
 ;
"RTN","SCRPW57",72,0)
STOP ;Check for stop task request
"RTN","SCRPW57",73,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW57",74,0)
 ;
"RTN","SCRPW57",75,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW57",76,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW57",77,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW57",78,0)
 N SDDIAG,SDPRTY,SDI,SDII,SDIII,SDX S DFN=$P(SDOE0,U,2)
"RTN","SCRPW57",79,0)
 D GETDX^SDOE(SDOE,"SDDIAG"),PROV^SCRPW50(SDOE,.SDPRTY)
"RTN","SCRPW57",80,0)
 S SDI=0 F  S SDI=$O(SDDIAG(SDI)) Q:'SDI  S SDDX=$P(SDDIAG(SDI),U),SDDXP=$S($P(SDDIAG(SDI),U,12)="P":"P",1:"S") I SDDX D
"RTN","SCRPW57",81,0)
 .S ^TMP("SCRPW",$J,SDIV,0,SDDX)=$G(^TMP("SCRPW",$J,SDIV,0,SDDX))+1
"RTN","SCRPW57",82,0)
 .S SDII=0 F  S SDII=$O(SDPRTY(SDII)) Q:'SDII  S SDX=SDPRTY(SDII) I $L(SDX) D
"RTN","SCRPW57",83,0)
 ..S $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX),U,4)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX)),U,4)+1 D
"RTN","SCRPW57",84,0)
 ...S:SDDXP="P" $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX),U,3)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX)),U,3)+1
"RTN","SCRPW57",85,0)
 ...S ^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDX,SDDXP)=""
"RTN","SCRPW57",86,0)
 ...Q
"RTN","SCRPW57",87,0)
 ..Q
"RTN","SCRPW57",88,0)
 .Q
"RTN","SCRPW57",89,0)
 Q
"RTN","SCRPW58")
0^10^B18449848^B17236734
"RTN","SCRPW58",1,0)
SCRPW58 ;RENO/KEITH - Most Frequent 20 Practitioner Types (OP8) or (IP8); 15 Jul 98  8:28 PM
"RTN","SCRPW58",2,0)
 ;;5.3;Scheduling;**144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW58",3,0)
 ;Most Frequent 20 Practitioner Types (OP8) or (IP8)
"RTN","SCRPW58",4,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW58",5,0)
 D RQUE^SCRPW50("START^SCRPW58","Most Frequent 20 Practitioner Types "_$S(SDSTA=2:"(OP8)",1:"(IP8)"),1) Q
"RTN","SCRPW58",6,0)
 ;
"RTN","SCRPW58",7,0)
START ;Print report
"RTN","SCRPW58",8,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW58",9,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW58",10,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW58",11,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""!SDOUT  D STOP,DLIST S SDX="" F  S SDX=$O(^TMP("SCRPW",$J,SDIV,0,SDX)) Q:SDX=""!SDOUT  S SDI=^TMP("SCRPW",$J,SDIV,0,SDX),^TMP("SCRPW",$J,SDIV,1,SDI,SDX)=""
"RTN","SCRPW58",12,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  MOST FREQUENT 20 PRACTITIONER TYPES "_$S(SDSTA=2:"(OP8)",1:"(IP8)")_"  <*>",SDPG=0 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW58",13,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW58",14,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW58",15,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW58",16,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW58",17,0)
 K ^TMP("SCRPW",$J),%,%H,%I,DIR,SD,SDARY,SDCD,SDDIV,SDI,SDII,SDIV,SDIVN,SDLINE,SDMD,SDOE,SDOE0,SDOUT,SDPAGE,SDPC,SDPG,SDPNOW,SDSPE,SDSTOP,SDSUB,SDT,SDTIT,SDV,SDVCT,SDX,X,Y,SDSTA Q
"RTN","SCRPW58",18,0)
 ;
"RTN","SCRPW58",19,0)
DPRT(SDV) ;Print division
"RTN","SCRPW58",20,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW58",21,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW58",22,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW58",23,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW58",24,0)
 .Q
"RTN","SCRPW58",25,0)
 S SDPAGE=1 D HDR,HD1 Q:SDOUT  S (SDI,SDII)="" F  S SDI=$O(^TMP("SCRPW",$J,SDV,1,SDI),-1) Q:SDI=""!SDOUT!(SDII>19)  S SDX="" F  S SDX=$O(^TMP("SCRPW",$J,SDV,1,SDI,SDX)) Q:SDX=""!SDOUT!(SDII>19)  D PLINE
"RTN","SCRPW58",26,0)
 Q
"RTN","SCRPW58",27,0)
 ;
"RTN","SCRPW58",28,0)
PLINE ;Print output line
"RTN","SCRPW58",29,0)
 D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW58",30,0)
 S SDPC=$$CODE2TXT^XUA4A72(SDX) Q:'$L(SDPC)
"RTN","SCRPW58",31,0)
 S SDCD=+$P(SDX,"V",2),SDSPE=$P(SDPC,U,2),SDSUB=$P(SDPC,U,3),SDII=SDII+1
"RTN","SCRPW58",32,0)
 W !,$J(SDII,3,0),?6,$J(SDCD,7,0),?15,$E(SDSPE,1,51),?68,$E(SDSUB,1,52),?122,$J(SDI,10,0)
"RTN","SCRPW58",33,0)
 Q
"RTN","SCRPW58",34,0)
 ;
"RTN","SCRPW58",35,0)
HDR ;Print header
"RTN","SCRPW58",36,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW58",37,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW58",38,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW58",39,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW58",40,0)
 ;
"RTN","SCRPW58",41,0)
HD1 ;Print subheader
"RTN","SCRPW58",42,0)
 Q:SDOUT  W !,"Rank",?6,"VA Code",?15,"Specialty",?68,"Subspecialty",?123,"Frequency",!,"----  -------  ",$E(SDLINE,1,51),?68,$E(SDLINE,1,52),?122,"----------" Q
"RTN","SCRPW58",43,0)
 ;
"RTN","SCRPW58",44,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW58",45,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW58",46,0)
 ;
"RTN","SCRPW58",47,0)
VALID() ;Check encounter record
"RTN","SCRPW58",48,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW58",49,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW58",50,0)
 Q 0
"RTN","SCRPW58",51,0)
 ;
"RTN","SCRPW58",52,0)
DIV() ;Check division
"RTN","SCRPW58",53,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW58",54,0)
 ;
"RTN","SCRPW58",55,0)
STOP ;Check for stop task request
"RTN","SCRPW58",56,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW58",57,0)
 ;
"RTN","SCRPW58",58,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW58",59,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW58",60,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW58",61,0)
 N SDARY,SDI,SDX
"RTN","SCRPW58",62,0)
 D PROV^SCRPW50(SDOE,.SDARY)
"RTN","SCRPW58",63,0)
 S SDI=0 F  S SDI=$O(SDARY(SDI)) Q:'SDI  S SDX=SDARY(SDI) I $L(SDX) D
"RTN","SCRPW58",64,0)
 .S ^TMP("SCRPW",$J,SDIV,0,SDX)=$G(^TMP("SCRPW",$J,SDIV,0,SDX))+1
"RTN","SCRPW58",65,0)
 .Q
"RTN","SCRPW58",66,0)
 Q
"RTN","SCRPW59")
0^11^B19196477^B17981900
"RTN","SCRPW59",1,0)
SCRPW59 ;RENO/KEITH - Visits and Unique SSNs by County (OP9) or (IP9) ; 15 Jul 98  02:38PM
"RTN","SCRPW59",2,0)
 ;;5.3;Scheduling;**144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW59",3,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW59",4,0)
 D RQUE^SCRPW50("START^SCRPW59","Visits and Unique SSNs by County "_$S(SDSTA=2:"(OP9)",1:"(IP9)")) Q
"RTN","SCRPW59",5,0)
 ;
"RTN","SCRPW59",6,0)
START ;Print report
"RTN","SCRPW59",7,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW59",8,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW59",9,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  VISITS AND UNIQUE SSNS BY COUNTY "_$S(SDSTA=2:"(OP9)",1:"(IP9)")_"  <*>",SDPG=0,C=(IOM-80\2) D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW59",10,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW59",11,0)
 S (SDVCT,SDIV)="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""!SDOUT  D STOP D DLIST S SDX="" F  S SDX=$O(^TMP("SCRPW",$J,SDIV,SDX)) Q:SDX=""!SDOUT  D SUBT
"RTN","SCRPW59",12,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW59",13,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW59",14,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW59",15,0)
 K ^TMP("SCRPW",$J),%,%H,%I,C,DFN,DIR,SD,SDDIV,SDE,SDI,SDIV,SDIVN,SDLINE,SDMD,SDOE,SDOE0,SDOUT,SDPAGE,SDPG,SDPNOW,SDSTOP,SDT,SDTIT,SDU,SDV,SDVCT,SDX,SDY,X,Y,SDSTA Q
"RTN","SCRPW59",16,0)
 ;
"RTN","SCRPW59",17,0)
DPRT(SDV) ;Print division
"RTN","SCRPW59",18,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW59",19,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW59",20,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW59",21,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW59",22,0)
 .Q
"RTN","SCRPW59",23,0)
 S SDPAGE=1 D HDR,HD1 Q:SDOUT  S SDX="" F  S SDX=$O(^TMP("SCRPW",$J,SDV,SDX)) Q:SDX=""!SDOUT  S SDY=^TMP("SCRPW",$J,SDV,SDX,"STAT") D PLINE
"RTN","SCRPW59",24,0)
 Q
"RTN","SCRPW59",25,0)
PLINE ;Print output line
"RTN","SCRPW59",26,0)
 D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW59",27,0)
 W !?(C),$E($P(SDX," / ",2),1,22),?(C+24),$E($P(SDX," / "),1,20) F SDI=0:1:2 W ?(C+46+(12*SDI)),$J($P(SDY,U,(SDI+1)),10,0)
"RTN","SCRPW59",28,0)
 Q
"RTN","SCRPW59",29,0)
 ;
"RTN","SCRPW59",30,0)
HDR ;Print header
"RTN","SCRPW59",31,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW59",32,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW59",33,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW59",34,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW59",35,0)
 ;
"RTN","SCRPW59",36,0)
HD1 ;Print subheader
"RTN","SCRPW59",37,0)
 Q:SDOUT  W !?(C),"County",?(C+24),"State",?(C+50),"Visits",?(C+58),"Encounters",?(C+73),"Uniques",!?(C),$E(SDLINE,1,22),?(C+24),$E(SDLINE,1,20),?(C+46),$E(SDLINE,1,10),?(C+58),$E(SDLINE,1,10),?(C+70),$E(SDLINE,1,10) Q
"RTN","SCRPW59",38,0)
 ;
"RTN","SCRPW59",39,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW59",40,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW59",41,0)
 ;
"RTN","SCRPW59",42,0)
SUBT ;Count uniques and visits
"RTN","SCRPW59",43,0)
 S (SDU,SDV,DFN)=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDX,DFN)) Q:'DFN  S SDU=SDU+1,SDT=0 F  S SDT=$O(^TMP("SCRPW",$J,SDIV,SDX,DFN,SDT)) Q:'SDT  S SDV=SDV+1
"RTN","SCRPW59",44,0)
 S SDE=^TMP("SCRPW",$J,SDIV,SDX,"STAT"),^TMP("SCRPW",$J,SDIV,SDX,"STAT")=SDV_U_SDE_U_SDU
"RTN","SCRPW59",45,0)
 Q
"RTN","SCRPW59",46,0)
 ;
"RTN","SCRPW59",47,0)
VALID() ;Check encounter record
"RTN","SCRPW59",48,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW59",49,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW59",50,0)
 Q 0
"RTN","SCRPW59",51,0)
 ;
"RTN","SCRPW59",52,0)
DIV() ;Check division
"RTN","SCRPW59",53,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW59",54,0)
 ;
"RTN","SCRPW59",55,0)
STOP ;Check for stop task request
"RTN","SCRPW59",56,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW59",57,0)
 ;
"RTN","SCRPW59",58,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW59",59,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW59",60,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW59",61,0)
 K SDX D PDSC^SCRPW24(.SDX) S SDX=$O(SDX("")),SDX=$P(SDX(SDX),U,2)
"RTN","SCRPW59",62,0)
 S ^TMP("SCRPW",$J,SDIV,SDX,"STAT")=$G(^TMP("SCRPW",$J,SDIV,SDX,"STAT"))+1,^TMP("SCRPW",$J,SDIV,SDX,$P(SDOE0,U,2),$P(SDT,"."))=""
"RTN","SCRPW59",63,0)
 Q
"RTN","SCRPW6")
0^19^B35810056^B29883909
"RTN","SCRPW6",1,0)
SCRPW6 ;RENO/KEITH - Trend of Facility Uniques by 12 Month Date Ranges ; 15 Jul 98  02:38PM
"RTN","SCRPW6",2,0)
 ;;5.3;Scheduling;**139,144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW6",3,0)
 N SDDIV,SDI,SDSTA,DIR D TITL^SCRPW50("Trend of Facility Uniques by 12 Month Date Ranges") G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW6",4,0)
 D SUBT^SCRPW50("**** Status Selection ****")
"RTN","SCRPW6",5,0)
 S DIR(0)="S^1:Checked Out (Outpatients);2:Checked Out (Inpatients);3:Checked Out (Out/Inpatients)",DIR("A")="Select Status",DIR("B")="1"
"RTN","SCRPW6",6,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!(+Y<0) G EXIT
"RTN","SCRPW6",7,0)
 S SDSTA=$S(Y=1:2,Y=2:8,1:"2^8")
"RTN","SCRPW6",8,0)
QUE W !!,"This report requires 132 column output.",!
"RTN","SCRPW6",9,0)
 N ZTSAVE F X="SDDIV","SDDIV(","SDDNU(",SDSTA S ZTSAVE(X)=""
"RTN","SCRPW6",10,0)
 D EN^XUTMDEVQ("UNIQ^SCRPW6","Trend Facility Uniques",.ZTSAVE),DISP0^SCRPW23 Q
"RTN","SCRPW6",11,0)
UNIQ ;Calculate/print uniques
"RTN","SCRPW6",12,0)
 S (SDOUT,SDSTOP)=0,SDLINE="",SDPAGE=1,$P(SDLINE,"-",133)="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDMD=$O(SDDIV(0)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW6",13,0)
 K ^TMP("SCRPW",$J) S SDBDT=$E(DT,1,3)-5_$E(DT,4,5)_"00",SDEDT=$E(DT,1,5)_"00",SDXEDT=$E(DT,1,3)-1_$E(DT,4,5)_"00" D OENC G:SDOUT EXIT
"RTN","SCRPW6",14,0)
 S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP Q:SDOUT  D
"RTN","SCRPW6",15,0)
 .S SDDT=SDBDT,SDXDT=$$YDTINC(SDDT),^TMP("SCRPW",$J,SDIV,"YR","MAX")=0 D LOOK
"RTN","SCRPW6",16,0)
 .F  S SDDT=$$DTINC(SDDT) Q:SDDT>SDXEDT  S SDXDT=$$YDTINC(SDDT) D LOOK I ^TMP("SCRPW",$J,SDIV,"YR",SDDT)>^TMP("SCRPW",$J,SDIV,"YR","MAX") S ^TMP("SCRPW",$J,SDIV,"YR","MAX")=^TMP("SCRPW",$J,SDIV,"YR",SDDT)
"RTN","SCRPW6",17,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23 I '$D(^TMP("SCRPW",$J)) D HDR G:SDOUT EXIT S SDX="No activity found within selected report parameters!" W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW6",18,0)
 I $P(SDDIV,U,2)="SELECTED DIVISIONS" D
"RTN","SCRPW6",19,0)
 .S SDI=0 F  S SDI=$O(SDDIV(SDI)) Q:'SDI  S SDIV(SDDIV(SDI))=SDI
"RTN","SCRPW6",20,0)
 .Q
"RTN","SCRPW6",21,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW6",22,0)
 .S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:'$L(SDX) SDX="***UNKNOWN***" S SDIV(SDX)=SDI
"RTN","SCRPW6",23,0)
 .Q
"RTN","SCRPW6",24,0)
 S:$D(SDIV)'>1 SDIV($P(SDDIV,U,2))=$P(SDDIV,U,3)
"RTN","SCRPW6",25,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW6",26,0)
 G:SDOUT EXIT S SDMD=0,SDMD=$O(^TMP("SCRPW",$J,SDMD)),SDMD=$O(^TMP("SCRPW",$J,SDMD)) I SDMD S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW6",27,0)
 I $E(IOST)="C",'SDOUT W ! N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW6",28,0)
 ;
"RTN","SCRPW6",29,0)
EXIT K SDIV,SDIVN,SDMD,SDOUT,SDSTOP,SDDIV,SDBDT,SDCT,SDDFN,SDDT,SDEDT,SDFIG,SDI,SDLINE,SDMAX,SDMO,SDOE,SDOE0,SDPAGE,SDPNOW,SDXDT,SDXEDT,SDXMO,SDXYR,SDYR,Y,%,SDX,SDFIG1,DTOUT,DUOUT,X,Y D END^SCRPW50 Q
"RTN","SCRPW6",30,0)
 ;
"RTN","SCRPW6",31,0)
DPRT(SDIV) ;Print division
"RTN","SCRPW6",32,0)
 K SDTIT D DHDR^SCRPW46(SDIV,1,.SDTIT) I '$D(^TMP("SCRPW",$J,SDIV)) S SDX="No activity within report parameters found for this division!" D HDR Q:SDOUT  W !!?(IOM-$L(SDX)\2),SDX Q
"RTN","SCRPW6",33,0)
 S SDDT=SDBDT D FIG,HDR,HD1 Q:SDOUT  D LINE(SDDT) F  S SDDT=$O(^TMP("SCRPW",$J,SDIV,"YR",SDDT)) Q:'SDDT!SDOUT  D LINE(SDDT)
"RTN","SCRPW6",34,0)
 D:$Y>($S(IOSL<80:IOSL,1:80)-5) HDR Q:SDOUT  F  W ! Q:$Y>($S(IOSL<80:IOSL,1:80)-6)
"RTN","SCRPW6",35,0)
 W !?25,"Uniques in this report are based on OUTPATIENT ENCOUNTER file records with a"
"RTN","SCRPW6",36,0)
 W !?25,"status of '"_$S(SDSTA=2:"",SDSTA=8:"inpatient appointment ",1:"Out/Inpatient ")_"checked out'.  This excludes any 'action required' activity."
"RTN","SCRPW6",37,0)
 Q
"RTN","SCRPW6",38,0)
 ;
"RTN","SCRPW6",39,0)
DIV(SDD) ;Check division
"RTN","SCRPW6",40,0)
 ;Required input: MEDICAL CENTER DIVISION pointer
"RTN","SCRPW6",41,0)
 Q:'SDDIV 1
"RTN","SCRPW6",42,0)
 Q $D(SDDIV(SDD))
"RTN","SCRPW6",43,0)
 ;
"RTN","SCRPW6",44,0)
SET(SDIV) ;Set TMP global
"RTN","SCRPW6",45,0)
 S SDSTOP=SDSTOP+1 D:SDSTOP#2000=0 STOP Q:SDOUT
"RTN","SCRPW6",46,0)
 Q:'SDIV  D SET1(SDIV) D:SDMD SET1(0) Q
"RTN","SCRPW6",47,0)
 ;
"RTN","SCRPW6",48,0)
SET1(SDIV) S ^TMP("SCRPW",$J,SDIV,"PT",SDDFN,$E(SDDT,1,5)_"00")="" Q
"RTN","SCRPW6",49,0)
 ;
"RTN","SCRPW6",50,0)
OENC S SDXDT=SDBDT,SDDFN=0
"RTN","SCRPW6",51,0)
 F  S SDDFN=$O(^SCE("ADFN",SDDFN)) Q:'SDDFN  S SDDT=SDXDT F  S SDDT=$O(^SCE("ADFN",SDDFN,SDDT)) Q:'SDDT!(SDDT>SDEDT)  D OENC1
"RTN","SCRPW6",52,0)
 Q
"RTN","SCRPW6",53,0)
 ;
"RTN","SCRPW6",54,0)
OENC1 S SDOE=0 F  S SDOE=$O(^SCE("ADFN",SDDFN,SDDT,SDOE)) Q:'SDOE  S SDOE0=$$GETOE^SDOE(SDOE) I $$OE(SDOE0,SDSTA) S SDIV=$P(SDOE0,U,11) I SDIV,$$DIV(SDIV) D SET(SDIV)
"RTN","SCRPW6",55,0)
 Q
"RTN","SCRPW6",56,0)
 ;
"RTN","SCRPW6",57,0)
OE(SDOE0,SDSTA) ;Evaluate (in)outpatient encounter
"RTN","SCRPW6",58,0)
 ;Required input: SDOE0=OUTPATIENT ENCOUNTER zeroeth node
"RTN","SCRPW6",59,0)
 ;                SDSTA=2 -outpatient,8 -inpatient, 2^8 -both
"RTN","SCRPW6",60,0)
 ;Output: '1' if checked out "parent" encounter, '0' otherwise
"RTN","SCRPW6",61,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW6",62,0)
 S SDSTA=$G(SDSTA,2),SDSTA="^"_SDSTA_"^"
"RTN","SCRPW6",63,0)
 Q:'$P(SDOE0,U,6)&(SDSTA[$P(SDOE0,U,12))&($P(SDOE0,U,7)'="") 1
"RTN","SCRPW6",64,0)
 Q 0
"RTN","SCRPW6",65,0)
 ;
"RTN","SCRPW6",66,0)
STOP ;Check for stop task request
"RTN","SCRPW6",67,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW6",68,0)
 ;
"RTN","SCRPW6",69,0)
HDR D STOP Q:SDOUT  I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW6",70,0)
 W:SDPAGE>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE,!?36,"<*>  TREND OF FACILITY UNIQUES BY 12 MONTH DATE RANGES  <*>"
"RTN","SCRPW6",71,0)
 N SDI S SDI=$S(SDSTA=2:"Checked Out - Outpatients",SDSTA=8:"Checked Out - Inpatients",1:"Checked Out - Out/Inpatients") W !,?53,SDI ;?(132-SDI\2),SDI
"RTN","SCRPW6",72,0)
 S SDI=0 F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(132-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW6",73,0)
 W !,SDLINE,!,"Date printed: ",SDPNOW,?125,"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW6",74,0)
 ;
"RTN","SCRPW6",75,0)
HD1 Q:SDOUT  W !!,"12 mo. date range",?23,"Uniques",?32,"| Histogram (each ""*"" equals ",SDFIG," unique",$S(SDFIG=1:"",1:"s"),")",!,$E(SDLINE,1,SDFIG1) Q
"RTN","SCRPW6",76,0)
 ;
"RTN","SCRPW6",77,0)
DTINC(SDDT) ;Increment date by one month
"RTN","SCRPW6",78,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",79,0)
 ;Output: next month to examine
"RTN","SCRPW6",80,0)
 Q:$E(SDDT,4,5)=12 $E(SDDT,1,3)+1_"0100"
"RTN","SCRPW6",81,0)
 Q $E(SDDT,1,5)+1_"00"
"RTN","SCRPW6",82,0)
 ;
"RTN","SCRPW6",83,0)
LOOK S ^TMP("SCRPW",$J,SDIV,"YR",SDDT)=0,SDDFN=0 F  S SDDFN=$O(^TMP("SCRPW",$J,SDIV,"PT",SDDFN)) Q:'SDDFN  D L1
"RTN","SCRPW6",84,0)
 Q
"RTN","SCRPW6",85,0)
 ;
"RTN","SCRPW6",86,0)
L1 I $D(^TMP("SCRPW",$J,SDIV,"PT",SDDFN,SDDT)) D LSET Q
"RTN","SCRPW6",87,0)
 S SDX=$O(^TMP("SCRPW",$J,SDIV,"PT",SDDFN,SDDT)) I SDX,SDX<SDXDT D LSET
"RTN","SCRPW6",88,0)
 Q
"RTN","SCRPW6",89,0)
 ;
"RTN","SCRPW6",90,0)
LSET S ^TMP("SCRPW",$J,SDIV,"YR",SDDT)=^TMP("SCRPW",$J,SDIV,"YR",SDDT)+1 Q
"RTN","SCRPW6",91,0)
 ;
"RTN","SCRPW6",92,0)
YDTINC(SDDT) ;Increment date by one year
"RTN","SCRPW6",93,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",94,0)
 ;Output: date + 1 year
"RTN","SCRPW6",95,0)
 Q $E(SDDT,1,3)+1_$E(SDDT,4,7)
"RTN","SCRPW6",96,0)
 ;
"RTN","SCRPW6",97,0)
FIG S SDMAX=^TMP("SCRPW",$J,SDIV,"YR","MAX") F SDFIG=1,10,25,50,100,250,500,1000,2500,5000,10000 Q:SDMAX/SDFIG<99
"RTN","SCRPW6",98,0)
 S SDFIG1=34+(SDMAX\SDFIG) S:SDFIG1<73 SDFIG1=73 Q
"RTN","SCRPW6",99,0)
 ;
"RTN","SCRPW6",100,0)
LINE(SDDT) ;Print statistics line
"RTN","SCRPW6",101,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",102,0)
 D:$Y>(IOSL-3) HDR,HD1 Q:SDOUT  S SDCT=^TMP("SCRPW",$J,SDIV,"YR",SDDT),SDMO=$E(SDDT,4,5),SDYR=(17+$E(SDDT))_$E(SDDT,2,3),SDXMO=SDMO-1 S:SDXMO=0 SDXMO=12 S:$L(SDXMO)=1 SDXMO=0_SDXMO
"RTN","SCRPW6",103,0)
 S SDXYR=$S(SDXMO=12:SDYR,1:SDYR+1)
"RTN","SCRPW6",104,0)
 W !,SDMO,"/",SDYR," thru ",SDXMO,"/",SDXYR,?24,$J(SDCT,6,0),?32,"| " F SDI=1:1:(SDCT\SDFIG) W "*"
"RTN","SCRPW6",105,0)
 Q
"RTN","SCRPW7")
0^18^B15183173^B14708543
"RTN","SCRPW7",1,0)
SCRPW7 ;RENO/KEITH - Patient Encounter List ; 15 Jul 98  02:38PM
"RTN","SCRPW7",2,0)
 ;;5.3;Scheduling;**139,144,466**;AUG 13, 1993;Build 2
"RTN","SCRPW7",3,0)
ASK N DIC,%DT D TITL^SCRPW50("Patient Encounter List")
"RTN","SCRPW7",4,0)
 W ! S DIC="^DPT(",DIC(0)="AZEMQ" D ^DIC G:$D(DTOUT)!$D(DUOUT) EXIT G:Y'>0 EXIT S SDPT=$P(Y,U),SDPTNA=$P(Y,U,2),SDPTSN=$P(Y(0),U,9)
"RTN","SCRPW7",5,0)
 I '$D(^SCE("ADFN",SDPT)) W !!,$C(7),"This patient has no encounters on file.",! H 3 G ASK
"RTN","SCRPW7",6,0)
 D SUBT^SCRPW50("*** Date Range Selection ***")
"RTN","SCRPW7",7,0)
FDT W ! S %DT="AEPX",%DT("A")="Beginning date:  FIRST// ",%DT(0)="-TODAY" D ^%DT G:X=U!($D(DTOUT)) EXIT I X="" S Y=$O(^SCE("ADFN",SDPT,0)),(Y,SDBDT)=$P(Y,".") X ^DD("DD") W "   ",Y S SDPBDA=Y G LDT
"RTN","SCRPW7",8,0)
 G:Y<1 FDT S SDBDT=Y X ^DD("DD") W "   ",Y S SDPBDA=Y
"RTN","SCRPW7",9,0)
LDT W ! S %DT("A")="Ending date:  LAST// " D ^%DT G:X=U!($D(DTOUT)) EXIT I X="" S (Y,SDEDT)=DT X ^DD("DD") W "   ",Y S SDPEDA=Y W ! G QUE
"RTN","SCRPW7",10,0)
 I Y<SDBDT W !!,$C(7),"Ending date must be after beginning date!",! G LDT
"RTN","SCRPW7",11,0)
 G:Y<1 LDT S SDEDT=Y X ^DD("DD") W "   ",Y S SDPEDA=Y
"RTN","SCRPW7",12,0)
QUE S SDEDT=SDEDT+.9999 N ZTSAVE F X="SDPT","SDPTNA","SDPTSN","SDBDT","SDPBDA","SDEDT","SDPEDA" S ZTSAVE(X)=""
"RTN","SCRPW7",13,0)
 W ! D EN^XUTMDEVQ("PEL^SCRPW7","Patient Encounter List",.ZTSAVE) G ASK
"RTN","SCRPW7",14,0)
 ;
"RTN","SCRPW7",15,0)
PEL S SDPAGE=1,SDLINE="",$P(SDLINE,"=",(IOM+1))="",SDOUT=0,SDP=$S($E(IOST)="C":6,1:4),SDDT=SDEDT D:$E(IOST)="C" DISP0^SCRPW23 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW="Date printed: "_$P(Y,":",1,2),SDCT=0
"RTN","SCRPW7",16,0)
 D HDR Q:SDOUT  F  S SDDT=$O(^SCE("ADFN",SDPT,SDDT),-1) Q:'SDDT!SDOUT!(SDDT<SDBDT)  S SDOE=0 F  S SDOE=$O(^SCE("ADFN",SDPT,SDDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) D:$L(SDOE0) DISP S SDCT=SDCT+1
"RTN","SCRPW7",17,0)
 I 'SDCT S X="No encounters found within this date range!" W !!?(IOM-$L(X)\2),X,!
"RTN","SCRPW7",18,0)
END I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW7",19,0)
EXIT D END^SCRPW50 K %,%I,%H,SDBDT,SDPBDA,SDCT,SDEDT,SDPEDA,SDP,SDLINE,SDPAGE,SDDT,SDI,SDL,SDOE,SDOE0,SDOUT,SDPT,SDPNOW,SDPTNA,SDPTSN,SDS,SDS1,SDT,DTOUT,DUOUT,Y,X Q
"RTN","SCRPW7",20,0)
 ;
"RTN","SCRPW7",21,0)
STOP ;Check for stop task request
"RTN","SCRPW7",22,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW7",23,0)
 ;
"RTN","SCRPW7",24,0)
HDR W:SDP=6!(SDPAGE>1) $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW7",25,0)
 D STOP Q:SDOUT  W SDLINE I SDP=4!(SDPAGE=1) W !?(IOM-32/2),"<*>  PATIENT ENCOUNTER LIST  <*>",!,SDLINE,!,"Date range: ",SDPBDA," to ",SDPEDA,?(IOM-$L(SDPNOW)),SDPNOW
"RTN","SCRPW7",26,0)
 W !,"Patient: ",SDPTNA,?40,"SSN: ",SDPTSN,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1
"RTN","SCRPW7",27,0)
 Q
"RTN","SCRPW7",28,0)
 ;
"RTN","SCRPW7",29,0)
DISP S SDL=$P($G(^SC(+$P(SDOE0,U,4),0)),U),SDT=$P(SDOE0,U,8),SDT=$S(SDT=1:"Appointment",SDT=2:"Stop Code Addition",SDT=3:"Disposition",SDT=4:"Credit Stop Code",1:""),SDS=$P($G(^SD(409.63,+$P(SDOE0,U,12),0)),U)
"RTN","SCRPW7",30,0)
 S SDS1=$$COTS(SDOE) D:$Y>(IOSL-SDP) WAIT Q:SDOUT  S Y=SDDT X ^DD("DD") W !,Y,?30,SDL,!?5,"#",SDOE,?15,SDT,?35,SDS W:$L(SDS1) " - ",SDS1 W ! F SDI=1:1:80 W "-"
"RTN","SCRPW7",31,0)
 Q
"RTN","SCRPW7",32,0)
 ;
"RTN","SCRPW7",33,0)
WAIT I SDP=4 D HDR Q
"RTN","SCRPW7",34,0)
 W ! K DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1
"RTN","SCRPW7",35,0)
 D:Y HDR Q
"RTN","SCRPW7",36,0)
 ;
"RTN","SCRPW7",37,0)
COTS(SDOE) Q:$P(SDOE0,U,6) "Child of enc. #"_$P(SDOE0,U,6)
"RTN","SCRPW7",38,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q ""
"RTN","SCRPW7",39,0)
 Q:"^CHECKED OUT^INPATIENT APPOINTMENT^"'["^"_SDS_"^" ""  Q $P($$STX^SCRPW8(SDOE,SDOE0),U,2)
"RTN","SCRPW8")
0^23^B65233961^B60477728
"RTN","SCRPW8",1,0)
SCRPW8 ;RENO/KEITH - Outpatient Encounter Workload Statistics ; 04 Feb 99  4:53 PM
"RTN","SCRPW8",2,0)
 ;;5.3;Scheduling;**139,145,144,176,339,466**;AUG 13, 1993;Build 2
"RTN","SCRPW8",3,0)
QS ;Queue outpatient encounter workload report
"RTN","SCRPW8",4,0)
 D PARM^SCRPW9 Q
"RTN","SCRPW8",5,0)
 ;
"RTN","SCRPW8",6,0)
PST ;Print stats
"RTN","SCRPW8",7,0)
 N X,Y,%
"RTN","SCRPW8",8,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPAGE=1,SDPNOW=$P(Y,":",1,2),SDDT=SDDTF,SDMC=$O(^DG(43,0)),SDMC=$G(^DG(43,+SDMC,"GL")),SDMD=$P(SDMC,U,2),(SDOUT,SDSTOP,SDFF)=0
"RTN","SCRPW8",9,0)
 S SDDNAM=$P($G(^DG(40.8,+$$PRIM^VASITE(),0)),U,7),SDDNAM=$$GET1^DIQ(4,+SDDNAM,.01) S:'$L(SDDNAM) SDDNAM=$P($G(^DG(40.8,+$P(SDMC,U,3),0)),U)
"RTN","SCRPW8",10,0)
 F I="SCRPW","SCRPWD","SCRPWC" K ^TMP(I,$J)
"RTN","SCRPW8",11,0)
 F  S SDDT=$O(^SCE("B",SDDT)) Q:'SDDT!(SDDT>SDDTL)!SDOUT  S SDOE=0 D
"RTN","SCRPW8",12,0)
 .F  S SDOE=$O(^SCE("B",SDDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0),'$P(SDOE0,U,6),$P(SDOE0,U,2),$P(SDOE0,U,11),$P(SDOE0,U,12) S SDDIV=$$DIV(),SDCG=$$CLGR() D COUNT
"RTN","SCRPW8",13,0)
 .Q
"RTN","SCRPW8",14,0)
 I '$D(^TMP("SCRPW",$J)) D XHDR S SDX="No activity found within the parameters specified." W !!?(80-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW8",15,0)
 F SDS1="SCRPW","SCRPWD","SCRPWC" S SDS2="" F  S SDS2=$O(^TMP(SDS1,$J,SDS2)) Q:SDS2=""!SDOUT  D STCT
"RTN","SCRPW8",16,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW8",17,0)
 F SDS1="SCRPW","SCRPWD","SCRPWC" S SDS2="" F  S SDS2=$O(^TMP(SDS1,$J,SDS2)) Q:SDS2=""!SDOUT  D PRPT
"RTN","SCRPW8",18,0)
 G:SDOUT EXIT
"RTN","SCRPW8",19,0)
 D:SDZ(0) DPRT^SCRPW9("SCRPW",SDDNAM) G:SDOUT EXIT D:SDUL UNARL^SCRPW9("SCRPW",SDDNAM) G EXIT
"RTN","SCRPW8",20,0)
 ;
"RTN","SCRPW8",21,0)
STCT S (SDUNCO,SDCT,DFN)=0 D STOP Q:SDOUT
"RTN","SCRPW8",22,0)
 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) Q:'DFN  S SDUNCO=SDUNCO+1,SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) Q:'SDDT  S SDCT=SDCT+1
"RTN","SCRPW8",23,0)
 S ^TMP(SDS1,$J,SDS2,"UNIQUE","UNCO")=SDUNCO,^TMP(SDS1,$J,SDS2,"VISIT","OWK")=SDCT,(SDUNAR,SDCT,DFN)=0
"RTN","SCRPW8",24,0)
 S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN)) Q:'DFN  D NCT1
"RTN","SCRPW8",25,0)
 S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","NWK",DFN)) Q:'DFN  D CT1
"RTN","SCRPW8",26,0)
 S ^TMP(SDS1,$J,SDS2,"UNIQUE","UNAR")=SDUNAR,^TMP(SDS1,$J,SDS2,"VISIT","NWK")=SDCT Q
"RTN","SCRPW8",27,0)
 ;
"RTN","SCRPW8",28,0)
PRPT ;Print statistics page
"RTN","SCRPW8",29,0)
 D STOP Q:SDOUT
"RTN","SCRPW8",30,0)
 S SDCT=0 F SDI=1,2,3,11,14,8 S SDCT=SDCT+$G(^TMP(SDS1,$J,SDS2,SDI))
"RTN","SCRPW8",31,0)
 D XHDR Q:SDOUT  D SHDR("O U T P A T I E N T   E N C O U N T E R   W O R K L O A D") Q:SDOUT  F SDI=11,14,3,1 D LIST(SDI) Q:SDOUT
"RTN","SCRPW8",32,0)
 I $D(^TMP(SDS1,$J,SDS2,2)) D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"CHECKED OUT" S SDI=0 F  S SDI=$O(^TMP(SDS1,$J,SDS2,2,SDI)) Q:'SDI!SDOUT  S SDSTAT=$O(^TMP(SDS1,$J,SDS2,2,SDI,"")) D COT
"RTN","SCRPW8",33,0)
 I $D(^TMP(SDS1,$J,SDS2,8)) D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"INPATIENT APPOINTMENT" S SDI=0 F  S SDI=$O(^TMP(SDS1,$J,SDS2,8,SDI)) Q:'SDI!SDOUT  S SDSTAT=$O(^TMP(SDS1,$J,SDS2,8,SDI,"")) D IAP
"RTN","SCRPW8",34,0)
 D TOT S (SDI,SDCT)=0 F SDI=4,5,6,7,9,12,13 S SDCT=SDCT+$G(^TMP(SDS1,$J,SDS2,SDI))
"RTN","SCRPW8",35,0)
 W !! D SHDR("N O N - W O R K L O A D") Q:SDOUT  F SDI=12,4,6,5,7,9,10,13 D LIST(SDI) Q:SDOUT
"RTN","SCRPW8",36,0)
 D TOT W !! D SHDR(($$HD2()_"   O U T P A T I E N T   V I S I T S")) Q:SDOUT  S SDCT=^TMP(SDS1,$J,SDS2,"VISIT","NWK")+^TMP(SDS1,$J,SDS2,"VISIT","OWK")
"RTN","SCRPW8",37,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Act. Req./not accepted visits",?47,$J(^TMP(SDS1,$J,SDS2,"VISIT","NWK"),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,"VISIT","NWK")*100/SDCT)),8,2)
"RTN","SCRPW8",38,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Transmitted, accepted visits",?47,$J(^TMP(SDS1,$J,SDS2,"VISIT","OWK"),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,"VISIT","OWK")*100/SDCT)),8,2)
"RTN","SCRPW8",39,0)
 D TOT
"RTN","SCRPW8",40,0)
 W !! D SHDR(($$HD2()_"   O U T P A T I E N T   U N I Q U E S")) Q:SDOUT
"RTN","SCRPW8",41,0)
 S SDUNCO=^TMP(SDS1,$J,SDS2,"UNIQUE","UNCO"),SDUNAR=^TMP(SDS1,$J,SDS2,"UNIQUE","UNAR"),SDCT=SDUNCO+SDUNAR
"RTN","SCRPW8",42,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Act. Req./not accepted unique pts.",?47,$J(SDUNAR,12),?62,$J($S(SDCT=0:0,1:SDUNAR*100/SDCT),8,2)
"RTN","SCRPW8",43,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Transmitted, accepted unique pts.",?47,$J(SDUNCO,12),?62,$J($S(SDCT=0:0,1:SDUNCO*100/SDCT),8,2) D TOT
"RTN","SCRPW8",44,0)
 Q
"RTN","SCRPW8",45,0)
 ;
"RTN","SCRPW8",46,0)
XHDR I $E(IOST)="C",SDPAGE>1 N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW8",47,0)
 S SDLINE="",$P(SDLINE,"-",81)="" W:SDPAGE>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE,!?15,"<*>  OUTPATIENT ENCOUNTER WORKLOAD STATISTICS  <*>"
"RTN","SCRPW8",48,0)
 I $D(^TMP("SCRPW",$J)) S X=$$HD1() W !?(80-$L(X)\2),X
"RTN","SCRPW8",49,0)
 W !,SDLINE,!,"For encounter dates ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1
"RTN","SCRPW8",50,0)
 Q
"RTN","SCRPW8",51,0)
 ;
"RTN","SCRPW8",52,0)
EXIT K SDTOE0,SDUNCO,SDUNAR,SDCT,DFN,SDDT,SDDTF,SDDTL,SDDTPF,SDDTPL,SDI,SDLINE,SDOE,SDOE0,SDPNOW,SDSTAT,SDSTX,SDTOE,SDTOEE,SDTOE1,SDTX,SDTXS,SDX,SDZ,DTOUT,X,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","SCRPW8",53,0)
 D KVA^VADPT K X1,X2,SDH,SDHL,SDPNAM,SDSSN,SDPAGE,SDPT0,SDUL,DUOUT,SDARCT,SDST,SDPNOW,SDMD,SDMC,SDDIV,SDDNAM,SDS1,SDS2,SDCG,SDCLGR F I="SCRPW","SCRPWD","SCRPWC" K ^TMP(I,$J)
"RTN","SCRPW8",54,0)
 K I,SDFF,SDOUT,SDSTOP D END^SCRPW50 Q
"RTN","SCRPW8",55,0)
 ;
"RTN","SCRPW8",56,0)
HD1() ;Report subheader 1
"RTN","SCRPW8",57,0)
 Q $S(SDS1="SCRPW":"For station: ",SDS1="SCRPWD":"For division: ",1:"For clinic group: ")_SDS2
"RTN","SCRPW8",58,0)
 ;
"RTN","SCRPW8",59,0)
HD2() ;Report subheader 2
"RTN","SCRPW8",60,0)
 Q $S(SDS1="SCRPW":"F A C I L I T Y",SDS1="SCRPWD":"D I V I S I O N",1:"C L I N I C   G R O U P")
"RTN","SCRPW8",61,0)
 ;
"RTN","SCRPW8",62,0)
DIV() ;Return division name
"RTN","SCRPW8",63,0)
 N X S X=$P($G(^DG(40.8,+$P(SDOE0,U,11),0)),U) Q $S('$L(X):"***UNKNOWN***",1:X)
"RTN","SCRPW8",64,0)
 ;
"RTN","SCRPW8",65,0)
CLGR() ;Return CLINIC GROUP pointer
"RTN","SCRPW8",66,0)
 N X S X=$P($G(^SC(+$P(SDOE0,U,4),0)),U,31),X=$P($G(^SD(409.67,+X,0)),U) Q $S('$L(X):"***NONE ASSIGNED***",1:X)
"RTN","SCRPW8",67,0)
 ;
"RTN","SCRPW8",68,0)
NCT1 I '$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) S SDUNAR=SDUNAR+1 D:SDUL&(SDS1="SCRPW") UL("OWK")
"RTN","SCRPW8",69,0)
 S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN,SDDT)) Q:'SDDT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) S SDCT=SDCT+1
"RTN","SCRPW8",70,0)
 Q
"RTN","SCRPW8",71,0)
 ;
"RTN","SCRPW8",72,0)
CT1 I '$D(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN)),'$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) S SDUNAR=SDUNAR+1 D:SDUL&(SDS1="SCRPW") UL("NWK")
"RTN","SCRPW8",73,0)
 S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","NWK",DFN,SDDT)) Q:'SDDT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN,SDDT)),'$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) S SDCT=SDCT+1
"RTN","SCRPW8",74,0)
 Q
"RTN","SCRPW8",75,0)
 ;
"RTN","SCRPW8",76,0)
UL(SDI) D ^VADPT S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT",SDI,DFN,SDDT)) Q:'SDDT  S ^TMP(SDS1,$J,SDS2,"VISIT","UNARL",VADM(1),DFN,$P(VADM(2),U),SDDT)=""
"RTN","SCRPW8",77,0)
 Q
"RTN","SCRPW8",78,0)
 ;
"RTN","SCRPW8",79,0)
TOT W !?47,"============  =========",!?39,"TOTAL:",?47,$J(SDCT,12),?64,"100.00" Q
"RTN","SCRPW8",80,0)
 ;
"RTN","SCRPW8",81,0)
SHDR(SDTX) D:$Y>(IOSL-6) XHDR Q:SDOUT  W !!?(80-$L(SDTX)\2),SDTX,!?(80-$L(SDTX)\2) F SDX=1:1:$L(SDTX) W "-"
"RTN","SCRPW8",82,0)
 W !!?39,"Status",?54,"Count",?63,"Percent",!?10,"-----------------------------------  ------------  ---------" Q
"RTN","SCRPW8",83,0)
 ;
"RTN","SCRPW8",84,0)
LIST(SDI) Q:'$D(^TMP(SDS1,$J,SDS2,SDI))  D:$Y>(IOSL-4) XHDR Q:SDOUT
"RTN","SCRPW8",85,0)
 W !?10,$P(^SD(409.63,SDI,0),U),?47,$J(^TMP(SDS1,$J,SDS2,SDI),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,SDI)*100/SDCT)),8,2)
"RTN","SCRPW8",86,0)
 Q
"RTN","SCRPW8",87,0)
 ;
"RTN","SCRPW8",88,0)
COT D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?15,SDSTAT,?47,$J(^TMP(SDS1,$J,SDS2,2,SDI,SDSTAT),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,2,SDI,SDSTAT)*100/SDCT)),8,2) Q
"RTN","SCRPW8",89,0)
 ;
"RTN","SCRPW8",90,0)
IAP D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?15,SDSTAT,?47,$J(^TMP(SDS1,$J,SDS2,8,SDI,SDSTAT),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,8,SDI,SDSTAT)*100/SDCT)),8,2) Q
"RTN","SCRPW8",91,0)
STOP ;Check for stop task request
"RTN","SCRPW8",92,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW8",93,0)
 ;
"RTN","SCRPW8",94,0)
COUNT ;Count encounters
"RTN","SCRPW8",95,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP Q:SDOUT
"RTN","SCRPW8",96,0)
 D C1("SCRPW",SDDNAM) D:SDMD C1("SCRPWD",SDDIV) D:SDCLGR C1("SCRPWC",SDCG) Q
"RTN","SCRPW8",97,0)
 ;
"RTN","SCRPW8",98,0)
C1(SDS1,SDS2) ;Set ^TMP global
"RTN","SCRPW8",99,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW8",100,0)
 S DFN=$P(SDOE0,U,2),SDSTAT=+$P(SDOE0,U,12) I SDZ(0),SDZ(4)=SDDIV,SDS1="SCRPW" D DETAIL
"RTN","SCRPW8",101,0)
 S ^TMP(SDS1,$J,SDS2,SDSTAT)=$G(^TMP(SDS1,$J,SDS2,SDSTAT))+1
"RTN","SCRPW8",102,0)
 Q:SDSTAT=4  D:"114238"[SDSTAT VIS Q
"RTN","SCRPW8",103,0)
 ;
"RTN","SCRPW8",104,0)
VIS S ^TMP(SDS1,$J,SDS2,"VISIT",$S(SDSTAT=2:"OWK",SDSTAT=8:"OWK",1:"NWK"),DFN,$P(SDDT,"."))="" Q:(SDSTAT'=2)&(SDSTAT'=8)
"RTN","SCRPW8",105,0)
 S SDSTX=$$STX(SDOE,SDOE0),^TMP(SDS1,$J,SDS2,SDSTAT,$P(SDSTX,U),$P(SDSTX,U,2))=$G(^TMP(SDS1,$J,SDS2,SDSTAT,$P(SDSTX,U),$P(SDSTX,U,2)))+1
"RTN","SCRPW8",106,0)
 Q:$P(SDSTX,U)'=8  S ^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,$P(SDDT,"."))=""
"RTN","SCRPW8",107,0)
 Q
"RTN","SCRPW8",108,0)
 ;
"RTN","SCRPW8",109,0)
STX(SDOE,SDOE0) ;Determine transmission status
"RTN","SCRPW8",110,0)
 ;Required input: SDOE=OUTPATIENT ENCOUNTER record IFN
"RTN","SCRPW8",111,0)
 ;Required input: SDOE0=zeroeth node of OUTPATIENT ENCOUNTER
"RTN","SCRPW8",112,0)
 N SDTOE,SDTOEE
"RTN","SCRPW8",113,0)
 Q:($P(SDOE0,U,12)'=2)&($P(SDOE0,U,12)'=8) "0^Not checked-out^Not checked-out"
"RTN","SCRPW8",114,0)
 S SDTOE=$O(^SD(409.73,"AENC",SDOE,0)) Q:'SDTOE!'$D(^SD(409.73,+SDTOE,0)) "1^No transmission record^No tx. record"
"RTN","SCRPW8",115,0)
 S SDTOE1=$G(^SD(409.73,SDTOE,1)),SDTOE0=^SD(409.73,SDTOE,0) I '$P(SDTOE0,U,4),'$P(SDTOE1,U) Q "2^Not required, not transmitted^Not req., not tx."
"RTN","SCRPW8",116,0)
 ; SD*5.3*339 added second I SDTOEE below
"RTN","SCRPW8",117,0)
 S SDTOEE=$O(^SD(409.75,"B",SDTOE,0)) I SDTOEE S SDTOEE=$P($G(^SD(409.75,SDTOEE,0)),U,2) I SDTOEE S SDTOEE=$P($G(^SD(409.76,SDTOEE,0)),U,2) Q:SDTOEE="V" "3^Rejected for transmission^Rejected for tx."
"RTN","SCRPW8",118,0)
 Q:'$P(SDTOE1,U) "4^Awaiting transmission^Awaiting tx."
"RTN","SCRPW8",119,0)
 S SDTXS=$P(SDTOE1,U,5) Q:'$L(SDTXS) "5^Transmitted, no acknowledgment^Tx., no ack."
"RTN","SCRPW8",120,0)
 Q:SDTXS="R" "6^Transmitted, rejected^Tx., rejected"
"RTN","SCRPW8",121,0)
 Q:SDTXS'="A" "7^Transmitted, error^Tx., error"
"RTN","SCRPW8",122,0)
 Q "8^Transmitted, accepted^Tx., accepted"
"RTN","SCRPW8",123,0)
 ;
"RTN","SCRPW8",124,0)
DETAIL ;Set global for detailed list
"RTN","SCRPW8",125,0)
 D ^VADPT S SDPNAM=VADM(1),SDSSN=$P(VADM(2),U)
"RTN","SCRPW8",126,0)
 I SDZ(1)="U",SDSTAT'=4 S:"114238"[SDSTAT ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN)="" Q
"RTN","SCRPW8",127,0)
 I SDZ(1)="V",SDSTAT'=4 S:"114238"[SDSTAT ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,$P(SDDT,"."))="" Q
"RTN","SCRPW8",128,0)
 Q:'$D(SDZ(2))  ; SD*5.3*339
"RTN","SCRPW8",129,0)
 I (SDZ(2)'=2)&(SDZ(2)'=8),SDZ(2)=SDSTAT D DSET Q
"RTN","SCRPW8",130,0)
 Q:("28"'[SDZ(2))!("28"'[SDSTAT)!(SDZ(2)'=SDSTAT)  I 'SDZ(3) D DSET Q
"RTN","SCRPW8",131,0)
 D:+$$STX(SDOE,SDOE0)=SDZ(3) DSET Q
"RTN","SCRPW8",132,0)
 ;
"RTN","SCRPW8",133,0)
DSET S ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE)=+$P(SDOE0,U,4) Q
"RTN","SCRPW9")
0^27^B56812091^B55655282
"RTN","SCRPW9",1,0)
SCRPW9 ;RENO/KEITH - Outpatient Encounter Workload Statistics (cont.) ; 15 Jul 98  02:38PM
"RTN","SCRPW9",2,0)
 ;;5.3;Scheduling;**139,144,339,466**;AUG 13, 1993;Build 2
"RTN","SCRPW9",3,0)
UNARL(SDS1,SDS2) ;Print list of 'action required'/not accepted uniques
"RTN","SCRPW9",4,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW9",5,0)
 S SDPAGE=1 D UHDR Q:SDOUT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","UNARL")) W !!,"No 'action required'/not accepted unique patients identified." Q
"RTN","SCRPW9",6,0)
 S SDARCT=0,SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN)) Q:'DFN!SDOUT  D UNP
"RTN","SCRPW9",7,0)
 Q:SDOUT  D:$Y>(IOSL-3) UHDR Q:SDOUT  W !!,SDARCT," 'action required'/not accepted unique patient",$S(SDARCT=1:"",1:"s")," identified." Q
"RTN","SCRPW9",8,0)
 ;
"RTN","SCRPW9",9,0)
UNP S SDSSN=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN,"")) D:$Y>(IOSL-4) UHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?20,SDSSN
"RTN","SCRPW9",10,0)
 S SDARCT=SDARCT+1,(SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  D:$Y>(IOSL-4) UHDR Q:SDOUT  S Y=SDDT X ^DD("DD") W:SDI ! W ?31,Y S SDI=1 D UNP1
"RTN","SCRPW9",11,0)
 Q
"RTN","SCRPW9",12,0)
 ;
"RTN","SCRPW9",13,0)
UNP1 N SDII,SDDT1 S SDII=0,SDDT1=SDDT F  S SDDT1=$O(^SCE("ADFN",DFN,SDDT1)) Q:'SDDT1!(SDDT1>(SDDT+.9999))!SDOUT  D
"RTN","SCRPW9",14,0)
 .S SDOE=0 F  S SDOE=$O(^SCE("ADFN",DFN,SDDT1,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0),'$P(SDOE0,U,6) D UNP2
"RTN","SCRPW9",15,0)
 .Q
"RTN","SCRPW9",16,0)
 Q
"RTN","SCRPW9",17,0)
 ;
"RTN","SCRPW9",18,0)
UNP2 N SDCL,SDST Q:'$P(SDOE0,U,4)  S SDCL=$P($G(^SC($P(SDOE0,U,4),0)),U),SDST=$P(SDOE0,U,12) Q:$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y"  Q:'SDST!(SDST=12)  S SDST=$S("28"'[SDST:$P(^SD(409.63,SDST,0),U),1:$P($$STX^SCRPW8(SDOE,SDOE0),U,3))
"RTN","SCRPW9",19,0)
 D:$Y>(IOSL-4) UHDR Q:SDOUT  W:SDII ! W ?44,$E(SDCL,1,17),?63,$E(SDST,1,17) S SDII=SDII+1 Q
"RTN","SCRPW9",20,0)
 ;
"RTN","SCRPW9",21,0)
UHDR I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW9",22,0)
 D STOP^SCRPW8 Q:SDOUT
"RTN","SCRPW9",23,0)
 W $$XY^SCRPW50(IOF,1,0),SDLINE,!?8,"<*>  LIST OF 'ACTION REQUIRED'/NOT ACCEPTED UNIQUE PATIENTS  <*>",!?(66-$L(SDDNAM)\2),"For station: ",SDDNAM
"RTN","SCRPW9",24,0)
 W !,SDLINE,!,"For encounter dates ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1
"RTN","SCRPW9",25,0)
 W:$D(^TMP(SDS1,$J,SDS2,"VISIT","UNARL")) !,"Name:",?20,"SSN:",?31,"Date:",?44,"Location:",?63,"Reason:",! Q
"RTN","SCRPW9",26,0)
 ;
"RTN","SCRPW9",27,0)
DETAIL ;Ask questions for detail of encounters or uniques for a division
"RTN","SCRPW9",28,0)
 K SDZ S SDZ(0)=0 K DIR S DIR(0)="Y",DIR("A")="Would you like to print a detailed list of activity for a division",DIR("B")="NO" W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",29,0)
 S SDZ(0)=Y Q:'Y  W !!!,$C(7),"   WARNING: Selection high activity areas will result in lengthy output!",!
"RTN","SCRPW9",30,0)
 K DIR S DIR(0)="S^U:UNIQUES;V:VISITS;E:ENCOUNTERS",DIR("A")="Select type of list" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",31,0)
 S SDZ(1)=Y G:Y'="E" ZDIV
"RTN","SCRPW9",32,0)
DET1 K DIC S DIC="^SD(409.63,",DIC(0)="AEMQ",DIC("S")="I Y<4!(Y=8!(Y=12!(Y=14)))",DIC("A")="Select encounter status: " W ! D ^DIC I $D(DTOUT)!$D(DUOUT)!($G(Y)<1) S SDZ(0)=-1 Q
"RTN","SCRPW9",33,0)
 S SDZ(2)=$P(Y,U) G:(SDZ(2)'=2)&(SDZ(2)'=8) ZDIV K DIR S DIR("A")="Select transmission status for "_$S(SDZ(2)=2:"CHECKED OUT",1:"INPATIENT APPOINTMENT")_" encounters"
"RTN","SCRPW9",34,0)
 S DIR(0)="S^A:All transmission statuses;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;"
"RTN","SCRPW9",35,0)
 S DIR(0)=DIR(0)_"5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW9",36,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q  ;SD*5.3*339 add sub-zero
"RTN","SCRPW9",37,0)
 S SDZ(3)=+Y
"RTN","SCRPW9",38,0)
ZDIV ;Get division for detail
"RTN","SCRPW9",39,0)
 I '$P($G(^DG(43,1,"GL")),U,2) S SDZ(4)=$P(^DG(40.8,$$PRIM^VASITE(),0),U) Q
"RTN","SCRPW9",40,0)
 K DIC S DIC="^DG(40.8,",DIC("A")="Select Medical Center division for detail: ",DIC(0)="AEMQ" W ! D ^DIC I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",41,0)
 I Y<1 W $C(7),"    Required for patient detail!" G ZDIV
"RTN","SCRPW9",42,0)
 S SDZ(4)=$P(Y,U,2) Q
"RTN","SCRPW9",43,0)
 ;
"RTN","SCRPW9",44,0)
DPRT(SDS1,SDS2) ;Detail print
"RTN","SCRPW9",45,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW9",46,0)
 K SDH S SDPAGE=1,SDH(1)="<*>  DETAILED LIST OF DIVISION "_$S(SDZ(1)="U":"UNIQUES",SDZ(1)="V":"VISITS",1:"ENCOUNTERS")_"  <*>",SDH(2)="For division: "_SDZ(4)
"RTN","SCRPW9",47,0)
 I $G(SDZ(2)) S SDH(3)="Encounters with "_$P(^SD(409.63,SDZ(2),0),U)_" status"
"RTN","SCRPW9",48,0)
 I "28"[$G(SDZ(2)) S SDH(4)="Transmission status: "_$P($T(TXS+SDZ(3)),";",2)
"RTN","SCRPW9",49,0)
 D DHDR Q:SDOUT  I '$D(^TMP(SDS1,$J,SDS2,"DETAIL")) W !,"No records found in this category." Q
"RTN","SCRPW9",50,0)
 S SDCT=0 D @SDZ(1) Q
"RTN","SCRPW9",51,0)
 ;
"RTN","SCRPW9",52,0)
U ;Print uniques
"RTN","SCRPW9",53,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  D U1
"RTN","SCRPW9",54,0)
 Q:SDOUT  W !!,SDCT," uniques identified." Q
"RTN","SCRPW9",55,0)
 ;
"RTN","SCRPW9",56,0)
U1 S SDCT=SDCT+1,SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN Q
"RTN","SCRPW9",57,0)
 ;
"RTN","SCRPW9",58,0)
V ;Print visits
"RTN","SCRPW9",59,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  S SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D V1
"RTN","SCRPW9",60,0)
 Q:SDOUT  W !!,SDCT," visits identified." Q
"RTN","SCRPW9",61,0)
 ;
"RTN","SCRPW9",62,0)
V1 D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN S (SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  D
"RTN","SCRPW9",63,0)
 .D:$Y>(IOSL-3) DHDR Q:SDOUT  S Y=SDDT X ^DD("DD") W:SDI ! W ?32,Y S SDCT=SDCT+1,SDI=SDI+1
"RTN","SCRPW9",64,0)
 .Q
"RTN","SCRPW9",65,0)
 Q
"RTN","SCRPW9",66,0)
 ;
"RTN","SCRPW9",67,0)
E ;Print encounters
"RTN","SCRPW9",68,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  S SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D E1
"RTN","SCRPW9",69,0)
 Q:SDOUT  W !!,SDCT," encounters identified." Q
"RTN","SCRPW9",70,0)
 ;
"RTN","SCRPW9",71,0)
E1 D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN
"RTN","SCRPW9",72,0)
 S (SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  S SDOE=0 F  S SDOE=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE)) Q:'SDOE!SDOUT  D E2
"RTN","SCRPW9",73,0)
 Q
"RTN","SCRPW9",74,0)
 ;
"RTN","SCRPW9",75,0)
E2 D:$Y>(IOSL-3) DHDR Q:SDOUT  S SDHL=^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE),SDHL=$P($G(^SC(+SDHL,0)),U),Y=SDDT X ^DD("DD") W:SDI ! W ?32,$P(Y,":",1,2),?50,SDHL S SDCT=SDCT+1,SDI=SDI+1 Q
"RTN","SCRPW9",76,0)
 ;
"RTN","SCRPW9",77,0)
DHDR I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW9",78,0)
 D STOP^SCRPW8 Q:SDOUT
"RTN","SCRPW9",79,0)
 W $$XY^SCRPW50(IOF,1,0),SDLINE S I=0 F  S I=$O(SDH(I)) Q:'I  W !?(80-$L(SDH(I))\2),SDH(I)
"RTN","SCRPW9",80,0)
 W !,SDLINE,!,"For date range: ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW9",81,0)
 ;
"RTN","SCRPW9",82,0)
TXS ;All transmission statuses
"RTN","SCRPW9",83,0)
 ;No transmission record
"RTN","SCRPW9",84,0)
 ;Not required, not transmitted
"RTN","SCRPW9",85,0)
 ;Rejected for transmission
"RTN","SCRPW9",86,0)
 ;Awaiting transmission
"RTN","SCRPW9",87,0)
 ;Transmitted, no acknowledgment
"RTN","SCRPW9",88,0)
 ;Transmitted, rejected
"RTN","SCRPW9",89,0)
 ;Transmitted, error
"RTN","SCRPW9",90,0)
 ;Transmitted, accepted
"RTN","SCRPW9",91,0)
 ;
"RTN","SCRPW9",92,0)
PARM ;Prompt for report parameters
"RTN","SCRPW9",93,0)
 D TITL^SCRPW50("Outpatient Encounter Workload Statistics")
"RTN","SCRPW9",94,0)
 N %DT,DIR,DIC D SUBT^SCRPW50("*** Date Range Selection ***")
"RTN","SCRPW9",95,0)
FDT W ! S %DT="AEPX",%DT("A")="Beginning date:  FIRST// ",%DT(0)=2961001 D ^%DT G:X=U!$D(DTOUT) EXIT^SCRPW8 I X="" S (Y,SDDTF)=2961001 X ^DD("DD") W "  ",Y,! S SDDTPF=Y G LDT
"RTN","SCRPW9",96,0)
 G:Y<1 FDT S SDDTF=Y X ^DD("DD") S SDDTPF=Y W !
"RTN","SCRPW9",97,0)
LDT S %DT("A")="Ending date:  LAST// " D ^%DT G:X=U!$D(DTOUT) EXIT^SCRPW8 I X="" S X1=DT,X2=-1 D C^%DTC S (Y,SDDTL)=X X ^DD("DD") W "  ",Y,! S SDDTPL=Y G ASK
"RTN","SCRPW9",98,0)
 I Y<SDDTF W !!,$C(7),"Ending date must be after beginning date!",! G LDT
"RTN","SCRPW9",99,0)
 G:Y<1 LDT S SDDTL=Y X ^DD("DD") S SDDTPL=Y,SDDTL=SDDTL_".999999"
"RTN","SCRPW9",100,0)
ASK D SUBT^SCRPW50("*** Additional Detail Selection ***")
"RTN","SCRPW9",101,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Break out workload by clinic group",DIR("B")="NO",DIR("?")="Specify if subtotals by encounter location CLINIC GROUP should be provided." D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT^SCRPW8 S SDCLGR=Y
"RTN","SCRPW9",102,0)
 D DETAIL^SCRPW9 W ! G:SDZ(0)=-1 EXIT^SCRPW8
"RTN","SCRPW9",103,0)
 K DIR S DIR(0)="Y",DIR("A")="List facility 'action required'/not accepted unique patients",DIR("B")="NO" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT^SCRPW8 S SDUL=Y W !
"RTN","SCRPW9",104,0)
QUE S ZTRTN="PST^SCRPW8",ZTDESC="Outpatient Encounter Workload" F SDI="SDCLGR","SDDTF","SDDTPF","SDDTL","SDDTPL","SDUL","SDDUL","SDZ(" S ZTSAVE(SDI)=""
"RTN","SCRPW9",105,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE) G EXIT^SCRPW8
"RTN","SDAM1")
0^22^B29444378^B27486316
"RTN","SDAM1",1,0)
SDAM1 ;MJK/ALB - Appt Mgt (Patient);Apr 23 1999
"RTN","SDAM1",2,0)
 ;;5.3;Scheduling;**149,155,193,189,445,478,466**;Aug 13, 1993;Build 2
"RTN","SDAM1",3,0)
 ;
"RTN","SDAM1",4,0)
INIT ; -- get init pat appt data
"RTN","SDAM1",5,0)
 ;  input:          DFN := ifn of pat
"RTN","SDAM1",6,0)
 ; output:  ^TMP("SDAM" := appt array
"RTN","SDAM1",7,0)
 S X=$P($G(^DG(43,1,"SCLR")),U,12),SDPRD=$S(X:X,1:2)
"RTN","SDAM1",8,0)
 S X1=DT,X2=-SDPRD D C^%DTC S SDBEG=X
"RTN","SDAM1",9,0)
 S X1=DT,X2=999 D C^%DTC S SDEND=X
"RTN","SDAM1",10,0)
 D CHGCAP^VALM("NAME","Clinic")
"RTN","SDAM1",11,0)
 S X="ALL" D LIST^SDAM
"RTN","SDAM1",12,0)
 Q
"RTN","SDAM1",13,0)
 ;
"RTN","SDAM1",14,0)
BLD ; -- scan apts
"RTN","SDAM1",15,0)
 N SDAMDD,SDNAME,SDMAX,SDLARGE,DFN,SDCL,BL,XC,XW,AC,AW,TC,TW,NC,NW,SC,SW,SDT,CC,CW,CN,CNPAT,CNSTLNK,CSTAT ; done for speed see INIT
"RTN","SDAM1",16,0)
 D INIT^SDAM10
"RTN","SDAM1",17,0)
 S DFN=SDFN
"RTN","SDAM1",18,0)
 F SDT=SDBEG:0 S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  I $D(^(SDT,0)) S SDATA=^(0),SDCL=+SDATA,SDNAME=$P($G(^SC(SDCL,0)),U) D  K:CNSTLNK="" CNSTLNK D BLD1  ;SD/478
"RTN","SDAM1",19,0)
 .S CNSTLNK="",CN=0 F  S CN=$O(^SC(SDCL,"S",SDT,1,CN)) Q:'+CN  S CNPAT=$P($G(^SC(SDCL,"S",SDT,1,CN,0)),U) I CNPAT=DFN S CNSTLNK=$P($G(^SC(SDCL,"S",SDT,1,CN,"CONS")),U),CSTAT="" S:CNSTLNK'="" CSTAT=$P($G(^GMR(123,CNSTLNK,0)),U,12) Q  ;SD/478
"RTN","SDAM1",20,0)
 D NUL^SDAM10,LARGE^SDAM10:$D(SDLARGE)
"RTN","SDAM1",21,0)
 S $P(^TMP("SDAM",$J,0),U,4)=VALMCNT
"RTN","SDAM1",22,0)
 Q
"RTN","SDAM1",23,0)
 ;
"RTN","SDAM1",24,0)
BLD1 ; -- build array
"RTN","SDAM1",25,0)
 N SDX,X,Y,Y1,SDSTAT,SDELIG
"RTN","SDAM1",26,0)
 S SDSTAT=$$STATUS(DFN,SDT,SDCL,SDATA,$S($D(SDDA):SDDA,1:""))
"RTN","SDAM1",27,0)
 G BLD1Q:'$$CHK(DFN,SDT,SDCL,SDATA,.SDAMLIST,SDSTAT)
"RTN","SDAM1",28,0)
 ;; Changes for GAF enhancement
"RTN","SDAM1",29,0)
 S SDGAFREQ=" "
"RTN","SDAM1",30,0)
 S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","SDAM1",31,0)
 I $$MHCLIN^SDUTL2(SDCL),'($$COLLAT^SDUTL2(SDELIG)!$P(SDATA,U,11)) D
"RTN","SDAM1",32,0)
 .S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^")
"RTN","SDAM1",33,0)
 .S:SDGAFST SDGAFREQ="*"
"RTN","SDAM1",34,0)
 S SDACNT=SDACNT+1,X="",$P(X," ",VALMWD+1)=""
"RTN","SDAM1",35,0)
 W:(SDACNT#10)=0 "."
"RTN","SDAM1",36,0)
 I SDACNT=SDMAX,$P(SDT,".")'=SDEND S SDEND=$P(SDT,"."),SDLARGE=""
"RTN","SDAM1",37,0)
 S X=SDGAFREQ_$E(X,2,AC-1)_$E(SDACNT_BL,1,AW)_$E(X,AC+AW+1,VALMWD)
"RTN","SDAM1",38,0)
 S X=$E(X,1,NC-1)_$E($$LOWER(SDNAME)_BL,1,NW)_$E(X,NC+NW+1,VALMWD)
"RTN","SDAM1",39,0)
 S X=$E(X,1,XC-1)_$E($$FMTE^XLFDT(SDT,"5Z")_BL,1,XW)_$E(X,XC+XW+1,VALMWD)  ;to make date field work for SD*5.3*189 - uses FM List Template
"RTN","SDAM1",40,0)
 S:'$D(CSTAT) CSTAT="" ;SD/478
"RTN","SDAM1",41,0)
 S X=$E(X,1,CC-1)_$E($S((CSTAT=1!(CSTAT=2)!(CSTAT=13)):" ",$G(CNSTLNK):"Consult",1:"        ")_BL,1,CW)_$E(X,CC+CW+1,VALMWD) K CNSTLNK,CSTAT ;SD/478
"RTN","SDAM1",42,0)
 S Y=$P(SDSTAT,";",3)
"RTN","SDAM1",43,0)
 I Y'["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_BL,1,SW)_$E(X,SC+SW+1,VALMWD)
"RTN","SDAM1",44,0)
 I Y["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_$$ANC_BL,1,SW+TW+1)
"RTN","SDAM1",45,0)
 S Y1=$S($P(SDSTAT,";",5):$P(SDSTAT,";",5),1:$P(SDSTAT,";",4)),Y1=$S($P(Y1,".")=DT:$$TIME($P(Y1,".",2)),1:"")
"RTN","SDAM1",46,0)
 S:Y1]"" X=$E(X,1,TC-1)_$E(Y1_BL,1,TW)_$E(X,TC+TW+1,VALMWD)
"RTN","SDAM1",47,0)
 D SET(X)
"RTN","SDAM1",48,0)
 I $D(SDAMBOLD(DFN,SDT,SDCL)) D FLDCTRL^VALM10(VALMCNT,"STAT",IOINHI,IOINORM),FLDCTRL^VALM10(VALMCNT,"TIME",IOINHI,IOINORM)
"RTN","SDAM1",49,0)
 S ^TMP("SDAMIDX",$J,SDACNT)=VALMCNT_U_DFN_U_SDT_U_SDCL_U_$S($D(SDDA):SDDA,1:"")
"RTN","SDAM1",50,0)
BLD1Q Q
"RTN","SDAM1",51,0)
 ;
"RTN","SDAM1",52,0)
ANC() ; -- set ancillary info
"RTN","SDAM1",53,0)
 N I,Y,C
"RTN","SDAM1",54,0)
 S Y="",C=0
"RTN","SDAM1",55,0)
 F I=3:1:5 I $P(SDATA,U,I)]"" S Y=Y_" "_$P("^^Lab^XRay^EKG",U,I)_"@"_$$TIME($P($P(SDATA,U,I),".",2)),C=C+1 Q:C=2
"RTN","SDAM1",56,0)
 I Y]"" S Y="/"_$E(Y,2,99)
"RTN","SDAM1",57,0)
 Q Y
"RTN","SDAM1",58,0)
 ;  
"RTN","SDAM1",59,0)
SET(X) ;
"RTN","SDAM1",60,0)
 S VALMCNT=VALMCNT+1,^TMP("SDAM",$J,VALMCNT,0)=X
"RTN","SDAM1",61,0)
 S:SDACNT ^TMP("SDAM",$J,"IDX",VALMCNT,SDACNT)=""
"RTN","SDAM1",62,0)
 Q
"RTN","SDAM1",63,0)
 ;
"RTN","SDAM1",64,0)
CHK(DFN,SDT,SDCL,SDATA,SDAMLIST,SDSTAT,SDDA) ; -- does appt meet criteria
"RTN","SDAM1",65,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",66,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",67,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",68,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",69,0)
 ;            SDAMLIST := list definition
"RTN","SDAM1",70,0)
 ;              SDSTAT := appt status data from $$STATUS call
"RTN","SDAM1",71,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",72,0)
 ;  output: [returned] := meets criteria for list [0 - no | 1 - yes ]
"RTN","SDAM1",73,0)
 ;
"RTN","SDAM1",74,0)
 S Y=0
"RTN","SDAM1",75,0)
 I $D(SDAMLIST(+SDSTAT)) S Y=1 G CHKQ
"RTN","SDAM1",76,0)
 I $P(SDAMLIST,U)="ALL" S Y=1
"RTN","SDAM1",77,0)
 I $P(SDAMLIST,U)="CHECKED IN" I $P(SDSTAT,";",3)="ACT REQ/CHECKED IN" S Y=1  ; - SD*5.3*445
"RTN","SDAM1",78,0)
CHKQ I Y,$D(SDAMLIST("SCR")) X SDAMLIST("SCR") S Y=$T
"RTN","SDAM1",79,0)
 Q Y
"RTN","SDAM1",80,0)
 ;
"RTN","SDAM1",81,0)
STATUS(DFN,SDT,SDCL,SDATA,SDDA) ; -- return appt status
"RTN","SDAM1",82,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",83,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",84,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",85,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",86,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",87,0)
 ;  output: [returned] := appt status ifn ^ status name ^ print status ^
"RTN","SDAM1",88,0)
 ;                        check in d/t ^ check out d/t ^ adm mvt ifn
"RTN","SDAM1",89,0)
 ;
"RTN","SDAM1",90,0)
 ;S = status ; C = ci/co indicator ; Y = 'C' node ; P = print status
"RTN","SDAM1",91,0)
 N S,C,Y,P,VADMVT,VAINDT
"RTN","SDAM1",92,0)
 ;
"RTN","SDAM1",93,0)
 ; -- get data for evaluation
"RTN","SDAM1",94,0)
 S:'$G(SDDA) SDDA=+$$FIND^SDAM2(DFN,SDT,SDCL)
"RTN","SDAM1",95,0)
 S Y=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM1",96,0)
 ;
"RTN","SDAM1",97,0)
 ; -- set initial status value ; non-count clinic?
"RTN","SDAM1",98,0)
 S S=$S($P(SDATA,"^",2)]"":$P($P($P(^DD(2.98,3,0),"^",3),$P(SDATA,"^",2)_":",2),";"),$P($G(^SC(SDCL,0)),U,17)="Y":"NON-COUNT",1:"")
"RTN","SDAM1",99,0)
 ;
"RTN","SDAM1",100,0)
 ; -- inpatient?
"RTN","SDAM1",101,0)
 S VAINDT=SDT D ADM^VADPT2
"RTN","SDAM1",102,0)
 I S["INPATIENT",$S('VADMVT:1,'$P(^DG(43,1,0),U,21):0,1:$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D") S S=""
"RTN","SDAM1",103,0)
 ;
"RTN","SDAM1",104,0)
 ; -- determine ci/co indicator
"RTN","SDAM1",105,0)
 S C=$S($P(Y,"^",3):"CHECKED OUT",Y:"CHECKED IN",S]"":"",SDT>(DT+.2359):"FUTURE",1:"NO ACTION TAKEN") S:S="" S=C
"RTN","SDAM1",106,0)
 I S="NO ACTION TAKEN",$P(SDT,".")=DT,C'["CHECKED" S C="TODAY"
"RTN","SDAM1",107,0)
 ; -- $$REQ & $$COCMP in SDM1A not used for speed
"RTN","SDAM1",108,0)
 I S="CHECKED OUT"!(S="CHECKED IN"),SDT'<$P(^DG(43,1,"SCLR"),U,23),'$P($G(^SCE(+$P(SDATA,U,20),0)),U,7) S S="NO ACTION TAKEN"
"RTN","SDAM1",109,0)
 ;
"RTN","SDAM1",110,0)
 ; -- determine print status
"RTN","SDAM1",111,0)
 S P=$S(S=C!(C=""):S,1:"")
"RTN","SDAM1",112,0)
 I P="" D
"RTN","SDAM1",113,0)
 .I S["INPATIENT",$P($G(^SC(SDCL,0)),U,17)'="Y",$P($G(^SCE(+$P(SDATA,U,20),0)),U,7)="" S P=$P(S," ")_"/ACT REQ" Q
"RTN","SDAM1",114,0)
 .I S="NO ACTION TAKEN",C="CHECKED OUT"!(C="CHECKED IN") S P="ACT REQ/"_C Q
"RTN","SDAM1",115,0)
 .S P=$S(S="NO ACTION TAKEN":S,1:$P(S," "))_"/"_C
"RTN","SDAM1",116,0)
 I S["INPATIENT",C="" D
"RTN","SDAM1",117,0)
 .I SDT>(DT+.2359) S P=$P(S," ")_"/FUTURE" Q
"RTN","SDAM1",118,0)
 .S P=$P(S," ")_"/NO ACT TAKN"
"RTN","SDAM1",119,0)
 ;
"RTN","SDAM1",120,0)
STATUSQ Q +$O(^SD(409.63,"AC",S,0))_";"_S_";"_P_";"_$P(Y,"^")_";"_$P(Y,"^",3)_";"_+VADMVT
"RTN","SDAM1",121,0)
 ;
"RTN","SDAM1",122,0)
 ;
"RTN","SDAM1",123,0)
LOWER(X) ; convert to lowercase ; same as LOWER^VALM1 ; here for speed
"RTN","SDAM1",124,0)
 N Y,C,I
"RTN","SDAM1",125,0)
 S Y=$E(X)_$TR($E(X,2,999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ@","abcdefghijklmnopqrstuvwxyz ")
"RTN","SDAM1",126,0)
 F C=" ",",","/" S I=0 F  S I=$F(Y,C,I) Q:'I  S Y=$E(Y,1,I-1)_$TR($E(Y,I),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(Y,I+1,999)
"RTN","SDAM1",127,0)
 Q Y
"RTN","SDAM1",128,0)
 ;
"RTN","SDAM1",129,0)
TIME(X) ; -- format time only :=   hr:min
"RTN","SDAM1",130,0)
 Q $E(X_"0000",1,2)_":"_$E(X_"0000",3,4)
"RTN","SDAMOL1")
0^21^B12779195^B12323286
"RTN","SDAMOL1",1,0)
SDAMOL1 ;ALB/CAW - Retroactive Appointment List (con't);4/15/92
"RTN","SDAMOL1",2,0)
 ;;5.3;Scheduling;**132,466**;Aug 13, 1993;Build 2
"RTN","SDAMOL1",3,0)
 ;
"RTN","SDAMOL1",4,0)
 ;
"RTN","SDAMOL1",5,0)
MAIN ; main sort, by division
"RTN","SDAMOL1",6,0)
 N SDTMP,SDX
"RTN","SDAMOL1",7,0)
 K ^TMP("SDRL",$J),^TMP("SDRAL",$J)
"RTN","SDAMOL1",8,0)
 ;
"RTN","SDAMOL1",9,0)
 ; -- get list of database close out dates
"RTN","SDAMOL1",10,0)
 S SDTMP=SDBEG
"RTN","SDAMOL1",11,0)
 F  D  S SDTMP=$$NEXTDT(SDTMP) Q:SDTMP>SDEND
"RTN","SDAMOL1",12,0)
 . S SDX=$P($$CLOSEOUT^SCDXFU04(SDTMP),U,SDNPDB)
"RTN","SDAMOL1",13,0)
 . IF SDX'=-1 S ^TMP("SDRL",$J,SDTMP)=SDX
"RTN","SDAMOL1",14,0)
 ;
"RTN","SDAMOL1",15,0)
 D SCAN
"RTN","SDAMOL1",16,0)
 D BLD^SDAMOLP
"RTN","SDAMOL1",17,0)
 ;
"RTN","SDAMOL1",18,0)
MAINQ ; -- exit logic
"RTN","SDAMOL1",19,0)
 K SDDV,SDSC,SDCLK,SDCLNM,SDCN,SDCNT,SDAD,SDATA,SDDFN,SDCLIN
"RTN","SDAMOL1",20,0)
 K SDCLINIC,SDCLC,SDASH,SDCSC,SDDIV,SDDATE,SDAPPT,SDFLEN,SDFLG
"RTN","SDAMOL1",21,0)
 K SDPAT,SDPAGE,SDSLEN,SDFST,SDROU,SDSEC,SDSTOP,SDSTPC,SDSTPCDE
"RTN","SDAMOL1",22,0)
 K SDTYPE,SDVISIT,SDWHEN,SDVDT,SDVST,SDVSTDT,SDY,SDTRANS,SDTMP
"RTN","SDAMOL1",23,0)
 K VA,VAERR,X,^TMP("SDRAL",$J)
"RTN","SDAMOL1",24,0)
 Q
"RTN","SDAMOL1",25,0)
 ;
"RTN","SDAMOL1",26,0)
SCAN ; -- api to invoke scan
"RTN","SDAMOL1",27,0)
 ;
"RTN","SDAMOL1",28,0)
 ; -- send message to task manager and check for stop request
"RTN","SDAMOL1",29,0)
 IF $$S^%ZTLOAD("Searching for Retroactive Encounters...") S ZTSTOP=1 G SCANQ
"RTN","SDAMOL1",30,0)
 N SDCB,SDQID
"RTN","SDAMOL1",31,0)
 S SDCB="D CB^SDAMOL1(.Y,.Y0,.SDSTOP)"
"RTN","SDAMOL1",32,0)
 D OPEN^SDQ(.SDQID)
"RTN","SDAMOL1",33,0)
 D ACTIVE^SDQ(.SDQID,"FALSE","SET")
"RTN","SDAMOL1",34,0)
 D INDEX^SDQ(.SDQID,"DATE/TIME","SET")
"RTN","SDAMOL1",35,0)
 D DATE^SDQ(.SDQID,SDBEG,SDEND,"SET")
"RTN","SDAMOL1",36,0)
 D SCANCB^SDQ(.SDQID,SDCB,"SET")
"RTN","SDAMOL1",37,0)
 D ACTIVE^SDQ(.SDQID,"TRUE","SET")
"RTN","SDAMOL1",38,0)
 D SCAN^SDQ(.SDQID,"FORWARD")
"RTN","SDAMOL1",39,0)
 D CLOSE^SDQ(.SDQID)
"RTN","SDAMOL1",40,0)
SCANQ Q
"RTN","SDAMOL1",41,0)
 ;
"RTN","SDAMOL1",42,0)
 ;
"RTN","SDAMOL1",43,0)
CB(SDOE,SDOE0,SDSTOP) ; -- main callback
"RTN","SDAMOL1",44,0)
 N SDVISIT,SDVSTDT,SDPAT,SDSC,SDCL,SDOEP,SDORG,SDEXT,SDDIV,SDOEU
"RTN","SDAMOL1",45,0)
 N SDCLK,SDWHEN,SDCLNM,SDSTPCDE,SDTYPE,SDVSIT,SDCODT,SDSTATUS
"RTN","SDAMOL1",46,0)
 ;
"RTN","SDAMOL1",47,0)
 ; -- has user asked to stop job ; if yes, kill data & quit
"RTN","SDAMOL1",48,0)
 IF $$S^%ZTLOAD() D  G CBQ
"RTN","SDAMOL1",49,0)
 . S (SDSTOP,ZTSTOP)=1
"RTN","SDAMOL1",50,0)
 . K ^TMP("SDRAL",$J)
"RTN","SDAMOL1",51,0)
 ;
"RTN","SDAMOL1",52,0)
 ; -- set up variables for data fields
"RTN","SDAMOL1",53,0)
 S SDVISIT=SDOE
"RTN","SDAMOL1",54,0)
 S SDVSTDT=+SDOE0
"RTN","SDAMOL1",55,0)
 S SDPAT=+$P(SDOE0,U,2)
"RTN","SDAMOL1",56,0)
 S SDSC=+$P(SDOE0,U,3)
"RTN","SDAMOL1",57,0)
 S SDCL=+$P(SDOE0,U,4)
"RTN","SDAMOL1",58,0)
 S SDVSIT=+$P(SDOE0,U,5)
"RTN","SDAMOL1",59,0)
 S SDOEP=+$P(SDOE0,U,6)
"RTN","SDAMOL1",60,0)
 S SDCODT=+$P(SDOE0,U,7)
"RTN","SDAMOL1",61,0)
 S SDORG=+$P(SDOE0,U,8)
"RTN","SDAMOL1",62,0)
 S SDEXT=+$P(SDOE0,U,9)
"RTN","SDAMOL1",63,0)
 S SDDIV=+$P(SDOE0,U,11)
"RTN","SDAMOL1",64,0)
 S SDSTATUS=+$P(SDOE0,U,12)
"RTN","SDAMOL1",65,0)
 S SDOEU=$G(^SCE(SDOE,"USER"))
"RTN","SDAMOL1",66,0)
 S SDCLK=+SDOEU
"RTN","SDAMOL1",67,0)
 S SDWHEN=+$P(SDOEU,U,4)
"RTN","SDAMOL1",68,0)
 ;
"RTN","SDAMOL1",69,0)
 ; -- drived data
"RTN","SDAMOL1",70,0)
 IF 'SDWHEN,SDORG=1 S SDWHEN=+$P($G(^SC(SDCL,"S",SDVSTDT,1,SDEXT,0)),U,7)
"RTN","SDAMOL1",71,0)
 IF 'SDWHEN S SDWHEN=+$P($G(^AUPNVSIT(SDVSIT,0)),U,2)
"RTN","SDAMOL1",72,0)
 S SDCLNM=$P($G(^SC(SDCL,0),0),U)
"RTN","SDAMOL1",73,0)
 S SDSTPCDE=+$P($G(^DIC(40.7,SDSC,0)),U,2)
"RTN","SDAMOL1",74,0)
 S SDTYPE=$S(SDORG=1:"APPOINTMENT",SDORG=2:"STANDALONE",SDORG=3:"DISPOSITION",1:"UNKNOWN")
"RTN","SDAMOL1",75,0)
 ;
"RTN","SDAMOL1",76,0)
 ; -- quit if encounter has parent
"RTN","SDAMOL1",77,0)
 IF SDOEP G CBQ
"RTN","SDAMOL1",78,0)
 ;
"RTN","SDAMOL1",79,0)
 ; -- quit if no 'created' date found
"RTN","SDAMOL1",80,0)
 IF 'SDWHEN G CBQ
"RTN","SDAMOL1",81,0)
 ;
"RTN","SDAMOL1",82,0)
 ; -- quit if 'created' before close out date
"RTN","SDAMOL1",83,0)
 IF '$$TMP(+SDOE0,SDWHEN) G CBQ
"RTN","SDAMOL1",84,0)
 ;
"RTN","SDAMOL1",85,0)
 ; -- quit if no checked out completion date/time
"RTN","SDAMOL1",86,0)
 IF 'SDCODT G CBQ
"RTN","SDAMOL1",87,0)
 ;
"RTN","SDAMOL1",88,0)
 ; -- quit if not status is not 'checked out' or 'inpatient'
"RTN","SDAMOL1",89,0)
 IF "^8^2^"'[("^"_SDSTATUS_"^") G CBQ
"RTN","SDAMOL1",90,0)
 ;
"RTN","SDAMOL1",91,0)
 ; -- quit if non-count clinic
"RTN","SDAMOL1",92,0)
 IF $P($G(^SC(SDCL,0)),U,17)="Y" G CBQ
"RTN","SDAMOL1",93,0)
 ;
"RTN","SDAMOL1",94,0)
 ; -- quit if division or clinic or stop code not valid for report
"RTN","SDAMOL1",95,0)
 IF '$$DIV() G CBQ
"RTN","SDAMOL1",96,0)
 IF '$$CLINIC() G CBQ
"RTN","SDAMOL1",97,0)
 IF '$$STOP() G CBQ
"RTN","SDAMOL1",98,0)
 ;
"RTN","SDAMOL1",99,0)
 D SET
"RTN","SDAMOL1",100,0)
CBQ Q
"RTN","SDAMOL1",101,0)
 ;
"RTN","SDAMOL1",102,0)
 ;
"RTN","SDAMOL1",103,0)
NEXTDT(X1) ; -- get next date
"RTN","SDAMOL1",104,0)
 N X2
"RTN","SDAMOL1",105,0)
 S X2=1 D C^%DTC
"RTN","SDAMOL1",106,0)
 Q X
"RTN","SDAMOL1",107,0)
 ;
"RTN","SDAMOL1",108,0)
SET ;^TMP("SDRAL",$J,Division,Stop Code,Visit Date,Patient)
"RTN","SDAMOL1",109,0)
 ;
"RTN","SDAMOL1",110,0)
 S ^TMP("SDRAL",$J,SDDIV,SDSTPCDE,SDVSTDT,SDPAT)=SDVISIT_U_SDWHEN_U_SDCLK_U_SDTYPE_U_^TMP("SDRL",$J,$P(SDVSTDT,"."))_U_SDCLNM
"RTN","SDAMOL1",111,0)
SETQ Q
"RTN","SDAMOL1",112,0)
 ;
"RTN","SDAMOL1",113,0)
TMP(SDENCDT,SDMADE) ; -- Check to see if ^TMP("SDRL",$J,Encounter Date/Time)
"RTN","SDAMOL1",114,0)
 ;                    exists
"RTN","SDAMOL1",115,0)
 ;  input - SDENCDT := encounter date/time
"RTN","SDAMOL1",116,0)
 ;          SDMADE  := date encounter made
"RTN","SDAMOL1",117,0)
 ;
"RTN","SDAMOL1",118,0)
 ; output - 1 or 0
"RTN","SDAMOL1",119,0)
 ;
"RTN","SDAMOL1",120,0)
 IF '$D(^TMP("SDRL",$J,$P(SDENCDT,"."))) Q 0
"RTN","SDAMOL1",121,0)
 Q ^TMP("SDRL",$J,$P(SDENCDT,"."))<(SDMADE_.9)
"RTN","SDAMOL1",122,0)
 ;
"RTN","SDAMOL1",123,0)
DIV() ; -- valid division for report ?
"RTN","SDAMOL1",124,0)
 Q $S(VAUTD=1:1,1:$D(VAUTD(SDDIV)))
"RTN","SDAMOL1",125,0)
 ;
"RTN","SDAMOL1",126,0)
CLINIC() ; -- valid clinic for report ?
"RTN","SDAMOL1",127,0)
 Q $S('$D(VAUTC):1,VAUTC=1:1,1:$D(VAUTC(SDCL)))
"RTN","SDAMOL1",128,0)
 ;
"RTN","SDAMOL1",129,0)
STOP() ; -- valid stop code for report ?
"RTN","SDAMOL1",130,0)
 Q $S('$D(VAUTS):1,VAUTS=1:1,1:$D(VAUTS(SDSC)))
"RTN","SDAMOL1",131,0)
 ;
"RTN","SDAMQ3")
0^28^B13578010^B13678612
"RTN","SDAMQ3",1,0)
SDAMQ3 ;ALB/MJK - AM Background Job/Appointments ; 12/1/91
"RTN","SDAMQ3",2,0)
 ;;5.3;Scheduling;**24,466**;Aug 13, 1993;Build 2
"RTN","SDAMQ3",3,0)
 ;
"RTN","SDAMQ3",4,0)
EN(SDBEG,SDEND) ; -- search appts
"RTN","SDAMQ3",5,0)
 N VAUTD,SDCL,X,SDIVNM,SDNAME,SDT,SDDA,SDREQ,SDNONCNT
"RTN","SDAMQ3",6,0)
 S VAUTD=+$P($G(^DG(43,1,"GL")),U,2) S:'VAUTD VAUTD(+$O(^DG(40.8,0)))=""
"RTN","SDAMQ3",7,0)
 S SDCL=0 F  S SDCL=$O(^SC(SDCL)) Q:'SDCL  S X=$G(^SC(SDCL,0)) I $P(X,U,3)["C" D
"RTN","SDAMQ3",8,0)
 .S SDNONCNT=($P(X,U,17)="Y") ; non-count clinic?
"RTN","SDAMQ3",9,0)
 .S SDNAME=$E($P(X,U),1,30),SDIVNM=""
"RTN","SDAMQ3",10,0)
 .S X=$$DIV^SDAMU(.SDCL,.VAUTD,.SDIVNM,35)
"RTN","SDAMQ3",11,0)
 .S SDT=SDBEG F  S SDT=$O(^SC(SDCL,"S",SDT)) Q:'SDT!(SDT>SDEND)  S SDREQ=$$REQ^SDM1A(.SDT) D
"RTN","SDAMQ3",12,0)
 ..S SDDA=0 F  S SDDA=$O(^SC(SDCL,"S",SDT,1,SDDA)) Q:'SDDA  D CHK(SDCL,SDT,SDDA,.SDIVNM,.SDNAME,.SDREQ)
"RTN","SDAMQ3",13,0)
ENQ Q
"RTN","SDAMQ3",14,0)
 ;
"RTN","SDAMQ3",15,0)
CHK(SDCL,SDT,SDDA,SDIVNM,SDNAME,SDREQ) ; -- check appts
"RTN","SDAMQ3",16,0)
 ; input: SDCL := clinic ifn
"RTN","SDAMQ3",17,0)
 ;         SDT := appt d/t
"RTN","SDAMQ3",18,0)
 ;        SDDA := ifn of appt mutiple
"RTN","SDAMQ3",19,0)
 ;      SDIVNM := division name
"RTN","SDAMQ3",20,0)
 ;      SDNAME := clinic name
"RTN","SDAMQ3",21,0)
 ;       SDREQ := required for credit (ci or co)
"RTN","SDAMQ3",22,0)
 ;
"RTN","SDAMQ3",23,0)
 N SD0,SDC,SDNAT,Y,X,DFN,SDPT,SDOE
"RTN","SDAMQ3",24,0)
 S SD0=$G(^SC(SDCL,"S",SDT,1,SDDA,0)),SDC=$G(^("C")),SDNAT=0,DFN=+SD0
"RTN","SDAMQ3",25,0)
 S SDPT=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDAMQ3",26,0)
 ;
"RTN","SDAMQ3",27,0)
 ; -- must be same clinic
"RTN","SDAMQ3",28,0)
 I SDCL'=+SDPT G CHKQ
"RTN","SDAMQ3",29,0)
 ;
"RTN","SDAMQ3",30,0)
 ; -- valid appointment
"RTN","SDAMQ3",31,0)
 I '$$VALID^SDAM2(DFN,SDCL,SDT,SDDA) G CHKQ
"RTN","SDAMQ3",32,0)
 ;
"RTN","SDAMQ3",33,0)
 ; -- check if canceled or no-showed
"RTN","SDAMQ3",34,0)
 S X=$P(SDPT,U,2) I X'="I",X'="",X'="NT" G CHKQ
"RTN","SDAMQ3",35,0)
 ;
"RTN","SDAMQ3",36,0)
 ; -- re-set for inpatient appt
"RTN","SDAMQ3",37,0)
 I X="I"!(X="") D
"RTN","SDAMQ3",38,0)
 .N Y
"RTN","SDAMQ3",39,0)
 .S Y=$$INP^SDAM2(DFN,SDT)
"RTN","SDAMQ3",40,0)
 .I X'=Y S $P(SDPT,U,2)=Y,^DPT(DFN,"S",SDT,0)=SDPT
"RTN","SDAMQ3",41,0)
 .;I Y="I" D CO(DFN,SDT,SDCL,SDREQ)
"RTN","SDAMQ3",42,0)
 ;
"RTN","SDAMQ3",43,0)
 ; -- non-count processing
"RTN","SDAMQ3",44,0)
 I SDNONCNT D CO(DFN,SDT,SDCL,SDREQ) G CHKQ
"RTN","SDAMQ3",45,0)
 ;
"RTN","SDAMQ3",46,0)
 ; -- has appt been checked in or out
"RTN","SDAMQ3",47,0)
 I SDREQ="CI",SDC!($P(SDC,U,3)) G TOT
"RTN","SDAMQ3",48,0)
 I SDREQ="CO" S SDOE=+$$GETAPT^SDVSIT2(DFN,SDT,SDCL) I $P(SDC,U,3),$$CO^SDAMQ(SDOE) G TOT
"RTN","SDAMQ3",49,0)
 G TOT:'SD0
"RTN","SDAMQ3",50,0)
 ;
"RTN","SDAMQ3",51,0)
 ; -- if good appt then set to nt
"RTN","SDAMQ3",52,0)
 I $P(SDPT,U,2)="" S $P(^DPT(DFN,"S",SDT,0),U,2)="NT",SDPT=^(0)
"RTN","SDAMQ3",53,0)
 ;
"RTN","SDAMQ3",54,0)
 ; -- set nt flag
"RTN","SDAMQ3",55,0)
 I $P(SDPT,U,2)="NT" S SDNAT=1
"RTN","SDAMQ3",56,0)
 ;
"RTN","SDAMQ3",57,0)
TOT ; -- set totals clinic
"RTN","SDAMQ3",58,0)
 S X=$G(^TMP("SDSTATS",$J,SDIVNM,"APPT",SDNAME)),^(SDNAME)=(X+SDNAT)_U_($P(X,U,2)+1)
"RTN","SDAMQ3",59,0)
CHKQ Q
"RTN","SDAMQ3",60,0)
 ;
"RTN","SDAMQ3",61,0)
CO(DFN,SDT,SDCL,SDREQ) ; -- attempt to CO quietly for inpats and non-counts
"RTN","SDAMQ3",62,0)
 I SDREQ'="CO" G COQ
"RTN","SDAMQ3",63,0)
 ; -- get encounter ien
"RTN","SDAMQ3",64,0)
 N SDOE S SDOE=+$$GETAPT^SDVSIT2(DFN,SDT,SDCL)
"RTN","SDAMQ3",65,0)
 ; -- if not checked out, try to co
"RTN","SDAMQ3",66,0)
 I '$$CO^SDAMQ(SDOE) D EN^SDCOM(SDOE,0)
"RTN","SDAMQ3",67,0)
COQ Q
"RTN","SDAMQ3",68,0)
 ;
"RTN","SDAMQ3",69,0)
BULL(SDIVNM,SDLN,SDTOT) ;
"RTN","SDAMQ3",70,0)
 N SDNAME,NAT,GRAND,OTHER,TGRAND,TNAT
"RTN","SDAMQ3",71,0)
 S SDNAME="",(TNAT,TGRAND,OTHER)=0
"RTN","SDAMQ3",72,0)
 D HDR
"RTN","SDAMQ3",73,0)
 F  S SDNAME=$O(^TMP("SDSTATS",$J,SDIVNM,"APPT",SDNAME)) Q:SDNAME=""  S X=^(SDNAME) D
"RTN","SDAMQ3",74,0)
 .S NAT=+X,GRAND=+$P(X,U,2)
"RTN","SDAMQ3",75,0)
 .S TNAT=TNAT+NAT,TGRAND=TGRAND+GRAND
"RTN","SDAMQ3",76,0)
 .S SDTOT("DIV","NAT")=SDTOT("DIV","NAT")+NAT
"RTN","SDAMQ3",77,0)
 .S SDTOT("DIV","GRAND")=SDTOT("DIV","GRAND")+GRAND
"RTN","SDAMQ3",78,0)
 .I 'NAT S OTHER=OTHER+GRAND
"RTN","SDAMQ3",79,0)
 .I NAT D LINE(SDNAME,NAT,GRAND)
"RTN","SDAMQ3",80,0)
 D LINE("ALL OTHER CLINICS",0,OTHER)
"RTN","SDAMQ3",81,0)
 D SET("         -------------                 ----------------    -------   -------")
"RTN","SDAMQ3",82,0)
 D LINE("Clinic Totals",TNAT,TGRAND)
"RTN","SDAMQ3",83,0)
BULLQ Q
"RTN","SDAMQ3",84,0)
 ;
"RTN","SDAMQ3",85,0)
LINE(CAPTION,NAT,GRAND) ;
"RTN","SDAMQ3",86,0)
 ; input: CAPTION := text for leftmost col
"RTN","SDAMQ3",87,0)
 ;            NAT := # of encounters requiring action
"RTN","SDAMQ3",88,0)
 ;          GRAND := total # of encounters
"RTN","SDAMQ3",89,0)
 N Y
"RTN","SDAMQ3",90,0)
 S Y="",Y=$$SETSTR^VALM1(CAPTION,Y,10,25),Y=$$SETSTR^VALM1($J(NAT,7),Y,43,7),Y=$$SETSTR^VALM1($J(GRAND,7),Y,60,7),Y=$$SETSTR^VALM1($J($S(GRAND:100*(NAT/GRAND),1:0),6,1)_"%",Y,70,7) D SET(Y)
"RTN","SDAMQ3",91,0)
 Q
"RTN","SDAMQ3",92,0)
 ;
"RTN","SDAMQ3",93,0)
SET(X) ;
"RTN","SDAMQ3",94,0)
 S SDLN=SDLN+1,^TMP("SDAMTEXT",$J,SDLN,0)=X
"RTN","SDAMQ3",95,0)
 Q
"RTN","SDAMQ3",96,0)
 ;
"RTN","SDAMQ3",97,0)
HDR ;
"RTN","SDAMQ3",98,0)
 ; input:  SDIVNM := division name
"RTN","SDAMQ3",99,0)
 ;
"RTN","SDAMQ3",100,0)
 D SET("")
"RTN","SDAMQ3",101,0)
 D SET("                                       Appointments          Total")
"RTN","SDAMQ3",102,0)
 D SET("         Clinic                        Requiring Action      Appts     Pct.")
"RTN","SDAMQ3",103,0)
 D SET("         ------                        ----------------    -------   -------")
"RTN","SDAMQ3",104,0)
 Q
"RTN","SDCO3")
0^3^B3913935^B4211941
"RTN","SDCO3",1,0)
SDCO3 ;ALB/RMO - Provider - Check Out;08 DEC 1992 4:05 pm
"RTN","SDCO3",2,0)
 ;;5.3;Scheduling;**28,27,44,67,71,132,466**;08/13/93;Build 2
"RTN","SDCO3",3,0)
 ;
"RTN","SDCO3",4,0)
EN ;Entry point for SDCO PROVIDER protocol
"RTN","SDCO3",5,0)
 ; Input  -- SDOE
"RTN","SDCO3",6,0)
 ;
"RTN","SDCO3",7,0)
 S VALMBCK=""
"RTN","SDCO3",8,0)
 ;
"RTN","SDCO3",9,0)
 ; -- if OLD encounter, quit
"RTN","SDCO3",10,0)
 IF '$$EDITOK($G(SDOE),1) G ENQ
"RTN","SDCO3",11,0)
 ;
"RTN","SDCO3",12,0)
 ; -- call PCE interview
"RTN","SDCO3",13,0)
 N SDVISIT,SDHL
"RTN","SDCO3",14,0)
 S SDVISIT=$P($G(^SCE(+SDOE,0)),U,5)
"RTN","SDCO3",15,0)
 S X=$$INTV^PXAPI("PRV","SD","PIMS",SDVISIT)
"RTN","SDCO3",16,0)
 D BLD^SDCO S VALMBCK="R"
"RTN","SDCO3",17,0)
ENQ Q
"RTN","SDCO3",18,0)
 ;
"RTN","SDCO3",19,0)
PRASK(SDOE) ;Ask Provider on Check Out
"RTN","SDCO3",20,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO3",21,0)
 ; Output -- 0=No, 1=Yes/Required, 2=Yes/Not Required
"RTN","SDCO3",22,0)
 N SDCL,SDOE0,SDORG,Y
"RTN","SDCO3",23,0)
 S SDOE0=$G(^SCE(+SDOE,0)),SDCL=+$P(SDOE0,"^",4),SDORG=+$P(SDOE0,"^",8)
"RTN","SDCO3",24,0)
 I $$REQ^SDM1A(+SDOE0)'="CO" G PRASKQ
"RTN","SDCO3",25,0)
 I SDORG=1,'$$CLINIC^SDAMU(SDCL) G PRASKQ
"RTN","SDCO3",26,0)
 ;I "^1^2^"[("^"_SDORG_"^"),$$INP^SDAM2(+$P(SDOE0,"^",2),+SDOE0)="I" G PRASKQ  ;SD*5.3*466 allow provider check for inpatients 
"RTN","SDCO3",27,0)
 I +SDOE0<2961001 S Y=2 G PRASKQ
"RTN","SDCO3",28,0)
 I SDCL S Y=1 G PRASKQ
"RTN","SDCO3",29,0)
 I SDORG=3 S Y=1
"RTN","SDCO3",30,0)
PRASKQ Q +$G(Y)
"RTN","SDCO3",31,0)
 ;
"RTN","SDCO3",32,0)
SET(SDOE) ;Set-up Provider Array for Outpatient Encounter
"RTN","SDCO3",33,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO3",34,0)
 ; Output -- SDPRY     Provider Array Subscripted by a Number
"RTN","SDCO3",35,0)
 ;           SDCNT     Number of Array Entries
"RTN","SDCO3",36,0)
 N SDVA200,SDVPRV,SDPRVS
"RTN","SDCO3",37,0)
 K SDPRY
"RTN","SDCO3",38,0)
 D GETPRV^SDOE(SDOE,"SDPRVS")
"RTN","SDCO3",39,0)
 S (SDCNT,SDVPRV)=0
"RTN","SDCO3",40,0)
 F  S SDVPRV=$O(SDPRVS(SDVPRV)) Q:'SDVPRV  D
"RTN","SDCO3",41,0)
 . S SDVA200=+$G(SDPRVS(SDVPRV))
"RTN","SDCO3",42,0)
 . S SDCNT=SDCNT+1
"RTN","SDCO3",43,0)
 . S SDPRY(SDCNT)=SDVPRV_"^"_SDVA200
"RTN","SDCO3",44,0)
SETQ Q
"RTN","SDCO3",45,0)
 ;
"RTN","SDCO3",46,0)
LIST(SDPRY) ;List Provider Array
"RTN","SDCO3",47,0)
 ; Input  -- SDPRY     Provider Array Subscripted by a Number
"RTN","SDCO3",48,0)
 ; Output -- List Provider Array
"RTN","SDCO3",49,0)
 N I
"RTN","SDCO3",50,0)
 W !
"RTN","SDCO3",51,0)
 S I=0 F  S I=$O(SDPRY(I)) Q:'I  W !?2,I,"  ",$$PR^SDCO31(+$P(SDPRY(I),"^",2))
"RTN","SDCO3",52,0)
 Q
"RTN","SDCO3",53,0)
 ;
"RTN","SDCO3",54,0)
EDITOK(SDOE,SDMODE) ; -- ok to edit?
"RTN","SDCO3",55,0)
 ; input:  SDOE   := ien of 409.68                  [required]
"RTN","SDCO3",56,0)
 ;         SDMODE := 1 -- interactive ; 0 -- silent [required]
"RTN","SDCO3",57,0)
 ;
"RTN","SDCO3",58,0)
 ; returned:  1 -- yes, it's ok to edit or delete SDOE entry
"RTN","SDCO3",59,0)
 ;            0 -- no, cannot not change SDOE entry
"RTN","SDCO3",60,0)
 ;
"RTN","SDCO3",61,0)
 N DIR,SDOK
"RTN","SDCO3",62,0)
 S SDOK=$$NEW^SDPCE($P($G(^SCE(+$G(SDOE),0)),U))
"RTN","SDCO3",63,0)
 IF 'SDOK,SDMODE D OLDMSG
"RTN","SDCO3",64,0)
EDITOKQ Q SDOK
"RTN","SDCO3",65,0)
 ;
"RTN","SDCO3",66,0)
OLDMSG ; -- display message to user
"RTN","SDCO3",67,0)
 W !!,">>> Editing and deleting old encounters not allowed.",!
"RTN","SDCO3",68,0)
 N DIR
"RTN","SDCO3",69,0)
 S DIR(0)="E"
"RTN","SDCO3",70,0)
 S DIR("A")="Press Return key to continue"
"RTN","SDCO3",71,0)
 D ^DIR
"RTN","SDCO3",72,0)
 Q
"RTN","SDCO3",73,0)
 ;
"RTN","SDCO4")
0^4^B3130065^B3432130
"RTN","SDCO4",1,0)
SDCO4 ;ALB/RMO - Diagnosis - Check Out;08 DEC 1992 4:05 pm
"RTN","SDCO4",2,0)
 ;;5.3;Scheduling;**32,27,44,67,77,85,132,466**;08/13/93;Build 2
"RTN","SDCO4",3,0)
 ;
"RTN","SDCO4",4,0)
EN ;Entry point for SDCO DIAGNOSIS protocol
"RTN","SDCO4",5,0)
 ; Input  -- SDOE
"RTN","SDCO4",6,0)
 ;
"RTN","SDCO4",7,0)
 S VALMBCK=""
"RTN","SDCO4",8,0)
 ;
"RTN","SDCO4",9,0)
 ; -- if OLD encounter, quit
"RTN","SDCO4",10,0)
 IF '$$EDITOK^SDCO3($G(SDOE),1) G ENQ
"RTN","SDCO4",11,0)
 ;
"RTN","SDCO4",12,0)
 ; -- call PCE interview
"RTN","SDCO4",13,0)
 N SDVISIT,SDHL
"RTN","SDCO4",14,0)
 S SDVISIT=$P($G(^SCE(+SDOE,0)),U,5)
"RTN","SDCO4",15,0)
 S X=$$INTV^PXAPI("POV","SD","PIMS",SDVISIT)
"RTN","SDCO4",16,0)
 D BLD^SDCO S VALMBCK="R"
"RTN","SDCO4",17,0)
ENQ Q
"RTN","SDCO4",18,0)
 ;
"RTN","SDCO4",19,0)
DXASK(SDOE) ;Ask Diagnosis on Check Out
"RTN","SDCO4",20,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO4",21,0)
 ; Output --  0=No, 1=Yes/Required, 2=Yes/Not Required
"RTN","SDCO4",22,0)
 N SDCL,SDOE0,SDORG,Y
"RTN","SDCO4",23,0)
 S SDOE0=$G(^SCE(+SDOE,0)),SDCL=+$P(SDOE0,"^",4),SDORG=+$P(SDOE0,"^",8)
"RTN","SDCO4",24,0)
 I $$REQ^SDM1A(+SDOE0)'="CO" G DXASKQ
"RTN","SDCO4",25,0)
 I $$OCASN(SDOE) G DXASKQ
"RTN","SDCO4",26,0)
 I SDORG=1,'$$CLINIC^SDAMU(SDCL) G DXASKQ
"RTN","SDCO4",27,0)
 ;I "^1^2^"[("^"_SDORG_"^"),$$INP^SDAM2(+$P(SDOE0,"^",2),+SDOE0)="I" G DXASKQ  ;SD*5.3*466 allow diagnosis check for inpatients
"RTN","SDCO4",28,0)
 I +SDOE0<2961001 S Y=2 G DXASKQ
"RTN","SDCO4",29,0)
 I SDCL S Y=1 G DXASKQ
"RTN","SDCO4",30,0)
 I SDORG=3 S Y=1
"RTN","SDCO4",31,0)
DXASKQ Q +$G(Y)
"RTN","SDCO4",32,0)
 ;
"RTN","SDCO4",33,0)
OCASN(SDOE) ;determines if this is an occasion of service.
"RTN","SDCO4",34,0)
 ;  returns a 1 if and occasion 0 if not
"RTN","SDCO4",35,0)
 ;
"RTN","SDCO4",36,0)
 N ANS
"RTN","SDCO4",37,0)
 S ANS=$$CHKOCC^SCMSVDG1(SDOE)
"RTN","SDCO4",38,0)
 Q +$G(ANS)
"RTN","SDCO4",39,0)
 ;
"RTN","SDCO4",40,0)
SET(SDOE) ;Set-up Diagnosis Array for Outpatient Encounter
"RTN","SDCO4",41,0)
 ; Input  -- SDOE      Outpatient Encounter IEN
"RTN","SDCO4",42,0)
 ; Output -- SDDXY     Diagnosis Array Subscripted by a Number
"RTN","SDCO4",43,0)
 ;           SDCNT     Number of Array Entries
"RTN","SDCO4",44,0)
 N SDICD9,SDVPOV,SDDXS
"RTN","SDCO4",45,0)
 K SDDXY
"RTN","SDCO4",46,0)
 D GETDX^SDOE(SDOE,"SDDXS")
"RTN","SDCO4",47,0)
 S (SDCNT,SDVPOV)=0
"RTN","SDCO4",48,0)
 F  S SDVPOV=$O(SDDXS(SDVPOV)) Q:'SDVPOV  D
"RTN","SDCO4",49,0)
 . S SDICD9=+$G(SDDXS(SDVPOV))
"RTN","SDCO4",50,0)
 . S SDCNT=SDCNT+1
"RTN","SDCO4",51,0)
 . S SDDXY(SDCNT)=SDVPOV_"^"_SDICD9
"RTN","SDCO4",52,0)
SETQ Q
"RTN","SDCO4",53,0)
 ;
"RTN","SDCO4",54,0)
LIST(SDDXY) ;List Diagnosis Array
"RTN","SDCO4",55,0)
 ; Input  -- SDDXY     Diagnosis Array Subscripted by a Number
"RTN","SDCO4",56,0)
 ; Output -- List Diagnosis Array
"RTN","SDCO4",57,0)
 N I,SDDXD
"RTN","SDCO4",58,0)
 W !
"RTN","SDCO4",59,0)
 S I=0 F  S I=$O(SDDXY(I)) Q:'I  S SDDXD=$$DX^SDCO41(+$P(SDDXY(I),"^",2)) W !?2,I,"  ",$P(SDDXD,"^"),?15,$P(SDDXD,"^",2)
"RTN","SDCO4",60,0)
 Q
"RTN","SDCO4",61,0)
 ;
"RTN","SDCOM")
0^29^B5826254^B6043107
"RTN","SDCOM",1,0)
SDCOM ;ALB/RMO - Process Completion - Check Out;12 MAR 1993 11:10 am
"RTN","SDCOM",2,0)
 ;;5.3;Scheduling;**15,60,105,132,466**;Aug 13, 1993;Build 2
"RTN","SDCOM",3,0)
 ;
"RTN","SDCOM",4,0)
EN(SDOE,SDMOD,SDCPHDL,SDCOMF) ;Complete Check Out Process
"RTN","SDCOM",5,0)
 ; Input  -- SDOE     Outpatient Encounter file IEN
"RTN","SDCOM",6,0)
 ;           SDMOD    1=Interactive and 0=Non-interactive
"RTN","SDCOM",7,0)
 ;           SDCPHDL  Check Out Completion Handle  [Optional]
"RTN","SDCOM",8,0)
 ; Output -- SDCOMF   0=Incomplete, 1=Complete, 2=Already Complete
"RTN","SDCOM",9,0)
 N SDEVTF
"RTN","SDCOM",10,0)
 I $P($G(^SCE(+SDOE,0)),"^",7) S SDCOMF=2 G Q
"RTN","SDCOM",11,0)
 I '$$CHK(SDOE) S SDCOMF=0 W:$G(SDMOD) !!,*7,">>> ",$$ORG^SDCOU($P($G(^SCE(+SDOE,0)),"^",8))," not checked out.  Required information missing." G Q
"RTN","SDCOM",12,0)
 I '$G(SDCPHDL) N SDATA,SDCPHDL S SDEVTF=1 D EVT^SDCOU1(SDOE,"BEFORE",.SDCPHDL,.SDATA)
"RTN","SDCOM",13,0)
 D UPD(SDOE) S SDCOMF=1 I $G(SDMOD) D MSG
"RTN","SDCOM",14,0)
 I $G(SDEVTF),$G(SDCPHDL) D EVT^SDCOU1(SDOE,"AFTER",SDCPHDL,.SDATA)
"RTN","SDCOM",15,0)
Q Q
"RTN","SDCOM",16,0)
 ;
"RTN","SDCOM",17,0)
CHK(SDOE) ;Check if Process is Complete for Check Out
"RTN","SDCOM",18,0)
 ; Input  -- SDOE     Outpatient Encounter file IEN
"RTN","SDCOM",19,0)
 ; Output -- Process is Complete for Check Out
"RTN","SDCOM",20,0)
 ;           1=Yes and 0=No
"RTN","SDCOM",21,0)
 N DFN,SDCHK,SDCL,SDCLOEY,SDCOQUIT,SDCTI,SDDA,SDOE0,SDOEP,SDORG,SDSCDI,SDT,SCPROCA
"RTN","SDCOM",22,0)
 S SDOE0=$G(^SCE(+SDOE,0)),SDT=+SDOE0,DFN=+$P(SDOE0,"^",2),SDSCDI=$P(SDOE0,"^",3),SDCL=+$P(SDOE0,"^",4),SDOEP=+$P(SDOE0,"^",6),SDORG=+$P(SDOE0,"^",8),SDDA=+$P(SDOE0,"^",9)
"RTN","SDCOM",23,0)
 S SDCHK=1
"RTN","SDCOM",24,0)
 I SDOEP S SDCHK=0 G CHKQ
"RTN","SDCOM",25,0)
 I SDORG=1,'$$CODT^SDCOU(DFN,SDT,SDCL) D  G CHKQ:'SDCHK
"RTN","SDCOM",26,0)
 .I $$REQ^SDM1A(SDT)="CO" S SDCHK=0 Q
"RTN","SDCOM",27,0)
 .D DT^SDCO1(DFN,SDT,SDCL,SDDA,0,"",.SDCOQUIT)
"RTN","SDCOM",28,0)
 I $$REQ^SDM1A(SDT)'="CO" G CHKQ
"RTN","SDCOM",29,0)
 I SDORG=1,'$$CLINIC^SDAMU(SDCL) G CHKQ
"RTN","SDCOM",30,0)
 ;I "^1^2^"[("^"_SDORG_"^"),$$INP^SDAM2(DFN,SDT)="I" G CHKQ  ;SD*5.3*466 allow checks for inpatients as outpatients
"RTN","SDCOM",31,0)
 D CLASK^SDCO2(SDOE,.SDCLOEY)
"RTN","SDCOM",32,0)
 I $D(SDCLOEY) D  G CHKQ:'SDCHK
"RTN","SDCOM",33,0)
 .S SDCTI=0 F  S SDCTI=$O(SDCLOEY(SDCTI)) Q:'SDCTI  I $G(SDCLOEY(SDCTI))="" S SDCHK=0
"RTN","SDCOM",34,0)
 I $$PRASK^SDCO3(SDOE),'$$PRV^SDOE(SDOE) S SDCHK=0 G CHKQ
"RTN","SDCOM",35,0)
 I $$DXASK^SDCO4(SDOE),'$$GETPDX^SDOE(SDOE) S SDCHK=0 G CHKQ
"RTN","SDCOM",36,0)
 I '$$CPT^SDOE(SDOE) S SDCHK=0 G CHKQ
"RTN","SDCOM",37,0)
CHKQ Q +$G(SDCHK)
"RTN","SDCOM",38,0)
 ;
"RTN","SDCOM",39,0)
UPD(SDOE) ;Update Check Out Process Completion Date
"RTN","SDCOM",40,0)
 ; Input  -- SDOE     Outpatient Encounter file IEN
"RTN","SDCOM",41,0)
 ; Output -- Update Check Out Process Completion Date
"RTN","SDCOM",42,0)
 N DA,DE,DIE,DQ,DR
"RTN","SDCOM",43,0)
 G UPDQ:'$D(^SCE(+SDOE,0))
"RTN","SDCOM",44,0)
 S DA=+SDOE,DIE="^SCE(",DR=".07///NOW"
"RTN","SDCOM",45,0)
 D ^DIE
"RTN","SDCOM",46,0)
UPDQ Q
"RTN","SDCOM",47,0)
 ;
"RTN","SDCOM",48,0)
MSG ;Check Out Message
"RTN","SDCOM",49,0)
 W !!?8,"...checked out ",$$FTIME^VALM1($P($G(^SCE(+SDOE,0)),"^",7))
"RTN","SDCOM",50,0)
 Q
"VER")
8.0^22.0
"BLD",6543,6)
^406
**END**
**END**
