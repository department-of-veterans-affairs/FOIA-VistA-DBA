Released PRCA*4.5*221 SEQ #197
Extracted from mail message
**KIDS**:PRCA*4.5*221^

**INSTALL NAME**
PRCA*4.5*221
"BLD",5771,0)
PRCA*4.5*221^ACCOUNTS RECEIVABLE^0^3041123^y
"BLD",5771,1,0)
^^7^7^3041122^
"BLD",5771,1,1,0)
This patch addresses 2 issues. The first issue is regarding a problem when
"BLD",5771,1,2,0)
a bill was entered in lowercase letters, it would pull up the incorrect 
"BLD",5771,1,3,0)
patient and not the bill that site entered.
"BLD",5771,1,4,0)
 
"BLD",5771,1,5,0)
The second issue is regarding an undefined error when the payment on a
"BLD",5771,1,6,0)
receipt has an EEOB Worklist decrease adjustment associated with it in the
"BLD",5771,1,7,0)
Receipt Processing [RCDP RECEIPT PROCESSING] option.
"BLD",5771,4,0)
^9.64PA^^
"BLD",5771,"KRN",0)
^9.67PA^8989.52^19
"BLD",5771,"KRN",.4,0)
.4
"BLD",5771,"KRN",.401,0)
.401
"BLD",5771,"KRN",.402,0)
.402
"BLD",5771,"KRN",.403,0)
.403
"BLD",5771,"KRN",.5,0)
.5
"BLD",5771,"KRN",.84,0)
.84
"BLD",5771,"KRN",3.6,0)
3.6
"BLD",5771,"KRN",3.8,0)
3.8
"BLD",5771,"KRN",9.2,0)
9.2
"BLD",5771,"KRN",9.8,0)
9.8
"BLD",5771,"KRN",9.8,"NM",0)
^9.68A^4^2
"BLD",5771,"KRN",9.8,"NM",3,0)
PRCAAPR^^0^B10684039
"BLD",5771,"KRN",9.8,"NM",4,0)
RCDPURET^^0^B48340501
"BLD",5771,"KRN",9.8,"NM","B","PRCAAPR",3)

"BLD",5771,"KRN",9.8,"NM","B","RCDPURET",4)

"BLD",5771,"KRN",19,0)
19
"BLD",5771,"KRN",19.1,0)
19.1
"BLD",5771,"KRN",101,0)
101
"BLD",5771,"KRN",409.61,0)
409.61
"BLD",5771,"KRN",771,0)
771
"BLD",5771,"KRN",870,0)
870
"BLD",5771,"KRN",8989.51,0)
8989.51
"BLD",5771,"KRN",8989.52,0)
8989.52
"BLD",5771,"KRN",8994,0)
8994
"BLD",5771,"KRN","B",.4,.4)

"BLD",5771,"KRN","B",.401,.401)

"BLD",5771,"KRN","B",.402,.402)

"BLD",5771,"KRN","B",.403,.403)

"BLD",5771,"KRN","B",.5,.5)

"BLD",5771,"KRN","B",.84,.84)

"BLD",5771,"KRN","B",3.6,3.6)

"BLD",5771,"KRN","B",3.8,3.8)

"BLD",5771,"KRN","B",9.2,9.2)

"BLD",5771,"KRN","B",9.8,9.8)

"BLD",5771,"KRN","B",19,19)

"BLD",5771,"KRN","B",19.1,19.1)

"BLD",5771,"KRN","B",101,101)

"BLD",5771,"KRN","B",409.61,409.61)

"BLD",5771,"KRN","B",771,771)

"BLD",5771,"KRN","B",870,870)

"BLD",5771,"KRN","B",8989.51,8989.51)

"BLD",5771,"KRN","B",8989.52,8989.52)

"BLD",5771,"KRN","B",8994,8994)

"BLD",5771,"QUES",0)
^9.62^^
"BLD",5771,"REQB",0)
^9.611^3^2
"BLD",5771,"REQB",2,0)
PRCA*4.5*198^2
"BLD",5771,"REQB",3,0)
PRCA*4.5*196^2
"BLD",5771,"REQB","B","PRCA*4.5*196",3)

"BLD",5771,"REQB","B","PRCA*4.5*198",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
221^3041123
"PKG",142,22,1,"PAH",1,1,0)
^^7^7^3041123
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues. The first issue is regarding a problem when
"PKG",142,22,1,"PAH",1,1,2,0)
a bill was entered in lowercase letters, it would pull up the incorrect 
"PKG",142,22,1,"PAH",1,1,3,0)
patient and not the bill that site entered.
"PKG",142,22,1,"PAH",1,1,4,0)
 
"PKG",142,22,1,"PAH",1,1,5,0)
The second issue is regarding an undefined error when the payment on a
"PKG",142,22,1,"PAH",1,1,6,0)
receipt has an EEOB Worklist decrease adjustment associated with it in the
"PKG",142,22,1,"PAH",1,1,7,0)
Receipt Processing [RCDP RECEIPT PROCESSING] option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRCAAPR")
0^3^B10684039
"RTN","PRCAAPR",1,0)
PRCAAPR ;WASH-ISC@ALTOONA,PA/RGY-PATIENT ACCOUNT PROFILE (CONT) ;3/9/94  8:41 AM
"RTN","PRCAAPR",2,0)
V ;;4.5;Accounts Receivable;**198,221**;Mar 20, 1995
"RTN","PRCAAPR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAAPR",4,0)
EN(PRCATY) ;
"RTN","PRCAAPR",5,0)
 NEW DIC,X,Y,DEBT,PRCADB,DA,PRCA,COUNT,OUT,SEL,BILL,BAT,TRAN,DR,DXS,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","PRCAAPR",6,0)
ASK N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","PRCAAPR",7,0)
 K OUT S COUNT=0 R !,"Select DEBTOR NAME or BILL NUMBER: ",X:DTIME I "^"[$E(X) S $P(DEBT,"^",2)="" G Q
"RTN","PRCAAPR",8,0)
 S X=$$UPPER^VALM1(X)
"RTN","PRCAAPR",9,0)
 S Y=$S($O(^PRCA(430,"B",X,0)):$O(^(0)),$O(^PRCA(430,"D",X,0)):$O(^(0)),1:-1)
"RTN","PRCAAPR",10,0)
 I Y>0 S DEBT=$P($G(^PRCA(430,Y,0)),"^",9) I DEBT S PRCADB=$P($G(^RCD(340,DEBT,0)),"^"),^DISV(DUZ,"^PRCA(430,")=Y,$P(DEBT,"^",2)=$$NAM^RCFN01(DEBT) D COMP,EN1^PRCAATR(Y) G:$D(DTOUT) Q G ASK
"RTN","PRCAAPR",11,0)
 S DIC="^RCD(340,",DIC(0)="E" D ^DIC G:Y<0 ASK
"RTN","PRCAAPR",12,0)
 S ^DISV(DUZ,"^RCD(340,")=+Y,PRCADB=$P(Y,"^",2),DEBT=+Y_"^"_$P(@("^"_$P(PRCADB,";",2)_+PRCADB_",0)"),"^")
"RTN","PRCAAPR",13,0)
 D COMP,HDR^PRCAAPR1,HDR2^PRCAAPR1,DIS^PRCAAPR1 G:'$D(DTOUT) ASK
"RTN","PRCAAPR",14,0)
Q K ^TMP("PRCAAPR",$J) Q
"RTN","PRCAAPR",15,0)
COMP ;Compile patient bills
"RTN","PRCAAPR",16,0)
 K ^TMP("PRCAAPR",$J)
"RTN","PRCAAPR",17,0)
 NEW STAT,STAT1,CNT,Y
"RTN","PRCAAPR",18,0)
 S STAT1=0
"RTN","PRCAAPR",19,0)
 F CNT=1:1 S STAT1=+$S(PRCATY="ALL":$O(^PRCA(430,"AS",+DEBT,STAT1)),1:$O(^PRCA(430.3,"AC",+$P(PRCATY,",",CNT),0))) Q:'STAT1  F BILL=0:0 S BILL=$O(^PRCA(430,"AS",+DEBT,STAT1,BILL)) Q:'BILL  D COMP1
"RTN","PRCAAPR",20,0)
 I PRCADB[";DPT(" F BILL=0:0 S BILL=$O(^PRCA(430,"E",+PRCADB,BILL)) Q:'BILL  I PRCATY="ALL"!((","_PRCATY_",")[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(430,BILL,0)),"^",8),0)),"^",3)_",")) D COMP1
"RTN","PRCAAPR",21,0)
 F BAT=0:0 S BAT=$O(^RCY(344,"AC",PRCADB,BAT)) Q:'BAT  F TRAN=0:0 S TRAN=$O(^RCY(344,"AC",PRCADB,BAT,TRAN)) Q:'TRAN  I $G(^RCY(344,BAT,1,TRAN,0))]"",$P(^(0),"^",5)="" D COMP2
"RTN","PRCAAPR",22,0)
 Q
"RTN","PRCAAPR",23,0)
COMP1 S STAT=$P($G(^PRCA(430.3,+$P($G(^PRCA(430,BILL,0)),"^",8),0)),"^",3) Q:STAT=""
"RTN","PRCAAPR",24,0)
 S X=$G(^PRCA(430,BILL,7)),Y=$P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5)
"RTN","PRCAAPR",25,0)
 I $P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)) S Y=-Y
"RTN","PRCAAPR",26,0)
 S Y=$S($P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0))&(STAT'=112):0,$P(^PRCA(430,BILL,0),"^",9)'=+DEBT:0,",102,107,112,"[(","_STAT_","):Y,1:0)
"RTN","PRCAAPR",27,0)
 S ^TMP("PRCAAPR",$J,"C")=$G(^TMP("PRCAAPR",$J,"C"))+Y
"RTN","PRCAAPR",28,0)
 S ^TMP("PRCAAPR",$J,"C",STAT)=$G(^TMP("PRCAAPR",$J,"C",STAT))+Y_"^"_STAT,^(STAT,BILL)=$P(X,"^",1,5)
"RTN","PRCAAPR",29,0)
 Q
"RTN","PRCAAPR",30,0)
COMP2 ;Compile payments
"RTN","PRCAAPR",31,0)
 S Y=$P(^RCY(344,BAT,1,TRAN,0),"^",4)
"RTN","PRCAAPR",32,0)
 S ^TMP("PRCAAPR",$J,"C")=$G(^TMP("PRCAAPR",$J,"C"))-Y
"RTN","PRCAAPR",33,0)
 S ^TMP("PRCAAPR",$J,"C",99)=$G(^TMP("PRCAAPR",$J,"C",99))-Y_"^99",^TMP("PRCAAPR",$J,"C",99,$P(^RCY(344,BAT,0),"^")_"-"_TRAN)=$P(^RCY(344,BAT,1,TRAN,0),"^",4)
"RTN","PRCAAPR",34,0)
 Q
"RTN","RCDPURET")
0^4^B48340501
"RTN","RCDPURET",1,0)
RCDPURET ;WISC/RFJ-receipt utilities (transactions) ;1 Jun 99
"RTN","RCDPURET",2,0)
 ;;4.5;Accounts Receivable;**114,141,169,173,196,221**;Mar 20, 1995
"RTN","RCDPURET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURET",4,0)
 Q
"RTN","RCDPURET",5,0)
 ;
"RTN","RCDPURET",6,0)
 ;
"RTN","RCDPURET",7,0)
SELTRAN(DA) ;  select a transaction for a receipt
"RTN","RCDPURET",8,0)
 ;  returns -1 for timeout or ^, 0 for no selection, or ien of trans
"RTN","RCDPURET",9,0)
 N %,DIC,DTOUT,DUOUT,RCDATA,X,Y
"RTN","RCDPURET",10,0)
 S DIC="^RCY(344,"_DA_",1,",DIC(0)="QEAM",DIC("A")="Select Receipt TRANSACTION #: "
"RTN","RCDPURET",11,0)
 S DIC("W")="S RCDATA=@(DIC_Y_"",0)"") W:$P(RCDATA,U,3) ?8,""  "",$P(@(U_$P($P(RCDATA,U,3),"";"",2)_+$P(RCDATA,U,3)_"",0)""),U) W ?40,""  $ "",$J($P(RCDATA,U,4),0,2)"
"RTN","RCDPURET",12,0)
 D ^DIC
"RTN","RCDPURET",13,0)
 I Y<0,'$G(DTOUT),'$G(DUOUT) S Y=0
"RTN","RCDPURET",14,0)
 Q +Y
"RTN","RCDPURET",15,0)
 ;
"RTN","RCDPURET",16,0)
 ;
"RTN","RCDPURET",17,0)
ADDTRAN(RECTDA) ;  add transaction for receipt (in da)
"RTN","RCDPURET",18,0)
 N %DT,%T,D0,DA,DD,DI,DIC,DIE,DINUM,DLAYGO,DO,DQ,DR,X,Y
"RTN","RCDPURET",19,0)
 I '$D(^RCY(344,RECTDA,1,0)) S ^(0)="^344.01A^"
"RTN","RCDPURET",20,0)
 ;
"RTN","RCDPURET",21,0)
 ;  find next transaction number
"RTN","RCDPURET",22,0)
 S X=$O(^RCY(344,RECTDA,1,9999999),-1)
"RTN","RCDPURET",23,0)
 F X=X+1:1 Q:'$D(^RCY(344,RECTDA,1,X,0))
"RTN","RCDPURET",24,0)
 S DINUM=X
"RTN","RCDPURET",25,0)
 ;
"RTN","RCDPURET",26,0)
 S DA(1)=RECTDA
"RTN","RCDPURET",27,0)
 S DIC="^RCY(344,"_RECTDA_",1,",DIC(0)="L",DLAYGO=344.01
"RTN","RCDPURET",28,0)
 S DIC("DR")=".12////"_DUZ_";.06///TODAY;"
"RTN","RCDPURET",29,0)
 D FILE^DICN
"RTN","RCDPURET",30,0)
 Q +Y
"RTN","RCDPURET",31,0)
 ;
"RTN","RCDPURET",32,0)
 ;
"RTN","RCDPURET",33,0)
EDITTRAN(RECTDA,TRANDA) ;  edit a receipt transaction
"RTN","RCDPURET",34,0)
 ;  returns 1 for success, or 0 (error message)
"RTN","RCDPURET",35,0)
 I '$D(^RCY(344,RECTDA,1,TRANDA,0)) Q 0
"RTN","RCDPURET",36,0)
 ;
"RTN","RCDPURET",37,0)
 N %,%DT,%T,%Y,C,D,D0,D1,DA,DATA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DIU,DIV,DIW,DG,DQ,DR,DZ,RCAMOUNT,RCTYPE,RESULT,X,Y
"RTN","RCDPURET",38,0)
 N RCXAMONT,RCXSUSP,RCXADJ,RCERA,RCADJ,RCXERA
"RTN","RCDPURET",39,0)
 ;
"RTN","RCDPURET",40,0)
 ;  build dr string based on type of payment on receipt
"RTN","RCDPURET",41,0)
 S RCTYPE=$P($G(^RC(341.1,+$P(^RCY(344,RECTDA,0),"^",4),0)),"^",2)
"RTN","RCDPURET",42,0)
 S RCADJ=0,RCERA=+$O(^RCY(344.4,"AREC",RECTDA,0))
"RTN","RCDPURET",43,0)
 S DR=""
"RTN","RCDPURET",44,0)
 I RCERA,$D(^RCY(344.49,+RCERA,0)),$P(^RCY(344,RECTDA,1,TRANDA,0),"^",28) D  ; Worklist has a dec adj associated with it
"RTN","RCDPURET",45,0)
 . N Z
"RTN","RCDPURET",46,0)
 . S Z=$$EXTERNAL^DILFD(344.01,.09,,$P($G(^RCY(344,RECTDA,1,TRANDA,0)),U,9))
"RTN","RCDPURET",47,0)
 . S RCADJ=1,RCXERA="W !,""NOTE: This payment has an EEOB Worklist dec adj associated with it."",!,""BILL NUMBER: "_Z_" (uneditable)""",DR="X RCXERA;"
"RTN","RCDPURET",48,0)
 E  D
"RTN","RCDPURET",49,0)
 . ;  patient name or bill number
"RTN","RCDPURET",50,0)
 . S DR=".09;"
"RTN","RCDPURET",51,0)
 S DR=DR_"S Y=$S('$P(^RCY(344,DA(1),1,DA,0),U,9):""@1"",1:""@2"");"
"RTN","RCDPURET",52,0)
 ;  ask comment if no acct (unapplied)
"RTN","RCDPURET",53,0)
 S RCXSUSP="W !?5,""NOTE: This payment will be posted to the station's suspense fund."""
"RTN","RCDPURET",54,0)
 S DR=DR_"@1;X RCXSUSP;1.02;S Y=""@3"";"
"RTN","RCDPURET",55,0)
 ;  payment amount
"RTN","RCDPURET",56,0)
 S RCXAMONT="W !,""  Amount Owed: $"",$J($$PAYDEF^RCDPURET($P(^RCY(344,DA(1),1,DA,0),U,9)),0,2)"
"RTN","RCDPURET",57,0)
 S DR=DR_"@2;X RCXAMONT;@3;.04;"
"RTN","RCDPURET",58,0)
 ;  date of payment
"RTN","RCDPURET",59,0)
 S DR=DR_".06;"
"RTN","RCDPURET",60,0)
 ;  type of payment = district counsel (3), check (4),
"RTN","RCDPURET",61,0)
 ;                    dept of justice  (5), irs (11),
"RTN","RCDPURET",62,0)
 ;                    lockbox (12)
"RTN","RCDPURET",63,0)
 I RCTYPE=3!(RCTYPE=4)!(RCTYPE=5)!(RCTYPE=11)!(RCTYPE=12)!(RCTYPE=13) D
"RTN","RCDPURET",64,0)
 .   S DR=DR_".07d;"     ; check number
"RTN","RCDPURET",65,0)
 .   S DR=DR_".08d;"     ; bank number
"RTN","RCDPURET",66,0)
 .   S DR=DR_".1d;"      ; date of check
"RTN","RCDPURET",67,0)
 ;  type of payment = credit card (7)
"RTN","RCDPURET",68,0)
 I RCTYPE=7 D
"RTN","RCDPURET",69,0)
 .   S DR=DR_".11d;"     ; credit card number
"RTN","RCDPURET",70,0)
 .   S DR=DR_".02d;"     ; confirmation number
"RTN","RCDPURET",71,0)
 ;
"RTN","RCDPURET",72,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",73,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",74,0)
 ;  edited by
"RTN","RCDPURET",75,0)
 S DR=DR_".14////"_DUZ
"RTN","RCDPURET",76,0)
 D ^DIE
"RTN","RCDPURET",77,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",78,0)
 ;
"RTN","RCDPURET",79,0)
 ;  check for missing fields
"RTN","RCDPURET",80,0)
 S DATA=^RCY(344,RECTDA,1,TRANDA,0)
"RTN","RCDPURET",81,0)
 S RESULT=1
"RTN","RCDPURET",82,0)
 I RESULT,'$P(DATA,"^",4) S RESULT="Payment Amount is ZERO."
"RTN","RCDPURET",83,0)
 I RESULT,'$P(DATA,"^",6) S RESULT="Date of Payment NOT entered."
"RTN","RCDPURET",84,0)
 I RESULT,RCTYPE=13,$$TRACE($P(DATA,"^",3))="" S RESULT="TOP TRACE NUMBER NOT ENTERED"
"RTN","RCDPURET",85,0)
 I RESULT,RCTYPE=7,$P(DATA,"^",11)="" W !,"WARNING: Credit Card Number NOT entered."
"RTN","RCDPURET",86,0)
 I RESULT,$P(DATA,"^",6)<$P(DATA,"^",10) W !,"WARNING: Date of check is greater than the date of payment."
"RTN","RCDPURET",87,0)
 ;
"RTN","RCDPURET",88,0)
 ;  if field is missing, delete the transaction
"RTN","RCDPURET",89,0)
 I 'RESULT D DELETRAN(RECTDA,TRANDA)
"RTN","RCDPURET",90,0)
 ;
"RTN","RCDPURET",91,0)
 ;  if transaction okay, print receipt
"RTN","RCDPURET",92,0)
 I RESULT D RECEIPT^RCDPRECT(RECTDA,TRANDA)
"RTN","RCDPURET",93,0)
 ;
"RTN","RCDPURET",94,0)
 Q RESULT
"RTN","RCDPURET",95,0)
 ;
"RTN","RCDPURET",96,0)
 ;
"RTN","RCDPURET",97,0)
EDITACCT(RECTDA,TRANDA) ;  edit the account on a receipt
"RTN","RCDPURET",98,0)
 N C,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DISYS,DIU,DIV,DIW,DQ,DR,DZ,X
"RTN","RCDPURET",99,0)
 S DR=".09;"
"RTN","RCDPURET",100,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",101,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",102,0)
 D ^DIE
"RTN","RCDPURET",103,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",104,0)
 Q
"RTN","RCDPURET",105,0)
 ;
"RTN","RCDPURET",106,0)
 ;
"RTN","RCDPURET",107,0)
DELEACCT(RECTDA,TRANDA) ;  delete the account on a receipt
"RTN","RCDPURET",108,0)
 N D,D0,D1,DA,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,DR,X
"RTN","RCDPURET",109,0)
 S DR=".09///@;.03///@;"
"RTN","RCDPURET",110,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",111,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",112,0)
 D ^DIE
"RTN","RCDPURET",113,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",114,0)
 Q
"RTN","RCDPURET",115,0)
 ;
"RTN","RCDPURET",116,0)
 ;
"RTN","RCDPURET",117,0)
EDITFMS(RECTDA,TRANDA,DEFAULT) ;  edit fms document number for clearing suspense
"RTN","RCDPURET",118,0)
 N C,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DISYS,DIU,DIV,DIW,DQ,DR,DZ,X
"RTN","RCDPURET",119,0)
 S DR=".26;"
"RTN","RCDPURET",120,0)
 I $G(DEFAULT)'="" S DR=".26////"_DEFAULT_";"
"RTN","RCDPURET",121,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",122,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",123,0)
 D ^DIE
"RTN","RCDPURET",124,0)
 Q
"RTN","RCDPURET",125,0)
 ;
"RTN","RCDPURET",126,0)
 ;
"RTN","RCDPURET",127,0)
MOVETRAN(RCOLDREC,RCOLDTRA,RCNEWREC) ;  move a transactions data
"RTN","RCDPURET",128,0)
 N %DT,%T,D0,D1,DA,DG,DIC,DICR,DIK,DIU,RCNEWTRA,RESULT,X,Y
"RTN","RCDPURET",129,0)
 ;
"RTN","RCDPURET",130,0)
 ;  add new transaction to 2nd receipt
"RTN","RCDPURET",131,0)
 W !,"Adding a NEW payment transaction to receipt "_$P(^RCY(344,RCNEWREC,0),"^")_": "
"RTN","RCDPURET",132,0)
 S RCNEWTRA=$$ADDTRAN(RCNEWREC)
"RTN","RCDPURET",133,0)
 I 'RCNEWTRA Q "Unable to ADD a new payment transaction."
"RTN","RCDPURET",134,0)
 ;
"RTN","RCDPURET",135,0)
 W "# ",RCNEWTRA
"RTN","RCDPURET",136,0)
 ;
"RTN","RCDPURET",137,0)
 ;  move data to selected receipt and re-index entry
"RTN","RCDPURET",138,0)
 S ^RCY(344,RCNEWREC,1,RCNEWTRA,0)=RCNEWTRA_"^"_$P(^RCY(344,RCOLDREC,1,RCOLDTRA,0),"^",2,99)
"RTN","RCDPURET",139,0)
 S DIK="^RCY(344,"_RCNEWREC_",1,",DA(1)=RCNEWREC,DA=RCNEWTRA
"RTN","RCDPURET",140,0)
 D IX^DIK
"RTN","RCDPURET",141,0)
 ;
"RTN","RCDPURET",142,0)
 S RESULT=$$EDITTRAN(RCNEWREC,RCNEWTRA)
"RTN","RCDPURET",143,0)
 Q RESULT
"RTN","RCDPURET",144,0)
 ;
"RTN","RCDPURET",145,0)
 ;
"RTN","RCDPURET",146,0)
CANCTRAN(RECTDA,RECTRAN) ;  cancel a transaction
"RTN","RCDPURET",147,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,RCDATA,X,Y
"RTN","RCDPURET",148,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",149,0)
 S RCDATA="Cancelled by: "_$P(^VA(200,DUZ,0),"^")_"    Amount: $ "_$J($P(^RCY(344,RECTDA,1,RECTRAN,0),"^",4),0,2)
"RTN","RCDPURET",150,0)
 S DR="1.01////^S X=RCDATA;.04////^S X=0;.05////^S X=0;1.02;"
"RTN","RCDPURET",151,0)
 S DA=RECTRAN,DA(1)=RECTDA
"RTN","RCDPURET",152,0)
 D ^DIE
"RTN","RCDPURET",153,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",154,0)
 Q
"RTN","RCDPURET",155,0)
 ;
"RTN","RCDPURET",156,0)
 ;
"RTN","RCDPURET",157,0)
DELETRAN(RECTDA,TRANDA) ;  delete a transaction
"RTN","RCDPURET",158,0)
 N %,D0,D1,DA,DIC,DICR,DIG,DIH,DIK,DIU,DIV,DIW,X,Y
"RTN","RCDPURET",159,0)
 S DIK="^RCY(344,"_RECTDA_",1,",DA(1)=RECTDA,DA=TRANDA
"RTN","RCDPURET",160,0)
 D ^DIK
"RTN","RCDPURET",161,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",162,0)
 Q
"RTN","RCDPURET",163,0)
 ;
"RTN","RCDPURET",164,0)
 ;
"RTN","RCDPURET",165,0)
SETUNAPP(RECTDA,TRANDA,UNAPPNUM) ;  store the unapplied deposit number
"RTN","RCDPURET",166,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCDPURET",167,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",168,0)
 S DR=".25////"_UNAPPNUM_";"
"RTN","RCDPURET",169,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",170,0)
 D ^DIE
"RTN","RCDPURET",171,0)
 Q
"RTN","RCDPURET",172,0)
 ;
"RTN","RCDPURET",173,0)
 ;
"RTN","RCDPURET",174,0)
PAYDEF(DEBTOR) ;  get default for payment amount (used in input templates for payments)
"RTN","RCDPURET",175,0)
 N X
"RTN","RCDPURET",176,0)
 I 'DEBTOR Q 0
"RTN","RCDPURET",177,0)
 I DEBTOR[";DPT(" S X=$$BAL^PRCAFN(DEBTOR)
"RTN","RCDPURET",178,0)
 I DEBTOR[";PRCA(430,",",112,107,102,"[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(430,+DEBTOR,0)),"^",8),0)),"^",3)_",") S X=$G(^PRCA(430,+DEBTOR,7)),X=$P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5)
"RTN","RCDPURET",179,0)
 Q +$G(X)
"RTN","RCDPURET",180,0)
 ;
"RTN","RCDPURET",181,0)
 ;
"RTN","RCDPURET",182,0)
PENDPAY(DEBTOR) ;  return pending payments for a debtor
"RTN","RCDPURET",183,0)
 ;  returns ^tmp($j,"rcdpurec","pp",rectda,tranda)=data in 344.01
"RTN","RCDPURET",184,0)
 ;  and the total pending payment dollars
"RTN","RCDPURET",185,0)
 N DATA,RECTDA,TOTAL,TRANDA
"RTN","RCDPURET",186,0)
 K ^TMP($J,"RCDPUREC","PP")
"RTN","RCDPURET",187,0)
 ;  look at open receipts
"RTN","RCDPURET",188,0)
 S RECTDA=0 F  S RECTDA=$O(^RCY(344,"ASTAT",1,RECTDA)) Q:'RECTDA  D
"RTN","RCDPURET",189,0)
 .   S TRANDA=0 F  S TRANDA=$O(^RCY(344,"AACCT",DEBTOR,RECTDA,TRANDA)) Q:'TRANDA  D
"RTN","RCDPURET",190,0)
 .   .   S DATA=$G(^RCY(344,RECTDA,1,TRANDA,0)) I DATA="" Q
"RTN","RCDPURET",191,0)
 .   .   ;  total paid = total processed
"RTN","RCDPURET",192,0)
 .   .   I +$P(DATA,"^",4)=+$P(DATA,"^",5) Q
"RTN","RCDPURET",193,0)
 .   .   S ^TMP($J,"RCDPUREC","PP",RECTDA,TRANDA)=DATA
"RTN","RCDPURET",194,0)
 .   .   S TOTAL=$G(TOTAL)+$P(DATA,"^",4)
"RTN","RCDPURET",195,0)
 Q +$G(TOTAL)
"RTN","RCDPURET",196,0)
TRACE(DEBTOR) ;ENTER TOP TRACE NUMBER FOR TOP RECEIPTS
"RTN","RCDPURET",197,0)
 N TRACE,DIC,DIE,DR,DA
"RTN","RCDPURET",198,0)
 S TRACE="" G TRACEQ:'DEBTOR
"RTN","RCDPURET",199,0)
 S DA=$S(DEBTOR["DPT(":$O(^RCD(340,"B",DEBTOR,0)),1:$P($G(^PRCA(430,+DEBTOR,0)),U,9))
"RTN","RCDPURET",200,0)
 G TRACEQ:'DA
"RTN","RCDPURET",201,0)
 S (DIC,DIE)="^RCD(340,",DR=6.07 D ^DIE
"RTN","RCDPURET",202,0)
 S TRACE=$P($G(^RCD(340,DA,6)),"^",7)
"RTN","RCDPURET",203,0)
TRACEQ Q TRACE
"VER")
8.0^22
**END**
**END**
