Released GMRC*3*9 SEQ #11
Extracted from mail message
**KIDS**:GMRC*3.0*9^

**INSTALL NAME**
GMRC*3.0*9
"BLD",1549,0)
GMRC*3.0*9^CONSULT/REQUEST TRACKING^0^3000223^y
"BLD",1549,1,0)
^^1^1^2990107^
"BLD",1549,1,1,0)
See national patch module for description of this patch.
"BLD",1549,4,0)
^9.64PA^123.5^1
"BLD",1549,4,123.5,0)
123.5
"BLD",1549,4,123.5,2,0)
^9.641^123.555^5
"BLD",1549,4,123.5,2,123.5,0)
REQUEST SERVICES  (File-top level)
"BLD",1549,4,123.5,2,123.5,1,0)
^9.6411^123.08^2
"BLD",1549,4,123.5,2,123.5,1,123.08,0)
SERVICE INDIVIDUAL TO NOTIFY
"BLD",1549,4,123.5,2,123.5,1,123.5,0)
SPECIAL UPDATES INDIVIDUAL
"BLD",1549,4,123.5,2,123.53,0)
SERVICE TEAM(S) TO NOTIFY  (sub-file)
"BLD",1549,4,123.5,2,123.53,1,0)
^9.6411^.01^1
"BLD",1549,4,123.5,2,123.53,1,.01,0)
SERVICE TEAM TO NOTIFY
"BLD",1549,4,123.5,2,123.54,0)
NOTIFICATION BY PT LOCATION  (sub-file)
"BLD",1549,4,123.5,2,123.54,1,0)
^9.6411^2^2
"BLD",1549,4,123.5,2,123.54,1,1,0)
INDIVIDUAL TO NOTIFY
"BLD",1549,4,123.5,2,123.54,1,2,0)
TEAM TO NOTIFY
"BLD",1549,4,123.5,2,123.55,0)
UPDATE USERS W/O NOTIFICATIONS  (sub-file)
"BLD",1549,4,123.5,2,123.55,1,0)
^9.6411^.01^1
"BLD",1549,4,123.5,2,123.55,1,.01,0)
UPDATE USERS W/O NOTIFICATIONS
"BLD",1549,4,123.5,2,123.555,0)
ADMINISTRATIVE UPDATE USERS  (sub-file)
"BLD",1549,4,123.5,2,123.555,1,0)
^9.6411^.01^1
"BLD",1549,4,123.5,2,123.555,1,.01,0)
ADMINISTRATIVE UPDATE USER
"BLD",1549,4,123.5,222)
y^n^p^^^^n
"BLD",1549,4,"APDD",123.5,123.5)

"BLD",1549,4,"APDD",123.5,123.5,123.08)

"BLD",1549,4,"APDD",123.5,123.5,123.5)

"BLD",1549,4,"APDD",123.5,123.53)

"BLD",1549,4,"APDD",123.5,123.53,.01)

"BLD",1549,4,"APDD",123.5,123.54)

"BLD",1549,4,"APDD",123.5,123.54,1)

"BLD",1549,4,"APDD",123.5,123.54,2)

"BLD",1549,4,"APDD",123.5,123.55)

"BLD",1549,4,"APDD",123.5,123.55,.01)

"BLD",1549,4,"APDD",123.5,123.555)

"BLD",1549,4,"APDD",123.5,123.555,.01)

"BLD",1549,4,"B",123.5,123.5)

"BLD",1549,"INIT")
BF^GMRCYP9
"BLD",1549,"KRN",0)
^9.67PA^19^18
"BLD",1549,"KRN",.4,0)
.4
"BLD",1549,"KRN",.401,0)
.401
"BLD",1549,"KRN",.402,0)
.402
"BLD",1549,"KRN",.403,0)
.403
"BLD",1549,"KRN",.5,0)
.5
"BLD",1549,"KRN",.84,0)
.84
"BLD",1549,"KRN",3.6,0)
3.6
"BLD",1549,"KRN",3.8,0)
3.8
"BLD",1549,"KRN",9.2,0)
9.2
"BLD",1549,"KRN",9.8,0)
9.8
"BLD",1549,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1549,"KRN",9.8,"NM",1,0)
GMRCTU^^0^B41551204
"BLD",1549,"KRN",9.8,"NM",2,0)
GMRCTU1^^0^B6724258
"BLD",1549,"KRN",9.8,"NM",3,0)
GMRCYP9^^0^B54128996
"BLD",1549,"KRN",9.8,"NM",4,0)
GMRCYP9B^^0^B12746332
"BLD",1549,"KRN",9.8,"NM","B","GMRCTU",1)

"BLD",1549,"KRN",9.8,"NM","B","GMRCTU1",2)

"BLD",1549,"KRN",9.8,"NM","B","GMRCYP9",3)

"BLD",1549,"KRN",9.8,"NM","B","GMRCYP9B",4)

"BLD",1549,"KRN",19,0)
19
"BLD",1549,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",1549,"KRN",19,"NM",2,0)
XU USER TERMINATE^^2
"BLD",1549,"KRN",19,"NM",3,0)
GMRC TERMINATE CLEANUP^^0
"BLD",1549,"KRN",19,"NM","B","GMRC TERMINATE CLEANUP",3)

"BLD",1549,"KRN",19,"NM","B","XU USER TERMINATE",2)

"BLD",1549,"KRN",19.1,0)
19.1
"BLD",1549,"KRN",101,0)
101
"BLD",1549,"KRN",409.61,0)
409.61
"BLD",1549,"KRN",771,0)
771
"BLD",1549,"KRN",869.2,0)
869.2
"BLD",1549,"KRN",870,0)
870
"BLD",1549,"KRN",8994,0)
8994
"BLD",1549,"KRN","B",.4,.4)

"BLD",1549,"KRN","B",.401,.401)

"BLD",1549,"KRN","B",.402,.402)

"BLD",1549,"KRN","B",.403,.403)

"BLD",1549,"KRN","B",.5,.5)

"BLD",1549,"KRN","B",.84,.84)

"BLD",1549,"KRN","B",3.6,3.6)

"BLD",1549,"KRN","B",3.8,3.8)

"BLD",1549,"KRN","B",9.2,9.2)

"BLD",1549,"KRN","B",9.8,9.8)

"BLD",1549,"KRN","B",19,19)

"BLD",1549,"KRN","B",19.1,19.1)

"BLD",1549,"KRN","B",101,101)

"BLD",1549,"KRN","B",409.61,409.61)

"BLD",1549,"KRN","B",771,771)

"BLD",1549,"KRN","B",869.2,869.2)

"BLD",1549,"KRN","B",870,870)

"BLD",1549,"KRN","B",8994,8994)

"BLD",1549,"QUES",0)
^9.62^^
"BLD",1549,"REQB",0)
^9.611^1^1
"BLD",1549,"REQB",1,0)
GMRC*3.0*11^2
"BLD",1549,"REQB","B","GMRC*3.0*11",1)

"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5
"FIA",123.5,0,1)
y^n^p^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,123.08)

"FIA",123.5,123.5,123.1)

"FIA",123.5,123.5,123.3)

"FIA",123.5,123.5,123.33)

"FIA",123.5,123.5,123.5)

"FIA",123.5,123.53)
1
"FIA",123.5,123.53,.01)

"FIA",123.5,123.54)
1
"FIA",123.5,123.54,1)

"FIA",123.5,123.54,2)

"FIA",123.5,123.55)
1
"FIA",123.5,123.55,.01)

"FIA",123.5,123.555)
1
"FIA",123.5,123.555,.01)

"INIT")
BF^GMRCYP9
"KRN",19,4417,-1)
2^2
"KRN",19,4417,0)
XU USER TERMINATE^User terminate event^^X^10^^^^^^^^^^^^
"KRN",19,4417,10,0)
^19.01IP^3^3
"KRN",19,4417,10,2,0)
7674
"KRN",19,4417,10,2,"^")
GMRC TERMINATE CLEANUP
"KRN",19,4417,"U")
USER TERMINATE EVENT
"KRN",19,7674,-1)
0^3
"KRN",19,7674,0)
GMRC TERMINATE CLEANUP^User Terminate Cleanup^^A^^^^^^^^CONSULT/REQUEST TRACKING^^1
"KRN",19,7674,1,0)
^^4^4^2991118^^^
"KRN",19,7674,1,1,0)
Option calls EN^GMRCTU which responds to Kernel's XU USER TERMINATE
"KRN",19,7674,1,2,0)
option to remove pointers to a terminated user from file(s) as specified
"KRN",19,7674,1,3,0)
in the text section at the end of the routine's code.  XU USER TERMINATE's
"KRN",19,7674,1,4,0)
variable XUIFN is used to determine the user's identity.
"KRN",19,7674,20)
D EN^GMRCTU
"KRN",19,7674,"U")
USER TERMINATE CLEANUP
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
9^3000223
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^3000223
"PKG",128,22,1,"PAH",1,1,1,0)
See national patch module for description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMRCTU")
0^1^B41551204
"RTN","GMRCTU",1,0)
GMRCTU ; SLC-SLC/PKS  Consults - Terminated users/remove pointers. ; [2/8/00 11:15am]
"RTN","GMRCTU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**9**;Dec 27, 1997
"RTN","GMRCTU",3,0)
 ;
"RTN","GMRCTU",4,0)
 ; OE/RR V3.0 - CONSULTS V3.0
"RTN","GMRCTU",5,0)
 ;
"RTN","GMRCTU",6,0)
 ; CONSULTS - Removes pointers upon termination.
"RTN","GMRCTU",7,0)
 ; The records to be edited are pointers to file #200, NEW PERSON.
"RTN","GMRCTU",8,0)
 ;
"RTN","GMRCTU",9,0)
 ; ------------------------------------------------------------------
"RTN","GMRCTU",10,0)
 ; Enter new files/fields at end of routine under entry label "TEXT."
"RTN","GMRCTU",11,0)
 ; ------------------------------------------------------------------
"RTN","GMRCTU",12,0)
 ;
"RTN","GMRCTU",13,0)
 ; Triggered by Kernel's XU USER TERMINATE event.
"RTN","GMRCTU",14,0)
 ; Applicable piece set to null or multiples delted. 
"RTN","GMRCTU",15,0)
 ; Variable "USER" is DUZ of user for whom pointers will be removed.
"RTN","GMRCTU",16,0)
 ; The "USER" value must be passed to the routine by Kernel.
"RTN","GMRCTU",17,0)
 ;
"RTN","GMRCTU",18,0)
 ; Variables used:
"RTN","GMRCTU",19,0)
 ;    NPARY       = DB array with info on file/field.
"RTN","GMRCTU",20,0)
 ;    CNT         = Overall counter variable.
"RTN","GMRCTU",21,0)
 ;    INFO        = TEXT list variable.
"RTN","GMRCTU",22,0)
 ;    VALUE       = Value match string.
"RTN","GMRCTU",23,0)
 ;    DIE,DA,DR,X = Used by calls to ^DIE.
"RTN","GMRCTU",24,0)
 ;    NODE        = Node to edit, if applicable.
"RTN","GMRCTU",25,0)
 ;    PIECE       = Piece of node to edit.
"RTN","GMRCTU",26,0)
 ;    RSTR        = Global root file string.
"RTN","GMRCTU",27,0)
 ;    SSTR        = Subfile string.
"RTN","GMRCTU",28,0)
 ;    FILENUM     = File number.
"RTN","GMRCTU",29,0)
 ;    IEN         = IEN string.
"RTN","GMRCTU",30,0)
 ;    SIEN        = Subfile IEN string.
"RTN","GMRCTU",31,0)
 ;    FIELDNUM    = Data Dictionary field number.
"RTN","GMRCTU",32,0)
 ;    APPSTR      = Append string variable.
"RTN","GMRCTU",33,0)
 ;
"RTN","GMRCTU",34,0)
 Q
"RTN","GMRCTU",35,0)
 ;
"RTN","GMRCTU",36,0)
EN ; Entry point - called by option: CONSULT TERMINATE CLEANUP.
"RTN","GMRCTU",37,0)
 ;
"RTN","GMRCTU",38,0)
 S USER=$GET(XUIFN) ; Assign user variable.
"RTN","GMRCTU",39,0)
 I USER="" Q        ; If there's a problem, dump out right now.
"RTN","GMRCTU",40,0)
 D START(USER)      ; Call the Control sequence for whole routine.
"RTN","GMRCTU",41,0)
 Q
"RTN","GMRCTU",42,0)
 ;
"RTN","GMRCTU",43,0)
FINDVAL ; See if VALUE (desired USER) exists in the record.
"RTN","GMRCTU",44,0)
 ;
"RTN","GMRCTU",45,0)
 S VALUE="" ; Initialize.
"RTN","GMRCTU",46,0)
 ;
"RTN","GMRCTU",47,0)
 I SSTR="" D  Q  ; If no subfile, quit after this IF.
"RTN","GMRCTU",48,0)
 .I $P($G(@(RSTR_+IEN_","_NODE_APPSTR)),"^",PIECE)=USER S VALUE=USER
"RTN","GMRCTU",49,0)
 ;
"RTN","GMRCTU",50,0)
 ; Process subfiles:
"RTN","GMRCTU",51,0)
 I $P($G(@(RSTR_+IEN_","_SSTR_","_SIEN_","_NODE_APPSTR)),"^",PIECE)=USER S VALUE=USER
"RTN","GMRCTU",52,0)
 ;
"RTN","GMRCTU",53,0)
 Q
"RTN","GMRCTU",54,0)
 ;
"RTN","GMRCTU",55,0)
CALLDIE ; Set FM variables and call DIE.
"RTN","GMRCTU",56,0)
 ;
"RTN","GMRCTU",57,0)
 N DIE,DA,DR,X
"RTN","GMRCTU",58,0)
 ;
"RTN","GMRCTU",59,0)
 I SSTR="" D  Q  ; No subfile involved.
"RTN","GMRCTU",60,0)
 .S DA=IEN,DIE=RSTR,DR=FIELDNUM_"///^S X=""@"""
"RTN","GMRCTU",61,0)
 .LOCK +@(DIE_IEN_")"):0
"RTN","GMRCTU",62,0)
 .D ^DIE ; User terminated, so call regardless of lock success.
"RTN","GMRCTU",63,0)
 .LOCK -@(DIE_IEN_")")
"RTN","GMRCTU",64,0)
 ;
"RTN","GMRCTU",65,0)
 ; Process subfile:
"RTN","GMRCTU",66,0)
 S DA(1)=IEN,DA=SIEN,DIE=RSTR_DA(1)_","_SSTR_",",DR=FIELDNUM_"///^S X=""@"""
"RTN","GMRCTU",67,0)
 LOCK +@(DIE_IEN_")"):0
"RTN","GMRCTU",68,0)
 D ^DIE ; User terminated, so call regardless of lock success.
"RTN","GMRCTU",69,0)
 LOCK -@(DIE_IEN_")")
"RTN","GMRCTU",70,0)
 ;
"RTN","GMRCTU",71,0)
 Q
"RTN","GMRCTU",72,0)
 ;
"RTN","GMRCTU",73,0)
MAIN ; Outer FOR loop to scan file for IENs, deleting pointer entries.
"RTN","GMRCTU",74,0)
 ;
"RTN","GMRCTU",75,0)
 D INFO^GMRCTU1(FILENUM,FIELDNUM,.NPARY) ; DB call, gets information.
"RTN","GMRCTU",76,0)
 ;
"RTN","GMRCTU",77,0)
 I (NPARY("DIC",0)="")!(NPARY("LOC")="") Q  ; Problems?  Dump out.
"RTN","GMRCTU",78,0)
 ;
"RTN","GMRCTU",79,0)
 ; Assign variables from resulting call:
"RTN","GMRCTU",80,0)
 S (RSTR,SSTR,NODE,PIECE,APPSTR)="" ; Initialize.
"RTN","GMRCTU",81,0)
 S RSTR=NPARY("DIC",1) ; Assign global root string.
"RTN","GMRCTU",82,0)
 ;
"RTN","GMRCTU",83,0)
 ; If a multiple, set flag and assign subfile string:
"RTN","GMRCTU",84,0)
 I $L($G(NPARY("DIC",2))) S SSTR=$P(NPARY("DIC",2),",",3)
"RTN","GMRCTU",85,0)
 S NODE=$P(NPARY("LOC"),";",1)  ; Assign node variable.
"RTN","GMRCTU",86,0)
 S PIECE=$P(NPARY("LOC"),";",2) ; Assign piece variable.
"RTN","GMRCTU",87,0)
 S APPSTR=")"                   ; Assign append string.
"RTN","GMRCTU",88,0)
 ;
"RTN","GMRCTU",89,0)
 ; Order through file root entries:
"RTN","GMRCTU",90,0)
 S IEN="" ; Initialize.
"RTN","GMRCTU",91,0)
 ;
"RTN","GMRCTU",92,0)
 F  S IEN=$O(@(RSTR_+IEN_")")) Q:+IEN=0  D
"RTN","GMRCTU",93,0)
 .I SSTR="" D  Q          ; Is subfile involved?
"RTN","GMRCTU",94,0)
 ..D FINDVAL              ; Check for value match.
"RTN","GMRCTU",95,0)
 ..I VALUE=USER D CALLDIE ; If a match, clean out pointer entry.
"RTN","GMRCTU",96,0)
 .;
"RTN","GMRCTU",97,0)
 .; Process subfile multiples:
"RTN","GMRCTU",98,0)
 .S SIEN=0 ; Initialize.
"RTN","GMRCTU",99,0)
 .;
"RTN","GMRCTU",100,0)
 .F  S SIEN=$O(@(RSTR_+IEN_","_SSTR_","_SIEN_")")) Q:+SIEN=0  D
"RTN","GMRCTU",101,0)
 ..D FINDVAL ; Check for value match.
"RTN","GMRCTU",102,0)
 ..I VALUE=USER D CALLDIE ; If a match, clean out pointer entry.
"RTN","GMRCTU",103,0)
 ;
"RTN","GMRCTU",104,0)
 Q
"RTN","GMRCTU",105,0)
 ;
"RTN","GMRCTU",106,0)
START(USER) ;Control sequence for complete process.
"RTN","GMRCTU",107,0)
 ;
"RTN","GMRCTU",108,0)
 N CNT,INFO
"RTN","GMRCTU",109,0)
 S CNT=4 ; Set CNT to first TEXT entry.
"RTN","GMRCTU",110,0)
 ;
"RTN","GMRCTU",111,0)
 ; Overall loop to get data from TEXT entries (at end of routine):
"RTN","GMRCTU",112,0)
 F  D  Q:INFO="QUIT"
"RTN","GMRCTU",113,0)
 .N NPARY,VALUE,DIE,DA,DR,X,NODE,PIECE,RSTR,SSTR,FILENUM,IEN,SIEN,FIELDNUM,APPSTR
"RTN","GMRCTU",114,0)
 .S CNT=CNT+1    ; Increment for each TEXT entry.
"RTN","GMRCTU",115,0)
 .S INFO=$P($TEXT(TEXT+CNT),";;",2) ; Get TEXT string.
"RTN","GMRCTU",116,0)
 .Q:INFO="QUIT"  ; Finished when no more valid entries are found.
"RTN","GMRCTU",117,0)
 .; 
"RTN","GMRCTU",118,0)
 .; Assign two variables from INFO string for each file/field:
"RTN","GMRCTU",119,0)
 .S FILENUM=$P(INFO,",",1)
"RTN","GMRCTU",120,0)
 .S FIELDNUM=$P(INFO,",",2)
"RTN","GMRCTU",121,0)
 .;
"RTN","GMRCTU",122,0)
 .D MAIN ; Proceed to main processing for each file/field.
"RTN","GMRCTU",123,0)
 ;
"RTN","GMRCTU",124,0)
 Q
"RTN","GMRCTU",125,0)
 ;
"RTN","GMRCTU",126,0)
 ; *******************************************************************
"RTN","GMRCTU",127,0)
 ;
"RTN","GMRCTU",128,0)
 ; Informational comments on files/fields added to TEXT section.  
"RTN","GMRCTU",129,0)
 ;
"RTN","GMRCTU",130,0)
 ; File Name            File#,Field    Field Name
"RTN","GMRCTU",131,0)
 ; ------------------------------------------------------------------
"RTN","GMRCTU",132,0)
 ; REQUEST SERVICES      123.5,123.5   SPECIAL UPDATES INDIVIDUAL
"RTN","GMRCTU",133,0)
 ; REQUEST SERVICES      123.5,123.08  SERVICE INDIVIDUAL TO NOTIFY
"RTN","GMRCTU",134,0)
 ; (NOTIF. BY PT. LOC)   123.54,1      INDIVIDUAL TO NOTIFY
"RTN","GMRCTU",135,0)
 ; (UPD. USERS W/O NOT.) 123.55,.01    UPDATE USERS W/O NOTIFICATION
"RTN","GMRCTU",136,0)
 ; (ADM. UPDATE USERS)   123.555,.01   ADMINISTRATIVE UPDATE USER
"RTN","GMRCTU",137,0)
 ;
"RTN","GMRCTU",138,0)
 ; ===================================================================
"RTN","GMRCTU",139,0)
 ;
"RTN","GMRCTU",140,0)
 ; EXAMPLES of files/pointer entries being removed for above list:
"RTN","GMRCTU",141,0)
 ;    (Where "777" is the USER) -
"RTN","GMRCTU",142,0)
 ;
"RTN","GMRCTU",143,0)
 ; ^GMR(123.5,2,0) = MEDICINE^1^^18^777
"RTN","GMRCTU",144,0)
 ; ^GMR(123.5,2,123) = 30^1795^2112^^^^^777^11^2199^^
"RTN","GMRCTU",145,0)
 ; ^GMR(123.5,2,123.2,2,0) = 1;DIC(42,^777^138
"RTN","GMRCTU",146,0)
 ; ^GMR(123.5,2,123.3,7,0) = 777                         (<--Multiple)
"RTN","GMRCTU",147,0)
 ; ^GMR(123.5,2,123.33,2,0) = 777                        (<--Multiple)
"RTN","GMRCTU",148,0)
 ;
"RTN","GMRCTU",149,0)
 ; *******************************************************************
"RTN","GMRCTU",150,0)
 ;
"RTN","GMRCTU",151,0)
TEXT ; Make entries below for new files/fields for pointer removal.
"RTN","GMRCTU",152,0)
 ; DO NOT remove or change the last line.
"RTN","GMRCTU",153,0)
 ; Enter comma-delimited lists using DD "pointers in" format:
"RTN","GMRCTU",154,0)
 ;    Filenumber,Fieldnumber,EntryPersonLocation/Initials
"RTN","GMRCTU",155,0)
 ;
"RTN","GMRCTU",156,0)
 ;;123.5,123.5,ISC-SLC/PKS
"RTN","GMRCTU",157,0)
 ;;123.5,123.08,ISC-SLC/PKS
"RTN","GMRCTU",158,0)
 ;;123.54,1,ISC-SLC/PKS
"RTN","GMRCTU",159,0)
 ;;123.55,.01,ISC-SLC/PKS
"RTN","GMRCTU",160,0)
 ;;123.555,.01,ISC-SLC/PKS
"RTN","GMRCTU",161,0)
 ;;QUIT
"RTN","GMRCTU",162,0)
 Q
"RTN","GMRCTU",163,0)
 ;
"RTN","GMRCTU",164,0)
CLNLIST(ORLTEAM,ORLTASK) ; Clean out pointers to 100.21 from 123.5 when a Team List is deleted.
"RTN","GMRCTU",165,0)
 ;
"RTN","GMRCTU",166,0)
 ; Called by MAIN^ORLPTU (which deletes Personal Team Lists upon
"RTN","GMRCTU",167,0)
 ;    termination of a sole or last user of the list).
"RTN","GMRCTU",168,0)
 ;
"RTN","GMRCTU",169,0)
 ; Called by DEL^ORLP1 (when a non-Personal Team List is deleted).
"RTN","GMRCTU",170,0)
 ;
"RTN","GMRCTU",171,0)
 ; Called by DEL^ORLP3U2 (when a Personal Team List is deleted 
"RTN","GMRCTU",172,0)
 ;    by menu action.
"RTN","GMRCTU",173,0)
 ;
"RTN","GMRCTU",174,0)
 ; The following pointers from 123.5 are processed here:
"RTN","GMRCTU",175,0)
 ;
"RTN","GMRCTU",176,0)
 ; Subfile Name            File#,Field    Field Name
"RTN","GMRCTU",177,0)
 ; ----------------------------------------------------------------
"RTN","GMRCTU",178,0)
 ; (SERVICE TEAM(S) TO NOTIFY)  123.1,.01    SERVICE TEAM TO NOTIFY
"RTN","GMRCTU",179,0)
 ; (NOTIF. BY PT LOCATION)      123.2,2      TEAM TO NOTIFY
"RTN","GMRCTU",180,0)
 ; (UPD. TEAMS W/O NOT.)        123.31,.01   UPDATE TEAMS W/O NOTIF.
"RTN","GMRCTU",181,0)
 ; (ADM. UPDATE TEAMS)          123.34,.01   ADMIN. UPDATE TEAM
"RTN","GMRCTU",182,0)
 ;
"RTN","GMRCTU",183,0)
 ; =================================================================
"RTN","GMRCTU",184,0)
 ;
"RTN","GMRCTU",185,0)
 ; Variables used:
"RTN","GMRCTU",186,0)
 ;
"RTN","GMRCTU",187,0)
 ;    ORLTEAM = Team IEN, passed in call to this tag.
"RTN","GMRCTU",188,0)
 ;    ORLTASK = Running via Taskman or not?  0=No, 1=Yes.
"RTN","GMRCTU",189,0)
 ;    ORLGSTR = String for ^GMR(123.5 subfile.
"RTN","GMRCTU",190,0)
 ;    ORLGIEN = Temporary GMRC target file IEN holder.
"RTN","GMRCTU",191,0)
 ;    ORLSIEN = Temporary subfile IEN holder.
"RTN","GMRCTU",192,0)
 ;
"RTN","GMRCTU",193,0)
 I +ORLTEAM="" Q  ; Punt here if there's a problem.
"RTN","GMRCTU",194,0)
 Q:'$D(ORLTASK)   ; Ditto.
"RTN","GMRCTU",195,0)
 N ORLGSTR,ORLGIEN,ORLSIEN
"RTN","GMRCTU",196,0)
 ;
"RTN","GMRCTU",197,0)
 ; Check for team entry in 123.1,.01 via "AST" x-ref:
"RTN","GMRCTU",198,0)
 S ORLGSTR="123.1"
"RTN","GMRCTU",199,0)
 S ORLGIEN=0
"RTN","GMRCTU",200,0)
 F  S ORLGIEN=$O(^GMR(123.5,"AST",ORLTEAM,ORLGIEN)) Q:+ORLGIEN=0  D
"RTN","GMRCTU",201,0)
 .S ORLSIEN=0
"RTN","GMRCTU",202,0)
 .F  S ORLSIEN=$O(^GMR(123.5,"AST",ORLTEAM,ORLGIEN,ORLSIEN)) Q:+ORLSIEN=0  D KPOINT
"RTN","GMRCTU",203,0)
 ;
"RTN","GMRCTU",204,0)
 ; Check for team entry in 123.2,2 via "ANT" x-ref:
"RTN","GMRCTU",205,0)
 S ORLGSTR="123.2"
"RTN","GMRCTU",206,0)
 S ORLGIEN=0
"RTN","GMRCTU",207,0)
 F  S ORLGIEN=$O(^GMR(123.5,"ANT",ORLTEAM,ORLGIEN)) Q:+ORLGIEN=0  D
"RTN","GMRCTU",208,0)
 .S ORLSIEN=0
"RTN","GMRCTU",209,0)
 .F  S ORLSIEN=$O(^GMR(123.5,"ANT",ORLTEAM,ORLGIEN,ORLSIEN)) Q:+ORLSIEN=0  D KPOINT
"RTN","GMRCTU",210,0)
 ;
"RTN","GMRCTU",211,0)
 ; Check for team entry in 123.31,.01 via "AUT" x-ref:
"RTN","GMRCTU",212,0)
 S ORLGSTR="123.31"
"RTN","GMRCTU",213,0)
 S ORLGIEN=0
"RTN","GMRCTU",214,0)
 F  S ORLGIEN=$O(^GMR(123.5,"AUT",ORLTEAM,ORLGIEN)) Q:+ORLGIEN=0  D
"RTN","GMRCTU",215,0)
 .S ORLSIEN=0
"RTN","GMRCTU",216,0)
 .F  S ORLSIEN=$O(^GMR(123.5,"AUT",ORLTEAM,ORLGIEN,ORLSIEN)) Q:+ORLSIEN=0  D KPOINT
"RTN","GMRCTU",217,0)
 ;
"RTN","GMRCTU",218,0)
 ; Check for team entry in 123.34,.01 via "AAT" x-ref:
"RTN","GMRCTU",219,0)
 S ORLGSTR="123.34"
"RTN","GMRCTU",220,0)
 S ORLGIEN=0
"RTN","GMRCTU",221,0)
 F  S ORLGIEN=$O(^GMR(123.5,"AAT",ORLTEAM,ORLGIEN)) Q:+ORLGIEN=0  D
"RTN","GMRCTU",222,0)
 .S ORLSIEN=0
"RTN","GMRCTU",223,0)
 .F  S ORLSIEN=$O(^GMR(123.5,"AAT",ORLTEAM,ORLGIEN,ORLSIEN)) Q:+ORLSIEN=0  D KPOINT
"RTN","GMRCTU",224,0)
 ;
"RTN","GMRCTU",225,0)
 Q
"RTN","GMRCTU",226,0)
 ;
"RTN","GMRCTU",227,0)
KPOINT ; Set variables and call DIK to kill the pointer entry.
"RTN","GMRCTU",228,0)
 ;
"RTN","GMRCTU",229,0)
 N DIK,DA
"RTN","GMRCTU",230,0)
 ;
"RTN","GMRCTU",231,0)
 S DA=ORLSIEN
"RTN","GMRCTU",232,0)
 S DA(1)=ORLGIEN
"RTN","GMRCTU",233,0)
 S DIK="^GMR(123.5,"_DA(1)_","_ORLGSTR_","
"RTN","GMRCTU",234,0)
 ;
"RTN","GMRCTU",235,0)
 ; Wrap locking functionality around call to DIK:
"RTN","GMRCTU",236,0)
 L +(^GMR(123.5,ORLGIEN)):0
"RTN","GMRCTU",237,0)
 D ^DIK ; User terminated, so call regardless of lock success.
"RTN","GMRCTU",238,0)
 L -(^GMR(123.5,ORLGIEN))
"RTN","GMRCTU",239,0)
 I ORLTASK D MES^XPDUTL("Pointer to team IEN "_ORLTEAM_" removed from file 123.5, field "_ORLGSTR_" - service IEN "_ORLGIEN_".") ; Installation message to run under Taskman.
"RTN","GMRCTU",240,0)
 ;
"RTN","GMRCTU",241,0)
 Q
"RTN","GMRCTU",242,0)
 ;
"RTN","GMRCTU1")
0^2^B6724258
"RTN","GMRCTU1",1,0)
GMRCTU1 ; SLC/KR Get DD Info ; [11/8/99 1:57pm]
"RTN","GMRCTU1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**9**;Dec 27, 1997
"RTN","GMRCTU1",3,0)
 ;
"RTN","GMRCTU1",4,0)
INFO(FILE,FIELD,ORA) ;
"RTN","GMRCTU1",5,0)
 ;          
"RTN","GMRCTU1",6,0)
 ;     DIC       Global Root for <FILE>
"RTN","GMRCTU1",7,0)
 ;     LOC       Global Subscript Location  (#;#) for <FIELD>
"RTN","GMRCTU1",8,0)
 ;          
"RTN","GMRCTU1",9,0)
 ;     INFO(<file #>,<field #>,.ARRAY)
"RTN","GMRCTU1",10,0)
 ;           
"RTN","GMRCTU1",11,0)
 ;       Returns
"RTN","GMRCTU1",12,0)
 ;            
"RTN","GMRCTU1",13,0)
 ;         ARRAY("DIC",0)=Global Root
"RTN","GMRCTU1",14,0)
 ;         ARRAY("DIC",1)=File Root
"RTN","GMRCTU1",15,0)
 ;         ARRAY("DIC",2)=Subfile Root
"RTN","GMRCTU1",16,0)
 ;         ARRAY("DIC",..)=Subfile Root
"RTN","GMRCTU1",17,0)
 ;         ARRAY("FILE")=Target File/Subfile Number
"RTN","GMRCTU1",18,0)
 ;         ARRAY("FIELD")=Target Field
"RTN","GMRCTU1",19,0)
 ;         ARRAY("NAME")=Target Field Name
"RTN","GMRCTU1",20,0)
 ;         ARRAY("LOC")=Subscript and Piece
"RTN","GMRCTU1",21,0)
 ;            
"RTN","GMRCTU1",22,0)
 N DIC,LOC,SUB,SUBI,SFS,SNS S (DIC,LOC)="",FILE=+($G(FILE)),FIELD=+($G(FIELD))
"RTN","GMRCTU1",23,0)
 Q:FILE=0!(FIELD=0)  Q:'$D(^DD(FILE))
"RTN","GMRCTU1",24,0)
 S ORA("FILE")=FILE,ORA("FIELD")=FIELD
"RTN","GMRCTU1",25,0)
 D GETDD
"RTN","GMRCTU1",26,0)
 S:$L(DIC) ORA("DIC",0)=$P(DIC,"(",1)_"(",ORA("DIC",1)=DIC
"RTN","GMRCTU1",27,0)
 S:$L($G(SFS)) ORA("DIC",1,"P")=SFS
"RTN","GMRCTU1",28,0)
 S:$L(LOC) ORA("LOC")=LOC
"RTN","GMRCTU1",29,0)
 Q
"RTN","GMRCTU1",30,0)
GETDD ; Get file roots from DD
"RTN","GMRCTU1",31,0)
 ;          
"RTN","GMRCTU1",32,0)
 ;     FILE      Current File #
"RTN","GMRCTU1",33,0)
 ;     FIELD     Current Field #
"RTN","GMRCTU1",34,0)
 ;     DIC       Current Global Root
"RTN","GMRCTU1",35,0)
 ;     LOC       Current Global Subscript Location  (#;#)
"RTN","GMRCTU1",36,0)
 ;     ARY(      Temporay Storage Array (contains DD)
"RTN","GMRCTU1",37,0)
 ;     ORA(      Output Array
"RTN","GMRCTU1",38,0)
 ;          
"RTN","GMRCTU1",39,0)
 N ARY M ARY(FILE,FIELD,0)=^DD(FILE,FIELD,0)
"RTN","GMRCTU1",40,0)
 M ARY(FILE,0,"UP")=^DD(FILE,0,"UP")
"RTN","GMRCTU1",41,0)
 S ORA("NAME")=$P($G(ARY(FILE,FIELD,0)),"^",1)
"RTN","GMRCTU1",42,0)
 S:'$L($G(LOC))&($D(ARY(FILE,FIELD,0))) LOC=$P(ARY(FILE,FIELD,0),"^",4)
"RTN","GMRCTU1",43,0)
 D CURRDD:'$D(ARY(FILE,0,"UP")),NEXTDD:$D(ARY(FILE,0,"UP"))
"RTN","GMRCTU1",44,0)
 Q
"RTN","GMRCTU1",45,0)
CURRDD ; Current DD
"RTN","GMRCTU1",46,0)
 ;          
"RTN","GMRCTU1",47,0)
 ;     FILE      Current File #
"RTN","GMRCTU1",48,0)
 ;     DIC       Current Global Root
"RTN","GMRCTU1",49,0)
 ;     SFS       Subfile Specifier Array
"RTN","GMRCTU1",50,0)
 ;     ARY(      Temporary Storage Array (contains DD)
"RTN","GMRCTU1",51,0)
 ;               
"RTN","GMRCTU1",52,0)
 S DIC=$$ROOT^DILFD(FILE,0,"GL")
"RTN","GMRCTU1",53,0)
 S SFS=$P($$ROOT^DILFD(FILE,0),"^",2)
"RTN","GMRCTU1",54,0)
 Q
"RTN","GMRCTU1",55,0)
NEXTDD ; Next DD Level (for subfiles)
"RTN","GMRCTU1",56,0)
 ;          
"RTN","GMRCTU1",57,0)
 ;     OLDFILE   Previous File #
"RTN","GMRCTU1",58,0)
 ;     OLDFIELD  Previous Field #
"RTN","GMRCTU1",59,0)
 ;     OLDDIC    Previous Global Root
"RTN","GMRCTU1",60,0)
 ;     OLDLOC    Previous Global Subscript Location  (#;#)
"RTN","GMRCTU1",61,0)
 ;     FILE      Current File #
"RTN","GMRCTU1",62,0)
 ;     FIELD     Current Field #
"RTN","GMRCTU1",63,0)
 ;     DIC       Current Global Root
"RTN","GMRCTU1",64,0)
 ;     SNS       Subfile Number and Subfile Specifier
"RTN","GMRCTU1",65,0)
 ;     LOC       Current Global Subscript Location  (#;#)
"RTN","GMRCTU1",66,0)
 ;     ARY(      Temporay Storage Array (contains DD)
"RTN","GMRCTU1",67,0)
 ;     ORA(      Output Array
"RTN","GMRCTU1",68,0)
 ;     SUB(      Subscript Array
"RTN","GMRCTU1",69,0)
 ;     SFS(      Subfile Specifier Array
"RTN","GMRCTU1",70,0)
 ;     SUBI      Subscript Counter
"RTN","GMRCTU1",71,0)
 ;     SS        Subscript
"RTN","GMRCTU1",72,0)
 ;     DA        Internal Entry Number Array
"RTN","GMRCTU1",73,0)
 ;     CT1       Miscellaneous Counter #1
"RTN","GMRCTU1",74,0)
 ;     CT2       Miscellaneous Counter #2
"RTN","GMRCTU1",75,0)
 ;          
"RTN","GMRCTU1",76,0)
 N FILE2,FIELD2,DIC2,LOC2,CT1,CT2
"RTN","GMRCTU1",77,0)
 S LOC2=LOC,(FILE2,FIELD2)=FILE N FILE,FIELD,DIC
"RTN","GMRCTU1",78,0)
 S FILE=$G(ARY(FILE2,0,"UP"))
"RTN","GMRCTU1",79,0)
 N ARY M ARY(FILE,"SB",FIELD2)=^DD(FILE,"SB",FIELD2)
"RTN","GMRCTU1",80,0)
 S FIELD=$O(ARY(FILE,"SB",FILE2,0))
"RTN","GMRCTU1",81,0)
 M ARY(FILE,FIELD,0)=^DD(FILE,FIELD,0)
"RTN","GMRCTU1",82,0)
 S SNS=$P($G(ARY(FILE,FIELD,0)),"^",2)
"RTN","GMRCTU1",83,0)
 S SUBI=+($O(SUB(" "),-1)),SUBI=SUBI+1
"RTN","GMRCTU1",84,0)
 S SUB(SUBI)=$P($P($G(ARY(FILE,FIELD,0)),"^",4),";",1),DIC=""
"RTN","GMRCTU1",85,0)
 S SFS(SUBI)=SNS
"RTN","GMRCTU1",86,0)
 D GETDD
"RTN","GMRCTU1",87,0)
 S LOC=LOC2 I $L(DIC) D
"RTN","GMRCTU1",88,0)
 . S ORA("DIC",0)=$P(DIC,"(",1)_"(",ORA("DIC",1)=DIC
"RTN","GMRCTU1",89,0)
 . N DA,SS F CT1=SUBI:-1:1 S DA="DA("_CT1_")",DIC=DIC_DA_"," D
"RTN","GMRCTU1",90,0)
 . . F CT2=SUBI:-1:1 D
"RTN","GMRCTU1",91,0)
 . . . S SS=$G(SUB(CT2)),DIC=DIC_SS_",",ORA("DIC",(CT2+1))=DIC S:$L($G(SFS(CT2))) ORA("DIC",(CT2+1),"P")=$G(SFS(CT2))
"RTN","GMRCTU1",92,0)
 Q
"RTN","GMRCYP9")
0^3^B54128996
"RTN","GMRCYP9",1,0)
GMRCYP9 ; SLC/PKS-KR Remove Terminated Users ; [2/18/00 3:17pm]
"RTN","GMRCYP9",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**9**;Dec 27, 1997
"RTN","GMRCYP9",3,0)
 Q
"RTN","GMRCYP9",4,0)
 ;           
"RTN","GMRCYP9",5,0)
BF ; Remove Entries for all Terminated Users (By File)
"RTN","GMRCYP9",6,0)
 ;              
"RTN","GMRCYP9",7,0)
 ;     FILENUM   File #
"RTN","GMRCYP9",8,0)
 ;     FIELDNUM  Field #
"RTN","GMRCYP9",9,0)
 ;     LCNT      Line Counter
"RTN","GMRCYP9",10,0)
 ;     RTS(      Array of Global Roots
"RTN","GMRCYP9",11,0)
 ;     GTOT      Grand Total Terminated Users
"RTN","GMRCYP9",12,0)
 ;     GMRCMSG   Array for Bulletin Message
"RTN","GMRCYP9",13,0)
 ;     GMRCCNT   Counter Variable
"RTN","GMRCYP9",14,0)
 ;     XMvars    Set for Bulletin Message
"RTN","GMRCYP9",15,0)
 ;            
"RTN","GMRCYP9",16,0)
 D POST ; Rebuild x-refs for REQUEST SERVICES file.
"RTN","GMRCYP9",17,0)
 ;
"RTN","GMRCYP9",18,0)
 N USR,TAG,FILENUM,FIELDNUM,LCNT,NOW,GTOT,RTS,DIFROM,GMRCMSG,GMRCCNT,XMDUZ,XMY,XMTEXT,XMSUB
"RTN","GMRCYP9",19,0)
 S LCNT=0,GTOT=0,GMRCCNT=0,NOW=DT
"RTN","GMRCYP9",20,0)
 F LCNT=1:1 D CHECK  Q:FILENUM=""!(FIELDNUM="")
"RTN","GMRCYP9",21,0)
 ;
"RTN","GMRCYP9",22,0)
 ; Send a bulletin to the user with information on terminations:
"RTN","GMRCYP9",23,0)
 S XMDUZ=.5,XMY(DUZ)="",XMSUB="  Patch GMRC*3*9 Post-Init Notice"
"RTN","GMRCYP9",24,0)
 S XMTEXT="GMRCMSG("
"RTN","GMRCYP9",25,0)
 S GMRCMSG(GMRCCNT+1,0)=""
"RTN","GMRCYP9",26,0)
 S GMRCMSG(GMRCCNT+2,0)="Upon successful completion of installation "
"RTN","GMRCYP9",27,0)
 S GMRCMSG(GMRCCNT+3,0)="of this patch, be sure to delete routines: "
"RTN","GMRCYP9",28,0)
 S GMRCMSG(GMRCCNT+4,0)="     GMRCYP9"
"RTN","GMRCYP9",29,0)
 S GMRCMSG(GMRCCNT+5,0)="     GMRCYP9B"
"RTN","GMRCYP9",30,0)
 S GMRCMSG(GMRCCNT+6,0)=""
"RTN","GMRCYP9",31,0)
 S GMRCMSG(GMRCCNT+7,0)="NOTE: Data for deleted pointers can be "
"RTN","GMRCYP9",32,0)
 S GMRCMSG(GMRCCNT+8,0)="found in the ""Install File Print"" record."
"RTN","GMRCYP9",33,0)
 S GMRCMSG(GMRCCNT+9,0)="The record can be accessed by using the KIDS "
"RTN","GMRCYP9",34,0)
 S GMRCMSG(GMRCCNT+10,0)="""Utility"" menu ""Install File Print"" option."
"RTN","GMRCYP9",35,0)
 S GMRCMSG(GMRCCNT+11,0)=""
"RTN","GMRCYP9",36,0)
 D ^XMD
"RTN","GMRCYP9",37,0)
 ;
"RTN","GMRCYP9",38,0)
 Q
"RTN","GMRCYP9",39,0)
 ;
"RTN","GMRCYP9",40,0)
CHECK ; Check users in <FILE> and <FIELD>
"RTN","GMRCYP9",41,0)
 ;          
"RTN","GMRCYP9",42,0)
 ;     FILENUM   File #
"RTN","GMRCYP9",43,0)
 ;     FIELDNUM  Field #
"RTN","GMRCYP9",44,0)
 ;     LCNT      Line Counter
"RTN","GMRCYP9",45,0)
 ;     RTS(      Array of Global Roots
"RTN","GMRCYP9",46,0)
 ;            
"RTN","GMRCYP9",47,0)
 S FILENUM=$$FILE(LCNT) Q:FILENUM=""
"RTN","GMRCYP9",48,0)
 S FIELDNUM=$$FIELD(LCNT) Q:FIELDNUM=""
"RTN","GMRCYP9",49,0)
 K RTS
"RTN","GMRCYP9",50,0)
 D INFO^GMRCYP9B(FILENUM,FIELDNUM,.RTS) Q:'$D(RTS)
"RTN","GMRCYP9",51,0)
 D:$D(RTS) REMOVE
"RTN","GMRCYP9",52,0)
 Q
"RTN","GMRCYP9",53,0)
 ;
"RTN","GMRCYP9",54,0)
FILE(X) ; Get File Number
"RTN","GMRCYP9",55,0)
 S TAG="DATC" ; For CONSULTS.
"RTN","GMRCYP9",56,0)
 S X=+($G(X)) Q:X="" "" S X=$P($T(@TAG+X),";;",2) Q:X="" ""
"RTN","GMRCYP9",57,0)
 S X=$P(X,";",1) Q X
"RTN","GMRCYP9",58,0)
 ;           
"RTN","GMRCYP9",59,0)
FIELD(X) ; Get Field Number
"RTN","GMRCYP9",60,0)
 S TAG="DATC" ; For CONSULTS.
"RTN","GMRCYP9",61,0)
 S X=+($G(X)) Q:X="" "" S X=$P($T(@TAG+X),";;",2) Q:X="" ""
"RTN","GMRCYP9",62,0)
 S X=$P(X,";",2) Q X
"RTN","GMRCYP9",63,0)
 ;           
"RTN","GMRCYP9",64,0)
REMOVE ; Remove Terminated User
"RTN","GMRCYP9",65,0)
 ;               
"RTN","GMRCYP9",66,0)
 ;     DA        Current DA Array
"RTN","GMRCYP9",67,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9",68,0)
 ;     LVL       Current Level
"RTN","GMRCYP9",69,0)
 ;     IND       Indentation (for write statements)
"RTN","GMRCYP9",70,0)
 ;     TERM      Terminated Entries Found in File
"RTN","GMRCYP9",71,0)
 ;     TOT       Total Terminated Entries Found
"RTN","GMRCYP9",72,0)
 ;
"RTN","GMRCYP9",73,0)
 N DA,IEN,DIC,LVL,IND,TOT,TERM
"RTN","GMRCYP9",74,0)
 S (TERM,LVL,TOT)=0,IND=2 D REMDAT
"RTN","GMRCYP9",75,0)
 S TOT=+($G(TOT))+($G(TERM)),GTOT=+($G(GTOT))+($G(TOT))
"RTN","GMRCYP9",76,0)
 I +($G(USR))=0 D
"RTN","GMRCYP9",77,0)
 . S GMRCCNT=GMRCCNT+1
"RTN","GMRCYP9",78,0)
 . S:TOT>0 GMRCMSG(GMRCCNT,0)="     "_FILENUM_","_FIELDNUM_": "_TOT_" pointers to terminated users"_" deleted from this field."
"RTN","GMRCYP9",79,0)
 . S:TOT'>0 GMRCMSG(GMRCCNT,0)="     "_FILENUM_","_FIELDNUM_": No pointers to terminated users found in this field."
"RTN","GMRCYP9",80,0)
 Q
"RTN","GMRCYP9",81,0)
 ;
"RTN","GMRCYP9",82,0)
REMDAT ; Get Removal Data (Name and Termination Date)
"RTN","GMRCYP9",83,0)
 ;               
"RTN","GMRCYP9",84,0)
 ;     LVL       Current Level
"RTN","GMRCYP9",85,0)
 ;     RTS(      Array of Global Roots
"RTN","GMRCYP9",86,0)
 ;                    
"RTN","GMRCYP9",87,0)
 S LVL=$O(RTS("DIC",LVL)) D GETDAT
"RTN","GMRCYP9",88,0)
 Q
"RTN","GMRCYP9",89,0)
 ;
"RTN","GMRCYP9",90,0)
GETDAT ; Get Data
"RTN","GMRCYP9",91,0)
 ;               
"RTN","GMRCYP9",92,0)
 ;     DA        Current DA Array
"RTN","GMRCYP9",93,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9",94,0)
 ;     DICP      Current Global Specifier
"RTN","GMRCYP9",95,0)
 ;     LVL       Current Level
"RTN","GMRCYP9",96,0)
 ;     IEN       Current Internal Entry Number
"RTN","GMRCYP9",97,0)
 ;     RTS(      Array of Global Roots
"RTN","GMRCYP9",98,0)
 ;                    
"RTN","GMRCYP9",99,0)
 S DIC=$G(RTS("DIC",LVL)) Q:'$L(DIC)
"RTN","GMRCYP9",100,0)
 S:$L($G(RTS("DIC",LVL,"P"))) DICP=RTS("DIC",LVL,"P")
"RTN","GMRCYP9",101,0)
 S IEN=0 F  S IEN=$O(@(DIC_IEN_")")) Q:+IEN=0  D  Q:+IEN=0
"RTN","GMRCYP9",102,0)
 . Q:+IEN=0  S DA=IEN
"RTN","GMRCYP9",103,0)
 . D NEXTDAT:+($O(RTS("DIC",LVL)))>0,EXTDAT:+($O(RTS("DIC",LVL)))'>0
"RTN","GMRCYP9",104,0)
 Q
"RTN","GMRCYP9",105,0)
 ;
"RTN","GMRCYP9",106,0)
NEXTDAT ; Next Data (for subfiles)
"RTN","GMRCYP9",107,0)
 ;            
"RTN","GMRCYP9",108,0)
 ;     DA        Current DA Array
"RTN","GMRCYP9",109,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9",110,0)
 ;     DICP      Current Global Specifier
"RTN","GMRCYP9",111,0)
 ;     LVL       Current Level
"RTN","GMRCYP9",112,0)
 ;     IEN       Current Internal Entry Number
"RTN","GMRCYP9",113,0)
 ;     OLDDA     Previous DA Array
"RTN","GMRCYP9",114,0)
 ;     OLDDIC    Previous Global Root
"RTN","GMRCYP9",115,0)
 ;     OLDLVL    Previous Level
"RTN","GMRCYP9",116,0)
 ;     CNT       Counter
"RTN","GMRCYP9",117,0)
 ;            
"RTN","GMRCYP9",118,0)
 N CNT,OLDDA,OLDLVL,OLDDIC,OLDDICP
"RTN","GMRCYP9",119,0)
 S OLDDA=DA,OLDLVL=LVL,OLDDIC=DIC,OLDDICP=$G(DICP)
"RTN","GMRCYP9",120,0)
 F CNT=1:1:$O(DA(" "),-1) D
"RTN","GMRCYP9",121,0)
 . S:$D(DA(CNT)) OLDDA(CNT)=DA(CNT)
"RTN","GMRCYP9",122,0)
 N DA
"RTN","GMRCYP9",123,0)
 F CNT=1:1:$O(OLDDA(" "),-1) D
"RTN","GMRCYP9",124,0)
 . S:$D(OLDDA(CNT)) DA(CNT+1)=OLDDA(CNT)
"RTN","GMRCYP9",125,0)
 S DA(1)=OLDDA N IEN,LVL,DIC,DICP S LVL=OLDLVL,DIC=OLDDIC D REMDAT
"RTN","GMRCYP9",126,0)
 Q
"RTN","GMRCYP9",127,0)
 ;
"RTN","GMRCYP9",128,0)
EXTDAT ; Extract Data
"RTN","GMRCYP9",129,0)
 ;          
"RTN","GMRCYP9",130,0)
 ;     GMRCERR   Error Message Array
"RTN","GMRCYP9",131,0)
 ;     CDA       DA Counter
"RTN","GMRCYP9",132,0)
 ;     LDA       Last DA
"RTN","GMRCYP9",133,0)
 ;     NODE      Fully Specified Global Node
"RTN","GMRCYP9",134,0)
 ;     NODEDAT   Data Stored at Global Node
"RTN","GMRCYP9",135,0)
 ;     NODESUB   Node Subscript #
"RTN","GMRCYP9",136,0)
 ;     NODELOC   Node Location ($PIECE # of Node)
"RTN","GMRCYP9",137,0)
 ;     GBLLOC    Global Subscript Location  (#;#)
"RTN","GMRCYP9",138,0)
 ;     DIC       Fully Specified Global Root
"RTN","GMRCYP9",139,0)
 ;     DICP      Global Specifier
"RTN","GMRCYP9",140,0)
 ;     USRP      Pointer to New Person File
"RTN","GMRCYP9",141,0)
 ;     USRNAME   User's Name
"RTN","GMRCYP9",142,0)
 ;     USRITD    Internal form of User's Termination Date
"RTN","GMRCYP9",143,0)
 ;     USRETD    External form of User's Termination Date
"RTN","GMRCYP9",144,0)
 ;     USRSTA    User Status
"RTN","GMRCYP9",145,0)
 ;     USRACT    User Action
"RTN","GMRCYP9",146,0)
 ;     GMRCUSRP  Pointer Holder
"RTN","GMRCYP9",147,0)
 ;          
"RTN","GMRCYP9",148,0)
 N GMRCERR,CDA,LDA,NODE,NODEDAT,NODELOC,NODESUB,GBLLOC,USRP,USRNAME,USRITD,USRETD,USRSTA,USRACT,GMRCUSRP
"RTN","GMRCYP9",149,0)
 S GBLLOC=$G(RTS("LOC")) Q:$L($G(GBLLOC),";")'=2
"RTN","GMRCYP9",150,0)
 S NODESUB=$P($G(GBLLOC),";",1),NODELOC=+($P($G(GBLLOC),";",2))
"RTN","GMRCYP9",151,0)
 Q:'$L(NODESUB)  Q:+(NODELOC)'>0  Q:'$L($G(DIC))  Q:+($G(DA))'>0
"RTN","GMRCYP9",152,0)
 Q:'$L($G(NODESUB))  Q:+($G(NODELOC))'>0  Q:DIC["DA("&(+($G(DA(1)))=0)
"RTN","GMRCYP9",153,0)
 Q:'$L($G(DICP))
"RTN","GMRCYP9",154,0)
 S NODE=DIC_DA_","_NODESUB_")" Q:'$D(@NODE)  S NODEDAT=@NODE
"RTN","GMRCYP9",155,0)
 S USRP=+($P(NODEDAT,"^",NODELOC)) Q:USRP=0
"RTN","GMRCYP9",156,0)
 I +($G(USR))>0,$D(^VA(200,+($G(USR)),0)),$L($P($G(^VA(200,+($G(USR)),0)),"^",1)),+($G(USR))'=USRP Q
"RTN","GMRCYP9",157,0)
 S GMRCUSRP=USRP
"RTN","GMRCYP9",158,0)
 K GMRCERR S USRNAME=$$GET1^DIQ(200,GMRCUSRP,.01,"E",,.GMRCERR) Q:$D(GMRCERR)
"RTN","GMRCYP9",159,0)
 K GMRCERR S USRITD=$$GET1^DIQ(200,GMRCUSRP,9.2,"I",,.GMRCERR) Q:$D(GMRCERR)
"RTN","GMRCYP9",160,0)
 S USRSTA=$$TERM^GMRCYP9B(+USRP),USRACT=$P(USRSTA,"^",1),USRSTA=$S(USRACT=2:"Terminated",USRACT=1:"Future Termination",USRACT=0:"Active User",1:"Undetermined")
"RTN","GMRCYP9",161,0)
 S USRETD=$$FMTE^XLFDT(USRITD,1) Q:USRACT'=2  S:USRACT=2 TERM=TERM+1 D:USRACT=2 DEL
"RTN","GMRCYP9",162,0)
 I +($G(USR))>0,$D(^VA(200,+($G(USR)),0)),$L($P($G(^VA(200,+($G(USR)),0)),"^",1)) Q
"RTN","GMRCYP9",163,0)
 S LDA=+($O(DA(" "),-1))
"RTN","GMRCYP9",164,0)
 Q
"RTN","GMRCYP9",165,0)
 ;
"RTN","GMRCYP9",166,0)
DEL ; Delete Entry
"RTN","GMRCYP9",167,0)
 ;          
"RTN","GMRCYP9",168,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9",169,0)
 ;     OLDDIC    Former DIC (Global Root)
"RTN","GMRCYP9",170,0)
 ;     DIC(0)    Lookup Parameters
"RTN","GMRCYP9",171,0)
 ;     DIC("P")  Subfile Specifiers
"RTN","GMRCYP9",172,0)
 ;     DIC("DR") Data Field String
"RTN","GMRCYP9",173,0)
 ;     OLDDA     Former DA Array
"RTN","GMRCYP9",174,0)
 ;     DA        Current DA Array
"RTN","GMRCYP9",175,0)
 ;                     
"RTN","GMRCYP9",176,0)
 ;     DIE       Global Root
"RTN","GMRCYP9",177,0)
 ;     DIK       Global Root
"RTN","GMRCYP9",178,0)
 ;     DR        Data Field String
"RTN","GMRCYP9",179,0)
 ;     DTOUT     Timeout Flag
"RTN","GMRCYP9",180,0)
 ;     DUOUT     Up-Arrow Out Flag
"RTN","GMRCYP9",181,0)
 ;     DLAYGO    "Learn As You Go" Flag
"RTN","GMRCYP9",182,0)
 ;     OLDDUZ    Former User
"RTN","GMRCYP9",183,0)
 ;     DUZ       Current User
"RTN","GMRCYP9",184,0)
 ;     DUZ(0)    Current User Access
"RTN","GMRCYP9",185,0)
 ;     GL        Fileman Global Location
"RTN","GMRCYP9",186,0)
 ;     UDA       Uppermost DA
"RTN","GMRCYP9",187,0)
 ;     LN        Node to Lock
"RTN","GMRCYP9",188,0)
 ;     VAR       Field Value
"RTN","GMRCYP9",189,0)
 ;     X         Input Data
"RTN","GMRCYP9",190,0)
 ;     Y         Output Data
"RTN","GMRCYP9",191,0)
 ;     I         Counter
"RTN","GMRCYP9",192,0)
 ;          
"RTN","GMRCYP9",193,0)
 Q:'$D(DIC)  Q:'$D(DA)  Q:+($G(RTS("FILE")))=0  Q:+($G(RTS("FIELD")))=0
"RTN","GMRCYP9",194,0)
 ;
"RTN","GMRCYP9",195,0)
 N I,LN,UDA
"RTN","GMRCYP9",196,0)
 S OLDDA=DA,I=0 F  S I=$O(DA(I)) Q:+I=0  S OLDDA(I)=DA(I)
"RTN","GMRCYP9",197,0)
 N DA S DA=OLDDA,I=0 F  S I=$O(OLDDA(I)) Q:+I=0  S DA(I)=OLDDA(I)
"RTN","GMRCYP9",198,0)
 ;
"RTN","GMRCYP9",199,0)
 N DIK,DIE,DR,DLAYGO,DTOUT,DUOUT,X,Y,OLDDIC,OLDDUZ,VAR,GL
"RTN","GMRCYP9",200,0)
 S:$D(DUZ(0)) OLDDUZ=$G(DUZ(0))
"RTN","GMRCYP9",201,0)
 S OLDDIC=$G(DIC)
"RTN","GMRCYP9",202,0)
 N DIC S (DIK,DIE,DIC)=$G(OLDDIC),GL=$G(RTS("DIC",1)) Q:'$D(@(GL_"0)"))
"RTN","GMRCYP9",203,0)
 S UDA=DA S:$D(DA(1))&(+($O(DA(" "),-1))>0) UDA=DA(+($O(DA(" "),-1)))
"RTN","GMRCYP9",204,0)
 Q:+UDA=0  S LN=(GL_UDA_")")
"RTN","GMRCYP9",205,0)
 ;
"RTN","GMRCYP9",206,0)
 S:$D(RTS("DIC",2))&($L($G(DICP))) DIC("P")=$G(DICP)
"RTN","GMRCYP9",207,0)
 S DIC(0)=$G(DIC(0)) S:DIC(0)'["L" DIC(0)=DIC(0)_"L"
"RTN","GMRCYP9",208,0)
 S DLAYGO=+($G(RTS("FILE")))
"RTN","GMRCYP9",209,0)
 S (DR,DIC("DR"))=+($G(RTS("FIELD")))_"///^S X=VAR",VAR="@"
"RTN","GMRCYP9",210,0)
 L +@LN:0
"RTN","GMRCYP9",211,0)
 D ^DIE
"RTN","GMRCYP9",212,0)
 L -@LN
"RTN","GMRCYP9",213,0)
 D MES^XPDUTL("Pointer to "_USRNAME_"/"_+USRP_" deleted from file "_FILENUM_", field "_FIELDNUM_".") ; Installation message to run under Taskman.
"RTN","GMRCYP9",214,0)
 ;
"RTN","GMRCYP9",215,0)
 Q
"RTN","GMRCYP9",216,0)
 ;
"RTN","GMRCYP9",217,0)
DATC ; Data (FILE/FIELDS) for pointer removal (Consults)
"RTN","GMRCYP9",218,0)
 ;;123.5;123.5;ISC-SLC/PKS
"RTN","GMRCYP9",219,0)
 ;;123.5;123.08;ISC-SLC/PKS
"RTN","GMRCYP9",220,0)
 ;;123.54;1;ISC-SLC/PKS
"RTN","GMRCYP9",221,0)
 ;;123.55;.01;ISC-SLC/PKS
"RTN","GMRCYP9",222,0)
 ;;123.555;.01;ISC-SLC/PKS
"RTN","GMRCYP9",223,0)
 ;;
"RTN","GMRCYP9",224,0)
 ;
"RTN","GMRCYP9",225,0)
 Q
"RTN","GMRCYP9",226,0)
 ;
"RTN","GMRCYP9",227,0)
POST ; Further post-install action for patch GMRC*3*9.
"RTN","GMRCYP9",228,0)
 ;
"RTN","GMRCYP9",229,0)
 ; Set variables for Taskman:
"RTN","GMRCYP9",230,0)
 S ZTRTN="RBLDIXS^GMRCYP9"
"RTN","GMRCYP9",231,0)
 S ZTDTH=$H
"RTN","GMRCYP9",232,0)
 S ZTDESC="Consults GMRC*3*9 post-install file ^GMR(123.5 indices rebuild."
"RTN","GMRCYP9",233,0)
 S ZTIO=""
"RTN","GMRCYP9",234,0)
 ;
"RTN","GMRCYP9",235,0)
 ; Call Taskman to run the post-install indices rebuild:
"RTN","GMRCYP9",236,0)
 D ^%ZTLOAD
"RTN","GMRCYP9",237,0)
 Q
"RTN","GMRCYP9",238,0)
 ;
"RTN","GMRCYP9",239,0)
RBLDIXS ; Rebuild indices for ^GMR(123.5 file.
"RTN","GMRCYP9",240,0)
 ;
"RTN","GMRCYP9",241,0)
 N ROOT,IEN,DIK,DA
"RTN","GMRCYP9",242,0)
 S ROOT="^GMR(123.5," ; Common file root for x-refs.
"RTN","GMRCYP9",243,0)
 ;
"RTN","GMRCYP9",244,0)
 S IEN=0
"RTN","GMRCYP9",245,0)
 F  S IEN=$O(^GMR(123.5,IEN)) Q:'IEN  D  ; Each Consults service.
"RTN","GMRCYP9",246,0)
 .S DA(1)=IEN,DIK=ROOT_DA(1)_",123.1,",DIK(1)=.01
"RTN","GMRCYP9",247,0)
 .D ENALL^DIK         ; Rebuild "AST" x-ref.
"RTN","GMRCYP9",248,0)
 .;
"RTN","GMRCYP9",249,0)
 .S DA(1)=IEN,DIK=ROOT_DA(1)_",123.2,",DIK(1)=2
"RTN","GMRCYP9",250,0)
 .D ENALL^DIK         ; Rebuild "ANT" x-ref.
"RTN","GMRCYP9",251,0)
 .;
"RTN","GMRCYP9",252,0)
 .S DA(1)=IEN,DIK=ROOT_DA(1)_",123.31,",DIK(1)=.01
"RTN","GMRCYP9",253,0)
 .D ENALL^DIK         ; Rebuild "AUT" x-ref.
"RTN","GMRCYP9",254,0)
 .;
"RTN","GMRCYP9",255,0)
 .S DA(1)=IEN,DIK=ROOT_DA(1)_",123.34,",DIK(1)=.01
"RTN","GMRCYP9",256,0)
 .D ENALL^DIK         ; Rebuild "AAT" x-ref.
"RTN","GMRCYP9",257,0)
 ;
"RTN","GMRCYP9",258,0)
 Q
"RTN","GMRCYP9",259,0)
 ;
"RTN","GMRCYP9B")
0^4^B12746332
"RTN","GMRCYP9B",1,0)
GMRCYP9B ; SLC/PKS-KR Remove Terminated Users (get DD info) ; [11/8/99 1:51pm]
"RTN","GMRCYP9B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**9**;Dec 27, 1997
"RTN","GMRCYP9B",3,0)
 Q
"RTN","GMRCYP9B",4,0)
 ;          
"RTN","GMRCYP9B",5,0)
INFO(FILE,FIELD,ORA) ;
"RTN","GMRCYP9B",6,0)
 ;          
"RTN","GMRCYP9B",7,0)
 ;     DIC       Global Root for <FILE>
"RTN","GMRCYP9B",8,0)
 ;     LOC       Global Subscript Location  (#;#) for <FIELD>
"RTN","GMRCYP9B",9,0)
 ;          
"RTN","GMRCYP9B",10,0)
 ;     INFO(<file #>,<field #>,.ARRAY)
"RTN","GMRCYP9B",11,0)
 ;           
"RTN","GMRCYP9B",12,0)
 ;       Returns
"RTN","GMRCYP9B",13,0)
 ;            
"RTN","GMRCYP9B",14,0)
 ;         ARRAY("DIC",0)=Global Root
"RTN","GMRCYP9B",15,0)
 ;         ARRAY("DIC",1)=File Root
"RTN","GMRCYP9B",16,0)
 ;         ARRAY("DIC",2)=Subfile Root
"RTN","GMRCYP9B",17,0)
 ;         ARRAY("DIC",..)=Subfile Root
"RTN","GMRCYP9B",18,0)
 ;         ARRAY("FILE")=Target File/Subfile Number
"RTN","GMRCYP9B",19,0)
 ;         ARRAY("FIELD")=Target Field
"RTN","GMRCYP9B",20,0)
 ;         ARRAY("NAME")=Target Field Name
"RTN","GMRCYP9B",21,0)
 ;         ARRAY("LOC")=Subscript and Piece
"RTN","GMRCYP9B",22,0)
 ;            
"RTN","GMRCYP9B",23,0)
 N DIC,LOC,SUB,SUBI,SFS,SNS S (DIC,LOC)="",FILE=+($G(FILE)),FIELD=+($G(FIELD))
"RTN","GMRCYP9B",24,0)
 Q:FILE=0!(FIELD=0)  Q:'$D(^DD(FILE))
"RTN","GMRCYP9B",25,0)
 S ORA("FILE")=FILE,ORA("FIELD")=FIELD
"RTN","GMRCYP9B",26,0)
 D GETDD
"RTN","GMRCYP9B",27,0)
 S:$L(DIC) ORA("DIC",0)=$P(DIC,"(",1)_"(",ORA("DIC",1)=DIC
"RTN","GMRCYP9B",28,0)
 S:$L($G(SFS)) ORA("DIC",1,"P")=SFS
"RTN","GMRCYP9B",29,0)
 S:$L(LOC) ORA("LOC")=LOC
"RTN","GMRCYP9B",30,0)
 Q
"RTN","GMRCYP9B",31,0)
GETDD ; Get file roots from DD
"RTN","GMRCYP9B",32,0)
 ;          
"RTN","GMRCYP9B",33,0)
 ;     FILE      Current File #
"RTN","GMRCYP9B",34,0)
 ;     FIELD     Current Field #
"RTN","GMRCYP9B",35,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9B",36,0)
 ;     LOC       Current Global Subscript Location  (#;#)
"RTN","GMRCYP9B",37,0)
 ;     ARY(      Temporay Storage Array (contains DD)
"RTN","GMRCYP9B",38,0)
 ;     ORA(      Output Array
"RTN","GMRCYP9B",39,0)
 ;          
"RTN","GMRCYP9B",40,0)
 N ARY M ARY(FILE,FIELD,0)=^DD(FILE,FIELD,0)
"RTN","GMRCYP9B",41,0)
 M ARY(FILE,0,"UP")=^DD(FILE,0,"UP")
"RTN","GMRCYP9B",42,0)
 S ORA("NAME")=$P($G(ARY(FILE,FIELD,0)),"^",1)
"RTN","GMRCYP9B",43,0)
 S:'$L($G(LOC))&($D(ARY(FILE,FIELD,0))) LOC=$P(ARY(FILE,FIELD,0),"^",4)
"RTN","GMRCYP9B",44,0)
 D CURRDD:'$D(ARY(FILE,0,"UP")),NEXTDD:$D(ARY(FILE,0,"UP"))
"RTN","GMRCYP9B",45,0)
 Q
"RTN","GMRCYP9B",46,0)
CURRDD ; Current DD
"RTN","GMRCYP9B",47,0)
 ;          
"RTN","GMRCYP9B",48,0)
 ;     FILE      Current File #
"RTN","GMRCYP9B",49,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9B",50,0)
 ;     SFS       Subfile Specifier Array
"RTN","GMRCYP9B",51,0)
 ;     ARY(      Temporary Storage Array (contains DD)
"RTN","GMRCYP9B",52,0)
 ;               
"RTN","GMRCYP9B",53,0)
 S DIC=$$ROOT^DILFD(FILE,0,"GL")
"RTN","GMRCYP9B",54,0)
 S SFS=$P($$ROOT^DILFD(FILE,0),"^",2)
"RTN","GMRCYP9B",55,0)
 Q
"RTN","GMRCYP9B",56,0)
NEXTDD ; Next DD Level (for subfiles)
"RTN","GMRCYP9B",57,0)
 ;          
"RTN","GMRCYP9B",58,0)
 ;     OLDFILE   Previous File #
"RTN","GMRCYP9B",59,0)
 ;     OLDFIELD  Previous Field #
"RTN","GMRCYP9B",60,0)
 ;     OLDDIC    Previous Global Root
"RTN","GMRCYP9B",61,0)
 ;     OLDLOC    Previous Global Subscript Location  (#;#)
"RTN","GMRCYP9B",62,0)
 ;     FILE      Current File #
"RTN","GMRCYP9B",63,0)
 ;     FIELD     Current Field #
"RTN","GMRCYP9B",64,0)
 ;     DIC       Current Global Root
"RTN","GMRCYP9B",65,0)
 ;     SNS       Subfile Number and Subfile Specifier
"RTN","GMRCYP9B",66,0)
 ;     LOC       Current Global Subscript Location  (#;#)
"RTN","GMRCYP9B",67,0)
 ;     ARY(      Temporay Storage Array (contains DD)
"RTN","GMRCYP9B",68,0)
 ;     ORA(      Output Array
"RTN","GMRCYP9B",69,0)
 ;     SUB(      Subscript Array
"RTN","GMRCYP9B",70,0)
 ;     SFS(      Subfile Specifier Array
"RTN","GMRCYP9B",71,0)
 ;     SUBI      Subscript Counter
"RTN","GMRCYP9B",72,0)
 ;     SS        Subscript
"RTN","GMRCYP9B",73,0)
 ;     DA        Internal Entry Number Array
"RTN","GMRCYP9B",74,0)
 ;     CT1       Miscellaneous Counter #1
"RTN","GMRCYP9B",75,0)
 ;     CT2       Miscellaneous Counter #2
"RTN","GMRCYP9B",76,0)
 ;          
"RTN","GMRCYP9B",77,0)
 N FILE2,FIELD2,DIC2,LOC2,CT1,CT2
"RTN","GMRCYP9B",78,0)
 S LOC2=LOC,(FILE2,FIELD2)=FILE N FILE,FIELD,DIC
"RTN","GMRCYP9B",79,0)
 S FILE=$G(ARY(FILE2,0,"UP"))
"RTN","GMRCYP9B",80,0)
 N ARY M ARY(FILE,"SB",FIELD2)=^DD(FILE,"SB",FIELD2)
"RTN","GMRCYP9B",81,0)
 S FIELD=$O(ARY(FILE,"SB",FILE2,0))
"RTN","GMRCYP9B",82,0)
 M ARY(FILE,FIELD,0)=^DD(FILE,FIELD,0)
"RTN","GMRCYP9B",83,0)
 S SNS=$P($G(ARY(FILE,FIELD,0)),"^",2)
"RTN","GMRCYP9B",84,0)
 S SUBI=+($O(SUB(" "),-1)),SUBI=SUBI+1
"RTN","GMRCYP9B",85,0)
 S SUB(SUBI)=$P($P($G(ARY(FILE,FIELD,0)),"^",4),";",1),DIC=""
"RTN","GMRCYP9B",86,0)
 S SFS(SUBI)=SNS
"RTN","GMRCYP9B",87,0)
 D GETDD
"RTN","GMRCYP9B",88,0)
 S LOC=LOC2 I $L(DIC) D
"RTN","GMRCYP9B",89,0)
 . S ORA("DIC",0)=$P(DIC,"(",1)_"(",ORA("DIC",1)=DIC
"RTN","GMRCYP9B",90,0)
 . N DA,SS F CT1=SUBI:-1:1 S DA="DA("_CT1_")",DIC=DIC_DA_"," D
"RTN","GMRCYP9B",91,0)
 . . F CT2=SUBI:-1:1 D
"RTN","GMRCYP9B",92,0)
 . . . S SS=$G(SUB(CT2)),DIC=DIC_SS_",",ORA("DIC",(CT2+1))=DIC S:$L($G(SFS(CT2))) ORA("DIC",(CT2+1),"P")=$G(SFS(CT2))
"RTN","GMRCYP9B",93,0)
 Q
"RTN","GMRCYP9B",94,0)
 ;
"RTN","GMRCYP9B",95,0)
TERM(X) ; Terminated
"RTN","GMRCYP9B",96,0)
 ;          
"RTN","GMRCYP9B",97,0)
 ;    Returns    Status^Explanation
"RTN","GMRCYP9B",98,0)
 ;             
"RTN","GMRCYP9B",99,0)
 ;       2 = Terminated
"RTN","GMRCYP9B",100,0)
 ;       1 = Future Termination
"RTN","GMRCYP9B",101,0)
 ;       0 = Not Terminated
"RTN","GMRCYP9B",102,0)
 ;      -1 = Error^Error Text
"RTN","GMRCYP9B",103,0)
 ;            
"RTN","GMRCYP9B",104,0)
 ;     USR       New Person
"RTN","GMRCYP9B",105,0)
 ;     NAM       New Person Name
"RTN","GMRCYP9B",106,0)
 ;     NOW       Today's Date
"RTN","GMRCYP9B",107,0)
 ;     %         Fileman Date and Time
"RTN","GMRCYP9B",108,0)
 ;     %I(       Fileman Date Array
"RTN","GMRCYP9B",109,0)
 ;     %H        $H Date and Time
"RTN","GMRCYP9B",110,0)
 ;     X         Today
"RTN","GMRCYP9B",111,0)
 ;     ERR       Error array
"RTN","GMRCYP9B",112,0)
 ;
"RTN","GMRCYP9B",113,0)
 N USR,USRITD,NAM,NOW,%,%I,%H,ERR S USR=+($G(X)) Q:USR=0 "-1^Invalid User"
"RTN","GMRCYP9B",114,0)
 Q:'$D(^VA(200,+USR,0)) "-1^User not found"
"RTN","GMRCYP9B",115,0)
 Q:'$L($P($G(^VA(200,+USR,0)),"^",1)) "-1^Invalid User (no name)"
"RTN","GMRCYP9B",116,0)
 S NAM=$P($G(^VA(200,+USR,0)),"^",1)
"RTN","GMRCYP9B",117,0)
 D NOW^%DTC S NOW=X
"RTN","GMRCYP9B",118,0)
 S USRITD=$$GET1^DIQ(200,USR,9.2,"I",,.ERR) Q:$D(ERR) "-1^Invalid User"
"RTN","GMRCYP9B",119,0)
 Q:USRITD="" ("0^User ("_NAM_") is an active user")
"RTN","GMRCYP9B",120,0)
 Q:+USRITD=0 ("0^User ("_NAM_")  is an active user")
"RTN","GMRCYP9B",121,0)
 Q:+USRITD'>NOW ("2^User ("_NAM_") has been terminated")
"RTN","GMRCYP9B",122,0)
 Q:+USRITD<NOW ("1^User ("_NAM_") will be terminated on "_$$FMTE^XLFDT(USRITD))
"RTN","GMRCYP9B",123,0)
 Q "-1^Undetermined"
"RTN","GMRCYP9B",124,0)
 ;
"UP",123.5,123.53,-1)
123.5^123.1
"UP",123.5,123.53,0)
123.53
"UP",123.5,123.54,-1)
123.5^123.2
"UP",123.5,123.54,0)
123.54
"UP",123.5,123.55,-1)
123.5^123.3
"UP",123.5,123.55,0)
123.55
"UP",123.5,123.555,-1)
123.5^123.33
"UP",123.5,123.555,0)
123.555
"VER")
8.0^22.0
"^DD",123.5,123.5,123.08,0)
SERVICE INDIVIDUAL TO NOTIFY^*P200'^VA(200,^123;8^S DIC("S")="I $$ACTIVE^XUSER(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.5,123.08,3)
Enter the name of the individual in the Service who will receive a default notification of any action taken on a consult.
"^DD",123.5,123.5,123.08,12)
Only active users may be selected
"^DD",123.5,123.5,123.08,12.1)
S DIC("S")="I $$ACTIVE^XUSER(+Y)"
"^DD",123.5,123.5,123.08,21,0)
^^11^11^3000113^^^^
"^DD",123.5,123.5,123.08,21,1,0)
A user may be identified in this field as having primary responsibility for
"^DD",123.5,123.5,123.08,21,2,0)
receiving consults and tracking them through to completion or 
"^DD",123.5,123.5,123.08,21,3,0)
discontinuance.  This individual will receive a "NEW SERVICE CONSULT"
"^DD",123.5,123.5,123.08,21,4,0)
notification type when a new order is released to the service
"^DD",123.5,123.5,123.08,21,5,0)
through CPRS.  The notification will appear in the following
"^DD",123.5,123.5,123.08,21,6,0)
format:
"^DD",123.5,123.5,123.08,21,7,0)
  NIVEK,ALP (N8976): New Psychology Consult ordered
"^DD",123.5,123.5,123.08,21,8,0)
  JONES,GEO (J4552): New Psychology consult forwarded - Stat
"^DD",123.5,123.5,123.08,21,9,0)
  
"^DD",123.5,123.5,123.08,21,10,0)
The user must have the "NEW SERVICE CONSULT/REQUEST" notification type
"^DD",123.5,123.5,123.08,21,11,0)
enabled.
"^DD",123.5,123.5,123.08,"DT")
3000113
"^DD",123.5,123.5,123.1,0)
SERVICE TEAM(S) TO NOTIFY^123.53P^^123.1;0
"^DD",123.5,123.5,123.1,21,0)
^^2^2^2991129^^^^
"^DD",123.5,123.5,123.1,21,1,0)
A service can have teams of users associated with the Service.  Any users
"^DD",123.5,123.5,123.1,21,2,0)
defined in a team related to the Service will receive Notifications.
"^DD",123.5,123.5,123.1,"DT")
2920605
"^DD",123.5,123.5,123.3,0)
UPDATE USERS W/O NOTIFICATIONS^123.55P^^123.3;0
"^DD",123.5,123.5,123.3,21,0)
^^4^4^3000113^^^^
"^DD",123.5,123.5,123.3,21,1,0)
Service users who are able to perform update tracking actions,
"^DD",123.5,123.5,123.3,21,2,0)
but DO NOT receive "NEW SERVICE CONSULT" notifications, should be defined
"^DD",123.5,123.5,123.3,21,3,0)
here.  The update tracking capabilities are based on the Protocol
"^DD",123.5,123.5,123.3,21,4,0)
Action Menu by Users field.
"^DD",123.5,123.5,123.33,0)
ADMINISTRATIVE UPDATE USERS^123.555P^^123.33;0
"^DD",123.5,123.5,123.33,"DT")
2991129
"^DD",123.5,123.5,123.5,0)
SPECIAL UPDATES INDIVIDUAL^*P200'^VA(200,^0;4^S DIC("S")="I $$ACTIVE^XUSER(+Y)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",123.5,123.5,123.5,3)
This is the individual who can perform special updates for this particular service. 
"^DD",123.5,123.5,123.5,12)
Only active users may be selected
"^DD",123.5,123.5,123.5,12.1)
S DIC("S")="I $$ACTIVE^XUSER(+Y)"
"^DD",123.5,123.5,123.5,21,0)
^^9^9^2990603^^
"^DD",123.5,123.5,123.5,21,1,0)
This individual will have privileges to perform group status updates for
"^DD",123.5,123.5,123.5,21,2,0)
this service or any of the entries in the SUB-SERVICE/SPECIALTY field. 
"^DD",123.5,123.5,123.5,21,3,0)
 
"^DD",123.5,123.5,123.5,21,4,0)
It is recommended that this individual be a responsible service update
"^DD",123.5,123.5,123.5,21,5,0)
user or a Clinical Application Coordinator. If given the option GMRCSTSU,
"^DD",123.5,123.5,123.5,21,6,0)
the user will be able to choose all requests within a date range that are
"^DD",123.5,123.5,123.5,21,7,0)
pending, active or both and update the request to discontinued or
"^DD",123.5,123.5,123.5,21,8,0)
complete. This will also update the related order in CPRS to the same
"^DD",123.5,123.5,123.5,21,9,0)
status.
"^DD",123.5,123.5,123.5,"DT")
3000113
"^DD",123.5,123.53,0)
SERVICE TEAM(S) TO NOTIFY SUB-FIELD^^.01^1
"^DD",123.5,123.53,0,"NM","SERVICE TEAM(S) TO NOTIFY")

"^DD",123.5,123.53,.01,0)
SERVICE TEAM TO NOTIFY^MP100.21'^OR(100.21,^0;1^Q
"^DD",123.5,123.53,.01,1,0)
^.1
"^DD",123.5,123.53,.01,1,1,0)
123.53^B
"^DD",123.5,123.53,.01,1,1,1)
S ^GMR(123.5,DA(1),123.1,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.53,.01,1,1,2)
K ^GMR(123.5,DA(1),123.1,"B",$E(X,1,30),DA)
"^DD",123.5,123.53,.01,1,2,0)
123.5^AST
"^DD",123.5,123.53,.01,1,2,1)
S ^GMR(123.5,"AST",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.53,.01,1,2,2)
K ^GMR(123.5,"AST",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.53,.01,1,2,"%D",0)
^^2^2^2990910^
"^DD",123.5,123.53,.01,1,2,"%D",1,0)
The "AST" cross reference is used for deletion of pointer values when
"^DD",123.5,123.53,.01,1,2,"%D",2,0)
an entry is deleted from the OE/RR LIST (#100.21) file.
"^DD",123.5,123.53,.01,1,2,"DT")
2990910
"^DD",123.5,123.53,.01,3)
Enter the name of the Service Team that is to receive notifications of any actions taken on a consult.
"^DD",123.5,123.53,.01,21,0)
^^9^9^2991129^
"^DD",123.5,123.53,.01,21,1,0)
A team of users may be identified (from the OE/RR LIST file, #100.21) that
"^DD",123.5,123.53,.01,21,2,0)
will receive a "NEW SERVICE CONSULT" notification when a new order is
"^DD",123.5,123.53,.01,21,3,0)
released to the service through OE/RR.  The notification will appear in
"^DD",123.5,123.53,.01,21,4,0)
the following format:
"^DD",123.5,123.53,.01,21,5,0)
   NIVEK,ALP (N8796): New Psychology Consult ordered
"^DD",123.5,123.53,.01,21,6,0)
The individuals on the teams must have the "NEW SERVICE CONSULT/REQUEST"
"^DD",123.5,123.53,.01,21,7,0)
notification type turned "ON".
"^DD",123.5,123.53,.01,21,8,0)
  
"^DD",123.5,123.53,.01,21,9,0)
Team members will be able to perform update tracking capabilities.
"^DD",123.5,123.53,.01,"DT")
2991020
"^DD",123.5,123.54,1,0)
INDIVIDUAL TO NOTIFY^*P200'^VA(200,^0;2^S DIC("S")="I $$ACTIVE^XUSER(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.54,1,3)
Enter the individual's name who is responsible for receiving notifications of actions on consults at this location.
"^DD",123.5,123.54,1,12)
Only active users may be selected.
"^DD",123.5,123.54,1,12.1)
S DIC("S")="I $$ACTIVE^XUSER(+Y)"
"^DD",123.5,123.54,1,21,0)
^^6^6^3000113^^^^
"^DD",123.5,123.54,1,21,1,0)
This is the Individual that is assigned to this location for this 
"^DD",123.5,123.54,1,21,2,0)
Service.  When a consult/request order for this Service is released
"^DD",123.5,123.54,1,21,3,0)
from OE/RR for a patient at this location, this individual will 
"^DD",123.5,123.54,1,21,4,0)
receive the new order notification.
"^DD",123.5,123.54,1,21,5,0)
Enter the individual who should receive notifications when a consult 
"^DD",123.5,123.54,1,21,6,0)
order is released from OE/RR FOR this service, FROM this location.
"^DD",123.5,123.54,1,"DT")
3000113
"^DD",123.5,123.54,2,0)
TEAM TO NOTIFY^P100.21'^OR(100.21,^0;3^Q
"^DD",123.5,123.54,2,1,0)
^.1
"^DD",123.5,123.54,2,1,1,0)
123.5^ANT
"^DD",123.5,123.54,2,1,1,1)
S ^GMR(123.5,"ANT",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.54,2,1,1,2)
K ^GMR(123.5,"ANT",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.54,2,1,1,"%D",0)
^^2^2^2990910^
"^DD",123.5,123.54,2,1,1,"%D",1,0)
The "ANT" cross reference is used for deletion of pointer values when an
"^DD",123.5,123.54,2,1,1,"%D",2,0)
entry is deleted from the OE/RR LIST (#100.21) file.
"^DD",123.5,123.54,2,1,1,"DT")
2990910
"^DD",123.5,123.54,2,3)
Enter the name of the TEAM at this location which is to receive notifications of any actions taken on a consult.
"^DD",123.5,123.54,2,21,0)
^^1^1^2970611^^^^
"^DD",123.5,123.54,2,21,1,0)
This is the Team that is assigned to this location for the Service.
"^DD",123.5,123.54,2,"DT")
2990910
"^DD",123.5,123.55,0)
UPDATE USERS W/O NOTIFICATIONS SUB-FIELD^^.01^1
"^DD",123.5,123.55,0,"NM","UPDATE USERS W/O NOTIFICATIONS")

"^DD",123.5,123.55,.01,0)
UPDATE USERS W/O NOTIFICATIONS^M*P200'^VA(200,^0;1^S DIC("S")="I $$ACTIVE^XUSER(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.55,.01,1,0)
^.1
"^DD",123.5,123.55,.01,1,1,0)
123.55^B
"^DD",123.5,123.55,.01,1,1,1)
S ^GMR(123.5,DA(1),123.3,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.55,.01,1,1,2)
K ^GMR(123.5,DA(1),123.3,"B",$E(X,1,30),DA)
"^DD",123.5,123.55,.01,3)
Enter the name of individual who can do update tracking, but who will not get a notification.
"^DD",123.5,123.55,.01,12)
Only active users may be selected.
"^DD",123.5,123.55,.01,12.1)
S DIC("S")="I $$ACTIVE^XUSER(+Y)"
"^DD",123.5,123.55,.01,21,0)
^^4^4^3000113^^^^
"^DD",123.5,123.55,.01,21,1,0)
Service users who should be able to perform update tracking capabilities,
"^DD",123.5,123.55,.01,21,2,0)
but DO NOT receive "NEW SERVICE CONSULT" notifications should be defined
"^DD",123.5,123.55,.01,21,3,0)
here.  The update tracking capabilities will be based on the Protocol
"^DD",123.5,123.55,.01,21,4,0)
Action Menu By Users field.
"^DD",123.5,123.55,.01,"DT")
3000113
"^DD",123.5,123.555,0)
ADMINISTRATIVE UPDATE USERS SUB-FIELD^^.02^2
"^DD",123.5,123.555,0,"NM","ADMINISTRATIVE UPDATE USERS")

"^DD",123.5,123.555,.01,0)
ADMINISTRATIVE UPDATE USER^M*P200'^VA(200,^0;1^S DIC("S")="I $$ACTIVE^XUSER(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.555,.01,1,0)
^.1
"^DD",123.5,123.555,.01,1,1,0)
123.555^B
"^DD",123.5,123.555,.01,1,1,1)
S ^GMR(123.5,DA(1),123.33,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.555,.01,1,1,2)
K ^GMR(123.5,DA(1),123.33,"B",$E(X,1,30),DA)
"^DD",123.5,123.555,.01,3)
Enter the administrative users name.
"^DD",123.5,123.555,.01,12)
Only active users may be selected
"^DD",123.5,123.555,.01,12.1)
S DIC("S")="I $$ACTIVE^XUSER(+Y)"
"^DD",123.5,123.555,.01,21,0)
^^3^3^3000113^^^^
"^DD",123.5,123.555,.01,21,1,0)
This multiple allows the administrative users for a service to be
"^DD",123.5,123.555,.01,21,2,0)
identified.  Administrative users update actions may be different from the
"^DD",123.5,123.555,.01,21,3,0)
service update users' actions.
"^DD",123.5,123.555,.01,"DT")
3000113
**END**
**END**
