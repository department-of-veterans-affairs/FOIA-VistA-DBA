Released DG*5.3*479 SEQ #480
Extracted from mail message
**KIDS**:DG*5.3*479^

**INSTALL NAME**
DG*5.3*479
"BLD",1606,0)
DG*5.3*479^REGISTRATION^0^3031105^y
"BLD",1606,1,0)
^^3^3^3031105^
"BLD",1606,1,1,0)
NEW MESSAGE STRUCTURE - PHASE 3
"BLD",1606,1,2,0)
Refer to patch DG*5.3*479 in the FORUM Patch Module for a complete
"BLD",1606,1,3,0)
description.
"BLD",1606,4,0)
^9.64PA^^0
"BLD",1606,"ABNS",0)
^9.66A^^
"BLD",1606,"ABPKG")
^^
"BLD",1606,"INI")
DG479PRE
"BLD",1606,"INID")
^^y
"BLD",1606,"INIT")

"BLD",1606,"KRN",0)
^9.67PA^8989.52^19
"BLD",1606,"KRN",.4,0)
.4
"BLD",1606,"KRN",.401,0)
.401
"BLD",1606,"KRN",.402,0)
.402
"BLD",1606,"KRN",.403,0)
.403
"BLD",1606,"KRN",.5,0)
.5
"BLD",1606,"KRN",.84,0)
.84
"BLD",1606,"KRN",3.6,0)
3.6
"BLD",1606,"KRN",3.8,0)
3.8
"BLD",1606,"KRN",9.2,0)
9.2
"BLD",1606,"KRN",9.8,0)
9.8
"BLD",1606,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",1606,"KRN",9.8,"NM",1,0)
DG479PRE^^0^B11367954
"BLD",1606,"KRN",9.8,"NM",2,0)
VAFCEHU3^^0^B18624665
"BLD",1606,"KRN",9.8,"NM",3,0)
VAFCEHU4^^0^B4700129
"BLD",1606,"KRN",9.8,"NM",4,0)
VAFCMGB^^0^B2679368
"BLD",1606,"KRN",9.8,"NM",5,0)
VAFCMGB0^^0^B44177478
"BLD",1606,"KRN",9.8,"NM",6,0)
VAFCMGB1^^0^B16780500
"BLD",1606,"KRN",9.8,"NM",7,0)
VAFCMGB2^^0^B34388910
"BLD",1606,"KRN",9.8,"NM",8,0)
VAFCMGB3^^0^B32660474
"BLD",1606,"KRN",9.8,"NM",9,0)
VAFCMGU0^^0^B19941380
"BLD",1606,"KRN",9.8,"NM",10,0)
VAFCRAU^^0^B6565055
"BLD",1606,"KRN",9.8,"NM",11,0)
VAFCRAUD^^0^B58689047
"BLD",1606,"KRN",9.8,"NM",12,0)
VAFCRPC^^0^B7443211
"BLD",1606,"KRN",9.8,"NM",13,0)
VAFCMGA^^0^B55715754
"BLD",1606,"KRN",9.8,"NM","B","DG479PRE",1)

"BLD",1606,"KRN",9.8,"NM","B","VAFCEHU3",2)

"BLD",1606,"KRN",9.8,"NM","B","VAFCEHU4",3)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGA",13)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGB",4)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGB0",5)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGB1",6)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGB2",7)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGB3",8)

"BLD",1606,"KRN",9.8,"NM","B","VAFCMGU0",9)

"BLD",1606,"KRN",9.8,"NM","B","VAFCRAU",10)

"BLD",1606,"KRN",9.8,"NM","B","VAFCRAUD",11)

"BLD",1606,"KRN",9.8,"NM","B","VAFCRPC",12)

"BLD",1606,"KRN",19,0)
19
"BLD",1606,"KRN",19.1,0)
19.1
"BLD",1606,"KRN",101,0)
101
"BLD",1606,"KRN",409.61,0)
409.61
"BLD",1606,"KRN",771,0)
771
"BLD",1606,"KRN",870,0)
870
"BLD",1606,"KRN",8989.51,0)
8989.51
"BLD",1606,"KRN",8989.52,0)
8989.52
"BLD",1606,"KRN",8994,0)
8994
"BLD",1606,"KRN","B",.4,.4)

"BLD",1606,"KRN","B",.401,.401)

"BLD",1606,"KRN","B",.402,.402)

"BLD",1606,"KRN","B",.403,.403)

"BLD",1606,"KRN","B",.5,.5)

"BLD",1606,"KRN","B",.84,.84)

"BLD",1606,"KRN","B",3.6,3.6)

"BLD",1606,"KRN","B",3.8,3.8)

"BLD",1606,"KRN","B",9.2,9.2)

"BLD",1606,"KRN","B",9.8,9.8)

"BLD",1606,"KRN","B",19,19)

"BLD",1606,"KRN","B",19.1,19.1)

"BLD",1606,"KRN","B",101,101)

"BLD",1606,"KRN","B",409.61,409.61)

"BLD",1606,"KRN","B",771,771)

"BLD",1606,"KRN","B",870,870)

"BLD",1606,"KRN","B",8989.51,8989.51)

"BLD",1606,"KRN","B",8989.52,8989.52)

"BLD",1606,"KRN","B",8994,8994)

"BLD",1606,"QUES",0)
^9.62^^
"BLD",1606,"REQB",0)
^9.611^1^1
"BLD",1606,"REQB",1,0)
DG*5.3*477^2
"BLD",1606,"REQB","B","DG*5.3*477",1)

"INI")
DG479PRE
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
479^3031105
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3031105
"PKG",5,22,1,"PAH",1,1,1,0)
NEW MESSAGE STRUCTURE - PHASE 3
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*479 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","DG479PRE")
0^1^B11367954
"RTN","DG479PRE",1,0)
DG479PRE ;BIR/PTD-PATCH DG*5.3*479 PRE INSTALLATION ROUTINE ;08/27/02
"RTN","DG479PRE",2,0)
 ;;5.3;Registration;**479**;Aug 13, 1993
"RTN","DG479PRE",3,0)
 ;
"RTN","DG479PRE",4,0)
 ;Reference to ^ORD(101 supported by IA #872
"RTN","DG479PRE",5,0)
 ;IA #3082 documentation amended to reflect protocol removal
"RTN","DG479PRE",6,0)
 ;
"RTN","DG479PRE",7,0)
 ;Remove child protocol off of parent protocol from ITEM (#10)
"RTN","DG479PRE",8,0)
 ;subfile and SUBSCRIBERS(#775) subfile in the PROTOCOL (#101) file.
"RTN","DG479PRE",9,0)
 ;
"RTN","DG479PRE",10,0)
 ;From Parent Protocol                 Remove Child Protocol
"RTN","DG479PRE",11,0)
 ;--------------------                 ---------------------
"RTN","DG479PRE",12,0)
 ;VAFC ADT-A04 SERVER                  VAFC TFL-UPDATE CLIENT
"RTN","DG479PRE",13,0)
 ;                                     RG PT SUBSCRIPTION RECEIVER
"RTN","DG479PRE",14,0)
 ; 
"RTN","DG479PRE",15,0)
 ;VAFC ADT-A08 SERVER                  VAFC TFL-UPDATE CLIENT
"RTN","DG479PRE",16,0)
 ;                                     RG PT SUBSCRIPTION RECEIVER
"RTN","DG479PRE",17,0)
EN ;
"RTN","DG479PRE",18,0)
 S ERRFLG=0 K DGMSG N DGCIEN,DGCNAM,DGIIEN,DGSIEN,DGPIEN,DGPNAM
"RTN","DG479PRE",19,0)
 S DGPNAM="VAFC ADT-A04 SERVER" D
"RTN","DG479PRE",20,0)
 .D PARENT I DGPIEN>0 D
"RTN","DG479PRE",21,0)
 ..S DGCNAM="VAFC TFL-UPDATE CLIENT" D
"RTN","DG479PRE",22,0)
 ...D CHILD I DGCIEN>0 D ITEM,SBSCR
"RTN","DG479PRE",23,0)
 ..S DGCNAM="RG PT SUBSCRIPTION RECEIVER" D
"RTN","DG479PRE",24,0)
 ...D CHILD I DGCIEN>0 D ITEM,SBSCR
"RTN","DG479PRE",25,0)
 K DGMSG N DGCIEN,DGCNAM,DGIIEN,DGSIEN,DGPIEN,DGPNAM
"RTN","DG479PRE",26,0)
 S DGPNAM="VAFC ADT-A08 SERVER" D
"RTN","DG479PRE",27,0)
 .D PARENT I DGPIEN>0 D
"RTN","DG479PRE",28,0)
 ..S DGCNAM="VAFC TFL-UPDATE CLIENT" D
"RTN","DG479PRE",29,0)
 ...D CHILD I DGCIEN>0 D ITEM,SBSCR
"RTN","DG479PRE",30,0)
 ..S DGCNAM="RG PT SUBSCRIPTION RECEIVER" D
"RTN","DG479PRE",31,0)
 ...D CHILD I DGCIEN>0 D ITEM,SBSCR
"RTN","DG479PRE",32,0)
 I ERRFLG=0 D BMES^XPDUTL(" Pre-install routine completed successfully.")
"RTN","DG479PRE",33,0)
 K DA,DGARRAY,DGCIEN,DGCNAM,DGCTR,DGIIEN,DGSIEN,DGMSG,DGPIEN,DGPNAM,DIK,ERRFLG,X
"RTN","DG479PRE",34,0)
 Q
"RTN","DG479PRE",35,0)
 ;
"RTN","DG479PRE",36,0)
PARENT ;Get IEN for parent protocol
"RTN","DG479PRE",37,0)
 S DGPIEN=+$$FIND1^DIC(101,"","QX",DGPNAM)
"RTN","DG479PRE",38,0)
 I DGPIEN=0 D ERRMSG(DGPNAM) S ERRFLG=1 ;No protocol exists, send message.
"RTN","DG479PRE",39,0)
 ;Else DGPIEN exists, it is IEN of parent protocol
"RTN","DG479PRE",40,0)
 Q
"RTN","DG479PRE",41,0)
 ;
"RTN","DG479PRE",42,0)
CHILD ;Get IEN for child protocol
"RTN","DG479PRE",43,0)
 S DGCIEN=+$$FIND1^DIC(101,"","QX",DGCNAM)
"RTN","DG479PRE",44,0)
 I DGCIEN=0 D ERRMSG(DGCNAM) S ERRFLG=1 ;No protocol exists, send message.
"RTN","DG479PRE",45,0)
 ;Else DGCIEN exists, it is IEN of child protocol
"RTN","DG479PRE",46,0)
 Q
"RTN","DG479PRE",47,0)
 ;
"RTN","DG479PRE",48,0)
ITEM ;Is this child protocol in the ITEM (#10) multiple?
"RTN","DG479PRE",49,0)
 ;If so, delete it.
"RTN","DG479PRE",50,0)
 K DGARRAY,DGCTR,DGIIEN
"RTN","DG479PRE",51,0)
 D FIND^DIC(101.01,","_DGPIEN_",",,"X",DGCNAM,,"B",,,"DGARRAY")
"RTN","DG479PRE",52,0)
 I $P(DGARRAY("DILIST",0),"^")>0 D
"RTN","DG479PRE",53,0)
 .S DGCTR=0 F  S DGCTR=$O(DGARRAY("DILIST",2,DGCTR)) Q:'DGCTR  S DGIIEN=$P(DGARRAY("DILIST",2,DGCTR),"^") D
"RTN","DG479PRE",54,0)
 ..I DGIIEN>0 D  ;IEN is there.
"RTN","DG479PRE",55,0)
 ..;Delete the child protocol from the ITEM (#10) multiple
"RTN","DG479PRE",56,0)
 ..S DA(1)=DGPIEN,DA=DGIIEN,DIK="^ORD(101,"_DA(1)_",10,"
"RTN","DG479PRE",57,0)
 ..D ^DIK K DIK,DA
"RTN","DG479PRE",58,0)
 ..D BMES^XPDUTL(" "_DGCNAM_" removed from ITEM (#10)")
"RTN","DG479PRE",59,0)
 ..D MES^XPDUTL(" multiple for "_DGPNAM_".")
"RTN","DG479PRE",60,0)
 Q
"RTN","DG479PRE",61,0)
 ;
"RTN","DG479PRE",62,0)
SBSCR ;Is this child protocol in the SUBSCRIBERS (#775) multiple?
"RTN","DG479PRE",63,0)
 ;If so, delete it.
"RTN","DG479PRE",64,0)
 K DGARRAY,DGCTR,DGSIEN
"RTN","DG479PRE",65,0)
 D FIND^DIC(101.0775,","_DGPIEN_",",,"X",DGCNAM,,"B",,,"DGARRAY")
"RTN","DG479PRE",66,0)
 I $P(DGARRAY("DILIST",0),"^")>0 D
"RTN","DG479PRE",67,0)
 .S DGCTR=0 F  S DGCTR=$O(DGARRAY("DILIST",2,DGCTR)) Q:'DGCTR  S DGSIEN=$P(DGARRAY("DILIST",2,DGCTR),"^") D
"RTN","DG479PRE",68,0)
 ..I DGSIEN>0 D  ;IEN is there.
"RTN","DG479PRE",69,0)
 ..;Delete the child protocol from the SUBSCRIBERS (#775) multiple
"RTN","DG479PRE",70,0)
 ..S DA(1)=DGPIEN,DA=DGSIEN,DIK="^ORD(101,"_DA(1)_",775,"
"RTN","DG479PRE",71,0)
 ..D ^DIK K DIK,DA
"RTN","DG479PRE",72,0)
 ..D BMES^XPDUTL(" "_DGCNAM_" removed from SUBSCRIBERS (#775)")
"RTN","DG479PRE",73,0)
 ..D MES^XPDUTL(" multiple for "_DGPNAM_".")
"RTN","DG479PRE",74,0)
 Q
"RTN","DG479PRE",75,0)
 ;
"RTN","DG479PRE",76,0)
ERRMSG(X) ;Display an error message about missing protocols.
"RTN","DG479PRE",77,0)
 ;Input - name of the missing protocol
"RTN","DG479PRE",78,0)
 K DGMSG S DGMSG(1)=" ",DGMSG(2)=X_" protocol is missing"
"RTN","DG479PRE",79,0)
 S DGMSG(3)="from the host system.  Contact your "_$S($E(X,1,2)="RG":"MPI/PD",1:"PIMS")_" ADPAC."
"RTN","DG479PRE",80,0)
 D MES^XPDUTL(.DGMSG)
"RTN","DG479PRE",81,0)
 Q
"RTN","DG479PRE",82,0)
 ;
"RTN","VAFCEHU3")
0^2^B18624665
"RTN","VAFCEHU3",1,0)
VAFCEHU3 ;BIR/LTL,PTD-File utilities for 391.98 ;10/23/02
"RTN","VAFCEHU3",2,0)
 ;;5.3;Registration;**149,295,384,474,477,479**;Aug 13, 1993
"RTN","VAFCEHU3",3,0)
 ;
"RTN","VAFCEHU3",4,0)
 ;Check for select fields that if edited can update without review
"RTN","VAFCEHU3",5,0)
EN ;
"RTN","VAFCEHU3",6,0)
 N VAFC,VAFCE,VAFCF S VAFCF=1
"RTN","VAFCEHU3",7,0)
 ;Save the array so a new one can be built for edit
"RTN","VAFCEHU3",8,0)
 M VAFC=@VAFCB K @VAFCB
"RTN","VAFCEHU3",9,0)
 F  S VAFCE=$P(VAFC(2,"FLD"),";",VAFCF) Q:'VAFCE  S VAFCF=VAFCF+1 D
"RTN","VAFCEHU3",10,0)
 .Q:(VAFCE>.01&(VAFCE<.111))!(VAFCE>.219)
"RTN","VAFCEHU3",11,0)
 .S @VAFCB@(2,VAFCE)=VAFC(2,VAFCE)
"RTN","VAFCEHU3",12,0)
 ;save the sending site's station number
"RTN","VAFCEHU3",13,0)
 I $D(VAFC(2,"SENDING SITE")) S @VAFCB@(2,"SENDING SITE")=VAFC(2,"SENDING SITE")
"RTN","VAFCEHU3",14,0)
ED ;D:$D(VAFCB) EDIT^VAFCPTED(PAT,VAFCB_"(2)",".01") ;**295 auto-updated fields - removed .111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219 ;**474 stop all auto-updates
"RTN","VAFCEHU3",15,0)
 ;restore the array for possible exceptions
"RTN","VAFCEHU3",16,0)
 M @VAFCB=VAFC
"RTN","VAFCEHU3",17,0)
CH ;Any differences?
"RTN","VAFCEHU3",18,0)
 N DFN,DGNAME ;**295,**384
"RTN","VAFCEHU3",19,0)
 S DFN=PAT,VAFCQ=0,VAFCF=@VAFCB@(2,"FLD") D DEM^VADPT
"RTN","VAFCEHU3",20,0)
 ;reformat problem data
"RTN","VAFCEHU3",21,0)
 I @VAFCB@(2,.05)="N" S @VAFCB@(2,.05)="NEVER MARRIED" ;**477
"RTN","VAFCEHU3",22,0)
 ;If not null and different or null and edited and different,
"RTN","VAFCEHU3",23,0)
 ;we got an exception, we're out of here
"RTN","VAFCEHU3",24,0)
 ;NAME - .01 - VADM(1)
"RTN","VAFCEHU3",25,0)
 I '$$COMP^VAFCUTL(VADM(1),@VAFCB@(2,.01)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",26,0)
 ;SEX - .02 - VADM(5)
"RTN","VAFCEHU3",27,0)
 I (@VAFCB@(2,.02)'[U)&(($P(VADM(5),U,2)'=@VAFCB@(2,.02))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",28,0)
 ;DOB - .03 - VADM(3)
"RTN","VAFCEHU3",29,0)
 I (@VAFCB@(2,.03)'=$P(VADM(3),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",30,0)
 ;MARITAL STATUS - .05 - VADM(10)
"RTN","VAFCEHU3",31,0)
 I (@VAFCB@(2,.05)'="""@"""),($P(VADM(10),U,2)'=@VAFCB@(2,.05)),(@VAFCB@(2,.05)'[U) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",32,0)
 ;RELIGION - .08 - VADM(9)
"RTN","VAFCEHU3",33,0)
 I (@VAFCB@(2,.08)'[U),($P(VADM(9),U,2)'=@VAFCB@(2,.08)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",34,0)
 ;SSN - .09 - VADM(2)
"RTN","VAFCEHU3",35,0)
 I (@VAFCB@(2,.09)'=$P(VADM(2),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",36,0)
 ;get some address stuff
"RTN","VAFCEHU3",37,0)
 D ADD^VADPT
"RTN","VAFCEHU3",38,0)
 ;STREET ADDRESS [1] - .111 - VAPA(1)
"RTN","VAFCEHU3",39,0)
 ;I (@VAFCB@(2,.111)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.111),VAPA(1)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",40,0)
 ;STREET ADDRESS [2] - .112 - VAPA(2)
"RTN","VAFCEHU3",41,0)
 ;I (@VAFCB@(2,.112)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.112),VAPA(2)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",42,0)
 ;STREET ADDRESS [3] - .113 - VAPA(3)
"RTN","VAFCEHU3",43,0)
 ;I (@VAFCB@(2,.113)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.113),VAPA(3)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",44,0)
 ;CITY - .114 - VAPA(4)
"RTN","VAFCEHU3",45,0)
 ;I (@VAFCB@(2,.114)'="""@"""),'$$COMP^VAFCUTL(VAPA(4),@VAFCB@(2,.114)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",46,0)
 ;STATE - .115 - VAPA(5)
"RTN","VAFCEHU3",47,0)
 ;I (@VAFCB@(2,.115)'="""@"""),($P(VAPA(5),U,2)'=@VAFCB@(2,.115)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",48,0)
 ;ZIP+4 - .1112 - VAPA(11)
"RTN","VAFCEHU3",49,0)
 ;I (@VAFCB@(2,.1112)'="""@"""),(@VAFCB@(2,.1112)'=$P(VAPA(11),U,2)) S VAFCQ=1 G CHQ ;**477 added u,2) ;**479
"RTN","VAFCEHU3",50,0)
 ;COUNTY CODE - .117 - VAPA(7)
"RTN","VAFCEHU3",51,0)
 ;I @VAFCB@(2,.117),(@VAFCB@(2,.117)'=$P(VAPA(7),U)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",52,0)
 ;PHONE HOME - .131 - VAPA(8)
"RTN","VAFCEHU3",53,0)
 I (@VAFCB@(2,.131)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(8)),$$HLPHONE^HLFNC(@VAFCB@(2,.131))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",54,0)
 ;Get the rest
"RTN","VAFCEHU3",55,0)
 D GETS^DIQ(2,DFN_",",".132;.211;.219;.2403;.301;.302;.31115;.323;.361;391;1901","","VAPA")
"RTN","VAFCEHU3",56,0)
 ;PHONE WORK - .132 - VAPA(2,DFN,.132)
"RTN","VAFCEHU3",57,0)
 I (@VAFCB@(2,.132)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.132)),$$HLPHONE^HLFNC(@VAFCB@(2,.132))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",58,0)
 ;K-NAME - .211 - VAPA(2,DFN,.211)
"RTN","VAFCEHU3",59,0)
 I $S(VAPA(2,DFN_",",.211)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^DPTNAME(.DGNAME,3,35),VAPA(2,DFN_",",.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",60,0)
 I $S(@VAFCB@(2,.211)="":0,@VAFCB@(2,.211)["@":0,1:1) S DGNAME=@VAFCB@(2,.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^DPTNAME(.DGNAME,3,35),@VAFCB@(2,.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",61,0)
 I (@VAFCB@(2,.211)'="""@"""),'$$COMP^VAFCUTL(VAPA(2,DFN_",",.211),@VAFCB@(2,.211)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",62,0)
 ;K-PHONE - .219 - VAPA(2,DFN,.219)
"RTN","VAFCEHU3",63,0)
 I (@VAFCB@(2,.219)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.219)),$$HLPHONE^HLFNC(@VAFCB@(2,.219))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",64,0)
 ;MOTHER'S MAIDEN NAME - .2403 - VAPA(2,DFN,.2403)
"RTN","VAFCEHU3",65,0)
 I $S(VAPA(2,DFN_",",.2403)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^DPTNAME(.DGNAME,3,35,,2,,1),VAPA(2,DFN_",",.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",66,0)
 I $S(@VAFCB@(2,.2403)="":0,@VAFCB@(2,.2403)["@":0,1:1) S DGNAME=@VAFCB@(2,.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^DPTNAME(.DGNAME,3,35,,2,,1),@VAFCB@(2,.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",67,0)
 I ((@VAFCB@(2,.2403)'="""@""")&('$$COMP^VAFCUTL(VAPA(2,DFN_",",.2403),@VAFCB@(2,.2403))))!((@VAFCB@(2,.2403)="""@""")&((VAFCF[".2403;"))&((VAPA(2,DFN_",",.2403)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",68,0)
 ;SERVICE CONNECTED - .301 - VAPA(2,DFN,.301)
"RTN","VAFCEHU3",69,0)
 ;I ((@VAFCB@(2,.301)'="""@""")&((VAPA(2,DFN_",",.301)'=@VAFCB@(2,.301))))!((@VAFCB@(2,.301)="""@""")&((VAFCF[".301;"))&((VAPA(2,DFN_",",.301)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",70,0)
 ;SC% - .302 - VAPA(2,DFN,.302)
"RTN","VAFCEHU3",71,0)
 ;I (@VAFCB@(2,.302)&((VAPA(2,DFN_",",.302)'=@VAFCB@(2,.302))))!((@VAFCB@(2,.302)="""@""")&((VAFCF[".302;"))&((VAPA(2,DFN_",",.302)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",72,0)
 ;EMPLOYMENT STATUS - .31115 - VAPA(2,DFN,.31115)
"RTN","VAFCEHU3",73,0)
 I ((@VAFCB@(2,.31115)'="""@""")&((VAPA(2,DFN_",",.31115)'=@VAFCB@(2,.31115))))!((@VAFCB@(2,.31115)="""@""")&((VAFCF[".31115;"))&((VAPA(2,DFN_",",.31115)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",74,0)
 ;PERIOD OF SERVICE - .323 - VAPA(2,DFN,.323)
"RTN","VAFCEHU3",75,0)
 ;I ((@VAFCB@(2,.323)'="""@""")&((VAPA(2,DFN_",",.323)'=@VAFCB@(2,.323))))!((@VAFCB@(2,.323)="""@""")&((VAFCF[".323;"))&((VAPA(2,DFN_",",.323)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",76,0)
 ;DATE OF DEATH - .351 - VAPA(2,DFN,.351)
"RTN","VAFCEHU3",77,0)
 S VAPA(2,DFN_",",.351)=$$GET1^DIQ(2,DFN_",",.351,"I")
"RTN","VAFCEHU3",78,0)
 I ((@VAFCB@(2,.351)'="""@""")&((@VAFCB@(2,.351)'=VAPA(2,DFN_",",.351))))!((@VAFCB@(2,.351)="""@""")&((VAFCF[".351"))&(VAPA(2,DFN_",",.351))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",79,0)
 ;PRIMARY ELIG CODE - .361 - VAPA(2,DFN,.361)
"RTN","VAFCEHU3",80,0)
 ;I (@VAFCB@(2,.361)]"")&(@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361))!((@VAFCB@(2,.361)="")&((VAFCF[".361;"))&((@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361)))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",81,0)
 ;PATIENT TYPE - 391 - VAPA(2,DFN,391)
"RTN","VAFCEHU3",82,0)
 ;I ((@VAFCB@(2,391)'="""@""")&(@VAFCB@(2,391)'=VAPA(2,DFN_",",391)))!((@VAFCB@(2,391)="""@""")&((VAFCF["391;"))&((VAPA(2,DFN_",",391)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",83,0)
 ;VETERAN (Y/N) - 1901 - VAPA(2,DFN,1901)
"RTN","VAFCEHU3",84,0)
 ;I ((@VAFCB@(2,1901)'="""@""")&(@VAFCB@(2,1901)'=VAPA(2,DFN_",",1901)))!((@VAFCB@(2,1901)="""@""")&((VAFCF["1901;"))&((VAPA(2,DFN_",",1901)]""))) S VAFCQ=1
"RTN","VAFCEHU3",85,0)
CHQ D:'$G(VAFCQ) EN^VAFCEHU4
"RTN","VAFCEHU3",86,0)
 D KVA^VADPT Q
"RTN","VAFCEHU4")
0^3^B4700129
"RTN","VAFCEHU4",1,0)
VAFCEHU4 ;BIR/LTL,PTD-File utilities for 391.98 ;08/26/97
"RTN","VAFCEHU4",2,0)
 ;;5.3;Registration;**149,307,479**;Aug 13, 1993
"RTN","VAFCEHU4",3,0)
 ;
"RTN","VAFCEHU4",4,0)
 ;Check for null incoming data elements to fire outgoing update
"RTN","VAFCEHU4",5,0)
EN ;SEX - .02 - VADM(5)
"RTN","VAFCEHU4",6,0)
 I (@VAFCB@(2,.02)[U),($P(VADM(5),U,2)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",7,0)
 ;MARITAL STATUS - .05 - VADM(10)
"RTN","VAFCEHU4",8,0)
 I (@VAFCB@(2,.05)="""@"""),($P(VADM(10),U,2)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",9,0)
 ;STREET ADDRESS [1] - .111 - VAPA(1)
"RTN","VAFCEHU4",10,0)
 ;I (@VAFCB@(2,.111)="""@"""),(VAPA(1)]""),(VAFCF'[".111;") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",11,0)
 ;STREET ADDRESS [2] - .112 - VAPA(2)
"RTN","VAFCEHU4",12,0)
 ;I (@VAFCB@(2,.112)="""@"""),(VAFCF'[".112;"),(VAPA(2)]"") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",13,0)
 ;STREET ADDRESS [3] - .113 - VAPA(3)
"RTN","VAFCEHU4",14,0)
 ;I (@VAFCB@(2,.113)="""@"""),(VAFCF'[".113;"),(VAPA(3)]"") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",15,0)
 ;CITY - .114 - VAPA(4)
"RTN","VAFCEHU4",16,0)
 ;I (@VAFCB@(2,.114)="""@"""),(VAFCF'[".114;"),(VAPA(4)]"") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",17,0)
 ;STATE - .115 - VAPA(5)
"RTN","VAFCEHU4",18,0)
 ;I (@VAFCB@(2,.115)="""@"""),(VAFCF'[".115;"),($P(VAPA(5),U,2)]"") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",19,0)
 ;ZIP+4 - .1112 - VAPA(11)
"RTN","VAFCEHU4",20,0)
 ;I (@VAFCB@(2,.1112)="""@"""),(VAFCF'[".1112;"),($P(VAPA(11),U)]"") S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",21,0)
 ;COUNTY CODE - .117 - VAPA(7)
"RTN","VAFCEHU4",22,0)
 ;I '@VAFCB@(2,.117)!(@VAFCB@(2,.117)="""@"""),(VAFCF'[".117;"),$P(VAPA(7),U) S VAFCQ(1)=1 G CHQ ;**479
"RTN","VAFCEHU4",23,0)
 ;PHONE HOME - .131 - VAPA(8)
"RTN","VAFCEHU4",24,0)
 I (@VAFCB@(2,.131)="""@"""),(VAFCF'[".131;"),(VAPA(8)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",25,0)
 ;PHONE WORK - .132 - VAPA(2,DFN,.132)
"RTN","VAFCEHU4",26,0)
 I (@VAFCB@(2,.132)="""@"""),(VAFCF'[".132;"),(VAPA(2,DFN_",",.132)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",27,0)
 ;K-NAME - .211 - VAPA(2,DFN,.211)
"RTN","VAFCEHU4",28,0)
 I (@VAFCB@(2,.211)="""@"""),(VAFCF'[".211;"),(VAPA(2,DFN_",",.211)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",29,0)
 ;K-PHONE - .219 - VAPA(2,DFN,.219)
"RTN","VAFCEHU4",30,0)
 I (@VAFCB@(2,.219)="""@"""),(VAFCF'[".219;"),(VAPA(2,DFN_",",.219)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",31,0)
 ;MOTHER'S MAIDEN NAME - .2403 - VAPA(2,DFN,.2403)
"RTN","VAFCEHU4",32,0)
 I (@VAFCB@(2,.2403)="""@"""),(VAPA(2,DFN_",",.2403)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",33,0)
 ;SERVICE CONNECTED - .301 - VAPA(2,DFN,.301)
"RTN","VAFCEHU4",34,0)
 ;I (@VAFCB@(2,.301)="""@"""),(VAPA(2,DFN_",",.301)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",35,0)
 ;SC% - .302 - VAPA(2,DFN,.302)
"RTN","VAFCEHU4",36,0)
 ;I '@VAFCB@(2,.302),VAPA(2,DFN_",",.302) S VAFCQ=1 G CHQ
"RTN","VAFCEHU4",37,0)
 ;EMPLOYMENT STATUS - .31115 - VAPA(2,DFN,.31115)
"RTN","VAFCEHU4",38,0)
 I (@VAFCB@(2,.31115)="""@"""),(VAPA(2,DFN_",",.31115)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",39,0)
 ;PERIOD OF SERVICE - .323 - VAPA(2,DFN,.323)
"RTN","VAFCEHU4",40,0)
 ;I (@VAFCB@(2,.323)="""@"""),(VAPA(2,DFN_",",.323)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",41,0)
 ;DATE OF DEATH - .351 - VAPA(2,DFN,.351)
"RTN","VAFCEHU4",42,0)
 I (@VAFCB@(2,.351)="""@"""),VAPA(2,DFN_",",.351) S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",43,0)
 ;PRIMARY ELIG CODE - .361 - VAPA(2,DFN,.361)
"RTN","VAFCEHU4",44,0)
 ;I (@VAFCB@(2,.361)]"")&(@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361))!((@VAFCB@(2,.361)="")&((VAFCF[".361;"))&((@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361)))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU4",45,0)
 ;PATIENT TYPE - 391 - VAPA(2,DFN,391)
"RTN","VAFCEHU4",46,0)
 ;I (@VAFCB@(2,391)="""@"""),(VAPA(2,DFN_",",391)]"") S VAFCQ(1)=1 G CHQ
"RTN","VAFCEHU4",47,0)
 ;VETERAN (Y/N) - 1901 - VAPA(2,DFN,1901)
"RTN","VAFCEHU4",48,0)
 ;I (@VAFCB@(2,1901)="""@"""),VAPA(2,DFN_",",1901) S VAFCQ(1)=1
"RTN","VAFCEHU4",49,0)
CHQ I $G(VAFCQ(1)) D AVAFC^VAFCDD01(DFN)
"RTN","VAFCEHU4",50,0)
 Q
"RTN","VAFCEHU4",51,0)
 ;
"RTN","VAFCEHU4",52,0)
WHO(X) ; determine the identity of the sending facility, resolve it into
"RTN","VAFCEHU4",53,0)
 ; the institution name.  Prior to the release of RG*1*8, the sending
"RTN","VAFCEHU4",54,0)
 ; facility was passed as the name of the institution.  After the
"RTN","VAFCEHU4",55,0)
 ; release of RG*1*8, the sending facility is passed in either
"RTN","VAFCEHU4",56,0)
 ; format: station # -or- station #~domain.  The station # needs
"RTN","VAFCEHU4",57,0)
 ; to be resolved into the name of the institution.
"RTN","VAFCEHU4",58,0)
 ; called from: ADD^VAFCEHU1 & CHK^VAFCEHU1
"RTN","VAFCEHU4",59,0)
 ; INPUT X-string: sending facility (see desc for possible formats) 
"RTN","VAFCEHU4",60,0)
 Q:X="" "" N WHO
"RTN","VAFCEHU4",61,0)
 I $$PATCH^XPDUTL("RG*1.0*8") D  ; passed as station# or station#~domain
"RTN","VAFCEHU4",62,0)
 .S WHO=+X ; obtain station #
"RTN","VAFCEHU4",63,0)
 .S WHO=$$LKUP^XUAF4(WHO) ; from station # to ien
"RTN","VAFCEHU4",64,0)
 .S WHO=$$GET1^DIQ(4,+WHO_",",.01) ; from ien to name
"RTN","VAFCEHU4",65,0)
 .Q
"RTN","VAFCEHU4",66,0)
 E  S WHO=X ; before RG*1.0*8, passed as institution name
"RTN","VAFCEHU4",67,0)
 Q $G(WHO)
"RTN","VAFCMGA")
0^13^B55715754
"RTN","VAFCMGA",1,0)
VAFCMGA ;ALB/JRP,LTL-DEMOGRAPHIC MERGE SCREEN ACTIONS ;31-OCT-96
"RTN","VAFCMGA",2,0)
 ;;5.3;Registration;**149,477,479**;Aug 13, 1993
"RTN","VAFCMGA",3,0)
 ;
"RTN","VAFCMGA",4,0)
 ;NOTE: The VAFCMGA* routines contain line tags used to implement
"RTN","VAFCMGA",5,0)
 ;      the actions of a List Manager user interface.  All line
"RTN","VAFCMGA",6,0)
 ;      tags assume that the following variables and arrays are
"RTN","VAFCMGA",7,0)
 ;      defined.
"RTN","VAFCMGA",8,0)
 ;
"RTN","VAFCMGA",9,0)
 ;Input  : VAFCDFN - Pointer to entry in PATIENT file (#2) to merge
"RTN","VAFCMGA",10,0)
 ;                   data into
"RTN","VAFCMGA",11,0)
 ;         VAFCARR - Array contain data to merge (full global reference)
"RTN","VAFCMGA",12,0)
 ;                   VAFCARR() should be set as follows:
"RTN","VAFCMGA",13,0)
 ;                     VAFCARR(File,Field) = Value
"RTN","VAFCMGA",14,0)
 ;                       Where File = File number Value is from
"RTN","VAFCMGA",15,0)
 ;                             Field = Field number Value is from
"RTN","VAFCMGA",16,0)
 ;                             Value = Info to merge
"RTN","VAFCMGA",17,0)
 ;                       Notes: Dates must be in FileMan format
"RTN","VAFCMGA",18,0)
 ;                            : Special considerations for Value
"RTN","VAFCMGA",19,0)
 ;                                "@"  - Displays <DELETE> and deletes
"RTN","VAFCMGA",20,0)
 ;                                       local value if merged
"RTN","VAFCMGA",21,0)
 ;                                "^text"  - Displays text and ignores
"RTN","VAFCMGA",22,0)
 ;                                           field if merged
"RTN","VAFCMGA",23,0)
 ;                                NULL  - Displays <UNSPECIFIED> and
"RTN","VAFCMGA",24,0)
 ;                                        ignores field if merged
"RTN","VAFCMGA",25,0)
 ;                                Doesn't exist  - Displays <UNSPECIFIED>
"RTN","VAFCMGA",26,0)
 ;                                                 and ignores field
"RTN","VAFCMGA",27,0)
 ;                                                 if merged
"RTN","VAFCMGA",28,0)
 ;         VAFCFROM - Text denoting where merge data cam from (1-35)
"RTN","VAFCMGA",29,0)
 ;         VAFCEVDT - Date/time merge data was instantiated (FileMan)
"RTN","VAFCMGA",30,0)
 ;         All variables set by List Manager Interface
"RTN","VAFCMGA",31,0)
 ;         Display area and variables required List Manager interface
"RTN","VAFCMGA",32,0)
 ;         Display
"RTN","VAFCMGA",33,0)
 ;           VALMAR(Line,0) = Line of text in display
"RTN","VAFCMGA",34,0)
 ;         Indexes
"RTN","VAFCMGA",35,0)
 ;           VALMAR("IDX",Line,Entry) = ""
"RTN","VAFCMGA",36,0)
 ;           VALMAR("E2F",Entry,N) = File^Field
"RTN","VAFCMGA",37,0)
 ;             N => Allows for multiple fields per entry (starts with 1)
"RTN","VAFCMGA",38,0)
 ;           VALMAR("E2G",Entry) = Group entry is contained in
"RTN","VAFCMGA",39,0)
 ;           VALMAR("GRP",Group) = First line of group in display
"RTN","VAFCMGA",40,0)
 ;             Note: The E2F and E2G indexes are only set if the data
"RTN","VAFCMGA",41,0)
 ;                   to merge does not match the local data
"RTN","VAFCMGA",42,0)
 ;
"RTN","VAFCMGA",43,0)
MRGALL ;Merge all differences
"RTN","VAFCMGA",44,0)
 ;
"RTN","VAFCMGA",45,0)
 ;Input  : See above note on input variables
"RTN","VAFCMGA",46,0)
 ;Output : VALMAR() array will be rebuilt accordingly
"RTN","VAFCMGA",47,0)
 ;
"RTN","VAFCMGA",48,0)
 ;Declare variables
"RTN","VAFCMGA",49,0)
 N VAFCDOTS,ENTRY,REBUILD,FILE,FIELD,VALUE,REPEAT
"RTN","VAFCMGA",50,0)
 N TMP,IENS,FDAROOT,MSGROOT,QUOTE
"RTN","VAFCMGA",51,0)
 S FDAROOT="^TMP(""VAFC-MERGE-UPLOAD"","_$J_",""FDA"")"
"RTN","VAFCMGA",52,0)
 S MSGROOT="^TMP(""VAFC-MERGE-UPLOAD"","_$J_",""MSG"")"
"RTN","VAFCMGA",53,0)
 S QUOTE=$C(34)
"RTN","VAFCMGA",54,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGA",55,0)
 K @FDAROOT,@MSGROOT
"RTN","VAFCMGA",56,0)
 ;Build array of differences to merge
"RTN","VAFCMGA",57,0)
 N DGNOFDEL S DGNOFDEL=1 ;**477 stop NOK Name x-ref from firing.
"RTN","VAFCMGA",58,0)
 NEW EASZIPLK S EASZIPLK=1 ;**477 zipcode lookup for GMT
"RTN","VAFCMGA",59,0)
 S ENTRY=""
"RTN","VAFCMGA",60,0)
 F  S ENTRY=$O(@VALMAR@("E2F",ENTRY)) Q:(ENTRY="")  D
"RTN","VAFCMGA",61,0)
 .;Remember which group(s) to rebuild
"RTN","VAFCMGA",62,0)
 .S TMP=$G(@VALMAR@("E2G",ENTRY))
"RTN","VAFCMGA",63,0)
 .S:(TMP'="") REBUILD(TMP)=""
"RTN","VAFCMGA",64,0)
 .;Loop through list of fields contained in the entry
"RTN","VAFCMGA",65,0)
 .S REPEAT=""
"RTN","VAFCMGA",66,0)
 .F  S REPEAT=$O(@VALMAR@("E2F",ENTRY,REPEAT)) Q:(REPEAT="")  D
"RTN","VAFCMGA",67,0)
 ..S TMP=$G(@VALMAR@("E2F",ENTRY,REPEAT))
"RTN","VAFCMGA",68,0)
 ..S FILE=+$P(TMP,"^",1)
"RTN","VAFCMGA",69,0)
 ..S FIELD=+$P(TMP,"^",2)
"RTN","VAFCMGA",70,0)
 ..;Get remote value
"RTN","VAFCMGA",71,0)
 ..S VALUE=$G(@VAFCARR@(FILE,FIELD))
"RTN","VAFCMGA",72,0)
 ..;Screen for ignore conditions
"RTN","VAFCMGA",73,0)
 ..I $P(VALUE,U,3) S VALMSG=$S($G(VALMSG)]"":VALMSG_","_ENTRY,1:"Can't merge unresolved item(s) "_ENTRY) Q
"RTN","VAFCMGA",74,0)
 ..S VALUE=$P(VALUE,U)
"RTN","VAFCMGA",75,0)
 ..Q:(VALUE="")
"RTN","VAFCMGA",76,0)
 ..;Convert "@" to @
"RTN","VAFCMGA",77,0)
 ..S:(VALUE=(QUOTE_"@"_QUOTE)) VALUE="@"
"RTN","VAFCMGA",78,0)
 ..;Move data into upload array
"RTN","VAFCMGA",79,0)
 ..;I $S(ENTRY=6:0,ENTRY=7:0,ENTRY=9:0,1:1) S @FDAROOT@(FILE,IENS,FIELD)=VALUE ;let zipcode populate city, state and county for merge all ;**477 for GMT ;**479 address removed
"RTN","VAFCMGA",80,0)
 .. S @FDAROOT@(FILE,IENS,FIELD)=VALUE ;**479 address removed - allow merge
"RTN","VAFCMGA",81,0)
 ..;Prepare for undo
"RTN","VAFCMGA",82,0)
 ..S ^TMP("VAFC-UNDO",$J,"FDA",FILE,IENS,FIELD)=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","VAFCMGA",83,0)
 ;Merge differences
"RTN","VAFCMGA",84,0)
 I (+$O(@FDAROOT@(0))) D FILE^DIE("E",FDAROOT,MSGROOT)
"RTN","VAFCMGA",85,0)
 ;Rebuild required portion of display
"RTN","VAFCMGA",86,0)
 S VAFCDOTS=1
"RTN","VAFCMGA",87,0)
 S ENTRY=""
"RTN","VAFCMGA",88,0)
 F  S ENTRY=$O(REBUILD(ENTRY)) Q:(ENTRY="")  D RBLDGRP^VAFCMGB(ENTRY)
"RTN","VAFCMGA",89,0)
 ;No more differences
"RTN","VAFCMGA",90,0)
 S:('$D(@VALMAR@("E2F"))) VALMSG="** No differences found **"
"RTN","VAFCMGA",91,0)
 ;Done - refresh List Manager display
"RTN","VAFCMGA",92,0)
 S VALMBCK="R"
"RTN","VAFCMGA",93,0)
 Q
"RTN","VAFCMGA",94,0)
MRGSLCT ;Merge user selected differences
"RTN","VAFCMGA",95,0)
 ;
"RTN","VAFCMGA",96,0)
 ;Input  : See above note on input variables
"RTN","VAFCMGA",97,0)
 ;Output : Modified areas of VALMAR() array will be rebuilt accordingly
"RTN","VAFCMGA",98,0)
 ;
"RTN","VAFCMGA",99,0)
 ;Declare variables
"RTN","VAFCMGA",100,0)
 N VAFCDOTS,ENTRY,REBUILD,VALMY,FILE,FIELD,REPEAT
"RTN","VAFCMGA",101,0)
 N TMP,IENS,FDAROOT,MSGROOT,QUOTE,UNDO
"RTN","VAFCMGA",102,0)
 S QUOTE=$C(34)
"RTN","VAFCMGA",103,0)
 S FDAROOT="^TMP(""VAFC-MERGE-UPLOAD"","_$J_",""FDA"")"
"RTN","VAFCMGA",104,0)
 S MSGROOT="^TMP(""VAFC-MERGE-UPLOAD"","_$J_",""MSG"")"
"RTN","VAFCMGA",105,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGA",106,0)
 K @FDAROOT,@MSGROOT
"RTN","VAFCMGA",107,0)
 ;Prompt user for entries to merge
"RTN","VAFCMGA",108,0)
 D EN^VALM2($G(XQORNOD(0)),"O")
"RTN","VAFCMGA",109,0)
 ;Build array of data selected for merging
"RTN","VAFCMGA",110,0)
 N DGNOFDEL S DGNOFDEL=1 ;**477 stop NOK Name x-ref from firing.
"RTN","VAFCMGA",111,0)
 NEW EASZIPLK S EASZIPLK=1 ;**477 zipcode lookup for GMT
"RTN","VAFCMGA",112,0)
 ;I $D(VALMY(8)) F ENTRY=6,7,9 I '$D(VALMY(ENTRY)) S VALMY(ENTRY)="",UNDO(ENTRY)="" ;prepare to undo city, state and county if zip selected ;**477 for GMT ;**479 address removed
"RTN","VAFCMGA",113,0)
 S ENTRY=""
"RTN","VAFCMGA",114,0)
 F  S ENTRY=$O(VALMY(ENTRY)) Q:(ENTRY="")  D
"RTN","VAFCMGA",115,0)
 .;Remember which group(s) to rebuild
"RTN","VAFCMGA",116,0)
 .S TMP=$G(@VALMAR@("E2G",ENTRY))
"RTN","VAFCMGA",117,0)
 .S:(TMP'="") REBUILD(TMP)=""
"RTN","VAFCMGA",118,0)
 .;Loop through list of fields contained in the entry
"RTN","VAFCMGA",119,0)
 .S REPEAT=""
"RTN","VAFCMGA",120,0)
 .F  S REPEAT=$O(@VALMAR@("E2F",ENTRY,REPEAT)) Q:(REPEAT="")  D
"RTN","VAFCMGA",121,0)
 ..S TMP=$G(@VALMAR@("E2F",ENTRY,REPEAT))
"RTN","VAFCMGA",122,0)
 ..S FILE=+$P(TMP,"^",1)
"RTN","VAFCMGA",123,0)
 ..S FIELD=+$P(TMP,"^",2)
"RTN","VAFCMGA",124,0)
 ..;Get remote value
"RTN","VAFCMGA",125,0)
 ..S VALUE=$G(@VAFCARR@(FILE,FIELD))
"RTN","VAFCMGA",126,0)
 ..;Screen for ignore conditions
"RTN","VAFCMGA",127,0)
 ..I $P(VALUE,U,3) S VALMSG=$S($G(VALMSG)]"":VALMSG_","_ENTRY,1:"Can't merge unresolved item(s) "_ENTRY) Q
"RTN","VAFCMGA",128,0)
 ..S VALUE=$P(VALUE,U)
"RTN","VAFCMGA",129,0)
 ..Q:(VALUE="")
"RTN","VAFCMGA",130,0)
 ..;Convert "@" to @
"RTN","VAFCMGA",131,0)
 ..S:(VALUE=(QUOTE_"@"_QUOTE)) VALUE="@"
"RTN","VAFCMGA",132,0)
 ..;Move data into upload array
"RTN","VAFCMGA",133,0)
 ..I '$D(UNDO(ENTRY)) S @FDAROOT@(FILE,IENS,FIELD)=VALUE ;**477 for GMT
"RTN","VAFCMGA",134,0)
 ..;Prepare for undo
"RTN","VAFCMGA",135,0)
 ..S ^TMP("VAFC-UNDO",$J,"FDA",FILE,IENS,FIELD)=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","VAFCMGA",136,0)
 ;Merge selected data BUT don't transmit until merge completed or rejected
"RTN","VAFCMGA",137,0)
 I (+$O(@FDAROOT@(0))) S VAFCA08=1 D FILE^DIE("E",FDAROOT,MSGROOT) K VAFCA08
"RTN","VAFCMGA",138,0)
 ;Rebuild required portion of display
"RTN","VAFCMGA",139,0)
 S VAFCDOTS=1
"RTN","VAFCMGA",140,0)
 S ENTRY=""
"RTN","VAFCMGA",141,0)
 F  S ENTRY=$O(REBUILD(ENTRY)) Q:(ENTRY="")  D RBLDGRP^VAFCMGB(ENTRY)
"RTN","VAFCMGA",142,0)
 ;No more differences
"RTN","VAFCMGA",143,0)
 S:('$D(@VALMAR@("E2F"))) VALMSG="** No differences found **"
"RTN","VAFCMGA",144,0)
 ;Done - refresh List Manager display
"RTN","VAFCMGA",145,0)
 K @FDAROOT,@MSGROOT
"RTN","VAFCMGA",146,0)
 S VALMBCK="R"
"RTN","VAFCMGA",147,0)
 Q
"RTN","VAFCMGA",148,0)
 ;
"RTN","VAFCMGA",149,0)
COMPLETE ;Merge process completed ;**477 always prompt for merge, add verbage
"RTN","VAFCMGA",150,0)
 ;
"RTN","VAFCMGA",151,0)
 ;Input  : See above note on input variables
"RTN","VAFCMGA",152,0)
 ;Output : VAFCDONE will be set to '1'
"RTN","VAFCMGA",153,0)
 ;
"RTN","VAFCMGA",154,0)
 ;Declare variables
"RTN","VAFCMGA",155,0)
 N DIR,X,Y
"RTN","VAFCMGA",156,0)
 S VAFCDONE=1
"RTN","VAFCMGA",157,0)
 D FULL^VALM1 ;switch to full screen
"RTN","VAFCMGA",158,0)
 I ($D(@VALMAR@("E2F"))) D  ;check for differences
"RTN","VAFCMGA",159,0)
 .S DIR("A",7)="      ** Differences still exist between local and remote data **" ;check for differences
"RTN","VAFCMGA",160,0)
 .S DIR("A",8)=" "
"RTN","VAFCMGA",161,0)
 ;Make sure user is really done with merge process
"RTN","VAFCMGA",162,0)
 S DIR(0)="YA"
"RTN","VAFCMGA",163,0)
 S DIR("A",1)=" "
"RTN","VAFCMGA",164,0)
 S DIR("A",2)="NOTE: Since your site is the CMOR, you are considered to be the"
"RTN","VAFCMGA",165,0)
 S DIR("A",3)="      authoritative source.  By completing the merge, you confirm that"
"RTN","VAFCMGA",166,0)
 S DIR("A",4)="      your facility's NAME, SEX, DOB, SSN and MOTHER'S MAIDEN NAME are"
"RTN","VAFCMGA",167,0)
 S DIR("A",5)="      accurate for broadcast to all facilities sharing this patient."
"RTN","VAFCMGA",168,0)
 S DIR("A",6)=" "
"RTN","VAFCMGA",169,0)
 S DIR("A")="Are you ready to complete the merge process? (Yes/No) : "
"RTN","VAFCMGA",170,0)
 S DIR("B")="YES"
"RTN","VAFCMGA",171,0)
 D ^DIR
"RTN","VAFCMGA",172,0)
 S VAFCDONE=+Y
"RTN","VAFCMGA",173,0)
 ;User not done
"RTN","VAFCMGA",174,0)
 I ('VAFCDONE) S VALMBCK="R" Q
"RTN","VAFCMGA",175,0)
 ;  Create an entry in the ADT/HL7 PIVOT file (#391.71) and
"RTN","VAFCMGA",176,0)
 ;  mark it as requiring transmission of an HL7 ADT-A08 message
"RTN","VAFCMGA",177,0)
 D AVAFC^VAFCDD01(VAFCDFN)
"RTN","VAFCMGA",178,0)
 ;Done - quit List Manager interface
"RTN","VAFCMGA",179,0)
 S VALMBCK="Q"
"RTN","VAFCMGA",180,0)
 Q
"RTN","VAFCMGA",181,0)
 ;
"RTN","VAFCMGA",182,0)
REJECT ;Reject/ignore differences ;**477 add verbage
"RTN","VAFCMGA",183,0)
 ;
"RTN","VAFCMGA",184,0)
 ;Input  : See above note on input variables
"RTN","VAFCMGA",185,0)
 ;Output : VAFCRJCT will be set to '1'
"RTN","VAFCMGA",186,0)
 ;
"RTN","VAFCMGA",187,0)
 ;Declare variables
"RTN","VAFCMGA",188,0)
 N DIR,X,Y
"RTN","VAFCMGA",189,0)
 S VAFCRJCT=1
"RTN","VAFCMGA",190,0)
 ;Switch to full screen
"RTN","VAFCMGA",191,0)
 D FULL^VALM1
"RTN","VAFCMGA",192,0)
 ;Make sure user really wants to reject differences
"RTN","VAFCMGA",193,0)
 S DIR(0)="YA"
"RTN","VAFCMGA",194,0)
 S DIR("A",1)=" "
"RTN","VAFCMGA",195,0)
 S DIR("A",2)="NOTE: Since your site is the CMOR, you are considered to be the"
"RTN","VAFCMGA",196,0)
 S DIR("A",3)="      authoritative source.  By rejecting the remote data, you confirm"
"RTN","VAFCMGA",197,0)
 S DIR("A",4)="      that your facility's NAME, SEX, DOB, SSN and MOTHER'S MAIDEN NAME"
"RTN","VAFCMGA",198,0)
 S DIR("A",5)="      are accurate for broadcast to all facilities sharing this patient."
"RTN","VAFCMGA",199,0)
 S DIR("A",6)=" "
"RTN","VAFCMGA",200,0)
 S DIR("A")="Are you sure you want to reject the remote data? (Yes/No) : "
"RTN","VAFCMGA",201,0)
 S DIR("B")="YES"
"RTN","VAFCMGA",202,0)
 D ^DIR
"RTN","VAFCMGA",203,0)
 S VAFCRJCT=+Y
"RTN","VAFCMGA",204,0)
 ;Don't reject
"RTN","VAFCMGA",205,0)
 I ('VAFCRJCT) S VALMBCK="R" Q
"RTN","VAFCMGA",206,0)
 ;  Create an entry in the ADT/HL7 PIVOT file (#391.71) and
"RTN","VAFCMGA",207,0)
 ;  mark it as requiring transmission of an HL7 ADT-A08 message
"RTN","VAFCMGA",208,0)
 D AVAFC^VAFCDD01(VAFCDFN)
"RTN","VAFCMGA",209,0)
 ;Done - quit List Manager interface
"RTN","VAFCMGA",210,0)
 S VALMBCK="Q"
"RTN","VAFCMGA",211,0)
 Q
"RTN","VAFCMGA",212,0)
HI ;Hinq Inquiry
"RTN","VAFCMGA",213,0)
 S DFN=VAFCDFN
"RTN","VAFCMGA",214,0)
 D HINQ^DG10 S VALMBCK=""
"RTN","VAFCMGA",215,0)
 ;D EN^DVBHQZ4 S VALMBCK=""
"RTN","VAFCMGA",216,0)
 ;S VALMSG="Hinq request has "_$S($D(^DVB(395.5,DFN,0))&("PNEA"[$P($G(^DVB(395.5,DFN,0)),U,4)):"",1:"NOT ")_"been made for this patient."
"RTN","VAFCMGA",217,0)
HIQ Q
"RTN","VAFCMGA",218,0)
PA ;Patient Audit
"RTN","VAFCMGA",219,0)
 Q  ;**477 - no longer in use replaced by remote audit protcols
"RTN","VAFCMGA",220,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","VAFCMGA",221,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","VAFCMGA",222,0)
PAQ Q
"RTN","VAFCMGB")
0^4^B2679368
"RTN","VAFCMGB",1,0)
VAFCMGB ;ALB/JRP,PTD-DEMOGRAPHIC MERGE SCREEN BUILDER ;18-OCT-1996
"RTN","VAFCMGB",2,0)
 ;;5.3;Registration;**149,479**;Aug 13, 1993
"RTN","VAFCMGB",3,0)
 ;
"RTN","VAFCMGB",4,0)
 ;NOTE: The VAFCMGB* routines contain line tags used to build the
"RTN","VAFCMGB",5,0)
 ;      display screen of a List Manager interface.  All line tags
"RTN","VAFCMGB",6,0)
 ;      assume that the following variables are defined and contained
"RTN","VAFCMGB",7,0)
 ;      in the local partition.
"RTN","VAFCMGB",8,0)
 ;
"RTN","VAFCMGB",9,0)
 ;Input  : VAFCDFN - Pointer to entry in PATIENT file (#2) to merge
"RTN","VAFCMGB",10,0)
 ;                   data into
"RTN","VAFCMGB",11,0)
 ;         VAFCARR - Array contain data to merge (full global reference)
"RTN","VAFCMGB",12,0)
 ;                   VAFCARR() should be set as follows:
"RTN","VAFCMGB",13,0)
 ;                     VAFCARR(File,Field) = Value
"RTN","VAFCMGB",14,0)
 ;                       Where File = File number Value is from
"RTN","VAFCMGB",15,0)
 ;                             Field = Field number Value is from
"RTN","VAFCMGB",16,0)
 ;                             Value = Info to merge
"RTN","VAFCMGB",17,0)
 ;                       Notes: Dates must be in FileMan format
"RTN","VAFCMGB",18,0)
 ;                            : Special considerations for Value
"RTN","VAFCMGB",19,0)
 ;                                "@"  - Displays <DELETE> and deletes
"RTN","VAFCMGB",20,0)
 ;                                       local value if merged
"RTN","VAFCMGB",21,0)
 ;                                "^text"  - Displays text and ignores
"RTN","VAFCMGB",22,0)
 ;                                           field if merged
"RTN","VAFCMGB",23,0)
 ;                                NULL  - Displays <UNSPECIFIED> and
"RTN","VAFCMGB",24,0)
 ;                                        ignores field if merged
"RTN","VAFCMGB",25,0)
 ;                                Doesn't exist  - Displays <UNSPECIFIED>
"RTN","VAFCMGB",26,0)
 ;                                                 and ignores field
"RTN","VAFCMGB",27,0)
 ;                                                 if merged
"RTN","VAFCMGB",28,0)
 ;         VAFCFROM - Text denoting where merge data cam from (1-35)
"RTN","VAFCMGB",29,0)
 ;         VAFCEVDT - Date/time merge data was instantiated (FileMan)
"RTN","VAFCMGB",30,0)
 ;         VAFCDOTS - Flag indicating if progress dots should be printed
"RTN","VAFCMGB",31,0)
 ;                    0 = No
"RTN","VAFCMGB",32,0)
 ;                    1 = Yes
"RTN","VAFCMGB",33,0)
 ;         All variables set by List Manager Interface
"RTN","VAFCMGB",34,0)
 ;Output : Display area and variables required List Manager interface
"RTN","VAFCMGB",35,0)
 ;         Display
"RTN","VAFCMGB",36,0)
 ;           VALMAR(Line,0) = Line of text in display
"RTN","VAFCMGB",37,0)
 ;         Indexes
"RTN","VAFCMGB",38,0)
 ;           VALMAR("IDX",Line,Entry) = ""
"RTN","VAFCMGB",39,0)
 ;           VALMAR("E2F",Entry,N) = File^Field
"RTN","VAFCMGB",40,0)
 ;             N => Allows for multiple fields per entry (starts with 1)
"RTN","VAFCMGB",41,0)
 ;           VALMAR("E2G",Entry) = Group entry is contained in
"RTN","VAFCMGB",42,0)
 ;           VALMAR("GRP",Group) = First line of group in display
"RTN","VAFCMGB",43,0)
 ;             Note: The E2F and E2G indexes are only set if the data
"RTN","VAFCMGB",44,0)
 ;                   to merge does not match the local data
"RTN","VAFCMGB",45,0)
 ;Notes  : Existance/validity of input variables is assumed
"RTN","VAFCMGB",46,0)
 ;       : Dates are converted to internal format for comparison
"RTN","VAFCMGB",47,0)
 ;       : Phone # are converted to HL7 format for comparison & display
"RTN","VAFCMGB",48,0)
 ;
"RTN","VAFCMGB",49,0)
BLDALL ;Main entry point to build entire List Manager display
"RTN","VAFCMGB",50,0)
 ;
"RTN","VAFCMGB",51,0)
 ;Input  : See note above
"RTN","VAFCMGB",52,0)
 ;Output : See note above
"RTN","VAFCMGB",53,0)
 ;
"RTN","VAFCMGB",54,0)
 ;Declare variables
"RTN","VAFCMGB",55,0)
 N LASTNTRY
"RTN","VAFCMGB",56,0)
 ;Build logical group 1
"RTN","VAFCMGB",57,0)
 D GROUP1^VAFCMGB0
"RTN","VAFCMGB",58,0)
 ;White space
"RTN","VAFCMGB",59,0)
 S LASTNTRY=+$O(@VALMAR@("IDX",VALMCNT-1,0))
"RTN","VAFCMGB",60,0)
 S @VALMAR@(VALMCNT,0)=" "
"RTN","VAFCMGB",61,0)
 S @VALMAR@("IDX",VALMCNT,LASTNTRY)=""
"RTN","VAFCMGB",62,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB",63,0)
 ;Build logical group 2
"RTN","VAFCMGB",64,0)
 D GROUP2^VAFCMGB1
"RTN","VAFCMGB",65,0)
 ;White space
"RTN","VAFCMGB",66,0)
 ;S LASTNTRY=+$O(@VALMAR@("IDX",VALMCNT-1,0))
"RTN","VAFCMGB",67,0)
 ;S @VALMAR@(VALMCNT,0)=" "
"RTN","VAFCMGB",68,0)
 ;S @VALMAR@("IDX",VALMCNT,LASTNTRY)=""
"RTN","VAFCMGB",69,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB",70,0)
 ;Build logical group 3
"RTN","VAFCMGB",71,0)
 D GROUP3^VAFCMGB2
"RTN","VAFCMGB",72,0)
 ;White space - eliminated with **479
"RTN","VAFCMGB",73,0)
 ;S LASTNTRY=+$O(@VALMAR@("IDX",VALMCNT-1,0))
"RTN","VAFCMGB",74,0)
 ;S @VALMAR@(VALMCNT,0)=" "
"RTN","VAFCMGB",75,0)
 ;S @VALMAR@("IDX",VALMCNT,LASTNTRY)=""
"RTN","VAFCMGB",76,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB",77,0)
 ;S @VALMAR@(VALMCNT,0)=" "
"RTN","VAFCMGB",78,0)
 ;S @VALMAR@("IDX",VALMCNT,LASTNTRY)=""
"RTN","VAFCMGB",79,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB",80,0)
 ;Build logical group 4
"RTN","VAFCMGB",81,0)
 D GROUP4^VAFCMGB3
"RTN","VAFCMGB",82,0)
 ;Done
"RTN","VAFCMGB",83,0)
 Q
"RTN","VAFCMGB",84,0)
 ;
"RTN","VAFCMGB",85,0)
RBLDGRP(GROUP) ;Rebuild specified group in List Manager display
"RTN","VAFCMGB",86,0)
 ;
"RTN","VAFCMGB",87,0)
 ;Input  : GROUP - Number denoting which logical group in display
"RTN","VAFCMGB",88,0)
 ;                 should be rebuilt
"RTN","VAFCMGB",89,0)
 ;                 Groups 1, 2, 3, and 4 are currently supported
"RTN","VAFCMGB",90,0)
 ;         See above note on input variables
"RTN","VAFCMGB",91,0)
 ;Output : See above note on output
"RTN","VAFCMGB",92,0)
 ;
"RTN","VAFCMGB",93,0)
 ;Check input
"RTN","VAFCMGB",94,0)
 S GROUP=+$G(GROUP)
"RTN","VAFCMGB",95,0)
 ;Declare variables
"RTN","VAFCMGB",96,0)
 N VALMCNT
"RTN","VAFCMGB",97,0)
 ;Get starting line number of group
"RTN","VAFCMGB",98,0)
 S VALMCNT=+$G(@VALMAR@("GRP",GROUP))
"RTN","VAFCMGB",99,0)
 ;Rebuild logical group 1 - done
"RTN","VAFCMGB",100,0)
 I (GROUP=1) D GROUP1^VAFCMGB0 Q
"RTN","VAFCMGB",101,0)
 ;Rebuild logical group 2 - done
"RTN","VAFCMGB",102,0)
 I (GROUP=2) D GROUP2^VAFCMGB1 Q
"RTN","VAFCMGB",103,0)
 ;Rebuild logical group 3 - done
"RTN","VAFCMGB",104,0)
 I (GROUP=3) D GROUP3^VAFCMGB2 Q
"RTN","VAFCMGB",105,0)
 ;Rebuild logical group 4 - done
"RTN","VAFCMGB",106,0)
 I (GROUP=4) D GROUP4^VAFCMGB3 Q
"RTN","VAFCMGB",107,0)
 ;Done - did nothing
"RTN","VAFCMGB",108,0)
 Q
"RTN","VAFCMGB0")
0^5^B44177478
"RTN","VAFCMGB0",1,0)
VAFCMGB0 ;ALB/JRP-DEMOGRAPHIC MERGE SCREENS ;10/18/96
"RTN","VAFCMGB0",2,0)
 ;;5.3;Registration;**149,255,477,479**;Aug 13, 1993
"RTN","VAFCMGB0",3,0)
 ;
"RTN","VAFCMGB0",4,0)
 ;NOTE: This routine contains line tags used to build the display
"RTN","VAFCMGB0",5,0)
 ;      screen for a List Manager interface.  Refer to routine
"RTN","VAFCMGB0",6,0)
 ;      VAFCMGB for a description of input/output variables.
"RTN","VAFCMGB0",7,0)
 ;
"RTN","VAFCMGB0",8,0)
LOCAL(FILE,FIELD,IENS,ARRAY) ;Get local data from extraction array
"RTN","VAFCMGB0",9,0)
 ;
"RTN","VAFCMGB0",10,0)
 ;Input  : FILE - File number
"RTN","VAFCMGB0",11,0)
 ;         FIELD - Field number
"RTN","VAFCMGB0",12,0)
 ;         IENS - FDA entry number (ex: "DFN,")
"RTN","VAFCMGB0",13,0)
 ;         ARRAY - FDA array containing local data (full global ref)
"RTN","VAFCMGB0",14,0)
 ;                   (ie: ARRAY(File,IENS,Field) = Value)
"RTN","VAFCMGB0",15,0)
 ;         All variables denoted in VAFCMGB routine
"RTN","VAFCMGB0",16,0)
 ;Output : Value to display
"RTN","VAFCMGB0",17,0)
 ;Notes  : Existance/validity of input variables is assumed
"RTN","VAFCMGB0",18,0)
 ;       : ARRAY() is the ouput of the call to GETDATA^VAFCMGU0()
"RTN","VAFCMGB0",19,0)
 ;       :<No Data Found> is returned when ARRAY(File,IENS,Field) is NULL
"RTN","VAFCMGB0",20,0)
 ;         or does not exist
"RTN","VAFCMGB0",21,0)
 ;       : Phone numbers are returned in HL7 format
"RTN","VAFCMGB0",22,0)
 ;       : Social security numbers will contain dashes
"RTN","VAFCMGB0",23,0)
 ;       : Dates are returned in the format MM-DD-YYYY@HH:MM:SS
"RTN","VAFCMGB0",24,0)
 ;
"RTN","VAFCMGB0",25,0)
 ;Declare variables
"RTN","VAFCMGB0",26,0)
 N VALUE,QUOTE
"RTN","VAFCMGB0",27,0)
 S QUOTE=$C(34)
"RTN","VAFCMGB0",28,0)
 ;Get data
"RTN","VAFCMGB0",29,0)
 S VALUE=$G(@ARRAY@(FILE,IENS,FIELD))
"RTN","VAFCMGB0",30,0)
 ;Convert NULLS and quit
"RTN","VAFCMGB0",31,0)
 Q:(VALUE="") "<No Data Found>"
"RTN","VAFCMGB0",32,0)
 ;Convert phone numbers to HL7 format
"RTN","VAFCMGB0",33,0)
 I ((FIELD=.131)!(FIELD=.132)!(FIELD=.219)) I (FILE=2) D
"RTN","VAFCMGB0",34,0)
 .S VALUE=$$HLPHONE^HLFNC(VALUE)
"RTN","VAFCMGB0",35,0)
 ;Add dashes to SSN
"RTN","VAFCMGB0",36,0)
 I (FIELD=.09) I (FILE=2) D
"RTN","VAFCMGB0",37,0)
 .S VALUE=$TR(VALUE,"-","")
"RTN","VAFCMGB0",38,0)
 .S VALUE=$E(VALUE,1,3)_"-"_$E(VALUE,4,5)_"-"_$E(VALUE,6,10)
"RTN","VAFCMGB0",39,0)
 ;Convert dates to MM-DD-YYYY@HH:MM:SS format
"RTN","VAFCMGB0",40,0)
 I ((FIELD=.03)!(FIELD=.351)) I (FILE=2) D
"RTN","VAFCMGB0",41,0)
 .S VALUE=$$EX2INDT^VAFCMGU0(VALUE)
"RTN","VAFCMGB0",42,0)
 .S VALUE=$$IN2EXDT^VAFCMGU0(VALUE)
"RTN","VAFCMGB0",43,0)
 ;Done
"RTN","VAFCMGB0",44,0)
 Q VALUE
"RTN","VAFCMGB0",45,0)
 ;
"RTN","VAFCMGB0",46,0)
REMOTE(FILE,FIELD) ;Get remote data from merge array [VAFCARR()]
"RTN","VAFCMGB0",47,0)
 ;
"RTN","VAFCMGB0",48,0)
 ;Input  : FILE - File number
"RTN","VAFCMGB0",49,0)
 ;         FIELD - Field number
"RTN","VAFCMGB0",50,0)
 ;         All variables denoted in VAFCMGB routine
"RTN","VAFCMGB0",51,0)
 ;Output : Value to display
"RTN","VAFCMGB0",52,0)
 ;Notes  : Existance/validity of input variables is assumed
"RTN","VAFCMGB0",53,0)
 ;       :<No Data Found> is returned when VAFCARR(File,Field) is NULL or
"RTN","VAFCMGB0",54,0)
 ;         does not exist
"RTN","VAFCMGB0",55,0)
 ;       : <Data Deleted> is returned when VAFCARR(File,Field)="@"
"RTN","VAFCMGB0",56,0)
 ;       : When VAFCARR(Field,Field)="^text", text will be returned
"RTN","VAFCMGB0",57,0)
 ;       : Phone numbers are returned in HL7 format
"RTN","VAFCMGB0",58,0)
 ;       : Social security numbers will contain dashes
"RTN","VAFCMGB0",59,0)
 ;       : Dates are returned in the format MM-DD-YYYY@HH:MM:SS
"RTN","VAFCMGB0",60,0)
 ;
"RTN","VAFCMGB0",61,0)
 ;Declare variables
"RTN","VAFCMGB0",62,0)
 N VALUE,QUOTE
"RTN","VAFCMGB0",63,0)
 S QUOTE=$C(34)
"RTN","VAFCMGB0",64,0)
 ;Get data
"RTN","VAFCMGB0",65,0)
 S VALUE=$G(@VAFCARR@(FILE,FIELD))
"RTN","VAFCMGB0",66,0)
 ;Convert NULLS and quit
"RTN","VAFCMGB0",67,0)
 Q:($P(VALUE,U)="") "<No Data Found>"
"RTN","VAFCMGB0",68,0)
 ;Convert "@" and quit
"RTN","VAFCMGB0",69,0)
 Q:($P(VALUE,U)=(QUOTE_"@"_QUOTE)) "<Data Deleted>"
"RTN","VAFCMGB0",70,0)
 ;Convert unresolved and quit
"RTN","VAFCMGB0",71,0)
 Q:$P(VALUE,U,3) "<UR> "_$P(VALUE,U)
"RTN","VAFCMGB0",72,0)
 S VALUE=$P(VALUE,U)
"RTN","VAFCMGB0",73,0)
 ;Convert phone numbers to HL7 format
"RTN","VAFCMGB0",74,0)
 I ((FIELD=.131)!(FIELD=.132)!(FIELD=.219)) I (FILE=2) D
"RTN","VAFCMGB0",75,0)
 .S VALUE=$$HLPHONE^HLFNC(VALUE)
"RTN","VAFCMGB0",76,0)
 ;Add dashes to SSN
"RTN","VAFCMGB0",77,0)
 I (FIELD=.09) I (FILE=2) D
"RTN","VAFCMGB0",78,0)
 .S VALUE=$TR(VALUE,"-","")
"RTN","VAFCMGB0",79,0)
 .S VALUE=$E(VALUE,1,3)_"-"_$E(VALUE,4,5)_"-"_$E(VALUE,6,10)
"RTN","VAFCMGB0",80,0)
 ;Convert dates to MM-DD-YYYY@HH:MM:SS format
"RTN","VAFCMGB0",81,0)
 I ((FIELD=.03)!(FIELD=.351)) I (FILE=2) D
"RTN","VAFCMGB0",82,0)
 .S VALUE=$$IN2EXDT^VAFCMGU0(VALUE)
"RTN","VAFCMGB0",83,0)
 ;Convert ZIP to ZIP+4
"RTN","VAFCMGB0",84,0)
 ;I (FIELD=.1112) I (FILE=2) D  ;**255 **479
"RTN","VAFCMGB0",85,0)
 ;.S VALUE=$TR(VALUE,"-") ;**477 old messaging didn't contain '-'
"RTN","VAFCMGB0",86,0)
 ;.S VALUE=$E(VALUE,1,5)_$S($E(VALUE,6,9)]"":"-"_$E(VALUE,6,9),1:"")
"RTN","VAFCMGB0",87,0)
 I (FIELD=.3612) I (FILE=2) D  ;**477
"RTN","VAFCMGB0",88,0)
 .I $L(VALUE)>7 S VALUE=$$HL7TFM^XLFDT(VALUE) ;convert hl7 to fileman date
"RTN","VAFCMGB0",89,0)
 ;Done
"RTN","VAFCMGB0",90,0)
 Q VALUE
"RTN","VAFCMGB0",91,0)
 ;
"RTN","VAFCMGB0",92,0)
DIFFCHK(FILE,FIELD,IENS,ARRAY) ;Compare local and remote data for differences
"RTN","VAFCMGB0",93,0)
 ;
"RTN","VAFCMGB0",94,0)
 ;Input  : FILE - File number
"RTN","VAFCMGB0",95,0)
 ;         FIELD - Field number
"RTN","VAFCMGB0",96,0)
 ;         IENS - FDA entry number (ex: "2169,")
"RTN","VAFCMGB0",97,0)
 ;         ARRAY - FDA array containing local data (full global ref)
"RTN","VAFCMGB0",98,0)
 ;                   (ie: ARRAY(File,IENS,Field) = Value)
"RTN","VAFCMGB0",99,0)
 ;         All variables denoted in VAFCMGB routine
"RTN","VAFCMGB0",100,0)
 ;Output : 1 = Local & remote data are different
"RTN","VAFCMGB0",101,0)
 ;         0 = Local & remote data are not different
"RTN","VAFCMGB0",102,0)
 ;Notes  : Existance/validity of input variables is assumed
"RTN","VAFCMGB0",103,0)
 ;       : ARRAY() is the ouput of the call to GETDATA^VAFCMGU0()
"RTN","VAFCMGB0",104,0)
 ;       : If VAFCARR(File,Field) is undefined, NULL, or has a value of
"RTN","VAFCMGB0",105,0)
 ;         "^text" a difference is not found (prevents overwritting of
"RTN","VAFCMGB0",106,0)
 ;         local data)
"RTN","VAFCMGB0",107,0)
 ;       : If VAFCARR(File,Field) is "@" and ARRAY(File,IENS,Field) is
"RTN","VAFCMGB0",108,0)
 ;         NULL or does not exist a difference is not found (prevents
"RTN","VAFCMGB0",109,0)
 ;         deletion of nothing)
"RTN","VAFCMGB0",110,0)
 ;       : Phone numbers are converted to HL7 format for comparison
"RTN","VAFCMGB0",111,0)
 ;       : Social security numbers are compared with dashes removed
"RTN","VAFCMGB0",112,0)
 ;       : Dates are converted to FileMan format for comparison
"RTN","VAFCMGB0",113,0)
 ;
"RTN","VAFCMGB0",114,0)
 ;Declare variables
"RTN","VAFCMGB0",115,0)
 N LOCAL,REMOTE,QUOTE
"RTN","VAFCMGB0",116,0)
 S QUOTE=$C(34)
"RTN","VAFCMGB0",117,0)
 ;Get local data
"RTN","VAFCMGB0",118,0)
 S LOCAL=$G(@ARRAY@(FILE,IENS,FIELD))
"RTN","VAFCMGB0",119,0)
 ;Get remote data
"RTN","VAFCMGB0",120,0)
 S REMOTE=$P($G(@VAFCARR@(FILE,FIELD)),U)
"RTN","VAFCMGB0",121,0)
 ;S:$E(REMOTE)=U&($P(REMOTE,U,2)]"") REMOTE=$P(REMOTE,U,2)
"RTN","VAFCMGB0",122,0)
 ;S:$P(REMOTE,U)=""&('$P(REMOTE,U,2)) REMOTE=""
"RTN","VAFCMGB0",123,0)
 ;S:$P(REMOTE,U)]"" REMOTE=$P(REMOTE,U)
"RTN","VAFCMGB0",124,0)
 ;Screen for remote value of NULL - return no diff
"RTN","VAFCMGB0",125,0)
 I (REMOTE="") Q 0
"RTN","VAFCMGB0",126,0)
 ;Screen for remote value of "^text" - return no diff
"RTN","VAFCMGB0",127,0)
 I (REMOTE=(QUOTE_"^")) Q 0
"RTN","VAFCMGB0",128,0)
 ;Screen for remote value of "@" and no local value - return no diff
"RTN","VAFCMGB0",129,0)
 I ((REMOTE=(QUOTE_"@"_QUOTE))&(LOCAL="")) Q 0
"RTN","VAFCMGB0",130,0)
 ;Convert phone numbers to HL7 format
"RTN","VAFCMGB0",131,0)
 I ((FIELD=.131)!(FIELD=.132)!(FIELD=.219)) I (FILE=2) D
"RTN","VAFCMGB0",132,0)
 .S LOCAL=$$HLPHONE^HLFNC(LOCAL)
"RTN","VAFCMGB0",133,0)
 .S REMOTE=$$HLPHONE^HLFNC(REMOTE)
"RTN","VAFCMGB0",134,0)
 ;Remove dashes from SSN
"RTN","VAFCMGB0",135,0)
 I (FIELD=.09) I (FILE=2) D
"RTN","VAFCMGB0",136,0)
 .S LOCAL=$TR(LOCAL,"-","")
"RTN","VAFCMGB0",137,0)
 .S REMOTE=$TR(REMOTE,"-","")
"RTN","VAFCMGB0",138,0)
 ;Convert dates to FileMan format (remote dates already in FM format)
"RTN","VAFCMGB0",139,0)
 I ((FIELD=.03)!(FIELD=.351)) I (FILE=2) D
"RTN","VAFCMGB0",140,0)
 .S LOCAL=$$EX2INDT^VAFCMGU0(LOCAL)
"RTN","VAFCMGB0",141,0)
 I (FIELD=.3612) I (FILE=2) D  ;*477
"RTN","VAFCMGB0",142,0)
 .S LOCAL=$$EX2INDT^VAFCMGU0(LOCAL)
"RTN","VAFCMGB0",143,0)
 .I $L(REMOTE)>7 S REMOTE=$$HL7TFM^XLFDT(REMOTE) ;convert hl7 to fileman date
"RTN","VAFCMGB0",144,0)
 ;Convert zip+4 to fileman format
"RTN","VAFCMGB0",145,0)
 ;I (FIELD=.1112) I (FILE=2) D  ;**255 **479
"RTN","VAFCMGB0",146,0)
 ;.S LOCAL=$TR(LOCAL,"-","")
"RTN","VAFCMGB0",147,0)
 ;.S REMOTE=$TR(REMOTE,"-","")
"RTN","VAFCMGB0",148,0)
 ;Done - return comparison of local & remote data
"RTN","VAFCMGB0",149,0)
 Q ('(LOCAL=REMOTE))
"RTN","VAFCMGB0",150,0)
 ;
"RTN","VAFCMGB0",151,0)
GROUP1 ;Line tag to build logical group number one
"RTN","VAFCMGB0",152,0)
 ;
"RTN","VAFCMGB0",153,0)
 ;Group one contains the following fields:
"RTN","VAFCMGB0",154,0)
 ;  .01, .03, .09, .351
"RTN","VAFCMGB0",155,0)
 ;
"RTN","VAFCMGB0",156,0)
 ;Column width is limited to 30 characters
"RTN","VAFCMGB0",157,0)
 ;
"RTN","VAFCMGB0",158,0)
 ;Declare variables
"RTN","VAFCMGB0",159,0)
 N IENS,TARGET,MESSAGE,LINE,DATA,LOCAL,REMOTE,DIFF
"RTN","VAFCMGB0",160,0)
 S TARGET="^TMP(""VAFC-MERGE-TO"","_$J_",""DATA"")"
"RTN","VAFCMGB0",161,0)
 S MESSAGE="^TMP(""VAFC-MERGE-TO"","_$J_",""MESSAGE"")"
"RTN","VAFCMGB0",162,0)
 ;Initialize global locations
"RTN","VAFCMGB0",163,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB0",164,0)
 ;Set group index
"RTN","VAFCMGB0",165,0)
 S @VALMAR@("GRP",1)=VALMCNT
"RTN","VAFCMGB0",166,0)
 ;Get local data for patient
"RTN","VAFCMGB0",167,0)
 D GETDATA^VAFCMGU0(VAFCDFN,1,TARGET,MESSAGE)
"RTN","VAFCMGB0",168,0)
 ;Build display
"RTN","VAFCMGB0",169,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGB0",170,0)
 ;Name
"RTN","VAFCMGB0",171,0)
 S LOCAL=$$LOCAL(2,.01,IENS,TARGET)
"RTN","VAFCMGB0",172,0)
 S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB0",173,0)
 S REMOTE=$$REMOTE(2,.01)
"RTN","VAFCMGB0",174,0)
 S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB0",175,0)
 S DIFF=$$DIFFCHK(2,.01,IENS,TARGET)
"RTN","VAFCMGB0",176,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 1"
"RTN","VAFCMGB0",177,0)
 S:DIFF&($P($G(@VAFCARR@(2,.01)),U,2)) LINE="->"_" 1" ;**477 flag name if different - no longer auto updated
"RTN","VAFCMGB0",178,0)
 S DATA="Name: "_LOCAL
"RTN","VAFCMGB0",179,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,8)
"RTN","VAFCMGB0",180,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB0",181,0)
 S @VALMAR@("IDX",VALMCNT,1)=""
"RTN","VAFCMGB0",182,0)
 I (DIFF) D
"RTN","VAFCMGB0",183,0)
 .S @VALMAR@("E2F",1,1)="2^.01"
"RTN","VAFCMGB0",184,0)
 .S @VALMAR@("E2G",1)=1
"RTN","VAFCMGB0",185,0)
 I ('DIFF) D
"RTN","VAFCMGB0",186,0)
 .K @VALMAR@("E2F",1)
"RTN","VAFCMGB0",187,0)
 .K @VALMAR@("E2G",1)
"RTN","VAFCMGB0",188,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB0",189,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB0",190,0)
 ;SSN
"RTN","VAFCMGB0",191,0)
 S LOCAL=$$LOCAL(2,.09,IENS,TARGET)
"RTN","VAFCMGB0",192,0)
 S REMOTE=$$REMOTE(2,.09)
"RTN","VAFCMGB0",193,0)
 S DIFF=$$DIFFCHK(2,.09,IENS,TARGET)
"RTN","VAFCMGB0",194,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 2"
"RTN","VAFCMGB0",195,0)
 S:DIFF&($P($G(@VAFCARR@(2,.09)),U,2)) LINE="->"_" 2"
"RTN","VAFCMGB0",196,0)
 S DATA="SSN: "_LOCAL
"RTN","VAFCMGB0",197,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,9)
"RTN","VAFCMGB0",198,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB0",199,0)
 S @VALMAR@("IDX",VALMCNT,2)=""
"RTN","VAFCMGB0",200,0)
 I (DIFF) D
"RTN","VAFCMGB0",201,0)
 .S @VALMAR@("E2F",2,1)="2^.09"
"RTN","VAFCMGB0",202,0)
 .S @VALMAR@("E2G",2)=1
"RTN","VAFCMGB0",203,0)
 I ('DIFF) D
"RTN","VAFCMGB0",204,0)
 .K @VALMAR@("E2F",2)
"RTN","VAFCMGB0",205,0)
 .K @VALMAR@("E2G",2)
"RTN","VAFCMGB0",206,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB0",207,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB0",208,0)
 ;Date of birth
"RTN","VAFCMGB0",209,0)
 S LOCAL=$$LOCAL(2,.03,IENS,TARGET)
"RTN","VAFCMGB0",210,0)
 S LOCAL=$P(LOCAL,"@",1)
"RTN","VAFCMGB0",211,0)
 S REMOTE=$$REMOTE(2,.03)
"RTN","VAFCMGB0",212,0)
 S REMOTE=$P(REMOTE,"@",1)
"RTN","VAFCMGB0",213,0)
 S DIFF=$$DIFFCHK(2,.03,IENS,TARGET)
"RTN","VAFCMGB0",214,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 3"
"RTN","VAFCMGB0",215,0)
 S:DIFF&($P($G(@VAFCARR@(2,.03)),U,2)) LINE="->"_" 3"
"RTN","VAFCMGB0",216,0)
 S DATA="DOB: "_LOCAL
"RTN","VAFCMGB0",217,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,9)
"RTN","VAFCMGB0",218,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB0",219,0)
 S @VALMAR@("IDX",VALMCNT,3)=""
"RTN","VAFCMGB0",220,0)
 I (DIFF) D
"RTN","VAFCMGB0",221,0)
 .S @VALMAR@("E2F",3,1)="2^.03"
"RTN","VAFCMGB0",222,0)
 .S @VALMAR@("E2G",3)=1
"RTN","VAFCMGB0",223,0)
 I ('DIFF) D
"RTN","VAFCMGB0",224,0)
 .K @VALMAR@("E2F",3)
"RTN","VAFCMGB0",225,0)
 .K @VALMAR@("E2G",3)
"RTN","VAFCMGB0",226,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB0",227,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB0",228,0)
 ;Date of death - strip time
"RTN","VAFCMGB0",229,0)
 S LOCAL=$$LOCAL(2,.351,IENS,TARGET)
"RTN","VAFCMGB0",230,0)
 ;S LOCAL=$P(LOCAL,"@",1) ;**477 time has already been stripped
"RTN","VAFCMGB0",231,0)
 S REMOTE=$$REMOTE(2,.351)
"RTN","VAFCMGB0",232,0)
 ;S REMOTE=$P(REMOTE,"@",1) ;**477 time has already been stripped
"RTN","VAFCMGB0",233,0)
 S DIFF=$$DIFFCHK(2,.351,IENS,TARGET)
"RTN","VAFCMGB0",234,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 4"
"RTN","VAFCMGB0",235,0)
 S:DIFF&($P($G(@VAFCARR@(2,.351)),U,2)) LINE="->"_" 4"
"RTN","VAFCMGB0",236,0)
 S DATA="DOD: "_LOCAL
"RTN","VAFCMGB0",237,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,9)
"RTN","VAFCMGB0",238,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB0",239,0)
 S @VALMAR@("IDX",VALMCNT,4)=""
"RTN","VAFCMGB0",240,0)
 I (DIFF) D
"RTN","VAFCMGB0",241,0)
 .S @VALMAR@("E2F",4,1)="2^.351"
"RTN","VAFCMGB0",242,0)
 .S @VALMAR@("E2G",4)=1
"RTN","VAFCMGB0",243,0)
 I ('DIFF) D
"RTN","VAFCMGB0",244,0)
 .K @VALMAR@("E2F",4)
"RTN","VAFCMGB0",245,0)
 .K @VALMAR@("E2G",4)
"RTN","VAFCMGB0",246,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB0",247,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB0",248,0)
 Q
"RTN","VAFCMGB1")
0^6^B16780500
"RTN","VAFCMGB1",1,0)
VAFCMGB1 ;ALB/JRP-DEMOGRAPHIC MERGE SCREENS ;10/18/96
"RTN","VAFCMGB1",2,0)
 ;;5.3;Registration;**149,295,384,477,479**;Aug 13, 1993
"RTN","VAFCMGB1",3,0)
 ;
"RTN","VAFCMGB1",4,0)
 ;NOTE: This routine contains line tags used to build the display
"RTN","VAFCMGB1",5,0)
 ;      screen for a List Manager interface.  Refer to routine
"RTN","VAFCMGB1",6,0)
 ;      VAFCMGB for a description of input/output variables.
"RTN","VAFCMGB1",7,0)
 ;
"RTN","VAFCMGB1",8,0)
GROUP2 ;Line tag to build logical group number two
"RTN","VAFCMGB1",9,0)
 ;
"RTN","VAFCMGB1",10,0)
 ;Group two contains the following fields:
"RTN","VAFCMGB1",11,0)
 ;  .111, .1112, .112, .113, .114, .115, .117, .131, .132
"RTN","VAFCMGB1",12,0)
 ;
"RTN","VAFCMGB1",13,0)
 ;Column width is limited to 30 characters
"RTN","VAFCMGB1",14,0)
 ;
"RTN","VAFCMGB1",15,0)
 ;Declare variables
"RTN","VAFCMGB1",16,0)
 N IENS,TARGET,MESSAGE,LINE,DATA,LOCAL,REMOTE,DIFF
"RTN","VAFCMGB1",17,0)
 S TARGET="^TMP(""VAFC-MERGE-TO"","_$J_",""DATA"")"
"RTN","VAFCMGB1",18,0)
 S MESSAGE="^TMP(""VAFC-MERGE-TO"","_$J_",""MESSAGE"")"
"RTN","VAFCMGB1",19,0)
 ;Initialize global locations
"RTN","VAFCMGB1",20,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB1",21,0)
 ;Set group index
"RTN","VAFCMGB1",22,0)
 S @VALMAR@("GRP",2)=VALMCNT
"RTN","VAFCMGB1",23,0)
 ;Get local data for patient
"RTN","VAFCMGB1",24,0)
 D GETDATA^VAFCMGU0(VAFCDFN,2,TARGET,MESSAGE)
"RTN","VAFCMGB1",25,0)
 ;Build display
"RTN","VAFCMGB1",26,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGB1",27,0)
 ;Address lines 1 to 3
"RTN","VAFCMGB1",28,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.111,IENS,TARGET) ;**479
"RTN","VAFCMGB1",29,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",30,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.111)
"RTN","VAFCMGB1",31,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",32,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,.111,IENS,TARGET)
"RTN","VAFCMGB1",33,0)
 ;S LINE=$$INSERT^VAFCMGU0(LOCAL,"",8)
"RTN","VAFCMGB1",34,0)
 ;S @VALMAR@(VALMCNT+1,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",35,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.112,IENS,TARGET) ;**479
"RTN","VAFCMGB1",36,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",37,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.112)
"RTN","VAFCMGB1",38,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",39,0)
 ;S:('DIFF) DIFF=$$DIFFCHK^VAFCMGB0(2,.112,IENS,TARGET)
"RTN","VAFCMGB1",40,0)
 ;S LINE=$$INSERT^VAFCMGU0(LOCAL,"",8)
"RTN","VAFCMGB1",41,0)
 ;S @VALMAR@(VALMCNT+2,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",42,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.113,IENS,TARGET) ;**479
"RTN","VAFCMGB1",43,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",44,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.113)
"RTN","VAFCMGB1",45,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",46,0)
 ;S:('DIFF) DIFF=$$DIFFCHK^VAFCMGB0(2,.113,IENS,TARGET)
"RTN","VAFCMGB1",47,0)
 ;S LINE=$$INSERT^VAFCMGU0(LOCAL,"",8)
"RTN","VAFCMGB1",48,0)
 ;S @VALMAR@(VALMCNT+3,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",49,0)
 ;S @VALMAR@(VALMCNT,0)=$S(DIFF:"**",1:"  ")_" 5 Address:"
"RTN","VAFCMGB1",50,0)
 ;I DIFF,($P($G(@VAFCARR@(2,.111)),U,2)!$P($G(@VAFCARR@(2,.112)),U,2)!$P($G(@VAFCARR@(2,.113)),U,2)) S @VALMAR@(VALMCNT,0)="-> 5 Address:" ;**295
"RTN","VAFCMGB1",51,0)
 ;S @VALMAR@("IDX",VALMCNT,5)=""
"RTN","VAFCMGB1",52,0)
 ;S @VALMAR@("IDX",VALMCNT+1,5)=""
"RTN","VAFCMGB1",53,0)
 ;S @VALMAR@("IDX",VALMCNT+2,5)=""
"RTN","VAFCMGB1",54,0)
 ;S @VALMAR@("IDX",VALMCNT+3,5)=""
"RTN","VAFCMGB1",55,0)
 ;I (DIFF) D
"RTN","VAFCMGB1",56,0)
 ;.S @VALMAR@("E2F",5,1)="2^.111"
"RTN","VAFCMGB1",57,0)
 ;.S @VALMAR@("E2F",5,2)="2^.112"
"RTN","VAFCMGB1",58,0)
 ;.S @VALMAR@("E2F",5,3)="2^.113"
"RTN","VAFCMGB1",59,0)
 ;.S @VALMAR@("E2G",5)=2
"RTN","VAFCMGB1",60,0)
 ;I ('DIFF) D
"RTN","VAFCMGB1",61,0)
 ;.K @VALMAR@("E2F",5)
"RTN","VAFCMGB1",62,0)
 ;.K @VALMAR@("E2G",5)
"RTN","VAFCMGB1",63,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",64,0)
 ;S VALMCNT=VALMCNT+4
"RTN","VAFCMGB1",65,0)
 ;City
"RTN","VAFCMGB1",66,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.114,IENS,TARGET) ;**479
"RTN","VAFCMGB1",67,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",68,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.114)
"RTN","VAFCMGB1",69,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",70,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,.114,IENS,TARGET)
"RTN","VAFCMGB1",71,0)
 ;S LINE=$S(DIFF:"**",1:"  ")_" 6"
"RTN","VAFCMGB1",72,0)
 ;S:DIFF&($P($G(@VAFCARR@(2,.114)),U,2)) LINE="->"_" 6" ;**295
"RTN","VAFCMGB1",73,0)
 ;S DATA="City: "_LOCAL
"RTN","VAFCMGB1",74,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,LINE,8)
"RTN","VAFCMGB1",75,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",76,0)
 ;S @VALMAR@("IDX",VALMCNT,6)=""
"RTN","VAFCMGB1",77,0)
 ;I (DIFF) D
"RTN","VAFCMGB1",78,0)
 ;.S @VALMAR@("E2F",6,1)="2^.114"
"RTN","VAFCMGB1",79,0)
 ;.S @VALMAR@("E2G",6)=2
"RTN","VAFCMGB1",80,0)
 ;I ('DIFF) D
"RTN","VAFCMGB1",81,0)
 ;.K @VALMAR@("E2F",6)
"RTN","VAFCMGB1",82,0)
 ;.K @VALMAR@("E2G",6)
"RTN","VAFCMGB1",83,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",84,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",85,0)
 ;State
"RTN","VAFCMGB1",86,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.115,IENS,TARGET) ;**479
"RTN","VAFCMGB1",87,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",88,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.115)
"RTN","VAFCMGB1",89,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",90,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,.115,IENS,TARGET)
"RTN","VAFCMGB1",91,0)
 ;I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",92,0)
 ;. S LINE=$S(DIFF:"**",1:"  ")_" 7"
"RTN","VAFCMGB1",93,0)
 ;. S:DIFF&($P($G(@VAFCARR@(2,.115)),U,2)) LINE="->"_" 7"
"RTN","VAFCMGB1",94,0)
 ;I '$D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",95,0)
 ;. S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB1",96,0)
 ;. S:DIFF&($P($G(@VAFCARR@(2,.115)),U,2)) LINE="->"
"RTN","VAFCMGB1",97,0)
 ;S DATA="State: "_LOCAL
"RTN","VAFCMGB1",98,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,LINE,7)
"RTN","VAFCMGB1",99,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",100,0)
 ;S @VALMAR@("IDX",VALMCNT,7)=""
"RTN","VAFCMGB1",101,0)
 ;I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",102,0)
 ;. I (DIFF) D
"RTN","VAFCMGB1",103,0)
 ;. .S @VALMAR@("E2F",7,1)="2^.115"
"RTN","VAFCMGB1",104,0)
 ;. .S @VALMAR@("E2G",7)=2
"RTN","VAFCMGB1",105,0)
 ;. I ('DIFF) D
"RTN","VAFCMGB1",106,0)
 ;. .K @VALMAR@("E2F",7)
"RTN","VAFCMGB1",107,0)
 ;. .K @VALMAR@("E2G",7)
"RTN","VAFCMGB1",108,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",109,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",110,0)
 ;Zip+4
"RTN","VAFCMGB1",111,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.1112,IENS,TARGET) ;**479
"RTN","VAFCMGB1",112,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.1112)
"RTN","VAFCMGB1",113,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,.1112,IENS,TARGET)
"RTN","VAFCMGB1",114,0)
 ;S LINE=$S(DIFF:"**",1:"  ")_" 8"
"RTN","VAFCMGB1",115,0)
 ;S:DIFF&($P($G(@VAFCARR@(2,.1112)),U,2)) LINE="->"_" 8" ;**295
"RTN","VAFCMGB1",116,0)
 ;S DATA="Zip+4: "_LOCAL
"RTN","VAFCMGB1",117,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,LINE,7)
"RTN","VAFCMGB1",118,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",119,0)
 ;S @VALMAR@("IDX",VALMCNT,8)=""
"RTN","VAFCMGB1",120,0)
 ;I (DIFF) D
"RTN","VAFCMGB1",121,0)
 ;.S @VALMAR@("E2F",8,1)="2^.1112"
"RTN","VAFCMGB1",122,0)
 ;.S @VALMAR@("E2G",8)=2
"RTN","VAFCMGB1",123,0)
 ;I ('DIFF) D
"RTN","VAFCMGB1",124,0)
 ;.K @VALMAR@("E2F",8)
"RTN","VAFCMGB1",125,0)
 ;.K @VALMAR@("E2G",8)
"RTN","VAFCMGB1",126,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",127,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",128,0)
 ;County
"RTN","VAFCMGB1",129,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,.117,IENS,TARGET) ;**479
"RTN","VAFCMGB1",130,0)
 ;S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",131,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,.117)
"RTN","VAFCMGB1",132,0)
 ;S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",133,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,.117,IENS,TARGET)
"RTN","VAFCMGB1",134,0)
 ;I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",135,0)
 ;. S LINE=$S(DIFF:"**",1:"  ")_" 9"
"RTN","VAFCMGB1",136,0)
 ;. S:DIFF&($P($G(@VAFCARR@(2,.117)),U,2)) LINE="->"_" 9"
"RTN","VAFCMGB1",137,0)
 ;I '$D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",138,0)
 ;. S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB1",139,0)
 ;. S:DIFF&($P($G(@VAFCARR@(2,.117)),U,2)) LINE="->"
"RTN","VAFCMGB1",140,0)
 ;S DATA="County: "_LOCAL
"RTN","VAFCMGB1",141,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,LINE,6)
"RTN","VAFCMGB1",142,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",143,0)
 ;S @VALMAR@("IDX",VALMCNT,9)=""
"RTN","VAFCMGB1",144,0)
 ;I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D  ;**477 for GMT
"RTN","VAFCMGB1",145,0)
 ;. I (DIFF) D
"RTN","VAFCMGB1",146,0)
 ;. .S @VALMAR@("E2F",9,1)="2^.117"
"RTN","VAFCMGB1",147,0)
 ;. .S @VALMAR@("E2G",9)=2
"RTN","VAFCMGB1",148,0)
 ;. I ('DIFF) D
"RTN","VAFCMGB1",149,0)
 ;. .K @VALMAR@("E2F",9)
"RTN","VAFCMGB1",150,0)
 ;. .K @VALMAR@("E2G",9)
"RTN","VAFCMGB1",151,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",152,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",153,0)
 ;Home phone number
"RTN","VAFCMGB1",154,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.131,IENS,TARGET)
"RTN","VAFCMGB1",155,0)
 S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",156,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.131)
"RTN","VAFCMGB1",157,0)
 S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",158,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.131,IENS,TARGET)
"RTN","VAFCMGB1",159,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 5" ;**479 10 to 5
"RTN","VAFCMGB1",160,0)
 S:DIFF&($P($G(@VAFCARR@(2,.131)),U,2)) LINE="->"_" 5" ;**384 ;**479 10 to 5
"RTN","VAFCMGB1",161,0)
 S DATA="Home #: "_LOCAL
"RTN","VAFCMGB1",162,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,6)
"RTN","VAFCMGB1",163,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",164,0)
 S @VALMAR@("IDX",VALMCNT,5)="" ;**479 10 to 5
"RTN","VAFCMGB1",165,0)
 I (DIFF) D
"RTN","VAFCMGB1",166,0)
 .S @VALMAR@("E2F",5,1)="2^.131" ;**479 10 to 5
"RTN","VAFCMGB1",167,0)
 .S @VALMAR@("E2G",5)=2 ;**479 10 to 5
"RTN","VAFCMGB1",168,0)
 I ('DIFF) D
"RTN","VAFCMGB1",169,0)
 .K @VALMAR@("E2F",5) ;**479 10 to 5
"RTN","VAFCMGB1",170,0)
 .K @VALMAR@("E2G",5) ;**479 10 to 5
"RTN","VAFCMGB1",171,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",172,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",173,0)
 ;Work phone number
"RTN","VAFCMGB1",174,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.132,IENS,TARGET)
"RTN","VAFCMGB1",175,0)
 S LOCAL=$E(LOCAL,1,30)
"RTN","VAFCMGB1",176,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.132)
"RTN","VAFCMGB1",177,0)
 S REMOTE=$E(REMOTE,1,30)
"RTN","VAFCMGB1",178,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.132,IENS,TARGET)
"RTN","VAFCMGB1",179,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 6" ;**479 11 to 6
"RTN","VAFCMGB1",180,0)
 S:DIFF&($P($G(@VAFCARR@(2,.132)),U,2)) LINE="->"_" 6" ;**384 ;**479 11 to 6
"RTN","VAFCMGB1",181,0)
 S DATA="Work #: "_LOCAL
"RTN","VAFCMGB1",182,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,6)
"RTN","VAFCMGB1",183,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,48)
"RTN","VAFCMGB1",184,0)
 S @VALMAR@("IDX",VALMCNT,6)="" ;**479 11 to 6
"RTN","VAFCMGB1",185,0)
 I (DIFF) D
"RTN","VAFCMGB1",186,0)
 .S @VALMAR@("E2F",6,1)="2^.132" ;**479 11 to 6
"RTN","VAFCMGB1",187,0)
 .S @VALMAR@("E2G",6)=2 ;**479 11 to 6
"RTN","VAFCMGB1",188,0)
 I ('DIFF) D
"RTN","VAFCMGB1",189,0)
 .K @VALMAR@("E2F",6) ;**479 11 to 6
"RTN","VAFCMGB1",190,0)
 .K @VALMAR@("E2G",6) ;**479 11 to 6
"RTN","VAFCMGB1",191,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB1",192,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB1",193,0)
 ;Done - cleanup global locations used
"RTN","VAFCMGB1",194,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB1",195,0)
 Q
"RTN","VAFCMGB2")
0^7^B34388910
"RTN","VAFCMGB2",1,0)
VAFCMGB2 ;ALB/JRP-DEMOGRAPHIC MERGE SCREENS ;28-OCT-96
"RTN","VAFCMGB2",2,0)
 ;;5.3;Registration;**149,384,479**;Aug 13, 1993
"RTN","VAFCMGB2",3,0)
 ;
"RTN","VAFCMGB2",4,0)
 ;NOTE: This routine contains line tags used to build the display
"RTN","VAFCMGB2",5,0)
 ;      screen for a List Manager interface.  Refer to routine
"RTN","VAFCMGB2",6,0)
 ;      VAFCMGB for a description of input/output variables.
"RTN","VAFCMGB2",7,0)
 ;
"RTN","VAFCMGB2",8,0)
GROUP3 ;Line tag to build logical group number three
"RTN","VAFCMGB2",9,0)
 ;
"RTN","VAFCMGB2",10,0)
 ;Group three contains the following fields:
"RTN","VAFCMGB2",11,0)
 ;  .02, .05, .08, .211, .219, .2403, .31115
"RTN","VAFCMGB2",12,0)
 ;
"RTN","VAFCMGB2",13,0)
 ;Column width is limited to 28 characters
"RTN","VAFCMGB2",14,0)
 ;
"RTN","VAFCMGB2",15,0)
 ;Declare variables
"RTN","VAFCMGB2",16,0)
 N IENS,TARGET,MESSAGE,LINE,DATA,LOCAL,REMOTE,DIFF
"RTN","VAFCMGB2",17,0)
 S TARGET="^TMP(""VAFC-MERGE-TO"","_$J_",""DATA"")"
"RTN","VAFCMGB2",18,0)
 S MESSAGE="^TMP(""VAFC-MERGE-TO"","_$J_",""MESSAGE"")"
"RTN","VAFCMGB2",19,0)
 ;Initialize global locations
"RTN","VAFCMGB2",20,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB2",21,0)
 ;Set group index
"RTN","VAFCMGB2",22,0)
 S @VALMAR@("GRP",3)=VALMCNT
"RTN","VAFCMGB2",23,0)
 ;Get local data for patient
"RTN","VAFCMGB2",24,0)
 D GETDATA^VAFCMGU0(VAFCDFN,3,TARGET,MESSAGE)
"RTN","VAFCMGB2",25,0)
 ;Build display
"RTN","VAFCMGB2",26,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGB2",27,0)
 ;Sex
"RTN","VAFCMGB2",28,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.02,IENS,TARGET)
"RTN","VAFCMGB2",29,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.02)
"RTN","VAFCMGB2",30,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.02,IENS,TARGET)
"RTN","VAFCMGB2",31,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 7" ;**479 12 to 7
"RTN","VAFCMGB2",32,0)
 S:DIFF&($P($G(@VAFCARR@(2,.02)),U,2)) LINE="->"_" 7" ;**479 12 to 7
"RTN","VAFCMGB2",33,0)
 S DATA="Sex: "_LOCAL
"RTN","VAFCMGB2",34,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,15)
"RTN","VAFCMGB2",35,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",36,0)
 S @VALMAR@("IDX",VALMCNT,7)="" ;**479 12 to 7
"RTN","VAFCMGB2",37,0)
 I (DIFF) D
"RTN","VAFCMGB2",38,0)
 .S @VALMAR@("E2F",7,1)="2^.02" ;**479 12 to 7
"RTN","VAFCMGB2",39,0)
 .S @VALMAR@("E2G",7)=3 ;**479 12 to 7
"RTN","VAFCMGB2",40,0)
 I ('DIFF) D
"RTN","VAFCMGB2",41,0)
 .K @VALMAR@("E2F",7) ;**479 12 to 7
"RTN","VAFCMGB2",42,0)
 .K @VALMAR@("E2G",7) ;**479 12 to 7
"RTN","VAFCMGB2",43,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",44,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",45,0)
 ;Marital status
"RTN","VAFCMGB2",46,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.05,IENS,TARGET)
"RTN","VAFCMGB2",47,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",48,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.05)
"RTN","VAFCMGB2",49,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",50,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.05,IENS,TARGET)
"RTN","VAFCMGB2",51,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 8" ;**479 13 to 8
"RTN","VAFCMGB2",52,0)
 S:DIFF&($P($G(@VAFCARR@(2,.05)),U,2)) LINE="->"_" 8" ;**479 13 to 8
"RTN","VAFCMGB2",53,0)
 S DATA="Marital: "_LOCAL
"RTN","VAFCMGB2",54,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,11)
"RTN","VAFCMGB2",55,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",56,0)
 S @VALMAR@("IDX",VALMCNT,8)="" ;**479 13 to 8
"RTN","VAFCMGB2",57,0)
 I (DIFF) D
"RTN","VAFCMGB2",58,0)
 .S @VALMAR@("E2F",8,1)="2^.05" ;**479 13 to 8
"RTN","VAFCMGB2",59,0)
 .S @VALMAR@("E2G",8)=3 ;**479 13 to 8
"RTN","VAFCMGB2",60,0)
 I ('DIFF) D
"RTN","VAFCMGB2",61,0)
 .K @VALMAR@("E2F",8) ;**479 13 to 8
"RTN","VAFCMGB2",62,0)
 .K @VALMAR@("E2G",8) ;**479 13 to 8
"RTN","VAFCMGB2",63,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",64,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",65,0)
 ;Religion
"RTN","VAFCMGB2",66,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.08,IENS,TARGET)
"RTN","VAFCMGB2",67,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",68,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.08)
"RTN","VAFCMGB2",69,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",70,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.08,IENS,TARGET)
"RTN","VAFCMGB2",71,0)
 S LINE=$S(DIFF:"**",1:"  ")_" 9" ;**479 14 to 9
"RTN","VAFCMGB2",72,0)
 S:DIFF&($P($G(@VAFCARR@(2,.08)),U,2)) LINE="->"_" 9" ;**479 14 to 9
"RTN","VAFCMGB2",73,0)
 S DATA="Religion: "_LOCAL
"RTN","VAFCMGB2",74,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,10)
"RTN","VAFCMGB2",75,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",76,0)
 S @VALMAR@("IDX",VALMCNT,9)="" ;**479 14 to 9
"RTN","VAFCMGB2",77,0)
 I (DIFF) D
"RTN","VAFCMGB2",78,0)
 .S @VALMAR@("E2F",9,1)="2^.08" ;**479 14 to 9
"RTN","VAFCMGB2",79,0)
 .S @VALMAR@("E2G",9)=3 ;**479 14 to 9
"RTN","VAFCMGB2",80,0)
 I ('DIFF) D
"RTN","VAFCMGB2",81,0)
 .K @VALMAR@("E2F",9) ;**479 14 to 9
"RTN","VAFCMGB2",82,0)
 .K @VALMAR@("E2G",9) ;**479 14 to 9
"RTN","VAFCMGB2",83,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",84,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",85,0)
 ;Mother's maiden name
"RTN","VAFCMGB2",86,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.2403,IENS,TARGET)
"RTN","VAFCMGB2",87,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",88,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.2403)
"RTN","VAFCMGB2",89,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",90,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.2403,IENS,TARGET)
"RTN","VAFCMGB2",91,0)
 S LINE=$S(DIFF:"**",1:"  ")_"10" ;**479 15 to 10
"RTN","VAFCMGB2",92,0)
 S:DIFF&($P($G(@VAFCARR@(2,.2403)),U,2)) LINE="->"_"10" ;**479 15 to 10
"RTN","VAFCMGB2",93,0)
 S DATA="Mom's Maiden: "_LOCAL
"RTN","VAFCMGB2",94,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,6)
"RTN","VAFCMGB2",95,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",96,0)
 S @VALMAR@("IDX",VALMCNT,10)="" ;**479 15 to 10
"RTN","VAFCMGB2",97,0)
 I (DIFF) D
"RTN","VAFCMGB2",98,0)
 .S @VALMAR@("E2F",10,1)="2^.2403" ;**479 15 to 10
"RTN","VAFCMGB2",99,0)
 .S @VALMAR@("E2G",10)=3 ;**479 15 to 10
"RTN","VAFCMGB2",100,0)
 I ('DIFF) D
"RTN","VAFCMGB2",101,0)
 .K @VALMAR@("E2F",10) ;**479 15 to 10
"RTN","VAFCMGB2",102,0)
 .K @VALMAR@("E2G",10) ;**479 15 to 10
"RTN","VAFCMGB2",103,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",104,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",105,0)
 ;Employment status
"RTN","VAFCMGB2",106,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.31115,IENS,TARGET)
"RTN","VAFCMGB2",107,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",108,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.31115)
"RTN","VAFCMGB2",109,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",110,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.31115,IENS,TARGET)
"RTN","VAFCMGB2",111,0)
 S LINE=$S(DIFF:"**",1:"  ")_"11" ;**479 16 to 11
"RTN","VAFCMGB2",112,0)
 S:DIFF&($P($G(@VAFCARR@(2,.31115)),U,2)) LINE="->"_"11" ;**479 16 to 11
"RTN","VAFCMGB2",113,0)
 S DATA="Employ Stat: "_LOCAL
"RTN","VAFCMGB2",114,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,7)
"RTN","VAFCMGB2",115,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",116,0)
 S @VALMAR@("IDX",VALMCNT,11)="" ;**479 16 to 11
"RTN","VAFCMGB2",117,0)
 I (DIFF) D
"RTN","VAFCMGB2",118,0)
 .S @VALMAR@("E2F",11,1)="2^.31115" ;**479 16 to 11
"RTN","VAFCMGB2",119,0)
 .S @VALMAR@("E2G",11)=3 ;**479 16 to 11
"RTN","VAFCMGB2",120,0)
 I ('DIFF) D
"RTN","VAFCMGB2",121,0)
 .K @VALMAR@("E2F",11) ;**479 16 to 11
"RTN","VAFCMGB2",122,0)
 .K @VALMAR@("E2G",11) ;**479 16 to 11
"RTN","VAFCMGB2",123,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",124,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",125,0)
 ;Next of kin's name
"RTN","VAFCMGB2",126,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.211,IENS,TARGET)
"RTN","VAFCMGB2",127,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",128,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.211)
"RTN","VAFCMGB2",129,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",130,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.211,IENS,TARGET)
"RTN","VAFCMGB2",131,0)
 S LINE=$S(DIFF:"**",1:"  ")_"12" ;**479 17 to 12
"RTN","VAFCMGB2",132,0)
 S:DIFF&($P($G(@VAFCARR@(2,.211)),U,2)) LINE="->"_"12" ;**384 ;**479 17 to 12
"RTN","VAFCMGB2",133,0)
 S DATA="NOK Name: "_LOCAL
"RTN","VAFCMGB2",134,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,10)
"RTN","VAFCMGB2",135,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",136,0)
 S @VALMAR@("IDX",VALMCNT,12)="" ;**479 17 to 12
"RTN","VAFCMGB2",137,0)
 I (DIFF) D
"RTN","VAFCMGB2",138,0)
 .S @VALMAR@("E2F",12,1)="2^.211" ;**479 17 to 12
"RTN","VAFCMGB2",139,0)
 .S @VALMAR@("E2G",12)=3 ;**479 17 to 12
"RTN","VAFCMGB2",140,0)
 I ('DIFF) D
"RTN","VAFCMGB2",141,0)
 .K @VALMAR@("E2F",12) ;**479 17 to 12
"RTN","VAFCMGB2",142,0)
 .K @VALMAR@("E2G",12) ;**479 17 to 12
"RTN","VAFCMGB2",143,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",144,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",145,0)
 ;Next of kin's phone number
"RTN","VAFCMGB2",146,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.219,IENS,TARGET)
"RTN","VAFCMGB2",147,0)
 S LOCAL=$E(LOCAL,1,28)
"RTN","VAFCMGB2",148,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.219)
"RTN","VAFCMGB2",149,0)
 S REMOTE=$E(REMOTE,1,28)
"RTN","VAFCMGB2",150,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.219,IENS,TARGET)
"RTN","VAFCMGB2",151,0)
 S LINE=$S(DIFF:"**",1:"  ")_"13" ;**479 18 to 13
"RTN","VAFCMGB2",152,0)
 S:DIFF&($P($G(@VAFCARR@(2,.219)),U,2)) LINE="->"_"13" ;**384 ;**479 18 to 13
"RTN","VAFCMGB2",153,0)
 S DATA="NOK Phone #: "_LOCAL
"RTN","VAFCMGB2",154,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,7)
"RTN","VAFCMGB2",155,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB2",156,0)
 S @VALMAR@("IDX",VALMCNT,13)="" ;**479 18 to 13
"RTN","VAFCMGB2",157,0)
 I (DIFF) D
"RTN","VAFCMGB2",158,0)
 .S @VALMAR@("E2F",13,1)="2^.219" ;**479 18 to 13
"RTN","VAFCMGB2",159,0)
 .S @VALMAR@("E2G",13)=3 ;**479 18 to 13
"RTN","VAFCMGB2",160,0)
 I ('DIFF) D
"RTN","VAFCMGB2",161,0)
 .K @VALMAR@("E2F",13) ;**479 18 to 13
"RTN","VAFCMGB2",162,0)
 .K @VALMAR@("E2G",13) ;**479 18 to 13
"RTN","VAFCMGB2",163,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB2",164,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB2",165,0)
 ;Done
"RTN","VAFCMGB2",166,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB2",167,0)
 Q
"RTN","VAFCMGB3")
0^8^B32660474
"RTN","VAFCMGB3",1,0)
VAFCMGB3 ;ALB/JRP,LTL,PTD-DEMOGRAPHIC MERGE SCREENS ;07/10/98
"RTN","VAFCMGB3",2,0)
 ;;5.3;Registration;**149,477,479**;Aug 13, 1993
"RTN","VAFCMGB3",3,0)
 ;
"RTN","VAFCMGB3",4,0)
 ;NOTE: This routine contains line tags used to build the display
"RTN","VAFCMGB3",5,0)
 ;      screen for a List Manager interface.  Refer to routine
"RTN","VAFCMGB3",6,0)
 ;      VAFCMGB for a description of input/output variables.
"RTN","VAFCMGB3",7,0)
 ;
"RTN","VAFCMGB3",8,0)
GROUP4 ;Line tag to build logical group number four
"RTN","VAFCMGB3",9,0)
 ;
"RTN","VAFCMGB3",10,0)
 ;Group group contains the following fields
"RTN","VAFCMGB3",11,0)
 ;  .301, .302, .323, 391, 1901
"RTN","VAFCMGB3",12,0)
 ;
"RTN","VAFCMGB3",13,0)
 ;Column width is limited to 29 characters
"RTN","VAFCMGB3",14,0)
 ;
"RTN","VAFCMGB3",15,0)
 ;Declare variables
"RTN","VAFCMGB3",16,0)
 N IENS,TARGET,MESSAGE,LINE,DATA,LOCAL,REMOTE,DIFF
"RTN","VAFCMGB3",17,0)
 S TARGET="^TMP(""VAFC-MERGE-TO"","_$J_",""DATA"")"
"RTN","VAFCMGB3",18,0)
 S MESSAGE="^TMP(""VAFC-MERGE-TO"","_$J_",""MESSAGE"")"
"RTN","VAFCMGB3",19,0)
 ;Initialize global locations
"RTN","VAFCMGB3",20,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB3",21,0)
 ;Set group index
"RTN","VAFCMGB3",22,0)
 S @VALMAR@("GRP",4)=VALMCNT
"RTN","VAFCMGB3",23,0)
 ;Get local data for patient
"RTN","VAFCMGB3",24,0)
 D GETDATA^VAFCMGU0(VAFCDFN,4,TARGET,MESSAGE)
"RTN","VAFCMGB3",25,0)
 ;Build display
"RTN","VAFCMGB3",26,0)
 S IENS=VAFCDFN_","
"RTN","VAFCMGB3",27,0)
 ;Patient Type
"RTN","VAFCMGB3",28,0)
 ;S LOCAL=$$LOCAL^VAFCMGB0(2,391,IENS,TARGET) ;**477
"RTN","VAFCMGB3",29,0)
 ;S LOCAL=$E(LOCAL,1,29)
"RTN","VAFCMGB3",30,0)
 ;S REMOTE=$$REMOTE^VAFCMGB0(2,391)
"RTN","VAFCMGB3",31,0)
 ;S REMOTE=$E(REMOTE,1,29)
"RTN","VAFCMGB3",32,0)
 ;S DIFF=$$DIFFCHK^VAFCMGB0(2,391,IENS,TARGET)
"RTN","VAFCMGB3",33,0)
 ;S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",34,0)
 ;S:DIFF&($P($G(@VAFCARR@(2,391)),U,2)) LINE="->"
"RTN","VAFCMGB3",35,0)
 ;S DATA="Type: "_LOCAL
"RTN","VAFCMGB3",36,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,LINE,11)
"RTN","VAFCMGB3",37,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",38,0)
 ;S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",39,0)
 ;I (DIFF) D
"RTN","VAFCMGB3",40,0)
 ;.S @VALMAR@("E2F",19,1)="2^391"
"RTN","VAFCMGB3",41,0)
 ;.S @VALMAR@("E2G",19)=4
"RTN","VAFCMGB3",42,0)
 ;I ('DIFF) D
"RTN","VAFCMGB3",43,0)
 ;.K @VALMAR@("E2F",19)
"RTN","VAFCMGB3",44,0)
 ;.K @VALMAR@("E2G",19)
"RTN","VAFCMGB3",45,0)
 ;W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB3",46,0)
 ;S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",47,0)
 ;Veteran
"RTN","VAFCMGB3",48,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,1901,IENS,TARGET)
"RTN","VAFCMGB3",49,0)
 S LOCAL=$E(LOCAL,1,29)
"RTN","VAFCMGB3",50,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,1901)
"RTN","VAFCMGB3",51,0)
 S REMOTE=$E(REMOTE,1,29)
"RTN","VAFCMGB3",52,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,1901,IENS,TARGET)
"RTN","VAFCMGB3",53,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",54,0)
 S:DIFF&($P($G(@VAFCARR@(2,1901)),U,2)) LINE="->"
"RTN","VAFCMGB3",55,0)
 S DATA="Veteran: "_LOCAL
"RTN","VAFCMGB3",56,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,8)
"RTN","VAFCMGB3",57,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",58,0)
 S (@VALMAR@("IDX",VALMCNT,18),@VALMAR@("IDX",VALMCNT+1,18))=""
"RTN","VAFCMGB3",59,0)
 ;I (DIFF) D
"RTN","VAFCMGB3",60,0)
 ;.S @VALMAR@("E2F",20,1)="2^1901"
"RTN","VAFCMGB3",61,0)
 ;.S @VALMAR@("E2G",20)=4
"RTN","VAFCMGB3",62,0)
 ;I ('DIFF) D
"RTN","VAFCMGB3",63,0)
 ;.K @VALMAR@("E2F",20)
"RTN","VAFCMGB3",64,0)
 ;.K @VALMAR@("E2G",20)
"RTN","VAFCMGB3",65,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB3",66,0)
 S VALMCNT=VALMCNT+1 ;**479 changed +2 to +1
"RTN","VAFCMGB3",67,0)
 ;Service connected and percentage
"RTN","VAFCMGB3",68,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.301,IENS,TARGET)
"RTN","VAFCMGB3",69,0)
 S LOCAL("SC")=$E(LOCAL,1,29)
"RTN","VAFCMGB3",70,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.301)
"RTN","VAFCMGB3",71,0)
 S REMOTE("SC")=$E(REMOTE,1,29)
"RTN","VAFCMGB3",72,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.301,IENS,TARGET)
"RTN","VAFCMGB3",73,0)
 S LOCAL("SC%")=$$LOCAL^VAFCMGB0(2,.302,IENS,TARGET)
"RTN","VAFCMGB3",74,0)
 S REMOTE("SC%")=$$REMOTE^VAFCMGB0(2,.302)
"RTN","VAFCMGB3",75,0)
 S:('DIFF) DIFF=$$DIFFCHK^VAFCMGB0(2,.302,IENS,TARGET)
"RTN","VAFCMGB3",76,0)
 S:((LOCAL("SC%")="<No Data Found>")&(LOCAL("SC")="NO")) LOCAL("SC%")="N/A"
"RTN","VAFCMGB3",77,0)
 S:((REMOTE("SC%")="<No Data Found>")&(REMOTE("SC%")="NO")) REMOTE("SC%")="N/A"
"RTN","VAFCMGB3",78,0)
 S REMOTE("SC")=REMOTE("SC")_"  "_REMOTE("SC%")
"RTN","VAFCMGB3",79,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",80,0)
 S:DIFF&($P($G(@VAFCARR@(2,.301)),U,2)) LINE="->"
"RTN","VAFCMGB3",81,0)
 S DATA="SC: "_LOCAL("SC")_"  SC%: "_LOCAL("SC%")
"RTN","VAFCMGB3",82,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,13)
"RTN","VAFCMGB3",83,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE("SC"),LINE,50)
"RTN","VAFCMGB3",84,0)
 ;S DATA="SC %: "_LOCAL("SC%")
"RTN","VAFCMGB3",85,0)
 ;S LINE=$$INSERT^VAFCMGU0(DATA,"",11)
"RTN","VAFCMGB3",86,0)
 ;S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE("SC%"),LINE,54)
"RTN","VAFCMGB3",87,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",88,0)
 ;S @VALMAR@("IDX",VALMCNT+1,21)=""
"RTN","VAFCMGB3",89,0)
 ;S @VALMAR@("IDX",VALMCNT+2,21)=""
"RTN","VAFCMGB3",90,0)
 ;I (DIFF) D
"RTN","VAFCMGB3",91,0)
 ;.S @VALMAR@("E2F",21,1)="2^.301"
"RTN","VAFCMGB3",92,0)
 ;.S @VALMAR@("E2F",21,2)="2^.302"
"RTN","VAFCMGB3",93,0)
 ;.S @VALMAR@("E2G",21)=4
"RTN","VAFCMGB3",94,0)
 ;I ('DIFF) D
"RTN","VAFCMGB3",95,0)
 ;.K @VALMAR@("E2F",21)
"RTN","VAFCMGB3",96,0)
 ;.K @VALMAR@("E2G",21)
"RTN","VAFCMGB3",97,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB3",98,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",99,0)
 ;Period of service
"RTN","VAFCMGB3",100,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.323,IENS,TARGET)
"RTN","VAFCMGB3",101,0)
 S LOCAL=$E(LOCAL,1,29)
"RTN","VAFCMGB3",102,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.323)
"RTN","VAFCMGB3",103,0)
 S REMOTE=$E(REMOTE,1,29)
"RTN","VAFCMGB3",104,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.323,IENS,TARGET)
"RTN","VAFCMGB3",105,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",106,0)
 S:DIFF&($P($G(@VAFCARR@(2,.323)),U,2)) LINE="->"
"RTN","VAFCMGB3",107,0)
 S DATA="POS: "_LOCAL
"RTN","VAFCMGB3",108,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,12)
"RTN","VAFCMGB3",109,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",110,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",111,0)
 ;I (DIFF) D
"RTN","VAFCMGB3",112,0)
 ;.S @VALMAR@("E2F",22,1)="2^.323"
"RTN","VAFCMGB3",113,0)
 ;.S @VALMAR@("E2G",22)=4
"RTN","VAFCMGB3",114,0)
 ;I ('DIFF) D
"RTN","VAFCMGB3",115,0)
 ;.K @VALMAR@("E2F",22)
"RTN","VAFCMGB3",116,0)
 ;.K @VALMAR@("E2G",22)
"RTN","VAFCMGB3",117,0)
 W:(+$G(VAFCDOTS)) "."
"RTN","VAFCMGB3",118,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",119,0)
 ;Primary Eligibility Code
"RTN","VAFCMGB3",120,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.361,IENS,TARGET)
"RTN","VAFCMGB3",121,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.361)
"RTN","VAFCMGB3",122,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.361,IENS,TARGET)
"RTN","VAFCMGB3",123,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",124,0)
 S:DIFF&($P($G(@VAFCARR@(2,.361)),U,2)) LINE="->"
"RTN","VAFCMGB3",125,0)
 S DATA="Prim Elig Code: "_LOCAL
"RTN","VAFCMGB3",126,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,3)
"RTN","VAFCMGB3",127,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",128,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",129,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",130,0)
 ;Date of eligibility status
"RTN","VAFCMGB3",131,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.3612,IENS,TARGET)
"RTN","VAFCMGB3",132,0)
 S REMOTE=$$FMTE^XLFDT($$REMOTE^VAFCMGB0(2,.3612),1)
"RTN","VAFCMGB3",133,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.3612,IENS,TARGET)
"RTN","VAFCMGB3",134,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",135,0)
 S:DIFF&($P($G(@VAFCARR@(2,.3612)),U,2)) LINE="->"
"RTN","VAFCMGB3",136,0)
 S DATA="Date Verified: "_LOCAL
"RTN","VAFCMGB3",137,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,3)
"RTN","VAFCMGB3",138,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",139,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",140,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",141,0)
 ;Verification method
"RTN","VAFCMGB3",142,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.3615,IENS,TARGET)
"RTN","VAFCMGB3",143,0)
 S REMOTE=$$REMOTE^VAFCMGB0(2,.3615)
"RTN","VAFCMGB3",144,0)
 S DIFF=$$DIFFCHK^VAFCMGB0(2,.3615,IENS,TARGET)
"RTN","VAFCMGB3",145,0)
 S LINE=$S(DIFF:"**",1:"  ")
"RTN","VAFCMGB3",146,0)
 S:DIFF&($P($G(@VAFCARR@(2,.3615)),U,2)) LINE="->"
"RTN","VAFCMGB3",147,0)
 S DATA="Verification method: "
"RTN","VAFCMGB3",148,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,3)
"RTN","VAFCMGB3",149,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0("",LINE,50)
"RTN","VAFCMGB3",150,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",151,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",152,0)
 S LINE="",LINE=$$INSERT^VAFCMGU0(LOCAL,LINE,3)
"RTN","VAFCMGB3",153,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",154,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",155,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",156,0)
 ;Who verified locally (no remote data sent)
"RTN","VAFCMGB3",157,0)
 S LOCAL=$$LOCAL^VAFCMGB0(2,.3616,IENS,TARGET)
"RTN","VAFCMGB3",158,0)
 S REMOTE="<Not Available>"
"RTN","VAFCMGB3",159,0)
 S LINE="  "
"RTN","VAFCMGB3",160,0)
 S DATA="Who verified: "_LOCAL
"RTN","VAFCMGB3",161,0)
 S LINE=$$INSERT^VAFCMGU0(DATA,LINE,3)
"RTN","VAFCMGB3",162,0)
 S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",163,0)
 S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",164,0)
 S VALMCNT=VALMCNT+1
"RTN","VAFCMGB3",165,0)
 ;If PATIENT ELIGIBILITIES multiple contains EMPLOYEE, display local data (no remote data sent).
"RTN","VAFCMGB3",166,0)
 S LOCAL=$O(^DIC(8,"B","EMPLOYEE",0)) I LOCAL D
"RTN","VAFCMGB3",167,0)
 .Q:'$D(^DPT(VAFCDFN,"E",LOCAL,0))
"RTN","VAFCMGB3",168,0)
 .;Else patient is an employee
"RTN","VAFCMGB3",169,0)
 .S REMOTE="<Not Available>",LINE="  ",DATA="Other Eligibility: EMPLOYEE"
"RTN","VAFCMGB3",170,0)
 .S LINE=$$INSERT^VAFCMGU0(DATA,LINE,3)
"RTN","VAFCMGB3",171,0)
 .S @VALMAR@(VALMCNT,0)=$$INSERT^VAFCMGU0(REMOTE,LINE,50)
"RTN","VAFCMGB3",172,0)
 .S @VALMAR@("IDX",VALMCNT,18)=""
"RTN","VAFCMGB3",173,0)
 ;Done - cleanup global locations used
"RTN","VAFCMGB3",174,0)
 K @TARGET,@MESSAGE
"RTN","VAFCMGB3",175,0)
 Q
"RTN","VAFCMGU0")
0^9^B19941380
"RTN","VAFCMGU0",1,0)
VAFCMGU0 ;ALB/JRP-MERGE SCREEN UTILITIES ;10/18/96
"RTN","VAFCMGU0",2,0)
 ;;5.3;Registration;**149,295,479**;Aug 13, 1993
"RTN","VAFCMGU0",3,0)
 ;
"RTN","VAFCMGU0",4,0)
REPEAT(CHAR,TIMES)      ;Repeat a string
"RTN","VAFCMGU0",5,0)
 ;
"RTN","VAFCMGU0",6,0)
 ;INPUT  : CHAR - Character to repeat
"RTN","VAFCMGU0",7,0)
 ;         TIMES - Number of times to repeat CHAR
"RTN","VAFCMGU0",8,0)
 ;OUTPUT : s - String of CHAR that is TIMES long
"RTN","VAFCMGU0",9,0)
 ;         "" - Error (bad input)
"RTN","VAFCMGU0",10,0)
 ;
"RTN","VAFCMGU0",11,0)
 ;Check input
"RTN","VAFCMGU0",12,0)
 Q:($G(CHAR)="") ""
"RTN","VAFCMGU0",13,0)
 Q:((+$G(TIMES))=0) ""
"RTN","VAFCMGU0",14,0)
 ;Return string
"RTN","VAFCMGU0",15,0)
 Q $TR($J("",TIMES)," ",CHAR)
"RTN","VAFCMGU0",16,0)
 ;
"RTN","VAFCMGU0",17,0)
INSERT(INSTR,OUTSTR,COLUMN,LENGTH)      ;Insert a string into another
"RTN","VAFCMGU0",18,0)
 ;
"RTN","VAFCMGU0",19,0)
 ;INPUT  : INSTR - String to insert
"RTN","VAFCMGU0",20,0)
 ;         OUTSTR - String to insert into
"RTN","VAFCMGU0",21,0)
 ;         COLUMN - Where to begin insertion (defaults to end of OUTSTR)
"RTN","VAFCMGU0",22,0)
 ;         LENGTH - Number of characters to clear from OUTSTR
"RTN","VAFCMGU0",23,0)
 ;                  (defaults to length of INSTR)
"RTN","VAFCMGU0",24,0)
 ;OUTPUT : s - INSTR will be placed into OUTSTR starting at COLUMN
"RTN","VAFCMGU0",25,0)
 ;             using LENGTH characters
"RTN","VAFCMGU0",26,0)
 ;         "" - Error (bad input)
"RTN","VAFCMGU0",27,0)
 ;
"RTN","VAFCMGU0",28,0)
 ;NOTE : This module is based on $$SETSTR^VALM1
"RTN","VAFCMGU0",29,0)
 ;
"RTN","VAFCMGU0",30,0)
 ;Check input
"RTN","VAFCMGU0",31,0)
 Q:('$D(INSTR)) ""
"RTN","VAFCMGU0",32,0)
 Q:('$D(OUTSTR)) ""
"RTN","VAFCMGU0",33,0)
 S:('$D(COLUMN)) COLUMN=$L(OUTSTR)+1
"RTN","VAFCMGU0",34,0)
 S:('$D(LENGTH)) LENGTH=$L(INSTR)
"RTN","VAFCMGU0",35,0)
 ;Declare variables
"RTN","VAFCMGU0",36,0)
 N FRONT,END
"RTN","VAFCMGU0",37,0)
 ;Get front portion of new string
"RTN","VAFCMGU0",38,0)
 S FRONT=$E((OUTSTR_$J("",COLUMN-1)),1,(COLUMN-1))
"RTN","VAFCMGU0",39,0)
 ;Get ending portion of new string
"RTN","VAFCMGU0",40,0)
 S END=$E(OUTSTR,(COLUMN+LENGTH),$L(OUTSTR))
"RTN","VAFCMGU0",41,0)
 ;Insert string
"RTN","VAFCMGU0",42,0)
 Q FRONT_$E((INSTR_$J("",LENGTH)),1,LENGTH)_END
"RTN","VAFCMGU0",43,0)
 ;
"RTN","VAFCMGU0",44,0)
CENTER(CNTRSTR,MARGIN) ;Center a string
"RTN","VAFCMGU0",45,0)
 ;
"RTN","VAFCMGU0",46,0)
 ;INPUT  : CNTRSTR - String to center
"RTN","VAFCMGU0",47,0)
 ;         MARGIN - Margin width to center within (defaults to 80)
"RTN","VAFCMGU0",48,0)
 ;OUTPUT : s - INSTR will be centered in a margin width of MARGIN
"RTN","VAFCMGU0",49,0)
 ;         "" - Error (bad input)
"RTN","VAFCMGU0",50,0)
 ;NOTES  : A margin width of 80 will be used when MARGIN<1
"RTN","VAFCMGU0",51,0)
 ;       : CNTRSTR will be returned when $L(CNTRSTR)>MARGIN
"RTN","VAFCMGU0",52,0)
 ;
"RTN","VAFCMGU0",53,0)
 ;Check input
"RTN","VAFCMGU0",54,0)
 Q:($G(CNTRSTR)="") ""
"RTN","VAFCMGU0",55,0)
 S:($G(MARGIN)<1) MARGIN=80
"RTN","VAFCMGU0",56,0)
 ;Center the string
"RTN","VAFCMGU0",57,0)
 Q $$INSERT(CNTRSTR,"",((MARGIN\2)-($L(CNTRSTR)\2)))
"RTN","VAFCMGU0",58,0)
 ;
"RTN","VAFCMGU0",59,0)
IN2EXDT(DATE,STYLE) ;Converts dates from internal to external format
"RTN","VAFCMGU0",60,0)
 ;
"RTN","VAFCMGU0",61,0)
 ;Input  : DATE - Date in FileMan format
"RTN","VAFCMGU0",62,0)
 ;         STYLE - Flag indicating output style
"RTN","VAFCMGU0",63,0)
 ;                 If 0, return date in format MM-DD-YYYY (Default)
"RTN","VAFCMGU0",64,0)
 ;                 If 1, return date in format MMM DD, YYYY
"RTN","VAFCMGU0",65,0)
 ;                   (MMM -> first three characters of month)
"RTN","VAFCMGU0",66,0)
 ;Output : External date in specified format
"RTN","VAFCMGU0",67,0)
 ;Notes  : Time will NOT be included, even if present on input
"RTN","VAFCMGU0",68,0)
 ;       : NULL ("") is returned on bad input
"RTN","VAFCMGU0",69,0)
 ;
"RTN","VAFCMGU0",70,0)
 ;Check input
"RTN","VAFCMGU0",71,0)
 S DATE=+$P($G(DATE),".",1)
"RTN","VAFCMGU0",72,0)
 Q:('DATE) ""
"RTN","VAFCMGU0",73,0)
 Q:(DATE'?7N) ""
"RTN","VAFCMGU0",74,0)
 S STYLE=+$G(STYLE)
"RTN","VAFCMGU0",75,0)
 ;Return date in MM-DD-YYYY format
"RTN","VAFCMGU0",76,0)
 Q:('STYLE) $E(DATE,4,5)_"-"_$E(DATE,6,7)_"-"_($E(DATE,1,3)+1700)
"RTN","VAFCMGU0",77,0)
 ;Declare variables
"RTN","VAFCMGU0",78,0)
 N Y,%DT
"RTN","VAFCMGU0",79,0)
 ;Return date in MMM DD, YYYY format
"RTN","VAFCMGU0",80,0)
 S Y=DATE
"RTN","VAFCMGU0",81,0)
 D DD^%DT
"RTN","VAFCMGU0",82,0)
 Q Y
"RTN","VAFCMGU0",83,0)
 ;
"RTN","VAFCMGU0",84,0)
EX2INDT(DATE) ;Converts dates from external to internal format
"RTN","VAFCMGU0",85,0)
 ;
"RTN","VAFCMGU0",86,0)
 ;Input  : Date in external format
"RTN","VAFCMGU0",87,0)
 ;Output : Date in FileMan format
"RTN","VAFCMGU0",88,0)
 ;Notes  : Time will be included if present on input
"RTN","VAFCMGU0",89,0)
 ;       : NULL ("") is returned on bad input
"RTN","VAFCMGU0",90,0)
 ;
"RTN","VAFCMGU0",91,0)
 ;Check input
"RTN","VAFCMGU0",92,0)
 S DATE=$G(DATE)
"RTN","VAFCMGU0",93,0)
 Q:(DATE="") ""
"RTN","VAFCMGU0",94,0)
 ;Declare variables
"RTN","VAFCMGU0",95,0)
 N X,%DT,Y
"RTN","VAFCMGU0",96,0)
 ;Convert date
"RTN","VAFCMGU0",97,0)
 S DATE=$P(DATE,"@",1) ;**295 strip time off
"RTN","VAFCMGU0",98,0)
 I $L(DATE,"/")=3,'$P(DATE,"/",2) S DATE=$P(DATE,"/",1)_"/"_$P(DATE,"/",3) ;**295 imprecise date - ##/00/#### to ##/####
"RTN","VAFCMGU0",99,0)
 I $L(DATE,"/")=2,'$P(DATE,"/",1) S DATE=$P(DATE,"/",2) ;**295 imprecise date - 00/#### to ####
"RTN","VAFCMGU0",100,0)
 S X=DATE
"RTN","VAFCMGU0",101,0)
 S %DT="TS"
"RTN","VAFCMGU0",102,0)
 D ^%DT
"RTN","VAFCMGU0",103,0)
 Q:(Y=-1) ""
"RTN","VAFCMGU0",104,0)
 Q Y
"RTN","VAFCMGU0",105,0)
 ;
"RTN","VAFCMGU0",106,0)
NOW(FMFORM,NOTIME) ;Returns current date/time
"RTN","VAFCMGU0",107,0)
 ;
"RTN","VAFCMGU0",108,0)
 ;Input  : FMFORM - Flag indicating if FileMan format should be used
"RTN","VAFCMGU0",109,0)
 ;                  If 0, return in the format MM-DD-YYYY@HH:MM:SS
"RTN","VAFCMGU0",110,0)
 ;                    (default)
"RTN","VAFCMGU0",111,0)
 ;                  If 1, return in FileMan format
"RTN","VAFCMGU0",112,0)
 ;         NOTIME - Flag indicating if time should not be included
"RTN","VAFCMGU0",113,0)
 ;                  If 0, time will be included in output (default)
"RTN","VAFCMGU0",114,0)
 ;                  If 1, time will not be included in output
"RTN","VAFCMGU0",115,0)
 ;Output : Current date & time in specified format
"RTN","VAFCMGU0",116,0)
 ;
"RTN","VAFCMGU0",117,0)
 ;Check input
"RTN","VAFCMGU0",118,0)
 S FMFORM=+$G(FMFORM)
"RTN","VAFCMGU0",119,0)
 S NOTIME=+$G(NOTIME)
"RTN","VAFCMGU0",120,0)
 ;Declare variables
"RTN","VAFCMGU0",121,0)
 N X,%,%H,%I,OUT
"RTN","VAFCMGU0",122,0)
 ;Get current date/time
"RTN","VAFCMGU0",123,0)
 D NOW^%DTC
"RTN","VAFCMGU0",124,0)
 ;Return date/time in FileMan format
"RTN","VAFCMGU0",125,0)
 Q:(FMFORM) $S(NOTIME:X,1:%)
"RTN","VAFCMGU0",126,0)
 ;Return date/time in MM-DD-YYYY@HH:MM:SS format
"RTN","VAFCMGU0",127,0)
 S %=%_"000000"
"RTN","VAFCMGU0",128,0)
 S OUT=$E(%,4,5)_"-"_$E(%,6,7)_"-"_(1700+$E(%,1,3))
"RTN","VAFCMGU0",129,0)
 S:('NOTIME) OUT=OUT_"@"_$E(%,9,10)_":"_$E(%,11,12)_":"_$E(%,13,14)
"RTN","VAFCMGU0",130,0)
 Q OUT
"RTN","VAFCMGU0",131,0)
 ;
"RTN","VAFCMGU0",132,0)
GETDATA(DFN,GROUP,TARGET,MESSAGE) ;Get local data required to build
"RTN","VAFCMGU0",133,0)
 ; merge screens for a given patient
"RTN","VAFCMGU0",134,0)
 ;
"RTN","VAFCMGU0",135,0)
 ;Input  : DFN - Pointer to entry in PATIENT file (#2)
"RTN","VAFCMGU0",136,0)
 ;         GROUP - Group number to get data for (defaults to 1)
"RTN","VAFCMGU0",137,0)
 ;                   Group 1 = Name, SSN, date of birth & date of death
"RTN","VAFCMGU0",138,0)
 ;         TARGET - Array to store data in (full global reference)
"RTN","VAFCMGU0",139,0)
 ;                  Defaults to ^TMP("VAFC-MERGE-TO",$J,"DATA")
"RTN","VAFCMGU0",140,0)
 ;         MESSAGE - Array to store error data in (full global reference)
"RTN","VAFCMGU0",141,0)
 ;                  Defaults to ^TMP("VAFC-MERGE-TO",$J,"MESSAGE")
"RTN","VAFCMGU0",142,0)
 ;Output : None
"RTN","VAFCMGU0",143,0)
 ;           TARGET & MESSAGE will be in the format defined by FileMan
"RTN","VAFCMGU0",144,0)
 ;           for interaction with the Database Server calls.  Refer to
"RTN","VAFCMGU0",145,0)
 ;           the FileMan documentation on GETS^DIQ() for further
"RTN","VAFCMGU0",146,0)
 ;           information.
"RTN","VAFCMGU0",147,0)
 ;Notes  : All data will be in external format
"RTN","VAFCMGU0",148,0)
 ;       : Groups 1 - 4 are currently supported
"RTN","VAFCMGU0",149,0)
 ;       : Initialization of TARGET & MESSAGE is defined by the call
"RTN","VAFCMGU0",150,0)
 ;         to GETS^DIQ().  Refer to the FileMan documentation for
"RTN","VAFCMGU0",151,0)
 ;         further details.
"RTN","VAFCMGU0",152,0)
 ;
"RTN","VAFCMGU0",153,0)
 ;Check input
"RTN","VAFCMGU0",154,0)
 S DFN=+$G(DFN)
"RTN","VAFCMGU0",155,0)
 S GROUP=+$G(GROUP)
"RTN","VAFCMGU0",156,0)
 S:((GROUP<1)!(GROUP>4)) GROUP=0
"RTN","VAFCMGU0",157,0)
 S TARGET=$G(TARGET)
"RTN","VAFCMGU0",158,0)
 S:(TARGET="") TARGET="^TMP(""VAFC-MERGE-TO"","_$J_",""DATA"")"
"RTN","VAFCMGU0",159,0)
 S MESSAGE=$G(MESSAGE)
"RTN","VAFCMGU0",160,0)
 S:(MESSAGE="") MESSAGE="^TMP(""VAFC-MERGE-TO"","_$J_",""MESSAGE"")"
"RTN","VAFCMGU0",161,0)
 ;Declare variables
"RTN","VAFCMGU0",162,0)
 N IENS,FIELDS ;,COUNTY ;**479
"RTN","VAFCMGU0",163,0)
 S IENS=DFN_","
"RTN","VAFCMGU0",164,0)
 ;S COUNTY=0 ;**479
"RTN","VAFCMGU0",165,0)
 ;Group 1
"RTN","VAFCMGU0",166,0)
 S FIELDS=".01;.03;.09;.351"
"RTN","VAFCMGU0",167,0)
 ;Group 2
"RTN","VAFCMGU0",168,0)
 I (GROUP=2) D
"RTN","VAFCMGU0",169,0)
 .S FIELDS=".131;.132" ;".111;.1112;.112;.113;.114;.115;.117;.131;.132" ;**479
"RTN","VAFCMGU0",170,0)
 .;Remember that COUNTY (field #.117) was retrieved
"RTN","VAFCMGU0",171,0)
 .;S COUNTY=1 ;**479
"RTN","VAFCMGU0",172,0)
 ;Group 3
"RTN","VAFCMGU0",173,0)
 I (GROUP=3) D
"RTN","VAFCMGU0",174,0)
 .S FIELDS=".02;.05;.08;.211;.219;.2403;.31115"
"RTN","VAFCMGU0",175,0)
 ;Group 4
"RTN","VAFCMGU0",176,0)
 I (GROUP=4) D
"RTN","VAFCMGU0",177,0)
 .S FIELDS=".301;.302;.323;.361;.3612;.3615;.3616;391;1901"
"RTN","VAFCMGU0",178,0)
 ;Extract data
"RTN","VAFCMGU0",179,0)
 D GETS^DIQ(2,IENS,FIELDS,"",TARGET,MESSAGE)
"RTN","VAFCMGU0",180,0)
 ;Accomodate for incorrect extraction of COUNTY (field #.117)
"RTN","VAFCMGU0",181,0)
 ;S:(COUNTY) @TARGET@(2,IENS,.117)=$$COUNTY(DFN) ;**479
"RTN","VAFCMGU0",182,0)
 ;Done
"RTN","VAFCMGU0",183,0)
 Q
"RTN","VAFCMGU0",184,0)
 ;
"RTN","VAFCMGU0",185,0)
COUNTY(DFN) ;Return county name that patient lives in
"RTN","VAFCMGU0",186,0)
 ;
"RTN","VAFCMGU0",187,0)
 ;Input  : DFN - Pointer to entry in PATIENT file (#2)
"RTN","VAFCMGU0",188,0)
 ;Output : County - Name of county that patient lives in
"RTN","VAFCMGU0",189,0)
 ;Notes  : NULL is returned on error, bad input, and no county found
"RTN","VAFCMGU0",190,0)
 ;
"RTN","VAFCMGU0",191,0)
 ;Check input
"RTN","VAFCMGU0",192,0)
 S DFN=+$G(DFN)
"RTN","VAFCMGU0",193,0)
 ;Declare variables
"RTN","VAFCMGU0",194,0)
 N IENS,PTRCNTY,PTRSTATE,TMP
"RTN","VAFCMGU0",195,0)
 ;Get pointers to STATE file and COUNTY sub-file
"RTN","VAFCMGU0",196,0)
 S IENS=DFN_","
"RTN","VAFCMGU0",197,0)
 D GETS^DIQ(2,IENS,".115;.117","I","TMP","TMP")
"RTN","VAFCMGU0",198,0)
 S PTRSTATE=+$G(TMP(2,IENS,.115,"I"))
"RTN","VAFCMGU0",199,0)
 S PTRCNTY=+$G(TMP(2,IENS,.117,"I"))
"RTN","VAFCMGU0",200,0)
 Q:(('PTRSTATE)!('PTRCNTY)) ""
"RTN","VAFCMGU0",201,0)
 ;Get county name
"RTN","VAFCMGU0",202,0)
 S IENS=PTRCNTY_","_PTRSTATE_","
"RTN","VAFCMGU0",203,0)
 D GETS^DIQ(5.01,IENS,".01","","TMP","TMP")
"RTN","VAFCMGU0",204,0)
 ;Return county name
"RTN","VAFCMGU0",205,0)
 Q $G(TMP(5.01,IENS,.01))
"RTN","VAFCRAU")
0^10^B6565055
"RTN","VAFCRAU",1,0)
VAFCRAU ;BHAM/DRI-LIST MANAGER ROUTINE FOR MPI/PD VAFC EXCPT REMOTE AUDIT IN PDR ;3/14/02  11:41
"RTN","VAFCRAU",2,0)
 ;;5.3;Registration;**477,479**;Aug 13, 1993
"RTN","VAFCRAU",3,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","VAFCRAU",4,0)
 ;Reference to RTNDATA^XWBDRPC supported by IA #3149
"RTN","VAFCRAU",5,0)
EN(ICN) ;main entry point for VAFC EXCPT REMOTE AUDIT
"RTN","VAFCRAU",6,0)
 D EN^VALM("VAFC EXCPT REMOTE AUDIT")
"RTN","VAFCRAU",7,0)
 Q
"RTN","VAFCRAU",8,0)
HDR ;header code
"RTN","VAFCRAU",9,0)
 S VALMHDR(1)="MPI/PD REMOTE AUDIT DATA"
"RTN","VAFCRAU",10,0)
 S VALMHDR(2)=""
"RTN","VAFCRAU",11,0)
 Q
"RTN","VAFCRAU",12,0)
INIT ;
"RTN","VAFCRAU",13,0)
 K @VALMAR ;K ^TMP("VAFCRAU",$J)
"RTN","VAFCRAU",14,0)
 I '$D(DFN) G EXIT
"RTN","VAFCRAU",15,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","VAFCRAU",16,0)
 S TXT="-> For Patient "_$P($G(^DPT(DFN,0)),"^",1) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","VAFCRAU",17,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","VAFCRAU",18,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","VAFCRAU",19,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","VAFCRAU",20,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","VAFCRAU",21,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","VAFCRAU",22,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","VAFCRAU",23,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","VAFCRAU",24,0)
 . S TXT="  "_$P(TFL(SL),"^")_"  status: ("_STATUS_")"
"RTN","VAFCRAU",25,0)
 . D ADDTMP
"RTN","VAFCRAU",26,0)
 . S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP D
"RTN","VAFCRAU",27,0)
 . S LOC=$P(TFL(SL),"^",2)
"RTN","VAFCRAU",28,0)
 . N STATUS,RETURN,RESULT,RET
"RTN","VAFCRAU",29,0)
 . I '$D(^XTMP("VAFCRAUD"_ICN,0)) S TXT=" - No audit query exists for this patient." S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","VAFCRAU",30,0)
 . I $D(^XTMP("VAFCRAUD"_ICN,LOC,0)) D
"RTN","VAFCRAU",31,0)
 .. S RETURN(0)=$P(^XTMP("VAFCRAUD"_ICN,LOC,0),"^")
"RTN","VAFCRAU",32,0)
 .. D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","VAFCRAU",33,0)
 ... D RTNDATA^XWBDRPC(.RET,RETURN(0))
"RTN","VAFCRAU",34,0)
 ... I $G(RET(0))<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2,99) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP Q
"RTN","VAFCRAU",35,0)
 ... I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","VAFCRAU",36,0)
 ... S R="" F  S R=$O(RET(R)) Q:R=""  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP ;**479
"RTN","VAFCRAU",37,0)
 K TFARR,R,L,SL,LOC,TFL,GLO
"RTN","VAFCRAU",38,0)
 S VALMCNT=LIN-1
"RTN","VAFCRAU",39,0)
 Q
"RTN","VAFCRAU",40,0)
ADDTMP ;
"RTN","VAFCRAU",41,0)
 S ^TMP("VAFCRAU",$J,LIN,0)=STR
"RTN","VAFCRAU",42,0)
 S ^TMP("VAFCRAU",$J,"IDX",LIN,LIN)=""
"RTN","VAFCRAU",43,0)
 S LIN=LIN+1,STR=""
"RTN","VAFCRAU",44,0)
 Q
"RTN","VAFCRAU",45,0)
HELP ;
"RTN","VAFCRAU",46,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","VAFCRAU",47,0)
 Q
"RTN","VAFCRAU",48,0)
EXIT ;
"RTN","VAFCRAU",49,0)
 S VALMBCK=""
"RTN","VAFCRAU",50,0)
 K ^TMP("VAFCRAU",$J),LIN,X,STR,TXT
"RTN","VAFCRAU",51,0)
 S VALMBCK="R"
"RTN","VAFCRAU",52,0)
 Q
"RTN","VAFCRAUD")
0^11^B58689047
"RTN","VAFCRAUD",1,0)
VAFCRAUD ;BHAM/DRI-ROUTINE TO CALL VAFC REMOTE AUDIT (PATIENT) ;2/22/02
"RTN","VAFCRAUD",2,0)
 ;;5.3;Registration;**477,479**;Aug 13, 1993
"RTN","VAFCRAUD",3,0)
 ;Reference to ^DGCN(391.91 supported by IA #2911
"RTN","VAFCRAUD",4,0)
 ;Reference to EN1^XWB2HL7 supported by IA #3144
"RTN","VAFCRAUD",5,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","VAFCRAUD",6,0)
 ;Reference to RTNDATA^XWBDRPC supported by IA #3149
"RTN","VAFCRAUD",7,0)
ASK ;Ask For Patient
"RTN","VAFCRAUD",8,0)
 K DIRUT
"RTN","VAFCRAUD",9,0)
 W !!,"Patient lookup can be done by Patient Name, SSN or by ICN.",!
"RTN","VAFCRAUD",10,0)
 S DFN="",ICN=""
"RTN","VAFCRAUD",11,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","VAFCRAUD",12,0)
 D MIX^DIC1 K DIC,D
"RTN","VAFCRAUD",13,0)
 I Y<0 S REXIT=1 G QUIT
"RTN","VAFCRAUD",14,0)
 S DFN=+Y
"RTN","VAFCRAUD",15,0)
 S ICN=+$$GETICN^MPIF001(DFN) I ICN<1 W !,"There is no Integration Control Number assigned to this patient,",!,"no treating facilities to query." G ASK
"RTN","VAFCRAUD",16,0)
 Q
"RTN","VAFCRAUD",17,0)
ASK2 ;Ask for Date Range
"RTN","VAFCRAUD",18,0)
 W !!,"Enter date range for data to be included in report."
"RTN","VAFCRAUD",19,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","VAFCRAUD",20,0)
 S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S VAFCBDT=Y
"RTN","VAFCRAUD",21,0)
 S DIR(0)="DAO^"_VAFCBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S VAFCEDT=Y
"RTN","VAFCRAUD",22,0)
 ;
"RTN","VAFCRAUD",23,0)
 D SEND(ICN,VAFCBDT,VAFCEDT)
"RTN","VAFCRAUD",24,0)
 ;
"RTN","VAFCRAUD",25,0)
QUIT ;
"RTN","VAFCRAUD",26,0)
 K Y
"RTN","VAFCRAUD",27,0)
 Q
"RTN","VAFCRAUD",28,0)
 ;
"RTN","VAFCRAUD",29,0)
SEND(ICN,VAFCBDT,VAFCEDT) ;
"RTN","VAFCRAUD",30,0)
 N TFL,X,Y,SNTDT,MPIDIR
"RTN","VAFCRAUD",31,0)
 D GETTFL(ICN,.TFL)
"RTN","VAFCRAUD",32,0)
 I $D(^XTMP("VAFCRAUD"_ICN,0)) S SNTDT=$$FMTE^XLFDT($P(^XTMP("VAFCRAUD"_ICN,0),"^",2)) W !,"Query last sent for this ICN on "_SNTDT,!
"RTN","VAFCRAUD",33,0)
 I $P($G(TFL(0)),"^",1)=1 D
"RTN","VAFCRAUD",34,0)
 . D SELTF Q:((Y="")!(Y="^"))
"RTN","VAFCRAUD",35,0)
 . W !,"Remote patient data queries will be sent to: "
"RTN","VAFCRAUD",36,0)
 . S CNT=0,X=0 F  S X=$O(TFARR(X)) Q:'X  S CNT=CNT+1
"RTN","VAFCRAUD",37,0)
 . I CNT>22 D D2
"RTN","VAFCRAUD",38,0)
 . I CNT<23 D D1
"RTN","VAFCRAUD",39,0)
 . W ! K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do you want to continue" D ^DIR S MPIDIR=+Y K DIR
"RTN","VAFCRAUD",40,0)
 . I MPIDIR=1 S X=0 F  S X=$O(TFL(X)) Q:'X  D
"RTN","VAFCRAUD",41,0)
 .. W !?3,"Sending Remote Query to: ",X,"  ",$P(TFL(X),"^")
"RTN","VAFCRAUD",42,0)
 .. I $D(^XTMP("VAFCRAUD"_ICN,X)) K ^XTMP("VAFCRAUD"_ICN,X)
"RTN","VAFCRAUD",43,0)
 .. D REQ(ICN,.TFL,X)
"RTN","VAFCRAUD",44,0)
 I '$D(TFL(0)) W !!?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query will be sent."
"RTN","VAFCRAUD",45,0)
 K ICNARR,X,Y,CNT,TFARR,TFL
"RTN","VAFCRAUD",46,0)
 Q
"RTN","VAFCRAUD",47,0)
SEND2 ;
"RTN","VAFCRAUD",48,0)
 N REXIT S REXIT=0
"RTN","VAFCRAUD",49,0)
 W !!,"This option sends a remote query to selected treating"
"RTN","VAFCRAUD",50,0)
 W !,"facility site(s) for MPI/PD data for a patient."
"RTN","VAFCRAUD",51,0)
 F  D  Q:REXIT=1
"RTN","VAFCRAUD",52,0)
 . D ASK
"RTN","VAFCRAUD",53,0)
 . I $D(Y) D SEND
"RTN","VAFCRAUD",54,0)
 K ICN,DFN
"RTN","VAFCRAUD",55,0)
 Q
"RTN","VAFCRAUD",56,0)
CHKSTAT(ICN) ;check on the status for a given ICN or SSN
"RTN","VAFCRAUD",57,0)
 N TFL,L,Y,ICNARR,STATUS,SL
"RTN","VAFCRAUD",58,0)
 W !!,"Checking the status of remote patient data query.",!
"RTN","VAFCRAUD",59,0)
 I '$D(^XTMP("VAFCRAUD"_ICN)) W !,"No remote query sent for this patient." Q
"RTN","VAFCRAUD",60,0)
 D GETTFL(ICN,.TFL)
"RTN","VAFCRAUD",61,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","VAFCRAUD",62,0)
 I $D(TFL(0)) D
"RTN","VAFCRAUD",63,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("VAFCRAUD"_ICN,X)) K TFL(X)
"RTN","VAFCRAUD",64,0)
 D SELTF
"RTN","VAFCRAUD",65,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." Q
"RTN","VAFCRAUD",66,0)
 Q:((Y="")!(Y="^"))
"RTN","VAFCRAUD",67,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","VAFCRAUD",68,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","VAFCRAUD",69,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","VAFCRAUD",70,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","VAFCRAUD",71,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","VAFCRAUD",72,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","VAFCRAUD",73,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","VAFCRAUD",74,0)
 . W !?3,"  ",$P(TFL(SL),"^"),"  status: (",STATUS,")"
"RTN","VAFCRAUD",75,0)
 I '$D(TFL(0)) W !!?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query sent for this patient."
"RTN","VAFCRAUD",76,0)
 K ICNARR,L,SL,TFARR,TFL
"RTN","VAFCRAUD",77,0)
 Q
"RTN","VAFCRAUD",78,0)
CHKSTAT2 ;
"RTN","VAFCRAUD",79,0)
 N REXIT S REXIT=0
"RTN","VAFCRAUD",80,0)
 W !!,"This option checks the status of an existing remote patient data query."
"RTN","VAFCRAUD",81,0)
 F  D  Q:REXIT=1
"RTN","VAFCRAUD",82,0)
 . D ASK
"RTN","VAFCRAUD",83,0)
 . I $D(Y) D CHKSTAT
"RTN","VAFCRAUD",84,0)
 K ICN,DFN
"RTN","VAFCRAUD",85,0)
 Q
"RTN","VAFCRAUD",86,0)
DISP    ;display returned AUDIT queries
"RTN","VAFCRAUD",87,0)
 W !!,"Display data returned from remote patient data queries."
"RTN","VAFCRAUD",88,0)
 W !,"(Be sure HISTORY is enabled to capture data!)",!
"RTN","VAFCRAUD",89,0)
 N TFL,L,Y,ICNARR,STATUS
"RTN","VAFCRAUD",90,0)
 I '$D(^XTMP("VAFCRAUD"_ICN)) W !!,"No remote query sent for this patient." Q
"RTN","VAFCRAUD",91,0)
 D GETTFL(ICN,.TFL)
"RTN","VAFCRAUD",92,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","VAFCRAUD",93,0)
 I $D(TFL(0)) D
"RTN","VAFCRAUD",94,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("VAFCRAUD"_ICN,X)) K TFL(X)
"RTN","VAFCRAUD",95,0)
 D SELTF
"RTN","VAFCRAUD",96,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." Q
"RTN","VAFCRAUD",97,0)
 Q:((Y="")!(Y="^"))
"RTN","VAFCRAUD",98,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","VAFCRAUD",99,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","VAFCRAUD",100,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","VAFCRAUD",101,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","VAFCRAUD",102,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","VAFCRAUD",103,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","VAFCRAUD",104,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","VAFCRAUD",105,0)
 . W !?3,"  ",$P(TFL(SL),"^"),"  status: (",STATUS,")"
"RTN","VAFCRAUD",106,0)
 . D DISPLAY(ICN,$P(TFL(SL),"^",2))
"RTN","VAFCRAUD",107,0)
 I '$D(TFL(0)) W !?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query exists for this patient."
"RTN","VAFCRAUD",108,0)
 K ICNARR,L,SL,TFARR,TFL
"RTN","VAFCRAUD",109,0)
 Q
"RTN","VAFCRAUD",110,0)
DISP2 ;
"RTN","VAFCRAUD",111,0)
 N REXIT S REXIT=0
"RTN","VAFCRAUD",112,0)
 F  D  Q:REXIT=1
"RTN","VAFCRAUD",113,0)
 . D ASK
"RTN","VAFCRAUD",114,0)
 . I $D(Y) D DISP
"RTN","VAFCRAUD",115,0)
 K ICN,DFN
"RTN","VAFCRAUD",116,0)
 Q
"RTN","VAFCRAUD",117,0)
DISPLAY(ICN,LOC) ;display a remote audit report
"RTN","VAFCRAUD",118,0)
 N STATUS,RETURN,RESULT,RET,R
"RTN","VAFCRAUD",119,0)
 I '$D(^XTMP("VAFCRAUD"_ICN,0)) W !?15," - No audit query exists for this record."
"RTN","VAFCRAUD",120,0)
 I $D(^XTMP("VAFCRAUD"_ICN,LOC,0)) S RETURN(0)=$P(^XTMP("VAFCRAUD"_ICN,LOC,0),"^") D
"RTN","VAFCRAUD",121,0)
 . D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","VAFCRAUD",122,0)
 .. D RTNDATA^XWBDRPC(.RET,RETURN(0))
"RTN","VAFCRAUD",123,0)
 .. I $D(RET(0)) I RET(0)<0 W !!,"No data returned due to: "_$P(RET(0),"^",2) Q
"RTN","VAFCRAUD",124,0)
 .. I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO W !,TXT I $Y>22 S DIR(0)="E" D ^DIR K DIR W @IOF S $Y=1 ;**479
"RTN","VAFCRAUD",125,0)
 .. S R="" F  S R=$O(RET(R)) Q:R=""  W !,RET(R) I $Y>22 S DIR(0)="E" D ^DIR K DIR W @IOF S $Y=1 ;**479
"RTN","VAFCRAUD",126,0)
 Q
"RTN","VAFCRAUD",127,0)
GETTFL(ICN,TFL) ;Check for existing Treating Facilities
"RTN","VAFCRAUD",128,0)
 N LOC,HOME
"RTN","VAFCRAUD",129,0)
 S HOME=$$SITE^VASITE()
"RTN","VAFCRAUD",130,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","VAFCRAUD",131,0)
 . S LOC=$$NNT^XUAF4(TF)
"RTN","VAFCRAUD",132,0)
 . I $P(LOC,"^",2)'=$E($P(HOME,"^",3),1,3) D
"RTN","VAFCRAUD",133,0)
 .. S TFL($P(LOC,"^",2))=LOC
"RTN","VAFCRAUD",134,0)
 .. S LOC=$P(LOC,"^",2)
"RTN","VAFCRAUD",135,0)
 .. D MONITOR(ICN,LOC,.RESULT)
"RTN","VAFCRAUD",136,0)
 .. S $P(TFL(LOC),"^",3)=$P(RESULT(0),"^",2)
"RTN","VAFCRAUD",137,0)
 I $O(TFL(0)) S TFL(0)=1
"RTN","VAFCRAUD",138,0)
 K TF
"RTN","VAFCRAUD",139,0)
 Q
"RTN","VAFCRAUD",140,0)
SELTF ;Allow the user to select treating facilites from a list
"RTN","VAFCRAUD",141,0)
 K TFARR,TFARR1
"RTN","VAFCRAUD",142,0)
 S I=0 F  S I=$O(TFL(I)) Q:'I  D
"RTN","VAFCRAUD",143,0)
 . S TFARR1($P(TFL(I),"^",1))=$P(TFL(I),"^",2)_"^"_$P(TFL(I),"^",1)
"RTN","VAFCRAUD",144,0)
 S I="",CNT=0 F  S I=$O(TFARR1(I)) Q:I=""  D
"RTN","VAFCRAUD",145,0)
 . S CNT=CNT+1 S TFARR(CNT)=TFARR1(I)
"RTN","VAFCRAUD",146,0)
 I CNT=1 S Y=1 Q
"RTN","VAFCRAUD",147,0)
 K DIR,Y
"RTN","VAFCRAUD",148,0)
 S CNT=CNT+1,TFARR(CNT)="ALL"
"RTN","VAFCRAUD",149,0)
 S DIR(0)="LA^1:"_CNT
"RTN","VAFCRAUD",150,0)
 S DIR("A")="Select site(s) 1-"_(CNT-1)_" or "_CNT_" for all: "
"RTN","VAFCRAUD",151,0)
 W !,"Select one or more of the following: "
"RTN","VAFCRAUD",152,0)
 I CNT>22 D D2
"RTN","VAFCRAUD",153,0)
 I CNT<23 D D1
"RTN","VAFCRAUD",154,0)
 D ^DIR K DIR
"RTN","VAFCRAUD",155,0)
 I Y<1 K TFARR,TFARR1,L,I,A,CNT Q
"RTN","VAFCRAUD",156,0)
 S Y=","_Y
"RTN","VAFCRAUD",157,0)
 I Y[(","_CNT_",") K TFARR(CNT),TFARR1,CNT,I Q
"RTN","VAFCRAUD",158,0)
 S I=0,A="" F  S I=$O(TFARR(I)) Q:'I  I Y'[(","_I_",") S A=$P(TFARR(I),"^",1) K TFL(A) K TFARR(I)
"RTN","VAFCRAUD",159,0)
 K L,I,A,TFARR(CNT),CNT,TFARR1
"RTN","VAFCRAUD",160,0)
 Q
"RTN","VAFCRAUD",161,0)
MONITOR(ICN,LOC,RESULT) ;
"RTN","VAFCRAUD",162,0)
 N STATUS,RETURN
"RTN","VAFCRAUD",163,0)
 I '$D(^XTMP("VAFCRAUD"_ICN,0)) S RESULT(0)="-1^Unknown" Q
"RTN","VAFCRAUD",164,0)
 I '$D(^XTMP("VAFCRAUD"_ICN,LOC,0)) S RESULT(0)="-1^Unknown" Q
"RTN","VAFCRAUD",165,0)
 I $D(^XTMP("VAFCRAUD"_ICN,LOC,0)) S RETURN(0)=$P(^XTMP("VAFCRAUD"_ICN,LOC,0),"^",1) D RPCCHK^XWB2HL7(.RESULT,RETURN(0))
"RTN","VAFCRAUD",166,0)
 Q
"RTN","VAFCRAUD",167,0)
REQ(ICN,TFL,LOC)        ;request a remote audit report
"RTN","VAFCRAUD",168,0)
 ;LOC - STATION# OF THE INSTITUTION file entry
"RTN","VAFCRAUD",169,0)
 N VALUE S VALUE="ICN",VALUE(VALUE)=ICN
"RTN","VAFCRAUD",170,0)
 I +LOC>0 D EN1^XWB2HL7(.RETURN,LOC,"VAFC REMOTE AUDIT",1,.VALUE,"",VAFCBDT,VAFCEDT)
"RTN","VAFCRAUD",171,0)
 S ^XTMP("VAFCRAUD"_ICN,0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"REMOTE AUDIT QUERY"
"RTN","VAFCRAUD",172,0)
 S ^XTMP("VAFCRAUD"_ICN,LOC,0)=RETURN(0)_"^"_$$NOW^XLFDT
"RTN","VAFCRAUD",173,0)
 Q
"RTN","VAFCRAUD",174,0)
SENS ;Check for patient sensitivity
"RTN","VAFCRAUD",175,0)
 N RESULT
"RTN","VAFCRAUD",176,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RPC - VAFC REMOTE AUDIT^Remote Audit Query")
"RTN","VAFCRAUD",177,0)
 I RESULT(1)>0 D
"RTN","VAFCRAUD",178,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","VAFCRAUD",179,0)
 . W !!,"PATIENT MARKED SENSITIVE."
"RTN","VAFCRAUD",180,0)
 . W !,"You do not have proper security to view this record."
"RTN","VAFCRAUD",181,0)
 Q
"RTN","VAFCRAUD",182,0)
D1 ;
"RTN","VAFCRAUD",183,0)
 S C1=1,I=0 F  S I=$O(TFARR(I)) Q:'I  D
"RTN","VAFCRAUD",184,0)
 . W !,C1_".",?4,"("_$P(TFARR(I),"^",1)_") "_$P(TFARR(I),"^",2) S C1=C1+1
"RTN","VAFCRAUD",185,0)
 K C1,I
"RTN","VAFCRAUD",186,0)
 Q
"RTN","VAFCRAUD",187,0)
D2 ;
"RTN","VAFCRAUD",188,0)
 S I2=23 F I=1:1:22 D
"RTN","VAFCRAUD",189,0)
 . W !,I_".",?4,"("_$P(TFARR(I),"^",1)_") "_$P(TFARR(I),"^",2)
"RTN","VAFCRAUD",190,0)
 . I $D(TFARR(I2)) W ?41,I2_". ",?44,"("_$P(TFARR(I2),"^",1)_") "_$P(TFARR(I2),"^",2) S I2=I2+1
"RTN","VAFCRAUD",191,0)
 K I,I2
"RTN","VAFCRAUD",192,0)
 Q
"RTN","VAFCRPC")
0^12^B7443211
"RTN","VAFCRPC",1,0)
VAFCRPC ;BIR/DLR-RPC ENTRY POINTS ;10/24/02  13:07
"RTN","VAFCRPC",2,0)
 ;;5.3;Registration;**414,440,474,477,479**;Aug 13, 1993
"RTN","VAFCRPC",3,0)
 ;;Routine uses the following supported IAs #2701 and #3027.
"RTN","VAFCRPC",4,0)
PDAT(RETURN,VALUE,SSN) ;remote pdat display
"RTN","VAFCRPC",5,0)
 ;'value' will pass in either an icn, ssn, dfn or patient name
"RTN","VAFCRPC",6,0)
 N ARRAY,DFN,ICN,NAME,SSN,VAFCSEN
"RTN","VAFCRPC",7,0)
 I $O(VALUE(""))="" S VALUE("ICN")=VALUE ;backwards compatibility - sites passing in an icn
"RTN","VAFCRPC",8,0)
 S ICN=$G(VALUE("ICN")) ;icn (local or national) passed in from mpi
"RTN","VAFCRPC",9,0)
 S NAME=$G(VALUE("NAME")) ;patient name passed in from mpi
"RTN","VAFCRPC",10,0)
 S SSN=$G(VALUE("SSN")) ;social security number passed in from mpi
"RTN","VAFCRPC",11,0)
 S DFN=$G(VALUE("DFN")) ;patient file ien passed in from mpi
"RTN","VAFCRPC",12,0)
 I $G(SSN)'="" S DFN=$O(^DPT("SSN",SSN,0)) I DFN="" S RETURN(1)="-1^Invalid SSN passed into RPC" Q
"RTN","VAFCRPC",13,0)
 I $G(ICN)'="" S DFN=$$GETDFN^MPIF001(ICN) I +DFN<0 S RETURN(1)="-1^Invalid ICN passed into RPC" Q  ;IA 2701
"RTN","VAFCRPC",14,0)
 I $G(NAME)'="" S DFN=$O(^DPT("B",NAME,0)) I DFN="" S RETURN(1)="-1^Invalid NAME passed into RPC" Q
"RTN","VAFCRPC",15,0)
 I $S('$G(DFN):1,'$D(^DPT(DFN,0)):1,1:0) S RETURN(1)="-1^Invalid DFN passed into RPC" Q
"RTN","VAFCRPC",16,0)
 ;log patient sensitivity on receiving system and send msg bulletin
"RTN","VAFCRPC",17,0)
 ;D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE AUDIT FROM THE MPI^Remote Audit Query",3) ;IA #3027
"RTN","VAFCRPC",18,0)
 S ARRAY="^TMP(""VAFCHFS"","_$J_")"
"RTN","VAFCRPC",19,0)
 D HFS^VAFCHFS("START^VAFCPDAT")
"RTN","VAFCRPC",20,0)
 ;M RETURN=@ARRAY
"RTN","VAFCRPC",21,0)
 D DSPPDAT^VAFCHFS(.RETURN)
"RTN","VAFCRPC",22,0)
 K ^TMP("VAFCHFS",$J)
"RTN","VAFCRPC",23,0)
 Q
"RTN","VAFCRPC",24,0)
 ;
"RTN","VAFCRPC",25,0)
AUDIT(RETURN,VALUE,SSN,SDT,EDT) ;remote audit display
"RTN","VAFCRPC",26,0)
 ;'value' will pass in either an icn, ssn, dfn or patient name
"RTN","VAFCRPC",27,0)
 N ARRAY,DFN,ICN,NAME,SSN,VAFCSEN
"RTN","VAFCRPC",28,0)
 S ICN=$G(VALUE("ICN")) ;icn (local or national) passed in
"RTN","VAFCRPC",29,0)
 S NAME=$G(VALUE("NAME")) ;patient name passed in
"RTN","VAFCRPC",30,0)
 S SSN=$G(VALUE("SSN")) ;social security number passed in
"RTN","VAFCRPC",31,0)
 S DFN=$G(VALUE("DFN")) ;patient file ien passed in
"RTN","VAFCRPC",32,0)
 I $G(SSN)'="" S DFN=$O(^DPT("SSN",SSN,0)) I DFN="" S RETURN(1)="-1^Invalid SSN passed into RPC" Q
"RTN","VAFCRPC",33,0)
 I $G(ICN)'="" S DFN=$$GETDFN^MPIF001(ICN) I +DFN<0 S RETURN(1)="-1^Invalid ICN passed into RPC" Q  ;IA 2701
"RTN","VAFCRPC",34,0)
 I $G(NAME)'="" S DFN=$O(^DPT("B",NAME,0)) I DFN="" S RETURN(1)="-1^Invalid NAME passed into RPC" Q
"RTN","VAFCRPC",35,0)
 I $S('$G(DFN):1,'$D(^DPT(DFN,0)):1,1:0) S RETURN(1)="-1^Invalid DFN passed into RPC" Q
"RTN","VAFCRPC",36,0)
 ;log patient sensitivity on receiving system and send msg bulletin
"RTN","VAFCRPC",37,0)
 ;D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE AUDIT FROM THE MPI^Remote Audit Query",3) ;IA #3027
"RTN","VAFCRPC",38,0)
 S ARRAY="^TMP(""VAFCHFS"","_$J_")"
"RTN","VAFCRPC",39,0)
 D HFS^VAFCHFS("START^VAFCAUD(DFN,SDT,EDT,1)")
"RTN","VAFCRPC",40,0)
 ;M RETURN=@ARRAY
"RTN","VAFCRPC",41,0)
 D DSPPDAT^VAFCHFS(.RETURN)
"RTN","VAFCRPC",42,0)
 K ^TMP("VAFCHFS",$J)
"RTN","VAFCRPC",43,0)
 Q
"VER")
8.0^22.0
**END**
**END**
