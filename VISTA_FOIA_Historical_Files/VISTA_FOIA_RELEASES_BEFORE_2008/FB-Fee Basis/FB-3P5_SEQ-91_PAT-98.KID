Released FB*3.5*98 SEQ #91
Extracted from mail message
**KIDS**:FB*3.5*98^

**INSTALL NAME**
FB*3.5*98
"BLD",6343,0)
FB*3.5*98^FEE BASIS^0^3061019^y
"BLD",6343,1,0)
^9.61A^3^3^3060814^^^
"BLD",6343,1,1,0)
 
"BLD",6343,1,2,0)
 
"BLD",6343,1,3,0)
NPI Modifications for the Fee Basis package
"BLD",6343,4,0)
^9.64PA^161.2^1
"BLD",6343,4,161.2,0)
161.2
"BLD",6343,4,161.2,2,0)
^9.641^161.24^2
"BLD",6343,4,161.2,2,161.2,0)
FEE BASIS VENDOR  (File-top level)
"BLD",6343,4,161.2,2,161.2,1,0)
^9.6411^41.01^1
"BLD",6343,4,161.2,2,161.2,1,41.01,0)
NPI
"BLD",6343,4,161.2,2,161.24,0)
DATE/TIME OF LAST NPI CHANGE  (sub-file)
"BLD",6343,4,161.2,2,161.24,1,0)
^9.6411^^
"BLD",6343,4,161.2,222)
y^n^p^^^^n^^n
"BLD",6343,4,161.2,224)

"BLD",6343,4,"APDD",161.2,161.2)

"BLD",6343,4,"APDD",161.2,161.2,41.01)

"BLD",6343,4,"APDD",161.2,161.24)

"BLD",6343,4,"B",161.2,161.2)

"BLD",6343,6.3)
54
"BLD",6343,"ABPKG")
n
"BLD",6343,"KRN",0)
^9.67PA^8989.52^19
"BLD",6343,"KRN",.4,0)
.4
"BLD",6343,"KRN",.4,"NM",0)
^9.68A^^
"BLD",6343,"KRN",.401,0)
.401
"BLD",6343,"KRN",.402,0)
.402
"BLD",6343,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",6343,"KRN",.402,"NM",1,0)
FB VENDOR UPDATE    FILE #161.2^161.2^0
"BLD",6343,"KRN",.402,"NM",2,0)
FBAA NEW VENDOR    FILE #161.2^161.2^0
"BLD",6343,"KRN",.402,"NM",3,0)
FBAA EDIT VENDOR    FILE #161.2^161.2^0
"BLD",6343,"KRN",.402,"NM","B","FB VENDOR UPDATE    FILE #161.2",1)

"BLD",6343,"KRN",.402,"NM","B","FBAA EDIT VENDOR    FILE #161.2",3)

"BLD",6343,"KRN",.402,"NM","B","FBAA NEW VENDOR    FILE #161.2",2)

"BLD",6343,"KRN",.403,0)
.403
"BLD",6343,"KRN",.5,0)
.5
"BLD",6343,"KRN",.84,0)
.84
"BLD",6343,"KRN",3.6,0)
3.6
"BLD",6343,"KRN",3.8,0)
3.8
"BLD",6343,"KRN",9.2,0)
9.2
"BLD",6343,"KRN",9.8,0)
9.8
"BLD",6343,"KRN",9.8,"NM",0)
^9.68A^26^15
"BLD",6343,"KRN",9.8,"NM",3,0)
FBAAV0^^0^B39511584
"BLD",6343,"KRN",9.8,"NM",4,0)
FBAAV01^^0^B12040541
"BLD",6343,"KRN",9.8,"NM",5,0)
FBAAV2^^0^B11520151
"BLD",6343,"KRN",9.8,"NM",6,0)
FBAAV5^^0^B47766353
"BLD",6343,"KRN",9.8,"NM",7,0)
FBAAVD^^0^B26287832
"BLD",6343,"KRN",9.8,"NM",15,0)
FBPCR^^0^B63491421
"BLD",6343,"KRN",9.8,"NM",16,0)
FBPCR2^^0^B35427334
"BLD",6343,"KRN",9.8,"NM",17,0)
FBPCR3^^0^B24986170
"BLD",6343,"KRN",9.8,"NM",19,0)
FBMRASVR^^0^B32449112
"BLD",6343,"KRN",9.8,"NM",20,0)
FBAAV1^^0^B29697333
"BLD",6343,"KRN",9.8,"NM",21,0)
FBPCR67^^0^B22170399
"BLD",6343,"KRN",9.8,"NM",22,0)
FBPCR671^^0^B26341228
"BLD",6343,"KRN",9.8,"NM",23,0)
FBAAVD2^^0^B31257059
"BLD",6343,"KRN",9.8,"NM",25,0)
FBNPILK^^0^B2424699
"BLD",6343,"KRN",9.8,"NM",26,0)
FBAAVD4^^0^B21494151
"BLD",6343,"KRN",9.8,"NM","B","FBAAV0",3)

"BLD",6343,"KRN",9.8,"NM","B","FBAAV01",4)

"BLD",6343,"KRN",9.8,"NM","B","FBAAV1",20)

"BLD",6343,"KRN",9.8,"NM","B","FBAAV2",5)

"BLD",6343,"KRN",9.8,"NM","B","FBAAV5",6)

"BLD",6343,"KRN",9.8,"NM","B","FBAAVD",7)

"BLD",6343,"KRN",9.8,"NM","B","FBAAVD2",23)

"BLD",6343,"KRN",9.8,"NM","B","FBAAVD4",26)

"BLD",6343,"KRN",9.8,"NM","B","FBMRASVR",19)

"BLD",6343,"KRN",9.8,"NM","B","FBNPILK",25)

"BLD",6343,"KRN",9.8,"NM","B","FBPCR",15)

"BLD",6343,"KRN",9.8,"NM","B","FBPCR2",16)

"BLD",6343,"KRN",9.8,"NM","B","FBPCR3",17)

"BLD",6343,"KRN",9.8,"NM","B","FBPCR67",21)

"BLD",6343,"KRN",9.8,"NM","B","FBPCR671",22)

"BLD",6343,"KRN",19,0)
19
"BLD",6343,"KRN",19,"NM",0)
^9.68A^^
"BLD",6343,"KRN",19.1,0)
19.1
"BLD",6343,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6343,"KRN",101,0)
101
"BLD",6343,"KRN",409.61,0)
409.61
"BLD",6343,"KRN",771,0)
771
"BLD",6343,"KRN",870,0)
870
"BLD",6343,"KRN",8989.51,0)
8989.51
"BLD",6343,"KRN",8989.52,0)
8989.52
"BLD",6343,"KRN",8994,0)
8994
"BLD",6343,"KRN",8994,"NM",0)
^9.68A^^
"BLD",6343,"KRN","B",.4,.4)

"BLD",6343,"KRN","B",.401,.401)

"BLD",6343,"KRN","B",.402,.402)

"BLD",6343,"KRN","B",.403,.403)

"BLD",6343,"KRN","B",.5,.5)

"BLD",6343,"KRN","B",.84,.84)

"BLD",6343,"KRN","B",3.6,3.6)

"BLD",6343,"KRN","B",3.8,3.8)

"BLD",6343,"KRN","B",9.2,9.2)

"BLD",6343,"KRN","B",9.8,9.8)

"BLD",6343,"KRN","B",19,19)

"BLD",6343,"KRN","B",19.1,19.1)

"BLD",6343,"KRN","B",101,101)

"BLD",6343,"KRN","B",409.61,409.61)

"BLD",6343,"KRN","B",771,771)

"BLD",6343,"KRN","B",870,870)

"BLD",6343,"KRN","B",8989.51,8989.51)

"BLD",6343,"KRN","B",8989.52,8989.52)

"BLD",6343,"KRN","B",8994,8994)

"BLD",6343,"QUES",0)
^9.62^^
"BLD",6343,"REQB",0)
^9.611^10^5
"BLD",6343,"REQB",3,0)
FB*3.5*76^2
"BLD",6343,"REQB",4,0)
FB*3.5*89^2
"BLD",6343,"REQB",6,0)
XU*8.0*410^2
"BLD",6343,"REQB",9,0)
FB*3.5*65^2
"BLD",6343,"REQB",10,0)
FB*3.5*97^2
"BLD",6343,"REQB","B","FB*3.5*65",9)

"BLD",6343,"REQB","B","FB*3.5*76",3)

"BLD",6343,"REQB","B","FB*3.5*89",4)

"BLD",6343,"REQB","B","FB*3.5*97",10)

"BLD",6343,"REQB","B","XU*8.0*410",6)

"FIA",161.2)
FEE BASIS VENDOR
"FIA",161.2,0)
^FBAAV(
"FIA",161.2,0,0)
161.2I
"FIA",161.2,0,1)
y^n^p^^^^n^^n
"FIA",161.2,0,10)

"FIA",161.2,0,11)

"FIA",161.2,0,"RLRO")

"FIA",161.2,0,"VR")
3.5^FB
"FIA",161.2,161.2)
1
"FIA",161.2,161.2,40)

"FIA",161.2,161.2,41.01)

"FIA",161.2,161.24)
0
"KRN",.402,1176,-1)
0^3
"KRN",.402,1176,0)
FBAA EDIT VENDOR^3061011.1333^^161.2^^^3061018
"KRN",.402,1176,"DIAB",1,1,161.225,0)
ALL
"KRN",.402,1176,"DIAB",2,0,161.2,1)
.05;REQ
"KRN",.402,1176,"DIAB",5,0,161.2,2)
22;REQ
"KRN",.402,1176,"DIAB",6,0,161.2,0)
30.06;T
"KRN",.402,1176,"DR",1,161.2)
S FBTV="",FBPARCD="";.01;1;S FBID=X;W !,"Is the ID NUMBER a Tax # or SSN?";30.06T~;6;S FBTV=X;I FBTV=3&(FBID'?9N) W !!,*7,"Pharmacy Vendor ID must be 9 numerics only!!" S Y=1;24;S FBBT=X;25;S:$$VGRP^FBAAUTL6(D0) Y=24;7;S FBPARCD=X;
"KRN",.402,1176,"DR",1,161.2,1)
S:FBTV'=2 Y="@3";.05R~;S Y=2;@3;.05///@;2;2.5;3;4;5;5.5;14;23;30.03////Y;30.05////B;30.04////^S X=$S(FBTV=2:"I",FBTV=10:"F",1:"C");D EN^FBAAVD4;Q;S:FBPARCD=6 Y="@22";S:FBPARCD=14 Y=8;22;S:FBPARCD=5 Y=.18;S:FBTV'=3 Y="";8;S Y="";
"KRN",.402,1176,"DR",1,161.2,2)
@22;30.02;S FBEXMPT=X;S:$G(FBEXMPT)="Y" Y="@23";22R~;S Y="";@23;22;K FBEXMPT S Y="";.18;18;19;20;
"KRN",.402,1176,"DR",2,161.225)
.01
"KRN",.402,1177,-1)
0^2
"KRN",.402,1177,0)
FBAA NEW VENDOR^3061011.1334^^161.2^^^3061013
"KRN",.402,1177,"DIAB",1,1,161.225,0)
ALL
"KRN",.402,1177,"DIAB",3,0,161.2,1)
.05;REQ
"KRN",.402,1177,"DIAB",3,0,161.2,2)
22;REQ
"KRN",.402,1177,"DIAB",6,0,161.2,0)
30.06;T
"KRN",.402,1177,"DR",1,161.2)
S FBPARCD="";.01;1;S FBID=X;W !,"Is the ID NUMBER a Tax # or SSN?";30.06T~;6;S FBTV=X;I FBTV=3&(FBID'?9N) W !!,*7,"Pharmacy Vendor ID must be 9 numerics!" S Y=1;24;S FBBT=X;25;S:$$VGRP^FBAAUTL6(D0) Y=24;S:FBTV=3 FBPARCD=14,Y=2;7;
"KRN",.402,1177,"DR",1,161.2,1)
S FBPARCD=X;S:FBTV'=2 Y=2;.05R~;2;2.5;3;4;5;5.5;14;23;30.03////Y;30.05////B;30.04////^S X=$S(FBTV=2:"I",FBTV=10:"F",1:"C");D EN^FBAAVD4;S:FBPARCD=6 Y="@22";S:FBPARCD=14 Y=8;22;S:FBPARCD=5 Y=.18;S:FBTV'=3 Y="";8;S Y="";@22;30.02;
"KRN",.402,1177,"DR",1,161.2,2)
S FBEXMPT=X;S:FBEXMPT="Y" Y="@23";22R~;S Y="";@23;22;K FBEXMPT S Y="";.18;18;19;20;
"KRN",.402,1177,"DR",2,161.225)
.01
"KRN",.402,1636,-1)
0^1
"KRN",.402,1636,0)
FB VENDOR UPDATE^3060801.0812^^161.2^^^3061018
"KRN",.402,1636,"%D",0)
^^1^1^2931012^^
"KRN",.402,1636,"%D",1,0)
Update Austin vendor information
"KRN",.402,1636,"DR",1,161.2)
S:'$D(Z1) Y="@10";.01////^S X=$P(Z1,U);1////^S X=$P(Z1,U,2);2////^S X=$P(Z1,U,3);3////^S X=$P(Z1,U,4);4////^S X=$P(Z1,U,5);5////^S X=$P(Z1,U,6);6////^S X=$P(Z1,U,7);.05////^S X=$P(Z1,U,8);7////^S X=$P(Z1,U,9);8////^S X=$P(Z1,U,10);
"KRN",.402,1636,"DR",1,161.2,1)
5.5////^S X=$P(Z1,U,13);2.5////@;2.5////^S X=$P(Z1,U,14);41.01////^S X=Z6;Q;22////^S X=$P(Z1,U,17);5.18////^S X=$P(Z1,U,18);@10;S:'$D(Z3) Y="@20";14////^S X=$P(Z3,U,1);24////@;24////^S X=$P(Z3,U,10);@20;S:'$D(Z4) Y="";
"KRN",.402,1636,"DR",1,161.2,2)
S:$G(FBTMPCK) Y="@30";30.01////^S X=$P(Z4,U);@30;30.02////^S X=$P(Z4,U,2);30.03////^S X=$P(Z4,U,3);30.04////^S X=$P(Z4,U,4);30.05////^S X=$P(Z4,U,5);30.06////^S X=$P(Z4,U,6);
"KRN",.402,1636,"ROU")
^FBCTV
"KRN",.402,1636,"ROUOLD")
FBCTV
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5
"PKG",60,22,1,"PAH",1,0)
98^3061019^18148
"PKG",60,22,1,"PAH",1,1,0)
^^3^3^3061019
"PKG",60,22,1,"PAH",1,1,1,0)
 
"PKG",60,22,1,"PAH",1,1,2,0)
 
"PKG",60,22,1,"PAH",1,1,3,0)
NPI Modifications for the Fee Basis package
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","FBAAV0")
0^3^B39511584^B38746071
"RTN","FBAAV0",1,0)
FBAAV0 ;AISC/GRR-ELECTRONICALLY TRANSMIT FEE DATA ;11 Apr 2006  2:51 PM
"RTN","FBAAV0",2,0)
 ;;3.5;FEE BASIS;**3,4,55,89,98**;JAN 30, 1995;Build 54
"RTN","FBAAV0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAV0",4,0)
 K ^TMP($J,"FBAABATCH"),^TMP($J,"FBVADAT") D DT^DICRW
"RTN","FBAAV0",5,0)
 I '$D(^FBAA(161.7,"AC","S")),'$D(^FBAA(161.7,"AC","R")),'$D(^FBAA(161.25,"AE")),$S('$D(^FBAA(161.26,"AC","P")):1,$O(^FBAA(161.26,"AC","P",0))'>0:1,1:0) W !,*7,"There are no transactions requiring transmission",*7 Q
"RTN","FBAAV0",6,0)
 W !!,"This option will transmit all Batches and MRA's ready to be transmitted",!,"to Austin"
"RTN","FBAAV0",7,0)
RD W !! S DIR(0)="Y",DIR("A")="Are you sure you want to continue",DIR("B")="No" D ^DIR K DIR G END:'Y
"RTN","FBAAV0",8,0)
 L +^FBAA(161.7,"AC"):0 G:'$T LOCK^FBAAUTL1
"RTN","FBAAV0",9,0)
 W !!,"The following Batches will be transmitted: " F FBSTAT="S","R" F J=0:0 S J=$O(^FBAA(161.7,"AC",FBSTAT,J)) Q:J'>0  S FBATCH=$G(^FBAA(161.7,J,0)) D
"RTN","FBAAV0",10,0)
 .Q:'+FBATCH
"RTN","FBAAV0",11,0)
 .I (FBSTAT="S"&($P(FBATCH,U,15)="Y"))!(+$P(FBATCH,U,9)) S ^TMP($J,"FBAABATCH",J)="" W !,+FBATCH
"RTN","FBAAV0",12,0)
RTRAN ;Entry from Re-transmit MRA routine
"RTN","FBAAV0",13,0)
 D ADDRESS^FBAAV01 G END:VATERR K VAT
"RTN","FBAAV0",14,0)
 D WAIT^DICD,STATION^FBAAUTL,HD^FBAAUTL I $D(FB("ERROR")) G END
"RTN","FBAAV0",15,0)
 S TOTSTR=0,$P(PAD," ",200)=" "
"RTN","FBAAV0",16,0)
 D ^FBAAV1:$D(^FBAA(161.25,"AE"))
"RTN","FBAAV0",17,0)
 D ^FBAAV4:$D(^FBAA(161.26,"AC","P"))
"RTN","FBAAV0",18,0)
 F J=0:0 S J=$O(^TMP($J,"FBAABATCH",J)) Q:J'>0  I $D(^FBAA(161.7,J,0)) S Y(0)=^(0) D SET1,DET:FBAABT="B3",DETP^FBAAV2:FBAABT="B5",DETT^FBAAV3:FBAABT="B2",^FBAAV5:FBAABT="B9"
"RTN","FBAAV0",19,0)
END L -^FBAA(161.7,"AC") D KILL^FBAAV1 Q
"RTN","FBAAV0",20,0)
SET1 ; build the payment batch header string (used by all four formats)
"RTN","FBAAV0",21,0)
 S FBAABN=$P(Y(0),"^",1),FBAABN=$E("00000",$L(FBAABN)+1,5)_FBAABN
"RTN","FBAAV0",22,0)
 S FBAAON=$E($P(Y(0),"^",2),3,6)
"RTN","FBAAV0",23,0)
 S FBAACD=$$AUSDT^FBAAV3(DT)
"RTN","FBAAV0",24,0)
 S FBAACP=$E($P(Y(0),"^",2),1,2)
"RTN","FBAAV0",25,0)
 S FBAABT=$P(Y(0),"^",3)
"RTN","FBAAV0",26,0)
 S FBAAAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),10)
"RTN","FBAAV0",27,0)
 S FBSTAT=$P(^FBAA(161.7,J,"ST"),"^")
"RTN","FBAAV0",28,0)
 S FBCHB=$P(Y(0),"^",15)
"RTN","FBAAV0",29,0)
 S FBEXMPT=$P(Y(0),"^",18)
"RTN","FBAAV0",30,0)
 S X=$$SUB^FBAAUTL5(+$P(Y(0),U,8)_"-"_$P(Y(0),U,2))
"RTN","FBAAV0",31,0)
 S FBAASN=$$LJ^XLFSTR($S(X]"":X,1:FBAASN),6," ")
"RTN","FBAAV0",32,0)
 I FBSTAT="R"!(FBSTAT="S"&(FBCHB'["Y"))!(FBSTAT="S"&($G(FBEXMPT)="Y")) S FBSTR=FBHD_$S(FBAABT="B2":"BT",1:FBAABT)_FBAACD_FBAASN_FBAABN_"  "_FBAAAP_FBAACP_" $"
"RTN","FBAAV0",33,0)
 Q
"RTN","FBAAV0",34,0)
DET ;entry point to process B3 (outpatient/ancillary) batch
"RTN","FBAAV0",35,0)
 ; input (partial list)
"RTN","FBAAV0",36,0)
 ;   J      - Batch IEN in file 161.7
"RTN","FBAAV0",37,0)
 ;   FBAAON - last 4 of obligation number
"RTN","FBAAV0",38,0)
 ;   FBAASN - station number (formatted)
"RTN","FBAAV0",39,0)
 S FBTXT=0
"RTN","FBAAV0",40,0)
 D CKB3V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV0",41,0)
 F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"",+$P(Y(0),U,3) D
"RTN","FBAAV0",42,0)
 .N FBDTSR1,FBPICN
"RTN","FBAAV0",43,0)
 .S FBDTSR1=+$G(^FBAAC(K,1,L,1,M,0))
"RTN","FBAAV0",44,0)
 .S FBPICN=K_U_L_U_M_U_N
"RTN","FBAAV0",45,0)
 .S FBY=$G(^FBAAC(K,1,L,1,M,1,N,2))
"RTN","FBAAV0",46,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD
"RTN","FBAAV0",47,0)
 .D GOT
"RTN","FBAAV0",48,0)
 ;
"RTN","FBAAV0",49,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV0",50,0)
 Q
"RTN","FBAAV0",51,0)
 ;
"RTN","FBAAV0",52,0)
GOT ; process a B3 line item
"RTN","FBAAV0",53,0)
 ;
"RTN","FBAAV0",54,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBADMIT,FBAUTHF,FBIENS
"RTN","FBAAV0",55,0)
 N FBMOD1,FBMOD2,FBMOD3,FBMOD4,FBPNAMX,FBUNITS,FBX,FBNPI
"RTN","FBAAV0",56,0)
 ;
"RTN","FBAAV0",57,0)
 S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV0",58,0)
 ;
"RTN","FBAAV0",59,0)
 ; get CPT modifiers
"RTN","FBAAV0",60,0)
 D
"RTN","FBAAV0",61,0)
 . N FBMODA,FBMODL
"RTN","FBAAV0",62,0)
 . D MODDATA^FBAAUTL4(K,L,M,N)
"RTN","FBAAV0",63,0)
 . S FBMODL=$$MODL^FBAAUTL4("FBMODA","E")
"RTN","FBAAV0",64,0)
 . S FBMOD1=$$RJ^XLFSTR($P(FBMODL,",",1),5," ")
"RTN","FBAAV0",65,0)
 . S FBMOD2=$$RJ^XLFSTR($P(FBMODL,",",2),5," ")
"RTN","FBAAV0",66,0)
 . S FBMOD3=$$RJ^XLFSTR($P(FBMODL,",",3),5," ")
"RTN","FBAAV0",67,0)
 . S FBMOD4=$$RJ^XLFSTR($P(FBMODL,",",4),5," ")
"RTN","FBAAV0",68,0)
 ;
"RTN","FBAAV0",69,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV0",70,0)
 ;
"RTN","FBAAV0",71,0)
 S FBVID=$P($G(^FBAAV(L,0)),U,2)
"RTN","FBAAV0",72,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV0",73,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV0",74,0)
 S FBNPI=$$EN^FBNPILK(L)  ;SET THE NPI TO BE PASSED TO FBAAV01,FBAAV2,FBAAV5
"RTN","FBAAV0",75,0)
 ;
"RTN","FBAAV0",76,0)
 D POV^FBAAUTL2
"RTN","FBAAV0",77,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV)
"RTN","FBAAV0",78,0)
 S POV=$S(POV']"":99,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:99)
"RTN","FBAAV0",79,0)
 S FBPOV=POV
"RTN","FBAAV0",80,0)
 S FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV0",81,0)
 S FBCPT=$$CPT^FBAAUTL4($P(Y(0),"^")),FBCPT=$S($L(FBCPT)=5:FBCPT,1:"     ")
"RTN","FBAAV0",82,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(0),U,12),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV0",83,0)
 S FBPATT=$P(Y(0),"^",17),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV0",84,0)
 S FBTD=$$AUSDT^FBAAV3(FBDTSR1) ; formatted treatment date
"RTN","FBAAV0",85,0)
 S FBSUSP=$P(Y(0),"^",5),FBSUSP=$S(FBSUSP]"":FBSUSP,1:" ")
"RTN","FBAAV0",86,0)
 S FBSUSP=$S(FBSUSP=" ":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV0",87,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",3),8) ; amount paid
"RTN","FBAAV0",88,0)
 S FBPOS=+$P(Y(0),"^",25),FBPOS=$S(FBPOS:$P(^IBE(353.1,FBPOS,0),"^"),1:"  ")
"RTN","FBAAV0",89,0)
 S FBHCFA=+$P(Y(0),"^",26),FBHCFA=$S(FBHCFA:$P(^IBE(353.2,FBHCFA,0),"^"),1:""),FBHCFA=$E(PAD,$L(FBHCFA)+1,2)_FBHCFA
"RTN","FBAAV0",90,0)
 S FBVTOS=+$P(Y(0),"^",24),FBVTOS=$S(FBVTOS:$P(^FBAA(163.85,FBVTOS,0),"^",2),1:"  ")
"RTN","FBAAV0",91,0)
 S FBPD=+$P(Y(0),"^",23),FBPD=$S(FBPD:$$ICD9^FBCSV1(FBPD,$G(FBDTSR1)),1:""),FBPD=$E(PAD,$L(FBPD)+1,7)_FBPD
"RTN","FBAAV0",92,0)
 S FBINVN=$P(Y(0),"^",16)
"RTN","FBAAV0",93,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV0",94,0)
 S FBAUTHF=$S($P(Y(0),U,13)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV0",95,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",15)) ; invoice date rec'd
"RTN","FBAAV0",96,0)
 S FBADMIT=$$AUSDT^FBAAV3($$B3ADMIT(FBIENS)) ; formatted admission date
"RTN","FBAAV0",97,0)
 ;
"RTN","FBAAV0",98,0)
 S VAPA("P")=""
"RTN","FBAAV0",99,0)
 S DFN=K
"RTN","FBAAV0",100,0)
 ; Note - before this point Y(0) was the 0 node of subfile #162.03
"RTN","FBAAV0",101,0)
 ;      - after this point Y(0) will be the 0 node of file #2
"RTN","FBAAV0",102,0)
 S Y(0)=$G(^DPT(+K,0)) Q:Y(0)']""
"RTN","FBAAV0",103,0)
 D PAT^FBAAUTL2
"RTN","FBAAV0",104,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV0",105,0)
 ; the value returned from it
"RTN","FBAAV0",106,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3)) ; date of birth
"RTN","FBAAV0",107,0)
 D ADD^VADPT
"RTN","FBAAV0",108,0)
 S FBPNAMX=$$HL7NAME^FBAAV4(DFN) ; patient name
"RTN","FBAAV0",109,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAV0",110,0)
 S:FBUNITS<1 FBUNITS=1
"RTN","FBAAV0",111,0)
 S FBUNITS=$$RJ^XLFSTR(FBUNITS,5,0) ; volume indicator (units paid)
"RTN","FBAAV0",112,0)
 ;
"RTN","FBAAV0",113,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV0",114,0)
 D LOADADJ^FBAAFA(FBIENS,.FBADJ)
"RTN","FBAAV0",115,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV0",116,0)
 S FBADJR1=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV0",117,0)
 S FBADJA1=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV0",118,0)
 S FBADJR2=$$RJ^XLFSTR($P(FBX,U,4),5," ")
"RTN","FBAAV0",119,0)
 S FBADJA2=$$AUSAMT^FBAAV3($P(FBX,U,6),9,1)
"RTN","FBAAV0",120,0)
 K FBADJ,FBX
"RTN","FBAAV0",121,0)
 ;
"RTN","FBAAV0",122,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV0",123,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV0",124,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV0",125,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV0",126,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV0",127,0)
 D STRING^FBAAV01
"RTN","FBAAV0",128,0)
 Q
"RTN","FBAAV0",129,0)
 ;
"RTN","FBAAV0",130,0)
UPD ; update the batch file
"RTN","FBAAV0",131,0)
 N Y
"RTN","FBAAV0",132,0)
 S DA=J,(DIC,DIE)="^FBAA(161.7,"
"RTN","FBAAV0",133,0)
 S DR="11////^S X=""T"";12////^S X=DT"
"RTN","FBAAV0",134,0)
 D ^DIE
"RTN","FBAAV0",135,0)
 Q
"RTN","FBAAV0",136,0)
 ;
"RTN","FBAAV0",137,0)
STORE D STORE^FBAAV01 Q
"RTN","FBAAV0",138,0)
 ;
"RTN","FBAAV0",139,0)
B3ADMIT(FBIENS) ; Determine Admission Date for a B3 payment line item
"RTN","FBAAV0",140,0)
 ; input
"RTN","FBAAV0",141,0)
 ;   FBIENS - IENS (FileMan format) for subfile 162.03 entry
"RTN","FBAAV0",142,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV0",143,0)
 ;
"RTN","FBAAV0",144,0)
 N FB7078,FBRET
"RTN","FBAAV0",145,0)
 S FBRET=""
"RTN","FBAAV0",146,0)
 S FB7078=$$GET1^DIQ(162.03,FBIENS,27,"I") ; associated 7078/583
"RTN","FBAAV0",147,0)
 ; (the unauthorized ancillary claims will have the treatment date
"RTN","FBAAV0",148,0)
 ;  instead of the inpatient admission date so nothing is sent to
"RTN","FBAAV0",149,0)
 ;  Austin for them)
"RTN","FBAAV0",150,0)
 ;
"RTN","FBAAV0",151,0)
 ; if line items points to a 7078 authorization then return a date
"RTN","FBAAV0",152,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV0",153,0)
 . N FBY
"RTN","FBAAV0",154,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV0",155,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV0",156,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV0",157,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV0",158,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV0",159,0)
 ;
"RTN","FBAAV0",160,0)
 Q FBRET
"RTN","FBAAV01")
0^4^B12040541^B12070120
"RTN","FBAAV01",1,0)
FBAAV01 ;AISC/GRR-ELECTRONICALLY TRANSMIT FEE DATA CONTINUED ;11 Apr 2006  2:52 PM
"RTN","FBAAV01",2,0)
 ;;3.5;FEE BASIS;**89,98**,JAN 30, 1995;;Build 54
"RTN","FBAAV01",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAV01",4,0)
NEWMSG ;get new message number, reset line counter
"RTN","FBAAV01",5,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",6,0)
 ;FBOKTX=1 if message pending, 0 otherwise
"RTN","FBAAV01",7,0)
 S FBXMZ=0,FBJ=$G(J),FBK=$G(K) S:'$D(FBFEE) FBFEE=1 S:'$D(FBNVP) FBNVP=1
"RTN","FBAAV01",8,0)
 S XMSUB=$S('$D(FBFLAG):"FEE BASIS MESSAGE # "_FBFEE,1:"FEE NON-VA HOSP TO PRICER MESSAGE # "_FBNVP),XMDUZ=DUZ
"RTN","FBAAV01",9,0)
 S FBOKTX=0
"RTN","FBAAV01",10,0)
 D XMZ^XMA2
"RTN","FBAAV01",11,0)
 I '$D(XMZ)!(XMZ'>0) G NEWMSG
"RTN","FBAAV01",12,0)
 S FBXMZ=XMZ,FBLN=0,FBOKTX=1,J=FBJ,K=FBK K XMZ
"RTN","FBAAV01",13,0)
 Q
"RTN","FBAAV01",14,0)
 ;
"RTN","FBAAV01",15,0)
XMIT ;send message, increment message counter
"RTN","FBAAV01",16,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",17,0)
 ;FBXMFEE(=FEE recipient array, FBXMNVP(=NVP recipient array
"RTN","FBAAV01",18,0)
 S FBJ=J,FBK=K K XMY D ROUT
"RTN","FBAAV01",19,0)
 S XMZ=FBXMZ,^XMB(3.9,XMZ,2,0)="^3.92A^"_FBLN_"^"_FBLN_"^"_DT
"RTN","FBAAV01",20,0)
 S XMDUN=$P(^VA(200,DUZ,0),U) D ENT1^XMD
"RTN","FBAAV01",21,0)
 S FBLN=0,FBOKTX=0
"RTN","FBAAV01",22,0)
 D INCRM ;increment message counter
"RTN","FBAAV01",23,0)
 S J=FBJ,K=FBK
"RTN","FBAAV01",24,0)
 Q
"RTN","FBAAV01",25,0)
 ;
"RTN","FBAAV01",26,0)
ROUT ;set up recipients for message
"RTN","FBAAV01",27,0)
 I $D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMNVP(FBI)) Q:'FBI  S X=FBXMNVP(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",28,0)
 I '$D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMFEE(FBI)) Q:'FBI  S X=FBXMFEE(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",29,0)
 S XMY(DUZ)="",XMDUZ=DUZ Q
"RTN","FBAAV01",30,0)
 ;
"RTN","FBAAV01",31,0)
INCRM ;increment message counter
"RTN","FBAAV01",32,0)
 I $D(FBFLAG) S FBNVP=FBNVP+1
"RTN","FBAAV01",33,0)
 E  S FBFEE=FBFEE+1
"RTN","FBAAV01",34,0)
 Q
"RTN","FBAAV01",35,0)
 ;
"RTN","FBAAV01",36,0)
INCRL ;increment line counter
"RTN","FBAAV01",37,0)
 S FBLN=FBLN+1 Q
"RTN","FBAAV01",38,0)
 ;
"RTN","FBAAV01",39,0)
STORE ;set message string
"RTN","FBAAV01",40,0)
 D INCRL S ^XMB(3.9,FBXMZ,2,FBLN,0)=FBSTR
"RTN","FBAAV01",41,0)
 Q
"RTN","FBAAV01",42,0)
 ;
"RTN","FBAAV01",43,0)
ADDRESS ;set up recipient array, FBXMFEE( for FEE router, FBXMNVP( for NVP router
"RTN","FBAAV01",44,0)
 F VATNAME="FEE","NVP" D ^VATRAN G:VATERR ADDQ S FBI=0 F  S FBI=$O(VAT(FBI)) Q:'FBI  S FBVAR="FBXM"_VATNAME_"("_FBI_")" S @FBVAR=VAT(FBI)
"RTN","FBAAV01",45,0)
ADDQ Q
"RTN","FBAAV01",46,0)
 ;Following checks for Austin Name Field in Vendor file in order to continue transmitting that batch.
"RTN","FBAAV01",47,0)
CKB3V F FB1=0:0 S FB1=$O(^FBAAC("AC",J,FB1)) Q:'FB1!($G(FBERR))  F FB2=0:0 S FB2=$O(^FBAAC("AC",J,FB1,FB2)) Q:FB2'>0!($G(FBERR))  D CHKV
"RTN","FBAAV01",48,0)
 Q
"RTN","FBAAV01",49,0)
CKB5V F FB1=0:0 S FB1=$O(^FBAA(162.1,"AE",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAA(162.1,FB1,0)) S FB2=+$P(^(0),"^",4) D CHKV
"RTN","FBAAV01",50,0)
 Q
"RTN","FBAAV01",51,0)
CKB9V F FB1=0:0 S FB1=$O(^FBAAI("AC",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAAI(FB1,0)) S FB2=+$P(^(0),"^",3) D CHKV
"RTN","FBAAV01",52,0)
 Q
"RTN","FBAAV01",53,0)
CHKV I $$CKVEN^FBAADV(FB2) W !!,*7,"VENDOR: ",$$VNAME^FBNHEXP(FB2)," Not approved in Austin yet.",!,"Batch # ",FBAABN," CANNOT BE TRANSMITTED!!!" S FBERR=1
"RTN","FBAAV01",54,0)
 Q
"RTN","FBAAV01",55,0)
 ;
"RTN","FBAAV01",56,0)
STRING ;called from FBAAV0 to build 'B3' payment record
"RTN","FBAAV01",57,0)
 ;
"RTN","FBAAV01",58,0)
 S FBPICN=$$PADZ(FBPICN,30)
"RTN","FBAAV01",59,0)
 ;
"RTN","FBAAV01",60,0)
 ; build and store 1st line in message
"RTN","FBAAV01",61,0)
 S FBSTR=3_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP_FBPOV_FBPATT_FBTD_FBTT_FBDIN_FBINVN_FBST_FBCTY_FBZIP_$E(FBPSA,1,3)_FBCPT_FBPOS_FBHCFA_FBVTOS_FBPD
"RTN","FBAAV01",62,0)
 S FBSTR=FBSTR_+$P($G(FBY),U,2)_$E(PAD,1,8)_FBPICN_$S(+FBY:$$AUSDT^FBAAV3(+FBY),1:FBDIN)
"RTN","FBAAV01",63,0)
 S FBSTR=FBSTR_FBADMIT_FBDOB_FBUNITS_FBAUTHF_FBMOD1_FBMOD2_FBMOD3_FBMOD4_FBADJR1_FBADJR2_"~"
"RTN","FBAAV01",64,0)
 D STORE
"RTN","FBAAV01",65,0)
 ;
"RTN","FBAAV01",66,0)
 ; build and store 2nd line in message
"RTN","FBAAV01",67,0)
 S FBSTR=FBADJA1_FBADJA2_FBNPI_"~$"
"RTN","FBAAV01",68,0)
 D STORE
"RTN","FBAAV01",69,0)
 ;
"RTN","FBAAV01",70,0)
 K FBPICN,FBY
"RTN","FBAAV01",71,0)
 Q
"RTN","FBAAV01",72,0)
 ;
"RTN","FBAAV01",73,0)
PADZ(X,Y) ;call to pad 'X' with leading zeros' to a field length of 'Y'
"RTN","FBAAV01",74,0)
 ;
"RTN","FBAAV01",75,0)
 I $S('$L(X):1,'Y:1,Y<$L(X):1,1:0) Q ""
"RTN","FBAAV01",76,0)
 N Z S Z=0,$P(Z,0,Y)=0
"RTN","FBAAV01",77,0)
 Q $E(Z,$L(X)+1,Y)_X
"RTN","FBAAV1")
0^20^B29697333^B29225516
"RTN","FBAAV1",1,0)
FBAAV1 ;AISC/GRR-ELECTRONICALLY TRANSMIT FEE (VENDOR MRA'S) PART 2 ;07/18/06
"RTN","FBAAV1",2,0)
 ;;3.5;FEE BASIS;**10,36,39,98**;JAN 30, 1995;Build 54
"RTN","FBAAV1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAV1",4,0)
 S (ZMCNT,ZPCNT,FB("M"),FB("P"))=0
"RTN","FBAAV1",5,0)
 ;D STATION^FBAAUTL,HD^FBAAUTL Q:$D(FB("ERROR"))
"RTN","FBAAV1",6,0)
 S FBTXT=0
"RTN","FBAAV1",7,0)
 F J="O","P" I $D(^FBAA(161.25,"AE",J)) F K=0:0 S K=$O(^FBAA(161.25,"AE",J,K)) Q:K'>0  S FBTC=$G(^FBAA(161.25,K,0)),FBTC=$S(FBTC']"":"N",J="P":$P(FBTC,U,2),J="O":$P(FBTC,U,3),1:"N") S Y(0)=$G(^FBAAV(K,0)) I Y(0)]"" D
"RTN","FBAAV1",8,0)
 .S Y(1)=$G(^FBAAV(K,"ADEL")),Y(2)=$G(^FBAAV(K,"AMS")),Y(3)=$G(^FBAAV(K,1)) D GETGRP^FBAAUTL6(K,5)
"RTN","FBAAV1",9,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01
"RTN","FBAAV1",10,0)
 .D GOT
"RTN","FBAAV1",11,0)
 D:+$G(FBOKTX) XMIT^FBAAV01 Q
"RTN","FBAAV1",12,0)
GOT S FBNAME=$P(Y(0),"^",1),FBNAME=$S(FBNAME[",":$E($P(FBNAME,",",2),1)_" "_$E($P(FBNAME,",",2),$F($P(FBNAME,",",2)," "))_$S($F($P(FBNAME,",",2)," "):" ",1:"  ")_$P(FBNAME,",",1),1:FBNAME)
"RTN","FBAAV1",13,0)
 S FBNAME=$S($L(FBNAME)<30:FBNAME_$E(PAD,$L(FBNAME)+1,30),1:$E(FBNAME,1,30)),FBID=$P(Y(0),"^",2),FBID=FBID_$E(PAD,$L(FBID)+1,11),FBPART=$P(Y(0),"^",7),FBSN=FBSN_$E("      ",$L(FBSN)+1,6)
"RTN","FBAAV1",14,0)
 S FBSC=$S($P(Y(0),"^",8)]"":$P(Y(0),"^",8),1:"  "),FBSC=$S(FBSC="  ":FBSC,$D(^FBAA(161.6,FBSC,0)):$P(^(0),"^",2),1:"  "),FBTC=$S(FBTC]"":FBTC,1:"N"),OCDT=$S(Y(1)]"":$P(Y(1),"^",2),1:"")
"RTN","FBAAV1",15,0)
 S FBPC=$S($P(Y(0),"^",9)]"":$P(Y(0),"^",9),1:"  "),FBPC=$S(FBPC="  ":FBPC,$D(^FBAA(161.81,FBPC,0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV1",16,0)
 S FBTC=$S(FBTC="N":"A",1:FBTC),FBAD=$P(Y(0),"^",3),FBAD=FBAD_$E(PAD,$L(FBAD)+1,30),FBAD1=$P(Y(0),"^",14),FBAD1=FBAD1_$E(PAD,$L(FBAD1)+1,30),FBCITY=$E($P(Y(0),"^",4),1,19),FBCITY=FBCITY_$E(PAD,$L(FBCITY)+1,19)
"RTN","FBAAV1",17,0)
 S FBSTCD=$P(Y(0),"^",5),FBSTATE=$S(FBSTCD']"":"  ",$D(^DIC(5,FBSTCD,0)):$P(^(0),"^",2),1:"  "),FBSTATE=$S($L(FBSTATE)'=2:"  ",1:FBSTATE),FBZIP=$P(Y(0),"^",6),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV1",18,0)
 S FBMRC=$P(Y(0),"^",18),FBMRC=$S(FBMRC]"":FBMRC,1:"  "),FBCHAIN=$P(Y(0),"^",10),FBCHAIN=$E("0000",$L(FBCHAIN)+1,4)_FBCHAIN
"RTN","FBAAV1",19,0)
 S STCC=$P(Y(0),"^",13),FBCC="000" I STCC]"",FBSTCD]"" S FBCC=$S($D(^DIC(5,FBSTCD,1,STCC,0)):$P(^(0),"^",3),1:"000")
"RTN","FBAAV1",20,0)
 S FBCC=$E("000",$L(FBCC)+1,3)_FBCC,FBRT=$S(J="P":4,1:1),FBICN=$E(FBSN,1,3)_K,FBICN=$E("000000000000000",$L(FBICN)+1,15)_FBICN,FBTID=$P(Y(2),"^",6),FBTID=$S(FBTID]"":FBTID,1:"T"),FBFMST=$P(Y(2),"^",4),FBFMST=$S(FBFMST]"":FBFMST,1:"C")
"RTN","FBAAV1",21,0)
 S FBNPI=$$EN^FBNPILK(K)
"RTN","FBAAV1",22,0)
 ; pad FPDS data
"RTN","FBAAV1",23,0)
 S FBBT=$S($P(Y(3),U,10)]"":$P(Y(3),U,10),1:" ")_" "
"RTN","FBAAV1",24,0)
 F I=1:1:5 S FBSG(I)=$G(FBSG(I))_$E("  ",1,2-$L($G(FBSG(I))))
"RTN","FBAAV1",25,0)
 ;
"RTN","FBAAV1",26,0)
 D SETP:J="P",SETM:J="O",UPDT
"RTN","FBAAV1",27,0)
 ;S ^FBAA(161.25,"AD","T",K)="",$P(^FBAA(161.25,K,0),"^",3)="T" K ^FBAA(161.25,"AD",J,K)
"RTN","FBAAV1",28,0)
 D STORE Q
"RTN","FBAAV1",29,0)
SETM S ZMCNT=ZMCNT+1 D:FB("M")=0!(ZMCNT>100) BHEDM S FBSTR=FBRT_FBTC_FBSN_FBID_"  "
"RTN","FBAAV1",30,0)
 I FBTC="D"!(FBTC="R") S FBSTR=FBSTR_"$" Q
"RTN","FBAAV1",31,0)
 S FBSTR=FBSTR_"1"_FBSC_FBPC_FBNAME_FBAD_FBAD1_FBCITY_FBSTATE_FBZIP_FBMRC_FBCC_"B"_FBTID_"Y"_FBFMST_FBICN_FBBT_FBSG(1)_FBSG(2)_FBSG(3)_FBSG(4)_FBSG(5)_FBNPI_"$"
"RTN","FBAAV1",32,0)
 Q
"RTN","FBAAV1",33,0)
SETP S ZPCNT=ZPCNT+1 D:FB("P")=0!(ZPCNT>100) BHEDP S FBSTR=FBRT_FBTC_FBSN_$E(FBID,1,9)_FBCHAIN
"RTN","FBAAV1",34,0)
 I FBTC="D"!(FBTC="R") S FBSTR=FBSTR_"$" Q
"RTN","FBAAV1",35,0)
 S FBSTR=FBSTR_"1"_FBNAME_FBAD_FBAD1_FBCITY_FBSTATE_FBZIP_FBMRC_FBCC_"B"_FBTID_"Y"_FBFMST_FBICN_FBBT_FBSG(1)_FBSG(2)_FBSG(3)_FBSG(4)_FBSG(5)_FBNPI_"$"
"RTN","FBAAV1",36,0)
 Q
"RTN","FBAAV1",37,0)
BHEDM S BTYPE="M" D GETB S FB("M")=1,FBSTR=FBHD_"C1"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBNM_"$" D STORE S ZMCNT=1 Q
"RTN","FBAAV1",38,0)
BHEDP S BTYPE="P" D GETB S FB("P")=1,FBSTR=FBHD_"C4"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBNP_"$" D STORE S ZPCNT=1 Q
"RTN","FBAAV1",39,0)
UPDT L +^FBAA(161.25,K) K ^FBAA(161.25,"AE",J,K)
"RTN","FBAAV1",40,0)
 ;I $D(^FBAA(161.25,"AE",$S(J="P":"O",1:"P"),K)) S $P(^FBAA(161.25,K,0),"^",3)="N" L -^FBAA(161.25,K) Q  ;commented out since don't know why it is set
"RTN","FBAAV1",41,0)
 ;K:OCDT]"" ^FBAAV("AC",OCDT,K) S $P(^FBAAV(K,0),"^",15)=DT,^FBAAV("AC",DT,K)="" L -^FBAA(161.25,K)
"RTN","FBAAV1",42,0)
 S DA=K,(DIC,DIE)="^FBAA(161.25,",DR="4///^S X=DT" D ^DIE L -^FBAA(161.25,K)
"RTN","FBAAV1",43,0)
 S DIE="^FBAAV(",DA=K,DR="12///^S X=DT" D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAAV(DA)
"RTN","FBAAV1",44,0)
 K DA,DIE,DR,FBLOCK Q
"RTN","FBAAV1",45,0)
GETB D GETNXB^FBAAUTL
"RTN","FBAAV1",46,0)
 I BTYPE="M" S FBZBNM=$E("00000",$L(FBBN)+1,5)_FBBN Q
"RTN","FBAAV1",47,0)
 I BTYPE="P" S FBZBNP=$E("00000",$L(FBBN)+1,5)_FBBN
"RTN","FBAAV1",48,0)
 Q
"RTN","FBAAV1",49,0)
STORE I TOTSTR+$L(FBSTR)>13900!(ZMCNT>100)!(ZPCNT>100) S TOTSTR=0 D XMIT^FBAAV01,NEWMSG^FBAAV01 S FBTMP=FBSTR D BHEDM:J="O",BHEDP:J="P" S FBSTR=FBTMP K FBTMP
"RTN","FBAAV1",50,0)
 S TOTSTR=TOTSTR+$L(FBSTR) D STORE^FBAAV01
"RTN","FBAAV1",51,0)
 Q
"RTN","FBAAV1",52,0)
KILL K FBATCH,FBCHB,J,K,L,M,N,FBAABN,FBAAON,FBAASN,FBAACP,FBAACD,FBAABT,FBAAAP,FBSTR,PAD,PAD1,FBPAYT,FBVID,FBPOV,FBTT,FBPATT,FBTD,FBSUSP,FBAP,FBEXMPT,FBFNI,FBFNY,^TMP($J)
"RTN","FBAAV1",53,0)
 K A,FBTYPE,DO,DI,DIC,DIE,DOD,DQ,ER,FBADD,FBAUTH,FBBD,FBBN,FBCHAIN,FBFDC,FBFLNAM,FBFR,FBLNAM,FBMST,FBRECT,FBRT,FBSEX,FBSTAT,FBSTCD,FBTC,FBTO,BTYPE,POS,POV,POW,STCC,STCD,T,TOTSTR,XMKK,XMLOCK,XMR,XMSUB,XMT,XMTEXT,XMZ,ZMCNT,ZPCNT
"RTN","FBAAV1",54,0)
 K FBINVN,FBDIN,FBSSN,FBNAME,FBLNAME,FBFI,FBMI,XMDUZ,DA,DR,X,Y,FBPART,FBC,FBSN,FBID,FEEO,FBSC,FBPC,FBAD,FBCITY,FBSTATE,FBZIP,FBCC,FBZBN,FBZBNM,FBZBNP,FB,D,Z,Q,VAT,VATERR,VATNAME,FBSDI
"RTN","FBAAV1",55,0)
 K FBCTY,FBDX,FBFTD,FBPRC,FBPSA,FBST,OCDT,X1,X2,FB7078,FBBILL,FBCLAIM,FBCTY,FBDISP,FBDOB,FBFDT,FBJ,FBLOS,FBMED,FBPART1,FBSTABR,FBTDT,FBTTD,FBVEN,PAD,VAPA,FBSITE,FBK,FBNPI
"RTN","FBAAV1",56,0)
 K FB0,FBFEE,FBHD,FBI,FBLN,FBNVP,FBOKTX,FBTXT,FBVAR,FBXMFEE,FBXMNVP,FBXMZ,XMDUN,FBRESUB,FBAD1,FBFMST,FBICN,FBMRC,FBTID,FBPOP,FBCPT,FBHCFA,FBPD,FBPOS,FBVTOS,FBAC,FBCSN,FBRX,FBVFN
"RTN","FBAAV1",57,0)
 Q
"RTN","FBAAV2")
0^5^B11520151^B11336306
"RTN","FBAAV2",1,0)
FBAAV2 ;AISC/GRR-ELECTRONICALLY TRANSMIT PHARMACY PAYMENTS ;11 Apr 2006  2:52 PM
"RTN","FBAAV2",2,0)
 ;;3.5;FEE BASIS;**3,89,98**;JAN 30, 1995;Build 54
"RTN","FBAAV2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAV2",4,0)
DETP ; ENTRY FROM FBAAV0
"RTN","FBAAV2",5,0)
 S FBTXT=0
"RTN","FBAAV2",6,0)
 D CKB5V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV2",7,0)
 F K=0:0 S K=$O(^FBAA(162.1,"AE",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAA(162.1,"AE",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAA(162.1,K,"RX",L,0)),Y(2)=$G(^(2)),Y=$G(^FBAA(162.1,K,0)) I Y(0)]"",Y]"",+$P(Y(0),U,16) D
"RTN","FBAAV2",8,0)
 .N FBPICN,FBY
"RTN","FBAAV2",9,0)
 .S FBPICN=K_U_L
"RTN","FBAAV2",10,0)
 .S FBY=$S($P(Y,U,12):$P(Y,U,12),1:$P(Y,U,2))_U_+$P(Y(2),U,9)
"RTN","FBAAV2",11,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV2",12,0)
 .D GOTP
"RTN","FBAAV2",13,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV2",14,0)
 Q
"RTN","FBAAV2",15,0)
 ;
"RTN","FBAAV2",16,0)
GOTP ; process a B5 line item
"RTN","FBAAV2",17,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBIENS,FBPNAMX,FBVY0,FBX,FBNPI
"RTN","FBAAV2",18,0)
 ;
"RTN","FBAAV2",19,0)
 S FBIENS=$P(FBPICN,U,2)_","_$P(FBPICN,U,1)_","
"RTN","FBAAV2",20,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV2",21,0)
 S FBINVN=$P(Y,"^"),FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV2",22,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y,"^",2))
"RTN","FBAAV2",23,0)
 ;
"RTN","FBAAV2",24,0)
 S FBVFN=$P(Y,"^",4)
"RTN","FBAAV2",25,0)
 S FBNPI=$$EN^FBNPILK(FBVFN)
"RTN","FBAAV2",26,0)
 S FBVY0=$G(^FBAAV(FBVFN,0)) ; vendor 0 node
"RTN","FBAAV2",27,0)
 S FBVID=$P(FBVY0,U,2),FBVID=$E(FBVID,1,9)_$E(PAD,$L(FBVID)+1,9)
"RTN","FBAAV2",28,0)
 S FBCSN=$S($P(FBVY0,U,2)]"":$P(FBVY0,U,10),1:"")
"RTN","FBAAV2",29,0)
 S FBCSN=$E("0000",$L(FBCSN)+1,4)_FBCSN
"RTN","FBAAV2",30,0)
 I FBPAYT="R" S FBVID=$E(PAD,1,9),FBCSN=$E(PAD,1,4)
"RTN","FBAAV2",31,0)
 K FBVY0
"RTN","FBAAV2",32,0)
 ;
"RTN","FBAAV2",33,0)
 S FBRX=$P(Y(0),"^",1),FBRX=$E("00000000",$L(FBRX)+1,8)_FBRX
"RTN","FBAAV2",34,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV2",35,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(2),U,5),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV2",36,0)
 S FBTD=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV2",37,0)
 S FBSUSP=$P(Y(0),"^",8),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV2",38,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",4),8)
"RTN","FBAAV2",39,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",16),8)
"RTN","FBAAV2",40,0)
 I FBAC=FBAP S FBAP="        "
"RTN","FBAAV2",41,0)
 S DFN=$P(Y(0),"^",5)
"RTN","FBAAV2",42,0)
 Q:'DFN
"RTN","FBAAV2",43,0)
 Q:'$D(^DPT(DFN,0))
"RTN","FBAAV2",44,0)
 ; Note: Prior to the following line Y(0) = the 0 node of subfile 161.11
"RTN","FBAAV2",45,0)
 ;       After the line Y(0) will be the 0 node of file #2
"RTN","FBAAV2",46,0)
 S VAPA("P")="",Y(0)=^DPT(DFN,0) D PAT^FBAAUTL2,ADD^VADPT
"RTN","FBAAV2",47,0)
 S FBPNAMX=$$HL7NAME^FBAAV4(DFN)
"RTN","FBAAV2",48,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV2",49,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV2",50,0)
 S FBCTY=$S($P(VAPA(7),"^")="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV2",51,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV2",52,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV2",53,0)
 ;
"RTN","FBAAV2",54,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV2",55,0)
 D LOADADJ^FBRXFA(FBIENS,.FBADJ)
"RTN","FBAAV2",56,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV2",57,0)
 S FBADJR1=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV2",58,0)
 S FBADJA1=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV2",59,0)
 S FBADJR2=$$RJ^XLFSTR($P(FBX,U,4),5," ")
"RTN","FBAAV2",60,0)
 S FBADJA2=$$AUSAMT^FBAAV3($P(FBX,U,6),9,1)
"RTN","FBAAV2",61,0)
 K FBADJ,FBX
"RTN","FBAAV2",62,0)
 ;
"RTN","FBAAV2",63,0)
 S FBSTR=5_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_FBCSN_FBAC_FBAP_FBAAON_FBSUSP_FBTD_FBRX_FBDIN_FBINVN_FBST_FBCTY_FBZIP_$E(FBPSA,1,3)
"RTN","FBAAV2",64,0)
 S FBSTR=FBSTR_$P(FBY,U,2)_$E(PAD,1,8)_$$PADZ^FBAAV01(FBPICN,30)_$$AUSDT^FBAAV3(+FBY)
"RTN","FBAAV2",65,0)
 S FBSTR=FBSTR_FBADJR1_FBADJR2_FBADJA1_FBADJA2_FBNPI_"$"
"RTN","FBAAV2",66,0)
 D STORE^FBAAV01
"RTN","FBAAV2",67,0)
 Q
"RTN","FBAAV5")
0^6^B47766353^B47393581
"RTN","FBAAV5",1,0)
FBAAV5 ;AISC/GRR-CREATE TRANSACTIONS FOR CH/CNH PAYMENTS ;11 Apr 2006  2:54 PM
"RTN","FBAAV5",2,0)
 ;;3.5;FEE BASIS;**3,55,89,98**;JAN 30, 1995;Build 54
"RTN","FBAAV5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAV5",4,0)
 D CKB9V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV5",5,0)
 G:FBSTAT="S"&(FBCHB="Y")&($P(Y(0),"^",18)'="Y") ^FBAAV6
"RTN","FBAAV5",6,0)
DETCH S FBTXT=0
"RTN","FBAAV5",7,0)
 F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)) I Y(0)]"",+$P(Y(0),U,9) D
"RTN","FBAAV5",8,0)
 .N FBPICN,FBY
"RTN","FBAAV5",9,0)
 .S FBPICN=K
"RTN","FBAAV5",10,0)
 .S FBY=$S($P(Y(2),U,2):$P(Y(2),U,2),1:$P(Y(0),U,2))_U_+$P(Y(2),U,3)
"RTN","FBAAV5",11,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV5",12,0)
 .D GOT
"RTN","FBAAV5",13,0)
 D:FBTXT XMIT^FBAAV01 Q
"RTN","FBAAV5",14,0)
GOT ; process an inpatient invoice
"RTN","FBAAV5",15,0)
 N DFN,FBADJ,FBADJA,FBADJR,FBADMIT,FBAUTHF,FBCDAYS,FBDISDT,FBDISTY,FBNPI
"RTN","FBAAV5",16,0)
 N FBDRG,FBIENS,FBPA,FBPNAMX,FBVMID,FBX
"RTN","FBAAV5",17,0)
 S FBIENS=K_","
"RTN","FBAAV5",18,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV5",19,0)
 S FBPSA=$$PSA(+$P(Y(0),U,20),+$G(FBAASN)) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV5",20,0)
 S FBPAYT=$P(Y(0),"^",13),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV5",21,0)
 S L=$P(Y(0),"^",3)
"RTN","FBAAV5",22,0)
 S FBVID=$S($D(^FBAAV(L,0)):$P(^(0),"^",2),1:"")
"RTN","FBAAV5",23,0)
 S FBNPI=$$EN^FBNPILK(L)
"RTN","FBAAV5",24,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV5",25,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV5",26,0)
 S FBVMID=$S($D(^FBAAV(L,0)):$P(^(0),"^",17),1:"")
"RTN","FBAAV5",27,0)
 S FBVMID=$E(PAD,$L(FBVMID)+1,6)_FBVMID
"RTN","FBAAV5",28,0)
 S POV=$P(Y(0),"^",18)
"RTN","FBAAV5",29,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV),POV=$S(POV']"":40,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:40),FBPOV=POV
"RTN","FBAAV5",30,0)
 S FBPATT=$P(Y(0),"^",19),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV5",31,0)
 S FBFTD=$$AUSDT^FBAAV3($P(Y(0),"^",6)) ; from treatment date
"RTN","FBAAV5",32,0)
 S FBTTD=$$AUSDT^FBAAV3($P(Y(0),"^",7)) ; to treatment date
"RTN","FBAAV5",33,0)
 S FBSUSP=$P(Y(0),"^",11),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,FBSUSP,0)):$P(^(0),"^",1),1:" ")
"RTN","FBAAV5",34,0)
 S FBINVN=$P(Y(0),"^",1)
"RTN","FBAAV5",35,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV5",36,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",2)) ; invoice date rec'd
"RTN","FBAAV5",37,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),8)
"RTN","FBAAV5",38,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",8),8)
"RTN","FBAAV5",39,0)
 S FBPA=$$AUSAMT^FBAAV3($P(Y(0),"^",26),8)
"RTN","FBAAV5",40,0)
 S FBDRG=$P(Y(0),"^",24),FBDRG=$E(PAD,$L(FBDRG)+1,4)_FBDRG
"RTN","FBAAV5",41,0)
 S FBAUTHF=$S($P(Y(0),U,5)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV5",42,0)
 K FBDX,FBPRC F I=1:1:5 S (FBDX(I),FBPRC(I))="       "
"RTN","FBAAV5",43,0)
 I $D(^FBAAI(K,"DX")) S Y("DX")=^("DX") F M=1:1:5 Q:$P(Y("DX"),"^",M)=""  S FBDX(M)=$$SPACES^FBCSV1($$ICD9^FBCSV1(+$P(Y("DX"),"^",M),$P($G(Y(0)),"^",6)),7) I $L(FBDX(M))<7 S FBDX(M)=$E(PAD,$L(FBDX(M))+1,7)_FBDX(M)
"RTN","FBAAV5",44,0)
 I $D(^FBAAI(K,"PROC")) S Y("PROC")=^("PROC") F M=1:1:5 Q:$P(Y("PROC"),"^",M)=""  S FBPRC(M)=$$SPACES^FBCSV1($$ICD0^FBCSV1($P(Y("PROC"),"^",M),$P($G(Y(0)),"^",6)),7) I $L(FBPRC(M))<7 S FBPRC(M)=$E("       ",$L(FBPRC(M))+1,7)_FBPRC(M)
"RTN","FBAAV5",45,0)
 S DFN=$P(Y(0),"^",4)
"RTN","FBAAV5",46,0)
 ; Note: Prior to the following line Y(0) = the 0 node of file 162.5
"RTN","FBAAV5",47,0)
 ;       After the line Y(0) will equal the 0 node of file #2
"RTN","FBAAV5",48,0)
 S VAPA("P")="",Y(0)=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","FBAAV5",49,0)
 D PAT^FBAAUTL2
"RTN","FBAAV5",50,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV5",51,0)
 ; the value returned from it
"RTN","FBAAV5",52,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV5",53,0)
 D ADD^VADPT
"RTN","FBAAV5",54,0)
 S FBPNAMX=$$HL7NAME^FBAAV4(DFN) ; patient name
"RTN","FBAAV5",55,0)
 S FBST=$S($P(VAPA(5),"^",1)="":"  ",$D(^DIC(5,$P(VAPA(5),"^",1),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV5",56,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV5",57,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^",1),1,$P(VAPA(7),"^",1),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV5",58,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV5",59,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV5",60,0)
 S FBADMIT=$$AUSDT^FBAAV3($P($$B9ADMIT(FBIENS),".")) ; admission date
"RTN","FBAAV5",61,0)
 ; get and format discharge date and type
"RTN","FBAAV5",62,0)
 S FBX=$$B9DISCHG(FBIENS)
"RTN","FBAAV5",63,0)
 S FBDISDT=$$AUSDT^FBAAV3($P($P(FBX,U),".")) ; discharge date
"RTN","FBAAV5",64,0)
 S FBDISTY=$$RJ^XLFSTR($P(FBX,U,2),3,0) ; discharge type
"RTN","FBAAV5",65,0)
 K FBX
"RTN","FBAAV5",66,0)
 ; get volume indicator (covered days)
"RTN","FBAAV5",67,0)
 S FBCDAYS=$$RJ^XLFSTR($$GET1^DIQ(162.5,FBIENS,54),5,"0")
"RTN","FBAAV5",68,0)
 ; obtain and format the adjustment codes and amounts
"RTN","FBAAV5",69,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV5",70,0)
 D LOADADJ^FBCHFA(FBIENS,.FBADJ)
"RTN","FBAAV5",71,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV5",72,0)
 S FBADJR=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV5",73,0)
 S FBADJA=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV5",74,0)
 K FBADJ,FBX
"RTN","FBAAV5",75,0)
 ;
"RTN","FBAAV5",76,0)
 S FBSTR=9_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_"  "_FBAP_FBAAON_FBSUSP_FBPOV_FBPATT_FBFTD_FBTTD_FBDIN_FBINVN_FBVMID_FBST_FBCTY_FBZIP_FBPSA_$P(FBY,U,2)_$E(PAD,1,14)
"RTN","FBAAV5",77,0)
 F I=1:1:5 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",78,0)
 S FBSTR=FBSTR_$$PADZ^FBAAV01(FBPICN,23)_$$AUSDT^FBAAV3(+FBY)_"~"
"RTN","FBAAV5",79,0)
 D STORE^FBAAV01
"RTN","FBAAV5",80,0)
 ;
"RTN","FBAAV5",81,0)
 ; build 2nd line
"RTN","FBAAV5",82,0)
 S FBSTR=""
"RTN","FBAAV5",83,0)
 F I=1:1:5 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",84,0)
 S FBSTR=FBSTR_"  "_FBAC_"  "_FBPA_FBDRG_" "_FBADMIT_FBDISDT_FBDOB_FBDISTY_FBCDAYS_FBAUTHF_FBADJR_"  "_FBADJA_FBNPI_"~$"
"RTN","FBAAV5",85,0)
 D STORE^FBAAV01
"RTN","FBAAV5",86,0)
 ;
"RTN","FBAAV5",87,0)
 Q
"RTN","FBAAV5",88,0)
 ;
"RTN","FBAAV5",89,0)
PSA(X,Y) ;call to set default Primary Service Area (PSA)
"RTN","FBAAV5",90,0)
 ;to send to Austin.
"RTN","FBAAV5",91,0)
 ;X = pointer to the institution file
"RTN","FBAAV5",92,0)
 ;Y = default if unable to determine station number in file 4
"RTN","FBAAV5",93,0)
 ;call returns the 3 digit station number only
"RTN","FBAAV5",94,0)
 ;if Y undef return '0'
"RTN","FBAAV5",95,0)
 I '$G(Y) S Y=0
"RTN","FBAAV5",96,0)
 Q $S('X:+Y,$E($P($G(^DIC(4,+X,99)),U),1,3)'?3N:+Y,1:$E($P($G(^(99)),U),1,3))
"RTN","FBAAV5",97,0)
 ;
"RTN","FBAAV5",98,0)
B9ADMIT(FBIENS) ; Determine Admission Date for a B9 payment
"RTN","FBAAV5",99,0)
 ; input
"RTN","FBAAV5",100,0)
 ;   FBIENS
"RTN","FBAAV5",101,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV5",102,0)
 N FB7078,FBRET
"RTN","FBAAV5",103,0)
 S FBRET=""
"RTN","FBAAV5",104,0)
 ;
"RTN","FBAAV5",105,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",106,0)
 ;
"RTN","FBAAV5",107,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",108,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",109,0)
 . N FBY
"RTN","FBAAV5",110,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",111,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV5",112,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV5",113,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV5",114,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV5",115,0)
 ;
"RTN","FBAAV5",116,0)
 ; if invoice points to an unauthorized claim then use the treatment from
"RTN","FBAAV5",117,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",118,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",119,0)
 . N FBY
"RTN","FBAAV5",120,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",121,0)
 . S FBRET=$P(FBY,U,5)
"RTN","FBAAV5",122,0)
 ;
"RTN","FBAAV5",123,0)
 ; return the result
"RTN","FBAAV5",124,0)
 Q FBRET
"RTN","FBAAV5",125,0)
 ;
"RTN","FBAAV5",126,0)
B9DISCHG(FBIENS) ; Determine Discharge Date and Type for a B9 payment
"RTN","FBAAV5",127,0)
 ; input
"RTN","FBAAV5",128,0)
 ;   FBIENS - Invoice IEN (file 162.5) with trailing comma
"RTN","FBAAV5",129,0)
 ; returns discharge date in internal FileMan format or null value and
"RTN","FBAAV5",130,0)
 ; discharge type or null value
"RTN","FBAAV5",131,0)
 N FB7078,FBDISDT,FBDISTY
"RTN","FBAAV5",132,0)
 S (FBDISDT,FBDISTY)=""
"RTN","FBAAV5",133,0)
 ;
"RTN","FBAAV5",134,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",135,0)
 ;
"RTN","FBAAV5",136,0)
 ; if invoice points to an unauthorized claim then use the treatment to
"RTN","FBAAV5",137,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",138,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",139,0)
 . N FBY
"RTN","FBAAV5",140,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",141,0)
 . S FBDISDT=$P(FBY,U,6)
"RTN","FBAAV5",142,0)
 . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",143,0)
 ;
"RTN","FBAAV5",144,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",145,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",146,0)
 . N FBY
"RTN","FBAAV5",147,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",148,0)
 . ;
"RTN","FBAAV5",149,0)
 . ; if fee program is civil hospital then return 7078 date of discharge
"RTN","FBAAV5",150,0)
 . I $P(FBY,U,11)=6 D
"RTN","FBAAV5",151,0)
 . . S FBDISDT=$P(FBY,U,16) ; discharge date
"RTN","FBAAV5",152,0)
 . . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",153,0)
 . ;
"RTN","FBAAV5",154,0)
 . ; if fee program is CNH then get date & type from CNH activity file
"RTN","FBAAV5",155,0)
 . I $P(FBY,U,11)=7 D
"RTN","FBAAV5",156,0)
 . . N DFN,FBADMIT,FBADMITR,FBACTA,FBAUTHP,FBDA,FBDTR
"RTN","FBAAV5",157,0)
 . . S DFN=$P(FBY,U,3) ; patient IEN
"RTN","FBAAV5",158,0)
 . . S FBADMIT=$P($P(FBY,U,4),".") ; CNH admission date
"RTN","FBAAV5",159,0)
 . . S FBAUTHP=+$O(^FBAAA("AG",FB7078,DFN,0)) ; authorization 'pointer'
"RTN","FBAAV5",160,0)
 . . ;
"RTN","FBAAV5",161,0)
 . . ; find the admission entry in CNH ACTIVITY file          
"RTN","FBAAV5",162,0)
 . . S FBACTA=0 ; init the admission activity ien
"RTN","FBAAV5",163,0)
 . . S FBADMITR=9999999-FBADMIT ; reverse admission date
"RTN","FBAAV5",164,0)
 . . S FBDTR=9999999-$$FMADD^XLFDT(FBADMIT,1) ; start loop
"RTN","FBAAV5",165,0)
 . . F  S FBDTR=$O(^FBAACNH("AF",DFN,FBDTR)) Q:'FBDTR!($P(FBDTR,".")>FBADMITR)  D  Q:FBACTA
"RTN","FBAAV5",166,0)
 . . . S FBDA=0 F  S FBDA=$O(^FBAACNH("AF",DFN,FBDTR,FBDA)) Q:'FBDA  D
"RTN","FBAAV5",167,0)
 . . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",168,0)
 . . . . I $P(FBY,U,3)="A",$P(FBY,U,10)=FBAUTHP S FBACTA=FBDA ; found it
"RTN","FBAAV5",169,0)
 . . Q:'FBACTA  ; could not find the admission activity
"RTN","FBAAV5",170,0)
 . . ;
"RTN","FBAAV5",171,0)
 . . ; get date from associated discharge (if any) in CNH ACTIVITY file
"RTN","FBAAV5",172,0)
 . . S FBDA=" "
"RTN","FBAAV5",173,0)
 . . F  S FBDA=$O(^FBAACNH("AC",FBACTA,FBDA),-1) Q:FBDA'>0  D  Q:FBDISDT
"RTN","FBAAV5",174,0)
 . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",175,0)
 . . . I $P(FBY,U,3)="D" D
"RTN","FBAAV5",176,0)
 . . . . S FBDISDT=$P($P(FBY,U),".")
"RTN","FBAAV5",177,0)
 . . . . S FBDISTY=$P(FBY,U,8)
"RTN","FBAAV5",178,0)
 . . . . I FBDISTY'="" S FBDISTY=FBDISTY+100
"RTN","FBAAV5",179,0)
 ;
"RTN","FBAAV5",180,0)
 ; return the result
"RTN","FBAAV5",181,0)
 Q FBDISDT_"^"_FBDISTY
"RTN","FBAAV5",182,0)
 ;
"RTN","FBAAV5",183,0)
 ;FBAAV5
"RTN","FBAAVD")
0^7^B26287832^B25679406
"RTN","FBAAVD",1,0)
FBAAVD ;AISC/DMK-DISPLAY/EDIT VENDOR DEMOGRAPHICS ;11 Apr 2006  2:54 PM
"RTN","FBAAVD",2,0)
 ;;3.5;FEE BASIS;**9,98**;JAN 30, 1995;Build 54
"RTN","FBAAVD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAVD",4,0)
 ;FBTEMP set = 1 if called from input template
"RTN","FBAAVD",5,0)
RDV ;ask vendor
"RTN","FBAAVD",6,0)
 W ! K DFN,FBRATE S FEEO="",DIC="^FBAAV(",DIC(0)="AEQLM",DLAYGO=161.2,DIC("DR")="1;6;7;8" D ^DIC K DIC,DLAYGO G Q:$D(DTOUT)!(X="")!($D(DUOUT)),RDV:Y<0 S DA=+Y
"RTN","FBAAVD",7,0)
 D NEW:$P(Y,U,3)=1 D EN1
"RTN","FBAAVD",8,0)
 I $G(DA) W ! I $D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("B")="No",DIR("A")="Want to edit data" D ^DIR K DIR I $G(Y) D EDITV
"RTN","FBAAVD",9,0)
 Q:$G(FBTEMP)
"RTN","FBAAVD",10,0)
 G RDV
"RTN","FBAAVD",11,0)
 ;
"RTN","FBAAVD",12,0)
EN1 ;display vendor demographics
"RTN","FBAAVD",13,0)
 ;DA = IEN of vendor in file 161.2
"RTN","FBAAVD",14,0)
 ;
"RTN","FBAAVD",15,0)
 N C,I
"RTN","FBAAVD",16,0)
 Q:'$G(DA)
"RTN","FBAAVD",17,0)
 S Z=$G(^FBAAV(DA,0)),V=$G(^(1)),T=$G(^("AMS")),A=$G(^("ADEL")),FBNPI=$P($G(^(3)),U,2)
"RTN","FBAAVD",18,0)
 F X=1:1:17 S Z(X)=$P(Z,U,X)
"RTN","FBAAVD",19,0)
 S FBDEL=$S($P(A,U)="Y":1,1:0),FBAAPN=$P(V,U),FBAAFN=$P(V,U,9)
"RTN","FBAAVD",20,0)
 ;Z=zero node,V=one node,T=ams node,A=adel node
"RTN","FBAAVD",21,0)
 ;
"RTN","FBAAVD",22,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS W @IOF K IOP
"RTN","FBAAVD",23,0)
 I +$G(DFN)>0 W !,"Patient Name: ",$P($G(^DPT(DFN,0)),U),?48,"Pt.ID: ",$$SSN^FBAAUTL(DFN),!
"RTN","FBAAVD",24,0)
 W !?22,"***  VENDOR DEMOGRAPHICS  ***" D
"RTN","FBAAVD",25,0)
 .I FBDEL W !?19,"==> FLAGGED FOR DELETION <==" Q
"RTN","FBAAVD",26,0)
 .I $$CKVEN^FBAADV(DA) W !?20,"==> AWAITING AUSTIN APPROVAL <=="
"RTN","FBAAVD",27,0)
 W !!,$J("Name:",13),?15,$E(Z(1),1,30),?47,"ID Number: ",Z(2)
"RTN","FBAAVD",28,0)
 W !?40,"Billing Prov NPI: ",FBNPI
"RTN","FBAAVD",29,0)
 W !,$J("Address:",13),?15,Z(3),?47,"Specialty: ",$E($P($G(^FBAA(161.6,+Z(8),0)),U),1,20)
"RTN","FBAAVD",30,0)
 I Z(14)]"" W !,$J("Address [2]:",13),?15,Z(14)
"RTN","FBAAVD",31,0)
 W !,$J("City:",13),?15,Z(4),?52,"Type:",?58,$P($P(^DD(161.2,6,0),Z(7)_":",2),";")
"RTN","FBAAVD",32,0)
 ;
"RTN","FBAAVD",33,0)
 W !,$J("State:",13),?15,$P($G(^DIC(5,+Z(5),0)),U),?38,"Participation Code:",?58,$S($D(^FBAA(161.81,+Z(9),0)):$E($P(^(0),U),1,21),1:"UNKNOWN")
"RTN","FBAAVD",34,0)
 W !,$J("ZIP:",13),?15,Z(6),?38,"Medicare ID Number:",?59,Z(17)
"RTN","FBAAVD",35,0)
 W !,$J("County:",13),?15,$P($G(^DIC(5,+Z(5),1,+Z(13),0)),U)
"RTN","FBAAVD",36,0)
 W ?51,"Chain: ",Z(10)
"RTN","FBAAVD",37,0)
 W !,$J("Phone:",13),?15,FBAAPN,!,$J("Fax:",13),?15,FBAAFN
"RTN","FBAAVD",38,0)
 W:$P(T,U,2)="Y" ?44,"Pricer Exempt: Yes"
"RTN","FBAAVD",39,0)
 W !,$J("Type (FPDS):",13),?15,$$EXTERNAL^DILFD(161.2,24,"",$P(V,U,10))
"RTN","FBAAVD",40,0)
 S (C,I)=0 F  S I=$O(^FBAAV(DA,2,I)) Q:'I  D
"RTN","FBAAVD",41,0)
 . S X=$P($G(^FBAAV(DA,2,I,0)),U) Q:'X
"RTN","FBAAVD",42,0)
 . S X=$$GET1^DIQ(420.6,X,1) Q:X=""
"RTN","FBAAVD",43,0)
 . S C=C+1
"RTN","FBAAVD",44,0)
 . I '(C#2) W !,$J("Group (FPDS):",13),?15,$E(X,1,21)
"RTN","FBAAVD",45,0)
 . I (C#2) W ?44,"Group (FPDS):",?59,$E(X,1,21)
"RTN","FBAAVD",46,0)
 W !,$J("Austin Name:",13),?15,$P(T,U)
"RTN","FBAAVD",47,0)
 W !,$J("Last Change ",13),?43,"Last Change" I $P(A,U,5)]"" W " by ",$S($P(A,U,5)="000":"Non-Fee User",1:"Station "_$P(A,U,5))
"RTN","FBAAVD",48,0)
 W !,$J("TO Austin:",13),?15,$$DATX^FBAAUTL($P(A,U,2))
"RTN","FBAAVD",49,0)
 W ?45,"FROM Austin:  ",$$DATX^FBAAUTL($P(A,U,4))
"RTN","FBAAVD",50,0)
 ;
"RTN","FBAAVD",51,0)
 I Z(9)=5 D ^FBAAVD1
"RTN","FBAAVD",52,0)
 K A,T,V,Z,FBAAFN
"RTN","FBAAVD",53,0)
 Q
"RTN","FBAAVD",54,0)
 ;
"RTN","FBAAVD",55,0)
NEW ;called when adding a new vendor
"RTN","FBAAVD",56,0)
 Q:'$G(DA)
"RTN","FBAAVD",57,0)
 S FBT="N",DIE="^FBAAV(",DR="[FBAA NEW VENDOR]" D ^DIE S Y=$G(^FBAAV(DA,0)) S FBOVEN="" D  I +FBOVEN K FBOVEN W ! S DR="3;4;5;5.5" D ^DIE K DIE,DR D CHKVEN Q:'$G(DA)
"RTN","FBAAVD",58,0)
 .I $P(Y,U,4)']"" S FBOVEN=1
"RTN","FBAAVD",59,0)
 .I '$P(Y,U,5) S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_2,1:2)
"RTN","FBAAVD",60,0)
 .I $P(Y,U,6)']"" S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_3,1:3)
"RTN","FBAAVD",61,0)
 .I $P(Y,U,13)']"" S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_4,1:4)
"RTN","FBAAVD",62,0)
 .I +FBOVEN D  K XX,X
"RTN","FBAAVD",63,0)
 ..W !!?9,"The following data must be entered when adding a new vendor:",!
"RTN","FBAAVD",64,0)
 ..W !?28,">>> W A R N I N G <<<",!?14,"Entering an '^' at this point will delete vendor!",!
"RTN","FBAAVD",65,0)
 ..F XX=1:1 S X=$P(FBOVEN,U,XX) Q:'X  D
"RTN","FBAAVD",66,0)
 ...W !?8,$P($T(ERROR+X),";;",2)
"RTN","FBAAVD",67,0)
 D SETGL
"RTN","FBAAVD",68,0)
 S FBVIEN=DA D CONTR^FBAAVD2 S DA=FBVIEN Q
"RTN","FBAAVD",69,0)
 ;
"RTN","FBAAVD",70,0)
EDITV ;called when editing an existing vendor
"RTN","FBAAVD",71,0)
 N FBHDA Q:'$G(DA)
"RTN","FBAAVD",72,0)
 N FBAAOUT G:$G(FBT)="N" EDITV1 I $D(^FBAA(161.25,DA,0))!($D(^FBAA(161.25,"AF",DA))) W !!?5,*7,"Current Vendor information is pending Austin processing.  Changing Vendor" D  I $G(FBAAOUT) K FBAAOUT Q
"RTN","FBAAVD",73,0)
 .W !?5,"information at this time may jeopardize the processing of the existing",!?5,"Master Record Adjustment!",! D
"RTN","FBAAVD",74,0)
 ..S DIR(0)="Y",DIR("A")="Do you wish to continue editing this Vendor",DIR("B")="No" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1
"RTN","FBAAVD",75,0)
EDITV1 D ^FBAAVD2 K FBCIEN,FBR,FBT
"RTN","FBAAVD",76,0)
 Q
"RTN","FBAAVD",77,0)
 ;
"RTN","FBAAVD",78,0)
SETGL ;called to file an entry in 161.25 (vendor correction file)
"RTN","FBAAVD",79,0)
 I $S('$G(DA):1,$G(FBT)="C"&('$D(FBIEN1)):1,1:0) Q
"RTN","FBAAVD",80,0)
 S Z1=$G(^FBAAV(DA,0)),FBTOV=$S($P(Z1,U,7)=3:"P",1:"O")
"RTN","FBAAVD",81,0)
 I $G(FBT)="N"!($G(FBT)="R") S DIE="^FBAAV(",DR="9///@;13///@" D ^DIE K DIE
"RTN","FBAAVD",82,0)
 I '$D(^FBAA(161.25,DA,0)) L +^FBAA(161.25,DA) K DD,DO S (X,DINUM)=DA,DIC="^FBAA(161.25,",DIC(0)="L",DLAYGO=161.25 D FILE^DICN K DLAYGO L -^FBAA(161.25,DA) Q:Y<0
"RTN","FBAAVD",83,0)
NEXT L +^FBAA(161.25,DA):1 I '$T W:'$D(ZTQUEUED) !,"Unable to setup MRA transaction.  Trying again.",! G NEXT
"RTN","FBAAVD",84,0)
 S DIE="^FBAA(161.25,",DR="[FBAA VENDOR MRA]" D ^DIE L -^FBAA(161.25,DA)
"RTN","FBAAVD",85,0)
 K DIE,DIC,Y
"RTN","FBAAVD",86,0)
 Q
"RTN","FBAAVD",87,0)
 ;
"RTN","FBAAVD",88,0)
Q K DA,DR,DIC,DIE,DIRUT,DTOUT,DUOUT,A,D,FBX,FBOUT,X2,FY,FBAAPN,FEEO,FBDEL,FBPARCD,FBT,FBTOV,FBTV,X,Y,Z0,Z1,Z2,ZZ,FBCNUM,FBID,FBVIEN,FBLIEN,FBAAFN
"RTN","FBAAVD",89,0)
 Q
"RTN","FBAAVD",90,0)
ERROR ;edit check text when adding a new vendor
"RTN","FBAAVD",91,0)
 ;;CITY
"RTN","FBAAVD",92,0)
 ;;STATE
"RTN","FBAAVD",93,0)
 ;;ZIP CODE
"RTN","FBAAVD",94,0)
 ;;COUNTY CODE
"RTN","FBAAVD",95,0)
CHKVEN ;check if fields 3,4,5,5.5 have been answered. If not delete vendor
"RTN","FBAAVD",96,0)
 S Y=$G(^FBAAV(DA,0))
"RTN","FBAAVD",97,0)
 F X=4,5,6,13 I $P(Y,U,X)']"" D  Q
"RTN","FBAAVD",98,0)
 .S DIK="^FBAAV(" D ^DIK K DIK,DA W !?3,$C(7),".... Vendor deleted",!
"RTN","FBAAVD",99,0)
 Q
"RTN","FBAAVD2")
0^23^B31257059^B30603987
"RTN","FBAAVD2",1,0)
FBAAVD2 ;AISC/DMK-EDIT VENDOR DEMOGRAPHICS ;07/17/06
"RTN","FBAAVD2",2,0)
 ;;3.5;FEE BASIS;**9,10,47,65,98**;JAN 30, 1995;Build 54
"RTN","FBAAVD2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAVD2",4,0)
EDITV ;entry to edit vendor demographic data
"RTN","FBAAVD2",5,0)
 ;DA defined to IEN of vendor file (161.2)
"RTN","FBAAVD2",6,0)
 Q:'$G(DA)  N FBADT,FBDA,Z6 S FBDA=DA L +^FBAAV(DA):1 I '$T W !,"Unable to access vendor record. Trying again.",! G EDITV
"RTN","FBAAVD2",7,0)
 S FBT=$S($D(FBT):FBT,1:""),FBT=$S(FBT="N":FBT,1:"C")
"RTN","FBAAVD2",8,0)
 S FEEO="",DIE="^FBAAV(",DR="[FBAA EDIT VENDOR]",DIE("NO^")="BACKOUTOK"
"RTN","FBAAVD2",9,0)
 S Z1=$G(^FBAAV(DA,0)),Z3=$G(^(1)),Z4=$G(^("AMS")),Z5=$G(^("ADEL")),Z6=$P($G(^(3)),U,2)
"RTN","FBAAVD2",10,0)
 D GETGRP^FBAAUTL6(DA)
"RTN","FBAAVD2",11,0)
 D ^DIE
"RTN","FBAAVD2",12,0)
 I $P($G(^FBAAV(DA,0)),"^",13)']"" S DR="3;4;5;5.5",DIE("NO^")="" D ^DIE
"RTN","FBAAVD2",13,0)
 K DIE
"RTN","FBAAVD2",14,0)
 L -^FBAAV(DA)
"RTN","FBAAVD2",15,0)
 ;check if data was changed
"RTN","FBAAVD2",16,0)
 I $D(^FBAAV(DA,0)),(($P(Z1,U,2,6)'=$P(^FBAAV(DA,0),U,2,6))!($P(Z1,U,8,16)'=$P(^FBAAV(DA,0),U,8,16))!($P(Z3,U,10)'=$P($G(^FBAAV(DA,1)),U,10))!$$GRPDIF^FBAAUTL6(DA))!($P($G(^FBAAV(DA,3)),U,2))'=Z6 D
"RTN","FBAAVD2",17,0)
 .S FBVNAME=$P(^FBAAV(DA,0),U),FBIEN1=DA,FBADT=$P(Z5,U,4),FBNPI=$P($G(^FBAAV(FBIEN1,3)),U,2)
"RTN","FBAAVD2",18,0)
 .;check if date last received from austin, version 3.  If so, then did not receive in upload - send update instead of change
"RTN","FBAAVD2",19,0)
 .;fbadt = date received from austin.
"RTN","FBAAVD2",20,0)
 .I '$$CKVEN^FBAADV(DA),FBADT']"" D UPDT^FBAAAV(FBDA) Q  ;,FBADT<FBINSTAL D UPDT^FBAAAV(DA) Q
"RTN","FBAAVD2",21,0)
 .;if austin deleted is yes, send update instead of change
"RTN","FBAAVD2",22,0)
 .I $P($G(^FBAAV(FBDA,"ADEL")),"^")="Y" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",23,0)
 .;if editing a newly added vendor, send update instead of change
"RTN","FBAAVD2",24,0)
 .I FBT="N" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",25,0)
 .;if only FPDS data was changed
"RTN","FBAAVD2",26,0)
 .I $P(Z1,U,2,6)=$P(^FBAAV(DA,0),U,2,6),$P(Z1,U,8,16)=$P(^FBAAV(DA,0),U,8,16) D  Q:FBT=""
"RTN","FBAAVD2",27,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),'$D(^FBAA(161.25,DA,0)) S FBT="F" Q  ; no pending actions - add "F"
"RTN","FBAAVD2",28,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),$D(^FBAA(161.25,DA,0)),$P(^(0),U,5)="" S FBT="" Q  ; action pending, but not yet transmitted - will incl. FPDS data
"RTN","FBAAVD2",29,0)
 .I FBT="F" S FBIEN1=DA,FEEO="" D SETGL^FBAAVD Q  ; send FEE-ONLY
"RTN","FBAAVD2",30,0)
 .;If date from austin not null then add vendor entry for a change
"RTN","FBAAVD2",31,0)
 .K DD,DO S DIC="^FBAAV(",DIC(0)="L",DLAYGO=161.2,X=FBVNAME D FILE^DICN Q:Y<0  S FBIEN=+Y
"RTN","FBAAVD2",32,0)
 .L +^FBAAV(FBIEN)
"RTN","FBAAVD2",33,0)
 .S ^FBAAV(FBIEN,0)=$G(^FBAAV(FBIEN1,0))
"RTN","FBAAVD2",34,0)
 .S ^FBAAV(FBIEN,1)=$G(^FBAAV(FBIEN1,1))
"RTN","FBAAVD2",35,0)
 .S ^FBAAV(FBIEN,"AMS")=$G(^FBAAV(FBIEN1,"AMS")),$P(^FBAAV(FBIEN,"AMS"),"^")=""
"RTN","FBAAVD2",36,0)
 .K FBFDA
"RTN","FBAAVD2",37,0)
 .S I=0 F  S I=$O(^FBAAV(FBIEN1,2,I)) Q:'I  D
"RTN","FBAAVD2",38,0)
 ..S X=$P($G(^(I,0)),U) I X]"" S FBFDA(161.225,"+"_I_","_FBIEN_",",.01)=X
"RTN","FBAAVD2",39,0)
 .I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBAAVD2",40,0)
 .S DIK="^FBAAV(",DA=FBIEN D IX1^DIK
"RTN","FBAAVD2",41,0)
 .L -^FBAAV(FBIEN)
"RTN","FBAAVD2",42,0)
 .;restore original vendor data
"RTN","FBAAVD2",43,0)
 .L +^FBAAV(FBIEN1)
"RTN","FBAAVD2",44,0)
 .S DIE="^FBAAV(",DA=FBIEN1,DR="[FB VENDOR UPDATE]" D ^DIE K DIE
"RTN","FBAAVD2",45,0)
 .D UPDGRP^FBAAUTL6(FBIEN1)
"RTN","FBAAVD2",46,0)
 .L -^FBAAV(FBIEN1)
"RTN","FBAAVD2",47,0)
 .S DA=FBIEN D SETGL^FBAAVD
"RTN","FBAAVD2",48,0)
 K FBSG,FBVNAME,FBIEN,FBIEN1,Z3,Z4,Z5
"RTN","FBAAVD2",49,0)
 ;
"RTN","FBAAVD2",50,0)
CONTR ;enter contract information for a CNH vendor
"RTN","FBAAVD2",51,0)
 Q:$S('$D(FBPARCD):1,FBPARCD'=5:1,1:0)
"RTN","FBAAVD2",52,0)
 Q:'$G(DA)  S FBVIEN=DA
"RTN","FBAAVD2",53,0)
 S FBLIEN=$P($G(^FBAA(161.25,FBVIEN,0)),"^",6) I FBLIEN]"",FBLIEN'=FBVIEN W !!,*7,"Cannot add contract information to this vendor until change has been",!,"approved by Austin." Q
"RTN","FBAAVD2",54,0)
 W ! S DIC="^FBAA(161.21,",DIC(0)="AEQLM",DLAYGO=161.21,DIC("S")="I $P(^(0),U,4)="_FBVIEN
"RTN","FBAAVD2",55,0)
 D ^DIC K DIC,DLAYGO Q:X=""!(X="^")  G CONTR:Y<0
"RTN","FBAAVD2",56,0)
 S DA=+Y,FBCNUM=$P(Y,"^",2),DIE="^FBAA(161.21," L +^FBAA(161.21,DA)
"RTN","FBAAVD2",57,0)
 S ZO1=^FBAA(161.21,DA,0),DR="[FBNH ENTER CONTRACT]",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBAAVD2",58,0)
 I '$G(DA) K ZO1 Q
"RTN","FBAAVD2",59,0)
 I $D(^FBAA(161.22,"AC",DA)) D
"RTN","FBAAVD2",60,0)
 .Q:$P(ZO1,"^",1,2)=$P(^FBAA(161.21,DA,0),"^",1,2)  W !!,*7,"You cannot change contract numbers or effective dates on",!,"a contract that has rates associated with it."
"RTN","FBAAVD2",61,0)
 .S DIE="^FBAA(161.21,",DR=".01////^S X=$P(ZO1,U);.02////^S X=$P(ZO1,U,2);.03////^S X=$P(ZO1,U,3);.04////^S X=$P(ZO1,U,4)" D ^DIE K DIE,DR W !!,"Contract information reset"
"RTN","FBAAVD2",62,0)
 L -^FBAA(161.21,DA) K ZO1
"RTN","FBAAVD2",63,0)
 Q:$D(DTOUT)
"RTN","FBAAVD2",64,0)
 I $G(FBEXNDT)<$G(FBEXDT) D URATE K FBCIEN,FBEXDT,FBEXNDT,FBURT
"RTN","FBAAVD2",65,0)
 ;create rates for a contract. Rates cannot be changed, but the
"RTN","FBAAVD2",66,0)
 ;user can enter multiple rates for a contract.
"RTN","FBAAVD2",67,0)
 ;FBCIEN=internal entry number for contract in 161.21
"RTN","FBAAVD2",68,0)
 S FBCIEN=DA K FBX
"RTN","FBAAVD2",69,0)
RATE K DA W ! S DIR(0)="161.22,.02",DIR("A")="Enter Nursing Home Rate",DIR("?")="^K FBX,FBRATE D DISPLAY^FBAAVD1 W !,""Enter an amount between .01 and 9999999.99""" D ^DIR
"RTN","FBAAVD2",70,0)
 K DIR Q:$D(DIRUT)  Q:'Y  S FBR=+Y
"RTN","FBAAVD2",71,0)
 I $L($$RATE^FBAAVD1($P(^FBAA(161.21,FBCIEN,0),"^",1)))+$L("^"_FBR)>510 W !,*7,"There are too many rates loaded for that contract! Please remove obsolete rates.",! Q
"RTN","FBAAVD2",72,0)
 I $D(^FBAA(161.22,"AD",FBCIEN,FBR)) K FBR W !,*7,"Rate already exists for that contract!",! G RATE
"RTN","FBAAVD2",73,0)
 S X=$P(^FBAA(161.22,0),U,3)
"RTN","FBAAVD2",74,0)
RETRY S X=X+1 G:$D(^FBAA(161.22,X)) RETRY
"RTN","FBAAVD2",75,0)
 L +^FBAA(161.22,X)
"RTN","FBAAVD2",76,0)
 K DD,DO S DIC="^FBAA(161.22,",DIC(0)="L",DLAYGO=161.22,DIC("DR")=".02////^S X="_FBR_";.03////^S X="_FBCIEN D FILE^DICN K DIC,DLAYGO
"RTN","FBAAVD2",77,0)
 L -^FBAA(161.22,+Y)
"RTN","FBAAVD2",78,0)
 G RATE
"RTN","FBAAVD2",79,0)
 ;
"RTN","FBAAVD2",80,0)
GETVEN K FBRATE D GETVEN^FBAAUTL1 G END:'IFN
"RTN","FBAAVD2",81,0)
 S DA=IFN K DIC,IFN
"RTN","FBAAVD2",82,0)
 S FBPARCD=$P($G(^FBAAV(DA,0)),U,9)
"RTN","FBAAVD2",83,0)
 I FBPARCD'=5 W !?5,*7,"Vendor selected is not a Community Nursing Home.",! G GETVEN
"RTN","FBAAVD2",84,0)
 D CONTR G GETVEN
"RTN","FBAAVD2",85,0)
END K DIC,DA,FBVIEN,IFN,FBPARCD,X,Y,FBLIEN
"RTN","FBAAVD2",86,0)
 Q
"RTN","FBAAVD2",87,0)
URATE ;Update rate when user backs up contract dates.
"RTN","FBAAVD2",88,0)
 N DA S (FBCIEN,FBURT)=0
"RTN","FBAAVD2",89,0)
 F  S FBURT=$O(^FBAA(161.23,"AE",FBCNUM,FBURT)) Q:'FBURT  F  S FBCIEN=$O(^FBAA(161.23,"AE",FBCNUM,FBURT,FBCIEN)) Q:'FBCIEN  I $P($G(^FBAA(161.23,FBCIEN,0)),"^",2)>FBEXNDT D
"RTN","FBAAVD2",90,0)
 .I +$G(^FBAA(161.23,FBCIEN,0))>FBEXNDT S DIK="^FBAA(161.23,",DA=FBCIEN D ^DIK K DIK Q
"RTN","FBAAVD2",91,0)
 .S DIE="^FBAA(161.23,",DA=FBCIEN,DR=".02////^S X=FBEXNDT" D ^DIE K DIE
"RTN","FBAAVD2",92,0)
 Q
"RTN","FBAAVD4")
0^26^B21494151^n/a
"RTN","FBAAVD4",1,0)
FBAAVD4 ;AISC/CLT, Special routine for entering/inactivating/deleting NPI in file 161.2; ; 19 Sep 2006  12:31 PM
"RTN","FBAAVD4",2,0)
 ;;3.5;FEE BASIS;**98**;30-JAN-95;Build 54
"RTN","FBAAVD4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAVD4",4,0)
 ;
"RTN","FBAAVD4",5,0)
 ;This routine will ask for the NPI, check for proper format, check for duplicate entries
"RTN","FBAAVD4",6,0)
 ;check for proper format using the double-add-double formula.  If the NPI is being
"RTN","FBAAVD4",7,0)
 ;deleted it will check if it is being deleted because of a valid NPI being removed for some
"RTN","FBAAVD4",8,0)
 ;other reason.  If it is being deleted because of an erroneous entry it will be completely deleted.
"RTN","FBAAVD4",9,0)
 ; If it is a valid NPI being deleted because of a possible inappropriate usage it will be maintained
"RTN","FBAAVD4",10,0)
 ; in the history cross reference to preclude anyone from using this NPI again.
"RTN","FBAAVD4",11,0)
 ;
"RTN","FBAAVD4",12,0)
EN ;Routine primary entry point
"RTN","FBAAVD4",13,0)
 ;
"RTN","FBAAVD4",14,0)
 N DIR,DUOUT,DTOUT,FBIEN,FBRTN,FBNPI,X,Y,FBCHECK,FBOLDNPI,FBRBNPI,DIE,DIC,DR
"RTN","FBAAVD4",15,0)
 S FBIEN=DA,FBRTN=""
"RTN","FBAAVD4",16,0)
 I $G(DA) S:$P($G(^FBAAV(DA,3)),U,2)'="" (DIR("B"),FBOLDNPI)=$P($G(^FBAAV(DA,3)),U,2)
"RTN","FBAAVD4",17,0)
EN1 S DIR(0)="FO^10:10",DIR("A")="BILLING PROVIDER NPI",DIR("?")="Enter a 10 digit National Provider Identifier" S:'$G(DTIME) DIR("T")=600 S FBCHECK=0
"RTN","FBAAVD4",18,0)
 D ^DIR G:$G(DUOUT)!$G(DTOUT) XIT G:X="@" DEL I X=""!(X=$P($G(^FBAAV(FBIEN,3)),U,2)) G XIT
"RTN","FBAAVD4",19,0)
 I Y="" S:$G(FBOLDNPI) FBNPI=FBOLDNPI G XIT
"RTN","FBAAVD4",20,0)
 S FBNPI=Y I '$$CHKDGT^XUSNPI(FBNPI) D BADCHK  G EN1
"RTN","FBAAVD4",21,0)
 I $$DUP^FBNPILK(FBNPI)'=""&(FBRTN'=DA) K DIR("A") G EN1
"RTN","FBAAVD4",22,0)
 I $G(FBOLDNPI)'="" I FBNPI'=FBOLDNPI D INACT
"RTN","FBAAVD4",23,0)
 D:FBNPI'="" ACTIVATE
"RTN","FBAAVD4",24,0)
 G XIT
"RTN","FBAAVD4",25,0)
 ;
"RTN","FBAAVD4",26,0)
BADCHK ;BACK CHECK DIGIT ON THE NPI
"RTN","FBAAVD4",27,0)
 W !,*7,"Not a valid NPI.  Please try again."
"RTN","FBAAVD4",28,0)
 Q
"RTN","FBAAVD4",29,0)
 ;
"RTN","FBAAVD4",30,0)
ACTIVATE ;CREATE AN ACTIVATED ENTRY IN MULTIPLE NPI FIELD
"RTN","FBAAVD4",31,0)
 Q:$G(FBNPI)=""
"RTN","FBAAVD4",32,0)
 S DA(1)=FBIEN,DIC="^FBAAV("_DA(1)_",""NPI"",",DIC(0)="L",X=$$NOW^XLFDT() H 1
"RTN","FBAAVD4",33,0)
 S DIC("DR")=".02////^S X=1;.03////^S X=FBNPI;.04////^S X=DUZ"
"RTN","FBAAVD4",34,0)
 D ^DIC
"RTN","FBAAVD4",35,0)
 S $P(^FBAAV(FBIEN,3),U,2)=FBNPI,^FBAAV("NPI",FBNPI,FBIEN)="",^FBAAV("NPIHISTORY",FBNPI,FBIEN)=""
"RTN","FBAAVD4",36,0)
 Q
"RTN","FBAAVD4",37,0)
 ;
"RTN","FBAAVD4",38,0)
DEL ;NPI HAS BEEN DELETED
"RTN","FBAAVD4",39,0)
 ;If the user deletes the NPI this subroutine will determine why it was deleted and if it was because it was found
"RTN","FBAAVD4",40,0)
 ;in a false identity situation will not allow it to be deleted, but removed to history to never be used again.
"RTN","FBAAVD4",41,0)
 I $P($G(^FBAAV(DA,3)),U,2)="" W " ??",$C(7) Q
"RTN","FBAAVD4",42,0)
 S FBNPI=DIR("B") K DIR S DIR(0)="Y",DIR("A")="Are you sure you wish to delete this NPI",DIR("?")="You have indicated you wish to delete the NPI.  This is a second chance check."
"RTN","FBAAVD4",43,0)
 D ^DIR
"RTN","FBAAVD4",44,0)
 G:$G(Y)=0 XIT
"RTN","FBAAVD4",45,0)
 S DIR(0)="S^E:ERROR;V:VALID",DIR("A")="Was this a Valid NPI or an NPI entered in Error",DIR("?",1)="An example of an NPI entered in error is if the entry person transposes numbers,"
"RTN","FBAAVD4",46,0)
 S DIR("?",2)="or the NPI for one provider is accidentally assigned to a different provider."
"RTN","FBAAVD4",47,0)
 S DIR("?")="Enter a 'E' for Error or a 'V' for Valid."
"RTN","FBAAVD4",48,0)
 D ^DIR
"RTN","FBAAVD4",49,0)
 D:$G(Y)="E" COMP I $G(Y)="V" S FBCHECK=3 D INACT
"RTN","FBAAVD4",50,0)
 Q
"RTN","FBAAVD4",51,0)
 ;
"RTN","FBAAVD4",52,0)
COMP ;COMPLETELY DELETE THE NPI
"RTN","FBAAVD4",53,0)
 ;This subroutine will delete the NPI from the NPI and NPIHISTORY cross references.  It make an entry in the 
"RTN","FBAAVD4",54,0)
 ;NPI multiple field within a vendor record to indicate that the NPI has been deleted.
"RTN","FBAAVD4",55,0)
 K ^FBAAV("NPI",FBNPI,DA),^FBAAV("NPIHISTORY",FBNPI,DA)
"RTN","FBAAVD4",56,0)
 S DA(1)=FBIEN,DIC="^FBAAV("_DA(1)_",""NPI"",",DIC(0)="L",X=$$NOW^XLFDT()
"RTN","FBAAVD4",57,0)
 S FBRB=0
"RTN","FBAAVD4",58,0)
 D  ; Find the most recent status '0' (inactive) NPI entry in the list that was not later made status '2' (deleted).
"RTN","FBAAVD4",59,0)
 . N FBRBLST,FBRBTMP
"RTN","FBAAVD4",60,0)
 . ; Don't want to roll back to the same number you are deleting.
"RTN","FBAAVD4",61,0)
 . S FBRBLST(FBNPI)=""
"RTN","FBAAVD4",62,0)
 . S FBRBTMP=$P(^FBAAV(FBIEN,"NPI",0),U,3)
"RTN","FBAAVD4",63,0)
 . ; Go through each entry in reverse order
"RTN","FBAAVD4",64,0)
 . F  S FBRBTMP=$O(^FBAAV(FBIEN,"NPI",FBRBTMP),-1) Q:'FBRBTMP  D  Q:FBRB'=0
"RTN","FBAAVD4",65,0)
 .. S FBRBLST=^FBAAV(FBIEN,"NPI",FBRBTMP,0)
"RTN","FBAAVD4",66,0)
 .. ; If this is an 'active' entry then ignore it.
"RTN","FBAAVD4",67,0)
 .. I $P(FBRBLST,U,2)=1 Q
"RTN","FBAAVD4",68,0)
 .. ; If this is a 'deleted' entry then store the NPI for later comparison to any 'inactive' entries found.
"RTN","FBAAVD4",69,0)
 .. I $P(FBRBLST,U,2)=2 S FBRBLST($P(FBRBLST,U,3))="" Q
"RTN","FBAAVD4",70,0)
 .. ; If this is an 'inactive' entry and there is no 'deleted' entry then report it.
"RTN","FBAAVD4",71,0)
 .. I $P(FBRBLST,U,2)=0,'$D(FBRBLST($P(FBRBLST,U,3))) S FBRB=FBRBTMP Q
"RTN","FBAAVD4",72,0)
 .. Q
"RTN","FBAAVD4",73,0)
 . Q
"RTN","FBAAVD4",74,0)
 S DIC("DR")=".02////^S X=2;.03////^S X=FBOLDNPI;.04////^S X=DUZ"
"RTN","FBAAVD4",75,0)
 D ^DIC S ^FBAAV(DA,3)="^"
"RTN","FBAAVD4",76,0)
 W !,"This NPI has been deleted.",!
"RTN","FBAAVD4",77,0)
 I FBRB>0 D ROLLBACK
"RTN","FBAAVD4",78,0)
 Q
"RTN","FBAAVD4",79,0)
 ;
"RTN","FBAAVD4",80,0)
INACT ;INACTIVATE AN ENTRY
"RTN","FBAAVD4",81,0)
 ;This subroutine makes two entries in the NPI multiple field.  One for the activation of a new NPI and the second
"RTN","FBAAVD4",82,0)
 ;is the deactivation of the old NPI.
"RTN","FBAAVD4",83,0)
 S DA(1)=FBIEN,DIC="^FBAAV("_DA(1)_",""NPI"",",DIC(0)="L",X=$$NOW^XLFDT()
"RTN","FBAAVD4",84,0)
 S DIC("DR")=".02////^S X=$S(FBCHECK=2:2,FBCHECK=3:0,1:0);.03////^S X=FBOLDNPI;.04////^S X=DUZ"
"RTN","FBAAVD4",85,0)
 D ^DIC
"RTN","FBAAVD4",86,0)
 S ^FBAAV("NPIHISTORY",FBOLDNPI,DA(1))="" K ^FBAAV("NPI",FBOLDNPI,DA(1))
"RTN","FBAAVD4",87,0)
 S $P(^FBAAV(FBIEN,3),U,2)=""
"RTN","FBAAVD4",88,0)
 I FBCHECK=0 D ACTIVATE
"RTN","FBAAVD4",89,0)
 S ^FBAAV("NPIHISTORY",FBNPI,DA(1))=""
"RTN","FBAAVD4",90,0)
 Q
"RTN","FBAAVD4",91,0)
 ;
"RTN","FBAAVD4",92,0)
ROLLBACK ;ROLL BACK TO THE PREVIOUS NPI AFTER AN NPI IS DELETED
"RTN","FBAAVD4",93,0)
 S (FBNPI,FBRBNPI)=$P(^FBAAV(FBIEN,"NPI",FBRB,0),U,3)
"RTN","FBAAVD4",94,0)
 S $P(^FBAAV(DA(1),3),U,2)=FBRBNPI,^FBAAV("NPI",FBRBNPI,DA(1))=""
"RTN","FBAAVD4",95,0)
 H 1 D ACTIVATE
"RTN","FBAAVD4",96,0)
 Q
"RTN","FBAAVD4",97,0)
 ;
"RTN","FBAAVD4",98,0)
XIT ;CLEAN AND EXIT
"RTN","FBAAVD4",99,0)
 K FBRTN,FBRB,FBNPI,FBBT
"RTN","FBAAVD4",100,0)
 Q
"RTN","FBMRASVR")
0^19^B32449112^B31881185
"RTN","FBMRASVR",1,0)
FBMRASVR ;AISC/CMR-Server Routine for MRA Messages ;11 Apr 2006  2:50 PM
"RTN","FBMRASVR",2,0)
 ;;3.5;FEE BASIS;**9,39,50,97,98**;JAN 30, 1995;Build 54
"RTN","FBMRASVR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBMRASVR",4,0)
 S X="TRAP^FBMRASV2" S @^%ZOSF("TRAP")
"RTN","FBMRASVR",5,0)
 ;K XMY S XMY("G.FEE DEVELOPERS@ISC-ALBANY.VA.GOV")="" D ENT1^XMD
"RTN","FBMRASVR",6,0)
 K ^TMP("FBMRA",$J),^TMP("FBER",$J)
"RTN","FBMRASVR",7,0)
 F I=1:1 X XMREC Q:XMER<0   S:$S($E(XMRG,1)=1:1,$E(XMRG,1)=4:1,1:0)&($S($E(XMRG,2)="C":1,$E(XMRG,2)="A":1,$E(XMRG,2)="Q":1,$E(XMRG,2)="F":1,1:0)) ^TMP("FBMRA",$J,I)=XMRG
"RTN","FBMRASVR",8,0)
TEST S (FBCNT,FBATOT,FBCTOT,FBFTOT,FBQTOT,FBI,FBID,FBER)=0 D STATION^FBAAUTL
"RTN","FBMRASVR",9,0)
 F  S FBI=$O(^TMP("FBMRA",$J,FBI)) Q:'FBI  S FBERR=0,FBJ=^(FBI),FBRT=$E(FBJ,1),FBAC=$E(FBJ,2) D PARSE D
"RTN","FBMRASVR",10,0)
 .I 'FBERR D EXTRACT S FBID=$$CKID(FBVID) S FBERR=$S('FBID:1,1:0) D:'FBERR ADD:FBAC="A"!(FBAC="Q"),CHANGE^FBMRASV1:FBAC="C",FPDS:FBAC="F" I FBERR D ER^FBMRASV2(1,FBJ,.FBER)
"RTN","FBMRASVR",11,0)
 .S:FBAC="A" FBATOT=FBATOT+1 S:FBAC="C" FBCTOT=FBCTOT+1 S:FBAC="Q" FBQTOT=FBQTOT+1 S:FBAC="F" FBFTOT=FBFTOT+1
"RTN","FBMRASVR",12,0)
 D MSG^FBMRASV2 Q
"RTN","FBMRASVR",13,0)
PARSE ;Extracts pharmacy or medical mra data
"RTN","FBMRASVR",14,0)
 D:FBRT=4  ;pharmacy record
"RTN","FBMRASVR",15,0)
 .I $L(FBJ)=167 S FBJ=$E(FBJ,1,166)_"                      $"
"RTN","FBMRASVR",16,0)
 .I $L(FBJ)'=189 D ER^FBMRASV2(2,FBJ,.FBER) S FBERR=1 Q
"RTN","FBMRASVR",17,0)
 .S FBVID=$E(FBJ,9,17),FBCHAIN=$E(FBJ,18,21),FBFEEO=$E(FBJ,22),FBVNAME=$E(FBJ,23,52),FBADD1=$E(FBJ,53,82),FBADD2=$E(FBJ,83,112),FBCITY=$E(FBJ,113,131),FBST=$E(FBJ,132,133),FBZIP=$E(FBJ,134,142),FBMRC=$E(FBJ,143,144)
"RTN","FBMRASVR",18,0)
 .S FBCC=$E(FBJ,145,147),FBPC=$E(FBJ,148),FBTID=$E(FBJ,149),FB1099=$E(FBJ,150),FBVT=$E(FBJ,151),FBICN=$E(FBJ,152,166),FBNPI=$E(FBJ,179,188)
"RTN","FBMRASVR",19,0)
 .S FBBT=$E(FBJ,167,168) F I=1:1:5 S FBSG(I)=$E(FBJ,I*2+167,I*2+168)
"RTN","FBMRASVR",20,0)
 .S FBCHAIN=$$EXTRL(FBCHAIN,1),FBCHAIN=$S(FBCHAIN=0:"",1:FBCHAIN)
"RTN","FBMRASVR",21,0)
 D:FBRT=1  ;medical record
"RTN","FBMRASVR",22,0)
 .I $L(FBJ)=171 S FBJ=$E(FBJ,1,170)_"                      $"
"RTN","FBMRASVR",23,0)
 .I $L(FBJ)'=193 D ER^FBMRASV2(2,FBJ,.FBER) S FBERR=1 Q
"RTN","FBMRASVR",24,0)
 .S FBVID=$E(FBJ,9,19),FBFEEO=$E(FBJ,22),FBSC=$E(FBJ,23,24),FBPART=$E(FBJ,25,26),FBVNAME=$E(FBJ,27,56),FBADD1=$E(FBJ,57,86),FBADD2=$E(FBJ,87,116),FBCITY=$E(FBJ,117,135),FBST=$E(FBJ,136,137),FBZIP=$E(FBJ,138,146),FBNPI=$E(FBJ,183,192)
"RTN","FBMRASVR",25,0)
 .S FBMRC=$E(FBJ,147,148),FBCC=$E(FBJ,149,151),FBPC=$E(FBJ,152),FBTID=$E(FBJ,153),FB1099=$E(FBJ,154),FBVT=$E(FBJ,155),FBICN=$E(FBJ,156,170)
"RTN","FBMRASVR",26,0)
 .S FBBT=$E(FBJ,171,172) F I=1:1:5 S FBSG(I)=$E(FBJ,I*2+171,I*2+172)
"RTN","FBMRASVR",27,0)
 .S FBSC=$S(FBSC="  ":"",$O(^FBAA(161.6,"C",FBSC,0))>0:$O(^FBAA(161.6,"C",FBSC,0)),1:""),FBPART=$$EXTRL(FBPART),FBPART=$O(^FBAA(161.81,"C",+FBPART,0))
"RTN","FBMRASVR",28,0)
 Q
"RTN","FBMRASVR",29,0)
EXTRACT ;Calls to remove leading/trailing spaces and zeros
"RTN","FBMRASVR",30,0)
 D:$D(XRTL) T0^%ZOSV
"RTN","FBMRASVR",31,0)
 S FBVID=$$EXTRT(FBVID),FBVNAME=$$EXTRT(FBVNAME),FBADD1=$$EXTRT(FBADD1),FBADD2=$$EXTRT(FBADD2),FBCITY=$$EXTRT(FBCITY),FBICN=$$EXTRL(FBICN,1),FBST=$$EXTRT(FBST),FBSTN=$E(FBICN,1,3)
"RTN","FBMRASVR",32,0)
 S FBMRC=$$EXTRL(FBMRC)
"RTN","FBMRASVR",33,0)
 S FBBT=$$EXTRT(FBBT)
"RTN","FBMRASVR",34,0)
 F I=1:1 Q:'$D(FBSG(I))  S FBSG(I)=$$EXTRT(FBSG(I)) I FBSG(I)="" K FBSG(I)
"RTN","FBMRASVR",35,0)
 ;Conversion from external to internal format.
"RTN","FBMRASVR",36,0)
 S FBSTATE=$S(FBST']"":"",$D(^DIC(5,"C",FBST)):$O(^DIC(5,"C",FBST,0)),1:""),FBZIP=$S($L(FBZIP)>5:$E(FBZIP,1,5)_"-"_$E(FBZIP,6,$L(FBZIP)),1:FBZIP),FBZIP1=$E(FBZIP,6,9) I '+FBZIP1 S FBZIP=$E(FBZIP,1,5)
"RTN","FBMRASVR",37,0)
 S FBCC=$S(FBCC="   ":"",FBCC']"":"",FBCC="000":"",$D(^DIC(5,+FBSTATE,1,"C",FBCC)):$O(^(FBCC,0)),1:"") I FBCC']"" S FBCC=$P($G(^FBAAV(+FBICN,0)),"^",13)
"RTN","FBMRASVR",38,0)
 D:FBAC="Q" EDIT^FBMRASV2
"RTN","FBMRASVR",39,0)
 S:FBNPI="          " FBNPI=""
"RTN","FBMRASVR",40,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","FBMRASVR",41,0)
 Q
"RTN","FBMRASVR",42,0)
CKID(X) ;determine if 1st 9 char of id is numeric
"RTN","FBMRASVR",43,0)
 ;INPUT:  X = vendor id
"RTN","FBMRASVR",44,0)
 ;OUTPUT: 1 if ok, 0 if not
"RTN","FBMRASVR",45,0)
 Q $S('+$G(X):0,X'?9N.2AN:0,1:1) ;$E(X,1,9)?9N:1,1:0)
"RTN","FBMRASVR",46,0)
 ;
"RTN","FBMRASVR",47,0)
ADD ;Process Add or Unsolicted Add Record
"RTN","FBMRASVR",48,0)
 I FBSTN'=FBSN D ER^FBMRASV2(3,FBJ,.FBER) Q
"RTN","FBMRASVR",49,0)
 D GET D:FBMRA']"" ER^FBMRASV2(5,FBJ,.FBER) I FBMRA]"" S FBCNT=FBCNT+1 D FILEV,DELMRA
"RTN","FBMRASVR",50,0)
 Q
"RTN","FBMRASVR",51,0)
FPDS ;Process FPDS-Only or Unsolicated FPDS-Only Record
"RTN","FBMRASVR",52,0)
 I FBSTN'=FBSN D
"RTN","FBMRASVR",53,0)
 .N EC S (FBICN,FBOUT)=0,FBERR=1,EC="" D
"RTN","FBMRASVR",54,0)
 ..F  S FBICN=$O(^FBAAV("C",FBVID,FBICN)) Q:'FBICN!(FBOUT)  D
"RTN","FBMRASVR",55,0)
 ...Q:$P($G(^FBAAV(FBICN,"ADEL")),"^")="Y"
"RTN","FBMRASVR",56,0)
 ...S EC="" I FBRT=4 Q:$P(^FBAAV(FBICN,0),U,7)'=3  Q:$P(^FBAAV(FBICN,0),U,10)'=FBCHAIN
"RTN","FBMRASVR",57,0)
 ...I FBRT=1 Q:$P($G(^FBAAV(FBICN,0)),U,7)=3
"RTN","FBMRASVR",58,0)
 ...I $E(FBVNAME,1,5)'=$E($P($G(^FBAAV(FBICN,"AMS")),U),1,5),'+$P($G(^FBAAV(FBICN,"ADEL")),U,4) S EC=4 Q
"RTN","FBMRASVR",59,0)
 ...S FBCNT=FBCNT+1,FBOUT=1,FBERR=0 D FILEV
"RTN","FBMRASVR",60,0)
 .I FBERR S:EC']"" EC=4.1 D ER^FBMRASV2(EC,FBJ,.FBER) S FBERR=0
"RTN","FBMRASVR",61,0)
 Q:FBSTN'=FBSN
"RTN","FBMRASVR",62,0)
 D GET D:FBMRA']"" ER^FBMRASV2(5,FBJ,.FBER) I FBMRA]"" S FBCNT=FBCNT+1 D FILEV,DELMRA
"RTN","FBMRASVR",63,0)
 Q
"RTN","FBMRASVR",64,0)
GET ;Get ICN and MRA entry from MRA file.
"RTN","FBMRASVR",65,0)
 S FBICN=$E(FBICN,4,$L(FBICN))
"RTN","FBMRASVR",66,0)
 S FBMRA=$G(^FBAA(161.25,FBICN,0))
"RTN","FBMRASVR",67,0)
 Q
"RTN","FBMRASVR",68,0)
FILEV ;Files MRA fm Austin in Vendor file.
"RTN","FBMRASVR",69,0)
 Q:'$D(^FBAAV(FBICN,0))  N FBNAM S:'FBCC FBCC=$P(^(0),"^",13) S:"ST"'[FBTID FBTID=""
"RTN","FBMRASVR",70,0)
 I FBAC="C",($G(FBICN1)]""),(FBICN1'=FBICN) S DIK="^FBAAV(",DA=FBICN D ^DIK K DA,DIK S %X="^FBAAV(FBICN1,",%Y="^FBAAV(FBICN," D %XY^%RCR K %X,%Y S DIK="^FBAAV(",DA=FBICN D IX1^DIK K DIK,DA
"RTN","FBMRASVR",71,0)
 S DIE="^FBAAV(",DA=FBICN
"RTN","FBMRASVR",72,0)
 S DR="1////^S X=FBVID;2////^S X=FBADD1;2.5////@;2.5////^S X=FBADD2;3////^S X=FBCITY;4////^S X=FBSTATE;5////^S X=FBZIP;5.5////^S X=FBCC;5.18////^S X=FBMRC;"_$S(FBRT=1:".05////^S X=FBSC;7////^S X=FBPART",1:"8////^S X=FBCHAIN")
"RTN","FBMRASVR",73,0)
 S DR(1,161.2,1)="12.1////^S X=DT;13.1////^S X=$S(FBSTN]"""":FBSTN,1:""000"");30.01////^S X=FBVNAME;30.03////^S X=FB1099;30.04////^S X=FBVT;30.05////^S X=FBPC;30.06////^S X=FBTID"_$S(FBBT]"":";24////^S X=FBBT",1:"")_";41.01////^S X=FBNPI"
"RTN","FBMRASVR",74,0)
 L +^FBAAV(FBICN):1
"RTN","FBMRASVR",75,0)
 D ^DIE K DIE,DA,DR
"RTN","FBMRASVR",76,0)
 I $O(FBSG(0)) D UPDGRP^FBAAUTL6(FBICN)
"RTN","FBMRASVR",77,0)
 L -^FBAAV(FBICN)
"RTN","FBMRASVR",78,0)
 Q
"RTN","FBMRASVR",79,0)
DELMRA ;Deletes MRA entry in FB Vendor Correction File.
"RTN","FBMRASVR",80,0)
 S FBVIEN=$S(FBAC="C":FBICN1,1:FBICN),DIE="^FBAA(161.25,"
"RTN","FBMRASVR",81,0)
 I FBAC="C"!(FBAC="Q"),$D(^FBAA(161.25,"AF",FBVIEN)) S FB1=0 F  S FB1=$O(^FBAA(161.25,"AF",FBVIEN,FB1)) Q:'FB1  S DA=FB1,FBLDA=$P($G(^FBAA(161.25,FBVIEN,0)),"^",6),DR="5////^S X=FBLDA" D
"RTN","FBMRASVR",82,0)
 .D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAA(161.25,DA)
"RTN","FBMRASVR",83,0)
 .K FBLOCK
"RTN","FBMRASVR",84,0)
 S DA=FBVIEN,DIK="^FBAA(161.25," D ^DIK K DA,DIK,FB1,FBLDA,FBVIEN
"RTN","FBMRASVR",85,0)
 Q
"RTN","FBMRASVR",86,0)
EXTRL(V,T) ;Removes leading spaces or zeros.
"RTN","FBMRASVR",87,0)
 ;V=variable to be parced
"RTN","FBMRASVR",88,0)
 ;T=1 remove leading zeros, T="" remove leading spaces
"RTN","FBMRASVR",89,0)
 ;Q VAR
"RTN","FBMRASVR",90,0)
 S T=$S($D(T):0,1:" ")
"RTN","FBMRASVR",91,0)
 F  Q:$E(V)'=T  S V=$E(V,2,$L(V))
"RTN","FBMRASVR",92,0)
 Q V
"RTN","FBMRASVR",93,0)
EXTRT(V,T) ;Removes trailing spaces or zeros.
"RTN","FBMRASVR",94,0)
 ;V=variable to be parced
"RTN","FBMRASVR",95,0)
 ;T=1 remove trailing zeros, T="" remove trailing spaces
"RTN","FBMRASVR",96,0)
 N FBL
"RTN","FBMRASVR",97,0)
 S T=$S($D(T):0,1:" ")
"RTN","FBMRASVR",98,0)
 F  S FBL=$L(V) Q:$E(V,FBL)'=T  S V=$E(V,1,FBL-1)
"RTN","FBMRASVR",99,0)
 Q V
"RTN","FBNPILK")
0^25^B2424699^n/a
"RTN","FBNPILK",1,0)
FBNPILK ;AISC/CLT, NPI lookup routine ;11 Apr 2006  3:02 PM
"RTN","FBNPILK",2,0)
 ;;3.5;FEE BASIS;**98**;JAN 30, 1995;Build 54
"RTN","FBNPILK",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBNPILK",4,0)
 ;
"RTN","FBNPILK",5,0)
 ;This routine receives the IEN for the Fee Basis Vendor file (#161.2)
"RTN","FBNPILK",6,0)
 ;and returns the NPI for that entry.
"RTN","FBNPILK",7,0)
 ;
"RTN","FBNPILK",8,0)
 ;This routine also performs a duplicate check to insure that only one vendor has
"RTN","FBNPILK",9,0)
 ;a specific NPI in the FEE BASIS VENDOR file (#161.2)
"RTN","FBNPILK",10,0)
 ;
"RTN","FBNPILK",11,0)
EN(IEN) ;ENTRY POINT IF IEN IN FEE BASIS VENDOR FILE (#161.2) IS KNOWN
"RTN","FBNPILK",12,0)
 ;The variable passed in is the IEN or DA or the entry in the FEE BASIS VENDOR
"RTN","FBNPILK",13,0)
 ;file (#161.2).  Returned will be the variable FBNPI which is the NPI
"RTN","FBNPILK",14,0)
 ;of the entry.  If the NPI is not entered the variable FBNPI will equal null
"RTN","FBNPILK",15,0)
 ;and 10 spaces will be returned.
"RTN","FBNPILK",16,0)
 ;
"RTN","FBNPILK",17,0)
 N DIC,Y,FBNPI
"RTN","FBNPILK",18,0)
 D:IEN=""
"RTN","FBNPILK",19,0)
 .S DIC="^FBAAV(",DIC(0)="AEQM",DIC("A")="ENTER VENDOR NAME: " D ^DIC G:Y'>0 XIT
"RTN","FBNPILK",20,0)
 .S IEN=+Y
"RTN","FBNPILK",21,0)
 S FBNPI=$$GET1^DIQ(161.2,IEN,41.01)
"RTN","FBNPILK",22,0)
 Q $S(FBNPI="":"          ",1:FBNPI)
"RTN","FBNPILK",23,0)
 ;
"RTN","FBNPILK",24,0)
DUP(FBNPI) ;LOOK FOR DUPLICATE ENTRIES
"RTN","FBNPILK",25,0)
 ;This subroutine will review the FEE BASIS VENDOR file (#161.2) cross reference NPI to
"RTN","FBNPILK",26,0)
 ;determine if the NPI entered is unique and not assigned to another entity.
"RTN","FBNPILK",27,0)
 ;This subroutine takes the value of the variable X from the fileman entry into file 161.2,
"RTN","FBNPILK",28,0)
 ;field 41.01 (NPI) through the input transform using the input variable of X, assigns it
"RTN","FBNPILK",29,0)
 ;to the variable FBNPI and performs the lookup using the "NPIHISTORY" cross reference in the file
"RTN","FBNPILK",30,0)
 ;#161.2.  If the NPI is not a duplicate entry a null value will be returned in FBRTN.  If
"RTN","FBNPILK",31,0)
 ;the variable FBRTN is a number larger than zero it means the transform lookup has failed
"RTN","FBNPILK",32,0)
 ;and the NPI entered is a duplicate entry.  This tag expects the variable DA to be the ien
"RTN","FBNPILK",33,0)
 ;of the current entry in field name (#.01).
"RTN","FBNPILK",34,0)
 ;The input transform is coded as follows: K:$L(X)>10!($L(X)<10)!('$$CHKDGT^XUSNPI(X))!($$DUP^FBNPILK(X)>0) X
"RTN","FBNPILK",35,0)
 N FBLOOP,FBRTN S FBRTN=""
"RTN","FBNPILK",36,0)
 S FBLOOP="" F  S FBLOOP=$O(^FBAAV("NPIHISTORY",FBNPI,FBLOOP)) Q:FBLOOP=""  S FBRTN=$G(FBLOOP) D:FBLOOP'=DA!('$D(^FBAAV("NPI",FBNPI,DA)))
"RTN","FBNPILK",37,0)
 .W !,"The NPI of ",FBNPI," is now, or was in the past, assigned to: ",?47,$P(^FBAAV(FBLOOP,0),U,1)
"RTN","FBNPILK",38,0)
 Q FBRTN
"RTN","FBNPILK",39,0)
XIT ;EXIT AND CLEAN
"RTN","FBNPILK",40,0)
 K DIC,X,Y
"RTN","FBNPILK",41,0)
 Q "          "
"RTN","FBPCR")
0^15^B63491421^B60871910
"RTN","FBPCR",1,0)
FBPCR ;AISC/DMK,GRR,TET-POTENTIAL COST RECOVERY OUTPUT DRIVER ;23 May 2006  10:06 AM
"RTN","FBPCR",2,0)
 ;;3.5;FEE BASIS;**12,48,76,98**;JAN 30, 1995;Build 54
"RTN","FBPCR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR",4,0)
DOC ;Refer to fbdoc, tag fbpcr, for documentation of fbpcr* routines
"RTN","FBPCR",5,0)
PSF ;select one/many/all primary service failities
"RTN","FBPCR",6,0)
 S FBARRLTC=""
"RTN","FBPCR",7,0)
 W !! S DIC="^DIC(4,",VAUTSTR="Primary Service Facility",VAUTNI=2,VAUTVB="FBPSV" D FIRST^VAUTOMA K DIC I Y=-1 G EXIT
"RTN","FBPCR",8,0)
ARRAY ;set fee program array for all programs
"RTN","FBPCR",9,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPCR",10,0)
 I '$D(FBPROG) G EXIT
"RTN","FBPCR",11,0)
 ;prepare array with LTC POV codes
"RTN","FBPCR",12,0)
 D MKARRLTC^FBPCR4
"RTN","FBPCR",13,0)
 ;what party to include
"RTN","FBPCR",14,0)
 K DIR
"RTN","FBPCR",15,0)
 S DIR(0)="SO^P:Patient;I:Insurance;B:Both",DIR("A")="Include (P)atient Co-pays / (I)nsurance / (B)oth",DIR("B")="Both"
"RTN","FBPCR",16,0)
 S DIR("?")=" Select type of recover to include",DIR("?",1)=" P - include only recover from patient copays",DIR("?",2)=" I - include only recover from insurance",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",17,0)
 D ^DIR S FBPARTY=$S($G(Y(0))="Patient":1,$G(Y(0))="Insurance":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",18,0)
 K DIR
"RTN","FBPCR",19,0)
 G:FBPARTY=0 EXIT
"RTN","FBPCR",20,0)
 ;what type of copay to include
"RTN","FBPCR",21,0)
 S FBCOPAY=3
"RTN","FBPCR",22,0)
 I FBPARTY'=2 D
"RTN","FBPCR",23,0)
 . S DIR(0)="SO^M:MeansTest;L:LTC;B:Both",DIR("A")="Include (M)eans Test Co-pays /(L)TC Co-pays /(B)oth",DIR("B")="Both"
"RTN","FBPCR",24,0)
 . S DIR("?")=" Select services to include",DIR("?",1)=" M - include only Means Test copays",DIR("?",2)=" L - include only LTC copays",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",25,0)
 . D ^DIR S FBCOPAY=$S($G(Y(0))="LTC":1,$G(Y(0))="MeansTest":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",26,0)
 . K DIR
"RTN","FBPCR",27,0)
 G:FBCOPAY=0 EXIT
"RTN","FBPCR",28,0)
 ;
"RTN","FBPCR",29,0)
 ;include patients if their insurance informations is unavailable?
"RTN","FBPCR",30,0)
 S FBINCUNK=0
"RTN","FBPCR",31,0)
 I FBPARTY=2!(FBPARTY=3) D
"RTN","FBPCR",32,0)
 . S FBINCUNK=1
"RTN","FBPCR",33,0)
 . N Y,X
"RTN","FBPCR",34,0)
 . W !!
"RTN","FBPCR",35,0)
 . S DIR("A")="Do you want to include patients whose insurance status is unavailable? "
"RTN","FBPCR",36,0)
 . S DIR("?")="Please answer Yes or No."
"RTN","FBPCR",37,0)
 . S DIR("B")="YES",DIR(0)="YA^^"
"RTN","FBPCR",38,0)
 . D ^DIR K DIR
"RTN","FBPCR",39,0)
 . I $G(DIRUT) S FBINCUNK=-1 Q
"RTN","FBPCR",40,0)
 . I $G(Y)=0 S FBINCUNK=0
"RTN","FBPCR",41,0)
 I FBINCUNK=-1 G EXIT ;uparrow - exit
"RTN","FBPCR",42,0)
 ;
"RTN","FBPCR",43,0)
DATE ;select date range
"RTN","FBPCR",44,0)
 D DATE^FBAAUTL I FBPOP G PSF
"RTN","FBPCR",45,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPCR",46,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPCR",47,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBINSIBAPI"),DIC
"RTN","FBPCR",48,0)
 ;
"RTN","FBPCR",49,0)
 S VAR="FBINCUNK^FBARRLTC^FBARRLTC(^FBPARTY^FBCOPAY^FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPSV^FBPSV(^FBPROG(",VAL=VAR,PGM="DQ^FBPCR",IOP="Q" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPCR",50,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPCR",51,0)
SORT ;sort driver for payment output(s)
"RTN","FBPCR",52,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPCR",53,0)
 .I FBPI=2 D EN^FBPCR2 ;outpatient payments
"RTN","FBPCR",54,0)
 .I FBPI=3 D EN^FBPCR3 ;pharmacy payments
"RTN","FBPCR",55,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&($D(FBPROG(7))) FBPI=67 D EN^FBPCR67 S:FBPI=67 FBPI=7 ;civil hospital/cnh payments
"RTN","FBPCR",56,0)
PRINT ;print driver for payment output(s)
"RTN","FBPCR",57,0)
 I $G(^TMP($J,"FBINSIBAPI"))>0 D HDRUNK
"RTN","FBPCR",58,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPCR",59,0)
 S FBSTA=0
"RTN","FBPCR",60,0)
 S FBPSF=0 F  S FBPSF=$O(^TMP($J,"FB",FBPSF)) Q:'FBPSF!FBOUT  D STA S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPSF,FBPT)) Q:FBPT']""!FBOUT  S DFN=$P(FBPT,";",2) D VET S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPCR",61,0)
 .I FBPSF_FBPT'=FBSTA D HDR Q:FBOUT
"RTN","FBPCR",62,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) D PRINT^FBPCR2 Q
"RTN","FBPCR",63,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR3 Q
"RTN","FBPCR",64,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR671 Q
"RTN","FBPCR",65,0)
OUT I $G(^TMP($J,"FBINSIBAPI"))>0 D ERRHDL^FBPCR4
"RTN","FBPCR",66,0)
 I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPCR",67,0)
 D EXIT G PSF
"RTN","FBPCR",68,0)
 Q
"RTN","FBPCR",69,0)
EXIT ;kill and quit
"RTN","FBPCR",70,0)
KILL ;kill all variables set in the FBPCR* routines, other than fbx
"RTN","FBPCR",71,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB")
"RTN","FBPCR",72,0)
 K A1,A2,A3,BEGDATE,C,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE,FBPDXC,FBPARTY,FBCOPAY,FBARRLTC,FBINCUNK
"RTN","FBPCR",73,0)
 K FBAAA,FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCATC,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBDX,FBDX1,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD
"RTN","FBPCR",74,0)
 K FBI,FBID,FBIEN,FBIN,FBINS,FBINVN,FBIX,FBJ,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIN,FBPNAME,FBPROC,FBPROC1,FBPROG,FBPSF,FBPSFNAM,FBPSFNUM,FBPSV,FBPT,FBPV,FBQTY,FBREIM,FBRX
"RTN","FBPCR",75,0)
 K FBSC,FBSL,FBSTA,FBSTR,FBSUSP,FBTA,FBTYPE,FBV,FBVCHAIN,FBVEN,FBVENID,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,IOP,J,K,L,M,N,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z,FBSTANPI,FBXX
"RTN","FBPCR",76,0)
 Q
"RTN","FBPCR",77,0)
WMSG ;write message if no matches found
"RTN","FBPCR",78,0)
 D HDR W !!?3,"There are no potential cost recoveries on file"
"RTN","FBPCR",79,0)
 W !?5,"for specified date range:  ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",80,0)
 I 'FBPSV D
"RTN","FBPCR",81,0)
 .W ",",!?5,"and selected Primary Service Area(s):"
"RTN","FBPCR",82,0)
 .S FBPSF=0 F  S FBPSF=$O(FBPSV(FBPSF)) Q:'FBPSF  W !?31,$G(FBPSV(FBPSF))
"RTN","FBPCR",83,0)
 E  W !?5,"and ALL Primary Service Areas "
"RTN","FBPCR",84,0)
 W ".",*7,!!
"RTN","FBPCR",85,0)
 Q
"RTN","FBPCR",86,0)
 ;
"RTN","FBPCR",87,0)
CATC(DFN,FBDT,FBPOV) ;
"RTN","FBPCR",88,0)
 ;treats all copays as Means test for date < 3020705 (JULY 5,2002)
"RTN","FBPCR",89,0)
 ;check if patient is liable for copay
"RTN","FBPCR",90,0)
 ;INPUT:  
"RTN","FBPCR",91,0)
 ; DFN = IEN of Patient file
"RTN","FBPCR",92,0)
 ; FBDT= Date
"RTN","FBPCR",93,0)
 ; FBPOV = POV code (for LTC determination)
"RTN","FBPCR",94,0)
 ;OUTPUT:  
"RTN","FBPCR",95,0)
 ;0 - the patient is not liable for any co-pay;
"RTN","FBPCR",96,0)
 ;1 - if Means test catc or pending adjudication and agree to pay deduc
"RTN","FBPCR",97,0)
 ;2 - the patient is liable for LTC co-pay;
"RTN","FBPCR",98,0)
 ;3 - no 1010EC on file
"RTN","FBPCR",99,0)
 ;4 - more analysis is needed to determine the patient liability
"RTN","FBPCR",100,0)
 N FBLTC,FBISLTC
"RTN","FBPCR",101,0)
 S FBCATC=$$BIL^DGMTUB(DFN,FBDT)
"RTN","FBPCR",102,0)
 I '$D(FBPOV)!(FBDT<3020705) Q $S(FBCATC:1,1:0)
"RTN","FBPCR",103,0)
 S FBISLTC=$$ISLTC^FBPCR4(FBPOV)
"RTN","FBPCR",104,0)
 I FBISLTC=0 Q $S(FBCATC:1,1:0)  ;Means test
"RTN","FBPCR",105,0)
 I FBISLTC=2 Q 0  ;LTC-service, but LTC-copay is not applicable
"RTN","FBPCR",106,0)
 S FBLTC=$$LTCST^FBPCR4(DFN,FBDT)
"RTN","FBPCR",107,0)
 I FBLTC=2 Q 2  ;LTC copay
"RTN","FBPCR",108,0)
 I FBLTC=0 Q 3  ;no 1010EC on file
"RTN","FBPCR",109,0)
 I FBLTC=4 Q 4  ;more info needed
"RTN","FBPCR",110,0)
 Q 0  ;exemption from LTC -copay
"RTN","FBPCR",111,0)
 ;
"RTN","FBPCR",112,0)
VET ;set vet name/ssn/dob info
"RTN","FBPCR",113,0)
 ;INPUT:  DFN  = IEN of Patient file
"RTN","FBPCR",114,0)
 ;      FBPI = IEN of fee program (optional)
"RTN","FBPCR",115,0)
 ;OUTPUT:  FBPNAME = Patient's name
"RTN","FBPCR",116,0)
 ;      FBPID   = Patient's pid
"RTN","FBPCR",117,0)
 ;      FBDOB   = Patient's dob (if pharmacy fee program)
"RTN","FBPCR",118,0)
 N N
"RTN","FBPCR",119,0)
 S N=$G(^DPT(DFN,0)),FBPNAME=$P(N,U),FBPID=$$SSN^FBAAUTL(DFN),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPCR",120,0)
 Q
"RTN","FBPCR",121,0)
STA ;set station name & number
"RTN","FBPCR",122,0)
 ;INPUT = FBPSF - IEN to institution file
"RTN","FBPCR",123,0)
 ;OUTPUT = FBPSFNAM = station name
"RTN","FBPCR",124,0)
 ;      FBPSFNUM = station number
"RTN","FBPCR",125,0)
 S FBPSFNAM=$P($G(^DIC(4,FBPSF,0)),U),FBPSFNUM=$P($G(^DIC(4,FBPSF,99)),U)
"RTN","FBPCR",126,0)
 S:FBPSFNAM=+FBPSFNAM FBPSFNAM="UNKNOWN"
"RTN","FBPCR",127,0)
 S FBSTANPI=$S($G(FBPSFNAM)="":"",FBPSFNAM="UNKNOWN":"",1:$P($$NPI^XUSNPI("Organization_ID",FBPSF),U,1))
"RTN","FBPCR",128,0)
 Q
"RTN","FBPCR",129,0)
PAGE ;form feed when new station/patient
"RTN","FBPCR",130,0)
 S FBSTA=$G(FBPSF)_$G(FBPT)
"RTN","FBPCR",131,0)
 I FBCRT&(FBPG'=0) D CR Q:FBOUT
"RTN","FBPCR",132,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPCR",133,0)
 S FBPG=FBPG+1
"RTN","FBPCR",134,0)
 Q
"RTN","FBPCR",135,0)
CR ;read for display
"RTN","FBPCR",136,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR",137,0)
 Q
"RTN","FBPCR",138,0)
HDR ;general header for potential recoveries
"RTN","FBPCR",139,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",140,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",141,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",142,0)
 W !?(IOM-14/2),"NPI: ",$S($G(FBSTANPI)="":"",$G(FBSTANPI)=-1:"",1:$G(FBSTANPI))
"RTN","FBPCR",143,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",144,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",145,0)
 W !,"Patient: ",$G(FBPNAME),?40,"Pat. ID: ",$G(FBPID),?62,"DOB: ",$G(FBDOB)
"RTN","FBPCR",146,0)
 W !
"RTN","FBPCR",147,0)
 I FBINCUNK=1,$D(^TMP($J,"FBINSIBAPI",+$G(DFN))) W ">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",148,0)
 W !?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBPCR",149,0)
 W !,FBDASH
"RTN","FBPCR",150,0)
 W ! D:$D(DFN) INS^DGRPDB
"RTN","FBPCR",151,0)
 Q
"RTN","FBPCR",152,0)
HDRUNK ;Warning message if patient's insurance status is unknown
"RTN","FBPCR",153,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",154,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",155,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",156,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",157,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",158,0)
 W !,"------------------------------ !!! WARNING !!! --------------------------------"
"RTN","FBPCR",159,0)
 W !,"This report is incomplete due to problems with obtaining insurance information"
"RTN","FBPCR",160,0)
 W !,"for those patients listed in a separate section in the end of the report. You"
"RTN","FBPCR",161,0)
 W !,"may want to rerun the report again to get more accurate results."
"RTN","FBPCR",162,0)
 W !,FBDASH
"RTN","FBPCR",163,0)
 I FBINCUNK=1 D
"RTN","FBPCR",164,0)
 . W !,"Note: You have chosen to include patients with unknown insurance status in"
"RTN","FBPCR",165,0)
 . W !,"this report. Please be aware that these patients will be treated as if they"
"RTN","FBPCR",166,0)
 . W !,"have billable insurance and their treatment details will be marked accordingly."
"RTN","FBPCR",167,0)
 . W !,"The names of these patients will be accompanied with the following message"
"RTN","FBPCR",168,0)
 . W !,"to order to identify them:"
"RTN","FBPCR",169,0)
 . W !,">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",170,0)
 . W !,FBDASH
"RTN","FBPCR",171,0)
 Q
"RTN","FBPCR2")
0^16^B35427334^B34437431
"RTN","FBPCR2",1,0)
FBPCR2 ;AISC/DMK,GRR,TET-OUTPATIENT POTENTIAL COST RECOVERY SORT/PRINT ;07/01/2006
"RTN","FBPCR2",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98**;JAN 30, 1995;Build 54
"RTN","FBPCR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR2",4,0)
EN ;entry point
"RTN","FBPCR2",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",6,0)
SORT ;sort by date finalized, patient, vendor, treatment ien, service ien
"RTN","FBPCR2",7,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAAC("AK",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAAC("AK",I,J)) Q:'J  D
"RTN","FBPCR2",8,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR2",9,0)
 .S K=0  F  S K=$O(^FBAAC("AK",I,J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AK",I,J,K,L)) Q:'L  D SETTR S M=0 F  S M=$O(^FBAAC("AK",I,J,K,L,M)) Q:'M  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",10,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR2",11,0)
KILL ;kill variables set in this routine
"RTN","FBPCR2",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCP,FBDOB,FBDOS,FBDT,FBDT1,FBIN,FBINS,FBOB,FBP,FBPAT,FBPCR,FBPDX,FBPDXC,FBPID,FBPNAME,FBPSF,FBSC,FBTA,FBTYPE,FBVEN,FBVID,FBVNAME,FBVP,I,J,K,L,M,T,Y,FBMODLE
"RTN","FBPCR2",13,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ
"RTN","FBPCR2",14,0)
 Q
"RTN","FBPCR2",15,0)
SET ;set variables - also entry point from FBPCR67
"RTN","FBPCR2",16,0)
 N FBPCR,FBX
"RTN","FBPCR2",17,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:'+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"")
"RTN","FBPCR2",18,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBPCR2",19,0)
 S FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2)_"/"_$S($P($G(^(3)),U,2)]"":$P(^(3),U,2),1:"**********"),1:"")
"RTN","FBPCR2",20,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23),FBPSF=+$P(Y,U,12)
"RTN","FBPCR2",21,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPCR2",22,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPCR2",23,0)
 Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))  S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$S(FBSC["N":$$INSURED^FBPCR4(DFN,FBPCR),1:0) Q:'FBCATC&'FBINS
"RTN","FBPCR2",24,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPCR2",25,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPCR2",26,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBPCR2",27,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPCR2",28,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR2",29,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPCR2",30,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPCR2",31,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPCR2",32,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPCR2",33,0)
 S FBCSID=$P(FBY,U,16) ;patient account number
"RTN","FBPCR2",34,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPCR2",35,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPCR2",36,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPCR2",37,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPCR2",38,0)
 ;output format
"RTN","FBPCR2",39,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),A3=$J(A3,6,2),FBIN=$J(FBIN,7)
"RTN","FBPCR2",40,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPCR2",41,0)
 Q
"RTN","FBPCR2",42,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR2",43,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR2",44,0)
 I $P(Y,U,9)'=FBPI Q
"RTN","FBPCR2",45,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR2",46,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR2",47,0)
 Q
"RTN","FBPCR2",48,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=".00"
"RTN","FBPCR2",49,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)) S FBTA=$O(^FBAAC(J,3,"AB",D,0)),A3=$S($P(^FBAAC(J,3,FBTA,0),"^",3)]"":$P(^(0),"^",3),1:.0001)
"RTN","FBPCR2",50,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPCR2",51,0)
 Q
"RTN","FBPCR2",52,0)
EN1 ;entry point to set variables, called by fbpcr67, anc
"RTN","FBPCR2",53,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPCR2",54,0)
 D SETTR,SET
"RTN","FBPCR2",55,0)
 Q
"RTN","FBPCR2",56,0)
PRINT ;write output
"RTN","FBPCR2",57,0)
 D HDR1 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR2",58,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S M=0 F  S M=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M)) Q:'M  D  Q:FBOUT
"RTN","FBPCR2",59,0)
 ..I ($Y+4)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR2",60,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M),FBCATC=$P(FBDATA,U,13),FBINS=$P(FBDATA,U,14)
"RTN","FBPCR2",61,0)
 ..S FBADJ=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBADJ"))
"RTN","FBPCR2",62,0)
 ..;S FBLOC=1_U_12_U_23_U_33_U_47_U_57_U_63_U_71
"RTN","FBPCR2",63,0)
 ..W !
"RTN","FBPCR2",64,0)
 ..;S I=1 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",65,0)
 ..W ?1,$P(FBDATA,U,1)
"RTN","FBPCR2",66,0)
 ..;S I=2 W ?$P(FBLOC,U,I),$P($P(FBDATA,U,I),",")
"RTN","FBPCR2",67,0)
 ..W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR2",68,0)
 ..;F I=3:1:8 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",69,0)
 ..W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR2",70,0)
 ..W ?43,$P(FBDATA,U,6)
"RTN","FBPCR2",71,0)
 ..W ?54,$P(FBDATA,U,7)
"RTN","FBPCR2",72,0)
 ..W ?64,$P(FBDATA,U,8)
"RTN","FBPCR2",73,0)
 ..I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR2",74,0)
 ...N FBI,FBMOD
"RTN","FBPCR2",75,0)
 ...F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR2",76,0)
 ....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPCR2",77,0)
 ....W !,?16,"-",FBMOD
"RTN","FBPCR2",78,0)
 ..W !,$P(FBDATA,U,3)
"RTN","FBPCR2",79,0)
 ..W ?13,$P(FBDATA,U,4)
"RTN","FBPCR2",80,0)
 ..W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR2",81,0)
 ..W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR2",82,0)
 ..W ?48,$P(FBADJ,U,5)
"RTN","FBPCR2",83,0)
 ..W ?60,$P(FBADJ,U,6)
"RTN","FBPCR2",84,0)
 ..S FBPDX=$P(FBDATA,U,10),FBPDXC=$$ICD9^FBCSV1(FBPDX,$$DT2FMDT^FBCSV1($P(FBDATA,U))),$P(FBDATA,U,10)=$E($$ICD9P^FBCSV1(FBPDX,3,$$DT2FMDT^FBCSV1($P(FBDATA,U))),1,19),FBPDXC=$S(FBPDXC="":"",1:" ("_FBPDXC_")")
"RTN","FBPCR2",85,0)
 ..W !?3,"Primary Dx: ",$P(FBDATA,U,10),FBPDXC,?45,"S/C Condition? ",$P(FBDATA,U,9) W ?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPCR2",86,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR2",87,0)
 ...W !?5,">>>"
"RTN","FBPCR2",88,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR2",89,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",90,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",91,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR2",92,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR2",93,0)
 ..S A3=".00"
"RTN","FBPCR2",94,0)
 Q
"RTN","FBPCR2",95,0)
HDR ;main header
"RTN","FBPCR2",96,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR2",97,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR2",98,0)
 ;W !!,?2,"Svc Date",?11,"CPT-MOD",?23,"Amount",?33," Amount",?42,"Susp",?49,"Travel",?57,"Batch",?63,"Invoice",?71,"Voucher"
"RTN","FBPCR2",99,0)
 ;W !,?23,"Claimed",?35,"Paid",?42,"Code",?50,"Paid",?58,"Num",?64,"Num",?72,"Date",!,FBDASH
"RTN","FBPCR2",100,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR2",101,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR2",102,0)
 Q
"RTN","FBPCR2",103,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR2",104,0)
 I ($Y+6)>IOSL D HDR Q:FBOUT
"RTN","FBPCR2",105,0)
 ;W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID/NPI: ",$P(FBVI,";",2)
"RTN","FBPCR2",106,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR2",107,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR2",108,0)
 Q
"RTN","FBPCR2",109,0)
CR ;read for display
"RTN","FBPCR2",110,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR2",111,0)
 Q
"RTN","FBPCR2",112,0)
PAGE ;new page
"RTN","FBPCR2",113,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR2",114,0)
 Q
"RTN","FBPCR3")
0^17^B24986170^B24418678
"RTN","FBPCR3",1,0)
FBPCR3 ;AISC/GRR,TET-PHARMACY POTENTIAL COST RECOVERY, SORT/PRINT ;30 Jun 2006  1:49 PM
"RTN","FBPCR3",2,0)
 ;;3.5;FEE BASIS;**48,69,98**;JAN 30, 1995;Build 54
"RTN","FBPCR3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR3",4,0)
EN ;entry point
"RTN","FBPCR3",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",6,0)
SORT ;sort by date certified for payment, patient, invoice number ien, rx ien
"RTN","FBPCR3",7,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAA(162.1,"AA",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAA(162.1,"AA",I,J)) Q:'J  D
"RTN","FBPCR3",8,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR3",9,0)
 .S K=0 F  S K=$O(^FBAA(162.1,"AA",I,J,K)) Q:K'>0  S L=0 F  S L=$O(^FBAA(162.1,"AA",I,J,K,L)) Q:L'>0  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",10,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR3",11,0)
KILL ;kill variables set in sort
"RTN","FBPCR3",12,0)
 K A1,A2,DFN,FBAAA,FBAC,FBAP,FBBATCH,FBCATC,FBDA1,FBDRUG,FBFD,FBFD1,FBIN,FBINS,FBINVN,FBLOC,FBPAT,FBPD,FBPSF,FBPV,FBQTY,FBREIM,FBRX,FBSC,FBSTR,FBSUSP,FBVEN,FBVI,I,J,K,L,N,V,Y
"RTN","FBPCR3",13,0)
 K FBVNAME,FBVID,FBVCHAIN,FBPNAME,FBPID,FBDOB
"RTN","FBPCR3",14,0)
 K FBADJLA,FBADJLR,TAMT,FBRRMKL
"RTN","FBPCR3",15,0)
 D KILL^FBPCR2
"RTN","FBPCR3",16,0)
 Q
"RTN","FBPCR3",17,0)
SET ;set variables
"RTN","FBPCR3",18,0)
 N FBX
"RTN","FBPCR3",19,0)
 S Y(0)=$G(^FBAA(162.1,+K,"RX",+L,0)) I Y(0)']""!($P(Y(0),U,9)=1) Q
"RTN","FBPCR3",20,0)
 I $G(^FBAA(162.1,+K,"RX",+L,"FBREJ"))]"" Q
"RTN","FBPCR3",21,0)
 S Y(2)=$G(^FBAA(162.1,+K,0))
"RTN","FBPCR3",22,0)
 S Y(1)=$G(^FBAA(162.1,+K,"RX",+L,2))
"RTN","FBPCR3",23,0)
 S FBX=$$ADJLRA^FBRXFA(+L_","_+K_",")
"RTN","FBPCR3",24,0)
 S FBADJLR=$P(FBX,U) ;adjustment code
"RTN","FBPCR3",25,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR3",26,0)
 S TAMT=$FN($P(Y(0),"^",7),"",2) ;suspend amount
"RTN","FBPCR3",27,0)
 S FBRRMKL=$$RRL^FBRXFR(+L_","_+K_",") ;remitt remarks
"RTN","FBPCR3",28,0)
 S FBPSF=+$P(Y(1),U,5),FBFD=$P(Y(0),U,3),FBAAA=$P(Y(0),U,5)
"RTN","FBPCR3",29,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))  S FBCATC=$$CATC^FBPCR(DFN,FBFD)
"RTN","FBPCR3",30,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBAAA,+$O(^FBAAA("AIC",FBAAA,-FBFD)),0))="Y":1,1:0)
"RTN","FBPCR3",31,0)
 S FBINS=$S($$INSCK(FBFD,FBAAA,FBPI)=1:$$INSURED^FBPCR4(DFN,FBFD),1:0)
"RTN","FBPCR3",32,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR3",33,0)
 S FBINVN=$P(Y(2),U) D VEN
"RTN","FBPCR3",34,0)
 S FBRX=$P(Y(0),U,1),FBDRUG=$P(Y(0),U,2),FBAC=$P(Y(0),U,4),FBAP=$P(Y(0),U,16),FBSUSP=$P(Y(0),U,8),FBPD=$P(Y(0),U,19),FBBATCH=$P(Y(0),U,17),FBBATCH=$P($G(^FBAA(161.7,+FBBATCH,0)),U)
"RTN","FBPCR3",35,0)
 I FBSUSP]"" S FBSUSP=$P($G(^FBAA(161.27,+FBSUSP,0)),U)
"RTN","FBPCR3",36,0)
 S FBREIM=$S($P(Y(0),U,20)="R":"*",1:""),FBSTR=$P(Y(0),U,12),FBQTY=$P(Y(0),U,13),A1=$J(FBAC,6,2),A2=$J(FBAP,6,2),FBPV=""
"RTN","FBPCR3",37,0)
 S FBPD=$$DATX^FBAAUTL(FBPD),FBFD=$$DATX^FBAAUTL(FBFD)
"RTN","FBPCR3",38,0)
 S FBPV=$S($P(Y(1),U,3)="V":"#",1:""),FBFD1=$S(FBPV="":" ",1:FBPV)_$S(FBREIM="":" ",1:FBREIM)_FBFD,FBRX="Rx: "_FBRX
"RTN","FBPCR3",39,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR3",40,0)
 Q
"RTN","FBPCR3",41,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR3",42,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR3",43,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L)=FBFD1_U_FBRX_U_FBDRUG_U_FBSTR_U_FBQTY_U_A1_U_A2_U_FBSUSP_U_FBINVN_U_FBBATCH_U_FBPD_U_FBDOB_U_FBVCHAIN_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR3",44,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L,"FBADJ")=FBADJLR_U_FBADJLA_U_FBRRMKL_U_TAMT
"RTN","FBPCR3",45,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN)=FBVCHAIN,^TMP($J,"FB",FBPSF,FBPAT)=FBDOB
"RTN","FBPCR3",46,0)
 ;S FBIN(5)=$P(Y(1),U,6) I FBIN(5)]"",$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,L)) D ANC^FBPCR67
"RTN","FBPCR3",47,0)
 Q
"RTN","FBPCR3",48,0)
VEN ;set variables for vendor
"RTN","FBPCR3",49,0)
 S V=$G(^FBAAV(+$P(Y(2),U,4),0)),FBVNAME=$E($P(V,U),1,23),FBVID=$P(V,U,2),FBVCHAIN=$P(V,U,10)
"RTN","FBPCR3",50,0)
 Q
"RTN","FBPCR3",51,0)
PRINT ;write output
"RTN","FBPCR3",52,0)
 I FBPG>1&(($Y+10)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR3",53,0)
 E  D HDR1
"RTN","FBPCR3",54,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR3",55,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S L=0 F  S L=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L)) Q:'L  D  Q:FBOUT
"RTN","FBPCR3",56,0)
 ..I ($Y+6)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR3",57,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L),FBCATC=$P(FBDATA,U,15),FBINS=$P(FBDATA,U,16)
"RTN","FBPCR3",58,0)
 ..S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L,"FBADJ")
"RTN","FBPCR3",59,0)
 ..W !,$P(FBDATA,U),?64,$P(FBDATA,U,11),!
"RTN","FBPCR3",60,0)
 ..W ?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?45,$P(FBDATA,U,4),?63,$P(FBDATA,U,5)
"RTN","FBPCR3",61,0)
 ..W !?4,$P(FBDATA,U,6),?12,$P(FBDATA,U,7)
"RTN","FBPCR3",62,0)
 ..W ?20 I $P(FBADJ,U,1)]"" W $P(FBADJ,U,1),?30,$J($P(FBADJ,U,2),14)
"RTN","FBPCR3",63,0)
 ..;If no adjustment code then print suspend cpde amd amount
"RTN","FBPCR3",64,0)
 ..I $P(FBADJ,U,1)="" W $P(FBDATA,U,8),?30,$J($P(FBADJ,U,4),14)
"RTN","FBPCR3",65,0)
 ..W ?47,$P(FBDATA,U,9),?58,$P(FBDATA,U,10),?66,$P(FBADJ,U,3)
"RTN","FBPCR3",66,0)
 ..I FBCATC!FBINS W !?5,">>> Cost recover from "_$S(FBCATC:"means testing",FBINS:"insurance",1:"") W:FBCATC&FBINS " and insurance" W "."
"RTN","FBPCR3",67,0)
 ..W !
"RTN","FBPCR3",68,0)
EXIT ;kill and quit
"RTN","FBPCR3",69,0)
 Q
"RTN","FBPCR3",70,0)
HDR ;main header
"RTN","FBPCR3",71,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR3",72,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR3",73,0)
 W !?4,"Fill Date",?64,"Date Certified"
"RTN","FBPCR3",74,0)
 W !,?15,"Drug Name",?44,"Strength",?60,"Quantity"
"RTN","FBPCR3",75,0)
 W !?2,"Claimed",?12,"Paid",?20,"Adj Code",?33,"Adj Amounts",?47,"Invoice #",?58,"Batch #",?66,"Remit Remarks",!,FBDASH
"RTN","FBPCR3",76,0)
 Q
"RTN","FBPCR3",77,0)
SH ;subheader - vendor, prints when name changes
"RTN","FBPCR3",78,0)
 I ($Y+4)>IOSL D HDR Q:FBOUT
"RTN","FBPCR3",79,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1),?65,"Chain #: ",$P($G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)),U)
"RTN","FBPCR3",80,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR3",81,0)
 Q
"RTN","FBPCR3",82,0)
CR ;read for display
"RTN","FBPCR3",83,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR3",84,0)
 Q
"RTN","FBPCR3",85,0)
PAGE ;new page
"RTN","FBPCR3",86,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR3",87,0)
 Q
"RTN","FBPCR3",88,0)
INSCK(FBDT,FBDA1,FBPI) ;possible cost recovery fcn call
"RTN","FBPCR3",89,0)
 ;Passed variables:  fbdt=fill date or treatment from date
"RTN","FBPCR3",90,0)
 ;                   fbda1=ien if fee patient file, patient ien
"RTN","FBPCR3",91,0)
 ;                    fbpi=fee program
"RTN","FBPCR3",92,0)
 ;Output variables:   fbins=1 if possible recovery, 0 if no
"RTN","FBPCR3",93,0)
 S FBINS=0,FBDT=FBDT+.1,FBDT=+$O(^FBAAA("AIC",FBDA1,-FBDT))
"RTN","FBPCR3",94,0)
 I FBDT S FBINS=$O(^FBAAA("AIC",FBDA1,FBDT,0)) I FBINS="Y" D
"RTN","FBPCR3",95,0)
 .N FBDA S FBDA=+$O(^FBAAA("AIC",FBDA1,FBDT,FBINS,0))
"RTN","FBPCR3",96,0)
 .I $P($G(^FBAAA(FBDA1,1,FBDA,0)),U,3)'=FBPI S FBINS=0
"RTN","FBPCR3",97,0)
 Q $S(FBINS="Y":1,1:0)
"RTN","FBPCR67")
0^21^B22170399^B21293709
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ;07/01/2006
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,98**;JAN 30, 1995;Build 54
"RTN","FBPCR67",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR67",4,0)
EN ;entry point for sort
"RTN","FBPCR67",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",6,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",7,0)
 N FBY2,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",8,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",9,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",10,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",11,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y
"RTN","FBPCR67",13,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",14,0)
 K FBY2,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",15,0)
 D KILL^FBPCR2
"RTN","FBPCR67",16,0)
 Q
"RTN","FBPCR67",17,0)
SET ;set variables
"RTN","FBPCR67",18,0)
 ;I $G(FBPROG)]"",'FBPROG,'$D(FBPROG(+$P(FBIN,U,12))) Q
"RTN","FBPCR67",19,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBPCR67",20,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",21,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",22,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",23,0)
 D
"RTN","FBPCR67",24,0)
 . N FBCATC2
"RTN","FBPCR67",25,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",26,0)
 . Q:FBCATC=2
"RTN","FBPCR67",27,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",28,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",29,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",30,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",31,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",32,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",33,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",34,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",35,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2)_"/"_$S($P($G(^FBAAV(FBIEN,3)),U,2)]"":$P($G(^FBAAV(FBIEN,3)),U,2),1:"**********"),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",36,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",37,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",38,0)
 Q
"RTN","FBPCR67",39,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",40,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",41,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",42,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",43,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",44,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",45,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",46,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",47,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",48,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL
"RTN","FBPCR67",49,0)
 S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",50,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",51,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:5 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",52,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",53,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",54,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",55,0)
 D ANC
"RTN","FBPCR67",56,0)
 Q
"RTN","FBPCR67",57,0)
ANC ;ancillary payments
"RTN","FBPCR67",58,0)
 N J,K,L,M,Y,FBDT1,FBVID I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",59,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",60,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",61,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",62,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",63,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",64,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",65,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",66,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",67,0)
 Q
"RTN","FBPCR671")
0^22^B26341228^B24387802
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;07/18/2006
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98**;JAN 30, 1995;Build 54
"RTN","FBPCR671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR671",4,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",5,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",6,0)
 E  D HDR1
"RTN","FBPCR671",7,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",8,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",9,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",10,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)
"RTN","FBPCR671",11,0)
 ..S FBINV=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV")
"RTN","FBPCR671",12,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",13,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",14,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",15,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",16,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",17,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",18,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",19,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",20,0)
 ..F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",21,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",22,0)
 ...W !?5,">>>"
"RTN","FBPCR671",23,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",24,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",25,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",26,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",27,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",28,0)
 ..;
"RTN","FBPCR671",29,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",30,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",31,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D  D WRT Q:FBOUT
"RTN","FBPCR671",32,0)
 ....N FBXX S FBXX=$O(^FBAAV("C",$P(FBDATA,U,12),"")) S $P(FBV,";",2)=$P(FBV,";",2)_"/"_$S(FBXX="":"**********",$P($G(^FBAAV(FBXX,3)),U,2)]"":$P(^FBAAV(FBXX,3),U,2),1:"**********")
"RTN","FBPCR671",33,0)
 Q
"RTN","FBPCR671",34,0)
WRT ;write ancillary info
"RTN","FBPCR671",35,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",36,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",37,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",38,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",39,0)
 W !
"RTN","FBPCR671",40,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",41,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",42,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR671",43,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",44,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",45,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",46,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",47,0)
 . N FBI,FBMOD
"RTN","FBPCR671",48,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",49,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",50,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",51,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",52,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",53,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",54,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",55,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",56,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",57,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",58,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",59,0)
 .W !?5,">>>"
"RTN","FBPCR671",60,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",61,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",62,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",63,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",64,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",65,0)
 ;
"RTN","FBPCR671",66,0)
 Q
"RTN","FBPCR671",67,0)
HDR ;main header
"RTN","FBPCR671",68,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",69,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR671",70,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",71,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",72,0)
 Q
"RTN","FBPCR671",73,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",74,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",75,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR671",76,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR671",77,0)
 Q
"RTN","FBPCR671",78,0)
SHA ;ancillary subheader
"RTN","FBPCR671",79,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",80,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",81,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",82,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",83,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",84,0)
 Q
"RTN","FBPCR671",85,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",86,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",87,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",88,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID/NPI: ",$P(FBV,";",2)
"RTN","FBPCR671",89,0)
 Q
"RTN","FBPCR671",90,0)
CR ;read for display
"RTN","FBPCR671",91,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",92,0)
 Q
"RTN","FBPCR671",93,0)
PAGE ;new page
"RTN","FBPCR671",94,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",95,0)
 Q
"RTN","FBPCR671",96,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPCR671",97,0)
 Q
"RTN","FBPCR671",98,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPCR671",99,0)
 Q
"RTN","FBPCR671",100,0)
WRTSC ;write service connected
"RTN","FBPCR671",101,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",102,0)
 Q
"UP",161.2,161.24,-1)
161.2^NPI
"UP",161.2,161.24,0)
161.24
"VER")
8.0^22.0
"^DD",161.2,161.2,40,0)
DATE/TIME OF LAST NPI CHANGE^161.24DA^^NPI;0
"^DD",161.2,161.2,41.01,0)
NPI^FX^^3;2^K:$L(X)>10!($L(X)<10)!('$$CHKDGT^XUSNPI(X))!($$DUP^FBNPILK(X)>0) X
"^DD",161.2,161.2,41.01,1,0)
^.1^^-1
"^DD",161.2,161.2,41.01,1,3,0)
161.2^NPI
"^DD",161.2,161.2,41.01,1,3,1)
S ^FBAAV("NPI",$E(X,1,30),DA)=""
"^DD",161.2,161.2,41.01,1,3,2)
K ^FBAAV("NPI",$E(X,1,30),DA)
"^DD",161.2,161.2,41.01,1,3,"DT")
3060717
"^DD",161.2,161.2,41.01,1,4,0)
161.2^NPIHISTORY
"^DD",161.2,161.2,41.01,1,4,1)
S ^FBAAV("NPIHISTORY",$E(X,1,30),DA)=""
"^DD",161.2,161.2,41.01,1,4,2)
K ^FBAAV("NPIHISTORY",$E(X,1,30),DA)
"^DD",161.2,161.2,41.01,1,4,3)
An entry into the NPI History cross reference should not be deleted
"^DD",161.2,161.2,41.01,1,4,"%D",0)
^^2^2^3060911^
"^DD",161.2,161.2,41.01,1,4,"%D",1,0)
This cross reference holds the entire history of the NPIs used in the Fee 
"^DD",161.2,161.2,41.01,1,4,"%D",2,0)
Basis Vendor file
"^DD",161.2,161.2,41.01,1,4,"DT")
3060911
"^DD",161.2,161.2,41.01,3)
Answer must be a unique 10 character numeric value and a valid NPI number.
"^DD",161.2,161.2,41.01,21,0)
^.001^2^2^3060728^^^
"^DD",161.2,161.2,41.01,21,1,0)
Unique National Provider Identifier.  A unique integer assigned to 
"^DD",161.2,161.2,41.01,21,2,0)
providers by CMS. This is the current, active, NPI.
"^DD",161.2,161.2,41.01,"DT")
3060913
"^DD",161.2,161.24,0)
DATE/TIME OF LAST NPI CHANGE SUB-FIELD^^.04^4
"^DD",161.2,161.24,0,"DT")
3060828
"^DD",161.2,161.24,0,"IX","B",161.24,.01)

"^DD",161.2,161.24,0,"NM","DATE/TIME OF LAST NPI CHANGE")

"^DD",161.2,161.24,0,"UP")
161.2
"^DD",161.2,161.24,.01,0)
DATE/TIME OF LAST NPI CHANGE^D^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",161.2,161.24,.01,1,0)
^.1
"^DD",161.2,161.24,.01,1,1,0)
161.24^B
"^DD",161.2,161.24,.01,1,1,1)
S ^FBAAV(DA(1),"NPI","B",$E(X,1,30),DA)=""
"^DD",161.2,161.24,.01,1,1,2)
K ^FBAAV(DA(1),"NPI","B",$E(X,1,30),DA)
"^DD",161.2,161.24,.01,3)
Enter the date/time of the last change to this NPI
"^DD",161.2,161.24,.01,9)
^
"^DD",161.2,161.24,.01,21,0)
^^1^1^3060411^
"^DD",161.2,161.24,.01,21,1,0)
This field contains the date and time of the last change to the NPI field.
"^DD",161.2,161.24,.01,"DT")
3060411
"^DD",161.2,161.24,.02,0)
STATUS^S^1:ACTIVE;0:INACTIVE;2:DELETED;^0;2^Q
"^DD",161.2,161.24,.02,1,0)
^.1^^0
"^DD",161.2,161.24,.02,3)
Enter a 1 for 'ACTIVE' or a 0 for 'INACTIVE', or a 2 for DELETED
"^DD",161.2,161.24,.02,21,0)
^.001^4^4^3060907^^^
"^DD",161.2,161.24,.02,21,1,0)
The status of an NPI is either 'ACTIVE' or 'INACTIVE'.  If 'ACTIVE', then 
"^DD",161.2,161.24,.02,21,2,0)
the NPI will be accessible by end-users to document a particular 
"^DD",161.2,161.24,.02,21,3,0)
provider.  If 'INACTIVE', then the NPI will only be accessible by the 
"^DD",161.2,161.24,.02,21,4,0)
application to display legacy data.
"^DD",161.2,161.24,.02,"DT")
3060912
"^DD",161.2,161.24,.03,0)
NPI^FX^^0;3^K:$L(X)>10!($L(X)<10)!('$$CHKDGT^XUSNPI(X)) X
"^DD",161.2,161.24,.03,3)
Answer must be 10 characters in length.  Numerics only.
"^DD",161.2,161.24,.03,21,0)
^^5^5^3060503^
"^DD",161.2,161.24,.03,21,1,0)
Unique National Provider Identifier.  A unique integer assigned to
"^DD",161.2,161.24,.03,21,2,0)
providers by CMS. This field contains all of the NPIs associated with
"^DD",161.2,161.24,.03,21,3,0)
this provider.  The current NPI will be set as active in the STATUS field
"^DD",161.2,161.24,.03,21,4,0)
of this multiple.  All others will be set as inactive.  There can only be
"^DD",161.2,161.24,.03,21,5,0)
one active NPI.
"^DD",161.2,161.24,.03,"DT")
3060412
"^DD",161.2,161.24,.04,0)
PERSON AFFECTING LAST CHANGE^P200'^VA(200,^0;4^Q
"^DD",161.2,161.24,.04,3)
Enter the name of the person who last changed this NPI.
"^DD",161.2,161.24,.04,21,0)
^^1^1^3060412^
"^DD",161.2,161.24,.04,21,1,0)
This is the VistA person who last modified the NPI field
"^DD",161.2,161.24,.04,"DT")
3060412
"BLD",6343,6)
^91
**END**
**END**
