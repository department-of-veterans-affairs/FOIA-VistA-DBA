EMERGENCY Released IB*2*262 SEQ #230
Extracted from mail message
**KIDS**:IB*2.0*262^

**INSTALL NAME**
IB*2.0*262
"BLD",5389,0)
IB*2.0*262^INTEGRATED BILLING^0^3040213^y
"BLD",5389,4,0)
^9.64PA^^
"BLD",5389,"KRN",0)
^9.67PA^8989.52^19
"BLD",5389,"KRN",.4,0)
.4
"BLD",5389,"KRN",.401,0)
.401
"BLD",5389,"KRN",.402,0)
.402
"BLD",5389,"KRN",.403,0)
.403
"BLD",5389,"KRN",.5,0)
.5
"BLD",5389,"KRN",.84,0)
.84
"BLD",5389,"KRN",3.6,0)
3.6
"BLD",5389,"KRN",3.8,0)
3.8
"BLD",5389,"KRN",9.2,0)
9.2
"BLD",5389,"KRN",9.8,0)
9.8
"BLD",5389,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5389,"KRN",9.8,"NM",1,0)
IBARXEPV^^0^B28310684
"BLD",5389,"KRN",9.8,"NM","B","IBARXEPV",1)

"BLD",5389,"KRN",19,0)
19
"BLD",5389,"KRN",19.1,0)
19.1
"BLD",5389,"KRN",101,0)
101
"BLD",5389,"KRN",409.61,0)
409.61
"BLD",5389,"KRN",771,0)
771
"BLD",5389,"KRN",870,0)
870
"BLD",5389,"KRN",8989.51,0)
8989.51
"BLD",5389,"KRN",8989.52,0)
8989.52
"BLD",5389,"KRN",8994,0)
8994
"BLD",5389,"KRN","B",.4,.4)

"BLD",5389,"KRN","B",.401,.401)

"BLD",5389,"KRN","B",.402,.402)

"BLD",5389,"KRN","B",.403,.403)

"BLD",5389,"KRN","B",.5,.5)

"BLD",5389,"KRN","B",.84,.84)

"BLD",5389,"KRN","B",3.6,3.6)

"BLD",5389,"KRN","B",3.8,3.8)

"BLD",5389,"KRN","B",9.2,9.2)

"BLD",5389,"KRN","B",9.8,9.8)

"BLD",5389,"KRN","B",19,19)

"BLD",5389,"KRN","B",19.1,19.1)

"BLD",5389,"KRN","B",101,101)

"BLD",5389,"KRN","B",409.61,409.61)

"BLD",5389,"KRN","B",771,771)

"BLD",5389,"KRN","B",870,870)

"BLD",5389,"KRN","B",8989.51,8989.51)

"BLD",5389,"KRN","B",8989.52,8989.52)

"BLD",5389,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
262^3040213
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBARXEPV")
0^1^B28310684
"RTN","IBARXEPV",1,0)
IBARXEPV ;ALB/AAS - RX COPAY EXEMPTION VERIFY STATUS ; 02/12/2004
"RTN","IBARXEPV",2,0)
 ;;2.0;INTEGRATED BILLING;**262**; 21-MAR-94
"RTN","IBARXEPV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEPV",4,0)
 ;
"RTN","IBARXEPV",5,0)
% ; -- print/verify patients whose current exemption does not match
"RTN","IBARXEPV",6,0)
 ;    what is currently computed.
"RTN","IBARXEPV",7,0)
 I '$D(DT) D DT^DICRW
"RTN","IBARXEPV",8,0)
 S IBQUIT=0
"RTN","IBARXEPV",9,0)
 I '$D(IOF) D HOME^%ZIS
"RTN","IBARXEPV",10,0)
 W @IOF,"Verify Medication Copayment Exemption Status"
"RTN","IBARXEPV",11,0)
 W !! D DATE^IBOUTL
"RTN","IBARXEPV",12,0)
 I 'IBBDT!('IBEDT)!(IBEDT<IBBDT) G END
"RTN","IBARXEPV",13,0)
 ;
"RTN","IBARXEPV",14,0)
 ; -- update patient status
"RTN","IBARXEPV",15,0)
 W !
"RTN","IBARXEPV",16,0)
 S DIR("?")="Answer 'YES' if you want to automatically update patient status to the computed status, or 'NO' to print a report of discrepancies."
"RTN","IBARXEPV",17,0)
 S DIR(0)="Y",DIR("A")="Update Patient Status",DIR("B")="NO" D ^DIR K DIR S IBUP=+Y
"RTN","IBARXEPV",18,0)
 I $D(DIRUT) G END
"RTN","IBARXEPV",19,0)
 W !
"RTN","IBARXEPV",20,0)
 ;
"RTN","IBARXEPV",21,0)
DEV W !!,"You will need a 132 column printer for this report!",!
"RTN","IBARXEPV",22,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBARXEPV",23,0)
 I $D(IO("Q")) S ZTRTN="DQ^IBARXEPV",ZTSAVE("IB*")="",ZTDESC="IB Verify Medication Copayment exemption" D ^%ZTLOAD K ZTSK,IO("Q") D HOME^%ZIS G END
"RTN","IBARXEPV",24,0)
 I '$D(ZTQUEUED) W !,"HMMMM, LET ME THINK ABOUT THIS FOR A MINUTE"
"RTN","IBARXEPV",25,0)
 U IO
"RTN","IBARXEPV",26,0)
 ;
"RTN","IBARXEPV",27,0)
DQ ; -- entry point from task man to start comparison
"RTN","IBARXEPV",28,0)
 S (IBPCNT,IBPAG)=0,IBOK=1 D NOW^%DTC S Y=% D D^DIQ S IBPDAT=$P(Y,"@")_" "_$E($P(Y,"@",2),1,5)
"RTN","IBARXEPV",29,0)
 K ^TMP($J,"IBUNVER")
"RTN","IBARXEPV",30,0)
 ;
"RTN","IBARXEPV",31,0)
 ; -- look through inverse date x-ref
"RTN","IBARXEPV",32,0)
 S IBDT=IBBDT-.00001
"RTN","IBARXEPV",33,0)
 F  S IBDT=$O(^IBA(354.1,"B",IBDT)) Q:'IBDT!(IBDT>(IBEDT+.9))  S IBDA=0 F   S IBDA=$O(^IBA(354.1,"B",IBDT,IBDA)) Q:'IBDA  D CHK I 'IBOK D UP:IBUP,SET
"RTN","IBARXEPV",34,0)
 D REPORT,PAUSE^IBOUTL:'IBQUIT
"RTN","IBARXEPV",35,0)
 G END
"RTN","IBARXEPV",36,0)
 ;
"RTN","IBARXEPV",37,0)
END K ^TMP($J,"IBUNVER")
"RTN","IBARXEPV",38,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBARXEPV",39,0)
 D ^%ZISC
"RTN","IBARXEPV",40,0)
 K DFN,DIR,DIRUT,DIC,DIE,DA,DR,X,Y
"RTN","IBARXEPV",41,0)
 K IBBDT,IBDA,IBDATA,IBDEPEN,IBDFN,IBDT,IBEDT,IBER,IBERR,IBEXREA,IBEXREAN,IBEXREAO,IBJ,IBMESS,IBNAM,IBOK,IBP,IBPAG,IBPCNT,IBPDAT,IBQUIT,IBUP
"RTN","IBARXEPV",42,0)
 Q
"RTN","IBARXEPV",43,0)
 ;
"RTN","IBARXEPV",44,0)
REPORT ; -- print report
"RTN","IBARXEPV",45,0)
 D HDR S IBDCNT=0
"RTN","IBARXEPV",46,0)
 I '$D(^TMP($J,"IBUNVER")) W !,"No discrepancies found in ",IBPCNT," exemptions checked." G REPORTQ
"RTN","IBARXEPV",47,0)
 ;
"RTN","IBARXEPV",48,0)
 S IBNAM=""
"RTN","IBARXEPV",49,0)
 F  S IBNAM=$O(^TMP($J,"IBUNVER",IBNAM)) Q:IBNAM=""!(IBQUIT)  S IBDFN="" F  S IBDFN=$O(^TMP($J,"IBUNVER",IBNAM,IBDFN)) Q:IBDFN=""!(IBQUIT)  S IBER=^(IBDFN) D LINE
"RTN","IBARXEPV",50,0)
 ;
"RTN","IBARXEPV",51,0)
 W !!,"There were ",IBDCNT," discrepancies found in ",IBPCNT," exemptions checked."
"RTN","IBARXEPV",52,0)
 ;
"RTN","IBARXEPV",53,0)
REPORTQ Q
"RTN","IBARXEPV",54,0)
 ;
"RTN","IBARXEPV",55,0)
LINE ; -- write each line
"RTN","IBARXEPV",56,0)
 S DFN=+IBDFN,IBDCNT=IBDCNT+1
"RTN","IBARXEPV",57,0)
 I $Y>(IOSL-5) D PAUSE^IBOUTL Q:IBQUIT  D HDR
"RTN","IBARXEPV",58,0)
 W !,$E(IBNAM,1,20),?22,$P(IBER,"^",8)
"RTN","IBARXEPV",59,0)
 S X=$P(IBER,"^",5) W ?39,$S(X=3:"Exemption incorrect",X=1!(X=2)!(X=5):"Not Current Status",X=4:"Name Missing",1:"Hmmmm")
"RTN","IBARXEPV",60,0)
 W ?61,$$DAT1^IBOUTL($P(IBER,"^",2))_" "_$E($P($G(^IBE(354.2,+IBER,0)),"^"),1,15)
"RTN","IBARXEPV",61,0)
 W ?88,$$DAT1^IBOUTL($P(IBER,"^",4))_" "_$E($P($G(^IBE(354.2,+$P(IBER,"^",3),0)),"^"),1,15)
"RTN","IBARXEPV",62,0)
 W ?115,$P(IBER,"^",6)
"RTN","IBARXEPV",63,0)
 Q
"RTN","IBARXEPV",64,0)
 ;
"RTN","IBARXEPV",65,0)
CHK ; -- check if current status = computed status
"RTN","IBARXEPV",66,0)
 S IBOK=1,IBMESS="Nothing Updated",IBERR=""
"RTN","IBARXEPV",67,0)
 S X=$G(^IBA(354.1,+IBDA,0)) G CHKQ:'$P(X,"^",10) ;not active skip
"RTN","IBARXEPV",68,0)
 S DFN=$P(X,"^",2)
"RTN","IBARXEPV",69,0)
 S Y=$G(^IBA(354,DFN,0)) I +X<$P(Y,"^",3) G CHKQ ;not current exemption
"RTN","IBARXEPV",70,0)
 ;
"RTN","IBARXEPV",71,0)
 N DGMT,CONV,CLN S (CLN,CONV)=0,DGMT=$$LST^DGMTU(DFN,+X,1)
"RTN","IBARXEPV",72,0)
 I $P(DGMT,U,5)=2 D  G:CONV CHKQ           ; skip Edb conv. tests
"RTN","IBARXEPV",73,0)
 .; Loop through the MT comments, Check for EDB converted test 
"RTN","IBARXEPV",74,0)
 .; No comments to check
"RTN","IBARXEPV",75,0)
 .Q:'$D(^DGMT(408.31,+DGMT,"C",1,0))
"RTN","IBARXEPV",76,0)
 .F  S CLN=$O(^DGMT(408.31,+DGMT,"C",CLN)) Q:'CLN!(CONV)  D
"RTN","IBARXEPV",77,0)
 ..I ^DGMT(408.31,+DGMT,"C",CLN,0)["Z06 MT via Edb" S CONV=1
"RTN","IBARXEPV",78,0)
 ;
"RTN","IBARXEPV",79,0)
 S IBPCNT=IBPCNT+1
"RTN","IBARXEPV",80,0)
 I '+Y S IBOK=0,IBERR=4
"RTN","IBARXEPV",81,0)
 S IBEXREAO=$P(X,"^",5)_"^"_+X ;current exemption
"RTN","IBARXEPV",82,0)
 I $P($G(^IBE(354.2,+IBEXREAO,0)),"^",5)=2010 G CHKQ ; hardships don't report
"RTN","IBARXEPV",83,0)
 I +X>$P(Y,"^",3) S IBOK=0,IBERR=1 ;most current exemption not in 354
"RTN","IBARXEPV",84,0)
 I $P(X,"^",5)'=$P(Y,"^",5) S IBOK=0,IBERR=2 ;Current exemption not in 354
"RTN","IBARXEPV",85,0)
 I $P(X,"^",4)'=$P(Y,"^",4) S IBOK=0,IBERR=5 ;current status in exemption not in 354
"RTN","IBARXEPV",86,0)
 S IBEXREAN=$$STATUS^IBARXEU1(DFN,DT)
"RTN","IBARXEPV",87,0)
 I +IBEXREAO'=+IBEXREAN S IBOK=0,IBERR=3
"RTN","IBARXEPV",88,0)
CHKQ Q
"RTN","IBARXEPV",89,0)
 ;
"RTN","IBARXEPV",90,0)
UP ; -- update current exemption status
"RTN","IBARXEPV",91,0)
 Q:IBOK
"RTN","IBARXEPV",92,0)
 S IBJOB=15,IBWHER=16
"RTN","IBARXEPV",93,0)
 I IBERR=4 D  G UPQ
"RTN","IBARXEPV",94,0)
 .S DIE="^IBA(354,",DA=DFN,DR=".01////"_DFN D ^DIE
"RTN","IBARXEPV",95,0)
 .K DIE,DA,DR,DIC
"RTN","IBARXEPV",96,0)
 .S IBMESS="Name Corrected"
"RTN","IBARXEPV",97,0)
UP1 N IBOLDAUT S IBOLDAUT=""
"RTN","IBARXEPV",98,0)
 ;
"RTN","IBARXEPV",99,0)
 ; -- if currently not auto exempt make sure not more recent autoexempt
"RTN","IBARXEPV",100,0)
 I $L($P($G(^IBE(354.2,+IBEXREAN,0)),"^",5))>2 D OLDAUT^IBARXEX1(IBEXREAN)
"RTN","IBARXEPV",101,0)
 S IBFORCE=$P(IBEXREAN,"^",2)
"RTN","IBARXEPV",102,0)
 D MOSTR^IBARXEU5($P(IBEXREAN,"^",2),+IBEXREAN)
"RTN","IBARXEPV",103,0)
 D ADDEX^IBAUTL6(+IBEXREAN,$P(IBEXREAN,"^",2),1,1,IBOLDAUT)
"RTN","IBARXEPV",104,0)
 S IBMESS="Updated"
"RTN","IBARXEPV",105,0)
UPQ K IBFORCE Q
"RTN","IBARXEPV",106,0)
 ;
"RTN","IBARXEPV",107,0)
SET ; -- set ^tmp node if not okay
"RTN","IBARXEPV",108,0)
 Q:IBOK
"RTN","IBARXEPV",109,0)
 S IBP=$$PT^IBEFUNC(DFN)
"RTN","IBARXEPV",110,0)
 S IBDFN=DFN
"RTN","IBARXEPV",111,0)
 I $D(^TMP($J,"IBUNVER",$P(IBP,"^"),DFN)) S IBDFN=DFN_"-"_IBPCNT
"RTN","IBARXEPV",112,0)
 S ^TMP($J,"IBUNVER",$P(IBP,"^"),IBDFN)=IBEXREAO_"^"_IBEXREAN_"^"_IBERR_"^"_IBMESS_"^"_IBP
"RTN","IBARXEPV",113,0)
 Q
"RTN","IBARXEPV",114,0)
 ;
"RTN","IBARXEPV",115,0)
HDR ; -- print header
"RTN","IBARXEPV",116,0)
 I IBPAG!($E(IOST,1,2)="C-") W @IOF
"RTN","IBARXEPV",117,0)
 S IBPAG=IBPAG+1
"RTN","IBARXEPV",118,0)
 W !,"Medication Copayment Exemption Problem Report",?(IOM-31),IBPDAT," Page ",IBPAG
"RTN","IBARXEPV",119,0)
 W !,"Patient",?22,"PT. ID",?39,"Error",?61,"Current Exemption",?88,"Computed Exemption",?115,"Action"
"RTN","IBARXEPV",120,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBARXEPV",121,0)
 Q
"VER")
8.0^22
**END**
**END**
