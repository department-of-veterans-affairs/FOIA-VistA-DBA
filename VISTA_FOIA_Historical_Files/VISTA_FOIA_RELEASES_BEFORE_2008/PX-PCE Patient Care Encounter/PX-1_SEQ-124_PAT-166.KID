Released PX*1*166 SEQ #124
Extracted from mail message
**KIDS**:PX*1.0*166^

**INSTALL NAME**
PX*1.0*166
"BLD",6109,0)
PX*1.0*166^PCE PATIENT CARE ENCOUNTER^0^3050405^y
"BLD",6109,1,0)
^^1^1^3050405^
"BLD",6109,1,1,0)
<UNDEFINED> error when deleting Encounters
"BLD",6109,4,0)
^9.64PA^^
"BLD",6109,"ABPKG")
n
"BLD",6109,"KRN",0)
^9.67PA^8989.52^19
"BLD",6109,"KRN",.4,0)
.4
"BLD",6109,"KRN",.401,0)
.401
"BLD",6109,"KRN",.402,0)
.402
"BLD",6109,"KRN",.403,0)
.403
"BLD",6109,"KRN",.5,0)
.5
"BLD",6109,"KRN",.84,0)
.84
"BLD",6109,"KRN",3.6,0)
3.6
"BLD",6109,"KRN",3.8,0)
3.8
"BLD",6109,"KRN",9.2,0)
9.2
"BLD",6109,"KRN",9.8,0)
9.8
"BLD",6109,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6109,"KRN",9.8,"NM",1,0)
PXUTLSTP^^0^B14644426
"BLD",6109,"KRN",9.8,"NM","B","PXUTLSTP",1)

"BLD",6109,"KRN",19,0)
19
"BLD",6109,"KRN",19.1,0)
19.1
"BLD",6109,"KRN",101,0)
101
"BLD",6109,"KRN",409.61,0)
409.61
"BLD",6109,"KRN",771,0)
771
"BLD",6109,"KRN",870,0)
870
"BLD",6109,"KRN",8989.51,0)
8989.51
"BLD",6109,"KRN",8989.52,0)
8989.52
"BLD",6109,"KRN",8994,0)
8994
"BLD",6109,"KRN","B",.4,.4)

"BLD",6109,"KRN","B",.401,.401)

"BLD",6109,"KRN","B",.402,.402)

"BLD",6109,"KRN","B",.403,.403)

"BLD",6109,"KRN","B",.5,.5)

"BLD",6109,"KRN","B",.84,.84)

"BLD",6109,"KRN","B",3.6,3.6)

"BLD",6109,"KRN","B",3.8,3.8)

"BLD",6109,"KRN","B",9.2,9.2)

"BLD",6109,"KRN","B",9.8,9.8)

"BLD",6109,"KRN","B",19,19)

"BLD",6109,"KRN","B",19.1,19.1)

"BLD",6109,"KRN","B",101,101)

"BLD",6109,"KRN","B",409.61,409.61)

"BLD",6109,"KRN","B",771,771)

"BLD",6109,"KRN","B",870,870)

"BLD",6109,"KRN","B",8989.51,8989.51)

"BLD",6109,"KRN","B",8989.52,8989.52)

"BLD",6109,"KRN","B",8994,8994)

"BLD",6109,"QUES",0)
^9.62^^
"BLD",6109,"REQB",0)
^9.611^1^1
"BLD",6109,"REQB",1,0)
PX*1.0*96^2
"BLD",6109,"REQB","B","PX*1.0*96",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
166^3050405
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3050405
"PKG",413,22,1,"PAH",1,1,1,0)
<UNDEFINED> error when deleting Encounters
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PXUTLSTP")
0^1^B14644426
"RTN","PXUTLSTP",1,0)
PXUTLSTP ;ISL/dee,ESW - Utility routine used by PCE to add/edit/delete stop code visits ; 7/25/03 4:12pm
"RTN","PXUTLSTP",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,96,166**;Aug 12, 1996
"RTN","PXUTLSTP",3,0)
 Q
"RTN","PXUTLSTP",4,0)
 ;
"RTN","PXUTLSTP",5,0)
STOPCODE(PXUTSOR,PXUTSTOP,PXUTVST,PXUTSVST) ;Makes or edits visit to create the secondary visit for the credit stops
"RTN","PXUTLSTP",6,0)
 ; Parameters
"RTN","PXUTLSTP",7,0)
 ;   PXUTSOR   IEN of the Data source
"RTN","PXUTLSTP",8,0)
 ;   PXUTSTOP  Pointer to Stop Code if "@" the delete the secondary visit
"RTN","PXUTLSTP",9,0)
 ;   PXUTVST   Main visit
"RTN","PXUTLSTP",10,0)
 ;   PXUTSVST  Secondary visit
"RTN","PXUTLSTP",11,0)
 ;               if there is not one then create one
"RTN","PXUTLSTP",12,0)
 ;               if there is one then this is an edit or delete
"RTN","PXUTLSTP",13,0)
 ;
"RTN","PXUTLSTP",14,0)
 ; Returns the pointer to the secondary visit 
"RTN","PXUTLSTP",15,0)
 ;   or 0 if the secondary visit was deleted,
"RTN","PXUTLSTP",16,0)
 ;   or null if visit tracking did not create the visit.
"RTN","PXUTLSTP",17,0)
 ;
"RTN","PXUTLSTP",18,0)
 D EVENT^PXKMAIN
"RTN","PXUTLSTP",19,0)
 N PXUAFTER,PXUTNODE,PXUTRET,PXKERROR,PXUTEXIT
"RTN","PXUTLSTP",20,0)
 K ^TMP("PXK",$J)
"RTN","PXUTLSTP",21,0)
 S PXUTEXIT=0
"RTN","PXUTLSTP",22,0)
 ;
"RTN","PXUTLSTP",23,0)
 I $G(PXUTSVST)>0 D  Q:PXUTEXIT -1
"RTN","PXUTLSTP",24,0)
 . L +^AUPNVSIT(PXUTSVST):5 E  W !!,$C(7),"Cannot edit at this time, try again later." D PAUSE^PXCEHELP S PXUTEXIT=1 Q
"RTN","PXUTLSTP",25,0)
 . I PXUTSTOP="@" D
"RTN","PXUTLSTP",26,0)
 ..;--ENTERED TO TRY TO KILL STOP CODES
"RTN","PXUTLSTP",27,0)
DELETE ..;If stop code has to be killed on credit stop code visit then 
"RTN","PXUTLSTP",28,0)
 ..; the whole visit has to be killed with and pointing to it
"RTN","PXUTLSTP",29,0)
 ..; outpatient encounter.
"RTN","PXUTLSTP",30,0)
 .. F PXUTNODE=0,21,150,800,811,812 D
"RTN","PXUTLSTP",31,0)
 ... S (^TMP("PXK",$J,"VST",1,PXUTNODE,"AFTER"),^TMP("PXK",$J,"VST",1,PXUTNODE,"BEFORE"))=$G(^AUPNVSIT(PXUTSVST,PXUTNODE))
"RTN","PXUTLSTP",32,0)
 .. S $P(^TMP("PXK",$J,"VST",1,0,"AFTER"),"^",8)="@"
"RTN","PXUTLSTP",33,0)
 .. S ^TMP("PXK",$J,"VST",1,"IEN")=PXUTSVST
"RTN","PXUTLSTP",34,0)
 ..; Verify if this is really credit stop visit with only 1 dependent
"RTN","PXUTLSTP",35,0)
 ..; entry that is outpatient encounter.
"RTN","PXUTLSTP",36,0)
 .. I $$DEC^VSITKIL(PXUTSVST,0)<2,$P($G(^AUPNVSIT(PXUTSVST,150)),U,3)="C" D   ;PX/96
"RTN","PXUTLSTP",37,0)
 ... S ^TMP("PXK",$J,"VST",1,0,"AFTER")="@"
"RTN","PXUTLSTP",38,0)
 ...; Find Outpatient Encounter to take care of
"RTN","PXUTLSTP",39,0)
 ... N SDOEP
"RTN","PXUTLSTP",40,0)
 ... D LISTVST^SDOERPC(.SDOEP,PXUTVST)
"RTN","PXUTLSTP",41,0)
 ... S SDOEP=$P(SDOEP,")")_","_""""""_")"
"RTN","PXUTLSTP",42,0)
 ... S SDOEP=$O(@SDOEP) D CHLD^SDCODEL(SDOEP,0)
"RTN","PXUTLSTP",43,0)
 . E  D
"RTN","PXUTLSTP",44,0)
EDIT .. F PXUTNODE=0,21,150,800,811,812 D
"RTN","PXUTLSTP",45,0)
 ... S (^TMP("PXK",$J,"VST",1,PXUTNODE,"AFTER"),^TMP("PXK",$J,"VST",1,PXUTNODE,"BEFORE"))=$G(^AUPNVSIT(PXUTSVST,PXUTNODE))
"RTN","PXUTLSTP",46,0)
 .. S $P(^TMP("PXK",$J,"VST",1,0,"AFTER"),"^",8)=PXUTSTOP
"RTN","PXUTLSTP",47,0)
 .. S ^TMP("PXK",$J,"VST",1,"IEN")=PXUTSVST
"RTN","PXUTLSTP",48,0)
 ;
"RTN","PXUTLSTP",49,0)
 E  I $G(PXUTVST)>0 D
"RTN","PXUTLSTP",50,0)
CREATE . F PXUTNODE=150,800,811 D
"RTN","PXUTLSTP",51,0)
 .. S ^TMP("PXK",$J,"VST",1,PXUTNODE,"AFTER")=""
"RTN","PXUTLSTP",52,0)
 .. S ^TMP("PXK",$J,"VST",1,PXUTNODE,"BEFORE")=""
"RTN","PXUTLSTP",53,0)
 . S ^TMP("PXK",$J,"VST",1,21,"AFTER")=$G(^AUPNVSIT(PXUTVST,21))
"RTN","PXUTLSTP",54,0)
 . S ^TMP("PXK",$J,"VST",1,21,"BEFORE")=""
"RTN","PXUTLSTP",55,0)
 . S ^TMP("PXK",$J,"VST",1,150,"AFTER")="^^S"
"RTN","PXUTLSTP",56,0)
 . S ^TMP("PXK",$J,"VST",1,150,"BEFORE")=""
"RTN","PXUTLSTP",57,0)
 . S ^TMP("PXK",$J,"VST",1,812,"AFTER")="^^"_PXUTSOR
"RTN","PXUTLSTP",58,0)
 . S ^TMP("PXK",$J,"VST",1,812,"BEFORE")=""
"RTN","PXUTLSTP",59,0)
 . S PXUAFTER=$G(^AUPNVSIT(PXUTVST,0))
"RTN","PXUTLSTP",60,0)
 . S ^TMP("PXK",$J,"VST",1,0,"AFTER")=$P(PXUAFTER,"^",1)_"^^^^"_$P(PXUAFTER,"^",5,6)_"^^"_PXUTSTOP_"^^^^"_PXUTVST_"^^^^^^^^^"_$P(PXUAFTER,"^",21,22)
"RTN","PXUTLSTP",61,0)
 . S ^TMP("PXK",$J,"VST",1,0,"BEFORE")=""
"RTN","PXUTLSTP",62,0)
 . S ^TMP("PXK",$J,"VST",1,"IEN")=""
"RTN","PXUTLSTP",63,0)
 E  Q -1
"RTN","PXUTLSTP",64,0)
 ;
"RTN","PXUTLSTP",65,0)
 S ^TMP("PXK",$J,"SOR")=PXUTSOR
"RTN","PXUTLSTP",66,0)
 D EN1^PXKMAIN
"RTN","PXUTLSTP",67,0)
 S PXUTRET=^TMP("PXK",$J,"VST",1,"IEN")
"RTN","PXUTLSTP",68,0)
 D EVENT^PXKMAIN
"RTN","PXUTLSTP",69,0)
 K ^TMP("PXK",$J)
"RTN","PXUTLSTP",70,0)
 I PXUTRET>0,$G(PXUTSVST)>0,PXUTSTOP="@" D
"RTN","PXUTLSTP",71,0)
 . N PXUTKILL
"RTN","PXUTLSTP",72,0)
 . S PXUTKILL=$$KILL^VSITKIL(PXUTSVST)
"RTN","PXUTLSTP",73,0)
 . S:'PXUTKILL PXUTRET=0
"RTN","PXUTLSTP",74,0)
 I $G(PXUTSVST)>0 L -^AUPNVSIT(PXUTSVST):5
"RTN","PXUTLSTP",75,0)
 D MODIFIED^VSIT(PXUTVST)
"RTN","PXUTLSTP",76,0)
 Q PXUTRET
"RTN","PXUTLSTP",77,0)
 ;
"RTN","PXUTLSTP",78,0)
 ;
"RTN","PXUTLSTP",79,0)
 ;
"RTN","PXUTLSTP",80,0)
 ;
"RTN","PXUTLSTP",81,0)
DEAD(VSIT) ;---*** ADDED IN ALBANY BY VAUGHN
"RTN","PXUTLSTP",82,0)
 ;--TO KILL LEFT OVER CREDIT STOP ENTRY THAT IS NOT DELETED
"RTN","PXUTLSTP",83,0)
 ;-added next line to quit
"RTN","PXUTLSTP",84,0)
 Q:$G(VSIT)<1
"RTN","PXUTLSTP",85,0)
 N DEAD,CHILD
"RTN","PXUTLSTP",86,0)
 S CHILD=0 F  S CHILD=$O(^AUPNVSIT("AD",VSIT,CHILD)) Q:CHILD=""  D
"RTN","PXUTLSTP",87,0)
 .I $P($G(^AUPNVSIT(CHILD,0)),"^",8)="",$P($G(^AUPNVSIT(CHILD,0)),"^",9)<1,$P($G(^AUPNVSIT(CHILD,150)),"^",3)="C" S DEAD=$$KILL^VSITKIL(CHILD)
"RTN","PXUTLSTP",88,0)
 ;-----END OF ADDED CODE  VAUGHN----
"RTN","PXUTLSTP",89,0)
 ;
"VER")
8.0^22.0
"BLD",6109,6)
^SEQ #124
**END**
**END**
