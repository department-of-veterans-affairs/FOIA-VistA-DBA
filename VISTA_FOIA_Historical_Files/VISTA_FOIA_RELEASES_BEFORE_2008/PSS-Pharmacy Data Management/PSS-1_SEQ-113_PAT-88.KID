Released PSS*1*88 SEQ #113
Extracted from mail message
**KIDS**:PSS*1.0*88^

**INSTALL NAME**
PSS*1.0*88
"BLD",6040,0)
PSS*1.0*88^PHARMACY DATA MANAGEMENT^0^3070531^y
"BLD",6040,1,0)
^^20^20^3070412^
"BLD",6040,1,1,0)
1. A site reported a problem with the medication route being blank on the
"BLD",6040,1,2,0)
Bar Code Medication Administration (BCMA) V. 3.0 Virtual Due List. During
"BLD",6040,1,3,0)
investigation of possible corrections for this, it was determined that
"BLD",6040,1,4,0)
another issue needed to be addressed with how to determine when to prompt
"BLD",6040,1,5,0)
for an injection site. This patch assists to correct these problems by
"BLD",6040,1,6,0)
adding the PROMPT FOR INJ. SITE IN BCMA field (#8) to the MEDICATION
"BLD",6040,1,7,0)
ROUTES file (#51.2). In addition, the new field has been added to the
"BLD",6040,1,8,0)
input template PSS MEDICATION ROUTES. HD0000000166204, HD0000000164890,
"BLD",6040,1,9,0)
PSI-06-152, PSI-06-158
"BLD",6040,1,10,0)
 
"BLD",6040,1,11,0)
2. During internal testing, it was discovered that there was a problem 
"BLD",6040,1,12,0)
with the Application Programming Interface (API) handled by routine 
"BLD",6040,1,13,0)
PSS55. This patch corrects this problem.
"BLD",6040,1,14,0)
 
"BLD",6040,1,15,0)
3. To assist Pharmacy in appropriately setting the new PROMPT FOR INJ. 
"BLD",6040,1,16,0)
SITE IN BCMA field (#8), a search routine will execute when this patch is 
"BLD",6040,1,17,0)
installed. The purpose of this routine is to look for all Medication 
"BLD",6040,1,18,0)
Route abbreviations that contain ID, IV, IM, SC or SQ. A message with the 
"BLD",6040,1,19,0)
subject of "PDM - Check Med Route Abbreviations" will be sent to the 
"BLD",6040,1,20,0)
person who installs the patch.
"BLD",6040,4,0)
^9.64PA^51.2^1
"BLD",6040,4,51.2,0)
51.2
"BLD",6040,4,51.2,2,0)
^9.641^51.2^1
"BLD",6040,4,51.2,2,51.2,0)
MEDICATION ROUTES  (File-top level)
"BLD",6040,4,51.2,2,51.2,1,0)
^9.6411^9^2
"BLD",6040,4,51.2,2,51.2,1,8,0)
PROMPT FOR INJECTION SITE
"BLD",6040,4,51.2,2,51.2,1,9,0)
DSPLY ON IVP/IVPB TAB IN BCMA?
"BLD",6040,4,51.2,222)
y^y^p^^^^n^^n
"BLD",6040,4,51.2,224)

"BLD",6040,4,"APDD",51.2,51.2)

"BLD",6040,4,"APDD",51.2,51.2,8)

"BLD",6040,4,"APDD",51.2,51.2,9)

"BLD",6040,4,"B",51.2,51.2)

"BLD",6040,6)
7^
"BLD",6040,6.3)
12
"BLD",6040,"ABPKG")
n
"BLD",6040,"INID")
^n
"BLD",6040,"INIT")
EN^PSS0088
"BLD",6040,"KRN",0)
^9.67PA^8989.52^19
"BLD",6040,"KRN",.4,0)
.4
"BLD",6040,"KRN",.401,0)
.401
"BLD",6040,"KRN",.402,0)
.402
"BLD",6040,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",6040,"KRN",.402,"NM",1,0)
PSS MEDICATION ROUTES    FILE #51.2^51.2^0
"BLD",6040,"KRN",.402,"NM","B","PSS MEDICATION ROUTES    FILE #51.2",1)

"BLD",6040,"KRN",.403,0)
.403
"BLD",6040,"KRN",.5,0)
.5
"BLD",6040,"KRN",.84,0)
.84
"BLD",6040,"KRN",3.6,0)
3.6
"BLD",6040,"KRN",3.8,0)
3.8
"BLD",6040,"KRN",9.2,0)
9.2
"BLD",6040,"KRN",9.8,0)
9.8
"BLD",6040,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6040,"KRN",9.8,"NM",1,0)
PSS51P2^^0^B48310663
"BLD",6040,"KRN",9.8,"NM",2,0)
PSS55^^0^B48633216
"BLD",6040,"KRN",9.8,"NM","B","PSS51P2",1)

"BLD",6040,"KRN",9.8,"NM","B","PSS55",2)

"BLD",6040,"KRN",19,0)
19
"BLD",6040,"KRN",19.1,0)
19.1
"BLD",6040,"KRN",101,0)
101
"BLD",6040,"KRN",409.61,0)
409.61
"BLD",6040,"KRN",771,0)
771
"BLD",6040,"KRN",870,0)
870
"BLD",6040,"KRN",8989.51,0)
8989.51
"BLD",6040,"KRN",8989.52,0)
8989.52
"BLD",6040,"KRN",8994,0)
8994
"BLD",6040,"KRN","B",.4,.4)

"BLD",6040,"KRN","B",.401,.401)

"BLD",6040,"KRN","B",.402,.402)

"BLD",6040,"KRN","B",.403,.403)

"BLD",6040,"KRN","B",.5,.5)

"BLD",6040,"KRN","B",.84,.84)

"BLD",6040,"KRN","B",3.6,3.6)

"BLD",6040,"KRN","B",3.8,3.8)

"BLD",6040,"KRN","B",9.2,9.2)

"BLD",6040,"KRN","B",9.8,9.8)

"BLD",6040,"KRN","B",19,19)

"BLD",6040,"KRN","B",19.1,19.1)

"BLD",6040,"KRN","B",101,101)

"BLD",6040,"KRN","B",409.61,409.61)

"BLD",6040,"KRN","B",771,771)

"BLD",6040,"KRN","B",870,870)

"BLD",6040,"KRN","B",8989.51,8989.51)

"BLD",6040,"KRN","B",8989.52,8989.52)

"BLD",6040,"KRN","B",8994,8994)

"BLD",6040,"QUES",0)
^9.62^^
"BLD",6040,"REQB",0)
^9.611^1^1
"BLD",6040,"REQB",1,0)
PSS*1.0*118^2
"BLD",6040,"REQB","B","PSS*1.0*118",1)

"FIA",51.2)
MEDICATION ROUTES
"FIA",51.2,0)
^PS(51.2,
"FIA",51.2,0,0)
51.2I
"FIA",51.2,0,1)
y^y^p^^^^n^^n
"FIA",51.2,0,10)

"FIA",51.2,0,11)

"FIA",51.2,0,"RLRO")

"FIA",51.2,0,"VR")
1.0^PSS
"FIA",51.2,51.2)
1
"FIA",51.2,51.2,8)

"FIA",51.2,51.2,9)

"INIT")
EN^PSS0088
"KRN",.402,2098,-1)
0^1
"KRN",.402,2098,0)
PSS MEDICATION ROUTES^3070522.2054^@^51.2^^@^3070530
"KRN",.402,2098,"DR",1,51.2)
.01;1;3;4;4.1;6;8;9;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
88^3070531^11881
"PKG",517,22,1,"PAH",1,1,0)
^^20^20^3070531
"PKG",517,22,1,"PAH",1,1,1,0)
1. A site reported a problem with the medication route being blank on the
"PKG",517,22,1,"PAH",1,1,2,0)
Bar Code Medication Administration (BCMA) V. 3.0 Virtual Due List. During
"PKG",517,22,1,"PAH",1,1,3,0)
investigation of possible corrections for this, it was determined that
"PKG",517,22,1,"PAH",1,1,4,0)
another issue needed to be addressed with how to determine when to prompt
"PKG",517,22,1,"PAH",1,1,5,0)
for an injection site. This patch assists to correct these problems by
"PKG",517,22,1,"PAH",1,1,6,0)
adding the PROMPT FOR INJ. SITE IN BCMA field (#8) to the MEDICATION
"PKG",517,22,1,"PAH",1,1,7,0)
ROUTES file (#51.2). In addition, the new field has been added to the
"PKG",517,22,1,"PAH",1,1,8,0)
input template PSS MEDICATION ROUTES. HD0000000166204, HD0000000164890,
"PKG",517,22,1,"PAH",1,1,9,0)
PSI-06-152, PSI-06-158
"PKG",517,22,1,"PAH",1,1,10,0)
 
"PKG",517,22,1,"PAH",1,1,11,0)
2. During internal testing, it was discovered that there was a problem 
"PKG",517,22,1,"PAH",1,1,12,0)
with the Application Programming Interface (API) handled by routine 
"PKG",517,22,1,"PAH",1,1,13,0)
PSS55. This patch corrects this problem.
"PKG",517,22,1,"PAH",1,1,14,0)
 
"PKG",517,22,1,"PAH",1,1,15,0)
3. To assist Pharmacy in appropriately setting the new PROMPT FOR INJ. 
"PKG",517,22,1,"PAH",1,1,16,0)
SITE IN BCMA field (#8), a search routine will execute when this patch is 
"PKG",517,22,1,"PAH",1,1,17,0)
installed. The purpose of this routine is to look for all Medication 
"PKG",517,22,1,"PAH",1,1,18,0)
Route abbreviations that contain ID, IV, IM, SC or SQ. A message with the 
"PKG",517,22,1,"PAH",1,1,19,0)
subject of "PDM - Check Med Route Abbreviations" will be sent to the 
"PKG",517,22,1,"PAH",1,1,20,0)
person who installs the patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSS0088")
0^^B6455787^n/a
"RTN","PSS0088",1,0)
PSS0088 ;BIR/JLC - CHECK MED ROUTE ABBREVIATIONS ;04/12/2007
"RTN","PSS0088",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**88**;9/30/97;Build 12
"RTN","PSS0088",3,0)
 ;
"RTN","PSS0088",4,0)
 ;
"RTN","PSS0088",5,0)
 Q
"RTN","PSS0088",6,0)
EN K ZTSAVE,ZTSK,ZTDESC,ZTIO,ZTRTN S ZTRTN="ENQN^PSS0088",ZTDESC="PDM - Check Med Route Abbreviations",ZTIO="" D ^%ZTLOAD
"RTN","PSS0088",7,0)
 W !!,"The check for Med Route Abbreviations is",$S($D(ZTSK):"",1:" NOT")," queued",!
"RTN","PSS0088",8,0)
 I $D(ZTSK) D
"RTN","PSS0088",9,0)
 . W " (to start NOW).",!!,"YOU WILL RECEIVE A MAILMAN MESSAGE WHEN TASK #"_ZTSK_" HAS COMPLETED."
"RTN","PSS0088",10,0)
 Q
"RTN","PSS0088",11,0)
ENQN N IEN,MRAB,A K PSS,PSS1
"RTN","PSS0088",12,0)
 S PSS=6,PSS(6,0)="",PSS1=1,PSS1(1,0)="",IEN=0 F  S IEN=$O(^PS(51.2,IEN)) Q:'IEN  D
"RTN","PSS0088",13,0)
 . S A=$G(^PS(51.2,IEN,0)),MRAB=$P(A,"^",3) I $L(PSS(PSS,0))>55 S PSS=PSS+1,PSS(PSS,0)=""
"RTN","PSS0088",14,0)
 . I MRAB["IV"!(MRAB["IM")!(MRAB["ID")!(MRAB["SC")!(MRAB["SQ") S PSS(PSS,0)=PSS(PSS,0)_MRAB_", "
"RTN","PSS0088",15,0)
 . I $L(PSS1(PSS1,0))>55 S PSS1=PSS1+1,PSS1(PSS1,0)=""
"RTN","PSS0088",16,0)
 . I $P(A,"^")="IV PUSH"!(MRAB="IVP") S PSS1(PSS1,0)=PSS1(PSS1,0)_MRAB_", "
"RTN","PSS0088",17,0)
SENDMSG ;Send mail message when check is complete.
"RTN","PSS0088",18,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,%,Y
"RTN","PSS0088",19,0)
 S XMDUZ="MANAGEMENT,PHARMACY DATA",XMSUB="CHECK FOR MED ROUTE ABBREVIATIONS COMPLETE",XMTEXT="PSS(",XMY(DUZ)="" D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSS0088",20,0)
 S PSS(1,0)="  The check of Med Route abbreviations completed as of "_Y_"."
"RTN","PSS0088",21,0)
 S PSS(2,0)=" ",PSS(3,0)="The following abbreviations contain IV, ID, IM, SC or SQ. Please update the"
"RTN","PSS0088",22,0)
 S PSS(4,0)="Injection Site prompt if appropriate.",PSS(5,0)=" "
"RTN","PSS0088",23,0)
 S PSS=PSS+1,PSS(PSS,0)="",PSS=PSS+1,PSS(PSS,0)="The following Med Routes may need to be displayed on the IVP/IVPB tab."
"RTN","PSS0088",24,0)
 S PSS=PSS+1,PSS(PSS,0)="Please update the DSPLY ON IVP/IVPB TAB IN BCMA? information appropriately."
"RTN","PSS0088",25,0)
 S PSS=PSS+1,PSS(PSS,0)=""
"RTN","PSS0088",26,0)
 F I=1:1:PSS1 S PSS=PSS+1,PSS(PSS,0)=PSS1(I,0)
"RTN","PSS0088",27,0)
 D ^XMD Q
"RTN","PSS51P2")
0^1^B48310663^B45679954
"RTN","PSS51P2",1,0)
PSS51P2 ;BIR/LDT - API FOR INFORMATION FROM FILE 51.2 ; 5 Sep 03
"RTN","PSS51P2",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,112,118,88**;9/30/97;Build 12
"RTN","PSS51P2",3,0)
 ;
"RTN","PSS51P2",4,0)
ALL(PSSIEN,PSSFT,PSSFL,PSSPK,LIST) ;
"RTN","PSS51P2",5,0)
 ;PSSIEN - IEN of entry in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",6,0)
 ;PSSFT - Free Text name in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",7,0)
 ;PSSFL - Inactive flag - "" - All entries
"RTN","PSS51P2",8,0)
 ;        FileMan Date - Only entries with no Inactive Date or an Inactive Date greater than this date.
"RTN","PSS51P2",9,0)
 ;PSSPK - PACKAGE USE field (#3) of the MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",10,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",11,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",12,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), PACKAGE USE field (#3), OUTPATIENT EXPANSION field (#4),
"RTN","PSS51P2",13,0)
 ;OTHER LANGUAGE EXPANSION field (#4.1), INACTIVATION DATE field (#5), and IV FLAG field (#6)
"RTN","PSS51P2",14,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",15,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS,PSSBGCNT,PSSCNT,PSSTIEN,PSSTMP,PSSNAM,PSSCAP
"RTN","PSS51P2",16,0)
 S PSSBGCNT=0
"RTN","PSS51P2",17,0)
 S SCR("S")=""
"RTN","PSS51P2",18,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",19,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P2",20,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",21,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",22,0)
 S SCR("S")=""
"RTN","PSS51P2",23,0)
 I +$G(PSSFL)>0 N ND D SETSCRN
"RTN","PSS51P2",24,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",25,0)
 I $G(PSSPK)]"" S SCR("S")=$S(SCR("S")]"":SCR("S")_" I $P($G(^(0)),U,4)=$G(PSSPK)",1:"I $P($G(^(0)),U,4)=$G(PSSPK)")
"RTN","PSS51P2",26,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(51.2,"","A","`"_PSSIEN,,SCR("S"),"") D  D COUNTBG Q
"RTN","PSS51P2",27,0)
 .I PSSIEN2>0 D DIRREAD
"RTN","PSS51P2",28,0)
 I +$G(PSSIEN)=0 D
"RTN","PSS51P2",29,0)
 .I PSSFT="??" D LOOPDIR D COUNTBG Q
"RTN","PSS51P2",30,0)
 .D FIND^DIC(51.2,,"@;.01;1","QP",PSSFT,,"B",SCR("S"),,"") D LOOPDI D COUNTBG
"RTN","PSS51P2",31,0)
 Q
"RTN","PSS51P2",32,0)
 ;
"RTN","PSS51P2",33,0)
COUNTBG ;CHECKS PSSBGCNT AND FILLS COUNT IN ON 0 NODE OF ^TMP($J,LIST)
"RTN","PSS51P2",34,0)
 I PSSBGCNT>0 D
"RTN","PSS51P2",35,0)
 .S ^TMP($J,LIST,0)=PSSBGCNT
"RTN","PSS51P2",36,0)
 ELSE  S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND"
"RTN","PSS51P2",37,0)
 Q
"RTN","PSS51P2",38,0)
 ;
"RTN","PSS51P2",39,0)
LOOPDI ;LOOPS ON "DILIST" FROM FILEMAN CALL (USED FOR RETURNING MULTIPLE DRUGS FROM PSSFT)
"RTN","PSS51P2",40,0)
 S PSSTIEN=0 ;TEMP IEN TO ITERATE OVER DILIST
"RTN","PSS51P2",41,0)
 F  S PSSTIEN=$O(^TMP("DILIST",$J,PSSTIEN)) Q:PSSTIEN=""  D
"RTN","PSS51P2",42,0)
 .S PSSIEN2=($P(^TMP("DILIST",$J,PSSTIEN,0),U,1))
"RTN","PSS51P2",43,0)
 .D DIRREAD
"RTN","PSS51P2",44,0)
 Q
"RTN","PSS51P2",45,0)
 ;
"RTN","PSS51P2",46,0)
LOOPDIR ;LOOP FOR A DIRECT READ.  READS ALL IENs FOR ^PSDRUG(
"RTN","PSS51P2",47,0)
 S PSSIEN2=0
"RTN","PSS51P2",48,0)
 F  S PSSIEN2=$O(^PS(51.2,PSSIEN2)) Q:'PSSIEN2  D 
"RTN","PSS51P2",49,0)
 .D DIRALL
"RTN","PSS51P2",50,0)
 Q
"RTN","PSS51P2",51,0)
 ;
"RTN","PSS51P2",52,0)
DIRALL ;TEST FOR PSSFL, PSSPK, BAILS IF CONDITIONS MEET TRUE
"RTN","PSS51P2",53,0)
 I $G(PSSFL),$P($G(^PS(51.2,PSSIEN2,0)),U,5),$P($G(^PS(51.2,PSSIEN2,0)),U,5)'>PSSFL Q
"RTN","PSS51P2",54,0)
 I $G(PSSPK)]"" N PSSZ5,PSSZ6 S PSSZ5=0 F PSSZ6=1:1:$L(PSSPK) Q:PSSZ5  I $P($G(^PS(51.2,PSSIEN2,0)),U,4)[$E(PSSPK,PSSZ6) S PSSZ5=1
"RTN","PSS51P2",55,0)
 I $G(PSSPK)]"",'PSSZ5 Q
"RTN","PSS51P2",56,0)
 D DIRREAD
"RTN","PSS51P2",57,0)
 Q
"RTN","PSS51P2",58,0)
 ;
"RTN","PSS51P2",59,0)
DIRREAD ;MAIN DIRECT READ FOR ENTIRE ROUTINE
"RTN","PSS51P2",60,0)
 S PSSNAM=$P($G(^PS(51.2,PSSIEN2,0)),U,1)
"RTN","PSS51P2",61,0)
 S ^TMP($J,LIST,PSSIEN2,.01)=PSSNAM
"RTN","PSS51P2",62,0)
 S ^TMP($J,LIST,PSSIEN2,1)=$P($G(^PS(51.2,PSSIEN2,0)),U,3)
"RTN","PSS51P2",63,0)
 S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,4)
"RTN","PSS51P2",64,0)
 I PSSTMP="0" S ^TMP($J,LIST,PSSIEN2,3)=PSSTMP_U_"NATIONAL DRUG FILE ONLY"
"RTN","PSS51P2",65,0)
 I PSSTMP="1" S ^TMP($J,LIST,PSSIEN2,3)=PSSTMP_U_"ALL PACKAGES"
"RTN","PSS51P2",66,0)
 I PSSTMP="" S ^TMP($J,LIST,PSSIEN2,3)=""
"RTN","PSS51P2",67,0)
 S ^TMP($J,LIST,PSSIEN2,4)=$P($G(^PS(51.2,PSSIEN2,0)),U,2)
"RTN","PSS51P2",68,0)
 S ^TMP($J,LIST,PSSIEN2,4.1)=$P($G(^PS(51.2,PSSIEN2,0)),U,7)
"RTN","PSS51P2",69,0)
 I $P($G(^PS(51.2,PSSIEN2,0)),U,5)'="" D
"RTN","PSS51P2",70,0)
 .S PSSCAP=$$UP^XLFSTR($$FMTE^XLFDT($P($G(^PS(51.2,PSSIEN2,0)),U,5)))
"RTN","PSS51P2",71,0)
 .S ^TMP($J,LIST,PSSIEN2,5)=$P($G(^PS(51.2,PSSIEN2,0)),U,5)_U_PSSCAP
"RTN","PSS51P2",72,0)
 ELSE  S ^TMP($J,LIST,PSSIEN2,5)=""
"RTN","PSS51P2",73,0)
 N PSSTMP S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,6)
"RTN","PSS51P2",74,0)
 I PSSTMP="0"!PSSTMP="" S ^TMP($J,LIST,PSSIEN2,6)=PSSTMP_U_"NO"
"RTN","PSS51P2",75,0)
 I PSSTMP="1" D
"RTN","PSS51P2",76,0)
 .S ^TMP($J,LIST,PSSIEN2,6)=PSSTMP_U_"YES"
"RTN","PSS51P2",77,0)
 .S ^TMP($J,LIST,"IV",PSSNAM,PSSIEN2)=""
"RTN","PSS51P2",78,0)
 I PSSTMP="" S ^TMP($J,LIST,PSSIEN2,6)=""
"RTN","PSS51P2",79,0)
 S ^TMP($J,LIST,"B",$P($G(^PS(51.2,PSSIEN2,0)),U,1),PSSIEN2)=""
"RTN","PSS51P2",80,0)
 S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,8)
"RTN","PSS51P2",81,0)
 S ^TMP($J,LIST,PSSIEN2,7)=PSSTMP I PSSTMP]"" S ^(7)=^(7)_U_$S(PSSTMP:"YES",1:"NO")
"RTN","PSS51P2",82,0)
 S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,9)
"RTN","PSS51P2",83,0)
 S ^TMP($J,LIST,PSSIEN2,8)=PSSTMP I PSSTMP]"" S ^(8)=^(8)_U_$S(PSSTMP:"YES",1:"NO")
"RTN","PSS51P2",84,0)
 S PSSBGCNT=PSSBGCNT+1
"RTN","PSS51P2",85,0)
 Q
"RTN","PSS51P2",86,0)
 ;
"RTN","PSS51P2",87,0)
SETSCRN ;Set Screen for inactive Medication Routes
"RTN","PSS51P2",88,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",89,0)
 S SCR("S")="S ND=$P($G(^(0)),U,5) I ND=""""!(ND>PSSFL)"
"RTN","PSS51P2",90,0)
 Q
"RTN","PSS51P2",91,0)
 ;
"RTN","PSS51P2",92,0)
NAME(PSSFT,PSSPK,LIST) ;
"RTN","PSS51P2",93,0)
 ;PSSFT - Free Text name in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",94,0)
 ;PSSPK - PACKAGE USE field (#3) of the MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",95,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",96,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",97,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), and INACTIVATION DATE field (#5)
"RTN","PSS51P2",98,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",99,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS
"RTN","PSS51P2",100,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",101,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",102,0)
 I ($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",103,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",104,0)
 S SCR("S")=$S($G(PSSPK)]"":"I $P($G(^(0)),""^"",4)=$G(PSSPK)",1:"")
"RTN","PSS51P2",105,0)
 I PSSFT["??" D LOOP(2) Q
"RTN","PSS51P2",106,0)
 D FIND^DIC(51.2,,"@;.01;1","QP",PSSFT,,"B",SCR("S"),,"")
"RTN","PSS51P2",107,0)
 I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",108,0)
 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0)
"RTN","PSS51P2",109,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P2",110,0)
 .S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;5","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0
"RTN","PSS51P2",111,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2
"RTN","PSS51P2",112,0)
 K TMP("DILIST",$J),^TMP("PSS51P2",$J)
"RTN","PSS51P2",113,0)
 Q
"RTN","PSS51P2",114,0)
 ;
"RTN","PSS51P2",115,0)
IEN(PSSABBR,LIST) ;
"RTN","PSS51P2",116,0)
 ;PSSABBR - ABBREVIATION field (#1) in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",117,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",118,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",119,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), and INACTIVATION DATE field (#5)
"RTN","PSS51P2",120,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",121,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS
"RTN","PSS51P2",122,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",123,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",124,0)
 I ($G(PSSABBR)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",125,0)
 D FIND^DIC(51.2,,"@;.01;1","QP",PSSABBR,,"C",,,"")
"RTN","PSS51P2",126,0)
 I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",127,0)
 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0)
"RTN","PSS51P2",128,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P2",129,0)
 .S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;3;4;5;6;4.1","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0
"RTN","PSS51P2",130,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2
"RTN","PSS51P2",131,0)
 K TMP("DILIST",$J),^TMP("PSS51P2",$J)
"RTN","PSS51P2",132,0)
 Q
"RTN","PSS51P2",133,0)
 ;
"RTN","PSS51P2",134,0)
SETZRO ;
"RTN","PSS51P2",135,0)
 S ^TMP($J,LIST,+PSS(1),.01)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I"))
"RTN","PSS51P2",136,0)
 S ^TMP($J,LIST,"B",$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I")),+PSS(1))=""
"RTN","PSS51P2",137,0)
 S ^TMP($J,LIST,+PSS(1),4)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),4,"I"))
"RTN","PSS51P2",138,0)
 S ^TMP($J,LIST,+PSS(1),1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),1,"I"))
"RTN","PSS51P2",139,0)
 S ^TMP($J,LIST,+PSS(1),3)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),3,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),3,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),3,"E"))
"RTN","PSS51P2",140,0)
 S ^TMP($J,LIST,+PSS(1),5)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),5,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),5,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),5,"E"))
"RTN","PSS51P2",141,0)
 S ^TMP($J,LIST,+PSS(1),6)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),6,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),6,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),6,"E"))
"RTN","PSS51P2",142,0)
 S ^TMP($J,LIST,+PSS(1),4.1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),4.1,"I"))
"RTN","PSS51P2",143,0)
 Q
"RTN","PSS51P2",144,0)
 ;
"RTN","PSS51P2",145,0)
SETZRO2 ;
"RTN","PSS51P2",146,0)
 S ^TMP($J,LIST,+PSS(1),.01)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I"))
"RTN","PSS51P2",147,0)
 S ^TMP($J,LIST,"B",$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I")),+PSS(1))=""
"RTN","PSS51P2",148,0)
 S ^TMP($J,LIST,+PSS(1),1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),1,"I"))
"RTN","PSS51P2",149,0)
 S ^TMP($J,LIST,+PSS(1),5)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),5,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),5,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),5,"E"))
"RTN","PSS51P2",150,0)
 Q
"RTN","PSS51P2",151,0)
 ;
"RTN","PSS51P2",152,0)
LOOP(PSS) ;
"RTN","PSS51P2",153,0)
 N CNT S CNT=0
"RTN","PSS51P2",154,0)
 S PSSIEN=0 F  S PSSIEN=$O(^PS(51.2,PSSIEN)) Q:'PSSIEN  D @(PSS)
"RTN","PSS51P2",155,0)
 S ^TMP($J,LIST,0)=$S($G(CNT)>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P2",156,0)
 Q
"RTN","PSS51P2",157,0)
 ;
"RTN","PSS51P2",158,0)
1 ;
"RTN","PSS51P2",159,0)
 S ND=$G(^PS(51.2,+PSSIEN,0))
"RTN","PSS51P2",160,0)
 I +$G(PSSFL)>0 Q:$P($G(ND),"^",5)]""&($P($G(ND),"^",5)'>$G(PSSFL))
"RTN","PSS51P2",161,0)
 I $G(PSSPK)]"" Q:$P($G(ND),"^",4)'=$G(PSSPK)
"RTN","PSS51P2",162,0)
 K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;3;4;5;6;4.1","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0 D
"RTN","PSS51P2",163,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO S CNT=CNT+1
"RTN","PSS51P2",164,0)
 Q
"RTN","PSS51P2",165,0)
 ;
"RTN","PSS51P2",166,0)
2 ;
"RTN","PSS51P2",167,0)
 I $G(PSSPK)]"",$P($G(^PS(51.2,+PSSIEN,0)),"^",4)'=$G(PSSPK) Q
"RTN","PSS51P2",168,0)
 K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;5","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0 D
"RTN","PSS51P2",169,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2 S CNT=CNT+1
"RTN","PSS51P2",170,0)
 Q
"RTN","PSS55")
0^2^B48633216^B48173815
"RTN","PSS55",1,0)
PSS55 ;BHM/DB/TSS - API FOR PHARMACY PATIENT FILE ;15 JUN 05
"RTN","PSS55",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**101,108,118,88**;9/30/97;Build 12
"RTN","PSS55",3,0)
 ;
"RTN","PSS55",4,0)
PSS431(DFN,PO,PSDATE,PEDATE,LIST) ;
"RTN","PSS55",5,0)
 G ^PSS551
"RTN","PSS55",6,0)
PSS432(DFN,PO,LIST) ;SRS 3.2.43.2
"RTN","PSS55",7,0)
 N D0,DA,DR,DIC,IEN,PSSTMP,PSSTMP2
"RTN","PSS55",8,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",9,0)
 ;PO: Order # IEN [optional] If left blank, all active orders will be returned
"RTN","PSS55",10,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",11,0)
 N PSSPO,PSSDT,PSSIEN,PSSDATA,PSSQ
"RTN","PSS55",12,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",13,0)
 I +$G(DFN)'>0 G NODATA
"RTN","PSS55",14,0)
 S ^TMP($J,LIST,0)=0
"RTN","PSS55",15,0)
 I '$D(^PS(55,DFN,0)) G NODATA
"RTN","PSS55",16,0)
 I $G(PO)'="",$D(^PS(55,DFN,5,PO)) S PSSPO=$P(^PS(55,DFN,5,PO,0),"^") I $G(PSSPO)>0 S (DA(55.06),IEN)=PO G AUS2
"RTN","PSS55",17,0)
 I $G(PO)'="",$G(PSSPO)="" G NODATA
"RTN","PSS55",18,0)
 S PSSDT=0
"RTN","PSS55",19,0)
AUS ;Loop through stop date/time xref
"RTN","PSS55",20,0)
 F  S PSSDT=$O(^PS(55,DFN,5,"AUS",PSSDT)) Q:PSSDT'>0  S PSSIEN=0 D
"RTN","PSS55",21,0)
 .F  S PSSIEN=$O(^PS(55,DFN,5,"AUS",PSSDT,PSSIEN)) Q:PSSIEN'>0  D
"RTN","PSS55",22,0)
 ..S (IEN,DA(55.06))=PSSIEN,PSSDATA=$G(^PS(55,DFN,5,PSSIEN,0)) I $P(PSSDATA,"^",9)'="A" Q
"RTN","PSS55",23,0)
 ..D AUSDIQ
"RTN","PSS55",24,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",25,0)
 K PSSIEN,PSSDT,PSSDATA,LIST
"RTN","PSS55",26,0)
 Q
"RTN","PSS55",27,0)
AUSDIQ K ^UTILITY("DIQ1",$J),DIQ
"RTN","PSS55",28,0)
 S DA=DFN,DIC=55,DR=62,DR(55.06)=".01;.5;1;3;4;5;6;7;9;11;12;26;27;27.1;28",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",29,0)
 S PSSPO=$G(^UTILITY("DIQ1",$J,55.06,IEN,.01,"E")) F X=.01,.5,1,3,4,5,6,7,9,11,12,26,27,27.1,28 S ^TMP($J,LIST,IEN,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",30,0)
 F X=.5,1,3,4,5,6,7,9,27,27.1,28 S ^TMP($J,LIST,IEN,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,IEN,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",31,0)
 S PSSTMP=$P($G(^PS(55,DFN,5,IEN,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,IEN,108)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",32,0)
 K ^UTILITY("DIQ1",$J),DIQ
"RTN","PSS55",33,0)
 S ^TMP($J,LIST,"B",IEN)="",^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",34,0)
 Q
"RTN","PSS55",35,0)
ORDITEM(PSSTMP) ;
"RTN","PSS55",36,0)
 ;Reference to ^PSNDF(50.606 is supported by DBIA 2174
"RTN","PSS55",37,0)
 S PSSTMP2=$G(^PS(50.7,PSSTMP,0))
"RTN","PSS55",38,0)
 I PSSTMP2'="" S PSSTMP=PSSTMP_U_$P($G(PSSTMP2),U)_U_$P($G(PSSTMP2),U,2)_U_$P($G(^PS(50.606,$P($G(PSSTMP2),U,2),0)),U,1)
"RTN","PSS55",39,0)
 Q PSSTMP
"RTN","PSS55",40,0)
AUS2 ;one PO
"RTN","PSS55",41,0)
 S PSSQ=1 D AUSDIQ
"RTN","PSS55",42,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",43,0)
AUSQ K PSSDT,PSSIEN,PSSDATA,PSSPO,LIST,X,PSSQ,DA,DR,DIC Q
"RTN","PSS55",44,0)
 ;
"RTN","PSS55",45,0)
PSS433(DFN,LIST) ;
"RTN","PSS55",46,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",47,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",48,0)
 N X,DA,DR,PSSPO,PSSIEN,D0,IEN,PSSTMP,PSSTMP2
"RTN","PSS55",49,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",50,0)
 I $G(DFN)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",51,0)
 I '$D(^PS(55,DFN)) G NODATA
"RTN","PSS55",52,0)
 S PSSIEN=0,^TMP($J,LIST,0)=0
"RTN","PSS55",53,0)
BGN433 S PSSIEN=$O(^PS(55,DFN,5,PSSIEN)) G Q433:PSSIEN'>0 S PSSPO=$P($G(^PS(55,DFN,5,PSSIEN,0)),"^")
"RTN","PSS55",54,0)
 S (IEN,DA(55.06))=PSSIEN,DIC=55,DA=DFN,DR=62,DR(55.06)=".5;9;25;26;34;41;42;70",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",55,0)
 F X=.5,9,25,26,34,41,42,70 S ^TMP($J,LIST,+PSSIEN,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",56,0)
 S PSSTMP=$P($G(^PS(55,DFN,5,PSSIEN,.2)),U) I PSSTMP'=""  S ^TMP($J,LIST,PSSIEN,108)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",57,0)
 F X=.5,9,25,34,70 S ^TMP($J,LIST,+PSSIEN,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,+PSSIEN,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",58,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",59,0)
 S ^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",60,0)
 G BGN433
"RTN","PSS55",61,0)
Q433 K ^UTILITY("DIQ1",$J),PSSIEN,X,DR,DIC,DA,LIST Q
"RTN","PSS55",62,0)
PSS435(DFN,PO,LIST) ;SRS 3.2.43.5
"RTN","PSS55",63,0)
 N D0,DA,DIC,DR,IEN,X,PSSPO,PSSDATA,PSSIEN,PSSDT,PSSTMP,PSSTMP2,PSSSTAT
"RTN","PSS55",64,0)
 ;DFN:  IEN of Patient [REQUIRED]
"RTN","PSS55",65,0)
 ;PO: Order # [optional] If left blank, all active orders will be returned. 
"RTN","PSS55",66,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",67,0)
 ;Active hyperal orders utilizing "AIT" cross reference
"RTN","PSS55",68,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",69,0)
 I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",70,0)
 I '$D(^PS(55,DFN,"IV","AIT","H")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",71,0)
 S PSSDT=0,^TMP($J,LIST,0)=0
"RTN","PSS55",72,0)
AIT ;loop trough AIT xref
"RTN","PSS55",73,0)
 S PSSDT=$O(^PS(55,DFN,"IV","AIT","H",PSSDT)) G AITQ:PSSDT'>0 S PSSIEN=0
"RTN","PSS55",74,0)
AIT1 S PSSIEN=$O(^PS(55,DFN,"IV","AIT","H",PSSDT,PSSIEN)) G AIT:PSSIEN'>0
"RTN","PSS55",75,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSIEN,0)),PSSSTAT=$P($G(PSSDATA),"^",17) I PSSSTAT'="A",$G(PO)'>0 G AIT1
"RTN","PSS55",76,0)
 I +$G(PO)>0 G AIT1:PSSIEN'=PO
"RTN","PSS55",77,0)
 S PSSPO=$P(PSSDATA,"^",1),^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",78,0)
AITDIQ K ^UTILITY("DIQ1",$J) S DA=DFN,(IEN,DA(55.01))=PSSIEN,DIC=55,DR=100,DIQ(0)="IE",DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;9;31;100;104;106;108;110;112;120;121;132" D EN^DIQ1
"RTN","PSS55",79,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,9,31,100,104,106,108,110,112,120,121,132 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",80,0)
 F X=.02,.03,.04,.06,9,100,106,108,112,120,121,132 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",81,0)
 S PSSTMP=$P($G(^PS(55,DFN,"IV",PSSIEN,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,PSSIEN,130)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",82,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSS55",83,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",84,0)
 G AIT1
"RTN","PSS55",85,0)
AITQ I $G(^TMP($J,LIST,0))=0 K ^TMP($J,LIST) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",86,0)
 K PSSIEN,PSSDT,PSSSTAT,PSSDATA,PO,X,LIST Q
"RTN","PSS55",87,0)
 ;
"RTN","PSS55",88,0)
PSS436(DFN,ORDER,LIST) ;SRS 3.2.43.6
"RTN","PSS55",89,0)
 N D0,IEN,X,PSSTMP,PSSTMP2,DA,PSSLOOP,PSSPO,DIC,DR,PSSTMP,PSSA,PSSS,PSSDATA
"RTN","PSS55",90,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",91,0)
 ;ORDER:  ORDER NUMBER [REQUIRED]
"RTN","PSS55",92,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",93,0)
 ;Active IV AD nodes
"RTN","PSS55",94,0)
 K PSSLOOP Q:$G(LIST)=""  K ^TMP($J,LIST) I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",95,0)
 I '$D(^PS(55,DFN)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",96,0)
 K ^TMP($J,LIST) I $G(ORDER)="" S PSSLOOP=1 S ORDER=0 G LOOP436
"RTN","PSS55",97,0)
 I $G(ORDER)'="" S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0)) G PSS436Q:$G(PSSPO)'>0 G DIQ436
"RTN","PSS55",98,0)
LOOP436 S ORDER=$O(^PS(55,DFN,"IV","B",ORDER)) G PSS436Q:ORDER'>0  S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0))
"RTN","PSS55",99,0)
DIQ436 K DA,DR S DA=DFN,(IEN,DA(55.01))=PSSPO,DIC=55,DR=100
"RTN","PSS55",100,0)
 S DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;9;31;100;104;106;108;110;112;120;121;132;147"
"RTN","PSS55",101,0)
 S DIQ(0)="IE" D EN^DIQ1 I '$D(^UTILITY("DIQ1",$J)) G NODATA
"RTN","PSS55",102,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,9,31,100,104,106,108,110,112,120,121,132,147 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",103,0)
 F X=.02,.03,.04,.06,9,100,106,108,112,120,121,132,147 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",104,0)
 S PSSTMP=$P($G(^PS(55,DFN,"IV",PSSPO,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,PSSPO,130)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",105,0)
 S ^TMP($J,LIST,"B",PSSPO)="",PSSA=0,^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",106,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=0
"RTN","PSS55",107,0)
PSSA S PSSA=$O(^PS(55,DFN,"IV",PSSPO,"AD",PSSA)) I PSSA'>0 S PSSS=0 S ^TMP($J,LIST,PSSPO,"SOL",0)=0 G PSSS
"RTN","PSS55",108,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"AD",PSSA,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2),X3=$P(PSSDATA,"^",3)
"RTN","PSS55",109,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.01)=X1_"^"_$P($G(^PS(52.6,X1,0)),"^")
"RTN","PSS55",110,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.02)=X2
"RTN","PSS55",111,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.03)=X3
"RTN","PSS55",112,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=$G(^TMP($J,LIST,PSSPO,"ADD",0))+1
"RTN","PSS55",113,0)
 G PSSA
"RTN","PSS55",114,0)
PSSS I ^TMP($J,LIST,PSSPO,"ADD",0)'>0 S ^TMP($J,LIST,PSSPO,"ADD",0)="-1^NO DATA FOUND"
"RTN","PSS55",115,0)
 S PSSS=$O(^PS(55,DFN,"IV",PSSPO,"SOL",PSSS)) I PSSS'>0,$G(PSSLOOP)'=1 D  G PSS436Q
"RTN","PSS55",116,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",117,0)
 I PSSS'>0 D  G LOOP436
"RTN","PSS55",118,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",119,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"SOL",PSSS,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2)
"RTN","PSS55",120,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSS,.01)=X1_"^"_$P($G(^PS(52.7,X1,0)),"^")
"RTN","PSS55",121,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSS,1)=X2
"RTN","PSS55",122,0)
 S ^TMP($J,LIST,PSSPO,"SOL",0)=$G(^TMP($J,LIST,PSSPO,"SOL",0))+1
"RTN","PSS55",123,0)
 G PSSS
"RTN","PSS55",124,0)
PSS436Q K ^UTILITY("DIQ1",$J),DIQ I '$D(^TMP($J,LIST,"B")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",125,0)
 K PSSPO,PSSA,PSSDATA,X,LIST,X1,X2,PSSS,ORDER,PSSLOOP,DA,DR,DIC Q
"RTN","PSS55",126,0)
NODATA S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",127,0)
Q K IEN,PSSA,PSSS,PSSSTAT,X,LIST,X1,X2,X3,PSSDIY Q
"VER")
8.0^22.0
"^DD",51.2,51.2,8,0)
PROMPT FOR INJ. SITE IN BCMA^S^0:NO;1:YES;^0;8^Q
"^DD",51.2,51.2,8,3)
Enter YES if you wish a prompt for injection site to appear in BCMA.
"^DD",51.2,51.2,8,21,0)
^^2^2^3070111^
"^DD",51.2,51.2,8,21,1,0)
The purpose of this field is to provide a way to indicate that a
"^DD",51.2,51.2,8,21,2,0)
medication route needs to have a prompt for injection site in BCMA.
"^DD",51.2,51.2,8,"DT")
3070119
"^DD",51.2,51.2,9,0)
DSPLY ON IVP/IVPB TAB IN BCMA?^S^0:NO;1:YES;^0;9^Q
"^DD",51.2,51.2,9,3)
Enter YES if orders with this Med Route should display on the IVP/IVPB tab in BCMA.
"^DD",51.2,51.2,9,"DT")
3070518
"BLD",6040,6)
^113
**END**
**END**
