Released RG*1*3 SEQ #3
Extracted from mail message
**KIDS**:RG*1.0*3^

**INSTALL NAME**
RG*1.0*3
"BLD",696,0)
RG*1.0*3^CLINICAL INFO RESOURCE NETWORK^0^3000428^y
"BLD",696,1,0)
^^3^3^2991101^
"BLD",696,1,1,0)
CIRN EXCEPTION HANDLING OPTION
"BLD",696,1,2,0)
Refer to patch RG*1*3 in the FORUM Patch Module for a complete
"BLD",696,1,3,0)
description.
"BLD",696,4,0)
^9.64PA^991.8^2
"BLD",696,4,991.1,0)
991.1
"BLD",696,4,991.1,2,0)
^9.641^991.12^1
"BLD",696,4,991.1,2,991.12,0)
EXCEPTION  (sub-file)
"BLD",696,4,991.1,2,991.12,1,0)
^9.6411^10^2
"BLD",696,4,991.1,2,991.12,1,6,0)
EXCEPTION STATUS
"BLD",696,4,991.1,2,991.12,1,10,0)
TEXT
"BLD",696,4,991.1,222)
y^y^p^^^^n
"BLD",696,4,991.8,0)
991.8
"BLD",696,4,991.8,2,0)
^9.641^991.8^1
"BLD",696,4,991.8,2,991.8,0)
CIRN SITE PARAMETER  (File-top level)
"BLD",696,4,991.8,2,991.8,1,0)
^9.6411^42^3
"BLD",696,4,991.8,2,991.8,1,40,0)
EXC PURGE START DATE/TIME
"BLD",696,4,991.8,2,991.8,1,41,0)
EXC PURGE STOP DATE/TIME
"BLD",696,4,991.8,2,991.8,1,42,0)
EXC PURGE STATUS
"BLD",696,4,991.8,222)
y^y^p^^^^n
"BLD",696,4,"APDD",991.1,991.12)

"BLD",696,4,"APDD",991.1,991.12,6)

"BLD",696,4,"APDD",991.1,991.12,10)

"BLD",696,4,"APDD",991.8,991.8)

"BLD",696,4,"APDD",991.8,991.8,40)

"BLD",696,4,"APDD",991.8,991.8,41)

"BLD",696,4,"APDD",991.8,991.8,42)

"BLD",696,4,"B",991.1,991.1)

"BLD",696,4,"B",991.8,991.8)

"BLD",696,"ABNS",0)
^9.66A^^
"BLD",696,"ABPKG")
^^
"BLD",696,"INID")
^
"BLD",696,"INIT")
RGP3PST
"BLD",696,"KRN",0)
^9.67PA^19^18
"BLD",696,"KRN",.4,0)
.4
"BLD",696,"KRN",.4,"NM",0)
^9.68A^^
"BLD",696,"KRN",.401,0)
.401
"BLD",696,"KRN",.402,0)
.402
"BLD",696,"KRN",.403,0)
.403
"BLD",696,"KRN",.5,0)
.5
"BLD",696,"KRN",.84,0)
.84
"BLD",696,"KRN",3.6,0)
3.6
"BLD",696,"KRN",3.8,0)
3.8
"BLD",696,"KRN",9.2,0)
9.2
"BLD",696,"KRN",9.8,0)
9.8
"BLD",696,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",696,"KRN",9.8,"NM",1,0)
RGEVPRG^^0^B40126800
"BLD",696,"KRN",9.8,"NM",2,0)
RGEX01^^0^B19404595
"BLD",696,"KRN",9.8,"NM",3,0)
RGEX03^^0^B45023104
"BLD",696,"KRN",9.8,"NM",4,0)
RGEXHND1^^0^B32891579
"BLD",696,"KRN",9.8,"NM",5,0)
RGHLLOG^^0^B11216793
"BLD",696,"KRN",9.8,"NM",6,0)
RGRSUTIL^^0^B7793556
"BLD",696,"KRN",9.8,"NM",7,0)
RGEVPM^^0^B20082571
"BLD",696,"KRN",9.8,"NM",8,0)
RGRSBUL1^^0^B28025389
"BLD",696,"KRN",9.8,"NM",9,0)
RGP3PST^^0^B7840530
"BLD",696,"KRN",9.8,"NM",10,0)
RGRSDYN1^^0^B17028302
"BLD",696,"KRN",9.8,"NM",11,0)
RGMTAUD^^0^B13511940
"BLD",696,"KRN",9.8,"NM",12,0)
RGJCTS01^^0^B5462212
"BLD",696,"KRN",9.8,"NM",13,0)
RGRAS^^0^B9502958
"BLD",696,"KRN",9.8,"NM",14,0)
RGRSPT^^0^B17501276
"BLD",696,"KRN",9.8,"NM","B","RGEVPM",7)

"BLD",696,"KRN",9.8,"NM","B","RGEVPRG",1)

"BLD",696,"KRN",9.8,"NM","B","RGEX01",2)

"BLD",696,"KRN",9.8,"NM","B","RGEX03",3)

"BLD",696,"KRN",9.8,"NM","B","RGEXHND1",4)

"BLD",696,"KRN",9.8,"NM","B","RGHLLOG",5)

"BLD",696,"KRN",9.8,"NM","B","RGJCTS01",12)

"BLD",696,"KRN",9.8,"NM","B","RGMTAUD",11)

"BLD",696,"KRN",9.8,"NM","B","RGP3PST",9)

"BLD",696,"KRN",9.8,"NM","B","RGRAS",13)

"BLD",696,"KRN",9.8,"NM","B","RGRSBUL1",8)

"BLD",696,"KRN",9.8,"NM","B","RGRSDYN1",10)

"BLD",696,"KRN",9.8,"NM","B","RGRSPT",14)

"BLD",696,"KRN",9.8,"NM","B","RGRSUTIL",6)

"BLD",696,"KRN",19,0)
19
"BLD",696,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",696,"KRN",19,"NM",1,0)
RG CIRN EXCEPTION HANDLING^^0
"BLD",696,"KRN",19,"NM",2,0)
RG EXCEPTION MENU^^2
"BLD",696,"KRN",19,"NM",3,0)
RG EXCEPTION PURGE^^0
"BLD",696,"KRN",19,"NM","B","RG CIRN EXCEPTION HANDLING",1)

"BLD",696,"KRN",19,"NM","B","RG EXCEPTION MENU",2)

"BLD",696,"KRN",19,"NM","B","RG EXCEPTION PURGE",3)

"BLD",696,"KRN",19.1,0)
19.1
"BLD",696,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",696,"KRN",101,0)
101
"BLD",696,"KRN",101,"NM",0)
^9.68A^16^16
"BLD",696,"KRN",101,"NM",1,0)
RG EXCPT ACTION MENU^^0
"BLD",696,"KRN",101,"NM",2,0)
RG EXCPT DATE SORT^^0
"BLD",696,"KRN",101,"NM",3,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",696,"KRN",101,"NM",4,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",696,"KRN",101,"NM",5,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",696,"KRN",101,"NM",6,0)
RG EXCPT MAIN MENU^^0
"BLD",696,"KRN",101,"NM",7,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",696,"KRN",101,"NM",8,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",696,"KRN",101,"NM",9,0)
RG EXCPT PATIENT SORT^^0
"BLD",696,"KRN",101,"NM",10,0)
RG EXCPT SELECT^^0
"BLD",696,"KRN",101,"NM",11,0)
RG EXCPT SELECT TYPE^^0
"BLD",696,"KRN",101,"NM",12,0)
RG EXCPT SING PATIENT INIT^^0
"BLD",696,"KRN",101,"NM",13,0)
RG EXCPT TYPE SORT^^0
"BLD",696,"KRN",101,"NM",14,0)
RG EXCPT UPDATE STATUS^^0
"BLD",696,"KRN",101,"NM",15,0)
RG PT SUBSCRIPTION RECEIVER^^0
"BLD",696,"KRN",101,"NM",16,0)
VAFC ADT-A08 SERVER^^3
"BLD",696,"KRN",101,"NM","B","RG EXCPT ACTION MENU",1)

"BLD",696,"KRN",101,"NM","B","RG EXCPT DATE SORT",2)

"BLD",696,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",3)

"BLD",696,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",4)

"BLD",696,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",5)

"BLD",696,"KRN",101,"NM","B","RG EXCPT MAIN MENU",6)

"BLD",696,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",7)

"BLD",696,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",8)

"BLD",696,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",9)

"BLD",696,"KRN",101,"NM","B","RG EXCPT SELECT",10)

"BLD",696,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",11)

"BLD",696,"KRN",101,"NM","B","RG EXCPT SING PATIENT INIT",12)

"BLD",696,"KRN",101,"NM","B","RG EXCPT TYPE SORT",13)

"BLD",696,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",14)

"BLD",696,"KRN",101,"NM","B","RG PT SUBSCRIPTION RECEIVER",15)

"BLD",696,"KRN",101,"NM","B","VAFC ADT-A08 SERVER",16)

"BLD",696,"KRN",409.61,0)
409.61
"BLD",696,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",696,"KRN",409.61,"NM",1,0)
RG EXCPT ACTION^^0
"BLD",696,"KRN",409.61,"NM",2,0)
RG EXCPT SUMMARY^^0
"BLD",696,"KRN",409.61,"NM","B","RG EXCPT ACTION",1)

"BLD",696,"KRN",409.61,"NM","B","RG EXCPT SUMMARY",2)

"BLD",696,"KRN",771,0)
771
"BLD",696,"KRN",869.2,0)
869.2
"BLD",696,"KRN",870,0)
870
"BLD",696,"KRN",8994,0)
8994
"BLD",696,"KRN","B",.4,.4)

"BLD",696,"KRN","B",.401,.401)

"BLD",696,"KRN","B",.402,.402)

"BLD",696,"KRN","B",.403,.403)

"BLD",696,"KRN","B",.5,.5)

"BLD",696,"KRN","B",.84,.84)

"BLD",696,"KRN","B",3.6,3.6)

"BLD",696,"KRN","B",3.8,3.8)

"BLD",696,"KRN","B",9.2,9.2)

"BLD",696,"KRN","B",9.8,9.8)

"BLD",696,"KRN","B",19,19)

"BLD",696,"KRN","B",19.1,19.1)

"BLD",696,"KRN","B",101,101)

"BLD",696,"KRN","B",409.61,409.61)

"BLD",696,"KRN","B",771,771)

"BLD",696,"KRN","B",869.2,869.2)

"BLD",696,"KRN","B",870,870)

"BLD",696,"KRN","B",8994,8994)

"BLD",696,"QUES",0)
^9.62^^
"BLD",696,"REQB",0)
^9.611^4^4
"BLD",696,"REQB",1,0)
RG*1.0*1^2
"BLD",696,"REQB",2,0)
MPIF*1.0*1^2
"BLD",696,"REQB",3,0)
XU*8.0*131^2
"BLD",696,"REQB",4,0)
XU*8.0*145^2
"BLD",696,"REQB","B","MPIF*1.0*1",2)

"BLD",696,"REQB","B","RG*1.0*1",1)

"BLD",696,"REQB","B","XU*8.0*131",3)

"BLD",696,"REQB","B","XU*8.0*145",4)

"FIA",991.1)
CIRN HL7 EXCEPTION LOG
"FIA",991.1,0)
^RGHL7(991.1,
"FIA",991.1,0,0)
991.1
"FIA",991.1,0,1)
y^y^p^^^^n
"FIA",991.1,0,10)

"FIA",991.1,0,11)

"FIA",991.1,0,"RLRO")

"FIA",991.1,0,"VR")
1.0^RG
"FIA",991.1,991.1)
1
"FIA",991.1,991.12)
1
"FIA",991.1,991.12,6)

"FIA",991.1,991.12,10)

"FIA",991.8)
CIRN SITE PARAMETER
"FIA",991.8,0)
^RGSITE(991.8,
"FIA",991.8,0,0)
991.8
"FIA",991.8,0,1)
y^y^p^^^^n
"FIA",991.8,0,10)

"FIA",991.8,0,11)

"FIA",991.8,0,"RLRO")

"FIA",991.8,0,"VR")
1.0^RG
"FIA",991.8,991.8)
1
"FIA",991.8,991.8,40)

"FIA",991.8,991.8,41)

"FIA",991.8,991.8,42)

"INIT")
RGP3PST
"KRN",19,6403,-1)
2^2
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^12555^^^^^^^272
"KRN",19,6403,10,0)
^19.01IP^2^2
"KRN",19,6403,10,2,0)
6657^^3
"KRN",19,6403,10,2,"^")
RG CIRN EXCEPTION HANDLING
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6656,-1)
0^3
"KRN",19,6656,0)
RG EXCEPTION PURGE^CIRN Exception Purge ^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6656,1,0)
^^3^3^3000310^^^^
"KRN",19,6656,1,1,0)
This option purges duplicate entries, resolved entries over
"KRN",19,6656,1,2,0)
30 days old and entries for patients with names beginning 
"KRN",19,6656,1,3,0)
with "ZZ" from the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6656,25)
MAIN^RGEVPRG
"KRN",19,6656,"U")
CIRN EXCEPTION PURGE 
"KRN",19,6657,-1)
0^1
"KRN",19,6657,0)
RG CIRN EXCEPTION HANDLING^CIRN Exception Handling^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6657,1,0)
^^2^2^3000111^^^^
"KRN",19,6657,1,1,0)
This option provides utilities for handling CIRN Exceptions in the
"KRN",19,6657,1,2,0)
CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6657,25)
EN^RGEX01
"KRN",19,6657,"U")
CIRN EXCEPTION HANDLING
"KRN",101,1047,-1)
3^16
"KRN",101,1047,0)
VAFC ADT-A08 SERVER^Registration's ADT-A08 Server Protocol^^E^^^^^^^^REGISTRATION
"KRN",101,1047,1,0)
^^3^3^2990326^^^^
"KRN",101,1047,1,1,0)
This server protocol fires when a patient record is updated.  It
"KRN",101,1047,1,2,0)
generates a Health Level Seven (HL7) update a patient (event code A08)
"KRN",101,1047,1,3,0)
  message.
"KRN",101,1047,99)
57737,45227
"KRN",101,1047,770)
VAFC PIMS^^ADT^A08^d^P^^NE^NE^2.3^
"KRN",101,1047,772)
Q
"KRN",101,1047,775,0)
^101.0775PA^6^4
"KRN",101,1047,775,6,0)
1064
"KRN",101,1047,775,6,"^")
RG PT SUBSCRIPTION RECEIVER
"KRN",101,1064,-1)
0^15
"KRN",101,1064,0)
RG PT SUBSCRIPTION RECEIVER^Process a CIRN patient subscription request^^S^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1064,1,0)
^^4^4^2981015^
"KRN",101,1064,1,1,0)
This client protocol is used to process subscription control Master Files
"KRN",101,1064,1,2,0)
Notification messages.  The protocol is also used to reroute the message
"KRN",101,1064,1,3,0)
from the  CIRN Master Of Record (CMOR) to all other subscribers of the
"KRN",101,1064,1,4,0)
identified patient.
"KRN",101,1064,99)
57363,53001
"KRN",101,1064,770)
^RG SUBSCRIPTION^MFN^Z15^i^P^^^NE^2.3^MFN
"KRN",101,1064,771)
D REC^RGJCREC
"KRN",101,1064,773)
0^0^^1
"KRN",101,1064,774)
D ROUTE^RGJCSUB
"KRN",101,1692,-1)
0^6
"KRN",101,1692,0)
RG EXCPT MAIN MENU^CIRN EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^^2^2^3000125^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^EXC^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SP^7^^^Sort by Patient
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
58043,62323
"KRN",101,1693,-1)
0^10
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^^3^3^2991102^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the CIRN Exceptions screen in the CIRN Exception Handling
"KRN",101,1693,1,3,0)
option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
58043,62323
"KRN",101,1694,-1)
0^1
"KRN",101,1694,0)
RG EXCPT ACTION MENU^CIRN EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^^4^4^3000225^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the CIRN
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1694,4)
40
"KRN",101,1694,10,0)
^101.01PA^9^9
"KRN",101,1694,10,3,0)
1695^UPD^50^^^Update Status to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^42^^^MPI Display Only Query
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,5,0)
1697^SPI^45^^^Single Patient Init to MPI
"KRN",101,1694,10,5,"^")
RG EXCPT SING PATIENT INIT
"KRN",101,1694,10,6,0)
1698^ED^47^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^INQ^35^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^30^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^40^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
58191,51449
"KRN",101,1695,-1)
0^14
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^^3^3^3000125^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the CIRN Exception Handling option [RG CIRN 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
58043,62323
"KRN",101,1696,-1)
0^3
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^^2^2^3000125^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
58043,62323
"KRN",101,1697,-1)
0^12
"KRN",101,1697,0)
RG EXCPT SING PATIENT INIT^Single Patient Init to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1697,1,0)
^^3^3^3000125^^^
"KRN",101,1697,1,1,0)
This protocol allows the user to perform a Single Patient
"KRN",101,1697,1,2,0)
Initialization to the MPI from the CIRN Exception Handling option
"KRN",101,1697,1,3,0)
[RG CIRN EXCEPTION HANDLING].
"KRN",101,1697,20)
D INTL^RGEX03
"KRN",101,1697,99)
58043,62323
"KRN",101,1698,-1)
0^4
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^^2^2^3000125^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
58043,62323
"KRN",101,1699,-1)
0^13
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^^2^2^2991029^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
CIRN Exception Handling Option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
58043,62323
"KRN",101,1700,-1)
0^2
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^^2^2^2991029^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
58043,62323
"KRN",101,1701,-1)
0^9
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^^2^2^2991029^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SP" D SORT^RGEX01
"KRN",101,1701,99)
58043,62323
"KRN",101,1702,-1)
0^11
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^^4^4^2991105^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the CIRN Exceptions screen in the CIRN Exception Handling
"KRN",101,1702,1,4,0)
option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
58043,62323
"KRN",101,1703,-1)
0^8
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^^2^2^2991029^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
58043,62323
"KRN",101,1704,-1)
0^7
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^^2^2^2991029^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
58043,62323
"KRN",101,1705,-1)
0^5
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^^3^3^2991029^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the CIRN Exception Handling option 
"KRN",101,1705,1,3,0)
[RG CIRN EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
58043,62323
"KRN",409.61,230,-1)
0^2
"KRN",409.61,230,0)
RG EXCPT SUMMARY^1^^80^5^18^1^1^^RG EXCPT MAIN MENU^CIRN EXCEPTION HANDLING^1^^1
"KRN",409.61,230,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,230,"ARRAY")
 ^TMP("RGEXC",$J)
"KRN",409.61,230,"COL",0)
^409.621^4^4
"KRN",409.61,230,"COL",1,0)
Patient^6^21^Patient^H^0
"KRN",409.61,230,"COL",2,0)
SSN^28^9^SSN^H^0
"KRN",409.61,230,"COL",3,0)
Date^39^8^Date^^0
"KRN",409.61,230,"COL",4,0)
Exception Type^48^30^Exception Type^^0
"KRN",409.61,230,"COL","AIDENT",0,1)

"KRN",409.61,230,"COL","AIDENT",0,2)

"KRN",409.61,230,"COL","AIDENT",0,3)

"KRN",409.61,230,"COL","AIDENT",0,4)

"KRN",409.61,230,"COL","B","Date",3)

"KRN",409.61,230,"COL","B","Exception Type",4)

"KRN",409.61,230,"COL","B","Patient",1)

"KRN",409.61,230,"COL","B","SSN",2)

"KRN",409.61,230,"FNL")
D EXIT^RGEX01
"KRN",409.61,230,"HDR")
D HDR^RGEX01
"KRN",409.61,230,"HLP")
D HELP^RGEX01
"KRN",409.61,230,"INIT")
D INIT^RGEX01
"KRN",409.61,231,-1)
0^1
"KRN",409.61,231,0)
RG EXCPT ACTION^1^^80^5^18^1^1^^RG EXCPT ACTION MENU^CIRN EXCEPTION ACTIONS^1^^1
"KRN",409.61,231,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,231,"ARRAY")
 ^TMP("RGEXC2",$J)
"KRN",409.61,231,"COL",0)
^409.621^1^1
"KRN",409.61,231,"COL",1,0)
EXCEPTION^5^20^Exception Data^^0
"KRN",409.61,231,"COL","AIDENT",0,1)

"KRN",409.61,231,"COL","B","EXCEPTION",1)

"KRN",409.61,231,"FNL")
D EXIT^RGEX03
"KRN",409.61,231,"HDR")
D HDR^RGEX03
"KRN",409.61,231,"HLP")
D HELP^RGEX03
"KRN",409.61,231,"INIT")
D INIT^RGEX03
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^2^1
"PKG",272,20,2,0)
2^^RGDRM03
"PKG",272,20,"B",2,2)

"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
3^3000428^12582
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3000428
"PKG",272,22,1,"PAH",1,1,1,0)
CIRN EXCEPTION HANDLING OPTION
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*3 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","RGEVPM")
0^7^B20082571
"RTN","RGEVPM",1,0)
RGEVPM ;BIR/CML-VIEW POTENTIAL MATCH PATIENT LIST ;07/20/99
"RTN","RGEVPM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGEVPM",3,0)
 S QFLG=1
"RTN","RGEVPM",4,0)
BEGIN ;
"RTN","RGEVPM",5,0)
 W !!,"This report prints a list of patients who have been identified as having"
"RTN","RGEVPM",6,0)
 W !,"multiple Potential Matches on the Master Patient Index (MPI) and who haven't"
"RTN","RGEVPM",7,0)
 W !,"yet been resolved using the option ""Single Patient Initialization to MPI""."
"RTN","RGEVPM",8,0)
 W !,"Status is current as of the date/time the report is generated."
"RTN","RGEVPM",9,0)
 W !!,"This data is pulled from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGEVPM",10,0)
 W !,"Prior to producing the report, duplicate POTENTIAL MATCH patients will be"
"RTN","RGEVPM",11,0)
 W !,"purged from the file."
"RTN","RGEVPM",12,0)
 ;
"RTN","RGEVPM",13,0)
 D EXCTMP
"RTN","RGEVPM",14,0)
 I XCNT=0 W !!,"There are no patients identified as Potential Matches." G QUIT
"RTN","RGEVPM",15,0)
DEV ;
"RTN","RGEVPM",16,0)
 W !!,"The right margin for this report is 80.",!!
"RTN","RGEVPM",17,0)
 D EN^XUTMDEVQ("START^RGEVPM","CIRN - Potential Match Patient List") I 'POP Q
"RTN","RGEVPM",18,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGEVPM",19,0)
 G QUIT
"RTN","RGEVPM",20,0)
START ;
"RTN","RGEVPM",21,0)
 S HOME=$$SITE^VASITE()   ;institution file ptr^station name^station number
"RTN","RGEVPM",22,0)
 ;
"RTN","RGEVPM",23,0)
LOOP ;Search ^RGHL7(991.1,"ADFN" to see how many patients need to be resolved to MPI
"RTN","RGEVPM",24,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",25,0)
 ;
"RTN","RGEVPM",26,0)
 S (RCNT,RGDFN)=0
"RTN","RGEVPM",27,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPM",28,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPM",29,0)
 .I $E(ICN,1,3)=$P(HOME,"^",3)!(ICN<0) D
"RTN","RGEVPM",30,0)
 ..S RCNT=RCNT+1
"RTN","RGEVPM",31,0)
 ..S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPM",32,0)
 ..S ^TMP("RGEVPM",$J,VADM(1),RGDFN)=$P(VADM(2),"^")_"^"_$P(VADM(3),"^",2)
"RTN","RGEVPM",33,0)
 ;
"RTN","RGEVPM",34,0)
PRT ;Print report
"RTN","RGEVPM",35,0)
 S (PG,QFLG)=0,$P(LN,"-",81)="",LOCSITE=$P(HOME,"^",2)
"RTN","RGEVPM",36,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGEVPM",37,0)
 D HDR
"RTN","RGEVPM",38,0)
 I '$D(^TMP("RGEVPM",$J)) W !!,"No patients found who need to be resolved to the MPI." G QUIT
"RTN","RGEVPM",39,0)
 ;
"RTN","RGEVPM",40,0)
 ;count the number of patients who need to be resolved
"RTN","RGEVPM",41,0)
 S PTNM="",CNT=0
"RTN","RGEVPM",42,0)
 F  S PTNM=$O(^TMP("RGEVPM",$J,PTNM)) Q:PTNM=""  Q:QFLG  D
"RTN","RGEVPM",43,0)
 .S RGDFN=0
"RTN","RGEVPM",44,0)
 .F  S RGDFN=$O(^TMP("RGEVPM",$J,PTNM,RGDFN)) Q:'RGDFN  S CNT=CNT+1
"RTN","RGEVPM",45,0)
 ;
"RTN","RGEVPM",46,0)
 S PTNM=""
"RTN","RGEVPM",47,0)
 F  S PTNM=$O(^TMP("RGEVPM",$J,PTNM)) Q:PTNM=""  Q:QFLG  D
"RTN","RGEVPM",48,0)
 .S RGDFN=0
"RTN","RGEVPM",49,0)
 .F  S RGDFN=$O(^TMP("RGEVPM",$J,PTNM,RGDFN)) Q:'RGDFN  Q:QFLG  D
"RTN","RGEVPM",50,0)
 ..S SSN=$P(^TMP("RGEVPM",$J,PTNM,RGDFN),"^")
"RTN","RGEVPM",51,0)
 ..S DOB=$P(^TMP("RGEVPM",$J,PTNM,RGDFN),"^",2)
"RTN","RGEVPM",52,0)
 ..D:$Y+4>IOSL HDR Q:QFLG  W !,PTNM,?36,SSN,?50,DOB,?68,$J(RGDFN,9)
"RTN","RGEVPM",53,0)
 W !!,"TOTAL: ",CNT
"RTN","RGEVPM",54,0)
 ;
"RTN","RGEVPM",55,0)
QUIT ;
"RTN","RGEVPM",56,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGEVPM",57,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGEVPM",58,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",59,0)
 K %,CNT,DA,DFN,DIK,DIR,DOB,DUPCNT,EXCDT,HDT,HOME,ICN,IEN,IEN2,JJ,LCNT,LN,LOCSITE
"RTN","RGEVPM",60,0)
 K NCNT,NODE,OLDDT,OLDNODE,PG,PTNM,QFLG,RCNT,RDT,RGDFN,SS,SSN,VADM,X,XCNT,Y,ZTSK
"RTN","RGEVPM",61,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGEVPM",62,0)
 ;
"RTN","RGEVPM",63,0)
HDR ;HEADER
"RTN","RGEVPM",64,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGEVPM",65,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGEVPM",66,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGEVPM",67,0)
 W !,"PATIENT LIST of Potential Matches to be Resolved",?72,"Page: ",PG
"RTN","RGEVPM",68,0)
 W !,"Printed at ",LOCSITE," on ",HDT
"RTN","RGEVPM",69,0)
 W !!,"Patient Name",?39,"SSN",?52,"DOB",?70,"DFN",!,LN
"RTN","RGEVPM",70,0)
 Q
"RTN","RGEVPM",71,0)
 ;
"RTN","RGEVPM",72,0)
EXCTMP ;Count number of POTENTIAL MATCH type entries (IEN=218) in CIRN HL7 EXCEPTION LOG 
"RTN","RGEVPM",73,0)
 ;file 991.1, build XTMP global of unique patients and purge dup entries in file.
"RTN","RGEVPM",74,0)
 W !!,"...one moment please..",!
"RTN","RGEVPM",75,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",76,0)
 S (RGDFN,CNT,XCNT,DUPCNT)=0
"RTN","RGEVPM",77,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPM",78,0)
 .S IEN=0
"RTN","RGEVPM",79,0)
 .F  S IEN=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPM",80,0)
 ..S IEN2=0
"RTN","RGEVPM",81,0)
 ..F  S IEN2=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPM",82,0)
 ...S CNT=CNT+1
"RTN","RGEVPM",83,0)
 ...S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEVPM",84,0)
 ...I '$D(^TMP("RGEVPM",$J,RGDFN)) D  Q
"RTN","RGEVPM",85,0)
 ....S XCNT=XCNT+1
"RTN","RGEVPM",86,0)
 ....D SETTMP
"RTN","RGEVPM",87,0)
 ...I $D(^TMP("RGEVPM",$J,RGDFN))  D
"RTN","RGEVPM",88,0)
 ....S OLDNODE=^TMP("RGEVPM",$J,RGDFN)
"RTN","RGEVPM",89,0)
 ....S OLDDT=$P(OLDNODE,"^")
"RTN","RGEVPM",90,0)
 ....I EXCDT>OLDDT D  Q
"RTN","RGEVPM",91,0)
 .....S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGEVPM",92,0)
 .....D DELDUP
"RTN","RGEVPM",93,0)
 .....D SETTMP
"RTN","RGEVPM",94,0)
 ....I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGEVPM",95,0)
 .....S DA(1)=IEN,DA=IEN2
"RTN","RGEVPM",96,0)
 .....D DELDUP
"RTN","RGEVPM",97,0)
 W !,DUPCNT," duplicate patient entries for POTENTIAL MATCH exceptions were identified"
"RTN","RGEVPM",98,0)
 W !,"and deleted from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGEVPM",99,0)
 Q
"RTN","RGEVPM",100,0)
 ;
"RTN","RGEVPM",101,0)
SETTMP ;set TMP global for patient check
"RTN","RGEVPM",102,0)
 S ^TMP("RGEVPM",$J,RGDFN)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPM",103,0)
 Q
"RTN","RGEVPM",104,0)
 ;
"RTN","RGEVPM",105,0)
DELDUP ;delete patient dups from file
"RTN","RGEVPM",106,0)
 S DUPCNT=DUPCNT+1
"RTN","RGEVPM",107,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPM",108,0)
 D ^DIK K DIK,DA
"RTN","RGEVPM",109,0)
 Q
"RTN","RGEVPM",110,0)
 ;
"RTN","RGEVPM",111,0)
CURPM() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION LOG
"RTN","RGEVPM",112,0)
 ;file (#991.1) with an exception TYPE of "POTENTIAL MATCH" who currently need
"RTN","RGEVPM",113,0)
 ;to be resolved to the MPI.
"RTN","RGEVPM",114,0)
 ;returns a value of "1" if any are found, "0" if none are found
"RTN","RGEVPM",115,0)
 N LOC,RGDFN,GOT,ICN
"RTN","RGEVPM",116,0)
 S LOC=$P($$SITE^VASITE(),"^",3)
"RTN","RGEVPM",117,0)
 S (GOT,RGDFN)=0
"RTN","RGEVPM",118,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D  Q:GOT
"RTN","RGEVPM",119,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPM",120,0)
 .I $E(ICN,1,3)=LOC!(ICN<0) S GOT=1 Q
"RTN","RGEVPM",121,0)
 I GOT Q 1
"RTN","RGEVPM",122,0)
 Q 0
"RTN","RGEVPRG")
0^1^B40126800
"RTN","RGEVPRG",1,0)
RGEVPRG ;BAY/ALS-OPTIONS TO PURGE CIRN EXCEPTIONS ;08/23/99
"RTN","RGEVPRG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGEVPRG",3,0)
 ;
"RTN","RGEVPRG",4,0)
MAIN ;
"RTN","RGEVPRG",5,0)
 Q:($D(^TMP("RGEXC")))!($D(^TMP("RGEXC2")))
"RTN","RGEVPRG",6,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):5 E  Q
"RTN","RGEVPRG",7,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RGEVPRG",8,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",1)=$$NOW^XLFDT
"RTN","RGEVPRG",9,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="R"
"RTN","RGEVPRG",10,0)
 D PROC
"RTN","RGEVPRG",11,0)
 D PRGDUP
"RTN","RGEVPRG",12,0)
 D PRG30
"RTN","RGEVPRG",13,0)
 D PRGZZ
"RTN","RGEVPRG",14,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",2)=$$NOW^XLFDT
"RTN","RGEVPRG",15,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="C"
"RTN","RGEVPRG",16,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEVPRG",17,0)
 Q
"RTN","RGEVPRG",18,0)
PRGPAT ;Purge by Patient
"RTN","RGEVPRG",19,0)
 W !
"RTN","RGEVPRG",20,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: "
"RTN","RGEVPRG",21,0)
 D ^DIC K DIC G:Y<0 QUIT  S RGDFN=+Y
"RTN","RGEVPRG",22,0)
 S EXCT="",FLAG=0
"RTN","RGEVPRG",23,0)
 F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:EXCT=""  D
"RTN","RGEVPRG",24,0)
 . I $D(^RGHL7(991.1,"ADFN",EXCT,RGDFN)) S FLAG=1 Q
"RTN","RGEVPRG",25,0)
 I FLAG=0 W !,"There are no exceptions on file for this patient." G PRGPAT
"RTN","RGEVPRG",26,0)
 I $$IFLOCAL^MPIF001(RGDFN) W !,"This patient does not have a national ICN assigned, do not purge." Q
"RTN","RGEVPRG",27,0)
 S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",28,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",29,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file for "_VADM(1)_"?   YES//  "
"RTN","RGEVPRG",30,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",31,0)
 . S EXCT="",CNT=0
"RTN","RGEVPRG",32,0)
 . F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:'EXCT  D
"RTN","RGEVPRG",33,0)
 .. S IEN=0
"RTN","RGEVPRG",34,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",35,0)
 ... S IEN2=0
"RTN","RGEVPRG",36,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",37,0)
 .... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",38,0)
 .... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",39,0)
 .... E  I NUM>1 D DEL
"RTN","RGEVPRG",40,0)
 . W !,"All exceptions purged for "_VADM(1)_"   DFN: "_RGDFN
"RTN","RGEVPRG",41,0)
 K EXCT,DFN,FLAG,VADM,CNT,IEN,IEN2,NUM,RGDFN,Y
"RTN","RGEVPRG",42,0)
QUIT Q
"RTN","RGEVPRG",43,0)
 ;
"RTN","RGEVPRG",44,0)
PRGDT ; Purge by Date
"RTN","RGEVPRG",45,0)
 W !!,"Enter a date for the purge. All exceptions on file, on or before that date, will be deleted."
"RTN","RGEVPRG",46,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGEVPRG",47,0)
 S DIR(0)="DA^:DT:EPX",DIR("A")="Enter Date for Purge: "
"RTN","RGEVPRG",48,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEVPRG",49,0)
 S PURDT=Y
"RTN","RGEVPRG",50,0)
 S PDATE=$$FMTE^XLFDT(PURDT)
"RTN","RGEVPRG",51,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",52,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file dated on or before "_PDATE_"?  YES//  "
"RTN","RGEVPRG",53,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",54,0)
 . S EXCDT="",CNT=0
"RTN","RGEVPRG",55,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",56,0)
 .. I ($P(EXCDT,".",1)=PURDT)!($P(EXCDT,".",1)<PURDT) D
"RTN","RGEVPRG",57,0)
 ... S IEN=0
"RTN","RGEVPRG",58,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",59,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1
"RTN","RGEVPRG",60,0)
 .... S CNT=CNT+NUM
"RTN","RGEVPRG",61,0)
 .... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",62,0)
 .... D ^DIK K DIK,DA
"RTN","RGEVPRG",63,0)
 I CNT=0 W !,"There are no exceptions dated on or before "_PDATE_", no data to purge."
"RTN","RGEVPRG",64,0)
 E  I CNT>0 W !,CNT_" exceptions, dated on or before "_PDATE_" have been purged!"
"RTN","RGEVPRG",65,0)
 K PDATE,PURDT,EXCDT,CNT,IEN,NUM,Y
"RTN","RGEVPRG",66,0)
 Q
"RTN","RGEVPRG",67,0)
PRG30   ; Purge Exceptions over 30 days old
"RTN","RGEVPRG",68,0)
 S TODAY=""
"RTN","RGEVPRG",69,0)
 S TODAY=$$NOW^XLFDT D
"RTN","RGEVPRG",70,0)
 . S EXCDT="",CNT=0,DIFF=""
"RTN","RGEVPRG",71,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",72,0)
 .. S DIFF=$$FMDIFF^XLFDT(TODAY,EXCDT)
"RTN","RGEVPRG",73,0)
 .. I DIFF>30 D
"RTN","RGEVPRG",74,0)
 ... S IEN=0
"RTN","RGEVPRG",75,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",76,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:'NUM
"RTN","RGEVPRG",77,0)
 .... S IEN2=0
"RTN","RGEVPRG",78,0)
 .... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",79,0)
 ..... S STAT=""
"RTN","RGEVPRG",80,0)
 ..... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)
"RTN","RGEVPRG",81,0)
 ..... ; Only delete PROCESSED exceptions
"RTN","RGEVPRG",82,0)
 ..... I STAT>0 D
"RTN","RGEVPRG",83,0)
 ...... I NUM>1 D DEL
"RTN","RGEVPRG",84,0)
 ...... E  I NUM=1 D
"RTN","RGEVPRG",85,0)
 ....... S CNT=CNT+NUM
"RTN","RGEVPRG",86,0)
 ....... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",87,0)
 ....... D ^DIK K DIK,DA
"RTN","RGEVPRG",88,0)
 K DIFF,TODAY,EXCDT,CNT,IEN,IEN2,NUM,STAT
"RTN","RGEVPRG",89,0)
 Q
"RTN","RGEVPRG",90,0)
PRGEXC ; Purge by Exception Type
"RTN","RGEVPRG",91,0)
 ;S DIC="^RGHL7(991.11,",DIC(0)="QEAM"
"RTN","RGEVPRG",92,0)
 ;S DIC("A")="Enter an exception type to purge: "
"RTN","RGEVPRG",93,0)
 ;D ^DIC K DIC G:Y<200 QUIT  S EXCTYP=+Y,ETYPE=X
"RTN","RGEVPRG",94,0)
 ;S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",95,0)
 ;S DIR("A")="*WARNING* This will permanently delete all "_ETYPE_" exceptions. Are you sure you want to do this?  YES//  "
"RTN","RGEVPRG",96,0)
 ;D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",97,0)
 ;. S CNT=0,IEN=""
"RTN","RGEVPRG",98,0)
 ;. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",99,0)
 ;.. S IEN2=0
"RTN","RGEVPRG",100,0)
 ;.. F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",101,0)
 ;... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",102,0)
 ;... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",103,0)
 ;... E  I NUM>1 D DEL
"RTN","RGEVPRG",104,0)
 ;I CNT=0 W !,"There are no "_ETYPE_" exceptions on file."
"RTN","RGEVPRG",105,0)
 ;E  I CNT>0 W !,CNT_" "_ETYPE_" Exceptions purged!"
"RTN","RGEVPRG",106,0)
 ;K ETYPE,CNT,IEN,IEN2,NUM,X,Y
"RTN","RGEVPRG",107,0)
 ;Q
"RTN","RGEVPRG",108,0)
PRGDUP ; Purge Duplicate Entries
"RTN","RGEVPRG",109,0)
 S EXCTYP="",CNT=0
"RTN","RGEVPRG",110,0)
 K ^TMP("RGEVDUP",$J)
"RTN","RGEVPRG",111,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",112,0)
 . S RGDFN=""
"RTN","RGEVPRG",113,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",114,0)
 .. S IEN=0
"RTN","RGEVPRG",115,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",116,0)
 ... S IEN2=0
"RTN","RGEVPRG",117,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",118,0)
 .... S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEVPRG",119,0)
 .... I '$D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D  Q
"RTN","RGEVPRG",120,0)
 ..... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",121,0)
 .... I $D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D
"RTN","RGEVPRG",122,0)
 ..... S OLDNODE=^TMP("RGEVDUP",$J,RGDFN,EXCTYP)
"RTN","RGEVPRG",123,0)
 ..... S OLDDT=$P(OLDNODE,"^")
"RTN","RGEVPRG",124,0)
 ..... I EXCDT>OLDDT D  Q
"RTN","RGEVPRG",125,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",126,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=$P(OLDNODE,"^",2) D ^DIK K DIK,DA
"RTN","RGEVPRG",127,0)
 ...... E  I NUM>1 D
"RTN","RGEVPRG",128,0)
 ....... S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGEVPRG",129,0)
 ....... S DIK="^RGHL7(991.1,"_DA(1)_",1," D ^DIK K DIK,DA
"RTN","RGEVPRG",130,0)
 ...... S CNT=CNT+1
"RTN","RGEVPRG",131,0)
 ...... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",132,0)
 ..... I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGEVPRG",133,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",134,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",135,0)
 ...... E  I NUM>1 D DEL
"RTN","RGEVPRG",136,0)
 ; W !,CNT_" Duplicate entries"
"RTN","RGEVPRG",137,0)
 K OLDDT,OLDNODE,EXCDT,CNT,IEN,IEN2,NUM,RGDFN
"RTN","RGEVPRG",138,0)
 Q
"RTN","RGEVPRG",139,0)
PRGZZ ;Purge ZZ (Duplicate indicator) patients from exception file.
"RTN","RGEVPRG",140,0)
 S EXCTYP="",CNT=""
"RTN","RGEVPRG",141,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",142,0)
 . S RGDFN=""
"RTN","RGEVPRG",143,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",144,0)
 .. S IEN=0
"RTN","RGEVPRG",145,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",146,0)
 ... S IEN2=0
"RTN","RGEVPRG",147,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",148,0)
 .... S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",149,0)
 .... I ($E($G(VADM(1)),1,2)="ZZ")!(VADM(1)="") D
"RTN","RGEVPRG",150,0)
 ..... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",151,0)
 ..... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA
"RTN","RGEVPRG",152,0)
 ..... E  I NUM>1 D DEL
"RTN","RGEVPRG",153,0)
 K EXCTYP,RGDFN,DFN,IEN,IEN2,NUM,VADM
"RTN","RGEVPRG",154,0)
 Q
"RTN","RGEVPRG",155,0)
DEL ;
"RTN","RGEVPRG",156,0)
 S CNT=CNT+1
"RTN","RGEVPRG",157,0)
 S DA(1)=IEN,DA=IEN2
"RTN","RGEVPRG",158,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",159,0)
 D ^DIK K DIK,DA
"RTN","RGEVPRG",160,0)
 Q
"RTN","RGEVPRG",161,0)
PROC ; 
"RTN","RGEVPRG",162,0)
 S EXCTYP=""
"RTN","RGEVPRG",163,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEVPRG",164,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",165,0)
 . I (EXCTYP=209)!(EXCTYP=213)!(EXCTYP=214)!(EXCTYP=218) D
"RTN","RGEVPRG",166,0)
 .. S IEN=0
"RTN","RGEVPRG",167,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",168,0)
 ... S IEN2=0,ICN="",RGDFN=""
"RTN","RGEVPRG",169,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",170,0)
 .... S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEVPRG",171,0)
 .... S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPRG",172,0)
 .... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEVPRG",173,0)
 ..... L +^RGHL7(991.1,IEN):10
"RTN","RGEVPRG",174,0)
 ..... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",175,0)
 ..... D ^DIE K DIE,DA,DR
"RTN","RGEVPRG",176,0)
 ..... L -^RGHL7(991.1,IEN)
"RTN","RGEVPRG",177,0)
 K EXCTYP,HOME,ICN,IEN,IEN2,RGDFN
"RTN","RGEVPRG",178,0)
 Q
"RTN","RGEX01")
0^2^B19404595
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR CIRN EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGEX01",3,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",4,0)
 N STDT,ENDDT,PRGSTAT,XFLAG
"RTN","RGEX01",5,0)
 S XFLAG=0
"RTN","RGEX01",6,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGEX01",7,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",8,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",9,0)
 I PRGSTAT="" D
"RTN","RGEX01",10,0)
 . W $C(7)
"RTN","RGEX01",11,0)
 . W !!,"The CIRN Exception Purge process has not been run."
"RTN","RGEX01",12,0)
 . S DIR(0)="YA",DIR("B")="NO"
"RTN","RGEX01",13,0)
 . S DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",14,0)
 . S DIR("A")="Do you want to run it now? "
"RTN","RGEX01",15,0)
 . D ^DIR K DIR
"RTN","RGEX01",16,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",17,0)
 . I Y>0 D
"RTN","RGEX01",18,0)
 .. W !!,"The CIRN Exception Purge process will now run."
"RTN","RGEX01",19,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",20,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",21,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The CIRN Exception Purge process is currently running.",!,"Please try this option again in ten minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",22,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",23,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",24,0)
 . W !!,"The CIRN Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",25,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",26,0)
 . S DIR("A")="Do you want to run the CIRN Exception Purge process now? "
"RTN","RGEX01",27,0)
 . D ^DIR K DIR,RGANS S RGANS=Y
"RTN","RGEX01",28,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",29,0)
 . L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 D
"RTN","RGEX01",30,0)
 ..I '$T S RGANS=1 Q
"RTN","RGEX01",31,0)
 ..L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",32,0)
 . I RGANS>0 D
"RTN","RGEX01",33,0)
 .. W !!,"The CIRN Exception Purge process will now run."
"RTN","RGEX01",34,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",35,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",36,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",37,0)
 K RGANS
"RTN","RGEX01",38,0)
 D WAIT^DICD
"RTN","RGEX01",39,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",40,0)
 Q
"RTN","RGEX01",41,0)
 ;
"RTN","RGEX01",42,0)
HDR ; -- header code
"RTN","RGEX01",43,0)
 S VALMHDR(1)="CIRN Exception Handling"
"RTN","RGEX01",44,0)
 S VALMHDR(2)=""
"RTN","RGEX01",45,0)
 Q
"RTN","RGEX01",46,0)
 ;
"RTN","RGEX01",47,0)
INIT ; -- init variables and list array
"RTN","RGEX01",48,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",49,0)
 K @VALMAR
"RTN","RGEX01",50,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",51,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",52,0)
 E  I RGSORT="SP" D PATLST^RGEXHND1
"RTN","RGEX01",53,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",54,0)
 Q
"RTN","RGEX01",55,0)
 ;
"RTN","RGEX01",56,0)
SORT ;
"RTN","RGEX01",57,0)
 D INIT
"RTN","RGEX01",58,0)
 S VALMBCK="R"
"RTN","RGEX01",59,0)
 Q
"RTN","RGEX01",60,0)
HELP ; -- help code
"RTN","RGEX01",61,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",62,0)
 Q
"RTN","RGEX01",63,0)
HLPPRG ;
"RTN","RGEX01",64,0)
 W !,"Enter Y(YES) to run the CIRN Exception Purge process now."
"RTN","RGEX01",65,0)
 W !!,"Enter N(NO) to go directly into the CIRN Exception Handling option."
"RTN","RGEX01",66,0)
 Q
"RTN","RGEX01",67,0)
 ;
"RTN","RGEX01",68,0)
EXIT ; -- exit code
"RTN","RGEX01",69,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",70,0)
 Q
"RTN","RGEX01",71,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",72,0)
 D NOW^%DTC
"RTN","RGEX01",73,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",74,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",75,0)
 D ^%ZTLOAD
"RTN","RGEX01",76,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",77,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",78,0)
 Q
"RTN","RGEX01",79,0)
 ;
"RTN","RGEX01",80,0)
EXPND ; -- expand code
"RTN","RGEX01",81,0)
 Q
"RTN","RGEX01",82,0)
CUREX() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION
"RTN","RGEX01",83,0)
 ;LOG file (#991.1) that currently need to be resolved
"RTN","RGEX01",84,0)
 S STAT="",EXCTYP="",RGEX=0
"RTN","RGEX01",85,0)
 F  S STAT=$O(^RGHL7(991.1,"ASTAT",STAT)) Q:STAT=""!RGEX=1  D
"RTN","RGEX01",86,0)
 . F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT",STAT,EXCTYP)) Q:'EXCTYP!RGEX=1  D
"RTN","RGEX01",87,0)
 .. I (EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)))&(STAT=0) S RGEX=1
"RTN","RGEX01",88,0)
 K STAT,EXCTYP
"RTN","RGEX01",89,0)
 Q RGEX
"RTN","RGEX01",90,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",91,0)
 ; DFN must be defined
"RTN","RGEX01",92,0)
 Q:'$D(DFN)
"RTN","RGEX01",93,0)
 S EXCTYP=""
"RTN","RGEX01",94,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX01",95,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",96,0)
 . S RGDFN="",ICN=""
"RTN","RGEX01",97,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",98,0)
 .. I DFN=RGDFN D
"RTN","RGEX01",99,0)
 ... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",100,0)
 ... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",101,0)
 ... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",102,0)
 .... ;Exclude Death exceptions, they must be processed manually.
"RTN","RGEX01",103,0)
 .... I (EXCTYP>217)!(EXCTYP<215) D
"RTN","RGEX01",104,0)
 ..... S IEN=0
"RTN","RGEX01",105,0)
 ..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",106,0)
 ...... S IEN2=0
"RTN","RGEX01",107,0)
 ...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",108,0)
 ....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",109,0)
 ....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",110,0)
 ....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",111,0)
 ....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",112,0)
 K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",113,0)
 Q
"RTN","RGEX03")
0^3^B45023104
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR CIRN EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGEX03",3,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",4,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",5,0)
 Q
"RTN","RGEX03",6,0)
 ;
"RTN","RGEX03",7,0)
HDR ; -- header code
"RTN","RGEX03",8,0)
 S VALMHDR(1)="CIRN EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",9,0)
 S VALMHDR(2)=""
"RTN","RGEX03",10,0)
 Q
"RTN","RGEX03",11,0)
 ;
"RTN","RGEX03",12,0)
INIT ; -- init variables and list array
"RTN","RGEX03",13,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",14,0)
 K @VALMAR
"RTN","RGEX03",15,0)
 I DATA="" Q
"RTN","RGEX03",16,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",17,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",18,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",19,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",20,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",21,0)
 D ADDTMP
"RTN","RGEX03",22,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",23,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",24,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",25,0)
 D ADDTMP
"RTN","RGEX03",26,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",29,0)
 D ADDTMP
"RTN","RGEX03",30,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",33,0)
 D ADDTMP
"RTN","RGEX03",34,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",36,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",37,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",38,0)
 D ADDTMP
"RTN","RGEX03",39,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",40,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",41,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",42,0)
 D ADDTMP
"RTN","RGEX03",43,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",44,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",45,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",46,0)
 D ADDTMP
"RTN","RGEX03",47,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",48,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",50,0)
 D ADDTMP
"RTN","RGEX03",51,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",52,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",53,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",54,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",55,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",57,0)
 D ADDTMP
"RTN","RGEX03",58,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",59,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",60,0)
 S VAFCDFN=DFN
"RTN","RGEX03",61,0)
 Q
"RTN","RGEX03",62,0)
ADDTMP ;
"RTN","RGEX03",63,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",64,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",65,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",66,0)
 Q
"RTN","RGEX03",67,0)
 ;
"RTN","RGEX03",68,0)
UPD ;
"RTN","RGEX03",69,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",70,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",71,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",72,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",73,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",74,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",75,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",76,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",77,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",78,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",79,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",80,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",81,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",82,0)
 . D INIT
"RTN","RGEX03",83,0)
 K DIR,DIRUT
"RTN","RGEX03",84,0)
 S VALMBCK="R"
"RTN","RGEX03",85,0)
 Q
"RTN","RGEX03",86,0)
PA ;Patient Audit
"RTN","RGEX03",87,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",88,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",89,0)
 K QFLG
"RTN","RGEX03",90,0)
PAQ Q
"RTN","RGEX03",91,0)
HI ;Hinq Inquiry
"RTN","RGEX03",92,0)
 S VALMBCK=""
"RTN","RGEX03",93,0)
 D HINQ^DG10
"RTN","RGEX03",94,0)
 D PAUSE^VALM1
"RTN","RGEX03",95,0)
 S VALMBCK="R"
"RTN","RGEX03",96,0)
 Q
"RTN","RGEX03",97,0)
DISP ; Display Only Query
"RTN","RGEX03",98,0)
 S VALMBCK=""
"RTN","RGEX03",99,0)
 D FULL^VALM1
"RTN","RGEX03",100,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",101,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",102,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",103,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",104,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",105,0)
 D PAUSE^VALM1
"RTN","RGEX03",106,0)
 S VALMBCK="R"
"RTN","RGEX03",107,0)
 K MPIVAR
"RTN","RGEX03",108,0)
 Q
"RTN","RGEX03",109,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",110,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",111,0)
 D FULL^VALM1
"RTN","RGEX03",112,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",113,0)
 D PAUSE^VALM1
"RTN","RGEX03",114,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",115,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",116,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",117,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",118,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",119,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",120,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",121,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",122,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",123,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",124,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",125,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",126,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",127,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",128,0)
 D INIT
"RTN","RGEX03",129,0)
 S VALMBCK="R"
"RTN","RGEX03",130,0)
 Q
"RTN","RGEX03",131,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",132,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",133,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",134,0)
 D FULL^VALM1
"RTN","RGEX03",135,0)
 D ELIG^VADPT
"RTN","RGEX03",136,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",137,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",138,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",139,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",140,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",141,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",142,0)
 .. S VALMBCK="R"
"RTN","RGEX03",143,0)
 . E  D SENS
"RTN","RGEX03",144,0)
 E  D SENS
"RTN","RGEX03",145,0)
 Q
"RTN","RGEX03",146,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",147,0)
 N RGSENS,SENSTV,DA,DR,DIC,DIQ
"RTN","RGEX03",148,0)
 S DIC=38.1,DR="2",DA=DFN,DIQ="RGSENS",DIQ(0)="I"
"RTN","RGEX03",149,0)
 D EN^DIQ1
"RTN","RGEX03",150,0)
 S SENSTV=$G(RGSENS(38.1,DFN,2,"I"))
"RTN","RGEX03",151,0)
 I SENSTV=1 D
"RTN","RGEX03",152,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","RGEX03",153,0)
 .. W !!,"PATIENT MARKED SENSITIVE."
"RTN","RGEX03",154,0)
 .. W !!,"You do not have the proper security to"
"RTN","RGEX03",155,0)
 .. W !,"edit this patient's data."
"RTN","RGEX03",156,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",157,0)
 .. S VALMBCK="R"
"RTN","RGEX03",158,0)
 . E  D EDIT
"RTN","RGEX03",159,0)
 E  D EDIT
"RTN","RGEX03",160,0)
 Q
"RTN","RGEX03",161,0)
EDIT ; edit patient data
"RTN","RGEX03",162,0)
 S ACCESS=0
"RTN","RGEX03",163,0)
 D REC
"RTN","RGEX03",164,0)
 Q:ACCESS=0
"RTN","RGEX03",165,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",166,0)
 S DR=".01//^S X=NAME;.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",167,0)
 L +^DPT(DFN):10
"RTN","RGEX03",168,0)
 D ^DIE
"RTN","RGEX03",169,0)
 L -^DPT(DFN)
"RTN","RGEX03",170,0)
 S DATAOLD=DATA
"RTN","RGEX03",171,0)
 D DEATH
"RTN","RGEX03",172,0)
 D DEM^VADPT
"RTN","RGEX03",173,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",174,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",175,0)
 D INIT
"RTN","RGEX03",176,0)
 S VALMBCK="R"
"RTN","RGEX03",177,0)
 K DIE,DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",178,0)
QUIT Q
"RTN","RGEX03",179,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",180,0)
 ; check for security key
"RTN","RGEX03",181,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",182,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",183,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",184,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",185,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",186,0)
 . D PAUSE^VALM1
"RTN","RGEX03",187,0)
 . S VALMBCK="R"
"RTN","RGEX03",188,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",189,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",190,0)
 . W !,"own medical record."
"RTN","RGEX03",191,0)
 . D PAUSE^VALM1
"RTN","RGEX03",192,0)
 . S VALMBCK="R"
"RTN","RGEX03",193,0)
 E  S ACCESS=1
"RTN","RGEX03",194,0)
 Q
"RTN","RGEX03",195,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",196,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",197,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",198,0)
 . S DOD=""
"RTN","RGEX03",199,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",200,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",201,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",202,0)
 . D ^DIE
"RTN","RGEX03",203,0)
 . L -^DPT(DFN)
"RTN","RGEX03",204,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",205,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",206,0)
 Q
"RTN","RGEX03",207,0)
INQ ; Patient Inquiry
"RTN","RGEX03",208,0)
 S VALMBCK=""
"RTN","RGEX03",209,0)
 D FULL^VALM1
"RTN","RGEX03",210,0)
 D EN^DGRPD
"RTN","RGEX03",211,0)
 D PAUSE^VALM1
"RTN","RGEX03",212,0)
 D CLEAN^VALM10
"RTN","RGEX03",213,0)
 D INIT
"RTN","RGEX03",214,0)
 S VALMBCK="R"
"RTN","RGEX03",215,0)
 Q
"RTN","RGEX03",216,0)
HELP ; -- help code
"RTN","RGEX03",217,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",218,0)
 Q
"RTN","RGEX03",219,0)
 ;
"RTN","RGEX03",220,0)
EXIT ; -- exit code
"RTN","RGEX03",221,0)
 S VALMBCK=""
"RTN","RGEX03",222,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",223,0)
 S VALMBCK="R"
"RTN","RGEX03",224,0)
 Q
"RTN","RGEX03",225,0)
 ;
"RTN","RGEX03",226,0)
EXPND ; -- expand code
"RTN","RGEX03",227,0)
 Q
"RTN","RGEX03",228,0)
 ;
"RTN","RGEXHND1")
0^4^B32891579
"RTN","RGEXHND1",1,0)
RGEXHND1 ;BAY/ALS-CIRN EXCEPTION HANDLING UTILITY ;10/08/99
"RTN","RGEXHND1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGEXHND1",3,0)
DTLIST ;List exceptions by date
"RTN","RGEXHND1",4,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",5,0)
 S EXCDT="",EXCTYP="",CNT=0
"RTN","RGEXHND1",6,0)
 F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEXHND1",7,0)
 . S IEN=0
"RTN","RGEXHND1",8,0)
 . F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEXHND1",9,0)
 .. S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",10,0)
 ... S IEN2=0
"RTN","RGEXHND1",11,0)
 ... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",12,0)
 .... S EXCTYP=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",3)
"RTN","RGEXHND1",13,0)
 .... I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D ADDREC
"RTN","RGEXHND1",14,0)
 K I,NUM,EXCDT,EXCTYP
"RTN","RGEXHND1",15,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",16,0)
 Q
"RTN","RGEXHND1",17,0)
NDATA ; There is no data matching the criteria
"RTN","RGEXHND1",18,0)
 S CNT=CNT+1,STRING=""
"RTN","RGEXHND1",19,0)
 S STRING=$$SETSTR^VALM1("There were no exceptions found.",STRING,5,35)
"RTN","RGEXHND1",20,0)
 S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",21,0)
 S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",22,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",23,0)
 Q
"RTN","RGEXHND1",24,0)
EXCLST ;List exceptions by type
"RTN","RGEXHND1",25,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",26,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",27,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",28,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",29,0)
 .. S IEN=0
"RTN","RGEXHND1",30,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",31,0)
 ... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",32,0)
 .... S IEN2=0
"RTN","RGEXHND1",33,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",34,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",35,0)
 ..... D ADDREC
"RTN","RGEXHND1",36,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",37,0)
 Q
"RTN","RGEXHND1",38,0)
PATLST ;List exceptions by patient
"RTN","RGEXHND1",39,0)
 K ^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEXHND1",40,0)
 S CNT=0,EXCDT="",EXCTYP="",NDX=0,NAME=""
"RTN","RGEXHND1",41,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",42,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",43,0)
 .. S DFN=""
"RTN","RGEXHND1",44,0)
 .. F  S DFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN)) Q:'DFN  D
"RTN","RGEXHND1",45,0)
 ... S IEN=0
"RTN","RGEXHND1",46,0)
 ... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEXHND1",47,0)
 .... S IEN2=0
"RTN","RGEXHND1",48,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",49,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",50,0)
 ..... D DEM^VADPT S NAME=VADM(1) Q:NAME=""
"RTN","RGEXHND1",51,0)
 ..... S NDX=NDX+1
"RTN","RGEXHND1",52,0)
 ..... S ^TMP("RGEX01",$J,NAME,NDX)=$G(VADM(1))_"^"_IEN_"^"_IEN2_"^"_EXCTYP_"^"_EXCDT
"RTN","RGEXHND1",53,0)
 D PATTMP
"RTN","RGEXHND1",54,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",55,0)
 K DFN
"RTN","RGEXHND1",56,0)
 Q
"RTN","RGEXHND1",57,0)
PATTMP ;
"RTN","RGEXHND1",58,0)
 S NM=""
"RTN","RGEXHND1",59,0)
 F  S NM=$O(^TMP("RGEX01",$J,NM)) Q:NM=""  D
"RTN","RGEXHND1",60,0)
 . S NDX=0
"RTN","RGEXHND1",61,0)
 . F  S NDX=$O(^TMP("RGEX01",$J,NM,NDX)) Q:'NDX  D
"RTN","RGEXHND1",62,0)
 .. S IEN=$P(^TMP("RGEX01",$J,NM,NDX),"^",2)
"RTN","RGEXHND1",63,0)
 .. S IEN2=$P(^TMP("RGEX01",$J,NM,NDX),"^",3)
"RTN","RGEXHND1",64,0)
 .. S EXCTYP=$P(^TMP("RGEX01",$J,NM,NDX),"^",4)
"RTN","RGEXHND1",65,0)
 .. S EXCDT=$P(^TMP("RGEX01",$J,NM,NDX),"^",5)
"RTN","RGEXHND1",66,0)
 .. D ADDREC
"RTN","RGEXHND1",67,0)
 K NDX,NM,NAME
"RTN","RGEXHND1",68,0)
 Q
"RTN","RGEXHND1",69,0)
SELTYP ; List all exceptions of type selected by user
"RTN","RGEXHND1",70,0)
 S EXCTYPE="",FLAG=0,ETYPE=""
"RTN","RGEXHND1",71,0)
 K DIR,Y,DIC
"RTN","RGEXHND1",72,0)
 S DIR("A")="Enter an exception type to view: "
"RTN","RGEXHND1",73,0)
 ;S DIR(0)="PM^991.11:QAM"
"RTN","RGEXHND1",74,0)
 S DIR(0)="SAM^209:Required field(s) DOB or Name Missing;213:SSN Match Failed;214:Name Doesn't Match;215:Death Entry on MPI not VISTA;216:Death Entry on Vista not MPI;217:Death Entries on MPI and Vista DON'T MATCH;218:Potential Matches Returned"
"RTN","RGEXHND1",75,0)
 S DIR("?")="^D HLPSEL^RGEXHND1"
"RTN","RGEXHND1",76,0)
 D ^DIR
"RTN","RGEXHND1",77,0)
 I Y<1 S RGSORT="SD" D SORT^RGEX01  Q
"RTN","RGEXHND1",78,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RGEXHND1",79,0)
 S EXCTYPE=+Y,ETYPE=$P(^RGHL7(991.11,EXCTYPE,10),"^",1)
"RTN","RGEXHND1",80,0)
 I EXCTYPE=(209)!((EXCTYPE>212)&(EXCTYPE<219)) S FLAG=1
"RTN","RGEXHND1",81,0)
 I FLAG=1 D ADDSEL
"RTN","RGEXHND1",82,0)
 E  I FLAG=0 D
"RTN","RGEXHND1",83,0)
 . W !,"Not a valid selection."
"RTN","RGEXHND1",84,0)
 . D SELTYP
"RTN","RGEXHND1",85,0)
 K FLAG,Y,DIR,DIC,DTOUT,DUOUT
"RTN","RGEXHND1",86,0)
 Q
"RTN","RGEXHND1",87,0)
ADDSEL ;
"RTN","RGEXHND1",88,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",89,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",90,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",91,0)
 . I EXCTYP=EXCTYPE D
"RTN","RGEXHND1",92,0)
 .. S IEN=0
"RTN","RGEXHND1",93,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",94,0)
 ... S IEN2=0
"RTN","RGEXHND1",95,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",96,0)
 .... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3)
"RTN","RGEXHND1",97,0)
 .... D ADDREC
"RTN","RGEXHND1",98,0)
 I CNT<1 D
"RTN","RGEXHND1",99,0)
 . W !,"There are no "_ETYPE
"RTN","RGEXHND1",100,0)
 . W !,"exceptions that need processing."
"RTN","RGEXHND1",101,0)
 . D SELTYP
"RTN","RGEXHND1",102,0)
 Q
"RTN","RGEXHND1",103,0)
HLPSEL ;
"RTN","RGEXHND1",104,0)
 D FULL^VALM1
"RTN","RGEXHND1",105,0)
 ;W !,"The following exception types are handled by this option:"
"RTN","RGEXHND1",106,0)
 ;W !!,"Required field(s) Date of Birth or Name missing",?50,"(209)"
"RTN","RGEXHND1",107,0)
 ;W !,"SSN Match Failed",?50,"(213)"
"RTN","RGEXHND1",108,0)
 ;W !,"Name Doesn't Match",?50,"(214)"
"RTN","RGEXHND1",109,0)
 ;W !,"Death Entry on MPI not in VISTA",?50,"(215)"
"RTN","RGEXHND1",110,0)
 ;W !,"Death Entry on Vista not in MPI",?50,"(216)"
"RTN","RGEXHND1",111,0)
 ;W !,"Death Entries on MPI and Vista DO NOT MATCH",?50,"(217)"
"RTN","RGEXHND1",112,0)
 ;W !,"Potential Matches Returned",?50,"(218)"
"RTN","RGEXHND1",113,0)
 S VALMBCK="R"
"RTN","RGEXHND1",114,0)
 Q
"RTN","RGEXHND1",115,0)
ADDREC ;
"RTN","RGEXHND1",116,0)
 S ETEXT="",RGDFN="",ICN="",RGNM="",STAT="",DOD=""
"RTN","RGEXHND1",117,0)
 S ETEXT=$P($G(^RGHL7(991.11,EXCTYP,10)),"^",1)
"RTN","RGEXHND1",118,0)
 S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEXHND1",119,0)
 S STAT=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",5)
"RTN","RGEXHND1",120,0)
 S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEXHND1",121,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEXHND1",122,0)
 I (STAT<1)!(STAT="") DO
"RTN","RGEXHND1",123,0)
 .;Only list exceptions that are Not Processed
"RTN","RGEXHND1",124,0)
 .; only list patients with local ICN
"RTN","RGEXHND1",125,0)
 . I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGEXHND1",126,0)
 .. S DFN=RGDFN D DEM^VADPT
"RTN","RGEXHND1",127,0)
 .. S RGNM=VADM(1)
"RTN","RGEXHND1",128,0)
 .. S RGSSN=$P($G(VADM(2)),"^",1)
"RTN","RGEXHND1",129,0)
 .. S DOB=$G(VADM(3))
"RTN","RGEXHND1",130,0)
 .. S DOD=$P($P($G(VADM(6)),"^",2),"@",1)
"RTN","RGEXHND1",131,0)
 .. S EXDATE=$P($$FMTE^XLFDT(EXCDT,2),"@",1)
"RTN","RGEXHND1",132,0)
 .. S CNT=CNT+1
"RTN","RGEXHND1",133,0)
 .. S STRING=""
"RTN","RGEXHND1",134,0)
 .. I ICN<0 S ICN=""
"RTN","RGEXHND1",135,0)
 .. S STRING=$$SETSTR^VALM1(CNT,STRING,1,4)
"RTN","RGEXHND1",136,0)
 .. S STRING=$$SETSTR^VALM1($E(RGNM,1,22),STRING,6,21)
"RTN","RGEXHND1",137,0)
 .. S STRING=$$SETSTR^VALM1(RGSSN,STRING,28,10)
"RTN","RGEXHND1",138,0)
 .. S STRING=$$SETSTR^VALM1(EXDATE,STRING,39,8)
"RTN","RGEXHND1",139,0)
 .. S STRING=$$SETSTR^VALM1(ETEXT,STRING,48,32)
"RTN","RGEXHND1",140,0)
 .. S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",141,0)
 .. S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",142,0)
 .. S ^TMP("RGEXC",$J,CNT,"DATA")=RGNM_"^"_RGSSN_"^"_$P($$FMTE^XLFDT(EXCDT),"@",1)_"^"_ETEXT_"^"_DFN_"^"_ICN_"^"_DOB_"^"_STAT_"^"_IEN_"^"_IEN2_"^"_CNT_"^"_DOD
"RTN","RGEXHND1",143,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",144,0)
 K RGDFN,RGNM,RGSSN,EXDATE,ETEXT,ICN,DOB,STAT,VADM,HOME,STRING,DOD
"RTN","RGEXHND1",145,0)
 Q
"RTN","RGEXHND1",146,0)
SELECT ;
"RTN","RGEXHND1",147,0)
 N VALMY
"RTN","RGEXHND1",148,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","RGEXHND1",149,0)
 I '$D(VALMY) Q
"RTN","RGEXHND1",150,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",151,0)
 S DATA="",CNT=""
"RTN","RGEXHND1",152,0)
 S CNT=$O(VALMY(0))
"RTN","RGEXHND1",153,0)
 S DATA=$G(^TMP("RGEXC",$J,CNT,"DATA"))
"RTN","RGEXHND1",154,0)
 I '$D(DATA) S CNT=0 Q
"RTN","RGEXHND1",155,0)
 D CLEAN^VALM10
"RTN","RGEXHND1",156,0)
 D EN^RGEX03(DATA)
"RTN","RGEXHND1",157,0)
 I RGSORT="VT" D
"RTN","RGEXHND1",158,0)
 . K @VALMAR
"RTN","RGEXHND1",159,0)
 . D ADDSEL
"RTN","RGEXHND1",160,0)
 E  I RGSORT'="VT" D SORT^RGEX01
"RTN","RGEXHND1",161,0)
 ;
"RTN","RGEXHND1",162,0)
 Q
"RTN","RGEXHND1",163,0)
QUIT ;
"RTN","RGHLLOG")
0^5^B11216793
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGHLLOG",3,0)
 ;=================================================================
"RTN","RGHLLOG",4,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",5,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",6,0)
 ;=================================================================
"RTN","RGHLLOG",7,0)
 ; Start time for run log
"RTN","RGHLLOG",8,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",9,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",10,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",11,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",12,0)
 ; Input: Required
"RTN","RGHLLOG",13,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",14,0)
 ;        Optional
"RTN","RGHLLOG",15,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",16,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",17,0)
 S U="^"
"RTN","RGHLLOG",18,0)
 K RGLOG
"RTN","RGHLLOG",19,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",20,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",21,0)
 Q
"RTN","RGHLLOG",22,0)
 ; Create a log entry
"RTN","RGHLLOG",23,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",24,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",25,0)
 S RGLOG=$O(^RGHL7(991.1,$C(1)),-1)+1
"RTN","RGHLLOG",26,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT S:$G(RGLOG(3))="" RGLOG(3)=$G(HLMTIEN)
"RTN","RGHLLOG",27,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",28,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",29,0)
 Q RGLOG
"RTN","RGHLLOG",30,0)
 ; Log time run completed
"RTN","RGHLLOG",31,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",32,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",33,0)
 ; Input: required
"RTN","RGHLLOG",34,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",35,0)
 ;
"RTN","RGHLLOG",36,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",37,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",38,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",39,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",40,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",41,0)
 Q
"RTN","RGHLLOG",42,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",43,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",44,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",45,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",46,0)
 Q
"RTN","RGHLLOG",47,0)
 ; Log an exception
"RTN","RGHLLOG",48,0)
EXC(RGEXC,RGERR,RGDFN) ;
"RTN","RGHLLOG",49,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",50,0)
 ;file (#991.1)
"RTN","RGHLLOG",51,0)
 ; Input: Required
"RTN","RGHLLOG",52,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",53,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",54,0)
 ;        Optional
"RTN","RGHLLOG",55,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",56,0)
 ;
"RTN","RGHLLOG",57,0)
 N RGI,RGZ
"RTN","RGHLLOG",58,0)
 S U="^"
"RTN","RGHLLOG",59,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",60,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",61,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",62,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",63,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",64,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",65,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",66,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",67,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",68,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",69,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(1)),-1)+1
"RTN","RGHLLOG",70,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",71,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",72,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",73,0)
 D ^DIC
"RTN","RGHLLOG",74,0)
 S DIE=DIC
"RTN","RGHLLOG",75,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",76,0)
 S STAT=0
"RTN","RGHLLOG",77,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",78,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",79,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",80,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$G(RGDFN)_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",81,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",82,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",83,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",84,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",85,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",86,0)
 ;handled through the CIRN Exception Handling option.
"RTN","RGHLLOG",87,0)
 Q:RGEXC=209!((RGEXC>212)&(RGEXC<219))
"RTN","RGHLLOG",88,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",89,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",90,0)
 S RGERR=$$EXC^RGHLEXC(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",91,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",92,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"CIRN Exception: "_$$EXC^RGHLEXC(RGEXC),"HL7 Msg#"_$G(RGLOG(3)))
"RTN","RGHLLOG",93,0)
 Q
"RTN","RGJCTS01")
0^12^B5462212
"RTN","RGJCTS01",1,0)
RGJCTS01 ;SLC/TS-SUBSCRIPTION CONTROL STARTUP UTILITY TO CMOR ;09/18/97
"RTN","RGJCTS01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGJCTS01",3,0)
 ;IMPROVED FOR CMOR COMMUNICATION TS
"RTN","RGJCTS01",4,0)
INSERT(ZZHLDPT) ; pass dfn
"RTN","RGJCTS01",5,0)
 S ZZRGEV="SCN_REQ"
"RTN","RGJCTS01",6,0)
 K ZZFMLK,ZZTOLK
"RTN","RGJCTS01",7,0)
 ;setup for event stub
"RTN","RGJCTS01",8,0)
 S ZZHLINST=+$$KSP^XUPARAM("INST") ;who are we
"RTN","RGJCTS01",9,0)
 D LINK^HLUTIL3(ZZHLINST,.ZZFMLK) S ZZFMLK=$O(ZZFMLK(0)) Q:ZZFMLK<1
"RTN","RGJCTS01",10,0)
 S $P(ZZSTUB,U,1)=ZZFMLK(ZZFMLK)
"RTN","RGJCTS01",11,0)
 I $E($P(ZZSTUB,U,1),1,2)'="VA" D
"RTN","RGJCTS01",12,0)
 . D START^RGHLLOG($G(HLMTIEN),"SCN_REQ",""),EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request from, "_$P($G(ZZSTUB),U,1)_".  This is not a CIRN site.",ZZHLDPT) D STOP^RGHLLOG(1) Q 
"RTN","RGJCTS01",13,0)
 S ZZTOST=$$GETVCCI^MPIF001(ZZHLDPT) ;who owns him
"RTN","RGJCTS01",14,0)
 ;fix TS change to IEN
"RTN","RGJCTS01",15,0)
 S ZZTOST=$$LKUP^XUAF4(ZZTOST)
"RTN","RGJCTS01",16,0)
 D LINK^HLUTIL3(ZZTOST,.ZZTOLK) S ZZTOLK=$O(ZZTOLK(0)) Q:ZZTOLK<1
"RTN","RGJCTS01",17,0)
 S $P(ZZSTUB,U,2)=ZZTOLK(ZZTOLK)
"RTN","RGJCTS01",18,0)
 I $E($P(ZZSTUB,U,2),1,2)'="VA" D
"RTN","RGJCTS01",19,0)
 . D START^RGHLLOG(HLMTIEN,"SCN_REQ",""),EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request to, "_$P($G(ZZSTUB),U,2)_".  This is not a CIRN site.",ZZHLDPT) D STOP^RGHLLOG(1) Q
"RTN","RGJCTS01",20,0)
 S ZZRGICN=$$GETICN^MPIF001(ZZHLDPT)
"RTN","RGJCTS01",21,0)
 S $P(ZZSTUB,U,3)=ZZRGICN
"RTN","RGJCTS01",22,0)
 S DIC="^DPT(",DIC(0)="NZ",X=ZZHLDPT D ^DIC Q:Y'>0  S ZZPNM=$P(Y,U,2)
"RTN","RGJCTS01",23,0)
 S $P(ZZSTUB,U,4)=ZZPNM
"RTN","RGJCTS01",24,0)
 S $P(ZZSTUB,U,5)=0
"RTN","RGJCTS01",25,0)
 Q:ZZFMLK(ZZFMLK)=ZZTOLK(ZZTOLK)
"RTN","RGJCTS01",26,0)
 D EN^RGEQ(ZZRGEV,ZZSTUB)
"RTN","RGJCTS01",27,0)
 K ZZHLINST,ZZRGEV,ZZFMLK,ZZTOLK,ZZSTUB,ZZTOST,ZZRGICN,ZZPNM,X,Y,DIC
"RTN","RGJCTS01",28,0)
 Q
"RTN","RGMTAUD")
0^11^B13511940
"RTN","RGMTAUD",1,0)
RGMTAUD ;BIR/CML-CIRN AUDIT FILE PRINT FOR A SPECIFIED PATIENT ;01/06/99
"RTN","RGMTAUD",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGMTAUD",3,0)
 S QFLG=1
"RTN","RGMTAUD",4,0)
BEGIN ;
"RTN","RGMTAUD",5,0)
 W !!,"This option prints information from the AUDIT file (#1.1) for a"
"RTN","RGMTAUD",6,0)
 W !,"selected patient and date range."
"RTN","RGMTAUD",7,0)
 W !!,"For the PATIENT file (#2) entry selected, the report prints the"
"RTN","RGMTAUD",8,0)
 W !,"patient name and RGDFN, date/time the field was edited, the user who"
"RTN","RGMTAUD",9,0)
 W !,"made the change, the field edited, the old value, and the new value."
"RTN","RGMTAUD",10,0)
ASK1 ;Ask for PATIENT
"RTN","RGMTAUD",11,0)
 W !
"RTN","RGMTAUD",12,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC G:Y<0 QUIT S RGDFN=+Y
"RTN","RGMTAUD",13,0)
 I '$O(^DIA(2,"B",RGDFN,0)) W !!,"This patient has no audit data available for any date." G ASK1
"RTN","RGMTAUD",14,0)
ASK2 ;Ask for Date Range
"RTN","RGMTAUD",15,0)
 I '$D(RGDFN)&($D(DFN)) S RGDFN=DFN
"RTN","RGMTAUD",16,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUD",17,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT
"RTN","RGMTAUD",18,0)
 S RGBDT=Y,DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTAUD",19,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUD",20,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("RGDFN")=""
"RTN","RGMTAUD",21,0)
 D EN^XUTMDEVQ("START^RGMTAUD","CIRN - Print AUDIT File Data for a Specific Patient",.ZTSAVE) I 'POP Q
"RTN","RGMTAUD",22,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUD",23,0)
 G QUIT
"RTN","RGMTAUD",24,0)
START ;
"RTN","RGMTAUD",25,0)
 K ^TMP("RGMTAUD",$J) S U="^"
"RTN","RGMTAUD",26,0)
 ;
"RTN","RGMTAUD",27,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUD",28,0)
 S STOP=RGEDT+1
"RTN","RGMTAUD",29,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUD",30,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUD",31,0)
 ..S ^TMP("RGMTAUD",$J,EDITDT,IEN)=""
"RTN","RGMTAUD",32,0)
PRT ;Print report
"RTN","RGMTAUD",33,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUD",34,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUD",35,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUD",36,0)
 D HDR
"RTN","RGMTAUD",37,0)
 I '$O(^TMP("RGMTAUD",$J,0)) W !!,"No audit data found in this date range for this patient." G QUIT
"RTN","RGMTAUD",38,0)
 S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUD",$J,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUD",39,0)
 .S IEN=0 F  S IEN=$O(^TMP("RGMTAUD",$J,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUD",40,0)
 ..S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUD",41,0)
 ..S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUD",42,0)
 ..K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUD",43,0)
 ..S FLD=$G(RGARR("LABEL"))  Q:FLD=""
"RTN","RGMTAUD",44,0)
 ..S USER=$P(IEN0,U,4)
"RTN","RGMTAUD",45,0)
 ..I 'USER S USER="UNKNOWN"
"RTN","RGMTAUD",46,0)
 ..I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUD",47,0)
 ..S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUD",48,0)
 ..S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUD",49,0)
 ..D:$Y+4>IOSL HDR Q:QFLG  W !!,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUD",50,0)
QUIT ;
"RTN","RGMTAUD",51,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUD",52,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",53,0)
 K ^TMP("RGMTAUD",$J)
"RTN","RGMTAUD",54,0)
 K %I,C,RGDFN,EDITDT,FLD,HDT,IEN,IEN0,JJ,LN,NEW,OLD,PG,PRGBDT,PRGEDT,PRTDT,QFLG,RGARR,RGBDT,RGEDT,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUD",55,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTAUD",56,0)
HDR ;HEADER
"RTN","RGMTAUD",57,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",58,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUD",59,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUD",60,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?72,"Page: ",PG
"RTN","RGMTAUD",61,0)
 W !,"Patient: ",$P(^DPT(RGDFN,0),U)," (DFN #",RGDFN,")"
"RTN","RGMTAUD",62,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUD",63,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By",!?20,"Old Value / New Value",!,LN
"RTN","RGMTAUD",64,0)
 Q
"RTN","RGP3PST")
0^9^B7840530
"RTN","RGP3PST",1,0)
RGP3PST ;BIR/PTD-RG*1*3 PATCH POST-INIT ROUTINE ;02/04/00
"RTN","RGP3PST",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGP3PST",3,0)
MG ;Change mail group for exception 228
"RTN","RGP3PST",4,0)
 N GROUP,DIC,DA,DIE,X,Y,DR,ENT
"RTN","RGP3PST",5,0)
 S DIC="^XMB(3.8,",DIC(0)="XQZ",X="MPIF EXCEPTIONS"
"RTN","RGP3PST",6,0)
 D ^DIC
"RTN","RGP3PST",7,0)
 Q:+Y<0
"RTN","RGP3PST",8,0)
 S GROUP=+Y
"RTN","RGP3PST",9,0)
 S DIC="^RGHL7(991.11,",DIC(0)="XQZ",X=228
"RTN","RGP3PST",10,0)
 D ^DIC
"RTN","RGP3PST",11,0)
 Q:+Y<0
"RTN","RGP3PST",12,0)
 L +^RGHL7(991.11,228):10
"RTN","RGP3PST",13,0)
 S DA=+Y,DIE="^RGHL7(991.11,",DR="6///^S X=GROUP"
"RTN","RGP3PST",14,0)
 D ^DIE
"RTN","RGP3PST",15,0)
 L -^RGHL7(991.11,228)
"RTN","RGP3PST",16,0)
ACT ;Change action for exception 211
"RTN","RGP3PST",17,0)
 S DIC="^RGHL7(991.11,",DIC(0)="XQZ",X=211
"RTN","RGP3PST",18,0)
 D ^DIC
"RTN","RGP3PST",19,0)
 Q:+Y<0
"RTN","RGP3PST",20,0)
 L +^RGHL7(991.11,211):10
"RTN","RGP3PST",21,0)
 S DA=+Y,DIE="^RGHL7(991.11,",DR="2///MAIL"
"RTN","RGP3PST",22,0)
 D ^DIE
"RTN","RGP3PST",23,0)
 L -^RGHL7(991.11,211)
"RTN","RGP3PST",24,0)
DEL ;Delete data in action and mail group fields
"RTN","RGP3PST",25,0)
 ;for exceptions 209, 213 - 218
"RTN","RGP3PST",26,0)
 F ENT=209,213:1:218 D
"RTN","RGP3PST",27,0)
 .S DIC="^RGHL7(991.11,",DIC(0)="XQZ",X=ENT
"RTN","RGP3PST",28,0)
 .D ^DIC
"RTN","RGP3PST",29,0)
 .Q:+Y<0
"RTN","RGP3PST",30,0)
 .L +^RGHL7(991.11,ENT):10
"RTN","RGP3PST",31,0)
 .S DA=+Y,DIE="^RGHL7(991.11,",DR="2///@;6///@"
"RTN","RGP3PST",32,0)
 .D ^DIE
"RTN","RGP3PST",33,0)
 .L -^RGHL7(991.11,ENT)
"RTN","RGP3PST",34,0)
 K DA,DIC,DIE,DR,ENT,GROUP,X,Y
"RTN","RGP3PST",35,0)
STAT ;Set EXCEPTION STATUS to 'PROCESSED' for all exceptions
"RTN","RGP3PST",36,0)
 ;that go to the MPIF EXCEPTIONS mail group
"RTN","RGP3PST",37,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGP3PST",38,0)
 S RGMG=$P($G(Y),"^",1) Q:RGMG<1
"RTN","RGP3PST",39,0)
 S IEN=0
"RTN","RGP3PST",40,0)
 F  S IEN=$O(^RGHL7(991.1,IEN)) Q:'IEN  D
"RTN","RGP3PST",41,0)
 . S IEN2=0,TYP="",MGRP=""
"RTN","RGP3PST",42,0)
 . F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGP3PST",43,0)
 .. S TYP=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",3) Q:'TYP
"RTN","RGP3PST",44,0)
 .. S MGRP=$P($G(^RGHL7(991.11,TYP,0)),"^",4) Q:MGRP=""
"RTN","RGP3PST",45,0)
 .. I MGRP=RGMG S $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)=1
"RTN","RGP3PST",46,0)
 K TYP,MGRP,RGMG,IEN,IEN2
"RTN","RGP3PST",47,0)
STAT2 ;Set STATUS to PROCESSED for exception types 209,213,214 and
"RTN","RGP3PST",48,0)
 ;218 if patient has national ICN
"RTN","RGP3PST",49,0)
 S EXCTYP=""
"RTN","RGP3PST",50,0)
 S HOME=$$SITE^VASITE()
"RTN","RGP3PST",51,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGP3PST",52,0)
 . I (EXCTYP=209)!(EXCTYP=213)!(EXCTYP=214)!(EXCTYP=218) D
"RTN","RGP3PST",53,0)
 .. S IEN=0
"RTN","RGP3PST",54,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGP3PST",55,0)
 ... S IEN2=0,ICN="",RGDFN=""
"RTN","RGP3PST",56,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGP3PST",57,0)
 .... S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGP3PST",58,0)
 .... S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGP3PST",59,0)
 .... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGP3PST",60,0)
 ..... L +^RGHL7(991.1,IEN)
"RTN","RGP3PST",61,0)
 ..... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGP3PST",62,0)
 ..... D ^DIE K DIE,DA,DR
"RTN","RGP3PST",63,0)
 ..... L -^RGHL7(991.1,IEN)
"RTN","RGP3PST",64,0)
 K EXCTYP,HOME,ICN,IEN,IEN2,RGDFN
"RTN","RGP3PST",65,0)
 Q
"RTN","RGP3PST",66,0)
INDX ;
"RTN","RGP3PST",67,0)
 K ^RGHL7(991.1,"ASTAT")
"RTN","RGP3PST",68,0)
 S IEN=0
"RTN","RGP3PST",69,0)
 F  S IEN=$O(^RGHL7(991.1,IEN)) Q:'IEN  D
"RTN","RGP3PST",70,0)
 . S IEN2=0,TYP=""
"RTN","RGP3PST",71,0)
 . F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGP3PST",72,0)
 .. S TYP=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",3) Q:'TYP
"RTN","RGP3PST",73,0)
 .. I TYP>199 D
"RTN","RGP3PST",74,0)
 ... S DA(1)=IEN,DA=IEN2,DIK(1)="6^ASTAT",DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGP3PST",75,0)
 ... D EN^DIK K DIK,DA
"RTN","RGP3PST",76,0)
 K TYP,IEN,IEN2
"RTN","RGP3PST",77,0)
 Q
"RTN","RGP3PST",78,0)
 ;
"RTN","RGRAS")
0^13^B9502958
"RTN","RGRAS",1,0)
RGRAS ;BIR/CML-CIRN PRE-SEEDING REPORT FOR TREATING FACILITY UPDATE ;04/06/00
"RTN","RGRAS",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3**;30 Apr 99
"RTN","RGRAS",3,0)
BEGIN ;
"RTN","RGRAS",4,0)
 W !!,"This report prints the following:"
"RTN","RGRAS",5,0)
 W !,"1. Total number of ""active"" patients (i.e., total number of patients with a"
"RTN","RGRAS",6,0)
 W !,"   local or national ICN (Integration Control Number))."
"RTN","RGRAS",7,0)
 W !,"2. Total number of patients who are shared with remote facilities."
"RTN","RGRAS",8,0)
 W !,"3. Total number of remote treating facility entries found for shared patients."
"RTN","RGRAS",9,0)
 ;W !,"   (Remember, patients can be shared with multiple facilities.)"
"RTN","RGRAS",10,0)
 W !!,"This information will be used to calculate the approximate number of HL7"
"RTN","RGRAS",11,0)
 W !,"messages that will be generated by the seeding process to update ""Last"
"RTN","RGRAS",12,0)
 W !,"Treatment Date"" for entries in the TREATING FACILITY LIST file (#391.91)."
"RTN","RGRAS",13,0)
 ;
"RTN","RGRAS",14,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGRAS",15,0)
 D EN^XUTMDEVQ("START^RGRAS","CIRN - Pre-Seeding Report for TF Update") I 'POP Q
"RTN","RGRAS",16,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGRAS",17,0)
 G QUIT
"RTN","RGRAS",18,0)
 ;
"RTN","RGRAS",19,0)
START ;
"RTN","RGRAS",20,0)
 S HOME=$$SITE^VASITE()   ;institution file ptr^station name^station number
"RTN","RGRAS",21,0)
 S LOCIEN=$P(HOME,"^"),LOCSITE=$P(HOME,"^",2)
"RTN","RGRAS",22,0)
 ;
"RTN","RGRAS",23,0)
LOOP ;Search ^DPT("AICN" for ICNs that are not in "history".
"RTN","RGRAS",24,0)
 ;For each found:
"RTN","RGRAS",25,0)
 ;-set ACTCNT = # of active patients (patients with a local or national ICN)
"RTN","RGRAS",26,0)
 ;  for each of these patients, determine if they are shared by checking ^DGCN(391.91,"APAT",DFN
"RTN","RGRAS",27,0)
 ;  for any entries that are not the local site.
"RTN","RGRAS",28,0)
 ;  - SPTCNT = # of shared patients (this number will be the number of msgs to go to the MPI)
"RTN","RGRAS",29,0)
 ;  - RTFCNT = # of remote TFs found (SPTCNT+RTFCNT = # of HL msgs to be generated)
"RTN","RGRAS",30,0)
 ;
"RTN","RGRAS",31,0)
 S (ACTCNT,SPTCNT,RTFCNT)=0
"RTN","RGRAS",32,0)
 ;
"RTN","RGRAS",33,0)
 S ICN=0 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGRAS",34,0)
 .S DFN=$O(^DPT("AICN",ICN,0)) S CURICN=$P($G(^DPT(DFN,"MPI")),"^") I ICN=CURICN D
"RTN","RGRAS",35,0)
 ..S ACTCNT=ACTCNT+1,SHARE=0
"RTN","RGRAS",36,0)
 ..I $E(IOST,1,2)="C-",'(ACTCNT#500) W "."
"RTN","RGRAS",37,0)
 ..S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","RGRAS",38,0)
 ...I TF'=LOCIEN S SHARE=1,RTFCNT=RTFCNT+1
"RTN","RGRAS",39,0)
 ..I SHARE S SPTCNT=SPTCNT+1
"RTN","RGRAS",40,0)
 S TOT=RTFCNT+SPTCNT
"RTN","RGRAS",41,0)
 ;
"RTN","RGRAS",42,0)
PRT ;Print report
"RTN","RGRAS",43,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12)),$P(LN,"-",81)=""
"RTN","RGRAS",44,0)
 ;
"RTN","RGRAS",45,0)
 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGRAS",46,0)
 W !,"Treating Facility Update Seeding Statistics"
"RTN","RGRAS",47,0)
 W !,"Printed at ",LOCSITE," on ",HDT,!,LN
"RTN","RGRAS",48,0)
 ;
"RTN","RGRAS",49,0)
 W !,"Total number of active patients with an ICN:",?70,$J(ACTCNT,7)
"RTN","RGRAS",50,0)
 W !!,"Total number of shared patients:",?60,$J(SPTCNT,7)
"RTN","RGRAS",51,0)
 W !,"  (# of messages to send to MPI)"
"RTN","RGRAS",52,0)
 W !,"Total number of remote Treating Facilities found:",?60,$J(RTFCNT,7)
"RTN","RGRAS",53,0)
 W !,"  (# of messages to send to remote sites)",?58,"---------"
"RTN","RGRAS",54,0)
 W !?11,"Approximate # of HL7 messages to be generated:",?58,$J(TOT,9)
"RTN","RGRAS",55,0)
 ;
"RTN","RGRAS",56,0)
QUIT ;
"RTN","RGRAS",57,0)
 I $E(IOST,1,2)="C-" S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGRAS",58,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGRAS",59,0)
 K %,%I,ACTCNT,CURICN,DFN,DIR,HDT,HOME,ICN,JJ,LN,LOCIEN,LOCSITE,RTFCNT,SHARE,SPTCNT,SS,TF,TOT,X,Y,ZTSK
"RTN","RGRAS",60,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGRAS",61,0)
 Q
"RTN","RGRSBUL1")
0^8^B28025389
"RTN","RGRSBUL1",1,0)
RGRSBUL1 ;ALB/RJS,CML-RGRSTEXT BULLTINE ROUTINE (PART 2) ;07/24/98
"RTN","RGRSBUL1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGRSBUL1",3,0)
SSNBULL(DFN,ARRAY,NAME,SSN,ICN,CMOR) ;
"RTN","RGRSBUL1",4,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",5,0)
 ;ISSUES mail group about an SSN change for a given patient.
"RTN","RGRSBUL1",6,0)
 ;
"RTN","RGRSBUL1",7,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",8,0)
 ;
"RTN","RGRSBUL1",9,0)
 ;   DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",10,0)
 ;  ARRAY  - Array of data containing sending sites station number
"RTN","RGRSBUL1",11,0)
 ;   NAME  - Patient's Name
"RTN","RGRSBUL1",12,0)
 ;   SSN   - Patient's SSN
"RTN","RGRSBUL1",13,0)
 ;   ICN   - Patient's ICN (Integration Control Number) 
"RTN","RGRSBUL1",14,0)
 ;   CMOR  - Patient's CMOR (CIRN Master of Record)
"RTN","RGRSBUL1",15,0)
 ;
"RTN","RGRSBUL1",16,0)
 Q:$G(DFN)=""!($G(ARRAY)="")
"RTN","RGRSBUL1",17,0)
 N LOCDATA,RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBUL1",18,0)
 S RGRSTEXT(1)="The CIRN Package has received an SSN change from:"
"RTN","RGRSBUL1",19,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",20,0)
 S RGRSTEXT(3)="           "
"RTN","RGRSBUL1",21,0)
 S RGRSTEXT(4)="This change has been made in your local data base for:"
"RTN","RGRSBUL1",22,0)
 S RGRSTEXT(5)=NAME
"RTN","RGRSBUL1",23,0)
 S RGRSTEXT(6)="           "
"RTN","RGRSBUL1",24,0)
 S RGRSTEXT(7)="=> Local "_$P($$SITE^VASITE(),"^",2)_" data PRIOR to update:"
"RTN","RGRSBUL1",25,0)
 S RGRSTEXT(8)="NAME: "_NAME
"RTN","RGRSBUL1",26,0)
 S RGRSTEXT(9)="SSN: "_SSN
"RTN","RGRSBUL1",27,0)
 S RGRSTEXT(10)="ICN: "_ICN
"RTN","RGRSBUL1",28,0)
 S RGRSTEXT(11)="CMOR: "_CMOR
"RTN","RGRSBUL1",29,0)
 S RGRSTEXT(12)="--------------------------------------------------------"
"RTN","RGRSBUL1",30,0)
 S RGRSTEXT(13)="=> Update received from "_$P($$INST(@ARRAY@("SENDING SITE"))," -->")_":"
"RTN","RGRSBUL1",31,0)
 S RGRSTEXT(14)="SSN: "_@ARRAY@("SSN")
"RTN","RGRSBUL1",32,0)
 D BULL2^RGRSBULL("CIRN SSN CHANGE - "_NAME,"RGRSTEXT(")
"RTN","RGRSBUL1",33,0)
 Q
"RTN","RGRSBUL1",34,0)
 ;
"RTN","RGRSBUL1",35,0)
NOT2(ARRAY) ;
"RTN","RGRSBUL1",36,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",37,0)
 ;ISSUES mail group about invalid subscription information for a given
"RTN","RGRSBUL1",38,0)
 ;patient.
"RTN","RGRSBUL1",39,0)
 ;
"RTN","RGRSBUL1",40,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",41,0)
 ;
"RTN","RGRSBUL1",42,0)
 ;  ARRAY  - Array of information regarding the invalid subscription
"RTN","RGRSBUL1",43,0)
 ;
"RTN","RGRSBUL1",44,0)
 Q:($G(ARRAY)="")
"RTN","RGRSBUL1",45,0)
 N RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBUL1",46,0)
 S RGRSTEXT(1)="The CIRN Package has received a message from:"
"RTN","RGRSBUL1",47,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",48,0)
 S RGRSTEXT(3)="This patient has your station as a subscriber, however"
"RTN","RGRSBUL1",49,0)
 S RGRSTEXT(4)="the patient was not found in your database."
"RTN","RGRSBUL1",50,0)
 S RGRSTEXT(5)="--------------------------------------------------------"
"RTN","RGRSBUL1",51,0)
 S RGRSTEXT(6)="Remote Data"
"RTN","RGRSBUL1",52,0)
 S RGRSTEXT(7)="           "
"RTN","RGRSBUL1",53,0)
 S INDEX=0,COUNTER=8
"RTN","RGRSBUL1",54,0)
 F  S INDEX=$O(@ARRAY@("MESSAGE",INDEX)) Q:INDEX']""  D
"RTN","RGRSBUL1",55,0)
 . S RGRSTEXT(COUNTER)=@ARRAY@("MESSAGE",INDEX)
"RTN","RGRSBUL1",56,0)
 . S COUNTER=COUNTER+1
"RTN","RGRSBUL1",57,0)
 D BULL2^RGRSBULL("CIRN - PATIENT NOT FOUND","RGRSTEXT(")
"RTN","RGRSBUL1",58,0)
 Q
"RTN","RGRSBUL1",59,0)
 ;
"RTN","RGRSBUL1",60,0)
SENSTIVE(DFN,ARRAY,NAME) ;FIRES WHEN PT. IS FLAGGED AS SENSITIVE AT ANOTHER SITE
"RTN","RGRSBUL1",61,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",62,0)
 ;ISSUES mail group when a given patient is flagged as sensitive at
"RTN","RGRSBUL1",63,0)
 ;another site.
"RTN","RGRSBUL1",64,0)
 ;
"RTN","RGRSBUL1",65,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",66,0)
 ;
"RTN","RGRSBUL1",67,0)
 ;   DFN  - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",68,0)
 ;  ARRAY - Array of data containing sending sites station number and SSN
"RTN","RGRSBUL1",69,0)
 ;  NAME  - Patient's name
"RTN","RGRSBUL1",70,0)
 ;
"RTN","RGRSBUL1",71,0)
 Q:($G(ARRAY)="")!($G(DFN)="")
"RTN","RGRSBUL1",72,0)
 N RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBUL1",73,0)
 S RGRSTEXT(1)="The CIRN Package has received a message from:"
"RTN","RGRSBUL1",74,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",75,0)
 S RGRSTEXT(3)="   "
"RTN","RGRSBUL1",76,0)
 S RGRSTEXT(4)="This message indicates that patient "_NAME_" is flagged"
"RTN","RGRSBUL1",77,0)
 S RGRSTEXT(5)="as Sensitive at the other facility but is not flagged as"
"RTN","RGRSBUL1",78,0)
 S RGRSTEXT(6)="Sensitive at your facility."
"RTN","RGRSBUL1",79,0)
 S RGRSTEXT(7)="  "
"RTN","RGRSBUL1",80,0)
 S RGRSTEXT(8)="Remote Patient SSN: "_$S(@ARRAY@("SSN")="":"Not Available",1:@ARRAY@("SSN"))
"RTN","RGRSBUL1",81,0)
 S RGRSTEXT(9)="Remote User who Flagged the Patient as Sensitive: "_@ARRAY@("SENSITIVITY USER")
"RTN","RGRSBUL1",82,0)
 S RGRSTEXT(10)="Date/Time Remote User Flagged Patient Sensitive:  "_$$FMTE^XLFDT(@ARRAY@("SENSITIVITY DATE"))
"RTN","RGRSBUL1",83,0)
 D BULL2^RGRSBULL("Remote Sensitivity Indicated","RGRSTEXT(")
"RTN","RGRSBUL1",84,0)
 Q
"RTN","RGRSBUL1",85,0)
 ;
"RTN","RGRSBUL1",86,0)
RMTDOD(DFN,ARRAY,NAME,RDOD,LDOD) ;Fires when patient has a Date of Death at another site
"RTN","RGRSBUL1",87,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",88,0)
 ;ISSUES mail group when a given patient has a Date of Death at
"RTN","RGRSBUL1",89,0)
 ;another site.
"RTN","RGRSBUL1",90,0)
 ;
"RTN","RGRSBUL1",91,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",92,0)
 ;
"RTN","RGRSBUL1",93,0)
 ;  DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",94,0)
 ;  ARRAY - Array of data containing sending sites station number and SSN
"RTN","RGRSBUL1",95,0)
 ;  NAME  - Patient's name
"RTN","RGRSBUL1",96,0)
 ;  RDOD  - Date of Death at remote site
"RTN","RGRSBUL1",97,0)
 ;  LDOD  - Date of Death at local site
"RTN","RGRSBUL1",98,0)
 ;
"RTN","RGRSBUL1",99,0)
 Q:($G(ARRAY)="")!($G(DFN)="")
"RTN","RGRSBUL1",100,0)
 Q:(RDOD=LDOD)  ;If remote DOD and local DOD same, QUIT
"RTN","RGRSBUL1",101,0)
 N RGRSTEXT
"RTN","RGRSBUL1",102,0)
 S RGRSTEXT(1)="The CIRN Package has received a message from:"
"RTN","RGRSBUL1",103,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",104,0)
 S RGRSTEXT(3)="   "
"RTN","RGRSBUL1",105,0)
 S RGRSTEXT(4)="This message indicates that patient "_NAME
"RTN","RGRSBUL1",106,0)
 I 'LDOD S RGRSTEXT(5)="has a date of death at the other facility but not at your facility." G RMTMSG
"RTN","RGRSBUL1",107,0)
 I LDOD,(LDOD'=RDOD) S RGRSTEXT(5)="has a different date of death at the other facility than at your facility."
"RTN","RGRSBUL1",108,0)
RMTMSG S RGRSTEXT(6)="  "
"RTN","RGRSBUL1",109,0)
 S RGRSTEXT(7)="Remote Patient SSN: "_$S(@ARRAY@("SSN")="":"Not Available",1:@ARRAY@("SSN"))
"RTN","RGRSBUL1",110,0)
 S RGRSTEXT(8)="Date of Death from other facility:  "_$$FMTE^XLFDT(RDOD)
"RTN","RGRSBUL1",111,0)
 I LDOD,(LDOD'=RDOD) S RGRSTEXT(9)="Date of Death at your facility:  "_$$FMTE^XLFDT(LDOD)
"RTN","RGRSBUL1",112,0)
 D BULL2^RGRSBULL("Remote Date of Death Indicated","RGRSTEXT(")
"RTN","RGRSBUL1",113,0)
 Q
"RTN","RGRSBUL1",114,0)
 ;
"RTN","RGRSBUL1",115,0)
INST(SITENUM) ;
"RTN","RGRSBUL1",116,0)
 N RETURN,IEN,DATA,NAME,NUMBER
"RTN","RGRSBUL1",117,0)
 S RETURN=""
"RTN","RGRSBUL1",118,0)
 Q:$G(SITENUM)="" RETURN
"RTN","RGRSBUL1",119,0)
 S IEN=$$LKUP^XUAF4(SITENUM)
"RTN","RGRSBUL1",120,0)
 I IEN>0 S DATA=$$NS^XUAF4(IEN)
"RTN","RGRSBUL1",121,0)
 I $G(DATA)]"" D 
"RTN","RGRSBUL1",122,0)
 . S NAME=$P(DATA,"^",1),NUMBER=$P(DATA,"^",2)
"RTN","RGRSBUL1",123,0)
 . S RETURN=NAME_" --> Site Number: "_NUMBER
"RTN","RGRSBUL1",124,0)
 Q RETURN
"RTN","RGRSBUL1",125,0)
 ;
"RTN","RGRSBUL1",126,0)
FORMAT(DATA1,DATA2) ;
"RTN","RGRSBUL1",127,0)
 N SPACES,SPACENUM,LENGTH1,LENGTH2,RETURN
"RTN","RGRSBUL1",128,0)
 S SPACES="                       "
"RTN","RGRSBUL1",129,0)
 S LENGTH1=$L(DATA1),LENGTH2=$L(DATA2)
"RTN","RGRSBUL1",130,0)
 I LENGTH1>23 S DATA1=$E(DATA1,1,23) S LENGTH1=23
"RTN","RGRSBUL1",131,0)
 I LENGTH2>22 S DATA2=$E(DATA2,1,22)
"RTN","RGRSBUL1",132,0)
 S SPACENUM=23-LENGTH1
"RTN","RGRSBUL1",133,0)
 S SPACES=$E(SPACES,1,SPACENUM)
"RTN","RGRSBUL1",134,0)
 S RETURN=DATA1_SPACES_" "_DATA2
"RTN","RGRSBUL1",135,0)
 Q $G(RETURN)
"RTN","RGRSBUL1",136,0)
 ;
"RTN","RGRSBUL1",137,0)
FREE(DATA) ;
"RTN","RGRSBUL1",138,0)
 Q:$G(DATA)="" ""
"RTN","RGRSBUL1",139,0)
 Q:$G(DATA)["@" ""
"RTN","RGRSBUL1",140,0)
 Q:$G(DATA)=HL("Q") ""
"RTN","RGRSBUL1",141,0)
 Q $G(DATA)
"RTN","RGRSDYN1")
0^10^B17028302
"RTN","RGRSDYN1",1,0)
RGRSDYN1 ;ALB/RJS-BUILD DYNAMIC LINK LIST FOR A TFU ;06/09/97
"RTN","RGRSDYN1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGRSDYN1",3,0)
EN(CLIENT,CLASS) ;
"RTN","RGRSDYN1",4,0)
 ;CLIENT=HL7 CLIENT PROTOCOL AT TARGET SYSTEM
"RTN","RGRSDYN1",5,0)
 ;DATA CLASS (Opt.) = Pull from Subs. Registry ONLY
"RTN","RGRSDYN1",6,0)
 ;For now, anything else is both DESCRIPTIVE AND CLINICAL
"RTN","RGRSDYN1",7,0)
 S CLASS=$G(CLASS),CLIENT=$G(CLIENT)
"RTN","RGRSDYN1",8,0)
 Q:CLIENT=""  ;No receiver
"RTN","RGRSDYN1",9,0)
 N PPF,DFN,HERE,RGRS,PPFIEN,ICN,MPI
"RTN","RGRSDYN1",10,0)
PARS ;Parse local outbound message
"RTN","RGRSDYN1",11,0)
 N RGDC
"RTN","RGRSDYN1",12,0)
 D INITIZE^RGRSUTIL,EN^RGRSPAR1("RGRS")
"RTN","RGRSDYN1",13,0)
 ;Get DFN
"RTN","RGRSDYN1",14,0)
 S ICN=$G(RGRS("ICN")) Q:$G(ICN)']""
"RTN","RGRSDYN1",15,0)
 S DFN=$$GETDFN^MPIF001(ICN) Q:+DFN'>0
"RTN","RGRSDYN1",16,0)
 Q:+$$SEND2^VAFCUTL1(DFN,"T")  ;don't broadcast test patients
"RTN","RGRSDYN1",17,0)
 Q:$$IFLOCAL^MPIF001(DFN)
"RTN","RGRSDYN1",18,0)
 S PPF=$$GETVCCI^MPIF001(DFN)\1 Q:+PPF'>0
"RTN","RGRSDYN1",19,0)
 S PPFIEN=$$LKUP^XUAF4(PPF)
"RTN","RGRSDYN1",20,0)
 ;Where we're at            Changed to 3rd piece CMC 5/9/98
"RTN","RGRSDYN1",21,0)
 S HERE=$P($$SITE^VASITE,"^",3)\1
"RTN","RGRSDYN1",22,0)
NOTPPF ; if not ppf send only to ppf
"RTN","RGRSDYN1",23,0)
 I PPF'=HERE D  Q
"RTN","RGRSDYN1",24,0)
 . N PPFLINK,INDEX
"RTN","RGRSDYN1",25,0)
 . D LINK^HLUTIL3(PPFIEN,.PPFLINK)
"RTN","RGRSDYN1",26,0)
 . S INDEX=$O(PPFLINK(0))
"RTN","RGRSDYN1",27,0)
 . I INDEX]"" S HLL("LINKS",1)=CLIENT_"^"_PPFLINK(INDEX)
"RTN","RGRSDYN1",28,0)
ISPPF ;
"RTN","RGRSDYN1",29,0)
 I PPF=HERE D  Q
"RTN","RGRSDYN1",30,0)
 . N PARENT,INDEX,SUBCONTL,CHILDREN,INDEX1,NODE
"RTN","RGRSDYN1",31,0)
 . S NODE=$$MPINODE^MPIFAPI(DFN)
"RTN","RGRSDYN1",32,0)
 . S SUBCONTL=$P($G(NODE),"^",5)
"RTN","RGRSDYN1",33,0)
 . ;Get subscribers, return updated HLL array
"RTN","RGRSDYN1",34,0)
 . ;replaced with GET line tag: I SUBCONTL]"" D GET^HLSUB(SUBCONTL,+CLASS,CLIENT,.HLL)
"RTN","RGRSDYN1",35,0)
 . D GET(DFN,SUBCONTL,+CLASS,CLIENT,.HLL)
"RTN","RGRSDYN1",36,0)
 . ;Get MPI link from SITE PARAMETER
"RTN","RGRSDYN1",37,0)
 . S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGRSDYN1",38,0)
 . . I $P($G(MPI),U)'=-1 S HLL("LINKS",9999999999)=CLIENT_"^"_MPI
"RTN","RGRSDYN1",39,0)
 . . I $P($G(MPI),U)=-1 D
"RTN","RGRSDYN1",40,0)
 . . . N RGLOG,RGMTXT
"RTN","RGRSDYN1",41,0)
 . . . S RGMTXT=" See Appendix F of the Clinical Information Resource Network Patient Demographics (CIRN-PD) and Master Patient Index (MPI) Installation and Implementation Guide."
"RTN","RGRSDYN1",42,0)
 . . . D START^RGHLLOG(HLMTIEN,"","") D EXC^RGHLLOG(224,"No MPI link identified in CIRN SITE PARAMETER file (#991.8)"_RGMTXT) D STOP^RGHLLOG(0)
"RTN","RGRSDYN1",43,0)
 ;
"RTN","RGRSDYN1",44,0)
GET(RGDFN,RGSCN,RGTP,RGCLP,RGLL) ;GET Subscribers
"RTN","RGRSDYN1",45,0)
 ;RGDFN - Patient IEN from FILE (#2)
"RTN","RGRSDYN1",46,0)
 ;RGSCN - Subcription Control Number
"RTN","RGRSDYN1",47,0)
 ;RGTP  - SUBSCRIBER TYPE (0,1,2)/Null=all
"RTN","RGRSDYN1",48,0)
 ;RGCLP - HL7 CLIENT PROTOCOL (required)
"RTN","RGRSDYN1",49,0)
 ;RGLL  - HLL("LINKS",x)=CLIENT PROTOCOL^LOGICAL LINK (passed by reference)
"RTN","RGRSDYN1",50,0)
 N RG,RGI,RGLLIEN,RGLLI,RGLLS,RGLLN,RGLLZ,RGTF,RGTFF,RGTFI,RGX,HLER
"RTN","RGRSDYN1",51,0)
 S U="^"
"RTN","RGRSDYN1",52,0)
 ;get subscribers
"RTN","RGRSDYN1",53,0)
 I RGSCN'="" D GET^HLSUB(RGSCN,RGTP,RGCLP,.RGLL)
"RTN","RGRSDYN1",54,0)
 ;check for a treating facility that is not a subscriber
"RTN","RGRSDYN1",55,0)
 S RGI=0 F  S RGI=$O(^DGCN(391.91,"B",RGDFN,RGI)) Q:'RGI  I $D(^DGCN(391.91,RGI,0)) S RGTF=$G(^DGCN(391.91,RGI,0)),RGTFI=$P(RGTF,U,2) D:RGTFI'=+$$SITE^VASITE
"RTN","RGRSDYN1",56,0)
 .;checking INSTITUTION of links to the TREATING FACILITY INSTITUTION
"RTN","RGRSDYN1",57,0)
 .;RGTFF=1 - Flag for adding Treating Facility to Subcription Control
"RTN","RGRSDYN1",58,0)
 .S RGTFF=1
"RTN","RGRSDYN1",59,0)
 .S RGX=0 F  S RGX=$O(RGLL("LINKS",RGX)) Q:'RGX!(RGTFF=0)  D
"RTN","RGRSDYN1",60,0)
 ..S RGLLIEN=$P(RGLL("LINKS",RGX),U,6)
"RTN","RGRSDYN1",61,0)
 ..I $G(RGLL)="" S RGLL("ERR",RGX)="No logical link defined for "_$P(RGLL("LINKS",RGX),U)_"." Q
"RTN","RGRSDYN1",62,0)
 ..S RGLLI=RGTFI,RGLLN=$P(RGLL("LINKS",RGX),U,2)
"RTN","RGRSDYN1",63,0)
 ..I '$L(RGLLI),'$D(RGLL("ERR",RGX)) S RGLL("ERR",RGX)="Link "_$P(RGLL("LINKS",RGX),U,2)_" does not contain a link to the INSTUTUTION (#4) file." Q
"RTN","RGRSDYN1",64,0)
 ..I $L(RGLLI) S:RGLLI'=RGTFI RGTFF=1 I RGLLI=RGTFI S RGTFF=0 Q
"RTN","RGRSDYN1",65,0)
 .;If TF not in Subscriber list, kill list, add to subscription control file then get new list 
"RTN","RGRSDYN1",66,0)
 .I RGTFF=1 D LINK^HLUTIL3("`"_RGTFI,.RG,"I") S RGLLI=$O(RG(0)) D
"RTN","RGRSDYN1",67,0)
 ..I +$G(RGLLI)>0 S RGLLN=$P(RG(RGLLI),U),RGLLI=RGTFI
"RTN","RGRSDYN1",68,0)
 ..I +$G(RGLLI)>0 S:RGSCN="" RGSCN=$$GETSCN^RGJCREC(RGDFN) D UPD^HLSUB(RGSCN,RGLLN,RGTP,$$NOW^XLFDT,,,.HLER) K RGLL("LINKS") D GET^HLSUB(RGSCN,RGTP,RGCLP,.RGLL)
"RTN","RGRSDYN1",69,0)
 ..I +$G(RGLLI)'>0 W !,"Unable to find Logical link for "_$$GET1^DIQ(4,+RGTFI_",",.01)
"RTN","RGRSDYN1",70,0)
 Q
"RTN","RGRSPT")
0^14^B17501276
"RTN","RGRSPT",1,0)
RGRSPT ;ALB/RJS,CML-HIGH LEVEL ROUTINE FOR PARSING AND FILING ;06/25/98
"RTN","RGRSPT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGRSPT",3,0)
 ;
"RTN","RGRSPT",4,0)
 ;Parse Incoming Message, and file.
"RTN","RGRSPT",5,0)
 ;
"RTN","RGRSPT",6,0)
 ;
"RTN","RGRSPT",7,0)
 Q:($G(HL("MTN"))'="ADT")
"RTN","RGRSPT",8,0)
 N RGRSDFN,VAFCA,RGRS,VAFCA08,RGRSARAY,BOGUS,RGDC,SENSTVTY,CMORDISP
"RTN","RGRSPT",9,0)
 N NAME,LASTNAME,SSN,ICN,CMOR,CMORIEN,OTHSITE,RGRSDATA,HERE,BULSUB,NODE
"RTN","RGRSPT",10,0)
 S RGRSARAY="RGRS(2)"
"RTN","RGRSPT",11,0)
 D INITIZE^RGRSUTIL ;copy HL7 message into local RGDC array
"RTN","RGRSPT",12,0)
 S VAFCA=$$EN^RGRSMSH() ;parse MSH for filer
"RTN","RGRSPT",13,0)
 D EN^RGRSPARS(RGRSARAY) ;parse HL7 message into local array RGRS
"RTN","RGRSPT",14,0)
 I $$SKIP^RGRSZZPT(1,RGRSARAY) D  G EXIT ;skip if certain data is not there
"RTN","RGRSPT",15,0)
 . D SKIPBULL^RGRSBULL(RGRSARAY)
"RTN","RGRSPT",16,0)
 S RGRSDFN=$$GETDFN^MPIF001(@RGRSARAY@(991.01)) ;Get DFN from ICN
"RTN","RGRSPT",17,0)
 Q:+$$SEND2^VAFCUTL1(RGRSDFN,"T")  ;safeguard to prevent the processing of test patients
"RTN","RGRSPT",18,0)
 S OTHSITE=@RGRSARAY@("SITENUM")\1
"RTN","RGRSPT",19,0)
 S HERE=$P($$SITE^VASITE,"^",3)\1
"RTN","RGRSPT",20,0)
 ;
"RTN","RGRSPT",21,0)
 ;If patient not known in site, send bulletin, go exit
"RTN","RGRSPT",22,0)
 ;
"RTN","RGRSPT",23,0)
 I +RGRSDFN=-1 M RGRS("MESSAGE")=RGDC D NOT2^RGRSBUL1(RGRSARAY) G EXIT
"RTN","RGRSPT",24,0)
 ;
"RTN","RGRSPT",25,0)
 S NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01)
"RTN","RGRSPT",26,0)
 S LASTNAME=$P(NAME,",",1)
"RTN","RGRSPT",27,0)
 S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09)
"RTN","RGRSPT",28,0)
 S NODE=$$MPINODE^MPIFAPI(RGRSDFN)
"RTN","RGRSPT",29,0)
 S ICN=$P(NODE,"^")
"RTN","RGRSPT",30,0)
 S CMORIEN=$P(NODE,"^",3)
"RTN","RGRSPT",31,0)
 S CMOR=$$NS^XUAF4(CMORIEN)
"RTN","RGRSPT",32,0)
 S CMORDISP=$P(CMOR,"^",1)
"RTN","RGRSPT",33,0)
 S CMOR=$P(CMOR,"^",2)
"RTN","RGRSPT",34,0)
 ;
"RTN","RGRSPT",35,0)
 S @RGRSARAY@("NAME")=@RGRSARAY@(.01)
"RTN","RGRSPT",36,0)
 S @RGRSARAY@("SSN")=@RGRSARAY@(.09)
"RTN","RGRSPT",37,0)
 S @RGRSARAY@("ICN")=@RGRSARAY@(991.01)
"RTN","RGRSPT",38,0)
 S @RGRSARAY@("CMOR")=$P($$NS^XUAF4($$LKUP^XUAF4(OTHSITE)),"^")
"RTN","RGRSPT",39,0)
 ;
"RTN","RGRSPT",40,0)
 ;If ICN or CMOR don't match, send bulletin and go exit
"RTN","RGRSPT",41,0)
 I '$$MATCH(RGRSDFN,RGRSARAY,,,ICN,CMOR,.BULSUB) D  G EXIT
"RTN","RGRSPT",42,0)
 . D MTCHBULL^RGRSBULL(RGRSDFN,RGRSARAY,NAME,SSN,ICN,CMORDISP,BULSUB)
"RTN","RGRSPT",43,0)
 ;
"RTN","RGRSPT",44,0)
 ;if ICN and CMOR match, check for SSN edit from CMOR
"RTN","RGRSPT",45,0)
 I @RGRSARAY@("SENDING SITE")=CMOR,(SSN'=@RGRSARAY@(.09)) D
"RTN","RGRSPT",46,0)
 .D SSNBULL^RGRSBUL1(RGRSDFN,RGRSARAY,NAME,SSN,ICN,CMORDISP)
"RTN","RGRSPT",47,0)
 ;
"RTN","RGRSPT",48,0)
 ;If patient is Sensitive at other site but not here send bulletin
"RTN","RGRSPT",49,0)
 S SENSTVTY=$G(@RGRSARAY@("SENSITIVITY"))
"RTN","RGRSPT",50,0)
 I '$$SENSTIVE^RGRSENS(RGRSDFN),SENSTVTY D SENSTIVE^RGRSBUL1(RGRSDFN,RGRSARAY,NAME)
"RTN","RGRSPT",51,0)
 ;
"RTN","RGRSPT",52,0)
 ;If patient has DATE OF DEATH (DOD) at remote site send bulletin
"RTN","RGRSPT",53,0)
 ;Ignore time if present with date.
"RTN","RGRSPT",54,0)
 S RMTDOD=@RGRSARAY@(.351),RMTDOD=$P(RMTDOD,".")
"RTN","RGRSPT",55,0)
 S DFN=RGRSDFN D DEM^VADPT
"RTN","RGRSPT",56,0)
 S LOCDOD=$P($P(VADM(6),"^"),".")
"RTN","RGRSPT",57,0)
 ;If there is a remote DOD but no local DOD  OR
"RTN","RGRSPT",58,0)
 ;if remote DOD is different from local DOD, send bulletin
"RTN","RGRSPT",59,0)
 I RMTDOD D RMTDOD^RGRSBUL1(RGRSDFN,RGRSARAY,NAME,RMTDOD,LOCDOD)
"RTN","RGRSPT",60,0)
 K LOCDOD,RMTDOD,VADM
"RTN","RGRSPT",61,0)
 ;
"RTN","RGRSPT",62,0)
 I '$$AUTO^RGJUSITE() D  G EXIT
"RTN","RGRSPT",63,0)
 . ;
"RTN","RGRSPT",64,0)
 . ;IF it's the CMOR - review file
"RTN","RGRSPT",65,0)
 . ;
"RTN","RGRSPT",66,0)
 . I (OTHSITE)=(HERE) D  Q
"RTN","RGRSPT",67,0)
 . . S VAFCA=VAFCA_"^"_RGRSDFN
"RTN","RGRSPT",68,0)
 . . S VAFCA08=1 S BOGUS=$$ADD^VAFCEHU1(VAFCA,"RGRS")
"RTN","RGRSPT",69,0)
 . ;
"RTN","RGRSPT",70,0)
 . ;IF it's not the CMOR - Don't Rebroadcast
"RTN","RGRSPT",71,0)
 . ;
"RTN","RGRSPT",72,0)
 . I (OTHSITE)'=(HERE) D  Q
"RTN","RGRSPT",73,0)
 . . S VAFCA08=1
"RTN","RGRSPT",74,0)
 . . D EDIT^VAFCPTED(RGRSDFN,RGRSARAY,".01;.03;.09;.02;.05;.08;.111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219;.2403;.31115")
"RTN","RGRSPT",75,0)
 ;
"RTN","RGRSPT",76,0)
 I $$AUTO^RGJUSITE() D  G EXIT
"RTN","RGRSPT",77,0)
 . ;
"RTN","RGRSPT",78,0)
 . ;IF it's the CMOR - rebroadcast
"RTN","RGRSPT",79,0)
 . ;
"RTN","RGRSPT",80,0)
 . I (OTHSITE)=(HERE) D  Q
"RTN","RGRSPT",81,0)
 . . D EDIT^VAFCPTED(RGRSDFN,RGRSARAY,".01;.03;.09;.02;.05;.08;.111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219;.2403;.31115")
"RTN","RGRSPT",82,0)
 . ;
"RTN","RGRSPT",83,0)
 . ;IF it's not the CMOR - Don't Rebroadcast
"RTN","RGRSPT",84,0)
 . ;
"RTN","RGRSPT",85,0)
 . I (OTHSITE)'=(HERE) D  Q
"RTN","RGRSPT",86,0)
 . . S VAFCA08=1
"RTN","RGRSPT",87,0)
 . . D EDIT^VAFCPTED(RGRSDFN,RGRSARAY,".01;.03;.09;.02;.05;.08;.111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219;.2403;.31115")
"RTN","RGRSPT",88,0)
EXIT ;
"RTN","RGRSPT",89,0)
 Q
"RTN","RGRSPT",90,0)
 ;
"RTN","RGRSPT",91,0)
MATCH(DFN,RGRSARAY,LASTNAME,SSN,ICN,CMOR,BULSUB) ;
"RTN","RGRSPT",92,0)
 Q:$G(DFN)=""!($G(RGRSARAY)="") 0
"RTN","RGRSPT",93,0)
 N COUNT,TRUE S (COUNT,TRUE)=0
"RTN","RGRSPT",94,0)
 S BULSUB=""
"RTN","RGRSPT",95,0)
 I $D(LASTNAME) D
"RTN","RGRSPT",96,0)
 . S COUNT=COUNT+1
"RTN","RGRSPT",97,0)
 . I (LASTNAME'=""),(LASTNAME=$P(@RGRSARAY@(.01),",",1)) S TRUE=TRUE+1
"RTN","RGRSPT",98,0)
 I $D(SSN) D
"RTN","RGRSPT",99,0)
 . S COUNT=COUNT+1
"RTN","RGRSPT",100,0)
 . I (SSN'=""),(SSN=$G(@RGRSARAY@(.09))) S TRUE=TRUE+1
"RTN","RGRSPT",101,0)
 I $D(ICN) D
"RTN","RGRSPT",102,0)
 . S COUNT=COUNT+1
"RTN","RGRSPT",103,0)
 . I (ICN'=""),(ICN=$G(@RGRSARAY@(991.01))) S TRUE=TRUE+1 Q
"RTN","RGRSPT",104,0)
 . S BULSUB=BULSUB_"ICN"
"RTN","RGRSPT",105,0)
 I $D(CMOR) D
"RTN","RGRSPT",106,0)
 . S COUNT=COUNT+1
"RTN","RGRSPT",107,0)
 . I (CMOR'=""),(CMOR=$G(@RGRSARAY@("SITENUM"))) S TRUE=TRUE+1 Q
"RTN","RGRSPT",108,0)
 . I BULSUB]"" S BULSUB=BULSUB_" & "
"RTN","RGRSPT",109,0)
 . S BULSUB=BULSUB_"CMOR"
"RTN","RGRSPT",110,0)
 I COUNT=TRUE Q 1
"RTN","RGRSPT",111,0)
 Q 0
"RTN","RGRSUTIL")
0^6^B7793556
"RTN","RGRSUTIL",1,0)
RGRSUTIL ;ALB/RJS-CIRN UTILITIES ;03/12/96
"RTN","RGRSUTIL",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3**;30 Apr 99
"RTN","RGRSUTIL",3,0)
EXCEPT ;This entry point identifies exception notifications
"RTN","RGRSUTIL",4,0)
 ;Check the mail group RG CIRN DEMOGRAPHIC ISSUES to see if 
"RTN","RGRSUTIL",5,0)
 ;this user should be notified.
"RTN","RGRSUTIL",6,0)
 S DIC="3.8",DIC(0)="Z",X="RG CIRN DEMOGRAPHIC ISSUES"
"RTN","RGRSUTIL",7,0)
 D ^DIC
"RTN","RGRSUTIL",8,0)
 S RGMG=$P($G(Y),"^",1) Q:RGMG<1
"RTN","RGRSUTIL",9,0)
 D GETS^DIQ(3.8,+RGMG_",","2*","I","RGAR") S RGNOTFY=0,RGX="" F  S RGX=$O(RGAR(3.81,RGX)) Q:RGX=""  I RGAR(3.81,RGX,.01,"I")=$G(DUZ) S RGNOTFY=1
"RTN","RGRSUTIL",10,0)
 ;identify existence of unresolved exceptions
"RTN","RGRSUTIL",11,0)
 I RGNOTFY=1 S RGNOTFY=$$CUREX^RGEX01()
"RTN","RGRSUTIL",12,0)
 I RGNOTFY=1 D SET^XUS1A("!Use the CIRN Exception Handling option on the Message Exception Menu to resolve exceptions.")
"RTN","RGRSUTIL",13,0)
 K RGTYPE,RGMG,RGNOTFY,RGAR,RGX,RGEX
"RTN","RGRSUTIL",14,0)
 Q
"RTN","RGRSUTIL",15,0)
SEG(SEGMENT,PIECE,CODE) ;Return segment from RGDC array and kill node
"RTN","RGRSUTIL",16,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",17,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",18,0)
 S RGNODE=0
"RTN","RGRSUTIL",19,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",20,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",21,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1 K RGDC(RGNODE)
"RTN","RGRSUTIL",22,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",23,0)
 Q ""
"RTN","RGRSUTIL",24,0)
SEG1(SEGMENT,PIECE,CODE) ;Return segment from RGDC array 
"RTN","RGRSUTIL",25,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",26,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",27,0)
 S RGNODE=0
"RTN","RGRSUTIL",28,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",29,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",30,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1
"RTN","RGRSUTIL",31,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",32,0)
 Q ""
"RTN","RGRSUTIL",33,0)
ERROR(CODE) ;**THIS ENTRY POINT IS NO LONGER USED**
"RTN","RGRSUTIL",34,0)
 Q ""
"RTN","RGRSUTIL",35,0)
INITIZE ;Initialize RGDC array with incoming message
"RTN","RGRSUTIL",36,0)
 N I,J,X
"RTN","RGRSUTIL",37,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  S RGDC(I)=HLNODE,J=0  F  S J=$O(HLNODE(J)) Q:'J  S RGDC(I,J)=HLNODE(J)
"RTN","RGRSUTIL",38,0)
 Q
"RTN","RGRSUTIL",39,0)
SSNDFN(SSN) ;Input ssn output DFN
"RTN","RGRSUTIL",40,0)
 N DFN
"RTN","RGRSUTIL",41,0)
 Q:$G(SSN)="" -1
"RTN","RGRSUTIL",42,0)
 S DFN=$O(^DPT("SSN",+SSN,0))
"RTN","RGRSUTIL",43,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",44,0)
 S DFN=$O(^DPT("SSN",SSN,0))
"RTN","RGRSUTIL",45,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",46,0)
 Q -1
"RTN","RGRSUTIL",47,0)
 ;
"RTN","RGRSUTIL",48,0)
LINE() ; Return a dashed line.       
"RTN","RGRSUTIL",49,0)
 Q $TR($J("",80)," ","-")
"RTN","RGRSUTIL",50,0)
 ;
"RTN","RGRSUTIL",51,0)
PAUSE() ; Pause for CRT output.
"RTN","RGRSUTIL",52,0)
 ;  Input:   IOST, IOSL
"RTN","RGRSUTIL",53,0)
 ;  Output:  0  --  Continue to display output
"RTN","RGRSUTIL",54,0)
 ;           1  --  Quit
"RTN","RGRSUTIL",55,0)
 Q:$E(IOST,1,2)'["C-" 0
"RTN","RGRSUTIL",56,0)
 N DIR,DIRUT,DTOUT,DUOUT,RGJ
"RTN","RGRSUTIL",57,0)
 F RGJ=$Y:1:(IOSL-4) W !
"RTN","RGRSUTIL",58,0)
 S DIR(0)="E" D ^DIR
"RTN","RGRSUTIL",59,0)
 Q $D(DIRUT)!($D(DUOUT))
"RTN","RGRSUTIL",60,0)
 ;
"RTN","RGRSUTIL",61,0)
DIAG(X) ; Return a string for diagnoses.
"RTN","RGRSUTIL",62,0)
 ;  Input:   X  -  Code for type of diagnosis (Primary, etc.)
"RTN","RGRSUTIL",63,0)
 ;  Output:  Descriptive string, i.e., "Primary", etc.
"RTN","RGRSUTIL",64,0)
 Q $S($G(X)="":"Unknown",X="A":"Additional",X="P":"Primary",X="S":"Secondary",X="T":"Tertiary",1:"Unknown")
"RTN","RGRSUTIL",65,0)
 ;
"RTN","RGRSUTIL",66,0)
ORD(X) ; Return a string for orders.
"RTN","RGRSUTIL",67,0)
 ;  Input:   X  -  Code for type of order (Lab, etc.)
"RTN","RGRSUTIL",68,0)
 ;  Output:  Descriptive string, i.e., "Lab", etc.
"RTN","RGRSUTIL",69,0)
 Q $S($G(X)="":"Unknown",X="L":"Lab",X="R":"Radiology",1:"Unknown")
"RTN","RGRSUTIL",70,0)
 ;
"RTN","RGRSUTIL",71,0)
UPDTFLD(FILE,FLD,ANS1,ANS2) ; Returns the correct field answer
"RTN","RGRSUTIL",72,0)
 ;DLR - Added to prevent the overwriting the last four in ZIP with null
"RTN","RGRSUTIL",73,0)
 ; input:  FILE  - file number (ex. 2 PATIENT)
"RTN","RGRSUTIL",74,0)
 ;         FLD  -  field number (ex. .1112 ZIP+4)
"RTN","RGRSUTIL",75,0)
 ;         ANS1 -  existing field value
"RTN","RGRSUTIL",76,0)
 ;         ANS2 -  incoming value
"RTN","RGRSUTIL",77,0)
 I (FILE=2)&(FLD=.1112) I $E(ANS1,1,5)=$E(ANS2,1,5),($L(ANS2)=5) Q ANS1
"RTN","RGRSUTIL",78,0)
 Q ANS2
"RTN","RGRSUTIL",79,0)
 ;
"RTN","RGRSUTIL",80,0)
SSNINT(SSN) ;
"RTN","RGRSUTIL",81,0)
 Q:$G(SSN)="" ""
"RTN","RGRSUTIL",82,0)
 Q $TRANSLATE(SSN,"-","")
"UP",991.1,991.12,-1)
991.1^1
"UP",991.1,991.12,0)
991.12
"VER")
8.0^22.0
"^DD",991.1,991.12,6,0)
EXCEPTION STATUS^S^0:NOT PROCESSED;1:PROCESSED;^0;5^Q
"^DD",991.1,991.12,6,1,0)
^.1
"^DD",991.1,991.12,6,1,1,0)
991.1^ASTAT^MUMPS
"^DD",991.1,991.12,6,1,1,1)
N T S T=$P($G(^RGHL7(991.1,DA(1),1,DA,0)),U,3) I T]"" S ^RGHL7(991.1,"ASTAT",X,T,DA(1),DA)=""
"^DD",991.1,991.12,6,1,1,2)
N T S T=$P($G(^RGHL7(991.1,DA(1),1,DA,0)),U,3) I T]"" K ^RGHL7(991.1,"ASTAT",X,T,DA(1),DA)
"^DD",991.1,991.12,6,1,1,3)
DO NOT DELETE
"^DD",991.1,991.12,6,1,1,"%D",0)
^^9^9^3000217^^^
"^DD",991.1,991.12,6,1,1,"%D",1,0)
This cross-reference is used to sort entries in the CIRN HL7 
"^DD",991.1,991.12,6,1,1,"%D",2,0)
EXCEPTION LOG file (#991.1) by EXCEPTION STATUS (#6) and 
"^DD",991.1,991.12,6,1,1,"%D",3,0)
TYPE (#2).
"^DD",991.1,991.12,6,1,1,"%D",4,0)
 
"^DD",991.1,991.12,6,1,1,"%D",5,0)
Set Logic:
"^DD",991.1,991.12,6,1,1,"%D",6,0)
S ^RGHL7(991.1,"ASTAT",(#6) EXCEPTION STATUS,(#2) TYPE,DA(1),DA)=""
"^DD",991.1,991.12,6,1,1,"%D",7,0)
 
"^DD",991.1,991.12,6,1,1,"%D",8,0)
Kill Logic:
"^DD",991.1,991.12,6,1,1,"%D",9,0)
K ^RGHL7(991.1,"ASTAT",(#6) EXCEPTION STATUS,(#2) TYPE,DA(1),DA)
"^DD",991.1,991.12,6,1,1,"DT")
3000217
"^DD",991.1,991.12,6,3)
The status for this exception message.  NOT PROCESSED indicates that user intervention is necessary.  Change the status to PROCESSED after confirming that the patient data is correct.
"^DD",991.1,991.12,6,21,0)
^^4^4^2991028^^
"^DD",991.1,991.12,6,21,1,0)
This is the exception status for this message.  A status of NOT
"^DD",991.1,991.12,6,21,2,0)
PROCESSED indicates that user intervention is necessary.  The 
"^DD",991.1,991.12,6,21,3,0)
status should be changed to PROCESSED after confirming that the 
"^DD",991.1,991.12,6,21,4,0)
patient data is correct.
"^DD",991.1,991.12,6,"DT")
3000217
"^DD",991.1,991.12,10,0)
TEXT^F^^10;E1,250^K:$L(X)>250!($L(X)<1) X
"^DD",991.1,991.12,10,3)
Supplemental text for exception.
"^DD",991.1,991.12,10,21,0)
^.001^1^1^3000417^^^^
"^DD",991.1,991.12,10,21,1,0)
This is a free text field used for supplemental text for the exception.
"^DD",991.1,991.12,10,"DT")
3000405
"^DD",991.8,991.8,40,0)
EXC PURGE START DATE/TIME^D^^EXCPRG;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,40,3)
Date and time CIRN Exception Purge last started.
"^DD",991.8,991.8,40,21,0)
^^2^2^3000315^
"^DD",991.8,991.8,40,21,1,0)
This field contains the date and time the CIRN Exception Purge was last
"^DD",991.8,991.8,40,21,2,0)
started.
"^DD",991.8,991.8,40,"DT")
3000315
"^DD",991.8,991.8,41,0)
EXC PURGE STOP DATE/TIME^D^^EXCPRG;2^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,41,3)
Date and time CIRN Exception Purge last stopped.
"^DD",991.8,991.8,41,21,0)
^^2^2^3000315^^
"^DD",991.8,991.8,41,21,1,0)
This field contains the date and time the CIRN Exception Purge last
"^DD",991.8,991.8,41,21,2,0)
completed.
"^DD",991.8,991.8,41,"DT")
3000315
"^DD",991.8,991.8,42,0)
EXC PURGE STATUS^S^R:RUNNING;C:COMPLETE;^EXCPRG;3^Q
"^DD",991.8,991.8,42,3)
This field contains the current status of the CIRN Exception Purge process.
"^DD",991.8,991.8,42,21,0)
^^2^2^3000315^
"^DD",991.8,991.8,42,21,1,0)
This field contains the current status of the CIRN Exception Purge
"^DD",991.8,991.8,42,21,2,0)
process.
"^DD",991.8,991.8,42,"DT")
3000315
**END**
**END**
