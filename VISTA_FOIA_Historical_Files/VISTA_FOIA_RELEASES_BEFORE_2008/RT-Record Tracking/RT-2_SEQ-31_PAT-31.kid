Released RT*2*31 SEQ #31
Extracted from mail message
**KIDS**:RT*2.0*31^

**INSTALL NAME**
RT*2.0*31
"BLD",903,0)
RT*2.0*31^RECORD TRACKING^0^3030117^y
"BLD",903,1,0)
^^2^2^3030116^
"BLD",903,1,1,0)
This patch fixes problems related to trace movement history
"BLD",903,1,2,0)
and new volumes.
"BLD",903,4,0)
^9.64PA^^
"BLD",903,"ABNS",0)
^9.66A^^
"BLD",903,"ABPKG")
^n
"BLD",903,"KRN",0)
^9.67PA^19^18
"BLD",903,"KRN",.4,0)
.4
"BLD",903,"KRN",.401,0)
.401
"BLD",903,"KRN",.402,0)
.402
"BLD",903,"KRN",.403,0)
.403
"BLD",903,"KRN",.5,0)
.5
"BLD",903,"KRN",.84,0)
.84
"BLD",903,"KRN",3.6,0)
3.6
"BLD",903,"KRN",3.8,0)
3.8
"BLD",903,"KRN",9.2,0)
9.2
"BLD",903,"KRN",9.8,0)
9.8
"BLD",903,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",903,"KRN",9.8,"NM",1,0)
RTNQ1^^0^B15209239
"BLD",903,"KRN",9.8,"NM",2,0)
RTDPA1^^0^B17931805
"BLD",903,"KRN",9.8,"NM",3,0)
RTT12^^0^B6911467
"BLD",903,"KRN",9.8,"NM","B","RTDPA1",2)

"BLD",903,"KRN",9.8,"NM","B","RTNQ1",1)

"BLD",903,"KRN",9.8,"NM","B","RTT12",3)

"BLD",903,"KRN",19,0)
19
"BLD",903,"KRN",19.1,0)
19.1
"BLD",903,"KRN",101,0)
101
"BLD",903,"KRN",409.61,0)
409.61
"BLD",903,"KRN",771,0)
771
"BLD",903,"KRN",869.2,0)
869.2
"BLD",903,"KRN",870,0)
870
"BLD",903,"KRN",8994,0)
8994
"BLD",903,"KRN","B",.4,.4)

"BLD",903,"KRN","B",.401,.401)

"BLD",903,"KRN","B",.402,.402)

"BLD",903,"KRN","B",.403,.403)

"BLD",903,"KRN","B",.5,.5)

"BLD",903,"KRN","B",.84,.84)

"BLD",903,"KRN","B",3.6,3.6)

"BLD",903,"KRN","B",3.8,3.8)

"BLD",903,"KRN","B",9.2,9.2)

"BLD",903,"KRN","B",9.8,9.8)

"BLD",903,"KRN","B",19,19)

"BLD",903,"KRN","B",19.1,19.1)

"BLD",903,"KRN","B",101,101)

"BLD",903,"KRN","B",409.61,409.61)

"BLD",903,"KRN","B",771,771)

"BLD",903,"KRN","B",869.2,869.2)

"BLD",903,"KRN","B",870,870)

"BLD",903,"KRN","B",8994,8994)

"BLD",903,"QUES",0)
^9.62^^
"BLD",903,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",72,-1)
1^1
"PKG",72,0)
RECORD TRACKING^RT^Medical Records and Film Jacket Tracking
"PKG",72,20,0)
^9.402P^^
"PKG",72,22,0)
^9.49I^1^1
"PKG",72,22,1,0)
2.0^2911022
"PKG",72,22,1,"PAH",1,0)
31^3030117^100850
"PKG",72,22,1,"PAH",1,1,0)
^^2^2^3030117
"PKG",72,22,1,"PAH",1,1,1,0)
This patch fixes problems related to trace movement history
"PKG",72,22,1,"PAH",1,1,2,0)
and new volumes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RTDPA1")
0^2^B17931805
"RTN","RTDPA1",1,0)
RTDPA1 ;TROY ISC/MJK,PKE-Record Label Creation ; 1/16/03 2:32pm
"RTN","RTDPA1",2,0)
 ;;2.0;Record Tracking;**25,31**;10/22/91 
"RTN","RTDPA1",3,0)
 I '$D(RTAPL) D APL2^RTPSET D NEXT:$D(RTAPL) K RTAPL,RTSYS Q
"RTN","RTDPA1",4,0)
 ;
"RTN","RTDPA1",5,0)
NEXT S RTA=+RTAPL D ASK^RTB K RTA G Q:$D(RTESC),NEXT:Y<0 S RTE=X
"RTN","RTDPA1",6,0)
 S RTDC("S")="I $P(^(0),U,4)=+RTAPL,$S('$D(RTTY):1,$P(^RT(+Y,0),U,3)=+RTTY:1,1:0)",RTSEL="S",RTSEL("A")="Select Label" D ^RTUTL2 K RTSEL
"RTN","RTDPA1",7,0)
 I $D(RTY) S RTION=$S('$D(RTFR):"",1:$P(RTFR,"^",4)) F RTI=0:0 S RTI=$O(RTY(RTI)) Q:'RTI  S RT=+RTY(RTI) D REC^RTL1
"RTN","RTDPA1",8,0)
 I $D(RTY) D Q G NEXT
"RTN","RTDPA1",9,0)
 D ASK I '$D(RTESC) D Q G NEXT
"RTN","RTDPA1",10,0)
Q K RT,RTI,RTY,RTC,RT1,RTBCIFN,RTDC,RTE,RTESC,RTION
"RTN","RTDPA1",11,0)
 K RTRANEW,%YV,DIC1,DIY,DIYS,N,POP
"RTN","RTDPA1",12,0)
 K Y,Y2,X,X1,DIE,DIC,DA Q
"RTN","RTDPA1",13,0)
ASK S RTESC="",RTRD(1)="Yes^create a new record or volume",RTRD(2)="No^do not create any new records",RTRD("B")=2,RTRD(0)="S",RTRD("A")="Do you wish to create a new record or volume? " D SET^RTRD K RTRD I $E(X)="^" S RTESC="" Q
"RTN","RTDPA1",14,0)
 I $E(X)="Y" S RTSHOW="" D TYPE1:$D(RTTY),TYPE:'$D(RTTY) K RTSHOW
"RTN","RTDPA1",15,0)
 Q
"RTN","RTDPA1",16,0)
 ;
"RTN","RTDPA1",17,0)
TYPE K RTESC W ! S DIC="^DIC(195.2,",DIC("S")="I $P(^(0),U,3)=+RTAPL,$S('$D(^(""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)",DIC("A")="Select NEW Record Type: ",DIC(0)="IAEMQ" D ^DIC K DIC S:X="^" RTESC="" Q:Y<0  D TYPE1^RTUTL S RTKILL=""
"RTN","RTDPA1",18,0)
TYPE1 D CREATE S RTTY1=+RTTY F RTTY2=0:0 S RTTY2=$O(^DIC(195.2,RTTY1,"LINKED","B",RTTY2)) Q:'RTTY2  I $D(^DIC(195.2,RTTY2,0)),'$D(^RT("AT",RTTY2,RTE)) S Y=RTTY2 D TYPE1^RTUTL,CREATE
"RTN","RTDPA1",19,0)
 S Y=RTTY1 K RTTY,RTTY1,RTTY2 D:'$D(RTKILL) TYPE1^RTUTL K RTKILL Q
"RTN","RTDPA1",20,0)
 ;
"RTN","RTDPA1",21,0)
CREATE ;Entry pt. with RTAPL, RTE and RTTY set
"RTN","RTDPA1",22,0)
 F I=0:0 S I=$O(^RT("AA",+RTAPL,RTE,I)) Q:'I  I $D(^RT(I,0)),+$P(^(0),"^",3)=+RTTY Q
"RTN","RTDPA1",23,0)
 I I Q:$D(RTBKGRD)
"RTN","RTDPA1",24,0)
 I I W !!?3,*7,$P(RTAPL,"^",9)," already has a '",$P(^DIC(195.2,+RTTY,0),"^"),"' record (#",I,") Vol: ",+$P(^RT(I,0),"^",7),"." I $P(^DIC(195.2,+RTTY,0),"^",17)'="y" W !?3,"[Multiple volumes are NOT allowed for this record type.]" Q
"RTN","RTDPA1",25,0)
 I I D NEW^RTT1 Q
"RTN","RTDPA1",26,0)
 S RTVOL=1,RTPAR="" D SET K RTVOL,RTPAR Q
"RTN","RTDPA1",27,0)
 ;
"RTN","RTDPA1",28,0)
SET ;Entry pt. with RTAPL, RTE, RTTY, RTVOL, and RTPAR defined; RTDIV optional
"RTN","RTDPA1",29,0)
 S X=$S($D(RTDIV):+RTDIV,1:"") I 'X S X=+$O(^DIC(195.1,+RTAPL,"INST",0)),X=$S('$O(^(X)):X,1:"")
"RTN","RTDPA1",30,0)
 S RTINIT="" I $D(^DIC(195.1,"AB",+RTTY,+RTAPL,+X)),$D(^DIC(195.1,+RTAPL,"INST",+X,"TYPE",+$O(^(+X,0)),0)) S RTINIT=^(0)
"RTN","RTDPA1",31,0)
 D NOW^%DTC S RTNOW=%,I=$P(^RT(0),"^",3) K %
"RTN","RTDPA1",32,0)
 ;D:$D(XRTL) T0^%ZOSV ; monitor record creation et, non-inter = 'rtshow
"RTN","RTDPA1",33,0)
 I '$D(RTSHOW),$D(XRTL) D T0^%ZOSV
"RTN","RTDPA1",34,0)
LOCK S I=I+1 S:$L(I)=4 I=10000 L +^RT(I):1 I '$T!$D(^RT(I)) L -^RT(I) G LOCK
"RTN","RTDPA1",35,0)
 S ^RT(I,0)=RTE_"^"_+^DIC(195.4,1,"SITE"),^RT("B",RTE,I)="",^(0)=$P(^RT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)'[0:DUZ,1:0),"^RT(")=I S:$P(RTE,";",2)="DPT(" ^RT(I,0)=^RT(I,0)_"^^^^^^^"_+RTE,^RT("C",+RTE,I)="" L -^RT(I)
"RTN","RTDPA1",36,0)
 ;
"RTN","RTDPA1",37,0)
 S (RT,DA)=I,DIE="^RT(",DR="[RT NEW RECORD]",DIE("NO^")="BACK"
"RTN","RTDPA1",38,0)
 D ^DIE K DQ,DE,RTINIT,RTNOW D MOVE^RTUTL1:'$D(Y)
"RTN","RTDPA1",39,0)
 ;S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; end et, non-inter
"RTN","RTDPA1",40,0)
 I '$D(RTSHOW),$D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","RTDPA1",41,0)
 W:'$D(RTBKGRD) !?3,"...'",$E($P(^DIC(195.2,+RTTY,0),"^"),1,22),?30,"   VOL: ",RTVOL,"' created (#",RT,")"
"RTN","RTDPA1",42,0)
 ;
"RTN","RTDPA1",43,0)
MOR I '$D(RTSHOW),'$D(RTADM) Q
"RTN","RTDPA1",44,0)
 N RTERROR
"RTN","RTDPA1",45,0)
MOR1 S X=$S($D(RTFR):$P(RTFR,"^",4),1:""),RTERROR=0
"RTN","RTDPA1",46,0)
 I $S(X']"":1,'$D(^%ZIS(1,"B",X)):1,'$D(^%ZIS(1,+$O(^(X,0)),0)):1,1:0) D  Q:POP  I RTERROR G MOR1
"RTN","RTDPA1",47,0)
 . S %ZIS("A")="Select Barcode Printer: ",%ZIS="QN" D ^%ZIS K %ZIS,IO("Q") Q:POP
"RTN","RTDPA1",48,0)
 . S X=ION
"RTN","RTDPA1",49,0)
 . S RTA=$O(^%ZIS(1,"B",ION,0)) I ^%ZIS(1,RTA,"TYPE")="VTRM" D ER^RTL1 S RTERROR=1
"RTN","RTDPA1",50,0)
 S RTION=X D REC^RTL1 K RTION Q
"RTN","RTDPA1",51,0)
 Q
"RTN","RTDPA1",52,0)
TRAN ;creat record transfered in
"RTN","RTDPA1",53,0)
 S RTRANEW="",RTA=+RTAPL D ASK^RTB K RTA G Q:$D(RTESC),TRAN:Y<0 S RTE=X
"RTN","RTDPA1",54,0)
 D ASK I '$D(RTESC) D Q G TRAN
"RTN","RTNQ1")
0^1^B15209239
"RTN","RTNQ1",1,0)
RTNQ1 ;TROY ISC/MJK-Record Trace Routine ; 5/8/87  8:43 AM ; 1/17/03 9:23am
"RTN","RTNQ1",2,0)
 ;;2.0;Record Tracking;**31**;10/22/91 
"RTN","RTNQ1",3,0)
 I '$D(RTAPL) D APL2^RTPSET D NEXT:$D(RTAPL) K RTAPL,RTSYS Q
"RTN","RTNQ1",4,0)
NEXT S RTA=+RTAPL D ASK^RTB K RTA G Q:$D(RTESC),RTNQ1:Y<0 S RTE=X
"RTN","RTNQ1",5,0)
 S RTRD(1)="Mixed^sort movements of all records together",RTRD(2)="Separate^sort each record type and volume separately",RTRD("B")=1,RTRD("A")="How do you want the '"_$P($P(RTAPL,"^"),";",2)_"' records sorted? ",RTRD(0)="S"
"RTN","RTNQ1",6,0)
 D SET^RTRD K RTRD G Q:X="^" S RTSORT=$E(X)
"RTN","RTNQ1",7,0)
 S RTVAR="RTSORT^RTAPL^RTE^DTIME",RTPGM="START^RTNQ1" D ZIS^RTUTL G Q:POP D START G NEXT
"RTN","RTNQ1",8,0)
 ;
"RTN","RTNQ1",9,0)
START U IO K RTESC,DFN,^TMP($J,"RTRACE")
"RTN","RTNQ1",10,0)
 F RT=0:0 S RT=$O(^RT("AA",+RTAPL,RTE,RT)) Q:'RT  I $D(^RT(RT,0)) S Y=^(0) I $S('$D(RTTY):1,$P(Y,"^",3)=+RTTY:1,1:0) S O=+$P(^DIC(195.2,+$P(Y,"^",3),0),"^",4),V=999-$P(Y,"^",7) D HIS
"RTN","RTNQ1",11,0)
 K RT,RT0,RTH,RTH0 S RTPAGE=0 D HD,PRT:$D(^TMP($J,"RTRACE"))
"RTN","RTNQ1",12,0)
 W:'$D(^TMP($J,"RTRACE")) !!?3,"...No history online." ;D DPT:RTE["DPT("
"RTN","RTNQ1",13,0)
Q K RTY,RTH0,RTPAGE,RTVAR,RTPGM,RTE,RTS1,RTS2,RTS3,RTSORT,RTO,RTDT,RTVOL,RTVL,RTESC,^TMP($J,"RTRACE") D CLOSE^RTUTL
"RTN","RTNQ1",14,0)
 K DUOUT,X1,Y,Y2,RT,RTS4,%I,%Y,C,DIC,DIY,N,O,POP,V,X Q
"RTN","RTNQ1",15,0)
PRT F RTS1=0:0 S RTS1=$O(^TMP($J,"RTRACE",RTS1)) Q:'RTS1  F RTS2=0:0 S RTS2=$O(^TMP($J,"RTRACE",RTS1,RTS2)) Q:'RTS2  D PRT1 G PRTQ:$D(RTESC)
"RTN","RTNQ1",16,0)
PRTQ Q
"RTN","RTNQ1",17,0)
 ;
"RTN","RTNQ1",18,0)
PRT1 F RTS3=0:0 S RTS3=$O(^TMP($J,"RTRACE",RTS1,RTS2,RTS3)) Q:'RTS3  F RTS4=0:0 S RTS4=$O(^TMP($J,"RTRACE",RTS1,RTS2,RTS3,RTS4)) Q:'RTS4  S RTH0=^(RTS4) D PRT2 G PRT1Q:$D(RTESC)
"RTN","RTNQ1",19,0)
PRT1Q Q
"RTN","RTNQ1",20,0)
 ;
"RTN","RTNQ1",21,0)
PRT2 S RT=+RTH0 Q:'RT  I '$D(RTVL(RT)) D DEMOS^RTUTL1 S RTVL(RT)=RTD("A")_RTD("V") I RTSORT="S" D HD:($Y+5)>IOSL Q:$D(RTESC)  D DEMOS^RTUTL1:'$D(RTD) W !!,"[ ",RTD("T"),"]"
"RTN","RTNQ1",22,0)
 D HD:($Y+5)>IOSL Q:$D(RTESC)  S Y=RTH0 D DEMOS3^RTUTL1 S Y=$P(RTH0,"^",8),C=$P(^DD(190.3,8,0),"^",2) D Y^DIQ S M=Y,X1=+$P(RTH0,"^",9),X2=+$P(RTH0,"^",6) S:'X1 X1=DT D ^%DTC S D=$S(X'<0:X,1:"")
"RTN","RTNQ1",23,0)
 W !,RTD("D"),?20,RTVL(RT),?25,RTD("B"),?50,$E(M,1,24),?75,D W:$D(RTD("PROV")) !?25,"(",RTD("PROV"),")"
"RTN","RTNQ1",24,0)
 K RT,D,RTD,B,B1,M,D1 Q
"RTN","RTNQ1",25,0)
 ;
"RTN","RTNQ1",26,0)
HD I RTPAGE,IOST["C-" D ESC^RTRD Q:$D(RTESC)
"RTN","RTNQ1",27,0)
 S RTPAGE=RTPAGE+1,X1="Movement History for the "_$S($D(^DIC(195.1,+RTAPL,"HD")):$P(^("HD"),"^"),1:$P($P(RTAPL,"^"),";",2)) D PTHD^RTUTL2,EQUALS^RTUTL3 K X1
"RTN","RTNQ1",28,0)
 I $D(DFN) W !!,"[ Clinic History Profile ]",!?3,"Clinic",?30,"Appointment Date/Time",?55,"Status",!?3,"------",?30,"---------------------",?55,"------" Q
"RTN","RTNQ1",29,0)
 W !,"[SORT: ",$S(RTSORT="M":"By date charged,record type display order and then volume",1:"By record type display order,volume and then date charged"),"]"
"RTN","RTNQ1",30,0)
 W !!,"Date Charged",?20,"Vol",?25,"Borrower",?50,"Type of Movement",?70,"# of Days" D LINE^RTUTL3
"RTN","RTNQ1",31,0)
 Q
"RTN","RTNQ1",32,0)
 ;
"RTN","RTNQ1",33,0)
HIS F RTH=0:0 S RTH=$O(^RTV(190.3,"B",RT,RTH)) Q:'RTH  I $D(^RTV(190.3,RTH,0)) S RTH0=^(0) D SET
"RTN","RTNQ1",34,0)
 Q
"RTN","RTNQ1",35,0)
 ;
"RTN","RTNQ1",36,0)
SET S D=9999999.9999-$P(RTH0,"^",6)
"RTN","RTNQ1",37,0)
 I RTSORT="S" F Y=999:-1 I '$D(^TMP($J,"RTRACE",O,V,D,Y)) S ^(Y)=RTH0 Q
"RTN","RTNQ1",38,0)
 ; the next line accounts for more than one movement transaction having
"RTN","RTNQ1",39,0)
 ; occurred within the same minute, while preserving the "reverse date"
"RTN","RTNQ1",40,0)
 ; sort order
"RTN","RTNQ1",41,0)
 ;
"RTN","RTNQ1",42,0)
 I RTSORT'="S" F Y=999:-1 I '$D(^TMP($J,"RTRACE",D,O,V,Y)) S ^(Y)=RTH0 Q
"RTN","RTNQ1",43,0)
 Q
"RTN","RTT12")
0^3^B6911467
"RTN","RTT12",1,0)
RTT12 ;ISC-ALBANY/PKE-repoint request to new record ; 12/30/02 12:28pm
"RTN","RTT12",2,0)
 ;;2.0;Record Tracking;**31**;10/22/91 
"RTN","RTT12",3,0)
 D EN K X,P,Z,RDT,RTV0,RTWND Q
"RTN","RTT12",4,0)
 ;
"RTN","RTT12",5,0)
EN I '$D(RT)!('$D(RTPAR))!('RT)!('RTPAR) Q
"RTN","RTT12",6,0)
 S RTRD(1)="Yes^transfer Requests to Record/Volume "_RTVOL
"RTN","RTT12",7,0)
 S RTRD(2)="No^not change the Record/Volume(s)  Requested."
"RTN","RTT12",8,0)
 S:'$D(RTRD("A")) RTRD("A")="Pending Requests can be transferred to last Record/Volume just created. "_$C(13,10)_"        Transfer Requests to volume '"_RTVOL_"' ? "
"RTN","RTT12",9,0)
 S RTRD(0)="S",RTRD("B")=2 D SET^RTRD K RTRD S X=$E(X) S:X["^" RTESC="" I X'="Y" Q
"RTN","RTT12",10,0)
 ;get pend cut
"RTN","RTT12",11,0)
 Q:'$D(RTTY)  D PND^RTRPT Q:'$D(RTWND(+RTTY))
"RTN","RTT12",12,0)
 ;get requests
"RTN","RTT12",13,0)
GET ;
"RTN","RTT12",14,0)
 N RTCNT
"RTN","RTT12",15,0)
 F RTV0=0:0 S RTV0=$O(^RT("P",RTPAR,RTV0)) Q:'RTV0  I RTV0'=RT D FIND
"RTN","RTT12",16,0)
 S RTV0=RTPAR Q:RTV0=RT
"RTN","RTT12",17,0)
 ;z=da
"RTN","RTT12",18,0)
FIND F Z=0:0 S Z=$O(^RTV(190.1,"B",RTV0,Z)) Q:'Z  D REC L -^RTV(190.1,Z)
"RTN","RTT12",19,0)
 QUIT
"RTN","RTT12",20,0)
 ;
"RTN","RTT12",21,0)
REC I $D(^RTV(190.1,Z,0)),$D(^RT(+^RTV(190.1,Z,0))) L +^RTV(190.1,Z):1 I '$T G REC
"RTN","RTT12",22,0)
 N RTMVMNT0
"RTN","RTT12",23,0)
 I '$D(^RTV(190.1,Z,0))!('$D(^RT(+^RTV(190.1,Z,0)))) L -^RTV(190.1,Z) Q
"RTN","RTT12",24,0)
 ;only requests,pending
"RTN","RTT12",25,0)
 S RTMVMNT0=^RTV(190.1,Z,0) ;zero node of the entry in 190.1
"RTN","RTT12",26,0)
 S RDT=+$P(RTMVMNT0,U,4) Q:'RDT  I $P(RDT,".")<RTWND(+RTTY) Q
"RTN","RTT12",27,0)
 I $P(RTMVMNT0,U,6)'="r" D  Q
"RTN","RTT12",28,0)
 . S RTCNT=$G(RTCNT)+1
"RTN","RTT12",29,0)
 . I $G(RTCNT)=1 W !!,"The following request(s) cannot be transferred due to Request Status:"
"RTN","RTT12",30,0)
 . W !?2,"Request for "_$E($$EXTRNL(4,4),1,12)_" for "_$E($$EXTRNL(5,5),1,25)_" - Status is "_$$EXTRNL(6,6)
"RTN","RTT12",31,0)
 S $P(^RTV(190.1,Z,0),"^",1)=RT,^RTV(190.1,"B",RT,Z)="" K ^RTV(190.1,"B",RTV0,Z) ;W " ." R X:0
"RTN","RTT12",32,0)
 ;date/time needed
"RTN","RTT12",33,0)
DAT I RDT,$D(^RTV(190.1,"AC",RTV0,$P(RDT,"."),Z)) S ^RTV(190.1,"AC",RT,$P(RDT,"."),Z)="" K ^RTV(190.1,"AC",RTV0,$P(RDT,"."),Z)
"RTN","RTT12",34,0)
 ;
"RTN","RTT12",35,0)
 ;pull list
"RTN","RTT12",36,0)
PUL S P=+$P(^RTV(190.1,Z,0),"^",10)
"RTN","RTT12",37,0)
 I P,$D(^RTV(190.1,"AP1",P,RTV0,Z)) S ^RTV(190.1,"AP1",P,RT,Z)="" K ^RTV(190.1,"AP1",P,RTV0,Z)
"RTN","RTT12",38,0)
 L -^RTV(190.1,Z) Q
"RTN","RTT12",39,0)
EXTRNL(RTPIECE,RTFIELD) ;get external values for fields to be displayed
"RTN","RTT12",40,0)
 ; RTPIECE is piece of zero node, 190.1
"RTN","RTT12",41,0)
 ; RTFIELD is FM field number
"RTN","RTT12",42,0)
 S Y=$P(RTMVMNT0,U,RTPIECE)
"RTN","RTT12",43,0)
 S C=$P(^DD(190.1,RTFIELD,0),U,2)
"RTN","RTT12",44,0)
 D Y^DIQ
"RTN","RTT12",45,0)
 Q Y
"VER")
8.0^22
**END**
**END**
