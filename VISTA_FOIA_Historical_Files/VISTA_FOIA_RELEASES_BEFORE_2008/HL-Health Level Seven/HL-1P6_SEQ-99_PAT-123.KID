Released HL*1.6*123 SEQ #99
Extracted from mail message
**KIDS**:HL*1.6*123^

**INSTALL NAME**
HL*1.6*123
"BLD",3556,0)
HL*1.6*123^HEALTH LEVEL SEVEN^0^3050614^y
"BLD",3556,1,0)
^^1^1^3041013^
"BLD",3556,1,1,0)
Please see the patch description on Forum, in the National Patch Module.
"BLD",3556,4,0)
^9.64PA^^
"BLD",3556,"ABPKG")
n
"BLD",3556,"KRN",0)
^9.67PA^8989.52^19
"BLD",3556,"KRN",.4,0)
.4
"BLD",3556,"KRN",.401,0)
.401
"BLD",3556,"KRN",.402,0)
.402
"BLD",3556,"KRN",.403,0)
.403
"BLD",3556,"KRN",.5,0)
.5
"BLD",3556,"KRN",.84,0)
.84
"BLD",3556,"KRN",3.6,0)
3.6
"BLD",3556,"KRN",3.8,0)
3.8
"BLD",3556,"KRN",9.2,0)
9.2
"BLD",3556,"KRN",9.8,0)
9.8
"BLD",3556,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3556,"KRN",9.8,"NM",1,0)
HLCSLM^^0^B44055037
"BLD",3556,"KRN",9.8,"NM","B","HLCSLM",1)

"BLD",3556,"KRN",19,0)
19
"BLD",3556,"KRN",19.1,0)
19.1
"BLD",3556,"KRN",101,0)
101
"BLD",3556,"KRN",409.61,0)
409.61
"BLD",3556,"KRN",771,0)
771
"BLD",3556,"KRN",870,0)
870
"BLD",3556,"KRN",8989.51,0)
8989.51
"BLD",3556,"KRN",8989.52,0)
8989.52
"BLD",3556,"KRN",8994,0)
8994
"BLD",3556,"KRN","B",.4,.4)

"BLD",3556,"KRN","B",.401,.401)

"BLD",3556,"KRN","B",.402,.402)

"BLD",3556,"KRN","B",.403,.403)

"BLD",3556,"KRN","B",.5,.5)

"BLD",3556,"KRN","B",.84,.84)

"BLD",3556,"KRN","B",3.6,3.6)

"BLD",3556,"KRN","B",3.8,3.8)

"BLD",3556,"KRN","B",9.2,9.2)

"BLD",3556,"KRN","B",9.8,9.8)

"BLD",3556,"KRN","B",19,19)

"BLD",3556,"KRN","B",19.1,19.1)

"BLD",3556,"KRN","B",101,101)

"BLD",3556,"KRN","B",409.61,409.61)

"BLD",3556,"KRN","B",771,771)

"BLD",3556,"KRN","B",870,870)

"BLD",3556,"KRN","B",8989.51,8989.51)

"BLD",3556,"KRN","B",8989.52,8989.52)

"BLD",3556,"KRN","B",8994,8994)

"BLD",3556,"QUES",0)
^9.62^^
"BLD",3556,"REQB",0)
^9.611^1^1
"BLD",3556,"REQB",1,0)
HL*1.6*109^1
"BLD",3556,"REQB","B","HL*1.6*109",1)

"MBREQ")
0
"PKG",33,-1)
1^1
"PKG",33,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN
"PKG",33,20,0)
^9.402P^^
"PKG",33,22,0)
^9.49I^1^1
"PKG",33,22,1,0)
1.6^2951013^2960613
"PKG",33,22,1,"PAH",1,0)
123^3050614^11
"PKG",33,22,1,"PAH",1,1,0)
^^1^1^3050614
"PKG",33,22,1,"PAH",1,1,1,0)
Please see the patch description on Forum, in the National Patch Module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","HLCSLM")
0^1^B44055037
"RTN","HLCSLM",1,0)
HLCSLM ;SFCIOFO/AC - HL7 LINK MANAGER ;06/14/2005  10:29
"RTN","HLCSLM",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**49,57,109,123**;Oct 13, 1995
"RTN","HLCSLM",3,0)
 ;
"RTN","HLCSLM",4,0)
EN ;Entry point for start up task
"RTN","HLCSLM",5,0)
 N %,HLEVLCHK,HLTSKCNT
"RTN","HLCSLM",6,0)
 F %=1:1:10 L +^HLCS("HLCSLM"):2 Q:$T
"RTN","HLCSLM",7,0)
 E  Q
"RTN","HLCSLM",8,0)
 I $G(ZTQUEUED) S Y=$$PSET^%ZTLOAD(ZTQUEUED)
"RTN","HLCSLM",9,0)
 D INIT,SAVDOLRH
"RTN","HLCSLM",10,0)
 D SETNM^%ZOSV($E("HLmgr:"_$G(ZTQUEUED),1,15))
"RTN","HLCSLM",11,0)
 ;
"RTN","HLCSLM",12,0)
LOOP ;
"RTN","HLCSLM",13,0)
 D CHKQUE
"RTN","HLCSLM",14,0)
 I $$CKLMSTOP G EXIT
"RTN","HLCSLM",15,0)
 D SAVDOLRH
"RTN","HLCSLM",16,0)
 D CHECKMST^HLEVMST ;HL*1.6*109 - Make sure event monitor current
"RTN","HLCSLM",17,0)
 H 10
"RTN","HLCSLM",18,0)
 G LOOP
"RTN","HLCSLM",19,0)
 ;
"RTN","HLCSLM",20,0)
EXIT N HLJ,X
"RTN","HLCSLM",21,0)
 S X=1
"RTN","HLCSLM",22,0)
 F  L +^HLCS(869.3,X,5):2 Q:$T
"RTN","HLCSLM",23,0)
 ;52=Link Manager task number
"RTN","HLCSLM",24,0)
 S HLJ(869.3,X_",",52)="@"
"RTN","HLCSLM",25,0)
 D FILE^HLDIE("","HLJ","","EXIT","HLCSLM") ;HL*1.6*109
"RTN","HLCSLM",26,0)
 L -^HLCS(869.3,X,5)
"RTN","HLCSLM",27,0)
 L -^HLCS("HLCSLM")
"RTN","HLCSLM",28,0)
 Q
"RTN","HLCSLM",29,0)
 ;
"RTN","HLCSLM",30,0)
SAVDOLRH ;Save Last Known $H
"RTN","HLCSLM",31,0)
 N HLJ,X
"RTN","HLCSLM",32,0)
 S X=1
"RTN","HLCSLM",33,0)
 F  L +^HLCS(869.3,X,5):2 Q:$T
"RTN","HLCSLM",34,0)
 ;54=LM LAST KNOWN $H
"RTN","HLCSLM",35,0)
 S HLJ(869.3,X_",",54)=$H
"RTN","HLCSLM",36,0)
 D FILE^HLDIE("","HLJ","","SAVDOLRH","HLCSLM") ;HL*1.6*109
"RTN","HLCSLM",37,0)
 L -^HLCS(869.3,X,5)
"RTN","HLCSLM",38,0)
 Q
"RTN","HLCSLM",39,0)
 ;
"RTN","HLCSLM",40,0)
CHKQUE ;Check queues for messages to send
"RTN","HLCSLM",41,0)
 ;HLTSKCNT(logical link)=task #^$H
"RTN","HLCSLM",42,0)
 N HLDA,HLDP,HLMSG,HLTSK,Y
"RTN","HLCSLM",43,0)
 S (HLDA,HLMSG)=""
"RTN","HLCSLM",44,0)
 F HLDP=0:0 S HLDP=+$O(^HLMA("AC","O",HLDP)) Q:HLDP'>0  S HLMSG=+$O(^(HLDP,0)) I HLMSG D  L -^HLCS("HLCSLSM",HLDP)
"RTN","HLCSLM",45,0)
 .;quit if persistent link
"RTN","HLCSLM",46,0)
 .Q:$P($G(^HLCS(870,HLDP,400)),U,4)="Y"
"RTN","HLCSLM",47,0)
 .L +^HLCS("HLCSLSM",HLDP):0 E  K HLTSKCNT(HLDP) Q
"RTN","HLCSLM",48,0)
 .Q:'$$LLOK(+HLDP)
"RTN","HLCSLM",49,0)
 .;get tasknumber from file 870 and HLTSKCNT array
"RTN","HLCSLM",50,0)
 .S Y=$$TASKNUM(HLDP),HLTSK=$G(HLTSKCNT(HLDP))
"RTN","HLCSLM",51,0)
 . ;
"RTN","HLCSLM",52,0)
 . ;patch HL*1.6*123 start
"RTN","HLCSLM",53,0)
 . S HLDP("TASK-ACTIVE")=0
"RTN","HLCSLM",54,0)
 . ;
"RTN","HLCSLM",55,0)
 . I Y D
"RTN","HLCSLM",56,0)
 .. N ZTSK
"RTN","HLCSLM",57,0)
 .. S ZTSK=Y
"RTN","HLCSLM",58,0)
 .. ; Check status of task
"RTN","HLCSLM",59,0)
 .. D STAT^%ZTLOAD
"RTN","HLCSLM",60,0)
 .. I "12"[ZTSK(1) S HLDP("TASK-ACTIVE")=1
"RTN","HLCSLM",61,0)
 . Q:HLDP("TASK-ACTIVE")
"RTN","HLCSLM",62,0)
 . ;
"RTN","HLCSLM",63,0)
 . I HLTSK D
"RTN","HLCSLM",64,0)
 .. N ZTSK
"RTN","HLCSLM",65,0)
 .. S ZTSK=+HLTSK
"RTN","HLCSLM",66,0)
 .. ; Check status of task
"RTN","HLCSLM",67,0)
 .. D STAT^%ZTLOAD
"RTN","HLCSLM",68,0)
 .. I "12"[ZTSK(1) S HLDP("TASK-ACTIVE")=1
"RTN","HLCSLM",69,0)
 . Q:HLDP("TASK-ACTIVE")
"RTN","HLCSLM",70,0)
 . ;
"RTN","HLCSLM",71,0)
 . ;no tasknumber, link not running nor queued, task it
"RTN","HLCSLM",72,0)
 . I 'HLTSK!'Y D TASKLSUB(HLDP),SAVTSK(HLDP) Q
"RTN","HLCSLM",73,0)
 ; comment out the following lines
"RTN","HLCSLM",74,0)
 ; .;link was tasked, check time
"RTN","HLCSLM",75,0)
 ; .S Y=$P(HLTSK,U,2)
"RTN","HLCSLM",76,0)
 ; .;check that time task is less than 30 minutes
"RTN","HLCSLM",77,0)
 ; .Q:$$HDIFF^XLFDT($H,Y,2)<1800
"RTN","HLCSLM",78,0)
 ; .;shutdown and send alert
"RTN","HLCSLM",79,0)
 ; .D SDFLD^HLCSTCP,EXITS^HLCSTCP("Shutdown"),SNDALERT
"RTN","HLCSLM",80,0)
 ; loop through links that have been tasked
"RTN","HLCSLM",81,0)
 ; F HLDP=0:0 S HLDP=$O(HLTSKCNT(HLDP)) Q:HLDP'>0  K:'$D(^HLMA("AC","O",HLDP)) HLTSKCNT(HLDP)
"RTN","HLCSLM",82,0)
 F HLDP=0:0 S HLDP=$O(HLTSKCNT(HLDP)) Q:HLDP'>0  D
"RTN","HLCSLM",83,0)
 . N ZTSK
"RTN","HLCSLM",84,0)
 . S ZTSK=+HLTSKCNT(HLDP)
"RTN","HLCSLM",85,0)
 . ; Check status of task
"RTN","HLCSLM",86,0)
 . D STAT^%ZTLOAD
"RTN","HLCSLM",87,0)
 . ; kill HLTSKCNT(HLDP) if process is not active
"RTN","HLCSLM",88,0)
 . I "12"'[ZTSK(1) K HLTSKCNT(HLDP)
"RTN","HLCSLM",89,0)
 ; patch HL*1.6*123 end
"RTN","HLCSLM",90,0)
 Q
"RTN","HLCSLM",91,0)
 ;
"RTN","HLCSLM",92,0)
INIT ;Create Task number and clear Stop flag.
"RTN","HLCSLM",93,0)
 N HLJ,X
"RTN","HLCSLM",94,0)
 S X=1
"RTN","HLCSLM",95,0)
 F  L +^HLCS(869.3,X,5):2 Q:$T
"RTN","HLCSLM",96,0)
 ;52=Link Manager task number,53=Stop Link Manager
"RTN","HLCSLM",97,0)
 S HLJ(869.3,X_",",52)=$G(ZTQUEUED)
"RTN","HLCSLM",98,0)
 S HLJ(869.3,X_",",53)="@"
"RTN","HLCSLM",99,0)
 D FILE^HLDIE("","HLJ","","INIT","HLCSLM") ;HL*1.6*109
"RTN","HLCSLM",100,0)
 L -^HLCS(869.3,X,5)
"RTN","HLCSLM",101,0)
 Q
"RTN","HLCSLM",102,0)
TASKNUM(X) ;Look-up task number
"RTN","HLCSLM",103,0)
 N %,DA,Y
"RTN","HLCSLM",104,0)
 S DA=X
"RTN","HLCSLM",105,0)
 ;
"RTN","HLCSLM",106,0)
 ;**109**
"RTN","HLCSLM",107,0)
 ;F  L +^HLCS(870,+DA,0):2 Q:$T
"RTN","HLCSLM",108,0)
 ;
"RTN","HLCSLM",109,0)
 S Y=$$GET1^DIQ(870,DA_",",11)
"RTN","HLCSLM",110,0)
 ;
"RTN","HLCSLM",111,0)
 ;**109
"RTN","HLCSLM",112,0)
 ;L -^HLCS(870,+DA,0)
"RTN","HLCSLM",113,0)
 ;
"RTN","HLCSLM",114,0)
 Q Y
"RTN","HLCSLM",115,0)
STATUS(X) ;Status of task
"RTN","HLCSLM",116,0)
 N Y,ZTSK
"RTN","HLCSLM",117,0)
 S ZTSK=X
"RTN","HLCSLM",118,0)
 D STAT^%ZTLOAD
"RTN","HLCSLM",119,0)
 S Y=ZTSK(1)
"RTN","HLCSLM",120,0)
 Q Y
"RTN","HLCSLM",121,0)
 ;
"RTN","HLCSLM",122,0)
LLOK(X) ;Function to check whether LL ok.
"RTN","HLCSLM",123,0)
 ;return value 1 = ok, 0 = not ok.
"RTN","HLCSLM",124,0)
 Q:'$G(X)
"RTN","HLCSLM",125,0)
 N HLDP,HLDP0,HLPARM4,HLTYPTR
"RTN","HLCSLM",126,0)
 S HLDP=+X,HLDP0=$G(^HLCS(870,HLDP,0)),HLPARM4=$G(^(400)) Q:HLDP0="" 0
"RTN","HLCSLM",127,0)
 ;must be a client
"RTN","HLCSLM",128,0)
 Q:$P(HLPARM4,U,3)'="C" 0
"RTN","HLCSLM",129,0)
 ;
"RTN","HLCSLM",130,0)
 ; patch HL*1.6*123
"RTN","HLCSLM",131,0)
 ;shutdown LLP must be 0
"RTN","HLCSLM",132,0)
 ; Q:$P(HLDP0,U,15)'=0 0
"RTN","HLCSLM",133,0)
 ; change to 1, in case the data is empty
"RTN","HLCSLM",134,0)
 Q:$P(HLDP0,U,15)=1 0
"RTN","HLCSLM",135,0)
 ;
"RTN","HLCSLM",136,0)
 ;must have LLP Type of TCP
"RTN","HLCSLM",137,0)
 S HLTYPTR=+$P(HLDP0,U,3) Q:$P($G(^HLCS(869.1,HLTYPTR,0)),U)'="TCP" 0
"RTN","HLCSLM",138,0)
 Q 1
"RTN","HLCSLM",139,0)
 ;
"RTN","HLCSLM",140,0)
SAVTSK(X) ;
"RTN","HLCSLM",141,0)
 N HLDP,HLJ
"RTN","HLCSLM",142,0)
 S HLDP=X
"RTN","HLCSLM",143,0)
 ;
"RTN","HLCSLM",144,0)
 ;**109**
"RTN","HLCSLM",145,0)
 F  L +^HLCS(870,HLDP,0):2 Q:$T
"RTN","HLCSLM",146,0)
 ;
"RTN","HLCSLM",147,0)
 ;4=status,10=Time Stopped,9=Time Started,11=Task Number,3=Online ?
"RTN","HLCSLM",148,0)
 S X=$NA(HLJ(870,HLDP_",")),@X@(11)=$G(ZTSK)
"RTN","HLCSLM",149,0)
 ;S HLJ(870,HLDP_",",11)=$G(ZTSK)
"RTN","HLCSLM",150,0)
 D FILE^HLDIE("","HLJ","","SAVTSK","HLCSLM") ; HL*1.6*109
"RTN","HLCSLM",151,0)
 S HLTSKCNT(HLDP)=$G(ZTSK)_"^"_$H
"RTN","HLCSLM",152,0)
 ;
"RTN","HLCSLM",153,0)
 ;**109**
"RTN","HLCSLM",154,0)
 L -^HLCS(870,HLDP,0)
"RTN","HLCSLM",155,0)
 ;
"RTN","HLCSLM",156,0)
 Q
"RTN","HLCSLM",157,0)
 ;
"RTN","HLCSLM",158,0)
STRTSTOP ;ENTRY POINT TO START/STOP TCP LINK MANAGER
"RTN","HLCSLM",159,0)
 N DIR,DIRUT,Y
"RTN","HLCSLM",160,0)
 L +^HLCS("HLCSLM"):3 E  D  Q
"RTN","HLCSLM",161,0)
 .W !,*7,"Link Manager already running!"
"RTN","HLCSLM",162,0)
 .W ! S DIR(0)="YO",DIR("A")="Would you like to stop the Link Manager now",DIR("B")="NO" D ^DIR K DIR
"RTN","HLCSLM",163,0)
 .I $D(DIRUT)!'Y Q
"RTN","HLCSLM",164,0)
 .D STOPLM
"RTN","HLCSLM",165,0)
 W !,*7,"Link Manager is NOT currently running!"
"RTN","HLCSLM",166,0)
 W ! S DIR(0)="YO",DIR("A")="Would you like to start the Link Manager now",DIR("B")="YES" D ^DIR K DIR
"RTN","HLCSLM",167,0)
 I '$D(DIRUT)&Y D TASKLM
"RTN","HLCSLM",168,0)
 L -^HLCS("HLCSLM")
"RTN","HLCSLM",169,0)
 Q
"RTN","HLCSLM",170,0)
 ;
"RTN","HLCSLM",171,0)
STOPLM ;ENTRY POINT TO STOP LINK MANAGER
"RTN","HLCSLM",172,0)
 N DIC,X,Y,DTOUT,DUOUT,DLAYGO,DIE,DA,DR
"RTN","HLCSLM",173,0)
 S DIC="^HLCS(869.3,"
"RTN","HLCSLM",174,0)
 S X=1
"RTN","HLCSLM",175,0)
 D ^DIC
"RTN","HLCSLM",176,0)
 S DA=+Y,DIE=DIC
"RTN","HLCSLM",177,0)
 S DR="53////1"
"RTN","HLCSLM",178,0)
 D ^DIE
"RTN","HLCSLM",179,0)
 W !,"Link Manager has been asked to stop"
"RTN","HLCSLM",180,0)
 Q
"RTN","HLCSLM",181,0)
STAT() ;Status of LINK MANAGER--up, down or unable to determine.
"RTN","HLCSLM",182,0)
 N %,DA,X,Y
"RTN","HLCSLM",183,0)
 S DA=1
"RTN","HLCSLM",184,0)
 S X=$$GET1^DIQ(869.3,DA_",",52)
"RTN","HLCSLM",185,0)
 Q:X']"" 0
"RTN","HLCSLM",186,0)
 S X=$$GET1^DIQ(869.3,DA_",",54)
"RTN","HLCSLM",187,0)
 Q:X']"" 0
"RTN","HLCSLM",188,0)
 I $$HDIFF^XLFDT($H,X,2)>500 Q 0
"RTN","HLCSLM",189,0)
 Q 1
"RTN","HLCSLM",190,0)
 ;
"RTN","HLCSLM",191,0)
TASKLSUB(X) ;Task LINK SUB-MANAGER.
"RTN","HLCSLM",192,0)
 ;This may be a place to log the time which the LINK SUBMANAGER is tasked.
"RTN","HLCSLM",193,0)
 N HLDP,HLDP0,HLDAPP,HLTYPTR,HLBGR,HLENV,HLPARM,HLPARM4,HLQUIT,ZTRTN,ZTDESC,ZTCPU,ZTSAVE
"RTN","HLCSLM",194,0)
 ;ZTSK is not Newed here because it will be needed by SAVTSK.
"RTN","HLCSLM",195,0)
 S HLDP=X,HLDP0=$G(^HLCS(870,HLDP,0)),HLPARM4=$G(^(400))
"RTN","HLCSLM",196,0)
 ; Q:"N"'[$P(HLPARM4,U,4)  ; patch HL*1.6*123: comment out
"RTN","HLCSLM",197,0)
 ;quit if no LLP TYPE
"RTN","HLCSLM",198,0)
 S HLDAPP=$P(HLDP0,U),HLTYPTR=$P(HLDP0,U,3) Q:'HLTYPTR
"RTN","HLCSLM",199,0)
 S HLBGR=$G(^HLCS(869.1,HLTYPTR,100)),HLENV=$G(^(200))
"RTN","HLCSLM",200,0)
 I HLENV'="" K HLQUIT X HLENV Q:$D(HLQUIT)
"RTN","HLCSLM",201,0)
 S ZTRTN="^HLCSLSM",HLBGR=$P(HLBGR," ",2)
"RTN","HLCSLM",202,0)
 S ZTDESC=HLDAPP_" Low Level Protocol",ZTSAVE("HLDP")="",ZTSAVE("HLBGR")=""
"RTN","HLCSLM",203,0)
 S ZTIO="",ZTDTH=$H
"RTN","HLCSLM",204,0)
 ;get startup node
"RTN","HLCSLM",205,0)
 I $P(HLPARM4,U,6),$D(^%ZIS(14.7,+$P(HLPARM4,U,6),0)) S ZTCPU=$P(^(0),U)
"RTN","HLCSLM",206,0)
 D ^%ZTLOAD
"RTN","HLCSLM",207,0)
 D MON^HLCSTCP("Tasked") ;HL*1.6*123
"RTN","HLCSLM",208,0)
 Q
"RTN","HLCSLM",209,0)
 ;
"RTN","HLCSLM",210,0)
TASKLM ;Task Link Manager
"RTN","HLCSLM",211,0)
 ;Declare variables
"RTN","HLCSLM",212,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK,TMP
"RTN","HLCSLM",213,0)
 S ZTIO=""
"RTN","HLCSLM",214,0)
 S ZTDTH=$H
"RTN","HLCSLM",215,0)
 ;Task Link Manager
"RTN","HLCSLM",216,0)
 S ZTRTN="EN^HLCSLM"
"RTN","HLCSLM",217,0)
 S ZTDESC="HL7 Link Manager"
"RTN","HLCSLM",218,0)
 ;Call TaskMan
"RTN","HLCSLM",219,0)
 D ^%ZTLOAD
"RTN","HLCSLM",220,0)
 I $G(ZTSK) W !,"Link Manager queued as task number ",ZTSK
"RTN","HLCSLM",221,0)
 E  W $C(7),!!,"Unable to start/restart Link Manager"
"RTN","HLCSLM",222,0)
 Q
"RTN","HLCSLM",223,0)
 ;
"RTN","HLCSLM",224,0)
CKLMSTOP() ;Check whether Link Manager should stop
"RTN","HLCSLM",225,0)
 N PTRMAIN,NODE5,STOP
"RTN","HLCSLM",226,0)
 S PTRMAIN=+$O(^HLCS(869.3,0))
"RTN","HLCSLM",227,0)
 L +^HLCS(869.3,PTRMAIN,5):1
"RTN","HLCSLM",228,0)
 I $T L -^HLCS(869.3,PTRMAIN,5)
"RTN","HLCSLM",229,0)
 S NODE5=$G(^HLCS(869.3,PTRMAIN,5))
"RTN","HLCSLM",230,0)
 S STOP=+$P(NODE5,"^",3)
"RTN","HLCSLM",231,0)
 Q:STOP STOP
"RTN","HLCSLM",232,0)
 S STOP=$$S^%ZTLOAD
"RTN","HLCSLM",233,0)
 Q STOP
"RTN","HLCSLM",234,0)
 ;
"RTN","HLCSLM",235,0)
SNDALERT ;Send Alert
"RTN","HLCSLM",236,0)
 N XQA,XQAMSG,XQAOPT,XQAROU,XQAID,Z
"RTN","HLCSLM",237,0)
 S Z=$P($$PARAM^HLCS2,U,8) Q:Z=""
"RTN","HLCSLM",238,0)
 S XQA("G."_Z)="",XQAMSG="HL7 Logical Link "_$P(^HLCS(870,HLDP,0),U)_" shutdown due to TaskMan unable to process task request"
"RTN","HLCSLM",239,0)
 D SETUP^XQALERT
"RTN","HLCSLM",240,0)
 Q
"VER")
8.0^22.0
"BLD",3556,6)
^SEQ #99
**END**
**END**
