Released RA*5*71 SEQ #64
Extracted from mail message
**KIDS**:RA*5.0*71^

**INSTALL NAME**
RA*5.0*71
"BLD",5979,0)
RA*5.0*71^RADIOLOGY/NUCLEAR MEDICINE^0^3060720^y
"BLD",5979,1,0)
^^1^1^3060717^
"BLD",5979,1,1,0)
ADD ABILITY TO UPDATE EXAM DATA TO V/R AND CORRECT PROC CODE ENTRY
"BLD",5979,4,0)
^9.64PA^^
"BLD",5979,6.3)
10
"BLD",5979,"KRN",0)
^9.67PA^8989.52^19
"BLD",5979,"KRN",.4,0)
.4
"BLD",5979,"KRN",.401,0)
.401
"BLD",5979,"KRN",.402,0)
.402
"BLD",5979,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5979,"KRN",.402,"NM",1,0)
RA STATUS ENTRY    FILE #72^72^0
"BLD",5979,"KRN",.402,"NM","B","RA STATUS ENTRY    FILE #72",1)

"BLD",5979,"KRN",.403,0)
.403
"BLD",5979,"KRN",.5,0)
.5
"BLD",5979,"KRN",.84,0)
.84
"BLD",5979,"KRN",3.6,0)
3.6
"BLD",5979,"KRN",3.8,0)
3.8
"BLD",5979,"KRN",9.2,0)
9.2
"BLD",5979,"KRN",9.8,0)
9.8
"BLD",5979,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",5979,"KRN",9.8,"NM",1,0)
RAUTL1^^0^B42756218
"BLD",5979,"KRN",9.8,"NM",2,0)
RASTED^^0^B46056660
"BLD",5979,"KRN",9.8,"NM",3,0)
RAHLR^^0^B43467962
"BLD",5979,"KRN",9.8,"NM",4,0)
RAHLRS^^0^B11033463
"BLD",5979,"KRN",9.8,"NM",5,0)
RAMAIN2^^0^B51382730
"BLD",5979,"KRN",9.8,"NM",6,0)
RAHLRPC^^0^B2725117
"BLD",5979,"KRN",9.8,"NM",7,0)
RAHLTCPB^^0^B57781715
"BLD",5979,"KRN",9.8,"NM",8,0)
RAUTL0^^0^B31099396
"BLD",5979,"KRN",9.8,"NM","B","RAHLR",3)

"BLD",5979,"KRN",9.8,"NM","B","RAHLRPC",6)

"BLD",5979,"KRN",9.8,"NM","B","RAHLRS",4)

"BLD",5979,"KRN",9.8,"NM","B","RAHLTCPB",7)

"BLD",5979,"KRN",9.8,"NM","B","RAMAIN2",5)

"BLD",5979,"KRN",9.8,"NM","B","RASTED",2)

"BLD",5979,"KRN",9.8,"NM","B","RAUTL0",8)

"BLD",5979,"KRN",9.8,"NM","B","RAUTL1",1)

"BLD",5979,"KRN",19,0)
19
"BLD",5979,"KRN",19.1,0)
19.1
"BLD",5979,"KRN",101,0)
101
"BLD",5979,"KRN",409.61,0)
409.61
"BLD",5979,"KRN",771,0)
771
"BLD",5979,"KRN",870,0)
870
"BLD",5979,"KRN",8989.51,0)
8989.51
"BLD",5979,"KRN",8989.52,0)
8989.52
"BLD",5979,"KRN",8994,0)
8994
"BLD",5979,"KRN","B",.4,.4)

"BLD",5979,"KRN","B",.401,.401)

"BLD",5979,"KRN","B",.402,.402)

"BLD",5979,"KRN","B",.403,.403)

"BLD",5979,"KRN","B",.5,.5)

"BLD",5979,"KRN","B",.84,.84)

"BLD",5979,"KRN","B",3.6,3.6)

"BLD",5979,"KRN","B",3.8,3.8)

"BLD",5979,"KRN","B",9.2,9.2)

"BLD",5979,"KRN","B",9.8,9.8)

"BLD",5979,"KRN","B",19,19)

"BLD",5979,"KRN","B",19.1,19.1)

"BLD",5979,"KRN","B",101,101)

"BLD",5979,"KRN","B",409.61,409.61)

"BLD",5979,"KRN","B",771,771)

"BLD",5979,"KRN","B",870,870)

"BLD",5979,"KRN","B",8989.51,8989.51)

"BLD",5979,"KRN","B",8989.52,8989.52)

"BLD",5979,"KRN","B",8994,8994)

"BLD",5979,"QUES",0)
^9.62^^
"BLD",5979,"REQB",0)
^9.611^8^8
"BLD",5979,"REQB",1,0)
RA*5.0*18^1
"BLD",5979,"REQB",2,0)
RA*5.0*45^1
"BLD",5979,"REQB",3,0)
RA*5.0*25^1
"BLD",5979,"REQB",4,0)
RA*5.0*60^1
"BLD",5979,"REQB",5,0)
RA*5.0*62^1
"BLD",5979,"REQB",6,0)
RA*5.0*54^1
"BLD",5979,"REQB",7,0)
RA*5.0*51^1
"BLD",5979,"REQB",8,0)
RA*5.0*10^1
"BLD",5979,"REQB","B","RA*5.0*10",8)

"BLD",5979,"REQB","B","RA*5.0*18",1)

"BLD",5979,"REQB","B","RA*5.0*25",3)

"BLD",5979,"REQB","B","RA*5.0*45",2)

"BLD",5979,"REQB","B","RA*5.0*51",7)

"BLD",5979,"REQB","B","RA*5.0*54",6)

"BLD",5979,"REQB","B","RA*5.0*60",4)

"BLD",5979,"REQB","B","RA*5.0*62",5)

"KRN",.402,229,-1)
0^1
"KRN",.402,229,0)
RA STATUS ENTRY^3060705.1037^^72^^^3060714
"KRN",.402,229,"DIAB",1,0,72,3)
PROCEDURE MODIFIERS REQUIRED?//NO;T
"KRN",.402,229,"DIAB",1,0,72,6)
ASK PROCEDURE MODIFIERS?//NO;T
"KRN",.402,229,"DIAB",1,0,72,8)
RESIDENT REPORT?;T
"KRN",.402,229,"DIAB",2,0,72,1)
APPEAR ON STATUS TRACKING?;T
"KRN",.402,229,"DIAB",2,0,72,3)
CPT MODIFIERS REQUIRED?//NO;T
"KRN",.402,229,"DIAB",2,0,72,4)
REPORT ENTERED REQUIRED?//NO;T
"KRN",.402,229,"DIAB",2,0,72,5)
ASK FOR TECHNOLOGIST?//NO;T
"KRN",.402,229,"DIAB",2,0,72,6)
ASK CPT MODIFIERS?//NO;T
"KRN",.402,229,"DIAB",2,0,72,8)
STAFF REPORT?;T
"KRN",.402,229,"DIAB",3,0,72,1)
USER KEY NEEDED;T
"KRN",.402,229,"DIAB",3,0,72,2)
TECHNOLOGIST REQUIRED?//NO;T
"KRN",.402,229,"DIAB",3,0,72,4)
IMPRESSION REQUIRED?//Y;T
"KRN",.402,229,"DIAB",3,0,72,5)
ASK FOR INTERPRETING PHYS?//NO;T
"KRN",.402,229,"DIAB",3,0,72,6)
ASK FOR USER CODE?//NO;T
"KRN",.402,229,"DIAB",3,0,72,7)
CLINIC REPORT?;T
"KRN",.402,229,"DIAB",3,0,72,8)
DELINQUENT STATUS REPORT?;T
"KRN",.402,229,"DIAB",4,0,72,2)
RESIDENT OR STAFF REQUIRED?//NO;T
"KRN",.402,229,"DIAB",4,0,72,4)
VERIFIED REPORT REQUIRED?//NO;T
"KRN",.402,229,"DIAB",4,0,72,5)
ASK FOR PROCEDURE?//NO;T
"KRN",.402,229,"DIAB",4,0,72,6)
ASK MEDICATIONS & DOSAGES?//NO;T
"KRN",.402,229,"DIAB",4,0,72,7)
PTF BEDSECTION REPORT?;T
"KRN",.402,229,"DIAB",5,0,72,0)
STATUS;T
"KRN",.402,229,"DIAB",5,0,72,1)
DEFAULT NEXT STATUS;T
"KRN",.402,229,"DIAB",5,0,72,2)
DETAILED PROCEDURE REQUIRED?//NO;T
"KRN",.402,229,"DIAB",5,0,72,3)
RADIOPHARMS/DOSAGES REQUIRED?//NO;T
"KRN",.402,229,"DIAB",5,0,72,5)
ASK FOR FILM DATA?//NO;T
"KRN",.402,229,"DIAB",5,0,72,6)
ASK MED ADM DT/TIME/PERSON?//NO;T
"KRN",.402,229,"DIAB",5,0,72,7)
SERVICE REPORT?;T
"KRN",.402,229,"DIAB",6,0,72,2)
FILM ENTRY REQUIRED?//NO;T
"KRN",.402,229,"DIAB",6,0,72,3)
ACTIVITY DRAWN REQUIRED?//NO;T
"KRN",.402,229,"DIAB",6,0,72,5)
ASK FOR DIAGNOSTIC CODE?//NO;T
"KRN",.402,229,"DIAB",6,0,72,7)
SHARING/CONTRACT REPORT?;T
"KRN",.402,229,"DIAB",6,0,72,8)
PRINT DOSAGE TICKET?//NO;T
"KRN",.402,229,"DIAB",7,0,72,0)
ORDER;T
"KRN",.402,229,"DIAB",7,0,72,1)
ALLOW CANCELLING?//NO;T
"KRN",.402,229,"DIAB",7,0,72,2)
DIAGNOSTIC CODE REQUIRED?//NO;T
"KRN",.402,229,"DIAB",7,0,72,3)
DRAWN DT/TIME/PERSON REQUIRED?//NO;T
"KRN",.402,229,"DIAB",7,0,72,5)
ASK FOR CAMERA/EQUIP/RM?//NO;T
"KRN",.402,229,"DIAB",7,0,72,7)
WARD REPORT?;T
"KRN",.402,229,"DIAB",8,0,72,1)
GENERATE EXAM ALERT?;T
"KRN",.402,229,"DIAB",8,0,72,2)
CAMERA/EQUIP/RM REQUIRED?//NO;T
"KRN",.402,229,"DIAB",8,0,72,3)
ADM DT/TIME/PERSON REQUIRED?//NO;T
"KRN",.402,229,"DIAB",8,0,72,6)
ASK RADIOPHARMS AND DOSAGES?//NO;T
"KRN",.402,229,"DIAB",8,0,72,7)
FILM USAGE REPORT?;T
"KRN",.402,229,"DIAB",9,0,72,3)
ROUTE/SITE REQUIRED?//NO;T
"KRN",.402,229,"DIAB",9,0,72,6)
ASK ACTIVITY DRAWN?//NO;T
"KRN",.402,229,"DIAB",9,0,72,7)
TECHNOLOGIST REPORT?;T
"KRN",.402,229,"DIAB",10,0,72,1)
VISTARAD CATEGORY;T
"KRN",.402,229,"DIAB",10,0,72,3)
LOT NO. REQUIRED?//NO;T
"KRN",.402,229,"DIAB",10,0,72,6)
ASK DRAWN DT/TIME/PERSON?//NO;T
"KRN",.402,229,"DIAB",10,0,72,7)
AMIS REPORT?;T
"KRN",.402,229,"DIAB",11,0,72,3)
VOLUME/FORM REQUIRED?//NO;T
"KRN",.402,229,"DIAB",11,0,72,6)
ASK ADM DT/TIME/PERSON?//NO;T
"KRN",.402,229,"DIAB",11,0,72,7)
DETAILED PROCEDURE REPORT?;T
"KRN",.402,229,"DIAB",12,0,72,6)
ASK ROUTE/SITE OF ADM?//NO;T
"KRN",.402,229,"DIAB",12,0,72,7)
CAMERA/EQUIP/RM REPORT?;T
"KRN",.402,229,"DIAB",13,0,72,6)
ASK LOT NO.?//NO;T
"KRN",.402,229,"DIAB",13,0,72,7)
PHYSICIAN REPORT?;T
"KRN",.402,229,"DIAB",14,0,72,6)
ASK VOLUME/FORM?//NO;T
"KRN",.402,229,"DR",1,72)
K RAEXST,RANMFLG;S RAEXST(0)=$G(^RA(72,DA,0));S RAEXST(1)=$P(RAEXST(0),"^");S RAEXST(3)=$P(RAEXST(0),"^",3);.01T~;S:$P($G(^RA(79.2,+$G(RAIMGTYI),0)),"^",5)="Y" RANMFLG="";3T~;S X=X;S RAEXST(31)=$P(^RA(72,DA,0),"^",3);
"KRN",.402,229,"DR",1,72,1)
D ORDEL^RAUTL4:RAEXST(31)']""&($D(^RADPT("AS",DA)));5T~;4T~;S DIC("W")="W ?34,""Order: "",$P(^(0),""^"",3)";2T~;K DIC("W");6T~//NO;1T~;S:'$$IMAGE^RARIC1() Y="@11";9T~;@11;W !!?5,"Status Change Requirements";
"KRN",.402,229,"DR",1,72,2)
W !?5,"--------------------------";W !?5,"Please indicate which of the following is required",!?5,"in order to place an exam into the '",RAEXST(1),"' status:",!;.11T~//NO;.12T~//NO;.13T~//NO;.14T~//NO;.15T~//NO;.16T~//NO;
"KRN",.402,229,"DR",1,72,3)
.113T~//NO;.114T~//NO;S:'$D(RANMFLG) Y="@10";W !!?5,"(Radiopharmaceutical requirements)",!;.51T~//NO;.53T~//NO;.54T~//NO;.55T~//NO;.57T~//NO;.58T~//NO;.59T~//NO;@10;
"KRN",.402,229,"DR",1,72,4)
W !!?3,"WARNING: You must use the reporting feature of the system as",!?12,"a prerequisite for the following requirements:";.111T~//NO;.116T~//Y;.112T~//NO;W !!?5,"Status Tracking Functions";W !?5,"-------------------------";
"KRN",.402,229,"DR",1,72,5)
W !?5,"Please indicate which of the following should be asked when",!?5,"changing an exam's status to '",RAEXST(1),"' while using",!?5,"the 'status tracking' feature: ",!;.21T~//NO;.22T~//NO;.23T~//NO;.24T~//NO;.25T~//NO;.26T~//NO;
"KRN",.402,229,"DR",1,72,6)
.213T~//NO;.214T~//NO;.211T~//NO;.27T~//NO;.28T~//NO;S:'$D(RANMFLG) Y="@20";W !!?5,"(Radiopharmaceutical functions)",!;.61T~//NO;.63T~//NO;.64T~//NO;.65T~//NO;.67T~//NO;.68T~//NO;.69T~//NO;@20;W !!?5,"Management Report Criteria";
"KRN",.402,229,"DR",1,72,7)
W !?5,"--------------------------";W !?5,"Please indicate which of the following workload reports should",!?5,"include exams with the '",RAEXST(1),"' status: ",!;.31T~;.32T~;.33T~;.34T~;.35T~;.36T~;.37T~;.38T~;.39T~;.311T~;.312T~;
"KRN",.402,229,"DR",1,72,8)
.313T~;.314T~;.315T~;I '$D(RANMFLG) S Y="@99";W !!?5,"Radiopharmaceutical Dosage Ticket Print Control",!?5,$$REPEAT^XLFSTR("-",$L("Radiopharmaceutical Dosage Ticket Print Control")),!;.611T~//NO;@99;K RANMFLG;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
71^3060720
"PKG",18,22,1,"PAH",1,1,0)
^^1^1^3060720
"PKG",18,22,1,"PAH",1,1,1,0)
ADD ABILITY TO UPDATE EXAM DATA TO V/R AND CORRECT PROC CODE ENTRY
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RAHLR")
0^3^B43467962^B44013072
"RTN","RAHLR",1,0)
RAHLR ;HISC/CAH/BNT - Generate Common Order (ORM) Message ;11/10/99  10:42
"RTN","RAHLR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,12,10,25,71**;Mar 16, 1998;Build 10
"RTN","RAHLR",3,0)
 ;Generates msg whenever a case is registered or cancelled or examined
"RTN","RAHLR",4,0)
 ;              registered        cancelled        examined
"RTN","RAHLR",5,0)
 ; Order control : NW                CA               XO
"RTN","RAHLR",6,0)
 ; Order status  : IP                CA               CM
"RTN","RAHLR",7,0)
 ;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLR",8,0)
 S:$D(HLNDAP) ZTSAVE("HLNDAP")="" S:$D(HLDAP) ZTSAVE("HLDAP")=""
"RTN","RAHLR",9,0)
 S ZTSAVE("RADFN")="",ZTSAVE("RADTI")="",ZTSAVE("RACNI")="",ZTIO="",ZTDTH=$H,ZTDESC="Rad/Nuc Med Compiling HL7 Common Order",ZTRTN="EN^RAHLR" D ^%ZTLOAD
"RTN","RAHLR",10,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE Q
"RTN","RAHLR",11,0)
EN ; Called from the RA REG & RA CANCEL & RA EXAMINED protocols
"RTN","RAHLR",12,0)
 ; Input Variables:
"RTN","RAHLR",13,0)
 ;   RADFN=file 2 IEN (DFN)
"RTN","RAHLR",14,0)
 ;   RADTI=file 70 Exam subrec IEN (reverse date/time of exam)
"RTN","RAHLR",15,0)
 ;   RACNI=file 70 Case subrecord IEN
"RTN","RAHLR",16,0)
 ;   RAEID=ien of the event driver protocol (defined in RAHLRPC)
"RTN","RAHLR",17,0)
 ; Output Variables:
"RTN","RAHLR",18,0)
 ;   HLA("HLS") array containing HL7 msg
"RTN","RAHLR",19,0)
 ;
"RTN","RAHLR",20,0)
 N EID,HL,INT,HLQ,HLFS,HLECH,HLA
"RTN","RAHLR",21,0)
 N DFN,DIWF,DIWL,DIWR,GMRAL,PI,RACANC,RACN0,RACPT,RACPTNDE,RADTE,RAI,RAN,RAOBR4,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RAX0,VA,VADM,VAERR,X,X0,Y,X1,OBR36
"RTN","RAHLR",22,0)
 ;
"RTN","RAHLR",23,0)
 D INIT ; initialize some HL7 variables
"RTN","RAHLR",24,0)
 ;RAEXMDUN passed from EXM^RAHLRPC if conditions are met
"RTN","RAHLR",25,0)
 Q:+$G(HL)=15  ;no known client(item) linked to the event driver protocol
"RTN","RAHLR",26,0)
 Q:$O(HL(""))=""  ;disabled server appl, or no server appl
"RTN","RAHLR",27,0)
 S RACN0=$S($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)):^(0),1:"") Q:RACN0']""
"RTN","RAHLR",28,0)
 ;Generate Message Text
"RTN","RAHLR",29,0)
 S RAPROC=+$P(RACN0,U,2) I 'RAPROC Q  ;If case entered via 'Enter Last Past Visit before DHCP option, and procedure 'OTHER' is inactive, RAPROC will be null and will cause bomb-out unless we quit here
"RTN","RAHLR",30,0)
 S RAPROCIT=+$P($G(^RAMIS(71,RAPROC,0)),U,12),RAPROCIT=$P(^RA(79.2,RAPROCIT,0),U,1)
"RTN","RAHLR",31,0)
 S (RADTE,OBR36)=9999999.9999-RADTI,RADTE=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_+RACN0,RACANC=$S($D(^RA(72,"AA",RAPROCIT,0,+$P(RACN0,"^",3))):1,1:0)
"RTN","RAHLR",32,0)
 S RAPRCNDE=$G(^RAMIS(71,+RAPROC,0)),RACPT=+$P(RAPRCNDE,U,9),RACPTNDE=$$NAMCODE^RACPTMSC(RACPT,DT)
"RTN","RAHLR",33,0)
 ;Compile 'PID' Segment
"RTN","RAHLR",34,0)
 K VA,VADM,VAERR,RAVADM S DFN=RADFN D DEM^VADPT I VADM(1)']"" S HLP("ERRTEXT")="Invalid Patient Identifier" G EXIT
"RTN","RAHLR",35,0)
 S RAVADM(3)=$S($E(+VADM(3),6,7)="00":"",1:+VADM(3)) ; NOTE: Check
"RTN","RAHLR",36,0)
 ; for an inexact date of birth.  If inexact, pass null for DOB in
"RTN","RAHLR",37,0)
 ; the 'PID' segment.  Some COTS systems can't handle inexact DOB's.
"RTN","RAHLR",38,0)
 I HL("VER")']"2.2" D
"RTN","RAHLR",39,0)
 .S HLA("HLS",1)="PID"_HLFS_HLFS_$G(VA("PID"))_HLFS_$$M11^HLFNC(RADFN)_HLFS_HLFS_$$HLNAME^HLFNC(VADM(1))_HLFS_HLFS_$$HLDATE^HLFNC(RAVADM(3))_HLFS_$S(VADM(5)]"":$S("MF"[$P(VADM(5),"^"):$P(VADM(5),"^"),1:"O"),1:"U")
"RTN","RAHLR",40,0)
 .S:$P(VADM(2),"^")]"" $P(HLA("HLS",1),HLFS,20)=$P(VADM(2),"^")
"RTN","RAHLR",41,0)
 I HL("VER")]"2.2" S HLA("HLS",1)=$$EN^VAFHLPID(DFN,"2,3,5,7,8,19,20")
"RTN","RAHLR",42,0)
 K RAVADM
"RTN","RAHLR",43,0)
 ;Compile 'ORC' Segment
"RTN","RAHLR",44,0)
 S X0="" ;if exam-set or print-set, store parent name if order exists
"RTN","RAHLR",45,0)
 I $P(RACN0,U,25) S X0=$P(RACN0,U,11),X0=$P($G(^RAO(75.1,+X0,0)),U,2),X0=$P($G(^RAMIS(71,+X0,0)),U),X0=$S(X0="":"ORIGINAL ORDER PURGED",1:X0),X0=$S($P(RACN0,U,25)=1:"EXAM",1:"PRINT")_"SET: "_X0
"RTN","RAHLR",46,0)
 ; BNT - Added ORC4 Placer Group Number for Printset identification.
"RTN","RAHLR",47,0)
 ; ORC4 is a combination of SSN with the order inverted date/time.
"RTN","RAHLR",48,0)
 S RAORC4="" I $P($G(RACN0),U,25)=2 D
"RTN","RAHLR",49,0)
 . S:$P(VADM(2),"^")]"" RAORC4=$P(VADM(2),"^")
"RTN","RAHLR",50,0)
 . S RAORC4=$G(RAORC4)_RADTI
"RTN","RAHLR",51,0)
 S HLA("HLS",2)="ORC"_HLFS_$S(RACANC:"CA",$G(RAEXMDUN)=1:"XO",1:"NW")_HLFS_HLFS_HLFS_RAORC4_HLFS_$S(RACANC:"CA",$G(RAEXMDUN)=1:"CM",1:"IP")_HLFS_HLFS_HLFS_X0_HLFS_HLDT1
"RTN","RAHLR",52,0)
 ;Compile 'OBR' Segment
"RTN","RAHLR",53,0)
 S RAOBR4=$P(RACPTNDE,U)_$E(HLECH)_$P(RACPTNDE,U,2)_$E(HLECH)_"C4"_$E(HLECH)_+RAPROC_$E(HLECH)_$P(RAPRCNDE,U)_$E(HLECH)_"99RAP"
"RTN","RAHLR",54,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",55,0)
 ; S RAOBR4=$P(RACPTNDE,U)_$E(HLECH)_$$ESCAPE^RAHLRU($P(RACPTNDE,U,2))_$E(HLECH)_"C4"_$E(HLECH)_+RAPROC_$E(HLECH)_$$ESCAPE^RAHLRU($P(RAPRCNDE,U))_$E(HLECH)_"99RAP"
"RTN","RAHLR",56,0)
 I $P(RACPTNDE,U)']"" S $P(RAOBR4,$E(HLECH),1,3)=$P(RAOBR4,$E(HLECH),4,5)_$E(HLECH)_"LOCAL"
"RTN","RAHLR",57,0)
 S HLA("HLS",3)="OBR"_HLFS_HLFS_RADTE_HLFS_RADTI_"-"_RACNI_$E(HLECH)_RADTE_$E(HLECH)_"L"_HLFS_RAOBR4_HLFS_HLFS_HLFS_HLDT1
"RTN","RAHLR",58,0)
 S HLA("HLS",3)=HLA("HLS",3)_HLFS_HLQ_HLFS_HLQ_HLFS_HLFS_HLFS_HLFS_HLFS_HLQ_HLFS_HLFS
"RTN","RAHLR",59,0)
 S RAPRV=$$GET1^DIQ(200,+$P(RACN0,"^",14),.01)
"RTN","RAHLR",60,0)
 S HLA("HLS",3)=HLA("HLS",3)_$S(RAPRV]"":+$P(RACN0,"^",14)_$E(HLECH)_$$HLNAME^HLFNC(RAPRV),1:"")
"RTN","RAHLR",61,0)
 ;
"RTN","RAHLR",62,0)
 N RACN00,RA20 S RACN00=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAHLR",63,0)
 ;Seg's fld 20 = pce 21 --> ien file #79.1~name of img loc~stn #~stn name
"RTN","RAHLR",64,0)
 S RA20=+$G(^RA(79.1,+$P(RACN00,U,4),0))
"RTN","RAHLR",65,0)
 S $P(HLA("HLS",3),HLFS,21)=$P(RACN00,U,4)_$E(HLECH)_$P($G(^SC(RA20,0)),U)_$E(HLECH)_$P(RACN00,U,3)_$E(HLECH)_$P($G(^DIC(4,+$P(RACN00,U,3),0)),U)
"RTN","RAHLR",66,0)
 S $P(HLA("HLS",3),HLFS,21)=$P(HLA("HLS",3),HLFS,21)
"RTN","RAHLR",67,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",68,0)
 ; S $P(HLA("HLS",3),HLFS,21)=$$ESCAPE^RAHLRU($P(HLA("HLS",3),HLFS,21))
"RTN","RAHLR",69,0)
 ;Seg's fld 21 = pce 22 --> abbrv I-type~Img type name
"RTN","RAHLR",70,0)
 S RA20=$G(^RA(79.2,+$P(RACN00,U,2),0))
"RTN","RAHLR",71,0)
 S $P(HLA("HLS",3),HLFS,22)=$P(RA20,U,3)_$E(HLECH)_$P(RA20,U)
"RTN","RAHLR",72,0)
 S $P(HLA("HLS",3),HLFS,22)=$P(HLA("HLS",3),HLFS,22)
"RTN","RAHLR",73,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",74,0)
 ; S $P(HLA("HLS",3),HLFS,22)=$$ESCAPE^RAHLRU($P(HLA("HLS",3),HLFS,22))
"RTN","RAHLR",75,0)
 ;
"RTN","RAHLR",76,0)
 S $P(HLA("HLS",3),HLFS,23)=HLDT1,$P(HLA("HLS",3),HLFS,19)=$S($D(^DIC(42,+$P(RACN0,"^",6),0)):$P(^(0),"^"),$D(^SC(+$P(RACN0,"^",8),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAHLR",77,0)
 ;
"RTN","RAHLR",78,0)
 ; OBR-36 = Exam Date/Time
"RTN","RAHLR",79,0)
 S $P(HLA("HLS",3),HLFS,37)=$$FMTHL7^XLFDT(OBR36)
"RTN","RAHLR",80,0)
 ;
"RTN","RAHLR",81,0)
 I 'RACANC S X=$P($G(^RAO(75.1,+$P(RACN0,"^",11),0)),"^",6),$P(HLA("HLS",3),HLFS,28)=$E(HLECH)_$E(HLECH)_$E(HLECH)_$E(HLECH)_$E(HLECH)_$TR(X,"129","SAR")
"RTN","RAHLR",82,0)
 ; if long str, break so 2nd str begins with separator to avoid abend
"RTN","RAHLR",83,0)
 I $L(HLA("HLS",3))>245 N RAPART,RA1 S RA1=HLA("HLS",3) F RAPART=5:1:15 S RAPART(1)=$P(RA1,HLFS,1,RAPART),RAPART(2)=$P(RA1,HLFS,RAPART+1,99) Q:$L(RAPART(1))<245&($L(RAPART(2))<245)&($P(RAPART(2),HLFS)="")
"RTN","RAHLR",84,0)
 I $D(RAPART) K:RAPART=15 RAPART ;if RAPART reaches 15, then something's wrong so kill RAPART to allow abend due "string too long"
"RTN","RAHLR",85,0)
 I $D(RAPART) S HLA("HLS",3)=$P(RAPART(1),HLFS)_HLFS,HLA("HLS",3,1)=$P(RAPART(1),HLFS,2,99)_HLFS,HLA("HLS",3,2)=RAPART(2) K RAPART,RA1
"RTN","RAHLR",86,0)
OBXPRC ;Compile 'OBX' Segment for Procedure
"RTN","RAHLR",87,0)
 S RAN=4 D OBXPRC^RAHLRU
"RTN","RAHLR",88,0)
OBXMOD ;Compile 'OBX' Segment for two types of Modifiers
"RTN","RAHLR",89,0)
 S RAN=5 D OBXMOD^RAHLRU
"RTN","RAHLR",90,0)
OBXHIST ;Compile 'OBX' Segment for Clinical History
"RTN","RAHLR",91,0)
 I '$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",0)) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"H"_$E(HLECH)_"HISTORY"_$E(HLECH)_"L"_HLFS_HLFS_"None Entered" D OBX11^RAHLRU G ALLER
"RTN","RAHLR",92,0)
 K ^UTILITY($J,"W") S DIWF="",DIWR=80,DIWL=1 F RAI=0:0 S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAI)) Q:'RAI  I $D(^(RAI,0)) S X=^(0) D ^DIWP
"RTN","RAHLR",93,0)
 F RAI=0:0 S RAI=$O(^UTILITY($J,"W",DIWL,RAI)) Q:'RAI  I $D(^(RAI,0)) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"H"_$E(HLECH)_"HISTORY"_$E(HLECH)_"L"_HLFS_HLFS_^(0) D OBX11^RAHLRU
"RTN","RAHLR",94,0)
ALLER ;Compile 'OBX' Segment for Allergies
"RTN","RAHLR",95,0)
 S DFN=RADFN D ALLERGY^RADEM S X="" I $D(GMRAL) S RAI=0 F  S RAI=$O(PI(RAI)) Q:RAI'>0  S X0=PI(RAI) I X0]"" Q:($L(X)+$L(X0))>200  S X=X_X0_", "
"RTN","RAHLR",96,0)
 I $L(X) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"A"_$E(HLECH)_"ALLERGIES"_$E(HLECH)_"L"_HLFS_HLFS_X D OBX11^RAHLRU
"RTN","RAHLR",97,0)
OBXTCM ;Compile 'OBX' Segment for Tech Comment
"RTN","RAHLR",98,0)
 D OBXTCM^RAHLRU
"RTN","RAHLR",99,0)
EXIT ; set HL7 message type & return to protocol
"RTN","RAHLR",100,0)
 K ^UTILITY($J,"W")
"RTN","RAHLR",101,0)
 S HL("MTN")="ORM"
"RTN","RAHLR",102,0)
 N HLEID,HLARYTYP,HLFORMAT,HLMTIEN,HLP
"RTN","RAHLR",103,0)
 S HLEID=EID,HLARYTYP="LM",HLFORMAT=1,HLMTIEN="",HLP("PRIORITY")="I"
"RTN","RAHLR",104,0)
 D GENERATE^HLMA(HLEID,HLARYTYP,HLFORMAT,.HLRESLT,HLMTIEN,.HLP)
"RTN","RAHLR",105,0)
 Q
"RTN","RAHLR",106,0)
Q ;Entry Point to Process an ORR Message (Just a Quit Since No Processing is Required)
"RTN","RAHLR",107,0)
 Q
"RTN","RAHLR",108,0)
INIT ; initialize HL7 variables
"RTN","RAHLR",109,0)
 D NOW^%DTC S HLDT=%,HLDT1=$$HLDATE^HLFNC(%)
"RTN","RAHLR",110,0)
 Q:'$G(RAEID)  S EID=RAEID
"RTN","RAHLR",111,0)
 S HL="HLS(""HLS"")",INT=1
"RTN","RAHLR",112,0)
 D INIT^HLFNC2(EID,.HL,INT)
"RTN","RAHLR",113,0)
 Q:'$D(HL("Q"))  ;no server application defined
"RTN","RAHLR",114,0)
 S HLQ=HL("Q"),HLFS=HL("FS"),HLECH=HL("ECH")
"RTN","RAHLR",115,0)
 Q
"RTN","RAHLRPC")
0^6^B2725117^B6387845
"RTN","RAHLRPC",1,0)
RAHLRPC ;HIRMFO/BNT-Rad/NM HL7 Protocol calls ;05/21/99   14:50
"RTN","RAHLRPC",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**12,25,54,71**;Mar 16, 1998;Build 10
"RTN","RAHLRPC",3,0)
 ; 03/16/2006 *71 Rem Call 124379 allow exam updates to create HL7 msg
"RTN","RAHLRPC",4,0)
REG ; register exam
"RTN","RAHLRPC",5,0)
 N X,RAPID,RAEID
"RTN","RAHLRPC",6,0)
 S RAPID="RA REF" ; get all protocols beginning RA REG
"RTN","RAHLRPC",7,0)
 F  S RAPID=$O(^ORD(101,"B",RAPID)) Q:RAPID'["RA REG"  D
"RTN","RAHLRPC",8,0)
 .S RAEID=$O(^ORD(101,"B",RAPID,0))
"RTN","RAHLRPC",9,0)
 .I RAEID,'$L($P(^ORD(101,RAEID,0),"^",3)) D EN^RAHLR
"RTN","RAHLRPC",10,0)
 Q
"RTN","RAHLRPC",11,0)
CANCEL ; cancel exam
"RTN","RAHLRPC",12,0)
 N X,RAPID,RAEID
"RTN","RAHLRPC",13,0)
 S RAPID="RA CANCEK" ; get all protocols beginning RA CANCEL
"RTN","RAHLRPC",14,0)
 F  S RAPID=$O(^ORD(101,"B",RAPID)) Q:RAPID'["RA CANCEL"  D
"RTN","RAHLRPC",15,0)
 .S RAEID=$O(^ORD(101,"B",RAPID,0))
"RTN","RAHLRPC",16,0)
 .I RAEID,'$L($P(^ORD(101,RAEID,0),"^",3)) D EN^RAHLR
"RTN","RAHLRPC",17,0)
 Q
"RTN","RAHLRPC",18,0)
RPT ; report verified or released/not verified
"RTN","RAHLRPC",19,0)
 N X,RAPID,RAEID
"RTN","RAHLRPC",20,0)
 S RAPID="RA RPS" ; get all protocols beginning RA RPT
"RTN","RAHLRPC",21,0)
 F  S RAPID=$O(^ORD(101,"B",RAPID)) Q:RAPID'["RA RPT"  D
"RTN","RAHLRPC",22,0)
 .S RAEID=$O(^ORD(101,"B",RAPID,0))
"RTN","RAHLRPC",23,0)
 .I RAEID,'$L($P(^ORD(101,RAEID,0),"^",3)) D EN^RAHLRPT
"RTN","RAHLRPC",24,0)
 Q
"RTN","RAHLRPC",25,0)
 ;
"RTN","RAHLRPC",26,0)
EXM ;Examined case; called from RAUTL1 and RASTED after a case has been
"RTN","RAHLRPC",27,0)
 ;edited. Generate an ORM message whenever an exam is edited. New logic
"RTN","RAHLRPC",28,0)
 ;introduced with RA*5*71...originally developed for RA*5*47
"RTN","RAHLRPC",29,0)
 ;
"RTN","RAHLRPC",30,0)
1 N RAEXMDUN
"RTN","RAHLRPC",31,0)
 S RAEXMDUN=1
"RTN","RAHLRPC",32,0)
A1 N X,RAPID,RAEID
"RTN","RAHLRPC",33,0)
 S RAPID="RA EXAMINEC" ; get all protocols beginning RA EXAMINED
"RTN","RAHLRPC",34,0)
 F  S RAPID=$O(^ORD(101,"B",RAPID)) Q:RAPID'["RA EXAMINED"  D
"RTN","RAHLRPC",35,0)
 .S RAEID=$O(^ORD(101,"B",RAPID,0))
"RTN","RAHLRPC",36,0)
 .I RAEID,'$L($P(^ORD(101,RAEID,0),"^",3)) D EN^RAHLR
"RTN","RAHLRPC",37,0)
 Q
"RTN","RAHLRS")
0^4^B11033463^B11132546
"RTN","RAHLRS",1,0)
RAHLRS ;HIRMFO/CRT/PDW - Resend HL7 messages for selected cases ;Mar 16, 1998
"RTN","RAHLRS",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**25,54,60,71**;Mar 16, 1998;Build 10
"RTN","RAHLRS",3,0)
 ;
"RTN","RAHLRS",4,0)
 ; Utility to RESEND HL7 messages
"RTN","RAHLRS",5,0)
 ;
"RTN","RAHLRS",6,0)
 ;;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLRS",7,0)
 N RACNI,RADFN,RADTI,RARPT,X
"RTN","RAHLRS",8,0)
 ;
"RTN","RAHLRS",9,0)
 D SETVARS Q:$G(RAIMGTY)=""
"RTN","RAHLRS",10,0)
 ;
"RTN","RAHLRS",11,0)
 F  S X=$$RACNLU(.RADFN,.RADTI,.RACNI) Q:+X'>0  D  Q:QUIT<0
"RTN","RAHLRS",12,0)
 .D RESEND(RADFN,RADTI,RACNI,.QUIT)
"RTN","RAHLRS",13,0)
 Q
"RTN","RAHLRS",14,0)
 ;
"RTN","RAHLRS",15,0)
RACNLU(RADFN,RADTI,RACNI) ; Select Case Number
"RTN","RAHLRS",16,0)
 ;
"RTN","RAHLRS",17,0)
 N RANOSCRN S RANOSCRN="" ; Don't limit cases to current Imaging Type
"RTN","RAHLRS",18,0)
 S (RADFN,RADTI,RADFN)=""
"RTN","RAHLRS",19,0)
 D ^RACNLU
"RTN","RAHLRS",20,0)
 Q X
"RTN","RAHLRS",21,0)
 ;
"RTN","RAHLRS",22,0)
RESEND(RADFN,RADTI,RACNI,QUIT) ; re-send exam message(s) to HL7 subscribers
"RTN","RAHLRS",23,0)
 ;
"RTN","RAHLRS",24,0)
 N RAED
"RTN","RAHLRS",25,0)
 ;
"RTN","RAHLRS",26,0)
 S QUIT=0
"RTN","RAHLRS",27,0)
 I '$D(DT) D ^%DT S DT=Y
"RTN","RAHLRS",28,0)
 ;
"RTN","RAHLRS",29,0)
 S RAED=$$RAED(RADFN,RADTI,RACNI)
"RTN","RAHLRS",30,0)
 S QUIT=$$OK(RADFN,RADTI,RACNI)
"RTN","RAHLRS",31,0)
 I QUIT>0 D
"RTN","RAHLRS",32,0)
 .I RAED[",REG," D
"RTN","RAHLRS",33,0)
 ..D EN^DDIOL("Re-sending 'EXAM REGISTERD' HL7 message...",,"!!,?6")
"RTN","RAHLRS",34,0)
 ..D REG^RAHLRPC
"RTN","RAHLRS",35,0)
 .I RAED[",CANCEL," D
"RTN","RAHLRS",36,0)
 ..D EN^DDIOL("Re-sending 'EXAM CANCELLED' HL7 message...",,"!,?6")
"RTN","RAHLRS",37,0)
 ..D CANCEL^RAHLRPC
"RTN","RAHLRS",38,0)
 .I RAED[",EXAM," D
"RTN","RAHLRS",39,0)
 ..D EN^DDIOL("Re-sending 'EXAMINED' HL7 message...",,"!,?6")
"RTN","RAHLRS",40,0)
 ..N RAEXMDUN D 1^RAHLRPC ;*60 Newed RAEXMDUN to prevent variable leak
"RTN","RAHLRS",41,0)
 .I RAED[",RPT," D
"RTN","RAHLRS",42,0)
 ..D EN^DDIOL("Re-sending 'REPORT VERIFIED' HL7 message...",,"!,?6")
"RTN","RAHLRS",43,0)
 ..D RPT^RAHLRPC
"RTN","RAHLRS",44,0)
 Q
"RTN","RAHLRS",45,0)
 ;
"RTN","RAHLRS",46,0)
RAED(RADFN,RADTI,RACNI) ; identify correct ^RAHLRPC entry point(s)
"RTN","RAHLRS",47,0)
 ;
"RTN","RAHLRS",48,0)
 N RASTAT,RAIMTYP,RAORD,RETURN,RARPST
"RTN","RAHLRS",49,0)
 S (RARPST,RASTAT)=""
"RTN","RAHLRS",50,0)
 ;
"RTN","RAHLRS",51,0)
 S RETURN=",REG,"
"RTN","RAHLRS",52,0)
 ;
"RTN","RAHLRS",53,0)
 S RASTAT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3,"I")
"RTN","RAHLRS",54,0)
 ;
"RTN","RAHLRS",55,0)
 S RAIMTYP=$$GET1^DIQ(72,+RASTAT,7)
"RTN","RAHLRS",56,0)
 S RAORD=$$GET1^DIQ(72,+RASTAT,3)
"RTN","RAHLRS",57,0)
 ;
"RTN","RAHLRS",58,0)
 S:RAORD=0 RETURN=RETURN_"CANCEL,"
"RTN","RAHLRS",59,0)
 ;
"RTN","RAHLRS",60,0)
 I $$GET1^DIQ(72,+RASTAT,8)="YES" D  ; Generate Examined HL7 Message
"RTN","RAHLRS",61,0)
 .S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",62,0)
 ;
"RTN","RAHLRS",63,0)
 I RETURN'[",EXAM," D
"RTN","RAHLRS",64,0)
 .; also check previous statuses for 'Generate Examined HL7 Message'
"RTN","RAHLRS",65,0)
 .F  S RAORD=$O(^RA(72,"AA",RAIMTYP,RAORD),-1) Q:+RAORD<1  D  Q:RETURN[",EXAM,"
"RTN","RAHLRS",66,0)
 ..S RASTAT=$O(^RA(72,"AA",RAIMTYP,RAORD,0))
"RTN","RAHLRS",67,0)
 ..I $$GET1^DIQ(72,+RASTAT,8)="YES" S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",68,0)
 ;
"RTN","RAHLRS",69,0)
 I RARPT]"" D  ; Check if Verified Report exists
"RTN","RAHLRS",70,0)
 .S RARPST=$$GET1^DIQ(74,RARPT,5,"I")
"RTN","RAHLRS",71,0)
 .I RARPST="V" S RETURN=RETURN_"RPT,"
"RTN","RAHLRS",72,0)
 ;
"RTN","RAHLRS",73,0)
 Q RETURN
"RTN","RAHLRS",74,0)
 ;
"RTN","RAHLRS",75,0)
OK(RADFN,RADTI,RACNI) ; Get User to confirm continue
"RTN","RAHLRS",76,0)
 ;
"RTN","RAHLRS",77,0)
 N X,RAEXST
"RTN","RAHLRS",78,0)
 ;
"RTN","RAHLRS",79,0)
 S RAEXST=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3)
"RTN","RAHLRS",80,0)
 ;
"RTN","RAHLRS",81,0)
 S X="",$P(X,"=",70)=""
"RTN","RAHLRS",82,0)
 D EN^DDIOL(X,"","!?5")
"RTN","RAHLRS",83,0)
 S DIR("A")="Re-send all HL7 messages for this '"_RAEXST_"' case?"
"RTN","RAHLRS",84,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","RAHLRS",85,0)
 I Y="^" Q -1
"RTN","RAHLRS",86,0)
 Q Y
"RTN","RAHLRS",87,0)
 ;
"RTN","RAHLRS",88,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAHLRS",89,0)
 ;
"RTN","RAHLRS",90,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAHLRS",91,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAHLRS",92,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAHLRS",93,0)
 Q
"RTN","RAHLTCPB")
0^7^B57781715^B56853424
"RTN","RAHLTCPB",1,0)
RAHLTCPB ;HIRMFO/REL,GJC,BNT - Rad/Nuc Med HL7 TCP/IP Bridge;05/21/99
"RTN","RAHLTCPB",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**12,17,25,51,71**;Mar 16, 1998;Build 10
"RTN","RAHLTCPB",3,0)
 ; 07/05/2006 BAY/KAM Remedy Call 124379 Eliminate unneeded ORM msgs
"RTN","RAHLTCPB",4,0)
EN1 ; Build the ^TMP("RARPT-REC" global when we receive the
"RTN","RAHLTCPB",5,0)
 ; 07/05/2006 Remedy Call 124379 message from HL7. If RAHLTCPB is defined, do not broadcast ORM messages. As of the writing
"RTN","RAHLTCPB",6,0)
 ; of patch 71, RAHLTCPB is referenced in RAHLTCPB, UPSTAT^RAUTL0, & UP2^RAUTL1
"RTN","RAHLTCPB",7,0)
 S RASUB=HL("MID"),RAHLTCPB=1 K RAERR
"RTN","RAHLTCPB",8,0)
 K ^TMP("RARPT-HL7",$J) ; clean area that holds data from HL7
"RTN","RAHLTCPB",9,0)
 K ^TMP("RARPT-REC",$J,RASUB) ; kill storage area for new HL7 message id
"RTN","RAHLTCPB",10,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RADATE")=$$DT^XLFDT()
"RTN","RAHLTCPB",11,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  S ^TMP("RARPT-HL7",$J,I)=HLNODE,J=0 F  S J=$O(HLNODE(J)) Q:'J  S ^TMP("RARPT-HL7",$J,I,J)=HLNODE(J)
"RTN","RAHLTCPB",12,0)
 S CNT=2,SEGMNT=$G(^TMP("RARPT-HL7",$J,CNT))
"RTN","RAHLTCPB",13,0)
 S VNDR=$G(HL("SAN"))
"RTN","RAHLTCPB",14,0)
 S ^TMP("RARPT-REC",$J,RASUB,"VENDOR")=$G(HL("SAN"))
"RTN","RAHLTCPB",15,0)
PID ; Pick data off the 'PID' segment.
"RTN","RAHLTCPB",16,0)
 I $P(SEGMNT,HL("FS"))="PID" D
"RTN","RAHLTCPB",17,0)
 . S SEGMNT=$P(SEGMNT,HL("FS"),2,99999)
"RTN","RAHLTCPB",18,0)
 . I $P($P(SEGMNT,HL("FS"),3),$E(HL("ECH")))]"" D
"RTN","RAHLTCPB",19,0)
 .. S ^TMP("RARPT-REC",$J,RASUB,"RADFN")=$P($P(SEGMNT,HL("FS"),3),$E(HL("ECH")))
"RTN","RAHLTCPB",20,0)
 .. Q
"RTN","RAHLTCPB",21,0)
 . I $P(SEGMNT,HL("FS"),19)]"" D
"RTN","RAHLTCPB",22,0)
 .. S ^TMP("RARPT-REC",$J,RASUB,"RASSN")=$P(SEGMNT,HL("FS"),19)
"RTN","RAHLTCPB",23,0)
 .. Q
"RTN","RAHLTCPB",24,0)
 . Q
"RTN","RAHLTCPB",25,0)
 E  S RAERR="Missing PID segment" D XIT Q
"RTN","RAHLTCPB",26,0)
 I '(+$G(^TMP("RARPT-REC",$J,RASUB,"RADFN"))) D  Q
"RTN","RAHLTCPB",27,0)
 .S RAERR="Invalid Patient ID"
"RTN","RAHLTCPB",28,0)
 .D XIT
"RTN","RAHLTCPB",29,0)
 ; Save off E-Sig information (if it exists)
"RTN","RAHLTCPB",30,0)
 S:$D(HL("ESIG")) ^TMP("RARPT-REC",$J,RASUB,"RAESIG")=HL("ESIG")
"RTN","RAHLTCPB",31,0)
 ;
"RTN","RAHLTCPB",32,0)
OBR ; Pick data off the 'OBR' segment.
"RTN","RAHLTCPB",33,0)
 K SEGMNT F  S CNT=$O(^TMP("RARPT-HL7",$J,CNT)) Q:CNT=""  S SEGMNT=$G(^(CNT)) Q:$P(SEGMNT,HL("FS"))="OBR"  ; find the 'OBR' segment
"RTN","RAHLTCPB",34,0)
 I $P($G(SEGMNT),HL("FS"))'="OBR" S RAERR="Missing OBR segment" D XIT Q
"RTN","RAHLTCPB",35,0)
 S SEGMNT=$P(SEGMNT,HL("FS"),2,99999)
"RTN","RAHLTCPB",36,0)
 I $P(SEGMNT,HL("FS"),3)]"" D
"RTN","RAHLTCPB",37,0)
 . N RADTCN S RADTCN=$P(SEGMNT,HL("FS"),3)
"RTN","RAHLTCPB",38,0)
 . S:$P($P(RADTCN,$E(HL("ECH"))),"-")]"" ^TMP("RARPT-REC",$J,RASUB,"RADTI")=$P($P(RADTCN,$E(HL("ECH"))),"-")
"RTN","RAHLTCPB",39,0)
 . S:$P($P(RADTCN,$E(HL("ECH"))),"-",2)]"" ^TMP("RARPT-REC",$J,RASUB,"RACNI")=$P($P(RADTCN,$E(HL("ECH"))),"-",2)
"RTN","RAHLTCPB",40,0)
 . S:$P(RADTCN,$E(HL("ECH")),2)["&L" RADTCN=$TR(RADTCN,"&","^")
"RTN","RAHLTCPB",41,0)
 . S:$P(RADTCN,$E(HL("ECH")),2)]"" ^TMP("RARPT-REC",$J,RASUB,"RALONGCN")=$P(RADTCN,$E(HL("ECH")),2)
"RTN","RAHLTCPB",42,0)
 . Q
"RTN","RAHLTCPB",43,0)
 S RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,25,HL("FS")) K RAHL70
"RTN","RAHLTCPB",44,0)
 I RAHLD="" S RAERR="Missing Report Status" D XIT Q
"RTN","RAHLTCPB",45,0)
 I "AFR"'[RAHLD S RAERR="Invalid Report Status" D XIT Q
"RTN","RAHLTCPB",46,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RASTAT")=RAHLD
"RTN","RAHLTCPB",47,0)
 S RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,32,HL("FS")) K RAHL70
"RTN","RAHLTCPB",48,0)
 I RAHLD']"" S RAERR="Missing Provider ID" D XIT Q
"RTN","RAHLTCPB",49,0)
 S RAVERF=RAHLD
"RTN","RAHLTCPB",50,0)
 ; -----   Check the validity of the provider name   -----
"RTN","RAHLTCPB",51,0)
 I '$D(^VA(200,"B",RAVERF)) D  ; check for a partial match in file 200
"RTN","RAHLTCPB",52,0)
 . D VFIER ; if one partial match found, return the entry ien
"RTN","RAHLTCPB",53,0)
 . Q
"RTN","RAHLTCPB",54,0)
 E  D  ; $D(^VA(200,"B",RAVERF)) true, get the entry ien
"RTN","RAHLTCPB",55,0)
 . S RAVERF=$O(^VA(200,"B",RAVERF,0))
"RTN","RAHLTCPB",56,0)
 . S:'RAVERF RAERR="Invalid Provider Name"
"RTN","RAHLTCPB",57,0)
 . Q
"RTN","RAHLTCPB",58,0)
 I $D(RAERR) D XIT Q
"RTN","RAHLTCPB",59,0)
 ; can't get resident info from medspeak
"RTN","RAHLTCPB",60,0)
 S RAHLD="",RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,33,HL("FS")),RARSDNT="" K RAHL70
"RTN","RAHLTCPB",61,0)
 I RAHLD]"" D
"RTN","RAHLTCPB",62,0)
 . S RARSDNT=$P(RAHLD,$E(HL("ECH"),4)) I '$D(^VA(200,+RARSDNT,0)) S RARSDNT=""
"RTN","RAHLTCPB",63,0)
 S RAHLD="",RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,35,HL("FS")),RATRSCRP="" K RAHL70
"RTN","RAHLTCPB",64,0)
 I RAHLD]"" D
"RTN","RAHLTCPB",65,0)
 . S RATRSCRP=$P(RAHLD,$E(HL("ECH"),4)) I '$D(^VA(200,+RATRSCRP,0)) S RATRSCRP=""
"RTN","RAHLTCPB",66,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RAVERF")=RAVERF
"RTN","RAHLTCPB",67,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RATRANSCRIPT")=$S(RATRSCRP]"":RATRSCRP,RARSDNT]"":RARSDNT,1:RAVERF)
"RTN","RAHLTCPB",68,0)
 S:$G(RARSDNT) ^TMP("RARPT-REC",$J,RASUB,"RARESIDENT")=RARSDNT
"RTN","RAHLTCPB",69,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RASTAFF")=RAVERF,^("RAWHOCHANGE")=RAVERF
"RTN","RAHLTCPB",70,0)
 D ESIG
"RTN","RAHLTCPB",71,0)
 K RAHLD,RARSDNT,RATRSCRP
"RTN","RAHLTCPB",72,0)
 ;
"RTN","RAHLTCPB",73,0)
OBX ; Pick data off the 'OBX' segments
"RTN","RAHLTCPB",74,0)
 K SEGMNT F  S CNT=$O(^TMP("RARPT-HL7",$J,CNT)) Q:CNT=""  S SEGMNT=$G(^(CNT)) D:$P(SEGMNT,HL("FS"))="OBX"  Q:$D(RAERR)
"RTN","RAHLTCPB",75,0)
 . S SEGMNT=$P(SEGMNT,HL("FS"),2,9999)
"RTN","RAHLTCPB",76,0)
 . I $P(SEGMNT,HL("FS"),3)']"" S RAERR="Missing Observation Identifier" Q
"RTN","RAHLTCPB",77,0)
 . S OBXTYP=$P(SEGMNT,HL("FS"),3),OBXTYP=$E(OBXTYP,$F(OBXTYP,"&"))
"RTN","RAHLTCPB",78,0)
 . S OBX2CE=""
"RTN","RAHLTCPB",79,0)
 . S:OBXTYP="" OBXTYP=" "
"RTN","RAHLTCPB",80,0)
 . I OBXTYP=" "&($P(SEGMNT,HL("FS"),2)="CE") D
"RTN","RAHLTCPB",81,0)
 . . I $P(SEGMNT,HL("FS"),5)=" " S OBXTYP="F" Q
"RTN","RAHLTCPB",82,0)
 . . S OBX2CE=1,OBXTYP="D" Q
"RTN","RAHLTCPB",83,0)
 . I "IDRF"'[OBXTYP S RAERR="Invalid Observation Identifier" Q
"RTN","RAHLTCPB",84,0)
 . D RPT Q
"RTN","RAHLTCPB",85,0)
XIT I $D(RAERR) D EN1^RAHLEXF,GENACK G XIT1
"RTN","RAHLTCPB",86,0)
 I $D(^TMP("RARPT-REC",$J)) D EN1^RAHLO I $D(RAERR) D EN1^RAHLEXF,GENACK
"RTN","RAHLTCPB",87,0)
XIT1 K ^TMP("RARPT-REC",$J) ; kill storage area for current HL7 message id
"RTN","RAHLTCPB",88,0)
 K ^TMP("RARPT-HL7",$J) ; clean up HL7 storage
"RTN","RAHLTCPB",89,0)
 K CNT,OBXTYPE,X1,LIN,RADATE,RADTCN,RAERR,RAESIG,RAHLD,RAHLTCPB,RANODE,RARCNT
"RTN","RAHLTCPB",90,0)
 K RAVERF,RASUB,SEGMNT,VNDR,MSA1,OBX2CE,RADX,RADX1,RADX2,RADX3
"RTN","RAHLTCPB",91,0)
 Q
"RTN","RAHLTCPB",92,0)
RPT ; Save off Report Text data.
"RTN","RAHLTCPB",93,0)
 N RAXADEDN
"RTN","RAHLTCPB",94,0)
 S RAXADEDN=^TMP("RARPT-REC",$J,RASUB,"RASTAT")
"RTN","RAHLTCPB",95,0)
 S RANODE=$S(OBXTYP="D":"RADX",OBXTYP="I":"RAIMP",1:"RATXT"),LIN=""
"RTN","RAHLTCPB",96,0)
 I OBX2CE D  Q
"RTN","RAHLTCPB",97,0)
 . S X=$P(SEGMNT,HL("FS"),5),RADX1=$P(X,$E(HL("ECH")))
"RTN","RAHLTCPB",98,0)
 . S LIN=RADX1,L=999 D P2 S LIN=X
"RTN","RAHLTCPB",99,0)
 . Q:X'["~"  F J=0:0 S J=$O(^TMP("RARPT-HL7",$J,CNT,J)) Q:'J  S X1=^(J),LIN=LIN_X1 Q
"RTN","RAHLTCPB",100,0)
 . S RADX=LIN,RADX2=$P($P(RADX,"~",2),"^") S:RADX2]"" LIN=RADX2 D P2
"RTN","RAHLTCPB",101,0)
 . S RADX3=$P($P(RADX,"~",3),"^") Q:RADX3']""  S LIN=RADX3 D P2 Q
"RTN","RAHLTCPB",102,0)
 S X=$P(SEGMNT,HL("FS"),5)
"RTN","RAHLTCPB",103,0)
 I X["\S\"!(X["\R\")!(X["\E\")!(X["\T\") D FORMAT
"RTN","RAHLTCPB",104,0)
 D PAR
"RTN","RAHLTCPB",105,0)
 F J=0:0 S J=$O(^TMP("RARPT-HL7",$J,CNT,J)) Q:'J  S X1=^(J),X=$E(X1,1,125) D PAR I $L(X1)>125 S X=$E(X1,126,999) D PAR
"RTN","RAHLTCPB",106,0)
 I X=""!(LIN'="") S L=999 D P2
"RTN","RAHLTCPB",107,0)
 Q
"RTN","RAHLTCPB",108,0)
FORMAT ; Format report text for Escape Character delimited codes.
"RTN","RAHLTCPB",109,0)
 S Y=X N T,Q
"RTN","RAHLTCPB",110,0)
 I Y["\S\" S Q=$F(Y,"\S\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"))_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",111,0)
 I Y["\R\" S Q=$F(Y,"\R\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),2)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",112,0)
 I Y["\E\" S Q=$F(Y,"\E\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),3)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",113,0)
 I Y["\T\" S Q=$F(Y,"\T\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),4)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",114,0)
 I X["\S\"!(X["\R\")!(X["\E\")!(X["\T\") D FORMAT
"RTN","RAHLTCPB",115,0)
 Q
"RTN","RAHLTCPB",116,0)
PAR ; Build text paragraph
"RTN","RAHLTCPB",117,0)
 S LIN=LIN_X
"RTN","RAHLTCPB",118,0)
P1 I $L(LIN)<80 Q
"RTN","RAHLTCPB",119,0)
 F L=80:-1:1 Q:$E(LIN,L)=" "
"RTN","RAHLTCPB",120,0)
 D P2 S LIN=$E(LIN,L+1,999) G P1
"RTN","RAHLTCPB",121,0)
P2 ; Set node
"RTN","RAHLTCPB",122,0)
 ; If Addendum and Report text is a space don't process
"RTN","RAHLTCPB",123,0)
 I $P(SEGMNT,HL("FS"),1)=1,RAXADEDN="A",RANODE="RATXT",$E(LIN,1,L-1)=" " Q
"RTN","RAHLTCPB",124,0)
 S RARCNT(OBXTYP)=$G(RARCNT(OBXTYP))+1
"RTN","RAHLTCPB",125,0)
 S ^TMP("RARPT-REC",$J,RASUB,RANODE,RARCNT(OBXTYP))=$E(LIN,1,L-1) Q
"RTN","RAHLTCPB",126,0)
 ;
"RTN","RAHLTCPB",127,0)
GENACK ; Compile the 'ACK' segment, generate the 'ACK' message.
"RTN","RAHLTCPB",128,0)
 S MSA1="AA"
"RTN","RAHLTCPB",129,0)
 Q:$E($G(VNDR),1,3)'="RA-"  ; Don't allow non RA namespaced interfaces
"RTN","RAHLTCPB",130,0)
 I $D(RAERR) S MSA1=$S(VNDR="RA-PSCRIBE-TCP":"AE",1:"AR")
"RTN","RAHLTCPB",131,0)
 ; Added next line to support MedSpeak interface.  Must re-initialize
"RTN","RAHLTCPB",132,0)
 ; FS and EC's before sending ACK.
"RTN","RAHLTCPB",133,0)
 D:VNDR="RA-CLIENT-TCP" INIT^HLFNC2("RA VOICE TCP SERVER RPT",.HL)
"RTN","RAHLTCPB",134,0)
 S HLA("HLA",1)="MSA"_HL("FS")_MSA1_HL("FS")_HL("MID")_$S($D(RAERR):HL("FS")_RAERR,1:"")
"RTN","RAHLTCPB",135,0)
 ; 06/22/2006 KAM CHANGED NEXT TWO LINES FOR RA*5*71
"RTN","RAHLTCPB",136,0)
 S HLEID=HL("EID"),HLEIDS=HL("EIDS"),HLARYTYP="LM",HLFORMAT=1
"RTN","RAHLTCPB",137,0)
 K HLRESLT D GENACK^HLMA1(HLEID,HLMTIENS,HLEIDS,HLARYTYP,HLFORMAT)
"RTN","RAHLTCPB",138,0)
 Q
"RTN","RAHLTCPB",139,0)
VFIER ; Check if the RAVERF string is a partial match to an entry in file
"RTN","RAHLTCPB",140,0)
 ; 200.  If if is, check to see that is a partial match to only ONE
"RTN","RAHLTCPB",141,0)
 ; active provider entry in file 200.
"RTN","RAHLTCPB",142,0)
 I '$L(RAVERF) S RAERR="Missing Provider information" Q
"RTN","RAHLTCPB",143,0)
 K RAVCNT,RAVIEN,RAVLGTH,RAVPS
"RTN","RAHLTCPB",144,0)
 S RAVLGTH=$L(RAVERF) ; length of the RAVERF string
"RTN","RAHLTCPB",145,0)
 S RAVCNT=0,RAVS1=RAVERF,RAVIEN=""
"RTN","RAHLTCPB",146,0)
 F  S RAVS1=$O(^VA(200,"B",RAVS1)) Q:RAVS1=""!($E(RAVS1,1,RAVLGTH)'=RAVERF)  D  Q:RAVCNT>1
"RTN","RAHLTCPB",147,0)
 . ; return subscripts that have the RAVERF string as the first
"RTN","RAHLTCPB",148,0)
 . ; 1 - RAVLGTH chars of RAVS1
"RTN","RAHLTCPB",149,0)
 . S RAVIEN=0
"RTN","RAHLTCPB",150,0)
 . F  S RAVIEN=$O(^VA(200,"B",RAVS1,RAVIEN)) Q:RAVIEN'>0  D  Q:RAVCNT>1
"RTN","RAHLTCPB",151,0)
 .. S RAVPS=$G(^VA(200,RAVIEN,"PS"))
"RTN","RAHLTCPB",152,0)
 .. S:'$P(RAVPS,"^",4)!($P(RAVPS,"^",4)>DT) RAVCNT=RAVCNT+1
"RTN","RAHLTCPB",153,0)
 .. I RAVCNT=1,('$D(RAVIEN(RAVCNT))#2) S RAVIEN(RAVCNT)=RAVIEN ; when
"RTN","RAHLTCPB",154,0)
 .. ; we find the first active provider save the provider ien off
"RTN","RAHLTCPB",155,0)
 .. ; in a local array.
"RTN","RAHLTCPB",156,0)
 .. Q
"RTN","RAHLTCPB",157,0)
 . Q
"RTN","RAHLTCPB",158,0)
 ; Added for PowerScribe
"RTN","RAHLTCPB",159,0)
 I RAVIEN']"" D
"RTN","RAHLTCPB",160,0)
 . S RAVIEN=$P(RAVERF,$E(HL("ECH"),4))
"RTN","RAHLTCPB",161,0)
 . S RAVPS=$G(^VA(200,RAVIEN,"PS"))
"RTN","RAHLTCPB",162,0)
 . S:'$P(RAVPS,"^",4)!($P(RAVPS,"^",4)>DT) RAVCNT=RAVCNT+1
"RTN","RAHLTCPB",163,0)
 . I RAVCNT=1,('$D(RAVIEN(RAVCNT))#2) S RAVIEN(RAVCNT)=RAVIEN
"RTN","RAHLTCPB",164,0)
 . Q
"RTN","RAHLTCPB",165,0)
 I RAVCNT=0 S RAERR="Invalid Provider Name" Q  ; partial match not found
"RTN","RAHLTCPB",166,0)
 I RAVCNT>1 S RAERR="Non-Unique Provider Name" Q  ; >1 partial match
"RTN","RAHLTCPB",167,0)
 S RAVERF=$G(RAVIEN(1)) S:'RAVERF RAERR="Provider Name Entry Error"
"RTN","RAHLTCPB",168,0)
 K RAVCNT,RAVIEN,RAVLGTH,RAVPS
"RTN","RAHLTCPB",169,0)
 Q
"RTN","RAHLTCPB",170,0)
 ;
"RTN","RAHLTCPB",171,0)
ESIG ; Added for COTS E-Sig capability
"RTN","RAHLTCPB",172,0)
 ;
"RTN","RAHLTCPB",173,0)
 I $D(RAERR) D XIT Q
"RTN","RAHLTCPB",174,0)
 Q:"FA"'[^TMP("RARPT-REC",$J,RASUB,"RASTAT")!('$D(^("RAVERF")))!($D(^("RAESIG")))
"RTN","RAHLTCPB",175,0)
 S RADFN=+$G(^TMP("RARPT-REC",$J,RASUB,"RADFN"))
"RTN","RAHLTCPB",176,0)
 S RADTI=+$G(^TMP("RARPT-REC",$J,RASUB,"RADTI"))
"RTN","RAHLTCPB",177,0)
 S RADIV=$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",3)
"RTN","RAHLTCPB",178,0)
 Q:RADIV=""  ; exam has been deleted - will be rejected
"RTN","RAHLTCPB",179,0)
 ; Check division parameters for ALLOW E-SIG ON COTS REPORT in file 79
"RTN","RAHLTCPB",180,0)
 ; for the division that ordered this procedure.
"RTN","RAHLTCPB",181,0)
 I $P(^RA(79,RADIV,.1),"^",27)["Y" D
"RTN","RAHLTCPB",182,0)
 . S RAESIG=$$GET1^DIQ(200,RAVERF,20.2)
"RTN","RAHLTCPB",183,0)
 . S:RAESIG]"" ^TMP("RARPT-REC",$J,RASUB,"RAESIG")=RAESIG
"RTN","RAHLTCPB",184,0)
 . Q
"RTN","RAHLTCPB",185,0)
 Q
"RTN","RAMAIN2")
0^5^B51382730^B50288103
"RTN","RAMAIN2",1,0)
RAMAIN2 ;HISC/GJC-Radiology Utility File Maintenance (Part Two) ;8/15/05 10:07am
"RTN","RAMAIN2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,62,71**;Mar 16, 1998;Build 10
"RTN","RAMAIN2",3,0)
 ; 08/12/2005 bay/kam Remedy Call 104630 Patch 62
"RTN","RAMAIN2",4,0)
 ; 03/02/2006 BAY/KAM Remedy Call 131482 Patch RA*5*71
"RTN","RAMAIN2",5,0)
2 ;;Procedure Enter/Edit
"RTN","RAMAIN2",6,0)
 ; *** This subroutine once resided in RAMAIN i.e, '2^RAMAIN'. ***
"RTN","RAMAIN2",7,0)
 ; RA PROCEDURE option
"RTN","RAMAIN2",8,0)
 N RACTIVE,RAENALL,RAY,RAFILE,RASTAT,RAXIT
"RTN","RAMAIN2",9,0)
 S (RAENALL,RANEW71,RAXIT)=0
"RTN","RAMAIN2",10,0)
 N RADIO,RAPTY,RAASK,RAROUTE ;used by the edit template
"RTN","RAMAIN2",11,0)
 F  D  Q:$G(RAXIT)
"RTN","RAMAIN2",12,0)
 . K DA,DD,DIC,DINUM,DLAYGO,DO,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",13,0)
 . S DIC="^RAMIS(71,",DIC(0)="QEAMLZ",DLAYGO=71,DIC("DR")=6
"RTN","RAMAIN2",14,0)
 . W ! D ^DIC K D,DD,DIC,DINUM,DLAYGO,DO
"RTN","RAMAIN2",15,0)
 . S:+Y<0 RAXIT=1 I $G(RAXIT) K D,X,Y Q
"RTN","RAMAIN2",16,0)
 . S (DA,RADA)=+Y,RAY=Y,RAFILE=71
"RTN","RAMAIN2",17,0)
 . ;RA*5*71 changed next line for Remedy Call 131482
"RTN","RAMAIN2",18,0)
 . S RANEW71=$S($P(Y,U,3)=1:1,1:0) ;used in template, edit CPT Code if new rec.
"RTN","RAMAIN2",19,0)
 . L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",20,0)
 . I '$T D  Q
"RTN","RAMAIN2",21,0)
 .. W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",22,0)
 .. W !?5,"Try again later!",$C(7) S RAXIT=1
"RTN","RAMAIN2",23,0)
 .. Q
"RTN","RAMAIN2",24,0)
 . S RAPNM=$P($G(Y(0)),U) ;proc. name for display purposes in template
"RTN","RAMAIN2",25,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",26,0)
 . S RASTAT=$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",27,0)
 . D TRKCMB^RAMAINU(DA,.RATRKCMB) ;tracks existing
"RTN","RAMAIN2",28,0)
 . ; CM definition before editing. RATRKCMB ids the before CM values
"RTN","RAMAIN2",29,0)
 . S DIE="^RAMIS(71,",DR="[RA PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",30,0)
 . K RAPNM S RAPROC(0)=$G(^RAMIS(71,RADA,0))
"RTN","RAMAIN2",31,0)
 . ;
"RTN","RAMAIN2",32,0)
 . ;check for data consistency between the 'CONTRAST MEDIA USED' &
"RTN","RAMAIN2",33,0)
 . ;'CONTRAST MEDIA' fields.
"RTN","RAMAIN2",34,0)
 . D CMINTEG^RAMAINU1(RADA,RAPROC(0))
"RTN","RAMAIN2",35,0)
 . ;
"RTN","RAMAIN2",36,0)
 . D TRKCMA^RAMAINU(RADA,RATRKCMB,.RATRKCMA,.RACMDIFF)
"RTN","RAMAIN2",37,0)
 . I $O(^RAMIS(71,RADA,"NUC",0)),($P(RAPROC(0),"^",2)=1) D DELRADE(RADA)
"RTN","RAMAIN2",38,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",39,0)
 . S RASTAT=RASTAT_"^"_$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",40,0)
 . ; 08/12/2005 104630 KAM - added '$G(RANEW71) to next line
"RTN","RAMAIN2",41,0)
 . I RAPROC(0)]"",("^B^P^"'[(U_$P(RAPROC(0),"^",6)_U)),('+$P(RAPROC(0),"^",9)),'+$G(RANEW71) D
"RTN","RAMAIN2",42,0)
 .. K %,C,D0,DE,DI,DIE,DQ,DR
"RTN","RAMAIN2",43,0)
 .. W !?5,$C(7),"...no CPT code entered..."
"RTN","RAMAIN2",44,0)
 .. W !?5,"...will change type to a 'broad' procedure.",!
"RTN","RAMAIN2",45,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="6///B" D ^DIE
"RTN","RAMAIN2",46,0)
 .. Q
"RTN","RAMAIN2",47,0)
 . ;08/12/2005 104630 - KAM added next 5 lines
"RTN","RAMAIN2",48,0)
 . I RAPROC(0)]"",("^B^P^"'[(U_$P(RAPROC(0),"^",6)_U)),('+$P(RAPROC(0),"^",9)),+$G(RANEW71) D
"RTN","RAMAIN2",49,0)
 .. K %,C,D0,DE,DI,DIK,DQ,DR
"RTN","RAMAIN2",50,0)
 .. W !?5,$C(7),"...no CPT code entered..."
"RTN","RAMAIN2",51,0)
 .. W !?5,"...will delete the record at this time.",!
"RTN","RAMAIN2",52,0)
 .. S DIK="^RAMIS(71,",DA=RADA D ^DIK K DIK
"RTN","RAMAIN2",53,0)
 . ;if an active parent w/o descendants, inactivate the parent
"RTN","RAMAIN2",54,0)
 . I $P(RASTAT,U,2),($P(RAPROC(0),U,6)="P"),('$O(^RAMIS(71,RADA,4,0))) D
"RTN","RAMAIN2",55,0)
 .. K D,D0,D1,DA,DI,DIC,DIE,DQ,DR
"RTN","RAMAIN2",56,0)
 .. W !!?5,"Inactivating this parent procedure - no descendents.",!,$C(7)
"RTN","RAMAIN2",57,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="100///"_$S($D(DT):DT,1:$$DT^XLFDT())
"RTN","RAMAIN2",58,0)
 .. D ^DIE K D,D0,D1,DA,DI,DIC,DIE,DQ,DR S $P(RASTAT,U,2)=0 ;inactive
"RTN","RAMAIN2",59,0)
 .. Q
"RTN","RAMAIN2",60,0)
 . I $P($G(^RA(79.2,+$P(RAPROC(0),U,12),0)),U,5)="Y",(+$O(^RAMIS(71,RADA,"NUC",0))) D VRDIO(RADA)
"RTN","RAMAIN2",61,0)
 . I "^B^P^"[(U_$P(RAPROC(0),U,6)_U),($P(RAPROC(0),U,9)]"") D
"RTN","RAMAIN2",62,0)
 .. K %,D,D0,DA,DE,DIC,DIE,DQ,DR
"RTN","RAMAIN2",63,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="9///@" D ^DIE
"RTN","RAMAIN2",64,0)
 .. W !!?5,"...CPT code deleted because "_$S($P(RAPROC(0),U,6)="B":"Broad",1:"Parent")_" procedures",!?5,"should not have CPT codes.",!,$C(7)
"RTN","RAMAIN2",65,0)
 .. Q
"RTN","RAMAIN2",66,0)
 . K %,%X,%Y,C,D,D0,D1,DA,DE,DI,DIE,DQ,DR,RAIMAG,RAMIS,RAPROC,X,Y
"RTN","RAMAIN2",67,0)
 .;send Orderable Item HL7 msg to CPRS if the ORDER DIALOG (#101.41)
"RTN","RAMAIN2",68,0)
 .;file exists unconditionally
"RTN","RAMAIN2",69,0)
 .D:$$ORQUIK^RAORDU()=1 PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",70,0)
 .;
"RTN","RAMAIN2",71,0)
 . L -^RAMIS(RAFILE,RADA) K RADA
"RTN","RAMAIN2",72,0)
 .;unconditionally update the parent procedure if the descendent
"RTN","RAMAIN2",73,0)
 .I $O(^RAMIS(71,"ADESC",+RAY,0)) D UPDATP^RAO7UTL(RAY)
"RTN","RAMAIN2",74,0)
 .;has been edited
"RTN","RAMAIN2",75,0)
 . Q
"RTN","RAMAIN2",76,0)
 K DIR,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",77,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RAMAIN2",78,0)
 S DIR("A")="Want to run a validity check on CPT and stop codes? "
"RTN","RAMAIN2",79,0)
 S DIR("?",1)="Answer 'YES' to print a list of Radiology/Nuclear Medicine Procedures"
"RTN","RAMAIN2",80,0)
 S DIR("?",2)="with missing or invalid CPT's and/or Credit Clinic Stop Code(s)."
"RTN","RAMAIN2",81,0)
 S DIR("?",3)="Broad procedures with invalid codes are included for information"
"RTN","RAMAIN2",82,0)
 S DIR("?",4)="only.  Inactive procedures are not required to have valid codes."
"RTN","RAMAIN2",83,0)
 S DIR("?",5)="To be valid, Stop Codes must be in the Imaging Stop Codes file 71.5;"
"RTN","RAMAIN2",84,0)
 S DIR("?",6)="CPT's must be nationally active."
"RTN","RAMAIN2",85,0)
 S DIR("?")="Please answer 'YES' or 'NO'."
"RTN","RAMAIN2",86,0)
 W ! D ^DIR K DIR G:$D(DIRUT) EXIT
"RTN","RAMAIN2",87,0)
 D:Y ^RAPERR
"RTN","RAMAIN2",88,0)
EXIT K RADA,RANEW71,X,Y
"RTN","RAMAIN2",89,0)
 Q
"RTN","RAMAIN2",90,0)
13 ;;Rad/Nuc Med Common Procedure File Enter/Edit
"RTN","RAMAIN2",91,0)
 ; RA COMMON PROCEDURE option
"RTN","RAMAIN2",92,0)
 N RADA,RAENALL,RAY,RAFILE,RALOW,RAMIS713,RASTAT,RAIMGTYI S RAENALL=0
"RTN","RAMAIN2",93,0)
 W ! D EN1^RAUTL17 G:Y'>0 Q13 S RAIMGTYI=Y
"RTN","RAMAIN2",94,0)
131 S DIC="^RAMIS(71.3,",DIC(0)="AELMQZ",DLAYGO=71.3
"RTN","RAMAIN2",95,0)
 S DIC("S")="N RA S RA=+$P(^(0),U) I RAIMGTYI=$P($G(^RAMIS(71,RA,0)),U,12)"
"RTN","RAMAIN2",96,0)
 S DIC("W")="N RA4 S RA4=$P($G(^(0)),""^"",4) W:RA4]"""" ""   (""_RA4_"")"" W:RA4']"""" ""   (no sequence number)"""
"RTN","RAMAIN2",97,0)
 W ! D ^DIC K DIC,DLAYGO,D,X
"RTN","RAMAIN2",98,0)
 I Y<0 D Q13 G RESEQ
"RTN","RAMAIN2",99,0)
 ; If a sequence # exists, the Common Proc. is active
"RTN","RAMAIN2",100,0)
 S RADA=+Y,RAY=Y,RAFILE=71.3 L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",101,0)
 I '$T D  G Q13
"RTN","RAMAIN2",102,0)
 . W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",103,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RAMAIN2",104,0)
 . Q
"RTN","RAMAIN2",105,0)
 S RASTAT=$S($P(Y(0),"^",4)]"":1,1:0)_"^"
"RTN","RAMAIN2",106,0)
 I '+$P(RASTAT,"^") S RALOW=$$LOW(RAIMGTYI)
"RTN","RAMAIN2",107,0)
 S DA=RADA,DIE="^RAMIS(71.3,",DR="[RA COMMON PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",108,0)
 S RAMIS713(0)=$G(^RAMIS(71.3,RADA,0))
"RTN","RAMAIN2",109,0)
 ; If the procedure is different than the one originally selected and
"RTN","RAMAIN2",110,0)
 ; the CPRS Order Dialog file exists, send the Orderable Item Update
"RTN","RAMAIN2",111,0)
 ; message to CPRS.
"RTN","RAMAIN2",112,0)
 I $P(RAMIS713(0),"^")'=$P(RAY,"^",2),($$ORQUIK^RAORDU()=1) D
"RTN","RAMAIN2",113,0)
 . S RASTAT=RASTAT_0 D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",114,0)
 . S RAY=RADA_"^"_$P($G(^RAMIS(71.3,RADA,0)),"^")_"^"_1,RASTAT=0_"^"
"RTN","RAMAIN2",115,0)
 . Q
"RTN","RAMAIN2",116,0)
 K %,%X,%Y,C,D,D0,DA,DE,DI,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",117,0)
 S RASTAT=RASTAT_$S($P($G(^RAMIS(71.3,+RAY,0)),"^",4)]"":1,1:0)
"RTN","RAMAIN2",118,0)
 ; If before & after statuses differ, and the CPRS Order Dialog file
"RTN","RAMAIN2",119,0)
 ; exists, send the Orderable Item Update message to CPRS.
"RTN","RAMAIN2",120,0)
 I $$ORQUIK^RAORDU()=1,(($P(RASTAT,"^")+$P(RASTAT,"^",2))=1) D
"RTN","RAMAIN2",121,0)
 . D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",122,0)
 . Q
"RTN","RAMAIN2",123,0)
 L -^RAMIS(RAFILE,RADA)
"RTN","RAMAIN2",124,0)
 G 131
"RTN","RAMAIN2",125,0)
Q13 K DDC,DDH,DISYS,I,POP,RA713
"RTN","RAMAIN2",126,0)
 Q
"RTN","RAMAIN2",127,0)
RESEQ ;Resequence the common procedure list
"RTN","RAMAIN2",128,0)
 N D,D0,DI,DQ,H,I,J,CNT,DIC,DIE,DR,DA,TXT,X
"RTN","RAMAIN2",129,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",130,0)
 . S TXT(1)=" "
"RTN","RAMAIN2",131,0)
 . S TXT(2)="Resequencing the Rad/Nuc Med Common Procedure List."
"RTN","RAMAIN2",132,0)
 . Q
"RTN","RAMAIN2",133,0)
 E  W !!?5,"Resequencing the Rad/Nuc Med Common Procedure List"
"RTN","RAMAIN2",134,0)
 S DIE="^RAMIS(71.3,",(I,CNT)=0
"RTN","RAMAIN2",135,0)
 F  S I=$O(^RAMIS(71.3,"AA",RAIMGTYI,I)) Q:I'>0  D
"RTN","RAMAIN2",136,0)
 . S J=0
"RTN","RAMAIN2",137,0)
 . F  S J=$O(^RAMIS(71.3,"AA",RAIMGTYI,I,J)) Q:J'>0  I $D(^RAMIS(71.3,J,0)) D
"RTN","RAMAIN2",138,0)
 .. S DA=J,CNT=CNT+1 N I,J
"RTN","RAMAIN2",139,0)
 .. S DR="3////^S X=CNT" D ^DIE W:'$D(XPDNM) "."
"RTN","RAMAIN2",140,0)
 .. Q
"RTN","RAMAIN2",141,0)
 . Q
"RTN","RAMAIN2",142,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",143,0)
 . S TXT(2)=$G(TXT(2))_"  Done!"
"RTN","RAMAIN2",144,0)
 . D MES^XPDUTL(.TXT)
"RTN","RAMAIN2",145,0)
 . Q
"RTN","RAMAIN2",146,0)
 E  W "  Done!"
"RTN","RAMAIN2",147,0)
 Q
"RTN","RAMAIN2",148,0)
LOW(X) ; Find the lowest available sequence number for a procedure within
"RTN","RAMAIN2",149,0)
 ; a specific Imaging Type.  Seq. #'s range from 1 to 40.  If the
"RTN","RAMAIN2",150,0)
 ; range changes in the DD i.e, ^DD(71.3,3, this code as well as the 
"RTN","RAMAIN2",151,0)
 ; code if EN3^RAUTL18 must also be altered.
"RTN","RAMAIN2",152,0)
 ; If RAHIT is passed back as "", there is no available sequence number.
"RTN","RAMAIN2",153,0)
 N RA,RAHIT S RAHIT=""
"RTN","RAMAIN2",154,0)
 F RA=1:1:40 D  Q:RAHIT
"RTN","RAMAIN2",155,0)
 . Q:$D(^RAMIS(71.3,"AA",X,RA))
"RTN","RAMAIN2",156,0)
 . S:RAHIT="" RAHIT=RA
"RTN","RAMAIN2",157,0)
 . Q
"RTN","RAMAIN2",158,0)
 Q RAHIT
"RTN","RAMAIN2",159,0)
VRDIO(RADA) ; Validate the 'Usual Dose' field within the 'Default Radiopha-
"RTN","RAMAIN2",160,0)
 ; rmaceuticals' multiple.  'Usual Dose' must fall within the 'Low Adult
"RTN","RAMAIN2",161,0)
 ; Dose' & 'High Adult Dose' range.  This subroutine will display the
"RTN","RAMAIN2",162,0)
 ; Radiopharmaceutical in question along with the values in question if
"RTN","RAMAIN2",163,0)
 ; inconsistencies are found.
"RTN","RAMAIN2",164,0)
 ;
"RTN","RAMAIN2",165,0)
 ; Input Variable: 'RADA' the ien of the Procedure
"RTN","RAMAIN2",166,0)
 N RANUC S RADA(1)=RADA,RADA=0 D EN^DDIOL("","","!")
"RTN","RAMAIN2",167,0)
 F  S RADA=$O(^RAMIS(71,RADA(1),"NUC",RADA)) Q:RADA'>0  D
"RTN","RAMAIN2",168,0)
 . S RANUC(0)=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RAMAIN2",169,0)
 . Q:$P(RANUC(0),"^",2)=""  ; no need to validate, nothing input
"RTN","RAMAIN2",170,0)
 . I '$$USUAL^RADD2(.RADA,$P(RANUC(0),"^",2)) D
"RTN","RAMAIN2",171,0)
 .. N RARRY S RARRY(1)="For Radiopharmaceutical: "
"RTN","RAMAIN2",172,0)
 .. S RARRY(1)=RARRY(1)_$$GET1^DIQ(50,+$P(RANUC(0),"^")_",",.01)_$C(7)
"RTN","RAMAIN2",173,0)
 .. S RARRY(2)="" D EN^DDIOL(.RARRY,"")
"RTN","RAMAIN2",174,0)
 .. Q
"RTN","RAMAIN2",175,0)
 . Q
"RTN","RAMAIN2",176,0)
 Q
"RTN","RAMAIN2",177,0)
DELRADE(RADA) ; Delete the Default Radiopharmaceuticals multiple 
"RTN","RAMAIN2",178,0)
 N RADA1 S RADA1=0
"RTN","RAMAIN2",179,0)
 W !!?3,"Deleting default radiopharmaceuticals for this procedure...",!
"RTN","RAMAIN2",180,0)
 F  S RADA1=$O(^RAMIS(71,RADA,"NUC",RADA1)) Q:RADA1'>0  D
"RTN","RAMAIN2",181,0)
 . K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",182,0)
 . S DA(1)=RADA,DA=RADA1,DIE="^RAMIS(71,"_RADA_",""NUC"","
"RTN","RAMAIN2",183,0)
 . S DR=".01///@" D ^DIE
"RTN","RAMAIN2",184,0)
 . Q
"RTN","RAMAIN2",185,0)
 K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",186,0)
 Q
"RTN","RAMAIN2",187,0)
 ;
"RTN","RASTED")
0^2^B46056660^B45805107
"RTN","RASTED",1,0)
RASTED ;HISC/CAH,FPT,GJC,SS AISC/TMP,TAC,RMO-Edits for status tracking ;6/2/98  15:43
"RTN","RASTED",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,18,28,45,71**;Mar 16, 1998;Build 10
"RTN","RASTED",3,0)
 ;last modif by SS for P18 JUN 19,2000
"RTN","RASTED",4,0)
 ;02/10/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RASTED",5,0)
 ; *** 'RASTED' is called from the routine; 'CASE^RASTEXT1'. ***
"RTN","RASTED",6,0)
 ;last modification by SS May 12,2000
"RTN","RASTED",7,0)
 S RAL=X F I2=1:1 S X=$P(RAL,",",I2) Q:X=""  S RAVW="" W !!,"Case # being tracked: ",X D SEL^RACNLU D:'RACNT KEY D START:RACNT&((X'="^")&(X'=""))
"RTN","RASTED",8,0)
 K RAL,RAI,RAPRI,I2,I3,RAVW,RAEND,RANME,RAPRC,RARPT,RADTE,RADT0,RANEXT,RANXT72,RASK,RACN,RACN0,RADFN,RADUZ,RAPOP,RAST,RAST0,RAFL,RAFST,RAIX,RASSN,RACOMP,X Q
"RTN","RASTED",9,0)
 ;RACOMP defined if [RA STATUS CHANGE] was processed completely
"RTN","RASTED",10,0)
START F I3=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",I3)=$P(Y,"^",I3)
"RTN","RASTED",11,0)
 I '$D(^RA(72,+RAST,0)) W $C(7),"Invalid status for case #: ",RACN R X:3 Q
"RTN","RASTED",12,0)
 S RAST0=^RA(72,+RAST,0) I $P(RAST0,"^",3)=9 W $C(7),!,"Exam is already complete!!" R X:3 Q
"RTN","RASTED",13,0)
 S X1=""
"RTN","RASTED",14,0)
 I $D(^RA(72,+$P(RAST0,"^",2),0)) S RANEXT=^(0),RASK=$S($D(^(.2)):^(.2),1:""),RANXT72=+$P(RAST0,"^",2)
"RTN","RASTED",15,0)
NEXT I '$D(RANEXT) S DIC("A")="Enter Next Status: ",DIC="^RA(72,",DIC(0)="AEFQZ",DIC("S")="I $P(^(0),U,3),$P(^(0),U,7)=$O(^RA(79.2,""B"",RAIMGTY,0))" D ^DIC K DIC Q:Y'>0  S RANEXT=Y(0),RASK=$S($D(^RA(72,+Y,.2)):^(.2),1:""),RANXT72=+Y
"RTN","RASTED",16,0)
 I $P(RANEXT,"^")=$P(RAST0,"^") W $C(7),!,"Status has already been set to ",$P(RANEXT,"^") R X:3 Q
"RTN","RASTED",17,0)
 I $$LKUP^XPDKEY(+$P(RANEXT,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(RANEXT,"^",4)),DUZ)) W $C(7),!,"You are not authorized to change to this status" R X:3 Q
"RTN","RASTED",18,0)
 ; check if next status has order field filled in
"RTN","RASTED",19,0)
 G:$P(RANEXT,U,3)]"" OK2
"RTN","RASTED",20,0)
 N RANXTIEN,RALINE S RANXTIEN=$P(RAST0,U,2),$P(RALINE,"_",50)=""
"RTN","RASTED",21,0)
 W !!?15,$C(7),RALINE
"RTN","RASTED",22,0)
 W !!?15,$C(7),"Default Next Status (",$P(RANEXT,U),") is *NOT* active.",!?15,$C(7),RALINE,!
"RTN","RASTED",23,0)
NXT S RANXTIEN=$P(^RA(72,RANXTIEN,0),U,2)
"RTN","RASTED",24,0)
 G:$P($G(^RA(72,+RANXTIEN,0)),U,3)=9 OK0 ;next default status is COMPLETE
"RTN","RASTED",25,0)
 G:RANXTIEN="" BAD ;no next default status pointer
"RTN","RASTED",26,0)
 G:'$D(^RA(72,RANXTIEN,0)) BAD ;no next default status record
"RTN","RASTED",27,0)
 G:$P($G(^RA(72,RANXTIEN,0)),U,3)="" NXT ;no order data, so loop back
"RTN","RASTED",28,0)
 G OK0
"RTN","RASTED",29,0)
BAD W !?15,$C(7),RALINE
"RTN","RASTED",30,0)
 W !!?18,$C(7),"There is no valid higher status to advance to.",!?15,$C(7),RALINE
"RTN","RASTED",31,0)
KEY W !! K DIR S DIR(0)="E",DIR("A")="Press Return key to continue " D ^DIR
"RTN","RASTED",32,0)
 K DIR,DIRUT,DUOUT Q
"RTN","RASTED",33,0)
OK0 S RANEXT=$G(^RA(72,RANXTIEN,0)),RANXT72=RANXTIEN
"RTN","RASTED",34,0)
OK1 W !?15,$C(7),RALINE,!!?18,"Next valid status is : ",$P(RANEXT,U),!?15,$C(7),RALINE
"RTN","RASTED",35,0)
OK2 S RADT0=^RADPT(RADFN,"DT",RADTI,0),RACN0=^("P",RACNI,0),RACS=$P(RACN0,"^",24),RAPRIT=$P(RACN0,"^",2)
"RTN","RASTED",36,0)
CHANGE W !!,"Name: ",RANME,?40,"Case #  : ",RACN,!,"Division : ",$S($D(^DIC(4,+$P(RADT0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",37,0)
 W ?40,"Location: ",$S('$D(^RA(79.1,+$P(RADT0,"^",4),0)):"",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",38,0)
 W !,"Procedure: ",RAPRC
"RTN","RASTED",39,0)
 D PRCCPT^RAPROD
"RTN","RASTED",40,0)
 W !,"   ***** Old Status: ",$P(RAST0,"^"),!,"   ***** New Status: ",$P(RANEXT,"^")
"RTN","RASTED",41,0)
 I RAPRC="Unknown" W !!?5,$C(7),"This record is corrupted -- the procedure is missing,",!?5,"please contact your ADPAC or IRM",! K DIR S DIR(0)="E",DIR("A")="Press RETURN to Continue" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT Q
"RTN","RASTED",42,0)
ASK R !,"Do you wish to continue? YES// ",X1:DTIME S:X1="" X1="Y" Q:'$T!(X1["^")!("nN"[X1)
"RTN","RASTED",43,0)
 I X1["?" W !!,"Answer 'Yes' or 'No'.",! G ASK
"RTN","RASTED",44,0)
 S RADUZ=DUZ I '$P(RAMDV,"^",6)!($P(RASK,"^",11)["Y") S RAPOP=0 D USER Q:RAPOP
"RTN","RASTED",45,0)
 N RAPRTSET,RAMEMARR D EN2^RAUTL20(.RAMEMARR) ;is this a print set ?
"RTN","RASTED",46,0)
 N RAWHICH,RAREM,RABEFORE,RAAFTER
"RTN","RASTED",47,0)
 S DIE("NO^")="BACKOUTOK",DR="[RA STATUS CHANGE]"
"RTN","RASTED",48,0)
 S DA=RADFN,RADADA=RADTI,DIE="^RADPT(",RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RASTED",49,0)
 S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA) Q:RAXIT
"RTN","RASTED",50,0)
 ;
"RTN","RASTED",51,0)
 ;save 'before' CM data value to compare against the possible 'after'
"RTN","RASTED",52,0)
 ;value
"RTN","RASTED",53,0)
 D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RASTED",54,0)
 ;
"RTN","RASTED",55,0)
 D SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare later
"RTN","RASTED",56,0)
 K RACOMP D ^DIE
"RTN","RASTED",57,0)
 ;P18. $D(RABEFORE)=0 means that RASTREQ was not run - the user has interrupted input or timeout happened. So we must call it, then check result (is status changed) and if so - update 70.03 #3 and set RA70033=X
"RTN","RASTED",58,0)
 I '$D(RABEFORE) K DA S X=RANXT72 D:X ^RASTREQ  I $D(X)#2 S RA70033=X D U70033^RADD3(RADFN,RADTI,RACNI,X)
"RTN","RASTED",59,0)
 ;
"RTN","RASTED",60,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RASTED",61,0)
 ;MEDIA'
"RTN","RASTED",62,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RASTED",63,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RASTED",64,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RASTED",65,0)
 S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RASTED",66,0)
 D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RASTED",67,0)
 D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RASTED",68,0)
 K RACMDA,RAOPRC
"RTN","RASTED",69,0)
 ;
"RTN","RASTED",70,0)
 K DIE("NO^"),DQ,DE,RATRKCMB,RAZCM
"RTN","RASTED",71,0)
 K RANM702,RADIOPH,RADOSE,RAIEN702,RAHI,RALOW,RAPRI,RAMIS,RAI,RAPSDRUG,RAR1
"RTN","RASTED",72,0)
 ;
"RTN","RASTED",73,0)
 ; if EXAM STATUS didn't process, still go thru status-change-logic
"RTN","RASTED",74,0)
 ; variables
"RTN","RASTED",75,0)
 ; ---------
"RTN","RASTED",76,0)
 ;   RA70033: is set in the RA STATUS CHANGE input template after the
"RTN","RASTED",77,0)
 ;             update to the EXAMINATION STATUS field (70.03;3)
"RTN","RASTED",78,0)
 ;    RATCXX: are technologist comments (if any) input by the user
"RTN","RASTED",79,0)
 ;     RAMDV: division parameters, piece 10; store the date/time
"RTN","RASTED",80,0)
 ;            of an exam status change (1 for yes, 0 for no)
"RTN","RASTED",81,0)
 ;
"RTN","RASTED",82,0)
 D:$D(RA70033)&($P(RAMDV,"^",10)) X7005^RADD3(RADFN,RADTI,RACNI,RAMDV,"",RA70033,$S($D(RADUZ):RADUZ,1:DUZ))
"RTN","RASTED",83,0)
 D A7007^RADD3(RADFN,RADTI,RACNI,$S($D(RADUZ):RADUZ,1:DUZ),$G(RATCXX))
"RTN","RASTED",84,0)
 D UNLOCK^RAUTL12(RADIE,RADADA) K RADADA,RADIE
"RTN","RASTED",85,0)
 K RA70033,RADUZ,RATCXX
"RTN","RASTED",86,0)
 N RACN0A ; updated version of the exam node after status updates
"RTN","RASTED",87,0)
 W !,"...Status ",$S($D(RAAFTER)&($G(RABEFORE)=$G(RAAFTER)):"unchanged",$G(RABEFORE)>$G(RAAFTER):"backed down",1:"successfully changed")," for case #: ",RACN
"RTN","RASTED",88,0)
 ;
"RTN","RASTED",89,0)
 ;02/10/2006 BAY/KAM RA*5*71 Added next line
"RTN","RASTED",90,0)
 D EXM^RAHLRPC
"RTN","RASTED",91,0)
 I $D(RAAFTER),$G(RABEFORE)=$G(RAAFTER) R X:3 D  Q  ;exit if no change
"RTN","RASTED",92,0)
 .D CMPAFTR^RAO7XX(1) Q  ;P18 compares if procedure was changed sends XX message
"RTN","RASTED",93,0)
 ;
"RTN","RASTED",94,0)
 ; if status got backed down, RANEXT is re-defined inside rtn RASTREQ
"RTN","RASTED",95,0)
 ; when the above edit template gets to the EXAM STATUS field
"RTN","RASTED",96,0)
 ;
"RTN","RASTED",97,0)
 D ^RAORDC I +$P(RANEXT,"^",3)>1,RACS'="Y",$S($P(RACN0,"^",6)']"":1,$P(^DIC(42,+$P(RACN0,"^",6),0),U,3)="D":1,1:0) D EN^RAUTL0
"RTN","RASTED",98,0)
 S RACN0A=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) ; updated 0 node!
"RTN","RASTED",99,0)
 ; Do we need to 'Generate Exam Alert' based on the exam status?
"RTN","RASTED",100,0)
 I $D(^RA(72,+$P(RACN0A,"^",3),"ALERT")),($P(^("ALERT"),"^")="y") D
"RTN","RASTED",101,0)
 . ; fire off the 'Rad Patient Examined' alert.
"RTN","RASTED",102,0)
 . N RAPRIT,RAORDIFN
"RTN","RASTED",103,0)
 . S RAPRIT=+$P(RACN0A,"^",2) ; possible call to OERR3^RAORDU1
"RTN","RASTED",104,0)
 . S RAORDIFN=+$P(RACN0A,"^",11) ; possible call to OERR^RAORDU1
"RTN","RASTED",105,0)
 . D:$$ORVR^RAORDU()=2.5 OERR^RAUTL1
"RTN","RASTED",106,0)
 . D:$$ORVR^RAORDU()'<3 OERR3^RAUTL1
"RTN","RASTED",107,0)
 . Q
"RTN","RASTED",108,0)
 ;
"RTN","RASTED",109,0)
 R X:3
"RTN","RASTED",110,0)
 D CMPAFTR^RAO7XX(1) ;P18 compares -if procedure was changed - sends XX message
"RTN","RASTED",111,0)
 Q
"RTN","RASTED",112,0)
USER S %="A",%DUZ=DUZ W ! D ^XUVERIFY G USERQ:%=-1 I %'=1 W $C(7)," ??" G USER
"RTN","RASTED",113,0)
 Q
"RTN","RASTED",114,0)
USERQ K RADUZ S RAPOP=1 Q
"RTN","RASTED",115,0)
WHY1 ;explain why prim/sec resid/staff, diagnoses prompts are skipped
"RTN","RASTED",116,0)
 Q:$G(DA)<1!($G(DA(1))<1)!($G(DA(2))<1)
"RTN","RASTED",117,0)
 N RA0,RA1,RA2,RA5 N:'$D(RA3)#2 RA3 N:'$D(RA4)#2 RA4
"RTN","RASTED",118,0)
 S RA0=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q:'RA0  S RA2=0
"RTN","RASTED",119,0)
 I $G(RA3)=13 D WHY11 G WHYMSG ;diagnoses
"RTN","RASTED",120,0)
 S RA3=12,RA4=70 D WHY11 ;residents
"RTN","RASTED",121,0)
 S RA3=15,RA4=60 D WHY11 ;staff
"RTN","RASTED",122,0)
WHYMSG W:'RA2 !!?12,"No data have been entered for ",$S(RA3'=13:"residents/staff",1:"diagnoses")," yet.",!
"RTN","RASTED",123,0)
WHYMSG2 W !?12,$C(7),"The selected case belongs to a print set,",!?12,"Please use the 'Report Enter/Edit' option",!?12,"to enter data for ",$S(RA3=99:"residents/staff/diagnoses",RA3'=13:"residents/staff",1:"diagnoses"),".",!!
"RTN","RASTED",124,0)
 Q
"RTN","RASTED",125,0)
WHY11 Q:'+$P(RA0,"^",RA3)
"RTN","RASTED",126,0)
 S RA2=1 W !!?2,$P(^DD(70.03,RA3,0),"^")," :",?35
"RTN","RASTED",127,0)
 W:RA3'=13 $P(^VA(200,+$P(RA0,"^",RA3),0),"^") W:RA3=13 $P(^RA(78.3,+$P(RA0,"^",RA3),0),"^") W !
"RTN","RASTED",128,0)
 S RA5=$P($P(^DD(70.03,RA4,0),"^",4),";") Q:'$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,0))
"RTN","RASTED",129,0)
 S RA1=0 W !?4,$P(^DD(70.03,RA4,0),"^")," :"
"RTN","RASTED",130,0)
 F  S RA1=$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,RA1)) Q:'RA1  I +^(RA1,0) W ?37 W:RA3'=13 $P($G(^VA(200,+^(0),0)),"^") W:RA3=13 $P($G(^RA(78.3,+^(0),0)),"^") W !
"RTN","RASTED",131,0)
 Q
"RTN","RASTED",132,0)
WHY2 ;explain why diags prompts are skipped
"RTN","RASTED",133,0)
 N RA3 S RA3=13,RA4=13.1 G WHY1
"RTN","RAUTL0")
0^8^B31099396^B29577408
"RTN","RAUTL0",1,0)
RAUTL0 ;HISC/CAH,FPT,GJC-Utility Routine ;11/5/99  13:19
"RTN","RAUTL0",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,13,10,71**;Mar 16, 1998;Build 10
"RTN","RAUTL0",3,0)
 ; 07/05/2006 BAY/KAM Remedy Call 124379 Patch RA*5*71
"RTN","RAUTL0",4,0)
UPSTAT ;QUEUE ONE REPORT TO UPDATE STATUS
"RTN","RAUTL0",5,0)
 ;07/05/2006 BAY/KAM/GJC If RAHLTCPB is defined, do not broadcast ORM messages. RAHLTCPB is referenced in UP2^RAUTL1
"RTN","RAUTL0",6,0)
 ;which is called from UP1^RAUTL1
"RTN","RAUTL0",7,0)
 N RAIO S RAIO=+$P($G(^RA(79,+RAMDIV,"RDEV")),"^") ; Resource Device?
"RTN","RAUTL0",8,0)
 S ZTRTN="STAT^RAUTL0",ZTIO=$S(RAIO>0:$$GET1^DIQ(3.5,RAIO_",",.01),1:"")
"RTN","RAUTL0",9,0)
 S ZTDTH=$H,ZTDESC="Rad/Nuc Med UPDATE STATUS OF ONE REPORT" S SDUZ=$G(RADUZ) S:'SDUZ SDUZ=DUZ F I="RAMDIV","RAMDV","RARPT","RAONLINE","RAAB","RAMLC","RAIMGTY","SDUZ" S ZTSAVE(I)=""
"RTN","RAUTL0",10,0)
 S:$G(RADUZ) ZTSAVE("RADUZ")="" ;rpt may be verified by voice
"RTN","RAUTL0",11,0)
 ; 07/05/2006 BAY/KAM Added next line
"RTN","RAUTL0",12,0)
 S:$G(RAHLTCPB) ZTSAVE("RAHLTCPB")="" ;rpt v'fied by VR; do not broadcast ORM messages.
"RTN","RAUTL0",13,0)
 D ^%ZTLOAD K SDUZ
"RTN","RAUTL0",14,0)
 I $D(ZTSK),'$D(RAQUEUED) W !,?5,"Status update queued!",! R X:2
"RTN","RAUTL0",15,0)
 Q
"RTN","RAUTL0",16,0)
 ;
"RTN","RAUTL0",17,0)
 ;Set off a series of actions as a result of report update:    ;ch
"RTN","RAUTL0",18,0)
 ; patient loc updated in Rpt Distrib file #74.4
"RTN","RAUTL0",19,0)
 ; can also cause rec to be added to file 74.4 (depending on category
"RTN","RAUTL0",20,0)
 ;   of exam
"RTN","RAUTL0",21,0)
 ; update status of exam if possible and do accompanying actions (such
"RTN","RAUTL0",22,0)
 ;   as update of status log if specified in div params, notify OE/RR,
"RTN","RAUTL0",23,0)
 ;   change order status if necessary, can also cause alerts to be
"RTN","RAUTL0",24,0)
 ;   fired off)
"RTN","RAUTL0",25,0)
STAT ;TASKMAN ENTRY POINT TO UPDATE STATUS OF ONE REPORT
"RTN","RAUTL0",26,0)
 N RASAVE ; array to save off RADFN, RADTI & RACNI
"RTN","RAUTL0",27,0)
 S RAF1=1,Y=RARPT D RASET^RAUTL2,UP1^RAUTL1,STUFF^RARTST
"RTN","RAUTL0",28,0)
 S RASAVE("RADFN")=RADFN,RASAVE("RADTI")=RADTI,RASAVE("RACNI")=RACNI
"RTN","RAUTL0",29,0)
 S:$$ORVR^RAORDU()=2.5 ORVP=RADFN_";DPT(",ORBXDATA=RARPT
"RTN","RAUTL0",30,0)
 S RAEXFLD="ALL",D0=RARPT
"RTN","RAUTL0",31,0)
 D ^RARTFLDS,OENOTE^RAUTL00 ; OENOTE replaces STAT1
"RTN","RAUTL0",32,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RAUTL0",33,0)
 Q
"RTN","RAUTL0",34,0)
 ;
"RTN","RAUTL0",35,0)
UPSTATM ;QUEUE MULTIPLE REPORTS TO UPDATE STATUSES
"RTN","RAUTL0",36,0)
 N RAIO S RAIO=+$P($G(^RA(79,+RAMDIV,"RDEV")),"^") ; Resource Device?
"RTN","RAUTL0",37,0)
 S ZTRTN="STATM^RAUTL0",ZTIO=$S(RAIO>0:$$GET1^DIQ(3.5,RAIO_",",.01),1:"")
"RTN","RAUTL0",38,0)
 S ZTDTH=$H,ZTDESC="Rad/Nuc Med UPDATE STATUSES OF MULTIPLE REPORTS" S SDUZ=$G(RADUZ) S:'SDUZ SDUZ=DUZ F I="^TMP($J,""RA"",""DT"",","RAMDV","RAMDIV","RAONLINE","RAMLC","RAIMGTY","SDUZ" S ZTSAVE(I)=""
"RTN","RAUTL0",39,0)
 D ^%ZTLOAD K SDUZ I $D(ZTSK) W !,?5,"Status updates queued!",!
"RTN","RAUTL0",40,0)
 Q
"RTN","RAUTL0",41,0)
 ;
"RTN","RAUTL0",42,0)
STATM ;TASKMAN ENTRY POINT TO UPDATE STATUSES OF MULTIPLE REPORTS
"RTN","RAUTL0",43,0)
 S RAF1=1 F RARTDT=0:0 S RARTDT=$O(^TMP($J,"RA","DT",RARTDT)) Q:RARTDT'>0  F RA1=0:0 S RA1=$O(^TMP($J,"RA","DT",RARTDT,RA1)) Q:RA1'>0  S (RARPT,Y)=RA1 D RASET^RAUTL2,UP1^RAUTL1,STUFF^RARTST,STATM1
"RTN","RAUTL0",44,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RAUTL0",45,0)
 Q
"RTN","RAUTL0",46,0)
STATM1 ; Update statuses of multiple reports
"RTN","RAUTL0",47,0)
 N RASAVE ; array to save off RADFN, RADTI & RACNI
"RTN","RAUTL0",48,0)
 S:^TMP($J,"RA","DT",RARTDT,RA1) RAAB=1
"RTN","RAUTL0",49,0)
 S RASAVE("RADFN")=RADFN,RASAVE("RADTI")=RADTI,RASAVE("RACNI")=RACNI
"RTN","RAUTL0",50,0)
 S:$$ORVR^RAORDU()=2.5 ORVP=RADFN_";DPT(",ORBXDATA=RARPT
"RTN","RAUTL0",51,0)
 S RAEXFLD="ALL",D0=RARPT D ^RARTFLDS
"RTN","RAUTL0",52,0)
 D OENOTE^RAUTL00 K RAAB,ORIFN,ORNOTE
"RTN","RAUTL0",53,0)
 Q
"RTN","RAUTL0",54,0)
 ;
"RTN","RAUTL0",55,0)
EN ;Entry point to credit x-ray clinic stops
"RTN","RAUTL0",56,0)
 I $$PCE^RAWORK Q
"RTN","RAUTL0",57,0)
 S RASDC="" I '$D(RAMDIV)!'$D(RADTE)!'$D(RADFN)!'$D(RAPRIT)!'$D(RAMLC) G NOGO
"RTN","RAUTL0",58,0)
 S SDIV=RAMDIV,SDATE=$P(RADTE,"."),DFN=RADFN,SDC="",SDMSG="S"
"RTN","RAUTL0",59,0)
 G NOGO:'$D(^RAMIS(71,+RAPRIT,0)) S X=+$P(^(0),"^",9)
"RTN","RAUTL0",60,0)
 S X=$S(X="":"",1:$P($$NAMCODE^RACPTMSC(X,DT),"^"))
"RTN","RAUTL0",61,0)
 I X S X1=$S($D(^RA(79.1,+RAMLC,"PC")):^("PC"),1:"") G NOGO:'X1 S SDCPT(1)="900^"_X1_"^"_X
"RTN","RAUTL0",62,0)
 I $O(^RAMIS(71,RAPRIT,"STOP",0)) F I=0:0 S I=$O(^RAMIS(71,RAPRIT,"STOP",I)) Q:I'>0  I $D(^RAMIS(71,RAPRIT,"STOP",I,0)) S J=+^(0) D CON
"RTN","RAUTL0",63,0)
 S SDCTYPE=$S($D(SDCPT(1)):"B",1:"S") W:'$D(ZTQUEUED) !!?5,"Attempting to credit a clinic stop.",! D EN3^SDACS I SDERR=1 G NOGO
"RTN","RAUTL0",64,0)
 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",24)="Y" W:'$D(ZTQUEUED) !?5,"Clinic Stop credited." G EXIT
"RTN","RAUTL0",65,0)
 ;
"RTN","RAUTL0",66,0)
CON S K=$S($D(^DIC(40.7,+J,0)):$P(^(0),"^",2),1:"") I K S:SDC'[K SDC=K_"^"_SDC S RASDC=SDC
"RTN","RAUTL0",67,0)
 Q
"RTN","RAUTL0",68,0)
 ;
"RTN","RAUTL0",69,0)
NOGO W:'$D(ZTQUEUED) *7,!?5,"Unable to credit a clinic stop!",!
"RTN","RAUTL0",70,0)
 I $D(RASDC),($D(DUZ)#2),($D(RADFN)),($D(RADTI)),($D(RACNI)) D
"RTN","RAUTL0",71,0)
 . D STPCDE(RASDC,DUZ,RADFN,RADTI,RACNI) ; Stop Code Error bulletin
"RTN","RAUTL0",72,0)
 . Q
"RTN","RAUTL0",73,0)
EXIT K I,J,K,RAPR,RASDC,SDC,SDCPT,SDCTYPE,SDERR,SDATE,SDIV,X,X1 Q
"RTN","RAUTL0",74,0)
 ;
"RTN","RAUTL0",75,0)
STPCDE(RA0,RA1,RA2,RA3,RA4) ; Bulletin for Stop Code Credit error
"RTN","RAUTL0",76,0)
 ; RA0 -> stop code numbers seperated by "^"'s (if not null)
"RTN","RAUTL0",77,0)
 ; RA1 -> Rad/Nuc Med user (DUZ)     RA2 -> Patient   (RADFN)
"RTN","RAUTL0",78,0)
 ; RA3 -> Inverse Xam D/T  (RADTI)   RA4 -> Exam node (RACNI)
"RTN","RAUTL0",79,0)
 Q:'$D(^VA(200,RA1,0))#2  ; invalid user info
"RTN","RAUTL0",80,0)
 Q:'$D(^RADPT(RA2,"DT",RA3,"P",RA4,0))#2  ; exam info incomplete
"RTN","RAUTL0",81,0)
 N RACASE,RADFN,RACPT,RALENFLG,RAI,RAPAT,RAPROC,RAREGX,RASSN,RASTOP
"RTN","RAUTL0",82,0)
 N RAUSER,RAXAM,RAXDT,XMB S RALENFLG=0
"RTN","RAUTL0",83,0)
 S RAUSER=$P($G(^VA(200,RA1,0)),"^"),RADFN=RA2
"RTN","RAUTL0",84,0)
 S RASSN=$$SSN^RAUTL(),RAREGX=$G(^RADPT(RA2,"DT",RA3,0))
"RTN","RAUTL0",85,0)
 S RAXAM=$G(^RADPT(RA2,"DT",RA3,"P",RA4,0)),RACASE=$P(RAXAM,"^")
"RTN","RAUTL0",86,0)
 S RAXDT=$P(RAREGX,"^"),RAPAT=$P($G(^DPT(RA2,0)),"^")
"RTN","RAUTL0",87,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAXAM,"^",2),0))
"RTN","RAUTL0",88,0)
 ;S RACPT(0)=$G(^ICPT(+$P(RAPROC(0),"^",9),0)),RACPT=$P(RACPT(0),"^")
"RTN","RAUTL0",89,0)
 ;S RACPT(4)=+$P(RACPT(0),"^",4),RACPT=$S(RACPT]"":RACPT,1:"Unknown")
"RTN","RAUTL0",90,0)
 ;I RACPT(4),(RACPT]"") S RACPT=RACPT_" (invalid)"
"RTN","RAUTL0",91,0)
 S RACPT(0)=+$P(RAPROC(0),"^",9) ;ien to file 81
"RTN","RAUTL0",92,0)
 S RACPT=$P($$NAMCODE^RACPTMSC(RACPT(0),RAXDT),"^") ;.01 value file 81
"RTN","RAUTL0",93,0)
 S RACPT(4)=$$ACTCODE^RACPTMSC(RACPT(0),RAXDT) ;1=active,0=inactive
"RTN","RAUTL0",94,0)
 I RACPT']"" S RACPT="Unknown"
"RTN","RAUTL0",95,0)
 I 'RACPT(4),(RACPT'="Unknown") S RACPT=RACPT_" (invalid)"
"RTN","RAUTL0",96,0)
 S RAPROC=$E($P(RAPROC(0),"^"),1,45)
"RTN","RAUTL0",97,0)
 S RAPROC=$S(RAPROC]"":RAPROC,1:"Unknown")
"RTN","RAUTL0",98,0)
 I RA0']""!(RA0?1."^") D
"RTN","RAUTL0",99,0)
 . N RAPC S RAPC=+$P($G(^RA(79.1,+RAMLC,"PC")),"^")
"RTN","RAUTL0",100,0)
 . S:RAPC RASTOP="Missing STOP CODE data"
"RTN","RAUTL0",101,0)
 . S:'RAPC RASTOP="No Principal Clinic entered for '"_$P($G(^SC(+$P($G(^RA(79.1,+RAMLC,0)),"^"),0)),"^")_"'."
"RTN","RAUTL0",102,0)
 . Q
"RTN","RAUTL0",103,0)
 E  D
"RTN","RAUTL0",104,0)
 . S RASTOP="" F RAI=1:1:$L(RA0,"^") D  Q:RALENFLG
"RTN","RAUTL0",105,0)
 .. S RASTOP(2)=$P(RA0,"^",RAI) Q:RASTOP(2)']""
"RTN","RAUTL0",106,0)
 .. S RASTOP(1)=$P($G(^DIC(40.7,+$O(^DIC(40.7,"C",RASTOP(2),0)),0)),"^")
"RTN","RAUTL0",107,0)
 .. S RASTOP(3)=RASTOP(2)_" "_RASTOP(1)_",  "
"RTN","RAUTL0",108,0)
 .. I ($L(RASTOP)+$L(RASTOP(3)))>512 S RALENFLG=1 Q:RALENFLG
"RTN","RAUTL0",109,0)
 .. S RASTOP=RASTOP_RASTOP(3)
"RTN","RAUTL0",110,0)
 .. Q
"RTN","RAUTL0",111,0)
 . I $P(RASTOP,",  ",$L(RASTOP,",  "))']"" D
"RTN","RAUTL0",112,0)
 .. S RASTOP=$P(RASTOP,",  ",1,$L(RASTOP,",  ")-1)
"RTN","RAUTL0",113,0)
 .. Q
"RTN","RAUTL0",114,0)
 . Q
"RTN","RAUTL0",115,0)
 ; XMB(1) -> Full patient name          XMB(2) -> patient SSN
"RTN","RAUTL0",116,0)
 ; XMB(3) -> Examination Date           XMB(4) -> Case Number
"RTN","RAUTL0",117,0)
 ; XMB(5) -> Procedure                  XMB(6) -> CPT Code
"RTN","RAUTL0",118,0)
 ; XMB(7) -> Stop Code(s)               XMB(8) -> Rad/Nuc Med user
"RTN","RAUTL0",119,0)
 S XMB(1)=RAPAT,XMB(2)=RASSN,XMB(3)=$$FMTE^XLFDT(RAXDT),XMB(4)=RACASE
"RTN","RAUTL0",120,0)
 S XMB(5)=RAPROC,XMB(6)=RACPT,XMB(7)=RASTOP,XMB(8)=RAUSER
"RTN","RAUTL0",121,0)
 S XMB="RAD/NUC MED CREDIT STOP ERROR"
"RTN","RAUTL0",122,0)
 D ^XMB:$D(^XMB(3.6,"B",XMB))
"RTN","RAUTL0",123,0)
 K XMB0,XMC0,XMDT,XMM,XMMG
"RTN","RAUTL0",124,0)
 Q
"RTN","RAUTL1")
0^1^B42756218^B42401356
"RTN","RAUTL1",1,0)
RAUTL1 ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Utility Routine ;10/22/97  13:54
"RTN","RAUTL1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,9,18,71**;Mar 16, 1998;Build 10
"RTN","RAUTL1",3,0)
 ;last modification by SS for P18 June 19,00
"RTN","RAUTL1",4,0)
 ;02/10/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAUTL1",5,0)
 I "IOSCR"'[X!(X="") S X="Unknown" Q
"RTN","RAUTL1",6,0)
 G @($E(X))
"RTN","RAUTL1",7,0)
 ;Set X=Inpatient Location
"RTN","RAUTL1",8,0)
I S X=$S($D(^DIC(42,+$P(^RADPT(D0,"DT",D1,"P",D2,0),"^",6),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAUTL1",9,0)
 Q
"RTN","RAUTL1",10,0)
 ;
"RTN","RAUTL1",11,0)
 ;Set X=Outpatient Location
"RTN","RAUTL1",12,0)
O S X=$S($D(^SC(+$P(^RADPT(D0,"DT",D1,"P",D2,0),"^",8),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAUTL1",13,0)
 Q
"RTN","RAUTL1",14,0)
 ;
"RTN","RAUTL1",15,0)
 ;Set X=Contract/Sharing Agreement patient location
"RTN","RAUTL1",16,0)
S ;
"RTN","RAUTL1",17,0)
C S X=$S($D(^DIC(34,+$P(^RADPT(D0,"DT",D1,"P",D2,0),"^",9),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAUTL1",18,0)
 Q
"RTN","RAUTL1",19,0)
 ;
"RTN","RAUTL1",20,0)
 ;Set X=Research patient location
"RTN","RAUTL1",21,0)
R S X=$S($D(^RADPT(D0,"DT",D1,"P",D2,"R")):$P(^("R"),"^"),1:"Unknown") Q
"RTN","RAUTL1",22,0)
 ;
"RTN","RAUTL1",23,0)
 ;Set X=time of day in external format (ex: 2:28 PM)
"RTN","RAUTL1",24,0)
NOW S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) D TIME
"RTN","RAUTL1",25,0)
 Q
"RTN","RAUTL1",26,0)
 ;Input X=FM date/time, Output X=time (external format)
"RTN","RAUTL1",27,0)
TIME S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" S:$P(X,":")=0 X=12_":"_$P(X,":",2)
"RTN","RAUTL1",28,0)
 Q
"RTN","RAUTL1",29,0)
 ;
"RTN","RAUTL1",30,0)
ELAPSED ;Pass parameters X (from date) and X1 (to date)
"RTN","RAUTL1",31,0)
 ;Variable Y is returned as either an elapsed time in the form DD:HH:MM where DD=days, HH=hours, MM=minutes or as the string 'Neg. Time' indicating a negative elapsed time
"RTN","RAUTL1",32,0)
 ;Variable Y1 is returned as the # of minutes of elapsed time
"RTN","RAUTL1",33,0)
 I '$D(RAMTIME) S DIC="^DD(""FUNC"",",DIC(0)="FX",RAX=X,X="MINUTES" D ^DIC K DIC S X=RAX S:$D(^DD("FUNC",+Y,1)) RAMTIME=^(1) I '$D(RAMTIME) W *7,!!,"Can't continue --- No 'MINUTES' function found in File Manager" K Y,Y1 G Q
"RTN","RAUTL1",34,0)
 X RAMTIME S Y1=X I X<0 S Y="Neg. Time" G Q
"RTN","RAUTL1",35,0)
MINUTS S X(1)=X\1440,X=X-(1440*X(1)),X(2)=X\60,X(3)=X-(60*X(2)),Y=$E(100+X(1),2,3)_":"_$E(100+X(2),2,3)_":"_$E(100+X(3),2,3)
"RTN","RAUTL1",36,0)
Q K RAX,X Q
"RTN","RAUTL1",37,0)
 ;
"RTN","RAUTL1",38,0)
UPDATE ;Entry point for Update Rad/Nuc Med Exam Status option
"RTN","RAUTL1",39,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAUTL1",40,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1)
"RTN","RAUTL1",41,0)
 I $G(RAIMGTY)="" K XQUIT Q  ; didn't sign-on to an imaging location
"RTN","RAUTL1",42,0)
 D ^RACNLU G UPQ:"^"[X
"RTN","RAUTL1",43,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)),'$D(^XUSEC("RA MGR",DUZ)) W !!?3,*7,"You do not have the appropriate access privileges to act on completed exams." G UPDATE
"RTN","RAUTL1",44,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,*7,"Exam has been 'cancelled' therefore the status cannot be changed." G UPDATE
"RTN","RAUTL1",45,0)
 ;D UP1 I RAOR>0 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"",",DR="100///""NOW""",DR(2,70.07)="2///U;3////"_$S($G(RADUZ):RADUZ,1:DUZ) D ^DIE
"RTN","RAUTL1",46,0)
 D UP1 I RAOR>0 D
"RTN","RAUTL1",47,0)
 .L +^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAUTL1",48,0)
 .N RAIEN
"RTN","RAUTL1",49,0)
 .S RAIENS="+1,"_RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL1",50,0)
 .S RAFDA(70.07,RAIENS,.01)="NOW"
"RTN","RAUTL1",51,0)
 .K RAERR D UPDATE^DIE("E","RAFDA","RAIEN","RAERR")
"RTN","RAUTL1",52,0)
 .K RAFDA,RAIENS
"RTN","RAUTL1",53,0)
 .I $D(RAERR) L -^RADPT(RADFN,"DT",RADTI,"P",RACNI) K RAIEN Q
"RTN","RAUTL1",54,0)
 .S RAIENS=RAIEN(1)_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL1",55,0)
 .S RAFDA(70.07,RAIENS,2)="U"
"RTN","RAUTL1",56,0)
 .S RAFDA(70.07,RAIENS,3)=$S($G(RADUZ):RADUZ,1:DUZ)
"RTN","RAUTL1",57,0)
 .D FILE^DIE(,"RAFDA")
"RTN","RAUTL1",58,0)
 .L -^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAUTL1",59,0)
UPQ K RAFDA,RAIENS
"RTN","RAUTL1",60,0)
 K %,D,DA,DE,DIC,DIE,DQ,DR,I,J,POP,RACS,RAEND,RAF5,RAFL,RAFST,RAI,RAIX,RAJ1,RAORDIFN,RAPRIT,RAHEAD,RASN,RAOR,RASTI,RASSN,RADATE,RAST,RACN,RACNI,RADFN,RADTE,RADTI,RANME,RAPRC,RARPT,X,Y,Z,^TMP($J,"RAEX"),C,DIPGM Q
"RTN","RAUTL1",61,0)
 ;
"RTN","RAUTL1",62,0)
 ;Exam status updating and accompanying updates to status log, oe/rr
"RTN","RAUTL1",63,0)
UP1 N RA8 S RA8=0 ;use this to flag when one alert has been sent
"RTN","RAUTL1",64,0)
 D CMPAFTR^RAO7XX(1) ;P18 if procedure changed in RAEDCN or RAEDPT sends XX message to CPRS if needed
"RTN","RAUTL1",65,0)
 ; RA EDITCN and RA EDITPT should process this case only
"RTN","RAUTL1",66,0)
 I $D(RAOPT("EDITCN"))!($D(RAOPT("EDITPT"))) D UP2,UPK Q
"RTN","RAUTL1",67,0)
 ; see if this case belongs to a printset
"RTN","RAUTL1",68,0)
 N:'$D(RAPRTSET) RAPRTSET N:'$D(RAMEMARR) RAMEMARR
"RTN","RAUTL1",69,0)
 D EN2^RAUTL20(.RAMEMARR) ;043099 always recalculate RAPRTSET
"RTN","RAUTL1",70,0)
 ; if not print set, then just process this case only
"RTN","RAUTL1",71,0)
 I 'RAPRTSET D UP2,UPK Q
"RTN","RAUTL1",72,0)
 ;case belongs to print set, so process all members of same print set
"RTN","RAUTL1",73,0)
 N RACNISAV,RA7
"RTN","RAUTL1",74,0)
 S RACNISAV=RACNI,RA7=0
"RTN","RAUTL1",75,0)
 F  S RA7=$O(RAMEMARR(RA7)) Q:RA7=""  S RACNI=RA7 D UP2
"RTN","RAUTL1",76,0)
 S RACNI=RACNISAV
"RTN","RAUTL1",77,0)
 G UPK
"RTN","RAUTL1",78,0)
UP2 ;Remedy Call 124379 Patch *71 BAY/KAM Added next line
"RTN","RAUTL1",79,0)
 D:$G(RAHLTCPB)'=1 EXM^RAHLRPC
"RTN","RAUTL1",80,0)
 ;
"RTN","RAUTL1",81,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RAUTL1",82,0)
 N RAAFTER,RABEFORE
"RTN","RAUTL1",83,0)
 D STUFF^RASTREQ1 I RAOR<0,$D(RASN) W:'$D(RAONLINE)&('$D(ZTQUEUED)) !?5,"...exam status remains '",RASN,"'." K DIE,RACS,RAPRIT Q
"RTN","RAUTL1",84,0)
 W:'$D(RAONLINE)&('$D(ZTQUEUED)) !?3,"...will now designate exam status as '",RASN,"'... for case no. ",$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U)
"RTN","RAUTL1",85,0)
 ; S DR="3////"_RASTI_$S($P(RAMDV,"^",10):";75///^S X=$$MIDNGHT^RAUTL5($$NOW^XLFDT())",1:"")
"RTN","RAUTL1",86,0)
 ; user duz could be in RADUZ, if session is from the Voice recognition
"RTN","RAUTL1",87,0)
 ;S DR(2,70.05)=$S($P(RAMDV,"^",11)&('$D(ZTQUEUED)):".01;",1:"")_"2////"_RASTI_";3////"_$S($G(RADUZ):RADUZ,1:DUZ)
"RTN","RAUTL1",88,0)
 ;D ^DIE
"RTN","RAUTL1",89,0)
 L +^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAUTL1",90,0)
 N RAIEN
"RTN","RAUTL1",91,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL1",92,0)
 S RAFDA(70.03,RAIENS,3)=RASTI
"RTN","RAUTL1",93,0)
 K RAERR D FILE^DIE(,"RAFDA","RAERR")
"RTN","RAUTL1",94,0)
 I $D(RAERR) L -^RADPT(RADFN,"DT",RADTI,"P",RACNI) G UP2K ;L - P18
"RTN","RAUTL1",95,0)
 I $P(RAMDV,"^",10) D
"RTN","RAUTL1",96,0)
 .S RAIENS="+1,"_RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL1",97,0)
 .S RAFDA(70.05,RAIENS,.01)=$$MIDNGHT^RAUTL5($$NOW^XLFDT())
"RTN","RAUTL1",98,0)
 .D UPDATE^DIE(,"RAFDA","RAIEN")
"RTN","RAUTL1",99,0)
 .K RAFDA,RAIENS
"RTN","RAUTL1",100,0)
 .Q:'$D(RAIEN(1))
"RTN","RAUTL1",101,0)
 .I $P(RAMDV,"^",11),('$D(ZTQUEUED)) D
"RTN","RAUTL1",102,0)
 ..S DIE=DIE_RACNI_",""T"",",DA=RAIEN(1)
"RTN","RAUTL1",103,0)
 ..S DR=".01"
"RTN","RAUTL1",104,0)
 ..D ^DIE
"RTN","RAUTL1",105,0)
 .S RAIENS=RAIEN(1)_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL1",106,0)
 .S RAFDA(70.05,RAIENS,2)=RASTI
"RTN","RAUTL1",107,0)
 .S RAFDA(70.05,RAIENS,3)=$S($G(RADUZ):RADUZ,1:DUZ)
"RTN","RAUTL1",108,0)
 .K RAERR2 D FILE^DIE(,"RAFDA")
"RTN","RAUTL1",109,0)
 L -^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAUTL1",110,0)
 ;
"RTN","RAUTL1",111,0)
UP2K K DE,DQ,DIE,DR,RAFDA,RAIENS K:$D(RAERR) RACS,RAPRIT Q:$D(RAERR)  W:'$D(RAONLINE)&('$D(ZTQUEUED)) !?10,"...exam status ",$S($G(RABEFORE)>$G(RAAFTER):"backed down",1:"successfully updated"),"." D ^RAORDC
"RTN","RAUTL1",112,0)
 I RA8=0,$D(^RA(72,RASTI,"ALERT")),$P(^("ALERT"),"^")="y" D:$$ORVR^RAORDU()=2.5 OERR D:$$ORVR^RAORDU()'<3 OERR3 S RA8=1
"RTN","RAUTL1",113,0)
 I $D(^RA(72,RASTI,0)),$P(^(0),"^",3)>1,RACS'="Y",$S('$D(RAF5):1,$P(^DIC(42,+RAF5,0),U,3)="D":1,1:0) D EN^RAUTL0
"RTN","RAUTL1",114,0)
 K RACS,RAORDIFN,RAPRIT,RAF5
"RTN","RAUTL1",115,0)
 Q
"RTN","RAUTL1",116,0)
UPK K ORIFN,ORVP,ORNOTE,ORBPMSG,RACS,RAORDIFN,RAPRIT,RAF5
"RTN","RAUTL1",117,0)
 Q
"RTN","RAUTL1",118,0)
OERR ;Send Alert to OERR after pt examined
"RTN","RAUTL1",119,0)
 S ORVP=RADFN_";DPT(",ORBPMSG="Rad Pt Examined - "_$S($D(^RAMIS(71,RAPRIT,0)):$E($P(^(0),"^"),1,24),1:"Unknown") S:$D(^RAO(75.1,+RAORDIFN,0)) ORIFN=+$P(^(0),"^",7) S ORNOTE(21)=$S($D(ORIFN):1,1:"") D NOTE^ORX3
"RTN","RAUTL1",120,0)
 Q
"RTN","RAUTL1",121,0)
OERR3 ; Send RADIOLOGY PATIENT EXAMINED notification via oe/rr v3
"RTN","RAUTL1",122,0)
 ; Called from UP1
"RTN","RAUTL1",123,0)
 ;
"RTN","RAUTL1",124,0)
 ; RADFN,RADTI,RACNI,RAPRIT must be defined
"RTN","RAUTL1",125,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))!('$D(RAPRIT))
"RTN","RAUTL1",126,0)
 ;
"RTN","RAUTL1",127,0)
 N RAIENS,RAMSG,RAOIFN,RAOSTS,RAONODE,RADPTNDE,RAREQPHY
"RTN","RAUTL1",128,0)
 S RADPTNDE=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAUTL1",129,0)
 S RAOIFN=$P(RADPTNDE,U,11) Q:'RAOIFN  ;file 75.1 ien
"RTN","RAUTL1",130,0)
 S RAONODE=$G(^RAO(75.1,+RAOIFN,0))
"RTN","RAUTL1",131,0)
 S RAOSTS=$P(RAONODE,U,5) Q:RAOSTS'=6  ;active exams only
"RTN","RAUTL1",132,0)
 S RAOIFN=$P(RAONODE,U,7) ;file 100 ien
"RTN","RAUTL1",133,0)
 S RAREQPHY=+$P(RADPTNDE,U,14) ;ordering provider
"RTN","RAUTL1",134,0)
 S RAREQPHY(RAREQPHY)=""
"RTN","RAUTL1",135,0)
 S RAMSG="Imaging Pt Examined - "_$S($D(^RAMIS(71,RAPRIT,0)):$E($P(^(0),U),1,24),1:"Unknown"),RAMSG=$E(RAMSG,1,51)
"RTN","RAUTL1",136,0)
 S RAIENS=RADTI_"~"_RACNI
"RTN","RAUTL1",137,0)
 ;
"RTN","RAUTL1",138,0)
 ; oe parameters:
"RTN","RAUTL1",139,0)
 ;         ORN: notification id (#100.9 ien)
"RTN","RAUTL1",140,0)
 ;         |     ORBDFN: patient id (#2 ien)
"RTN","RAUTL1",141,0)
 ;         |     |     ORNUM: order number (#100 ien)
"RTN","RAUTL1",142,0)
 ;         |     |     |        ORBADUZ: recipient array
"RTN","RAUTL1",143,0)
 ;         |     |     |        |     ORBPMSG: message text
"RTN","RAUTL1",144,0)
 ;         |     |     |        |     |      ORBPDATA exam dt~case iens
"RTN","RAUTL1",145,0)
 ;         |     |     |        |     |      |
"RTN","RAUTL1",146,0)
 D EN^ORB3(21,RADFN,RAOIFN,.RAREQPHY,RAMSG,RAIENS)
"RTN","RAUTL1",147,0)
 Q
"RTN","RAUTL1",148,0)
 ;
"RTN","RAUTL1",149,0)
 ;Called by many report programs. Sets RACRT() array containing all
"RTN","RAUTL1",150,0)
 ;exam statuses that are to be included on the report.  RACRT is set
"RTN","RAUTL1",151,0)
 ;to the piece of the Exam Status File #72 record that corresponds
"RTN","RAUTL1",152,0)
 ;to the report being generated.
"RTN","RAUTL1",153,0)
CRIT F I=0:0 S I=$O(^RA(72,I)) Q:'I  I $D(^(I,.3)),$P(^(.3),"^",RACRT)="y" S RACRT(I)=""
"RTN","RAUTL1",154,0)
 Q
"VER")
8.0^22.0
"BLD",5979,6)
^64
**END**
**END**
