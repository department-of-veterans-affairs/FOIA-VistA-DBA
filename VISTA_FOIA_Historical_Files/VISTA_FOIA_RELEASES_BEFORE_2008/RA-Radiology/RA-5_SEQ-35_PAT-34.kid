Released RA*5*34 SEQ #35
Extracted from mail message
**KIDS**:RA*5.0*34^

**INSTALL NAME**
RA*5.0*34
"BLD",3698,0)
RA*5.0*34^RADIOLOGY/NUCLEAR MEDICINE^0^3030417^y
"BLD",3698,1,0)
^^1^1^3030207^^^^
"BLD",3698,1,1,0)
Please see patch description of this patch for details.
"BLD",3698,4,0)
^9.64PA^71^3
"BLD",3698,4,71,0)
71
"BLD",3698,4,71,2,0)
^9.641^71^1
"BLD",3698,4,71,2,71,0)
RAD/NUC MED PROCEDURES  (File-top level)
"BLD",3698,4,71,2,71,1,0)
^9.6411^.01^1
"BLD",3698,4,71,2,71,1,.01,0)
NAME
"BLD",3698,4,71,222)
y^n^p^^^^n^^n
"BLD",3698,4,71,224)

"BLD",3698,4,78.3,0)
78.3
"BLD",3698,4,78.3,2,0)
^9.641^78.3^1
"BLD",3698,4,78.3,2,78.3,0)
DIAGNOSTIC CODES  (File-top level)
"BLD",3698,4,78.3,2,78.3,1,0)
^9.6411^.01^1
"BLD",3698,4,78.3,2,78.3,1,.01,0)
DIAGNOSTIC CODE
"BLD",3698,4,78.3,222)
y^n^p^^^^n
"BLD",3698,4,79.2,0)
79.2
"BLD",3698,4,79.2,2,0)
^9.641^79.2^1
"BLD",3698,4,79.2,2,79.2,0)
IMAGING TYPE  (File-top level)
"BLD",3698,4,79.2,2,79.2,1,0)
^9.6411^.16^5
"BLD",3698,4,79.2,2,79.2,1,.11,0)
ACTIVITY LOG CUT-OFF
"BLD",3698,4,79.2,2,79.2,1,.12,0)
REPORT CUT-OFF
"BLD",3698,4,79.2,2,79.2,1,.13,0)
CLINICAL HISTORY CUT-OFF
"BLD",3698,4,79.2,2,79.2,1,.14,0)
TRACKING TIME CUT-OFF
"BLD",3698,4,79.2,2,79.2,1,.16,0)
ORDER DATA CUT-OFF
"BLD",3698,4,79.2,222)
y^n^p^^^^n
"BLD",3698,4,"APDD",71,71)

"BLD",3698,4,"APDD",71,71,.01)

"BLD",3698,4,"APDD",78.3,78.3)

"BLD",3698,4,"APDD",78.3,78.3,.01)

"BLD",3698,4,"APDD",79.2,79.2)

"BLD",3698,4,"APDD",79.2,79.2,.11)

"BLD",3698,4,"APDD",79.2,79.2,.12)

"BLD",3698,4,"APDD",79.2,79.2,.13)

"BLD",3698,4,"APDD",79.2,79.2,.14)

"BLD",3698,4,"APDD",79.2,79.2,.16)

"BLD",3698,4,"B",71,71)

"BLD",3698,4,"B",78.3,78.3)

"BLD",3698,4,"B",79.2,79.2)

"BLD",3698,"ABPKG")
n
"BLD",3698,"INID")
^n
"BLD",3698,"INIT")
RA34PST
"BLD",3698,"KRN",0)
^9.67PA^8989.52^19
"BLD",3698,"KRN",.4,0)
.4
"BLD",3698,"KRN",.401,0)
.401
"BLD",3698,"KRN",.402,0)
.402
"BLD",3698,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",3698,"KRN",.402,"NM",1,0)
RA ORDER EXAM    FILE #75.1^75.1^0
"BLD",3698,"KRN",.402,"NM",2,0)
RA QUICK EXAM ORDER    FILE #75.1^75.1^0
"BLD",3698,"KRN",.402,"NM",3,0)
RA OUTSIDE EDIT    FILE #70^70^0
"BLD",3698,"KRN",.402,"NM","B","RA ORDER EXAM    FILE #75.1",1)

"BLD",3698,"KRN",.402,"NM","B","RA OUTSIDE EDIT    FILE #70",3)

"BLD",3698,"KRN",.402,"NM","B","RA QUICK EXAM ORDER    FILE #75.1",2)

"BLD",3698,"KRN",.403,0)
.403
"BLD",3698,"KRN",.5,0)
.5
"BLD",3698,"KRN",.84,0)
.84
"BLD",3698,"KRN",3.6,0)
3.6
"BLD",3698,"KRN",3.8,0)
3.8
"BLD",3698,"KRN",9.2,0)
9.2
"BLD",3698,"KRN",9.8,0)
9.8
"BLD",3698,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",3698,"KRN",9.8,"NM",1,0)
RAPURGE^^0^B21540175
"BLD",3698,"KRN",9.8,"NM",2,0)
RAPURGE1^^0^B28095039
"BLD",3698,"KRN",9.8,"NM",3,0)
RARECOV^^0^B35385406
"BLD",3698,"KRN",9.8,"NM",4,0)
RARESTOR^^0^B14369253
"BLD",3698,"KRN",9.8,"NM",5,0)
RART1^^0^B58301617
"BLD",3698,"KRN",9.8,"NM",6,0)
RAMAINP^^0^B38763457
"BLD",3698,"KRN",9.8,"NM",7,0)
RAPRINT1^^0^B25798821
"BLD",3698,"KRN",9.8,"NM",8,0)
RARTE^^0^B24025418
"BLD",3698,"KRN",9.8,"NM",9,0)
RAUTL11^^0^B43977760
"BLD",3698,"KRN",9.8,"NM",10,0)
RAUTL14^^0^B12249440
"BLD",3698,"KRN",9.8,"NM",11,0)
RAUTL20^^0^B31321948
"BLD",3698,"KRN",9.8,"NM",12,0)
RAEDCN^^0^B64227954
"BLD",3698,"KRN",9.8,"NM",13,0)
RASTREQ1^^0^B6580098
"BLD",3698,"KRN",9.8,"NM","B","RAEDCN",12)

"BLD",3698,"KRN",9.8,"NM","B","RAMAINP",6)

"BLD",3698,"KRN",9.8,"NM","B","RAPRINT1",7)

"BLD",3698,"KRN",9.8,"NM","B","RAPURGE",1)

"BLD",3698,"KRN",9.8,"NM","B","RAPURGE1",2)

"BLD",3698,"KRN",9.8,"NM","B","RARECOV",3)

"BLD",3698,"KRN",9.8,"NM","B","RARESTOR",4)

"BLD",3698,"KRN",9.8,"NM","B","RART1",5)

"BLD",3698,"KRN",9.8,"NM","B","RARTE",8)

"BLD",3698,"KRN",9.8,"NM","B","RASTREQ1",13)

"BLD",3698,"KRN",9.8,"NM","B","RAUTL11",9)

"BLD",3698,"KRN",9.8,"NM","B","RAUTL14",10)

"BLD",3698,"KRN",9.8,"NM","B","RAUTL20",11)

"BLD",3698,"KRN",19,0)
19
"BLD",3698,"KRN",19.1,0)
19.1
"BLD",3698,"KRN",101,0)
101
"BLD",3698,"KRN",409.61,0)
409.61
"BLD",3698,"KRN",771,0)
771
"BLD",3698,"KRN",870,0)
870
"BLD",3698,"KRN",8989.51,0)
8989.51
"BLD",3698,"KRN",8989.52,0)
8989.52
"BLD",3698,"KRN",8994,0)
8994
"BLD",3698,"KRN","B",.4,.4)

"BLD",3698,"KRN","B",.401,.401)

"BLD",3698,"KRN","B",.402,.402)

"BLD",3698,"KRN","B",.403,.403)

"BLD",3698,"KRN","B",.5,.5)

"BLD",3698,"KRN","B",.84,.84)

"BLD",3698,"KRN","B",3.6,3.6)

"BLD",3698,"KRN","B",3.8,3.8)

"BLD",3698,"KRN","B",9.2,9.2)

"BLD",3698,"KRN","B",9.8,9.8)

"BLD",3698,"KRN","B",19,19)

"BLD",3698,"KRN","B",19.1,19.1)

"BLD",3698,"KRN","B",101,101)

"BLD",3698,"KRN","B",409.61,409.61)

"BLD",3698,"KRN","B",771,771)

"BLD",3698,"KRN","B",870,870)

"BLD",3698,"KRN","B",8989.51,8989.51)

"BLD",3698,"KRN","B",8989.52,8989.52)

"BLD",3698,"KRN","B",8994,8994)

"BLD",3698,"QUES",0)
^9.62^^
"BLD",3698,"REQB",0)
^9.611^4^4
"BLD",3698,"REQB",1,0)
RA*5.0*27^2
"BLD",3698,"REQB",2,0)
RA*5.0*19^2
"BLD",3698,"REQB",3,0)
RA*5.0*31^2
"BLD",3698,"REQB",4,0)
RA*5.0*35^2
"BLD",3698,"REQB","B","RA*5.0*19",2)

"BLD",3698,"REQB","B","RA*5.0*27",1)

"BLD",3698,"REQB","B","RA*5.0*31",3)

"BLD",3698,"REQB","B","RA*5.0*35",4)

"FIA",71)
RAD/NUC MED PROCEDURES
"FIA",71,0)
^RAMIS(71,
"FIA",71,0,0)
71I
"FIA",71,0,1)
y^n^p^^^^n^^n
"FIA",71,0,10)

"FIA",71,0,11)

"FIA",71,0,"RLRO")

"FIA",71,0,"VR")
5.0^RA
"FIA",71,71)
1
"FIA",71,71,.01)

"FIA",78.3)
DIAGNOSTIC CODES
"FIA",78.3,0)
^RA(78.3,
"FIA",78.3,0,0)
78.3
"FIA",78.3,0,1)
y^n^p^^^^n
"FIA",78.3,0,10)

"FIA",78.3,0,11)

"FIA",78.3,0,"RLRO")

"FIA",78.3,0,"VR")
5.0^RA
"FIA",78.3,78.3)
1
"FIA",78.3,78.3,.01)

"FIA",79.2)
IMAGING TYPE
"FIA",79.2,0)
^RA(79.2,
"FIA",79.2,0,0)
79.2
"FIA",79.2,0,1)
y^n^p^^^^n
"FIA",79.2,0,10)

"FIA",79.2,0,11)

"FIA",79.2,0,"RLRO")

"FIA",79.2,0,"VR")
5.0^RA
"FIA",79.2,79.2)
1
"FIA",79.2,79.2,.11)

"FIA",79.2,79.2,.12)

"FIA",79.2,79.2,.13)

"FIA",79.2,79.2,.14)

"FIA",79.2,79.2,.16)

"INIT")
RA34PST
"KRN",.402,225,-1)
0^3
"KRN",.402,225,0)
RA OUTSIDE EDIT^3021220.1159^^70^^^3030121
"KRN",.402,225,"%D",0)
^.4021^1^1^3021223^^^^
"KRN",.402,225,"%D",1,0)
This template is used for editing information on outside film tracking.
"KRN",.402,225,"DR",1,70)
I $D(^DPT(DA,.1)),^(.1)]"" W !?3,*7,"Patient is currently an inpatient." S RAPTFL="";S RAPOP=0 D USER^RAUTL S:RAPOP Y="@99";50;@99;K RAPOP,RADUZ,RAPTFL;
"KRN",.402,225,"DR",2,70.06)
100///^S X="""NOW""";S:$P(^RADPT(DA(1),"O",DA,0),U,5)'="Y" Y="@10";6;I X'["Y" W !?3,*7,"Cannot return films without supervisor's OK!" S Y="@20";@10;
"KRN",.402,225,"DR",2,70.06,1)
I $D(RAPTFL) W !?3,"Do you want to specify a 'RETURNED DATE' even though...",!?35,"...patient is an inpatient? No// " R X:DTIME W ! S:X="" X="N" S:"Yy"'[$E(X,1) Y="@20";@15;3;@20;2;@30;4;20;
"KRN",.402,225,"DR",3,70.08)
2///^S X="E";3////^S X=RADUZ;
"KRN",.402,244,-1)
0^1
"KRN",.402,244,0)
RA ORDER EXAM^3020911.1542^^75.1^^^3030120
"KRN",.402,244,"%D",0)
^^1^1^2940607^
"KRN",.402,244,"%D",1,0)
This template is used to request an imaging exam.
"KRN",.402,244,"DIAB",1,0,75.1,19)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,244,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,244,"DIAB",2,0,75.1,0)
2//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");REQ
"KRN",.402,244,"DIAB",2,0,75.1,12)
12//^S X="TODAY";T
"KRN",.402,244,"DIAB",3,0,75.1,2)
8;REQ
"KRN",.402,244,"DIAB",7,0,75.1,17)
24//^S X="NO";T
"KRN",.402,244,"DIAB",9,0,75.1,9)
9.5//^S X=$S($D(RARSH):RARSH,1:"");REQ
"KRN",.402,244,"DIAB",12,0,75.1,9)
9//^S X=$S($D(RASHA):RASHA,1:"");REQ
"KRN",.402,244,"DR",1,75.1)
I '$D(RACAT)!('$D(RADFN))!('$D(RADIV))!('$D(RALIFN))!('$D(RAPIFN)) W !?3,*7,"Variables RACAT,RADFN,RADIV,RALIFN and RAPIFN must be defined!" S Y="@999";2R~//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");S RAPRI=X;
"KRN",.402,244,"DR",1,75.1,1)
S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y=$S('$D(^RA(79,+RADIV,.1)):"@2",$P(^(.1),"^",7)="Y"&($P(^RAMIS(71,RAPRI,0),"^",6)="B"):"@1",1:"@2");@1;W !?3,*7,"A 'detailed' procedure or a 'series' of procedures is required!" S Y="";@2;
"KRN",.402,244,"DR",1,75.1,2)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $P(^RAMIS(71,RAPRI,0),"^",11)'="y" S Y="@3";8R~;@3;I '$D(RAMOD) S Y="@7";S RAI="";@5;S RAI=$O(RAMOD(0)) I 'RAI S Y="@7";S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));
"KRN",.402,244,"DR",1,75.1,3)
S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@8";125///^S X=RAMOD(RAI);@8;K RAMOD(RAI) S Y="@5";@7;125;@9;3////^S X=$P(RAIMAG,U);I $D(^RA(79,+RADIV,"HIS")) W !!?3,*7,^("HIS"),!;
"KRN",.402,244,"DR",1,75.1,4)
I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);@10;400;I $D(DIRUT) S Y="@999";
"KRN",.402,244,"DR",1,75.1,5)
I '$D(^RAO(75.1,DA,"H")) W !?3,*7,"Please enter a clinical history which corresponds to this request!" S Y="@10";S RAWPFLAG=$$VALWP^RAUTL5("^RAO(75.1,"_DA_",""H"",");
"KRN",.402,244,"DR",1,75.1,6)
I 'RAWPFLAG W !!?3,$C(7),"Text must be at least two (2) alphanumeric characters in length.",! S Y="@10";I $P($G(^RAO(75.1,DA,"H",0)),U,3)>350 W ?3,*7,"Clinical History cannot exceed 350 lines!" S Y="@10";
"KRN",.402,244,"DR",1,75.1,7)
I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");14////^S X=RAPIFN;@20;4//^S X=RACAT;S RAX=$E(X,1),Y=$S(RAX="R":"@30","CS"[RAX:"@40",RAX="I"&($D(RAWARD))!("EO"[RAX&('$D(RAWARD))):"@50",1:"@25");@25;
"KRN",.402,244,"DR",1,75.1,8)
I $D(RAWARD) W !?3,*7,"Please choose 'I' for INPATIENT, 'R' RESEARCH, 'C' CONTRACT,",!?3,"'S' SHARING!";I '$D(RAWARD) W !?3,*7,"Please choose 'O' for OUTPATIENT, 'E' EMPLOYEE, 'R' RESEARCH,",!?3,"'C' CONTRACT, 'S' SHARING!";
"KRN",.402,244,"DR",1,75.1,9)
D CS^RAORD1A I $D(RALIFN("OUT")) S Y="@26";I '$D(RALIFN("NO")) S Y="@50";K RALIFN("NO");@26;4///@;K RALIFN("OUT");S Y="@20";@30;9.5R~//^S X=$S($D(RARSH):RARSH,1:"");S Y="@50";@40;9R~//^S X=$S($D(RASHA):RASHA,1:"");@50;
"KRN",.402,244,"DR",1,75.1,10)
I RAX="I",($P($G(^SC(+RALIFN,0)),U,3)'="W"),($P($G(^SC(+RALIFN,0)),U,3)'="OR") S RAWHEN=$P($G(^RAO(75.1,DA,0)),U,21),RAWHEN=$S(RAWHEN]"":$P(RAWHEN,".",1),1:DT) D REQLOC1^RAORD1A;
"KRN",.402,244,"DR",1,75.1,11)
I RAX="O",($P($G(^SC(+RALIFN,0)),U,3)'="C"),($P($G(^SC(+RALIFN,0)),U,3)'="OR") D REQLOC1^RAORD1A;I $D(RALIFN("OUT")) K RALIFN("OUT") S Y="@999";22////^S X=RALIFN;@100;
"KRN",.402,244,"DR",1,75.1,12)
W !,"IS PATIENT SCHEDULED FOR PRE-OP" S %=2 D YN^DICN S:%<0 Y="@999" S:%=2 Y="@120" I '% W !!,"Enter 'YES' if patient is scheduled for pre-op, or 'NO' if not.",! S Y="@100";12T~//^S X="TODAY";S:$D(RAEXMUL) RAPREOP1=X;@120;
"KRN",.402,244,"DR",1,75.1,13)
I RASEX="M" S Y="@130";
"KRN",.402,244,"DR",1,75.1,14)
I RASEX'="F" W !,"THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE" S %=2 D YN^DICN S:%<0 Y="@999" S:%=2 Y="@130" I '% W !!,"Enter 'YES' if patient is female, or 'NO' if patient is male.",! S Y="@120";S RASEX="F";
"KRN",.402,244,"DR",1,75.1,15)
13//^S X=$S($D(RAPREG):$$EXTERNAL^DILFD(75.1,13,"",RAPREG),1:"");S RAPREG=X;@130;I '$D(RAVSTFLG)!('$D(RAVLEDTI)) S Y="@135";17///^S X=9999999.9999-RAVLEDTI;@135;@140;I '$D(RARDTE) S Y="@145";21////^S X=RARDTE;@145;
"KRN",.402,244,"DR",1,75.1,16)
21//^S X=$S($D(RAWHEN):$$FMTE^XLFDT(RAWHEN,1),1:"TODAY");I $D(RAEXMUL) S Y=X D DD^%DT S RAWHEN=Y,Y="@150";@150;5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";
"KRN",.402,244,"DR",1,75.1,17)
S Y=$S('$D(^RA(79,+RADIV,.1)):"@160",$P(^(.1),"^",19)="y":"@155",1:"@160");@155;75///^S X="""NOW""";@160;19//^S X=$S($D(RAMT):$P(RAMT,"^",2),1:"AMBULATORY");S:$D(RAEXMUL) RAMT=X;24T~//^S X="NO";S:$D(RAEXMUL) RAIP=X;
"KRN",.402,244,"DR",1,75.1,18)
6//^S X="ROUTINE";S:$D(RAEXMUL) RARU=X;S:$$ORVR^RAORDU()<3 Y="@163";26//^S X="SERVICE CORRECTION";@163;W !;S RAREQLOC=$$ILOC^RAUTL18(RAPRI);I 'RAREQLOC S Y="@165";20////^S X=RAREQLOC;S Y="@170";@165;I '$D(RALOCFLG) S Y="@175";
"KRN",.402,244,"DR",1,75.1,19)
20R~SUBMIT REQUEST TO~;@170;S:$D(RAEXMUL) RAILOC=X;@175;S (RAFIN,RAFIN1)="";@999;K RAI,RAPRI,RAMOD,RAIMAG,RAWPFLAG,RAREQLOC,RAMODPRO;
"KRN",.402,244,"DR",2,75.1125)
.01
"KRN",.402,244,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,244,"ROU")
^RACTOE
"KRN",.402,244,"ROUOLD")
RACTOE
"KRN",.402,1005,-1)
0^2
"KRN",.402,1005,0)
RA QUICK EXAM ORDER^3020911.1559^^75.1^^^3030414
"KRN",.402,1005,"%D",0)
^^2^2^2940607^
"KRN",.402,1005,"%D",1,0)
This template is used in conjunction with OE/RR for ordering imaging
"KRN",.402,1005,"%D",2,0)
exams.
"KRN",.402,1005,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,1005,"DIAB",3,0,75.1,1)
8;REQ
"KRN",.402,1005,"DIAB",6,0,75.1,5)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,1005,"DR",1,75.1)
I '$D(RAPRI) S Y="@10";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y="@20";@10;D ^RAPRI;S:'$D(RAPRI) Y="@99";S:$E(RAPRI)="^"!('RAPRI) Y="@99";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);@20;
"KRN",.402,1005,"DR",1,75.1,1)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $S('$D(^RAMIS(71,RAPRI,0)):1,1:$P(^(0),"^",11)'="y") S Y="@23";8R~;@23;I '$D(RAMOD) S Y="@35";S RAI="";@25;S RAI=$O(RAMOD(0)) I 'RAI S Y="@35";
"KRN",.402,1005,"DR",1,75.1,2)
S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@30";125///^S X=RAMOD(RAI);@30;K RAMOD(RAI) S Y="@25";@35;I '$D(RACAT) S RACAT="I";4////^S X=$E(RACAT);
"KRN",.402,1005,"DR",1,75.1,3)
I '$D(RAPREOP1) S Y="@40";12///^S X=RAPREOP1;@40;I '$D(RAPREG) S Y="@50";13///^S X=RAPREG;@50;I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);
"KRN",.402,1005,"DR",1,75.1,4)
I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");I '$D(RAWHEN) S RAWHEN="TODAY";21///^S X=RAWHEN;I $S('$D(RAILOC):1,'RAILOC:1,1:0) S Y="@60";20////^S X=RAILOC;S Y="@70";@60;S RAREQLOC=$$ILOC^RAUTL18(RAPRI);
"KRN",.402,1005,"DR",1,75.1,5)
I 'RAREQLOC S Y="@62";20////^S X=RAREQLOC;S Y="@67";@62;I '$D(RALOCFLG) S Y="@70";20R~SUBMIT REQUEST TO~;@67;S:$D(RAEXMUL) RAILOC=X;@70;3////^S X=$P(RAIMAG,U);14////^S X=RAPIFN;S RAX=$P(^RAO(75.1,DA,0),U,4);
"KRN",.402,1005,"DR",1,75.1,6)
I RAX="I",$P($G(^SC(+RALIFN,0)),U,3)'="W",($P($G(^SC(+RALIFN,0)),U,3)'="OR") S RAWHEN=$P(^RAO(75.1,DA,0),U,21),RAWHEN=$S(RAWHEN]"":$P(RAWHEN,".",1),1:DT) D REQLOC1^RAORD1A;
"KRN",.402,1005,"DR",1,75.1,7)
I RAX="O",$P($G(^SC(+RALIFN,0)),U,3)'="C",($P($G(^SC(+RALIFN,0)),U,3)'="OR") D REQLOC1^RAORD1A;I $D(RALIFN("OUT")) K RALIFN("OUT") S Y="@99";22////^S X=RALIFN;5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";
"KRN",.402,1005,"DR",1,75.1,8)
75///^S X="""NOW""";I '$D(RAMT) S RAMT="a";19////^S X=$P(RAMT,"^");I '$D(RAIP) S RAIP="n";24////^S X=RAIP;I '$D(RARU) S RARU=9;6////^S X=RARU;S:$$ORVR^RAORDU()<3 Y="@80";26////s;@80;S RAFIN=1;@99;
"KRN",.402,1005,"DR",1,75.1,9)
K RAI,RAPRI,RAMOD,RAIMAG,RAREQLOC,RAMODPRO;
"KRN",.402,1005,"DR",2,75.1125)
.01
"KRN",.402,1005,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,1005,"ROU")
^RACTQE
"KRN",.402,1005,"ROUOLD")
RACTQE
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3011017^2980407^50
"PKG",18,22,1,"PAH",1,0)
34^3030417
"PKG",18,22,1,"PAH",1,1,0)
^^1^1^3030417
"PKG",18,22,1,"PAH",1,1,1,0)
Please see patch description of this patch for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","RA34PST")
0^^B14727549
"RTN","RA34PST",1,0)
RA34PST ;HOIFO/SWM-Post install to correct entries in file 71 ;1/28/03  07:54
"RTN","RA34PST",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RA34PST",3,0)
QOFF ;Post-Install queues off File 71 Name correction job
"RTN","RA34PST",4,0)
 I '$D(XPDNM)#2 D EN^DDIOL("This entry point must be called from the KIDS installation -- Nothing Done.",,"!!,$C(7)") Q
"RTN","RA34PST",5,0)
 I +$G(DUZ)=0 D EN^DDIOL("DUZ isn't defined -- Nothing Done.",,"!!,$C(7)")
"RTN","RA34PST",6,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO=""
"RTN","RA34PST",7,0)
 S ZTRTN="EN^RA34PST"
"RTN","RA34PST",8,0)
 S ZTDESC="RA*5.0*34 File 71 Name correction job"
"RTN","RA34PST",9,0)
 S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT(),0,0,2,0) ;add 2 minutes to 'now'
"RTN","RA34PST",10,0)
 D ^%ZTLOAD S RATXT(1)=" "
"RTN","RA34PST",11,0)
 S RATXT(2)="RA*5.0*34 File 71 Name correction is running in background."
"RTN","RA34PST",12,0)
 S:$G(ZTSK)>0 RATXT(3)="Task: "_ZTSK_"."
"RTN","RA34PST",13,0)
 S RATXT(4)=" "
"RTN","RA34PST",14,0)
 S RATXT(5)="The results will be sent to your mailbox."
"RTN","RA34PST",15,0)
 S RATXT(6)=" "
"RTN","RA34PST",16,0)
 D MES^XPDUTL(.RATXT)
"RTN","RA34PST",17,0)
 Q
"RTN","RA34PST",18,0)
MANUAL ;manually queue off Name correction job, only use if post-install abends
"RTN","RA34PST",19,0)
 I +$G(DUZ)=0 D EN^DDIOL("DUZ isn't defined -- Nothing Done.",,"!!,$C(7)") Q
"RTN","RA34PST",20,0)
ASKQ K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RA34PST",21,0)
 N RAX
"RTN","RA34PST",22,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RA34PST",23,0)
 S DIR("?")="Enter 'Y' if you want to queue the File 71 Name correction job."
"RTN","RA34PST",24,0)
 S DIR("A")="Do you want to start routine RA34PST to correct File 71 procedure names"
"RTN","RA34PST",25,0)
 D ^DIR
"RTN","RA34PST",26,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RA34PST",27,0)
 Q:'Y  ;don't queue if answer is NO
"RTN","RA34PST",28,0)
 D EN^DDIOL("The results will be sent to your mailmox.",,"!!,$C(7)")
"RTN","RA34PST",29,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO=""
"RTN","RA34PST",30,0)
 S ZTRTN="EN^RA34PST"
"RTN","RA34PST",31,0)
 S ZTDESC="MANUAL File 71 Name correction -- routine RA34PST"
"RTN","RA34PST",32,0)
 S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT(),0,0,2,0) ;add 2 minutes to 'now'
"RTN","RA34PST",33,0)
 D ^%ZTLOAD
"RTN","RA34PST",34,0)
 D EN^DDIOL("RA*5.0*34 File 71 Name correction will start in 2 minutes in the background.",,"!,$C(7)")
"RTN","RA34PST",35,0)
 I $G(ZTSK)>0 S RAX="Task: "_ZTSK D EN^DDIOL(RAX,,"!,$C(7)")
"RTN","RA34PST",36,0)
 Q
"RTN","RA34PST",37,0)
EN ; LOOP THRU FILE 71, FIELD .01
"RTN","RA34PST",38,0)
 ; remove SEMICOLON from it
"RTN","RA34PST",39,0)
 ; if proc is active, then call PROC^RAO7MFN to update OI file
"RTN","RA34PST",40,0)
 N RAI,RAX,RA1,RA2,RA3,RAFDA,RASTAT,RAY,RACTOT,RAC1,RAC2,RABADTOT,RAC
"RTN","RA34PST",41,0)
 S (RAI,RACTOT,RAC1,RAC2,RABADTOT,RAC)=0
"RTN","RA34PST",42,0)
SLOOP S RAI=$O(^RAMIS(71,RAI)) G:'RAI EXLOOP
"RTN","RA34PST",43,0)
 S RAX=$G(^RAMIS(71,RAI,0)) G:RAX="" SLOOP
"RTN","RA34PST",44,0)
 S RACTOT=RACTOT+1
"RTN","RA34PST",45,0)
 S RA1=$P(RAX,"^")
"RTN","RA34PST",46,0)
 I (RA1[";") D 
"RTN","RA34PST",47,0)
 . L +^RAMIS(71,RAI,0):0 I '$T D  Q
"RTN","RA34PST",48,0)
 .. S RA3="Can't lock ^RAMIS(71,"_RAI_",0), so "_RA1_" isn't changed."
"RTN","RA34PST",49,0)
 .. D STOR
"RTN","RA34PST",50,0)
 .. S RABADTOT=RABADTOT+1
"RTN","RA34PST",51,0)
 .. Q
"RTN","RA34PST",52,0)
 . S RA2=$TR(RA1,";",",") ; new string
"RTN","RA34PST",53,0)
 . Q:$O(^RAMIS(71,"B",RA2,0))  ; skip if new string already exists
"RTN","RA34PST",54,0)
 . S RA3="^RAMIS(71,"_RAI_",0)'s "_RA1_" will be "_RA2 D STOR
"RTN","RA34PST",55,0)
 . D REMOV,CPRS
"RTN","RA34PST",56,0)
 . L -^RAMIS(71,RAI,0)
"RTN","RA34PST",57,0)
 . Q
"RTN","RA34PST",58,0)
 G SLOOP
"RTN","RA34PST",59,0)
EXLOOP S RA3=" " D STOR
"RTN","RA34PST",60,0)
 S RA3="File 71, RAD/NUC MED PROCEDURES, has been checked." D STOR
"RTN","RA34PST",61,0)
 S RA3=" " D STOR
"RTN","RA34PST",62,0)
 S RA3="No. records checked:                 "_$J(RACTOT,7) D STOR
"RTN","RA34PST",63,0)
 S RA3="No. records had semicolon corrected: "_$J(RAC1,7) D STOR
"RTN","RA34PST",64,0)
 S RA3="No. records updated in file 101.43:  "_$J(RAC2,7) D STOR
"RTN","RA34PST",65,0)
 S RA3="No. records locked and not updated:  "_$J(RABADTOT,7) D STOR
"RTN","RA34PST",66,0)
 D MAIL
"RTN","RA34PST",67,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RA34PST",68,0)
 Q
"RTN","RA34PST",69,0)
STOR ; store messages and totals
"RTN","RA34PST",70,0)
 Q:$G(RA3)=""
"RTN","RA34PST",71,0)
 S RAC=RAC+1,^TMP($J,"RA34PST",RAC)=RA3
"RTN","RA34PST",72,0)
 Q
"RTN","RA34PST",73,0)
REMOV ; remove ";"
"RTN","RA34PST",74,0)
 S RAC1=RAC1+1
"RTN","RA34PST",75,0)
 S RAFDA(71,RAI_",",.01)=RA2
"RTN","RA34PST",76,0)
 D FILE^DIE("E","RAFDA")
"RTN","RA34PST",77,0)
 K RAFDA
"RTN","RA34PST",78,0)
 Q
"RTN","RA34PST",79,0)
CPRS ; update record in Orderable Items file 101.43
"RTN","RA34PST",80,0)
 Q:$$ORQUIK^RAORDU()'=1  ;skip update if no Order Dialog file 101.41
"RTN","RA34PST",81,0)
 ; skip if inactive
"RTN","RA34PST",82,0)
 I $S('$D(^RAMIS(71,RAI,"I")):0,^("I")="":0,+^("I")>DT:0,1:1) Q
"RTN","RA34PST",83,0)
 S RAC2=RAC2+1
"RTN","RA34PST",84,0)
 S RASTAT="1^1"
"RTN","RA34PST",85,0)
 S RAY=RAI_"^"_RA2
"RTN","RA34PST",86,0)
 D PROC^RAO7MFN(0,71,RASTAT,RAY)
"RTN","RA34PST",87,0)
 Q
"RTN","RA34PST",88,0)
MAIL ; Send mail message to the installer
"RTN","RA34PST",89,0)
 N XMDUZ,XMSUB,XMTEXT,XMY S XMDUZ=.5
"RTN","RA34PST",90,0)
 S XMTEXT="^TMP($J,""RA34PST""," ;only numeric nodes are mailed
"RTN","RA34PST",91,0)
 S XMSUB="Results from routine RA34PST"
"RTN","RA34PST",92,0)
 S XMY(DUZ)="" D ^XMD
"RTN","RA34PST",93,0)
 Q
"RTN","RAEDCN")
0^12^B64227954
"RTN","RAEDCN",1,0)
RAEDCN ;HISC/CAH,FPT,GJC,SS AISC/MJK,RMO-Edit Exams by Case Number ;1/11/02  11:15
"RTN","RAEDCN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,13,10,18,28,31,34**;Mar 16, 1998
"RTN","RAEDCN",3,0)
 ;last modified by SS JUNE 21,2000 for P18
"RTN","RAEDCN",4,0)
START D SET^RAPSET1 I $D(XQUIT) K XQUIT,RAFLG,RADR,POP,RAQUICK Q
"RTN","RAEDCN",5,0)
START1 D ^RACNLU G Q:X="^"
"RTN","RAEDCN",6,0)
 I RADR="[RA DIAGNOSTIC BY CASE]" N RAPRTSET,RAMEMARR,RA3 D EN2^RAUTL20(.RAMEMARR) S RA3=99 I RAPRTSET W ! D WHYMSG2^RASTED G Q  ;skip edit because member of set =2
"RTN","RAEDCN",7,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)),'$D(^XUSEC("RA MGR",+$G(DUZ))) W !!?3,$C(7),"You do not have the appropriate access privileges to edit completed exams." G START1
"RTN","RAEDCN",8,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,$C(7),"Exam has been 'cancelled' therefore it cannot be edited." G START1
"RTN","RAEDCN",9,0)
 I RADR="[RA DIAGNOSTIC BY CASE]",$D(^RARPT(RARPT,0)),$P(^(0),"^",5)="V" W !!?3,$C(7),"A report has been verified for this exam, therefore it cannot be edited.",! G START
"RTN","RAEDCN",10,0)
 S DA=RADFN,DIE("NO^")="OUTOK",DIE="^RADPT(",DR=RADR
"RTN","RAEDCN",11,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D  G:+$G(RAXIT) START1
"RTN","RAEDCN",12,0)
 . S RADADA=RADTI,RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RAEDCN",13,0)
 . S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",14,0)
 . Q
"RTN","RAEDCN",15,0)
 I RADR="[RA EXAM EDIT]" D
"RTN","RAEDCN",16,0)
 . N RADISPLY
"RTN","RAEDCN",17,0)
 . S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since diff col
"RTN","RAEDCN",18,0)
 . S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAEDCN",19,0)
 . W !,?24,RADISPLY
"RTN","RAEDCN",20,0)
 . Q
"RTN","RAEDCN",21,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare it in RAUTL1 later
"RTN","RAEDCN",22,0)
 D ^DIE K DIE("NO^"),DE,DQ,DIE,DR
"RTN","RAEDCN",23,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" UP1^RAUTL1
"RTN","RAEDCN",24,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D UNLOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",25,0)
 K RADUZ,RAZZ W ! G START1:'+$G(RAXIT)
"RTN","RAEDCN",26,0)
 ;
"RTN","RAEDCN",27,0)
Q K %,%DT,%W,%X,%Y,%Y1,A,C,D0,D1,D2,DA,DIC,DIE,DIV,DK,I,ORIFN,ORVP,POP,RACN,RACNI,RACS,RACT,RADADA,RADATE,RADFN,RADIE,RADIV,RADR,RADTE,RADTI,RAEXFM,RAEXLBLS,RAFIN,RAFL,RAFLG,RAFLH,RAFLHFL,RAHEAD,RAI,RAJ
"RTN","RAEDCN",28,0)
 K RAMES,RANME,RANUM,RAOIFN,RAOR,RAORDIFN,RAOREA,RAORIFN,RAOSEL,RAOSTS,RAPOP,RAPRI,RAPRC,RAQUICK,RAPRIT,RARPT,RARPTZ,RASN,RASSN,RAST,RASTI,RAVW,X,XQUIT,VAINDT,VADMVT,Y,^TMP($J,"RAEX")
"RTN","RAEDCN",29,0)
 K %H,%I,D,D3,DDER,DI,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,GMRAL
"RTN","RAEDCN",30,0)
 K J,SDCLST,R1,RA,RACANC,RACN0,RACPT,RACPTNDE,RADA,RAEND,RAFELIG,RAFST
"RTN","RAEDCN",31,0)
 K RAIX,RAN,RAOBR4,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RAXIT,VA,VADM,VAERR,Z
"RTN","RAEDCN",32,0)
 K DFN,DIPGM,DISYS,DQ,DR,HLN,HLRESLT,HLSAN,RAAFTER,RABEFORE,X0
"RTN","RAEDCN",33,0)
 K DLAYGO,DDH,RADFLTP
"RTN","RAEDCN",34,0)
 Q
"RTN","RAEDCN",35,0)
 ;
"RTN","RAEDCN",36,0)
DIAG N RADIAG,RAXIT
"RTN","RAEDCN",37,0)
 S RAXIT=0,RAFLG("DIAG")="",RADR="[RA DIAGNOSTIC BY CASE]" G START
"RTN","RAEDCN",38,0)
 ;
"RTN","RAEDCN",39,0)
SAVE S RADR="[RA NO PURGE SPECIFICATION]" G START
"RTN","RAEDCN",40,0)
 ;
"RTN","RAEDCN",41,0)
EDIT ; Case No. Exam Edit
"RTN","RAEDCN",42,0)
 N RAEDIT,RAXIT
"RTN","RAEDCN",43,0)
 N REM,RANUZD1,RAPSDRUG,RA00,RADIOPH,RALOW,RAHI,RADRAWN,RAASK,RADOSE,RASKMEDS,RAWHICH ;these are used by the edit template
"RTN","RAEDCN",44,0)
 S RAXIT=0,RAFLG("EDIT")="",RAQUICK=1,RADR="[RA EXAM EDIT]" G START
"RTN","RAEDCN",45,0)
 ;
"RTN","RAEDCN",46,0)
CANCEL D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RAEDCN",47,0)
 S RAXIT=$$CKREASON^RAEDCN1("C") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN",48,0)
 D ^RACNLU G Q:X="^" I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !?3,$C(7),"This exam has already been cancelled!" G Q
"RTN","RAEDCN",49,0)
 I $D(^RA(72,+RAST,0)),$P(^(0),"^",6)'="y" W !?3,$C(7),"This exam is in the '",$P(^(0),"^"),"' status and cannot be 'CANCELLED'." G Q
"RTN","RAEDCN",50,0)
ASKIMG I RARPT,($$STUB^RAEDCN1(RARPT)) D  G:"Nn"[$E(X) Q G:"Yy"[$E(X) ASKCAN W:X'["?" $C(7) W !!?3,"Enter 'YES' to cancel an exam with images, or 'NO' not to." G ASKIMG
"RTN","RAEDCN",51,0)
 . S X=RANME_"'s Case No. "_$E(RADTE,4,7)_$E(RADTE,1,2)_"-"_RACN
"RTN","RAEDCN",52,0)
 . W !!?10,"----------------------------------",$C(7)
"RTN","RAEDCN",53,0)
 . W !?10,X
"RTN","RAEDCN",54,0)
 . W !?10,"This exam has associated images.",$C(7)
"RTN","RAEDCN",55,0)
 . W !?10,"----------------------------------",$C(7)
"RTN","RAEDCN",56,0)
 . I '$D(^XUSEC("RA MGR",DUZ)) D  S X="N" Q
"RTN","RAEDCN",57,0)
 .. W !!?3,"** You do not have the  RA MGR  key to cancel an exam with images. **",$C(7)
"RTN","RAEDCN",58,0)
 .. R !!?10,"Press RETURN to continue.",X:DTIME
"RTN","RAEDCN",59,0)
 .. Q
"RTN","RAEDCN",60,0)
 . R !!,"Do you really want to cancel this exam with images? NO//",X:DTIME S:'$T!(X="")!(X["^") X="N"
"RTN","RAEDCN",61,0)
 . Q
"RTN","RAEDCN",62,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore cancellation is not allowed!" G Q
"RTN","RAEDCN",63,0)
ASKCAN R !!,"Do you wish to cancel this exam now? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G Q:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to cancel this exam, or 'NO' not to." G ASKCAN
"RTN","RAEDCN",64,0)
 N REM ;used for remarks within edit template
"RTN","RAEDCN",65,0)
 L +^RADPT(RADFN):1 I '$T W !,$C(7),"Someone else is editing the patient you selected",!,"Please try later" K RADTE,RACN,RAPOP,RADUZ G Q
"RTN","RAEDCN",66,0)
 S DA=RADFN,DR="[RA CANCEL]",DIE="^RADPT(" D ^DIE K DE,DQ,DIE,DR
"RTN","RAEDCN",67,0)
 K RADTE,RACN,RAPOP,RADUZ ;moved from edit template
"RTN","RAEDCN",68,0)
PACS I '$D(Y),$D(RAFIN) W !?10,"...cancellation complete." D DELPNT^RAUTL20(RADFN,RADTI,RACNI),^RAORDC,CANCEL^RAHLRPC
"RTN","RAEDCN",69,0)
 L -^RADPT(RADFN)
"RTN","RAEDCN",70,0)
 G Q
"RTN","RAEDCN",71,0)
 ;
"RTN","RAEDCN",72,0)
DEL ; 'Exam Deletion' option (RA DELETEXAM)
"RTN","RAEDCN",73,0)
 D SETVARS Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN",74,0)
 S RAXIT=$$CKREASON^RAEDCN1("D") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN",75,0)
DEL1 D ^RACNLU G Q:X="^"
"RTN","RAEDCN",76,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore deletion is not allowed!" G DEL1
"RTN","RAEDCN",77,0)
ASKDEL R !!,"Do you wish to delete this exam? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G DEL1:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!,"Enter 'YES' to delete this exam, or 'NO' not to." G ASKDEL
"RTN","RAEDCN",78,0)
 L +^RADPT(RADFN,"DT",RADTI):1 I '$T W !,$C(7),"Someone else is editing an exam for this patient on the date/time",!,"you selected. Please try Later" G DEL1
"RTN","RAEDCN",79,0)
 S RADELFLG="" D ^RAORDC
"RTN","RAEDCN",80,0)
 ; trigger RA CANCEL protocol on xam delete if xam not already cancelled
"RTN","RAEDCN",81,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),X=+$P(RA7003,"^",3)
"RTN","RAEDCN",82,0)
 ; no rpt filed, xam status exists & not cancelled -OR- xam status
"RTN","RAEDCN",83,0)
 ; non-existent.
"RTN","RAEDCN",84,0)
 I $P($G(^RA(72,X,0)),U,3)'=0 D
"RTN","RAEDCN",85,0)
 . K RAIENS,RAERR S RAIENS=""_RACNI_","_RADTI_","_RADFN_","_"",RAFDA(70.03,RAIENS,3)="CANCELLED" D FILE^DIE("KSE","RAFDA","RAERR") K RAIENS,RAERR,RAFDA D CANCEL^RAHLRPC
"RTN","RAEDCN",86,0)
 . Q
"RTN","RAEDCN",87,0)
 K RA7003 S RABULL="",DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAEDCN",88,0)
 S DIK="^RADPT(DA(2),""DT"",DA(1),""P""," D ^DIK
"RTN","RAEDCN",89,0)
 W !?10,"...deletion of exam complete."
"RTN","RAEDCN",90,0)
 K %,D,D0,D1,D2,DA,DIC,DIK,RADELFLG,RABULL,RAPRTZ,RAAFTER,RABEFORE
"RTN","RAEDCN",91,0)
 ; Check if one exam or multiple exams exists below "DT" node.
"RTN","RAEDCN",92,0)
 ; If no exams are present, delete "DT" node.
"RTN","RAEDCN",93,0)
 I '+$O(^RADPT(RADFN,"DT",RADTI,"P",0)) D
"RTN","RAEDCN",94,0)
 . K DA,DIK S DA(1)=RADFN,DA=RADTI
"RTN","RAEDCN",95,0)
 . S DIK="^RADPT(DA(1),""DT""," D ^DIK
"RTN","RAEDCN",96,0)
 . K DA,DIK Q
"RTN","RAEDCN",97,0)
 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RAEDCN",98,0)
 G DEL1
"RTN","RAEDCN",99,0)
 ;
"RTN","RAEDCN",100,0)
VIEW ; 'View Exam by Case No.' option (RA VIEWCN)
"RTN","RAEDCN",101,0)
 D SETVARS Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN",102,0)
 S RAVW="" D ^RACNLU G Q:X="^" K RAFL D ^RAPROD D Q G VIEW
"RTN","RAEDCN",103,0)
 ;
"RTN","RAEDCN",104,0)
DUP ; Option: RA FLASH
"RTN","RAEDCN",105,0)
 N RAREGX,RAYN D SET^RAPSET1 I $D(XQUIT) K XQUIT,POP Q
"RTN","RAEDCN",106,0)
DUP1 D ^RACNLU G Q:X="^"
"RTN","RAEDCN",107,0)
 G Q:'$D(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",108,0)
 S RAREGX(0)=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",109,0)
 S RAREGX(4)=+$P(RAREGX(0),"^",4)
"RTN","RAEDCN",110,0)
 I +$G(RAMLC)'=RAREGX(4) D  I $P(RAYN,"^",2) D Q QUIT
"RTN","RAEDCN",111,0)
 . W !!?3,"Your sign-on location is: "
"RTN","RAEDCN",112,0)
 . W $P($G(^SC(+$G(^RA(79.1,+$G(RAMLC),0)),0)),"^")_".  The location"
"RTN","RAEDCN",113,0)
 . W !?3,"of case ",RACN," is "
"RTN","RAEDCN",114,0)
 . W $P($G(^SC(+$G(^RA(79.1,RAREGX(4),0)),0)),"^"),".",!
"RTN","RAEDCN",115,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="Yes"
"RTN","RAEDCN",116,0)
 . S DIR("?")="Enter 'Y'es to switch locations or 'N'o exit the option."
"RTN","RAEDCN",117,0)
 . S DIR("A")="Do you wish to switch Imaging Locations" D ^DIR
"RTN","RAEDCN",118,0)
 . S RAYN=+Y_"^"_$S($D(DIRUT):1,1:0)
"RTN","RAEDCN",119,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT  Q:'+RAYN  ; quit if no
"RTN","RAEDCN",120,0)
 . D KILL^RAPSET1,SET^RAPSET1 ; else switch locations
"RTN","RAEDCN",121,0)
 . I $D(XQUIT) S $P(RAYN,"^",2)=1 K XQUIT
"RTN","RAEDCN",122,0)
 . Q
"RTN","RAEDCN",123,0)
 S ION=$P(RAMLC,"^",3) ; imaging location flash card printer (if any)
"RTN","RAEDCN",124,0)
 G Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y=^(0),Y=$S($D(^RAMIS(71,+$P(Y,"^",2),0)):$P(^(0),"^",3),1:"")
"RTN","RAEDCN",125,0)
 ; if Y, then convert the pointer value 'Y' to the .01 value of
"RTN","RAEDCN",126,0)
 ; the procedure flash card printer (if any)
"RTN","RAEDCN",127,0)
 I Y]"",$D(^%ZIS(1,+Y,0)) D
"RTN","RAEDCN",128,0)
 . S Y(0)=$$GET1^DIQ(3.5,+Y,.01) ; .01 value for proc flash card printer
"RTN","RAEDCN",129,0)
 . S:Y(0)'=$P(RAMLC,"^",3) ION=Y(0) K Y(0)
"RTN","RAEDCN",130,0)
 . ; if flash card printer for the imaging location differs from
"RTN","RAEDCN",131,0)
 . ; the procedure flash card printer, default (print to) to the flash
"RTN","RAEDCN",132,0)
 . ; card printer for the procedure.
"RTN","RAEDCN",133,0)
 . Q
"RTN","RAEDCN",134,0)
 S RAMES="W !!,""Duplicates queued to print on "",ION,"".""",RAFLH=$S($P(RAMLC,"^",7):$P(RAMLC,"^",7),1:1),RAEXFM=$S($P(RAMLC,"^",9):$P(RAMLC,"^",9),1:1),RAFLHFL=RACNI
"RTN","RAEDCN",135,0)
FLH ; Flash Cards
"RTN","RAEDCN",136,0)
 R !,"How many flash cards? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RANUM=X I '(RANUM?.N)!(RANUM>20) W !?3,$C(7),"Must be a whole number less than 21!" G FLH
"RTN","RAEDCN",137,0)
EXM ; Exam Labels
"RTN","RAEDCN",138,0)
 R !,"How many exam labels? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RAEXLBLS=X I '(RAEXLBLS?.N)!(RAEXLBLS>20) W !?3,$C(7),"Must be a whole number less than 21!" G EXM
"RTN","RAEDCN",139,0)
 S IOP="Q" S:ION]"" RADFLTP=ION
"RTN","RAEDCN",140,0)
 K RAFL D Q^RAFLH,Q G DUP1
"RTN","RAEDCN",141,0)
 ;
"RTN","RAEDCN",142,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAEDCN",143,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAEDCN",144,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAEDCN",145,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAEDCN",146,0)
 Q
"RTN","RAMAINP")
0^6^B38763457
"RTN","RAMAINP",1,0)
RAMAINP ;HISC/GJC AISC/TMP,RMO-Utility Files Print ;9/22/98  15:26
"RTN","RAMAINP",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**3,19,34**;Mar 16, 1998
"RTN","RAMAINP",3,0)
2 ;;Long Active Procedure List
"RTN","RAMAINP",4,0)
 D KILL N RAX,RAY,RA1,RA2,RA3 S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP",5,0)
 S RAY="Rad/Nuc Med Active Procedures (Long)"
"RTN","RAMAINP",6,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PROCEDURE LIST]"
"RTN","RAMAINP",7,0)
 S BY=.01,(FR,TO)=""
"RTN","RAMAINP",8,0)
 S DHD="Active Radiology/Nuclear Medicine Procedures (Long)"
"RTN","RAMAINP",9,0)
 S DHIT="S $P(RALINE,""-"",(IOM+1))="""" W !,RALINE"
"RTN","RAMAINP",10,0)
 S DIS(0)="I $S('$D(^RAMIS(71,D0,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),($$IMG^RAMAINP(D0))"
"RTN","RAMAINP",11,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",12,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",13,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",14,0)
 E  D ENTASK
"RTN","RAMAINP",15,0)
 Q
"RTN","RAMAINP",16,0)
 ;
"RTN","RAMAINP",17,0)
3 ;;Major AMIS Code Print
"RTN","RAMAINP",18,0)
 S DIC="^RAMIS(71.1,",L=0,FLDS=".001,.01,2",FR="",TO="",BY=".001",DHD="Major AMIS Codes" D EN1^DIP K FLDS,BY,FR,TO,DHD,POP Q
"RTN","RAMAINP",19,0)
 ;
"RTN","RAMAINP",20,0)
4 ;;Film Sizes Print
"RTN","RAMAINP",21,0)
 S DIC="^RA(78.4,",L=0,FLDS="[RA FILM SIZE]",BY="",TO="",FR=""
"RTN","RAMAINP",22,0)
 D EN1^DIP K BY,DIJ,DP,FLDS,FR,P,TO,X,POP Q
"RTN","RAMAINP",23,0)
 ;
"RTN","RAMAINP",24,0)
5 ;;Diagnostic Code Print
"RTN","RAMAINP",25,0)
 S DIC="^RA(78.3,",L=0,FLDS="[RA DIAGNOSTIC CODE PRINT]",BY=".001",FR="",TO="",DHD="Diagnostic Codes" D EN1^DIP K FLDS,BY,FR,TO,DHD,POP Q
"RTN","RAMAINP",26,0)
 ;
"RTN","RAMAINP",27,0)
6 ;;Flash Card/Label Formatter Print
"RTN","RAMAINP",28,0)
 S L=0,DIC="^RA(78.2,",FLDS="[RA FLASH PRINT]",BY="[RA FLASH PRINT]",FR="",TO="",DHD="Exam Label/Report Header/Report Footer/Flash Card Formats" D EN1^DIP K L,FLDS,BY,FR,TO,DHD,POP Q
"RTN","RAMAINP",29,0)
 ;
"RTN","RAMAINP",30,0)
7 ;;Complication Type Print
"RTN","RAMAINP",31,0)
 S L=0,DIC="^RA(78.1,",FLDS=".01,2",BY="",FR="",TO="",DHD="Complication Types" D EN1^DIP K %DT,%X,%Y,FLDS,BY,FR,TO,DHD,POP,ZTSK Q
"RTN","RAMAINP",32,0)
 ;
"RTN","RAMAINP",33,0)
8 ;;Contract/Sharing Agreements Print
"RTN","RAMAINP",34,0)
 S DIC="^DIC(34,",L=0,FLDS=".01,2,3",BY="",TO="",FR="",DHD="Contract/Sharing Agreements" D EN1^DIP K BY,DHD,FLDS,FR,POP,TO,X Q
"RTN","RAMAINP",35,0)
 ;
"RTN","RAMAINP",36,0)
9 ;;Short Active Procedure List
"RTN","RAMAINP",37,0)
 D KILL N RAX,RAY,RA1,RA2 S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP",38,0)
 S RAY="Rad/Nuc Med Active Procedures (Short)"
"RTN","RAMAINP",39,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PROCEDURE SHORT LIST]"
"RTN","RAMAINP",40,0)
 S BY=.01,(FR,TO)=""
"RTN","RAMAINP",41,0)
 S DHD="Active Radiology/Nuclear Medicine Procedures (Short)"
"RTN","RAMAINP",42,0)
 S DIS(0)="I $S('$D(^RAMIS(71,D0,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),($$IMG^RAMAINP(D0))"
"RTN","RAMAINP",43,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",44,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",45,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",46,0)
 E  D ENTASK
"RTN","RAMAINP",47,0)
 Q
"RTN","RAMAINP",48,0)
 ;
"RTN","RAMAINP",49,0)
10 ;;Long Inactive Procedure List
"RTN","RAMAINP",50,0)
 D KILL N RAX,RAY,RA1,RA2,RA3 S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP",51,0)
 S RAY="Rad/Nuc Med Inactive Procedures (Long)"
"RTN","RAMAINP",52,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PROCEDURE LIST]"
"RTN","RAMAINP",53,0)
 S BY=.01,(FR,TO)=""
"RTN","RAMAINP",54,0)
 S DHD="Inactive Radiology/Nuclear Medicine Procedures (Long)"
"RTN","RAMAINP",55,0)
 S DHIT="S $P(RALINE,""-"",(IOM+1))="""" W !,RALINE"
"RTN","RAMAINP",56,0)
 S DIS(0)="I $S('$D(^RAMIS(71,D0,""I"")):0,'^(""I""):0,DT'>^(""I""):0,1:1),($$IMG^RAMAINP(D0))"
"RTN","RAMAINP",57,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",58,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",59,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",60,0)
 E  D ENTASK
"RTN","RAMAINP",61,0)
 Q
"RTN","RAMAINP",62,0)
 ;
"RTN","RAMAINP",63,0)
11 ;;Short Inactive Procedure List
"RTN","RAMAINP",64,0)
 D KILL N RAX,RAY
"RTN","RAMAINP",65,0)
 S RAX=$$IMG^RAUTL12() I 'RAX D KILL Q
"RTN","RAMAINP",66,0)
 S RAY="Rad/Nuc Med Inactive Procedures (Short)"
"RTN","RAMAINP",67,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PROCEDURE SHORT LIST]"
"RTN","RAMAINP",68,0)
 S BY=.01,(FR,TO)=""
"RTN","RAMAINP",69,0)
 S DHD="Inactive Radiology/Nuclear Medicine Procedures (Short)"
"RTN","RAMAINP",70,0)
 S DIS(0)="I $S('$D(^RAMIS(71,D0,""I"")):0,'^(""I""):0,DT'>^(""I""):0,1:1),($$IMG^RAMAINP(D0))"
"RTN","RAMAINP",71,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",72,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",73,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",74,0)
 E  D ENTASK
"RTN","RAMAINP",75,0)
 Q
"RTN","RAMAINP",76,0)
 ;
"RTN","RAMAINP",77,0)
12 ;;Series Procedures Only
"RTN","RAMAINP",78,0)
 D KILL N RAX,RAY,RA1,RA2,RA3
"RTN","RAMAINP",79,0)
 S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP",80,0)
 S RAY="Rad/Nuc Med Series Procedures Only"
"RTN","RAMAINP",81,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PROCEDURE LIST]",BY="[RA SERIES ONLY]"
"RTN","RAMAINP",82,0)
 S DHD="Radiology/Nuclear Medicine Procedures (Series Only)"
"RTN","RAMAINP",83,0)
 S DHIT="S $P(RALINE,""-"",(IOM+1))="""" W !,RALINE"
"RTN","RAMAINP",84,0)
 S DIS(0)="I $S('$D(^RAMIS(71,D0,""I"")):1,'^(""I""):1,DT'>^(""I""):0,1:0),($$IMG^RAMAINP(D0))"
"RTN","RAMAINP",85,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",86,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",87,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",88,0)
 E  D ENTASK
"RTN","RAMAINP",89,0)
 Q
"RTN","RAMAINP",90,0)
 ;
"RTN","RAMAINP",91,0)
13 ;;Standard Reports List
"RTN","RAMAINP",92,0)
 S DIC="^RA(74.1,",L=0,FLDS="[RA STANDARD REPORTS LIST]",BY="#.001",FR="",TO="" D EN1^DIP
"RTN","RAMAINP",93,0)
 K BY,DHD,FLDS,FR,POP,TO,X Q
"RTN","RAMAINP",94,0)
 ;
"RTN","RAMAINP",95,0)
14 ;;Procedure Modifiers Print
"RTN","RAMAINP",96,0)
 S DIC="^RAMIS(71.2,",L=0,FLDS=".01,4",FR="",TO="",BY="3;S1,.01"
"RTN","RAMAINP",97,0)
 S DHD="Procedure Modifiers" D EN1^DIP
"RTN","RAMAINP",98,0)
 K FLDS,BY,FR,TO,DHD,POP,DD00 Q
"RTN","RAMAINP",99,0)
 ;
"RTN","RAMAINP",100,0)
15 ;;Alpha List of Active Procedures
"RTN","RAMAINP",101,0)
 D KILL N RAX,RAY,RA1,RA2 S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP",102,0)
 S RAY="Rad/Nuc Med Alpha List of Active Procedures"
"RTN","RAMAINP",103,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA ALPHA LIST OF ACTIVES]"
"RTN","RAMAINP",104,0)
 S BY="[RA ALPHA LIST OF ACTIVES]",(FR,TO)=""
"RTN","RAMAINP",105,0)
 S DIS(0)="I $$IMG^RAMAINP(D0)"
"RTN","RAMAINP",106,0)
 W ! D 132 S RAPOP=$$ZIS(RAY)
"RTN","RAMAINP",107,0)
 I +RAPOP D HOME^%ZIS,KILL Q  ; device selection failed
"RTN","RAMAINP",108,0)
 I +$P(RAPOP,"^",2) D KILL Q
"RTN","RAMAINP",109,0)
 E  D ENTASK
"RTN","RAMAINP",110,0)
 Q
"RTN","RAMAINP",111,0)
 ;
"RTN","RAMAINP",112,0)
16 ;;Reports Distribution List
"RTN","RAMAINP",113,0)
 S DIC="^RABTCH(74.3,",L=0,FLDS="[RA DISTRIBUTION]",BY=".01",(TO,FR)="" D EN1^DIP K BY,DHD,FLDS,FR,POP,TO,X,X1 Q
"RTN","RAMAINP",114,0)
17 ;;Rad/Nuc Med Procedure Message List
"RTN","RAMAINP",115,0)
 S DIC="^RAMIS(71.4,",L=0,FLDS=".01;S;W70",BY=.01,(FR,TO)="" D EN1^DIP K D0,FLDS,BY,FR,TO,DHD Q
"RTN","RAMAINP",116,0)
132 W !,"This report requires a 132 column output device."
"RTN","RAMAINP",117,0)
 Q
"RTN","RAMAINP",118,0)
KILL ; Kill locals, and set ZTREQ if applicable.
"RTN","RAMAINP",119,0)
 K ^TMP($J,"RA I-TYPE"),%X,%XX,%Y,%YY
"RTN","RAMAINP",120,0)
 K %ZIS,BY,DHD,DHIT,DIC,DIS,DTOUT,DUOUT,FLDS,FR,L,POP,RAIOP,RALINE,RAPOP
"RTN","RAMAINP",121,0)
 K TO,X,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","RAMAINP",122,0)
 K RADIO,RAPHARM,I,POP
"RTN","RAMAINP",123,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RAMAINP",124,0)
 Q
"RTN","RAMAINP",125,0)
IMG(RA) ; Screens procedures by I-Type.  Called from the following
"RTN","RAMAINP",126,0)
 ; subroutines: 2,9,10,11,12 & 15.  Contained in variable DIS(0)!
"RTN","RAMAINP",127,0)
 ; 'RA' is the ien of file 71.
"RTN","RAMAINP",128,0)
 ; return '1' if procedure is correct I-Type, else '0'!
"RTN","RAMAINP",129,0)
 N RAI,RAII S RAI=+$P($G(^RAMIS(71,RA,0)),"^",12)
"RTN","RAMAINP",130,0)
 Q:'RAI 0
"RTN","RAMAINP",131,0)
 S RAII=$P($G(^RA(79.2,RAI,0)),"^")
"RTN","RAMAINP",132,0)
 Q $S($D(^TMP($J,"RA I-TYPE",RAII,RAI))#2:1,1:0)
"RTN","RAMAINP",133,0)
ENTASK ; Entry point for tasked job.
"RTN","RAMAINP",134,0)
 ; All necessary variables are defined by the code calling ENTASK.
"RTN","RAMAINP",135,0)
 S RAIOP=ION_";"_IOST_";"_IOM_";"_IOSL,IOP=RAIOP
"RTN","RAMAINP",136,0)
 D EN1^DIP
"RTN","RAMAINP",137,0)
 D KILL^RAMAINP
"RTN","RAMAINP",138,0)
 Q
"RTN","RAMAINP",139,0)
ZIS(RA) ; Select a device
"RTN","RAMAINP",140,0)
 ; RAPOP=device selection successful ^ '^%ZTLOAD' called 1-yes
"RTN","RAMAINP",141,0)
 N RAPOP
"RTN","RAMAINP",142,0)
 K %ZIS,IOP S %ZIS="NMQ" W ! S %ZIS("A")="DEVICE: " D ^%ZIS
"RTN","RAMAINP",143,0)
 S RAPOP=POP_"^"
"RTN","RAMAINP",144,0)
 I '+RAPOP,($D(IO("Q"))) D
"RTN","RAMAINP",145,0)
 . K IO("Q") S ZTDESC=RA,ZTRTN="ENTASK^RAMAINP"
"RTN","RAMAINP",146,0)
 . D ZTSAVE,^%ZTLOAD S $P(RAPOP,"^",2)=1
"RTN","RAMAINP",147,0)
 . I +$G(ZTSK) W !?3,"Request Queued, Task #: ",$G(ZTSK)
"RTN","RAMAINP",148,0)
 . D HOME^%ZIS
"RTN","RAMAINP",149,0)
 . Q
"RTN","RAMAINP",150,0)
 Q RAPOP
"RTN","RAMAINP",151,0)
ZTSAVE ; Save variables for tasked job
"RTN","RAMAINP",152,0)
 N I F I="BY","DIC","FLDS","FR","L","TO" S ZTSAVE(I)=""
"RTN","RAMAINP",153,0)
 S:($D(DIS)\10) ZTSAVE("DIS(")=""
"RTN","RAMAINP",154,0)
 S:($D(DHD)#2) ZTSAVE("DHD")=""
"RTN","RAMAINP",155,0)
 S:($D(DHIT)#2) ZTSAVE("DHIT")=""
"RTN","RAMAINP",156,0)
 S:($D(^TMP($J,"RA I-TYPE"))\10) ZTSAVE("^TMP($J,""RA I-TYPE"",")=""
"RTN","RAMAINP",157,0)
 Q
"RTN","RAPRINT1")
0^7^B25798821
"RTN","RAPRINT1",1,0)
RAPRINT1 ;HISC/FPT-Abnormal Exam Report (cont.) ;4/5/96  10:49
"RTN","RAPRINT1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RAPRINT1",3,0)
DIV ; walk through tmp global, start with 'division'
"RTN","RAPRINT1",4,0)
 Q:'$D(^TMP($J))
"RTN","RAPRINT1",5,0)
 N RAFIRST,RAPRTSET,RASAME,RACURR,RAPREV,L1
"RTN","RAPRINT1",6,0)
 S RADIVNME=""
"RTN","RAPRINT1",7,0)
 F  S RADIVNME=$O(^TMP($J,RADIVNME)) Q:RADIVNME=""!(RAOUT)  D IT
"RTN","RAPRINT1",8,0)
 Q
"RTN","RAPRINT1",9,0)
IT ; imaging type
"RTN","RAPRINT1",10,0)
 S RAITNAME=""
"RTN","RAPRINT1",11,0)
 F  S RAITNAME=$O(^TMP($J,RADIVNME,RAITNAME)) Q:RAITNAME=""!(RAOUT)  D DXNUM
"RTN","RAPRINT1",12,0)
 Q
"RTN","RAPRINT1",13,0)
DXNUM ; diagnostic code number
"RTN","RAPRINT1",14,0)
 S RAPREV="" ; Determine If Next Line Item is Related to Previous Line.
"RTN","RAPRINT1",15,0)
 S I=0
"RTN","RAPRINT1",16,0)
 F  S I=$O(^TMP($J,RADIVNME,RAITNAME,I)) Q:I'>0!(RAOUT)  D PATNAME
"RTN","RAPRINT1",17,0)
 Q
"RTN","RAPRINT1",18,0)
PATNAME ; patient name
"RTN","RAPRINT1",19,0)
 S RAPATNME=""
"RTN","RAPRINT1",20,0)
 F  S RAPATNME=$O(^TMP($J,RADIVNME,RAITNAME,I,RAPATNME)) Q:RAPATNME=""!(RAOUT)  D PATIEN
"RTN","RAPRINT1",21,0)
 Q
"RTN","RAPRINT1",22,0)
PATIEN ; patient internal entry number
"RTN","RAPRINT1",23,0)
 S J=0
"RTN","RAPRINT1",24,0)
 F  S J=$O(^TMP($J,RADIVNME,RAITNAME,I,RAPATNME,J)) Q:J'>0!(RAOUT)  D EXAMDATE
"RTN","RAPRINT1",25,0)
 Q
"RTN","RAPRINT1",26,0)
EXAMDATE ; exam date
"RTN","RAPRINT1",27,0)
 S K=0
"RTN","RAPRINT1",28,0)
 F  S K=$O(^TMP($J,RADIVNME,RAITNAME,I,RAPATNME,J,K)) Q:K'>0!(RAOUT)  D CASENUM
"RTN","RAPRINT1",29,0)
 Q
"RTN","RAPRINT1",30,0)
CASENUM ; case number
"RTN","RAPRINT1",31,0)
 S (RAPRTSET,RAFIRST)=0 ; Group PrintSet Exams for Printing.
"RTN","RAPRINT1",32,0)
 S RASAME=0 ; Group Multiple Diagnoses of Same Exam for Printing.
"RTN","RAPRINT1",33,0)
 S L1=$O(^TMP($J,RADIVNME,RAITNAME,I,RAPATNME,J,K,0))
"RTN","RAPRINT1",34,0)
 I L1>0,$P(^RADPT(J,"DT",K,"P",L1,0),U,25)=2 S RAFIRST=1 D
"RTN","RAPRINT1",35,0)
 .I $O(^RADPT(J,"DT",K,"P",L1),-1) S RAFIRST=2 ; Not First PrintSet Exam.
"RTN","RAPRINT1",36,0)
 S L=0
"RTN","RAPRINT1",37,0)
 F  S L=$O(^TMP($J,RADIVNME,RAITNAME,I,RAPATNME,J,K,L)) Q:L'>0!(RAOUT)  D
"RTN","RAPRINT1",38,0)
 .D DECIDE S (RAFIRST,RAPRTSET)=0
"RTN","RAPRINT1",39,0)
 .S RAPREV=J_U_K_U_L ; This Represents Last Line Printed.
"RTN","RAPRINT1",40,0)
 Q
"RTN","RAPRINT1",41,0)
DECIDE ; decide which entries to print
"RTN","RAPRINT1",42,0)
 S RAEXAM(0)=^RADPT(J,"DT",K,"P",L,0)
"RTN","RAPRINT1",43,0)
 I 'RAFIRST,$P(RAEXAM(0),U,25)=2 S RAPRTSET=1 ; Determine Descendants.
"RTN","RAPRINT1",44,0)
 S RACURR=J_U_K_U_L ; Save Current Line Info to be Printed.
"RTN","RAPRINT1",45,0)
 S RADIAG=$P(^RA(78.3,I,0),U)
"RTN","RAPRINT1",46,0)
 S RADXCODE=$S($P(RAEXAM(0),U,13)=I:"(P)",1:"(S)")
"RTN","RAPRINT1",47,0)
 I RASW D PRINT Q
"RTN","RAPRINT1",48,0)
 I RADXCODE="(P)",$P(RAEXAM(0),U,20) Q
"RTN","RAPRINT1",49,0)
 I RADXCODE="(P)",'$P(RAEXAM(0),U,20) D PRINT Q
"RTN","RAPRINT1",50,0)
 I '$D(^RADPT(J,"DT",K,"P",L,"DX")) Q
"RTN","RAPRINT1",51,0)
 S RASDXIEN=$O(^RADPT(J,"DT",K,"P",L,"DX","B",I,0)) I RASDXIEN'>0 Q
"RTN","RAPRINT1",52,0)
 S RASDXDTE=$P(^RADPT(J,"DT",K,"P",L,"DX",RASDXIEN,0),U,2)
"RTN","RAPRINT1",53,0)
 I RASDXDTE="" D PRINT
"RTN","RAPRINT1",54,0)
 Q
"RTN","RAPRINT1",55,0)
PRINT ; print entries
"RTN","RAPRINT1",56,0)
 I $Y+5>IOSL D HANG Q:RAOUT  D HDR Q:RAOUT
"RTN","RAPRINT1",57,0)
 I I1("DIV")="" W !?22,"Division: ",RADIVNME S I1("DIV")=RADIVNME
"RTN","RAPRINT1",58,0)
 I I1("IT")="" W !?18,"Imaging Type: ",RAITNAME S I1("IT")=RAITNAME
"RTN","RAPRINT1",59,0)
 I I1("DIV")'=RADIVNME!(I1("IT")'=RAITNAME) D HANG Q:RAOUT  D HDR Q:RAOUT  S I1("DIV")=RADIVNME S I1("IT")=RAITNAME D
"RTN","RAPRINT1",60,0)
 .W !?22,"Division: ",RADIVNME
"RTN","RAPRINT1",61,0)
 .W !?18,"Imaging Type: ",RAITNAME
"RTN","RAPRINT1",62,0)
 .I I1("DX")=I W !?15,"Diagnostic Code: ",RADIAG,!?15,"----------------"
"RTN","RAPRINT1",63,0)
 I I1("DX")'=I W !?15,"Diagnostic Code: ",RADIAG S I1("DX")=I D
"RTN","RAPRINT1",64,0)
 .I RAPREV=RACURR Q  ; Same Single Exam.
"RTN","RAPRINT1",65,0)
 .W !?15,"----------------"
"RTN","RAPRINT1",66,0)
 S RADFN=J,RAPAT=$S($D(^DPT(J,0)):^(0),1:""),RASSN=$$SSN^RAUTL(RADFN,1)
"RTN","RAPRINT1",67,0)
 S RAPAT=$S($P(RAPAT,U)]"":$P(RAPAT,U),1:"Not Found")
"RTN","RAPRINT1",68,0)
 S Y=9999999.9999-K X ^DD("DD") S RAEXDT=Y
"RTN","RAPRINT1",69,0)
 S RACASE=$P(RAEXAM(0),U)
"RTN","RAPRINT1",70,0)
 S RAWARD=$S($P(RAEXAM(0),U,6):$P(RAEXAM(0),U,6),1:"")
"RTN","RAPRINT1",71,0)
 I RAWARD]"" S RAWARD=$S($D(^DIC(42,RAWARD,0)):$P(^(0),U),1:"")
"RTN","RAPRINT1",72,0)
 I RAWARD']"" S RAWARD=$S($P(RAEXAM(0),U,8):$P(RAEXAM(0),U,8),1:"") I RAWARD]"" S RAWARD=$S($D(^SC(RAWARD,0)):$P(^(0),U),1:"Unknown")
"RTN","RAPRINT1",73,0)
 S RAPROC=$P(RAEXAM(0),U,2)
"RTN","RAPRINT1",74,0)
 S RAPROC=$S($D(^RAMIS(71,RAPROC,0)):$P(^(0),U),1:"Unknown")
"RTN","RAPRINT1",75,0)
 S RAMD=$P(RAEXAM(0),U,14)
"RTN","RAPRINT1",76,0)
 S RAMD=$S(RAMD="":"Unknown",$D(^VA(200,RAMD,0)):$P(^(0),U),1:"Unknown")
"RTN","RAPRINT1",77,0)
 I RADXCODE="(S)",'$D(RASDXIEN) D SDX I '$D(RASDXDTE) K RADXCODE,RASDXDTE,RASDXIEN Q
"RTN","RAPRINT1",78,0)
 I RAFIRST!'RAPRTSET D  ; Print Patient Header Once for PrintSets.
"RTN","RAPRINT1",79,0)
 .I RAPREV=RACURR Q  ; Print Patient Header Once for Multiple Dx.
"RTN","RAPRINT1",80,0)
 .W !!
"RTN","RAPRINT1",81,0)
 .I RADXCODE="(P)" W $S($P(RAEXAM(0),U,20):"*",1:"")
"RTN","RAPRINT1",82,0)
 .I RADXCODE="(S)" W $S(RASDXDTE]"":"*",1:"")
"RTN","RAPRINT1",83,0)
 .W $E(RAPAT,1,30)_" -"_RASSN,?38,RADXCODE,?42,$E(RAWARD,1,15),?58,$E(RAMD,1,21)
"RTN","RAPRINT1",84,0)
 ; Print Pat. Case# Once for Single Exam with Multiple Dx or
"RTN","RAPRINT1",85,0)
 ; Once for PrintSets.
"RTN","RAPRINT1",86,0)
 I (RAPREV'=RACURR)!RAPRTSET D
"RTN","RAPRINT1",87,0)
 .W !?2 W:RAFIRST=1 "(+)" I (RAFIRST=2)!RAPRTSET W "(.)"
"RTN","RAPRINT1",88,0)
 .W ?6,"Case #",RACASE,?20,$E(RAPROC,1,39),?60,RAEXDT
"RTN","RAPRINT1",89,0)
 I RADXCODE="(P)",'$P(^RADPT(J,"DT",K,"P",L,0),U,20) S $P(^(0),U,20)=DT
"RTN","RAPRINT1",90,0)
 I RADXCODE="(S)",'$P(^RADPT(J,"DT",K,"P",L,"DX",RASDXIEN,0),U,2) S $P(^(0),U,2)=DT
"RTN","RAPRINT1",91,0)
 S ^TMP($J,"RADLY",RADIVNME,RAITNAME)=+^TMP($J,"RADLY",RADIVNME,RAITNAME)+1,CNT=CNT+1
"RTN","RAPRINT1",92,0)
 K RADXCODE,RASDXDTE,RASDXIEN
"RTN","RAPRINT1",93,0)
 Q
"RTN","RAPRINT1",94,0)
HDR ; header
"RTN","RAPRINT1",95,0)
 W:$Y>0 @IOF
"RTN","RAPRINT1",96,0)
 W !?20,"<<<< ABNORMAL DIAGNOSTIC REPORT >>>>",?58,"Print Date: ",PDATE
"RTN","RAPRINT1",97,0)
 W !?13,"(P=Primary Dx, S=Secondary Dx / '*' represents reprint)"
"RTN","RAPRINT1",98,0)
 W !!,"Patient Name",?42,"Ward/Clinic",?58,"Requesting Physician"
"RTN","RAPRINT1",99,0)
 W !?20,"Procedure",?60,"Exam Date",!,QQ
"RTN","RAPRINT1",100,0)
 S I1("DIV")="",I1("IT")=""
"RTN","RAPRINT1",101,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAOUT=1
"RTN","RAPRINT1",102,0)
 Q
"RTN","RAPRINT1",103,0)
HANG ; hold screen
"RTN","RAPRINT1",104,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAPRINT1",105,0)
 I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR
"RTN","RAPRINT1",106,0)
 S:$D(DIRUT) RAOUT=1
"RTN","RAPRINT1",107,0)
 Q
"RTN","RAPRINT1",108,0)
SDX ; secondary dx ien and date
"RTN","RAPRINT1",109,0)
 I '$D(^RADPT(J,"DT",K,"P",L,"DX")) Q
"RTN","RAPRINT1",110,0)
 S RASDXIEN=$O(^RADPT(J,"DT",K,"P",L,"DX","B",I,0))
"RTN","RAPRINT1",111,0)
 Q:RASDXIEN'>0
"RTN","RAPRINT1",112,0)
 S RASDXDTE=$P(^RADPT(J,"DT",K,"P",L,"DX",RASDXIEN,0),U,2)
"RTN","RAPRINT1",113,0)
 Q
"RTN","RAPURGE")
0^1^B21540175
"RTN","RAPURGE",1,0)
RAPURGE ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Schedule Data Purge ;4/17/03  08:45
"RTN","RAPURGE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RAPURGE",3,0)
SCH ;Edit purge parameters and schedule Rad/Nuc Med data purge
"RTN","RAPURGE",4,0)
 I '($D(DUZ)#2) W !!,$C(7),"No 'DUZ' code. Purging not allowed.",! Q
"RTN","RAPURGE",5,0)
 I '$D(^VA(200,DUZ,0)) W !!,$C(7),"Not a valid 'DUZ' code. Purging not allowed.",! Q
"RTN","RAPURGE",6,0)
 F I=1:1:15 W !?9,$P($T(REMIND+I),";;",2)
"RTN","RAPURGE",7,0)
 S DIR(0)="Y",DIR("B")="Yes",DIR("?")="Enter 'YES' or 'RETURN' to edit purge parameters, or 'NO' not to.",DIR("A")="Do you want to edit the Imaging Type purge parameters" D ^DIR K DIR G QB:$D(DIRUT),PURGE:'Y
"RTN","RAPURGE",8,0)
EDIT W !! S DIC="^RA(79.2,",DIC(0)="AEQM",DIC("A")="Select IMAGING TYPE: " D ^DIC K DIC I Y>0 S DA=+Y,DIE="^RA(79.2,",DIE("NO^")="",DR="[RA ON-LINE CRITERIA]" D ^DIE K DE,DQ,DIC,DIE,DR G EDIT
"RTN","RAPURGE",9,0)
PURGE W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to schedule the data purge",DIR("?")="Enter 'YES' to schedule the data purge, or 'NO' not to."
"RTN","RAPURGE",10,0)
 D ^DIR K DIR I $D(DIRUT)!(Y=0) G QB
"RTN","RAPURGE",11,0)
 D RECORD
"RTN","RAPURGE",12,0)
 ; Display entries from 79.2 for selection
"RTN","RAPURGE",13,0)
 N I,J,CNT,RAX S (I,J,CNT)=0 K RAPUR
"RTN","RAPURGE",14,0)
 W !!?12,"IMAGING TYPES",!?12,"-------------",!
"RTN","RAPURGE",15,0)
 ; RAX(sequential no.)=ien file 79.2
"RTN","RAPURGE",16,0)
 F  S I=$O(^RA(79.2,"B",I)) Q:I=""  F  S J=$O(^RA(79.2,"B",I,J)) Q:'J  S CNT=CNT+1 W !?3,CNT,") ",I S RAX(CNT)=J
"RTN","RAPURGE",17,0)
 W ! S DIR(0)="L^1:"_CNT,DIR("A")="Select Imaging Type(s) to Purge",DIR("?")="Select by number, one or more imaging types to be purged" D ^DIR K DIR I $D(DIRUT) G QB
"RTN","RAPURGE",18,0)
 ; RAPUR(ien file 79.2)=""
"RTN","RAPURGE",19,0)
 S I="" F J=1:1 S I=$P(Y,",",J) Q:'I  S RAPUR(RAX(I))=""
"RTN","RAPURGE",20,0)
 W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to re-purge records that have been purged in the past",DIR("?")="Enter 'YES' to re-purge records purged in the past, or 'NO' not to."
"RTN","RAPURGE",21,0)
 D ^DIR K DIR G QB:$D(DIRUT) S RAREPURG=Y
"RTN","RAPURGE",22,0)
 D ASKF
"RTN","RAPURGE",23,0)
 G:'RAGO QB
"RTN","RAPURGE",24,0)
 K RAX S RAX="" F  S RAX=$O(RAPUR(RAX)) Q:'RAX  S DA=RAX,DIE="^RA(79.2,",DR="100///""NOW""",DR(2,79.23)="2///S;3////"_DUZ D ^DIE
"RTN","RAPURGE",25,0)
 K DA,DE,DIE,DQ,DR
"RTN","RAPURGE",26,0)
 S ZTRTN="START^RAPURGE1",ZTSAVE("RAPUR*")="",ZTSAVE("RAREPURG")="",ZTDESC="Rad/Nuc Med Data Purge" W ! D ZIS^RAUTL G Q:RAPOP
"RTN","RAPURGE",27,0)
 G START^RAPURGE1
"RTN","RAPURGE",28,0)
QB W !,"--Nothing Done--"
"RTN","RAPURGE",29,0)
Q K D0,D1,DA,DLAYGO,POP,RAPOP,RAPR,RAPUR,RAREPURG,X,Y,ZTDESC,ZTRTN,ZTSAVE,RAMES,RAGO,RAPURTYP Q
"RTN","RAPURGE",30,0)
 ;
"RTN","RAPURGE",31,0)
RECORD ; select which records to purge
"RTN","RAPURGE",32,0)
 S DIR(0)="S^E:Exams only;R:Reports only;O:Orders only;B:Both exams & reports;A:All three;"
"RTN","RAPURGE",33,0)
 S DIR("?")="Do you want to purge Exams, Reports, Orders, Exams & Reports, All three types ?"
"RTN","RAPURGE",34,0)
 S DIR("A")="Enter type of data to purge"
"RTN","RAPURGE",35,0)
 S DIR("B")="Reports only"
"RTN","RAPURGE",36,0)
 D ^DIR K DIR
"RTN","RAPURGE",37,0)
 S RAPURTYP=Y
"RTN","RAPURGE",38,0)
 Q
"RTN","RAPURGE",39,0)
ASKF ;ask final question
"RTN","RAPURGE",40,0)
 S RAGO=0
"RTN","RAPURGE",41,0)
 W !!,"You have chosen to purge ",$S(RAPURTYP="E":"Exam",RAPURTYP="R":"Report",RAPURTYP="O":"Order",RAPURTYP="B":"Exam & Report",RAPURTYP="A":"All 3 types of",1:"?")," records from "
"RTN","RAPURGE",42,0)
 S I=""
"RTN","RAPURGE",43,0)
 F  S I=$O(RAPUR(I)) Q:'I  W " ",$P(^RA(79.2,I,0),U) W:$O(RAPUR(I)) ","
"RTN","RAPURGE",44,0)
 W !
"RTN","RAPURGE",45,0)
 S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to proceed with the purge"
"RTN","RAPURGE",46,0)
 S DIR("?")="Enter 'YES' to go ahead with the purge, or 'NO' to exit from this option."
"RTN","RAPURGE",47,0)
 D ^DIR K DIR
"RTN","RAPURGE",48,0)
 S RAGO=Y
"RTN","RAPURGE",49,0)
 Q
"RTN","RAPURGE",50,0)
REMIND ;
"RTN","RAPURGE",51,0)
 ;;+--------------------------------------------------------+
"RTN","RAPURGE",52,0)
 ;;| This option is used to remove data from one or all of  |
"RTN","RAPURGE",53,0)
 ;;| these globals:  ^RADPT, ^RARPT, ^RAO                   |
"RTN","RAPURGE",54,0)
 ;;|                                                        |
"RTN","RAPURGE",55,0)
 ;;| Make sure IRM keeps the backup that was made prior to  |
"RTN","RAPURGE",56,0)
 ;;| running this option, and NOT overwrite that backup for |
"RTN","RAPURGE",57,0)
 ;;| at least 6 months.  Data from ^RADPT and ^RARPT can be |
"RTN","RAPURGE",58,0)
 ;;| recovered, but not data from ^RAO (order data).        |
"RTN","RAPURGE",59,0)
 ;;|                                                        |
"RTN","RAPURGE",60,0)
 ;;| The cut-off dates for the 5 items (activity log,       |
"RTN","RAPURGE",61,0)
 ;;| report, clinical history, tracking time, order data)   |
"RTN","RAPURGE",62,0)
 ;;| are compared to the exam date of those items.  If the  |
"RTN","RAPURGE",63,0)
 ;;| exam date for an item is older than the cut-off date   |
"RTN","RAPURGE",64,0)
 ;;| for that item, then that item would be purged.         |
"RTN","RAPURGE",65,0)
 ;;+--------------------------------------------------------+
"RTN","RAPURGE",66,0)
 ;;
"RTN","RAPURGE",67,0)
 Q
"RTN","RAPURGE1")
0^2^B28095039
"RTN","RAPURGE1",1,0)
RAPURGE1 ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Purge Rad/NM Data ;9/3/97  12:22
"RTN","RAPURGE1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RAPURGE1",3,0)
START I $G(RAPURTYP)="" U IO W !,"RAPURTYP undefined or null, Purge Not Done." G EXIT
"RTN","RAPURGE1",4,0)
 U IO D NOW^%DTC S Y=%,RACRT=$E(IOST,1,2)="C-" K %,%H,%I W !!,"Purge data routine started at " D D^RAUTL W Y,"."
"RTN","RAPURGE1",5,0)
 ;Set up variables needed for purge of selected imaging types
"RTN","RAPURGE1",6,0)
 G EXIT:'$O(RAPUR(0))
"RTN","RAPURGE1",7,0)
 S (RADT,RAODT,RAIEN)=0 F  S RAIEN=$O(RAPUR(RAIEN)) Q:'RAIEN  S RAX=$G(^RA(79.2,RAIEN,.1)) D
"RTN","RAPURGE1",8,0)
 .F RAI=1:1:4 S X2=-$S($P(RAX,U,RAI)>89:$P(RAX,U,RAI),1:27393),X1=DT D C^%DTC S $P(RAPUR(RAIEN),"^",RAI)=X S:X>RADT RADT=X
"RTN","RAPURGE1",9,0)
 .S X2=-$S($P(RAX,U,6)>29:$P(RAX,U,6),1:27393),X1=DT D C^%DTC S $P(RAPUR(RAIEN),"^",5)=X S:X>RAODT RAODT=X
"RTN","RAPURGE1",10,0)
 .F RAI=6:1:8 S $P(RAPUR(RAIEN),"^",RAI)=0
"RTN","RAPURGE1",11,0)
 ;
"RTN","RAPURGE1",12,0)
EXAM ;Purge exam/report data
"RTN","RAPURGE1",13,0)
 I RAPURTYP="O" G ORDER
"RTN","RAPURGE1",14,0)
 W !!,"Purging exams/reports.",!
"RTN","RAPURGE1",15,0)
 F RADTE=0:0 S RADTE=$O(^RADPT("AR",RADTE)) Q:RADTE'>0!(RADTE>RADT)  S RADTI=9999999.9999-RADTE F RADFN=0:0 S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:RADFN'>0  D
"RTN","RAPURGE1",16,0)
 .F RACN=0:0 S RACN=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN)) Q:RACN'>0  S RACNI=+$O(^(RACN,0)),RA0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),RARPT=+$P(RA0,"^",17) D:$S('$D(^("NOPURGE")):1,^("NOPURGE")'="n":1,1:0)
"RTN","RAPURGE1",17,0)
 ..S RAIMAG=+$P($G(^RAMIS(71,+$P(RA0,"^",2),0)),"^",12) Q:'$D(RAPUR(RAIMAG))  W:RACRT "."
"RTN","RAPURGE1",18,0)
 ..K RARP S RARPTNP=$G(^RARPT(RARPT,"NOPURGE")) I $S('$D(^RARPT(RARPT,0)):0,RAREPURG:1,'$D(^("PURGE")):1,1:0),RARPTNP'="n","RBA"[RAPURTYP D
"RTN","RAPURGE1",19,0)
 ... Q:+$O(^RARPT(RARPT,"ERR",0))  ; quit if report amended
"RTN","RAPURGE1",20,0)
 ...I $P(RAPUR(RAIMAG),"^",2)>RADTE,$D(^RARPT(RARPT,"R")) K ^("R") S RARP=""
"RTN","RAPURGE1",21,0)
 ...I $P(RAPUR(RAIMAG),"^")>RADTE,$D(^RARPT(RARPT,"L")) K ^("L") S RARP=""
"RTN","RAPURGE1",22,0)
 ...I $P(RAPUR(RAIMAG),"^",3)>RADTE,$D(^RARPT(RARPT,"H")) K ^("H") S RARP=""
"RTN","RAPURGE1",23,0)
 ..S:$D(RARP) ^RARPT(RARPT,"PURGE")=DT,$P(RAPUR(RAIMAG),"^",7)=$P(RAPUR(RAIMAG),"^",7)+1
"RTN","RAPURGE1",24,0)
 ..K RAEX I $S(RAREPURG:1,'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PURGE")):1,1:0),"EBA"[RAPURTYP D
"RTN","RAPURGE1",25,0)
 ...I $P(RAPUR(RAIMAG),"^")>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L")) K ^("L") S RAEX=""
"RTN","RAPURGE1",26,0)
 ...I $P(RAPUR(RAIMAG),"^",3)>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H")) K ^("H") S RAEX=""
"RTN","RAPURGE1",27,0)
 ...I $P(RAPUR(RAIMAG),"^",4)>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T")) K ^("T") S RAEX=""
"RTN","RAPURGE1",28,0)
 ..S:$D(RAEX) ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PURGE")=DT,$P(RAPUR(RAIMAG),"^",6)=$P(RAPUR(RAIMAG),"^",6)+1
"RTN","RAPURGE1",29,0)
 ;
"RTN","RAPURGE1",30,0)
ORDER ;Purge order/request data
"RTN","RAPURGE1",31,0)
 I "OA"'[RAPURTYP G STAT
"RTN","RAPURGE1",32,0)
 W !,"Purging orders/requests.",!
"RTN","RAPURGE1",33,0)
 S RAPKG="" F RAODTE=0:0 S RAODTE=$O(^RAO(75.1,"AO",RAODTE)) Q:'RAODTE!(RAODTE>RAODT)  F RAOIFN=0:0 S RAOIFN=$O(^RAO(75.1,"AO",RAODTE,RAOIFN)) Q:'RAOIFN  S RAORD0=$G(^RAO(75.1,RAOIFN,0)),RAIMAG=+$P(RAORD0,"^",3) D
"RTN","RAPURGE1",34,0)
 .I $D(RAPUR(RAIMAG)),$P(RAORD0,"^",5)<6 S RAPUROK=$$PUROK(RAORD0,DT) D:RAPUROK ENPUR
"RTN","RAPURGE1",35,0)
 ;
"RTN","RAPURGE1",36,0)
 ;Update statistics in Imaging Type file (#79.2)
"RTN","RAPURGE1",37,0)
STAT D NOW^%DTC S Y=% K %,%H,%I W !,"Data purge completed at " D D^RAUTL W Y,".",!!,"The following purge statistics were compiled:"
"RTN","RAPURGE1",38,0)
 K RAX S RAX="" F  S RAX=$O(RAPUR(RAX)) Q:'RAX  S DA=RAX,DIE="^RA(79.2,",DR="100///""NOW""",DR(2,79.23)="2///P;3////"_DUZ_";4///"_$P(RAPUR(RAX),U,6)_";5///"_$P(RAPUR(RAX),"^",7)_";6///"_$P(RAPUR(RAX),"^",8) D ^DIE D
"RTN","RAPURGE1",39,0)
 .W !!,"Imaging Type: ",$P($G(^RA(79.2,RAX,0)),"^"),!
"RTN","RAPURGE1",40,0)
 .W !?5,"No. of exam records processed      : ",$P(RAPUR(RAX),"^",6)
"RTN","RAPURGE1",41,0)
 .W !?5,"No. of reports processed           : ",$P(RAPUR(RAX),"^",7)
"RTN","RAPURGE1",42,0)
 .W !?5,"No. of requests processed          : ",$P(RAPUR(RAX),"^",8)
"RTN","RAPURGE1",43,0)
EXIT K %DT,%T,D,D0,D1,DA,DDER,DE,DI,DIC,DIE,DQ,DR,DLAYGO,POP,RA0,RACN,RACNI
"RTN","RAPURGE1",44,0)
 K RACRT,RADFN,RADT,RADTE,RADTI,RAEX,RAI,RAIEN,RAIMAG,RAODT,RAODTE
"RTN","RAPURGE1",45,0)
 K RAOIFN,RAORD0,RAPKG,RAPOP,RAPUR,RAREPURG,RARP,RARPT,RARPTNP,RAX,X
"RTN","RAPURGE1",46,0)
 K RAGO,RAPURTYP
"RTN","RAPURGE1",47,0)
 K X1,X2,Y K:$G(RAORD)'="Z@" RAPUROK ; don't kill if entering through
"RTN","RAPURGE1",48,0)
 ; the front door & version of CPRS >2.5   RAPUROK checked in RAO7RO
"RTN","RAPURGE1",49,0)
 D CLOSE^RAUTL
"RTN","RAPURGE1",50,0)
 Q
"RTN","RAPURGE1",51,0)
 ;
"RTN","RAPURGE1",52,0)
ENPUR ;OE/RR Entry Point for the PURGE ACTION Option
"RTN","RAPURGE1",53,0)
 I '$D(RAPKG),($$ORVR^RAORDU()=2.5) Q:'$D(ORPK)!('$D(ORSTS))  S OREND=$S(ORSTS<6:0,1:1) Q:OREND!(ORPK'>0)  S RAOIFN=+ORPK
"RTN","RAPURGE1",54,0)
 ;
"RTN","RAPURGE1",55,0)
 ; The 'DELORD' subroutine deletes the Imaging Order data
"RTN","RAPURGE1",56,0)
 ; (field 11) in the 70.03 sub-file.  This code handles deletions
"RTN","RAPURGE1",57,0)
 ; for parent procedures as well as orphan procedures (non-parent).
"RTN","RAPURGE1",58,0)
 ;
"RTN","RAPURGE1",59,0)
 D DELORD(RAOIFN,+$G(RAORD0)) ; +$G(RAORD0) is the patient dfn
"RTN","RAPURGE1",60,0)
 I $D(RAPKG) D  ; track the # of requests processed
"RTN","RAPURGE1",61,0)
 . W:RACRT "." S $P(RAPUR(RAIMAG),"^",8)=$P(RAPUR(RAIMAG),"^",8)+1
"RTN","RAPURGE1",62,0)
 . Q
"RTN","RAPURGE1",63,0)
 I $$ORVR^RAORDU()=2.5 D
"RTN","RAPURGE1",64,0)
 . I $D(RAPKG) S ORIFN=+$P(RAORD0,"^",7),ORSTS="K" D:ORIFN ST^ORX K ORIFN,ORSTS
"RTN","RAPURGE1",65,0)
 . I '$D(RAPKG) S ORSTS="K" D:ORIFN ST^ORX K ORIFN,ORSTS
"RTN","RAPURGE1",66,0)
 . Q
"RTN","RAPURGE1",67,0)
 K %,DA,DIC,DIK
"RTN","RAPURGE1",68,0)
 D:$$ORVR^RAORDU()'<3&($G(RAORD)'="Z@") EN1^RAO7PURG(RAOIFN)
"RTN","RAPURGE1",69,0)
 ; do EN1^RAO7PURG only if we are going through the 'backdoor' for
"RTN","RAPURGE1",70,0)
 ; versions of CPRS 3.0 or greater.
"RTN","RAPURGE1",71,0)
 S DA=RAOIFN,DIK="^RAO(75.1," D ^DIK ; delete the order record
"RTN","RAPURGE1",72,0)
 K %,DA,DIC,DIK
"RTN","RAPURGE1",73,0)
 Q
"RTN","RAPURGE1",74,0)
DELORD(RAOIFN,RADFN) ; Delete all of the imaging order pointers that refer
"RTN","RAPURGE1",75,0)
 ; to a specific order.
"RTN","RAPURGE1",76,0)
 ; input: raoifn-ien of our order in file 75.1
"RTN","RAPURGE1",77,0)
 ;         radfn-ien of the patient associated with the order
"RTN","RAPURGE1",78,0)
 N RACNI,RADTI,X,Y S RADTI=0
"RTN","RAPURGE1",79,0)
 F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAPURGE1",80,0)
 . S RACNI=0
"RTN","RAPURGE1",81,0)
 . F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RAPURGE1",82,0)
 .. K %,D,D0,DA,DIC,DIE,DQ,DR
"RTN","RAPURGE1",83,0)
 .. S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DR="11///@"
"RTN","RAPURGE1",84,0)
 .. S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RAPURGE1",85,0)
 .. D ^DIE K %,D,D0,DA,DIC,DIE,DQ,DR
"RTN","RAPURGE1",86,0)
 .. Q
"RTN","RAPURGE1",87,0)
 . Q
"RTN","RAPURGE1",88,0)
 Q
"RTN","RAPURGE1",89,0)
PUROK(RAORD0,RATDAY) ; Determine if an order meets the criteria
"RTN","RAPURGE1",90,0)
 ; to be purged from the Rad/Nuc Med Orders file.
"RTN","RAPURGE1",91,0)
 ; Input: RAORD0-0 node of the order record from file 75.1
"RTN","RAPURGE1",92,0)
 ;      : RATDAY-the current date w/o time
"RTN","RAPURGE1",93,0)
 ; Output: 1 if the order meets the purge criteria, else 0
"RTN","RAPURGE1",94,0)
 N RAOSTAT S RAOSTAT=$P(RAORD0,"^",5)
"RTN","RAPURGE1",95,0)
 ;
"RTN","RAPURGE1",96,0)
 ; PENDING & ('Date Desired' -or- 'Sheduled Date' >= today), don't purge
"RTN","RAPURGE1",97,0)
 Q:RAOSTAT=5&(($P(RAORD0,"^",21)\1)'<RATDAY) 0 ; Date Desired
"RTN","RAPURGE1",98,0)
 Q:RAOSTAT=5&(($P(RAORD0,"^",23)\1)'<RATDAY) 0 ; Sch'ld date
"RTN","RAPURGE1",99,0)
 ; HOLD & ('Date Desired' -or- 'Sheduled Date' >= today), don't purge
"RTN","RAPURGE1",100,0)
 Q:RAOSTAT=3&(($P(RAORD0,"^",21)\1)'<RATDAY) 0 ; Date Desired
"RTN","RAPURGE1",101,0)
 Q:RAOSTAT=3&(($P(RAORD0,"^",23)\1)'<RATDAY) 0 ; Sch'ld date
"RTN","RAPURGE1",102,0)
 ;
"RTN","RAPURGE1",103,0)
 ; PENDING & 'Request Entered Date/Time' < than 1 year ago, don't purge
"RTN","RAPURGE1",104,0)
 I RAOSTAT=5,($P(RAORD0,"^",16)) Q:$P(RAORD0,"^",16)'<($$FMADD^XLFDT(RATDAY,-365)) 0
"RTN","RAPURGE1",105,0)
 ; HOLD & 'Request Entered Date/Time' < than 1 year ago, don't purge
"RTN","RAPURGE1",106,0)
 I RAOSTAT=3,($P(RAORD0,"^",16)) Q:$P(RAORD0,"^",16)'<($$FMADD^XLFDT(RATDAY,-365)) 0
"RTN","RAPURGE1",107,0)
 ; Orders that are in a status of: DISCONTINUED or COMPLETE are purged
"RTN","RAPURGE1",108,0)
 ; when they have no activity after the cut-off date for their img type
"RTN","RAPURGE1",109,0)
 Q 1
"RTN","RARECOV")
0^3^B35385406
"RTN","RARECOV",1,0)
RARECOV ;HISC/SWM-Recover Purged Rad/NM Report/Exam only ;4/17/03  09:39
"RTN","RARECOV",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RARECOV",3,0)
 ;
"RTN","RARECOV",4,0)
 S:'$D(DTIME) DTIME=9999
"RTN","RARECOV",5,0)
 I $D(^XTMP("RARECOV")) W !,"^XTMP(""RARECOV"") exists, you must delete this before",!,"you can run another recovery.",!! G NOTDONE
"RTN","RARECOV",6,0)
 S RACRT=$E($G(IOST),1,2)="C-"
"RTN","RARECOV",7,0)
 F I=1:1:21 W !,$P($T(INSTRC+I),";;",2)
"RTN","RARECOV",8,0)
 R !,"Press return key to continue, or ""^"" to exit: ",X:DTIME
"RTN","RARECOV",9,0)
 G:X="^" Q
"RTN","RARECOV",10,0)
 ;Select Imaging type(s)
"RTN","RARECOV",11,0)
 ;Return RAPUR array  =  RAPUR(ien)="", where ien = entry in 79.2
"RTN","RARECOV",12,0)
 S (I,J,CNT)=0 K RAPUR
"RTN","RARECOV",13,0)
 W !!?12,"IMAGING TYPES",!?12,"-------------",!
"RTN","RARECOV",14,0)
 F  S I=$O(^RA(79.2,"B",I)) Q:I=""  F  S J=$O(^RA(79.2,"B",I,J)) Q:'J  S CNT=CNT+1 W !?3,CNT,") ",I S RAX(CNT)=J
"RTN","RARECOV",15,0)
 W ! S DIR(0)="L^1:"_CNT,DIR("A")="Select Imaging Type(s) to recover purged data",DIR("?")="Select by number, one or more imaging types to be purged" D ^DIR K DIR I $D(DIRUT) G Q
"RTN","RARECOV",16,0)
 S I="" F J=1:1 S I=$P(Y,",",J) Q:'I  S RAPUR(RAX(I))=""
"RTN","RARECOV",17,0)
 G Q:'$O(RAPUR(0))
"RTN","RARECOV",18,0)
 ;
"RTN","RARECOV",19,0)
 ;Select what to recover: exams, reports, or both
"RTN","RARECOV",20,0)
 S DIR(0)="S^E:Exam data;R:Report data;B:Both;",DIR("?")="Do you want to recover purged Exams, Reports, or Both exams and reports"
"RTN","RARECOV",21,0)
 S DIR("A")="Enter type of data to recover",DIR("B")="Report data"
"RTN","RARECOV",22,0)
 D ^DIR K DIR
"RTN","RARECOV",23,0)
 ;REGET70=0 means don't recover file 70 data
"RTN","RARECOV",24,0)
 S RAGET70=$S(Y="E":1,Y="B":1,1:0)
"RTN","RARECOV",25,0)
 S RAGET74=$S(Y="R":1,Y="B":1,1:0)
"RTN","RARECOV",26,0)
 ;
"RTN","RARECOV",27,0)
 S (RADT,RAIEN)=0
"RTN","RARECOV",28,0)
 F  S RAIEN=$O(RAPUR(RAIEN)) Q:'RAIEN  D ASKDT Q:RAX=""!(CNT<4)
"RTN","RARECOV",29,0)
 G:RAX=""!(CNT<4) NOTDONE
"RTN","RARECOV",30,0)
 W !
"RTN","RARECOV",31,0)
 S DIR(0)="Y",DIR("A")="Do you want to proceed "
"RTN","RARECOV",32,0)
 S DIR("B")="NO" D ^DIR
"RTN","RARECOV",33,0)
 I 'Y G NOTDONE
"RTN","RARECOV",34,0)
 ;
"RTN","RARECOV",35,0)
EXAM ;Copy backup exam/report data
"RTN","RARECOV",36,0)
 D NOW^%DTC S RANOW=%,X1=RANOW,X2=60 D C^%DTC
"RTN","RARECOV",37,0)
 S ^XTMP("RARECOV",0)=X_"^"_RANOW_"^"_"RARECOV"
"RTN","RARECOV",38,0)
 W !!,"Recovering ",$S(RAGET70&RAGET74:"Exam and Report",RAGET70:"Exam",RAGET74:"Report",1:"?")," data from backup to ^XTMP(""RARECOV"".",!
"RTN","RARECOV",39,0)
 F RADTE=0:0 S RADTE=$O(^RADPT("AR",RADTE)) Q:RADTE'>0!(RADTE>RADT)  S RADTI=9999999.9999-RADTE F RADFN=0:0 S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:RADFN'>0  D
"RTN","RARECOV",40,0)
 .F RACN=0:0 S RACN=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN)) Q:RACN'>0  S RACNI=+$O(^(RACN,0)),RA0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),RARPT=+$P(RA0,"^",17) D
"RTN","RARECOV",41,0)
 ..S RAIMAG=+$P($G(^RAMIS(71,+$P(RA0,"^",2),0)),"^",12) Q:'$D(RAPUR(RAIMAG))  W:RACRT "."
"RTN","RARECOV",42,0)
 ..K RARP S RARPTNP=$G(^RARPT(RARPT,"NOPURGE")) I RAGET74 D
"RTN","RARECOV",43,0)
 ... Q:+$O(^RARPT(RARPT,"ERR",0))  ; quit if report amended
"RTN","RARECOV",44,0)
 ...I $P(RAPUR(RAIMAG),"^",2)>RADTE,$D(^RARPT(RARPT,"R")) M ^XTMP("RARECOV","RPT",RARPT,"R")=^RARPT(RARPT,"R") S RARP=""
"RTN","RARECOV",45,0)
 ...I $P(RAPUR(RAIMAG),"^")>RADTE,$D(^RARPT(RARPT,"L")) M ^XTMP("RARECOV","RPT",RARPT,"L")=^RARPT(RARPT,"L") S RARP=""
"RTN","RARECOV",46,0)
 ...I $P(RAPUR(RAIMAG),"^",3)>RADTE,$D(^RARPT(RARPT,"H")) M ^XTMP("RARECOV","RPT",RARPT,"H")=^RARPT(RARPT,"H")  S RARP=""
"RTN","RARECOV",47,0)
 ..I $D(RARP) S ^XTMP("RARECOV","RPT",RARPT,"PURGE")=^RARPT(RARPT,"PURGE"),$P(RAPUR(RAIMAG),"^",7)=$P(RAPUR(RAIMAG),"^",7)+1
"RTN","RARECOV",48,0)
 ..K RAEX I RAGET70 D
"RTN","RARECOV",49,0)
 ...I $P(RAPUR(RAIMAG),"^")>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L")) M ^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"L")=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L") S RAEX=""
"RTN","RARECOV",50,0)
 ...I $P(RAPUR(RAIMAG),"^",3)>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H")) M ^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"H")=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H") S RAEX=""
"RTN","RARECOV",51,0)
 ...I $P(RAPUR(RAIMAG),"^",4)>RADTE,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T")) M ^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"T")=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T") S RAEX=""
"RTN","RARECOV",52,0)
 ..I $D(RAEX) S ^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"PURGE")=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PURGE"),$P(RAPUR(RAIMAG),"^",6)=$P(RAPUR(RAIMAG),"^",6)+1
"RTN","RARECOV",53,0)
 ;
"RTN","RARECOV",54,0)
 D TOTALS G Q
"RTN","RARECOV",55,0)
INSTRC ;
"RTN","RARECOV",56,0)
 ;;Instructions for recovering purged exam and/or report data
"RTN","RARECOV",57,0)
 ;; Step 0.
"RTN","RARECOV",58,0)
 ;;         Find out:
"RTN","RARECOV",59,0)
 ;;         1 - the DATE that the purge was done
"RTN","RARECOV",60,0)
 ;;         2 - how many DAYS back from that date was used as cut-off
"RTN","RARECOV",61,0)
 ;;             ie., what was entered as "ddd" in "T-ddd"  ?
"RTN","RARECOV",62,0)
 ;; Step 1. From the Backup Volume:
"RTN","RARECOV",63,0)
 ;;         D ^RARECOV
"RTN","RARECOV",64,0)
 ;;         enter cut-off dates that you had used in the purge function
"RTN","RARECOV",65,0)
 ;; Step 2. From the Backup Volume:
"RTN","RARECOV",66,0)
 ;;         D ^%GTO   (or your system's global copy out utility)
"RTN","RARECOV",67,0)
 ;;         enter output file name
"RTN","RARECOV",68,0)
 ;;         enter ^XTMP("RARECOV"
"RTN","RARECOV",69,0)
 ;; Step 3. From the Production volume that holds ^XTMP: 
"RTN","RARECOV",70,0)
 ;;         D ^%GTI   (or your system's global restore utility)
"RTN","RARECOV",71,0)
 ;;         enter the file name from step 2
"RTN","RARECOV",72,0)
 ;; Step 4. From the Production volume:
"RTN","RARECOV",73,0)
 ;;         D ^RARESTOR
"RTN","RARECOV",74,0)
 ;;         routine will automatically read from ^XTMP("RARECOV"
"RTN","RARECOV",75,0)
 ;;         and copy data back into ^RADPT and/or ^RARPT
"RTN","RARECOV",76,0)
 ;;
"RTN","RARECOV",77,0)
NOTDONE W !!,"-- Nothing Done --"
"RTN","RARECOV",78,0)
Q ;K CNT,I,J,RADD,RADT,RAGET70,RAGET74,RAI,RAIEN,RAPRMPT,RAPUR,RAX
"RTN","RARECOV",79,0)
 Q
"RTN","RARECOV",80,0)
TOTALS ;
"RTN","RARECOV",81,0)
 S RAIEN=0
"RTN","RARECOV",82,0)
 F  S RAIEN=$O(RAPUR(RAIEN)) Q:'RAIEN  D
"RTN","RARECOV",83,0)
 . W !!,"Imaging Type: ",$P($G(^RA(79.2,RAIEN,0)),"^"),!
"RTN","RARECOV",84,0)
 . W !?5,"No. of exam records recovered : ",$P(RAPUR(RAIEN),"^",6)
"RTN","RARECOV",85,0)
 . W !?5,"No. of reports recovered      : ",$P(RAPUR(RAIEN),"^",7)
"RTN","RARECOV",86,0)
 . S ^XTMP("RARECOV",RAIEN)=RAPUR(RAIEN)
"RTN","RARECOV",87,0)
 Q
"RTN","RARECOV",88,0)
 ;Select Cut-off date for the various data fields
"RTN","RARECOV",89,0)
ASKDT S RAX="",CNT=0
"RTN","RARECOV",90,0)
 K RACUTDT W !!?7,"Cut-off Date Selection **** ",$P(^RA(79.2,RAIEN,0),"^")," ****"
"RTN","RARECOV",91,0)
 K X,%DT S %DT="APEX" W !
"RTN","RARECOV",92,0)
 S %DT("A")="Enter date that the Radiology Purge was done : " D ^%DT
"RTN","RARECOV",93,0)
 G:'Y Q G:Y'?.7N Q S RADTDONE=Y
"RTN","RARECOV",94,0)
 R !!,"Enter number of days subtracted from that date as cut-off : ",RANUM:DTIME
"RTN","RARECOV",95,0)
 G:'RANUM Q
"RTN","RARECOV",96,0)
 S ^XTMP("RARECOV",0,RAIEN)=RADTDONE_"^"_RANUM
"RTN","RARECOV",97,0)
 S X1=RADTDONE,X2=-RANUM D C^%DTC S Y=X D DD^%DT S %DT("B")=Y
"RTN","RARECOV",98,0)
 W !?7,"The default value can be changed as needed."
"RTN","RARECOV",99,0)
 K RADD
"RTN","RARECOV",100,0)
 S RAPRMPT="Cut-off Date for "
"RTN","RARECOV",101,0)
 ; define field names, because the backup volume doesn't have ^DD
"RTN","RARECOV",102,0)
 S RADD(.11)="ACTIVITY LOG CUT-OFF"
"RTN","RARECOV",103,0)
 S RADD(.12)="REPORT CUT-OFF"
"RTN","RARECOV",104,0)
 S RADD(.13)="CLINICAL HISTORY CUT-OFF"
"RTN","RARECOV",105,0)
 S RADD(.14)="TRACKING TIME CUT-OFF"
"RTN","RARECOV",106,0)
 F RAI=.11:.01:.14 S CNT=CNT+1 D  Q:Y<0
"RTN","RARECOV",107,0)
 . W ! S %DT("A")=RAPRMPT_$P(RADD(RAI),"^")_" : " D ^%DT Q:Y<0  S $P(RAX,"^",CNT)=Y S:Y>RADT RADT=Y
"RTN","RARECOV",108,0)
 G:RAX="" Q G:CNT<4 Q
"RTN","RARECOV",109,0)
 S RAPUR(RAIEN)=RAX
"RTN","RARECOV",110,0)
 Q
"RTN","RARESTOR")
0^4^B14369253
"RTN","RARESTOR",1,0)
RARESTOR ;HISC/SWM-Recover Purged Rad/NM Report/Exam only
"RTN","RARESTOR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RARESTOR",3,0)
 ;
"RTN","RARESTOR",4,0)
 S:'$D(DTIME) DTIME=9999
"RTN","RARESTOR",5,0)
 I $G(^XTMP("RARECOV",0))="" W !,"^XTMP(""RARECOV"") doesn't exist -- there's no data to recover!" G Q
"RTN","RARESTOR",6,0)
 S RA1=0,RA2=0,RA3=0
"RTN","RARESTOR",7,0)
 S:$D(^XTMP("RARECOV","RPT")) RA1=1 S:$D(^XTMP("RARECOV","DPT")) RA2=1
"RTN","RARESTOR",8,0)
 I RA1,RA2 S RA3=1
"RTN","RARESTOR",9,0)
 W !,?7,"Radiology " W $S(RA3:"reports and exams",RA2:"exams",1:"reports")," were purged."
"RTN","RARESTOR",10,0)
 S RAIEN=0 F  S RAIEN=$O(^XTMP("RARECOV",RAIEN)) Q:'RAIEN  D
"RTN","RARESTOR",11,0)
 .S RAPUR(RAIEN)=""
"RTN","RARESTOR",12,0)
 . S Y=$P(^XTMP("RARECOV",0,RAIEN),"^"),RANUM=$P(^(RAIEN),"^",2) D DD^%DT S RADTDONE=Y
"RTN","RARESTOR",13,0)
 .W !!,"Imaging Type: ","**** ",$P($G(^RA(79.2,RAIEN,0)),"^")," ****"
"RTN","RARESTOR",14,0)
 .W " purged on ",RADTDONE," -",RANUM," days."
"RTN","RARESTOR",15,0)
 .W !,"Activity Log",?20,"Report",?40,"Clin History",?60,"Tracking Time"
"RTN","RARESTOR",16,0)
 .W !,"cut-off date",?20,"cut-off date",?40,"cut-off date",?60,"cut-off date"
"RTN","RARESTOR",17,0)
 .W !,"------------",?20,"------------",?40,"------------",?60,"------------"
"RTN","RARESTOR",18,0)
 .W ! S X=$P(^XTMP("RARECOV",RAIEN),"^") D TW
"RTN","RARESTOR",19,0)
 .W ?20 S X=$P(^(RAIEN),"^",2) D TW
"RTN","RARESTOR",20,0)
 .W ?40 S X=$P(^(RAIEN),"^",3) D TW
"RTN","RARESTOR",21,0)
 .W ?60 S X=$P(^(RAIEN),"^",4) D TW
"RTN","RARESTOR",22,0)
 .W !?5,"No. of exam records recovered: ",$P(^XTMP("RARECOV",RAIEN),"^",6)
"RTN","RARESTOR",23,0)
 .W !?5,"No. of reports recovered     : ",$P(^XTMP("RARECOV",RAIEN),"^",7)
"RTN","RARESTOR",24,0)
 .Q
"RTN","RARESTOR",25,0)
 ;
"RTN","RARESTOR",26,0)
 W !!,?7,"The purged data were recovered"
"RTN","RARESTOR",27,0)
 S Y=$P(^XTMP("RARECOV",0),"^",2) D DD^%DT
"RTN","RARESTOR",28,0)
 W !,?7,"on ",Y," to ^XTMP(""RARECOV"")"
"RTN","RARESTOR",29,0)
 W !!,"This routine will restore the recovered data into the appropriate records."
"RTN","RARESTOR",30,0)
 ;
"RTN","RARESTOR",31,0)
 S DIR(0)="Y",DIR("A")="Do you want to proceed "
"RTN","RARESTOR",32,0)
 S DIR("B")="NO" D ^DIR
"RTN","RARESTOR",33,0)
 I 'Y W !!,"-- Nothing Done --" G Q
"RTN","RARESTOR",34,0)
 ;
"RTN","RARESTOR",35,0)
SET ;Set nodes by using recovered data from ^XTMP("RARECOV"
"RTN","RARESTOR",36,0)
 D NOW^%DTC S RANOW=%
"RTN","RARESTOR",37,0)
 W !!,"Restoring data to exams/reports",!
"RTN","RARESTOR",38,0)
70 G:'$D(^XTMP("RARECOV","DPT")) 74
"RTN","RARESTOR",39,0)
 S RADFN=0
"RTN","RARESTOR",40,0)
701 S RADFN=$O(^XTMP("RARECOV","DPT",RADFN)) G:'RADFN 74  S RADTI=0
"RTN","RARESTOR",41,0)
702 S RADTI=$O(^XTMP("RARECOV","DPT",RADFN,RADTI)) G:'RADTI 701 S RACNI=0
"RTN","RARESTOR",42,0)
703 S RACNI=$O(^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI)) G:'RACNI 702
"RTN","RARESTOR",43,0)
 W "."
"RTN","RARESTOR",44,0)
 I $D(^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"L")) M ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L")=^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"L") S RAEX=""
"RTN","RARESTOR",45,0)
 I $D(^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"H")) M ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H")=^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"H") S RAEX=""
"RTN","RARESTOR",46,0)
 I $D(^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"T")) M ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T")=^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"T") S RAEX=""
"RTN","RARESTOR",47,0)
 I $D(^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"PURGE")) S ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PURGE")=^XTMP("RARECOV","DPT",RADFN,RADTI,RACNI,"PURGE")
"RTN","RARESTOR",48,0)
 G 703
"RTN","RARESTOR",49,0)
 ;
"RTN","RARESTOR",50,0)
74 G:'$D(^XTMP("RARECOV","RPT")) DONE
"RTN","RARESTOR",51,0)
 S RARPT=0
"RTN","RARESTOR",52,0)
741 S RARPT=$O(^XTMP("RARECOV","RPT",RARPT)) G:'RARPT DONE
"RTN","RARESTOR",53,0)
 W "."
"RTN","RARESTOR",54,0)
 I $D(^XTMP("RARECOV","RPT",RARPT,"H")) M ^RARPT(RARPT,"H")=^XTMP("RARECOV","RPT",RARPT,"H")
"RTN","RARESTOR",55,0)
 I $D(^XTMP("RARECOV","RPT",RARPT,"L")) M ^RARPT(RARPT,"L")=^XTMP("RARECOV","RPT",RARPT,"L")
"RTN","RARESTOR",56,0)
 I $D(^XTMP("RARECOV","RPT",RARPT,"R")) M ^RARPT(RARPT,"R")=^XTMP("RARECOV","RPT",RARPT,"R")
"RTN","RARESTOR",57,0)
 I $D(^XTMP("RARECOV","RPT",RARPT,"PURGE")) S ^RARPT(RARPT,"PURGE")=^XTMP("RARECOV","RPT",RARPT,"PURGE")
"RTN","RARESTOR",58,0)
 G 741
"RTN","RARESTOR",59,0)
TW S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X
"RTN","RARESTOR",60,0)
 Q
"RTN","RARESTOR",61,0)
DONE W !!,"Data have been restored."
"RTN","RARESTOR",62,0)
Q ;K RA1,RADFN,RADTI,RACNI,RARPT
"RTN","RARESTOR",63,0)
 Q
"RTN","RART1")
0^5^B58301617
"RTN","RART1",1,0)
RART1 ;HISC/GJC,SWM-Reporting Menu (Part 2) ;11/18/97  13:34
"RTN","RART1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,16,15,21,23,27,34**;Mar 16, 1998
"RTN","RART1",3,0)
 ;Print Report By Patient has been moved to 4^RART2!
"RTN","RART1",4,0)
 ;these sections are moved to ^RART3 : QRPT, PHYS, MODSET, OUT1
"RTN","RART1",5,0)
CHK I 'RARPT!('$D(^RARPT(+RARPT,0))) W !?3,$C(7),"No report filed for case number ",RACN,"." K RARPT Q
"RTN","RART1",6,0)
 I $D(RADFT),$P(^RARPT(+RARPT,0),"^",5)'["D" W !?3,$C(7),"Report for case number ",RACN," is not in a 'draft' status." K RARPT Q
"RTN","RART1",7,0)
 I '$D(RADFT),$P(^RARPT(+RARPT,0),"^",5)["D" W !?3,$C(7),"Report filed for case number ",RACN," but not available for printing." K RARPT Q
"RTN","RART1",8,0)
 Q
"RTN","RART1",9,0)
 ;
"RTN","RART1",10,0)
5 ;;Draft Report (Reprint)
"RTN","RART1",11,0)
 D SETVARS Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))  S RADFT="" G 4^RART2
"RTN","RART1",12,0)
 ;
"RTN","RART1",13,0)
6 ;;Display a Report By Patient
"RTN","RART1",14,0)
 W ! S DIC(0)="AEMQ" D ^RADPA G Q6:Y<0 S RADFN=+Y,RAHEAD="**** Patient's Exams ****",RAF1=1,RAREPORT=1 D ^RAPTLU G Q6:X="^" G 6:'$D(RADUP)
"RTN","RART1",15,0)
 I X=1 R X:3
"RTN","RART1",16,0)
OERR ;entry from RA OERR PROFILE protocol
"RTN","RART1",17,0)
 F RAI=0:0 S RAI=$O(RADUP(RAI)) Q:RAI'>0  S Y=^TMP($J,"RAEX",RAI) D 61,DISP Q:X="^"
"RTN","RART1",18,0)
 K RADUP,RAI,RAJ,X,^TMP($J,"RAEX") Q:$D(ORVP)  G 6
"RTN","RART1",19,0)
61 F RAJ=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",RAJ)=$P(Y,"^",RAJ)
"RTN","RART1",20,0)
 S Y(0)=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0) Q
"RTN","RART1",21,0)
 ;
"RTN","RART1",22,0)
OERR1 ;Entry Point for Alert Follow-Up Action for OE/RR
"RTN","RART1",23,0)
 Q:'$D(XQADATA)!('$D(XQAID))  S (RARPT,Y)=XQADATA D RASET^RAUTL2
"RTN","RART1",24,0)
 S:Y Y(0)=Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown"),RAPRC=$S($D(^RAMIS(71,+$P(Y(0),"^",2),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RART1",25,0)
 S RALERTS="" D DISP K:X="^" XQAID,XQAKILL
"RTN","RART1",26,0)
 I $D(XQAID) S DFN=$P(XQAID,",",2) D DELETE^XQALERT
"RTN","RART1",27,0)
 K RALERTS
"RTN","RART1",28,0)
 Q
"RTN","RART1",29,0)
 ;
"RTN","RART1",30,0)
DISP I RARPT,($D(RAPBRPT)),($P($G(^RARPT(+RARPT,0)),"^",5)="V") D  Q
"RTN","RART1",31,0)
 . ; This code will not allow a user to re-edit a verified report.
"RTN","RART1",32,0)
 . ; In this case, two or more possible users signed on to the same
"RTN","RART1",33,0)
 . ; Imaging location, asked to verify the reports of the same
"RTN","RART1",34,0)
 . ; Interpreting Radiology/Nuclear Medicine Physician.
"RTN","RART1",35,0)
 . ; For the 'On-line Verifying of Reports' option only!
"RTN","RART1",36,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT,Y
"RTN","RART1",37,0)
 . ; removed  X  from N  so rtn RARTVER would quit if caret entered
"RTN","RART1",38,0)
 . W !!?10,"Since the time you selected this group of reports,",!?10,$P($G(^VA(200,+$P(^RARPT(+RARPT,0),"^",9),0)),U)," has verified the report for "
"RTN","RART1",39,0)
 . W !?10,$P($G(^DPT(+$P(^RARPT(+RARPT,0),"^",2),0)),U),"  case #",$P(^RARPT(+RARPT,0),"^"),".",$C(7)
"RTN","RART1",40,0)
 . S Y=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):$P($P(^(RARPT),"/",2),U,3),$D(RARPTX(+$G(RPTX))):$P($P(RARPTX(+$G(RPTX)),"/",2),U,3),1:"")
"RTN","RART1",41,0)
 . I $D(^RAMIS(71,+Y,0)) W !?10,"Procedure ",$P(^(0),U)
"RTN","RART1",42,0)
 . W ! K DIR S DIR(0)="E" D ^DIR S RAVFIED=1
"RTN","RART1",43,0)
 . Q
"RTN","RART1",44,0)
 D HOME^%ZIS S OREND=1
"RTN","RART1",45,0)
 I 'RARPT!('$D(^RARPT(+RARPT,0))) D  G Q6
"RTN","RART1",46,0)
 . W !?3,$C(7),"No report filed for case number",$S($D(RACN):" "_RACN,1:""),"."
"RTN","RART1",47,0)
 . R X:3 ; D:$$IMAGE^RARIC1 DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",48,0)
 . Q
"RTN","RART1",49,0)
 S RAST=$P(^RARPT(+RARPT,0),"^",5)
"RTN","RART1",50,0)
 I '$D(RARTVER),(RAST=""!(RAST["D")) D  G Q6
"RTN","RART1",51,0)
 . W !?3,$C(7),"Report filed for case number ",RACN," but not available for display."
"RTN","RART1",52,0)
 . R X:3 ; D:$$IMAGE^RARIC1 DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",53,0)
 . Q
"RTN","RART1",54,0)
DISP1 I $S('$D(ORACTION):1,ORACTION'=8:1,'$D(X):0,X="T":1,1:0) W @IOF
"RTN","RART1",55,0)
 W !,RANME," (",$$SSN^RAUTL,")",?41,"Case No. ",?57,": ",$P($G(^RARPT(RARPT,0)),"^")," @",$E(RADATE,$L(RADATE)-4,$L(RADATE))
"RTN","RART1",56,0)
 W !,$E(RAPRC,1,40) I +$G(^RARPT(RARPT,"T")) W ?41,"Transcriptionist",?57,": ",$E($P($G(^VA(200,+^RARPT(RARPT,"T"),0)),"^"),1,20)
"RTN","RART1",57,0)
 N R3 S R3=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",+$G(RACNI),0))
"RTN","RART1",58,0)
 W !,"Req. Phys : ",$E($P($G(^VA(200,+$P(R3,"^",14),0)),"^"),1,25)
"RTN","RART1",59,0)
 S RAPREVER=+$P($G(^RARPT(RARPT,0)),"^",13) W ?41,"Pre-verified",?57,": ",$S($D(^VA(200,RAPREVER,0)):$E($P($G(^VA(200,RAPREVER,0)),"^"),1,24),1:"NO") K RAPREVER
"RTN","RART1",60,0)
 D PHYS^RART3
"RTN","RART1",61,0)
 I $D(RAPBRPT),(RAST="PD") D
"RTN","RART1",62,0)
 . W !,"**Prob Text: "
"RTN","RART1",63,0)
 . I $G(^RARPT(+RARPT,"P"))]"" D
"RTN","RART1",64,0)
 .. S X=$G(^RARPT(+RARPT,"P"))
"RTN","RART1",65,0)
 .. D OUTTEXT^RAUTL9(X,"",10,70,13,"","!")
"RTN","RART1",66,0)
 .. Q
"RTN","RART1",67,0)
 . Q
"RTN","RART1",68,0)
 W !,$$REPEAT^XLFSTR("=",79)
"RTN","RART1",69,0)
 I $O(^RARPT(RARPT,1,0)) D MODSET^RART3
"RTN","RART1",70,0)
 I '$O(^RARPT(RARPT,1,0)) D
"RTN","RART1",71,0)
 . D MODS^RAUTL2,OUT1^RART3
"RTN","RART1",72,0)
 . I +$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",28) S X=$$RDIO1^RARTUTL1(+$P(^(0),"^",28))
"RTN","RART1",73,0)
 . Q:$L($G(X))  ; 'X' should be 'null' to continue
"RTN","RART1",74,0)
 . S:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) X=$$PHARM1^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RART1",75,0)
 . Q
"RTN","RART1",76,0)
 Q:$G(X)="P"  G DISP1:$G(X)="T",Q6:$G(X)="^"
"RTN","RART1",77,0)
 I +$O(^RARPT(RARPT,"ERR",0)) W !?10,$$AMENRPT^RARTR2(),!
"RTN","RART1",78,0)
 ;
"RTN","RART1",79,0)
 ; Print the clinical history from file 70
"RTN","RART1",80,0)
 I +$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",0)) D
"RTN","RART1",81,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",82,0)
 . W !?3,"Clinical History:"
"RTN","RART1",83,0)
 . S RAP="H" D WRITEHX(RAP)
"RTN","RART1",84,0)
 . Q
"RTN","RART1",85,0)
 Q:$G(X)="P"  G DISP1:$G(X)="T",Q6:$G(X)="^"
"RTN","RART1",86,0)
 ;
"RTN","RART1",87,0)
 ; Print the additional report clinical history if defined and 
"RTN","RART1",88,0)
 ; different than the order clinical history.
"RTN","RART1",89,0)
 I +$O(^RARPT(RARPT,"H",0)) D
"RTN","RART1",90,0)
 . D CHKDUPHX Q:RADUPHX  ; Duplicate history
"RTN","RART1",91,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",92,0)
 . W !?3,"Additional Clinical History:"
"RTN","RART1",93,0)
 . S RAP="AH" D WRITEHX(RAP)
"RTN","RART1",94,0)
 ;
"RTN","RART1",95,0)
 ; Print Report and Impression text
"RTN","RART1",96,0)
 F RAP="R","I" D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",97,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",98,0)
 . W !?3,$S(RAP="R":"Report:",1:"Impression:") W:RAP="R" ?45,"Status: ",$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),U,2))
"RTN","RART1",99,0)
 . W:RAP="R"&($E(RAST)="P") $C(7)
"RTN","RART1",100,0)
 . D WRITE
"RTN","RART1",101,0)
 . Q
"RTN","RART1",102,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",103,0)
 ; I $$IMAGE^RARIC1() D DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",104,0)
 I $P($G(^RA(79.1,+$P(^RADPT(RADFN,"DT",RADTI,0),U,4),0)),U,18)="Y" D PRTDX^RART K RADXCODE
"RTN","RART1",105,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",106,0)
 ;
"RTN","RART1",107,0)
 I $D(ORVP) D
"RTN","RART1",108,0)
 .S RAVERF=+$P($G(^RARPT(+RARPT,0)),"^",9)
"RTN","RART1",109,0)
 .S RADFTSBN=$E($P($G(^VA(200,RAVERF,20)),"^",2),1,25)
"RTN","RART1",110,0)
 .S:RADFTSBN']"" RADFTSBN=$E($P($G(^VA(200,RAVERF,0)),"^"),1,25)
"RTN","RART1",111,0)
 .S RADFTSBT=$E($P($G(^VA(200,RAVERF,20)),"^",3),1,30)
"RTN","RART1",112,0)
 .S:RADFTSBT']"" RADFTSBT=$$TITLE^RARTR0(RAVERF)
"RTN","RART1",113,0)
 .W !!,"VERIFIED BY:",!?2,$S(RADFTSBN]"":RADFTSBN,1:"")
"RTN","RART1",114,0)
 .W:RADFTSBT]"" ", "_RADFTSBT
"RTN","RART1",115,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",116,0)
 ;
"RTN","RART1",117,0)
 K RAP I '$D(RARTVER) D WAIT Q:X="P"  G DISP1:X="T"
"RTN","RART1",118,0)
Q6 K %,DIC,DIWF,DIWL,DIWR,I,J,OREND,POP,RABTCH,RAF1,RAHEAD,RALOC,RANME,RAPAR,RAPRC,RAREPORT,RASEL,RASSN,RAST,RAV,RAXX,Y,X1,Z
"RTN","RART1",119,0)
 K RAVERF,RADFTSBN,RADFTSBT
"RTN","RART1",120,0)
 K DIW,DIWT,DN
"RTN","RART1",121,0)
 K C,DIPGM,DISYS,R1,RAIMGTYI,RAP
"RTN","RART1",122,0)
 K:'$D(RARTVER) RACN,RACNI,RADATE,RADFN,RADTE,RADTI,RARPT Q
"RTN","RART1",123,0)
 ;
"RTN","RART1",124,0)
WRITE K RAXX N Y
"RTN","RART1",125,0)
 F RAV=0:0 S RAV=$O(^RARPT(RARPT,RAP,RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",126,0)
 . S RAXX=^RARPT(RARPT,RAP,RAV,0) S X=""
"RTN","RART1",127,0)
 . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",128,0)
 . S X=RAXX D ^DIWP S X=""
"RTN","RART1",129,0)
 . Q
"RTN","RART1",130,0)
 Q:X="^"  D ^DIWW:$D(RAXX) Q
"RTN","RART1",131,0)
 ;
"RTN","RART1",132,0)
WRITEHX(RAP) ; Get and write the clinical history
"RTN","RART1",133,0)
 ;
"RTN","RART1",134,0)
 ;Input:   RAP        H = Clinical History from file 70
"RTN","RART1",135,0)
 ;                   AH = Additional Clinical History from file 74
"RTN","RART1",136,0)
 ;
"RTN","RART1",137,0)
 K RAXX N Y
"RTN","RART1",138,0)
 S RAV=0
"RTN","RART1",139,0)
 I RAP="H" D
"RTN","RART1",140,0)
 . F  S RAV=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",141,0)
 . . S RAXX=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAV,0),X=""
"RTN","RART1",142,0)
 . . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",143,0)
 . . S X=RAXX D ^DIWP S X=""
"RTN","RART1",144,0)
 . . Q
"RTN","RART1",145,0)
 I RAP="AH" D
"RTN","RART1",146,0)
 . F  S RAV=$O(^RARPT(RARPT,"H",RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",147,0)
 . . S RAXX=^RARPT(RARPT,"H",RAV,0),X=""
"RTN","RART1",148,0)
 . . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",149,0)
 . . S X=RAXX D ^DIWP S X=""
"RTN","RART1",150,0)
 . . Q
"RTN","RART1",151,0)
 Q:X="^"  D ^DIWW:$D(RAXX) Q
"RTN","RART1",152,0)
 ;
"RTN","RART1",153,0)
CHKDUPHX ; Check Duplicate History in file 70 and 74.
"RTN","RART1",154,0)
 ; Returns RADUPHX  1 = Duplicate
"RTN","RART1",155,0)
 ;                  0 = Different
"RTN","RART1",156,0)
 N RAX,RA74,RA70,RAOK,RAX1
"RTN","RART1",157,0)
 ; Initialize to Different
"RTN","RART1",158,0)
 S RADUPHX=0
"RTN","RART1",159,0)
 ; Quit if H node does not exist.  Could have been purged.
"RTN","RART1",160,0)
 I '$D(^RARPT(RARPT,"H")) S RADUPHX=1 Q
"RTN","RART1",161,0)
 S RA74=$O(^RARPT(RARPT,"H",""),-1)
"RTN","RART1",162,0)
 S RA70=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",""),-1),RA701=$O(^(0))
"RTN","RART1",163,0)
 S RAX=RA74-RA70+1 Q:RAX'=1  ; begin comparison
"RTN","RART1",164,0)
 ; Check line by line of each file
"RTN","RART1",165,0)
 ; RAOK  1 = all lines match
"RTN","RART1",166,0)
 ;       0 = at least 1 difference
"RTN","RART1",167,0)
 S RAOK=1
"RTN","RART1",168,0)
 F RAX1=RA701:1:RA70 I ^RARPT(RARPT,"H",RAX1,0)'=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAX1,0) S RAOK=0 Q  ;can exit loop on 1st difference
"RTN","RART1",169,0)
 I 'RAOK Q
"RTN","RART1",170,0)
 S RADUPHX=1
"RTN","RART1",171,0)
 Q
"RTN","RART1",172,0)
 ;
"RTN","RART1",173,0)
WAIT ; user input, goto top, print, or continue
"RTN","RART1",174,0)
 S RARD(1)="Continue^continue normal processing"
"RTN","RART1",175,0)
 S:$D(RALERTS) RARD(2)="Print^print the entire report"
"RTN","RART1",176,0)
 S RARD(3)="Top^display the report from the beginning"
"RTN","RART1",177,0)
 S (RARD("B"),RARD("DTOUT"))=1
"RTN","RART1",178,0)
 S:$D(RALERTS) RARD("A")="Enter 'Top', 'Print'  or 'Continue':   "
"RTN","RART1",179,0)
 S:'$D(RALERTS) RARD("A")="Enter 'Top' or 'Continue':   "
"RTN","RART1",180,0)
 S RARD(0)="S" D SET^RARD K RARD S X=$E(X)
"RTN","RART1",181,0)
 I $D(RALERTS),(X="P") D QRPT^RART3
"RTN","RART1",182,0)
 Q:X="^"!(X="P")  W:X="C"&($D(RAP)) @IOF
"RTN","RART1",183,0)
 Q
"RTN","RART1",184,0)
 ;
"RTN","RART1",185,0)
LOCK(X,Y) ; Lock an entry
"RTN","RART1",186,0)
 W !!,$C(7),"Another user is editing this ",$S(X="R":"report (Case # "_Y_")",1:"exam (diagnostic code)"),".  Please try again later." H 4 Q
"RTN","RART1",187,0)
 ;
"RTN","RART1",188,0)
SETVARS ; Setup Rad/Nuc Med required variables
"RTN","RART1",189,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RART1",190,0)
 Q:'($D(RACCESS(DUZ))\10)
"RTN","RART1",191,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1)
"RTN","RART1",192,0)
 Q
"RTN","RARTE")
0^8^B24025418
"RTN","RARTE",1,0)
RARTE ;HISC/FPT,GJC AISC/MJK,RMO-Edit/Delete Reports ;8/4/97  09:09
"RTN","RARTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,34**;Mar 16, 1998
"RTN","RARTE",3,0)
 ; last modification by SS for P18 June 14,2000
"RTN","RARTE",4,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE",5,0)
 N RAXIT,RADRS,RASUBY0 S RAXIT=0 ;RADRS=copy (1=diag, 2=resid,staff)
"RTN","RARTE",6,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q^RARTE4 QUIT
"RTN","RARTE",7,0)
 ;
"RTN","RARTE",8,0)
 ;1. DO NOT KILL the RASIG variable; the RASIG() array is needed in
"RTN","RARTE",9,0)
 ;   the edit template [RA REPORT EDIT] later
"RTN","RARTE",10,0)
 ;2. The RAELESIG canNOT store file 74's ien, as no rpt has been picked
"RTN","RARTE",11,0)
 ;   from this call to ES^RASIGU
"RTN","RARTE",12,0)
 ;
"RTN","RARTE",13,0)
 I $D(^XUSEC("RA VERIFY",DUZ)),($$GET1^DIQ(200,DUZ_",",20.4)]""),($D(^VA(200,"ARC","R",DUZ))!($D(^VA(200,"ARC","S",DUZ)))) D  Q:'$D(RAELESIG)
"RTN","RARTE",14,0)
 . W ! D ES^RASIGU S:%=1 RAELESIG=""
"RTN","RARTE",15,0)
 . K:'$D(RAELESIG) %,%W,%Y,%Y1,C,X,X1,X2
"RTN","RARTE",16,0)
 . Q
"RTN","RARTE",17,0)
 K RABTCH I $P(RAMDV,"^",13) D ASKBTCH^RARTE1 G Q1^RARTE4:X["^" D 1^RABTCH:"Yy"[$E(X) I '$D(RABTCH) W " ...no batch selected",!
"RTN","RARTE",18,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q^RARTE4:"^"[X
"RTN","RARTE",19,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE",20,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 DISPLAY
"RTN","RARTE",21,0)
 I $D(^XUSEC("RA MGR",DUZ)) G DISPLAY
"RTN","RARTE",22,0)
 G:$P(RAMDV,"^",22)=1 DISPLAY
"RTN","RARTE",23,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT^RARTE4 G START
"RTN","RARTE",24,0)
 ;
"RTN","RARTE",25,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE",26,0)
 N RA18EX S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE",27,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q^RARTE4 QUIT
"RTN","RARTE",28,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE",29,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE",30,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE",31,0)
 . Q
"RTN","RARTE",32,0)
 ;Lock case node so no one else can edit rpt pointer during this session
"RTN","RARTE",33,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE",34,0)
 S RAXIT=$$LOCK^RAUTL12(RAPNODE,RACNI) I RAXIT D INCRPT^RARTE4 G START
"RTN","RARTE",35,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE",36,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE",37,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE",38,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE",39,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE",40,0)
 N RAPRTSET,RAMEMARR,RA1
"RTN","RARTE",41,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE",42,0)
 I RAPRTSET D
"RTN","RARTE",43,0)
 . S RA1=""
"RTN","RARTE",44,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE",45,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE",46,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE",47,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE",48,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE",49,0)
 .. Q
"RTN","RARTE",50,0)
 . Q
"RTN","RARTE",51,0)
SS1 I RA18EX=-1 Q  ;P18
"RTN","RARTE",52,0)
 S Y(0)=RASUBY0
"RTN","RARTE",53,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RARTE",54,0)
 W !?40,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25),!,RAI
"RTN","RARTE",55,0)
 I $D(^RARPT(+RARPT,0)),$P(^(0),"^",5)="V" W !?3,$C(7),"Report has already been verified!",! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",56,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE",57,0)
 G IN^RARTE4:$D(^RARPT(+RARPT,0))
"RTN","RARTE",58,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE",59,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE",60,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE",61,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE",62,0)
 G:RA2="" NEW
"RTN","RARTE",63,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE",64,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE",65,0)
 S %=2 D YN^DICN
"RTN","RARTE",66,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE",67,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D INSERT^RARTE2
"RTN","RARTE",68,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",69,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE",70,0)
 L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1
"RTN","RARTE",71,0)
 W !!?10,$C(7),"** This case belongs to a printset,",?68,"**",!?10,"** and someone else is currently doing REPORT ENTRY/EDIT",?68,"**"
"RTN","RARTE",72,0)
 W !?10,"** on another case for this same printset,",?68,"**",!?10,"** so you may not enter a new report.",?68,"**"
"RTN","RARTE",73,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",74,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE",75,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE",76,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE",77,0)
 G LOCK^RARTE4
"RTN","RARTE",78,0)
 Q
"RTN","RASTREQ1")
0^13^B6580098
"RTN","RASTREQ1",1,0)
RASTREQ1 ;HISC/CAH,GJC AISC/MJK-Cont. of RASTREQ status reqmts ck ;5/29/97  12:52
"RTN","RASTREQ1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RASTREQ1",3,0)
 ;
"RTN","RASTREQ1",4,0)
 ; STUFF -- Called from UP1^RAUTL1 for editing an exam
"RTN","RASTREQ1",5,0)
 ; LOOP  -- Called from RASTREQ for status tracking
"RTN","RASTREQ1",6,0)
 ;             and from RASTREQ for cancel an exam
"RTN","RASTREQ1",7,0)
 ;
"RTN","RASTREQ1",8,0)
 ;Determine whether exam status can be updated to next higher status
"RTN","RASTREQ1",9,0)
 ;After this subrtn is executed, the following variables will exist:
"RTN","RASTREQ1",10,0)
 ;  RAOR= order seq no., = -1 if not eligible for an update
"RTN","RASTREQ1",11,0)
 ;  RASN= new status external format (or same status if not updateable)
"RTN","RASTREQ1",12,0)
 ;  RASTI= ien of new status if updateable
"RTN","RASTREQ1",13,0)
 ;This subrtn does not write any data to the status field, it only
"RTN","RASTREQ1",14,0)
 ;checks to see what the next status would be
"RTN","RASTREQ1",15,0)
 ;RABEFORE = status level BEFORE change
"RTN","RASTREQ1",16,0)
 ;RAAFTER = status level AFTER change
"RTN","RASTREQ1",17,0)
STUFF ; initialize RAOR=-1 to assume NO change if early quit
"RTN","RASTREQ1",18,0)
 S RAJ=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)),RAOR=-1
"RTN","RASTREQ1",19,0)
 S RABEFORE=$P($G(^RA(72,+$P(RAJ,U,3),0)),U,3)
"RTN","RASTREQ1",20,0)
 S RAORDIFN=+$P(RAJ,"^",11),RACS=$P(RAJ,"^",24),RAPRIT=$P(RAJ,"^",2)
"RTN","RASTREQ1",21,0)
 I $D(^RA(72,+$P(RAJ,"^",3),0)) S RASN=$P(^(0),"^") Q:$P(^(0),"^",3)'>0
"RTN","RASTREQ1",22,0)
 I $P(RAJ,"^",6)]"" S RAF5=$P(RAJ,"^",6)
"RTN","RASTREQ1",23,0)
 S RAIMGTYI=$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P(^RA(79.2,RAIMGTYI,0),U)
"RTN","RASTREQ1",24,0)
 ; set RAOR, RASN, RASTI to lowest level's, to allow event when
"RTN","RASTREQ1",25,0)
 ; none of the levels meet all the requirements for that level
"RTN","RASTREQ1",26,0)
LOOP S RAOR=$S($O(^RA(72,"AA",RAIMGTYJ,0))>0:$O(^(0)),1:1)
"RTN","RASTREQ1",27,0)
 S RASTI=+$O(^RA(72,"AA",RAIMGTYJ,RAOR,0)),RASN=$P($G(^RA(72,+RASTI,0)),U)
"RTN","RASTREQ1",28,0)
 ;
"RTN","RASTREQ1",29,0)
 N RA
"RTN","RASTREQ1",30,0)
 F K=0:0 S K=$O(^RA(72,"AA",RAIMGTYJ,K)) Q:K'>0  D
"RTN","RASTREQ1",31,0)
 . S X="",E=+$O(^RA(72,"AA",RAIMGTYJ,K,0)) Q:E'>0
"RTN","RASTREQ1",32,0)
 . I $D(^RA(72,E,0)) D
"RTN","RASTREQ1",33,0)
 .. S RA(0)=$G(^RA(72,E,0)),N=$P(RA(0),"^"),RAS=$G(^RA(72,E,.1))
"RTN","RASTREQ1",34,0)
 .. I '$L(RAS) S RAS="N"
"RTN","RASTREQ1",35,0)
 .. D HELP1^RASTREQ I $D(X),K>RAOR S RAOR=K,RASTI=E,RASN=N
"RTN","RASTREQ1",36,0)
 .. Q
"RTN","RASTREQ1",37,0)
 . Q
"RTN","RASTREQ1",38,0)
 S RAAFTER=RAOR
"RTN","RASTREQ1",39,0)
 I $D(RASTI),RASTI=$P(RAJ,"^",3) S RAOR=-1
"RTN","RASTREQ1",40,0)
 K RAZ,RAK,RAE,RAIMGTYI,RAIMGTYJ,E,RAS,RAJ,RAJ1,N,K,FL
"RTN","RASTREQ1",41,0)
 Q
"RTN","RASTREQ1",42,0)
CANCEL ; cancel an exam
"RTN","RASTREQ1",43,0)
 S RAOR=0,RASTI=RAXX,RASN=$P($G(^RA(72,RAXX,0)),"^")
"RTN","RASTREQ1",44,0)
 S RAAFTER=RAOR
"RTN","RASTREQ1",45,0)
 Q:$D(RAOPT("DELETEXAM"))  ; 1st chk skip, 2nd chk done already<-- delxam
"RTN","RASTREQ1",46,0)
 ; check again: 'allow cancelling' and if report exists
"RTN","RASTREQ1",47,0)
 ; in case Fileman enter/edit was used directly on the EXAM STATUS field
"RTN","RASTREQ1",48,0)
 ; if either check fails, set RAAFTER=RABEFORE so status can't change
"RTN","RASTREQ1",49,0)
 I $D(^RA(72,+$P(RAJ,U,3),0)),$P(^(0),"^",6)'="y" W !,"This exam is in the '",$P(^(0),"^"),"' status and cannot be 'CANCELLED'" S RAAFTER=RABEFORE Q
"RTN","RASTREQ1",50,0)
 ; ok to cancel exam w images if stub rpt and user has RA MGR key
"RTN","RASTREQ1",51,0)
 I $P(RAJ,U,17)'="",$$STUB^RAEDCN1($P(RAJ,U,17)),$D(^XUSEC("RA MGR",+$G(DUZ))) Q
"RTN","RASTREQ1",52,0)
 ; can't cancel exam if report isn't stub
"RTN","RASTREQ1",53,0)
 I $P(RAJ,U,17)'="" W !,"A report has been filed for this case.  Therefore cancellation is not allowed !" S RAAFTER=RABEFORE
"RTN","RASTREQ1",54,0)
 Q
"RTN","RAUTL11")
0^9^B43977760
"RTN","RAUTL11",1,0)
RAUTL11 ;HISC/CAH,FPT,GJC,SS-Utility File Maintenance ;4/21/97  11:59
"RTN","RAUTL11",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,35,34**;Mar 16, 1998
"RTN","RAUTL11",3,0)
 ;
"RTN","RAUTL11",4,0)
 ;Last modification : by SS, SEP 30,2000 for P18 
"RTN","RAUTL11",5,0)
HEAD ; Header
"RTN","RAUTL11",6,0)
 I $E(IOST,1,2)="C-"!(RAPG>0) W:$Y>0 @IOF
"RTN","RAUTL11",7,0)
 S RAPG=RAPG+1
"RTN","RAUTL11",8,0)
 W !?62,"Page: ",RAPG,!?62,"Date: ",RADATE
"RTN","RAUTL11",9,0)
 W !!?(IOM-$L(RAHDR)\2),RAHDR,!,RALINE,!
"RTN","RAUTL11",10,0)
 Q
"RTN","RAUTL11",11,0)
ORDELSH ;Called by the 'List Exams with Inactive/Invalid Statuses' option.
"RTN","RAUTL11",12,0)
 ;Exams with statuses whose 'Order' field is blank are printed
"RTN","RAUTL11",13,0)
 N RADATE,RAHDR,RALINE,RAOUT,RAPG,Y
"RTN","RAUTL11",14,0)
 S RAHDR="Exams with Inactive/Invalid Statuses"
"RTN","RAUTL11",15,0)
 S (RAPG,RAOUT)=0,$P(RALINE,"=",(IOM+1))="",Y=DT
"RTN","RAUTL11",16,0)
 X ^DD("DD") S RADATE=Y
"RTN","RAUTL11",17,0)
 K %ZIS S %ZIS="MQ" W ! D ^%ZIS I POP D Q2 Q
"RTN","RAUTL11",18,0)
 I $D(IO("Q")) D  W ! Q
"RTN","RAUTL11",19,0)
 . S ZTDESC="Rad/Nuc Med List Exams with Inactive/Invalid Statuses",ZTSAVE("RA*")=""
"RTN","RAUTL11",20,0)
 . S ZTRTN="2^RAUTL11" D ^%ZTLOAD
"RTN","RAUTL11",21,0)
 . W !?5,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","RAUTL11",22,0)
 . Q
"RTN","RAUTL11",23,0)
 D 2
"RTN","RAUTL11",24,0)
 Q
"RTN","RAUTL11",25,0)
2 ;
"RTN","RAUTL11",26,0)
 N A,B,C,D,E,F,FT,G,H,HD,I,J,K,L,LN,RACASE,RAEXDT,RAPAT,RAPROC,RARPT
"RTN","RAUTL11",27,0)
 N RASSN,X,Y,Y1,Y2 D HEAD
"RTN","RAUTL11",28,0)
 S (A,F)=0,FT="No evidence of inactive/invalid exams was detected."
"RTN","RAUTL11",29,0)
 S HD(1)="Exam Status: ",HD(2)="Imaging Type: "
"RTN","RAUTL11",30,0)
 S $P(LN(1),"*",($L(HD(1))-1))="",$P(LN(2),"*",($L(HD(2))-1))=""
"RTN","RAUTL11",31,0)
 F  S A=$O(^RA(72,A)) Q:A'>0  D  Q:RAOUT
"RTN","RAUTL11",32,0)
 . S B=$G(^RA(72,A,0)) Q:B']""
"RTN","RAUTL11",33,0)
 . S C=$P(B,U),D=$P(B,U,3),E=$P($G(^RA(79.2,+$P(B,U,7),0)),U)
"RTN","RAUTL11",34,0)
 . I D']"",($D(^RADPT("AS",A))) D
"RTN","RAUTL11",35,0)
 .. I $Y'<(IOSL-4) S RAOUT=$$EOS^RAUTL5() Q:RAOUT  D HEAD
"RTN","RAUTL11",36,0)
 .. W !,HD(1),C
"RTN","RAUTL11",37,0)
 .. W ?45,HD(2),$E($S(E]"":E,1:"Unknown"),1,20),!,LN(1),?45,LN(2),!
"RTN","RAUTL11",38,0)
 .. S F=1,G=0
"RTN","RAUTL11",39,0)
 .. F  S G=$O(^RADPT("AS",A,G)) Q:G'>0  S H=0 D  Q:RAOUT
"RTN","RAUTL11",40,0)
 ... S J=$G(^RADPT(G,0))
"RTN","RAUTL11",41,0)
 ... F  S H=$O(^RADPT("AS",A,G,H)) Q:H'>0  S I=0 D  Q:RAOUT
"RTN","RAUTL11",42,0)
 .... S K=$G(^RADPT(G,"DT",H,0))
"RTN","RAUTL11",43,0)
 .... F  S I=$O(^RADPT("AS",A,G,H,I)) Q:I'>0  D  Q:RAOUT
"RTN","RAUTL11",44,0)
 ..... S L=$G(^RADPT(G,"DT",H,"P",I,0))
"RTN","RAUTL11",45,0)
 ..... S RAPAT=$P($G(^DPT(+$P(J,U),0)),U)
"RTN","RAUTL11",46,0)
 ..... S RASSN=$P($G(^DPT(+$P(J,U),0)),U,9),RARPT=+$P(L,U,17)
"RTN","RAUTL11",47,0)
 ..... I RARPT D
"RTN","RAUTL11",48,0)
 ...... S Y1=$P($G(^RARPT(RARPT,0)),U,5)
"RTN","RAUTL11",49,0)
 ...... S Y2=$P($G(^DD(74,5,0)),U,2)
"RTN","RAUTL11",50,0)
 ...... S RARPT("STAT")=$$XTERNAL^RAUTL5(Y1,Y2)
"RTN","RAUTL11",51,0)
 ...... Q
"RTN","RAUTL11",52,0)
 ..... S Y=$P(K,U) X ^DD("DD") S RAEXDT=Y
"RTN","RAUTL11",53,0)
 ..... S RACASE=$P(L,U),RAPROC=$P($G(^RAMIS(71,+$P(L,U,2),0)),U)
"RTN","RAUTL11",54,0)
 ..... I $Y'<(IOSL-4) D  Q:RAOUT
"RTN","RAUTL11",55,0)
 ...... S RAOUT=$$EOS^RAUTL5() Q:RAOUT  D HEAD
"RTN","RAUTL11",56,0)
 ...... W !,HD(1),C,?45,HD(2),$E($S(E]"":E,1:"Unknown"),1,20)
"RTN","RAUTL11",57,0)
 ...... W !,LN(1),?45,LN(2),!
"RTN","RAUTL11",58,0)
 ...... Q
"RTN","RAUTL11",59,0)
 ..... W !,"Patient: ",$S(RAPAT]"":RAPAT,1:"Unknown")
"RTN","RAUTL11",60,0)
 ..... W ?45,"SSN: ",$E(RASSN,1,3)_"-"_$E(RASSN,4,5)_"-"_$E(RASSN,6,9)
"RTN","RAUTL11",61,0)
 ..... W !,"Exam Date: ",$S(RAEXDT]"":RAEXDT,1:"Unknown")
"RTN","RAUTL11",62,0)
 ..... W ?45,"Case #: ",$S(RACASE]"":RACASE,1:" --- ")
"RTN","RAUTL11",63,0)
 ..... I RARPT D
"RTN","RAUTL11",64,0)
 ...... W !,"Reported: Yes",?45,"Report Status: "
"RTN","RAUTL11",65,0)
 ...... W $S(RARPT("STAT")]"":$E(RARPT("STAT"),1,19),1:"Unknown")
"RTN","RAUTL11",66,0)
 ...... Q
"RTN","RAUTL11",67,0)
 ..... W !,"Procedure: ",$S(RAPROC]"":RAPROC,1:"Unknown"),!
"RTN","RAUTL11",68,0)
 ..... Q
"RTN","RAUTL11",69,0)
 .... Q
"RTN","RAUTL11",70,0)
 ... Q
"RTN","RAUTL11",71,0)
 .. Q
"RTN","RAUTL11",72,0)
 . Q
"RTN","RAUTL11",73,0)
 I 'F W !?(IOM-$L(FT)\2),FT
"RTN","RAUTL11",74,0)
 S:$D(ZTQUEUED) ZTREQ="@" D ^%ZISC
"RTN","RAUTL11",75,0)
Q2 K DUOUT,I,POP
"RTN","RAUTL11",76,0)
 Q
"RTN","RAUTL11",77,0)
 ;
"RTN","RAUTL11",78,0)
 ;called from RAO7PC1,saves TECH COMMENT in ^TMP($J,"RAE2",
"RTN","RAUTL11",79,0)
SVTCOM(RA11DFN,RA11DTI,RA11CNI) ;P18 used for API call
"RTN","RAUTL11",80,0)
 N RA11
"RTN","RAUTL11",81,0)
 S RA11(0)=$G(^RADPT(RA11DFN,"DT",RA11DTI,"P",RA11CNI,0))
"RTN","RAUTL11",82,0)
 Q:RA11(0)']""
"RTN","RAUTL11",83,0)
 S RA11(1)=$G(^RAMIS(71,+$P(RA11(0),"^",2),0))
"RTN","RAUTL11",84,0)
 S RA11(2)=$S($P(RA11(1),"^")]"":$P(RA11(1),"^"),1:"Unknown")
"RTN","RAUTL11",85,0)
 S RA11(3)=$$GETTCOM(RA11DFN,RA11DTI,RA11CNI)
"RTN","RAUTL11",86,0)
 S:RA11(3)'="" ^TMP($J,"RAE2",RA11DFN,RA11CNI,RA11(2),"TCOM",1)=RA11(3)
"RTN","RAUTL11",87,0)
 Q
"RTN","RAUTL11",88,0)
 ;
"RTN","RAUTL11",89,0)
GETTCOM(RA11DFN,RA11DTI,RA11CNI) ;P18 returns most recent tech comment
"RTN","RAUTL11",90,0)
 N RA11X,RA11XI
"RTN","RAUTL11",91,0)
 S RA11X="",RA11XI=99999
"RTN","RAUTL11",92,0)
 F  S RA11XI=$O(^RADPT(RA11DFN,"DT",RA11DTI,"P",RA11CNI,"L",RA11XI),-1) Q:+RA11XI=0  I RA11XI>0 S RA11X=$G(^RADPT(RA11DFN,"DT",RA11DTI,"P",RA11CNI,"L",RA11XI,"TCOM"),"") Q:RA11X'=""
"RTN","RAUTL11",93,0)
 Q RA11X
"RTN","RAUTL11",94,0)
 ;
"RTN","RAUTL11",95,0)
 ;Outputs most recent tech comments.Arguments:
"RTN","RAUTL11",96,0)
 ;RADFN,RADTI,RACNI,header(can be ""),left margin,right margin,
"RTN","RAUTL11",97,0)
 ;number of lines in the bottom before checking bottom of screen,
"RTN","RAUTL11",98,0)
 ;is NL before and after header,number of lines to output,
"RTN","RAUTL11",99,0)
 ;put header even if no text 
"RTN","RAUTL11",100,0)
PUTTCOM(RA18DFN,RA18DTI,RA18CNI,RA18HDR,RA18LFTM,RA18RGHM,RA18BOT,RANLHD,RAHDNL,RALINES,RAWRHDR) ;P18 outputs techcomm
"RTN","RAUTL11",101,0)
 N RA18X,RA18XI
"RTN","RAUTL11",102,0)
 S RA18X="",RA18X=$$GETTCOM(RA18DFN,RA18DTI,RA18CNI) I RA18X="" D  Q 0
"RTN","RAUTL11",103,0)
 . I RAWRHDR=1 W:RANLHD ! W RA18HDR W:RAHDNL !
"RTN","RAUTL11",104,0)
 . Q
"RTN","RAUTL11",105,0)
 W:RANLHD ! W RA18HDR W:RAHDNL !
"RTN","RAUTL11",106,0)
 Q:$$TXTOUT(RA18X,RA18LFTM,RA18RGHM,RA18BOT,RA18HDR,RALINES,RANLHD,RAHDNL,0)=-1 -1
"RTN","RAUTL11",107,0)
 Q 1
"RTN","RAUTL11",108,0)
 ;
"RTN","RAUTL11",109,0)
CONTIN(RABTM) ;P18 screen check
"RTN","RAUTL11",110,0)
 Q:$D(RARTVERF) 0 ;on-line verify or resident preverify--ENTIRE report
"RTN","RAUTL11",111,0)
 I ($Y+RABTM)'>IOSL Q 0
"RTN","RAUTL11",112,0)
 Q:$$EOS^RAUTL5()>0 -1
"RTN","RAUTL11",113,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","RAUTL11",114,0)
 Q 1
"RTN","RAUTL11",115,0)
 ;
"RTN","RAUTL11",116,0)
 ;Prints text.Arguments:
"RTN","RAUTL11",117,0)
 ;Text,Left margin,Right margin
"RTN","RAUTL11",118,0)
 ;Number of lines in the bottom before screen check.if <0 don't check
"RTN","RAUTL11",119,0)
 ;Header text displayed ONLY for next page;Max lines to output, Should place NL before header,
"RTN","RAUTL11",120,0)
 ;Should place NL after header
"RTN","RAUTL11",121,0)
 ;Should place header for continuation after screen check
"RTN","RAUTL11",122,0)
TXTOUT(RA11TXT,RA11LM,RA11RM,RABT,RAHD,RALIN,RANLHD,RAHDNL,RA18ISHD) ;P18 outputs text
"RTN","RAUTL11",123,0)
 Q:(RA11LM'<RA11RM) 0
"RTN","RAUTL11",124,0)
 N DIWF,DIWL,DIWR,RAX,X,RALN,RA18EX,RA18A,RA18B,RA18C,RACHKBOT S (RA18EX,RAX)=0,RA18A="",RA18C=0
"RTN","RAUTL11",125,0)
 S RACHKBOT=$S(RABT<0:0,1:1)
"RTN","RAUTL11",126,0)
 S DIWF="|",DIWL=RA11LM,DIWR=RA11RM K ^UTILITY($J,"W")
"RTN","RAUTL11",127,0)
 S X=RA11TXT
"RTN","RAUTL11",128,0)
 D ^DIWP
"RTN","RAUTL11",129,0)
 S RAX=0 F RALN=1:1 S RAX=$O(^UTILITY($J,"W",DIWL,RAX)) Q:RAX'>0!(RA18EX'=0)!(RA18C=-1)  D
"RTN","RAUTL11",130,0)
 . S RA18B=+$O(^UTILITY($J,"W",DIWL,RAX)) ;is it last?
"RTN","RAUTL11",131,0)
 . S X=$G(^UTILITY($J,"W",DIWL,RAX,0))
"RTN","RAUTL11",132,0)
 . I RALN'<RALIN S RA18EX=1 D  Q
"RTN","RAUTL11",133,0)
 .. S $P(RA18A," ",RA11RM-RA11LM-$L(X))="",X=X_RA18A
"RTN","RAUTL11",134,0)
 .. S:+RA18B'=0 X=$E(X,1,RA11RM-RA11LM)_"(more...)" W ?DIWL,X
"RTN","RAUTL11",135,0)
 .. Q
"RTN","RAUTL11",136,0)
 . W ?DIWL,X
"RTN","RAUTL11",137,0)
 . W:+RA18B>0 !
"RTN","RAUTL11",138,0)
 . I RACHKBOT=1 S RA18C=$$CONTIN(RABT) Q:RA18C=-1
"RTN","RAUTL11",139,0)
 . I RA18ISHD I RA18C=1 I RA18B W:RANLHD ! W RAHD W:RAHDNL !
"RTN","RAUTL11",140,0)
 . Q
"RTN","RAUTL11",141,0)
 Q $S(RA18C=-1:-1,1:0)
"RTN","RAUTL11",142,0)
 ;
"RTN","RAUTL11",143,0)
PUTTCOM2(RA18DFN,RA18DTI,RA18CN,RA18HDR,RA18LFTM,RA18RGHM,RA18BOT,RA18HDNL) ;P18 outputs techcomm using caseNo see PUTTCOM
"RTN","RAUTL11",144,0)
 N RA18A S RA18A=$$FNDIN70M^RAO7XX(RA18DFN,RA18DTI,RA18CN,"T")
"RTN","RAUTL11",145,0)
 Q:RA18A=0 0
"RTN","RAUTL11",146,0)
 Q:$$PUTTCOM(RA18DFN,RA18DTI,$P(RA18A,"^",2),RA18HDR,RA18LFTM,RA18RGHM,RA18BOT,1,RA18HDNL,2,0)=-1 -1
"RTN","RAUTL11",147,0)
 Q 0
"RTN","RAUTL11",148,0)
 ;
"RTN","RAUTL11",149,0)
VERONLY() ;outputs header with case info for Verify only menu option
"RTN","RAUTL11",150,0)
 N RA18EX,RA18I S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RAUTL11",151,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  Q
"RTN","RAUTL11",152,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RAUTL11",153,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RAUTL11",154,0)
 . W !?2,"by another user!",$C(7)
"RTN","RAUTL11",155,0)
 . Q
"RTN","RAUTL11",156,0)
 W !
"RTN","RAUTL11",157,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN,"Tech. Comment for case No. "_RACN_":",1,70,-1,1)
"RTN","RAUTL11",158,0)
 Q:RA18EX=-1
"RTN","RAUTL11",159,0)
 N RAPRTSET,RAMEMARR,RA1P18
"RTN","RAUTL11",160,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RAUTL11",161,0)
 I RAPRTSET D
"RTN","RAUTL11",162,0)
 . S RA1P18=""
"RTN","RAUTL11",163,0)
 . F  S RA1P18=$O(RAMEMARR(RA1P18)) Q:RA1P18=""!(RA18EX=-1)  I RA1P18'=RACNI D
"RTN","RAUTL11",164,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1P18),"Tech. Comment for case No. "_+RAMEMARR(RA1P18)_":",1,70,-1,1) Q:RA18EX=-1  ;
"RTN","RAUTL11",165,0)
 .. Q
"RTN","RAUTL11",166,0)
 . Q
"RTN","RAUTL11",167,0)
 Q RA18EX
"RTN","RAUTL11",168,0)
 ;------------
"RTN","RAUTL11",169,0)
 ;Outputs tech comment using
"RTN","RAUTL11",170,0)
 ;RADFN,RADTI,RACNI,activity log ien,header(can be ""),left margin,
"RTN","RAUTL11",171,0)
 ;right margin,number of lines in the bottom 
"RTN","RAUTL11",172,0)
 ;before checking bottom of screen,is NL after header,
"RTN","RAUTL11",173,0)
 ;number of lines to output,header even if no comments 
"RTN","RAUTL11",174,0)
PUTTCOM3(RA18DFN,RA18DTI,RA18CNI,RA18LOG,RA18HDR,RA18LFTM,RA18RGHM,RA18BOT,RANLHD,RAHDNL,RALINES,RAWRHDR) ;P18 outputs techcomm
"RTN","RAUTL11",175,0)
 N RA18X,RA18XI,I
"RTN","RAUTL11",176,0)
 S RA18X="",RA18X=$G(^RADPT(RA18DFN,"DT",RA18DTI,"P",RA18CNI,"L",RA18LOG,"TCOM"),"") I RA18X="" D  Q 0
"RTN","RAUTL11",177,0)
 . I RAWRHDR=1 W:RANLHD ! W RA18HDR W:RAHDNL !
"RTN","RAUTL11",178,0)
 . Q
"RTN","RAUTL11",179,0)
 W:RANLHD ! W RA18HDR W:RAHDNL !
"RTN","RAUTL11",180,0)
 Q:$$TXTOUT(RA18X,RA18LFTM,RA18RGHM,RA18BOT,RA18HDR,RALINES,RANLHD,RAHDNL,0)=-1 -1
"RTN","RAUTL11",181,0)
 Q 1
"RTN","RAUTL14")
0^10^B12249440
"RTN","RAUTL14",1,0)
RAUTL14 ;HISC/GJC-Utilities for message display. ;10/19/94  08:53
"RTN","RAUTL14",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34**;Mar 16, 1998
"RTN","RAUTL14",3,0)
EN1 ; Message display.  Called from the input transform of the
"RTN","RAUTL14",4,0)
 ;'TYPE OF IMAGING' field of the Imaging Locations file
"RTN","RAUTL14",5,0)
 ; i.e, ^DD(79.1,6,0) --> D:'$D(^RA(79.1,"BIMG",+Y)) EN1^RAUTL14
"RTN","RAUTL14",6,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,RATXT,RAX,RAY,RAYN
"RTN","RAUTL14",7,0)
 S RAX=X,RAY=Y,RATXT(1)=" " K X,Y
"RTN","RAUTL14",8,0)
 S RATXT(2)="** Caution: You are activating a new Imaging Type.  **"
"RTN","RAUTL14",9,0)
 S RATXT(3)="   This means you will have to assign procedures to"
"RTN","RAUTL14",10,0)
 S RATXT(4)="   this imaging type.  Workload reports will be printed"
"RTN","RAUTL14",11,0)
 S RATXT(5)="   separately for this Imaging Type."
"RTN","RAUTL14",12,0)
 S RATXT(6)=" " D EN^DDIOL(.RATXT) S DIR(0)="YA"
"RTN","RAUTL14",13,0)
 S DIR("A")="Are you sure? "
"RTN","RAUTL14",14,0)
 S DIR("?")="Enter 'Y' for yes, 'N' to re-edit this field."
"RTN","RAUTL14",15,0)
 D ^DIR S RAYN=+Y K X,Y D EN^DDIOL(" ")
"RTN","RAUTL14",16,0)
 S X=RAX,Y=RAY K:'RAYN X Q:'$D(X)
"RTN","RAUTL14",17,0)
 I $D(^RA(79.2,"B","CARDIOLOGY STUDIES (NUC MED)",+Y)) K RATXT D
"RTN","RAUTL14",18,0)
 . S RATXT(1)="   The 'CARDIOLOGY STUDIES' imaging type should not be"
"RTN","RAUTL14",19,0)
 . S RATXT(2)="   activated unless nuclear cardiology is done separately"
"RTN","RAUTL14",20,0)
 . S RATXT(3)="   from Nuclear Medicine at your facility."
"RTN","RAUTL14",21,0)
 . D EN^DDIOL(.RATXT)
"RTN","RAUTL14",22,0)
 . Q
"RTN","RAUTL14",23,0)
 Q
"RTN","RAUTL14",24,0)
EN2 ; Message display.  Called from input transform of the
"RTN","RAUTL14",25,0)
 ;'TYPE OF IMAGING' field of the Rad/Nuc Med Procedure file
"RTN","RAUTL14",26,0)
 ; i.e, ^DD(71,12,0) --> D EN2^RAUTL14
"RTN","RAUTL14",27,0)
 I '$D(^RA(79.1,"BIMG",+Y)) D
"RTN","RAUTL14",28,0)
 . N RATXT,X,Y S RATXT(1)=" "
"RTN","RAUTL14",29,0)
 . S RATXT(2)="This Imaging Type has not been assigned to any Imaging Location."
"RTN","RAUTL14",30,0)
 . S RATXT(3)="In order to register this procedure for patients, you must"
"RTN","RAUTL14",31,0)
 . S RATXT(4)="assign this Imaging Type to an Imaging Location."
"RTN","RAUTL14",32,0)
 . S RATXT(5)=" " D EN^DDIOL(.RATXT)
"RTN","RAUTL14",33,0)
 . Q
"RTN","RAUTL14",34,0)
 N RAD0,RASEQ
"RTN","RAUTL14",35,0)
 S RAD0=+$O(^RAMIS(71.3,"B",D0,0)),RASEQ=$P($G(^RAMIS(71.3,RAD0,0)),U,4)
"RTN","RAUTL14",36,0)
 I RASEQ D  K X
"RTN","RAUTL14",37,0)
 . N RATXT,X,Y S RATXT(1)=" "
"RTN","RAUTL14",38,0)
 . S RATXT(2)="This procedure was found in the Rad/Nuc Med Common"
"RTN","RAUTL14",39,0)
 . S RATXT(3)="Procedure file.  To change its imaging type you must"
"RTN","RAUTL14",40,0)
 . S RATXT(4)="first inactivate it in that file.  After it is made"
"RTN","RAUTL14",41,0)
 . S RATXT(5)="inactive you may change its imaging type.  You can"
"RTN","RAUTL14",42,0)
 . S RATXT(6)="then reactivate it if you wish."
"RTN","RAUTL14",43,0)
 . S RATXT(7)=" " D EN^DDIOL(.RATXT)
"RTN","RAUTL14",44,0)
 . Q
"RTN","RAUTL14",45,0)
 Q
"RTN","RAUTL14",46,0)
UNI30(RADA,RAX) ; Determines if the 1st 30 chars of a procedure name are unique.
"RTN","RAUTL14",47,0)
 ; If not, do not allow the user to add or alter the current procedure.
"RTN","RAUTL14",48,0)
 ; Don't allow characters ; ^
"RTN","RAUTL14",49,0)
 ; Called from the input transform in ^DD(71,.01,0)
"RTN","RAUTL14",50,0)
 ; Pass back 1 if unique, 0 if a conflict.
"RTN","RAUTL14",51,0)
 ; 'RA'   ---> temporary variable to hold data
"RTN","RAUTL14",52,0)
 ; 'RAX'  ---> Input user wishes to enter/edit in ^RAMIS(71
"RTN","RAUTL14",53,0)
 ; 'RADA' ---> IEN of the current entry in ^RAMIS(71,
"RTN","RAUTL14",54,0)
 ; The first 30 do not match any other entries first 30
"RTN","RAUTL14",55,0)
 N RA1,RA2,RABEG,RAEND,RAFLG1,RAFLG2,RALEN,RALST,RAPCE,RAY,RAI,RAQ
"RTN","RAUTL14",56,0)
 S (RAFLG1,RAFLG2)=0
"RTN","RAUTL14",57,0)
 ;S RABEG=$E(RAX,1,30),RALEN=$L(RABEG),RALST=$E(RABEG,$L(RABEG))
"RTN","RAUTL14",58,0)
 ;S RAEND=$E(RABEG,1,(RALEN-1))_$C(($A(RALST)-1))_"z"
"RTN","RAUTL14",59,0)
 ;
"RTN","RAUTL14",60,0)
 ; Check for bad chars
"RTN","RAUTL14",61,0)
 S RAY=";^",RAQ=""
"RTN","RAUTL14",62,0)
 F RAI=1:1:$L(RAY) I RAX[($E(RAY,RAI)) S RAQ=1
"RTN","RAUTL14",63,0)
 I RAQ D EN^DDIOL("Entry must not contain ^ or ;    ",,"!?12,$C(7)") Q 0 ; bad char detected, so reject entry
"RTN","RAUTL14",64,0)
 ;
"RTN","RAUTL14",65,0)
 ;
"RTN","RAUTL14",66,0)
 S RA1=$O(^RAMIS(71,"B",RAX),-1) ; Obtain collating entry immediately
"RTN","RAUTL14",67,0)
 ;                          before user input.  Check 1st 30 of prior
"RTN","RAUTL14",68,0)
 ;                          entry aginst 1st 30 of user entry.
"RTN","RAUTL14",69,0)
 ;                          If different, ok!
"RTN","RAUTL14",70,0)
 ;
"RTN","RAUTL14",71,0)
 S:$E(RA1,1,30)'=$E(RAX,1,30) RAFLG1=1
"RTN","RAUTL14",72,0)
 ;
"RTN","RAUTL14",73,0)
 S RA2=$O(^RAMIS(71,"B",RAX)) ; Obtain the collating entry of
"RTN","RAUTL14",74,0)
 S:$E(RA2,1,30)'=$E(RAX,1,30) RAFLG2=1 ; the entry immediately after the
"RTN","RAUTL14",75,0)
 ;                                       user input.  If the 1st 30 of
"RTN","RAUTL14",76,0)
 ;                                       user input does not equal the
"RTN","RAUTL14",77,0)
 ;                                       1st 30 of the next collating
"RTN","RAUTL14",78,0)
 ;                                       entry, the input is ok!
"RTN","RAUTL14",79,0)
 ;
"RTN","RAUTL14",80,0)
 ; Brand new entry
"RTN","RAUTL14",81,0)
 I RADA=0 Q $S((RAFLG1+RAFLG2)>1:1,1:0)
"RTN","RAUTL14",82,0)
 ;
"RTN","RAUTL14",83,0)
 S RAPCE=$P($G(^RAMIS(71,RADA,0)),"^")
"RTN","RAUTL14",84,0)
 I RADA,($E(RAPCE,1,30)=$E(RAX,1,30)) Q 1 ; 1st 30 chars of user input
"RTN","RAUTL14",85,0)
 ;                                          may equal the 1st 30 chars
"RTN","RAUTL14",86,0)
 ;                                          of the record we are editing.
"RTN","RAUTL14",87,0)
 ;
"RTN","RAUTL14",88,0)
 E  Q $S((RAFLG1+RAFLG2)>1:1,1:0) ; The 1st thirty chars may have changed
"RTN","RAUTL14",89,0)
 ;                                  Check RAFLG1 & RAFLG2 for conflicts
"RTN","RAUTL14",90,0)
 ;                                  with any other data in the database.
"RTN","RAUTL20")
0^11^B31321948
"RTN","RAUTL20",1,0)
RAUTL20 ;HISC/SWM-Utility Routine ;6/16/97  14:27
"RTN","RAUTL20",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,34**;Mar 16, 1998
"RTN","RAUTL20",3,0)
 ;
"RTN","RAUTL20",4,0)
EN1 ; for displaying  +  and  .   during case lookup
"RTN","RAUTL20",5,0)
 S RAPRTSET=0
"RTN","RAUTL20",6,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RAUTL20",7,0)
 Q:RADFN=""!(RADTI="")!(RACNI="")
"RTN","RAUTL20",8,0)
 ; output : RAPRTSET=1 : case is part of a combined PRINTset, & flag it
"RTN","RAUTL20",9,0)
 ;          RAMEMLOW=1 : case is lowest ien of print set AND flag it
"RTN","RAUTL20",10,0)
 N RA1,RA2,RA3,RA4,RA5,RA6,RA7,RACN S RA1="",RA3="A",RA5=0
"RTN","RAUTL20",11,0)
 S RACN=+$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAUTL20",12,0)
 S RAMEMLOW=0
"RTN","RAUTL20",13,0)
 S RAPRTSET=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",25)=2
"RTN","RAUTL20",14,0)
 Q:'RAPRTSET
"RTN","RAUTL20",15,0)
 ; put  +  infront of lowest ien of case that has MEMBER OF SET = 2
"RTN","RAUTL20",16,0)
 F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P",RA1)) Q:RA1=""  Q:$P($G(^(RA1,0)),U,25)=2  ; RA1 is at lowest ien with MEMBER OF SET = 2
"RTN","RAUTL20",17,0)
 S:RACNI=RA1 RAMEMLOW=1
"RTN","RAUTL20",18,0)
 S RA1="" F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RA1)) Q:RA1=""  D LOOP1
"RTN","RAUTL20",19,0)
 I RA5 S RAPRTSET=0,RAMEMLOW=0 ;don't display if ptrs to #74 differ within set
"RTN","RAUTL20",20,0)
 Q
"RTN","RAUTL20",21,0)
LOOP1 ; RA1=  : for-loop var
"RTN","RAUTL20",22,0)
 ; RA2=  : (1) ien for 70.03  (2) also, pointer value to file #74
"RTN","RAUTL20",23,0)
 ; RA3=  : holds earliest case with pointer value to file #74
"RTN","RAUTL20",24,0)
 ; RA4=  : (ienof #70.03)=case number^procedure pointers^ptr #74
"RTN","RAUTL20",25,0)
 ; RA5=0 : all cases in set point to same non-null rarpt() or all null
"RTN","RAUTL20",26,0)
 ;         regardless of cancelled status
"RTN","RAUTL20",27,0)
 ; RA5<>0: one or more cases in set point to different rarpt()
"RTN","RAUTL20",28,0)
 ; RA6=  : pointer to file #72 examination status
"RTN","RAUTL20",29,0)
 ; RA7=1 : denote call of LOOP1 came from EN2 and not from EN1
"RTN","RAUTL20",30,0)
 S RA2=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RA1,0))
"RTN","RAUTL20",31,0)
 ; skip rec if it's not part of combined report
"RTN","RAUTL20",32,0)
 Q:$P(^RADPT(RADFN,"DT",RADTI,"P",RA2,0),"^",25)'=2
"RTN","RAUTL20",33,0)
 S:$G(RA7) RA4=RA2,RA4(RA4)=RA1
"RTN","RAUTL20",34,0)
 S RA2=$P(^RADPT(RADFN,"DT",RADTI,"P",RA2,0),"^",17),RA6=$P(^(0),"^",3) S:$G(RA7) RA4(RA4)=RA4(RA4)_"^"_$P(^(0),"^",2)_"^"_$P(^(0),"^",17)_"^"_$P(^(0),"^",3)
"RTN","RAUTL20",35,0)
 ; skip if exm canc'd & exm's pc 17 is null
"RTN","RAUTL20",36,0)
 I $P($G(^RA(72,+RA6,0)),"^",3)=0,RA2="" Q
"RTN","RAUTL20",37,0)
 S:RA3="A" RA3=RA2
"RTN","RAUTL20",38,0)
 I RA5=0,RA2]"" S RA5=RA2-RA3
"RTN","RAUTL20",39,0)
 Q
"RTN","RAUTL20",40,0)
EN2(RA4) ; display all print members' procs during report editing/printg
"RTN","RAUTL20",41,0)
 S RAPRTSET=0
"RTN","RAUTL20",42,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RAUTL20",43,0)
 Q:RADFN=""!(RADTI="")!(RACNI="")
"RTN","RAUTL20",44,0)
 ; output : RA4(IEN OF #70.03)=CASE NUMBER^IEN OF #71 (procedure)^ptr #74
"RTN","RAUTL20",45,0)
 ;                            ^exm stat
"RTN","RAUTL20",46,0)
 ;          RAPRTSET = 1 : case is part of a combined PRINTset
"RTN","RAUTL20",47,0)
 N RA1,RA2,RA3,RA5,RA6,RA7 S RA1="",RA3="A",RA5=0,RA7=1
"RTN","RAUTL20",48,0)
 F  S RA1=$O(RA4(RA1)) Q:RA1=""  K RA4(RA1) ;clean up array
"RTN","RAUTL20",49,0)
 S RAPRTSET=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",25)=2
"RTN","RAUTL20",50,0)
 Q:'RAPRTSET
"RTN","RAUTL20",51,0)
 F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RA1)) Q:RA1=""  D LOOP1
"RTN","RAUTL20",52,0)
 I RA5 S RAPRTSET=0 ;don't display if ptrs to #74 differ within set
"RTN","RAUTL20",53,0)
 Q
"RTN","RAUTL20",54,0)
EN3(RA4) ; for print set, AFTER record is created in rarpt()
"RTN","RAUTL20",55,0)
 Q:'$D(RADFN)!('$D(RADTI))
"RTN","RAUTL20",56,0)
 Q:RADFN=""!(RADTI="")
"RTN","RAUTL20",57,0)
 ; output :RA4(IEN OF #70.03)=CASE NUMBER  (ONLY THOSE CASES FROM #74.05)
"RTN","RAUTL20",58,0)
 N RA1,RA2,RA3,RA5 S RA1="",RA3="A"
"RTN","RAUTL20",59,0)
 F  S RA1=$O(RA4(RA1)) Q:RA1=""  K RA4(RA1) ;clean up array
"RTN","RAUTL20",60,0)
 S RA5=$S($G(RARPT):RARPT,$G(RAIEN):RAIEN,1:0) Q:RA5=0
"RTN","RAUTL20",61,0)
 F  S RA1=$O(^RARPT(RA5,1,"B",RA1)) Q:RA1=""  S RA2=$P(RA1,"-",2),RA3=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RA2,0)),RA4(RA3)=RA2
"RTN","RAUTL20",62,0)
 Q
"RTN","RAUTL20",63,0)
XPRI ;loop thru sub-file #74.05 to set/kill prim. xref for other prt members
"RTN","RAUTL20",64,0)
 Q:'$D(RADFNZ)!('$D(RADTIZ))!('$D(RARAD))!('$D(RAXREF))!('$D(DA))
"RTN","RAUTL20",65,0)
 Q:$O(^RARPT(DA,1,"B",0))=""
"RTN","RAUTL20",66,0)
 N RA1,RA200 S RA1=""
"RTN","RAUTL20",67,0)
XPRI1 S RA1=$O(^RARPT(DA,1,"B",RA1)) Q:RA1=""
"RTN","RAUTL20",68,0)
 S RACNIZ=$O(^RADPT(RADFNZ,"DT",RADTIZ,"P","B",$P(RA1,"-",2),0))
"RTN","RAUTL20",69,0)
 G:'$D(^RADPT(RADFNZ,"DT",RADTIZ,"P",RACNIZ,0)) XPRI1 S RA200=+$P(^(0),"^",RARADOLD) ; use raradold to get piece number in "p" node
"RTN","RAUTL20",70,0)
 G XPRI1:'RA200
"RTN","RAUTL20",71,0)
 S:$D(RASET) ^RARPT(RAXREF,RA200,DA)=""
"RTN","RAUTL20",72,0)
 K:$D(RAKILL) ^RARPT(RAXREF,RA200,DA)
"RTN","RAUTL20",73,0)
 G XPRI1
"RTN","RAUTL20",74,0)
XSEC ;loop thru sub-file #74.05 to set/kill sec. xref for other print members
"RTN","RAUTL20",75,0)
 Q:'$D(RADFNZ)!('$D(RADTIZ))!('$D(RASECOND))!('$D(RAXREF))!('$D(DA))
"RTN","RAUTL20",76,0)
 Q:$O(^RARPT(DA,1,"B",0))=""
"RTN","RAUTL20",77,0)
 N RA1,RA2,RA200 S RA1=""
"RTN","RAUTL20",78,0)
XSEC1 S RA1=$O(^RARPT(DA,1,"B",RA1)) Q:RA1=""
"RTN","RAUTL20",79,0)
 S RACNIZ=$O(^RADPT(RADFNZ,"DT",RADTIZ,"P","B",$P(RA1,"-",2),0))
"RTN","RAUTL20",80,0)
 G:'$D(^RADPT(RADFNZ,"DT",RADTIZ,"P",RACNIZ,0)) XSEC1 G:'$D(^(RASECOND,0)) XSEC1
"RTN","RAUTL20",81,0)
 S RA2=0
"RTN","RAUTL20",82,0)
XSEC2 S RA2=$O(^RADPT(RADFNZ,"DT",RADTIZ,"P",RACNIZ,RASECOND,RA2)) G:'+RA2 XSEC1 S RA200=+$G(^(RA2,0))
"RTN","RAUTL20",83,0)
 G:'RA200 XSEC2
"RTN","RAUTL20",84,0)
 S:$D(RASET) ^RARPT(RAXREF,RA200,DA)=""
"RTN","RAUTL20",85,0)
 K:$D(RAKILL) ^RARPT(RAXREF,RA200,DA)
"RTN","RAUTL20",86,0)
 G XSEC2
"RTN","RAUTL20",87,0)
FLAGMEM() ;in distr list, print + if case is part of a print set
"RTN","RAUTL20",88,0)
 ; called from File #74's print templates
"RTN","RAUTL20",89,0)
 N RA1 S RA1=""
"RTN","RAUTL20",90,0)
 I '$D(D0) Q RA1
"RTN","RAUTL20",91,0)
 S RA1=$P($G(^RABTCH(74.4,D0,0)),U) I RA1="" Q RA1
"RTN","RAUTL20",92,0)
 S RA1=$O(^RARPT(RA1,1,"B",0)) S:RA1]"" RA1="+"
"RTN","RAUTL20",93,0)
 Q RA1
"RTN","RAUTL20",94,0)
DELPNT(RADFN,RADTI,RACNI) ; When an exam is cancelled & it is associated
"RTN","RAUTL20",95,0)
 ; with data in the Nuc Med Exam Data file (70.2) ask the user if this
"RTN","RAUTL20",96,0)
 ; pointer to 70.2 is to be deleted.  Also delete the flag which
"RTN","RAUTL20",97,0)
 ; indicates that the dosage ticket had printed for this exam.
"RTN","RAUTL20",98,0)
 ; Called from CANCEL^RAEDCN
"RTN","RAUTL20",99,0)
 ; Input: RADFN - Internal Entry Number (IEN) of the Patient.
"RTN","RAUTL20",100,0)
 ;        RADTI - Date/Time of the examination (inverse format)
"RTN","RAUTL20",101,0)
 ;        RACNI - IEN of the exam for this date/time
"RTN","RAUTL20",102,0)
 ;
"RTN","RAUTL20",103,0)
 ;- Delete entry in 'Dosage Ticket Printed?' field DD: 70.03, field: 29 -
"RTN","RAUTL20",104,0)
 N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",29)="@"
"RTN","RAUTL20",105,0)
 D FILE^DIE("","RAFDA")
"RTN","RAUTL20",106,0)
 ;----------------------------------------------------------------------
"RTN","RAUTL20",107,0)
 Q:'+$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",28)  ;no NucMed Xam data
"RTN","RAUTL20",108,0)
 K RAFDA N RAYN
"RTN","RAUTL20",109,0)
 F  D  Q:RAYN]""
"RTN","RAUTL20",110,0)
 . R !!?3,"Do you wish to delete the radiopharmaceutical data associated",!?3,"with this exam? No//",RAYN:DTIME
"RTN","RAUTL20",111,0)
 . I RAYN["^"!('$T) S RAYN="^" Q  ;don't delete pntr if '^' or timeout
"RTN","RAUTL20",112,0)
 . S RAYN=$E(RAYN) S:RAYN="" RAYN="N"
"RTN","RAUTL20",113,0)
 . S RAYN=$$UP^XLFSTR(RAYN) Q:RAYN="N"  ;exit, don't del 70.2 pnt
"RTN","RAUTL20",114,0)
 . I RAYN="Y" D  Q  ; delete the pointer to 70.2, then quit
"RTN","RAUTL20",115,0)
 .. N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",500)="@"
"RTN","RAUTL20",116,0)
 .. D FILE^DIE("","RAFDA")
"RTN","RAUTL20",117,0)
 .. ; NOTE: This silent FileMan call not only deletes the pointer to
"RTN","RAUTL20",118,0)
 .. ;       the entry in the Nuc Med Exam Data file (70.2), but the
"RTN","RAUTL20",119,0)
 .. ;       entry in 70.2 itself. This is because a M X-Ref exists on
"RTN","RAUTL20",120,0)
 .. ;       the field which points to file 70.2 that also deletes the
"RTN","RAUTL20",121,0)
 .. ;       entry in the Nuc Med Exam Data file.  Please refer to
"RTN","RAUTL20",122,0)
 .. ;       ^DD(70.03,500,.. for more information.
"RTN","RAUTL20",123,0)
 .. Q
"RTN","RAUTL20",124,0)
 . W !!?3,"Enter 'Yes' to delete the radiopharmaceutical data associated with this exam.",!?3,"Enter 'No' to preserve the radiopharmaceutical data associated with this",!?3,"exam.  "
"RTN","RAUTL20",125,0)
 . W "Enter '^' to exit without deleting the radiopharmaceutical data",!?3,"associated with this exam.",$C(7)
"RTN","RAUTL20",126,0)
 . S RAYN=""
"RTN","RAUTL20",127,0)
 . Q
"RTN","RAUTL20",128,0)
 Q
"VER")
8.0^22
"^DD",71,71,.01,0)
NAME^RsFX^^0;1^K:X[""""!($A(X)=45) X S:$D(X) X=$$UP^XLFSTR(X) K:$L(X)>60!($L(X)<3) X I $D(X) K:'+$$UNI30^RAUTL14(+$G(DA),X) X
"^DD",71,71,.01,.1)
NAME OF THE RAD/NUC MED PROCEDURE
"^DD",71,71,.01,1,0)
^.1
"^DD",71,71,.01,1,1,0)
71^B
"^DD",71,71,.01,1,1,1)
S ^RAMIS(71,"B",$E(X,1,60),DA)=""
"^DD",71,71,.01,1,1,2)
K ^RAMIS(71,"B",$E(X,1,60),DA)
"^DD",71,71,.01,1,1,3)
PLEASE DON'T DELETE
"^DD",71,71,.01,1,1,"%D",0)
^^1^1^2950111^
"^DD",71,71,.01,1,1,"%D",1,0)
Regular B cross-reference used for look-up.
"^DD",71,71,.01,1,2,0)
71^C^MUMPS
"^DD",71,71,.01,1,2,1)
S ^RAMIS(71,"C",$$LOW^XLFSTR($E(X,1,60)),DA)=""
"^DD",71,71,.01,1,2,2)
K ^RAMIS(71,"C",$$LOW^XLFSTR($E(X,1,60)),DA)
"^DD",71,71,.01,1,2,3)
Please don't delete lowercase x-ref
"^DD",71,71,.01,1,2,"%D",0)
^^3^3^2940801^
"^DD",71,71,.01,1,2,"%D",1,0)
This x-ref makes it possible to enter procedure names in lowercase on a
"^DD",71,71,.01,1,2,"%D",2,0)
look-up without invoking the CPT file look-up before the Rad/NM Procedure
"^DD",71,71,.01,1,2,"%D",3,0)
file look-up.
"^DD",71,71,.01,1,2,"DT")
2940801
"^DD",71,71,.01,3)
Enter the name of the procedure.  Procedure names may be 1 to 60 characters in length, with the first 30 characters being unique.  Also, ";" and "^" are not allowed as characters.
"^DD",71,71,.01,10)
RAD/NUC MED COORDINATOR
"^DD",71,71,.01,21,0)
^^3^3^3020227^
"^DD",71,71,.01,21,1,0)
This field contains the name (3-60 characters) of this rad/nuc med
"^DD",71,71,.01,21,2,0)
procedure.  The first thirty characters of the procedure name must be
"^DD",71,71,.01,21,3,0)
unique.  Also, ";" and "^" are not allowed as characters.
"^DD",71,71,.01,"DEL",1,0)
I 1 D EN^DDIOL("Procedures cannot be deleted. Instead, inactivate the procedure",,"!,$C(7)")
"^DD",71,71,.01,"DT")
2940831
"^DD",78.3,78.3,.01,0)
DIAGNOSTIC CODE^RF^^0;1^K:$L(X)>60!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",78.3,78.3,.01,.1)
NAME OF THE DIAGNOSTIC CODE
"^DD",78.3,78.3,.01,1,0)
^.1
"^DD",78.3,78.3,.01,1,1,0)
78.3^B
"^DD",78.3,78.3,.01,1,1,1)
S ^RA(78.3,"B",$E(X,1,30),DA)=""
"^DD",78.3,78.3,.01,1,1,2)
K ^RA(78.3,"B",$E(X,1,30),DA)
"^DD",78.3,78.3,.01,1,1,"%D",0)
^^1^1^2940518^
"^DD",78.3,78.3,.01,1,1,"%D",1,0)
     Regular 'B' cross reference assigned by FileMan.
"^DD",78.3,78.3,.01,3)
Enter a short diagnostic code, between 3 and 60 characters in length, to indicate the results of the image analysis.
"^DD",78.3,78.3,.01,10)
RAD/NUC MED COORDINATOR
"^DD",78.3,78.3,.01,21,0)
^^9^9^3020918^
"^DD",78.3,78.3,.01,21,1,0)
This field contains a short diagnostic code to indicate the results of
"^DD",78.3,78.3,.01,21,2,0)
the interpreting physician's analysis of the images.  Diagnostic codes
"^DD",78.3,78.3,.01,21,3,0)
can be between 3 and 60 characters in length and can be used as a basis
"^DD",78.3,78.3,.01,21,4,0)
for database searches.  (ie. How many 'Normal' chest exams were performed
"^DD",78.3,78.3,.01,21,5,0)
during a specific time period?)
"^DD",78.3,78.3,.01,21,6,0)
 
"^DD",78.3,78.3,.01,21,7,0)
Eight diagnostic codes are included with the original package.  Other
"^DD",78.3,78.3,.01,21,8,0)
site-specific diagnostic codes may be entered by the rad/nuc med
"^DD",78.3,78.3,.01,21,9,0)
coordinator at each site.
"^DD",78.3,78.3,.01,"DEL",1,0)
I 1 D EN^DDIOL("Diagnostic Codes cannot be deleted. Inactivate to remove.",,"!,$C(7)")
"^DD",78.3,78.3,.01,"DT")
3020918
"^DD",79.2,79.2,.11,0)
ACTIVITY LOG CUT-OFF^NJ5,0^^.1;1^K:+X'=X!(X>99999)!(X<90)!(X?.E1"."1N.N) X
"^DD",79.2,79.2,.11,.1)
ACTIVITY LOG CUT-OFF DATE
"^DD",79.2,79.2,.11,3)
Enter a number between 90 and 99999, to indicate the number of days to keep the various activity logs on-line.
"^DD",79.2,79.2,.11,10)
RAD/NUC MED COORDINATOR
"^DD",79.2,79.2,.11,21,0)
^.001^5^5^3020128^^^
"^DD",79.2,79.2,.11,21,1,0)
This field contains the imaging type parameter that tells the purge
"^DD",79.2,79.2,.11,21,2,0)
routine of the module how many days to keep the various activity logs
"^DD",79.2,79.2,.11,21,3,0)
on-line.  The amount of days is a whole number between 90 and 99999 and is
"^DD",79.2,79.2,.11,21,4,0)
determined at each site by the package coordinator and the computer
"^DD",79.2,79.2,.11,21,5,0)
site manager.
"^DD",79.2,79.2,.11,"DT")
3020128
"^DD",79.2,79.2,.12,0)
REPORT CUT-OFF^NJ5,0^^.1;2^K:+X'=X!(X>99999)!(X<90)!(X?.E1"."1N.N) X
"^DD",79.2,79.2,.12,.1)
REPORT CUT-OFF DATE
"^DD",79.2,79.2,.12,3)
Enter a number between 90 and 99999, to indicate the number of days to keep the reports on-line.
"^DD",79.2,79.2,.12,10)
RAD/NUC MED COORDINATOR
"^DD",79.2,79.2,.12,21,0)
^.001^6^6^3020128^^
"^DD",79.2,79.2,.12,21,1,0)
This field contains the imaging type parameter that tells the purge
"^DD",79.2,79.2,.12,21,2,0)
routine of the module how many days to keep the reports on-line.  The
"^DD",79.2,79.2,.12,21,3,0)
report 'impression' will always stay on-line even after the reports
"^DD",79.2,79.2,.12,21,4,0)
are purged.  The amount of days is a whole number between 90 and 99999
"^DD",79.2,79.2,.12,21,5,0)
and is determined at each site by the package coordinator and the
"^DD",79.2,79.2,.12,21,6,0)
computer site manager.
"^DD",79.2,79.2,.12,"DT")
3020128
"^DD",79.2,79.2,.13,0)
CLINICAL HISTORY CUT-OFF^NJ5,0^^.1;3^K:+X'=X!(X>99999)!(X<90)!(X?.E1"."1N.N) X
"^DD",79.2,79.2,.13,.1)
CLINICAL HISTORY CUT-OFF DATE
"^DD",79.2,79.2,.13,3)
Enter a number between 90 and 99999, to indicate the number of days to keep the clinical history of the visit and exam on-line.
"^DD",79.2,79.2,.13,10)
RAD/NUC MED COORDINATOR
"^DD",79.2,79.2,.13,21,0)
^.001^5^5^3020128^^
"^DD",79.2,79.2,.13,21,1,0)
This field contains the imaging type parameter that tells the purge
"^DD",79.2,79.2,.13,21,2,0)
routine of the module how many days to keep the clinical history
"^DD",79.2,79.2,.13,21,3,0)
of the visit on-line.  The amount of days is a whole number between 90 and
"^DD",79.2,79.2,.13,21,4,0)
99999 and is determined by the package coordinator and the computer
"^DD",79.2,79.2,.13,21,5,0)
site manager.
"^DD",79.2,79.2,.13,"DT")
3020128
"^DD",79.2,79.2,.14,0)
TRACKING TIME CUT-OFF^NJ5,0^^.1;4^K:+X'=X!(X>99999)!(X<90)!(X?.E1"."1N.N) X
"^DD",79.2,79.2,.14,.1)
TRACKING TIME CUT-OFF DATE
"^DD",79.2,79.2,.14,3)
Enter a number between 90 and 99999, to indicate the number of days to keep the 'tracking time' information on-line.
"^DD",79.2,79.2,.14,10)
RAD/NUC MED COORDINATOR
"^DD",79.2,79.2,.14,21,0)
^.001^7^7^3020128^^
"^DD",79.2,79.2,.14,21,1,0)
This field applies to sites that are using the tracking function of the
"^DD",79.2,79.2,.14,21,2,0)
system to record when the exam status changes from one status to another.
"^DD",79.2,79.2,.14,21,3,0)
It contains the imaging type parameter that tells the purge routine of
"^DD",79.2,79.2,.14,21,4,0)
the module how many days to keep the 'tracking time' information on-line.
"^DD",79.2,79.2,.14,21,5,0)
The amount of days is a whole number between 90 and 99999 and is
"^DD",79.2,79.2,.14,21,6,0)
determined at each site by the package coordinator and the computer
"^DD",79.2,79.2,.14,21,7,0)
site manager.
"^DD",79.2,79.2,.14,"DT")
3020128
"^DD",79.2,79.2,.16,0)
ORDER DATA CUT-OFF^NJ5,0^^.1;6^K:+X'=X!(X>99999)!(X<30)!(X?.E1"."1N.N) X
"^DD",79.2,79.2,.16,3)
Enter a number between 30 and 99999, to indicate the number of days to keep the order data on-line.
"^DD",79.2,79.2,.16,21,0)
^.001^4^4^3020128^^
"^DD",79.2,79.2,.16,21,1,0)
This field contains the imaging type parameter that tells the purge
"^DD",79.2,79.2,.16,21,2,0)
routine of the module how many days to keep the orders on-line. The
"^DD",79.2,79.2,.16,21,3,0)
amount of days is a whole number between 30 and 99999 and is determined
"^DD",79.2,79.2,.16,21,4,0)
by the package coordinator and the computer site manager.
"^DD",79.2,79.2,.16,"DT")
3020128
**END**
**END**
