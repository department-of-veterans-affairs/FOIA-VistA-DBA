Released HBH*1*10 SEQ #10
Extracted from mail message
**KIDS**:HBH*1.0*10^

**INSTALL NAME**
HBH*1.0*10
"BLD",1078,0)
HBH*1.0*10^HOSPITAL BASED HOME CARE^0^^y
"BLD",1078,1,0)
^^2^2^2980410^^^^
"BLD",1078,1,1,0)
This is the beta version of patch 10 of the HBHC v1.0 software, with patches
"BLD",1078,1,2,0)
1-9 installed. 
"BLD",1078,4,0)
^9.64PA^631.9^1
"BLD",1078,4,631.9,0)
631.9
"BLD",1078,4,631.9,2,0)
^9.641^631.9^1
"BLD",1078,4,631.9,2,631.9,0)
HBHC SYSTEM PARAMETERS  (File-top level)
"BLD",1078,4,631.9,2,631.9,1,0)
^9.6411^7^1
"BLD",1078,4,631.9,2,631.9,1,7,0)
FILE UPDATE IN PROGRESS FLAG
"BLD",1078,4,631.9,222)
y^y^p^^n^^n^m^n
"BLD",1078,4,"APDD",631.9,631.9)

"BLD",1078,4,"APDD",631.9,631.9,7)

"BLD",1078,4,"B",631.9,631.9)

"BLD",1078,"ABPKG")
n
"BLD",1078,"KRN",0)
^9.67PA^19^18
"BLD",1078,"KRN",.4,0)
.4
"BLD",1078,"KRN",.4,"NM",0)
^9.68A^^
"BLD",1078,"KRN",.401,0)
.401
"BLD",1078,"KRN",.401,"NM",0)
^9.68A^^
"BLD",1078,"KRN",.402,0)
.402
"BLD",1078,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",1078,"KRN",.403,0)
.403
"BLD",1078,"KRN",.5,0)
.5
"BLD",1078,"KRN",.84,0)
.84
"BLD",1078,"KRN",3.6,0)
3.6
"BLD",1078,"KRN",3.8,0)
3.8
"BLD",1078,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",1078,"KRN",9.2,0)
9.2
"BLD",1078,"KRN",9.8,0)
9.8
"BLD",1078,"KRN",9.8,"NM",0)
^9.68A^49^14
"BLD",1078,"KRN",9.8,"NM",2,0)
HBHCAPPT^^0^B24352271
"BLD",1078,"KRN",9.8,"NM",3,0)
HBHCCAN^^0^B4726600
"BLD",1078,"KRN",9.8,"NM",6,0)
HBHCFILE^^0^B29942284
"BLD",1078,"KRN",9.8,"NM",32,0)
HBHCXMT^^0^B16591405
"BLD",1078,"KRN",9.8,"NM",33,0)
HBHCAPP1^^0^B6094726
"BLD",1078,"KRN",9.8,"NM",35,0)
HBHCRP1A^^0^B15356957
"BLD",1078,"KRN",9.8,"NM",36,0)
HBHCRP1B^^0^B15795402
"BLD",1078,"KRN",9.8,"NM",38,0)
HBHCR15B^^0^B25293687
"BLD",1078,"KRN",9.8,"NM",40,0)
HBHCRP20^^0^B11468644
"BLD",1078,"KRN",9.8,"NM",45,0)
HBHCRP13^^0^B8404304
"BLD",1078,"KRN",9.8,"NM",46,0)
HBHCEN10^^0^B993634
"BLD",1078,"KRN",9.8,"NM",47,0)
HBHCUTL3^^0^B13783691
"BLD",1078,"KRN",9.8,"NM",48,0)
HBHCXMD^^0^B22250778
"BLD",1078,"KRN",9.8,"NM",49,0)
HBHCUPD^^0^B13101640
"BLD",1078,"KRN",9.8,"NM","B","HBHCAPP1",33)

"BLD",1078,"KRN",9.8,"NM","B","HBHCAPPT",2)

"BLD",1078,"KRN",9.8,"NM","B","HBHCCAN",3)

"BLD",1078,"KRN",9.8,"NM","B","HBHCEN10",46)

"BLD",1078,"KRN",9.8,"NM","B","HBHCFILE",6)

"BLD",1078,"KRN",9.8,"NM","B","HBHCR15B",38)

"BLD",1078,"KRN",9.8,"NM","B","HBHCRP13",45)

"BLD",1078,"KRN",9.8,"NM","B","HBHCRP1A",35)

"BLD",1078,"KRN",9.8,"NM","B","HBHCRP1B",36)

"BLD",1078,"KRN",9.8,"NM","B","HBHCRP20",40)

"BLD",1078,"KRN",9.8,"NM","B","HBHCUPD",49)

"BLD",1078,"KRN",9.8,"NM","B","HBHCUTL3",47)

"BLD",1078,"KRN",9.8,"NM","B","HBHCXMD",48)

"BLD",1078,"KRN",9.8,"NM","B","HBHCXMT",32)

"BLD",1078,"KRN",19,0)
19
"BLD",1078,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1078,"KRN",19,"NM",1,0)
HBHC AUTO-QUEUED FILE UPDATE^^0
"BLD",1078,"KRN",19,"NM","B","HBHC AUTO-QUEUED FILE UPDATE",1)

"BLD",1078,"KRN",19.1,0)
19.1
"BLD",1078,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",1078,"KRN",101,0)
101
"BLD",1078,"KRN",409.61,0)
409.61
"BLD",1078,"KRN",771,0)
771
"BLD",1078,"KRN",869.2,0)
869.2
"BLD",1078,"KRN",870,0)
870
"BLD",1078,"KRN",8994,0)
8994
"BLD",1078,"KRN","B",.4,.4)

"BLD",1078,"KRN","B",.401,.401)

"BLD",1078,"KRN","B",.402,.402)

"BLD",1078,"KRN","B",.403,.403)

"BLD",1078,"KRN","B",.5,.5)

"BLD",1078,"KRN","B",.84,.84)

"BLD",1078,"KRN","B",3.6,3.6)

"BLD",1078,"KRN","B",3.8,3.8)

"BLD",1078,"KRN","B",9.2,9.2)

"BLD",1078,"KRN","B",9.8,9.8)

"BLD",1078,"KRN","B",19,19)

"BLD",1078,"KRN","B",19.1,19.1)

"BLD",1078,"KRN","B",101,101)

"BLD",1078,"KRN","B",409.61,409.61)

"BLD",1078,"KRN","B",771,771)

"BLD",1078,"KRN","B",869.2,869.2)

"BLD",1078,"KRN","B",870,870)

"BLD",1078,"KRN","B",8994,8994)

"BLD",1078,"PRE")
HBHCEN10
"BLD",1078,"QUES",0)
^9.62^^
"BLD",1078,"REQB",0)
^9.611^^
"FIA",631.9)
HBHC SYSTEM PARAMETERS
"FIA",631.9,0)
^HBHC(631.9,
"FIA",631.9,0,0)
631.9
"FIA",631.9,0,1)
y^y^p^^n^^n^m^n
"FIA",631.9,0,10)

"FIA",631.9,0,11)

"FIA",631.9,0,"RLRO")

"FIA",631.9,0,"VR")
1.0^HBH
"FIA",631.9,631.9)
1
"FIA",631.9,631.9,7)

"KRN",19,13494,-1)
0^1
"KRN",19,13494,0)
HBHC AUTO-QUEUED FILE UPDATE^Auto-queue HBHC File Update^^R^^^^^^^^HOSPITAL BASED HOME CARE
"KRN",19,13494,1,0)
^^10^10^2980323^^^^
"KRN",19,13494,1,1,0)
This option runs a daily auto-queued batch job to create ^HBHC(632) (visit)
"KRN",19,13494,1,2,0)
nodes from outpatient encounter information => patient, appointment date/time,
"KRN",19,13494,1,3,0)
hospital location (clinic), provider, diagnosis code(s), & CPT code(s).
"KRN",19,13494,1,4,0)

"KRN",19,13494,1,5,0)
This job also cancels ^HBHC(632 records if outpatient encounter referenced no
"KRN",19,13494,1,6,0)
longer exists & deletes corresponding record from ^HBHC(634 (transmit) file if
"KRN",19,13494,1,7,0)
transmit status is 'filed'. 
"KRN",19,13494,1,8,0)

"KRN",19,13494,1,9,0)
Members in mail group HBH receive a mail message if the batch job locates any
"KRN",19,13494,1,10,0)
errors. 
"KRN",19,13494,25)
HBHCAPPT
"KRN",19,13494,200.9)
y
"KRN",19,13494,"U")
AUTO-QUEUE HBHC FILE UPDATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",216,-1)
1^1
"PKG",216,0)
HOSPITAL BASED HOME CARE^HBH^Hospital Based Home Care
"PKG",216,22,0)
^9.49I^1^1
"PKG",216,22,1,0)
1.0^2931101^2940314
"PKG",216,22,1,"PAH",1,0)
10^2980423^3779
"PKG",216,22,1,"PAH",1,1,0)
^^2^2^2980423
"PKG",216,22,1,"PAH",1,1,1,0)
This is the beta version of patch 10 of the HBHC v1.0 software, with patches
"PKG",216,22,1,"PAH",1,1,2,0)
1-9 installed. 
"PRE")
HBHCEN10
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","HBHCAPP1")
0^33^B6094726
"RTN","HBHCAPP1",1,0)
HBHCAPP1 ; LR VAMC(IRMS)/MJT-HBHC called by HBHCAPPT, entry points:  START, ERROR, MAIL, EXIT ;9803
"RTN","HBHCAPP1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10**;NOV 01, 1993
"RTN","HBHCAPP1",3,0)
START ; Initialization
"RTN","HBHCAPP1",4,0)
 ; Set File Update in Progress Flag
"RTN","HBHCAPP1",5,0)
 S $P(^HBHC(631.9,1,0),U,8)=1
"RTN","HBHCAPP1",6,0)
 ; HBHC(634.2 killed to allow file update processing to run daily, any errors found in previous batch that haven't been corrected will be found again
"RTN","HBHCAPP1",7,0)
 K ^HBHC(634.2) S ^HBHC(634.2,0)="HBHC VISIT ERROR(S)^634.2P^"
"RTN","HBHCAPP1",8,0)
 ; Omit visits prior to 10/1/97, FY 1997 data did not include inpatient appointments, FY 1998 will, auto-queued job will only gather data for 7 days since HBHCFLAG is set in HBHCFILE
"RTN","HBHCAPP1",9,0)
 K %DT S X="T"-($S($D(HBHCFLAG):($P(^HBHC(631.9,1,0),U,4)),1:7)) D ^%DT S HBHCBGDT=$S(Y<2970930.9999:2970930.9999,1:Y_.9999)
"RTN","HBHCAPP1",10,0)
 D NOW^%DTC S (HBHCNOW,Y)=% X ^DD("DD") S HBHCDAT=Y
"RTN","HBHCAPP1",11,0)
 ; Omit future dates from file update
"RTN","HBHCAPP1",12,0)
 I $D(HBHCLSDT) S:HBHCLSDT>% HBHCLSDT=%
"RTN","HBHCAPP1",13,0)
 ; Auto-queued option will not have HBHCLSDT defined
"RTN","HBHCAPP1",14,0)
 I '$D(HBHCLSDT) S HBHCLSDT=%
"RTN","HBHCAPP1",15,0)
 S HBHCDTE=HBHCBGDT_U_HBHCLSDT
"RTN","HBHCAPP1",16,0)
 ; Cancel appointments in ^HBHC(632), & delete 'filed' records from ^HBHC(634) if outpatient encounter (^SCE(409.68)) entry no longer exists
"RTN","HBHCAPP1",17,0)
 D ^HBHCCAN
"RTN","HBHCAPP1",18,0)
 Q
"RTN","HBHCAPP1",19,0)
ERROR ; Update HBHC Error(s) (634.2) file Error Message (3) & Outpatient Encounter (4) fields
"RTN","HBHCAPP1",20,0)
 K DD,DO,DTOUT,DUOUT
"RTN","HBHCAPP1",21,0)
 S DIC="^HBHC(634.2,",DIC(0)="L",X=HBHCDPT,DIC("DR")="3///^S X=HBHCMSG;4///^S X=HBHCOEP;5///^S X=HBHCAPDT;6///^S X=HBHCCLN" D FILE^DICN
"RTN","HBHCAPP1",22,0)
 K HBHCMSG
"RTN","HBHCAPP1",23,0)
 Q
"RTN","HBHCAPP1",24,0)
MAIL ; Send mail message
"RTN","HBHCAPP1",25,0)
 S TMP(1)="Please run Form Errors Report option for HBHC errors to correct.",XMDUZ="HBHC File Update Mail Group",XMSUB=$P(HBHCDAT,"@")_" HBHC File Update",XMY("INFO:G.HBH")="",XMTEXT="TMP("
"RTN","HBHCAPP1",26,0)
 D ^XMD
"RTN","HBHCAPP1",27,0)
 Q
"RTN","HBHCAPP1",28,0)
EXIT ; Exit module
"RTN","HBHCAPP1",29,0)
 D CLEAN^DILF
"RTN","HBHCAPP1",30,0)
 ; HBHCFLAG set in ^HBHCFILE, to accommodate retaining these variables if not auto-queued job
"RTN","HBHCAPP1",31,0)
 K:'$D(HBHCFLAG) HBHCDAT,HBHCDTE,HBHCNOW
"RTN","HBHCAPP1",32,0)
 K DA,DD,DO,DIC,DIK,DTOUT,DUOUT,HBHC,HBHCAPDT,HBHCBGDT,HBHCBXRF,HBHCCLN,HBHCCNT,HBHCCPT,HBHCCPTL,HBHCDFN,HBHCDPT,HBHCDX,HBHCDXL,HBHCFLG,HBHCI,HBHCINFO,HBHCJ,HBHCMSG,HBHCNBR,HBHCOEP,HBHCONE,HBHCPCNT,HBHCPRV,HBHCPRV1,HBHCPRVL
"RTN","HBHCAPP1",33,0)
 K HBHCSCE0,HBHCTOT,HBHCTXT,TMP,X,Y,%DT,%
"RTN","HBHCAPP1",34,0)
 Q
"RTN","HBHCAPPT")
0^2^B24352271
"RTN","HBHCAPPT",1,0)
HBHCAPPT ; LR VAMC(IRMS)/MJT-HBHC batch job to create ^HBHC(632) (visit) nodes from PCE module info => patient, appointment date/time, hospital location (clinic), provider, diagnosis code(s), & CPT code(s), calls ^HBHCCAN ;9803
"RTN","HBHCAPPT",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10**;NOV 01, 1993
"RTN","HBHCAPPT",3,0)
 ; Daily auto-queued option, also called from ^HBHCFILE, HBHCLSDT, last date to include in transmit set up in ^HBHCFILE
"RTN","HBHCAPPT",4,0)
 D START^HBHCAPP1
"RTN","HBHCAPPT",5,0)
SCAN ; Scan
"RTN","HBHCAPPT",6,0)
 N HBHCQRY
"RTN","HBHCAPPT",7,0)
 D OPEN^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",8,0)
 D INDEX^SDQ(.HBHCQRY,"DATE/TIME","SET")
"RTN","HBHCAPPT",9,0)
 D DATE^SDQ(.HBHCQRY,HBHCBGDT,HBHCLSDT,"SET")
"RTN","HBHCAPPT",10,0)
 D SCANCB^SDQ(.HBHCQRY,"D CB^HBHCAPPT(Y,Y0,.SDSTOP)","SET")
"RTN","HBHCAPPT",11,0)
 D ACTIVE^SDQ(.HBHCQRY,"TRUE","SET")
"RTN","HBHCAPPT",12,0)
 D SCAN^SDQ(.HBHCQRY,"FORWARD")
"RTN","HBHCAPPT",13,0)
 D CLOSE^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",14,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B"))) D MAIL^HBHCAPP1
"RTN","HBHCAPPT",15,0)
 ; Delete File Update in Progress Flag
"RTN","HBHCAPPT",16,0)
 S $P(^HBHC(631.9,1,0),U,8)=""
"RTN","HBHCAPPT",17,0)
EXIT ; Exit module
"RTN","HBHCAPPT",18,0)
 D EXIT^HBHCAPP1
"RTN","HBHCAPPT",19,0)
 Q
"RTN","HBHCAPPT",20,0)
CB(HBHCOEP,HBHCSCE0,HBHCSTOP) ;
"RTN","HBHCAPPT",21,0)
 ; Omit Child encounter, (child if Parent Encounter field contains data)
"RTN","HBHCAPPT",22,0)
 Q:$P(HBHCSCE0,U,6)]""
"RTN","HBHCAPPT",23,0)
 ; Clinic missing
"RTN","HBHCAPPT",24,0)
 Q:$P(HBHCSCE0,U,4)=""
"RTN","HBHCAPPT",25,0)
 ; Include only HBHC clinics
"RTN","HBHCAPPT",26,0)
 Q:'$D(^HBHC(631.6,"B",$P(HBHCSCE0,U,4)))
"RTN","HBHCAPPT",27,0)
 S HBHCCLN=$P(HBHCSCE0,U,4)
"RTN","HBHCAPPT",28,0)
 D VERIFY I 'HBHCFLG D PROCESS D:$D(HBHCMSG) ERROR^HBHCAPP1
"RTN","HBHCAPPT",29,0)
 Q
"RTN","HBHCAPPT",30,0)
VERIFY ; Verify node doesn't already exist in ^HBHC(632) file
"RTN","HBHCAPPT",31,0)
 S HBHCFLG=0,HBHCDPT=$P(HBHCSCE0,U,2),HBHCAPDT=$P(HBHCSCE0,U)
"RTN","HBHCAPPT",32,0)
 I HBHCDPT="" S HBHCFLG=1 Q
"RTN","HBHCAPPT",33,0)
 S HBHCBXRF=0 F  S HBHCBXRF=$O(^HBHC(632,"B",HBHCDPT,HBHCBXRF)) Q:(HBHCBXRF'>0)!(HBHCFLG)  S:(HBHCAPDT=$P(^HBHC(632,HBHCBXRF,0),U,2))&('$D(^HBHC(632,"AC","C",HBHCBXRF))) HBHCFLG=1
"RTN","HBHCAPPT",34,0)
 Q
"RTN","HBHCAPPT",35,0)
PROCESS ; Process provider, diagnosis (Dx) (limit: 5), & CPT code (limit: 10) data
"RTN","HBHCAPPT",36,0)
 ; Dx
"RTN","HBHCAPPT",37,0)
 K HBHCDXL
"RTN","HBHCAPPT",38,0)
 F HBHCI=1:1:5 S HBHCDX(HBHCI)="",HBHCCNT=1
"RTN","HBHCAPPT",39,0)
 D GETDX^SDOE(HBHCOEP,"HBHCDXL")
"RTN","HBHCAPPT",40,0)
 S HBHCDFN=0 F  S HBHCDFN=$O(HBHCDXL(HBHCDFN)) Q:(HBHCDFN'>0)!(HBHCCNT>5)  S:$P(HBHCDXL(HBHCDFN),U,12)="P" HBHCDX(1)=$P(HBHCDXL(HBHCDFN),U) S:$P(HBHCDXL(HBHCDFN),U,12)="S" HBHCCNT=HBHCCNT+1,HBHCDX(HBHCCNT)=$P(HBHCDXL(HBHCDFN),U)
"RTN","HBHCAPPT",41,0)
 ; Dx missing
"RTN","HBHCAPPT",42,0)
 I (+$G(HBHCDXL)'>0) S HBHCMSG=3 Q
"RTN","HBHCAPPT",43,0)
 ; Dx > 5
"RTN","HBHCAPPT",44,0)
 I (+$G(HBHCDXL)>5) S HBHCMSG=6 Q
"RTN","HBHCAPPT",45,0)
 ; provider, use Encounter Provider (field 1204, file 9000010.18) or V Provider (9000010.06) (if encounter provider doesn't exist), each provider within encounter will become a separate HBHC Visit record
"RTN","HBHCAPPT",46,0)
 K HBHCPRV1,HBHCPRVL
"RTN","HBHCAPPT",47,0)
 D GETPRV^SDOE(HBHCOEP,"HBHCPRVL")
"RTN","HBHCAPPT",48,0)
 S (HBHCPCNT,HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCPRVL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCPRV=$P(HBHCPRVL(HBHCDFN),U) D CHECK S:HBHCONE=1 HBHCPCNT=HBHCPCNT+1,HBHCPRV1(HBHCPRV)=""
"RTN","HBHCAPPT",49,0)
 ; Provider missing
"RTN","HBHCAPPT",50,0)
 I (+$G(HBHCPRVL)'>0) S HBHCMSG=2 Q
"RTN","HBHCAPPT",51,0)
 ; HBHC provider missing
"RTN","HBHCAPPT",52,0)
 I HBHCONE=0 S HBHCMSG=11 Q
"RTN","HBHCAPPT",53,0)
 ; Provider > 10
"RTN","HBHCAPPT",54,0)
 I (+$G(HBHCPRVL)>10) S HBHCMSG=10 Q
"RTN","HBHCAPPT",55,0)
 ; Multiple HBHC provider numbers
"RTN","HBHCAPPT",56,0)
 I HBHCONE>1 S HBHCMSG=12 Q
"RTN","HBHCAPPT",57,0)
 ; CPT Code 
"RTN","HBHCAPPT",58,0)
 K HBHCCPTL,HBHCPRV
"RTN","HBHCAPPT",59,0)
 D GETCPT^SDOE(HBHCOEP,"HBHCCPTL")
"RTN","HBHCAPPT",60,0)
 S (HBHCTOT,HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCCPTL(HBHCDFN)) Q:(HBHCDFN'>0)!(HBHCTOT>10)  S HBHCPRV=$P($G(^AUPNVCPT(HBHCDFN,12)),U,4) D:HBHCPRV]"" CHECK S HBHCNBR=$P(HBHCCPTL(HBHCDFN),U,16),HBHCTOT=HBHCTOT+HBHCNBR D:HBHCTOT<11 PROV
"RTN","HBHCAPPT",61,0)
 ; Provider ambiguous
"RTN","HBHCAPPT",62,0)
 I $D(HBHCPRV("ZZ")) S HBHCMSG=5 Q
"RTN","HBHCAPPT",63,0)
 ; CPT Code missing
"RTN","HBHCAPPT",64,0)
 I HBHCTOT=0 S HBHCMSG=4 Q
"RTN","HBHCAPPT",65,0)
 ; CPT Code > 10
"RTN","HBHCAPPT",66,0)
 I HBHCTOT>10 S HBHCMSG=7 Q
"RTN","HBHCAPPT",67,0)
 ; outpatient encounter must have 'checked-out' status (2) to ensure provider, Dx, & CPT data exist, or inpatient status (8)
"RTN","HBHCAPPT",68,0)
 I ($P(HBHCSCE0,U,12)'=2)&($P(HBHCSCE0,U,12)'=8) S HBHCMSG=1 Q
"RTN","HBHCAPPT",69,0)
SET ; Set node, call ^DIK to set cross-refs in ^HBHC(632) (visit) file
"RTN","HBHCAPPT",70,0)
 S HBHCPRV="" F  S HBHCPRV=$O(HBHCPRV(HBHCPRV)) Q:HBHCPRV=""  D SETLOOP
"RTN","HBHCAPPT",71,0)
 Q
"RTN","HBHCAPPT",72,0)
SETLOOP ; Set loop
"RTN","HBHCAPPT",73,0)
 S (HBHCINFO,HBHCCPT)="" F  S HBHCCPT=$O(HBHCPRV(HBHCPRV,HBHCCPT)) Q:HBHCCPT=""  S HBHCNBR="" F  S HBHCNBR=$O(HBHCPRV(HBHCPRV,HBHCCPT,HBHCNBR)) Q:HBHCNBR=""  S:HBHCINFO]"" HBHCINFO=HBHCINFO_U_HBHCCPT S:HBHCINFO="" HBHCINFO=HBHCCPT
"RTN","HBHCAPPT",74,0)
 S HBHC="",HBHC=$O(^HBHC(631.4,"C",HBHCPRV,HBHC))
"RTN","HBHCAPPT",75,0)
 L +^HBHC(632,0) S HBHCDFN=$P(^HBHC(632,0),U,3)+1,$P(^HBHC(632,0),U,3)=HBHCDFN,$P(^HBHC(632,0),U,4)=$P(^HBHC(632,0),U,4)+1 L -^HBHC(632,0)
"RTN","HBHCAPPT",76,0)
 L +^HBHC(632,HBHCDFN,1) S ^HBHC(632,HBHCDFN,1)=HBHCINFO L -^HBHC(632,HBHCDFN,1)
"RTN","HBHCAPPT",77,0)
 L +^HBHC(632,HBHCDFN,0) S ^HBHC(632,HBHCDFN,0)=HBHCDPT_U_HBHCAPDT_U_HBHCCLN_U_HBHC_U_U_U_U_"N"_U_U_U_U_U_U_U_U_U_HBHCDX(1)_U_HBHCDX(2)_U_HBHCDX(3)_U_HBHCDX(4)_U_HBHCDX(5)_U_HBHCOEP L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCAPPT",78,0)
 K DIK S DIK="^HBHC(632,",DA=HBHCDFN D IX1^DIK K DIK
"RTN","HBHCAPPT",79,0)
 Q
"RTN","HBHCAPPT",80,0)
PROV ; encounter provider & CPT code processing
"RTN","HBHCAPPT",81,0)
 S:HBHCPCNT=1 HBHCTXT="",HBHCTXT=$O(HBHCPRV1(HBHCTXT))
"RTN","HBHCAPPT",82,0)
 F HBHCJ=1:1:HBHCNBR S:HBHCPRV="" HBHCPRV($S(HBHCPCNT=1:HBHCTXT,1:"ZZ"),$P(HBHCCPTL(HBHCDFN),U),HBHCJ)="" I HBHCPRV]"" S:HBHCONE=1 HBHCPRV(HBHCPRV,$P(HBHCCPTL(HBHCDFN),U),HBHCJ)=""
"RTN","HBHCAPPT",83,0)
 Q
"RTN","HBHCAPPT",84,0)
CHECK ; Check to ensure provider only has 1 HBHC Provider Number (631.4) or if > 1, has others flagged as Inactive Provider Numbers
"RTN","HBHCAPPT",85,0)
 S (HBHCONE,HBHCIEN)=0 F  S HBHCIEN=$O(^HBHC(631.4,"C",HBHCPRV,HBHCIEN)) Q:(HBHCIEN'>0)!(HBHCONE>1)  S:'$D(^HBHC(631.4,"AC",1,HBHCIEN)) HBHCONE=HBHCONE+1
"RTN","HBHCAPPT",86,0)
 Q
"RTN","HBHCCAN")
0^3^B4726600
"RTN","HBHCCAN",1,0)
HBHCCAN ; LR VAMC(IRMS)/MJT-HBHC batch job to flag deleted outpatient encounters as cancelled appointments in ^HBHC(632) (visit) Form 4 Transmit Status, field 7, & Cancelled Appointment, field 6, called from ^HBHCAPPT ;9803
"RTN","HBHCCAN",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,10**;NOV 01, 1993
"RTN","HBHCCAN",3,0)
 ; Also deletes record from ^HBHC(634 (transmit) file IF Form 4 Transmit Status, field 7, = "F" (filed)
"RTN","HBHCCAN",4,0)
START ; Initialization
"RTN","HBHCCAN",5,0)
 S $P(HBHCSP1," ",2)="",$P(HBHCZRO4,"0",5)=""
"RTN","HBHCCAN",6,0)
 ; HBHCBGDT set in ^HBHCAPPT
"RTN","HBHCCAN",7,0)
 S HBHCAPDT=HBHCBGDT
"RTN","HBHCCAN",8,0)
LOOP ; Loop thru ^HBHC(632) to flag visit nodes with cancelled appointments
"RTN","HBHCCAN",9,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT'>0)!(HBHCAPDT>HBHCLSDT)  S HBHCDFN=0 F  S HBHCDFN=$O(^HBHC(632,"C",HBHCAPDT,HBHCDFN)) Q:HBHCDFN'>0  D PROCESS
"RTN","HBHCCAN",10,0)
EXIT ; Exit module
"RTN","HBHCCAN",11,0)
 K DA,DIE,DIK,DR,HBHCAPDT,HBHCDATE,HBHCDFN,HBHCIEN,HBHCINFO,HBHCNOD0,HBHCPRV,HBHCREC,HBHCSP1,HBHCTIME,HBHCZRO4,X,Y,%DT
"RTN","HBHCCAN",12,0)
 Q
"RTN","HBHCCAN",13,0)
PROCESS ; Process outpatient encounters in SCE(409.68
"RTN","HBHCCAN",14,0)
 S HBHCNOD0=^HBHC(632,HBHCDFN,0)
"RTN","HBHCCAN",15,0)
 ; Cancelled appointment
"RTN","HBHCCAN",16,0)
 Q:($P(HBHCNOD0,U,7)]"")!($P(HBHCNOD0,U,8)="C")
"RTN","HBHCCAN",17,0)
 ; Set Cancelled Appointment (fld 6) & Form 4 Transmit Status (fld 7) to C (cancelled appointment) if outpatient encounter (OE) no longer exists, retaining obsolete data elements (e.g. OE, Dx, provider, CPT) for trouble-shooting purposes
"RTN","HBHCCAN",18,0)
 I $G(^SCE($P(HBHCNOD0,U,22),0))="" D:$P(HBHCNOD0,U,8)="F" DELETE S DIE="^HBHC(632,",DA=HBHCDFN,DR="6///C;7///C" D ^DIE
"RTN","HBHCCAN",19,0)
 Q
"RTN","HBHCCAN",20,0)
DELETE ; Delete ^HBHC(634 file record
"RTN","HBHCCAN",21,0)
 S HBHCTIME=$P(HBHCAPDT,".",2) S:$L(HBHCTIME)'=4 HBHCTIME=HBHCTIME_$E(HBHCZRO4,1,(4-($L(HBHCTIME))))
"RTN","HBHCCAN",22,0)
 S HBHCDATE=$E(HBHCAPDT,4,5)_$E(HBHCAPDT,6,7)_(1700+$E(HBHCAPDT,1,3))_HBHCTIME
"RTN","HBHCCAN",23,0)
 S HBHCPRV=+^HBHC(631.4,$P(HBHCNOD0,U,4),0) S:$L(HBHCPRV)'=4 HBHCPRV=HBHCPRV_HBHCSP1
"RTN","HBHCCAN",24,0)
 S HBHCINFO=$P(^DPT($P(HBHCNOD0,U),0),U,9)_HBHCDATE_HBHCPRV
"RTN","HBHCCAN",25,0)
 S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(634,HBHCIEN)) Q:HBHCIEN'>0  S HBHCREC=$E(^HBHC(634,HBHCIEN,0),9,33) I HBHCINFO=HBHCREC K DIK S DIK="^HBHC(634,",DA=HBHCIEN D ^DIK
"RTN","HBHCCAN",26,0)
 Q
"RTN","HBHCEN10")
0^46^B993634
"RTN","HBHCEN10",1,0)
HBHCEN10 ; LR VAMC(IRMS)/MJT-Enviroment Check for Patch HBH*1*10 ;9804
"RTN","HBHCEN10",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**10**;NOV 01, 1993
"RTN","HBHCEN10",3,0)
 I +$$PATCH^XPDUTL("SD*5.3*131")=0 D BMES^XPDUTL("Please install SD*5.3*131. Installation Halted.") S XPDABORT=2
"RTN","HBHCEN10",4,0)
 I +$$PATCH^XPDUTL("HBH*1.0*9")=0 D BMES^XPDUTL("Please install HBH*1.0*9. Installation Halted.") S XPDABORT=2
"RTN","HBHCEN10",5,0)
 Q
"RTN","HBHCFILE")
0^6^B29942284
"RTN","HBHCFILE",1,0)
HBHCFILE ; LR VAMC(IRMS)/MJT-HBHC populates ^HBHC(632) visit file, & ^HBHC(634), file for transmitting to Austin, calls ^HBHCAPPT, ^HBHCXMC, ^HBHCXMA, ^HBHCXMV, & ^HBHCXMD ;9804
"RTN","HBHCFILE",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,8,9,10**;NOV 01, 1993
"RTN","HBHCFILE",3,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !!,"***  NOTICE:  Hospital Number is missing from System Parameter file (#631.9).",!,"Transmission file building CANNOT proceed without this information.  Contact"
"RTN","HBHCFILE",4,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !,"IRM to enter this information using FileMan.",! H 10 Q
"RTN","HBHCFILE",5,0)
 L +^HBHC(634.5,0):0 I '$T W *7,!!,"Another user has the pseudo SSN file locked." H 3 G EXIT
"RTN","HBHCFILE",6,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B"))) W *7,!!,"Records containing errors exist and must be corrected before transmit",!,"file can be created or updated.",!! H 3 Q
"RTN","HBHCFILE",7,0)
EN ; Entry point
"RTN","HBHCFILE",8,0)
 I $P(^HBHC(631.9,1,0),U,8)]"" W *7,!,"File Update in progress.  Please try again later." H 3 Q
"RTN","HBHCFILE",9,0)
 W !!,"This option builds the file for transmission to Austin.  Do you wish to",!,"continue" S %=2 D YN^DICN
"RTN","HBHCFILE",10,0)
 I %=0 W !!,"A 'Yes' response will add records to the file.  A 'No' response will return",!,"to the menu without updating the file." G EN
"RTN","HBHCFILE",11,0)
 G:%'=1 EXIT
"RTN","HBHCFILE",12,0)
MONTH ; Calculate default month value & last date to be included for transmission
"RTN","HBHCFILE",13,0)
 S X="T" D ^%DT S X1=$P(Y,"."),X2=-28 D C^%DTC S DIR("B")=+$E(X,4,5)
"RTN","HBHCFILE",14,0)
 S DIR(0)="SX^1:January;2:February;3:March;4:April;5:May;6:June;7:July;8:August;9:September;10:October;11:November;12:December;"
"RTN","HBHCFILE",15,0)
 S DIR("A")="Month for which data is to be transmitted"
"RTN","HBHCFILE",16,0)
 S DIR("?")="Month entered controls the ending date for data transmitted to Austin.  (e.g.  An August 5 transmission with July selected as month, will include data thru July 31.)"
"RTN","HBHCFILE",17,0)
 D ^DIR Q:$D(DIRUT)  S HBHCDIR=Y
"RTN","HBHCFILE",18,0)
 S X="T" D ^%DT S HBHCYEAR=$S(HBHCDIR>(+$E(Y,4,5)):($E(Y,1,3))-1,1:$E(Y,1,3))
"RTN","HBHCFILE",19,0)
 S Y=1700+HBHCYEAR,HBHCLEAP=$S(Y#400=0:1,Y#4=0&'(Y#100=0):1,1:0)
"RTN","HBHCFILE",20,0)
 S HBHCLSDT=HBHCYEAR_$S(HBHCDIR<10:"0"_HBHCDIR,1:HBHCDIR)_$S("^4^6^9^11^"[HBHCDIR:30,((HBHCDIR=2)&('HBHCLEAP)):28,((HBHCDIR=2)&(HBHCLEAP)):29,1:31)_.9999
"RTN","HBHCFILE",21,0)
 S Y=$P(HBHCLSDT,".") D DD^%DT S HBHCCKDT=Y
"RTN","HBHCFILE",22,0)
NUMBER ; Edit Number of Visit Days to Scan system parameter
"RTN","HBHCFILE",23,0)
 W !
"RTN","HBHCFILE",24,0)
 K DIR S DIR(0)="631.9,3",DIR("A")="Number of Visit Days to Scan",DIR("B")=$P($G(^HBHC(631.9,1,0)),U,4)
"RTN","HBHCFILE",25,0)
 S DIR("?",1)="Enter number of days to be included when the system creates records in the",DIR("?",2)="HBHC Visit File from the appointment data entered via the Appointment",DIR("?")="Management  [HBHC APPOINTMENT]  option."
"RTN","HBHCFILE",26,0)
 D ^DIR
"RTN","HBHCFILE",27,0)
 G:($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","HBHCFILE",28,0)
 S HBHCDIR=Y
"RTN","HBHCFILE",29,0)
 I (HBHCDIR'=DIR("B"))&(HBHCDIR?1.3N) K DIE S HBHCDAYS=Y,DIE="^HBHC(631.9,",DA=1,DR="3///^S X=HBHCDAYS" D ^DIE
"RTN","HBHCFILE",30,0)
 ; Check to ensure Number of Visit Days to Scan date < HBHCLSDT
"RTN","HBHCFILE",31,0)
 K %DT S X="T"-($S(HBHCDIR'=DIR("B"):HBHCDIR,1:DIR("B"))) D ^%DT
"RTN","HBHCFILE",32,0)
 I (Y_".9999")'<HBHCLSDT D DD^%DT W *7,!!,"Date Range is invalid.  Transmit Month Ending Date of:  ",HBHCCKDT,"  must",!,"be closer to today than the Number of Days to Scan Date:  ",Y,".",! G NUMBER
"RTN","HBHCFILE",33,0)
CLEANUP ; Cleanup ^HBHC(634) if new transmit cycle => all records flagged as transmitted
"RTN","HBHCFILE",34,0)
 I ('$D(^HBHC(631,"AE","F")))&('$D(^HBHC(631,"AF","F")))&('$D(^HBHC(632,"AC","F"))) K ^HBHC(634) S ^HBHC(634,0)="HBHC TRANSMIT^634"
"RTN","HBHCFILE",35,0)
 ; Flag used to control killing HBHCDAT, HBHCDTE, & HBHCNOW in HBHCAPPT
"RTN","HBHCFILE",36,0)
 S HBHCFLAG=1
"RTN","HBHCFILE",37,0)
QUEUE ; Queue
"RTN","HBHCFILE",38,0)
 S ZTIO="",ZTDTH=$H,ZTRTN="PLOOP^HBHCFILE",ZTSAVE("HBHC*")="",ZTDESC="HBPC Build Transmit File" D ^%ZTLOAD
"RTN","HBHCFILE",39,0)
 W *7,!!,"Build Transmit File processing has been queued.  Task number:  ",ZTSK H 3
"RTN","HBHCFILE",40,0)
 G EXIT
"RTN","HBHCFILE",41,0)
PLOOP ; Loop thru ^HBHC(632,"C" Appointment Date cross-ref & flag as 'P' (Record Prior to Package Startup Date) in Form 4 Transmit Status field if date < Package Startup Date
"RTN","HBHCFILE",42,0)
 S X1=$P(^HBHC(631.9,1,0),U,3),X2=-1 D C^%DTC S HBHCSTDT=X_.9999
"RTN","HBHCFILE",43,0)
 S HBHCAPDT=0,DIE="^HBHC(632,",DR="7///P"
"RTN","HBHCFILE",44,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT'>0)!(HBHCAPDT>HBHCSTDT)  S DA="" F  S DA=$O(^HBHC(632,"C",HBHCAPDT,DA)) Q:DA'>0  D:'$D(^HBHC(632,"AC","P",DA)) ^DIE
"RTN","HBHCFILE",45,0)
POP ; Populate ^HBHC(634) or ^HBHC(634.1/634.2/634.3/634.5 Error files
"RTN","HBHCFILE",46,0)
 D ^HBHCAPPT,^HBHCXMC,^HBHCXMA,^HBHCXMV,^HBHCXMD
"RTN","HBHCFILE",47,0)
 ; Send mail message
"RTN","HBHCFILE",48,0)
 D:('$D(^HBHC(634.1,"B")))&('$D(^HBHC(634.2,"B")))&('$D(^HBHC(634.3,"B")))&('$D(^HBHC(634.5,"B"))) MAIL
"RTN","HBHCFILE",49,0)
EXIT ; Exit module
"RTN","HBHCFILE",50,0)
 L -^HBHC(634.5,0)
"RTN","HBHCFILE",51,0)
 K DA,DIE,DIR,DIRUT,DR,DTOUT,DUOUT,HBHCAPDT,HBHCCKDT,HBHCDAT,HBHCDAYS,HBHCDTE,HBHCDIR,HBHCFLAG,HBHCLEAP,HBHCLSDT,HBHCNOW,HBHCSTDT,HBHCYEAR,%,TMP,X,X1,X2,Y
"RTN","HBHCFILE",52,0)
 Q
"RTN","HBHCFILE",53,0)
MAIL ; Send completed mail message
"RTN","HBHCFILE",54,0)
 S TMP(1)=$P(HBHCDAT,"@")_" HBHC Build Transmit File is complete with no errors found.",TMP(2)="",TMP(3)="   Number of Visit Days to Scan system parameter:  "_$P(^HBHC(631.9,1,0),U,4),TMP(4)=""
"RTN","HBHCFILE",55,0)
 S Y=$P($P(HBHCDTE,U),"@") X ^DD("DD") S HBHCINFO=Y,Y=$P($P(HBHCDTE,U,2),"@") X ^DD("DD") S TMP(5)="   Date range:  "_$P(HBHCINFO,"@")_"  thru  "_$P(Y,"@"),TMP(6)=""
"RTN","HBHCFILE",56,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","HBHCFILE",57,0)
 S TMP(7)="   Start time:  "_$P(HBHCDAT,"@",2)_"   End time:  "_$P(Y,"@",2)_"   Elapsed minutes:  "_($E(%_"000",9,10)-$E(HBHCNOW_"000",9,10)*60+$E(%_"00000",11,12)-$E(HBHCNOW_"00000",11,12)),TMP(8)=""
"RTN","HBHCFILE",58,0)
 S TMP(9)="*****   Reminder:  Please run Transmit File to Austin option.   *****"
"RTN","HBHCFILE",59,0)
 S XMDUZ="HBHC Build Transmit File Mail Group",XMSUB=$P(HBHCDAT,"@")_" HBHC Build Transmit File",XMY(DUZ)="",XMTEXT="TMP("
"RTN","HBHCFILE",60,0)
 D ^XMD
"RTN","HBHCFILE",61,0)
 Q
"RTN","HBHCR15B")
0^38^B25293687
"RTN","HBHCR15B",1,0)
HBHCR15B ;LR VAMC(IRMS)/MJT-HBHC rpt using file 634.6, called from HBHCR15A, entry points: PROMPT1 & END, & from HBHCXMT, entry point: PROMPT2 ;9804
"RTN","HBHCR15B",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,9,10**;NOV 01, 1993
"RTN","HBHCR15B",3,0)
PROMPT1 ; Prompt user for which transmit date from last 12 batchs to include, default is Most Recent; uses transmit date cross-ref to obtain batch dates 
"RTN","HBHCR15B",4,0)
 S HBHCDATE="" F  S HBHCDATE=$O(^HBHC(634.6,"C",HBHCDATE)) Q:HBHCDATE=""  S HBHC(-HBHCDATE)=""
"RTN","HBHCR15B",5,0)
 S HBHCDATE="" F HBHCI=1:1 S HBHCDATE=$O(HBHC(HBHCDATE)) Q:(HBHCDATE="")!(HBHCI>12)  S Y=$E(HBHCDATE,2,9) D DD^%DT S TMP(HBHCI)=$E(HBHCDATE,2,9) W !,$J(HBHCI,2),".",?6,Y
"RTN","HBHCR15B",6,0)
 W !
"RTN","HBHCR15B",7,0)
 K DIR,DIRUT
"RTN","HBHCR15B",8,0)
 S DIR(0)="N^",DIR("A")="Select Transmit Date",DIR("B")=1,DIR("?")="Select transmit date by number.  Press return for 'Most Recent' transmit date"
"RTN","HBHCR15B",9,0)
 D ^DIR Q:$D(DIRUT)
"RTN","HBHCR15B",10,0)
 I '$D(TMP(Y)) W *7,!!,"Please select number from list.",! H 1 G PROMPT1
"RTN","HBHCR15B",11,0)
 S HBHCXMDT=TMP(Y)
"RTN","HBHCR15B",12,0)
PROMPT2 ; Prompt user for which forms to include, default is Summary
"RTN","HBHCR15B",13,0)
 S HBHCCC=0
"RTN","HBHCR15B",14,0)
 D TODAY^HBHCUTL
"RTN","HBHCR15B",15,0)
 S:'$D(HBHCXMDT) HBHCXMDT=DT
"RTN","HBHCR15B",16,0)
 S:$P(^HBHC(631.9,1,0),U,7)]"" HBHCIOP=$P(^%ZIS(1,$P(^HBHC(631.9,1,0),U,7),0),U)
"RTN","HBHCR15B",17,0)
 K DIR,DIRUT
"RTN","HBHCR15B",18,0)
 S DIR(0)="S^3:Admission;4:Visit;5:Discharge;6:Correction;A:All;S:Summary;",DIR("A")="Select Forms to Include",DIR("B")="Summary",DIR("?")="Select form type to be included in report.  Press return for 'Summary'."
"RTN","HBHCR15B",19,0)
 D ^DIR Q:$D(DIRUT)
"RTN","HBHCR15B",20,0)
 S HBHCDIR=Y,HBHCY0=Y(0)
"RTN","HBHCR15B",21,0)
 S Y=HBHCXMDT D DD^%DT S HBHCHEAD=$S(HBHCDIR="S":Y_" Transmit, "_HBHCY0,1:Y_" Transmit, "_HBHCY0_" Forms,")
"RTN","HBHCR15B",22,0)
 Q
"RTN","HBHCR15B",23,0)
END ; End of report processing
"RTN","HBHCR15B",24,0)
 D:IO'=IO(0)!($D(IO("S"))) HDRPAGE^HBHCUTL
"RTN","HBHCR15B",25,0)
 I '$D(IO("S")),IO=IO(0) S HBHCCC=HBHCCC+1 W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCR15B",26,0)
 D:HBHCDIR'="S" PRTLOOP
"RTN","HBHCR15B",27,0)
 I HBHCDIR="A" S HBHCHDR="W ?36,""Summary""" W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCR15B",28,0)
 W:(HBHCDIR'="A")&(HBHCDIR'="S") !
"RTN","HBHCR15B",29,0)
 W:(HBHCDIR=3)!(HBHCDIR="A")!(HBHCDIR="S") !,"Admit Eval/Adm Form 3 Total:",?32,$J(HBHCCNTA,5),!,"Reject Eval/Adm Form 3 Total:",?32,$J(HBHCCNTR,5)
"RTN","HBHCR15B",30,0)
 W:HBHCDIR=3 !?32,"-----",!,"All Eval/Adm Forms Total:",?31,$J(HBHCCNTA+HBHCCNTR,6),!
"RTN","HBHCR15B",31,0)
 W:(HBHCDIR=4)!(HBHCDIR="A")!(HBHCDIR="S") !,"Visit Form 4 Total:",?32,$J(HBHCCNT4,5)
"RTN","HBHCR15B",32,0)
 W:(HBHCDIR=5)!(HBHCDIR="A")!(HBHCDIR="S") !,"Discharge Form 5 Total:",?32,$J(HBHCCNT5,5)
"RTN","HBHCR15B",33,0)
 W:(HBHCDIR=6)!(HBHCDIR="A")!(HBHCDIR="S") !,"Correction Form 6 Total:",?32,$J(HBHCCNT6,5)
"RTN","HBHCR15B",34,0)
 W:(HBHCDIR="A")!(HBHCDIR="S") !?32,"-----",!,"All Forms Total:",?31,$J(HBHCCNTA+HBHCCNTR+HBHCCNT4+HBHCCNT5+HBHCCNT6,6),!
"RTN","HBHCR15B",35,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCR15B",36,0)
 Q
"RTN","HBHCR15B",37,0)
PRTLOOP ; Print loop
"RTN","HBHCR15B",38,0)
 S HBHCFORM="" F  S HBHCFORM=$O(^TMP("HBHC",$J,HBHCFORM)) Q:HBHCFORM=""  D HEADER,PRTLOOP2,SUB
"RTN","HBHCR15B",39,0)
 Q
"RTN","HBHCR15B",40,0)
PRTLOOP2 ; Print loop continued
"RTN","HBHCR15B",41,0)
 S HBHCACTN="" F  S HBHCACTN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN)) Q:HBHCACTN=""  S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME)) Q:HBHCNAME=""  D PRTLOOP3
"RTN","HBHCR15B",42,0)
 Q
"RTN","HBHCR15B",43,0)
PRTLOOP3 ; Print loop continued (again)
"RTN","HBHCR15B",44,0)
 S HBHCLST4=0 F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4)) Q:HBHCLST4'>0  S HBHCDATE="" F  S HBHCDATE=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE)) Q:HBHCDATE=""  D PRTLOOP4
"RTN","HBHCR15B",45,0)
 Q
"RTN","HBHCR15B",46,0)
PRTLOOP4 ; Print loop continued (again & again)
"RTN","HBHCR15B",47,0)
 S HBHCPRV="" F  S HBHCPRV=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV)) Q:HBHCPRV=""  D PRINT
"RTN","HBHCR15B",48,0)
 Q
"RTN","HBHCR15B",49,0)
PRINT ; Print report
"RTN","HBHCR15B",50,0)
 S HBHCINFO=^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV)
"RTN","HBHCR15B",51,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<10) W:HBHCPAGE>0 @IOF D HDRPAGE^HBHCUTL,HEADER
"RTN","HBHCR15B",52,0)
 W !?4,$S(HBHCFORM="A":3,HBHCFORM="V":4,HBHCFORM="D":5,1:6),?9,HBHCNAME,?33,HBHCLST4,?41,$E(HBHCDATE,1,2),"-",$E(HBHCDATE,3,4),"-",$E(HBHCDATE,7,8)
"RTN","HBHCR15B",53,0)
 W ?53,$S(HBHCFORM=6:$P(HBHCINFO,U,2),HBHCFORM="A":HBHCACTN,HBHCFORM="V":$P(HBHCINFO,U),1:"") W:HBHCFORM="V" ?60,HBHCPRV
"RTN","HBHCR15B",54,0)
 Q
"RTN","HBHCR15B",55,0)
SUB ; Sub-total module
"RTN","HBHCR15B",56,0)
 W:(HBHCDIR="A")&(HBHCFORM=6) !!?4,"Correction Form 6 Total:",?37,$J(HBHCCNT6,5),!,HBHCY
"RTN","HBHCR15B",57,0)
 W:(HBHCDIR="A")&(HBHCFORM="A") !!?4,"Admit Eval/Adm Form 3 Total:",?37,$J(HBHCCNTA,5),!?4,"Reject Eval/Adm Form 3 Total:",?37,$J(HBHCCNTR,5),!?37,"-----",!?4,"All Eval/Adm Forms Total:",?36,$J(HBHCCNTA+HBHCCNTR,6),!,HBHCY
"RTN","HBHCR15B",58,0)
 W:(HBHCDIR="A")&(HBHCFORM="D") !!?4,"Discharge Form 5 Total:",?37,$J(HBHCCNT5,5),!,HBHCY
"RTN","HBHCR15B",59,0)
 W:(HBHCDIR="A")&(HBHCFORM="V") !!?4,"Visit Form 4 Total:",?32,$J(HBHCCNT4,5),!,HBHCY
"RTN","HBHCR15B",60,0)
 Q
"RTN","HBHCR15B",61,0)
HEADER ; Sub-header module
"RTN","HBHCR15B",62,0)
 W !,$S(HBHCFORM=6:"Correction Form 6",HBHCFORM="A":"Evaluation/Admission Form 3",HBHCFORM="D":"Discharge Form 5",1:"Visit Form 4")_" Records",?53,$S(HBHCFORM=6:"Type",HBHCFORM="A":"Action",HBHCFORM="V":"Provider",1:""),!
"RTN","HBHCR15B",63,0)
 Q
"RTN","HBHCRP13")
0^45^B8404304
"RTN","HBHCRP13",1,0)
HBHCRP13 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, QA Indicator field for date range, sorted by name, includes: patient name, SSN, & QA Indicator, only includes records w/QA Indicator field values ;9803
"RTN","HBHCRP13",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,10**;NOV 01, 1993
"RTN","HBHCRP13",3,0)
 D START^HBHCUTL
"RTN","HBHCRP13",4,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP13",5,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP13",6,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP13",ZTDESC="HBPC QA Indicator Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP13",7,0)
DQ ; De-queue
"RTN","HBHCRP13",8,0)
 U IO
"RTN","HBHCRP13",9,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP13",10,0)
 S $P(HBHCY,"-",81)="",HBHCHEAD="QA Indicator",HBHCHDR="W !,""Patient Name"",?35,""SSN"",?53,""Visit Date"",?68,""QA Indicator""",HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP13",11,0)
 D TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCRP13",12,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRRANGE^HBHCUTL
"RTN","HBHCRP13",13,0)
LOOP ; Loop thru ^HBHC(632) "C" (visit date) cross-ref to build report
"RTN","HBHCRP13",14,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCDATE=X
"RTN","HBHCRP13",15,0)
 F  S HBHCDATE=$O(^HBHC(632,"C",HBHCDATE)) Q:(HBHCDATE="")!(HBHCDATE>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCDATE,HBHCDFN)) Q:HBHCDFN=""  D PROCESS
"RTN","HBHCRP13",16,0)
 D PRTLOOP,ENDRPT^HBHCUTL1
"RTN","HBHCRP13",17,0)
EXIT ; Exit module
"RTN","HBHCRP13",18,0)
 D ^%ZISC
"RTN","HBHCRP13",19,0)
 K HBHCBEG1,HBHCBEG2,HBHCCOLM,HBHCCC,HBHCDATE,HBHCDFN,HBHCDPT0,HBHCEND1,HBHCEND2,HBHCHDR,HBHCHEAD,HBHCNAME,HBHCNOD0,HBHCPAGE,HBHCTDY,HBHCTMP,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP13",20,0)
 Q
"RTN","HBHCRP13",21,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCRP13",22,0)
 S HBHCNOD0=^HBHC(632,HBHCDFN,0)
"RTN","HBHCRP13",23,0)
 Q:$P(HBHCNOD0,U,7)]""  ; Q:Cancelled appointment
"RTN","HBHCRP13",24,0)
 Q:$P(HBHCNOD0,U,16)=""  ; Q:QA Indicator field is null
"RTN","HBHCRP13",25,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0)
"RTN","HBHCRP13",26,0)
 S ^TMP("HBHC",$J,$P(HBHCDPT0,U),HBHCDATE)=$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9)_U_$P(HBHCNOD0,U,16)
"RTN","HBHCRP13",27,0)
 Q
"RTN","HBHCRP13",28,0)
PRTLOOP ; Print loop
"RTN","HBHCRP13",29,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCDATE="" F  S HBHCDATE=$O(^TMP("HBHC",$J,HBHCNAME,HBHCDATE)) Q:HBHCDATE=""  D PRINT
"RTN","HBHCRP13",30,0)
 Q
"RTN","HBHCRP13",31,0)
PRINT ; Print report
"RTN","HBHCRP13",32,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCRP13",33,0)
 S HBHCTMP=^TMP("HBHC",$J,HBHCNAME,HBHCDATE)
"RTN","HBHCRP13",34,0)
 W !,HBHCNAME,?35,$P(HBHCTMP,U),?53,$E(HBHCDATE,4,5)_"-"_$E(HBHCDATE,6,7)_"-"_$E(HBHCDATE,2,3),?68,$P(HBHCTMP,U,2),!,HBHCY
"RTN","HBHCRP13",35,0)
 Q
"RTN","HBHCRP1A")
0^35^B15356957
"RTN","HBHCRP1A",1,0)
HBHCRP1A ; LR VAMC(IRMS)/MJT-HBHC report on files 634.1, 634.2, & 634.3, (Form 3/4/5 (A/V/D respectively) Error(s)), sorted by form, then by: clinic, date, patient & includes:  pt name, last 4, form, & corresponding date ;9803
"RTN","HBHCRP1A",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10**;NOV 01, 1993
"RTN","HBHCRP1A",3,0)
 ; visits display current outpatient encounter file data, allowing easier re-entry when cleaning up PCE errors, includes:  Pt file IEN, error, provider, Dx, CPT code & clinic name, calls HBHCRP1B
"RTN","HBHCRP1A",4,0)
 I $P(^HBHC(631.9,1,0),U,8)]"" W *7,!,"File Update in progress.  Please try again later." H 3 Q
"RTN","HBHCRP1A",5,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS Q:POP
"RTN","HBHCRP1A",6,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP1A",ZTSAVE("HBHC*")="",ZTDESC="HBPC Form Errors Report" D ^%ZTLOAD G EXIT
"RTN","HBHCRP1A",7,0)
DQ ; De-queue
"RTN","HBHCRP1A",8,0)
 U IO
"RTN","HBHCRP1A",9,0)
 D START^HBHCRP1B
"RTN","HBHCRP1A",10,0)
LOOP ; Loop thru files 634.1, 634.2 & 634.3 "B" cross-ref
"RTN","HBHCRP1A",11,0)
 F HBHCFILE=634.1,634.2,634.3 S HBHCDPT="" F  S HBHCDPT=$O(^HBHC(HBHCFILE,"B",HBHCDPT)) Q:HBHCDPT=""  D SETUP^HBHCRP1B S HBHCIEN="" F  S HBHCIEN=$O(^HBHC(HBHCFILE,"B",HBHCDPT,HBHCIEN)) Q:HBHCIEN=""  D PROCESS
"RTN","HBHCRP1A",12,0)
 D PRTLOOP^HBHCRP1B D:$D(^HBHC(634.5,"B")) PSEUDO^HBHCUTL3
"RTN","HBHCRP1A",13,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<12) W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCRP1A",14,0)
 D:$D(^HBHC(634.2,"B")) PCEMSG^HBHCUTL3 D ENDRPT^HBHCUTL1
"RTN","HBHCRP1A",15,0)
EXIT ; Exit module
"RTN","HBHCRP1A",16,0)
 D EXIT^HBHCRP1B
"RTN","HBHCRP1A",17,0)
 Q
"RTN","HBHCRP1A",18,0)
PROCESS ; Process report data
"RTN","HBHCRP1A",19,0)
 S HBHCDPT0=^DPT(HBHCDPT,0),HBHCNOD0=$S(HBHCFORM="V":$G(^HBHC(HBHCFL,HBHCIEN,0)),1:$G(^HBHC(HBHCFL,$P(^HBHC(HBHCFILE,HBHCIEN,0),U,2),0)))
"RTN","HBHCRP1A",20,0)
 ; Form 3: use Evaluation Date (field 1) if Date (field 17) null, 'reject' episodes prior to PCE patch will only have eval date
"RTN","HBHCRP1A",21,0)
 S (HBHCDAT,Y)=$P(HBHCNOD0,U,HBHCPC) S:(HBHCFORM="A")&(Y="") (HBHCDAT,Y)=$P(HBHCNOD0,U,2) D DD^%DT S HBHCDATE=$E(Y,1,18)
"RTN","HBHCRP1A",22,0)
 S HBHCNAME=$E($P(HBHCDPT0,U),1,14),HBHCSSN=$E($P(HBHCDPT0,U,9),6,9)
"RTN","HBHCRP1A",23,0)
 S HBHCCLN="n/a" S:HBHCFORM="V" HBHCCLN=$S($P(HBHCNOD0,U,6)]"":$E($P(^SC($P(HBHCNOD0,U,6),0),U),1,18),1:"Unknown")
"RTN","HBHCRP1A",24,0)
 S HBHCMSG="" S:HBHCFORM="V" HBHCMSG=$S($P(HBHCNOD0,U,3)]"":$P(^HBHC(633.1,$P(HBHCNOD0,U,3),0),U),1:"")
"RTN","HBHCRP1A",25,0)
 I HBHCFORM="V" S HBHCOEP=$P(HBHCNOD0,U,4) D:HBHCOEP]"" OE
"RTN","HBHCRP1A",26,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,1)="`"_HBHCDPT_U_HBHCDATE_U_HBHCMSG
"RTN","HBHCRP1A",27,0)
 Q
"RTN","HBHCRP1A",28,0)
OE ; Process Outpatient Encounter data
"RTN","HBHCRP1A",29,0)
 ; Provider, 2 pieces of info delimited by $ (Provider name & V PROVIDER  ^AUPNVPRV(9000010.06) DFN)
"RTN","HBHCRP1A",30,0)
 K HBHCPRV1,HBHCPRVL
"RTN","HBHCRP1A",31,0)
 D GETPRV^SDOE(HBHCOEP,"HBHCPRVL")
"RTN","HBHCRP1A",32,0)
 S HBHCDFN=0 F HBHCI=1:1 S HBHCDFN=$O(HBHCPRVL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCPRVP=$P(HBHCPRVL(HBHCDFN),U),^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,2,HBHCI)=$S(HBHCPRVP]"":$P(^VA(200,HBHCPRVP,0),U)_"$"_HBHCPRVP,1:"")
"RTN","HBHCRP1A",33,0)
 ; Dx
"RTN","HBHCRP1A",34,0)
 K HBHCDXL
"RTN","HBHCRP1A",35,0)
 D GETDX^SDOE(HBHCOEP,"HBHCDXL")
"RTN","HBHCRP1A",36,0)
 S HBHCDFN=0 F HBHCI=1:1 S HBHCDFN=$O(HBHCDXL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCINFO=HBHCDXL(HBHCDFN),HBHCICDP=$P(HBHCINFO,U),HBHCDX1=$S($P(HBHCINFO,U,12)="P":"* ",1:HBHCSP2) D ICD
"RTN","HBHCRP1A",37,0)
 ; CPT Code, 3 pieces of info delimited by $ (CPT Code w/Text, Quantity of CPT code & New Person file (200) DFN), must match V PROVIDER ^AUPNVPRV(9000010.06) DFN to ensure same provider
"RTN","HBHCRP1A",38,0)
 K HBHCCPTL,HBHCPRV
"RTN","HBHCRP1A",39,0)
 D GETCPT^SDOE(HBHCOEP,"HBHCCPTL")
"RTN","HBHCRP1A",40,0)
 S HBHCDFN=0 F HBHCI=1:1 S HBHCDFN=$O(HBHCCPTL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCINFO=HBHCCPTL(HBHCDFN),HBHCCPT=$P(HBHCINFO,U) D CPT
"RTN","HBHCRP1A",41,0)
 Q
"RTN","HBHCRP1A",42,0)
ICD ; Dx info
"RTN","HBHCRP1A",43,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,3,HBHCI)=HBHCDX1_$S(HBHCICDP]"":$P(^ICD9(HBHCICDP,0),U)_"  "_$P(^ICD9(HBHCICDP,0),U,3),1:"")_$S(HBHCDX1["*":"  *  Primary Dx",1:"")
"RTN","HBHCRP1A",44,0)
 Q
"RTN","HBHCRP1A",45,0)
CPT ; CPT info
"RTN","HBHCRP1A",46,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI)=$S(HBHCCPT]"":$P(^ICPT(HBHCCPT,0),U)_"  "_$P(^ICPT(HBHCCPT,0),U,2)_"$"_$P(HBHCINFO,U,16)_"$"_$S($P($G(^AUPNVCPT(HBHCDFN,12)),U,4)]"":$P(^AUPNVCPT(HBHCDFN,12),U,4),1:""),1:"")
"RTN","HBHCRP1A",47,0)
 Q
"RTN","HBHCRP1B")
0^36^B15795402
"RTN","HBHCRP1B",1,0)
HBHCRP1B ; LR VAMC(IRMS)/MJT-HBHC report on files 634.1, 634.2, & 634.3, (Form 3/4/5 (A/V/D respectively) Error(s)), called by HBHCRP1A, entry points:  START, SETUP, PRTLOOP, EXIT ;9803
"RTN","HBHCRP1B",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10**;NOV 01, 1993
"RTN","HBHCRP1B",3,0)
START ; Entry point
"RTN","HBHCRP1B",4,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP1B",5,0)
 ; Max length for HBHCHEAD = 50
"RTN","HBHCRP1B",6,0)
 S $P(HBHCSP2," ",3)="",$P(HBHCY,"-",81)="",HBHCPAGE=0,HBHCHEAD="Form Errors",HBHCHDR="W ""Patient"",?27,""Last"",!,""File IEN"",?10,""Patient Name"",?27,""Four"",?34,""Visit Clinic Name"",?55,""Date"",?75,""Form"""
"RTN","HBHCRP1B",7,0)
 S HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1 D TODAY^HBHCUTL
"RTN","HBHCRP1B",8,0)
 Q
"RTN","HBHCRP1B",9,0)
SETUP ; Setup variables
"RTN","HBHCRP1B",10,0)
 S HBHCFORM=$S(HBHCFILE=634.1:"A",HBHCFILE=634.2:"V",1:"D"),HBHCFL=$S(HBHCFORM="V":634.2,1:631),HBHCPC=$S(HBHCFORM="D":40,HBHCFORM="V":5,1:18)
"RTN","HBHCRP1B",11,0)
 Q
"RTN","HBHCRP1B",12,0)
PRTLOOP ; Print loop
"RTN","HBHCRP1B",13,0)
 D:IO'=IO(0)!($D(IO("S"))) HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",14,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",15,0)
 S HBHCFORM=""
"RTN","HBHCRP1B",16,0)
 F  S HBHCFORM=$O(^TMP("HBHC",$J,HBHCFORM)) Q:HBHCFORM=""  D SETTXT S HBHCCLN="" F  S HBHCCLN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN)) Q:HBHCCLN=""  S HBHCDAT="" F  S HBHCDAT=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT)) Q:HBHCDAT=""  D LOOP2
"RTN","HBHCRP1B",17,0)
 Q
"RTN","HBHCRP1B",18,0)
SETTXT ; Set text
"RTN","HBHCRP1B",19,0)
 S HBHCTXT=$S(HBHCFORM="A":"E/Adm",HBHCFORM="V":"Visit",1:"D/C")
"RTN","HBHCRP1B",20,0)
 Q
"RTN","HBHCRP1B",21,0)
LOOP2 ; Continuation of PRTLOOP
"RTN","HBHCRP1B",22,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME)) Q:HBHCNAME=""  S HBHCSSN="" F  S HBHCSSN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN)) Q:HBHCSSN=""  D PRINT
"RTN","HBHCRP1B",23,0)
 Q
"RTN","HBHCRP1B",24,0)
PRINT ; Print report
"RTN","HBHCRP1B",25,0)
 S HBHCINFO=^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,1)
"RTN","HBHCRP1B",26,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<12) W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",27,0)
 W !,$J($P(HBHCINFO,U),8),?10,HBHCNAME,?27,HBHCSSN,?34,HBHCCLN,?55,$P(HBHCINFO,U,2),"  ",?75,HBHCTXT W:$P(HBHCINFO,U,3)]"" !,"Error:  ",$P(HBHCINFO,U,3)
"RTN","HBHCRP1B",28,0)
 I HBHCFORM'="V" W !,HBHCY Q
"RTN","HBHCRP1B",29,0)
 ; provider
"RTN","HBHCRP1B",30,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,2,HBHCI)) Q:HBHCINFO=""  W !,"Provider:  ",$P(HBHCINFO,"$"),?54,"Encounter Prov #:",?72,$J($P(HBHCINFO,"$",2),8)
"RTN","HBHCRP1B",31,0)
 ; Dx
"RTN","HBHCRP1B",32,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,3,HBHCI)) Q:HBHCINFO=""  W !,"ICD9:  ",HBHCINFO
"RTN","HBHCRP1B",33,0)
 ; CPT code
"RTN","HBHCRP1B",34,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI)) Q:HBHCINFO=""  W !?1,"CPT:  ",$P(HBHCINFO,"$"),?45,"QTY: ",$J($P(HBHCINFO,"$",2),3),?55,"CPT Code Prov #:",?72,$J($P(HBHCINFO,"$",3),8)
"RTN","HBHCRP1B",35,0)
 W !,HBHCY
"RTN","HBHCRP1B",36,0)
 Q
"RTN","HBHCRP1B",37,0)
EXIT ; Exit module
"RTN","HBHCRP1B",38,0)
 D ^%ZISC
"RTN","HBHCRP1B",39,0)
 K DA,DIK,HBHCCC,HBHCCLN,HBHCCOLM,HBHCCPT,HBHCCPTL,HBHCDAT,HBHCDATE,HBHCDFN,HBHCDPT,HBHCDPT0,HBHCDX1,HBHCDXL,HBHCFILE,HBHCFL,HBHCFORM,HBHCHDR,HBHCHEAD,HBHCI,HBHCICDP,HBHCIEN,HBHCINFO,HBHCMSG,HBHCNAME,HBHCNOD0,HBHCOEP,HBHCPAGE
"RTN","HBHCRP1B",40,0)
 K HBHCPC,HBHCPRV,HBHCPRV1,HBHCPRVL,HBHCPRVP,HBHCSP2,HBHCSSN,HBHCTDY,HBHCTXT,HBHCY,HBHCZ,Y,^TMP("HBHC",$J)
"RTN","HBHCRP1B",41,0)
 Q
"RTN","HBHCRP20")
0^40^B11468644
"RTN","HBHCRP20",1,0)
HBHCRP20 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, unique patients by date range summary ;9803
"RTN","HBHCRP20",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**8,10**;NOV 01, 1993
"RTN","HBHCRP20",3,0)
 D START^HBHCUTL
"RTN","HBHCRP20",4,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP20",5,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP20",6,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP20",ZTDESC="HBPC Unique Patients by Date Range Summary Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP20",7,0)
DQ ; De-queue
"RTN","HBHCRP20",8,0)
 U IO
"RTN","HBHCRP20",9,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP20",10,0)
 S $P(HBHCY,"-",81)="",HBHCHEAD="Unique Patients by Date Range Summary",(HBHCCNT,HBHCCNT1)=0
"RTN","HBHCRP20",11,0)
 S HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP20",12,0)
 D TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCRP20",13,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRRANGE^HBHCUTL
"RTN","HBHCRP20",14,0)
LOOP ; Loop thru ^HBHC(632) "C" (appointment date) cross-ref to build report
"RTN","HBHCRP20",15,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCAPDT=X_.9999,HBHCEND1=HBHCEND1_.9999
"RTN","HBHCRP20",16,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT="")!(HBHCAPDT>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCAPDT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCRP20",17,0)
 D CNTLOOP
"RTN","HBHCRP20",18,0)
 W !!,"Total Patients with Single Appointment Only:",?46,$J(HBHCCNT1,4)
"RTN","HBHCRP20",19,0)
 W !,"Total Patients with Multiple Appointments:",?46,$J(HBHCCNT,4)
"RTN","HBHCRP20",20,0)
 W !!,"Total Unique Patients:  ",$J((HBHCCNT+HBHCCNT1),5)
"RTN","HBHCRP20",21,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCRP20",22,0)
EXIT ; Exit module
"RTN","HBHCRP20",23,0)
 D ^%ZISC
"RTN","HBHCRP20",24,0)
 K HBHCAPDT,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCNT,HBHCCNT1,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCEND1,HBHCEND2,HBHCHEAD,HBHCNAME,HBHCNOD0,HBHCPAGE,HBHCSSN,HBHCTDY,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP20",25,0)
 Q
"RTN","HBHCRP20",26,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCRP20",27,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0)
"RTN","HBHCRP20",28,0)
 D:$D(^TMP("HBHC",$J,$P(HBHCDPT0,U),$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9))) SET
"RTN","HBHCRP20",29,0)
 S:'$D(^TMP("HBHC",$J,$P(HBHCDPT0,U),$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9))) ^TMP("HBHC",$J,$P(HBHCDPT0,U),$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9))=HBHCAPDT
"RTN","HBHCRP20",30,0)
 Q
"RTN","HBHCRP20",31,0)
SET ; Set ^TMP("HBHC",$J
"RTN","HBHCRP20",32,0)
 S ^TMP("HBHC",$J,$P(HBHCDPT0,U),$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9))=HBHCAPDT_U_"*"
"RTN","HBHCRP20",33,0)
 Q
"RTN","HBHCRP20",34,0)
CNTLOOP ; Count loop
"RTN","HBHCRP20",35,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCSSN="" F  S HBHCSSN=$O(^TMP("HBHC",$J,HBHCNAME,HBHCSSN)) Q:HBHCSSN=""  D COUNT
"RTN","HBHCRP20",36,0)
 Q
"RTN","HBHCRP20",37,0)
COUNT ; Count
"RTN","HBHCRP20",38,0)
 ; patients with multiple visits
"RTN","HBHCRP20",39,0)
 S:$P(^TMP("HBHC",$J,HBHCNAME,HBHCSSN),U,2)]"" HBHCCNT=HBHCCNT+1
"RTN","HBHCRP20",40,0)
 ; patients with only 1 visit
"RTN","HBHCRP20",41,0)
 S:$P(^TMP("HBHC",$J,HBHCNAME,HBHCSSN),U,2)="" HBHCCNT1=HBHCCNT1+1
"RTN","HBHCRP20",42,0)
 Q
"RTN","HBHCUPD")
0^49^B13101640
"RTN","HBHCUPD",1,0)
HBHCUPD ; LR VAMC(IRMS)/MJT-HBHC update missing data in ^HBHC(631) using ^HBHC(634.1) & ^HBHC(634.3) as input for which records/fields to update, HBHC(634.2 errors must be corrected using PCE software, 634.2 data killed @ end of processing;9804
"RTN","HBHCUPD",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,8,10**;NOV 01, 1993
"RTN","HBHCUPD",3,0)
 I ('$D(^HBHC(634.1,"B")))&($D(^HBHC(634.2,"B")))&('$D(^HBHC(634.3,"B")))&('$D(^HBHC(634.5,"B"))) D PCEMSG^HBHCUTL3 S HBHCFLAG=1 G PSEUDO
"RTN","HBHCUPD",4,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCUPD",5,0)
 W ! K DIC S DIC="^DPT(",DIC(0)="AEMQ" D ^DIC
"RTN","HBHCUPD",6,0)
 G:Y=-1 PSEUDO
"RTN","HBHCUPD",7,0)
 S HBHCDPT=+Y
"RTN","HBHCUPD",8,0)
 I ('$D(^HBHC(634.1,"B",HBHCDPT)))&('$D(^HBHC(634.2,"B",HBHCDPT)))&('$D(^HBHC(634.3,"B",HBHCDPT)))&('$D(^HBHC(634.5,"B",HBHCDPT))) W *7,!!,"This patient has no records containing errors on file.",! H 3 G PROMPT
"RTN","HBHCUPD",9,0)
 F HBHCFILE=634.1,634.3 I $D(^HBHC(HBHCFILE,"B",HBHCDPT)) K DR S HBHCFORM=$S(HBHCFILE=634.1:3,1:5) S:HBHCFORM=5 HBHCCNT=1 S HBHCIEN="" F  S HBHCIEN=$O(^HBHC(HBHCFILE,"B",HBHCDPT,HBHCIEN)) Q:HBHCIEN=""  D PROCESS
"RTN","HBHCUPD",10,0)
 G PROMPT
"RTN","HBHCUPD",11,0)
PSEUDO ; Process pseudo SSN message
"RTN","HBHCUPD",12,0)
 I '$D(HBHCFLAG) D:$D(^HBHC(634.2,"B")) PCEMSG^HBHCUTL3
"RTN","HBHCUPD",13,0)
 I $D(^HBHC(634.5,"B")) D PSEUDO^HBHCUTL3 K ^HBHC(634.5) S ^HBHC(634.5,0)="HBHC PSEUDO SSN ERROR(S)^634.5P^"
"RTN","HBHCUPD",14,0)
EXIT ; Exit module
"RTN","HBHCUPD",15,0)
 ; HBHC(634.2 visit errors must be corrected using PCE software, 634.2 killed here so validity processing can occur again
"RTN","HBHCUPD",16,0)
 K ^HBHC(634.2) S ^HBHC(634.2,0)="HBHC VISIT ERROR(S)^634.2P^"
"RTN","HBHCUPD",17,0)
 K DA,DIC,DIE,DIK,DR,HBHC,HBHC12,HBHC359,HBHCAFLG,HBHCCNT,HBHCCOLM,HBHCDATE,HBHCDFLG,HBHCDFN,HBHCDIED,HBHCDPT,HBHCDR,HBHCDT,HBHCFILE,HBHCFLAG,HBHCFLG,HBHCFORM,HBHCI,HBHCIEN,HBHCJ,HBHCKEEP,HBHCL,HBHCM,HBHCMSG,HBHCNOD1,HBHCPC,HBHCQ
"RTN","HBHCUPD",18,0)
 K HBHCQ1,HBHCRFLG,HBHCSUB,HBHCTFLG,HBHCTXT,HBHCUPD,HBHCWRD1,HBHCWRD2,HBHCWRD3,HBHCY0,Y
"RTN","HBHCUPD",19,0)
 Q
"RTN","HBHCUPD",20,0)
PROCESS ; Process errors via DIE
"RTN","HBHCUPD",21,0)
 S DA=$P(^HBHC(HBHCFILE,HBHCIEN,0),U,2),HBHCTXT=$S(HBHCFORM=3:"Evalution/Admission",1:"Discharge")
"RTN","HBHCUPD",22,0)
 L +^HBHC(631,DA):0 I '$T W *7,!!,"Another user is editing this "_HBHCTXT_" entry.",! H 3 Q
"RTN","HBHCUPD",23,0)
 S:HBHCFORM=3 (DR,HBHCDR)=^HBHC(HBHCFILE,HBHCIEN,1)
"RTN","HBHCUPD",24,0)
 I HBHCFORM=5 S HBHCSUB=0 F  S HBHCSUB=$O(^HBHC(HBHCFILE,HBHCIEN,HBHCSUB)) Q:HBHCSUB'>0  D SET
"RTN","HBHCUPD",25,0)
 K DIE S DIE="^HBHC(631,",DIE("NO^")="OUTOK"
"RTN","HBHCUPD",26,0)
 S HBHC=HBHCIEN,HBHCPC=$S(HBHCFORM=5:40,1:18),HBHCCOLM=$S(HBHCFORM=3:14,1:19)
"RTN","HBHCUPD",27,0)
 S HBHCDT=$P($G(^HBHC(631,DA,0)),U,HBHCPC) S:HBHCDT="" HBHCDT=$P($G(^HBHC(631,DA,0)),U,2) S HBHCDATE=$S(HBHCDT]"":$E(HBHCDT,4,5)_"-"_$E(HBHCDT,6,7)_"-"_$E(HBHCDT,2,3),1:"")
"RTN","HBHCUPD",28,0)
 W !!!?HBHCCOLM,"===  Editing "_$S(HBHCDATE]"":HBHCDATE_" "_HBHCTXT,1:HBHCTXT)_" data  ===",!
"RTN","HBHCUPD",29,0)
 D ^DIE K DR
"RTN","HBHCUPD",30,0)
 ; Admit/Reject Action branch
"RTN","HBHCUPD",31,0)
 S:HBHCDR["14;" DR="K HBHCQ;S X=$P(^HBHC(631,DA,0),U,15);D ACTION^HBHCUTL;15;16;I $D(HBHCQ) K HBHCQ S Y=0;17:36"
"RTN","HBHCUPD",32,0)
 ; Discharge Status branch
"RTN","HBHCUPD",33,0)
 S:HBHCDR["43;" DR="[HBHC UPDATE DISCHARGE]"
"RTN","HBHCUPD",34,0)
 I $D(DR) I '$D(Y) I (DR["D ACTION")!(DR["[HBHC UPDATE") S HBHCDFN=DA,HBHCUPD=1 D ^DIE K HBHCUPD
"RTN","HBHCUPD",35,0)
 L -^HBHC(631,DA) I '$D(HBHCKEEP) I '$D(Y) K DIK S DIK="^HBHC(HBHCFILE,",DA=HBHC D ^DIK K HBHCKEEP
"RTN","HBHCUPD",36,0)
 Q
"RTN","HBHCUPD",37,0)
SET ; Set DR string(s) for Discharge data
"RTN","HBHCUPD",38,0)
 S:$D(DR) DR(1,631,HBHCCNT)=^HBHC(HBHCFILE,HBHCIEN,HBHCSUB),HBHCCNT=HBHCCNT+1
"RTN","HBHCUPD",39,0)
 S:'$D(DR) (DR,HBHCDR)=^HBHC(HBHCFILE,HBHCIEN,HBHCSUB)
"RTN","HBHCUPD",40,0)
 Q
"RTN","HBHCUTL3")
0^47^B13783691
"RTN","HBHCUTL3",1,0)
HBHCUTL3 ; LR VAMC(IRMS)/MJT-HBHC Utility module, Entry points:  PSEUDO, PCEMSG, DX, & CPT ;9804
"RTN","HBHCUTL3",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10**;NOV 01, 1993
"RTN","HBHCUTL3",3,0)
PSEUDO ; Print pseudo SSN message
"RTN","HBHCUTL3",4,0)
 W *7,!!,"Patient visit records with pseudo social security numbers (SSNs) exist.",!,"Print the 'Pseudo Social Security Number Report' located on the HBHC Reports"
"RTN","HBHCUTL3",5,0)
 W !,"Menu to obtain a list of patients with invalid SSNs.  HBHC must determine",!,"what corrective action is appropriate to eliminate these records from the",!,"HBHC Information System.",!! H 5
"RTN","HBHCUTL3",6,0)
 Q
"RTN","HBHCUTL3",7,0)
PCEMSG ; Print PCE correction of errors message
"RTN","HBHCUTL3",8,0)
 W !!,"Note:  Please use Appointment Management to Correct Visit Errors.  Run",!?7,"Edit Form Errors Data option when corrections are complete."
"RTN","HBHCUTL3",9,0)
 Q
"RTN","HBHCUTL3",10,0)
DX ; Process Diagnosis (DX), HBHCNOD0=^HBHC(632,HBHCDFN,0), HBHCNOD0 must be defined prior to call, returns code plus text
"RTN","HBHCUTL3",11,0)
 ; Dx
"RTN","HBHCUTL3",12,0)
 S $P(HBHCSP5," ",6)=""
"RTN","HBHCUTL3",13,0)
 S HBHCDX1=$S($P(HBHCNOD0,U,17)]"":$P(^ICD9($P(HBHCNOD0,U,17),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,17),0),U))))_$P(^ICD9($P(HBHCNOD0,U,17),0),U,3),1:"")
"RTN","HBHCUTL3",14,0)
 S HBHCDX2=$S($P(HBHCNOD0,U,18)]"":$P(^ICD9($P(HBHCNOD0,U,18),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,18),0),U))))_$P(^ICD9($P(HBHCNOD0,U,18),0),U,3),1:"")
"RTN","HBHCUTL3",15,0)
 S HBHCDX3=$S($P(HBHCNOD0,U,19)]"":$P(^ICD9($P(HBHCNOD0,U,19),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,19),0),U))))_$P(^ICD9($P(HBHCNOD0,U,19),0),U,3),1:"")
"RTN","HBHCUTL3",16,0)
 S HBHCDX4=$S($P(HBHCNOD0,U,20)]"":$P(^ICD9($P(HBHCNOD0,U,20),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,20),0),U))))_$P(^ICD9($P(HBHCNOD0,U,20),0),U,3),1:"")
"RTN","HBHCUTL3",17,0)
 S HBHCDX5=$S($P(HBHCNOD0,U,21)]"":$P(^ICD9($P(HBHCNOD0,U,21),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,21),0),U))))_$P(^ICD9($P(HBHCNOD0,U,21),0),U,3),1:"")
"RTN","HBHCUTL3",18,0)
 K HBHCSP5
"RTN","HBHCUTL3",19,0)
 Q
"RTN","HBHCUTL3",20,0)
CPT ; CPT code info, HBHCNOD1=^HBHC(632,HBHCDFN,1), HBHCNOD1 must be defined prior to call, returns code plus text
"RTN","HBHCUTL3",21,0)
 S HBHCCPT1=$S($P(HBHCNOD1,U)]"":$P(^ICPT($P(HBHCNOD1,U),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U),0),U,2),1:"")
"RTN","HBHCUTL3",22,0)
 S HBHCCPT2=$S($P(HBHCNOD1,U,2)]"":$P(^ICPT($P(HBHCNOD1,U,2),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,2),0),U,2),1:"")
"RTN","HBHCUTL3",23,0)
 S HBHCCPT3=$S($P(HBHCNOD1,U,3)]"":$P(^ICPT($P(HBHCNOD1,U,3),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,3),0),U,2),1:"")
"RTN","HBHCUTL3",24,0)
 S HBHCCPT4=$S($P(HBHCNOD1,U,4)]"":$P(^ICPT($P(HBHCNOD1,U,4),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,4),0),U,2),1:"")
"RTN","HBHCUTL3",25,0)
 S HBHCCPT5=$S($P(HBHCNOD1,U,5)]"":$P(^ICPT($P(HBHCNOD1,U,5),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,5),0),U,2),1:"")
"RTN","HBHCUTL3",26,0)
 S HBHCCPT6=$S($P(HBHCNOD1,U,6)]"":$P(^ICPT($P(HBHCNOD1,U,6),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,6),0),U,2),1:"")
"RTN","HBHCUTL3",27,0)
 S HBHCCPT7=$S($P(HBHCNOD1,U,7)]"":$P(^ICPT($P(HBHCNOD1,U,7),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,7),0),U,2),1:"")
"RTN","HBHCUTL3",28,0)
 S HBHCCPT8=$S($P(HBHCNOD1,U,8)]"":$P(^ICPT($P(HBHCNOD1,U,8),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,8),0),U,2),1:"")
"RTN","HBHCUTL3",29,0)
 S HBHCCPT9=$S($P(HBHCNOD1,U,9)]"":$P(^ICPT($P(HBHCNOD1,U,9),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,9),0),U,2),1:"")
"RTN","HBHCUTL3",30,0)
 S HBHCCP10=$S($P(HBHCNOD1,U,10)]"":$P(^ICPT($P(HBHCNOD1,U,10),0),U)_"  "_$P(^ICPT($P(HBHCNOD1,U,10),0),U,2),1:"")
"RTN","HBHCUTL3",31,0)
 Q
"RTN","HBHCXMD")
0^48^B22250778
"RTN","HBHCXMD",1,0)
HBHCXMD ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634) with Discharge Data or ^HBHC(634.3), file of records in ^HBHC(631) containing missing/erroneous data, called by ^HBHCFILE, calls ^HBHCXMD1 ;9804
"RTN","HBHCXMD",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**4,6,9,10**;NOV 01, 1993
"RTN","HBHCXMD",3,0)
 D START^HBHCXMD1
"RTN","HBHCXMD",4,0)
LOOP ; Loop thru ^HBHC(631) "AF","N" cross-ref to create nodes in ^HBHC(634) => transmit or ^HBHC(634.3) => Discharge Error(s) file
"RTN","HBHCXMD",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AF","N",HBHCDFN)) Q:HBHCDFN=""  S HBHCFLG=1,HBHCCONT=0 D SETNODE I HBHCFLG D:HBHCCONT TRANS D:'HBHCCONT ERROR
"RTN","HBHCXMD",6,0)
EXIT ; Exit module
"RTN","HBHCXMD",7,0)
 D EXIT^HBHCXMD1
"RTN","HBHCXMD",8,0)
 Q
"RTN","HBHCXMD",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit) or ^HBHC(634.3) (Discharge Error(s))
"RTN","HBHCXMD",10,0)
 S HBHCNOD0=^HBHC(631,HBHCDFN,0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1)),HBHCXMT5=$P(HBHCNOD1,U,18)
"RTN","HBHCXMD",11,0)
 ; Quit if discharge date is greater than HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMD",12,0)
 I $P(HBHCNOD0,U,40)>HBHCLSDT S HBHCFLG=0 Q
"RTN","HBHCXMD",13,0)
 S (HBHCDR1,HBHCDR2,HBHCDR3,HBHCDR4,HBHCDR5)=""
"RTN","HBHCXMD",14,0)
 S HBHCTFLG=0 S:($P(HBHCNOD0,U,45)]"")!($P(HBHCNOD0,U,46)]"") HBHCTFLG=1
"RTN","HBHCXMD",15,0)
 S HBHCDFLG=0 F HBHCL=47:1:55 Q:HBHCDFLG  S:$P(HBHCNOD0,U,HBHCL)]"" HBHCDFLG=1
"RTN","HBHCXMD",16,0)
 I HBHCNOD1]"" F HBHCM=1:1:10 Q:HBHCDFLG  S:$P(HBHCNOD1,U,HBHCM)]"" HBHCDFLG=1
"RTN","HBHCXMD",17,0)
 S HBHCADDT=$S($P(HBHCNOD0,U,18)]"":$E($P(HBHCNOD0,U,18),4,5)_$E($P(HBHCNOD0,U,18),6,7)_(1700+$E($P(HBHCNOD0,U,18),1,3)),$P(HBHCNOD0,U,2)]"":$E($P(HBHCNOD0,U,2),4,5)_$E($P(HBHCNOD0,U,2),6,7)_(1700+$E($P(HBHCNOD0,U,2),1,3)),1:"")
"RTN","HBHCXMD",18,0)
 S HBHCDSDT=$S($P(HBHCNOD0,U,40)]"":$E($P(HBHCNOD0,U,40),4,5)_$E($P(HBHCNOD0,U,40),6,7)_(1700+$E($P(HBHCNOD0,U,40),1,3)),1:"")
"RTN","HBHCXMD",19,0)
 S:((HBHCDSDT="")&((HBHCDFLG=1)!(HBHCTFLG=1)!($D(HBHCDDTA)))) HBHCDR1="39;"_HBHCDR1
"RTN","HBHCXMD",20,0)
 F HBHCI=1:1:4 S HBHCFLD=$P(HBHCFLD1,U,HBHCI) S:HBHCFLD]"" HBHCDDTA=1 S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCI+40)]"":$P(HBHCNOD0,U,HBHCI+40),1:"") D:@HBHCFLD="" DFLT1^HBHCXMD1
"RTN","HBHCXMD",21,0)
 Q:HBHCSTAT=""
"RTN","HBHCXMD",22,0)
 I HBHCSTAT=4 I (HBHCDFLG)!(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",23,0)
 I (HBHC359[(U_HBHCSTAT_U))&(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",24,0)
 I HBHCNOD1]"" I ($P(HBHCNOD1,U,15)]"")&(HBHCSTAT'=4) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",25,0)
 S HBHCDEST=$S($P(HBHCNOD0,U,45)]"":$P(HBHCNOD0,U,45),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCDEST=HBHCSP1) HBHCDR1=HBHCDR1_"44;"
"RTN","HBHCXMD",26,0)
 S HBHCAGCY=$S($P(HBHCNOD0,U,46)]"":$P(HBHCNOD0,U,46),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCAGCY=HBHCSP1) HBHCDR1=HBHCDR1_"45;"
"RTN","HBHCXMD",27,0)
 S HBHCICDD=$S($P(HBHCNOD0,U,47)]"":$P($P(^ICD9($P(HBHCNOD0,U,47),0),U),".")_$P($P(^ICD9($P(HBHCNOD0,U,47),0),U),".",2),1:HBHCSP6) S:$L(HBHCICDD)<6 HBHCICDD=HBHCICDD_$J("",6-$L(HBHCICDD)) D:(HBHCSTAT'=4)&(HBHCICDD=HBHCSP6) ICDDFLT^HBHCXMD1
"RTN","HBHCXMD",28,0)
 F HBHCJ=1:1:8 S HBHCFLD=$P(HBHCFLD2,U,HBHCJ) S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCJ+47)]"":$P(HBHCNOD0,U,HBHCJ+47),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT2^HBHCXMD1
"RTN","HBHCXMD",29,0)
 F HBHCK=1:1:10 S HBHCFLD=$P(HBHCFLD3,U,HBHCK) S @HBHCFLD=$S($P(HBHCNOD1,U,HBHCK)]"":$P(HBHCNOD1,U,HBHCK),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT3^HBHCXMD1
"RTN","HBHCXMD",30,0)
 Q:(HBHCADDT="")!(HBHCDR1]"")!(HBHCDR2]"")!(HBHCDR3]"")!(HBHCDR4]"")!(HBHCDR5]"")
"RTN","HBHCXMD",31,0)
 S HBHCCONT=1
"RTN","HBHCXMD",32,0)
 S HBHCNAME=$E($P(^DPT($P(HBHCNOD0,U),0),U),1,5) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCXMD",33,0)
 S HBHCSSN=$P(^DPT($P(HBHCNOD0,U),0),U,9)
"RTN","HBHCXMD",34,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDSDT_HBHCELGD_HBHCMARD_HBHCLIVD_HBHCSTAT_HBHCDEST_HBHCAGCY_HBHCADDT_HBHCNAME_HBHCICDD_HBHCVISD_HBHCHERD_HBHCEXCD_HBHCRECD_HBHCBTHD_HBHCDRSD_HBHCTLTD_HBHCTRND_HBHCEATD_HBHCWLKD_HBHCBWLD_HBHCBLDD
"RTN","HBHCXMD",35,0)
 S HBHCREC=HBHCREC_HBHCMOBD_HBHCADTD_HBHCBHVD_HBHCDSOD_HBHCMODD_HBHCLMTD_HBHCSP61
"RTN","HBHCXMD",36,0)
 Q
"RTN","HBHCXMD",37,0)
TRANS ; Set node in ^HBHC(634) transmit file & flag record as 'F" (filed for transmit) in ^HBHC(631)
"RTN","HBHCXMD",38,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1,$P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMD",39,0)
 S $P(^HBHC(634,HBHCNDX1,0),U)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMD",40,0)
 L +^HBHC(631,HBHCDFN,1) K:HBHCXMT5]"" ^HBHC(631,"AF",HBHCXMT5,HBHCDFN) S $P(^HBHC(631,HBHCDFN,1),U,18)="F",^HBHC(631,"AF","F",HBHCDFN)="",$P(^HBHC(631,HBHCDFN,1),U,22)=HBHCTDY L -^HBHC(631,HBHCDFN,1)
"RTN","HBHCXMD",41,0)
 Q
"RTN","HBHCXMD",42,0)
ERROR ; Set node in ^HBHC(634.3) if data is incomplete or proper fields invalid for 'Discharge Status'
"RTN","HBHCXMD",43,0)
 L +^HBHC(634.3,0) S HBHCNDX2=$P(^HBHC(634.3,0),U,3)+1,$P(^HBHC(634.3,0),U,3)=HBHCNDX2,$P(^HBHC(634.3,0),U,4)=$P(^HBHC(634.3,0),U,4)+1 L -^HBHC(634.3,0)
"RTN","HBHCXMD",44,0)
 S ^HBHC(634.3,HBHCNDX2,0)=$P(HBHCNOD0,U)_U_HBHCDFN
"RTN","HBHCXMD",45,0)
 S:HBHCDR1]"" ^HBHC(634.3,HBHCNDX2,1)=HBHCDR1
"RTN","HBHCXMD",46,0)
 S:HBHCDR2]"" ^HBHC(634.3,HBHCNDX2,2)=HBHCDR2
"RTN","HBHCXMD",47,0)
 S:HBHCDR3]"" ^HBHC(634.3,HBHCNDX2,3)=HBHCDR3
"RTN","HBHCXMD",48,0)
 S:HBHCDR4]"" ^HBHC(634.3,HBHCNDX2,4)=HBHCDR4
"RTN","HBHCXMD",49,0)
 S:HBHCDR5]"" ^HBHC(634.3,HBHCNDX2,5)=HBHCDR5
"RTN","HBHCXMD",50,0)
 S ^HBHC(634.3,"B",$P(HBHCNOD0,U),HBHCNDX2)=""
"RTN","HBHCXMD",51,0)
 Q
"RTN","HBHCXMT")
0^32^B16591405
"RTN","HBHCXMT",1,0)
HBHCXMT ; LR VAMC(IRMS)/MJT-HBHC create mail msgs (100 recs/125 char ea, max) from HBHC(634 file, transmit/Austin, set batch initial MM msg # & MM msg date in HBHC(631/632, set Last MM Date in HBHC(631.9, optionally prt rpt ;9803
"RTN","HBHCXMT",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,3,6,8,10**;NOV 01, 1993
"RTN","HBHCXMT",3,0)
 I $P(^HBHC(631.9,1,0),U,8)]"" W *7,!,"File Update in progress.  Please try again later." H 3 Q 
"RTN","HBHCXMT",4,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B"))) W *7,!!,"Records containing errors exist and must be corrected before file can",!,"be transmitted.",!! H 3 Q
"RTN","HBHCXMT",5,0)
 I '$D(^HBHC(634,"B")) W *7,!!,"No data on file to transmit." H 3 Q
"RTN","HBHCXMT",6,0)
 I ('$D(^HBHC(631,"AE","F")))&('$D(^HBHC(631,"AF","F")))&('$D(^HBHC(632,"AC","F")))!($P(^HBHC(631.9,1,0),U,6)]"") W *7,!!,"Data on file has been transmitted to Austin; duplicate transmission not allowed." H 3 Q
"RTN","HBHCXMT",7,0)
 I $P(^HBHC(631.9,1,0),U,7)]"" S HBHCPRTR=$P($G(^%ZIS(1,$P(^HBHC(631.9,1,0),U,7),0)),U) I HBHCPRTR]"" W "Transmit Report will be printed on device:  ",HBHCPRTR W "." D PROMPT2^HBHCR15B
"RTN","HBHCXMT",8,0)
 S ZTRTN="DQ^HBHCXMT",ZTIO="",ZTDTH=$H,ZTDESC="HBPC Transmission",ZTSAVE("HBHC*")="" D ^%ZTLOAD,^%ZISC
"RTN","HBHCXMT",9,0)
 W *7,!!,"Transmission request has been queued.  Task number:  ",ZTSK,!! H 3
"RTN","HBHCXMT",10,0)
 G EXIT
"RTN","HBHCXMT",11,0)
DQ ; De-queue
"RTN","HBHCXMT",12,0)
 ; Set Transmission in Progress Flag
"RTN","HBHCXMT",13,0)
 S $P(^HBHC(631.9,1,0),U,6)=1
"RTN","HBHCXMT",14,0)
 K XMZ,%DT,^TMP("HBHC",$J)
"RTN","HBHCXMT",15,0)
 S X="T" D ^%DT S HBHCDT=Y,HBHCDATE=$E(HBHCDT,4,5)_"/"_$E(HBHCDT,6,7)_"/"_$E(HBHCDT,2,3)
"RTN","HBHCXMT",16,0)
 S (HBHCCNT,HBHCFLG,HBHCNODE)=0,HBHCMSG=1
"RTN","HBHCXMT",17,0)
 F  S HBHCNODE=$O(^HBHC(634,HBHCNODE)) D:(HBHCCNT>99)!(HBHCNODE'>0) MAIL Q:HBHCNODE'>0  S HBHCCNT=HBHCCNT+1,HBHCINFO=^HBHC(634,HBHCNODE,0),^TMP("HBHC",$J,HBHCMSG,HBHCNODE,0)=HBHCINFO D HISTORY
"RTN","HBHCXMT",18,0)
CLEANUP ; Cleanup Transmit History (HBHC(634.6)) to maintain maximum of last 12 transmit batches
"RTN","HBHCXMT",19,0)
 S (HBHCTOT,HBHCDATE)=0 F  S HBHCDATE=$O(^HBHC(634.6,"C",HBHCDATE)) Q:HBHCDATE'>0  S HBHCTOT=HBHCTOT+1 S:HBHCTOT=1 HBHCDAT=HBHCDATE
"RTN","HBHCXMT",20,0)
 I HBHCTOT>12 S DIK="^HBHC(634.6,",DA="" F  S DA=$O(^HBHC(634.6,"C",HBHCDAT,DA)) Q:DA'>0  D ^DIK
"RTN","HBHCXMT",21,0)
 ; Turn Off Transmission in Progress Flag
"RTN","HBHCXMT",22,0)
 S $P(^HBHC(631.9,1,0),U,6)=""
"RTN","HBHCXMT",23,0)
PRINT ; Print Transmit Report if default printer exists in 631.9
"RTN","HBHCXMT",24,0)
 ; HBHCIOP set in PROMPT2^HBHCR15B
"RTN","HBHCXMT",25,0)
 I ($D(HBHCIOP))&($D(HBHCHEAD)) N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,ZTQUEUED S ZTRTN="DQ^HBHCR15A",ZTIO=HBHCIOP,ZTDESC="HBPC Transmit Report",ZTSAVE("HBHC*")="",ZTDTH=$H D ^%ZTLOAD,^%ZISC
"RTN","HBHCXMT",26,0)
EXIT ; Exit module
"RTN","HBHCXMT",27,0)
 K DA,DIC,DIE,DIK,DR,HBHCCNT,HBHCDAT,HBHCDATE,HBHCDT,HBHCFLG,HBHCINFO,HBHCMSG,HBHCNODE,HBHCPRTR,HBHCTOT,HBHCZ,XMSUB,XMTEXT,XMY,XMZ,X,Y,%,%DT,^TMP("HBHC",$J)
"RTN","HBHCXMT",28,0)
 Q
"RTN","HBHCXMT",29,0)
MAIL ; Send mail message
"RTN","HBHCXMT",30,0)
 S XMSUB="HBHC Site: "_$S($P(^HBHC(631.9,1,0),U,5)]"":$E($P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U),1,3),1:"")_"  Message: "_HBHCMSG_"  "_HBHCDATE_" Transmission",XMTEXT="^TMP(""HBHC"",$J,HBHCMSG,",XMY("XXX@Q-HBH.VA.GOV")=""
"RTN","HBHCXMT",31,0)
 D ^XMD
"RTN","HBHCXMT",32,0)
 S HBHCMSG=HBHCMSG+1,HBHCCNT=0
"RTN","HBHCXMT",33,0)
LOOP ; Loop thru ^HBHC(631,"AE") (Form 3 Transmit Flag), ^HBHC(631,"AF") (Form 5 Transmit Flag), & ^HBHC(632,"AC") (Form 4 Transmit Flag) cross-refs to set batch initial MM message number & mailman message date fields in ^HBHC(631/632)
"RTN","HBHCXMT",34,0)
 Q:HBHCFLG
"RTN","HBHCXMT",35,0)
 S DIE="^HBHC(631,"
"RTN","HBHCXMT",36,0)
 S DR="71///T;74///^S X=XMZ;75///^S X=HBHCDT",DA="" F  S DA=$O(^HBHC(631,"AE","F",DA)) Q:DA=""  D ^DIE
"RTN","HBHCXMT",37,0)
 S DR="72///T;77///^S X=XMZ;78///^S X=HBHCDT",DA="" F  S DA=$O(^HBHC(631,"AF","F",DA)) Q:DA=""  D ^DIE
"RTN","HBHCXMT",38,0)
 S DIE="^HBHC(632,",DR="7///T;9///^S X=XMZ;10///^S X=HBHCDT",DA="" F  S DA=$O(^HBHC(632,"AC","F",DA)) Q:DA=""  D ^DIE
"RTN","HBHCXMT",39,0)
 ; Set Last Mail Message Date in System Parameters file
"RTN","HBHCXMT",40,0)
 S $P(^HBHC(631.9,1,0),U,2)=HBHCDT
"RTN","HBHCXMT",41,0)
 S HBHCFLG=1
"RTN","HBHCXMT",42,0)
 Q
"RTN","HBHCXMT",43,0)
HISTORY ; Update HBHC(634.6 Transmit History file
"RTN","HBHCXMT",44,0)
 K DD,DO S DIC="^HBHC(634.6,",DIC(0)="L",DIC("DR")="1///^S X=HBHCDT",X=HBHCINFO D FILE^DICN
"RTN","HBHCXMT",45,0)
 Q
"VER")
8.0^21.0
"^DD",631.9,631.9,7,0)
FILE UPDATE IN PROGRESS FLAG^S^1:File Update in Progress;^0;8^Q
"^DD",631.9,631.9,7,3)
Field updated by package only, no user input.
"^DD",631.9,631.9,7,21,0)
^^2^2^2980318^^
"^DD",631.9,631.9,7,21,1,0)
This field represents a flag used to determine if file updating is currently in
"^DD",631.9,631.9,7,21,2,0)
progress.
"^DD",631.9,631.9,7,"DT")
2980318
**END**
**END**
