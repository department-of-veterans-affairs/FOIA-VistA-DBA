Released IB*2*381 SEQ #347
Extracted from mail message
**KIDS**:IB*2.0*381^

**INSTALL NAME**
IB*2.0*381
"BLD",7310,0)
IB*2.0*381^INTEGRATED BILLING^0^3070913^y
"BLD",7310,1,0)
^^1^1^3070913^
"BLD",7310,1,1,0)
PHARMACY ENCAPSULATION API AND EPHARMACY FOLLOW UP PATCH
"BLD",7310,4,0)
^9.64PA^^
"BLD",7310,6.3)
1
"BLD",7310,"KRN",0)
^9.67PA^8989.52^19
"BLD",7310,"KRN",.4,0)
.4
"BLD",7310,"KRN",.401,0)
.401
"BLD",7310,"KRN",.402,0)
.402
"BLD",7310,"KRN",.403,0)
.403
"BLD",7310,"KRN",.5,0)
.5
"BLD",7310,"KRN",.84,0)
.84
"BLD",7310,"KRN",3.6,0)
3.6
"BLD",7310,"KRN",3.8,0)
3.8
"BLD",7310,"KRN",9.2,0)
9.2
"BLD",7310,"KRN",9.8,0)
9.8
"BLD",7310,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7310,"KRN",9.8,"NM",1,0)
IBCCC3^^0^B9196131
"BLD",7310,"KRN",9.8,"NM",2,0)
IBCSC5C^^0^B44534568
"BLD",7310,"KRN",9.8,"NM","B","IBCCC3",1)

"BLD",7310,"KRN",9.8,"NM","B","IBCSC5C",2)

"BLD",7310,"KRN",19,0)
19
"BLD",7310,"KRN",19.1,0)
19.1
"BLD",7310,"KRN",101,0)
101
"BLD",7310,"KRN",409.61,0)
409.61
"BLD",7310,"KRN",771,0)
771
"BLD",7310,"KRN",870,0)
870
"BLD",7310,"KRN",8989.51,0)
8989.51
"BLD",7310,"KRN",8989.52,0)
8989.52
"BLD",7310,"KRN",8994,0)
8994
"BLD",7310,"KRN","B",.4,.4)

"BLD",7310,"KRN","B",.401,.401)

"BLD",7310,"KRN","B",.402,.402)

"BLD",7310,"KRN","B",.403,.403)

"BLD",7310,"KRN","B",.5,.5)

"BLD",7310,"KRN","B",.84,.84)

"BLD",7310,"KRN","B",3.6,3.6)

"BLD",7310,"KRN","B",3.8,3.8)

"BLD",7310,"KRN","B",9.2,9.2)

"BLD",7310,"KRN","B",9.8,9.8)

"BLD",7310,"KRN","B",19,19)

"BLD",7310,"KRN","B",19.1,19.1)

"BLD",7310,"KRN","B",101,101)

"BLD",7310,"KRN","B",409.61,409.61)

"BLD",7310,"KRN","B",771,771)

"BLD",7310,"KRN","B",870,870)

"BLD",7310,"KRN","B",8989.51,8989.51)

"BLD",7310,"KRN","B",8989.52,8989.52)

"BLD",7310,"KRN","B",8994,8994)

"BLD",7310,"QUES",0)
^9.62^^
"BLD",7310,"REQB",0)
^9.611^1^1
"BLD",7310,"REQB",1,0)
IB*2.0*363^2
"BLD",7310,"REQB","B","IB*2.0*363",1)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
381^3070913
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3070913
"PKG",200,22,1,"PAH",1,1,1,0)
PHARMACY ENCAPSULATION API AND EPHARMACY FOLLOW UP PATCH
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBCCC3")
0^1^B9196131^B9038313
"RTN","IBCCC3",1,0)
IBCCC3 ;ALB/AAS - CANCEL AND CLONE A BILL - CONTINUED ;25-JAN-90
"RTN","IBCCC3",2,0)
 ;;2.0;INTEGRATED BILLING;**363,381**;21-MAR-94;Build 1
"RTN","IBCCC3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCC3",4,0)
 ;
"RTN","IBCCC3",5,0)
 ;copy entries from table files:
"RTN","IBCCC3",6,0)
 ;passed in: IBIFN=new bill, IBIFN1=old bill
"RTN","IBCCC3",7,0)
 ;
"RTN","IBCCC3",8,0)
 I '$D(^DGCR(399,+$G(IBIFN),0))!'$D(^DGCR(399,+$G(IBIFN1),0)) Q
"RTN","IBCCC3",9,0)
 N IBXR,X,Y,IBX
"RTN","IBCCC3",10,0)
 ;
"RTN","IBCCC3",11,0)
DX ;copy diagnosis' (362.3)
"RTN","IBCCC3",12,0)
 N IBDX,IBDIFN
"RTN","IBCCC3",13,0)
 ;copy diagnosis from old bill
"RTN","IBCCC3",14,0)
 I $D(^IBA(362.3,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",15,0)
 . S IBDX=0 F  S IBDX=$O(^IBA(362.3,IBXR,IBDX)) Q:'IBDX  D
"RTN","IBCCC3",16,0)
 .. S IBDIFN=0 F  S IBDIFN=$O(^IBA(362.3,IBXR,IBDX,IBDIFN)) Q:'IBDIFN  D
"RTN","IBCCC3",17,0)
 ... S IBX=$G(^IBA(362.3,IBDIFN,0)) I 'IBX!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",18,0)
 ... S DIC="^IBA(362.3,",DIC(0)="L",X=+IBX K DA,DO D FILE^DICN
"RTN","IBCCC3",19,0)
 ... S DIE=DIC,DA=+Y,DR=".02////"_IBIFN_";.03////"_$P(IBX,U,3) D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",20,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",21,0)
 ;
"RTN","IBCCC3",22,0)
PRDX ;repoint procedure's associated diagnosis (2,304,10-13 -> 362.3)
"RTN","IBCCC3",23,0)
 N IBCPT,IBDIFN1,IBLN,IBI
"RTN","IBCCC3",24,0)
 S IBCPT=0 F  S IBCPT=$O(^DGCR(399,+IBIFN,"CP",IBCPT)) Q:'IBCPT  D
"RTN","IBCCC3",25,0)
 . S IBLN=$G(^DGCR(399,+IBIFN,"CP",IBCPT,0)) F IBI=11:1:14 S IBDIFN1=$P(IBLN,U,IBI) I +IBDIFN1 D
"RTN","IBCCC3",26,0)
 .. S IBDX=+$G(^IBA(362.3,+IBDIFN1,0)) Q:'IBDX
"RTN","IBCCC3",27,0)
 .. S IBDIFN=$O(^IBA(362.3,"AIFN"_IBIFN,IBDX,0)) Q:'IBDIFN
"RTN","IBCCC3",28,0)
 .. S $P(^DGCR(399,+IBIFN,"CP",IBCPT,0),U,IBI)=IBDIFN
"RTN","IBCCC3",29,0)
 ;
"RTN","IBCCC3",30,0)
RX ;copy rx refills (362.4)
"RTN","IBCCC3",31,0)
 N IBRX,IBRIFN,IBRXDA,IBDATE,IBNDC,IBDFN,IB3624DA
"RTN","IBCCC3",32,0)
 ;copy rx refills from old bill
"RTN","IBCCC3",33,0)
 ; IB*2*363 - get NDC# from PRESCRIPTION file (#52) before creating new
"RTN","IBCCC3",34,0)
 ; record entry in 362.4
"RTN","IBCCC3",35,0)
 I $D(^IBA(362.4,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",36,0)
 . S IBRX=0 F  S IBRX=$O(^IBA(362.4,IBXR,IBRX)) Q:IBRX=""  D
"RTN","IBCCC3",37,0)
 .. S IBRIFN=0 F  S IBRIFN=$O(^IBA(362.4,IBXR,IBRX,IBRIFN)) Q:'IBRIFN  D
"RTN","IBCCC3",38,0)
 ... S IBX=$G(^IBA(362.4,IBRIFN,0)) I IBX=""!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",39,0)
 ... S DIC="^IBA(362.4,",DIC(0)="L",X=$P(IBX,U,1) K DA,DO D FILE^DICN K DA,DO Q:Y'>0
"RTN","IBCCC3",40,0)
 ... S IB3624DA=+Y,IBRXDA=$P(IBX,U,5),IBDATE=$P(IBX,U,3),IBDFN=$$GET1^DIQ(399,IBIFN1,.02,"I")
"RTN","IBCCC3",41,0)
 ... S IBNDC=$S(IBRXDA:$$GETNDC^IBEFUNC3(IBDFN,IBRXDA,IBDATE),1:$P(IBX,U,8))
"RTN","IBCCC3",42,0)
 ... S DR=".02////"_IBIFN_";.03////"_IBDATE_";.04////"_$P(IBX,U,4)_";.05////"_IBRXDA_";.06////"_$P(IBX,U,6)_";.07////"_$P(IBX,U,7)_";.08////"_IBNDC
"RTN","IBCCC3",43,0)
 ... S DIE=DIC,DA=IB3624DA D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",44,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",45,0)
 ;
"RTN","IBCCC3",46,0)
PROS ;copy prosthetics (362.5)
"RTN","IBCCC3",47,0)
 N IBPR,IBPIFN
"RTN","IBCCC3",48,0)
 ;copy rx refills from old bill
"RTN","IBCCC3",49,0)
 I $D(^IBA(362.5,"AIFN"_IBIFN1)) S IBXR="AIFN"_IBIFN1 D
"RTN","IBCCC3",50,0)
 . S IBPR=0 F  S IBPR=$O(^IBA(362.5,IBXR,IBPR)) Q:IBPR=""  D
"RTN","IBCCC3",51,0)
 .. S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.5,IBXR,IBPR,IBPIFN)) Q:'IBPIFN  D
"RTN","IBCCC3",52,0)
 ... S IBX=$G(^IBA(362.5,IBPIFN,0)) I IBX=""!($P(IBX,U,2)'=IBIFN1) Q
"RTN","IBCCC3",53,0)
 ... S DIC="^IBA(362.5,",DIC(0)="L",X=$P(IBX,U,1) K DA,DO D FILE^DICN K DA,DO Q:Y'>0
"RTN","IBCCC3",54,0)
 ... S DR=".02////"_IBIFN_";.03////"_$P(IBX,U,3)_";.04////"_$P(IBX,U,4)
"RTN","IBCCC3",55,0)
 ... S DIE=DIC,DA=+Y D ^DIE K DIC,DIE,DA,DO,DR
"RTN","IBCCC3",56,0)
 K DIE,DIC,DA,DO,DR,X,Y
"RTN","IBCCC3",57,0)
 Q
"RTN","IBCCC3",58,0)
 ;IBCCC3
"RTN","IBCSC5C")
0^2^B44534568^B44500670
"RTN","IBCSC5C",1,0)
IBCSC5C ;ALB/ARH - ADD/EDIT PRESCRIPTION FILLS (CONTINUED) ;3/4/94
"RTN","IBCSC5C",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,130,51,160,260,309,315,339,347,363,381**;21-MAR-94;Build 1
"RTN","IBCSC5C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC5C",4,0)
 ;
"RTN","IBCSC5C",5,0)
 ;
"RTN","IBCSC5C",6,0)
DEFAULT(IFN,IBRX) ; add default DX and CPT to a prescription bill
"RTN","IBCSC5C",7,0)
 ; if one is not in PSO.  If there is, use it instead.
"RTN","IBCSC5C",8,0)
 ; IFN = ien of bill entry
"RTN","IBCSC5C",9,0)
 N IBX,IBPAR1,IBDX,IBCPT,IBDT,IBBIL,IBDXIFN,IBCPTIFN,IBY,IB52,IBC,PDFN,LIST,NODE
"RTN","IBCSC5C",10,0)
 S IBDXIFN=0
"RTN","IBCSC5C",11,0)
 S IBPAR1=$G(^IBE(350.9,1,1)),IBDX=$P(IBPAR1,U,29),IBCPT=$P(IBPAR1,U,30)
"RTN","IBCSC5C",12,0)
 S IBBIL=$G(^DGCR(399,+$G(IFN),0)) Q:IBBIL=""
"RTN","IBCSC5C",13,0)
 S IBX=$S($G(IBRX):$P($G(^DGCR(399,IFN,"RC",+IBRX,0)),U,11),1:$O(^IBA(362.4,"C",IFN,0))) Q:'IBX
"RTN","IBCSC5C",14,0)
 S IB52=+$P($G(^IBA(362.4,IBX,0)),"^",5),IBY=0 Q:IB52=0
"RTN","IBCSC5C",15,0)
 S PDFN=$$FILE^IBRXUTL(IB52,2)
"RTN","IBCSC5C",16,0)
 S LIST="IBCSC5CARR"
"RTN","IBCSC5C",17,0)
 S NODE="ICD"
"RTN","IBCSC5C",18,0)
 D RX^PSO52API(PDFN,LIST,IB52,,NODE,,)
"RTN","IBCSC5C",19,0)
 I ^TMP($J,LIST,PDFN,IB52,"ICD",0)>0 D
"RTN","IBCSC5C",20,0)
 .S IBY=0 F  S IBY=$O(^TMP($J,LIST,PDFN,IB52,"ICD",IBY)) Q:IBY'>0  D
"RTN","IBCSC5C",21,0)
 ..S IBDX(IBY)=$$ICD^IBRXUTL1(PDFN,IB52,IBY,LIST)
"RTN","IBCSC5C",22,0)
 ..I 'IBDX(IBY) K IBDX(IBY)
"RTN","IBCSC5C",23,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",24,0)
 I 'IBDX,'IBCPT,$D(IBDX)<10 Q
"RTN","IBCSC5C",25,0)
 S IBDT=$P($G(^IBA(362.4,+IBX,0)),U,3) Q:'IBDT
"RTN","IBCSC5C",26,0)
 ; add dx associated with rx if they are there.
"RTN","IBCSC5C",27,0)
 I $D(IBDX)>9 S (IBC,IBDX,IBY)=0 F  S IBY=$O(IBDX(IBY)) Q:'IBY  D
"RTN","IBCSC5C",28,0)
 . I $D(^IBA(362.3,"AIFN"_IFN,+IBDX(IBY))) Q
"RTN","IBCSC5C",29,0)
 . S IBC=IBC+1
"RTN","IBCSC5C",30,0)
 . S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN_";.03////"_IBC,X=+IBDX(IBY),DLAYGO=362.3
"RTN","IBCSC5C",31,0)
 . K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO
"RTN","IBCSC5C",32,0)
 . S IBDXIFN(IBC)=+Y
"RTN","IBCSC5C",33,0)
 ; add default dx if none found on actual rx.
"RTN","IBCSC5C",34,0)
 I +IBDX,'$D(^IBA(362.3,"AIFN"_IFN,+IBDX)) S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN,X=IBDX,DLAYGO=362.3 K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO S IBDXIFN=+Y
"RTN","IBCSC5C",35,0)
 I +IBCPT D  ;Check if the procedure is already present for the Rx
"RTN","IBCSC5C",36,0)
 . N Z,Z0,DUP
"RTN","IBCSC5C",37,0)
 . S (DUP,Z)=0 F  S Z=$O(^DGCR(399,IFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:DUP
"RTN","IBCSC5C",38,0)
 .. I $P(Z0,U,10)=3,$P(Z0,U,15),$P(Z0,U,11)=IBX S DUP=1
"RTN","IBCSC5C",39,0)
 . Q:DUP
"RTN","IBCSC5C",40,0)
 . I $P($G(^DGCR(399,IFN,0)),U,9)="" S DIE="^DGCR(399,",DA=IFN,DR=".09////5" D ^DIE K DIE,DIC,DA,DR
"RTN","IBCSC5C",41,0)
 . I '$D(^DGCR(399,IFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCSC5C",42,0)
 . S DLAYGO=399,DIC("DR")="1////"_IBDT D
"RTN","IBCSC5C",43,0)
 . . I +IBDXIFN>0 S DIC("DR")=DIC("DR")_";10////"_IBDXIFN Q
"RTN","IBCSC5C",44,0)
 . . I $D(IBDXIFN)>9 F IBY=1:1:4 I $D(IBDXIFN(IBY)) S DIC("DR")=DIC("DR")_";"_(IBY+9)_"////"_IBDXIFN(IBY)
"RTN","IBCSC5C",45,0)
 . S DIC="^DGCR(399,"_IFN_",""CP"",",DIC(0)="L",DA(1)=IFN,X=IBCPT_";ICPT(" K DD,DO D FILE^DICN K DIC,DA,DD,DO,DR,DLAYGO
"RTN","IBCSC5C",46,0)
 . I +Y D
"RTN","IBCSC5C",47,0)
 .. N Z,IBZ
"RTN","IBCSC5C",48,0)
 .. S IBZ=+Y,Z=$S($G(IBREV):IBREV,1:$$FINDREV^IBCSC5A(IFN,3,+IBX))
"RTN","IBCSC5C",49,0)
 .. I Z S DR=".15////"_IBZ_";.06////"_IBCPT,DA=+Z,DA(1)=IFN,DIE="^DGCR(399,"_DA(1)_",""RC""," D ^DIE
"RTN","IBCSC5C",50,0)
 Q
"RTN","IBCSC5C",51,0)
 ;
"RTN","IBCSC5C",52,0)
RXDISP(DFN,DT1,DT2,ARRAY,POARR,RXARR,IBRXALL,NODISP) ; display all rx fills for a patient and date range
"RTN","IBCSC5C",53,0)
 ;RXARR (as defined by SET^IBCSC5A) passed by ref. only to check if rx-fill is on the bill, not necessary not changed
"RTN","IBCSC5C",54,0)
 ;returns: ARRAY(RX #, FILL DT) = RX IFN (52) ^ FILL IFN ^ DRUG ^ DAYS SUPPLY ^ QTY ^ NDC, pass by reference if desired
"RTN","IBCSC5C",55,0)
 ;         POARR(CNT)=RX # ^ FILL DT
"RTN","IBCSC5C",56,0)
 N PIFN,RIFN,IBX,IBY,DTE,DTR,RX,IBCNT,IBRX0,IBRX2,IBS,LIST,LIST2 K ARRAY,POARR S POARR=0,NODISP=+$G(NODISP)
"RTN","IBCSC5C",57,0)
 S IBCNT=0,DT1=$G(DT1)-.0001,DT2=$G(DT2) S:'DT2 DT2=9999999 Q:'$G(DFN)
"RTN","IBCSC5C",58,0)
 ;^PS(55,DFN,"P","A",EXPIRATION DATE, RX) is the best xref available for finding patient fills in a date range
"RTN","IBCSC5C",59,0)
 ;if RX expires/cancelled before start of bill then should not be applicable to bill
"RTN","IBCSC5C",60,0)
 S LIST="IBRXDISPARR"
"RTN","IBCSC5C",61,0)
 D PROF^PSO52API(DFN,LIST,DT1)
"RTN","IBCSC5C",62,0)
 S DTE=0 F  S DTE=$O(^TMP($J,LIST,"B",DTE)) Q:'DTE  D
"RTN","IBCSC5C",63,0)
 . S PIFN=0 F  S PIFN=$O(^TMP($J,LIST,"B",DTE,PIFN)) Q:'PIFN  D
"RTN","IBCSC5C",64,0)
 .. S IBRX0=$$RXZERO^IBRXUTL(DFN,PIFN),IBRX2=$$RXSEC^IBRXUTL(DFN,PIFN)
"RTN","IBCSC5C",65,0)
 .. ; original fill
"RTN","IBCSC5C",66,0)
 .. I +$G(IBRXALL) S DTR=$P(IBRX2,U,2) I DTR'<DT1,DTR'>DT2 D
"RTN","IBCSC5C",67,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",68,0)
 ... S ARRAY($P(IBRX0,U,1),+DTR)=PIFN_U_0_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBRX0,U,7)_U_$$GETNDC^PSONDCUT(PIFN,0)
"RTN","IBCSC5C",69,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",70,0)
 ... Q
"RTN","IBCSC5C",71,0)
 .. ; refills
"RTN","IBCSC5C",72,0)
 .. S LIST2="IBDISPSUB"
"RTN","IBCSC5C",73,0)
 .. S NODE="R"
"RTN","IBCSC5C",74,0)
 .. D RX^PSO52API(DFN,LIST2,PIFN,,NODE,,)
"RTN","IBCSC5C",75,0)
 .. S RIFN=0 F  S RIFN=$O(^TMP($J,LIST2,DFN,PIFN,"RF",RIFN)) Q:RIFN'>0  D
"RTN","IBCSC5C",76,0)
 ... S IBY=$$ZEROSUB^IBRXUTL(DFN,PIFN,RIFN) Q:IBY=""
"RTN","IBCSC5C",77,0)
 ... Q:+IBY<DT1!(+IBY>DT2)
"RTN","IBCSC5C",78,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",79,0)
 ... S ARRAY($P(IBRX0,U,1),+IBY)=PIFN_U_RIFN_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBY,U,4)_U_$$GETNDC^PSONDCUT(PIFN,RIFN)
"RTN","IBCSC5C",80,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",81,0)
 ... Q
"RTN","IBCSC5C",82,0)
 .. K ^TMP($J,LIST2)
"RTN","IBCSC5C",83,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",84,0)
 ;
"RTN","IBCSC5C",85,0)
 S IBX="",IBS=0 F  S IBX=$O(ARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(ARRAY(IBX,IBY)) Q:'IBY  D
"RTN","IBCSC5C",86,0)
 . S IBCNT=IBCNT+1,POARR(IBCNT)=$P(IBX,U,1)_"^"_+IBY,POARR=IBCNT I $D(RXARR(IBX,IBY)) S IBS=IBS+1
"RTN","IBCSC5C",87,0)
 S $P(POARR,U,2)=IBCNT-IBS
"RTN","IBCSC5C",88,0)
 ;
"RTN","IBCSC5C",89,0)
 Q:+NODISP
"RTN","IBCSC5C",90,0)
 W @IOF,?33,"PRESCRIPTIONS IN DATE RANGE",!,"===============================================================================",!
"RTN","IBCSC5C",91,0)
 S IBCNT=0 F  S IBCNT=$O(POARR(IBCNT)) Q:IBCNT=""  S RX=$P(POARR(IBCNT),U,1),DTR=$P(POARR(IBCNT),U,2) I RX'="",DTR'="" D
"RTN","IBCSC5C",92,0)
 . S IBS=$$RXSTAT^IBCU1($P(ARRAY(RX,DTR),U,3),$P(ARRAY(RX,DTR),U,1),DTR)
"RTN","IBCSC5C",93,0)
 . S IBY="" I $D(RXARR(RX,+DTR)) S IBY="*"
"RTN","IBCSC5C",94,0)
 . D ZERO^IBRXUTL(+$P(ARRAY(RX,DTR),U,3))
"RTN","IBCSC5C",95,0)
 . W !,$J(IBCNT,2),")",?5,IBY,?6,RX,?19,$E($G(^TMP($J,"IBDRUG",+$P(ARRAY(RX,DTR),U,3),.01)),1,25),?46,$$DATE(+DTR),?56,$P(IBS,U,1),?61,$P(IBS,U,2),?69,$P(IBS,U,3),?75,$$EXEMPT(+ARRAY(RX,DTR))
"RTN","IBCSC5C",96,0)
 . S IBY=$$RXDUP^IBCU3(RX,DTR,IBIFN) I +IBY W ?73,$P($G(^DGCR(399,+IBY,0)),U,1)
"RTN","IBCSC5C",97,0)
 . K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",98,0)
 Q
"RTN","IBCSC5C",99,0)
DATE(X) Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCSC5C",100,0)
 ;
"RTN","IBCSC5C",101,0)
NEWRX(IBX) ;
"RTN","IBCSC5C",102,0)
 Q:'$G(IBX)  N X,Y K IBLIST W !
"RTN","IBCSC5C",103,0)
NEWRX1 S DIR("?")="Enter the number preceding the RX Fills you want added to the bill. "_$$HTEXT
"RTN","IBCSC5C",104,0)
 S DIR("A")="SELECT NEW RX FILLS TO ADD THE BILL"
"RTN","IBCSC5C",105,0)
 S DIR(0)="LO^1:"_+IBX D ^DIR K DIR G:'Y!$D(DIRUT) NEWRXE
"RTN","IBCSC5C",106,0)
 S IBLIST=Y
"RTN","IBCSC5C",107,0)
 ;
"RTN","IBCSC5C",108,0)
 S DIR("A")="YOU HAVE SELECTED "_IBLIST_" TO BE ADDED TO THE BILL IS THIS CORRECT",DIR("B")="YES"
"RTN","IBCSC5C",109,0)
 S DIR(0)="YO" D ^DIR K DIR I $D(DIRUT) K IBLIST G NEWRXE
"RTN","IBCSC5C",110,0)
 I 'Y K IBLIST G NEWRX1
"RTN","IBCSC5C",111,0)
NEWRXE Q
"RTN","IBCSC5C",112,0)
 ;
"RTN","IBCSC5C",113,0)
ADDNEW(IBIFN,LIST,IBPR,IBPRO) ;
"RTN","IBCSC5C",114,0)
 Q:'LIST  N IBI,IBX,IBRX,IBDT,IBQ,IBY,IBPIFN,IBZ
"RTN","IBCSC5C",115,0)
 F IBI=1:1 S IBX=$P(LIST,",",IBI) Q:'IBX  I $D(IBPRO(IBX)) D
"RTN","IBCSC5C",116,0)
 . S IBRX=$P(IBPRO(IBX),U,1),IBDT=$P(IBPRO(IBX),U,2) Q:IBRX=""
"RTN","IBCSC5C",117,0)
 . S IBQ=0,IBY=$G(IBPR(IBRX,+IBDT)) Q:'IBY
"RTN","IBCSC5C",118,0)
 . S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX,IBPIFN)) Q:'IBPIFN  I $P($G(^IBA(362.4,IBPIFN,0)),U,3)=IBDT S IBQ=1 Q
"RTN","IBCSC5C",119,0)
 . I 'IBQ S IBZ=$G(IBPR(IBRX,IBDT)) I $$ADD^IBCSC5A(IBRX,IBIFN,IBDT,$P(IBZ,U,3),$P(IBZ,U,1),$P(IBZ,U,4,6)) W "."
"RTN","IBCSC5C",120,0)
 Q
"RTN","IBCSC5C",121,0)
 ;
"RTN","IBCSC5C",122,0)
HTEXT() ;
"RTN","IBCSC5C",123,0)
 N X S X="If an Rx fill has been assigned to another bill it will be displayed in the last column. [ORG=Original Fill, NR=Not Released, RTS=Returned to Stock, OTC=Over-the-Counter, INV=Investigational, SUP=Supply Item]"
"RTN","IBCSC5C",124,0)
 Q X
"RTN","IBCSC5C",125,0)
 ;
"RTN","IBCSC5C",126,0)
RXLINK(IBIFN,CPIEN) ; Function returns the ien of the Rx rev code the proc
"RTN","IBCSC5C",127,0)
 ; code is linked to or 0 if no link found.
"RTN","IBCSC5C",128,0)
 Q +$O(^DGCR(399,IBIFN,"RC","ACP",+CPIEN,0))
"RTN","IBCSC5C",129,0)
 ;
"RTN","IBCSC5C",130,0)
EXEMPT(RX) ; Used to look up exemption if any on rx, the return value
"RTN","IBCSC5C",131,0)
 ; will be only the first exemption reason found.
"RTN","IBCSC5C",132,0)
 N IBX,IBZ,IBS,IBR,PDFN,LIST,NODE,ICDCT
"RTN","IBCSC5C",133,0)
 S PDFN=$$FILE^IBRXUTL(RX,2)
"RTN","IBCSC5C",134,0)
 S LIST="IBRXARREX"
"RTN","IBCSC5C",135,0)
 S NODE="ICD"
"RTN","IBCSC5C",136,0)
 D RX^PSO52API(PDFN,LIST,RX,,NODE,,)
"RTN","IBCSC5C",137,0)
 S ICDCT=$G(^TMP($J,LIST,PDFN,RX,"ICD",0))
"RTN","IBCSC5C",138,0)
 S IBR="",(IBS,IBX)=0
"RTN","IBCSC5C",139,0)
 I ICDCT>0 D
"RTN","IBCSC5C",140,0)
 .S IBX=0 F  S IBX=$O(^TMP($J,LIST,PDFN,RX,"ICD",IBX)) Q:IBX'>0!(IBS)  D
"RTN","IBCSC5C",141,0)
 ..S IBZ=$$ICD^IBRXUTL1(PDFN,RX,IBX,LIST) F IBP=2:1:8 Q:IBS  I $P(IBZ,"^",IBP) S IBR=$P($T(EREASON+(IBP-1)),";",3),IBS=1
"RTN","IBCSC5C",142,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",143,0)
 Q IBR
"RTN","IBCSC5C",144,0)
EREASON ;
"RTN","IBCSC5C",145,0)
 ;;AO
"RTN","IBCSC5C",146,0)
 ;;IR
"RTN","IBCSC5C",147,0)
 ;;SC
"RTN","IBCSC5C",148,0)
 ;;SWA
"RTN","IBCSC5C",149,0)
 ;;MST
"RTN","IBCSC5C",150,0)
 ;;HNC
"RTN","IBCSC5C",151,0)
 ;;CV
"RTN","IBCSC5C",152,0)
 ;;SHAD
"RTN","IBCSC5C",153,0)
 ;
"VER")
8.0^22.0
"BLD",7310,6)
^347
**END**
**END**
