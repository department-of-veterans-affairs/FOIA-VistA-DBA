Released PSJ*5*162 SEQ #160
Extracted from mail message
**KIDS**:PSJ*5.0*162^

**INSTALL NAME**
PSJ*5.0*162
"BLD",6115,0)
PSJ*5.0*162^INPATIENT MEDICATIONS^0^3060419^y
"BLD",6115,1,0)
^^6^6^3050927^
"BLD",6115,1,1,0)
1.  After Finishing and Verifying a complex Outpatient IV order, the
"BLD",6115,1,2,0)
    system was treating the New Order entered afterwards as a complex
"BLD",6115,1,3,0)
    order.
"BLD",6115,1,4,0)
 
"BLD",6115,1,5,0)
    This patch makes a correction to the software that cleans up 
"BLD",6115,1,6,0)
    information from a previous order before moving on to a New Order.
"BLD",6115,4,0)
^9.64PA^^
"BLD",6115,6)
1^
"BLD",6115,"KRN",0)
^9.67PA^8989.52^19
"BLD",6115,"KRN",.4,0)
.4
"BLD",6115,"KRN",.401,0)
.401
"BLD",6115,"KRN",.402,0)
.402
"BLD",6115,"KRN",.403,0)
.403
"BLD",6115,"KRN",.5,0)
.5
"BLD",6115,"KRN",.84,0)
.84
"BLD",6115,"KRN",3.6,0)
3.6
"BLD",6115,"KRN",3.8,0)
3.8
"BLD",6115,"KRN",9.2,0)
9.2
"BLD",6115,"KRN",9.8,0)
9.8
"BLD",6115,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6115,"KRN",9.8,"NM",1,0)
PSJO1^^0^B30966503
"BLD",6115,"KRN",9.8,"NM",2,0)
PSJOE0^^0^B27948190
"BLD",6115,"KRN",9.8,"NM","B","PSJO1",1)

"BLD",6115,"KRN",9.8,"NM","B","PSJOE0",2)

"BLD",6115,"KRN",19,0)
19
"BLD",6115,"KRN",19.1,0)
19.1
"BLD",6115,"KRN",101,0)
101
"BLD",6115,"KRN",409.61,0)
409.61
"BLD",6115,"KRN",771,0)
771
"BLD",6115,"KRN",870,0)
870
"BLD",6115,"KRN",8989.51,0)
8989.51
"BLD",6115,"KRN",8989.52,0)
8989.52
"BLD",6115,"KRN",8994,0)
8994
"BLD",6115,"KRN","B",.4,.4)

"BLD",6115,"KRN","B",.401,.401)

"BLD",6115,"KRN","B",.402,.402)

"BLD",6115,"KRN","B",.403,.403)

"BLD",6115,"KRN","B",.5,.5)

"BLD",6115,"KRN","B",.84,.84)

"BLD",6115,"KRN","B",3.6,3.6)

"BLD",6115,"KRN","B",3.8,3.8)

"BLD",6115,"KRN","B",9.2,9.2)

"BLD",6115,"KRN","B",9.8,9.8)

"BLD",6115,"KRN","B",19,19)

"BLD",6115,"KRN","B",19.1,19.1)

"BLD",6115,"KRN","B",101,101)

"BLD",6115,"KRN","B",409.61,409.61)

"BLD",6115,"KRN","B",771,771)

"BLD",6115,"KRN","B",870,870)

"BLD",6115,"KRN","B",8989.51,8989.51)

"BLD",6115,"KRN","B",8989.52,8989.52)

"BLD",6115,"KRN","B",8994,8994)

"BLD",6115,"QUES",0)
^9.62^^
"BLD",6115,"REQB",0)
^9.611^2^2
"BLD",6115,"REQB",1,0)
PSJ*5.0*127^2
"BLD",6115,"REQB",2,0)
PSJ*5.0*133^2
"BLD",6115,"REQB","B","PSJ*5.0*127",1)

"BLD",6115,"REQB","B","PSJ*5.0*133",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
162^3060419^520645583
"PKG",221,22,1,"PAH",1,1,0)
^^6^6^3060419
"PKG",221,22,1,"PAH",1,1,1,0)
1.  After Finishing and Verifying a complex Outpatient IV order, the
"PKG",221,22,1,"PAH",1,1,2,0)
    system was treating the New Order entered afterwards as a complex
"PKG",221,22,1,"PAH",1,1,3,0)
    order.
"PKG",221,22,1,"PAH",1,1,4,0)
 
"PKG",221,22,1,"PAH",1,1,5,0)
    This patch makes a correction to the software that cleans up 
"PKG",221,22,1,"PAH",1,1,6,0)
    information from a previous order before moving on to a New Order.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSJO1")
0^1^B30966503^B30933706
"RTN","PSJO1",1,0)
PSJO1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ;15 May 98 / 9:28 AM
"RTN","PSJO1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,47,56,58,109,110,127,162**;16 DEC 97
"RTN","PSJO1",3,0)
 ;
"RTN","PSJO1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJO1",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJO1",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJO1",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJO1",8,0)
 ;
"RTN","PSJO1",9,0)
ECHK ;
"RTN","PSJO1",10,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJO1",11,0)
 I +START>PSGDT,(STOP>PSGDT) G SET
"RTN","PSJO1",12,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJO1",13,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJO1",14,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJO1",15,0)
 ;
"RTN","PSJO1",16,0)
SET ;
"RTN","PSJO1",17,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",18,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJO1",19,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJO1",20,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJO1",21,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",22,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJO1",23,0)
 ;
"RTN","PSJO1",24,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJO1",25,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND
"RTN","PSJO1",26,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJO1",27,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJO1",28,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJO1",29,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJO1",30,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",31,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJO1",32,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJO1",33,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",34,0)
 ;* I $G(ORTX)=""!(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",35,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJO1",36,0)
 ;
"RTN","PSJO1",37,0)
IVSET1 ;
"RTN","PSJO1",38,0)
 ;* S TYP=$S(P(2)=P(3):"O",1:"C"),STAT=$S("ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",39,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJO1",40,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",41,0)
 I P(17)="P" S STAT="C"_$S($P($G(^PS(53.1,+ON,.2)),U,8)]"":"D",$P($G(^PS(53.1,+ON,.2)),U,4)="S":"A",$P($G(^(0)),U,24)="R":"C",1:"B")
"RTN","PSJO1",42,0)
 I ON["P",$G(P("PRNTON"))]"",PRNTON=+P("PRNTON") Q
"RTN","PSJO1",43,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",44,0)
 S ^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJO1",45,0)
 Q
"RTN","PSJO1",46,0)
 ;
"RTN","PSJO1",47,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJO1",48,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJO1",49,0)
ENUNM ;
"RTN","PSJO1",50,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJO1",51,0)
 .; naked ref below refers to line above
"RTN","PSJO1",52,0)
 .S $P(^(0),"^",9)="E",ORIFN=$P(^(0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQ_"U")
"RTN","PSJO1",53,0)
 K UPD Q
"RTN","PSJO1",54,0)
 ;
"RTN","PSJO1",55,0)
EN(PSJPTYP) ; enter here
"RTN","PSJO1",56,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJO1",57,0)
 N PSJX,PSJY
"RTN","PSJO1",58,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJO1",59,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJO1",60,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJO1",61,0)
 S PSJOCNT=0 I PSJPTYP>1 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJO1",62,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJO1",63,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJO1",64,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJO1",65,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJO1",66,0)
 .I $S($G(PSJPRI)="D":1,PSJY="P":0,PSJOL="L":1,1:"DPE"'[PSJY) S ON=+PSJORD_"V" D IVSET K PSJPRI,ON
"RTN","PSJO1",67,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJO1",68,0)
 D ENUNM
"RTN","PSJO1",69,0)
 I PSJPTYP'=2 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJO1",70,0)
 Q:$D(PSGONNV)
"RTN","PSJO1",71,0)
 ;I PSJPTYP'=2 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",72,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",73,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S O=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",74,0)
 N PRNTON S (PRNTON,O)=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",75,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJO1",76,0)
 Q
"RTN","PSJO1",77,0)
 ;
"RTN","PSJO1",78,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJO1",79,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJO1",80,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",81,0)
 I $P(ND,U,15),$G(PSGP) I PSGP'=$P(ND,U,15) D  Q
"RTN","PSJO1",82,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",83,0)
 I $P(ND,U,9)["D" D  Q
"RTN","PSJO1",84,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",85,0)
 .N ND2 S ND2=$G(^PS(53.1,O,.2)) I $P(ND2,U,8) K ^PS(53.1,"ACX",$P(ND2,U,8))
"RTN","PSJO1",86,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJO1",87,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJO1",88,0)
 ;I C="CC" S C=$$CKPC^PSGOU(PSGP,+$P($G(^PS(53.1,O,0)),U,25),O)
"RTN","PSJO1",89,0)
 D SET
"RTN","PSJO1",90,0)
 Q
"RTN","PSJO1",91,0)
 ;
"RTN","PSJO1",92,0)
KILL ;
"RTN","PSJO1",93,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJO1",94,0)
 Q
"RTN","PSJO1",95,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJO1",96,0)
 S OK=0
"RTN","PSJO1",97,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJO1",98,0)
 I PSJCOM=""  Q OK
"RTN","PSJO1",99,0)
 I PSJPTYP="" Q OK
"RTN","PSJO1",100,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJO1",101,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJO1",102,0)
 N PSJON S PSJON=""
"RTN","PSJO1",103,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJO1",104,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",9)["D" K ^PS(53.1,"ACX",PSJCOM)
"RTN","PSJO1",105,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJO1",106,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJO1",107,0)
 Q OK
"RTN","PSJOE0")
0^2^B27948190^B27877210
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ;17 SEP 97 /  1:41 PM
"RTN","PSJOE0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,56,110,133,162**;16 DEC 97
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 ;G:X="^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",16,0)
 K PSJDLW
"RTN","PSJOE0",17,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",18,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",19,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",21,0)
 Q
"RTN","PSJOE0",22,0)
 ;
"RTN","PSJOE0",23,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",24,0)
 ; PSGP = DFN
"RTN","PSJOE0",25,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",26,0)
 ;
"RTN","PSJOE0",27,0)
 ;S VALM("BM")=9 D CKNEW
"RTN","PSJOE0",28,0)
 D CKNEW N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",29,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",30,0)
 I PSGOEPR>0,$D(^VA(200,+PSGOEPR,"PS")) S PSGOEPR=$S('$P(^("PS"),"^",4):PSGOEPR,($P(^("PS"),"^",4)<DT):0,1:PSGOEPR)
"RTN","PSJOE0",31,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",32,0)
 ;* F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1,(+PSJSYSU=3) D ENIN^PSIVORE
"RTN","PSJOE0",33,0)
 ;F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",34,0)
 ; line below fixes bug in line above - infinite loop when selecting New Order in Unit Dose OE for Outpatient.
"RTN","PSJOE0",35,0)
 F PSJOE=0:0 Q:PSJORQF!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",36,0)
 Q
"RTN","PSJOE0",37,0)
 ;
"RTN","PSJOE0",38,0)
DONE ;
"RTN","PSJOE0",39,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",40,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",41,0)
 Q
"RTN","PSJOE0",42,0)
 ;
"RTN","PSJOE0",43,0)
CKNEW ;
"RTN","PSJOE0",44,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSGORD,PSJCOM,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",45,0)
 I $P(PSJPDD,"^",3) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." D CONT Q
"RTN","PSJOE0",46,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",47,0)
 Q
"RTN","PSJOE0",48,0)
 ;
"RTN","PSJOE0",49,0)
CONT ;
"RTN","PSJOE0",50,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",51,0)
 Q
"RTN","PSJOE0",52,0)
 ;
"RTN","PSJOE0",53,0)
GODO ;Display selected order.
"RTN","PSJOE0",54,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",55,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",56,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",57,0)
GODO1 ;
"RTN","PSJOE0",58,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",59,0)
 Q
"RTN","PSJOE0",60,0)
 ;
"RTN","PSJOE0",61,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",62,0)
 Q
"RTN","PSJOE0",63,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",64,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",65,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",66,0)
 Q
"RTN","PSJOE0",67,0)
 ;
"RTN","PSJOE0",68,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",69,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",70,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",71,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",72,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",73,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",74,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",75,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",76,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",77,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",78,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",79,0)
 Q
"RTN","PSJOE0",80,0)
AM ;
"RTN","PSJOE0",81,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",82,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"VER")
8.0^22.0
"BLD",6115,6)
^160
**END**
**END**
