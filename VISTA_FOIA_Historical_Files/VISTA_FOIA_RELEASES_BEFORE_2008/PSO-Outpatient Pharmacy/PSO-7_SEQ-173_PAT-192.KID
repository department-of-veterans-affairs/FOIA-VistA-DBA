Released PSO*7*192 SEQ #173
Extracted from mail message
**KIDS**:PSO*7.0*192^

**INSTALL NAME**
PSO*7.0*192
"BLD",1073,0)
PSO*7.0*192^OUTPATIENT PHARMACY^0^3050103^y
"BLD",1073,1,0)
^^1^1^3041101^
"BLD",1073,1,1,0)
SPELLING ERROR AND QUANTITY CHANGING
"BLD",1073,4,0)
^9.64PA^^
"BLD",1073,"KRN",0)
^9.67PA^8989.52^19
"BLD",1073,"KRN",.4,0)
.4
"BLD",1073,"KRN",.401,0)
.401
"BLD",1073,"KRN",.402,0)
.402
"BLD",1073,"KRN",.403,0)
.403
"BLD",1073,"KRN",.5,0)
.5
"BLD",1073,"KRN",.84,0)
.84
"BLD",1073,"KRN",3.6,0)
3.6
"BLD",1073,"KRN",3.8,0)
3.8
"BLD",1073,"KRN",9.2,0)
9.2
"BLD",1073,"KRN",9.8,0)
9.8
"BLD",1073,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",1073,"KRN",9.8,"NM",2,0)
PSODRDU1^^0^B49529859
"BLD",1073,"KRN",9.8,"NM",3,0)
PSOCPDUP^^0^B34697632
"BLD",1073,"KRN",9.8,"NM",4,0)
PSODRDUP^^0^B44260935
"BLD",1073,"KRN",9.8,"NM","B","PSOCPDUP",3)

"BLD",1073,"KRN",9.8,"NM","B","PSODRDU1",2)

"BLD",1073,"KRN",9.8,"NM","B","PSODRDUP",4)

"BLD",1073,"KRN",19,0)
19
"BLD",1073,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1073,"KRN",19,"NM",1,0)
PSO INTERVENTION NEW ENTRY^^0
"BLD",1073,"KRN",19,"NM","B","PSO INTERVENTION NEW ENTRY",1)

"BLD",1073,"KRN",19.1,0)
19.1
"BLD",1073,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",1073,"KRN",101,0)
101
"BLD",1073,"KRN",409.61,0)
409.61
"BLD",1073,"KRN",771,0)
771
"BLD",1073,"KRN",870,0)
870
"BLD",1073,"KRN",8989.51,0)
8989.51
"BLD",1073,"KRN",8989.52,0)
8989.52
"BLD",1073,"KRN",8994,0)
8994
"BLD",1073,"KRN","B",.4,.4)

"BLD",1073,"KRN","B",.401,.401)

"BLD",1073,"KRN","B",.402,.402)

"BLD",1073,"KRN","B",.403,.403)

"BLD",1073,"KRN","B",.5,.5)

"BLD",1073,"KRN","B",.84,.84)

"BLD",1073,"KRN","B",3.6,3.6)

"BLD",1073,"KRN","B",3.8,3.8)

"BLD",1073,"KRN","B",9.2,9.2)

"BLD",1073,"KRN","B",9.8,9.8)

"BLD",1073,"KRN","B",19,19)

"BLD",1073,"KRN","B",19.1,19.1)

"BLD",1073,"KRN","B",101,101)

"BLD",1073,"KRN","B",409.61,409.61)

"BLD",1073,"KRN","B",771,771)

"BLD",1073,"KRN","B",870,870)

"BLD",1073,"KRN","B",8989.51,8989.51)

"BLD",1073,"KRN","B",8989.52,8989.52)

"BLD",1073,"KRN","B",8994,8994)

"BLD",1073,"QUES",0)
^9.62^^
"BLD",1073,"REQB",0)
^9.611^1^1
"BLD",1073,"REQB",1,0)
PSO*7.0*132^2
"BLD",1073,"REQB","B","PSO*7.0*132",1)

"KRN",19,987,-1)
0^1
"KRN",19,987,0)
PSO INTERVENTION NEW ENTRY^Enter Pharmacy Intervention^^A^^PSORPH^PSO ENTER INTERVENTION^^^^^OUTPATIENT PHARMACY^^1^1
"KRN",19,987,1,0)
^^1^1^2930114^^^^
"KRN",19,987,1,1,0)
This option is used to enter an entry into the APSP INTERVENTION file.
"KRN",19,987,15)
K DLAYGO
"KRN",19,987,20)
W @IOF W !!,"Enter Pharmacy Intervention",!! F  S DIC(0)="QEMAL",DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIADD="" D ^DIC K DA,DR,DIADD K:Y=-1 X,DIC,DIADD,DA,DIE Q:Y=-1  S DA=+Y,DIE=DIC,DR="[PSO INTERVENTION NEW]" K DIC D ^DIE
"KRN",19,987,"U")
ENTER PHARMACY INTERVENTION
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
7.0^3011218^2980805^5
"PKG",16,22,1,"PAH",1,0)
192^3050103
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3050103
"PKG",16,22,1,"PAH",1,1,1,0)
SPELLING ERROR AND QUANTITY CHANGING
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSOCPDUP")
0^3^B34697632
"RTN","PSOCPDUP",1,0)
PSOCPDUP ;BIR/SAB - Dup drug and class checker for copy orders ;1/3/05 11:34am
"RTN","PSOCPDUP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,130,132,192**;DEC 1997
"RTN","PSOCPDUP",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCPDUP",4,0)
 S $P(PSONULN,"-",79)="-",(STA,DNM)=""
"RTN","PSOCPDUP",5,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""  D  Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",6,0)
 .I STA="PENDING" D ^PSODRDU1 Q
"RTN","PSOCPDUP",7,0)
 .I STA="ZNONVA" D NVA^PSODRDU1 Q
"RTN","PSOCPDUP",8,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",9,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",10,0)
 ..I $P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",11,0)
 ..I '$P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP
"RTN","PSOCPDUP",12,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",13,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(PSOSD(STA,DNM),"^",5),1,4),PSODRUG("NAME")'=$P(DNM,"^") S PSOCPCLS=1 D CLS K PSOCPCLS
"RTN","PSOCPDUP",14,0)
 G EXIT
"RTN","PSOCPDUP",15,0)
DOSE ;I '$D(PSOCLOZ) G EXIT
"RTN","PSOCPDUP",16,0)
 S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","PSOCPDUP",17,0)
 S PSOCD=X
"RTN","PSOCPDUP",18,0)
 I PSOCD#25=0,PSOCD'<12.5,PSOCD<900 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT) G EXIT
"RTN","PSOCPDUP",19,0)
 I PSOCD#12.5 S DIR(0)="Y",DIR("B")="NO",DIR("A")=PSOCD_" is an unusual dose.  Are you sure " D ^DIR K DIR G EXIT:$D(DTOUT),EXIT:$D(DUOUT) I X'="Y" G DOSE
"RTN","PSOCPDUP",20,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" "
"RTN","PSOCPDUP",21,0)
 I PSOCD>900 S DIR(0)="Y",DIR("A")="Recommended maximum daily dose is 900. Are you sure " D ^DIR K DIR G EXIT:$D(DTOUT),EXIT:$D(DUOUT) I X'="Y" G DOSE
"RTN","PSOCPDUP",22,0)
 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT)
"RTN","PSOCPDUP",23,0)
EXIT D ^PSOBUILD K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSOCPDUP",24,0)
 Q
"RTN","PSOCPDUP",25,0)
DUP S:$P(PSOSD(STA,DNM),"^",2)<10!($P(PSOSD(STA,DNM),"^",2)=16) DUP=1 W !,PSONULN,!,$C(7),"DUPLICATE DRUG "_$P(DNM,"^")_" in Prescription: ",$P(^PSRX(+PSOSD(STA,DNM),0),"^")
"RTN","PSOCPDUP",26,0)
 S RXREC=+PSOSD(STA,DNM),MSG="Discontinued During Prescription Entry COPY - Duplicate Drug"
"RTN","PSOCPDUP",27,0)
DATA S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),SIG=$P($G(^PSRX(RXREC,"SIG")),"^"),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSOCPDUP",28,0)
 W !!,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSOCPDUP",29,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSOCPDUP",30,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSOCPDUP",31,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSOCPDUP",32,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSOCPDUP",33,0)
 K BSIG,PSREV
"RTN","PSOCPDUP",34,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOCPDUP",35,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSOCPDUP",36,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSOCPDUP",37,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" Q
"RTN","PSOCPDUP",38,0)
ASKCAN I $P(PSOSD(STA,DNM),"^",2)>10,$P(PSOSD(STA,DNM),"^",2)'=16 Q
"RTN","PSOCPDUP",39,0)
 I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOCPDUP",40,0)
 I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOCPDUP",41,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(DUP) W !!,"Prescription "_$S(+$G(PSOSD(STA,DNM)):$P($G(^PSRX(+$G(PSOSD(STA,DNM)),0)),"^")_" ",1:"")_"is on Provider Hold, it cannot be discontinued.",! D  Q
"RTN","PSOCPDUP",42,0)
 .S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DUP
"RTN","PSOCPDUP",43,0)
 I $G(PSOCPCLS),$G(RXRECCOP) D PSOL^PSSLOCK(RXRECCOP) I '$G(PSOMSG) D  K PSOMSG,DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSOCPDUP",44,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2) Q
"RTN","PSOCPDUP",45,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX(RXRECCOP,0)),"^")
"RTN","PSOCPDUP",46,0)
 K PSOMSG S DIR("A")="Discontinue Rx # "_$P(^PSRX(+PSOSD(STA,DNM),0),"^"),DIR(0)="Y",DIR("?")="Enter Y to discontinue this Rx."
"RTN","PSOCPDUP",47,0)
 D ^DIR K DIR S DA=RXREC S ACT="Discontinued while entering new Rx"
"RTN","PSOCPDUP",48,0)
 I 'Y W $C(7)," -Prescription was not discontinued..." S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA="C" S:$G(DUP) PSORX("DFLG")=1 K DUP,CLS D  Q
"RTN","PSOCPDUP",49,0)
 .I $D(^TMP("PSORXDC",$J,RXREC,0)) K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSOCPDUP",50,0)
 .D:$G(PSOCPCLS) ULRX
"RTN","PSOCPDUP",51,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(CLS) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! D ULRX K CLS,DUP,RXRECLOC S PSORX("DFLG")=1 H 2 Q
"RTN","PSOCPDUP",52,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New Rx Entry - DUPLICATE RX"),REA="C"
"RTN","PSOCPDUP",53,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",!
"RTN","PSOCPDUP",54,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D"
"RTN","PSOCPDUP",55,0)
 K CLS,DUP,PSOCPCLS Q
"RTN","PSOCPDUP",56,0)
CLS K DUP S CLS=1,MSG="Discontinued During New Prescription Entry - Duplicate Class" W !,PSONULN
"RTN","PSOCPDUP",57,0)
 W !?5,$C(7),"*** SAME CLASS *** OF DRUG IN RX #"_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" FOR "_$P(DNM,"^"),!,"CLASS: "_PSODRUG("VA CLASS")
"RTN","PSOCPDUP",58,0)
 S CAN=$P(PSOSD(STA,DNM),"^",2)'<11!($P(PSOSD(STA,DNM),"^",2)=1) S (RXREC,RXRECCOP)=+PSOSD(STA,DNM) S PSOELSE=$P(PSOPAR,"^",10) I PSOELSE D DATA
"RTN","PSOCPDUP",59,0)
 I 'PSOELSE S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSOCPDUP",60,0)
 K PSOELSE,RXRECCOP Q
"RTN","PSOCPDUP",61,0)
ULRX ;
"RTN","PSOCPDUP",62,0)
 I '$G(RXRECCOP) Q
"RTN","PSOCPDUP",63,0)
 D PSOUL^PSSLOCK(RXRECCOP)
"RTN","PSOCPDUP",64,0)
 Q
"RTN","PSODRDU1")
0^2^B49529859
"RTN","PSODRDU1",1,0)
PSODRDU1 ;BIR/SAB - dup drug class checker for pending orders ;1/3/05 11:33am
"RTN","PSODRDU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,27,32,56,63,130,132,192**;DEC 1997
"RTN","PSODRDU1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODRDU1",4,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSODRDU1",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSODRDU1",6,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODRDU1",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSODRDU1",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODRDU1",9,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODRDU1",10,0)
 S RXREC=$P(PSOSD(STA,DNM),"^",10)
"RTN","PSODRDU1",11,0)
 Q:'$D(^PS(52.41,RXREC,0))
"RTN","PSODRDU1",12,0)
 Q:$P($G(^PS(52.41,RXREC,0)),"^",3)="RF"
"RTN","PSODRDU1",13,0)
 I $G(ORD) D  K FSIG Q
"RTN","PSODRDU1",14,0)
 .D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^"))&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",15,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",16,0)
 ..I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",17,0)
 ..I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",18,0)
 .I $D(^XUSEC("PSORPH",DUZ)) D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^")) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",19,0)
 .I $G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^"),ORD'=RXREC D CLS
"RTN","PSODRDU1",20,0)
 ;backdoor orders
"RTN","PSODRDU1",21,0)
 Q:'$P($G(^PS(52.41,RXREC,0)),"^",9)
"RTN","PSODRDU1",22,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  I $G(PSORX("DFLG")) K FSIG Q
"RTN","PSODRDU1",23,0)
 .I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",24,0)
 .I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",25,0)
 .I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",26,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",27,0)
 I $G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^") D CLS
"RTN","PSODRDU1",28,0)
 K FSIG Q
"RTN","PSODRDU1",29,0)
DUP S DUP=1 W !,PSONULN,!,$C(7),"DUPLICATE DRUG "_$P(DNM,"^")_" in a Pending Order"
"RTN","PSODRDU1",30,0)
 S MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug."
"RTN","PSODRDU1",31,0)
DATA S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODRDU1",32,0)
 S RXRECLOD=RXREC
"RTN","PSODRDU1",33,0)
 W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU1",34,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU1",35,0)
 W !,"Instructions: " S TY=2 D INST
"RTN","PSODRDU1",36,0)
 D FSIG^PSOUTLA("P",RXREC,IOM-6)
"RTN","PSODRDU1",37,0)
 W !,"SIG: " F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I),!?5
"RTN","PSODRDU1",38,0)
 W !,"Routing: "_$S($P(DUPRX0,"^",17)="W":"WINDOW",1:"MAIL"),?30,"Quantity: "_$P(DUPRX0,"^",10),!,"# of Refills: "_$P(DUPRX0,"^",11)
"RTN","PSODRDU1",39,0)
 W ?30,"Patient Status: SC",!,"Patient Location: "_$S($P(DUPRX0,"^",13):$P($G(^SC($P(DUPRX0,"^",13),0)),"^"),1:""),!,"Med Route: "_$P($G(^PS(51.2,+$P(DUPRX0,"^",15),0)),"^"),?30,"Provider: "_$P(^VA(200,$P(DUPRX0,"^",5),0),"^")
"RTN","PSODRDU1",40,0)
 S Y=$P(DUPRX0,"^",6) X ^DD("DD") W !,"Issue Date: "_Y
"RTN","PSODRDU1",41,0)
 W !,"Provider Comments: " S TY=3 D INST
"RTN","PSODRDU1",42,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOD Q
"RTN","PSODRDU1",43,0)
ASKCAN D PSOL^PSSLOCK(RXRECLOD_"S") I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOD S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODRDU1",44,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODRDU1",45,0)
 .W !!,"Another person is editing this pending order.",!
"RTN","PSODRDU1",46,0)
 K PSOMSG S DIR("A")="Discontinue Pending Order",DIR(0)="Y",DIR("?")="Enter Y to Discontinue this pending order."
"RTN","PSODRDU1",47,0)
 D ^DIR K DIR
"RTN","PSODRDU1",48,0)
 I 'Y W $C(7)," -Pending Order was not discontinued..." S:$G(DUP) PSORX("DFLG")=1 K DUP,CLS D ULPN Q
"RTN","PSODRDU1",49,0)
 S ACT="Discontinued while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX"
"RTN","PSODRDU1",50,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",! H 2
"RTN","PSODRDU1",51,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="P^"_RXREC_"^"_MSG
"RTN","PSODRDU1",52,0)
 K CLS,DUP,PSOSD(STA,DNM) Q
"RTN","PSODRDU1",53,0)
CLS K DUP
"RTN","PSODRDU1",54,0)
 I $E($G(PSODRUG("VA CLASS")),1,2)="HA",$E($P($G(PSOSD(STA,DNM)),"^",5),1,2)="HA" K CLS,DUP,PSOELSE Q
"RTN","PSODRDU1",55,0)
 S MSG="  Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Class." W !,PSONULN
"RTN","PSODRDU1",56,0)
 W !,$C(7),"*** SAME CLASS *** of drug in a Pending Order for "_$P(DNM,"^"),!,"Class: "_$G(PSODRUG("VA CLASS"))
"RTN","PSODRDU1",57,0)
 S CLS=1 I $P($G(PSOPAR),"^",10) D DATA Q
"RTN","PSODRDU1",58,0)
 E  S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSODRDU1",59,0)
 K CLS,DUP,PSOELSE Q
"RTN","PSODRDU1",60,0)
INST ;displays instruction and/or comments
"RTN","PSODRDU1",61,0)
 S INST=0 F  S INST=$O(^PS(52.41,RXREC,TY,INST)) Q:'INST  S MIG=^PS(52.41,RXREC,TY,INST,0) D
"RTN","PSODRDU1",62,0)
 .F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM @$S(TY=3:"!?14",1:"!?19") W $P(MIG," ",SG)_" "
"RTN","PSODRDU1",63,0)
 K INST,TY,MIG,SG
"RTN","PSODRDU1",64,0)
 Q
"RTN","PSODRDU1",65,0)
ULPN ;
"RTN","PSODRDU1",66,0)
 I '$G(RXRECLOD) Q
"RTN","PSODRDU1",67,0)
 D PSOUL^PSSLOCK(RXRECLOD_"S") K RXRECLOD
"RTN","PSODRDU1",68,0)
 Q
"RTN","PSODRDU1",69,0)
NVA ;displays duplicate drugs and classes for non-va meds
"RTN","PSODRDU1",70,0)
 I $G(IT) D  Q
"RTN","PSODRDU1",71,0)
 .S SER=$P($G(^PS(56,IT,0)),"^",4)
"RTN","PSODRDU1",72,0)
 .W "***"_$S(SER=1:"Critical",1:"Significant")_"*** Drug Interaction with a Non-VA Med Order.",!,"Drug: "_$P(DNM,"^")
"RTN","PSODRDU1",73,0)
 .K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODRDU1",74,0)
 Q:'$D(^PS(55,PSODFN,"NVA",$P(PSOSD(STA,DNM),"^",10),0))
"RTN","PSODRDU1",75,0)
 S IFN=$P(PSOSD(STA,DNM),"^",10),RXREC=IFN
"RTN","PSODRDU1",76,0)
 I '$G(IT),$G(PSODRUG("NAME"))=$P(DNM,"^") D DSP Q
"RTN","PSODRDU1",77,0)
 I '$G(IT),$G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^") D DSP
"RTN","PSODRDU1",78,0)
 Q
"RTN","PSODRDU1",79,0)
DSP S $P(PSONULN,"-",79)="-"
"RTN","PSODRDU1",80,0)
 W !,PSONULN,!,$C(7),"Duplicate Drug "_$S($G(PSODRUG("NAME"))=$P(DNM,"^"):$P(DNM,"^"),1:"Class "_$G(PSODRUG("VA CLASS")))_" in a Non-VA Med Order.",!
"RTN","PSODRDU1",81,0)
 S DUPRX0=^PS(55,PSODFN,"NVA",RXREC,0)
"RTN","PSODRDU1",82,0)
 W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU1",83,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU1",84,0)
 W !,"Drug Class: "_$G(PSODRUG("VA CLASS"))
"RTN","PSODRDU1",85,0)
 W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSODRDU1",86,0)
 W !,"Schedule: "_$P(DUPRX0,"^",5),?40,"Medication Route: "_$P(DUPRX0,"^",4)
"RTN","PSODRDU1",87,0)
 W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Order #: "_$P(DUPRX0,"^",8)
"RTN","PSODRDU1",88,0)
 W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSODRDU1",89,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I)) Q:'I  D  W !
"RTN","PSODRDU1",90,0)
 .S ORD1=$P(^PS(55,PSODFN,"NVA",IFN,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSODRDU1",91,0)
 .W !,"Order Check #"_I_": "
"RTN","PSODRDU1",92,0)
 .K OCK,LEN I $L(ORD1)>70 S (LEN,IEN)=1 D
"RTN","PSODRDU1",93,0)
 ..F SG=1:1:$L(ORD1) S:$L($G(OCK(IEN))_" "_$P(ORD1," ",SG))>75&($P(ORD1," ",SG)]"") IEN=IEN+1 S:$P(ORD1," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD1," ",SG)
"RTN","PSODRDU1",94,0)
 ..F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU1",95,0)
 .W:'$G(LEN) ORD1 K LEN,SG,IEN,II,OCK,ORD1
"RTN","PSODRDU1",96,0)
 .W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSODRDU1",97,0)
 .K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS,0)
"RTN","PSODRDU1",98,0)
 .S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSODRDU1",99,0)
 ..F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>70&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSODRDU1",100,0)
 ..K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSODRDU1",101,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",IFN,"DSC",SS,0)
"RTN","PSODRDU1",102,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSODRDU1",103,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>70&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSODRDU1",104,0)
 ..K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU1",105,0)
 W !,PSONULN,!
"RTN","PSODRDU1",106,0)
 K RX3,LSTFL,PSONULN,ISSD,J,LSTFD,PHYS,ST,TRM,DUPRX0,FL,FSIG,I,IFN,RFLS,RXREC,X,Y,IEN,DSC,REA,OCK,ORD1
"RTN","PSODRDU1",107,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODRDU1",108,0)
 Q
"RTN","PSODRDUP")
0^4^B44260935
"RTN","PSODRDUP",1,0)
PSODRDUP ;BIR/SAB - Dup drug class checker ;11/1/04 3:38pm
"RTN","PSODRDUP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,39,56,130,132,192**;DEC 1997
"RTN","PSODRDUP",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODRDUP",4,0)
 S $P(PSONULN,"-",79)="-",(STA,DNM)="" K CLS
"RTN","PSODRDUP",5,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""!$G(PSORX("DFLG"))  I $P(PSOSD(STA,DNM),"^")'=$G(PSORENW("OIRXN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",6,0)
 .I STA="PENDING" D ^PSODRDU1 Q
"RTN","PSODRDUP",7,0)
 .I STA="ZNONVA" D NVA^PSODRDU1 Q
"RTN","PSODRDUP",8,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",9,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",10,0)
 ..I $P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",11,0)
 ..I '$P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP
"RTN","PSODRDUP",12,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",13,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(PSOSD(STA,DNM),"^",5),1,4),PSODRUG("NAME")'=$P(DNM,"^") D CLS
"RTN","PSODRDUP",14,0)
 G EXIT
"RTN","PSODRDUP",15,0)
DOSE ;I '$D(PSOCLOZ) G EXIT
"RTN","PSODRDUP",16,0)
 S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S (ANQX,ANQNO)=1 G EXIT
"RTN","PSODRDUP",17,0)
 S PSOCD=X
"RTN","PSODRDUP",18,0)
 I PSOCD#25=0,PSOCD'<12.5,PSOCD<900 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT) G EXIT
"RTN","PSODRDUP",19,0)
 I PSOCD#12.5 S DIR(0)="Y",DIR("B")="NO",DIR("A")=PSOCD_" is an unusual dose.  Are you sure " D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSODRDUP",20,0)
 I PSOCD>900 S DIR(0)="Y",DIR("A")="Recommended maximum daily dose is 900. Are you sure " D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSODRDUP",21,0)
 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT)
"RTN","PSODRDUP",22,0)
EXIT D ^PSOBUILD K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXN,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSODRDUP",23,0)
 Q
"RTN","PSODRDUP",24,0)
DUP S:$P(PSOSD(STA,DNM),"^",2)<10!($P(PSOSD(STA,DNM),"^",2)=16) DUP=1 W !,PSONULN,!,$C(7),"Duplicate Drug "_$P(DNM,"^")_" in Prescription: ",$P(^PSRX(+PSOSD(STA,DNM),0),"^")
"RTN","PSODRDUP",25,0)
 S RXREC=+PSOSD(STA,DNM),MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug"
"RTN","PSODRDUP",26,0)
DATA S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODRDUP",27,0)
 S RXRECLOC=$G(RXREC)
"RTN","PSODRDUP",28,0)
 W !!,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODRDUP",29,0)
 S DA=RXREC D ^PSOCMOPA I $G(PSOCMOP)]"" D  K CMOP,PSOTRANS,PSOREL
"RTN","PSODRDUP",30,0)
 .S PSOTRANS=$E($P(PSOCMOP,"^",2),4,5)_"/"_$E($P(PSOCMOP,"^",2),6,7)_"/"_$E($P(PSOCMOP,"^",2),2,3)
"RTN","PSODRDUP",31,0)
 .S PSOREL=$S(CMOP("L")=0:$P($G(^PSRX(DA,2)),"^",13),1:$P(^PSRX(DA,1,CMOP("L"),0),"^",18))
"RTN","PSODRDUP",32,0)
 .S PSOREL=$E(PSOREL,4,5)_"/"_$E(PSOREL,6,7)_"/"_$E(PSOREL,2,3)_"@"_$E($P(PSOREL,".",2),1,4)
"RTN","PSODRDUP",33,0)
 .W !,$J("CMOP Status: ",24)_$S($P(PSOCMOP,"^")=0!($P(PSOCMOP,"^")=2):"Transmitted to on "_PSOTRANS,$P(PSOCMOP,"^")=1:"Released by CMOP on "_PSOREL,1:"Not Dispensed")
"RTN","PSODRDUP",34,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODRDUP",35,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSODRDUP",36,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSODRDUP",37,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSODRDUP",38,0)
 K BSIG,PSREV
"RTN","PSODRDUP",39,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSODRDUP",40,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSODRDUP",41,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSODRDUP",42,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOC Q
"RTN","PSODRDUP",43,0)
ASKCAN I $P(PSOSD(STA,DNM),"^",2)>10,$P(PSOSD(STA,DNM),"^",2)'=16 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT,RXRECLOC Q
"RTN","PSODRDUP",44,0)
 I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODRDUP",45,0)
 I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODRDUP",46,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(DUP) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! K DUP,RXRECLOC S PSORX("DFLG")=1 Q
"RTN","PSODRDUP",47,0)
 D PSOL^PSSLOCK(RXRECLOC) I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOC S DIR("A")="Press Return to continue",DIR(0)="E" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODRDUP",48,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODRDUP",49,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX(RXRECLOC,0)),"^"),!
"RTN","PSODRDUP",50,0)
 K PSOMSG S DIR("A")=$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstate",1:"Discontinue")_" RX # "_$P(^PSRX(+PSOSD(STA,DNM),0),"^"),DIR(0)="Y",DIR("?")="Enter Y to "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstate",1:"discontinue")_" this RX."
"RTN","PSODRDUP",51,0)
 D ^DIR K DIR S DA=RXREC S ACT=$S($D(SPCANC):"Reinstated during Rx cancel.",1:$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstated",1:"Discontinued")_" while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX")
"RTN","PSODRDUP",52,0)
 D CMOP^PSOUTL I $G(CMOP("S"))="L" W !,"A CMOP Rx cannot be discontinued during transmission!",! S Y=0 K CMOP
"RTN","PSODRDUP",53,0)
 I 'Y W $C(7)," -Prescription was not "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstated",1:"discontinued")_"..." D  Q
"RTN","PSODRDUP",54,0)
 .S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C") S:$G(DUP) PSORX("DFLG")=1 K DUP D ULRX K RXRECLOC
"RTN","PSODRDUP",55,0)
 .I $D(^TMP("PSORXDC",$J,RXREC,0)) K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSODRDUP",56,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(CLS) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! D ULRX K CLS,DUP,RXRECLOC S PSORX("DFLG")=1 H 2 Q
"RTN","PSODRDUP",57,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New RX "_$S('$G(PSONV):"Entry",1:"Verification")_" - Duplicate Rx"),REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C")
"RTN","PSODRDUP",58,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",!
"RTN","PSODRDUP",59,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D"
"RTN","PSODRDUP",60,0)
 K RXRECLOC,DUP,CLS,PSONOOR Q
"RTN","PSODRDUP",61,0)
CLS K DUP
"RTN","PSODRDUP",62,0)
 I $E($G(PSODRUG("VA CLASS")),1,2)="HA",$E($P($G(PSOSD(STA,DNM)),"^",5),1,2)="HA" K PSOELSE Q
"RTN","PSODRDUP",63,0)
 S CLS=1,MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Class" W !,PSONULN
"RTN","PSODRDUP",64,0)
 W !?5,$C(7),"*** SAME CLASS *** OF DRUG IN RX #"_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" FOR "_$P(DNM,"^"),!,"CLASS: "_PSODRUG("VA CLASS")
"RTN","PSODRDUP",65,0)
 S CAN=$P(PSOSD(STA,DNM),"^",2)'<11!($P(PSOSD(STA,DNM),"^",2)=1) S RXREC=+PSOSD(STA,DNM) I $P($G(PSOPAR),"^",10) D DATA Q
"RTN","PSODRDUP",66,0)
 E  W !,PSONULN K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSODRDUP",67,0)
 K PSOELSE Q
"RTN","PSODRDUP",68,0)
ULRX ;
"RTN","PSODRDUP",69,0)
 I '$G(RXRECLOC) Q
"RTN","PSODRDUP",70,0)
 D PSOUL^PSSLOCK(RXRECLOC)
"RTN","PSODRDUP",71,0)
 Q
"VER")
8.0^22.0
**END**
**END**
