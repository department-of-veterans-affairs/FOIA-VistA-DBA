Released PSJ*5*112 SEQ #122
Extracted from mail message
**KIDS**:PSJ*5.0*112^

**INSTALL NAME**
PSJ*5.0*112
"BLD",5024,0)
PSJ*5.0*112^INPATIENT MEDICATIONS^0^3050302^y
"BLD",5024,1,0)
^^30^30^3050214^
"BLD",5024,1,1,0)
1. A request has been made to allow sites to define inpatient orders for 
"BLD",5024,1,2,0)
outpatients' behavior on a clinic-by-clinic basis. The two changes would 
"BLD",5024,1,3,0)
add the ability to control auto-dc of orders and whether or not they
"BLD",5024,1,4,0)
appear in the Bar Code Medication Administration V. 3.0 package. This
"BLD",5024,1,5,0)
patch helps to accomplish this goal by doing the following:
"BLD",5024,1,6,0)
 
"BLD",5024,1,7,0)
a. Rename the CLINIC STOP DATES file (#53.46) to be the CLINIC DEFINITION 
"BLD",5024,1,8,0)
   file (#53.46).
"BLD",5024,1,9,0)
b. Add the AUTO-DC IMO ORDERS field (#2) and the SEND TO BCMA? field (#3) 
"BLD",5024,1,10,0)
   to the CLINIC DEFINITION file (#53.46).
"BLD",5024,1,11,0)
c. Remove the Clinic Stop Dates option [PSJ CSD].
"BLD",5024,1,12,0)
d. Add the Clinic Definition option [PSJ CD].
"BLD",5024,1,13,0)
 
"BLD",5024,1,14,0)
2. A problem was reported with inpatient orders for outpatients 
"BLD",5024,1,15,0)
displaying in the incorrect display group on the Orders tab in the 
"BLD",5024,1,16,0)
Computerized Patient Record System (CPRS) V. 1.0. This patch corrects this
"BLD",5024,1,17,0)
problem by modifying the HL7 messaging as well as the order editing 
"BLD",5024,1,18,0)
process to correctly define the appointment date and time for the
"BLD",5024,1,19,0)
inpatient order.
"BLD",5024,1,20,0)
 
"BLD",5024,1,21,0)
3. It was discovered during internal review that the STAT NOW MAIL GROUP 
"BLD",5024,1,22,0)
field (#5) of the INPATIENT WARD PARAMETERS file (#59.6) had been omitted 
"BLD",5024,1,23,0)
from the appropriate distribution. This patch corrects this problem by 
"BLD",5024,1,24,0)
exporting the field.
"BLD",5024,1,25,0)
 
"BLD",5024,1,26,0)
4. A problem was identified with the display order on the meds tab in 
"BLD",5024,1,27,0)
CPRS. The problem was related to information being passed from Inpatient 
"BLD",5024,1,28,0)
Medications V. 5.0 to identify inpatient orders for outpatients. This 
"BLD",5024,1,29,0)
patch corrects this problem by modifying the data pass to CPRS.
"BLD",5024,1,30,0)
NOIS: WAS-0205-20562
"BLD",5024,4,0)
^9.64PA^53.46^2
"BLD",5024,4,53.46,0)
53.46
"BLD",5024,4,53.46,222)
y^y^f^^^^n
"BLD",5024,4,59.6,0)
59.6
"BLD",5024,4,59.6,2,0)
^9.641^59.6^1
"BLD",5024,4,59.6,2,59.6,0)
INPATIENT WARD PARAMETERS  (File-top level)
"BLD",5024,4,59.6,2,59.6,1,0)
^9.6411^5^1
"BLD",5024,4,59.6,2,59.6,1,5,0)
STAT NOW MAIL GROUP
"BLD",5024,4,59.6,222)
y^y^p^^^^n^^n
"BLD",5024,4,59.6,224)

"BLD",5024,4,"APDD",59.6,59.6)

"BLD",5024,4,"APDD",59.6,59.6,5)

"BLD",5024,4,"B",53.46,53.46)

"BLD",5024,4,"B",59.6,59.6)

"BLD",5024,"ABPKG")
n
"BLD",5024,"KRN",0)
^9.67PA^8989.52^19
"BLD",5024,"KRN",.4,0)
.4
"BLD",5024,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5024,"KRN",.401,0)
.401
"BLD",5024,"KRN",.402,0)
.402
"BLD",5024,"KRN",.403,0)
.403
"BLD",5024,"KRN",.5,0)
.5
"BLD",5024,"KRN",.84,0)
.84
"BLD",5024,"KRN",3.6,0)
3.6
"BLD",5024,"KRN",3.8,0)
3.8
"BLD",5024,"KRN",9.2,0)
9.2
"BLD",5024,"KRN",9.8,0)
9.8
"BLD",5024,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",5024,"KRN",9.8,"NM",1,0)
PSJADT0^^0^B30883610
"BLD",5024,"KRN",9.8,"NM",2,0)
PSGFILED^^0^B24308978
"BLD",5024,"KRN",9.8,"NM",3,0)
PSJBCMA^^0^B62444725
"BLD",5024,"KRN",9.8,"NM",4,0)
PSJHL2^^0^B31037084
"BLD",5024,"KRN",9.8,"NM",5,0)
PSJORRE^^0^B30514336
"BLD",5024,"KRN",9.8,"NM",6,0)
PSGOEE^^0^B57655951
"BLD",5024,"KRN",9.8,"NM",7,0)
PSGOETO^^0^B33703445
"BLD",5024,"KRN",9.8,"NM","B","PSGFILED",2)

"BLD",5024,"KRN",9.8,"NM","B","PSGOEE",6)

"BLD",5024,"KRN",9.8,"NM","B","PSGOETO",7)

"BLD",5024,"KRN",9.8,"NM","B","PSJADT0",1)

"BLD",5024,"KRN",9.8,"NM","B","PSJBCMA",3)

"BLD",5024,"KRN",9.8,"NM","B","PSJHL2",4)

"BLD",5024,"KRN",9.8,"NM","B","PSJORRE",5)

"BLD",5024,"KRN",19,0)
19
"BLD",5024,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",5024,"KRN",19,"NM",1,0)
PSJ CSD^^1^
"BLD",5024,"KRN",19,"NM",2,0)
PSJ CD^^0
"BLD",5024,"KRN",19,"NM",3,0)
PSJ PARAM EDIT MENU^^2
"BLD",5024,"KRN",19,"NM","B","PSJ CD",2)

"BLD",5024,"KRN",19,"NM","B","PSJ CSD",1)

"BLD",5024,"KRN",19,"NM","B","PSJ PARAM EDIT MENU",3)

"BLD",5024,"KRN",19.1,0)
19.1
"BLD",5024,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5024,"KRN",101,0)
101
"BLD",5024,"KRN",409.61,0)
409.61
"BLD",5024,"KRN",771,0)
771
"BLD",5024,"KRN",870,0)
870
"BLD",5024,"KRN",8989.51,0)
8989.51
"BLD",5024,"KRN",8989.52,0)
8989.52
"BLD",5024,"KRN",8994,0)
8994
"BLD",5024,"KRN","B",.4,.4)

"BLD",5024,"KRN","B",.401,.401)

"BLD",5024,"KRN","B",.402,.402)

"BLD",5024,"KRN","B",.403,.403)

"BLD",5024,"KRN","B",.5,.5)

"BLD",5024,"KRN","B",.84,.84)

"BLD",5024,"KRN","B",3.6,3.6)

"BLD",5024,"KRN","B",3.8,3.8)

"BLD",5024,"KRN","B",9.2,9.2)

"BLD",5024,"KRN","B",9.8,9.8)

"BLD",5024,"KRN","B",19,19)

"BLD",5024,"KRN","B",19.1,19.1)

"BLD",5024,"KRN","B",101,101)

"BLD",5024,"KRN","B",409.61,409.61)

"BLD",5024,"KRN","B",771,771)

"BLD",5024,"KRN","B",870,870)

"BLD",5024,"KRN","B",8989.51,8989.51)

"BLD",5024,"KRN","B",8989.52,8989.52)

"BLD",5024,"KRN","B",8994,8994)

"BLD",5024,"QUES",0)
^9.62^^
"BLD",5024,"REQB",0)
^9.611^2^2
"BLD",5024,"REQB",1,0)
PSJ*5.0*111^2
"BLD",5024,"REQB",2,0)
PSS*1.0*86^2
"BLD",5024,"REQB","B","PSJ*5.0*111",1)

"BLD",5024,"REQB","B","PSS*1.0*86",2)

"FIA",53.46)
CLINIC DEFINITION
"FIA",53.46,0)
^PS(53.46,
"FIA",53.46,0,0)
53.46P
"FIA",53.46,0,1)
y^y^f^^^^n
"FIA",53.46,0,10)

"FIA",53.46,0,11)

"FIA",53.46,0,"RLRO")

"FIA",53.46,0,"VR")
5.0^PSJ
"FIA",53.46,53.46)
0
"FIA",59.6)
INPATIENT WARD PARAMETERS
"FIA",59.6,0)
^PS(59.6,
"FIA",59.6,0,0)
59.6P
"FIA",59.6,0,1)
y^y^p^^^^n^^n
"FIA",59.6,0,10)

"FIA",59.6,0,11)

"FIA",59.6,0,"RLRO")

"FIA",59.6,0,"VR")
5.0^PSJ
"FIA",59.6,59.6)
1
"FIA",59.6,59.6,5)

"KRN",19,7028,-1)
2^3
"KRN",19,7028,0)
PSJ PARAM EDIT MENU^PARameters Edit Menu^^M^11712^^^^^^^197
"KRN",19,7028,10,0)
^19.01PI^5^5
"KRN",19,7028,10,5,0)
12542^^5
"KRN",19,7028,10,5,"^")
PSJ CD
"KRN",19,7028,"U")
PARAMETERS EDIT MENU
"KRN",19,12542,-1)
0^2
"KRN",19,12542,0)
PSJ CD^Clinic Definition^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,12542,1,0)
^^2^2^3050112^
"KRN",19,12542,1,1,0)
This option allows the site to define how Inpatient Orders for 
"KRN",19,12542,1,2,0)
Outpatients will behave and be handled on a clinic-by-clinic basis.
"KRN",19,12542,25)
ENCD^PSGFILED
"KRN",19,12542,"U")
CLINIC DEFINITION
"KRN",19,12863,-1)
1^1
"KRN",19,12863,0)
PSJ CSD
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
112^3050302^11881
"PKG",197,22,1,"PAH",1,1,0)
^^30^30^3050302
"PKG",197,22,1,"PAH",1,1,1,0)
1. A request has been made to allow sites to define inpatient orders for 
"PKG",197,22,1,"PAH",1,1,2,0)
outpatients' behavior on a clinic-by-clinic basis. The two changes would 
"PKG",197,22,1,"PAH",1,1,3,0)
add the ability to control auto-dc of orders and whether or not they
"PKG",197,22,1,"PAH",1,1,4,0)
appear in the Bar Code Medication Administration V. 3.0 package. This
"PKG",197,22,1,"PAH",1,1,5,0)
patch helps to accomplish this goal by doing the following:
"PKG",197,22,1,"PAH",1,1,6,0)
 
"PKG",197,22,1,"PAH",1,1,7,0)
a. Rename the CLINIC STOP DATES file (#53.46) to be the CLINIC DEFINITION 
"PKG",197,22,1,"PAH",1,1,8,0)
   file (#53.46).
"PKG",197,22,1,"PAH",1,1,9,0)
b. Add the AUTO-DC IMO ORDERS field (#2) and the SEND TO BCMA? field (#3) 
"PKG",197,22,1,"PAH",1,1,10,0)
   to the CLINIC DEFINITION file (#53.46).
"PKG",197,22,1,"PAH",1,1,11,0)
c. Remove the Clinic Stop Dates option [PSJ CSD].
"PKG",197,22,1,"PAH",1,1,12,0)
d. Add the Clinic Definition option [PSJ CD].
"PKG",197,22,1,"PAH",1,1,13,0)
 
"PKG",197,22,1,"PAH",1,1,14,0)
2. A problem was reported with inpatient orders for outpatients 
"PKG",197,22,1,"PAH",1,1,15,0)
displaying in the incorrect display group on the Orders tab in the 
"PKG",197,22,1,"PAH",1,1,16,0)
Computerized Patient Record System (CPRS) V. 1.0. This patch corrects this
"PKG",197,22,1,"PAH",1,1,17,0)
problem by modifying the HL7 messaging as well as the order editing 
"PKG",197,22,1,"PAH",1,1,18,0)
process to correctly define the appointment date and time for the
"PKG",197,22,1,"PAH",1,1,19,0)
inpatient order.
"PKG",197,22,1,"PAH",1,1,20,0)
 
"PKG",197,22,1,"PAH",1,1,21,0)
3. It was discovered during internal review that the STAT NOW MAIL GROUP 
"PKG",197,22,1,"PAH",1,1,22,0)
field (#5) of the INPATIENT WARD PARAMETERS file (#59.6) had been omitted 
"PKG",197,22,1,"PAH",1,1,23,0)
from the appropriate distribution. This patch corrects this problem by 
"PKG",197,22,1,"PAH",1,1,24,0)
exporting the field.
"PKG",197,22,1,"PAH",1,1,25,0)
 
"PKG",197,22,1,"PAH",1,1,26,0)
4. A problem was identified with the display order on the meds tab in 
"PKG",197,22,1,"PAH",1,1,27,0)
CPRS. The problem was related to information being passed from Inpatient 
"PKG",197,22,1,"PAH",1,1,28,0)
Medications V. 5.0 to identify inpatient orders for outpatients. This 
"PKG",197,22,1,"PAH",1,1,29,0)
patch corrects this problem by modifying the data pass to CPRS.
"PKG",197,22,1,"PAH",1,1,30,0)
NOIS: WAS-0205-20562
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PSGFILED")
0^2^B24308978
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110,111,112**;16 DEC 97
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 ;No longer used.
"RTN","PSGFILED",56,0)
 Q
"RTN","PSGFILED",57,0)
 ;
"RTN","PSGFILED",58,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",59,0)
 ;
"RTN","PSGFILED",60,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",61,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",62,0)
 ;
"RTN","PSGFILED",63,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",64,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",65,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",66,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",67,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",68,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",69,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",70,0)
 K WD,WDN G DONE
"RTN","PSGFILED",71,0)
 ;
"RTN","PSGFILED",72,0)
ENSYS ; edit system file
"RTN","PSGFILED",73,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",74,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;34"
"RTN","PSGFILED",75,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",76,0)
 ;
"RTN","PSGFILED",77,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",78,0)
 ;
"RTN","PSGFILED",79,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",80,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",81,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",82,0)
 ;
"RTN","PSGFILED",83,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",84,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",85,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",86,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",87,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",88,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",89,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",92,0)
 Q
"RTN","PSGFILED",93,0)
ENCD ;edit Clinic Definitions file
"RTN","PSGFILED",94,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILED",95,0)
 . S DIE="^PS(53.46,",DA=+Y,DR="1;2;3" D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",96,0)
ENCG ; ward group file0
"RTN","PSGFILED",97,0)
 F  S DIC="^PS(57.8,",DIC(0)="QEAMIL",DLAYGO=57.8 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.8,",DR=".01;1" D ^DIE
"RTN","PSGFILED",98,0)
 G DONE
"RTN","PSGFILED",99,0)
 ;
"RTN","PSGOEE")
0^6^B57655951
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3-EDIT ACTIVE OR NON-VERIFIED ORDERS ;01 May 98 / 8:44 AM
"RTN","PSGOEE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,29,47,64,58,82,91,110,111,112**;16 DEC 97
"RTN","PSGOEE",3,0)
 ;
"RTN","PSGOEE",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",6,0)
 ;
"RTN","PSGOEE",7,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",8,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",9,0)
ENF ;
"RTN","PSGOEE",10,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",11,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",12,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",13,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",14,0)
 E  D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",16,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",17,0)
 D DONE1
"RTN","PSGOEE",18,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",19,0)
 Q
"RTN","PSGOEE",20,0)
ACT ;
"RTN","PSGOEE",21,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",22,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",23,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",24,0)
 E  D
"RTN","PSGOEE",25,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",26,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",27,0)
ACT1 ;I 'PSGOEAV,PSJSYSL>1 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",28,0)
 D DONE1
"RTN","PSGOEE",29,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",30,0)
 Q
"RTN","PSGOEE",31,0)
EDIT ;
"RTN","PSGOEE",32,0)
 D FULL^VALM1
"RTN","PSGOEE",33,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q
"RTN","PSGOEE",34,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",35,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",36,0)
 Q
"RTN","PSGOEE",37,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",38,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",39,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",40,0)
 K VALMSG
"RTN","PSGOEE",41,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",42,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",43,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",44,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",45,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",46,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",47,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",48,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",49,0)
 I $G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",50,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",51,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",52,0)
 Q
"RTN","PSGOEE",53,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",54,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",55,0)
 Q
"RTN","PSGOEE",56,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",57,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",58,0)
 I ('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",59,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",60,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",61,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",62,0)
 Q
"RTN","PSGOEE",63,0)
NEW3 ;
"RTN","PSGOEE",64,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",65,0)
NEW ;
"RTN","PSGOEE",66,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",67,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",68,0)
 ;DC and Unlock order.
"RTN","PSGOEE",69,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",70,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",71,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",72,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",73,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",74,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",75,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",76,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",77,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",78,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",79,0)
 Q
"RTN","PSGOEE",80,0)
UPD ;
"RTN","PSGOEE",81,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",82,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",83,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",84,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",85,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",86,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",87,0)
 .. Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",88,0)
 .. I $E(DR)'="*" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",89,0)
 I $E(DR)'="*" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",90,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",91,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",92,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",93,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSGOEE",94,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",95,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",96,0)
 Q
"RTN","PSGOEE",97,0)
OUT ;
"RTN","PSGOEE",98,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",99,0)
 Q
"RTN","PSGOEE",100,0)
DONE ;
"RTN","PSGOEE",101,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",102,0)
DONE1 ;
"RTN","PSGOEE",103,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",104,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",105,0)
 K ^PS(53.45,+PSJSYSP,1),^(2)
"RTN","PSGOEE",106,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",107,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",108,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",109,0)
K1 ;
"RTN","PSGOEE",110,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEF,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",111,0)
 Q
"RTN","PSGOEE",112,0)
 ;
"RTN","PSGOEE",113,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",114,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",115,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",116,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",117,0)
 Q
"RTN","PSGOEE",118,0)
 ;
"RTN","PSGOEE",119,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",120,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",121,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",122,0)
 Q
"RTN","PSGOEE",123,0)
FIELDS ;
"RTN","PSGOEE",124,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",125,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",126,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",127,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",128,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",129,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",130,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",131,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",132,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",133,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",134,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",135,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",136,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",137,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",138,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",139,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",140,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",141,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",142,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",143,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",144,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",145,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",146,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",147,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",148,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",149,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOETO")
0^7^B33703445
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,13,25,31,33,50,68,58,85,105,90,117,110,111,112**;16 DEC 97
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ;
"RTN","PSGOETO",8,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",9,0)
 ;I '$D(PSJOERR),PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 ;I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSGOETO",14,0)
 ;S ND=DA_U_PSGPR_U_PSGMR_U_$E("UI",$D(PSGOEOS)+1)_U_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",$D(PSGOEOS):PSGOEOS,1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",15,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",16,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",17,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSGOETO",18,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",20,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",24,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",25,0)
 ;S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND,^(.2)=PSGPDRG_U_PSGDO,$P(^(.2),U,5,6)=$P($G(PSJDOSE("DO")),U,1,2),^(2)=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",26,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",27,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",28,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",29,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",30,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",31,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",32,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",33,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",34,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",35,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",36,0)
 ;S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,4,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"12,"_C_",0)")=X
"RTN","PSGOETO",37,0)
 ;S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSGOETO",38,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",39,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",40,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",41,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P")
"RTN","PSGOETO",42,0)
 I $G(PSGOORD),$D(PSGOEE) N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOETO",43,0)
 .N DIE,DA,DR
"RTN","PSGOETO",44,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",45,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",46,0)
 .I $G(DR) D ^DIE
"RTN","PSGOETO",47,0)
 D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",48,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",49,0)
 ;D DONE S PSGCANFL="" I '$D(PSGOEE),$P(PSJSYSP0,U,12)<2 S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",50,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",51,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",52,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",53,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",54,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",55,0)
OUT ;
"RTN","PSGOETO",56,0)
 K PSGOETOF
"RTN","PSGOETO",57,0)
DONE ;
"RTN","PSGOETO",58,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",59,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",60,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSGOETO",61,0)
 Q
"RTN","PSGOETO",62,0)
CRA ;
"RTN","PSGOETO",63,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",64,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",65,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",66,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",67,0)
CRN ;
"RTN","PSGOETO",68,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",69,0)
ENGNA ;
"RTN","PSGOETO",70,0)
 F  L +^PS(55,PSGP,5,0):1 S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",71,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) L +^PS(55,PSGP,5,DA):1 I  S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",72,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",73,0)
ENGNN ;
"RTN","PSGOETO",74,0)
 N ND F  L +^PS(59.7,1,25):1 I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",75,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):1 I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",76,0)
 F  L +^PS(53.1,0):1 I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",77,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",78,0)
 Q
"RTN","PSJADT0")
0^1^B30883610
"RTN","PSJADT0",1,0)
PSJADT0 ;BIR/CML3,PR,MLM-AUTO DC/HOLD CANCEL ;11 Aug 98 / 8:25 AM
"RTN","PSJADT0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,111,112**;16 DEC 97
"RTN","PSJADT0",3,0)
 ;
"RTN","PSJADT0",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJADT0",5,0)
 ;Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJADT0",6,0)
 ;
"RTN","PSJADT0",7,0)
ENDC ; dc active orders first, then non-verified orders
"RTN","PSJADT0",8,0)
 W:'$D(PSJQUIET)&'$D(DGQUIET) !,"...discontinuing Inpatient Medication orders..."
"RTN","PSJADT0",9,0)
 S $P(PSJPIND,"^")=""
"RTN","PSJADT0",10,0)
 D NOW^%DTC N PSJDCDT S (PSJDCDT,PSGDT)=+%,PSJSYSW0="" I PSJFW S PSJSYSW=$O(^PS(59.6,"B",PSJFW,0)) S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJADT0",11,0)
 I PSGALO=1010!(PSGALO=1030)!(PSGALO=1050) D AUDDD
"RTN","PSJADT0",12,0)
 D ENUNM^PSGOU S PSGALR=10,DIE="^PS(55,"_PSGP_",5," S:PSJFW PSGTOL=1,PSGUOW=PSJFW,PSGTOO=1
"RTN","PSJADT0",13,0)
 F PSJS=PSGDT:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",14,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"U") 
"RTN","PSJADT0",15,0)
 .;first naked reference below refers to the full global reference to the right of the = sign (inside the $S)
"RTN","PSJADT0",16,0)
 .K DA S DA(1)=PSGP,DA=PSJDA,PSGAL("C")=0,$P(^(2),"^",3)=$S($D(^PS(55,PSGP,5,DA,2)):$P(^(2),"^",4),1:""),DIE="^PS(55,"_PSGP_",5,",DR="28////D;Q;34////"_PSJDCDT_";49////1" D ^PSGAL5,^DIE,EN1^PSJHL2(PSGP,"OD",PSJDA_"U","AUTO DC")
"RTN","PSJADT0",17,0)
 .I PSGALO'=1050 S DA=PSJDA,^PS(55,"AUE",PSGP,DA)="" I $P(PSJSYSW0,"^",15),(PSGALO'<1060) S $P(^PS(55,PSGP,5,PSJDA,7),"^",1,2)=PSJDCDT_"^D" D ENL^PSGVDS
"RTN","PSJADT0",18,0)
 S DIE="^PS(53.1,",DR="28////D;42////1",PSGTOO=2 F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AC",PSGP,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",19,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"P")
"RTN","PSJADT0",20,0)
 .I PSGALO'<1060,$P(PSJSYSW0,U,15),$P($G(^PS(53.1,PSJDA,0)),U,9)="N" K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,2,+PSJDA,"AD")
"RTN","PSJADT0",21,0)
 .K DA S DA=PSJDA D ^DIE I $P($G(^PS(53.1,DA,0)),"^",21) D EN1^PSJHL2(PSGP,"OC",PSJDA_"P","AUTO DC")
"RTN","PSJADT0",22,0)
 ;
"RTN","PSJADT0",23,0)
ENIV ;
"RTN","PSJADT0",24,0)
 S DFN=PSGP F PSJIVON=0:0 S PSJIVON=$O(^PS(55,DFN,"IV",PSJIVON)) Q:'PSJIVON  S Y=$G(^(PSJIVON,0)) I "PDEN"'[$P(Y,U,17) S P(17)=$P(Y,U,17),P(3)=$P(Y,U,3) D DC
"RTN","PSJADT0",25,0)
 Q
"RTN","PSJADT0",26,0)
DC ;
"RTN","PSJADT0",27,0)
 Q:'$$DCIMO(DFN,PSJIVON,"V")
"RTN","PSJADT0",28,0)
 S (ON,ON55)=PSJIVON_"V" D NOW^%DTC I P(17)="H",P(3)<% D SIVDIE S DR="100///E" D ^DIE,EXPIR^PSIVOE Q
"RTN","PSJADT0",29,0)
 ;;K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$P($G(^PS(53.3,+PSGALO,0)),U) D D1^PSIVOPT2,AUTO^PSIVOE,LOG^PSIVORAL D SIVDIE S DR=".03////"_PSJDCDT_";121////1" D ^DIE,EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",30,0)
 K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$S('+$G(PSGALO):$G(PSIVRES),1:$P($G(^PS(53.3,+PSGALO,0)),U)) D D1^PSIVOPT2,LOG^PSIVORAL D SIVDIE S DR=".03////"_PSJDCDT_";121////1" D ^DIE,EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",31,0)
 S PSJIVDCF=1
"RTN","PSJADT0",32,0)
 Q
"RTN","PSJADT0",33,0)
 ;
"RTN","PSJADT0",34,0)
SIVDIE ; Setup DIE,DA for IV
"RTN","PSJADT0",35,0)
 K DA,DIE,DR S DA=+ON,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"","
"RTN","PSJADT0",36,0)
 Q
"RTN","PSJADT0",37,0)
 ;
"RTN","PSJADT0",38,0)
AUDDD ; set up orders for discharge report and purging
"RTN","PSJADT0",39,0)
 S DIS=+VAIP(17,1) I $S('DIS:1,1:$D(^PS(55,"AUDDD",DIS,PSGP))) Q
"RTN","PSJADT0",40,0)
 S X=$$EN^PSGCT(+VAIP(13,1),-1)
"RTN","PSJADT0",41,0)
 F Q=X:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $S($D(^PS(55,PSGP,5,QQ,0)):'$P(^(0),"^",20),1:1) S $P(^(0),"^",20)=DIS,^PS(55,"AUDDD",DIS,PSGP,QQ)=""
"RTN","PSJADT0",42,0)
 Q
"RTN","PSJADT0",43,0)
 ;
"RTN","PSJADT0",44,0)
ENHE ; status from hold to expired
"RTN","PSJADT0",45,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),DIE="^PS(55,"_PSGP_",5,"
"RTN","PSJADT0",46,0)
 F PSJS=+PSJPAD:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  Q:PSJS>PSGDT  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  K DA S DA(1)=PSGP,DA=PSJDA I $D(^PS(55,PSGP,5,DA,0)),$P(^(0),"^",9)="H" S DR="28////E" D ^DIE
"RTN","PSJADT0",47,0)
 Q
"RTN","PSJADT0",48,0)
 ;
"RTN","PSJADT0",49,0)
ENUNDC(PSJDCDT,PSGP,PSJUOW,PSGALO) ; Auto-reinstate orders DC'ed due to a patient movement.
"RTN","PSJADT0",50,0)
 N PSJSYSW0 D NOW^%DTC S PSJUNDC=1,PSGDT=%,PSJFIRST='$D(PSJQUIET),PSJSYSW0=$G(^PS(59.6,+$O(^PS(59.6,"B",+PSJUOW,0)),0))
"RTN","PSJADT0",51,0)
 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJDCDT-.0002)) F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",52,0)
 .I $P($G(^PS(55,PSGP,5,PSGORD,0)),U,9)["D",$P($G(^(4)),U,11) D DISREIN,ENRI^PSGOERI
"RTN","PSJADT0",53,0)
 ;
"RTN","PSJADT0",54,0)
 S:PSJS="" PSJS=$O(^PS(55,PSGP,"IV","AIS",PSJDCDT-.0002))
"RTN","PSJADT0",55,0)
 F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,"IV","AIS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",56,0)
 .I $P($G(^PS(55,PSGP,"IV",PSGORD,0)),U,12),$P($G(^(2)),U,7)>PSGDT S P(3)=$P($G(^(0)),U,3) D DISREIN,ENARI^PSIVOPT(PSGP,PSGORD,+PSJUOW,PSGALO)
"RTN","PSJADT0",57,0)
 I $D(^TMP("PSJUNDC")) S ^TMP("PSJUNDC",$J,DFN)=$P(^DPT(DFN,0),"^")_"^"_$G(^DPT(PSGP,.1))_"^"_PSGALO D ^PSJADT2
"RTN","PSJADT0",58,0)
 ;
"RTN","PSJADT0",59,0)
ENKL ;
"RTN","PSJADT0",60,0)
 F UW=0:0 S UW=$O(^PS(53.41,1,1,UW)) Q:'UW  D  I '$O(^PS(53.41,1,1,0)) K DA S DA=1,DIK="^PS(53.41," D ^DIK
"RTN","PSJADT0",61,0)
 .F PSGP=0:0 S PSGP=$O(^PS(53.41,1,1,UW,1,PSGP)) Q:'PSGP  D  I '$O(^PS(53.41,1,1,UW,1,0)) K DA S DIK="^PS(53.41,1,1,",DA(1)=1,DA=UW D ^DIK
"RTN","PSJADT0",62,0)
 ..F TO=0:0 S TO=$O(^PS(53.41,1,1,UW,1,PSGP,1,TO)) Q:'TO  D  I '$O(^PS(53.41,1,1,UW,1,PSGP,1,0)) K DA S DA(2)=1,DA(1)=UW,DA=PSGP,DIK="^PS(53.41,1,1,"_UW_",1," D ^DIK
"RTN","PSJADT0",63,0)
 ...I '$O(^PS(53.41,1,1,UW,1,PSGP,1,TO,1,0))  K DA S DA(3)=1,DA(2)=UW,DA(1)=PSGP,DA=TO,DIK="^PS(53.41,1,1,"_UW_",1,"_PSGP_",1," D ^DIK
"RTN","PSJADT0",64,0)
 K DA,DIK,P,PSGDT,PSGP,PSGORD,PSJS,PSJUNDC,TO,UW
"RTN","PSJADT0",65,0)
 Q
"RTN","PSJADT0",66,0)
 ;
"RTN","PSJADT0",67,0)
DISREIN ; Display reinstate msg. for first order.
"RTN","PSJADT0",68,0)
 W:PSJFIRST&'$D(DGQUIET) !,"...reinstating Inpatient Medication orders..." S PSJFIRST=0
"RTN","PSJADT0",69,0)
 Q
"RTN","PSJADT0",70,0)
 ;
"RTN","PSJADT0",71,0)
DCIMO(DFN,ON,TYP) ; Check parameter before DC'ing clinic order
"RTN","PSJADT0",72,0)
 N GLO,IMOND,A,CLINIC,APPT,B,C S GLO=$S(TYP="P":"^PS(53.1,",TYP="U":"^PS(55,"_DFN_",5,",TYP="V":"^PS(55,"_PSGP_",""IV"",",1:"") I TYP="" Q 1
"RTN","PSJADT0",73,0)
 S IMOND=$S(TYP="P"!(TYP="V"):"""DSS""",TYP="U":8,1:"") I IMOND="" Q 1
"RTN","PSJADT0",74,0)
 S GLO=GLO_+ON_","_IMOND_")",A=$G(@GLO),CLINIC=$P(A,"^"),APPT=$P(A,"^",2)
"RTN","PSJADT0",75,0)
 Q:'$$CLINIC^PSJBCMA(A) 1
"RTN","PSJADT0",76,0)
 I '$D(^PS(53.46,"B",CLINIC)) Q 1
"RTN","PSJADT0",77,0)
 S B=$O(^PS(53.46,"B",CLINIC,"")),C=+$P(^PS(53.46,B,0),"^",3) Q C
"RTN","PSJBCMA")
0^3^B62444725
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;16 Mar 99 / 10:13 AM
"RTN","PSJBCMA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112**;16 DEC 97
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DIBA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpat meds
"RTN","PSJBCMA",15,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",16,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",17,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",18,0)
 K PSJINX
"RTN","PSJBCMA",19,0)
 Q
"RTN","PSJBCMA",20,0)
ORDER ;Loop thru the orders.
"RTN","PSJBCMA",21,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",22,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",23,0)
 S PSJINX=0
"RTN","PSJBCMA",24,0)
 ;* U/D orders
"RTN","PSJBCMA",25,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",26,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",27,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",28,0)
 ;* IV orders
"RTN","PSJBCMA",29,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",30,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",31,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",32,0)
 ;* Pending orders
"RTN","PSJBCMA",33,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",34,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",35,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",36,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",37,0)
 ;* One-time orders
"RTN","PSJBCMA",38,0)
 ;* When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",39,0)
 ;* make sure no duplicate orders is return on ^TMP.
"RTN","PSJBCMA",40,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",41,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",42,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",43,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",44,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",45,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",46,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",47,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",48,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",49,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",50,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",51,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",52,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",53,0)
 K PSJON
"RTN","PSJBCMA",54,0)
 Q
"RTN","PSJBCMA",55,0)
 ;
"RTN","PSJBCMA",56,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",57,0)
 D UDPEND Q:'$$CLINICS($G(CLINIC)) 
"RTN","PSJBCMA",58,0)
 D TMP
"RTN","PSJBCMA",59,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA",60,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",61,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",62,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",63,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",64,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",65,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",66,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",67,0)
 Q
"RTN","PSJBCMA",68,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA",69,0)
 NEW ND,X,Y
"RTN","PSJBCMA",70,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA",71,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",72,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",73,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",74,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",75,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",76,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",77,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",78,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",79,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA",80,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",81,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",82,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",83,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",84,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",85,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",86,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",87,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",88,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S(SCHD["ON CALL":"OC",SCHD["ON-CALL":"OC",SCHD["ONCALL":"OC",1:"C")
"RTN","PSJBCMA",89,0)
 D TMP
"RTN","PSJBCMA",90,0)
 S CNT=0
"RTN","PSJBCMA",91,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",92,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA",93,0)
 . ;S AOIDF=$$GET1^DIQ(50.7,+$P(DN,U,11),.02) I AOINAME="" S AOIDF=""
"RTN","PSJBCMA",94,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3) ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA",95,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",96,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",97,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA",98,0)
 . ;S SOIDF=$$GET1^DIQ(50.7,+$P(DN,U,11),.02) I SOINAME="" S SOIDF=""
"RTN","PSJBCMA",99,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4) ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA",100,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",101,0)
 K PSJ
"RTN","PSJBCMA",102,0)
 S X1=0
"RTN","PSJBCMA",103,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",104,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",105,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",106,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",107,0)
 . S X2=0
"RTN","PSJBCMA",108,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",109,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",110,0)
 Q
"RTN","PSJBCMA",111,0)
UDPEND ;
"RTN","PSJBCMA",112,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",113,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",114,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",115,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",116,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",117,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",118,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",119,0)
 S PSJ("DO")=$P(X,U,2)
"RTN","PSJBCMA",120,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",121,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",122,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",123,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",124,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",125,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",126,0)
 ;the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",127,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",128,0)
 D SIOPI
"RTN","PSJBCMA",129,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",130,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P","^ONCALL^ON-CALL^ON CALL^"[("^"_PSJ("SCHD")_"^"):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",131,0)
 Q 
"RTN","PSJBCMA",132,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",133,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",134,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",135,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",136,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",137,0)
 S PSJ("MRABB")=$P($G(^PS(51.2,+PSJ("MR"),0)),U,3)
"RTN","PSJBCMA",138,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",139,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",140,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",141,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",142,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",143,0)
 Q
"RTN","PSJBCMA",144,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",145,0)
 NEW X,Y,Z
"RTN","PSJBCMA",146,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",147,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",148,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",149,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",150,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",151,0)
 Q
"RTN","PSJBCMA",152,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",153,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",154,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",155,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",156,0)
 Q Y
"RTN","PSJBCMA",157,0)
ONE(DFN,ORD,SCH,START,STOP) ;determine if order is a one-time
"RTN","PSJBCMA",158,0)
 ; Input:  DFN - patient's internal entry number
"RTN","PSJBCMA",159,0)
 ;         ORD - order number to check (must contain U or V)
"RTN","PSJBCMA",160,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",161,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",162,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",163,0)
 N X
"RTN","PSJBCMA",164,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",165,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",166,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",167,0)
 I SCH="TODAY"!(SCH="ONCE")!(SCH="NOW")!(SCH="ONE TIME")!(SCH="ONETIME")!(SCH="ONE-TIME")!(SCH="1TIME")!(SCH="1 TIME")!(SCH="1-TIME")!(SCH="STAT") Q "O"
"RTN","PSJBCMA",168,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",169,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",170,0)
 Q ""
"RTN","PSJBCMA",171,0)
CLINIC(CL) ;
"RTN","PSJBCMA",172,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",173,0)
 Q 0
"RTN","PSJBCMA",174,0)
CLINICS(CL) ;
"RTN","PSJBCMA",175,0)
 Q:'$$CLINIC(CL) 1
"RTN","PSJBCMA",176,0)
 Q:'$D(^PS(53.46,"B",+CL)) 1
"RTN","PSJBCMA",177,0)
 N A
"RTN","PSJBCMA",178,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 1
"RTN","PSJBCMA",179,0)
 Q $P(^PS(53.46,A,0),"^",4)
"RTN","PSJHL2")
0^4^B31037084
"RTN","PSJHL2",1,0)
PSJHL2 ;BIR/RLW-PATIENT ID AND VISIT SEGMENTS ;22 Nov 1999  9:27 AM
"RTN","PSJHL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,16,23,28,42,50,70,58,100,102,110,111,112**;16 DEC 97
"RTN","PSJHL2",3,0)
 ;
"RTN","PSJHL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL2",5,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL2",6,0)
 ;
"RTN","PSJHL2",7,0)
EN1(PSJHLDFN,PSOC,PSJORDER,PSREASON) ; start here
"RTN","PSJHL2",8,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL2",9,0)
 ;               PSJORDER* (order_file (N,P,V, etc))
"RTN","PSJHL2",10,0)
 ;               PSOC* (order control code - NW for new order, OK to return filler number to OE/RR, OC for order canceled, SC for status change)
"RTN","PSJHL2",11,0)
 ;               PSREASON* (text reason)
"RTN","PSJHL2",12,0)
 ; *=optional, only required if an order segment is also to be generated
"RTN","PSJHL2",13,0)
START ;
"RTN","PSJHL2",14,0)
 K ^TMP("PSJHLS",$J,"PS")
"RTN","PSJHL2",15,0)
 N CLERK,J,LIMIT,NAME,NEXT,NODE1,NODE2,NODE4,NOO,PSJCLEAR,PSJHINST,PSJHLSDT,PROVIDER,PSJI,ROOMBED,RXORDER,STATUS,UNDO,VERIFY,WARD
"RTN","PSJHL2",16,0)
 S RXORDER=PSJORDER,PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PSJORDER,1:"^PS(55,"_PSJHLDFN_",5,"_+PSJORDER)_","
"RTN","PSJHL2",17,0)
 I RXORDER["P",$P($G(@(PSJORDER_"0)")),U,15)'=PSJHLDFN S ORDCON="Patient does not match/PSJHL2" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON) Q
"RTN","PSJHL2",18,0)
 S UNDO=$S("OC^CR"[PSOC:1,1:0)
"RTN","PSJHL2",19,0)
 D INIT,PID,PV1,ORC
"RTN","PSJHL2",20,0)
 D @$S("SN^SC^OC^OD^DR^CR^OH^OR^XX^ZC^XR"[PSOC:"EN1^PSJHL3(PSJHLDFN,PSOC,PSJORDER)",1:"CALL^PSJHLU(PSJI)")
"RTN","PSJHL2",21,0)
 I UNDO D UNDO
"RTN","PSJHL2",22,0)
 K ^TMP("PSJHLS",$J,"PS"),FIELD
"RTN","PSJHL2",23,0)
 Q
"RTN","PSJHL2",24,0)
 ;
"RTN","PSJHL2",25,0)
INIT ; initialize HL7 variables, set master file identification segment
"RTN","PSJHL2",26,0)
 ; PSJHLMTN = message type - ORR for messages sent as a response to an OE/RR event; ORM for "unsolicited" messages.
"RTN","PSJHL2",27,0)
 S PSJI=0,PSJHLMTN=$S($G(PSJHLMTN)]"":PSJHLMTN,1:"ORM")
"RTN","PSJHL2",28,0)
 D INIT^PSJHLU
"RTN","PSJHL2",29,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL2",30,0)
 S FIELD(0)="MSH",FIELD(1)="^~\&",FIELD(2)="PHARMACY",FIELD(3)=$G(PSJHINST),FIELD(8)=PSJHLMTN
"RTN","PSJHL2",31,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",32,0)
 Q
"RTN","PSJHL2",33,0)
 ;
"RTN","PSJHL2",34,0)
PID ; get patient data, format PID SEGMENT
"RTN","PSJHL2",35,0)
 S LIMIT=22 X PSJCLEAR
"RTN","PSJHL2",36,0)
 S FIELD(0)="PID"
"RTN","PSJHL2",37,0)
 S FIELD(3)=PSJHLDFN
"RTN","PSJHL2",38,0)
 N DFN S DFN=PSJHLDFN D DEM^VADPT S FIELD(5)=VADM(1)
"RTN","PSJHL2",39,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",40,0)
 Q
"RTN","PSJHL2",41,0)
 ;
"RTN","PSJHL2",42,0)
PV1 ; get patient visit information, format PV1 segment
"RTN","PSJHL2",43,0)
 N PSJAPPT
"RTN","PSJHL2",44,0)
 S LIMIT=50 X PSJCLEAR
"RTN","PSJHL2",45,0)
 S FIELD(0)="PV1"
"RTN","PSJHL2",46,0)
 I PSJHLMTN="ORR" S FIELD(3)=LOC
"RTN","PSJHL2",47,0)
 I PSJHLMTN="ORM" D
"RTN","PSJHL2",48,0)
 .S LOC="",WARD=$G(^DPT(PSJHLDFN,.1)),LOC=$S($G(WARD)]"":$O(^SC("B",WARD,LOC)),1:LOC)
"RTN","PSJHL2",49,0)
 .I $G(LOC)="" D
"RTN","PSJHL2",50,0)
 .. N A
"RTN","PSJHL2",51,0)
 .. I RXORDER["P",($G(^PS(53.1,+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",52,0)
 .. I RXORDER["V",($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",53,0)
 .. I RXORDER["U",$G(^PS(55,PSJHLDFN,5,+RXORDER,8)) S A=^(8),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",54,0)
 .I $G(LOC)]"" S ROOMBED=$G(^DPT(PSJHLDFN,.101)),LOC=LOC_"^"_ROOMBED
"RTN","PSJHL2",55,0)
 .S FIELD(3)=LOC I $G(PSJAPPT)]"" S FIELD(44)=$$FMTHL7^XLFDT(PSJAPPT)
"RTN","PSJHL2",56,0)
 S FIELD(2)=$S($G(CLASS)="O":CLASS,1:"I")
"RTN","PSJHL2",57,0)
 I FIELD(2)="I" N DFN S DFN=PSJHLDFN D INP^VADPT S FIELD(19)=VAIN(1)
"RTN","PSJHL2",58,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",59,0)
 Q
"RTN","PSJHL2",60,0)
 ;
"RTN","PSJHL2",61,0)
ORC ; order control segment
"RTN","PSJHL2",62,0)
 S LIMIT=18 X PSJCLEAR
"RTN","PSJHL2",63,0)
 Q:'$D(PSJORDER)!'$D(PSOC)
"RTN","PSJHL2",64,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL2",65,0)
 S NODE4=$G(@(PSJORDER_"4)"))
"RTN","PSJHL2",66,0)
 S FIELD(0)="ORC"
"RTN","PSJHL2",67,0)
 S FIELD(1)=PSOC
"RTN","PSJHL2",68,0)
 S FIELD(2)=$S(PSOC="SN":"",1:$P(NODE1,"^",21))_"^OR" I $P(FIELD(2),"^")=0 S $P(FIELD(2),"^")="" ; IV orders are created with a zero in the oerr order number, for some reason
"RTN","PSJHL2",69,0)
 S FIELD(3)=RXORDER_"^PS"
"RTN","PSJHL2",70,0)
 ; translate Pharmacy status code to HL7 status code, set in FIELD(5)
"RTN","PSJHL2",71,0)
 S STATUS=$S($G(PSJEXPOE):"E",(($P(NODE1,"^",17)]"")&(RXORDER["V")):($P(NODE1,"^",17)),($P(NODE1,"^",9)]""):$P(NODE1,"^",9),$G(PSIVCOPY):"DE",1:"")
"RTN","PSJHL2",72,0)
 D @STATUS
"RTN","PSJHL2",73,0)
 I STATUS="U",RXORDER["P" S FIELD(3)="^PS"
"RTN","PSJHL2",74,0)
 S FIELD(9)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE2,"^")),1:$$FMTHL7^XLFDT($P(NODE1,"^",16)))
"RTN","PSJHL2",75,0)
 S CLERK=$S(RXORDER["V":$P(NODE2,"^",11),1:$P(NODE4,"^",7))
"RTN","PSJHL2",76,0)
 S NAME=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL2",77,0)
 S FIELD(10)=CLERK_"^"_NAME
"RTN","PSJHL2",78,0)
 I PSOC="ZV"!($G(PSJBCBU)) S VERIFY=$P($G(NODE4),"^"),FIELD(11)=VERIFY_"^"_$P($G(^VA(200,+VERIFY,0)),"^"),FIELD(9)=$$FMTHL7^XLFDT($P(NODE4,"^",2))
"RTN","PSJHL2",79,0)
 S PROVIDER=$S($G(PSJDCPRV)]"":$G(PSJDCPRV),RXORDER["V":$P(NODE1,"^",6),1:$P(NODE1,"^",2)) K PSJDCPRV
"RTN","PSJHL2",80,0)
 S NAME=$P($G(^VA(200,+PROVIDER,0)),"^")
"RTN","PSJHL2",81,0)
 S FIELD(12)=PROVIDER_"^"_NAME
"RTN","PSJHL2",82,0)
 S FIELD(15)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE1,"^",2)),1:$$FMTHL7^XLFDT($P(NODE2,"^",2)))
"RTN","PSJHL2",83,0)
 I $S(RXORDER["V":$P(NODE2,"^",8)="R",1:$P(NODE1,"^",24)="R")
"RTN","PSJHL2",84,0)
 N FIELD9 S FIELD9=$$FMTHL7^XLFDT($$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)) I FIELD9>FIELD(9) S FIELD(9)=FIELD9,FIELD(15)=FIELD9
"RTN","PSJHL2",85,0)
 S NOO=$S(PSJORDER["IV":$G(P("NAT")),(($G(PSJNOO)="")&($G(P("NAT"))]"")):$G(P("NAT")),1:$G(PSJNOO)),PSREASON=$S(NOO="D":"",1:$G(PSREASON))
"RTN","PSJHL2",86,0)
 S FIELD(16)=NOO_U_$S(NOO="P":"Telephoned",NOO="D":"Duplicate",NOO="X":"Rejected",NOO="A":"Auto",NOO="S":"Service Correction",NOO="W":"Written",NOO="V":"Verbal",NOO="E":"Physician Entered",NOO="I":"Policy",1:"")_U_"99ORN"_U_U_$G(PSREASON)_U
"RTN","PSJHL2",87,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",88,0)
 Q
"RTN","PSJHL2",89,0)
 ;
"RTN","PSJHL2",90,0)
DISPLAY ; just for testing
"RTN","PSJHL2",91,0)
 I $G(MSGTEST) W ! F NEXT=0:1:LIMIT W FIELD(NEXT)_"|"
"RTN","PSJHL2",92,0)
 Q
"RTN","PSJHL2",93,0)
UNDO ;Undo Renew if Pending Renewal is dc'd
"RTN","PSJHL2",94,0)
 I RXORDER["P",(STATUS="D"),($G(PSJNOO)'="A"),($P(NODE1,U,24)="R") D ENBKOUT^PSJOREN(PSJHLDFN,RXORDER)
"RTN","PSJHL2",95,0)
 Q
"RTN","PSJHL2",96,0)
 ;
"RTN","PSJHL2",97,0)
A S FIELD(5)="CM" Q  ; active
"RTN","PSJHL2",98,0)
D S FIELD(5)="DC" Q  ; discontinued
"RTN","PSJHL2",99,0)
I S FIELD(5)="IP" Q  ; incomplete
"RTN","PSJHL2",100,0)
N S FIELD(5)="IP" Q  ; non-verified
"RTN","PSJHL2",101,0)
U S FIELD(5)="ZX" Q  ; unreleased
"RTN","PSJHL2",102,0)
P S FIELD(5)="IP" Q  ; pending
"RTN","PSJHL2",103,0)
DE S FIELD(5)="RP" Q  ; discontinued (edit)
"RTN","PSJHL2",104,0)
E S FIELD(5)="ZE" Q  ; expired
"RTN","PSJHL2",105,0)
H S FIELD(5)="HD" Q  ; hold
"RTN","PSJHL2",106,0)
R S FIELD(5)="ZZ" Q  ; renewed
"RTN","PSJHL2",107,0)
RE S FIELD(5)="CM" Q  ; reinstated
"RTN","PSJHL2",108,0)
DR S FIELD(5)="DC" Q  ; discontinued (renewal)
"RTN","PSJHL2",109,0)
O S FIELD(5)="HD" Q  ; on call (is this kind of like HOLD?)
"RTN","PSJORRE")
0^5^B30514336
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;28 Jan 99 / 12:56 PM
"RTN","PSJORRE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,110,111,112**;16 DEC 97
"RTN","PSJORRE",3,0)
 ;
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to OTF^OR3CONV is supported by DBIA 2412.
"RTN","PSJORRE",8,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",9,0)
 ;
"RTN","PSJORRE",10,0)
OCL(DFN,BDT,EDT,TFN)         ; return condensed list of inpat meds
"RTN","PSJORRE",11,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A
"RTN","PSJORRE",12,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJORRE",13,0)
 F  S X=$$OTF^OR3CONV(DFN,$S($E($G(IOST),1)="C":0,1:1)) Q:+X'<0  D
"RTN","PSJORRE",14,0)
 .I +X=-1 H 3
"RTN","PSJORRE",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",16,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",17,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",18,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",19,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",20,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",21,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",22,0)
 Q
"RTN","PSJORRE",23,0)
 ;
"RTN","PSJORRE",24,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",25,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",26,0)
 D TYPE
"RTN","PSJORRE",27,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",28,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",29,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",30,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",31,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",32,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",33,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",34,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",35,0)
 ;S UNITS="" I '$O(@(F_+ON_",1,1)")),DO="" S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2)
"RTN","PSJORRE",36,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE",37,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",38,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",39,0)
 S TFN=TFN+1
"RTN","PSJORRE",40,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",41,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",42,0)
 ;*S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_$P($G(^PS(55,DFN,5,+ON,0)),"^",22)_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJORRE",43,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",44,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",45,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",46,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",47,0)
 ;S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",48,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",49,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",50,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",51,0)
 Q
"RTN","PSJORRE",52,0)
 ;
"RTN","PSJORRE",53,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",54,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM
"RTN","PSJORRE",55,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",56,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",57,0)
 D TYPE
"RTN","PSJORRE",58,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",59,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",60,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",61,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",62,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",63,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",64,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",65,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",66,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",67,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",68,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",69,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",70,0)
 ;S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_$P(ND0,U,3)_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT
"RTN","PSJORRE",71,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",72,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",73,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",74,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",75,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4)
"RTN","PSJORRE",76,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE",77,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",78,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",79,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",80,0)
 ;I FON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",81,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",82,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",83,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,TFN,"IVLIM",0)=IVLIM
"RTN","PSJORRE",84,0)
 Q
"RTN","PSJORRE",85,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",86,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",87,0)
 Q X
"RTN","PSJORRE",88,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRE",89,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRE",90,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRE",91,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRE",92,0)
 Q
"SEC","^DIC",53.46,53.46,0,"AUDIT")
@
"SEC","^DIC",53.46,53.46,0,"DD")
@
"SEC","^DIC",53.46,53.46,0,"DEL")
@
"SEC","^DIC",53.46,53.46,0,"LAYGO")
@
"SEC","^DIC",53.46,53.46,0,"RD")
@
"SEC","^DIC",53.46,53.46,0,"WR")
@
"VER")
8.0^22.0
"^DD",53.46,53.46,0)
FIELD^^3^4
"^DD",53.46,53.46,0,"DT")
3050111
"^DD",53.46,53.46,0,"IX","B",53.46,.01)

"^DD",53.46,53.46,0,"NM","CLINIC DEFINITION")

"^DD",53.46,53.46,0,"VRPK")
PSJ
"^DD",53.46,53.46,.01,0)
CLINIC^RP44'^SC(^0;1^Q
"^DD",53.46,53.46,.01,1,0)
^.1
"^DD",53.46,53.46,.01,1,1,0)
53.46^B
"^DD",53.46,53.46,.01,1,1,1)
S ^PS(53.46,"B",$E(X,1,30),DA)=""
"^DD",53.46,53.46,.01,1,1,2)
K ^PS(53.46,"B",$E(X,1,30),DA)
"^DD",53.46,53.46,.01,3)
Enter the hospital location (clinic) for which you want to define behavior for inpatient orders for outpatients.
"^DD",53.46,53.46,.01,21,0)
^^3^3^3031029^
"^DD",53.46,53.46,.01,21,1,0)
This is the clinic for which the stop date calculations are being 
"^DD",53.46,53.46,.01,21,2,0)
entered. The clinic should allow the ordering of Inpatient Medications 
"^DD",53.46,53.46,.01,21,3,0)
for Outpatients.
"^DD",53.46,53.46,.01,"DT")
3050111
"^DD",53.46,53.46,1,0)
NUMBER OF DAYS UNTIL STOP^NJ3,0^^0;2^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1.N) X
"^DD",53.46,53.46,1,3)
Type a number between 1 and 365, 0 Decimal Digits
"^DD",53.46,53.46,1,21,0)
^^2^2^3050111^^
"^DD",53.46,53.46,1,21,1,0)
This is the number of days to default the length of an order. Cannot 
"^DD",53.46,53.46,1,21,2,0)
exceed 365 days.
"^DD",53.46,53.46,1,"DT")
3050111
"^DD",53.46,53.46,2,0)
AUTO-DC IMO ORDERS^S^0:NO;1:YES;^0;3^Q
"^DD",53.46,53.46,2,3)
Enter YES to allow IMO orders to follow the standard patient movement definition. Enter NO to allow IMO orders to remain active.
"^DD",53.46,53.46,2,21,0)
^^6^6^3050111^
"^DD",53.46,53.46,2,21,1,0)
This field gives the site the ability to define, by clinic, whether or 
"^DD",53.46,53.46,2,21,2,0)
not inpatient orders for outpatients should be auto-dc'd on patient 
"^DD",53.46,53.46,2,21,3,0)
movements. This field will only affect those orders where Inpatient 
"^DD",53.46,53.46,2,21,4,0)
Medications V. 5.0 controls the discontinue action. If the patient 
"^DD",53.46,53.46,2,21,5,0)
movement discontinue action is handled by any other package, this field 
"^DD",53.46,53.46,2,21,6,0)
will have no effect.
"^DD",53.46,53.46,2,"DT")
3050111
"^DD",53.46,53.46,3,0)
SEND TO BCMA?^S^0:NO;1:YES;^0;4^Q
"^DD",53.46,53.46,3,3)
Enter YES to make these orders available to BCMA, NO to prevent these orders from being sent to BCMA.
"^DD",53.46,53.46,3,21,0)
^^3^3^3050111^
"^DD",53.46,53.46,3,21,1,0)
This field will determine if inpatient orders for outpatients in this 
"^DD",53.46,53.46,3,21,2,0)
clinic will be made available to the Bar Code Medication Admnistration 
"^DD",53.46,53.46,3,21,3,0)
package.
"^DD",53.46,53.46,3,"DT")
3050111
"^DD",59.6,59.6,5,0)
STAT NOW MAIL GROUP^P3.8^XMB(3.8,^0;30^Q
"^DD",59.6,59.6,5,21,0)
^^2^2^3041228^
"^DD",59.6,59.6,5,21,1,0)
A notification will be sent to this mail group for each new STAT and NOW
"^DD",59.6,59.6,5,21,2,0)
order that is received from CPRS.
"^DD",59.6,59.6,5,"DT")
3041228
"^DIC",53.46,53.46,0)
CLINIC DEFINITION^53.46
"^DIC",53.46,53.46,0,"GL")
^PS(53.46,
"^DIC",53.46,53.46,"%D",0)
^^2^2^3050112
"^DIC",53.46,53.46,"%D",1,0)
This file is used to allow sites to define the behavior of inpatient orders 
"^DIC",53.46,53.46,"%D",2,0)
for outpatients on a clinic-by-clinic basis.
"^DIC",53.46,"B","CLINIC DEFINITION",53.46)

**END**
**END**
