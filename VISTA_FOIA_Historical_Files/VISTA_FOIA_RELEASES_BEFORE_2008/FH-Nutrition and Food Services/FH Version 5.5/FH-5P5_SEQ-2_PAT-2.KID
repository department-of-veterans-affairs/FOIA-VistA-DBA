Released FH*5.5*2 SEQ #2
Extracted from mail message
**KIDS**:FH*5.5*2^

**INSTALL NAME**
FH*5.5*2
"BLD",5660,0)
FH*5.5*2^DIETETICS^0^3051026^y
"BLD",5660,4,0)
^9.64PA^115^2
"BLD",5660,4,115,0)
115
"BLD",5660,4,115,2,0)
^9.641^115.017^2
"BLD",5660,4,115,2,115.016,0)
RECURRING MEALS  (sub-file)
"BLD",5660,4,115,2,115.016,1,0)
^9.6411^21.7^2
"BLD",5660,4,115,2,115.016,1,21.7,0)
TUBEFEEDING CLERK
"BLD",5660,4,115,2,115.016,1,24.5,0)
RECURRING MEALS CLERK
"BLD",5660,4,115,2,115.017,0)
SPECIAL MEALS  (sub-file)
"BLD",5660,4,115,2,115.017,1,0)
^9.6411^11.5^2
"BLD",5660,4,115,2,115.017,1,11,0)
EARLY/LATE TRAY OE/RR ORDER
"BLD",5660,4,115,2,115.017,1,11.5,0)
EARLY/LATE TRAY STATUS
"BLD",5660,4,115,222)
y^y^p^^^^n^^n
"BLD",5660,4,115,224)

"BLD",5660,4,119.9,0)
119.9
"BLD",5660,4,119.9,2,0)
^9.641^119.9^1
"BLD",5660,4,119.9,2,119.9,0)
FH SITE PARAMETERS  (File-top level)
"BLD",5660,4,119.9,2,119.9,1,0)
^9.6411^49^11
"BLD",5660,4,119.9,2,119.9,1,4,0)
OUTPATIENT MEALS DIET1
"BLD",5660,4,119.9,2,119.9,1,40,0)
OUTPATIENT MEALS DIET6
"BLD",5660,4,119.9,2,119.9,1,41,0)
OUTPATIENT MEALS DIET7
"BLD",5660,4,119.9,2,119.9,1,42,0)
OUTPATIENT MEALS DIET8
"BLD",5660,4,119.9,2,119.9,1,43,0)
OUTPATIENT MEALS DIET9
"BLD",5660,4,119.9,2,119.9,1,44,0)
OUTPATIENT MEALS DIET10
"BLD",5660,4,119.9,2,119.9,1,45,0)
OUTPATIENT MEALS DIET11
"BLD",5660,4,119.9,2,119.9,1,46,0)
OUTPATIENT MEALS DIET12
"BLD",5660,4,119.9,2,119.9,1,47,0)
OUTPATIENT MEALS DIET13
"BLD",5660,4,119.9,2,119.9,1,48,0)
OUTPATIENT MEALS DIET14
"BLD",5660,4,119.9,2,119.9,1,49,0)
OUTPATIENT MEALS DIET15
"BLD",5660,4,119.9,222)
y^y^p^^^^n^^n
"BLD",5660,4,119.9,224)

"BLD",5660,4,"APDD",115,115.016)

"BLD",5660,4,"APDD",115,115.016,21.7)

"BLD",5660,4,"APDD",115,115.016,24.5)

"BLD",5660,4,"APDD",115,115.017)

"BLD",5660,4,"APDD",115,115.017,11)

"BLD",5660,4,"APDD",115,115.017,11.5)

"BLD",5660,4,"APDD",119.9,119.9)

"BLD",5660,4,"APDD",119.9,119.9,4)

"BLD",5660,4,"APDD",119.9,119.9,40)

"BLD",5660,4,"APDD",119.9,119.9,41)

"BLD",5660,4,"APDD",119.9,119.9,42)

"BLD",5660,4,"APDD",119.9,119.9,43)

"BLD",5660,4,"APDD",119.9,119.9,44)

"BLD",5660,4,"APDD",119.9,119.9,45)

"BLD",5660,4,"APDD",119.9,119.9,46)

"BLD",5660,4,"APDD",119.9,119.9,47)

"BLD",5660,4,"APDD",119.9,119.9,48)

"BLD",5660,4,"APDD",119.9,119.9,49)

"BLD",5660,4,"B",115,115)

"BLD",5660,4,"B",119.9,119.9)

"BLD",5660,"ABPKG")
n
"BLD",5660,"KRN",0)
^9.67PA^8989.52^19
"BLD",5660,"KRN",.4,0)
.4
"BLD",5660,"KRN",.401,0)
.401
"BLD",5660,"KRN",.402,0)
.402
"BLD",5660,"KRN",.403,0)
.403
"BLD",5660,"KRN",.5,0)
.5
"BLD",5660,"KRN",.84,0)
.84
"BLD",5660,"KRN",3.6,0)
3.6
"BLD",5660,"KRN",3.8,0)
3.8
"BLD",5660,"KRN",9.2,0)
9.2
"BLD",5660,"KRN",9.8,0)
9.8
"BLD",5660,"KRN",9.8,"NM",0)
^9.68A^22^22
"BLD",5660,"KRN",9.8,"NM",1,0)
FHOMSA1^^0^B5366452
"BLD",5660,"KRN",9.8,"NM",2,0)
FHOMSR1^^0^B23595025
"BLD",5660,"KRN",9.8,"NM",3,0)
FHOMRE1^^0^B21010791
"BLD",5660,"KRN",9.8,"NM",4,0)
FHOMWOR1^^0^B3417408
"BLD",5660,"KRN",9.8,"NM",5,0)
FHSYSP^^0^B2751439
"BLD",5660,"KRN",9.8,"NM",6,0)
FHOMIP^^0^B5150055
"BLD",5660,"KRN",9.8,"NM",7,0)
FHOMRA1^^0^B8333924
"BLD",5660,"KRN",9.8,"NM",8,0)
FHOMRC1^^0^B12871022
"BLD",5660,"KRN",9.8,"NM",9,0)
FHOMRC2^^0^B5867833
"BLD",5660,"KRN",9.8,"NM",10,0)
FHOMRO1^^0^B64076466
"BLD",5660,"KRN",9.8,"NM",11,0)
FHOMRT1^^0^B20005276
"BLD",5660,"KRN",9.8,"NM",12,0)
FHOMUTL^^0^B32969388
"BLD",5660,"KRN",9.8,"NM",13,0)
FHOMWOR^^0^B25289896
"BLD",5660,"KRN",9.8,"NM",14,0)
FHWOR71^^0^B28572181
"BLD",5660,"KRN",9.8,"NM",15,0)
FHOMSC1^^0^B1885895
"BLD",5660,"KRN",9.8,"NM",16,0)
FHWOR^^0^B30084812
"BLD",5660,"KRN",9.8,"NM",17,0)
FHMNBRPT^^0^B5671840
"BLD",5660,"KRN",9.8,"NM",18,0)
FHPST2^^0^B36655557
"BLD",5660,"KRN",9.8,"NM",19,0)
FHWORR^^0^B19353525
"BLD",5660,"KRN",9.8,"NM",20,0)
FHOMSP1^^0^B8724512
"BLD",5660,"KRN",9.8,"NM",21,0)
FHOMAPI^^0^B1356712
"BLD",5660,"KRN",9.8,"NM",22,0)
FHDMP^^0^B21472385
"BLD",5660,"KRN",9.8,"NM","B","FHDMP",22)

"BLD",5660,"KRN",9.8,"NM","B","FHMNBRPT",17)

"BLD",5660,"KRN",9.8,"NM","B","FHOMAPI",21)

"BLD",5660,"KRN",9.8,"NM","B","FHOMIP",6)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRA1",7)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRC1",8)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRC2",9)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRE1",3)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRO1",10)

"BLD",5660,"KRN",9.8,"NM","B","FHOMRT1",11)

"BLD",5660,"KRN",9.8,"NM","B","FHOMSA1",1)

"BLD",5660,"KRN",9.8,"NM","B","FHOMSC1",15)

"BLD",5660,"KRN",9.8,"NM","B","FHOMSP1",20)

"BLD",5660,"KRN",9.8,"NM","B","FHOMSR1",2)

"BLD",5660,"KRN",9.8,"NM","B","FHOMUTL",12)

"BLD",5660,"KRN",9.8,"NM","B","FHOMWOR",13)

"BLD",5660,"KRN",9.8,"NM","B","FHOMWOR1",4)

"BLD",5660,"KRN",9.8,"NM","B","FHPST2",18)

"BLD",5660,"KRN",9.8,"NM","B","FHSYSP",5)

"BLD",5660,"KRN",9.8,"NM","B","FHWOR",16)

"BLD",5660,"KRN",9.8,"NM","B","FHWOR71",14)

"BLD",5660,"KRN",9.8,"NM","B","FHWORR",19)

"BLD",5660,"KRN",19,0)
19
"BLD",5660,"KRN",19.1,0)
19.1
"BLD",5660,"KRN",101,0)
101
"BLD",5660,"KRN",409.61,0)
409.61
"BLD",5660,"KRN",771,0)
771
"BLD",5660,"KRN",870,0)
870
"BLD",5660,"KRN",8989.51,0)
8989.51
"BLD",5660,"KRN",8989.52,0)
8989.52
"BLD",5660,"KRN",8994,0)
8994
"BLD",5660,"KRN","B",.4,.4)

"BLD",5660,"KRN","B",.401,.401)

"BLD",5660,"KRN","B",.402,.402)

"BLD",5660,"KRN","B",.403,.403)

"BLD",5660,"KRN","B",.5,.5)

"BLD",5660,"KRN","B",.84,.84)

"BLD",5660,"KRN","B",3.6,3.6)

"BLD",5660,"KRN","B",3.8,3.8)

"BLD",5660,"KRN","B",9.2,9.2)

"BLD",5660,"KRN","B",9.8,9.8)

"BLD",5660,"KRN","B",19,19)

"BLD",5660,"KRN","B",19.1,19.1)

"BLD",5660,"KRN","B",101,101)

"BLD",5660,"KRN","B",409.61,409.61)

"BLD",5660,"KRN","B",771,771)

"BLD",5660,"KRN","B",870,870)

"BLD",5660,"KRN","B",8989.51,8989.51)

"BLD",5660,"KRN","B",8989.52,8989.52)

"BLD",5660,"KRN","B",8994,8994)

"BLD",5660,"QUES",0)
^9.62^^
"BLD",5660,"REQB",0)
^9.611^1^1
"BLD",5660,"REQB",1,0)
FH*5.5*1^1
"BLD",5660,"REQB","B","FH*5.5*1",1)

"FIA",115)
NUTRITION PERSON
"FIA",115,0)
^FHPT(
"FIA",115,0,0)
115
"FIA",115,0,1)
y^y^p^^^^n^^n
"FIA",115,0,10)

"FIA",115,0,11)

"FIA",115,0,"RLRO")

"FIA",115,0,"VR")
5.5^FH
"FIA",115,115)
1
"FIA",115,115.016)
1
"FIA",115,115.016,21.7)

"FIA",115,115.016,24.5)

"FIA",115,115.017)
1
"FIA",115,115.017,11)

"FIA",115,115.017,11.5)

"FIA",119.9)
FH SITE PARAMETERS
"FIA",119.9,0)
^FH(119.9,
"FIA",119.9,0,0)
119.9
"FIA",119.9,0,1)
y^y^p^^^^n^^n
"FIA",119.9,0,10)

"FIA",119.9,0,11)

"FIA",119.9,0,"RLRO")

"FIA",119.9,0,"VR")
5.5^FH
"FIA",119.9,119.9)
1
"FIA",119.9,119.9,4)

"FIA",119.9,119.9,40)

"FIA",119.9,119.9,41)

"FIA",119.9,119.9,42)

"FIA",119.9,119.9,43)

"FIA",119.9,119.9,44)

"FIA",119.9,119.9,45)

"FIA",119.9,119.9,46)

"FIA",119.9,119.9,47)

"FIA",119.9,119.9,48)

"FIA",119.9,119.9,49)

"MBREQ")
0
"PKG",29,-1)
1^1
"PKG",29,0)
DIETETICS^FH^Dietetics/Nutrition & Food Service System
"PKG",29,20,0)
^9.402P^^
"PKG",29,22,0)
^9.49I^1^1
"PKG",29,22,1,0)
5.5^3050202^3040621^4572
"PKG",29,22,1,"PAH",1,0)
2^3051026^1901
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","FHDMP")
0^22^B21472385
"RTN","FHDMP",1,0)
FHDMP ; HISC/REL/NCA/JH/RK/FAI - Patient Data Log ;10/19/04  13:26
"RTN","FHDMP",2,0)
 ;;5.5;DIETETICS;**1,2**;Jan 28, 2005
"RTN","FHDMP",3,0)
BEGIN S ADM="",FHALL=1 D ^FHOMDPA
"RTN","FHDMP",4,0)
 G:'FHDFN CLEAN
"RTN","FHDMP",5,0)
 I $O(^FHPT(FHDFN,"A",0))<1 W !!,"NO ADMISSIONS ON FILE!" G OMDATE
"RTN","FHDMP",6,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="Q",DA=FHDFN,X="??" D ^DIC
"RTN","FHDMP",7,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHDMP",8,0)
 K ADM
"RTN","FHDMP",9,0)
A0 W !!,"Select ADMISSION or RETURN for OUTPATIENT ",$S(WARD'="":" (or C for CURRENT)",1:""),": " R X:DTIME G:X["^" KIL D:X="c" TR^FH
"RTN","FHDMP",10,0)
 I (X="")&'($D(^FHPT(FHDFN,"OP"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) W !!,"NO OUTPATIENT DATA ON FILE!" G FHDMP
"RTN","FHDMP",11,0)
 I (X="")&($D(^FHPT(FHDFN,"OP"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) G OMDATE
"RTN","FHDMP",12,0)
 I WARD'="",X="C" S ADM=$G(^DPT("CN",WARD,DFN)) G CAD:ADM
"RTN","FHDMP",13,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="EQM" D ^DIC G:Y<1 A0 S ADM=+Y
"RTN","FHDMP",14,0)
CAD I ADM,$G(^FHPT(FHDFN,"A",ADM,0)) S (SDT,STDT)=$P(^FHPT(FHDFN,"A",ADM,0),U,1),ENDT=DT G P0:SDT
"RTN","FHDMP",15,0)
 ;
"RTN","FHDMP",16,0)
OMDATE I '($D(^FHPT(FHDFN,"OP"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) W !!,"NO OUTPATIENT DATA ON FILE!" G FHDMP
"RTN","FHDMP",17,0)
 W !!,"This report will also display any existing outpatient meals data."
"RTN","FHDMP",18,0)
 W !,"Enter the Start Date and End Date for outpatient data.",!
"RTN","FHDMP",19,0)
 D STDATE^FHOMUTL S SDT=STDT I STDT="" Q
"RTN","FHDMP",20,0)
 S X="T+30" D ^%DT S ENDT=Y
"RTN","FHDMP",21,0)
 D DD^%DT S FHDTDF=Y K DIR
"RTN","FHDMP",22,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT
"RTN","FHDMP",23,0)
 D ^DIR
"RTN","FHDMP",24,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHDMP",25,0)
 D P0
"RTN","FHDMP",26,0)
 Q
"RTN","FHDMP",27,0)
P0 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHDMP",28,0)
 I $D(IO("Q")) S FHPGM="INOUT^FHDMP",FHLST="ADM^FHDFN^DFN^IEN200^PID^OPSD^STDT^ENDT^SDT" D EN2^FH G KIL
"RTN","FHDMP",29,0)
 U IO D INOUT D ^%ZISC K %ZIS,IOP G FHDMP
"RTN","FHDMP",30,0)
 Q
"RTN","FHDMP",31,0)
INOUT D F0
"RTN","FHDMP",32,0)
 Q:QT="^"  I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",33,0)
 Q:$G(ADM)
"RTN","FHDMP",34,0)
 W:QT'="^" !,LN,!,?15,"*** O U T P A T I E N T   M E A L   D A T A ***"
"RTN","FHDMP",35,0)
 Q:QT="^"  D DISP^FHOMRMD I EX=U Q
"RTN","FHDMP",36,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",37,0)
 Q:QT="^"  D ^FHDPSM I EX=U Q
"RTN","FHDMP",38,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",39,0)
 Q:QT="^"  D ^FHDPGM I EX=U Q
"RTN","FHDMP",40,0)
CLEAN G KILL^XUSCLEAN
"RTN","FHDMP",41,0)
F0 D NOW^%DTC S DT=%\1,DTP=% D DTP^FH S NOW=DTP,S1=$S(IOST?1"C".E:IOSL,1:IOSL-6)
"RTN","FHDMP",42,0)
 D PATNAME^FHOMUTL
"RTN","FHDMP",43,0)
 ;S Y(0)=^DPT(DFN,0)
"RTN","FHDMP",44,0)
 S NAM=FHPTNM,SEX=FHSEX,DOB=FHDOB,PID=$G(PID),AGE=FHAGE,PG=0,QT=""
"RTN","FHDMP",45,0)
 S PRTFM=STDT_" TO  "_ENDT
"RTN","FHDMP",46,0)
 S DTP=STDT D DTP^FH S SDT1=DTP
"RTN","FHDMP",47,0)
 S DTP=ENDT D DTP^FH S EDT1=DTP
"RTN","FHDMP",48,0)
 S PRTFM=SDT1_"  TO  "_EDT1
"RTN","FHDMP",49,0)
 S LN="",$P(LN,"-",80)=""
"RTN","FHDMP",50,0)
 D HDR
"RTN","FHDMP",51,0)
 D ALG^FHCLN W !!,"Allergies: " S ALG=$S(ALG="":"None on file",1:ALG) D LNE
"RTN","FHDMP",52,0)
 W !!,"Food Preferences Currently on file:",!!?26,"Likes",?58,"Dislikes",!
"RTN","FHDMP",53,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0) D SP
"RTN","FHDMP",54,0)
 W ! S (M1,MM)="",L=0 F  S M1=$O(N(M1)) Q:M1=""  I $D(N(M1)) W $P(M1,"~",2) D  S MM=M1
"RTN","FHDMP",55,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M1,"L",P1)) S X1=$S(P1>0:N(M1,"L",P1),1:"") S:P2'="" P2=$O(N(M1,"D",P2)) S X2=$S(P2>0:N(M1,"D",P2),1:"") Q:P1=""&(P2="")  D W0 W:MM'=M1 !
"RTN","FHDMP",56,0)
 .  Q
"RTN","FHDMP",57,0)
 I $O(N(""))="" W !!,"No Food Preferences on file",! D ^FHDMP1 Q
"RTN","FHDMP",58,0)
 W ! K L,N,M,M1,M2 D ^FHDMP1 Q
"RTN","FHDMP",59,0)
W0 I X1'="" W ?12 S X=X1 D W1 S X1=X
"RTN","FHDMP",60,0)
 I X2'="" W ?46 S X=X2 D W1 S X2=X
"RTN","FHDMP",61,0)
 Q:X1=""&(X2="")  S:$Y'<S1 L=1 D:$Y'<S1 HDR G:QT="^" KIL W ! W:L ! S L=0 G W0
"RTN","FHDMP",62,0)
W1 I $L(X)<34 W X S X="" Q
"RTN","FHDMP",63,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHDMP",64,0)
 W $E(X,1,KK-2) S X=$E(X,KK+1,999) Q
"RTN","FHDMP",65,0)
SP S M=$P(X,"^",2) S:M="A" M="BNE" S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHDMP",66,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHDMP",67,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHDMP",68,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHDMP",69,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHDMP",70,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHDMP",71,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHDMP",72,0)
 Q
"RTN","FHDMP",73,0)
LNE ; Break Line if longer than 65 chars
"RTN","FHDMP",74,0)
 I $L(ALG)<66 W ALG Q
"RTN","FHDMP",75,0)
 F L=67:-1:1 Q:$E(ALG,L-1,L)=", "
"RTN","FHDMP",76,0)
 W $E(ALG,1,L-2)
"RTN","FHDMP",77,0)
 S ALG=$E(ALG,L+1,999)
"RTN","FHDMP",78,0)
 Q:ALG=""  W !?11
"RTN","FHDMP",79,0)
 G LNE
"RTN","FHDMP",80,0)
HDR ; Print Header
"RTN","FHDMP",81,0)
 S (EX,QT)="" I PG,IOST?1"C".E W:$X>1 ! W *7 R QT:DTIME S:'$T QT="^" Q:QT="^"
"RTN","FHDMP",82,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHDMP",83,0)
 W !,?15,"P  A  T  I  E  N  T     D  A  T  A     L  O  G",!
"RTN","FHDMP",84,0)
 W !,"Date Range:  ",PRTFM,?62,NOW,!!,PID,?17,NAM,?49,$S(SEX="M":"Male",SEX="F":"Female",1:""),?58,"Age ",AGE,?72,"Page ",PG Q
"RTN","FHDMP",85,0)
DTP ; Printable Date/Time
"RTN","FHDMP",86,0)
 Q:Y<1  W $J(+$E(Y,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(Y,4,5))_"-"_$E(Y,2,3)
"RTN","FHDMP",87,0)
 I Y["." S %=+$E(Y_"0",9,10) W $J($S(%>12:%-12,1:%),3)_":"_$E(Y_"000",11,12)_$S(%<12:"am",%<24:"pm",1:"m")
"RTN","FHDMP",88,0)
 K % Q
"RTN","FHDMP",89,0)
KIL ; User exit
"RTN","FHDMP",90,0)
 Q
"RTN","FHMNBRPT")
0^17^B5671840
"RTN","FHMNBRPT",1,0)
FHMNBRPT ;Hines OIFO/JT,RTK - Dietetics Monitor Brief ;07/26/01  11:49
"RTN","FHMNBRPT",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHMNBRPT",3,0)
 ;
"RTN","FHMNBRPT",4,0)
DATE ;sets date
"RTN","FHMNBRPT",5,0)
 ; Check for multidivisional site
"RTN","FHMNBRPT",6,0)
 I $P($G(^FH(119.9,1,0)),U,20)'="N" D ^FHMMBRPT Q
"RTN","FHMNBRPT",7,0)
 W ! S %DT="AEPT",%DT("A")="Enter beginning date: " D ^%DT Q:Y<0
"RTN","FHMNBRPT",8,0)
 S FHSDT=Y,%DT(0)=FHSDT,%DT("A")="Enter ending date: " D ^%DT K %DT(0)
"RTN","FHMNBRPT",9,0)
 I Y<0 D END Q
"RTN","FHMNBRPT",10,0)
 S FHEDT=Y D DEV
"RTN","FHMNBRPT",11,0)
 D END Q
"RTN","FHMNBRPT",12,0)
 ;
"RTN","FHMNBRPT",13,0)
EN ;get admission/monitor information
"RTN","FHMNBRPT",14,0)
 S PG=0,EX="" D NOW^%DTC S Y=X D DD^%DT S FHNDT=Y D HDR
"RTN","FHMNBRPT",15,0)
 S ADMTOT=0,MONTOT=0
"RTN","FHMNBRPT",16,0)
 S I=FHSDT F  S I=$O(^DGPM("ATT1",I)) Q:'I!(I>FHEDT)  D
"RTN","FHMNBRPT",17,0)
 .S J=0 F  S J=$O(^DGPM("ATT1",I,J)) Q:'J!(EX=U)  D
"RTN","FHMNBRPT",18,0)
 ..S DFN=$P(^DGPM(J,0),U,3) I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHMNBRPT",19,0)
 ..S FHZ115="P"_DFN D CHECK^FHOMDPA I FHDFN="" Q
"RTN","FHMNBRPT",20,0)
 ..S Y=$P(I,".") X ^DD("DD") W !,Y,?13,$E($P(^DPT(DFN,0),U,1),1,23)
"RTN","FHMNBRPT",21,0)
 ..W ?39,$E($P(^DPT(DFN,0),U,9),6,9) S ADMTOT=ADMTOT+1
"RTN","FHMNBRPT",22,0)
 ..I $D(^FHPT(FHDFN,"A",J,"MO","B")) W ?48,"Yes" S MONTOT=MONTOT+1
"RTN","FHMNBRPT",23,0)
 ..S Y=$P($P($G(^FHPT(FHDFN,"A",J,0)),U,14),".",1) I Y X ^DD("DD") W ?56,Y
"RTN","FHMNBRPT",24,0)
 ..Q
"RTN","FHMNBRPT",25,0)
 .Q
"RTN","FHMNBRPT",26,0)
 I EX=U D END Q
"RTN","FHMNBRPT",27,0)
 W !!,"TOTAL ADMISSIONS: ",?22,ADMTOT
"RTN","FHMNBRPT",28,0)
 W !,"TOTAL WITH MONITORS:",?22,MONTOT
"RTN","FHMNBRPT",29,0)
 W !,"Percentage of Admissions with Monitors: "
"RTN","FHMNBRPT",30,0)
 I ADMTOT=0!(MONTOT=0) W "0.0%" D END Q
"RTN","FHMNBRPT",31,0)
 S FHPER=(MONTOT/ADMTOT)*100
"RTN","FHMNBRPT",32,0)
 I $L($P(FHPER,".",2))>2 S FHPER=$P(FHPER,".",1)_"."_$E($P(FHPER,".",2),1,2)
"RTN","FHMNBRPT",33,0)
 W FHPER,"%"
"RTN","FHMNBRPT",34,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR
"RTN","FHMNBRPT",35,0)
 D END Q
"RTN","FHMNBRPT",36,0)
DEV ;get device and set up queue
"RTN","FHMNBRPT",37,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHMNBRPT",38,0)
 I '$D(IO("Q")) U IO D EN,^%ZISC,END Q
"RTN","FHMNBRPT",39,0)
 S ZTRTN="EN^FHMNBRPT",ZTSAVE("FHSDT")="",ZTSAVE("FHEDT")=""
"RTN","FHMNBRPT",40,0)
 S ZTSAVE=("FHNDT"),ZTSAVE=("FHPER")
"RTN","FHMNBRPT",41,0)
 S ZTDESC="Dietetics Monitor Report" D ^%ZTLOAD
"RTN","FHMNBRPT",42,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHMNBRPT",43,0)
 D END Q
"RTN","FHMNBRPT",44,0)
END ;kill and quit
"RTN","FHMNBRPT",45,0)
 K I,J,FHDFN,DFN,SSN,ADMTOT,MONTOT,FHPER,FHSDT,FHEDT,FHNDT,X,Y,PG
"RTN","FHMNBRPT",46,0)
 Q
"RTN","FHMNBRPT",47,0)
PG ;
"RTN","FHMNBRPT",48,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHMNBRPT",49,0)
 D HDR Q
"RTN","FHMNBRPT",50,0)
HDR ;Header
"RTN","FHMNBRPT",51,0)
 W:$Y @IOF W !,FHNDT,?60,"Page: " S PG=PG+1 W PG,!!
"RTN","FHMNBRPT",52,0)
 W "Admission",?13,"Patient",?39,"SSN",?45,"Monitor?",?56,"Discharge"
"RTN","FHMNBRPT",53,0)
 W ! F Z=1:1:79 W "="
"RTN","FHMNBRPT",54,0)
 Q
"RTN","FHOMAPI")
0^21^B1356712
"RTN","FHOMAPI",1,0)
FHOMAPI ;Hines OIFO/RTK OUTPATIENT MEALS/CPRS API's  ;8/26/03  10:15
"RTN","FHOMAPI",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMAPI",3,0)
 ;
"RTN","FHOMAPI",4,0)
AUTH(DUZ) ;Check whether USER (DUZ) has FHAUTH key: 1=YES, 0=NO
"RTN","FHOMAPI",5,0)
 N FHAU S FHAU=0
"RTN","FHOMAPI",6,0)
 I $D(^XUSEC("FHAUTH",DUZ)) S FHAU=1
"RTN","FHOMAPI",7,0)
 Q FHAU
"RTN","FHOMAPI",8,0)
DIETLST ;Build list of allowable outpatient diets from site parameters
"RTN","FHOMAPI",9,0)
 K FHDIET,SPDIETS S SPDIETS=$P($G(^FH(119.9,1,0)),U,2,6)_"^"_$P($G(^FH(119.9,1,1)),U,1,10)
"RTN","FHOMAPI",10,0)
 F A=1:1:15 S AB=$P(SPDIETS,U,A) I AB'="" S FHN=$P($G(^FH(111,AB,0)),U,1),FHDIET(A)=AB_"^"_FHN
"RTN","FHOMAPI",11,0)
 Q
"RTN","FHOMAPI",12,0)
MAXDAYS(FHLOC) ;Returns max number of days a recurring meal may be ordered
"RTN","FHOMAPI",13,0)
 N FHMAXD S FHMAXD=365 I FHLOC="" Q FHMAXD
"RTN","FHOMAPI",14,0)
 S FHLOC=$O(^FH(119.6,"AL",FHLOC,""))
"RTN","FHOMAPI",15,0)
 I 'FHLOC Q FHMAXD
"RTN","FHOMAPI",16,0)
 S FHMAXD=$P($G(^FH(119.6,FHLOC,1)),U,2) I FHMAXD="" S FHMAXD=365
"RTN","FHOMAPI",17,0)
 Q FHMAXD
"RTN","FHOMAPI",18,0)
NFSLOC(FHLOC) ;Returns NFS location name given HOSP LOCATION pointer
"RTN","FHOMAPI",19,0)
 I FHLOC="" Q ""
"RTN","FHOMAPI",20,0)
 S FHLOC=$O(^FH(119.6,"AL",FHLOC,""))
"RTN","FHOMAPI",21,0)
 I 'FHLOC Q ""
"RTN","FHOMAPI",22,0)
 S FHLNAME=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMAPI",23,0)
 Q FHLNAME
"RTN","FHOMIP")
0^6^B5150055
"RTN","FHOMIP",1,0)
FHOMIP ;Hines OIFO/RTK OUTPATIENT ISOLATION/PRECAUTION EDIT  ;9/22/03  11:15
"RTN","FHOMIP",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMIP",3,0)
 ;
"RTN","FHOMIP",4,0)
 D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMIP",5,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMIP",6,0)
 S FHIPBEF=$P($G(^FHPT(FHDFN,0)),U,5)
"RTN","FHOMIP",7,0)
 S DIE="^FHPT(",DA=FHDFN,DR="19" D ^DIE
"RTN","FHOMIP",8,0)
 S FHIP=$P($G(^FHPT(FHDFN,0)),U,5) I FHIP=FHIPBEF Q
"RTN","FHOMIP",9,0)
 D UPD100
"RTN","FHOMIP",10,0)
 I FHIP'="" S FHIP=$P($G(^FH(119.4,FHIP,0)),U,1)
"RTN","FHOMIP",11,0)
 I FHIP="" S FHIP="Cancelled"
"RTN","FHOMIP",12,0)
 S FHACT="O",FHOPTY="I",(FHDIET,FHLOC,FHMEAL)="" D SETORX^FHOMRO2
"RTN","FHOMIP",13,0)
 Q
"RTN","FHOMIP",14,0)
HL7SET ;
"RTN","FHOMIP",15,0)
 ; Use this to set isolations/precautions received from CPRS via HL7 msg
"RTN","FHOMIP",16,0)
 ; segments.  Just set the necessary variables.
"RTN","FHOMIP",17,0)
 S FHOBR=$P(FHX,"|",13),FHIP=$P(FHOBR,"^",4)
"RTN","FHOMIP",18,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMIP",19,0)
 I '$D(^FH(119.4,FHIP,0)) S TXT="Invalid I/P" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMIP",20,0)
 S DIE="^FHPT(",DA=FHDFN,DR="19////^S X=FHIP;20////^S X=FHORN" D ^DIE
"RTN","FHOMIP",21,0)
 S FILL="I;"_FHIP
"RTN","FHOMIP",22,0)
 D SEND^FHWOR
"RTN","FHOMIP",23,0)
 S FHIP=$P($G(^FH(119.4,FHIP,0)),U,1)
"RTN","FHOMIP",24,0)
 S FHACT="O",FHOPTY="I",(FHDIET,FHLOC,FHMEAL)="" D SETORX^FHOMRO2
"RTN","FHOMIP",25,0)
 Q
"RTN","FHOMIP",26,0)
CAN ;
"RTN","FHOMIP",27,0)
 S DIE="^FHPT(",DA=FHDFN,DR="19////@;20////FHORN" D ^DIE
"RTN","FHOMIP",28,0)
 S FHACT="O",FHOPTY="I",FHIP="Cancelled",(FHDIET,FHLOC,FHMEAL)=""
"RTN","FHOMIP",29,0)
 D SETORX^FHOMRO2
"RTN","FHOMIP",30,0)
 Q
"RTN","FHOMIP",31,0)
UPD100 ;Backdoor message to update file #100 with a new IP order
"RTN","FHOMIP",32,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMIP",33,0)
 Q:'DFN  Q:FHIP=""  K MSG D SITE^FH
"RTN","FHOMIP",34,0)
 S FHOLOC=$O(^FH(119.6,"AL",0)),FHOLOCNM=$P($G(^SC(FHOLOC,0)),U,1)
"RTN","FHOMIP",35,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMIP",36,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMIP",37,0)
 S MSG(3)="PV1||O|"_FHOLOC_"^"_FHOLOCNM_"||||||||||||||||"
"RTN","FHOMIP",38,0)
 D NOW^%DTC S FHNOW=%,FHODT=$E(%,1,7),FHODT=$$FMTHL7^XLFDT(FHODT)
"RTN","FHOMIP",39,0)
 S FILL="I;"_FHNOW,FHIPEXT=$P($G(^FH(119.4,FHIP,0)),U,1)
"RTN","FHOMIP",40,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHNOW
"RTN","FHOMIP",41,0)
 S MSG(5)="OBR||||||||||||^^^"_FHIP_"^"_FHIPEXT
"RTN","FHOMIP",42,0)
 D EVSEND^FHWOR
"RTN","FHOMIP",43,0)
 Q
"RTN","FHOMRA1")
0^7^B8333924
"RTN","FHOMRA1",1,0)
FHOMRA1 ;Hines OIFO/RTK OUTPATIENT MEALS ADDITIONAL ORDERS  ;5/14/03  15:15
"RTN","FHOMRA1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMRA1",3,0)
 ;
"RTN","FHOMRA1",4,0)
 S FHMSG1="A" D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRA1",5,0)
 K NUM D DISP^FHOMRR1 I $G(NUM)="" Q
"RTN","FHOMRA1",6,0)
AO1 W ! K DIR S DIR("A")="Select Order(s)",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMRA1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMRA1",8,0)
 S FHCAN1=0 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)'="C" S FHCAN1=1
"RTN","FHOMRA1",9,0)
 I FHCAN1=0 W !!?3,"The selected order(s) have been cancelled!",! D AO1 Q
"RTN","FHOMRA1",10,0)
 W ! K DIR S DIR("A")="Additional Order: ",DIR(0)="FAO^1:160" D ^DIR
"RTN","FHOMRA1",11,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRA1",12,0)
 S FHTEXT=Y
"RTN","FHOMRA1",13,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMRA1",14,0)
 D ^DIR I $D(DIRUT)!(Y=0) D EXMSG^FHOMUTL,END Q
"RTN","FHOMRA1",15,0)
 W !
"RTN","FHOMRA1",16,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) D CHK
"RTN","FHOMRA1",17,0)
 D OKMSG^FHOMUTL
"RTN","FHOMRA1",18,0)
 D END Q
"RTN","FHOMRA1",19,0)
CHK ;
"RTN","FHOMRA1",20,0)
 I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)="C" S FHDTX=$P(FHRNUM,U,2),FHDTX=$$FMTE^XLFDT(FHDTX,"P") W !?3,"The order for ",$E(FHDTX,1,12)," has been cancelled -- not ordered!" Q
"RTN","FHOMRA1",21,0)
 D SET,UPD100
"RTN","FHOMRA1",22,0)
 Q
"RTN","FHOMRA1",23,0)
SET ;
"RTN","FHOMRA1",24,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMRA1",25,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMRA1",26,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=+FHRNUM
"RTN","FHOMRA1",27,0)
 S DR="11////^S X=FHTEXT;12////^S X=DUZ;13////^S X=FHTODAY;13.5////^S X=FHORN" D ^DIE
"RTN","FHOMRA1",28,0)
 S FHACT="O",FHOPTY="A",FHAET=FHTEXT D SETAET^FHOMRO2
"RTN","FHOMRA1",29,0)
 Q
"RTN","FHOMRA1",30,0)
END ;
"RTN","FHOMRA1",31,0)
 K A,FHFIND,FHCLST,FHC,FHRNUM,FHTEXT,FHTODAY,NUM Q
"RTN","FHOMRA1",32,0)
HL7SET ;
"RTN","FHOMRA1",33,0)
 ; Entry point for AO's placed from CPRS/OERR
"RTN","FHOMRA1",34,0)
 S FHTEXT=FHCOM,X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRA1",35,0)
 F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D SET
"RTN","FHOMRA1",36,0)
 I '$D(FHRNUM) Q
"RTN","FHOMRA1",37,0)
 S FILL="A;"_FHRNUM_";"_FHCOM_";"_FHORN
"RTN","FHOMRA1",38,0)
 D SEND^FHWOR Q
"RTN","FHOMRA1",39,0)
UPD100 ;Backdoor message to update file #100 with a new AO order
"RTN","FHOMRA1",40,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRA1",41,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRA1",42,0)
 S FILL="A;"_FHRNUM,FHODT=$P(FHRNUM,U,2),FHODT=$$FMTHL7^XLFDT(FHODT)
"RTN","FHOMRA1",43,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHTODAY
"RTN","FHOMRA1",44,0)
 S MSG(5)="ODS|D||^^^FH-6^Additional Order^99OTH|"_FHTEXT
"RTN","FHOMRA1",45,0)
 D EVSEND^FHWOR
"RTN","FHOMRA1",46,0)
 Q
"RTN","FHOMRC1")
0^8^B12871022
"RTN","FHOMRC1",1,0)
FHOMRC1 ;Hines OIFO/RTK RECURRING MEALS CANCEL MEAL  ;2/10/03  15:05
"RTN","FHOMRC1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMRC1",3,0)
 ;
"RTN","FHOMRC1",4,0)
CRM ; Cancel entire recurring meal
"RTN","FHOMRC1",5,0)
 D GETRM I FHFIND=0 Q
"RTN","FHOMRC1",6,0)
 I $G(NUM)<1 Q
"RTN","FHOMRC1",7,0)
CRM1 W ! K DIR S DIR("A")="Cancel which order (or ALL)?",DIR(0)="FO^1:80"
"RTN","FHOMRC1",8,0)
 D ^DIR
"RTN","FHOMRC1",9,0)
 Q:$D(DIRUT)  S FHNUM=Y D RANGE^FHOMUTL I FHCLST="" D CRM1 Q
"RTN","FHOMRC1",10,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRC1",11,0)
 I Y=0!($D(DIRUT)) D END Q
"RTN","FHOMRC1",12,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=$P(FHLIST(FHC),U,1) D CANRM,CNRM100^FHOMRC2
"RTN","FHOMRC1",13,0)
 W "  ... done" D END Q
"RTN","FHOMRC1",14,0)
CANRM ;
"RTN","FHOMRC1",15,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRC1",16,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,12)
"RTN","FHOMRC1",17,0)
 K DIE S FHSTAT="C",DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=FHRNUM
"RTN","FHOMRC1",18,0)
 S DR="24////^S X=FHSTAT;.05////^S X=FHORN" D ^DIE
"RTN","FHOMRC1",19,0)
 S FHACT="C",FHOPTY="R" D SETAET^FHOMRO2
"RTN","FHOMRC1",20,0)
 Q
"RTN","FHOMRC1",21,0)
CA ; Cancel Additional Order
"RTN","FHOMRC1",22,0)
 D GETRM I FHFIND=0 Q
"RTN","FHOMRC1",23,0)
CA1 W ! K DIR S DIR("A")="Cancel which Additional Order (or ALL)?"
"RTN","FHOMRC1",24,0)
 S DIR(0)="FO^1:80" D ^DIR
"RTN","FHOMRC1",25,0)
 Q:$D(DIRUT)  S FHNUM=Y D RANGE^FHOMUTL I FHCLST="" D CA1 Q
"RTN","FHOMRC1",26,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRC1",27,0)
 I Y=0!($D(DIRUT)) D END Q
"RTN","FHOMRC1",28,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=$P(FHLIST(FHC),U,1) D CANAO,CNAO100^FHOMRC2
"RTN","FHOMRC1",29,0)
 W "  ... done" D END Q
"RTN","FHOMRC1",30,0)
CANAO ;
"RTN","FHOMRC1",31,0)
 I '$D(^FHPT(FHDFN,"OP",FHRNUM,1)) Q
"RTN","FHOMRC1",32,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,5)="C" Q
"RTN","FHOMRC1",33,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,4)
"RTN","FHOMRC1",34,0)
 K DIE S FHSTAT="C",DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=FHRNUM
"RTN","FHOMRC1",35,0)
 S DR="13.6////^S X=FHSTAT;13.5////^S X=FHORN" D ^DIE
"RTN","FHOMRC1",36,0)
 S FHACT="C",FHOPTY="A" D SETAET^FHOMRO2 S FHORN=""
"RTN","FHOMRC1",37,0)
 Q
"RTN","FHOMRC1",38,0)
CE ; Cancel Early/Late Tray
"RTN","FHOMRC1",39,0)
 D GETRM I FHFIND=0 Q
"RTN","FHOMRC1",40,0)
CE1 W ! K DIR S DIR("A")="Cancel which Early/Late Tray (or ALL)?"
"RTN","FHOMRC1",41,0)
 S DIR(0)="FO^1:80" D ^DIR
"RTN","FHOMRC1",42,0)
 Q:$D(DIRUT)  S FHNUM=Y D RANGE^FHOMUTL I FHCLST="" D CE1 Q
"RTN","FHOMRC1",43,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRC1",44,0)
 I Y=0!($D(DIRUT)) D END Q
"RTN","FHOMRC1",45,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=$P(FHLIST(FHC),U,1) D CANEL,CNEL100^FHOMRC2
"RTN","FHOMRC1",46,0)
 W "  ... done" D END Q
"RTN","FHOMRC1",47,0)
CANEL ;
"RTN","FHOMRC1",48,0)
 I '$D(^FHPT(FHDFN,"OP",FHRNUM,2)) Q
"RTN","FHOMRC1",49,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,6)="C" Q
"RTN","FHOMRC1",50,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,5)
"RTN","FHOMRC1",51,0)
 K DIE S FHSTAT="C",DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=FHRNUM
"RTN","FHOMRC1",52,0)
 S DR="17.6////^S X=FHSTAT;17.5////^S X=FHORN" D ^DIE
"RTN","FHOMRC1",53,0)
 S FHACT="C",FHOPTY="E" D SETAET^FHOMRO2 S FHORN=""
"RTN","FHOMRC1",54,0)
 Q
"RTN","FHOMRC1",55,0)
CT ; Cancel Tubefeeding
"RTN","FHOMRC1",56,0)
 D GETRM I FHFIND=0 Q
"RTN","FHOMRC1",57,0)
CT1 W ! K DIR S DIR("A")="Cancel which Tubefeeding (or ALL)?"
"RTN","FHOMRC1",58,0)
 S DIR(0)="FO^1:80" D ^DIR
"RTN","FHOMRC1",59,0)
 Q:$D(DIRUT)  S FHNUM=Y D RANGE^FHOMUTL I FHCLST="" D CT1 Q
"RTN","FHOMRC1",60,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRC1",61,0)
 I Y=0!($D(DIRUT)) D END Q
"RTN","FHOMRC1",62,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=$P(FHLIST(FHC),U,1) D CANTF,CNTF100^FHOMRC2
"RTN","FHOMRC1",63,0)
 W "  ... done" D END Q
"RTN","FHOMRC1",64,0)
CANTF ;
"RTN","FHOMRC1",65,0)
 I '$D(^FHPT(FHDFN,"OP",FHRNUM,3)) Q
"RTN","FHOMRC1",66,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,5)="C" Q
"RTN","FHOMRC1",67,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,4)
"RTN","FHOMRC1",68,0)
 K DIE S FHSTAT="C",DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=FHRNUM
"RTN","FHOMRC1",69,0)
 S DR="21.6////^S X=FHSTAT;21.5////^S X=FHORN" D ^DIE
"RTN","FHOMRC1",70,0)
 S FHACT="C",FHOPTY="T" D SETAET^FHOMRO2 S FHORN=""
"RTN","FHOMRC1",71,0)
 Q
"RTN","FHOMRC1",72,0)
GETRM ; Select patient and get recurring meals
"RTN","FHOMRC1",73,0)
 S FHORN="",FHPSDT="N" D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRC1",74,0)
 D DISP^FHOMRR1
"RTN","FHOMRC1",75,0)
 K FHPSDT Q
"RTN","FHOMRC1",76,0)
END ;
"RTN","FHOMRC1",77,0)
 K A,FHFIND,FHCLST,FHC,FHCDT,FHPSDT,NUM
"RTN","FHOMRC1",78,0)
 Q
"RTN","FHOMRC2")
0^9^B5867833
"RTN","FHOMRC2",1,0)
FHOMRC2 ;Hines OIFO/RTK BACKDOOR CANCEL OUTPATIENT MEALS  ;4/27/05  10:05
"RTN","FHOMRC2",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMRC2",3,0)
 ;
"RTN","FHOMRC2",4,0)
CNRM100 ;Backdoor message to update file #100 with RM cancel order
"RTN","FHOMRC2",5,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,12)
"RTN","FHOMRC2",6,0)
 S FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHOMRC2",7,0)
 S FHDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHOMRC2",8,0)
 S FILL="R;"_FHMPNUM_";"_FHDT_";"_FHDT_";;"
"RTN","FHOMRC2",9,0)
 D CHECK
"RTN","FHOMRC2",10,0)
 I FHACTV=0 D CAN
"RTN","FHOMRC2",11,0)
 I FHACTV=1 D CANOCC
"RTN","FHOMRC2",12,0)
ASSOC I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D CNAO100,CANAO^FHOMRC1
"RTN","FHOMRC2",13,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D CNEL100,CANEL^FHOMRC1
"RTN","FHOMRC2",14,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D CNTF100,CANTF^FHOMRC1
"RTN","FHOMRC2",15,0)
 Q
"RTN","FHOMRC2",16,0)
CNAO100 ;Backdoor message to update file #100 with AO cancel order
"RTN","FHOMRC2",17,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,4),FILL="A;"_FHRNUM D CAN Q
"RTN","FHOMRC2",18,0)
CNEL100 ;Backdoor message to update file #100 with EL cancel order
"RTN","FHOMRC2",19,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,5),FILL="E;"_FHRNUM D CAN Q
"RTN","FHOMRC2",20,0)
CNTF100 ;Backdoor message to update file #100 with TF cancel order
"RTN","FHOMRC2",21,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,4),FILL="T;"_FHRNUM D CAN Q
"RTN","FHOMRC2",22,0)
CNIP100 ;Backdoor message to update file #100 with IP cancel order
"RTN","FHOMRC2",23,0)
 S FHORN=$P($G(^FHPT(FHDFN,0)),U,6),FILL="I;CANCEL" D CAN Q
"RTN","FHOMRC2",24,0)
CNSM100 ;Backdoor message to update file #100 with SM cancel order
"RTN","FHOMRC2",25,0)
 S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12),FILL="S;"_FHDA D CAN
"RTN","FHOMRC2",26,0)
 ;if an SM E/L Tray exists cancel that too:
"RTN","FHOMRC2",27,0)
CNSMEL S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,1)),U,4) I FHORN="" Q
"RTN","FHOMRC2",28,0)
 S FILL="G;"_FHDA D CAN Q
"RTN","FHOMRC2",29,0)
CAN ;
"RTN","FHOMRC2",30,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRC2",31,0)
 D MSHCA^FHOMUTL,EVSEND^FHWOR
"RTN","FHOMRC2",32,0)
 Q
"RTN","FHOMRC2",33,0)
CANOCC ; If cancelling occurences of RM (not ALL) then send "XX" message
"RTN","FHOMRC2",34,0)
 ; instead of "OC" which will cancel the entire order in CPRS.
"RTN","FHOMRC2",35,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRC2",36,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRC2",37,0)
 S FHOSTDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHOMRC2",38,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT)
"RTN","FHOMRC2",39,0)
 S MSG(4)="ORC|XX|"_FHORN_"^OR|"_FILL_"^FH||||^^^"_FHOSTDT_"^"_FHOSTDT
"RTN","FHOMRC2",40,0)
 S MSG(5)="ODS|||^^^FH-X^Meal Canceled^99OTH|"
"RTN","FHOMRC2",41,0)
 D EVSEND^FHWOR
"RTN","FHOMRC2",42,0)
 Q
"RTN","FHOMRC2",43,0)
CHECK ; Check if there are other "active" RM's to determine if entire order
"RTN","FHOMRC2",44,0)
 ; should be cancelled
"RTN","FHOMRC2",45,0)
 S FHACTV=0,FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHOMRC2",46,0)
 F FHINDX=0:0 S FHINDX=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHINDX)) Q:FHINDX'>0!(FHACTV=1)  D
"RTN","FHOMRC2",47,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHINDX,0)),U,1)<DT Q
"RTN","FHOMRC2",48,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHINDX,0)),U,15)'="C" S FHACTV=1
"RTN","FHOMRC2",49,0)
 .Q
"RTN","FHOMRC2",50,0)
 Q
"RTN","FHOMRE1")
0^3^B21010791
"RTN","FHOMRE1",1,0)
FHOMRE1 ;Hines OIFO/RTK OUTPATIENT MEALS EARLY/LATE TRAY  ;5/20/03  08:35
"RTN","FHOMRE1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMRE1",3,0)
 ;
"RTN","FHOMRE1",4,0)
 S FHMSG1="E" D EN1,END Q
"RTN","FHOMRE1",5,0)
EN1 D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRE1",6,0)
 K NUM D DISP^FHOMRR1 I $G(NUM)="" Q
"RTN","FHOMRE1",7,0)
EL1 K DIR S DIR(0)="NAO^1:"_NUM,DIR("A")="Early/Late Tray For Which Order? "
"RTN","FHOMRE1",8,0)
 D ^DIR Q:$D(DIRUT)
"RTN","FHOMRE1",9,0)
 S FHRMSEL=Y,FHC=FHRMSEL,FHRNUM=$P(FHLIST(FHRMSEL),U,1)
"RTN","FHOMRE1",10,0)
 S FHRMDT=$P(FHLIST(FHRMSEL),U,2),Y=FHRMDT D DD^%DT W !,Y,!
"RTN","FHOMRE1",11,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" W !!?3,"The selected order has been cancelled!",! D EL1 Q
"RTN","FHOMRE1",12,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) W !,"Early/Late Tray already exists for this meal." K DIR S DIR(0)="YA",DIR("A")="Do you wish to overwrite? ",DIR("B")="N" D ^DIR Q:$D(DIRUT)  Q:Y'=1
"RTN","FHOMRE1",13,0)
 ; Only allow selection of one order at a time, rather than a range
"RTN","FHOMRE1",14,0)
 ; because they could be different meals which could have different
"RTN","FHOMRE1",15,0)
 ; allowable meal window times.
"RTN","FHOMRE1",16,0)
 K DIR S DIR(0)="SAO^E:EARLY;L:LATE",DIR("A")="Early or Late (E or L)? "
"RTN","FHOMRE1",17,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",18,0)
 S FHEL=Y
"RTN","FHOMRE1",19,0)
ORD S FHLOC=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,3),FHORN="",FHMSG1="E"
"RTN","FHOMRE1",20,0)
 S FHDIET=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,2)
"RTN","FHOMRE1",21,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMRE1",22,0)
 S FHMEAL=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)
"RTN","FHOMRE1",23,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMRE1",24,0)
TIME S FH3=FH1+2,FHCNT=0 F FHT=FH1:1:FH3 D
"RTN","FHOMRE1",25,0)
 .I $P(FHCOMM1,U,FHT)="" Q
"RTN","FHOMRE1",26,0)
 .S FHCNT=FHCNT+1,FHTM(FHCNT)=$P(FHCOMM1,U,FHT)
"RTN","FHOMRE1",27,0)
 W !,"Select Time: ( " F J=1:1:FHCNT W J,"=",FHTM(J)," "
"RTN","FHOMRE1",28,0)
 R ") ",FHS:DTIME I FHS=""!(FHS["^") D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",29,0)
 I (FHS'?1N)!(FHS<1)!(FHS>FHCNT) W !!,"Invalid time selection!" D TIME Q
"RTN","FHOMRE1",30,0)
 S FHTIME=FHTM(FHS),X=FHRMDT_"@"_FHTIME,%DT="XT" D ^%DT S FHDTM=Y
"RTN","FHOMRE1",31,0)
 D NOW^%DTC I FHDTM<% W !!,"Cannot order for a Date/Time before now!" D TIME Q
"RTN","FHOMRE1",32,0)
 K DIR S DIR(0)="SAO^Y:Yes;N:No",DIR("A")="Bagged Meal? ",DIR("B")="N"
"RTN","FHOMRE1",33,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",34,0)
 S FHBAG=Y
"RTN","FHOMRE1",35,0)
 D SET,UPD100,OKMSG^FHOMUTL,END Q
"RTN","FHOMRE1",36,0)
 ;
"RTN","FHOMRE1",37,0)
SET S DA=FHRNUM,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRE1",38,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMRE1",39,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMRE1",40,0)
 S DR="14////^S X=FHTIME;15////^S X=FHBAG;16////^S X=DUZ;17////^S X=FHTODAY;17.5////^S X=FHORN;17.6////^S X=""@""" D ^DIE
"RTN","FHOMRE1",41,0)
 S FHACT="O",FHOPTY="E",FHAET=FHTIME D SETAET^FHOMRO2
"RTN","FHOMRE1",42,0)
 Q
"RTN","FHOMRE1",43,0)
END K A,FHFIND,FHCLST,FHC,FHCOMM,FH1,FH3,FHTEXT,NUM
"RTN","FHOMRE1",44,0)
 K FHSEL,FHT,FHCNT,FHCOMM1,FHS Q
"RTN","FHOMRE1",45,0)
 Q
"RTN","FHOMRE1",46,0)
HL7SET ;
"RTN","FHOMRE1",47,0)
 ; Entry point for E/L trays placed from CPRS/OERR
"RTN","FHOMRE1",48,0)
 S (FHRFLG,FHSFLG)=0,FHMEAL=$E(FHSVCP,1),FILL=""
"RTN","FHOMRE1",49,0)
 S FHEL=$E(FHSVCP,2),FHTM=$E(FHSVCP,3)
"RTN","FHOMRE1",50,0)
 I FHEL'?1"E",FHEL'?1"L" S TXT="Missing E/L" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",51,0)
 I FHTM<1!(FHTM>3) S TXT="Invalid time" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",52,0)
 S FHRMDT=STDT,ENDT=FHRMDT_.9999
"RTN","FHOMRE1",53,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMRE1",54,0)
 S FH1=FH1+FHTM-1
"RTN","FHOMRE1",55,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMRE1",56,0)
 S FHTIME=$P(FHCOMM1,U,FH1),X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRE1",57,0)
RM ; Check recurring meals
"RTN","FHOMRE1",58,0)
 I '$D(^FHPT(FHDFN,"OP","B",FHRMDT)) D SM Q
"RTN","FHOMRE1",59,0)
 F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRE1",60,0)
 .Q:$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL
"RTN","FHOMRE1",61,0)
 .Q:$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C"
"RTN","FHOMRE1",62,0)
 .S FHRNUM1=FHRNUM,FHRFLG=1 D SET Q
"RTN","FHOMRE1",63,0)
 S FILL="E;"_$G(FHRNUM1)
"RTN","FHOMRE1",64,0)
SM ; Check special meals
"RTN","FHOMRE1",65,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT(FHDFN,"SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)  D SETELSM
"RTN","FHOMRE1",66,0)
 ;
"RTN","FHOMRE1",67,0)
 I FHRFLG=0,FHSFLG=0 D REJECT Q
"RTN","FHOMRE1",68,0)
 I FILL="" D REJECT Q
"RTN","FHOMRE1",69,0)
 D SEND^FHWOR
"RTN","FHOMRE1",70,0)
 Q
"RTN","FHOMRE1",71,0)
SETELSM ; Set E/L for Special Meals
"RTN","FHOMRE1",72,0)
 Q:$P($G(^FHPT(FHDFN,"SM",FHSMDT,0)),U,9)'=FHMEAL
"RTN","FHOMRE1",73,0)
 S FHSFLG=1,DA=FHSMDT,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMRE1",74,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMRE1",75,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN),FILL="G;"_FHSMDT
"RTN","FHOMRE1",76,0)
 S DR="8////^S X=FHTIME;9////^S X=FHBAG;10////^S X=DUZ;11////^S X=FHORN" D ^DIE
"RTN","FHOMRE1",77,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHSMDT,0))
"RTN","FHOMRE1",78,0)
 S FHACT="O",FHOPTY="S",FHSTAT="",FHOPDT=FHTODAY D SETSM^FHOMRO2
"RTN","FHOMRE1",79,0)
 Q
"RTN","FHOMRE1",80,0)
REJECT ; Reject if no recurring or special meals found
"RTN","FHOMRE1",81,0)
 S TXT="No Recurring or Special Meal ordered for this date/meal"
"RTN","FHOMRE1",82,0)
 D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",83,0)
 Q
"RTN","FHOMRE1",84,0)
UPD100 ;Backdoor message to update file #100 with a new EL order
"RTN","FHOMRE1",85,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRE1",86,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRE1",87,0)
 S FILL="E;"_FHRNUM,FHODT=$$FMTHL7^XLFDT(FHRMDT)
"RTN","FHOMRE1",88,0)
 S FHOMELN=FHMEAL_FHEL_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHOMRE1",89,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHTODAY
"RTN","FHOMRE1",90,0)
 S MSG(5)="ODT|"_$S(FHEL="E":"EARLY",1:"LATE")_"|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHOMRE1",91,0)
 D EVSEND^FHWOR
"RTN","FHOMRE1",92,0)
 Q
"RTN","FHOMRO1")
0^10^B64076466
"RTN","FHOMRO1",1,0)
FHOMRO1 ;Hines OIFO/RTK RECURRING MEALS ORDER EDIT  ;2/04/03  14:05
"RTN","FHOMRO1",2,0)
 ;;5.5;DIETETICS;**1,2**;Jan 28, 2005
"RTN","FHOMRO1",3,0)
 ;
"RTN","FHOMRO1",4,0)
 S FHDIET="" F FHDX=1:1:5 S FHDIETX(FHDX)=""
"RTN","FHOMRO1",5,0)
 S FHMSG1="R" D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMRO1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMRO1",7,0)
 D NOW^%DTC S X1=$E(%,1,7),X2=-1 D C^%DTC S FHNOW=X D CHECK
"RTN","FHOMRO1",8,0)
 I FHEXST=1 D ORDEDT,END Q
"RTN","FHOMRO1",9,0)
 D ORDER,END Q
"RTN","FHOMRO1",10,0)
ORDEDT ;
"RTN","FHOMRO1",11,0)
 W !!,"This person has an existing outpatient diet order."
"RTN","FHOMRO1",12,0)
 K DIR S DIR(0)="SBO^E:Edit;O:New Order"
"RTN","FHOMRO1",13,0)
 S DIR("A")="Edit the existing diet or order another one" D ^DIR
"RTN","FHOMRO1",14,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",15,0)
 I Y="O" D ORDER Q
"RTN","FHOMRO1",16,0)
 I Y="E" D EDIT Q
"RTN","FHOMRO1",17,0)
 Q
"RTN","FHOMRO1",18,0)
ORDER ;
"RTN","FHOMRO1",19,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",20,0)
DIETORD ;
"RTN","FHOMRO1",21,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" EXMSG^FHOMUTL Q:FHDIETX(1)=""  D DATE Q
"RTN","FHOMRO1",22,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",23,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMRO1",24,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",25,0)
 S DIC("B")=FHDEF,DIC("S")="I $D(FHDIETS(+Y))" D ^DIC
"RTN","FHOMRO1",26,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",27,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",28,0)
 S FHDIET=+Y
"RTN","FHOMRO1",29,0)
DATE ;
"RTN","FHOMRO1",30,0)
 K DIR S DIR("A")="Select Start Date: ",DIR(0)="DAO^DT" D ^DIR
"RTN","FHOMRO1",31,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",32,0)
 S (FHOSTDT,STDT)=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",33,0)
 S FHMAX=$P($G(^FH(119.6,FHLOC,1)),U,2) I FHMAX="" S FHMAX=999
"RTN","FHOMRO1",34,0)
 D NOW^%DTC S FHTODAY=$E(%,1,7),X1=FHTODAY,X2=FHMAX D C^%DTC S FHCUT=X
"RTN","FHOMRO1",35,0)
 K DIR S DIR("A")="Select End Date: ",DIR(0)="DAO^"_STDT_":"_FHCUT D ^DIR
"RTN","FHOMRO1",36,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",37,0)
 S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",38,0)
DAYS ;
"RTN","FHOMRO1",39,0)
 S FHIFLG=0 D SHDAYS
"RTN","FHOMRO1",40,0)
 K DIR S DIR("A")="Select Days of Week: ",DIR(0)="FAO"
"RTN","FHOMRO1",41,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",42,0)
 S FHDAYS=Y D DAYCHK I FHIFLG=1 D DAYS Q
"RTN","FHOMRO1",43,0)
 K DIR S DIR("A")="Select MEAL: "
"RTN","FHOMRO1",44,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMRO1",45,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",46,0)
 S FHMEAL=Y W !
"RTN","FHOMRO1",47,0)
 K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRO1",48,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",49,0)
 S STDTMP=STDT,FHTDTMP=FHTODAY D CHK1^FHOMRO2
"RTN","FHOMRO1",50,0)
 D SETNODE,UPD100
"RTN","FHOMRO1",51,0)
 I FHSETFLG=0 W !!!?5,"No meals ordered!",! Q
"RTN","FHOMRO1",52,0)
 S FHACT="O",FHOPTY="R" D SETORX^FHOMRO2
"RTN","FHOMRO1",53,0)
 S FHMSG1="R" D OKMSG^FHOMUTL
"RTN","FHOMRO1",54,0)
 S FHLTFLG=0 I STDTMP=FHTDTMP D CHK2^FHOMRO2
"RTN","FHOMRO1",55,0)
 I FHLTFLG=1 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHTODAY,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",56,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",57,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",58,0)
 .S FHEL="L",FHRMDT=FHTODAY D ORD^FHOMRE1
"RTN","FHOMRO1",59,0)
 Q
"RTN","FHOMRO1",60,0)
SETNODE ;
"RTN","FHOMRO1",61,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1) I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMRO1",62,0)
 S FHMPNUM=FHMPNUM+1,FHSETFLG=0
"RTN","FHOMRO1",63,0)
 K ODAYS S CCC=0,X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRO1",64,0)
 S ENDL=0 F  Q:ENDL=1  D
"RTN","FHOMRO1",65,0)
 .S CCC=CCC+1,X1=STDT,X2=1 D C^%DTC S STDT=X
"RTN","FHOMRO1",66,0)
 .I STDT>ENDT S ENDL=1 Q
"RTN","FHOMRO1",67,0)
 .S X=STDT D DOW^%DTC
"RTN","FHOMRO1",68,0)
 .I FHDAYS[$E("XMTWRFS",Y+1) S ODAYS(STDT)=STDT D SET
"RTN","FHOMRO1",69,0)
 .Q
"RTN","FHOMRO1",70,0)
 Q
"RTN","FHOMRO1",71,0)
SET ;
"RTN","FHOMRO1",72,0)
 S FHPREVML=0 D PREV I FHPREVML=1 Q
"RTN","FHOMRO1",73,0)
 S FHSETFLG=1
"RTN","FHOMRO1",74,0)
 ;I $O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",75,0)
 S Y=STDT K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",76,0)
 S DIC(0)="L"  ;,DIC("P")=$P(^DD(115,16,0),U,2),X=+Y,DINUM=X
"RTN","FHOMRO1",77,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMRO1",78,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",79,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN),DA=+Y
"RTN","FHOMRO1",80,0)
 S DR="1////^S X=FHDIET;2////^S X=FHLOC;3////^S X=FHMEAL;5////^S X=FHMPNUM;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);.05////^S X=FHORN;24.5////^S X=DUZ" D ^DIE
"RTN","FHOMRO1",81,0)
 Q
"RTN","FHOMRO1",82,0)
MULTDT ;
"RTN","FHOMRO1",83,0)
 S FHDIET="@" F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",84,0)
 D ^FHOMRO3 I $O(FHDI(0))="" F FHDX=1:1:5 S FHDIETX(FHDX)="" Q
"RTN","FHOMRO1",85,0)
 S FHDX=0 F FHD0=0:0 S FHD0=$O(FHDI(FHD0)) Q:FHD0=""  S FHDX=FHDX+1,FHDIETX(FHDX)=$P(FHDI(FHD0),"^",1)
"RTN","FHOMRO1",86,0)
 Q
"RTN","FHOMRO1",87,0)
SHDAYS ;
"RTN","FHOMRO1",88,0)
 W !!,"          Mon  Tues  Wed  Thur  Fri  Sat  Sun"
"RTN","FHOMRO1",89,0)
 W !,"           M     T    W     R    F    S    X"
"RTN","FHOMRO1",90,0)
 W !!,"Enter string of characters for desired days of week: e.g., MWF",!
"RTN","FHOMRO1",91,0)
 Q
"RTN","FHOMRO1",92,0)
DAYCHK ;
"RTN","FHOMRO1",93,0)
 S X=FHDAYS D TR^FH S FHDAYS=X
"RTN","FHOMRO1",94,0)
 S X1="" F K=1:1 S Z=$E(FHDAYS,K) Q:Z=""!(FHIFLG=1)  D
"RTN","FHOMRO1",95,0)
 .I X1[Z S FHIFLG=1 Q
"RTN","FHOMRO1",96,0)
 .I "MTWRFSX"'[Z S FHIFLG=1 Q
"RTN","FHOMRO1",97,0)
 .S X1=X1_Z Q
"RTN","FHOMRO1",98,0)
 I FHIFLG=1 W !!,"Please enter the desired days of the week.",!
"RTN","FHOMRO1",99,0)
 Q
"RTN","FHOMRO1",100,0)
PREV ;
"RTN","FHOMRO1",101,0)
 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0!(FHPREVML=1)  D
"RTN","FHOMRO1",102,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",103,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",104,0)
 .D PATNAME^FHOMUTL S FHPREDT=$$FMTE^XLFDT(STDT,"P") I $G(FHHL7)'=1 D
"RTN","FHOMRO1",105,0)
 ..W !!?3,FHPTNM," ALREADY HAS A "
"RTN","FHOMRO1",106,0)
 ..W $S(FHMEAL="B":"BREAKFAST",FHMEAL="N":"NOON",1:"EVENING")
"RTN","FHOMRO1",107,0)
 ..W " MEAL ORDERED FOR ",FHPREDT
"RTN","FHOMRO1",108,0)
 .S FHPREVML=1
"RTN","FHOMRO1",109,0)
 Q
"RTN","FHOMRO1",110,0)
CHECK ;
"RTN","FHOMRO1",111,0)
 S FHEXST=0 I $O(^FHPT(FHDFN,"OP","B",FHNOW)) D
"RTN","FHOMRO1",112,0)
 .F FHRMDT=FHNOW:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)'="C" S FHEXST=1
"RTN","FHOMRO1",113,0)
 Q
"RTN","FHOMRO1",114,0)
END ;Kill local variables before exiting
"RTN","FHOMRO1",115,0)
 K A,AA,AB,CCC,CONT,ENDL,ENDT,FHDFN,FHDAYS,FHDEF,FHDIET,FHDIETS
"RTN","FHOMRO1",116,0)
 K FHDIETX1,FHDIETX2,FHDIETX3,FHDIETX4,FHDIETX5,FHEXST,FHIFLG,FHLOC
"RTN","FHOMRO1",117,0)
 K FHMPNUM,FHYIEN,FLAG,J,FHMEAL,MLT,ODAYS,SPDIETS,STDT
"RTN","FHOMRO1",118,0)
 Q
"RTN","FHOMRO1",119,0)
EDIT ;
"RTN","FHOMRO1",120,0)
 D NOW^%DTC S STDT=$E(%,1,7),FHDTRLE=%
"RTN","FHOMRO1",121,0)
 D DISP^FHOMRR1
"RTN","FHOMRO1",122,0)
EDT1 K DIR S DIR(0)="NAO^1:"_NUM,DIR("A")="Edit Which Order? " D ^DIR
"RTN","FHOMRO1",123,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",124,0)
 S ORDNUM=Y,Y=$P(FHLIST(ORDNUM),U,2) D DD^%DT W !,Y,!
"RTN","FHOMRO1",125,0)
 S DA=$P(FHLIST(ORDNUM),U,1),DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",126,0)
 I $P($G(^FHPT(FHDFN,"OP",DA,0)),U,15)="C" W !!?3,"The selected order has been cancelled!",! D EDT1 Q
"RTN","FHOMRO1",127,0)
 S FHLPT=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,3),FHMEAL=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,4)
"RTN","FHOMRO1",128,0)
 D OUTLOC I FHLOC="" D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",129,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" UPXMSG^FHOMUTL Q:FHDIETX(1)=""  S FHDIET="@" D SETEDT Q
"RTN","FHOMRO1",130,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",131,0)
 S FHDEF2=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,2) I FHDEF2'="" S FHDEF=$P($G(^FH(111,FHDEF2,0)),U,1)
"RTN","FHOMRO1",132,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",133,0)
 S DIC("B")=FHDEF,DIC("S")="I FHSPDTS[$P(^(0),U)" D ^DIC
"RTN","FHOMRO1",134,0)
 I $D(DUOUT) D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",135,0)
 I Y=-1 D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",136,0)
 S FHDIET=+Y F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",137,0)
 ;
"RTN","FHOMRO1",138,0)
SETEDT ;
"RTN","FHOMRO1",139,0)
 W ! S FHZDA=DA,DR="2////^S X=FHLOC;1////^S X=FHDIET;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);25////^S X=FHDTRLE;24.5////^S X=DUZ"
"RTN","FHOMRO1",140,0)
 D ^DIE,UPDMSG^FHOMUTL,ED100
"RTN","FHOMRO1",141,0)
 Q
"RTN","FHOMRO1",142,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMRO1",143,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMRO1",144,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ",DIC("B")=FHLPT
"RTN","FHOMRO1",145,0)
 S DIC("A")="Select OUTPATIENT LOCATION: "
"RTN","FHOMRO1",146,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMRO1",147,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMRO1",148,0)
 S FHLOC=+Y Q
"RTN","FHOMRO1",149,0)
 ;
"RTN","FHOMRO1",150,0)
UPD100 ;Backdoor message to update file #100 with a new RM order
"RTN","FHOMRO1",151,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRO1",152,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",153,0)
 K N1 S FHODAYS=""
"RTN","FHOMRO1",154,0)
 F N=1:1:7 S FH1=$E(FHDAYS,N) Q:FH1=""  S M=$F("MTWRFSX",FH1)-1,N1(M)=""
"RTN","FHOMRO1",155,0)
 F N=0:0 S N=$O(N1(N)) Q:N'>0  S FHODAYS=FHODAYS_"~QJ"_N
"RTN","FHOMRO1",156,0)
 S FHODAYS=$E(FHODAYS,2,999)
"RTN","FHOMRO1",157,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",158,0)
 I FHDIET'="@" S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",159,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(ENDT)
"RTN","FHOMRO1",160,0)
 S FHOTDAY=$$FMTHL7^XLFDT(FHTODAY)
"RTN","FHOMRO1",161,0)
 S FILL="R;"_FHMPNUM_";"_FHOSTDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMRO1",162,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^"_FHODAYS_"^^"_FHOSTDT_"^"_FHOENDT_"||||||||"_FHOTDAY
"RTN","FHOMRO1",163,0)
 I FHDIET'="@" S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",164,0)
 I FHDIET="@" D
"RTN","FHOMRO1",165,0)
 .F N=0:0 S N=$O(FHDIETX(N)) Q:N'>0  Q:FHDIETX(N)=""  S FHODNM=$P($G(^FH(111,FHDIETX(N),0)),U,1),MSG(N+4)="ODS|D|"_FHOMEAL_"|^^^"_FHDIETX(N)_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",166,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",167,0)
 Q
"RTN","FHOMRO1",168,0)
ED100 ;Backdoor message to update file #100 with an edited RM order
"RTN","FHOMRO1",169,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRO1",170,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",171,0)
 S (FHOSTDT,FHOENDT)=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,1)
"RTN","FHOMRO1",172,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(FHOENDT)
"RTN","FHOMRO1",173,0)
 S FILL="RMEDIT;"_FHZDA,FHORN=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,12)
"RTN","FHOMRO1",174,0)
 S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",175,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",176,0)
 S MSG(4)="ORC|XX|"_FHORN_"^OR|"_FILL_"^FH||||^^^"_FHOSTDT_"^"_FHOENDT_"||||||||"
"RTN","FHOMRO1",177,0)
 S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",178,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",179,0)
 Q
"RTN","FHOMRT1")
0^11^B20005276
"RTN","FHOMRT1",1,0)
FHOMRT1 ;Hines OIFO/RTK OUTPATIENT MEALS TUBEFEEDING ORDERS  ;6/02/03  14:15
"RTN","FHOMRT1",2,0)
 ;;5.5;DIETETICS;**1,2**;Jan 28, 2005
"RTN","FHOMRT1",3,0)
 ;
"RTN","FHOMRT1",4,0)
 S FHMSG1="T" D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRT1",5,0)
 K NUM D DISP^FHOMRR1 I $G(NUM)="" Q
"RTN","FHOMRT1",6,0)
TF1 W ! K DIR S DIR("A")="Select Order(s)",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMRT1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMRT1",8,0)
 S FHCAN1=0 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)'="C" S FHCAN1=1
"RTN","FHOMRT1",9,0)
 I FHCAN1=0 W !!?3,"The selected order(s) have been cancelled!",! D TF1 Q
"RTN","FHOMRT1",10,0)
FHTUB K TUN S NO=0,FHWF=$S($D(^ORD(101)):1,1:0) D ^FHORT10
"RTN","FHOMRT1",11,0)
 I $O(TUN(0))="" D EXMSG^FHOMUTL Q
"RTN","FHOMRT1",12,0)
 S (FHTC,FHTK)=0,FHORN="" W !
"RTN","FHOMRT1",13,0)
 F FHK=0:0 S FHK=$O(TUN(FHK)) Q:FHK<1  D
"RTN","FHOMRT1",14,0)
 .S FHTC=FHTC+$P(TUN(FHK),"^",4)+$P(TUN(FHK),"^",5)
"RTN","FHOMRT1",15,0)
 .S FHTK=FHTK+$P(TUN(FHK),"^",6),FHSTR=$P(TUN(FHK),"^",2)
"RTN","FHOMRT1",16,0)
 .S FHPRO=$P(TUN(FHK),"^",1)
"RTN","FHOMRT1",17,0)
 .W !,"Product: ",$P($G(^FH(118.2,FHPRO,0)),"^",1),", "
"RTN","FHOMRT1",18,0)
 .W $S(FHSTR=4:"Full",FHSTR=2:"1/2",FHSTR=1:"1/4",1:"3/4"),", "
"RTN","FHOMRT1",19,0)
 .W $P(TUN(FHK),"^",3)
"RTN","FHOMRT1",20,0)
 .Q
"RTN","FHOMRT1",21,0)
 W !!,"Total Kcal: ",FHTK,?36,"Total Quantity: ",FHTC
"RTN","FHOMRT1",22,0)
 I FHTC>5000 W !!,"WARNING: Total amount exceeds 5000ml: ",FHTC," ml",!,"Please Edit the Tubefeeding and Modify." D FHTUB Q
"RTN","FHOMRT1",23,0)
 ;
"RTN","FHOMRT1",24,0)
 W ! K DIR S DIR("A")="Tubefeeding Comment: ",DIR(0)="FAO^1:160" D ^DIR
"RTN","FHOMRT1",25,0)
 I Y="^" D EXMSG^FHOMUTL Q
"RTN","FHOMRT1",26,0)
 S FHTEXT=Y
"RTN","FHOMRT1",27,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMRT1",28,0)
 D ^DIR I $D(DIRUT)!(Y=0) D EXMSG^FHOMUTL,END Q
"RTN","FHOMRT1",29,0)
 W !
"RTN","FHOMRT1",30,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) D CHK
"RTN","FHOMRT1",31,0)
 D OKMSG^FHOMUTL Q
"RTN","FHOMRT1",32,0)
 D END Q
"RTN","FHOMRT1",33,0)
CHK ;
"RTN","FHOMRT1",34,0)
 I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)="C" S FHDTX=$P(FHRNUM,U,2),FHDTX=$$FMTE^XLFDT(FHDTX,"P") W !?3,"The order for ",$E(FHDTX,1,12)," has been cancelled -- not ordered!" Q
"RTN","FHOMRT1",35,0)
 D SET,UPD100
"RTN","FHOMRT1",36,0)
 Q
"RTN","FHOMRT1",37,0)
SET ;
"RTN","FHOMRT1",38,0)
 K ^FHPT(FHDFN,"OP",+FHRNUM,"TF") S FHEV=""
"RTN","FHOMRT1",39,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMRT1",40,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=+FHRNUM
"RTN","FHOMRT1",41,0)
 S DR="18////^S X=FHTEXT;20////^S X=FHTC;21////^S X=FHTK;21.5////^S X=FHORN;21.7////^S X=DUZ" D ^DIE
"RTN","FHOMRT1",42,0)
 F K=0:0 S K=$O(TUN(K)) Q:K<1  D
"RTN","FHOMRT1",43,0)
 .S Y=K K DIC,DO S DA(2)=FHDFN,DA(1)=+FHRNUM
"RTN","FHOMRT1",44,0)
 .S DIC="^FHPT("_DA(2)_",""OP"","_DA(1)_",""TF"","
"RTN","FHOMRT1",45,0)
 .S DIC(0)="L",DIC("P")=$P(^DD(115.016,19,0),U,2),X=+Y,DINUM=X
"RTN","FHOMRT1",46,0)
 .D FILE^DICN I Y=-1 Q
"RTN","FHOMRT1",47,0)
 .K DIE S DA(2)=FHDFN,DA(1)=+FHRNUM,DA=+Y
"RTN","FHOMRT1",48,0)
 .S FH1=$P(TUN(K),U,2),FH2=$P(TUN(K),U,3),FH3=$P(TUN(K),U,4)
"RTN","FHOMRT1",49,0)
 .S FH4=$P(TUN(K),U,5),FH5=$P(TUN(K),U,6)
"RTN","FHOMRT1",50,0)
 .S DIE="^FHPT("_DA(2)_",""OP"","_DA(1)_",""TF"","
"RTN","FHOMRT1",51,0)
 .S DR="1////^S X=FH1;2////^S X=FH2;3////^S X=FH3;4////^S X=FH4;5////^S X=FH5" D ^DIE
"RTN","FHOMRT1",52,0)
 .S X3=TUN(K),TUN=$P(X3,U,1),XX=$G(^FH(118.2,TUN,0)) D CALC^FHORX3
"RTN","FHOMRT1",53,0)
 .S FHEV=FHEV_P2_" "_$P(XX,"^",1)_", "
"RTN","FHOMRT1",54,0)
 .Q
"RTN","FHOMRT1",55,0)
 S FHACT="O",FHOPTY="T",FHAET=$E(FHEV,1,$L(FHEV)-2) D SETAET^FHOMRO2
"RTN","FHOMRT1",56,0)
 Q
"RTN","FHOMRT1",57,0)
END ;
"RTN","FHOMRT1",58,0)
 K A,FHFIND,FHCLST,FHC,FHRNUM,FHTEXT,FHTODAY,NUM Q
"RTN","FHOMRT1",59,0)
 Q
"RTN","FHOMRT1",60,0)
HL7SET ;
"RTN","FHOMRT1",61,0)
 ; Entry point for TF's placed from CPRS/OERR
"RTN","FHOMRT1",62,0)
 K TUN S (NO,TC,TK,TP,TW,S2)=0,CTR=5
"RTN","FHOMRT1",63,0)
 F NUM=1:1:5 S DATA=$G(FHMSG(CTR)) Q:DATA=""  S CTR=CTR+1,DATA1=$G(FHMSG(CTR)) Q:DATA1=""  D ^FHWOR51 S CTR=CTR+1 Q:TXT'=""
"RTN","FHOMRT1",64,0)
 I TXT'="" D ERR^FHOMWOR Q
"RTN","FHOMRT1",65,0)
 I $O(TUN(0))="" Q
"RTN","FHOMRT1",66,0)
 S (FHCOND,FHTC,FHTK)=0,FHTEXT=$E($P(DATA,"|",5),1,160)
"RTN","FHOMRT1",67,0)
 F FHK=0:0 S FHK=$O(TUN(FHK)) Q:FHK<1!(FHCOND=1)  D
"RTN","FHOMRT1",68,0)
 .I '$D(^FH(118.2,FHK)) S FHCOND=1 Q
"RTN","FHOMRT1",69,0)
 .S FHTC=FHTC+$P(TUN(FHK),"^",4)+$P(TUN(FHK),"^",5)
"RTN","FHOMRT1",70,0)
 .S FHTK=FHTK+$P(TUN(FHK),"^",6)
"RTN","FHOMRT1",71,0)
 .Q
"RTN","FHOMRT1",72,0)
 I FHCOND=1 S TXT="Invalid TF Product" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRT1",73,0)
 I FHTC>5000 S TXT="Total amount exceeds 5000ml" D ERR^FHOMWOR Q
"RTN","FHOMRT1",74,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRT1",75,0)
 F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D SET
"RTN","FHOMRT1",76,0)
 I '$D(FHRNUM) Q
"RTN","FHOMRT1",77,0)
 S FILL="T;"_FHRNUM_";"_FHTK_";"_FHTC_";"_FHTEXT_";"_FHORN
"RTN","FHOMRT1",78,0)
 D SEND^FHWOR Q
"RTN","FHOMRT1",79,0)
UPD100 ;Backdoor message to update file #100 with a new TF order
"RTN","FHOMRT1",80,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRT1",81,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRT1",82,0)
 S FILL="T;"_FHRNUM,MNUM=4,TFCOM=FHTEXT D NOW^%DTC S FHNOW=%
"RTN","FHOMRT1",83,0)
 S (FHODT,SDT)=$P(FHRNUM,U,2),FHODT=$$FMTHL7^XLFDT(FHODT)
"RTN","FHOMRT1",84,0)
 S MSG(MNUM)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"|||"_DUZ_"||"_DUZ_"|||"_FHNOW
"RTN","FHOMRT1",85,0)
 F FHTF=0:0 S FHTF=$O(TUN(FHTF)) Q:FHTF<1  S XX=$G(TUN(FHTF)) D TF1^FHWOR5
"RTN","FHOMRT1",86,0)
 D EVSEND^FHWOR
"RTN","FHOMRT1",87,0)
 Q
"RTN","FHOMSA1")
0^1^B5366452
"RTN","FHOMSA1",1,0)
FHOMSA1 ;Hines OIFO/RTK SPECIAL MEALS AUTHORIZE MEAL  ;4/11/03  12:55
"RTN","FHOMSA1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMSA1",3,0)
 ;
"RTN","FHOMSA1",4,0)
 I '$D(^XUSEC("FHAUTH",DUZ)) W !!!,"To access this option you most hold the 'FHAUTH' key!",!! H 3 Q
"RTN","FHOMSA1",5,0)
 S STDT=DT,FHS="P" D LIST^FHOMSS1 W !
"RTN","FHOMSA1",6,0)
 I NUM=0 W !,"NO PENDING SPECIAL MEALS TO AUTHORIZE" Q
"RTN","FHOMSA1",7,0)
 K DIR S DIR("A")="Select Which Meal(s)?",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMSA1",8,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMSA1",9,0)
 W ! K DIR S DIR("A")="Authorize or Deny? "
"RTN","FHOMSA1",10,0)
 S DIR(0)="SAO^A:AUTHORIZE;D:DENY",DIR("B")="A" D ^DIR
"RTN","FHOMSA1",11,0)
 Q:$D(DIRUT)  S FHSTAT=Y
"RTN","FHOMSA1",12,0)
 I FHSTAT="D" W ! K DIR S DIR("A")="Comment: ",DIR(0)="FA^1:80" D ^DIR S FHCOMM=Y
"RTN","FHOMSA1",13,0)
 I FHCOMM="^" W !!?3,"Changes NOT saved!",! H 2 Q
"RTN","FHOMSA1",14,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMSA1",15,0)
 Q:$D(DIRUT)  I Y=0 D END Q
"RTN","FHOMSA1",16,0)
 D SIG^XUSESIG I X1="" W !!?5,"<< Incorrect Electronic Signature!! >>" Q
"RTN","FHOMSA1",17,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHCDT=FHLIST(FHC) D UPD,UPD100
"RTN","FHOMSA1",18,0)
 W "  ... done" Q
"RTN","FHOMSA1",19,0)
 Q
"RTN","FHOMSA1",20,0)
UPD ;Update the status,authorizor,date/time of special meal request
"RTN","FHOMSA1",21,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMSA1",22,0)
 S DA=$P(FHCDT,U,2),FHDA=DA,DA(1)=$P(FHCDT,U,1),FHDFN=DA(1)
"RTN","FHOMSA1",23,0)
 S DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSA1",24,0)
 S DR="1////^S X=FHSTAT;5////^S X=DUZ;6////^S X=FHTODAY;7////^S X=FHCOMM"
"RTN","FHOMSA1",25,0)
 D ^DIE
"RTN","FHOMSA1",26,0)
 D ALERT
"RTN","FHOMSA1",27,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHOMSA1",28,0)
 S FHACT="O",FHOPTY="S",FHOPDT=$P(FHTODAY,".",1) D SETSM^FHOMRO2
"RTN","FHOMSA1",29,0)
 Q
"RTN","FHOMSA1",30,0)
ALERT ;Send alert back to requestor
"RTN","FHOMSA1",31,0)
 K XQA S (FHAUDA,FHDFN)=$P(FHCDT,U,1),FHAUSMDT=$P(FHCDT,U,2)
"RTN","FHOMSA1",32,0)
 S FHREQ=$P($G(^FHPT(FHAUDA,"SM",FHAUSMDT,0)),U,5) I FHREQ="" Q
"RTN","FHOMSA1",33,0)
 S FHAUSTT=$S(FHSTAT="A":"AUTHORIZED",1:"DENIED")
"RTN","FHOMSA1",34,0)
 S FHAUNAM=$P($G(^VA(200,DUZ,0)),U,1)
"RTN","FHOMSA1",35,0)
 D PATNAME^FHOMUTL
"RTN","FHOMSA1",36,0)
 S XQA(FHREQ)=""
"RTN","FHOMSA1",37,0)
 S XQAMSG=$E(FHPTNM,1,9)_" ("_$E(FHPTNM,1,1)_$P(FHSSN,"-",3)_"): "
"RTN","FHOMSA1",38,0)
 S XQAMSG=XQAMSG_"SPECIAL MEAL HAS BEEN "_FHAUSTT_" BY "_FHAUNAM
"RTN","FHOMSA1",39,0)
 D SETUP^XQALERT
"RTN","FHOMSA1",40,0)
 Q
"RTN","FHOMSA1",41,0)
UPD100 ;Backdoor message to update file #100 if SM order is denied
"RTN","FHOMSA1",42,0)
 Q:FHSTAT'="D"
"RTN","FHOMSA1",43,0)
 D PATNAME^FHOMUTL Q:'DFN
"RTN","FHOMSA1",44,0)
 S FHCATXT=FHCOMM D CNSM100^FHOMRC2
"RTN","FHOMSA1",45,0)
 Q
"RTN","FHOMSA1",46,0)
END ;
"RTN","FHOMSA1",47,0)
 K FHAUDA,FHAUNAM,FHAUSMDT,FHAUSTT,FHS,FHSTAT Q
"RTN","FHOMSC1")
0^15^B1885895
"RTN","FHOMSC1",1,0)
FHOMSC1 ;Hines OIFO/RTK SPECIAL MEALS CANCEL MEAL  ;4/15/03  8:55
"RTN","FHOMSC1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMSC1",3,0)
 ;
"RTN","FHOMSC1",4,0)
 S FHORN="",STDT=DT,FHS="ADP" D LIST^FHOMSS1 W !
"RTN","FHOMSC1",5,0)
 I NUM=0 W !,"NO SPECIAL MEALS TO CANCEL" Q
"RTN","FHOMSC1",6,0)
 K DIR S DIR("A")="Cancel Which Meal(s)?",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMSC1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMSC1",8,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMSC1",9,0)
 Q:$D(DIRUT)  I Y=0 D END Q
"RTN","FHOMSC1",10,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHCDT=FHLIST(FHC) D CAN,CNSM100^FHOMRC2
"RTN","FHOMSC1",11,0)
 W "  ... done" Q
"RTN","FHOMSC1",12,0)
 Q
"RTN","FHOMSC1",13,0)
CAN ;
"RTN","FHOMSC1",14,0)
 S FHSTAT="C"
"RTN","FHOMSC1",15,0)
 S DA=$P(FHCDT,U,2),FHDA=DA,DA(1)=$P(FHCDT,U,1),FHDFN=DA(1)
"RTN","FHOMSC1",16,0)
 I FHORN="" S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12)
"RTN","FHOMSC1",17,0)
 I '$D(^FHPT(DA(1),"SM",DA,0)) Q
"RTN","FHOMSC1",18,0)
 S DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSC1",19,0)
 S DR="1////^S X=FHSTAT;14////^S X=FHORN;11.5////^S X=FHSTAT" D ^DIE
"RTN","FHOMSC1",20,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHOMSC1",21,0)
 S FHACT="C",FHOPTY="S",FHOPDT=FHDA D SETSM^FHOMRO2
"RTN","FHOMSC1",22,0)
 Q
"RTN","FHOMSC1",23,0)
END ;
"RTN","FHOMSC1",24,0)
 K FHS,FHSTAT Q
"RTN","FHOMSP1")
0^20^B8724512
"RTN","FHOMSP1",1,0)
FHOMSP1 ;Hines OIFO/RTK SPECIAL MEALS PRINT MEAL  ;4/11/03  8:05
"RTN","FHOMSP1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMSP1",3,0)
 ;
"RTN","FHOMSP1",4,0)
 S STDT=DT,FHS="AP" D LIST^FHOMSS1 W !
"RTN","FHOMSP1",5,0)
 I NUM=0 W !,"NO AUTHORIZED OR PENDING SPECIAL MEALS TO PRINT" Q
"RTN","FHOMSP1",6,0)
 K DIR S DIR("A")="Print Which Meal(s)?",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMSP1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMSP1",8,0)
 W ! K DIR S DIR("A")="Are you sure? ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMSP1",9,0)
 Q:$D(DIRUT)  I Y=0 D END Q
"RTN","FHOMSP1",10,0)
 D DEV Q
"RTN","FHOMSP1",11,0)
DEV ;get device and set up queue
"RTN","FHOMSP1",12,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMSP1",13,0)
 I '$D(IO("Q")) U IO D PRINT,^%ZISC,END Q
"RTN","FHOMSP1",14,0)
 S ZTRTN="PRINT^FHOMSP1",ZTSAVE("STDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMSP1",15,0)
 S ZTSAVE("FHS")="",ZTSAVE("FHCDT")="",ZTSAVE("FHREQPR")=""
"RTN","FHOMSP1",16,0)
 S ZTSAVE("NUM")="",ZTSAVE("FHCLST")="",ZTSAVE("FHLIST(")=""
"RTN","FHOMSP1",17,0)
 S ZTDESC="Print Special Meals Voucher" D ^%ZTLOAD
"RTN","FHOMSP1",18,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMSP1",19,0)
 D END Q
"RTN","FHOMSP1",20,0)
PRINT ;
"RTN","FHOMSP1",21,0)
 I $G(FHREQPR)=1 D PR2 Q
"RTN","FHOMSP1",22,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHCDT=FHLIST(FHC) D PR2
"RTN","FHOMSP1",23,0)
 Q
"RTN","FHOMSP1",24,0)
PR2 ;
"RTN","FHOMSP1",25,0)
 S FHDFN=$P(FHCDT,U,1) D PATNAME^FHOMUTL S FHD=$P(FHCDT,U,2)
"RTN","FHOMSP1",26,0)
 S FHNODE=$G(^FHPT(FHDFN,"SM",FHD,0))
"RTN","FHOMSP1",27,0)
 S (LNS,UNLNS)="" F FHA=1:1:80 S LNS=LNS_"-",UNLNS=UNLNS_"_"
"RTN","FHOMSP1",28,0)
 S FHD=$E($$FMTE^XLFDT($P(FHCDT,U,2),"P"),1,12) S X=FHD D TR^FH S FHD=X
"RTN","FHOMSP1",29,0)
 S FHM=$P(FHNODE,U,9),FHSTAT=$P(FHNODE,U,2)
"RTN","FHOMSP1",30,0)
 S FHRQR=$P(FHNODE,U,5) S:FHRQR'="" FHRQR=$P($G(^VA(200,FHRQR,0)),U,1)
"RTN","FHOMSP1",31,0)
 S FHAZR=$P(FHNODE,U,6) S:FHAZR'="" FHAZR=$E($P($G(^VA(200,FHAZR,0)),U,1),1,20)
"RTN","FHOMSP1",32,0)
 S FHTTL=$P(FHNODE,U,6) S:FHTTL'="" FHTTL=$P($G(^VA(200,FHTTL,0)),U,9) I FHTTL'="" S FHTTL=$E($P($G(^DIC(3.1,FHTTL,0)),U,1),1,24)
"RTN","FHOMSP1",33,0)
 S FHMEAL=$S(FHM="B":"BREAKFAST",FHM="N":"NOON",1:"EVENING")
"RTN","FHOMSP1",34,0)
 S FHLPT=$P(FHNODE,U,3),FHLOC=$P($G(^FH(119.6,FHLPT,0)),U,1)
"RTN","FHOMSP1",35,0)
 S FHDPT=$P(FHNODE,U,4),FHDIET=$P($G(^FH(111,FHDPT,0)),U,1)
"RTN","FHOMSP1",36,0)
 W:$Y @IOF
"RTN","FHOMSP1",37,0)
 W !!!!,LNS,!?4," A U T H O R I Z E D   O U T P A T I E N T   M E A L   V O U C H E R",!,LNS
"RTN","FHOMSP1",38,0)
 W !!!,"Name of Pt:  ",$E(FHPTNM,1,20)," (",$E(FHPTNM,1,1),FHBID,")",?44,"Req Loc  :  ",$E(FHLOC,1,24)
"RTN","FHOMSP1",39,0)
 W !,"Start Date:  ",FHD,?44,"Requestor:  ",$E(FHRQR,1,24)
"RTN","FHOMSP1",40,0)
 W !,"Stop Date :  ",FHD
"RTN","FHOMSP1",41,0)
 W !!?44,"Signature:  ",$S(FHSTAT="A":"/es/"_FHAZR,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",42,0)
 W !!?44,"    Title:  ",$S(FHSTAT="A":FHTTL,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",43,0)
 W !!?44,"     Date:  ",$S(FHSTAT="A":FHD,1:$E(UNLNS,1,23))
"RTN","FHOMSP1",44,0)
 W !!!!,"Pt Authorized a:  ",FHDIET," Meal for ",FHMEAL," meal time"
"RTN","FHOMSP1",45,0)
 W !!!!!!!!!!!!,"ALTERING OR COPYING THIS MEAL VOUCHER IS PROHIBITED."
"RTN","FHOMSP1",46,0)
 W !!!!!!!!!!!!!!!!!!!,LNS,!,"In lieu of VA FORM 10-2817",!
"RTN","FHOMSP1",47,0)
 W !,"Facility:  " D SITE^FH W SITE D NOW^%DTC W ?45,$$FMTE^XLFDT(%,"P")
"RTN","FHOMSP1",48,0)
 W !,LNS
"RTN","FHOMSP1",49,0)
 Q
"RTN","FHOMSP1",50,0)
END ;
"RTN","FHOMSP1",51,0)
 K FHLPT,FHDPT,FHDIET,FHLOC,FHSTAT,FHRQR,FHTITL,FHAZR,FHMEAL Q
"RTN","FHOMSR1")
0^2^B23595025
"RTN","FHOMSR1",1,0)
FHOMSR1 ;Hines OIFO/RTK SPECIAL MEALS REQUEST MEAL  ;4/02/03  15:05
"RTN","FHOMSR1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMSR1",3,0)
 ;
"RTN","FHOMSR1",4,0)
 S (FHORN,FHDIET)="",FHKEY=0,FHMSG1="S"
"RTN","FHOMSR1",5,0)
 D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMSR1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMSR1",7,0)
 D SMSTAT^FHOMUTL I FHSTAT="P" D MESSAGE Q
"RTN","FHOMSR1",8,0)
 I $D(^XUSEC("FHAUTH",DUZ)) S FHKEY=1
"RTN","FHOMSR1",9,0)
LOC ;Prompt for outpatient location
"RTN","FHOMSR1",10,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",11,0)
DIET ;Prompt for diet
"RTN","FHOMSR1",12,0)
 D DIETLST^FHOMUTL
"RTN","FHOMSR1",13,0)
 I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMSR1",14,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMSR1",15,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMSR1",16,0)
 S DIC("B")=FHDEF,DIC("S")="I $D(FHDIETS(+Y))" D ^DIC
"RTN","FHOMSR1",17,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",18,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",19,0)
 S FHDIET=+Y
"RTN","FHOMSR1",20,0)
MEAL ;Prompt for meal
"RTN","FHOMSR1",21,0)
 K DIR,DIC S DIR("A")="Select Meal: "
"RTN","FHOMSR1",22,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMSR1",23,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",24,0)
 I Y'=-1 S FHMEAL=Y
"RTN","FHOMSR1",25,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMSR1",26,0)
 D ^DIR
"RTN","FHOMSR1",27,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",28,0)
 D NOW^%DTC S FHNOW=%,STDT=DT,FHLTFLG=0 D SMGM^FHOMRO2
"RTN","FHOMSR1",29,0)
 I SKIP=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",30,0)
 S FHQEL=1 I FHLTFLG=1 S FHSM=FHNOW,FHEL="L",FHQEL=0 D LATE I FHQEL=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",31,0)
 S FHSTAT=$S(FHKEY=1:"A",1:"P") D SETNODE,UPD100
"RTN","FHOMSR1",32,0)
 I FHQEL=0 D UPDE100
"RTN","FHOMSR1",33,0)
 D OKMSG^FHOMUTL
"RTN","FHOMSR1",34,0)
 I FHKEY=1 D PRINT
"RTN","FHOMSR1",35,0)
 I FHKEY=0 D ALERT
"RTN","FHOMSR1",36,0)
 D END Q
"RTN","FHOMSR1",37,0)
PRINT ;If user has key allow printing without sending alert to authorizor(s)
"RTN","FHOMSR1",38,0)
 W ! S DIR(0)="YA",DIR("B")="Y",DIR("A")="Print Voucher? " D ^DIR
"RTN","FHOMSR1",39,0)
 Q:$D(DIRUT)  S PRINT=Y I PRINT'=1 Q
"RTN","FHOMSR1",40,0)
 S FHCDT=FHDFN_"^"_FHNOW,FHREQPR=1 D DEV^FHOMSP1 K FHREQPR Q
"RTN","FHOMSR1",41,0)
ALERT ;Send alert to 5 Authorizors set up in file #119.9 (fields 9-13)
"RTN","FHOMSR1",42,0)
 K XQA,FHAU15 S FHAU15=$P($G(^FH(119.9,1,0)),U,7,11)
"RTN","FHOMSR1",43,0)
 F A=1:1:5 S AB=$P(FHAU15,U,A) I AB'="" S XQA(AB)=""
"RTN","FHOMSR1",44,0)
 I '$D(XQA) D
"RTN","FHOMSR1",45,0)
 .W !!?5,"NOTICE: No 'Authorizing Person(s)' defined in site "
"RTN","FHOMSR1",46,0)
 .W !!?5,"parameter (#119.9) file -- NO ALERT SENT",!! Q
"RTN","FHOMSR1",47,0)
 D PATNAME^FHOMUTL
"RTN","FHOMSR1",48,0)
 S XQAMSG=$E(FHPTNM,1,9)_" ("_$E(FHPTNM,1,1)_$P(FHSSN,"-",3)_"): "
"RTN","FHOMSR1",49,0)
 S XQAMSG=XQAMSG_"Special Meal needs authorizing" D SETUP^XQALERT
"RTN","FHOMSR1",50,0)
 Q
"RTN","FHOMSR1",51,0)
SETNODE ;
"RTN","FHOMSR1",52,0)
 S AUDUZ=$S(FHSTAT="A":DUZ,1:""),AUFHNOW=$S(FHSTAT="A":FHNOW,1:"")
"RTN","FHOMSR1",53,0)
 S (FHSMID,Y)=FHNOW K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",54,0)
 S DIC(0)="L",DIC("P")=$P(^DD(115,17,0),U,2),X=+Y,DINUM=X
"RTN","FHOMSR1",55,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMSR1",56,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",57,0)
 S DA=+Y,FHDA=DA
"RTN","FHOMSR1",58,0)
 S DR="1////^S X=FHSTAT;2////^S X=FHLOC;3////^S X=FHDIET;3.5////^S X=FHMEAL;4////^S X=DUZ;5////^S X=AUDUZ;6////^S X=AUFHNOW;14////^S X=FHORN"
"RTN","FHOMSR1",59,0)
 D ^DIE
"RTN","FHOMSR1",60,0)
 I FHQEL=0 D ORDEL
"RTN","FHOMSR1",61,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHOMSR1",62,0)
 S FHACT="O",FHOPTY="S",FHOPDT=$P(FHNOW,".",1) D SETSM^FHOMRO2
"RTN","FHOMSR1",63,0)
 Q
"RTN","FHOMSR1",64,0)
MESSAGE ;
"RTN","FHOMSR1",65,0)
 W !!,"THIS PATIENT ALREADY HAS A SPECIAL MEAL REQUEST PENDING"
"RTN","FHOMSR1",66,0)
 Q
"RTN","FHOMSR1",67,0)
END ;Kill local variables before exiting
"RTN","FHOMSR1",68,0)
 K A,AA,AB,BAG,CCC,CONT,ENDL,ENDT,FHDFN,FHDAYS,FHDEF,FHDIET,FHDIETS
"RTN","FHOMSR1",69,0)
 K FHSTAT,STDT,STDTIM Q
"RTN","FHOMSR1",70,0)
 ;
"RTN","FHOMSR1",71,0)
LATE ;
"RTN","FHOMSR1",72,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMSR1",73,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMSR1",74,0)
TIME S FH3=FH1+2,FHCNT=0 F FHT=FH1:1:FH3 D
"RTN","FHOMSR1",75,0)
 .I $P(FHCOMM1,U,FHT)="" Q
"RTN","FHOMSR1",76,0)
 .S FHCNT=FHCNT+1,FHTM(FHCNT)=$P(FHCOMM1,U,FHT)
"RTN","FHOMSR1",77,0)
 W !,"Select Time: ( " F J=1:1:FHCNT W J,"=",FHTM(J)," "
"RTN","FHOMSR1",78,0)
 R ") ",FHS:DTIME I FHS=""!(FHS["^") S FHQEL=1 Q
"RTN","FHOMSR1",79,0)
 I (FHS'?1N)!(FHS<1)!(FHS>FHCNT) W !!,"Invalid time selection!" D TIME Q
"RTN","FHOMSR1",80,0)
 S FHTIME=FHTM(FHS),X=$E(FHNOW,1,7)_"@"_FHTIME,%DT="XT" D ^%DT S FHTRAY=Y
"RTN","FHOMSR1",81,0)
 D NOW^%DTC I FHTRAY<% W !!,"Cannot order for a time before now!" D TIME Q
"RTN","FHOMSR1",82,0)
 K DIR S DIR(0)="SAO^Y:Yes;N:No",DIR("A")="Bagged Meal? ",DIR("B")="N"
"RTN","FHOMSR1",83,0)
 D ^DIR I $D(DIRUT) S FHQEL=1 Q
"RTN","FHOMSR1",84,0)
 S FHBAG=Y
"RTN","FHOMSR1",85,0)
 Q
"RTN","FHOMSR1",86,0)
ORDEL ;
"RTN","FHOMSR1",87,0)
 S DA=FHSM,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",88,0)
 S DR="8////^S X=FHTIME;9////^S X=FHBAG;10////^S X=DUZ" D ^DIE
"RTN","FHOMSR1",89,0)
 Q
"RTN","FHOMSR1",90,0)
UPD100 ;Backdoor message to update file #100 with a new SM order
"RTN","FHOMSR1",91,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",92,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",93,0)
 S FILL="S;"_FHNOW
"RTN","FHOMSR1",94,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMSR1",95,0)
 S FHDIETNM=$P($G(^FH(111,FHDIET,0)),U,1),FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",96,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHODT
"RTN","FHOMSR1",97,0)
 S MSG(5)="ODS|S|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHDIETNM_"^99FHD|"
"RTN","FHOMSR1",98,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",99,0)
 Q
"RTN","FHOMSR1",100,0)
UPDE100 ;Backdoor message to update file #100 with a new SM Late Tray order
"RTN","FHOMSR1",101,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",102,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",103,0)
 S FILL="G;"_FHNOW,FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",104,0)
 S FHTRAY=$$FMTHL7^XLFDT(FHTRAY)
"RTN","FHOMSR1",105,0)
 S FHOMELN=FHMEAL_"L"_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHOMSR1",106,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHTRAY_"^"_FHTRAY_"||||||||"_FHODT
"RTN","FHOMSR1",107,0)
 S MSG(5)="ODT|LATE|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHOMSR1",108,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",109,0)
 Q
"RTN","FHOMUTL")
0^12^B32969388
"RTN","FHOMUTL",1,0)
FHOMUTL ;Hines OIFO/RTK OUTPATIENT MEALS UTILITIES  ;2/04/03  15:15
"RTN","FHOMUTL",2,0)
 ;;5.5;DIETETICS;**1,2**;Jan 28, 2005
"RTN","FHOMUTL",3,0)
 ;
"RTN","FHOMUTL",4,0)
DIV ;ask for Communication office if Multi-division.
"RTN","FHOMUTL",5,0)
 N FHSCNT,FH
"RTN","FHOMUTL",6,0)
 K FHSITE,FHSITENM
"RTN","FHOMUTL",7,0)
 S FHSCNT=0 F FH=0:0 S FH=$O(^FH(119.73,FH)) Q:FH'>0  S FHSCNT=FHSCNT+1,FHSITE=FH,FHSITENM=$P($G(^FH(119.73,FH,0)),U,1)
"RTN","FHOMUTL",8,0)
 I (FHSCNT=1),($P($G(^FH(119.9,1,0)),U,20)'="Y") Q
"RTN","FHOMUTL",9,0)
D2 I FHSCNT>1 K FHSITE,FHSITENM,X R !!,"Select COMMUNICATION OFFICE (or ALL): ALL// ",X:DTIME S:X="" X="ALL" Q:'$T!("^"[X)  D TR^FH I X="ALL" S FHSITE=0
"RTN","FHOMUTL",10,0)
 I X'="ALL" K DIC S DIC="^FH(119.73,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S FHSITE=+Y,FHSITENM=$P(Y,U,2)
"RTN","FHOMUTL",11,0)
 Q
"RTN","FHOMUTL",12,0)
 ;
"RTN","FHOMUTL",13,0)
STDATE ;Prompt for start date (if FHPSDT="N" do not allow past dates)
"RTN","FHOMUTL",14,0)
 S STDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y
"RTN","FHOMUTL",15,0)
 K DIR S DIR("A")="Select Start Date: ",DIR("B")=FHDTDF
"RTN","FHOMUTL",16,0)
 S DIR(0)="DAO" I $G(FHPSDT)="N" S DIR(0)="DAO^FHDTDF"
"RTN","FHOMUTL",17,0)
 D ^DIR Q:$D(DIRUT)  S STDT=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",18,0)
 Q
"RTN","FHOMUTL",19,0)
ENDATE ;Prompt for end date
"RTN","FHOMUTL",20,0)
 S ENDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y K DIR
"RTN","FHOMUTL",21,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT D ^DIR
"RTN","FHOMUTL",22,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",23,0)
 Q
"RTN","FHOMUTL",24,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMUTL",25,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMUTL",26,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ"
"RTN","FHOMUTL",27,0)
 S DIC("A")="Select Outpatient Ordering Location: "
"RTN","FHOMUTL",28,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMUTL",29,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMUTL",30,0)
 S FHLOC=+Y,FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8)
"RTN","FHOMUTL",31,0)
 Q
"RTN","FHOMUTL",32,0)
 ;
"RTN","FHOMUTL",33,0)
GTFHDFN ;Get FHDFN, given DFN
"RTN","FHOMUTL",34,0)
 K DIR S DIR(0)="NAO",DIR("B")="ENTER DFN" D ^DIR Q:$D(DIRUT)  S ZZDFN=Y
"RTN","FHOMUTL",35,0)
 S FHZ115="P"_ZZDFN,FHDFN=$O(^FHPT("B",FHZ115,""))
"RTN","FHOMUTL",36,0)
 I '$D(^DPT(ZZDFN)) W !!,"DFN '",ZZDFN,"' NOT FOUND IN FILE 2",! Q
"RTN","FHOMUTL",37,0)
 I FHDFN="" W !!,"NO CORRESPONDING FHDFN"
"RTN","FHOMUTL",38,0)
 W !!," NAME: ",$P($G(^DPT(ZZDFN,0)),U,1)
"RTN","FHOMUTL",39,0)
 W !?2,"DFN: ",ZZDFN,!,"FHDFN: ",FHDFN,!
"RTN","FHOMUTL",40,0)
 Q
"RTN","FHOMUTL",41,0)
GETOPT ;Select outpatient for recurring meals
"RTN","FHOMUTL",42,0)
 S FHFIND=1 D ^FHOMDPA I FHDFN="" S FHFIND=0 Q
"RTN","FHOMUTL",43,0)
 I '$D(^FHPT(FHDFN,0)) S FHFIND=0 Q  ;W !!,"UNKNOWN SELECTION !"
"RTN","FHOMUTL",44,0)
 I $O(^FHPT(FHDFN,"OP",0))="" W !!,"NO RECURRING MEALS FOR THIS PERSON" S FHFIND=0 Q
"RTN","FHOMUTL",45,0)
 W ! D STDATE I STDT="" S FHFIND=0 Q
"RTN","FHOMUTL",46,0)
 Q
"RTN","FHOMUTL",47,0)
PATNAME ;Get name and demographics of patient/new person
"RTN","FHOMUTL",48,0)
 ;input variable: FHDFN
"RTN","FHOMUTL",49,0)
 S (FHDOB,FHBID,FHSEX,DFN)="" D GETZN
"RTN","FHOMUTL",50,0)
 I FILE="P" S FHPTNM=$P($G(^DPT(IEN,0)),U,1)
"RTN","FHOMUTL",51,0)
 I FILE="N" S FHPTNM=$P($G(^VA(200,IEN,0)),U,1)
"RTN","FHOMUTL",52,0)
 ;Get SSN,Age,DOB,Sex of patient/new person
"RTN","FHOMUTL",53,0)
 I FILE="P" D
"RTN","FHOMUTL",54,0)
 .S DFN=IEN
"RTN","FHOMUTL",55,0)
 .D PID^FHDPA S FHSSN=PID
"RTN","FHOMUTL",56,0)
 .S FHSEX=$P($G(^DPT(DFN,0)),U,2),FHDOB=$P($G(^DPT(DFN,0)),U,3)
"RTN","FHOMUTL",57,0)
 .S FHBID=BID
"RTN","FHOMUTL",58,0)
 I FILE="N" D
"RTN","FHOMUTL",59,0)
 .S IEN200=IEN,FHSSN=$P($G(^VA(200,IEN,1)),U,9)
"RTN","FHOMUTL",60,0)
 .S FHBID=$E(FHSSN,6,$L(FHSSN))
"RTN","FHOMUTL",61,0)
 .S FHSEX=$P($G(^VA(200,IEN,1)),U,2),FHDOB=$P($G(^VA(200,IEN,1)),U,3)
"RTN","FHOMUTL",62,0)
 S FHAGE="" D NOW^%DTC
"RTN","FHOMUTL",63,0)
 I FHDOB'="" S FHAGE=$E(%,1,3)-$E(FHDOB,1,3)-($E(%,4,7)<$E(FHDOB,4,7))
"RTN","FHOMUTL",64,0)
 Q
"RTN","FHOMUTL",65,0)
GETZN ;Get first piece of zero node in 115
"RTN","FHOMUTL",66,0)
 S FHPCZN=$P($G(^FHPT(FHDFN,0)),U,1),FILE=$E(FHPCZN,1)
"RTN","FHOMUTL",67,0)
 S IEN=$E(FHPCZN,2,99)
"RTN","FHOMUTL",68,0)
 Q
"RTN","FHOMUTL",69,0)
DIETVER ;Verify that diet selected is from the allowable diets in 119.9
"RTN","FHOMUTL",70,0)
 D DIETLST I $D(FHDIETS(FHDIET)) Q
"RTN","FHOMUTL",71,0)
 S FHDIET="" W *7," ==> NOT ALLOWED",! D DIETMSG Q
"RTN","FHOMUTL",72,0)
DIETHLP ;Display allowable diets from 119.9
"RTN","FHOMUTL",73,0)
 D DIETLST,DIETMSG Q
"RTN","FHOMUTL",74,0)
DIETLST ;Build list
"RTN","FHOMUTL",75,0)
 K FHDIETS,SPD S FHSPDTS="",SPD=$P($G(^FH(119.9,1,0)),U,2,6)_"^"_$P($G(^FH(119.9,1,1)),U,1,10)
"RTN","FHOMUTL",76,0)
 S FHDEF=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHOMUTL",77,0)
 F A=1:1:15 S AB=$P(SPD,U,A) D
"RTN","FHOMUTL",78,0)
 .I AB="" Q
"RTN","FHOMUTL",79,0)
 .S FHDIETS(AB)=AB
"RTN","FHOMUTL",80,0)
 .S FHSPDTS=FHSPDTS_$P($G(^FH(111,AB,0)),U,1)_"^"
"RTN","FHOMUTL",81,0)
 Q
"RTN","FHOMUTL",82,0)
DIETMSG ;Display message
"RTN","FHOMUTL",83,0)
 W !?3,"You must select from the diets set up in the Site Parameters:"
"RTN","FHOMUTL",84,0)
 S AB="" F  S AB=$O(FHDIETS(AB)) Q:AB'>0  W !?3,$P($G(^FH(111,AB,0)),U)
"RTN","FHOMUTL",85,0)
 W ! Q
"RTN","FHOMUTL",86,0)
 Q
"RTN","FHOMUTL",87,0)
EXMSG ;Display message stating meal NOT ordered
"RTN","FHOMUTL",88,0)
 D TYPE
"RTN","FHOMUTL",89,0)
 W !!?3,FHMSGML," NOT ordered!",! H 2
"RTN","FHOMUTL",90,0)
 Q
"RTN","FHOMUTL",91,0)
OKMSG ;Display message stating meal ordered successfully
"RTN","FHOMUTL",92,0)
 D TYPE
"RTN","FHOMUTL",93,0)
 D PATNAME W !!?3,FHMSGML," ordered for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",94,0)
 Q
"RTN","FHOMUTL",95,0)
TYPE ;
"RTN","FHOMUTL",96,0)
 S FHMSGML=$S(FHMSG1="G":"Guest meal",FHMSG1="S":"Special meal",FHMSG1="R":"Recurring meal",FHMSG1="E":"Early/Late tray",FHMSG1="T":"Tubefeeding",1:"Additional order")
"RTN","FHOMUTL",97,0)
 Q
"RTN","FHOMUTL",98,0)
UPXMSG ;
"RTN","FHOMUTL",99,0)
 W !!?3,"Recurring meal NOT updated! ",! H 2
"RTN","FHOMUTL",100,0)
 Q
"RTN","FHOMUTL",101,0)
UPDMSG ;
"RTN","FHOMUTL",102,0)
 D PATNAME W !!?3,"Recurring meal updated for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",103,0)
 Q
"RTN","FHOMUTL",104,0)
SMSTAT ;Status of last special meal request
"RTN","FHOMUTL",105,0)
 S FHSMNUM=$O(^FHPT(FHDFN,"SM","B",""),-1) I FHSMNUM="" S FHSTAT="" Q
"RTN","FHOMUTL",106,0)
 I $E(FHSMNUM,1,7)'=DT S FHSTAT="" Q
"RTN","FHOMUTL",107,0)
 S FHSTAT=$P($G(^FHPT(FHDFN,"SM",FHSMNUM,0)),U,2)
"RTN","FHOMUTL",108,0)
 Q
"RTN","FHOMUTL",109,0)
RANGE ;Check for validity of range of numbers entered
"RTN","FHOMUTL",110,0)
 S FHCLST="",FLG="",X=FHNUM D TR^FH S FHNUM=X
"RTN","FHOMUTL",111,0)
 I FHNUM="A"!(FHNUM?1"A"1.2"L") S FHNUM="1-"_NUM
"RTN","FHOMUTL",112,0)
 F K=1:1 S K1=$P(FHNUM,",",K) Q:K1=""!(FLG="QUIT")  D
"RTN","FHOMUTL",113,0)
 .S K2=$S(K1["-":$P(K1,"-",2),1:+K1),K1=+K1 D CK I FLG="QUIT" Q
"RTN","FHOMUTL",114,0)
 .F K3=K1:1:K2 S FHCLST=FHCLST_K3_","
"RTN","FHOMUTL",115,0)
 Q
"RTN","FHOMUTL",116,0)
CK I K1<1!(K1>NUM)!(K1'?1N.N) D C1 Q
"RTN","FHOMUTL",117,0)
 I K2<1!(K2>NUM)!(K2'?1N.N) D C1 Q
"RTN","FHOMUTL",118,0)
 Q:K2'<K1
"RTN","FHOMUTL",119,0)
C1 W !,"  Enter numbers or range or ALL (E.G.,  1,3,4 or 3-5 or 1,3-5)" S FLG="QUIT",FHCLST="" Q
"RTN","FHOMUTL",120,0)
 Q
"RTN","FHOMUTL",121,0)
MSHOM ;Code MSG for outpatient orders
"RTN","FHOMUTL",122,0)
 D SITE^FH
"RTN","FHOMUTL",123,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",124,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",125,0)
 S FHOLOC=$O(^FH(119.6,FHLOC,"L",0)) I FHOLOC="" Q  ;RESULTS IN NO BKDOOR
"RTN","FHOMUTL",126,0)
 S FHOLOC=$G(^FH(119.6,FHLOC,"L",FHOLOC,0))
"RTN","FHOMUTL",127,0)
 S FHOLOCNM=$P($G(^SC(FHOLOC,0)),U,1)
"RTN","FHOMUTL",128,0)
 S MSG(3)="PV1||O|"_FHOLOC_"^"_FHOLOCNM_"||||||||||||||||"
"RTN","FHOMUTL",129,0)
 Q
"RTN","FHOMUTL",130,0)
MSHCA ;Code Cancel/Discontinue for outpatient orders
"RTN","FHOMUTL",131,0)
 D NOW^%DTC S FHNOW=% K MSG S ACT="OC" D SITE^FH
"RTN","FHOMUTL",132,0)
 I $G(FHCATXT)="" S FHCATXT="Dietetics Canceled order."
"RTN","FHOMUTL",133,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",134,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",135,0)
 S DATE=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMUTL",136,0)
 S MSG(3)="ORC|"_ACT_"|"_FHORN_"^OR|"_FILL_"^FH|||||||||"_DUZ_"|||"_DATE_"|"_FHCATXT
"RTN","FHOMUTL",137,0)
 Q
"RTN","FHOMUTL",138,0)
MSHSS ;Code MSG for outpatient send status messages
"RTN","FHOMUTL",139,0)
 D SITE^FH
"RTN","FHOMUTL",140,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORR"
"RTN","FHOMUTL",141,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",142,0)
 S MSG(3)="ORC|SR|"_FHORN_"^OR|"_FILL_"||"_FHSTTS
"RTN","FHOMUTL",143,0)
 Q
"RTN","FHOMUTL",144,0)
CONVC ;convert Amount/Unit in file 118.2, from "C" to "ML".
"RTN","FHOMUTL",145,0)
 F FHII=0:0 S FHII=$O(^FH(118.2,FHII)) Q:FHII'>0  D
"RTN","FHOMUTL",146,0)
 .S FHAU=$P(^FH(118.2,FHII,0),U,3)
"RTN","FHOMUTL",147,0)
 .I FHAU["C" S FHAF=$P(FHAU,"C",1),FHAS=$P(FHAU,"C",2) D
"RTN","FHOMUTL",148,0)
 ..S $P(^FH(118.2,FHII,0),U,3)=FHAF_"ML"_FHAS
"RTN","FHOMUTL",149,0)
 Q
"RTN","FHOMWOR")
0^13^B25289896
"RTN","FHOMWOR",1,0)
FHOMWOR ;Hines OIFO/RTK OUTPATIENT MEALS/HL7 MESSAGING  ;10/21/03  10:15
"RTN","FHOMWOR",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMWOR",3,0)
 S FHDFN="",FHZ115="P"_DFN D ADD^FHOMDPA
"RTN","FHOMWOR",4,0)
 I 'FHDFN S TXT="Outpatient not found" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",5,0)
 ;Decode FHMSG(3) - PV1
"RTN","FHOMWOR",6,0)
 S FHX=$G(FHMSG(3))
"RTN","FHOMWOR",7,0)
 I $E(FHX,1,3)'="PV1" S TXT="3rd msg not PV1" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",8,0)
 S FHLOC=$P($P(FHX,"|",4),U,1)
"RTN","FHOMWOR",9,0)
 I FHLOC="" S TXT="Missing Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",10,0)
 S FHLOC=$O(^FH(119.6,"AL",FHLOC,""))
"RTN","FHOMWOR",11,0)
 I 'FHLOC S TXT="Invalid Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",12,0)
 ;Decode FHMSG(4) - ORC
"RTN","FHOMWOR",13,0)
 S FHX=$G(FHMSG(4))
"RTN","FHOMWOR",14,0)
 I $E(FHX,1,3)'="ORC" S TXT="4th msg not ORC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",15,0)
 S FHORN=$P(FHX,"|",3),FHORN=+FHORN,FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",16,0)
 S FHDUR=$P(FHX,"|",8),FHDOW=$P(FHDUR,U,2)
"RTN","FHOMWOR",17,0)
 S DATE=$E($P(FHDUR,U,4),1,8) D CVT^FHWOR S STDT=DATE
"RTN","FHOMWOR",18,0)
 S DATE=$P(FHDUR,U,5) D CVT^FHWOR S ENDT=DATE I ENDT'="" S ENDT=ENDT_.99
"RTN","FHOMWOR",19,0)
 I ENDT="" S ENDT=9999999.99
"RTN","FHOMWOR",20,0)
 S ACT=$P(FHX,"|",2) I ACT="CA"!(ACT="DC") D CANCEL Q
"RTN","FHOMWOR",21,0)
 I ACT="NA" D NA Q
"RTN","FHOMWOR",22,0)
 I ACT="SS" D OMSTAT^FHWORR Q
"RTN","FHOMWOR",23,0)
 I ACT'="NW" S TXT="Action not NW, CA or DC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",24,0)
 D NOW^%DTC S FHNOW=$P(%,".",1)
"RTN","FHOMWOR",25,0)
 I STDT=""!(STDT<FHNOW) S TXT="Start Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",26,0)
 I ENDT<STDT S TXT="End Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",27,0)
 S FHPV=$P(FHX,"|",13),FHEFF=$P(FHX,"|",16)
"RTN","FHOMWOR",28,0)
 I FHEFF="" S TXT="No effective date" D ERR Q
"RTN","FHOMWOR",29,0)
 ;Decode FHMSG(5) - ODS/ODT
"RTN","FHOMWOR",30,0)
 S FHX=$G(FHMSG(5))
"RTN","FHOMWOR",31,0)
 S FHINST=$P(FHX,"|",4),FHBAG="N" I FHINST="bagged" S FHBAG="Y"
"RTN","FHOMWOR",32,0)
 S FHSVCP=$P($P(FHX,"|",3),U,4)
"RTN","FHOMWOR",33,0)
 I $E(FHX,1,3)="ODT" D HL7SET^FHOMRE1 Q  ;EARLY/LATE
"RTN","FHOMWOR",34,0)
 I $E(FHX,1,3)="OBR" D HL7SET^FHOMIP Q  ;ISOLATION/PRECAUTION
"RTN","FHOMWOR",35,0)
 I $E(FHX,1,3)'="ODS" S TXT="5th message not ODT or ODS as expected" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",36,0)
 S FHTYPC=$P(FHX,"|",2) I FHTYPC="ZE" D HL7SET^FHOMRT1 Q  ;TUBEFEEDING
"RTN","FHOMWOR",37,0)
 S FHDTX=$P(FHX,"|",4),FHDIET=$P(FHDTX,U,4),FHDTX=$E(FHDTX,4,$L(FHDTX))
"RTN","FHOMWOR",38,0)
 S FHCOM=$P(FHX,"|",5),FHM3=$P(FHX,"|",3)
"RTN","FHOMWOR",39,0)
 I $E(FHDTX,1,4)="FH-6" D HL7SET^FHOMRA1 Q  ;ADDITIONAL ORDERS
"RTN","FHOMWOR",40,0)
 S FHMEAL=$S(FHM3=1:"B",FHM3=3:"N",FHM3=5:"E",1:"")
"RTN","FHOMWOR",41,0)
 I FHMEAL="" S TXT="Meal missing" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",42,0)
 I FHDIET="" S TXT="Missing diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",43,0)
 I '$D(^FH(111,FHDIET)) S TXT="Invalid diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",44,0)
 I FHTYPC="S" D SM  ;SPECIAL MEAL REQUEST
"RTN","FHOMWOR",45,0)
 I FHTYPC="D" D RM I $G(FHAIL)'="" Q  ;RECURRING MEAL ORDER
"RTN","FHOMWOR",46,0)
 D SEND^FHWOR Q
"RTN","FHOMWOR",47,0)
SM ; Special Meal Request
"RTN","FHOMWOR",48,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",49,0)
 D NOW^%DTC S FHNOW=%
"RTN","FHOMWOR",50,0)
 S FHDUZ=$P($G(FHMSG(4)),"|",11),FHSTAT="P"
"RTN","FHOMWOR",51,0)
 I FHDUZ'="",$D(^XUSEC("FHAUTH",FHDUZ)) S FHSTAT="A"
"RTN","FHOMWOR",52,0)
 S FHQEL=1 D SETNODE^FHOMSR1
"RTN","FHOMWOR",53,0)
 S FILL="S;"_FHSMID
"RTN","FHOMWOR",54,0)
 Q
"RTN","FHOMWOR",55,0)
RM ;
"RTN","FHOMWOR",56,0)
 ; Recurring orders from CPRS will only have ONE diet, not up to 5 like
"RTN","FHOMWOR",57,0)
 ; for NonVA patients/inpatients therefore can set FHDIETX1-5 = NULL
"RTN","FHOMWOR",58,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",59,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1) I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMWOR",60,0)
 S FHMPNUM=FHMPNUM+1
"RTN","FHOMWOR",61,0)
 S (FHAIL,FHDIETX(1),FHDIETX(2),FHDIETX(3),FHDIETX(4),FHDIETX(5))=""
"RTN","FHOMWOR",62,0)
 S (C,FHENDL)=0,STDTLP=STDT,FHDZ="" F  Q:FHENDL=1  D
"RTN","FHOMWOR",63,0)
 .S X=STDTLP D H^%DTC S:%Y=0 %Y=7 S FHDZ=FHDZ_%Y_"^",X1=STDTLP,X2=1
"RTN","FHOMWOR",64,0)
 .D C^%DTC S STDTLP=X,C=C+1 I STDTLP>ENDT!(C>6) S FHENDL=1 Q
"RTN","FHOMWOR",65,0)
 S FHDAYS="" F FHH=1:1:7 S FHPCE=$P(FHDOW,"~",FHH) Q:FHPCE=""  D
"RTN","FHOMWOR",66,0)
 .S FHD3=$E(FHPCE,3)
"RTN","FHOMWOR",67,0)
 .I FHD3'>0,FHD3'<8 Q
"RTN","FHOMWOR",68,0)
 .I FHDZ'[FHD3 Q
"RTN","FHOMWOR",69,0)
 .S FHDAYS=FHDAYS_$E("MTWRFSX",FHD3)
"RTN","FHOMWOR",70,0)
 I FHDAYS="",$E(STDT,1,7)'=$E(ENDT,1,7) S (TXT,FHAIL)="Day of week invalid or not within date range" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",71,0)
 I FHDAYS="",$E(STDT,1,7)=$E(ENDT,1,7) S X=$E(STDT,1,7) D DOW^%DTC S FHDAYS=$E("XMTWRFS",Y+1)
"RTN","FHOMWOR",72,0)
 D SETNODE^FHOMRO1
"RTN","FHOMWOR",73,0)
 S FILL="R;"_FHMPNUM_";"_STDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMWOR",74,0)
 Q
"RTN","FHOMWOR",75,0)
CANCEL ;Cancel outpatient orders
"RTN","FHOMWOR",76,0)
 S FHENDT=ENDT,FHX=$G(FHMSG(4)),FILL=$P(FHX,"|",4),FHMPNUM=""
"RTN","FHOMWOR",77,0)
 S FHORSAV=FHORN,FHILSAV=FILL,FHACTSV=ACT
"RTN","FHOMWOR",78,0)
 S FHTYPE=$P(FILL,";",1) I FHTYPE="R" S FHMPNUM=$P(FILL,";",2)
"RTN","FHOMWOR",79,0)
 I "AEIGSRT"'[FHTYPE S TXT="Invalid cancel code" D ERR Q
"RTN","FHOMWOR",80,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMWOR",81,0)
 I "AET"[FHTYPE F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>FHENDT)  D
"RTN","FHOMWOR",82,0)
 .F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMWOR",83,0)
 ..I FHTYPE="A" D CANAO^FHOMRC1 Q
"RTN","FHOMWOR",84,0)
 ..I FHTYPE="E" D CANEL^FHOMRC1 Q
"RTN","FHOMWOR",85,0)
 ..I FHTYPE="T" D CANTF^FHOMRC1 Q
"RTN","FHOMWOR",86,0)
 I FHTYPE="R" F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHRNUM)) Q:FHRNUM'>0  S FHRMDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1) D CANRM^FHOMRC1,ASSOC^FHOMRC2
"RTN","FHOMWOR",87,0)
 I FHTYPE="I" D CAN^FHOMIP
"RTN","FHOMWOR",88,0)
 I FHTYPE="S" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CAN^FHOMSC1,CNSMEL^FHOMRC2  ;cancel a SM and associated SM Late Tray
"RTN","FHOMWOR",89,0)
 I FHTYPE="G" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CNSMEL^FHOMRC2  ;cancel a SM Late Tray only
"RTN","FHOMWOR",90,0)
 S FHORN=FHORSAV,FILL=FHILSAV,ACT=FHACTSV D CSEND^FHWOR Q
"RTN","FHOMWOR",91,0)
 Q
"RTN","FHOMWOR",92,0)
NA ;Number assign for outpatient
"RTN","FHOMWOR",93,0)
 S FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",94,0)
 S FHTYPE=$P(FILL,";",1) S (FHMPN,FHRNUM)=+$P(FILL,";",2)
"RTN","FHOMWOR",95,0)
 D NA^FHOMWOR1
"RTN","FHOMWOR",96,0)
 Q
"RTN","FHOMWOR",97,0)
ERR ;
"RTN","FHOMWOR",98,0)
 K MSG D RMSH^FHWOR  ;Sets MSG(1) & MSG(2)
"RTN","FHOMWOR",99,0)
 S ACT="UA" I $P(FHMSG(4),"|",2)="CA" S ACT="U"_$E($P(FHMSG(4),"|",2),1)
"RTN","FHOMWOR",100,0)
 S $P(MSG(3),"|",1,2)="ORC|"_ACT,$P(MSG(3),"|",3)=FHORN
"RTN","FHOMWOR",101,0)
 S $P(MSG(3),"|",4)=$P(FHMSG(3),"|",4)
"RTN","FHOMWOR",102,0)
 S $P(MSG(3),"|",13)=$P(FHMSG(3),"|",13)
"RTN","FHOMWOR",103,0)
 S $P(MSG(3),"|",16)=$P(FHMSG(3),"|",16),$P(MSG(3),"|",17)=TXT
"RTN","FHOMWOR",104,0)
 ;
"RTN","FHOMWOR",105,0)
 ;W ! F RK=0:0 S RK=$O(MSG(RK)) Q:RK'>0  W !,"  MSG"_RK_"= ",MSG(RK)
"RTN","FHOMWOR",106,0)
 ;F RK=0:0 S RK=$O(FHMSG(RK)) Q:RK'>0  W !,"FHMSG"_RK_"= ",FHMSG(RK)
"RTN","FHOMWOR",107,0)
 ;W !!,"TXT=",TXT,!!
"RTN","FHOMWOR",108,0)
 ;
"RTN","FHOMWOR",109,0)
 D EVSEND^FHWOR Q
"RTN","FHOMWOR",110,0)
 Q
"RTN","FHOMWOR1")
0^4^B3417408
"RTN","FHOMWOR1",1,0)
FHOMWOR1 ;Hines OIFO/RTK OUTPATIENT MEALS/HL7 MSGING CONT ;04/22/05  9:15
"RTN","FHOMWOR1",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHOMWOR1",3,0)
 ;
"RTN","FHOMWOR1",4,0)
NA ;Number assign for outpatient meals orders (store OR# in FH field)
"RTN","FHOMWOR1",5,0)
 I FHTYPE="A" D NAAO Q
"RTN","FHOMWOR1",6,0)
 I FHTYPE="E" D NAEL Q
"RTN","FHOMWOR1",7,0)
 I FHTYPE="T" D NATF Q
"RTN","FHOMWOR1",8,0)
 I FHTYPE="R" D NARM Q
"RTN","FHOMWOR1",9,0)
 I FHTYPE="I" D NAIP Q
"RTN","FHOMWOR1",10,0)
 I FHTYPE="S" S FHSN=+FHRNUM D NASM Q
"RTN","FHOMWOR1",11,0)
 I FHTYPE="G" S FHSN=+FHRNUM D NASMEL Q
"RTN","FHOMWOR1",12,0)
 I FHTYPE="RMEDIT" D NARMED Q
"RTN","FHOMWOR1",13,0)
 S TXT="BAD TYPE"  D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMWOR1",14,0)
 Q
"RTN","FHOMWOR1",15,0)
NAAO ;
"RTN","FHOMWOR1",16,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMWOR1",17,0)
 S DA=+FHRNUM,DR="13.5////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",18,0)
 Q
"RTN","FHOMWOR1",19,0)
NAEL ;
"RTN","FHOMWOR1",20,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMWOR1",21,0)
 S DA=+FHRNUM,DR="17.5////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",22,0)
 Q
"RTN","FHOMWOR1",23,0)
NATF ;
"RTN","FHOMWOR1",24,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMWOR1",25,0)
 S DA=+FHRNUM,DR="21.5////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",26,0)
 Q
"RTN","FHOMWOR1",27,0)
NARM ;
"RTN","FHOMWOR1",28,0)
 F FHRNM=0:0 S FHRNM=$O(^FHPT(FHDFN,"OP","C",FHMPN,FHRNM)) Q:FHRNM'>0  D
"RTN","FHOMWOR1",29,0)
 .K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMWOR1",30,0)
 .S DA=FHRNM,DR=".05////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",31,0)
 .Q
"RTN","FHOMWOR1",32,0)
 Q
"RTN","FHOMWOR1",33,0)
NAIP ;
"RTN","FHOMWOR1",34,0)
 K DIE S DIE="^FHPT(",DA=FHDFN,DR="20////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",35,0)
 Q
"RTN","FHOMWOR1",36,0)
NASM ;
"RTN","FHOMWOR1",37,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMWOR1",38,0)
 S DA=FHSN,DR="14////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",39,0)
 Q
"RTN","FHOMWOR1",40,0)
NASMEL ;
"RTN","FHOMWOR1",41,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMWOR1",42,0)
 S DA=FHSN,DR="11////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",43,0)
 Q
"RTN","FHOMWOR1",44,0)
NARMED ;
"RTN","FHOMWOR1",45,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMWOR1",46,0)
 S DA=+FHRNUM,DR=".05////^S X=FHORN" D ^DIE
"RTN","FHOMWOR1",47,0)
 Q
"RTN","FHOMWOR1",48,0)
OMD1IT ;
"RTN","FHOMWOR1",49,0)
 F PIECE=3,4,5,6 S $P(^FH(119.9,1,0),U,PIECE)=""
"RTN","FHOMWOR1",50,0)
 Q
"RTN","FHPST2")
0^18^B36655557
"RTN","FHPST2",1,0)
FHPST2 ;Hines OIFO/RTK POST-INIT TO BACKFILL OM TO FILE #100  ;6/21/05  12:05
"RTN","FHPST2",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHPST2",3,0)
 ;
"RTN","FHPST2",4,0)
 ;Loop thru all existing Recurring & Special Meals and send backdoor
"RTN","FHPST2",5,0)
 ;message to update Orders (#100) file.
"RTN","FHPST2",6,0)
 ;
"RTN","FHPST2",7,0)
 ;Recurring Meals
"RTN","FHPST2",8,0)
 D NOW^%DTC S FHNOW=%,FHTODAY=$E(FHNOW,1,7)
"RTN","FHPST2",9,0)
 F FHXRDT=0:0 S FHXRDT=$O(^FHPT("RM",FHXRDT)) Q:FHXRDT'>0  D
"RTN","FHPST2",10,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHXRDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHPST2",11,0)
 ..F FHRM=0:0 S FHRM=$O(^FHPT("RM",FHXRDT,FHDFN,FHRM)) Q:FHRM'>0  D
"RTN","FHPST2",12,0)
 ...S FHDT=$P($G(^FHPT(FHDFN,"OP",FHRM,0)),"^",1)
"RTN","FHPST2",13,0)
 ...S FHODT=$$FMTHL7^XLFDT(FHDT)
"RTN","FHPST2",14,0)
 ...S FHLOC=$P($G(^FHPT(FHDFN,"OP",FHRM,0)),"^",3)
"RTN","FHPST2",15,0)
 ...S FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRM,0)),"^",6)
"RTN","FHPST2",16,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRM,0)) D RM I $P(^FHPT(FHDFN,"OP",FHRM,0),"^",15)="C" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRM,0)),U,12),FILL="R;"_FHMPNUM_";"_FHDT_";"_FHDT_";;" D MSHCA  ;Send backdoor cancel
"RTN","FHPST2",17,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRM,1)) D AO
"RTN","FHPST2",18,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRM,2)) D EL
"RTN","FHPST2",19,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRM,3)) D TF
"RTN","FHPST2",20,0)
 ;
"RTN","FHPST2",21,0)
 ;Special Meals
"RTN","FHPST2",22,0)
 F FHXSDT=0:0 S FHXSDT=$O(^FHPT("SM",FHXSDT)) Q:FHXSDT'>0  D
"RTN","FHPST2",23,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHXSDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHPST2",24,0)
 ..S FHODT=$$FMTHL7^XLFDT(FHXSDT)
"RTN","FHPST2",25,0)
 ..S FHLOC=$P($G(^FHPT(FHDFN,"SM",FHXSDT,0)),"^",3)
"RTN","FHPST2",26,0)
 ..I $D(^FHPT(FHDFN,"SM",FHXSDT,0)) D SM
"RTN","FHPST2",27,0)
 Q
"RTN","FHPST2",28,0)
 ;
"RTN","FHPST2",29,0)
RM ;
"RTN","FHPST2",30,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,0),"^",12)>0 Q  ;Backdoor already exists
"RTN","FHPST2",31,0)
 S FHN0=$G(^FHPT(FHDFN,"OP",FHRM,0))
"RTN","FHPST2",32,0)
 K MSG D MSHOM I 'DFN!('FHOLOC) Q
"RTN","FHPST2",33,0)
 S FHMPNUM=$P(FHN0,"^",6),FHCLRK=$P(FHN0,"^",17) D GETSED
"RTN","FHPST2",34,0)
 S (X,FHSTDT)=$P(FHN0,"^",1)
"RTN","FHPST2",35,0)
 S FHMEAL=$P(FHN0,"^",4),FHDIET=$P(FHN0,"^",2),FHDIETX(1)=$P(FHN0,"^",7)
"RTN","FHPST2",36,0)
 S FHDIETX(2)=$P(FHN0,"^",8),FHDIETX(3)=$P(FHN0,"^",9)
"RTN","FHPST2",37,0)
 S FHDIETX(4)=$P(FHN0,"^",10),FHDIETX(5)=$P(FHN0,"^",11)
"RTN","FHPST2",38,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHSTDT),FHOENDT=$$FMTHL7^XLFDT(FHENDT)
"RTN","FHPST2",39,0)
 S FILL="R;"_FHMPNUM_";"_FHSTDT_";"_FHENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHPST2",40,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^"_FHDAYS_"^^"_FHOSTDT_"^"_FHOENDT_"|||"_FHCLRK_"|||||"_FHOSTDT
"RTN","FHPST2",41,0)
 I FHDIET'="" S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1),MSG(5)="ODS|D|"_FHMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHPST2",42,0)
 I FHDIET="" D
"RTN","FHPST2",43,0)
 .F N=0:0 S N=$O(FHDIETX(N)) Q:N'>0  Q:FHDIETX(N)=""  S FHODNM=$P($G(^FH(111,FHDIETX(N),0)),U,1),MSG(N+4)="ODS|D|"_FHMEAL_"|^^^"_FHDIETX(N)_"^"_FHODNM_"^99FHD|"
"RTN","FHPST2",44,0)
 D EVSEND^FHWOR
"RTN","FHPST2",45,0)
 Q
"RTN","FHPST2",46,0)
AO ;
"RTN","FHPST2",47,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,1),"^",4)>0 Q  ;Backdoor already exists
"RTN","FHPST2",48,0)
 S FHN1=$G(^FHPT(FHDFN,"OP",FHRM,1))
"RTN","FHPST2",49,0)
 K MSG D MSHOM I 'DFN!('FHOLOC) Q
"RTN","FHPST2",50,0)
 S FILL="A;"_FHRM,FHTEXT=$P(FHN1,"^",1),FHCLRK=$P(FHN1,"^",2)
"RTN","FHPST2",51,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"|||"_FHCLRK_"|||||"_FHTODAY
"RTN","FHPST2",52,0)
 S MSG(5)="ODS|D||^^^FH-6^Additional Order^99OTH|"_FHTEXT
"RTN","FHPST2",53,0)
 D EVSEND^FHWOR
"RTN","FHPST2",54,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,1),"^",5)="C" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRM,1)),U,4),FILL="A;"_FHRM D MSHCA  ;Send backdoor cancel
"RTN","FHPST2",55,0)
 Q
"RTN","FHPST2",56,0)
EL ;
"RTN","FHPST2",57,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,2),"^",5)>0 Q  ;Backdoor already exists
"RTN","FHPST2",58,0)
 S FHN2=$G(^FHPT(FHDFN,"OP",FHRM,2))
"RTN","FHPST2",59,0)
 K MSG D MSHOM I 'DFN!('FHOLOC) Q
"RTN","FHPST2",60,0)
 S FILL="E;"_FHRM,FHEL="L",FHS=1,FHBAG=$P(FHN2,"^",2)
"RTN","FHPST2",61,0)
 S FHCLRK=$P(FHN2,"^",3)
"RTN","FHPST2",62,0)
 S FHOMELN=FHMEAL_FHEL_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHPST2",63,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"|||"_FHCLRK_"|||||"_FHTODAY
"RTN","FHPST2",64,0)
 S MSG(5)="ODT|LATE|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHPST2",65,0)
 D EVSEND^FHWOR
"RTN","FHPST2",66,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,2),"^",6)="C" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRM,2)),U,5),FILL="E;"_FHRM D MSHCA  ;Send backdoor cancel
"RTN","FHPST2",67,0)
 Q
"RTN","FHPST2",68,0)
TF ;
"RTN","FHPST2",69,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,3),"^",4)>0 Q  ;Backdoor already exists
"RTN","FHPST2",70,0)
 S FHN3=$G(^FHPT(FHDFN,"OP",FHRM,3))
"RTN","FHPST2",71,0)
 K MSG,TUN D MSHOM I 'DFN!('FHOLOC) Q
"RTN","FHPST2",72,0)
 S FHTEXT=$P(FHN3,"^",1),FILL="T;"_FHRM,MNUM=4,TFCOM=FHTEXT
"RTN","FHPST2",73,0)
 S FHCLRK=$P(FHN3,"^",6) D NOW^%DTC S FHNOW=%,SDT=FHDT
"RTN","FHPST2",74,0)
 S MSG(MNUM)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"|||"_FHCLRK_"||"_FHCLRK_"|||"_FHNOW
"RTN","FHPST2",75,0)
 F FHTF=0:0 S FHTF=$O(^FHPT(FHDFN,"OP",FHRM,"TF",FHTF)) Q:FHTF'>0  S TUN(FHTF)=$G(^FHPT(FHDFN,"OP",FHRM,"TF",FHTF,0))
"RTN","FHPST2",76,0)
 F FHTF=0:0 S FHTF=$O(TUN(FHTF)) Q:FHTF<1  S XX=$G(TUN(FHTF)) D TF1^FHWOR5
"RTN","FHPST2",77,0)
 D EVSEND^FHWOR
"RTN","FHPST2",78,0)
 I $P(^FHPT(FHDFN,"OP",FHRM,3),"^",5)="C" S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRM,3)),U,4),FILL="T;"_FHRM D MSHCA  ;Send backdoor cancel
"RTN","FHPST2",79,0)
 Q
"RTN","FHPST2",80,0)
SM ;
"RTN","FHPST2",81,0)
 I $P(^FHPT(FHDFN,"SM",FHXSDT,0),"^",12)>0 Q  ;Backdoor already exists
"RTN","FHPST2",82,0)
 S FHSN0=$G(^FHPT(FHDFN,"SM",FHXSDT,0))
"RTN","FHPST2",83,0)
 K MSG D MSHOM I 'DFN!('FHOLOC) Q
"RTN","FHPST2",84,0)
 S FILL="S;"_FHXSDT,FHMEAL=$P(FHSN0,"^",9),FHDIET=$P(FHSN0,"^",4)
"RTN","FHPST2",85,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHPST2",86,0)
 S FHDIETNM=$P($G(^FH(111,FHDIET,0)),U,1),FHCLRK=$P(FHSN0,"^",5)
"RTN","FHPST2",87,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"|||"_FHCLRK_"|||||"_FHNOW
"RTN","FHPST2",88,0)
 S MSG(5)="ODS|S|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHDIETNM_"^99FHD|"
"RTN","FHPST2",89,0)
 D EVSEND^FHWOR
"RTN","FHPST2",90,0)
 S FHSMST=$P(^FHPT(FHDFN,"SM",FHXSDT,0),"^",2)
"RTN","FHPST2",91,0)
 I FHSMST="C"!(FHSMST="D") S FHORN=$P($G(^FHPT(FHDFN,"SM",FHXSDT,0)),U,12),FILL="S;"_FHXSDT D MSHCA  ;Send backdoor cancel/deny
"RTN","FHPST2",92,0)
 Q
"RTN","FHPST2",93,0)
MSHOM ;Code MSG for outpatient orders
"RTN","FHPST2",94,0)
 D SITE^FH
"RTN","FHPST2",95,0)
 D PATNAME^FHOMUTL I 'DFN Q
"RTN","FHPST2",96,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHPST2",97,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHPST2",98,0)
 S FHOLOC=$G(^FH(119.6,FHLOC,"L",1,0)) I 'FHOLOC Q
"RTN","FHPST2",99,0)
 S FHOLOCNM=$P($G(^SC(FHOLOC,0)),U,1)
"RTN","FHPST2",100,0)
 S MSG(3)="PV1||O|"_FHOLOC_"^"_FHOLOCNM_"||||||||||||||||"
"RTN","FHPST2",101,0)
 Q
"RTN","FHPST2",102,0)
MSHCA ;Code Cancel/Discontinue for outpatient orders
"RTN","FHPST2",103,0)
 K MSG S ACT="OC" D SITE^FH S FHCATXT="Dietetics Canceled order."
"RTN","FHPST2",104,0)
 D PATNAME^FHOMUTL I 'DFN Q
"RTN","FHPST2",105,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHPST2",106,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHPST2",107,0)
 S DATE=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHPST2",108,0)
 S MSG(3)="ORC|"_ACT_"|"_FHORN_"^OR|"_FILL_"^FH|||||||"_DUZ_"||"_DUZ_"|||"_DATE_"|"_FHCATXT
"RTN","FHPST2",109,0)
 D EVSEND^FHWOR
"RTN","FHPST2",110,0)
 Q
"RTN","FHPST2",111,0)
GETSED ;
"RTN","FHPST2",112,0)
 K N1 S (FHDAYS,FHENDT,FHODAYS)=""
"RTN","FHPST2",113,0)
 F FHRZ=0:0 S FHRZ=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHRZ)) Q:FHRZ'>0  D
"RTN","FHPST2",114,0)
 .S FHDAT=$P($G(^FHPT(FHDFN,"OP",FHRZ,0)),"^",1),X=FHDAT D DOW^%DTC
"RTN","FHPST2",115,0)
 .S FHV=$S(Y=0:"X",Y=1:"M",Y=2:"T",Y=3:"W",Y=4:"R",Y=5:"F",1:"S")
"RTN","FHPST2",116,0)
 .I FHDAYS'[FHV S FHDAYS=FHDAYS_FHV
"RTN","FHPST2",117,0)
 .Q
"RTN","FHPST2",118,0)
 S FHENDT=FHDAT
"RTN","FHPST2",119,0)
 F N=1:1:7 S FH1=$E(FHDAYS,N) Q:FH1=""  S M=$F("MTWRFSX",FH1)-1,N1(M)=""
"RTN","FHPST2",120,0)
 F N=0:0 S N=$O(N1(N)) Q:N'>0  S FHODAYS=FHODAYS_"~QJ"_N
"RTN","FHPST2",121,0)
 S FHODAYS=$E(FHODAYS,2,999)
"RTN","FHPST2",122,0)
 S FHDAYS=FHODAYS Q
"RTN","FHSYSP")
0^5^B2751439
"RTN","FHSYSP",1,0)
FHSYSP ; HISC/REL - Site Parameter Edit ;3/20/95  07:53
"RTN","FHSYSP",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHSYSP",3,0)
 S DA=1,DIE="^FH(119.9,"
"RTN","FHSYSP",4,0)
 I '$D(^FH(119.9,DA,0)) S DR=".01///"_DA D ^DIE
"RTN","FHSYSP",5,0)
 W ! S DR="3;22;4;S:X="""" Y=9;5:8;40:49;9:18;25:39;100//Y;I X'=""Y"" S Y="""";99" D ^DIE G KIL
"RTN","FHSYSP",6,0)
EN1 ; Display Selected Lab Tests
"RTN","FHSYSP",7,0)
 W ! S L=0,DIC="^FH(119.9,",FLDS="[FHSYP1]",BY="@SITE"
"RTN","FHSYSP",8,0)
 S (FR,TO)=1,DHD="SELECTED LABORATORY TESTS" D EN1^DIP,RSET Q
"RTN","FHSYSP",9,0)
EN2 ; Display Selected Drug Classifications
"RTN","FHSYSP",10,0)
 W ! S L=0,DIC="^FH(119.9,",FLDS="[FHSYP2]",BY="@SITE"
"RTN","FHSYSP",11,0)
 S (FR,TO)=1,DHD="SELECTED DRUG CLASSIFICATIONS" D EN1^DIP,RSET Q
"RTN","FHSYSP",12,0)
EN3 ; Clinical Site Parameters
"RTN","FHSYSP",13,0)
 S DA=1,DIE="^FH(119.9,",DR="[FHSITEC1]" W ! D ^DIE G KIL
"RTN","FHSYSP",14,0)
RSET K %ZIS S IOP="" D ^%ZIS
"RTN","FHSYSP",15,0)
KIL G KILL^XUSCLEAN
"RTN","FHSYSP",16,0)
TIM ; Convert to printable time
"RTN","FHSYSP",17,0)
 I $L(X)>6!($L(X)<2) G ERR
"RTN","FHSYSP",18,0)
 I X'["A",X'["P" G ERR
"RTN","FHSYSP",19,0)
 S:$L(X)<4 X=$E(X,1,$L(X)-1)_"00"_$E(X,$L(X))
"RTN","FHSYSP",20,0)
 I X[":",X?1.2N1":"2N1"A"!(X?1.2N1":"2N1"P") S X=+$P(X,":",1)_$P(X,":",2) G 1
"RTN","FHSYSP",21,0)
 I X'[":",X?3.4N1"A"!(X?3.4N1"P") G 1
"RTN","FHSYSP",22,0)
ERR W *7,"  Enter time as 8:15A or 12:30P" K X Q
"RTN","FHSYSP",23,0)
1 I X#100>59!(X>1259)!(X<1) G ERR
"RTN","FHSYSP",24,0)
 I X<1000 S:$E(X,1) X="0"_X
"RTN","FHSYSP",25,0)
 S X=+$E(X,1,2)_":"_$E(X,3,4)_$S(X["A":"A",1:"P") Q
"RTN","FHSYSP",26,0)
MIL ; Check for AM or PM
"RTN","FHSYSP",27,0)
 S X1=$P(X,":",1)_$P(X,":",2),X1=+X1
"RTN","FHSYSP",28,0)
 I X["P",X1<1200 S X1=X1+1200
"RTN","FHSYSP",29,0)
 I X["A",X1>1200 S X1=X1-1200
"RTN","FHSYSP",30,0)
 Q
"RTN","FHSYSP",31,0)
MIP ; Get the printable time
"RTN","FHSYSP",32,0)
 S Z=$S(Y<1200:"A",1:"P") I Z="P",Y>1259 S Y=Y-1200
"RTN","FHSYSP",33,0)
 S Y=$E("000"_Y,$L(Y),$L(Y)+3),Y=+$E(Y,1,2)_":"_$E(Y,3,4)_Z Q
"RTN","FHWOR")
0^16^B30084812
"RTN","FHWOR",1,0)
FHWOR ; HISC/NCA - Main Routine to Decode HL7 ;10/10/00  14:55
"RTN","FHWOR",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHWOR",3,0)
EN(MSG) ; Entry Point for OE/RR 3 and pass MSG in FHMSG
"RTN","FHWOR",4,0)
 N ACT,ADM,BID,COM,FHDFN,DFN,EDT,FHPV,FHMSG,FHWF,NOW,SDT,CHK,DA,DATA,DATE,DIET,DUR,FHC,FHD,FHD1,FHD2,FOR,FTYP,IEN,ITVL,LP,MEAL,NAM,PER,PID,SERV,TIM,TIME,TM,TXT,TYPC,WARD,X,XX,YR
"RTN","FHWOR",5,0)
 S TXT="",FHWF=2 ; FHWF=2 - Orders from OE/RR
"RTN","FHWOR",6,0)
 F L=0:0 S L=$O(MSG(L)) Q:L<1  S FHMSG(L)=$G(MSG(L))
"RTN","FHWOR",7,0)
 Q:'$D(FHMSG)
"RTN","FHWOR",8,0)
 ; Decode MSH
"RTN","FHWOR",9,0)
 S X=$G(FHMSG(1)) I $E(X,1,3)'="MSH" S TXT="MSH not first record" D GETOR G ERR
"RTN","FHWOR",10,0)
 ; Check PID
"RTN","FHWOR",11,0)
 S X=$G(FHMSG(2)) I $E(X,1,3)'="PID" S TXT="PID not second record" D GETOR G ERR
"RTN","FHWOR",12,0)
 S NAM=$P(X,"|",6),DFN=$P(X,"|",4)
"RTN","FHWOR",13,0)
 I '$D(^DPT("B",$E(NAM,1,30),DFN)) S TXT="Name/DFN not found" W !!,TXT,!! D GETOR G ERR
"RTN","FHWOR",14,0)
 S FHZ115="P"_DFN D ADD^FHOMDPA I FHDFN=""  S TXT="Patient not found in File #115" D GETOR G ERR
"RTN","FHWOR",15,0)
 D PID^VADPT6 S PID=$G(VA("PID")),BID=$G(VA("BID")) K VA
"RTN","FHWOR",16,0)
 S X=$G(FHMSG(3)) I $E(X,1,5)="ORC|Z" G PURGE
"RTN","FHWOR",17,0)
 I $E(X,1,6)="ORC|DE" Q  ;6/2005 quit processing if "DE" returned
"RTN","FHWOR",18,0)
 ;Check for outpatient orders
"RTN","FHWOR",19,0)
 I $P(X,"|",3)="O" D ^FHOMWOR Q
"RTN","FHWOR",20,0)
 S WARD=$G(^DPT(DFN,.1)) I WARD="" D CHK^FHWORR G:CHK CANCEL S:'CHK TXT="Not an inpatient" D GETOR G ERR
"RTN","FHWOR",21,0)
 S ADM=$G(^DPT("CN",WARD,DFN)) I ADM<1 S TXT="Admission not found" D GETOR G ERR
"RTN","FHWOR",22,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) I '$D(^DGPM(ADM,0)) S TXT="Admission not found" D GETOR G ERR
"RTN","FHWOR",23,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) S DA=DFN D ^FHWADM
"RTN","FHWOR",24,0)
 ; Check PV1
"RTN","FHWOR",25,0)
 S X=$G(FHMSG(3)) G:$E(X,1,3)="ORC" CANCEL I $E(X,1,3)'="PV1" S TXT="Third message not ORC or PV1" D GETOR G ERR
"RTN","FHWOR",26,0)
 ; Decode ORC
"RTN","FHWOR",27,0)
 S X=$G(FHMSG(4)) I $E(X,1,3)'="ORC" S TXT="Message 4 not ORC as expected" D GETOR G ERR
"RTN","FHWOR",28,0)
 S ACT=$P(X,"|",2) I ACT'="NW" S TXT="Action not NW as expected" D GETOR G ERR
"RTN","FHWOR",29,0)
 S FHORN=$P(X,"|",3),DUR=$P(X,"|",8)
"RTN","FHWOR",30,0)
 S ITVL=$P(DUR,"^",2),SDT=$P(DUR,"^",4),EDT=$P(DUR,"^",5)
"RTN","FHWOR",31,0)
 S FHPV=$P(X,"|",13),NOW=$P(X,"|",16) I NOW="" S TXT="No Effective Date" G ERR
"RTN","FHWOR",32,0)
 S X=$G(FHMSG(5)) I $E(X,1,3)="ODT" D ^FHWOR3 G KIL
"RTN","FHWOR",33,0)
 I $E(X,1,3)="OBR" D ^FHWOR61 G KIL
"RTN","FHWOR",34,0)
 I $E(X,1,3)'="ODS" S TXT="Message 5 not ODT or ODS as expected" G ERR
"RTN","FHWOR",35,0)
 S TYPC=$P(X,"|",2) I TYPC="ZE" D ^FHWOR5 G KIL
"RTN","FHWOR",36,0)
 S DIET=$P(X,"|",4),DIET=$E(DIET,4,$L(DIET)),COM=$P(X,"|",5)
"RTN","FHWOR",37,0)
 I $E(DIET,1,4)="FH-5" D ^FHWOR4 G KIL
"RTN","FHWOR",38,0)
 I $E(DIET,1,4)="FH-6" D ^FHWOR1 G KIL
"RTN","FHWOR",39,0)
 D ^FHWOR2 G KIL
"RTN","FHWOR",40,0)
CANCEL ; Cancel/Discontinue
"RTN","FHWOR",41,0)
 S DATA=X,FOR=0
"RTN","FHWOR",42,0)
 S ACT=$P(DATA,"|",2)
"RTN","FHWOR",43,0)
 S FHORN=$P(DATA,"|",3),FILL=$P(DATA,"|",4),FTYP=$P(FILL,";",1)
"RTN","FHWOR",44,0)
 I ACT'="CA",ACT'="DC",ACT'="NA",ACT'="DE",ACT'="SS" S TXT="Action not CA, DC, NA, or DE as expected" G CERR
"RTN","FHWOR",45,0)
 I FTYP="R"!(FTYP="S") D OMSTAT^FHWORR Q  ;Status update for outpt meals
"RTN","FHWOR",46,0)
 I "ADEINT"'[FTYP G CSEND:ACT="CA"!(ACT="DC"),KIL
"RTN","FHWOR",47,0)
 S FOR=$S(FTYP="A":1,FTYP="D":2,FTYP="E":3,FTYP="N":4,FTYP="T":5,FTYP="I":6,1:0)
"RTN","FHWOR",48,0)
 I 'FOR G CSEND:ACT="CA"!(ACT="DC"),KIL
"RTN","FHWOR",49,0)
 I ACT="SS" G STATUS^FHWORR
"RTN","FHWOR",50,0)
 I ACT="NA" D NA K ACT,TXT K MSG Q
"RTN","FHWOR",51,0)
 I ACT="DE" K MSG G KIL
"RTN","FHWOR",52,0)
CAN ; Cancel Order From OE
"RTN","FHWOR",53,0)
 I FOR=1 D CAN^FHWOR1 G KIL
"RTN","FHWOR",54,0)
 I FOR=2 D CAN^FHWOR2 G KIL
"RTN","FHWOR",55,0)
 I FOR=3 D CAN^FHWOR3 G KIL
"RTN","FHWOR",56,0)
 I FOR=4 D CAN^FHWOR4 G KIL
"RTN","FHWOR",57,0)
 I FOR=5 D CAN^FHWOR5 G KIL
"RTN","FHWOR",58,0)
 I FOR=6 D CAN^FHWOR61 G KIL
"RTN","FHWOR",59,0)
 G KIL
"RTN","FHWOR",60,0)
PURGE ; Purge OE/RR Orders
"RTN","FHWOR",61,0)
 I $E(X,5,6)'="Z@" G KIL
"RTN","FHWOR",62,0)
 S FHORN=+$P(X,"|",3),FILL=$P(X,"|",4),FTYP=$P(FILL,";",1)
"RTN","FHWOR",63,0)
 S FHDR=+$P(FILL,";",3),ADM=+$P(FILL,";",2)
"RTN","FHWOR",64,0)
 I FTYP="A" S:$P($G(^FHPT(FHDFN,"A",ADM,"OO",FHDR,0)),"^",8)=FHORN $P(^FHPT(FHDFN,"A",ADM,"OO",FHDR,0),"^",8)=""
"RTN","FHWOR",65,0)
 I FTYP="D" S:$P($G(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0),"^",14)=""
"RTN","FHWOR",66,0)
 I FTYP="E" S SDT=$P(FILL,";",4),EDT=$P(FILL,";",5) S:EDT<SDT EDT=SDT D
"RTN","FHWOR",67,0)
 .F EL=SDT\1:0 S EL=$O(^FHPT(FHDFN,"A",ADM,"EL",EL)) Q:EL<1!(EL>EDT)  D
"RTN","FHWOR",68,0)
 ..S:$P($G(^FHPT(FHDFN,"A",ADM,"EL",EL,0)),"^",7)=FHORN $P(^FHPT(FHDFN,"A",ADM,"EL",EL,0),"^",7)=""
"RTN","FHWOR",69,0)
 ..Q
"RTN","FHWOR",70,0)
 .Q
"RTN","FHWOR",71,0)
 I FTYP="N" S:$P($G(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"DI",FHDR,0),"^",14)=""
"RTN","FHWOR",72,0)
 I FTYP="T" S:$P($G(^FHPT(FHDFN,"A",ADM,"TF",FHDR,0)),"^",14)=FHORN $P(^FHPT(FHDFN,"A",ADM,"TF",FHDR,0),"^",14)=""
"RTN","FHWOR",73,0)
 I FTYP="I" S:$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",13)=FHORN $P(^FHPT(FHDFN,"A",ADM,0),"^",13)=""
"RTN","FHWOR",74,0)
 K EL,FHDR
"RTN","FHWOR",75,0)
 S $P(MSG(1),"|",9)="ORR",$P(MSG(3),"|",2)="ZR",$P(MSG(1),"|",3)="DIETETICS" G EVSEND
"RTN","FHWOR",76,0)
NA ; Number Assign
"RTN","FHWOR",77,0)
 I FOR=1 D NA^FHWOR1 G KIL
"RTN","FHWOR",78,0)
 I FOR=2 D NA^FHWOR2 G KIL
"RTN","FHWOR",79,0)
 I FOR=3 D NA^FHWOR3 G KIL
"RTN","FHWOR",80,0)
 I FOR=4 D NA^FHWOR4 G KIL
"RTN","FHWOR",81,0)
 I FOR=5 D NA^FHWOR5 G KIL
"RTN","FHWOR",82,0)
 I FOR=6 D NA^FHWOR61 G KIL
"RTN","FHWOR",83,0)
 Q
"RTN","FHWOR",84,0)
CVT ; Convert HL7 date to FM date
"RTN","FHWOR",85,0)
 Q:DATE=""  S DATE=$$HL7TFM^XLFDT(DATE)
"RTN","FHWOR",86,0)
 I $P(DATE,".",2)=24 S DATE=$$FMADD^XLFDT(DATE,0,0,1)
"RTN","FHWOR",87,0)
 Q
"RTN","FHWOR",88,0)
ERR ; Send error MSG
"RTN","FHWOR",89,0)
 K MSG D RMSH
"RTN","FHWOR",90,0)
 S $P(MSG(3),"|",1,2)="ORC"_"|"_$S($P($G(MSG(3)),"|",1)="ORC":"U"_$E($P($G(MSG(3)),"|",2),1),1:"OC"),$P(MSG(3),"|",3)=FHORN
"RTN","FHWOR",91,0)
 S $P(MSG(3),"|",4)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",4),1:"")
"RTN","FHWOR",92,0)
 S $P(MSG(3),"|",13)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",13),1:$P(FHMSG(4),"|",13))
"RTN","FHWOR",93,0)
 S $P(MSG(3),"|",16)=$S($P(FHMSG(3),"|",1)="ORC":$P(FHMSG(3),"|",16),1:$P(FHMSG(4),"|",16))
"RTN","FHWOR",94,0)
 S $P(MSG(3),"|",17)=TXT G EVSEND
"RTN","FHWOR",95,0)
SEND ; Send OK MSG to OERR
"RTN","FHWOR",96,0)
 K MSG D RMSH
"RTN","FHWOR",97,0)
 S MSG(3)="ORC|OK|"_FHORN_"|"_FILL_"^"_"FH" G EVSEND
"RTN","FHWOR",98,0)
CERR ; Send unable MSG
"RTN","FHWOR",99,0)
 K MSG D RMSH
"RTN","FHWOR",100,0)
 S MSG(3)="ORC|U"_$E(ACT,1)_"|"_FHORN_"|"_FILL_"|||||||||||||"_TXT G EVSEND
"RTN","FHWOR",101,0)
CSEND ; Send Canceled/Discontinued MSG to OERR
"RTN","FHWOR",102,0)
 K MSG D RMSH
"RTN","FHWOR",103,0)
 S MSG(3)="ORC|"_$E(ACT,1)_"R"_"|"_FHORN_"|"_FILL
"RTN","FHWOR",104,0)
EVSEND ; Send Message to OE/RR
"RTN","FHWOR",105,0)
 K ACT,FILL,FHORN,SITE,TXT D MSG^XQOR("FH EVSEND OR",.MSG) K MSG Q
"RTN","FHWOR",106,0)
MSH ; Code MSH message
"RTN","FHWOR",107,0)
 D MSH^FHWORR
"RTN","FHWOR",108,0)
 Q
"RTN","FHWOR",109,0)
RMSH ; Code MSH Return Message
"RTN","FHWOR",110,0)
 D SITE^FH
"RTN","FHWOR",111,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORR"
"RTN","FHWOR",112,0)
 ; code PID
"RTN","FHWOR",113,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHWOR",114,0)
 Q
"RTN","FHWOR",115,0)
GETOR ; Call to Get FHORN
"RTN","FHWOR",116,0)
 D GETOR^FHWORR Q
"RTN","FHWOR",117,0)
KIL ; Kill Variables
"RTN","FHWOR",118,0)
 K ACT,ADM,BID,COM,FHDFN,DFN,EDT,FHPV,FHMSG,FHWF,NOW,SDT,CHK,DA,DATA,DATE,DIET,DUR,FHC,FHD,FHD1,FHD2,FOR,FTYP,IEN,ITVL,LP,MEAL,NAM,PER,PID,SERV,TIM,TIME,TM,TXT,TYPC,WARD,X,XX,YR Q
"RTN","FHWOR71")
0^14^B28572181
"RTN","FHWOR71",1,0)
FHWOR71 ; HISC/CAH - Diet Profile for CPRS ;1/30/97  08:54
"RTN","FHWOR71",2,0)
 ;;5.5;DIETETICS;**1,2**;Jan 28, 2005
"RTN","FHWOR71",3,0)
P(DFN) ;Dietetics Profile for CPRS
"RTN","FHWOR71",4,0)
 ; INPUT:   DFN = Patient file #2 internal record number
"RTN","FHWOR71",5,0)
 ; OUTPUT:  -1^displayable error text   (if invalid DFN or no profile)
"RTN","FHWOR71",6,0)
 ;     with version 5.5 selection of outpatients is allowed
"RTN","FHWOR71",7,0)
 ;          1 if successful, and displayable data in
"RTN","FHWOR71",8,0)
 ;   ^TMP($J,"FHPROF",DFN,n) = line of text
"RTN","FHWOR71",9,0)
 ;          where n = sequential number
"RTN","FHWOR71",10,0)
 ;
"RTN","FHWOR71",11,0)
 I 'DFN Q "-1^Invalid patient selection"
"RTN","FHWOR71",12,0)
 S FHZ115="P"_DFN D CHECK^FHOMDPA I FHDFN="" Q "-1^No Report Available"
"RTN","FHWOR71",13,0)
 N %,%H,%I,%T,%ZIS,A1,ADM,AGE,ALG,ALL,BAG,C,CAL,COM,CON,CT,D3,DA,DAS,FHDU,DOB,DTP,FHI,FHOR,FHLD,FHQ,I,IOP,K,K1,K2,KK,L,L1,LST,MEAL,N,NO,NOW,FHORD,FHWF,FHPV,FHX,FHY
"RTN","FHWOR71",14,0)
 N POP,Q,QUA,QT,QTY,RM,SEX,PID,BID,ST1,ST2,STR,TYP,TF,TF2,TIM,TQU,TUN,WARD,X,X1,X2,XY,Y,YN,Z,Z1
"RTN","FHWOR71",15,0)
 S FHQ=1 K ^TMP($J,"FHPROF",DFN) S FHX=0 D F0
"RTN","FHWOR71",16,0)
 Q FHQ
"RTN","FHWOR71",17,0)
F0 ; Display Diet
"RTN","FHWOR71",18,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,QT=""
"RTN","FHWOR71",19,0)
 S WARD=$G(^DPT(DFN,.1)) I WARD="" D CPRS^FHOMPP Q
"RTN","FHWOR71",20,0)
 ;S WARD=$G(^DPT(DFN,.1)) I WARD="" S FHQ="-1^Not currently an inpatient" Q
"RTN","FHWOR71",21,0)
 S ADM=$G(^DPT("CN",WARD,DFN)) I ADM<1 S FHQ="-1^No current diet order" Q
"RTN","FHWOR71",22,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) S FHQ="-1^No current diet order2" Q
"RTN","FHWOR71",23,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0),M=$P(X,"^",2) I M'="" S:M="A" M="BNE" D SP
"RTN","FHWOR71",24,0)
 I $O(N(""))="" S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="No Food Preferences on file" S FHX=$$SPACNG(0,FHX) G A0
"RTN","FHWOR71",25,0)
 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Food Preferences Currently on file" S FHX=$$SPACNG(1,FHX)
"RTN","FHWOR71",26,0)
 K ST1 S $P(ST1," ",81)="",$E(ST1,27,32)="Likes",$E(ST1,59,67)="Dislikes" S ^TMP($J,"FHPROF",DFN,FHX)=ST1 S FHX=$$SPACNG(1,FHX)
"RTN","FHWOR71",27,0)
 S (M1,M2,MM)="",FHX=$$SPACNG(0,FHX) F  S M1=$O(N(M1)) Q:M1=""  I $D(N(M1)) S ^TMP($J,"FHPROF",DFN,FHX)=$P(M1,"~",2) D
"RTN","FHWOR71",28,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M1,"L",P1)) S X1=$S(P1>0:N(M1,"L",P1),1:"") S:P2'="" P2=$O(N(M1,"D",P2)) S X2=$S(P2>0:N(M1,"D",P2),1:"") Q:P1=""&(P2="")  D W0 S:M2'=M1 FHX=$$SPACNG(0,FHX)
"RTN","FHWOR71",29,0)
 .  S M2=M1 Q
"RTN","FHWOR71",30,0)
 S FHX=$$SPACNG(0,FHX) K L,N,M,M1,M2,MM,P1,P2
"RTN","FHWOR71",31,0)
A0 S X(0)=^FHPT(FHDFN,"A",ADM,0),X=$P(X(0),"^",10) G:X="" F1
"RTN","FHWOR71",32,0)
 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Isolation/Precaution Type is "_$P($G(^FH(119.4,X,0)),"^",1)
"RTN","FHWOR71",33,0)
F1 D CUR^FHORD7 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Current Diet: "_$S(Y'="":Y,1:"No current order")
"RTN","FHWOR71",34,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) S COM=^(1) D
"RTN","FHWOR71",35,0)
 . I COM'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Comment: "_COM
"RTN","FHWOR71",36,0)
 S TYP=$P(X,"^",8) I TYP'="" D
"RTN","FHWOR71",37,0)
 . S FHX=$$SPACNG(0,FHX)
"RTN","FHWOR71",38,0)
 . S ^TMP($J,"FHPROF",DFN,FHX)="Service: "_$S(TYP="T":"Tray",TYP="D":"Dining Room",1:"Cafeteria")
"RTN","FHWOR71",39,0)
 S DTP=$P(X(0),"^",3) I DTP D DTP^FH S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Expires: "_DTP
"RTN","FHWOR71",40,0)
 S TF=$P(X(0),"^",4) G:TF<1 F2
"RTN","FHWOR71",41,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHWOR71",42,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHWOR71",43,0)
 D DTP^FH S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Tubefeed Ordered: "_DTP
"RTN","FHWOR71",44,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHWOR71",45,0)
 S FHX=$$SPACNG(0,FHX) K ST1 S ST1="Total Quantity: "_TQU_" ml",$E(ST1,43,(56+$L(CAL)))="Total KCAL: "_CAL S ^TMP($J,"FHPROF",DFN,FHX)=ST1
"RTN","FHWOR71",46,0)
 I COM'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Comment: "_COM
"RTN","FHWOR71",47,0)
F2 S NO=$P(X(0),"^",7),Y=$S('NO:"",1:^FHPT(FHDFN,"A",ADM,"SF",NO,0))
"RTN","FHWOR71",48,0)
 S L=$P(Y,"^",4) S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Supplemental Feeding: "_$S('L:"No Order",1:$P(^FH(118.1,L,0),"^",1)) G:'NO F3
"RTN","FHWOR71",49,0)
 S DTP=$P(Y,"^",30) D DTP^FH S ^TMP($J,"FHPROF",DFN,FHX)=^(FHX)_"    Reviewed: "_DTP
"RTN","FHWOR71",50,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$P(^FH(118,Z,0),"^",1)
"RTN","FHWOR71",51,0)
 S FHX=$$SPACNG(0,FHX) F K1=1:1:3 I N(K1)'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)=$P("     10am;      2pm;      8pm",";",K1)_":    "_N(K1)
"RTN","FHWOR71",52,0)
F3 G ^FHWOR72
"RTN","FHWOR71",53,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHWOR71",54,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHWOR71",55,0)
 S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Product: "_$P($G(^FH(118.2,TUN,0)),"^",1)_", "_$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")_" Str., "_QUA Q
"RTN","FHWOR71",56,0)
SP S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHWOR71",57,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHWOR71",58,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHWOR71",59,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHWOR71",60,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHWOR71",61,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHWOR71",62,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHWOR71",63,0)
 Q
"RTN","FHWOR71",64,0)
W0 I X1'="" K ST2 S $P(ST2," ",13)="" S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_$E(ST2,1,(11-$L(FHY))) S X=X1 D W1 S X1=X
"RTN","FHWOR71",65,0)
 I X2'="" K ST2 S $P(ST2," ",47)="" S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_$E(ST2,1,(46-$L(FHY))) S X=X2 D W1 S X2=X
"RTN","FHWOR71",66,0)
 Q:X1=""&(X2="")  S FHX=$$SPACNG(0,FHX) G W0
"RTN","FHWOR71",67,0)
W1 I $L(X)<34 S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_" "_X S X="" Q
"RTN","FHWOR71",68,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHWOR71",69,0)
 S ^TMP($J,"FHPROF",DFN,FHX)=^(FHX)_" "_$E(X,1,KK-2) S X=$E(X,KK+1,999)
"RTN","FHWOR71",70,0)
 Q
"RTN","FHWOR71",71,0)
SPACNG(FHI,FHX) ;Multiple spacing before next line of text in ^TMP global
"RTN","FHWOR71",72,0)
 N I F I=1:1:FHI S FHX=FHX+1 S ^TMP($J,"FHPROF",DFN,FHX)=" "
"RTN","FHWOR71",73,0)
 S FHX=FHX+1
"RTN","FHWOR71",74,0)
 Q FHX
"RTN","FHWOR71",75,0)
TEST ; FOR TESTING ONLY - DFN must be defined
"RTN","FHWOR71",76,0)
 S I="" F  S I=$O(^TMP($J,"FHPROF",DFN,I)) Q:I=""  W !,^TMP($J,"FHPROF",DFN,I)
"RTN","FHWOR71",77,0)
 Q
"RTN","FHWORR")
0^19^B19353525
"RTN","FHWORR",1,0)
FHWORR ; HISC/NCA - Decode HL7 Utility (Cont.) ;1/30/97  14:22
"RTN","FHWORR",2,0)
 ;;5.5;DIETETICS;**2**;Jan 28, 2005
"RTN","FHWORR",3,0)
GETOR ; Call to Get FHORN
"RTN","FHWORR",4,0)
 F FHD=0:0 S FHD=$O(FHMSG(FHD)) Q:FHD<1  S XX=$G(FHMSG(FHD)) S FHD1=$$RETURN(XX) I FHD1'="" Q
"RTN","FHWORR",5,0)
 S FHORN=FHD1
"RTN","FHWORR",6,0)
 Q
"RTN","FHWORR",7,0)
MSH ; Code MSH message
"RTN","FHWORR",8,0)
 D SITE^FH
"RTN","FHWORR",9,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHWORR",10,0)
 ; code PID
"RTN","FHWORR",11,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHWORR",12,0)
 ; code PV1
"RTN","FHWORR",13,0)
 S WARD=$G(^DPT(DFN,.1)) Q:WARD=""  S FHWRD=$O(^DIC(42,"B",WARD,0)) Q:'FHWRD  S HOSP=+$P($G(^DIC(42,+FHWRD,44)),"^",1) Q:'HOSP  S RM=$G(^DPT(DFN,.108)) S:RM RM=$P($G(^DG(405.4,+RM,0)),"^",1)
"RTN","FHWORR",14,0)
 S MSG(3)="PV1||I|"_HOSP_"^"_RM_"||||||||||||||||"
"RTN","FHWORR",15,0)
 Q
"RTN","FHWORR",16,0)
GADM ; Get the correct Admission number with order.
"RTN","FHWORR",17,0)
 S:ADM'=$P(FILL,";",2) ADM=+$P(FILL,";",2)
"RTN","FHWORR",18,0)
 Q
"RTN","FHWORR",19,0)
RETURN(FHDOR) ; Return FHORN
"RTN","FHWORR",20,0)
 S FHD2=""
"RTN","FHWORR",21,0)
 I $E(FHDOR,1,3)="ORC" S FHD2=$P(FHDOR,"|",3)
"RTN","FHWORR",22,0)
 Q FHD2
"RTN","FHWORR",23,0)
CHK ; Check if Cancelling Discharged
"RTN","FHWORR",24,0)
 S CHK=0 S FHC=$G(FHMSG(3)) I $E(FHC,1,3)'="ORC" Q
"RTN","FHWORR",25,0)
 I $P(FHC,"|",2)="DC"!($P(FHC,"|",2)="CA") S CHK=1,X=$G(FHMSG(3)),ADM=$P(X,"|",4),ADM=+$P(ADM,";",2)
"RTN","FHWORR",26,0)
 Q
"RTN","FHWORR",27,0)
STATUS ; Send Status As Requested
"RTN","FHWORR",28,0)
 I FOR=1 G KIL
"RTN","FHWORR",29,0)
 I FOR=2 D NOW^%DTC S NOW=% S FHORN1=+FHORN D OEU^FHORD71 G KIL
"RTN","FHWORR",30,0)
 I FOR=3 S FHSTS=$P(DATA,"|",6) I FHSTS="IP" S FHSTS="ZE" D STS G KIL
"RTN","FHWORR",31,0)
 I FOR=4 D NOW^%DTC S NOW=% S FHORN1=+FHORN D OEU^FHORD71 G KIL
"RTN","FHWORR",32,0)
 I FOR=5 G KIL
"RTN","FHWORR",33,0)
 G KIL
"RTN","FHWORR",34,0)
STS ; Send Early/Late Tray Status
"RTN","FHWORR",35,0)
 D MSH^FHWOR S $P(MSG(1),"|",9)="ORR"
"RTN","FHWORR",36,0)
 S MSG(3)="ORC|SR|"_FHORN_"|"_FILL_"^FH||"_FHSTS
"RTN","FHWORR",37,0)
 D MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHWORR",38,0)
 Q
"RTN","FHWORR",39,0)
OMSTAT ; Send Outpatient Meals Status
"RTN","FHWORR",40,0)
 S FHORN=$P($P(MSG(4),"|",3),"^",1),FILL=$P(MSG(4),"|",4),FHSTTS="IP"
"RTN","FHWORR",41,0)
 S FHORNTMP=FHORN,FHCNORS="" D NOW^%DTC S FHTDAT=$P(%,".",1)
"RTN","FHWORR",42,0)
 I $E(FILL,1)="R" S FHREND=$P(FILL,";",4),FHMPNUM=$P(FILL,";",2) I FHTDAT>FHREND S FHSTTS="ZE",FHCNORS=FHCNORS_"^"_FHORN K MSG D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG) K MSG D
"RTN","FHWORR",43,0)
 .F FHRM=0:0 S FHRM=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHRM)) Q:FHRM'>0  D
"RTN","FHWORR",44,0)
 ..I $D(^FHPT(FHDFN,"OP",FHRM,1)) S FHORN=$P(^FHPT(FHDFN,"OP",FHRM,1),U,4) I FHCNORS'[FHORN S FHCNORS=FHCNORS_"^"_FHORN D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHWORR",45,0)
 ..I $D(^FHPT(FHDFN,"OP",FHRM,2)) S FHORN=$P(^FHPT(FHDFN,"OP",FHRM,2),U,5) I FHCNORS'[FHORN S FHCNORS=FHCNORS_"^"_FHORN D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHWORR",46,0)
 ..I $D(^FHPT(FHDFN,"OP",FHRM,3)) S FHORN=$P(^FHPT(FHDFN,"OP",FHRM,3),U,4) I FHCNORS'[FHORN S FHCNORS=FHCNORS_"^"_FHORN D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHWORR",47,0)
 .Q
"RTN","FHWORR",48,0)
 I $E(FILL,1)="S" S FHSEND=$P($P(FILL,";",2),"^",1) I FHTDAT>FHSEND S FHSTTS="ZE" D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG) K MSG D
"RTN","FHWORR",49,0)
 .I $D(^FHPT(FHDFN,"SM",FHSEND,1)) S FHORN=$P(^FHPT(FHDFN,"SM",FHSEND,1),U,4) D MSHSS^FHOMUTL,MSG^XQOR("FH EVSEND OR",.MSG)
"RTN","FHWORR",50,0)
 .Q
"RTN","FHWORR",51,0)
 K ACT,FILL,FHORN,MSG S FHORN=FHORNTMP Q
"RTN","FHWORR",52,0)
RESUME(DFN) ; Check whether to prompt resume tray
"RTN","FHWORR",53,0)
 ; Return Null for No Current Diet Order in file
"RTN","FHWORR",54,0)
 ; Return 0 for not to prompt the user
"RTN","FHWORR",55,0)
 ; Return 1 to prompt the user
"RTN","FHWORR",56,0)
 ; Return 2 to prompt the user and notify that it's a WITHHOLD SERVICE
"RTN","FHWORR",57,0)
 N ADM,A1,A2,D1,D2,FHLD,FHOR,FHORD,K1,TIM,WARD,X,X1,X2,Y
"RTN","FHWORR",58,0)
 S Y=0 S WARD=$G(^DPT(DFN,.1)) G:WARD="" EXIT
"RTN","FHWORR",59,0)
 S ADM=$G(^DPT("CN",WARD,DFN)) G:ADM<1 EXIT
"RTN","FHWORR",60,0)
 ; Get Diet
"RTN","FHWORR",61,0)
 S FHZ115="P"_DFN D CHECK^FHOMDPA I FHDFN="" Q
"RTN","FHWORR",62,0)
 S X1=^FHPT(FHDFN,"A",ADM,0),FHORD=$P(X1,"^",2),X1=$P(X1,"^",3),(FHLD,FHOR,X)="",Y=""
"RTN","FHWORR",63,0)
 G:'FHORD EXIT G:'$D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) EXIT
"RTN","FHWORR",64,0)
 ; Set FHOR & FHLD variables
"RTN","FHWORR",65,0)
 S X=^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7),Y=0
"RTN","FHWORR",66,0)
 G:"^^^^"'[FHOR EXIT
"RTN","FHWORR",67,0)
 G:FHLD="" EXIT
"RTN","FHWORR",68,0)
 D NOW^%DTC S TIM=%
"RTN","FHWORR",69,0)
 S (D1,FHORD)=0 F K1=0:0 S K1=$O(^FHPT(FHDFN,"A",ADM,"AC",K1)) Q:K1<1!(K1>TIM)  S D1=K1
"RTN","FHWORR",70,0)
 G:'D1 EXIT
"RTN","FHWORR",71,0)
S0 ; Set AC cross-ref data field
"RTN","FHWORR",72,0)
 S X2=D1,D2=$O(^FHPT(FHDFN,"A",ADM,"AC",D1)) S:D2<1 D2=""
"RTN","FHWORR",73,0)
S1 S A2=0 F A1=0:0 S A1=$O(^FHPT(FHDFN,"A",ADM,"AC",A1)) Q:A1<1!(A1'<X2)  S A2=A1
"RTN","FHWORR",74,0)
 I A2 S X2=A2,A2=$P(^FHPT(FHDFN,"A",ADM,"AC",A2,0),"^",2),X1=$P(^FHPT(FHDFN,"A",ADM,"DI",A2,0),"^",10) I X1'="",X1'>D1 G S1
"RTN","FHWORR",75,0)
 G:'A2 EXIT
"RTN","FHWORR",76,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,"DI",A2,0)),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHWORR",77,0)
 I "^^^^"'[FHOR S Y=1 G EXIT
"RTN","FHWORR",78,0)
 I FHLD="N" S Y=2 G EXIT
"RTN","FHWORR",79,0)
EXIT Q Y
"RTN","FHWORR",80,0)
KIL D KIL^FHWOR K FHORN1,FHSTS Q
"UP",115,115.016,-1)
115^OP
"UP",115,115.016,0)
115.016
"UP",115,115.017,-1)
115^SM
"UP",115,115.017,0)
115.017
"VER")
8.0^22.0
"^DD",115,115.016,21.7,0)
TUBEFEEDING CLERK^P200'^VA(200,^3;6^Q
"^DD",115,115.016,21.7,21,0)
^^1^1^3050630^
"^DD",115,115.016,21.7,21,1,0)
This field stores the clerk who entered the tubefeeding order.
"^DD",115,115.016,21.7,"DT")
3050630
"^DD",115,115.016,24.5,0)
RECURRING MEAL CLERK^P200'^VA(200,^0;17^Q
"^DD",115,115.016,24.5,21,0)
^^1^1^3050630^
"^DD",115,115.016,24.5,21,1,0)
This field stores the clerk who entered the recurring meal order.
"^DD",115,115.016,24.5,"DT")
3050630
"^DD",115,115.017,11,0)
EARLY/LATE TRAY OE/RR ORDER^P100'^OR(100,^1;4^Q
"^DD",115,115.017,11,21,0)
^^2^2^3050822^
"^DD",115,115.017,11,21,1,0)
This field is a pointer to the corresponding entry in the ORDERS (#100) 
"^DD",115,115.017,11,21,2,0)
file.
"^DD",115,115.017,11,"DT")
3050822
"^DD",115,115.017,11.5,0)
EARLY/LATE TRAY STATUS^S^A:ACTIVE;C:CANCELLED;^1;5^Q
"^DD",115,115.017,11.5,21,0)
^^1^1^3050822^
"^DD",115,115.017,11.5,21,1,0)
This field will be "A" for Active or "C" for cancelled.
"^DD",115,115.017,11.5,"DT")
3050822
"^DD",119.9,119.9,4,0)
OUTPATIENT MEALS DIET1^P111'X^FH(111,^0;2^Q
"^DD",119.9,119.9,4,1,0)
^.1
"^DD",119.9,119.9,4,1,1,0)
119.9^AC^MUMPS
"^DD",119.9,119.9,4,1,1,1)
Q
"^DD",119.9,119.9,4,1,1,2)
D OMD1IT^FHOMWOR1
"^DD",119.9,119.9,4,1,1,"%D",0)
^^2^2^3050505^
"^DD",119.9,119.9,4,1,1,"%D",1,0)
If OUTPATIENT MEALS DIET1 is deleted, the OUTPATIENT MEALS DIET2 - 5
"^DD",119.9,119.9,4,1,1,"%D",2,0)
field will also be deleted.
"^DD",119.9,119.9,4,1,1,"DT")
3050505
"^DD",119.9,119.9,4,21,0)
^^4^4^3050809^
"^DD",119.9,119.9,4,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,4,21,2,0)
fields to be set up at the individual site.  This field will be the first
"^DD",119.9,119.9,4,21,3,0)
allowable diet for ordering outpatient meals.  This first field will be
"^DD",119.9,119.9,4,21,4,0)
used as the default diet when ordering outpatient meals.
"^DD",119.9,119.9,4,"DT")
3050505
"^DD",119.9,119.9,40,0)
OUTPATIENT MEALS DIET6^P111'^FH(111,^1;1^Q
"^DD",119.9,119.9,40,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,40,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,40,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,40,21,3,0)
sixth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,40,"DT")
3050803
"^DD",119.9,119.9,41,0)
OUTPATIENT MEALS DIET7^P111'^FH(111,^1;2^Q
"^DD",119.9,119.9,41,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,41,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,41,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,41,21,3,0)
seventh allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,41,"DT")
3050803
"^DD",119.9,119.9,42,0)
OUTPATIENT MEALS DIET8^P111'^FH(111,^1;3^Q
"^DD",119.9,119.9,42,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,42,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,42,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,42,21,3,0)
eighth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,42,"DT")
3050803
"^DD",119.9,119.9,43,0)
OUTPATIENT MEALS DIET9^P111'^FH(111,^1;4^Q
"^DD",119.9,119.9,43,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,43,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,43,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,43,21,3,0)
ninth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,43,"DT")
3050803
"^DD",119.9,119.9,44,0)
OUTPATIENT MEALS DIET10^P111'^FH(111,^1;5^Q
"^DD",119.9,119.9,44,21,0)
^.001^3^3^3050809^^
"^DD",119.9,119.9,44,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,44,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,44,21,3,0)
tenth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,44,"DT")
3050803
"^DD",119.9,119.9,45,0)
OUTPATIENT MEALS DIET11^P111'^FH(111,^1;6^Q
"^DD",119.9,119.9,45,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,45,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,45,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,45,21,3,0)
eleventh allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,45,"DT")
3050809
"^DD",119.9,119.9,46,0)
OUTPATIENT MEALS DIET12^P111'^FH(111,^1;7^Q
"^DD",119.9,119.9,46,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,46,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,46,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,46,21,3,0)
twelfth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,46,"DT")
3050809
"^DD",119.9,119.9,47,0)
OUTPATIENT MEALS DIET13^P111'^FH(111,^1;8^Q
"^DD",119.9,119.9,47,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,47,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,47,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,47,21,3,0)
thirteenth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,47,"DT")
3050809
"^DD",119.9,119.9,48,0)
OUTPATIENT MEALS DIET14^P111'^FH(111,^1;9^Q
"^DD",119.9,119.9,48,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,48,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,48,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,48,21,3,0)
fourteenth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,48,"DT")
3050809
"^DD",119.9,119.9,49,0)
OUTPATIENT MEALS DIET15^P111'^FH(111,^1;10^Q
"^DD",119.9,119.9,49,21,0)
^^3^3^3050809^
"^DD",119.9,119.9,49,21,1,0)
The outpatient meals will allow diet selection from 15 site parameter
"^DD",119.9,119.9,49,21,2,0)
fields to be set up at the individual site.  This field will be the 
"^DD",119.9,119.9,49,21,3,0)
fifteenth allowable diet for ordering outpatient meals.
"^DD",119.9,119.9,49,"DT")
3050809
"BLD",5660,6)
^2
**END**
**END**
