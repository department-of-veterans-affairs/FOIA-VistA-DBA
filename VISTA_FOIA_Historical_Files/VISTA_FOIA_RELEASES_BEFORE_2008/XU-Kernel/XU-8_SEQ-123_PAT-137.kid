Released XU*8*137 SEQ #123
Extracted from mail message
**KIDS**:XU*8.0*137^

**INSTALL NAME**
XU*8.0*137
"BLD",247,0)
XU*8.0*137^KERNEL^0^3000218^y
"BLD",247,4,0)
^9.64PA^200^2
"BLD",247,4,3.081,0)
3.081
"BLD",247,4,3.081,2,0)
^9.641^3.081^1
"BLD",247,4,3.081,2,3.081,0)
SIGN-ON LOG  (File-top level)
"BLD",247,4,3.081,2,3.081,1,0)
^9.6411^.01^1
"BLD",247,4,3.081,2,3.081,1,.01,0)
USER
"BLD",247,4,3.081,222)
y^n^p^^^^n
"BLD",247,4,200,0)
200
"BLD",247,4,200,2,0)
^9.641^200^1
"BLD",247,4,200,2,200,0)
NEW PERSON  (File-top level)
"BLD",247,4,200,2,200,1,0)
^9.6411^29^1
"BLD",247,4,200,2,200,1,29,0)
SERVICE/SECTION
"BLD",247,4,200,222)
y^y^p^^^^n
"BLD",247,4,"APDD",3.081,3.081)

"BLD",247,4,"APDD",3.081,3.081,.01)

"BLD",247,4,"APDD",200,200)

"BLD",247,4,"APDD",200,200,29)

"BLD",247,4,"B",3.081,3.081)

"BLD",247,4,"B",200,200)

"BLD",247,"INIT")
EN^XU8P137
"BLD",247,"KRN",0)
^9.67PA^19^17
"BLD",247,"KRN",.4,0)
.4
"BLD",247,"KRN",.401,0)
.401
"BLD",247,"KRN",.402,0)
.402
"BLD",247,"KRN",.403,0)
.403
"BLD",247,"KRN",.5,0)
.5
"BLD",247,"KRN",.84,0)
.84
"BLD",247,"KRN",3.6,0)
3.6
"BLD",247,"KRN",3.8,0)
3.8
"BLD",247,"KRN",9.2,0)
9.2
"BLD",247,"KRN",9.8,0)
9.8
"BLD",247,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",247,"KRN",9.8,"NM",1,0)
XPDUTL^^0^B13709250
"BLD",247,"KRN",9.8,"NM",2,0)
XPDIP^^0^B36417248
"BLD",247,"KRN",9.8,"NM",3,0)
XPDET^^0^B28557686
"BLD",247,"KRN",9.8,"NM","B","XPDET",3)

"BLD",247,"KRN",9.8,"NM","B","XPDIP",2)

"BLD",247,"KRN",9.8,"NM","B","XPDUTL",1)

"BLD",247,"KRN",19,0)
19
"BLD",247,"KRN",19,"NM",0)
^9.68A^^
"BLD",247,"KRN",19.1,0)
19.1
"BLD",247,"KRN",101,0)
101
"BLD",247,"KRN",409.61,0)
409.61
"BLD",247,"KRN",771,0)
771
"BLD",247,"KRN",870,0)
870
"BLD",247,"KRN",8994,0)
8994
"BLD",247,"KRN","B",.4,.4)

"BLD",247,"KRN","B",.401,.401)

"BLD",247,"KRN","B",.402,.402)

"BLD",247,"KRN","B",.403,.403)

"BLD",247,"KRN","B",.5,.5)

"BLD",247,"KRN","B",.84,.84)

"BLD",247,"KRN","B",3.6,3.6)

"BLD",247,"KRN","B",3.8,3.8)

"BLD",247,"KRN","B",9.2,9.2)

"BLD",247,"KRN","B",9.8,9.8)

"BLD",247,"KRN","B",19,19)

"BLD",247,"KRN","B",19.1,19.1)

"BLD",247,"KRN","B",101,101)

"BLD",247,"KRN","B",409.61,409.61)

"BLD",247,"KRN","B",771,771)

"BLD",247,"KRN","B",870,870)

"BLD",247,"KRN","B",8994,8994)

"BLD",247,"QUES",0)
^9.62^^
"BLD",247,"REQB",0)
^9.611^^
"FIA",3.081)
SIGN-ON LOG
"FIA",3.081,0)
^XUSEC(0,
"FIA",3.081,0,0)
3.081P
"FIA",3.081,0,1)
y^n^p^^^^n
"FIA",3.081,0,10)

"FIA",3.081,0,11)

"FIA",3.081,0,"RLRO")

"FIA",3.081,0,"VR")
8.0^XU
"FIA",3.081,3.081)
1
"FIA",3.081,3.081,.01)

"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200I
"FIA",200,0,1)
y^y^p^^^^n
"FIA",200,0,10)

"FIA",200,0,11)

"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,29)

"INIT")
EN^XU8P137
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
137^3000218
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XPDET")
0^3^B28557686
"RTN","XPDET",1,0)
XPDET ;SFISC/RSD - Input tranforms & help for file 9.6 & 9.7 ;02/16/2000  14:41
"RTN","XPDET",2,0)
 ;;8.0;KERNEL;**15,39,41,44,51,58,66,137**;Jul 10, 1995
"RTN","XPDET",3,0)
 Q
"RTN","XPDET",4,0)
INPUTB(X) ;input tranfrom for NAME in BUILD file
"RTN","XPDET",5,0)
 ;X=user input
"RTN","XPDET",6,0)
 ;name must be unique
"RTN","XPDET",7,0)
 I $L(X)>50!($L(X)<3)!$D(^XPD(9.6,"B",X)) K X Q
"RTN","XPDET",8,0)
 I X["*" K:$P(X,"*",2,3)'?1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.6N X Q
"RTN","XPDET",9,0)
 S %=$L(X," ") I %<2 K X Q
"RTN","XPDET",10,0)
 S %=$P(X," ",%) K:%'?1.2N1"."1.2N.1(1"V",1"T").2N X
"RTN","XPDET",11,0)
 Q
"RTN","XPDET",12,0)
INPUTE(X) ;input transform for ENTRIES in KERNEL FILES multiple
"RTN","XPDET",13,0)
 ;X=user input
"RTN","XPDET",14,0)
 N D,DD,DIC,DICR,DIX,DIY,DS,DO,XPDLK,Y
"RTN","XPDET",15,0)
 S XPDLK=$$GR(D1)
"RTN","XPDET",16,0)
 I XPDLK=""!X["*" K X Q
"RTN","XPDET",17,0)
 S DIC(0)="QEMZ",DIC=XPDLK
"RTN","XPDET",18,0)
 S:D1=9.8 DIC("S")="I $T(^@$P(^(0),U))]"""""
"RTN","XPDET",19,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",20,0)
 S X=Y(0,0)
"RTN","XPDET",21,0)
 ;check that this doesn't exist already
"RTN","XPDET",22,0)
 I $D(^XPD(9.6,D0,"KRN",D1,"NM","B",X)) K X Q
"RTN","XPDET",23,0)
 ;if fm file, change X to contain file # of template
"RTN","XPDET",24,0)
 I D1<.404 S X=$$TX(X,$P(Y(0),U,$S(D1=.403:8,1:4)))
"RTN","XPDET",25,0)
 Q
"RTN","XPDET",26,0)
GLOBALE(X) ;input transform for GLOBAL multiple .01 field in file 9.6
"RTN","XPDET",27,0)
 I $L(X)>30!($L(X)<2) K X Q
"RTN","XPDET",28,0)
 I X["(",X'[")" K X Q
"RTN","XPDET",29,0)
 ;change ' back to " for subscripts, they were changed in the Pre-Lookup node of the DD, 7.5. This was done to trick FM, which doesn't allow " in .01 fields
"RTN","XPDET",30,0)
 S X=$TR(X,"'","""")
"RTN","XPDET",31,0)
 I '$D(@("^"_X)) K X
"RTN","XPDET",32,0)
 Q
"RTN","XPDET",33,0)
INPUTMB(X) ;input transform for field 10 and 11 in file 9.6
"RTN","XPDET",34,0)
 ;X=user input
"RTN","XPDET",35,0)
 N D,DD,DIC,DICR,DIX,DIY,DS,DO,Y
"RTN","XPDET",36,0)
 ;can't select a global or multi package or itself (D0)
"RTN","XPDET",37,0)
 S DIC(0)="QEMZ",DIC="^XPD(9.6,",DIC("S")="I '$P(^(0),U,3),Y'="_D0
"RTN","XPDET",38,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",39,0)
 S X=Y(0,0)
"RTN","XPDET",40,0)
 Q
"RTN","XPDET",41,0)
LOOKE(X) ;special lookup for ENTRIES in KERNEL FILES multiple
"RTN","XPDET",42,0)
 Q:X'?1.E1"*"
"RTN","XPDET",43,0)
 N %,XPD,XPDI,XPDIC,XPDF,XPDLK,XPDX,Y
"RTN","XPDET",44,0)
 S XPDLK=$$GR(D1),XPDIC=DIC,XPDF=D1
"RTN","XPDET",45,0)
 I XPDLK="" K X Q
"RTN","XPDET",46,0)
 G:$E(X)="-" DEL
"RTN","XPDET",47,0)
 S XPDX=$P(X,"*"),XPDI("IEN")=0
"RTN","XPDET",48,0)
 D LIST^DIC(D1,"","","","*",.XPDI,XPDX,"","I $$SCR^XPDET(Y)")
"RTN","XPDET",49,0)
 I '$G(^TMP("DILIST",$J,0)) K X Q
"RTN","XPDET",50,0)
 K ^TMP("XPDX",$J)
"RTN","XPDET",51,0)
 ;loop thru list from lister and file using UPDATE^DIE
"RTN","XPDET",52,0)
 F XPDI=1:1 S X=$G(^TMP("DILIST",$J,1,XPDI)) Q:X=""  D
"RTN","XPDET",53,0)
 .S:D1<.404 %=^TMP("DILIST",$J,2,XPDI)_",",X=$$TX(X,$$GET1^DIQ(D1,%,$$TF(D1),"I"))
"RTN","XPDET",54,0)
 .S Y="+"_XPDI_","_D1_","_D0_",",^TMP("XPDX",$J,9.68,Y,.01)=X,^(.03)=0
"RTN","XPDET",55,0)
 I $D(^TMP("XPDX",$J)) D UPDATE^DIE("","^TMP(""XPDX"",$J)","^TMP(""XPD"",$J)")
"RTN","XPDET",56,0)
 ;if in Screenman then call MLOAD to update screen
"RTN","XPDET",57,0)
 I $D(DDS),$D(^TMP("XPD",$J)) D MLOAD^DDSUTL("^TMP(""XPD"",$J)")
"RTN","XPDET",58,0)
 S X=""
"RTN","XPDET",59,0)
 K ^TMP("XPDX",$J),^TMP("XPD",$J)
"RTN","XPDET",60,0)
 Q
"RTN","XPDET",61,0)
DEL ;delete using wild card
"RTN","XPDET",62,0)
 I X'?1"-"1.E1"*" K X Q
"RTN","XPDET",63,0)
 S X=$E(X,2,$L(X)-1),XPDX=X S:$L(X) XPDI("IEN")=0
"RTN","XPDET",64,0)
 D LIST^DIC(9.68,","_D1_","_D0_",","","","*",.XPDI,XPDX)
"RTN","XPDET",65,0)
 I '$G(^TMP("DILIST",$J,0)) K X Q
"RTN","XPDET",66,0)
 N DIK,DA,D2
"RTN","XPDET",67,0)
 S DIK=XPDIC,DA(1)=D1,DA(2)=D0
"RTN","XPDET",68,0)
 F XPDI=1:1 S (DA,D2)=$G(^TMP("DILIST",$J,2,XPDI)) Q:'DA  D
"RTN","XPDET",69,0)
 .D ^DIK
"RTN","XPDET",70,0)
 I $D(DDS) D MDEL^DDSUTL("^TMP(""DILIST"",$J,2)")
"RTN","XPDET",71,0)
 S X=""
"RTN","XPDET",72,0)
 K ^TMP("DILIST",$J)
"RTN","XPDET",73,0)
 Q
"RTN","XPDET",74,0)
HELP ;executable help of ENTRIES in KERNEL FILE multiple
"RTN","XPDET",75,0)
 N D,DIC,DIE,DIX,DIY,DO,DZ,DS,X,Y
"RTN","XPDET",76,0)
 ;file 9.8 is routine file, check that routine exists
"RTN","XPDET",77,0)
 S DIC=$$GR(D1),DIC(0)="M",X="??" Q:DIC=""  S:D1=9.8 DIC("S")="I $T(^@$P(^(0),U))]"""""
"RTN","XPDET",78,0)
 D ^DIC Q
"RTN","XPDET",79,0)
 ;
"RTN","XPDET",80,0)
HELPO ;executable help of INSTALL ORDER in KERNEL FILES multiple
"RTN","XPDET",81,0)
 N Y
"RTN","XPDET",82,0)
 W !,"Numbers in use:  ORDER     FILE#" S Y=0
"RTN","XPDET",83,0)
 F  S Y=$O(^XPD(9.6,D0,"KRN","AC",Y)) Q:'Y  W !,?18,$J(Y,2),?28,$O(^(Y,0))
"RTN","XPDET",84,0)
 W ! Q
"RTN","XPDET",85,0)
 ;
"RTN","XPDET",86,0)
HELPMB ;executable help of fields 10 & 11 in file 9.6
"RTN","XPDET",87,0)
 N D,DIC,DIE,DIX,DIY,DO,DZ,DS,X,Y
"RTN","XPDET",88,0)
 S DIC="^XPD(9.6,",DIC(0)="M",X="??",DIC("S")="I '$P(^(0),U,3),Y'="_D0
"RTN","XPDET",89,0)
 D ^DIC Q
"RTN","XPDET",90,0)
 ;
"RTN","XPDET",91,0)
SCRA(Y) ;screen of ACTION field in ENTRIES multiple in KERNEL FILES multiple, Y=action
"RTN","XPDET",92,0)
 ;Y=0 - send, 1 - delete, 2 - link, 3 - merge, 4 - attach, 5 - disable
"RTN","XPDET",93,0)
 ;all entries can send to site
"RTN","XPDET",94,0)
 Q:'Y 1
"RTN","XPDET",95,0)
 ;.5=function file, can't delete, all others can
"RTN","XPDET",96,0)
 I Y=1 Q (D1'=.5)
"RTN","XPDET",97,0)
 ;then rest of code check if it is a Option or Protocal and can have MENU ITEMS
"RTN","XPDET",98,0)
 Q:D1'=19&(D1'=101) 0
"RTN","XPDET",99,0)
 ;only Options and Protocol can disable
"RTN","XPDET",100,0)
 Q:Y=5 1
"RTN","XPDET",101,0)
 N FGR,X,XPDF,XPDT,XPDZ
"RTN","XPDET",102,0)
 ;get X=name, FGR=global reference, XPDF=file #
"RTN","XPDET",103,0)
 S XPDY=Y,XPDF=D1,X=$P(^XPD(9.6,D0,"KRN",D1,"NM",D2,0),U),FGR=$$FILE^XPDV(D1)
"RTN","XPDET",104,0)
 Q:X="" 0
"RTN","XPDET",105,0)
 ;X=ien of protocol or option
"RTN","XPDET",106,0)
 S X=+$O(@FGR@("B",X,0)) Q:'X 0
"RTN","XPDET",107,0)
 ;get type
"RTN","XPDET",108,0)
 S XPDT=$P($G(@FGR@(X,0)),U,4)
"RTN","XPDET",109,0)
 ;all Options and Protocols, except Event Drivers, can be attached
"RTN","XPDET",110,0)
 I XPDY=4 Q '(XPDF=101&(XPDT="E"))
"RTN","XPDET",111,0)
 ;Protocol and Type is Subscriber can't do anything else
"RTN","XPDET",112,0)
 I XPDF=101,XPDT="S" Q 0
"RTN","XPDET",113,0)
 ;if it has SUBSCRIBERS, node 775 then ok
"RTN","XPDET",114,0)
 I $O(@FGR@(X,775,0)) Q 1
"RTN","XPDET",115,0)
 ;if type is menu,potocol,protocol menu,limited,extended,window suite
"RTN","XPDET",116,0)
 I "MOQLXZ"[$P($G(@FGR@(X,0)),U,4) Q 1
"RTN","XPDET",117,0)
 ;if it has ITEMs, node 10 then ok
"RTN","XPDET",118,0)
 I $O(@FGR@(X,10,0)) Q 1
"RTN","XPDET",119,0)
 Q 0
"RTN","XPDET",120,0)
 ;
"RTN","XPDET",121,0)
 ;only Fileman templates need to know what file they are associated with.
"RTN","XPDET",122,0)
 ;this value is also triggered to field .02 in the DD.
"RTN","XPDET",123,0)
TX(X,Y) ;X=template name, Y=file #
"RTN","XPDET",124,0)
 Q X_"    FILE #"_Y
"RTN","XPDET",125,0)
 ;
"RTN","XPDET",126,0)
TF(F) ;F=file, return field of file# for templates
"RTN","XPDET",127,0)
 Q $S(F>.403:"",F<.403:4,1:7)
"RTN","XPDET",128,0)
 ;
"RTN","XPDET",129,0)
GR(X) Q $G(^DIC(X,0,"GL"))
"RTN","XPDET",130,0)
 ;
"RTN","XPDET",131,0)
 ;screens checks that X is not already in the ENTRIES multiple
"RTN","XPDET",132,0)
SCR(Y) ;screen logic for ENTRIES multiple in file 9.6
"RTN","XPDET",133,0)
 N %,X,Z
"RTN","XPDET",134,0)
 S Z=^(0),X=$P(Z,U)
"RTN","XPDET",135,0)
 ;FM files are less than .44
"RTN","XPDET",136,0)
 I XPDF<.44 D  Q:X="" 0
"RTN","XPDET",137,0)
 .S %=$S(XPDF=.403:$P(Z,U,8),1:$P(Z,U,4)),X=X_"    FILE #"_%
"RTN","XPDET",138,0)
 .S:XPDF'=.403&($P(Z,U,8)>2) %=0 S:'% X=""
"RTN","XPDET",139,0)
 ;routine must exist and must be type 'R'
"RTN","XPDET",140,0)
 I XPDF=9.8 Q:$T(^@X)=""!($P(Z,U,2)'="R") 0
"RTN","XPDET",141,0)
 Q '$D(@(XPDIC_"""B"",X)"))
"RTN","XPDET",142,0)
 ;
"RTN","XPDET",143,0)
 ;screen checks that X is not in the exclude list, XPDN(0)
"RTN","XPDET",144,0)
SCR1(Y) ;screen logic for exclude list
"RTN","XPDET",145,0)
 N %,X
"RTN","XPDET",146,0)
 ;if name X is in the exclude list, XPDN(0,X), then fail
"RTN","XPDET",147,0)
 S Y(0)=^(0),X=$P(Y(0),U) Q:$D(XPDN(0,X)) 0
"RTN","XPDET",148,0)
 ;check if X is refered in the namespace by check the subscript
"RTN","XPDET",149,0)
 ;before X, if sub exist and $P(X,sub)="" then it is part of the
"RTN","XPDET",150,0)
 ;namespace, fail and return 0
"RTN","XPDET",151,0)
 S %=$O(XPDN(0,X),-1) I $L(%) Q:$P(X,%)="" 0
"RTN","XPDET",152,0)
 Q $$SCR(.Y)
"RTN","XPDET",153,0)
 ;
"RTN","XPDET",154,0)
 ;screen on PACKAGE LINK field in file 9.6,
"RTN","XPDET",155,0)
PCK(Y) ;check Package File name, Y=ien in package file
"RTN","XPDET",156,0)
 N %,Y,Z
"RTN","XPDET",157,0)
 S Z=^(0)
"RTN","XPDET",158,0)
 ;DA is undef when you are adding a new Build without a version number
"RTN","XPDET",159,0)
 Q:'$D(^XPD(9.6,+$G(DA),0)) 1
"RTN","XPDET",160,0)
 S Y=$L($P(Z,U)),%=$P(^XPD(9.6,DA,0),U),%=$$PKG^XPDUTL(%)
"RTN","XPDET",161,0)
 Q $P(Z,U)=$E(%,1,Y)!($P(Z,U,2)=%)
"RTN","XPDET",162,0)
VOLE(X) ;input transform for VOLUME SET multiple in INSTALL file
"RTN","XPDET",163,0)
 ;X=user input
"RTN","XPDET",164,0)
 N D,DD,DIC,DICR,DIX,DIY,DO,DS,XPD,Y,%
"RTN","XPDET",165,0)
 ;(0;11)=SIGNON/PRODUCTION
"RTN","XPDET",166,0)
 S DIC(0)="QEMZ",DIC="^%ZIS(14.5,",DIC("S")="I $P(^(0),U,11)"
"RTN","XPDET",167,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",168,0)
 S X=Y(0,0)
"RTN","XPDET",169,0)
 Q
"RTN","XPDET",170,0)
VOLH ;executable help for VOLUME SET multiple in INSTALL file
"RTN","XPDET",171,0)
 N D,DD,DIC,DIE,DIX,DIY,DO,DS,DZ,X,Y,%
"RTN","XPDET",172,0)
 S X="??",DIC(0)="QEMZ",DIC="^%ZIS(14.5,",DIC("S")="I $P(^(0),U,11)"
"RTN","XPDET",173,0)
 D ^DIC
"RTN","XPDET",174,0)
 Q
"RTN","XPDET",175,0)
ID97 ;identifier for Install file
"RTN","XPDET",176,0)
 N XPDET,XPD,XPD0,XPD1,XPD2,XPD9
"RTN","XPDET",177,0)
 S XPD0=$G(^(0)),XPD1=$G(^(1)),XPD2=$G(^(2)),XPD9=$P(XPD0,U,9),XPD="" Q:XPD9=""
"RTN","XPDET",178,0)
 D
"RTN","XPDET",179,0)
 .;Loaded, get DATE LOADED
"RTN","XPDET",180,0)
 .I 'XPD9 S XPD=$$FMTE^XLFDT($P(XPD0,U,3),2) Q
"RTN","XPDET",181,0)
 .Q:XPD9>3
"RTN","XPDET",182,0)
 .;Started, get INSTALL START TIME
"RTN","XPDET",183,0)
 .I XPD9=2 S XPD=$$FMTE^XLFDT($P(XPD1,U),2) Q
"RTN","XPDET",184,0)
 .;Completed, get INSTALL COMPLETE TIME
"RTN","XPDET",185,0)
 .I XPD9=3 S XPD=$$FMTE^XLFDT($P(XPD1,U,3),2) Q
"RTN","XPDET",186,0)
 .;Queued, get QUEUED TASK NUMBER
"RTN","XPDET",187,0)
 .I XPD9=1 S XPD="#"_$P(XPD0,U,6) Q
"RTN","XPDET",188,0)
 S XPDET(1)="   "_$$EXTERNAL^DILFD(9.7,.02,"",XPD9)_"  "_XPD,XPDET(1,"F")="?0"
"RTN","XPDET",189,0)
 S:XPD2]"" XPDET(2)="=> "_$E(XPD2,1,70),XPDET(2,"F")="!?5"
"RTN","XPDET",190,0)
 D EN^DDIOL(.XPDET)
"RTN","XPDET",191,0)
 Q
"RTN","XPDET",192,0)
 ;not being used right now,
"RTN","XPDET",193,0)
DEL97(Y) ;delete access to file 9.7, 0-can't delete, 1-can
"RTN","XPDET",194,0)
 N %
"RTN","XPDET",195,0)
 S %=$P(^XPD(9.7,Y,0),U,9)
"RTN","XPDET",196,0)
 Q $S(%=3:1,%=2:0,$D(^XPD(9.7,"ASP",Y,1,Y)):1,1:0)
"RTN","XPDIP")
0^2^B36417248
"RTN","XPDIP",1,0)
XPDIP ;SFISC/RSD - Install Package & Routine file ;01/10/2000  13:12
"RTN","XPDIP",2,0)
 ;;8.0;KERNEL;**15,21,28,30,41,44,51,58,83,92,100,108,137**;Jul 10, 1995
"RTN","XPDIP",3,0)
 Q
"RTN","XPDIP",4,0)
PKG ;
"RTN","XPDIP",5,0)
 N %,OLDA,DA,DIK,XPD,XPDFIL,XPDPKG,XPDBLDA,Y
"RTN","XPDIP",6,0)
 ;update variable for graphic display
"RTN","XPDIP",7,0)
 I $D(XPDIDVT) S XPDIDTOT=10,XPDIDMOD=1,XPDIDCNT=0 D:XPDIDVT UPDATE^XPDID(0)
"RTN","XPDIP",8,0)
 ;XPDPKG=ien of Package file, OLDA=old Package ien
"RTN","XPDIP",9,0)
 S Y=$$PKGADD,XPDPKG=$P(Y,U),OLDA=$P(Y,U,2)
"RTN","XPDIP",10,0)
 ;Package file entry not sent, XPDPKG=0
"RTN","XPDIP",11,0)
 G:'XPDPKG PKGEND
"RTN","XPDIP",12,0)
 ;update version multiple
"RTN","XPDIP",13,0)
 S DA=XPDPKG D PKGV
"RTN","XPDIP",14,0)
PKGH I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",15,0)
 S %=$P(^DIC(9.4,XPDPKG,0),U,4)
"RTN","XPDIP",16,0)
 ;repoint Help Frame (0;4)
"RTN","XPDIP",17,0)
 I $L(%),'% S $P(^DIC(9.4,XPDPKG,0),U,4)=$$LK^XPDIA("^DIC(9.2)",%),DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",18,0)
 ;update node 20 for Patient Merge
"RTN","XPDIP",19,0)
 N REC,IEN
"RTN","XPDIP",20,0)
 S REC=0
"RTN","XPDIP",21,0)
 F  S REC=$O(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC)) Q:'REC  D
"RTN","XPDIP",22,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",.01)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,1)
"RTN","XPDIP",23,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",3)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,3)
"RTN","XPDIP",24,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",4)=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,1))
"RTN","XPDIP",25,0)
 .D UPDATE^DIE("","IEN")
"RTN","XPDIP",26,0)
 .Q
"RTN","XPDIP",27,0)
 ;
"RTN","XPDIP",28,0)
PKGEND S XPDBLDA=$$BLD(XPDBLD) Q:'XPDBLDA
"RTN","XPDIP",29,0)
 ;move Alpha/Beta testing info to Kernel site para file
"RTN","XPDIP",30,0)
 I XPDPKG S %=$G(^XPD(9.6,XPDBLDA,"ABPKG")) D
"RTN","XPDIP",31,0)
 .;Install message and they have an address, set flag in XPDIST
"RTN","XPDIP",32,0)
 .I $P(%,U)="y",$P(%,U,2)="y",$L($P(%,U,3)) S $P(XPDIST,U,2)=$P(%,U,3)
"RTN","XPDIP",33,0)
 .D EN^XQABLOAD(XPDBLDA)
"RTN","XPDIP",34,0)
 Q
"RTN","XPDIP",35,0)
PKGADD() ;check Package file, add if not there
"RTN","XPDIP",36,0)
 ;return new Package file ien^old ien
"RTN","XPDIP",37,0)
 N DA,DIK,XPD,XPDFIL,XPDO,X,Y
"RTN","XPDIP",38,0)
 S DA=+$P(^XPD(9.7,XPDA,0),U,2),XPDO=+$O(^XTMP("XPDI",XPDA,"PKG",0)),X=$P($G(^(XPDO,0)),U)
"RTN","XPDIP",39,0)
 I DA,$D(^DIC(9.4,DA,0)) Q DA_U_XPDO
"RTN","XPDIP",40,0)
 ;quit if there was no package entry sent
"RTN","XPDIP",41,0)
 Q:'XPDO "0^0"
"RTN","XPDIP",42,0)
 S XPDFIL=9.4,Y=$$DIC^XPDIK(9.4,X) Q:'Y "0^0"
"RTN","XPDIP",43,0)
 S DA=+Y
"RTN","XPDIP",44,0)
 ;if new entry in package file, bring in everything
"RTN","XPDIP",45,0)
 I $P(Y,U,3) D
"RTN","XPDIP",46,0)
 .M ^DIC(9.4,DA)=^XTMP("XPDI",XPDA,"PKG",XPDO)
"RTN","XPDIP",47,0)
 .;kill the -1 flag node first
"RTN","XPDIP",48,0)
 .K ^DIC(9.4,DA,-1)
"RTN","XPDIP",49,0)
 .;re-cross ref after adding a new package
"RTN","XPDIP",50,0)
 .S DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",51,0)
 ;add package to file 9.7
"RTN","XPDIP",52,0)
 S XPD(9.7,XPDA_",",1)=DA D FILE^DIE("","XPD")
"RTN","XPDIP",53,0)
 Q DA_U_XPDO
"RTN","XPDIP",54,0)
 ;
"RTN","XPDIP",55,0)
BLD(XPDBLD) ;add Build entry, XPDBLD=Build ien in ^XTMP("XPDI",XPDA,"BLD",
"RTN","XPDIP",56,0)
 N %,DA,DIK,XPDFIL,Y
"RTN","XPDIP",57,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",58,0)
 ;XPDBLD=Build ien in ^XTMP, set in XPDIJ
"RTN","XPDIP",59,0)
 S XPDFIL=9.6,Y=$$DIC^XPDIK(9.6,XPDNM) Q:'Y ""
"RTN","XPDIP",60,0)
 S DA=+Y
"RTN","XPDIP",61,0)
 ;Build entry not new, remove old data
"RTN","XPDIP",62,0)
 I '$P(Y,U,3) S %=$P(^XPD(9.6,DA,0),U,2) K ^XPD(9.6,DA) K:% ^XPD(9.6,"C",%,DA)
"RTN","XPDIP",63,0)
 M ^XPD(9.6,DA)=^XTMP("XPDI",XPDA,"BLD",XPDBLD)
"RTN","XPDIP",64,0)
 ;reset Package File Link (0;2)
"RTN","XPDIP",65,0)
 ;XPDIST = national site tracking^A/B install message address
"RTN","XPDIP",66,0)
 S $P(^XPD(9.6,DA,0),U,2)=$S(XPDPKG:XPDPKG,1:"") S:$P(^(0),U,5)="y" XPDIST=1
"RTN","XPDIP",67,0)
 ;re-index cross-ref. on fields .01 and 1
"RTN","XPDIP",68,0)
 S DIK="^XPD(9.6," F Y=.01,1 S DIK(1)=Y D EN1^DIK
"RTN","XPDIP",69,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",70,0)
 Q DA
"RTN","XPDIP",71,0)
 ;
"RTN","XPDIP",72,0)
 ;update the version multiple in the package file
"RTN","XPDIP",73,0)
PKGV N %
"RTN","XPDIP",74,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",75,0)
 ;%=ien in the Version multiple_U_ien in Patch multiple in ^XTMP
"RTN","XPDIP",76,0)
 S %=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,-1))
"RTN","XPDIP",77,0)
 I XPDNM'["*" D  Q
"RTN","XPDIP",78,0)
 .S %=+% Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,%,0))  S %=^(0) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",79,0)
 .S $P(%,U,3,4)=DT_U_DUZ,%=$$PKGVER(DA,.%)
"RTN","XPDIP",80,0)
 ;update patch history multiple
"RTN","XPDIP",81,0)
 Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,+%,"PAH",+$P(%,U,2),0))  S %=$P(^(0),U) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",82,0)
 ;check File Comment, %=patch number
"RTN","XPDIP",83,0)
 S:^XPD(9.7,XPDA,2)[" SEQ #" %=$P(^(2),"*",3)
"RTN","XPDIP",84,0)
 S $P(%,U,2,3)=DT_U_DUZ,%=$$PKGPAT(DA,$$VER^XPDUTL(XPDNM),.%)
"RTN","XPDIP",85,0)
 Q
"RTN","XPDIP",86,0)
 ;
"RTN","XPDIP",87,0)
PKGVER(XPDPDA,XPDI) ;update version in package file, XPDPDA=Package file ien, return ien
"RTN","XPDIP",88,0)
 ;XPDI=version^date distr.^date installed^install by
"RTN","XPDIP",89,0)
 ;XPDI(1)=root of description field
"RTN","XPDIP",90,0)
 N I,X,XPD,XPDIEN,XPDJ,XPDV
"RTN","XPDIP",91,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,$P(XPDI,U)) Q:'XPDV 0
"RTN","XPDIP",92,0)
 S XPD(9.4,XPDPDA_",",13)=$P(XPDI,U),X="XPD(9.49,"""_XPDV_XPDIEN_""")"
"RTN","XPDIP",93,0)
 F I=1:1:3 S:$P(XPDI,U,I+1)]"" @X@(I)=$P(XPDI,U,I+1)
"RTN","XPDIP",94,0)
 S:$D(XPDI(1)) @X@(41)=XPDI(1)
"RTN","XPDIP",95,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",96,0)
 Q XPDV
"RTN","XPDIP",97,0)
 ;
"RTN","XPDIP",98,0)
PKGPAT(XPDPDA,XPDV,XPDI) ;update patch history
"RTN","XPDIP",99,0)
 ;INPUT: XPDPDA=Package file ien, XPDV=version
"RTN","XPDIP",100,0)
 ;XPDI=patch^date installed^install by,   returns version ien^patch ien
"RTN","XPDIP",101,0)
 N I,X,XPD,XPDP,XPDIEN
"RTN","XPDIP",102,0)
 ;quit if we can't find the version multiple, resets XPDV=ien of version
"RTN","XPDIP",103,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,XPDV) Q:'XPDV 0
"RTN","XPDIP",104,0)
 S XPDIEN=","_XPDV_XPDIEN,XPDP=$$MDIC(9.4901,XPDIEN,$P(XPDI,U)) Q:'XPDP 0
"RTN","XPDIP",105,0)
 S X="XPD(9.4901,"""_XPDP_XPDIEN_""")"
"RTN","XPDIP",106,0)
 F I=.02,.03 S:$P(XPDI,U,I*100)]"" @X@(I)=$P(XPDI,U,I*100)
"RTN","XPDIP",107,0)
 S:$D(XPDI(1)) @X@(1)=XPDI(1)
"RTN","XPDIP",108,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",109,0)
 Q XPDV_U_XPDP
"RTN","XPDIP",110,0)
 ;
"RTN","XPDIP",111,0)
 ;XPDF=subfile #,XPDIEN=ien string, X=input
"RTN","XPDIP",112,0)
MDIC(XPDF,XPDIEN,XPDX) ;
"RTN","XPDIP",113,0)
 N DIERR,XPD,XPDN
"RTN","XPDIP",114,0)
 D FIND^DIC(XPDF,XPDIEN,"","XQf",XPDX,5,"","","","XPD")
"RTN","XPDIP",115,0)
 ;one or more matches, just return first one
"RTN","XPDIP",116,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIP",117,0)
 .N %
"RTN","XPDIP",118,0)
 .S %(1)=$P(^DD(XPDF,.01,0),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIP",119,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIP",120,0)
 ;add a new entry
"RTN","XPDIP",121,0)
 S XPDN(XPDF,"+1"_XPDIEN,.01)=XPDX K XPD
"RTN","XPDIP",122,0)
 D UPDATE^DIE("","XPDN","XPD")
"RTN","XPDIP",123,0)
 I '$G(XPD(1)) D BMES^XPDUTL(" "_$P(^DD(XPDF,.01,0),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIP",124,0)
 Q XPD(1)
"RTN","XPDIP",125,0)
 ;
"RTN","XPDIP",126,0)
RTN ;move rtns to install file
"RTN","XPDIP",127,0)
 N XPD,XPDC,XPDCR,XPDI,XPDJ,XPDK,XPDL,XPDM,XPDR,XPDRH,X
"RTN","XPDIP",128,0)
 K ^XPD(9.7,XPDA,"RTN"),^TMP($J)
"RTN","XPDIP",129,0)
 S (XPDC,XPDCR,XPDRH)=0,XPDJ=""
"RTN","XPDIP",130,0)
 ;get all routines that were loaded, XPDM=action
"RTN","XPDIP",131,0)
 ;actions are 0=load, 1=delete, 2=skip
"RTN","XPDIP",132,0)
 F  S XPDJ=$O(^XTMP("XPDI",XPDA,"RTN",XPDJ)) Q:XPDJ=""  S XPDM=^(XPDJ) D:'XPDM
"RTN","XPDIP",133,0)
 .;XPD, build array to update ROUTINE multiple in INSTALL file
"RTN","XPDIP",134,0)
 .S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",135,0)
 .;XPDR, build array to update ROUTINE file
"RTN","XPDIP",136,0)
 .S:'$D(^DIC(9.8,"B",XPDJ)) XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R"
"RTN","XPDIP",137,0)
 ;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",138,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDTOT*.4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",139,0)
 F XPDK="DIKZ","DIEZ","DIPZ" D
"RTN","XPDIP",140,0)
 .S XPDI=0
"RTN","XPDIP",141,0)
 .;loop thru list of compile template routines
"RTN","XPDIP",142,0)
 .;XTMP("XPDI",XPDA,"DIKZ",ien,routine name)
"RTN","XPDIP",143,0)
 .F  S XPDI=$O(^XTMP("XPDI",XPDA,XPDK,XPDI)),XPDJ="" Q:'XPDI  D
"RTN","XPDIP",144,0)
 ..I 'XPDRH D BMES^XPDUTL(" The following Routines were created during this install:") S XPDRH=1
"RTN","XPDIP",145,0)
 ..F  S XPDJ=$O(^XTMP("XPDI",XPDA,XPDK,XPDI,XPDJ)) Q:XPDJ=""  D:'$D(^XTMP("XPDI",XPDA,"RTN",XPDJ))
"RTN","XPDIP",146,0)
 ...S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",147,0)
 ...D MES^XPDUTL("     "_XPDJ)
"RTN","XPDIP",148,0)
 ;update routine multiple in Install file with routines and
"RTN","XPDIP",149,0)
 ;compile template routines
"RTN","XPDIP",150,0)
 I $D(^TMP($J,"XPD"))>9 D
"RTN","XPDIP",151,0)
 .D UPDATE^DIE("","^TMP($J,""XPD"")","^TMP($J,""XPDL"")")
"RTN","XPDIP",152,0)
 .;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",153,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+(XPDIDTOT*.40) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",154,0)
 ;update Routine file
"RTN","XPDIP",155,0)
 D:$D(^TMP($J,"XPDR"))>9 UPDATE^DIE("","^TMP($J,""XPDR"")")
"RTN","XPDIP",156,0)
 ;if we are doing VT graphic display, update 100%
"RTN","XPDIP",157,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",158,0)
 Q
"RTN","XPDUTL")
0^1^B13709250
"RTN","XPDUTL",1,0)
XPDUTL ;SFISC/RSD - KIDS utilities ;01/10/2000  13:10
"RTN","XPDUTL",2,0)
 ;;8.0;KERNEL;**21,28,39,81,100,108,137**;Jul 10, 1995
"RTN","XPDUTL",3,0)
 Q
"RTN","XPDUTL",4,0)
VERSION(X) ;Get current version from Package file, X=package name or
"RTN","XPDUTL",5,0)
 ;package namespace
"RTN","XPDUTL",6,0)
 N I
"RTN","XPDUTL",7,0)
 S I=$O(^DIC(9.4,"C",X,0)) S:I'>0 I=$O(^DIC(9.4,"B",X,0))
"RTN","XPDUTL",8,0)
 Q $P($G(^DIC(9.4,+I,"VERSION")),"^")
"RTN","XPDUTL",9,0)
 ;
"RTN","XPDUTL",10,0)
VER(X) ;returns version number from Build file, X=build name
"RTN","XPDUTL",11,0)
 Q:X["*" $P(X,"*",2)
"RTN","XPDUTL",12,0)
 Q $P(X," ",$L(X," "))
"RTN","XPDUTL",13,0)
 ;
"RTN","XPDUTL",14,0)
PKG(X) ;returns package name from Build file, X=build name
"RTN","XPDUTL",15,0)
 Q $S(X["*":$P(X,"*"),1:$P(X," ",1,$L(X," ")-1))
"RTN","XPDUTL",16,0)
 ;
"RTN","XPDUTL",17,0)
PATCH(X) ;return 1 if patch X was installed, X=aaaa*nn.nn*nnn
"RTN","XPDUTL",18,0)
 Q:X'?1.4UN1"*"1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.3N 0
"RTN","XPDUTL",19,0)
 N %,I,J
"RTN","XPDUTL",20,0)
 S I=$O(^DIC(9.4,"C",$P(X,"*"),0)) Q:'I 0
"RTN","XPDUTL",21,0)
 S J=$O(^DIC(9.4,I,22,"B",$P(X,"*",2),0)),X=$P(X,"*",3) Q:'J 0
"RTN","XPDUTL",22,0)
 ;check if patch is just a number
"RTN","XPDUTL",23,0)
 Q:$O(^DIC(9.4,I,22,J,"PAH","B",X,0)) 1
"RTN","XPDUTL",24,0)
 S %=$O(^DIC(9.4,I,22,J,"PAH","B",X_" SEQ"))
"RTN","XPDUTL",25,0)
 Q (X=+%)
"RTN","XPDUTL",26,0)
 ;
"RTN","XPDUTL",27,0)
NEWCP(XPD,XPDC,XPDP) ;create new check point, returns 0=error or ien
"RTN","XPDUTL",28,0)
 ;XPD=name, XPDC=call back, XPDP=parameters
"RTN","XPDUTL",29,0)
 Q:$G(XPD)="" 0
"RTN","XPDUTL",30,0)
 N %,XPDI,XPDJ,XPDF,XPDY
"RTN","XPDUTL",31,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","XPDUTL",32,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713)
"RTN","XPDUTL",33,0)
 S %=$$FIND1^DIC(XPDI,","_XPDA_",","X",XPD) Q:% %
"RTN","XPDUTL",34,0)
 S XPDF="+1,"_XPDA_",",XPDJ(XPDI,XPDF,.01)=XPD
"RTN","XPDUTL",35,0)
 S:$D(XPDC) XPDJ(XPDI,XPDF,2)=XPDC
"RTN","XPDUTL",36,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","XPDUTL",37,0)
 D UPDATE^DIE("","XPDJ","XPDY")
"RTN","XPDUTL",38,0)
 Q $G(XPDY(1))
"RTN","XPDUTL",39,0)
 ;
"RTN","XPDUTL",40,0)
UPCP(XPD,XPDP) ;update check point, returns 0=error or ien
"RTN","XPDUTL",41,0)
 ;XPD=name, XPDP=parameters
"RTN","XPDUTL",42,0)
 N XPDI,XPDJ,XPDF,XPDY
"RTN","XPDUTL",43,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","XPDUTL",44,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",45,0)
 Q:'XPDY 0
"RTN","XPDUTL",46,0)
 S XPDF=XPDY_","_XPDA_","
"RTN","XPDUTL",47,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","XPDUTL",48,0)
 D FILE^DIE("","XPDJ")
"RTN","XPDUTL",49,0)
 Q XPDY
"RTN","XPDUTL",50,0)
 ;
"RTN","XPDUTL",51,0)
COMCP(XPD) ;complete check point, returns 0=error or date/time
"RTN","XPDUTL",52,0)
 ;XPD=name
"RTN","XPDUTL",53,0)
 N XPDD,XPDI,XPDJ,XPDY
"RTN","XPDUTL",54,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",55,0)
 Q:'XPDY 0
"RTN","XPDUTL",56,0)
 S XPDD=$$NOW^XLFDT,XPDJ(XPDI,XPDY_","_XPDA_",",1)=XPDD
"RTN","XPDUTL",57,0)
 D FILE^DIE("","XPDJ")
"RTN","XPDUTL",58,0)
 Q XPDD
"RTN","XPDUTL",59,0)
 ;
"RTN","XPDUTL",60,0)
VERCP(XPD) ;verify check point, returns 1=completed, 0=not
"RTN","XPDUTL",61,0)
 ;-1=doesn't exist
"RTN","XPDUTL",62,0)
 ;XPD=name
"RTN","XPDUTL",63,0)
 N XPDI,XPDY
"RTN","XPDUTL",64,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",65,0)
 Q:'XPDY -1
"RTN","XPDUTL",66,0)
 Q ''$$GET1^DIQ(XPDI,XPDY_","_XPDA_",",1,"I")
"RTN","XPDUTL",67,0)
 ;
"RTN","XPDUTL",68,0)
PARCP(XPD,XPDF) ;returns parameters of check point
"RTN","XPDUTL",69,0)
 ;XPD=name, XPDF="PRE"
"RTN","XPDUTL",70,0)
 N XPDI,XPDY
"RTN","XPDUTL",71,0)
 I $G(XPDF)="PRE" N XPDCP S XPDCP="INI"
"RTN","XPDUTL",72,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",73,0)
 Q:'XPDY 0
"RTN","XPDUTL",74,0)
 Q $$GET1^DIQ(XPDI,XPDY_","_XPDA_",",3,"I")
"RTN","XPDUTL",75,0)
 ;
"RTN","XPDUTL",76,0)
CURCP(XPDF) ;returns current check point
"RTN","XPDUTL",77,0)
 ;XPDF flag - 0=externel, 1=internal
"RTN","XPDUTL",78,0)
 Q $S($G(XPDF):XPDCHECK,1:XPDCHECK(0))
"RTN","XPDUTL",79,0)
 ;
"RTN","XPDUTL",80,0)
WP(X) ;X=global ref
"RTN","XPDUTL",81,0)
 N %
"RTN","XPDUTL",82,0)
 Q:'$D(@X)
"RTN","XPDUTL",83,0)
 F %=1:1 Q:'$D(@X@(%))  W !,@X@(%)
"RTN","XPDUTL",84,0)
 Q:'$G(XPDA)  D WP^DIE(9.7,XPDA_",",20,"A",X)
"RTN","XPDUTL",85,0)
 Q
"RTN","XPDUTL",86,0)
MES(X) ;record message, X=message or an array passed by reference
"RTN","XPDUTL",87,0)
 N %
"RTN","XPDUTL",88,0)
 I $D(X)#2 S %=X K X S X(1)=%
"RTN","XPDUTL",89,0)
 ;write message
"RTN","XPDUTL",90,0)
 F %=1:1 Q:'$D(X(%))  W !,X(%)
"RTN","XPDUTL",91,0)
 Q:'$G(XPDA)  D WP^DIE(9.7,XPDA_",",20,"A","X")
"RTN","XPDUTL",92,0)
 Q
"RTN","XPDUTL",93,0)
BMES(X) ;add blank line before message
"RTN","XPDUTL",94,0)
 N %
"RTN","XPDUTL",95,0)
 I $D(X)#2 S %=X K X S X(1)=" ",X(2)=%
"RTN","XPDUTL",96,0)
 D MES(.X)
"RTN","XPDUTL",97,0)
 Q
"RTN","XPDUTL",98,0)
RTNUP(X,Y) ;update routine action, X=routine, Y=action
"RTN","XPDUTL",99,0)
 ;actions:  1=delete, 2=skip
"RTN","XPDUTL",100,0)
 N %
"RTN","XPDUTL",101,0)
 ;set action to Y
"RTN","XPDUTL",102,0)
 Q:'$G(Y)!'$D(^XTMP("XPDI",$G(XPDA),"RTN",X)) 0 S $P(^(X),U)=+Y
"RTN","XPDUTL",103,0)
 Q 1
"RTN","XPDUTL",104,0)
 ;get Build ien
"RTN","XPDUTL",105,0)
 S Y=$O(^XTMP("XPDI",XPDA,"BLD",0))
"RTN","XPDUTL",106,0)
 ;remove checksum when updating action, since action can only be
"RTN","XPDUTL",107,0)
 ;delete or skip, not sure if we want to do this
"RTN","XPDUTL",108,0)
 S:$P(%,U,2) $P(^XTMP("XPDI",XPDA,"BLD",Y,"KRN",9.8,"NM",$P(%,U,2),0),U,4)=""
"RTN","XPDUTL",109,0)
 Q 1
"RTN","XPDUTL",110,0)
DICCP(X) ;lookup check point, returns ien or 0
"RTN","XPDUTL",111,0)
 Q:$G(X)="" 0
"RTN","XPDUTL",112,0)
 ;if they pass ien, fail if can't find
"RTN","XPDUTL",113,0)
 I X=+X S Y=X Q:'$D(^XPD(9.7,XPDA,XPDCP,Y,0)) 0
"RTN","XPDUTL",114,0)
 E  S Y=$$FIND1^DIC(XPDI,","_XPDA_",","X",X)
"RTN","XPDUTL",115,0)
 Q Y
"RTN","XPDUTL",116,0)
 ;
"RTN","XPDUTL",117,0)
PRODE(XPDN,XPD) ;enable/disable protocols, return 1 for success
"RTN","XPDUTL",118,0)
 ;XPDN=protocol name, XPD=1-enable, 0-disable
"RTN","XPDUTL",119,0)
 Q:$G(XPDN)="" 0
"RTN","XPDUTL",120,0)
 S XPD=+$G(XPD)
"RTN","XPDUTL",121,0)
 D KIDS^XQOO1($P(XPDSET,U,2),101,XPDN,.XPD)
"RTN","XPDUTL",122,0)
 Q $S(XPD<0:0,1:1)
"RTN","XPDUTL",123,0)
 ;
"RTN","XPDUTL",124,0)
OPTDE(XPDN,XPD) ;enable/disable options, return 1 for success
"RTN","XPDUTL",125,0)
 ;XPDN=protocol name, XPD=1-enable, 0-disable
"RTN","XPDUTL",126,0)
 Q:$G(XPDN)="" 0
"RTN","XPDUTL",127,0)
 S XPD=+$G(XPD)
"RTN","XPDUTL",128,0)
 D KIDS^XQOO1($P(XPDSET,U,2),19,XPDN,.XPD)
"RTN","XPDUTL",129,0)
 Q $S(XPD<0:0,1:1)
"RTN","XPDUTL",130,0)
 ;
"RTN","XPDUTL",131,0)
BUILD(XPDN,XPD) ;check if a build exists, return 1 for success
"RTN","XPDUTL",132,0)
 ;XPDN=build name, XPD=1-exist, 0-been removed
"RTN","XPDUTL",133,0)
 S XPD=$D(XPDT("NM",XPDN))
"RTN","XPDUTL",134,0)
 Q XPD
"RTN","XPDUTL",135,0)
 ;
"RTN","XPDUTL",136,0)
MAILGRP(X) ;Return mail group for package, X=package name or namespace
"RTN","XPDUTL",137,0)
 N XD,DIC,DR,DA,DIQ
"RTN","XPDUTL",138,0)
 S DA=$O(^DIC(9.4,"C",X,0)) S:DA'>0 DA=$O(^DIC(9.4,"B",X,0)) Q:'DA ""
"RTN","XPDUTL",139,0)
 S DIC="^DIC(9.4,",DR=1938,DIQ="XD" D EN^DIQ1
"RTN","XPDUTL",140,0)
 Q $S($G(XD(9.4,DA,1938))="":"",1:"G."_XD(9.4,DA,1938))
"RTN","XU8P137")
0^^B7232079
"RTN","XU8P137",1,0)
XU8P137 ;SF/CIOFO-JDS  Post Init for XU*8*137 ;02/18/2000  10:18
"RTN","XU8P137",2,0)
 ;KIDS POST-INIT
"RTN","XU8P137",3,0)
 ;
"RTN","XU8P137",4,0)
 ;   This Post-Init routine cleans-up problem in the Patch
"RTN","XU8P137",5,0)
 ;   Application History sub-file of the Package File and the 
"RTN","XU8P137",6,0)
 ;   State File.
"RTN","XU8P137",7,0)
 ;
"RTN","XU8P137",8,0)
EN D PATCH
"RTN","XU8P137",9,0)
 D STATE
"RTN","XU8P137",10,0)
 D MMXREF
"RTN","XU8P137",11,0)
 Q
"RTN","XU8P137",12,0)
 ;
"RTN","XU8P137",13,0)
PATCH ;
"RTN","XU8P137",14,0)
 ;   Search Patch Application History in the PACKAGE file
"RTN","XU8P137",15,0)
 ;   for entries that contain version number_"*"_patch number_
"RTN","XU8P137",16,0)
 ;   sequence number.  The PAH field should only have
"RTN","XU8P137",17,0)
 ;   patch number_sequence number for released patches.
"RTN","XU8P137",18,0)
 ;   If a "*" is found it will be removed leaving patch and sequence 
"RTN","XU8P137",19,0)
 ;   numbers.
"RTN","XU8P137",20,0)
 ;
"RTN","XU8P137",21,0)
 N X,Y,Z,PAHCOMM,PAHXX
"RTN","XU8P137",22,0)
 W !,"Searching PACKAGE file to correct Patch Application History .."
"RTN","XU8P137",23,0)
 F X=0:0 S X=$O(^DIC(9.4,X)) Q:X'>0  D
"RTN","XU8P137",24,0)
 . W "."
"RTN","XU8P137",25,0)
 . F Y=0:0 S Y=$O(^DIC(9.4,X,22,Y)) Q:Y'>0  D
"RTN","XU8P137",26,0)
 . . W "."
"RTN","XU8P137",27,0)
 . . F Z=0:0 S Z=$O(^DIC(9.4,X,22,Y,"PAH",Z)) Q:Z'>0  D
"RTN","XU8P137",28,0)
 . . . S PAHCOMM=$P(^DIC(9.4,X,22,Y,"PAH",Z,0),"^",1)
"RTN","XU8P137",29,0)
 . . . I PAHCOMM'["*" Q
"RTN","XU8P137",30,0)
 . . . S PAHCOMM=$P(PAHCOMM,"*",2)
"RTN","XU8P137",31,0)
 . . . K PAHXX
"RTN","XU8P137",32,0)
 . . . S PAHXX(9.4901,Z_","_Y_","_X_",",.01)=PAHCOMM
"RTN","XU8P137",33,0)
 . . . D FILE^DIE("","PAHXX")
"RTN","XU8P137",34,0)
 . . . K PAHXX
"RTN","XU8P137",35,0)
 . . . W "."
"RTN","XU8P137",36,0)
 . . . Q
"RTN","XU8P137",37,0)
 ;
"RTN","XU8P137",38,0)
 W !!,"Finished!"
"RTN","XU8P137",39,0)
 Q
"RTN","XU8P137",40,0)
STATE ;
"RTN","XU8P137",41,0)
 ; This routine will remove the following corrupt DD nodes
"RTN","XU8P137",42,0)
 ; and Xref that reference Field #3 (COUNTY) of File #5 (STATE):
"RTN","XU8P137",43,0)
 ;
"RTN","XU8P137",44,0)
 ; 1.  ^DD(5,"IX",3)
"RTN","XU8P137",45,0)
 ; 2.  ^DD(5,0,"IX","D",5,3)
"RTN","XU8P137",46,0)
 ; 3.  ^DD(5,3,1)
"RTN","XU8P137",47,0)
 ; 4.  ^DIC(5,"D")
"RTN","XU8P137",48,0)
 ;
"RTN","XU8P137",49,0)
 N ZZS0
"RTN","XU8P137",50,0)
 S ZZS0=0
"RTN","XU8P137",51,0)
 W !!,"Processing State File ..."
"RTN","XU8P137",52,0)
P1 ;
"RTN","XU8P137",53,0)
 I $D(^DD(5,"IX",3))#2 D
"RTN","XU8P137",54,0)
 . S ZZS0=1
"RTN","XU8P137",55,0)
 . S X="Removing node: ^DD(5,""IX"",3)" D MES^XPDUTL(X)
"RTN","XU8P137",56,0)
 . K ^DD(5,"IX",3) ;Uncomment when thru testing logic
"RTN","XU8P137",57,0)
 ;
"RTN","XU8P137",58,0)
P2 ;
"RTN","XU8P137",59,0)
 I $D(^DD(5,0,"IX","D",5,3))#2 D
"RTN","XU8P137",60,0)
 . S ZZS0=1
"RTN","XU8P137",61,0)
 . S X="Removing node: ^DD(5,0,""IX"",""D"",5,3)" D MES^XPDUTL(X)
"RTN","XU8P137",62,0)
 . K ^DD(5,0,"IX","D",5,3) ;Uncomment when thru testing logic
"RTN","XU8P137",63,0)
 ;
"RTN","XU8P137",64,0)
P3 ;
"RTN","XU8P137",65,0)
 I $D(^DD(5,3,1,0))#2 D
"RTN","XU8P137",66,0)
 . S ZZS0=1
"RTN","XU8P137",67,0)
 . S X="Removing all Cross References on Field #3 (COUNTY)" D MES^XPDUTL(X)
"RTN","XU8P137",68,0)
 . K ^DD(5,3,1) ;Uncomment when thru testing logic
"RTN","XU8P137",69,0)
 ;
"RTN","XU8P137",70,0)
P4 ;
"RTN","XU8P137",71,0)
 I $D(^DIC(5,"D")) D
"RTN","XU8P137",72,0)
 . S ZZS0=1
"RTN","XU8P137",73,0)
 . S X="Removing the only reported ""Bad Cross Reference"" - ""D""" D MES^XPDUTL(X)
"RTN","XU8P137",74,0)
 . K ^DIC(5,"D") ;Uncomment when thru testing logic
"RTN","XU8P137",75,0)
 I 'ZZS0 S X="Everything is fine with Field #3 (COUNTY) of file #5 (STATE)." D MES^XPDUTL(X)
"RTN","XU8P137",76,0)
 K ZZS0
"RTN","XU8P137",77,0)
 Q
"RTN","XU8P137",78,0)
 ;
"RTN","XU8P137",79,0)
MMXREF ;
"RTN","XU8P137",80,0)
 N DIK
"RTN","XU8P137",81,0)
 S DIK="^VA(200,",DIK(1)="29^E"
"RTN","XU8P137",82,0)
 D ENALL^DIK
"RTN","XU8P137",83,0)
 Q
"VER")
8.0^22.0
"^DD",3.081,3.081,.01,0)
USER^RP200'^VA(200,^0;1^Q
"^DD",3.081,3.081,.01,1,0)
^.1
"^DD",3.081,3.081,.01,1,1,0)
3.081^CUR^MUMPS
"^DD",3.081,3.081,.01,1,1,1)
S ^XUSEC(0,"CUR",$E(X,1,30),DA)=""
"^DD",3.081,3.081,.01,1,1,2)
K ^XUSEC(0,"CUR",$E(X,1,30),DA)
"^DD",3.081,3.081,.01,3)

"^DD",3.081,3.081,.01,10)
SIGN-ON SYSTEM
"^DD",3.081,3.081,.01,21,0)
^^1^1^2920528^^^
"^DD",3.081,3.081,.01,21,1,0)
This is the user that signed on.
"^DD",3.081,3.081,.01,"DT")
2910618
"^DD",200,200,29,0)
SERVICE/SECTION^RP49'^DIC(49,^5;1^Q
"^DD",200,200,29,1,0)
^.1
"^DD",200,200,29,1,1,0)
200^E
"^DD",200,200,29,1,1,1)
S ^VA(200,"E",$E(X,1,30),DA)=""
"^DD",200,200,29,1,1,2)
K ^VA(200,"E",$E(X,1,30),DA)
"^DD",200,200,29,1,1,"DT")
3000218
"^DD",200,200,29,21,0)
^^1^1^2920317^
"^DD",200,200,29,21,1,0)
This is the name of the service or section for the new person.
"^DD",200,200,29,"DT")
3000218
**END**
**END**
