Released GMTS*2.7*57 SEQ #64
Extracted from mail message
**KIDS**:GMTS*2.7*57^

**INSTALL NAME**
GMTS*2.7*57
"BLD",4863,0)
GMTS*2.7*57^HEALTH SUMMARY^0^3040803^y
"BLD",4863,1,0)
^^2^2^3020530^^^
"BLD",4863,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",4863,1,2,0)
patch GMTS*2.7*57.
"BLD",4863,4,0)
^9.64PA^^
"BLD",4863,"KRN",0)
^9.67PA^8989.52^19
"BLD",4863,"KRN",.4,0)
.4
"BLD",4863,"KRN",.401,0)
.401
"BLD",4863,"KRN",.402,0)
.402
"BLD",4863,"KRN",.403,0)
.403
"BLD",4863,"KRN",.5,0)
.5
"BLD",4863,"KRN",.84,0)
.84
"BLD",4863,"KRN",3.6,0)
3.6
"BLD",4863,"KRN",3.8,0)
3.8
"BLD",4863,"KRN",9.2,0)
9.2
"BLD",4863,"KRN",9.8,0)
9.8
"BLD",4863,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4863,"KRN",9.8,"NM",1,0)
GMTSROB^^0^B7614557
"BLD",4863,"KRN",9.8,"NM",2,0)
GMTSRON^^0^B24443367
"BLD",4863,"KRN",9.8,"NM",3,0)
GMTSROE^^0^B54429367
"BLD",4863,"KRN",9.8,"NM",4,0)
GMTSRO^^0^B37259437
"BLD",4863,"KRN",9.8,"NM","B","GMTSRO",4)

"BLD",4863,"KRN",9.8,"NM","B","GMTSROB",1)

"BLD",4863,"KRN",9.8,"NM","B","GMTSROE",3)

"BLD",4863,"KRN",9.8,"NM","B","GMTSRON",2)

"BLD",4863,"KRN",19,0)
19
"BLD",4863,"KRN",19.1,0)
19.1
"BLD",4863,"KRN",101,0)
101
"BLD",4863,"KRN",409.61,0)
409.61
"BLD",4863,"KRN",771,0)
771
"BLD",4863,"KRN",870,0)
870
"BLD",4863,"KRN",8989.51,0)
8989.51
"BLD",4863,"KRN",8989.52,0)
8989.52
"BLD",4863,"KRN",8994,0)
8994
"BLD",4863,"KRN","B",.4,.4)

"BLD",4863,"KRN","B",.401,.401)

"BLD",4863,"KRN","B",.402,.402)

"BLD",4863,"KRN","B",.403,.403)

"BLD",4863,"KRN","B",.5,.5)

"BLD",4863,"KRN","B",.84,.84)

"BLD",4863,"KRN","B",3.6,3.6)

"BLD",4863,"KRN","B",3.8,3.8)

"BLD",4863,"KRN","B",9.2,9.2)

"BLD",4863,"KRN","B",9.8,9.8)

"BLD",4863,"KRN","B",19,19)

"BLD",4863,"KRN","B",19.1,19.1)

"BLD",4863,"KRN","B",101,101)

"BLD",4863,"KRN","B",409.61,409.61)

"BLD",4863,"KRN","B",771,771)

"BLD",4863,"KRN","B",870,870)

"BLD",4863,"KRN","B",8989.51,8989.51)

"BLD",4863,"KRN","B",8989.52,8989.52)

"BLD",4863,"KRN","B",8994,8994)

"BLD",4863,"QUES",0)
^9.62^^
"BLD",4863,"REQB",0)
^9.611^2^2
"BLD",4863,"REQB",1,0)
GMTS*2.7*28^2
"BLD",4863,"REQB",2,0)
GMTS*2.7*37^2
"BLD",4863,"REQB","B","GMTS*2.7*28",1)

"BLD",4863,"REQB","B","GMTS*2.7*37",2)

"MBREQ")
0
"PKG",56,-1)
1^1
"PKG",56,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",56,22,0)
^9.49I^1^1
"PKG",56,22,1,0)
2.7^2951020^2960605
"PKG",56,22,1,"PAH",1,0)
57^3040803^222222269
"PKG",56,22,1,"PAH",1,1,0)
^^2^2^3040803
"PKG",56,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",56,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*57.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMTSRO")
0^4^B37259437
"RTN","GMTSRO",1,0)
GMTSRO ; SLC/JER,KER - All Surgery Reports ; 06/24/2002 [8/3/04 2:10pm]
"RTN","GMTSRO",2,0)
 ;;2.7;Health Summary;**9,11,28,37,57**;Oct 20, 1995
"RTN","GMTSRO",3,0)
 ;
"RTN","GMTSRO",4,0)
 ; External References
"RTN","GMTSRO",5,0)
 ;   DBIA  3590  HS^SROGMTS
"RTN","GMTSRO",6,0)
 ;                     
"RTN","GMTSRO",7,0)
ENSRO ; Entry Point for Surgery Only Component
"RTN","GMTSRO",8,0)
 S GMTSSO=1
"RTN","GMTSRO",9,0)
 ;                               
"RTN","GMTSRO",10,0)
ENSR ; Entry Point for SURGERY REPORT component
"RTN","GMTSRO",11,0)
 ; (includes NON-OR procedures)
"RTN","GMTSRO",12,0)
 N GMTSMX,GMCOUNT,GMIDT,GMN,SURG,GMTSGL S GMTSGL=$$GL^GMTSROE Q:'$L(GMTSGL)  Q:'$D(@(GMTSGL_"""B"","_DFN_")"))
"RTN","GMTSRO",13,0)
 S GMTSMX=999 I $D(GMTSNDM),(GMTSNDM>0) S GMTSMX=GMTSNDM
"RTN","GMTSRO",14,0)
 S GMN=0 F  S GMN=$O(@(GMTSGL_"""B"","_DFN_","_GMN_")")) Q:GMN'>0  D SORT
"RTN","GMTSRO",15,0)
 Q:'$D(SURG)  S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<GMTSMX)  S GMN=SURG(GMIDT) D WRT Q:$D(GMTSQIT)
"RTN","GMTSRO",16,0)
 K GMTSSO Q
"RTN","GMTSRO",17,0)
 ;                     
"RTN","GMTSRO",18,0)
SORT ; Sort Surgeries by Inverse Date
"RTN","GMTSRO",19,0)
 N GMDT S GMDT=$P($G(@(GMTSGL_GMN_",0)")),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSRO",20,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSRO",21,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSRO",22,0)
 Q
"RTN","GMTSRO",23,0)
 ;                               
"RTN","GMTSRO",24,0)
WRT ; Write Surgical Case Record
"RTN","GMTSRO",25,0)
 N REC,X,GMI,GMJ,GMDT,GMTSTR
"RTN","GMTSRO",26,0)
 D:+($$PROK^GMTSU("SROGMTS",100))>0 HS^SROGMTS(GMN)
"RTN","GMTSRO",27,0)
 D:+($$PROK^GMTSU("SROGMTS",100))'>0 ONE^GMTSROE(GMN)
"RTN","GMTSRO",28,0)
NONOP ;   Non-Op Procedure
"RTN","GMTSRO",29,0)
 ;     Quit if Surgery Only
"RTN","GMTSRO",30,0)
 Q:$G(REC(130,GMN,118,"I"))="Y"&(+($G(GMTSSO))>0)
"RTN","GMTSRO",31,0)
 ;     Print if SR*3*100
"RTN","GMTSRO",32,0)
 ;G:+($$PROK^GMTSU("SROGMTS",100))>0 OPER
"RTN","GMTSRO",33,0)
 I $G(REC(130,GMN,118,"I"))'="Y" G OPER
"RTN","GMTSRO",34,0)
 ;     Print if NOT SR*3*100
"RTN","GMTSRO",35,0)
 I $G(REC(130,GMN,118,"I"))="Y" Q:$G(GMTSSO)  D WRT^GMTSRON Q
"RTN","GMTSRO",36,0)
 S GMCOUNT=GMCOUNT+1
"RTN","GMTSRO",37,0)
OPER ;   Operative Procedure
"RTN","GMTSRO",38,0)
SS ;     Date/Specialty/Surgeon
"RTN","GMTSRO",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRO",40,0)
 S GMDT=$G(REC(130,GMN,.09,"S")) S:'$L(GMDT) GMDT=$$ED^GMTSU($G(REC(130,GMN,.09,"I")))
"RTN","GMTSRO",41,0)
 S GMTSTR=$G(REC(130,GMN,.04,"S")) S:$L($G(GMTSTR))>25 GMTSTR=$$WRAP^GMTSORC(GMTSTR,25)
"RTN","GMTSRO",42,0)
 W $G(GMDT),?21,$P($G(GMTSTR),"|"),?47,"Surgeon:",?56,$G(REC(130,GMN,.14,"E")),!
"RTN","GMTSRO",43,0)
 F GMI=2:1:$L($G(GMTSTR),"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P($G(GMTSTR),"|",GMI),!
"RTN","GMTSRO",44,0)
SPA ;     Status/Principal Anesthetist
"RTN","GMTSRO",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRO",46,0)
 W ?13,"Status:",?21,$G(REC(130,GMN,"STATUS"))
"RTN","GMTSRO",47,0)
 W ?44,"Prin Anest:",?56,$G(REC(130,GMN,.31,"E")),!
"RTN","GMTSRO",48,0)
PREDX ;     Principal Pre-Op Diagnosis
"RTN","GMTSRO",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Pre-op Diag(s):"
"RTN","GMTSRO",50,0)
 S GMTSTR=$G(REC(130,GMN,32,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,32,"E"))
"RTN","GMTSRO",51,0)
 S:$L(GMTSTR)&($L($G(REC(130,GMN,"VERIFIED")))) GMTSTR=GMTSTR_" "_$G(REC(130,GMN,"VERIFIED")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",52,0)
 F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",53,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ) W !
"RTN","GMTSRO",54,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",55,0)
OPREDX ;       Other Pre-Op Diagnosis
"RTN","GMTSRO",56,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.17,GMI)) Q:GMI'>0  D
"RTN","GMTSRO",57,0)
 . S GMTSTR=$G(REC(130,GMN,130.17,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.17,GMI,.01,"E"))
"RTN","GMTSRO",58,0)
 . S:$L(GMTSTR)&($L($G(REC(130,GMN,"VERIFIED")))) GMTSTR=GMTSTR_" "_$G(REC(130,GMN,"VERIFIED")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",59,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",60,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ) W !
"RTN","GMTSRO",61,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",62,0)
PSTDX ;     Post-Op Diagnosis
"RTN","GMTSRO",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Post-op Diag(s):"
"RTN","GMTSRO",64,0)
 S GMTSTR=$G(REC(130,GMN,34,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,34,"E")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",65,0)
 F GMJ=1:1:$L(GMTSTR,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ) W:GMJ=1&(GMTSTR?1.A.E) " ",$G(REC(130,GMN,"VERIFIED")) W !
"RTN","GMTSRO",66,0)
OPSTDX ;       Other Post-Op Diagnosis
"RTN","GMTSRO",67,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.18,GMI)) Q:GMI'>0  D
"RTN","GMTSRO",68,0)
 . S GMTSTR=$G(REC(130,GMN,130.18,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.18,GMI,.01,"E")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",69,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ) W:GMJ=1&(GMTSTR?1.A.E) " ",$G(REC(130,GMN,"VERIFIED")) W !
"RTN","GMTSRO",70,0)
OP ;     Operative Procedures
"RTN","GMTSRO",71,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Operative Proc(s):" S GMTSTR=$G(REC(130,GMN,26,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,26,"E")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",72,0)
 F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRO",74,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",75,0)
OPM ;       Operative Procedures (Modifiers)
"RTN","GMTSRO",76,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.028,GMI)) Q:GMI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRO",77,0)
 . S GMTSTR=$G(REC(130,GMN,130.028,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.028,GMI,.01,"E")) S:$L(GMTSTR)>54 GMTSTR=$$WRAP^GMTSORC(GMTSTR,54)
"RTN","GMTSRO",78,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",79,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:25,1:26),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRO",80,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",81,0)
OOP ;     Other Procedures
"RTN","GMTSRO",82,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.16,GMI)) Q:GMI'>0  D
"RTN","GMTSRO",83,0)
 . S GMTSTR=$G(REC(130,GMN,130.16,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.16,GMI,.01,"E")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRO",84,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",85,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRO",86,0)
 . . W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRO",87,0)
OOPM . ;       Other Operative Procedures (Modifiers)
"RTN","GMTSRO",88,0)
 . N GMM S GMM=0 F  S GMM=$O(REC(130,GMN,130.16,GMI,130.164,GMM)) Q:+GMM=0  D
"RTN","GMTSRO",89,0)
 . . S GMTSTR=$G(REC(130,GMN,130.16,GMI,130.164,GMM,.01,"S")) S:'$L(GMTSTR) GMTSTR=$G(REC(130,GMN,130.16,GMI,130.164,GMM,.01,"E")) S:$L(GMTSTR)>54 GMTSTR=$$WRAP^GMTSORC(GMTSTR,54)
"RTN","GMTSRO",90,0)
 . . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRO",91,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:25,1:26),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRO",92,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSRO",93,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",94,0)
LAB ;     Lab Work
"RTN","GMTSRO",95,0)
 I $L($G(REC(130,GMN,"LAB"))) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Lab Work: ",$G(REC(130,GMN,"LAB")),!
"RTN","GMTSRO",96,0)
RPTDT ;     Dates
"RTN","GMTSRO",97,0)
DICDT ;       Dictation Date
"RTN","GMTSRO",98,0)
 S GMTSTR=$G(REC(130,GMN,15,"S")) S:'$L(GMTSTR) GMTSTR=$G(REC(130,GMN,15,"E"))
"RTN","GMTSRO",99,0)
 I $L(GMTSTR) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Dictation Time:",?21,GMTSTR
"RTN","GMTSRO",100,0)
TRCDT ;       Transcription Time
"RTN","GMTSRO",101,0)
 S GMTSTR=$G(REC(130,GMN,39,"S")) S:'$L(GMTSTR) GMTSTR=$G(REC(130,GMN,39,"E"))
"RTN","GMTSRO",102,0)
 I $L(GMTSTR) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?41,"Transcription Time:",?61,GMTSTR
"RTN","GMTSRO",103,0)
 D:$L($G(REC(130,GMN,15,"I")))!($L($G(REC(130,GMN,39,"I")))) CKP^GMTSUP Q:$D(GMTSQIT)  W:$L($G(REC(130,GMN,15,"I")))!($L($G(REC(130,GMN,39,"I")))) !
"RTN","GMTSRO",104,0)
RPT ;     Dictation
"RTN","GMTSRO",105,0)
 S GMCOUNT=+($G(GMCOUNT))+1
"RTN","GMTSRO",106,0)
 I $O(REC(130,GMN,1.15,0))>0 D
"RTN","GMTSRO",107,0)
 . I +($$PROK^GMTSU("SROGMTS",100))=0 N GMI D CKP^GMTSUP Q:$D(GMTSQIT)  W "Surgeon's Dictation:",!
"RTN","GMTSRO",108,0)
 . S GMI=$S(+($$PROK^GMTSU("SROGMTS",100))=1:1,1:0) F  S GMI=$O(REC(130,GMN,1.15,GMI)) Q:+GMI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRO",109,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,$G(REC(130,GMN,1.15,GMI)),!
"RTN","GMTSRO",110,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRO",111,0)
 Q
"RTN","GMTSROB")
0^1^B7614557
"RTN","GMTSROB",1,0)
GMTSROB ; SLC/JER,KER - Surgery Reports Brief ; 06/24/2002
"RTN","GMTSROB",2,0)
 ;;2.7;Health Summary;**9,11,28,57**;Oct 20, 1995
"RTN","GMTSROB",3,0)
 ;
"RTN","GMTSROB",4,0)
 ; External References
"RTN","GMTSROB",5,0)
 ;   DBIA   2491  ^SRF("B")
"RTN","GMTSROB",6,0)
 ;   DBIA   2491  ^SRF(  file #130
"RTN","GMTSROB",7,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSROB",8,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #130)
"RTN","GMTSROB",9,0)
 ;
"RTN","GMTSROB",10,0)
ENSR ; Entry point for component
"RTN","GMTSROB",11,0)
 N MAX,GMCOUNT,GMIDT,GMN,SURG Q:'$D(^SRF("B",DFN))
"RTN","GMTSROB",12,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999)
"RTN","GMTSROB",13,0)
 S GMN=0 F  S GMN=$O(^SRF("B",DFN,GMN)) Q:GMN'>0  D SORT
"RTN","GMTSROB",14,0)
 I '$D(SURG) Q
"RTN","GMTSROB",15,0)
 S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<MAX)  S GMN=SURG(GMIDT) D WRT
"RTN","GMTSROB",16,0)
 Q
"RTN","GMTSROB",17,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSROB",18,0)
 N GMDT S GMDT=$$GET1^DIQ(130,(+(GMN)_","),.09,"I")
"RTN","GMTSROB",19,0)
 I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSROB",20,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSROB",21,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSROB",22,0)
 Q
"RTN","GMTSROB",23,0)
WRT ; Write surgical case record
"RTN","GMTSROB",24,0)
 N X,GMI,GMDT,STATUS K ^UTILITY($J,"W")
"RTN","GMTSROB",25,0)
 S GMCOUNT=GMCOUNT+1
"RTN","GMTSROB",26,0)
 ;   Date of Operation
"RTN","GMTSROB",27,0)
 S X=$$GET1^DIQ(130,(+(GMN)_","),.09,"I") D REGDT4^GMTSU S GMDT=X
"RTN","GMTSROB",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMDT
"RTN","GMTSROB",29,0)
 D STATUS S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","GMTSROB",30,0)
 ;   Principle Procedure
"RTN","GMTSROB",31,0)
 S X=$$GET1^DIQ(130,(+(GMN)_","),26,"I") D FORMAT
"RTN","GMTSROB",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$D(^UTILITY($J,"W",1,1,0)) ?21,^(0) W ?61,STATUS,!
"RTN","GMTSROB",33,0)
 S GMI=1 F  S GMI=$O(^UTILITY($J,"W",1,GMI)) Q:GMI'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,^UTILITY($J,"W",1,GMI,0),!
"RTN","GMTSROB",34,0)
 K ^UTILITY($J,"W")
"RTN","GMTSROB",35,0)
 ;   Other Procedures
"RTN","GMTSROB",36,0)
 S GMI=0 F  S GMI=$O(^SRF(GMN,13,GMI)) Q:GMI'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  D 
"RTN","GMTSROB",37,0)
 . S X(GMI)=$$GET1^DIQ(130.16,(+GMI_","_+(GMN)_","),.01,"I")
"RTN","GMTSROB",38,0)
 . W ?21,X(GMI),!
"RTN","GMTSROB",39,0)
 Q
"RTN","GMTSROB",40,0)
STATUS ; case status
"RTN","GMTSROB",41,0)
 I $$GET1^DIQ(130,(+(GMN)_","),118,"I")="Y" D NONORST Q
"RTN","GMTSROB",42,0)
 I $D(^SRF(GMN,30)) S STATUS=$S(+($$GET1^DIQ(130,(+(GMN)_","),.205,"I")):"(ABORTED)",1:"CANCELLED") Q
"RTN","GMTSROB",43,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),.23,"I")) S STATUS="(COMPLETED)" Q
"RTN","GMTSROB",44,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),.22,"I")),'+($$GET1^DIQ(130,(+(GMN)_","),.23,"I")) S STATUS="INCOMPLETE" Q
"RTN","GMTSROB",45,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),10,"I")) S STATUS="SCHEDULED" Q
"RTN","GMTSROB",46,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),36,"I")),'+($$GET1^DIQ(130,(+(GMN)_","),.22,"I")) S STATUS="REQUESTED"
"RTN","GMTSROB",47,0)
 Q
"RTN","GMTSROB",48,0)
FORMAT ; format surgery name
"RTN","GMTSROB",49,0)
 N DIWF,DIWL,DIWR
"RTN","GMTSROB",50,0)
 S DIWF="C35R",DIWL=1,DIWR=36 D ^DIWP
"RTN","GMTSROB",51,0)
 Q
"RTN","GMTSROB",52,0)
NONORST ;Obtains status for NON-OR procedures.
"RTN","GMTSROB",53,0)
 S STATUS="UNKNOWN"
"RTN","GMTSROB",54,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),122,"I")) S STATUS="(COMPLETED)" Q
"RTN","GMTSROB",55,0)
 I +($$GET1^DIQ(130,(+(GMN)_","),121,"I")),'+($$GET1^DIQ(130,(+(GMN)_","),122,"I")) S STATUS="INCOMPLETE" Q
"RTN","GMTSROB",56,0)
 Q
"RTN","GMTSROE")
0^3^B54429367
"RTN","GMTSROE",1,0)
GMTSROE ; SLC/KER - Surgery Extract                   ; 06/24/2002
"RTN","GMTSROE",2,0)
 ;;2.7;Health Summary;**37,57**;Oct 20, 1995
"RTN","GMTSROE",3,0)
 ;
"RTN","GMTSROE",4,0)
 ; External References
"RTN","GMTSROE",5,0)
 ;   DBIA   2491  ^SRF(  file #130
"RTN","GMTSROE",6,0)
 ;   DBIA  10103  $$HTFM^XLFDT
"RTN","GMTSROE",7,0)
 ;   DBIA  10015  EN^DIQ1
"RTN","GMTSROE",8,0)
 ;   DBIA   1996  $$CPT^ICPTCOD
"RTN","GMTSROE",9,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSROE",10,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #81.3)
"RTN","GMTSROE",11,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #81)
"RTN","GMTSROE",12,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #130)
"RTN","GMTSROE",13,0)
 ;   DBIA   2052  FILE^DID
"RTN","GMTSROE",14,0)
 ;                  
"RTN","GMTSROE",15,0)
 Q
"RTN","GMTSROE",16,0)
ONE(X) ; Extract One Surgery Report
"RTN","GMTSROE",17,0)
 K REC N GMTSCPTM,GMSG,DA,DR,DIC,DIQ,IEN,IENS,FILE,FLD,FLDS,FLDI
"RTN","GMTSROE",18,0)
 N FLDA,FLDB,FLDR,FLDRT,IEN,GMTSI,GMTSRT,GMTST,GMTSS,GMTSC,GMTSCS
"RTN","GMTSROE",19,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSROE",20,0)
 Q:'$D(^SRF(X,0))  S (IENS,IEN,X)=+($G(X)),U="^"
"RTN","GMTSROE",21,0)
 S:'$D(DT) DT=$$HTFM^XLFDT($H,1) S:'$D(DTIME) DTIME=300
"RTN","GMTSROE",22,0)
 S (FILE,DIC)=130,DA=+($G(X)),DIQ="REC(",DIQ(0)="IE"
"RTN","GMTSROE",23,0)
 S GMSG=$$SG(IEN),REC(130,IEN,118,"E")=$S(GMSG=0:"YES",1:""),REC(130,IEN,118,"I")=$S(GMSG=0:"Y",1:"")
"RTN","GMTSROE",24,0)
 S:+GMSG DR=".09;.04;.14;.205;.22;.23;.31;1.15;10;15;17;26;27;32;34;36;39;43;49"
"RTN","GMTSROE",25,0)
 S:'GMSG DR=".09;.31;26;27;33;55;59;66;1.15;121;122;123;124;125"
"RTN","GMTSROE",26,0)
 D EN^DIQ1 S REC(130,IEN,"STATUS")=$$OS(IEN) S:+GMSG REC(130,IEN,"VERIFIED")=$S($G(REC(130,IEN,43,"I"))'="Y":"(Unverified)",1:"")
"RTN","GMTSROE",27,0)
 S GMTSM=$G(REC(130,IEN,27,"I")) I GMTSM>0 D
"RTN","GMTSROE",28,0)
 . S GMTSC=$$CPT^ICPTCOD(GMTSM),(GMTSCS,GMTSS)=$$EN2^GMTSUMX($P(GMTSC,"^",3))
"RTN","GMTSROE",29,0)
 . S REC(130,IEN,27,"X")=$P(GMTSC,"^",2)_"^"_$P(GMTSC,"^",3)
"RTN","GMTSROE",30,0)
 . S GMTSC=$P(GMTSC,"^",2),GMTST=$$EN2^GMTSUMX($G(REC(130,IEN,26,"E")))
"RTN","GMTSROE",31,0)
 . S:$L(GMTSS)&(GMTSS'=GMTST) GMTST=GMTST_" - "_GMTSS
"RTN","GMTSROE",32,0)
 . S:$L(GMTSC)=5 GMTST=GMTST_" (CPT "_GMTSC_")",GMTSCS=GMTSCS_" (CPT "_GMTSC_")"
"RTN","GMTSROE",33,0)
 . S REC(130,IEN,27,"N")=GMTSS
"RTN","GMTSROE",34,0)
 . S (REC(130,IEN,26,"S"),REC(130,IEN,27,"S"))=GMTST
"RTN","GMTSROE",35,0)
 . S REC(130,IEN,27,"S")=GMTSCS
"RTN","GMTSROE",36,0)
 D SUB
"RTN","GMTSROE",37,0)
 S:$D(REC(130,IEN,32)) REC(130,IEN,32,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,32,"E")))
"RTN","GMTSROE",38,0)
 S:$D(REC(130,IEN,33)) REC(130,IEN,33,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,33,"E")))
"RTN","GMTSROE",39,0)
 S:$D(REC(130,IEN,34)) REC(130,IEN,34,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,34,"E")))
"RTN","GMTSROE",40,0)
 S:$D(REC(130,IEN,.04)) REC(130,IEN,.04,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,.04,"E")))
"RTN","GMTSROE",41,0)
 S:$D(REC(130,IEN,125)) REC(130,IEN,125,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,125,"E")))
"RTN","GMTSROE",42,0)
 I $L($G(REC(130,IEN,33,"S"))) D
"RTN","GMTSROE",43,0)
 . S:'$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (Unknown)"
"RTN","GMTSROE",44,0)
 . S:$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (ICD "_$G(REC(130,IEN,66,"E"))_")"
"RTN","GMTSROE",45,0)
 S:+($G(REC(130,IEN,.09,"I")))>0 REC(130,IEN,.09,"S")=$$ED^GMTSU($G(REC(130,IEN,.09,"I")))
"RTN","GMTSROE",46,0)
 S:+($G(REC(130,IEN,15,"I")))>0 REC(130,IEN,15,"S")=$$EDT^GMTSU($G(REC(130,IEN,15,"I")))
"RTN","GMTSROE",47,0)
 S:+($G(REC(130,IEN,39,"I"))) REC(130,IEN,39,"S")=$$EDT^GMTSU($G(REC(130,IEN,39,"I")))
"RTN","GMTSROE",48,0)
 S:+GMSG REC(130,IEN,"LAB")=$S($O(REC(130,IEN,49,0))>0:"Yes",1:"")
"RTN","GMTSROE",49,0)
 I 'GMSG D:+($O(REC(130,IEN,55,0)))>0 WP(IEN,55,58) D:+($O(REC(130,IEN,59,0)))>0 WP(IEN,59,58)
"RTN","GMTSROE",50,0)
 Q
"RTN","GMTSROE",51,0)
WP(X,Y,Z) ; Word Processing
"RTN","GMTSROE",52,0)
 N GMTSI,GMTSF,GMTSW,GMI,DIWF,DIWL,DIWR
"RTN","GMTSROE",53,0)
 S GMTSI=+($G(X)) Q:GMTSI=0!('$D(REC(130,GMTSI)))
"RTN","GMTSROE",54,0)
 S GMTSF=+($G(Y)) Q:GMTSF=0!('$D(REC(130,GMTSI,GMTSF)))
"RTN","GMTSROE",55,0)
 S GMTSW=+($G(Z)) Q:GMTSW'>0!(GMTSW>79)
"RTN","GMTSROE",56,0)
 Q:+($O(REC(130,GMTSI,GMTSF,0)))'>0
"RTN","GMTSROE",57,0)
 K ^UTILITY($J,"W") S DIWF="C"_GMTSW,DIWL=0,DIWR=0,GMI=0
"RTN","GMTSROE",58,0)
 F  S GMI=$O(REC(130,GMTSI,GMTSF,GMI)) Q:+GMI=0  D
"RTN","GMTSROE",59,0)
 . S X=$G(REC(130,GMTSI,GMTSF,GMI)) D ^DIWP
"RTN","GMTSROE",60,0)
 S GMI=0 F  S GMI=$O(^UTILITY($J,"W",0,GMI)) Q:+GMI=0  D
"RTN","GMTSROE",61,0)
 . S REC(130,GMTSI,GMTSF,"S",GMI)=$G(^UTILITY($J,"W",0,GMI,0))
"RTN","GMTSROE",62,0)
 . S REC(130,GMTSI,GMTSF,"S",0)=$G(REC(130,GMTSI,GMTSF,"S",0))+1
"RTN","GMTSROE",63,0)
 K ^UTILITY($J,"W")
"RTN","GMTSROE",64,0)
 Q
"RTN","GMTSROE",65,0)
OS(X) ; Obtains status for OR procedures
"RTN","GMTSROE",66,0)
 N GMN S GMN=+($G(X)) S X="" I $G(REC(130,GMN,118,"I"))="Y" D  Q X
"RTN","GMTSROE",67,0)
 . S:+($G(REC(130,GMN,122,"I")))>0 X="(Completed)"
"RTN","GMTSROE",68,0)
 . S:+($G(REC(130,GMN,121,"I")))>0&(+($G(REC(130,GMN,122,"I")))'>0) X="Incomplete"
"RTN","GMTSROE",69,0)
 . S:X="" X="Unknown"
"RTN","GMTSROE",70,0)
 I +($G(REC(130,GMN,17,"I")))>0 D  Q X
"RTN","GMTSROE",71,0)
 . S X=$S(+($G(REC(130,GMN,.205,"I")))>0:"(Aborted)",1:"Cancelled")
"RTN","GMTSROE",72,0)
 I +($G(REC(130,GMN,.23,"I")))>0 S X="(Completed)" Q X
"RTN","GMTSROE",73,0)
 I +($G(REC(130,GMN,.22,"I")))>0 S X="Incomplete" Q X
"RTN","GMTSROE",74,0)
 I +($G(REC(130,GMN,10,"I")))>0 S X="Scheduled" Q X
"RTN","GMTSROE",75,0)
 I +($G(REC(130,GMN,36,"I")))>0,+($G(REC(130,GMN,.22,"I")))'>0 S X="Requested" Q X
"RTN","GMTSROE",76,0)
 S X="Unknown"
"RTN","GMTSROE",77,0)
 Q X
"RTN","GMTSROE",78,0)
SUB ; Surgery Subfiles 
"RTN","GMTSROE",79,0)
 N DA,DR,DIC,DIQ,IENS,FILE,FLD,FLDS,FLDI,FLDA,FLDB,FLDR,FLDRT,GMTSM,GMTSC,GMTSI,GMTSJ,STXT,SNAM,SCOD,SUB
"RTN","GMTSROE",80,0)
 I +GMSG D
"RTN","GMTSROE",81,0)
 . ; ^SRF(DO,14,I)                .72
"RTN","GMTSROE",82,0)
 . ;   Other Preop Diagnosis      14;0  130.17
"RTN","GMTSROE",83,0)
 . ; $P(^SRF(DO,14,I,0),U)        .01
"RTN","GMTSROE",84,0)
 . ;   Other Preop Diagnosis       0;1  Text
"RTN","GMTSROE",85,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.17,DR=.72,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",86,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),14,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",87,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",88,0)
 . . S REC(130,IEN,130.17,GMTSI,.01,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,130.17,GMTSI,.01,"E")))
"RTN","GMTSROE",89,0)
 . ; ^SRF(DO,15,I)                .74
"RTN","GMTSROE",90,0)
 . ;   Other Postop Diagnosis     15;0  130.18
"RTN","GMTSROE",91,0)
 . ; $P(^SRF(DO,15,I,0),U)        .01
"RTN","GMTSROE",92,0)
 . ;   Other Postop Diagnosis      0;1  Text
"RTN","GMTSROE",93,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.18,DR=.74,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",94,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),15,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",95,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",96,0)
 . . S REC(130,IEN,130.18,GMTSI,.01,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,130.18,GMTSI,.01,"E")))
"RTN","GMTSROE",97,0)
 ; ^SRF(GMN,"OPMOD",I)           28
"RTN","GMTSROE",98,0)
 ;   Primary Proc CPT Mod   OPMOD;0  130.028
"RTN","GMTSROE",99,0)
 ; $P(^SRF(GMN,"OPMOD",I,0),U)  .01
"RTN","GMTSROE",100,0)
 ;   Primary Proc CPT Mod       0;1  Ptr 81.3
"RTN","GMTSROE",101,0)
 I GMTSCPTM D
"RTN","GMTSROE",102,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.028,DR=28,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",103,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),"OPMOD",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",104,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",105,0)
 . . S GMTSM=+($G(REC(130,+($G(IEN)),SUB,+($G(GMTSI)),.01,"I")))
"RTN","GMTSROE",106,0)
 . . I GMTSM>0 D
"RTN","GMTSROE",107,0)
 . . . S GMTSC=$$GET1^DIQ(81.3,+GMTSM,.01,"E")
"RTN","GMTSROE",108,0)
 . . . S GMTSS=$$GET1^DIQ(81.3,+GMTSM,.02,"E")
"RTN","GMTSROE",109,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"MID")=GMTSC
"RTN","GMTSROE",110,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"MOD")=GMTSS
"RTN","GMTSROE",111,0)
 . . . S GMTST=$$EN2^GMTSUMX(GMTSS)
"RTN","GMTSROE",112,0)
 . . . S:$L(GMTSC) GMTST=GMTST_" (CPT Mod "_GMTSC_")"
"RTN","GMTSROE",113,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"S")=GMTST
"RTN","GMTSROE",114,0)
 ; ^SRF(DO,13,I)                .42
"RTN","GMTSROE",115,0)
 ;   Other Proc                13;0  130.16
"RTN","GMTSROE",116,0)
 ; $P(^SRF(DO,13,I,0),U)        .01
"RTN","GMTSROE",117,0)
 ;   Other Proc                 0;1  Text      
"RTN","GMTSROE",118,0)
 ; $P(^SRF(DO,13,I,2),U)          3
"RTN","GMTSROE",119,0)
 ;   Other Proc CPT Code        2;1  Ptr 81
"RTN","GMTSROE",120,0)
 S DA=IEN,(FILE,DIC)=130,SUB=130.16,DR=.42,DR(SUB)=".01;3",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",121,0)
 K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),13,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",122,0)
 . S DA(SUB)=GMTSI
"RTN","GMTSROE",123,0)
 . D EN^DIQ1 S GMTSM=+($G(REC(130,IEN,130.16,GMTSI,3,"I")))
"RTN","GMTSROE",124,0)
 . S:GMTSM>0 REC(130,IEN,130.16,GMTSI,3,"N")=$$GET1^DIQ(81,+GMTSM,2,"E")
"RTN","GMTSROE",125,0)
 . N GMTST,GMTSS,GMTSC S GMTSM=$G(REC(130,IEN,130.16,GMTSI,3,"I")) I GMTSM>0 D
"RTN","GMTSROE",126,0)
 . . S GMTSC=$$CPT^ICPTCOD(GMTSM),(GMTSCS,GMTSS)=$$EN2^GMTSUMX($P(GMTSC,"^",3))
"RTN","GMTSROE",127,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"X")=$P(GMTSC,"^",2)_"^"_$P(GMTSC,"^",3)
"RTN","GMTSROE",128,0)
 . . S GMTSC=$P(GMTSC,"^",2)
"RTN","GMTSROE",129,0)
 . . S GMTST=$$EN2^GMTSUMX($G(REC(130,IEN,130.16,GMTSI,.01,"E")))
"RTN","GMTSROE",130,0)
 . . S:$L(GMTSS)&(GMTSS'=GMTST) GMTST=GMTST_" - "_$$EN2^GMTSUMX(GMTSS)
"RTN","GMTSROE",131,0)
 . . S:$L(GMTSC)=5 GMTST=GMTST_" (CPT "_GMTSC_")",GMTSCS=GMTSCS_" (CPT "_GMTSC_")"
"RTN","GMTSROE",132,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"N")=GMTSS
"RTN","GMTSROE",133,0)
 . . S REC(130,IEN,130.16,GMTSI,.01,"S")=GMTST
"RTN","GMTSROE",134,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"S")=GMTSCS
"RTN","GMTSROE",135,0)
 . ;     ^SRF(8,13,2,"MOD",0)       4
"RTN","GMTSROE",136,0)
 . ;       Oth Proc CPT Mod     MOD;0  130.164
"RTN","GMTSROE",137,0)
 . ;     ^SRF(8,13,2,"MOD",1,0)   .01
"RTN","GMTSROE",138,0)
 . ;       Oth Proc CPT Mod       0;1  Ptr 81.3
"RTN","GMTSROE",139,0)
 . I GMTSCPTM D
"RTN","GMTSROE",140,0)
 . . N GMTSJ S GMTSJ=0 F  S GMTSJ=$O(^SRF(+($G(IEN)),13,GMTSI,"MOD",GMTSJ)) Q:+GMTSJ=0  D
"RTN","GMTSROE",141,0)
 . . . N DA,FILE,DIC,SUB,DR,DIQ S DA=IEN,DR=.42,FILE=130,SUB=130.16,DR(SUB)="4",DA(SUB)=GMTSI,SUB=130.164,DR(SUB)=".01",DA(SUB)=GMTSJ,DIC=130,DIQ="REC(130,"_IEN_",130.16,"_GMTSI_",",DIQ(0)="IE"
"RTN","GMTSROE",142,0)
 . . . D EN^DIQ1
"RTN","GMTSROE",143,0)
 . . . S GMTSM=+($G(REC(130,IEN,130.16,GMTSI,130.164,GMTSJ,.01,"I")))
"RTN","GMTSROE",144,0)
 . . . I GMTSM>0 D
"RTN","GMTSROE",145,0)
 . . . . S GMTSC=$$GET1^DIQ(81.3,+GMTSM,.01,"E")
"RTN","GMTSROE",146,0)
 . . . . S GMTSS=$$GET1^DIQ(81.3,+GMTSM,.02,"E")
"RTN","GMTSROE",147,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"MID")=GMTSC
"RTN","GMTSROE",148,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"MOD")=GMTSS
"RTN","GMTSROE",149,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"X")=GMTSC_"^"_GMTSS
"RTN","GMTSROE",150,0)
 . . . . S GMTST=$$EN2^GMTSUMX(GMTSS) S:$L(GMTSC) GMTST=GMTST_" (CPT Mod "_GMTSC_")"
"RTN","GMTSROE",151,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"S")=GMTST
"RTN","GMTSROE",152,0)
 . . . K REC(130,IEN,130.16,GMTSI,130)
"RTN","GMTSROE",153,0)
 Q
"RTN","GMTSROE",154,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSROE",155,0)
 N GMDT S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSROE",156,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSROE",157,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSROE",158,0)
 Q
"RTN","GMTSROE",159,0)
GL(X) ; Global Location
"RTN","GMTSROE",160,0)
 N FIL D FILE^DID(130,"N","GLOBAL NAME","FIL","FIL(""ERR"")") S X=$G(FIL("GLOBAL NAME"))
"RTN","GMTSROE",161,0)
 S:$E(X,1)'="^"!($E(X,2,$L(X))["^")!($L($E(X,2,$L(X)))<2)!($L($E(X,2,$L(X)))>8)!($E(X,2,$L(X))'["(") X=""
"RTN","GMTSROE",162,0)
 I $L(X) S:'$D(@($P(X,"(",1))) X=""
"RTN","GMTSROE",163,0)
 Q X
"RTN","GMTSROE",164,0)
SG(X) ; Surgical (Operative) Record
"RTN","GMTSROE",165,0)
 S X=$$GET1^DIQ(130,+($G(X)),118,"I") S X=$S(X["Y":0,1:1) Q X
"RTN","GMTSRON")
0^2^B24443367
"RTN","GMTSRON",1,0)
GMTSRON ; SLC/JER,KER - Surgery Reports ; 06/24/2002 [7/27/04 9:00am]
"RTN","GMTSRON",2,0)
 ;;2.7;Health Summary;**11,28,37,57**;Oct 20, 1995
"RTN","GMTSRON",3,0)
 ;
"RTN","GMTSRON",4,0)
 ; External References
"RTN","GMTSRON",5,0)
 ;   DBIA  3590  HS^SROGMTS
"RTN","GMTSRON",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file #130)
"RTN","GMTSRON",7,0)
 ;                     
"RTN","GMTSRON",8,0)
ENSR ; Entry point for component
"RTN","GMTSRON",9,0)
 N REC,GMTSMX,GMCOUNT,GMIDT,GMJ,GMN,SURG,GMTSGL
"RTN","GMTSRON",10,0)
 S GMTSGL=$$GL^GMTSROE Q:'$L(GMTSGL)  Q:'$D(@(GMTSGL_"""B"","_DFN_")"))
"RTN","GMTSRON",11,0)
 S GMTSMX=999 I $D(GMTSNDM),(GMTSNDM>0) S GMTSMX=GMTSNDM
"RTN","GMTSRON",12,0)
 S GMN=0 F  S GMN=$O(@(GMTSGL_"""B"","_DFN_","_GMN_")")) Q:GMN'>0  D SORT
"RTN","GMTSRON",13,0)
 Q:'$D(SURG)  S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<GMTSMX)  D
"RTN","GMTSRON",14,0)
 . S GMN=SURG(GMIDT) K REC I $$CHK D WRT
"RTN","GMTSRON",15,0)
 K REC
"RTN","GMTSRON",16,0)
 Q
"RTN","GMTSRON",17,0)
 ;                               
"RTN","GMTSRON",18,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSRON",19,0)
 N GMDT S GMDT=$P($G(@(GMTSGL_GMN_",0)")),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSRON",20,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSRON",21,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSRON",22,0)
 Q
"RTN","GMTSRON",23,0)
 ;                               
"RTN","GMTSRON",24,0)
WRT ; Write surgical case record
"RTN","GMTSRON",25,0)
 S GMN=+($G(GMN))
"RTN","GMTSRON",26,0)
 D:+($$PROK^GMTSU("SROGMTS",100))>0 HS^SROGMTS(GMN)
"RTN","GMTSRON",27,0)
 D:+($$PROK^GMTSU("SROGMTS",100))'>0 ONE^GMTSROE(GMN)
"RTN","GMTSRON",28,0)
 N X,Y,GMI,GMDT,GMTSTR
"RTN","GMTSRON",29,0)
 ;-------------------------------------------------------
"RTN","GMTSRON",30,0)
 Q:$G(REC(130,GMN,118,"I"))'="Y"  S GMCOUNT=GMCOUNT+1
"RTN","GMTSRON",31,0)
NONOR ; NON-OR information
"RTN","GMTSRON",32,0)
SP ;     Date/Specialty/Provider
"RTN","GMTSRON",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRON",34,0)
 S GMDT=$G(REC(130,GMN,.09,"S")) S:'$L(GMDT) GMDT=$$ED^GMTSU($G(REC(130,GMN,.09,"I")))
"RTN","GMTSRON",35,0)
 S GMTSTR=$G(REC(130,GMN,125,"S")) S:$L($G(GMTSTR))>25 GMTSTR=$$WRAP^GMTSORC(GMTSTR,25)
"RTN","GMTSRON",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRON",37,0)
 W GMDT,?21,$P($G(GMTSTR),"|"),?47,"Provider: ",?56,$G(REC(130,GMN,123,"E")),!
"RTN","GMTSRON",38,0)
 F GMI=2:1:$L($G(GMTSTR),"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P($G(GMTSTR),"|",GMI),!
"RTN","GMTSRON",39,0)
 ;
"RTN","GMTSRON",40,0)
SA ;     Status/Attending
"RTN","GMTSRON",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRON",42,0)
 W ?13,"Status:",?21,$G(REC(130,GMN,"STATUS"))
"RTN","GMTSRON",43,0)
 W ?46,"Attending: ",?56,$G(REC(130,GMN,124,"E")),!
"RTN","GMTSRON",44,0)
PA ;     Principal Anesthetist
"RTN","GMTSRON",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRON",46,0)
 W ?45,"Prin Anest: ",?56,$G(REC(130,GMN,.31,"E")),!
"RTN","GMTSRON",47,0)
PD ;     Principle Diagnosis
"RTN","GMTSRON",48,0)
 S GMTSTR=$G(REC(130,GMN,33,"S")) S:'$L(GMTSTR) GMTSTR=$G(REC(130,GMN,33,"E"))
"RTN","GMTSRON",49,0)
 S:$L($G(GMTSTR))>39 GMTSTR=$$WRAP^GMTSORC(GMTSTR,39)
"RTN","GMTSRON",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Princ Diag: ",$P($G(GMTSTR),"|"),!
"RTN","GMTSRON",51,0)
 F GMI=2:1:$L($G(GMTSTR),"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P($G(GMTSTR),"|",GMI),!
"RTN","GMTSRON",52,0)
PP ;     Principal Procedure
"RTN","GMTSRON",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Proc Performed: "
"RTN","GMTSRON",54,0)
 S GMTSTR=$G(REC(130,GMN,26,"S"))
"RTN","GMTSRON",55,0)
 S:GMTSTR="" GMTSTR=$G(REC(130,GMN,26,"E"))
"RTN","GMTSRON",56,0)
 S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRON",57,0)
 F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRON",58,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRON",59,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRON",60,0)
PPM ;     Principal Procedure (Modifiers)
"RTN","GMTSRON",61,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.028,GMI)) Q:GMI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRON",62,0)
 . S GMTSTR=$G(REC(130,GMN,130.028,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.028,GMI,.01,"E")) S:$L(GMTSTR)>54 GMTSTR=$$WRAP^GMTSORC(GMTSTR,54)
"RTN","GMTSRON",63,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRON",64,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:25,1:26),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRON",65,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRON",66,0)
OPP ;     Other Procedure Performed
"RTN","GMTSRON",67,0)
 S GMI=0 F  S GMI=$O(REC(130,GMN,130.16,GMI)) Q:GMI'>0  D
"RTN","GMTSRON",68,0)
 . S GMTSTR=$G(REC(130,GMN,130.16,GMI,.01,"S")) S:GMTSTR="" GMTSTR=$G(REC(130,GMN,130.16,GMI,.01,"E")) S:$L(GMTSTR)>58 GMTSTR=$$WRAP^GMTSORC(GMTSTR,58)
"RTN","GMTSRON",69,0)
 . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRON",70,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRON",71,0)
 . . W ?$S(GMJ=1:21,1:22),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRON",72,0)
OPPM . ;       Other Procedure Performed (Modifiers)
"RTN","GMTSRON",73,0)
 . N GMM S GMM=0
"RTN","GMTSRON",74,0)
 . F  S GMM=$O(REC(130,GMN,130.16,GMI,130.164,GMM)) Q:+GMM=0  D
"RTN","GMTSRON",75,0)
 . . S GMTSTR=$G(REC(130,GMN,130.16,GMI,130.164,GMM,.01,"S")) S:'$L(GMTSTR) GMTSTR=$G(REC(130,GMN,130.16,GMI,130.164,GMM,.01,"E")) S:$L(GMTSTR)>54 GMTSTR=$$WRAP^GMTSORC(GMTSTR,54)
"RTN","GMTSRON",76,0)
 . . F GMJ=1:1:$L(GMTSTR,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRON",77,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:25,1:26),$P(GMTSTR,"|",GMJ),!
"RTN","GMTSRON",78,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSRON",79,0)
 Q:$D(GMTSQIT)
"RTN","GMTSRON",80,0)
IND ;     Indications for Surgery
"RTN","GMTSRON",81,0)
 I $G(REC(130,GMN,55,"S",0))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSRON",82,0)
 . N GMI,GMC S (GMI,GMC)=0 F  S GMI=$O(REC(130,GMN,55,"S",GMI)) Q:+GMI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRON",83,0)
 . . S GMC=+GMC+1 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMC=1 "Indication for Proc:" W ?21,$G(REC(130,GMN,55,"S",GMI)),!
"RTN","GMTSRON",84,0)
FIND ;     Findings
"RTN","GMTSRON",85,0)
 I $G(REC(130,GMN,59,"S",0))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSRON",86,0)
 . N GMI,GMC S (GMI,GMC)=0 F  S GMI=$O(REC(130,GMN,59,"S",GMI)) Q:+GMI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRON",87,0)
 . . S GMC=+GMC+1 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMC=1 " Operative Findings:" W ?21,$G(REC(130,GMN,59,"S",GMI)),!
"RTN","GMTSRON",88,0)
DICT ;     Dictation
"RTN","GMTSRON",89,0)
 I $O(REC(130,GMN,1.15,0))>0 D
"RTN","GMTSRON",90,0)
 . N GMI D CKP^GMTSUP Q:$D(GMTSQIT)  W "Surgeon's Dictation:",!
"RTN","GMTSRON",91,0)
 . S GMI=0 F  S GMI=$O(REC(130,GMN,1.15,GMI)) Q:+GMI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRON",92,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,$G(REC(130,GMN,1.15,GMI)),!
"RTN","GMTSRON",93,0)
 Q
"RTN","GMTSRON",94,0)
 ;--------------------------------------------------------------------
"RTN","GMTSRON",95,0)
CHK() ; For selected procedures see if you have a match
"RTN","GMTSRON",96,0)
 N GMTSI,GMTSF,GMTSC
"RTN","GMTSRON",97,0)
 S GMTSC=$$GET1^DIQ(130,+($G(GMN)),27,"I") Q:'$D(GMTSEG(GMTSEGN,81)) 1
"RTN","GMTSRON",98,0)
 S GMTSF=0 F GMTSI=0:0 S GMTSI=$O(GMTSEG(GMTSEGN,81,GMTSI)) Q:'+GMTSI!GMTSF  S:GMTSEG(GMTSEGN,81,GMTSI)=GMTSC GMTSF=1 Q:GMTSF
"RTN","GMTSRON",99,0)
 Q GMTSF
"VER")
8.0^22.0
**END**
**END**
