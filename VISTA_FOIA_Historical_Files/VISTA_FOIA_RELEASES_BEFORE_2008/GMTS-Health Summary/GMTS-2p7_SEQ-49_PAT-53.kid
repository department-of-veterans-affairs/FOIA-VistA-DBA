Released GMTS*2.7*53 SEQ #49
Extracted from mail message
**KIDS**:GMTS*2.7*53^

**INSTALL NAME**
GMTS*2.7*53
"BLD",3596,0)
GMTS*2.7*53^HEALTH SUMMARY^0^3020423^y
"BLD",3596,1,0)
^^2^2^3020325^
"BLD",3596,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",3596,1,2,0)
patch GMTS*2.7*53.
"BLD",3596,4,0)
^9.64PA^^
"BLD",3596,"INID")
^y
"BLD",3596,"INIT")
POST^GMTSP53
"BLD",3596,"KRN",0)
^9.67PA^8989.52^19
"BLD",3596,"KRN",.4,0)
.4
"BLD",3596,"KRN",.401,0)
.401
"BLD",3596,"KRN",.402,0)
.402
"BLD",3596,"KRN",.403,0)
.403
"BLD",3596,"KRN",.5,0)
.5
"BLD",3596,"KRN",.84,0)
.84
"BLD",3596,"KRN",3.6,0)
3.6
"BLD",3596,"KRN",3.8,0)
3.8
"BLD",3596,"KRN",9.2,0)
9.2
"BLD",3596,"KRN",9.8,0)
9.8
"BLD",3596,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",3596,"KRN",9.8,"NM",1,0)
GMTSPN^^0^B63827853
"BLD",3596,"KRN",9.8,"NM",2,0)
GMTSPNB^^0^B7849781
"BLD",3596,"KRN",9.8,"NM",3,0)
GMTSDEMB^^0^B11930178
"BLD",3596,"KRN",9.8,"NM",4,0)
GMTSDEM^^0^B15688647
"BLD",3596,"KRN",9.8,"NM",5,0)
GMTSDVR^^0^B36427796
"BLD",3596,"KRN",9.8,"NM",6,0)
GMTSDEMP^^0^B20493198
"BLD",3596,"KRN",9.8,"NM",7,0)
GMTSPD^^0^B28728574
"BLD",3596,"KRN",9.8,"NM","B","GMTSDEM",4)

"BLD",3596,"KRN",9.8,"NM","B","GMTSDEMB",3)

"BLD",3596,"KRN",9.8,"NM","B","GMTSDEMP",6)

"BLD",3596,"KRN",9.8,"NM","B","GMTSDVR",5)

"BLD",3596,"KRN",9.8,"NM","B","GMTSPD",7)

"BLD",3596,"KRN",9.8,"NM","B","GMTSPN",1)

"BLD",3596,"KRN",9.8,"NM","B","GMTSPNB",2)

"BLD",3596,"KRN",19,0)
19
"BLD",3596,"KRN",19.1,0)
19.1
"BLD",3596,"KRN",101,0)
101
"BLD",3596,"KRN",409.61,0)
409.61
"BLD",3596,"KRN",771,0)
771
"BLD",3596,"KRN",870,0)
870
"BLD",3596,"KRN",8989.51,0)
8989.51
"BLD",3596,"KRN",8989.52,0)
8989.52
"BLD",3596,"KRN",8994,0)
8994
"BLD",3596,"KRN","B",.4,.4)

"BLD",3596,"KRN","B",.401,.401)

"BLD",3596,"KRN","B",.402,.402)

"BLD",3596,"KRN","B",.403,.403)

"BLD",3596,"KRN","B",.5,.5)

"BLD",3596,"KRN","B",.84,.84)

"BLD",3596,"KRN","B",3.6,3.6)

"BLD",3596,"KRN","B",3.8,3.8)

"BLD",3596,"KRN","B",9.2,9.2)

"BLD",3596,"KRN","B",9.8,9.8)

"BLD",3596,"KRN","B",19,19)

"BLD",3596,"KRN","B",19.1,19.1)

"BLD",3596,"KRN","B",101,101)

"BLD",3596,"KRN","B",409.61,409.61)

"BLD",3596,"KRN","B",771,771)

"BLD",3596,"KRN","B",870,870)

"BLD",3596,"KRN","B",8989.51,8989.51)

"BLD",3596,"KRN","B",8989.52,8989.52)

"BLD",3596,"KRN","B",8994,8994)

"BLD",3596,"QUES",0)
^9.62^^
"BLD",3596,"REQB",0)
^9.611^1^1
"BLD",3596,"REQB",1,0)
GMTS*2.7*49^2
"BLD",3596,"REQB","B","GMTS*2.7*49",1)

"INIT")
POST^GMTSP53
"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
53^3020423
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3020423
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*53.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","GMTSDEM")
0^4^B15688647
"RTN","GMTSDEM",1,0)
GMTSDEM ; SLC/DLT,KER - Demographics ; 04/04/2002
"RTN","GMTSDEM",2,0)
 ;;2.7;Health Summary;**28,49,53**;Oct 20, 1995
"RTN","GMTSDEM",3,0)
 ;                 
"RTN","GMTSDEM",4,0)
 ; External References
"RTN","GMTSDEM",5,0)
 ;   DBIA 10061  6^VADPT
"RTN","GMTSDEM",6,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM",7,0)
 ;   DBIA 10061  OPD^VADPT
"RTN","GMTSDEM",8,0)
 ;   DBIA 10061  SVC^VADPT
"RTN","GMTSDEM",9,0)
 ;   DBIA  2967  ^DIC(31,
"RTN","GMTSDEM",10,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEM",11,0)
 ;                     
"RTN","GMTSDEM",12,0)
DEMOG ; Demographic (VADPT)
"RTN","GMTSDEM",13,0)
 D 6^VADPT,SVC^VADPT,OAD^VADPT,OPD^VADPT
"RTN","GMTSDEM",14,0)
 D PRT D:$D(GMTSQIT) END Q:$D(GMTSQIT)
"RTN","GMTSDEM",15,0)
 D CD^GMTSDEMP(+($G(DFN))) D:$D(GMTSQIT) END Q:$D(GMTSQIT)
"RTN","GMTSDEM",16,0)
 D TF^GMTSDEMB(+($G(DFN))),END
"RTN","GMTSDEM",17,0)
 Q
"RTN","GMTSDEM",18,0)
PRT ; Print Demographic Data
"RTN","GMTSDEM",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEM",20,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEM",21,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEM",22,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", " W:VAPA(5)'="" $P(VAPA(5),"^",2),"  " W:VAPA(6)'="" VAPA(6) W:VAPA(7)'="" ?52," County:",?61,$P(VAPA(7),"^",2) W !
"RTN","GMTSDEM",23,0)
 I VADM(10)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Marital Status: ",?21,$P(VADM(10),"^",2)
"RTN","GMTSDEM",24,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEM",25,0)
 I VADM(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Religion: ",$P(VADM(9),"^",2)
"RTN","GMTSDEM",26,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEM",27,0)
 I VAPD(6)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Occupation: ",$P(VAPD(6),"^",1),!
"RTN","GMTSDEM",28,0)
 I $P(VAEL(2),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Period of Service: ",?21,$P(VAEL(2),"^",2),!
"RTN","GMTSDEM",29,0)
 I VASV(6) S GMI=6 D BOS
"RTN","GMTSDEM",30,0)
 I VASV(7) S GMI=7 D BOS
"RTN","GMTSDEM",31,0)
 I VASV(8) S GMI=8 D BOS
"RTN","GMTSDEM",32,0)
 D MORE Q
"RTN","GMTSDEM",33,0)
BOS ; Branch of Service
"RTN","GMTSDEM",34,0)
 S X=$P(VASV(GMI,4),U,1) D REGDT4^GMTSU S FROM=X
"RTN","GMTSDEM",35,0)
 S X=$P(VASV(GMI,5),U,1) D REGDT4^GMTSU S TO=X
"RTN","GMTSDEM",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI=6 ?2,"Branch of Service: " W ?21,$P(VASV(GMI,1),U,2)," ",FROM," TO ",TO,!
"RTN","GMTSDEM",37,0)
 Q
"RTN","GMTSDEM",38,0)
MORE ; Service Connected Disabilities
"RTN","GMTSDEM",39,0)
 I $P(VAEL(2),U) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,"Combat: ",$S(VASV(5):"Y",1:"N"),?56,"POW: ",$S(VASV(4):"Y",1:"N"),!
"RTN","GMTSDEM",40,0)
ELIG ; Eligibility
"RTN","GMTSDEM",41,0)
 I $P(VAEL(1),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2) W:VAEL(8)'="" ?52," Status: ",$P(VAEL(8),"^",2) W !
"RTN","GMTSDEM",42,0)
 I $O(VAEL(1,0)) S I=0 F Z=0:0 S I=$O(VAEL(1,I)) Q:I=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(VAEL(1,I),"^",2),!
"RTN","GMTSDEM",43,0)
SC ; Service Connected Percent
"RTN","GMTSDEM",44,0)
 I VAEL(3) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"S/C %: ",?21,$P(VAEL(3),"^",2),!
"RTN","GMTSDEM",45,0)
MT ; Means Test
"RTN","GMTSDEM",46,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2),!
"RTN","GMTSDEM",47,0)
ADR ; Address
"RTN","GMTSDEM",48,0)
 Q:VAOA(9)=""
"RTN","GMTSDEM",49,0)
 I VAOA(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"NOK: ",VAOA(9) W:VAOA(10)'="" ?51,"Relation: ",VAOA(10) W !
"RTN","GMTSDEM",50,0)
 I VAOA(1)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAOA(1)]"" ?21,VAOA(1) W:VAOA(8)'="" ?54,"Phone: ",VAOA(8) W !
"RTN","GMTSDEM",51,0)
 I VAOA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(2),!
"RTN","GMTSDEM",52,0)
 I VAOA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(3),!
"RTN","GMTSDEM",53,0)
 I VAOA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(4) W:VAOA(5) ", ",$P(VAOA(5),U,2) W:VAOA(6) "  ",VAOA(6) W !
"RTN","GMTSDEM",54,0)
 Q
"RTN","GMTSDEM",55,0)
IEN ; Ineligible for Care Data
"RTN","GMTSDEM",56,0)
 S X=$P(VAEL(5,1),U,1) D REGDT4^GMTSU
"RTN","GMTSDEM",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Ineligible date: ",X
"RTN","GMTSDEM",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Ineligible TWX source: ",$P(VAEL(5,2),U,2),"  ",VAEL(5,3),", ",$P(VAEL(5,4),U,2),!
"RTN","GMTSDEM",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAEL(5,5) VAEL(5,5) W:VAEL(5,6) " Reason: ",VAEL(5,6),!
"RTN","GMTSDEM",60,0)
 Q
"RTN","GMTSDEM",61,0)
SCDP ; Service Connected Diagnosis
"RTN","GMTSDEM",62,0)
 S SCD=^DPT(DFN,.372,IX,0)
"RTN","GMTSDEM",63,0)
 S SCDS=$S($P(SCD,"^",1):$P(^DIC(31,$P(SCD,"^",1),0),"^",1),1:"") S SCDP=$P(SCD,"^",2)_"% "_$S($P(SCD,"^",3):"SC",1:"")
"RTN","GMTSDEM",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"S/C Disabilities: ",SCDS,?61,SCDP,!
"RTN","GMTSDEM",65,0)
 Q
"RTN","GMTSDEM",66,0)
END ; Clean-up and quit
"RTN","GMTSDEM",67,0)
 K I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z Q
"RTN","GMTSDEMB")
0^3^B11930178
"RTN","GMTSDEMB",1,0)
GMTSDEMB ; SLC/DLT,KER - Brief Demographic Component  ; 04/04/2002
"RTN","GMTSDEMB",2,0)
 ;;2.7;Health Summary;**29,49,53**;Oct 20, 1995
"RTN","GMTSDEMB",3,0)
 ;                    
"RTN","GMTSDEMB",4,0)
 ; External References
"RTN","GMTSDEMB",5,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4)
"RTN","GMTSDEMB",6,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEMB",7,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEMB",8,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEMB",9,0)
 ;   DBIA  2990  TFL^VAFCTFU1
"RTN","GMTSDEMB",10,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSDEMB",11,0)
 ;   DBIA  2171  $$LKUP^XUAF4
"RTN","GMTSDEMB",12,0)
 ;                  
"RTN","GMTSDEMB",13,0)
DEMOG ; Brief Demographics (VADPT)
"RTN","GMTSDEMB",14,0)
 N I,IX,VA,VAEL,VADM,VAPA,GMTSS,GMTSR D ELIG^VADPT,ADD^VADPT,DEM^VADPT
"RTN","GMTSDEMB",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEMB",16,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEMB",17,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEMB",18,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", ",$P(VAPA(5),"^",2),"  ",VAPA(6),!
"RTN","GMTSDEMB",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2)
"RTN","GMTSDEMB",20,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEMB",21,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2)
"RTN","GMTSDEMB",22,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEMB",23,0)
 D CD^GMTSDEMP(DFN) Q:$D(GMTSQIT)  D TF(DFN) Q:$D(GMTSQIT)  D SRC
"RTN","GMTSDEMB",24,0)
 K I,IX,VA,VAEL,VAPA
"RTN","GMTSDEMB",25,0)
 Q
"RTN","GMTSDEMB",26,0)
TF(X) ; Treating Facilities
"RTN","GMTSDEMB",27,0)
 N DFN,GMTSC,GMTSDS,GMTSI,GMTSIEN,GMTSIT,GMTSS,GMTSTA,GMTSTF,GMTSTF2
"RTN","GMTSDEMB",28,0)
 N GMTSTFC,GMTSTY,GMTSTFT
"RTN","GMTSDEMB",29,0)
 S GMTSTFC=0,DFN=+($G(X)),U="^" D TFL^VAFCTFU1(.GMTSTF,+($G(DFN))) S (GMTSC,GMTSI,GMTSS)=0
"RTN","GMTSDEMB",30,0)
 F  S GMTSI=$O(GMTSTF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEMB",31,0)
 . S GMTSTFT=$G(GMTSTF(GMTSI))
"RTN","GMTSDEMB",32,0)
 . S:+($G(GMTSTF(GMTSI)))=776!(+($G(GMTSTF(GMTSI)))=200) $P(GMTSTFT,"^",2)="DEPT. OF DEFENSE"
"RTN","GMTSDEMB",33,0)
 . S GMTSTF2((99999999-(+($P($P($G(GMTSTF(GMTSI)),"^",3),".",1)))),+($$LKUP^XUAF4($P($G(GMTSTF(GMTSI)),"^",2))))=GMTSTFT
"RTN","GMTSDEMB",34,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSTF2(GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",35,0)
 . S GMTSIEN="" F  S GMTSIEN=$O(GMTSTF2(GMTSI,GMTSIEN)) Q:GMTSIEN=""  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",36,0)
 . . S GMTSTA=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",1),GMTSIT=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",2) Q:'$L(GMTSIT)
"RTN","GMTSDEMB",37,0)
 . . S GMTSDS=$P($P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",3),".",1)
"RTN","GMTSDEMB",38,0)
 . . S:+GMTSDS'>0 GMTSDS="" S:+GMTSDS>0 GMTSDS=$TR($$FMTE^XLFDT(GMTSDS,"5DZ"),"@"," ") S:GMTSDS="" GMTSDS="--/--/----" S GMTSC=GMTSC+1
"RTN","GMTSDEMB",39,0)
 . . I GMTSC=1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",40,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?2,"Treating Facility:",?36,"Type",?49,"Station",?61,"Last Seen"
"RTN","GMTSDEMB",41,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?2,"------------------------------",?36,"-----------",?49,"-------",?61,"----------"
"RTN","GMTSDEMB",42,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSTY=$$GET1^DIQ(4,(+GMTSIEN_","),13,"E") W !,?2,$G(GMTSIT),?36,$G(GMTSTY),?49,$J($G(GMTSTA),6),?61,$G(GMTSDS) S GMTSTFC=GMTSTFC+1
"RTN","GMTSDEMB",43,0)
 Q
"RTN","GMTSDEMB",44,0)
SRC ; Source of Info
"RTN","GMTSDEMB",45,0)
 N GMTSS,GMTSR S GMTSR=0 S:$G(^GMT(142,+($G(GMTSTYP)),"VA"))>0&($P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)["REMOTE") GMTSR=1
"RTN","GMTSDEMB",46,0)
 S GMTSS=$$SITE^GMTSU2 I GMTSR>0,$L(GMTSS) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Source of Info: ",GMTSS,!
"RTN","GMTSDEMB",48,0)
 Q
"RTN","GMTSDEMP")
0^6^B20493198
"RTN","GMTSDEMP",1,0)
GMTSDEMP ; SLC/DLT,KER - Demographic (Providers)   ; 04/04/2002
"RTN","GMTSDEMP",2,0)
 ;;2.7;Health Summary;**53**;Oct 20, 1995
"RTN","GMTSDEMP",3,0)
 ;                    
"RTN","GMTSDEMP",4,0)
 ; External References
"RTN","GMTSDEMP",5,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEMP",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4, #200 and #404.51)
"RTN","GMTSDEMP",7,0)
 ;   DBIA  1252  $$OUTPTTM^SDUTL3
"RTN","GMTSDEMP",8,0)
 ;   DBIA  1252  $$OUTPTPR^SDUTL3
"RTN","GMTSDEMP",9,0)
 ;   DBIA  1252  $$OUTPTAP^SDUTL3
"RTN","GMTSDEMP",10,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","GMTSDEMP",11,0)
 ;                  
"RTN","GMTSDEMP",12,0)
CD(DFN) ; Clinical Demographics (Provider Info)
"RTN","GMTSDEMP",13,0)
 N PAT,TEAM,TMPH,PROV,PRPH,PPGA,PPGD,ASSP,ASPH,ASPA,ASPD,IPRO,IPPH,IPGA,IPGD,ATTN,ATPH,APGA,APGD
"RTN","GMTSDEMP",14,0)
 S (TEAM,PROV,ASSP,IPRO,ATTN)=0,(TMPH,PRPH,PPGA,PPGD,ASPH,ASPA,ASPD,IPPH,IPGA,IPGD,ATPH,APGA,APGD)=""
"RTN","GMTSDEMP",15,0)
 S:+($G(DT))=0 DT=$$DT^XLFDT S TEAM=$$OUTPTTM^SDUTL3(+($G(DFN))) S:+TEAM>0 TMPH=$$GET1^DIQ(404.51,(+($G(TEAM))_","),.02)
"RTN","GMTSDEMP",16,0)
 S PROV=$$OUTPTPR^SDUTL3(+($G(DFN))) I +PROV>0 D
"RTN","GMTSDEMP",17,0)
 . I '$L($P(PROV,"^",2)) S PROV=0,(PRPH,PPGA,PPGD)="" Q
"RTN","GMTSDEMP",18,0)
 . S PRPH=$$GET1^DIQ(200,(+($G(PROV))_","),.132),PPGA=$$GET1^DIQ(200,(+($G(PROV))_","),.137),PPGD=$$GET1^DIQ(200,(+($G(PROV))_","),.138)
"RTN","GMTSDEMP",19,0)
 S ASSP=$$OUTPTAP^SDUTL3(+($G(DFN))) I +ASSP>0&(+ASSP'=+PROV) D
"RTN","GMTSDEMP",20,0)
 . S ASSP=+ASSP_"^"_$$GET1^DIQ(200,(+($G(ASSP))_","),.01)
"RTN","GMTSDEMP",21,0)
 . I '$L($P(ASSP,"^",2)) S ASSP=0,(ASPH,ASPA,ASPD)="" Q
"RTN","GMTSDEMP",22,0)
 . S ASPH=$$GET1^DIQ(200,(+($G(ASSP))_","),.132),ASPA=$$GET1^DIQ(200,(+($G(ASSP))_","),.137),ASPD=$$GET1^DIQ(200,(+($G(ASSP))_","),.138)
"RTN","GMTSDEMP",23,0)
 S:(+ASSP=+PROV) (ASSP,ASPH,ASPA,ASPD)=""
"RTN","GMTSDEMP",24,0)
 S IPRO=$G(^DPT(+($G(DFN)),.104)) I +IPRO>0 D
"RTN","GMTSDEMP",25,0)
 . S IPRO=+IPRO_"^"_$$GET1^DIQ(200,(+($G(IPRO))_","),.01)
"RTN","GMTSDEMP",26,0)
 . I '$L($P(IPRO,"^",2)) S IPRO=0,(IPPH,IPGA,IPGD)="" Q
"RTN","GMTSDEMP",27,0)
 . S IPPH=$$GET1^DIQ(200,(+($G(IPRO))_","),.132),IPGA=$$GET1^DIQ(200,(+($G(IPRO))_","),.137),IPGD=$$GET1^DIQ(200,(+($G(IPRO))_","),.138)
"RTN","GMTSDEMP",28,0)
 S ATTN=$G(^DPT(+($G(DFN)),.1041)) I +ATTN>0 D
"RTN","GMTSDEMP",29,0)
 . S ATTN=+ATTN_"^"_$$GET1^DIQ(200,(+($G(ATTN))_","),.01)
"RTN","GMTSDEMP",30,0)
 . I '$L($P(ATTN,"^",2)) S ATTN=0,(ATPH,APGA,APGD)="" Q
"RTN","GMTSDEMP",31,0)
 . S ATPH=$$GET1^DIQ(200,(+($G(ATTN))_","),.132),APGA=$$GET1^DIQ(200,(+($G(ATTN))_","),.137),APGD=$$GET1^DIQ(200,(+($G(ATTN))_","),.138)
"RTN","GMTSDEMP",32,0)
 Q:(+($G(PROV))+($G(TEAM))+($G(ATTN))+($G(IPRO))+($G(ASSP)))=0
"RTN","GMTSDEMP",33,0)
 I +($G(TEAM))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",34,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?10,"PCMM Team: ",$E($P($G(TEAM),"^",2),1,31) W ?53," Phone: ",?61,$G(TMPH)
"RTN","GMTSDEMP",35,0)
 I +($G(PROV))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?6,"PCMM Provider: ",$E($P($G(PROV),"^",2),1,31) W ?53," Phone: ",?61,$G(PRPH)
"RTN","GMTSDEMP",37,0)
 . I $L(PPGA)!($L(PPGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMP",38,0)
 . W:$L($G(PPGA)) !,?7,"Analog Pager: ",PPGA W:$L($G(PPGD))&($L($G(PPGA))) ?45," Digital Pager: ",PPGD W:$L($G(PPGD))&('$L($G(PPGA))) !,?6,"Digital Pager: ",PPGD
"RTN","GMTSDEMP",39,0)
 I +($G(ASSP))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",40,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?3,"PCMM Assoc. Prov: ",$E($P($G(ASSP),"^",2),1,31) W ?53," Phone: ",?61,$G(ASPH)
"RTN","GMTSDEMP",41,0)
 . I $L(ASPA)!($L(ASPD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMP",42,0)
 . W:$L($G(ASPA)) !,?7,"Analog Pager: ",ASPA W:$L($G(ASPD))&($L($G(ASPA))) ?45," Digital Pager: ",ASPD W:$L($G(ASPD))&('$L($G(ASPA))) !,?6,"Digital Pager: ",ASPD
"RTN","GMTSDEMP",43,0)
 I +($G(PROV))>0!(+($G(TEAM))>0)!(+($G(ASSP))>0) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",44,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDEMP",45,0)
 I +($G(IPRO))>0,+($G(IPRO))=+($G(ATTN)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",46,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?3,"Inpat. Prov/Attn: ",$E($P($G(IPRO),"^",2),1,31) W ?53," Phone: ",?61,$G(IPPH)
"RTN","GMTSDEMP",47,0)
 . I $L(IPGA)!($L(IPGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMP",48,0)
 . W:$L($G(IPGA)) !,?7,"Analog Pager: ",IPGA W:$L($G(IPGD))&($L($G(IPGA))) ?45," Digital Pager: ",IPGD W:$L($G(IPGD))&('$L($G(IPGA))) !,?6,"Digital Pager: ",IPGD
"RTN","GMTSDEMP",49,0)
 I +($G(IPRO))>0,+($G(IPRO))'=+($G(ATTN)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",50,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?4,"Inpat. Provider: ",$E($P($G(IPRO),"^",2),1,31) W ?53," Phone: ",?61,$G(IPPH)
"RTN","GMTSDEMP",51,0)
 . I $L(IPGA)!($L(IPGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMP",52,0)
 . W:$L($G(IPGA)) !,?7,"Analog Pager: ",IPGA W:$L($G(IPGD))&($L($G(IPGA))) ?45," Digital Pager: ",IPGD W:$L($G(IPGD))&('$L($G(IPGA))) !,?6,"Digital Pager: ",IPGD
"RTN","GMTSDEMP",53,0)
 I +($G(ATTN))>0,+($G(IPRO))'=+($G(ATTN)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",54,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?3,"Inpat. Attending: ",$E($P($G(ATTN),"^",2),1,31) W ?53," Phone: ",?61,$G(ATPH)
"RTN","GMTSDEMP",55,0)
 . I $L(APGA)!($L(APGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMP",56,0)
 . W:$L($G(APGA)) !,?7,"Analog Pager: ",APGA W:$L($G(APGD))&($L($G(APGA))) ?45," Digital Pager: ",APGD W:$L($G(APGD))&('$L($G(APGA))) !,?6,"Digital Pager: ",APGD
"RTN","GMTSDEMP",57,0)
 I +($G(PROV))>0!(+($G(ASSP))>0)!(+($G(TEAM))>0)!(+($G(ATTN))>0)!(+($G(IPRO))>0) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDEMP",58,0)
 Q
"RTN","GMTSDVR")
0^5^B36427796
"RTN","GMTSDVR",1,0)
GMTSDVR ; SLC/JER,KER - Health Summary Driver ; 04/04/2002
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27,28,30,31,35,53**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
 ;                    
"RTN","GMTSDVR",4,0)
 ; External References
"RTN","GMTSDVR",5,0)
 ;   DBIA 10090  ^DIC(4
"RTN","GMTSDVR",6,0)
 ;   DBIA   510  ^DISV(
"RTN","GMTSDVR",7,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSDVR",8,0)
 ;   DBIA 10091  ^XMB(1
"RTN","GMTSDVR",9,0)
 ;   DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSDVR",10,0)
 ;   DBIA  2160  ^XUTL("OR"
"RTN","GMTSDVR",11,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSDVR",12,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSDVR",13,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSDVR",14,0)
 ;   DBIA   148  PATIENT^ORU1
"RTN","GMTSDVR",15,0)
 ;   DBIA   183  DFN^PSOSD1
"RTN","GMTSDVR",16,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSDVR",17,0)
 ;                    
"RTN","GMTSDVR",18,0)
MAIN ; Control branching
"RTN","GMTSDVR",19,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",20,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",21,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",22,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",23,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",24,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!(+($G(ORVP))>0)
"RTN","GMTSDVR",25,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",26,0)
 . . I +($G(ORVP)) S GMPAT(1)=+($G(ORVP))
"RTN","GMTSDVR",27,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,1:0)  D
"RTN","GMTSDVR",28,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",29,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",30,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",31,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",32,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",33,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",34,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",35,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",36,0)
 . . D HSOUT
"RTN","GMTSDVR",37,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",38,0)
 Q
"RTN","GMTSDVR",39,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSDVR",40,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSDVR",41,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSDVR",42,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSDVR",43,0)
 Q
"RTN","GMTSDVR",44,0)
PATCOPY(GMP,GMPAT) ; Copies patients from GMP to GMPAT array
"RTN","GMTSDVR",45,0)
 N IFN,GMDFN
"RTN","GMTSDVR",46,0)
 S IFN=0
"RTN","GMTSDVR",47,0)
 ;   GMPAT(NAME,GMDFN) - alphabetic order by patient
"RTN","GMTSDVR",48,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",49,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",50,0)
 . ;   Get name from ^DPT to prevent duplicates
"RTN","GMTSDVR",51,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",52,0)
 Q
"RTN","GMTSDVR",53,0)
RESUB(GMP) ; Resubscript GMP Array
"RTN","GMTSDVR",54,0)
 ;   Subscripts in GMP array are converted to numeric
"RTN","GMTSDVR",55,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",56,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",57,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",58,0)
 . S GMDFN=0
"RTN","GMTSDVR",59,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",60,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",61,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",62,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",63,0)
 Q
"RTN","GMTSDVR",64,0)
 ;                   
"RTN","GMTSDVR",65,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",66,0)
 ;                   
"RTN","GMTSDVR",67,0)
 ;   Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",68,0)
 ;              DFN=Record # of patient in file 2
"RTN","GMTSDVR",69,0)
 ;          GMTSPX1=Optional internal FM ending date
"RTN","GMTSDVR",70,0)
 ;          GMTSPX2=Optional internal FM beginning date
"RTN","GMTSDVR",71,0)
 ;                   
"RTN","GMTSDVR",72,0)
 ;   NOTE:  Optional date range variables are both 
"RTN","GMTSDVR",73,0)
 ;          required if a date range is desired.
"RTN","GMTSDVR",74,0)
 ;                   
"RTN","GMTSDVR",75,0)
 ;   To call from TaskMan:
"RTN","GMTSDVR",76,0)
 ;          S ZTRTN="ENXQ^GMTSDVR"
"RTN","GMTSDVR",77,0)
 ;          S ZTSAVE("GMTSTYP")=""
"RTN","GMTSDVR",78,0)
 ;          S ZTSAVE("DFN")=""
"RTN","GMTSDVR",79,0)
 ;          D ^%ZTLOAD
"RTN","GMTSDVR",80,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",81,0)
 Q
"RTN","GMTSDVR",82,0)
 ;                   
"RTN","GMTSDVR",83,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",84,0)
 ;                   
"RTN","GMTSDVR",85,0)
 ;   Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",86,0)
 ;              DFN=Record # of patient in file 2
"RTN","GMTSDVR",87,0)
 ;          GMTSPX1=Optional internal FM ending date
"RTN","GMTSDVR",88,0)
 ;          GMTSPX2=Optional internal FM beginning date
"RTN","GMTSDVR",89,0)
 ;                   
"RTN","GMTSDVR",90,0)
 ;   NOTE:  Optional date range variables are both 
"RTN","GMTSDVR",91,0)
 ;          required if a date range is desired.
"RTN","GMTSDVR",92,0)
 ;                   
"RTN","GMTSDVR",93,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",94,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",95,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",96,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",97,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",98,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",99,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",100,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",101,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",102,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",103,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",104,0)
 D PQ
"RTN","GMTSDVR",105,0)
 Q
"RTN","GMTSDVR",106,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",107,0)
 N DIC,X,Y
"RTN","GMTSDVR",108,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",109,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",110,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",111,0)
 K GMTYP S Y=$$TYPE^GMTSULT Q:+Y'>0
"RTN","GMTSDVR",112,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",113,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",114,0)
 Q
"RTN","GMTSDVR",115,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",116,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",117,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",118,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",119,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",120,0)
 . N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",121,0)
 . S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",122,0)
 . S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",123,0)
 . D LOADSEG
"RTN","GMTSDVR",124,0)
 . S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",125,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",126,0)
 . . N GMDUOUT
"RTN","GMTSDVR",127,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",128,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",129,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",130,0)
 Q
"RTN","GMTSDVR",131,0)
LOADSEG ; Load Enabled Components into GMTSEG Array
"RTN","GMTSDVR",132,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",133,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",134,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",135,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",136,0)
 Q
"RTN","GMTSDVR",137,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",138,0)
 N GMTK S GMTK=0 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  D
"RTN","GMTSDVR",139,0)
 . N GMTSE,GMTSR,GMTSF S GMTSE=^(GMTK,0),GMTSR=U_$P(GMTSE,";",2) Q:GMTSR="^"
"RTN","GMTSDVR",140,0)
 . S GMTSF=+$P(@(GMTSR_"0)"),U,2) Q:+GMTSF=0
"RTN","GMTSDVR",141,0)
 . S GMTSEG(GMTI,GMTSF,GMTK)=$P(GMTSE,";"),GMTSEG(GMTI,GMTSF,0)=GMTSR
"RTN","GMTSDVR",142,0)
 Q
"RTN","GMTSDVR",143,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",144,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",145,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",146,0)
 N %ZIS,IOP
"RTN","GMTSDVR",147,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",148,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",149,0)
NOQUE ; Do Not Queue Output
"RTN","GMTSDVR",150,0)
 D @ZTRTN D ^%ZISC
"RTN","GMTSDVR",151,0)
 Q
"RTN","GMTSDVR",152,0)
QUE ; Queue output
"RTN","GMTSDVR",153,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",154,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",155,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",156,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",157,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",158,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",159,0)
 Q
"RTN","GMTSDVR",160,0)
ACTPROF(GMDFN) ; Print Action Profile for Patient
"RTN","GMTSDVR",161,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",162,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",163,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",164,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",165,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",166,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",167,0)
 . S DFN=GMDFN
"RTN","GMTSDVR",168,0)
 . ;   Reset DFN because ^PSOSD1 call kills it
"RTN","GMTSDVR",169,0)
 . D PAGE^GMTSPL
"RTN","GMTSP53")
0^^B1523185
"RTN","GMTSP53",1,0)
GMTSP53 ; CIO/SLC - Post Install GMTS*2.7*53    ; 04/04/2002
"RTN","GMTSP53",2,0)
 ;;2.7;Health Summary;**53**;Oct 20, 1995
"RTN","GMTSP53",3,0)
 ;                 
"RTN","GMTSP53",4,0)
 ; External References
"RTN","GMTSP53",5,0)
 ;   DBIA   122  ^VA(200,  (ending DBIA 122)
"RTN","GMTSP53",6,0)
 ;   DBIA   122  ^DD(200,  (ending DBIA 122)
"RTN","GMTSP53",7,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSP53",8,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSP53",9,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSP53",10,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","GMTSP53",11,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","GMTSP53",12,0)
 ;                 
"RTN","GMTSP53",13,0)
 Q
"RTN","GMTSP53",14,0)
POST ; Post Install
"RTN","GMTSP53",15,0)
 D HOME^%ZIS N GMTST,DIC,DIR,POP,X,Y,%,%ZIS,IOP,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","GMTSP53",16,0)
 S ZTRTN="NEWP^GMTSP51",ZTDESC="Running GMTS*2.7*53 Post-Install"
"RTN","GMTSP53",17,0)
 S ZTIO="",ZTDTH=$H,GMTST=" GMTS*2.7*53 Post-Install"
"RTN","GMTSP53",18,0)
 D ^%ZTLOAD,^%ZISC
"RTN","GMTSP53",19,0)
 Q
"RTN","GMTSP53",20,0)
NEWP ; Fix New Person file #200
"RTN","GMTSP53",21,0)
 S:$D(ZTQUEUED) ZTREQ="@" Q:$D(^DD(200,"GL",100.1))  N GMTSI S GMTSI=0 F  S GMTSI=$O(^VA(200,GMTSI)) Q:+GMTSI=0  K ^VA(200,GMTSI,100.1)
"RTN","GMTSP53",22,0)
 Q
"RTN","GMTSPD")
0^7^B28728574
"RTN","GMTSPD",1,0)
GMTSPD ; SLC/JER,KER - Interactive Print-by-Location ; 04/04/2002
"RTN","GMTSPD",2,0)
 ;;2.7;Health Summary;**28,30,47,49,53**;Oct 20, 1995
"RTN","GMTSPD",3,0)
 ;
"RTN","GMTSPD",4,0)
 ; External
"RTN","GMTSPD",5,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPD",6,0)
 ;    DBIA 10040  ^SC("B"
"RTN","GMTSPD",7,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPD",8,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPD",9,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPD",10,0)
 ;    DBIA   510  ^DISV(
"RTN","GMTSPD",11,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPD",12,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPD",13,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPD",14,0)
 ;    DBIA 10006  ^DIC (file #42 and #44)
"RTN","GMTSPD",15,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPD",16,0)
 ;    DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSPD",17,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPD",18,0)
 ;                           
"RTN","GMTSPD",19,0)
MAIN ; Interactive Print by Location
"RTN","GMTSPD",20,0)
 N GMPSAP,GMTSCDT,GMTSTYP,GMLOC,GMTSTN,GMTSSC
"RTN","GMTSPD",21,0)
 S GMTSTYP=0 K DIROUT
"RTN","GMTSPD",22,0)
 F  D  Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",23,0)
 . S GMTSTYP=+($$SELTYP) Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",24,0)
 . F  D  Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)!($D(GMTSSC("ALL")))
"RTN","GMTSPD",25,0)
 . . K GMTSSC,DUOUT D SELLOC(.GMTSSC) Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",26,0)
 . . D CHKLOC(.GMTSSC) Q:$O(GMTSSC(0))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",27,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSPD",28,0)
 . . N DIROUT D HSOUT^GMTSPD2 W ! S DUOUT=1
"RTN","GMTSPD",29,0)
 Q
"RTN","GMTSPD",30,0)
SELTYP() ; Select Health Summary type
"RTN","GMTSPD",31,0)
 N DIC,X,Y
"RTN","GMTSPD",32,0)
 I $D(^DISV(DUZ,"^GMT(142,")),+$G(GMTSTYP)=0 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U)
"RTN","GMTSPD",33,0)
 S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSPD",34,0)
 S DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSPD",35,0)
 S Y=$$TYPE^GMTSULT I +Y'>0,X="^^" S DIROUT=1
"RTN","GMTSPD",36,0)
 I +Y>0,$S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) D
"RTN","GMTSPD",37,0)
 . W !,"This Summary Type includes no components...Please choose another."
"RTN","GMTSPD",38,0)
 Q Y
"RTN","GMTSPD",39,0)
SELLOC(GMX) ; Select multiple Hospital Location
"RTN","GMTSPD",40,0)
 N DIC,LOC,Y,X,DIR,GMTSLC
"RTN","GMTSPD",41,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: ",GMTSLC=0
"RTN","GMTSPD",42,0)
 I $D(^XUSEC("GMTS VIEW ONLY",+($G(DUZ)))) S GMTSLC=1
"RTN","GMTSPD",43,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",44,0)
 F  D  Q:+$G(GMX(+$G(Y)))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)  Q:GMTSLC<0
"RTN","GMTSPD",45,0)
 . D:GMTSLC'>0 ASK Q:$D(GMX("ALL"))
"RTN","GMTSPD",46,0)
 . D:GMTSLC>0 ^DIC S GMTSLC=GMTSLC+1 Q:$G(DIROUT)=1
"RTN","GMTSPD",47,0)
 . I +Y'>0 S:X="^^" DIROUT=1 Q
"RTN","GMTSPD",48,0)
 . S GMX(+Y)=$P(Y,U,1,2)_U_$P(Y(0),U,3)
"RTN","GMTSPD",49,0)
 . S $P(GMX,U)=+Y
"RTN","GMTSPD",50,0)
 . I "COR"[$P(Y(0),U,3) S $P(GMX,U,3)="COR"
"RTN","GMTSPD",51,0)
 . S DIC("A")="Select Next Hospital Location: "
"RTN","GMTSPD",52,0)
 Q
"RTN","GMTSPD",53,0)
ASK ; Prompt for One or ALL
"RTN","GMTSPD",54,0)
 N ERR,DIC,DIR,LASTI,LAST
"RTN","GMTSPD",55,0)
ASK2 S DIR("A")="Select Hospital Location: "
"RTN","GMTSPD",56,0)
 S LASTI=$G(^DISV(+($G(DUZ)),"^SC(")),LAST=$S(+LASTI>0:$P($G(^SC(+LASTI,0)),"^",1),1:"")
"RTN","GMTSPD",57,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D A1^GMTSPD",DIR("??")="^D A2^GMTSPD"
"RTN","GMTSPD",58,0)
 D ^DIR I $L($G(X)),$E($G(X),1)=" ",$L(LAST),+($G(LASTI))>0 D  Q
"RTN","GMTSPD",59,0)
 . W "  ",LAST S X=LAST,Y=+LASTI_"^"_LAST,Y(0)=$G(^SC(+LASTI,0)),Y(0,0)=LAST Q
"RTN","GMTSPD",60,0)
 I $$UP^XLFSTR(Y)="ALL" D  Q
"RTN","GMTSPD",61,0)
 . K GMX S GMX="1^ALL^COR",GMX("ALL")="",GMX(1)="1^ALL^C",GMTSLC=-1
"RTN","GMTSPD",62,0)
 S ERR=1,DIC=44,DIC(0)="EMZ"
"RTN","GMTSPD",63,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3) S ERR=0"
"RTN","GMTSPD",64,0)
 D ^DIC
"RTN","GMTSPD",65,0)
 I $L(X),+($G(ERR))>0 D  W ! G ASK2
"RTN","GMTSPD",66,0)
 . W " ??",!!,?5,"Not a ward, clinic or operating room"
"RTN","GMTSPD",67,0)
 I +Y'>0 S:X["^^" DIROUT=1,GMTSEXIT="^^" Q
"RTN","GMTSPD",68,0)
 Q
"RTN","GMTSPD",69,0)
A1 ; Single ? Help
"RTN","GMTSPD",70,0)
 W !,"  Answer with HOSPITAL LOCATION NAME, or ABBREVIATION, TEAM or 'ALL'"
"RTN","GMTSPD",71,0)
 W !,"  for all hospital locations.  Enter '^' to return to Health Summary"
"RTN","GMTSPD",72,0)
 W !,"  Type Selection or '^^' to exit."
"RTN","GMTSPD",73,0)
 Q
"RTN","GMTSPD",74,0)
A2 ; Double ?? Help
"RTN","GMTSPD",75,0)
 N GMTSN,GMTSI,GMTSL,GMTSC,GMTSE,GMTSP,GMTSA S GMTSP=+($G(IOSL))-9 S:GMTSP'>0 GMTSP=15
"RTN","GMTSPD",76,0)
 S (GMTSA,GMTSC,GMTSE)=0,GMTSN="" D A1 W !
"RTN","GMTSPD",77,0)
 F  S GMTSN=$O(^SC("B",GMTSN)) Q:GMTSN=""  D  Q:GMTSE
"RTN","GMTSPD",78,0)
 . S GMTSI=0 F  S GMTSI=$O(^SC("B",GMTSN,GMTSI)) Q:GMTSI=""  D  Q:GMTSE
"RTN","GMTSPD",79,0)
 . . S GMTSL=$P($G(^SC(GMTSI,0)),"^",1) Q:'$L(GMTSL)  S GMTSC=GMTSC+1,GMTSA=GMTSA+1
"RTN","GMTSPD",80,0)
 . . W:GMTSC=1 !,?3,"Choose from:" W !,?3,GMTSL
"RTN","GMTSPD",81,0)
 . . I GMTSA'<GMTSP D CONT
"RTN","GMTSPD",82,0)
 Q
"RTN","GMTSPD",83,0)
CONT ; Continue Displaying List
"RTN","GMTSPD",84,0)
 S GMTSP=+($G(IOSL))-1 S:GMTSP'>0 GMTSP=23 S GMTSA=0
"RTN","GMTSPD",85,0)
 N DIR,DA,X,Y,DTOUT,DUOUT,DIRUT,DIROUT S DIR(0)="E",DIR("A")="   '^' TO STOP",(DIR("?"),DIR("??"))="^D C1^GMTSPD"
"RTN","GMTSPD",86,0)
 D ^DIR S:+($G(Y))=0 GMTSE=1
"RTN","GMTSPD",87,0)
 Q
"RTN","GMTSPD",88,0)
C1 ; Continue Help
"RTN","GMTSPD",89,0)
 W !,"     Enter ether RETURN or '^'" Q
"RTN","GMTSPD",90,0)
CHKLOC(LOC) ; Get date range for Clinics/ORs
"RTN","GMTSPD",91,0)
 I $P($G(LOC),U,3)="COR" D  Q:$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",92,0)
 . S $P(LOC,U,4)=$$SELDATE
"RTN","GMTSPD",93,0)
 W ! S GMLOC=0 F  S GMLOC=$O(LOC(GMLOC)) Q:+GMLOC'>0  D
"RTN","GMTSPD",94,0)
 . I "COR"[$P(LOC(+GMLOC),U,3) S $P(LOC(+GMLOC),U,4)=$P(LOC,U,4,5)
"RTN","GMTSPD",95,0)
 Q
"RTN","GMTSPD",96,0)
SELDATE() ; Visit/Surgery date range for Print-by-Clinic
"RTN","GMTSPD",97,0)
 N %,%H,%I,DIR,DEFDT,X,Y,GMBEG,GMEND
"RTN","GMTSPD",98,0)
 S (GMBEG,GMEND)=0
"RTN","GMTSPD",99,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",100,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",101,0)
 S DIR("A")="Please enter the beginning Visit or Surgery date"
"RTN","GMTSPD",102,0)
 D ^DIR
"RTN","GMTSPD",103,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPD",104,0)
 S GMBEG=Y
"RTN","GMTSPD",105,0)
 I +GMBEG>0 D
"RTN","GMTSPD",106,0)
 . S X=$P(GMBEG,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",107,0)
 . S DIR(0)="DO^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",108,0)
 . S DIR("A")="Please enter the ending Visit or Surgery date"
"RTN","GMTSPD",109,0)
 . D ^DIR
"RTN","GMTSPD",110,0)
 . I Y="^^" S DIROUT=1
"RTN","GMTSPD",111,0)
 . S GMEND=Y
"RTN","GMTSPD",112,0)
 Q $S(+GMEND>0&(GMEND>GMBEG):GMBEG_U_GMEND,+GMEND>0&(GMEND<GMBEG):GMEND_U_GMBEG,+GMEND>0&(GMEND=GMBEG):GMBEG,1:0)
"RTN","GMTSPD",113,0)
CKPAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPD",114,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG
"RTN","GMTSPD",115,0)
 S LTYPE=$P(LOC,U,3)
"RTN","GMTSPD",116,0)
 I LTYPE="W" D
"RTN","GMTSPD",117,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPD",118,0)
 . S GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPD",119,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPD",120,0)
 . S GMY=0
"RTN","GMTSPD",121,0)
 . I +$P(LOC,U,5) S X1=$P(LOC,U,5),X2=1 D C^%DTC
"RTN","GMTSPD",122,0)
 . I +$P(LOC,U,5)'>0 S X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPD",123,0)
 . I LTYPE="C",+$O(^SC(+LOC,"S",$P(LOC,U,4))),(+$O(^($P(LOC,U,4)))'>X) S GMY=1
"RTN","GMTSPD",124,0)
 . I LTYPE="OR" D
"RTN","GMTSPD",125,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPD",126,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPD",127,0)
 . . I +OLOC,+$P(LOC,U,5) D
"RTN","GMTSPD",128,0)
 . . . S GMBEG=$P(LOC,U,4)
"RTN","GMTSPD",129,0)
 . . . F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPD",130,0)
 . . . . I $O(^SRF("AOR",+OLOC,+GMBEG,0)) S GMY=1
"RTN","GMTSPD",131,0)
 . . . . E  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPD",132,0)
 Q $G(GMY)
"RTN","GMTSPN")
0^1^B63827853
"RTN","GMTSPN",1,0)
GMTSPN ; SLC/KER - Progress Note                     ; 04/04/2002
"RTN","GMTSPN",2,0)
 ;;2.7;Health Summary;**12,28,33,35,45,47,49,53**;Oct 20, 1995
"RTN","GMTSPN",3,0)
 ;                          
"RTN","GMTSPN",4,0)
 ; External References
"RTN","GMTSPN",5,0)
 ;    DBIA  2902  VISIT^TIULAPIC
"RTN","GMTSPN",6,0)
 ;    DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSPN",7,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSPN",8,0)
 ;                        
"RTN","GMTSPN",9,0)
PN ; Progress Note Health Summary Component
"RTN","GMTSPN",10,0)
 N TIUSTAT,TIUTYPE,TIUNAM,DIC,TIUFPRIV,TIUXREF,GMTSTIUC,X,Y,GMTSREF
"RTN","GMTSPN",11,0)
 S TIUFPRIV=1,TIUSTAT="ALL",TIUXREF="""APT""",GMTSTIUC="P",(TIUNAM,X)="PROGRESS NOTES"
"RTN","GMTSPN",12,0)
 S DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL"""
"RTN","GMTSPN",13,0)
 D ^DIC K DIC("S") S:Y>0 TIUTYPE=+Y S GMTSREF="" D MAIN K GMTSREF
"RTN","GMTSPN",14,0)
 Q
"RTN","GMTSPN",15,0)
MAIN ; Control branching
"RTN","GMTSPN",16,0)
 N ADATE,ADMIT,ASUB,ATDATE,ATTNDNG,ATTYPE,ATYPE,AUTHOR,CHILD,CONEED
"RTN","GMTSPN",17,0)
 N COSAME,COSGEDBY,COSIG,CURIEN,DISCHG,GMTSA,GMTSAI,GMTSAII,GMTSCNT
"RTN","GMTSPN",18,0)
 N GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSID,GMTSIDC,GMTSII,GMTSIQ
"RTN","GMTSPN",19,0)
 N GMTSJ,GMTSK,GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX
"RTN","GMTSPN",20,0)
 N GMTSXTRA,I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,STATUS,TSPEC
"RTN","GMTSPN",21,0)
 N TYPE,X,Y
"RTN","GMTSPN",22,0)
 K ^TMP("TIU",$J) S GMTSX=1 D EXTIU Q:'$D(^TMP("TIU",$J))  D PNOTE
"RTN","GMTSPN",23,0)
 K ^TMP("TIU",$J),PN Q
"RTN","GMTSPN",24,0)
 ;                      
"RTN","GMTSPN",25,0)
 ; Progress Notes
"RTN","GMTSPN",26,0)
 ; 
"RTN","GMTSPN",27,0)
 ; ^TMP("TIU",$J,IDT,0)
"RTN","GMTSPN",28,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"E")
"RTN","GMTSPN",29,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"I")
"RTN","GMTSPN",30,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",0)
"RTN","GMTSPN",31,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",#,0)
"RTN","GMTSPN",32,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",33,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",34,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",35,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",36,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZAD",0)
"RTN","GMTSPN",37,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",38,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",39,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",40,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",41,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",42,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",43,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",44,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",45,0)
 ; 
"RTN","GMTSPN",46,0)
 ; Selected Progress Notes
"RTN","GMTSPN",47,0)
 ; 
"RTN","GMTSPN",48,0)
 ; ^TMP("TIU",$J,IDT,#,0)
"RTN","GMTSPN",49,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"E")
"RTN","GMTSPN",50,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"I")
"RTN","GMTSPN",51,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",0)
"RTN","GMTSPN",52,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",#,0)
"RTN","GMTSPN",53,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",54,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",55,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",56,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",57,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",0)
"RTN","GMTSPN",58,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",59,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",60,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",61,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",62,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",63,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",64,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",65,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",66,0)
 ;                           
"RTN","GMTSPN",67,0)
PNOTE ; Progress Notes
"RTN","GMTSPN",68,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",69,0)
 . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_"," D NOTE
"RTN","GMTSPN",70,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",71,0)
SNOTE ; Selected Progress Notes
"RTN","GMTSPN",72,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",73,0)
 . N GMTSS S GMTSS=0 F  S GMTSS=$O(^TMP("TIU",$J,GMTSD,GMTSS)) Q:+GMTSS=0  D
"RTN","GMTSPN",74,0)
 . . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_","_GMTSS_"," D NOTE
"RTN","GMTSPN",75,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",76,0)
 ;                
"RTN","GMTSPN",77,0)
NOTE ;   Primary Note
"RTN","GMTSPN",78,0)
 N GMTSTDIC,GMTSI,GMTSXTRA S GMTSI=0
"RTN","GMTSPN",79,0)
 F  S GMTSI=$O(@(GMTSODIC_GMTSI_")")) Q:+GMTSI=0  D
"RTN","GMTSPN",80,0)
 . S (GMTSTDIC,GMTSPDIC,GMTSDIC)=GMTSODIC,(PARIEN,CURIEN)=GMTSI
"RTN","GMTSPN",81,0)
 . S CHILD=+($G(@(GMTSDIC_CURIEN_",""ZZID"",0)"))),TYPE="",GMTSID=0
"RTN","GMTSPN",82,0)
 . S:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) TYPE="Parent Interdisciplinary Note",GMTSID=1
"RTN","GMTSPN",83,0)
 . K PN S PN("#")=CURIEN,PN("#",0)="NOTE"
"RTN","GMTSPN",84,0)
 . D FLDS(GMTSDIC,CURIEN) D:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) ST^GMTSPN1("Begin Interdisciplinary Note")
"RTN","GMTSPN",85,0)
 . D WARN1^GMTSPN2 D:$E($G(GMTSTIUC),1)'["D" WH^GMTSPN1
"RTN","GMTSPN",86,0)
 . D:$G(GMTSTIUC)="DCS" WDH^GMTSPN1
"RTN","GMTSPN",87,0)
 . D:GMTSCNT=1&($G(GMTSTIUC)="DSB") WDBH^GMTSPN1
"RTN","GMTSPN",88,0)
 . I $G(GMTSTIUC)="DSB" D WDB^GMTSPN1(GMTSDIC,CURIEN) Q
"RTN","GMTSPN",89,0)
 . D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",90,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2
"RTN","GMTSPN",91,0)
 . D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",92,0)
 . D BL^GMTSPN2 N GMTSODIC S GMTSODIC=GMTSTDIC_CURIEN_"," D ANOTE,INOTE
"RTN","GMTSPN",93,0)
 . I GMTSID D ST^GMTSPN1("End Interdisciplinary Note") S GMTSID=0
"RTN","GMTSPN",94,0)
 Q
"RTN","GMTSPN",95,0)
ANOTE ;   Addendum to a Progress Note
"RTN","GMTSPN",96,0)
 N GMTSAI,GMTSXTRA S GMTSAI=0
"RTN","GMTSPN",97,0)
 F  S GMTSAI=$O(@(GMTSODIC_"""ZADD"","_GMTSAI_")")) Q:+GMTSAI=0  D
"RTN","GMTSPN",98,0)
 . S (GMTSTDIC,GMTSDIC)=GMTSODIC_"""ZADD"",",CURIEN=GMTSAI
"RTN","GMTSPN",99,0)
 . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="ADDENDUM TO A NOTE",TYPE=""
"RTN","GMTSPN",100,0)
 . S:$D(@(GMTSPDIC_PARIEN_",""ZZID"")")) TYPE="Addendum to a Parent Interdisciplinary Note"
"RTN","GMTSPN",101,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAH^GMTSPN1
"RTN","GMTSPN",102,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",103,0)
 Q
"RTN","GMTSPN",104,0)
INOTE ;   Interdisciplinary Progress Note
"RTN","GMTSPN",105,0)
 Q:+($G(@(GMTSODIC_"""ZZID"",0)")))'>0
"RTN","GMTSPN",106,0)
 N GMTSIQ,GMTSII,GMTSXTRA S GMTSIQ=0
"RTN","GMTSPN",107,0)
 F  S GMTSIQ=$O(@(GMTSODIC_"""ZZID"","_GMTSIQ_")")) Q:+GMTSIQ=0  D
"RTN","GMTSPN",108,0)
 . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_"""ZZID"","_GMTSIQ_","
"RTN","GMTSPN",109,0)
 . S GMTSII=0 F  S GMTSII=$O(@(GMTSODIC_GMTSII_")")) Q:+GMTSII=0  D
"RTN","GMTSPN",110,0)
 . . S GMTSDIC=GMTSODIC,CURIEN=GMTSII
"RTN","GMTSPN",111,0)
 . . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",112,0)
 . . S TYPE="Child Interdisciplinary Note"
"RTN","GMTSPN",113,0)
 . . D FLDS(GMTSDIC,CURIEN),ST^GMTSPN1("Interdisciplinary Note Cont.")
"RTN","GMTSPN",114,0)
 . . D WARN1^GMTSPN2,WIH^GMTSPN1 D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",115,0)
 . . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN)
"RTN","GMTSPN",116,0)
 . . D WARN2^GMTSPN2 D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN) D BL^GMTSPN2
"RTN","GMTSPN",117,0)
 . . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_GMTSII_",""ZADD"","
"RTN","GMTSPN",118,0)
 . . D AINOTE
"RTN","GMTSPN",119,0)
 Q
"RTN","GMTSPN",120,0)
AINOTE ;   Addendum to an Interdisciplinary Progress Note
"RTN","GMTSPN",121,0)
 N GMTSAII,GMTSXTRA S GMTSAII=0
"RTN","GMTSPN",122,0)
 F  S GMTSAII=$O(@(GMTSODIC_GMTSAII_")")) Q:+GMTSAII=0  D
"RTN","GMTSPN",123,0)
 . S GMTSDIC=GMTSODIC,CURIEN=GMTSAII
"RTN","GMTSPN",124,0)
 . K PN S PN("#")=GMTSI_"^"_GMTSII_"^"_CURIEN
"RTN","GMTSPN",125,0)
 . S PN("#",0)="ADDENDUM TO AN INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",126,0)
 . S TYPE="Addendum to a Child Interdisciplinary Note"
"RTN","GMTSPN",127,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAIH^GMTSPN1,WT^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",128,0)
 . D WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",129,0)
 Q
"RTN","GMTSPN",130,0)
 ;                           
"RTN","GMTSPN",131,0)
 ; Get Data
"RTN","GMTSPN",132,0)
EXTIU ;   Extract Patient/Visit VIA TIU
"RTN","GMTSPN",133,0)
 N MAX S DFN=+($G(DFN)) Q:DFN=0  S TIUTYPE=+($G(TIUTYPE)) Q:TIUTYPE=0
"RTN","GMTSPN",134,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSPN",135,0)
 S GMTS1=+($G(GMTS1)) Q:GMTS1=0  S GMTS2=+($G(GMTS2)) Q:GMTS2=0  S GMTSX=+($G(GMTSX))
"RTN","GMTSPN",136,0)
 I +($G(GMTSPXGO))>0,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,MAX,+($G(GMTSX))) Q
"RTN","GMTSPN",137,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,MAX,+($G(GMTSX)))
"RTN","GMTSPN",138,0)
 Q
"RTN","GMTSPN",139,0)
FLDS(X,I) ; Get Fields
"RTN","GMTSPN",140,0)
 N GMTSDIC,GMTSIEN
"RTN","GMTSPN",141,0)
 S GMTSDIC=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)
"RTN","GMTSPN",142,0)
 Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN",143,0)
 Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN",144,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))
"RTN","GMTSPN",145,0)
 S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN",146,0)
 N GMTSXTRA S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN",147,0)
 S X=$G(@(GMTSDIC_".07,""I"")")) D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSPN",148,0)
 S X=$G(@(GMTSDIC_".08,""I"")")) D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSPN",149,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSPN",150,0)
 S:+ADMIT'>0 ADMIT="Unknown"
"RTN","GMTSPN",151,0)
 S AUTHOR=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",152,0)
 S ATTNDNG=$G(@(GMTSDIC_"1209,""E"")"))
"RTN","GMTSPN",153,0)
 S TSPEC=$G(@(GMTSDIC_"1402,""E"")"))
"RTN","GMTSPN",154,0)
 S STATUS=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",155,0)
 S PN("DATE")=$G(@(GMTSDIC_"1301,""I"")"))
"RTN","GMTSPN",156,0)
 I PN("DATE")]"" S PN("DATE")=$$EDT^GMTSU(PN("DATE"))
"RTN","GMTSPN",157,0)
 S REASON="",PN("DOCTYPE")=$G(@(GMTSDIC_".01,""E"")"))
"RTN","GMTSPN",158,0)
 S PN("STATUS")=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",159,0)
 S PN("AUTHOR")=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",160,0)
 S PN("EXPSIGNR")=$G(@(GMTSDIC_"1204,""E"")"))
"RTN","GMTSPN",161,0)
 S PN("LOC")=$G(@(GMTSDIC_"1205,""E"")"))
"RTN","GMTSPN",162,0)
 S PN("EXPCOSNR")=$G(@(GMTSDIC_"1208,""E"")"))
"RTN","GMTSPN",163,0)
 S:$G(@(GMTSDIC_"1307,""I"")"))'="" PN("DDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1307,""I"")")))
"RTN","GMTSPN",164,0)
 S:$G(@(GMTSDIC_"1501,""I"")"))'="" PN("SIGNDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1501,""I"")")))
"RTN","GMTSPN",165,0)
 S PN("SIGDT")=$G(@(GMTSDIC_"1501,""I"")"))
"RTN","GMTSPN",166,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPN",167,0)
 S SIGNEDBY=$G(@(GMTSDIC_"1502,""I"")"))
"RTN","GMTSPN",168,0)
 S PN("SIGBLK")=$G(@(GMTSDIC_"1503,""E"")"))
"RTN","GMTSPN",169,0)
 S PN("STITLE")=$G(@(GMTSDIC_"1504,""E"")"))
"RTN","GMTSPN",170,0)
 S PN("COSDT")=$G(@(GMTSDIC_"1507,""I"")"))
"RTN","GMTSPN",171,0)
 I PN("COSDT")]"" S (COSIG,PN("COSDT"))=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPN",172,0)
 S COSGEDBY=$G(@(GMTSDIC_"1508,""I"")"))
"RTN","GMTSPN",173,0)
 S CONEED=0 S:+($G(COSGEDBY))>0 CONEED=1
"RTN","GMTSPN",174,0)
 S PN("COBLK")=$G(@(GMTSDIC_"1509,""E"")"))
"RTN","GMTSPN",175,0)
 S PN("COTITLE")=$G(@(GMTSDIC_"1510,""E"")"))
"RTN","GMTSPN",176,0)
 S COSAME=$S(+($G(SIGNEDBY))>0&(+($G(SIGNEDBY))=+($G(COSGEDBY))):1,1:0)
"RTN","GMTSPN",177,0)
 S:CONEED>0 CONEED=$S(COSAME=1:0,1:CONEED)
"RTN","GMTSPN",178,0)
 S PN("SUBJ")=$G(@(GMTSDIC_"1701,""E"")"))
"RTN","GMTSPN",179,0)
 I $G(@(GMTSDIC_"1505,""I"")"))="C" D
"RTN","GMTSPN",180,0)
 . S PN("SCHART")="Signed on Chart by:",PN("SCHARTBY")="."
"RTN","GMTSPN",181,0)
 . S:$G(@(GMTSDIC_"1512,""E"")"))'="" PN("SCHARTBY")=$G(@(GMTSDIC_"1512,""E"")"))
"RTN","GMTSPN",182,0)
 I $E($G(GMTSTIUC),1)'["D",$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",183,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",184,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",185,0)
 I $E($G(GMTSTIUC),1)["D",CONEED,$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",186,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",187,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",188,0)
 S:$G(@(GMTSDIC_"1202,""I"")"))'=$G(@(GMTSDIC_"1502,""I"")")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN",189,0)
 S PN("AMENDMNT")=+($G(@(GMTSDIC_"1601,""I"")")))
"RTN","GMTSPN",190,0)
 Q
"RTN","GMTSPNB")
0^2^B7849781
"RTN","GMTSPNB",1,0)
GMTSPNB ; SLC/JER/KER - TIU Brief Progress Notes           ; 04/04/2002
"RTN","GMTSPNB",2,0)
 ;;2.7;Health Summary;**12,28,33,49,53**;Oct 20, 1995
"RTN","GMTSPNB",3,0)
 ;                   
"RTN","GMTSPNB",4,0)
 ; External References
"RTN","GMTSPNB",5,0)
 ;   DBIA 10006  ^DIC  (file #8925.1)
"RTN","GMTSPNB",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPNB",7,0)
 ;   DBIA  2902  VISIT^TIULAPIC
"RTN","GMTSPNB",8,0)
 ;   DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSPNB",9,0)
 ;                    
"RTN","GMTSPNB",10,0)
MAIN ; Controls branching and execution
"RTN","GMTSPNB",11,0)
 N PN,GMTSI,GMTSJ,TIUFPRIV,TIUSTAT,TIUTYPE,X,DIWF,DIWL,DIWR,MAX
"RTN","GMTSPNB",12,0)
 K ^TMP("TIU",$J) S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSPNB",13,0)
 S TIUSTAT="COMPLETED",TIUFPRIV=1
"RTN","GMTSPNB",14,0)
 N X,Y S X="PROGRESS NOTES",DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL""" D ^DIC S:Y>0 TIUTYPE=+Y
"RTN","GMTSPNB",15,0)
 D EXTIU(DFN,TIUTYPE,GMTS1,GMTS2,MAX,0) Q:'$D(^TMP("TIU",$J))
"RTN","GMTSPNB",16,0)
 D HEADER S GMTSI=0 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",17,0)
 . S GMTSJ=0 F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",18,0)
 . . D VARI(GMTSI,GMTSJ)
"RTN","GMTSPNB",19,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND(GMTSI,GMTSJ)
"RTN","GMTSPNB",20,0)
 . . D WRT
"RTN","GMTSPNB",21,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNB",22,0)
 Q
"RTN","GMTSPNB",23,0)
 ;
"RTN","GMTSPNB",24,0)
HEADER ; Prints header
"RTN","GMTSPNB",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Prog Note DT",?16,"Title",?48,"Author",?64,"Last Corr DT",!!
"RTN","GMTSPNB",26,0)
 Q
"RTN","GMTSPNB",27,0)
 ;
"RTN","GMTSPNB",28,0)
VARI(GMTSI,GMTSJ) ;Sets variables for display
"RTN","GMTSPNB",29,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPNB",30,0)
 S X=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")) D REGDT4^GMTSU S PN("DATE")=X
"RTN","GMTSPNB",31,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSPNB",32,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSPNB",33,0)
 I $L(PN("DOCTYPE"))>30 D FORMAT S PN("DOCTYPE")=^UTILITY($J,"W",1,1,0)
"RTN","GMTSPNB",34,0)
 S PN("CORRDT")=""
"RTN","GMTSPNB",35,0)
 Q
"RTN","GMTSPNB",36,0)
 ;
"RTN","GMTSPNB",37,0)
ADDEND(GMTSI,GMTSJ) ;Addenda date display
"RTN","GMTSPNB",38,0)
 N GMTSAD
"RTN","GMTSPNB",39,0)
 S GMTSAD=0
"RTN","GMTSPNB",40,0)
 S GMTSAD=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD)) Q:+GMTSAD'>0 
"RTN","GMTSPNB",41,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD,1301,"I")
"RTN","GMTSPNB",42,0)
 D REGDT4^GMTSU S PN("CORRDT")=X
"RTN","GMTSPNB",43,0)
 Q
"RTN","GMTSPNB",44,0)
 ;
"RTN","GMTSPNB",45,0)
WRT ; Writes the component data
"RTN","GMTSPNB",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPNB",47,0)
 D:GMTSNPG HEADER W PN("DATE"),?16,PN("DOCTYPE"),?48,PN("AUTHOR"),?64,PN("CORRDT"),!
"RTN","GMTSPNB",48,0)
 I $D(^UTILITY($J,"W",1,2,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,^UTILITY($J,"W",1,2,0),!
"RTN","GMTSPNB",49,0)
 K PN,^UTILITY($J)
"RTN","GMTSPNB",50,0)
 Q
"RTN","GMTSPNB",51,0)
 ;
"RTN","GMTSPNB",52,0)
FORMAT ; Calls ^DIWP to format Title
"RTN","GMTSPNB",53,0)
 N DIWF,DIWL,DIWR,X
"RTN","GMTSPNB",54,0)
 S DIWF="C30",DIWL=1,DIWR=30,X=PN("DOCTYPE") D ^DIWP
"RTN","GMTSPNB",55,0)
 Q
"RTN","GMTSPNB",56,0)
EXTIU(DFN,GMTST,GMTS1,GMTS2,GMTSN,GMTSX) ; Extract Patient/Visit VIA TIU
"RTN","GMTSPNB",57,0)
 N GMTSPV S GMTSPV=+($G(GMTSPXGO)) I GMTSPV,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX)) Q
"RTN","GMTSPNB",58,0)
 D MAIN^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX))
"RTN","GMTSPNB",59,0)
 Q
"VER")
8.0^22.0
**END**
**END**
