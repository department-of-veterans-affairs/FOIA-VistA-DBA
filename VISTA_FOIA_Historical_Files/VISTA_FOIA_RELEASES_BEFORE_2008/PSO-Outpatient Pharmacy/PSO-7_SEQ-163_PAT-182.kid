Released PSO*7*182 SEQ #163
Extracted from mail message
**KIDS**:PSO*7.0*182^

**INSTALL NAME**
PSO*7.0*182
"BLD",1050,0)
PSO*7.0*182^OUTPATIENT PHARMACY^0^3040914^y
"BLD",1050,1,0)
^^32^32^3040719^
"BLD",1050,1,1,0)
WPB-0304-31149
"BLD",1050,1,2,0)
When a partial is processed for a Scriptalk patient, the scriptalk 
"BLD",1050,1,3,0)
printer label generated prints with the full quantity instead of the 
"BLD",1050,1,4,0)
partial quantity. This issue is resolved with this patch.
"BLD",1050,1,5,0)
 
"BLD",1050,1,6,0)
CLE-0304-40723
"BLD",1050,1,7,0)
Problem: For a Scriptalk patient, if the sig is greater than 196 
"BLD",1050,1,8,0)
characters and the scriptalk label is printed, it truncates the sig.
"BLD",1050,1,9,0)
 
"BLD",1050,1,10,0)
Solution: For a Scriptalk patient, if the sig is greater than 196 
"BLD",1050,1,11,0)
characters and the scriptalk label is printed, the human readable section 
"BLD",1050,1,12,0)
will print in English and its Spanish translation as follows:
"BLD",1050,1,13,0)
 
"BLD",1050,1,14,0)
"SIG IS TOO LONG. REPRINT A NON-VOIDED VISTA LABEL AND PLACE OVER THIS 
"BLD",1050,1,15,0)
SCRIPTALK LABEL"
"BLD",1050,1,16,0)
 
"BLD",1050,1,17,0)
"INDICACIONES MUY LARGAS. IMPRIMA UNA ETIQUETA DE VISTA VALIDA Y 
"BLD",1050,1,18,0)
APLIQUELA SOBRE ESTA ETIQUETA DE SCRIPTALK EN LA BOTELLA."
"BLD",1050,1,19,0)
 
"BLD",1050,1,20,0)
HIN-0104-41546
"BLD",1050,1,21,0)
When using [PSO SCRIPTALK PATIENT ENROLL ] option, the message displayed 
"BLD",1050,1,22,0)
is offset and incomplete. This patch will display the full message.
"BLD",1050,1,23,0)
 
"BLD",1050,1,24,0)
BIG-0404-70352
"BLD",1050,1,25,0)
1. When a patient has more than one eligibility code defined and the 
"BLD",1050,1,26,0)
patient profile is accessed using the [PSO LM BACKDOOR ORDERS] option, it 
"BLD",1050,1,27,0)
only displays one eligibility.
"BLD",1050,1,28,0)
 
"BLD",1050,1,29,0)
2. When the patient status is not defined, and the patient is accessed, it
"BLD",1050,1,30,0)
only displays one eligibility. 
"BLD",1050,1,31,0)
 
"BLD",1050,1,32,0)
This patch will display multiple eligibilities defined for the patient.
"BLD",1050,4,0)
^9.64PA^^
"BLD",1050,"ABPKG")
n
"BLD",1050,"KRN",0)
^9.67PA^8989.52^19
"BLD",1050,"KRN",.4,0)
.4
"BLD",1050,"KRN",.401,0)
.401
"BLD",1050,"KRN",.402,0)
.402
"BLD",1050,"KRN",.403,0)
.403
"BLD",1050,"KRN",.5,0)
.5
"BLD",1050,"KRN",.84,0)
.84
"BLD",1050,"KRN",3.6,0)
3.6
"BLD",1050,"KRN",3.8,0)
3.8
"BLD",1050,"KRN",9.2,0)
9.2
"BLD",1050,"KRN",9.8,0)
9.8
"BLD",1050,"KRN",9.8,"NM",0)
^9.68A^7^5
"BLD",1050,"KRN",9.8,"NM",3,0)
PSOORUT2^^0^B23696740
"BLD",1050,"KRN",9.8,"NM",4,0)
PSORX1^^0^B43907191
"BLD",1050,"KRN",9.8,"NM",5,0)
PSOTALK^^0^B74973185
"BLD",1050,"KRN",9.8,"NM",6,0)
PSOTALK2^^0^B61754763
"BLD",1050,"KRN",9.8,"NM",7,0)
PSOTPRX1^^0^B51067568
"BLD",1050,"KRN",9.8,"NM","B","PSOORUT2",3)

"BLD",1050,"KRN",9.8,"NM","B","PSORX1",4)

"BLD",1050,"KRN",9.8,"NM","B","PSOTALK",5)

"BLD",1050,"KRN",9.8,"NM","B","PSOTALK2",6)

"BLD",1050,"KRN",9.8,"NM","B","PSOTPRX1",7)

"BLD",1050,"KRN",19,0)
19
"BLD",1050,"KRN",19.1,0)
19.1
"BLD",1050,"KRN",101,0)
101
"BLD",1050,"KRN",409.61,0)
409.61
"BLD",1050,"KRN",771,0)
771
"BLD",1050,"KRN",870,0)
870
"BLD",1050,"KRN",8989.51,0)
8989.51
"BLD",1050,"KRN",8989.52,0)
8989.52
"BLD",1050,"KRN",8994,0)
8994
"BLD",1050,"KRN","B",.4,.4)

"BLD",1050,"KRN","B",.401,.401)

"BLD",1050,"KRN","B",.402,.402)

"BLD",1050,"KRN","B",.403,.403)

"BLD",1050,"KRN","B",.5,.5)

"BLD",1050,"KRN","B",.84,.84)

"BLD",1050,"KRN","B",3.6,3.6)

"BLD",1050,"KRN","B",3.8,3.8)

"BLD",1050,"KRN","B",9.2,9.2)

"BLD",1050,"KRN","B",9.8,9.8)

"BLD",1050,"KRN","B",19,19)

"BLD",1050,"KRN","B",19.1,19.1)

"BLD",1050,"KRN","B",101,101)

"BLD",1050,"KRN","B",409.61,409.61)

"BLD",1050,"KRN","B",771,771)

"BLD",1050,"KRN","B",870,870)

"BLD",1050,"KRN","B",8989.51,8989.51)

"BLD",1050,"KRN","B",8989.52,8989.52)

"BLD",1050,"KRN","B",8994,8994)

"BLD",1050,"QUES",0)
^9.62^^
"BLD",1050,"REQB",0)
^9.611^3^2
"BLD",1050,"REQB",2,0)
PSO*7.0*135^2
"BLD",1050,"REQB",3,0)
PSO*7.0*132^2
"BLD",1050,"REQB","B","PSO*7.0*132",3)

"BLD",1050,"REQB","B","PSO*7.0*135",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
7.0^3011218^2980805^5
"PKG",16,22,1,"PAH",1,0)
182^3040914
"PKG",16,22,1,"PAH",1,1,0)
^^32^32^3040914
"PKG",16,22,1,"PAH",1,1,1,0)
WPB-0304-31149
"PKG",16,22,1,"PAH",1,1,2,0)
When a partial is processed for a Scriptalk patient, the scriptalk 
"PKG",16,22,1,"PAH",1,1,3,0)
printer label generated prints with the full quantity instead of the 
"PKG",16,22,1,"PAH",1,1,4,0)
partial quantity. This issue is resolved with this patch.
"PKG",16,22,1,"PAH",1,1,5,0)
 
"PKG",16,22,1,"PAH",1,1,6,0)
CLE-0304-40723
"PKG",16,22,1,"PAH",1,1,7,0)
Problem: For a Scriptalk patient, if the sig is greater than 196 
"PKG",16,22,1,"PAH",1,1,8,0)
characters and the scriptalk label is printed, it truncates the sig.
"PKG",16,22,1,"PAH",1,1,9,0)
 
"PKG",16,22,1,"PAH",1,1,10,0)
Solution: For a Scriptalk patient, if the sig is greater than 196 
"PKG",16,22,1,"PAH",1,1,11,0)
characters and the scriptalk label is printed, the human readable section 
"PKG",16,22,1,"PAH",1,1,12,0)
will print in English and its Spanish translation as follows:
"PKG",16,22,1,"PAH",1,1,13,0)
 
"PKG",16,22,1,"PAH",1,1,14,0)
"SIG IS TOO LONG. REPRINT A NON-VOIDED VISTA LABEL AND PLACE OVER THIS 
"PKG",16,22,1,"PAH",1,1,15,0)
SCRIPTALK LABEL"
"PKG",16,22,1,"PAH",1,1,16,0)
 
"PKG",16,22,1,"PAH",1,1,17,0)
"INDICACIONES MUY LARGAS. IMPRIMA UNA ETIQUETA DE VISTA VALIDA Y 
"PKG",16,22,1,"PAH",1,1,18,0)
APLIQUELA SOBRE ESTA ETIQUETA DE SCRIPTALK EN LA BOTELLA."
"PKG",16,22,1,"PAH",1,1,19,0)
 
"PKG",16,22,1,"PAH",1,1,20,0)
HIN-0104-41546
"PKG",16,22,1,"PAH",1,1,21,0)
When using [PSO SCRIPTALK PATIENT ENROLL ] option, the message displayed 
"PKG",16,22,1,"PAH",1,1,22,0)
is offset and incomplete. This patch will display the full message.
"PKG",16,22,1,"PAH",1,1,23,0)
 
"PKG",16,22,1,"PAH",1,1,24,0)
BIG-0404-70352
"PKG",16,22,1,"PAH",1,1,25,0)
1. When a patient has more than one eligibility code defined and the 
"PKG",16,22,1,"PAH",1,1,26,0)
patient profile is accessed using the [PSO LM BACKDOOR ORDERS] option, it 
"PKG",16,22,1,"PAH",1,1,27,0)
only displays one eligibility.
"PKG",16,22,1,"PAH",1,1,28,0)
 
"PKG",16,22,1,"PAH",1,1,29,0)
2. When the patient status is not defined, and the patient is accessed, it
"PKG",16,22,1,"PAH",1,1,30,0)
only displays one eligibility. 
"PKG",16,22,1,"PAH",1,1,31,0)
 
"PKG",16,22,1,"PAH",1,1,32,0)
This patch will display multiple eligibilities defined for the patient.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSOORUT2")
0^3^B23696740
"RTN","PSOORUT2",1,0)
PSOORUT2 ;ISC BHAM/SAB - build listman screen ;02/22/95
"RTN","PSOORUT2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,132,182**;DEC 1997
"RTN","PSOORUT2",3,0)
 ;External reference to SDPHARM1 supported by DBIA 4196
"RTN","PSOORUT2",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORUT2",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSOORUT2",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSOORUT2",7,0)
 ;
"RTN","PSOORUT2",8,0)
 K ^TMP("PSOHDR",$J),^TMP("PSOPI",$J) S DFN=PSODFN D ^VADPT,ADD^VADPT
"RTN","PSOORUT2",9,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOORUT2",10,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOORUT2",11,0)
 D NVA
"RTN","PSOORUT2",12,0)
 S POERR=1 D RE^PSODEM K POERR
"RTN","PSOORUT2",13,0)
 S ^TMP("PSOHDR",$J,6,0)=$S($P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOORUT2",14,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOORUT2",15,0)
 S GMRA="0^0^111" D ^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOORUT2",16,0)
 S $P(^TMP("PSOHDR",$J,9,0)," ",62)="ISSUE  LAST REF DAY"
"RTN","PSOORUT2",17,0)
 S ^TMP("PSOHDR",$J,10,0)=" #  RX #         DRUG                                 QTY ST  DATE  FILL REM SUP"
"RTN","PSOORUT2",18,0)
 D ELIG^VADPT S IEN=1,^TMP("PSOPI",$J,IEN,0)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:""),IEN=IEN+1
"RTN","PSOORUT2",19,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  S $P(^TMP("PSOPI",$J,IEN,0)," ",14)=$P(VAEL(1,N),"^",2),IEN=IEN+1
"RTN","PSOORUT2",20,0)
 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Disabilities: "
"RTN","PSOORUT2",21,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOORUT2",22,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOORUT2",23,0)
 .S:$L(^TMP("PSOPI",$J,IEN,0)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 IEN=IEN+1,$P(^TMP("PSOPI",$J,IEN,0)," ",14)=" "
"RTN","PSOORUT2",24,0)
 .S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOORUT2",25,0)
 S IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1
"RTN","PSOORUT2",26,0)
 I +VAPA(9),+VAPA(10) S ^TMP("PSOPI",$J,IEN,0)="      (Temp Address from "_$P(VAPA(9),"^",2)_" till "_$P(VAPA(10),"^",2)_")",IEN=IEN+1
"RTN","PSOORUT2",27,0)
 S ^TMP("PSOPI",$J,IEN,0)=VAPA(1) S:VAPA(2)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(2) S:VAPA(3)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(3)
"RTN","PSOORUT2",28,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(4),$P(^TMP("PSOPI",$J,IEN,0)," ",40)="PHONE: "_VAPA(8)
"RTN","PSOORUT2",29,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6))
"RTN","PSOORUT2",30,0)
 S MAILD=+$P($G(^PS(55,DFN,0)),"^",3) D  K MAILD
"RTN","PSOORUT2",31,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Prescription Mail Delivery: "_$S(MAILD=1:"Certified Mail",MAILD=2:"DO NOT MAIL",MAILD=3:"Local - Regular Mail",MAILD=4:"Local - Certified Mail",1:"Regular Mail")
"RTN","PSOORUT2",32,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$S($P($G(^PS(55,DFN,0)),"^",2):"Cannot use safety caps.",1:"") S $P(^TMP("PSOPI",$J,IEN,0)," ",40)=$S($P($G(^PS(55,DFN,0)),"^",4):"Dialysis Patient.",1:"")
"RTN","PSOORUT2",33,0)
 I $G(^PS(55,DFN,1))]"" S PSON=^(1),IEN=IEN+1 D
"RTN","PSOORUT2",34,0)
 .S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="     Outpatient Narrative: "
"RTN","PSOORUT2",35,0)
 .F I=1:1 Q:$P(PSON," ",I,99)=""  S:$L(^TMP("PSOPI",$J,IEN,0)_$P(PSON," ",I)_" ")>80 IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_$P(PSON," ",I)_" "
"RTN","PSOORUT2",36,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",37,0)
 I $D(^PS(52.91,DFN,0)) I '$P(^(0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOORUT2",38,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Primary Care Appointment: "_$$PRIAPT^SDPHARM1(DFN)
"RTN","PSOORUT2",39,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",40,0)
 I 'GMRAL D
"RTN","PSOORUT2",41,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Allergies: "_$S(GMRAL=0:"NKA",1:""),IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",42,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Adverse Reactions:"
"RTN","PSOORUT2",43,0)
 D:$G(GMRAL) ^PSOORUT3
"RTN","PSOORUT2",44,0)
 K ^UTILITY("VASD",$J),VASD S DFN=PSODFN,VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D SDA^VADPT K VASD I $D(^UTILITY("VASD",$J)) D
"RTN","PSOORUT2",45,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Pending Clinic Appointments:"
"RTN","PSOORUT2",46,0)
 .F PSOAPP=0:0 S PSOAPP=$O(^UTILITY("VASD",$J,PSOAPP)) Q:'PSOAPP  S PSOAPPE=$G(^UTILITY("VASD",$J,PSOAPP,"E")),PSOAPPI=$G(^("I")) D
"RTN","PSOORUT2",47,0)
 ..K X S X2=DT,X1=$P($P($G(PSOAPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOORUT2",48,0)
 ..S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="    "_$P(PSOAPPE,"^")_"  "_$P(PSOAPPE,"^",2)_$S($P(PSOAPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOORUT2",49,0)
 K ^UTILITY("VASD",$J),X,PSOAPPI,PSOAPPE,PSOAPP,N
"RTN","PSOORUT2",50,0)
 S PSOPI=IEN K IEN
"RTN","PSOORUT2",51,0)
 Q
"RTN","PSOORUT2",52,0)
NVA ;
"RTN","PSOORUT2",53,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))
"RTN","PSOORUT2",54,0)
 K LSTDT F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D
"RTN","PSOORUT2",55,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",I,0),"^")
"RTN","PSOORUT2",56,0)
 .I $P(^PS(55,PSODFN,"NVA",I,0),"^",10)>+$G(LSTDT) S LSTDT=$P(^(0),"^",10)
"RTN","PSOORUT2",57,0)
 I $G(LSTDT)]"" D
"RTN","PSOORUT2",58,0)
 .S LSTDT="Non-VA Meds on File - Last entry on "_$E(LSTDT,4,5)_"/"_$E(LSTDT,6,7)_"/"_$E(LSTDT,2,3)
"RTN","PSOORUT2",59,0)
 .I $G(^TMP("PSOHDR",$J,5,0))="MALE" S $P(^TMP("PSOHDR",$J,5,0)," ",22)=LSTDT K LSTDT Q
"RTN","PSOORUT2",60,0)
 .S $P(^TMP("PSOHDR",$J,5,0)," ",20)=LSTDT K LSTDT
"RTN","PSOORUT2",61,0)
 K I
"RTN","PSOORUT2",62,0)
 Q
"RTN","PSORX1")
0^4^B43907191
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;07/25/96
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182**;DEC 1997
"RTN","PSORX1",3,0)
 ;External reference PDA^PPPPDA1 supported by DBIA 1374
"RTN","PSORX1",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",7,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",8,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",9,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",10,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",11,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",12,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",13,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX S PSOPBM1=1
"RTN","PSORX1",14,0)
 G:$G(NOBG) NX
"RTN","PSORX1",15,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",16,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",17,0)
 I $G(PSOPBM),$G(PSOPBM1) S $P(^PS(55,PSODFN,0),"^",7)=PSOPBM,$P(^(0),"^",8)="A" K PSOPBM,PSOPBM1
"RTN","PSORX1",18,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",19,0)
 D EOJ G START
"RTN","PSORX1",20,0)
END Q
"RTN","PSORX1",21,0)
 ;---------------------------------------------------------
"RTN","PSORX1",22,0)
INIT ;
"RTN","PSORX1",23,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",24,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",25,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",26,0)
INITX Q
"RTN","PSORX1",27,0)
 ;
"RTN","PSORX1",28,0)
PT ;
"RTN","PSORX1",29,0)
 K ^TMP("PSORXDC",$J),CLOZPAT,DIC,PSODFN,PSOPBM,PSOPBM1 S PSORX("QFLG")=0,DIC=2,DIC(0)="QEAM" D ^DIC K DIC,DA
"RTN","PSORX1",30,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",31,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",32,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",33,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !,"Patient has another language preference!",! H 3
"RTN","PSORX1",34,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",35,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",36,0)
 I '$G(MEDP) S X="PPPPDA1" X ^%ZOSF("TEST") S:$T X=$$PDA^PPPPDA1(PSODFN)
"RTN","PSORX1",37,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",38,0)
 I $G(PSOFIN) S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",39,0)
 K PSOPBM ; KILL SO THAT WON'T CARRY OVER PRIOR PATIENT'S VALUE
"RTN","PSORX1",40,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",41,0)
 .S PSOPBM=$P(TM,".")
"RTN","PSORX1",42,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",43,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",44,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",45,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",46,0)
 .L +^PS(55,PSODFN):0 I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",47,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",48,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",49,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",50,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",51,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",52,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",53,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",54,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",55,0)
 ..I $G(PSOPBM) D  K PSOPBM
"RTN","PSORX1",56,0)
 ...I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",57,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",58,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",59,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",60,0)
 I '$G(PSOPBM),'$P(^PS(55,PSODFN,0),"^",7),$P(^(0),"^",8)']"" S PSOPBM=$P(TM,".")
"RTN","PSORX1",61,0)
 D ^PSOBUILD
"RTN","PSORX1",62,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",63,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",64,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",65,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",66,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",67,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",68,0)
PTX ;
"RTN","PSORX1",69,0)
 K X,Y,^TMP("PS",$J),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR
"RTN","PSORX1",70,0)
 Q
"RTN","PSORX1",71,0)
EOJ ;
"RTN","PSORX1",72,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC,PSOPBM
"RTN","PSORX1",73,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",74,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",75,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",76,0)
 K ^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J) I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",77,0)
 K PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG
"RTN","PSORX1",78,0)
 Q
"RTN","PSORX1",79,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",80,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",81,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",82,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",83,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",84,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",85,0)
 K N
"RTN","PSORX1",86,0)
 Q
"RTN","PSORX1",87,0)
PROFILE ;
"RTN","PSORX1",88,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",89,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",90,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",91,0)
 K PSOX
"RTN","PSORX1",92,0)
PROFILEX Q
"RTN","PSORX1",93,0)
 ;
"RTN","PSORX1",94,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",95,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",96,0)
 N MAIL
"RTN","PSORX1",97,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",98,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSORX1",99,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",100,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",101,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",102,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",103,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",104,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",105,0)
 Q
"RTN","PSOTALK")
0^5^B74973185
"RTN","PSOTALK",1,0)
PSOTALK ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA ;04/18/2003
"RTN","PSOTALK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182**;DEC 1997
"RTN","PSOTALK",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOTALK",5,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK",6,0)
EN Q:'$$PAT55  ; QUIT IF NOT A SCRIPTALK ELIGIBLE PATIENT
"RTN","PSOTALK",7,0)
 S PSOSTALK=1
"RTN","PSOTALK",8,0)
 N PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,LINE
"RTN","PSOTALK",9,0)
 D GATHER,TRANS,CLEAN
"RTN","PSOTALK",10,0)
 Q
"RTN","PSOTALK",11,0)
 ;
"RTN","PSOTALK",12,0)
CLEAN K PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,VADM
"RTN","PSOTALK",13,0)
 K PSOCTP,PSOCTV,XMIT,PSORCT,PSOTSSN,PSOEXPDT
"RTN","PSOTALK",14,0)
 K PSOLNE,PSOLEN,PSOLINE,PSOWORD,PSOWDS,LINE
"RTN","PSOTALK",15,0)
 K PSOSIG1,PSOLSIG,PSOSIG,PSOSTOP
"RTN","PSOTALK",16,0)
 Q
"RTN","PSOTALK",17,0)
BARE N RX
"RTN","PSOTALK",18,0)
 D CLEAN
"RTN","PSOTALK",19,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQM" D ^DIC K DIC Q:Y<0  S RX=+Y
"RTN","PSOTALK",20,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",21,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BAREO
"RTN","PSOTALK",22,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BAREO
"RTN","PSOTALK",23,0)
 D GATHER
"RTN","PSOTALK",24,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",25,0)
 D TRANS
"RTN","PSOTALK",26,0)
BAREO D CLEAN
"RTN","PSOTALK",27,0)
 W !!
"RTN","PSOTALK",28,0)
 G BARE
"RTN","PSOTALK",29,0)
 Q
"RTN","PSOTALK",30,0)
BARI N RX
"RTN","PSOTALK",31,0)
 D CLEAN
"RTN","PSOTALK",32,0)
 S RX=$$READER^PSOTALK1("FO^1:12","Enter Barcode Rx#")
"RTN","PSOTALK",33,0)
 Q:RX']""
"RTN","PSOTALK",34,0)
 G:RX'["-" BARIO
"RTN","PSOTALK",35,0)
 S RX=$P(RX,"-",2)
"RTN","PSOTALK",36,0)
 I '$D(^PSRX(RX,0)) W !,"Prescription not on file" G BARIO
"RTN","PSOTALK",37,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BARIO
"RTN","PSOTALK",38,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BARIO
"RTN","PSOTALK",39,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",40,0)
 D GATHER
"RTN","PSOTALK",41,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",42,0)
 D TRANS
"RTN","PSOTALK",43,0)
BARIO D CLEAN
"RTN","PSOTALK",44,0)
 W !!
"RTN","PSOTALK",45,0)
 G BARI
"RTN","PSOTALK",46,0)
 Q
"RTN","PSOTALK",47,0)
GATHER ;
"RTN","PSOTALK",48,0)
 N DFN
"RTN","PSOTALK",49,0)
 S DFN=$P(^PSRX(RX,0),"^",2)
"RTN","PSOTALK",50,0)
 D DEM^VADPT
"RTN","PSOTALK",51,0)
 S PHONE=$$PHONE
"RTN","PSOTALK",52,0)
 S RXNUM=+$$RXNUM
"RTN","PSOTALK",53,0)
 S RXALPHA=$$RXALPHA
"RTN","PSOTALK",54,0)
 S DATE=$$DATE
"RTN","PSOTALK",55,0)
 S FILLS=$$RFILLS I $L(RFILLS)=1 S FILLS="0"_FILLS
"RTN","PSOTALK",56,0)
 S PTNAME=VADM(1) D
"RTN","PSOTALK",57,0)
 .N FNAM,MI
"RTN","PSOTALK",58,0)
 .S FNAM=$P(PTNAME,",",2) I FNAM[" " D
"RTN","PSOTALK",59,0)
 ..S MI=$P(FNAM," ",2,99) I MI[" " S MI=$P(MI," ")
"RTN","PSOTALK",60,0)
 ..S FNAM=$P(FNAM," ")
"RTN","PSOTALK",61,0)
 .S PTNAME=FNAM_$S($G(MI)'="":" "_MI,1:"")_" "_$P(PTNAME,",")
"RTN","PSOTALK",62,0)
 .S PTNAME=$$UP^XLFSTR(PTNAME)
"RTN","PSOTALK",63,0)
 .S PTNAME=$TR(PTNAME,"-"," ")
"RTN","PSOTALK",64,0)
 .S PTNAME=$TR(PTNAME,".","")
"RTN","PSOTALK",65,0)
 .S PTNAME=$TR(PTNAME,"'"," ")
"RTN","PSOTALK",66,0)
 S SIG=$TR($$UP^XLFSTR($$SIGPOE),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",67,0)
 S SIGX=$TR($$UP^XLFSTR($$SIGPOEX),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",68,0)
 S PROV=$E($$UP^XLFSTR($$PROV),1,30)
"RTN","PSOTALK",69,0)
 S DRUG=$TR($$UP^XLFSTR($$DRUG),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",70,0)
 S WARN=$$WARN
"RTN","PSOTALK",71,0)
 D PSOEXP
"RTN","PSOTALK",72,0)
 S LINE(1)="VAMC "_$$CITY_", "_$$STATE_"  "_$$ZIP
"RTN","PSOTALK",73,0)
 S LINE(2)=$$SITE_" ("_$$CLERK_"/"_$$VRPH_") "_$$ACODE_"-"_$$EPHON_" Exp: "_PSOEXPDT
"RTN","PSOTALK",74,0)
 S LINE(3)="Rx# "_$$RXNUM_"  "_$$EDATE_"  Fill "_$$FILNO_" of "_$$TFILLS
"RTN","PSOTALK",75,0)
 S LINE(4)=$$EPAT_"  "_$$LAST6
"RTN","PSOTALK",76,0)
 D INST^PSOTALK1 S LINE(5)=$G(PSOLNE(1)),LINE(6)=$G(PSOLNE(2)),LINE(7)=$G(PSOLNE(3))
"RTN","PSOTALK",77,0)
 S LINE(8)=$$EPROV,LINE(10)=$$DRUG
"RTN","PSOTALK",78,0)
 S LINE(9)="Qty: "_$$QTY_"  "_$$DF
"RTN","PSOTALK",79,0)
 Q
"RTN","PSOTALK",80,0)
TRANS S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U),ZTDTH=$$NOW^XLFDT,ZTDESC="Scriptalk Interface Transmission"  ; CHANGE DEVICE TO BE DIVISIONAL BY FILE 59 RMS/HINES 6-5-01
"RTN","PSOTALK",81,0)
 Q:ZTIO="`"
"RTN","PSOTALK",82,0)
 S ZTRTN="GO^PSOTALK",ZTSAVE("*")=""
"RTN","PSOTALK",83,0)
 D ^%ZTLOAD
"RTN","PSOTALK",84,0)
 Q
"RTN","PSOTALK",85,0)
 ;
"RTN","PSOTALK",86,0)
GO W !,"^XA",!,"^FO250,700^XGE:RX.GRF^FS"  ;;1.2e 4-17-02 TO MOVE GRAPHIC
"RTN","PSOTALK",87,0)
 D OVERLAY,PICOTAG  ;;FOR LARGER LABELS
"RTN","PSOTALK",88,0)
 W !,"^PQ1,0,1,Y",!,"^XZ"  ;;FOR LARGER LABELS
"RTN","PSOTALK",89,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK",90,0)
 Q
"RTN","PSOTALK",91,0)
 ;
"RTN","PSOTALK",92,0)
OVERLAY F PSOLINE=1:1:7 D DEFLINE((9+((20-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",93,0)
 F PSOLINE=8:1:10 D DEFLINE((9+((19-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",94,0)
 Q
"RTN","PSOTALK",95,0)
 ;
"RTN","PSOTALK",96,0)
DEFLINE(XCORD,YCORD,PRTOUT,FIELDNO,OFFSET) ;
"RTN","PSOTALK",97,0)
 W !,"^AFR,20,10^FO"_XCORD_","_YCORD_"^FR^CI0^FD"_PRTOUT_"^FS"
"RTN","PSOTALK",98,0)
 Q
"RTN","PSOTALK",99,0)
 ;
"RTN","PSOTALK",100,0)
PICOTAG S PSOCTP=1
"RTN","PSOTALK",101,0)
 S DRUG=$E(DRUG,1,39)  ;1.2c*1 TEMPORARY FIX FOR DRUG TRUNCATE AT 39
"RTN","PSOTALK",102,0)
 F XMIT=PTNAME,DRUG,SIGX,DATE,FILLS,WARN,PROV,PHONE,RXNUM,RXALPHA D XMITP
"RTN","PSOTALK",103,0)
 Q
"RTN","PSOTALK",104,0)
 ;
"RTN","PSOTALK",105,0)
XMITP W !,"^RX"_$S(PSOCTP<10:"0",1:"")_PSOCTP_","_XMIT_"^FS"
"RTN","PSOTALK",106,0)
 S PSOCTP=PSOCTP+1
"RTN","PSOTALK",107,0)
 Q
"RTN","PSOTALK",108,0)
ID() I $$PAT55 Q "+SCRIPTALK"
"RTN","PSOTALK",109,0)
 E  Q ""
"RTN","PSOTALK",110,0)
AUTO ;;v1.2c - LABEL REPRINTING FUNCTIONS 3-12-02
"RTN","PSOTALK",111,0)
 Q:$G(PSOTREP)  ;NO AUTO-PRINT DURING REGULAR NON-VOIDED LABEL REPRINT
"RTN","PSOTALK",112,0)
 I $P($G(^PS(59,+PSOSITE,"STALK")),U,2)="A" D EN
"RTN","PSOTALK",113,0)
 Q
"RTN","PSOTALK",114,0)
 ;
"RTN","PSOTALK",115,0)
PAT55() Q +$G(^PS(55,"ASTALK",$P(^PSRX(RX,0),"^",2)))  ;IS PATIENT ENROLLED (NEW FIELD POSITION 2-12-02 RMS UPDATE v1.2b)
"RTN","PSOTALK",116,0)
PHONE() ;changes below 1.2c*1 to swap to site signed-on vs. site from Rx
"RTN","PSOTALK",117,0)
 Q $E($P(^PS(59,+PSOSITE,0),"^",3),1,3)_$E($TR($P(^PS(59,+PSOSITE,0),"^",4),"-,",""),1,7) ; RX DIVISION PHONE NUMBER
"RTN","PSOTALK",118,0)
CITY() Q $P(^PS(59,+PSOSITE,0),"^",7)
"RTN","PSOTALK",119,0)
STATE() Q $P(^DIC(5,$P(^PS(59,+PSOSITE,0),"^",8),0),"^",2)
"RTN","PSOTALK",120,0)
ZIP() Q $P(^PS(59,+PSOSITE,0),"^",5)
"RTN","PSOTALK",121,0)
SITE() Q $P(^PS(59,+PSOSITE,0),"^",6)
"RTN","PSOTALK",122,0)
ACODE() Q $P(^PS(59,+PSOSITE,0),"^",3)
"RTN","PSOTALK",123,0)
EPHON() Q $P(^PS(59,+PSOSITE,0),"^",4)
"RTN","PSOTALK",124,0)
CLERK() Q $P($G(^PSRX(RX,"OR1")),"^",5)
"RTN","PSOTALK",125,0)
PSOEXP ;
"RTN","PSOTALK",126,0)
 N X1,X2,X S X1=DT,X2=365 D C^%DTC S PSOEXPDT=X
"RTN","PSOTALK",127,0)
 S PSOEXPDT=$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3)
"RTN","PSOTALK",128,0)
 Q
"RTN","PSOTALK",129,0)
VRPH() Q $P($G(^PSRX(RX,2)),"^",10)
"RTN","PSOTALK",130,0)
RXNUM() Q $P(^PSRX(RX,0),"^",1) ;RETURN RX EXTERNAL NUMBER
"RTN","PSOTALK",131,0)
RXALPHA() ;RETURN RENEWAL LETTER OR SPACE CHARACTER
"RTN","PSOTALK",132,0)
 N RXALPHA
"RTN","PSOTALK",133,0)
 S RXALPHA=$E($P(^PSRX(RX,0),"^",1),$L($P(^PSRX(RX,0),"^",1)))
"RTN","PSOTALK",134,0)
 Q $S(RXALPHA?1A:RXALPHA,1:" ")
"RTN","PSOTALK",135,0)
DATE() ;CHANGED 7-30-01 TO USE EDATE FORMAT ALSO WHEN SPEAKING
"RTN","PSOTALK",136,0)
 S EDATE=$P(^PSRX(RX,3),"^")
"RTN","PSOTALK",137,0)
 Q $E(EDATE,4,5)_$E(EDATE,6,7)_$E(EDATE,2,3)
"RTN","PSOTALK",138,0)
EDATE() Q $$FMTE^XLFDT($P(^PSRX(RX,3),"^"))  ; EXTERNAL DATE / LAST DISPENSED
"RTN","PSOTALK",139,0)
FILLS() Q $G(RXF)+1 ; FILL COUNT
"RTN","PSOTALK",140,0)
TFILLS() Q $P(^PSRX(RX,0),"^",9)+1 ; TOTAL FILLS
"RTN","PSOTALK",141,0)
RFILLS() ;NEW REFILLS REMAINING METHOD 9-21-00, BASED ON PTST+5^PSORXVW
"RTN","PSOTALK",142,0)
 S RFILLS=$P(^PSRX(RX,0),"^",9),PSORCT=0 F  S PSORCT=$O(^PSRX(RX,1,PSORCT)) Q:'PSORCT  S RFILLS=RFILLS-1
"RTN","PSOTALK",143,0)
 Q RFILLS
"RTN","PSOTALK",144,0)
FILNO() Q $$TFILLS-$$RFILLS
"RTN","PSOTALK",145,0)
EPAT() Q $P(^DPT($P(^PSRX(RX,0),"^",2),0),"^") ; EXTERNAL PATIENT NAME
"RTN","PSOTALK",146,0)
LAST6() S PSOTSSN=$P(^DPT($P(^PSRX(RX,0),"^",2),0),"^",9)  ; LAST 6 OF SSN
"RTN","PSOTALK",147,0)
 Q $E(PSOTSSN,4,5)_"-"_$E(PSOTSSN,6,9)
"RTN","PSOTALK",148,0)
SIG() ;THIS SUBROUTINE WILL BE ABANDONED IF SIGPOE WORKS v1.2c 3-13-02
"RTN","PSOTALK",149,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG1",1,0),"^",1)),1,196)
"RTN","PSOTALK",150,0)
 E  Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196) ; SIG -- NEEDS TO BE EXPANDED
"RTN","PSOTALK",151,0)
SIGPOE() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE HUMAN READABLE PORTION
"RTN","PSOTALK",152,0)
 S PSOSIG=""
"RTN","PSOTALK",153,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEE
"RTN","PSOTALK",154,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",155,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",156,0)
 .N XX,X
"RTN","PSOTALK",157,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>196 D  Q
"RTN","PSOTALK",158,0)
 ..S PSOSIG=" INDICACIONES MUY LARGAS. IMPRIMA UNA ETIQUETA DE VISTA VALIDA Y APLIQUELA SOBRE ESTA ETIQUETA DE SCRIPTALK EN LA BOTELLA."
"RTN","PSOTALK",159,0)
 E  D  ;
"RTN","PSOTALK",160,0)
 . N PSOSEQ
"RTN","PSOTALK",161,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",162,0)
 . S PSOLSIG=" SIG IS TOO LONG. REPRINT A NON-VOIDED VISTA LABEL AND PLACE OVER THIS SCRIPTALK LABEL"
"RTN","PSOTALK",163,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",164,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",165,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>196 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",166,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",167,0)
SIGPOEE Q $E(PSOSIG,2,197)
"RTN","PSOTALK",168,0)
 ;
"RTN","PSOTALK",169,0)
SIGPOEX() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE READ ALOUD PORTION
"RTN","PSOTALK",170,0)
 S PSOSIG=""
"RTN","PSOTALK",171,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEEX
"RTN","PSOTALK",172,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",173,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",174,0)
 .N XX,X
"RTN","PSOTALK",175,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>196 D  Q
"RTN","PSOTALK",176,0)
 ..S PSOSIG=" LAS INSTRUCCIONES DE ESTA RECETA SON MUY LARGAS.  POR FAVOR SOLICITE A SU CUIDADOR QUE LE LEA LAS INSTRUCCIONES IMPRESAS EN EL ROTULO O COMUNIQUESE CON SU MEDICO PARA INSTRUCCIONES COMPLETAS."
"RTN","PSOTALK",177,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))'=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196)
"RTN","PSOTALK",178,0)
 E  D  ;
"RTN","PSOTALK",179,0)
 . N PSOSEQ
"RTN","PSOTALK",180,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",181,0)
 . S PSOLSIG=" THE INSTRUCTIONS FOR THIS PRESCRIPTION ARE TOO LONG. PLEASE HAVE A CAREGIVER READ THE PRINTED LABEL OR CONTACT YOUR PHYSICIAN FOR COMPLETE INSTRUCTIONS."
"RTN","PSOTALK",182,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",183,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",184,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>196 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",185,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",186,0)
SIGPOEEX Q $E(PSOSIG,2,197)
"RTN","PSOTALK",187,0)
PROV() ;PROVIDER NAME
"RTN","PSOTALK",188,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",189,0)
 Q $P($$NAMEFMT^XLFNAME(PSOPHYS)," MD")
"RTN","PSOTALK",190,0)
EPROV() ;
"RTN","PSOTALK",191,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",192,0)
 Q PSOPHYS
"RTN","PSOTALK",193,0)
QTY() Q $S($G(RXP):$P(RXP,"^",4),1:$P(^PSRX(RX,0),"^",7))
"RTN","PSOTALK",194,0)
DF() Q $P(^PSDRUG($P(^PSRX(RX,0),"^",6),660),"^",8)
"RTN","PSOTALK",195,0)
DRUG() Q $P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",1) ; DRUG NAME
"RTN","PSOTALK",196,0)
WARN() N WARN,NWARN,IWARN,XWARN ; 1-28-02 UPDATE v1.2a TO ELIMINATE LOCAL CODES
"RTN","PSOTALK",197,0)
 S WARN=$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",8) ; WARNING LABEL CODES
"RTN","PSOTALK",198,0)
 F NWARN=1:1:3 S IWARN=$P(WARN,",",NWARN) S:IWARN>20 IWARN="" S:$L(IWARN)=1 IWARN="0"_IWARN S:$L(IWARN)=0 IWARN="00" S XWARN=$G(XWARN)_IWARN
"RTN","PSOTALK",199,0)
 Q XWARN
"RTN","PSOTALK2")
0^6^B61754763
"RTN","PSOTALK2",1,0)
PSOTALK2 ;BIR/EJW - SCRIPTALK ENROLLMENT FUNCTIONS ;3-28-02
"RTN","PSOTALK2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182**;DEC 1997
"RTN","PSOTALK2",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK2",4,0)
 ;External reference ^TMP("TIUP", ^TIUPNAPI, ^TIU(8925.1 supported by DBIA 1911
"RTN","PSOTALK2",5,0)
ENROLL ;
"RTN","PSOTALK2",6,0)
 N PSOSTEN,PSOIND,PSOLAST,DFN
"RTN","PSOTALK2",7,0)
 S PSOIND=""
"RTN","PSOTALK2",8,0)
 I '$G(PSOFIRST) D INSTR S PSOFIRST=1
"RTN","PSOTALK2",9,0)
 W !
"RTN","PSOTALK2",10,0)
 K DIC W ! S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC I Y<1!($D(DUOUT))!($D(DTOUT)) D CLEAN Q
"RTN","PSOTALK2",11,0)
 S PSOPT=+Y
"RTN","PSOTALK2",12,0)
 S DFN=PSOPT D DEM^VADPT I +$G(VADM(6)) W !,"Patient is deceased",! G ENROLL
"RTN","PSOTALK2",13,0)
 I '$D(^PS(55,PSOPT)) D
"RTN","PSOTALK2",14,0)
 .S DIC="^PS(55,",DLAYGO=55
"RTN","PSOTALK2",15,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSOPT D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSOTALK2",16,0)
 ..S $P(^PS(55,PSOPT,0),"^")=PSOPT K DIK S DA=PSOPT,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSOTALK2",17,0)
 S PSOSTEN=$G(^PS(55,"ASTALK",PSOPT))
"RTN","PSOTALK2",18,0)
 S DIR(0)="Y",DIR("A")="SCRIPTALK PATIENT" S DIR("B")=$S(PSOSTEN:"Y",1:"N") D ^DIR K DIR
"RTN","PSOTALK2",19,0)
 S PSOSTEN=Y
"RTN","PSOTALK2",20,0)
 I PSOSTEN D MAIL,GETIND
"RTN","PSOTALK2",21,0)
 D SET55
"RTN","PSOTALK2",22,0)
 D NOTE(PSOPT)
"RTN","PSOTALK2",23,0)
 K PSOIND,PSOPT,PSOSTEN,PSOLAST,X,Y
"RTN","PSOTALK2",24,0)
 G ENROLL
"RTN","PSOTALK2",25,0)
 ;
"RTN","PSOTALK2",26,0)
SET55 ; SET MULTIPLE FOR SCRIPTALK ENROLLMENT AUDIT
"RTN","PSOTALK2",27,0)
 N PSODA,PSOERR,PSOIEN,PSOSTDT
"RTN","PSOTALK2",28,0)
 I PSOPT="" Q
"RTN","PSOTALK2",29,0)
 S PSOSTDT=$$NOW^XLFDT
"RTN","PSOTALK2",30,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",.01)=PSOSTDT
"RTN","PSOTALK2",31,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",1)=PSOSTEN
"RTN","PSOTALK2",32,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",2)=PSOIND
"RTN","PSOTALK2",33,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",3)=$G(DUZ)
"RTN","PSOTALK2",34,0)
 D UPDATE^DIE("","PSODA","PSOIEN","PSOERR")
"RTN","PSOTALK2",35,0)
 Q
"RTN","PSOTALK2",36,0)
 ;
"RTN","PSOTALK2",37,0)
GETIND ; GET INDICATION FOR ENROLLMENT
"RTN","PSOTALK2",38,0)
 S PSOLAST=$P($G(^PS(55,PSOPT,"SCTALK",0)),"^",4) I PSOLAST'="" S PSOIND=$P($G(^PS(55,PSOPT,"SCTALK",PSOLAST,0)),"^",3) ; IF PRIOR ANSWER WAS 'Y' - GET PRIOR INDICATION
"RTN","PSOTALK2",39,0)
 S DIR(0)="S^B:BLIND VETERAN;L:LOW VISION",DIR("A")="INDICATION" S DIR("B")=PSOIND D ^DIR K DIR
"RTN","PSOTALK2",40,0)
 S PSOIND=$G(Y)
"RTN","PSOTALK2",41,0)
 Q
"RTN","PSOTALK2",42,0)
 ;
"RTN","PSOTALK2",43,0)
INSTR ;
"RTN","PSOTALK2",44,0)
 W @IOF
"RTN","PSOTALK2",45,0)
 I $O(^TIU(8925.1,"B","SCRIPTALK ENROLLMENT",0))="" Q
"RTN","PSOTALK2",46,0)
 W !
"RTN","PSOTALK2",47,0)
 W !?3,"At the conclusion of this enrollment option, you will be given"
"RTN","PSOTALK2",48,0)
 W !?3,"the opportunity to sign a progress note recording the enrollment"
"RTN","PSOTALK2",49,0)
 W !?3,"of new ScripTalk patients. If you modify the record of a patient"
"RTN","PSOTALK2",50,0)
 W !?3,"that was previously enrolled, and they remain enrolled, you may"
"RTN","PSOTALK2",51,0)
 W !?3,"wish to either delete or edit the text of the generated note."
"RTN","PSOTALK2",52,0)
 W !!
"RTN","PSOTALK2",53,0)
 K PSOSQ,PSOTT,PSOSTP
"RTN","PSOTALK2",54,0)
 Q
"RTN","PSOTALK2",55,0)
 ;
"RTN","PSOTALK2",56,0)
NOTE(PSOPT) ;CREATE A PROGRESS NOTE FOR PATIENT 'PSOPT' ABOUT ENROLLMENT
"RTN","PSOTALK2",57,0)
 Q:'+$G(^PS(55,"ASTALK",PSOPT))  ; IF THIS PTS ENROLLMENT ISN'T ACTIVE
"RTN","PSOTALK2",58,0)
 S PSOTITL=$O(^TIU(8925.1,"B","SCRIPTALK ENROLLMENT",0))
"RTN","PSOTALK2",59,0)
 Q:'+PSOTITL  ;IF NO TITLE ON SYSTEM
"RTN","PSOTALK2",60,0)
 S PSOPTNM=$P($G(^DPT(PSOPT,0)),U,1)
"RTN","PSOTALK2",61,0)
 S PSOLINE=1
"RTN","PSOTALK2",62,0)
 S ^TMP("TIUP",$J,PSOLINE,0)=PSOPTNM_" was enrolled in ScripTalk today, and is now eligible to receive"
"RTN","PSOTALK2",63,0)
 S PSOLINE=PSOLINE+1
"RTN","PSOTALK2",64,0)
 S ^TMP("TIUP",$J,PSOLINE,0)="prescriptions with encoded speech-capable labels."
"RTN","PSOTALK2",65,0)
 S ^TMP("TIUP",$J,0)=U_U_PSOLINE_PSOLINE_U_DT_U
"RTN","PSOTALK2",66,0)
INSTALL K TIUDA
"RTN","PSOTALK2",67,0)
 D NEW^TIUPNAPI(.TIUDA,PSOPT,DUZ,$$NOW^XLFDT,PSOTITL)
"RTN","PSOTALK2",68,0)
 Q
"RTN","PSOTALK2",69,0)
 ;
"RTN","PSOTALK2",70,0)
CLEAN K PSOLINE,PSOPTNM,PSOTITL,PSOSTP,PSOPT,PSOFIRST
"RTN","PSOTALK2",71,0)
 K ^TMP("TIUP",$J)
"RTN","PSOTALK2",72,0)
 Q
"RTN","PSOTALK2",73,0)
 ;
"RTN","PSOTALK2",74,0)
AUDREP ;
"RTN","PSOTALK2",75,0)
 K DIC W ! S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC I Y<1!($D(DUOUT))!($D(DTOUT)) Q
"RTN","PSOTALK2",76,0)
 S PSOPT=+Y
"RTN","PSOTALK2",77,0)
 S ZTSAVE("*")=""
"RTN","PSOTALK2",78,0)
 W !!,"You may queue the report to print, if you wish.",!
"RTN","PSOTALK2",79,0)
 K %ZIS,POP,IOP S %ZIS="QM" D ^%ZIS I $G(POP) W !!,"Nothing queued to print.",! G DONE
"RTN","PSOTALK2",80,0)
 I $D(IO("Q")) S ZTRTN="AUDRQ^PSOTALK2",ZTDESC="Report of ScripTalk Enrollment",ZTSAVE("*")="" D ^%ZTLOAD K %ZSI W !,"Report queued to print.",! G DONE
"RTN","PSOTALK2",81,0)
AUDRQ ;
"RTN","PSOTALK2",82,0)
 U IO
"RTN","PSOTALK2",83,0)
 S PSOOUT=0,PSODV=$S($E(IOST)="C":"C",1:"P")
"RTN","PSOTALK2",84,0)
 S PSOPGCT=1
"RTN","PSOTALK2",85,0)
 D TITLEA I PSOOUT G DONE
"RTN","PSOTALK2",86,0)
 S PSOAUD=0 F  S PSOAUD=$O(^PS(55,PSOPT,"SCTALK",PSOAUD)) Q:PSOAUD=""  D  I PSOOUT Q
"RTN","PSOTALK2",87,0)
 .S PSONODE=$G(^PS(55,PSOPT,"SCTALK",PSOAUD,0))
"RTN","PSOTALK2",88,0)
 .S PSOSTAT=$P(PSONODE,"^",2)
"RTN","PSOTALK2",89,0)
 .S PSOTIME=$$FMTE^XLFDT($P(PSONODE,U,1)),PSOTIME=$P(PSOTIME,"@")_"  "_$P(PSOTIME,"@",2)
"RTN","PSOTALK2",90,0)
 .S PSOTIME=$P(PSOTIME,":",1,2)
"RTN","PSOTALK2",91,0)
 .I ($Y+5)>IOSL&('$G(PSOOUT)) D TITLEA I PSOOUT Q
"RTN","PSOTALK2",92,0)
 .W !,?2,PSOTIME
"RTN","PSOTALK2",93,0)
 .W ?25,$S(PSOSTAT:"YES",PSOSTAT=0:"NO",1:" ")
"RTN","PSOTALK2",94,0)
 .S PSOIND=$P(PSONODE,"^",3)
"RTN","PSOTALK2",95,0)
 .I 'PSOSTAT S PSOIND=""
"RTN","PSOTALK2",96,0)
 .W ?35,$S(PSOIND="B":"BLIND VETERAN",PSOIND="L":"LOW VISION",1:"")
"RTN","PSOTALK2",97,0)
 .I $P(PSONODE,"^",4)'="" D  W ?52,$E(PSODUZ,1,27)
"RTN","PSOTALK2",98,0)
 ..K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(PSONODE,"^",4) D ^DIC S PSODUZ=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK2",99,0)
 I PSOOUT G DONE
"RTN","PSOTALK2",100,0)
END ;
"RTN","PSOTALK2",101,0)
 I '$G(PSOOUT),$G(PSODV)="C" W !!,"** End of Report **" K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOTALK2",102,0)
 I $G(PSODV)="C" W !
"RTN","PSOTALK2",103,0)
 E  W @IOF
"RTN","PSOTALK2",104,0)
DONE K PSOPT,PSOAUD,PSONODE,PSOIND,PSOSTAT,PSOPGCT,Y,IOP,POP,IO("Q"),DIRUT,DUOUT,DTOUT,PSODV,PSOOUT
"RTN","PSOTALK2",105,0)
 K PSODFN,PSOIND,PSOSSN,PSOPRINT,PSONM,^TMP($J,"PSOTALK2")
"RTN","PSOTALK2",106,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK2",107,0)
 Q
"RTN","PSOTALK2",108,0)
 ;
"RTN","PSOTALK2",109,0)
TITLEA ;
"RTN","PSOTALK2",110,0)
 I $G(PSODV)="C",$G(PSOPGCT)'=1 W ! K DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOTALK2",111,0)
 W @IOF
"RTN","PSOTALK2",112,0)
 W !,"SCRIPTALK AUDIT HISTORY" S Y=DT X ^DD("DD") W ?40,"Date printed: ",Y,?70,"Page: ",PSOPGCT,!!
"RTN","PSOTALK2",113,0)
 S PSOPGCT=PSOPGCT+1
"RTN","PSOTALK2",114,0)
 W !,"Name: ",$E($P(^DPT(PSOPT,0),"^"),1,25),"    Currently enrolled: ",$S($G(^PS(55,"ASTALK",PSOPT)):"YES",1:"NO"),!!
"RTN","PSOTALK2",115,0)
 W !?24,"Previous",?35,"Previous"
"RTN","PSOTALK2",116,0)
 W !,?2,"Date-Time Set",?25,"Status",?35,"Indication",?52,"Entered by"
"RTN","PSOTALK2",117,0)
 W !,?2,"-------------------",?24,"--------",?35,"-------------",?52,"--------------------",!
"RTN","PSOTALK2",118,0)
 Q
"RTN","PSOTALK2",119,0)
 ;
"RTN","PSOTALK2",120,0)
ENQ ;
"RTN","PSOTALK2",121,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to report only active enrollees" D ^DIR K DIR D:$D(DIRUT) MESS G:Y["^"!($D(DIRUT)) DONE S PSOPRINT=$S(Y:1,1:0)
"RTN","PSOTALK2",122,0)
 W !!,"You may queue the report to print, if you wish.",!
"RTN","PSOTALK2",123,0)
 K %ZIS,POP,IOP S %ZIS="QM" D ^%ZIS I $G(POP) W !!,"Nothing queued to print.",! G DONE
"RTN","PSOTALK2",124,0)
 I $D(IO("Q")) S ZTRTN="RPENROLL^PSOTALK2",ZTDESC="Report of ScripTalk Enrollment",ZTSAVE("*")="" D ^%ZTLOAD K %ZSI W !,"Report queued to print.",! G DONE
"RTN","PSOTALK2",125,0)
RPENROLL ;
"RTN","PSOTALK2",126,0)
 U IO
"RTN","PSOTALK2",127,0)
 S PSOOUT=0,PSODV=$S($E(IOST)="C":"C",1:"P")
"RTN","PSOTALK2",128,0)
 S PSOPGCT=1
"RTN","PSOTALK2",129,0)
 D TITLEE I PSOOUT G DONE
"RTN","PSOTALK2",130,0)
 K ^TMP($J,"PSOTALK2")
"RTN","PSOTALK2",131,0)
 D GETDFN
"RTN","PSOTALK2",132,0)
 I '$D(^TMP($J,"PSOTALK2")) W !!,"No patients to report!",!! G DONE
"RTN","PSOTALK2",133,0)
 S PSONM="" F  S PSONM=$O(^TMP($J,"PSOTALK2",PSONM)) Q:PSONM=""  S PSOSSN="" F  S PSOSSN=$O(^TMP($J,"PSOTALK2",PSONM,PSOSSN)) Q:PSOSSN=""  D  I PSOOUT G DONE
"RTN","PSOTALK2",134,0)
 .S PSOIND=^TMP($J,"PSOTALK2",PSONM,PSOSSN)
"RTN","PSOTALK2",135,0)
 .I ($Y+5)>IOSL&('$G(PSOOUT)) D TITLEE I PSOOUT Q
"RTN","PSOTALK2",136,0)
 .W !,PSONM,?25," ",PSOSSN I 'PSOPRINT W ?43,$S(+$P(PSOIND,"^",3):"YES",1:"NO")
"RTN","PSOTALK2",137,0)
 .W !,?3,$S($P(PSOIND,"^",2)="B":"BLIND VETERAN",$P(PSOIND,"^",2)="L":"LOW VISION",1:" ")
"RTN","PSOTALK2",138,0)
 .W ?58,$$FMTE^XLFDT($P(PSOIND,"^")),!
"RTN","PSOTALK2",139,0)
 G END
"RTN","PSOTALK2",140,0)
 ;
"RTN","PSOTALK2",141,0)
TITLEE ;
"RTN","PSOTALK2",142,0)
 I $G(PSODV)="C",$G(PSOPGCT)'=1 W ! K DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOTALK2",143,0)
 W @IOF
"RTN","PSOTALK2",144,0)
 W !,"Report of ScripTalk Enrollment",?40,"Date printed: "_$$FMTE^XLFDT(DT),?70,"Page: ",PSOPGCT,!!
"RTN","PSOTALK2",145,0)
 S PSOPGCT=PSOPGCT+1
"RTN","PSOTALK2",146,0)
 W !,"Patient name",?25," SSN" I 'PSOPRINT W ?40,"Active enrollee?"
"RTN","PSOTALK2",147,0)
 W !?3,"Indication",?57,"Enrollment last updated"
"RTN","PSOTALK2",148,0)
 W !,"--------------",?25,"-----------" W:'PSOPRINT ?40,"-------------" W ?57,"-----------------------",!
"RTN","PSOTALK2",149,0)
 Q
"RTN","PSOTALK2",150,0)
 ;
"RTN","PSOTALK2",151,0)
GETDFN ;
"RTN","PSOTALK2",152,0)
 N DFN
"RTN","PSOTALK2",153,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(55,"ASTALK",PSODFN)) Q:PSODFN=""  D
"RTN","PSOTALK2",154,0)
 .I PSOPRINT I '$G(^PS(55,"ASTALK",PSODFN)) Q
"RTN","PSOTALK2",155,0)
 .S DFN=PSODFN D DEM^VADPT I +$G(VADM(6)) Q  ; DECEASED
"RTN","PSOTALK2",156,0)
 .S PSOSEQ=$P($G(^PS(55,DFN,"SCTALK",0)),"^",4)
"RTN","PSOTALK2",157,0)
 .S PSOAUD=""
"RTN","PSOTALK2",158,0)
 .I PSOSEQ'="" S PSOAUD=$G(^PS(55,DFN,"SCTALK",PSOSEQ,0))
"RTN","PSOTALK2",159,0)
 .I $G(VA("PID"))="" S VA("PID")=" "
"RTN","PSOTALK2",160,0)
 .S ^TMP($J,"PSOTALK2",VADM(1),VA("PID"))=$P(PSOAUD,"^")_"^"_$P(PSOAUD,"^",3)_"^"_$G(^PS(55,"ASTALK",PSODFN))
"RTN","PSOTALK2",161,0)
 Q
"RTN","PSOTALK2",162,0)
 ;
"RTN","PSOTALK2",163,0)
MESS W !!,"No report printed!",!!
"RTN","PSOTALK2",164,0)
 Q
"RTN","PSOTALK2",165,0)
 ;
"RTN","PSOTALK2",166,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSOTALK2",167,0)
 N MAIL
"RTN","PSOTALK2",168,0)
 S MAIL=$G(^PS(55,PSOPT,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSOTALK2",169,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSOTALK2",170,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSOTALK2",171,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSOTALK2",172,0)
 I MAIL?1"^".E Q
"RTN","PSOTALK2",173,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSOTALK2",174,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSOTALK2",175,0)
 S $P(^PS(55,PSOPT,0),"^",3)=MAIL
"RTN","PSOTALK2",176,0)
 Q
"RTN","PSOTPRX1")
0^7^B51067568
"RTN","PSOTPRX1",1,0)
PSOTPRX1 ;BIR/MHA-TPB medication procesing driver ;08/21/03
"RTN","PSOTPRX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**146,182**;DEC 1997
"RTN","PSOTPRX1",3,0)
 ;External reference PDA^PPPPDA1 supported by DBIA 1374
"RTN","PSOTPRX1",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTPRX1",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSOTPRX1",6,0)
 ;External reference EN2^GMRAPEM0 supported by DBIA 190
"RTN","PSOTPRX1",7,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG S (PSOBCK,PSOERR)=1 D INIT
"RTN","PSOTPRX1",8,0)
 W:'$D(PSOTPBFG) !!,"*** Transitional Pharmacy Benefit Flag Undefined - Quitting ***"
"RTN","PSOTPRX1",9,0)
 G:PSORX("QFLG")!('$D(PSOTPBFG)) END
"RTN","PSOTPRX1",10,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSOTPRX1",11,0)
 ;call to add bingo board data to file 52.11
"RTN","PSOTPRX1",12,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSOTPRX1",13,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSOTPRX1",14,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSOTPRX1",15,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX S PSOPBM1=1
"RTN","PSOTPRX1",16,0)
 G:$G(NOBG) NX
"RTN","PSOTPRX1",17,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSOTPRX1",18,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSOTPRX1",19,0)
 I $G(PSOPBM),$G(PSOPBM1) S $P(^PS(55,PSODFN,0),"^",7)=PSOPBM,$P(^(0),"^",8)="A" K PSOPBM,PSOPBM1
"RTN","PSOTPRX1",20,0)
NX D:$G(PSODFN) EXFLAG^PSOTPCAN(PSODFN) D EOJ G START
"RTN","PSOTPRX1",21,0)
END Q
"RTN","PSOTPRX1",22,0)
 ;---------------------------------------------------------
"RTN","PSOTPRX1",23,0)
INIT ;
"RTN","PSOTPRX1",24,0)
 S PSORX("QFLG")=0
"RTN","PSOTPRX1",25,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSOTPRX1",26,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSOTPRX1",27,0)
INITX Q
"RTN","PSOTPRX1",28,0)
 ;
"RTN","PSOTPRX1",29,0)
PT ;
"RTN","PSOTPRX1",30,0)
 K ^TMP("PSORXDC",$J),CLOZPAT,DIC,PSODFN,PSOPBM,PSOPBM1 S PSORX("QFLG")=0
"RTN","PSOTPRX1",31,0)
 S DIC("S")="I '$P(^PS(52.91,+Y,0),""^"",3)!($P(^(0),""^"",3)>DT)"
"RTN","PSOTPRX1",32,0)
 S DIC=52.91,DIC(0)="QEAM" D ^DIC K DIC,DA
"RTN","PSOTPRX1",33,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSOTPRX1",34,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P($G(^DPT(PSODFN,0)),"^")
"RTN","PSOTPRX1",35,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSOTPRX1",36,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !,"Patient has another language preference!",! H 3
"RTN","PSOTPRX1",37,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSOTPRX1",38,0)
 I '$G(MEDP) S X="PPPPDA1" X ^%ZOSF("TEST") S:$T X=$$PDA^PPPPDA1(PSODFN)
"RTN","PSOTPRX1",39,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSOTPRX1",40,0)
 I $G(PSOFIN) S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSOTPRX1",41,0)
 K PSOPBM ; KILL SO THAT WON'T CARRY OVER PRIOR PATIENT'S VALUE
"RTN","PSOTPRX1",42,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSOTPRX1",43,0)
 .S PSOPBM=$P(TM,".")
"RTN","PSOTPRX1",44,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSOTPRX1",45,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSOTPRX1",46,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOTPRX1",47,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSOTPRX1",48,0)
 .L +^PS(55,PSODFN):0 I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSOTPRX1",49,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSOTPRX1",50,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;@1;3//NON-VA;D CHK^PSOTPRX1;50;106;106.1"
"RTN","PSOTPRX1",51,0)
 .S DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSOTPRX1",52,0)
 .I $D(Y)!($D(DTOUT)) S PSOX=$G(^PS(55,PSODFN,"PS")) D:+$P(PSOX,"^")
"RTN","PSOTPRX1",53,0)
 ..I $$UP^XLFSTR($P(^PS(53,$P(PSOX,"^"),0),"^"))'="NON-VA" S DR="3////@" D ^DIE
"RTN","PSOTPRX1",54,0)
 S PSOX=$G(^PS(55,PSODFN,"PS"))
"RTN","PSOTPRX1",55,0)
 I PSOX]"" S (X,PSORX("PATIENT STATUS"))=$$UP^XLFSTR($P(^PS(53,$P(PSOX,"^"),0),"^")) D:X'="NON-VA" WRN
"RTN","PSOTPRX1",56,0)
 I PSOX']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSOTPRX1",57,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSOTPRX1",58,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("B")="NON-VA"
"RTN","PSOTPRX1",59,0)
 .S DIC("A")="PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSOTPRX1",60,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSOTPRX1",61,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSOTPRX1",62,0)
 ..I $G(PSOPBM) D  K PSOPBM
"RTN","PSOTPRX1",63,0)
 ...I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSOTPRX1",64,0)
 .I $$UP^XLFSTR($P(^PS(53,+Y,0),"^"))'="NON-VA" D MES S POERR("QFLG")=1 Q
"RTN","PSOTPRX1",65,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSOTPRX1",66,0)
 .D KV
"RTN","PSOTPRX1",67,0)
 Q:$G(PSOFIN)
"RTN","PSOTPRX1",68,0)
PROV ;
"RTN","PSOTPRX1",69,0)
 D ST^PSOTPPRV G:'$G(DA) NX
"RTN","PSOTPRX1",70,0)
 S PSORX("PROVIDER NAME")=$P(^VA(200,DA,0),"^")
"RTN","PSOTPRX1",71,0)
 D KV S DIR("A")="Do you want to enter allergies or adverse reactions at this time?"
"RTN","PSOTPRX1",72,0)
 S DIR("B")="Y",DIR(0)="YN" W !! D ^DIR I Y W !
"RTN","PSOTPRX1",73,0)
 D:Y EN2^GMRAPEM0
"RTN","PSOTPRX1",74,0)
 I '$G(PSOPBM),'$P(^PS(55,PSODFN,0),"^",7),$P(^(0),"^",8)']"" S PSOPBM=$P(TM,".")
"RTN","PSOTPRX1",75,0)
 D ^PSOBUILD
"RTN","PSOTPRX1",76,0)
 F PT="GET","DEAD","INP","CNH","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSOTPRX1",77,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSOTPRX1",78,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSOTPRX1",79,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSOTPRX1",80,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSOTPRX1",81,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSOTPRX1",82,0)
PTX ;
"RTN","PSOTPRX1",83,0)
 K X,Y,^TMP("PS",$J),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR
"RTN","PSOTPRX1",84,0)
 Q
"RTN","PSOTPRX1",85,0)
CHK ;
"RTN","PSOTPRX1",86,0)
 Q:'X
"RTN","PSOTPRX1",87,0)
 I $$UP^XLFSTR($P(^PS(53,+X,0),"^"))'="NON-VA" D MES S Y="@1",$P(^PS(55,PSODFN,"PS"),"^")=""
"RTN","PSOTPRX1",88,0)
 Q
"RTN","PSOTPRX1",89,0)
MES W $C(7),!!,"Invalid Selection - Only 'NON-VA' patient status can be processed through"
"RTN","PSOTPRX1",90,0)
 W !,"this option. For all other statuses use the regular Patient Prescription"
"RTN","PSOTPRX1",91,0)
 W !,"Processing option"
"RTN","PSOTPRX1",92,0)
 Q
"RTN","PSOTPRX1",93,0)
WRN W $C(7),!!?15,"*** Current RX Patient Status is "_X_" ***"
"RTN","PSOTPRX1",94,0)
 W !,"Only 'NON-VA' patient status should be processed through this option."
"RTN","PSOTPRX1",95,0)
 W !,"For all other statuses use the regular Patient Prescription Processing option."
"RTN","PSOTPRX1",96,0)
 Q
"RTN","PSOTPRX1",97,0)
EOJ ;
"RTN","PSOTPRX1",98,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC,PSOPBM
"RTN","PSOTPRX1",99,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSOTPRX1",100,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSOTPRX1",101,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSOTPRX1",102,0)
 K ^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J) I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSOTPRX1",103,0)
 K RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG
"RTN","PSOTPRX1",104,0)
KV K DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSOTPRX1",105,0)
 Q
"RTN","PSOTPRX1",106,0)
ELIG ; shows eligibility and disabilities
"RTN","PSOTPRX1",107,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSOTPRX1",108,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOTPRX1",109,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOTPRX1",110,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSOTPRX1",111,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOTPRX1",112,0)
 K N
"RTN","PSOTPRX1",113,0)
 Q
"RTN","PSOTPRX1",114,0)
PROFILE ;
"RTN","PSOTPRX1",115,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSOTPRX1",116,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSOTPRX1",117,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSOTPRX1",118,0)
 K PSOX
"RTN","PSOTPRX1",119,0)
PROFILEX ;
"RTN","PSOTPRX1",120,0)
 Q
"VER")
8.0^22.0
**END**
**END**
