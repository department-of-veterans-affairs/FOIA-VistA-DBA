Released TIU*1*202 SEQ #195
Extracted from mail message
**KIDS**:TIU*1.0*202^

**INSTALL NAME**
TIU*1.0*202
"BLD",6218,0)
TIU*1.0*202^TEXT INTEGRATION UTILITIES^0^3051208^y
"BLD",6218,1,0)
^^2^2^3050825^^^^
"BLD",6218,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",6218,1,2,0)
under TIU*1.0*202.
"BLD",6218,4,0)
^9.64PA^^0
"BLD",6218,6)
1^
"BLD",6218,"ABPKG")
n
"BLD",6218,"INI")

"BLD",6218,"KRN",0)
^9.67PA^8989.52^19
"BLD",6218,"KRN",.4,0)
.4
"BLD",6218,"KRN",.401,0)
.401
"BLD",6218,"KRN",.402,0)
.402
"BLD",6218,"KRN",.403,0)
.403
"BLD",6218,"KRN",.5,0)
.5
"BLD",6218,"KRN",.84,0)
.84
"BLD",6218,"KRN",3.6,0)
3.6
"BLD",6218,"KRN",3.8,0)
3.8
"BLD",6218,"KRN",9.2,0)
9.2
"BLD",6218,"KRN",9.8,0)
9.8
"BLD",6218,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6218,"KRN",9.8,"NM",1,0)
TIULMED^^0^79725171
"BLD",6218,"KRN",9.8,"NM",2,0)
TIULMED1^^0^38886154
"BLD",6218,"KRN",9.8,"NM",3,0)
TIUTPBN^^0^63654050
"BLD",6218,"KRN",9.8,"NM","B","TIULMED",1)

"BLD",6218,"KRN",9.8,"NM","B","TIULMED1",2)

"BLD",6218,"KRN",9.8,"NM","B","TIUTPBN",3)

"BLD",6218,"KRN",19,0)
19
"BLD",6218,"KRN",19.1,0)
19.1
"BLD",6218,"KRN",101,0)
101
"BLD",6218,"KRN",409.61,0)
409.61
"BLD",6218,"KRN",771,0)
771
"BLD",6218,"KRN",870,0)
870
"BLD",6218,"KRN",8989.51,0)
8989.51
"BLD",6218,"KRN",8989.52,0)
8989.52
"BLD",6218,"KRN",8994,0)
8994
"BLD",6218,"KRN","B",.4,.4)

"BLD",6218,"KRN","B",.401,.401)

"BLD",6218,"KRN","B",.402,.402)

"BLD",6218,"KRN","B",.403,.403)

"BLD",6218,"KRN","B",.5,.5)

"BLD",6218,"KRN","B",.84,.84)

"BLD",6218,"KRN","B",3.6,3.6)

"BLD",6218,"KRN","B",3.8,3.8)

"BLD",6218,"KRN","B",9.2,9.2)

"BLD",6218,"KRN","B",9.8,9.8)

"BLD",6218,"KRN","B",19,19)

"BLD",6218,"KRN","B",19.1,19.1)

"BLD",6218,"KRN","B",101,101)

"BLD",6218,"KRN","B",409.61,409.61)

"BLD",6218,"KRN","B",771,771)

"BLD",6218,"KRN","B",870,870)

"BLD",6218,"KRN","B",8989.51,8989.51)

"BLD",6218,"KRN","B",8989.52,8989.52)

"BLD",6218,"KRN","B",8994,8994)

"BLD",6218,"PRE")

"BLD",6218,"QUES",0)
^9.62^^
"BLD",6218,"REQB",0)
^9.611^5^5
"BLD",6218,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",6218,"REQB",2,0)
TIU*1.0*94^2
"BLD",6218,"REQB",3,0)
TIU*1.0*183^2
"BLD",6218,"REQB",4,0)
PSO*7.0*214^2
"BLD",6218,"REQB",5,0)
TIU*1.0*198^2
"BLD",6218,"REQB","B","PSO*7.0*214",4)

"BLD",6218,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",6218,"REQB","B","TIU*1.0*183",3)

"BLD",6218,"REQB","B","TIU*1.0*198",5)

"BLD",6218,"REQB","B","TIU*1.0*94",2)

"MBREQ")
0
"PKG",506,-1)
1^1
"PKG",506,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",506,20,0)
^9.402P^^
"PKG",506,22,0)
^9.49I^1^1
"PKG",506,22,1,0)
1.0^2970620^2970916^3316
"PKG",506,22,1,"PAH",1,0)
202^3051208^33229
"PKG",506,22,1,"PAH",1,1,0)
^^2^2^3051208
"PKG",506,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",506,22,1,"PAH",1,1,2,0)
under TIU*1.0*202.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIULMED")
0^1^B79725171^B79707735
"RTN","TIULMED",1,0)
TIULMED ; SLC/JM,JH - Active/Recent Med Objects Routine ;12/07/05
"RTN","TIULMED",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**38,73,92,94,183,193,197,198,202**;Jun 20, 1997
"RTN","TIULMED",3,0)
 Q
"RTN","TIULMED",4,0)
LIST(DFN,TARGET,ACTVONLY,DETAILED,ALLMEDS,ONELIST,CLASSORT,SUPPLIES) ;
"RTN","TIULMED",5,0)
 ; This is the TIU Medication objects API.  Optional parameters not
"RTN","TIULMED",6,0)
 ; provided defaults to 0 (with the exception of SUPPLIES).
"RTN","TIULMED",7,0)
 ;Required Parameters:
"RTN","TIULMED",8,0)
 ;  DFN       Patient identifier
"RTN","TIULMED",9,0)
 ;  TARGET    Where the medication data will be stored
"RTN","TIULMED",10,0)
 ;Optional Parameters:
"RTN","TIULMED",11,0)
 ;  ACTVONLY  0 - Active and recently expired meds
"RTN","TIULMED",12,0)
 ;            1 - Active meds only
"RTN","TIULMED",13,0)
 ;            2 - Recently expired meds only
"RTN","TIULMED",14,0)
 ;  DETAILED  0 - One line per med only
"RTN","TIULMED",15,0)
 ;            1 - Detailed information on each med
"RTN","TIULMED",16,0)
 ;  ALLMEDS   0 - Specifies Inpatient Meds if patient is an
"RTN","TIULMED",17,0)
 ;                Inpatient, or Outpatient Meds if patient
"RTN","TIULMED",18,0)
 ;                is an Outpatient
"RTN","TIULMED",19,0)
 ;            1 - Specifies both Inpatient and Outpatient
"RTN","TIULMED",20,0)
 ;            2 or "I" - Specifies Inpatient only
"RTN","TIULMED",21,0)
 ;            3 or "O" - Specifies Outpatient only
"RTN","TIULMED",22,0)
 ;  ONELIST   0 - Separates Active, Pending and Inactive
"RTN","TIULMED",23,0)
 ;                medications into separate lists
"RTN","TIULMED",24,0)
 ;            1 - Combines Active, Pending and Inactive
"RTN","TIULMED",25,0)
 ;                medications into the same list
"RTN","TIULMED",26,0)
 ;  CLASSORT  0 - Sort meds alphabetically
"RTN","TIULMED",27,0)
 ;            1 - Sort meds by drug class, and within the
"RTN","TIULMED",28,0)
 ;                same drug class, sort alphabetically
"RTN","TIULMED",29,0)
 ;            2 - Same as #1, but show drug class in header
"RTN","TIULMED",30,0)
 ;  SUPPLIES  0 - Supplies are excluded
"RTN","TIULMED",31,0)
 ;            1 - Supplies are included (Default)
"RTN","TIULMED",32,0)
 N NEXTLINE,EMPTY,INDEX,NODE,ISINP,KEEPMED,STATUS,ASTATS,PSTATS,OK
"RTN","TIULMED",33,0)
 N STATIDX,INPTYPE,OUTPTYPE,TYPE,MEDTYPE,CNT,DATA,MED,IDATE,XSTR,LLEN
"RTN","TIULMED",34,0)
 N LASTMEDT,LASTSTS,COUNT,TOTAL,SPACE60,DASH73,TEMP,LINE,TAB,HEADER
"RTN","TIULMED",35,0)
 N DRUGCLAS,DRUGIDX,LASTCLAS,OLDTAB,OLDHEADR,UNKNOWNS
"RTN","TIULMED",36,0)
 N NVATYPE,NVAMED,NVASTR,TIUXSTAT
"RTN","TIULMED",37,0)
 N %,%H,STOP,LSTFD ;Clean up after external calls...
"RTN","TIULMED",38,0)
 S (NEXTLINE,TAB,HEADER,UNKNOWNS)=0,LLEN=47
"RTN","TIULMED",39,0)
 K @TARGET,^TMP("PS",$J)
"RTN","TIULMED",40,0)
 ; Check for Pharmacy Package and required patches
"RTN","TIULMED",41,0)
 I '$L($T(OCL^PSOORRL)) D  G LISTX
"RTN","TIULMED",42,0)
 .D ADD^TIULMED1("Outpatient Pharmacy 7.0 Required for this Object.")
"RTN","TIULMED",43,0)
 .D ADD^TIULMED1(" ")
"RTN","TIULMED",44,0)
 I '$$PATCH^XPDUTL("PSO*7.0*20") D  G LISTX
"RTN","TIULMED",45,0)
 .D ADD^TIULMED1("Outpatient Pharmacy Patch PSO*7.0*20 is required for this Object.")
"RTN","TIULMED",46,0)
 .D ADD^TIULMED1(" ")
"RTN","TIULMED",47,0)
 I '$$PATCH^XPDUTL("PSJ*5.0*22") D  G LISTX
"RTN","TIULMED",48,0)
 .D ADD^TIULMED1("Inpatient Pharmacy Patch PSJ*5.0*22 is required for this Object.")
"RTN","TIULMED",49,0)
 .D ADD^TIULMED1(" ")
"RTN","TIULMED",50,0)
 I '+$G(ACTVONLY) S ACTVONLY=0
"RTN","TIULMED",51,0)
 I '+$G(DETAILED) S DETAILED=0
"RTN","TIULMED",52,0)
 I +$D(ALLMEDS) D
"RTN","TIULMED",53,0)
 .I ALLMEDS="I" S ALLMEDS=2
"RTN","TIULMED",54,0)
 .E  I ALLMEDS="O" S ALLMEDS=3
"RTN","TIULMED",55,0)
 I '+$G(ALLMEDS) S ALLMEDS=0
"RTN","TIULMED",56,0)
 I '+$G(ONELIST) S ONELIST=0
"RTN","TIULMED",57,0)
 I '+$G(CLASSORT) S CLASSORT=0
"RTN","TIULMED",58,0)
 I $G(SUPPLIES)'="0" S SUPPLIES=1
"RTN","TIULMED",59,0)
 S (EMPTY,HEADER)=1
"RTN","TIULMED",60,0)
 I ONELIST,'ALLMEDS,'DETAILED,'CLASSORT S HEADER=0
"RTN","TIULMED",61,0)
 I 'DETAILED S LLEN=60
"RTN","TIULMED",62,0)
 S ASTATS="^ACTIVE^REFILL^HOLD^PROVIDER HOLD^ON CALL^ACTIVE (S)^"
"RTN","TIULMED",63,0)
 S PSTATS="^NON-VERIFIED^DRUG INTERACTIONS^INCOMPLETE^PENDING^"
"RTN","TIULMED",64,0)
 S ISINP=($G(^DPT(DFN,.1))'="") ; Is this an inpatient?
"RTN","TIULMED",65,0)
 I ISINP S INPTYPE=1,OUTPTYPE=2
"RTN","TIULMED",66,0)
 E  S INPTYPE=2,OUTPTYPE=1
"RTN","TIULMED",67,0)
 S NVATYPE=3
"RTN","TIULMED",68,0)
 D ADDTITLE^TIULMED1
"RTN","TIULMED",69,0)
 ;
"RTN","TIULMED",70,0)
 ; *** Scan medication data and skip unwanted meds ***
"RTN","TIULMED",71,0)
 ;
"RTN","TIULMED",72,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","TIULMED",73,0)
 S INDEX=0
"RTN","TIULMED",74,0)
 F  S INDEX=$O(^TMP("PS",$J,INDEX))  Q:INDEX'>0  D
"RTN","TIULMED",75,0)
 .S NODE=$G(^TMP("PS",$J,INDEX,0))
"RTN","TIULMED",76,0)
 .S KEEPMED=($L($P(NODE,U,2))>0) ;Discard Blank Meds
"RTN","TIULMED",77,0)
 .I KEEPMED D
"RTN","TIULMED",78,0)
 ..S STATUS=$P(NODE,U,9)
"RTN","TIULMED",79,0)
 ..I STATUS="ACTIVE/SUSP" S STATUS="ACTIVE (S)"
"RTN","TIULMED",80,0)
 ..I $F(ASTATS,"^"_STATUS_"^")>0 S STATIDX=1
"RTN","TIULMED",81,0)
 ..E  I ($F(PSTATS,"^"_STATUS_"^")>0) S STATIDX=2
"RTN","TIULMED",82,0)
 ..E  S STATIDX=3
"RTN","TIULMED",83,0)
 ..S TIUXSTAT=STATUS
"RTN","TIULMED",84,0)
 ..I ACTVONLY=1 S KEEPMED=(STATIDX<3)
"RTN","TIULMED",85,0)
 ..I ACTVONLY=2 S KEEPMED=(STATIDX=3)
"RTN","TIULMED",86,0)
 ..I +ONELIST S STATIDX=1
"RTN","TIULMED",87,0)
 .I KEEPMED D
"RTN","TIULMED",88,0)
 ..S TYPE=$P($P(NODE,U),";",2)
"RTN","TIULMED",89,0)
 ..S TYPE=$S(TYPE="O":"OP",TYPE="I":"UD",1:"")
"RTN","TIULMED",90,0)
 ..S NVAMED=$P($P(NODE,U),";")
"RTN","TIULMED",91,0)
 ..S NVAMED=$E(NVAMED,$L(NVAMED))
"RTN","TIULMED",92,0)
 ..S KEEPMED=(TYPE'="")
"RTN","TIULMED",93,0)
 .I KEEPMED D
"RTN","TIULMED",94,0)
 ..I $O(^TMP("PS",$J,INDEX,"A",0))>0 S TYPE="IV"
"RTN","TIULMED",95,0)
 ..E  I $O(^TMP("PS",$J,INDEX,"B",0))>0 S TYPE="IV"
"RTN","TIULMED",96,0)
 ..I TYPE="OP" S MEDTYPE=OUTPTYPE
"RTN","TIULMED",97,0)
 ..E  S MEDTYPE=INPTYPE
"RTN","TIULMED",98,0)
 ..I NVAMED="N" S MEDTYPE=NVATYPE
"RTN","TIULMED",99,0)
 ..I ALLMEDS=0 D  I 1
"RTN","TIULMED",100,0)
 ...I MEDTYPE=INPTYPE S KEEPMED=ISINP
"RTN","TIULMED",101,0)
 ...E  S KEEPMED='ISINP
"RTN","TIULMED",102,0)
 ..E  I ALLMEDS=2 S KEEPMED=(MEDTYPE=INPTYPE)
"RTN","TIULMED",103,0)
 ..E  I ALLMEDS=3 S KEEPMED=(MEDTYPE=OUTPTYPE!(MEDTYPE=NVATYPE))
"RTN","TIULMED",104,0)
 .S DRUGCLAS=" "
"RTN","TIULMED",105,0)
 .S MED=$P(NODE,U,2)
"RTN","TIULMED",106,0)
 .I KEEPMED,(CLASSORT!('SUPPLIES)) D
"RTN","TIULMED",107,0)
 ..S DRUGIDX=$$IENNAME^TIULMED2(MED)
"RTN","TIULMED",108,0)
 ..D GETCLASS
"RTN","TIULMED",109,0)
 ..I KEEPMED,+DRUGIDX=0 D  ;Find orderable item
"RTN","TIULMED",110,0)
 ...N IDX,ID,ORDIDX,TMPCLASS,CDONE,SDONE,TMPIDX,TMPNODE,ISSUPPLY
"RTN","TIULMED",111,0)
 ...S ID=$P(NODE,U),IDX=+ID,ID=$E(ID,$L(IDX)+1,$L(ID))
"RTN","TIULMED",112,0)
 ...S (DRUGIDX,ORDIDX)=0
"RTN","TIULMED",113,0)
 ...I ID="R;O" D
"RTN","TIULMED",114,0)
 ....S DRUGIDX=+$P($G(^PSRX(IDX,0)),U,6)
"RTN","TIULMED",115,0)
 ....S ORDIDX=+$P($G(^PSRX(IDX,"OR1")),U)
"RTN","TIULMED",116,0)
 ...I ID="P;O" D
"RTN","TIULMED",117,0)
 ....S DRUGIDX=+$P($G(^PS(52.41,IDX,0)),U,9)
"RTN","TIULMED",118,0)
 ....S ORDIDX=+$P($G(^PS(52.41,IDX,0)),U,8)
"RTN","TIULMED",119,0)
 ...I ID="P;I" D
"RTN","TIULMED",120,0)
 ....I $P($G(^PS(53.1,IDX,1,0)),U,4)=1 D
"RTN","TIULMED",121,0)
 .....S TMPIDX=$O(^PS(53.1,IDX,1,0)) I +TMPIDX D
"RTN","TIULMED",122,0)
 ......S DRUGIDX=$P($G(^PS(53.1,IDX,1,TMPIDX,0)),U)
"RTN","TIULMED",123,0)
 ....S ORDIDX=+$P($G(^PS(53.1,IDX,.2)),U)
"RTN","TIULMED",124,0)
 ...I ID="U;I" D
"RTN","TIULMED",125,0)
 ....I $P($G(^PS(55,DFN,5,IDX,1,0)),U,4)=1 D
"RTN","TIULMED",126,0)
 .....S TMPIDX=$O(^PS(55,DFN,5,IDX,1,0)) I +TMPIDX D
"RTN","TIULMED",127,0)
 ......S DRUGIDX=$P($G(^PS(55,DFN,5,IDX,1,TMPIDX,0)),U)
"RTN","TIULMED",128,0)
 ....S ORDIDX=+$P($G(^PS(55,DFN,5,IDX,.2)),U)
"RTN","TIULMED",129,0)
 ...I ID="V;I" D
"RTN","TIULMED",130,0)
 ....I $P($G(^PS(55,DFN,"IV",IDX,"AD",0)),U,4)=1 D
"RTN","TIULMED",131,0)
 .....S TMPIDX=$O(^PS(55,DFN,"IV",IDX,"AD",0)) I +TMPIDX D
"RTN","TIULMED",132,0)
 ......S TMPIDX=$P($G(^PS(55,DFN,"IV",IDX,"AD",TMPIDX,0)),U)
"RTN","TIULMED",133,0)
 ......I +TMPIDX S DRUGIDX=$$DRGIEN^TIULMED2(TMPIDX)
"RTN","TIULMED",134,0)
 ....S ORDIDX=+$P($G(^PS(55,DFN,"IV",IDX,.2)),U)
"RTN","TIULMED",135,0)
 ...S DRUGCLAS=""
"RTN","TIULMED",136,0)
 ...D GETCLASS
"RTN","TIULMED",137,0)
 ...I KEEPMED,+DRUGIDX=0,+ORDIDX,DRUGCLAS="" D
"RTN","TIULMED",138,0)
 ....S IDX=0,ISSUPPLY=2,CDONE='CLASSORT,SDONE=+SUPPLIES
"RTN","TIULMED",139,0)
 ....N LIST S LIST="TIULMED"
"RTN","TIULMED",140,0)
 ....D DRGIEN^PSS50P7(ORDIDX,"",LIST)
"RTN","TIULMED",141,0)
 ....F  S IDX=$O(^TMP($J,LIST,IDX)) Q:'IDX  D  Q:(CDONE&SDONE)
"RTN","TIULMED",142,0)
 .....S TMPCLASS=$$DRGCLASS^TIULMED2(IDX)
"RTN","TIULMED",143,0)
 .....S TMPNODE=U_TMPCLASS_U_$$DEA^TIULMED2(IDX)
"RTN","TIULMED",144,0)
 .....I 'CDONE,TMPCLASS="" S CDONE=1,DRUGCLAS=""
"RTN","TIULMED",145,0)
 .....I 'CDONE D
"RTN","TIULMED",146,0)
 ......I DRUGCLAS="" S DRUGCLAS=TMPCLASS
"RTN","TIULMED",147,0)
 ......E  I DRUGCLAS'=TMPCLASS S CDONE=1,DRUGCLAS=""
"RTN","TIULMED",148,0)
 .....I 'SDONE D
"RTN","TIULMED",149,0)
 ......S ISSUPPLY=(($E(TMPCLASS,1,2)="XA")&($P(TMPNODE,U,3)["S"))
"RTN","TIULMED",150,0)
 ......I 'ISSUPPLY S SDONE=1
"RTN","TIULMED",151,0)
 ....I 'SUPPLIES,(ISSUPPLY=1) S KEEPMED=0
"RTN","TIULMED",152,0)
 ..I (DRUGCLAS="")!('CLASSORT) S DRUGCLAS=" "
"RTN","TIULMED",153,0)
 .;
"RTN","TIULMED",154,0)
 .; *** Save wanted meds in "B" temp xref, removing duplicates ***
"RTN","TIULMED",155,0)
 .;
"RTN","TIULMED",156,0)
 .I KEEPMED D
"RTN","TIULMED",157,0)
 ..D ADDMED^TIULMED1(1) ; Get XSTR to check for duplicates
"RTN","TIULMED",158,0)
 ..;VMP OIFO BAY PINES;ELR;TIU*1.0*198;ADDED TIUXSTAT TO TMP GLOBAL
"RTN","TIULMED",159,0)
 ..S IDATE=$P(NODE,U,15)
"RTN","TIULMED",160,0)
 ..S OK='$D(@TARGET@("B",MED,XSTR,TIUXSTAT))
"RTN","TIULMED",161,0)
 ..I 'OK,(IDATE>@TARGET@("B",MED,XSTR,TIUXSTAT)) S OK=1
"RTN","TIULMED",162,0)
 ..I OK D
"RTN","TIULMED",163,0)
 ...S @TARGET@("B",MED,XSTR,TIUXSTAT)=IDATE_U_INDEX_U_MEDTYPE_STATIDX_U_TYPE_U_DRUGCLAS
"RTN","TIULMED",164,0)
 ...S EMPTY=0
"RTN","TIULMED",165,0)
 ...I DRUGCLAS=" " S UNKNOWNS=1
"RTN","TIULMED",166,0)
 ;
"RTN","TIULMED",167,0)
 ; *** Check for empty condition ***
"RTN","TIULMED",168,0)
 ;
"RTN","TIULMED",169,0)
 I EMPTY D  G LISTX
"RTN","TIULMED",170,0)
 .D ADD^TIULMED1("No Medications Found")
"RTN","TIULMED",171,0)
 .D ADD^TIULMED1(" ")
"RTN","TIULMED",172,0)
 ;
"RTN","TIULMED",173,0)
 ; *** Sort Meds in "C" temp xref - sort by Med Type, Status
"RTN","TIULMED",174,0)
 ;     Med Name, and reverse issue date, followed by a counter 
"RTN","TIULMED",175,0)
 ;     to avoid erasing meds issued on the same day
"RTN","TIULMED",176,0)
 ;
"RTN","TIULMED",177,0)
 S MED="",CNT=1000000
"RTN","TIULMED",178,0)
 F  S MED=$O(@TARGET@("B",MED)) Q:MED=""  D
"RTN","TIULMED",179,0)
 .S (XSTR,TIUXSTAT)=""
"RTN","TIULMED",180,0)
 .F  S XSTR=$O(@TARGET@("B",MED,XSTR)) Q:XSTR=""  D
"RTN","TIULMED",181,0)
 .. F  S TIUXSTAT=$O(@TARGET@("B",MED,XSTR,TIUXSTAT)) Q:TIUXSTAT=""  D
"RTN","TIULMED",182,0)
 ...S NODE=@TARGET@("B",MED,XSTR,TIUXSTAT)
"RTN","TIULMED",183,0)
 ...S DATA=$P(NODE,U,3)_U_$P(NODE,U,5)_U_MED,CNT=CNT+1
"RTN","TIULMED",184,0)
 ...S @TARGET@("C",DATA,(9999999-$P(NODE,U))_CNT)=$P(NODE,U,2)_U_$P(NODE,U,4)
"RTN","TIULMED",185,0)
 K @TARGET@("B")
"RTN","TIULMED",186,0)
 ;
"RTN","TIULMED",187,0)
 ; Read sorted data and save final version to TARGET
"RTN","TIULMED",188,0)
 ;
"RTN","TIULMED",189,0)
 S (DATA,LASTCLAS)="",(LASTMEDT,LASTSTS,COUNT,TOTAL)=0
"RTN","TIULMED",190,0)
 S $P(SPACE60," ",60)=" ",$P(DASH73,"=",73)="="
"RTN","TIULMED",191,0)
 D WARNING^TIULMED1
"RTN","TIULMED",192,0)
 F  S DATA=$O(@TARGET@("C",DATA)) Q:DATA=""  D
"RTN","TIULMED",193,0)
 .S MEDTYPE=$E(DATA),STATIDX=$E(DATA,2)
"RTN","TIULMED",194,0)
 .S DRUGCLAS=$P(DATA,U,2),MED=$P(DATA,U,3),CNT=""
"RTN","TIULMED",195,0)
 .F  S CNT=$O(@TARGET@("C",DATA,CNT)) Q:CNT=""  D
"RTN","TIULMED",196,0)
 ..S INDEX=@TARGET@("C",DATA,CNT)
"RTN","TIULMED",197,0)
 ..S TYPE=$P(INDEX,U,2),INDEX=+INDEX
"RTN","TIULMED",198,0)
 ..S NODE=^TMP("PS",$J,INDEX,0)
"RTN","TIULMED",199,0)
 ..I $P($P(NODE,U),";")["N" S $P(NODE,U,2)="Non-VA "_$P(NODE,U,2)
"RTN","TIULMED",200,0)
 ..I (MEDTYPE'=LASTMEDT)!(STATIDX'=LASTSTS) D  ; Create Header
"RTN","TIULMED",201,0)
 ...I CLASSORT'=2,DRUGCLAS'=" " S LASTCLAS=DRUGCLAS
"RTN","TIULMED",202,0)
 ...I 'HEADER Q
"RTN","TIULMED",203,0)
 ...S LASTMEDT=MEDTYPE,LASTSTS=STATIDX,TAB=0
"RTN","TIULMED",204,0)
 ...I COUNT>0 D ADD^TIULMED1(" ")
"RTN","TIULMED",205,0)
 ...I CLASSORT D ADD^TIULMED1(" ")
"RTN","TIULMED",206,0)
 ...S COUNT=0
"RTN","TIULMED",207,0)
 ...I DETAILED D
"RTN","TIULMED",208,0)
 ....I MEDTYPE=OUTPTYPE D  I 1
"RTN","TIULMED",209,0)
 .....D ADD^TIULMED1(SPACE60_"Issue Date")
"RTN","TIULMED",210,0)
 .....D ADD^TIULMED1($E($E(SPACE60,1,47)_"Status"_SPACE60,1,60)_"Last Fill")
"RTN","TIULMED",211,0)
 ....E  D ADD^TIULMED1(SPACE60_"Start Date")
"RTN","TIULMED",212,0)
 ...I 'ONELIST D
"RTN","TIULMED",213,0)
 ....S TEMP=$S(STATIDX=1:"Active",STATIDX=2:"Pending",1:"Inactive")_" "
"RTN","TIULMED",214,0)
 ...E  S TEMP=""
"RTN","TIULMED",215,0)
 ...S TEMP=TEMP_$S(MEDTYPE=INPTYPE:"Inpatient",MEDTYPE=NVATYPE:"Non-VA",1:"Outpatient")
"RTN","TIULMED",216,0)
 ...S TEMP="     "_TEMP_" Medications"
"RTN","TIULMED",217,0)
 ...I CLASSORT D
"RTN","TIULMED",218,0)
 ....I DETAILED S TEMP=TEMP_" (By Class)"
"RTN","TIULMED",219,0)
 ....E  S TEMP=TEMP_" (By Drug Class)"
"RTN","TIULMED",220,0)
 ...I DETAILED D  I 1
"RTN","TIULMED",221,0)
 ....S TEMP=$E(TEMP_SPACE60,1,47)
"RTN","TIULMED",222,0)
 ....I MEDTYPE=INPTYPE S TEMP=TEMP_"Status"
"RTN","TIULMED",223,0)
 ....E  S TEMP=TEMP_"Refills"
"RTN","TIULMED",224,0)
 ....S TEMP=$E(TEMP_SPACE60,1,60)
"RTN","TIULMED",225,0)
 ....I MEDTYPE=INPTYPE S TEMP=TEMP_"Stop Date"
"RTN","TIULMED",226,0)
 ....E  S TEMP=TEMP_"Expiration"
"RTN","TIULMED",227,0)
 ...E  D
"RTN","TIULMED",228,0)
 ....S TEMP=$E(TEMP_SPACE60,1,60)_"Status"
"RTN","TIULMED",229,0)
 ...D ADD^TIULMED1(TEMP),ADD^TIULMED1(DASH73)
"RTN","TIULMED",230,0)
 ..I CLASSORT,DRUGCLAS'="",DRUGCLAS'=LASTCLAS D
"RTN","TIULMED",231,0)
 ...S LASTCLAS=DRUGCLAS,OLDTAB=TAB,OLDHEADR=HEADER
"RTN","TIULMED",232,0)
 ...S (TAB,HEADER)=0
"RTN","TIULMED",233,0)
 ...I COUNT>0 D ADD^TIULMED1(" ")
"RTN","TIULMED",234,0)
 ...I (CLASSORT=2)!(DRUGCLAS=" ") D  I 1
"RTN","TIULMED",235,0)
 ....I DRUGCLAS=" " S TEMP="   ====== Drug Class Unknown "
"RTN","TIULMED",236,0)
 ....E  S TEMP="   ====== Drug Class: "_DRUGCLAS_" "
"RTN","TIULMED",237,0)
 ...E  S TEMP="   "
"RTN","TIULMED",238,0)
 ...S TEMP=$E(TEMP_DASH73,1,LLEN-2)
"RTN","TIULMED",239,0)
 ...D ADD^TIULMED1(TEMP)
"RTN","TIULMED",240,0)
 ...S HEADER=OLDHEADR,TAB=OLDTAB
"RTN","TIULMED",241,0)
 ..S COUNT=COUNT+1,TOTAL=TOTAL+1
"RTN","TIULMED",242,0)
 ..D ADDMED^TIULMED1(0)
"RTN","TIULMED",243,0)
 I COUNT'=TOTAL D
"RTN","TIULMED",244,0)
 .S TAB=0
"RTN","TIULMED",245,0)
 .D ADD^TIULMED1(" ")
"RTN","TIULMED",246,0)
 .D ADD^TIULMED1(TOTAL_" Total Medications")
"RTN","TIULMED",247,0)
 K @TARGET@("C")
"RTN","TIULMED",248,0)
LISTX K ^TMP("PS",$J)
"RTN","TIULMED",249,0)
 Q "~@"_$NA(@TARGET)
"RTN","TIULMED",250,0)
 ;
"RTN","TIULMED",251,0)
GETCLASS ;
"RTN","TIULMED",252,0)
 D GETCLASS^TIULMED3
"RTN","TIULMED",253,0)
 Q
"RTN","TIULMED1")
0^2^B38886154^B38859055
"RTN","TIULMED1",1,0)
TIULMED1 ; SLC/JM - Active/Recent Med Objects Routine ;2/7/2000
"RTN","TIULMED1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**38,73,92,94,202**;Jun 20, 1997
"RTN","TIULMED1",3,0)
 ;
"RTN","TIULMED1",4,0)
 ; All routines here are part of the LIST entry point of TIULMED
"RTN","TIULMED1",5,0)
 ;
"RTN","TIULMED1",6,0)
ADD(TXT) ; Saves TXT in TARGET
"RTN","TIULMED1",7,0)
 S NEXTLINE=NEXTLINE+1
"RTN","TIULMED1",8,0)
 I TAB S TXT="  "_TXT
"RTN","TIULMED1",9,0)
 I TAB,HEADER S TXT="     "_TXT
"RTN","TIULMED1",10,0)
 S @TARGET@(NEXTLINE,0)=TXT
"RTN","TIULMED1",11,0)
 Q
"RTN","TIULMED1",12,0)
ADDLNUM(TXT) ; Add text with Line Number added to front of string
"RTN","TIULMED1",13,0)
 S TAB=0
"RTN","TIULMED1",14,0)
 I HEADER D ADD($E(COUNT_")     ",1,5)_TXT) I 1
"RTN","TIULMED1",15,0)
 E  D ADD(TXT)
"RTN","TIULMED1",16,0)
 S TAB=1
"RTN","TIULMED1",17,0)
 Q
"RTN","TIULMED1",18,0)
ADDL(TXT) ; Add with ADDLNUM on FIRST
"RTN","TIULMED1",19,0)
 I FIRST D  I 1
"RTN","TIULMED1",20,0)
 .D ADDLNUM(TXT)
"RTN","TIULMED1",21,0)
 .S FIRST=0
"RTN","TIULMED1",22,0)
 E  D ADD(TXT)
"RTN","TIULMED1",23,0)
 Q
"RTN","TIULMED1",24,0)
ADDMED(XMODE) ; if XMODE creates XSTR, if not add med to TARGET
"RTN","TIULMED1",25,0)
 N DATA,FIRST,XSUM,XCOUNT,TOPLINE,WSTATUS
"RTN","TIULMED1",26,0)
 S FIRST=1
"RTN","TIULMED1",27,0)
 I XMODE S (XSUM,XCOUNT)=0,XSTR=""
"RTN","TIULMED1",28,0)
 E  D
"RTN","TIULMED1",29,0)
 .S TOPLINE=NEXTLINE+1,DATA="",WSTATUS=0
"RTN","TIULMED1",30,0)
 .D ADDP(2)
"RTN","TIULMED1",31,0)
 I TYPE="UD" D  I 1 ; Unit Dose Meds
"RTN","TIULMED1",32,0)
 .I 'XMODE D
"RTN","TIULMED1",33,0)
 ..I DETAILED D FLUSH S DATA="Give:"
"RTN","TIULMED1",34,0)
 ..S DATA=DATA_" "
"RTN","TIULMED1",35,0)
 .I $$PL(6) D ADDP(6) I 1
"RTN","TIULMED1",36,0)
 .E  I $$PL(7) D ADDP(7) I 1
"RTN","TIULMED1",37,0)
 .E  D ADDM("SIG")
"RTN","TIULMED1",38,0)
 .D ADDM("MDR"),ADDM("SCH")
"RTN","TIULMED1",39,0)
 .I DETAILED D FLUSH
"RTN","TIULMED1",40,0)
 .D ADDM("SIO")
"RTN","TIULMED1",41,0)
 E  I TYPE="OP" D  I 1 ; Outpatient Meds
"RTN","TIULMED1",42,0)
 .I 'XMODE,DETAILED D
"RTN","TIULMED1",43,0)
 ..I $$PL(12) D
"RTN","TIULMED1",44,0)
 ...S DATA=DATA_"  Qty:"
"RTN","TIULMED1",45,0)
 ...D ADDP(12)
"RTN","TIULMED1",46,0)
 ..I $$PL(11) D
"RTN","TIULMED1",47,0)
 ...S DATA=$$STRIP(DATA_" for")
"RTN","TIULMED1",48,0)
 ...D ADDP(11)
"RTN","TIULMED1",49,0)
 ...S DATA=$$STRIP(DATA_" days")
"RTN","TIULMED1",50,0)
 ..D WRAP
"RTN","TIULMED1",51,0)
 .I $$ML("SIG") D  I 1
"RTN","TIULMED1",52,0)
 ..I 'XMODE,DETAILED S DATA=$$STRIP(DATA_"  Sig:")
"RTN","TIULMED1",53,0)
 ..D ADDM("SIG")
"RTN","TIULMED1",54,0)
 .E  D ADDM("SIO"),ADDM("MDR"),ADDM("SCH")
"RTN","TIULMED1",55,0)
 E  I TYPE="IV" D  ; IV meds
"RTN","TIULMED1",56,0)
 .I DETAILED D FLUSH
"RTN","TIULMED1",57,0)
 .D ADDM("A")
"RTN","TIULMED1",58,0)
 .I $$ML("B") D
"RTN","TIULMED1",59,0)
 ..I 'XMODE S DATA=$$STRIP(DATA_" in")
"RTN","TIULMED1",60,0)
 ..D ADDM("B")
"RTN","TIULMED1",61,0)
 .D ADDP(3)
"RTN","TIULMED1",62,0)
 .I DETAILED D FLUSH
"RTN","TIULMED1",63,0)
 .D ADDM("SIO")
"RTN","TIULMED1",64,0)
 .D FLUSH
"RTN","TIULMED1",65,0)
 .I 'XMODE D
"RTN","TIULMED1",66,0)
 ..N I
"RTN","TIULMED1",67,0)
 ..F I=TOPLINE:1:NEXTLINE S @TARGET@(I,0)=$TR(@TARGET@(I,0),U," ")
"RTN","TIULMED1",68,0)
 I XMODE D  I 1
"RTN","TIULMED1",69,0)
 .I XSTR="" S XSTR="_"
"RTN","TIULMED1",70,0)
 .E  I $L(XSTR)>80 S XSTR=$E(XCOUNT_"_"_XSUM_"_"_XSTR,1,80)
"RTN","TIULMED1",71,0)
 E  D
"RTN","TIULMED1",72,0)
 .D FLUSH
"RTN","TIULMED1",73,0)
 .S WSTATUS=1
"RTN","TIULMED1",74,0)
 .D ADDP(9)
"RTN","TIULMED1",75,0)
 .S WSTATUS=0
"RTN","TIULMED1",76,0)
 .I DETAILED D
"RTN","TIULMED1",77,0)
 ..D ADDDATE(TOPLINE,$S(MEDTYPE=OUTPTYPE:"Issu",1:"Strt"),15)
"RTN","TIULMED1",78,0)
 ..I MEDTYPE=OUTPTYPE D  I 1
"RTN","TIULMED1",79,0)
 ...N I
"RTN","TIULMED1",80,0)
 ...I TOPLINE=NEXTLINE S I=TOPLINE+1
"RTN","TIULMED1",81,0)
 ...E  I $L(@TARGET@(TOPLINE+1,0))<48 S I=TOPLINE+1
"RTN","TIULMED1",82,0)
 ...E  S I=TOPLINE+2
"RTN","TIULMED1",83,0)
 ...F  Q:(I'>NEXTLINE)  D ADD(" ")
"RTN","TIULMED1",84,0)
 ...S @TARGET@(I,0)=$E(@TARGET@(I,0)_SPACE60,1,47)_"Refills: "_+$P(NODE,U,5)
"RTN","TIULMED1",85,0)
 ...D ADDDATE(TOPLINE+1,"Last",10)
"RTN","TIULMED1",86,0)
 ...D ADDDATE(TOPLINE+2,"Expr",4)
"RTN","TIULMED1",87,0)
 ..E  D
"RTN","TIULMED1",88,0)
 ...D ADDDATE(TOPLINE+1,"Stop",4)
"RTN","TIULMED1",89,0)
 Q
"RTN","TIULMED1",90,0)
FDT(PNUM) ;Returns formatted date from piece number
"RTN","TIULMED1",91,0)
 N X,Y
"RTN","TIULMED1",92,0)
 S Y=$P(NODE,U,PNUM)
"RTN","TIULMED1",93,0)
 S X=$E(Y,4,5)_"-"_$E(Y,6,7)_"-"_$E($E(Y,1,3)+1700,3,4)
"RTN","TIULMED1",94,0)
 Q X
"RTN","TIULMED1",95,0)
ADDDATE(LINENUM,TXT,PNUM) ;Add date to TARGET
"RTN","TIULMED1",96,0)
 I $$PL(PNUM) D
"RTN","TIULMED1",97,0)
 .F  Q:(LINENUM'>NEXTLINE)  D ADD(" ")
"RTN","TIULMED1",98,0)
 .S @TARGET@(LINENUM,0)=$E(@TARGET@(LINENUM,0)_SPACE60,1,60)_TXT_":"_$$FDT(PNUM)
"RTN","TIULMED1",99,0)
 Q
"RTN","TIULMED1",100,0)
XSUMS(STR,NOADD) ; XSUMs a string
"RTN","TIULMED1",101,0)
 N IDX,LEN
"RTN","TIULMED1",102,0)
 S LEN=$L(STR) I LEN'>0 Q
"RTN","TIULMED1",103,0)
 I '$G(NOADD),$L(XSTR)<99 S XSTR=XSTR_STR
"RTN","TIULMED1",104,0)
 F IDX=1:1:LEN S XCOUNT=XCOUNT+1,XSUM=XSUM+($A(STR,IDX)*XCOUNT)
"RTN","TIULMED1",105,0)
 Q
"RTN","TIULMED1",106,0)
WRAP ; Wraps DATA to the output
"RTN","TIULMED1",107,0)
 I XMODE Q
"RTN","TIULMED1",108,0)
 N IDX,LEN,MAX,DATA1,DONE
"RTN","TIULMED1",109,0)
 S DONE=0
"RTN","TIULMED1",110,0)
 F  Q:DONE  D
"RTN","TIULMED1",111,0)
 .I WSTATUS S MAX=13
"RTN","TIULMED1",112,0)
 .E  D
"RTN","TIULMED1",113,0)
 ..I FIRST S MAX=41
"RTN","TIULMED1",114,0)
 ..E  S MAX=39
"RTN","TIULMED1",115,0)
 ..I 'HEADER S MAX=MAX+5
"RTN","TIULMED1",116,0)
 ..I 'DETAILED S MAX=MAX+13
"RTN","TIULMED1",117,0)
 .S LEN=$L(DATA)
"RTN","TIULMED1",118,0)
 .I 'WSTATUS,LEN<MAX S DONE=1 Q
"RTN","TIULMED1",119,0)
 .I LEN<MAX S IDX=LEN
"RTN","TIULMED1",120,0)
 .E  F IDX=MAX:-1:2 Q:$E(DATA,IDX)=" "
"RTN","TIULMED1",121,0)
 .I IDX<3 S IDX=MAX-1
"RTN","TIULMED1",122,0)
 .S DATA1=$$STRIP($E(DATA,1,IDX))
"RTN","TIULMED1",123,0)
 .I WSTATUS D  I 1
"RTN","TIULMED1",124,0)
 ..S @TARGET@(TOPLINE,0)=$E(@TARGET@(TOPLINE,0)_SPACE60,1,LLEN)_DATA1
"RTN","TIULMED1",125,0)
 .E  D ADDL(DATA1)
"RTN","TIULMED1",126,0)
 .S DATA=$$STRIP($E(DATA,IDX+1,999))
"RTN","TIULMED1",127,0)
 .I WSTATUS D
"RTN","TIULMED1",128,0)
 ..S DONE=1,WSTATUS=0
"RTN","TIULMED1",129,0)
 ..I $L(DATA)>0 D
"RTN","TIULMED1",130,0)
 ...I TOPLINE'<NEXTLINE D ADD(" ")
"RTN","TIULMED1",131,0)
 ...S @TARGET@(TOPLINE+1,0)=$E(@TARGET@(TOPLINE+1,0)_SPACE60,1,LLEN)_DATA
"RTN","TIULMED1",132,0)
 ...S DATA=""
"RTN","TIULMED1",133,0)
 Q
"RTN","TIULMED1",134,0)
STRIP(X) ; Removes Leading and Trialing Spaces
"RTN","TIULMED1",135,0)
 F  Q:$E(X)'=" "  S X=$E(X,2,999)
"RTN","TIULMED1",136,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,$L(X)-1)
"RTN","TIULMED1",137,0)
 Q X
"RTN","TIULMED1",138,0)
ADDP(PNUM) ; Adds or XSUMs a piece of NODE
"RTN","TIULMED1",139,0)
 I XMODE D  I 1
"RTN","TIULMED1",140,0)
 .D XSUMS(PNUM,1)
"RTN","TIULMED1",141,0)
 .D XSUMS($P(NODE,U,PNUM))
"RTN","TIULMED1",142,0)
 E  D
"RTN","TIULMED1",143,0)
 .N VALUE
"RTN","TIULMED1",144,0)
 .S VALUE=$P(NODE,U,PNUM)
"RTN","TIULMED1",145,0)
 .I PNUM=9,VALUE="ACTIVE/SUSP" S VALUE="ACTIVE (S)"
"RTN","TIULMED1",146,0)
 .S DATA=$$STRIP(DATA_" "_VALUE)
"RTN","TIULMED1",147,0)
 .D WRAP
"RTN","TIULMED1",148,0)
 Q
"RTN","TIULMED1",149,0)
ADDM(SUB,FORCE) ; Adds or XSUMs Multiple
"RTN","TIULMED1",150,0)
 N IDX
"RTN","TIULMED1",151,0)
 S IDX=0
"RTN","TIULMED1",152,0)
 I XMODE D  I 1
"RTN","TIULMED1",153,0)
 .D XSUMS(SUB,1)
"RTN","TIULMED1",154,0)
 .F  S IDX=$O(^TMP("PS",$J,INDEX,SUB,IDX)) Q:IDX=""  D
"RTN","TIULMED1",155,0)
 ..D XSUMS(^TMP("PS",$J,INDEX,SUB,IDX,0))
"RTN","TIULMED1",156,0)
 E  D
"RTN","TIULMED1",157,0)
 .I $G(FORCE),DETAILED  D FLUSH
"RTN","TIULMED1",158,0)
 .F  S IDX=$O(^TMP("PS",$J,INDEX,SUB,IDX)) Q:IDX=""  D
"RTN","TIULMED1",159,0)
 ..S DATA=$$STRIP(DATA_" "_^TMP("PS",$J,INDEX,SUB,IDX,0))
"RTN","TIULMED1",160,0)
 ..D WRAP
"RTN","TIULMED1",161,0)
 Q
"RTN","TIULMED1",162,0)
FLUSH ; Flush the DATA buffer
"RTN","TIULMED1",163,0)
 I 'XMODE,DATA'="" D
"RTN","TIULMED1",164,0)
 .D WRAP
"RTN","TIULMED1",165,0)
 .I DATA'="" D ADDL(DATA) S DATA=""
"RTN","TIULMED1",166,0)
 Q
"RTN","TIULMED1",167,0)
PL(PNUM) ;Retuns length of peice
"RTN","TIULMED1",168,0)
 Q $L($P(NODE,U,PNUM))
"RTN","TIULMED1",169,0)
ML(SUB) ;Returns true if multiple exists and contains data
"RTN","TIULMED1",170,0)
 N IDX,ML
"RTN","TIULMED1",171,0)
 S (IDX,ML)=0
"RTN","TIULMED1",172,0)
 F  S IDX=$O(^TMP("PS",$J,INDEX,SUB,IDX)) Q:(IDX="")!ML  D
"RTN","TIULMED1",173,0)
 .I $L(^TMP("PS",$J,INDEX,SUB,IDX,0)) S ML=1
"RTN","TIULMED1",174,0)
 Q ML
"RTN","TIULMED1",175,0)
ADDTITLE ;Adds a title line indicating which meds are in the list
"RTN","TIULMED1",176,0)
 N MSG,ALL,SUP,SUPFX
"RTN","TIULMED1",177,0)
 I ACTVONLY<2 S MSG="Active"
"RTN","TIULMED1",178,0)
 E  S MSG=""
"RTN","TIULMED1",179,0)
 I '+ACTVONLY S MSG=MSG_" and "
"RTN","TIULMED1",180,0)
 I ACTVONLY'=1 S MSG=MSG_"Recently Expired"
"RTN","TIULMED1",181,0)
 S ALL=ALLMEDS
"RTN","TIULMED1",182,0)
 I ALL=0 D
"RTN","TIULMED1",183,0)
 .I ISINP S ALL=2
"RTN","TIULMED1",184,0)
 .E  S ALL=3
"RTN","TIULMED1",185,0)
 S MSG=MSG_" "
"RTN","TIULMED1",186,0)
 I ALL'=3 S MSG=MSG_"Inpatient"
"RTN","TIULMED1",187,0)
 I ALL=1 S MSG=MSG_" and "
"RTN","TIULMED1",188,0)
 I ALL'=2 S MSG=MSG_"Outpatient"
"RTN","TIULMED1",189,0)
 S MSG=MSG_" Medications"
"RTN","TIULMED1",190,0)
 I SUPPLIES S SUPFX="in"
"RTN","TIULMED1",191,0)
 E  S SUPFX="ex"
"RTN","TIULMED1",192,0)
 S SUPFX="("_SUPFX_"cluding Supplies):"
"RTN","TIULMED1",193,0)
 I $L(MSG)>51 D  I 1
"RTN","TIULMED1",194,0)
 .D ADD(MSG)
"RTN","TIULMED1",195,0)
 .D ADD(SUPFX)
"RTN","TIULMED1",196,0)
 E  D
"RTN","TIULMED1",197,0)
 .S MSG=MSG_" "_SUPFX
"RTN","TIULMED1",198,0)
 .D ADD(MSG)
"RTN","TIULMED1",199,0)
 D ADD(" ")
"RTN","TIULMED1",200,0)
 Q
"RTN","TIULMED1",201,0)
WARNING ;Inserts warning about CLASSORT if needed
"RTN","TIULMED1",202,0)
 I CLASSORT D
"RTN","TIULMED1",203,0)
 .N MSG
"RTN","TIULMED1",204,0)
 .D ADD("* *  WARNING  * * Sorting by drug class may not be accurate!")
"RTN","TIULMED1",205,0)
 .D ADD("Medications belonging to multiple drug classes will only be listed")
"RTN","TIULMED1",206,0)
 .S MSG="under a single drug class."
"RTN","TIULMED1",207,0)
 .I UNKNOWNS S MSG=MSG_"  In addition, the system is not able to"
"RTN","TIULMED1",208,0)
 .D ADD(MSG)
"RTN","TIULMED1",209,0)
 .I UNKNOWNS D ADD("determine the drug class of some medications.")
"RTN","TIULMED1",210,0)
 Q
"RTN","TIUTPBN")
0^3^B63654050^B63628833
"RTN","TIUTPBN",1,0)
TIUTPBN ; SLC/AJB - Trans Pharm Care Note ; July 29, 2003 [3/16/04 1:37pm]
"RTN","TIUTPBN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**170,183,202**;Jun 20, 1997
"RTN","TIUTPBN",3,0)
 ;
"RTN","TIUTPBN",4,0)
 Q
"RTN","TIUTPBN",5,0)
EN ;
"RTN","TIUTPBN",6,0)
 X ^%ZOSF("EON") W IOCUON,@IOF
"RTN","TIUTPBN",7,0)
 N FDA,FDAIEN,MSG,POP,TIUDA,TIUFPRIV,TIUIEN,TIUPRNT,TIUTMP
"RTN","TIUTPBN",8,0)
 D PRE
"RTN","TIUTPBN",9,0)
 I $$CHKTITLE(142.5,"TIU TPBN FUTURE APPTS")<0 D  G EXIT
"RTN","TIUTPBN",10,0)
 . W !!,"The Health Summary Object did not install correctly."
"RTN","TIUTPBN",11,0)
 . W !,"Installation cannot continue."
"RTN","TIUTPBN",12,0)
 S TIUFPRIV=1
"RTN","TIUTPBN",13,0)
 S TIUIEN=$$CHKTITLE(8925.1,"TRANSITIONAL PHARMACY BENEFIT NOTE")
"RTN","TIUTPBN",14,0)
 S TIUIEN=$S(TIUIEN>0:TIUIEN,1:"+1")
"RTN","TIUTPBN",15,0)
 I $$CHKTITLE(8930,"CLINICAL COORDINATOR")<0 W !!,"Installation Error:  Class owner cannot be defined.",! G EXIT
"RTN","TIUTPBN",16,0)
 I TIUIEN="+1" F  D  Q:TIUPRNT>0!($D(DUOUT))
"RTN","TIUTPBN",17,0)
 . D GETCLASS
"RTN","TIUTPBN",18,0)
 . I $D(DUOUT) W !!,"Installation Aborted by User." S XPDABORT=1 Q
"RTN","TIUTPBN",19,0)
 . I +TIUPRNT<0 W !!,"Installation Error:  Invalid Selection.",!
"RTN","TIUTPBN",20,0)
 . I  W !,"A DOCUMENT CLASS must be entered or '^' to abort."
"RTN","TIUTPBN",21,0)
 I +$G(TIUPRNT)<0 G EXIT
"RTN","TIUTPBN",22,0)
 I $$MKOBJS<0 Q
"RTN","TIUTPBN",23,0)
 S FDA(8925.1,TIUIEN_",",.01)="TRANSITIONAL PHARMACY BENEFIT NOTE"
"RTN","TIUTPBN",24,0)
 S FDA(8925.1,TIUIEN_",",.02)=""
"RTN","TIUTPBN",25,0)
 S FDA(8925.1,TIUIEN_",",.03)="TRANSITIONAL PHARMACY BENEFIT NOTE"
"RTN","TIUTPBN",26,0)
 S FDA(8925.1,TIUIEN_",",.04)="DOC"
"RTN","TIUTPBN",27,0)
 S FDA(8925.1,TIUIEN_",",.05)=""
"RTN","TIUTPBN",28,0)
 S FDA(8925.1,TIUIEN_",",.06)=$$CHKTITLE(8930,"CLINICAL COORDINATOR")
"RTN","TIUTPBN",29,0)
 S FDA(8925.1,TIUIEN_",",.07)=13
"RTN","TIUTPBN",30,0)
 S FDA(8925.1,TIUIEN_",",3.02)=1
"RTN","TIUTPBN",31,0)
 S FDA(8925.1,TIUIEN_",",99)=$H
"RTN","TIUTPBN",32,0)
 D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUTPBN",33,0)
 I $D(MSG) D  Q
"RTN","TIUTPBN",34,0)
 . W !!,"The following error message was returned:",!!
"RTN","TIUTPBN",35,0)
 . S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUTPBN",36,0)
 W !!,"Creation of TRANSITIONAL PHARMACY BENEFIT NOTE title successful...",! H 1
"RTN","TIUTPBN",37,0)
 I TIUIEN="+1" D
"RTN","TIUTPBN",38,0)
 . S TIUDA=FDAIEN(1)
"RTN","TIUTPBN",39,0)
 . S FDA(8925.14,"+2,"_TIUPRNT_",",.01)=FDAIEN(1)
"RTN","TIUTPBN",40,0)
 . S FDA(8925.14,"+2,"_TIUPRNT_",",4)="Transitional Pharmacy Benefit Note"
"RTN","TIUTPBN",41,0)
 . D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUTPBN",42,0)
 . I $D(MSG) D  S XPDABORT=1 Q
"RTN","TIUTPBN",43,0)
 .. W !!,"The following error message was returned:",!!
"RTN","TIUTPBN",44,0)
 .. S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUTPBN",45,0)
 . W !,"Addition of "_$P(^TIU(8925.1,TIUPRNT,0),U)_" as parent successful...",! H 1
"RTN","TIUTPBN",46,0)
 I $G(TIUDA)="" S TIUDA=TIUIEN
"RTN","TIUTPBN",47,0)
 D GETBOIL
"RTN","TIUTPBN",48,0)
 K FDAIEN
"RTN","TIUTPBN",49,0)
 S FDAIEN(TIUDA)=TIUDA
"RTN","TIUTPBN",50,0)
 S FDA(8925.1,TIUDA_",",3)="TIUTMP"
"RTN","TIUTPBN",51,0)
 D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUTPBN",52,0)
 I $D(MSG) D  Q
"RTN","TIUTPBN",53,0)
 . W !!,"The following error message was returned:",!!
"RTN","TIUTPBN",54,0)
 . S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUTPBN",55,0)
 W !,"Boilerplate text and objects added successfully.",!
"RTN","TIUTPBN",56,0)
 W !,"Update finished.",!
"RTN","TIUTPBN",57,0)
 W !,"*** The TRANSITIONAL PHARMACY BENEFIT NOTE title must be"
"RTN","TIUTPBN",58,0)
 W !,"*** activated before use.",!
"RTN","TIUTPBN",59,0)
EXIT D
"RTN","TIUTPBN",60,0)
 .N DIR,X,Y
"RTN","TIUTPBN",61,0)
 .S DIR(0)="E"
"RTN","TIUTPBN",62,0)
 .W ! D ^DIR
"RTN","TIUTPBN",63,0)
 Q
"RTN","TIUTPBN",64,0)
ADD(TXT) ;
"RTN","TIUTPBN",65,0)
 S NEXTLINE=NEXTLINE+1
"RTN","TIUTPBN",66,0)
 S @TARGET@(NEXTLINE,0)=TXT
"RTN","TIUTPBN",67,0)
 Q
"RTN","TIUTPBN",68,0)
ADDSTR(STR1,STR2,MAX) ;
"RTN","TIUTPBN",69,0)
 N CNT,DONE,TMP
"RTN","TIUTPBN",70,0)
 S CNT=0,(DONE,TMP)=""
"RTN","TIUTPBN",71,0)
 I '$D(STR2) D ADD(STR1) Q
"RTN","TIUTPBN",72,0)
 I $L(STR1)<MAX S $P(TMP," ",MAX-$L(STR1))=" ",STR1=STR1_TMP D ADD(STR1_STR2) Q
"RTN","TIUTPBN",73,0)
 E  F  D  Q:DONE=1
"RTN","TIUTPBN",74,0)
 .N TMPSTR S TMPSTR=""
"RTN","TIUTPBN",75,0)
 .I $L(STR1)=MAX,$E(STR1,MAX)=" " S DONE=1 D ADD(STR1_STR2) Q
"RTN","TIUTPBN",76,0)
 .F  D  Q:DONE=1
"RTN","TIUTPBN",77,0)
 ..S CNT=CNT+1
"RTN","TIUTPBN",78,0)
 ..I $L(TMPSTR_$P(STR1," ",CNT)_" ")<60 S TMPSTR=TMPSTR_$P(STR1," ",CNT)_" "
"RTN","TIUTPBN",79,0)
 ..E  S DONE=1,TMP="",$P(TMP," ",MAX-$L(TMPSTR))=" ",TMPSTR=TMPSTR_TMP D ADD(TMPSTR_STR2),ADD($P(STR1," ",CNT,999))
"RTN","TIUTPBN",80,0)
 Q
"RTN","TIUTPBN",81,0)
AOPMEDS(DFN,TARGET) ;
"RTN","TIUTPBN",82,0)
 N DRUG,EMPTY,INDEX,NEXTLINE,NODE,TIUSTAT,TIUSTATS,TMP,NVAMED,NVASTR
"RTN","TIUTPBN",83,0)
 S EMPTY=1,NEXTLINE=0
"RTN","TIUTPBN",84,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","TIUTPBN",85,0)
 S TIUSTATS="^ACTIVE^REFILL^HOLD^PROVIDER HOLD^ON CALL^ACTIVE (S)^NON-VERIFIED^DRUG INTERACTIONS^INCOMPLETE^PENDING^"
"RTN","TIUTPBN",86,0)
 S INDEX=0
"RTN","TIUTPBN",87,0)
 F  S INDEX=$O(^TMP("PS",$J,INDEX))  Q:INDEX'>0  D
"RTN","TIUTPBN",88,0)
 .S NODE=$G(^TMP("PS",$J,INDEX,0))
"RTN","TIUTPBN",89,0)
 .I '($L($P(NODE,U,2))>0) Q
"RTN","TIUTPBN",90,0)
 .I $P(NODE,U)'["O" Q
"RTN","TIUTPBN",91,0)
 .S TIUSTAT=$P(NODE,U,9) I TIUSTAT="ACTIVE/SUSP" S TIUSTAT="ACTIVE (S)",$P(NODE,U,9)=TIUSTAT
"RTN","TIUTPBN",92,0)
 .I $F(TIUSTATS,"^"_TIUSTAT_"^")=0 Q
"RTN","TIUTPBN",93,0)
 .S EMPTY=0
"RTN","TIUTPBN",94,0)
 .S TMP($P(NODE,U,2),INDEX)=NODE
"RTN","TIUTPBN",95,0)
 .S TMP($P(NODE,U,2),INDEX,"P")=$P($G(^TMP("PS",$J,INDEX,"P",0)),U,2)
"RTN","TIUTPBN",96,0)
 .I ^TMP("PS",$J,INDEX,"SIG",0)>0 D
"RTN","TIUTPBN",97,0)
 ..N TIUSIG S TIUSIG=0
"RTN","TIUTPBN",98,0)
 ..F  S TIUSIG=$O(^TMP("PS",$J,INDEX,"SIG",TIUSIG)) Q:TIUSIG=""  S TMP($P(NODE,U,2),INDEX,"SIG",TIUSIG)=^TMP("PS",$J,INDEX,"SIG",TIUSIG,0)
"RTN","TIUTPBN",99,0)
 ;
"RTN","TIUTPBN",100,0)
 S (DRUG,INDEX)=0
"RTN","TIUTPBN",101,0)
 F  S DRUG=$O(TMP(DRUG)) Q:DRUG=""  F  S INDEX=$O(TMP(DRUG,INDEX)) Q:INDEX=""  D
"RTN","TIUTPBN",102,0)
 . S NODE=TMP(DRUG,INDEX)
"RTN","TIUTPBN",103,0)
 . D ADDSTR("")
"RTN","TIUTPBN",104,0)
 . N SIG S SIG=0
"RTN","TIUTPBN",105,0)
 . S NVASTR=""
"RTN","TIUTPBN",106,0)
 . S NVAMED=$P($P(NODE,U),";")
"RTN","TIUTPBN",107,0)
 . S NVAMED=$E(NVAMED,$L(NVAMED))
"RTN","TIUTPBN",108,0)
 . I NVAMED="N" S NVASTR="Non-VA "
"RTN","TIUTPBN",109,0)
 . F  S SIG=$O(TMP(DRUG,INDEX,"SIG",SIG)) Q:SIG=""  D
"RTN","TIUTPBN",110,0)
 ..I SIG=1 D ADDSTR(NVASTR_DRUG_" "_TMP(DRUG,INDEX,"SIG",SIG),$P(NODE,U,9),60)
"RTN","TIUTPBN",111,0)
 ..I SIG'=1 D ADDSTR(TMP(DRUG,INDEX,"SIG",SIG))
"RTN","TIUTPBN",112,0)
 . D ADDSTR(" # Refills: "_$P(NODE,U,5)," Quantity: "_$P(NODE,U,12),30)
"RTN","TIUTPBN",113,0)
 . D ADDSTR("Issue Date: "_$$FMTE^XLFDT($P(NODE,U,15))," Provider: "_TMP(DRUG,INDEX,"P"),30)
"RTN","TIUTPBN",114,0)
 ;
"RTN","TIUTPBN",115,0)
 I EMPTY D
"RTN","TIUTPBN",116,0)
 .D ADDSTR(""),ADDSTR("No Medications Found"),ADDSTR("")
"RTN","TIUTPBN",117,0)
 K ^TMP("PS",$J)
"RTN","TIUTPBN",118,0)
 Q "~@"_$NA(@TARGET)
"RTN","TIUTPBN",119,0)
GETBOIL ;
"RTN","TIUTPBN",120,0)
 N LINE,LINETXT
"RTN","TIUTPBN",121,0)
 F LINE=1:1 S LINETXT=$P($T(BOILTXT+LINE),";;",2) Q:LINETXT="EOM"  S TIUTMP(LINE)=LINETXT
"RTN","TIUTPBN",122,0)
 Q
"RTN","TIUTPBN",123,0)
BOILTXT ;
"RTN","TIUTPBN",124,0)
 ;;This patient has been identified as a new patient waiting for care from
"RTN","TIUTPBN",125,0)
 ;;the VA and is eligible for the transitional pharmacy program.
"RTN","TIUTPBN",126,0)
 ;;
"RTN","TIUTPBN",127,0)
 ;;Patient Name:  |PATIENT NAME|
"RTN","TIUTPBN",128,0)
 ;;SSN:           |PATIENT SSN|
"RTN","TIUTPBN",129,0)
 ;;Age:           |PATIENT AGE|
"RTN","TIUTPBN",130,0)
 ;;
"RTN","TIUTPBN",131,0)
 ;;Primary Care Provider:  |TIU TPBN PCP|
"RTN","TIUTPBN",132,0)
 ;;
"RTN","TIUTPBN",133,0)
 ;;Allergies/Adverse Reactions:
"RTN","TIUTPBN",134,0)
 ;;|ALLERGIES/ADR|
"RTN","TIUTPBN",135,0)
 ;;
"RTN","TIUTPBN",136,0)
 ;;Rx(s):
"RTN","TIUTPBN",137,0)
 ;;|TIU TPBN ACT OUT MEDS|
"RTN","TIUTPBN",138,0)
 ;;
"RTN","TIUTPBN",139,0)
 ;;Over-the-counter drugs or drugs not issued by VA but currently taking 
"RTN","TIUTPBN",140,0)
 ;;(Please List):
"RTN","TIUTPBN",141,0)
 ;;
"RTN","TIUTPBN",142,0)
 ;;
"RTN","TIUTPBN",143,0)
 ;;
"RTN","TIUTPBN",144,0)
 ;;Non-formulary Rx requested, not filled:
"RTN","TIUTPBN",145,0)
 ;;
"RTN","TIUTPBN",146,0)
 ;;
"RTN","TIUTPBN",147,0)
 ;;
"RTN","TIUTPBN",148,0)
 ;;Formulary Alternatives Recommended:
"RTN","TIUTPBN",149,0)
 ;;
"RTN","TIUTPBN",150,0)
 ;;
"RTN","TIUTPBN",151,0)
 ;;
"RTN","TIUTPBN",152,0)
 ;;Next appointment(s):
"RTN","TIUTPBN",153,0)
 ;;|TIU TPBN FUTURE APPTS|
"RTN","TIUTPBN",154,0)
 ;;
"RTN","TIUTPBN",155,0)
 ;;
"RTN","TIUTPBN",156,0)
 ;;Counseling:
"RTN","TIUTPBN",157,0)
 ;;
"RTN","TIUTPBN",158,0)
 ;;The patient and/or the patient's caregiver was offered counseling on
"RTN","TIUTPBN",159,0)
 ;;drug, dosage, schedule, route of administration, storage, potential 
"RTN","TIUTPBN",160,0)
 ;;side effects, significant drug interactions, and the procedure for 
"RTN","TIUTPBN",161,0)
 ;;obtaining refill prescriptions.
"RTN","TIUTPBN",162,0)
 ;;
"RTN","TIUTPBN",163,0)
 ;;Counseling was [] Provided     [] Refused
"RTN","TIUTPBN",164,0)
 ;;EOM
"RTN","TIUTPBN",165,0)
 Q
"RTN","TIUTPBN",166,0)
CHKTITLE(FILE,NAME) ;
"RTN","TIUTPBN",167,0)
 N DIC,X,Y
"RTN","TIUTPBN",168,0)
 S DIC=FILE,DIC(0)="X"
"RTN","TIUTPBN",169,0)
 S X=NAME
"RTN","TIUTPBN",170,0)
 D ^DIC
"RTN","TIUTPBN",171,0)
 Q +Y
"RTN","TIUTPBN",172,0)
GETCLASS ;
"RTN","TIUTPBN",173,0)
 N DIC,X,Y
"RTN","TIUTPBN",174,0)
 S DIC("A")="Select the DOCUMENT CLASS where the new title will be installed:  "
"RTN","TIUTPBN",175,0)
 S DIC(0)="AEQ",DIC="^TIU(8925.1,",DIC("S")="I $P(^(0),U,4)=""DC"""
"RTN","TIUTPBN",176,0)
 W ! D ^DIC
"RTN","TIUTPBN",177,0)
 S TIUPRNT=+Y
"RTN","TIUTPBN",178,0)
 Q
"RTN","TIUTPBN",179,0)
MKOBJS() ;
"RTN","TIUTPBN",180,0)
 N TIUHSO
"RTN","TIUTPBN",181,0)
 S TIUHSO=$$CHKTITLE(142.5,"TIU TPBN FUTURE APPTS")
"RTN","TIUTPBN",182,0)
 I $$MKOBJ("TIU TPBN ACT OUT MEDS","S X=$$AOPMEDS^TIUTPBN(DFN,""^TMP(""""TIUMED"""",$J)"")")<0 D  Q -1
"RTN","TIUTPBN",183,0)
 . W !!,"Installation Error:  TIU Object creation failed.",!
"RTN","TIUTPBN",184,0)
 I $$MKOBJ("TIU TPBN FUTURE APPTS","S X=$$TIU^GMTSOBJ(DFN,"_TIUHSO_")")<0 D  Q -1
"RTN","TIUTPBN",185,0)
 . W !!,"Installation Error:  TIU Object creation failed.",!
"RTN","TIUTPBN",186,0)
 I $$MKOBJ("TIU TPBN PCP","S X=$P($$OUTPTPR^SDUTL3(DFN,DT),U,2)")<0 D  Q -1
"RTN","TIUTPBN",187,0)
 . W !!,"Installation Error:  TIU Object creation failed.",!
"RTN","TIUTPBN",188,0)
 Q 1
"RTN","TIUTPBN",189,0)
MKOBJ(NAME,METHOD) ;
"RTN","TIUTPBN",190,0)
 N FDA,FDAIEN,MSG
"RTN","TIUTPBN",191,0)
 S FDA(8925.1,"+1,",.01)=NAME
"RTN","TIUTPBN",192,0)
 S FDA(8925.1,"+1,",.03)=NAME
"RTN","TIUTPBN",193,0)
 S FDA(8925.1,"+1,",.04)="O"
"RTN","TIUTPBN",194,0)
 S FDA(8925.1,"+1,",.06)=$$CHKTITLE(8930,"CLINICAL COORDINATOR")
"RTN","TIUTPBN",195,0)
 S FDA(8925.1,"+1,",.07)=11
"RTN","TIUTPBN",196,0)
 S FDA(8925.1,"+1,",9)=METHOD
"RTN","TIUTPBN",197,0)
 S FDA(8925.1,"+1,",99)=$H
"RTN","TIUTPBN",198,0)
 D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUTPBN",199,0)
 I $D(MSG) D  Q -1
"RTN","TIUTPBN",200,0)
 . W !!,"TIU Object "_NAME_" creation failed.  The following error message was returned:",!!
"RTN","TIUTPBN",201,0)
 . S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUTPBN",202,0)
 W !!,"Creation of TIU Object "_NAME_" successful..." H 1
"RTN","TIUTPBN",203,0)
 Q 1
"RTN","TIUTPBN",204,0)
PRE ;
"RTN","TIUTPBN",205,0)
 N DA,DIK,NAME,X,Y
"RTN","TIUTPBN",206,0)
 F NAME="TIU TPBN ACT OUT MEDS","TIU TPBN FUTURE APPTS","TIU TPBN PCP" D
"RTN","TIUTPBN",207,0)
 .S DA=0,DA=$O(^TIU(8925.1,"B",NAME,DA))
"RTN","TIUTPBN",208,0)
 .S DIK="^TIU(8925.1,"
"RTN","TIUTPBN",209,0)
 .I DA>0 D ^DIK
"RTN","TIUTPBN",210,0)
 S NAME="INS^GMTSOBJ"
"RTN","TIUTPBN",211,0)
 D @NAME
"RTN","TIUTPBN",212,0)
 Q
"VER")
8.0^22.0
"BLD",6218,6)
^195
**END**
**END**
