Released GMRC*3*29 SEQ #28
Extracted from mail message
**KIDS**:GMRC*3.0*29^

**INSTALL NAME**
GMRC*3.0*29
"BLD",4014,0)
GMRC*3.0*29^CONSULT/REQUEST TRACKING^0^3021217^y
"BLD",4014,1,0)
^^2^2^3021115^
"BLD",4014,1,1,0)
Please refer to the National Patch Module for full details of the changes 
"BLD",4014,1,2,0)
and enhancements provided by this patch.
"BLD",4014,4,0)
^9.64PA^^
"BLD",4014,"INID")
^y
"BLD",4014,"INIT")
GMRCYP29
"BLD",4014,"KRN",0)
^9.67PA^8989.52^19
"BLD",4014,"KRN",.4,0)
.4
"BLD",4014,"KRN",.401,0)
.401
"BLD",4014,"KRN",.402,0)
.402
"BLD",4014,"KRN",.403,0)
.403
"BLD",4014,"KRN",.5,0)
.5
"BLD",4014,"KRN",.84,0)
.84
"BLD",4014,"KRN",3.6,0)
3.6
"BLD",4014,"KRN",3.8,0)
3.8
"BLD",4014,"KRN",9.2,0)
9.2
"BLD",4014,"KRN",9.8,0)
9.8
"BLD",4014,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",4014,"KRN",9.8,"NM",1,0)
GMRCST^^0^B6360349
"BLD",4014,"KRN",9.8,"NM",2,0)
GMRCSTU^^0^B61572090
"BLD",4014,"KRN",9.8,"NM",3,0)
GMRCSTU1^^0^B44975040
"BLD",4014,"KRN",9.8,"NM",4,0)
GMRCHL72^^0^B16156048
"BLD",4014,"KRN",9.8,"NM",5,0)
GMRCSTL1^^0^B17452945
"BLD",4014,"KRN",9.8,"NM",6,0)
GMRCGUIB^^0^B38910652
"BLD",4014,"KRN",9.8,"NM",7,0)
GMRCASF^^0^B13947438
"BLD",4014,"KRN",9.8,"NM",8,0)
GMRCACMT^^0^B25821387
"BLD",4014,"KRN",9.8,"NM",9,0)
GMRCHL7^^0^B30164473
"BLD",4014,"KRN",9.8,"NM",10,0)
GMRCP5B^^0^B40317988
"BLD",4014,"KRN",9.8,"NM",11,0)
GMRCP5D^^0^B48844001
"BLD",4014,"KRN",9.8,"NM",12,0)
GMRCHL7U^^0^B24490613
"BLD",4014,"KRN",9.8,"NM",13,0)
GMRCSTLM^^0^B82753364
"BLD",4014,"KRN",9.8,"NM","B","GMRCACMT",8)

"BLD",4014,"KRN",9.8,"NM","B","GMRCASF",7)

"BLD",4014,"KRN",9.8,"NM","B","GMRCGUIB",6)

"BLD",4014,"KRN",9.8,"NM","B","GMRCHL7",9)

"BLD",4014,"KRN",9.8,"NM","B","GMRCHL72",4)

"BLD",4014,"KRN",9.8,"NM","B","GMRCHL7U",12)

"BLD",4014,"KRN",9.8,"NM","B","GMRCP5B",10)

"BLD",4014,"KRN",9.8,"NM","B","GMRCP5D",11)

"BLD",4014,"KRN",9.8,"NM","B","GMRCST",1)

"BLD",4014,"KRN",9.8,"NM","B","GMRCSTL1",5)

"BLD",4014,"KRN",9.8,"NM","B","GMRCSTLM",13)

"BLD",4014,"KRN",9.8,"NM","B","GMRCSTU",2)

"BLD",4014,"KRN",9.8,"NM","B","GMRCSTU1",3)

"BLD",4014,"KRN",19,0)
19
"BLD",4014,"KRN",19.1,0)
19.1
"BLD",4014,"KRN",101,0)
101
"BLD",4014,"KRN",409.61,0)
409.61
"BLD",4014,"KRN",771,0)
771
"BLD",4014,"KRN",870,0)
870
"BLD",4014,"KRN",8989.51,0)
8989.51
"BLD",4014,"KRN",8989.52,0)
8989.52
"BLD",4014,"KRN",8994,0)
8994
"BLD",4014,"KRN","B",.4,.4)

"BLD",4014,"KRN","B",.401,.401)

"BLD",4014,"KRN","B",.402,.402)

"BLD",4014,"KRN","B",.403,.403)

"BLD",4014,"KRN","B",.5,.5)

"BLD",4014,"KRN","B",.84,.84)

"BLD",4014,"KRN","B",3.6,3.6)

"BLD",4014,"KRN","B",3.8,3.8)

"BLD",4014,"KRN","B",9.2,9.2)

"BLD",4014,"KRN","B",9.8,9.8)

"BLD",4014,"KRN","B",19,19)

"BLD",4014,"KRN","B",19.1,19.1)

"BLD",4014,"KRN","B",101,101)

"BLD",4014,"KRN","B",409.61,409.61)

"BLD",4014,"KRN","B",771,771)

"BLD",4014,"KRN","B",870,870)

"BLD",4014,"KRN","B",8989.51,8989.51)

"BLD",4014,"KRN","B",8989.52,8989.52)

"BLD",4014,"KRN","B",8994,8994)

"BLD",4014,"QUES",0)
^9.62^^
"BLD",4014,"REQB",0)
^9.611^4^4
"BLD",4014,"REQB",1,0)
GMRC*3.0*7^2
"BLD",4014,"REQB",2,0)
GMRC*3.0*15^2
"BLD",4014,"REQB",3,0)
GMRC*3.0*19^2
"BLD",4014,"REQB",4,0)
GMRC*3.0*22^2
"BLD",4014,"REQB","B","GMRC*3.0*15",2)

"BLD",4014,"REQB","B","GMRC*3.0*19",3)

"BLD",4014,"REQB","B","GMRC*3.0*22",4)

"BLD",4014,"REQB","B","GMRC*3.0*7",1)

"INIT")
GMRCYP29
"MBREQ")
0
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^13
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
29^3021217
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3021217
"PKG",128,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for full details of the changes 
"PKG",128,22,1,"PAH",1,1,2,0)
and enhancements provided by this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","GMRCACMT")
0^8^B25821387
"RTN","GMRCACMT",1,0)
GMRCACMT ;SLC/DLT,DCM,MA - Comment Action and alerting ;11/15/02 07:27
"RTN","GMRCACMT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,14,18,20,22,29**;DEC 27, 1997
"RTN","GMRCACMT",3,0)
 ; This routine invokes IA #10060
"RTN","GMRCACMT",4,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCACMT",5,0)
 K GMRCQIT,GMRCQUT N GMRCA
"RTN","GMRCACMT",6,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCACMT",7,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW
"RTN","GMRCACMT",8,0)
 S GMRCOM=1,GMRCA=20,GMRCPROV=$P(^GMR(123,GMRCO,0),"^",14) D AUDIT^GMRCP
"RTN","GMRCACMT",9,0)
 ; GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the 
"RTN","GMRCACMT",10,0)
 ; word-processing logic should be executed. If an actual comment is 
"RTN","GMRCACMT",11,0)
 ; added, $P(GMRCOM,"^",2)=1 (send alert), if not GMRCOM=1 and no '^' 
"RTN","GMRCACMT",12,0)
 ; exists (do not send alert)
"RTN","GMRCACMT",13,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCACMT",14,0)
 ;continue if no lock problems occurred
"RTN","GMRCACMT",15,0)
 I $P(GMRCOM,"^",2) D
"RTN","GMRCACMT",16,0)
 . I $P($G(^GMR(123,GMRCO,12)),U,5)="F" D
"RTN","GMRCACMT",17,0)
 .. W !!,"The ordering provider for this inter-facility consult will"
"RTN","GMRCACMT",18,0)
 .. W " automatically be ",!,"notified.",!
"RTN","GMRCACMT",19,0)
 . D PROCALRT("",1,20,GMRCO)
"RTN","GMRCACMT",20,0)
 . ;update LAST ACTION field even though no status change
"RTN","GMRCACMT",21,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCACMT",22,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCACMT",23,0)
 . D STATUS^GMRCP
"RTN","GMRCACMT",24,0)
 D END
"RTN","GMRCACMT",25,0)
 Q
"RTN","GMRCACMT",26,0)
 ;
"RTN","GMRCACMT",27,0)
PROCALRT(GMRCORTX,GMRCDELR,ACTION,GMRCO) ;Process alert for comments
"RTN","GMRCACMT",28,0)
 ;If GMRCDELR=1, the ordering provider can be deleted from the list.
"RTN","GMRCACMT",29,0)
 N GMRCADUZ,GMRCANS,NOTIF,GMRCQIT,GMRCTM
"RTN","GMRCACMT",30,0)
 ;S GMRCANS=$$READ("Y","Do You Wish To Send An Alert With This Comment","N","Enter Y to continue with recipient prompts. Otherwise, enter N.",1)
"RTN","GMRCACMT",31,0)
 ;I (GMRCANS[U)!(GMRCANS=0) D END Q
"RTN","GMRCACMT",32,0)
 ;
"RTN","GMRCACMT",33,0)
 D WHOTO
"RTN","GMRCACMT",34,0)
 ;I $G(GMRCQIT) D END Q  ;User "^" at requesting provider.
"RTN","GMRCACMT",35,0)
 ;
"RTN","GMRCACMT",36,0)
 N GMRCALT
"RTN","GMRCACMT",37,0)
 S NOTIF=$S(ACTION=20:63,ACTION=8:63,1:23)
"RTN","GMRCACMT",38,0)
 ;
"RTN","GMRCACMT",39,0)
 D SENDMSG(NOTIF,+GMRCO,$G(GMRCTM))
"RTN","GMRCACMT",40,0)
 Q
"RTN","GMRCACMT",41,0)
 ;
"RTN","GMRCACMT",42,0)
SENDMSG(NOTIF,GMRCO,GMRCATM) ;Send the alert
"RTN","GMRCACMT",43,0)
 N GMRCDFN
"RTN","GMRCACMT",44,0)
 I '$D(GMRCADUZ) S GMRCADUZ=""
"RTN","GMRCACMT",45,0)
 W !,"Processing Alerts..."
"RTN","GMRCACMT",46,0)
 S GMRCDFN=$P($G(^GMR(123,+GMRCO,0)),"^",2)
"RTN","GMRCACMT",47,0)
 S GMRCORTX=$S($L(GMRCORTX):GMRCORTX,1:"Comment Added to Consult ")_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCACMT",48,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTIF,.GMRCADUZ,$G(GMRCATM))
"RTN","GMRCACMT",49,0)
 Q
"RTN","GMRCACMT",50,0)
 ;
"RTN","GMRCACMT",51,0)
END ;kill off variables and exit
"RTN","GMRCACMT",52,0)
 K GMRC,GMRCA,GMRCMSG,GMRCOM,GMRCO,GMRCORTX,GMRCERR,GMRCERMS,GMRCQUT,GMRCUT
"RTN","GMRCACMT",53,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCACMT",54,0)
 K DTOUT,DIROUT,DUOUT,DIRUT
"RTN","GMRCACMT",55,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCACMT",56,0)
 Q
"RTN","GMRCACMT",57,0)
 ;
"RTN","GMRCACMT",58,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCACMT",59,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCACMT",60,0)
 ;Returns GMRCADUZ array of users to send an alert to and GMRCQIT if "^"
"RTN","GMRCACMT",61,0)
 N GMRCRP,GMRCANS,GMRCUPD
"RTN","GMRCACMT",62,0)
 S GMRCRP=+$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting provider entry
"RTN","GMRCACMT",63,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCACMT",64,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCACMT",65,0)
 . S GMRCTM=1
"RTN","GMRCACMT",66,0)
 . W !,"Service update users will be notified.",!
"RTN","GMRCACMT",67,0)
 I GMRCUPD D  ; alert ord. prov if update users takes action
"RTN","GMRCACMT",68,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCACMT",69,0)
 . W !,"Requesting provider will be notified.",!
"RTN","GMRCACMT",70,0)
 I '$G(GMRCTM),'GMRCUPD D  ;alert both if not ord. prov or update user
"RTN","GMRCACMT",71,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCACMT",72,0)
 . W !,"Requesting provider and service update users will be notified.",!
"RTN","GMRCACMT",73,0)
 ;
"RTN","GMRCACMT",74,0)
 ;
"RTN","GMRCACMT",75,0)
ANDTO ;Ask for additional recipients
"RTN","GMRCACMT",76,0)
 D NAMELIST("Additional alert recipients: ",.GMRCADUZ,GMRCDELR)
"RTN","GMRCACMT",77,0)
 Q
"RTN","GMRCACMT",78,0)
 ;
"RTN","GMRCACMT",79,0)
NAMELIST(GMRCP,GMRCOLD,GMRCDELR) ;manage the list of recipients
"RTN","GMRCACMT",80,0)
 ;
"RTN","GMRCACMT",81,0)
 ; GMRCP - Prompt
"RTN","GMRCACMT",82,0)
 ; GMRCOLD - Original list with ordering provider.
"RTN","GMRCACMT",83,0)
 ; GMRCDELR - 1 means the original list may have names deleted
"RTN","GMRCACMT",84,0)
 ; Returns final list in GMRCOLD array
"RTN","GMRCACMT",85,0)
 ;
"RTN","GMRCACMT",86,0)
 N GMRCNEW,GMRCNT,GMRCDUZ,GMRCUSER,GMRCQ,GMRCADD,DIC,X,Y
"RTN","GMRCACMT",87,0)
 ;
"RTN","GMRCACMT",88,0)
 M GMRCNEW=GMRCOLD
"RTN","GMRCACMT",89,0)
 I GMRCDELR=1 K GMRCOLD S GMRCOLD="" ;Remove mandatory users from GMRCOLD
"RTN","GMRCACMT",90,0)
 S GMRCNT=0 F  D  Q:(GMRCUSER[U)
"RTN","GMRCACMT",91,0)
 .S GMRCUSER=$$READ("FAO;3;46",$S(GMRCNT:"And ",1:"")_GMRCP,"","^D NAMEHELP^GMRCACMT")
"RTN","GMRCACMT",92,0)
 .S:'$L(GMRCUSER) GMRCUSER=U Q:(GMRCUSER[U)
"RTN","GMRCACMT",93,0)
 .I ($E(GMRCUSER,1)="-") S GMRCADD=0,GMRCUSER=$E(GMRCUSER,2,$L(GMRCUSER))
"RTN","GMRCACMT",94,0)
 .E  S GMRCADD=1
"RTN","GMRCACMT",95,0)
 .;
"RTN","GMRCACMT",96,0)
 .S X=GMRCUSER,DIC=200,DIC(0)="EMQ" D ^DIC
"RTN","GMRCACMT",97,0)
 .;
"RTN","GMRCACMT",98,0)
 .I (Y>0) D  I 1
"RTN","GMRCACMT",99,0)
 ..;W $E($P(Y,U,2),$L(GMRCUSER)+1,$L($P(Y,U,2)))
"RTN","GMRCACMT",100,0)
 ..;
"RTN","GMRCACMT",101,0)
 ..I GMRCADD D
"RTN","GMRCACMT",102,0)
 ...I $D(GMRCNEW(+Y)) W " already in the list." Q
"RTN","GMRCACMT",103,0)
 ...S GMRCNEW(+Y)="" W " added to the list." S GMRCNT=GMRCNT+1
"RTN","GMRCACMT",104,0)
 ..;
"RTN","GMRCACMT",105,0)
 ..I 'GMRCADD D
"RTN","GMRCACMT",106,0)
 ...I $D(GMRCOLD(+Y)) W " can't delete this name from the list." Q
"RTN","GMRCACMT",107,0)
 ...I '$D(GMRCNEW(+Y)) W " not currently in the list." Q
"RTN","GMRCACMT",108,0)
 ...K GMRCNEW(+Y) S GMRCNT=GMRCNT-1 W " deleted from the list."
"RTN","GMRCACMT",109,0)
 .;
"RTN","GMRCACMT",110,0)
 .E  I $L(GMRCUSER) W "  Name not found."
"RTN","GMRCACMT",111,0)
 ;
"RTN","GMRCACMT",112,0)
 M GMRCOLD=GMRCNEW
"RTN","GMRCACMT",113,0)
 Q
"RTN","GMRCACMT",114,0)
 ;
"RTN","GMRCACMT",115,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;read logic
"RTN","GMRCACMT",116,0)
 ;
"RTN","GMRCACMT",117,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCACMT",118,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCACMT",119,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCACMT",120,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCACMT",121,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCACMT",122,0)
 ;
"RTN","GMRCACMT",123,0)
 ;  Returns "^" or answer
"RTN","GMRCACMT",124,0)
 ;
"RTN","GMRCACMT",125,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCACMT",126,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCACMT",127,0)
 S DIR(0)=GMRC0
"RTN","GMRCACMT",128,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCACMT",129,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCACMT",130,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCACMT",131,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCACMT",132,0)
 D ^DIR
"RTN","GMRCACMT",133,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCACMT",134,0)
 Q Y
"RTN","GMRCACMT",135,0)
 ;
"RTN","GMRCACMT",136,0)
 ;
"RTN","GMRCACMT",137,0)
NAMEHELP ;Help for the recipient list logic
"RTN","GMRCACMT",138,0)
 N GMRCDUZ
"RTN","GMRCACMT",139,0)
 W !,"Enter the name of the user to send the alert to,"
"RTN","GMRCACMT",140,0)
 W !," or put a '-' in front of a name to delete from the list."
"RTN","GMRCACMT",141,0)
 W !
"RTN","GMRCACMT",142,0)
 W !,"  Example:"
"RTN","GMRCACMT",143,0)
 W !,"     SMITH,FRED  ->  to add Fred to the list."
"RTN","GMRCACMT",144,0)
 W !,"     -SMITH,FRED ->  to delete Fred from the list."
"RTN","GMRCACMT",145,0)
 W !,"Already selected: "
"RTN","GMRCACMT",146,0)
 W !
"RTN","GMRCACMT",147,0)
 S GMRCDUZ=0 F  S GMRCDUZ=$O(GMRCNEW(GMRCDUZ)) Q:'GMRCDUZ  D
"RTN","GMRCACMT",148,0)
 .W !,?5,$P(^VA(200,GMRCDUZ,0),U,1)
"RTN","GMRCACMT",149,0)
 .W:$D(GMRCOLD(GMRCDUZ)) "  <mandatory>"
"RTN","GMRCACMT",150,0)
 W !
"RTN","GMRCACMT",151,0)
 Q
"RTN","GMRCACMT",152,0)
 ;
"RTN","GMRCASF")
0^7^B13947438
"RTN","GMRCASF",1,0)
GMRCASF ;SLC/DLT - Significant Findings Action ;11/15/02 07:28
"RTN","GMRCASF",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,10,14,22,29**;DEC 27, 1997
"RTN","GMRCASF",3,0)
SF(GMRCO) ;Evaluate Significant Findings and update accordingly
"RTN","GMRCASF",4,0)
 ;GMRCO is the selected consult
"RTN","GMRCASF",5,0)
 N GMRCQIT,GMRCLCK
"RTN","GMRCASF",6,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)  I $D(GMRCQUT) D END Q
"RTN","GMRCASF",7,0)
 I '+($G(GMRCO)) D END Q
"RTN","GMRCASF",8,0)
 I '$$LOCK^GMRCA1(GMRCO) D END Q
"RTN","GMRCASF",9,0)
 S GMRCLCK=1
"RTN","GMRCASF",10,0)
 ;
"RTN","GMRCASF",11,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCASF",12,0)
 N GMRC,GMRCSTS,GMRCSF,GMRCSFO,GMRCORTX,GMRCDR
"RTN","GMRCASF",13,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:GMRC(0)=""
"RTN","GMRCASF",14,0)
 ;
"RTN","GMRCASF",15,0)
 S GMRCSFO=$P(GMRC(0),"^",19)
"RTN","GMRCASF",16,0)
 W !!,"Current Significant Findings = "_$S(GMRCSFO="U":"Unknown",GMRCSFO="Y":"Yes",GMRCSFO="N":"No",1:"not entered yet"),!!
"RTN","GMRCASF",17,0)
 S GMRCSF=$$GETSIGF(GMRCSFO)
"RTN","GMRCASF",18,0)
 I GMRCSF=0 D END Q
"RTN","GMRCASF",19,0)
 ; If no change in old and new value ask if should continue
"RTN","GMRCASF",20,0)
 I GMRCSF=GMRCSFO D  I 'Y D END Q
"RTN","GMRCASF",21,0)
 . W !,"The old and new Significant Findings are the same."
"RTN","GMRCASF",22,0)
 . N DIR,DA,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCASF",23,0)
 . S DIR("A")="Do you want to proceed with this action"
"RTN","GMRCASF",24,0)
 . S DIR(0)="Y"
"RTN","GMRCASF",25,0)
 . S DIR("B")="NO"
"RTN","GMRCASF",26,0)
 . D ^DIR
"RTN","GMRCASF",27,0)
 . I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S Y=0 Q
"RTN","GMRCASF",28,0)
 . I Y=0 Q
"RTN","GMRCASF",29,0)
 ;
"RTN","GMRCASF",30,0)
 ;Update last action and sig findings but don't change the status
"RTN","GMRCASF",31,0)
 S GMRCSTS=$P(GMRC(0),"^",12),GMRCA=4
"RTN","GMRCASF",32,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCASF",33,0)
 D STATUS^GMRCP
"RTN","GMRCASF",34,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCASF",35,0)
 ;
"RTN","GMRCASF",36,0)
 ;GMRCOM=1 tells AUDIT^GMRCP to do the word-processing logic
"RTN","GMRCASF",37,0)
 ;If an actual comment is added, $P(GMRCOM,"^",2)=1 (send alert),
"RTN","GMRCASF",38,0)
 ; if not GMRCOM=1 and no '^' exists (do not send alert)
"RTN","GMRCASF",39,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCASF",40,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCASF",41,0)
 ;
"RTN","GMRCASF",42,0)
 I GMRCSTS=2 D EN^GMRCHL7($P(^GMR(123,GMRCO,0),U,2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),,,$G(GMRCAD))
"RTN","GMRCASF",43,0)
 D SETORTX
"RTN","GMRCASF",44,0)
 I GMRCSTS=2 D SENDALRT(GMRCORTX) Q
"RTN","GMRCASF",45,0)
 I +$P(GMRCOM,"^",2) D
"RTN","GMRCASF",46,0)
 . W !,"An alert with the following text will be sent if recipients are selected: "
"RTN","GMRCASF",47,0)
 . W !,"     "_GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCASF",48,0)
 . W !
"RTN","GMRCASF",49,0)
 . I GMRCSTS'=2 W !,"or the alert will be sent when the order is completed.",!
"RTN","GMRCASF",50,0)
 . I $P($G(^GMR(123,GMRCO,12)),U,5)="F" D
"RTN","GMRCASF",51,0)
 . W !!,"The ordering provider for this inter-facility consult will "
"RTN","GMRCASF",52,0)
 . W "automatically be ",!,"notified.",!
"RTN","GMRCASF",53,0)
 . D PROCALRT^GMRCACMT(GMRCORTX,1,4,GMRCO)
"RTN","GMRCASF",54,0)
 . ;For consults not completed, the original provider may be deleted from
"RTN","GMRCASF",55,0)
 . ;the recipient list for the alert.
"RTN","GMRCASF",56,0)
 D END
"RTN","GMRCASF",57,0)
 Q
"RTN","GMRCASF",58,0)
 ;
"RTN","GMRCASF",59,0)
SETORTX ;Set prefix text for the alert
"RTN","GMRCASF",60,0)
 S GMRCORTX=$S(GMRCSF="N":"No ",GMRCSF="Y":"",1:"Unknown ")
"RTN","GMRCASF",61,0)
 S GMRCORTX=GMRCORTX_"Sig Findings for "_$P($G(^ORD(100.01,+GMRCSTS,0)),"^",2)_" consult " Q
"RTN","GMRCASF",62,0)
 Q
"RTN","GMRCASF",63,0)
 ;
"RTN","GMRCASF",64,0)
SENDALRT(GMRCORTX) ;Send to the requesting provider
"RTN","GMRCASF",65,0)
 N GMRCRP,GMRCADUZ,GMRCDELR
"RTN","GMRCASF",66,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting clinician
"RTN","GMRCASF",67,0)
 I +GMRCRP S GMRCADUZ(+GMRCRP)=""
"RTN","GMRCASF",68,0)
 W !,"Alert will be sent to Requesting Provider: "_$P($G(^VA(200,+GMRCRP,0)),U,1)
"RTN","GMRCASF",69,0)
 S GMRCDELR=0
"RTN","GMRCASF",70,0)
 D ANDTO^GMRCACMT
"RTN","GMRCASF",71,0)
 D SENDMSG^GMRCACMT(23,+GMRCO)
"RTN","GMRCASF",72,0)
 ;Sig Findings uses the CONSULT/REQUEST RESOLUTION (23) notification
"RTN","GMRCASF",73,0)
 Q
"RTN","GMRCASF",74,0)
 ;
"RTN","GMRCASF",75,0)
GETSIGF(GMRCSFO) ;Get the significant findings
"RTN","GMRCASF",76,0)
 ;GMRCSFO is the old significant findings value
"RTN","GMRCASF",77,0)
 N DIR,DA,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCASF",78,0)
 S DIR(0)="123,15"
"RTN","GMRCASF",79,0)
 S DIR("B")=GMRCSFO
"RTN","GMRCASF",80,0)
 S:DIR("B")="" DIR("B")="unknown"
"RTN","GMRCASF",81,0)
 S DIR("A")="Are there significant findings? (Y/N/U)"
"RTN","GMRCASF",82,0)
 D ^DIR
"RTN","GMRCASF",83,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q 0
"RTN","GMRCASF",84,0)
 Q Y
"RTN","GMRCASF",85,0)
 ;
"RTN","GMRCASF",86,0)
END ;cleanup variables
"RTN","GMRCASF",87,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCASF",88,0)
 K GMRCO,GMRCA,GMRCMSG,GMRCOM,GMRCSEL,GMRCERR,GMRCERMS
"RTN","GMRCASF",89,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCASF",90,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCASF",91,0)
 Q
"RTN","GMRCGUIB")
0^6^B38910652
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA - GUI actions for consults ;11/15/02 07:31
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20,17,22,29**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",22,0)
 D ^DIE
"RTN","GMRCGUIB",23,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",24,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",25,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",26,0)
 ;
"RTN","GMRCGUIB",27,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCGUIB",28,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCGUIB",29,0)
 ;
"RTN","GMRCGUIB",30,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",31,0)
 Q
"RTN","GMRCGUIB",32,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult 
"RTN","GMRCGUIB",33,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",34,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",35,0)
 ; GMRCADUZ = array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",36,0)
 ; GMRCWHO = IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",37,0)
 ; GMRCWHN = date time of activity in FM format
"RTN","GMRCGUIB",38,0)
 ;
"RTN","GMRCGUIB",39,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN,GMRCTM,GMRCRP,GMRCUPD
"RTN","GMRCGUIB",40,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",41,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",42,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",43,0)
 D  ;update LAST ACTION field even though no status change
"RTN","GMRCGUIB",44,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCGUIB",45,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCGUIB",46,0)
 . D STATUS^GMRCP
"RTN","GMRCGUIB",47,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",48,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",49,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",50,0)
 S GMRCRP=+$P(^GMR(123,GMRCO,0),U,14)
"RTN","GMRCGUIB",51,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",52,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCGUIB",53,0)
 . S GMRCTM=1
"RTN","GMRCGUIB",54,0)
 I GMRCUPD D  ; alert ord. prov if update users takes action
"RTN","GMRCGUIB",55,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",56,0)
 I '$G(GMRCTM),'GMRCUPD D  ;alert both if not ord. prov or update user
"RTN","GMRCGUIB",57,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",58,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,$G(GMRCTM))
"RTN","GMRCGUIB",59,0)
 Q
"RTN","GMRCGUIB",60,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",61,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",62,0)
 ;Input variables:
"RTN","GMRCGUIB",63,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",64,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",65,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",66,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",67,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",68,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",69,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",70,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",71,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",72,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",73,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",74,0)
 ;
"RTN","GMRCGUIB",75,0)
 ;Output:
"RTN","GMRCGUIB",76,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred
"RTN","GMRCGUIB",77,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",78,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",79,0)
 ;
"RTN","GMRCGUIB",80,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",81,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",82,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",83,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",84,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",85,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",86,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",87,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",88,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",89,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",90,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",91,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",92,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",93,0)
 .Q
"RTN","GMRCGUIB",94,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",95,0)
 .N I
"RTN","GMRCGUIB",96,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",97,0)
 .Q
"RTN","GMRCGUIB",98,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",99,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",100,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",101,0)
 .Q
"RTN","GMRCGUIB",102,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",103,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",104,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",105,0)
 .N DA
"RTN","GMRCGUIB",106,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",107,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",108,0)
 .Q
"RTN","GMRCGUIB",109,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",110,0)
 ;
"RTN","GMRCGUIB",111,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",112,0)
 ;
"RTN","GMRCGUIB",113,0)
 I $S(GMRCA=10:1,(GMRCA=4&($P(^GMR(123,GMRCO,0),U,12)=2)):1,1:0) D
"RTN","GMRCGUIB",114,0)
 . D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",115,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",116,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",117,0)
 ;
"RTN","GMRCGUIB",118,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",119,0)
 ; Input variables:
"RTN","GMRCGUIB",120,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",121,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",122,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",123,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",124,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",125,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",126,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",127,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",128,0)
 ;
"RTN","GMRCGUIB",129,0)
 ;Output:
"RTN","GMRCGUIB",130,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",131,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",132,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",133,0)
        ;
"RTN","GMRCGUIB",134,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",135,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",136,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",137,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",138,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",139,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",140,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",141,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",142,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",143,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",144,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",145,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",146,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",147,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",148,0)
 D  ;send alerts
"RTN","GMRCGUIB",149,0)
 . N TXT
"RTN","GMRCGUIB",150,0)
 . S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",151,0)
 . S GMRCADUZ($P(^GMR(123,+GMRCO,0),U,14))=""
"RTN","GMRCGUIB",152,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",153,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",154,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",155,0)
DOCLIST(GMRCAR,GMRCDA,GMRCMED)  ;return list of linked results
"RTN","GMRCGUIB",156,0)
 ; Input:
"RTN","GMRCGUIB",157,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",158,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",159,0)
 ;  GMRCMED- 1 = include med results; 0 = only TIU docs
"RTN","GMRCGUIB",160,0)
 ;
"RTN","GMRCGUIB",161,0)
 ; Output:
"RTN","GMRCGUIB",162,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",163,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",164,0)
 ;       GMRCAR(50,1)="ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCGUIB",165,0)
 ;       GMRCAR(50,2)="ien;global ref,"
"RTN","GMRCGUIB",166,0)
 ;
"RTN","GMRCGUIB",167,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",168,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",169,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",170,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",171,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCGUIB",172,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCGUIB",173,0)
 . I RES["MCAR" D
"RTN","GMRCGUIB",174,0)
 .. N ARR,STR
"RTN","GMRCGUIB",175,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCGUIB",176,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCGUIB",177,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCGUIB",178,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCGUIB",179,0)
 . S CNT=CNT+1
"RTN","GMRCGUIB",180,0)
 Q
"RTN","GMRCHL7")
0^9^B30164473
"RTN","GMRCHL7",1,0)
GMRCHL7 ;SLC/DCM,JFR - CONSULTS-->CPRS HL7 MESSAGING ; 10/15/02 15:23 
"RTN","GMRCHL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,19,29**;DEC 27, 1997
"RTN","GMRCHL7",3,0)
 ;
"RTN","GMRCHL7",4,0)
 ; This routine invokes IA #872,#2638,#2698
"RTN","GMRCHL7",5,0)
 ;
"RTN","GMRCHL7",6,0)
 ;;Format the HL-7 Message header
"RTN","GMRCHL7",7,0)
 Q
"RTN","GMRCHL7",8,0)
INIT S HLQ=""""""
"RTN","GMRCHL7",9,0)
 S SEP1="|",SEP2="^",SEP3="~",SEP4="\",SEP5="&"
"RTN","GMRCHL7",10,0)
 Q
"RTN","GMRCHL7",11,0)
MSH(X) ;Format MSH segment of HL-7 message.
"RTN","GMRCHL7",12,0)
 ;FROM=GMRC CONSULTS - the sending application
"RTN","GMRCHL7",13,0)
 N X
"RTN","GMRCHL7",14,0)
 I '$D(HLQ) D INIT
"RTN","GMRCHL7",15,0)
 S X="MSH|^~\&|CONSULTS|"_$S(+$G(DUZ(2)):DUZ(2),1:$$SITE^VASITE())_"|||||ORM"
"RTN","GMRCHL7",16,0)
 Q X
"RTN","GMRCHL7",17,0)
PID(GMRCIEN) ;Format the HL-7 PID segment
"RTN","GMRCHL7",18,0)
 ;GMRCIEN=IEN of consult from File 123
"RTN","GMRCHL7",19,0)
 N X
"RTN","GMRCHL7",20,0)
 S GMRCDPT=$P(^GMR(123,GMRCIEN,0),"^",2)
"RTN","GMRCHL7",21,0)
 S GMRCPTN=$P($G(^DPT(GMRCDPT,0)),"^")
"RTN","GMRCHL7",22,0)
 S X="PID|||"_+GMRCDPT_"||"_GMRCPTN
"RTN","GMRCHL7",23,0)
 K GMRCDPT,GMRCPTN
"RTN","GMRCHL7",24,0)
 Q X
"RTN","GMRCHL7",25,0)
PV1(GMRCIEN,RMBED,VISIT) ;Format the HL-7 PV1 segment
"RTN","GMRCHL7",26,0)
 N GMRCSTS,SEP1,X,Y
"RTN","GMRCHL7",27,0)
 S HOSPLOC=$P(^GMR(123,GMRCIEN,0),"^",4)
"RTN","GMRCHL7",28,0)
 S VISIT=$$HL7DT(VISIT),GMRCSTS=$S($P(^GMR(123,GMRCIEN,0),"^",18)]"":$P(^(0),"^",18),HOSPLOC]"":"I",1:"O")
"RTN","GMRCHL7",29,0)
 S X="PV1"_"||"_GMRCSTS_"|"_$S(HOSPLOC]"":HOSPLOC,1:"")_"^"_$S(RMBED]"":RMBED,1:"")_"|"_$S(VISIT]"":VISIT,1:"")
"RTN","GMRCHL7",30,0)
 K Y,HOSPLOC,VISIT,GMRCSTS
"RTN","GMRCHL7",31,0)
 Q X
"RTN","GMRCHL7",32,0)
NTE(NTE,ND) ;Format the HL-7 NTE segment
"RTN","GMRCHL7",33,0)
 Q:'$D(NTE)  Q:'$O(NTE(0))
"RTN","GMRCHL7",34,0)
 S GMRCND=1,GMRCND1=0 D
"RTN","GMRCHL7",35,0)
 .S GMRCND1=$O(NTE(GMRCND1)),@(MSG_"("_ND_")")=NTE(GMRCND1)
"RTN","GMRCHL7",36,0)
 .F  S GMRCND1=$O(NTE(GMRCND1)) Q:GMRCND1=""  I NTE(GMRCND1)]"" S @(MSG_"("_ND_","_GMRCND_")")=NTE(GMRCND1),GMRCND=GMRCND+1
"RTN","GMRCHL7",37,0)
 .Q
"RTN","GMRCHL7",38,0)
 Q
"RTN","GMRCHL7",39,0)
EN(PATID,GMRCIEN,GMRCRTYP,RMBED,ORCTRL,GMRCPLCR,VISIT,GMRCOM,GRPUPD,ACTDT) ;;Main entry point
"RTN","GMRCHL7",40,0)
 ;PATID=DFN - Patients internal entry number from ^DPT(
"RTN","GMRCHL7",41,0)
 ;GMRCIEN=IEN of consult, from File 123
"RTN","GMRCHL7",42,0)
 ;RMBED=Hospital Room/Bed if patient is hospitalized
"RTN","GMRCHL7",43,0)
 ;ORCTRL=Code from HL-7 table 119 (Appendix A) Order Control Codes
"RTN","GMRCHL7",44,0)
 ;VISIT=Visit as a DATE/TIME in Fileman Format.
"RTN","GMRCHL7",45,0)
 ;GMRCPROV=Provider - IEN from file 200
"RTN","GMRCHL7",46,0)
 ;GMRCRTYP=consult type: GMRC REQUEST or GMRC CONSULT
"RTN","GMRCHL7",47,0)
 ;GMRCPLCR=who is entering the order ; usually passed as DUZ for new order, "" for existing order
"RTN","GMRCHL7",48,0)
 ;GMRCOM=comment array flag: 1 if there is comment array, 0 otherwise
"RTN","GMRCHL7",49,0)
 ;GMRCOM(0)=DA of where comment is located: ^GMR(123,IEN,40,DA,
"RTN","GMRCHL7",50,0)
 ;GRPUPD = group update of consults - sends nature as MAINTENANCE
"RTN","GMRCHL7",51,0)
 ;ACTDT = date/time of activity if sent
"RTN","GMRCHL7",52,0)
 Q:'$L(ORCTRL)
"RTN","GMRCHL7",53,0)
 K GMRCMSS
"RTN","GMRCHL7",54,0)
 N MSG,MSH,PID,PV1,ORC,NTE,OBR,OBX,ZSV,GMRCA,GMRCURGI,GMRCPLI
"RTN","GMRCHL7",55,0)
 N GMRCPR,GMRCSS,GMRCTYPE,ORCPLCR
"RTN","GMRCHL7",56,0)
 S MSH="",MSH=$$MSH(MSH)
"RTN","GMRCHL7",57,0)
 S PID=$$PID(GMRCIEN)
"RTN","GMRCHL7",58,0)
 I ORCTRL'="Z@" S PV1=$$PV1(GMRCIEN,RMBED,VISIT)
"RTN","GMRCHL7",59,0)
 D ORC(GMRCIEN,ORCTRL,GMRCPLCR,$G(GRPUPD),$G(ACTDT))
"RTN","GMRCHL7",60,0)
 S ORCTRL=$P(ORCTRL,U)
"RTN","GMRCHL7",61,0)
 I ORCTRL="Z@" S ORC=$P(ORC,SEP1,1,4)
"RTN","GMRCHL7",62,0)
 D:ORCTRL'="Z@" OBR^GMRCHL72(GMRCIEN,$G(GMRCAUTH),$G(ACTDT))
"RTN","GMRCHL7",63,0)
 ;GMRCAUTH=principle results interpreter
"RTN","GMRCHL7",64,0)
 D ZSV(GMRCIEN)
"RTN","GMRCHL7",65,0)
 I $S(ORCTRL="SN":1,ORCTRL="RE":1,ORCTRL="XX":1,1:0) D OBX^GMRCHL72(GMRCIEN)
"RTN","GMRCHL7",66,0)
 I $S(ORCTRL="OC":1,ORCTRL="OD":1,ORCTRL="XX":1,ORCTRL="SC":1,1:0),$G(GMRCOM(0)) D NTE^GMRCHL72(GMRCIEN,.GMRCOM,ORCTRL)
"RTN","GMRCHL7",67,0)
 D BLD(MSH,PID,$G(PV1),$G(ORC),$G(OBR),$G(ZSV),.OBX,.NTE,ORCTRL)
"RTN","GMRCHL7",68,0)
 ;M GMRCMSS=GMRCMSG ;HL-7 message debugging aid - remove from final version
"RTN","GMRCHL7",69,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7",70,0)
 K GMRCND,GMRCND1,GMRCMSG,GMRCNOD,GMRCORFN,GMRCPLI,GMRCPRI,HL7DT,HLQ,J,ND,ND1,ND2,NOTIFY,OBXND,OBXNO,ORCACT,ORCDT,ORURG,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7",71,0)
 Q
"RTN","GMRCHL7",72,0)
BLD(MSH,PID,PV1,ORC,OBR,ZSV,OBX,NTE,CTRLCD) ;Build the HL-7 message global to pass to OR
"RTN","GMRCHL7",73,0)
 S MSG="GMRCMSG",ND=1
"RTN","GMRCHL7",74,0)
 K @(MSG)
"RTN","GMRCHL7",75,0)
 F J="MSH","PID","PV1" I $G(@J)]"" S @(MSG_"("_ND_")")=@J,ND=ND+1
"RTN","GMRCHL7",76,0)
 I ORC]"" S @(MSG_"("_ND_")")=ORC,ND=ND+1
"RTN","GMRCHL7",77,0)
 I $D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",78,0)
 I OBR]"" S @(MSG_"("_ND_")")=OBR,ND=ND+1
"RTN","GMRCHL7",79,0)
 I $L($G(ZSV)) S @(MSG_"("_ND_")")=ZSV,ND=ND+1
"RTN","GMRCHL7",80,0)
 I $O(OBX("")) S OBXND=0 D
"RTN","GMRCHL7",81,0)
 .F  S OBXND=$O(OBX(OBXND)) Q:OBXND=""  D
"RTN","GMRCHL7",82,0)
 .. S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",83,0)
 .. S GMRCND1=0 F  S GMRCND1=$O(OBX(OBXND,GMRCND1)) Q:GMRCND1=""  D
"RTN","GMRCHL7",84,0)
 ... S @(MSG_"("_ND_","_GMRCND1_")")=OBX(OBXND,GMRCND1)
"RTN","GMRCHL7",85,0)
        .. S ND=ND+1
"RTN","GMRCHL7",86,0)
 .Q
"RTN","GMRCHL7",87,0)
 ;I CTRLCD'="XX",$D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",88,0)
 Q
"RTN","GMRCHL7",89,0)
HL7DT(DATE) ;Convert Fileman Date to HL-7 Date
"RTN","GMRCHL7",90,0)
 I 'DATE Q ""
"RTN","GMRCHL7",91,0)
 Q $$FMTHL7^XLFDT(DATE) ; use standard function
"RTN","GMRCHL7",92,0)
 N X
"RTN","GMRCHL7",93,0)
 S X="" I DATE S X=17000000+$P(DATE,".",1)_$P(DATE,".",2)
"RTN","GMRCHL7",94,0)
 Q X
"RTN","GMRCHL7",95,0)
FMDATE(DATE) ;Convert HL-7 formatted date to a Fileman formatted date
"RTN","GMRCHL7",96,0)
 I 'DATE Q ""
"RTN","GMRCHL7",97,0)
 Q $$HL7TFM^XLFDT(DATE) ; use standard function
"RTN","GMRCHL7",98,0)
 N X
"RTN","GMRCHL7",99,0)
ORC(GMRCIEN,GMRCTRL,ORCPLCR,MAINT,GMRCDT) ;Build ORC segment of HL-7 msg
"RTN","GMRCHL7",100,0)
 ;GMRCTRL=Order Control Code (table 119)
"RTN","GMRCHL7",101,0)
 ;GMRCIEN=File 123 IEN
"RTN","GMRCHL7",102,0)
 ;ORPLCR=GMRCPLCR - the person entering the order
"RTN","GMRCHL7",103,0)
 ;MAINT=1 - group update of requests
"RTN","GMRCHL7",104,0)
 ;GMRCDT=date/time of activity 
"RTN","GMRCHL7",105,0)
 N GMRCURG,ORCACT,ORCDT,ORCPRV,ORCDT,ORIEN,ORCSTS,STS,ORCNATR,QUANT,REAS
"RTN","GMRCHL7",106,0)
 S REAS=$P(GMRCTRL,U,2),GMRCTRL=$P(GMRCTRL,U)
"RTN","GMRCHL7",107,0)
 S ORCDT=$P(^GMR(123,GMRCIEN,0),"^",7),ORCPRV=$P(^GMR(123,GMRCIEN,0),"^",14),ORURG=$P(^(0),"^",9),ORURG=$S(ORURG]"":$P(^ORD(101,ORURG,0),"^",1),1:"") S:ORURG]"" ORURG=$P(ORURG," - ",2)
"RTN","GMRCHL7",108,0)
 S ORURG=$S(ORURG="EMERGENCY":"STAT",ORURG="NOW":"STAT",ORURG="OUTPATIENT":"ROUTINE",1:ORURG)
"RTN","GMRCHL7",109,0)
 S:ORURG="" GMRCURG="" I ORURG]"" S GMRCURG=$O(^ORD(101.42,"B",ORURG,0)),GMRCURG=$S(+GMRCURG:$P(^ORD(101.42,GMRCURG,0),"^",2),1:"")
"RTN","GMRCHL7",110,0)
 S ORCDT=$$HL7DT(ORCDT)
"RTN","GMRCHL7",111,0)
 I '$G(GMRCDT) S GMRCDT=$$NOW^XLFDT
"RTN","GMRCHL7",112,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12)
"RTN","GMRCHL7",113,0)
 S ORCACT=$P($G(^ORD(100.01,+STS,0)),U,1) S:'$L(ORCACT) ORCACT="NO STATUS"
"RTN","GMRCHL7",114,0)
 S ORIEN=$P(^GMR(123,GMRCIEN,0),"^",3)
"RTN","GMRCHL7",115,0)
 S ORCSTS=$S(STS=1:"DC",STS=2:"CM",STS=5:"IP",STS=6:"SC",STS=9:"A",STS=12:"RP",STS=13:"CA",STS=8:"ZC",1:"IP")
"RTN","GMRCHL7",116,0)
 S ORCNATR=""
"RTN","GMRCHL7",117,0)
 I GMRCTRL="XX" S ORCNATR="S^SERVICE CORRECTION^99ORN^^"_REAS_"^"
"RTN","GMRCHL7",118,0)
 I $G(MAINT) S ORCNATR="M^MAINTENANCE^99ORN^^^"
"RTN","GMRCHL7",119,0)
 S QUANT=$S(GMRCURG]"":"^^^^^"_GMRCURG,1:"")
"RTN","GMRCHL7",120,0)
 S GMRCDT=$$HL7DT(GMRCDT)
"RTN","GMRCHL7",121,0)
 S ORC="ORC|"_GMRCTRL_"|"_$S(ORIEN]"":ORIEN_";1^OR",1:"")_"|"
"RTN","GMRCHL7",122,0)
 S ORC=ORC_GMRCIEN_";GMRC^"_"GMRC"_"||"_ORCSTS_"||"_QUANT_"||"
"RTN","GMRCHL7",123,0)
 S ORC=ORC_GMRCDT_"|"_ORCPLCR_"||"_ORCPRV_"|||"_ORCDT_"|"_ORCNATR
"RTN","GMRCHL7",124,0)
 Q
"RTN","GMRCHL7",125,0)
ZSV(GMRCO) ;build ZSV segment for at least forward
"RTN","GMRCHL7",126,0)
 N SERV,SERVNM,CTYPE
"RTN","GMRCHL7",127,0)
 S SERV=$P($G(^GMR(123,GMRCO,0)),U,5)
"RTN","GMRCHL7",128,0)
 I 'SERV Q
"RTN","GMRCHL7",129,0)
 S SERVNM=$P($G(^GMR(123.5,SERV,0)),U)
"RTN","GMRCHL7",130,0)
 S CTYPE=$G(^GMR(123,GMRCO,1.11))
"RTN","GMRCHL7",131,0)
 I CTYPE=SERVNM S CTYPE=""
"RTN","GMRCHL7",132,0)
 I $P(^GMR(123,GMRCO,0),U,8) S CTYPE=""
"RTN","GMRCHL7",133,0)
 S ZSV="ZSV|^^^"_SERV_U_SERVNM_"^99CON|"_CTYPE
"RTN","GMRCHL7",134,0)
 Q
"RTN","GMRCHL72")
0^4^B16156048
"RTN","GMRCHL72",1,0)
GMRCHL72 ;SLC/DCM - HL-7 formats OBX and NTE segments ;11/15/02 07:32
"RTN","GMRCHL72",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,29**;DEC 27, 1997
"RTN","GMRCHL72",3,0)
 ;
"RTN","GMRCHL72",4,0)
 ; This routine invokes IA #872
"RTN","GMRCHL72",5,0)
 ;
"RTN","GMRCHL72",6,0)
 Q
"RTN","GMRCHL72",7,0)
OBX(GMRCIFN) ;Build the OBX segment of the HL-7 message
"RTN","GMRCHL72",8,0)
 ;GMRCIFN=GMRCIEN - the internal file # of the record from file 123
"RTN","GMRCHL72",9,0)
 N OBXSEGNO,GMRCND,GMRCND1
"RTN","GMRCHL72",10,0)
 S OBXSEGNO=0
"RTN","GMRCHL72",11,0)
 I ORCTRL'="RT",$D(^GMR(123,GMRCIFN,20,0)) S GMRCND=0,GMRCND1=0 D
"RTN","GMRCHL72",12,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","GMRCHL72",13,0)
 . S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND))
"RTN","GMRCHL72",14,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",15,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_"|TX|2000.02^REASON FOR REQUEST^AS4||"
"RTN","GMRCHL72",16,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",17,0)
 . S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",18,0)
 . F  S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND)) Q:GMRCND=""  D
"RTN","GMRCHL72",19,0)
 .. S OBX(OBXSEGNO,GMRCND1)=^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",20,0)
 .. S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",21,0)
 .Q
"RTN","GMRCHL72",22,0)
 I $D(^GMR(123,GMRCIFN,30)) S OBXSEGNO=OBXSEGNO+1 D
"RTN","GMRCHL72",23,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",24,0)
 . N OBXSEG
"RTN","GMRCHL72",25,0)
 . I '$D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",26,0)
 .. S OBXSEG="|TX|^PROVISIONAL DIAGNOSIS^||"_$G(^GMR(123,GMRCIFN,30))
"RTN","GMRCHL72",27,0)
 . I $D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",28,0)
 .. S OBXSEG="|CE|^PROVISIONAL DIAGNOSIS^||"_^GMR(123,GMRCIFN,30.1)_U
"RTN","GMRCHL72",29,0)
 .. S OBXSEG=OBXSEG_$P(^GMR(123,GMRCIFN,30),(" ("_^(30.1)))_U_"I9C"
"RTN","GMRCHL72",30,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_OBXSEG
"RTN","GMRCHL72",31,0)
 I ORCTRL="RE",$L($P(^GMR(123,GMRCIFN,0),U,19)) D
"RTN","GMRCHL72",32,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","GMRCHL72",33,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",34,0)
 . N OBXSEG
"RTN","GMRCHL72",35,0)
 . S OBXSEG="|TX|^SIG FINDINGS^|1|"_$P(^GMR(123,GMRCIFN,0),U,19)
"RTN","GMRCHL72",36,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_OBXSEG
"RTN","GMRCHL72",37,0)
 Q
"RTN","GMRCHL72",38,0)
 ;
"RTN","GMRCHL72",39,0)
NTE(GMRCFN,GMRCND,GMRCTRL) ;Build the NTE segment of the HL7 message
"RTN","GMRCHL72",40,0)
 ;GMRCND=GMRCOM, an array. GMRCND = flag that a comment exists.
"RTN","GMRCHL72",41,0)
 ;GMRCND(0)= DA = the internal entry in node 40: ^GMR(123,IEN,40,DA
"RTN","GMRCHL72",42,0)
 ;GMRCTRL=HL7 control code from table 119
"RTN","GMRCHL72",43,0)
 Q:'$D(GMRCND(0))  S ND=GMRCND(0)
"RTN","GMRCHL72",44,0)
 S ND2=1,NTE(ND2)="NTE|16|L|"
"RTN","GMRCHL72",45,0)
 I $S($P(^GMR(123,GMRCFN,40,ND,0),"^",2)=6:1,$P(^(0),"^",2)=20:1,$P(^(0),"^",2)=7:1,$P(^(0),"^",2)=5:1,GMRCTRL="XX":1,1:0) D
"RTN","GMRCHL72",46,0)
 .S ND1=0,ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=NTE(ND2)_^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",47,0)
 .F  S ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",48,0)
 .Q
"RTN","GMRCHL72",49,0)
 ;I $P(NTE(1),"|",4)="",$S(GMRCTRL="OD":1,GMRCTRL="OC":1,1:0) S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_$S($P(^(0),"^",2)]"":" BY SERVICE",1:"")
"RTN","GMRCHL72",50,0)
 I GMRCTRL="OD"!(GMRCTRL="OC") D
"RTN","GMRCHL72",51,0)
 . N ACTION S ACTION=$P(^GMR(123,GMRCFN,40,ND,0),"^",2) Q:ACTION=""
"RTN","GMRCHL72",52,0)
 . S ACTION=$$GET1^DIQ(123.1,ACTION,.01)
"RTN","GMRCHL72",53,0)
 . S $P(NTE(1),"|",4)=ACTION_" BY SERVICE"
"RTN","GMRCHL72",54,0)
 I $P(NTE(1),"|",4)="",GMRCTRL="XX" S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_" "_$S($P(^GMR(123,GMRCFN,40,ND,0),"^",6)]"":$P(^GMR(123.5,$P(^GMR(123,GMRCFN,40,ND,0),"^",6),0),"^",1),1:GMRCSSNM)
"RTN","GMRCHL72",55,0)
 K N,ND1,ND2
"RTN","GMRCHL72",56,0)
 Q
"RTN","GMRCHL72",57,0)
OBR(GMRCIEN,RESBY,GMRCACDT) ;Build the OBR segment of the HL-7 message
"RTN","GMRCHL72",58,0)
 ;GMRCIEN=IEN of the consult from file 123
"RTN","GMRCHL72",59,0)
 ;NOTIFY=Person who is notified when consult is ordered/completed
"RTN","GMRCHL72",60,0)
 ;RESBY=Person entering/interpreting result & signing report- GMRCPROV
"RTN","GMRCHL72",61,0)
 K OBR
"RTN","GMRCHL72",62,0)
 N OI,PROCID,PROCNM,STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",63,0)
 ;I +$P(^GMR(123,GMRCIEN,0),"^",5)'>0,$S($D(GMRCSSNM):1,+GMRCGRP("ROOT"):1,1:0) S $P(^(0),"^",5)=$S(+GMRCGRP("ROOT"):GMRCGRP("ROOT"),1:$O(^GMR(123.5,"B",GMRCSSNM,0)))
"RTN","GMRCHL72",64,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12),RESTATUS=$S(STS=1:"X",STS=2:"F",STS=5:"O",STS=6:"I",STS=8:"S",STS=9:"R",1:"X")
"RTN","GMRCHL72",65,0)
 S SERVID=$P(^GMR(123,GMRCIEN,0),"^",5),ORCDT=$P(^(0),"^",7),CONLOC=$P(^(0),"^",10) I CONLOC]"" S CONLOC=$S($P(^ORD(101,CONLOC,0),"^",1)["BEDSIDE":"B",$P(^(0),"^",1)["EMERGENCY":"E",1:"OC")
"RTN","GMRCHL72",66,0)
 S NOTIFY=$P(^GMR(123,GMRCIEN,0),"^",11),CONSVC=$S(+SERVID]"":$P($G(^GMR(123.5,+SERVID,0)),"^",1),1:"")
"RTN","GMRCHL72",67,0)
 I +$P(^GMR(123,+GMRCIEN,0),U,8) D
"RTN","GMRCHL72",68,0)
 . S PROCID=+$P(^GMR(123,+GMRCIEN,0),U,8)
"RTN","GMRCHL72",69,0)
 . S PROCNM=$$GET1^DIQ(123.3,PROCID,.01)
"RTN","GMRCHL72",70,0)
 . S OI=PROCID_U_PROCNM_"^99PRC"
"RTN","GMRCHL72",71,0)
 I '$D(OI) S OI=SERVID_U_CONSVC_"^99CON"
"RTN","GMRCHL72",72,0)
 S HL7DT=$$HL7DT^GMRCHL7($S($G(GMRCACDT):GMRCACDT,1:$$NOW^XLFDT))
"RTN","GMRCHL72",73,0)
 S OBR="OBR||||^^^"_OI_"||||||||||||||"_CONLOC_"|"_NOTIFY_"|||"_HL7DT_"|||"_RESTATUS_$S(RESBY]"":"|||||||"_RESBY,1:"")
"RTN","GMRCHL72",74,0)
 K STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",75,0)
 Q
"RTN","GMRCHL7U")
0^12^B24490613
"RTN","GMRCHL7U",1,0)
GMRCHL7U ;SLC/DCM,MA - Utilities assoc. with HL7 messages ;11/8/02 17:18
"RTN","GMRCHL7U",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,21,22,29**;DEC 27, 1997
"RTN","GMRCHL7U",3,0)
 ; Patch #21 added more variables to in line tage EXIT.
"RTN","GMRCHL7U",4,0)
 ;
"RTN","GMRCHL7U",5,0)
 ; This routine invokes IA #872
"RTN","GMRCHL7U",6,0)
 ;
"RTN","GMRCHL7U",7,0)
INIT(MSH) ;break out MSH segment separators and set other needed variables
"RTN","GMRCHL7U",8,0)
 ;MSH = MSH segment of the HL-7 message
"RTN","GMRCHL7U",9,0)
 N X
"RTN","GMRCHL7U",10,0)
 S (SEP1,SEP2,SEP3,SEP4,SEP5)=""
"RTN","GMRCHL7U",11,0)
 S SEP1=$E(MSH,4),X=$P(MSH,SEP1,2)
"RTN","GMRCHL7U",12,0)
 S SEP2=$E(X,1),SEP3=$E(X,2),SEP4=$E(X,3),SEP5=$E(X,4)
"RTN","GMRCHL7U",13,0)
 Q
"RTN","GMRCHL7U",14,0)
PID(GMRCPID) ;Get fields from PID segment and set into GMRC variables.
"RTN","GMRCHL7U",15,0)
 S DFN=$P(GMRCPID,SEP1,4),GMRCPNM=$P(GMRCPID,SEP1,6)
"RTN","GMRCHL7U",16,0)
 Q
"RTN","GMRCHL7U",17,0)
NTE(MSG,GMRCNTE,GMRCNODE,CTRLCODE) ;set NTE segments of HL-7 message into variables and globals
"RTN","GMRCHL7U",18,0)
 ;MSG = whole HL-7 array.
"RTN","GMRCHL7U",19,0)
 ;GMRCNTE = Node in array where NTE message begins
"RTN","GMRCHL7U",20,0)
 ;CTRLCODE = segment 1 of the ORC segment of HL-7 message
"RTN","GMRCHL7U",21,0)
 ;GMRCNODE = IEN of entry int file ^GMR(123,
"RTN","GMRCHL7U",22,0)
 N GMRCACT ;not sure why this is newed here
"RTN","GMRCHL7U",23,0)
 S GMRCAD=$G(GMRCAD),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV)
"RTN","GMRCHL7U",24,0)
 S GMRCACT=$S(CTRLCODE="CA":19,CTRLCODE="DC":6,CTRLCODE="NW":1,1:$O(^GMR(123.1,"D",CTRLCODE,0)))
"RTN","GMRCHL7U",25,0)
 S GMRCNTC(1)=$P(MSG(GMRCNTE),SEP1,4)
"RTN","GMRCHL7U",26,0)
 S LN=0,LN1=2 F  S LN=$O(MSG(GMRCNTE,LN)) Q:LN=""  S GMRCNTC(LN1)=MSG(GMRCNTE,LN),LN1=LN1+1
"RTN","GMRCHL7U",27,0)
 K LN,LN1
"RTN","GMRCHL7U",28,0)
 Q
"RTN","GMRCHL7U",29,0)
PV1(GMRCPV1) ;Get fields from PV1 segment of HL-7 message and set into GMRC variables
"RTN","GMRCHL7U",30,0)
 ;GMRCRB  = patients room/bed            GMRCWARD=patients ward
"RTN","GMRCHL7U",31,0)
 ;GMRCSBR = service basis to be rendered (Inpatient or Outpatient)
"RTN","GMRCHL7U",32,0)
 N X
"RTN","GMRCHL7U",33,0)
 S X=$P(GMRCPV1,SEP1,3),GMRCSBR=$S(X]"":X,1:"")
"RTN","GMRCHL7U",34,0)
 S X=$P(GMRCPV1,SEP1,4),GMRCWARD=$S($P(X,SEP2,1)]"":$P(X,SEP2,1),1:""),VISIT=$S($P(GMRCPV1,SEP1,20)]"":$P(GMRCPV1,SEP1,20),1:"")
"RTN","GMRCHL7U",35,0)
 S GMRCRB=$S($P(X,SEP2,2)]"":$P(X,SEP2,2),1:"")
"RTN","GMRCHL7U",36,0)
 S:VISIT]"" GMRCVSIT=$$FMDATE^GMRCHL7(VISIT)
"RTN","GMRCHL7U",37,0)
 Q
"RTN","GMRCHL7U",38,0)
 ;
"RTN","GMRCHL7U",39,0)
REJECT(GMRCMSG,REAS) ;action can't be filed send reject message
"RTN","GMRCHL7U",40,0)
 N MSH,ORC,I ;GMRCMESS
"RTN","GMRCHL7U",41,0)
 S I=0 F  S I=$O(GMRCMSG(I)) Q:'I  D
"RTN","GMRCHL7U",42,0)
 . I $P(GMRCMSG(I),"|")="PID" S PID=GMRCMSG(I)
"RTN","GMRCHL7U",43,0)
 . I $P(GMRCMSG(I),"|")="ORC" D
"RTN","GMRCHL7U",44,0)
 .. N ORFN,GMRCFN,P17,CTRLCD
"RTN","GMRCHL7U",45,0)
 .. S ORFN=$P(GMRCMSG(I),"|",3),GMRCFN=$P(GMRCMSG(I),"|",4)
"RTN","GMRCHL7U",46,0)
 .. S CTRLCD=$P(GMRCMSG(I),"|",2)
"RTN","GMRCHL7U",47,0)
 .. S ORC="ORC|"_$S(CTRLCD="NW":"UA",1:"UD")_"|"_ORFN_"|"_GMRCFN
"RTN","GMRCHL7U",48,0)
 .. S P17=$S($D(REAS):REAS,1:"UNABLE TO FILE ACTION")
"RTN","GMRCHL7U",49,0)
 .. S $P(ORC,"|",17)="X^REJECTED^99ORN^^"_P17
"RTN","GMRCHL7U",50,0)
 S MSH=$$MSH^GMRCHL7
"RTN","GMRCHL7U",51,0)
 S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",52,0)
 S GMRCMESS(1)=MSH
"RTN","GMRCHL7U",53,0)
 S GMRCMESS(2)=PID
"RTN","GMRCHL7U",54,0)
 S GMRCMESS(3)=ORC
"RTN","GMRCHL7U",55,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMESS)
"RTN","GMRCHL7U",56,0)
 Q
"RTN","GMRCHL7U",57,0)
 ;
"RTN","GMRCHL7U",58,0)
RETURN(GMRCIEN,GMRCTRLC) ;return IEN of record in ^GMR(123,IEN, to OERR
"RTN","GMRCHL7U",59,0)
 ;GMRCIEN = internal record number of record in ^GMR(123,
"RTN","GMRCHL7U",60,0)
 ;GMRCTRLC=Control code from HL-7 Table 119
"RTN","GMRCHL7U",61,0)
 N MSH,PID,ORC,GMRCORCC
"RTN","GMRCHL7U",62,0)
 S SEP1="|",GMRCORCC=$S(GMRCTRLC="NW":"OK",GMRCTRLC="DC":"DR",1:"OK")
"RTN","GMRCHL7U",63,0)
 S MSH=$$MSH^GMRCHL7($G(X)) S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",64,0)
 S PID=$$PID^GMRCHL7(GMRCIEN)
"RTN","GMRCHL7U",65,0)
 D ORC^GMRCHL7(GMRCIEN,GMRCORCC,"") S ORC=$P(ORC,"|",1,4)
"RTN","GMRCHL7U",66,0)
 D BLD^GMRCHL7(MSH,PID,"",ORC,"","",,"",GMRCTRLC)
"RTN","GMRCHL7U",67,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7U",68,0)
 Q
"RTN","GMRCHL7U",69,0)
FILE(GMRCO,DR) ;File data into ^GMR(123,IEN,40 using ^DIE
"RTN","GMRCHL7U",70,0)
 N DIE,DA,GMRCACTI
"RTN","GMRCHL7U",71,0)
 ;GMRCO = IEN of record from file ^GMR(123,
"RTN","GMRCHL7U",72,0)
 ;DR = DR string required by ^DIE
"RTN","GMRCHL7U",73,0)
 Q:'$G(GMRCO)
"RTN","GMRCHL7U",74,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCHL7U",75,0)
 S (DA,GMRCACTI)=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),DA(1)=+GMRCO
"RTN","GMRCHL7U",76,0)
 S DIE="^GMR(123,"_GMRCO_",40,"
"RTN","GMRCHL7U",77,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCHL7U",78,0)
 D ^DIE
"RTN","GMRCHL7U",79,0)
 I $D(GMRCNTC) D COMMENT^GMRCHL7B(.GMRCNTC)
"RTN","GMRCHL7U",80,0)
 I $D(GMRCCMT) D COMMENT^GMRCHL7B(.GMRCCMT)
"RTN","GMRCHL7U",81,0)
 D  ; if record is an IFC build and send update
"RTN","GMRCHL7U",82,0)
 . I '$D(^GMR(123,GMRCO,12)) Q
"RTN","GMRCHL7U",83,0)
 . D TRIGR^GMRCIEVT(GMRCO,GMRCACTI)
"RTN","GMRCHL7U",84,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",85,0)
 Q
"RTN","GMRCHL7U",86,0)
EXIT ;Kill variables and exit
"RTN","GMRCHL7U",87,0)
 K HLQ,J,LN,ND,ND1,ND2,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7U",88,0)
 K GMRCA,GMRCACT,GMRCAD,GMRCAP,GMRCAPP,GMRCATN,GMRCDA,GMRCDEV,GMRCFAC,GMRCFF,GMRCINTR,GMRCMTP,GMRCMSG,GMRCMSH,GMRCNOD,GMRCNTC,GMRCODT,GMRCOID,GMRCORFN,GMRCPA,GMRCPLCR,GMRCPLI,GMRCPNM,GMRCPR,GMRCPRI,GMRCFQ
"RTN","GMRCHL7U",89,0)
 K GMRCPRDG,GMRCSEND,GMRCSTDT,GMRCSTS,GMRCURGI,GMRCVAL,GMRCVTYP,GMRCWARD,GMRCPRV,GMRCTYPE,GMRCND,GMRCND1,VISIT
"RTN","GMRCHL7U",90,0)
 K GMRCRB,GMRCPRA,GMRCRFQ,MSH,OBXND,PID,GMRCORPV,GMRCOTXT,GMRCNATO
"RTN","GMRCHL7U",91,0)
 K GMRCOFN,GMRCS123,GMRCS38,GMRCCMT
"RTN","GMRCHL7U",92,0)
 K GMRCTRLC,GMRCSS,GMRCO,GMRCORNP
"RTN","GMRCHL7U",93,0)
 Q
"RTN","GMRCHL7U",94,0)
AUDIT0 ;place activity audit tracking info into global ^GMR(123,IEN,40,
"RTN","GMRCHL7U",95,0)
 ;GMRCACT=processing activity (from ^GMR(123.1,
"RTN","GMRCHL7U",96,0)
 ;GMRCDA=date/time file entered     GMRCAD=date/time activity took place
"RTN","GMRCHL7U",97,0)
 ;GMRCORNP=name of provider         GMRCFF=forwared from (if forwarded)
"RTN","GMRCHL7U",98,0)
 ;GMRCPA=provider previously assigned
"RTN","GMRCHL7U",99,0)
 ;GMRCDEV=device printed to        GMRCCMT=comment array from OBX segment
"RTN","GMRCHL7U",100,0)
 N GMRCDA
"RTN","GMRCHL7U",101,0)
 S GMRCDA=$$NOW^XLFDT
"RTN","GMRCHL7U",102,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,+GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCHL7U",103,0)
 S GMRCAD=$S($D(GMRCAD):GMRCAD,1:GMRCDA),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV),GMRCPLCR=$G(GMRCPLCR)
"RTN","GMRCHL7U",104,0)
 ;Use the Control code from CPRS in 123.1 to determine the action.
"RTN","GMRCHL7U",105,0)
 ;If action undefined, then use "ADDED COMMENT", entry 20.
"RTN","GMRCHL7U",106,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7U",107,0)
 S:'GMRCACT GMRCACT=20
"RTN","GMRCHL7U",108,0)
 S DR=".01////^S X=GMRCDA;1////^S X=GMRCACT;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=GMRCPLCR;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV"
"RTN","GMRCHL7U",109,0)
 D FILE(GMRCO,DR)
"RTN","GMRCHL7U",110,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",111,0)
 Q
"RTN","GMRCHL7U",112,0)
ALERT(GMRCDFN,GMRCSS,GMRCPR,GMRCFN,GMRCURG,GMRCORA) ;generate an alert when receiving a consult
"RTN","GMRCHL7U",113,0)
 ;GMRCDFN=patient DFN from file 2
"RTN","GMRCHL7U",114,0)
 ;GMRCSS=Service
"RTN","GMRCHL7U",115,0)
 ;GMRCPR=procedure being ordered
"RTN","GMRCHL7U",116,0)
 ;GMRCFN=File 123 IEN
"RTN","GMRCHL7U",117,0)
 ;GMRCURG=urgency of request from protocol file
"RTN","GMRCHL7U",118,0)
 ;GMRCADUZ=array of those who receive alerts
"RTN","GMRCHL7U",119,0)
 ;GMRCORA=action to take on alert: 27 is for new alert
"RTN","GMRCHL7U",120,0)
 N GMRCORTX
"RTN","GMRCHL7U",121,0)
 S GMRCORTX="New consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCHL7U",122,0)
 S:'$D(GMRCORA) GMRCORA=27 S:GMRCORA="" GMRCORA=27
"RTN","GMRCHL7U",123,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,GMRCFN,GMRCORA,.GMRCADUZ,1)
"RTN","GMRCHL7U",124,0)
 K GMRCADUZ
"RTN","GMRCHL7U",125,0)
 Q
"RTN","GMRCP5B")
0^10^B40317988
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;11/5/02 07:35
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15,24,23,22,29**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 ; Patch #23 add "SERVICE RENDERED AS:" to SF513
"RTN","GMRCP5B",5,0)
 ; This routine invokes IA #1252,#10112
"RTN","GMRCP5B",6,0)
 ; DBIA 10035      ;PATIENT FILE
"RTN","GMRCP5B",7,0)
 ; DBIA 2849       ;PROTOCOL
"RTN","GMRCP5B",8,0)
 ; DBIA 10060      ;NEW PERSON
"RTN","GMRCP5B",9,0)
 Q
"RTN","GMRCP5B",10,0)
 ;
"RTN","GMRCP5B",11,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",14,0)
 ;
"RTN","GMRCP5B",15,0)
REQUEST ;
"RTN","GMRCP5B",16,0)
 N GMRCX
"RTN","GMRCP5B",17,0)
 ;
"RTN","GMRCP5B",18,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",19,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",20,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Current Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",21,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",22,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",23,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"    Current Primary Care Team: "_GMRCX)
"RTN","GMRCP5B",24,0)
 ;
"RTN","GMRCP5B",25,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",26,0)
 ;
"RTN","GMRCP5B",27,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",28,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",29,0)
 ;
"RTN","GMRCP5B",30,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",31,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",32,0)
 E  D
"RTN","GMRCP5B",33,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",34,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",35,0)
 ;
"RTN","GMRCP5B",36,0)
 Q
"RTN","GMRCP5B",37,0)
PDIAG ;
"RTN","GMRCP5B",38,0)
 ;
"RTN","GMRCP5B",39,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",40,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",41,0)
 ;
"RTN","GMRCP5B",42,0)
 S (GMRCQSTR,GMRCPGR,GMRCIPH,GMRCQSTT)=""
"RTN","GMRCP5B",43,0)
 ;
"RTN","GMRCP5B",44,0)
 I $S('$P(GMRCRD,U,23):1,$P(GMRCRD(12),U,5)="P":1,1:0) D
"RTN","GMRCP5B",45,0)
 .S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",46,0)
 .S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",47,0)
 .S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",48,0)
 .S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",49,0)
 .S GMRCIPH=$P(GMRCX,U,2)
"RTN","GMRCP5B",50,0)
 .;
"RTN","GMRCP5B",51,0)
 .S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",52,0)
 .S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+GMRCQSTR,8)
"RTN","GMRCP5B",53,0)
 .S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",54,0)
 ;
"RTN","GMRCP5B",55,0)
 I $P(GMRCRD,U,23),$P(GMRCRD(12),U,5)="F" D
"RTN","GMRCP5B",56,0)
 .S GMRCQSTR=$P(GMRCRD(12),U,6)
"RTN","GMRCP5B",57,0)
 .S GMRCIPH=$P(GMRCRD(13),U,2)
"RTN","GMRCP5B",58,0)
 .S GMRCPGR=$P(GMRCRD(13),U,3)
"RTN","GMRCP5B",59,0)
 ;
"RTN","GMRCP5B",60,0)
 S GMRCIPH="(Phone: "_GMRCIPH_")"
"RTN","GMRCP5B",61,0)
 S GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",62,0)
 ;
"RTN","GMRCP5B",63,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: ")
"RTN","GMRCP5B",64,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",65,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",66,0)
 ;
"RTN","GMRCP5B",67,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",68,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",69,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",70,0)
 ;
"RTN","GMRCP5B",71,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",72,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",73,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",74,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",75,0)
 D BLD("PDIAG",1,1,0,GMRCPGR)
"RTN","GMRCP5B",76,0)
 D BLD("PDIAG",1,0,35,"|SERVICE RENDERED AS:")
"RTN","GMRCP5B",77,0)
 D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",78,0)
 S GMRCINOU=$S($P(GMRCRD,U,18)="O":"Outpatient",1:"Inpatient")
"RTN","GMRCP5B",79,0)
 I $D(GMRCIPH)>0 D
"RTN","GMRCP5B",80,0)
 .D BLD("PDIAG",1,1,0,GMRCIPH)
"RTN","GMRCP5B",81,0)
 .D BLD("PDIAG",1,0,35,"|"_GMRCINOU)
"RTN","GMRCP5B",82,0)
 E  D
"RTN","GMRCP5B",83,0)
 .D BLD("PDIAG",1,1,35,"|"_GMRCINOU)
"RTN","GMRCP5B",84,0)
 D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",85,0)
 K GMRCINOU
"RTN","GMRCP5B",86,0)
 ;***************************************************************
"RTN","GMRCP5B",87,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",88,0)
 ;
"RTN","GMRCP5B",89,0)
 Q
"RTN","GMRCP5B",90,0)
 ;
"RTN","GMRCP5B",91,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",92,0)
 ;
"RTN","GMRCP5B",93,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,GMRCPEL,SUB,VAIN,VAPA,VAERR
"RTN","GMRCP5B",94,0)
 ;
"RTN","GMRCP5B",95,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",96,0)
 ;
"RTN","GMRCP5B",97,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",98,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",99,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",100,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",101,0)
 ;No location, IFC - consulting site
"RTN","GMRCP5B",102,0)
 I '$L(GMRCLOC),$P(GMRCRD,U,23),$P($G(GMRCRD(12)),U,5)="F" D
"RTN","GMRCP5B",103,0)
 .I $P(GMRCRD,U,21) S GMRCLOC=$$GET1^DIQ(4,$P(GMRCRD,U,21),.01)
"RTN","GMRCP5B",104,0)
 .E  S GMRCLOC=$$GET1^DIQ(4,$P(GMRCRD,U,23),.01)
"RTN","GMRCP5B",105,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",106,0)
 ;
"RTN","GMRCP5B",107,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",108,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",109,0)
 ;
"RTN","GMRCP5B",110,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",111,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",112,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",113,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",114,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",115,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",116,0)
 E  D
"RTN","GMRCP5B",117,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",118,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",119,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",120,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",121,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",122,0)
 ;
"RTN","GMRCP5B",123,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",124,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",125,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",126,0)
 ;
"RTN","GMRCP5B",127,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",128,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",129,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",130,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",131,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",132,0)
 ;
"RTN","GMRCP5B",133,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",134,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",135,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",136,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",137,0)
 ;
"RTN","GMRCP5B",138,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",139,0)
 ;
"RTN","GMRCP5B",140,0)
 ; get and format eligibility info
"RTN","GMRCP5B",141,0)
 D
"RTN","GMRCP5B",142,0)
 . N VAEL
"RTN","GMRCP5B",143,0)
 . D ELIG^VADPT
"RTN","GMRCP5B",144,0)
 . S GMRCPEL=$P(VAEL(1),U,2)
"RTN","GMRCP5B",145,0)
 ;
"RTN","GMRCP5B",146,0)
 F SUB=0,1 D
"RTN","GMRCP5B",147,0)
 . N GMRCFLN
"RTN","GMRCP5B",148,0)
 . S GMRCFLN=$P($G(^DPT(GMRCDFN,0)),U,1)_"   "_GMRCPEL_"   "
"RTN","GMRCP5B",149,0)
 . S GMRCFLN=GMRCFLN_$E($G(GMRCELIG),1,(79-$L(GMRCFLN)))
"RTN","GMRCP5B",150,0)
 . D BLD("FTR",SUB,1,0,GMRCFLN)
"RTN","GMRCP5B",151,0)
 . D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",152,0)
 . D BLD("FTR",SUB,0,16,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",153,0)
 . D BLD("FTR",SUB,0,51,"CONSULTATION SHEET")
"RTN","GMRCP5B",154,0)
 ;
"RTN","GMRCP5B",155,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",156,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX))
"RTN","GMRCP5B",157,0)
 . D BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",158,0)
 . I GMRCX=1 D BLD("FTR",0,0,51,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",159,0)
 ;
"RTN","GMRCP5B",160,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",161,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",162,0)
 ;
"RTN","GMRCP5B",163,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",164,0)
 ;
"RTN","GMRCP5B",165,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",166,0)
 ;
"RTN","GMRCP5B",167,0)
 Q
"RTN","GMRCP5B",168,0)
 ;
"RTN","GMRCP5B",169,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",170,0)
 ;
"RTN","GMRCP5B",171,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",172,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",173,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",174,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",175,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",176,0)
 ;
"RTN","GMRCP5B",177,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",178,0)
 ;
"RTN","GMRCP5B",179,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",180,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",181,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",182,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5B",183,0)
 ;
"RTN","GMRCP5B",184,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",185,0)
 ;
"RTN","GMRCP5B",186,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",187,0)
 ;
"RTN","GMRCP5B",188,0)
 ;
"RTN","GMRCP5B",189,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",190,0)
 ;
"RTN","GMRCP5B",191,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",192,0)
 N LINECNT
"RTN","GMRCP5B",193,0)
 ;
"RTN","GMRCP5B",194,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",195,0)
 ;
"RTN","GMRCP5B",196,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",197,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",198,0)
 ;
"RTN","GMRCP5B",199,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",200,0)
 Q
"RTN","GMRCP5B",201,0)
 ;
"RTN","GMRCP5B",202,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",203,0)
 ;
"RTN","GMRCP5B",204,0)
 N NEXT
"RTN","GMRCP5B",205,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",206,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",207,0)
 Q
"RTN","GMRCP5B",208,0)
 ;
"RTN","GMRCP5B",209,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",210,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",211,0)
 ;
"RTN","GMRCP5D")
0^11^B48844001
"RTN","GMRCP5D",1,0)
GMRCP5D ;SLC/DCM,RJS,JFR - Print Consult form 513 (Gather Data - Addendums, Headers, Service reports and Comments) ;11/6/02 15:51
"RTN","GMRCP5D",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15,22,29**;Dec 27, 1997
"RTN","GMRCP5D",3,0)
 ;
"RTN","GMRCP5D",4,0)
FORMAT(GMRCIFN,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",5,0)
 ;
"RTN","GMRCP5D",6,0)
 I $L($P(GMRCRD,U,15)) D
"RTN","GMRCP5D",7,0)
 .I $O(^TMP("GMRCR",$J,"MCAR",0)) D
"RTN","GMRCP5D",8,0)
 ..N GMRCSVC
"RTN","GMRCP5D",9,0)
 ..S GMRCSVC=$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1)
"RTN","GMRCP5D",10,0)
 ..S:$L(GMRCSVC) GMRCSVC=GMRCSVC_" "
"RTN","GMRCP5D",11,0)
 ..;
"RTN","GMRCP5D",12,0)
 ..; Medicine Results?
"RTN","GMRCP5D",13,0)
 ..S GMRCR0=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",14,0)
 ...D SUB("H","SREP",GMRCR0,$$CENTER(GMRCSVC_"Service Report #"_GMRCR0_" continued."))
"RTN","GMRCP5D",15,0)
 ...D SUB("H","SREP",GMRCR0," ")
"RTN","GMRCP5D",16,0)
 ...D BLD("SREP",GMRCR0,1,0,$$CENTER("Medicine Package Report"))
"RTN","GMRCP5D",17,0)
 ...D BLD("SREP",GMRCR0,1,0,"")
"RTN","GMRCP5D",18,0)
 ...N LN
"RTN","GMRCP5D",19,0)
 ...S LN=0 F  S LN=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN)) Q:'LN  D
"RTN","GMRCP5D",20,0)
 ....D BLD("SREP",GMRCR0,1,0,$G(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN,0)))
"RTN","GMRCP5D",21,0)
 ;
"RTN","GMRCP5D",22,0)
 ; Build Processing Activities
"RTN","GMRCP5D",23,0)
 S GMRCR0=0 F  S GMRCR0=$O(^GMR(123,GMRCIFN,40,GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",24,0)
 .N GMRCR1,GMRC400,CMT,USER,GMRCDT,RPRV,GMRC402
"RTN","GMRCP5D",25,0)
 .S GMRCR1=+$O(^GMR(123,GMRCIFN,40,GMRCR0,0)) Q:GMRCR1'=1
"RTN","GMRCP5D",26,0)
 .S GMRC400=$G(^GMR(123,GMRCIFN,40,GMRCR0,0))
"RTN","GMRCP5D",27,0)
 .S GMRC402=$G(^GMR(123,GMRCIFN,40,GMRCR0,2))
"RTN","GMRCP5D",28,0)
 .S CMT=$$PRCMT^GMRCP5B(+$P(GMRC400,U,2)) Q:'$L(CMT)
"RTN","GMRCP5D",29,0)
 .S GMRCDT=$P(GMRC400,U,3) S:'GMRCDT GMRCDT=$P(GMRC400,U,1)
"RTN","GMRCP5D",30,0)
 .S GMRCDT=$$EXDT(GMRCDT)_" "_$P(GMRC402,U,3)
"RTN","GMRCP5D",31,0)
 .;
"RTN","GMRCP5D",32,0)
 .S RPRV=$$GET1^DIQ(200,+$P(GMRC400,U,4),.01)
"RTN","GMRCP5D",33,0)
 .I '$L(RPRV) S RPRV=$P(GMRC402,U,2)
"RTN","GMRCP5D",34,0)
 .S:($L(RPRV)) RPRV="Responsible Person: "_RPRV
"RTN","GMRCP5D",35,0)
 .S USER=$$GET1^DIQ(200,+$P(GMRC400,U,5),.01)
"RTN","GMRCP5D",36,0)
 .I '$L(USER) S USER=$P(GMRC402,U)
"RTN","GMRCP5D",37,0)
 .S USER="Entered by: "_USER_" - "_GMRCDT
"RTN","GMRCP5D",38,0)
 .D SUB("H","COM",GMRCR0,CMT_" Comment ("_USER_") continued.")
"RTN","GMRCP5D",39,0)
 .D SUB("H","COM",GMRCR0," ")
"RTN","GMRCP5D",40,0)
 .D BLD("COM",GMRCR0,1,0,"")
"RTN","GMRCP5D",41,0)
 .D BLD("COM",GMRCR0,1,0,$$CENTER("("_CMT_" Comment)"))
"RTN","GMRCP5D",42,0)
 .I $P(GMRC400,U,2)=17!($P(GMRC400,U,2)=25) D
"RTN","GMRCP5D",43,0)
 .. N FWDLN,FWDRS
"RTN","GMRCP5D",44,0)
 .. S FWDLN="Forwarded from: "
"RTN","GMRCP5D",45,0)
 .. S FWDRS=$P($G(^GMR(123,GMRCIFN,40,GMRCR0,3)),U)
"RTN","GMRCP5D",46,0)
 .. I $L(FWDRS) S FWDLN=FWDLN_FWDRS
"RTN","GMRCP5D",47,0)
 .. I '$L(FWDRS) S FWDLN=FWDLN_$$GET1^DIQ(123.5,+$P(GMRC400,U,6),.01)
"RTN","GMRCP5D",48,0)
 .. D BLD("COM",GMRCR0,1,5,FWDLN)
"RTN","GMRCP5D",49,0)
 .D BLD("COM",GMRCR0,1,5,USER)
"RTN","GMRCP5D",50,0)
 .D:($L(RPRV)) BLD("COM",GMRCR0,1,5,RPRV)
"RTN","GMRCP5D",51,0)
 .;
"RTN","GMRCP5D",52,0)
 .N GMRCR2 S GMRCR2=0
"RTN","GMRCP5D",53,0)
 .F  S GMRCR2=$O(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2)) Q:'GMRCR2  D
"RTN","GMRCP5D",54,0)
 ..D BLD("COM",GMRCR0,1,0,$G(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2,0)))
"RTN","GMRCP5D",55,0)
 ;
"RTN","GMRCP5D",56,0)
 Q
"RTN","GMRCP5D",57,0)
 ;
"RTN","GMRCP5D",58,0)
ADDEND(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",59,0)
 ;
"RTN","GMRCP5D",60,0)
 N GMRCADD,GMRCNDX,GMRCR1,GMRCV,TEXT,GMRCX
"RTN","GMRCP5D",61,0)
 ;
"RTN","GMRCP5D",62,0)
 S GMRCADD=0 F  S GMRCADD=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD)) Q:'GMRCADD  D
"RTN","GMRCP5D",63,0)
 .N GMRCSGNM,GMRCNMDT,GMRCTIT,GMRCMODE,GMRCCSDT,GMRCCTIT,GMRCCSGM
"RTN","GMRCP5D",64,0)
 .;
"RTN","GMRCP5D",65,0)
 .F GMRCV="GMRCSGNM","GMRCNMDT","GMRCTIT","GMRCMODE" D
"RTN","GMRCP5D",66,0)
 ..S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",67,0)
 .;
"RTN","GMRCP5D",68,0)
 . F GMRCV="GMRCCSDT","GMRCCTIT","GMRCCSGM","GMRCCSIG" D
"RTN","GMRCP5D",69,0)
 .. S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",70,0)
 .S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5D",71,0)
 .I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5D",72,0)
 .I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" continued.")
"RTN","GMRCP5D",73,0)
 .D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5D",74,0)
 .I $L($G(GMRCSGNM)) D
"RTN","GMRCP5D",75,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",76,0)
 ..I (GMRCMODE="electronic") S GMRCX=" Addendum Signature: "_GMRCSGNM_" /es/ "_$$EXDT($G(GMRCNMDT))
"RTN","GMRCP5D",77,0)
 ..I '(GMRCMODE="electronic") S GMRCX=" Addendum Author: "_GMRCSGNM S:$L($G(GMRCNMDT)) GMRCX=GMRCX_" Last edited: "_$$EXDT(GMRCNMDT)
"RTN","GMRCP5D",78,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",79,0)
 ..D:$L($G(GMRCTIT)) SUB("F","RES",GMRCNDX,"                     "_GMRCTIT)
"RTN","GMRCP5D",80,0)
 .I $L($G(GMRCCSDT)) D
"RTN","GMRCP5D",81,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",82,0)
 ..I (GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",83,0)
 ..I '(GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /chart/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",84,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",85,0)
 ..D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                       "_GMRCCTIT)
"RTN","GMRCP5D",86,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",87,0)
 .I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5D",88,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0))
"RTN","GMRCP5D",89,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",90,0)
 .S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5D",91,0)
 ..D BLD("RES",GMRCNDX,1,0,$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1,0)))
"RTN","GMRCP5D",92,0)
 Q
"RTN","GMRCP5D",93,0)
 ;
"RTN","GMRCP5D",94,0)
HDR ; Header code for form 513
"RTN","GMRCP5D",95,0)
 ;
"RTN","GMRCP5D",96,0)
 N PG,GMRCFROM
"RTN","GMRCP5D",97,0)
 ;
"RTN","GMRCP5D",98,0)
 F PG=0,1 D
"RTN","GMRCP5D",99,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",100,0)
 .D BLD("HDR",PG,1,6,"MEDICAL RECORD")
"RTN","GMRCP5D",101,0)
 .D BLD("HDR",PG,0,29,"|")
"RTN","GMRCP5D",102,0)
 .D BLD("HDR",PG,0,36,"CONSULTATION SHEET")
"RTN","GMRCP5D",103,0)
 .I PG D BLD("HDR",PG,0,60,"Page ","GMRCPG,65") I 1
"RTN","GMRCP5D",104,0)
 .E  I '$G(GMRCGUI) D BLD("HDR",PG,0,60,"Page ","GMRCPG,65")
"RTN","GMRCP5D",105,0)
 .;
"RTN","GMRCP5D",106,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",107,0)
 .D BLD("HDR",PG,1,0,"Consult Request: "_$$CONSRQ(GMRCIFN))
"RTN","GMRCP5D",108,0)
 .D BLD("HDR",PG,0,55,"|Consult No.: "_GMRCIFN)
"RTN","GMRCP5D",109,0)
 .;
"RTN","GMRCP5D",110,0)
 D BLD("HDR",1,1,0,GMRCEQL)
"RTN","GMRCP5D",111,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",112,0)
 ;
"RTN","GMRCP5D",113,0)
 I $G(CMT) D BLD("HDR",0,1,27,"("_$$PRCMT^GMRCP5B(CMT)_")") Q
"RTN","GMRCP5D",114,0)
 ;
"RTN","GMRCP5D",115,0)
 S GMRCFROM=$P($G(^SC(+$P(GMRCRD,U,6),0)),U,1)
"RTN","GMRCP5D",116,0)
 ;
"RTN","GMRCP5D",117,0)
 I '$L(GMRCFROM) D
"RTN","GMRCP5D",118,0)
 .N VAIN
"RTN","GMRCP5D",119,0)
 .D INP^VADPT
"RTN","GMRCP5D",120,0)
 .S GMRCFROM=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5D",121,0)
 .I $L($G(VAIN(5))) S GMRCFROM=GMRCFROM_" (Rm/Bd: "_$G(VAIN(5))_" )"
"RTN","GMRCP5D",122,0)
 ;No location, IFC - consulting site
"RTN","GMRCP5D",123,0)
 I '$L(GMRCFROM),$P(GMRCRD,U,23),$P($G(GMRCRD(12)),U,5)="F" D
"RTN","GMRCP5D",124,0)
 .I $P(GMRCRD,U,21) S GMRCFROM=$$GET1^DIQ(4,$P(GMRCRD,U,21),.01)
"RTN","GMRCP5D",125,0)
 .E  S GMRCFROM=$$GET1^DIQ(4,$P(GMRCRD,U,23),.01)
"RTN","GMRCP5D",126,0)
 ;
"RTN","GMRCP5D",127,0)
 D BLD("HDR",0,1,0,"To: "_$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",128,0)
 D BLD("HDR",0,1,5,"From: "_GMRCFROM)
"RTN","GMRCP5D",129,0)
 D BLD("HDR",0,0,49,"|Requested: "_$$EXDT($P(GMRCRD,U,7)))
"RTN","GMRCP5D",130,0)
 ;
"RTN","GMRCP5D",131,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",132,0)
 D BLD("HDR",0,1,0,"Requesting Facility: "_$E(GMRCFAC,1,22))
"RTN","GMRCP5D",133,0)
 I $P(GMRCRD,U,11) D BLD("HDR",0,0,45,"|ATTENTION: "_$E($P($G(^VA(200,+$P(GMRCRD,U,11),0)),U,1),1,21))
"RTN","GMRCP5D",134,0)
 I $P(GMRCRD,U,23) D
"RTN","GMRCP5D",135,0)
 . D BLD("HDR",0,1,0,"Remote Consult No.: "_GMRCINO)
"RTN","GMRCP5D",136,0)
 . D BLD("HDR",0,1,0,"Role: "_GMRCIRL)
"RTN","GMRCP5D",137,0)
 D BLD("HDR",0,1,0,GMRCEQL)
"RTN","GMRCP5D",138,0)
 ;
"RTN","GMRCP5D",139,0)
 Q
"RTN","GMRCP5D",140,0)
 ;
"RTN","GMRCP5D",141,0)
CENTER(X) ;
"RTN","GMRCP5D",142,0)
 ;
"RTN","GMRCP5D",143,0)
 N TEXT,COL
"RTN","GMRCP5D",144,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5D",145,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5D",146,0)
 Q TEXT
"RTN","GMRCP5D",147,0)
 ;
"RTN","GMRCP5D",148,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5D",149,0)
 ;
"RTN","GMRCP5D",150,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5D",151,0)
 N LINECNT
"RTN","GMRCP5D",152,0)
 ;
"RTN","GMRCP5D",153,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5D",154,0)
 ;
"RTN","GMRCP5D",155,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5D",156,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5D",157,0)
 ;
"RTN","GMRCP5D",158,0)
 S GMRCLAST=SUB
"RTN","GMRCP5D",159,0)
 Q
"RTN","GMRCP5D",160,0)
 ;
"RTN","GMRCP5D",161,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5D",162,0)
 ;
"RTN","GMRCP5D",163,0)
 N NEXT
"RTN","GMRCP5D",164,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5D",165,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5D",166,0)
 Q
"RTN","GMRCP5D",167,0)
 ;
"RTN","GMRCP5D",168,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5D",169,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5D",170,0)
 ;
"RTN","GMRCP5D",171,0)
CONSRQ(IFN) ;
"RTN","GMRCP5D",172,0)
 ;
"RTN","GMRCP5D",173,0)
 N PTR,LINK,REF,GMRCRQ
"RTN","GMRCP5D",174,0)
 I +$P(^GMR(123,+IFN,0),U,8) D
"RTN","GMRCP5D",175,0)
 . S GMRCRQ=$P(^GMR(123,+IFN,0),U,8)
"RTN","GMRCP5D",176,0)
 . S GMRCRQ=$$GET1^DIQ(123.3,+GMRCRQ,.01)
"RTN","GMRCP5D",177,0)
 . I '$L(GMRCRQ) S GMRCRQ="Procedure"
"RTN","GMRCP5D",178,0)
 I $L($G(GMRCRQ)) Q GMRCRQ
"RTN","GMRCP5D",179,0)
 I $L($G(^GMR(123,IFN,1.11))) D
"RTN","GMRCP5D",180,0)
 . N SERV,TYPE
"RTN","GMRCP5D",181,0)
 . S SERV=$$UP^XLFSTR($$GET1^DIQ(123.5,$P(^GMR(123,IFN,0),U,5),.01))
"RTN","GMRCP5D",182,0)
 . S TYPE=$$UP^XLFSTR(^GMR(123,IFN,1.11)) I TYPE'=SERV D
"RTN","GMRCP5D",183,0)
 . I TYPE'=SERV S GMRCRQ=$E(^GMR(123,IFN,1.11),1,36)
"RTN","GMRCP5D",184,0)
 Q:$L($G(GMRCRQ)) GMRCRQ Q "Consult"
"RTN","GMRCP5D",185,0)
 ;
"RTN","GMRCP5D",186,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5D",187,0)
 ;
"RTN","GMRCP5D",188,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5D",189,0)
 Q:'$L(X) ""
"RTN","GMRCP5D",190,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5D",191,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5D",192,0)
 ;
"RTN","GMRCST")
0^1^B6360349
"RTN","GMRCST",1,0)
GMRCST ;SLC/DCM,dee - Statistics on how long to complete consult/requests for a service ;11/15/02 07:39
"RTN","GMRCST",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,29**;DEC 27, 1997
"RTN","GMRCST",3,0)
EN ; -- main entry point for GMRC REQUEST COMPLETE STAT
"RTN","GMRCST",4,0)
 K GMRCSVC,GMRCSVCP
"RTN","GMRCST",5,0)
 I $D(GMRCEACT),$L(GMRCEACT) D  I '$D(^GMR(123.5,$G(GMRCSVC),0)) D EXIT Q
"RTN","GMRCST",6,0)
 .S GMRCSVCP=GMRCEACT
"RTN","GMRCST",7,0)
 .S GMRCSVC=$O(^GMR(123.5,"B",GMRCSVCP,0))
"RTN","GMRCST",8,0)
 .Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCST",9,0)
 .;Build service array
"RTN","GMRCST",10,0)
 .S GMRCDG=GMRCSVC
"RTN","GMRCST",11,0)
 .D SERV1^GMRCASV
"RTN","GMRCST",12,0)
 .;Set date range to ALL
"RTN","GMRCST",13,0)
 .S GMRCDT1="ALL"
"RTN","GMRCST",14,0)
 .S GMRCDT2=0
"RTN","GMRCST",15,0)
 .D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCST",16,0)
 ;If no service ask for one
"RTN","GMRCST",17,0)
 I '$L($G(GMRCSVC)) D EN^GMRCSTU I $D(GMRCQUT) D EXIT Q
"RTN","GMRCST",18,0)
 ;Quit if no array of services
"RTN","GMRCST",19,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCST",20,0)
 ;
"RTN","GMRCST",21,0)
 D ODT^GMRCSTU Q:$D(GMRCQUT)
"RTN","GMRCST",22,0)
 D EN^VALM("GMRC REQUEST COMPLETE STAT")
"RTN","GMRCST",23,0)
 Q
"RTN","GMRCST",24,0)
 ;
"RTN","GMRCST",25,0)
HDR ; -- header code
"RTN","GMRCST",26,0)
 S VALMHDR(1)="Number Of Days To Complete A Consult For Services Statistics."
"RTN","GMRCST",27,0)
 S VALMHDR(2)="FROM: "_$G(GMRCEDT1)_"   TO: "_$G(GMRCEDT2)
"RTN","GMRCST",28,0)
 Q
"RTN","GMRCST",29,0)
 ;
"RTN","GMRCST",30,0)
INIT ; -- init variables and list array
"RTN","GMRCST",31,0)
 S VALMCNT=$G(GMRCCT),VALMBCK="R"
"RTN","GMRCST",32,0)
 Q
"RTN","GMRCST",33,0)
 ;
"RTN","GMRCST",34,0)
HELP ; -- help code
"RTN","GMRCST",35,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCST",36,0)
 Q
"RTN","GMRCST",37,0)
 ;
"RTN","GMRCST",38,0)
EXIT ; -- exit code
"RTN","GMRCST",39,0)
 K ^TMP("GMRCR",$J,"PRL"),^TMP("GMRCSVC",$J)
"RTN","GMRCST",40,0)
 K GMRCCT,GMRCSVC,GMRCEDT1,GMRCEDT2
"RTN","GMRCST",41,0)
 Q
"RTN","GMRCST",42,0)
 ;
"RTN","GMRCST",43,0)
EXPND ; -- expand code
"RTN","GMRCST",44,0)
 Q
"RTN","GMRCST",45,0)
 ;
"RTN","GMRCST",46,0)
PRNTONLY ;Option to just send the report to a device.
"RTN","GMRCST",47,0)
 ;Get the service and date range.
"RTN","GMRCST",48,0)
 N GMRCQUT,RETURN,GMRCDG,VALMBCK
"RTN","GMRCST",49,0)
 N GMRCDT1,GMRCDT2,GMRCEDT1,GMRCEDT2
"RTN","GMRCST",50,0)
 D EN^GMRCSTU
"RTN","GMRCST",51,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCST",52,0)
 ;Quit if no array of services
"RTN","GMRCST",53,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCST",54,0)
 ;Get the device
"RTN","GMRCST",55,0)
 D PRNTASK^GMRCSTU
"RTN","GMRCST",56,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCST",57,0)
 ;Create the report if not queued
"RTN","GMRCST",58,0)
 I '$D(IO("Q")) D ENOR^GMRCSTU(.RETURN,GMRCDG,GMRCDT1,GMRCDT2)
"RTN","GMRCST",59,0)
 ;Print the report
"RTN","GMRCST",60,0)
 D PRNTIT^GMRCSTU("PRL","PRNTQ^GMRCST","CONSULT/REQUEST PACKAGE PRINT COMPLETION TIME STATISTICS FROM OPTION")
"RTN","GMRCST",61,0)
 D EXIT
"RTN","GMRCST",62,0)
 Q
"RTN","GMRCST",63,0)
 ;
"RTN","GMRCST",64,0)
PRNTQ ;Print Queued report from ^TMP global then kill off ^TMP & ^XTMP
"RTN","GMRCST",65,0)
 ;Create the report
"RTN","GMRCST",66,0)
 N RETURN,INDEX
"RTN","GMRCST",67,0)
 D ENOR^GMRCSTU(.RETURN,GMRCDG,GMRCDT1,GMRCDT2)
"RTN","GMRCST",68,0)
 U IO
"RTN","GMRCST",69,0)
 S INDEX=""
"RTN","GMRCST",70,0)
 F  S INDEX=$O(^TMP("GMRCR",$J,TMPNAME,INDEX)) Q:INDEX=""  W ^TMP("GMRCR",$J,TMPNAME,INDEX,0),!
"RTN","GMRCST",71,0)
 K ^TMP("GMRCR",$J,TMPNAME),^XTMP("GMRCR",J,DOLLARH,"PRINT"),J,DOLLARH
"RTN","GMRCST",72,0)
 D ^%ZISC
"RTN","GMRCST",73,0)
 D EXIT
"RTN","GMRCST",74,0)
 Q
"RTN","GMRCST",75,0)
 ;
"RTN","GMRCSTL1")
0^5^B17452945
"RTN","GMRCSTL1",1,0)
GMRCSTL1 ;SLC/DCM,dee;MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;11/13/02 08:30
"RTN","GMRCSTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,21,22,29**;DEC 27, 1997
"RTN","GMRCSTL1",3,0)
 ; Patch #21 changed array GMRCTOT to ^TMP("GMRCTOT,$J)
"RTN","GMRCSTL1",4,0)
 ; This routine invokes IA #875, #2638
"RTN","GMRCSTL1",5,0)
 Q
"RTN","GMRCSTL1",6,0)
STATNAME(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",7,0)
 I STATUS<9 Q $S(STATUS=1:"Discont.",STATUS=2:"Completed",STATUS=3:"On Hold",STATUS=4:"Flagged",STATUS=5:"Pending",STATUS=6:"Active",STATUS=7:"Expired",STATUS=8:"Scheduled",1:"No Status")
"RTN","GMRCSTL1",8,0)
 E  Q $S(STATUS=9:"Incomplete",STATUS=10:"Delayed",STATUS=11:"Unreleased",STATUS=12:"Discont/Ed",STATUS=13:"Cancelled",STATUS=14:"Lapsed",STATUS=15:"Renewed",1:"No Status")
"RTN","GMRCSTL1",9,0)
 Q
"RTN","GMRCSTL1",10,0)
 ;
"RTN","GMRCSTL1",11,0)
STATABBR(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",12,0)
 Q ^ORD(100.01,STATUS,.1)
"RTN","GMRCSTL1",13,0)
 ;
"RTN","GMRCSTL1",14,0)
LISTTOT(COUNT,GEN,INDEX,NAME,GROUPNAM,CONTROL,ARRN) ;
"RTN","GMRCSTL1",15,0)
 N LOOP,STATUS,STS,CTRLTEMP,GMRCTOTS
"RTN","GMRCSTL1",16,0)
 S CTRLTEMP=$S(CONTROL#2:"^",1:"")
"RTN","GMRCSTL1",17,0)
 I GEN=2 D
"RTN","GMRCSTL1",18,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",19,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP
"RTN","GMRCSTL1",20,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",21,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"          GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTL1",22,0)
 S GMRCTOTS=0
"RTN","GMRCSTL1",23,0)
 I $L(GMRCSTAT,",")=16 S GMRCTOTS=1 ;only incl. totals if all status
"RTN","GMRCSTL1",24,0)
 F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) I ^TMP("GMRCTOT",$J,GEN,INDEX,STATUS)>0 D
"RTN","GMRCSTL1",25,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",26,0)
 .S STS=$$STATNAME(STATUS)
"RTN","GMRCSTL1",27,0)
 .I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"To Service "_NAME_" Total Requests "_STS_$J(^TMP("GMRCTOT",$J,1,INDEX,STATUS),6,0)
"RTN","GMRCSTL1",28,0)
 .E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"To Grouper "_NAME_" Total Requests "_STS_$J(^TMP("GMRCTOT",$J,2,INDEX,STATUS),6,0)
"RTN","GMRCSTL1",29,0)
 ;If any printed are pending then print the total that are pending for all pending status.
"RTN","GMRCSTL1",30,0)
 I ^TMP("GMRCTOT",$J,GEN,INDEX,"P")>0 D
"RTN","GMRCSTL1",31,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",32,0)
 .I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests Pending Resolution To Service "_NAME_": "_$J(^TMP("GMRCTOT",$J,1,INDEX,"P"),6,0)
"RTN","GMRCSTL1",33,0)
 .E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests Pending Resolution To Grouper "_NAME_": "_$J(^TMP("GMRCTOT",$J,2,INDEX,"P"),6,0)
"RTN","GMRCSTL1",34,0)
 ; IF Consults
"RTN","GMRCSTL1",35,0)
 I ARRN="IFC" D
"RTN","GMRCSTL1",36,0)
 .N IRFN,VALSVC,VALTOT S IRFN=""
"RTN","GMRCSTL1",37,0)
 .F  S IRFN=$O(^TMP("GMRCTOT",$J,GEN,INDEX,"F",IRFN)) Q:IRFN=""  D
"RTN","GMRCSTL1",38,0)
 ..S COUNT=COUNT+1
"RTN","GMRCSTL1",39,0)
 ..I GMRCTOTS D
"RTN","GMRCSTL1",40,0)
 ...I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Service "_$E(NAME,1,16)_" @ "_$E(IRFN,1,16)_": "_$J(^TMP("GMRCTOT",$J,1,INDEX,"F",IRFN),6,0)
"RTN","GMRCSTL1",41,0)
 ...E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests to Grouper "_$E(NAME,1,20)_" @ "_$E(IRFN,1,20)_": "_$J(^TMP("GMRCTOT",$J,2,INDEX,"F",IRFN),6,0)
"RTN","GMRCSTL1",42,0)
 ..I $P($G(GMRCST(GEN,INDEX,IRFN)),"^",2)>0 D
"RTN","GMRCSTL1",43,0)
 ...S COUNT=COUNT+1
"RTN","GMRCSTL1",44,0)
 ...S VALSVC=$P(GMRCST(GEN,INDEX,IRFN),"^")\$P(GMRCST(GEN,INDEX,IRFN),"^",2)
"RTN","GMRCSTL1",45,0)
 ...S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Mean Days Completed To "_$S(GEN=1:"Service ",1:"Grouper ")_$E(NAME,1,20)_" @ "_$E(IRFN,1,20)_": "_$J(VALSVC,4,0)
"RTN","GMRCSTL1",46,0)
 .I $P($G(GMRCST(GEN,INDEX)),"^",2)>0 D
"RTN","GMRCSTL1",47,0)
 ..S COUNT=COUNT+1
"RTN","GMRCSTL1",48,0)
 ..S VALTOT=$P(GMRCST(GEN,INDEX),"^")\$P(GMRCST(GEN,INDEX),"^",2)
"RTN","GMRCSTL1",49,0)
 ..S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Mean Days Completed To "_$S(GEN=1:"Service ",1:"Grouper ")_$E(NAME,1,20)_": "_$J(VALTOT,4,0)
"RTN","GMRCSTL1",50,0)
 S COUNT=COUNT+1
"RTN","GMRCSTL1",51,0)
 I GMRCTOTS D
"RTN","GMRCSTL1",52,0)
 .I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Service "_NAME_": "_$J(^TMP("GMRCTOT",$J,1,INDEX,"T"),6,0)
"RTN","GMRCSTL1",53,0)
 .E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Grouper "_NAME_": "_$J(^TMP("GMRCTOT",$J,2,INDEX,"T"),6,0)
"RTN","GMRCSTL1",54,0)
 Q
"RTN","GMRCSTL1",55,0)
 ;
"RTN","GMRCSTLM")
0^13^B82753364
"RTN","GMRCSTLM",1,0)
GMRCSTLM ;SLC/DCM,dee,MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;11/21/02  05:29
"RTN","GMRCSTLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21,23,22,29**;DEC 27, 1997
"RTN","GMRCSTLM",3,0)
 ; Patch #21 added a initialization KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",4,0)
 ; Patch #23 remove the default prompt "ALL SERVICES"
"RTN","GMRCSTLM",5,0)
 Q
"RTN","GMRCSTLM",6,0)
 ;
"RTN","GMRCSTLM",7,0)
EN ;Ask for new service and date range
"RTN","GMRCSTLM",8,0)
 K GMRCQUT
"RTN","GMRCSTLM",9,0)
 N DIROUT,DTOUT,DUOUT,DIR
"RTN","GMRCSTLM",10,0)
 ;
"RTN","GMRCSTLM",11,0)
 ;Ask for service
"RTN","GMRCSTLM",12,0)
 N Y
"RTN","GMRCSTLM",13,0)
 S DIR(0)="PO^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTLM",14,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTLM",15,0)
 D ^DIR
"RTN","GMRCSTLM",16,0)
 I Y<1 S VALMBCK="Q" Q
"RTN","GMRCSTLM",17,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTLM",18,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",19,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S VALMBCK="Q" Q 
"RTN","GMRCSTLM",20,0)
 ;
"RTN","GMRCSTLM",21,0)
 ;Ask for date range
"RTN","GMRCSTLM",22,0)
 D ^GMRCSPD
"RTN","GMRCSTLM",23,0)
 I $D(GMRCQUT) S VALMBCK="Q" G EXIT
"RTN","GMRCSTLM",24,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",25,0)
 Q
"RTN","GMRCSTLM",26,0)
 ;
"RTN","GMRCSTLM",27,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL,GMRCARRN) ;Entry point for GUI interface.
"RTN","GMRCSTLM",28,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTLM",29,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTLM",30,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTLM",31,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTLM",32,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTLM",33,0)
 ;GMRCCTRL:   0, null or not define then just the display list is 
"RTN","GMRCSTLM",34,0)
 ;                displayed
"RTN","GMRCSTLM",35,0)
 ;            1 then the list will be two pieces with the first piece 
"RTN","GMRCSTLM",36,0)
 ;                being the ien of the consult for selection in the gui
"RTN","GMRCSTLM",37,0)
 ;                and the second piece being the display text.
"RTN","GMRCSTLM",38,0)
 ;           10 then the consults will have a line number on them for
"RTN","GMRCSTLM",39,0)
 ;                selection
"RTN","GMRCSTLM",40,0)
 ;           20 then the consults will have the consult number displayed
"RTN","GMRCSTLM",41,0)
 ;          100 then use abbreviations for the statuses
"RTN","GMRCSTLM",42,0)
 ;      1, (10 or 20) and 100 can be added together to add there features
"RTN","GMRCSTLM",43,0)
 ;GMRCARRN: List Template Array Name
"RTN","GMRCSTLM",44,0)
 ;          "CP": pending; "IFC": inter-facility
"RTN","GMRCSTLM",45,0)
 ;
"RTN","GMRCSTLM",46,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTLM",47,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTLM",48,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTLM",49,0)
 ;            1  grouper only
"RTN","GMRCSTLM",50,0)
 ;            2  tracking only
"RTN","GMRCSTLM",51,0)
 ;            9  disabled
"RTN","GMRCSTLM",52,0)
 ;
"RTN","GMRCSTLM",53,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTLM",54,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTLM",55,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTLM",56,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",57,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTLM",58,0)
 ;Build service array
"RTN","GMRCSTLM",59,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTLM",60,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",61,0)
 ;Get external form of date range
"RTN","GMRCSTLM",62,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTLM",63,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTLM",64,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",65,0)
 G ENORSTR
"RTN","GMRCSTLM",66,0)
 ;
"RTN","GMRCSTLM",67,0)
ENORLM(GMRCARRN) ;Entry point for List Manager interface.
"RTN","GMRCSTLM",68,0)
 ; Input -- GMRCARRN  List Template Array Name
"RTN","GMRCSTLM",69,0)
 ;          "CP": pending; "IFC": inter-facility
"RTN","GMRCSTLM",70,0)
 ; Output - None
"RTN","GMRCSTLM",71,0)
 D WAIT^DICD
"RTN","GMRCSTLM",72,0)
 ;
"RTN","GMRCSTLM",73,0)
ENORSTR ;Common part
"RTN","GMRCSTLM",74,0)
 N GMRCDA,NUMCLIN,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTLM",75,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP
"RTN","GMRCSTLM",76,0)
 N GMRCPT,CTRLTEMP,LINETEMP,GMRCLINE
"RTN","GMRCSTLM",77,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTLM",78,0)
 N GRP,GMRCIRF,GMRCIRFN,GMRCIDD,GMRCST,GMRCRDT
"RTN","GMRCSTLM",79,0)
 S:'$D(GMRCARRN) GMRCARRN="CP"
"RTN","GMRCSTLM",80,0)
 ;
"RTN","GMRCSTLM",81,0)
 ; Patch #21 added the kill for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",82,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",83,0)
 ;
"RTN","GMRCSTLM",84,0)
 S GMRCCT=0
"RTN","GMRCSTLM",85,0)
 S NUMCLIN=0
"RTN","GMRCSTLM",86,0)
 S GMRCLINE=0
"RTN","GMRCSTLM",87,0)
 S GROUPER=0
"RTN","GMRCSTLM",88,0)
 S GROUPER(0)=0
"RTN","GMRCSTLM",89,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",90,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCSTLM",91,0)
 S CTRLTEMP=$S(GMRCCTRL#2:"^",1:"")
"RTN","GMRCSTLM",92,0)
 I GMRCARRN="IFC" D
"RTN","GMRCSTLM",93,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",18)_"IF Consult/Request By Status - "_$S(GMRCIS="R":"Requesting",1:"Consulting")_" Site"
"RTN","GMRCSTLM",94,0)
 E  D
"RTN","GMRCSTLM",95,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",28)_"Consult/Request By Status"
"RTN","GMRCSTLM",96,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",97,0)
 S TEMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTLM",98,0)
 S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTLM",99,0)
 I GMRCARRN="IFC",$D(GMRCRF),$D(GMRCREMP) D
"RTN","GMRCSTLM",100,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",101,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_"Routing Facility - "_$$GET1^DIQ(4,GMRCRF,.01)
"RTN","GMRCSTLM",102,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",103,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_"Remote Ordering Provider - "_GMRCREMP
"RTN","GMRCSTLM",104,0)
 I GMRCCTRL=120 D
"RTN","GMRCSTLM",105,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",106,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",107,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",108,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)="   Number St   Last Action         Req Dt   Patient Name            Patient Location"_$S(GMRCARRN="IFC":"         Routing Facility  Days Diff"_$S(GMRCIS="C":"  Rec Dt",1:""),1:"")
"RTN","GMRCSTLM",109,0)
 ;
"RTN","GMRCSTLM",110,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",111,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL",GMRCDT2=0
"RTN","GMRCSTLM",112,0)
 I '($D(GMRCDT2)#2) S GMRCDT2=""
"RTN","GMRCSTLM",113,0)
 I '($D(GMRCSTAT)#2),GMRCARRN="CP" S GMRCSTAT="3,4,5,6,8,9,11,99" ;pending consults
"RTN","GMRCSTLM",114,0)
 I '($D(GMRCSTAT)#2),GMRCARRN="IFC"  S GMRCSTAT="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,99"
"RTN","GMRCSTLM",115,0)
 ;
"RTN","GMRCSTLM",116,0)
CAPTION ;Set the List Mangager Caption Line
"RTN","GMRCSTLM",117,0)
 ; Does GMRCCTRL contain 10 i.e. display line numbers
"RTN","GMRCSTLM",118,0)
 ;                    or 20 i.e. display consult number
"RTN","GMRCSTLM",119,0)
 I $G(VALMAR)="^TMP(""GMRCR"",$J,""CP"")"!($G(VALMAR)="^TMP(""GMRCR"",$J,""IFC"")") D
"RTN","GMRCSTLM",120,0)
 .I GMRCCTRL#100\10 D
"RTN","GMRCSTLM",121,0)
 ..I GMRCCTRL#100\10=1 D
"RTN","GMRCSTLM",122,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",123,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","     St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",124,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",125,0)
 ...E  D CHGCAP^VALM("CAPTION LINE","     Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",126,0)
 ..; Do not display consult number
"RTN","GMRCSTLM",127,0)
 ..E  D
"RTN","GMRCSTLM",128,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",129,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE"," Number   St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",130,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",131,0)
 ...E  D CHGCAP^VALM("CAPTION LINE"," Number   Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",132,0)
 .E  D
"RTN","GMRCSTLM",133,0)
 ..; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",134,0)
 ..I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",135,0)
 ..; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",136,0)
 ..E  D CHGCAP^VALM("CAPTION LINE","Status      Last Action      Request Date  Patient Name      Pt Location")
"RTN","GMRCSTLM",137,0)
 .I GMRCARRN="IFC" D
"RTN","GMRCSTLM",138,0)
 ..D CHGCAP^VALM("CAPTION LINE 1","Routing Facility  Days Diff"_$S(GMRCIS="C":"  Rec Date",1:""))
"RTN","GMRCSTLM",139,0)
 ;Set screen width
"RTN","GMRCSTLM",140,0)
 S VALM("RM")=$S(GMRCARRN="CP":$$CWIDTH^GMRCPC(GMRCCTRL),1:$$CWIDTH^GMRCIR(GMRCCTRL))
"RTN","GMRCSTLM",141,0)
 ;
"RTN","GMRCSTLM",142,0)
 S GMRCHEAD=$P($G(^TMP("GMRCSLIST",$J,+$O(^TMP("GMRCSLIST",$J,"")))),"^",2)
"RTN","GMRCSTLM",143,0)
 S INDEX=""
"RTN","GMRCSTLM",144,0)
SVC ;Loop on Service
"RTN","GMRCSTLM",145,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTLM",146,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTLM",147,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTLM",148,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTLM",149,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTLM",150,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTLM",151,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTLM",152,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTLM",153,0)
 .I GMRCARRN="IFC" D
"RTN","GMRCSTLM",154,0)
 ..S GMRCST(1,GMRCSVC)="0^0"
"RTN","GMRCSTLM",155,0)
 ..S GMRCST(2,GMRCSVC)="0^0"
"RTN","GMRCSTLM",156,0)
GROUPER .;Check if starting a new Grouper
"RTN","GMRCSTLM",157,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTLM",158,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTLM",159,0)
 ..D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",160,0)
 ..;pop grouper from stack
"RTN","GMRCSTLM",161,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTLM",162,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTLM",163,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTLM",164,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",165,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",166,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",167,0)
 ..S TEMP="GROUPER: "_GMRCSVCP
"RTN","GMRCSTLM",168,0)
 ..S:GMRCSVCG>0 TEMP=TEMP_"  in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTLM",169,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",40-(($L(TEMP)/2)+.5))_TEMP
"RTN","GMRCSTLM",170,0)
 ..;push new grouper on stack
"RTN","GMRCSTLM",171,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTLM",172,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTLM",173,0)
STAT .;Loop for one status at a time
"RTN","GMRCSTLM",174,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D ONESTAT^GMRCSTL2(GMRCARRN)
"RTN","GMRCSTLM",175,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTLM",176,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTLM",177,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTLM",178,0)
 ..;  for all status for this service to all of its groupers
"RTN","GMRCSTLM",179,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTLM",180,0)
 ..;IF Consults
"RTN","GMRCSTLM",181,0)
 ..I GMRCARRN="IFC" S GMRCIRFN="" F  S GMRCIRFN=$O(^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)) Q:GMRCIRFN=""  D
"RTN","GMRCSTLM",182,0)
 ...I '$D(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)) D
"RTN","GMRCSTLM",183,0)
 ....S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)=0
"RTN","GMRCSTLM",184,0)
 ....S GMRCST(2,GROUPER(GRP),GMRCIRFN)="0^0"
"RTN","GMRCSTLM",185,0)
 ...S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN))+^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)
"RTN","GMRCSTLM",186,0)
 ...I +$P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2)>0 D
"RTN","GMRCSTLM",187,0)
 ....S $P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^")=($P(GMRCST(2,GROUPER(GRP)),"^"))+($P(GMRCST(1,GMRCSVC,GMRCIRFN),"^"))
"RTN","GMRCSTLM",188,0)
 ....S $P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^",2)=($P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^",2))+($P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2))
"RTN","GMRCSTLM",189,0)
 ..I GMRCARRN="IFC" D
"RTN","GMRCSTLM",190,0)
 ...S $P(GMRCST(2,GROUPER(GRP)),"^")=($P(GMRCST(2,GROUPER(GRP)),"^"))+($P(GMRCST(1,GMRCSVC),"^"))
"RTN","GMRCSTLM",191,0)
 ...S $P(GMRCST(2,GROUPER(GRP)),"^",2)=($P(GMRCST(2,GROUPER(GRP)),"^",2))+($P(GMRCST(1,GMRCSVC),"^",2))
"RTN","GMRCSTLM",192,0)
 .;
"RTN","GMRCSTLM",193,0)
PRINTST .;Print the totals for this service that are >0
"RTN","GMRCSTLM",194,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")>0 D LISTTOT^GMRCSTL1(.GMRCCT,1,GMRCSVC,GMRCSVCP,$P($G(^GMR(123.5,GMRCSVCG,0)),"^",1),GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",195,0)
 ;
"RTN","GMRCSTLM",196,0)
 ;Done so
"RTN","GMRCSTLM",197,0)
 ;Now list the group totals for the current groups
"RTN","GMRCSTLM",198,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTLM",199,0)
 .D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",200,0)
 ;
"RTN","GMRCSTLM",201,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,GMRCARRN," "),-1)
"RTN","GMRCSTLM",202,0)
 I $D(IOBM),$D(IOTM) S VALMBCK="R"
"RTN","GMRCSTLM",203,0)
EXIT Q
"RTN","GMRCSTLM",204,0)
 ;
"RTN","GMRCSTU")
0^2^B61572090
"RTN","GMRCSTU",1,0)
GMRCSTU ;SLC/DCM,dee - Statistic Utilities for C/RT ;09/26/02 10:16
"RTN","GMRCSTU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,29**;DEC 27, 1997
"RTN","GMRCSTU",3,0)
 Q
"RTN","GMRCSTU",4,0)
 ;
"RTN","GMRCSTU",5,0)
GETDT(GMRCO) ;get the date that the consult/request was accepted by service
"RTN","GMRCSTU",6,0)
 N ND,GMRCDA
"RTN","GMRCSTU",7,0)
 S COMPLDT=9999999
"RTN","GMRCSTU",8,0)
 S ND=0 F  S ND=$O(^GMR(123,GMRCO,40,ND)) Q:ND?1A.E!(ND="")  D
"RTN","GMRCSTU",9,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=21 GMRCDA=$P(^(0),"^",1)
"RTN","GMRCSTU",10,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=1 GMRCDA(1)=$P(^(0),"^",1)
"RTN","GMRCSTU",11,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=15 GMRCDA(15)=$P(^(0),"^",3)
"RTN","GMRCSTU",12,0)
 .I $P(^GMR(123,GMRCO,40,ND,0),"^",2)=10,$P(^(0),"^",3)<COMPLDT S COMPLDT=$P(^(0),"^",3)
"RTN","GMRCSTU",13,0)
 S RCVDT=$S($D(GMRCDA)#2:GMRCDA,$D(GMRCDA(1)):GMRCDA(1),$D(GMRCDA(15)):GMRCDA(15),1:$P(^GMR(123,GMRCO,0),"^",1))
"RTN","GMRCSTU",14,0)
 Q
"RTN","GMRCSTU",15,0)
EN ;
"RTN","GMRCSTU",16,0)
 K ^TMP("GMRCSLIST",$J),GMRCQUT
"RTN","GMRCSTU",17,0)
 ;Get the service/grouper
"RTN","GMRCSTU",18,0)
 D ASRV^GMRCASV
"RTN","GMRCSTU",19,0)
 G:$D(GMRCQUT) KILL
"RTN","GMRCSTU",20,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 G KILL
"RTN","GMRCSTU",21,0)
 ;Get the date range
"RTN","GMRCSTU",22,0)
 D ^GMRCSPD
"RTN","GMRCSTU",23,0)
 G:$D(GMRCQUT) KILL
"RTN","GMRCSTU",24,0)
 Q
"RTN","GMRCSTU",25,0)
 ;
"RTN","GMRCSTU",26,0)
ENOR(RETURN,GMRCSRVC,GMRCDT1,GMRCDT2) ;Entry point for GUI interface.
"RTN","GMRCSTU",27,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTU",28,0)
 ;GMRCSRVC:  Service for which consults are to be displayed.
"RTN","GMRCSTU",29,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTU",30,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTU",31,0)
 ;
"RTN","GMRCSTU",32,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTU",33,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTU",34,0)
 ;            1  grouper only
"RTN","GMRCSTU",35,0)
 ;            2  tracking only
"RTN","GMRCSTU",36,0)
 ;            9  disabled
"RTN","GMRCSTU",37,0)
 ;
"RTN","GMRCSTU",38,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTU",39,0)
 N GMRCWRIT
"RTN","GMRCSTU",40,0)
 S GMRCWRIT=0
"RTN","GMRCSTU",41,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCSTU",42,0)
 S RETURN="^TMP(""GMRCR"",$J,""PRL"")"
"RTN","GMRCSTU",43,0)
 I '($D(GMRCSRVC)#2) S GMRCSRVC=1
"RTN","GMRCSTU",44,0)
 Q:'$D(^GMR(123.5,$G(GMRCSRVC),0))
"RTN","GMRCSTU",45,0)
 ;Build service array
"RTN","GMRCSTU",46,0)
 S GMRCDG=GMRCSRVC
"RTN","GMRCSTU",47,0)
 D SERV1^GMRCASV
"RTN","GMRCSTU",48,0)
 ;Get external form of date range
"RTN","GMRCSTU",49,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTU",50,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTU",51,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTU",52,0)
 G ODTSTR
"RTN","GMRCSTU",53,0)
 ;
"RTN","GMRCSTU",54,0)
ODT ;List Manager entry point
"RTN","GMRCSTU",55,0)
 N GMRCWRIT
"RTN","GMRCSTU",56,0)
 S GMRCWRIT=1
"RTN","GMRCSTU",57,0)
 D WAIT^DICD
"RTN","GMRCSTU",58,0)
 ;
"RTN","GMRCSTU",59,0)
ODTSTR ;Find the mean, standard deviation of how long to complete a consult from when it is accepted in the service to when it is complete
"RTN","GMRCSTU",60,0)
 N RCVDT,COMPLDT,INDEX,TEMPTMP,GROUPER,TAB
"RTN","GMRCSTU",61,0)
 N GMRCDG,GMRCDGT,GMRCDT
"RTN","GMRCSTU",62,0)
 N GMRCGRP,GMRCND,GMRCO,ND,X,X1,X2
"RTN","GMRCSTU",63,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 G KILL
"RTN","GMRCSTU",64,0)
 S INDEX=0
"RTN","GMRCSTU",65,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTU",66,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",67,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",68,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"T")="0^0^0^0^0^0"
"RTN","GMRCSTU",69,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"I")="0^0^0^0^0"
"RTN","GMRCSTU",70,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"O")="0^0^0^0^0"
"RTN","GMRCSTU",71,0)
 .S ^TMP("GMRCSVC",$J,1,ND,"U")="0^0^0^0^0"
"RTN","GMRCSTU",72,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"T")="0^0^0^0^0^0"
"RTN","GMRCSTU",73,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"I")="0^0^0^0^0"
"RTN","GMRCSTU",74,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"O")="0^0^0^0^0"
"RTN","GMRCSTU",75,0)
 .S ^TMP("GMRCSVC",$J,2,ND,"U")="0^0^0^0^0"
"RTN","GMRCSTU",76,0)
 S GMRCND=0
"RTN","GMRCSTU",77,0)
 S INDEX=""
"RTN","GMRCSTU",78,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX),-1) Q:INDEX=""  D
"RTN","GMRCSTU",79,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",80,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",81,0)
 .Q:$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)>0
"RTN","GMRCSTU",82,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",5)'=1 D
"RTN","GMRCSTU",83,0)
 ..S GMRCDT=""
"RTN","GMRCSTU",84,0)
 ..F  S GMRCDT=$O(^GMR(123,"AE",ND,2,GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCSTU",85,0)
 ...S GMRCO=0
"RTN","GMRCSTU",86,0)
 ...F  S GMRCO=$O(^GMR(123,"AE",ND,2,GMRCDT,GMRCO)) Q:GMRCO=""  D  W:GMRCWRIT&'(GMRCND#25) "."
"RTN","GMRCSTU",87,0)
 ....D GETDT(GMRCO)
"RTN","GMRCSTU",88,0)
 ....I COMPLDT<9999999,$S(GMRCDT1="ALL":1,RCVDT'<GMRCDT1&(RCVDT'>GMRCDT2):1,1:0) D
"RTN","GMRCSTU",89,0)
 .....S X1=COMPLDT
"RTN","GMRCSTU",90,0)
 .....S X2=RCVDT
"RTN","GMRCSTU",91,0)
 .....D ^%DTC
"RTN","GMRCSTU",92,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),U)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),U)+X
"RTN","GMRCSTU",93,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",2)+1
"RTN","GMRCSTU",94,0)
 .....S $P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"T"),"^",3)+(X*X)
"RTN","GMRCSTU",95,0)
 .....I $P(^GMR(123,GMRCO,0),"^",18)="I" D
"RTN","GMRCSTU",96,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",1)+X
"RTN","GMRCSTU",97,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",2)+1
"RTN","GMRCSTU",98,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"I"),"^",3)+(X*X)
"RTN","GMRCSTU",99,0)
 .....E  I $P(^GMR(123,GMRCO,0),"^",18)="O" D
"RTN","GMRCSTU",100,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",1)+X
"RTN","GMRCSTU",101,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",2)+1
"RTN","GMRCSTU",102,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"O"),"^",3)+(X*X)
"RTN","GMRCSTU",103,0)
 .....E  D
"RTN","GMRCSTU",104,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",1)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",1)+X
"RTN","GMRCSTU",105,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",2)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",2)+1
"RTN","GMRCSTU",106,0)
 ......S $P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",3)=$P(^TMP("GMRCSVC",$J,1,ND,"U"),"^",3)+(X*X)
"RTN","GMRCSTU",107,0)
 .....S GMRCND=GMRCND+1
"RTN","GMRCSTU",108,0)
 .D PARENTS^GMRCSTU1(ND,+$P(^TMP("GMRCSLIST",$J,INDEX),"^",3))
"RTN","GMRCSTU",109,0)
 S ND=0
"RTN","GMRCSTU",110,0)
STAT ;Do the statistics
"RTN","GMRCSTU",111,0)
 F  S ND=$O(^TMP("GMRCSVC",$J,2,ND)) Q:ND=""  D
"RTN","GMRCSTU",112,0)
 .I $P($G(^TMP("GMRCSVC",$J,1,ND,"T")),"^",1)>0 D DOSTAT^GMRCSTU1(1,ND)
"RTN","GMRCSTU",113,0)
 .I $P(^TMP("GMRCSVC",$J,2,ND,"T"),"^",1)>0 D DOSTAT^GMRCSTU1(2,ND)
"RTN","GMRCSTU",114,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCSTU",115,0)
 S GMRCCT=0
"RTN","GMRCSTU",116,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTU",117,0)
 S TAB=""
"RTN","GMRCSTU",118,0)
 S $P(TAB," ",40)=""
"RTN","GMRCSTU",119,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",120,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,19)_"Consult/Request Completion Time Statistics"
"RTN","GMRCSTU",121,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",122,0)
 S TEMPTMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTU",123,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,40-($L(TEMPTMP)/2))_TEMPTMP
"RTN","GMRCSTU",124,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",125,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=""
"RTN","GMRCSTU",126,0)
 S INDEX=0
"RTN","GMRCSTU",127,0)
 S GROUPER=0
"RTN","GMRCSTU",128,0)
 S GROUPER(0)=0
"RTN","GMRCSTU",129,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTU",130,0)
 .S ND=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTU",131,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9&'$D(^TMP("GMRCSVC",$J,2,ND))
"RTN","GMRCSTU",132,0)
 .F  Q:GROUPER(GROUPER)=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)  D
"RTN","GMRCSTU",133,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTU",134,0)
 ..D SERVSTAT^GMRCSTU1(.GMRCCT,2,GROUPER(GROUPER),GROUPER(GROUPER))
"RTN","GMRCSTU",135,0)
 ..;pop grouper from stack
"RTN","GMRCSTU",136,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTU",137,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTU",138,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTU",139,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",140,0)
 ..S TEMPTMP="GROUPER: "_$P(^GMR(123.5,ND,0),"^",1)
"RTN","GMRCSTU",141,0)
 ..S:$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)>0 TEMPTMP=TEMPTMP_"  in Group: "_$P(^GMR(123.5,$P(^TMP("GMRCSLIST",$J,INDEX),"^",3),0),"^",1)
"RTN","GMRCSTU",142,0)
 ..S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,40-(($L(TEMPTMP)/2)+.5))_TEMPTMP
"RTN","GMRCSTU",143,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",144,0)
 ..S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=""
"RTN","GMRCSTU",145,0)
 ..;push new grouper on stack
"RTN","GMRCSTU",146,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTU",147,0)
 ..S GROUPER(GROUPER)=ND
"RTN","GMRCSTU",148,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=1
"RTN","GMRCSTU",149,0)
 .Q:$P(^TMP("GMRCSLIST",$J,INDEX),"^",5)=9
"RTN","GMRCSTU",150,0)
 .D SERVSTAT^GMRCSTU1(.GMRCCT,1,ND,GROUPER(GROUPER))
"RTN","GMRCSTU",151,0)
 ;Now list the group totals for the current groups.
"RTN","GMRCSTU",152,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTU",153,0)
 .;End of a group so print the group totals
"RTN","GMRCSTU",154,0)
 .D SERVSTAT^GMRCSTU1(.GMRCCT,2,GROUPER(GROUPER),GROUPER(GROUPER))
"RTN","GMRCSTU",155,0)
 ;Done building list.
"RTN","GMRCSTU",156,0)
 S VALMCNT=GMRCCT,VALMBCK="R"
"RTN","GMRCSTU",157,0)
KILL ;kill variables and exit
"RTN","GMRCSTU",158,0)
 S:$D(GMRCQUT) VALMBCK="Q"
"RTN","GMRCSTU",159,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSTU",160,0)
 Q
"RTN","GMRCSTU",161,0)
PRNT ;print statistics to a printer
"RTN","GMRCSTU",162,0)
 ;Called from a List Manager action
"RTN","GMRCSTU",163,0)
 Q:'$D(^TMP("GMRCR",$J,"PRL",2,0))
"RTN","GMRCSTU",164,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSTU",165,0)
 D PRNTASK
"RTN","GMRCSTU",166,0)
 D PRNTIT("PRL","PRNTQ^GMRCSTU","CONSULT/REQUEST PACKAGE PRINT COMPLETION TIME STATISTICS FROM LIST MANAGER DISPLAY")
"RTN","GMRCSTU",167,0)
 Q
"RTN","GMRCSTU",168,0)
 ;
"RTN","GMRCSTU",169,0)
PRNTASK ;Ask for device
"RTN","GMRCSTU",170,0)
 N POP,%ZIS
"RTN","GMRCSTU",171,0)
 K GMRCQUT
"RTN","GMRCSTU",172,0)
 S POP=0
"RTN","GMRCSTU",173,0)
 S %ZIS="MQ"
"RTN","GMRCSTU",174,0)
 D ^%ZIS
"RTN","GMRCSTU",175,0)
 I POP D  Q
"RTN","GMRCSTU",176,0)
 .S GMRCMSG="Printer Busy. Try Again Later."
"RTN","GMRCSTU",177,0)
 .D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCSTU",178,0)
 .K GMRCMSG
"RTN","GMRCSTU",179,0)
 .S GMRCQUT=1
"RTN","GMRCSTU",180,0)
 Q
"RTN","GMRCSTU",181,0)
 ;
"RTN","GMRCSTU",182,0)
PRNTIT(TMPNAME,QUERTN,QUEDESC) ;Send list to printer
"RTN","GMRCSTU",183,0)
 N ANSWER,INDEX,DOLLARH,ZTRTN,ZTDESC,ZTSAVE
"RTN","GMRCSTU",184,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCSTU",185,0)
 .S DOLLARH=$H
"RTN","GMRCSTU",186,0)
 .M ^XTMP("GMRCR","$"_$J,DOLLARH,"PRINT")=^TMP("GMRCR",$J,TMPNAME)
"RTN","GMRCSTU",187,0)
 .S ZTRTN=QUERTN
"RTN","GMRCSTU",188,0)
 .S ZTDESC=QUEDESC
"RTN","GMRCSTU",189,0)
 .S ZTSAVE("J")="$"_$J
"RTN","GMRCSTU",190,0)
 .S ZTSAVE("DOLLARH")=""
"RTN","GMRCSTU",191,0)
 .S ZTSAVE("TMPNAME")=""
"RTN","GMRCSTU",192,0)
 .S ZTSAVE("GMRCDG")=""
"RTN","GMRCSTU",193,0)
 .S ZTSAVE("GMRCDT1")=""
"RTN","GMRCSTU",194,0)
 .S ZTSAVE("GMRCDT2")=""
"RTN","GMRCSTU",195,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","GMRCSTU",196,0)
 .S VALMBCK="R"
"RTN","GMRCSTU",197,0)
 U IO
"RTN","GMRCSTU",198,0)
 S ANSWER=""
"RTN","GMRCSTU",199,0)
 S INDEX=""
"RTN","GMRCSTU",200,0)
 F  S INDEX=$O(^TMP("GMRCR",$J,TMPNAME,INDEX)) Q:INDEX=""  W ^TMP("GMRCR",$J,TMPNAME,INDEX,0),! I IOST["C-",$S($D(IOSL)#2:$Y>(IOSL-2),1:$Y>22) R "Press <ENTER> To Continue, '^' To Quit: ",ANSWER:DTIME Q:'$T!(ANSWER["^")  W @IOF
"RTN","GMRCSTU",201,0)
 I ANSWER'["^",IOST["C-",$Y>1 R !,"Press <ENTER> To Continue: ",ANSWER:DTIME
"RTN","GMRCSTU",202,0)
 U IO(0)
"RTN","GMRCSTU",203,0)
 D ^%ZISC
"RTN","GMRCSTU",204,0)
 S VALMBCK="R"
"RTN","GMRCSTU",205,0)
 Q
"RTN","GMRCSTU",206,0)
 ;
"RTN","GMRCSTU",207,0)
PRNTQ ;Print Queued report from ^XTMP global then kill off ^XTMP
"RTN","GMRCSTU",208,0)
 N INDEX
"RTN","GMRCSTU",209,0)
 U IO
"RTN","GMRCSTU",210,0)
 S INDEX=""
"RTN","GMRCSTU",211,0)
 F  S INDEX=$O(^XTMP("GMRCR",J,DOLLARH,"PRINT",INDEX)) Q:INDEX=""  W ^XTMP("GMRCR",J,DOLLARH,"PRINT",INDEX,0),!
"RTN","GMRCSTU",212,0)
 K ^XTMP("GMRCR",J,DOLLARH,"PRINT"),J,DOLLARH
"RTN","GMRCSTU",213,0)
 D ^%ZISC
"RTN","GMRCSTU",214,0)
 Q
"RTN","GMRCSTU1")
0^3^B44975040
"RTN","GMRCSTU1",1,0)
GMRCSTU1 ;SLC/DCM,dee - Statistic Utilities for C/RT ;9/26/02 10:15
"RTN","GMRCSTU1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,29**;DEC 27, 1997
"RTN","GMRCSTU1",3,0)
 Q
"RTN","GMRCSTU1",4,0)
 ;
"RTN","GMRCSTU1",5,0)
SQRT(X) ;calculate the square root of number X
"RTN","GMRCSTU1",6,0)
 Q X**.5
"RTN","GMRCSTU1",7,0)
 ;
"RTN","GMRCSTU1",8,0)
PARENTS(ND,PARENT) ;Add totals for service to itself as a parent and to its parent service
"RTN","GMRCSTU1",9,0)
 ; ND      This service in GMRCSVC
"RTN","GMRCSTU1",10,0)
 ; PARENT  This services grouper in GMRCSVC
"RTN","GMRCSTU1",11,0)
 N ND2
"RTN","GMRCSTU1",12,0)
 F ND2="T","I","O","U" D
"RTN","GMRCSTU1",13,0)
 .S $P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",1)=$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",1)+$P(^TMP("GMRCSVC",$J,1,ND,ND2),"^",1)
"RTN","GMRCSTU1",14,0)
 .S $P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",2)=$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",2)+$P(^TMP("GMRCSVC",$J,1,ND,ND2),"^",2)
"RTN","GMRCSTU1",15,0)
 .S $P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",3)=$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",3)+$P(^TMP("GMRCSVC",$J,1,ND,ND2),"^",3)
"RTN","GMRCSTU1",16,0)
 .I PARENT D
"RTN","GMRCSTU1",17,0)
 ..S $P(^TMP("GMRCSVC",$J,2,PARENT,ND2),"^",1)=$P($G(^TMP("GMRCSVC",$J,2,PARENT,ND2)),"^",1)+$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",1)
"RTN","GMRCSTU1",18,0)
 ..S $P(^TMP("GMRCSVC",$J,2,PARENT,ND2),"^",2)=$P($G(^TMP("GMRCSVC",$J,2,PARENT,ND2)),"^",2)+$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",2)
"RTN","GMRCSTU1",19,0)
 ..S $P(^TMP("GMRCSVC",$J,2,PARENT,ND2),"^",3)=$P($G(^TMP("GMRCSVC",$J,2,PARENT,ND2)),"^",3)+$P(^TMP("GMRCSVC",$J,2,ND,ND2),"^",3)
"RTN","GMRCSTU1",20,0)
 Q
"RTN","GMRCSTU1",21,0)
 ;
"RTN","GMRCSTU1",22,0)
DOSTAT(GEN,ND) ;Do the number crunching for the statistics
"RTN","GMRCSTU1",23,0)
 ; GEN    1 if service
"RTN","GMRCSTU1",24,0)
 ;        2 if grouper
"RTN","GMRCSTU1",25,0)
 ; ND      This service in GMRCSVC
"RTN","GMRCSTU1",26,0)
 N VAR,SUMX
"RTN","GMRCSTU1",27,0)
 S VAR=$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",2)
"RTN","GMRCSTU1",28,0)
 S $P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",4)=$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",1)/VAR
"RTN","GMRCSTU1",29,0)
 I VAR>1 D
"RTN","GMRCSTU1",30,0)
 .S SUMX=$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",1)
"RTN","GMRCSTU1",31,0)
 .S SUMX=SUMX*SUMX/VAR
"RTN","GMRCSTU1",32,0)
 .S SUMX=($P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",3)-SUMX)/(VAR-1)
"RTN","GMRCSTU1",33,0)
 .S $P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5)=$$SQRT(SUMX)
"RTN","GMRCSTU1",34,0)
 E  S $P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5)="N<2"
"RTN","GMRCSTU1",35,0)
 S VAR=$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",2)
"RTN","GMRCSTU1",36,0)
 I VAR>0 D
"RTN","GMRCSTU1",37,0)
 .S $P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",4)=$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",1)/VAR
"RTN","GMRCSTU1",38,0)
 .I VAR>1 D
"RTN","GMRCSTU1",39,0)
 ..S SUMX=$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",1)
"RTN","GMRCSTU1",40,0)
 ..S SUMX=SUMX*SUMX/VAR
"RTN","GMRCSTU1",41,0)
 ..S SUMX=($P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",3)-SUMX)/(VAR-1)
"RTN","GMRCSTU1",42,0)
 ..S $P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5)=$$SQRT(SUMX)
"RTN","GMRCSTU1",43,0)
 .E  S $P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5)="N<2"
"RTN","GMRCSTU1",44,0)
 S VAR=$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",2)
"RTN","GMRCSTU1",45,0)
 I VAR>0 D
"RTN","GMRCSTU1",46,0)
 .S $P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",4)=$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",1)/VAR
"RTN","GMRCSTU1",47,0)
 .I VAR>1 D
"RTN","GMRCSTU1",48,0)
 ..S SUMX=$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",1)
"RTN","GMRCSTU1",49,0)
 ..S SUMX=SUMX*SUMX/VAR
"RTN","GMRCSTU1",50,0)
 ..S SUMX=($P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",3)-SUMX)/(VAR-1)
"RTN","GMRCSTU1",51,0)
 ..S $P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5)=$$SQRT(SUMX)
"RTN","GMRCSTU1",52,0)
 .E  S $P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5)="N<2"
"RTN","GMRCSTU1",53,0)
 S VAR=$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",2)
"RTN","GMRCSTU1",54,0)
 I VAR>0 D
"RTN","GMRCSTU1",55,0)
 .S $P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",4)=$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",1)/VAR
"RTN","GMRCSTU1",56,0)
 .I VAR>1 D
"RTN","GMRCSTU1",57,0)
 ..S SUMX=$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",1)
"RTN","GMRCSTU1",58,0)
 ..S SUMX=SUMX*SUMX/VAR
"RTN","GMRCSTU1",59,0)
 ..S SUMX=($P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",3)-SUMX)/(VAR-1)
"RTN","GMRCSTU1",60,0)
 ..S $P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5)=$$SQRT(SUMX)
"RTN","GMRCSTU1",61,0)
 .E  S $P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5)="N<2"
"RTN","GMRCSTU1",62,0)
 Q
"RTN","GMRCSTU1",63,0)
 ;
"RTN","GMRCSTU1",64,0)
LISTDATE(GMRCDT1,GMRCDT2,GMRCEDT1,GMRCEDT2) ;Change dates to display format
"RTN","GMRCSTU1",65,0)
 ; Input:
"RTN","GMRCSTU1",66,0)
 ;  GMRCDT1  Start date in FM format, can be "ALL" for all dates
"RTN","GMRCSTU1",67,0)
 ;  GMRCDT2  End date in FM format, can be null if GMRCDT1 is "ALL"
"RTN","GMRCSTU1",68,0)
 ; Output:
"RTN","GMRCSTU1",69,0)
 ;  GMRCEDT1 Start date in external format
"RTN","GMRCSTU1",70,0)
 ;  GMRCEDT2 End date in extenal format
"RTN","GMRCSTU1",71,0)
 ;
"RTN","GMRCSTU1",72,0)
 S GMRCEDT1=$$FMTE^XLFDT(GMRCDT1)
"RTN","GMRCSTU1",73,0)
 S GMRCEDT2=$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSTU1",74,0)
 I GMRCEDT1'="ALL" D
"RTN","GMRCSTU1",75,0)
 .S Y=GMRCEDT1
"RTN","GMRCSTU1",76,0)
 .X ^DD("DD")
"RTN","GMRCSTU1",77,0)
 .S GMRCEDT1=$P(Y,"@",1)
"RTN","GMRCSTU1",78,0)
 .K %,%DT,%H,%I
"RTN","GMRCSTU1",79,0)
 I GMRCEDT2=0 D
"RTN","GMRCSTU1",80,0)
 .S X="NOW"
"RTN","GMRCSTU1",81,0)
 .D NOW^%DTC
"RTN","GMRCSTU1",82,0)
 .S Y=%
"RTN","GMRCSTU1",83,0)
 .K %,%DT,%H,%I
"RTN","GMRCSTU1",84,0)
 .X ^DD("DD")
"RTN","GMRCSTU1",85,0)
 .S GMRCEDT2=$P(Y,"@",1)
"RTN","GMRCSTU1",86,0)
 Q
"RTN","GMRCSTU1",87,0)
 ;
"RTN","GMRCSTU1",88,0)
SERVSTAT(COUNT,GEN,ND,GRP) ;Build list for a service or a grouper
"RTN","GMRCSTU1",89,0)
 ; COUNT  subscript in to the array ^TMP("GMRCR"
"RTN","GMRCSTU1",90,0)
 ; GEN    1 if service
"RTN","GMRCSTU1",91,0)
 ;        2 if grouper
"RTN","GMRCSTU1",92,0)
 ; ND     Pointer to this this service in GMRCSVC
"RTN","GMRCSTU1",93,0)
 ; GRP    Pointer to grouper that this service is in ^GMR(123.5
"RTN","GMRCSTU1",94,0)
 ;        (If this is not a grouper i.e. GEN=2)
"RTN","GMRCSTU1",95,0)
 ;
"RTN","GMRCSTU1",96,0)
 N TEMP,NUMBER
"RTN","GMRCSTU1",97,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",98,0)
 I GEN=1 D
"RTN","GMRCSTU1",99,0)
 .S TEMP="SERVICE: "_$P(^GMR(123.5,ND,0),"^",1)
"RTN","GMRCSTU1",100,0)
 .S:GRP>0 TEMP=TEMP_"  in Group: "_$P(^GMR(123.5,GRP,0),"^",1)
"RTN","GMRCSTU1",101,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=TEMP
"RTN","GMRCSTU1",102,0)
 E  D
"RTN","GMRCSTU1",103,0)
 .S TEMP="GROUPER: "_$P(^GMR(123.5,ND,0),"^",1)_" Totals:"
"RTN","GMRCSTU1",104,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,10)_TEMP
"RTN","GMRCSTU1",105,0)
 S NUMBER=$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",2)
"RTN","GMRCSTU1",106,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",107,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)="Total Number Of Consults Completed: "_NUMBER
"RTN","GMRCSTU1",108,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",109,0)
 S TEMP="Mean Days To Complete: "
"RTN","GMRCSTU1",110,0)
 S:NUMBER>0 TEMP=TEMP_$J($P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",4),4,1)
"RTN","GMRCSTU1",111,0)
 S TEMP=TEMP_$E(TAB,1,50-$L(TEMP))_"Standard Deviation: "
"RTN","GMRCSTU1",112,0)
 I NUMBER>0 S ^TMP("GMRCR",$J,"PRL",COUNT,0)=TEMP_$S($P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5)=+$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5):$J($P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5),4,1),1:$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",5))
"RTN","GMRCSTU1",113,0)
 E  S ^TMP("GMRCR",$J,"PRL",COUNT,0)=TEMP
"RTN","GMRCSTU1",114,0)
 S NUMBER=$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",2)
"RTN","GMRCSTU1",115,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",116,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)="Total INPATIENT Consults: "_NUMBER
"RTN","GMRCSTU1",117,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",118,0)
 S TEMP="Mean Days To Complete: "
"RTN","GMRCSTU1",119,0)
 S:NUMBER>0 TEMP=TEMP_$J($P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",4),4,1)
"RTN","GMRCSTU1",120,0)
 S TEMP=TEMP_$E(TAB,1,50-$L(TEMP))_"Standard Deviation: "
"RTN","GMRCSTU1",121,0)
 I NUMBER>0 D
"RTN","GMRCSTU1",122,0)
 . S TEMP=TEMP_$S($P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5)=+$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5):$J($P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5),4,1),1:$P(^TMP("GMRCSVC",$J,GEN,ND,"I"),"^",5))
"RTN","GMRCSTU1",123,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)=TEMP
"RTN","GMRCSTU1",124,0)
 S NUMBER=$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",2)
"RTN","GMRCSTU1",125,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",126,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)="Total OUTPATIENT Consults: "_NUMBER
"RTN","GMRCSTU1",127,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",128,0)
 S TEMP="Mean Days To Complete: "
"RTN","GMRCSTU1",129,0)
 S:NUMBER>0 TEMP=TEMP_$J($P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",4),4,1)
"RTN","GMRCSTU1",130,0)
 S TEMP=TEMP_$E(TAB,1,50-$L(TEMP))_"Standard Deviation: "
"RTN","GMRCSTU1",131,0)
 I NUMBER>0 D
"RTN","GMRCSTU1",132,0)
 . S TEMP=TEMP_$S($P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5)=+$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5):$J($P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5),4,1),1:$P(^TMP("GMRCSVC",$J,GEN,ND,"O"),"^",5))
"RTN","GMRCSTU1",133,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)=TEMP
"RTN","GMRCSTU1",134,0)
 I $P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",2)>0 D
"RTN","GMRCSTU1",135,0)
 .S NUMBER=$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",2)
"RTN","GMRCSTU1",136,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTU1",137,0)
 .S ^TMP("GMRCR",$J,"PRL",COUNT,0)="Total Unclassified Consults: "_NUMBER
"RTN","GMRCSTU1",138,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTU1",139,0)
 .S TEMP="Mean Days To Complete: "
"RTN","GMRCSTU1",140,0)
 .S:NUMBER>0 TEMP=TEMP_$J($P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",4),4,1)
"RTN","GMRCSTU1",141,0)
 .S TEMP=TEMP_$E(TAB,1,50-$L(TEMP))_"Standard Deviation: "
"RTN","GMRCSTU1",142,0)
 .I NUMBER>0 D
"RTN","GMRCSTU1",143,0)
 .. S TEMP=TEMP_$S($P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5)=+$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5):$J($P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5),4,1),1:$P(^TMP("GMRCSVC",$J,GEN,ND,"U"),"^",5))
"RTN","GMRCSTU1",144,0)
 .S ^TMP("GMRCR",$J,"PRL",COUNT,0)=TEMP
"RTN","GMRCSTU1",145,0)
 I +$P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",6)>0 S COUNT=COUNT+1,^TMP("GMRCR",$J,"PRL",COUNT,0)="No. With Unresolved Accepted in Service Times: "_$J($P(^TMP("GMRCSVC",$J,GEN,ND,"T"),"^",6),3)_"  (Not Included In Statistics)"
"RTN","GMRCSTU1",146,0)
 S COUNT=COUNT+1
"RTN","GMRCSTU1",147,0)
 S ^TMP("GMRCR",$J,"PRL",COUNT,0)=""
"RTN","GMRCSTU1",148,0)
 Q
"RTN","GMRCYP29")
0^^B151824
"RTN","GMRCYP29",1,0)
GMRCYP29 ;SLC/JFR - POST-INSTALL FOR GMRC*3*29 ; 11/8/02 09:42
"RTN","GMRCYP29",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**29**;DEC 27, 1997
"RTN","GMRCYP29",3,0)
POST ; entry point
"RTN","GMRCYP29",4,0)
 ; This will clear all nodes below the file zero node but still
"RTN","GMRCYP29",5,0)
 ; stored at ^GMR(123,0,40,...
"RTN","GMRCYP29",6,0)
 S ^TMP("GMRCYP29",$J,0)=^GMR(123,0)
"RTN","GMRCYP29",7,0)
 K ^GMR(123,0)
"RTN","GMRCYP29",8,0)
 S ^GMR(123,0)=^TMP("GMRCYP29",$J,0)
"RTN","GMRCYP29",9,0)
 K ^TMP("GMRCYP29",$J)
"RTN","GMRCYP29",10,0)
 Q
"VER")
8.0^22.0
**END**
**END**
