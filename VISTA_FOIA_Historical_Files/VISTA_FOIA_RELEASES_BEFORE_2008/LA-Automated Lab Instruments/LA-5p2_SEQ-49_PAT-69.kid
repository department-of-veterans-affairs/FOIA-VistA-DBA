Released LA*5.2*69 SEQ #49
Extracted from mail message
**KIDS**:LA*5.2*69^

**INSTALL NAME**
LA*5.2*69
"BLD",4797,0)
LA*5.2*69^AUTOMATED LAB INSTRUMENTS^0^3040202^y
"BLD",4797,1,0)
^^2^2^3031211^
"BLD",4797,1,1,0)
Lab API's for extracting Chemistry, Cytopathology, Surgical Pathology
"BLD",4797,1,2,0)
and Microbiology data.
"BLD",4797,4,0)
^9.64PA^^
"BLD",4797,"KRN",0)
^9.67PA^8989.52^19
"BLD",4797,"KRN",.4,0)
.4
"BLD",4797,"KRN",.401,0)
.401
"BLD",4797,"KRN",.402,0)
.402
"BLD",4797,"KRN",.403,0)
.403
"BLD",4797,"KRN",.5,0)
.5
"BLD",4797,"KRN",.84,0)
.84
"BLD",4797,"KRN",3.6,0)
3.6
"BLD",4797,"KRN",3.8,0)
3.8
"BLD",4797,"KRN",9.2,0)
9.2
"BLD",4797,"KRN",9.8,0)
9.8
"BLD",4797,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",4797,"KRN",9.8,"NM",1,0)
LA7UTL02^^0^B36439775
"BLD",4797,"KRN",9.8,"NM",2,0)
LA7UTL03^^0^B38217357
"BLD",4797,"KRN",9.8,"NM",3,0)
LA7UTL1A^^0^B16383950
"BLD",4797,"KRN",9.8,"NM",4,0)
LA7UTL1B^^0^B36932976
"BLD",4797,"KRN",9.8,"NM",5,0)
LA7UTL1C^^0^B85941702
"BLD",4797,"KRN",9.8,"NM",6,0)
LA7QRY^^0^B5873978
"BLD",4797,"KRN",9.8,"NM",7,0)
LA7QRY2^^0^B24752999
"BLD",4797,"KRN",9.8,"NM","B","LA7QRY",6)

"BLD",4797,"KRN",9.8,"NM","B","LA7QRY2",7)

"BLD",4797,"KRN",9.8,"NM","B","LA7UTL02",1)

"BLD",4797,"KRN",9.8,"NM","B","LA7UTL03",2)

"BLD",4797,"KRN",9.8,"NM","B","LA7UTL1A",3)

"BLD",4797,"KRN",9.8,"NM","B","LA7UTL1B",4)

"BLD",4797,"KRN",9.8,"NM","B","LA7UTL1C",5)

"BLD",4797,"KRN",19,0)
19
"BLD",4797,"KRN",19,"NM",0)
^9.68A^^
"BLD",4797,"KRN",19.1,0)
19.1
"BLD",4797,"KRN",101,0)
101
"BLD",4797,"KRN",409.61,0)
409.61
"BLD",4797,"KRN",771,0)
771
"BLD",4797,"KRN",870,0)
870
"BLD",4797,"KRN",8989.51,0)
8989.51
"BLD",4797,"KRN",8989.52,0)
8989.52
"BLD",4797,"KRN",8994,0)
8994
"BLD",4797,"KRN","B",.4,.4)

"BLD",4797,"KRN","B",.401,.401)

"BLD",4797,"KRN","B",.402,.402)

"BLD",4797,"KRN","B",.403,.403)

"BLD",4797,"KRN","B",.5,.5)

"BLD",4797,"KRN","B",.84,.84)

"BLD",4797,"KRN","B",3.6,3.6)

"BLD",4797,"KRN","B",3.8,3.8)

"BLD",4797,"KRN","B",9.2,9.2)

"BLD",4797,"KRN","B",9.8,9.8)

"BLD",4797,"KRN","B",19,19)

"BLD",4797,"KRN","B",19.1,19.1)

"BLD",4797,"KRN","B",101,101)

"BLD",4797,"KRN","B",409.61,409.61)

"BLD",4797,"KRN","B",771,771)

"BLD",4797,"KRN","B",870,870)

"BLD",4797,"KRN","B",8989.51,8989.51)

"BLD",4797,"KRN","B",8989.52,8989.52)

"BLD",4797,"KRN","B",8994,8994)

"BLD",4797,"QUES",0)
^9.62^^
"BLD",4797,"REQB",0)
^9.611^1^1
"BLD",4797,"REQB",1,0)
LA*5.2*46^2
"BLD",4797,"REQB","B","LA*5.2*46",1)

"MBREQ")
0
"PKG",7,-1)
1^1
"PKG",7,0)
AUTOMATED LAB INSTRUMENTS^LA^Lab Auto-Instrument Package
"PKG",7,20,0)
^9.402P^^
"PKG",7,22,0)
^9.49I^1^1
"PKG",7,22,1,0)
5.2^2940927^2941103
"PKG",7,22,1,"PAH",1,0)
69^3040202^2178
"PKG",7,22,1,"PAH",1,1,0)
^^2^2^3040202
"PKG",7,22,1,"PAH",1,1,1,0)
Lab API's for extracting Chemistry, Cytopathology, Surgical Pathology
"PKG",7,22,1,"PAH",1,1,2,0)
and Microbiology data.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","LA7QRY")
0^6^B5873978
"RTN","LA7QRY",1,0)
LA7QRY ;DALOI/JMC - Lab HL7 Query Utility ; 1/27/04 8:25am
"RTN","LA7QRY",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,69**;Sep 27, 1994
"RTN","LA7QRY",3,0)
 ;
"RTN","LA7QRY",4,0)
 ; Reference to variable DIQUIET supported by DBIA #2098
"RTN","LA7QRY",5,0)
 ; Reference to ^DPT("SSN") global supported by DBIA #10035
"RTN","LA7QRY",6,0)
 ;
"RTN","LA7QRY",7,0)
 Q
"RTN","LA7QRY",8,0)
 ;
"RTN","LA7QRY",9,0)
GCPR(LA7PTID,LA7SDT,LA7EDT,LA7SC,LA7SPEC,LA7ERR,LA7DEST,LA7HL7) ; Entry point for Government Computerized Patient Record query
"RTN","LA7QRY",10,0)
 ;
"RTN","LA7QRY",11,0)
 ; Call with LA7PTID = patient identifier, either SSN or MPI/ICN
"RTN","LA7QRY",12,0)
 ;                     if MPI/ICN then should be full ICN (10 digit
"RTN","LA7QRY",13,0)
 ;                     number followed by "V" and six digit checksum)
"RTN","LA7QRY",14,0)
 ;                     For example: 1000720100V271387 
"RTN","LA7QRY",15,0)
 ;            LA7SDT = start date of query (FileMan D/T,time optional)
"RTN","LA7QRY",16,0)
 ;            LA7EDT = end date of query (FileMan D/T, time optional)
"RTN","LA7QRY",17,0)
 ;                     (FileMan D/T^type of date ("CD" or "RAD")
"RTN","LA7QRY",18,0)
 ;                     Both start and end date values can pass a
"RTN","LA7QRY",19,0)
 ;                     parameter in the second piece to indicate that 
"RTN","LA7QRY",20,0)
 ;                     the date values are for specimen collection
"RTN","LA7QRY",21,0)
 ;                     date/time (CD) or results available date (RAD)
"RTN","LA7QRY",22,0)
 ;                     Example: LA7SDT="2991001.1239^CD"
"RTN","LA7QRY",23,0)
 ;                              LA7EDT="2991002.0331^CD"
"RTN","LA7QRY",24,0)
 ;                              LA7SDT="3010201^RAD"
"RTN","LA7QRY",25,0)
 ;                              LA7EDT="3010201^RAD"
"RTN","LA7QRY",26,0)
 ;
"RTN","LA7QRY",27,0)
 ;             LA7SC = Array of search codes, either NLT or LOINC
"RTN","LA7QRY",28,0)
 ;                     (code^coding system ("NLT" or "LN");
"RTN","LA7QRY",29,0)
 ;                     Example: LA7SC(1)="89628.0000^NLT"
"RTN","LA7QRY",30,0)
 ;                              LA7SC(2)="84330.0000^NLT"
"RTN","LA7QRY",31,0)
 ;                              LA7SC(3)="84295.0000^NLT"
"RTN","LA7QRY",32,0)
 ;                              LA7SC(4)="14749-6^LN"
"RTN","LA7QRY",33,0)
 ;
"RTN","LA7QRY",34,0)
 ;                   = The "*" (wildcard) for any code;
"RTN","LA7QRY",35,0)
 ;                     Example: LA7SC="*"
"RTN","LA7QRY",36,0)
 ;
"RTN","LA7QRY",37,0)
 ;                   = A list of subscripts (separated by commas) from
"RTN","LA7QRY",38,0)
 ;                     where the results will be extracted ("CH", "MI"
"RTN","LA7QRY",39,0)
 ;                     or "SP").
"RTN","LA7QRY",40,0)
 ;                     Example: LA7SC="CH,MI" (CH and MI results only)
"RTN","LA7QRY",41,0)
 ;
"RTN","LA7QRY",42,0)
 ;           LA7SPEC = array of specimen types using HL7 source table
"RTN","LA7QRY",43,0)
 ;                     0070 or "*" (wildcard) for any code
"RTN","LA7QRY",44,0)
 ;                     Currently specimen type only supported for CH
"RTN","LA7QRY",45,0)
 ;                     and MI subscripted tests.
"RTN","LA7QRY",46,0)
 ;                     Example: LA7SPEC="*"
"RTN","LA7QRY",47,0)
 ;                                or
"RTN","LA7QRY",48,0)
 ;                              LA7SPEC(1)="UR"
"RTN","LA7QRY",49,0)
 ;                              LA7SPEC(2)="SER"
"RTN","LA7QRY",50,0)
 ;                              LA7SPEC(3)="PLAS"
"RTN","LA7QRY",51,0)
 ;
"RTN","LA7QRY",52,0)
 ;           LA7DEST = closed root global reference to return search
"RTN","LA7QRY",53,0)
 ;                     results (optional). If this parameter is
"RTN","LA7QRY",54,0)
 ;                     omitted or equals an empty string, then node
"RTN","LA7QRY",55,0)
 ;                     ^TMP("HLS",$J) is used.
"RTN","LA7QRY",56,0)
 ;                     Example: LA7DEST=$NA(^TMP("ZZTMP",$J))
"RTN","LA7QRY",57,0)
 ;
"RTN","LA7QRY",58,0)
 ;            LA7HL7 = HL7 field separator and encoding characters (4)
"RTN","LA7QRY",59,0)
 ;                     to use to encode results (optional).
"RTN","LA7QRY",60,0)
 ;                     If undefined or incomplete (length<5) then
"RTN","LA7QRY",61,0)
 ;                     field separator = "|" and encoding characters =
"RTN","LA7QRY",62,0)
 ;                     "^\~&"
"RTN","LA7QRY",63,0)
 ;
"RTN","LA7QRY",64,0)
 ; Returns    LA7DEST = contains global reference of search results
"RTN","LA7QRY",65,0)
 ;            in HL7 message structure, usually ^TMP("HLS",$J)
"RTN","LA7QRY",66,0)
 ;
"RTN","LA7QRY",67,0)
 ;            LA7ERR = array (by reference) containing any errors
"RTN","LA7QRY",68,0)
 ;
"RTN","LA7QRY",69,0)
 N DFN,DIQUIET,LA76248,LA7CODE,LA7PTYP,LA7QUIT,LA7SCSRC,LRDFN,LRIDT,LRSS,LRSSLST,TMP
"RTN","LA7QRY",70,0)
 ;
"RTN","LA7QRY",71,0)
 D CLEANUP
"RTN","LA7QRY",72,0)
 S U="^",DT=$$DT^XLFDT,DTIME=$$DTIME^XUP($G(DUZ))
"RTN","LA7QRY",73,0)
 S GBL=$S($G(LA7DEST)'="":LA7DEST,1:"^TMP(""HLS"","_$J_")")
"RTN","LA7QRY",74,0)
 K LA7ERR
"RTN","LA7QRY",75,0)
 ; Prevent FileMan from issuing any unwanted WRITE(s).
"RTN","LA7QRY",76,0)
 S DIQUIET=1
"RTN","LA7QRY",77,0)
 ; Currently not using file #62.48 for configuration information.
"RTN","LA7QRY",78,0)
 S LA76248=0
"RTN","LA7QRY",79,0)
 ;
"RTN","LA7QRY",80,0)
 ; Identify patient, quit if error
"RTN","LA7QRY",81,0)
 D PATID^LA7QRY2
"RTN","LA7QRY",82,0)
 I $D(LA7ERR)  Q ""
"RTN","LA7QRY",83,0)
 ;
"RTN","LA7QRY",84,0)
 ; Resolve search codes to lab datanames
"RTN","LA7QRY",85,0)
 S LA7SCSRC=$G(LA7SC)
"RTN","LA7QRY",86,0)
 S TMP=$$SCLIST^LA7QRY2(LA7SCSRC)
"RTN","LA7QRY",87,0)
 Q:$D(LA7ERR) ""
"RTN","LA7QRY",88,0)
 S LA7SC=TMP  D:LA7SC'="*" CHKSC^LA7QRY1
"RTN","LA7QRY",89,0)
 ;
"RTN","LA7QRY",90,0)
 ; Convert specimen codes to file #61 Topography entries
"RTN","LA7QRY",91,0)
 S LA7SPEC=$G(LA7SPEC)
"RTN","LA7QRY",92,0)
 I LA7SPEC'="*"  D SPEC^LA7QRY1
"RTN","LA7QRY",93,0)
 ;
"RTN","LA7QRY",94,0)
 ; Search by collection or results available date
"RTN","LA7QRY",95,0)
 I $P(LA7SDT,"^",2)="" S $P(LA7SDT,"^",2)="CD"
"RTN","LA7QRY",96,0)
 I $P(LA7SDT,"^",2)="RAD" D BRAD^LA7QRY2
"RTN","LA7QRY",97,0)
 I $P(LA7SDT,"^",2)="CD" D BCD^LA7QRY2
"RTN","LA7QRY",98,0)
 ;
"RTN","LA7QRY",99,0)
 I '$D(^TMP("LA7-QRY",$J)) D
"RTN","LA7QRY",100,0)
 . S LA7ERR(99)="No results found for requested parameters"
"RTN","LA7QRY",101,0)
 . S GBL=""
"RTN","LA7QRY",102,0)
 E  D BUILDMSG^LA7QRY1
"RTN","LA7QRY",103,0)
 ;
"RTN","LA7QRY",104,0)
 D CLEANUP  S LA7SC=LA7SCSRC
"RTN","LA7QRY",105,0)
 ;
"RTN","LA7QRY",106,0)
 Q GBL
"RTN","LA7QRY",107,0)
 ;
"RTN","LA7QRY",108,0)
 ;
"RTN","LA7QRY",109,0)
CLEANUP ; Cleanup TMP nodes that are used.
"RTN","LA7QRY",110,0)
 ;
"RTN","LA7QRY",111,0)
 N I
"RTN","LA7QRY",112,0)
 ;
"RTN","LA7QRY",113,0)
 F I="LA7-61","LA7-DN","LA7-LN","LA7-NLT","LA7-QRY" K ^TMP(I,$J)
"RTN","LA7QRY",114,0)
 D KVAR^LRX
"RTN","LA7QRY",115,0)
 ;
"RTN","LA7QRY",116,0)
 Q
"RTN","LA7QRY2")
0^7^B24752999
"RTN","LA7QRY2",1,0)
LA7QRY2 ;DALOI/JMC - Lab HL7 Query Utility ; 12/10/03 10:39am
"RTN","LA7QRY2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,69**;Sep 27, 1994
"RTN","LA7QRY2",3,0)
 ;
"RTN","LA7QRY2",4,0)
 Q
"RTN","LA7QRY2",5,0)
 ;
"RTN","LA7QRY2",6,0)
PATID ; Resolve patient id and establish patient environment
"RTN","LA7QRY2",7,0)
 ;
"RTN","LA7QRY2",8,0)
 N LA7X
"RTN","LA7QRY2",9,0)
 ;
"RTN","LA7QRY2",10,0)
 S (DFN,LRDFN)="",LA7PTYP=0
"RTN","LA7QRY2",11,0)
 ;
"RTN","LA7QRY2",12,0)
 ; SSN passed as patient identifier
"RTN","LA7QRY2",13,0)
 I LA7PTID?9N.1A D
"RTN","LA7QRY2",14,0)
 . S LA7PTYP=1
"RTN","LA7QRY2",15,0)
 . S LA7X=$O(^DPT("SSN",LA7PTID,0))
"RTN","LA7QRY2",16,0)
 . I LA7X>0 D SETDFN(LA7X)
"RTN","LA7QRY2",17,0)
 ;
"RTN","LA7QRY2",18,0)
 ; MPI/ICN (integration control number) passed as patient identifier
"RTN","LA7QRY2",19,0)
 I LA7PTID?10N1"V"6N D
"RTN","LA7QRY2",20,0)
 . S LA7PTYP=2
"RTN","LA7QRY2",21,0)
 . S LA7X=$$GETDFN^MPIF001($P(LA7PTID,"V"))
"RTN","LA7QRY2",22,0)
 . I LA7X>0 D SETDFN(LA7X)
"RTN","LA7QRY2",23,0)
 ;
"RTN","LA7QRY2",24,0)
 ; If no patient identified/no laboratory record - return exception message
"RTN","LA7QRY2",25,0)
 I 'LA7PTYP S LA7ERR(1)="Invalid patient identifier passed"
"RTN","LA7QRY2",26,0)
 I 'DFN S LA7ERR(2)="No patient found with requested identifier"
"RTN","LA7QRY2",27,0)
 I DFN,'LRDFN S LA7ERR(3)="No laboratory record for requested patient"
"RTN","LA7QRY2",28,0)
 I LRDFN,'$D(^LR(LRDFN)) S LA7ERR(4)="Database error - missing laboratory record for requested patient"
"RTN","LA7QRY2",29,0)
 Q
"RTN","LA7QRY2",30,0)
 ;
"RTN","LA7QRY2",31,0)
 ;
"RTN","LA7QRY2",32,0)
BCD ; Search by specimen collection date.
"RTN","LA7QRY2",33,0)
 ;
"RTN","LA7QRY2",34,0)
 N LA763,LA7QUIT
"RTN","LA7QRY2",35,0)
 ;
"RTN","LA7QRY2",36,0)
 S (LA7SDT(0),LA7EDT(0))=0
"RTN","LA7QRY2",37,0)
 I LA7SDT S LA7SDT(0)=9999999-LA7SDT
"RTN","LA7QRY2",38,0)
 I LA7EDT S LA7EDT(0)=9999999-LA7EDT
"RTN","LA7QRY2",39,0)
 ;
"RTN","LA7QRY2",40,0)
 S LRSS=""
"RTN","LA7QRY2",41,0)
 F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D
"RTN","LA7QRY2",42,0)
 . S (LA7QUIT,LRIDT)=0
"RTN","LA7QRY2",43,0)
 . I LA7EDT(0) S LRIDT=$O(^LR(LRDFN,LRSS,LA7EDT(0)),-1)
"RTN","LA7QRY2",44,0)
 . F  S LRIDT=$O(^LR(LRDFN,LRSS,LRIDT)) Q:LA7QUIT  D
"RTN","LA7QRY2",45,0)
 . . ; Quit if reached end of data or outside date criteria
"RTN","LA7QRY2",46,0)
 . . I 'LRIDT!(LRIDT>LA7SDT(0)) S LA7QUIT=1 Q
"RTN","LA7QRY2",47,0)
 . . D SEARCH
"RTN","LA7QRY2",48,0)
 ;
"RTN","LA7QRY2",49,0)
 Q
"RTN","LA7QRY2",50,0)
 ;
"RTN","LA7QRY2",51,0)
 ;
"RTN","LA7QRY2",52,0)
BRAD ; Search by results available date (completion date).
"RTN","LA7QRY2",53,0)
 ; Assumes cross-references still exist for dates in LRO(69) global.
"RTN","LA7QRY2",54,0)
 ; Collects specimen date/time values for a given LRDFN and completion date.
"RTN","LA7QRY2",55,0)
 ; Cross-reference is by date only, time stripped from start date.
"RTN","LA7QRY2",56,0)
 ; Uses cross-reference ^LRO(69,DT,1,"AN",'LOCATION',LRDFN,LRIDT)=""
"RTN","LA7QRY2",57,0)
 ;
"RTN","LA7QRY2",58,0)
 N LA763,LA7DT,LA7ROOT,LA7SRC,X
"RTN","LA7QRY2",59,0)
 ;
"RTN","LA7QRY2",60,0)
 ; Check if orders still exist Iin file #69 for search range
"RTN","LA7QRY2",61,0)
 S LA7SDT(1)=(LA7SDT\1)-.0000000001,LA7EDT(1)=(LA7EDT\1)+.24,LA7SRC=0
"RTN","LA7QRY2",62,0)
 S X=$O(^LRO(69,LA7SDT(1)))
"RTN","LA7QRY2",63,0)
 I X,X<LA7EDT(1) S LA7SRC=1
"RTN","LA7QRY2",64,0)
 ;
"RTN","LA7QRY2",65,0)
 ; Search "AN" cross-reference in file #69.
"RTN","LA7QRY2",66,0)
 I LA7SRC D
"RTN","LA7QRY2",67,0)
 . S LA7DT=LA7SDT(1)
"RTN","LA7QRY2",68,0)
 . F  S LA7DT=$O(^LRO(69,LA7DT)) Q:'LA7DT!(LA7DT>LA7EDT(1))  D
"RTN","LA7QRY2",69,0)
 . . S LA7ROOT="^LRO(69,LA7DT,1,""AN"")"
"RTN","LA7QRY2",70,0)
 . . F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""!($QS(LA7ROOT,2)'=LA7DT)!($QS(LA7ROOT,4)'="AN")  D
"RTN","LA7QRY2",71,0)
 . . . I $QS(LA7ROOT,6)'=LRDFN Q
"RTN","LA7QRY2",72,0)
 . . . S LRIDT=$QS(LA7ROOT,7),LRSS=""
"RTN","LA7QRY2",73,0)
 . . . F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D SEARCH
"RTN","LA7QRY2",74,0)
 ;
"RTN","LA7QRY2",75,0)
 ; If no orders in #69 then do long search through file #63.
"RTN","LA7QRY2",76,0)
 I 'LA7SRC  D
"RTN","LA7QRY2",77,0)
 . S LRSS=""
"RTN","LA7QRY2",78,0)
 . F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D
"RTN","LA7QRY2",79,0)
 . . S LRIDT=0
"RTN","LA7QRY2",80,0)
 . . F  S LRIDT=$O(^LR(LRDFN,LRSS,LRIDT)) Q:'LRIDT  D
"RTN","LA7QRY2",81,0)
 . . . S LA763(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7QRY2",82,0)
 . . . I $P(LA763(0),"^",3)>LA7SDT(1),$P(LA763(0),"^",3)<LA7EDT(1) D SEARCH
"RTN","LA7QRY2",83,0)
 ;
"RTN","LA7QRY2",84,0)
 Q
"RTN","LA7QRY2",85,0)
 ;
"RTN","LA7QRY2",86,0)
 ;
"RTN","LA7QRY2",87,0)
SEARCH ; Search subscript for a specific collection date/time
"RTN","LA7QRY2",88,0)
 ;
"RTN","LA7QRY2",89,0)
 K LA763
"RTN","LA7QRY2",90,0)
 S LA763(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7QRY2",91,0)
 ;
"RTN","LA7QRY2",92,0)
 ; Only CH, MI, and BB subscripts store pointer to file #61 in 5th piece of zeroth node.
"RTN","LA7QRY2",93,0)
 ; Quit if specific specimen codes and they do not match
"RTN","LA7QRY2",94,0)
 I "CHMIBB"[LRSS S LA761=+$P(LA763(0),"^",5)
"RTN","LA7QRY2",95,0)
 E  S LA761=0
"RTN","LA7QRY2",96,0)
 I LA761,$D(^TMP("LA7-61",$J)),'$D(^TMP("LA7-61",$J,LA761)) Q
"RTN","LA7QRY2",97,0)
 ;
"RTN","LA7QRY2",98,0)
 ; --- Chemistry
"RTN","LA7QRY2",99,0)
 I LRSS="CH" D CHSS Q
"RTN","LA7QRY2",100,0)
 ; --- Microbiology
"RTN","LA7QRY2",101,0)
 I LRSS="MI" D MISS Q
"RTN","LA7QRY2",102,0)
 ; --- Surgical pathology
"RTN","LA7QRY2",103,0)
 I LRSS="SP" D APSS Q
"RTN","LA7QRY2",104,0)
 ; --- Cytology
"RTN","LA7QRY2",105,0)
 I LRSS="CY" D APSS Q
"RTN","LA7QRY2",106,0)
 ; --- Electron Micrscopsy
"RTN","LA7QRY2",107,0)
 I LRSS="EM" D APSS Q
"RTN","LA7QRY2",108,0)
 ; --- Autopsy
"RTN","LA7QRY2",109,0)
 I LRSS="AU" D APSS Q
"RTN","LA7QRY2",110,0)
 ; --- Blood Bank
"RTN","LA7QRY2",111,0)
 I LRSS="BB" D BBSS Q
"RTN","LA7QRY2",112,0)
 Q
"RTN","LA7QRY2",113,0)
 ;
"RTN","LA7QRY2",114,0)
 ;
"RTN","LA7QRY2",115,0)
CHSS ; Search "CH" datanames for matching codes
"RTN","LA7QRY2",116,0)
 ;
"RTN","LA7QRY2",117,0)
 N LA7X,LRSB
"RTN","LA7QRY2",118,0)
 ;
"RTN","LA7QRY2",119,0)
 S LRSB=1
"RTN","LA7QRY2",120,0)
 F  S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:'LRSB  D
"RTN","LA7QRY2",121,0)
 . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,LRSB))
"RTN","LA7QRY2",122,0)
 . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,$P(LA7X,"^",3),LA761)
"RTN","LA7QRY2",123,0)
 . D CHECK
"RTN","LA7QRY2",124,0)
 Q
"RTN","LA7QRY2",125,0)
 ;
"RTN","LA7QRY2",126,0)
 ;
"RTN","LA7QRY2",127,0)
MISS ; Search "MI" subscripts for matching codes
"RTN","LA7QRY2",128,0)
 ;
"RTN","LA7QRY2",129,0)
 N LA7ND,LRSB
"RTN","LA7QRY2",130,0)
 ;
"RTN","LA7QRY2",131,0)
 S LA7ND=0
"RTN","LA7QRY2",132,0)
 F LA7ND=1,5,8,11,16 I $D(^LR(LRDFN,LRSS,LRIDT,LA7ND)) D
"RTN","LA7QRY2",133,0)
 . S LRSB=$S(LA7ND=1:11,LA7ND=5:14,LA7ND=8:18,LA7ND=11:22,LA7ND=16:33,1:11)
"RTN","LA7QRY2",134,0)
 . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"",LA761)
"RTN","LA7QRY2",135,0)
 . D CHECK
"RTN","LA7QRY2",136,0)
 Q
"RTN","LA7QRY2",137,0)
 ;
"RTN","LA7QRY2",138,0)
 ;
"RTN","LA7QRY2",139,0)
APSS ; Search AP subscripts for matching codes
"RTN","LA7QRY2",140,0)
 ; AP results are currently not coded - use defaults
"RTN","LA7QRY2",141,0)
 ;
"RTN","LA7QRY2",142,0)
 N LA7CODE,LRSB
"RTN","LA7QRY2",143,0)
 ;
"RTN","LA7QRY2",144,0)
 S LRSB=.012
"RTN","LA7QRY2",145,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"","")
"RTN","LA7QRY2",146,0)
 D CHECK
"RTN","LA7QRY2",147,0)
 ;
"RTN","LA7QRY2",148,0)
 Q
"RTN","LA7QRY2",149,0)
 ;
"RTN","LA7QRY2",150,0)
 ;
"RTN","LA7QRY2",151,0)
BBSS ; Search BB subscript for matching codes
"RTN","LA7QRY2",152,0)
 ; *** This subscript currently not supported ***
"RTN","LA7QRY2",153,0)
 Q
"RTN","LA7QRY2",154,0)
 ;
"RTN","LA7QRY2",155,0)
 ;
"RTN","LA7QRY2",156,0)
CHECK ; Check NLT order/result and LOINC codes.
"RTN","LA7QRY2",157,0)
 ;
"RTN","LA7QRY2",158,0)
 N LA7QUIT
"RTN","LA7QRY2",159,0)
 ;
"RTN","LA7QRY2",160,0)
 ; If wildcard then store
"RTN","LA7QRY2",161,0)
 ; Otherwise check for specific NLT order/result and LOINC codes
"RTN","LA7QRY2",162,0)
 I LA7SC="*" D STORE Q
"RTN","LA7QRY2",163,0)
 S LA7QUIT=0
"RTN","LA7QRY2",164,0)
 F I=1:1:3 D  Q:LA7QUIT
"RTN","LA7QRY2",165,0)
 . ; If no test code then skip
"RTN","LA7QRY2",166,0)
 . I '$L($P(LA7CODE,"!",I)) Q
"RTN","LA7QRY2",167,0)
 . ; If test code does not match a search code then quit
"RTN","LA7QRY2",168,0)
 . I '$D(^TMP($S(I=3:"LA7-LN",1:"LA7-NLT"),$J,$P(LA7CODE,"!",I))) Q
"RTN","LA7QRY2",169,0)
 . D STORE S LA7QUIT=1
"RTN","LA7QRY2",170,0)
 ;
"RTN","LA7QRY2",171,0)
 Q
"RTN","LA7QRY2",172,0)
 ;
"RTN","LA7QRY2",173,0)
 ;
"RTN","LA7QRY2",174,0)
STORE ; Store entry for building in HL7 message
"RTN","LA7QRY2",175,0)
 ;
"RTN","LA7QRY2",176,0)
 S ^TMP("LA7-QRY",$J,LRDFN,LRIDT,LRSS,LA7CODE,LRSB)=""
"RTN","LA7QRY2",177,0)
 Q
"RTN","LA7QRY2",178,0)
 ;
"RTN","LA7QRY2",179,0)
 ;
"RTN","LA7QRY2",180,0)
SETDFN(LA7X) ; Setup DFN and other lab variables.
"RTN","LA7QRY2",181,0)
 ;
"RTN","LA7QRY2",182,0)
 S DFN=LA7X,LRDFN=$P($G(^DPT(DFN,"LR")),"^")
"RTN","LA7QRY2",183,0)
 Q
"RTN","LA7QRY2",184,0)
 ;
"RTN","LA7QRY2",185,0)
 ;***** SETUP THE SEARCH CODES
"RTN","LA7QRY2",186,0)
SCLIST(SCLST) ;
"RTN","LA7QRY2",187,0)
 N I,RC,SCALL,TMP  K LRSSLST
"RTN","LA7QRY2",188,0)
 S SCALL=",CH,MI,SP,"
"RTN","LA7QRY2",189,0)
 S SCLST=$$UP^XLFSTR($TR(SCLST," ")),RC="*"
"RTN","LA7QRY2",190,0)
 S:SCLST?.1"*" RC=SCLST,SCLST=$P(SCALL,",",2,999)
"RTN","LA7QRY2",191,0)
 F I=1:1  S TMP=$P(SCLST,",",I)  Q:TMP=""  D  Q:$D(LA7ERR)>1
"RTN","LA7QRY2",192,0)
 . I SCALL[(","_TMP_",")  S LRSSLST(TMP)=""  Q
"RTN","LA7QRY2",193,0)
 . S LA7ERR(7)="Invalid list of subscripts: '"_SCLST_"'"
"RTN","LA7QRY2",194,0)
 Q RC
"RTN","LA7UTL02")
0^1^B36439775
"RTN","LA7UTL02",1,0)
LA7UTL02 ;HOIFO/BH - Cytopathology Query Utility ; 10/28/03 8:40am
"RTN","LA7UTL02",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**69**;Sep 27, 1994
"RTN","LA7UTL02",3,0)
CYPATH(LRDFN,IEN,RET,ERR) ; Returns data for a Cytopathology Encounter
"RTN","LA7UTL02",4,0)
 ;
"RTN","LA7UTL02",5,0)
 ; Input:
"RTN","LA7UTL02",6,0)
 ;
"RTN","LA7UTL02",7,0)
 ; LRDFN - Patient Lab DFN                        (Required)
"RTN","LA7UTL02",8,0)
 ; IEN   - IEN of CY entry                        (Required)
"RTN","LA7UTL02",9,0)
 ; RET   - Array reference for passing back data  (Required)
"RTN","LA7UTL02",10,0)
 ; ERR   - Error array to pass back               (Not required)
"RTN","LA7UTL02",11,0)
 ;
"RTN","LA7UTL02",12,0)
 ; Output:
"RTN","LA7UTL02",13,0)
 ;
"RTN","LA7UTL02",14,0)
 ; '0' - If the API encountered an Error along with @ERR array
"RTN","LA7UTL02",15,0)
 ;
"RTN","LA7UTL02",16,0)
 ; '1' - if the API ran successfully and the following data if it exists
"RTN","LA7UTL02",17,0)
 ;
"RTN","LA7UTL02",18,0)
 ;   Visit Date field .01 and Accession Number field .06 of file 63.09.
"RTN","LA7UTL02",19,0)
 ;   @RET("DEMO",ien of visit)=Visit Date^Accession Number
"RTN","LA7UTL02",20,0)
 ;
"RTN","LA7UTL02",21,0)
 ;   Specimen field .01 of sub file 63.902.
"RTN","LA7UTL02",22,0)
 ;   @RET("SPEC",ien of Specimen entry)=Specimen Data
"RTN","LA7UTL02",23,0)
 ;
"RTN","LA7UTL02",24,0)
 ;   Clinical History field .01 of sub file 63.913.
"RTN","LA7UTL02",25,0)
 ;   @RET("CHIS",ien of the Clinical History entry)=Clinical His.
"RTN","LA7UTL02",26,0)
 ;
"RTN","LA7UTL02",27,0)
 ;   Pre Operative Diagnosis field .01 of sub file 63.914.
"RTN","LA7UTL02",28,0)
 ;   @RET@("PREDX",ien of the Pre. Op. Diagnosis entry)=Pre Op Diag.
"RTN","LA7UTL02",29,0)
 ;
"RTN","LA7UTL02",30,0)
 ;   Operative Diagnosis field .01 of sub file 63.905. 
"RTN","LA7UTL02",31,0)
 ;   @RET@("OPERDX",ien of the Op. Diagnosis entry)=Op Diag.
"RTN","LA7UTL02",32,0)
 ;
"RTN","LA7UTL02",33,0)
 ;   Post Opertive Diagnosis field .01 of sub file 63.906.
"RTN","LA7UTL02",34,0)
 ;   @RET@("POSTDX,ien of the Post. Op Diagnosis entry)=Pst. Op Diag.
"RTN","LA7UTL02",35,0)
 ;
"RTN","LA7UTL02",36,0)
 ;   Cytopathology Diagnosis field .01 of sub file 63.903. 
"RTN","LA7UTL02",37,0)
 ;   @RET@("CYTODX",ien of the Cytopathology Diagnosis entry)=Cyto Dx
"RTN","LA7UTL02",38,0)
 ;
"RTN","LA7UTL02",39,0)
 ;   Microscopic Examination field .01 of sub file 63.911.
"RTN","LA7UTL02",40,0)
 ;   @RET@("MICRO",ien of the Microscopic Examination entry)=Micro. Exam
"RTN","LA7UTL02",41,0)
 ;
"RTN","LA7UTL02",42,0)
 ;   ICD field .01 of sub file 63.901.
"RTN","LA7UTL02",43,0)
 ;   @RET@("ICD9",ien of Cyto ien entry)=ICD9 (external)
"RTN","LA7UTL02",44,0)
 ;
"RTN","LA7UTL02",45,0)
 ; ---------------------------------------------------------------------
"RTN","LA7UTL02",46,0)
 ;
"RTN","LA7UTL02",47,0)
 K @RET
"RTN","LA7UTL02",48,0)
 K @ERR
"RTN","LA7UTL02",49,0)
 I $G(LRDFN)="" D  Q 0
"RTN","LA7UTL02",50,0)
 . I $G(ERR)'="" S @ERR@("-1")="No Lab DFN." Q
"RTN","LA7UTL02",51,0)
 ;
"RTN","LA7UTL02",52,0)
 I $G(IEN)="" D  Q 0
"RTN","LA7UTL02",53,0)
 . I $G(ERR)'="" S @ERR@("-1")="No Cytopathology record IEN." Q
"RTN","LA7UTL02",54,0)
 ;
"RTN","LA7UTL02",55,0)
 I $G(RET)="" D  Q 0
"RTN","LA7UTL02",56,0)
 . I $G(ERR)'="" S @ERR@("-1")="No results array reference passed." Q
"RTN","LA7UTL02",57,0)
 ;
"RTN","LA7UTL02",58,0)
 N QUIT
"RTN","LA7UTL02",59,0)
 D DEMO
"RTN","LA7UTL02",60,0)
 I 'QUIT D SPECIMEN
"RTN","LA7UTL02",61,0)
 I 'QUIT D HISTORY
"RTN","LA7UTL02",62,0)
 I 'QUIT D PDIAG
"RTN","LA7UTL02",63,0)
 I 'QUIT D OPDIAG
"RTN","LA7UTL02",64,0)
 I 'QUIT D POSTDIAG
"RTN","LA7UTL02",65,0)
 I 'QUIT D CYTOPATH
"RTN","LA7UTL02",66,0)
 I 'QUIT D MICRO
"RTN","LA7UTL02",67,0)
 I 'QUIT D ICD
"RTN","LA7UTL02",68,0)
 I QUIT Q 0
"RTN","LA7UTL02",69,0)
 Q 1
"RTN","LA7UTL02",70,0)
 ;
"RTN","LA7UTL02",71,0)
 ;
"RTN","LA7UTL02",72,0)
DEMO ; Get basic demographics
"RTN","LA7UTL02",73,0)
 N VDATE S QUIT=0
"RTN","LA7UTL02",74,0)
 S VDATE=$$GET1^DIQ(63.09,IEN_","_LRDFN,.01,"I")
"RTN","LA7UTL02",75,0)
 I VDATE=""!($G(DIERR)) S QUIT=1 Q
"RTN","LA7UTL02",76,0)
 S ANUM=$$GET1^DIQ(63.09,IEN_","_LRDFN,.06,"I")
"RTN","LA7UTL02",77,0)
 I $G(DIERR) S QUIT=1 Q
"RTN","LA7UTL02",78,0)
 S @RET@("DEMO",IEN)=VDATE_"^"_ANUM
"RTN","LA7UTL02",79,0)
 Q
"RTN","LA7UTL02",80,0)
 ;
"RTN","LA7UTL02",81,0)
 ;
"RTN","LA7UTL02",82,0)
SPECIMEN ;
"RTN","LA7UTL02",83,0)
 N SPIENS,SPIEN,SPECIMEN S SPIEN="0"
"RTN","LA7UTL02",84,0)
 F  S SPIEN=$O(^LR(LRDFN,"CY",IEN,.1,SPIEN)) Q:'SPIEN!(QUIT)  D
"RTN","LA7UTL02",85,0)
 . Q:QUIT
"RTN","LA7UTL02",86,0)
 . S SPIENS=SPIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",87,0)
 . S SPECIMEN=$$GET1^DIQ(63.902,SPIENS,.01,"I")
"RTN","LA7UTL02",88,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL02",89,0)
 . . K @RET
"RTN","LA7UTL02",90,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Specimen data)."
"RTN","LA7UTL02",91,0)
 . . S QUIT=1
"RTN","LA7UTL02",92,0)
 . I SPECIMEN="" Q
"RTN","LA7UTL02",93,0)
 . S @RET@("SPEC",SPIEN)=SPECIMEN
"RTN","LA7UTL02",94,0)
 Q
"RTN","LA7UTL02",95,0)
 ;
"RTN","LA7UTL02",96,0)
 ;
"RTN","LA7UTL02",97,0)
HISTORY N CHIENS,CHIEN,HISTORY S CHIEN="0"
"RTN","LA7UTL02",98,0)
 F  S CHIEN=$O(^LR(LRDFN,"CY",IEN,.2,CHIEN)) Q:'CHIEN!(QUIT)  D
"RTN","LA7UTL02",99,0)
 . Q:QUIT
"RTN","LA7UTL02",100,0)
 . S CHIENS=CHIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",101,0)
 . S HISTORY=$$GET1^DIQ(63.913,CHIENS,.01,"I")
"RTN","LA7UTL02",102,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL02",103,0)
 . . K @RET
"RTN","LA7UTL02",104,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Clinical History data)."
"RTN","LA7UTL02",105,0)
 . . S QUIT=1
"RTN","LA7UTL02",106,0)
 . I HISTORY="" Q
"RTN","LA7UTL02",107,0)
 . S @RET@("CHIS",CHIEN)=HISTORY
"RTN","LA7UTL02",108,0)
 Q
"RTN","LA7UTL02",109,0)
 ;
"RTN","LA7UTL02",110,0)
PDIAG N PDIENS,PDIEN,PREOPDX S PDIEN="0"
"RTN","LA7UTL02",111,0)
 F  S PDIEN=$O(^LR(LRDFN,"CY",IEN,.3,PDIEN)) Q:'PDIEN!(QUIT)  D
"RTN","LA7UTL02",112,0)
 . Q:QUIT
"RTN","LA7UTL02",113,0)
 . S PDIENS=PDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",114,0)
 . S PREOPDX=$$GET1^DIQ(63.914,PDIENS,.01,"I")
"RTN","LA7UTL02",115,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL02",116,0)
 . . K @RET
"RTN","LA7UTL02",117,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Pre Operative Diagnosis data)."
"RTN","LA7UTL02",118,0)
 . . S QUIT=1
"RTN","LA7UTL02",119,0)
 . I PREOPDX="" Q
"RTN","LA7UTL02",120,0)
 . S @RET@("PREDX",PDIEN)=PREOPDX
"RTN","LA7UTL02",121,0)
 Q
"RTN","LA7UTL02",122,0)
 ;
"RTN","LA7UTL02",123,0)
 ;
"RTN","LA7UTL02",124,0)
OPDIAG N ODIENS,ODIEN,OPERDX S ODIEN="0"
"RTN","LA7UTL02",125,0)
 F  S ODIEN=$O(^LR(LRDFN,"CY",IEN,.4,ODIEN)) Q:'ODIEN!(QUIT)  D
"RTN","LA7UTL02",126,0)
 . Q:QUIT
"RTN","LA7UTL02",127,0)
 . S ODIENS=ODIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",128,0)
 . S OPERDX=$$GET1^DIQ(63.905,ODIENS,.01,"I")
"RTN","LA7UTL02",129,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL02",130,0)
 . . K @RET
"RTN","LA7UTL02",131,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Operative Diagnosis data)."
"RTN","LA7UTL02",132,0)
 . . S QUIT=1
"RTN","LA7UTL02",133,0)
 . I OPERDX="" Q
"RTN","LA7UTL02",134,0)
 . S @RET@("OPERDX",ODIEN)=OPERDX
"RTN","LA7UTL02",135,0)
 Q
"RTN","LA7UTL02",136,0)
 ;
"RTN","LA7UTL02",137,0)
 ;
"RTN","LA7UTL02",138,0)
POSTDIAG ;
"RTN","LA7UTL02",139,0)
 N PSDIENS,PSDIEN,POSTDX S PSDIEN="0"
"RTN","LA7UTL02",140,0)
 F  S PSDIEN=$O(^LR(LRDFN,"CY",IEN,.5,PSDIEN)) Q:'PSDIEN!(QUIT)  D
"RTN","LA7UTL02",141,0)
 . Q:QUIT
"RTN","LA7UTL02",142,0)
 . S PSDIENS=PSDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",143,0)
 . S POSTDX=$$GET1^DIQ(63.906,PSDIENS,.01,"I")
"RTN","LA7UTL02",144,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL02",145,0)
 . . K @RET
"RTN","LA7UTL02",146,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Post Operative Diagnosis data)."
"RTN","LA7UTL02",147,0)
 . . S QUIT=1
"RTN","LA7UTL02",148,0)
 . I POSTDX="" Q
"RTN","LA7UTL02",149,0)
 . S @RET@("POSTDX",PSDIEN)=POSTDX
"RTN","LA7UTL02",150,0)
 Q
"RTN","LA7UTL02",151,0)
 ;
"RTN","LA7UTL02",152,0)
CYTOPATH ; - Cyto Pathology
"RTN","LA7UTL02",153,0)
 N CYIENS,CYIEN,CYTODX S CYIEN="0"
"RTN","LA7UTL02",154,0)
 F  S CYIEN=$O(^LR(LRDFN,"CY",IEN,1.4,CYIEN)) Q:'CYIEN!(QUIT)  D
"RTN","LA7UTL02",155,0)
 . Q:QUIT
"RTN","LA7UTL02",156,0)
 . S CYIENS=CYIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",157,0)
 . S CYTODX=$$GET1^DIQ(63.903,CYIENS,.01,"I")
"RTN","LA7UTL02",158,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL02",159,0)
 . . K @RET
"RTN","LA7UTL02",160,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Cytopathology diagnosis data)."
"RTN","LA7UTL02",161,0)
 . . S QUIT=1
"RTN","LA7UTL02",162,0)
 . I CYTODX="" Q
"RTN","LA7UTL02",163,0)
 . S @RET@("CYTODX",CYIEN)=CYTODX
"RTN","LA7UTL02",164,0)
 Q
"RTN","LA7UTL02",165,0)
 ;
"RTN","LA7UTL02",166,0)
MICRO ; - Microscopic Exam
"RTN","LA7UTL02",167,0)
 N MICIENS,MICEXAM,MICIEN S MICIEN="0"
"RTN","LA7UTL02",168,0)
 F  S MICIEN=$O(^LR(LRDFN,"CY",IEN,1.1,MICIEN)) Q:'MICIEN!(QUIT)  D
"RTN","LA7UTL02",169,0)
 . Q:QUIT
"RTN","LA7UTL02",170,0)
 . S MICIENS=MICIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",171,0)
 . S MICEXAM=$$GET1^DIQ(63.911,MICIENS,.01,"I")
"RTN","LA7UTL02",172,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL02",173,0)
 . . K @RET
"RTN","LA7UTL02",174,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Cytopathology Microscopic Examination)"
"RTN","LA7UTL02",175,0)
 . . S QUIT=1
"RTN","LA7UTL02",176,0)
 . I MICEXAM="" Q
"RTN","LA7UTL02",177,0)
 . S @RET@("MICRO",MICIEN)=MICEXAM
"RTN","LA7UTL02",178,0)
 Q
"RTN","LA7UTL02",179,0)
 ;
"RTN","LA7UTL02",180,0)
 ;
"RTN","LA7UTL02",181,0)
ICD ; - Get ICD Data
"RTN","LA7UTL02",182,0)
 N ICDIENS,ICDIEN,ICD9 S ICDIEN="0"
"RTN","LA7UTL02",183,0)
 F  S ICDIEN=$O(^LR(LRDFN,"CY",IEN,3,ICDIEN)) Q:'ICDIEN!(QUIT)  D
"RTN","LA7UTL02",184,0)
 . Q:QUIT
"RTN","LA7UTL02",185,0)
 . S ICDIENS=ICDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL02",186,0)
 . S ICD9=$$GET1^DIQ(63.901,ICDIENS,.01,"E")
"RTN","LA7UTL02",187,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL02",188,0)
 . . K @RET
"RTN","LA7UTL02",189,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (ICD9 data)."
"RTN","LA7UTL02",190,0)
 . . S QUIT=1
"RTN","LA7UTL02",191,0)
 . I ICD9="" Q
"RTN","LA7UTL02",192,0)
 . S @RET@("ICD9",ICDIEN)=ICD9
"RTN","LA7UTL02",193,0)
 Q
"RTN","LA7UTL02",194,0)
 ;
"RTN","LA7UTL03")
0^2^B38217357
"RTN","LA7UTL03",1,0)
LA7UTL03 ;HOIFO/BH - Surgical Pathology Query Utility ; 3/11/03 10:45am       
"RTN","LA7UTL03",2,0)
        ;;5.2;AUTOMATED LAB INSTRUMENTS;**69**;Sep 27, 1994
"RTN","LA7UTL03",3,0)
 ;
"RTN","LA7UTL03",4,0)
 ;
"RTN","LA7UTL03",5,0)
SPATH(LRDFN,IEN,RET,ERR) ; Returns data for a given SP Encounter
"RTN","LA7UTL03",6,0)
 ;
"RTN","LA7UTL03",7,0)
 ; Input:
"RTN","LA7UTL03",8,0)
 ;
"RTN","LA7UTL03",9,0)
 ; LRDFN - Patient Lab DFN                        (Required)
"RTN","LA7UTL03",10,0)
 ; IEN   - IEN of SP entry                        (Required)
"RTN","LA7UTL03",11,0)
 ; RET   - Array reference for passing back data  (Required)
"RTN","LA7UTL03",12,0)
 ; ERR   - Error array to pass back               (Not required)
"RTN","LA7UTL03",13,0)
 ;
"RTN","LA7UTL03",14,0)
 ; Output:
"RTN","LA7UTL03",15,0)
 ;
"RTN","LA7UTL03",16,0)
 ; '0' - If the API encountered an Error along with @ERR array
"RTN","LA7UTL03",17,0)
 ;
"RTN","LA7UTL03",18,0)
 ; '1' - if the API ran successfully and the following data if it exists
"RTN","LA7UTL03",19,0)
 ;   
"RTN","LA7UTL03",20,0)
 ;   Specimen field .01 of file 63.812.
"RTN","LA7UTL03",21,0)
 ;   @RET("SPEC",ien of Specimen entry)=Specimen Data
"RTN","LA7UTL03",22,0)
 ;   
"RTN","LA7UTL03",23,0)
 ;   Clinical History field .01 of sub file 63.813.
"RTN","LA7UTL03",24,0)
 ;   @RET("CHIS",ien of the Clinical History entry)=Clinical His.
"RTN","LA7UTL03",25,0)
 ;   
"RTN","LA7UTL03",26,0)
 ;   Pre Operative Diagnosis field .01 of sub file 63.814.
"RTN","LA7UTL03",27,0)
 ;   @RET@("PREDX",ien of the Pre. Op. Diagnosis entry)=Pre Op Diag.
"RTN","LA7UTL03",28,0)
 ;
"RTN","LA7UTL03",29,0)
 ;   Operative Diagnosis field .01 of sub file 63.815.
"RTN","LA7UTL03",30,0)
 ;   @RET@("OPERDX",ien of the Op. Diagnosis entry)=Op Diag.
"RTN","LA7UTL03",31,0)
 ;
"RTN","LA7UTL03",32,0)
 ;   Post Operative Diagnosis field .01 of sub file 63.816.
"RTN","LA7UTL03",33,0)
 ;   @RET@("POSTDX,ien of the Post. Op Diagnosis entry)=Pst. Op Diag.
"RTN","LA7UTL03",34,0)
 ;
"RTN","LA7UTL03",35,0)
 ;   Gross Description field .01 of sub file 63.81.
"RTN","LA7UTL03",36,0)
 ;   @RET@("GROSSD",ien of the Gross Description entry)=Gross Desc.
"RTN","LA7UTL03",37,0)
 ;
"RTN","LA7UTL03",38,0)
 ;   Microscopic Description field .01 of sub file 63.811.
"RTN","LA7UTL03",39,0)
 ;   @RET@("MICROD",ien of the Microspc. Description entry)=Micro Desc.
"RTN","LA7UTL03",40,0)
 ;
"RTN","LA7UTL03",41,0)
 ;   Surgical Pathology field .01 of sub file 63.802.
"RTN","LA7UTL03",42,0)
 ;   @RET@("SURGP",ien of the Surgical Path. entry)=Surgical Path.
"RTN","LA7UTL03",43,0)
 ;
"RTN","LA7UTL03",44,0)
 ;   ICD field .01 of sub file 63.88.
"RTN","LA7UTL03",45,0)
 ;   @RET@("ICD9",ien of the ICD9 entry)=ICD9
"RTN","LA7UTL03",46,0)
 ;
"RTN","LA7UTL03",47,0)
 K @RET
"RTN","LA7UTL03",48,0)
 K @ERR
"RTN","LA7UTL03",49,0)
 I $G(LRDFN)="" D  Q 0
"RTN","LA7UTL03",50,0)
 . I $G(ERR)'="" S @ERR@("-1")="No Lab DFN." Q
"RTN","LA7UTL03",51,0)
 ;
"RTN","LA7UTL03",52,0)
 I $G(IEN)="" D  Q 0
"RTN","LA7UTL03",53,0)
 . I $G(ERR)'="" S @ERR@("-1")="No Surgical Pathology record IEN." Q
"RTN","LA7UTL03",54,0)
 ;
"RTN","LA7UTL03",55,0)
 I $G(RET)="" D  Q 0
"RTN","LA7UTL03",56,0)
 . I $G(ERR)'="" S @ERR@("-1")="No results array reference passed." Q
"RTN","LA7UTL03",57,0)
 ;
"RTN","LA7UTL03",58,0)
 ;
"RTN","LA7UTL03",59,0)
 N QUIT
"RTN","LA7UTL03",60,0)
 D SPECIMEN
"RTN","LA7UTL03",61,0)
 I 'QUIT D HISTORY
"RTN","LA7UTL03",62,0)
 I 'QUIT D PDIAG
"RTN","LA7UTL03",63,0)
 I 'QUIT D OPDIAG
"RTN","LA7UTL03",64,0)
 I 'QUIT D POSTDIAG
"RTN","LA7UTL03",65,0)
 I 'QUIT D GROSSD
"RTN","LA7UTL03",66,0)
 I 'QUIT D MICROD
"RTN","LA7UTL03",67,0)
 I 'QUIT D SURGPATH
"RTN","LA7UTL03",68,0)
 I 'QUIT D ICD
"RTN","LA7UTL03",69,0)
 I QUIT Q 0
"RTN","LA7UTL03",70,0)
 Q 1
"RTN","LA7UTL03",71,0)
 ;
"RTN","LA7UTL03",72,0)
 ;
"RTN","LA7UTL03",73,0)
SPECIMEN ;
"RTN","LA7UTL03",74,0)
 N SPIENS,SPIEN,SPECIMEN S SPIEN="0",QUIT=0
"RTN","LA7UTL03",75,0)
 F  S SPIEN=$O(^LR(LRDFN,"SP",IEN,.1,SPIEN)) Q:'SPIEN!(QUIT)  D
"RTN","LA7UTL03",76,0)
 . Q:QUIT
"RTN","LA7UTL03",77,0)
 . S SPIENS=SPIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",78,0)
 . S SPECIMEN=$$GET1^DIQ(63.812,SPIENS,.01,"I")
"RTN","LA7UTL03",79,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL03",80,0)
 . . K @RET
"RTN","LA7UTL03",81,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Specimen data)."
"RTN","LA7UTL03",82,0)
 . . S QUIT=1
"RTN","LA7UTL03",83,0)
 . I SPECIMEN="" Q
"RTN","LA7UTL03",84,0)
 . S @RET@("SPEC",SPIEN)=SPECIMEN
"RTN","LA7UTL03",85,0)
 Q
"RTN","LA7UTL03",86,0)
 ;
"RTN","LA7UTL03",87,0)
 ;
"RTN","LA7UTL03",88,0)
HISTORY N CHIENS,CHIEN,HISTORY S CHIEN="0"
"RTN","LA7UTL03",89,0)
 F  S CHIEN=$O(^LR(LRDFN,"SP",IEN,.2,CHIEN)) Q:'CHIEN!(QUIT)  D
"RTN","LA7UTL03",90,0)
 . Q:QUIT
"RTN","LA7UTL03",91,0)
 . S CHIENS=CHIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",92,0)
 . S HISTORY=$$GET1^DIQ(63.813,CHIENS,.01,"I")
"RTN","LA7UTL03",93,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL03",94,0)
 . . K @RET
"RTN","LA7UTL03",95,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Clinical History data)."
"RTN","LA7UTL03",96,0)
 . . S QUIT=1
"RTN","LA7UTL03",97,0)
 . I HISTORY="" Q
"RTN","LA7UTL03",98,0)
 . S @RET@("CHIS",CHIEN)=HISTORY
"RTN","LA7UTL03",99,0)
 Q
"RTN","LA7UTL03",100,0)
 ;
"RTN","LA7UTL03",101,0)
PDIAG N PDIENS,PDIEN,PREOPDX S PDIEN="0"
"RTN","LA7UTL03",102,0)
 F  S PDIEN=$O(^LR(LRDFN,"SP",IEN,.3,PDIEN)) Q:'PDIEN!(QUIT)  D
"RTN","LA7UTL03",103,0)
 . Q:QUIT
"RTN","LA7UTL03",104,0)
 . S PDIENS=PDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",105,0)
 . S PREOPDX=$$GET1^DIQ(63.814,PDIENS,.01,"I")
"RTN","LA7UTL03",106,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL03",107,0)
 . . K @RET
"RTN","LA7UTL03",108,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Pre Operative Diagnosis data)."
"RTN","LA7UTL03",109,0)
 . . S QUIT=1
"RTN","LA7UTL03",110,0)
 . I PREOPDX="" Q
"RTN","LA7UTL03",111,0)
 . S @RET@("PREDX",PDIEN)=PREOPDX
"RTN","LA7UTL03",112,0)
 Q
"RTN","LA7UTL03",113,0)
 ;
"RTN","LA7UTL03",114,0)
 ;
"RTN","LA7UTL03",115,0)
OPDIAG N ODIENS,ODIEN,OPERDX S ODIEN="0"
"RTN","LA7UTL03",116,0)
 F  S ODIEN=$O(^LR(LRDFN,"SP",IEN,.4,ODIEN)) Q:'ODIEN!(QUIT)  D
"RTN","LA7UTL03",117,0)
 . Q:QUIT
"RTN","LA7UTL03",118,0)
 . S ODIENS=ODIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",119,0)
 . S OPERDX=$$GET1^DIQ(63.815,ODIENS,.01,"I")
"RTN","LA7UTL03",120,0)
 . I $G(DIERR) D  Q 
"RTN","LA7UTL03",121,0)
 . . K @RET
"RTN","LA7UTL03",122,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Operative Diagnosis data)."
"RTN","LA7UTL03",123,0)
 . . S QUIT=1
"RTN","LA7UTL03",124,0)
 . I OPERDX="" Q
"RTN","LA7UTL03",125,0)
 . S @RET@("OPERDX",ODIEN)=OPERDX
"RTN","LA7UTL03",126,0)
 Q
"RTN","LA7UTL03",127,0)
 ;
"RTN","LA7UTL03",128,0)
 ;
"RTN","LA7UTL03",129,0)
POSTDIAG ;
"RTN","LA7UTL03",130,0)
 N PSDIENS,PSDIEN,POSTDX S PSDIEN="0"
"RTN","LA7UTL03",131,0)
 F  S PSDIEN=$O(^LR(LRDFN,"SP",IEN,.5,PSDIEN)) Q:'PSDIEN!(QUIT)  D
"RTN","LA7UTL03",132,0)
 . Q:QUIT
"RTN","LA7UTL03",133,0)
 . S PSDIENS=PSDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",134,0)
 . S POSTDX=$$GET1^DIQ(63.816,PSDIENS,.01,"I")
"RTN","LA7UTL03",135,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL03",136,0)
 . . K @RET
"RTN","LA7UTL03",137,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Post Operative Diagnosis data)."
"RTN","LA7UTL03",138,0)
 . . S QUIT=1
"RTN","LA7UTL03",139,0)
 . I POSTDX="" Q
"RTN","LA7UTL03",140,0)
 . S @RET@("POSTDX",PSDIEN)=POSTDX
"RTN","LA7UTL03",141,0)
 Q
"RTN","LA7UTL03",142,0)
 ;
"RTN","LA7UTL03",143,0)
 ;- Gross Description Data
"RTN","LA7UTL03",144,0)
GROSSD N GDIENS,GDIEN,GROSSD S GDIEN="0"
"RTN","LA7UTL03",145,0)
 F  S GDIEN=$O(^LR(LRDFN,"SP",IEN,1,GDIEN)) Q:'GDIEN!(QUIT)  D
"RTN","LA7UTL03",146,0)
 . Q:QUIT
"RTN","LA7UTL03",147,0)
 . S GDIENS=GDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",148,0)
 . S GROSSD=$$GET1^DIQ(63.81,GDIENS,.01,"I")
"RTN","LA7UTL03",149,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL03",150,0)
 . . K @RET
"RTN","LA7UTL03",151,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Gross Description data)."
"RTN","LA7UTL03",152,0)
 . . S QUIT=1
"RTN","LA7UTL03",153,0)
 . I GROSSD="" Q
"RTN","LA7UTL03",154,0)
 . S @RET@("GROSSD",GDIEN)=GROSSD
"RTN","LA7UTL03",155,0)
 Q
"RTN","LA7UTL03",156,0)
 ;
"RTN","LA7UTL03",157,0)
MICROD ; Microscopic Description
"RTN","LA7UTL03",158,0)
 N MDIENS,MDIEN,MICROD S MDIEN="0"
"RTN","LA7UTL03",159,0)
 F  S MDIEN=$O(^LR(LRDFN,"SP",IEN,1.1,MDIEN)) Q:'MDIEN!(QUIT)  D
"RTN","LA7UTL03",160,0)
 . Q:QUIT
"RTN","LA7UTL03",161,0)
 . S MDIENS=MDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",162,0)
 . S MICROD=$$GET1^DIQ(63.811,MDIENS,.01,"I")
"RTN","LA7UTL03",163,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL03",164,0)
 . . K @RET
"RTN","LA7UTL03",165,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Microscopic Description data)."
"RTN","LA7UTL03",166,0)
 . . S QUIT=1
"RTN","LA7UTL03",167,0)
 . I MICROD="" Q
"RTN","LA7UTL03",168,0)
 . S @RET@("MICROD",MDIEN)=MICROD
"RTN","LA7UTL03",169,0)
 Q
"RTN","LA7UTL03",170,0)
 ;
"RTN","LA7UTL03",171,0)
SURGPATH ; - Surgical Pathology
"RTN","LA7UTL03",172,0)
 N SGIENS,SGIEN,SURGP S SGIEN="0"
"RTN","LA7UTL03",173,0)
 F  S SGIEN=$O(^LR(LRDFN,"SP",IEN,1.4,SGIEN)) Q:'SGIEN!(QUIT)  D
"RTN","LA7UTL03",174,0)
 . Q:QUIT
"RTN","LA7UTL03",175,0)
 . S SGIENS=SGIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",176,0)
 . S SURGP=$$GET1^DIQ(63.802,SGIENS,.01,"I")
"RTN","LA7UTL03",177,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL03",178,0)
 . . K @RET
"RTN","LA7UTL03",179,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (Surgical Pathology data)."
"RTN","LA7UTL03",180,0)
 . . S QUIT=1
"RTN","LA7UTL03",181,0)
 . I SURGP="" Q
"RTN","LA7UTL03",182,0)
 . S @RET@("SURGP",SGIEN)=SURGP
"RTN","LA7UTL03",183,0)
 Q
"RTN","LA7UTL03",184,0)
 ;
"RTN","LA7UTL03",185,0)
ICD ; - Get ICD Data
"RTN","LA7UTL03",186,0)
 N ICDIENS,ICDIEN,ICD9 S ICDIEN="0"
"RTN","LA7UTL03",187,0)
 F  S ICDIEN=$O(^LR(LRDFN,"SP",IEN,3,ICDIEN)) Q:'ICDIEN!(QUIT)  D
"RTN","LA7UTL03",188,0)
 . Q:QUIT
"RTN","LA7UTL03",189,0)
 . S ICDIENS=ICDIEN_","_IEN_","_LRDFN_","
"RTN","LA7UTL03",190,0)
 . S ICD9=$$GET1^DIQ(63.88,ICDIENS,.01,"E")
"RTN","LA7UTL03",191,0)
 . I $G(DIERR) D  Q
"RTN","LA7UTL03",192,0)
 . . K @RET
"RTN","LA7UTL03",193,0)
 . . I $G(ERR)'="" S @ERR@("-1")="Fileman Error within GET1 call (ICD9 data)."
"RTN","LA7UTL03",194,0)
 . . S QUIT=1
"RTN","LA7UTL03",195,0)
 . I ICD9="" Q
"RTN","LA7UTL03",196,0)
 . S @RET@("ICD9",ICDIEN)=ICD9
"RTN","LA7UTL03",197,0)
 Q
"RTN","LA7UTL03",198,0)
 ;
"RTN","LA7UTL1A")
0^3^B16383950
"RTN","LA7UTL1A",1,0)
LA7UTL1A ;HOIFO/BH - Microbiology Query Utility ; 3/11/03 10:45am
"RTN","LA7UTL1A",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**69**;Sep 27, 1994
"RTN","LA7UTL1A",3,0)
 ;
"RTN","LA7UTL1A",4,0)
 ;
"RTN","LA7UTL1A",5,0)
GETDATA(LRDFN,LASDT,LAEDT,LASEARCH,RESULTS) ;
"RTN","LA7UTL1A",6,0)
 ;
"RTN","LA7UTL1A",7,0)
 ;    Input:
"RTN","LA7UTL1A",8,0)
 ;
"RTN","LA7UTL1A",9,0)
 ;    LRDFN - Lab DFN
"RTN","LA7UTL1A",10,0)
 ;    LASDT - Search Start Date
"RTN","LA7UTL1A",11,0)
 ;    LAEDT - Search End Date
"RTN","LA7UTL1A",12,0)
 ;    LASEARCH - Set to CD (collection date) or RAD (completion date).
"RTN","LA7UTL1A",13,0)
 ;    RESULTS - Closed root destination array reference
"RTN","LA7UTL1A",14,0)
 ;
"RTN","LA7UTL1A",15,0)
 ;    Output:
"RTN","LA7UTL1A",16,0)
 ;    If an error is found with the input variables one for the
"RTN","LA7UTL1A",17,0)
 ;    strings will be returned.
"RTN","LA7UTL1A",18,0)
 ;
"RTN","LA7UTL1A",19,0)
 ;       -1^Start date is after end date
"RTN","LA7UTL1A",20,0)
 ;       -2^No return array global
"RTN","LA7UTL1A",21,0)
 ;       -3^Global array only
"RTN","LA7UTL1A",22,0)
 ;       -4^No Patient lab DFN
"RTN","LA7UTL1A",23,0)
 ;       -5^No Start Date Range
"RTN","LA7UTL1A",24,0)
 ;       -6^No End Date Range
"RTN","LA7UTL1A",25,0)
 ;
"RTN","LA7UTL1A",26,0)
 ;  If there are no errors with the input variables the processing
"RTN","LA7UTL1A",27,0)
 ;  will return '1'.  If there is no data in the passed in global
"RTN","LA7UTL1A",28,0)
 ;  there was no data available for the patient.
"RTN","LA7UTL1A",29,0)
 ;
"RTN","LA7UTL1A",30,0)
 ;  If there is data available for the patient the routine will pass 
"RTN","LA7UTL1A",31,0)
 ;  back the following data (the example assumes the passed in closed 
"RTN","LA7UTL1A",32,0)
 ;  root global was "^TMP($J)"):
"RTN","LA7UTL1A",33,0)
 ;
"RTN","LA7UTL1A",34,0)
 ;  Fields .01 (Accession date),.05 (Site Specimen),.055 (Sample Type),
"RTN","LA7UTL1A",35,0)
 ;  .06 (Accession #),11.51 (Sterility Control),11.57 (Urine Screen),
"RTN","LA7UTL1A",36,0)
 ;  11.58 (Sputum Screen), 22 (TB RPT Date Approved), 23 (TB RPT Status),
"RTN","LA7UTL1A",37,0)
 ;  24 (ACID Fast Stain), 25 (Quantity) and .99 (Specimen Comment) from 
"RTN","LA7UTL1A",38,0)
 ;  the top node in the following format;
"RTN","LA7UTL1A",39,0)
 ;    
"RTN","LA7UTL1A",40,0)
 ;  ^TMP($J,LRDFN,Record_IEN,"0",Field #,"E" or "I")=Field Data
"RTN","LA7UTL1A",41,0)
 ;    
"RTN","LA7UTL1A",42,0)
 ;  Field .01 of sub file 63.29 - Gram Stain - in the following format
"RTN","LA7UTL1A",43,0)
 ;
"RTN","LA7UTL1A",44,0)
 ; ^TMP($J,LRDFN,Record_IEN,"2",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",45,0)
 ;
"RTN","LA7UTL1A",46,0)
 ;  Field .01 (Organism) and 1 (Quantity) of sub file 63.3 in the 
"RTN","LA7UTL1A",47,0)
 ;  following format;
"RTN","LA7UTL1A",48,0)
 ;  
"RTN","LA7UTL1A",49,0)
 ; ^TMP($J,LRDFN,Record_IEN,"3",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",50,0)
 ;
"RTN","LA7UTL1A",51,0)
 ;   Within the Organism data there is an antibiotic multiple.  The 
"RTN","LA7UTL1A",52,0)
 ;   routine returns the antibiotic (.01) along with the Mic (field #1) 
"RTN","LA7UTL1A",53,0)
 ;   and Mbc (field #2) from the sub file 63.32 in the following format;
"RTN","LA7UTL1A",54,0)
 ;
"RTN","LA7UTL1A",55,0)
 ;   ^TMP($J,LRDFN,Record_IEN,"3",Sub File IEN,"3",Sub-Sub File IEN,"0"
"RTN","LA7UTL1A",56,0)
 ;   ,Field #,"E" or "I")=Data
"RTN","LA7UTL1A",57,0)
 ;
"RTN","LA7UTL1A",58,0)
 ;
"RTN","LA7UTL1A",59,0)
 ;  Organisms can potentially have specific antibiotics associated with 
"RTN","LA7UTL1A",60,0)
 ;  them. This API pulls any of the Antibiotics (along with their 
"RTN","LA7UTL1A",61,0)
 ;  interpretation and screen) that have been entered in the antibiotic
"RTN","LA7UTL1A",62,0)
 ;  fields that exist within the standard Lab DD.  Within this sub file
"RTN","LA7UTL1A",63,0)
 ;  these fields are numbered between 5 and 160.2 and have node numbers
"RTN","LA7UTL1A",64,0)
 ;  that begin with the numbers 2.00.
"RTN","LA7UTL1A",65,0)
 ;  It is also possible for sites to enter their own specific named 
"RTN","LA7UTL1A",66,0)
 ;  antibiotics within this multiple using a lab option.  This option 
"RTN","LA7UTL1A",67,0)
 ;  creates a new node number for the new antibiotic entry that is 
"RTN","LA7UTL1A",68,0)
 ;  comprised in the
"RTN","LA7UTL1A",69,0)
 ;  following way "2.00"_site #_n (where n is an incremented number).
"RTN","LA7UTL1A",70,0)
 ;  This node number also becomes the field number for this antibiotic.
"RTN","LA7UTL1A",71,0)
 ;  The interpretation and screen values of these antibiotics should
"RTN","LA7UTL1A",72,0)
 ;  follow a pattern where interpretation field number is comprised as
"RTN","LA7UTL1A",73,0)
 ;  follows "2.00"_site #_n_1 and the screen is "2.00"_site #_n_2.
"RTN","LA7UTL1A",74,0)
 ;
"RTN","LA7UTL1A",75,0)
 ;  However only antibiotics have been entered in the standard Organism
"RTN","LA7UTL1A",76,0)
 ;  DD will get extracted.  Any antibiotics entered into the site 
"RTN","LA7UTL1A",77,0)
 ;  specified fields will not get extracted.
"RTN","LA7UTL1A",78,0)
 ;
"RTN","LA7UTL1A",79,0)
 ;  ^TMP($J,LRDFN,Record_IEN,"3",Sub File IEN,"0",Field #,"I")=data
"RTN","LA7UTL1A",80,0)
 ;  ^TMP($J,LRDFN,Record_IEN,"3",Sub File IEN,"0",Field #,"E")=field name
"RTN","LA7UTL1A",81,0)
 ;                                                             ^data
"RTN","LA7UTL1A",82,0)
 ;
"RTN","LA7UTL1A",83,0)
 ;  Note the "E" node contains the field name and it's related data.
"RTN","LA7UTL1A",84,0)
 ;
"RTN","LA7UTL1A",85,0)
 ;
"RTN","LA7UTL1A",86,0)
 ;    Within the Organism data there is a comment multiple which the
"RTN","LA7UTL1A",87,0)
 ;    routine also returns.  
"RTN","LA7UTL1A",88,0)
 ;    Field .01 Comment of sub file 63.31 in the following format;
"RTN","LA7UTL1A",89,0)
 ; 
"RTN","LA7UTL1A",90,0)
 ;   ^TMP($J,LRDFN,Record_IEN,"3",Sub File IEN,"1",Sub-Sub File IEN,"0"
"RTN","LA7UTL1A",91,0)
 ;   ,Field #,"E" or "I")=Data
"RTN","LA7UTL1A",92,0)
 ;
"RTN","LA7UTL1A",93,0)
 ;  Field .01 Bact RPT Remark of sub file 63.33 in the following format;
"RTN","LA7UTL1A",94,0)
 ;
"RTN","LA7UTL1A",95,0)
 ; ^TMP($J,LRDFN,Record_IEN,"4",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",96,0)
 ;
"RTN","LA7UTL1A",97,0)
 ;  Field .01 Parasite of sub file 63.34 in the following format;
"RTN","LA7UTL1A",98,0)
 ;
"RTN","LA7UTL1A",99,0)
 ; ^TMP($J,LRDFN,Record_IEN,"6",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",100,0)
 ;
"RTN","LA7UTL1A",101,0)
 ;   Within Parasite data there is a stage code multiple that the routine
"RTN","LA7UTL1A",102,0)
 ;   also returns.
"RTN","LA7UTL1A",103,0)
 ;   Fields .01 Stage code and 1 Quantity of sub file 63.35 in the 
"RTN","LA7UTL1A",104,0)
 ;   following format;
"RTN","LA7UTL1A",105,0)
 ;
"RTN","LA7UTL1A",106,0)
 ;   ^TMP($J,LRDFN,Record_IEN,"6",Sub File IEN,"1",Sub-Sub File IEN,"0"
"RTN","LA7UTL1A",107,0)
 ;   ,Field #,"E" or "I")=Data
"RTN","LA7UTL1A",108,0)
 ;
"RTN","LA7UTL1A",109,0)
 ;     Within the Stage Code multiple there can be a Stage Code Comment
"RTN","LA7UTL1A",110,0)
 ;     multiple that this routine also returns;
"RTN","LA7UTL1A",111,0)
 ;     Field .01 of the Stage Code Comment Multiple 63.351 in the 
"RTN","LA7UTL1A",112,0)
 ;     following format;
"RTN","LA7UTL1A",113,0)
 ;
"RTN","LA7UTL1A",114,0)
 ;     
"RTN","LA7UTL1A",115,0)
 ;     ^TMP($J,LRDFN,Record_IEN,"6",Sub File IEN,"1",Sub-Sub File IEN,"1"
"RTN","LA7UTL1A",116,0)
 ;     ,Sub Sub Sub File IEN,"0",Field #,"E" or "I")=Data)
"RTN","LA7UTL1A",117,0)
 ;
"RTN","LA7UTL1A",118,0)
 ;  Field .01 Parasite RPT Remark 63.36 in the following format;
"RTN","LA7UTL1A",119,0)
 ; 
"RTN","LA7UTL1A",120,0)
 ; ^TMP($J,LRDFN,Record_IEN,"7",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",121,0)
 ;
"RTN","LA7UTL1A",122,0)
 ;  Field .01 Fungus/Yeast and field 1 Quantity of sub file 63.37 in the
"RTN","LA7UTL1A",123,0)
 ;  following format;
"RTN","LA7UTL1A",124,0)
 ;
"RTN","LA7UTL1A",125,0)
 ; ^TMP($J,LRDFN,Record_IEN,"9",Sub File IEN,"0",Field #,"E" or "I")=Data
"RTN","LA7UTL1A",126,0)
 ;
"RTN","LA7UTL1A",127,0)
 ;    Within the Fungus/Yeast data there is a comment multiple which the
"RTN","LA7UTL1A",128,0)
 ;    routine also returns.  
"RTN","LA7UTL1A",129,0)
 ;    Field .01 Comment of sub file 63.372 in the following format;
"RTN","LA7UTL1A",130,0)
 ;
"RTN","LA7UTL1A",131,0)
 ;   ^TMP($J,LRDFN,Record_IEN,"9",Sub File IEN,"1",Sub-Sub File IEN,"0"
"RTN","LA7UTL1A",132,0)
 ;   ,Field #,"E" or "I")=Data
"RTN","LA7UTL1A",133,0)
 ;
"RTN","LA7UTL1A",134,0)
 ;
"RTN","LA7UTL1A",135,0)
 ;  Field .01 Mycobacterium and field 1 Quantity of sub file 63.39 in 
"RTN","LA7UTL1A",136,0)
 ;  the following format;
"RTN","LA7UTL1A",137,0)
 ;
"RTN","LA7UTL1A",138,0)
 ; ^TMP($J,LRDFN,Record_IEN,"12",Sub File IEN,"0",Field #,"E" or "I")
"RTN","LA7UTL1A",139,0)
 ;                                                                 =Data
"RTN","LA7UTL1A",140,0)
 ;  Mycobacterium can potentially have antibiotics associated with them. 
"RTN","LA7UTL1A",141,0)
 ;  This API pulls any of the Antibiotics that have been entered in the 
"RTN","LA7UTL1A",142,0)
 ;  antibiotic
"RTN","LA7UTL1A",143,0)
 ;  fields that exist within the standard Lab DD.  Within this sub file
"RTN","LA7UTL1A",144,0)
 ;  these fields are numbered between 5 and 55).
"RTN","LA7UTL1A",145,0)
 ;  It is also possible for sites to enter their own antibiotics
"RTN","LA7UTL1A",146,0)
 ;  within this multiple using a lab option.  This option creates a new
"RTN","LA7UTL1A",147,0)
 ;  node number for the new antibiotic entry that is comprised in the
"RTN","LA7UTL1A",148,0)
 ;  following way "2.00"_site #_n (where n is an incremented number).
"RTN","LA7UTL1A",149,0)
 ;  This node number also becomes the field number for this antibiotic.
"RTN","LA7UTL1A",150,0)
 ;
"RTN","LA7UTL1A",151,0)
 ;  However only antibiotics have been entered in the standard 
"RTN","LA7UTL1A",152,0)
 ;  Mycobacterium antibiotic DD will get extracted.  Any antibiotics 
"RTN","LA7UTL1A",153,0)
 ;  entered into the site specified fields will not get extracted.
"RTN","LA7UTL1A",154,0)
 ;
"RTN","LA7UTL1A",155,0)
 ;  ^TMP($J,LRDFN,Record_IEN,"12",Sub File IEN,"0",Field #,"I")=data
"RTN","LA7UTL1A",156,0)
 ;  ^TMP($J,LRDFN,Record_IEN,"12",Sub File IEN,"0",Field #,"E")
"RTN","LA7UTL1A",157,0)
 ;                                                     =field name^data
"RTN","LA7UTL1A",158,0)
 ;
"RTN","LA7UTL1A",159,0)
 ;  Note the "E" node contains the field name and it's related data.
"RTN","LA7UTL1A",160,0)
 ;
"RTN","LA7UTL1A",161,0)
 ;
"RTN","LA7UTL1A",162,0)
 ;
"RTN","LA7UTL1A",163,0)
 ;    Within the Mycobacterium data there is a comment multiple which the
"RTN","LA7UTL1A",164,0)
 ;    routine also returns.  
"RTN","LA7UTL1A",165,0)
 ;    Field .01 Comment of sub file 63.4 in the following format;
"RTN","LA7UTL1A",166,0)
 ;
"RTN","LA7UTL1A",167,0)
 ;   ^TMP($J,LRDFN,Record_IEN,"12",Sub File IEN,"1",Sub-Sub File IEN,"0"
"RTN","LA7UTL1A",168,0)
 ;   ,Field #,"E" or "I")=Data
"RTN","LA7UTL1A",169,0)
 ;
"RTN","LA7UTL1A",170,0)
 ;  Field .01 BACT Smear/Prep of sub file 63.291 in the following format;
"RTN","LA7UTL1A",171,0)
 ;
"RTN","LA7UTL1A",172,0)
 ; ^TMP($J,LRDFN,Record_IEN,"25",Sub File IEN,"0",Field #,"E" or "I")
"RTN","LA7UTL1A",173,0)
 ;                                                                = Data
"RTN","LA7UTL1A",174,0)
 ;
"RTN","LA7UTL1A",175,0)
 ;  Field .01 PARA Smear/Prep of sub file 63.341 in the following format;
"RTN","LA7UTL1A",176,0)
 ;
"RTN","LA7UTL1A",177,0)
 ; ^TMP($J,LRDFN,Record_IEN,"24",Sub File IEN,"0",Field #,"E" or "I")
"RTN","LA7UTL1A",178,0)
 ;                                                                =Data
"RTN","LA7UTL1A",179,0)
 ;
"RTN","LA7UTL1A",180,0)
 ;  Field .01 VIRUS of sub file 63.43 in the following format;
"RTN","LA7UTL1A",181,0)
 ;
"RTN","LA7UTL1A",182,0)
 ; ^TMP($J,LRDFN,Record_IEN,"17",Sub File IEN,"0",Field #,"E" or "I")
"RTN","LA7UTL1A",183,0)
 ;                                                                 =Data
"RTN","LA7UTL1A",184,0)
 ;
"RTN","LA7UTL1A",185,0)
 ;
"RTN","LA7UTL1A",186,0)
 ; ---------------------------------------------------------------------
"RTN","LA7UTL1A",187,0)
 ;
"RTN","LA7UTL1A",188,0)
 N LAARRAY,LAINX,LATYP,LAFILE,LAARRET,LACD,LACDFLD,LACDTYP,LADATA,LASET,LASUB,LA763,LATYPE
"RTN","LA7UTL1A",189,0)
 ;
"RTN","LA7UTL1A",190,0)
 I LASDT>LAEDT Q "-1^Start date is after end date"
"RTN","LA7UTL1A",191,0)
 I '$D(RESULTS) Q "-2^No return array global"
"RTN","LA7UTL1A",192,0)
 I $E(RESULTS,1,1)'="^" Q "-3^Global array only"
"RTN","LA7UTL1A",193,0)
 I '+$G(LRDFN) Q "-4^No Patient lab DFN"
"RTN","LA7UTL1A",194,0)
 I '$G(LASDT) Q "-5^No Start Date Range"
"RTN","LA7UTL1A",195,0)
 I '$G(LAEDT) Q "-6^No End Date Range"
"RTN","LA7UTL1A",196,0)
 S LAFILE=63.05,LATYPE="MI"
"RTN","LA7UTL1A",197,0)
 ;
"RTN","LA7UTL1A",198,0)
 ; - Used for internal processing
"RTN","LA7UTL1A",199,0)
 S LAARRAY="^XTMP(""LA7UTL1A"",$J)"
"RTN","LA7UTL1A",200,0)
 ; - Passed in global reference, returns results
"RTN","LA7UTL1A",201,0)
 S LAARRET=$S($G(RESULTS)'="":RESULTS,1:"^TMP(""LA7UTL1A"","_$J_")")
"RTN","LA7UTL1A",202,0)
 K @LAARRAY,@LAARRET
"RTN","LA7UTL1A",203,0)
 I LASEARCH="RAD" D RAD
"RTN","LA7UTL1A",204,0)
 I LASEARCH="CD" D CD
"RTN","LA7UTL1A",205,0)
 ;
"RTN","LA7UTL1A",206,0)
 Q 1
"RTN","LA7UTL1A",207,0)
 ;
"RTN","LA7UTL1A",208,0)
CD ; Search by collection date
"RTN","LA7UTL1A",209,0)
 ;
"RTN","LA7UTL1A",210,0)
 N LRIDT,LRSS,LANSDT,LANEDT
"RTN","LA7UTL1A",211,0)
 ;
"RTN","LA7UTL1A",212,0)
 I LASDT S LANSDT=9999999-LASDT
"RTN","LA7UTL1A",213,0)
 I LAEDT S LANEDT=9999999-LAEDT
"RTN","LA7UTL1A",214,0)
 ;
"RTN","LA7UTL1A",215,0)
 S LRIDT=LANSDT
"RTN","LA7UTL1A",216,0)
 F  S LRIDT=$O(^LR(LRDFN,LATYPE,LRIDT),-1) Q:LRIDT=""!(LRIDT<LANEDT)  D
"RTN","LA7UTL1A",217,0)
 . D MI^LA7UTL1C(LRDFN,LRIDT,LAARRAY),ARRANGE^LA7UTL1B(LAARRAY,LAARRET)
"RTN","LA7UTL1A",218,0)
 ;
"RTN","LA7UTL1A",219,0)
 Q
"RTN","LA7UTL1A",220,0)
 ;
"RTN","LA7UTL1A",221,0)
RAD ; Search by completion date.
"RTN","LA7UTL1A",222,0)
 ;
"RTN","LA7UTL1A",223,0)
 N LRIDT
"RTN","LA7UTL1A",224,0)
 S LRIDT=0
"RTN","LA7UTL1A",225,0)
 F  S LRIDT=$O(^LR(LRDFN,LATYPE,LRIDT)) Q:'LRIDT  D
"RTN","LA7UTL1A",226,0)
 . S LA763(0)=$G(^LR(LRDFN,LATYPE,LRIDT,0))
"RTN","LA7UTL1A",227,0)
 . I $P(LA763(0),"^",3)>LASDT,$P(LA763(0),"^",3)<LAEDT D MI^LA7UTL1C(LRDFN,LRIDT,LAARRAY),ARRANGE^LA7UTL1B(LAARRAY,LAARRET)
"RTN","LA7UTL1A",228,0)
 Q
"RTN","LA7UTL1A",229,0)
 ;
"RTN","LA7UTL1A",230,0)
 ;
"RTN","LA7UTL1A",231,0)
 ;
"RTN","LA7UTL1B")
0^4^B36932976
"RTN","LA7UTL1B",1,0)
LA7UTL1B ;HOIFO/BH - Microbilogy Antibiotics & and Output global arragment  ; 3/11/03 10:45am  
"RTN","LA7UTL1B",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**69**;Sep 27, 1994
"RTN","LA7UTL1B",3,0)
 ;
"RTN","LA7UTL1B",4,0)
 ; Pass back field name of Organism Antibiotic field.  If the Antibiotic
"RTN","LA7UTL1B",5,0)
 ; field node is lonnger than six characters it is site specific and
"RTN","LA7UTL1B",6,0)
 ; is not returned.
"RTN","LA7UTL1B",7,0)
 ;
"RTN","LA7UTL1B",8,0)
DECODE(VAL) ;
"RTN","LA7UTL1B",9,0)
 N STR,MVAL,M1VAL
"RTN","LA7UTL1B",10,0)
 S STR=""
"RTN","LA7UTL1B",11,0)
 I $E(VAL,1,4)'="2.00" Q ""
"RTN","LA7UTL1B",12,0)
 I 'VAL Q ""
"RTN","LA7UTL1B",13,0)
 I $L(VAL)>6 Q ""
"RTN","LA7UTL1B",14,0)
 S VAL=$P(VAL,".",2)
"RTN","LA7UTL1B",15,0)
 I $L(VAL)=3 D
"RTN","LA7UTL1B",16,0)
 . S MVAL=+VAL
"RTN","LA7UTL1B",17,0)
 . S STR=$P($T(MCODE+MVAL),";;",2)
"RTN","LA7UTL1B",18,0)
 I $L(VAL)=4 D
"RTN","LA7UTL1B",19,0)
 . S M1VAL=+VAL
"RTN","LA7UTL1B",20,0)
 . S STR=$P($T(MCODE1+M1VAL),";;",2)
"RTN","LA7UTL1B",21,0)
 Q STR
"RTN","LA7UTL1B",22,0)
 ;
"RTN","LA7UTL1B",23,0)
MCODE ;
"RTN","LA7UTL1B",24,0)
 ;;2.001^50~CEFAZOLIN^50.1~CEFAZOLIN INTERP^50.2~CEFAZOLIN SCREEN
"RTN","LA7UTL1B",25,0)
 ;;2.002^145~PIPERACILLIN^145.1~PIPERACILLIN INTERP^145.2~PIPERACILLIN SCREEN
"RTN","LA7UTL1B",26,0)
 ;;2.003^150~OXACILLIN^150.1~OXACILLIN INTERP^150.2~OXACILLIN SCREEN
"RTN","LA7UTL1B",27,0)
 ;;2.004^160~TRIMETHOPRIM^160.1~TRIMETHOPRIM INTERP^160.2~TRIMETHOPRIM SCREEN
"RTN","LA7UTL1B",28,0)
 ;
"RTN","LA7UTL1B",29,0)
 ;
"RTN","LA7UTL1B",30,0)
MCODE1 ;
"RTN","LA7UTL1B",31,0)
 ;;2.0001^5~NEOMYCIN^5.1~NEOMYCIN INTERP^5.2~NEOMYCIN SCREEN
"RTN","LA7UTL1B",32,0)
 ;;2.0002^10~BACITRACIN^10.1~BACITRACIN INTERP^10.2~BACITRACIN SCREEN
"RTN","LA7UTL1B",33,0)
 ;;2.0003^15~PENICILLIN^15.1~PENICILLIN INTERP^15.2~PENICILLIN SCREEN
"RTN","LA7UTL1B",34,0)
 ;;2.0004^20~CLINDAMYCIN^20.1~CLINDAMYCIN INTERP^20.2~CLINDAMYCIN SCREEN 
"RTN","LA7UTL1B",35,0)
 ;;2.0005^25~METHICILLIN^25.1~METHICILLIN INTERP^25.2~METHICILLIN SCREEN 
"RTN","LA7UTL1B",36,0)
 ;;2.0006^30~VANCOMYCIN^30.1~VANCOMYCIN INTERP^30.2~VANCOMYCIN SCREEN
"RTN","LA7UTL1B",37,0)
 ;;2.0007^35~GENTAMICIN^35.1~GENTAMICIN INTERP^35.2~GENTAMICIN SCREEN
"RTN","LA7UTL1B",38,0)
 ;;2.0008^40~CHLORAMPHENICOL^40.1~CHLORAMPHENICOL INTERP^40.2~CHLORAMPHENICOL SCREEN
"RTN","LA7UTL1B",39,0)
 ;;2.0009^45~KANAMYCIN^45.1~KANAMYCIN INTERP^45.2~KANAMYCIN SCREEN 
"RTN","LA7UTL1B",40,0)
 ;;
"RTN","LA7UTL1B",41,0)
 ;;2.0011^55~TETRACYCLINE^55.1~TETRACYCLINE INTERP^55.2~TETRACYCLINE SCREEN 
"RTN","LA7UTL1B",42,0)
 ;;2.0012^60~AMPICILLIN^60.1~AMPICILLIN INTERP^60.2~AMPICILLIN SCREEN
"RTN","LA7UTL1B",43,0)
 ;;2.0013^65~CARBENICILLIN^65.1~CARBENICILLIN INTERP^65.2~CARBENICILLIN SCREEN 
"RTN","LA7UTL1B",44,0)
 ;;2.0014^70~TOBRAMYCIN^70.1~TOBRAMYCIN INTERP^70.2~TOBRAMYCIN SCREEN
"RTN","LA7UTL1B",45,0)
 ;;2.0015^75~TRIMETHAPRIM/SULFAMETHOXAZOLE^75.1~TRIMETHAPRIM/SULFA INTERP^75.2~TRIMETHAPRIM/SULFA SCREEN 
"RTN","LA7UTL1B",46,0)
 ;;2.0016^80~AMIKACIN^80.1~AMIKACIN INTERP^80.2~AMIKACIN SCREEN
"RTN","LA7UTL1B",47,0)
 ;;2.0017^85~CEFAMANDOLE^85.1~CEFAMANDOLE INTERP^85.2~CEFAMANDOLE SCREEN
"RTN","LA7UTL1B",48,0)
 ;;2.0018^90~CEFOXITIN^90.1~CEFOXITIN INTERP^90.2~CEFOXITIN SCREEN
"RTN","LA7UTL1B",49,0)
 ;;2.0019^110~ERYTHROMYCIN^110.1~ERYTHROMYCIN INTERP^110.2~ERYTHROMYCIN SCREEN
"RTN","LA7UTL1B",50,0)
 ;;
"RTN","LA7UTL1B",51,0)
 ;;2.0021^95~CEFOTAXIME^95.1~CEFOTAXIME INTERP^95.2~CEFOTAXIME SCREEN
"RTN","LA7UTL1B",52,0)
 ;;2.0022^100~NITROFURANTOIN^100.1~NITROFURANTOIN NTERP^100.2~NITROFURANTOIN SCREEN
"RTN","LA7UTL1B",53,0)
 ;;2.0023^105~POLYMYXIN B^105.1~POLYMYXIN B INTERP^105.2~POLYMYXIN B SCREEN
"RTN","LA7UTL1B",54,0)
 ;;2.0024^115~RIFAMPIN^115.1~RIFAMPIN INTERP^115.2~RIFAMPIN SCREEN
"RTN","LA7UTL1B",55,0)
 ;;2.0025^120~NOVOBIOCIN^120.1~NOVOBIOCIN INTERP^120.2~NOVOBIOCIN SCREEN
"RTN","LA7UTL1B",56,0)
 ;;2.0026^125~CEFOPERAZONE^125.1~CEFOPERAZONE INTERP^125.2~CEFOPERAZONE SCREEN
"RTN","LA7UTL1B",57,0)
 ;;2.0027^130~MEZLOCILLIN^130.1~MEZLOCILLIN INTERP^130.2~MEZLOCILLIN SCREEN
"RTN","LA7UTL1B",58,0)
 ;;2.0028^135~MOXALACTAM^135.1~MOXALACTAM INTERP^135.2~MOXALACTAM SCREEN 
"RTN","LA7UTL1B",59,0)
 ;;2.0029^140~NETILMICIN^140.1~NETILMICIN INTERP^140.2~NETILMICIN SCREEN
"RTN","LA7UTL1B",60,0)
 ;;
"RTN","LA7UTL1B",61,0)
 ;;2.0031^151~SULFISOXAZOLE^151.1~SULFISOXAZOLE INTERP^151.2~SULFISOXAZOLE SCREEN
"RTN","LA7UTL1B",62,0)
 ;;2.0032^152~NAFCILLIN^152.1~NAFCILLIN INTERP^152.2~NAFCILLIN SCREEN
"RTN","LA7UTL1B",63,0)
 ;;2.0033^153~NALIDIXIC ACID^153.1~NALIDIXIC ACID INTERP^153.2~NALIDIXIC ACID SCREEN
"RTN","LA7UTL1B",64,0)
 ;;2.0034^154~CEPHALOTHIN^154.1~CEPHALOTHIN INTERP^154.2~CEPHALOTHIN SCREEN
"RTN","LA7UTL1B",65,0)
 ;;2.0035^155~COLISTIN^155.1~COLISTIN INTERP^155.2~COLISTIN SCREEN
"RTN","LA7UTL1B",66,0)
 ;;2.0036^156~METRONIDAZOLE^156.1~METRONIDAZOLE INTERP^156.2~METRONIDAZOLE SCREEN
"RTN","LA7UTL1B",67,0)
 ;;2.0037^157~CEFUROXIME^157.1~CEFUROXIME INTERP^157.2~CEFUROXIME SCREEN
"RTN","LA7UTL1B",68,0)
 ;;2.0038^158~CEFTIZOXIME^158.1~CEFTIZOXIME INTERP^158.2~CEFTIZOXIME SCREEN
"RTN","LA7UTL1B",69,0)
 ;;2.0039^159~SPECTINOMYCIN^159.1~SPECTINOMYCIN INTERP^159.2~SPECTINOMYCIN SCREEN
"RTN","LA7UTL1B",70,0)
 Q
"RTN","LA7UTL1B",71,0)
 ;
"RTN","LA7UTL1B",72,0)
 ;Pass back field name of Mycobacterium Antibiotic field.  If the 
"RTN","LA7UTL1B",73,0)
 ; Antibiotic field node is lonnger than six characters it is site 
"RTN","LA7UTL1B",74,0)
 ; specific and is not returned.
"RTN","LA7UTL1B",75,0)
 ;
"RTN","LA7UTL1B",76,0)
DECODEMB(VAL) ;  ---Decode Mycobacterium antibiotics
"RTN","LA7UTL1B",77,0)
 ;
"RTN","LA7UTL1B",78,0)
 N STR,MVAL,M1VAL
"RTN","LA7UTL1B",79,0)
 S STR=""
"RTN","LA7UTL1B",80,0)
 I $E(VAL,1,4)'="2.00" Q ""
"RTN","LA7UTL1B",81,0)
 I 'VAL Q ""
"RTN","LA7UTL1B",82,0)
 I $L(VAL)>6 Q ""
"RTN","LA7UTL1B",83,0)
 S VAL=$P(VAL,".",2)
"RTN","LA7UTL1B",84,0)
 I VAL="001" D
"RTN","LA7UTL1B",85,0)
 . S STR="2.001^50~PYRAZINAMIDE"
"RTN","LA7UTL1B",86,0)
 I $L(VAL)=4 D
"RTN","LA7UTL1B",87,0)
 . S M1VAL=+VAL
"RTN","LA7UTL1B",88,0)
 . S STR=$P($T(MBCODE+M1VAL),";;",2)
"RTN","LA7UTL1B",89,0)
 Q STR
"RTN","LA7UTL1B",90,0)
 ;
"RTN","LA7UTL1B",91,0)
MBCODE ;
"RTN","LA7UTL1B",92,0)
 ;;2.0001^5~STR
"RTN","LA7UTL1B",93,0)
 ;;2.0002^10~PAS 
"RTN","LA7UTL1B",94,0)
 ;;2.0003^15~INH
"RTN","LA7UTL1B",95,0)
 ;;2.0004^20~ETH
"RTN","LA7UTL1B",96,0)
 ;;2.0005^25~RIF
"RTN","LA7UTL1B",97,0)
 ;;2.0006^30~KANAMYCIN
"RTN","LA7UTL1B",98,0)
 ;;2.0007^35~CAPREOMYCIN 
"RTN","LA7UTL1B",99,0)
 ;;2.0008^40~CYCLOSERINE
"RTN","LA7UTL1B",100,0)
 ;;2.0009^45~ETHIONAMIDE
"RTN","LA7UTL1B",101,0)
 ;;
"RTN","LA7UTL1B",102,0)
 ;;2.0011^55~MIOMYCIN
"RTN","LA7UTL1B",103,0)
 Q
"RTN","LA7UTL1B",104,0)
 ;
"RTN","LA7UTL1B",105,0)
 ;
"RTN","LA7UTL1B",106,0)
 ;
"RTN","LA7UTL1B",107,0)
ARRANGE(LAARRAY,LAARRET) ; Re-set the global to the passed in reference and re-arrage for easier processing.
"RTN","LA7UTL1B",108,0)
 ;
"RTN","LA7UTL1B",109,0)
 F LASET="63.05","63.29","63.3","63.31","63.32","63.33","63.34","63.35","63.351","63.36","63.37","63.372","63.39","63.4","63.43","63.341","63.291","63.371","63.44" D
"RTN","LA7UTL1B",110,0)
 . S LACD=""
"RTN","LA7UTL1B",111,0)
 . F  S LACD=$O(@LAARRAY@(LASET,LACD)) Q:LACD=""  D
"RTN","LA7UTL1B",112,0)
 . . S LACDFLD=""
"RTN","LA7UTL1B",113,0)
 . . F  S LACDFLD=$O(@LAARRAY@(LASET,LACD,LACDFLD)) Q:LACDFLD=""  D
"RTN","LA7UTL1B",114,0)
 . . . S LACDTYP=""
"RTN","LA7UTL1B",115,0)
 . . . F  S LACDTYP=$O(@LAARRAY@(LASET,LACD,LACDFLD,LACDTYP)) Q:LACDTYP=""  D
"RTN","LA7UTL1B",116,0)
 . . . . S LADATA=@LAARRAY@(LASET,LACD,LACDFLD,LACDTYP)
"RTN","LA7UTL1B",117,0)
 . . . . ;
"RTN","LA7UTL1B",118,0)
 . . . . I LASET="63.05" D  Q
"RTN","LA7UTL1B",119,0)
 . . . . . S @LAARRET@($P(LACD,",",2),$P(LACD,",",1),"0",LACDFLD,LACDTYP)=LADATA Q
"RTN","LA7UTL1B",120,0)
 . . . . ;
"RTN","LA7UTL1B",121,0)
 . . . . I LASET="63.351" D  Q
"RTN","LA7UTL1B",122,0)
 . . . . . S @LAARRET@($P(LACD,",",5),$P(LACD,",",4),"6",$P(LACD,",",3),"1",$P(LACD,",",2),"1",$P(LACD,",",1),"0",LACDFLD,LACDTYP)=LADATA Q
"RTN","LA7UTL1B",123,0)
 . . . . ;
"RTN","LA7UTL1B",124,0)
 . . . . I LASET="63.32" D  Q
"RTN","LA7UTL1B",125,0)
 . . . . . S @LAARRET@($P(LACD,",",4),$P(LACD,",",3),3,$P(LACD,",",2),3,$P(LACD,",",1),"0",LACDFLD,LACDTYP)=LADATA Q
"RTN","LA7UTL1B",126,0)
 . . . . ;
"RTN","LA7UTL1B",127,0)
 . . . . I LASET="63.31"!(LASET="63.35")!(LASET="63.372")!(LASET="63.4") D  Q
"RTN","LA7UTL1B",128,0)
 . . . . . S LASUB=$S(LASET="63.31":"3",LASET="63.35":"6",LASET="63.372":"9",LASET="63.4":"12",1:"")
"RTN","LA7UTL1B",129,0)
 . . . . . I LASUB="" Q
"RTN","LA7UTL1B",130,0)
 . . . . . S @LAARRET@($P(LACD,",",4),$P(LACD,",",3),LASUB,$P(LACD,",",2),"1",$P(LACD,",",1),"0",LACDFLD,LACDTYP)=LADATA Q
"RTN","LA7UTL1B",131,0)
 . . . . ;
"RTN","LA7UTL1B",132,0)
 . . . . S LASUB=$S(LASET="63.29":"2",LASET="63.3":"3",LASET="63.33":"4",LASET="63.34":"6",LASET="63.36":"7",LASET="63.37":"9",1:"")
"RTN","LA7UTL1B",133,0)
 . . . . I LASUB="" S LASUB=$S(LASET="63.39":"12",LASET="63.43":"17",LASET="63.341":"24",LASET="63.291":"25",LASET="63.371":"15",LASET="63.44":"18",1:"")
"RTN","LA7UTL1B",134,0)
 . . . . I LASUB="" Q
"RTN","LA7UTL1B",135,0)
 . . . . S @LAARRET@($P(LACD,",",3),$P(LACD,",",2),LASUB,$P(LACD,",",1),0,LACDFLD,LACDTYP)=LADATA
"RTN","LA7UTL1B",136,0)
 ;
"RTN","LA7UTL1B",137,0)
 ; - Kill local array
"RTN","LA7UTL1B",138,0)
 K @LAARRAY
"RTN","LA7UTL1B",139,0)
 Q
"RTN","LA7UTL1B",140,0)
 ;
"RTN","LA7UTL1B",141,0)
 ;
"RTN","LA7UTL1C")
0^5^B85941702
"RTN","LA7UTL1C",1,0)
LA7UTL1C ;HOIFO/BH - Microbiology Query Utility ; 3/11/03 10:45am
"RTN","LA7UTL1C",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**69**;Sep 27, 1994
"RTN","LA7UTL1C",3,0)
 ;
"RTN","LA7UTL1C",4,0)
 ;
"RTN","LA7UTL1C",5,0)
MI(LRDFN,LRIDT,LAARRAY) ; Get Microbiology data
"RTN","LA7UTL1C",6,0)
 ; Get top node data
"RTN","LA7UTL1C",7,0)
 ;
"RTN","LA7UTL1C",8,0)
 N LACOMIEN,LAGETIEN,LAGSIEN,LAIEN,LAORGIEN,LAPARIEN,LAPRIEN,LAREMIEN,LASCCOM,LASCIEN,LAFIXANT,LAFCOM,LAFUNIEN,LAMBIEN,LAMBCOM,LAFIXMB,LAMBFLD,LAMBFLD1,LACNT1,LAMBRES,LAVIEN
"RTN","LA7UTL1C",9,0)
 N LAGETS,LAGETIEN,LAMFLD,LAANTIEN,LACMANTI,LABSPIEN,LAPSPIEN,LAMSPIEN,LAVRRIEN
"RTN","LA7UTL1C",10,0)
 ;
"RTN","LA7UTL1C",11,0)
 S LAIEN=LRIDT_","_LRDFN
"RTN","LA7UTL1C",12,0)
 K LARET,LAERR
"RTN","LA7UTL1C",13,0)
 D GETS^DIQ(63.05,LAIEN,".01;.05;.055;.06;11.51;11.57;11.58;22:23;24;25;.99","IE","LARET","LAERR")
"RTN","LA7UTL1C",14,0)
 I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",15,0)
 M @LAARRAY=LARET
"RTN","LA7UTL1C",16,0)
 K LARET,LAERR
"RTN","LA7UTL1C",17,0)
 ;
"RTN","LA7UTL1C",18,0)
 ; Get Bact RPT Remark
"RTN","LA7UTL1C",19,0)
 S LAREMIEN=0
"RTN","LA7UTL1C",20,0)
 F  S LAREMIEN=$O(^LR(LRDFN,"MI",LRIDT,4,LAREMIEN)) Q:'LAREMIEN  D
"RTN","LA7UTL1C",21,0)
 . S LAGETIEN=LAREMIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",22,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",23,0)
 . D GETS^DIQ(63.33,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",24,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",25,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",26,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",27,0)
 ;
"RTN","LA7UTL1C",28,0)
 ; Get Gram Stain
"RTN","LA7UTL1C",29,0)
 S LAGSIEN=0
"RTN","LA7UTL1C",30,0)
 F  S LAGSIEN=$O(^LR(LRDFN,"MI",LRIDT,2,LAGSIEN)) Q:'LAGSIEN  D
"RTN","LA7UTL1C",31,0)
 . S LAGETIEN=LAGSIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",32,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",33,0)
 . D GETS^DIQ(63.29,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",34,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",35,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",36,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",37,0)
 ;
"RTN","LA7UTL1C",38,0)
 ; Get Organism data
"RTN","LA7UTL1C",39,0)
 S LAORGIEN=0
"RTN","LA7UTL1C",40,0)
 F  S LAORGIEN=$O(^LR(LRDFN,"MI",LRIDT,3,LAORGIEN)) Q:'LAORGIEN  D
"RTN","LA7UTL1C",41,0)
 . S LAGETIEN=LAORGIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",42,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",43,0)
 . D GETS^DIQ(63.3,LAGETIEN,".01;1","IE","LARET","LAERR")
"RTN","LA7UTL1C",44,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",45,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",46,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",47,0)
 . S LACOMIEN=0
"RTN","LA7UTL1C",48,0)
 . F  S LACOMIEN=$O(^LR(LRDFN,"MI",LRIDT,3,LAORGIEN,1,LACOMIEN)) Q:'LACOMIEN  D
"RTN","LA7UTL1C",49,0)
 . . S LAGETIEN=LACOMIEN_","_LAORGIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",50,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",51,0)
 . . D GETS^DIQ(63.31,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",52,0)
 . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",53,0)
 . . M @LAARRAY=LARET
"RTN","LA7UTL1C",54,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",55,0)
 . ;
"RTN","LA7UTL1C",56,0)
 . ;
"RTN","LA7UTL1C",57,0)
 . S LAFIXANT=2
"RTN","LA7UTL1C",58,0)
 . F  S LAFIXANT=$O(^LR(LRDFN,"MI",LRIDT,3,LAORGIEN,LAFIXANT)) Q:'LAFIXANT!(LAFIXANT'<3)  D
"RTN","LA7UTL1C",59,0)
 . . Q:$E(LAFIXANT,1,4)'="2.00"
"RTN","LA7UTL1C",60,0)
 . . S LAGETIEN=LAORGIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",61,0)
 . . I $L(LAFIXANT)<7 D
"RTN","LA7UTL1C",62,0)
 . . . S LAMFLD=$$DECODE^LA7UTL1B(LAFIXANT)
"RTN","LA7UTL1C",63,0)
 . . . I LAMFLD="" Q
"RTN","LA7UTL1C",64,0)
 . . . N LACNT1,LACNT,LAVAL,LA7ARR1,LAMFLD2,LAIN,LAMFLD3,LAMFLD4
"RTN","LA7UTL1C",65,0)
 . . . F LACNT=2,3,4 D
"RTN","LA7UTL1C",66,0)
 . . . . S LAVAL=$P(LAMFLD,U,LACNT)
"RTN","LA7UTL1C",67,0)
 . . . . S LAIN="LAMFLD"_LACNT
"RTN","LA7UTL1C",68,0)
 . . . . S @LAIN=$P(LAVAL,"~")
"RTN","LA7UTL1C",69,0)
 . . . . S LA7ARR1(@LAIN)=$P(LAVAL,"~",2)
"RTN","LA7UTL1C",70,0)
 . . . . ;
"RTN","LA7UTL1C",71,0)
 . . . K LARET,LAERR
"RTN","LA7UTL1C",72,0)
 . . . D GETS^DIQ(63.3,LAGETIEN,LAMFLD2_";"_LAMFLD3_";"_LAMFLD4,"IE","LARET","LAERR")
"RTN","LA7UTL1C",73,0)
 . . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",74,0)
 . . . S LACNT1=0
"RTN","LA7UTL1C",75,0)
 . . . S LAGETIEN=LAGETIEN_","
"RTN","LA7UTL1C",76,0)
 . . . F  S LACNT1=$O(LA7ARR1(LACNT1)) Q:'LACNT1  D
"RTN","LA7UTL1C",77,0)
 . . . . N LARES
"RTN","LA7UTL1C",78,0)
 . . . . S LARES=$G(LARET(63.3,LAGETIEN,LACNT1,"I"))
"RTN","LA7UTL1C",79,0)
 . . . . I LARES="" K LARET(63.3,LAGETIEN,LACNT1) Q
"RTN","LA7UTL1C",80,0)
 . . . . S LARET(63.3,LAGETIEN,LACNT1,"I")=LA7ARR1(LACNT1)_U_LARES
"RTN","LA7UTL1C",81,0)
 . . . M @LAARRAY=LARET
"RTN","LA7UTL1C",82,0)
 . . . ;
"RTN","LA7UTL1C",83,0)
 . . . ;
"RTN","LA7UTL1C",84,0)
 . . I $L(LAFIXANT)>6 D
"RTN","LA7UTL1C",85,0)
 . . . N LACNT2,LANAME,LATEST,LARET,LAERR,LARES
"RTN","LA7UTL1C",86,0)
 . . . D FIELD^DID(63.3,LAFIXANT,"","LABEL","LATEST")
"RTN","LA7UTL1C",87,0)
 . . . I '$D(LATEST("LABEL")) Q
"RTN","LA7UTL1C",88,0)
 . . . S LANAME=LATEST("LABEL")
"RTN","LA7UTL1C",89,0)
 . . . ;
"RTN","LA7UTL1C",90,0)
 . . . D GETS^DIQ(63.3,LAGETIEN,LAFIXANT_";"_LAFIXANT_"1;"_LAFIXANT_"2","IE","LARET","LAERR")
"RTN","LA7UTL1C",91,0)
 . . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",92,0)
 . . . S LAGETIEN=LAGETIEN_","
"RTN","LA7UTL1C",93,0)
 . . . S LARES=$G(LARET(63.3,LAGETIEN,LAFIXANT,"I"))
"RTN","LA7UTL1C",94,0)
 . . . S:LARES'="" LARET(63.3,LAGETIEN,LAFIXANT,"I")=LANAME_U_LARES
"RTN","LA7UTL1C",95,0)
 . . . I LARES="" K LARET(63.3,LAGETIEN,LAFIXANT)
"RTN","LA7UTL1C",96,0)
 . . . F LACNT2=1,2 D
"RTN","LA7UTL1C",97,0)
 . . . . K LATEST
"RTN","LA7UTL1C",98,0)
 . . . . D FIELD^DID(63.3,LAFIXANT_LACNT2,"","LABEL","LATEST")
"RTN","LA7UTL1C",99,0)
 . . . . I '$D(LATEST("LABEL")) Q
"RTN","LA7UTL1C",100,0)
 . . . . S LANAME=LATEST("LABEL")
"RTN","LA7UTL1C",101,0)
 . . . . S LARES=$G(LARET(63.3,LAGETIEN,LAFIXANT_LACNT2,"I"))
"RTN","LA7UTL1C",102,0)
 . . . . I LARES="" K LARET(63.3,LAGETIEN,LAFIXANT_LACNT2) Q
"RTN","LA7UTL1C",103,0)
 . . . . S LARET(63.3,LAGETIEN,LAFIXANT_LACNT2,"I")=LANAME_U_LARES
"RTN","LA7UTL1C",104,0)
 . . . M @LAARRAY=LARET
"RTN","LA7UTL1C",105,0)
 . ;
"RTN","LA7UTL1C",106,0)
 . S LACMANTI=0
"RTN","LA7UTL1C",107,0)
 . F  S LACMANTI=$O(^LR(LRDFN,"MI",LRIDT,3,LAORGIEN,3,LACMANTI)) Q:'LACMANTI  D
"RTN","LA7UTL1C",108,0)
 . . S LAANTIEN=LACMANTI_","_LAORGIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",109,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",110,0)
 . . D GETS^DIQ(63.32,LAANTIEN,".01;1;2","IE","LARET","LAERR")
"RTN","LA7UTL1C",111,0)
 . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",112,0)
 . . M @LAARRAY=LARET
"RTN","LA7UTL1C",113,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",114,0)
 ;
"RTN","LA7UTL1C",115,0)
 ;
"RTN","LA7UTL1C",116,0)
 ; Get Parasite data
"RTN","LA7UTL1C",117,0)
 S LAPARIEN=0
"RTN","LA7UTL1C",118,0)
 F  S LAPARIEN=$O(^LR(LRDFN,"MI",LRIDT,6,LAPARIEN)) Q:'LAPARIEN  D
"RTN","LA7UTL1C",119,0)
 . S LAGETIEN=LAPARIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",120,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",121,0)
 . D GETS^DIQ(63.34,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",122,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",123,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",124,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",125,0)
 . ; - Get stage code data
"RTN","LA7UTL1C",126,0)
 . S LASCIEN=0
"RTN","LA7UTL1C",127,0)
 . F  S LASCIEN=$O(^LR(LRDFN,"MI",LRIDT,6,LAPARIEN,1,LASCIEN)) Q:'LASCIEN  D
"RTN","LA7UTL1C",128,0)
 . . S LAGETIEN=LASCIEN_","_LAPARIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",129,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",130,0)
 . . D GETS^DIQ(63.35,LAGETIEN,".01;1","IE","LARET","LAERR")
"RTN","LA7UTL1C",131,0)
 . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",132,0)
 . . M @LAARRAY=LARET
"RTN","LA7UTL1C",133,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",134,0)
 . . ; - Get stage code comments 
"RTN","LA7UTL1C",135,0)
 . . S LASCCOM=0
"RTN","LA7UTL1C",136,0)
 . . F  S LASCCOM=$O(^LR(LRDFN,"MI",LRIDT,6,LAPARIEN,1,LASCIEN,1,LASCCOM)) Q:'LASCCOM  D
"RTN","LA7UTL1C",137,0)
 . . . S LAGETIEN=LASCCOM_","_LASCIEN_","_LAPARIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",138,0)
 . . . K LARET,LAERR
"RTN","LA7UTL1C",139,0)
 . . . D GETS^DIQ(63.351,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",140,0)
 . . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",141,0)
 . . . M @LAARRAY=LARET
"RTN","LA7UTL1C",142,0)
 . . . K LARET,LAERR
"RTN","LA7UTL1C",143,0)
 ;
"RTN","LA7UTL1C",144,0)
 ; - Get Parasite Remarks
"RTN","LA7UTL1C",145,0)
 S LAPRIEN=0
"RTN","LA7UTL1C",146,0)
 F  S LAPRIEN=$O(^LR(LRDFN,"MI",LRIDT,7,LAPRIEN)) Q:'LAPRIEN  D
"RTN","LA7UTL1C",147,0)
 . S LAGETIEN=LAPRIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",148,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",149,0)
 . D GETS^DIQ(63.36,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",150,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",151,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",152,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",153,0)
 ;
"RTN","LA7UTL1C",154,0)
 ; ---Fungus Yeast
"RTN","LA7UTL1C",155,0)
 S LAFUNIEN=0
"RTN","LA7UTL1C",156,0)
 F  S LAFUNIEN=$O(^LR(LRDFN,"MI",LRIDT,9,LAFUNIEN)) Q:'LAFUNIEN  D
"RTN","LA7UTL1C",157,0)
 . S LAGETIEN=LAFUNIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",158,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",159,0)
 . D GETS^DIQ(63.37,LAGETIEN,".01;1","IE","LARET","LAERR")
"RTN","LA7UTL1C",160,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",161,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",162,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",163,0)
 . S LAFCOM=0
"RTN","LA7UTL1C",164,0)
 . F  S LAFCOM=$O(^LR(LRDFN,"MI",LRIDT,9,LAFUNIEN,1,LAFCOM)) Q:'LAFCOM  D
"RTN","LA7UTL1C",165,0)
 . . S LAGETIEN=LAFCOM_","_LAFUNIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",166,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",167,0)
 . . D GETS^DIQ(63.372,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",168,0)
 . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",169,0)
 . . M @LAARRAY=LARET
"RTN","LA7UTL1C",170,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",171,0)
 ;
"RTN","LA7UTL1C",172,0)
 ; ---Mycobacteruim
"RTN","LA7UTL1C",173,0)
 ;
"RTN","LA7UTL1C",174,0)
 S LAMBIEN=0
"RTN","LA7UTL1C",175,0)
 F  S LAMBIEN=$O(^LR(LRDFN,"MI",LRIDT,12,LAMBIEN)) Q:'LAMBIEN  D
"RTN","LA7UTL1C",176,0)
 . S LAGETIEN=LAMBIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",177,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",178,0)
 . D GETS^DIQ(63.39,LAGETIEN,".01;1","IE","LARET","LAERR")
"RTN","LA7UTL1C",179,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",180,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",181,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",182,0)
 . S LAMBCOM=0
"RTN","LA7UTL1C",183,0)
 . F  S LAMBCOM=$O(^LR(LRDFN,"MI",LRIDT,12,LAMBIEN,1,LAMBCOM)) Q:'LAMBCOM  D
"RTN","LA7UTL1C",184,0)
 . . S LAGETIEN=LAMBCOM_","_LAMBIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",185,0)
 . . K LARET,LAERR
"RTN","LA7UTL1C",186,0)
 . . D GETS^DIQ(63.4,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",187,0)
 . . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",188,0)
 . . M @LAARRAY=LARET
"RTN","LA7UTL1C",189,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",190,0)
 . S LAFIXMB=2
"RTN","LA7UTL1C",191,0)
 . S LAGETIEN=LAMBIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",192,0)
 . F  S LAFIXMB=$O(^LR(LRDFN,"MI",LRIDT,12,LAMBIEN,LAFIXMB)) Q:'LAFIXMB!(LAFIXMB'<3)  D
"RTN","LA7UTL1C",193,0)
 . . Q:$E(LAFIXMB,1,4)'="2.00"
"RTN","LA7UTL1C",194,0)
 . . I $L(LAFIXMB)<7 D
"RTN","LA7UTL1C",195,0)
 . . . S LAMBFLD=$P($$DECODEMB^LA7UTL1B(LAFIXMB),U,2)
"RTN","LA7UTL1C",196,0)
 . . . I LAMBFLD="" Q
"RTN","LA7UTL1C",197,0)
 . . . S LAMBFLD1=$P(LAMBFLD,"~",2)
"RTN","LA7UTL1C",198,0)
 . . . S LAMBFLD=$P(LAMBFLD,"~",1)
"RTN","LA7UTL1C",199,0)
 . . . K LARET,LAERR
"RTN","LA7UTL1C",200,0)
 . . . D GETS^DIQ(63.39,LAGETIEN,LAMBFLD,"IE","LARET","LAERR")
"RTN","LA7UTL1C",201,0)
 . . . ;
"RTN","LA7UTL1C",202,0)
 . . . I $D(LAERR("DIERR"))!('$D(LARET)) K LARET,LAERR Q
"RTN","LA7UTL1C",203,0)
 . . . ;
"RTN","LA7UTL1C",204,0)
 . . . S LAGETS=LAGETIEN_","
"RTN","LA7UTL1C",205,0)
 . . . S LAMBRES=$G(LARET(63.39,LAGETS,LAMBFLD,"I"))
"RTN","LA7UTL1C",206,0)
 . . . I LAMBRES="" K LARET(63.39,LAGETS,LAMBFLD) Q
"RTN","LA7UTL1C",207,0)
 . . . S LARET(63.39,LAGETS,LAMBFLD,"I")=LAMBFLD1_U_LAMBRES
"RTN","LA7UTL1C",208,0)
 . . . M @LAARRAY=LARET
"RTN","LA7UTL1C",209,0)
 . . . ;
"RTN","LA7UTL1C",210,0)
 . . . ;
"RTN","LA7UTL1C",211,0)
 . . I $L(LAFIXMB)>6 D
"RTN","LA7UTL1C",212,0)
 . . . N LANAME,LATEST,LARET,LAERR,LAMBRES
"RTN","LA7UTL1C",213,0)
 . . . D FIELD^DID(63.39,LAFIXMB,"","LABEL","LATEST")
"RTN","LA7UTL1C",214,0)
 . . . I '$D(LATEST("LABEL")) Q
"RTN","LA7UTL1C",215,0)
 . . . S LANAME=LATEST("LABEL")
"RTN","LA7UTL1C",216,0)
 . . . K LARET,LAERR
"RTN","LA7UTL1C",217,0)
 . . . D GETS^DIQ(63.39,LAGETIEN,LAFIXMB,"IE","LARET","LAERR")
"RTN","LA7UTL1C",218,0)
 . . . ;
"RTN","LA7UTL1C",219,0)
 . . . I $D(LAERR("DIERR"))!('$D(LARET)) K LAERR Q
"RTN","LA7UTL1C",220,0)
 . . . S LAGETS=LAGETIEN_","
"RTN","LA7UTL1C",221,0)
 . . . S LAMBRES=$G(LARET(63.39,LAGETS,LAFIXMB,"I"))
"RTN","LA7UTL1C",222,0)
 . . . I LAMBRES="" K LARET(63.39,LAGETS,LAFIXMB) Q
"RTN","LA7UTL1C",223,0)
 . . . S:LAMBRES'="" LARET(63.39,LAGETS,LAFIXMB,"I")=LANAME_U_LAMBRES
"RTN","LA7UTL1C",224,0)
 . . . M @LAARRAY=LARET
"RTN","LA7UTL1C",225,0)
 ;
"RTN","LA7UTL1C",226,0)
 ; ---Virus
"RTN","LA7UTL1C",227,0)
 ;
"RTN","LA7UTL1C",228,0)
 S LAVIEN=0
"RTN","LA7UTL1C",229,0)
 F  S LAVIEN=$O(^LR(LRDFN,"MI",LRIDT,17,LAVIEN)) Q:'LAVIEN  D
"RTN","LA7UTL1C",230,0)
 . S LAGETIEN=LAVIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",231,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",232,0)
 . D GETS^DIQ(63.43,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",233,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",234,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",235,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",236,0)
 ;
"RTN","LA7UTL1C",237,0)
 ; ---Parasitology Smear/Prep
"RTN","LA7UTL1C",238,0)
 ;
"RTN","LA7UTL1C",239,0)
 S LAPSPIEN=0
"RTN","LA7UTL1C",240,0)
 F  S LAPSPIEN=$O(^LR(LRDFN,"MI",LRIDT,24,LAPSPIEN)) Q:'LAPSPIEN  D
"RTN","LA7UTL1C",241,0)
 . S LAGETIEN=LAPSPIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",242,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",243,0)
 . D GETS^DIQ(63.341,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",244,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",245,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",246,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",247,0)
 ;
"RTN","LA7UTL1C",248,0)
 ; ---Bacteriology Smear/Prep
"RTN","LA7UTL1C",249,0)
 ;
"RTN","LA7UTL1C",250,0)
 S LABSPIEN=0
"RTN","LA7UTL1C",251,0)
 F  S LABSPIEN=$O(^LR(LRDFN,"MI",LRIDT,25,LABSPIEN)) Q:'LABSPIEN  D
"RTN","LA7UTL1C",252,0)
 . S LAGETIEN=LABSPIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",253,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",254,0)
 . D GETS^DIQ(63.291,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",255,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",256,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",257,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",258,0)
 ;
"RTN","LA7UTL1C",259,0)
 ; ---Mycology Smear/Prep
"RTN","LA7UTL1C",260,0)
 ;
"RTN","LA7UTL1C",261,0)
 S LAMSPIEN=0
"RTN","LA7UTL1C",262,0)
 F  S LAMSPIEN=$O(^LR(LRDFN,"MI",LRIDT,15,LAMSPIEN)) Q:'LAMSPIEN  D
"RTN","LA7UTL1C",263,0)
 . S LAGETIEN=LAMSPIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",264,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",265,0)
 . D GETS^DIQ(63.371,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",266,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",267,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",268,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",269,0)
 ;
"RTN","LA7UTL1C",270,0)
 ; ---Virology RPT
"RTN","LA7UTL1C",271,0)
 ;
"RTN","LA7UTL1C",272,0)
 S LAVRRIEN=0
"RTN","LA7UTL1C",273,0)
 F  S LAVRRIEN=$O(^LR(LRDFN,"MI",LRIDT,18,LAVRRIEN)) Q:'LAVRRIEN  D
"RTN","LA7UTL1C",274,0)
 . S LAGETIEN=LAVRRIEN_","_LRIDT_","_LRDFN
"RTN","LA7UTL1C",275,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",276,0)
 . D GETS^DIQ(63.44,LAGETIEN,".01","IE","LARET","LAERR")
"RTN","LA7UTL1C",277,0)
 . I $D(LAERR("DIERR")) K LAERR Q
"RTN","LA7UTL1C",278,0)
 . M @LAARRAY=LARET
"RTN","LA7UTL1C",279,0)
 . K LARET,LAERR
"RTN","LA7UTL1C",280,0)
 ;
"RTN","LA7UTL1C",281,0)
 Q
"RTN","LA7UTL1C",282,0)
 ;
"VER")
8.0^22
**END**
**END**
