Released EAS*1*74 SEQ #62
Extracted from mail message
**KIDS**:EAS*1.0*74^

**INSTALL NAME**
EAS*1.0*74
"BLD",6254,0)
EAS*1.0*74^ENROLLMENT APPLICATION SYSTEM^0^3060711^y
"BLD",6254,1,0)
^^1^1^3060711^
"BLD",6254,1,1,0)
Fix Z06 Delete Logic
"BLD",6254,4,0)
^9.64PA^^
"BLD",6254,6.3)
6
"BLD",6254,"KRN",0)
^9.67PA^8989.52^19
"BLD",6254,"KRN",.4,0)
.4
"BLD",6254,"KRN",.401,0)
.401
"BLD",6254,"KRN",.402,0)
.402
"BLD",6254,"KRN",.403,0)
.403
"BLD",6254,"KRN",.5,0)
.5
"BLD",6254,"KRN",.84,0)
.84
"BLD",6254,"KRN",3.6,0)
3.6
"BLD",6254,"KRN",3.8,0)
3.8
"BLD",6254,"KRN",9.2,0)
9.2
"BLD",6254,"KRN",9.8,0)
9.8
"BLD",6254,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6254,"KRN",9.8,"NM",1,0)
EASUM7^^0^B34906641
"BLD",6254,"KRN",9.8,"NM","B","EASUM7",1)

"BLD",6254,"KRN",19,0)
19
"BLD",6254,"KRN",19.1,0)
19.1
"BLD",6254,"KRN",101,0)
101
"BLD",6254,"KRN",409.61,0)
409.61
"BLD",6254,"KRN",771,0)
771
"BLD",6254,"KRN",870,0)
870
"BLD",6254,"KRN",8989.51,0)
8989.51
"BLD",6254,"KRN",8989.52,0)
8989.52
"BLD",6254,"KRN",8994,0)
8994
"BLD",6254,"KRN","B",.4,.4)

"BLD",6254,"KRN","B",.401,.401)

"BLD",6254,"KRN","B",.402,.402)

"BLD",6254,"KRN","B",.403,.403)

"BLD",6254,"KRN","B",.5,.5)

"BLD",6254,"KRN","B",.84,.84)

"BLD",6254,"KRN","B",3.6,3.6)

"BLD",6254,"KRN","B",3.8,3.8)

"BLD",6254,"KRN","B",9.2,9.2)

"BLD",6254,"KRN","B",9.8,9.8)

"BLD",6254,"KRN","B",19,19)

"BLD",6254,"KRN","B",19.1,19.1)

"BLD",6254,"KRN","B",101,101)

"BLD",6254,"KRN","B",409.61,409.61)

"BLD",6254,"KRN","B",771,771)

"BLD",6254,"KRN","B",870,870)

"BLD",6254,"KRN","B",8989.51,8989.51)

"BLD",6254,"KRN","B",8989.52,8989.52)

"BLD",6254,"KRN","B",8994,8994)

"BLD",6254,"QUES",0)
^9.62^^
"BLD",6254,"REQB",0)
^9.611^1^1
"BLD",6254,"REQB",1,0)
EAS*1.0*42^2
"BLD",6254,"REQB","B","EAS*1.0*42",1)

"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^1^1
"PKG",552,20,1,0)
2^^EASXDR
"PKG",552,20,1,1)
 
"PKG",552,20,"B",2,1)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010410^66481
"PKG",552,22,1,"PAH",1,0)
74^3060711
"PKG",552,22,1,"PAH",1,1,0)
^^1^1^3060711
"PKG",552,22,1,"PAH",1,1,1,0)
Fix Z06 Delete Logic
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","EASUM7")
0^1^B34906641^B34406080
"RTN","EASUM7",1,0)
EASUM7 ;ALB/GN,EG - DELETE IVM MEANS TEST ; 07/07/2006
"RTN","EASUM7",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**42,74**;21-OCT-94;Build 6
"RTN","EASUM7",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","EASUM7",4,0)
 ;
"RTN","EASUM7",5,0)
 ;EAS*1*42 This routine patterned after IVMUM7.
"RTN","EASUM7",6,0)
 ;
"RTN","EASUM7",7,0)
EN ; this routine will process an IVM MT/CT delete request
"RTN","EASUM7",8,0)
 ; from the IVM Center.
"RTN","EASUM7",9,0)
 ;
"RTN","EASUM7",10,0)
 ; delete IVM MT/CT records in the following files:
"RTN","EASUM7",11,0)
 ;     408.22
"RTN","EASUM7",12,0)
 ;     408.21
"RTN","EASUM7",13,0)
 ;
"RTN","EASUM7",14,0)
 ;     408.12 & 408.13 if IVM dependent
"RTN","EASUM7",15,0)
 ;               or
"RTN","EASUM7",16,0)
 ;     408.1275 if IVM & VAMC dependent (new 408.1275 record was
"RTN","EASUM7",17,0)
 ;              created for each IVM dependent by upload). 
"RTN","EASUM7",18,0)
 ;              change back the following fields to VAMC values
"RTN","EASUM7",19,0)
 ;              from IVM values:
"RTN","EASUM7",20,0)
 ;                 408.12  - relationship
"RTN","EASUM7",21,0)
 ;                 408.13  - name, dob, ssn, sex
"RTN","EASUM7",22,0)
 ;               or
"RTN","EASUM7",23,0)
 ;     408.1275 if VAMC dependent (new inactivated 408.1275 record
"RTN","EASUM7",24,0)
 ;              was created by upload).
"RTN","EASUM7",25,0)
 ;
"RTN","EASUM7",26,0)
 ;     408.31
"RTN","EASUM7",27,0)
 ;
"RTN","EASUM7",28,0)
 ; the "PRIM" node for the VAMC MT will be changed to 1 
"RTN","EASUM7",29,0)
 ;
"RTN","EASUM7",30,0)
 ; the event driver will be called twice
"RTN","EASUM7",31,0)
 ;    DGMTACT="DUP"
"RTN","EASUM7",32,0)
 ;    DGMTACT="DEL"
"RTN","EASUM7",33,0)
 ;
"RTN","EASUM7",34,0)
 ;
"RTN","EASUM7",35,0)
 ;     Input       IVMMTDT      MT date
"RTN","EASUM7",36,0)
 ;                 IVMMTIEN     primary MT IEN
"RTN","EASUM7",37,0)
 ;
"RTN","EASUM7",38,0)
 ; check primary test is IVM
"RTN","EASUM7",39,0)
 S IVMNO=$G(^DGMT(408.31,IVMMTIEN,0)) ; ivm mt 0th node  
"RTN","EASUM7",40,0)
 S IVMSOT=$P($G(^DG(408.34,+$P(IVMNO,"^",23),0)),"^") ; source of test
"RTN","EASUM7",41,0)
 I IVMSOT'="IVM" D  Q
"RTN","EASUM7",42,0)
 .S HLERR="IVM "_^DG(408.33,DGMTYPT,0)_" for income year "_($E(DGLY,1,3)+1700)_" not found"
"RTN","EASUM7",43,0)
 .D ACK^IVMPREC
"RTN","EASUM7",44,0)
 ;
"RTN","EASUM7",45,0)
 ; get VAMC MT/CT via AD xref (by type) to be re-instated    ;EAS*1*42
"RTN","EASUM7",46,0)
 S IVMVAMC="A" ; ivmvamc is vamc ien
"RTN","EASUM7",47,0)
 ;make sure you get the latest test of that type for that date first
"RTN","EASUM7",48,0)
 F  S IVMVAMC=$O(^DGMT(408.31,"AD",DGMTYPT,DFN,IVMMTDT,IVMVAMC),-1) Q:'IVMVAMC  D  Q:$D(IVMVNO)
"RTN","EASUM7",49,0)
 . S IVMVNO=$G(^DGMT(408.31,+IVMVAMC,0)) ; vamc 0th node
"RTN","EASUM7",50,0)
 . S IVMSOT=$P($G(^DG(408.34,+$P(IVMVNO,"^",23),0)),"^") ; source of test
"RTN","EASUM7",51,0)
 . I IVMSOT'="VAMC",IVMSOT'="DCD",IVMSOT'="OTHER FACILITY" K IVMVNO Q
"RTN","EASUM7",52,0)
 . Q
"RTN","EASUM7",53,0)
 ;
"RTN","EASUM7",54,0)
 ; if no previous VAMC RXCT (type 2) on file, then          ;EAS*1*42
"RTN","EASUM7",55,0)
 ; simply delete the IVM RX converted 408.31 record
"RTN","EASUM7",56,0)
 I '$D(IVMVNO),DGMTYPT=2 D EN1^EASUM8 Q
"RTN","EASUM7",57,0)
 ;
"RTN","EASUM7",58,0)
 ; if no VAMC MT type 1, then error
"RTN","EASUM7",59,0)
 I '$D(IVMVNO) D  Q
"RTN","EASUM7",60,0)
 .S HLERR=IVMSOT_^DG(408.33,DGMTYPT,0)_" for income year "_($E(DGLY,1,3)+1700)_" not found"
"RTN","EASUM7",61,0)
 .D ACK^IVMPREC
"RTN","EASUM7",62,0)
 ;
"RTN","EASUM7",63,0)
 ; get array dginc containing ien(s) of 408.21
"RTN","EASUM7",64,0)
 ; get array dginr containing ien(s) of 408.22
"RTN","EASUM7",65,0)
 D ALL^DGMTU21(DFN,"VSC",IVMMTDT,"IR",IVMMTIEN)
"RTN","EASUM7",66,0)
 ;
"RTN","EASUM7",67,0)
 ; delete 408.22
"RTN","EASUM7",68,0)
 ;
"RTN","EASUM7",69,0)
 S DA=$G(DGINR("V")) D
"RTN","EASUM7",70,0)
 .Q:'DA  S DIK="^DGMT(408.22," D ^DIK
"RTN","EASUM7",71,0)
 S DA=$G(DGINR("S")) D
"RTN","EASUM7",72,0)
 .Q:'DA  S DIK="^DGMT(408.22," D ^DIK
"RTN","EASUM7",73,0)
 S IVMN=0
"RTN","EASUM7",74,0)
 F  S IVMN=$O(DGINR("C",IVMN)) Q:'IVMN  S DA=$G(DGINR("C",IVMN)),DIK="^DGMT(408.22," D ^DIK
"RTN","EASUM7",75,0)
 ;
"RTN","EASUM7",76,0)
 ; delete 408.21
"RTN","EASUM7",77,0)
 ;
"RTN","EASUM7",78,0)
 S DA=$G(DGINC("V")) D
"RTN","EASUM7",79,0)
 .Q:'DA  S DIK="^DGMT(408.21," D ^DIK
"RTN","EASUM7",80,0)
 S DA=$G(DGINC("S")) D
"RTN","EASUM7",81,0)
 .Q:'DA  S DIK="^DGMT(408.21," D ^DIK
"RTN","EASUM7",82,0)
 S IVMN=0
"RTN","EASUM7",83,0)
 F  S IVMN=$O(DGINC("C",IVMN)) Q:'IVMN  S DA=$G(DGINC("C",IVMN)),DIK="^DGMT(408.21," D ^DIK
"RTN","EASUM7",84,0)
 ;
"RTN","EASUM7",85,0)
 ; logic for 408.12/408.1275 & 408.13
"RTN","EASUM7",86,0)
 ;
"RTN","EASUM7",87,0)
 D SETUPAR^EASUM8
"RTN","EASUM7",88,0)
 ;
"RTN","EASUM7",89,0)
 ; no "AIVM" x-ref means
"RTN","EASUM7",90,0)
 ;   no dependents
"RTN","EASUM7",91,0)
 ;       or
"RTN","EASUM7",92,0)
 ; IVM v2.0 means test (no dependent difference)
"RTN","EASUM7",93,0)
 ; only 408.22, 408.21, and 408.31 records will be deleted
"RTN","EASUM7",94,0)
 ;
"RTN","EASUM7",95,0)
 S IVM12="" F  S IVM12=$O(^DGPR(408.12,"AIVM",IVMMTIEN,IVM12)) Q:'IVM12  D  Q:$D(IVMFERR)
"RTN","EASUM7",96,0)
 .I $G(^DGPR(408.12,+IVM12,0))']"" D  Q
"RTN","EASUM7",97,0)
 ..S (IVMTEXT(6),HLERR)="Can't find 408.12 record "_IVM12
"RTN","EASUM7",98,0)
 ..D ERRBULL^IVMPREC7,MAIL^IVMUFNC()
"RTN","EASUM7",99,0)
 ..S IVMFERR=""
"RTN","EASUM7",100,0)
 ..D ACK^IVMPREC
"RTN","EASUM7",101,0)
 ..Q
"RTN","EASUM7",102,0)
 .;
"RTN","EASUM7",103,0)
 .I $P($G(^DGPR(408.12,+IVM12,"E",0)),"^",4)=1 D  Q
"RTN","EASUM7",104,0)
 ..; only 1 multiple record (408.1275) indicates IVM dependent
"RTN","EASUM7",105,0)
 ..; delete 408.12 & 408.13 records for IVM dependent
"RTN","EASUM7",106,0)
 ..S IVM13=$P($P($G(^DGPR(408.12,+IVM12,0)),"^",3),";") I $G(^DGPR(408.13,+IVM13,0))']"" D  Q
"RTN","EASUM7",107,0)
 ...S (IVMTEXT(6),HLERR)="Can't find 408.13 record "_IVM13
"RTN","EASUM7",108,0)
 ...D ERRBULL^IVMPREC7,MAIL^IVMUFNC()
"RTN","EASUM7",109,0)
 ...S IVMFERR=""
"RTN","EASUM7",110,0)
 ...D ACK^IVMPREC
"RTN","EASUM7",111,0)
 ...Q
"RTN","EASUM7",112,0)
 ..S DA=IVM12,DIK="^DGPR(408.12," D ^DIK K DA,DIK
"RTN","EASUM7",113,0)
 ..S DA=IVM13,DIK="^DGPR(408.13," D ^DIK K DA,DIK
"RTN","EASUM7",114,0)
 ..Q
"RTN","EASUM7",115,0)
 .;
"RTN","EASUM7",116,0)
 .; delete 408.1275 record for IVM dependent and
"RTN","EASUM7",117,0)
 .; change demo data in 408.12 & 408.13 back to VAMC values
"RTN","EASUM7",118,0)
 .;       or
"RTN","EASUM7",119,0)
 .; delete 408.1275 record for inactivated VAMC dependent
"RTN","EASUM7",120,0)
 .S IVM121="",IVM121=$O(^DGPR(408.12,"AIVM",IVMMTIEN,+IVM12,IVM121))
"RTN","EASUM7",121,0)
 .I $G(^DGPR(408.12,+IVM12,"E",+IVM121,0))']"" D  Q
"RTN","EASUM7",122,0)
 ..S (IVMTEXT(6),HLERR)="Can't find 408.1275 record "_IVM12_"  "_IVM121
"RTN","EASUM7",123,0)
 ..D ERRBULL^IVMPREC7,MAIL^IVMUFNC()
"RTN","EASUM7",124,0)
 ..S IVMFERR=""
"RTN","EASUM7",125,0)
 ..D ACK^IVMPREC
"RTN","EASUM7",126,0)
 ..Q
"RTN","EASUM7",127,0)
 .S IVMVAMCA=$P(^(0),"^",2) ; dependent active?
"RTN","EASUM7",128,0)
 .S DA(1)=IVM12,DA=IVM121,DIK="^DGPR(408.12,"_DA(1)_",""E"","
"RTN","EASUM7",129,0)
 .D ^DIK K DA(1),DA,DIK
"RTN","EASUM7",130,0)
 .Q:'IVMVAMCA  ; quit if inactivated VAMC dependent 
"RTN","EASUM7",131,0)
 .S IVM13=+$P($P($G(^DGPR(408.12,+IVM12,0)),"^",3),";")
"RTN","EASUM7",132,0)
 .D EN^EASUM8
"RTN","EASUM7",133,0)
 .Q
"RTN","EASUM7",134,0)
 ;
"RTN","EASUM7",135,0)
 Q:$D(IVMFERR)
"RTN","EASUM7",136,0)
 D EN1^EASUM8
"RTN","EASUM7",137,0)
 Q
"RTN","EASUM7",138,0)
 ;
"RTN","EASUM7",139,0)
ERRBULL ; build mail message for transmission to IVM mail group notifying site
"RTN","EASUM7",140,0)
 ; of upload error.
"RTN","EASUM7",141,0)
 S IVMPAT=$$PT^IVMUFNC4(DFN)
"RTN","EASUM7",142,0)
 S XMSUB="IVM - MEANS TEST UPLOAD"
"RTN","EASUM7",143,0)
 S IVMTEXT(1)="The following error occured when an Income Verification Match"
"RTN","EASUM7",144,0)
 S IVMTEXT(2)="verified Means Test was being uploaded for the following patient:"
"RTN","EASUM7",145,0)
 S IVMTEXT(3)=" "
"RTN","EASUM7",146,0)
 S IVMTEXT(4)="    NAME:     "_$P(IVMPAT,"^")
"RTN","EASUM7",147,0)
 S IVMTEXT(5)="    ID:       "_$P(IVMPAT,"^",2)
"RTN","EASUM7",148,0)
 S IVMTEXT(6)="    ERROR:    "_IVMTEXT(6)
"RTN","EASUM7",149,0)
 Q
"RTN","EASUM7",150,0)
 ;
"RTN","EASUM7",151,0)
MTBULL ; build mail message for transmission to IVM mail group notifying them
"RTN","EASUM7",152,0)
 ; an IVM verified MT/CT has been uploaded into DHCP for a patient.
"RTN","EASUM7",153,0)
 ;
"RTN","EASUM7",154,0)
 S IVMPAT=$$PT^IVMUFNC4(DFN)
"RTN","EASUM7",155,0)
 S XMSUB="IVM - INCOME TEST UPLOAD for "_$P($P(IVMPAT,"^"),",")_" ("_$P(IVMPAT,"^",3)_")"
"RTN","EASUM7",156,0)
 S IVMTEXT(1)="An Income Verification Match verified "
"RTN","EASUM7",157,0)
 S IVMTEXT(1)=IVMTEXT(1)_^DG(408.33,DGMTYPT,0)_" has been uploaded"
"RTN","EASUM7",158,0)
 S IVMTEXT(2)="for the following patient:"
"RTN","EASUM7",159,0)
 S IVMTEXT(3)=" "
"RTN","EASUM7",160,0)
 S IVMTEXT(4)="  NAME:           "_$P(IVMPAT,"^")
"RTN","EASUM7",161,0)
 S IVMTEXT(5)="  ID:             "_$P(IVMPAT,"^",2)
"RTN","EASUM7",162,0)
 S Y=IVMMTDT X ^DD("DD")
"RTN","EASUM7",163,0)
 S IVMTEXT(6)="  DATE OF TEST:   "_Y
"RTN","EASUM7",164,0)
 ;set previous sts from previous 408.31 or previous RX sts
"RTN","EASUM7",165,0)
 S IVMTEXT(7)="  PREV CATEGORY:  "
"RTN","EASUM7",166,0)
 I DGMTYPT=2 D
"RTN","EASUM7",167,0)
 . S IVMTEXT(7)=IVMTEXT(7)_IVMCEB
"RTN","EASUM7",168,0)
 E  D
"RTN","EASUM7",169,0)
 . S IVMTEXT(7)=IVMTEXT(7)_$P($G(^DG(408.32,+$P(IVMMT31,"^",3),0)),"^",1)
"RTN","EASUM7",170,0)
 ;
"RTN","EASUM7",171,0)
 S IVMTEXT(8)="  NEW CATEGORY:   "_DGCAT
"RTN","EASUM7",172,0)
 I IVM5 S Y=IVM5 X ^DD("DD") S IVMTEXT(9)="  DATE/TIME OF ADJUDICATION:  "_Y
"RTN","EASUM7",173,0)
 Q
"VER")
8.0^22.0
"BLD",6254,6)
^62
**END**
**END**
