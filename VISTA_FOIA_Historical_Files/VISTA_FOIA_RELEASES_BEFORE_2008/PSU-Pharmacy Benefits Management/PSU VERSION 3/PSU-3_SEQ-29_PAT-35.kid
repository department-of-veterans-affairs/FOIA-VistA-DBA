EMERGENCY Released PSU*3*35 SEQ #29
Extracted from mail message
**KIDS**:PSU*3.0*35^

**INSTALL NAME**
PSU*3.0*35
"BLD",5883,0)
PSU*3.0*35^PHARMACY BENEFITS MANAGEMENT^0^3041209^y
"BLD",5883,1,0)
^^1^1^3041123^
"BLD",5883,1,1,0)
UNDEFINED ERROR IN PSUIV1 WHEN CREATING MONTHLY EXTRACT.
"BLD",5883,4,0)
^9.64PA^^0
"BLD",5883,"ABPKG")
n
"BLD",5883,"INI")

"BLD",5883,"INID")
y^^
"BLD",5883,"KRN",0)
^9.67PA^8989.52^19
"BLD",5883,"KRN",.4,0)
.4
"BLD",5883,"KRN",.401,0)
.401
"BLD",5883,"KRN",.402,0)
.402
"BLD",5883,"KRN",.403,0)
.403
"BLD",5883,"KRN",.5,0)
.5
"BLD",5883,"KRN",.84,0)
.84
"BLD",5883,"KRN",3.6,0)
3.6
"BLD",5883,"KRN",3.8,0)
3.8
"BLD",5883,"KRN",9.2,0)
9.2
"BLD",5883,"KRN",9.8,0)
9.8
"BLD",5883,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5883,"KRN",9.8,"NM",1,0)
PSUIV1^^0^B73473589
"BLD",5883,"KRN",9.8,"NM",2,0)
PSU35PRE^^0^B1577635
"BLD",5883,"KRN",9.8,"NM","B","PSU35PRE",2)

"BLD",5883,"KRN",9.8,"NM","B","PSUIV1",1)

"BLD",5883,"KRN",19,0)
19
"BLD",5883,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5883,"KRN",19.1,0)
19.1
"BLD",5883,"KRN",101,0)
101
"BLD",5883,"KRN",409.61,0)
409.61
"BLD",5883,"KRN",771,0)
771
"BLD",5883,"KRN",771,"NM",0)
^9.68A^^0
"BLD",5883,"KRN",870,0)
870
"BLD",5883,"KRN",8989.51,0)
8989.51
"BLD",5883,"KRN",8989.52,0)
8989.52
"BLD",5883,"KRN",8994,0)
8994
"BLD",5883,"KRN","B",.4,.4)
 
"BLD",5883,"KRN","B",.401,.401)
 
"BLD",5883,"KRN","B",.402,.402)
 
"BLD",5883,"KRN","B",.403,.403)
 
"BLD",5883,"KRN","B",.5,.5)
 
"BLD",5883,"KRN","B",.84,.84)
 
"BLD",5883,"KRN","B",3.6,3.6)
 
"BLD",5883,"KRN","B",3.8,3.8)
 
"BLD",5883,"KRN","B",9.2,9.2)
 
"BLD",5883,"KRN","B",9.8,9.8)
 
"BLD",5883,"KRN","B",19,19)
 
"BLD",5883,"KRN","B",19.1,19.1)
 
"BLD",5883,"KRN","B",101,101)
 
"BLD",5883,"KRN","B",409.61,409.61)
 
"BLD",5883,"KRN","B",771,771)
 
"BLD",5883,"KRN","B",870,870)
 
"BLD",5883,"KRN","B",8989.51,8989.51)
 
"BLD",5883,"KRN","B",8989.52,8989.52)
 
"BLD",5883,"KRN","B",8994,8994)
 
"BLD",5883,"PRE")
PSU35PRE
"BLD",5883,"QUES",0)
^9.62^^
"BLD",5883,"REQB",0)
^9.611^1^1
"BLD",5883,"REQB",1,0)
PSU*3.0*34^1
"BLD",5883,"REQB","B","PSU*3.0*34",1)

"MBREQ")
0
"PKG",541,-1)
1^1
"PKG",541,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",541,20,0)
^9.402P^^
"PKG",541,22,0)
^9.49I^1^1
"PKG",541,22,1,0)
3.0^2981015^3010116^66481
"PKG",541,22,1,"PAH",1,0)
35^3041209
"PKG",541,22,1,"PAH",1,1,0)
^^1^1^3041209
"PKG",541,22,1,"PAH",1,1,1,0)
UNDEFINED ERROR IN PSUIV1 WHEN CREATING MONTHLY EXTRACT.
"PRE")
PSU35PRE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSU35PRE")
0^2^B1577635
"RTN","PSU35PRE",1,0)
PSU35PRE ;BAYPINES/ELR - PRE INIT FOR PSU 3 35 ;25 AUG 1998
"RTN","PSU35PRE",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**35**;Oct 15, 1998
"RTN","PSU35PRE",3,0)
 ;IF SITE HAS VERSION 4.0 IN 2ND LINE OF ROUTINE PSUIV1, IT IS TESTING
"RTN","PSU35PRE",4,0)
 ;VERSION 4 AND WE WILL ABORT THE INSTALL.
"RTN","PSU35PRE",5,0)
START ;
"RTN","PSU35PRE",6,0)
 NEW XX
"RTN","PSU35PRE",7,0)
 S XX=$TEXT(PSUIV1+1^PSUIV1)
"RTN","PSU35PRE",8,0)
 I $P(XX,";",3)["4" S XPDQUIT=1 D
"RTN","PSU35PRE",9,0)
 . D EN^DDIOL("PSU version 4 found. Version 3, PSU*3*35 will not be installed")
"RTN","PSU35PRE",10,0)
 . D SNDMAIL Q
"RTN","PSU35PRE",11,0)
 Q
"RTN","PSU35PRE",12,0)
SNDMAIL ;
"RTN","PSU35PRE",13,0)
 N ZTIO,ZTDTH,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSU35PRE",14,0)
 S ZTIO="",ZTDTH=$H,$P(ZTDTH,",",2)=$P(ZTDTH,",",2)+30,ZTDESC="PATCH PSU*3*35 MAIL"
"RTN","PSU35PRE",15,0)
 S ZTRTN="MAIL^PSU35PRE"
"RTN","PSU35PRE",16,0)
 D ^%ZTLOAD
"RTN","PSU35PRE",17,0)
 Q
"RTN","PSU35PRE",18,0)
MAIL ;Send message to user
"RTN","PSU35PRE",19,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","PSU35PRE",20,0)
 S XMY($S(DUZ:DUZ,1:.5))=""
"RTN","PSU35PRE",21,0)
 S XMSUB="ENVIRONMENTAL CHECK ROUTINE FOR PATCH PSU 3 35"
"RTN","PSU35PRE",22,0)
 S XMTEXT="PSU("
"RTN","PSU35PRE",23,0)
 S PSU(1)="YOU ARE A TEST SITE FOR VER 4 OF PBM. YOU CANNOT LOAD THIS PATCH"
"RTN","PSU35PRE",24,0)
 S XMDUZ="POSTMASTER"
"RTN","PSU35PRE",25,0)
 D ^XMD
"RTN","PSU35PRE",26,0)
 K PSU
"RTN","PSU35PRE",27,0)
 Q
"RTN","PSUIV1")
0^1^B73473589
"RTN","PSUIV1",1,0)
PSUIV1 ;BIR/CFL - Extract Data of PBM IV Module ;25 AUG 1998
"RTN","PSUIV1",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,3,14,16,19,34,35**;Oct 15, 1998
"RTN","PSUIV1",3,0)
 ;DBIAs
"RTN","PSUIV1",4,0)
 ; Reference to file #55   supported by DBIA 2497
"RTN","PSUIV1",5,0)
 ; Reference to file #59.5 supported by DBIA 2499
"RTN","PSUIV1",6,0)
 ; Reference to file #40.8 supported by DBIA 2438
"RTN","PSUIV1",7,0)
 ; Reference to file #7    supported by DBIA 2495
"RTN","PSUIV1",8,0)
 ; Reference to file #49   supported by DBIA 10093
"RTN","PSUIV1",9,0)
 ; Reference to file #52.6 supported by DBIA 436
"RTN","PSUIV1",10,0)
 ; Reference to file #50   supported by DBIA 221
"RTN","PSUIV1",11,0)
 ; Reference to file #52.7 supported by DBIA 437
"RTN","PSUIV1",12,0)
 ; Reference to file #2    supported by DBIA 10035
"RTN","PSUIV1",13,0)
 ; Reference to file #200  supported by DBIA 10060
"RTN","PSUIV1",14,0)
 ;
"RTN","PSUIV1",15,0)
IVDATA ;Loop through IV data
"RTN","PSUIV1",16,0)
 N PSUDOC1
"RTN","PSUIV1",17,0)
 K PSUSSNA,PSUORDA
"RTN","PSUIV1",18,0)
 ; *34 |==>
"RTN","PSUIV1",19,0)
 S PSUIVDT=PSUSDT\1-.0001 ;use 1st day of extract for 'stop date' scan
"RTN","PSUIV1",20,0)
 S PSUTEDT=PSUEDT\1+.2359
"RTN","PSUIV1",21,0)
 F  S PSUIVDT=$O(^PS(55,"AIV",PSUIVDT)) Q:'PSUIVDT  D
"RTN","PSUIV1",22,0)
 .S PSUPDA=""
"RTN","PSUIV1",23,0)
 .F  S PSUPDA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA)) Q:'PSUPDA  D
"RTN","PSUIV1",24,0)
 ..S PSUODA=""
"RTN","PSUIV1",25,0)
 ..F  S PSUODA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA,PSUODA)) Q:'PSUODA  D
"RTN","PSUIV1",26,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUHLD",PSUODA)=""   ;should be the D0's for file 55.01 ; <==| *34
"RTN","PSUIV1",27,0)
 ...S COUNT=0
"RTN","PSUIV1",28,0)
 ...S PSUDIV=""
"RTN","PSUIV1",29,0)
 ...K PSUIV
"RTN","PSUIV1",30,0)
 ...; screen test patients
"RTN","PSUIV1",31,0)
 ...Q:$$TESTPAT^PSUTL1(PSUPDA)
"RTN","PSUIV1",32,0)
 ...S XX=$$VALI^PSUTL(55.01,"PSUPDA,PSUODA",.02) Q:XX>PSUTEDT  ;*34
"RTN","PSUIV1",33,0)
 ...K PSUIV ;*34
"RTN","PSUIV1",34,0)
 ...D GETS^PSUTL(55.01,"PSUPDA,PSUODA",".01;.02;.03;.04;.06;.08;.09;.22;104;106;108","PSUIV","I")
"RTN","PSUIV1",35,0)
 ...;.01-Order num;.02-Start Dt;.03-Stop Dt;.04-Type;.06-Provider
"RTN","PSUIV1",36,0)
 ...;104-Ward;106-Chemotherapy Type;108-Intermittent Syringe
"RTN","PSUIV1",37,0)
 ...Q:'$D(PSUIV)
"RTN","PSUIV1",38,0)
 ...;VMP OIFO BAY PINES;ELR;PSU*3*35 ADDED NEXT LINE
"RTN","PSUIV1",39,0)
 ...Q:$G(PSUIV(.06,"I"))'>0
"RTN","PSUIV1",40,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPIEN",PSUPDA)=""     ;Patient IEN's ;*34
"RTN","PSUIV1",41,0)
 ...D MOVEI^PSUTL("PSUIV")
"RTN","PSUIV1",42,0)
 ...S PSUIV(.02)=PSUIV(.02)\1
"RTN","PSUIV1",43,0)
 ...S PSUIV(.03)=PSUIV(.03)\1
"RTN","PSUIV1",44,0)
 ...I PSUIV(.22)'="" S PSUDIV=$$VALI^PSUTL(59.5,PSUIV(.22),.02)
"RTN","PSUIV1",45,0)
 ...S PSUFAC=$$VALI^PSUTL(40.8,PSUDIV,1) S:PSUFAC="" PSUFAC=PSUSNDR
"RTN","PSUIV1",46,0)
 ...S PSUFAC(PSUFAC)=""
"RTN","PSUIV1",47,0)
 ...S PSUOUTP=$S(PSUIV(104)=.5:"Y",1:"N")
"RTN","PSUIV1",48,0)
 ...S DFN=PSUPDA D PID^VADPT
"RTN","PSUIV1",49,0)
 ...S PSUSSN=$TR(VA("PID"),"^-","")
"RTN","PSUIV1",50,0)
 ...D ICN
"RTN","PSUIV1",51,0)
 ...K PSUDOC
"RTN","PSUIV1",52,0)
 ...D GETS^PSUTL(200,"PSUIV(.06)","9;29;53.5","PSUDOC","I")
"RTN","PSUIV1",53,0)
 ...D MOVEI^PSUTL("PSUDOC")
"RTN","PSUIV1",54,0)
 ...I PSUDOC(9)="" S PSUVSSN1=999999999
"RTN","PSUIV1",55,0)
 ...I PSUDOC(9)'="" S PSUVSSN1=PSUDOC(9)
"RTN","PSUIV1",56,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUVSSN1,PSUIV(.06))=""
"RTN","PSUIV1",57,0)
 ...S (PSUPCLS,PSUSP1,PSUSP2)=""
"RTN","PSUIV1",58,0)
 ...I PSUDOC(53.5)'="" D
"RTN","PSUIV1",59,0)
 ....S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),1)
"RTN","PSUIV1",60,0)
 ....I PSUPCLS="" S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),.01)
"RTN","PSUIV1",61,0)
 ...S PSUPSV=$S($L($G(PSUDOC(29))):$$VAL^PSUTL(49,PSUDOC(29),.01),1:"")
"RTN","PSUIV1",62,0)
 ...S PSUPSV=$$UPPER^PSUTL(PSUPSV),PSUSERV=""
"RTN","PSUIV1",63,0)
 ...I $L(PSUPSV),$D(PSECT(PSUPSV)) S PSUSERV=PSECT(PSUPSV)
"RTN","PSUIV1",64,0)
 ...S SPECPTR=$$GET^XUA4A72(PSUIV(.06),PSUIVDT)
"RTN","PSUIV1",65,0)
 ...S PSUSP1=$P(SPECPTR,U,3),PSUSP2=$P(SPECPTR,U,4)
"RTN","PSUIV1",66,0)
 ...D OCCAMT
"RTN","PSUIV1",67,0)
 ...I PSUFND D
"RTN","PSUIV1",68,0)
 ....D GETRATE^PSUIV2(PSUIV(.04))
"RTN","PSUIV1",69,0)
 ....D SETTOT
"RTN","PSUIV1",70,0)
 ....S RECTYP=""
"RTN","PSUIV1",71,0)
 ....D ADDTIV
"RTN","PSUIV1",72,0)
 ....D SOLUTN
"RTN","PSUIV1",73,0)
 I $D(^XTMP(PSUIVSUB,"RECORDS")) D SETSUM^PSUIV2
"RTN","PSUIV1",74,0)
 Q
"RTN","PSUIV1",75,0)
 ;
"RTN","PSUIV1",76,0)
ICN ;Find patient ICN 
"RTN","PSUIV1",77,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*24
"RTN","PSUIV1",78,0)
 ;
"RTN","PSUIV1",79,0)
 N PSUPICN,PSUPICN1,PSUICN
"RTN","PSUIV1",80,0)
 S PSUPTN=0
"RTN","PSUIV1",81,0)
 I $G(PSUSSN),PSUSSN'="" D
"RTN","PSUIV1",82,0)
 .F  S PSUPTN=$O(^DPT("SSN",PSUSSN,PSUPTN)) Q:PSUPTN=""  D
"RTN","PSUIV1",83,0)
 ..S PSUPICN1=$$GETICN^MPIF001(PSUPTN) D
"RTN","PSUIV1",84,0)
 ...I PSUPICN1'[-1 D
"RTN","PSUIV1",85,0)
 ....S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=PSUPICN1
"RTN","PSUIV1",86,0)
 ...I PSUPICN1[-1 S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=""
"RTN","PSUIV1",87,0)
 Q
"RTN","PSUIV1",88,0)
 ;
"RTN","PSUIV1",89,0)
 ;
"RTN","PSUIV1",90,0)
OCCAMT ;Calculate the number of dispensing occurrences
"RTN","PSUIV1",91,0)
 S (PSUFND,PSUDISP,PSUPULL,OCC,PSUDISPT,PSURECT,PSUDEST,PSUCAN)=0
"RTN","PSUIV1",92,0)
 F  S OCC=$O(^PS(55,PSUPDA,"IV",PSUODA,"LAB",OCC)) Q:'OCC  D
"RTN","PSUIV1",93,0)
 .K PSUOCC
"RTN","PSUIV1",94,0)
 .D GETS^PSUTL(55.1111,"PSUPDA,PSUODA,OCC","1;2;4;6","PSUOCC","I")
"RTN","PSUIV1",95,0)
 .D MOVEI^PSUTL("PSUOCC")
"RTN","PSUIV1",96,0)
 .S PSUOCC(1)=PSUOCC(1)\1
"RTN","PSUIV1",97,0)
 .I PSUOCC(1)<PSUSDT!(PSUOCC(1)>PSUTEDT) Q  ;*34
"RTN","PSUIV1",98,0)
 .S PSUFND=1
"RTN","PSUIV1",99,0)
 .I PSUOCC(6)=1,PSUOCC(2)=1 D
"RTN","PSUIV1",100,0)
 ..S PSUDISP=PSUDISP+PSUOCC(4)
"RTN","PSUIV1",101,0)
 ..S PSUDISPT=PSUDISP                        ;Total IV dispensed
"RTN","PSUIV1",102,0)
 ..S PSUPULL=PSUPULL+PSUOCC(4)
"RTN","PSUIV1",103,0)
 ..S ^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC)=PSUOCC(4)+$G(^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC))
"RTN","PSUIV1",104,0)
 ..I PSUOUTP="Y" D  ; Total outpatient IV's dispensed
"RTN","PSUIV1",105,0)
 ...S ^XTMP(PSUIVSUB,"ODISP",PSUFAC)=$G(^XTMP(PSUIVSUB,"ODISP",PSUFAC))+PSUOCC(4)
"RTN","PSUIV1",106,0)
 .I (PSUOCC(2)=2)!(PSUOCC(2)=4) S PSUDISP=PSUDISP-PSUOCC(4) ;Net dispensed
"RTN","PSUIV1",107,0)
 Q
"RTN","PSUIV1",108,0)
SETTOT ;Set totals
"RTN","PSUIV1",109,0)
 ; Total number of IV's ordered
"RTN","PSUIV1",110,0)
 S ^XTMP(PSUIVSUB,"ORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"ORD",PSUFAC))+1
"RTN","PSUIV1",111,0)
 ; Total number of IV patients
"RTN","PSUIV1",112,0)
 I '$D(^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)) D
"RTN","PSUIV1",113,0)
 .S ^XTMP(PSUIVSUB,"SSN",PSUFAC)=$G(^XTMP(PSUIVSUB,"SSN",PSUFAC))+1
"RTN","PSUIV1",114,0)
 .S ^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)=""
"RTN","PSUIV1",115,0)
 .S PSUDIV=PSUFAC D GETDIV^PSUIV3 I PSUDIVNM'="" D
"RTN","PSUIV1",116,0)
 ..S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIVNM,PSUSSN)=""  ;Pt demo summary
"RTN","PSUIV1",117,0)
 .I PSUDIVNM="" S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIV,PSUSSN)=""
"RTN","PSUIV1",118,0)
 I PSUOUTP="Y" D
"RTN","PSUIV1",119,0)
 .; Total outpatient IV's ordered
"RTN","PSUIV1",120,0)
 .S ^XTMP(PSUIVSUB,"OORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"OORD",PSUFAC))+1
"RTN","PSUIV1",121,0)
 Q
"RTN","PSUIV1",122,0)
ADDTIV ;Loop through each additive
"RTN","PSUIV1",123,0)
 S (PSUNITS,ADTIV)=0
"RTN","PSUIV1",124,0)
 F  S ADTIV=$O(^PS(55,PSUPDA,"IV",PSUODA,"AD",ADTIV)) Q:'ADTIV  D
"RTN","PSUIV1",125,0)
 .K PSUADDTV,PSUGNRIC,PSUADD
"RTN","PSUIV1",126,0)
 .D GETS^PSUTL(55.02,"PSUPDA,PSUODA,ADTIV",".01;.02","PSUADDTV","I")
"RTN","PSUIV1",127,0)
 .D MOVEI^PSUTL("PSUADDTV")
"RTN","PSUIV1",128,0)
 .D GETS^PSUTL(52.6,"PSUADDTV(.01)",".01;1;7","PSUGNRIC","I")
"RTN","PSUIV1",129,0)
 .D MOVEI^PSUTL("PSUGNRIC")
"RTN","PSUIV1",130,0)
 .S PSUPNAM=PSUGNRIC(.01)
"RTN","PSUIV1",131,0)
 .S PSUDGU=$$VAL^PSUTL(52.6,PSUADDTV(.01),2)
"RTN","PSUIV1",132,0)
 .S PSUDGDA=PSUGNRIC(1)
"RTN","PSUIV1",133,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","PSUADD","I")
"RTN","PSUIV1",134,0)
 .D MOVEI^PSUTL("PSUADD")
"RTN","PSUIV1",135,0)
 .S PSUGNM=PSUADD(.01)
"RTN","PSUIV1",136,0)
 .S PSUDCLS=PSUADD(2)
"RTN","PSUIV1",137,0)
 .S PSUPRNM=PSUADD(21)
"RTN","PSUIV1",138,0)
 .S PSUNDC=PSUADD(31)
"RTN","PSUIV1",139,0)
 .S PSUNFI=PSUADD(51)
"RTN","PSUIV1",140,0)
 .S PSUNADR=PSUADD(20)
"RTN","PSUIV1",141,0)
 .S PSUNDCL=PSUADD(22)
"RTN","PSUIV1",142,0)
 .S PSUDEA=PSUADD(3)
"RTN","PSUIV1",143,0)
 .S PSUNAF=$S(PSUADD(52):"N/F",1:"")
"RTN","PSUIV1",144,0)
 .D SETVAR
"RTN","PSUIV1",145,0)
 .S PSUSTRN=+PSUADDTV(.02)
"RTN","PSUIV1",146,0)
 .;
"RTN","PSUIV1",147,0)
 .;DAM  Add AMIS Additive data
"RTN","PSUIV1",148,0)
 .N PSUTDSP1
"RTN","PSUIV1",149,0)
 .S PSUTDSP1=$G(PSUDISPT)*PSUSTRN       ;Total Additive units dispensed
"RTN","PSUIV1",150,0)
 .;
"RTN","PSUIV1",151,0)
 .N PSURCY1
"RTN","PSUIV1",152,0)
 .S PSURCY1=$G(PSURECT)*PSUSTRN         ;Total Additive units recycled
"RTN","PSUIV1",153,0)
 .;
"RTN","PSUIV1",154,0)
 .N PSUDES1
"RTN","PSUIV1",155,0)
 .S PSUDES1=$G(PSUDEST)*PSUSTRN      ;Total Additive units destroyed
"RTN","PSUIV1",156,0)
 .;
"RTN","PSUIV1",157,0)
 .N PSUCAN1
"RTN","PSUIV1",158,0)
 .S PSUCAN1=$G(PSUCAN)*PSUSTRN         ;Total Additive units cancelled
"RTN","PSUIV1",159,0)
 .;END DAM
"RTN","PSUIV1",160,0)
 .;
"RTN","PSUIV1",161,0)
 .S PSUNITS=PSUDISP*PSUSTRN
"RTN","PSUIV1",162,0)
 .S PSUBAGS=PSUPULL*PSUSTRN
"RTN","PSUIV1",163,0)
 .S PSUDCST=PSUGNRIC(7)
"RTN","PSUIV1",164,0)
 .S RECIND="A"
"RTN","PSUIV1",165,0)
 .D CALC
"RTN","PSUIV1",166,0)
 .D SETREC^PSUIV2
"RTN","PSUIV1",167,0)
 .D SETDRUG^PSUIV2
"RTN","PSUIV1",168,0)
 Q
"RTN","PSUIV1",169,0)
SOLUTN ;Loop through each solution
"RTN","PSUIV1",170,0)
 S (PSUNITS,SOLDA)=0 F  S SOLDA=$O(^PS(55,PSUPDA,"IV",PSUODA,"SOL",SOLDA)) Q:'SOLDA  D
"RTN","PSUIV1",171,0)
 .K PSUSOL,GENRIC,SOLDRUG
"RTN","PSUIV1",172,0)
 .D GETS^PSUTL(55.11,"PSUPDA,PSUODA,SOLDA",".01;1","PSUSOL","I")
"RTN","PSUIV1",173,0)
 .D MOVEI^PSUTL("PSUSOL")
"RTN","PSUIV1",174,0)
 .D GETS^PSUTL(52.7,"PSUSOL(.01)",".01;1;7","GENRIC","I")
"RTN","PSUIV1",175,0)
 .D MOVEI^PSUTL("GENRIC")
"RTN","PSUIV1",176,0)
 .S PSUPNAM=GENRIC(.01)
"RTN","PSUIV1",177,0)
 .S PSUDGU="ML"
"RTN","PSUIV1",178,0)
 .S PSUDGDA=GENRIC(1)
"RTN","PSUIV1",179,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","SOLDRUG","I")
"RTN","PSUIV1",180,0)
 .D MOVEI^PSUTL("SOLDRUG")
"RTN","PSUIV1",181,0)
 .S PSUGNM=SOLDRUG(.01)
"RTN","PSUIV1",182,0)
 .S PSUDCLS=SOLDRUG(2)
"RTN","PSUIV1",183,0)
 .S PSUPRNM=SOLDRUG(21)
"RTN","PSUIV1",184,0)
 .S PSUNDC=SOLDRUG(31)
"RTN","PSUIV1",185,0)
 .S PSUNFI=SOLDRUG(51)
"RTN","PSUIV1",186,0)
 .S PSUNADR=SOLDRUG(20)
"RTN","PSUIV1",187,0)
 .S PSUNDCL=SOLDRUG(22)
"RTN","PSUIV1",188,0)
 .S PSUDEA=SOLDRUG(3)
"RTN","PSUIV1",189,0)
 .S PSUNAF=$S(SOLDRUG(52):"N/F",1:"")
"RTN","PSUIV1",190,0)
 .D SETVAR
"RTN","PSUIV1",191,0)
 .S VOLUME=+PSUSOL(1)
"RTN","PSUIV1",192,0)
 .;
"RTN","PSUIV1",193,0)
 .;DAM ADD AMIS SOLUTION DATA
"RTN","PSUIV1",194,0)
 .N PSUTSOL1
"RTN","PSUIV1",195,0)
 .S PSUTSOL1=$G(PSUDISPT)*VOLUME    ;Total Solution units dispensed
"RTN","PSUIV1",196,0)
 .;
"RTN","PSUIV1",197,0)
 .N PSUTRS1
"RTN","PSUIV1",198,0)
 .S PSUTRS1=$G(PSURECT)*VOLUME       ;Total Solution units recycled
"RTN","PSUIV1",199,0)
 .;
"RTN","PSUIV1",200,0)
 .N PSUTDS1
"RTN","PSUIV1",201,0)
 .S PSUTDS1=$G(PSUDEST)*VOLUME     ;Total Solution units destroyed
"RTN","PSUIV1",202,0)
 .;
"RTN","PSUIV1",203,0)
 .N PSUTCS1
"RTN","PSUIV1",204,0)
 .S PSUTCS1=$G(PSUCAN)*VOLUME        ;Total Solution units cancelled
"RTN","PSUIV1",205,0)
 .;END DAM
"RTN","PSUIV1",206,0)
 .;
"RTN","PSUIV1",207,0)
 .S PSUNITS=PSUDISP*VOLUME
"RTN","PSUIV1",208,0)
 .S PSUBAGS=PSUPULL*VOLUME
"RTN","PSUIV1",209,0)
 .S PSUDCST=GENRIC(7)
"RTN","PSUIV1",210,0)
 .S RECIND="S"
"RTN","PSUIV1",211,0)
 .D CALC
"RTN","PSUIV1",212,0)
 .D SETREC^PSUIV2
"RTN","PSUIV1",213,0)
 .D SETDRUG^PSUIV2
"RTN","PSUIV1",214,0)
 Q
"RTN","PSUIV1",215,0)
SETVAR ;Setup common variables for IV Additives and Solutions
"RTN","PSUIV1",216,0)
 I PSUGNM="" S PSUGNM="UNKNOWN GENERIC NAME"
"RTN","PSUIV1",217,0)
 I PSUPRNM="" S PSUPRNM="UNKNOWN VA PRODUCT NAME"
"RTN","PSUIV1",218,0)
 I PSUNDC="" S PSUNDC="No NDC"
"RTN","PSUIV1",219,0)
 I PSUNFI=1 S PSUNFI="N/F"
"RTN","PSUIV1",220,0)
 S (PSIVNFI,PSIVNFR)=""
"RTN","PSUIV1",221,0)
 I $$VERSION^XPDUTL("PSN")'<4 D
"RTN","PSUIV1",222,0)
 .S PSIVNFI=$$FORMI^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUIV1",223,0)
 .S PSIVNFR=$$FORMR^PSNAPIS(PSUNADR,PSUNDCL)>0
"RTN","PSUIV1",224,0)
 Q
"RTN","PSUIV1",225,0)
CALC ;Do calculations for additives and solutions
"RTN","PSUIV1",226,0)
 S ^XTMP(PSUIVSUB,"CST",PSUFAC)=(PSUNITS*PSUDCST)+$G(^XTMP(PSUIVSUB,"CST",PSUFAC))
"RTN","PSUIV1",227,0)
 S RECTYP=""
"RTN","PSUIV1",228,0)
 S COUNT=COUNT+1
"RTN","PSUIV1",229,0)
 S:COUNT=1 RECTYP="P"
"RTN","PSUIV1",230,0)
 I PSUOUTP="Y" D
"RTN","PSUIV1",231,0)
 .S ^XTMP(PSUIVSUB,"OCST",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"OCST",PSUFAC))
"RTN","PSUIV1",232,0)
 I PSUIV(.04)="P" D
"RTN","PSUIV1",233,0)
 .S ^XTMP(PSUIVSUB,"SPIG",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SPIG",PSUFAC))
"RTN","PSUIV1",234,0)
 I PSUIV(.04)="A" D
"RTN","PSUIV1",235,0)
 .S ^XTMP(PSUIVSUB,"SADM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SADM",PSUFAC))
"RTN","PSUIV1",236,0)
 I PSUIV(.04)="H" D
"RTN","PSUIV1",237,0)
 .S ^XTMP(PSUIVSUB,"SHYP",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SHYP",PSUFAC))
"RTN","PSUIV1",238,0)
 I PSUIV(.04)="S" D
"RTN","PSUIV1",239,0)
 .S ^XTMP(PSUIVSUB,"SSYR",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SSYR",PSUFAC))
"RTN","PSUIV1",240,0)
 I PSUIV(.04)="C" D
"RTN","PSUIV1",241,0)
 .S ^XTMP(PSUIVSUB,"SCHEM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SCHEM",PSUFAC))
"RTN","PSUIV1",242,0)
 Q
"VER")
8.0^22
**END**
**END**
