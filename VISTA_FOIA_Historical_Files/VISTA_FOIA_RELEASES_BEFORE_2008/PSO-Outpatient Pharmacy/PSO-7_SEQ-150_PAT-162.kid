Released PSO*7*162 SEQ #150
Extracted from mail message
**KIDS**:PSO*7.0*162^

**INSTALL NAME**
PSO*7.0*162
"BLD",4659,0)
PSO*7.0*162^OUTPATIENT PHARMACY^0^3040114^y
"BLD",4659,1,0)
^^17^17^3040102^
"BLD",4659,1,1,0)
This patch will fix two similar issues regarding missing text
"BLD",4659,1,2,0)
on the printed prescription labels.
"BLD",4659,1,3,0)
 
"BLD",4659,1,4,0)
The two issues this patch resolves are:
"BLD",4659,1,5,0)
 
"BLD",4659,1,6,0)
1.  When printing prescription labels there is a potential that part 
"BLD",4659,1,7,0)
    of the Narrative Text lines will be truncated.  Modifications
"BLD",4659,1,8,0)
    have been made to resolve this problem while preserving the 
"BLD",4659,1,9,0)
    narrative text format entered by the customer.  The text that 
"BLD",4659,1,10,0)
    was previously truncated will now be moved to a new line.
"BLD",4659,1,11,0)
 
"BLD",4659,1,12,0)
2.  When printing prescription labels there is a potential that some 
"BLD",4659,1,13,0)
    lines will be skipped from printing on the prescription in the
"BLD",4659,1,14,0)
    warning label section.  This issue was happening in rare cases
"BLD",4659,1,15,0)
    when lines in the warning label had been deleted and new lines
"BLD",4659,1,16,0)
    were added.  Modifications have been made to print the warning
"BLD",4659,1,17,0)
    labels lines when this scenario is encountered.
"BLD",4659,4,0)
^9.64PA^^
"BLD",4659,"ABPKG")
n
"BLD",4659,"KRN",0)
^9.67PA^8989.52^19
"BLD",4659,"KRN",.4,0)
.4
"BLD",4659,"KRN",.401,0)
.401
"BLD",4659,"KRN",.402,0)
.402
"BLD",4659,"KRN",.403,0)
.403
"BLD",4659,"KRN",.5,0)
.5
"BLD",4659,"KRN",.84,0)
.84
"BLD",4659,"KRN",3.6,0)
3.6
"BLD",4659,"KRN",3.8,0)
3.8
"BLD",4659,"KRN",9.2,0)
9.2
"BLD",4659,"KRN",9.8,0)
9.8
"BLD",4659,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4659,"KRN",9.8,"NM",1,0)
PSOLLL6^^0^B7844743
"BLD",4659,"KRN",9.8,"NM",2,0)
PSOLLL1^^0^B60515433
"BLD",4659,"KRN",9.8,"NM",3,0)
PSOLBLN1^^0^B39273947
"BLD",4659,"KRN",9.8,"NM",4,0)
PSOHLSG2^^0^B46935693
"BLD",4659,"KRN",9.8,"NM","B","PSOHLSG2",4)

"BLD",4659,"KRN",9.8,"NM","B","PSOLBLN1",3)

"BLD",4659,"KRN",9.8,"NM","B","PSOLLL1",2)

"BLD",4659,"KRN",9.8,"NM","B","PSOLLL6",1)

"BLD",4659,"KRN",19,0)
19
"BLD",4659,"KRN",19.1,0)
19.1
"BLD",4659,"KRN",101,0)
101
"BLD",4659,"KRN",409.61,0)
409.61
"BLD",4659,"KRN",771,0)
771
"BLD",4659,"KRN",870,0)
870
"BLD",4659,"KRN",8989.51,0)
8989.51
"BLD",4659,"KRN",8989.52,0)
8989.52
"BLD",4659,"KRN",8994,0)
8994
"BLD",4659,"KRN","B",.4,.4)

"BLD",4659,"KRN","B",.401,.401)

"BLD",4659,"KRN","B",.402,.402)

"BLD",4659,"KRN","B",.403,.403)

"BLD",4659,"KRN","B",.5,.5)

"BLD",4659,"KRN","B",.84,.84)

"BLD",4659,"KRN","B",3.6,3.6)

"BLD",4659,"KRN","B",3.8,3.8)

"BLD",4659,"KRN","B",9.2,9.2)

"BLD",4659,"KRN","B",9.8,9.8)

"BLD",4659,"KRN","B",19,19)

"BLD",4659,"KRN","B",19.1,19.1)

"BLD",4659,"KRN","B",101,101)

"BLD",4659,"KRN","B",409.61,409.61)

"BLD",4659,"KRN","B",771,771)

"BLD",4659,"KRN","B",870,870)

"BLD",4659,"KRN","B",8989.51,8989.51)

"BLD",4659,"KRN","B",8989.52,8989.52)

"BLD",4659,"KRN","B",8994,8994)

"BLD",4659,"QUES",0)
^9.62^^
"BLD",4659,"REQB",0)
^9.611^2^2
"BLD",4659,"REQB",1,0)
PSO*7.0*110^2
"BLD",4659,"REQB",2,0)
PSO*7.0*135^2
"BLD",4659,"REQB","B","PSO*7.0*110",1)

"BLD",4659,"REQB","B","PSO*7.0*135",2)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
162^3040114
"PKG",141,22,1,"PAH",1,1,0)
^^17^17^3040114
"PKG",141,22,1,"PAH",1,1,1,0)
This patch will fix two similar issues regarding missing text
"PKG",141,22,1,"PAH",1,1,2,0)
on the printed prescription labels.
"PKG",141,22,1,"PAH",1,1,3,0)
 
"PKG",141,22,1,"PAH",1,1,4,0)
The two issues this patch resolves are:
"PKG",141,22,1,"PAH",1,1,5,0)
 
"PKG",141,22,1,"PAH",1,1,6,0)
1.  When printing prescription labels there is a potential that part 
"PKG",141,22,1,"PAH",1,1,7,0)
    of the Narrative Text lines will be truncated.  Modifications
"PKG",141,22,1,"PAH",1,1,8,0)
    have been made to resolve this problem while preserving the 
"PKG",141,22,1,"PAH",1,1,9,0)
    narrative text format entered by the customer.  The text that 
"PKG",141,22,1,"PAH",1,1,10,0)
    was previously truncated will now be moved to a new line.
"PKG",141,22,1,"PAH",1,1,11,0)
 
"PKG",141,22,1,"PAH",1,1,12,0)
2.  When printing prescription labels there is a potential that some 
"PKG",141,22,1,"PAH",1,1,13,0)
    lines will be skipped from printing on the prescription in the
"PKG",141,22,1,"PAH",1,1,14,0)
    warning label section.  This issue was happening in rare cases
"PKG",141,22,1,"PAH",1,1,15,0)
    when lines in the warning label had been deleted and new lines
"PKG",141,22,1,"PAH",1,1,16,0)
    were added.  Modifications have been made to print the warning
"PKG",141,22,1,"PAH",1,1,17,0)
    labels lines when this scenario is encountered.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOHLSG2")
0^4^B46935693
"RTN","PSOHLSG2",1,0)
PSOHLSG2 ;BIR/BHW - Build HL7 Segments ;03/01/96 09:45
"RTN","PSOHLSG2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**30,139,162**;DEC 1997
"RTN","PSOHLSG2",3,0)
 ;External reference to DIWP supported by DBIA 10011
"RTN","PSOHLSG2",4,0)
 ;External reference to HLFNC supported by DBIA 10106
"RTN","PSOHLSG2",5,0)
 ;External reference to ^PS(51 supported by DBIA 2224
"RTN","PSOHLSG2",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOHLSG2",7,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOHLSG2",8,0)
 ;External reference to ^PS(54 supported by DBIA 2227
"RTN","PSOHLSG2",9,0)
 ;External reference to EN1^GMRAOR2 supported by DBIA 2422
"RTN","PSOHLSG2",10,0)
 ;External reference to ^DPT supported by DBIA 3097
"RTN","PSOHLSG2",11,0)
 ;External reference to EN1^GMRADPT supported by DBIA 10099
"RTN","PSOHLSG2",12,0)
 ;Cont'd build HL7 segments
"RTN","PSOHLSG2",13,0)
 ;
"RTN","PSOHLSG2",14,0)
ZAL(PSI) ;allergy list segment
"RTN","PSOHLSG2",15,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",16,0)
 N ZAL,IDX,SEV,DAT,X
"RTN","PSOHLSG2",17,0)
 S CNT=0,GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSOHLSG2",18,0)
 I $G(GMRAL)="" G ZALQT
"RTN","PSOHLSG2",19,0)
 F AIEN=0:0 S AIEN=$O(GMRAL(AIEN)) Q:'AIEN  D
"RTN","PSOHLSG2",20,0)
 .K ADTL D EN1^GMRAOR2(AIEN,"ADTL") S CNT=CNT+1
"RTN","PSOHLSG2",21,0)
 .S ZAL="ZAL"_FS_AIEN_FS_$P(GMRAL(AIEN),"^",2)_FS_$P($P(GMRAL(AIEN),"^",6),";")
"RTN","PSOHLSG2",22,0)
 .S ZAL=ZAL_FS_$S($P(GMRAL(AIEN),"^",3)="D":"DRUG",$P(GMRAL(AIEN),"^",3)="F":"FOOD",$P(GMRAL(AIEN),"^",3)="O":"OTHER",1:"""""")
"RTN","PSOHLSG2",23,0)
 .S ZAL=ZAL_FS_$S($P(GMRAL(AIEN),"^",4)=1:"VERIFIED",1:"NON-VERIFIED")
"RTN","PSOHLSG2",24,0)
 .S IDX=$O(ADTL("O","")),X="" S:IDX'="" X=$G(ADTL("O",IDX))
"RTN","PSOHLSG2",25,0)
 .S DAT=$P(X,"^"),DAT=$S(DAT'="":$$HLDATE^HLFNC(DAT,"DT"),1:"")
"RTN","PSOHLSG2",26,0)
 .S SEV=$P(X,"^",2) S:SEV="" SEV="""""",DAT=""
"RTN","PSOHLSG2",27,0)
 .S $P(ZAL,FS,7,8)=SEV_FS_DAT,^TMP("PSO",$J,PSI)=ZAL,PSI=PSI+1
"RTN","PSOHLSG2",28,0)
 .F  S IDX=$O(ADTL("O",IDX)) Q:IDX=""  D
"RTN","PSOHLSG2",29,0)
 ..S X=$G(ADTL("O",IDX)),DAT=$P(X,"^"),SEV=$P(X,"^",2) I SEV="" Q
"RTN","PSOHLSG2",30,0)
 ..S DAT=$S(DAT'="":$$HLDATE^HLFNC(DAT,"DT"),1:"")
"RTN","PSOHLSG2",31,0)
 ..S $P(ZAL,FS,7,8)=SEV_FS_DAT,^TMP("PSO",$J,PSI)=ZAL,PSI=PSI+1
"RTN","PSOHLSG2",32,0)
 ;
"RTN","PSOHLSG2",33,0)
ZALQT K GMRAL,ADTL,AIEN,CNT,CNT,GMRA
"RTN","PSOHLSG2",34,0)
 Q
"RTN","PSOHLSG2",35,0)
 ;
"RTN","PSOHLSG2",36,0)
ZML(PSI) ;multi-Rx label segment
"RTN","PSOHLSG2",37,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",38,0)
 N ZML S CNT1=0
"RTN","PSOHLSG2",39,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) D
"RTN","PSOHLSG2",40,0)
 .F PSRX=0:0 S PSRX=$O(^PS(55,DFN,"P",PSRX)) Q:'PSRX  D
"RTN","PSOHLSG2",41,0)
 ..S PSRXX=+^PS(55,DFN,"P",PSRX,0) I $D(^PSRX(PSRXX,0)) S PSRFL=$P(^(0),"^",9) D:$D(^(1))&PSRFL
"RTN","PSOHLSG2",42,0)
 ...F AMC=0:0 S AMC=$O(^PSRX(PSRXX,1,AMC)) Q:'AMC  S PSRFL=PSRFL-1
"RTN","PSOHLSG2",43,0)
 ...I $G(PSRFL)>0 S X1=DT,X2=$P(^PSRX(PSRXX,0),"^",8)-10 D C^%DTC I X'<$P(^(2),"^",6) S PSRFL=0
"RTN","PSOHLSG2",44,0)
 ..I $G(PSRFL)>0,$P($G(^PSRX(PSRXX,"STA")),"^")<10,$P(^(2),"^",6)>DT S RX(PSRXX)=$P(^(2),"^",6)_"^"_PSRFL Q
"RTN","PSOHLSG2",45,0)
 .S PSA=0 F J=1:1 S PSA=$O(RX(PSA)) Q:'PSA  D
"RTN","PSOHLSG2",46,0)
 ..S DRG=$$ZZ^PSOSUTL(PSA),CNT1=CNT1+1 K ZDRUG
"RTN","PSOHLSG2",47,0)
 ..S REFILLS=$P(RX(PSA),"^",2),EXPDATE=$P(RX(PSA),"^"),EXPDATE=$$HLDATE^HLFNC(EXPDATE,"DT")
"RTN","PSOHLSG2",48,0)
 ..S RXNUM=$P(^PSRX(PSA,0),"^")
"RTN","PSOHLSG2",49,0)
 ..I $G(PSOBARS),$P($G(PSOPAR),"^",19) S BARCODE=PSOINST_"-"_PSA
"RTN","PSOHLSG2",50,0)
 ..S ZML="ZML"_FS_DRG_FS_REFILLS_FS_EXPDATE_FS_RXNUM_FS_$S($G(BARCODE):BARCODE,1:"""""")
"RTN","PSOHLSG2",51,0)
 ..S ^TMP("PSO",$J,PSI)=ZML
"RTN","PSOHLSG2",52,0)
 ..S PSI=PSI+1
"RTN","PSOHLSG2",53,0)
 K PSRX,PSRXX,PSRFL,AMC,J,X,X1,X2,RX,PSA,DRG,CNT1,REFILLS,EXPDATE,RXNUM,BARCODE
"RTN","PSOHLSG2",54,0)
 Q
"RTN","PSOHLSG2",55,0)
 ;
"RTN","PSOHLSG2",56,0)
ZSL(PSI) ;build Suspense Notice segment
"RTN","PSOHLSG2",57,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",58,0)
 N ZSL
"RTN","PSOHLSG2",59,0)
 S (PSSUFLG,PSSPCNT)=0 S PSODFN=DFN,(SPPL,RXX,STA)=""
"RTN","PSOHLSG2",60,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOHLSG2",61,0)
 D ^PSOBUILD S (STA,RXX)="" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOHLSG2",62,0)
 F XX=1:1 Q:$P(SPPL,",",XX)=""  S PSSSRX=$P(SPPL,",",XX) D
"RTN","PSOHLSG2",63,0)
 .S SPNUM=$O(^PS(52.5,"B",PSSSRX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S SPDATE=$$HLDATE^HLFNC(SPDATE,"DT")
"RTN","PSOHLSG2",64,0)
 .S $P(PSOLGTH," ",(20-($L($P(^PSRX(PSSSRX,0),"^")))))=""
"RTN","PSOHLSG2",65,0)
 .S ZSL="ZSL"_FS_$$ZZ^PSOSUTL(PSSSRX)_FS_$G(SPDATE)_FS_$P(^PSRX(PSSSRX,0),"^")
"RTN","PSOHLSG2",66,0)
 .S ^TMP("PSO",$J,PSI)=ZSL
"RTN","PSOHLSG2",67,0)
 .S PSI=PSI+1
"RTN","PSOHLSG2",68,0)
 K SPNUM,SPDATE,PSSUFLG,PSSPCNT,SPPL,RXX,STA,X1,X2,XX,X,PSOSD,PSSSRX,PSOLGTH,PSODTCUT
"RTN","PSOHLSG2",69,0)
 Q
"RTN","PSOHLSG2",70,0)
 ;
"RTN","PSOHLSG2",71,0)
NTE1(PSI) ;build NTE segment for SIG
"RTN","PSOHLSG2",72,0)
 ;
"RTN","PSOHLSG2",73,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",74,0)
 N NTE1
"RTN","PSOHLSG2",75,0)
 S SIG=$P($G(^PSRX(IRXN,"SIG")),"^") I $P($G(^PSRX(IRXN,"SIG")),"^",2) D PSOLBL3,SIGOLD
"RTN","PSOHLSG2",76,0)
 I '$P($G(^PSRX(IRXN,"SIG")),"^",2) D SIG
"RTN","PSOHLSG2",77,0)
 S NTE1="NTE"_FS_1_FS_FS,FLD3="" F DR=1:1 Q:$G(SGY(DR))=""  S FLD3=FLD3_SGY(DR)
"RTN","PSOHLSG2",78,0)
 S ^TMP("PSO",$J,PSI)=NTE1_FLD3
"RTN","PSOHLSG2",79,0)
 S PSI=PSI+1
"RTN","PSOHLSG2",80,0)
 K SIG,E,F,S,FLD3,X,Y,SGY,SGC,Z,DR,%,J,P
"RTN","PSOHLSG2",81,0)
 Q
"RTN","PSOHLSG2",82,0)
 ;
"RTN","PSOHLSG2",83,0)
SIG S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""
"RTN","PSOHLSG2",84,0)
 .I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSOHLSG2",85,0)
 .S SGY=SGY_X_" "
"RTN","PSOHLSG2",86,0)
 S X="",SGC=1 F J=1:1 S Z=$P(SGY," ",J) S:Z="" SGY(SGC)=X Q:Z=""  S:$L(X)+$L(Z)'<$S($P(PSOPAR,"^",28):46,1:34) SGY(SGC)=X,SGC=SGC+1,X="" S X=X_Z_" "
"RTN","PSOHLSG2",87,0)
SIGOLD I '$P(PSOPAR,"^",28) I $P($G(^DPT(DFN,"NHC")),"^")="Y"!($P($G(^PS(55,DFN,40)),"^")) S SGC=SGC+1,SGY(SGC)="Expiration:________ Mfg:_________"
"RTN","PSOHLSG2",88,0)
 I $P(PSOPAR,"^",28) K SIG,E,F,S
"RTN","PSOHLSG2",89,0)
 Q
"RTN","PSOHLSG2",90,0)
 ;
"RTN","PSOHLSG2",91,0)
PSOLBL3 ;RX must be defined (Internal), Check already done for OERR SIG
"RTN","PSOHLSG2",92,0)
 ;Format OERR Sig for New and Old label stock
"RTN","PSOHLSG2",93,0)
 N CTCT,FFFF,LLIM,LLLL,LVAR,LVAR1,PPP,PPPP,SGCT,SIG9,ZZZZ,PSLONG,PPPP
"RTN","PSOHLSG2",94,0)
 S PSLONG=$S($P(PSOPAR,"^",28):46,1:34),RX=IRXN
"RTN","PSOHLSG2",95,0)
 ; NEXT LINE IF SIG IS MOVED BACK TO MULTIPLE
"RTN","PSOHLSG2",96,0)
 S PPPP=1 F PPP=0:0 S PPP=$O(^PSRX(RX,"SIG1",PPP)) Q:'PPP  I $G(^PSRX(RX,"SIG1",PPP,0))'="" S SIG9(PPPP)=^(0) S PPPP=PPPP+1
"RTN","PSOHLSG2",97,0)
 ;NEXT LINE IF 1ST FRONT DOOR SIG LINE LIVES IN BACK DOOR SPOT
"RTN","PSOHLSG2",98,0)
 ;S SIG9(1)=$P($G(^PSRX(RX,"SIG")),"^") S PPP=2 F PPPP=0:0 S PPPP=$O(^PSRX(RX,"SIG1",PPPP)) Q:'PPPP  I $G(^(PPPP,0))'="" S SIG9(PPP)=$G(^(0)),PPP=PPP+1
"RTN","PSOHLSG2",99,0)
 S (LVAR,LVAR1)="",LLLL=1
"RTN","PSOHLSG2",100,0)
 F FFFF=0:0 S FFFF=$O(SIG9(FFFF)) Q:'FFFF  S SGCT=0 F ZZZZ=1:1:$L(SIG9(FFFF)) I $E(SIG9(FFFF),ZZZZ)=" "!($L(SIG9(FFFF))=ZZZZ) S SGCT=SGCT+1 D  I $L(LVAR)>PSLONG S SGY(LLLL)=LLIM_" ",LLLL=LLLL+1,LVAR=LVAR1
"RTN","PSOHLSG2",101,0)
 .S LVAR1=$P(SIG9(FFFF)," ",(SGCT))
"RTN","PSOHLSG2",102,0)
 .S LLIM=LVAR
"RTN","PSOHLSG2",103,0)
 .S LVAR=$S(LVAR="":LVAR1,1:LVAR_" "_LVAR1)
"RTN","PSOHLSG2",104,0)
 I $G(LVAR)'="" S SGY(LLLL)=LVAR
"RTN","PSOHLSG2",105,0)
 I '$P(PSOPAR,"^",28) S SGC=0 F CTCT=0:0 S CTCT=$O(SGY(CTCT)) Q:'CTCT  S SGC=SGC+1
"RTN","PSOHLSG2",106,0)
 Q
"RTN","PSOHLSG2",107,0)
NTE2(PSI) ;build NTE segment for patient narrative
"RTN","PSOHLSG2",108,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",109,0)
 N NTE2
"RTN","PSOHLSG2",110,0)
 K ^UTILITY($J,"W") S (DIWL,PSNACNT)=1,DIWR=45,DIWF="",(PSSIXFL,PSSEVFL)=0 F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,6,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOHLSG2",111,0)
 S NTE2="NTE"_FS_2_FS_FS,^TMP("PSO",$J,PSI)=NTE2
"RTN","PSOHLSG2",112,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP("PSO",$J,PSI,PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1,PSSIXFL=1
"RTN","PSOHLSG2",113,0)
 I PSSIXFL S ^TMP("PSO",$J,PSI,PSNACNT)=" " S PSNACNT=PSNACNT+1
"RTN","PSOHLSG2",114,0)
 S DIWL=1,DIWR=45,DIWF="" K ^UTILITY($J,"W") F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,7,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOHLSG2",115,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP("PSO",$J,PSI,PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1,PSSEVFL=1
"RTN","PSOHLSG2",116,0)
 I PSSEVFL S ^TMP("PSO",$J,PSI,PSNACNT)=" " S PSNACNT=PSNACNT+1
"RTN","PSOHLSG2",117,0)
 S DIWL=1,DIWR=45,DIWF="" K ^UTILITY($J,"W") F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,4,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOHLSG2",118,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP("PSO",$J,PSI,PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1
"RTN","PSOHLSG2",119,0)
 S:$D(NTE2) PSI=PSI+1
"RTN","PSOHLSG2",120,0)
 K DIWF,DIWL,DIWR,LLL,PSNACNT,PSSEVFL,PSSIXFL,ZZ
"RTN","PSOHLSG2",121,0)
 Q
"RTN","PSOHLSG2",122,0)
NTE3(PSI) ;build NTE segment for drug warning narrative
"RTN","PSOHLSG2",123,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",124,0)
 N NTE3
"RTN","PSOHLSG2",125,0)
 S WARN=$P($G(^PSDRUG(IDGN,0)),"^",8)
"RTN","PSOHLSG2",126,0)
 S:$D(WARN) NTE3="NTE"_FS_3_FS_FS,^TMP("PSO",$J,PSI)=NTE3,CNT=1
"RTN","PSOHLSG2",127,0)
 F WWW=1:1 Q:$P(WARN,",",WWW,99)=""  S PSOWARN=$P(WARN,",",WWW) D:$D(^PS(54,PSOWARN,0))
"RTN","PSOHLSG2",128,0)
 . ;BHW;Modify Loop to use $O instead of 1:1
"RTN","PSOHLSG2",129,0)
 . S JJJ=0
"RTN","PSOHLSG2",130,0)
 . F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:'JJJ  D
"RTN","PSOHLSG2",131,0)
 . . I $D(^PS(54,PSOWARN,1,JJJ,0))  S ^TMP("PSO",$J,PSI,CNT)=^PS(54,PSOWARN,1,JJJ,0),CNT=CNT+1
"RTN","PSOHLSG2",132,0)
 . . Q
"RTN","PSOHLSG2",133,0)
 . Q
"RTN","PSOHLSG2",134,0)
 S:$D(NTE3) PSI=PSI+1
"RTN","PSOHLSG2",135,0)
 K WARN,CNT,WW,JJJ,PSOWARN,RX,WWW
"RTN","PSOHLSG2",136,0)
 Q
"RTN","PSOHLSG2",137,0)
 ;
"RTN","PSOHLSG2",138,0)
NTE4(PSI) ;build NTE segment for profile information
"RTN","PSOHLSG2",139,0)
 Q:'$D(DFN)  S PSODFN=DFN
"RTN","PSOHLSG2",140,0)
 N NTE4
"RTN","PSOHLSG2",141,0)
 I $P(PSOPAR,"^",8) D START^PSOHLSG3
"RTN","PSOHLSG2",142,0)
 S:$D(NTE4) PSI=PSI+1
"RTN","PSOHLSG2",143,0)
 Q
"RTN","PSOHLSG2",144,0)
NTE5(PSI) ;build NTE segment for drug interactions
"RTN","PSOHLSG2",145,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",146,0)
 N NTE5
"RTN","PSOHLSG2",147,0)
 D:$D(DRI) START2^PSOHLSG3
"RTN","PSOHLSG2",148,0)
 S:$D(NTE5) ^TMP("PSO",$J,PSI)=NTE5
"RTN","PSOHLSG2",149,0)
 S:'$D(NTE5) ^TMP("PSO",$J,PSI)="NTE"_FS_5_FS_FS
"RTN","PSOHLSG2",150,0)
 S PSI=PSI+1
"RTN","PSOHLSG2",151,0)
 Q
"RTN","PSOHLSG2",152,0)
NTE6(PSI) ;build NTE segment for drug allergy indications
"RTN","PSOHLSG2",153,0)
 Q:'$D(DFN)
"RTN","PSOHLSG2",154,0)
 N NTE6
"RTN","PSOHLSG2",155,0)
 D:$D(DAW) START3^PSOHLSG3
"RTN","PSOHLSG2",156,0)
 S ^TMP("PSO",$J,PSI)=NTE6
"RTN","PSOHLSG2",157,0)
 S PSI=PSI+1
"RTN","PSOHLSG2",158,0)
 Q
"RTN","PSOLBLN1")
0^3^B39273947
"RTN","PSOLBLN1",1,0)
PSOLBLN1 ;BIR/BHW - NEW LABEL CONTINUED ;03/14/94
"RTN","PSOLBLN1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,30,71,107,110,162**;DEC 1997
"RTN","PSOLBLN1",3,0)
 ;External reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLBLN1",4,0)
START W !,?54,$S($L($G(COPAYVAR)):$G(COPAYVAR)_"     ",1:""),"Days Supply: ",$G(DAYS),?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT)
"RTN","PSOLBLN1",5,0)
 I 'PRTFL G NORENW
"RTN","PSOLBLN1",6,0)
 ;NO REFILLS
"RTN","PSOLBLN1",7,0)
 W !,$P(PS,"^",2),?102,"Tech__________RPh__________"
"RTN","PSOLBLN1",8,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN1",9,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",10,0)
 E  W !!!!
"RTN","PSOLBLN1",11,0)
 W "FORWARDING SERVICE REQUESTED",?54,"* NO REFILLS REMAINING ** PHYSICIAN USE ONLY *",! W:"C"[$E(MW) ?21,"CERTIFIED MAIL" W ?54,"*Signature:____________________________SC NSC*"
"RTN","PSOLBLN1",12,0)
 W !,?54,"*Print Name:",ULN,"*",! W $S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***") W ?54,"*DEA or VA#_________________Date_____________*",?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLN1",13,0)
 W !,?54,"*Refills: 0 1 2 3 4 5 6 7 8 9 10 11",?99,"*",?102,"Days Supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN1",14,0)
 W !,?54,"***** To be filled in VA Pharmacies only *****",?102,"Isd: ",ISD," Exp: ",EXPDT,!,PNM,?54,$G(VAPA(1)),?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN1",15,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),?54,$G(ADDR(2)),?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN1",16,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,$G(ADDR(3)),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN1",17,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),?54,$G(ADDR(4))
"RTN","PSOLBLN1",18,0)
 W !,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))),?54,"*Indicate address change on back of this form",!,?54,"[ ] Permanent [ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__")
"RTN","PSOLBLN1",19,0)
 I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",20,0)
 Q
"RTN","PSOLBLN1",21,0)
NORENW ;NO RENEW
"RTN","PSOLBLN1",22,0)
 W !,$P(PS,"^",2),?102,"Tech__________RPH__________"
"RTN","PSOLBLN1",23,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN1",24,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",25,0)
 E  W !!!!
"RTN","PSOLBLN1",26,0)
 W "FORWARDING SERVICE REQUESTED",?54,"*** This prescription CANNOT be renewed ***",! W:"C"[$E(MW) ?21,"CERTIFIED MAIL" W ?54,"*",?96,"*",!,?54,"*     A NEW PRESCRIPTION IS REQUIRED      *"
"RTN","PSOLBLN1",27,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***"),?54,"*",?96,"*",!,?54,"***** Please contact your physician *******"
"RTN","PSOLBLN1",28,0)
 W !,?54,$G(VAPA(1)),?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL"),!,?54,$G(ADDR(2)),?102,"Days supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN1",29,0)
 W !,PNM,?54,$G(ADDR(3)),?102,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLN1",30,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),?54,$G(ADDR(4)),?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN1",31,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,"*Indicate address change on back of this form",?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN1",32,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),?54,"[ ] Permanent [ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__"),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN1",33,0)
 W !,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))) I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",34,0)
 Q
"RTN","PSOLBLN1",35,0)
ALLWARN ;ALLERGIES WITH DRUG WARNING
"RTN","PSOLBLN1",36,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" D WARN^PSOLBL2 Q
"RTN","PSOLBLN1",37,0)
 K ^TMP($J,"PSOWARN"),^TMP($J,"PSOWPT"),^TMP($J,"PSOAPT"),PSONKA,PSONULL
"RTN","PSOLBLN1",38,0)
 X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I '$T D WARN^PSOLBL2 Q
"RTN","PSOLBLN1",39,0)
 F WWW=1:1 Q:$P(WARN,",",WWW,99)=""  S PSOWARN=$P(WARN,",",WWW) D:$D(^PS(54,PSOWARN,0))
"RTN","PSOLBLN1",40,0)
 . ;BHW;Modify Loop to use $O instead of 1:1
"RTN","PSOLBLN1",41,0)
 . S JJJ=0
"RTN","PSOLBLN1",42,0)
 . F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:('JJJ)  D
"RTN","PSOLBLN1",43,0)
 . . I $D(^PS(54,PSOWARN,1,JJJ,0)) S ^TMP($J,"PSOWARN",PSOWARN,JJJ)=^PS(54,PSOWARN,1,JJJ,0)
"RTN","PSOLBLN1",44,0)
 . . Q
"RTN","PSOLBLN1",45,0)
 . Q
"RTN","PSOLBLN1",46,0)
 S ^TMP($J,"PSOWPT",1)=PNM,^(2)="Rx# "_RXN,^(3)=DRUG,^(4)="DRUG WARNING:"
"RTN","PSOLBLN1",47,0)
 S WCNT=4 F WWW=0:0 S WWW=$O(^TMP($J,"PSOWARN",WWW)) Q:'WWW  F RRR=0:0 S RRR=$O(^TMP($J,"PSOWARN",WWW,RRR)) Q:'RRR  S WCNT=WCNT+1 S ^TMP($J,"PSOWPT",WCNT)=^TMP($J,"PSOWARN",WWW,RRR)
"RTN","PSOLBLN1",48,0)
 K ^TMP($J,"ALWA")
"RTN","PSOLBLN1",49,0)
 S GMRA="0^0^111" D ^GMRADPT I $G(GMRAL) F PSORY=0:0 S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"ALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLBLN1",50,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="",^(3)="Verified Allergies",^(4)="------------------"
"RTN","PSOLBLN1",51,0)
 S ALCNT=4,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",52,0)
 I EEE S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",53,0)
 I 'EEE D
"RTN","PSOLBLN1",54,0)
 .I $G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_"NKA",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",55,0)
 .E  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",56,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Non-Verified Allergies",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="----------------------"
"RTN","PSOLBLN1",57,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",58,0)
 I EEE S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",59,0)
 I 'EEE D
"RTN","PSOLBLN1",60,0)
 .I $G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_"NKA",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",61,0)
 .E  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",62,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Verified Adverse Reactions",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="--------------------------"
"RTN","PSOLBLN1",63,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",64,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Non-Verified Adverse Reactions",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="------------------------------"
"RTN","PSOLBLN1",65,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",66,0)
PRT D PRINT^PSOLBL2
"RTN","PSOLBLN1",67,0)
 Q
"RTN","PSOLLL1")
0^2^B60515433
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162**;DEC 1997
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;Reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 .I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_"  "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLL1",18,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T)
"RTN","PSOLLL1",19,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",20,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",21,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",22,0)
 S T="Rx# "_RXN_"  " D PRINT(T,1)
"RTN","PSOLLL1",23,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",24,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") D PRINT(T)
"RTN","PSOLLL1",25,0)
 S PSOX=OPSOX,T=PNM D PRINT(T,1) D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",26,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",28,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",29,0)
 F DR=SIGF("DR"):1 Q:$G(SGY(DR))=""  S TEXT=SGY(DR) D  Q:SIGF
"RTN","PSOLLL1",30,0)
 . F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL1",31,0)
 . S DP=$S(TEXT[" ":" ",TEXT[",":",",1:" ")
"RTN","PSOLLL1",32,0)
 . F I=SIGF("T"):1:$L(TEXT,DP) D  Q:SIGF
"RTN","PSOLLL1",33,0)
 .. S TEXTP=$P(TEXT,DP,I) Q:TEXTP=""  I $D(SIGF("J")) S TEXTP=$E(TEXTP,SIGF("J"),255) K SIGF("J")
"RTN","PSOLLL1",34,0)
 .. D STRT^PSOLLU1("SIG",TEXTP_" ",.L) I L(XFONT)>3.3 D
"RTN","PSOLLL1",35,0)
 ... S MORE=0
"RTN","PSOLLL1",36,0)
 ... F J=$L(TEXTP):-1:1 S TEXTL=PTEXT_$E(TEXTP,1,J) D STRT^PSOLLU1("SIG",TEXTL_" ",.L) D  Q:SIGF!MORE
"RTN","PSOLLL1",37,0)
 .... Q:L(XFONT)>3.3
"RTN","PSOLLL1",38,0)
 .... D PRINT(TEXTL) S TEXT=$E(TEXT,J+1,512),(PTEXT,TEXTL)=""
"RTN","PSOLLL1",39,0)
 .... I PSOY>PSOYM S SIGF=1,SIGF("DR")=DR,SIGF("T")=I,SIGF("J")=J+1 Q
"RTN","PSOLLL1",40,0)
 .... D STRT^PSOLLU1("SIG",TEXT_" ",.L) S TEXTP=TEXT,J=$L(TEXTP) I L(XFONT)<3.3 S MORE=1,LENGTH=0
"RTN","PSOLLL1",41,0)
 .. I LENGTH+L(XFONT)<3.3 S PTEXT=PTEXT_TEXTP_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL1",42,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLL1",43,0)
 .. D PRINT(PTEXT) S PTEXT=""
"RTN","PSOLLL1",44,0)
 .. I PSOY>PSOYM S SIGF=1,SIGF("DR")=DR,SIGF("T")=I+1,PTEXT="" Q
"RTN","PSOLLL1",45,0)
 . I 'SIGF S SIGF("T")=1
"RTN","PSOLLL1",46,0)
 I PTEXT]"" D PRINT(PTEXT)
"RTN","PSOLLL1",47,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",48,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",49,0)
 I SIGF S PSOX=PSOCX,T="(continued on next label)" D PRINT(T) G WARN:'SIGM,CONT
"RTN","PSOLLL1",50,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",51,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",52,0)
 I DEA'["S",DEA'["I" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",53,0)
 S T=T_$S($G(NURSE):"Mfr_________",1:"") D PRINT(T)
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN,",",WWW) Q:PSOWARN=""  I $D(^PS(54,PSOWARN,0)) S PTEXT="",(LENGTH,OUT)=0,LINE=1,LCNT=3 D
"RTN","PSOLLL1",74,0)
 . ;BHW;Modify Loop to use $O instead of 1:1
"RTN","PSOLLL1",75,0)
 . S T="",JJJ=0
"RTN","PSOLLL1",76,0)
 . F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:('JJJ)  D
"RTN","PSOLLL1",77,0)
 . . I $D(^PS(54,PSOWARN,1,JJJ,0)) S T=T_" "_^(0)
"RTN","PSOLLL1",78,0)
 . . Q
"RTN","PSOLLL1",79,0)
 . D STRT^PSOLLU1("WRN",T,.L,.XFONT)
"RTN","PSOLLL1",80,0)
 . I WWW=1 S XFONT=$S(XFONT="F12":"F10",XFONT="F10":"F9",XFONT="F9":"F8",1:"F6")
"RTN","PSOLLL1",81,0)
 . S PSOY=PSOY+$S(XFONT="F12":10,XFONT="F10":5,1:0),PSOYI=$S(XFONT="F12":40,XFONT="F10":35,XFONT="F9":29,1:29)
"RTN","PSOLLL1",82,0)
 . ;BHW;Modify Loop to use $O instead of 1:1
"RTN","PSOLLL1",83,0)
 . S JJJ=0
"RTN","PSOLLL1",84,0)
 . F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:('JJJ)  D  Q:OUT
"RTN","PSOLLL1",85,0)
 .. S TEXT=$G(^PS(54,PSOWARN,1,JJJ,0)) Q:'$L(TEXT)
"RTN","PSOLLL1",86,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL1",87,0)
 .. F I=1:1:$L(TEXT," ") D STRT^PSOLLU1("SEC2",$P(TEXT," ",I)_" ",.L) D  Q:OUT
"RTN","PSOLLL1",88,0)
 ... I LENGTH+L($E(XFONT,2,99))<1.9 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L($E(XFONT,2,99)) Q
"RTN","PSOLLL1",89,0)
 ... S LENGTH=0,I=I-1,PSOFONT=XFONT
"RTN","PSOLLL1",90,0)
 ... D PRINT(PTEXT) S PTEXT="",LINE=LINE+1 I LINE>LCNT S OUT=1 Q
"RTN","PSOLLL1",91,0)
 . I 'OUT S PSOFONT=XFONT D PRINT(PTEXT)
"RTN","PSOLLL1",92,0)
 . S PSOY=WWW*115+29+(WWW-1*2)
"RTN","PSOLLL1",93,0)
 ;RETURN MAIL
"RTN","PSOLLL1",94,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",95,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",96,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",97,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",98,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",99,0)
 S T="Attn: (119)" D PRINT(T,0)
"RTN","PSOLLL1",100,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",101,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",102,0)
 S PSOY=PSOY+PSOYI,PSOFONT=OFONT,T=$S(PS55=2:"***DO NOT MAIL***",PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") D PRINT(T,0)
"RTN","PSOLLL1",103,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(PNM,0)
"RTN","PSOLLL1",104,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",105,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=$G(VAPA(I)) D
"RTN","PSOLLL1",106,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",107,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",108,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",109,0)
 S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6))) D PRINT(T,0)
"RTN","PSOLLL1",110,0)
W I MW="WINDOW" D
"RTN","PSOLLL1",111,0)
 . N XFONT
"RTN","PSOLLL1",112,0)
 . S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY,T="WINDOW - "_$G(^PSRX(RX,"MP"))
"RTN","PSOLLL1",113,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",114,0)
 . I L(XFONT)<2.3 D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",115,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",116,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",117,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",118,0)
 .. I L(XFONT)<2.3 D PRINT(PTEXT) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",119,0)
 . D:PTEXT]"" PRINT(PTEXT)
"RTN","PSOLLL1",120,0)
 . S PSOFONT=OFONT
"RTN","PSOLLL1",121,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",122,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",123,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",124,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",125,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",126,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",127,0)
BARC I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",128,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",129,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",130,0)
BARCE W @IOF
"RTN","PSOLLL1",131,0)
COPY I SIGF S SIGM=1 G L1
"RTN","PSOLLL1",132,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",133,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",134,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5)=0
"RTN","PSOLLL1",135,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",136,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",137,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",138,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",139,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",140,0)
 S L5=1
"RTN","PSOLLL1",141,0)
CONT2 I SIGF S SIGM=1 G L1
"RTN","PSOLLL1",142,0)
 I PMIM G CONT
"RTN","PSOLLL1",143,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",144,0)
 Q
"RTN","PSOLLL1",145,0)
PRINT(T,B) ;
"RTN","PSOLLL1",146,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",147,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",148,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",149,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",150,0)
 W T,!
"RTN","PSOLLL1",151,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",152,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",153,0)
 Q
"RTN","PSOLLL1",154,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",155,0)
 D ^PSOLLL5
"RTN","PSOLLL1",156,0)
 D ^PSOLLL6
"RTN","PSOLLL1",157,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",158,0)
 D ^PSOLLL7
"RTN","PSOLLL1",159,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",160,0)
 W @IOF
"RTN","PSOLLL1",161,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",162,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",163,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",164,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",165,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",166,0)
 W T,!
"RTN","PSOLLL1",167,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",168,0)
 Q
"RTN","PSOLLL6")
0^1^B7844743
"RTN","PSOLLL6",1,0)
PSOLLL6 ;BHAM/BHW - LABEL TRAILER ;12/02/2002
"RTN","PSOLLL6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162**;DEC 1997
"RTN","PSOLLL6",3,0)
 ;
"RTN","PSOLLL6",4,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" Q
"RTN","PSOLLL6",5,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL6",6,0)
NARR ;NARRATIVES
"RTN","PSOLLL6",7,0)
 S (PSSIXFL,PSSEVFL,LENGTH,OUT)=0,PTEXT=""
"RTN","PSOLLL6",8,0)
 I $G(PSOIO("RNI"))]"" X PSOIO("RNI")
"RTN","PSOLLL6",9,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL6",10,0)
 I $D(^PS(59,PSOSITE,6))!($D(^PS(59,PSOSITE,7))) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL6",11,0)
 F JJ=6,7 S TEXT="" D P(JJ)  S PSOY=PSOY+PSOYI Q:OUT
"RTN","PSOLLL6",12,0)
 I $G(PSOIO("CNI"))]"" X PSOIO("CNI")
"RTN","PSOLLL6",13,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S T="REMIT $"_PSOTRAMT_" TO AGENT CASHIER." D PRINT(T) G END
"RTN","PSOLLL6",14,0)
 I 'PRCOPAY G END
"RTN","PSOLLL6",15,0)
 S OUT=0,TEXT=""
"RTN","PSOLLL6",16,0)
 I $D(^PS(59,PSOSITE,4)) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI D P(4)
"RTN","PSOLLL6",17,0)
END K DIWF,DIWL,DIWR,EDT,LLL,PRCOPAY,PS,PSNACNT,PSNOADDR,PSNOBOTH,PSNONARR,PSNOSUSP,PSNTHREE,PSOLGTH,PSOSD,PSOTRAIL,PSOTRDFN,PSSEVFL,PSSIXFL,PSSPCNT,PSSSRX,PSSUFLG,RXX,SPDATE,SPNUM,SPPL,STATE,TTT,VAADDR1,VADM,VAEL,VAPA,VASTREET,ZZ,ZZZ W @IOF
"RTN","PSOLLL6",18,0)
 Q
"RTN","PSOLLL6",19,0)
P(JJ) ;NARRATIVE PRINT CONTROL
"RTN","PSOLLL6",20,0)
 F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,JJ,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL6",21,0)
 . N IC
"RTN","PSOLLL6",22,0)
 . D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL6",23,0)
 . I L(XFONT)>3.7 D  Q
"RTN","PSOLLL6",24,0)
 .. S IC=0 F J=1:1:$L(TEXT," ") D STRT^PSOLLU1("SEC2",$P(TEXT," ",J)_" ",.L) I L(XFONT)>3.7 S IC=1
"RTN","PSOLLL6",25,0)
 .. I IC D  Q:OUT
"RTN","PSOLLL6",26,0)
 ... F J=$L(TEXT):-1:1 S PTEXT=$E(TEXT,1,J) D STRT^PSOLLU1("SEC2",PTEXT,.L) D  Q:OUT
"RTN","PSOLLL6",27,0)
 .... I L(XFONT)<3.7 D PRINT(PTEXT) S TEXT=$E(TEXT,J+1,512),J=$L(TEXT)+1,PTEXT="" I PSOY>PSOYM S OUT=1
"RTN","PSOLLL6",28,0)
 .... Q
"RTN","PSOLLL6",29,0)
 ... Q
"RTN","PSOLLL6",30,0)
 .. I IC D:PTEXT]"" PRINT(PTEXT) Q
"RTN","PSOLLL6",31,0)
 .. F J=$L(TEXT," "):-1 S PTEXT=$P(TEXT," ",1,J) Q:'$L(PTEXT)  D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D
"RTN","PSOLLL6",32,0)
 ... D PRINT(PTEXT) S TEXT=$P(TEXT," ",J+1,99)
"RTN","PSOLLL6",33,0)
 ... ;Reset $l of TEXT +1 so J loop continues properly
"RTN","PSOLLL6",34,0)
 ... S J=$L(TEXT," ")+1
"RTN","PSOLLL6",35,0)
 ... Q
"RTN","PSOLLL6",36,0)
 .. Q
"RTN","PSOLLL6",37,0)
 . D PRINT(TEXT) S TEXT=""
"RTN","PSOLLL6",38,0)
 . I PSOY>PSOYM S OUT=1
"RTN","PSOLLL6",39,0)
 . Q
"RTN","PSOLLL6",40,0)
 I TEXT]"" D PRINT(TEXT)
"RTN","PSOLLL6",41,0)
 Q
"RTN","PSOLLL6",42,0)
PRINT(T) ;
"RTN","PSOLLL6",43,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL6",44,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL6",45,0)
 W T,!
"RTN","PSOLLL6",46,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL6",47,0)
 Q
"VER")
8.0^22.0
**END**
**END**
