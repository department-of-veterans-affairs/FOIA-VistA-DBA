Released SD*5.3*324 SEQ #286
Extracted from mail message
**KIDS**:SD*5.3*324^

**INSTALL NAME**
SD*5.3*324
"BLD",5204,0)
SD*5.3*324^SCHEDULING^0^3031208^y
"BLD",5204,1,0)
^^1^1^3031110^
"BLD",5204,1,1,0)
Undefined variable in Trend of Facilities Report.
"BLD",5204,4,0)
^9.64PA^^
"BLD",5204,"KRN",0)
^9.67PA^8989.52^19
"BLD",5204,"KRN",.4,0)
.4
"BLD",5204,"KRN",.401,0)
.401
"BLD",5204,"KRN",.402,0)
.402
"BLD",5204,"KRN",.403,0)
.403
"BLD",5204,"KRN",.5,0)
.5
"BLD",5204,"KRN",.84,0)
.84
"BLD",5204,"KRN",3.6,0)
3.6
"BLD",5204,"KRN",3.8,0)
3.8
"BLD",5204,"KRN",9.2,0)
9.2
"BLD",5204,"KRN",9.8,0)
9.8
"BLD",5204,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5204,"KRN",9.8,"NM",1,0)
SCRPW46^^0^B81554329
"BLD",5204,"KRN",9.8,"NM","B","SCRPW46",1)

"BLD",5204,"KRN",19,0)
19
"BLD",5204,"KRN",19,"NM",0)
^9.68A^^
"BLD",5204,"KRN",19.1,0)
19.1
"BLD",5204,"KRN",101,0)
101
"BLD",5204,"KRN",409.61,0)
409.61
"BLD",5204,"KRN",771,0)
771
"BLD",5204,"KRN",870,0)
870
"BLD",5204,"KRN",8989.51,0)
8989.51
"BLD",5204,"KRN",8989.52,0)
8989.52
"BLD",5204,"KRN",8994,0)
8994
"BLD",5204,"KRN","B",.4,.4)

"BLD",5204,"KRN","B",.401,.401)

"BLD",5204,"KRN","B",.402,.402)

"BLD",5204,"KRN","B",.403,.403)

"BLD",5204,"KRN","B",.5,.5)

"BLD",5204,"KRN","B",.84,.84)

"BLD",5204,"KRN","B",3.6,3.6)

"BLD",5204,"KRN","B",3.8,3.8)

"BLD",5204,"KRN","B",9.2,9.2)

"BLD",5204,"KRN","B",9.8,9.8)

"BLD",5204,"KRN","B",19,19)

"BLD",5204,"KRN","B",19.1,19.1)

"BLD",5204,"KRN","B",101,101)

"BLD",5204,"KRN","B",409.61,409.61)

"BLD",5204,"KRN","B",771,771)

"BLD",5204,"KRN","B",870,870)

"BLD",5204,"KRN","B",8989.51,8989.51)

"BLD",5204,"KRN","B",8989.52,8989.52)

"BLD",5204,"KRN","B",8994,8994)

"BLD",5204,"QUES",0)
^9.62^^
"BLD",5204,"REQB",0)
^9.611^1^1
"BLD",5204,"REQB",1,0)
SD*5.3*295^1
"BLD",5204,"REQB","B","SD*5.3*295",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
324^3031208
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3031208
"PKG",16,22,1,"PAH",1,1,1,0)
Undefined variable in Trend of Facilities Report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCRPW46")
0^1^B81554329
"RTN","SCRPW46",1,0)
SCRPW46 ;RENO/KEITH/MLR - Outpatient Diagnosis/Procedure Search (cont.) ; 9/27/00 10:29am
"RTN","SCRPW46",2,0)
 ;;5.3;Scheduling;**144,180,199,295,324**;AUG 13, 1993
"RTN","SCRPW46",3,0)
 ;  *199* 
"RTN","SCRPW46",4,0)
 ;  - Creation of Division subscript in ^TMP after DFN to capture,
"RTN","SCRPW46",5,0)
 ;    display, & count multi-divisional patients in Summary Section.
"RTN","SCRPW46",6,0)
 ;  - Filtering out on Sub-header those Division names not having
"RTN","SCRPW46",7,0)
 ;    patients meeting search criteria.
"RTN","SCRPW46",8,0)
 ;
"RTN","SCRPW46",9,0)
PDIS ;Parameter display
"RTN","SCRPW46",10,0)
 D SUBT^SCRPW50("**** Report Parameters Selected ****")
"RTN","SCRPW46",11,0)
 W ! D PD1^SCRPW47(0) S SDOUT=0
"RTN","SCRPW46",12,0)
 ;
"RTN","SCRPW46",13,0)
PDIS1 K DIR
"RTN","SCRPW46",14,0)
 S DIR(0)="S^C:CONTINUE;R:RE-DISPLAY PARAMETERS;P:PRINT PARAMETERS;Q:QUIT"
"RTN","SCRPW46",15,0)
 S DIR("A")="Select report action"
"RTN","SCRPW46",16,0)
 S DIR("B")="CONTINUE"
"RTN","SCRPW46",17,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW46",18,0)
 Q:Y="C"  G:Y="R" PDIS I Y="Q" S SDOUT=1 Q
"RTN","SCRPW46",19,0)
 N ZTSAVE
"RTN","SCRPW46",20,0)
 F SDI="SDDIV","SDDIV(","SD(","SDPAR(","SDCRI(","SDFMT","SDAPF(" S ZTSAVE(SDI)=""
"RTN","SCRPW46",21,0)
 W ! D EN^XUTMDEVQ("PPRT^SCRPW46","Print Report Parameters",.ZTSAVE)
"RTN","SCRPW46",22,0)
 G PDIS1
"RTN","SCRPW46",23,0)
 ;
"RTN","SCRPW46",24,0)
PPRT ;Print report parameters
"RTN","SCRPW46",25,0)
 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW46",26,0)
 S SDTIT(1)="<*>  OUTPATIENT DIAGNOSTIC/PROCEDURE CODE SEARCH  <*>"
"RTN","SCRPW46",27,0)
 S SDTIT(2)="Report Search Parameters" D HINI,HDR
"RTN","SCRPW46",28,0)
 D:'SDOUT PD1^SCRPW47(0) I $E(IOST)="P",$D(ZTQUEUED) G EXIT^SCRPW47
"RTN","SCRPW46",29,0)
 Q  ;PPRT
"RTN","SCRPW46",30,0)
 ;
"RTN","SCRPW46",31,0)
STOP ;Check for stop task request
"RTN","SCRPW46",32,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW46",33,0)
 ;
"RTN","SCRPW46",34,0)
HINI ;Initialize header variables
"RTN","SCRPW46",35,0)
 S SDLINE="",$P(SDLINE,"-",(IOM+1))=""
"RTN","SCRPW46",36,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDPAGE=1,SDFF=0 Q
"RTN","SCRPW46",37,0)
 ;
"RTN","SCRPW46",38,0)
HDR ;Print report header
"RTN","SCRPW46",39,0)
 I $E(IOST)="C",SDFF N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW46",40,0)
 D STOP Q:SDOUT
"RTN","SCRPW46",41,0)
 I SDFF!('SDFF&($E(IOST)="C")) W $$XY^SCRPW50(IOF,1,0)
"RTN","SCRPW46",42,0)
 I $X W $$XY^SCRPW50("",0,0)
"RTN","SCRPW46",43,0)
 N SDI W SDLINE S SDI=0
"RTN","SCRPW46",44,0)
 F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW46",45,0)
 W !,SDLINE,!,"For date range: ",SD("PBDT")," to ",SD("PEDT")
"RTN","SCRPW46",46,0)
 W !,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE
"RTN","SCRPW46",47,0)
 W !,SDLINE S SDPAGE=SDPAGE+1,SDFF=1
"RTN","SCRPW46",48,0)
 Q  ;HDR
"RTN","SCRPW46",49,0)
 ;
"RTN","SCRPW46",50,0)
DHDR(SDIV,SDI,SDTIT) ;Set up division subheaders
"RTN","SCRPW46",51,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW46",52,0)
 ;Required input: SDI=array number to start with
"RTN","SCRPW46",53,0)
 ;Required input: SDTIT=array to store subheaders in (pass by reference)
"RTN","SCRPW46",54,0)
 D  ;
"RTN","SCRPW46",55,0)
 . I 'SDIV S SDTIT(SDI)="Summary for "_$P(SDDIV,U,2) Q
"RTN","SCRPW46",56,0)
 . I SDDIV,($P(SDDIV,U,2)="ALL DIVISIONS") S SDTIT(SDI)="For division: "_SDIVN_" "_SDIVL(SDIVN) Q  ; SD*5.3*324
"RTN","SCRPW46",57,0)
 . S SDTIT(SDI)="For facility: "_SDIVN Q
"RTN","SCRPW46",58,0)
 ;S SDTIT(SDI)=$S('SDIV:"Summary for "_$P(SDDIV,U,2),SDDIV!($P(SDDIV,U,2)="ALL DIVISIONS"):"For division: "_SDIVN_" "_SDIVL(SDIVN),1:"For facility: "_SDIVN)
"RTN","SCRPW46",59,0)
 ;
"RTN","SCRPW46",60,0)
 I 'SDIV,$P(SDDIV,U,2)="SELECTED DIVISIONS" N SDIVN S SDIVN="" D  Q
"RTN","SCRPW46",61,0)
 .F  S SDIVN=$O(SDDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)="Division: "_SDDIV(SDIVN)
"RTN","SCRPW46",62,0)
 .Q
"RTN","SCRPW46",63,0)
 ;
"RTN","SCRPW46",64,0)
 I 'SDIV,$P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW46",65,0)
 .N SDIV S SDIV=0 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:'SDIV  D
"RTN","SCRPW46",66,0)
 .. Q:'$D(^TMP("SCRPW",$J,SDIV,2))
"RTN","SCRPW46",67,0)
 .. S SDI=SDI+1
"RTN","SCRPW46",68,0)
 .. S SDTIT(SDI)="Division: "_$P($G(^DG(40.8,SDIV,0)),U)_"  "_SDIV
"RTN","SCRPW46",69,0)
 .Q
"RTN","SCRPW46",70,0)
 Q
"RTN","SCRPW46",71,0)
 ;
"RTN","SCRPW46",72,0)
START ;Print report
"RTN","SCRPW46",73,0)
 K ^TMP("SCRPW",$J) S (SDOUT,SDSTOP)=0,SDMD="",SDMD=$O(SDDIV(SDMD)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW46",74,0)
 ;Iterate through list of patient encounters
"RTN","SCRPW46",75,0)
 S DFN=0 F  S DFN=$O(^SCE("ADFN",DFN)) Q:'DFN  K SDPDIV S SDSTOP=SDSTOP+1 D:SDSTOP#100=0 STOP Q:SDOUT  D
"RTN","SCRPW46",76,0)
 .S SDT=SD("BDT") F  S SDT=$O(^SCE("ADFN",DFN,SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  D
"RTN","SCRPW46",77,0)
 ..S SDOE=0 F  S SDOE=$O(^SCE("ADFN",DFN,SDT,SDOE)) Q:'SDOE!SDOUT  D
"RTN","SCRPW46",78,0)
 ...S SDOE0=$$GETOE^SDOE(SDOE) S SDIV=$P(SDOE0,"^",11) Q:'SDIV!$P(SDOE0,"^",6)!'$$DIV()  S SDPDIV(SDIV)=""
"RTN","SCRPW46",79,0)
 ...;Build initial patient diagnosis/procedure lists
"RTN","SCRPW46",80,0)
 ...I $D(SD("LIST","D")) K SDLIST D GETDX^SDOE(SDOE,"SDLIST") S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D
"RTN","SCRPW46",81,0)
 ....S SDDX=$P(SDLIST(SDI),"^") S:SDDX ^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDDX)=""
"RTN","SCRPW46",82,0)
 ....Q
"RTN","SCRPW46",83,0)
 ...I $D(SD("LIST","P")) K SDLIST D GETCPT^SDOE(SDOE,"SDLIST") S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D
"RTN","SCRPW46",84,0)
 ....S SDCPT=$P(SDLIST(SDI),"^") S:SDCPT ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDCPT)=""
"RTN","SCRPW46",85,0)
 ....;Loop through modifiers and add to CPT array
"RTN","SCRPW46",86,0)
 .... N SDMODN,SDMOD  ; SDMODN=modifier node, SDMOD=mod pointer
"RTN","SCRPW46",87,0)
 .... S SDMODN=0
"RTN","SCRPW46",88,0)
 .... F  S SDMODN=+$O(SDLIST(SDI,1,SDMODN)) Q:'SDMODN  D
"RTN","SCRPW46",89,0)
 ..... S SDMOD=$P(SDLIST(SDI,1,SDMODN,0),"^",1)
"RTN","SCRPW46",90,0)
 ..... S:SDMOD ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDCPT,SDMOD)=""
"RTN","SCRPW46",91,0)
 ..... Q
"RTN","SCRPW46",92,0)
 .... Q
"RTN","SCRPW46",93,0)
 ...S:$P(SDFMT,"^")="E" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT",SDT,SDOE)=SDOE0
"RTN","SCRPW46",94,0)
 ...S:$P(SDFMT,"^")="V" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT",$P(SDT,"."))=""
"RTN","SCRPW46",95,0)
 ...S:$P(SDFMT,"^")="P" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")=""
"RTN","SCRPW46",96,0)
 ...Q
"RTN","SCRPW46",97,0)
 ..Q
"RTN","SCRPW46",98,0)
 .I '$D(^TMP("SCRPW",$J,0,0,DFN)) D  Q
"RTN","SCRPW46",99,0)
 ..N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  K ^TMP("SCRPW",$J,SDIV,1,DFN)
"RTN","SCRPW46",100,0)
 ..Q
"RTN","SCRPW46",101,0)
 .;Build text lists for Diagnosis ranges if necessary
"RTN","SCRPW46",102,0)
 .I $D(SD("LIST","D","R")) D
"RTN","SCRPW46",103,0)
 .. N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:'SDIV  D
"RTN","SCRPW46",104,0)
 ... S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDI)) Q:'SDI  D
"RTN","SCRPW46",105,0)
 ....S SDX=$$ICDDX^ICDCODE(SDI),SDX=$P(SDX,"^",2)_" "_$P(SDX,"^",4)
"RTN","SCRPW46",106,0)
 .... S:$L(SDX)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"DXR",SDX)=SDI
"RTN","SCRPW46",107,0)
 .;Building text list for Procedure ranges
"RTN","SCRPW46",108,0)
 .I $D(SD("LIST","P","R")) S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)) Q:'SDI  D
"RTN","SCRPW46",109,0)
 ..; SDI=CPT pointer, SDI2=mod ptr, SDX=CPT+desc, SDX2=mod+desc
"RTN","SCRPW46",110,0)
 ..; get CPT and description and build array entry
"RTN","SCRPW46",111,0)
 .. N CPTINFO,CPTCODE,CPTTEXT
"RTN","SCRPW46",112,0)
 .. S CPTINFO=$$CPT^ICPTCOD(SDI,,1)
"RTN","SCRPW46",113,0)
 .. Q:CPTINFO'>0
"RTN","SCRPW46",114,0)
 .. S CPTCODE=$P(CPTINFO,"^",2)
"RTN","SCRPW46",115,0)
 .. S CPTTEXT=$P(CPTINFO,"^",3)
"RTN","SCRPW46",116,0)
 .. S SDX=CPTCODE_" "_CPTTEXT
"RTN","SCRPW46",117,0)
 .. S:$L(SDX)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDX)=SDI
"RTN","SCRPW46",118,0)
 ..;
"RTN","SCRPW46",119,0)
 ..; loop through mods in CPT array and call API to get mod code/desc
"RTN","SCRPW46",120,0)
 .. S SDI2="" F  S SDI2=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI,SDI2)) Q:'SDI2  D
"RTN","SCRPW46",121,0)
 ... N MODINFO,MODCODE,MODTEXT
"RTN","SCRPW46",122,0)
 ... S MODINFO=$$MOD^ICPTMOD(SDI2,"I",,1)
"RTN","SCRPW46",123,0)
 ... Q:MODINFO'>0
"RTN","SCRPW46",124,0)
 ... S MODCODE=$P(MODINFO,"^",2)
"RTN","SCRPW46",125,0)
 ... S MODTEXT=$P(MODINFO,"^",3)
"RTN","SCRPW46",126,0)
 ... S SDX2=MODCODE_" "_MODTEXT
"RTN","SCRPW46",127,0)
 ... ; add mod code/desc to array
"RTN","SCRPW46",128,0)
 ... S:$L(SDX2)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDX,SDX2)=SDI2
"RTN","SCRPW46",129,0)
 ... Q
"RTN","SCRPW46",130,0)
 ..Q
"RTN","SCRPW46",131,0)
 .;Iterate through criteria combine logic
"RTN","SCRPW46",132,0)
 .;Loop through secondary Division (SDIV) for multiple division episodes
"RTN","SCRPW46",133,0)
 . N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",134,0)
 .. S SDCRI="" F  S SDCRI=$O(SDCRI(SDCRI)) Q:SDCRI=""  D
"RTN","SCRPW46",135,0)
 ... S SDCL=$TR($TR(SDCRI,"'",""),"&","") F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI) D:'$D(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC))
"RTN","SCRPW46",136,0)
 ....;Build list of true items for each criteria element
"RTN","SCRPW46",137,0)
 .... S SDZ=$P(SDPAR(SDC),"^")
"RTN","SCRPW46",138,0)
 .... I SDZ="DL" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDI)) Q:'SDI  D
"RTN","SCRPW46",139,0)
 ..... S:$D(SDPAR(SDC,SDI)) ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=""
"RTN","SCRPW46",140,0)
 ..... Q
"RTN","SCRPW46",141,0)
 .... I SDZ="DR" S SDR1="",SDR1=$O(SDPAR(SDC,SDR1)),SDR2=$O(SDPAR(SDC,SDR1)),SDI="" D
"RTN","SCRPW46",142,0)
 ..... F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DXR",SDI)) Q:SDI=""  D
"RTN","SCRPW46",143,0)
 ...... I SDR1']SDI,SDI']SDR2 S ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=""  Q
"RTN","SCRPW46",144,0)
 ..... Q
"RTN","SCRPW46",145,0)
 .... I SDZ="PL" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)) Q:'SDI  D
"RTN","SCRPW46",146,0)
 ..... I $D(SDPAR(SDC,SDI)) M ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)
"RTN","SCRPW46",147,0)
 ..... Q
"RTN","SCRPW46",148,0)
 .... I SDZ="PR" S SDR1="",SDR1=$O(SDPAR(SDC,SDR1)),SDR2=$O(SDPAR(SDC,SDR1)),SDI="" D
"RTN","SCRPW46",149,0)
 ..... F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDI)) Q:SDI=""  D
"RTN","SCRPW46",150,0)
 ...... I SDR1']SDI,SDI']SDR2 M ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDI)
"RTN","SCRPW46",151,0)
 ......Q
"RTN","SCRPW46",152,0)
 .....Q
"RTN","SCRPW46",153,0)
 ....S ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC)=($D(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC))>0)_U_SDZ
"RTN","SCRPW46",154,0)
 .... Q
"RTN","SCRPW46",155,0)
 ...;Apply criteria combine logic
"RTN","SCRPW46",156,0)
 ...N A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z
"RTN","SCRPW46",157,0)
 ...F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI),@SDC=$P(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC),"^")
"RTN","SCRPW46",158,0)
 ...;If combine logic is "true", move items to final list
"RTN","SCRPW46",159,0)
 ...I @SDCRI F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI),SDX=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC) D
"RTN","SCRPW46",160,0)
 ....I SDX M ^TMP("SCRPW",$J,0,1,DFN,SDIV,$P(SDX,"^",2))=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC)
"RTN","SCRPW46",161,0)
 ....Q
"RTN","SCRPW46",162,0)
 ...Q
"RTN","SCRPW46",163,0)
 .I '$D(^TMP("SCRPW",$J,0,1,DFN)) D  Q
"RTN","SCRPW46",164,0)
 ..S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  K ^TMP("SCRPW",$J,SDIV,1,DFN)
"RTN","SCRPW46",165,0)
 ..Q
"RTN","SCRPW46",166,0)
 .;Move item ifn lists to text lists
"RTN","SCRPW46",167,0)
 .N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",168,0)
 .. S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"DL",SDI)) Q:'SDI  D
"RTN","SCRPW46",169,0)
 ... S SDX=$$ICDDX^ICDCODE(SDI),SDX=$P(SDX,"^",2)_" "_$P(SDX,"^",4) S:$L(SDX)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"DR",SDX)=$G(SDT)
"RTN","SCRPW46",170,0)
        ... Q
"RTN","SCRPW46",171,0)
 .N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",172,0)
 .. S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"PL",SDI)) Q:'SDI  D
"RTN","SCRPW46",173,0)
 ... N CPTINFO,CPTCODE,CPTTEXT
"RTN","SCRPW46",174,0)
 ... S CPTINFO=$$CPT^ICPTCOD(SDI,,1)
"RTN","SCRPW46",175,0)
 ... Q:CPTINFO'>0
"RTN","SCRPW46",176,0)
 ... S CPTCODE=$P(CPTINFO,"^",2)
"RTN","SCRPW46",177,0)
 ... S CPTTEXT=$P(CPTINFO,"^",3)
"RTN","SCRPW46",178,0)
 ... S SDX=CPTCODE_" "_CPTTEXT
"RTN","SCRPW46",179,0)
 ... S:$L(SDX)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"PR",SDX)=""
"RTN","SCRPW46",180,0)
 ... ;
"RTN","SCRPW46",181,0)
 ... ;loop through mods in CPT array and call API to get mod code/desc
"RTN","SCRPW46",182,0)
 ... S SDI2=""
"RTN","SCRPW46",183,0)
 ... F  S SDI2=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"PL",SDI,SDI2)) Q:'SDI2  D
"RTN","SCRPW46",184,0)
 .... N MODINFO,MODCODE,MODTEXT
"RTN","SCRPW46",185,0)
 .... S MODINFO=$$MOD^ICPTMOD(SDI2,"I",,1)
"RTN","SCRPW46",186,0)
 .... Q:MODINFO'>0
"RTN","SCRPW46",187,0)
 .... S MODCODE=$P(MODINFO,"^",2)
"RTN","SCRPW46",188,0)
 .... S MODTEXT=$P(MODINFO,"^",3)
"RTN","SCRPW46",189,0)
 .... S SDX2=MODCODE_" "_MODTEXT
"RTN","SCRPW46",190,0)
 .... ; add mod code/desc to array
"RTN","SCRPW46",191,0)
 .... S:$L(SDX2)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"PR",SDX,SDX2)=""
"RTN","SCRPW46",192,0)
 .... Q 
"RTN","SCRPW46",193,0)
 ...Q
"RTN","SCRPW46",194,0)
 . ; delete procedure list array
"RTN","SCRPW46",195,0)
 . N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",196,0)
 ..;Merge activity list
"RTN","SCRPW46",197,0)
 .. M ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")=^TMP("SCRPW",$J,SDIV,0,DFN,SDIV,"ACT")
"RTN","SCRPW46",198,0)
 ..;Kill scratch list, merge to summary global if multidivisional
"RTN","SCRPW46",199,0)
 ..I SDMD,SDFMT'="P" M ^TMP("SCRPW",$J,0,1,DFN,SDIV,"ACT")=^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")
"RTN","SCRPW46",200,0)
 ..;Delete scratch levels and arrays after merge
"RTN","SCRPW46",201,0)
 .. K ^TMP("SCRPW",$J,0,1,DFN,"DL")
"RTN","SCRPW46",202,0)
 .. K ^TMP("SCRPW",$J,0,1,DFN,"PL")
"RTN","SCRPW46",203,0)
 ..Q
"RTN","SCRPW46",204,0)
 .Q
"RTN","SCRPW46",205,0)
 ;Delete 0,0 scratch level prior to printing
"RTN","SCRPW46",206,0)
 K ^TMP("SCRPW",$J,0,0)
"RTN","SCRPW46",207,0)
 G:SDOUT EXIT^SCRPW47 G ^SCRPW47
"RTN","SCRPW46",208,0)
 ;
"RTN","SCRPW46",209,0)
DIV() ;Check division
"RTN","SCRPW46",210,0)
 Q:'SDDIV 1  Q $D(SDDIV(+SDIV))
"VER")
8.0^22
**END**
**END**
