Released QAN*2*27 SEQ #26
Extracted from mail message
**KIDS**:QAN*2.0*27^

**INSTALL NAME**
QAN*2.0*27
"BLD",1888,0)
QAN*2.0*27^INCIDENT REPORTING^0^2990721^y
"BLD",1888,4,0)
^9.64PA^^0
"BLD",1888,"ABNS",0)
^9.66A^^
"BLD",1888,"ABPKG")
n^n
"BLD",1888,"KRN",0)
^9.67PA^19^18
"BLD",1888,"KRN",.4,0)
.4
"BLD",1888,"KRN",.401,0)
.401
"BLD",1888,"KRN",.402,0)
.402
"BLD",1888,"KRN",.403,0)
.403
"BLD",1888,"KRN",.5,0)
.5
"BLD",1888,"KRN",.84,0)
.84
"BLD",1888,"KRN",3.6,0)
3.6
"BLD",1888,"KRN",3.8,0)
3.8
"BLD",1888,"KRN",9.2,0)
9.2
"BLD",1888,"KRN",9.8,0)
9.8
"BLD",1888,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",1888,"KRN",9.8,"NM",1,0)
QANAHOC^^0^B22569284
"BLD",1888,"KRN",9.8,"NM",2,0)
QANCDNT^^0^B41283685
"BLD",1888,"KRN",9.8,"NM",3,0)
QANUTL2^^0^B22889554
"BLD",1888,"KRN",9.8,"NM",4,0)
QANVAL^^0^B23872839
"BLD",1888,"KRN",9.8,"NM",5,0)
QANUTL1^^0^B31569439
"BLD",1888,"KRN",9.8,"NM",6,0)
QANUTL3^^0^B10351621
"BLD",1888,"KRN",9.8,"NM",7,0)
QANEDIT^^0^B38522566
"BLD",1888,"KRN",9.8,"NM",8,0)
QANQUCK^^0^B18557521
"BLD",1888,"KRN",9.8,"NM","B","QANAHOC",1)

"BLD",1888,"KRN",9.8,"NM","B","QANCDNT",2)

"BLD",1888,"KRN",9.8,"NM","B","QANEDIT",7)

"BLD",1888,"KRN",9.8,"NM","B","QANQUCK",8)

"BLD",1888,"KRN",9.8,"NM","B","QANUTL1",5)

"BLD",1888,"KRN",9.8,"NM","B","QANUTL2",3)

"BLD",1888,"KRN",9.8,"NM","B","QANUTL3",6)

"BLD",1888,"KRN",9.8,"NM","B","QANVAL",4)

"BLD",1888,"KRN",19,0)
19
"BLD",1888,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",1888,"KRN",19,"NM",1,0)
QAN INCIDENT MAIL TO REGION^^0
"BLD",1888,"KRN",19,"NM",2,0)
QAN EARLY WARNING SYSTEM MAN^^0
"BLD",1888,"KRN",19,"NM",3,0)
QAN INCIDENT SUMMARY REGION^^0
"BLD",1888,"KRN",19,"NM",4,0)
QAN INCIDENT REGION STATUS^^0
"BLD",1888,"KRN",19,"NM",5,0)
QAN BRIEF EDIT^^0
"BLD",1888,"KRN",19,"NM","B","QAN BRIEF EDIT",5)

"BLD",1888,"KRN",19,"NM","B","QAN EARLY WARNING SYSTEM MAN",2)

"BLD",1888,"KRN",19,"NM","B","QAN INCIDENT MAIL TO REGION",1)

"BLD",1888,"KRN",19,"NM","B","QAN INCIDENT REGION STATUS",4)

"BLD",1888,"KRN",19,"NM","B","QAN INCIDENT SUMMARY REGION",3)

"BLD",1888,"KRN",19.1,0)
19.1
"BLD",1888,"KRN",101,0)
101
"BLD",1888,"KRN",409.61,0)
409.61
"BLD",1888,"KRN",771,0)
771
"BLD",1888,"KRN",869.2,0)
869.2
"BLD",1888,"KRN",870,0)
870
"BLD",1888,"KRN",8994,0)
8994
"BLD",1888,"KRN","B",.4,.4)

"BLD",1888,"KRN","B",.401,.401)

"BLD",1888,"KRN","B",.402,.402)

"BLD",1888,"KRN","B",.403,.403)

"BLD",1888,"KRN","B",.5,.5)

"BLD",1888,"KRN","B",.84,.84)

"BLD",1888,"KRN","B",3.6,3.6)

"BLD",1888,"KRN","B",3.8,3.8)

"BLD",1888,"KRN","B",9.2,9.2)

"BLD",1888,"KRN","B",9.8,9.8)

"BLD",1888,"KRN","B",19,19)

"BLD",1888,"KRN","B",19.1,19.1)

"BLD",1888,"KRN","B",101,101)

"BLD",1888,"KRN","B",409.61,409.61)

"BLD",1888,"KRN","B",771,771)

"BLD",1888,"KRN","B",869.2,869.2)

"BLD",1888,"KRN","B",870,870)

"BLD",1888,"KRN","B",8994,8994)

"BLD",1888,"QUES",0)
^9.62^^
"BLD",1888,"REQB",0)
^9.611^^
"KRN",19,5276,-1)
0^1
"KRN",19,5276,0)
QAN INCIDENT MAIL TO REGION^Mail to Region^Option has been discontinued.^R^^^^^^^^INCIDENT REPORTING
"KRN",19,5276,1,0)
^^3^3^2920721^^^^
"KRN",19,5276,1,1,0)
Allows the mailing of the appropriate message to the regional office 
"KRN",19,5276,1,2,0)
informing the region of an incident.
"KRN",19,5276,1,3,0)
 
"KRN",19,5276,25)
QANMAIL
"KRN",19,5276,"U")
MAIL TO REGION
"KRN",19,5279,-1)
0^2
"KRN",19,5279,0)
QAN EARLY WARNING SYSTEM MAN^Early Warning System Manual^Option has been discontinued.^R^^^^^^^^INCIDENT REPORTING
"KRN",19,5279,1,0)
^^1^1^2920727^^^^
"KRN",19,5279,1,1,0)
Manual generation of a Early Warning System message to regional office.
"KRN",19,5279,25)
EN1^QANEWS0
"KRN",19,5279,"U")
EARLY WARNING SYSTEM MANUAL
"KRN",19,5284,-1)
0^4
"KRN",19,5284,0)
QAN INCIDENT REGION STATUS^Edit Incident Regional Status^Option has been discontinued.^E^^^^^^^^INCIDENT REPORTING^^^1
"KRN",19,5284,1,0)
^^1^1^2920715^^^^
"KRN",19,5284,1,1,0)
Allows the edit of the field 'INCIDENT SENT TO REGION'.
"KRN",19,5284,15)
K %Y,DI,DQ
"KRN",19,5284,30)
QA(742.4,
"KRN",19,5284,31)
QEAMNZ
"KRN",19,5284,32)
Select Incident: 
"KRN",19,5284,34)
I $P(^(0),U,18)=1
"KRN",19,5284,50)
742.4
"KRN",19,5284,51)
.21
"KRN",19,5284,"U")
EDIT INCIDENT REGIONAL STATUS
"KRN",19,5287,-1)
0^3
"KRN",19,5287,0)
QAN INCIDENT SUMMARY REGION^Incident Summary to Region.^Option has been discontinued.^R^^^^^^^^INCIDENT REPORTING
"KRN",19,5287,1,0)
^^2^2^2920709^^
"KRN",19,5287,1,1,0)
Accumulates incident/patient data for a quarter, then rolls the data up to
"KRN",19,5287,1,2,0)
a regional file. (NQADB Incident Summary-14726)
"KRN",19,5287,25)
QANSUMM
"KRN",19,5287,"U")
INCIDENT SUMMARY TO REGION.
"KRN",19,9971,-1)
0^5
"KRN",19,9971,0)
QAN BRIEF EDIT^Edit Existing Brief Incident^^R^^^^^^^^INCIDENT REPORTING
"KRN",19,9971,1,0)
^^2^2^2990420^
"KRN",19,9971,1,1,0)
This option can be used by the services to edit an Incident, if it is still
"KRN",19,9971,1,2,0)
open and if it was entered by the same user.
"KRN",19,9971,25)
QANEDIT
"KRN",19,9971,"U")
EDIT EXISTING BRIEF INCIDENT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",371,-1)
1^1
"PKG",371,0)
INCIDENT REPORTING^QAN^This package is designed to track a hospital incident.
"PKG",371,20,0)
^9.402P^^
"PKG",371,22,0)
^9.49I^1^1
"PKG",371,22,1,0)
2.0^2921015^2950914
"PKG",371,22,1,"PAH",1,0)
27^2990721
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","QANAHOC")
0^1^B22569284
"RTN","QANAHOC",1,0)
QANAHOC ;HISC/DAD-Ad Hoc Report interface for the QA Patient Incident Review file (#742) ;2/8/93  10:12
"RTN","QANAHOC",2,0)
 ;;2.0;Incident Reporting;**1,15,17,27**;08/07/1992
"RTN","QANAHOC",3,0)
 ; *** Set up required and optional variables and call Ad Hoc Rpt Gen
"RTN","QANAHOC",4,0)
 S QAQMRTN="MENU^QANAHOC",QAQORTN="OTHER^QANAHOC",QAQDIC=742
"RTN","QANAHOC",5,0)
 S QANXIT=0 D ^QAQAHOC0
"RTN","QANAHOC",6,0)
 K %Y,B,D,DIJ,DP,QAND0,QAQ,QANXIT,QAQFOUND,QB,QC
"RTN","QANAHOC",7,0)
 Q
"RTN","QANAHOC",8,0)
CONVERT ;Convert sort parameters for Incident Case Status.
"RTN","QANAHOC",9,0)
 ;Codes from ^DD(742.4,.09,0)
"RTN","QANAHOC",10,0)
 ;0 --->'Closed'               1 --->'Open'
"RTN","QANAHOC",11,0)
 ;2 --->'Deleted'              3 --->'Quick'
"RTN","QANAHOC",12,0)
 Q:'$D(QAQBEGIN(QB))!('$D(QAQEND(QB)))
"RTN","QANAHOC",13,0)
 Q:(QAQBEGIN(QB)=0)&(QAQEND(QB)=0)
"RTN","QANAHOC",14,0)
 Q:(QAQBEGIN(QB)=2)&(QAQEND(QB)=2)
"RTN","QANAHOC",15,0)
 ;Quit if the input vars do not exist, of if 'open' is not included in
"RTN","QANAHOC",16,0)
 ;the sort parameters.
"RTN","QANAHOC",17,0)
 ;If 'open' is included, and 'deleted' is not, screen out 'deleted'.
"RTN","QANAHOC",18,0)
 ;If 'open' is included, and 'closed' is not, screen out 'closed'.
"RTN","QANAHOC",19,0)
 I QAQBEGIN(QB)=0,(QAQEND(QB)=1) D  Q
"RTN","QANAHOC",20,0)
 . S TO(QB)=3
"RTN","QANAHOC",21,0)
 . S DIS(0)="S QAND0=$P($G(^QA(742,D0,0)),U,3) I ($P($G(^QA(742.4,QAND0,0)),U,8))#3'>1"
"RTN","QANAHOC",22,0)
 I QAQBEGIN(QB)=0,(QAQEND(QB)=2) S TO(QB)=3 Q
"RTN","QANAHOC",23,0)
 I QAQBEGIN(QB)=1,(QAQEND(QB)=1) D  Q
"RTN","QANAHOC",24,0)
 . S TO(QB)=3
"RTN","QANAHOC",25,0)
 . S DIS(0)="S QAND0=$P($G(^QA(742,D0,0)),U,3) I $P($G(^QA(742.4,QAND0,0)),U,8)>0,($P($G(^QA(742.4,QAND0,0)),U,8)#3'>1)"
"RTN","QANAHOC",26,0)
 I QAQBEGIN(QB)=1,(QAQEND(QB)=2) S TO(QB)=3 Q
"RTN","QANAHOC",27,0)
 Q
"RTN","QANAHOC",28,0)
MENU ; *** Build the menu array
"RTN","QANAHOC",29,0)
 F QA=1:1 S X=$P($T(TEXT+QA),";;",2,99) Q:X=""  S QAQMENU(QA)=X
"RTN","QANAHOC",30,0)
 Q
"RTN","QANAHOC",31,0)
OTHER ; *** Set up other (optional) EN1^DIP variables, e.g.
"RTN","QANAHOC",32,0)
 ; *** DCOPIES,DHD,DHIT,DIOBEG,DIOEND,DIS(),IOP,PG
"RTN","QANAHOC",33,0)
 K DIS,QAQFOUND S QAQFOUND=0,DHIT="S QAQFOUND=1"
"RTN","QANAHOC",34,0)
 S DIOEND="I 'QAQFOUND W !!,""No data found for this report !!"""
"RTN","QANAHOC",35,0)
 ;Check if 'Incident Case Status' is a sort field.
"RTN","QANAHOC",36,0)
 F QB=0:0 S QB=$O(QAQOPTN("S",QB)) Q:QB'>0!(QANXIT)  D
"RTN","QANAHOC",37,0)
 . S QC=$O(QAQOPTN("S",QB,0)) Q:QC'>0
"RTN","QANAHOC",38,0)
 . I $P(QAQOPTN("S",QB,QC),";",1)=".03:,.09" S QANXIT=1 D CONVERT
"RTN","QANAHOC",39,0)
 F  S %=2 W !!?5,"Do you want the report to include 'deleted' records" D YN^DICN Q:"-12"[%  W !?5,"Please answer (Y)es or (N)o."
"RTN","QANAHOC",40,0)
 I %=2 D
"RTN","QANAHOC",41,0)
 . I $D(DIS(0)) S DIS(0)=DIS(0)_",($P($G(^QA(742,D0,0)),U,12)'=-1),($P($G(^QA(742.4,QAND0,0)),U,8)'=2)"
"RTN","QANAHOC",42,0)
 . E  S DIS(0)="S QAND0=$P($G(^QA(742,D0,0)),U,3) I $P($G(^QA(742,D0,0)),U,12)'=-1,($P($G(^QA(742.4,QAND0,0)),U,8)'=2)"
"RTN","QANAHOC",43,0)
 Q
"RTN","QANAHOC",44,0)
TEXT ;;*** Sort Yes/No ^ Menu Text ^ ~Field # ^ DIR(0)
"RTN","QANAHOC",45,0)
 ;;1^Patient^~.01;"Patient"^PAO^2:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",46,0)
 ;;1^Patient Id^~.02;"Patient Id"^FAO^1:30^
"RTN","QANAHOC",47,0)
 ;;1^Date of Admission^~.04;"Date Of Admission"^DAO^::AET^S Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))
"RTN","QANAHOC",48,0)
 ;;1^Patient Type^~.05;"Patient Type"^SO^0:OUTPATIENT;1:INPATIENT;^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",49,0)
 ;;1^Ward/Clinic^~.06;"Ward/Clinic"^PAO^44:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",50,0)
 ;;1^Treating Specialty^~.07;"Treating Specialty"^PAO^45.7:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",51,0)
 ;;1^Service^~.08;"Service"^PAO^730:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",52,0)
 ;;1^Responsible Service^.12,~.01;"Responsible Service"^PAO^730:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",53,0)
 ;;1^Medication Errors^~.11;"Medication Errors"^PAO^742.13:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",54,0)
 ;;0^Case Number^~.03:.01;"Case Number"^FAO^7:13^
"RTN","QANAHOC",55,0)
 ;;1^Incident^~.03:.02;"Incident"^PAO^742.1:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",56,0)
 ;;1^Incident Location^~.03:.04;"Incident Location"^PAO^742.5:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",57,0)
 ;;1^Type of Death^~.03:.15;"Type of Death"^PAO^742.14:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",58,0)
 ;;1^Level of Review^~.03:.12;"Level of Review"^SO^^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",59,0)
 ;;1^Date of Incident^~.03:.03;"Date of Incident"^DAO^::AET^S Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))
"RTN","QANAHOC",60,0)
 ;;1^Incident Case Status^~.03:,.09;"Incident Case Status"^SO^0:CLOSED;1:OPEN;2:DELETED;^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",61,0)
 ;;1^Severity Level^~.1;"Severity Level"^SO^0:NO INJURY OR DISABILITY;1:MINOR;2:MAJOR;3:DEATH;^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",62,0)
 ;;1^National Case Status^~.03:.17;"National Case Status"^SO^^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",63,0)
 ;;0^Fall Assessment Score^~.09;"Fall Assessment Score"^FAO^1:3^
"RTN","QANAHOC",64,0)
 ;;0^Person Reporting the Incident^~.03:.06;"Person Reporting the Incident"^PAO^200:AEMNQZ^I $D(Y(0,0))#2 S Y=$P(Y(0,0),U)
"RTN","QANAHOC",65,0)
 ;;0^Patient Diagnosis^.15,~.01;"Patient Diagnosis"^FAO^3:60^
"RTN","QANAHOC",66,0)
 ;;0^Medical Center Action^.03:.16;"Medical Center Action"^SO^1:CHANGE IN POLICY/PROCEDURE;2:EDUCATION/TRAINING;3:SYSTEMS CHANGE;4:DISCIPLINARY;5:DISTRICT COUNCIL NOTIFIED;6:NONE INDICATED;^;I $D(Y(0))#2 S Y=$P(Y(0),U)
"RTN","QANAHOC",67,0)
 ;;0^Incident Description^.03:.05;"Incident Description"^
"RTN","QANAHOC",68,0)
 ;;0^Pertinent Information^.03:.2;"Pertinent Information"^
"RTN","QANCDNT")
0^2^B41283685
"RTN","QANCDNT",1,0)
QANCDNT ;HISC/GJC-Initial sighting of an incident ;10/9/92
"RTN","QANCDNT",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27**;08/07/1992
"RTN","QANCDNT",3,0)
 ;
"RTN","QANCDNT",4,0)
 D NEWREC I $G(QANLOCK)=1 L -^QA(742.4) S QANLOCK=0 Q
"RTN","QANCDNT",5,0)
 D DIE
"RTN","QANCDNT",6,0)
 Q
"RTN","QANCDNT",7,0)
NEWREC ;create new record number
"RTN","QANCDNT",8,0)
 ;record number will be in the format XXX.YYnnnn where XXX is the
"RTN","QANCDNT",9,0)
 ;three digigt station number, YY is the 2 digit year and nnnn is
"RTN","QANCDNT",10,0)
 ;the sequence number (and is also the IEN of file 742.4)
"RTN","QANCDNT",11,0)
 N EE,QANCNT,QANLIST,QANNO
"RTN","QANCDNT",12,0)
 K QANLOCK
"RTN","QANCDNT",13,0)
 L +^QA(742.4):10 I '$T W !!,"Another user is editing this file." S QANLOCK=1 Q
"RTN","QANCDNT",14,0)
 S (QANFLAG,QANXIT,QANOUT)=0,QANST=$S($D(^QA(740,1,0))#2:$P(^(0),"^"),1:""),QANST1=$S($D(^DIC(4,QANST,99))#2:$P(^(99),"^"),1:QANST)
"RTN","QANCDNT",15,0)
 S QANDUZ=$S($D(DUZ):DUZ,1:""),QANTTL=$P(^VA(200,QANDUZ,0),U,9)
"RTN","QANCDNT",16,0)
 ;set QANDT variable as "." concatonated with 2 digit year, so that
"RTN","QANCDNT",17,0)
 ;years 2000-2009 don't have leading zeroes.
"RTN","QANCDNT",18,0)
 S QANDT=$S($D(DT):$E(DT,2,3),1:""),QANDT="."_QANDT
"RTN","QANCDNT",19,0)
 S QANINCR=+$P($G(^QA(742.4,0)),U,3)+1 ;Grab the new IEN
"RTN","QANCDNT",20,0)
 F  Q:$D(^QA(742.4,QANINCR,0))=0  S QANINCR=QANINCR+1
"RTN","QANCDNT",21,0)
 S QANCODE(0)=QANDT_QANINCR
"RTN","QANCDNT",22,0)
 I $L(QANINCR)<4 S QANCODE(0)=QANDT_$E("000",1,(4-$L(QANINCR)))_QANINCR
"RTN","QANCDNT",23,0)
 S QANCODE(1)=QANST1_QANCODE(0)
"RTN","QANCDNT",24,0)
 S QANCHK=$O(^QA(742.4,"B",QANCODE(1),0)) I +QANCHK,$D(^(QANCHK))#2 D  Q
"RTN","QANCDNT",25,0)
 . W !!,$C(7),"CASE NUMBER VIOLATION, CONTACT YOUR QA COORDINATOR!!"
"RTN","QANCDNT",26,0)
 . S QANXIT=1
"RTN","QANCDNT",27,0)
 . K QANST,QANST1,QANDT,QANCODE,QANINCR,QANFLAG,QANOUT,QANDUZ,QANCHK,QANTTL
"RTN","QANCDNT",28,0)
 . L -^QA(742.4)
"RTN","QANCDNT",29,0)
 K DIC,DD,DO,DLAYGO,DINUM S (DIC,DIE)="^QA(742.4,",DIC(0)="L",X=QANCODE(1)
"RTN","QANCDNT",30,0)
 D FILE^DICN
"RTN","QANCDNT",31,0)
 L -^QA(742.4)
"RTN","QANCDNT",32,0)
 K DIC,DD,DO,DLAYGO,DINUM
"RTN","QANCDNT",33,0)
 L +^QA(742.4,+Y):10 I '$T W !!,"Another user is editing this incident." S QANLOCK=1 Q
"RTN","QANCDNT",34,0)
 S QANBFLG=1 ;set brief flag so that if this subroutine was called
"RTN","QANCDNT",35,0)
 ;from full incident edit you do not re-lock the record when you
"RTN","QANCDNT",36,0)
 ;get back to full incident edit.
"RTN","QANCDNT",37,0)
 Q:+Y<1  S QANIEN=+Y
"RTN","QANCDNT",38,0)
 S QANHOME=$G(^QA(742.4,QANIEN,0)),$P(QANHOME,U,5)=QANDUZ,$P(QANHOME,U,6)=QANTTL,$P(QANHOME,U,15)=1,$P(QANHOME,U,8)=1
"RTN","QANCDNT",39,0)
 K DA,DIK S DIK="^QA(742.4,",DA=QANIEN,^QA(742.4,QANIEN,0)=QANHOME D IX1^DIK K DA,DIK
"RTN","QANCDNT",40,0)
 Q
"RTN","QANCDNT",41,0)
DIE S DIE="^QA(742.4,",DA=QANIEN,DR=".02;.03;.04;S X=X"
"RTN","QANCDNT",42,0)
 D ^DIE K DIE,DR I $D(Y) D DEL Q:QANXIT
"RTN","QANCDNT",43,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANCDNT",44,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)  ;get the patient(s)
"RTN","QANCDNT",45,0)
 Q:QANXIT  ;!(QANOUT)
"RTN","QANCDNT",46,0)
SC1 K Y S DIE="^QA(742.4,",DA=QANIEN,DR=".05;@1;.08;S X=X" D ^DIE K DIE,DR I $D(Y) D DEL Q:QANXIT
"RTN","QANCDNT",47,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANCDNT",48,0)
 I $G(QANFFLG)<1 D DISP
"RTN","QANCDNT",49,0)
 I $G(QANFFLG)<1 L -^QA(742.4,QANIEN) ;if this subroutine has not
"RTN","QANCDNT",50,0)
 ;been called from the full incident edit, then unlock incident report.
"RTN","QANCDNT",51,0)
 D ^QANBRIF ;transmit message to local mail group
"RTN","QANCDNT",52,0)
 Q
"RTN","QANCDNT",53,0)
DEL ;Delete incident.
"RTN","QANCDNT",54,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANCDNT",55,0)
 Q
"RTN","QANCDNT",56,0)
PAT ;Patient data.
"RTN","QANCDNT",57,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANCDNT",58,0)
 D MIX^DIC1 K DIC S:+Y<1&($G(QANFLAG)) QANOUT=1
"RTN","QANCDNT",59,0)
 D:+Y<1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",60,0)
 F  D  Q:"-12"[%
"RTN","QANCDNT",61,0)
 . W !?5,$G(Y(0,0))_" OK"
"RTN","QANCDNT",62,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANCDNT",63,0)
 . W " Confirm that this is the correct patient."
"RTN","QANCDNT",64,0)
 D:%=-1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",65,0)
 I %=-1,($G(QANFLAG)) S QANXIT=1 Q
"RTN","QANCDNT",66,0)
 I %=2 W " ??" G PAT
"RTN","QANCDNT",67,0)
 D PRIOR I QANXIT D  Q
"RTN","QANCDNT",68,0)
 . I '$G(QANFLAG) K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANCDNT",69,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANCDNT",70,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANCDNT",71,0)
 I $G(QANXIT)!($G(QANOUT)) D DEL Q
"RTN","QANCDNT",72,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANCDNT",73,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANCDNT",74,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANCDNT",75,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANCDNT",76,0)
 S QANPID=$E($P(Y(0,0),",",2))_$E($P(Y(0,0)," ",2))_$E($P(Y(0,0),","))_$E(QANSSN,6,9)
"RTN","QANCDNT",77,0)
 D ADMDT^QANUTL1
"RTN","QANCDNT",78,0)
 L +^QA(742):10 I '$T W !!,"Another user is editing this file." Q
"RTN","QANCDNT",79,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANCDNT",80,0)
 I +Y=-1,('$G(QANFLAG)) D DEL Q
"RTN","QANCDNT",81,0)
 I +Y=-1,($G(QANFLAG)) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANCDNT",82,0)
 S QANDFN=+Y
"RTN","QANCDNT",83,0)
 L -^QA(742)
"RTN","QANCDNT",84,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANCDNT",85,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANCDNT",86,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANCDNT",87,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANCDNT",88,0)
 L -^QA(742,QANDFN)
"RTN","QANCDNT",89,0)
 S QANFLAG=1 D:'$D(QANF) BULL^QANUTL3
"RTN","QANCDNT",90,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANCDNT",91,0)
 Q
"RTN","QANCDNT",92,0)
PRIOR ;
"RTN","QANCDNT",93,0)
 S QANTST(1)=$G(^QA(742.4,QANIEN,0))
"RTN","QANCDNT",94,0)
 S QANTST("INC")=$P(QANTST(1),U,2),QANTST("DATE")=$P(QANTST(1),U,3)
"RTN","QANCDNT",95,0)
 F QAN99=0:0 S QAN99=$O(^QA(742,"AA",+Y,QAN99)) Q:QAN99'>0!(QANXIT)  S QANPRS=+$O(^QA(742,"AA",+Y,QAN99,"")) I QANPRS>0,($P(^QA(742,QANPRS,0),U,12)'<0) S QANTST(2)=$G(^QA(742.4,QAN99,0)) D PRIOR1
"RTN","QANCDNT",96,0)
 K QAN99,QANPRS,QANTST
"RTN","QANCDNT",97,0)
 Q
"RTN","QANCDNT",98,0)
PRIOR1 ;
"RTN","QANCDNT",99,0)
 I (QANTST("INC")=$P(QANTST(2),U,2)),(QANTST("DATE")=$P(QANTST(2),U,3)) D
"RTN","QANCDNT",100,0)
 . W !!,$C(7),"Patient "_$P(^DPT(+Y,0),U)_" has a duplicate incident on record."
"RTN","QANCDNT",101,0)
 . W:'$G(QANFLAG) !,"Deleting the incident."
"RTN","QANCDNT",102,0)
 . W:$G(QANFLAG) !,"Exiting!"
"RTN","QANCDNT",103,0)
 . S QANXIT=1
"RTN","QANCDNT",104,0)
 Q
"RTN","QANCDNT",105,0)
DISP ;display to user what has been entered and ask if it's okay
"RTN","QANCDNT",106,0)
 N QANCC,QANEE
"RTN","QANCDNT",107,0)
 W @IOF
"RTN","QANCDNT",108,0)
 S QAN74240=^QA(742.4,QANIEN,0)
"RTN","QANCDNT",109,0)
 W !!!,"Incident Report: "_$P(QAN74240,U)
"RTN","QANCDNT",110,0)
 S Y=$P(QAN74240,U,3) D DD^%DT
"RTN","QANCDNT",111,0)
 W ?35,"Date/Time of Incident: "_Y
"RTN","QANCDNT",112,0)
 W !,"Patient:"
"RTN","QANCDNT",113,0)
 S QANCC=0 F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANCDNT",114,0)
 . W ?10,$P(^DPT($P(^QA(742,QANCC,0),U),0),U),!
"RTN","QANCDNT",115,0)
 W !,"Incident Type: "
"RTN","QANCDNT",116,0)
 I $P(QAN74240,U,2)]"" W $P(^QA(742.1,$P(QAN74240,U,2),0),U)
"RTN","QANCDNT",117,0)
 W !,"Incident Location: "
"RTN","QANCDNT",118,0)
 I $P(QAN74240,U,4)]"" W $P(^QA(742.5,$P(QAN74240,U,4),0),U)
"RTN","QANCDNT",119,0)
 W !,"Was the Incident Witnessed?: "_$S($P(QAN74240,U,7)=1:"Yes",$P(QAN74240,U,7)=0:"No",1:"")
"RTN","QANCDNT",120,0)
 W !,"Incident Description:"
"RTN","QANCDNT",121,0)
 S QANEE=0 F  S QANEE=$O(^QA(742.4,QANIEN,1,QANEE)) Q:QANEE'>0  D
"RTN","QANCDNT",122,0)
 . W !?3,^QA(742.4,QANIEN,1,QANEE,0)
"RTN","QANCDNT",123,0)
 W !!
"RTN","QANCDNT",124,0)
 S DIR("A")="Is this information correct? "
"RTN","QANCDNT",125,0)
 S DIR("B")="Yes"
"RTN","QANCDNT",126,0)
 S DIR("?")="Enter 'Yes' or 'No'."
"RTN","QANCDNT",127,0)
 S DIR(0)="YAO"
"RTN","QANCDNT",128,0)
 S DIR("?",1)="Enter 'Yes' if the information displayed is correct."
"RTN","QANCDNT",129,0)
 S DIR("?",2)="Enter 'No' if you need to edit this information."
"RTN","QANCDNT",130,0)
 D ^DIR
"RTN","QANCDNT",131,0)
 I Y=0 S QANOUT=0 D DIE^QANEDIT
"RTN","QANCDNT",132,0)
 Q
"RTN","QANEDIT")
0^7^B38522566
"RTN","QANEDIT",1,0)
QANEDIT ;WCIOFO/ERC-Edit a Brief Incident ;4/22/99
"RTN","QANEDIT",2,0)
 ;;2.0;Incident Reporting;**27**;08/07/1992
"RTN","QANEDIT",3,0)
 ;
"RTN","QANEDIT",4,0)
START ;
"RTN","QANEDIT",5,0)
 W @IOF
"RTN","QANEDIT",6,0)
 N QANIEN
"RTN","QANEDIT",7,0)
 F  W !!,"Do you want to edit one of your open Incident Reports" S %=1 D YN^DICN Q:"-112"[%  W !!,"Enter (Y)es, (N)o or ""^"" to exit"
"RTN","QANEDIT",8,0)
 I %=1 D EDIT
"RTN","QANEDIT",9,0)
 K QANXIT
"RTN","QANEDIT",10,0)
 Q
"RTN","QANEDIT",11,0)
EDIT ;
"RTN","QANEDIT",12,0)
 K ^TMP("QAN EDIT")
"RTN","QANEDIT",13,0)
 S QANCNT=1
"RTN","QANEDIT",14,0)
 S QANDUZ=DUZ
"RTN","QANEDIT",15,0)
 S QANEE=0
"RTN","QANEDIT",16,0)
 F  S QANEE=$O(^QA(742.4,"ACS",1,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",17,0)
 . I QANDUZ=$P(^QA(742.4,QANEE,0),U,5) S ^TMP("QAN EDIT",$J,QANCNT,QANEE)="",QANCNT=QANCNT+1
"RTN","QANEDIT",18,0)
 W @IOF
"RTN","QANEDIT",19,0)
 I '$D(^TMP("QAN EDIT")) D  Q
"RTN","QANEDIT",20,0)
 . W !!,"**** You have no open Incident Reports to edit.  Exiting.",!!
"RTN","QANEDIT",21,0)
 W !!,"Here are your open Incident Reports."
"RTN","QANEDIT",22,0)
 S QANEE=0
"RTN","QANEDIT",23,0)
 S QANTOT=0
"RTN","QANEDIT",24,0)
 F  S QANEE=$O(^TMP("QAN EDIT",$J,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",25,0)
 . S QANIEN=$O(^TMP("QAN EDIT",$J,QANEE,0)) Q:QANIEN'>0
"RTN","QANEDIT",26,0)
 . S QAN0=^QA(742.4,QANIEN,0)
"RTN","QANEDIT",27,0)
 . S QANCC=0,QANCNT=1
"RTN","QANEDIT",28,0)
 . S QANTOT=QANTOT+1 ;gets number of IRs for selecting record to edit
"RTN","QANEDIT",29,0)
 . F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANEDIT",30,0)
 . . S QANNAME=$P(^DPT($P(^QA(742,QANCC,0),U),0),U)
"RTN","QANEDIT",31,0)
 . . S Y=$P(QAN0,U,3) D DD^%DT S QANDATE=Y
"RTN","QANEDIT",32,0)
 . . S QANINC=$P(^QA(742.1,$P(QAN0,U,2),0),U)
"RTN","QANEDIT",33,0)
 . . I $Y>(IOSL-6) K DIR S DIR(0)="E" D ^DIR K DIR W @IOF
"RTN","QANEDIT",34,0)
 . . I QANCNT=1 W !,QANEE,?4,QANDATE,?25,$E(QANINC,1,25),?51,QANNAME
"RTN","QANEDIT",35,0)
 . . I QANCNT>1 W !?51,QANNAME
"RTN","QANEDIT",36,0)
 . . S QANCNT=QANCNT+1
"RTN","QANEDIT",37,0)
DIR ;
"RTN","QANEDIT",38,0)
 I $G(QANTOT)=1 S QANIEN=$O(^TMP("QAN EDIT",$J,1,0)) G DIE
"RTN","QANEDIT",39,0)
 K DIR
"RTN","QANEDIT",40,0)
 S DIR(0)="NOA"
"RTN","QANEDIT",41,0)
 S DIR("A")="Select a number from 1 to "_QANTOT_": "
"RTN","QANEDIT",42,0)
 D ^DIR K DIR Q:$D(DIRUT)!(+Y<1)
"RTN","QANEDIT",43,0)
 I +Y>QANTOT W !,"Number selected must be from 1 to "_QANTOT_", try again." G DIR
"RTN","QANEDIT",44,0)
 S QANIEN=$O(^TMP("QAN EDIT",$J,+Y,0))
"RTN","QANEDIT",45,0)
 I $G(QANIEN)]"",($D(^QA(742.4,QANIEN,0))) D
"RTN","QANEDIT",46,0)
 . L +^QA(742.4,QANIEN):5 I '$T W !!,"Another user is editing this record." Q
"RTN","QANEDIT",47,0)
 . S QANEDFLG=1
"RTN","QANEDIT",48,0)
 . D DIE
"RTN","QANEDIT",49,0)
 . D EXIT
"RTN","QANEDIT",50,0)
 Q
"RTN","QANEDIT",51,0)
DIE ;
"RTN","QANEDIT",52,0)
 W !!
"RTN","QANEDIT",53,0)
 N QANCNT,QANEE
"RTN","QANEDIT",54,0)
 S QANEFLG=0
"RTN","QANEDIT",55,0)
 S QANEE=0
"RTN","QANEDIT",56,0)
 S QANCNT=1
"RTN","QANEDIT",57,0)
 F  S QANEE=$O(^QA(742,"BCS",QANIEN,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",58,0)
 . S QANPAT(QANCNT)=QANEE
"RTN","QANEDIT",59,0)
 . S QANCNT=QANCNT+1
"RTN","QANEDIT",60,0)
 K DIE S DIE="^QA(742.4,",DA=QANIEN,DR=".02;.03;.04"
"RTN","QANEDIT",61,0)
 D ^DIE K DIE
"RTN","QANEDIT",62,0)
 L -^QA(742.4,QANIEN)
"RTN","QANEDIT",63,0)
PAT ;edit patient(s) on report
"RTN","QANEDIT",64,0)
 W !,"Patient(s) on this Incident Report."
"RTN","QANEDIT",65,0)
 S QANEE=0
"RTN","QANEDIT",66,0)
 S QANCNT=1
"RTN","QANEDIT",67,0)
 F  S QANEE=$O(QANPAT(QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",68,0)
 . S QANPNUM(QANEE)=$P(^QA(742,QANPAT(QANEE),0),U)
"RTN","QANEDIT",69,0)
 . S QANPNAM(QANEE)=$P(^DPT(QANPNUM(QANEE),0),U)
"RTN","QANEDIT",70,0)
 . W !?5,QANCNT,"  ",QANPNAM(QANEE)
"RTN","QANEDIT",71,0)
 . S QANCNT=QANCNT+1
"RTN","QANEDIT",72,0)
 S DIR("A")="Is this correct"
"RTN","QANEDIT",73,0)
 S DIR("B")="YES"
"RTN","QANEDIT",74,0)
 S DIR(0)="Y"
"RTN","QANEDIT",75,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",76,0)
 I Y<1 D
"RTN","QANEDIT",77,0)
 . S DIR(0)="Y",DIR("A")="Would you like to add a patient"
"RTN","QANEDIT",78,0)
 . S DIR("B")="YES"
"RTN","QANEDIT",79,0)
 . K DIRUT
"RTN","QANEDIT",80,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",81,0)
 . I Y=1 D PTADD S (QANEFLG,QANEDFLG)=1 Q
"RTN","QANEDIT",82,0)
 . K DIR S DIR(0)="Y",DIR("A")="Would you like to delete a patient"
"RTN","QANEDIT",83,0)
 . S DIR("B")="NO"
"RTN","QANEDIT",84,0)
 . K DIRUT
"RTN","QANEDIT",85,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",86,0)
 . I Y=1 D PTDEL S (QANEFLG,QANEDFLG)=1
"RTN","QANEDIT",87,0)
 I $G(QANEFLG)=1 S QANEFLG=0 G PAT
"RTN","QANEDIT",88,0)
 K DIE S DIE="^QA(742.4,",DR=".05;.08"
"RTN","QANEDIT",89,0)
 D ^DIE K DIE
"RTN","QANEDIT",90,0)
 ;D EXIT
"RTN","QANEDIT",91,0)
 Q
"RTN","QANEDIT",92,0)
PTADD ;
"RTN","QANEDIT",93,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANEDIT",94,0)
 D MIX^DIC1 K DIC
"RTN","QANEDIT",95,0)
 I +Y<1 S QANXIT=1 Q
"RTN","QANEDIT",96,0)
 F  D  Q:"-12"[%
"RTN","QANEDIT",97,0)
 . W !?5,$G(Y(0,0))_" OK"
"RTN","QANEDIT",98,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANEDIT",99,0)
 . W " Confirm that this is the correct patient."
"RTN","QANEDIT",100,0)
 I %=-1 S QANXIT=1 Q
"RTN","QANEDIT",101,0)
 I %=2 W " ??" G PTADD
"RTN","QANEDIT",102,0)
 S QANEE=0
"RTN","QANEDIT",103,0)
 F  S QANEE=$O(QANPNUM(QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",104,0)
 . I +Y=QANPNUM(QANEE) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y S QANXFLG=1 Q
"RTN","QANEDIT",105,0)
 I $G(QANXFLG)=1 S QANXFLG=0 G PTADD
"RTN","QANEDIT",106,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PTADD
"RTN","QANEDIT",107,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANEDIT",108,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANEDIT",109,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANEDIT",110,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANEDIT",111,0)
 S QANPID=$E($P(Y(0,0),",",2))_$E($P(Y(0,0)," ",2))_$E($P(Y(0,0),","))_$E(QANSSN,6,9)
"RTN","QANEDIT",112,0)
 D ADMDT^QANUTL1
"RTN","QANEDIT",113,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANEDIT",114,0)
 I +Y=-1,($G(QANFLAG)) S QANXIT=1 Q
"RTN","QANEDIT",115,0)
 S QANDFN=+Y
"RTN","QANEDIT",116,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANEDIT",117,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANEDIT",118,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANEDIT",119,0)
 S QANNUM=$O(QANPAT(" "),-1)+1
"RTN","QANEDIT",120,0)
 S QANPAT(QANNUM)=QANDFN
"RTN","QANEDIT",121,0)
 S QANPNUM(QANNUM)=QANPIEN
"RTN","QANEDIT",122,0)
 S QANPNAM(QANNUM)=QANAME
"RTN","QANEDIT",123,0)
 S QANFLAG=1 D:'$D(QANF) BULL^QANUTL3
"RTN","QANEDIT",124,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Edit a brief patient record" D ^QAQAUDIT
"RTN","QANEDIT",125,0)
 Q
"RTN","QANEDIT",126,0)
PTDEL ;
"RTN","QANEDIT",127,0)
 S QANCC=0
"RTN","QANEDIT",128,0)
 F  S QANCC=$O(QANPNUM(QANCC)) Q:QANCC'>0  D
"RTN","QANEDIT",129,0)
 . S QANNUM=QANCC
"RTN","QANEDIT",130,0)
 . W !?5,QANCC_"   "_QANPNAM(QANCC)
"RTN","QANEDIT",131,0)
 I '$G(QANNUM) S QANXIT=1 Q
"RTN","QANEDIT",132,0)
 S DIR(0)="NOA"
"RTN","QANEDIT",133,0)
 S DIR("A")="Delete which patient number: "
"RTN","QANEDIT",134,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",135,0)
 I Y>QANNUM W !!?5,"Answer must be a number less than "_QANNUM+1
"RTN","QANEDIT",136,0)
 I Y<1 S QANXIT=1 Q
"RTN","QANEDIT",137,0)
 S QANTEMP=+Y
"RTN","QANEDIT",138,0)
 S QANDFN=QANPNUM(+Y)
"RTN","QANEDIT",139,0)
 S QANAME=QANPNAM(+Y)
"RTN","QANEDIT",140,0)
 S DIK="^QA(742,",DA=QANPAT(+Y) D ^DIK
"RTN","QANEDIT",141,0)
 D BULL^QANUTL3
"RTN","QANEDIT",142,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Edit a brief patient record" D ^QAQAUDIT
"RTN","QANEDIT",143,0)
 K QANPAT(QANTEMP),QANPNUM(QANTEMP),QANPNAM(QANTEMP)
"RTN","QANEDIT",144,0)
 G PTDEL
"RTN","QANEDIT",145,0)
 Q
"RTN","QANEDIT",146,0)
EXIT ;
"RTN","QANEDIT",147,0)
 K QAN0,QANADMDT,QANCC,QANCNT,QANDATE,QANDFN,QANDOB,QANEE
"RTN","QANEDIT",148,0)
 K QANEDFLG,QANELFG,QANFLAG,QANIEN,QANINC,QANAME,QANNAME,QANNUM
"RTN","QANEDIT",149,0)
 K QANPAT,QANPID,QANPIEN,QANPNAM,QANPNUM,QANPSDO,QANTEMP
"RTN","QANEDIT",150,0)
 K QANTOT,QANTRSP,QANXFLG,QANXIT,QANY,QANZERO
"RTN","QANEDIT",151,0)
 Q
"RTN","QANQUCK")
0^8^B18557521
"RTN","QANQUCK",1,0)
QANQUCK ;HISC/GJC-Intial sighting of an Incident for a QA person ;10/9/92
"RTN","QANQUCK",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27**;08/07/1992
"RTN","QANQUCK",3,0)
 ;
"RTN","QANQUCK",4,0)
 K QANLOCK
"RTN","QANQUCK",5,0)
 D NEWREC^QANCDNT
"RTN","QANQUCK",6,0)
 S QANDEATH=$O(^QA(742.1,"BUPPER","DEATH",0)),QANSUI=$O(^QA(742.1,"BUPPER","SUICIDE",0)),QANHOMCD=$O(^QA(742.1,"BUPPER","HOMICIDE",0))
"RTN","QANQUCK",7,0)
 S QANPTAB=$O(^QA(742.1,"BUPPER","PATIENT ABUSE",0))
"RTN","QANQUCK",8,0)
 S DIE="^QA(742.4,",DA=QANIEN,DR=".02;I X'=QANDEATH S Y=""@1"";.15;@1;.03;S X=X" D ^DIE K DIE,DR I $D(Y) D DEL D:QANXIT KILL Q
"RTN","QANQUCK",9,0)
 S QANLTTR=$P(^QA(742.4,QANIEN,0),U,2)
"RTN","QANQUCK",10,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANQUCK",11,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANQUCK",12,0)
 S DIE="^QA(742.4,",DR=".09///"_3,DA=QANIEN D ^DIE ; Set 'Local Case' flag to brief.
"RTN","QANQUCK",13,0)
 ;Get the patient.
"RTN","QANQUCK",14,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",15,0)
 L -^QA(742.4,QANIEN) ;unlock record - it was locked in NEWREC^QANCDNT
"RTN","QANQUCK",16,0)
KILL K D0,DA,QANADMDT,QANAGE,QANAME,QANCHK,QANCODE,QANDFN,QANDOB,QANDT,QANDUZ
"RTN","QANQUCK",17,0)
 K QANFLAG,QANHOMCD,QANHOME,QANIEN,QANINCR,QANINPAT,QANLTTR,QANOUT
"RTN","QANQUCK",18,0)
 K QANPTAB,QANPID,QANPIEN,QANPSDO,QANSSN,QANSUI,QANDEATH,QANST,QANST1
"RTN","QANQUCK",19,0)
 K QANTRSP,QANTTL,QANWARD,QANXIT,QANZERO,QAQADICT,QAQAFLD,QUES,VAERR,X
"RTN","QANQUCK",20,0)
 K QANPRS,X1,X2,Y,QANCODE,QANBFLG
"RTN","QANQUCK",21,0)
 Q
"RTN","QANQUCK",22,0)
DEL ;
"RTN","QANQUCK",23,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANQUCK",24,0)
 Q
"RTN","QANQUCK",25,0)
PAT ;Patient data.
"RTN","QANQUCK",26,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANQUCK",27,0)
 D MIX^DIC1 K DIC S:+Y<1&(QANFLAG) QANOUT=1
"RTN","QANQUCK",28,0)
 D:+Y<1&('QANFLAG) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",29,0)
 F  D  Q:"-12"[%
"RTN","QANQUCK",30,0)
 . W !?5,$G(Y(0,0))_" OK?"
"RTN","QANQUCK",31,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANQUCK",32,0)
 . W " Confirm that this is the correct patient."
"RTN","QANQUCK",33,0)
 D:%=-1&('QANFLAG) DEL^QANQUCK Q:QANXIT!(QANOUT)
"RTN","QANQUCK",34,0)
 I %=-1,(QANFLAG) S QANXIT=1 Q
"RTN","QANQUCK",35,0)
 I %=2 W " ??" G PAT
"RTN","QANQUCK",36,0)
 D PRIOR^QANCDNT I QANXIT D  Q
"RTN","QANQUCK",37,0)
 . I 'QANFLAG K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANQUCK",38,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANQUCK",39,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANQUCK",40,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANQUCK",41,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANQUCK",42,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANQUCK",43,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANQUCK",44,0)
 S QANPID=$E($P(Y(0,0),",",2))_$E($P(Y(0,0)," ",2))_$E($P(Y(0,0),","))_$E(QANSSN,6,9)
"RTN","QANQUCK",45,0)
 D ADMDT^QANUTL1
"RTN","QANQUCK",46,0)
 L +^QA(742):10 I '$T W !!,"Another user is editing this file." Q
"RTN","QANQUCK",47,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANQUCK",48,0)
 I +Y=-1,('QANFLAG) D DEL Q
"RTN","QANQUCK",49,0)
 I +Y=-1,(QANFLAG) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANQUCK",50,0)
 S QANDFN=+Y
"RTN","QANQUCK",51,0)
 L -^QA(742)
"RTN","QANQUCK",52,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANQUCK",53,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANQUCK",54,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANQUCK",55,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANQUCK",56,0)
 I (QANSUI=QANLTTR)!(QANDEATH=QANLTTR)!(QANHOMCD=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DA=QANDFN,DR=".1///^S X=3" D ^DIE K DA,DIE,DR
"RTN","QANQUCK",57,0)
 I (QANSUI'=QANLTTR),(QANDEATH'=QANLTTR),(QANHOMCD'=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DR=".1",DA=QANDFN D ^DIE K DA,DIE,DR
"RTN","QANQUCK",58,0)
 L -^QA(742,QANDFN)
"RTN","QANQUCK",59,0)
 S QANFLAG=1
"RTN","QANQUCK",60,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANQUCK",61,0)
 Q
"RTN","QANUTL1")
0^5^B31569439
"RTN","QANUTL1",1,0)
QANUTL1 ;HISC/GJC-UTILITIES FOR INCIDENT REPORTING (PATIENT DATA) ;7/12/93  09:07
"RTN","QANUTL1",2,0)
 ;;2.0;Incident Reporting;**20,27**;08/07/1992
"RTN","QANUTL1",3,0)
 ;
"RTN","QANUTL1",4,0)
DICW ;Sets up output for patient lookup.
"RTN","QANUTL1",5,0)
 S QANY=$P(^QA(742,+Y,0),U),QANYY=+$P(^QA(742,+Y,0),U,3)
"RTN","QANUTL1",6,0)
 S QANSSN=$S($P(^DPT(QANY,0),U,9)]"":$P(^DPT(QANY,0),U,9),1:"")
"RTN","QANUTL1",7,0)
 N Y S Y=$P(^QA(742.4,QANYY,0),U,3) X ^DD("DD")
"RTN","QANUTL1",8,0)
 W " "_QANSSN_" "_Y_" "_$P(^QA(742.1,$P(^QA(742.4,QANYY,0),U,2),0),U)
"RTN","QANUTL1",9,0)
 K QANY,QANYY
"RTN","QANUTL1",10,0)
 Q
"RTN","QANUTL1",11,0)
HDH ;
"RTN","QANUTL1",12,0)
 S QANPAGE=QANPAGE+1 W @IOF,!?62,"Date: ",QANDT,!,?62,"Page: ",QANPAGE,!,?(IOM-$L(QANHEAD)\2),QANHEAD
"RTN","QANUTL1",13,0)
 W:QANHEAD(0)]"" !,?(IOM-$L(QANHEAD(0))\2),QANHEAD(0)
"RTN","QANUTL1",14,0)
 W:QANLINE]"" !,QANLINE,!
"RTN","QANUTL1",15,0)
 Q
"RTN","QANUTL1",16,0)
HDH1 ;
"RTN","QANUTL1",17,0)
 K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 QANEOP="^"
"RTN","QANUTL1",18,0)
 Q:QANEOP["^"  D HDH
"RTN","QANUTL1",19,0)
 Q
"RTN","QANUTL1",20,0)
PAT0 ;displays the patient(s) on IR, if any.
"RTN","QANUTL1",21,0)
 S QANEE=0 N QANPTFLG
"RTN","QANUTL1",22,0)
 K QANPTS
"RTN","QANUTL1",23,0)
 F  S QANEE=$O(^QA(742,"BCS",QANIEN,QANEE)) Q:QANEE'>0  D
"RTN","QANUTL1",24,0)
 . S QANPTFLG=1
"RTN","QANUTL1",25,0)
 . S QANPTS(QANEE)=$P(^QA(742,QANEE,0),U)
"RTN","QANUTL1",26,0)
 Q:'$G(QANPTFLG)
"RTN","QANUTL1",27,0)
 W !!,"Patient(s) on this Incident Report."
"RTN","QANUTL1",28,0)
 S QANCC=0
"RTN","QANUTL1",29,0)
 F  S QANCC=$O(QANPTS(QANCC)) Q:QANCC'>0  D
"RTN","QANUTL1",30,0)
 . W !?5,$P(^DPT(QANPTS(QANCC),0),U)
"RTN","QANUTL1",31,0)
PAT ;Choose your patient.
"RTN","QANUTL1",32,0)
 K DIC S DIC="^QA(742,",DIC(0)="QEAMZ",DIC("A")="Select Patient: "
"RTN","QANUTL1",33,0)
 S DIC("S1")="I ""13""[+$P(^QA(742.4,+$P(^QA(742,+Y,0),U,3),0),U,8)"
"RTN","QANUTL1",34,0)
 S DIC("S2")="&($D(^QA(742,""BPRS"",1,+Y)))"
"RTN","QANUTL1",35,0)
 S DIC("S3")="I $P(^QA(742,+Y,0),U,3)=QANIEN"
"RTN","QANUTL1",36,0)
 S DIC("S")=$S(QANTYPE=3:DIC("S1")_DIC("S2"),1:DIC("S3")_DIC("S2"))
"RTN","QANUTL1",37,0)
PAT1    ;entry point from EDIT1^QANDCNT
"RTN","QANUTL1",38,0)
 S DIC("W")="D DICW^QANUTL1",D="B^BS5" D MIX^DIC1
"RTN","QANUTL1",39,0)
 I $G(X)']"" W !!,$C(7),"You must enter patient's name to continue editing." G PAT1
"RTN","QANUTL1",40,0)
 K DIC
"RTN","QANUTL1",41,0)
 I +Y=-1 S QANXIT=1 W !!,$C(7),"Patient not selected, exiting!!" Q
"RTN","QANUTL1",42,0)
 S QANDFN=+Y,QANIEN=$P(Y(0),U,3),QAHOLD=$P(Y(0),U),QAHDNM=Y(0,0)
"RTN","QANUTL1",43,0)
 S QAHDSSN=$P(^DPT(+QAHOLD,0),U,9)
"RTN","QANUTL1",44,0)
 D EDTNME Q:QANXIT
"RTN","QANUTL1",45,0)
 S QANAME=$P(^DPT(QANPAT,0),U),QANDOB=$P(^DPT(QANPAT,0),U,3),QAN(0)=0 F QAN=0:0 S QAN=$O(^QA(742,"B",QANPAT,QAN)) Q:QAN'>0!(QAN(0)'<2)  S:$D(^QA(742,"B",QANPAT,QAN)) QAN(0)=QAN(0)+1
"RTN","QANUTL1",46,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANUTL1",47,0)
 I QAN(0)'<2 D RPT0
"RTN","QANUTL1",48,0)
 Q
"RTN","QANUTL1",49,0)
RPT0 W $C(7) F  W !!,"Patient has additional incidents on file.",!,"Do you wish to look at these incidents" S %=2 D YN^DICN Q:"-112"[%  W !,$C(7),"Enter (Y)es, or (N)o, or ""^"" to quit."
"RTN","QANUTL1",50,0)
 S:%=-1 QANXIT=1
"RTN","QANUTL1",51,0)
 I %=-1!(%=2) Q
"RTN","QANUTL1",52,0)
 S QANPT(0)=$S($D(^DPT(QANPAT,0))#2:^(0),1:""),QANDT=DT,QANPAGE=0,Y=QANDT X ^DD("DD") S QANDT=Y,QANHEAD="Patient's Incident History.",QANHEAD(0)="",$P(QANLINE,"~",81)="",QANEOP="" D HDH
"RTN","QANUTL1",53,0)
 F QAN=0:0 S QAN=$O(^QA(742,"B",QANPAT,QAN)) Q:QAN'>0  D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W ! S QANPT0(0)=$S($D(^QA(742,QAN,0))#2:^(0),1:"") I QANPT0(0)]"" D RPT1
"RTN","QANUTL1",54,0)
 F  W !!,"Do you wish to continue with the edit portion" S %=1 D YN^DICN Q:"-112"[%  W !,"Enter ""Y"" for yes, ""N"" for no."
"RTN","QANUTL1",55,0)
 I %<0!(%=2) S QANXIT=1
"RTN","QANUTL1",56,0)
 Q
"RTN","QANUTL1",57,0)
RPT1 S QANCS=$P(QANPT0(0),U,3),QANCS(0)=$S($D(^QA(742.4,QANCS,0))#2:^(0),1:"") Q:QANCS(0)']""
"RTN","QANUTL1",58,0)
 S QANIC=$P(QANCS(0),U,2),QANSTAT=+$P(QANCS(0),U,8)
"RTN","QANUTL1",59,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Patient: ",$P(QANPT(0),U),?45,"Patient ID: ",$P(QANPT0(0),U,2)
"RTN","QANUTL1",60,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Case Number: ",$P(QANCS(0),U),?45,"Incident: ",$S(QANIC]"":$P(^QA(742.1,QANIC,0),U),1:"<NONE>")
"RTN","QANUTL1",61,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Date of the Incident: " S Y=$P(QANCS(0),U,3) X ^DD("DD") W Y,?45,"Incident Status: ",$S(QANSTAT=0:"Closed",QANSTAT=1:"Open",QANSTAT=3:"Open",1:"Deleted")
"RTN","QANUTL1",62,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Incident Location: " W:$P(QANCS(0),U,4)]"" $P(^QA(742.5,$P(QANCS(0),U,4),0),U)
"RTN","QANUTL1",63,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Severity Level: " S Y=$P(QANPT0(0),U,10),C=$P(^DD(742,.1,0),U,2) I Y]"" D Y^DIQ W Y
"RTN","QANUTL1",64,0)
 Q
"RTN","QANUTL1",65,0)
ADMDT ;Grab the patient's admission date.
"RTN","QANUTL1",66,0)
 S QANWARD="" ;SETTING THE DEFAULT TO 'NULL'
"RTN","QANUTL1",67,0)
 S DFN=QANPIEN D INP^VADPT S QANADMDT=$S(VAIN(7)]"":+VAIN(7),1:"")
"RTN","QANUTL1",68,0)
 S QANTRSP=$S(VAIN(3)]"":+VAIN(3),1:"")
"RTN","QANUTL1",69,0)
 S QANINPAT=$S($D(^DPT(QANPIEN,.1)):1,1:0)
"RTN","QANUTL1",70,0)
 D:QANINPAT WARD
"RTN","QANUTL1",71,0)
 K DFN,VAIN
"RTN","QANUTL1",72,0)
 Q
"RTN","QANUTL1",73,0)
EDTNME ;Edit the patients name.
"RTN","QANUTL1",74,0)
 K DIE,DR
"RTN","QANUTL1",75,0)
 S DIE="^QA(742,",DA=+Y,DR=".01  Patient" D ^DIE
"RTN","QANUTL1",76,0)
 S:$D(Y) QANXIT=1
"RTN","QANUTL1",77,0)
 S (QANPAT,QANPIEN)=+X
"RTN","QANUTL1",78,0)
 Q:QANXIT!(+X=QAHOLD)  ;Exit on abnormal exit OR same patient
"RTN","QANUTL1",79,0)
 S QA2=$G(^DPT(+X,0)),QANSSN=$P(QA2,U,9),QA1=$P(QA2,U),QANDOB=$P(QA2,U,3)
"RTN","QANUTL1",80,0)
 S QANPID=$E($P(QA1,",",2))_$E($P(QA1," ",2))_$E($P(QA1,","))_$E(QANSSN,6,9)
"RTN","QANUTL1",81,0)
 D ADMDT ;Grab ward, t spec, admit date, and patient type for new patient
"RTN","QANUTL1",82,0)
 S QANADMDT=$S(QANADMDT]"":QANADMDT,1:"@"),QANTRSP=$S(QANTRSP]"":QANTRSP,1:"@"),QANINPAT=$S(QANINPAT]"":QANINPAT,1:"@"),QANWARD=$S(QANWARD]"":QANWARD,1:"@"),QANPID=$S(QANPID]"":QANPID,1:"")
"RTN","QANUTL1",83,0)
 S DIE="^QA(742,",DA=QANDFN
"RTN","QANUTL1",84,0)
 F DR=".02///"_QANPID,".04///"_QANADMDT,".05///"_QANINPAT,".06///"_QANWARD,".07///"_QANTRSP D ^DIE
"RTN","QANUTL1",85,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="e",QAUDIT("COMMENT")="Editing a patient name for an incident record." D ^QAQAUDIT
"RTN","QANUTL1",86,0)
 I +$P(^QA(742.4,QANIEN,0),U,18) D ^QANPEDT ;Update patient name on NQADB
"RTN","QANUTL1",87,0)
 K QAUDIT,QA1,QANSSN,QANADMDT,QANPID,QANINPAT,QANWARD,QANTRSP,QA2,QAHOLD
"RTN","QANUTL1",88,0)
 K QAHDNM,QAHDSSN
"RTN","QANUTL1",89,0)
 Q
"RTN","QANUTL1",90,0)
WARD ;
"RTN","QANUTL1",91,0)
 S QANWARD=$S(VAIN(4)]"":+VAIN(4),1:"") Q:QANWARD=""
"RTN","QANUTL1",92,0)
 I '$D(^DIC(42,QANWARD,0)) S QANWARD="" Q
"RTN","QANUTL1",93,0)
 S QANWARD=$S($D(^DIC(42,QANWARD,44)):+$P(^(44),U),1:"") Q:QANWARD=""
"RTN","QANUTL1",94,0)
 I '$D(^SC(QANWARD,0)) S QANWARD=""
"RTN","QANUTL1",95,0)
 Q
"RTN","QANUTL2")
0^3^B22889554
"RTN","QANUTL2",1,0)
QANUTL2 ;HISC/GJC-Utilities for Incident Reporting (Patient Data) ;5/25/93  15:04
"RTN","QANUTL2",2,0)
 ;;2.0;Incident Reporting;**1,7,19,23,27**;08/07/1992
"RTN","QANUTL2",3,0)
 ;
"RTN","QANUTL2",4,0)
HDH ;Header
"RTN","QANUTL2",5,0)
 W @IOF,!!?(IOM-$L(QANHEAD(0))\2),QANHEAD(0),!,QANLINE(0),!
"RTN","QANUTL2",6,0)
 Q
"RTN","QANUTL2",7,0)
EN2 ;Edit fields for follow-up data input.  Invoked from: ^QANVAL.
"RTN","QANUTL2",8,0)
 ;VARIABLES PASSED IN *** QANDFN: Patient's ien   QANIEN: Incident's ien.
"RTN","QANUTL2",9,0)
 I +QANDFN'>0!(+QANIEN'>0) S QANXIT=1 Q
"RTN","QANUTL2",10,0)
 L +(^QA(742,QANDFN),^QA(742.4,QANIEN)):5 I '$T W !!?16,$C(7),"Another person is editing this incident record." D EXIT Q
"RTN","QANUTL2",11,0)
 S QANHEAD(0)="Edit the following patient data for "_QANAME_" AGE: "_$S(QANAGE]"":QANAGE,1:"<N/A>") S $P(QANLINE(0),"-",81)="",QANEOP=""
"RTN","QANUTL2",12,0)
 D HDH S QANGLB0=$G(^QA(742.4,QANIEN,0)) S:QANGLB0="" QANXIT=1 D:QANXIT EXIT Q:QANXIT
"RTN","QANUTL2",13,0)
 K DA,DIE,DR S DIE="^QA(742.4,",DA=QANIEN,DR=".09////"_3 D ^DIE
"RTN","QANUTL2",14,0)
 K DA,DIE,DR
"RTN","QANUTL2",15,0)
 S QANIRIN(0)=$P(QANGLB0,U,2),QANDED=$O(^QA(742.1,"BUPPER","DEATH",0))
"RTN","QANUTL2",16,0)
 D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".02R~;I X'=QANDED S Y=""@1"";.15R~;@1;.03;.04;.05;S X=X;.07;.08" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",17,0)
 S QANIRIN=$P(^QA(742.4,QANIEN,0),U,2) ;New Incident
"RTN","QANUTL2",18,0)
 I (QANIRIN(0)=QANDED),(QANIRIN(0)'=QANIRIN) D K3 S DA=QANIEN,DIE="^QA(742.4,",DR=".15///@" D ^DIE D K3 ;If changed from death, delete type of death.
"RTN","QANUTL2",19,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("COMMENT")="Edit an incident record",QAUDIT("ACTION")="e" D ^QAQAUDIT
"RTN","QANUTL2",20,0)
 I QANIRIN(0)'=QANIRIN D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".17///^S X=1" D ^DIE,K3 ;Resetting an incident reopens a case nationally.
"RTN","QANUTL2",21,0)
 I $D(^QA(742.1,"BUPPER","DEATH",QANIRIN))!($D(^QA(742.1,"BUPPER","SUICIDE",QANIRIN)))!($D(^QA(742.1,"BUPPER","HOMICIDE",QANIRIN))) D K3 S DIE="^QA(742,",DA=QANDFN,DR=".1///"_3 D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",22,0)
 I $D(^QA(742.1,"BUPPER","FALL",QANIRIN)) D K3 S DIE="^QA(742,",DA=QANDFN,DR=".09" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",23,0)
 I $D(^QA(742.1,"BUPPER","PATIENT ABUSE",QANIRIN)) D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".18" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",24,0)
 I $D(^QA(742.1,"BUPPER","MEDICATION ERROR",QANIRIN)) D K3 S DIE="^QA(742,",DA=QANDFN,DR=".11" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",25,0)
 I $D(^QA(742.1,"BUPPER","MEDICATION ERROR",QANIRIN)),$D(X),$D(^QA(742.13,"B","OTHER",+X))#2 D EN10^QANUTL
"RTN","QANUTL2",26,0)
 D K3 S QAN6O=+$P(^QA(742,QANDFN,0),U,6),DIE="^QA(742,",DA=QANDFN,DR=".06;S X=X" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",27,0)
 S QAN6N=+$P(^QA(742,QANDFN,0),U,6) I QAN6O'=QAN6N D K3 S QAN6T=$P($G(^SC(QAN6N,0)),U,3),DIE="^QA(742,",DA=QANDFN,DR=".05///^S X="_$S(QAN6T="W":1,1:0) D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",28,0)
 D K3 S DIE="^QA(742,",DA=QANDFN,DR=".07;.08;.15;.1;S X=X" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",29,0)
 I $D(^QA(742.1,"BUPPER","PATIENT ABUSE",QANIRIN)),(+$P($G(^QA(742.4,QANIEN,0)),U,16)=1),(+$P($G(^QA(742,QANDFN,0)),U,10)=3) D HOMCIDE^QANUTL
"RTN","QANUTL2",30,0)
 I $D(^QA(742.1,"BUPPER","SUICIDE ATTEMPT",QANIRIN)),(+$P($G(^QA(742,QANDFN,0)),U,10)=3) D SUIATMP^QANUTL
"RTN","QANUTL2",31,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("COMMENT")="Edit a patient record",QAUDIT("ACTION")="e" D ^QAQAUDIT
"RTN","QANUTL2",32,0)
 D CHECK^QANUTL4 D:QANYN<0 EXIT Q:QANYN<0
"RTN","QANUTL2",33,0)
 D BDCAST^QANUTL5
"RTN","QANUTL2",34,0)
 D K3 S DIE="^QA(742,",DA=QANDFN,DR=".12;S X=X" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",35,0)
 D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".12;S:X']""""!(X=1) Y=""@1"" S:X=2 Y=""@2"";.22;@2;.13;S X=X;.14;@1;.16;.2;S X=X" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",36,0)
 I "12"[+$P(^QA(742.1,QANIRIN,0),U,2) D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".1;S X=X;.11" D ^DIE,K3 D EXIT:$D(Y) Q:$D(Y)
"RTN","QANUTL2",37,0)
CLOSE S %=2 F  W !!,"Do you wish to close this particular incident" D YN^DICN Q:"-112"[%  W !!,"Enter ""N""o if you wish the incident to stay open,",!,"""Y""es if you wish to close the incident."
"RTN","QANUTL2",38,0)
 S QAN("%")=%
"RTN","QANUTL2",39,0)
 I QAN("%")=1 D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".21///@" D ^DIE,K3
"RTN","QANUTL2",40,0)
 I QAN("%")=1 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("COMMENT")="Close an incident record",QAUDIT("ACTION")="c" D ^QAQAUDIT
"RTN","QANUTL2",41,0)
 I QAN("%")=1 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("COMMENT")="Close a patient record",QAUDIT("ACTION")="c" D ^QAQAUDIT
"RTN","QANUTL2",42,0)
 D K3 S DIE="^QA(742.4,",DA=QANIEN,DR=".09///"_$S(QAN("%")=1:0,1:"") D ^DIE,K3
"RTN","QANUTL2",43,0)
 D K3 S DIE="^QA(742,",DA=QANDFN,DR=".13///"_$S(QAN("%")=1:0,1:"") D ^DIE,K3
"RTN","QANUTL2",44,0)
EXIT L -(^QA(742,QANDFN),^QA(742.4,QANIEN)) ;Unlock QA IR globals.
"RTN","QANUTL2",45,0)
 K QAN6N,QAN6O,QAN6T,QANHEAD(0),QANINS,QANLINE(0),QANEOP,QANIRIN,QANDED
"RTN","QANUTL2",46,0)
 K QANLCTN,QANGLB0,QANGLB1,QANGLB2,INCQAN,MSSG0,MSSG1,MSSG2,MSSG3,MSSG4
"RTN","QANUTL2",47,0)
 Q
"RTN","QANUTL2",48,0)
K3 ;
"RTN","QANUTL2",49,0)
 K DIE,DA,DR
"RTN","QANUTL2",50,0)
 Q
"RTN","QANUTL3")
0^6^B10351621
"RTN","QANUTL3",1,0)
QANUTL3 ;HISC/GJC-UTILITIES FOR AN INCIDENT REPORT ;4/22/91
"RTN","QANUTL3",2,0)
 ;;2.0;Incident Reporting;**27**;08/07/1992
"RTN","QANUTL3",3,0)
 ;
"RTN","QANUTL3",4,0)
BULL ;Generate the bulletin.
"RTN","QANUTL3",5,0)
 I $P(^QA(740,1,"QAN"),U)="" W !!,$C(7),"*** MAILGROUP NOT SPECIFIED, REPORT TO YOUR QA COORDINATOR ***",!!,$C(7) S QANXIT=1 Q
"RTN","QANUTL3",6,0)
 I $P(^QA(740,1,"QAN"),U,2)="" W !!,$C(7),"*** MAILGROUP BULLETIN NOT SENT, REPORT TO YOUR QA COORDINATOR ***",!!,$C(7) S QANXIT=1 Q
"RTN","QANUTL3",7,0)
 D KILL^XM S QANAFRM=+$S($D(^QA(740,1,"QAN"))#2:$P(^("QAN"),U,2),1:"")
"RTN","QANUTL3",8,0)
 S QANMIEN=+$S($D(^QA(740,1,"QAN"))#2:$P(^("QAN"),U),1:"") Q:QANAFRM'>0!(QANMIEN'>0)
"RTN","QANUTL3",9,0)
 S QANMAIL="G."_$P(^XMB(3.8,QANMIEN,0),U),QANSITE=$P(^DIC(4.2,$P(^XMB(1,1,0),U),0),U)
"RTN","QANUTL3",10,0)
 I QANSITE']"" W !!,$C(7),"*** MAILGROUP BULLETIN NOT SENT, REPORT TO YOUR QA COORDINATOR, DOMAIN INFORMATION MISSING ***",!!,$C(7) S QANXIT=1 Q
"RTN","QANUTL3",11,0)
 S XMY(QANMAIL_"@"_QANSITE)=""
"RTN","QANUTL3",12,0)
 S XMSUB=^DD("SITE")_" ("_^DD("SITE",1)_") QAN INCIDENT EVENT",XMDUZ=.5
"RTN","QANUTL3",13,0)
 I $D(DUZ)#2,DUZ>0,$D(^VA(200,DUZ,0)) S X=$P($P(^(0),U),",",2)_" "_$P($P(^(0),U),",") S QANMAIL(1)=X
"RTN","QANUTL3",14,0)
 S X=$S($D(^QA(742.4,QANIEN,0))#2:$P(^(0),U,6),1:"") S:X]"" QANMAIL(2)=$P(^DIC(3.1,X,0),U) S:X']"" QANMAIL(2)=""
"RTN","QANUTL3",15,0)
 S QANMAIL(3)=$S($D(^QA(742.4,QANIEN,0))#2:$P(^(0),U),1:"")
"RTN","QANUTL3",16,0)
 S X=$S($D(^QA(742.4,QANIEN,0))#2:$P(^(0),U,2),1:"") S:X]"" QANMAIL(4)=$P(^QA(742.1,X,0),U) S:X']"" QANMAIL(4)=""
"RTN","QANUTL3",17,0)
 S Y=DT X ^DD("DD") S X=Y,QANMAIL(5)=X
"RTN","QANUTL3",18,0)
 S X=$S($D(^QA(742.4,QANIEN,0))#2:$P(^(0),U,3),1:"")
"RTN","QANUTL3",19,0)
 S Y=X X ^DD("DD") S X=Y,QANMAIL(6)=X
"RTN","QANUTL3",20,0)
 S QANMAIL(7)=$S($D(QANAME):QANAME,1:"")
"RTN","QANUTL3",21,0)
 S QANMAIL(8)=$S($D(QANSSN):QANSSN,1:"")
"RTN","QANUTL3",22,0)
 S QANWORD=$S($G(QANEDFLG)=1:"edited",1:"entered")
"RTN","QANUTL3",23,0)
 S ^UTILITY($J,1)="User "_QANMAIL(1)_" ("_QANMAIL(2)_") "_QANWORD_" incident case number ",^UTILITY($J,2)=QANMAIL(3)_" involving incident "_QANMAIL(4)_" on "_QANMAIL(5)_".",^UTILITY($J,3)="Date of Incident: "_QANMAIL(6)
"RTN","QANUTL3",24,0)
 I $D(QANMAIL(7)) S ^UTILITY($J,4)="Patient: "_QANMAIL(7)
"RTN","QANUTL3",25,0)
 I $D(QANMAIL(8)) S ^UTILITY($J,4)=^UTILITY($J,4)_" SSN: "_QANMAIL(8)
"RTN","QANUTL3",26,0)
 S XMTEXT="^UTILITY($J," D ^XMD,KILL^XM K X,Y,XMB,QANMAIL,QANAFRM,QANMIEN,QANSITE,XMHOLD,XMANS
"RTN","QANUTL3",27,0)
 Q
"RTN","QANUTL3",28,0)
EN1 ;Incident location enter/edit.
"RTN","QANUTL3",29,0)
 D KDIC S (DIC,DIE)="^QA(742.5,",DLAYGO=742.5,DIC("A")="Select an Incident Location: ",DIC(0)="QEAMNLZ",DIC("W")="W ""  ""_$S($P(^(0),U,2)=1:""ACTIVE"",1:""INACTIVE"")"
"RTN","QANUTL3",30,0)
 D ^DIC
"RTN","QANUTL3",31,0)
 I Y=-1 D KDIC Q
"RTN","QANUTL3",32,0)
 S DA=+Y L +^QA(742.5,DA,0):5 I '$T W !!?16,$C(7),"Another person is editing this entry." D KDIC Q
"RTN","QANUTL3",33,0)
 S DR=".01 Incident:" D ^DIE
"RTN","QANUTL3",34,0)
 I $D(Y) D KDIC Q
"RTN","QANUTL3",35,0)
 S DR=".02 Incident Location Status:" D ^DIE
"RTN","QANUTL3",36,0)
 D KDIC
"RTN","QANUTL3",37,0)
 Q
"RTN","QANUTL3",38,0)
KDIC ;
"RTN","QANUTL3",39,0)
 I $D(DA) L -^QA(752.5,DA,0)
"RTN","QANUTL3",40,0)
 K C,D,DA,DIC,DIE,DLAYGO,DINUM,DR,X,Y
"RTN","QANUTL3",41,0)
 Q
"RTN","QANVAL")
0^4^B23872839
"RTN","QANVAL",1,0)
QANVAL ;;HISC/GJC-Utilities for Incident Reporting ;4/26/91
"RTN","QANVAL",2,0)
 ;;2.0;Incident Reporting;**1,27**;08/07/1992
"RTN","QANVAL",3,0)
 ;
"RTN","QANVAL",4,0)
EN1 ;
"RTN","QANVAL",5,0)
 N QANBFLG,QANFFLG
"RTN","QANVAL",6,0)
 S (QANFLAG(0),QANOUT,QANXIT,QANAGN)=0,(QAN(0),QANBFLG,QANFFLG)=0
"RTN","QANVAL",7,0)
 W @IOF S QANIEN="" F QAN=0:0 S QANIEN=$O(^QA(742.4,"ACS",QANIEN)) Q:QANIEN=""  I "02"'[+QANIEN F QAN=0:0 S QAN=$O(^QA(742.4,"ACS",QANIEN,QAN)) Q:QAN'>0  S QAN(0)=QAN(0)+1
"RTN","QANVAL",8,0)
 I QAN(0)>0 W !!?12,$C(7),"There exist "_QAN(0)_" open INCIDENT CASE(S) on the system.",!!
"RTN","QANVAL",9,0)
 E  W !!?12,"There exists ZERO open INCIDENT CASE(S) on the system." K QAN,QANIEN
"RTN","QANVAL",10,0)
 I 'QANAGN F  W !!,"Do you wish to create a new incident event record" S %=2 D YN^DICN Q:"-112"[%  W !,$C(7),"Enter (Y)es, or (N)o, or ""^"" to quit."
"RTN","QANVAL",11,0)
 I 'QANAGN,%=-1 K QAN,QANIEN Q
"RTN","QANVAL",12,0)
 I 'QANAGN,%=1 S (QANFLAG(0),QANFFLG)=1,QANF="" D ^QANCDNT Q:QANXIT
"RTN","QANVAL",13,0)
 D:'QANFLAG(0) EDIT I QANXIT D CLEAN Q
"RTN","QANVAL",14,0)
 D:$D(QANDFN)&$D(QANIEN) EN2^QANUTL2
"RTN","QANVAL",15,0)
 F  W !!,"Do you wish to edit a particular open incident" S %=2 D YN^DICN Q:"-112"[%  W !!,"Enter (Y)es, (N)o, or ""^"" to exit"
"RTN","QANVAL",16,0)
 I %=1 S QANAGN=1 G EN1
"RTN","QANVAL",17,0)
 D CLEAN Q
"RTN","QANVAL",18,0)
CASE ;
"RTN","QANVAL",19,0)
 K DIC S DIC=742.4,DIC(0)="QEANZ",DIC("A")="Select Case Number: ",DIC("S")="I ""13""[+$P(^(0),U,8)",DIC("W")="D EN1^QANUTL" D ^DIC K DIC
"RTN","QANVAL",20,0)
 I +Y=-1 S QANXIT=1 W !!,$C(7),"Case Number not selected, exiting!!"
"RTN","QANVAL",21,0)
 E  S QANIEN=+Y
"RTN","QANVAL",22,0)
 Q
"RTN","QANVAL",23,0)
DATE ;
"RTN","QANVAL",24,0)
 K DIC,D S DIC="^QA(742.4,",DIC(0)="QEAMZ",DIC("A")="Select Date of Incident: ",D="BDT",DIC("S")="I ""13""[+$P(^(0),U,8)",DIC("W")="D EN1^QANUTL" D IX^DIC K DIC,D
"RTN","QANVAL",25,0)
 I +Y=-1 S QANXIT=1 W !!,$C(7),"Date of Incident not selected, exiting!!"
"RTN","QANVAL",26,0)
 E  S QANIEN=+Y
"RTN","QANVAL",27,0)
 Q
"RTN","QANVAL",28,0)
EDIT K DIR S DIR("A",1)="Would you like to: ",DIR("A",2)="1. Edit by the Case Number",DIR("A",3)="2. Edit by the Date of the Incident",DIR("A",4)="3. Edit by the Patient",DIR("A",5)="4. Edit by the Type of Incident"
"RTN","QANVAL",29,0)
 S DIR("A")="Enter a number: (1-4) ",DIR(0)="NOA^1:4:0",DIR("B")=3,DIR("?",1)="Choose the manner in which you wish to edit the record.",DIR("?")="Enter a number no less than 1, no greater than 4."
"RTN","QANVAL",30,0)
 D ^DIR K DIR
"RTN","QANVAL",31,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) S QANXIT=1 Q
"RTN","QANVAL",32,0)
 S QANTYPE=+Y
"RTN","QANVAL",33,0)
 D @$S(QANTYPE=1:"CASE",QANTYPE=2:"DATE",QANTYPE=3:"PAT^QANUTL1",1:"TYPE")
"RTN","QANVAL",34,0)
 Q:$G(QANXIT)
"RTN","QANVAL",35,0)
 I $G(QANBFLG)'=1 L +^QA(742.4,QANIEN):5 I '$T W !!?16,$C(7),"Another person is editing this Incident Report." S QANXIT=1
"RTN","QANVAL",36,0)
 Q:QANXIT  D:$G(QANTYPE)'=3 PAT0^QANUTL1
"RTN","QANVAL",37,0)
 Q
"RTN","QANVAL",38,0)
TYPE ;
"RTN","QANVAL",39,0)
 K DIC,D S DIC="^QA(742.4,",DIC(0)="QEAMZ",DIC("A")="Select Type of Incident: ",DIC("S")="I ""13""[+$P(^(0),U,8)",D="BINC",DIC("W")="D EN1^QANUTL" D IX^DIC K DIC,D
"RTN","QANVAL",40,0)
 I +Y=-1 S QANXIT=1 W !!,$C(7),"Type of Incident not selected, exiting!!"
"RTN","QANVAL",41,0)
 E  S QANIEN=+Y
"RTN","QANVAL",42,0)
 Q
"RTN","QANVAL",43,0)
PATMAN ;DELETING A PATIENT'S RECORD
"RTN","QANVAL",44,0)
 ;***********************************************************************
"RTN","QANVAL",45,0)
 ;*** NOTE: Execution of this subroutine deletes the "ACN" x-ref from ***
"RTN","QANVAL",46,0)
 ;*** the global ^QA(742.4!                                           ***
"RTN","QANVAL",47,0)
 ;***********************************************************************
"RTN","QANVAL",48,0)
 K DIC S (DIC,DIE)="^QA(742,",DIC(0)="QEAMZ",DIC("A")="Select Patient: "
"RTN","QANVAL",49,0)
 S DIC("S")="I $D(^QA(742,""BPRS"",1,+Y))"
"RTN","QANVAL",50,0)
 S DIC("W")="D DICW^QANUTL1",QANXX=1,D="B^BS5"
"RTN","QANVAL",51,0)
 D MIX^DIC1 K DIC S QANPAT=+Y
"RTN","QANVAL",52,0)
 I QANPAT'>0 G K9
"RTN","QANVAL",53,0)
 S QANINCD=+$O(^QA(742.4,"ACN",QANPAT,"")) G:QANINCD'>0 K9
"RTN","QANVAL",54,0)
 I $O(^QA(742,"BCS",QANINCD,""))=QANPAT,$O(^QA(742,"BCS",QANINCD,QANPAT))']"" D WARN^QANAUX1 G K9
"RTN","QANVAL",55,0)
 S DIE="^QA(742,",DR=".13R",DA=QANPAT D ^DIE S QANPTST=+$P(^QA(742,QANPAT,0),U,12)
"RTN","QANVAL",56,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANPAT,QAUDIT("ACTION")=$S(QANPTST=1:"o",QANPTST=-1:"d",1:"c"),QAUDIT("COMMENT")=$S(QANPTST=1:"Open ",QANPTST=-1:"Delete ",1:"Close ")_"a patient record" D ^QAQAUDIT
"RTN","QANVAL",57,0)
K9 K %W,%X,%Y,C,D0,DA,DIE,DISYS,DR,QAN,QANINCD,QANPAT,QANSSN,QANST,QANXX,X
"RTN","QANVAL",58,0)
 K QANPTST,QAUDIT,Y
"RTN","QANVAL",59,0)
 Q
"RTN","QANVAL",60,0)
CLEAN ;Kill and quit.
"RTN","QANVAL",61,0)
 K C,D,DIC,D0,DA,MSSG0,MSSG1,MSSG2,QAN,QANADM,QANADMDT,QANAFRM,QANAME
"RTN","QANVAL",62,0)
 K QANCHK,QANCODE,QANDFN,QANDGPM,QANDT,QANDUZ,QANF,QANFLAG,QANHOME
"RTN","QANVAL",63,0)
 K QANINC,QANIEN,QANINCR,QANINPAT,QANINV,QANMAIL,QANMIEN,QANOUT,QANPLC
"RTN","QANVAL",64,0)
 K X,X1,X2,QANPID,QANPIEN,QANSITE,QANSSN,QANST,QANST1,QANTRSP,QANWARD
"RTN","QANVAL",65,0)
 K QANXIT,QANZERO,QANPAT,QANTYPE,QANX,QANZER0,QANTTL,QANSERV,QANPSDO
"RTN","QANVAL",66,0)
 K QANDOB,QANHOLD,^UTILITY($J),QANDOB,QANAGE,QANQAN,QANAGN,QANYN,POP
"RTN","QANVAL",67,0)
 K QANEOP,QANHEAD,QANINS,QANLINE,QANRSP0,QANRSP1,QANSTAT,QANPAGE,QANCS
"RTN","QANVAL",68,0)
 K QANDED,VAIN,VAERR,QANIRIN,QANLCTN,QANGLB0,QAUDIT,DTOUT,DUOUT,DIROUT
"RTN","QANVAL",69,0)
 K %,%T,%W,%X,%Y,DI,DIR,DQ,J,QANIC,QANPT,QANYN,QANPT0,Y,DIRUT,%DT,DIE,DR
"RTN","QANVAL",70,0)
 K QANPRS,QAHDNM,QAHDSSN,QAHOLD
"RTN","QANVAL",71,0)
 Q
"VER")
8.0^21.0
**END**
**END**
