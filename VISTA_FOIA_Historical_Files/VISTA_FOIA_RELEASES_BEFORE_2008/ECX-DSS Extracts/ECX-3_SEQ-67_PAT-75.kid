EMERGENCY Released ECX*3*75 SEQ #67
Extracted from mail message
**KIDS**:ECX*3.0*75^

**INSTALL NAME**
ECX*3.0*75
"BLD",5784,0)
ECX*3.0*75^DSS EXTRACTS^0^3041006^y
"BLD",5784,1,0)
^^2^2^3041006^^
"BLD",5784,1,1,0)
This patch provides a fix to the DSS Extracts when transmitting
"BLD",5784,1,2,0)
extracts to the production queue.
"BLD",5784,4,0)
^9.64PA^^
"BLD",5784,"KRN",0)
^9.67PA^8989.52^19
"BLD",5784,"KRN",.4,0)
.4
"BLD",5784,"KRN",.401,0)
.401
"BLD",5784,"KRN",.402,0)
.402
"BLD",5784,"KRN",.403,0)
.403
"BLD",5784,"KRN",.5,0)
.5
"BLD",5784,"KRN",.84,0)
.84
"BLD",5784,"KRN",3.6,0)
3.6
"BLD",5784,"KRN",3.8,0)
3.8
"BLD",5784,"KRN",9.2,0)
9.2
"BLD",5784,"KRN",9.8,0)
9.8
"BLD",5784,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5784,"KRN",9.8,"NM",1,0)
ECXTRANS^^0^B62743132
"BLD",5784,"KRN",9.8,"NM","B","ECXTRANS",1)

"BLD",5784,"KRN",19,0)
19
"BLD",5784,"KRN",19.1,0)
19.1
"BLD",5784,"KRN",101,0)
101
"BLD",5784,"KRN",409.61,0)
409.61
"BLD",5784,"KRN",771,0)
771
"BLD",5784,"KRN",870,0)
870
"BLD",5784,"KRN",8989.51,0)
8989.51
"BLD",5784,"KRN",8989.52,0)
8989.52
"BLD",5784,"KRN",8994,0)
8994
"BLD",5784,"KRN","B",.4,.4)

"BLD",5784,"KRN","B",.401,.401)

"BLD",5784,"KRN","B",.402,.402)

"BLD",5784,"KRN","B",.403,.403)

"BLD",5784,"KRN","B",.5,.5)

"BLD",5784,"KRN","B",.84,.84)

"BLD",5784,"KRN","B",3.6,3.6)

"BLD",5784,"KRN","B",3.8,3.8)

"BLD",5784,"KRN","B",9.2,9.2)

"BLD",5784,"KRN","B",9.8,9.8)

"BLD",5784,"KRN","B",19,19)

"BLD",5784,"KRN","B",19.1,19.1)

"BLD",5784,"KRN","B",101,101)

"BLD",5784,"KRN","B",409.61,409.61)

"BLD",5784,"KRN","B",771,771)

"BLD",5784,"KRN","B",870,870)

"BLD",5784,"KRN","B",8989.51,8989.51)

"BLD",5784,"KRN","B",8989.52,8989.52)

"BLD",5784,"KRN","B",8994,8994)

"BLD",5784,"QUES",0)
^9.62^^
"BLD",5784,"REQB",0)
^9.611^1^1
"BLD",5784,"REQB",1,0)
ECX*3.0*54^2
"BLD",5784,"REQB","B","ECX*3.0*54",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
75^3041006
"PKG",535,22,1,"PAH",1,1,0)
^^2^2^3041006
"PKG",535,22,1,"PAH",1,1,1,0)
This patch provides a fix to the DSS Extracts when transmitting
"PKG",535,22,1,"PAH",1,1,2,0)
extracts to the production queue.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXTRANS")
0^1^B62743132
"RTN","ECXTRANS",1,0)
ECXTRANS ;ALB/GTS,JAP,BIR/DMA-Extract from Local Editing Files and Transmit ; [ 11/26/96  2:13 PM ]
"RTN","ECXTRANS",2,0)
 ;;3.0;DSS EXTRACTS;**2,9,12,8,13,14,23,24,33,49,54,75**;Dec 22, 1997
"RTN","ECXTRANS",3,0)
EN ;entry point
"RTN","ECXTRANS",4,0)
 N ECDA,ECRE,ECTMP,ECCHK,ECDIVVR,ECXDIQ,JJ,SS,OUT,DIR,DUOUT
"RTN","ECXTRANS",5,0)
 N DTOUT,DIRUT,DIC,X,Y,ECXLOGIC,ECSD,FODMN
"RTN","ECXTRANS",6,0)
 S ECXQUEUE=$P($G(^ECX(728,1,"QUEUE")),"^",1)
"RTN","ECXTRANS",7,0)
 I ECXQUEUE'?1"DM"1U D  Q
"RTN","ECXTRANS",8,0)
 .W !,"You have not defined a proper transmission queue"
"RTN","ECXTRANS",9,0)
 .W !,"for entry number 1 in the DSS EXTRACTS file (#728)."
"RTN","ECXTRANS",10,0)
 .W !,"No transmission allowed."
"RTN","ECXTRANS",11,0)
 .D PAUSE
"RTN","ECXTRANS",12,0)
 ;** check divisions for transmission
"RTN","ECXTRANS",13,0)
 S ECCHK=$$DIV4^XUSER(.ECTMP,DUZ)
"RTN","ECXTRANS",14,0)
 I 'ECCHK D  Q
"RTN","ECXTRANS",15,0)
 .W !,"You do not have any divisions defined in your user set up and cannot transmit."
"RTN","ECXTRANS",16,0)
 .S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","ECXTRANS",17,0)
 W !!,"Your user setup will only allow you to transmit extracts from the"
"RTN","ECXTRANS",18,0)
 W !,"following divisions:",!
"RTN","ECXTRANS",19,0)
 S ECDIVVR=""
"RTN","ECXTRANS",20,0)
 F  S ECDIVVR=$O(ECTMP(ECDIVVR)) Q:'(+ECDIVVR)  D
"RTN","ECXTRANS",21,0)
 .K ECXDIC S DA=ECDIVVR,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01"
"RTN","ECXTRANS",22,0)
 .D EN^DIQ1 W !,"   ",$G(ECXDIC(4,DA,.01,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXTRANS",23,0)
 W !!,"If you can't select an extract, it is probably from another division.",!
"RTN","ECXTRANS",24,0)
 D PAUSE Q:OUT
"RTN","ECXTRANS",25,0)
AGAIN S ECRE="",DIC="^ECX(727,",DIC(0)="AEQM"
"RTN","ECXTRANS",26,0)
 S DIC("A")="Transmit which extract: "
"RTN","ECXTRANS",27,0)
 S DIC("S")="I '$D(^ECX(727,+Y,""L"")),'$D(^ECX(727,+Y,""PURG"")),$D(ECTMP(+$P($G(^ECX(727,+Y,""DIV"")),U,1)))"
"RTN","ECXTRANS",28,0)
 D ^DIC
"RTN","ECXTRANS",29,0)
 I Y<0 W !! Q
"RTN","ECXTRANS",30,0)
 ;get data on extract
"RTN","ECXTRANS",31,0)
 S DR="1;2;3;4;5;6;14;15",(ECDA,DA)=+Y,DIQ(0)="IE",DIQ="ECXDIQ" D EN^DIQ1
"RTN","ECXTRANS",32,0)
 I ECXDIQ(727,ECDA,14,"I")="" D
"RTN","ECXTRANS",33,0)
 .S ECXDIQ(727,ECDA,14,"I")=$$FISCAL^ECXUTL1(ECXDIQ(727,ECDA,3,"I"))
"RTN","ECXTRANS",34,0)
 .S ECXDIQ(727,ECDA,14,"E")=ECXDIQ(727,ECDA,14,"I")
"RTN","ECXTRANS",35,0)
 S ECXLOGIC=ECXDIQ(727,ECDA,14,"I")
"RTN","ECXTRANS",36,0)
 S ECSD=ECXDIQ(727,ECDA,3,"I")
"RTN","ECXTRANS",37,0)
 W !!,ECXDIQ(727,ECDA,6,"E")_" Extract (#"_ECDA_")",?42,"Records:    ",ECXDIQ(727,ECDA,5,"E")
"RTN","ECXTRANS",38,0)
 W !,"Generated on: ",ECXDIQ(727,ECDA,1,"E"),?42,"Start date: ",ECXDIQ(727,ECDA,3,"E")
"RTN","ECXTRANS",39,0)
 W !,"Division:     ",$E(ECXDIQ(727,ECDA,15,"E"),1,26),?42,"End date:   ",ECXDIQ(727,ECDA,4,"E")
"RTN","ECXTRANS",40,0)
 S X=$E(ECXDIQ(727,ECDA,14,"I"),5) S X=$S((X="")!(X=" "):"",1:"revision "_X_" of ")
"RTN","ECXTRANS",41,0)
 W !!,"The data was extracted using "_X_"fiscal year "_$E(ECXDIQ(727,ECDA,14,"I"),1,4)_" logic."
"RTN","ECXTRANS",42,0)
 W !!,"MailMan transmission of the "_ECXDIQ(727,ECDA,2,"E")_" extract is set to a"
"RTN","ECXTRANS",43,0)
 W !,"limit of 131,000 bytes per message.  Each extract record ends with a ^~."
"RTN","ECXTRANS",44,0)
 I $G(^ECX(727,ECDA,"TR")) S ECX=^("TR") D  Q:OUT
"RTN","ECXTRANS",45,0)
 .S OUT=0
"RTN","ECXTRANS",46,0)
 .W !!,"This extract was transmitted on ",$TR($$FMTE^XLFDT(ECX,"5DF")," ","0")
"RTN","ECXTRANS",47,0)
 .K ECX S DIR(0)="Y",DIR("A")="Do you want to retransmit " D ^DIR K DIR
"RTN","ECXTRANS",48,0)
 .I 'Y S OUT=1 Q
"RTN","ECXTRANS",49,0)
 .K ^ECX(727,ECDA,"TR")
"RTN","ECXTRANS",50,0)
 .S ECRE="re"
"RTN","ECXTRANS",51,0)
 S ECTYPE=$P(^ECX(727,ECDA,0),U,3),ECIEN=+$O(^ECX(727.1,"AC",ECTYPE,0))
"RTN","ECXTRANS",52,0)
 S ECPIECE=$P($G(^ECX(727.1,ECIEN,0)),U,10)
"RTN","ECXTRANS",53,0)
 I ECPIECE>0,$P($G(^ECX(728,1,7.1)),U,ECPIECE)]"" D  Q
"RTN","ECXTRANS",54,0)
 .D MES^XPDUTL(" ")
"RTN","ECXTRANS",55,0)
 .D MES^XPDUTL("An "_ECTYPE_" Extract is currently running or scheduled to run.")
"RTN","ECXTRANS",56,0)
 .D MES^XPDUTL("Please wait until that job has completed before attempting")
"RTN","ECXTRANS",57,0)
 .D MES^XPDUTL("this transmission.")
"RTN","ECXTRANS",58,0)
 .D MES^XPDUTL(" ")
"RTN","ECXTRANS",59,0)
 .D PAUSE
"RTN","ECXTRANS",60,0)
 S ZTSK=$G(^ECX(727,ECDA,"Q"))
"RTN","ECXTRANS",61,0)
 I ZTSK D STAT^%ZTLOAD I ZTSK(0) I ZTSK(1)<3 D  Q
"RTN","ECXTRANS",62,0)
 .W !!,"Task ",ZTSK," is already queued to transmit this extract."
"RTN","ECXTRANS",63,0)
 .K ZTSK
"RTN","ECXTRANS",64,0)
 .D PAUSE
"RTN","ECXTRANS",65,0)
 S FODMN=$$FODMN()
"RTN","ECXTRANS",66,0)
 ;Field office reminder
"RTN","ECXTRANS",67,0)
 I FODMN D
"RTN","ECXTRANS",68,0)
 .W !
"RTN","ECXTRANS",69,0)
 .W !,"** This extract is being sent from a field office domain.  **"
"RTN","ECXTRANS",70,0)
 .W !,"** Extract message(s) will only be delivered to you and    **"
"RTN","ECXTRANS",71,0)
 .W !,"** will be placed into your 'DSSXMIT' mail basket.         **"
"RTN","ECXTRANS",72,0)
 .W !
"RTN","ECXTRANS",73,0)
 .;Ensure user has a DSSXMIT mail basket
"RTN","ECXTRANS",74,0)
 .N TMPARR
"RTN","ECXTRANS",75,0)
 .D LISTBSKT^XMXAPIB(DUZ,,,,"DSSXMIT","TMPARR")
"RTN","ECXTRANS",76,0)
 .I '$D(TMPARR("XMLIST","BSKT","DSSXMIT")) D
"RTN","ECXTRANS",77,0)
 ..;Create DSSXMIT basket
"RTN","ECXTRANS",78,0)
 ..N IEN,XMERR
"RTN","ECXTRANS",79,0)
 ..D CRE8BSKT^XMXAPIB(DUZ,"DSSXMIT",.IEN)
"RTN","ECXTRANS",80,0)
 ..K ^TMP("XMERR",$J)
"RTN","ECXTRANS",81,0)
 ;Test queue clearance
"RTN","ECXTRANS",82,0)
 I 'FODMN I (ECXLOGIC'=$$FISCAL^ECXUTL1(ECSD))!((ECXLOGIC>$$FISCAL^ECXUTL1(DT))!(ECXLOGIC=$$FISCAL^ECXUTL1(DT))) D  Q:OUT
"RTN","ECXTRANS",83,0)
 .S OUT=0
"RTN","ECXTRANS",84,0)
 .K DIR
"RTN","ECXTRANS",85,0)
 .S DIR(0)="Y"
"RTN","ECXTRANS",86,0)
 .S DIR("A",1)="** This extract will be transmitted to the AAC test queue **"
"RTN","ECXTRANS",87,0)
 .S DIR("A")="Do you want to continue "
"RTN","ECXTRANS",88,0)
 .W !! D ^DIR
"RTN","ECXTRANS",89,0)
 .I 'Y S OUT=1 Q
"RTN","ECXTRANS",90,0)
 .S ECXQUEUE=$P($G(^ECX(728,1,"QUEUE")),"^",2)
"RTN","ECXTRANS",91,0)
 .S:ECXQUEUE="" ECXQUEUE="DMT"
"RTN","ECXTRANS",92,0)
 S ZTSAVE("ECDA")="",ZTSAVE("ECXQUEUE")="",ZTSAVE("ECRE")=""
"RTN","ECXTRANS",93,0)
 S ZTRTN="START^ECXTRANS",ZTIO=""
"RTN","ECXTRANS",94,0)
 S ZTDESC="Transmission of extract # "_ECDA
"RTN","ECXTRANS",95,0)
 W !! D ^%ZTLOAD
"RTN","ECXTRANS",96,0)
 I $D(ZTSK) D
"RTN","ECXTRANS",97,0)
 .W !,"Request queued as Task #",ZTSK,"."
"RTN","ECXTRANS",98,0)
 .S ^ECX(727,ECDA,"Q")=ZTSK K ZTSK
"RTN","ECXTRANS",99,0)
 .D PAUSE
"RTN","ECXTRANS",100,0)
 Q
"RTN","ECXTRANS",101,0)
 ; entry point for task
"RTN","ECXTRANS",102,0)
START N DA,DIC,DIQ,DR,ECAR1,ECAR2,ECC1,ECC2,ECED,ECGPR,ECF,ECGRP,ECHEAD,ECINST
"RTN","ECXTRANS",103,0)
 N ECMAX,ECMAXR,ECMSN,ECPACK,ECSIZ,ECVER,ECXDIC,I,J,EXDT
"RTN","ECXTRANS",104,0)
 N STR,STRCNT,X,ECSD,ECXLOGIC
"RTN","ECXTRANS",105,0)
 S:$P(^ECX(727,ECDA,0),U,3)'="Prosthetics" ECINST=$P(^ECX(728,1,0),U)
"RTN","ECXTRANS",106,0)
 S:$P(^ECX(727,ECDA,0),U,3)="Prosthetics" ECINST=$P(^("DIV"),U)
"RTN","ECXTRANS",107,0)
 S DA=ECINST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXTRANS",108,0)
 D EN^DIQ1 S ECINST=$G(ECXDIC(4,DA,99,"I"))
"RTN","ECXTRANS",109,0)
 S ECF=^ECX(727,ECDA,"FILE"),ECHEAD=^("HEAD"),ECGRP=^("GRP")
"RTN","ECXTRANS",110,0)
 S X=^(0),ECPACK=$P(X,U,3),ECSD=$P(X,U,4),ECED=$P(X,U,5)
"RTN","ECXTRANS",111,0)
 S X=$G(^("VER")),ECVER=$P(X,"^",1),ECXLOGIC=$P(X,"^",2)
"RTN","ECXTRANS",112,0)
 S:'ECVER ECVER=1 S ECVER=$$RJ^XLFSTR(ECVER,3,0)
"RTN","ECXTRANS",113,0)
 I ECXLOGIC="" S ECXLOGIC=$$FISCAL^ECXUTL1(ECSD)
"RTN","ECXTRANS",114,0)
 S ECXLOGIC=$$PAD^ECXUTL1(ECXLOGIC,5,"B"," ")
"RTN","ECXTRANS",115,0)
 I ECPACK["(setup)" S ECXQUEUE="DMU"
"RTN","ECXTRANS",116,0)
 K ^TMP($J)
"RTN","ECXTRANS",117,0)
 S ECHD(1)=ECINST_ECHEAD_$$ECXYM^ECXUTL(ECED)_ECVER_ECXLOGIC
"RTN","ECXTRANS",118,0)
 S ECMAX=130000,ECMAXR=250,ECLN=2,ECMSN=1,(ECRN,ECSIZ)=0,J=""
"RTN","ECXTRANS",119,0)
 F  S J=$O(^ECX(ECF,"AC",ECDA,J)) Q:('J)  D
"RTN","ECXTRANS",120,0)
 .M ECAR1=^ECX(ECF,J) S (ECAR2,ECC2)=1,(ECAR2(ECC2),ECC1)=""
"RTN","ECXTRANS",121,0)
 .F  S ECC1=$O(ECAR1(ECC1)) Q:ECC1=""  D
"RTN","ECXTRANS",122,0)
 ..S:ECC1=0 ECAR1(ECC1)=$P(ECAR1(ECC1),"^",4,999)
"RTN","ECXTRANS",123,0)
 ..S ECAR2(ECC2)=ECAR2(ECC2)_ECAR1(ECC1) I $L(ECAR2(ECC2))>ECMAXR D
"RTN","ECXTRANS",124,0)
 ...F I=ECMAXR:-1:1 Q:$E(ECAR2(ECC2),I)="^"
"RTN","ECXTRANS",125,0)
 ...S (X,ECAR2)=ECAR2+1,ECAR2(X)=$E(ECAR2(ECC2),I+1,$L(ECAR2(ECC2)))
"RTN","ECXTRANS",126,0)
 ...S ECAR2(ECC2)=$E(ECAR2(ECC2),1,I),ECC2=X
"RTN","ECXTRANS",127,0)
 .S ECAR2(ECC2)=ECAR2(ECC2)_"^~",ECRN=ECRN+1,X=""
"RTN","ECXTRANS",128,0)
 .F  S X=$O(ECAR2(X)) Q:X=""  D
"RTN","ECXTRANS",129,0)
 ..S ^TMP($J,ECMSN,ECLN,0)=ECAR2(X),ECLN=ECLN+1,ECSIZ=ECSIZ+$L(ECAR2(X))
"RTN","ECXTRANS",130,0)
 .K ECAR1,ECAR2
"RTN","ECXTRANS",131,0)
 .I (ECSIZ>ECMAX),($O(^ECX(ECF,"AC",ECDA,J))) D
"RTN","ECXTRANS",132,0)
 ..S ECLN=2,ECMSN=ECMSN+1,ECSIZ=0
"RTN","ECXTRANS",133,0)
 ;quit if user stopped task
"RTN","ECXTRANS",134,0)
 I $$S^%ZTLOAD D CLEAN Q
"RTN","ECXTRANS",135,0)
 ;generate mailman messages to aac
"RTN","ECXTRANS",136,0)
 S ECXLNCNT=9,(ECXXMZ,STRCNT)=0,STR=""
"RTN","ECXTRANS",137,0)
 F ECMS=1:1:ECMSN D
"RTN","ECXTRANS",138,0)
 .D SEND(.ECXXMZ)
"RTN","ECXTRANS",139,0)
 .S STR=STR_$$RJ^XLFSTR(ECXXMZ,18," "),STRCNT=STRCNT+1 I STRCNT=4 D
"RTN","ECXTRANS",140,0)
 ..S ^TMP($J,"LOC",ECXLNCNT,0)=STR,ECXLNCNT=ECXLNCNT+1
"RTN","ECXTRANS",141,0)
 ..S STR="",STRCNT=0
"RTN","ECXTRANS",142,0)
 I STR]"" S ^TMP($J,"LOC",ECXLNCNT,0)=STR
"RTN","ECXTRANS",143,0)
 ;send msg to local dss grp
"RTN","ECXTRANS",144,0)
 D SENDLOC,CLEAN
"RTN","ECXTRANS",145,0)
 Q
"RTN","ECXTRANS",146,0)
 ;
"RTN","ECXTRANS",147,0)
SEND(ECXXMZ) ;send individual messages
"RTN","ECXTRANS",148,0)
 N ECXDD,DA,DIC,DIE,DINUM,X,Y,Z,XMDUZ,XMTEXT,XMSUB,XMY,XMZ,FODMN
"RTN","ECXTRANS",149,0)
 S XMSUB="("_ECGRP_") "_ECINST_" - "_ECPACK_" DSS EXTRACT, MESSAGE "_ECMS_" OF "_ECMSN
"RTN","ECXTRANS",150,0)
 S XMDUZ="DSS SYSTEM",^TMP($J,ECMS,1,0)=ECHD(1)
"RTN","ECXTRANS",151,0)
 S XMY("XXX@Q-"_ECXQUEUE_".VA.GOV")=""
"RTN","ECXTRANS",152,0)
 ;Send extracts done at field offices to user instead of AAC
"RTN","ECXTRANS",153,0)
 S FODMN=$$FODMN()
"RTN","ECXTRANS",154,0)
 I FODMN D
"RTN","ECXTRANS",155,0)
 .K XMY
"RTN","ECXTRANS",156,0)
 .S XMY(DUZ)=""
"RTN","ECXTRANS",157,0)
 S XMTEXT="^TMP($J,ECMS,"
"RTN","ECXTRANS",158,0)
 D ^XMD
"RTN","ECXTRANS",159,0)
 S ECXXMZ=XMZ
"RTN","ECXTRANS",160,0)
 ;store msg# in extract log
"RTN","ECXTRANS",161,0)
 D FIELD^DID(727,301,"","SPECIFIER","ECXDD")
"RTN","ECXTRANS",162,0)
 S DA(1)=ECDA,DIC(0)="L",DIC("P")=ECXDD("SPECIFIER")
"RTN","ECXTRANS",163,0)
 S DIC="^ECX(727,"_DA(1)_",1,",X=XMZ,DINUM=X
"RTN","ECXTRANS",164,0)
 K DD,DO D FILE^DICN
"RTN","ECXTRANS",165,0)
 ;Move message to DSSXMIT basket if sending from field office
"RTN","ECXTRANS",166,0)
 I FODMN D
"RTN","ECXTRANS",167,0)
 .N XMERR
"RTN","ECXTRANS",168,0)
 .D MOVEMSG^XMXAPI(DUZ,,XMZ,"DSSXMIT",.X)
"RTN","ECXTRANS",169,0)
 .K ^TMP("XMERR",$J)
"RTN","ECXTRANS",170,0)
 Q
"RTN","ECXTRANS",171,0)
 ;
"RTN","ECXTRANS",172,0)
SENDLOC ; send message to mail group 'DSS-ECGRP'
"RTN","ECXTRANS",173,0)
 S TIME=$P($$HTE^XLFDT($H),":",1,2)
"RTN","ECXTRANS",174,0)
 S XMSUB=ECINST_" - "_ECPACK_" EXTRACT FOR DSS",XMDUZ="DSS SYSTEM"
"RTN","ECXTRANS",175,0)
 K XMY S XMY(DUZ)="",XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXTRANS",176,0)
 S ^TMP($J,"LOC",1,0)="The DSS "_ECPACK_" ("_ECHEAD_") extract, #"_ECDA_","
"RTN","ECXTRANS",177,0)
 S ^TMP($J,"LOC",2,0)="was "_ECRE_"transmitted on "_$P(TIME,"@")_" at "_$P(TIME,"@",2)_". "
"RTN","ECXTRANS",178,0)
 S ^TMP($J,"LOC",3,0)=" "
"RTN","ECXTRANS",179,0)
 S ^TMP($J,"LOC",4,0)="Maximum number of Bytes (characters) per message: 131,000 "
"RTN","ECXTRANS",180,0)
 S ^TMP($J,"LOC",5,0)=" "
"RTN","ECXTRANS",181,0)
 S ^TMP($J,"LOC",6,0)="A total of "_ECRN_" records were written."
"RTN","ECXTRANS",182,0)
 S ^TMP($J,"LOC",7,0)="A total of "_ECMSN_" messages were sent."
"RTN","ECXTRANS",183,0)
 S ^TMP($J,"LOC",8,0)="    Message numbers :"
"RTN","ECXTRANS",184,0)
 S XMTEXT="^TMP($J,""LOC"","
"RTN","ECXTRANS",185,0)
 D ^XMD
"RTN","ECXTRANS",186,0)
 S ^ECX(727,ECDA,"TR")=DT
"RTN","ECXTRANS",187,0)
 Q
"RTN","ECXTRANS",188,0)
 ;
"RTN","ECXTRANS",189,0)
CLEAN ;clean-up
"RTN","ECXTRANS",190,0)
 S ZTREQ="@"
"RTN","ECXTRANS",191,0)
 K ^TMP($J),^ECX(727,ECDA,"Q"),XMDUZ,XMTEXT,XMSUB,XMY,XMZ
"RTN","ECXTRANS",192,0)
 K ECDA,ECRE,ECTMP,ECCHK,ECDIVVR,ECXDIQ,ECXMAX,ECXMSG
"RTN","ECXTRANS",193,0)
 D ^ECXKILL
"RTN","ECXTRANS",194,0)
 I $$S^%ZTLOAD K ZTREQ S ZTSTOP=1
"RTN","ECXTRANS",195,0)
 Q
"RTN","ECXTRANS",196,0)
 ;
"RTN","ECXTRANS",197,0)
PAUSE ;pause screen
"RTN","ECXTRANS",198,0)
 S OUT=0
"RTN","ECXTRANS",199,0)
 I $E(IOST)="C" D
"RTN","ECXTRANS",200,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXTRANS",201,0)
 .K DIR S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXTRANS",202,0)
 I 'Y S OUT=1
"RTN","ECXTRANS",203,0)
 W !!
"RTN","ECXTRANS",204,0)
 Q
"RTN","ECXTRANS",205,0)
 ;
"RTN","ECXTRANS",206,0)
FODMN(DOMAIN)   ;Is domain a field office domain
"RTN","ECXTRANS",207,0)
 ;Input : DOMAIN - Domain name to check
"RTN","ECXTRANS",208,0)
 ;               - Default value pulled from ^XMB("NETNAME")
"RTN","ECXTRANS",209,0)
 ;Output: 1 = Yes  /  0 = No
"RTN","ECXTRANS",210,0)
 ;
"RTN","ECXTRANS",211,0)
 N X,SUB,OUT
"RTN","ECXTRANS",212,0)
 S DOMAIN=$G(DOMAIN)
"RTN","ECXTRANS",213,0)
 S:(DOMAIN="") DOMAIN=$G(^XMB("NETNAME"))
"RTN","ECXTRANS",214,0)
 S OUT=0
"RTN","ECXTRANS",215,0)
 F X=1:1:$L(DOMAIN,".") D  Q:OUT
"RTN","ECXTRANS",216,0)
 .S SUB=$P(DOMAIN,".",X)
"RTN","ECXTRANS",217,0)
 .I ($E(SUB,1,3)="FO-")!($E(SUB,1,4)="ISC-") S OUT=1
"RTN","ECXTRANS",218,0)
 Q OUT
"VER")
8.0^22
**END**
**END**
