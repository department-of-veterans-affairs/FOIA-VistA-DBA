EMERGENCY Released DG*5.3*491 SEQ #433
Extracted from mail message
**KIDS**:DG*5.3*491^

**INSTALL NAME**
DG*5.3*491
"BLD",4196,0)
DG*5.3*491^REGISTRATION^0^3030210^y
"BLD",4196,1,0)
^^1^1^3021219^
"BLD",4196,1,1,0)
ENROLLMENT SUB-PRIORITIES
"BLD",4196,4,0)
^9.64PA^27.16^2
"BLD",4196,4,27.11,0)
27.11
"BLD",4196,4,27.11,2,0)
^9.641^27.11^1
"BLD",4196,4,27.11,2,27.11,0)
PATIENT ENROLLMENT  (File-top level)
"BLD",4196,4,27.11,2,27.11,1,0)
^9.6411^.12^1
"BLD",4196,4,27.11,2,27.11,1,.12,0)
ENROLLMENT SUBGROUP
"BLD",4196,4,27.11,222)
y^y^p^^^^n
"BLD",4196,4,27.16,0)
27.16
"BLD",4196,4,27.16,2,0)
^9.641^27.16^1
"BLD",4196,4,27.16,2,27.16,0)
ENROLLMENT GROUP THRESHOLD  (File-top level)
"BLD",4196,4,27.16,2,27.16,1,0)
^9.6411^.04^1
"BLD",4196,4,27.16,2,27.16,1,.04,0)
EGT TYPE
"BLD",4196,4,27.16,222)
y^y^p^^^^n
"BLD",4196,4,"APDD",27.11,27.11)

"BLD",4196,4,"APDD",27.11,27.11,.12)

"BLD",4196,4,"APDD",27.16,27.16)

"BLD",4196,4,"APDD",27.16,27.16,.04)

"BLD",4196,4,"B",27.11,27.11)

"BLD",4196,4,"B",27.16,27.16)

"BLD",4196,"KRN",0)
^9.67PA^8989.52^19
"BLD",4196,"KRN",.4,0)
.4
"BLD",4196,"KRN",.401,0)
.401
"BLD",4196,"KRN",.402,0)
.402
"BLD",4196,"KRN",.403,0)
.403
"BLD",4196,"KRN",.5,0)
.5
"BLD",4196,"KRN",.84,0)
.84
"BLD",4196,"KRN",3.6,0)
3.6
"BLD",4196,"KRN",3.8,0)
3.8
"BLD",4196,"KRN",9.2,0)
9.2
"BLD",4196,"KRN",9.8,0)
9.8
"BLD",4196,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",4196,"KRN",9.8,"NM",1,0)
DGENA3^^0^B38396869
"BLD",4196,"KRN",9.8,"NM",2,0)
DGENEGT1^^0^B24558798
"BLD",4196,"KRN",9.8,"NM",3,0)
DGENELA4^^0^B39191109
"BLD",4196,"KRN",9.8,"NM",4,0)
DGENRPT1^^0^B19994939
"BLD",4196,"KRN",9.8,"NM",5,0)
DGENRPT2^^0^B40316446
"BLD",4196,"KRN",9.8,"NM",6,0)
DGENRPT3^^0^B29772622
"BLD",4196,"KRN",9.8,"NM",7,0)
DGENRPT4^^0^B52785479
"BLD",4196,"KRN",9.8,"NM",8,0)
DGENA6^^0^B19162873
"BLD",4196,"KRN",9.8,"NM",9,0)
DGENA2^^0^B15510967
"BLD",4196,"KRN",9.8,"NM","B","DGENA2",9)

"BLD",4196,"KRN",9.8,"NM","B","DGENA3",1)

"BLD",4196,"KRN",9.8,"NM","B","DGENA6",8)

"BLD",4196,"KRN",9.8,"NM","B","DGENEGT1",2)

"BLD",4196,"KRN",9.8,"NM","B","DGENELA4",3)

"BLD",4196,"KRN",9.8,"NM","B","DGENRPT1",4)

"BLD",4196,"KRN",9.8,"NM","B","DGENRPT2",5)

"BLD",4196,"KRN",9.8,"NM","B","DGENRPT3",6)

"BLD",4196,"KRN",9.8,"NM","B","DGENRPT4",7)

"BLD",4196,"KRN",19,0)
19
"BLD",4196,"KRN",19.1,0)
19.1
"BLD",4196,"KRN",101,0)
101
"BLD",4196,"KRN",409.61,0)
409.61
"BLD",4196,"KRN",771,0)
771
"BLD",4196,"KRN",870,0)
870
"BLD",4196,"KRN",8989.51,0)
8989.51
"BLD",4196,"KRN",8989.52,0)
8989.52
"BLD",4196,"KRN",8994,0)
8994
"BLD",4196,"KRN","B",.4,.4)

"BLD",4196,"KRN","B",.401,.401)

"BLD",4196,"KRN","B",.402,.402)

"BLD",4196,"KRN","B",.403,.403)

"BLD",4196,"KRN","B",.5,.5)

"BLD",4196,"KRN","B",.84,.84)

"BLD",4196,"KRN","B",3.6,3.6)

"BLD",4196,"KRN","B",3.8,3.8)

"BLD",4196,"KRN","B",9.2,9.2)

"BLD",4196,"KRN","B",9.8,9.8)

"BLD",4196,"KRN","B",19,19)

"BLD",4196,"KRN","B",19.1,19.1)

"BLD",4196,"KRN","B",101,101)

"BLD",4196,"KRN","B",409.61,409.61)

"BLD",4196,"KRN","B",771,771)

"BLD",4196,"KRN","B",870,870)

"BLD",4196,"KRN","B",8989.51,8989.51)

"BLD",4196,"KRN","B",8989.52,8989.52)

"BLD",4196,"KRN","B",8994,8994)

"FIA",27.11)
PATIENT ENROLLMENT
"FIA",27.11,0)
^DGEN(27.11,
"FIA",27.11,0,0)
27.11OID
"FIA",27.11,0,1)
y^y^p^^^^n
"FIA",27.11,0,10)

"FIA",27.11,0,11)

"FIA",27.11,0,"RLRO")

"FIA",27.11,0,"VR")
5.3^DG
"FIA",27.11,27.11)
1
"FIA",27.11,27.11,.12)

"FIA",27.16)
ENROLLMENT GROUP THRESHOLD
"FIA",27.16,0)
^DGEN(27.16,
"FIA",27.16,0,0)
27.16DO
"FIA",27.16,0,1)
y^y^p^^^^n
"FIA",27.16,0,10)

"FIA",27.16,0,11)

"FIA",27.16,0,"RLRO")

"FIA",27.16,0,"VR")
5.3^DG
"FIA",27.16,27.16)
1
"FIA",27.16,27.16,.04)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
491^3030210
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3030210
"PKG",5,22,1,"PAH",1,1,1,0)
ENROLLMENT SUB-PRIORITIES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","DGENA2")
0^9^B15510967
"RTN","DGENA2",1,0)
DGENA2 ;ALB/CJM,RTK,TDM - Enrollment API - Automatic Update; 9/19/2002 ; 1/31/03 11:54am
"RTN","DGENA2",2,0)
 ;;5.3;Registration;**121,122,147,232,327,469,491**;Aug 13,1993
"RTN","DGENA2",3,0)
 ;
"RTN","DGENA2",4,0)
AUTOUPD(DFN,EVENT) ;
"RTN","DGENA2",5,0)
 ;Description: If the patient meets the criteria for transmission to HEC,
"RTN","DGENA2",6,0)
 ;   he is entered to the IVM PATIENT file for future transmission.
"RTN","DGENA2",7,0)
 ;   This procedure checks for changes in enrollment priority,
"RTN","DGENA2",8,0)
 ;   status and fields in the eligibility sub-record. If any changes are
"RTN","DGENA2",9,0)
 ;   found, the current enrollment record is automatically updated.
"RTN","DGENA2",10,0)
 ;Input:
"RTN","DGENA2",11,0)
 ;  DFN - Patient IEN
"RTN","DGENA2",12,0)
 ;  EVENT - Event Type (optional)
"RTN","DGENA2",13,0)
 ;          EVENT 1 : Date of Death Deleted
"RTN","DGENA2",14,0)
 ;          EVENT 2 : Ineligible Date Deleted
"RTN","DGENA2",15,0)
 ;Output: None
"RTN","DGENA2",16,0)
 ;
"RTN","DGENA2",17,0)
 ;if the eligibility/enrollment upload is in progess, do not do anything
"RTN","DGENA2",18,0)
 Q:($G(DGENUPLD)="ENROLLMENT/ELIGIBILITY UPLOAD IN PROGRESS")
"RTN","DGENA2",19,0)
 ;
"RTN","DGENA2",20,0)
 ; If the INCOME TEST DATA (Z10) upload is in progess, do not do anything
"RTN","DGENA2",21,0)
 Q:($G(IVMZ10)="UPLOAD IN PROGRESS")
"RTN","DGENA2",22,0)
 ;
"RTN","DGENA2",23,0)
 N DGENRIEN,DGENR1,DGENR2,STATUS,EFFDATE,OK,DEATH
"RTN","DGENA2",24,0)
 ;
"RTN","DGENA2",25,0)
 ;try to prevent problems rsulting from calling FM within FM
"RTN","DGENA2",26,0)
 N DS,D0,DO,D1,DA,DD,DS,DG,DIC,DICR,DIE,DIG,DIH,DIV,DIW,DIX,DQ,DR
"RTN","DGENA2",27,0)
 ;
"RTN","DGENA2",28,0)
 S EVENT=+$G(EVENT)
"RTN","DGENA2",29,0)
 ;
"RTN","DGENA2",30,0)
 D EVENT^IVMPLOG(DFN)
"RTN","DGENA2",31,0)
 ;
"RTN","DGENA2",32,0)
 D:$$LOCK^DGENA1($G(DFN))  ;may drop out of block
"RTN","DGENA2",33,0)
 .S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENA2",34,0)
 .Q:'DGENRIEN
"RTN","DGENA2",35,0)
 .Q:'$$GET^DGENA(DGENRIEN,.DGENR1)
"RTN","DGENA2",36,0)
 .S STATUS=$$EXT^DGENU("STATUS",DGENR1("STATUS"))
"RTN","DGENA2",37,0)
 .S (DEATH,EFFDATE)=$$DEATH^DGENPTA(DFN)
"RTN","DGENA2",38,0)
 .I STATUS'="VERIFIED",STATUS'="UNVERIFIED",STATUS'="DECEASED",STATUS'["NOT ELIGIBLE",STATUS'["PENDING",STATUS'["REJECTED" Q
"RTN","DGENA2",39,0)
 .I STATUS="DECEASED",((EVENT'=1)!(DEATH)) Q
"RTN","DGENA2",40,0)
 .I STATUS["NOT ELIGIBLE",((EVENT'=2)!('$$VET^DGENPTA(DFN))) Q
"RTN","DGENA2",41,0)
 .S:'EFFDATE EFFDATE=DT
"RTN","DGENA2",42,0)
 .Q:'$$CREATE^DGENA6(DFN,DGENR1("APP"),EFFDATE,DGENR1("REASON"),DGENR1("REMARKS"),.DGENR2,DGENR1("DATE"),DGENR1("END"))
"RTN","DGENA2",43,0)
 .S OK=1
"RTN","DGENA2",44,0)
 .S:(DGENR1("PRIORITY")'=DGENR2("PRIORITY"))!(DGENR2("STATUS")'=DGENR1("STATUS")) OK=0
"RTN","DGENA2",45,0)
 .I OK D
"RTN","DGENA2",46,0)
 ..N SUB
"RTN","DGENA2",47,0)
 ..S SUB=""
"RTN","DGENA2",48,0)
 ..F  S SUB=$O(DGENR2("ELIG",SUB)) Q:SUB=""  S:(DGENR1("ELIG",SUB)'=DGENR2("ELIG",SUB)) OK=0
"RTN","DGENA2",49,0)
 .I 'OK D
"RTN","DGENA2",50,0)
 ..I (DGENR1("EFFDATE")=DGENR2("EFFDATE")),(DGENR1("SOURCE")=DGENR2("SOURCE")),(DGENR1("USER")=DGENR2("USER")),(DGENR1("DATETIME")\1)=(DGENR2("DATETIME")\1) D
"RTN","DGENA2",51,0)
 ...;in this case it's an overlay
"RTN","DGENA2",52,0)
 ...S DGENR2("PRIORREC")=DGENR1("PRIORREC")
"RTN","DGENA2",53,0)
 ...I $$EDITCUR^DGENA1(.DGENR2)
"RTN","DGENA2",54,0)
 ..E  D
"RTN","DGENA2",55,0)
 ...;in this case create a new record, to preserve the audit trail
"RTN","DGENA2",56,0)
 ...I $$STORECUR^DGENA1(.DGENR2)
"RTN","DGENA2",57,0)
 D UNLOCK^DGENA1($G(DFN))
"RTN","DGENA2",58,0)
 Q
"RTN","DGENA2",59,0)
MTUPD ;
"RTN","DGENA2",60,0)
 ;Description - entry point for Means Test Event Driver for Enrollment
"RTN","DGENA2",61,0)
 ;
"RTN","DGENA2",62,0)
 D AUTOUPD($G(DFN))
"RTN","DGENA2",63,0)
 Q
"RTN","DGENA2",64,0)
 ;
"RTN","DGENA2",65,0)
SDDIS ;Entry point for the DGEN SD DISPLAY CURRENT ENROLLMENT protocol,
"RTN","DGENA2",66,0)
 ;which hangs of the Scheduling Event Driver
"RTN","DGENA2",67,0)
 ;
"RTN","DGENA2",68,0)
 N DFN S DFN=$P($G(SDATA),"^",2)
"RTN","DGENA2",69,0)
 ;
"RTN","DGENA2",70,0)
 ;don't display if running in the background
"RTN","DGENA2",71,0)
 Q:$D(ZTQUEUED)
"RTN","DGENA2",72,0)
 ;
"RTN","DGENA2",73,0)
 ;don't want to display enrollment for non-vets with no enrollment status
"RTN","DGENA2",74,0)
 Q:('$$VET^DGENPTA(DFN))&('$$STATUS^DGENA(DFN))
"RTN","DGENA2",75,0)
 ;
"RTN","DGENA2",76,0)
 ;if making an appt., & in interactive mode, display enrollment status
"RTN","DGENA2",77,0)
 I ($G(SDAMEVT)=1),$G(SDMODE)=0 D
"RTN","DGENA2",78,0)
 .D DISPLAY^DGENU($P($G(SDATA),"^",2))
"RTN","DGENA2",79,0)
 .D PAUSE^VALM1
"RTN","DGENA2",80,0)
 ;
"RTN","DGENA2",81,0)
 ;want to do the same thing for check-in, unless appt just made
"RTN","DGENA2",82,0)
 I ($G(SDAMEVT)=4),$G(SDMODE)=0 D
"RTN","DGENA2",83,0)
 .;want to try avoiding giving display if it was done already
"RTN","DGENA2",84,0)
 .;so, if it is an unscheduled appt made today, skip
"RTN","DGENA2",85,0)
 .N PTNODE,SCNODE
"RTN","DGENA2",86,0)
 .S SCNODE=$G(^TMP("SDAMEVT",$J,"AFTER","SC"))
"RTN","DGENA2",87,0)
 .S PTNODE=$G(^TMP("SDAMEVT",$J,"AFTER","DPT"))
"RTN","DGENA2",88,0)
 .I +$P(SCNODE,"^",7)=$G(DT),$P(PTNODE,"^",7)=4 Q  ;unscheduled appt made today
"RTN","DGENA2",89,0)
 .D DISPLAY^DGENU($P($G(SDATA),"^",2))
"RTN","DGENA2",90,0)
 .D PAUSE^VALM1
"RTN","DGENA2",91,0)
 Q
"RTN","DGENA2",92,0)
 ;
"RTN","DGENA2",93,0)
ENROLL ;Entry point for the DGEN SD ENROLL PATIENT protocol, which hangs of
"RTN","DGENA2",94,0)
 ;the Scheduling Event Driver. This event enrolls patients upon check-out
"RTN","DGENA2",95,0)
 ;if there is no prior enrollment record.
"RTN","DGENA2",96,0)
 ;
"RTN","DGENA2",97,0)
 ; Input  -- SDATA & SDAMEVT defined by the scheduling event driver
"RTN","DGENA2",98,0)
 ; Output -- none
"RTN","DGENA2",99,0)
 ;
"RTN","DGENA2",100,0)
 N DGENR,DFN
"RTN","DGENA2",101,0)
 ;
"RTN","DGENA2",102,0)
 ;NOTE - it appears from testing that means test status REQUIRED is set
"RTN","DGENA2",103,0)
 ;within scheduling, obviating the need to do it here.  This is why
"RTN","DGENA2",104,0)
 ;several lines are commented out.
"RTN","DGENA2",105,0)
 ;
"RTN","DGENA2",106,0)
 ;N DGENR,DGOKF,DGREQF,DFN,DGMSGF,DG,DGMT,DGMTCOR,DGMTE,DGRGAUTO,DGWRT,XMZ,DIG,DIH
"RTN","DGENA2",107,0)
 ;
"RTN","DGENA2",108,0)
 ;check-out?
"RTN","DGENA2",109,0)
 Q:($G(SDAMEVT)'=5)
"RTN","DGENA2",110,0)
 ;
"RTN","DGENA2",111,0)
 S DFN=$P($G(SDATA),"^",2)
"RTN","DGENA2",112,0)
 ;
"RTN","DGENA2",113,0)
 ;don't enroll if the patient has an enrollment record
"RTN","DGENA2",114,0)
 Q:$$FINDCUR^DGENA(DFN)
"RTN","DGENA2",115,0)
 ;
"RTN","DGENA2",116,0)
 ;non-vet?
"RTN","DGENA2",117,0)
 Q:'$$VET^DGENPTA(DFN)
"RTN","DGENA2",118,0)
 ;
"RTN","DGENA2",119,0)
 ;dead?
"RTN","DGENA2",120,0)
 Q:$$DEATH^DGENPTA(DFN)
"RTN","DGENA2",121,0)
 ;
"RTN","DGENA2",122,0)
 ;Does patient require a Means Test?
"RTN","DGENA2",123,0)
 ;S DGMSGF=1
"RTN","DGENA2",124,0)
 ;D EN^DGMTR
"RTN","DGENA2",125,0)
 ;
"RTN","DGENA2",126,0)
 ;Create local enrollment array
"RTN","DGENA2",127,0)
 I $$CREATE^DGENA6(DFN,DT,,,,.DGENR) D
"RTN","DGENA2",128,0)
 . ;
"RTN","DGENA2",129,0)
 . ;Store local enrollment as current
"RTN","DGENA2",130,0)
 . I $$STORECUR^DGENA1(.DGENR) D
"RTN","DGENA2",131,0)
 . . ;
"RTN","DGENA2",132,0)
 . . ;If patient's means test status is required, send bulletin
"RTN","DGENA2",133,0)
 . . ;I $$MTREQ^DGEN(DFN) D MTBULL^DGEN(DFN,.DGENR)
"RTN","DGENA2",134,0)
 Q
"RTN","DGENA3")
0^1^B38396869
"RTN","DGENA3",1,0)
DGENA3 ;ALB/CJM,ISA/KWP,RTK,TDM,LBD - Enrollment API - Consistency check 05/05/99 ; 8/2/02 10:12am
"RTN","DGENA3",2,0)
 ;;5.3;Registration;**232,306,327,367,417,454,456,491**;Aug 13,1993
"RTN","DGENA3",3,0)
 ;CHECKand TESTVAL moved from DGENA1
"RTN","DGENA3",4,0)
CHECK(DGENR,DGPAT,ERRMSG) ;
"RTN","DGENA3",5,0)
 ;Phase II consistency checks do not include INACTIVE(3),REJECTED(4),SUSPENDED(5),EXPIRED(8),PENDING(9) enrollment statuses.  References to these statuses have been removed.
"RTN","DGENA3",6,0)
 ;Description: Does validation checks on the enrollment contained in the
"RTN","DGENA3",7,0)
 ;     DGENR array.
"RTN","DGENA3",8,0)
 ;Input:
"RTN","DGENA3",9,0)
 ;  DGENR - this local array contains an enrollment and should be passed
"RTN","DGENA3",10,0)
 ;      by reference
"RTN","DGENA3",11,0)
 ;  DGPAT - this local array contains the patient object, it is optional
"RTN","DGENA3",12,0)
 ;          If not passed,the database is referenced. (pass by reference)
"RTN","DGENA3",13,0)
 ;Output:
"RTN","DGENA3",14,0)
 ;  Function Value - returns 1 if all validation checks passed, 0
"RTN","DGENA3",15,0)
 ;     otherwise
"RTN","DGENA3",16,0)
 ;  ERRMSG - if the consistency checks fail, an error msg is returned (pass by reference)
"RTN","DGENA3",17,0)
 N VALID,DGELGSUB,SUB,PRIGRP
"RTN","DGENA3",18,0)
 S VALID=0
"RTN","DGENA3",19,0)
 S ERRMSG=""
"RTN","DGENA3",20,0)
 D  ;drops out of block if invalid condition found
"RTN","DGENA3",21,0)
 .I '$G(DGENR("DFN")) S ERRMSG="PATIENT NOT FOUND IN DATABASE" Q
"RTN","DGENA3",22,0)
 .I '$D(^DPT(DGENR("DFN"),0)) S ERRMSG="PATIENT NOT FOUND IN DATABASE" Q
"RTN","DGENA3",23,0)
 .;if it points to a prior record, the DFN must match
"RTN","DGENA3",24,0)
 .I DGENR("PRIORREC") D  Q:(ERRMSG'="")
"RTN","DGENA3",25,0)
 ..N DFN
"RTN","DGENA3",26,0)
 ..S DFN=$P($G(^DGEN(27.11,DGENR("PRIORREC"),0)),"^",2)
"RTN","DGENA3",27,0)
 ..I DFN,DFN'=DGENR("DFN") S ERRMSG="PATIENT'S PRIOR ENROLLMENT BELONGS TO ANOTHER PATIENT"
"RTN","DGENA3",28,0)
 .;check for required fields
"RTN","DGENA3",29,0)
 .F SUB="APP","SOURCE","STATUS","EFFDATE" I $G(DGENR(SUB))="" S ERRMSG="ENROLLMENT FIELD "_$$GET1^DID(27.11,$$FIELD^DGENU(SUB),"","LABEL")_" IS MISSING" Q
"RTN","DGENA3",30,0)
 .Q:(ERRMSG'="")
"RTN","DGENA3",31,0)
 .;if the enrollment priority is present, it must be correct
"RTN","DGENA3",32,0)
 .M DGELGSUB=DGENR("ELIG")
"RTN","DGENA3",33,0)
 .;Phase II if the enrollment priority is present it must be correct based on the eligibility factors (SRS 6.5.1.2 d)
"RTN","DGENA3",34,0)
 .I DGENR("PRIORITY") D  Q:(ERRMSG'="")
"RTN","DGENA3",35,0)
 ..S PRIGRP=$$PRI^DGENELA4(DGENR("ELIG","CODE"),.DGELGSUB,DGENR("DATE"),$G(DGENR("APP")))
"RTN","DGENA3",36,0)
 ..;check priority
"RTN","DGENA3",37,0)
 ..I DGENR("PRIORITY")'=$P(PRIGRP,"^") D  Q
"RTN","DGENA3",38,0)
 ...S ERRMSG="ENROLLMENT PRIORITY IS INCONSISTENT WITH ELIGIBILITY DATA - PRIORITY SHOULD BE "_$P(PRIGRP,"^")_$$EXTERNAL^DILFD(27.11,.12,"F",$P(PRIGRP,"^",2))
"RTN","DGENA3",39,0)
 ..;check subgroup if priority = 7 or 8
"RTN","DGENA3",40,0)
 ..Q:DGENR("PRIORITY")<7
"RTN","DGENA3",41,0)
 ..; sub-priority "e" can be overridden with "a" at HEC
"RTN","DGENA3",42,0)
 ..I "^1^1^5^5^1^"[("^"_DGENR("SUBGRP")_"^"_$P(PRIGRP,"^",2)_"^") Q
"RTN","DGENA3",43,0)
 ..; sub-priority "g" can be overridden with "c" at HEC
"RTN","DGENA3",44,0)
 ..I "^3^3^7^7^3^"[("^"_DGENR("SUBGRP")_"^"_$P(PRIGRP,"^",2)_"^") Q
"RTN","DGENA3",45,0)
 ..S ERRMSG="ENROLLMENT PRIORITY IS INCONSISTENT WITH ELIGIBILITY DATA - PRIORITY SHOULD BE "_$P(PRIGRP,"^")_$$EXTERNAL^DILFD(27.11,.12,"F",$P(PRIGRP,"^",2))
"RTN","DGENA3",46,0)
 .;
"RTN","DGENA3",47,0)
 .;Phase II require priority if status is VERIFIED(2),REJECTED-INITIAL APP(14),REJECTED-FISCAL YEAR(11),REJECTED-MIDCYCLE(12),REJECTED-STOP ENROLL(13),REJECTED BELOW EGT THRESHOLD(SRS 6.5.1.2 b)
"RTN","DGENA3",48,0)
 .I (DGENR("STATUS")=2)!(DGENR("STATUS")=14)!(DGENR("STATUS")=11)!(DGENR("STATUS")=12)!(DGENR("STATUS")=13)!(DGENR("STATUS")=22),DGENR("PRIORITY")="" D  Q
"RTN","DGENA3",49,0)
 ..S ERRMSG="ENROLLMENT PRIORITY IS REQUIRED WITH ENROLLMENT STATUSES: VERIFIED,REJECTED-INITIAL APPLICATION BY VAMC,REJECTED-FISCAL YEAR,REJECTED-MID-CYCLE,REJECTED-STOP NEW ENROLLMENTS,REJECTED-BELOW EGT"
"RTN","DGENA3",50,0)
 .;Phase II require enrollment date when status is verified(2)(SRS 6.5.1.2 d)
"RTN","DGENA3",51,0)
 .I DGENR("STATUS")=2,DGENR("DATE")="" S ERRMSG="ENROLLMENT DATE IS REQUIRED WHEN STATUS IS VERIFIED" Q
"RTN","DGENA3",52,0)
 .;Phase II if enrollment date present with statuses other than verified then veteran must be previously VERIFIED(2) and enrolled (SRS 6.5.1.2 d)
"RTN","DGENA3",53,0)
 .N CURIEN S CURIEN=$$FINDCUR^DGENA(DGENR("DFN"))
"RTN","DGENA3",54,0)
 .I DGENR("DATE"),DGENR("DATE")'="@",DGENR("STATUS")'=2,'CURIEN S ERRMSG="ENROLLMENT DATE IS PRESENT WITH STATUS OTHER THAN VERIFIED AND THE VETERAN WAS NOT PREVIOUSLY ENROLLED." Q
"RTN","DGENA3",55,0)
 .I DGENR("DATE"),DGENR("DATE")'="@",DGENR("STATUS")'=2,CURIEN,$P($G(^DGEN(27.11,CURIEN,0)),"^",4)'=2 S ERRMSG="ENROLLMENT DATE IS PRESENT WITH STATUS OTHER THAN VERIFIED WAS PREVIOUSLY ENROLLED BUT THE PREVIOUS STATUS WAS NOT VERIFIED." Q
"RTN","DGENA3",56,0)
 .;if status is not CANCELED/DECLINED, the REASON field should be ""
"RTN","DGENA3",57,0)
 .I (DGENR("STATUS")'=7),DGENR("REASON") S ERRMSG="ENROLLMENT STATUS OF OTHER THAN CANCELED/DECLINED IS INCONSISTENT WITH REASON CANCELED/DECLINED" Q
"RTN","DGENA3",58,0)
 .;if not an eligible vet, enrollment must not have status of VERIFIED, or UNVERIFIED
"RTN","DGENA3",59,0)
 .;if status is CANCELED/DECLINED, then reason is required
"RTN","DGENA3",60,0)
 .I (DGENR("STATUS")=7),'DGENR("REASON") S ERRMSG="STATUS OF CANCELED/DECLINED REQUIRES REASON" Q
"RTN","DGENA3",61,0)
 .;if status is DECEASED then Date of Death is required
"RTN","DGENA3",62,0)
 .I DGENR("STATUS")=6 D
"RTN","DGENA3",63,0)
 ..I $D(DGPAT),'DGPAT("DEATH") S ERRMSG="ENROLLMENT STATUS OF DECEASED REQUIRES DATE OF DEATH" Q
"RTN","DGENA3",64,0)
 ..I '$D(DGPAT),'$$DEATH^DGENPTA(DGENR("DFN")) S ERRMSG="ENROLLMENT STATUS OF DECEASED REQUIRES DATE OF DEATH" Q
"RTN","DGENA3",65,0)
 .Q:(ERRMSG'="")
"RTN","DGENA3",66,0)
 .;certain statuses not allowed for a dead patient
"RTN","DGENA3",67,0)
 .I $D(DGPAT),DGPAT("DEATH"),(DGENR("STATUS")=1)!(DGENR("STATUS")=2) S ERRMSG="ENROLLMENT STATUS OF VERIFIED OR UNVERIFIED NOT ALLOWED FOR A DECEASED PATIENT" Q
"RTN","DGENA3",68,0)
 .I '$D(DGPAT),$$DEATH^DGENPTA(DGENR("DFN")),(DGENR("STATUS")=1)!(DGENR("STATUS")=2) S ERRMSG="ENROLLMENT STATUS OF VERIFIED OR UNVERIFIED NOT ALLOWED FOR A DECEASED PATIENT" Q
"RTN","DGENA3",69,0)
 .;all the field values must be valid
"RTN","DGENA3",70,0)
 .S SUB="" F  S SUB=$O(DGENR(SUB)) Q:((ERRMSG'="")!(SUB=""))  D
"RTN","DGENA3",71,0)
 ..I SUB'="ELIG",(SUB'="DATE"),(SUB'="FACREC") I '$$TESTVAL(SUB,DGENR(SUB)) S ERRMSG="ENROLLMENT FIELD "_$$GET1^DID(27.11,$$FIELD^DGENU(SUB),"","LABEL")_" IS NOT VALID"
"RTN","DGENA3",72,0)
 .Q:(ERRMSG'="")
"RTN","DGENA3",73,0)
 .S SUB="" F  S SUB=$O(DGENR("ELIG",SUB)) Q:((ERRMSG'="")!(SUB=""))  D
"RTN","DGENA3",74,0)
 ..I '$$TESTVAL(SUB,DGENR("ELIG",SUB)) S ERRMSG="ENROLLMENT FIELD  "_$$GET1^DID(27.11,$$FIELD^DGENU(SUB),"","LABEL")_" IS NOT VALID"
"RTN","DGENA3",75,0)
 .;if this point is reached it's valid
"RTN","DGENA3",76,0)
 .S VALID=1
"RTN","DGENA3",77,0)
 Q VALID
"RTN","DGENA3",78,0)
TESTVAL(SUB,VAL) ;
"RTN","DGENA3",79,0)
 ;Description: returns 1 if VAL is a valid value for subscript SUB
"RTN","DGENA3",80,0)
 N DISPLAY,FIELD,RESULT,VALID
"RTN","DGENA3",81,0)
 S VALID=1
"RTN","DGENA3",82,0)
 I (VAL'="") D
"RTN","DGENA3",83,0)
 .S FIELD=$$FIELD^DGENU(SUB)
"RTN","DGENA3",84,0)
 .;if there is no external value then it is not valid
"RTN","DGENA3",85,0)
 .S DISPLAY=$$EXTERNAL^DILFD(27.11,FIELD,"F",VAL)
"RTN","DGENA3",86,0)
 .I (DISPLAY="") S VALID=0 Q
"RTN","DGENA3",87,0)
 .I $$GET1^DID(27.11,FIELD,"","TYPE")'="POINTER" D
"RTN","DGENA3",88,0)
 ..D CHK^DIE(27.11,FIELD,,VAL,.RESULT) I RESULT="^" S VALID=0 Q
"RTN","DGENA3",89,0)
 Q VALID
"RTN","DGENA6")
0^8^B19162873
"RTN","DGENA6",1,0)
DGENA6 ;ALB/CJM,ISA,KWP,RTK,LBD - Enrollment API to create enrollment record;6/21/99 ; 11/1/01 3:26pm
"RTN","DGENA6",2,0)
 ;;5.3;Registration;**232,327,417,491**;Aug 13, 1993
"RTN","DGENA6",3,0)
 ;
"RTN","DGENA6",4,0)
 ;CREATE line tag moved from DGENA in DG*5.3*232.;MM  
"RTN","DGENA6",5,0)
 ;
"RTN","DGENA6",6,0)
CREATE(DFN,APP,EFFDATE,REASON,REMARKS,DGENR,ENRDATE,END) ;
"RTN","DGENA6",7,0)
 ;Description: Creates a local enrollment as a local array.
"RTN","DGENA6",8,0)
 ;Input :
"RTN","DGENA6",9,0)
 ;  DFN- Patient IEN
"RTN","DGENA6",10,0)
 ;  APP - the Enrollment Application Date to use
"RTN","DGENA6",11,0)
 ;  EFFDATE - the Effective Date, if  NULL assume the same as the
"RTN","DGENA6",12,0)
 ;     Enrollment Date
"RTN","DGENA6",13,0)
 ;  REASON - used to create an enrollment with CANCELLED/DECLINED status,
"RTN","DGENA6",14,0)
 ;     pass in the code for REASON CANCELED/DECLINED
"RTN","DGENA6",15,0)
 ;  REMARKS - if creating an enrollment with CANCELLED/DECLINED status,
"RTN","DGENA6",16,0)
 ;     and the reason is can optionally pass in textual remarks for
"RTN","DGENA6",17,0)
 ;     CANCELED/DECLINED REMARKS 
"RTN","DGENA6",18,0)
 ;  ENRDATE - the Enrollment Date to use (optional)
"RTN","DGENA6",19,0)
 ;  END - the Enrollment End Date to use (optional)
"RTN","DGENA6",20,0)
 ;Output:
"RTN","DGENA6",21,0)
 ;  Function Value - returns 1 if successful, 0 otherwise
"RTN","DGENA6",22,0)
 ;  DGENR - a local array where the enrollment object will be stored,
"RTN","DGENA6",23,0)
 ;     pass by reference
"RTN","DGENA6",24,0)
 ;
"RTN","DGENA6",25,0)
 K DGENR
"RTN","DGENA6",26,0)
 S DGENR=""
"RTN","DGENA6",27,0)
 N DGELGSUB,PRIORITY,DEATH,PRIGRP
"RTN","DGENA6",28,0)
 ;Re-Enrollment - var PRIGRP contains priority and subgroup
"RTN","DGENA6",29,0)
 S PRIGRP=$$PRIORITY^DGENELA4(DFN,,.DGELGSUB,$G(ENRDATE),$G(APP))
"RTN","DGENA6",30,0)
 S PRIORITY=$P(PRIGRP,"^")  ; Re-Enrollment - Priority is first piece
"RTN","DGENA6",31,0)
 S DGENR("APP")=$G(APP)
"RTN","DGENA6",32,0)
 S DGENR("DATE")=$G(ENRDATE)
"RTN","DGENA6",33,0)
 S DGENR("END")=$G(END)
"RTN","DGENA6",34,0)
 S DGENR("DFN")=DFN
"RTN","DGENA6",35,0)
 S DGENR("SOURCE")=1
"RTN","DGENA6",36,0)
 D  ;drops out of block when status is determined
"RTN","DGENA6",37,0)
 .I $G(REASON) D  Q
"RTN","DGENA6",38,0)
 ..S DGENR("STATUS")=7,DGENR("REMARKS")=$G(REMARKS),DGENR("REASON")=REASON ;CANCELED/DECLINED
"RTN","DGENA6",39,0)
 .E  S DGENR("REMARKS")="",DGENR("REASON")=""
"RTN","DGENA6",40,0)
 .S DEATH=$$DEATH^DGENPTA(DFN)
"RTN","DGENA6",41,0)
 .I DEATH D  Q
"RTN","DGENA6",42,0)
 ..S DGENR("STATUS")=6 ;DECEASED
"RTN","DGENA6",43,0)
 ..S DGENR("END")=DEATH
"RTN","DGENA6",44,0)
 ..S EFFDATE=DEATH
"RTN","DGENA6",45,0)
 ..;Find patient's current enrollment record
"RTN","DGENA6",46,0)
 ..N DGENRIEN,DGENRC
"RTN","DGENA6",47,0)
 ..S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENA6",48,0)
 ..S DGENRC=$$GET^DGENA(DGENRIEN,.DGENRC)
"RTN","DGENA6",49,0)
 ..S DGENR("DATE")=$S($G(DGENRC("DATE"))'="":DGENRC("DATE"),1:"")  ;enrollment date
"RTN","DGENA6",50,0)
 .I '$$VET^DGENPTA(DFN) D  Q  ;NOT ELIGIBLE
"RTN","DGENA6",51,0)
 ..N DGPAT,DGENRIEN,DGENRC
"RTN","DGENA6",52,0)
 ..S DGENR("STATUS")=20 ;new status for Ineligible Project
"RTN","DGENA6",53,0)
 ..;Find patient's current enrollment record
"RTN","DGENA6",54,0)
 ..S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENA6",55,0)
 ..S DGENRC=$$GET^DGENA(DGENRIEN,.DGENRC)
"RTN","DGENA6",56,0)
 ..S DGENR("DATE")=$S($G(DGENRC("DATE"))'="":DGENRC("DATE"),1:"")  ;enrollment date
"RTN","DGENA6",57,0)
 ..;Phase II The TESTVAL was moved from DGENA1 to DGENA3 (SRS 6.5.2.1)
"RTN","DGENA6",58,0)
 ..;if vet has an Ineligible Date then the Effective Date should be the later of the Ineligible Date or App Date
"RTN","DGENA6",59,0)
 ..I $$GET^DGENPTA(DFN,.DGENPTA),DGENPTA("INELDATE"),$$TESTVAL^DGENA3("EFFDATE",DGENPTA("INELDATE")),DGENRC=1 S EFFDATE=$G(DGENPTA("INELDATE"))
"RTN","DGENA6",60,0)
 ..I '$G(EFFDATE) S EFFDATE=$G(APP)
"RTN","DGENA6",61,0)
 ..;If currently enrolled, set end date = ineligible date
"RTN","DGENA6",62,0)
 ..I DGENRC=1 S DGENR("END")=$G(DGENPTA("INELDATE"))
"RTN","DGENA6",63,0)
 ..;If not currently enrolled or no ineligible date, set end date = application date
"RTN","DGENA6",64,0)
 ..I '$G(DGENR("END")) S DGENR("END")=$G(APP)
"RTN","DGENA6",65,0)
 .;Determine preliminary enrollment status based on enrollment group threshold
"RTN","DGENA6",66,0)
 .;Get enrollment group threshold
"RTN","DGENA6",67,0)
 .N DGEGTIEN,DGEGT,DGENRC,DGENRIEN
"RTN","DGENA6",68,0)
 .S DGEGTIEN=$$FINDCUR^DGENEGT
"RTN","DGENA6",69,0)
 .S DGEGT=$$GET^DGENEGT(DGEGTIEN,.DGEGT)
"RTN","DGENA6",70,0)
 .;If patient's enrollment status not above enrollment group threshold 
"RTN","DGENA6",71,0)
 .;set status to Rejected:  Initial Application by VAMC)
"RTN","DGENA6",72,0)
 .I $G(PRIORITY)'="",'$$ABOVE2^DGENEGT1($G(APP),PRIORITY,$P(PRIGRP,U,2)) D  Q
"RTN","DGENA6",73,0)
 ..;Find patient's current enrollment record
"RTN","DGENA6",74,0)
 ..S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENA6",75,0)
 ..S DGENRC=$$GET^DGENA(DGENRIEN,.DGENRC)
"RTN","DGENA6",76,0)
 ..S DGENR("DATE")=$S($G(DGENRC("DATE"))'="":DGENRC("DATE"),1:"")  ;enrollment date
"RTN","DGENA6",77,0)
 ..S DGENR("END")=$G(APP)  ;enrollment end date = application date
"RTN","DGENA6",78,0)
 ..S EFFDATE=$G(APP)  ; effective date = application date
"RTN","DGENA6",79,0)
 ..S DGENR("STATUS")=14  ;Rejected: Initial Application by VAMC
"RTN","DGENA6",80,0)
 .S DGENR("STATUS")=1 Q  ;UNVERIFIED
"RTN","DGENA6",81,0)
 S DGENR("FACREC")=$$INST^DGENU()
"RTN","DGENA6",82,0)
 S DGENR("PRIORITY")=PRIORITY
"RTN","DGENA6",83,0)
 ;Phase II add subgroup (SRS 6.4)
"RTN","DGENA6",84,0)
 S DGENR("SUBGRP")=$P(PRIGRP,"^",2)
"RTN","DGENA6",85,0)
 S DGENR("EFFDATE")=$S($G(EFFDATE):EFFDATE,$G(ENRDATE):$G(ENRDATE),1:$G(APP))
"RTN","DGENA6",86,0)
 S DGENR("USER")=$G(DUZ)
"RTN","DGENA6",87,0)
 S DGENR("DATETIME")=$$NOW^XLFDT
"RTN","DGENA6",88,0)
 S DGENR("PRIORREC")=""
"RTN","DGENA6",89,0)
 M DGENR("ELIG")=DGELGSUB
"RTN","DGENA6",90,0)
 ;
"RTN","DGENA6",91,0)
 Q 1
"RTN","DGENEGT1")
0^2^B24558798
"RTN","DGENEGT1",1,0)
DGENEGT1 ;ALB/KCL,ISA/KWP,LBD - Enrollment Group Threshold API's ; 11/21/01 1:30pm
"RTN","DGENEGT1",2,0)
 ;;5.3;Registration;**232,417,454,491**;Aug 13, 1993
"RTN","DGENEGT1",3,0)
 ;
"RTN","DGENEGT1",4,0)
 ;
"RTN","DGENEGT1",5,0)
NOTIFY(DGEGT,OLDEGT) ;
"RTN","DGENEGT1",6,0)
 ; Description: This is used to send a message to local mail group.
"RTN","DGENEGT1",7,0)
 ; The notification is used to communicate changes in the Enrollment
"RTN","DGENEGT1",8,0)
 ; Group Threshold (EGT) setting to users at the local site.
"RTN","DGENEGT1",9,0)
 ;
"RTN","DGENEGT1",10,0)
 ;  Input:
"RTN","DGENEGT1",11,0)
 ;    DGEGT - the new Enrollment Group Threshold array, passed by reference
"RTN","DGENEGT1",12,0)
 ;   OLDEGT - the previous Enrollment Group Threshold array, passed by reference
"RTN","DGENEGT1",13,0)
 ;
"RTN","DGENEGT1",14,0)
 ; Output: None
"RTN","DGENEGT1",15,0)
 ;
"RTN","DGENEGT1",16,0)
 N TEXT,XMDUN,XMDUZ,XMTEXT,XMROU,XMSTRIP,XMSUB,XMY,XMZ,OLDPRI
"RTN","DGENEGT1",17,0)
 ;
"RTN","DGENEGT1",18,0)
 ; init subject and sender
"RTN","DGENEGT1",19,0)
 S XMSUB="Enrollment Group Threshold (EGT) Changed"
"RTN","DGENEGT1",20,0)
 S (XMDUN,XMDUZ)="Registration Enrollment Module"
"RTN","DGENEGT1",21,0)
 ;
"RTN","DGENEGT1",22,0)
 ; recipient
"RTN","DGENEGT1",23,0)
 S XMY("G.DGEN EGT UPDATES")=""
"RTN","DGENEGT1",24,0)
 ;
"RTN","DGENEGT1",25,0)
 ; get old EGT priority
"RTN","DGENEGT1",26,0)
 S OLDPRI=$G(OLDEGT("PRIORITY"))
"RTN","DGENEGT1",27,0)
 ;
"RTN","DGENEGT1",28,0)
 S XMTEXT="TEXT("
"RTN","DGENEGT1",29,0)
 S TEXT(1)="The Secretary of the VA has officially changed the enrollment priority"
"RTN","DGENEGT1",30,0)
 S TEXT(2)="grouping of veterans who shall receive care.  This change may place"
"RTN","DGENEGT1",31,0)
 S TEXT(3)="veterans under your facilities care into a 'Not Enrolled' category."
"RTN","DGENEGT1",32,0)
 S TEXT(4)=""
"RTN","DGENEGT1",33,0)
 S TEXT(5)=""
"RTN","DGENEGT1",34,0)
 S TEXT(6)="           Prior EGT Priority:  "_$S($G(OLDPRI):$$EXTERNAL^DILFD(27.16,.02,"F",OLDPRI),1:"N/A")_$S($G(OLDEGT("SUBGRP")):$$EXTERNAL^DILFD(27.16,.03,"F",OLDEGT("SUBGRP")),1:"")
"RTN","DGENEGT1",35,0)
 S TEXT(7)=""
"RTN","DGENEGT1",36,0)
 S TEXT(8)=""
"RTN","DGENEGT1",37,0)
 S TEXT(9)="  New Enrollment Group Threshold (EGT) Settings:"
"RTN","DGENEGT1",38,0)
 S TEXT(10)=""
"RTN","DGENEGT1",39,0)
 S TEXT(11)="                 EGT Priority:  "_$$EXTERNAL^DILFD(27.16,.02,"F",DGEGT("PRIORITY"))_$S($G(DGEGT("SUBGRP")):$$EXTERNAL^DILFD(27.16,.03,"F",DGEGT("SUBGRP")),1:"")
"RTN","DGENEGT1",40,0)
 S TEXT(12)="                     EGT Type:  "_$$EXTERNAL^DILFD(27.16,.04,"F",DGEGT("TYPE"))
"RTN","DGENEGT1",41,0)
 S TEXT(13)="           EGT Effective Date:  "_$$EXTERNAL^DILFD(27.16,.01,"F",DGEGT("EFFDATE"))
"RTN","DGENEGT1",42,0)
 ;
"RTN","DGENEGT1",43,0)
 ; mailman deliverey
"RTN","DGENEGT1",44,0)
 D ^XMD
"RTN","DGENEGT1",45,0)
 ;
"RTN","DGENEGT1",46,0)
 Q
"RTN","DGENEGT1",47,0)
 ;
"RTN","DGENEGT1",48,0)
 ;
"RTN","DGENEGT1",49,0)
DISPLAY() ;
"RTN","DGENEGT1",50,0)
 ; Description: Display Enrollment Group Threshold (EGT) settings.
"RTN","DGENEGT1",51,0)
 ;
"RTN","DGENEGT1",52,0)
 ;  Input: None
"RTN","DGENEGT1",53,0)
 ;
"RTN","DGENEGT1",54,0)
 ; Output: None
"RTN","DGENEGT1",55,0)
 ;
"RTN","DGENEGT1",56,0)
 N DGEGT
"RTN","DGENEGT1",57,0)
 ;
"RTN","DGENEGT1",58,0)
 W !
"RTN","DGENEGT1",59,0)
 I '$$GET^DGENEGT($$FINDCUR^DGENEGT(),.DGEGT) W !,"Enrollment Group Threshold (EGT) settings not found."
"RTN","DGENEGT1",60,0)
 E  D
"RTN","DGENEGT1",61,0)
 .W !,?3,"Enrollment Group Threshold (EGT) Settings"
"RTN","DGENEGT1",62,0)
 .W !,?3,"========================================="
"RTN","DGENEGT1",63,0)
 .W !
"RTN","DGENEGT1",64,0)
 .W !?5,"Date Entered",?25,": ",$S('$G(DGEGT("ENTERED")):"-none-",1:$$EXTERNAL^DILFD(27.16,.01,"F",DGEGT("ENTERED")))
"RTN","DGENEGT1",65,0)
 .W !?5,"EGT Priority",?25,": ",$S('$G(DGEGT("PRIORITY")):"-none-",1:$$EXTERNAL^DILFD(27.16,.02,"F",DGEGT("PRIORITY")))_$S($G(DGEGT("SUBGRP"))="":"",1:$$EXTERNAL^DILFD(27.16,.03,"F",DGEGT("SUBGRP")))
"RTN","DGENEGT1",66,0)
 .W !?5,"EGT Type",?25,": ",$S($G(DGEGT("TYPE"))="":"-none-",1:$$EXTERNAL^DILFD(27.16,.04,"F",DGEGT("TYPE")))
"RTN","DGENEGT1",67,0)
 .W !?5,"EGT Effective Date",?25,": ",$S('$G(DGEGT("EFFDATE")):"-none-",1:$$EXTERNAL^DILFD(27.16,.05,"F",DGEGT("EFFDATE")))
"RTN","DGENEGT1",68,0)
 ;
"RTN","DGENEGT1",69,0)
 Q
"RTN","DGENEGT1",70,0)
 ;
"RTN","DGENEGT1",71,0)
ABOVE(ENRPRI,ENRGRP,EGTPRI,EGTGRP,EGTFLG) ;
"RTN","DGENEGT1",72,0)
 ;Description: This function will determine if the enrollment is above the threshold.
"RTN","DGENEGT1",73,0)
 ;
"RTN","DGENEGT1",74,0)
 ; IMPORTANT NOTE:
"RTN","DGENEGT1",75,0)
 ; ===============
"RTN","DGENEGT1",76,0)
 ; Due to the timeline of MEGA Regulations Phase I, changes could
"RTN","DGENEGT1",77,0)
 ; not be made to ^DPTLK to support modifications to the parameters
"RTN","DGENEGT1",78,0)
 ; being passed into this function.
"RTN","DGENEGT1",79,0)
 ;
"RTN","DGENEGT1",80,0)
 ; DO NOT REMOVE THE EGTPRI AND EGTGRP PARAMETERS UNTIL ENR^DPTLK HAS
"RTN","DGENEGT1",81,0)
 ; BEEN MODIFIED !!!
"RTN","DGENEGT1",82,0)
 ;
"RTN","DGENEGT1",83,0)
 ; As a work-around, the EGT settings will be obtained here in order
"RTN","DGENEGT1",84,0)
 ; to support modifications to the EGT type 2 (STOP NEW ENROLLMENTS)
"RTN","DGENEGT1",85,0)
 ; logic.  At a future date, the EGT parameters should be removed as
"RTN","DGENEGT1",86,0)
 ; they are no longer necessary. [ALB/BRM October 11, 2001]
"RTN","DGENEGT1",87,0)
 ;
"RTN","DGENEGT1",88,0)
 ;Input:
"RTN","DGENEGT1",89,0)
 ; ENRPRI - Enrollment Priority
"RTN","DGENEGT1",90,0)
 ; ENRGRP - Enrollment Sub-Group
"RTN","DGENEGT1",91,0)
 ; EGTPRI - EGT Priority (optional) - not used
"RTN","DGENEGT1",92,0)
 ; EGTGRP - EGT Sub-Group (optional) - not used
"RTN","DGENEGT1",93,0)
 ; EGTFLG - Flag to bypass additional EGT type 2 check (optional)
"RTN","DGENEGT1",94,0)
 ;          It is used by $$ABOVE2 to prevent re-entering the
"RTN","DGENEGT1",95,0)
 ;          sub-priority API ($$SUBPRI^DGENELA4)
"RTN","DGENEGT1",96,0)
 ; Output:
"RTN","DGENEGT1",97,0)
 ; Returns 1 if above 0 below. 
"RTN","DGENEGT1",98,0)
 ;
"RTN","DGENEGT1",99,0)
 I $G(ENRGRP)="" S ENRGRP=""
"RTN","DGENEGT1",100,0)
 I $G(ENRPRI)="" S ENRPRI=""
"RTN","DGENEGT1",101,0)
 N ABOVE,EGT,TODAY,X
"RTN","DGENEGT1",102,0)
 I '$$GET^DGENEGT($$FINDCUR^DGENEGT(),.EGT) Q 1
"RTN","DGENEGT1",103,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENEGT1",104,0)
 I TODAY<EGT("EFFDATE") Q 1
"RTN","DGENEGT1",105,0)
 ;
"RTN","DGENEGT1",106,0)
 ;EGT type 2 - Stop New Enrollments
"RTN","DGENEGT1",107,0)
 ; or EGT type 4 - Enrollment Decision (ESP DG*5.3*491)
"RTN","DGENEGT1",108,0)
 I EGT("TYPE")=2!(EGT("TYPE")=4) D  Q ABOVE
"RTN","DGENEGT1",109,0)
 .S:'$G(DFN) DFN=+$G(DPTDFN)
"RTN","DGENEGT1",110,0)
 .S ABOVE=0
"RTN","DGENEGT1",111,0)
 .;do check for priorities 7 and 8
"RTN","DGENEGT1",112,0)
 .I ENRPRI>6&(ENRPRI=EGT("PRIORITY")) D  Q
"RTN","DGENEGT1",113,0)
 ..I ENRGRP'>EGT("SUBGRP") S ABOVE=1
"RTN","DGENEGT1",114,0)
 ..Q:$G(EGTFLG)
"RTN","DGENEGT1",115,0)
 ..I EGT("TYPE")=4,ENRPRI=EGT("PRIORITY"),ENRGRP'=$$SUBPRI^DGENELA4(DFN,ENRPRI,ENRGRP) S ABOVE=0 Q
"RTN","DGENEGT1",116,0)
 ..I ENRGRP=EGT("SUBGRP"),ENRGRP'=$$SUBPRI^DGENELA4(DFN,ENRPRI,ENRGRP) S ABOVE=0
"RTN","DGENEGT1",117,0)
 .I ENRPRI'>EGT("PRIORITY") S ABOVE=1 Q
"RTN","DGENEGT1",118,0)
 ;
"RTN","DGENEGT1",119,0)
 ;EGT types 1 & 3
"RTN","DGENEGT1",120,0)
 ;do check for priorities 7 and 8
"RTN","DGENEGT1",121,0)
 I ENRPRI>6&(ENRPRI=EGT("PRIORITY")) S ABOVE=0 D  Q ABOVE
"RTN","DGENEGT1",122,0)
 .I ENRGRP'>(EGT("SUBGRP")) S ABOVE=1
"RTN","DGENEGT1",123,0)
 I ENRPRI'>(EGT("PRIORITY")) Q 1
"RTN","DGENEGT1",124,0)
 Q 0
"RTN","DGENEGT1",125,0)
 ;
"RTN","DGENEGT1",126,0)
ABOVE2(ENRDT,PRIORITY,SUBGRP) ;
"RTN","DGENEGT1",127,0)
 ;
"RTN","DGENEGT1",128,0)
 ; Input: ENRDT     - enrollment effective date
"RTN","DGENEGT1",129,0)
 ;        PRIORITY  - enrollment priority
"RTN","DGENEGT1",130,0)
 ;        SUBGRP    - enrollment sub-priority (internal numeric value)
"RTN","DGENEGT1",131,0)
 ;
"RTN","DGENEGT1",132,0)
 ; Output: 1 or 0 for above or below EGT threshold
"RTN","DGENEGT1",133,0)
 ;
"RTN","DGENEGT1",134,0)
 N ABOVE,TODAY,X,EGT
"RTN","DGENEGT1",135,0)
 S ABOVE=1
"RTN","DGENEGT1",136,0)
 S:'$G(SUBGRP) SUBGRP=""
"RTN","DGENEGT1",137,0)
 S:'$G(PRIORITY) PRIORITY=""
"RTN","DGENEGT1",138,0)
 S:'$G(ENRDT) ENRDT=""
"RTN","DGENEGT1",139,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENEGT1",140,0)
 Q:'$$GET^DGENEGT($$FINDCUR^DGENEGT(),.EGT) 1
"RTN","DGENEGT1",141,0)
 Q:'$G(EGT("EFFDATE")) 1
"RTN","DGENEGT1",142,0)
 Q:TODAY<EGT("EFFDATE") 1
"RTN","DGENEGT1",143,0)
 Q:EGT("TYPE")#2 $$ABOVE(PRIORITY,SUBGRP,"","",1)  ;If EGT type 1 or 3
"RTN","DGENEGT1",144,0)
 I '$$ABOVE(PRIORITY,SUBGRP,"","",1) Q 0
"RTN","DGENEGT1",145,0)
 I PRIORITY=EGT("PRIORITY"),ENRDT,ENRDT'<EGT("EFFDATE") D
"RTN","DGENEGT1",146,0)
 .I EGT("TYPE")=4 S ABOVE=0 Q
"RTN","DGENEGT1",147,0)
 .I SUBGRP=EGT("SUBGRP") S ABOVE=0
"RTN","DGENEGT1",148,0)
 Q ABOVE
"RTN","DGENELA4")
0^3^B39191109
"RTN","DGENELA4",1,0)
DGENELA4 ;ALB/CJM,KCL,RTK,LBD - Patient Eligibility API ; 2/1/02 10:09am
"RTN","DGENELA4",2,0)
 ;;5.3;Registration;**232,275,306,327,314,367,417,437,456,491**;Aug 13,1993
"RTN","DGENELA4",3,0)
 ;
"RTN","DGENELA4",4,0)
 ;
"RTN","DGENELA4",5,0)
PRIORITY(DFN,DGELG,DGELGSUB,ENRDATE,APPDATE) ;
"RTN","DGENELA4",6,0)
 ; Description: Used to compute the priority group and subgroup for a
"RTN","DGENELA4",7,0)
 ; patient, also returning the subset of the eligibility data on which 
"RTN","DGENELA4",8,0)
 ; the priority subgroup is based.
"RTN","DGENELA4",9,0)
 ;
"RTN","DGENELA4",10,0)
 ;Input:
"RTN","DGENELA4",11,0)
 ;      DFN - ien of patient
"RTN","DGENELA4",12,0)
 ;    DGELG - ELIGIBILITY object array (optional, pass by reference)
"RTN","DGENELA4",13,0)
 ;  ENRDATE - The Enrollment Date. This date is used in the priority
"RTN","DGENELA4",14,0)
 ;            determination only if the application date is not passed.
"RTN","DGENELA4",15,0)
 ;  APPDATE - The Enrollment Application Date.  This date is used
"RTN","DGENELA4",16,0)
 ;            to determine the priority. If the application date
"RTN","DGENELA4",17,0)
 ;            is not passed then the enrollment date (ENRDATE) is used.
"RTN","DGENELA4",18,0)
 ;
"RTN","DGENELA4",19,0)
 ;Output:
"RTN","DGENELA4",20,0)
 ;  Function Value - returns the priority and subgroup computed by the
"RTN","DGENELA4",21,0)
 ;    function as a 2 piece string 'PRIORITY^SUBGROUP'
"RTN","DGENELA4",22,0)
 ;  DGELGSUB - this local array will contain the eligibility data on
"RTN","DGENELA4",23,0)
 ;    which the priority determination was based, pass by reference
"RTN","DGENELA4",24,0)
 ;    if needed.
"RTN","DGENELA4",25,0)
 ;
"RTN","DGENELA4",26,0)
 N CODE,HICODE,PRI,HIPRI,PRIORITY,SUBGRP,HISUB,SUB,DGPAT
"RTN","DGENELA4",27,0)
 K DGELGSUB S DGELGSUB=""
"RTN","DGENELA4",28,0)
 S (HICODE,HIPRI,SUBGRP,HISUB)=""
"RTN","DGENELA4",29,0)
 D
"RTN","DGENELA4",30,0)
 .I '$D(DGELG),'$$GET^DGENELA(DFN,.DGELG) Q  ;can not procede with eligiblity
"RTN","DGENELA4",31,0)
 .; can't proceed without an Enrollment Date or Application Date
"RTN","DGENELA4",32,0)
 .I '$G(ENRDATE),'$G(APPDATE) Q
"RTN","DGENELA4",33,0)
 .I $$GET^DGENPTA(DFN,.DGPAT)
"RTN","DGENELA4",34,0)
 .; determine priority/subgroup based on primary eligibility
"RTN","DGENELA4",35,0)
 .S HICODE=$$NATCODE^DGENELA(DGELG("ELIG","CODE"))
"RTN","DGENELA4",36,0)
 .S PRIORITY=$$PRI(HICODE,.DGELG,$G(ENRDATE),$G(APPDATE))
"RTN","DGENELA4",37,0)
 .S HIPRI=$P(PRIORITY,"^"),HISUB=$P(PRIORITY,"^",2)
"RTN","DGENELA4",38,0)
 .S CODE=""
"RTN","DGENELA4",39,0)
 .;
"RTN","DGENELA4",40,0)
 .; determine if other eligibilities result in higher priority/subgroup
"RTN","DGENELA4",41,0)
 .F  S CODE=$O(DGELG("ELIG","CODE",CODE)) Q:('CODE!(HIPRI=1))  D
"RTN","DGENELA4",42,0)
 ..S PRIORITY=$$PRI($$NATCODE^DGENELA(CODE),.DGELG,$G(ENRDATE),$G(APPDATE))
"RTN","DGENELA4",43,0)
 ..S PRI=$P(PRIORITY,"^"),SUB=$P(PRIORITY,"^",2)
"RTN","DGENELA4",44,0)
 ..S:((PRI>0)&((PRI<HIPRI)!(HIPRI=""))) HIPRI=PRI,HICODE=$$NATCODE^DGENELA(CODE),HISUB=SUB
"RTN","DGENELA4",45,0)
 ..S:((PRI=HIPRI)&((SUB>0)&(SUB<HISUB))) HIPRI=PRI,HICODE=$$NATCODE^DGENELA(CODE),HISUB=SUB
"RTN","DGENELA4",46,0)
 .;
"RTN","DGENELA4",47,0)
 .;set the DGELGSUB() array with the eligibility information used in the
"RTN","DGENELA4",48,0)
 .;priority determination
"RTN","DGENELA4",49,0)
 .S DGELGSUB("CODE")=HICODE,DGELGSUB("SC")=DGELG("SC"),DGELGSUB("SCPER")=DGELG("SCPER"),DGELGSUB("POW")=DGELG("POW"),DGELGSUB("A&A")=DGELG("A&A"),DGELGSUB("HB")=DGELG("HB")
"RTN","DGENELA4",50,0)
 .S DGELGSUB("VAPEN")=DGELG("VAPEN"),DGELGSUB("VACKAMT")=DGELG("VACKAMT"),DGELGSUB("DISRET")=DGELG("DISRET")
"RTN","DGENELA4",51,0)
 .S DGELGSUB("MEDICAID")=DGELG("MEDICAID"),DGELGSUB("AO")=DGELG("AO"),DGELGSUB("IR")=DGELG("IR"),DGELGSUB("EC")=DGELG("EC"),DGELGSUB("MTSTA")=DGELG("MTSTA")
"RTN","DGENELA4",52,0)
 .;Purple Heart Added to DGELGSUB
"RTN","DGENELA4",53,0)
 .S DGELGSUB("VCD")=DGELG("VCD"),DGELGSUB("PH")=DGELG("PH")
"RTN","DGENELA4",54,0)
 .;
"RTN","DGENELA4",55,0)
 .I $G(DGPAT("INELDATE"))'="" S (HIPRI,HISUB)=""
"RTN","DGENELA4",56,0)
 ;
"RTN","DGENELA4",57,0)
 Q HIPRI_$S(HIPRI:"^"_HISUB,1:"")
"RTN","DGENELA4",58,0)
 ;
"RTN","DGENELA4",59,0)
 ;
"RTN","DGENELA4",60,0)
PRI(CODE,DGELG,ENRDATE,APPDATE) ;
"RTN","DGENELA4",61,0)
 ; Description: Returns the priority group and subgroup based on a
"RTN","DGENELA4",62,0)
 ; single eligibilty code.
"RTN","DGENELA4",63,0)
 ;Input -
"RTN","DGENELA4",64,0)
 ;  CODE - pointer to file #8.1, MAS Eligbility Code
"RTN","DGENELA4",65,0)
 ;  DGELG - local array otained by calling $$GET, pass by reference
"RTN","DGENELA4",66,0)
 ;  ENRDATE - The Enrollment Date. This date is used in the priority
"RTN","DGENELA4",67,0)
 ;            determination only if the application date is not passed.
"RTN","DGENELA4",68,0)
 ;  APPDATE - The Enrollment Application Date.  This date is used
"RTN","DGENELA4",69,0)
 ;            to determine the priority. If the application date
"RTN","DGENELA4",70,0)
 ;            is not passed then the enrollment date (ENRDATE) is used.
"RTN","DGENELA4",71,0)
 ;
"RTN","DGENELA4",72,0)
 ;Output -
"RTN","DGENELA4",73,0)
 ;  Function Value - returns the priority and subgroup computed by the
"RTN","DGENELA4",74,0)
 ;   function as a 2 piece string 'PRIORITY^SUBGROUP'
"RTN","DGENELA4",75,0)
 ;
"RTN","DGENELA4",76,0)
 N CODENAME,PRIORITY,MTSTA,SUBGRP,DGEGT,PRISUB,DGMTI,MTTHR,GMTTHR
"RTN","DGENELA4",77,0)
 S SUBGRP=""
"RTN","DGENELA4",78,0)
 ;
"RTN","DGENELA4",79,0)
 ; use the Application Date when determining the priority, otherwise use
"RTN","DGENELA4",80,0)
 ; the Enrollment Date (ESP DG*5,3*491)
"RTN","DGENELA4",81,0)
 S ENRDATE=$S($G(APPDATE):APPDATE,1:$G(ENRDATE))
"RTN","DGENELA4",82,0)
 ;
"RTN","DGENELA4",83,0)
 ;get the name of the national eligibility code
"RTN","DGENELA4",84,0)
 S CODENAME=$$CODENAME^DGENELA(CODE)
"RTN","DGENELA4",85,0)
 ;
"RTN","DGENELA4",86,0)
 ;get the means test code
"RTN","DGENELA4",87,0)
 S MTSTA=""
"RTN","DGENELA4",88,0)
 I DGELG("MTSTA") S MTSTA=$P($G(^DG(408.32,DGELG("MTSTA"),0)),"^",2)
"RTN","DGENELA4",89,0)
 ;
"RTN","DGENELA4",90,0)
 ;get MT and GMT thresholds
"RTN","DGENELA4",91,0)
 S DGMTI=$P($$LST^DGMTU(DFN),"^")
"RTN","DGENELA4",92,0)
 S MTTHR=$P($G(^DGMT(408.31,+DGMTI,0)),"^",12)
"RTN","DGENELA4",93,0)
 S GMTTHR=$P($G(^DGMT(408.31,+DGMTI,0)),"^",27)
"RTN","DGENELA4",94,0)
 ;
"RTN","DGENELA4",95,0)
 ;get the Enrollment Group Threshold (EGT) setting
"RTN","DGENELA4",96,0)
 S DGEGT=""
"RTN","DGENELA4",97,0)
 I $$GET^DGENEGT($$FINDCUR^DGENEGT(),.DGEGT)
"RTN","DGENELA4",98,0)
 ;
"RTN","DGENELA4",99,0)
 D  ;drops out when priority determined
"RTN","DGENELA4",100,0)
 .S PRIORITY=""
"RTN","DGENELA4",101,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>49))!(CODENAME="SERVICE CONNECTED 50% to 100%") S PRIORITY=1 Q
"RTN","DGENELA4",102,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>29)&(CODENAME="SC LESS THAN 50%")) S PRIORITY=2 Q
"RTN","DGENELA4",103,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>9)&(CODENAME="SC LESS THAN 50%"))!(DGELG("POW")="Y")!(CODENAME="PRISONER OF WAR")!(DGELG("DISRET")=2)!(DGELG("DISRET")=1)!(CODENAME="PURPLE HEART RECIPIENT")!(DGELG("PH")="Y") S PRIORITY=3 Q
"RTN","DGENELA4",104,0)
 .I (DGELG("A&A")="Y")!(CODENAME="AID & ATTENDANCE")!(DGELG("HB")="Y")!(CODENAME="HOUSEBOUND")!(DGELG("VCD")="Y") S PRIORITY=4 Q
"RTN","DGENELA4",105,0)
 .I (MTSTA="A")!(DGELG("MEDICAID")=1)!(DGELG("VAPEN")="Y")!(CODENAME="NSC, VA PENSION") S PRIORITY=5 Q
"RTN","DGENELA4",106,0)
 .I (CODENAME="WORLD WAR I")!(CODENAME="MEXICAN BORDER WAR")!(DGELG("AO")="Y")!(DGELG("IR")="Y")!(DGELG("EC")="Y")!(DGELG("VACKAMT")>0) S PRIORITY=6 Q
"RTN","DGENELA4",107,0)
 .I (MTSTA="G")!((MTSTA="P")&(GMTTHR>MTTHR)) S PRIORITY=7 D  Q
"RTN","DGENELA4",108,0)
 ..I ((DGELG("SC")="Y")&(DGELG("SCPER")=0)&(DGELG("VACKAMT")<1)&(CODENAME="SC LESS THAN 50%")) S SUBGRP=$$SUBPRI(DFN,.PRIORITY,1) Q
"RTN","DGENELA4",109,0)
 ..S SUBGRP=$$SUBPRI(DFN,.PRIORITY,3)
"RTN","DGENELA4",110,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")=0)&(DGELG("VACKAMT")<1)&(CODENAME="SC LESS THAN 50%")) S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,1) Q
"RTN","DGENELA4",111,0)
 .I ((MTSTA="C")!(MTSTA="P")) S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,PRIORITY,3) Q
"RTN","DGENELA4",112,0)
 ;
"RTN","DGENELA4",113,0)
 Q PRIORITY_$S(PRIORITY:"^"_SUBGRP,1:"")
"RTN","DGENELA4",114,0)
 ;
"RTN","DGENELA4",115,0)
SUBPRI(DFN,PRIORITY,SUBGRP) ;calculate sub-priority if under EGT
"RTN","DGENELA4",116,0)
 ;
"RTN","DGENELA4",117,0)
 N PRVPRI,DONE,PRVENST,ENRDT,DGENRIEN,EGT,DGENRC,TODAY,X
"RTN","DGENELA4",118,0)
 Q:'$G(DFN)
"RTN","DGENELA4",119,0)
 S U="^"
"RTN","DGENELA4",120,0)
 S:$G(PRIORITY)="" PRIORITY=""
"RTN","DGENELA4",121,0)
 S:$G(SUBGRP)="" SUBGRP=""
"RTN","DGENELA4",122,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENELA4",123,0)
 Q:'$$GET^DGENEGT($$FINDCUR^DGENEGT(),.EGT) SUBGRP  ;EGT isn't set
"RTN","DGENELA4",124,0)
 Q:TODAY<EGT("EFFDATE") SUBGRP  ;EGT is not in effect
"RTN","DGENELA4",125,0)
 I "^1^3^"[(U_EGT("TYPE")_U) Q SUBGRP
"RTN","DGENELA4",126,0)
 I EGT("TYPE")=2,(PRIORITY+(SUBGRP*.01))<(EGT("PRIORITY")+(EGT("SUBGRP")*.01)) Q SUBGRP
"RTN","DGENELA4",127,0)
 I EGT("TYPE")=4 Q:(PRIORITY<EGT("PRIORITY")) SUBGRP  Q:(PRIORITY>EGT("PRIORITY")) $$SUBCNV(SUBGRP)
"RTN","DGENELA4",128,0)
 ;I $G(ENRDATE) Q:$$ABOVE2^DGENEGT1(ENRDATE,PRIORITY,SUBGRP) SUBGRP
"RTN","DGENELA4",129,0)
 S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENELA4",130,0)
 I 'DGENRIEN,$G(ENRDATE),ENRDATE<EGT("EFFDATE") Q SUBGRP
"RTN","DGENELA4",131,0)
 S DONE=0
"RTN","DGENELA4",132,0)
 F  Q:DONE  D
"RTN","DGENELA4",133,0)
 .I 'DGENRIEN S DONE=2 Q
"RTN","DGENELA4",134,0)
 .I '$$GET^DGENA(DGENRIEN,.DGENRC) S DONE=2 Q
"RTN","DGENELA4",135,0)
 .S DGENRIEN=$$FINDPRI^DGENA(DGENRIEN)
"RTN","DGENELA4",136,0)
 .Q:DGENRC("STATUS")=6   ;deceased
"RTN","DGENELA4",137,0)
 .I $P($G(^DGEN(27.15,+DGENRC("STATUS"),0)),"^",2)="N" S DONE=2 Q
"RTN","DGENELA4",138,0)
 .S ENRDT=$G(DGENRC("APP")) S:'ENRDT ENRDT=$G(DGENRC("EFFDATE"))
"RTN","DGENELA4",139,0)
 .I ENRDT,ENRDT<EGT("EFFDATE") S DONE=1 Q
"RTN","DGENELA4",140,0)
 .; HEC is the authoritative source on continuous enrollment
"RTN","DGENELA4",141,0)
 .I DGENRC("SOURCE")=2,ENRDT'<EGT("EFFDATE") S DONE=1
"RTN","DGENELA4",142,0)
 ;
"RTN","DGENELA4",143,0)
 Q $S(DONE=2:$$SUBCNV(SUBGRP),1:SUBGRP)
"RTN","DGENELA4",144,0)
 ;
"RTN","DGENELA4",145,0)
SUBCNV(SUBGRP) ;return new subgrp
"RTN","DGENELA4",146,0)
 I SUBGRP=1 Q 5
"RTN","DGENELA4",147,0)
 I SUBGRP=3 Q 7
"RTN","DGENELA4",148,0)
 Q SUBGRP
"RTN","DGENRPT1")
0^4^B19994939
"RTN","DGENRPT1",1,0)
DGENRPT1 ;ALB/DW,LBD - EGT Preliminary Summary Impact Report ; 11/1/01 2:32pm ; 07/22/02 9:40am
"RTN","DGENRPT1",2,0)
 ;;5.3;Registration;**232,306,417,456,491**;Aug 13,1993
"RTN","DGENRPT1",3,0)
 ;
"RTN","DGENRPT1",4,0)
 ;
"RTN","DGENRPT1",5,0)
ENPT ;Preliminary Summary Report selected.
"RTN","DGENRPT1",6,0)
 K ^TMP($J,"SS1"),^TMP($J,"RT1")
"RTN","DGENRPT1",7,0)
 I $$FINDCUR^DGENEGT()=0 W !,"No EGT setting on file." Q
"RTN","DGENRPT1",8,0)
 D PRINT
"RTN","DGENRPT1",9,0)
 Q
"RTN","DGENRPT1",10,0)
 ;
"RTN","DGENRPT1",11,0)
GETEGTS ;First get the current EGT parameters from file #27.16.
"RTN","DGENRPT1",12,0)
 N GETEGTS,REC,TP S (GETEGTS,REC,TP)=""
"RTN","DGENRPT1",13,0)
 S REC=$$FINDCUR^DGENEGT() I REC=0 Q
"RTN","DGENRPT1",14,0)
 S TP=$$GET^DGENEGT(REC,.GETEGTS)
"RTN","DGENRPT1",15,0)
 ;Get EGT Prioity.
"RTN","DGENRPT1",16,0)
 S EGT=GETEGTS("PRIORITY")
"RTN","DGENRPT1",17,0)
 S EGTSUB=GETEGTS("SUBGRP")
"RTN","DGENRPT1",18,0)
 ;Get EGT Effective Date.
"RTN","DGENRPT1",19,0)
 S EGTEDT=GETEGTS("EFFDATE") I EGTEDT S EGTEDT=$$FMTE^XLFDT(EGTEDT)
"RTN","DGENRPT1",20,0)
 ;Get last EGT setting Date/Time.
"RTN","DGENRPT1",21,0)
 S EGTLDT=GETEGTS("ENTDATE") I EGTLDT S EGTLDT=$$FMTE^XLFDT(EGTLDT)
"RTN","DGENRPT1",22,0)
 ;Get EGT Type.
"RTN","DGENRPT1",23,0)
 S EGTTP=GETEGTS("TYPE")
"RTN","DGENRPT1",24,0)
 S EGTTP=$$EXTERNAL^DILFD(27.16,.04,"F",EGTTP) S:EGTTP="" EGTTP="UNSPECIFIED"
"RTN","DGENRPT1",25,0)
 Q
"RTN","DGENRPT1",26,0)
 ;
"RTN","DGENRPT1",27,0)
PRESRT1 ;Sort for patient's current record and get the potentially affected.
"RTN","DGENRPT1",28,0)
 N IND,PRT,DFN,INPT,PSSN,TMP,ABV,PRTSUB
"RTN","DGENRPT1",29,0)
 S (IND,PRT,DFN,PSSN,TMP,ABV,PRTSUB)="",INPT="OUT"
"RTN","DGENRPT1",30,0)
 K ^TMP($J,"SS1"),^TMP($J,"RT1")
"RTN","DGENRPT1",31,0)
 F  S DFN=$O(^DGEN(27.11,"C",DFN)) Q:DFN=""  D
"RTN","DGENRPT1",32,0)
 . S IND=$$FINDCUR^DGENA(DFN)
"RTN","DGENRPT1",33,0)
 . I IND D EGTP I ABV=0 D
"RTN","DGENRPT1",34,0)
 .. K VAIP(2) S INPT="OUT" D IN5^VADPT S TMP=$P($G(VAIP(2)),U) I TMP=1!(TMP=2)!(TMP=6) S INPT="IN"
"RTN","DGENRPT1",35,0)
 .. K VADM(2) D DEM^VADPT S PSSN=$P($G(VADM(2)),U)
"RTN","DGENRPT1",36,0)
 .. S ^TMP($J,"RT1",PRT,PSSN)=PRT_"^"_INPT
"RTN","DGENRPT1",37,0)
 ;
"RTN","DGENRPT1",38,0)
PRESRT2 ;Sort the sorted.
"RTN","DGENRPT1",39,0)
 N CNT,ICNT,OCNT,J,K
"RTN","DGENRPT1",40,0)
 S (J,K)=""
"RTN","DGENRPT1",41,0)
 F  S J=$O(^TMP($J,"RT1",J)) Q:J=""  D
"RTN","DGENRPT1",42,0)
 . S (CNT,ICNT,OCNT)=0
"RTN","DGENRPT1",43,0)
 . F  S K=$O(^TMP($J,"RT1",J,K)) Q:K=""  D
"RTN","DGENRPT1",44,0)
   .. S INPT=$P($G(^TMP($J,"RT1",J,K)),U,2)
"RTN","DGENRPT1",45,0)
   .. S CNT=CNT+1 S:INPT="IN" ICNT=ICNT+1 S:INPT="OUT" OCNT=OCNT+1
"RTN","DGENRPT1",46,0)
   .. S ^TMP($J,"SS1",J)=CNT_"^"_ICNT_"^"_OCNT
"RTN","DGENRPT1",47,0)
 K ^TMP($J,"RT1")
"RTN","DGENRPT1",48,0)
 Q
"RTN","DGENRPT1",49,0)
 ;
"RTN","DGENRPT1",50,0)
EGTP ;Decide if the patient is above EGT.
"RTN","DGENRPT1",51,0)
 S (PRT,PRTSUB,ABV,ENRDT)=""
"RTN","DGENRPT1",52,0)
 S PRT=$P($G(^DGEN(27.11,IND,0)),U,7)
"RTN","DGENRPT1",53,0)
 S:((PRT=7)!(PRT=8)) PRTSUB=$P($G(^DGEN(27.11,IND,0)),U,12)
"RTN","DGENRPT1",54,0)
 S ENRDT=$P($G(^DGEN(27.11,IND,0)),U,10)
"RTN","DGENRPT1",55,0)
 S:'ENRDT ENRDT=$P($G(^DGEN(27.11,IND,0)),U)
"RTN","DGENRPT1",56,0)
 S ABV=$$ABOVE^DGENEGT1(PRT,PRTSUB)
"RTN","DGENRPT1",57,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT1",58,0)
 . S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT1",59,0)
 . S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT1",60,0)
 S PRT=PRT_PRTSUB
"RTN","DGENRPT1",61,0)
 Q
"RTN","DGENRPT1",62,0)
 ;
"RTN","DGENRPT1",63,0)
PRINT ;Print the report.
"RTN","DGENRPT1",64,0)
 N POP,IO,IOBS,IOF,IOHG,IOM,ION,IOPAR,IOS,IOSL,IOST,IOT,IOUPAR,IOXY,ZTSAVE,TSK,%ZIS,ZTRTN,ZTDESC
"RTN","DGENRPT1",65,0)
 S %ZIS="QM" D ^%ZIS G EXIT:POP
"RTN","DGENRPT1",66,0)
 I $D(IO("Q")) D  G EXIT
"RTN","DGENRPT1",67,0)
 . S ZTRTN="WRITER^DGENRPT1",ZTDESC="DG EGT Preliminary Summary Report."
"RTN","DGENRPT1",68,0)
 . D ^%ZTLOAD
"RTN","DGENRPT1",69,0)
 . S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DGENRPT1",70,0)
 . I TSK="Y" W !!,"Report queued! Task number: ",ZTSK
"RTN","DGENRPT1",71,0)
 . D HOME^%ZIS
"RTN","DGENRPT1",72,0)
 ;
"RTN","DGENRPT1",73,0)
WRITER ;Write out the report.
"RTN","DGENRPT1",74,0)
 U IO
"RTN","DGENRPT1",75,0)
 I $E(IOST,1,2)="C-" W @IOF
"RTN","DGENRPT1",76,0)
 N EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,ENRDT
"RTN","DGENRPT1",77,0)
 S (EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP)=""
"RTN","DGENRPT1",78,0)
 D GETEGTS
"RTN","DGENRPT1",79,0)
 D PRESRT1
"RTN","DGENRPT1",80,0)
 D PSHEAD
"RTN","DGENRPT1",81,0)
 D DATA
"RTN","DGENRPT1",82,0)
 D ^%ZISC
"RTN","DGENRPT1",83,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DGENRPT1",84,0)
 D KVA^VADPT
"RTN","DGENRPT1",85,0)
 K ^TMP($J,"SS1")
"RTN","DGENRPT1",86,0)
 Q
"RTN","DGENRPT1",87,0)
 ;
"RTN","DGENRPT1",88,0)
PSHEAD ;Header for the Preliminary Detailed Report.
"RTN","DGENRPT1",89,0)
 ;Get the date/time the report is run.
"RTN","DGENRPT1",90,0)
 N RDT,Y S (RDT,Y)=""
"RTN","DGENRPT1",91,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGENRPT1",92,0)
 S RDT=$P(Y,"@",1)_" @ "_$P($P(Y,"@",2),":",1,2)
"RTN","DGENRPT1",93,0)
 S EGTSUB=$$EXTERNAL^DILFD(27.16,.03,"F",EGTSUB)
"RTN","DGENRPT1",94,0)
 I ((EGT=7)!(EGT=8)),EGTSUB="" S EGTSUB="ER"
"RTN","DGENRPT1",95,0)
 ;Write the header.
"RTN","DGENRPT1",96,0)
 W !,?((IOM-38)\2),"EGT Preliminary Summary Impact Report"
"RTN","DGENRPT1",97,0)
 W !,?((IOM-22-$L(RDT))\2),"Date/Time Report Run: ",RDT
"RTN","DGENRPT1",98,0)
 W !,?((IOM-45-$L(EGT_EGTSUB_EGTTP_EGTEDT))\2),"EGT Setting: ",EGT_EGTSUB," EGT Type: ",EGTTP," EGT Effective Date: ",EGTEDT
"RTN","DGENRPT1",99,0)
 W !,?((IOM-28-$L(EGTLDT))\2),"Date/Time Last EGT Setting: ",EGTLDT
"RTN","DGENRPT1",100,0)
 W !!,"IMPORTANT NOTE:",!,"Preliminary report is based on a comparison of the EGT setting to the veterans current enrollment priority as shown in VISTA."
"RTN","DGENRPT1",101,0)
 W !!,"ENROLLMENT PRIORITY",?23,"TOTAL (UNIQUE SSN)",?43,"# INPATIENT",?57,"# OUTPATIENT",!
"RTN","DGENRPT1",102,0)
 Q
"RTN","DGENRPT1",103,0)
 ;
"RTN","DGENRPT1",104,0)
DATA ;Get all the data for the report.
"RTN","DGENRPT1",105,0)
 N T,EP,TLT,INPT,OPT,COUNT S (T,EP,TLT,INPT,OPT)="",COUNT=0
"RTN","DGENRPT1",106,0)
 F  S T=$O(^TMP($J,"SS1",T)) Q:T=""  D
"RTN","DGENRPT1",107,0)
 . S EP=T,TLT=$P($G(^TMP($J,"SS1",T)),U),INPT=$P($G(^TMP($J,"SS1",T)),U,2),OPT=$P($G(^TMP($J,"SS1",T)),U,3)
"RTN","DGENRPT1",108,0)
 . S COUNT=COUNT+TLT
"RTN","DGENRPT1",109,0)
 . W !,EP,?25,TLT,?45,INPT,?59,OPT
"RTN","DGENRPT1",110,0)
 W !,"TOTAL PATIENTS (UNIQUE SSNS) FOR THIS FACILITY:     ",COUNT
"RTN","DGENRPT1",111,0)
 Q
"RTN","DGENRPT2")
0^5^B40316446
"RTN","DGENRPT2",1,0)
DGENRPT2 ;ALB/DW,LBD - EGT Preliminary Detailed Impact Report ; 11/2/01 10:21am ; 07/22/02 9:40am
"RTN","DGENRPT2",2,0)
 ;;5.3;Registration;**232,306,417,456,491**;Aug 13,1993
"RTN","DGENRPT2",3,0)
 ;
"RTN","DGENRPT2",4,0)
 ;
"RTN","DGENRPT2",5,0)
ENPT ;Preliminary Detailed Report selected.
"RTN","DGENRPT2",6,0)
 K ^TMP($J,"BY2"),^TMP($J,"CNT2")
"RTN","DGENRPT2",7,0)
 I $$FINDCUR^DGENEGT()=0 W !,"No EGT setting on file." Q
"RTN","DGENRPT2",8,0)
 N INFAP S INFAP=""
"RTN","DGENRPT2",9,0)
 D INFAP I INFAP="^"!($D(DTOUT)) Q
"RTN","DGENRPT2",10,0)
 N EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,L,BY,DIC,FLDS,DHD,DIOEND,X,DFN,PSSN,FCTY,TOTAL,DIOBEG,VASD,VAERR,ENRDT
"RTN","DGENRPT2",11,0)
 S (EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,FCTY)="",TOTAL=0
"RTN","DGENRPT2",12,0)
 W !!,"*** This report requires a 132 column printer. ***",!!
"RTN","DGENRPT2",13,0)
 S DIC="^DGEN(27.11,"
"RTN","DGENRPT2",14,0)
 S BY(0)="^TMP($J,""BY2""",L(0)=3,L=0
"RTN","DGENRPT2",15,0)
 S DIOBEG="D PRESORT^DGENRPT2"
"RTN","DGENRPT2",16,0)
 S FLDS="D PT^DGENRPT2 W X;C0;L20,W PSSN;C22;L10,D EP^DGENRPT2 W X;C33;L2,D ENRED^DGENRPT2 W X;C37;L10,D ENRST^DGENRPT2 W X;C49;L12"
"RTN","DGENRPT2",17,0)
 I INFAP=1 D
"RTN","DGENRPT2",18,0)
 . S FLDS(2)="D WRD^DGENRPT2 W X;C63;L15;""WARD"",D FAP1^DGENRPT2 W X;C80;L31,D PCPVD^DGENRPT2 W X;C110;L10,D PFCLTY^DGENRPT2 W X;C121;L11"
"RTN","DGENRPT2",19,0)
 . S DHD="W ?0 D DETHD1^DGENRPT2"
"RTN","DGENRPT2",20,0)
 I INFAP=0 D
"RTN","DGENRPT2",21,0)
 . S FLDS(2)="D WRD^DGENRPT2 W X;C63;L15;""WARD"",D FAP0^DGENRPT2 W X;C80;L31,D PCPVD^DGENRPT2 W X;C88;L10,D PFCLTY^DGENRPT2 W X;C100;L12"
"RTN","DGENRPT2",22,0)
 . S DHD="W ?0 D DETHD0^DGENRPT2"
"RTN","DGENRPT2",23,0)
 S DIOEND="D END^DGENRPT2"
"RTN","DGENRPT2",24,0)
 D EN1^DIP
"RTN","DGENRPT2",25,0)
 D EXIT
"RTN","DGENRPT2",26,0)
 Q
"RTN","DGENRPT2",27,0)
 ;
"RTN","DGENRPT2",28,0)
INFAP ;Ask the user if Future Appointments is wanted on the report.
"RTN","DGENRPT2",29,0)
 N DIR,X,Y
"RTN","DGENRPT2",30,0)
 S DIR(0)="Y^1:3"
"RTN","DGENRPT2",31,0)
 S DIR("A")="Do you want to include Future Appointments"
"RTN","DGENRPT2",32,0)
 D ^DIR S INFAP=Y
"RTN","DGENRPT2",33,0)
 I ($D(DTOUT)) W *7
"RTN","DGENRPT2",34,0)
 Q
"RTN","DGENRPT2",35,0)
 ;
"RTN","DGENRPT2",36,0)
PRESORT ;First get the current EGT Setting from file #27.16.
"RTN","DGENRPT2",37,0)
 N GETEGTS,REC,TP S (GETEGTS,REC,TP)=""
"RTN","DGENRPT2",38,0)
 S REC=$$FINDCUR^DGENEGT()
"RTN","DGENRPT2",39,0)
 I REC=0 Q
"RTN","DGENRPT2",40,0)
 S TP=$$GET^DGENEGT(REC,.GETEGTS)
"RTN","DGENRPT2",41,0)
 ;Get EGT Priority.
"RTN","DGENRPT2",42,0)
 S EGT=GETEGTS("PRIORITY")
"RTN","DGENRPT2",43,0)
 S EGTSUB=GETEGTS("SUBGRP")
"RTN","DGENRPT2",44,0)
 ;Get EGT Effective Date.
"RTN","DGENRPT2",45,0)
 S EGTEDT=GETEGTS("EFFDATE") I EGTEDT S EGTEDT=$$FMTE^XLFDT(EGTEDT)
"RTN","DGENRPT2",46,0)
 ;Get last EGT setting Date/Time.
"RTN","DGENRPT2",47,0)
 S EGTLDT=GETEGTS("ENTDATE") I EGTLDT S EGTLDT=$$FMTE^XLFDT(EGTLDT)
"RTN","DGENRPT2",48,0)
 ;Get EGT Type.
"RTN","DGENRPT2",49,0)
 S EGTTP=GETEGTS("TYPE")
"RTN","DGENRPT2",50,0)
 S EGTTP=$$EXTERNAL^DILFD(27.16,.04,"F",EGTTP) S:EGTTP="" EGTTP="UNSPECIFIED"
"RTN","DGENRPT2",51,0)
 ;Sort for patient's current record and get the potentially affected.
"RTN","DGENRPT2",52,0)
 N IND,PRT,DFN,NM,PSSN,PRTSUB,ABV
"RTN","DGENRPT2",53,0)
 S (IND,PRT,DFN,NM,PSSN,PRTSUB,ABV)=""
"RTN","DGENRPT2",54,0)
 K ^TMP($J,"BY2"),^TMP($J,"CNT2")
"RTN","DGENRPT2",55,0)
 F  S DFN=$O(^DGEN(27.11,"C",DFN)) Q:DFN=""  D
"RTN","DGENRPT2",56,0)
 . S IND=$$FINDCUR^DGENA(DFN)
"RTN","DGENRPT2",57,0)
 . I IND D EGTP I ABV=0 D
"RTN","DGENRPT2",58,0)
 .. K VADM(1),VADM(2) D DEM^VADPT S NM=VADM(1) D BYSRT
"RTN","DGENRPT2",59,0)
 .. S PSSN=$P($G(VADM(2)),U),^TMP($J,"CNT2",PRT,PSSN)=""
"RTN","DGENRPT2",60,0)
 I EGTSUB>4 S EGTSUB="ER" Q
"RTN","DGENRPT2",61,0)
 S EGTSUB=$$EXTERNAL^DILFD(27.16,.03,"F",EGTSUB)
"RTN","DGENRPT2",62,0)
 Q
"RTN","DGENRPT2",63,0)
 ;
"RTN","DGENRPT2",64,0)
EGTP ;Get patients EGT Priority.
"RTN","DGENRPT2",65,0)
 S (PRT,PRTSUB,ABV,ENRDT)=""
"RTN","DGENRPT2",66,0)
 S PRT=$P($G(^DGEN(27.11,IND,0)),U,7)
"RTN","DGENRPT2",67,0)
 S:((PRT=7)!(PRT=8)) PRTSUB=$P($G(^DGEN(27.11,IND,0)),U,12)
"RTN","DGENRPT2",68,0)
 S ENRDT=$P($G(^DGEN(27.11,IND,0)),U,10)
"RTN","DGENRPT2",69,0)
 S:'ENRDT ENRDT=$P($G(^DGEN(27.11,IND,0)),U)
"RTN","DGENRPT2",70,0)
 S ABV=$$ABOVE^DGENEGT1(PRT,PRTSUB)
"RTN","DGENRPT2",71,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT2",72,0)
 . S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT2",73,0)
 . S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT2",74,0)
 S PRT=PRT_PRTSUB
"RTN","DGENRPT2",75,0)
 Q
"RTN","DGENRPT2",76,0)
 ;
"RTN","DGENRPT2",77,0)
BYSRT ;Sort patients by last name for "BY(0)".
"RTN","DGENRPT2",78,0)
 S ^TMP($J,"BY2",NM,DFN,IND)=""
"RTN","DGENRPT2",79,0)
 Q
"RTN","DGENRPT2",80,0)
 ;
"RTN","DGENRPT2",81,0)
PT ;Get the patient NAME and SSN
"RTN","DGENRPT2",82,0)
 S (X,DFN,PSSN)="" K VADM(1),VADM(2)
"RTN","DGENRPT2",83,0)
 S DFN=$P($G(^DGEN(27.11,D0,0)),U,2)
"RTN","DGENRPT2",84,0)
 I DFN D DEM^VADPT S X=$E(VADM(1),1,20),PSSN=$P(VADM(2),U)
"RTN","DGENRPT2",85,0)
 Q
"RTN","DGENRPT2",86,0)
 ;
"RTN","DGENRPT2",87,0)
EP ;Get the patient EGT Priority.
"RTN","DGENRPT2",88,0)
 S X=""
"RTN","DGENRPT2",89,0)
 N PRT,PRTSUB S (PRT,PRTSUB)=""
"RTN","DGENRPT2",90,0)
 S PRT=$P($G(^DGEN(27.11,D0,0)),U,7)
"RTN","DGENRPT2",91,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT2",92,0)
 .S PRTSUB=$P($G(^DGEN(27.11,D0,0)),U,12)
"RTN","DGENRPT2",93,0)
 .S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT2",94,0)
 .S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT2",95,0)
 .S PRT=PRT_PRTSUB
"RTN","DGENRPT2",96,0)
 S X=PRT
"RTN","DGENRPT2",97,0)
 Q
"RTN","DGENRPT2",98,0)
 ;
"RTN","DGENRPT2",99,0)
ENRED ;Get the patient ENROLLMENT END DATE.
"RTN","DGENRPT2",100,0)
 S X=""
"RTN","DGENRPT2",101,0)
 S X=$P($G(^DGEN(27.11,D0,0)),U,11)
"RTN","DGENRPT2",102,0)
 I X="" S X="N/A" Q
"RTN","DGENRPT2",103,0)
 S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","DGENRPT2",104,0)
 Q
"RTN","DGENRPT2",105,0)
 ;
"RTN","DGENRPT2",106,0)
ENRST ;Get the patient ENROLLMENT STATUS.
"RTN","DGENRPT2",107,0)
 S X=""
"RTN","DGENRPT2",108,0)
 S X=$P($G(^DGEN(27.11,D0,0)),U,4)
"RTN","DGENRPT2",109,0)
 S X=$P($G(^DGEN(27.15,X,0)),U,1),X=$E(X,1,12)
"RTN","DGENRPT2",110,0)
 Q
"RTN","DGENRPT2",111,0)
 ;
"RTN","DGENRPT2",112,0)
WRD ;Get the patient WARD.
"RTN","DGENRPT2",113,0)
 S X="" K VAIP(5)
"RTN","DGENRPT2",114,0)
 D IN5^VADPT S X=$P($G(VAIP(5)),U,2),X=$E(X,1,15)
"RTN","DGENRPT2",115,0)
 I X="" S X="N/A"
"RTN","DGENRPT2",116,0)
 Q
"RTN","DGENRPT2",117,0)
 ;
"RTN","DGENRPT2",118,0)
FAP1 ;Get the patient FUTURE APPOINTMENTS.
"RTN","DGENRPT2",119,0)
 N J,POP,ADT S (X,ADT)="",POP=0,J=0
"RTN","DGENRPT2",120,0)
 K ^UTILITY("VASD",$J)
"RTN","DGENRPT2",121,0)
 D CALSDA
"RTN","DGENRPT2",122,0)
 I VAERR=1 S X="N/A" Q
"RTN","DGENRPT2",123,0)
 F  S J=$O(^UTILITY("VASD",$J,J)) Q:J=""!POP  D
"RTN","DGENRPT2",124,0)
 . S X=$P($G(^UTILITY("VASD",$J,J,"E")),U,2),X=$E(X,1,20)
"RTN","DGENRPT2",125,0)
 . S ADT=$P($G(^UTILITY("VASD",$J,J,"I")),U),ADT=$P(ADT,".",1)
"RTN","DGENRPT2",126,0)
 . S ADT=$E(ADT,4,5)_"/"_$E(ADT,6,7)_"/"_(1700+$E(ADT,1,3))
"RTN","DGENRPT2",127,0)
 . S X=ADT_" "_X
"RTN","DGENRPT2",128,0)
 . I J=1 W X S X=""
"RTN","DGENRPT2",129,0)
 . I J>1&(J<6) W !,?79,X S X=""
"RTN","DGENRPT2",130,0)
 . I J=6 S X="" W !,?79,"More Appts" S POP=1 Q
"RTN","DGENRPT2",131,0)
 I $D(^UTILITY("VASD",$J))=0 S X="NONE"
"RTN","DGENRPT2",132,0)
 Q
"RTN","DGENRPT2",133,0)
 ;
"RTN","DGENRPT2",134,0)
FAP0 ;See if the patient has future appointment.
"RTN","DGENRPT2",135,0)
 S X="NO"
"RTN","DGENRPT2",136,0)
 K ^UTILITY("VASD",$J)
"RTN","DGENRPT2",137,0)
 D CALSDA
"RTN","DGENRPT2",138,0)
 I VAERR=1 S X="N/A" Q
"RTN","DGENRPT2",139,0)
 I $G(^UTILITY("VASD",$J,1,"I"))'="" S X="YES"
"RTN","DGENRPT2",140,0)
 Q
"RTN","DGENRPT2",141,0)
 ;
"RTN","DGENRPT2",142,0)
CALSDA ;Use API to get appointments.
"RTN","DGENRPT2",143,0)
 N X
"RTN","DGENRPT2",144,0)
 S VASD("F")=DT,VASD("W")=12 D SDA^VADPT
"RTN","DGENRPT2",145,0)
 Q
"RTN","DGENRPT2",146,0)
 ;
"RTN","DGENRPT2",147,0)
PCPVD ;Get the patient PC PROVIDER.
"RTN","DGENRPT2",148,0)
 ;;Site must use PCMM module.
"RTN","DGENRPT2",149,0)
 S X=""
"RTN","DGENRPT2",150,0)
 S X=$$OUTPTPR^SDUTL3(DFN)
"RTN","DGENRPT2",151,0)
 I X="" S X="N/A" Q
"RTN","DGENRPT2",152,0)
 S X=$P(X,U,2),X=$E(X,1,10)
"RTN","DGENRPT2",153,0)
 Q
"RTN","DGENRPT2",154,0)
 ;
"RTN","DGENRPT2",155,0)
PFCLTY ;Get the patient PREFFERED FACILITY.
"RTN","DGENRPT2",156,0)
 S (X,FCTY)=""
"RTN","DGENRPT2",157,0)
 S X=$$PREF^DGENPTA(DFN,.FCTY),X=$E(FCTY,1,10)
"RTN","DGENRPT2",158,0)
 I X="" S X="N/A"
"RTN","DGENRPT2",159,0)
 Q
"RTN","DGENRPT2",160,0)
 ;
"RTN","DGENRPT2",161,0)
DETHD ;General header for the Preliminary Detailed Report.
"RTN","DGENRPT2",162,0)
 ;Get the date/time the report is run.
"RTN","DGENRPT2",163,0)
 N RDT,Y S (RDT,Y)=""
"RTN","DGENRPT2",164,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGENRPT2",165,0)
 S RDT=$P(Y,"@",1)_" @ "_$P($P(Y,"@",2),":",1,2)
"RTN","DGENRPT2",166,0)
 ;Write the header.
"RTN","DGENRPT2",167,0)
 W !,?((IOM-38)\2),"EGT Preliminary Detailed Impact Report"
"RTN","DGENRPT2",168,0)
 W !,?((IOM-22-$L(RDT))\2),"Date/Time Report Run: ",RDT
"RTN","DGENRPT2",169,0)
 W !,?((IOM-45-$L(EGT_EGTSUB_EGTTP_EGTEDT))\2),"EGT Setting: ",EGT_EGTSUB," EGT Type: ",EGTTP," EGT Effective Date: ",EGTEDT
"RTN","DGENRPT2",170,0)
 W !,?((IOM-28-$L(EGTLDT))\2),"Date/Time Last EGT Setting: ",EGTLDT
"RTN","DGENRPT2",171,0)
 W !!,"IMPORTANT NOTE:",!,"Preliminary report is based on a comparison of the EGT setting to the veterans current enrollment priority as shown in VISTA."
"RTN","DGENRPT2",172,0)
 Q
"RTN","DGENRPT2",173,0)
 ;
"RTN","DGENRPT2",174,0)
DETHD1 ;Header for the Preliminary Detailed Report, with Future Appointments.
"RTN","DGENRPT2",175,0)
 D DETHD
"RTN","DGENRPT2",176,0)
 W !!,"NAME",?21,"SSN",?32,"EP",?36,"ENROLLMENT",?48,"ENROLLMENT",?62,"WARD",?79,"FUTURE",?109,"PC",?120,"PREF"
"RTN","DGENRPT2",177,0)
 W !,?36,"END DATE",?48,"STATUS",?79,"APPOINTMENTS",?109,"PROVIDER",?120,"FACILITY",!!
"RTN","DGENRPT2",178,0)
 Q
"RTN","DGENRPT2",179,0)
 ;
"RTN","DGENRPT2",180,0)
DETHD0 ;Header for the Preliminary Detailed Report, no Future Appointments.
"RTN","DGENRPT2",181,0)
 D DETHD
"RTN","DGENRPT2",182,0)
 W !!,"NAME",?21,"SSN",?32,"EP",?36,"ENROLLMENT",?48,"ENROLLMENT",?62,"WARD",?79,"FUTURE",?87,"PC",?99,"PREF"
"RTN","DGENRPT2",183,0)
 W !,?36,"END DATE",?48,"STATUS",?79,"APPTS",?87,"PROVIDER",?99,"FACILITY",!!
"RTN","DGENRPT2",184,0)
 Q
"RTN","DGENRPT2",185,0)
 ;
"RTN","DGENRPT2",186,0)
END ;At the end of the display.
"RTN","DGENRPT2",187,0)
 N PSSN,J S (PSSN,J)=""
"RTN","DGENRPT2",188,0)
 F  S J=$O(^TMP($J,"CNT2",J)) Q:J=""  D
"RTN","DGENRPT2",189,0)
 . F  S PSSN=$O(^TMP($J,"CNT2",J,PSSN)) Q:PSSN=""  D
"RTN","DGENRPT2",190,0)
   ..S TOTAL=TOTAL+1
"RTN","DGENRPT2",191,0)
 W !,"TOTAL PATIENTS (UNIQUE SSNS) FOR THIS FACILITY:     ",TOTAL
"RTN","DGENRPT2",192,0)
 Q
"RTN","DGENRPT2",193,0)
 ;
"RTN","DGENRPT2",194,0)
EXIT ;Clean up upon exit of the routine.
"RTN","DGENRPT2",195,0)
 D KVA^VADPT
"RTN","DGENRPT2",196,0)
 K ^TMP($J,"BY2"),^TMP($J,"CNT2")
"RTN","DGENRPT2",197,0)
 Q
"RTN","DGENRPT3")
0^6^B29772622
"RTN","DGENRPT3",1,0)
DGENRPT3 ;ALB/DW,LBD - EGT Actual Summary Impact Report ; 11/1/01 2:40pm ; 07/22/02 9:40am
"RTN","DGENRPT3",2,0)
 ;;5.3;Registration;**232,306,417,456,491**;Aug 13,1993
"RTN","DGENRPT3",3,0)
 ;
"RTN","DGENRPT3",4,0)
 ;
"RTN","DGENRPT3",5,0)
ENPT ;Actual Summary Report selected.
"RTN","DGENRPT3",6,0)
 K ^TMP($J,"SS3"),^TMP($J,"RT3")
"RTN","DGENRPT3",7,0)
 N BDT,EDT S (BDT,EDT)=""
"RTN","DGENRPT3",8,0)
 D RPDT I BDT="^"!(EDT="^")!($D(DTOUT)) Q
"RTN","DGENRPT3",9,0)
 D PRINT
"RTN","DGENRPT3",10,0)
 Q
"RTN","DGENRPT3",11,0)
 ;
"RTN","DGENRPT3",12,0)
RPDT ;Ask the user the Report Begin Date and Report End Date.
"RTN","DGENRPT3",13,0)
 N DIR,X,Y
"RTN","DGENRPT3",14,0)
 S DIR(0)="DA^::E"
"RTN","DGENRPT3",15,0)
 S DIR("A")="Report Begin Date: "
"RTN","DGENRPT3",16,0)
 S DIR("?")="Please enter the Enrollment End Date as the beginning date that will be reported on."
"RTN","DGENRPT3",17,0)
 D ^DIR S BDT=Y
"RTN","DGENRPT3",18,0)
 I BDT="^" Q
"RTN","DGENRPT3",19,0)
 I ($D(DTOUT)) W *7 Q
"RTN","DGENRPT3",20,0)
 ;
"RTN","DGENRPT3",21,0)
RPDT2 S DIR(0)="DA^::E"
"RTN","DGENRPT3",22,0)
 S DIR("A")="Report End Date: "
"RTN","DGENRPT3",23,0)
 S DIR("?")="Please enter the Enrollment End Date as the end date that will be reported on. Report End Date cannot be earlier than Report Begin Date."
"RTN","DGENRPT3",24,0)
 D ^DIR S EDT=Y
"RTN","DGENRPT3",25,0)
 I EDT="^" Q
"RTN","DGENRPT3",26,0)
 I ($D(DTOUT)) W *7 Q
"RTN","DGENRPT3",27,0)
 I EDT<BDT G RPDT2
"RTN","DGENRPT3",28,0)
 Q
"RTN","DGENRPT3",29,0)
 ;
"RTN","DGENRPT3",30,0)
GETEGTS ;First get the current EGT parameters from file #27.16.
"RTN","DGENRPT3",31,0)
 N GETEGTS,REC,TP S (GETEGTS,REC,TP)=""
"RTN","DGENRPT3",32,0)
 S REC=$$FINDCUR^DGENEGT() I REC=0 Q
"RTN","DGENRPT3",33,0)
 S TP=$$GET^DGENEGT(REC,.GETEGTS)
"RTN","DGENRPT3",34,0)
 ;Get EGT Priority.
"RTN","DGENRPT3",35,0)
 S EGT=GETEGTS("PRIORITY"),RLEGT=EGT
"RTN","DGENRPT3",36,0)
 I EGT="" W !,"No EGT setting on file.",! S EGT=0
"RTN","DGENRPT3",37,0)
 S EGTSUB=GETEGTS("SUBGRP")
"RTN","DGENRPT3",38,0)
 ;Get EGT Effective Date.
"RTN","DGENRPT3",39,0)
 S EGTEDT=GETEGTS("EFFDATE") I EGTEDT S EGTEDT=$$FMTE^XLFDT(EGTEDT)
"RTN","DGENRPT3",40,0)
 ;Get last EGT setting Date/Time.
"RTN","DGENRPT3",41,0)
 S EGTLDT=GETEGTS("ENTDATE") I EGTLDT S EGTLDT=$$FMTE^XLFDT(EGTLDT)
"RTN","DGENRPT3",42,0)
 ;Get EGT Type.
"RTN","DGENRPT3",43,0)
 S EGTTP=GETEGTS("TYPE")
"RTN","DGENRPT3",44,0)
 S EGTTP=$$EXTERNAL^DILFD(27.16,.04,"F",EGTTP) S:EGTTP="" EGTTP="UNSPECIFIED"
"RTN","DGENRPT3",45,0)
 Q
"RTN","DGENRPT3",46,0)
 ;
"RTN","DGENRPT3",47,0)
PRESRT1 ;Sort for patient's current record and get the potentially affected.
"RTN","DGENRPT3",48,0)
 N IND,PRT,DFN,INPT,PSSN,PEDT,PCTRY,TMP,PRTSUB,ABV
"RTN","DGENRPT3",49,0)
 S (IND,PRT,DFN,PSSN,PEDT,PCTRY,TMP,PRTSUB,ABV)="",INPT="OUT"
"RTN","DGENRPT3",50,0)
 K ^TMP($J,"SS3"),^TMP($J,"RT3")
"RTN","DGENRPT3",51,0)
 F  S DFN=$O(^DGEN(27.11,"C",DFN)) Q:DFN=""  D
"RTN","DGENRPT3",52,0)
 . S IND=$$FINDCUR^DGENA(DFN) I IND D
"RTN","DGENRPT3",53,0)
 .. D EGTP
"RTN","DGENRPT3",54,0)
 .. S PEDT=$P($G(^DGEN(27.11,IND,0)),U,11)
"RTN","DGENRPT3",55,0)
 .. S PCTRY=$$CATEGORY^DGENA4(DFN)
"RTN","DGENRPT3",56,0)
 .. I ABV=0&(PCTRY="N")&(PEDT'<BDT)&(PEDT'>EDT) D
"RTN","DGENRPT3",57,0)
 ... K VAIP(2) S INPT="OUT" D IN5^VADPT S TMP=$P($G(VAIP(2)),U) I TMP=1!(TMP=2)!(TMP=6) S INPT="IN"
"RTN","DGENRPT3",58,0)
 ... K VADM(2) D DEM^VADPT S PSSN=$P($G(VADM(2)),U)
"RTN","DGENRPT3",59,0)
 ... S ^TMP($J,"RT3",PRT,PSSN)=PRT_"^"_INPT
"RTN","DGENRPT3",60,0)
 ;
"RTN","DGENRPT3",61,0)
PRESRT2 ;Sort the sorted.
"RTN","DGENRPT3",62,0)
 N CNT,ICNT,OCNT,J,K
"RTN","DGENRPT3",63,0)
 S (J,K)=""
"RTN","DGENRPT3",64,0)
 F  S J=$O(^TMP($J,"RT3",J)) Q:J=""  D
"RTN","DGENRPT3",65,0)
 . S (CNT,ICNT,OCNT)=0
"RTN","DGENRPT3",66,0)
 . F  S K=$O(^TMP($J,"RT3",J,K)) Q:K=""  D
"RTN","DGENRPT3",67,0)
   .. S INPT=$P($G(^TMP($J,"RT3",J,K)),U,2)
"RTN","DGENRPT3",68,0)
   .. S CNT=CNT+1 S:INPT="IN" ICNT=ICNT+1 S:INPT="OUT" OCNT=OCNT+1
"RTN","DGENRPT3",69,0)
   .. S ^TMP($J,"SS3",J)=CNT_"^"_ICNT_"^"_OCNT
"RTN","DGENRPT3",70,0)
 K ^TMP($J,"RT3")
"RTN","DGENRPT3",71,0)
 Q
"RTN","DGENRPT3",72,0)
 ;
"RTN","DGENRPT3",73,0)
EGTP ;Get patients EGT Priority.
"RTN","DGENRPT3",74,0)
 S (PRT,PRTSUB,ABV,ENRDT)=""
"RTN","DGENRPT3",75,0)
 S PRT=$P($G(^DGEN(27.11,IND,0)),U,7)
"RTN","DGENRPT3",76,0)
 S:((PRT=7)!(PRT=8)) PRTSUB=$P($G(^DGEN(27.11,IND,0)),U,12)
"RTN","DGENRPT3",77,0)
 S ENRDT=$P($G(^DGEN(27.11,IND,0)),U,10)
"RTN","DGENRPT3",78,0)
 S:'ENRDT ENRDT=$P($G(^DGEN(27.11,IND,0)),U)
"RTN","DGENRPT3",79,0)
 S ABV=$$ABOVE^DGENEGT1(PRT,PRTSUB)
"RTN","DGENRPT3",80,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT3",81,0)
 . S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT3",82,0)
 . S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT3",83,0)
 S PRT=PRT_PRTSUB
"RTN","DGENRPT3",84,0)
 Q
"RTN","DGENRPT3",85,0)
 ;
"RTN","DGENRPT3",86,0)
PRINT ;Print the report.
"RTN","DGENRPT3",87,0)
 N POP,IO,IOBS,IOF,IOHG,IOM,ION,IOPAR,IOS,IOSL,IOST,IOT,IOUPAR,IOXY,ZTSAVE,TSK,%ZIS,ZTRTN,ZTDESC
"RTN","DGENRPT3",88,0)
 S %ZIS="QM" D ^%ZIS G EXIT:POP
"RTN","DGENRPT3",89,0)
 I $D(IO("Q")) D  G EXIT
"RTN","DGENRPT3",90,0)
 . S ZTRTN="WRITER^DGENRPT3",ZTDESC="DG EGT Actual Summary Report."
"RTN","DGENRPT3",91,0)
 . S ZTSAVE("BDT")="",ZTSAVE("EDT")=""
"RTN","DGENRPT3",92,0)
 . D ^%ZTLOAD
"RTN","DGENRPT3",93,0)
 . S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DGENRPT3",94,0)
 . I TSK="Y" W !!,"Report queued! Task number: ",ZTSK
"RTN","DGENRPT3",95,0)
 . D HOME^%ZIS
"RTN","DGENRPT3",96,0)
 ;
"RTN","DGENRPT3",97,0)
WRITER ;Write out the report.
"RTN","DGENRPT3",98,0)
 U IO
"RTN","DGENRPT3",99,0)
 I $E(IOST,1,2)="C-" W @IOF
"RTN","DGENRPT3",100,0)
 N EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,COUNT,RLEGT,ENRDT
"RTN","DGENRPT3",101,0)
 S (EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,RLEGT)="",COUNT=0
"RTN","DGENRPT3",102,0)
 I $$FINDCUR^DGENEGT()=0 W !,"No EGT setting on file.",! S EGT=0
"RTN","DGENRPT3",103,0)
 I $$FINDCUR^DGENEGT()'=0 D GETEGTS
"RTN","DGENRPT3",104,0)
 D PRESRT1
"RTN","DGENRPT3",105,0)
 D PSHEAD
"RTN","DGENRPT3",106,0)
 D DATA
"RTN","DGENRPT3",107,0)
 D ^%ZISC
"RTN","DGENRPT3",108,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DGENRPT3",109,0)
 D KVA^VADPT
"RTN","DGENRPT3",110,0)
 K ^TMP($J,"SS3")
"RTN","DGENRPT3",111,0)
 Q
"RTN","DGENRPT3",112,0)
 ;
"RTN","DGENRPT3",113,0)
PSHEAD ;Header for the Preliminary Detailed Report.
"RTN","DGENRPT3",114,0)
 ;Get the date/time the report is run.
"RTN","DGENRPT3",115,0)
 N RDT,Y,DT1,DT2 S (RDT,Y,DT1,DT2)=""
"RTN","DGENRPT3",116,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGENRPT3",117,0)
 S RDT=$P(Y,"@",1)_" @ "_$P($P(Y,"@",2),":",1,2)
"RTN","DGENRPT3",118,0)
 S DT1=$$FMTE^XLFDT(BDT),DT2=$$FMTE^XLFDT(EDT)
"RTN","DGENRPT3",119,0)
 S EGTSUB=$$EXTERNAL^DILFD(27.16,.03,"F",EGTSUB)
"RTN","DGENRPT3",120,0)
 I ((EGT=7)!(EGT=8)),EGTSUB="" S EGTSUB="ER"
"RTN","DGENRPT3",121,0)
 ;Write the header.
"RTN","DGENRPT3",122,0)
 W !,?((IOM-32)\2),"EGT Actual Summary Impact Report"
"RTN","DGENRPT3",123,0)
 W !,?((IOM-62)\2),"Date Range of Enrollment End Date: ",DT1," - ",DT2
"RTN","DGENRPT3",124,0)
 W !,?((IOM-41)\2),"Date/Time Report Run: ",RDT
"RTN","DGENRPT3",125,0)
 W !,?((IOM-45-$L(RLEGT_EGTSUB_EGTTP_EGTEDT))\2),"EGT Setting: ",RLEGT_EGTSUB," EGT Type: ",EGTTP," EGT Effective Date: ",EGTEDT
"RTN","DGENRPT3",126,0)
 W !,?((IOM-28-$L(EGTLDT))\2),"Date/Time Last EGT Setting: ",EGTLDT
"RTN","DGENRPT3",127,0)
 W !!,"IMPORTANT NOTE:  Actual report is based on a comparison of the EGT Setting and the Enrollment Category as provided by HEC."
"RTN","DGENRPT3",128,0)
 W !!,"ENROLLMENT PRIORITY",?23,"TOTAL (UNIQUE SSN)",?43,"# INPATIENT",?57,"# OUTPATIENT",!
"RTN","DGENRPT3",129,0)
 Q
"RTN","DGENRPT3",130,0)
 ;
"RTN","DGENRPT3",131,0)
DATA ;Get all the data for the report.
"RTN","DGENRPT3",132,0)
 N T,EP,TLT,INPT,OPT S (T,EP,TLT,INPT,OPT)=""
"RTN","DGENRPT3",133,0)
 F  S T=$O(^TMP($J,"SS3",T)) Q:T=""  D
"RTN","DGENRPT3",134,0)
 . S EP=T,TLT=$P($G(^TMP($J,"SS3",T)),U),INPT=$P($G(^TMP($J,"SS3",T)),U,2),OPT=$P($G(^TMP($J,"SS3",T)),U,3)
"RTN","DGENRPT3",135,0)
 . S COUNT=COUNT+TLT
"RTN","DGENRPT3",136,0)
 . W !,EP,?25,TLT,?45,INPT,?59,OPT
"RTN","DGENRPT3",137,0)
 W !,"TOTAL PATIENTS (UNIQUE SSNS) FOR THIS FACILITY:     ",COUNT
"RTN","DGENRPT3",138,0)
 Q
"RTN","DGENRPT4")
0^7^B52785479
"RTN","DGENRPT4",1,0)
DGENRPT4 ;ALB/DW,LBD - EGT Actual Detailed Impact Report ; 11/2/01 10:23am ;07/22/02 9:40am
"RTN","DGENRPT4",2,0)
 ;;5.3;Registration;**232,306,417,456,491**;Aug 13,1993
"RTN","DGENRPT4",3,0)
 ;
"RTN","DGENRPT4",4,0)
 ;
"RTN","DGENRPT4",5,0)
ENPT ;Actual Detailed Report selected.
"RTN","DGENRPT4",6,0)
 K ^TMP($J,"BY4"),^TMP($J,"CNT4")
"RTN","DGENRPT4",7,0)
 N INFAP,BDT,EDT S (INFAP,BDT,EDT)=""
"RTN","DGENRPT4",8,0)
 D RPDT I BDT="^"!(EDT="^")!($D(DTOUT)) Q
"RTN","DGENRPT4",9,0)
 D INFAP I INFAP="^"!($D(DTOUT)) Q
"RTN","DGENRPT4",10,0)
 N EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,L,BY,DIC,FLDS,DHD,DIOEND,X,DFN,PSSN,FCTY,DIOBEG,VASD,VAERR,RLEGT,ENRDT
"RTN","DGENRPT4",11,0)
 S (EGT,EGTSUB,EGTEDT,EGTLDT,EGTTP,FCTY,RLEGT)=""
"RTN","DGENRPT4",12,0)
 W !!,"*** This report requires a 132 column printer. ***",!!
"RTN","DGENRPT4",13,0)
 S DIC="^DGEN(27.11,"
"RTN","DGENRPT4",14,0)
 S DIOBEG="D PRESORT^DGENRPT4"
"RTN","DGENRPT4",15,0)
 S BY(0)="^TMP($J,""BY4"",",L(0)=3,L=0
"RTN","DGENRPT4",16,0)
 S FLDS="D PT^DGENRPT4 W X;C0;L20,W PSSN;C22;L10,D EP^DGENRPT4 W X;C33;L2,D ENRED^DGENRPT4 W X;C37;L10,D ENRST^DGENRPT4 W X;C49;L12"
"RTN","DGENRPT4",17,0)
 I INFAP=1 D
"RTN","DGENRPT4",18,0)
 . S FLDS(2)="D WRD^DGENRPT4 W X;C63;L15;""WARD"",D FAP1^DGENRPT4 W X;C80;L31,D PCPVD^DGENRPT4 W X;C110;L10,D PFCLTY^DGENRPT4 W X;C121;L11"
"RTN","DGENRPT4",19,0)
 . S DHD="W ?0 D DETHD1^DGENRPT4"
"RTN","DGENRPT4",20,0)
 I INFAP=0 D
"RTN","DGENRPT4",21,0)
 . S FLDS(2)="D WRD^DGENRPT4 W X;C63;L15;""WARD"",D FAP0^DGENRPT4 W X;C80;L31,D PCPVD^DGENRPT4 W X;C88;L10,D PFCLTY^DGENRPT4 W X;C100;L12"
"RTN","DGENRPT4",22,0)
 . S DHD="W ?0 D DETHD0^DGENRPT4"
"RTN","DGENRPT4",23,0)
 S DIOEND="D END^DGENRPT4"
"RTN","DGENRPT4",24,0)
 D EN1^DIP
"RTN","DGENRPT4",25,0)
 D EXIT
"RTN","DGENRPT4",26,0)
 Q
"RTN","DGENRPT4",27,0)
 ;
"RTN","DGENRPT4",28,0)
INFAP ;Ask the user if Future Appointments is wanted on the report.
"RTN","DGENRPT4",29,0)
 N DIR,X,Y
"RTN","DGENRPT4",30,0)
 S DIR(0)="Y^1:3"
"RTN","DGENRPT4",31,0)
 S DIR("A")="Do you want to include Future Appointments"
"RTN","DGENRPT4",32,0)
 D ^DIR S INFAP=Y
"RTN","DGENRPT4",33,0)
 I ($D(DTOUT)) W *7
"RTN","DGENRPT4",34,0)
 Q
"RTN","DGENRPT4",35,0)
 ;
"RTN","DGENRPT4",36,0)
RPDT ;Ask the user the Report Begin Date and Report End Date.
"RTN","DGENRPT4",37,0)
 N DIR,X,Y
"RTN","DGENRPT4",38,0)
 S DIR(0)="DA^::E"
"RTN","DGENRPT4",39,0)
 S DIR("A")="Report Begin Date: "
"RTN","DGENRPT4",40,0)
 S DIR("?")="Please enter the Enrollment End Date as the beginning date that will be reported on."
"RTN","DGENRPT4",41,0)
 D ^DIR S BDT=Y
"RTN","DGENRPT4",42,0)
 I BDT="^" Q
"RTN","DGENRPT4",43,0)
 I ($D(DTOUT)) W *7 Q
"RTN","DGENRPT4",44,0)
 ;
"RTN","DGENRPT4",45,0)
RPDT2 S DIR(0)="DA^::E"
"RTN","DGENRPT4",46,0)
 S DIR("A")="Report End Date: "
"RTN","DGENRPT4",47,0)
 S DIR("?")="Please enter the Enrollment End Date as the end date that will be reported on. Report End Date cannot be earlier than Report Begin Date."
"RTN","DGENRPT4",48,0)
 D ^DIR S EDT=Y
"RTN","DGENRPT4",49,0)
 I EDT="^" Q
"RTN","DGENRPT4",50,0)
 I ($D(DTOUT)) W *7 Q
"RTN","DGENRPT4",51,0)
 I EDT<BDT G RPDT2
"RTN","DGENRPT4",52,0)
 Q
"RTN","DGENRPT4",53,0)
 ;
"RTN","DGENRPT4",54,0)
PRESORT ;First get the current EGT Setting from file #27.16.
"RTN","DGENRPT4",55,0)
 N GETEGTS,REC,TP S (GETEGTS,REC,TP)=""
"RTN","DGENRPT4",56,0)
 S REC=$$FINDCUR^DGENEGT()
"RTN","DGENRPT4",57,0)
 ;If no EGT setting on file, print patient of all enrollment priorities.
"RTN","DGENRPT4",58,0)
 I REC=0 W !,"No EGT setting on file.",! S EGT=0 G PRESRT1
"RTN","DGENRPT4",59,0)
 S TP=$$GET^DGENEGT(REC,.GETEGTS)
"RTN","DGENRPT4",60,0)
 ;Get EGT Priority.
"RTN","DGENRPT4",61,0)
 S EGT=GETEGTS("PRIORITY"),RLEGT=EGT
"RTN","DGENRPT4",62,0)
 I EGT="" W !,"No EGT setting on file.",! S EGT=0
"RTN","DGENRPT4",63,0)
 S EGTSUB=GETEGTS("SUBGRP")
"RTN","DGENRPT4",64,0)
 ;Get EGT Effective Date.
"RTN","DGENRPT4",65,0)
 S EGTEDT=GETEGTS("EFFDATE") I EGTEDT S EGTEDT=$$FMTE^XLFDT(EGTEDT)
"RTN","DGENRPT4",66,0)
 ;Get last EGT setting Date/Time.
"RTN","DGENRPT4",67,0)
 S EGTLDT=GETEGTS("ENTDATE") I EGTLDT S EGTLDT=$$FMTE^XLFDT(EGTLDT)
"RTN","DGENRPT4",68,0)
 ;Get EGT Type.
"RTN","DGENRPT4",69,0)
 S EGTTP=GETEGTS("TYPE")
"RTN","DGENRPT4",70,0)
 S EGTTP=$$EXTERNAL^DILFD(27.16,.04,"F",EGTTP) S:EGTTP="" EGTTP="UNSPECIFIED"
"RTN","DGENRPT4",71,0)
 ;
"RTN","DGENRPT4",72,0)
PRESRT1 ;Sort for patient's current record and get the potentially affected.
"RTN","DGENRPT4",73,0)
 N IND,PRT,DFN,NM,PSSN,PEDT,PCTRY,PRTSUB,ABV
"RTN","DGENRPT4",74,0)
 S (IND,PRT,DFN,NM,PSSN,PEDT,PCTRY,PRTSUB,ABV)=""
"RTN","DGENRPT4",75,0)
 K ^TMP($J,"BY4"),^TMP($J,"CNT4")
"RTN","DGENRPT4",76,0)
 F  S DFN=$O(^DGEN(27.11,"C",DFN)) Q:DFN=""  D
"RTN","DGENRPT4",77,0)
 . S IND=$$FINDCUR^DGENA(DFN)
"RTN","DGENRPT4",78,0)
 . I IND D
"RTN","DGENRPT4",79,0)
 .. D EGTP
"RTN","DGENRPT4",80,0)
 .. S PEDT=$P($G(^DGEN(27.11,IND,0)),U,11)
"RTN","DGENRPT4",81,0)
 .. S PCTRY=$$CATEGORY^DGENA4(DFN)
"RTN","DGENRPT4",82,0)
 .. I ABV=0&(PCTRY="N")&(PEDT'<BDT)&(PEDT'>EDT) D
"RTN","DGENRPT4",83,0)
 ... K VADM(1),VADM(2) D DEM^VADPT S NM=VADM(1) D BYSRT
"RTN","DGENRPT4",84,0)
 ... S PSSN=$P($G(VADM(2)),U),^TMP($J,"CNT4",PRT,PSSN)=""
"RTN","DGENRPT4",85,0)
 I EGTSUB>4 S EGTSUB="ER" Q
"RTN","DGENRPT4",86,0)
 S EGTSUB=$$EXTERNAL^DILFD(27.16,.03,"F",EGTSUB)
"RTN","DGENRPT4",87,0)
 Q
"RTN","DGENRPT4",88,0)
 ;
"RTN","DGENRPT4",89,0)
EGTP ;Get patients EGT Priority.
"RTN","DGENRPT4",90,0)
 S (PRT,PRTSUB,ABV,ENRDT)=""
"RTN","DGENRPT4",91,0)
 S PRT=$P($G(^DGEN(27.11,IND,0)),U,7)
"RTN","DGENRPT4",92,0)
 S:((PRT=7)!(PRT=8)) PRTSUB=$P($G(^DGEN(27.11,IND,0)),U,12)
"RTN","DGENRPT4",93,0)
 S ENRDT=$P($G(^DGEN(27.11,IND,0)),U,10)
"RTN","DGENRPT4",94,0)
 S:'ENRDT ENRDT=$P($G(^DGEN(27.11,IND,0)),U)
"RTN","DGENRPT4",95,0)
 S ABV=$$ABOVE^DGENEGT1(PRT,PRTSUB)
"RTN","DGENRPT4",96,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT4",97,0)
 . S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT4",98,0)
 . S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT4",99,0)
 S PRT=PRT_PRTSUB
"RTN","DGENRPT4",100,0)
 Q
"RTN","DGENRPT4",101,0)
 ;
"RTN","DGENRPT4",102,0)
BYSRT ;Sort patients by last name for "BY(0)".
"RTN","DGENRPT4",103,0)
 S ^TMP($J,"BY4",NM,DFN,IND)=""
"RTN","DGENRPT4",104,0)
 Q
"RTN","DGENRPT4",105,0)
 ;
"RTN","DGENRPT4",106,0)
PT ;Get the patient NAME and SSN
"RTN","DGENRPT4",107,0)
 S (X,DFN,PSSN)="" K VADM(1),VADM(2)
"RTN","DGENRPT4",108,0)
 S DFN=$P($G(^DGEN(27.11,D0,0)),U,2)
"RTN","DGENRPT4",109,0)
 I DFN D DEM^VADPT S X=$E(VADM(1),1,20),PSSN=$P(VADM(2),U)
"RTN","DGENRPT4",110,0)
 Q
"RTN","DGENRPT4",111,0)
 ;
"RTN","DGENRPT4",112,0)
EP ;Get the patient EGT Priority.
"RTN","DGENRPT4",113,0)
 S X=""
"RTN","DGENRPT4",114,0)
 N PRT,PRTSUB S (PRT,PRTSUB)=""
"RTN","DGENRPT4",115,0)
 S PRT=$P($G(^DGEN(27.11,D0,0)),U,7)
"RTN","DGENRPT4",116,0)
 I PRT=7!(PRT=8) D
"RTN","DGENRPT4",117,0)
 .S PRTSUB=$P($G(^DGEN(27.11,D0,0)),U,12)
"RTN","DGENRPT4",118,0)
 .S PRTSUB=$$EXTERNAL^DILFD(27.11,.12,"F",PRTSUB)
"RTN","DGENRPT4",119,0)
 .S:PRTSUB="" PRTSUB="ER"
"RTN","DGENRPT4",120,0)
 .S PRT=PRT_PRTSUB
"RTN","DGENRPT4",121,0)
 S X=PRT
"RTN","DGENRPT4",122,0)
 Q
"RTN","DGENRPT4",123,0)
 ;
"RTN","DGENRPT4",124,0)
ENRED ;Get the patient ENROLLMENT END DATE.
"RTN","DGENRPT4",125,0)
 S X=""
"RTN","DGENRPT4",126,0)
 S X=$P($G(^DGEN(27.11,D0,0)),U,11)
"RTN","DGENRPT4",127,0)
 I X="" S X="N/A" Q
"RTN","DGENRPT4",128,0)
 S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","DGENRPT4",129,0)
 Q
"RTN","DGENRPT4",130,0)
 ;
"RTN","DGENRPT4",131,0)
ENRST ;Get the patient ENROLLMENT STATUS.
"RTN","DGENRPT4",132,0)
 S X=""
"RTN","DGENRPT4",133,0)
 S X=$P($G(^DGEN(27.11,D0,0)),U,4)
"RTN","DGENRPT4",134,0)
 S X=$P($G(^DGEN(27.15,X,0)),U,1),X=$E(X,1,12)
"RTN","DGENRPT4",135,0)
 Q
"RTN","DGENRPT4",136,0)
 ;
"RTN","DGENRPT4",137,0)
WRD ;Get the patient WARD.
"RTN","DGENRPT4",138,0)
 S X="" K VAIP(5)
"RTN","DGENRPT4",139,0)
 D IN5^VADPT S X=$P($G(VAIP(5)),U,2),X=$E(X,1,15)
"RTN","DGENRPT4",140,0)
 I X="" S X="N/A"
"RTN","DGENRPT4",141,0)
 Q
"RTN","DGENRPT4",142,0)
 ;
"RTN","DGENRPT4",143,0)
FAP1 ;Get the patient FUTURE APPOINTMENTS.
"RTN","DGENRPT4",144,0)
 N J,POP,ADT S (X,J,ADT)="",POP=0
"RTN","DGENRPT4",145,0)
 K ^UTILITY("VASD",$J)
"RTN","DGENRPT4",146,0)
 D CALSDA
"RTN","DGENRPT4",147,0)
 I VAERR=1 S X="N/A" Q
"RTN","DGENRPT4",148,0)
 F  S J=$O(^UTILITY("VASD",$J,J)) Q:J=""!POP  D
"RTN","DGENRPT4",149,0)
 . S X=$P($G(^UTILITY("VASD",$J,J,"E")),U,2),X=$E(X,1,20)
"RTN","DGENRPT4",150,0)
 . S ADT=$P($G(^UTILITY("VASD",$J,J,"I")),U),ADT=$P(ADT,".",1)
"RTN","DGENRPT4",151,0)
 . S ADT=$E(ADT,4,5)_"/"_$E(ADT,6,7)_"/"_(1700+$E(ADT,1,3))
"RTN","DGENRPT4",152,0)
 . S X=ADT_" "_X
"RTN","DGENRPT4",153,0)
 . I J=1 W X S X=""
"RTN","DGENRPT4",154,0)
 . I J>1&(J<6) W !,?79,X S X=""
"RTN","DGENRPT4",155,0)
 . I J=6 S X="" W !,?79,"More Appts" S POP=1 Q
"RTN","DGENRPT4",156,0)
 I $D(^UTILITY("VASD",$J))=0 S X="NONE"
"RTN","DGENRPT4",157,0)
 Q
"RTN","DGENRPT4",158,0)
 ;
"RTN","DGENRPT4",159,0)
FAP0 ;See if the patient has future appointment.
"RTN","DGENRPT4",160,0)
 S X="NO"
"RTN","DGENRPT4",161,0)
 K ^UTILITY("VASD",$J)
"RTN","DGENRPT4",162,0)
 D CALSDA
"RTN","DGENRPT4",163,0)
 I VAERR=1 S X="N/A" Q
"RTN","DGENRPT4",164,0)
 I $G(^UTILITY("VASD",$J,1,"I"))'="" S X="YES"
"RTN","DGENRPT4",165,0)
 Q
"RTN","DGENRPT4",166,0)
 ;
"RTN","DGENRPT4",167,0)
CALSDA ;Call API to get patient appoinments.
"RTN","DGENRPT4",168,0)
 N X
"RTN","DGENRPT4",169,0)
 S VASD("F")=DT,VASD("W")=12 D SDA^VADPT
"RTN","DGENRPT4",170,0)
 Q
"RTN","DGENRPT4",171,0)
 ;
"RTN","DGENRPT4",172,0)
PCPVD ;Get the patient PC PROVIDER.
"RTN","DGENRPT4",173,0)
 ;;Site must use PCMM module.
"RTN","DGENRPT4",174,0)
 S X=""
"RTN","DGENRPT4",175,0)
 S X=$$OUTPTPR^SDUTL3(DFN)
"RTN","DGENRPT4",176,0)
 I X="" S X="N/A" Q
"RTN","DGENRPT4",177,0)
 S X=$P(X,U,2),X=$E(X,1,10)
"RTN","DGENRPT4",178,0)
 Q
"RTN","DGENRPT4",179,0)
 ;
"RTN","DGENRPT4",180,0)
PFCLTY ;Get the patient PREFFERED FACILITY.
"RTN","DGENRPT4",181,0)
 S (X,FCTY)=""
"RTN","DGENRPT4",182,0)
 S X=$$PREF^DGENPTA(DFN,.FCTY),X=$E(FCTY,1,11)
"RTN","DGENRPT4",183,0)
 I X="" S X="N/A"
"RTN","DGENRPT4",184,0)
 Q
"RTN","DGENRPT4",185,0)
 ;
"RTN","DGENRPT4",186,0)
DETHD ;General header for the Preliminary Detailed Report.
"RTN","DGENRPT4",187,0)
 ;Get the date/time the report is run.
"RTN","DGENRPT4",188,0)
 N RDT,Y,DT1,DT2 S (RDT,Y,DT1,DT2)=""
"RTN","DGENRPT4",189,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","DGENRPT4",190,0)
 S RDT=$P(Y,"@",1)_" @ "_$P($P(Y,"@",2),":",1,2)
"RTN","DGENRPT4",191,0)
 S DT1=$$FMTE^XLFDT(BDT),DT2=$$FMTE^XLFDT(EDT)
"RTN","DGENRPT4",192,0)
 ;Write the header.
"RTN","DGENRPT4",193,0)
 W !,?((IOM-33)\2),"EGT Actual Detailed Impact Report"
"RTN","DGENRPT4",194,0)
 W !,?((IOM-38-$L(DT1_DT2))\2),"Date Range of Enrollment End Date: ",DT1," - ",DT2
"RTN","DGENRPT4",195,0)
 W !,?((IOM-22-$L(RDT))\2),"Date/Time Report Run: ",RDT
"RTN","DGENRPT4",196,0)
 W !,?((IOM-45-$L(RLEGT_EGTSUB_EGTTP_EGTEDT))\2),"EGT Setting: ",RLEGT_EGTSUB," EGT Type: ",EGTTP," EGT Effective Date: ",EGTEDT
"RTN","DGENRPT4",197,0)
 W !,?((IOM-28-$L(EGTLDT))\2),"Date/Time Last EGT Setting: ",EGTLDT
"RTN","DGENRPT4",198,0)
 W !!,"IMPORTANT NOTE:  Actual report is based on a comparison of the EGT Setting and the Enrollment Category as provided by HEC."
"RTN","DGENRPT4",199,0)
 Q
"RTN","DGENRPT4",200,0)
 ;
"RTN","DGENRPT4",201,0)
DETHD1 ;Header for the Preliminary Detailed Report, with Future Appointments.
"RTN","DGENRPT4",202,0)
 D DETHD
"RTN","DGENRPT4",203,0)
 W !!,"NAME",?21,"SSN",?32,"EP",?36,"ENROLLMENT",?48,"ENROLLMENT",?62,"WARD",?79,"FUTURE",?109,"PC",?120,"PREF"
"RTN","DGENRPT4",204,0)
 W !,?36,"END DATE",?48,"STATUS",?79,"APPOINTMENTS",?109,"PROVIDER",?120,"FACILITY",!!
"RTN","DGENRPT4",205,0)
 Q
"RTN","DGENRPT4",206,0)
 ;
"RTN","DGENRPT4",207,0)
DETHD0 ;Header for the Preliminary Detailed Report, no Future Appointments.
"RTN","DGENRPT4",208,0)
 D DETHD
"RTN","DGENRPT4",209,0)
 W !!,"NAME",?21,"SSN",?32,"EP",?36,"ENROLLMENT",?48,"ENROLLMENT",?62,"WARD",?79,"FUTURE",?87,"PC",?99,"PREF"
"RTN","DGENRPT4",210,0)
 W !,?36,"END DATE",?48,"STATUS",?79,"APPTS",?87,"PROVIDER",?99,"FACILITY",!!
"RTN","DGENRPT4",211,0)
 Q
"RTN","DGENRPT4",212,0)
 ;
"RTN","DGENRPT4",213,0)
END ;At the end of the display.
"RTN","DGENRPT4",214,0)
 N PSSN,J,COUNT S (PSSN,J)="",COUNT=0
"RTN","DGENRPT4",215,0)
 F  S J=$O(^TMP($J,"CNT4",J)) Q:J=""  D
"RTN","DGENRPT4",216,0)
 . F  S PSSN=$O(^TMP($J,"CNT4",J,PSSN)) Q:PSSN=""  S COUNT=COUNT+1
"RTN","DGENRPT4",217,0)
 W !,"TOTAL PATIENTS (UNIQUE SSNS) FOR THIS FACILITY:     ",COUNT
"RTN","DGENRPT4",218,0)
 Q
"RTN","DGENRPT4",219,0)
 ;
"RTN","DGENRPT4",220,0)
EXIT ;Clean up upon exit of the routine.
"RTN","DGENRPT4",221,0)
 D KVA^VADPT
"RTN","DGENRPT4",222,0)
 K ^TMP($J,"BY4"),^TMP($J,"CNT4")
"RTN","DGENRPT4",223,0)
 Q
"VER")
8.0^22
"^DD",27.11,27.11,.12,0)
ENROLLMENT SUBGROUP^S^1:a;3:c;5:e;7:g;^0;12^Q
"^DD",27.11,27.11,.12,3)
Enter the enrollment priority subgroup determined for this patient.
"^DD",27.11,27.11,.12,21,0)
^.001^1^1^3000727^^^
"^DD",27.11,27.11,.12,21,1,0)
This field will contain the enrollment priority subgroup determined for this enrollment.
"^DD",27.11,27.11,.12,"DT")
3021219
"^DD",27.16,27.16,.04,0)
EGT TYPE^RSI^1:ANNUAL FISCAL YEAR;2:STOP NEW ENROLLMENTS DURING CYCLE;3:MID-CYCLE CHANGE;4:ENROLLMENT DECISION;^0;4^Q
"^DD",27.16,27.16,.04,3)
Enter the reason for the enrollment group threshold change.
"^DD",27.16,27.16,.04,21,0)
^.001^1^1^3021219^^^^
"^DD",27.16,27.16,.04,21,1,0)
This field will contain the reason associated with the enrollment group threshold setting.
"^DD",27.16,27.16,.04,"DT")
3021219
**END**
**END**
