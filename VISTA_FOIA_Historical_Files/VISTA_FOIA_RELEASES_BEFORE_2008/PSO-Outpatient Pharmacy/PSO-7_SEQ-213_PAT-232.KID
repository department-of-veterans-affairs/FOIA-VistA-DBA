Released PSO*7*232 SEQ #213
Extracted from mail message
**KIDS**:PSO*7.0*232^

**INSTALL NAME**
PSO*7.0*232
"BLD",6650,0)
PSO*7.0*232^OUTPATIENT PHARMACY^0^3060522^y
"BLD",6650,1,0)
^^5^5^3060209^
"BLD",6650,1,1,0)
CORRECT SEVERAL PROBLEMS INCLUDING AMIS COMPILER TO FIND AND INCLUDE RX'S 
"BLD",6650,1,2,0)
THAT HAVE A DATE WITH NO TIME FOR RELEASE/DATE FIELD IN PRESCRIPTION FILE,
"BLD",6650,1,3,0)
A NULL SUBSCRIPT ERROR DURING BINGO BOARD STARTUP, DO NOT MAIL ISSUE WHEN
"BLD",6650,1,4,0)
OPAI SENDS HL7 MESSAGE, AND INCREASE DNS PORT NUMBER FIELD IN OUTPATIENT
"BLD",6650,1,5,0)
SITE FILE.
"BLD",6650,4,0)
^9.64PA^52.11^2
"BLD",6650,4,52.11,0)
52.11
"BLD",6650,4,52.11,2,0)
^9.641^52.11^1
"BLD",6650,4,52.11,2,52.11,0)
PATIENT NOTIFICATION (Rx READY)  (File-top level)
"BLD",6650,4,52.11,2,52.11,1,0)
^9.6411^6^1
"BLD",6650,4,52.11,2,52.11,1,6,0)
TIME READY (HHMM)
"BLD",6650,4,52.11,222)
y^y^p^^^^n^^n
"BLD",6650,4,52.11,224)

"BLD",6650,4,59,0)
59
"BLD",6650,4,59,2,0)
^9.641^59^1
"BLD",6650,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",6650,4,59,2,59,1,0)
^9.6411^2007^1
"BLD",6650,4,59,2,59,1,2007,0)
DISPENSE DNS PORT
"BLD",6650,4,59,222)
y^y^p^^^^n^^n
"BLD",6650,4,59,224)

"BLD",6650,4,"APDD",52.11,52.11)

"BLD",6650,4,"APDD",52.11,52.11,6)

"BLD",6650,4,"APDD",59,59)

"BLD",6650,4,"APDD",59,59,2007)

"BLD",6650,4,"B",52.11,52.11)

"BLD",6650,4,"B",59,59)

"BLD",6650,"KRN",0)
^9.67PA^8989.52^19
"BLD",6650,"KRN",.4,0)
.4
"BLD",6650,"KRN",.401,0)
.401
"BLD",6650,"KRN",.402,0)
.402
"BLD",6650,"KRN",.403,0)
.403
"BLD",6650,"KRN",.5,0)
.5
"BLD",6650,"KRN",.84,0)
.84
"BLD",6650,"KRN",3.6,0)
3.6
"BLD",6650,"KRN",3.8,0)
3.8
"BLD",6650,"KRN",9.2,0)
9.2
"BLD",6650,"KRN",9.8,0)
9.8
"BLD",6650,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6650,"KRN",9.8,"NM",1,0)
PSOHLDS1^^0^47619875
"BLD",6650,"KRN",9.8,"NM",2,0)
PSOAMIS0^^0^57481603
"BLD",6650,"KRN",9.8,"NM",3,0)
PSOBINGO^^0^61437280
"BLD",6650,"KRN",9.8,"NM",4,0)
PSOBGMGR^^0^61535737
"BLD",6650,"KRN",9.8,"NM","B","PSOAMIS0",2)

"BLD",6650,"KRN",9.8,"NM","B","PSOBGMGR",4)

"BLD",6650,"KRN",9.8,"NM","B","PSOBINGO",3)

"BLD",6650,"KRN",9.8,"NM","B","PSOHLDS1",1)

"BLD",6650,"KRN",19,0)
19
"BLD",6650,"KRN",19.1,0)
19.1
"BLD",6650,"KRN",101,0)
101
"BLD",6650,"KRN",409.61,0)
409.61
"BLD",6650,"KRN",771,0)
771
"BLD",6650,"KRN",870,0)
870
"BLD",6650,"KRN",8989.51,0)
8989.51
"BLD",6650,"KRN",8989.52,0)
8989.52
"BLD",6650,"KRN",8994,0)
8994
"BLD",6650,"KRN","B",.4,.4)

"BLD",6650,"KRN","B",.401,.401)

"BLD",6650,"KRN","B",.402,.402)

"BLD",6650,"KRN","B",.403,.403)

"BLD",6650,"KRN","B",.5,.5)

"BLD",6650,"KRN","B",.84,.84)

"BLD",6650,"KRN","B",3.6,3.6)

"BLD",6650,"KRN","B",3.8,3.8)

"BLD",6650,"KRN","B",9.2,9.2)

"BLD",6650,"KRN","B",9.8,9.8)

"BLD",6650,"KRN","B",19,19)

"BLD",6650,"KRN","B",19.1,19.1)

"BLD",6650,"KRN","B",101,101)

"BLD",6650,"KRN","B",409.61,409.61)

"BLD",6650,"KRN","B",771,771)

"BLD",6650,"KRN","B",870,870)

"BLD",6650,"KRN","B",8989.51,8989.51)

"BLD",6650,"KRN","B",8989.52,8989.52)

"BLD",6650,"KRN","B",8994,8994)

"BLD",6650,"QUES",0)
^9.62^^
"BLD",6650,"REQB",0)
^9.611^3^3
"BLD",6650,"REQB",1,0)
PSO*7.0*158^2
"BLD",6650,"REQB",2,0)
PSO*7.0*156^2
"BLD",6650,"REQB",3,0)
PSO*7.0*152^2
"BLD",6650,"REQB","B","PSO*7.0*152",3)

"BLD",6650,"REQB","B","PSO*7.0*156",2)

"BLD",6650,"REQB","B","PSO*7.0*158",1)

"FIA",52.11)
PATIENT NOTIFICATION (Rx READY)
"FIA",52.11,0)
^PS(52.11,
"FIA",52.11,0,0)
52.11IP
"FIA",52.11,0,1)
y^y^p^^^^n^^n
"FIA",52.11,0,10)

"FIA",52.11,0,11)

"FIA",52.11,0,"RLRO")

"FIA",52.11,0,"VR")
7.0^PSO
"FIA",52.11,52.11)
1
"FIA",52.11,52.11,6)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,2007)

"MBREQ")
0
"PKG",134,-1)
1^1
"PKG",134,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",134,20,0)
^9.402P^^
"PKG",134,22,0)
^9.49I^1^1
"PKG",134,22,1,0)
7.0^2971216^2980417^1271
"PKG",134,22,1,"PAH",1,0)
232^3060522
"PKG",134,22,1,"PAH",1,1,0)
^^5^5^3060522
"PKG",134,22,1,"PAH",1,1,1,0)
CORRECT SEVERAL PROBLEMS INCLUDING AMIS COMPILER TO FIND AND INCLUDE RX'S 
"PKG",134,22,1,"PAH",1,1,2,0)
THAT HAVE A DATE WITH NO TIME FOR RELEASE/DATE FIELD IN PRESCRIPTION FILE,
"PKG",134,22,1,"PAH",1,1,3,0)
A NULL SUBSCRIPT ERROR DURING BINGO BOARD STARTUP, DO NOT MAIL ISSUE WHEN
"PKG",134,22,1,"PAH",1,1,4,0)
OPAI SENDS HL7 MESSAGE, AND INCREASE DNS PORT NUMBER FIELD IN OUTPATIENT
"PKG",134,22,1,"PAH",1,1,5,0)
SITE FILE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOAMIS0")
0^2^B57481603^B54680818
"RTN","PSOAMIS0",1,0)
PSOAMIS0 ;BHAM ISC/SAB,BHW - pharmacy amis compile/recompile routine ;2/9/06 4:13pm
"RTN","PSOAMIS0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**17,25,158,232**;DEC 1997
"RTN","PSOAMIS0",3,0)
 ;
"RTN","PSOAMIS0",4,0)
 ; reference to ^VA(200 supported by IA# 224
"RTN","PSOAMIS0",5,0)
 ; reference to ^PSDRUG supported by IA# 221
"RTN","PSOAMIS0",6,0)
 ;
"RTN","PSOAMIS0",7,0)
 ;PSO*232 alter For loops to include release/dates without time stamp
"RTN","PSOAMIS0",8,0)
 ;
"RTN","PSOAMIS0",9,0)
 K ^TMP("PSOAMIS",$J) S X="T-1",%DT="" D ^%DT S (PSDATE,HDATE)=Y,ENDATE=Y_".9999999" S DA=PSDATE,DIK="^PS(59.1," D ^DIK D CLE,ADD
"RTN","PSOAMIS0",10,0)
 S PSDATE=PSDATE-1+.999999                                    ;PSO*232
"RTN","PSOAMIS0",11,0)
 F RR=0:0 S PSDATE=$O(^PSRX("AL",PSDATE)) Q:'PSDATE!(PSDATE>ENDATE)  D COM
"RTN","PSOAMIS0",12,0)
 S PSDATE=HDATE-1+.999999                                     ;PSO*232
"RTN","PSOAMIS0",13,0)
 F RR=0:0 S PSDATE=$O(^PSRX("AM",PSDATE)) Q:'PSDATE!(PSDATE>ENDATE)  D COM1
"RTN","PSOAMIS0",14,0)
 S PSDATE=HDATE D BUILD
"RTN","PSOAMIS0",15,0)
END K ^TMP("PSOAMIS",$J),DIC,I,ENT,Y,X,DINUM,%DT,PSDATE,METHAD,DA,PSODFN,DRUG,NRC,PAT,PHYS,DIV,RX,ST,STY,STY1,SDT,EDT,R,RXF,TY,ENDATE,HDATE S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOAMIS0",16,0)
 K RX0,RX2,DIK,C,BLD,LSTDFN,LSTDT
"RTN","PSOAMIS0",17,0)
 Q
"RTN","PSOAMIS0",18,0)
COM F PSODFN=0:0 S PSODFN=$O(^PSRX("AL",PSDATE,PSODFN)) Q:'PSODFN  S DA="" F TY=0:0 S DA=$O(^PSRX("AL",PSDATE,PSODFN,DA)) Q:DA=""  I $D(^PSRX(PSODFN,0)) D
"RTN","PSOAMIS0",19,0)
 .S RX0=^PSRX(PSODFN,0),RX2=^(2),PAT=$P(RX0,"^",2),ST=$P(RX0,"^",3),DRUG=$P(RX0,"^",6)
"RTN","PSOAMIS0",20,0)
 .D:'DA ORI D:DA REF
"RTN","PSOAMIS0",21,0)
 Q
"RTN","PSOAMIS0",22,0)
COM1 F PSODFN=0:0 S PSODFN=$O(^PSRX("AM",PSDATE,PSODFN)) Q:'PSODFN  S DA=0 F  S DA=$O(^PSRX("AM",PSDATE,PSODFN,DA)) Q:'DA  I $D(^PSRX(PSODFN,0)) D:$P($G(^PSRX(PSODFN,"P",DA,0)),"^",19)
"RTN","PSOAMIS0",23,0)
 .S RX0=^PSRX(PSODFN,0),RX2=^PSRX(PSODFN,2),PAT=$P(RX0,"^",2),ST=$P(RX0,"^",3),DRUG=$P(RX0,"^",6)
"RTN","PSOAMIS0",24,0)
 .S RXF=^PSRX(PSODFN,"P",DA,0),DIV=$S($P(RXF,"^",9):$P(RXF,"^",9),1:$P(RX2,"^",9)),$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",14)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",14)+1
"RTN","PSOAMIS0",25,0)
 .S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RXF,"^",2)="W":15,1:16))=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RXF,"^",2)="W":15,1:16))+1
"RTN","PSOAMIS0",26,0)
 .S PHYS=$S($P(RXF,"^",17):+$P(RXF,"^",17),1:$P(RX0,"^",4))
"RTN","PSOAMIS0",27,0)
 .I $P($G(^VA(200,PHYS,"PS")),"^",6)=4 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)+1
"RTN","PSOAMIS0",28,0)
 .E  S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)+1
"RTN","PSOAMIS0",29,0)
 .D STA
"RTN","PSOAMIS0",30,0)
 Q
"RTN","PSOAMIS0",31,0)
ORI Q:'$P(RX2,"^",13)!('$D(^PS(59,+$P(RX2,"^",9),0)))
"RTN","PSOAMIS0",32,0)
 S RX=^PSRX(PSODFN,0),PHYS=+$P(RX,"^",4),DIV=$S($P(RX2,"^",9):$P(RX2,"^",9),1:$O(^PS(59,0))),$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",13)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",13)+1
"RTN","PSOAMIS0",33,0)
 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RX,"^",11)="W":15,1:16))=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RX,"^",11)="W":15,1:16))+1
"RTN","PSOAMIS0",34,0)
 I $P($G(^VA(200,PHYS,"PS")),"^",6)=4 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)+1
"RTN","PSOAMIS0",35,0)
 E  S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)+1
"RTN","PSOAMIS0",36,0)
 D STA
"RTN","PSOAMIS0",37,0)
 Q
"RTN","PSOAMIS0",38,0)
REF Q:'$P($G(^PSRX(PSODFN,1,DA,0)),"^",18)!('$D(^PS(59,$P($G(^PSRX(PSODFN,1,DA,0)),"^",9),0)))
"RTN","PSOAMIS0",39,0)
 S RXF=^PSRX(PSODFN,1,DA,0),DIV=$S($P(RXF,"^",9):$P(RXF,"^",9),1:DIV),$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",14)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",14)+1
"RTN","PSOAMIS0",40,0)
 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RXF,"^",2)="W":15,1:16))=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S($P(RXF,"^",2)="W":15,1:16))+1
"RTN","PSOAMIS0",41,0)
 S PHYS=$S($P(RXF,"^",17):+$P(RXF,"^",17),1:$P(RX0,"^",4))
"RTN","PSOAMIS0",42,0)
 I $P($G(^VA(200,PHYS,"PS")),"^",6)=4 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",10)+1
"RTN","PSOAMIS0",43,0)
 E  S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",11)+1
"RTN","PSOAMIS0",44,0)
 D STA
"RTN","PSOAMIS0",45,0)
 Q
"RTN","PSOAMIS0",46,0)
CLE F I=0:0 S I=$O(^PS(59,I)) Q:'I  S METHAD(I)=+$P($G(^PS(59,I,5)),"^",2),^TMP("PSOAMIS",$J,"AMIS",I)=0
"RTN","PSOAMIS0",47,0)
 Q
"RTN","PSOAMIS0",48,0)
STA S STY=$P($G(^PS(53,ST,0)),"^",6)
"RTN","PSOAMIS0",49,0)
 S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S(STY=1:2,STY=2:4,STY=3:6,STY=4:1,STY=5:17,1:12))=+$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",$S(STY=1:2,STY=2:4,STY=3:6,STY=4:1,STY=5:17,1:12))+1
"RTN","PSOAMIS0",50,0)
 S NRC=$P($G(^PSDRUG(DRUG,0)),"^",3) I NRC["A"!(NRC["C") S $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",7)=$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",7)+1
"RTN","PSOAMIS0",51,0)
 S:DRUG=$G(METHAD(DIV)) $P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",8)=$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",8)+1
"RTN","PSOAMIS0",52,0)
 I '$D(^TMP("PSOAMIS",$J,DIV,PAT)) S ^TMP("PSOAMIS",$J,DIV,PAT)="",$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",9)=$P(^TMP("PSOAMIS",$J,"AMIS",DIV),"^",9)+1
"RTN","PSOAMIS0",53,0)
 Q
"RTN","PSOAMIS0",54,0)
BUILD ;set global node
"RTN","PSOAMIS0",55,0)
 F I=0:0 S I=$O(^PS(59,I)) Q:'I  S ^PS(59.1,$P(PSDATE,"."),1,I,0)=$P(^PS(59.1,$P(PSDATE,"."),1,I,0),"^")_"^"_^TMP("PSOAMIS",$J,"AMIS",I) D
"RTN","PSOAMIS0",56,0)
 .F IFN=2:1:18 S $P(^PS(59.1,$P(PSDATE,"."),1,I,0),"^",IFN)=+$P(^PS(59.1,$P(PSDATE,"."),1,I,0),"^",IFN)
"RTN","PSOAMIS0",57,0)
 K PAT,IFN,^TMP("PSOAMIS",$J)
"RTN","PSOAMIS0",58,0)
 Q
"RTN","PSOAMIS0",59,0)
ADD Q:$G(^PS(59.1,$P(PSDATE,"."),0))
"RTN","PSOAMIS0",60,0)
 S (X,DINUM)=$P(PSDATE,"."),DIC="^PS(59.1,",DIC(0)="L" K DD,DO D FILE^DICN K DD,DO
"RTN","PSOAMIS0",61,0)
 S I=0 F  S I=$O(^PS(59,I)) Q:'I  S ^PS(59.1,$P(PSDATE,"."),1,0)="^59.11PA^"_I,^PS(59.1,$P(PSDATE,"."),1,I,0)=I,^PS(59.1,$P(PSDATE,"."),1,"B",I,I)="" S $P(^PS(59.1,$P(PSDATE,"."),1,0),"^",4)=($P(^PS(59.1,$P(PSDATE,"."),1,0),"^",4)+1)
"RTN","PSOAMIS0",62,0)
 Q
"RTN","PSOAMIS0",63,0)
RECOM ;recompiles AMIS data
"RTN","PSOAMIS0",64,0)
 K ^TMP("PSOAMIS",$J)
"RTN","PSOAMIS0",65,0)
 W ! S %DT(0)=-DT,%DT("A")="Recompile AMIS Starting: " S %DT="EPXA" D ^%DT G:"^"[X END G RECOM:'Y S (HDATE,SDT)=Y K %DT(0)
"RTN","PSOAMIS0",66,0)
REDT W ! S %DT(0)=SDT,%DT("A")="Ending Stats Date: " D ^%DT G:"^"[X END S EDT=Y I Y<0 G REDT
"RTN","PSOAMIS0",67,0)
 S EDT=EDT_".9999999"
"RTN","PSOAMIS0",68,0)
 S ZTRTN="BEG^PSOAMIS0",ZTDESC="Recompile Outpatient AMIS Data",ZTIO="" F G="SDT","EDT","HDATE" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOAMIS0",69,0)
 D ^%ZTLOAD W:$D(ZTSK) !!,"Task Queued !",! K SDT,EDT,G,ZTSK,ZTIO
"RTN","PSOAMIS0",70,0)
 Q
"RTN","PSOAMIS0",71,0)
BEG K LSTDFN,LSTDT,^TMP("PSOAMIS",$J) S LSTDT="",PSDATE=SDT,BLD=0
"RTN","PSOAMIS0",72,0)
 S PSDT=SDT-1 F  S PSDT=$O(^PS(59.1,PSDT)) Q:'PSDT!(PSDT>EDT)  K ^PS(59.1,PSDT),^PS(59.1,"B",PSDT,PSDT)
"RTN","PSOAMIS0",73,0)
 F I=0:0 S I=$O(^PS(59,I)) Q:'I  S METHAD(I)=+$P($G(^PS(59,I,5)),"^",2)
"RTN","PSOAMIS0",74,0)
 S PSDATE=PSDATE-1+.999999                                    ;PSO*232
"RTN","PSOAMIS0",75,0)
 F R=0:0 S PSDATE=$O(^PSRX("AL",PSDATE)) Q:'PSDATE!(PSDATE>EDT)  F RXN=0:0 S RXN=$O(^PSRX("AL",PSDATE,RXN)) Q:'RXN  S DA="" F TY=0:0 S DA=$O(^PSRX("AL",PSDATE,RXN,DA)) Q:DA=""  I $D(^PSRX(RXN,0)) D
"RTN","PSOAMIS0",76,0)
 .S RX0=^PSRX(RXN,0),RX2=^(2),PAT=$P(RX0,"^",2),ST=$P(RX0,"^",3),DRUG=$P(RX0,"^",6)
"RTN","PSOAMIS0",77,0)
 .D:'DA ORI1 D:DA REF1
"RTN","PSOAMIS0",78,0)
 S PSDATE=HDATE-1+.999999                                     ;PSO*232
"RTN","PSOAMIS0",79,0)
 F R=0:0 S PSDATE=$O(^PSRX("AM",PSDATE)) Q:'PSDATE!(PSDATE>EDT)  F RXN=0:0 S RXN=$O(^PSRX("AM",PSDATE,RXN)) Q:'RXN  S DA=0 F  S DA=$O(^PSRX("AM",PSDATE,RXN,DA)) Q:'DA  I $D(^PSRX(RXN,0)) D:$P($G(^PSRX(RXN,"P",DA,0)),"^",19)
"RTN","PSOAMIS0",80,0)
 .S RX0=^PSRX(RXN,0),RX2=^(2),PAT=$P(RX0,"^",2),ST=$P(RX0,"^",3),DRUG=$P(RX0,"^",6)
"RTN","PSOAMIS0",81,0)
 .S RXF=^PSRX(RXN,"P",DA,0),DIV=$S($P(RXF,"^",9):$P(RXF,"^",9),1:$P(RX2,"^",9))
"RTN","PSOAMIS0",82,0)
 .D PAR
"RTN","PSOAMIS0",83,0)
 ;
"RTN","PSOAMIS0",84,0)
 Q
"RTN","PSOAMIS0",85,0)
ORI1 Q:'$P(RX2,"^",13)
"RTN","PSOAMIS0",86,0)
 S RX=^PSRX(RXN,0),PHYS=+$P(RX,"^",4),DIV=$S($P(RX2,"^",9):$P(RX2,"^",9),1:$O(^PS(59,0)))
"RTN","PSOAMIS0",87,0)
 D SETNODE
"RTN","PSOAMIS0",88,0)
 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",14)=$P($G(^PS(59.1,$P(PSDATE,"."),1,DIV,0)),"^",14)+1
"RTN","PSOAMIS0",89,0)
 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S($P(RX,"^",11)="W":16,1:17))=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S($P(RX,"^",11)="W":16,1:17))+1
"RTN","PSOAMIS0",90,0)
 D SETUP
"RTN","PSOAMIS0",91,0)
 Q
"RTN","PSOAMIS0",92,0)
REF1 Q:'$P($G(^PSRX(RXN,1,DA,0)),"^",18)
"RTN","PSOAMIS0",93,0)
 S RXF=^PSRX(RXN,1,DA,0),DIV=$S($P(RXF,"^",9):$P(RXF,"^",9),1:DIV)
"RTN","PSOAMIS0",94,0)
PAR D SETNODE
"RTN","PSOAMIS0",95,0)
 S PHYS=$S($P(RXF,"^",17):+$P(RXF,"^",17),1:$P(RX0,"^",4))
"RTN","PSOAMIS0",96,0)
 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",15)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",15)+1
"RTN","PSOAMIS0",97,0)
 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S($P(RXF,"^",2)="W":16,1:17))=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S($P(RXF,"^",2)="W":16,1:17))+1
"RTN","PSOAMIS0",98,0)
 D SETUP
"RTN","PSOAMIS0",99,0)
 Q
"RTN","PSOAMIS0",100,0)
SETUP ;
"RTN","PSOAMIS0",101,0)
 I $P($G(^VA(200,PHYS,"PS")),"^",6)=4 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",11)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",11)+1
"RTN","PSOAMIS0",102,0)
 E  S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",12)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",12)+1
"RTN","PSOAMIS0",103,0)
 S STY=$P($G(^PS(53,ST,0)),"^",6)
"RTN","PSOAMIS0",104,0)
 S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S(STY=1:3,STY=2:5,STY=3:7,STY=4:2,STY=5:18,1:13))=+$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",$S(STY=1:3,STY=2:5,STY=3:7,STY=4:2,STY=5:18,1:13))+1
"RTN","PSOAMIS0",105,0)
 S NRC=$P($G(^PSDRUG(DRUG,0)),"^",3) I NRC["A"!(NRC["C") S $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",8)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",8)+1
"RTN","PSOAMIS0",106,0)
 S:DRUG=$G(METHAD(DIV)) $P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",9)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",9)+1
"RTN","PSOAMIS0",107,0)
 I '$D(^TMP("PSOAMIS",$J,DIV,$P(PSDATE,"."),PAT)) S ^TMP("PSOAMIS",$J,DIV,$P(PSDATE,"."),PAT)="",$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",10)=$P(^PS(59.1,$P(PSDATE,"."),1,DIV,0),"^",10)+1
"RTN","PSOAMIS0",108,0)
 Q
"RTN","PSOAMIS0",109,0)
SETNODE ;
"RTN","PSOAMIS0",110,0)
 I '$G(^PS(59.1,$P(PSDATE,"."),0)) D
"RTN","PSOAMIS0",111,0)
 .S (X,DINUM)=$P(PSDATE,"."),DIC="^PS(59.1,",DIC(0)="L" K DD,DO D FILE^DICN K DD,DO
"RTN","PSOAMIS0",112,0)
 .S ^PS(59.1,$P(PSDATE,"."),1,0)="^59.11PA^"
"RTN","PSOAMIS0",113,0)
 .F I=0:0 S I=$O(^PS(59,I)) Q:'I  S ^PS(59.1,$P(PSDATE,"."),1,I,0)=I_"^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0",^PS(59.1,$P(PSDATE,"."),1,"B",I,I)="" D
"RTN","PSOAMIS0",114,0)
 ..S $P(^PS(59.1,$P(PSDATE,"."),1,0),"^",3)=I,$P(^PS(59.1,$P(PSDATE,"."),1,0),"^",4)=($P(^PS(59.1,$P(PSDATE,"."),1,0),"^",4)+1)
"RTN","PSOAMIS0",115,0)
 Q
"RTN","PSOBGMGR")
0^4^B61535737^B52938533
"RTN","PSOBGMGR",1,0)
PSOBGMGR ;BHAM ISC/LC - BINGO BOARD MANAGER ;2/15/06 1:03pm
"RTN","PSOBGMGR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**12,232**;DEC 1997
"RTN","PSOBGMGR",3,0)
 ;
"RTN","PSOBGMGR",4,0)
 ;PSO*232 add check for bad ATIC xref and cleanup
"RTN","PSOBGMGR",5,0)
 ;
"RTN","PSOBGMGR",6,0)
CODE D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOBGMGR",7,0)
 S:$P($G(^PS(59,PSOSITE,1)),"^",20)'="" DGP=$P($G(^PS(59,PSOSITE,1)),"^",20)
"RTN","PSOBGMGR",8,0)
 G ERASE:$G(FLAG)=3,STOPIT:$G(FLAG)=2,DISP:$G(FLAG)=1
"RTN","PSOBGMGR",9,0)
TEST S DIK="^PS(52.11," F TEST=0:0 S TEST=$O(^PS(52.11,TEST)) Q:'TEST  D
"RTN","PSOBGMGR",10,0)
 .S TEST1=$P($P($G(^(TEST,0)),"^",5),".") I $G(TEST1)<DT S DA=TEST D ^DIK
"RTN","PSOBGMGR",11,0)
 K DIK,TEST,TEST1
"RTN","PSOBGMGR",12,0)
BEGI S ROLL=1,(ZV,ZH,PSOUT,FLG)=0 I $G(IOST(0))']"" W !,"Please check Device Type and try again" Q
"RTN","PSOBGMGR",13,0)
 S X="IODHLT;IODHLB;IORVOFF;IORVON" D ENDR^%ZISS S TOP=IODHLT,BOT=IODHLB,VOFF=IORVOFF,VON=IORVON K IODHLT,IODHLB,IORVOFF,IORVON,DIC
"RTN","PSOBGMGR",14,0)
 S:$G(DGP) DIC("B")=DGP S (DIC,DIE)=59.3,DIC(0)="AEQMZ" D ^DIC K DIC Q:+Y'>0  S (ADA,DA)=+Y
"RTN","PSOBGMGR",15,0)
 I $P($G(^PS(59.3,ADA,3)),"^")=1,'$G(^PS(59.3,ADA,"STOP")) W !,"Board has already been started!",$C(7) G END
"RTN","PSOBGMGR",16,0)
 S COLM=$P($G(^PS(59.3,ADA,3)),"^",5),DWT=$P($G(^(3)),"^",6),NWT=$P($G(^(3)),"^",7)
"RTN","PSOBGMGR",17,0)
 S FTX="PRESCRIPTIONS ARE READY FOR:"
"RTN","PSOBGMGR",18,0)
 S ^PS(59.3,ADA,"STOP")=0,STOP=0 S TCK=$P(^PS(59.3,ADA,0),"^",2) I $G(TCK)="T" D TICKDV G END
"RTN","PSOBGMGR",19,0)
 D DEV^PSOBGMG1 W:$G(NODV) !,"No device selected." G END
"RTN","PSOBGMGR",20,0)
ANAME G:$G(^PS(59.3,ADA,"STOP")) END H:ZV 20
"RTN","PSOBGMGR",21,0)
 I $P($G(^PS(59.3,ADA,3)),"^")=1&($P($G(^PS(59.3,ADA,3)),"^",4)'="") D
"RTN","PSOBGMGR",22,0)
 .D NOW^%DTC S:$E($P($G(%),".",2),1,4)'<$E($P($P($G(^PS(59.3,ADA,3)),"^",4),".",2),1,4) ^PS(59.3,ADA,"STOP")=1,STOP=1 D:STOP ASTOP^PSOBGMG2
"RTN","PSOBGMGR",23,0)
 D:$G(DWT) WAIT^PSOBGMG1
"RTN","PSOBGMGR",24,0)
 W @IOF F NOTE=0:0 S NOTE=$O(^PS(59.3,ADA,2,NOTE)) Q:'NOTE!($G(^PS(59.3,ADA,"STOP")))  S NOTES=^PS(59.3,ADA,2,NOTE,0) W !?2,TOP,NOTES,!?2,BOT,NOTES H 3
"RTN","PSOBGMGR",25,0)
 G:$G(^PS(59.3,ADA,"STOP")) END W @IOF
"RTN","PSOBGMGR",26,0)
 I $G(DWT) S DX=1,DY=1 X IOXY W TOP,TTX,!?1,BOT,TTX,!
"RTN","PSOBGMGR",27,0)
 S DX=1,DY=1 S:$G(DWT) DY=3 X IOXY W TOP,FTX S DY=DY+1 X IOXY W BOT,FTX,!
"RTN","PSOBGMGR",28,0)
 S ZH=$S($G(COLM):1,1:10),ZV=4 S:$G(DWT) ZV=6
"RTN","PSOBGMGR",29,0)
 S NAME="" F  S NAME=$O(^PS(52.11,"ANAM",ADA,NAME)) Q:""[NAME!($G(^PS(59.3,ADA,"STOP")))  D
"RTN","PSOBGMGR",30,0)
 .I '$G(COLM) D INDX^PSOBGMG1 I ZV>18 D
"RTN","PSOBGMGR",31,0)
 ..H 20 W @IOF I $G(DWT) S DX=1,DY=1 X IOXY W TOP,TTX,!?1,BOT,TTX,!
"RTN","PSOBGMGR",32,0)
 ..S DX=1,DY=1 S:$G(DWT) DY=3 X IOXY W TOP,FTX S DY=DY+1 X IOXY W BOT,FTX,! S ZV=4,ZH=10 S:$G(DWT) ZV=6
"RTN","PSOBGMGR",33,0)
 .I $G(COLM) D INDX^PSOBGMG1 I ZV>18,ZH>39 D
"RTN","PSOBGMGR",34,0)
 ..H 20 W @IOF I $G(DWT) S DX=1,DY=1 X IOXY W TOP,TTX,!?1,BOT,TTX,!
"RTN","PSOBGMGR",35,0)
 ..S DX=1,DY=1 S:$G(DWT) DY=3 X IOXY W TOP,FTX S DY=DY+1 X IOXY W BOT,FTX,! S ZV=4,ZH=1 S:$G(DWT) ZV=6
"RTN","PSOBGMGR",36,0)
 .I $G(COLM),ZH>39 S ZV=ZV+2,ZH=1
"RTN","PSOBGMGR",37,0)
 .S DX=ZH,DY=ZV X IOXY W TOP,$E(NAME,1,18) S DY=DY+1 X IOXY W BOT,$E(NAME,1,18),! S:'$G(COLM) ZV=ZV+2 S:$G(COLM) ZH=ZH+20 Q:$G(^PS(59.3,ADA,"STOP"))
"RTN","PSOBGMGR",38,0)
 G:$G(^PS(59.3,ADA,"STOP")) END Q:STOP  G ANAME
"RTN","PSOBGMGR",39,0)
TICKDV D DEV^PSOBGMG1 W:$G(NODV) !,"No device selected." G END
"RTN","PSOBGMGR",40,0)
TICKET G:$G(^PS(59.3,ADA,"STOP")) END H:ZV 20
"RTN","PSOBGMGR",41,0)
 I $P($G(^PS(59.3,ADA,3)),"^")=1&($P($G(^PS(59.3,ADA,3)),"^",4)'="") D
"RTN","PSOBGMGR",42,0)
 .D NOW^%DTC S:$E($P($G(%),".",2),1,4)'<$E($P($P($G(^PS(59.3,ADA,3)),"^",4),".",2),1,4) ^PS(59.3,ADA,"STOP")=1,STOP=1 D:STOP ASTOP^PSOBGMG2
"RTN","PSOBGMGR",43,0)
 D:$G(DWT) WAIT^PSOBGMG1
"RTN","PSOBGMGR",44,0)
 W @IOF F NOTE=0:0 S NOTE=$O(^PS(59.3,ADA,2,NOTE)) Q:'NOTE!($G(^PS(59.3,ADA,"STOP")))  S NOTES=^PS(59.3,ADA,2,NOTE,0) W !?2,TOP,NOTES,!?2,BOT,NOTES H 3
"RTN","PSOBGMGR",45,0)
 G:$G(^PS(59.3,ADA,"STOP")) END W @IOF
"RTN","PSOBGMGR",46,0)
 I $G(DWT) S DX=1,DY=1 X IOXY W TOP,TTX,!?1,BOT,TTX,!
"RTN","PSOBGMGR",47,0)
 S DX=1,DY=1 S:$G(DWT) DY=3 X IOXY W TOP,FTX S DY=DY+1 X IOXY W BOT,FTX,!
"RTN","PSOBGMGR",48,0)
 S ZH=$S($G(COLM):1,1:15),ZV=4 S:$G(DWT) ZV=6
"RTN","PSOBGMGR",49,0)
 S TICK="" F  S TICK=$O(^PS(52.11,"ATIC",ADA,TICK)) Q:'TICK!($G(^PS(59.3,ADA,"STOP")))  D
"RTN","PSOBGMGR",50,0)
 .;check for Bad records and kill orphaned xrefs             PSO*232
"RTN","PSOBGMGR",51,0)
 .I $$ATICCHK(ADA,TICK) Q
"RTN","PSOBGMGR",52,0)
 .I ZV>20 D
"RTN","PSOBGMGR",53,0)
 ..H 20 W @IOF I $G(DWT) S DX=1,DY=1 X IOXY W TOP,TTX,!?1,BOT,TTX,!
"RTN","PSOBGMGR",54,0)
 ..S DX=1,DY=1 S:$G(DWT) DY=3 X IOXY W TOP,FTX S DY=DY+1 X IOXY W BOT,FTX,! S ZV=4,ZH=$S($G(COLM):1,1:15) S:$G(DWT) ZV=6
"RTN","PSOBGMGR",55,0)
 .I $G(COLM),ZH>16 S ZV=ZV+2,ZH=1
"RTN","PSOBGMGR",56,0)
 .S DX=ZH,DY=ZV X IOXY W TOP,TICK S DY=DY+1 X IOXY W BOT,TICK,! S:'$G(COLM) ZV=ZV+2 S:$G(COLM) ZH=ZH+8
"RTN","PSOBGMGR",57,0)
 G:$G(^PS(59.3,ADA,"STOP")) END I '$G(COLM),ZV<6 H 20
"RTN","PSOBGMGR",58,0)
 I ($G(COLM))&(ZV<6)&(ZH<39) H 20
"RTN","PSOBGMGR",59,0)
 G TICKET
"RTN","PSOBGMGR",60,0)
STOPIT K DIC S:$G(DGP) DIC("B")=DGP S (DIC,DIE)=59.3,DIC(0)="AEQMZ" D ^DIC K DIC Q:+Y'>0  S (ADA,DA)=+Y
"RTN","PSOBGMGR",61,0)
 I $G(^PS(59.3,ADA,"STOP")) W !!,$C(7),"Board has already been stopped."
"RTN","PSOBGMGR",62,0)
 I  S DIR("A")="Do you want to purge the remaining entries for this display group",DIR(0)="YO",DIR("B")="N" D ^DIR K DIR G:$G(DIRUT) STOPEX G:Y PRG I 'Y W !!,"No data purged." G STOPEX
"RTN","PSOBGMGR",63,0)
 S ^PS(59.3,ADA,"STOP")=1,STOP=1 W !!,"Board Stopped!!",!!
"RTN","PSOBGMGR",64,0)
CNT S CNT1=0 F CNT=0:0 S CNT=$O(^PS(52.11,CNT)) Q:'CNT  S:$P($G(^PS(52.11,CNT,0)),"^",3)=ADA CNT1=CNT1+1
"RTN","PSOBGMGR",65,0)
 I 'CNT1 W !!,"There are no entries to purge from the display group.",! G STOPEX
"RTN","PSOBGMGR",66,0)
 W !!,$C(7),CNT1," entries still remain in the display group.",!
"RTN","PSOBGMGR",67,0)
PRG K DIR S DIR(0)="YO",DIR("A")="Purge this display's data now",DIR("B")="N" D ^DIR K DIR G:$D(DIRUT) STOPEX I 'Y W !!,"No data purged." G STOPEX
"RTN","PSOBGMGR",68,0)
 W !!,"Purging data. Please wait."
"RTN","PSOBGMGR",69,0)
 S DIK="^PS(52.11,",DA=0 F  S DA=$O(^PS(52.11,DA)) Q:'DA  D:$P($G(^PS(52.11,DA,0)),"^",3)=ADA ^DIK
"RTN","PSOBGMGR",70,0)
 W "   Purge complete!",!
"RTN","PSOBGMGR",71,0)
STOPEX K ADA,AS,CNT,CNT1,DA,DIK,DIRUT,FLAG,STOP,Y Q
"RTN","PSOBGMGR",72,0)
DISP W !! K DIC,DA,DR
"RTN","PSOBGMGR",73,0)
 S (DIC,DIE,DLAYGO)=59.3,DIC(0)="AELQMZ" D ^DIC K DIC G:+Y'>0 DISPEX S (ADA,DA)=+Y I $G(^PS(59.3,ADA,"STOP"))=0 W !!,$C(7),"This display group has been started.",!,"It must be stopped before you can edit it." G DISPEX
"RTN","PSOBGMGR",74,0)
 W !! S DR="[PSO DISPLAY EDIT]",DIE("NO^")="BACKOUTOK" L +^PS(59.3,DA):0 G:'$T DISPEX1
"RTN","PSOBGMGR",75,0)
 D ^DIE G:'$D(DA) DISP L -^PS(59.3,DA) G:'$D(^PS(59.3,DA,2,0)) DISP G:$G(DIRUT) DISPEX1
"RTN","PSOBGMGR",76,0)
 ;
"RTN","PSOBGMGR",77,0)
 I '$D(Y),$P($G(^PS(59.3,DA,0)),"^",4),$P($G(^PS(59.3,DA,3)),"^") K DIR S DIR(0)="Y",DIR("A")="Do you want to initialize auto-start now",DIR("B")="NO" D ^DIR K DIR G:$D(DIRUT) DISPEX1 S EDT=Y
"RTN","PSOBGMGR",78,0)
 I $G(EDT) D STRTM^PSOBGMG2 G:'$G(EDT) DISPEX1 D INIJ^PSOBGMG2
"RTN","PSOBGMGR",79,0)
DISPEX1 K EDT,DIE,DIR,DR Q
"RTN","PSOBGMGR",80,0)
 ;
"RTN","PSOBGMGR",81,0)
ATICCHK(DV,TK) ;check ATIC xref if points to non-existent recs, then cleanup
"RTN","PSOBGMGR",82,0)
 ; Return 0 - if no cleanup
"RTN","PSOBGMGR",83,0)
 ;        1 - if had to cleanup
"RTN","PSOBGMGR",84,0)
 ;       
"RTN","PSOBGMGR",85,0)
 Q:($G(DV)="")!($G(TK)="") 0
"RTN","PSOBGMGR",86,0)
 N QT,P52 S P52=$O(^PS(52.11,"ATIC",DV,TK,"")),QT=0
"RTN","PSOBGMGR",87,0)
 ;if record pointed to is no longer on file (probably deleted),
"RTN","PSOBGMGR",88,0)
 ;then insure no orphanned xrefs
"RTN","PSOBGMGR",89,0)
 I '$D(^PS(52.11,P52)) D  S QT=1
"RTN","PSOBGMGR",90,0)
 . K ^PS(52.11,"ATIC",DV,TK,P52)
"RTN","PSOBGMGR",91,0)
 . K ^PS(52.11,"ANAMK",P52)
"RTN","PSOBGMGR",92,0)
 . K ^PS(52.11,"ANAM",DV,TK,P52)
"RTN","PSOBGMGR",93,0)
 . K ^PS(52.11,"C",TK,P52)
"RTN","PSOBGMGR",94,0)
 . K ^PS(52.11,"AD",DV,P52)
"RTN","PSOBGMGR",95,0)
 . N PA,PAI
"RTN","PSOBGMGR",96,0)
 . S PA="" F  S PA=$O(^PS(52.11,"ANAM",DV,PA)) Q:PA=""  D
"RTN","PSOBGMGR",97,0)
 . . S PAI="" F  S PAI=$O(^PS(52.11,"ANAM",DV,PA,PAI)) Q:PAI=""  D
"RTN","PSOBGMGR",98,0)
 . . . I PAI=P52 K ^PS(52.11,"ANAM",DV,PA,PAI)
"RTN","PSOBGMGR",99,0)
 Q QT
"RTN","PSOBGMGR",100,0)
 ;
"RTN","PSOBGMGR",101,0)
TEXT ;display text about setting up dedicated device
"RTN","PSOBGMGR",102,0)
 W !!,"In order to automatically start and stop the bingo board monitor,"
"RTN","PSOBGMGR",103,0)
 W !,"a dedicated device must be setup by your IRM Service.",!!
"RTN","PSOBGMGR",104,0)
 W "Once a dedicated device is setup, the bingo board can be scheduled"
"RTN","PSOBGMGR",105,0)
 W !,"to automatically start and/or stop at user-defined times."
"RTN","PSOBGMGR",106,0)
 W !!,"Enter 'NO' at the DISPLAY SETUP HELP TEXT prompt to not display this help text.",!
"RTN","PSOBGMGR",107,0)
 Q
"RTN","PSOBGMGR",108,0)
 ;
"RTN","PSOBGMGR",109,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=40,DIWF="C40" F NODE=0:0 S NODE=$O(^PS(59.3,DA,2,NODE)) Q:'NODE  S X=^(NODE,0) D ^DIWP
"RTN","PSOBGMGR",110,0)
 F NODE=0:0 S NODE=$O(^UTILITY($J,"W",1,NODE)) Q:'NODE  S NODE1=^(NODE,0) S ^PS(59.3,DA,2,NODE,0)=NODE1,$P(^PS(59.3,DA,2,0),"^",3)=NODE,$P(^(0),"^",4)=NODE S LNODE=NODE
"RTN","PSOBGMGR",111,0)
 N LAST F NODE=0:0 S NODE=$O(^PS(59.3,DA,2,NODE)) Q:'NODE  S LAST=NODE
"RTN","PSOBGMGR",112,0)
 I LAST>LNODE S DA(1)=DA,DIK="^PS(59.3,"_DA(1)_",2,",DA=LNODE F  S DA=$O(^PS(59.3,DA(1),2,DA)) Q:'DA  D ^DIK
"RTN","PSOBGMGR",113,0)
 G DISP
"RTN","PSOBGMGR",114,0)
DISPEX K ADA,DA,FLAG,LAST,LNODE,NODE,NODE1,^UTILITY($J,"W"),X,Y Q
"RTN","PSOBGMGR",115,0)
ERASE S REC=$O(^PS(52.11,0)) I 'REC W !!,"All data has been purged!" K REC Q
"RTN","PSOBGMGR",116,0)
 W !! K DIR S DIR("A")="Purge patient data for all or a specific display group",DIR(0)="SBO^A:All display groups;S:Specific display group"
"RTN","PSOBGMGR",117,0)
 S DIR("?")="Enter 'A' to delete all patient data from all display groups.",DIR("?",1)="Enter 'S' to delete all patient data from a specific display group." D ^DIR K DIR G:$G(DIRUT) END1 S AS=Y K Y
"RTN","PSOBGMGR",118,0)
 S:$G(DGP) DIC("B")=DGP
"RTN","PSOBGMGR",119,0)
 G:AS="A" ALL S DIC=59.3,DIC(0)="AEQMZ" D ^DIC K DIC G:+Y'>0 ERASE S ADA=+Y K Y D CNT G ERASE
"RTN","PSOBGMGR",120,0)
ALL W !!,$C(7),"*** THIS WILL PURGE ALL BINGO BOARD PATIENT DATA FOR ALL DISPLAY GROUPS. ***",!!
"RTN","PSOBGMGR",121,0)
 S DIR(0)="YO",DIR("A")="Purge now",DIR("B")="N" D ^DIR K DIR G:$G(DIRUT) ERASE W:Y !!,"Purging data.  Please wait..." I 'Y W !!,"No data purged!" G ERASE
"RTN","PSOBGMGR",122,0)
PUR S DIK="^PS(52.11,",DA=0 F  S DA=$O(^PS(52.11,DA)) Q:'DA  D ^DIK
"RTN","PSOBGMGR",123,0)
 K DIR,DIK,DA W "   Purge complete.",! G ERASE
"RTN","PSOBGMGR",124,0)
END S ZTREQ="@" I $G(ADA)'="" S:$G(^PS(59.3,ADA,"STOP")) STOP=1
"RTN","PSOBGMGR",125,0)
END1 K ADA,AGROUP,BIG,BIGO,BOT,CNT,CNT1,DA,DGP,DR,FLAG,GROUP,NOTE,NAME,NOTES,PSOUT,ROLL,TICK,TOP,X,X1,Y,ZV,ZH,TCK,FTX,COLM,DIWF,DIWL,DIWR,FLG,VOFF,VON
"RTN","PSOBGMGR",126,0)
 K %,%ZIS,AWT,AWT1,AWT2,BBH,BBM,DEV,DLAYGO,DTOUT,DV,DWT,DX,DY,EN,IOXY,NTXT,NUM,NWT,POP,TASK,TTX,WTT
"RTN","PSOBGMGR",127,0)
 I $G(STOP) K STOP W @IOF D ^%ZISC G H^XUS
"RTN","PSOBGMGR",128,0)
 K STOP Q
"RTN","PSOBINGO")
0^3^B61437280^B56797156
"RTN","PSOBINGO",1,0)
PSOBINGO ;BHAM ISC/LC - BINGO BOARD OPTION DRIVER ;1/18/06 9:09am
"RTN","PSOBINGO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**12,28,56,125,152,232**;DEC 1997
"RTN","PSOBINGO",3,0)
 ;External Ref. to ^PS(55 is supp. by DBIA# 2228
"RTN","PSOBINGO",4,0)
 ;External Ref. to ^PSDRUG(, is supp. by DBIA# 221
"RTN","PSOBINGO",5,0)
 ;
"RTN","PSOBINGO",6,0)
 ;PSO*7*232 add ATIC xref set/kill code here
"RTN","PSOBINGO",7,0)
 ;
"RTN","PSOBINGO",8,0)
 S (FLAG,FLAG1)=0,(TRIPS,JOES,ADV,DGP)="" G:'$G(PSOAP) END D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOBINGO",9,0)
BEG ;PSOAP=1 NEW ENTRY; 2=DISPLAY; 3=REMOVE
"RTN","PSOBINGO",10,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) G:PSOAP=1 NEW I PSOAP=3 D BCRMV^PSOBING1 G:'$D(X) END
"RTN","PSOBINGO",11,0)
 I PSOAP=3 S DIC=52.11,DIC(0)="EMQZ",DIC("S")="I '$P($G(^PS(52.11,Y,0)),U,8)" D ^DIC K DIC G:+Y'>0 BEG G:($G(DTOUT))!($G(DUOUT)) END S DA=+Y,NAM=Y(0,0)
"RTN","PSOBINGO",12,0)
 I PSOAP=2 W !! K DIC,DIE,DLAYGO S (DIC,DIE)=52.11,DIC(0)="AEMQZ",DIC("A")="Enter Patient Name to Display: ",DIC("S")="I $P($G(^PS(52.11,Y,0)),U,4)=PSOSITE&'$P($G(^PS(52.11,Y,0)),U,7)"
"RTN","PSOBINGO",13,0)
 I PSOAP=2 D ^DIC K DIC G:+Y'>0!($G(DTOUT))!($G(DUOUT)) END S (DA,ODA)=+Y,NAM=Y(0,0)
"RTN","PSOBINGO",14,0)
 I PSOAP=3 D STUF,REMOVE1 G BEG
"RTN","PSOBINGO",15,0)
 I PSOAP=2,($P($G(^PS(52.11,DA,0)),"^",7)]"") W !!,NAM,"  is already in the display queue.",$C(7) G BEG
"RTN","PSOBINGO",16,0)
 I PSOAP=2,$P($P($G(^PS(52.11,DA,0)),"^",5),".")'=DT S Y=$P($P($G(^PS(52.11,DA,0)),"^",5),".") D DD^%DT W !!,$C(7),NAM," was entered on "_Y_".",!,"It can't be displayed and is now deleted." S DIK="^PS(52.11," D ^DIK K DIK G BEG
"RTN","PSOBINGO",17,0)
 I PSOAP=2&($P(^PS(52.11,ODA,0),"^",4)'=+PSOSITE) W !!,$C(7),NAM," was entered under the "_$P(^PS(59,$P(^(0),"^",4),0),"^")_" division." G BEG
"RTN","PSOBINGO",18,0)
 I PSOAP=2 S PSODRF=0 D CREF^PSOBING1 G:PSODRF BEG D  G BEG
"RTN","PSOBINGO",19,0)
 .S NM=$P(^DPT($P(^PS(52.11,ODA,0),"^"),0),"^"),DR="6////"_$E(TM1_"0000",1,4)_";8////"_NM_""
"RTN","PSOBINGO",20,0)
 .D PASS,SETUP S DA=ODA D STATS1^PSOBRPRT,WTIME^PSOBING1
"RTN","PSOBINGO",21,0)
NEW ;Init lookup
"RTN","PSOBINGO",22,0)
 W !! K DIC S DIC=2,DIC(0)="AEMQZ",DIC("A")="Enter Patient Name : " D ^DIC K DIC G:Y<0!($G(DUOUT))!($G(DTOUT)) END S (DA,ADA,DFN)=+Y D DEM^VADPT Q:VAERR  S NAM=VADM(1),SSN=$P(VADM(2),"^")
"RTN","PSOBINGO",23,0)
 K DD,DO S:$D(DISGROUP) DGP=$P($G(^PS(59.3,DISGROUP,0)),"^") S (DIC,DIE)="^PS(52.11,",X=ADA,DIC("DR")=$S($G(GROUPCNT)=1&($G(DISGROUP)):"2////"_DISGROUP_"",1:"2//^S X=DGP")
"RTN","PSOBINGO",24,0)
 S DIC(0)="LMNQZ",DLAYGO=59.3 D FILE^DICN K DD,DO,DIC G:Y'>0 NEW
"RTN","PSOBINGO",25,0)
 S JOES=$P(Y(0),"^",3),ADV=$P($G(^PS(59.3,JOES,0)),"^",2),DA=+Y
"RTN","PSOBINGO",26,0)
 I $G(DTOUT)!($G(DUOUT))!(X="") D WARN G NEW
"RTN","PSOBINGO",27,0)
TIC K TFLAG I ADV="T" S DIR(0)="NA^1:999999:0",DIR("A")="TICKET #:",DIR("?")="Ticket # must be numeric and unique" D ^DIR I $D(DUOUT)!($D(DTOUT))!($D(DIRUT)) D WARN G BEG
"RTN","PSOBINGO",28,0)
 S TFLAG=1 I PSOAP=1,$G(ADV)="T" W !! S TIC=+Y D
"RTN","PSOBINGO",29,0)
 .F TIEN=0:0 S TIEN=$O(^PS(52.11,"C",TIC,TIEN)) Q:'TIEN  I DA'=TIEN,($G(PSOSITE)=+$P(^PS(52.11,TIEN,0),"^",4)) D
"RTN","PSOBINGO",30,0)
 ..S TDFN=$P(^PS(52.11,TIEN,0),"^"),TSSN=$P(^PS(52.11,TIEN,1),"^",2),TFLAG=0 W !,$C(7),$P(^DPT(TDFN,0),"^")_" ("_TSSN_") was issued ticket # "_TIC,". Try again!",!
"RTN","PSOBINGO",31,0)
 .K TDFN,TIEN,TSSN Q:'TFLAG
"RTN","PSOBINGO",32,0)
 G:'TFLAG TIC I ADV="T" S DR="1////"_TIC_";3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////0",FLAG1=1 G PASS
"RTN","PSOBINGO",33,0)
 S DR="3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////0"
"RTN","PSOBINGO",34,0)
PASS S NFLAG=1 L +^PS(52.11,DA):2 E  W !!,$C(7),Y(0,0)," is being edited!",! Q
"RTN","PSOBINGO",35,0)
 D ^DIE L -^PS(52.11,DA) I $G(DUOUT)!($G(DTOUT))!(X="") D WARN G BEG
"RTN","PSOBINGO",36,0)
 S:$G(PSOAP)=1 FLGG=0 G:$G(PSOAP)'=1 STRX1
"RTN","PSOBINGO",37,0)
STRX ;sto Rx #'s IN 52.11
"RTN","PSOBINGO",38,0)
 N BRXNUM,BBFTYP,BBFNUM,BBMW,MWDIR,II,FL,FLN,PR,PRN,PRNDT,FLNDT,Y
"RTN","PSOBINGO",39,0)
STRX0 S DIR(0)="FO^1:11",DIR("A")="Enter Rx #",DIR("?")="^D HELP^PSOBINGO",DIR("??")="^D HELP2^PSOBINGO" D ^DIR G:X=""&($G(FLGG)) STRX1 I $D(DIRUT) D WARN G BEG
"RTN","PSOBINGO",40,0)
 S DIC=52,DIC(0)="EQM",DIC("S")="I $P($G(^PSRX(Y,0)),U,2)=ADA" D ^DIC K DIC I $D(DUOUT)!($D(DTOUT)) D WARN G BEG
"RTN","PSOBINGO",41,0)
 G:Y=-1 STRX0
"RTN","PSOBINGO",42,0)
 I $G(Y)<0&('$G(FLGG)) D WARN G BEG
"RTN","PSOBINGO",43,0)
 I $G(Y)<0&($G(FLGG)) G STRX1
"RTN","PSOBINGO",44,0)
 S BRXNUM=$P(Y,"^")
"RTN","PSOBINGO",45,0)
 I $D(^PSRX(BRXNUM,1,0)) F II=0:0 S II=$O(^PSRX(BRXNUM,1,II)) Q:'II  S FLN=II
"RTN","PSOBINGO",46,0)
 I $D(FLN) S FLNDT=$P(^PSRX(BRXNUM,1,FLN,0),"^"),FL="F"
"RTN","PSOBINGO",47,0)
 I $D(^PSRX(BRXNUM,"P",0)) F II=0:0 S II=$O(^PSRX(BRXNUM,"P",II)) Q:'II  S PRN=II
"RTN","PSOBINGO",48,0)
 I $D(PRN) S PRNDT=$P(^PSRX(BRXNUM,"P",PRN,0),"^"),PR="P"
"RTN","PSOBINGO",49,0)
 S:$D(FLN)!($D(PRN)) BBFTYP=$S($G(PRNDT)>$G(FLNDT):PR,1:"F")
"RTN","PSOBINGO",50,0)
 I $G(BBFTYP)="P" S BBFNUM=PRN,BBMW=$P(^PSRX(BRXNUM,"P",PRN,0),"^",2)
"RTN","PSOBINGO",51,0)
 I $G(BBFTYP)="F" S BBFNUM=FLN,BBMW=$P(^PSRX(BRXNUM,1,FLN,0),"^",2)
"RTN","PSOBINGO",52,0)
 I '$D(BBFTYP) S BBFTYP="F",BBFNUM=0,BBMW=$P(^PSRX(BRXNUM,0),"^",11)
"RTN","PSOBINGO",53,0)
MW ;
"RTN","PSOBINGO",54,0)
 I $G(BBMW)="M" W !?5,$C(7),"Routing is set for Mail" D DIR
"RTN","PSOBINGO",55,0)
 I $D(MWDIR) K BRXNUM,BBFTYP,BBFNUM,BBMW,MWDIR,II,FL,FLN,PR,PRN,PRNDT,FLNDT,Y G STRX
"RTN","PSOBINGO",56,0)
 ;
"RTN","PSOBINGO",57,0)
 S X=BRXNUM,DIC("DR")="1////"_BBFTYP_";2////"_BBFNUM_"",DLAYGO=52.11
"RTN","PSOBINGO",58,0)
 S DA(1)=DA,DIC="^PS(52.11,"_DA(1)_",2,",DIC(0)="L",DIC("P")=$P(^DD(52.11,12,0),"^",2) K DD,DO D FILE^DICN K Y,DD,DO,X,BRXNUM,BBFTYP,BBFNUM,II,FL,PR,PRNDT,FLNDT S FLGG=1 G STRX
"RTN","PSOBINGO",59,0)
 ;
"RTN","PSOBINGO",60,0)
STRX1 D:PSOAP=1&($G(ADV)="N") CHKUP,NOTE G:'NFLAG BEG D STUF G:FLAG BEG Q:PSOAP=2
"RTN","PSOBINGO",61,0)
SETUP S ZZZ=0 I '$D(^PS(59.2,DT,0)) K DD,DIC,DO,DA S X=DT,DIC="^PS(59.2,",DIC(0)="",DINUM=X,DLAYGO=59.2 D FILE^DICN K DD,DO S ZZZ=1 Q:Y'>0
"RTN","PSOBINGO",62,0)
 I ZZZ=1 K DD,DO S DLAYGO=59.2,DA(1)=+Y,DIC=DIC_DA(1)_",1,",(DINUM,X)=PSOSITE,DIC(0)="",DIC("P")=$P(^DD(59.2,1,0),"^",2) D FILE^DICN K DD,DO,DIC,DA Q:Y'>0
"RTN","PSOBINGO",63,0)
 Q:PSOAP=2&($P($G(^PS(59.2,DT,1,PSOSITE,0)),"^"))  I ZZZ=0 K DD,DIC,DO,DA S DA(1)=DT,(DINUM,X)=PSOSITE,DIC="^PS(59.2,"_DT_",1,",DIC(0)="LZ",DLAYGO=59.2 D FILE^DICN K DD,DIC,DA,DO Q:PSOAP=2  G NEW
"RTN","PSOBINGO",64,0)
 G BEG
"RTN","PSOBINGO",65,0)
STUF S RX0=^PS(52.11,DA,0),JOES=$P(RX0,"^",4),TICK=$P($G(RX0),"^",2) Q:PSOAP=3  G:ADV="T"&($G(FLAG1)=1)&('$G(TICK)) WARN G:'$G(JOES)!($G(NAM)']"") WARN
"RTN","PSOBINGO",66,0)
 W:PSOAP=2 !!,"Patient added in display queue." W:PSOAP=1 !!,"Record is added." Q
"RTN","PSOBINGO",67,0)
WARN W !!!,$C(7),"Patient record incomplete!" S FLAG=1,DIK="^PS(52.11," D ^DIK G SHOW Q
"RTN","PSOBINGO",68,0)
REMOVE S DIK="^PS(52.11," D ^DIK
"RTN","PSOBINGO",69,0)
SHOW K DIK,DA,ADA W !!,"Record is removed."
"RTN","PSOBINGO",70,0)
 Q
"RTN","PSOBINGO",71,0)
REMOVE1 ;
"RTN","PSOBINGO",72,0)
 Q:'$D(^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA))
"RTN","PSOBINGO",73,0)
 N DIE,DR I $D(^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)) S DIE="^PS(52.11,",DR="7////1" D
"RTN","PSOBINGO",74,0)
 .D ^DIE
"RTN","PSOBINGO",75,0)
 .K ^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)
"RTN","PSOBINGO",76,0)
 I $D(^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)) S DIE="^PS(52.11,",DR="7////1" D
"RTN","PSOBINGO",77,0)
 .D ^DIE
"RTN","PSOBINGO",78,0)
 .K ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)
"RTN","PSOBINGO",79,0)
 Q
"RTN","PSOBINGO",80,0)
CHKUP ;Multi & dupe names
"RTN","PSOBINGO",81,0)
 S SDA=DA S:'$D(DFN) DFN=PSODFN G:$O(^PS(52.11,"B",DFN,0))=DA BROW F P=0:0 S P=$O(^PS(52.11,"B",DFN,P)) Q:'P!(P=DA)  S LAST=P
"RTN","PSOBINGO",82,0)
 Q:'$G(LAST)  S TRIPS=$P($G(^PS(52.11,LAST,1)),"^",4) I TRIPS]"" S TRIPS=$A(TRIPS),TRIPS=TRIPS+1,TRIPS=$C(TRIPS) S DR="11////"_TRIPS_"" D ^DIE S F1=1 G BROW
"RTN","PSOBINGO",83,0)
 K TRIPS
"RTN","PSOBINGO",84,0)
FIRST ;Set 1st dup
"RTN","PSOBINGO",85,0)
 S DR="11////A" D ^DIE K DR,CNT
"RTN","PSOBINGO",86,0)
BROW S DA=SDA,NOPE=0,CNT=0 F NIEN=0:0 S NIEN=$O(^PS(52.11,"BA",NAM,NIEN)) Q:'NIEN!(NIEN=$G(DA))  D:$D(^PS(52.11,"BI")) BICK Q:CNT>0  D SETNEW Q:NOPE
"RTN","PSOBINGO",87,0)
 Q
"RTN","PSOBINGO",88,0)
SETNEW S SSN1=$O(^PS(52.11,"BA",NAM,NIEN,0)),ADFN=$P(^PS(52.11,NIEN,0),"^"),CNT=1 I SSN1=SSN S NOPE=1 Q
"RTN","PSOBINGO",89,0)
 S DR="10////1" D ^DIE S F1=1 Q
"RTN","PSOBINGO",90,0)
BICK ;Chks "BI" Xref & assigns seq#
"RTN","PSOBINGO",91,0)
 S SSN1=$O(^PS(52.11,"BA",NAM,NIEN,0)) I SSN1=SSN&('$P($G(^PS(52.11,SDA,1)),"^",3)) S NOPE=1 Q
"RTN","PSOBINGO",92,0)
 S CNT=0 I $D(^PS(52.11,"BI",DFN)) S CNT=$O(^(DFN,0)),DA=SDA,DR="10////"_CNT_"" D ^DIE S F1=1 Q
"RTN","PSOBINGO",93,0)
 F NDFN=0:0 S NDFN=$O(^PS(52.11,"BI",NDFN)) Q:'NDFN  S CNT=$O(^(NDFN,0))+1
"RTN","PSOBINGO",94,0)
 S DR="10////"_CNT_"" D ^DIE S F1=1 Q
"RTN","PSOBINGO",95,0)
NOTE S DFN=$P($G(^PS(52.11,DA,0)),"^"),NFLAG=1 W !!,?5,"NAME",?30,"SSN",?45,"ID",?50,"ORDER"
"RTN","PSOBINGO",96,0)
 F Z=0:0 S Z=$O(^PS(52.11,"B",DFN,Z)) Q:'Z  S ZDA=Z S NODE=$G(^PS(52.11,ZDA,1)),Z1=$P(NODE,"^"),Z2=$P(NODE,"^",3),Z3=$P(NODE,"^",4),Z4=$P(NODE,"^",2) W:NODE'="" !,?5,Z1,?30,Z4,?46,Z2,?52,Z3
"RTN","PSOBINGO",97,0)
 W !! S DIR(0)="F,O",DIR("A")="Press return to add the last prescription or '^' to remove it."
"RTN","PSOBINGO",98,0)
 S DIR("A",1)="Please advise the patient that the above ID # or ORDER Letter",DIR("A",2)="or both will be displayed with his/her name on the Bingo Display",DIR("A",3)=" "
"RTN","PSOBINGO",99,0)
 D ^DIR K DIR K NODE,Z1,Z2,Z3 I $G(DTOUT)!(Y="^") S NFLAG=0 D REMOVE
"RTN","PSOBINGO",100,0)
 Q
"RTN","PSOBINGO",101,0)
DIR K DIR,X,Y S DIR(0)="Y",DIR("A")="Continue ",DIR("B")="N",DIR("?")="Answer YES to continue, NO to bypass"
"RTN","PSOBINGO",102,0)
 D ^DIR K DIR S:$D(DIRUT)!('Y) MWDIR=1 K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSOBINGO",103,0)
 Q
"RTN","PSOBINGO",104,0)
HELP2 S (PA,PD)="",PL=0 F  S PA=$O(^PS(55,ADA,"P","A",PA)) Q:'PA  D:DT-1<PA
"RTN","PSOBINGO",105,0)
 .F  S PD=$O(^PS(55,ADA,"P","A",PA,PD)) Q:'PD  S PL=PL+1 W !,$P(^PSRX(PD,0),"^"),"      ",$P(^PSDRUG($P(^PSRX(PD,0),"^",6),0),"^")
"RTN","PSOBINGO",106,0)
 .I $G(PL)>15 N DIR S DIR(0)="E",DIR("A")="Press return to continue" D ^DIR K DIR S PL=0
"RTN","PSOBINGO",107,0)
 Q
"RTN","PSOBINGO",108,0)
HELP W !,"Enter the patient's Rx number.",!
"RTN","PSOBINGO",109,0)
 Q
"RTN","PSOBINGO",110,0)
ATICSET ;Set ATIC xref                                                PSO*232
"RTN","PSOBINGO",111,0)
 Q:'+$P(^PS(52.11,DA,0),"^",3)
"RTN","PSOBINGO",112,0)
 Q:'+$P(^PS(52.11,DA,0),"^",2)
"RTN","PSOBINGO",113,0)
 I $P(^PS(59.3,$P(^PS(52.11,DA,0),"^",3),0),"^",2)["T" D
"RTN","PSOBINGO",114,0)
 .S ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)=""
"RTN","PSOBINGO",115,0)
 Q
"RTN","PSOBINGO",116,0)
ATICKIL ;Kill ATIC xref                                               PSO*232
"RTN","PSOBINGO",117,0)
 Q:'+$P(^PS(52.11,DA,0),"^",3)
"RTN","PSOBINGO",118,0)
 Q:'+$P(^PS(52.11,DA,0),"^",2)
"RTN","PSOBINGO",119,0)
 I $P(^PS(59.3,$P(^PS(52.11,DA,0),"^",3),0),"^",2)["T" D
"RTN","PSOBINGO",120,0)
 .K ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)
"RTN","PSOBINGO",121,0)
 Q
"RTN","PSOBINGO",122,0)
 ;
"RTN","PSOBINGO",123,0)
END K %,ADA,ADFN,ADV,CNT,DA,DATE,DFN,DINUM,DLAYGO,DR,DTOUT,DUOUT,F1,FLAG,FLAG1,FLGG,JOES,LAST,NAM,NDFN,NIEN,NFLAG,NODE,NOPE,NM
"RTN","PSOBINGO",124,0)
 K PSODRF,ODA,P,PSOAP,RX0,TM,TM1,SDA,SSN,SSN1,RX0,TIC,TICK,TFLAG,VADM,X,Y,Z,Z1,Z2,Z3,Z4,ZDA,ZZZ,PL,PD,PA
"RTN","PSOBINGO",125,0)
 Q
"RTN","PSOHLDS1")
0^1^B47619875^B45320539
"RTN","PSOHLDS1",1,0)
PSOHLDS1 ;BIR/LC,PWC-Build HL7 Segments for Automated Interface ; 5/19/06 12:52pm
"RTN","PSOHLDS1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**156,232**;DEC 1997
"RTN","PSOHLDS1",3,0)
 ;HLFNC       supp. by DBIA 10106
"RTN","PSOHLDS1",4,0)
 ;PSNAPIS     supp. by DBIA 2531
"RTN","PSOHLDS1",5,0)
 ;VASITE      supp. by DBIA 10112
"RTN","PSOHLDS1",6,0)
 ;VADPT       supp. by DBIA 10061
"RTN","PSOHLDS1",7,0)
 ;EN^DIQ1     supp. by DBIA 100
"RTN","PSOHLDS1",8,0)
 ;EN^VAFHLPID supp. by DBIA 263
"RTN","PSOHLDS1",9,0)
 ;EN^VAFHLZTA supp. by DBIA 758
"RTN","PSOHLDS1",10,0)
 ;PSDRUG      supp. by DBIA 221
"RTN","PSOHLDS1",11,0)
 ;PS(50.7     supp. by DBIA 2223
"RTN","PSOHLDS1",12,0)
 ;PS(50.606   supp. by DBIA 2174
"RTN","PSOHLDS1",13,0)
 ;PS(50.607   supp. by DBIA 2221
"RTN","PSOHLDS1",14,0)
 ;PS(51.2     supp. by DBIA 2226
"RTN","PSOHLDS1",15,0)
 ;PS(55       supp. by DBIA 2228
"RTN","PSOHLDS1",16,0)
 ;PSNDF(50.6  supp. by DBIA 2195
"RTN","PSOHLDS1",17,0)
 ;DIC(5       supp. by DBIA 10056
"RTN","PSOHLDS1",18,0)
 ;DPT         supp. by DBIA 3097
"RTN","PSOHLDS1",19,0)
 ;SC          supp. by DBIA 10040
"RTN","PSOHLDS1",20,0)
 ;VA(200      supp. by DBIA 10060
"RTN","PSOHLDS1",21,0)
 ;SCMSVUT5    supp. by DBIA 4347
"RTN","PSOHLDS1",22,0)
 ;BLDPID^VAFCQRY supp. by DBIA 3630
"RTN","PSOHLDS1",23,0)
 ;MAKEIT^VAFHLU  supp. by DBIA 4346
"RTN","PSOHLDS1",24,0)
 ;
"RTN","PSOHLDS1",25,0)
 ;PSO*232 allow for Do Not Mail
"RTN","PSOHLDS1",26,0)
 ;
"RTN","PSOHLDS1",27,0)
START ;
"RTN","PSOHLDS1",28,0)
 D GETDATA
"RTN","PSOHLDS1",29,0)
 D PID(.PSI),PV1(.PSI),PV2(.PSI),IAM^PSOHLDS4(.PSI),ORC^PSOHLDS4(.PSI)
"RTN","PSOHLDS1",30,0)
 D NTE^PSOHLDS2,RXE^PSOHLDS2(.PSI),RXD^PSOHLDS2(.PSI)
"RTN","PSOHLDS1",31,0)
 D NTEPMI^PSOHLDS2(.PSI),RXR^PSOHLDS2(.PSI)
"RTN","PSOHLDS1",32,0)
 ; clean up data set by GETDATA
"RTN","PSOHLDS1",33,0)
 K EBY,EBY1,EFDT,EXDT,FDT,PVDR,PVDR1,CSINER,CSINER1,SITE,SITADD,SITPHN
"RTN","PSOHLDS1",34,0)
 K VPHARMID,VPHARM,DEAID,MW,QTY,DASPLY,OLAN,OTHLAN,PRIORDT,RFRM,NFLD,WARN
"RTN","PSOHLDS1",35,0)
 K PSOXN,PSOXN2,PSND1,PSND2,PRODUCT,PSOPROD,UNIT,VANAME,DISPDT,PSONDC
"RTN","PSOHLDS1",36,0)
 Q
"RTN","PSOHLDS1",37,0)
GETDATA ; this is the place to set all data needed for several segments
"RTN","PSOHLDS1",38,0)
 I $G(FP)="F"&('$G(FPN)) D    ;original
"RTN","PSOHLDS1",39,0)
 . S FDT=$P(^PSRX(IRXN,2),"^",2),VPHARMID=$P(^(2),"^",10),DISPDT=$P(^(2),"^",5),EXDT=$P(^(2),"^",6),PSONDC=$P(^(2),"^",7)
"RTN","PSOHLDS1",40,0)
 . S PVDR=$P(^PSRX(IRXN,0),"^",4),QTY=$P(^(0),"^",7),DASPLY=$P(^(0),"^",8),MW=$P(^(0),"^",11),EBY=$P(^(0),"^",16)
"RTN","PSOHLDS1",41,0)
 I $G(FP)="F"&($G(FPN)) D    ;refill
"RTN","PSOHLDS1",42,0)
 . S FDT=$P(^PSRX(IRXN,1,FPN,0),"^"),MW=$P(^(0),"^",2),QTY=$P(^(0),"^",4),DASPLY=$P(^(0),"^",10),DISPDT=$P(^(0),"^",19),EXDT=$S($P(^(0),"^",15):$P(^(0),"^",15),1:$P(^PSRX(IRXN,2),"^",6))
"RTN","PSOHLDS1",43,0)
 . S VPHARMID=$S($P(^PSRX(IRXN,1,FPN,0),"^",5)'="":$P(^(0),"^",5),1:$P(^PSRX(IRXN,2),"^",10))
"RTN","PSOHLDS1",44,0)
 . S EBY=$S($P(^PSRX(IRXN,1,FPN,0),"^",5):$P(^(0),"^",5),1:$P(^(0),"^",7)),PVDR=$P(^(0),"^",17),PSONDC=$S($P($G(^PSRX(IRXN,1,FPN,1)),"^",3):$P(^(1),"^",3),1:$P(^PSRX(IRXN,2),"^",7))
"RTN","PSOHLDS1",45,0)
 I $G(FP)="P"&($G(FPN)) D  ;partial
"RTN","PSOHLDS1",46,0)
 . S FDT=$P(^PSRX(IRXN,"P",FPN,0),"^"),MW=$P(^(0),"^",2),QTY=$P(^(0),"^",4),DASPLY=$P(^(0),"^",10),DISPDT=$P(^(0),"^",13),PVDR=$P(^(0),"^",17),EXDT=$P(^PSRX(IRXN,2),"^",6)
"RTN","PSOHLDS1",47,0)
 . S EBY=$S($P(^PSRX(IRXN,"P",FPN,0),"^",5):$P(^(0),"^",5),1:$P(^(0),"^",7)),VPHARMID=$S($P(^(0),"^",5)'="":$P(^(0),"^",5),1:$P(^PSRX(IRXN,2),"^",10)),PVDR=$P(^PSRX(IRXN,"P",FPN,0),"^",17)
"RTN","PSOHLDS1",48,0)
 . S PSONDC=$S($P(^PSRX(IRXN,"P",FPN,0),"^",12):$P(^(0),"^",12),1:$P(^PSRX(IRXN,2),"^",7))
"RTN","PSOHLDS1",49,0)
 S EFDT=$P(^PSRX(IRXN,2),"^",2) S:$G(EFDT) EFDT=$$HLDATE^HLFNC(EFDT,"DT")
"RTN","PSOHLDS1",50,0)
 S ISDT=$P(^PSRX(IRXN,0),"^",13) S:$G(ISDT) ISDT=$$HLDATE^HLFNC(ISDT,"DT")
"RTN","PSOHLDS1",51,0)
 S DEAID=$$GET1^DIQ(200,PVDR_",",53.2)
"RTN","PSOHLDS1",52,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=VPHARMID D ^DIC
"RTN","PSOHLDS1",53,0)
 S VPHARM=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",54,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=EBY D ^DIC
"RTN","PSOHLDS1",55,0)
 S EBY1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",56,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=PVDR D ^DIC
"RTN","PSOHLDS1",57,0)
 S PVDR1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",58,0)
 S PRIORDT=$P(^PSRX(IRXN,3),"^",4),PRIORDT=$$HLDATE^HLFNC(PRIORDT,"DT")
"RTN","PSOHLDS1",59,0)
 S FDT=$$HLDATE^HLFNC(FDT,"DT")
"RTN","PSOHLDS1",60,0)
 S:$G(DISPDT) DISPDT=$$HLDATE^HLFNC(DISPDT,"DT")
"RTN","PSOHLDS1",61,0)
 S:$G(EXDT) EXDT=$$HLDATE^HLFNC(EXDT,"DT")
"RTN","PSOHLDS1",62,0)
 S FIN=$P(^PSRX(IRXN,"OR1"),"^",5)
"RTN","PSOHLDS1",63,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=FIN D ^DIC
"RTN","PSOHLDS1",64,0)
 S FIN1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",65,0)
 S SITE=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOHLDS1",66,0)
 S PSZIP=$P(SITE,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOHLDS1",67,0)
 S CLN=+$P(^PSRX(IRXN,0),"^",5),CLN1=$S($D(^SC(CLN,0)):$P(^(0),"^",1),1:"UNKNOWN")
"RTN","PSOHLDS1",68,0)
 S CSINER=$P(^PSRX(IRXN,3),"^",3)
"RTN","PSOHLDS1",69,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=CSINER D ^DIC
"RTN","PSOHLDS1",70,0)
 S CSINER1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",71,0)
 D 6^VADPT
"RTN","PSOHLDS1",72,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),CAP=$P(X,"^",2)
"RTN","PSOHLDS1",73,0)
 D MW(X,.MW,.MP)                                              ;PSO*232
"RTN","PSOHLDS1",74,0)
 I (($P(^PSRX(IRXN,"STA"),"^")>0)&($P(^("STA"),"^")'=2)&('$G(PSODBQ)))!'$G(^PSRX(IRXN,"IB")) S COPAY="NO COPAY"
"RTN","PSOHLDS1",75,0)
 E  S COPAY="COPAY"
"RTN","PSOHLDS1",76,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOHLDS1",77,0)
 S DATE=$$HLDATE^HLFNC(FDT) D NOW^%DTC S NOW=$$HLDATE^HLFNC(%,"TS")
"RTN","PSOHLDS1",78,0)
 S OLAN=$P($G(^PS(55,DFN,"LAN")),"^",2),OTLAN="N" I OLAN=2 S OTLAN="Y"
"RTN","PSOHLDS1",79,0)
 S CSUB1=$$GET1^DIQ(50,IDGN_",",3),CSUB="N" I $E(CSUB1,1)>1&($E(CSUB1,1)<6) S CSUB="Y"
"RTN","PSOHLDS1",80,0)
 S SCTALK=+$G(^PS(55,"ASTALK",$P(^PSRX(IRXN,0),"^",2)))
"RTN","PSOHLDS1",81,0)
 K DIC,DR,DIQ S DA=$P($$SITE^VASITE(),"^") I DA D
"RTN","PSOHLDS1",82,0)
 .K PSOINST S DIC=4,DIQ(0)="I",DR=99,DIQ="PSOINST" D EN^DIQ1
"RTN","PSOHLDS1",83,0)
 .S PSOINST=PSOINST(4,DA,99,"I") K DIC,DA,DR,DIQ,PSOINST(4)
"RTN","PSOHLDS1",84,0)
 S DRUG=$$ZZ^PSOSUTL(IRXN),DEA=$P(^PSDRUG(IDGN,0),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOHLDS1",85,0)
 S PSND1=$P($G(^PSDRUG(IDGN,"ND")),"^"),PSND2=$P($G(^("ND")),"^",2),PSND3=$P($G(^("ND")),"^",3)
"RTN","PSOHLDS1",86,0)
 K PSOXN,PSOXN2,PSOPROD
"RTN","PSOHLDS1",87,0)
 I PSND1,PSND3 D
"RTN","PSOHLDS1",88,0)
 .S PSOPROD=$$PROD2^PSNAPIS(PSND1,PSND3),VANAME=$P($G(PSOPROD),"^",1)
"RTN","PSOHLDS1",89,0)
 .I $T(^PSNAPIS)]"" S PSOXN=$$DFSU^PSNAPIS(PSND1,PSND3),UNIT=$P($G(PSOXN),"^",6) S PSOXN=$P($G(PSOXN),"^",5) S PSOXN2=$$PROD2^PSNAPIS(PSND1,PSND3) Q
"RTN","PSOHLDS1",90,0)
 .S PSOXN2=$G(^PSNDF(PSND1,5,PSND3,2))
"RTN","PSOHLDS1",91,0)
 .S PRODUCT=$G(^PSNDF(PSND1,5,PSND3,0))
"RTN","PSOHLDS1",92,0)
 .I $G(PRODUCT)'="" S PSOXN=+$P($G(^PSNDF(PSND1,2,+$P(PRODUCT,"^",2),3,+$P(PRODUCT,"^",3),4,+$P(PRODUCT,"^",4),0)),"^"),UNIT=$P($G(^PS(50.607,PSOXN,0)),"^")
"RTN","PSOHLDS1",93,0)
 S NFLD=0,UU="" F  S UU=$O(^PSRX(IRXN,1,UU)) Q:UU=""  S:$D(^PSRX(IRXN,1,UU,0)) NFLD=NFLD+1
"RTN","PSOHLDS1",94,0)
 S NRFL=$P(^PSRX(IRXN,0),"^",9),RFRM=(NRFL-NFLD)
"RTN","PSOHLDS1",95,0)
 Q
"RTN","PSOHLDS1",96,0)
PID(PSI) ;patient ID segment
"RTN","PSOHLDS1",97,0)
 Q:'$D(DFN)!$D(PAS)
"RTN","PSOHLDS1",98,0)
 S HLFS=HL1("FS"),HLECH=HL1("ECH"),HLQ=HL1("Q"),HLVER=HL1("VER")
"RTN","PSOHLDS1",99,0)
 K PSPID,PSPID1
"RTN","PSOHLDS1",100,0)
 D BLDPID^VAFCQRY(DFN,"","3,5,7,8,11,13",.PSPID,.HL1,.ERR)
"RTN","PSOHLDS1",101,0)
 ; put PID in format needed for segment parser
"RTN","PSOHLDS1",102,0)
 S PSPID=PSPID(1) K PSPID(1)
"RTN","PSOHLDS1",103,0)
 S (X,Y)=1 F  S X=+$O(PSPID(X)) Q:'X  S PSPID(Y)=PSPID(X),Y=Y+1 K PSPID(X)
"RTN","PSOHLDS1",104,0)
 ;parse PID into individual fields
"RTN","PSOHLDS1",105,0)
 K PRSEPID D SEGPRSE^SCMSVUT5("PSPID","PRSEPID",HL1("FS"))
"RTN","PSOHLDS1",106,0)
 ; parse address into individual components
"RTN","PSOHLDS1",107,0)
 K ADDSEQ D SEQPRSE^SCMSVUT5($NA(PRSEPID(11)),"ADDSEQ",HL1("ECH"))
"RTN","PSOHLDS1",108,0)
 ; build ZTA (Temporary Address)
"RTN","PSOHLDS1",109,0)
 K X2 S X2=$$EN^VAFHLZTA(DFN,"1,2,3,4,5,6,7,",1)
"RTN","PSOHLDS1",110,0)
 ; parse X2 (ZTA) into individual fields if temp add. exists
"RTN","PSOHLDS1",111,0)
 I $P(X2,HLFS,3) D
"RTN","PSOHLDS1",112,0)
 . K PRSEZTA D SEGPRSE^SCMSVUT5("X2","PRSEZTA",HL1("FS"))
"RTN","PSOHLDS1",113,0)
 . ; parse temporary address into individual components
"RTN","PSOHLDS1",114,0)
 . K TMPADD D SEQPRSE^SCMSVUT5($NA(PRSEZTA(5)),"TMPADD",HL1("ECH"))
"RTN","PSOHLDS1",115,0)
 . ; add temporary address as next repitition in PID segment
"RTN","PSOHLDS1",116,0)
 . S SPOT=1+$O(ADDSEQ(""),-1)
"RTN","PSOHLDS1",117,0)
 . M ADDSEQ(SPOT)=TMPADD(1)
"RTN","PSOHLDS1",118,0)
 . S ADDSEQ(SPOT,7)="C"
"RTN","PSOHLDS1",119,0)
 . S ADDSEQ(SPOT,9)=PRSEZTA(6)
"RTN","PSOHLDS1",120,0)
 . S ADDSEQ(SPOT,12,1)=PRSEZTA(3)
"RTN","PSOHLDS1",121,0)
 . S ADDSEQ(SPOT,12,2)=PRSEZTA(4)
"RTN","PSOHLDS1",122,0)
 . ;move address sequence back into parse PID segment
"RTN","PSOHLDS1",123,0)
 . K PRSEPID(11) M PRSEPID(11)=ADDSEQ
"RTN","PSOHLDS1",124,0)
 ; rebuild PID segment
"RTN","PSOHLDS1",125,0)
 K PSPID1 D MAKEIT^VAFHLU("PID",.PRSEPID,.PSPID1,.PSPID1)
"RTN","PSOHLDS1",126,0)
 ;put rebuilt PID into format used by $$EN^VAFCQRY
"RTN","PSOHLDS1",127,0)
 K PSPID S PSPID(1)=PSPID1
"RTN","PSOHLDS1",128,0)
 S X=0,Y=2 F  S X=+$O(PSPID1(X)) Q:'X  S PSPID(Y)=PSPID1(X) S Y=Y+1
"RTN","PSOHLDS1",129,0)
 S CNT=0 F I=1:1 Q:'$D(PSPID(I))  D
"RTN","PSOHLDS1",130,0)
 . I I=1 S ^TMP("PSO",$J,PSI)=PSPID(I) Q
"RTN","PSOHLDS1",131,0)
 . S CNT=CNT+1 S ^TMP("PSO",$J,PSI,CNT)=PSPID(I)
"RTN","PSOHLDS1",132,0)
 S PSI=PSI+1
"RTN","PSOHLDS1",133,0)
 S PAS=1
"RTN","PSOHLDS1",134,0)
 K PSPID,PSPID1,PRSEPID,PRSEZTA,SPOT,TMPADD,ADDSEQ
"RTN","PSOHLDS1",135,0)
 Q
"RTN","PSOHLDS1",136,0)
PV1(PSI) ;patient visit segment
"RTN","PSOHLDS1",137,0)
 Q:'$D(DFN)!$D(PAS1)
"RTN","PSOHLDS1",138,0)
 N PV1  ;hardcoded to letter O for Outpatient (Patient class)
"RTN","PSOHLDS1",139,0)
 S PV1="PV1"_FS_FS_"O"_FS
"RTN","PSOHLDS1",140,0)
 S ^TMP("PSO",$J,PSI)=PV1
"RTN","PSOHLDS1",141,0)
 S PSI=PSI+1,PAS1=1
"RTN","PSOHLDS1",142,0)
 Q
"RTN","PSOHLDS1",143,0)
PV2(PSI) ;patient visit segment (additional information)
"RTN","PSOHLDS1",144,0)
 ;PATIENT STATUS AND COPAY
"RTN","PSOHLDS1",145,0)
 Q:'$D(DFN)!$D(PAS2)
"RTN","PSOHLDS1",146,0)
 N PV2 S PV2=""
"RTN","PSOHLDS1",147,0)
 S $P(PV2,"|",24)=$P($G(^PS(53,+$P($G(^PSRX(IRXN,0)),"^",3),0)),"^",2)_"~"_COPAY_FS
"RTN","PSOHLDS1",148,0)
 S ^TMP("PSO",$J,PSI)="PV2|"_PV2
"RTN","PSOHLDS1",149,0)
 S PSI=PSI+1,PAS2=1
"RTN","PSOHLDS1",150,0)
 Q
"RTN","PSOHLDS1",151,0)
 ;
"RTN","PSOHLDS1",152,0)
MW(PS55,MW,MP) ;Return Mail/Window and MP expanded text               ;PSO*232
"RTN","PSOHLDS1",153,0)
 I MW="W"!(MW="") D
"RTN","PSOHLDS1",154,0)
 . S MP=$S($P($G(^PSRX(IRXN,"MP")),"^"):$P(^("MP"),"^"),1:"""""")
"RTN","PSOHLDS1",155,0)
 . S MW="WINDOW"
"RTN","PSOHLDS1",156,0)
 I MW="M" D
"RTN","PSOHLDS1",157,0)
 . S MP=""""""
"RTN","PSOHLDS1",158,0)
 . S PS55=$P(PS55,"^",3)
"RTN","PSOHLDS1",159,0)
 . S MW=$S(PS55=1:"CERTIFIED MAIL",PS55=2:"DO NOT MAIL",1:"REGULAR MAIL")
"RTN","PSOHLDS1",160,0)
 Q
"VER")
8.0^22.0
"^DD",52.11,52.11,6,0)
TIME READY (HHMM)^NJ5,0^^0;7^K:+X'=X!(X>86400)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.11,52.11,6,.1)
Time Ready (HHMM)
"^DD",52.11,52.11,6,1,0)
^.1
"^DD",52.11,52.11,6,1,1,0)
52.11^ANAM^MUMPS
"^DD",52.11,52.11,6,1,1,1)
S ^PS(52.11,"ANAM",+$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)=""
"^DD",52.11,52.11,6,1,1,2)
K ^PS(52.11,"ANAM",+$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)
"^DD",52.11,52.11,6,1,1,"%D",0)
^.101^3^3^3001219^^^^
"^DD",52.11,52.11,6,1,1,"%D",1,0)
This xref lists the display group, patient name, then internal entry number.
"^DD",52.11,52.11,6,1,1,"%D",2,0)
It sets the global ^PS(52.11,"ANAM",Display Group,Hierarcy_MulitRx_" "_
"^DD",52.11,52.11,6,1,1,"%D",3,0)
Patient Name,DA)="".
"^DD",52.11,52.11,6,1,1,"DT")
2930318
"^DD",52.11,52.11,6,1,2,0)
52.11^ATIC^MUMPS
"^DD",52.11,52.11,6,1,2,1)
D ATICSET^PSOBINGO
"^DD",52.11,52.11,6,1,2,2)
D ATICKIL^PSOBINGO
"^DD",52.11,52.11,6,1,2,"%D",0)
^.101^2^2^3060213^^^^
"^DD",52.11,52.11,6,1,2,"%D",1,0)
This Xref lists the display group, ticket #, then internal entry number.
"^DD",52.11,52.11,6,1,2,"%D",2,0)
It sets the global ^PS(52.11,"ATIC",Display Group,Ticket,DA)="".
"^DD",52.11,52.11,6,1,2,"DT")
3060118
"^DD",52.11,52.11,6,3)
Type a Number between 1 and 86400, 0 Decimal Digits
"^DD",52.11,52.11,6,21,0)
^^1^1^2930201^
"^DD",52.11,52.11,6,21,1,0)
Second piece of $H at the time the Rx is ready.
"^DD",52.11,52.11,6,23,0)
^^1^1^2930201^
"^DD",52.11,52.11,6,23,1,0)
This field is "stuffed" by routine PSOBINGO when Rx is ready.
"^DD",52.11,52.11,6,"DT")
3060118
"^DD",59,59,2007,0)
DISPENSE DNS PORT^NJ5,0^^8;6^K:+X'=X!(X>65535)!(X<1)!(X?.E1"."1.N) X
"^DD",59,59,2007,3)
Type a number between 1 and 65535, 0 Decimal Digits
"^DD",59,59,2007,21,0)
^^2^2^3040405^
"^DD",59,59,2007,21,1,0)
ENTER THE DNS PORT NUMBER ASSOCIATED WITH THE AUTOMATED DISPENSE MACHINE 
"^DD",59,59,2007,21,2,0)
FOR THIS OUTPATIENT PHARMACY SITE DIVISION.
"^DD",59,59,2007,23,0)
^^3^3^3040405^
"^DD",59,59,2007,23,1,0)
YOUR IRM DEPARTMENT SHOULD HAVE THE INFORMATION OF THE PORT NUMBER FOR 
"^DD",59,59,2007,23,2,0)
THE AUTOMATED DISPENSE MACHINE ATTACHED TO THIS OUTPATIENT PHARMACY SITE 
"^DD",59,59,2007,23,3,0)
DIVISION.
"^DD",59,59,2007,"DT")
3060213
"BLD",6650,6)
^213
**END**
**END**
