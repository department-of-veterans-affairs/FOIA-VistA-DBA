Released DI*22*151 SEQ #137
Extracted from mail message
**KIDS**:DI*22.0*151^

**INSTALL NAME**
DI*22.0*151
"BLD",589,0)
DI*22.0*151^VA FILEMAN^0^3070831^y
"BLD",589,1,0)
^^2^2^3060921^
"BLD",589,1,1,0)
See patch DI*22*151 in the National Patch Module on FORUM for complete
"BLD",589,1,2,0)
information on this patch.
"BLD",589,4,0)
^9.64PA^^
"BLD",589,6.3)
10
"BLD",589,"KRN",0)
^9.67PA^8989.52^19
"BLD",589,"KRN",.4,0)
.4
"BLD",589,"KRN",.401,0)
.401
"BLD",589,"KRN",.402,0)
.402
"BLD",589,"KRN",.403,0)
.403
"BLD",589,"KRN",.5,0)
.5
"BLD",589,"KRN",.84,0)
.84
"BLD",589,"KRN",3.6,0)
3.6
"BLD",589,"KRN",3.8,0)
3.8
"BLD",589,"KRN",9.2,0)
9.2
"BLD",589,"KRN",9.8,0)
9.8
"BLD",589,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",589,"KRN",9.8,"NM",1,0)
DDS^^0^B31450099
"BLD",589,"KRN",9.8,"NM",2,0)
DDS10^^0^B10373560
"BLD",589,"KRN",9.8,"NM",3,0)
DDS41^^0^B34976567
"BLD",589,"KRN",9.8,"NM",4,0)
DDSRUN^^0^B2550961
"BLD",589,"KRN",9.8,"NM",5,0)
DICQ^^0^B21798425
"BLD",589,"KRN",9.8,"NM",6,0)
DDS4^^0^B25495567
"BLD",589,"KRN",9.8,"NM",7,0)
DDSU^^0^B22175755
"BLD",589,"KRN",9.8,"NM",8,0)
DDS0^^0^B17534410
"BLD",589,"KRN",9.8,"NM",9,0)
DICATTDK^^0^B6186767
"BLD",589,"KRN",9.8,"NM",10,0)
DDS11^^0^B26452550
"BLD",589,"KRN",9.8,"NM",11,0)
DICATTDE^^0^B26617595
"BLD",589,"KRN",9.8,"NM","B","DDS",1)

"BLD",589,"KRN",9.8,"NM","B","DDS0",8)

"BLD",589,"KRN",9.8,"NM","B","DDS10",2)

"BLD",589,"KRN",9.8,"NM","B","DDS11",10)

"BLD",589,"KRN",9.8,"NM","B","DDS4",6)

"BLD",589,"KRN",9.8,"NM","B","DDS41",3)

"BLD",589,"KRN",9.8,"NM","B","DDSRUN",4)

"BLD",589,"KRN",9.8,"NM","B","DDSU",7)

"BLD",589,"KRN",9.8,"NM","B","DICATTDE",11)

"BLD",589,"KRN",9.8,"NM","B","DICATTDK",9)

"BLD",589,"KRN",9.8,"NM","B","DICQ",5)

"BLD",589,"KRN",19,0)
19
"BLD",589,"KRN",19,"NM",0)
^9.68A^^
"BLD",589,"KRN",19.1,0)
19.1
"BLD",589,"KRN",101,0)
101
"BLD",589,"KRN",409.61,0)
409.61
"BLD",589,"KRN",771,0)
771
"BLD",589,"KRN",870,0)
870
"BLD",589,"KRN",8989.51,0)
8989.51
"BLD",589,"KRN",8989.52,0)
8989.52
"BLD",589,"KRN",8994,0)
8994
"BLD",589,"KRN","B",.4,.4)

"BLD",589,"KRN","B",.401,.401)

"BLD",589,"KRN","B",.402,.402)

"BLD",589,"KRN","B",.403,.403)

"BLD",589,"KRN","B",.5,.5)

"BLD",589,"KRN","B",.84,.84)

"BLD",589,"KRN","B",3.6,3.6)

"BLD",589,"KRN","B",3.8,3.8)

"BLD",589,"KRN","B",9.2,9.2)

"BLD",589,"KRN","B",9.8,9.8)

"BLD",589,"KRN","B",19,19)

"BLD",589,"KRN","B",19.1,19.1)

"BLD",589,"KRN","B",101,101)

"BLD",589,"KRN","B",409.61,409.61)

"BLD",589,"KRN","B",771,771)

"BLD",589,"KRN","B",870,870)

"BLD",589,"KRN","B",8989.51,8989.51)

"BLD",589,"KRN","B",8989.52,8989.52)

"BLD",589,"KRN","B",8994,8994)

"BLD",589,"PRE")
DI151ENV
"BLD",589,"QUES",0)
^9.62^^
"BLD",589,"REQB",0)
^9.611^7^7
"BLD",589,"REQB",1,0)
DI*22.0*8^2
"BLD",589,"REQB",2,0)
DI*22.0*11^2
"BLD",589,"REQB",3,0)
DI*22.0*54^2
"BLD",589,"REQB",4,0)
DI*22.0*57^2
"BLD",589,"REQB",5,0)
DI*22.0*103^2
"BLD",589,"REQB",6,0)
DI*22.0*118^2
"BLD",589,"REQB",7,0)
DI*22.0*147^2
"BLD",589,"REQB","B","DI*22.0*103",5)

"BLD",589,"REQB","B","DI*22.0*11",2)

"BLD",589,"REQB","B","DI*22.0*118",6)

"BLD",589,"REQB","B","DI*22.0*147",7)

"BLD",589,"REQB","B","DI*22.0*54",3)

"BLD",589,"REQB","B","DI*22.0*57",4)

"BLD",589,"REQB","B","DI*22.0*8",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3070816^41
"PKG",5,22,1,"PAH",1,0)
151^3070831^41
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3070831
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*151 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DI151ENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","DDS")
0^1^B31450099^B29730412
"RTN","DDS",1,0)
DDS ;SFISC/MLH,MKO-MAIN ROUTINE ;21SEP2006
"RTN","DDS",2,0)
 ;;22.0;VA FileMan;**151**;Mar 30, 1999;Build 10
"RTN","DDS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS",4,0)
 N DIE,DX,DY,X,Y
"RTN","DDS",5,0)
 K DDSCTRL ;DI*151
"RTN","DDS",6,0)
 I '$D(DIFM) N DIFM S DIFM=1 D INIZE^DIEFU
"RTN","DDS",7,0)
 ;
"RTN","DDS",8,0)
 D EN^DDS0(.DDSFILE,DR,.DA)
"RTN","DDS",9,0)
 I $G(DIERR) D:$G(DDSPARM)'["E"  G END^DDS0
"RTN","DDS",10,0)
 . W !,$C(7)_$$EZBLD^DIALOG(3000)
"RTN","DDS",11,0)
 . D MSG^DIALOG("BW")
"RTN","DDS",12,0)
 . S DIMSG=""
"RTN","DDS",13,0)
 ;
"RTN","DDS",14,0)
 N DR
"RTN","DDS",15,0)
 X:$G(^DIST(.403,+DDS,11))'?."^" ^(11)
"RTN","DDS",16,0)
 F  D PG Q:DDACT="Q"
"RTN","DDS",17,0)
 X:$G(^DIST(.403,+DDS,12))'?."^" ^(12)
"RTN","DDS",18,0)
 ;
"RTN","DDS",19,0)
 D:$G(@DDSREFT@("HLP"))>0 HLP^DDSMSG()
"RTN","DDS",20,0)
 G END^DDS0
"RTN","DDS",21,0)
 ;
"RTN","DDS",22,0)
PROC ;Main loop
"RTN","DDS",23,0)
 F  D PG Q:DDACT="Q"
"RTN","DDS",24,0)
 Q
"RTN","DDS",25,0)
 ;
"RTN","DDS",26,0)
PG ;Load page
"RTN","DDS",27,0)
 S DDACT="N"
"RTN","DDS",28,0)
 D ^DDS1(DDSPG)
"RTN","DDS",29,0)
 I $G(DIERR) D  Q
"RTN","DDS",30,0)
 . N P S P(1)=$P($G(^DIST(.403,+DDS,40,DDSPG,0)),U),P(2)=$P($G(^(1)),U)
"RTN","DDS",31,0)
 . S:P(2)="" P(2)="unnamed"
"RTN","DDS",32,0)
 . D BLD^DIALOG(3041,.P),ERR^DDSMSG H 2
"RTN","DDS",33,0)
 . S DDACT="Q"
"RTN","DDS",34,0)
 ;
"RTN","DDS",35,0)
 ;Pre-action, save old and get next page
"RTN","DDS",36,0)
 S DDSOPB=DDSPG
"RTN","DDS",37,0)
 I $G(^DIST(.403,+DDS,40,DDSPG,11))'?."^" D PA(^(11)) Q:DDACT="NP"
"RTN","DDS",38,0)
 S DDSNP=$$NP^DDS5(.Y) S:'Y DDSNP=""
"RTN","DDS",39,0)
 ;
"RTN","DDS",40,0)
 ;Get DDO and DDSBK
"RTN","DDS",41,0)
 I $S($D(DDSBR)[0:1,1:$D(@DDSREFS@(DDSPG,$S(DDO:+DDSBK,1:0),DDO,"N"))[0) D
"RTN","DDS",42,0)
 . S DDO=+$G(@DDSREFS@(DDSPG,"FIRST")),DDSBK=$P($G(^("FIRST")),",",2)
"RTN","DDS",43,0)
 I 'DDSBK D  Q
"RTN","DDS",44,0)
 . D BLD^DIALOG(3055,"number "_$P($G(^DIST(.403,+DDS,40,DDSPG,0)),U)_$S($G(^(1))]"":" ("_$P($G(^(1)),U)_")",1:""))
"RTN","DDS",45,0)
 . D ERR^DDSMSG H 2
"RTN","DDS",46,0)
 . S DDACT="Q"
"RTN","DDS",47,0)
 ;
"RTN","DDS",48,0)
 ;Get DDSPOP and update DDSSC array
"RTN","DDS",49,0)
 ;If we're going to another page
"RTN","DDS",50,0)
 I '$D(DDSPGUP) D
"RTN","DDS",51,0)
 . S DDSLN=^DIST(.403,+DDS,40,DDSPG,0),DDSPOP=$P(DDSLN,U,6)
"RTN","DDS",52,0)
 . K:'DDSPOP DDSSC
"RTN","DDS",53,0)
 . I $D(DDSSEL) D
"RTN","DDS",54,0)
 .. S DDSDASV=DDSDA,DDSDLSV=DDSDL
"RTN","DDS",55,0)
 .. M DDSORGSV=DDSDAORG
"RTN","DDS",56,0)
 .. K DA,@$$D0(DDSDL),DDSDAORG
"RTN","DDS",57,0)
 .. S (DA,D0,DDSDAORG)="",DDSDA="0,",DDSDL=0
"RTN","DDS",58,0)
 . I '$D(DDSSC("B",DDSPG)) D
"RTN","DDS",59,0)
 .. S DDSSC=$G(DDSSC)+1,DDSSC(DDSSC)=DDSPG,DDSSC("B",DDSPG,DDSSC)=""
"RTN","DDS",60,0)
 .. S:DDSPOP $P(DDSSC(DDSSC),U,2,3)=$P(DDSLN,U,3)_U_$P(DDSLN,U,7)
"RTN","DDS",61,0)
 .. I $G(DDSSTK) S $P(DDSSC(DDSSC),U,4)=1 K DDSSTK
"RTN","DDS",62,0)
 .. K DDSPOP
"RTN","DDS",63,0)
 . E  D
"RTN","DDS",64,0)
 .. Q:$P($G(DDSSC(+$G(DDSSC))),U)=DDSPG
"RTN","DDS",65,0)
 .. N I,J,S
"RTN","DDS",66,0)
 .. S I=$O(DDSSC("B",DDSPG,"")),S=DDSSC(I) K DDSSC("B",DDSPG,I)
"RTN","DDS",67,0)
 .. F J=I:1:DDSSC-1 D
"RTN","DDS",68,0)
 ... K DDSSC("B",$P(DDSSC(J+1),U),J)
"RTN","DDS",69,0)
 ... S DDSSC(J)=DDSSC(J+1),DDSSC("B",$P(DDSSC(J),U),J)=""
"RTN","DDS",70,0)
 .. S DDSSC(DDSSC)=S,DDSSC("B",DDSPG,DDSSC)=""
"RTN","DDS",71,0)
 ;
"RTN","DDS",72,0)
 ;If we've moving up from a pop-up page
"RTN","DDS",73,0)
 E  K DDSPGUP
"RTN","DDS",74,0)
 ;
"RTN","DDS",75,0)
 ;Paint the page
"RTN","DDS",76,0)
 D RP^DDSR(DDSSC(DDSSC),DDSSC=1)
"RTN","DDS",77,0)
 ;
"RTN","DDS",78,0)
P1 F  D BLK Q:"^Q^NP^"[(U_DDACT_U)
"RTN","DDS",79,0)
 ;
"RTN","DDS",80,0)
 ;PAGE Post action, print any help
"RTN","DDS",81,0)
 D:$G(^DIST(.403,+DDS,40,+DDSOPB,12))'?."^" PA(^(12))
"RTN","DDS",82,0)
 D:$G(@DDSREFT@("HLP"))>0 HLP^DDSMSG()
"RTN","DDS",83,0)
 G:"^NB^N^"[(U_DDACT_U) P1
"RTN","DDS",84,0)
 ;
"RTN","DDS",85,0)
 I DDACT="Q" D
"RTN","DDS",86,0)
 . I '$P(DDSSC(DDSSC),U,4) D
"RTN","DDS",87,0)
 .. I $G(DDSSEL) D GDA^DDSRSEL Q:'DA
"RTN","DDS",88,0)
 .. D:$G(DDSSC)>1 CLEAR^DDSBOX($P(DDSSC(DDSSC),U,2),$P(DDSSC(DDSSC),U,3))
"RTN","DDS",89,0)
 .. S:DDSSC>1 DDSPG=$P(DDSSC(DDSSC-1),U),DDACT="N",DDSPGUP=1
"RTN","DDS",90,0)
 . K DDSSC("B",$P(DDSSC(DDSSC),U),DDSSC),DDSSC(DDSSC) S DDSSC=DDSSC-1
"RTN","DDS",91,0)
 Q
"RTN","DDS",92,0)
 ;
"RTN","DDS",93,0)
BLK S DDACT="N",DDSOSV=0
"RTN","DDS",94,0)
 ;
"RTN","DDS",95,0)
 I $D(@DDSREFS@(DDSPG,DDSBK))[0 S DDACT="Q" Q
"RTN","DDS",96,0)
 S DDSLN=@DDSREFS@(DDSPG,DDSBK)
"RTN","DDS",97,0)
 ;
"RTN","DDS",98,0)
 S DDSDN=$P(DDSLN,U,4),DDSTP=$P(DDSLN,U,5)
"RTN","DDS",99,0)
 S DDSREP=$P(DDSLN,U,7),DDSPTB=$P(DDSLN,U,8)
"RTN","DDS",100,0)
 K:'DDSDN DDSDN K:DDSTP="e" DDSTP K:'DDSPTB DDSPTB K:DDSREP'>1 DDSREP
"RTN","DDS",101,0)
 ;
"RTN","DDS",102,0)
 I $D(DDSPTB)!$D(DDSREP) N DDP,DDSDA,DIE D
"RTN","DDS",103,0)
 . S DDP=$P(DDSLN,U,3)
"RTN","DDS",104,0)
 . S DDSDA=$P(@DDSREFT@(DDSPG,DDSBK),U) Q:'DDSDA
"RTN","DDS",105,0)
 . S DIE=@DDSREFT@(DDSPG,DDSBK,DDSDA,"GL")
"RTN","DDS",106,0)
 ;
"RTN","DDS",107,0)
 I $D(DDSPTB) N DA,@$$D0(DDSDL),DDSDL D
"RTN","DDS",108,0)
 . S DDSPTB=@DDSREFS@(DDSPG,DDSBK,"PTB")
"RTN","DDS",109,0)
 . S DDSDL=$L(DDSDA,",")-2
"RTN","DDS",110,0)
 . S (D0,DA)=+DDSDA
"RTN","DDS",111,0)
 ;
"RTN","DDS",112,0)
 I $D(DDSREP) N DDSDL,DA D
"RTN","DDS",113,0)
 . S DDSREP=$P(@DDSREFT@(DDSPG,DDSBK,DDSDA),U,2,999)
"RTN","DDS",114,0)
 . S DDSDA=$G(@DDSREFT@(DDSPG,DDSBK,$P(DDSREP,U),$P(DDSREP,U,4)),"0,"_DDSDA)
"RTN","DDS",115,0)
 . S:'$P(DDSREP,U,7) DDSDA=$P(DDSDA,",")_","
"RTN","DDS",116,0)
 . S DDSDL=$L(DDSDA,",")-2
"RTN","DDS",117,0)
 I  N @$$D0(DDSDL) D
"RTN","DDS",118,0)
 . D BLDDA(DDSDA)
"RTN","DDS",119,0)
 . S:'DA DDO=+$P(DDSREP,U,8)
"RTN","DDS",120,0)
 ;
"RTN","DDS",121,0)
 I $D(DDSPTB),'$D(DDSREP),'DDSDA,DDSDAORG  D  Q
"RTN","DDS",122,0)
 . N DDSBK0
"RTN","DDS",123,0)
 . S DDSBK0=DDSBK
"RTN","DDS",124,0)
 . F  S DDSBK=$$NB^DDS5(.Y) Q:DDSBK=DDSBK0!'Y!$G(@DDSREFT@(DDSPG,DDSBK))
"RTN","DDS",125,0)
 . Q:Y
"RTN","DDS",126,0)
 . I DDSNP]"" S DDSPG=DDSNP,DDACT="NP" Q
"RTN","DDS",127,0)
 . S DDSPG=$$PP^DDS5(.Y) I Y S DDACT="NP" Q
"RTN","DDS",128,0)
 . S DDACT="Q"
"RTN","DDS",129,0)
 ;
"RTN","DDS",130,0)
 S $P(DDSOPB,U,2)=DDSBK
"RTN","DDS",131,0)
 I $G(^DIST(.403,+DDS,40,DDSPG,40,DDSBK,11))'?."^" D PA(^(11)) Q:DDACT="NP"
"RTN","DDS",132,0)
 I $G(^DIST(.404,DDSBK,11))'?."^" D PA(^(11)) Q:DDACT="NP"
"RTN","DDS",133,0)
 I $S($D(DDSBR)[0:1,1:$D(@DDSREFS@(DDSPG,$S(DDO:+DDSBK,1:0),DDO,"N"))[0) D
"RTN","DDS",134,0)
 . S DDO=$P(@DDSREFS@(DDSPG,DDSBK),U,9)
"RTN","DDS",135,0)
 K DDSLN
"RTN","DDS",136,0)
 ;
"RTN","DDS",137,0)
B1 D ^DDS01
"RTN","DDS",138,0)
 ;
"RTN","DDS",139,0)
 I $G(^DIST(.403,+DDS,40,DDSPG,40,$P(DDSOPB,U,2),12))'?."^" D PA(^(12)) G:DDACT="N" B1
"RTN","DDS",140,0)
 I $G(^DIST(.404,$P(DDSOPB,U,2),12))'?."^" D PA(^(12)) G:DDACT="N" B1
"RTN","DDS",141,0)
 Q
"RTN","DDS",142,0)
 ;
"RTN","DDS",143,0)
BLDDA(DDSDA) ;
"RTN","DDS",144,0)
 N I
"RTN","DDS",145,0)
 S (DA,@("D"_DDSDL))=$P(DDSDA,",")
"RTN","DDS",146,0)
 F I=1:1:DDSDL S (DA(I),@("D"_(DDSDL-I)))=$P(DDSDA,",",I+1)
"RTN","DDS",147,0)
 Q
"RTN","DDS",148,0)
 ;
"RTN","DDS",149,0)
D0(DL) ;Given DL, return string D0,D1,...,Dn
"RTN","DDS",150,0)
 N I,S
"RTN","DDS",151,0)
 S S="" F I=0:1:DL S S=S_"D"_I_","
"RTN","DDS",152,0)
 S:S?.E1"," S=$E(S,1,$L(S)-1)
"RTN","DDS",153,0)
 Q S
"RTN","DDS",154,0)
 ;
"RTN","DDS",155,0)
CLRMSG ;
"RTN","DDS",156,0)
 I $G(DDSKM) H 2 K DDSKM ;GFT  ** IF WE WERE KEEPING SOMETHING IN HELP AREA, HOLD UP 2 SECONDS  ISB-0603-31054
"RTN","DDS",157,0)
 K DDQ S DDSH=1,(DDM,DX)=0,DY=DDSHBX+1 X DDXY W $P(DDGLCLR,DDGLDEL,3)
"RTN","DDS",158,0)
 Q
"RTN","DDS",159,0)
 ;
"RTN","DDS",160,0)
PA(DDSPA) ;
"RTN","DDS",161,0)
 N DDSBRORG S:$D(DDSBR)#2 DDSBRORG=DDSBR
"RTN","DDS",162,0)
 K DDSBR X DDSPA
"RTN","DDS",163,0)
 I $D(DDSBR)[0 S:$D(DDSBRORG)#2 DDSBR=DDSBRORG Q
"RTN","DDS",164,0)
 D BR^DDS2
"RTN","DDS",165,0)
 Q
"RTN","DDS",166,0)
RESET ;Programmer entry point to reset terminal and cleanup
"RTN","DDS",167,0)
 D INIT^DDGLIB0() D:$G(DIERR) MSG^DIALOG("BW")
"RTN","DDS",168,0)
 W $P($G(DDGLVID),DDGLDEL,10)
"RTN","DDS",169,0)
 K DDSPARM
"RTN","DDS",170,0)
 S DDSREFT="^TMP(""DDS"",$J)"
"RTN","DDS",171,0)
 D END^DDS0
"RTN","DDS",172,0)
 G RESET^DDGF
"RTN","DDS",173,0)
 ;
"RTN","DDS",174,0)
RUN ;Run a form
"RTN","DDS",175,0)
 G ^DDSRUN
"RTN","DDS",176,0)
CLONE ;Clone a form
"RTN","DDS",177,0)
 G ^DDSCLONE
"RTN","DDS",178,0)
PRINT ;Print a form
"RTN","DDS",179,0)
 G ^DDSPRNT
"RTN","DDS",180,0)
DFRM ;Delete a form
"RTN","DDS",181,0)
 G ^DDSDFRM
"RTN","DDS",182,0)
DBLK ;Delete unused blocks
"RTN","DDS",183,0)
 G ^DDSDBLK
"RTN","DDS0")
0^8^B17534410^B17376810
"RTN","DDS0",1,0)
DDS0 ;SFISC/MLH-SETUP, CLEANUP ;4:45 AM  7 Sep 2006
"RTN","DDS0",2,0)
 ;;22.0;VA FileMan;**8,151**;Mar 30, 1999;Build 10
"RTN","DDS0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS0",4,0)
 ;
"RTN","DDS0",5,0)
EN(DDSFILE,DR,DA) ;Initial setup
"RTN","DDS0",6,0)
 S U="^"
"RTN","DDS0",7,0)
 D INIT^DDGLIB0() Q:$G(DIERR)
"RTN","DDS0",8,0)
 D FORM(.DDSFILE,DR) Q:$G(DIERR)
"RTN","DDS0",9,0)
 ;
"RTN","DDS0",10,0)
 ;Compile the form if not already compiled
"RTN","DDS0",11,0)
 S DDSREFS=$$REF(DDS)
"RTN","DDS0",12,0)
 I '$$COMPILED(DDS) D EN^DDSZ(DDS) Q:$G(DIERR)
"RTN","DDS0",13,0)
 N:$P(^DIST(.403,+DDS,0),U,10) DA
"RTN","DDS0",14,0)
 ;
"RTN","DDS0",15,0)
 D FRSTPG(DDS,.DA,$G(DDSPAGE)) Q:$G(DIERR)
"RTN","DDS0",16,0)
 D REC(DDP,.DA) Q:$G(DIERR)
"RTN","DDS0",17,0)
 D INIT
"RTN","DDS0",18,0)
 Q
"RTN","DDS0",19,0)
 ;
"RTN","DDS0",20,0)
FORM(DDSFILE,DR) ;Form lookup
"RTN","DDS0",21,0)
 ;Output:
"RTN","DDS0",22,0)
 ;  DDS     = Form number^Form name
"RTN","DDS0",23,0)
 ;  DDP     = File number (or 0)
"RTN","DDS0",24,0)
 ;  DDSPG   = First page to go to on form
"RTN","DDS0",25,0)
 ;  DIERR
"RTN","DDS0",26,0)
 ;
"RTN","DDS0",27,0)
 I $D(DDSFILE)[0 D BLD^DIALOG(201,"DDSFILE") Q
"RTN","DDS0",28,0)
 ;
"RTN","DDS0",29,0)
 N DIC,X,Y
"RTN","DDS0",30,0)
 ;
"RTN","DDS0",31,0)
 S DDP=$S(DDSFILE=+DDSFILE:DDSFILE,1:+$P($G(@(DDSFILE_"0)")),U,2))
"RTN","DDS0",32,0)
 S X=$S(DR:DR,1:$P($P(DR,"[",2),"]"))
"RTN","DDS0",33,0)
 S DIC="^DIST(.403,",DIC(0)="FNX",D="F"_DDP
"RTN","DDS0",34,0)
 D IX^DIC K DIC
"RTN","DDS0",35,0)
 ;
"RTN","DDS0",36,0)
 I Y<0 D BLD^DIALOG(3021,X) Q
"RTN","DDS0",37,0)
 I '$O(^DIST(.403,+Y,40,"B","")) D BLD^DIALOG(3022,X) Q
"RTN","DDS0",38,0)
 S DDS=Y
"RTN","DDS0",39,0)
 ;
"RTN","DDS0",40,0)
 I $D(DDSFILE(1))#2 S DDP=$S(DDSFILE(1)=+DDSFILE(1):DDSFILE(1),1:+$P($G(@(DDSFILE(1)_"0)")),U,2))
"RTN","DDS0",41,0)
 Q
"RTN","DDS0",42,0)
 ;
"RTN","DDS0",43,0)
FRSTPG(DDS,DA,DDSPAGE) ;Get first page of form
"RTN","DDS0",44,0)
 ;Output:
"RTN","DDS0",45,0)
 ;  DDSPG
"RTN","DDS0",46,0)
 ;  DDSSEL = 1, if DA is null and there is a record selection page
"RTN","DDS0",47,0)
 ;  DIERR
"RTN","DDS0",48,0)
 ;
"RTN","DDS0",49,0)
 N P
"RTN","DDS0",50,0)
 I $G(DA)!$P(^DIST(.403,+DDS,0),U,10) D
"RTN","DDS0",51,0)
 . S P=$S($G(DDSPAGE):DDSPAGE,1:1)
"RTN","DDS0",52,0)
 . S DDSPG=$O(^DIST(.403,+DDS,40,"B",P,""))
"RTN","DDS0",53,0)
 . I $D(^DIST(.403,+DDS,40,+DDSPG,0))[0 D BLD^DIALOG(3023,"number "_P)
"RTN","DDS0",54,0)
 E  D PG^DDSRSEL D:'$G(DDSSEL) BLD^DIALOG(202,"record")
"RTN","DDS0",55,0)
 Q
"RTN","DDS0",56,0)
 ;
"RTN","DDS0",57,0)
REC(DDP,DA) ;Check record and lock
"RTN","DDS0",58,0)
 ;Output:
"RTN","DDS0",59,0)
 ;  DIE      = Global root
"RTN","DDS0",60,0)
 ;  DDSDA    = DA,DA(1),...,
"RTN","DDS0",61,0)
 ;  DDSDAORG = Original DA array
"RTN","DDS0",62,0)
 ;  DDSDL    = Level number (top=0)
"RTN","DDS0",63,0)
 ;  DDSDLORG = Original level number
"RTN","DDS0",64,0)
 ;  DDSFLORG  = Orig DDP^Orig DIE
"RTN","DDS0",65,0)
 ;  D0,D1,etc.
"RTN","DDS0",66,0)
 ;  DIERR
"RTN","DDS0",67,0)
 ;
"RTN","DDS0",68,0)
 I '$G(DA) D  Q
"RTN","DDS0",69,0)
 . S DIE="",(DDSDL,DDSDLORG)=0,DDSDA="0,"
"RTN","DDS0",70,0)
 . S DA="",DDSDAORG=DA
"RTN","DDS0",71,0)
 ;
"RTN","DDS0",72,0)
 D GL^DDS10(DDP,.DA,.DIE,.DDSDL,.DDSDA,1) Q:$G(DIERR)
"RTN","DDS0",73,0)
 ;
"RTN","DDS0",74,0)
 I $D(DIOVRD)[0 D  Q:$G(DIERR)
"RTN","DDS0",75,0)
 . N DDSTOP S DDSTOP=$$FNO^DILIBF(DDP)
"RTN","DDS0",76,0)
 . Q:$P($G(^DD(DDSTOP,0,"DI")),U,2)'["Y"
"RTN","DDS0",77,0)
 . N P S P("FILE")=$P(@(DIE_"0)"),U)
"RTN","DDS0",78,0)
 . D BLD^DIALOG(405,DDSTOP,.P)
"RTN","DDS0",79,0)
 ;
"RTN","DDS0",80,0)
 S DDSDLORG=DDSDL
"RTN","DDS0",81,0)
 K DDSDAORG S (DDSDAORG,@("D"_DDSDL))=DA
"RTN","DDS0",82,0)
 F DDSI=1:1:DDSDL S (DDSDAORG(DDSI),@("D"_(DDSDL-DDSI)))=DA(DDSI)
"RTN","DDS0",83,0)
 S DDSFLORG=$G(DDP)_$G(DIE)
"RTN","DDS0",84,0)
 K DDSI
"RTN","DDS0",85,0)
 Q
"RTN","DDS0",86,0)
 ;
"RTN","DDS0",87,0)
INIT ;Initialize some variables
"RTN","DDS0",88,0)
 ; DDSHBX   = $Y of first line of help area
"RTN","DDS0",89,0)
 ; DDSREFT  = Global reference of temporary global location
"RTN","DDS0",90,0)
 ; DDSFDO   = 1 if entire form is display-only
"RTN","DDS0",91,0)
 ; DDSCHG   = Change flag
"RTN","DDS0",92,0)
 ; DDSKM    = Flag to keep whatever's in help area
"RTN","DDS0",93,0)
 ; DDSH     = Flag to indicate help area is empty
"RTN","DDS0",94,0)
 ; DDSSC    = Array to indicate what pages are on the screen
"RTN","DDS0",95,0)
 ;
"RTN","DDS0",96,0)
 S DDSHBX=IOSL-7
"RTN","DDS0",97,0)
 S DDXY=IOXY_" S $X=DX,$Y=DY"
"RTN","DDS0",98,0)
 ;
"RTN","DDS0",99,0)
 K DDH,DDSSC,DDSCHANG,DDSSAVE
"RTN","DDS0",100,0)
 S DDSH=1,(DDH,DDM,DDSCHG,DDSSC)=0,DDACT="N"
"RTN","DDS0",101,0)
 S DDSREFT="^TMP(""DDS"",$J,"_+DDS_")"
"RTN","DDS0",102,0)
 K @DDSREFT
"RTN","DDS0",103,0)
 ;
"RTN","DDS0",104,0)
 N %,%H,%I,X
"RTN","DDS0",105,0)
 D NOW^%DTC
"RTN","DDS0",106,0)
 S $P(^DIST(.403,+DDS,0),U,6)=$E(%,1,12)
"RTN","DDS0",107,0)
 Q
"RTN","DDS0",108,0)
 ;
"RTN","DDS0",109,0)
END I $D(DDSHBX) S DX=0,DY=IOSL-1 X IOXY
"RTN","DDS0",110,0)
 D KILL^DDGLIB0($G(DDSPARM))
"RTN","DDS0",111,0)
 ;
"RTN","DDS0",112,0)
 D:$D(^TMP("DDS",$J,"LOCK")) UNLOCK
"RTN","DDS0",113,0)
 ;
"RTN","DDS0",114,0)
 K:'$G(DA) DA
"RTN","DDS0",115,0)
 I $D(DA),$D(DDSDAORG)#2,$D(DDSDLORG)#2 D
"RTN","DDS0",116,0)
 . K DA,D0
"RTN","DDS0",117,0)
 . S DA=DDSDAORG
"RTN","DDS0",118,0)
 . F DDSI=1:1:DDSDLORG S DA(DDSI)=DDSDAORG(DDSI) K @("D"_DDSI)
"RTN","DDS0",119,0)
 ;
"RTN","DDS0",120,0)
 K:$G(DDSPARM)'["E" DIERR,^TMP("DIERR",$J)
"RTN","DDS0",121,0)
 K:$D(DDSREFT)#2 @DDSREFT,DDSREFT
"RTN","DDS0",122,0)
 K ^TMP("DDSH",$J),^TMP("DDSWP",$J)
"RTN","DDS0",123,0)
 K DDACT,DDH,DDM,DDO,DDP,DDQ,DDS,DDSDDP
"RTN","DDS0",124,0)
 K DDSBK,DDSBR,DDSCHG,DDSDA,DDSDAORG,DDSDL
"RTN","DDS0",125,0)
 K DDSDLORG,DDSDN,DDSEXT,DDSFDO,DDSFLD,DDSFLORG,DDSGL,DDSH,DDSI
"RTN","DDS0",126,0)
 K DDSKM,DDSLN,DDSNP,DDSO,DDSOLD,DDSORD,DDSOPB,DDSOSV,DDSPTB,DDSPG
"RTN","DDS0",127,0)
 K DDSPX,DDSPY,DDSQ,DDSREP,DDSSC,DDSSP,DDSSTACK,DDSTP,DDSU,DDSX
"RTN","DDS0",128,0)
 K DDSHBX,DDSREFS,DDXY,DDSCTRL ;DI*151
"RTN","DDS0",129,0)
 K DIC,DIR,DIR0N,DIROUT,DIRUT,DUOUT,DY,DX
"RTN","DDS0",130,0)
 K A1,D,DDC,DDD,DI,DIEQ,DIK,DIW,DIY,DIZ,DS
"RTN","DDS0",131,0)
 Q
"RTN","DDS0",132,0)
 ;
"RTN","DDS0",133,0)
UNLOCK ;Unlock any lock records
"RTN","DDS0",134,0)
 N I
"RTN","DDS0",135,0)
 S I="" F  S I=$O(^TMP("DDS",$J,"LOCK",I)) Q:I=""  L -@I
"RTN","DDS0",136,0)
 K ^TMP("DDS",$J,"LOCK")
"RTN","DDS0",137,0)
 Q
"RTN","DDS0",138,0)
 ;
"RTN","DDS0",139,0)
COMPILED(DDS) ;Return 1 if form is compiled
"RTN","DDS0",140,0)
 Q $D(@$$REF(DDS))>0
"RTN","DDS0",141,0)
 ;
"RTN","DDS0",142,0)
REF(DDS) ;Return global reference for compiled global
"RTN","DDS0",143,0)
 Q $NA(^DIST(.403,+DDS,"AY"))
"RTN","DDS0",144,0)
 ;
"RTN","DDS0",145,0)
OLDREF(DDS) ;Return global reference for compiled global used prior
"RTN","DDS0",146,0)
 ;to version 22.0
"RTN","DDS0",147,0)
 Q $NA(^DIST(.403,+DDS,"AZ"))
"RTN","DDS0",148,0)
 ;
"RTN","DDS0",149,0)
IXF ;
"RTN","DDS0",150,0)
 N D0,DA,DIC,DP,Y S DIC="^DD("_DDGFDD_",",DIC(0)="EN" D ^DIC
"RTN","DDS0",151,0)
 I Y'>0 K X
"RTN","DDS0",152,0)
 E  S X=+$P(Y,"E")
"RTN","DDS0",153,0)
 Q
"RTN","DDS10")
0^2^B10373560^B9505384
"RTN","DDS10",1,0)
DDS10 ;SFISC/MKO-BLOCK SETUP ;21SEP2006
"RTN","DDS10",2,0)
 ;;22.0;VA FileMan;**147,151**;Mar 30, 1999;Build 10
"RTN","DDS10",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS10",4,0)
 ;
"RTN","DDS10",5,0)
SET(DDS1B,DDS1E,DA,DDP,DIE,DL,DDSDA) ;Get values for pointed-to block
"RTN","DDS10",6,0)
 ;In:
"RTN","DDS10",7,0)
 ;  DDS1B   = Block number or [Block name] (by ref)
"RTN","DDS10",8,0)
 ;  DDS1E   = 1, if we're loading a pointed-to block and we want
"RTN","DDS10",9,0)
 ;               interactive dialog (DIC(0)["E") in the lookup
"RTN","DDS10",10,0)
 ;  DA      = Record array
"RTN","DDS10",11,0)
 ;Returns:
"RTN","DDS10",12,0)
 ;  DDS1B = Block number
"RTN","DDS10",13,0)
 ;  DDP   = File number of block
"RTN","DDS10",14,0)
 ;  DIE   = Global root based on DDP and DA
"RTN","DDS10",15,0)
 ;  DL    = Level number (top=0)
"RTN","DDS10",16,0)
 ;  DDSDA = DA,DA(1),...,
"RTN","DDS10",17,0)
 ;
"RTN","DDS10",18,0)
 D BK(.DDS1B,.DDP) Q:$G(DIERR)
"RTN","DDS10",19,0)
 D GDA(DDS1B,DDS1E,.DA) Q:$G(DIERR)
"RTN","DDS10",20,0)
 D GL(DDP,.DA,.DIE,.DL,.DDSDA,$P($G(^DIST(.403,+DDS,40,+$G(DDSPG),40,DDS1B,0)),U,4)'="d") Q:$G(DIERR)  ;Don't LOCK record if block is display-only
"RTN","DDS10",21,0)
 Q
"RTN","DDS10",22,0)
 ;
"RTN","DDS10",23,0)
BK(DDSBK,DDP) ;Lookup block, get file number
"RTN","DDS10",24,0)
 ;Input:
"RTN","DDS10",25,0)
 ;  DDSBK = Block number or [Block name] (by ref)
"RTN","DDS10",26,0)
 ;Returns:
"RTN","DDS10",27,0)
 ;  DDSBK = Block number
"RTN","DDS10",28,0)
 ;  DDP   = File number
"RTN","DDS10",29,0)
 ;  DIERR
"RTN","DDS10",30,0)
 ;
"RTN","DDS10",31,0)
 I DDSBK=+$P(DDSBK,"E")  D  Q
"RTN","DDS10",32,0)
 . I $D(^DIST(.404,DDSBK,0))[0 D BLD^DIALOG(3051,"#"_DDSBK) Q
"RTN","DDS10",33,0)
 . S DDP=+$P(^DIST(.404,DDSBK,0),U,2)
"RTN","DDS10",34,0)
 I DDSBK?1"["1.E1"]" D  Q
"RTN","DDS10",35,0)
 . N X,Y,DIC
"RTN","DDS10",36,0)
 . S X=$E(DDSBK,2,$L(DDSBK)-1),DIC="^DIST(.404,",DIC(0)="FZ"
"RTN","DDS10",37,0)
 . D ^DIC I Y<0 D BLD^DIALOG(3051,"named "_X) Q
"RTN","DDS10",38,0)
 . S DDSBK=+Y,DDP=+$P(Y(0),U,2)
"RTN","DDS10",39,0)
 D BLD^DIALOG(3051,"#"_DDSBK)
"RTN","DDS10",40,0)
 Q
"RTN","DDS10",41,0)
 ;
"RTN","DDS10",42,0)
GDA(DDS1B,DDS1E,DA) ;Find new DA
"RTN","DDS10",43,0)
 ;Input:
"RTN","DDS10",44,0)
 ;  DDS1B    = Block number
"RTN","DDS10",45,0)
 ;  DDS1E    = 1:Interactive lookup
"RTN","DDS10",46,0)
 ;  DDSDAORG = Original DA array
"RTN","DDS10",47,0)
 ;  DDSDLORG = Original DL
"RTN","DDS10",48,0)
 ;  DDSPG
"RTN","DDS10",49,0)
 ;Returns:
"RTN","DDS10",50,0)
 ;  DA      = Record number
"RTN","DDS10",51,0)
 ;  DIERR
"RTN","DDS10",52,0)
 ;
"RTN","DDS10",53,0)
 N DDSDA,DDSI,X
"RTN","DDS10",54,0)
 ;
"RTN","DDS10",55,0)
 ;Set DA array to its original value
"RTN","DDS10",56,0)
 S DA=DDSDAORG
"RTN","DDS10",57,0)
 F DDSI=1:1:DDSDLORG S DA(DDSI)=DDSDAORG(DDSI)
"RTN","DDS10",58,0)
 D DDSDA(.DA,DDSDLORG,.DDSDA)
"RTN","DDS10",59,0)
 ;
"RTN","DDS10",60,0)
 ;Xecute each PTB node
"RTN","DDS10",61,0)
 F DDSI=1:1 Q:DA=""!'$D(@DDSREFS@(DDSPG,DDS1B,"PTB",DDSI))  X ^(DDSI) S:$G(X)'>0 DA=""
"RTN","DDS10",62,0)
 ;
"RTN","DDS10",63,0)
 ;Kill descendants of DA
"RTN","DDS10",64,0)
 I '$G(DIERR) S DDSI=DA K DA S DA=DDSI
"RTN","DDS10",65,0)
 S:DA'>0!$G(DIERR) DA=""
"RTN","DDS10",66,0)
 Q
"RTN","DDS10",67,0)
 ;
"RTN","DDS10",68,0)
GL(F,DA,DIE,DL,DDSDA,DDSL) ;Get global root, level, and IEN
"RTN","DDS10",69,0)
 ;Input variables:
"RTN","DDS10",70,0)
 ;  F    = file #
"RTN","DDS10",71,0)
 ;  DA   = array
"RTN","DDS10",72,0)
 ;  DDSL = flag to lock record
"RTN","DDS10",73,0)
 ;Returns:
"RTN","DDS10",74,0)
 ;  DIE   = global root of file (null if error)
"RTN","DDS10",75,0)
 ;  DL    = level (top=0) (null if error)
"RTN","DDS10",76,0)
 ;  DDSDA = IEN
"RTN","DDS10",77,0)
 ;  DIERR = Error flag
"RTN","DDS10",78,0)
 ;
"RTN","DDS10",79,0)
 I '$D(^DD(F)) D BLD^DIALOG(401,F) S (DIE,DL)="" Q
"RTN","DDS10",80,0)
 I $D(^DIC(F,0,"GL"))#2 S DIE=^("GL"),DL=0
"RTN","DDS10",81,0)
 E  D SUBGL Q:$G(DIERR)
"RTN","DDS10",82,0)
 ;
"RTN","DDS10",83,0)
 I '$G(DA) S DDSDA="0," Q
"RTN","DDS10",84,0)
 D DDSDA(.DA,DL,.DDSDA)
"RTN","DDS10",85,0)
 ;
"RTN","DDS10",86,0)
 N DDSP S DDSP("FILE")=F,DDSP("IEN")=DDSDA
"RTN","DDS10",87,0)
 ;
"RTN","DDS10",88,0)
 I $D(@(DIE_DA_",0)"))[0 D BLD^DIALOG(601,"",.DDSP)
"RTN","DDS10",89,0)
 I $D(@(DIE_DA_",-9)")) D BLD^DIALOG(602,"",.DDSP)
"RTN","DDS10",90,0)
 ;
"RTN","DDS10",91,0)
 I $G(DDSL),$D(^TMP("DDS",$J,"LOCK",DIE_DA_")"))[0 D  Q:$G(DIERR)
"RTN","DDS10",92,0)
 . D LOCK^DILF(DIE_DA_")") E  D BLD^DIALOG(110,"",.DDSP) Q  ;**147
"RTN","DDS10",93,0)
 . S ^TMP("DDS",$J,"LOCK",DIE_DA_")")=""
"RTN","DDS10",94,0)
 Q
"RTN","DDS10",95,0)
 ;
"RTN","DDS10",96,0)
SUBGL ;Get root and level for subfile
"RTN","DDS10",97,0)
 N D,I,S,U1
"RTN","DDS10",98,0)
 S D=F
"RTN","DDS10",99,0)
 F DL=0:1 Q:$D(^DD(D,0,"UP"))[0  S U1=^("UP") G:'$D(^DD(U1,"SB",D)) SUBER G:$D(^DD(U1,$O(^(D,"")),0))[0 SUBER S S(DL+1)=""""_$P($P(^(0),U,4),";")_"""",D=U1
"RTN","DDS10",100,0)
 G:$D(^DIC(D,0,"GL"))[0 SUBER S DIE=^("GL")
"RTN","DDS10",101,0)
 F I=DL:-1:1 G:$D(DA(I))[0 SUBER S DIE=DIE_DA(I)_","_S(I)_","
"RTN","DDS10",102,0)
 Q
"RTN","DDS10",103,0)
 ;
"RTN","DDS10",104,0)
SUBER ;Come here if an error is encountered in GL
"RTN","DDS10",105,0)
 S (DIE,DL)=""
"RTN","DDS10",106,0)
 D BLD^DIALOG(309)
"RTN","DDS10",107,0)
 Q
"RTN","DDS10",108,0)
 ;
"RTN","DDS10",109,0)
DDSDA(DA,DL,DDSDA) ;Determine DDSDA
"RTN","DDS10",110,0)
 ;Input:
"RTN","DDS10",111,0)
 ;  DA    = Record array
"RTN","DDS10",112,0)
 ;  DL    = Level number (top=0)
"RTN","DDS10",113,0)
 ;Output:
"RTN","DDS10",114,0)
 ;  DDSDA = DA,DA(1),...,
"RTN","DDS10",115,0)
 ;
"RTN","DDS10",116,0)
 N I
"RTN","DDS10",117,0)
 I DA="" S DDSDA="" Q
"RTN","DDS10",118,0)
 S DDSDA=DA_"," F I=1:1:DL S DDSDA=DDSDA_DA(I)_","
"RTN","DDS10",119,0)
 Q
"RTN","DDS11")
0^10^B26452550^B25655127
"RTN","DDS11",1,0)
DDS11(DDSBK,DDSNFO) ;SFISC/MLH,MKO-LOAD DATA ; 04 Jun 2007
"RTN","DDS11",2,0)
 ;;22.0;VA FileMan;**151**;Mar 30, 1999;Build 10
"RTN","DDS11",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS11",4,0)
 ;Input variables:
"RTN","DDS11",5,0)
 ;  DDSBK   = Block #
"RTN","DDS11",6,0)
 ;  DDSPG   = Page # (needed for form-only fields)
"RTN","DDS11",7,0)
 ;  DDSREFT = Temporary global location
"RTN","DDS11",8,0)
 ;  DDP     = File number of block
"RTN","DDS11",9,0)
 ;  DIE     = Global root of block
"RTN","DDS11",10,0)
 ;  DDSDA   = DA,DA(1),...
"RTN","DDS11",11,0)
 ;  DDSNFO  = Flag means don't reload form only fields
"RTN","DDS11",12,0)
 ;
"RTN","DDS11",13,0)
 N X,Y
"RTN","DDS11",14,0)
 S DDS1REFD=$NA(@DDSREFT@("F"_DDP,DDSDA))
"RTN","DDS11",15,0)
 ;
"RTN","DDS11",16,0)
 S DDS1FO=0
"RTN","DDS11",17,0)
 F  S DDS1FO=$O(^DIST(.404,DDSBK,40,DDS1FO)) Q:'DDS1FO  D LD
"RTN","DDS11",18,0)
 ;
"RTN","DDS11",19,0)
 I DDP,DDSDA S @DDS1REFD@("GL")=DIE
"RTN","DDS11",20,0)
 ;
"RTN","DDS11",21,0)
 K DDS1REFD,DDS1FLD,DDS1FO,DDS1KEY,DDS1LN,DDS1ND,DDS1PC,DDS1UI,DDS1DV
"RTN","DDS11",22,0)
 K DDS1D1,DDS1D2,DDS1D3
"RTN","DDS11",23,0)
 Q
"RTN","DDS11",24,0)
 ;
"RTN","DDS11",25,0)
LD ;Load data for a field
"RTN","DDS11",26,0)
 ;
"RTN","DDS11",27,0)
 ;Get form only fields
"RTN","DDS11",28,0)
 I $P($G(^DIST(.404,DDSBK,40,DDS1FO,0)),U,3)=2,$P($G(^(20)),U)]"" D  Q
"RTN","DDS11",29,0)
 . Q:$G(DDSNFO)
"RTN","DDS11",30,0)
 . N DDP
"RTN","DDS11",31,0)
 . S DDP=0,DDS1FLD=DDS1FO_","_DDSBK
"RTN","DDS11",32,0)
 . Q:"^1^3^"[(U_$G(@DDSREFT@("F0",DDSDA,DDS1FLD,"F"))_U)
"RTN","DDS11",33,0)
 . S Y=""
"RTN","DDS11",34,0)
 . I $D(@DDSREFT@("F0",DDSDA,DDS1FLD,"F"))[0,$G(^DIST(.404,DDSBK,40,DDS1FO,3))]"" D DEF(^(3),$G(^(3.1)))
"RTN","DDS11",35,0)
 . S (@DDSREFT@("F0",DDSDA,DDS1FLD,"D"),^("O"))=Y
"RTN","DDS11",36,0)
 ;
"RTN","DDS11",37,0)
 ;Get DD fields
"RTN","DDS11",38,0)
 S DDS1FLD=$G(^DIST(.404,DDSBK,40,DDS1FO,1)) Q:DDS1FLD?."^"
"RTN","DDS11",39,0)
 Q:"^1^3^"[(U_$G(@DDS1REFD@(DDS1FLD,"F"))_U)
"RTN","DDS11",40,0)
 ;
"RTN","DDS11",41,0)
 S DDS1LN=$G(^DD(DDP,DDS1FLD,0)) Q:DDS1LN?."^"
"RTN","DDS11",42,0)
 S DDS1PC=$P(DDS1LN,U,4),DDS1ND=$P(DDS1PC,";"),DDS1PC=$P(DDS1PC,";",2)
"RTN","DDS11",43,0)
 S DDS1DV=$P(DDS1LN,U,2),X=$P(DDS1LN,U,3)
"RTN","DDS11",44,0)
 ;
"RTN","DDS11",45,0)
 D @($S(DDS1FLD=.001:"L3",DDS1PC=0:"L2",1:"L1"))
"RTN","DDS11",46,0)
 ;
"RTN","DDS11",47,0)
 I DDS1DV["O"!(DDS1DV["P")!(DDS1DV["V")!(DDS1DV["D")!(DDS1DV["S") D
"RTN","DDS11",48,0)
 . Q:$D(@DDS1REFD@(DDS1FLD,"X"))
"RTN","DDS11",49,0)
 . D:Y]"" XFORM
"RTN","DDS11",50,0)
 . S @DDS1REFD@(DDS1FLD,"X")=Y
"RTN","DDS11",51,0)
 ;
"RTN","DDS11",52,0)
 I DDS1PC=0,DDS1DV,DDS1DV'["W",$D(@DDS1REFD@(DDS1FLD,"X"))[0 S ^("X")=Y
"RTN","DDS11",53,0)
 Q
"RTN","DDS11",54,0)
 ;
"RTN","DDS11",55,0)
L1 ;Get non-multiple field
"RTN","DDS11",56,0)
 S DDS1LN=$G(@(DIE_"DA,DDS1ND)"))
"RTN","DDS11",57,0)
 I $E(DDS1PC)'="E" S Y=$P(DDS1LN,U,DDS1PC)
"RTN","DDS11",58,0)
 E  S Y=$E(DDS1LN,+$E(DDS1PC,2,999),$P(DDS1PC,",",2)) S:Y?." " Y=""
"RTN","DDS11",59,0)
 ;
"RTN","DDS11",60,0)
 K @DDS1REFD@(DDS1FLD,"X")
"RTN","DDS11",61,0)
 I Y="",$D(@DDS1REFD@(DDS1FLD,"F"))[0,$D(^DIST(.404,DDSBK,40,DDS1FO,3))#2 D DEF(^(3),$G(^(3.1)))
"RTN","DDS11",62,0)
MUMPS I $G(DUZ(0))'="@",DDS1DV["K" S $P(@DDS1REFD@(DDS1FLD,"A"),U,4)=1,Y=$TR($J("",$L(Y))," ","*") ;**151
"RTN","DDS11",63,0)
 S @DDS1REFD@(DDS1FLD,"D")=Y
"RTN","DDS11",64,0)
 ;
"RTN","DDS11",65,0)
 ;Get key info
"RTN","DDS11",66,0)
 I '$D(@DDS1REFD@(DDS1FLD,"K")) D
"RTN","DDS11",67,0)
 . S DDS1KEY=0
"RTN","DDS11",68,0)
 . F  S DDS1KEY=$O(^DD("KEY","F",DDP,DDS1FLD,DDS1KEY)) Q:'DDS1KEY  D
"RTN","DDS11",69,0)
 .. S DDS1UI=$P(^DD("KEY",DDS1KEY,0),U,4) Q:'DDS1UI
"RTN","DDS11",70,0)
 .. Q:$P($G(^DD("IX",DDS1UI,0)),U,6)'="F"
"RTN","DDS11",71,0)
 .. S ^("K")=$G(@DDS1REFD@(DDS1FLD,"K"))_DDS1UI_U
"RTN","DDS11",72,0)
 Q
"RTN","DDS11",73,0)
 ;
"RTN","DDS11",74,0)
L2 ;Get multiple field
"RTN","DDS11",75,0)
 S DDS1SUB=+$P(DDS1LN,U,2) Q:$D(^DD(DDS1SUB,.01,0))[0
"RTN","DDS11",76,0)
 S DDS1DV=DDS1SUB_$P(^DD(DDS1SUB,.01,0),U,2),X=$P(^(0),U,3)
"RTN","DDS11",77,0)
 S DDS1DIC=DIE_DA_","""_DDS1ND_""","
"RTN","DDS11",78,0)
 ;
"RTN","DDS11",79,0)
 D:DDS1DV'["W"
"RTN","DDS11",80,0)
 . I $D(^DIST(.404,DDSBK,40,DDS1FO,3))#2 D  D L22
"RTN","DDS11",81,0)
 .. D DEF(^DIST(.404,DDSBK,40,DDS1FO,3),$G(^(3.1)),1)
"RTN","DDS11",82,0)
 .. S DDS1RN=$S($G(Y)="FIRST":$O(@(DDS1DIC_"0)")),$G(Y)="LAST":$O(@(DDS1DIC_""" "")"),-1),1:+$G(Y))
"RTN","DDS11",83,0)
 . E  I $D(DUZ)#2,$L(DDS1DIC)<29,$D(^DISV(DUZ,DDS1DIC))#2 S DDS1RN=^(DDS1DIC) D L22
"RTN","DDS11",84,0)
 . E  S DDS1RN=$S($D(@(DDS1DIC_"0)"))#2:$P(^(0),U,3),1:$O(^(0))) D L22
"RTN","DDS11",85,0)
 . E  S (Y,@DDS1REFD@(DDS1FLD,"D"))=""
"RTN","DDS11",86,0)
 ;
"RTN","DDS11",87,0)
 S @DDS1REFD@(DDS1FLD,"M")=$S(DDS1DV["W":0,1:1)_DDS1DIC_U_DDS1SUB
"RTN","DDS11",88,0)
 K DDS1DIC,DDS1RN,DDS1SUB
"RTN","DDS11",89,0)
 Q
"RTN","DDS11",90,0)
L22 ;
"RTN","DDS11",91,0)
 I DDS1RN>0,$D(@(DDS1DIC_+DDS1RN_",0)"))#2 S Y=$P(^(0),U),@DDS1REFD@(DDS1FLD,"D")=+DDS1RN
"RTN","DDS11",92,0)
 Q
"RTN","DDS11",93,0)
 ;
"RTN","DDS11",94,0)
DEF(DDS1LN3,DDS1LN31,DDS1MULT) ;Get default
"RTN","DDS11",95,0)
 N DDS1PTR,DDS1OT
"RTN","DDS11",96,0)
 Q:DDS1LN3=""
"RTN","DDS11",97,0)
 I DDS1LN3'="!M" S Y=DDS1LN3
"RTN","DDS11",98,0)
 E  I DDS1LN31'?."^" X DDS1LN31 S:$D(Y)[0 Y=""
"RTN","DDS11",99,0)
 Q:Y=""!$G(DDS1MULT)
"RTN","DDS11",100,0)
 ;
"RTN","DDS11",101,0)
 K DIR
"RTN","DDS11",102,0)
 I DDS1FLD["," D
"RTN","DDS11",103,0)
 . S DIR(0)=$P(^DIST(.404,DDSBK,40,DDS1FO,20),U)_$P(^(20),U,2,3)
"RTN","DDS11",104,0)
 . S:DIR(0)?1"DD".E DIR(0)=$P(DIR(0),U,2,999)
"RTN","DDS11",105,0)
 . I $E($P(DIR(0),U))="P" S DDS1PTR=1
"RTN","DDS11",106,0)
 E  D
"RTN","DDS11",107,0)
 . S DIR(0)=DDP_","_DDS1FLD
"RTN","DDS11",108,0)
 . S DDS1PTR=$P($G(^DD(DDP,DDS1FLD,0)),U,2)
"RTN","DDS11",109,0)
 . S DDS1OT=DDS1PTR["O",DDS1PTR=DDS1PTR["P"
"RTN","DDS11",110,0)
 S DIR("V")="",(X,DIR("B"))=Y
"RTN","DDS11",111,0)
 D ^DIR
"RTN","DDS11",112,0)
 ;
"RTN","DDS11",113,0)
 I DDER S Y=""
"RTN","DDS11",114,0)
 I Y]"" D
"RTN","DDS11",115,0)
 . I $G(DDS1PTR) S Y=$P(Y,U)
"RTN","DDS11",116,0)
 . S $P(@DDSREFT@("F"_DDP,DDSDA,DDS1FLD,"F"),U)=3
"RTN","DDS11",117,0)
 . I $G(DDS1PTR),$G(DDS1OT),$D(^DD(DDP,DDS1FLD,2))#2 K Y(0),Y(0,0)
"RTN","DDS11",118,0)
 . S:$D(Y(0)) @DDSREFT@("F"_DDP,DDSDA,DDS1FLD,"X")=$S($D(Y(0,0))#2:Y(0,0),1:Y(0))
"RTN","DDS11",119,0)
 . S DDSCHG=1
"RTN","DDS11",120,0)
 K DDER,DIR
"RTN","DDS11",121,0)
 Q
"RTN","DDS11",122,0)
 ;
"RTN","DDS11",123,0)
L3 ;Get number field
"RTN","DDS11",124,0)
 S (@DDS1REFD@(.001,"D"),Y)=DA
"RTN","DDS11",125,0)
 Q
"RTN","DDS11",126,0)
 ;
"RTN","DDS11",127,0)
EXT(DDP,DDS1FLD,Y) ;Return external form of Y
"RTN","DDS11",128,0)
 N DDS1DV,X
"RTN","DDS11",129,0)
 S DDS1DV=$P(^DD(DDP,DDS1FLD,0),U,2),X=$P(^(0),U,3)
"RTN","DDS11",130,0)
 I DDS1DV'["O",DDS1DV'["P",DDS1DV'["V",DDS1DV'["D",DDS1DV'["S" Q Y
"RTN","DDS11",131,0)
 I DDS1DV'["O",Y="" Q ""
"RTN","DDS11",132,0)
 D XFORM
"RTN","DDS11",133,0)
 Q Y
"RTN","DDS11",134,0)
 ;
"RTN","DDS11",135,0)
XFORM ;
"RTN","DDS11",136,0)
 N DDS1N
"RTN","DDS11",137,0)
 I DDS1DV["O",+DDS1FLD,$D(^DD(DDP,+DDS1FLD,2))#2 X ^(2) Q
"RTN","DDS11",138,0)
 I DDS1DV["P",@("$D(^"_X_"0))") S X=+$P(^(0),U,2) Q:'$D(^(Y,0))  S Y=$P(^(0),U),X=$P(^DD(X,.01,0),U,3),DDS1DV=$P(^(0),U,2) G XFORM
"RTN","DDS11",139,0)
 I DDS1DV["V",+$P(Y,"E"),$P(Y,";",2)["(",$D(@(U_$P(Y,";",2)_"0)"))#2 S X=+$P($P(^(0),U,2),"E") Q:$D(^(+$P(Y,"E"),0))[0  S Y=$P(^(0),U) I $D(^DD(+$P(X,"E"),.01,0))#2 S DDS1DV=$P(^(0),U,2),X=$P(^(0),U,3) G XFORM
"RTN","DDS11",140,0)
 I DDS1DV["D" X ^DD("DD")
"RTN","DDS11",141,0)
 I DDS1DV["S" S DDS1N=$P($P(";"_X,";"_Y_":",2),";",1) S:DDS1N]"" Y=DDS1N
"RTN","DDS11",142,0)
 Q
"RTN","DDS4")
0^6^B25495567^B25261387
"RTN","DDS4",1,0)
DDS4 ;SFISC/MKO-FILE AND RELOAD ;21SEP2006
"RTN","DDS4",2,0)
 ;;22.0;VA FileMan;**11,151**;Mar 30, 1999;Build 10
"RTN","DDS4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS4",4,0)
 D ^DDS41 Q:Y'=1
"RTN","DDS4",5,0)
 N DA,DDO,DIE,DDP,DDSDA
"RTN","DDS4",6,0)
 ;
"RTN","DDS4",7,0)
 S DX=0,DY=IOSL-1 X IOXY W "Filing form"_$P(DDGLCLR,DDGLDEL)
"RTN","DDS4",8,0)
 ;
"RTN","DDS4",9,0)
 ;File data
"RTN","DDS4",10,0)
 S DDS4FI="F"
"RTN","DDS4",11,0)
 F  S DDS4FI=$O(@DDSREFT@(DDS4FI)) Q:DDS4FI'?1"F".E  D
"RTN","DDS4",12,0)
 . S DDP=$E(DDS4FI,2,999),DDS4DA=" "
"RTN","DDS4",13,0)
 . F  S DDS4DA=$O(@DDSREFT@(DDS4FI,DDS4DA)) Q:DDS4DA=""  D REC
"RTN","DDS4",14,0)
 ;
"RTN","DDS4",15,0)
 ;Reload all pages on form
"RTN","DDS4",16,0)
 S DDS4P=0
"RTN","DDS4",17,0)
 F  S DDS4P=$O(@DDSREFT@(DDS4P)) Q:'DDS4P  D
"RTN","DDS4",18,0)
 . S DDS4B=0
"RTN","DDS4",19,0)
 . F  S DDS4B=$O(@DDSREFT@(DDS4P,DDS4B)) Q:'DDS4B  D
"RTN","DDS4",20,0)
 .. S DDP=$P(@DDSREFS@(DDS4P,DDS4B),U,3),DDSDA=" "
"RTN","DDS4",21,0)
 .. F  S DDSDA=$O(@DDSREFT@(DDS4P,DDS4B,DDSDA)) Q:'DDSDA  D
"RTN","DDS4",22,0)
 ... S $P(@DDSREFT@(DDS4P,DDS4B,DDSDA),U)=1,DIE=^(DDSDA,"GL")
"RTN","DDS4",23,0)
 ... Q:$P(@DDSREFT@(DDS4P,DDS4B,DDSDA),U,6)>1
"RTN","DDS4",24,0)
 ... D GDA(DDSDA)
"RTN","DDS4",25,0)
 ... D ^DDS11(DDS4B,1)
"RTN","DDS4",26,0)
 ;
"RTN","DDS4",27,0)
 I $G(^DIST(.403,+DDS,14))'?."^" D
"RTN","DDS4",28,0)
 . I $G(DDSPTB)_$G(DDSREP)]"" N DIE,DDP,DDSDA,DA,DDSDL D
"RTN","DDS4",29,0)
 .. S DA=DDSDAORG,DDSDL=DDSDLORG,DDSDA=DA_","
"RTN","DDS4",30,0)
 .. F DDSI=1:1:DDSDL S DA(DDSI)=DDSDAORG(DDSI),DDSDA=DDSDA_DA(DDSI)_","
"RTN","DDS4",31,0)
 .. S DDP=$P($G(DDSFLORG),U),DIE=U_$P($G(DDSFLORG),U,2) S:DIE=U DIE=""
"RTN","DDS4",32,0)
 . X ^DIST(.403,+DDS,14)
"RTN","DDS4",33,0)
 I '$G(DDSSAVE),$G(DDSPARM)["S" S DDSSAVE=1
"RTN","DDS4",34,0)
 S (Y,DDSH)=1,(DDSCHG,DX)=0,DY=IOSL-1 X IOXY W $P(DDGLCLR,DDGLDEL)
"RTN","DDS4",35,0)
 K @DDSREFT@("ADD"),@DDSREFT@("RXR")
"RTN","DDS4",36,0)
 K DIC,DDS1B,DDS1DA,DDS4B,DDS4DA,DDS4FI,DDS4FLD,DDS4FO,DDS4P
"RTN","DDS4",37,0)
 K DDSEXT,DDSI,DDSINT,DDSLC,DDSLN,DDSND,DDSOND,DDSOLD,DDSP,DDSPC
"RTN","DDS4",38,0)
 K DDSW,DDSX,DV
"RTN","DDS4",39,0)
 Q
"RTN","DDS4",40,0)
REC ;
"RTN","DDS4",41,0)
 G:DDS4FI="F0" FORMONLY
"RTN","DDS4",42,0)
 ;
"RTN","DDS4",43,0)
 S DIE=$G(@DDSREFT@(DDS4FI,DDS4DA,"GL")) I DIE="" Q  ;JUST TO BE SAFE!
"RTN","DDS4",44,0)
 D GDA(DDS4DA)
"RTN","DDS4",45,0)
 S DDSOND=-1 K DDSLN
"RTN","DDS4",46,0)
 S DDS4FLD=""
"RTN","DDS4",47,0)
 F  S DDS4FLD=$O(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD)) Q:DDS4FLD=""  D FLD
"RTN","DDS4",48,0)
 S:$D(DDSLN)#2 @(DIE_"DA,DDSND)")=DDSLN
"RTN","DDS4",49,0)
 ;
"RTN","DDS4",50,0)
 I $D(@DDSREFT@("RXR")) D
"RTN","DDS4",51,0)
 . D FIRE^DIKC(DDP,.DA,"KS",$NA(@DDSREFT@("RXR")),"O^")
"RTN","DDS4",52,0)
 . K @DDSREFT@("RXR")
"RTN","DDS4",53,0)
 Q
"RTN","DDS4",54,0)
FLD ;
"RTN","DDS4",55,0)
 Q:'$G(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"F"))  S ^("F")=""
"RTN","DDS4",56,0)
 I '$G(DDSCHANG),$G(DDSPARM)["C" S DDSCHANG=1
"RTN","DDS4",57,0)
 S DDSINT=$G(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"D"))
"RTN","DDS4",58,0)
 ;
"RTN","DDS4",59,0)
 ;Word processing fields (quit if multiple)
"RTN","DDS4",60,0)
 I $D(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"M"))#2 D:'$P(^("M"),U)  Q
"RTN","DDS4",61,0)
 . N FR,TO
"RTN","DDS4",62,0)
 . S FR=$NA(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"D"))
"RTN","DDS4",63,0)
 . S TO=U_$$CREF^DILF($P(@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"M"),U,2))
"RTN","DDS4",64,0)
 . K @TO
"RTN","DDS4",65,0)
 . M @TO=@FR
"RTN","DDS4",66,0)
 . K @FR,@DDSREFT@(DDS4FI,DDS4DA,DDS4FLD,"F")
"RTN","DDS4",67,0)
 ;
"RTN","DDS4",68,0)
 Q:$G(^DD(DDP,DDS4FLD,0))?."^"  S DDSND=$P(^(0),U,4)
"RTN","DDS4",69,0)
 S DDSPC=$P(DDSND,";",2) Q:"0 "[DDSPC
"RTN","DDS4",70,0)
 S DDSND=$P(DDSND,";")
"RTN","DDS4",71,0)
 ;
"RTN","DDS4",72,0)
 I DDSOND'=DDSND D
"RTN","DDS4",73,0)
 . S:$D(DDSLN)#2 @(DIE_"DA,DDSOND)")=DDSLN
"RTN","DDS4",74,0)
 . S DDSLN=$G(@(DIE_"DA,DDSND)"))
"RTN","DDS4",75,0)
 . S DDSOND=DDSND
"RTN","DDS4",76,0)
 ;
"RTN","DDS4",77,0)
 I DDSPC D
"RTN","DDS4",78,0)
 . S DDSOLD=$P(DDSLN,U,DDSPC)
"RTN","DDS4",79,0)
 . S $P(DDSLN,U,DDSPC)=DDSINT
"RTN","DDS4",80,0)
 E  D
"RTN","DDS4",81,0)
 . S DDSW=$E(DDSPC,2,999),DDSP=$P(DDSW,",",2)+1
"RTN","DDS4",82,0)
 . S DDSOLD=$E(DDSLN,+DDSW,DDSP-1)
"RTN","DDS4",83,0)
 . S DDSX=$E(DDSLN,DDSP,999)
"RTN","DDS4",84,0)
 . S DDSLN=$E(DDSLN,1,DDSW-1)_$J("",DDSW-1-$L(DDSLN))_DDSINT
"RTN","DDS4",85,0)
 . S:DDSX'?." " DDSLN=DDSLN_$J("",DDSP-DDSW-$L(DDSINT))_DDSX
"RTN","DDS4",86,0)
 ;
"RTN","DDS4",87,0)
 I $D(^DD(DDP,DDS4FLD,1))!($P(^(0),U,2)["a")!$D(^DD("IX","F",DDP,DDS4FLD)) D XR
"RTN","DDS4",88,0)
 Q
"RTN","DDS4",89,0)
XR ;
"RTN","DDS4",90,0)
 N DICRREC,DG,DP,DDS4AUD1,DDS4AUD2,DIANUM,DIIX,C,Y
"RTN","DDS4",91,0)
 S DP=DDP,DDSOND=-1
"RTN","DDS4",92,0)
 I $D(DDSLN)#2 S @(DIE_"DA,DDSND)")=DDSLN K DDSLN
"RTN","DDS4",93,0)
 S DICRREC="TRIG^DDS4"
"RTN","DDS4",94,0)
 ;
"RTN","DDS4",95,0)
 I $P(^DD(DDP,DDS4FLD,0),U,2)["a" D
"RTN","DDS4",96,0)
 . S (DDS4AUD1,DDS4AUD2)=1
"RTN","DDS4",97,0)
 . I $G(^DD(DDP,DDS4FLD,"AUDIT"))["e",DDSOLD="" S DDS4AUD1=0
"RTN","DDS4",98,0)
 ;
"RTN","DDS4",99,0)
 I DDSOLD]"" D
"RTN","DDS4",100,0)
 . S DG=0 F  S DG=$O(^DD(DDP,DDS4FLD,1,DG)) Q:DG<1  D
"RTN","DDS4",101,0)
 .. S DIC=DIE,X=DDSOLD
"RTN","DDS4",102,0)
 .. X:$D(^DD(DDP,DDS4FLD,1,DG,2))#2 ^(2)
"RTN","DDS4",103,0)
 . I $G(DDS4AUD2) S DG=1,X=DDSOLD,DIIX="2^"_DDS4FLD D AUDIT^DIET
"RTN","DDS4",104,0)
 ;
"RTN","DDS4",105,0)
 I DDSINT]"" D
"RTN","DDS4",106,0)
 . S DG=0 F  S DG=$O(^DD(DDP,DDS4FLD,1,DG)) Q:DG<1  D
"RTN","DDS4",107,0)
 .. S DIC=DIE,X=DDSINT
"RTN","DDS4",108,0)
 .. X:$D(^DD(DDP,DDS4FLD,1,DG,1))#2 ^(1)
"RTN","DDS4",109,0)
 . I $G(DDS4AUD1) S DG=1,X=DDSINT,DIIX="3^"_DDS4FLD D AUDIT^DIET
"RTN","DDS4",110,0)
 Q:'$D(^DD("IX","F",DDP,DDS4FLD))
"RTN","DDS4",111,0)
 ;
"RTN","DDS4",112,0)
 ;Process index file xrefs
"RTN","DDS4",113,0)
 N DDSFXR,DDSFXREF,DDSRXREF
"RTN","DDS4",114,0)
 D LOADFLD^DIKC1(DDP,DDS4FLD,"KS","",$NA(@DDSREFT@("F"))_"_","DDSFXR",$NA(@DDSREFT@("RXR")),.DDSFXREF,.DDSRXREF)
"RTN","DDS4",115,0)
 I $G(DDSRXREF)]""!($G(DDSFXREF)]"") D
"RTN","DDS4",116,0)
 . S @DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"O")=DDSOLD ;BRX-0404-11337
"RTN","DDS4",117,0)
 D:$G(DDSFXREF)]"" FIRE^DIKC(DDP,.DA,"KS","DDSFXR","O^")
"RTN","DDS4",118,0)
 Q
"RTN","DDS4",119,0)
GDA(DDSDA) ;
"RTN","DDS4",120,0)
 N I
"RTN","DDS4",121,0)
 K DA S DA=$P(DDSDA,",")
"RTN","DDS4",122,0)
 F I=2:1:$L(DDSDA,",")-1 S DA(I-1)=$P(DDSDA,",",I)
"RTN","DDS4",123,0)
 Q
"RTN","DDS4",124,0)
 ;
"RTN","DDS4",125,0)
FORMONLY ;
"RTN","DDS4",126,0)
 N X
"RTN","DDS4",127,0)
 D GDA(DDS4DA)
"RTN","DDS4",128,0)
 S DDS4FLD=""
"RTN","DDS4",129,0)
 F  S DDS4FLD=$O(@DDSREFT@("F0",DDS4DA,DDS4FLD)) Q:DDS4FLD=""  D
"RTN","DDS4",130,0)
 . Q:'$G(@DDSREFT@("F0",DDS4DA,DDS4FLD,"F"))
"RTN","DDS4",131,0)
 . S DDS4FO=$P(DDS4FLD,","),DDS4B=$P(DDS4FLD,",",2)
"RTN","DDS4",132,0)
 . S DDSOLD=$G(@DDSREFT@("F0",DDS4DA,DDS4FLD,"O")),X=$G(^("D")),DDSEXT=$G(^("X"),X)
"RTN","DDS4",133,0)
 . X:$G(^DIST(.404,DDS4B,40,DDS4FO,23))'?."^" ^(23)
"RTN","DDS4",134,0)
 . S ^("O")=@DDSREFT@("F0",DDS4DA,DDS4FLD,"D"),^("F")=""
"RTN","DDS4",135,0)
 Q
"RTN","DDS4",136,0)
 ;
"RTN","DDS4",137,0)
TRIG ;Called from trigger logic (from DICR via DICRREC)
"RTN","DDS4",138,0)
 N DDSRXREF
"RTN","DDS4",139,0)
 D LOADFLD^DIKC1(DIH,DIG,"KS","",$NA(@DDSREFT@("F"))_"_","",$NA(@DDSREFT@("RXR")),"",.DDSRXREF)
"RTN","DDS4",140,0)
 I $G(DDSRXREF)]"",'$D(@DDSREFT@("F"_DIH,DICRIENS,DIG,"O")) S ^("O")=DIU
"RTN","DDS4",141,0)
 Q
"RTN","DDS41")
0^3^B34976567^B34840273
"RTN","DDS41",1,0)
DDS41 ;SFISC/MKO-VERIFY DATA ;21SEP2006
"RTN","DDS41",2,0)
 ;;22.0;VA FileMan;**8,151**;Mar 30, 1999;Build 10
"RTN","DDS41",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDS41",4,0)
 N DDO,DIERR
"RTN","DDS41",5,0)
 N DDS4B,DDS4DA,DDS4DONE,DDS4ERR,DDS4FLD,DDS4OUT,DDS4PG,DDS4PG1,DDS4TP
"RTN","DDS41",6,0)
 N DDSCAP,DDSERROR,DDSFDA,DDSI,DDSKEY,DDSPID,DDSREQ
"RTN","DDS41",7,0)
 ;
"RTN","DDS41",8,0)
 S DDS4OUT=$NA(@DDSREFT@("VALMSG"))
"RTN","DDS41",9,0)
 S DDS4PG=DDSPG
"RTN","DDS41",10,0)
 ;
"RTN","DDS41",11,0)
 K @DDS4OUT,@DDSREFT@("MSG"),@DDSREFT@("KMSG")
"RTN","DDS41",12,0)
 ;
"RTN","DDS41",13,0)
 I $G(DDSPTB)_$G(DDSREP)]"" N DIE,DDP,DDSDA,DA,DDSDL D
"RTN","DDS41",14,0)
 . S DA=DDSDAORG,DDSDL=DDSDLORG,DDSDA=DA_","
"RTN","DDS41",15,0)
 . F DDSI=1:1:DDSDL S DA(DDSI)=DDSDAORG(DDSI),DDSDA=DDSDA_DA(DDSI)_","
"RTN","DDS41",16,0)
 . S DDP=$P($G(DDSFLORG),U),DIE=U_$P($G(DDSFLORG),U,2) S:DIE=U DIE=""
"RTN","DDS41",17,0)
 ;
"RTN","DDS41",18,0)
 D LDALL
"RTN","DDS41",19,0)
 I $G(DIERR) D  G END
"RTN","DDS41",20,0)
 . N P
"RTN","DDS41",21,0)
 . S P(1)=$P($G(^DIST(.403,+DDS,40,DDSPG,0)),U),P(2)=$P($G(^(1)),U)
"RTN","DDS41",22,0)
 . S:P(2)="" P(2)="unnamed"
"RTN","DDS41",23,0)
 . D BLD^DIALOG(3041,.P),ERR^DDSMSG ;PAGE COULD NOT BE LOADED
"RTN","DDS41",24,0)
 . S DDS4ERR=1
"RTN","DDS41",25,0)
 ;
"RTN","DDS41",26,0)
 D LP
"RTN","DDS41",27,0)
 ;
"RTN","DDS41",28,0)
 ;Validate keys
"RTN","DDS41",29,0)
 S DDSKEY=1
"RTN","DDS41",30,0)
 I $D(DDSFDA) D
"RTN","DDS41",31,0)
 . S DDSKEY=$$KEYVAL^DIE("","DDSFDA",$NA(@DDSREFT@("KMSG")))
"RTN","DDS41",32,0)
 . I 'DDSKEY,$D(DDS4ERR)[0 S DDS4ERR=1 D BLD^DIALOG(3091,"","",DDS4OUT,"S")
"RTN","DDS41",33,0)
 ;
"RTN","DDS41",34,0)
 S DDSPG=DDS4PG
"RTN","DDS41",35,0)
 I '$G(DDS4ERR),$G(^DIST(.403,+DDS,20))'?."^" X ^(20)
"RTN","DDS41",36,0)
 I $G(@DDSREFT@("MSG"))>0!$G(DDS4ERR)!'DDSKEY D PRNT
"RTN","DDS41",37,0)
 ;
"RTN","DDS41",38,0)
END S Y='$D(DDSERROR)&'$G(DDS4ERR)&$G(DDSKEY)
"RTN","DDS41",39,0)
 K @DDS4OUT,@DDSREFT@("MSG"),@DDSREFT@("KMSG")
"RTN","DDS41",40,0)
 Q
"RTN","DDS41",41,0)
 ;
"RTN","DDS41",42,0)
LDALL ;Load all pages
"RTN","DDS41",43,0)
 S DX=0,DY=IOSL-1 X IOXY
"RTN","DDS41",44,0)
 W "Please wait.  Loading all pages ..."_$P(DDGLCLR,DDGLDEL)
"RTN","DDS41",45,0)
 S (DDSPG,DDS4PG1)=$O(^DIST(.403,+DDS,40,"B",$S($G(DDSPAGE)]"":DDSPAGE,1:1),""))
"RTN","DDS41",46,0)
 S Y=1
"RTN","DDS41",47,0)
 F  D ^DDS1(DDSPG) Q:$G(DIERR)  S DDSPG=$$NP^DDS5(.Y) Q:DDSPG=DDS4PG1!'Y
"RTN","DDS41",48,0)
 Q
"RTN","DDS41",49,0)
 ;
"RTN","DDS41",50,0)
LP ;Loop through all pages/blocks
"RTN","DDS41",51,0)
 N DDP
"RTN","DDS41",52,0)
 S DX=0,DY=IOSL-1 X IOXY
"RTN","DDS41",53,0)
 W "Verifying ..."_$P(DDGLCLR,DDGLDEL)
"RTN","DDS41",54,0)
 ;
"RTN","DDS41",55,0)
 S DDSPG=0 F  S DDSPG=$O(@DDSREFT@(DDSPG)) Q:'DDSPG  D
"RTN","DDS41",56,0)
 . S DDS4B=0 F  S DDS4B=$O(@DDSREFT@(DDSPG,DDS4B)) Q:'DDS4B  D
"RTN","DDS41",57,0)
 .. Q:$D(DDS4DONE(DDS4B))  Q:$P(@DDSREFS@(DDSPG,DDS4B),U,5)'="e"
"RTN","DDS41",58,0)
 .. S DDSPID=$S($P($G(^DIST(.403,+DDS,40,DDSPG,1)),U)]"":$P(^(1),U),1:"Page "_$P(^(0),U))
"RTN","DDS41",59,0)
 .. S DDS4DONE(DDS4B)="",DDP=$P(^DIST(.404,DDS4B,0),U,2)
"RTN","DDS41",60,0)
 .. S DDO=0 F  S DDO=$O(^DIST(.404,DDS4B,40,DDO)) Q:'DDO  D VF
"RTN","DDS41",61,0)
 Q
"RTN","DDS41",62,0)
 ;
"RTN","DDS41",63,0)
VF ;Check required and key fields
"RTN","DDS41",64,0)
 Q:$D(^DIST(.404,DDS4B,40,DDO,0))[0  S DDS4TP=$P(^(0),U,3)
"RTN","DDS41",65,0)
 Q:DDS4TP=1  Q:DDS4TP=4
"RTN","DDS41",66,0)
 S DDSCAP=$P(^DIST(.404,DDS4B,40,DDO,0),U,2)_$S($P(^(0),U,4)]"":" ("_$P(^(0),U,4)_")",1:"")
"RTN","DDS41",67,0)
 S DDSREQ=$P($G(^DIST(.404,DDS4B,40,DDO,4)),U)
"RTN","DDS41",68,0)
 S DDSKEY=0
"RTN","DDS41",69,0)
 ;
"RTN","DDS41",70,0)
 I DDS4TP=2 N DDP D
"RTN","DDS41",71,0)
 . S DDP=0,DDS4FLD=DDO_","_DDS4B
"RTN","DDS41",72,0)
 . S:DDSCAP="" DDSCAP=$P(^DIST(.404,DDS4B,40,DDO,0),U,5)
"RTN","DDS41",73,0)
 ;
"RTN","DDS41",74,0)
 E  D  Q:DDS4FLD'=+$P(DDS4FLD,"E")
"RTN","DDS41",75,0)
 . S DDS4FLD=$G(^DIST(.404,DDS4B,40,DDO,1))
"RTN","DDS41",76,0)
 . I $G(^DD(DDP,DDS4FLD,0))?."^" S DDS4FLD="" Q
"RTN","DDS41",77,0)
 . S:DDSCAP="" DDSCAP=$S($G(^DD(DDP,DDS4FLD,.1))]"":^(.1),1:$P(^(0),U))
"RTN","DDS41",78,0)
 . S:DDSREQ="" DDSREQ=$P(^DD(DDP,DDS4FLD,0),U,2)["R"
"RTN","DDS41",79,0)
 . S DDSKEY=$D(^DD("KEY","F",DDP,DDS4FLD))>0
"RTN","DDS41",80,0)
 ;
"RTN","DDS41",81,0)
 S DDS4DA=" "
"RTN","DDS41",82,0)
 F  S DDS4DA=$O(@DDSREFT@(DDSPG,DDS4B,DDS4DA)) Q:DDS4DA=""  D
"RTN","DDS41",83,0)
 . I $P(@DDSREFT@(DDSPG,DDS4B,DDS4DA),U,6)<2 D VR Q
"RTN","DDS41",84,0)
 . ;
"RTN","DDS41",85,0)
 . N DDS4PDA S DDS4PDA=DDS4DA N DDS4DA
"RTN","DDS41",86,0)
 . S DDS4DA=""
"RTN","DDS41",87,0)
 . F  S DDS4DA=$O(@DDSREFT@(DDSPG,DDS4B,DDS4PDA,"B",DDS4DA)) Q:'DDS4DA  D VR
"RTN","DDS41",88,0)
 Q
"RTN","DDS41",89,0)
 ;
"RTN","DDS41",90,0)
VR ;Check individual records
"RTN","DDS41",91,0)
 I $P($G(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"A")),U)]"" N DDSREQ S DDSREQ=$P(^("A"),U)
"RTN","DDS41",92,0)
 I 'DDSREQ,'DDSKEY Q
"RTN","DDS41",93,0)
 ;
"RTN","DDS41",94,0)
 ;Required WP fields (quit if mult)
"RTN","DDS41",95,0)
 I DDP,$D(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"M")) D:'^("M")  Q
"RTN","DDS41",96,0)
 . N DDS4I,DDS4REF,DDS4VAL
"RTN","DDS41",97,0)
 . I $G(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"F")) S DDS4REF=$NA(^("D"))
"RTN","DDS41",98,0)
 . E  S DDS4REF=$P(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"M"),U,2),DDS4REF=U_$E(DDS4REF,1,$L(DDS4REF)-1)_")"
"RTN","DDS41",99,0)
 . S (DDS4VAL,DDS4I)=0
"RTN","DDS41",100,0)
 . F  S DDS4I=$O(@DDS4REF@(DDS4I)) Q:'DDS4I  I $G(@DDS4REF@(DDS4I,0))'?." " S DDS4VAL=1 Q
"RTN","DDS41",101,0)
 . D:'DDS4VAL LDERR
"RTN","DDS41",102,0)
 ;
"RTN","DDS41",103,0)
 I $G(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"D"))="" D LDERR Q
"RTN","DDS41",104,0)
 ;
"RTN","DDS41",105,0)
 I DDSKEY,$D(@DDSREFT@("F"_DDP,DDS4DA,DDS4FLD,"F")) S DDSFDA(DDP,DDS4DA,DDS4FLD)=$G(^("D"))
"RTN","DDS41",106,0)
 Q
"RTN","DDS41",107,0)
 ;
"RTN","DDS41",108,0)
LDERR ;Call ^DIALOG to load error
"RTN","DDS41",109,0)
 N P
"RTN","DDS41",110,0)
 I $D(DDS4ERR)[0 S DDS4ERR=1 D BLD^DIALOG(3091,"","",DDS4OUT,"S")
"RTN","DDS41",111,0)
 S P(1)=DDSPID,P(2)=DDSCAP,P(3)=""
"RTN","DDS41",112,0)
 I $L(DDS4DA,",")>2 D
"RTN","DDS41",113,0)
 . N Y,C
"RTN","DDS41",114,0)
 . S P(3)=$P(@(@DDSREFT@(DDSPG,DDS4B,$G(DDS4PDA,DDS4DA),"GL")_+DDS4DA_",0)"),U)
"RTN","DDS41",115,0)
 . Q:P(3)=""
"RTN","DDS41",116,0)
 . S Y=P(3),C=$P(^DD(DDP,.01,0),U,2) D Y^DIQ S P(3)=Y
"RTN","DDS41",117,0)
 . S P(3)="(Subrecord: "_P(3)_")"
"RTN","DDS41",118,0)
 D BLD^DIALOG(3092,.P,"",DDS4OUT,"S")
"RTN","DDS41",119,0)
 Q
"RTN","DDS41",120,0)
 ;
"RTN","DDS41",121,0)
PRNT ;Print messages
"RTN","DDS41",122,0)
 N DDSABT
"RTN","DDS41",123,0)
 S (DDSABT,DX,DY)=0 X IOXY
"RTN","DDS41",124,0)
 W $P(DDGLCLR,DDGLDEL,2)
"RTN","DDS41",125,0)
 S $X=0,$Y=0
"RTN","DDS41",126,0)
 ;
"RTN","DDS41",127,0)
 ;Print required field messages
"RTN","DDS41",128,0)
 I $G(DDS4ERR) S DDSI=0 F  S DDSI=$O(@DDS4OUT@(DDSI)) Q:'DDSI  D  Q:DDSABT
"RTN","DDS41",129,0)
 . D:$G(@DDS4OUT@(DDSI))]"" WLIN(^(DDSI))
"RTN","DDS41",130,0)
 ;
"RTN","DDS41",131,0)
 ;Print duplicate key messages
"RTN","DDS41",132,0)
 S DDSI=0 F  S DDSI=$O(@DDSREFT@("KMSG","DIERR",DDSI)) Q:'DDSI  D  Q:DDSABT
"RTN","DDS41",133,0)
 . D WLIN(" "),WLIN(@DDSREFT@("KMSG","DIERR",DDSI,"TEXT",1))
"RTN","DDS41",134,0)
 . Q:@DDSREFT@("KMSG","DIERR",DDSI)'=740
"RTN","DDS41",135,0)
 . ;
"RTN","DDS41",136,0)
 . N DA,FIL,FILE,FLD,FLDS,FNAME,IENS,J,KEY,LEV,RNAME
"RTN","DDS41",137,0)
 . S FILE=@DDSREFT@("KMSG","DIERR",DDSI,"PARAM","FILE"),IENS=$G(^("IENS")),KEY=$G(^("KEY"))
"RTN","DDS41",138,0)
 . D FRNAME^DIKCU1(FILE,IENS,.FNAME,.RNAME,.LEV)
"RTN","DDS41",139,0)
 . ;
"RTN","DDS41",140,0)
 . I LEV D
"RTN","DDS41",141,0)
 .. S FNAME=$J("",7)_"Subfile: "_FNAME D WLIN(.FNAME,16)
"RTN","DDS41",142,0)
 .. S RNAME=$J("",8)_"Record: "_RNAME D WLIN(.RNAME,16)
"RTN","DDS41",143,0)
 . ;
"RTN","DDS41",144,0)
 . S FLDS="",J=0 F  S J=$O(^DD("KEY",KEY,2,J)) Q:'J  D
"RTN","DDS41",145,0)
 .. Q:'$D(^DD("KEY",KEY,2,J,0))  S FLD=$P(^(0),U),FIL=$P(^(0),U,2)
"RTN","DDS41",146,0)
 .. Q:'$D(^DD(FIL,FLD,0))  S FLDS=FLDS_$P(^(0),U)_" (#"_FLD_"), "
"RTN","DDS41",147,0)
 . D:FLDS]"" WLIN("  Key Field(s): "_$E(FLDS,1,$L(FLDS)-2),16)
"RTN","DDS41",148,0)
 ;
"RTN","DDS41",149,0)
 ;Print developer messages
"RTN","DDS41",150,0)
 S DDSI=0 F  S DDSI=$O(@DDSREFT@("MSG",DDSI)) Q:'DDSI  D  Q:DDSABT
"RTN","DDS41",151,0)
 . D:@DDSREFT@("MSG",DDSI)]"" WLIN(^(DDSI))
"RTN","DDS41",152,0)
 ;
"RTN","DDS41",153,0)
 D EOP
"RTN","DDS41",154,0)
 Q
"RTN","DDS41",155,0)
 ;
"RTN","DDS41",156,0)
WLIN(DDSX,DDSINDNT) ;Write a single line, wrap at word boundaries
"RTN","DDS41",157,0)
 N I
"RTN","DDS41",158,0)
 D WRAP^DIKCU2(.DDSX,IOM-1-$G(DDSINDNT),IOM-1)
"RTN","DDS41",159,0)
 S DDSX(0)=DDSX
"RTN","DDS41",160,0)
 F I=0:1 Q:'$D(DDSX(I))  D  Q:DDSABT
"RTN","DDS41",161,0)
 . I $Y+4>IOSL D EOP I 'Y S DDSABT=1 Q
"RTN","DDS41",162,0)
 . W !,$J("",$S(I:$G(DDSINDNT),1:0))_DDSX(I)
"RTN","DDS41",163,0)
 Q
"RTN","DDS41",164,0)
EOP ;Issue EOP prompt
"RTN","DDS41",165,0)
 N X
"RTN","DDS41",166,0)
 S DX=0,DY=IOSL-1 X IOXY
"RTN","DDS41",167,0)
 R "Press RETURN to continue: ",X:DTIME
"RTN","DDS41",168,0)
 S Y=X'[U&$T
"RTN","DDS41",169,0)
 I Y S (DX,DY)=0 X IOXY W $P(DDGLCLR,DDGLDEL,2) S $X=0,$Y=0
"RTN","DDS41",170,0)
 Q
"RTN","DDSRUN")
0^4^B2550961^B2301260
"RTN","DDSRUN",1,0)
DDSRUN ;SFISC/MKO-RUN A FORM ;21SEP2006
"RTN","DDSRUN",2,0)
 ;;22.0;VA FileMan;**151**;Mar 30, 1999;Build 10
"RTN","DDSRUN",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDSRUN",4,0)
 ;
"RTN","DDSRUN",5,0)
 ;Select file (DDSFILE)
"RTN","DDSRUN",6,0)
 S DDS1="RUN FORM FROM" D W^DICRW K DDS1 G:Y<0 RUNQ
"RTN","DDSRUN",7,0)
 G:'$D(@(DIC_"0)")) RUNQ
"RTN","DDSRUN",8,0)
 K DDSFILE S DDSFILE=+Y
"RTN","DDSRUN",9,0)
 ;
"RTN","DDSRUN",10,0)
 ;Select form (DDSRUNDR)
"RTN","DDSRUN",11,0)
 K DIC
"RTN","DDSRUN",12,0)
 S DIC=.403,DIC(0)="QEA",D="F"_+Y
"RTN","DDSRUN",13,0)
 S DIC("S")="I $P(^(0),U,8)=+DDSFILE"
"RTN","DDSRUN",14,0)
 I DUZ(0)'="@" S DIC("S")=DIC("S")_" N DDSI F DDSI=1:1:$L($P(^(0),U,2)) I DUZ(0)[$E($P(^(0),U,2),DDSI) Q"
"RTN","DDSRUN",15,0)
 W ! D IX^DIC K DIC,D G:Y<0 RUNQ
"RTN","DDSRUN",16,0)
 S DDSRUNDR=+Y
"RTN","DDSRUN",17,0)
 ;
"RTN","DDSRUN",18,0)
 I '$$COMPILED^DDS0(DDSRUNDR) D EN^DDSZ(DDSRUNDR) G:$G(DIERR) RUNQ
"RTN","DDSRUN",19,0)
 ;
"RTN","DDSRUN",20,0)
 ;Select page (DDSPAGE)
"RTN","DDSRUN",21,0)
PAGE K DIR S Y=$O(^DIST(.403,DDSRUNDR,40,0)) I '$O(^(Y)) S DDSPAGE=1 G REC
"RTN","DDSRUN",22,0)
 S DIR(0)="NOA^1:999.9:1"
"RTN","DDSRUN",23,0)
 S DIR("A")="Enter number of first page: ",DIR("B")=1
"RTN","DDSRUN",24,0)
 W ! D ^DIR K DIR G:$D(DIRUT) RUNQ
"RTN","DDSRUN",25,0)
 K DDSPAGE S:Y'=1 DDSPAGE=Y
"RTN","DDSRUN",26,0)
 ;
"RTN","DDSRUN",27,0)
REC ;Select record (DA)
"RTN","DDSRUN",28,0)
 K DA
"RTN","DDSRUN",29,0)
 I '$P(^DIST(.403,DDSRUNDR,0),U,10) D  G:DA<0 RUNQ
"RTN","DDSRUN",30,0)
 . S DIC=DDSFILE,DIC(0)="QEALM"
"RTN","DDSRUN",31,0)
 . W ! D ^DIC K DIC
"RTN","DDSRUN",32,0)
 . S DA=+Y
"RTN","DDSRUN",33,0)
 K D,DIC,X,Y
"RTN","DDSRUN",34,0)
 ;
"RTN","DDSRUN",35,0)
 ;Invoke form
"RTN","DDSRUN",36,0)
 K DR S DR=DDSRUNDR D ^DDS G:$D(DA) REC
"RTN","DDSRUN",37,0)
 ;
"RTN","DDSRUN",38,0)
RUNQ ;Clean up and quit
"RTN","DDSRUN",39,0)
 I $D(DIERR) W !,$C(7) D MSG^DIALOG("BW")
"RTN","DDSRUN",40,0)
 K D,DIC,X,Y
"RTN","DDSRUN",41,0)
 K DDSFILE,DDSPAGE,DDSRUNDR,DA,DR
"RTN","DDSRUN",42,0)
 K DIRUT,DTOUT,DUOUT
"RTN","DDSRUN",43,0)
 Q
"RTN","DDSU")
0^7^B22175755^B21268869
"RTN","DDSU",1,0)
DDSU ;SFISC/MLH-PROCESS HELP ;10:48 AM  6 Sep 2006
"RTN","DDSU",2,0)
 ;;22.0;VA FileMan;**4,3,54,151**;Mar 30, 1999;Build 10
"RTN","DDSU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DDSU",4,0)
LIST ;
"RTN","DDSU",5,0)
 D FM:'$D(DDS),SC:$D(DDS)
"RTN","DDSU",6,0)
 Q
"RTN","DDSU",7,0)
 ;
"RTN","DDSU",8,0)
SC ;Screen Help
"RTN","DDSU",9,0)
 N A0,A1,A2,A3,A4,A5,A6,DDSB1,X,Y
"RTN","DDSU",10,0)
 K DTOUT,DUOUT
"RTN","DDSU",11,0)
 ;
"RTN","DDSU",12,0)
 W $P(DDGLVID,DDGLDEL,9) S X=$G(IOM,80)-1 X ^%ZOSF("RM")
"RTN","DDSU",13,0)
 I $D(DDQ)#2,DDQ<(IOSL-1),DDQ>DDSHBX!$P(DDQ,U,2)!$D(DDIOL) S DY=$P(DDQ,U),DX=$P(DDQ,U,2)
"RTN","DDSU",14,0)
 E  D CLRMSG^DDS S DY=DDSHBX
"RTN","DDSU",15,0)
 X DDXY
"RTN","DDSU",16,0)
 ;
"RTN","DDSU",17,0)
 S:$G(DDD,5)=5 DDD=1
"RTN","DDSU",18,0)
 S:$D(DDO) DDSB1=DDO
"RTN","DDSU",19,0)
 S DDM=1,DDO=.5
"RTN","DDSU",20,0)
 S (A0,DIY,X)="",A1=0,A5=$S(DDD=2:$O(DS(0)),1:$O(DDH(A0)))
"RTN","DDSU",21,0)
 K A2,DDSQ
"RTN","DDSU",22,0)
 ;
"RTN","DDSU",23,0)
 F  D SC1 Q:DDO'<1!(X=U)!'A0!DIY!$D(DTOUT)!$D(DUOUT)
"RTN","DDSU",24,0)
 ;
"RTN","DDSU",25,0)
 I $D(DDSB1) S:DDO<1 DDO=DDSB1
"RTN","DDSU",26,0)
 E  K DDO
"RTN","DDSU",27,0)
 ;
"RTN","DDSU",28,0)
 S %=0
"RTN","DDSU",29,0)
 S DDQ=$S(DY>(IOSL-1):IOSL-1,1:DY)_U_DX
"RTN","DDSU",30,0)
 S:DDQ>DDSHBX DDM=1
"RTN","DDSU",31,0)
 I $D(A2) K DDD,DDH,DDQ S %=A2 S:%'=1 DDSQ=1 D CLRMSG^DDS G QQ
"RTN","DDSU",32,0)
 I $D(DDC),DDC'<0 D SV
"RTN","DDSU",33,0)
 E  K DDD,DDH S DDSQ=1
"RTN","DDSU",34,0)
 ;
"RTN","DDSU",35,0)
QQ S A0=$X S X=0 X ^%ZOSF("RM") W $P(DDGLVID,DDGLDEL,8) S $X=A0
"RTN","DDSU",36,0)
 Q
"RTN","DDSU",37,0)
 ;
"RTN","DDSU",38,0)
SC1 S A6=A0,A0=$O(DDH(A0)) S:A6="" A6=A0-1
"RTN","DDSU",39,0)
 I 'A0,DDD Q:DDD=1  Q:DD<DS
"RTN","DDSU",40,0)
 ;
"RTN","DDSU",41,0)
 S A4=$O(DDH(+A0,""))
"RTN","DDSU",42,0)
 I A4'="X"!(DY'>DDSHBX) S DY=DY+1 X DDXY
"RTN","DDSU",43,0)
 I A4="E" D SC2 Q
"RTN","DDSU",44,0)
 ;
"RTN","DDSU",45,0)
 I $D(DDSCTRL) S:+DDSCTRL'=DDSCTRL!(DDSCTRL>3)!(DDSCTRL<1)!(DDSCTRL?.E1"."1N.N) DDSCTRL=2 ;DI*151
"RTN","DDSU",46,0)
 I $Y'<(IOSL-($G(DDSCTRL,2)))!'A0 D SC2 Q:DDO'<1!(X=U)!'A0!DIY!$D(DTOUT)!$D(DUOUT)  S DY=DDSHBX+1,DX=0 X DDXY ;DI*151
"RTN","DDSU",47,0)
 Q:A4=""
"RTN","DDSU",48,0)
 ;
"RTN","DDSU",49,0)
 D WR
"RTN","DDSU",50,0)
 ;
"RTN","DDSU",51,0)
 I $Y'<(IOSL-1),'$D(DTOUT),'$D(DUOUT) D  Q
"RTN","DDSU",52,0)
 . W ! D SC2
"RTN","DDSU",53,0)
 . W $P(DDGLVID,DDGLDEL,8) S X=0 X ^%ZOSF("RM") D REFRESH^DDSUTL
"RTN","DDSU",54,0)
 . W $P(DDGLVID,DDGLDEL,9) S X=$G(IOM,80)-1 X ^%ZOSF("RM")
"RTN","DDSU",55,0)
 . S DX=0,DY=DDSHBX X DDXY
"RTN","DDSU",56,0)
 ;
"RTN","DDSU",57,0)
 S DY=$Y,DX=0
"RTN","DDSU",58,0)
 Q
"RTN","DDSU",59,0)
 ;
"RTN","DDSU",60,0)
SC2 S DX=0,DY=IOSL-1 X DDXY
"RTN","DDSU",61,0)
 W $S(DDD=1:$$EZBLD^DIALOG(8053),1:$$EZBLD^DIALOG(8081,A5_"-"_A6))_$P(DDGLCLR,DDGLDEL)
"RTN","DDSU",62,0)
 ;
"RTN","DDSU",63,0)
 R X:DTIME E  S DTOUT=1 K DDC G Q2
"RTN","DDSU",64,0)
 I X?1."^" S DUOUT=1,X=U K DDC G Q2
"RTN","DDSU",65,0)
 ;
"RTN","DDSU",66,0)
 I X]"",X<A5!(X>A6) W $C(7) G SC2
"RTN","DDSU",67,0)
 E  I X S:DDD["J" DDO=$O(DDH(X,"")) K DDC
"RTN","DDSU",68,0)
 D CLRMSG^DDS
"RTN","DDSU",69,0)
 S DDM=1
"RTN","DDSU",70,0)
 ;
"RTN","DDSU",71,0)
Q2 S DIY=X,DY=DDSHBX
"RTN","DDSU",72,0)
 Q
"RTN","DDSU",73,0)
 ;
"RTN","DDSU",74,0)
ASK W $P(A4,U,2)_$S(%'>2:"? ",1:"")_$S(%>0&(%<3):$P($$EZBLD^DIALOG(7001),U,%)_"// ",1:"")_$P(DDGLCLR,DDGLDEL)
"RTN","DDSU",75,0)
 S A2=0
"RTN","DDSU",76,0)
 R X:$G(DTIME,300) E  S DTOUT=1,A2=-1 Q
"RTN","DDSU",77,0)
 ;
"RTN","DDSU",78,0)
 I %>2 S A2=X Q
"RTN","DDSU",79,0)
 ;
"RTN","DDSU",80,0)
 N %1 S %1=$$PRS^DIALOGU(7001,X) S:%1>0 X=$E($P(%1,U,2))
"RTN","DDSU",81,0)
 K %1
"RTN","DDSU",82,0)
 ;
"RTN","DDSU",83,0)
 I "YyNn^"'[X W $C(7) X DDXY G ASK
"RTN","DDSU",84,0)
 I X]"","^Nn"[X S A2=2 K DDC Q
"RTN","DDSU",85,0)
 S:"Yy"[X A2=1
"RTN","DDSU",86,0)
 S:X=""&(%]"") A2=+%
"RTN","DDSU",87,0)
 S DDD=1
"RTN","DDSU",88,0)
 Q
"RTN","DDSU",89,0)
 ;
"RTN","DDSU",90,0)
SV ;Kill DDH array, but save the "ID" nodes and DDH itself
"RTN","DDSU",91,0)
 K A1,A2
"RTN","DDSU",92,0)
 S:$D(DDH("ID")) A1=DDH("ID")
"RTN","DDSU",93,0)
 S:$D(DDH("ID",1)) A2=DDH("ID",1)
"RTN","DDSU",94,0)
 K DDH S DDH=0
"RTN","DDSU",95,0)
 S:$D(A1) DDH("ID")=A1
"RTN","DDSU",96,0)
 S:$D(A2) DDH("ID",1)=A2
"RTN","DDSU",97,0)
 Q
"RTN","DDSU",98,0)
 ;
"RTN","DDSU",99,0)
FM ;FileMan help - Non screen
"RTN","DDSU",100,0)
 N A0,A1,A2,A3,A4,DDSDIW,DDSDIY,Y
"RTN","DDSU",101,0)
 S A0=""
"RTN","DDSU",102,0)
 F  S A0=$O(DDH(A0)) Q:'A0  S DDSDIW=$X,DDSDIY=$Y D W I $G(DDD)>2,DDSDIW-$X!(DDSDIY-$Y) D STP Q:$D(DTOUT)
"RTN","DDSU",103,0)
 I $G(DIPGM)="DICQ1",$G(DP),$G(DIC("?N",DP)) D
"RTN","DDSU",104,0)
 . N DIZ S DIZ=0 D T Q
"RTN","DDSU",105,0)
 ;
"RTN","DDSU",106,0)
Q I '$D(DTOUT) D SV S DDH=0 Q
"RTN","DDSU",107,0)
 K DDH D:'DTOUT  Q
"RTN","DDSU",108,0)
 . K DTOUT N % S %=$G(DIPGM) I %'="DICQ1",%'="DIEQ" Q
"RTN","DDSU",109,0)
 . S DUOUT=1 Q
"RTN","DDSU",110,0)
 Q
"RTN","DDSU",111,0)
 ;
"RTN","DDSU",112,0)
STP Q:$D(DD)[0!($D(DIY)[0)  I DD+DIY'>79 W ?DD S DD=DD+DIY Q
"RTN","DDSU",113,0)
 ;
"RTN","DDSU",114,0)
T W !?3 S DD=DIY+3
"RTN","DDSU",115,0)
 I $Y>DIZ!'$Y D
"RTN","DDSU",116,0)
 . R "'^' TO STOP: ",%Y:$G(DTIME,300)
"RTN","DDSU",117,0)
 . E  S DTOUT=1 K DDD
"RTN","DDSU",118,0)
 . W $C(13),$J("",15),$C(13) Q:$D(DTOUT)
"RTN","DDSU",119,0)
 . I %Y[U S DTOUT=0 K DDD
"RTN","DDSU",120,0)
 . D Y W ?3
"RTN","DDSU",121,0)
 Q
"RTN","DDSU",122,0)
 ;
"RTN","DDSU",123,0)
W S A4=$O(DDH(A0,"")) Q:A4=""  Q:DDH(A0,A4)=""
"RTN","DDSU",124,0)
 W:'$D(DDD) !
"RTN","DDSU",125,0)
 I $G(DDD)=3,A4["T" K DDD
"RTN","DDSU",126,0)
 ;
"RTN","DDSU",127,0)
WR I A4["X" D  Q
"RTN","DDSU",128,0)
 . N DDD,DIY,DDSXEC
"RTN","DDSU",129,0)
 . S DDSXEC=DDH(A0,A4)
"RTN","DDSU",130,0)
 . N DDH
"RTN","DDSU",131,0)
 . I $D(DDS) N DDSID S DDSID=1 S DDQ=$S(DY>(IOSL-1):IOSL-1,1:DY)_U_DX
"RTN","DDSU",132,0)
 . X DDSXEC
"RTN","DDSU",133,0)
 ;
"RTN","DDSU",134,0)
 I A4["Q" D  Q
"RTN","DDSU",135,0)
 . S A4=DDH(A0,A4),%=$P(A4,U,1)
"RTN","DDSU",136,0)
 . I $D(DDS) D ASK Q
"RTN","DDSU",137,0)
 . W $P(A4,U,2)
"RTN","DDSU",138,0)
 . D YN^DICN
"RTN","DDSU",139,0)
 ;
"RTN","DDSU",140,0)
 I A4["T" D  Q
"RTN","DDSU",141,0)
 . I DDH(A0,A4)[$C(0) D
"RTN","DDSU",142,0)
 .. S DX=$L(DDH(A0,A4),$C(0))-1
"RTN","DDSU",143,0)
 .. X DDXY
"RTN","DDSU",144,0)
 .. S DDH(A0,A4)=$TR(DDH(A0,A4),$C(0),"")
"RTN","DDSU",145,0)
 . W DDH(A0,A4)
"RTN","DDSU",146,0)
 ;
"RTN","DDSU",147,0)
 I '$D(DDS),$G(DDD)'["J",A4'=+A4 Q
"RTN","DDSU",148,0)
 I $D(DDS),$G(DDD)=2!($G(DDD)["J") W A0,?7
"RTN","DDSU",149,0)
 ;
"RTN","DDSU",150,0)
 W DDH(A0,A4)
"RTN","DDSU",151,0)
 I $D(DDH("ID")) D  S:$D(DUOUT) DIY=U
"RTN","DDSU",152,0)
 . N DDD,DIY,DDSID
"RTN","DDSU",153,0)
 . S DDSID=DDH("ID")
"RTN","DDSU",154,0)
 . S:$D(DDH("ID",1))#2 DDSID(1)=DDH("ID",1)
"RTN","DDSU",155,0)
 . N DDH
"RTN","DDSU",156,0)
 . S:$D(DDSID(1))#2 DDH("ID",1)=DDSID(1) K DDSID(1)
"RTN","DDSU",157,0)
 . S Y=A4
"RTN","DDSU",158,0)
 . S:$D(DDS) DDQ=$S(DY>(IOSL-1):IOSL-1,1:DY)_U_$X
"RTN","DDSU",159,0)
 . X DDSID
"RTN","DDSU",160,0)
 Q
"RTN","DDSU",161,0)
 ;
"RTN","DDSU",162,0)
Y D:'$D(DISYS) OS^DII
"RTN","DDSU",163,0)
 S $X=0,$Y=0
"RTN","DDSU",164,0)
 S DIZ=$S($D(DILN)&'$D(DIR0):DILN,1:21)
"RTN","DDSU",165,0)
 Q
"RTN","DDSU",166,0)
 ;
"RTN","DDSU",167,0)
Z D Y,T
"RTN","DDSU",168,0)
 Q
"RTN","DDSU",169,0)
 ;
"RTN","DDSU",170,0)
H S:'$D(A1) A1="T"
"RTN","DDSU",171,0)
 S DDH=$G(DDH)+1,DDH(DDH,A1)=DST
"RTN","DDSU",172,0)
 K A1,DST
"RTN","DDSU",173,0)
 D SC
"RTN","DDSU",174,0)
 Q
"RTN","DDSU",175,0)
 ;#8053  Press 'RETURN' to continue...
"RTN","DDSU",176,0)
 ;#8081  Choose |from-to| or '^'...
"RTN","DDSU",177,0)
 ;#7001  Yes^No
"RTN","DI151ENV")
0^^B3744962^n/a
"RTN","DI151ENV",1,0)
DI151ENV ;IRMFO-SF/FM STAFF-ENVIRONMENT CHECK ROUTINE ;1:59 AM  31 Aug 2007
"RTN","DI151ENV",2,0)
 ;;22.0;VA FileMan;**151**;Mar 30, 1999;Build 10
"RTN","DI151ENV",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DI151ENV",4,0)
 ;
"RTN","DI151ENV",5,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DI151ENV",6,0)
 I 'XPDENV Q  ; Loading Distribution - No Check
"RTN","DI151ENV",7,0)
 ;
"RTN","DI151ENV",8,0)
 ;
"RTN","DI151ENV",9,0)
INSCHK ; Do Checks During Install Only
"RTN","DI151ENV",10,0)
 W $C(7)
"RTN","DI151ENV",11,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DI151ENV",12,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DI151ENV",13,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DI151ENV",14,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DI151ENV",15,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DI151ENV",16,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DI151ENV",17,0)
 ;
"RTN","DI151ENV",18,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DI151ENV",19,0)
 S X=$$TM^%ZTLOAD
"RTN","DI151ENV",20,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DI151ENV",21,0)
 . W $C(7)
"RTN","DI151ENV",22,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DI151ENV",23,0)
 ;
"RTN","DI151ENV",24,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DI151ENV",25,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DI151ENV",26,0)
 S X=+$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DI151ENV",27,0)
 I 'X D
"RTN","DI151ENV",28,0)
 . W $C(7)
"RTN","DI151ENV",29,0)
 . D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DI151ENV",30,0)
 Q
"RTN","DICATTDE")
0^11^B26617595^B26223602
"RTN","DICATTDE",1,0)
DICATTDE ;GFT;;END SCREEN EDIT ; 04 Jun 2007  3:39 PM
"RTN","DICATTDE",2,0)
 ;;22.0;VA FileMan;**42,83,103,151**;Mar 30, 1999;Build 10
"RTN","DICATTDE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DICATTDE",4,0)
 ;
"RTN","DICATTDE",5,0)
LAYGODEF ;should user see 'ADDING NEW'?
"RTN","DICATTDE",6,0)
 N %
"RTN","DICATTDE",7,0)
 I DICATTF=.01,$G(^DD(DICATTA,0,"UP")) S Y=^("UP"),%=$O(^DD(Y,"SB",DICATTA,0)) I %,$P($G(^DD(Y,%,0)),U,2)["A" S Y="NO" Q
"RTN","DICATTDE",8,0)
 S Y="YES"
"RTN","DICATTDE",9,0)
 Q
"RTN","DICATTDE",10,0)
 ;
"RTN","DICATTDE",11,0)
POST ;This is the DATA VALIDATION of the DICATT FORM
"RTN","DICATTDE",12,0)
 N DICATT1N,DICATTM,DICATT4N,DICATT4S,DICATTED,X,T,G,DIC,DIE,DR,DA
"RTN","DICATTDE",13,0)
 K DDSBR,DDSERROR
"RTN","DICATTDE",14,0)
 I DICATT2 G MULEDIT^DICATTDD
"RTN","DICATTDE",15,0)
VP I $$G(20)=8 D POSTVP^DICATTD8 I $D(DDSBR) S DDSERROR=1,DDSBR=DDSBR_"^DICATT8^2.8" Q
"RTN","DICATTDE",16,0)
 S DICATT1N=$$G(1)
"RTN","DICATTDE",17,0)
 I DICATT1N="" G ^DICATTDK:$D(DICATTDK) S DDSBR=1,DDSERROR=1 Q
"RTN","DICATTDE",18,0)
 I DICATT1N=$$G(2) S DDSERROR=1,DDSBR=1 D HLP^DDSUTL("NAME AND TITLE MUST BE DIFFERENT") Q
"RTN","DICATTDE",19,0)
 I $G(DICATTLN) D  I $D(DDSERROR) D HLP^DDSUTL("YOUR REDEFINITION OF THE FIELD WOULD CAUSE TOO MUCH DATA STORAGE!") Q
"RTN","DICATTDE",20,0)
 .N W,DP,N,A,L,Y
"RTN","DICATTDE",21,0)
 .S A=DICATTA,DP=DICATTF,W=$P(^DD(A,DP,0),U,4),Y=$P(W,";"),N=$P(W,";",2),T=0,L=DICATTLN Q:W=""
"RTN","DICATTDE",22,0)
 .D MX^DICATT1
"RTN","DICATTDE",23,0)
 .I $$MAX^DICATTDM(L-T,Y)>251 S DDSERROR=1,DDSBR=20
"RTN","DICATTDE",24,0)
NEW I DICATT4="",'$D(DICATT4N)  D  I $D(DDSERROR) D HLP^DDSUTL("DATA-STORAGE INFO INCOMPLETE") Q
"RTN","DICATTDE",25,0)
 .I DICATTF=.001 S DICATT4N=" " Q
"RTN","DICATTDE",26,0)
 .S G=$$G(20) I G=6 S DICATT4N=" ; " Q
"RTN","DICATTDE",27,0)
 .I G=5!$$G(20.5) D  Q:$D(DDSERROR)  S DICATT4N=DICATTM(76)_";0" Q  ;Note that we can $$GET the defaulted values for storage, even if user has not seen Pages 3 or 4
"RTN","DICATTDE",28,0)
 ..F T=76,76.1 S DICATTM(T)=$$GET^DDSVALF(T,"DICATTS",4,"","") I DICATTM(T)="" S DDSERROR=1,DDSBR="76^DICATTS^4" Q
"RTN","DICATTDE",29,0)
 .S G=$$GET^DDSVALF(16,"DICATTM",3,"",""),T=$$GET^DDSVALF(17,"DICATTM",3,"","")
"RTN","DICATTDE",30,0)
 .I G=""!(T="") S DDSERROR=1,DDSBR="16^DICATTM^3" Q
"RTN","DICATTDE",31,0)
 .S DICATT4N=G_";"_T Q
"RTN","DICATTDE",32,0)
 S X=^DD(DICATTA,DICATTF,0) D  I $D(DDSERROR) D HLP^DDSUTL("FIELD DEFINITION IS TOO LONG!") Q  ;Can't fit it into the zero node
"RTN","DICATTDE",33,0)
 .S T=$L(DICATT1N)+$L($S($D(DICATT2N):DICATT2N,1:$P(X,U,2)))+$L($S($D(DICATT3N):DICATT3N,1:$P(X,U,3)))+$L($S($D(DICATT4N):DICATT4N,1:$P(X,U,4)))+$L($S($D(DICATT5N)#2:DICATT5N,1:$P(X,U,5,999)))
"RTN","DICATTDE",34,0)
 .I T>242 S DDSERROR=1
"RTN","DICATTDE",35,0)
FILE ;Everything's good!   We're gonna file it
"RTN","DICATTDE",36,0)
 I $D(DICATT4N) S $P(^DD(DICATTA,DICATTF,0),U,4)=DICATT4N I DICATT4N'?.P S DICATT4S=$P(DICATT4N,";"),^DD(DICATTA,"GL",DICATT4S,$P(DICATT4N,";",2),DICATTF)="" ;new Piece 4
"RTN","DICATTDE",37,0)
 I $D(DICATTM),$D(DICATT4S) D  Q  ;make a MULTIPLE
"RTN","DICATTDE",38,0)
 .N TYPE S TYPE=$$G(20)
"RTN","DICATTDE",39,0)
 .D MULMAKE^DICATTDD(DICATTM(76.1),TYPE)
"RTN","DICATTDE",40,0)
WP .I TYPE=5 N DICATTA,DICATTF S:'$D(DICATT2N) DICATT2N="W" ;so we'll bounce back up from W-P multiple
"RTN","DICATTDE",41,0)
 .S DICATTA=DICATTM(76.1),DICATTF=.01,DICATTMN="" D CHANGED ;make the .01 Field of the new multiple
"RTN","DICATTDE",42,0)
CHANGED S X=$E("R",$$G(18)) I DICATT2["R"'=$L(X)!$D(DICATTMN) D
"RTN","DICATTDE",43,0)
 .S DICATTMN="" K ^DD(DICATTA,"RQ",DICATTF) I X["R" S ^(DICATTF)=""
"RTN","DICATTDE",44,0)
 .I '$D(DICATT2N) S DICATT2N=$TR(DICATT2,"R") I DICATT2["W" S DICATT2N="W"
"RTN","DICATTDE",45,0)
 .S DICATT2N=X_DICATT2N
"RTN","DICATTDE",46,0)
 .S %=$P(DICATT2,"P",2) I % K ^DD(+%,0,"PT",DICATTA,DICATTF) ;remove old PT node
"RTN","DICATTDE",47,0)
 .F %=DICATTA:0  S ^DD(%,0,"DT")=DT Q:'$D(^("UP"))  S %=^("UP") Q:'$D(^DD(%))
"RTN","DICATTDE",48,0)
 .S %=$P(DICATT2N,"P",2) I % S ^DD(+%,0,"PT",DICATTA,DICATTF)=""
"RTN","DICATTDE",49,0)
 .I DICATT2N["C" D
"RTN","DICATTDE",50,0)
 ..N DICOMPX,A,DA
"RTN","DICATTDE",51,0)
 ..S (DA(1),A)=DICATTA,DA=DICATTF,DICOMPX=$G(DICATT5N(9.01)) K ^DD(A,DA,9.02) D ACOMP^DICATT3
"RTN","DICATTDE",52,0)
 .I DICATTF=.01 D
"RTN","DICATTDE",53,0)
 ..I DICATTA=DICATTB D  Q
"RTN","DICATTDE",54,0)
 ...I $D(^DIC(DICATTA,0,"GL")),$D(@(^("GL")_"0)")) D UP2("",DICATT2N)
"RTN","DICATTDE",55,0)
 ..S Y=$$GET^DDSVALF(2,"DICATTMUL",5,"I","") I Y?1N S DICATT2N=$E("M",Y=1)_DICATT2N
"RTN","DICATTDE",56,0)
 ..S DR=$$GET^DDSVALF(1,"DICATTMUL",5,"I","")
"RTN","DICATTDE",57,0)
 ..I $G(^DD(DICATTA,0,"UP")) S Y=^("UP"),%=$O(^DD(Y,"SB",DICATTA,0)) I Y,%,$D(^DD(Y,%,0)) D UP2(DR,DICATT2N) ;Reset the MULTIPLE field at the higher level
"RTN","DICATTDE",58,0)
 .S $P(^DD(DICATTA,DICATTF,0),U,2)=DICATT2N
"RTN","DICATTDE",59,0)
PIECE3 .I $D(DICATT3N) S $P(^(0),U,3)=$G(DICATT3N)
"RTN","DICATTDE",60,0)
 .I $D(DICATTVP) D FILE^DICATTD8
"RTN","DICATTDE",61,0)
SCREEN S %=$$GET^DDSVALF(65,"DICATT SCREEN",6,"I",""),X=$P(^DD(DICATTA,DICATTF,0),U,2) I %=0!(%="NO")!(X'["P"&(X'["S")) K ^(12),^(12.1)
"RTN","DICATTDE",62,0)
 F %=8:0 S %=$O(DICATT5N(%)) Q:'%  S ^DD(DICATTA,DICATTF,%)=DICATT5N(%)
"RTN","DICATTDE",63,0)
 K ^DD(DICATTA,DICATTF,.009) I $D(DICATT5N)#2 S $P(^(0),U,5,99)=DICATT5N
"RTN","DICATTDE",64,0)
 S DR="50////^S X=DT" F X=1:1:8 D 0
"RTN","DICATTDE",65,0)
 D DIE
"RTN","DICATTDE",66,0)
 S DR="Q",X=98 D 0,DIE
"RTN","DICATTDE",67,0)
 S DR="Q",X=99 D 0,DIE
"RTN","DICATTDE",68,0)
 D FILEWORD^DICATTD0
"RTN","DICATTDE",69,0)
MUMPS I $P(^DD(DICATTA,DICATTF,0),U,2)["K" S ^(9)="@" ;**151
"RTN","DICATTDE",70,0)
RESET D GET^DICATTD ;now that we have filed, the NEW is OLD, in case they keep editing!
"RTN","DICATTDE",71,0)
Q Q
"RTN","DICATTDE",72,0)
 ;
"RTN","DICATTDE",73,0)
UP2(A,X) N T,Y ;A=0 if NO LAYGO  X=SPECIFIER
"RTN","DICATTDE",74,0)
 S Y=$P(^(0),U,2),Y=$TR(Y,"SDPV")
"RTN","DICATTDE",75,0)
 F T="S","V","P","D" I X[T S Y=Y_T Q
"RTN","DICATTDE",76,0)
 I A?1N S Y=$TR(Y,"A")_$E("A",DR=0)
"RTN","DICATTDE",77,0)
 S $P(^(0),U,2)=Y
"RTN","DICATTDE",78,0)
 Q
"RTN","DICATTDE",79,0)
 ;
"RTN","DICATTDE",80,0)
0 S T=$T(@X),G=$TR($$G(X),";") Q:G="@"!(G="^")  S:G="" G="@" S DR=DR_$P(T,";",2,3)_"////"_G Q  ;Re-file NAME, TITLE, etc.  Delete if they are now gone.  Leave "@" alone
"RTN","DICATTDE",81,0)
1 ;;.01
"RTN","DICATTDE",82,0)
2 ;;.1
"RTN","DICATTDE",83,0)
3 ;;1.1
"RTN","DICATTDE",84,0)
4 ;;1.2
"RTN","DICATTDE",85,0)
5 ;;8
"RTN","DICATTDE",86,0)
6 ;;8.5
"RTN","DICATTDE",87,0)
7 ;;9
"RTN","DICATTDE",88,0)
8 ;;10
"RTN","DICATTDE",89,0)
98 ;;3
"RTN","DICATTDE",90,0)
99 ;;4
"RTN","DICATTDE",91,0)
 ;
"RTN","DICATTDE",92,0)
DIE S DICATTED=1,DA=DICATTF,DA(1)=DICATTA,(DIC,DIE)="^DD(DICATTA,"
"RTN","DICATTDE",93,0)
 D ^DIE
"RTN","DICATTDE",94,0)
 Q
"RTN","DICATTDE",95,0)
 ;
"RTN","DICATTDE",96,0)
N ;
"RTN","DICATTDE",97,0)
 S DA=DICATTF I $G(DDA(1))]"" S:$G(DICATTA) DDA(1)=DICATTA S:'$D(^DD(DDA(1),DA)) DDA="D" D AUDT^DICATTA
"RTN","DICATTDE",98,0)
 I $D(DIU0) N DI D IJ^DIUTL(DICATTA),P^DICATT
"RTN","DICATTDE",99,0)
 Q
"RTN","DICATTDE",100,0)
 ;
"RTN","DICATTDE",101,0)
G(I) N X Q $$GET^DDSVALF(I,"DICATT",1,"I","")
"RTN","DICATTDK")
0^9^B6186767^B4819324
"RTN","DICATTDK",1,0)
DICATTDK ;SFISC/GFT-DELETE FIELD ;25MAY2007
"RTN","DICATTDK",2,0)
 ;;22.0;VA FileMan;**8,118,151**;Mar 30, 1999;Build 10
"RTN","DICATTDK",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DICATTDK",4,0)
 ;FROM ^DICATTDE
"RTN","DICATTDK",5,0)
KILL N M,DI,DA,DQ,DICL,D0,DIU,DQI,S,Q,O,X,DICATT4M
"RTN","DICATTDK",6,0)
 I $D(DDA) S DDA="D" ;'DELETE' flag for Auditing
"RTN","DICATTDK",7,0)
 S S=";",Q=""""
"RTN","DICATTDK",8,0)
MAYBGONE S (A,DA(1))=DICATTA,(D0,DA)=DICATTF I '$D(^DD(A,DA)) Q
"RTN","DICATTDK",9,0)
 D IJ^DIUTL(A) S DICL=$O(J(""),-1),DQ=""
"RTN","DICATTDK",10,0)
 F  S DQ=$O(^DD(0,.01,"DEL",DQ)) Q:DQ=""  I $D(^(DQ,0)) X ^(0) I  S DDSERROR=1,DDSBR=1 H 3 G Q  ;Delete checks
"RTN","DICATTDK",11,0)
 S O=^DD(A,D0,0),M=$P(O,U),X=0
"RTN","DICATTDK",12,0)
 F  S X=$O(^DD(A,DA,1,X)) Q:'X  I +^(X,0)=DICATTB,$P(^(0),DICATTB,2)?1"^"1.A S DQI=$P(^(0),U,2) ;HMMMMM  remember that this field cross-referenced top level
"RTN","DICATTDK",13,0)
MUL I $G(DICATT2) D  ;Delete a multiple field
"RTN","DICATTDK",14,0)
 .K ^DD(A,"GL",$P($P(O,U,4),";")) ;SO EN+4^DICATT4 KNOWS TO DELETE THE ENTRIES CORRECTLY
"RTN","DICATTDK",15,0)
 .S DQ(+DICATT2)=0
"RTN","DICATTDK",16,0)
NEW .S DICATT4M(0)=$NA(^DD(A,D0)) ;from NEW^DICATTD4
"RTN","DICATTDK",17,0)
 .S DICATT4M("SB")=$NA(^DD(A,"SB",+$P(O,U,2),D0))
"RTN","DICATTDK",18,0)
 .S ^DD(A,D0,0)=O,^DD(A,"SB",+$P(O,U,2),D0)=""
"RTN","DICATTDK",19,0)
 .D ^DICATT4
"RTN","DICATTDK",20,0)
 .K @DICATT4M(0),@DICATT4M("SB")
"RTN","DICATTDK",21,0)
 .D KDD^DICATT4 ;Kill the DD globals below
"RTN","DICATTDK",22,0)
ENTRIES E  I $P(O,U,2)'["C"," "'[$P(O,U,4) S DICATT4M=1 D ^DICATT4
"RTN","DICATTDK",23,0)
 D DELFLD(DICATTA,DICATTF)
"RTN","DICATTDK",24,0)
 D N^DICATTDE
"RTN","DICATTDK",25,0)
Q Q
"RTN","DICATTDK",26,0)
 ;
"RTN","DICATTDK",27,0)
DELFLD(DICATTA,DA) ;ALSO FROM ^DICATTD
"RTN","DICATTDK",28,0)
 W $C(7),!,"FIELD DELETED!" S:$D(DDA) DDA=$E("D",DDA="")
"RTN","DICATTDK",29,0)
 N A,D0,DIC,DIK,O,M S (DIC,DIK)="^DD(DICATTA,",DA(1)=DICATTA,DA=DICATTF
"RTN","DICATTDK",30,0)
AUD S:$D(DDA) ^UTILITY("DDA",$J,DICATTA,DA,0)=$G(^DD(DICATTA,DA,0))
"RTN","DICATTDK",31,0)
 D ^DIK
"RTN","DICATTDK",32,0)
 Q
"RTN","DICATTDK",33,0)
 ;
"RTN","DICATTDK",34,0)
 ;
"RTN","DICATTDK",35,0)
 ;
"RTN","DICATTDK",36,0)
 ;
"RTN","DICATTDK",37,0)
POST9 ;POST-ACTION OF FIELD 99, 'ARE YOU SURE YOU WANT TO DELETE THE ENTIRE FIELD?'
"RTN","DICATTDK",38,0)
 I 'X D  Q  ;IF THEY DON'T ANSWER "YES", REPAINT FIELD LABEL AND QUIT
"RTN","DICATTDK",39,0)
 .S X=$P(^DD(DICATTA,DICATTF,0),U)
"RTN","DICATTDK",40,0)
 .I $G(DICATT2) D PUT^DDSVALF(1,"DICATT MUL",10,X) Q
"RTN","DICATTDK",41,0)
 .D PUT^DDSVALF(1,"DICATT",1,X)
"RTN","DICATTDK",42,0)
 S DICATTDK=1,DDACT="EX" ;FORCE EXIT FROM SCREENMAN
"RTN","DICATTDK",43,0)
 D REQ^DDSUTL(20,"DICATT",1,0)
"RTN","DICATTDK",44,0)
NOREQ ;(not sure anyone uses this entry point yet)
"RTN","DICATTDK",45,0)
 D REQ^DDSUTL(67,"DICATT SCREEN",6,0)
"RTN","DICATTDK",46,0)
 D REQ^DDSUTL(31,"DICATT2",2.2,0)
"RTN","DICATTDK",47,0)
 D REQ^DDSUTL(32,"DICATT2",2.2,0)
"RTN","DICATTDK",48,0)
 D REQ^DDSUTL(68,"DICATT4",2.4,0)
"RTN","DICATTDK",49,0)
 D REQ^DDSUTL(69,"DICATT4",2.4,0)
"RTN","DICATTDK",50,0)
 D REQ^DDSUTL(78,"DICATT6",2.6,0)
"RTN","DICATTDK",51,0)
 Q
"RTN","DICATTDK",52,0)
 ;
"RTN","DICQ")
0^5^B21798425^B21749865
"RTN","DICQ",1,0)
DICQ ;SFISC/XAK,TKW-HELP FOR LOOKUPS ;7:20 AM  17 May 2007
"RTN","DICQ",2,0)
 ;;22.0;VA FileMan;**4,3,57,151**;Mar 30, 1999;Build 10
"RTN","DICQ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DICQ",4,0)
 S DZ=X D:DIC(0)]"" DQ
"RTN","DICQ",5,0)
 I '$D(DDS),$G(DDH) D ^DDSU
"RTN","DICQ",6,0)
 S:$D(DZ) X=DZ K DZ,DDH,DIZ,DDD I $D(DTOUT) S Y=-1 D Q^DIC2 Q
"RTN","DICQ",7,0)
 D A^DIC Q
"RTN","DICQ",8,0)
 ;
"RTN","DICQ",9,0)
DQ ; Main entry point for displaying online ^DIC help (list of current
"RTN","DICQ",10,0)
 ; entries in a file.
"RTN","DICQ",11,0)
 N %,%Y,X,Y,DD,DDC,DDD,DS,DID01,DICNT,DIDONE,DIFROM,DIPART,DIW,DIX,DIY,DIZ,DIUPRITE,DST,DIBEGSUB,DIBEGIX
"RTN","DICQ",12,0)
 I $D(DZ)[0 N DZ S DZ=""
"RTN","DICQ",13,0)
 S DDC=$S($D(DDS):7,1:15)
"RTN","DICQ",14,0)
 N:'$D(DDH) DDH S DDH=+$G(DDH)
"RTN","DICQ",15,0)
 S DIBEGIX=D
"RTN","DICQ",16,0)
 I '($D(DIRECUR)#2) N DIRECUR S DIRECUR=0
"RTN","DICQ",17,0)
 I '$D(DO) N DO D GETFA^DIC1(.DIC,.DO)
"RTN","DICQ",18,0)
 I DO="0^-1" K DO S DST="  Pointed-to File does not exist!" D % Q
"RTN","DICQ",19,0)
 S DICNT=$P(DO,U,4),DIY=DO D DIY
"RTN","DICQ",20,0)
 S X=$S($D(^DD(+DO(2),.001,0)):$P(^(0),U,1),DIC(0)["N":"NUMBER",1:""),DIUPRITE=X]""
"RTN","DICQ",21,0)
 S DIW=^DD(+DO(2),.01,0),DIW=$P(DIW,U,2,3)
"RTN","DICQ",22,0)
 G:$D(^DD(+DO(2),0,"QUES")) @^("QUES")
"RTN","DICQ",23,0)
 I DIUPRITE S DS=.001 D DS
"RTN","DICQ",24,0)
DQ1 I $G(DIFILEI),$G(DINDEX)]"" M DIX=DINDEX
"RTN","DICQ",25,0)
 E  N DIFILEI,DIENS K % M %=DA N DA M DA=% K % D
"RTN","DICQ",26,0)
 . D GETFILE^DIC0(.DIC,.DIFILEI,.DIENS)
"RTN","DICQ",27,0)
 . S DIX=$G(D),DIX("WAY")=1 D INDEX^DICUIX(.DIFILEI,"hl",.DIX)
"RTN","DICQ",28,0)
 . Q
"RTN","DICQ",29,0)
 S DIBEGSUB=DIX("#")
"RTN","DICQ",30,0)
 I DIFILEI="" D % Q
"RTN","DICQ",31,0)
 I $D(DIC("?N",DIFILEI)) S DDC=DIC("?N",DIFILEI)
"RTN","DICQ",32,0)
 S DIFROM=""
"RTN","DICQ",33,0)
 N DISAVIX M DISAVIX=DIX
"RTN","DICQ",34,0)
 D IX K DISAVIX
"RTN","DICQ",35,0)
 I 'DICNT D 0 Q
"RTN","DICQ",36,0)
 S DIDONE=0 I DZ'="??" D  I DIDONE D 0 Q
"RTN","DICQ",37,0)
 . D DSPFLD Q:DICNT<11
"RTN","DICQ",38,0)
 . N DIOUT S DIOUT=0 F  D ASKCUR Q:DIOUT
"RTN","DICQ",39,0)
 . Q
"RTN","DICQ",40,0)
 D EN^DICQ1
"RTN","DICQ",41,0)
 Q
"RTN","DICQ",42,0)
 ;
"RTN","DICQ",43,0)
IX N DD,DIF,DIFIL,DIFLD,DIFORCE,DIEND,DITMP,I,P,F,X,%
"RTN","DICQ",44,0)
 S (DD,%)="",DID01=0,DIF="h"_$P("M^",U,DIC(0)["M")
"RTN","DICQ",45,0)
 S DIFORCE=$S($D(DID):1,1:0),DIFORCE(0)=$S($D(DID):DID,1:"*"),DIFORCE(1)=1
"RTN","DICQ",46,0)
 F  D  Q:DIX=""!(DIC(0)'["M")
"RTN","DICQ",47,0)
 . S DIEND=$S(DIX=DIBEGIX:DIX("#"),1:1)
"RTN","DICQ",48,0)
 . S (P,DS)="" F I=1:1:DIEND D
"RTN","DICQ",49,0)
 . . S DIFIL=$G(DIX(I,"FILE")),DIFLD=$G(DIX(I,"FIELD"))
"RTN","DICQ",50,0)
 . . I DIFIL,DIFLD Q:$D(DITMP(DIFIL,DIFLD))  S DITMP(DIFIL,DIFLD)=""
"RTN","DICQ",51,0)
 . . I DIX=DIBEGIX D
"RTN","DICQ",52,0)
 . . . I DIFIL=DIFILEI,DIFLD=.01,DIX("FLISTD")[("^"_.01_"^") S DID01=1
"RTN","DICQ",53,0)
 . . . S DS=.002 Q
"RTN","DICQ",54,0)
 . . E  S X=DIFLD S:DIFILEI'=DIFIL X=DIFIL_" "_DIFLD S:DS]"" DS=DS_"^" S DS=DS_X
"RTN","DICQ",55,0)
 . . S X=$G(DIX(I,"PROMPT"))
"RTN","DICQ",56,0)
 . . I X="",$D(^DD(+DIFIL,+DIFLD,0))#2 S X=$P(^(0),U)
"RTN","DICQ",57,0)
 . . I I=1 S %=DIX(1,"TYPE")
"RTN","DICQ",58,0)
 . . Q:X=""  I DIX("#")=1,X=$G(DS(.002)) Q
"RTN","DICQ",59,0)
 . . I $L(X)+$L(P)'>70 S P=P_$P(" & ^",U,P]"")_X Q
"RTN","DICQ",60,0)
 . . S:P'["..." P=P_"..." Q
"RTN","DICQ",61,0)
 . I P]"",DS]"" S X=P D DS
"RTN","DICQ",62,0)
 . I @("$D("_DIC_"DIX))>9!$D(DF)"),DD="" S DD=DIX,DIW=% S:'DICNT DICNT=2 S:'$D(^(DD)) DICNT=0,DIUPRITE=0
"RTN","DICQ",63,0)
 . I DIC(0)'["M" S DIX="" Q
"RTN","DICQ",64,0)
 . D NXTINDX^DICF2(.DIX,.DIFORCE,.DIFILEI,DIF,"","*") Q:DIX=""
"RTN","DICQ",65,0)
 . D INDEX^DICUIX(.DIFILEI,"hql",.DIX) Q
"RTN","DICQ",66,0)
 K DIX
"RTN","DICQ",67,0)
 I DIBEGIX=DD M DIX=DISAVIX
"RTN","DICQ",68,0)
 E  S (DIBEGIX,DIX)=DD I DIX]"" S DIX("WAY")=1 D INDEX^DICUIX(.DIFILEI,"hl",.DIX)
"RTN","DICQ",69,0)
 I DD="" S DIUPRITE=1 I $O(^DD(DIFILEI,0,"IX","AZ"))]""!($O(^DD("IX","BB",DIFILEI,"AZ"))]"") S DICNT=0
"RTN","DICQ",70,0)
 S:DZ["BAD" DICNT=0
"RTN","DICQ",71,0)
 Q
"RTN","DICQ",72,0)
 ;
"RTN","DICQ",73,0)
DSPFLD ; Display list of lookup fields
"RTN","DICQ",74,0)
 N X S DST=$$EZBLD^DIALOG(8063,$P(DO,U)),DS=0
"RTN","DICQ",75,0)
 F X=1:1 S DS=$O(DS(DS)) Q:DS=""  D
"RTN","DICQ",76,0)
 . S:X>1!$G(DS(0)) DST=DST_$$EZBLD^DIALOG(8067)
"RTN","DICQ",77,0)
 . D:$L(DST)+$L(DS(DS))>70 N S DST=DST_" "_DS(DS) Q
"RTN","DICQ",78,0)
 K DS S DST=DST_$E(":",DICNT) D %
"RTN","DICQ",79,0)
 Q
"RTN","DICQ",80,0)
 ;
"RTN","DICQ",81,0)
ASKCUR ; Ask if user wants to see existing entries
"RTN","DICQ",82,0)
 N A1 S DDH=DDH+1,A1=0_U_$$EZBLD^DIALOG(8064)
"RTN","DICQ",83,0)
 I DO(2)'["s",'$D(DIC("S")),'$D(DIC("V")),'$D(DF),'$D(DIC("?PARAM",DIFILEI)) S A1=A1_$$EZBLD^DIALOG(8065,DICNT)
"RTN","DICQ",84,0)
 S DDH(DDH,"Q")=A1_$$EZBLD^DIALOG(8066,$P(DO,U))
"RTN","DICQ",85,0)
 S:$D(DDS) DDD=1 D ^DDSU
"RTN","DICQ",86,0)
 I '$D(DDS),$D(DTOUT) S (DIOUT,DIDONE)=1 Q
"RTN","DICQ",87,0)
 I $D(DDS) S %=1 I $D(DDSQ) S (DIOUT,DIDONE)=1 Q
"RTN","DICQ",88,0)
 ; Process answer to question about seeing existing entries.
"RTN","DICQ",89,0)
 S A1="T",DDH=+$G(DDH)
"RTN","DICQ",90,0)
 S:%=1 %Y=1
"RTN","DICQ",91,0)
 I %Y'="??" D
"RTN","DICQ",92,0)
 . N F S F=$E(%Y,2,99) I $E(%Y)="^",F]"" S DIFROM=F
"RTN","DICQ",93,0)
 . S %Y=F Q
"RTN","DICQ",94,0)
 S:%=2&(DIC(0)["L") DZ=""
"RTN","DICQ",95,0)
 I (%#2)=0!(%<0&(%Y="")) S (DIOUT,DIDONE)=1 Q
"RTN","DICQ",96,0)
 I DIFROM="" S DIOUT=1 Q
"RTN","DICQ",97,0)
 S DIUPRITE=$S(+$P(DIFROM,"E")=DIFROM:1,DIBEGIX]"":0,1:DIUPRITE)
"RTN","DICQ",98,0)
 I +$P(DIFROM,"E")=DIFROM S DIOUT=1 Q
"RTN","DICQ",99,0)
 Q:DIBEGIX=""  I $P(DIW,U,1)'["D" S DIOUT=1 Q
"RTN","DICQ",100,0)
 N %DT,Y S X=DIFROM,%DT="T" D ^%DT S DIFROM=Y,DIUPRITE=0
"RTN","DICQ",101,0)
 I DIFROM<0 S DST=$C(7) D % Q
"RTN","DICQ",102,0)
 S DIOUT=1 Q
"RTN","DICQ",103,0)
 ;
"RTN","DICQ",104,0)
DSPHLP(DIC,DIFILE,DINDEX,DZ,DINOKILL) ; Display online help for lookups (^DIC)
"RTN","DICQ",105,0)
 N D S D=DINDEX
"RTN","DICQ",106,0)
 I $D(DIBTDH) K DIBTDH Q
"RTN","DICQ",107,0)
 S:$D(DDSXEC) DIBTDH=1 ; Set only if there is eXecutable Help to prevent repeated '??' display from AST^DIEQ
"RTN","DICQ",108,0)
 I DIC(0)]"" D DQ Q:$G(DINOKILL)
"RTN","DICQ",109,0)
 I '$D(DDS),$G(DDH) D ^DDSU
"RTN","DICQ",110,0)
 I $D(DTOUT) S Y=-1 D Q^DIC2 Q
"RTN","DICQ",111,0)
 D A^DIC Q
"RTN","DICQ",112,0)
 ;
"RTN","DICQ",113,0)
N D % S DST="    " Q
"RTN","DICQ",114,0)
 ;
"RTN","DICQ",115,0)
% ;CALLED FROM ^DICQ1
"RTN","DICQ",116,0)
 S DDH=$G(DDH)+1,DDH(DDH,"T")=DST K DST Q
"RTN","DICQ",117,0)
 ;
"RTN","DICQ",118,0)
0 Q:$D(DTOUT)!(DIC(0)'["L")  K DIW,DIUPRITE S:$D(DDS) DDD=1 D 0^DICQ1 Q
"RTN","DICQ",119,0)
 ;
"RTN","DICQ",120,0)
DIY S DIY=$P(^DD(+$P(DIY,U,2),.01,0),"$L(X)>",2),DIY=$S(DIY:DIY,1:30)+7 Q
"RTN","DICQ",121,0)
 ;
"RTN","DICQ",122,0)
SOUNDEX G DQ1
"RTN","DICQ",123,0)
 ;
"RTN","DICQ",124,0)
DS S:DO'[X DS(DS)=X I DO[X,$G(DZ)'["??" S DS(0)=1
"RTN","DICQ",125,0)
 Q
"RTN","DICQ",126,0)
 ;
"RTN","DICQ",127,0)
 ;
"RTN","DICQ",128,0)
 ;
"RTN","DICQ",129,0)
 ;#8063  Answer with |Filename|
"RTN","DICQ",130,0)
 ;#8064  Do you want the entire
"RTN","DICQ",131,0)
 ;#8065  |Number of entries| Entry
"RTN","DICQ",132,0)
 ;#8066  |Filename| List
"RTN","DICQ",133,0)
 ;#8067  , or
"RTN","DICQ",134,0)
 ;#8068  Choose from ; couldn't find a reference SO 8/11/00
"VER")
8^22.0
"BLD",589,6)
^137
**END**
**END**
