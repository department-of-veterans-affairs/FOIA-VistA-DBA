Released PRC*5.1*41 SEQ #82
Extracted from mail message
**KIDS**:PRC*5.1*41^

**INSTALL NAME**
PRC*5.1*41
"BLD",4283,0)
PRC*5.1*41^IFCAP^0^3060405^y
"BLD",4283,1,0)
^^1^1^3050914^^
"BLD",4283,1,1,0)
GIP, CASE CART AND INSTRUMENT KIT FIXES
"BLD",4283,4,0)
^9.64PA^^
"BLD",4283,"ABPKG")
n
"BLD",4283,"KRN",0)
^9.67PA^8989.52^19
"BLD",4283,"KRN",.4,0)
.4
"BLD",4283,"KRN",.401,0)
.401
"BLD",4283,"KRN",.402,0)
.402
"BLD",4283,"KRN",.403,0)
.403
"BLD",4283,"KRN",.5,0)
.5
"BLD",4283,"KRN",.84,0)
.84
"BLD",4283,"KRN",3.6,0)
3.6
"BLD",4283,"KRN",3.8,0)
3.8
"BLD",4283,"KRN",9.2,0)
9.2
"BLD",4283,"KRN",9.8,0)
9.8
"BLD",4283,"KRN",9.8,"NM",0)
^9.68A^10^7
"BLD",4283,"KRN",9.8,"NM",2,0)
PRCPRISP^^0^B25854913
"BLD",4283,"KRN",9.8,"NM",4,0)
PRCPOPL^^0^B25807256
"BLD",4283,"KRN",9.8,"NM",5,0)
PRCPRSSR^^0^B26117439
"BLD",4283,"KRN",9.8,"NM",7,0)
PRCPOPP^^0^B33813357
"BLD",4283,"KRN",9.8,"NM",8,0)
PRCPOPP3^^0^B19187191
"BLD",4283,"KRN",9.8,"NM",9,0)
PRCPRISS^^0^B31105422
"BLD",4283,"KRN",9.8,"NM",10,0)
PRCPLO2^^0^B29511924
"BLD",4283,"KRN",9.8,"NM","B","PRCPLO2",10)

"BLD",4283,"KRN",9.8,"NM","B","PRCPOPL",4)

"BLD",4283,"KRN",9.8,"NM","B","PRCPOPP",7)

"BLD",4283,"KRN",9.8,"NM","B","PRCPOPP3",8)

"BLD",4283,"KRN",9.8,"NM","B","PRCPRISP",2)

"BLD",4283,"KRN",9.8,"NM","B","PRCPRISS",9)

"BLD",4283,"KRN",9.8,"NM","B","PRCPRSSR",5)

"BLD",4283,"KRN",19,0)
19
"BLD",4283,"KRN",19.1,0)
19.1
"BLD",4283,"KRN",101,0)
101
"BLD",4283,"KRN",409.61,0)
409.61
"BLD",4283,"KRN",771,0)
771
"BLD",4283,"KRN",870,0)
870
"BLD",4283,"KRN",8989.51,0)
8989.51
"BLD",4283,"KRN",8989.52,0)
8989.52
"BLD",4283,"KRN",8994,0)
8994
"BLD",4283,"KRN","B",.4,.4)

"BLD",4283,"KRN","B",.401,.401)

"BLD",4283,"KRN","B",.402,.402)

"BLD",4283,"KRN","B",.403,.403)

"BLD",4283,"KRN","B",.5,.5)

"BLD",4283,"KRN","B",.84,.84)

"BLD",4283,"KRN","B",3.6,3.6)

"BLD",4283,"KRN","B",3.8,3.8)

"BLD",4283,"KRN","B",9.2,9.2)

"BLD",4283,"KRN","B",9.8,9.8)

"BLD",4283,"KRN","B",19,19)

"BLD",4283,"KRN","B",19.1,19.1)

"BLD",4283,"KRN","B",101,101)

"BLD",4283,"KRN","B",409.61,409.61)

"BLD",4283,"KRN","B",771,771)

"BLD",4283,"KRN","B",870,870)

"BLD",4283,"KRN","B",8989.51,8989.51)

"BLD",4283,"KRN","B",8989.52,8989.52)

"BLD",4283,"KRN","B",8994,8994)

"BLD",4283,"QUES",0)
^9.62^^
"BLD",4283,"REQB",0)
^9.611^3^3
"BLD",4283,"REQB",1,0)
PRC*5.1*1^1
"BLD",4283,"REQB",2,0)
PRC*5.1*17^1
"BLD",4283,"REQB",3,0)
PRC*5.1*83^1
"BLD",4283,"REQB","B","PRC*5.1*1",1)

"BLD",4283,"REQB","B","PRC*5.1*17",2)

"BLD",4283,"REQB","B","PRC*5.1*83",3)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
41^3060405
"PKG",455,22,1,"PAH",1,1,0)
^^1^1^3060405
"PKG",455,22,1,"PAH",1,1,1,0)
GIP, CASE CART AND INSTRUMENT KIT FIXES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PRCPLO2")
0^10^B29511924^B29302908
"RTN","PRCPLO2",1,0)
PRCPLO2 ;WISC/RFJ/dh/DWA/DAP-stock status report (option, whse) ;3.13.98
"RTN","PRCPLO2",2,0)
 ;;5.1;IFCAP;**83,41**;Oct 20, 2000
"RTN","PRCPLO2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPLO2",4,0)
 ;Copied from routine ^PRCPRSSR and modified for PRC*5.1*83 (CLRS)
"RTN","PRCPLO2",5,0)
 ;
"RTN","PRCPLO2",6,0)
ENT ;This report will be called from option PRCPLO CLO GIP OPTION with fixed
"RTN","PRCPLO2",7,0)
 ;input parameters and run for all stations and active inventory points
"RTN","PRCPLO2",8,0)
 ;on a given VistA system.
"RTN","PRCPLO2",9,0)
 ;D ^PRCPUSEL Q:'$D(PRCP("I"))
"RTN","PRCPLO2",10,0)
 L +^PRCP(446.7,"STATUS"):3 I $T=0 S PRCPMSG(1)="Error encountered when attempting to run CLO GIP Reports due to other",PRCPMSG(2)="CLRS extracts in progress, please try again later." D MAIL^PRCPLO3 Q
"RTN","PRCPLO2",11,0)
 K ^PRCP(446.7)
"RTN","PRCPLO2",12,0)
 S ^PRCP(446.7,0)="CLRS REPORT STORAGE^446.7^^"
"RTN","PRCPLO2",13,0)
 N CLRSFLAG
"RTN","PRCPLO2",14,0)
 S CLRSFLAG="SS" D GETIPT^PRCPLO1
"RTN","PRCPLO2",15,0)
 ;*83 This call links the Stock on Hand Report in a series of two
"RTN","PRCPLO2",16,0)
 ;consecutive report runs to be executed on the 1st of each month.
"RTN","PRCPLO2",17,0)
 L -^PRCP(446.7,"STATUS")
"RTN","PRCPLO2",18,0)
 D ENT^PRCPLO
"RTN","PRCPLO2",19,0)
 N PRCPMSG S PRCPMSG(1)="CLO GIP Reports completed on "_$$HTE^XLFDT($H) D MAIL^PRCPLO3
"RTN","PRCPLO2",20,0)
 Q
"RTN","PRCPLO2",21,0)
 ;
"RTN","PRCPLO2",22,0)
EN1 ;*83 Call coming in from PRCPLO1 with station number and inventory point
"RTN","PRCPLO2",23,0)
 ;
"RTN","PRCPLO2",24,0)
 N %,%DT,%H,%I,DATEINAC,DATESTRT,TODAY,X,X1,X2,Y,MNT,INARNG
"RTN","PRCPLO2",25,0)
 ;K X S X(1)="The Stock Status Report will print a summary of all issues, receipts, and adjustments with the opening and closing balances by account codes."
"RTN","PRCPLO2",26,0)
 ;S X(2)="It will calculate the turnover rate, inactive item percent, long supply percent, and non-issuable percent."
"RTN","PRCPLO2",27,0)
 ;D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPLO2",28,0)
 ;K X S X(1)="Enter the date (month-year) for the Stock Status Report." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPLO2",29,0)
 ;*83 The following was edited to always enter the previous month as the start date
"RTN","PRCPLO2",30,0)
 D NOW^%DTC S TODAY=X,Y=$E(X,1,3),MNT=$E(X,4,5)
"RTN","PRCPLO2",31,0)
 S MNT=MNT-1
"RTN","PRCPLO2",32,0)
 I MNT=0 S MNT=12,Y=Y-1
"RTN","PRCPLO2",33,0)
 I $L(MNT)=1 S MNT=0_MNT
"RTN","PRCPLO2",34,0)
 S DATESTRT=Y_MNT_"00"
"RTN","PRCPLO2",35,0)
 ;S %DT(0)=-Y D DD^%DT S %DT="AEP",%DT("B")=Y,%DT("A")="Print Stock Status for MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPLO2",36,0)
 ;S DATESTRT=$E(Y,1,5)_"00"
"RTN","PRCPLO2",37,0)
 ;K X S X(1)="The inactive item percent is calculated for items which have not had activity (receipts or issues) after a specified cutoff date." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPLO2",38,0)
 ;K X S X(1)="Enter the Inactivity cutoff date." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPLO2",39,0)
 ;*83 The following was edited to always enter a 90 day previous to 
"RTN","PRCPLO2",40,0)
 ;current date default inactivity range if no other is indicated via the
"RTN","PRCPLO2",41,0)
 ;PRCPLO INACTIVITY RANGE parameter
"RTN","PRCPLO2",42,0)
 S INARNG=$$GET^XPAR("SYS","PRCPLO INACTIVITY RANGE",1,"Q")
"RTN","PRCPLO2",43,0)
 I INARNG="" S INARNG=90
"RTN","PRCPLO2",44,0)
 S X1=TODAY,X2=(INARNG*-1) D C^%DTC S DATEINAC=$E(X,1,5)_"00"
"RTN","PRCPLO2",45,0)
 S DT=TODAY
"RTN","PRCPLO2",46,0)
 ;D DD^%DT
"RTN","PRCPLO2",47,0)
 ;S %DT(0)=-($E(TODAY,1,5)_"00"),%DT="AEP",%DT("B")=Y,%DT("A")="Enter Inactivity Cutoff MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPLO2",48,0)
 ;S DATEINAC=$E(Y,1,5)_"00"
"RTN","PRCPLO2",49,0)
 ;W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPLO2",50,0)
 ;.   S ZTDESC="Stock Status Report",ZTRTN="DQ^PRCPRSSR"
"RTN","PRCPLO2",51,0)
 ;.   S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPLO2",52,0)
 ;W !!,"<*> please wait <*>"
"RTN","PRCPLO2",53,0)
 ;*83 Build report with station and inventory point passed in from PRCPLO1 call
"RTN","PRCPLO2",54,0)
DQ ;  queue starts here
"RTN","PRCPLO2",55,0)
 N ACCT,ADJ,ADJN,AVERAGE,D,DA,DATE,DATELONG,DUEIN,DUEOUT,INACT,INACTN,INVVAL,ISS,ISSN,ITEMDA,LONG,LONGN,NONISS,NONISSN,ONHAND,OPEN,QTY,REC,RECN,TOTAL,TOTDAYS,TRANSNO,TYPE,VALUE
"RTN","PRCPLO2",56,0)
 ;*83 Added newing of variables
"RTN","PRCPLO2",57,0)
 N STA,INV,TOTOPEN,TOTREC,TOTISS,TOTADJ,TOTCLOS,RECNM,TOTN,DATRN,TOTINA,TOTIS1,TOTAD1,TOTIND,TOTLNG,TOTLND,DAYS,DATRN1
"RTN","PRCPLO2",58,0)
 ;
"RTN","PRCPLO2",59,0)
 K OPEN
"RTN","PRCPLO2",60,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.1,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S X=$$GETOPEN^PRCPUBAL(PRCP("I"),ITEMDA,$E(DATESTRT,1,5)) I X'="" D
"RTN","PRCPLO2",61,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPLO2",62,0)
 .   S $P(OPEN(ACCT),"^")=$P($G(OPEN(ACCT)),"^")+$P(X,"^",2)+$P(X,"^",3)
"RTN","PRCPLO2",63,0)
 .   S $P(OPEN(ACCT),"^",2)=$P($G(OPEN(ACCT)),"^",2)+$P(X,"^",8)
"RTN","PRCPLO2",64,0)
 S DATE=DATESTRT F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:$E(DATE,1,5)'=$E(DATESTRT,1,5)  S TYPE="" F  S TYPE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE)) Q:TYPE=""  D
"RTN","PRCPLO2",65,0)
 .   S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPLO2",66,0)
 .   .   S D=$G(^PRCP(445.2,DA,0)) I '$P(D,"^",5) Q
"RTN","PRCPLO2",67,0)
 .   .   ;  non-issuable
"RTN","PRCPLO2",68,0)
 .   .   Q:$P(D,"^",11)="N"  ;count if not flagged as non-issueable
"RTN","PRCPLO2",69,0)
 .   .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1($P(D,"^",5)))
"RTN","PRCPLO2",70,0)
 .   .   S TRANSNO=$P(D,"^",19)
"RTN","PRCPLO2",71,0)
 .   .   S INVVAL=$P(D,"^",7)*$P(D,"^",8) I $P(D,"^",22)'="" S INVVAL=$P(D,"^",22)
"RTN","PRCPLO2",72,0)
 .   .   ;  set transno temporary for primary and secondary to
"RTN","PRCPLO2",73,0)
 .   .   ;  indicate type of transaction
"RTN","PRCPLO2",74,0)
 .   .   I PRCP("DPTYPE")'="W" D
"RTN","PRCPLO2",75,0)
 .   .   .   I TYPE="R"!(TYPE="C")!(TYPE="E")!(TYPE="U")!(TYPE="S") S TRANSNO="--1" Q  ;issue
"RTN","PRCPLO2",76,0)
 .   .   .   I TYPE="RC" S TRANSNO=1 Q  ;receipt
"RTN","PRCPLO2",77,0)
 .   .   .   S TRANSNO="" ;adjustment
"RTN","PRCPLO2",78,0)
 .   .   ;  other adjustments
"RTN","PRCPLO2",79,0)
 .   .   I PRCP("DPTYPE")="W",$P(TRANSNO,"-",2)="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1 Q
"RTN","PRCPLO2",80,0)
 .   .   I TRANSNO="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1
"RTN","PRCPLO2",81,0)
 .   .   E  D
"RTN","PRCPLO2",82,0)
 .   .   .   ;  purchase order
"RTN","PRCPLO2",83,0)
 .   .   .   I $P(TRANSNO,"-",3)="" S REC(ACCT)=$G(REC(ACCT))+INVVAL,RECN(ACCT)=$G(RECN(ACCT))+1 Q
"RTN","PRCPLO2",84,0)
 .   .   .   ;  issue
"RTN","PRCPLO2",85,0)
 .   .   .   S ISS(ACCT)=$G(ISS(ACCT))+INVVAL,ISSN(ACCT)=$G(ISSN(ACCT))+1
"RTN","PRCPLO2",86,0)
 ;  calculate inactive, long supply, set non-issuable
"RTN","PRCPLO2",87,0)
 S X1=$E(DT,1,5)_"01",X2=-89 D C^%DTC S DATELONG=$E(X,1,5),X1=DT,X2=$E(X,1,5)_"00" D ^%DTC S TOTDAYS=X
"RTN","PRCPLO2",88,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPLO2",89,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPLO2",90,0)
 .   ;  value
"RTN","PRCPLO2",91,0)
 .   S VALUE(ACCT)=$G(VALUE(ACCT))+$P(D,"^",27)
"RTN","PRCPLO2",92,0)
 .   S DUEIN(ACCT)=$G(DUEIN(ACCT))+($$GETIN^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPLO2",93,0)
 .   S DUEOUT(ACCT)=$G(DUEOUT(ACCT))+($$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPLO2",94,0)
 .   ;  non-issuable
"RTN","PRCPLO2",95,0)
 .   I $P(D,"^",19) S NONISS(ACCT)=$G(NONISS(ACCT))+($J($P(D,"^",19)*$P(D,"^",22),0,2)),NONISSN(ACCT)=$G(NONISSN(ACCT))+1
"RTN","PRCPLO2",96,0)
 .   ;  inactive
"RTN","PRCPLO2",97,0)
 .   ;  if reusable, quit
"RTN","PRCPLO2",98,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPLO2",99,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPLO2",100,0)
 .   I QTY,'$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01)),'$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC)) S INACT(ACCT)=$G(INACT(ACCT))+$P(D,"^",27),INACTN(ACCT)=$G(INACTN(ACCT))+1
"RTN","PRCPLO2",101,0)
 .   ;  long supply
"RTN","PRCPLO2",102,0)
 .   S DATE=DATELONG-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPLO2",103,0)
 .   S AVERAGE=$J(TOTAL/TOTDAYS,0,2),TOTAL=$S('AVERAGE&(QTY):9999999,'AVERAGE:0,1:QTY/AVERAGE\1)
"RTN","PRCPLO2",104,0)
 .   I TOTAL>270 S LONG(ACCT)=$G(LONG(ACCT))+$P(D,"^",27),LONGN(ACCT)=$G(LONGN(ACCT))+1
"RTN","PRCPLO2",105,0)
 ;
"RTN","PRCPLO2",106,0)
 D ENT^PRCPLO2A
"RTN","PRCPLO2",107,0)
 ;
"RTN","PRCPLO2",108,0)
 Q
"RTN","PRCPOPL")
0^4^B25807256^B23658744
"RTN","PRCPOPL",1,0)
PRCPOPL ;WISC/RFJ/DGL-distribution order processing list manager ; 3/20/00 9:27am
"RTN","PRCPOPL",2,0)
V ;;5.1;IFCAP;**1,41**;Oct 20, 2000
"RTN","PRCPOPL",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPOPL",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPOPL",5,0)
 I "PS"'[PRCP("DPTYPE") W !,"THIS OPTION SHOULD ONLY BE USED BY A PRIMARY OR SECONDARY INVENTORY POINT." Q
"RTN","PRCPOPL",6,0)
 ;
"RTN","PRCPOPL",7,0)
 N %,ORDERDA,PRCPFNEW,PRCPFONE,PRCPORD,PRCPPAT,PRCPPRIM,PRCPSECO,VA,X,Y
"RTN","PRCPOPL",8,0)
 ;
"RTN","PRCPOPL",9,0)
 I PRCP("DPTYPE")="S" S PRCPPRIM=+$$FROMCHEK^PRCPUDPT(PRCP("I"),1) Q:'PRCPPRIM  S PRCPSECO=PRCP("I")
"RTN","PRCPOPL",10,0)
 I PRCP("DPTYPE")="P" S PRCPSECO=+$$TO^PRCPUDPT(PRCP("I")) Q:'PRCPSECO  S PRCPPRIM=PRCP("I")
"RTN","PRCPOPL",11,0)
 W !!,"** Distribution ",$S(PRCP("DPTYPE")="S":"from",1:"to")_" inventory point: ",$$INVNAME^PRCPUX1($S(PRCP("DPTYPE")="S":PRCPPRIM,1:PRCPSECO))," **"
"RTN","PRCPOPL",12,0)
 ;
"RTN","PRCPOPL",13,0)
 F  W !! S ORDERDA=+$$ORDERSEL^PRCPOPUS(PRCPPRIM,PRCPSECO,"*",1) Q:'ORDERDA  D
"RTN","PRCPOPL",14,0)
 .   W !
"RTN","PRCPOPL",15,0)
 .   L +^PRCP(445.3,ORDERDA):5 I '$T D SHOWWHO^PRCPULOC(445.3,ORDERDA,0) D R^PRCPUREP Q
"RTN","PRCPOPL",16,0)
 .   D ADD^PRCPULOC(445.3,ORDERDA,0,"Distribution Order Processing")
"RTN","PRCPOPL",17,0)
 .   I $$TYPE^PRCPOPUS(ORDERDA) D UNLOCK Q
"RTN","PRCPOPL",18,0)
 .   W ! I $$REMARKS^PRCPOPUS(ORDERDA) D UNLOCK Q
"RTN","PRCPOPL",19,0)
 .   D VARIABLE^PRCPOPU
"RTN","PRCPOPL",20,0)
 .   D EN^VALM("PRCP DIST ORDER PROCESSING")
"RTN","PRCPOPL",21,0)
 .   D UNLOCK
"RTN","PRCPOPL",22,0)
 Q
"RTN","PRCPOPL",23,0)
 ;
"RTN","PRCPOPL",24,0)
 ;
"RTN","PRCPOPL",25,0)
UNLOCK ;  unlock distribution order
"RTN","PRCPOPL",26,0)
 D CLEAR^PRCPULOC(445.3,ORDERDA,0)
"RTN","PRCPOPL",27,0)
 L -^PRCP(445.3,ORDERDA)
"RTN","PRCPOPL",28,0)
 Q
"RTN","PRCPOPL",29,0)
 ;
"RTN","PRCPOPL",30,0)
 ;
"RTN","PRCPOPL",31,0)
HDR ;  build header
"RTN","PRCPOPL",32,0)
 K VALMHDR
"RTN","PRCPOPL",33,0)
 I $P($G(PRCPORD(2)),"^")'="" S VALMHDR(1)=$E("POST ITEMS TO: "_$P(PRCPORD(2),"^")_$J(" ",80),1,47)_"  THRU SECONDARY: "_$E($P(PRCPORD(0),"^",3),1,15)
"RTN","PRCPOPL",34,0)
 I $P($G(PRCPORD(2)),"^")="" S VALMHDR(1)="POST ITEMS TO SECONDARY: "_$P(PRCPORD(0),"^",3)
"RTN","PRCPOPL",35,0)
 S VALMHDR(2)=$E("  "_$E($P(PRCPORD(0),"^",2),1,15)_" DISTRIBUTION ORDER: "_$P(PRCPORD(0),"^")_$J(" ",50),1,49)_"STATUS: "_$$STATUS^PRCPOPU(ORDERDA)
"RTN","PRCPOPL",36,0)
 Q
"RTN","PRCPOPL",37,0)
 ;
"RTN","PRCPOPL",38,0)
 ;
"RTN","PRCPOPL",39,0)
INIT ;  init variables and build array
"RTN","PRCPOPL",40,0)
 N DATA,ITEMDA,ITEMDATA,QTYOH,STATUS
"RTN","PRCPOPL",41,0)
 K ^TMP($J,"PRCPOP")
"RTN","PRCPOPL",42,0)
 S VALMCNT=0
"RTN","PRCPOPL",43,0)
 I $P(^PRCP(445.3,ORDERDA,0),"^",10)]"" D SET("  ***This Order was sent to the supply station and cannot be updated. ***"),SET(" ")
"RTN","PRCPOPL",44,0)
 S STATUS=$P(^PRCP(445.3,ORDERDA,0),"^",6)
"RTN","PRCPOPL",45,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.3,ORDERDA,1,ITEMDA)) Q:'ITEMDA  S DATA=$G(^(ITEMDA,0)) I DATA'="" D
"RTN","PRCPOPL",46,0)
 .   D BLDARRAY(PRCPPRIM,PRCPSECO,ITEMDA,$P(DATA,"^",2),STATUS)
"RTN","PRCPOPL",47,0)
 .   S ITEMDATA=$G(^PRCP(445,PRCPPRIM,1,ITEMDA,0)),QTYOH=+$P($G(ITEMDATA),"^",7)
"RTN","PRCPOPL",48,0)
 .   I ITEMDATA="" D SET("  *** WARNING -- ITEM IS NO LONGER STOCKED IN PRIMARY INVENTORY POINT *** ") Q
"RTN","PRCPOPL",49,0)
 .   I STATUS'="P"&($P(DATA,"^",2)>QTYOH),QTYOH'<0 D
"RTN","PRCPOPL",50,0)
 .   .   D SET("     *** WARNING -- QTY ORDERED ("_$P(DATA,"^",2)_") IS MORE THAN QTY ON HAND ("_QTYOH_") ***")
"RTN","PRCPOPL",51,0)
 .   .   D SET("     *** Quantity on hand will be posted unless quantity ordered is edited ***")
"RTN","PRCPOPL",52,0)
 .   I STATUS'="P"&($P(DATA,"^",2)>QTYOH),QTYOH<0 D
"RTN","PRCPOPL",53,0)
 .   .   D SET("     *** WARNING -- QTY ORDERED ("_$P(DATA,"^",2)_") IS MORE THAN QTY ON HAND ("_QTYOH_") ***")
"RTN","PRCPOPL",54,0)
 .   .   D SET(" *** A quantity of ZERO(0) will be posted unless quantity ordered is edited ***")
"RTN","PRCPOPL",55,0)
 .   I STATUS="P"&($P(DATA,"^",2)'=$P(DATA,"^",7)) D SET("              *** Actual posted quantity was "_$P(DATA,"^",7)_" ***")
"RTN","PRCPOPL",56,0)
 ;
"RTN","PRCPOPL",57,0)
 I VALMCNT=0 D SET(" "),SET("  * * * NO ITEMS ARE ON THIS ORDER * * *")
"RTN","PRCPOPL",58,0)
 Q
"RTN","PRCPOPL",59,0)
 ;
"RTN","PRCPOPL",60,0)
 ;
"RTN","PRCPOPL",61,0)
BLDARRAY(PRCPPRIM,PRCPSECO,ITEMDA,QTYORDER,STATUS) ;  build item array
"RTN","PRCPOPL",62,0)
 S:'$D(STATUS) STATUS=0
"RTN","PRCPOPL",63,0)
 S X=$$SETFLD^VALM1("  "_$E($$DESCR^PRCPUX1(PRCPPRIM,ITEMDA),1,28)_" (#"_ITEMDA_")","","ITEM")
"RTN","PRCPOPL",64,0)
 S X=$$SETFLD^VALM1($P($$UNIT^PRCPUX1(PRCPPRIM,ITEMDA,"^"),"^",2),X,"UNIT")
"RTN","PRCPOPL",65,0)
 S X=$$SETFLD^VALM1(QTYORDER,X,"ORDERED")
"RTN","PRCPOPL",66,0)
 S X=$$SETFLD^VALM1($P($$GETVEN^PRCPUVEN(PRCPSECO,ITEMDA,PRCPPRIM_";PRCP(445,",1),"^",4),X,"CONV")
"RTN","PRCPOPL",67,0)
 I STATUS'="P" S X=$$SETFLD^VALM1($P($G(^PRCP(445,PRCPPRIM,1,ITEMDA,0)),"^",7),X,"ONHAND")
"RTN","PRCPOPL",68,0)
 S VALMCNT=VALMCNT+1
"RTN","PRCPOPL",69,0)
 D SET^VALM10(VALMCNT,X,VALMCNT)
"RTN","PRCPOPL",70,0)
 Q
"RTN","PRCPOPL",71,0)
 ;
"RTN","PRCPOPL",72,0)
 ;
"RTN","PRCPOPL",73,0)
EXIT ;  exit and clean up
"RTN","PRCPOPL",74,0)
 K ^TMP($J,"PRCPOP")
"RTN","PRCPOPL",75,0)
 Q
"RTN","PRCPOPL",76,0)
 ;
"RTN","PRCPOPL",77,0)
 ;
"RTN","PRCPOPL",78,0)
EEITEMS ;  called from protocol file to enter/edit invpt items
"RTN","PRCPOPL",79,0)
 N PRC,PRCP
"RTN","PRCPOPL",80,0)
 S PRCP("DPTYPE")="PS"
"RTN","PRCPOPL",81,0)
 D ^PRCPEILM
"RTN","PRCPOPL",82,0)
 D INIT
"RTN","PRCPOPL",83,0)
 S VALMBCK="R"
"RTN","PRCPOPL",84,0)
 Q
"RTN","PRCPOPL",85,0)
 ;
"RTN","PRCPOPL",86,0)
 ;
"RTN","PRCPOPL",87,0)
CHECK(TYPE)        ;  called when screen displays and when protocol selected
"RTN","PRCPOPL",88,0)
 ;  causes () to be display around inappropriate protocol selections
"RTN","PRCPOPL",89,0)
 ;  type="edit" or "delete" or "release" or "picktick" or "post"
"RTN","PRCPOPL",90,0)
 ;  returns 1 for sucess, 0 for no
"RTN","PRCPOPL",91,0)
 I '$D(^PRCP(445.3,$G(ORDERDA),0)) Q 0
"RTN","PRCPOPL",92,0)
 N STATUS,SECID
"RTN","PRCPOPL",93,0)
 S STATUS=$P(^PRCP(445.3,ORDERDA,0),"^",6) S:STATUS="B" STATUS="R"
"RTN","PRCPOPL",94,0)
 S SECID=$P(^PRCP(445.3,ORDERDA,0),"^",3)
"RTN","PRCPOPL",95,0)
 I TYPE="EDIT",PRCP("DPTYPE")="S",STATUS'="" Q 0
"RTN","PRCPOPL",96,0)
 I TYPE'="DELETE",TYPE'="PICKTICK",TYPE'="SEND",$P(^PRCP(445.3,ORDERDA,0),"^",10)]"" Q 0
"RTN","PRCPOPL",97,0)
 I TYPE="EDIT",STATUS="P" Q 0
"RTN","PRCPOPL",98,0)
 I TYPE="DELETE",PRCP("DPTYPE")="S",STATUS'="" Q 0
"RTN","PRCPOPL",99,0)
 I TYPE="DELETE",STATUS="P" Q 0
"RTN","PRCPOPL",100,0)
 I TYPE="RELEASE",STATUS'="" Q 0
"RTN","PRCPOPL",101,0)
 I TYPE="POST",PRCP("DPTYPE")="S" Q 0
"RTN","PRCPOPL",102,0)
 I TYPE="POST",STATUS="" Q 0
"RTN","PRCPOPL",103,0)
 ;I TYPE="POST",$P(^PRCP(445.3,ORDERDA,0),"^",7)="" Q 0
"RTN","PRCPOPL",104,0)
 I TYPE="POST",STATUS="P" Q 0
"RTN","PRCPOPL",105,0)
 I TYPE="PICKTICK",STATUS="P" Q 1
"RTN","PRCPOPL",106,0)
 I TYPE="PICKTICK" I STATUS'="R" Q 0
"RTN","PRCPOPL",107,0)
 I TYPE="SEND",$P(^PRCP(445.3,ORDERDA,0),"^",8)'="R" Q 0
"RTN","PRCPOPL",108,0)
 I TYPE="SEND",$P($G(^PRCP(445,SECID,5)),"^",1)']"" Q 0
"RTN","PRCPOPL",109,0)
 I TYPE="SEND",STATUS'="R" Q 0
"RTN","PRCPOPL",110,0)
 Q 1
"RTN","PRCPOPL",111,0)
 ;
"RTN","PRCPOPL",112,0)
 ;
"RTN","PRCPOPL",113,0)
SET(STRING)        ;  set string in array
"RTN","PRCPOPL",114,0)
 N %
"RTN","PRCPOPL",115,0)
 S VALMCNT=VALMCNT+1
"RTN","PRCPOPL",116,0)
 D SET^VALM10(VALMCNT,STRING)
"RTN","PRCPOPL",117,0)
 Q
"RTN","PRCPOPP")
0^7^B33813357^B33514761
"RTN","PRCPOPP",1,0)
PRCPOPP ;WISC/RFJ-post distribution order;  ; 8/4/99 1:05pm
"RTN","PRCPOPP",2,0)
V ;;5.1;IFCAP;**1,41**;Oct 20, 2000
"RTN","PRCPOPP",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPOPP",4,0)
 Q
"RTN","PRCPOPP",5,0)
 ;
"RTN","PRCPOPP",6,0)
PRCPSS(ORDERDA,PRCPSECO,PRCPPRIM,PRCPSS) ; entry point for supply station
"RTN","PRCPOPP",7,0)
 ; ORDERDA  order to be posted
"RTN","PRCPOPP",8,0)
 ; PRCPSECO secondary inventory point
"RTN","PRCPOPP",9,0)
 ; PRCPPRIM primary inventory point
"RTN","PRCPOPP",10,0)
 ; PRCPSS   flag to designate supply station posting (value = 1)
"RTN","PRCPOPP",11,0)
 G PRCPSS0
"RTN","PRCPOPP",12,0)
 ;
"RTN","PRCPOPP",13,0)
POST ;  post order
"RTN","PRCPOPP",14,0)
 ;  orderda=order number
"RTN","PRCPOPP",15,0)
 S VALMBCK="R"
"RTN","PRCPOPP",16,0)
 N PRCPSS S PRCPSS=0 ; posting is done at GIP
"RTN","PRCPOPP",17,0)
 ;
"RTN","PRCPOPP",18,0)
PRCPSS0 N %,CONVFACT,DATA,ITEMDA,ITEMDATA,ORDRDATA,PRCPFLAG,PRCPID,PRCPOH,PRCPOPP,PRCPPORD,PRCPPTDA,PRCPSORD,QTYDUE,QUANTITY,TOTCOST,UNITCOST,XORDERDA,XDT
"RTN","PRCPOPP",19,0)
 ;
"RTN","PRCPOPP",20,0)
 ;  Check for old orders
"RTN","PRCPOPP",21,0)
 S XORDERDA=0 F  S XORDERDA=$O(^PRCP(445.3,XORDERDA)) Q:'XORDERDA  Q:XORDERDA]"A"  D
"RTN","PRCPOPP",22,0)
 .  S XDT=$P($G(^PRCP(445.3,XORDERDA,0)),"^",9)
"RTN","PRCPOPP",23,0)
 .  Q:'XDT
"RTN","PRCPOPP",24,0)
 .  I XDT+2<DT D DELORDER^PRCPOPD(XORDERDA)
"RTN","PRCPOPP",25,0)
 .  Q
"RTN","PRCPOPP",26,0)
 ;
"RTN","PRCPOPP",27,0)
 I PRCPSS G PRCPSS1 ; checks not valid for supply station posting
"RTN","PRCPOPP",28,0)
 ;
"RTN","PRCPOPP",29,0)
 W !!,"CHECKING ITEMS ON ORDER..."
"RTN","PRCPOPP",30,0)
 S (ITEMDA,PRCPFLAG)=0 F  S ITEMDA=$O(^PRCP(445.3,ORDERDA,1,ITEMDA)) Q:'ITEMDA  S QUANTITY=$P($G(^(ITEMDA,0)),"^",2) I QUANTITY D  I PRCPFLAG Q
"RTN","PRCPOPP",31,0)
 .   I $$ITEMCHK^PRCPOPER(PRCPPRIM,PRCPSECO,ITEMDA)'="" S PRCPFLAG=1 Q
"RTN","PRCPOPP",32,0)
 I PRCPFLAG S VALMSG="ORDER CANNOT BE POSTED - FIX ALL ERRORS FIRST" D CHECKORD^PRCPOPER Q
"RTN","PRCPOPP",33,0)
 W " NO ERRORS FOUND !",!
"RTN","PRCPOPP",34,0)
 ;
"RTN","PRCPOPP",35,0)
 I $P($G(^PRCP(445.3,ORDERDA,0)),"^",7)="" D  Q:$G(PRCPFLAG)
"RTN","PRCPOPP",36,0)
 .   S XP="Do you want to print the picking ticket before posting",XH="Enter YES to print the picking ticket, NO to skip printing it, or ^ to exit."
"RTN","PRCPOPP",37,0)
 .   S %=$$YN^PRCPUYN(1) I %<1 S PRCPFLAG=1 Q
"RTN","PRCPOPP",38,0)
 .   I %'=1 Q
"RTN","PRCPOPP",39,0)
 .   D PICKLM^PRCPOPT
"RTN","PRCPOPP",40,0)
 ;
"RTN","PRCPOPP",41,0)
 S XP="Are you sure you want to POST this order to "_$$INVNAME^PRCPUX1(+$P($G(^PRCP(445.3,+ORDERDA,0)),"^",3)),XH="Enter 'YES' to start posting the order to the secondary inventory point",XH(1)="Enter 'NO' or '^' to exit."
"RTN","PRCPOPP",42,0)
 W ! I $$YN^PRCPUYN(1)'=1 Q
"RTN","PRCPOPP",43,0)
 ;
"RTN","PRCPOPP",44,0)
 L +^PRCP(445,PRCPPRIM,1):5
"RTN","PRCPOPP",45,0)
 I '$T D SHOWWHO^PRCPULOC(445,PRCPPRIM_"-1",0) Q
"RTN","PRCPOPP",46,0)
 L +^PRCP(445,PRCPSECO,1):5 I '$T D  Q
"RTN","PRCPOPP",47,0)
 . L -^PRCP(445,PRCPPRIM,1)
"RTN","PRCPOPP",48,0)
 . D SHOWWHO^PRCPULOC(445,PRCPSECO_"-1",0)
"RTN","PRCPOPP",49,0)
 D ADD^PRCPULOC(445,PRCPPRIM_"-1",0,"Distribution Order Processing")
"RTN","PRCPOPP",50,0)
 D ADD^PRCPULOC(445,PRCPSECO_"-1",0,"Distribution Order Processing")
"RTN","PRCPOPP",51,0)
 ;
"RTN","PRCPOPP",52,0)
 W !,"POSTING DISTRIBUTION ORDER ..."
"RTN","PRCPOPP",53,0)
 ;
"RTN","PRCPOPP",54,0)
 ;  if patient is on order, add entry
"RTN","PRCPOPP",55,0)
PRCPSS1 ;  use the same transaction register numbers fr the entire order
"RTN","PRCPOPP",56,0)
 S PRCPPORD=$$ORDERNO^PRCPUTRX(PRCPPRIM)
"RTN","PRCPOPP",57,0)
 S PRCPSORD=$$ORDERNO^PRCPUTRX(PRCPSECO)
"RTN","PRCPOPP",58,0)
 ;
"RTN","PRCPOPP",59,0)
 I $P($G(^PRCP(445.3,ORDERDA,2)),"^") S DATA=^(2) D
"RTN","PRCPOPP",60,0)
 .   S PRCPPTDA=+$P(DATA,"^",3) I $D(^PRCP(446.1,PRCPPTDA,0)) Q
"RTN","PRCPOPP",61,0)
 .   S PRCPPTDA=$$PATIENT^PRCPUPAT(+$P(DATA,"^"),+$P(DATA,"^",2))
"RTN","PRCPOPP",62,0)
 .   I 'PRCPPTDA Q
"RTN","PRCPOPP",63,0)
 .   S $P(^PRCP(445.3,ORDERDA,2),"^",3)=PRCPPTDA
"RTN","PRCPOPP",64,0)
 .   S $P(^PRCP(446.1,PRCPPTDA,0),"^",6)=PRCPSECO
"RTN","PRCPOPP",65,0)
 ;
"RTN","PRCPOPP",66,0)
 ;  store case carts and instrument kits in
"RTN","PRCPOPP",67,0)
 ;  ^tmp($j,"prcpopccik",itemda)=qty for cc/ik item posting
"RTN","PRCPOPP",68,0)
 K ^TMP($J,"PRCPOPCCIK")
"RTN","PRCPOPP",69,0)
 ;
"RTN","PRCPOPP",70,0)
 ;  post order
"RTN","PRCPOPP",71,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.3,ORDERDA,1,ITEMDA)) Q:'ITEMDA  S ORDRDATA=$G(^(ITEMDA,0)) D
"RTN","PRCPOPP",72,0)
 .   S (QTYDUE,QUANTITY)=$P(ORDRDATA,"^",2)
"RTN","PRCPOPP",73,0)
 .   S PRCPOH=$P($G(^PRCP(445,PRCPPRIM,1,ITEMDA,0)),"^",7)
"RTN","PRCPOPP",74,0)
 .   I PRCPOH+0=0 S PRCPOH=0
"RTN","PRCPOPP",75,0)
 .   I QUANTITY>PRCPOH S QUANTITY=PRCPOH
"RTN","PRCPOPP",76,0)
 .   I PRCPOH<0 S QUANTITY=0
"RTN","PRCPOPP",77,0)
 .   I PRCPSS S QUANTITY=$P(ORDRDATA,"^",7) ; use qty that was stocked
"RTN","PRCPOPP",78,0)
 .   ; 
"RTN","PRCPOPP",79,0)
 .   ;  if case cart or instrument kit, set tmp global
"RTN","PRCPOPP",80,0)
 .   I $D(^PRCP(445.7,ITEMDA,0))!($D(^PRCP(445.8,ITEMDA,0))) S:QUANTITY>0 ^TMP($J,"PRCPOPCCIK",ITEMDA)=QUANTITY Q
"RTN","PRCPOPP",81,0)
 .   ;
"RTN","PRCPOPP",82,0)
 .   S ITEMDATA=^PRCP(445,PRCPPRIM,1,ITEMDA,0)
"RTN","PRCPOPP",83,0)
 .   S UNITCOST=+$P(ITEMDATA,"^",22) I 'UNITCOST S UNITCOST=+$P(ITEMDATA,"^",15)
"RTN","PRCPOPP",84,0)
 .   I 'UNITCOST S UNITCOST=+$P(ORDRDATA,"^",3)
"RTN","PRCPOPP",85,0)
 .   S TOTCOST=$J(QUANTITY*UNITCOST,0,2)
"RTN","PRCPOPP",86,0)
 .   ;
"RTN","PRCPOPP",87,0)
 .   ;
"RTN","PRCPOPP",88,0)
 .   I QTYDUE'=0 D
"RTN","PRCPOPP",89,0)
 .   .   I 'PRCPSS!(PRCPSS&$D(^PRCP(445,PRCPPRIM,1,ITEMDA))) D 
"RTN","PRCPOPP",90,0)
 .   .   .   ;  sell from primary
"RTN","PRCPOPP",91,0)
 .   .   .   K PRCPOPP
"RTN","PRCPOPP",92,0)
 .   .   .   S PRCPOPP("QTY")=-QUANTITY,PRCPOPP("DUEOUT")=-QTYDUE,PRCPOPP("INVVAL")=-TOTCOST,PRCPOPP("OTHERPT")=PRCPSECO,PRCPOPP("ORDERDA")=ORDERDA
"RTN","PRCPOPP",93,0)
 .   .   .   D SALE^PRCPOPPP(PRCPPRIM,ITEMDA,PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP",94,0)
 .   .   ;
"RTN","PRCPOPP",95,0)
 .   .   I 'PRCPSS!(PRCPSS&$D(^PRCP(445,PRCPSECO,1,ITEMDA))) D
"RTN","PRCPOPP",96,0)
 .   .   .   ;  receipt in secondary
"RTN","PRCPOPP",97,0)
 .   .   .   S CONVFACT=$P($$GETVEN^PRCPUVEN(PRCPSECO,ITEMDA,PRCPPRIM_";PRCP(445,",1),"^",4)
"RTN","PRCPOPP",98,0)
 .   .   .   K PRCPOPP
"RTN","PRCPOPP",99,0)
 .   .   .   S PRCPOPP("QTY")=QUANTITY*CONVFACT,PRCPOPP("DUEIN")=-QTYDUE*CONVFACT,PRCPOPP("INVVAL")=TOTCOST,PRCPOPP("OTHERPT")=PRCPPRIM
"RTN","PRCPOPP",100,0)
 .   .   .   ;  if patient, distribute from secondary to patient
"RTN","PRCPOPP",101,0)
 .   .   .   I $G(PRCPPTDA) S PRCPOPP("PRCPPTDA")=PRCPPTDA
"RTN","PRCPOPP",102,0)
 .   .   .   D RECEIPT^PRCPOPPP(PRCPSECO,ITEMDA,PRCPSORD,.PRCPOPP)
"RTN","PRCPOPP",103,0)
 .   .   .   Q
"RTN","PRCPOPP",104,0)
 .   ;
"RTN","PRCPOPP",105,0)
 .   ;  Set quantity posted into item multiple
"RTN","PRCPOPP",106,0)
 .   I 'PRCPSS S $P(^PRCP(445.3,ORDERDA,1,ITEMDA,0),"^",7)=QUANTITY
"RTN","PRCPOPP",107,0)
 ;
"RTN","PRCPOPP",108,0)
 ;  Set up posted status
"RTN","PRCPOPP",109,0)
 S $P(^PRCP(445.3,ORDERDA,0),"^",6)="P",$P(^(0),"^",9)=DT
"RTN","PRCPOPP",110,0)
 ;
"RTN","PRCPOPP",111,0)
 ;  if an item is a cc or ik
"RTN","PRCPOPP",112,0)
 I $O(^TMP($J,"PRCPOPCCIK",0)) D
"RTN","PRCPOPP",113,0)
 .   ; if interactive, display screen to post items in cc and iks
"RTN","PRCPOPP",114,0)
 .   I 'PRCPSS D EN^VALM("PRCP DIST ORDER CC/IK POSTING")
"RTN","PRCPOPP",115,0)
 .   I PRCPSS D  ; mark amount rec'd as 0, so user gets message
"RTN","PRCPOPP",116,0)
 .   .  N PRCPAMT
"RTN","PRCPOPP",117,0)
 .   .  S DIE="^PRCP(445.3,"_ORDERDA_",1,"
"RTN","PRCPOPP",118,0)
 .   .  S DA=PRCPITEM
"RTN","PRCPOPP",119,0)
 .   .  S PRCPAMT="@" ; delete entry to invoke bulletin to user
"RTN","PRCPOPP",120,0)
 .   .  S DR="6///^S X=PRCPAMT"
"RTN","PRCPOPP",121,0)
 .   .  D ^DIE K DIE
"RTN","PRCPOPP",122,0)
 .   .  Q
"RTN","PRCPOPP",123,0)
 .   Q
"RTN","PRCPOPP",124,0)
 ;
"RTN","PRCPOPP",125,0)
 I 'PRCPSS D
"RTN","PRCPOPP",126,0)
 . D CLEAR^PRCPULOC(445,PRCPPRIM_"-1",0),CLEAR^PRCPULOC(445,PRCPSECO_"-1",0)
"RTN","PRCPOPP",127,0)
 . L -^PRCP(445,PRCPPRIM,1),-^PRCP(445,PRCPSECO,1)
"RTN","PRCPOPP",128,0)
 ;
"RTN","PRCPOPP",129,0)
 Q
"RTN","PRCPOPP3")
0^8^B19187191^B20917787
"RTN","PRCPOPP3",1,0)
PRCPOPP3 ;WISC/RFJ/DWA-case cart/instrument kit post (cont) ;27 Sep 93
"RTN","PRCPOPP3",2,0)
 ;;5.1;IFCAP;**41**;Oct 20, 2000
"RTN","PRCPOPP3",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPOPP3",4,0)
 Q
"RTN","PRCPOPP3",5,0)
 ;
"RTN","PRCPOPP3",6,0)
 ;
"RTN","PRCPOPP3",7,0)
POST ;  post cc/ik items
"RTN","PRCPOPP3",8,0)
 N INVVALUE,ORDRDATA,PRCPOPP,QTYORDER,QTYPOST,QTYRET,QUANTITY,REUSABLE,UNITCOST
"RTN","PRCPOPP3",9,0)
 S CCIKITEM=0 F  S CCIKITEM=$O(^TMP($J,"PRCPOPPC-ITEMS",CCIKITEM)) Q:'CCIKITEM  D
"RTN","PRCPOPP3",10,0)
 .   ;  if cc or ik item is on distribution order, sell ccik item from
"RTN","PRCPOPP3",11,0)
 .   ;  primary and update primary qty on-hand, dueouts, etc.
"RTN","PRCPOPP3",12,0)
 .   I $D(^PRCP(445.3,ORDERDA,1,CCIKITEM,0)) S ORDRDATA=^(0) D
"RTN","PRCPOPP3",13,0)
 .   .   S QUANTITY=$P(ORDRDATA,"^",2),INVVALUE=$J(QUANTITY*$P(ORDRDATA,"^",3),0,2)
"RTN","PRCPOPP3",14,0)
 .   .   I 'QUANTITY D DELITEM^PRCPOPD(ORDERDA,CCIKITEM) Q
"RTN","PRCPOPP3",15,0)
 .   .   ;  sell item from primary
"RTN","PRCPOPP3",16,0)
 .   .   K PRCPOPP
"RTN","PRCPOPP3",17,0)
 .   .   S (PRCPOPP("QTY"),PRCPOPP("DUEOUT"))=-QUANTITY,PRCPOPP("INVVAL")=-INVVALUE,PRCPOPP("OTHERPT")=PRCPSECO,PRCPOPP("ORDERDA")=ORDERDA
"RTN","PRCPOPP3",18,0)
 .   .   D SALE^PRCPOPPP(PRCPPRIM,CCIKITEM,PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP3",19,0)
 .   .   ;
"RTN","PRCPOPP3",20,0)
 .   .   K PRCPOPP
"RTN","PRCPOPP3",21,0)
 .   .   S PRCPOPP("QTY")=QUANTITY*$P($$GETVEN^PRCPUVEN(PRCPSECO,CCIKITEM,PRCPPRIM_";PRCP(445,",1),"^",4),PRCPOPP("DUEIN")=-PRCPOPP("QTY"),PRCPOPP("INVVAL")=INVVALUE
"RTN","PRCPOPP3",22,0)
 .   .   I $G(PRCPPTDA) S PRCPOPP("PRCPPTDA")=+$G(PRCPPTDA)
"RTN","PRCPOPP3",23,0)
 .   .   D RECEIPT^PRCPOPPP(PRCPSECO,CCIKITEM,PRCPSORD,.PRCPOPP)
"RTN","PRCPOPP3",24,0)
 .   .   ;
"RTN","PRCPOPP3",25,0)
 .   .   ;  remove ccik item from order
"RTN","PRCPOPP3",26,0)
 .   .   ;D DELITEM^PRCPOPD(ORDERDA,CCIKITEM)
"RTN","PRCPOPP3",27,0)
 .   ;
"RTN","PRCPOPP3",28,0)
 .   ;  post items in cc/ik
"RTN","PRCPOPP3",29,0)
 .   S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPOPPC-ITEMS",CCIKITEM,ITEMDA)) Q:'ITEMDA  S %=^(ITEMDA) D
"RTN","PRCPOPP3",30,0)
 .   .   S QTYORDER=$P(%,"^"),QTYRET=$P(%,"^",2),QTYPOST=QTYORDER-QTYRET
"RTN","PRCPOPP3",31,0)
 .   .   S REUSABLE=$$REUSABLE^PRCPU441(ITEMDA)
"RTN","PRCPOPP3",32,0)
 .   .   ;  calculate inventory value of items sold
"RTN","PRCPOPP3",33,0)
 .   .   S %=$G(^PRCP(445,PRCPPRIM,1,ITEMDA,0))
"RTN","PRCPOPP3",34,0)
 .   .   S UNITCOST=$P(%,"^",15) I 'UNITCOST S UNITCOST=$P(%,"^",22)
"RTN","PRCPOPP3",35,0)
 .   .   S INVVALUE=$J(QTYPOST*UNITCOST,0,2)
"RTN","PRCPOPP3",36,0)
 .   .   D PRIMARY
"RTN","PRCPOPP3",37,0)
 .   .   D SECOND
"RTN","PRCPOPP3",38,0)
 Q
"RTN","PRCPOPP3",39,0)
 ;
"RTN","PRCPOPP3",40,0)
 ;
"RTN","PRCPOPP3",41,0)
PRIMARY ;  sale of item from primary
"RTN","PRCPOPP3",42,0)
 ;  if an item is an ik, sell it
"RTN","PRCPOPP3",43,0)
 ;I $D(^PRCP(445.8,ITEMDA)) D  Q
"RTN","PRCPOPP3",44,0)
 ;.   K PRCPOPP
"RTN","PRCPOPP3",45,0)
 ;.   S PRCPOPP("QTY")=-QTYPOST,PRCPOPP("INVVAL")=-INVVALUE,PRCPOPP("OTHERPT")=PRCPSECO,PRCPOPP("ORDERDA")=ORDERDA
"RTN","PRCPOPP3",46,0)
 ;.   S PRCPOPP("REASON")="0:Instrument kit sold with case cart IM# "_CCIKITEM
"RTN","PRCPOPP3",47,0)
 ;.   D SALE^PRCPOPPP(PRCPPRIM,ITEMDA,PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP3",48,0)
 ;
"RTN","PRCPOPP3",49,0)
 ;  if item is reusable and was returned, do nothing
"RTN","PRCPOPP3",50,0)
 I REUSABLE,QTYPOST=0 Q
"RTN","PRCPOPP3",51,0)
 ;
"RTN","PRCPOPP3",52,0)
 ;  if item is reusable and not returned, sell it
"RTN","PRCPOPP3",53,0)
 I REUSABLE D  Q
"RTN","PRCPOPP3",54,0)
 .   K PRCPOPP
"RTN","PRCPOPP3",55,0)
 .   S PRCPOPP("QTY")=-QTYPOST,PRCPOPP("INVVAL")=-INVVALUE,PRCPOPP("OTHERPT")=PRCPSECO,PRCPOPP("ORDERDA")=ORDERDA
"RTN","PRCPOPP3",56,0)
 .   S PRCPOPP("REASON")="0:Reusable item not returned in cc,ik IM# "_CCIKITEM
"RTN","PRCPOPP3",57,0)
 .   D SALE^PRCPOPPP(PRCPPRIM,ITEMDA,PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP3",58,0)
 ;
"RTN","PRCPOPP3",59,0)
 ;  disposable items
"RTN","PRCPOPP3",60,0)
 ;  if item is disposable and not returned, show distribution
"RTN","PRCPOPP3",61,0)
 ;  do not update primary invpt since it was updated during assembly
"RTN","PRCPOPP3",62,0)
 I QTYRET=0 D  Q
"RTN","PRCPOPP3",63,0)
 .   K PRCPOPP
"RTN","PRCPOPP3",64,0)
 .   S PRCPOPP("QTY")=-QTYPOST,PRCPOPP("INVVAL")=-INVVALUE,PRCPOPP("OTHERPT")=PRCPSECO,PRCPOPP("ORDERDA")=ORDERDA,PRCPOPP("NOINVPT")=1
"RTN","PRCPOPP3",65,0)
 .   D SALE^PRCPOPPP(PRCPPRIM,ITEMDA,PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP3",66,0)
 ;
"RTN","PRCPOPP3",67,0)
 ;  if disposable item is returned, add back to primary inventory
"RTN","PRCPOPP3",68,0)
 K PRCPOPP
"RTN","PRCPOPP3",69,0)
 S PRCPOPP("QTY")=QTYRET,PRCPOPP("INVVAL")=$J(QTYRET*UNITCOST,0,2)
"RTN","PRCPOPP3",70,0)
 S PRCPOPP("REASON")="0:Disposable item returned with cc,ik IM# "_CCIKITEM
"RTN","PRCPOPP3",71,0)
 D INVPT^PRCPOPPP(PRCPPRIM,ITEMDA,"S",PRCPPORD,.PRCPOPP)
"RTN","PRCPOPP3",72,0)
 Q
"RTN","PRCPOPP3",73,0)
 ;
"RTN","PRCPOPP3",74,0)
 ;
"RTN","PRCPOPP3",75,0)
SECOND ;  receipt in secondary
"RTN","PRCPOPP3",76,0)
 ;  if an item is an ik, receive it
"RTN","PRCPOPP3",77,0)
 I $D(^PRCP(445.8,ITEMDA)) D  Q
"RTN","PRCPOPP3",78,0)
 .   K PRCPOPP
"RTN","PRCPOPP3",79,0)
 .   S PRCPOPP("QTY")=QTYPOST,PRCPOPP("INVVAL")=INVVALUE,PRCPOPP("OTHERPT")=PRCPPRIM
"RTN","PRCPOPP3",80,0)
 .   I $G(PRCPPTDA) S PRCPOPP("PRCPPTDA")=+$G(PRCPPTDA)
"RTN","PRCPOPP3",81,0)
 .   S PRCPOPP("REASON")="0:Instrument kit sold with case cart IM# "_CCIKITEM
"RTN","PRCPOPP3",82,0)
 .   D RECEIPT^PRCPOPPP(PRCPSECO,ITEMDA,PRCPSORD,.PRCPOPP)
"RTN","PRCPOPP3",83,0)
 ;
"RTN","PRCPOPP3",84,0)
 ;  if item is reusable and was returned, do nothing
"RTN","PRCPOPP3",85,0)
 I REUSABLE,QTYPOST=0 Q
"RTN","PRCPOPP3",86,0)
 ;
"RTN","PRCPOPP3",87,0)
 ;  if item is reusable and not returned, receive it
"RTN","PRCPOPP3",88,0)
 I REUSABLE D  Q
"RTN","PRCPOPP3",89,0)
 .   K PRCPOPP
"RTN","PRCPOPP3",90,0)
 .   S PRCPOPP("QTY")=QTYPOST,PRCPOPP("INVVAL")=INVVALUE,PRCPOPP("OTHERPT")=PRCPPRIM
"RTN","PRCPOPP3",91,0)
 .   I $G(PRCPPTDA) S PRCPOPP("PRCPPTDA")=+$G(PRCPPTDA)
"RTN","PRCPOPP3",92,0)
 .   S PRCPOPP("REASON")="0:Reusable item not returned in cc,ik IM# "_CCIKITEM
"RTN","PRCPOPP3",93,0)
 .   D RECEIPT^PRCPOPPP(PRCPSECO,ITEMDA,PRCPSORD,.PRCPOPP)
"RTN","PRCPOPP3",94,0)
 ;
"RTN","PRCPOPP3",95,0)
 ;  disposable items
"RTN","PRCPOPP3",96,0)
 ;  if item is disposable and returned, do nothing
"RTN","PRCPOPP3",97,0)
 I QTYPOST=0 Q
"RTN","PRCPOPP3",98,0)
 ;
"RTN","PRCPOPP3",99,0)
 ;  disposable items not returned
"RTN","PRCPOPP3",100,0)
 K PRCPOPP
"RTN","PRCPOPP3",101,0)
 S PRCPOPP("QTY")=QTYPOST,PRCPOPP("INVVAL")=INVVALUE,PRCPOPP("OTHERPT")=PRCPPRIM
"RTN","PRCPOPP3",102,0)
 I $G(PRCPPTDA) S PRCPOPP("PRCPPTDA")=+$G(PRCPPTDA)
"RTN","PRCPOPP3",103,0)
 D RECEIPT^PRCPOPPP(PRCPSECO,ITEMDA,PRCPSORD,.PRCPOPP)
"RTN","PRCPOPP3",104,0)
 Q
"RTN","PRCPRISP")
0^2^B25854913^B25769117
"RTN","PRCPRISP",1,0)
PRCPRISP ;WISC/RFJ/DWA-inventory sales (primary) ;24 May 93
"RTN","PRCPRISP",2,0)
 ;;5.1;IFCAP;**41**;Oct 20, 2000
"RTN","PRCPRISP",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPRISP",4,0)
 Q
"RTN","PRCPRISP",5,0)
 ;
"RTN","PRCPRISP",6,0)
 ;
"RTN","PRCPRISP",7,0)
PRIMARY ;  inventory sales for primary
"RTN","PRCPRISP",8,0)
 N DATEEND,DATESTRT,DISTRALL,PRCPSUMM,X
"RTN","PRCPRISP",9,0)
 K X S X(1)="The Inventory Sales Report will display all sales from the Primary to the Secondary inventory points.  This report is sorted by description, the distribution point, and date issued." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRISP",10,0)
 K X S X(1)="Select the DISTRIBUTION POINTS to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRISP",11,0)
 D DISTRSEL^PRCPURS3(PRCP("I"))
"RTN","PRCPRISP",12,0)
 I '$G(DISTRALL),'$O(^TMP($J,"PRCPURS3","YES",0)) W !,"*** NO DISTRIBUTION POINTS SELECTED !" D Q Q
"RTN","PRCPRISP",13,0)
 K X S X(1)="Select the range of ISSUE DATES to display" W !! D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRISP",14,0)
 D DATESEL^PRCPURS2("Issue") I '$G(DATEEND) D Q Q
"RTN","PRCPRISP",15,0)
 S PRCPSUMM=$$SUMMARY^PRCPURS0 I PRCPSUMM<0 D Q Q
"RTN","PRCPRISP",16,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP Q I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D Q Q
"RTN","PRCPRISP",17,0)
 . S ZTDESC="Primary Inventory Sales Report",ZTRTN="DQ^PRCPRISP"
"RTN","PRCPRISP",18,0)
 . S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("DISTRALL")="",ZTSAVE("^TMP($J,""PRCPURS3"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRISP",19,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRISP",20,0)
DQ ;  queue starts here
"RTN","PRCPRISP",21,0)
 N %,%H,%I,DA,DATA,DATE,DATEEDT,DATESDT,DESCR,DISTRNM,DISTRPT,ITEMDA,ITEMDATA,NOW,PAGE,PRCPDATA,PRCPFLAG,SCREEN,TOTALQ,TOTALQI,TOTALV,TOTALVI,TYPE,X,Y
"RTN","PRCPRISP",22,0)
 K ^TMP($J,"PRCPRISP"),^TMP($J,"PRCPRISP TOT")
"RTN","PRCPRISP",23,0)
 S DATE=DATESTRT-.01 F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:'DATE!(DATE>DATEEND)  F TYPE="R","C","E","U","S" S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPRISP",24,0)
 . S DATA=$G(^PRCP(445.2,DA,0)) I DATA="" Q
"RTN","PRCPRISP",25,0)
 . S ITEMDA=$P(DATA,"^",5),DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRISP",26,0)
 . S DISTRPT=+$P(DATA,"^",18)
"RTN","PRCPRISP",27,0)
 . I 'DISTRPT,'$G(DISTRALL) Q
"RTN","PRCPRISP",28,0)
 . I $G(DISTRALL),$D(^TMP($J,"PRCPURS3","NO",DISTRPT)) Q
"RTN","PRCPRISP",29,0)
 . I '$G(DISTRALL),'$D(^TMP($J,"PRCPURS3","YES",DISTRPT)) Q
"RTN","PRCPRISP",30,0)
 . S DISTRNM=$$INVNAME^PRCPUX1(DISTRPT) S:DISTRNM="" DISTRNM=" "
"RTN","PRCPRISP",31,0)
 . S $P(DATA,"^",7)=-$P(DATA,"^",7),$P(DATA,"^",23)=-$P(DATA,"^",23)
"RTN","PRCPRISP",32,0)
 . I '$P(DATA,"^",23) S $P(DATA,"^",23)=$J($P(DATA,"^",7)*$P(DATA,"^",8),0,2)
"RTN","PRCPRISP",33,0)
 . ;I $P(DATA,"^",23)<0 S $P(DATA,"^",23)=-$P(DATA,"^",23)
"RTN","PRCPRISP",34,0)
 . S ^TMP($J,"PRCPRISP",$E(DESCR,1,10),ITEMDA,$E(DISTRNM,1,24),DATE,DA)=$P(DATA,"^",7)_"^"_$S('$P(DATA,"^",7):0,1:$J($P(DATA,"^",23)/$P(DATA,"^",7),0,3))_"^"_$P(DATA,"^",23)
"RTN","PRCPRISP",35,0)
 ;  print report
"RTN","PRCPRISP",36,0)
 S Y=DATESTRT D DD^%DT S DATESDT=Y,Y=DATEEND D DD^%DT S DATEEDT=Y
"RTN","PRCPRISP",37,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRISP",38,0)
 S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRISP",DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  D
"RTN","PRCPRISP",39,0)
 . I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRISP",40,0)
 . I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISP",41,0)
 . S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRISP",42,0)
 . W:'PRCPSUMM !,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,38),?39,"[",ITEMDA,"]"
"RTN","PRCPRISP",43,0)
 . S (TOTALQI,TOTALVI)=0
"RTN","PRCPRISP",44,0)
 . S DISTRPT="" F  S DISTRPT=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT)) Q:DISTRPT=""!($G(PRCPFLAG))  D
"RTN","PRCPRISP",45,0)
 . . W:'PRCPSUMM !?15,$S(DISTRPT=" ":"<<NONE>>",1:DISTRPT)
"RTN","PRCPRISP",46,0)
 . . S (TOTALQ,TOTALV)=0
"RTN","PRCPRISP",47,0)
 . . S DATE=0 F  S DATE=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT,DATE)) Q:'DATE!($G(PRCPFLAG))  S DA=0 F  S DA=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT,DATE,DA)) Q:'DA!($G(PRCPFLAG))  S PRCPDATA=^(DA) D
"RTN","PRCPRISP",48,0)
 . . . W:'PRCPSUMM ?40,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3),$J($P(PRCPDATA,"^"),10),$J($P(PRCPDATA,"^",2),10,3),$J($P(PRCPDATA,"^",3),12,2),!
"RTN","PRCPRISP",49,0)
 . . . S TOTALQ=TOTALQ+$P(PRCPDATA,"^"),TOTALV=TOTALV+$P(PRCPDATA,"^",3)
"RTN","PRCPRISP",50,0)
 . . . I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H W !
"RTN","PRCPRISP",51,0)
 . . I $G(PRCPFLAG) Q
"RTN","PRCPRISP",52,0)
 . . S TOTALQI=TOTALQI+TOTALQ,TOTALVI=TOTALVI+TOTALV
"RTN","PRCPRISP",53,0)
 . . S ^TMP($J,"PRCPRISP TOT",DISTRPT)=$G(^TMP($J,"PRCPRISP TOT",DISTRPT))+TOTALV
"RTN","PRCPRISP",54,0)
 . . I 'PRCPSUMM W:$X>20 ! W ?27,"TOTALS BY DISTR. PT: ",$J(TOTALQ,10),$J(TOTALV,22,2)
"RTN","PRCPRISP",55,0)
 . I $G(PRCPFLAG) Q
"RTN","PRCPRISP",56,0)
 . W:'PRCPSUMM !?32,"TOTALS BY ITEM: ",$J(TOTALQI,10),$J(TOTALVI,22,2)
"RTN","PRCPRISP",57,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRISP",58,0)
 I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISP",59,0)
 W !!,"TOTAL SALES TO DISTRIBUTION POINTS:"
"RTN","PRCPRISP",60,0)
 S TOTALV=0,DISTRPT="" F  S DISTRPT=$O(^TMP($J,"PRCPRISP TOT",DISTRPT)) Q:DISTRPT=""!($G(PRCPFLAG))  S %=$G(^(DISTRPT)) D
"RTN","PRCPRISP",61,0)
 . W !?10,DISTRPT,?40,$J(%,20,2)
"RTN","PRCPRISP",62,0)
 . S TOTALV=TOTALV+%
"RTN","PRCPRISP",63,0)
 . I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISP",64,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRISP",65,0)
 W !?10,"TOTAL",?40,$J(TOTALV,20,2)
"RTN","PRCPRISP",66,0)
 D END^PRCPUREP
"RTN","PRCPRISP",67,0)
Q D ^%ZISC K ^TMP($J,"PRCPURS3"),^TMP($J,"PRCPRISP"),^TMP($J,"PRCPRISP TOT")
"RTN","PRCPRISP",68,0)
 Q
"RTN","PRCPRISP",69,0)
 ;
"RTN","PRCPRISP",70,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRISP",71,0)
 W $C(13),"INVENTORY SALES FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRISP",72,0)
 W !?5,"INVENTORY SALES DATE RANGE: ",DATESDT,"  TO  ",DATEEDT
"RTN","PRCPRISP",73,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRISP",74,0)
 I PRCPSUMM W !?1,"*** ONLY SUMMARY OF SALES PRINTED ***",!,% Q
"RTN","PRCPRISP",75,0)
 W !,"DESCRIPTION",?37,"DATE ISSUED",$J("QUANTITY",10),$J("SELL COST",10),$J("TOTAL VALUE",12),!,%
"RTN","PRCPRISP",76,0)
 Q
"RTN","PRCPRISS")
0^9^B31105422^B31091039
"RTN","PRCPRISS",1,0)
PRCPRISS ;WISC/RFJ-inventory sales (secondary)               ;24 May 93
"RTN","PRCPRISS",2,0)
V ;;5.1;IFCAP;**1,41**;Oct 20, 2000
"RTN","PRCPRISS",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPRISS",4,0)
 Q
"RTN","PRCPRISS",5,0)
 ;
"RTN","PRCPRISS",6,0)
 ;
"RTN","PRCPRISS",7,0)
 ;  inventory sales report
"RTN","PRCPRISS",8,0)
SECOND N ANS,DATEEND,DATESTRT,DISTRALL,PRCPEND,PRCPSTRT,PRCPSUMM,X
"RTN","PRCPRISS",9,0)
 K X S X(1)="The Inventory Sales Report will display all sales from the Secondary inventory point.  This report is sorted by description, the recipient and the date issued." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRISS",10,0)
 ;
"RTN","PRCPRISS",11,0)
 K X S X(1)="Select the RECIPIENTS to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRISS",12,0)
 D DISTRSEL^PRCPURS3(PRCP("I"))
"RTN","PRCPRISS",13,0)
 I '$G(DISTRALL),$O(^TMP($J,"PRCPURS3","YES",0))']"" W !,"*** NO RECIPIENTS SELECTED !" D Q Q
"RTN","PRCPRISS",14,0)
 ;
"RTN","PRCPRISS",15,0)
 K X S X(1)="Select the range of ISSUE DATES to display" W !! D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRISS",16,0)
 D DATESEL^PRCPURS2("Issue") I '$G(DATEEND) D Q Q
"RTN","PRCPRISS",17,0)
 ;
"RTN","PRCPRISS",18,0)
 S PRCPSUMM=$$SUMMARY^PRCPURS0 I PRCPSUMM<0 D Q Q
"RTN","PRCPRISS",19,0)
 ;
"RTN","PRCPRISS",20,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP Q I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D Q Q
"RTN","PRCPRISS",21,0)
 . S ZTDESC="Secondary Inventory Sales Report",ZTRTN="DQ^PRCPRISS"
"RTN","PRCPRISS",22,0)
 . S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("DISTRALL")="",ZTSAVE("^TMP($J,""PRCPURS3"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRISS",23,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRISS",24,0)
 ;
"RTN","PRCPRISS",25,0)
 ;  queue starts here
"RTN","PRCPRISS",26,0)
DQ N %,%H,%I,DA,DATA,DATE,DATEEDT,DATESDT,DESCR,DISTRNM,DISTRPT,ITEMDA,ITEMDATA,NOW,PAGE,PRCPDATA,PRCPFLAG,SCREEN,TOTALQ,TOTALQI,TOTALV,TOTALVI,X,Y
"RTN","PRCPRISS",27,0)
 K ^TMP($J,"PRCPRISP"),^TMP($J,"PRCPRISP TOT")
"RTN","PRCPRISS",28,0)
 S DATE=DATESTRT-.01 F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:'DATE!(DATE>DATEEND)  S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,"U",DA)) Q:'DA  D
"RTN","PRCPRISS",29,0)
 . S DATA=$G(^PRCP(445.2,DA,0)) I DATA="" Q
"RTN","PRCPRISS",30,0)
 . S ITEMDA=$P(DATA,"^",5),DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRISS",31,0)
 . S DISTRPT=$P($G(^PRCP(445.2,DA,2)),"^",2)
"RTN","PRCPRISS",32,0)
 . I DISTRPT']"",'$G(DISTRALL) Q
"RTN","PRCPRISS",33,0)
 . I $G(DISTRALL),$D(^TMP($J,"PRCPURS3","NO",DISTRPT)) Q
"RTN","PRCPRISS",34,0)
 . I '$G(DISTRALL),'$D(^TMP($J,"PRCPURS3","YES",DISTRPT)) Q
"RTN","PRCPRISS",35,0)
 . S $P(DATA,"^",7)=-$P(DATA,"^",7),$P(DATA,"^",23)=-$P(DATA,"^",23)
"RTN","PRCPRISS",36,0)
 . I '$P(DATA,"^",23) S $P(DATA,"^",23)=$J($P(DATA,"^",7)*$P(DATA,"^",8),0,2)
"RTN","PRCPRISS",37,0)
 . S ^TMP($J,"PRCPRISP",$E(DESCR,1,10),ITEMDA,$E(DISTRPT,1,24),DATE,DA)=$P(DATA,"^",7)_"^"_$S('$P(DATA,"^",7):0,1:$J($P(DATA,"^",23)/$P(DATA,"^",7),0,3))_"^"_$P(DATA,"^",23)
"RTN","PRCPRISS",38,0)
 ;
"RTN","PRCPRISS",39,0)
 ;  print report
"RTN","PRCPRISS",40,0)
 S Y=DATESTRT D DD^%DT S DATESDT=Y,Y=DATEEND D DD^%DT S DATEEDT=Y
"RTN","PRCPRISS",41,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","PRCPRISS",42,0)
 S PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRISS",43,0)
 S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRISP",DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  D
"RTN","PRCPRISS",44,0)
 . I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRISS",45,0)
 . I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISS",46,0)
 . S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRISS",47,0)
 . W:'PRCPSUMM !,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,38),?39,"[",ITEMDA,"]"
"RTN","PRCPRISS",48,0)
 . S (TOTALQI,TOTALVI)=0
"RTN","PRCPRISS",49,0)
 . S DISTRPT="" F  S DISTRPT=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT)) Q:DISTRPT=""!($G(PRCPFLAG))  D
"RTN","PRCPRISS",50,0)
 . . W:'PRCPSUMM !?15,$S(DISTRPT=" ":"<<NONE>>",1:DISTRPT)
"RTN","PRCPRISS",51,0)
 . . S (TOTALQ,TOTALV)=0
"RTN","PRCPRISS",52,0)
 . . S DATE=0 F  S DATE=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT,DATE)) Q:'DATE!($G(PRCPFLAG))  S DA=0 F  S DA=$O(^TMP($J,"PRCPRISP",DESCR,ITEMDA,DISTRPT,DATE,DA)) Q:'DA!($G(PRCPFLAG))  S PRCPDATA=^(DA) D
"RTN","PRCPRISS",53,0)
 . . . W:'PRCPSUMM ?40,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3),$J($P(PRCPDATA,"^"),10),$J($P(PRCPDATA,"^",2),10,3),$J($P(PRCPDATA,"^",3),12,2),!
"RTN","PRCPRISS",54,0)
 . . . S TOTALQ=TOTALQ+$P(PRCPDATA,"^"),TOTALV=TOTALV+$P(PRCPDATA,"^",3)
"RTN","PRCPRISS",55,0)
 . . . I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H W !
"RTN","PRCPRISS",56,0)
 . . I $G(PRCPFLAG) Q
"RTN","PRCPRISS",57,0)
 . . S TOTALQI=TOTALQI+TOTALQ,TOTALVI=TOTALVI+TOTALV
"RTN","PRCPRISS",58,0)
 . . S ^TMP($J,"PRCPRISP TOT",DISTRPT)=$G(^TMP($J,"PRCPRISP TOT",DISTRPT))+TOTALV
"RTN","PRCPRISS",59,0)
 . . I 'PRCPSUMM W:$X>20 ! W ?27,"TOTALS BY RECIPIENT: ",$J(TOTALQ,10),$J(TOTALV,22,2)
"RTN","PRCPRISS",60,0)
 . I $G(PRCPFLAG) Q
"RTN","PRCPRISS",61,0)
 . W:'PRCPSUMM !?32,"TOTALS BY ITEM: ",$J(TOTALQI,10),$J(TOTALVI,22,2)
"RTN","PRCPRISS",62,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRISS",63,0)
 I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISS",64,0)
 W !!,"TOTAL SALES TO RECIPIENTS:"
"RTN","PRCPRISS",65,0)
 S TOTALV=0,DISTRPT="" F  S DISTRPT=$O(^TMP($J,"PRCPRISP TOT",DISTRPT)) Q:DISTRPT=""!($G(PRCPFLAG))  S %=$G(^(DISTRPT)) D
"RTN","PRCPRISS",66,0)
 . W !?10,DISTRPT,?40,$J(%,20,2)
"RTN","PRCPRISS",67,0)
 . S TOTALV=TOTALV+%
"RTN","PRCPRISS",68,0)
 . I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRISS",69,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRISS",70,0)
 W !?10,"TOTAL",?40,$J(TOTALV,20,2)
"RTN","PRCPRISS",71,0)
 D END^PRCPUREP
"RTN","PRCPRISS",72,0)
Q D ^%ZISC K ^TMP($J,"PRCPURS3"),^TMP($J,"PRCPRISP"),^TMP($J,"PRCPRISP TOT")
"RTN","PRCPRISS",73,0)
 Q
"RTN","PRCPRISS",74,0)
 ;
"RTN","PRCPRISS",75,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRISS",76,0)
 W $C(13),"INVENTORY SALES FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRISS",77,0)
 W !?5,"INVENTORY SALES DATE RANGE: ",DATESDT,"  TO  ",DATEEDT
"RTN","PRCPRISS",78,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRISS",79,0)
 I PRCPSUMM W !?1,"*** ONLY SUMMARY OF SALES PRINTED ***",!,% Q
"RTN","PRCPRISS",80,0)
 W !,"DESCRIPTION",?37,"DATE ISSUED",$J("QUANTITY",10),$J("SELL COST",10),$J("TOTAL VALUE",12),!,%
"RTN","PRCPRISS",81,0)
 Q
"RTN","PRCPRISS",82,0)
 ;
"RTN","PRCPRISS",83,0)
TOWHOM(INVPT) ; identify a recipient
"RTN","PRCPRISS",84,0)
 ;
"RTN","PRCPRISS",85,0)
 ;
"RTN","PRCPRISS",86,0)
 N DIC,DIR,PRCPA,PRCPB,PRCPC,PRCPD,PRCPI
"RTN","PRCPRISS",87,0)
TOWHOM1 S DIR(0)="FOU^3:50"
"RTN","PRCPRISS",88,0)
 S DIR("A")="RECIPIENT"
"RTN","PRCPRISS",89,0)
 D ^DIR K DIR
"RTN","PRCPRISS",90,0)
 I $G(DUOUT)!$G(DTOUT)!(Y']"") G TOWHOMQ
"RTN","PRCPRISS",91,0)
 S PRCPI=0,PRCPB=X
"RTN","PRCPRISS",92,0)
 I $O(^PRCP(445.2,"D",INVPT,X,"")) S PRCPD(1)=X,PRCPI=1
"RTN","PRCPRISS",93,0)
 S PRCPA=X
"RTN","PRCPRISS",94,0)
 F PRCPC=PRCPI:1 S PRCPA=$O(^PRCP(445.2,"D",INVPT,PRCPA)) Q:$E(PRCPA,1,$L(PRCPB))'=PRCPB!(PRCPA']"")  S PRCPD(PRCPC+1)=PRCPA
"RTN","PRCPRISS",95,0)
 I '$O(PRCPD("")) W !,"THERE ARE NO RECIPIENTS OF THAT NAME IN THIS INVENTORY POINT" G TOWHOM1
"RTN","PRCPRISS",96,0)
 F PRCPI=1:1:PRCPC S DIR("A",PRCPI)=$E("    ",$L(PRCPI+1),4)_PRCPI_"  "_PRCPD(PRCPI)
"RTN","PRCPRISS",97,0)
 S DIR("A")="WHICH RECIPIENT"
"RTN","PRCPRISS",98,0)
 S DIR(0)="L^1:"_PRCPI
"RTN","PRCPRISS",99,0)
 D ^DIR K DIR
"RTN","PRCPRISS",100,0)
TOWHOMQ Q ($S($G(DUOUT):"^",$G(DTOUT):"^",Y<1:0,Y="^":0,1:$G(PRCPD(+Y))))
"RTN","PRCPRSSR")
0^5^B26117439^B24514851
"RTN","PRCPRSSR",1,0)
PRCPRSSR ;WISC/RFJ/dh/DWA-stock status report (option, whse) ;3.13.98
"RTN","PRCPRSSR",2,0)
 ;;5.1;IFCAP;**17,41**;Oct 20, 2000
"RTN","PRCPRSSR",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPRSSR",4,0)
 ;
"RTN","PRCPRSSR",5,0)
 ;*83 Routine PRCPLO2 associated with PRC*5.1*83 is a modified copy of
"RTN","PRCPRSSR",6,0)
 ;this routine and any changes made to this routine should also be
"RTN","PRCPRSSR",7,0)
 ;considered for that routine as well.
"RTN","PRCPRSSR",8,0)
 ;
"RTN","PRCPRSSR",9,0)
 D ^PRCPUSEL Q:'$D(PRCP("I"))
"RTN","PRCPRSSR",10,0)
 N %,%DT,%H,%I,DATEINAC,DATESTRT,TODAY,X,X1,X2,Y
"RTN","PRCPRSSR",11,0)
 K X S X(1)="The Stock Status Report will print a summary of all issues, receipts, and adjustments with the opening and closing balances by account codes."
"RTN","PRCPRSSR",12,0)
 S X(2)="It will calculate the turnover rate, inactive item percent, long supply percent, and non-issuable percent."
"RTN","PRCPRSSR",13,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSSR",14,0)
 K X S X(1)="Enter the date (month-year) for the Stock Status Report." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSSR",15,0)
 D NOW^%DTC S TODAY=X,Y=$E(X,1,5)_"00" S %DT(0)=-Y D DD^%DT S %DT="AEP",%DT("B")=Y,%DT("A")="Print Stock Status for MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPRSSR",16,0)
 S DATESTRT=$E(Y,1,5)_"00"
"RTN","PRCPRSSR",17,0)
 K X S X(1)="The inactive item percent is calculated for items which have not had activity (receipts or issues) after a specified cutoff date." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSSR",18,0)
 K X S X(1)="Enter the Inactivity cutoff date." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSSR",19,0)
 S X1=TODAY,X2=-90 D C^%DTC S Y=$E(X,1,5)_"00" D DD^%DT
"RTN","PRCPRSSR",20,0)
 S %DT(0)=-($E(TODAY,1,5)_"00"),%DT="AEP",%DT("B")=Y,%DT("A")="Enter Inactivity Cutoff MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPRSSR",21,0)
 S DATEINAC=$E(Y,1,5)_"00"
"RTN","PRCPRSSR",22,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRSSR",23,0)
 .   S ZTDESC="Stock Status Report",ZTRTN="DQ^PRCPRSSR"
"RTN","PRCPRSSR",24,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRSSR",25,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSSR",26,0)
DQ ;  queue starts here
"RTN","PRCPRSSR",27,0)
 N ACCT,ADJ,ADJN,AVERAGE,D,DA,DATE,DATELONG,DUEIN,DUEOUT,INACT,INACTN,INVVAL,ISS,ISSN,ITEMDA,LONG,LONGN,NONISS,NONISSN,ONHAND,OPEN,QTY,REC,RECN,TOTAL,TOTDAYS,TRANSNO,TYPE,VALUE
"RTN","PRCPRSSR",28,0)
 K OPEN
"RTN","PRCPRSSR",29,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.1,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S X=$$GETOPEN^PRCPUBAL(PRCP("I"),ITEMDA,$E(DATESTRT,1,5)) I X'="" D
"RTN","PRCPRSSR",30,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSR",31,0)
 .   S $P(OPEN(ACCT),"^")=$P($G(OPEN(ACCT)),"^")+$P(X,"^",2)+$P(X,"^",3)
"RTN","PRCPRSSR",32,0)
 .   S $P(OPEN(ACCT),"^",2)=$P($G(OPEN(ACCT)),"^",2)+$P(X,"^",8)
"RTN","PRCPRSSR",33,0)
 S DATE=DATESTRT F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:$E(DATE,1,5)'=$E(DATESTRT,1,5)  S TYPE="" F  S TYPE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE)) Q:TYPE=""  D
"RTN","PRCPRSSR",34,0)
 .   S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPRSSR",35,0)
 .   .   S D=$G(^PRCP(445.2,DA,0)) I '$P(D,"^",5) Q
"RTN","PRCPRSSR",36,0)
 .   .   ;  non-issuable
"RTN","PRCPRSSR",37,0)
 .   .   Q:$P(D,"^",11)="N"  ;count if not flagged as non-issueable
"RTN","PRCPRSSR",38,0)
 .   .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1($P(D,"^",5)))
"RTN","PRCPRSSR",39,0)
 .   .   S TRANSNO=$P(D,"^",19)
"RTN","PRCPRSSR",40,0)
 .   .   S INVVAL=$P(D,"^",7)*$P(D,"^",8) I $P(D,"^",22)'="" S INVVAL=$P(D,"^",22)
"RTN","PRCPRSSR",41,0)
 .   .   ;  set transno temporary for primary and secondary to
"RTN","PRCPRSSR",42,0)
 .   .   ;  indicate type of transaction
"RTN","PRCPRSSR",43,0)
 .   .   I PRCP("DPTYPE")'="W" D
"RTN","PRCPRSSR",44,0)
 .   .   .   I TYPE="R"!(TYPE="C")!(TYPE="E")!(TYPE="U")!(TYPE="S") S TRANSNO="--1" Q  ;issue
"RTN","PRCPRSSR",45,0)
 .   .   .   I TYPE="RC" S TRANSNO=1 Q  ;receipt
"RTN","PRCPRSSR",46,0)
 .   .   .   S TRANSNO="" ;adjustment
"RTN","PRCPRSSR",47,0)
 .   .   ;  other adjustments
"RTN","PRCPRSSR",48,0)
 .   .   I PRCP("DPTYPE")="W",$P(TRANSNO,"-",2)="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1 Q
"RTN","PRCPRSSR",49,0)
 .   .   I TRANSNO="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1
"RTN","PRCPRSSR",50,0)
 .   .   E  D
"RTN","PRCPRSSR",51,0)
 .   .   .   ;  purchase order
"RTN","PRCPRSSR",52,0)
 .   .   .   I $P(TRANSNO,"-",3)="" S REC(ACCT)=$G(REC(ACCT))+INVVAL,RECN(ACCT)=$G(RECN(ACCT))+1 Q
"RTN","PRCPRSSR",53,0)
 .   .   .   ;  issue
"RTN","PRCPRSSR",54,0)
 .   .   .   S ISS(ACCT)=$G(ISS(ACCT))+INVVAL,ISSN(ACCT)=$G(ISSN(ACCT))+1
"RTN","PRCPRSSR",55,0)
 ;
"RTN","PRCPRSSR",56,0)
 ;  calculate inactive, long supply, set non-issuable
"RTN","PRCPRSSR",57,0)
 S X1=$E(DT,1,5)_"01",X2=-89 D C^%DTC S DATELONG=$E(X,1,5),X1=DT,X2=$E(X,1,5)_"00" D ^%DTC S TOTDAYS=X
"RTN","PRCPRSSR",58,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPRSSR",59,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSR",60,0)
 .   ;  value
"RTN","PRCPRSSR",61,0)
 .   S VALUE(ACCT)=$G(VALUE(ACCT))+$P(D,"^",27)
"RTN","PRCPRSSR",62,0)
 .   S DUEIN(ACCT)=$G(DUEIN(ACCT))+($$GETIN^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSR",63,0)
 .   S DUEOUT(ACCT)=$G(DUEOUT(ACCT))+($$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSR",64,0)
 .   ;  non-issuable
"RTN","PRCPRSSR",65,0)
 .   I $P(D,"^",19) S NONISS(ACCT)=$G(NONISS(ACCT))+($J($P(D,"^",19)*$P(D,"^",22),0,2)),NONISSN(ACCT)=$G(NONISSN(ACCT))+1
"RTN","PRCPRSSR",66,0)
 .   ;  inactive
"RTN","PRCPRSSR",67,0)
 .   ;  if reusable, quit
"RTN","PRCPRSSR",68,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRSSR",69,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPRSSR",70,0)
 .   I QTY,'$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01)),'$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC)) S INACT(ACCT)=$G(INACT(ACCT))+$P(D,"^",27),INACTN(ACCT)=$G(INACTN(ACCT))+1
"RTN","PRCPRSSR",71,0)
 .   ;  long supply
"RTN","PRCPRSSR",72,0)
 .   S DATE=DATELONG-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRSSR",73,0)
 .   S AVERAGE=$J(TOTAL/TOTDAYS,0,2),TOTAL=$S('AVERAGE&(QTY):9999999,'AVERAGE:0,1:QTY/AVERAGE\1)
"RTN","PRCPRSSR",74,0)
 .   I TOTAL>270 S LONG(ACCT)=$G(LONG(ACCT))+$P(D,"^",27),LONGN(ACCT)=$G(LONGN(ACCT))+1
"RTN","PRCPRSSR",75,0)
 D PRINT^PRCPRSS0
"RTN","PRCPRSSR",76,0)
 Q
"VER")
8.0^22.0
"BLD",4283,6)
^82
**END**
**END**
