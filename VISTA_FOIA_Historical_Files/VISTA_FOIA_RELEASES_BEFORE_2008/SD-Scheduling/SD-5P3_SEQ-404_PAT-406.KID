Released SD*5.3*406 SEQ #404
Extracted from mail message
**KIDS**:SD*5.3*406^

**INSTALL NAME**
SD*5.3*406
"BLD",5856,0)
SD*5.3*406^SCHEDULING^0^3061012^y
"BLD",5856,1,0)
^^3^3^3060228^^^
"BLD",5856,1,1,0)
Options 'Future Appointments for Inpatients' [SDWARD] and 'Inpatient
"BLD",5856,1,2,0)
Appointment List' [SDAPP INPT] have been modified to call a Scheduling API
"BLD",5856,1,3,0)
to retrieve appointment data.
"BLD",5856,4,0)
^9.64PA^^
"BLD",5856,"ABPKG")
n
"BLD",5856,"KRN",0)
^9.67PA^8989.52^19
"BLD",5856,"KRN",.4,0)
.4
"BLD",5856,"KRN",.401,0)
.401
"BLD",5856,"KRN",.402,0)
.402
"BLD",5856,"KRN",.403,0)
.403
"BLD",5856,"KRN",.5,0)
.5
"BLD",5856,"KRN",.84,0)
.84
"BLD",5856,"KRN",3.6,0)
3.6
"BLD",5856,"KRN",3.8,0)
3.8
"BLD",5856,"KRN",9.2,0)
9.2
"BLD",5856,"KRN",9.8,0)
9.8
"BLD",5856,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5856,"KRN",9.8,"NM",1,0)
SDWARD^^0^B8729677
"BLD",5856,"KRN",9.8,"NM",2,0)
SDCIAL^^0^B22598364
"BLD",5856,"KRN",9.8,"NM",3,0)
SDAMA203^^0^B33436221
"BLD",5856,"KRN",9.8,"NM",4,0)
SDAMA308^^0^B13159856
"BLD",5856,"KRN",9.8,"NM","B","SDAMA203",3)

"BLD",5856,"KRN",9.8,"NM","B","SDAMA308",4)

"BLD",5856,"KRN",9.8,"NM","B","SDCIAL",2)

"BLD",5856,"KRN",9.8,"NM","B","SDWARD",1)

"BLD",5856,"KRN",19,0)
19
"BLD",5856,"KRN",19.1,0)
19.1
"BLD",5856,"KRN",101,0)
101
"BLD",5856,"KRN",409.61,0)
409.61
"BLD",5856,"KRN",771,0)
771
"BLD",5856,"KRN",870,0)
870
"BLD",5856,"KRN",8989.51,0)
8989.51
"BLD",5856,"KRN",8989.52,0)
8989.52
"BLD",5856,"KRN",8994,0)
8994
"BLD",5856,"KRN","B",.4,.4)

"BLD",5856,"KRN","B",.401,.401)

"BLD",5856,"KRN","B",.402,.402)

"BLD",5856,"KRN","B",.403,.403)

"BLD",5856,"KRN","B",.5,.5)

"BLD",5856,"KRN","B",.84,.84)

"BLD",5856,"KRN","B",3.6,3.6)

"BLD",5856,"KRN","B",3.8,3.8)

"BLD",5856,"KRN","B",9.2,9.2)

"BLD",5856,"KRN","B",9.8,9.8)

"BLD",5856,"KRN","B",19,19)

"BLD",5856,"KRN","B",19.1,19.1)

"BLD",5856,"KRN","B",101,101)

"BLD",5856,"KRN","B",409.61,409.61)

"BLD",5856,"KRN","B",771,771)

"BLD",5856,"KRN","B",870,870)

"BLD",5856,"KRN","B",8989.51,8989.51)

"BLD",5856,"KRN","B",8989.52,8989.52)

"BLD",5856,"KRN","B",8994,8994)

"BLD",5856,"QUES",0)
^9.62^^
"BLD",5856,"REQB",0)
^9.611^4^3
"BLD",5856,"REQB",1,0)
SD*5.3*301^2
"BLD",5856,"REQB",3,0)
SD*5.3*266^2
"BLD",5856,"REQB",4,0)
SD*5.3*285^2
"BLD",5856,"REQB","B","SD*5.3*266",3)

"BLD",5856,"REQB","B","SD*5.3*285",4)

"BLD",5856,"REQB","B","SD*5.3*301",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930925
"PKG",16,22,1,"PAH",1,0)
406^3061012^22948
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3061012
"PKG",16,22,1,"PAH",1,1,1,0)
Options 'Future Appointments for Inpatients' [SDWARD] and 'Inpatient
"PKG",16,22,1,"PAH",1,1,2,0)
Appointment List' [SDAPP INPT] have been modified to call a Scheduling API
"PKG",16,22,1,"PAH",1,1,3,0)
to retrieve appointment data.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDAMA203")
0^3^B33436221^B33220874
"RTN","SDAMA203",1,0)
SDAMA203 ;BPIOFO/ACS-Scheduling API for IMO ;15 April 2003
"RTN","SDAMA203",2,0)
 ;;5.3;Scheduling;**285,406**;13 Aug 1993
"RTN","SDAMA203",3,0)
 ;
"RTN","SDAMA203",4,0)
 ;Scheduling API to return encounter or appointment date/time for
"RTN","SDAMA203",5,0)
 ;a patient that can receive inpatient medication from an
"RTN","SDAMA203",6,0)
 ;authorized clinic
"RTN","SDAMA203",7,0)
 ;
"RTN","SDAMA203",8,0)
 ;**********************************************************************
"RTN","SDAMA203",9,0)
 ;                        CHANGE LOG
"RTN","SDAMA203",10,0)
 ;
"RTN","SDAMA203",11,0)
 ;  DATE      PATCH       DESCRIPTION                 DEVELOPER
"RTN","SDAMA203",12,0)
 ;--------  ----------    ----------------------------------------------
"RTN","SDAMA203",13,0)
 ;04/15/03  SD*5.3*285    ROUTINE WRITTEN             A SAUNDERS
"RTN","SDAMA203",14,0)
 ;10/12/06  SD*5.3*406    FIXED ERROR CODE -3         A SAUNDERS
"RTN","SDAMA203",15,0)
 ;
"RTN","SDAMA203",16,0)
 ;**********************************************************************
"RTN","SDAMA203",17,0)
 ;
"RTN","SDAMA203",18,0)
 ;          **** TO BE CALLED WITH AN EXTRINISIC CALL ****
"RTN","SDAMA203",19,0)
 ;Example:  I $$SDIMO^SDAMA203(CLIEN,DFN) S APPTDT=SDIMO(1) K SDIMO(1)
"RTN","SDAMA203",20,0)
 ;
"RTN","SDAMA203",21,0)
 ;INPUT
"RTN","SDAMA203",22,0)
 ;  SDCLIEN      Clinic IEN (required)
"RTN","SDAMA203",23,0)
 ;  SDPATDFN     Patient DFN (required)
"RTN","SDAMA203",24,0)
 ;  
"RTN","SDAMA203",25,0)
 ;OUTPUT
"RTN","SDAMA203",26,0)
 ;  The extrinsic call will return one of the following values:
"RTN","SDAMA203",27,0)
 ;     1   Patient has at least one scheduled appointment or checked-in
"RTN","SDAMA203",28,0)
 ;         visit in an authorized clinic
"RTN","SDAMA203",29,0)
 ;     0   Patient has no scheduled appointments or checked-in visits
"RTN","SDAMA203",30,0)
 ;         in an authorized clinic
"RTN","SDAMA203",31,0)
 ;    -1   Clinic is not an authorized clinic, clinic is inactive,
"RTN","SDAMA203",32,0)
 ;         or SDCLIEN is null
"RTN","SDAMA203",33,0)
 ;    -2   SDPATDFN is null
"RTN","SDAMA203",34,0)
 ;    -3   Scheduling database is unavailable
"RTN","SDAMA203",35,0)
 ;  
"RTN","SDAMA203",36,0)
 ;  If a 1 is returned, then SDIMO(1) = Encounter or appointment 
"RTN","SDAMA203",37,0)
 ;  date/time in FileMan format
"RTN","SDAMA203",38,0)
 ;   
"RTN","SDAMA203",39,0)
 ;**********************************************************************
"RTN","SDAMA203",40,0)
 ;   Special Logic:
"RTN","SDAMA203",41,0)
 ; - In line tag SDVISIT, the ACRP Toolkit API EXOE^SDOE is called 
"RTN","SDAMA203",42,0)
 ;   multiple times as needed.  This API returns the NEXT encounter, 
"RTN","SDAMA203",43,0)
 ;   given a start and end date/time.  We want to check ALL encounters
"RTN","SDAMA203",44,0)
 ;   for a match on clinic IEN
"RTN","SDAMA203",45,0)
 ; - In line tag SDDATE, if the current time is between midnight and 6am,
"RTN","SDAMA203",46,0)
 ;   the API will start to look for encounters and/or appointments on the 
"RTN","SDAMA203",47,0)
 ;   previous day
"RTN","SDAMA203",48,0)
 ;
"RTN","SDAMA203",49,0)
 ;  Internal variables:
"RTN","SDAMA203",50,0)
 ;  SDBACK   Contains the value to be returned from this call.  See 
"RTN","SDAMA203",51,0)
 ;           above for OUTPUT values and corresponding definitions
"RTN","SDAMA203",52,0)
 ;  SDCONT   Flag to indicate if processing should continue.  If
"RTN","SDAMA203",53,0)
 ;           the patient has an encounter in an authorized clinic
"RTN","SDAMA203",54,0)
 ;           today, then we can skip the last step and not look for
"RTN","SDAMA203",55,0)
 ;           a scheduled appointment
"RTN","SDAMA203",56,0)
 ;  SDFROM   The date to start searching for an encounter or appointment
"RTN","SDAMA203",57,0)
 ;  SDAPPTDT Encounter or appointment date/time returned in SDIMO(1)
"RTN","SDAMA203",58,0)
 ;
"RTN","SDAMA203",59,0)
 ;**********************************************************************
"RTN","SDAMA203",60,0)
SDIMO(SDCLIEN,SDPATDFN) ;
"RTN","SDAMA203",61,0)
 ;
"RTN","SDAMA203",62,0)
 ;--INITIALIZATION--
"RTN","SDAMA203",63,0)
 K SDIMO(1)
"RTN","SDAMA203",64,0)
 N SDBACK,SDCONT,SDFROM,SDAPPTDT
"RTN","SDAMA203",65,0)
 S SDBACK=1,SDCONT=1,SDAPPTDT=0,SDFROM=0
"RTN","SDAMA203",66,0)
 ;
"RTN","SDAMA203",67,0)
 ;--MAIN--
"RTN","SDAMA203",68,0)
 ; Valid variables passed in?
"RTN","SDAMA203",69,0)
 D SDVALVAR($G(SDPATDFN),$G(SDCLIEN),.SDBACK)
"RTN","SDAMA203",70,0)
 ; If no error, is clinic active and authorized?
"RTN","SDAMA203",71,0)
 I SDBACK=1 D SDAUTHCL(SDCLIEN,.SDBACK)
"RTN","SDAMA203",72,0)
 ; If no error, set up search "start" date
"RTN","SDAMA203",73,0)
 I SDBACK=1 D SDDATE(.SDFROM)
"RTN","SDAMA203",74,0)
 ; If no error, does patient have an encounter in that clinic?
"RTN","SDAMA203",75,0)
 I SDBACK=1 D SDVISIT(SDPATDFN,SDCLIEN,.SDAPPTDT,.SDCONT,.SDBACK,SDFROM)
"RTN","SDAMA203",76,0)
 ; If no error and no encounter, does patient have an appointment in that
"RTN","SDAMA203",77,0)
 ; clinic?
"RTN","SDAMA203",78,0)
 I SDBACK=1,SDCONT=1 D SDAPPT(SDPATDFN,SDCLIEN,.SDAPPTDT,.SDBACK,SDFROM)
"RTN","SDAMA203",79,0)
 ;
"RTN","SDAMA203",80,0)
 ;--FINALIZATION--
"RTN","SDAMA203",81,0)
 ; If no error
"RTN","SDAMA203",82,0)
 I SDBACK=1 D
"RTN","SDAMA203",83,0)
 . ; Set up output array with the encounter or appointment date/time
"RTN","SDAMA203",84,0)
 . ; Make sure the appointment date/time exists in SDAPPTDT
"RTN","SDAMA203",85,0)
 . I $G(SDAPPTDT)]"" D
"RTN","SDAMA203",86,0)
 .. S SDIMO(1)=SDAPPTDT
"RTN","SDAMA203",87,0)
 . I $G(SDAPPTDT)']"" D
"RTN","SDAMA203",88,0)
 .. S SDBACK=0
"RTN","SDAMA203",89,0)
 ; Return value
"RTN","SDAMA203",90,0)
 Q SDBACK
"RTN","SDAMA203",91,0)
 ;
"RTN","SDAMA203",92,0)
 ;----------------------------------------------------------------------
"RTN","SDAMA203",93,0)
 ;-Validate input variables
"RTN","SDAMA203",94,0)
SDVALVAR(SDPATDFN,SDCLIEN,SDBACK) ;
"RTN","SDAMA203",95,0)
 ; Clinic IEN and patient DFN cannot be null
"RTN","SDAMA203",96,0)
 I $G(SDCLIEN)="" S SDBACK=-1 Q
"RTN","SDAMA203",97,0)
 I $G(SDPATDFN)="" S SDBACK=-2 Q
"RTN","SDAMA203",98,0)
 Q
"RTN","SDAMA203",99,0)
 ;
"RTN","SDAMA203",100,0)
 ;-Clinic must be type "C", authorized to administer inpatient meds,
"RTN","SDAMA203",101,0)
 ;-and active
"RTN","SDAMA203",102,0)
SDAUTHCL(SDCLIEN,SDBACK) ;
"RTN","SDAMA203",103,0)
 N SDAUTH,SDTYPE
"RTN","SDAMA203",104,0)
 S SDAUTH=0,SDTYPE=0
"RTN","SDAMA203",105,0)
 ; clinic must be type "C"
"RTN","SDAMA203",106,0)
 S SDTYPE=$P($G(^SC(SDCLIEN,0)),"^",3)
"RTN","SDAMA203",107,0)
 I $G(SDTYPE)="C" D
"RTN","SDAMA203",108,0)
 . ; clinic must be authorized to administer inpatient meds
"RTN","SDAMA203",109,0)
 . I $D(^SC("AE",1,SDCLIEN)) S SDAUTH=1
"RTN","SDAMA203",110,0)
 I SDAUTH'=1 S SDBACK=-1 Q
"RTN","SDAMA203",111,0)
 ; clinic must be active
"RTN","SDAMA203",112,0)
 ; if clinic inactivate date exists, check further
"RTN","SDAMA203",113,0)
 N SDINACT,SDREACT
"RTN","SDAMA203",114,0)
 S SDINACT=$P($G(^SC(SDCLIEN,"I")),"^",1)
"RTN","SDAMA203",115,0)
 I $G(SDINACT)]"" D
"RTN","SDAMA203",116,0)
 . ; if inactivate date is today or earlier, get reactivate date
"RTN","SDAMA203",117,0)
 . I SDINACT'>DT D
"RTN","SDAMA203",118,0)
 .. S SDREACT=$P($G(^SC(SDCLIEN,"I")),"^",2)
"RTN","SDAMA203",119,0)
 .. ; reactivate date can't be null
"RTN","SDAMA203",120,0)
 .. I $G(SDREACT)="" S SDBACK=-1
"RTN","SDAMA203",121,0)
 .. ; if reactivate date exists
"RTN","SDAMA203",122,0)
 .. E  D
"RTN","SDAMA203",123,0)
 ... ; reactivate date must be less than or equal to today
"RTN","SDAMA203",124,0)
 ... ; but greater than or equal to inactivate date
"RTN","SDAMA203",125,0)
 ... I (SDREACT>DT!(SDREACT<SDINACT)) S SDBACK=-1
"RTN","SDAMA203",126,0)
 Q
"RTN","SDAMA203",127,0)
 ;-Set up start date for encounters and appointments
"RTN","SDAMA203",128,0)
SDDATE(SDFROM) ;
"RTN","SDAMA203",129,0)
 N %,X
"RTN","SDAMA203",130,0)
 D NOW^%DTC
"RTN","SDAMA203",131,0)
 ;if the current time is before 6am, set 'start' date to yesterday
"RTN","SDAMA203",132,0)
 I ("."_$P(%,".",2))<.060000 S SDFROM=(X-1)
"RTN","SDAMA203",133,0)
 E  S SDFROM=X
"RTN","SDAMA203",134,0)
 Q
"RTN","SDAMA203",135,0)
 ;-Look for encounter that occurred in the authorized clinic
"RTN","SDAMA203",136,0)
SDVISIT(SDPATDFN,SDCLIEN,SDAPPTDT,SDCONT,SDBACK,SDFROM) ;
"RTN","SDAMA203",137,0)
 N SDSTART,SDEND,SDENCNUM,SDENCDT,SDENCCL
"RTN","SDAMA203",138,0)
 ; set up start and end date/time
"RTN","SDAMA203",139,0)
 S SDSTART=SDFROM_".0000"
"RTN","SDAMA203",140,0)
 S SDEND=DT_".2359"
"RTN","SDAMA203",141,0)
 ; get encounters
"RTN","SDAMA203",142,0)
 F  D  Q:+SDENCNUM=0
"RTN","SDAMA203",143,0)
 . ; call API to get next encounter
"RTN","SDAMA203",144,0)
 . S SDENCNUM=+$$EXOE^SDOE(SDPATDFN,SDSTART,SDEND)
"RTN","SDAMA203",145,0)
 . I $G(SDENCNUM) D
"RTN","SDAMA203",146,0)
 .. ; encounter found.  call API to get more encounter data
"RTN","SDAMA203",147,0)
 .. D GETGEN^SDOE(SDENCNUM,"SDDATA")
"RTN","SDAMA203",148,0)
 .. I $G(SDDATA(0)) D
"RTN","SDAMA203",149,0)
 ... ; get encounter date/time and clinic IEN
"RTN","SDAMA203",150,0)
 ... S SDENCDT=$P($G(SDDATA(0)),"^",1),SDENCCL=$P($G(SDDATA(0)),"^",4)
"RTN","SDAMA203",151,0)
 ... ; if encounter clinic matches authorized clinic, set flags
"RTN","SDAMA203",152,0)
 ... I $G(SDENCCL)=SDCLIEN S SDENCNUM=0,SDCONT=0,SDAPPTDT=$G(SDENCDT)
"RTN","SDAMA203",153,0)
 ... ; if no match on clinic, reset start date for next encounter
"RTN","SDAMA203",154,0)
 ... I $G(SDENCCL)'=SDCLIEN S SDSTART=(SDENCDT+.000001)
"RTN","SDAMA203",155,0)
 ... K SDDATA
"RTN","SDAMA203",156,0)
 Q
"RTN","SDAMA203",157,0)
 ;-Look for scheduled appointment in the authorized clinic
"RTN","SDAMA203",158,0)
SDAPPT(SDPATDFN,SDCLIEN,SDAPPTDT,SDBACK,SDFROM) ;
"RTN","SDAMA203",159,0)
 N SDRESULT,SDAPPTCL,SDMATCH
"RTN","SDAMA203",160,0)
 S SDMATCH=0
"RTN","SDAMA203",161,0)
 ; call API to get appointments for this patient
"RTN","SDAMA203",162,0)
 D GETAPPT^SDAMA201(SDPATDFN,"1;2","R;NT",SDFROM,,.SDRESULT)
"RTN","SDAMA203",163,0)
 ; SDRESULT contains a count of the returned appointments
"RTN","SDAMA203",164,0)
 I SDRESULT>0 D
"RTN","SDAMA203",165,0)
 . N SDI
"RTN","SDAMA203",166,0)
 . ; spin through returned appointments and look for match on clinic IEN
"RTN","SDAMA203",167,0)
 . F SDI=1:1:SDRESULT D  Q:SDMATCH=1
"RTN","SDAMA203",168,0)
 .. S SDAPPTCL=$G(^TMP($J,"SDAMA201","GETAPPT",SDI,2))
"RTN","SDAMA203",169,0)
 .. I +$G(SDAPPTCL)=SDCLIEN D
"RTN","SDAMA203",170,0)
 ... S SDAPPTDT=$G(^TMP($J,"SDAMA201","GETAPPT",SDI,1))
"RTN","SDAMA203",171,0)
 ... S SDMATCH=1
"RTN","SDAMA203",172,0)
 . ; delete appointment array returned from Scheduling API
"RTN","SDAMA203",173,0)
 . K ^TMP($J,"SDAMA201","GETAPPT")
"RTN","SDAMA203",174,0)
 I ((SDRESULT=0)!(SDMATCH=0)) S SDBACK=0
"RTN","SDAMA203",175,0)
 I SDRESULT=-1 D
"RTN","SDAMA203",176,0)
 . S SDBACK=0
"RTN","SDAMA203",177,0)
 . ; if database unavailable, set database-specific flag
"RTN","SDAMA203",178,0)
 . I $D(^TMP($J,"SDAMA201","GETAPPT","ERROR",101)) S SDBACK=-3
"RTN","SDAMA203",179,0)
 . ; delete error array returned from Scheduling API
"RTN","SDAMA203",180,0)
 . K ^TMP($J,"SDAMA201","GETAPPT")
"RTN","SDAMA203",181,0)
 Q
"RTN","SDAMA308")
0^4^B13159856^B11354365
"RTN","SDAMA308",1,0)
SDAMA308 ;BPOIFO/JFW-Filter API Appointment Statuses; 5/10/04 8:13am [5/17/04 10:14am]
"RTN","SDAMA308",2,0)
 ;;5.3;Scheduling;**301,406**;13 Aug 1993
"RTN","SDAMA308",3,0)
 ;
"RTN","SDAMA308",4,0)
 ;**              GET APPOINTMENT STATUS                         **
"RTN","SDAMA308",5,0)
 ;              - Replaces $$STATUS^SDAM1 -
"RTN","SDAMA308",6,0)
 ;*****************************************************************
"RTN","SDAMA308",7,0)
 ;              CHANGE LOG
"RTN","SDAMA308",8,0)
 ;
"RTN","SDAMA308",9,0)
 ;  DATE      PATCH       DESCRIPTION
"RTN","SDAMA308",10,0)
 ;--------  ----------    -----------------------------------------
"RTN","SDAMA308",11,0)
 ;12/04/03  SD*5.3*301    ROUTINE COMPLETED
"RTN","SDAMA308",12,0)
 ;10/11/06  SD*5.3*406    PRINT STATUS TEXT UPDATED
"RTN","SDAMA308",13,0)
 ;
"RTN","SDAMA308",14,0)
 ;*****************************************************************
"RTN","SDAMA308",15,0)
 ;
"RTN","SDAMA308",16,0)
STATUS(DFN,SDT,SDCL,SDSTS,SDCHKIN,SDCHKOUT,SDEIFN) ;Retrieve Appointment Status
"RTN","SDAMA308",17,0)
 ;
"RTN","SDAMA308",18,0)
 ;  Input:   DFN      := IFN of Patient
"RTN","SDAMA308",19,0)
 ;           SDT      := Appointment Date/Time   (FM Format)
"RTN","SDAMA308",20,0)
 ;           SDCL     := IFN of Clinic
"RTN","SDAMA308",21,0)
 ;           SDSTS    := Current VistA Appointment Status  (Optional)
"RTN","SDAMA308",22,0)
 ;           SDCHKIN  := Appointment Check-In Date/Time    (Optional)
"RTN","SDAMA308",23,0)
 ;           SDCHKOUT := Appointment Check-Out Date/Time   (Optional)
"RTN","SDAMA308",24,0)
 ;           SDEIFN   := Outpatient Encounter IFN for Appointment (Optional)
"RTN","SDAMA308",25,0)
 ;  Output:  Appoinment Status IFN ; Status Name ; Print Status ;
"RTN","SDAMA308",26,0)
 ;             Check In Date/Time ; Check Out Date/Time ;
"RTN","SDAMA308",27,0)
 ;                Admission Movement IFN
"RTN","SDAMA308",28,0)
 ;           -1 if errors with DFN,SDT or SDCL
"RTN","SDAMA308",29,0)
 ;  
"RTN","SDAMA308",30,0)
 ; Initialize Global Variables
"RTN","SDAMA308",31,0)
 N SDI,SDQUIT,SDCODE,SDSTSD,SDPSTS,SDINDCTR,SDAMVT,VADMVT,VAINDT
"RTN","SDAMA308",32,0)
 S SDQUIT=0
"RTN","SDAMA308",33,0)
 ;Validate parameters
"RTN","SDAMA308",34,0)
 F SDI="VDFN","FMDATE","VCLIN" Q:SDQUIT  D @SDI
"RTN","SDAMA308",35,0)
 Q:SDQUIT -1
"RTN","SDAMA308",36,0)
 ; Set initial Status value, if no value set to NULL
"RTN","SDAMA308",37,0)
 S SDSTSD=$S($G(SDSTS)]"":$P($T(@SDSTS),";;",3),1:"")
"RTN","SDAMA308",38,0)
 ; No R appt status in original VistA code
"RTN","SDAMA308",39,0)
 S:$G(SDSTS)="R" SDSTSD=""
"RTN","SDAMA308",40,0)
 ; If Status is null check for non-count clinic
"RTN","SDAMA308",41,0)
 I $G(SDSTSD)="" S SDCODE=$$GETSTOP^SDAMA305($G(SDCL)) S:$P($G(SDCODE),"^",3)="Y" SDSTSD="NON-COUNT"
"RTN","SDAMA308",42,0)
 ;Get admission movement ifn
"RTN","SDAMA308",43,0)
 S VAINDT=$G(SDT) D ADM^VADPT2
"RTN","SDAMA308",44,0)
 ;Inpatient? (Check Status, Admission IFN?, Domicillary Ward?, Ward Location = "D"?)
"RTN","SDAMA308",45,0)
 I SDSTSD["INPATIENT",$S('+VADMVT:1,'$P(^DG(43,1,0),"^",21):0,1:$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),"^",6),0)),"^",3)="D") S SDSTSD=""
"RTN","SDAMA308",46,0)
 ; Determine Checked In/Out Indicator
"RTN","SDAMA308",47,0)
 S SDINDCTR=$S(+$G(SDCHKOUT):"CHECKED OUT",+$G(SDCHKIN):"CHECKED IN",SDSTSD]"":"",$G(SDT)>(DT+.2359):"FUTURE",1:"NO ACTION TAKEN") S:SDSTSD="" SDSTSD=SDINDCTR
"RTN","SDAMA308",48,0)
 I SDSTSD="NO ACTION TAKEN",$P($G(SDT),".")=DT,SDINDCTR'["CHECKED" S SDINDCTR="TODAY"
"RTN","SDAMA308",49,0)
 I SDSTSD="CHECKED OUT"!(SDSTSD="CHECKED IN"),SDT'<$$REQDT^SDM1A,'$P($G(^SCE(+$G(SDEIFN),0)),"^",7) S SDSTSD="NO ACTION TAKEN"
"RTN","SDAMA308",50,0)
 ; Determine PRINT STATUS
"RTN","SDAMA308",51,0)
 S SDPSTS=$S(SDSTSD=SDINDCTR!(SDINDCTR=""):SDSTSD,1:"")
"RTN","SDAMA308",52,0)
 I SDPSTS="" D
"RTN","SDAMA308",53,0)
 .I SDSTSD["INPATIENT",$P($G(^SC(SDCL,0)),U,17)'="Y",$P($G(^SCE(+$G(SDEIFN),0)),U,7)="" S SDPSTS=$P(SDSTSD," ")_"/ACT REQ" Q
"RTN","SDAMA308",54,0)
 .I SDSTSD="NO ACTION TAKEN",SDINDCTR="CHECKED OUT"!(SDINDCTR="CHECKED IN") S SDPSTS="ACT REQ/"_SDINDCTR Q
"RTN","SDAMA308",55,0)
 .S SDPSTS=$S(SDSTSD="NO ACTION TAKEN":SDSTSD,1:$P(SDSTSD," "))_"/"_SDINDCTR
"RTN","SDAMA308",56,0)
 I SDSTSD["INPATIENT",SDINDCTR="" D
"RTN","SDAMA308",57,0)
 .I SDT>(DT+.2359) S SDPSTS=$P(SDSTSD," ")_"/FUTURE" Q
"RTN","SDAMA308",58,0)
 .S SDPSTS=$P(SDSTSD," ")_"/NO ACT TAKN"
"RTN","SDAMA308",59,0)
 ;Get Appointment Status IFN
"RTN","SDAMA308",60,0)
 S SDAMVT=+$O(^SD(409.63,"AC",SDSTSD,0))
"RTN","SDAMA308",61,0)
 Q SDAMVT_";"_SDSTSD_";"_SDPSTS_";"_$G(SDCHKIN)_";"_$G(SDCHKOUT)_";"_+VADMVT
"RTN","SDAMA308",62,0)
VDFN ; Verify for valid patient dfn
"RTN","SDAMA308",63,0)
 I $G(DFN)="" S SDQUIT=1
"RTN","SDAMA308",64,0)
 E  I '$D(^DPT(DFN)) S SDQUIT=1
"RTN","SDAMA308",65,0)
 Q
"RTN","SDAMA308",66,0)
VCLIN ; Verify for valid clinic dfn
"RTN","SDAMA308",67,0)
 I $G(SDCL)="" S SDQUIT=1
"RTN","SDAMA308",68,0)
 E  I '$D(^SC(SDCL,0)) S SDQUIT=1
"RTN","SDAMA308",69,0)
 Q
"RTN","SDAMA308",70,0)
FMDATE ;
"RTN","SDAMA308",71,0)
 ; Appointment Date must be a valid internal FileMan Format
"RTN","SDAMA308",72,0)
 N X,Y,%H,%T,%Y
"RTN","SDAMA308",73,0)
 S Y=$G(SDT) D DD^%DT I Y=-1 S SDQUIT=1
"RTN","SDAMA308",74,0)
 ; Appointment Date cannot be imprecise
"RTN","SDAMA308",75,0)
 I 'SDQUIT S X=$G(SDT) D H^%DTC I %H=0 S SDQUIT=1
"RTN","SDAMA308",76,0)
 Q
"RTN","SDAMA308",77,0)
 ;
"RTN","SDAMA308",78,0)
 ;LIST OF VISTA STATUS CODES /NEW DESCRIPTIONS /OLD DESCRIPTIONS
"RTN","SDAMA308",79,0)
CC ;;CANCELLED BY CLINIC;;CANCELLED BY CLINIC
"RTN","SDAMA308",80,0)
CCR ;;CANCELLED BY CLINIC & RESCHEDULED;;CANCELLED BY CLINIC & AUTO RE-BOOK
"RTN","SDAMA308",81,0)
CP ;;CANCELLED BY PATIENT;;CANCELLED BY PATIENT
"RTN","SDAMA308",82,0)
CPR ;;CANCELLED BY PATIENT & RESCHEDULED;;CANCELLED BY PATIENT & AUTO-REBOOK
"RTN","SDAMA308",83,0)
R ;;SCHEDULED/KEPT;;
"RTN","SDAMA308",84,0)
I ;;INPATIENT;;INPATIENT APPOINTMENT
"RTN","SDAMA308",85,0)
NS ;;NO-SHOW;;NO-SHOW
"RTN","SDAMA308",86,0)
NSR ;;NO-SHOW & RESCHEDULED;;NO-SHOW & AUTO RE-BOOK
"RTN","SDAMA308",87,0)
NT ;;NO ACTION TAKEN;;NO ACTION TAKEN
"RTN","SDCIAL")
0^2^B22598364^B14925939
"RTN","SDCIAL",1,0)
SDCIAL ;ALB/TMP - INPATIENT APPOINTMENT LIST ; 16 JAN 86
"RTN","SDCIAL",2,0)
 ;;5.3;Scheduling;**32,406**;Aug 13, 1993
"RTN","SDCIAL",3,0)
 S DIV="",SDTT=0 D DIV^SDUTL I $T S DIC("A")="INPATIENT APPOINTMENT LIST FOR WHICH DIVISION:" D ASK^SDDIV Q:Y<0
"RTN","SDCIAL",4,0)
RD R !,"FOR WARD (TYPE 'ALL' FOR ALL WARDS): ",X:DTIME Q:"^"[X  I X?.E1"?" W !,"ENTER A WARD NAME OR ALL FOR ALL WARDS"
"RTN","SDCIAL",5,0)
 S X=$$UP^XLFSTR(X)
"RTN","SDCIAL",6,0)
 I X="ALL" S SDW=X G RD1
"RTN","SDCIAL",7,0)
 S DIC="^DIC(42,",DIC(0)="EQ"
"RTN","SDCIAL",8,0)
 D ^DIC Q:X=""!(X["^")  G:Y<0 RD S SDW=+Y
"RTN","SDCIAL",9,0)
RD1 D DATE^SDUTL G:POP END I BEGDATE<DT W *7,!,"Start date must be in the future" G RD1
"RTN","SDCIAL",10,0)
 S VAR="DIV^SDW^BEGDATE^ENDDATE",VAL=DIV_"^"_SDW_"^"_BEGDATE_"^"_ENDDATE,PGM="START^SDCIAL"
"RTN","SDCIAL",11,0)
 D ZIS^DGUTQ G:POP END
"RTN","SDCIAL",12,0)
START K ^UTILITY($J),^TMP($J,"SDAMA301"),^TMP($J,"SDAMA301C") U IO I '$D(DT) D DT^SDUTL
"RTN","SDCIAL",13,0)
 N SDLIST,SDCOUNT S SDCOUNT=0
"RTN","SDCIAL",14,0)
 S (SDEND,SD1)=0,SDTT=$S($E(IOST,1,2)="C-"&(IOSL<66):1,1:0)
"RTN","SDCIAL",15,0)
 I SDW'="ALL" S I=$P(^DIC(42,SDW,0),"^",1) D PT D DFN D WRT Q
"RTN","SDCIAL",16,0)
 S I=0 F  S I=$O(^DPT("ACN",I)) Q:I=""  D PT
"RTN","SDCIAL",17,0)
 D DFN,WRT
"RTN","SDCIAL",18,0)
 Q
"RTN","SDCIAL",19,0)
PT ;build patient list
"RTN","SDCIAL",20,0)
 S I2="" F  S I2=$O(^DPT("ACN",I,I2)) Q:I2'>0  I $D(^DPT(I2,0)) S SDLIST(I2)=""
"RTN","SDCIAL",21,0)
 Q
"RTN","SDCIAL",22,0)
DFN ;retrieve appt data for list of patients
"RTN","SDCIAL",23,0)
 I $D(SDLIST)'>1 Q
"RTN","SDCIAL",24,0)
 N SDARRAY,SDDFN,SDWARD,SDAPPT,SDCL,SDLAB,SDXRAY,SDEKG,SDOTHER
"RTN","SDCIAL",25,0)
 S SDARRAY(1)=BEGDATE_";"_ENDDATE,SDARRAY(3)="I;R",SDARRAY("FLDS")="1;2;6;19;20;21",SDARRAY(4)="SDLIST("
"RTN","SDCIAL",26,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) I SDCOUNT<1 Q
"RTN","SDCIAL",27,0)
 ;re-sort output by clinic, then patient
"RTN","SDCIAL",28,0)
 S SDDFN=0 F  S SDDFN=$O(^TMP($J,"SDAMA301",SDDFN)) Q:SDDFN=""  D
"RTN","SDCIAL",29,0)
 . S SDCL=0 F  S SDCL=$O(^TMP($J,"SDAMA301",SDDFN,SDCL)) Q:SDCL=""  D
"RTN","SDCIAL",30,0)
 .. M ^TMP($J,"SDAMA301C",SDCL,SDDFN)=^TMP($J,"SDAMA301",SDDFN,SDCL)
"RTN","SDCIAL",31,0)
 I DIV'="" D
"RTN","SDCIAL",32,0)
 . ;remove appts if clinic is not in selected division
"RTN","SDCIAL",33,0)
 . S SDCL=0 F  S SDCL=$O(^TMP($J,"SDAMA301C",SDCL)) Q:SDCL=""  I $P(^SC(SDCL,0),"^",15)'=DIV K ^TMP($J,"SDAMA301C",SDCL)
"RTN","SDCIAL",34,0)
 ;get appt data and add to ^UTILITY
"RTN","SDCIAL",35,0)
 S SDCL=0 F  S SDCL=$O(^TMP($J,"SDAMA301C",SDCL)) Q:SDCL=""  D
"RTN","SDCIAL",36,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"SDAMA301C",SDCL,SDDFN)) Q:SDDFN=""  D
"RTN","SDCIAL",37,0)
 .. S SDAPPT=0 F  S SDAPPT=$O(^TMP($J,"SDAMA301C",SDCL,SDDFN,SDAPPT)) Q:SDAPPT=""  D
"RTN","SDCIAL",38,0)
 ... S SDWARD=$P($G(^DPT(SDDFN,.1)),"^",1)
"RTN","SDCIAL",39,0)
 ... S SDLAB=$P(^TMP($J,"SDAMA301C",SDCL,SDDFN,SDAPPT),"^",21)
"RTN","SDCIAL",40,0)
 ... S SDXRAY=$P(^TMP($J,"SDAMA301C",SDCL,SDDFN,SDAPPT),"^",20)
"RTN","SDCIAL",41,0)
 ... S SDEKG=$P(^TMP($J,"SDAMA301C",SDCL,SDDFN,SDAPPT),"^",19)
"RTN","SDCIAL",42,0)
 ... S SDOTHER=$P($G(^TMP($J,"SDAMA301C",SDCL,SDDFN,SDAPPT,"C")),"^",1)
"RTN","SDCIAL",43,0)
 ... ;mimic DPT "S" node, but also add 'other' to end (6th piece) for future use:
"RTN","SDCIAL",44,0)
 ... I $G(SDWARD)]"" S ^UTILITY($J,SDWARD,SDAPPT\1,SDDFN,"."_$P(SDAPPT,".",2))=SDCL_"^^"_$G(SDLAB)_"^"_$G(SDXRAY)_"^"_$G(SDEKG)_"^"_$G(SDOTHER)
"RTN","SDCIAL",45,0)
 Q
"RTN","SDCIAL",46,0)
WRT I SDCOUNT<0 W @IOF,?29,"INPATIENT APPOINTMENT LIST",! X "F A=1:1:IOM W ""-""" W !!,$$SDAPIERR^SDAMUTDT() D END Q
"RTN","SDCIAL",47,0)
 S I="" I $O(^UTILITY($J,I))']"" W @IOF,?29,"INPATIENT APPOINTMENT LIST",! X "F A=1:1:IOM W ""-""" W !!,"NO MATCHES FOUND!" G END
"RTN","SDCIAL",48,0)
 S (SDPG,I)=0 F  S I=$O(^UTILITY($J,I)) Q:I=""!(SDEND)  D HD Q:SDEND  S I2=0 F  S I2=$O(^UTILITY($J,I,I2)) Q:I2=""  D:($Y+4)>IOSL HD Q:SDEND  D APPT Q:SDEND
"RTN","SDCIAL",49,0)
 G END
"RTN","SDCIAL",50,0)
APPT W:SD2 !! D:($Y+6)>IOSL HD Q:SDEND  S Y=I2 D DTS^SDUTL W !,Y S SD2=1
"RTN","SDCIAL",51,0)
 S I3=0 F  S I3=$O(^UTILITY($J,I,I2,I3)) Q:I3=""!(SDEND)  D:($Y+5)>IOSL HD Q:SDEND  W !,?2,$P(^DPT(I3,0),"^",1),?34,$P(^(0),"^",9) S I4=0 F  S I4=$O(^UTILITY($J,I,I2,I3,I4)) Q:I4=""  D WRTC Q:SDEND
"RTN","SDCIAL",52,0)
 Q
"RTN","SDCIAL",53,0)
WRTC S SDY=$G(^UTILITY($J,I,I2,I3,I4)) I ($Y+4)>IOSL D HD Q:SDEND  W !,?2,$P(^DPT(I3,0),"^",1),?34,$P(^(0),"^",9)," (CONTINUED)"
"RTN","SDCIAL",54,0)
 W !,?5,$P(^SC(+SDY,0),"^",1) S Y=I4,SD2=1 D AT^SDUTL W ?37,$J(Y,8) S SDB=50 F A=3:1:5 S Y="."_$P($P(SDY,"^",A),".",2) D AT^SDUTL W ?SDB,$J(Y,8) S SDB=SDB+10
"RTN","SDCIAL",55,0)
 ;comments/other
"RTN","SDCIAL",56,0)
 I $P($G(^UTILITY($J,I,I2,I3,I4)),"^",6)]"" W !,?15,$P(^(I4),"^",6) Q
"RTN","SDCIAL",57,0)
 Q
"RTN","SDCIAL",58,0)
HD I SD1,SDTT D OUT^SDUTL Q:SDEND
"RTN","SDCIAL",59,0)
 S SDPG=SDPG+1,SD1=1 W !,@IOF,!,?29,"INPATIENT APPOINTMENT LIST",?69,"PAGE: ",SDPG,! S SDOS=(77-$L(I))\2 W ?SDOS,"WARD: ",I S Y=DT D DTS^SDUTL W !,?31,"DATE PRINTED: ",Y,!!
"RTN","SDCIAL",60,0)
 W !!,"APPOINTMENT DATE",!,?2,"PATIENT NAME",?34,"SSN",!,?38,"APPOINT",?52,"LAB",?62,"XRAY",?72,"EKG",!,?5,"CLINIC",?38,"TIME" F A=52:10:72 W ?A,"TIME"
"RTN","SDCIAL",61,0)
 W !,?15,"OTHER INFORMATION",! F A=1:1:80 W "-"
"RTN","SDCIAL",62,0)
 S SD2=0 Q
"RTN","SDCIAL",63,0)
END S:'$D(IOF) IOF="#" W ! W:'SDTT @IOF K ^TMP($J,"SDAMA301"),^TMP($J,"SDAMA301C"),ALL,DIV,POP,SDT1,%DT,A,BEGDATE,DFN,DIC,DIV,ENDDATE,I,I1,I2,I3,I4,II,SD1,SDB,SDEND,SDOS,SDPG,SDSC,SDTT,SDW,SDXX,SDY,X,Y D CLOSE^DGUTQ,SDIAL^SDKILL Q
"RTN","SDWARD")
0^1^B8729677^B6364653
"RTN","SDWARD",1,0)
SDWARD ;ALB/GRR - LIST INPATIENTS WITH PENDING APPTS ; 14 NOV 84
"RTN","SDWARD",2,0)
 ;;5.3;Scheduling;**406**;Aug 13, 1993
"RTN","SDWARD",3,0)
 S %DT(0)=-DT,%DT="AXE",%DT("A")="LIST PATIENTS WITH PENDING APPOINTMENTS ADMITTED ON DATE: " D ^%DT K %DT Q:Y<0  S SDY=Y D:'$D(DT) DT^SDUTL
"RTN","SDWARD",4,0)
 S VAR="SDY",VAL=SDY,PGM="START^SDWARD" D ZIS^DGUTQ G:POP END
"RTN","SDWARD",5,0)
 ;
"RTN","SDWARD",6,0)
START K ^UTILITY("SD",$J),^TMP($J,"SDAMA301") U IO S Y=SDY D D^DIQ S SDPY=Y,Y=DT D D^DIQ S HY=Y
"RTN","SDWARD",7,0)
 N SDLIST,SDCOUNT S SDCOUNT=0
"RTN","SDWARD",8,0)
 F SDJ=SDY-.0001:0 S SDJ=$O(^DGPM("AMV1",SDJ)) Q:SDJ=""!(SDJ\1>SDY)!$D(SDERR)  F DFN=0:0 S DFN=$O(^DGPM("AMV1",SDJ,DFN)) Q:DFN=""  S SDLIST(DFN)=""
"RTN","SDWARD",9,0)
 I $D(SDLIST)>1 D CHECK
"RTN","SDWARD",10,0)
 I SDCOUNT<0 W !,$$SDAPIERR^SDAMUTDT D END Q  ; SDAPI Returned an Error.
"RTN","SDWARD",11,0)
 I '$D(^UTILITY("SD",$J)) W !,"NO PATIENTS FOUND" G END
"RTN","SDWARD",12,0)
 D HED
"RTN","SDWARD",13,0)
 S SDD=0 F SD=0:0 S SDD=$O(^UTILITY("SD",$J,SDD)) Q:SDD=""  S DFN=$O(^UTILITY("SD",$J,SDD,0)) D PN F SDI=0:0 S SDI=$O(^UTILITY("SD",$J,SDD,DFN,SDI)) Q:SDI=""  F SC=0:0 S SC=$O(^UTILITY("SD",$J,SDD,DFN,SDI,SC)) Q:SC=""  D PRT
"RTN","SDWARD",14,0)
 G END
"RTN","SDWARD",15,0)
 ;
"RTN","SDWARD",16,0)
CHECK N SDARRAY,SDDATE,SDDATA,SDNAME,SDCLIN,SDDFN
"RTN","SDWARD",17,0)
 S SDARRAY(1)=DT,SDARRAY(3)="R;I",SDARRAY(4)="SDLIST(",SDARRAY("FLDS")="2;4",SDARRAY("SORT")="P"
"RTN","SDWARD",18,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) Q:SDCOUNT'>0
"RTN","SDWARD",19,0)
 S SDDFN="" F  S SDDFN=$O(^TMP($J,"SDAMA301",SDDFN)) Q:SDDFN=""  D
"RTN","SDWARD",20,0)
 . S SDDATE="" F  S SDDATE=$O(^TMP($J,"SDAMA301",SDDFN,SDDATE)) Q:SDDATE=""  S SDDATA=$G(^(SDDATE)) D
"RTN","SDWARD",21,0)
 ..S SDNAME=$P($P(SDDATA,U,4),";",2),SDCLIN=$P($P(SDDATA,U,2),";",1)
"RTN","SDWARD",22,0)
 ..I $G(SDNAME)]"",$G(SDCLIN)]"" S ^UTILITY("SD",$J,SDNAME,SDDFN,SDDATE,SDCLIN)=""
"RTN","SDWARD",23,0)
 Q
"RTN","SDWARD",24,0)
 ;
"RTN","SDWARD",25,0)
PRT D:$Y+2>IOSL HED
"RTN","SDWARD",26,0)
 W !,?3,$S($D(^SC(SC,0)):$P(^(0),"^",1),1:"DELETED CLINIC")
"RTN","SDWARD",27,0)
 S Y=SDI\1 D D^DIQ W ?50,Y," " S X=SDI D TM^SDROUT0 W ?61,$J(X,8)
"RTN","SDWARD",28,0)
 Q
"RTN","SDWARD",29,0)
 ;
"RTN","SDWARD",30,0)
PN D:$Y+2>IOSL HED
"RTN","SDWARD",31,0)
 D PID^VADPT6 W !,$E($P(^DPT(DFN,0),"^",1),1,25),?29,VA("PID") K VA("BID"),VA("PID") I $D(^DPT(DFN,.1)) W ?43,$P(^(.1),"^",1)
"RTN","SDWARD",32,0)
 Q
"RTN","SDWARD",33,0)
 ;
"RTN","SDWARD",34,0)
HED W @IOF,!,"PATIENTS ADMITTED ",SDPY," WHO HAVE PENDING APPOINTMENTS",?66,HY,!,"PATIENT NAME",?32,"PT ID",?43,"WARD"
"RTN","SDWARD",35,0)
 W !,?3,"CLINIC",?50,"APPNT DATE",?64,"TIME",! F I=1:1:79 W "-"
"RTN","SDWARD",36,0)
 Q
"RTN","SDWARD",37,0)
 ;
"RTN","SDWARD",38,0)
END W !,@IOF K %DT,DFN,I,HY,SC,SD,SDD,SDI,SDJ,SDPY,SDY,X,Y,SDERR,PGM,POP,VA,VAL,VAR,^UTILITY("SD")
"RTN","SDWARD",39,0)
 K ^TMP($J,"SDAMA301")
"RTN","SDWARD",40,0)
 D CLOSE^DGUTQ,SDWARD^SDKILL
"RTN","SDWARD",41,0)
 Q
"VER")
8.0^22.0
"BLD",5856,6)
^404
**END**
**END**
