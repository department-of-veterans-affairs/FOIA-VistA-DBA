Released LR*5.2*349 SEQ #267
Extracted from mail message
**KIDS**:LR*5.2*349^

**INSTALL NAME**
LR*5.2*349
"BLD",6517,0)
LR*5.2*349^LAB SERVICE^0^3060327^y
"BLD",6517,1,0)
^^1^1^3060327^
"BLD",6517,1,1,0)
INCORRECT OOS (OCCASION OF SERVICE) LOCATION GOING TO PCE
"BLD",6517,4,0)
^9.64PA^^
"BLD",6517,6)
2^
"BLD",6517,"ABPKG")
n
"BLD",6517,"KRN",0)
^9.67PA^8989.52^19
"BLD",6517,"KRN",.4,0)
.4
"BLD",6517,"KRN",.401,0)
.401
"BLD",6517,"KRN",.402,0)
.402
"BLD",6517,"KRN",.403,0)
.403
"BLD",6517,"KRN",.5,0)
.5
"BLD",6517,"KRN",.84,0)
.84
"BLD",6517,"KRN",3.6,0)
3.6
"BLD",6517,"KRN",3.8,0)
3.8
"BLD",6517,"KRN",9.2,0)
9.2
"BLD",6517,"KRN",9.8,0)
9.8
"BLD",6517,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6517,"KRN",9.8,"NM",1,0)
LRCAPES^^0^75227462
"BLD",6517,"KRN",9.8,"NM","B","LRCAPES",1)

"BLD",6517,"KRN",19,0)
19
"BLD",6517,"KRN",19.1,0)
19.1
"BLD",6517,"KRN",101,0)
101
"BLD",6517,"KRN",409.61,0)
409.61
"BLD",6517,"KRN",771,0)
771
"BLD",6517,"KRN",870,0)
870
"BLD",6517,"KRN",8989.51,0)
8989.51
"BLD",6517,"KRN",8989.52,0)
8989.52
"BLD",6517,"KRN",8994,0)
8994
"BLD",6517,"KRN","B",.4,.4)

"BLD",6517,"KRN","B",.401,.401)

"BLD",6517,"KRN","B",.402,.402)

"BLD",6517,"KRN","B",.403,.403)

"BLD",6517,"KRN","B",.5,.5)

"BLD",6517,"KRN","B",.84,.84)

"BLD",6517,"KRN","B",3.6,3.6)

"BLD",6517,"KRN","B",3.8,3.8)

"BLD",6517,"KRN","B",9.2,9.2)

"BLD",6517,"KRN","B",9.8,9.8)

"BLD",6517,"KRN","B",19,19)

"BLD",6517,"KRN","B",19.1,19.1)

"BLD",6517,"KRN","B",101,101)

"BLD",6517,"KRN","B",409.61,409.61)

"BLD",6517,"KRN","B",771,771)

"BLD",6517,"KRN","B",870,870)

"BLD",6517,"KRN","B",8989.51,8989.51)

"BLD",6517,"KRN","B",8989.52,8989.52)

"BLD",6517,"KRN","B",8994,8994)

"BLD",6517,"QUES",0)
^9.62^^
"BLD",6517,"REQB",0)
^9.611^1^1
"BLD",6517,"REQB",1,0)
LR*5.2*259^2
"BLD",6517,"REQB","B","LR*5.2*259",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
349^3060327^33274
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3060327
"PKG",26,22,1,"PAH",1,1,1,0)
INCORRECT OOS (OCCASION OF SERVICE) LOCATION GOING TO PCE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRCAPES")
0^1^B75227462^B74040726
"RTN","LRCAPES",1,0)
LRCAPES ;DALOI/FHS/KLL -MANUAL PCE CPT WORKLOAD CAPTURE ;5/1/99
"RTN","LRCAPES",2,0)
 ;;5.2;LAB SERVICE;**274,259,349**;Sep 27, 1994
"RTN","LRCAPES",3,0)
EN ;
"RTN","LRCAPES",4,0)
 D EN^LRCAPES1
"RTN","LRCAPES",5,0)
 Q
"RTN","LRCAPES",6,0)
PG ;Page break
"RTN","LRCAPES",7,0)
 N DIR,DIRUT,DUOUT,DTOUT
"RTN","LRCAPES",8,0)
 S DIR(0)="E" D ^DIR
"RTN","LRCAPES",9,0)
 I $G(DIRUT) S LREND=1 Q
"RTN","LRCAPES",10,0)
 W @IOF
"RTN","LRCAPES",11,0)
 Q
"RTN","LRCAPES",12,0)
EX1 ;Parse the read entry
"RTN","LRCAPES",13,0)
 N LRXY
"RTN","LRCAPES",14,0)
 Q:'$L($G(LRX))  D
"RTN","LRCAPES",15,0)
 . I LRX?5N,'$D(^TMP("LR",$J,"AK",LRX))#2 D  Q
"RTN","LRCAPES",16,0)
 . . S LRXY=$$CPT^ICPTCOD(LRX,DT) Q:'$P(LRXY,U,7)
"RTN","LRCAPES",17,0)
 . . S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",18,0)
 . . S ^TMP("LR",$J,"LRLST",LRCNT)=$P(LRXY,U)_"^^"_$P(LRXY,U,3)_U
"RTN","LRCAPES",19,0)
 . S LRQ="^TMP(""LR"","_$J_",""AK"","_LRX_")"
"RTN","LRCAPES",20,0)
 . F  S LRQ=$Q(@LRQ) Q:$QS(LRQ,4)'=LRX  D
"RTN","LRCAPES",21,0)
 . . S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",22,0)
 . . S ^TMP("LR",$J,"LRLST",LRCNT)=$QS(LRQ,6)_U_@LRQ
"RTN","LRCAPES",23,0)
 Q
"RTN","LRCAPES",24,0)
END1 ;
"RTN","LRCAPES",25,0)
 D END S LREND=1
"RTN","LRCAPES",26,0)
 Q
"RTN","LRCAPES",27,0)
END ;
"RTN","LRCAPES",28,0)
 I $G(LRAA),$G(LRAD),$G(LRAN) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRCAPES",29,0)
 K:'$G(LRESCPT) ^TMP("LR",$J,"AK")
"RTN","LRCAPES",30,0)
 I $G(LRDEBUG) W !,"END ",! Q
"RTN","LRCAPES",31,0)
 Q
"RTN","LRCAPES",32,0)
HLP ;Help display for CPT selection
"RTN","LRCAPES",33,0)
 N DIR,DIRUT,DUOUT,DTOUT,LREND,LRX,LRY
"RTN","LRCAPES",34,0)
 W @IOF
"RTN","LRCAPES",35,0)
 S LRX="^TMP(""LR"","_$J_",""AK"",0,1)"
"RTN","LRCAPES",36,0)
 W $$CJ^XLFSTR("List or range e.g, 1,3,5-7,88300.",IOM)
"RTN","LRCAPES",37,0)
 W $$CJ^XLFSTR("Select from the following or enter CPT separated by a comma",IOM),!
"RTN","LRCAPES",38,0)
 F  S LRX=$Q(@LRX) Q:$QS(LRX,2)'=$J!($G(LREND))!($QS(LRX,1)'="LR")  D
"RTN","LRCAPES",39,0)
 . S LRY=@LRX
"RTN","LRCAPES",40,0)
 . W !?3,$QS(LRX,4),?6," = "_$QS(LRX,6)_"  "_$E($P(LRY,U,2),1,60),!
"RTN","LRCAPES",41,0)
 . W:$P(LRY,U,4) ?8,$P(LRY,U,3)_" { NLT = "_$P(LRY,U,4)_" }",!
"RTN","LRCAPES",42,0)
 . I $Y>(IOSL-6) S DIR(0)="E" D RD^LRCAPES1 I '$G(LREND)  W @IOF
"RTN","LRCAPES",43,0)
 D LSTCPT($G(LRAA),$G(LRAD),$G(LRAN)) Q
"RTN","LRCAPES",44,0)
 ;
"RTN","LRCAPES",45,0)
LSTCPT(LRAA,LRAD,LRAN) ; Show loaded CPT codes if any
"RTN","LRCAPES",46,0)
 Q:$S('$G(LRAA):1,'$G(LRAD):1,'$G(LRAN):1,1:0)
"RTN","LRCAPES",47,0)
 N LRSTR
"RTN","LRCAPES",48,0)
 S LRSTR=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")) Q:'LRSTR
"RTN","LRCAPES",49,0)
 N DA,DIC,DIR,DIRUT,DIR,DR,ERR,DUOUT,IEN,LRDA,LRENC,LREND,LRP,S,X,Y
"RTN","LRCAPES",50,0)
 S DIR(0)="Y",DIR("A")=" Would you like to see PCE CPT Information"
"RTN","LRCAPES",51,0)
 S DIR("B")="No" D ^DIR Q:$G(DIRUT)!($G(Y)'=1)
"RTN","LRCAPES",52,0)
 ;List filed CPT CODES
"RTN","LRCAPES",53,0)
 W @IOF
"RTN","LRCAPES",54,0)
 F LRP=1:1 S IEN=$P(LRSTR,";",LRP) Q:IEN=""  D
"RTN","LRCAPES",55,0)
 . D GETCPT^PXAPIOE(IEN,"LRENC","ERR")
"RTN","LRCAPES",56,0)
 S (LRDA,LREND)=0 F  S LRDA=$O(LRENC(LRDA)) Q:'LRDA!($G(LREND))  D
"RTN","LRCAPES",57,0)
 . I $Y>(IOSL-6) D PG W @IOF Q:$G(LREND)
"RTN","LRCAPES",58,0)
 . S S=0,DA=LRDA,DR="0:99",DIC="^AUPNVCPT(" D EN^DIQ
"RTN","LRCAPES",59,0)
 Q
"RTN","LRCAPES",60,0)
WLN ;Interactive entry point
"RTN","LRCAPES",61,0)
 D KVA^VADPT
"RTN","LRCAPES",62,0)
 K DIC,DIR
"RTN","LRCAPES",63,0)
 K LREND,LRUID,DIC,DIR,LRVBY
"RTN","LRCAPES",64,0)
 K ^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",65,0)
 K LRAA,LRACC,LRAD,LRAN,LRDFN,LRDPF,LRIDT
"RTN","LRCAPES",66,0)
 K LRRB,LRSS,LRTIME,LRTREA,LRUID,LRWRD,PNM,SEX,SSN,AGE
"RTN","LRCAPES",67,0)
 S (LRAA,LRACC,LRAD,LRNOP,LRAN,LREND)=0,LRVBY=1,LRUID=""
"RTN","LRCAPES",68,0)
 S:'$G(LRPRO) LRPRO=DUZ
"RTN","LRCAPES",69,0)
 I '$G(LRESCPT) S LRVBY=$$SELBY^LRWU4("Select Accession By")
"RTN","LRCAPES",70,0)
 D:LRVBY=1 ^LRVERA D:LRVBY=2 UID^LRVERA
"RTN","LRCAPES",71,0)
 I 'LRVBY!(LRAA<1) D END S LREND=1 Q
"RTN","LRCAPES",72,0)
 S LRDFN=+$$GET1^DIQ(68.02,+$G(LRAN)_","_+$G(LRAD)_","_+$G(LRAA)_",",.01)
"RTN","LRCAPES",73,0)
 I 'LRDFN D END S LRNOP=1 D  Q
"RTN","LRCAPES",74,0)
 . W !?5,"This accession is corrupt",!
"RTN","LRCAPES",75,0)
LCK ;
"RTN","LRCAPES",76,0)
 L +^LRO(68,LRAA,1,LRAD,1,LRAN):10 I '$T D  Q
"RTN","LRCAPES",77,0)
 . W !?5,"Someone else is editing this accession",!
"RTN","LRCAPES",78,0)
 . S LRNOP=1
"RTN","LRCAPES",79,0)
 D PT^LRX
"RTN","LRCAPES",80,0)
 S LRUID=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",16)
"RTN","LRCAPES",81,0)
 S LRLLOCX=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",82,0)
 S LRSPECID="Acc #: "_$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",15,"E")
"RTN","LRCAPES",83,0)
 S:$L($G(LRUID)) LRSPECID=LRSPECID_"  UID: "_LRUID
"RTN","LRCAPES",84,0)
 S LREDT=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",9,"I")
"RTN","LRCAPES",85,0)
 I LREDT'?7N.E D  Q
"RTN","LRCAPES",86,0)
 . W !?5,"This accession does not have a Collection Date/Time",!
"RTN","LRCAPES",87,0)
 . W !?10,"CAN NOT PROCEED",!
"RTN","LRCAPES",88,0)
 . S LRNOP="6^Not Accessioned"
"RTN","LRCAPES",89,0)
 I '$G(LRIDT) S LRIDT=+$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",13.5,"I")
"RTN","LRCAPES",90,0)
 S LRCDT="Collection Date: "_$$FMTE^XLFDT(LREDT,1)
"RTN","LRCAPES",91,0)
 I '$L($G(LRSS)) S LRSS=$$GET1^DIQ(68,LRAA_",",.02,"I")
"RTN","LRCAPES",92,0)
 S LRDSSLOC=+$$GET1^DIQ(68,LRAA_",",.8,"I")
"RTN","LRCAPES",93,0)
 S LRDSSLOC=$S($G(LRDSSLOC):LRDSSLOC,1:LRDLOC)
"RTN","LRCAPES",94,0)
 D DEM^LRCAPES1
"RTN","LRCAPES",95,0)
PRO ;Get provider,patient/location information
"RTN","LRCAPES",96,0)
 S LREND=0
"RTN","LRCAPES",97,0)
 D
"RTN","LRCAPES",98,0)
 . N LRPRONM,DIR,DIRUT,DUOUT,X,Y
"RTN","LRCAPES",99,0)
 . S LRPRONM=$$GET1^DIQ(200,+$G(LRPRO),.01,"I")
"RTN","LRCAPES",100,0)
 . I $L(LRPRONM),$D(^VA(200,"AK.PROVIDER",LRPRONM,+$G(LRPRO)))#2,$$GET^XUA4A72(+$G(LRPRO),DT)>0 S DIR("B")=LRPRONM
"RTN","LRCAPES",101,0)
 . S DIR("A")="Releasing Pathologist"
"RTN","LRCAPES",102,0)
 . S LRPRO=0,DIR(0)="PO^200:ENMZ"
"RTN","LRCAPES",103,0)
 . S DIR("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U),+Y)),$$GET^XUA4A72(+Y,DT)>0"
"RTN","LRCAPES",104,0)
 . D ^DIR
"RTN","LRCAPES",105,0)
 . I Y>1 S LRPRO=+Y
"RTN","LRCAPES",106,0)
 I '$G(LRPRO) D  D END1 Q
"RTN","LRCAPES",107,0)
 . W !?5,"No Active Provider Selected",!
"RTN","LRCAPES",108,0)
 . S LRNOP=1
"RTN","LRCAPES",109,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2 D  D END1 G WLN
"RTN","LRCAPES",110,0)
 . W !?5,"The accession is corrupt - missing zero node",!
"RTN","LRCAPES",111,0)
 . S LRNOP="7^Corrupt Accession"
"RTN","LRCAPES",112,0)
LOC ;Reporting Location
"RTN","LRCAPES",113,0)
 S LRNODE0=^LRO(68,LRAA,1,LRAD,1,LRAN,0)
"RTN","LRCAPES",114,0)
 S LRNOP=0
"RTN","LRCAPES",115,0)
 S (LRLLOCX,LRLLOC)=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",116,0)
 I $L(LRLLOC) S LRLLOC=+$$FIND1^DIC(44,"","OM",LRLLOC)
"RTN","LRCAPES",117,0)
ASKLOC ;Check to see of outpatient location
"RTN","LRCAPES",118,0)
 I '$D(^SC(+$G(LRLLOC),0))#2 D
"RTN","LRCAPES",119,0)
 . N DIR,X,Y
"RTN","LRCAPES",120,0)
 . S LRLLOC=""
"RTN","LRCAPES",121,0)
 . S DIR(0)="PO^44:AEZNMO",DIR("A")=" Ordering Location "
"RTN","LRCAPES",122,0)
 . D ^DIR
"RTN","LRCAPES",123,0)
 . I +Y<1 Q
"RTN","LRCAPES",124,0)
 . S LRLLOC=+Y
"RTN","LRCAPES",125,0)
 I '$G(LRLLOC) D END1 Q
"RTN","LRCAPES",126,0)
 S LRDSSID=+$$GET1^DIQ(44,+LRLLOC,8,"I") ;I 'LRDSSID S LRNOP="2^No Stop Code Number" Q
"RTN","LRCAPES",127,0)
 S LRNINS=$$GET1^DIQ(44,+LRLLOC,3,"I")
"RTN","LRCAPES",128,0)
 S LRNINS=$S(LRNINS:LRNINS,1:DUZ(2))
"RTN","LRCAPES",129,0)
 Q
"RTN","LRCAPES",130,0)
ES() ;Entry point for front end application.
"RTN","LRCAPES",131,0)
 N DFN,LRESCPT,LRDFN,LRLLOC,LRLLOCX,LRNINS,LRTST,LRENCDT,LRDUZ
"RTN","LRCAPES",132,0)
 K LRES,LRESCPT
"RTN","LRCAPES",133,0)
 S LRES=1
"RTN","LRCAPES",134,0)
ASK ; Option entry point - Check and setup PCE reporting variables
"RTN","LRCAPES",135,0)
 D EN^LRCAPES1
"RTN","LRCAPES",136,0)
 N X,Y,T1
"RTN","LRCAPES",137,0)
 S LREND=0
"RTN","LRCAPES",138,0)
 D ^LRPARAM Q:$G(LREND)
"RTN","LRCAPES",139,0)
 K ^TMP("LRPXAPI",$J),^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",140,0)
 S ^TMP("LR",$J,"LRLST")=$$FMADD^XLFDT(DT,2)_U_DT_U_"LAB ES CPT"
"RTN","LRCAPES",141,0)
 S:'$G(LRPKG) LRPKG=$O(^DIC(9.4,"B","LR",0))
"RTN","LRCAPES",142,0)
 S:'$G(LRPKG) LRPKG=$O(^DIC(9.4,"B","LAB SERVICE",0))
"RTN","LRCAPES",143,0)
PKG ;Check to see if Lab Package is installed
"RTN","LRCAPES",144,0)
 I '$G(LRPKG) D  D WKL Q
"RTN","LRCAPES",145,0)
 . W !?5,"LAB SERVICE PACKAGE is not loaded",!
"RTN","LRCAPES",146,0)
PCE ;Check to see if PCE is turned on
"RTN","LRCAPES",147,0)
 S X="PXAI" X ^%ZOSF("TEST") I '$T D:'$G(LRES)  D WKL Q
"RTN","LRCAPES",148,0)
 . W !?5,"PCE Is not installed",!
"RTN","LRCAPES",149,0)
 S LRPCEON=$$PKGON^VSIT("PX")
"RTN","LRCAPES",150,0)
 I '$G(LRES),'LRPCEON D  D WKL Q
"RTN","LRCAPES",151,0)
 . W !?5,"PCE is not turned on",!
"RTN","LRCAPES",152,0)
 S LRDLOC=+$$GET1^DIQ(69.9,"1,",.8,"I")
"RTN","LRCAPES",153,0)
OOS ;Check to see if the LRDLOC is an OOS location
"RTN","LRCAPES",154,0)
 I $G(LRES),$P($G(^SC(LRDLOC,0)),U)'["LAB DIV " D  D WKL Q
"RTN","LRCAPES",155,0)
 . W !?5,"DEFAULT LAB OOS LOCATION is not defined correctly",!
"RTN","LRCAPES",156,0)
 S LRESCPT=1
"RTN","LRCAPES",157,0)
 D:'$G(^TMP("LR",$J,"AK",0,1))'=DUZ_U_DT EN
"RTN","LRCAPES",158,0)
 I $G(LRES) Q $G(LRESCPT)
"RTN","LRCAPES",159,0)
LOOP ;
"RTN","LRCAPES",160,0)
 Q:$G(LREND)
"RTN","LRCAPES",161,0)
 F  D WLN Q:$G(LREND)  I '$G(LRNOP) D CPTEN Q:$G(LREND)
"RTN","LRCAPES",162,0)
 D CLEAN Q
"RTN","LRCAPES",163,0)
CPTEN ;Entry point from CPT API call
"RTN","LRCAPES",164,0)
WKL S (LRNOP,LREND)=0 D READ^LRCAPES1
"RTN","LRCAPES",165,0)
 D DIS^LRCAPES1
"RTN","LRCAPES",166,0)
 I '$O(^TMP("LR",$J,"LRLST",0)) D END Q
"RTN","LRCAPES",167,0)
LOAD ;Setup ^TMP("LRPXAPI" to load CPT workload
"RTN","LRCAPES",168,0)
 K LRXCPT,LRXTST,^TMP("LRPXAPI",$J)
"RTN","LRCAPES",169,0)
 S LRDUZ=LRPRO
"RTN","LRCAPES",170,0)
 I '$G(LRESCPT) S LRNOP="3^PCE Workload Capture Not Setup"
"RTN","LRCAPES",171,0)
 I $G(LRNOP) D  D SENDWKL Q
"RTN","LRCAPES",172,0)
 . I '$D(LRQUIET) W !,$$CJ^XLFSTR("PCE Wkld Abort "_$P(LRNOP,U,2),IOM)
"RTN","LRCAPES",173,0)
 I $G(LRESCPT),'$G(LRNOP) D
"RTN","LRCAPES",174,0)
 . N AFTER812,D,D0,DDER,DI,DIC,DIG,DIH,DISL,DIV
"RTN","LRCAPES",175,0)
 . N I,LRACC,LRCNT,LRI,LRPCEN,PXALOOK,PXASUB,PXJ,PXJJ
"RTN","LRCAPES",176,0)
 . N SDT1,SPEL,SUBL,TYPEI,X,XPARSYS
"RTN","LRCAPES",177,0)
 . S LRTST=0
"RTN","LRCAPES",178,0)
 . F  S LRTST=$O(^TMP("LR",$J,"LRLST",LRTST)) Q:LRTST<1  D
"RTN","LRCAPES",179,0)
 . . S (LRNLTN,CPT)=+$G(^TMP("LR",$J,"LRLST",LRTST)),LRTSTP=$P(^(LRTST),U,2,99)
"RTN","LRCAPES",180,0)
 . . D SET^LRCAPPH1
"RTN","LRCAPES",181,0)
SENDWKL ; Store LMIP workload
"RTN","LRCAPES",182,0)
 D SEND^LRCAPES1
"RTN","LRCAPES",183,0)
 L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRCAPES",184,0)
 S LRNOP=0
"RTN","LRCAPES",185,0)
 Q
"RTN","LRCAPES",186,0)
CLEAN ;Final Cleanup
"RTN","LRCAPES",187,0)
 K AFTER812,AGE,CPT,D,D0,DOB,DDER,DFN,DI,DIC,DIG,DIH,DIR,DIRUT
"RTN","LRCAPES",188,0)
 K DISL,DIRUT,DIU,DUOUT,DIV,DQ
"RTN","LRCAPES",189,0)
 K I,J,LRACC,LRCNT,LRI,POP,PXALOOK,PXASUB,PXJ,PXJJ
"RTN","LRCAPES",190,0)
 K SDT1,SPEL,SUBL,T1,TYPEI,X,XPARSYS
"RTN","LRCAPES",191,0)
 K ANS,CLN,CNT,FPRI,LRAA,LRAD,LRAN,LRANSX,LRANSY,LRCDT,LRCNT
"RTN","LRCAPES",192,0)
 K LRDFN,LRDPF,LRDLOC,LRDSSID,LRDSSLOC,LRDUZ,LREDT,LREND,LRES,LRESCPT
"RTN","LRCAPES",193,0)
 K LRIDT,LRIDIV,LRLLOC,LRLLOCX,LRLST,LRNINS,LRNLT,LRNLTN,LRNODE0,LRNOP,LROK
"RTN","LRCAPES",194,0)
 K LRPCEN,LRPCENON,LRPCEVSO,LRPKG,LRPRAC,LRPRO,LRRB,LRQ,LRSS,LRTREA,LRTST,LRURG
"RTN","LRCAPES",195,0)
 K LRSPECID,LRTSTP,LRUID,LRVBY
"RTN","LRCAPES",196,0)
 K LRVSITN,LRWRD,LRX,LRXCPT,LRXTST
"RTN","LRCAPES",197,0)
 K NODE,NODE0,PNM,SEX,SDFLAG,SSN,VA,X1,X2,X3
"RTN","LRCAPES",198,0)
 K ^TMP("LRMOD",$J)
"RTN","LRCAPES",199,0)
 K ^TMP("LR",$J,"AK"),^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",200,0)
 K ^TMP("LRPXAPI",$J)
"RTN","LRCAPES",201,0)
 D KVAR^VADPT
"RTN","LRCAPES",202,0)
 Q
"RTN","LRCAPES",203,0)
CPT(LRAA,LRAD,LRAN,LRPRO) ;AP Release entry point
"RTN","LRCAPES",204,0)
 ;LRAA=accession area, LRAD=accession date, LRAN=accession number
"RTN","LRCAPES",205,0)
 ;LRPRO=provider
"RTN","LRCAPES",206,0)
 N X,Y,I,LRI,LREDT,LRCDT,LRIDT,LRLLOCX,LRSPECID,DIC,LRNOP,LREND
"RTN","LRCAPES",207,0)
 S (LRLLOCX,LRLLOC)=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",208,0)
 S DIC=44,DIC(0)="ONM",X=LRLLOC D ^DIC
"RTN","LRCAPES",209,0)
 I Y>1 S LRLLOC=+Y
"RTN","LRCAPES",210,0)
 I Y<1 D  Q:$G(LREND)
"RTN","LRCAPES",211,0)
 . S DIC(0)="AEZNM" D ^DIC
"RTN","LRCAPES",212,0)
 . I Y<1 S LRNOP="4^Not an outpatient location",LREND=1 Q
"RTN","LRCAPES",213,0)
 . S LRLLOC=+Y
"RTN","LRCAPES",214,0)
 ;KLL - set LRDSSLOC to LRDLOC, instead of LRLLOC to resolve location
"RTN","LRCAPES",215,0)
 ;      problem occurring in PCE
"RTN","LRCAPES",216,0)
 ;TAC - use accession area OOS location if one exists
"RTN","LRCAPES",217,0)
 S LRDSSLOC=+$$GET1^DIQ(68,LRAA_",",.8,"I")
"RTN","LRCAPES",218,0)
 S LRDSSLOC=$S($G(LRDSSLOC):LRDSSLOC,1:+$G(LRDLOC))
"RTN","LRCAPES",219,0)
 ;I "CMZ"'[$$GET1^DIQ(44,+LRLLOC,2,"I") S LRNOP="4^Not an outpatient location"
"RTN","LRCAPES",220,0)
 S LRDSSID=+$$GET1^DIQ(44,+LRLLOC,8,"I") ;I 'LRDSSID,'$G(LRNOP) S LRNOP="5^No Stop Code Number"
"RTN","LRCAPES",221,0)
 S LRNINS=$$GET1^DIQ(44,+LRLLOC,3,"I")
"RTN","LRCAPES",222,0)
 S LRNINS=$S(LRNINS:LRNINS,1:DUZ(2))
"RTN","LRCAPES",223,0)
 I '$G(LRIDT) S LRIDT=+$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",13.5,"I")
"RTN","LRCAPES",224,0)
 S LRUID=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",16)
"RTN","LRCAPES",225,0)
 S LRLLOCX=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",226,0)
 S LRSPECID="Acc #: "_$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",15,"E")
"RTN","LRCAPES",227,0)
 S:$L($G(LRUID)) LRSPECID=LRSPECID_"  UID: "_LRUID
"RTN","LRCAPES",228,0)
 S LREDT=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",9,"I")
"RTN","LRCAPES",229,0)
 I 'LREDT S LREDT=$$NOW^XLFDT
"RTN","LRCAPES",230,0)
 S LRCDT="Collection Date: "_$$FMTE^XLFDT(LREDT,1)
"RTN","LRCAPES",231,0)
 I '$G(LRESCPT) D  Q
"RTN","LRCAPES",232,0)
 . D EN^DDIOL("CPT workload is not activated","","!?20")
"RTN","LRCAPES",233,0)
 I $S('$G(LRAA):1,'$G(LRAD):1,'$G(LRAN):1,'$G(LRPRO):1,1:0) Q
"RTN","LRCAPES",234,0)
 I +$G(^LRO(68,LRAA,1,LRAD,1,LRAN,0))'=LRDFN Q
"RTN","LRCAPES",235,0)
 D CPTEN
"RTN","LRCAPES",236,0)
 Q
"VER")
8.0^22.0
"BLD",6517,6)
^267
**END**
**END**
