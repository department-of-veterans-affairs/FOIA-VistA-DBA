Released WV*1*4 SEQ #4
Extracted from mail message
**KIDS**:WV*1.0*4^

**INSTALL NAME**
WV*1.0*4
"BLD",1488,0)
WV*1.0*4^WOMEN'S HEALTH^0^2990105^y
"BLD",1488,1,0)
^^2^2^2990105^^
"BLD",1488,1,1,0)
Please read the WV*1*4 patch description on FORUM for an explanation of
"BLD",1488,1,2,0)
what this patch does.
"BLD",1488,4,0)
^9.64PA^^
"BLD",1488,"ABPKG")
n
"BLD",1488,"INI")

"BLD",1488,"INIT")
WV4PST
"BLD",1488,"KRN",0)
^9.67PA^19^18
"BLD",1488,"KRN",.4,0)
.4
"BLD",1488,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",1488,"KRN",.4,"NM",1,0)
WV PRINT NOTIF PURPOSE&LETTER    FILE #790.404^790.404^0
"BLD",1488,"KRN",.4,"NM","B","WV PRINT NOTIF PURPOSE&LETTER    FILE #790.404",1)

"BLD",1488,"KRN",.401,0)
.401
"BLD",1488,"KRN",.402,0)
.402
"BLD",1488,"KRN",.403,0)
.403
"BLD",1488,"KRN",.5,0)
.5
"BLD",1488,"KRN",.84,0)
.84
"BLD",1488,"KRN",3.6,0)
3.6
"BLD",1488,"KRN",3.8,0)
3.8
"BLD",1488,"KRN",9.2,0)
9.2
"BLD",1488,"KRN",9.8,0)
9.8
"BLD",1488,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",1488,"KRN",9.8,"NM",1,0)
WVRADWP^^0^B23541889
"BLD",1488,"KRN",9.8,"NM",2,0)
WVUTL1A^^0^B31155454
"BLD",1488,"KRN",9.8,"NM",3,0)
WVRPPCD1^^0^B29658112
"BLD",1488,"KRN",9.8,"NM",4,0)
WVPURP^^0^B14913145
"BLD",1488,"KRN",9.8,"NM",6,0)
WV4PST^^0^B20326937
"BLD",1488,"KRN",9.8,"NM","B","WV4PST",6)

"BLD",1488,"KRN",9.8,"NM","B","WVPURP",4)

"BLD",1488,"KRN",9.8,"NM","B","WVRADWP",1)

"BLD",1488,"KRN",9.8,"NM","B","WVRPPCD1",3)

"BLD",1488,"KRN",9.8,"NM","B","WVUTL1A",2)

"BLD",1488,"KRN",19,0)
19
"BLD",1488,"KRN",19.1,0)
19.1
"BLD",1488,"KRN",101,0)
101
"BLD",1488,"KRN",409.61,0)
409.61
"BLD",1488,"KRN",771,0)
771
"BLD",1488,"KRN",869.2,0)
869.2
"BLD",1488,"KRN",870,0)
870
"BLD",1488,"KRN",8994,0)
8994
"BLD",1488,"KRN","B",.4,.4)

"BLD",1488,"KRN","B",.401,.401)

"BLD",1488,"KRN","B",.402,.402)

"BLD",1488,"KRN","B",.403,.403)

"BLD",1488,"KRN","B",.5,.5)

"BLD",1488,"KRN","B",.84,.84)

"BLD",1488,"KRN","B",3.6,3.6)

"BLD",1488,"KRN","B",3.8,3.8)

"BLD",1488,"KRN","B",9.2,9.2)

"BLD",1488,"KRN","B",9.8,9.8)

"BLD",1488,"KRN","B",19,19)

"BLD",1488,"KRN","B",19.1,19.1)

"BLD",1488,"KRN","B",101,101)

"BLD",1488,"KRN","B",409.61,409.61)

"BLD",1488,"KRN","B",771,771)

"BLD",1488,"KRN","B",869.2,869.2)

"BLD",1488,"KRN","B",870,870)

"BLD",1488,"KRN","B",8994,8994)

"BLD",1488,"QUES",0)
^9.62^^
"BLD",1488,"REQB",0)
^9.611^^
"INIT")
WV4PST
"KRN",.4,1712,-1)
0^1
"KRN",.4,1712,0)
WV PRINT NOTIF PURPOSE&LETTER^2981230.1349^^790.404^^^2990105
"KRN",.4,1712,"F",1)
S:$D(WVPAGE) WVPAGE=WVPAGE+1;Z;"S:$D(WVPAGE) WVPAGE=WVPAGE+1"~"NOTIFICATION PURPOSE & LETTER LIST";C1~
"KRN",.4,1712,"F",2)
S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) S Y=X D DT K DIP;C48;L18;Z;"NOW"~
"KRN",.4,1712,"F",3)
W:$D(WVPAGE) "PAGE "_WVPAGE;C70;X;Z;"W:$D(WVPAGE) "PAGE "_WVPAGE"~
"KRN",.4,1712,"F",4)
S X="-",DIP(1)=X S X=80,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("-",80)"~"PURPOSE: ";S;C2;X~.01~
"KRN",.4,1712,"F",5)
"SYNONYM: ";C55;X~.03~"PRIORITY: ";C1;X~.02~"ACTIVE: ";C56;X~.04~"BR or CX: ";C1;X~.05~.06;C1;X~" LETTER:"~"";S~1.01,.01~
"KRN",.4,1712,"F",6)
D:$E(IOST)="C" SL^WVPURP;Z;"D:$E(IOST)="C" SL^WVPURP"~
"KRN",.4,1712,"H")
@@
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",364,-1)
1^1
"PKG",364,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
1.0^2980925^2980508^547
"PKG",364,22,1,"PAH",1,0)
4^2990105
"PKG",364,22,1,"PAH",1,1,0)
^^2^2^2990105
"PKG",364,22,1,"PAH",1,1,1,0)
Please read the WV*1*4 patch description on FORUM for an explanation of
"PKG",364,22,1,"PAH",1,1,2,0)
what this patch does.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","WV4PST")
0^6^B20326937
"RTN","WV4PST",1,0)
WV4PST ;HCIOFO/FT-WV*1*4 Post-Installation Routine ;1/4/99  16:36
"RTN","WV4PST",2,0)
 ;;1.0;WOMEN'S HEALTH;**4**;Sep 30, 1998
"RTN","WV4PST",3,0)
 ;
"RTN","WV4PST",4,0)
PAT4 ; Entry point for WV*1*4
"RTN","WV4PST",5,0)
 S ZTDTH=$$HADD^XLFDT($H,"","","",120)
"RTN","WV4PST",6,0)
 S ZTDESC="WV*1*4 data repair"
"RTN","WV4PST",7,0)
 S ZTRTN="QUEUE^WV4PST",ZTIO=""
"RTN","WV4PST",8,0)
 D ^%ZTLOAD
"RTN","WV4PST",9,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN
"RTN","WV4PST",10,0)
 Q
"RTN","WV4PST",11,0)
QUEUE ;
"RTN","WV4PST",12,0)
 D PATCH
"RTN","WV4PST",13,0)
 D KILL
"RTN","WV4PST",14,0)
 Q
"RTN","WV4PST",15,0)
PATCH ; Find WV entry in Package file. If none, create WV entry.
"RTN","WV4PST",16,0)
 D FIND^DIC(9.4,"","","X","WV","","C","","","WVIEN","WVERR")
"RTN","WV4PST",17,0)
 S WVDA=+$G(WVIEN("DILIST",2,1)) ;get File 9.4 ien
"RTN","WV4PST",18,0)
 K WVIEN,WVERR
"RTN","WV4PST",19,0)
 Q:WVDA  ;quit if WV entry exists in Package file, fix not needed.
"RTN","WV4PST",20,0)
 D PF ;create package file entry
"RTN","WV4PST",21,0)
 D FIND^DIC(9.4,"","","X","WV","","C","","","WVIEN","WVERR")
"RTN","WV4PST",22,0)
 S WVDA=+$G(WVIEN("DILIST",2,1)) ;get File 9.4 ien
"RTN","WV4PST",23,0)
 K WVIEN,WVERR
"RTN","WV4PST",24,0)
 Q:'WVDA
"RTN","WV4PST",25,0)
 D BF ;Build file (#9.6) repair
"RTN","WV4PST",26,0)
 D IF ;Install file (#9.7) repair
"RTN","WV4PST",27,0)
 D VER ;create version multiple for WV entry
"RTN","WV4PST",28,0)
 D BWGET ; Get Patch Application History (PAH) data values from
"RTN","WV4PST",29,0)
 ;         File 9.4 BW entry for WV*1*3 & 4.
"RTN","WV4PST",30,0)
 D BWDEL ; Kill PAH entry in File 9.4 BW entry for WV*1*3 & 4
"RTN","WV4PST",31,0)
 Q
"RTN","WV4PST",32,0)
PF ; Create Package File entry for WV
"RTN","WV4PST",33,0)
 K WV94
"RTN","WV4PST",34,0)
 S WV94(9.4,"+1,",.01)="WOMEN'S HEALTH"
"RTN","WV4PST",35,0)
 S WV94(9.4,"+1,",1)="WV"
"RTN","WV4PST",36,0)
 S WV94(9.4,"+1,",2)="Tracks health issues specific to female patients."
"RTN","WV4PST",37,0)
 S WV94(9.4,"+1,",13)="1.0"
"RTN","WV4PST",38,0)
 D UPDATE^DIE("","WV94")
"RTN","WV4PST",39,0)
 K WV94
"RTN","WV4PST",40,0)
 Q
"RTN","WV4PST",41,0)
BF ; Fix package file link for WV*1*3 & 4 in BUILD file (#9.6)
"RTN","WV4PST",42,0)
 ; (i.e., change pointer to WV entry).
"RTN","WV4PST",43,0)
 N WVBFIEN,WV96NAME
"RTN","WV4PST",44,0)
 F WV96NAME="WV*1.0*3","WV*1.0*4" D
"RTN","WV4PST",45,0)
 .D FIND^DIC(9.6,"","","X",WV96NAME,"","B","","","WVIEN","WVERR")
"RTN","WV4PST",46,0)
 .S WVBFIEN=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",47,0)
 .K WVIEN,WVERR
"RTN","WV4PST",48,0)
 .Q:'WVBFIEN
"RTN","WV4PST",49,0)
 .K WVBF
"RTN","WV4PST",50,0)
 .S WVBF(9.6,WVBFIEN_",",1)=WVDA ;Field #1 - Package File Link
"RTN","WV4PST",51,0)
 .D UPDATE^DIE("","WVBF")
"RTN","WV4PST",52,0)
 .K WVBF
"RTN","WV4PST",53,0)
 .Q
"RTN","WV4PST",54,0)
 Q
"RTN","WV4PST",55,0)
IF ; Fix package file link for WV*1*3 & 4 in INSTALL file (#9.7)
"RTN","WV4PST",56,0)
 ; (i.e., change pointer to WV entry).
"RTN","WV4PST",57,0)
 F WV97NAME="WV*1.0*3","WV*1.0*4" D
"RTN","WV4PST",58,0)
 .D FIND^DIC(9.7,"","","X",WV97NAME,"","B","","","WVIEN","WVERR")
"RTN","WV4PST",59,0)
 .S WVIFIEN=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",60,0)
 .K WVIEN,WVERR
"RTN","WV4PST",61,0)
 .Q:'WVIFIEN
"RTN","WV4PST",62,0)
 .K WVIF
"RTN","WV4PST",63,0)
 .S WVIF(9.7,WVIFIEN_",",1)=WVDA ;Field #1 - Package File Link
"RTN","WV4PST",64,0)
 .D UPDATE^DIE("","WVIF")
"RTN","WV4PST",65,0)
 .K WVIF
"RTN","WV4PST",66,0)
 .Q
"RTN","WV4PST",67,0)
 Q
"RTN","WV4PST",68,0)
VER ; Create VERSION multiple for WV entry
"RTN","WV4PST",69,0)
 D FIND^DIC(9.7,"","","X","WOMEN'S HEALTH 1.0","","B","","","WVIEN","WVERR")
"RTN","WV4PST",70,0)
 S WVIFIEN=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",71,0)
 K WVIEN,WVERR
"RTN","WV4PST",72,0)
 S WVIB=$$GET1^DIQ(9.7,WVIFIEN,9,"I") ;Installed By
"RTN","WV4PST",73,0)
 S WVICT=$$GET1^DIQ(9.7,WVIFIEN,17,"I") ;Install Complete Time
"RTN","WV4PST",74,0)
 S:WVICT WVICT=$P(WVICT,".") ;date only
"RTN","WV4PST",75,0)
 K WV94
"RTN","WV4PST",76,0)
 S WV94(9.49,"+1,"_WVDA_",",.01)="1.0" ;version #
"RTN","WV4PST",77,0)
 S WV94(9.49,"+1,"_WVDA_",",1)=2980928 ;date distributed
"RTN","WV4PST",78,0)
 S WV94(9.49,"+1,"_WVDA_",",2)=WVICT   ;install complete time
"RTN","WV4PST",79,0)
 S WV94(9.49,"+1,"_WVDA_",",3)=WVIB    ;installed by
"RTN","WV4PST",80,0)
 D UPDATE^DIE("","WV94")
"RTN","WV4PST",81,0)
 K WV94
"RTN","WV4PST",82,0)
 Q
"RTN","WV4PST",83,0)
BWGET ; Get WV*1*3 & 4 PAH entry in Package file (#9.4) for BW
"RTN","WV4PST",84,0)
 D FIND^DIC(9.4,"","","X","BW","","C","","","WVIEN","WVERR")
"RTN","WV4PST",85,0)
 S WVBW=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",86,0)
 Q:'WVBW
"RTN","WV4PST",87,0)
 K WVIEN,WVERR
"RTN","WV4PST",88,0)
 D FIND^DIC(9.49,","_WVBW_",","","X","1.0","","","","","WVIEN","WVERR")
"RTN","WV4PST",89,0)
 S WVBW1=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",90,0)
 Q:'WVBW1
"RTN","WV4PST",91,0)
 F WVBW2=3,4 D
"RTN","WV4PST",92,0)
 .S WVDA2=WVBW2
"RTN","WV4PST",93,0)
 .K WVIEN,WVERR
"RTN","WV4PST",94,0)
 .D FIND^DIC(9.4901,","_WVBW1_","_WVBW_",","","X",WVBW2,"","B","","","WVIEN","WVERR")
"RTN","WV4PST",95,0)
 .S WVBW2=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",96,0)
 .Q:'WVBW2
"RTN","WV4PST",97,0)
 .K WVPAH
"RTN","WV4PST",98,0)
 .D GETS^DIQ(9.4901,WVBW2_","_WVBW1_","_WVBW_",","*","I","WVPAH","WVERR")
"RTN","WV4PST",99,0)
 .D WVPAH
"RTN","WV4PST",100,0)
 .Q
"RTN","WV4PST",101,0)
 Q
"RTN","WV4PST",102,0)
WVPAH ; Create a PAH entry in File 9.4 WV entry for WV*1*3 & 4
"RTN","WV4PST",103,0)
 ; Use values from BW entry.
"RTN","WV4PST",104,0)
 S WVIENS=$O(WVPAH(9.4901,"")) Q:WVIENS=""  ;no WV*1*3/4 entry for BW
"RTN","WV4PST",105,0)
 D FIND^DIC(9.49,","_WVDA_",","","X","1.0","","","","","WVIEN","WVERR")
"RTN","WV4PST",106,0)
 S WVDA1=+$G(WVIEN("DILIST",2,1))
"RTN","WV4PST",107,0)
 Q:'WVDA1
"RTN","WV4PST",108,0)
 K WVIEN,WVERR
"RTN","WV4PST",109,0)
 D FIND^DIC(9.4901,","_WVDA1_","_WVDA_",","","X",WVDA2,"","B","","","WVIEN","WVERR")
"RTN","WV4PST",110,0)
 Q:+$G(WVIEN("DILIST",2,1))  ;PAH entry already exists
"RTN","WV4PST",111,0)
 K WVPAT3
"RTN","WV4PST",112,0)
 S WVPAT3(9.4901,"+1,"_WVDA1_","_WVDA_",",.01)=WVDA2
"RTN","WV4PST",113,0)
 S WVPAT3(9.4901,"+1,"_WVDA1_","_WVDA_",",.02)=$G(WVPAH(9.4901,WVIENS,.02,"I"))
"RTN","WV4PST",114,0)
 S WVPAT3(9.4901,"+1,"_WVDA1_","_WVDA_",",.03)=$G(WVPAH(9.4901,WVIENS,.03,"I"))
"RTN","WV4PST",115,0)
 D UPDATE^DIE("","WVPAT3")
"RTN","WV4PST",116,0)
 K WVPAT3
"RTN","WV4PST",117,0)
 Q
"RTN","WV4PST",118,0)
BWDEL ; Delete erroneous BW version entry in Package file (#9.4).
"RTN","WV4PST",119,0)
 Q:'$G(WVBW1)!'$G(WVBW)
"RTN","WV4PST",120,0)
 N DA,DIK
"RTN","WV4PST",121,0)
 S DA=WVBW1,DA(1)=WVBW
"RTN","WV4PST",122,0)
 S DIK="^DIC(9.4,"_WVBW_",22,"
"RTN","WV4PST",123,0)
 D ^DIK
"RTN","WV4PST",124,0)
 Q
"RTN","WV4PST",125,0)
KILL ; Kill variables
"RTN","WV4PST",126,0)
 K WV94,WV96NAME,WV97NAME,WVBF,WVBFIEN,WVBW,WVBW1,WVBW2,WVDA,WVDA1,WVDA2
"RTN","WV4PST",127,0)
 K WVERR,WVIB,WVICT,WVIEN,WVIENS,WVIF,WVIFIEN,WVPAH,WVPAT3
"RTN","WV4PST",128,0)
 Q
"RTN","WVPURP")
0^4^B14913145
"RTN","WVPURP",1,0)
WVPURP ;HCIOFO/FT,JR IHS/ANMC/MWR - NOTIFICATION TABLES MAINTENANC; ;1/4/99  12:48
"RTN","WVPURP",2,0)
 ;;1.0;WOMEN'S HEALTH;**4**;Sep 30, 1998
"RTN","WVPURP",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVPURP",4,0)
 ;;  ADD/EDIT/PRINT NOTIFICATION PURPOSE FILE ENTRIES, EDIT PCD DAYS,
"RTN","WVPURP",5,0)
 ;;  EDIT NOTIFICATION TYPE SYNONYMS, ADD/EDIT NOTIFICATION OUTCOMES.
"RTN","WVPURP",6,0)
 ;;
"RTN","WVPURP",7,0)
 ;
"RTN","WVPURP",8,0)
PRINTPUR ;EP
"RTN","WVPURP",9,0)
 ;---> CALLED BY OPTION "WV PRINT NOTIF PURPOSE&LETTER".
"RTN","WVPURP",10,0)
 S L=0,DIC="^WV(790.404,"
"RTN","WVPURP",11,0)
 S FLDS="[WV PRINT NOTIF PURPOSE&LETTER]"
"RTN","WVPURP",12,0)
 S BY=.01,FR="",TO="",DHD="@"
"RTN","WVPURP",13,0)
 S DIOBEG="S WVPAGE=0"
"RTN","WVPURP",14,0)
 D EN1^DIP
"RTN","WVPURP",15,0)
 D KILLALL^WVUTL8
"RTN","WVPURP",16,0)
 Q
"RTN","WVPURP",17,0)
 ;
"RTN","WVPURP",18,0)
 ;
"RTN","WVPURP",19,0)
EDITPUR ;EP
"RTN","WVPURP",20,0)
 ;---> CALLED BY OPTION "WV EDIT NOTIF PURPOSE&LETTER".
"RTN","WVPURP",21,0)
 D SETVARS^WVUTL5
"RTN","WVPURP",22,0)
 ;---> DISPLAY MENU TITLE FROM WV MENU OPTIONS.
"RTN","WVPURP",23,0)
 F  D  Q:$G(Y)<0
"RTN","WVPURP",24,0)
 .D TITLE^WVUTL5("EDIT NOTIFICATION PURPOSE & LETTER FILE")
"RTN","WVPURP",25,0)
 .D DIC^WVFMAN(790.404,"QEMAL",.Y)
"RTN","WVPURP",26,0)
 .Q:Y<0
"RTN","WVPURP",27,0)
 .S DA=+Y
"RTN","WVPURP",28,0)
 .D:$P(Y,U,3) ADDLET
"RTN","WVPURP",29,0)
 .D:'$P(Y,U,3) REPLACE
"RTN","WVPURP",30,0)
 .Q:WVPOP
"RTN","WVPURP",31,0)
 .;---> EDIT WITH SCREENMAN.
"RTN","WVPURP",32,0)
 .S DR="[WV NOTIFPURPOSE-FORM-1]"
"RTN","WVPURP",33,0)
 .D DDS^WVFMAN(790.404,DR,DA,"","",.WVPOP)
"RTN","WVPURP",34,0)
 D KILLALL^WVUTL8
"RTN","WVPURP",35,0)
 Q
"RTN","WVPURP",36,0)
 ;
"RTN","WVPURP",37,0)
 ;
"RTN","WVPURP",38,0)
ADDLET ;EP
"RTN","WVPURP",39,0)
 ;---> CALLED BY OPTION "WV ADD NOTIF PURPOSE&LETTER".
"RTN","WVPURP",40,0)
 K ^WV(790.404,DA,1)
"RTN","WVPURP",41,0)
 N N S N=0
"RTN","WVPURP",42,0)
 F  S N=$O(^WV(790.6,1,1,N)) Q:'N  D
"RTN","WVPURP",43,0)
 .S ^WV(790.404,DA,1,N,0)=^WV(790.6,1,1,N,0)
"RTN","WVPURP",44,0)
 S ^WV(790.404,DA,1,0)=^WV(790.6,1,1,0)
"RTN","WVPURP",45,0)
 Q
"RTN","WVPURP",46,0)
 ;
"RTN","WVPURP",47,0)
REPLACE ;EP
"RTN","WVPURP",48,0)
 ;---> REPLACE OLD LETTER FOR THIS NOTIF PURPOSE WITH GENERIC SAMPLE.
"RTN","WVPURP",49,0)
 N DIR,DIRUT,Y
"RTN","WVPURP",50,0)
 W !!?3,"Do you wish to delete the old letter for this Purpose of "
"RTN","WVPURP",51,0)
 W "Notification",!?3,"and replace it with the generic sample letter?"
"RTN","WVPURP",52,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","WVPURP",53,0)
 S DIR("A")="   Enter Yes or No: " D HELP1
"RTN","WVPURP",54,0)
 D ^DIR W !
"RTN","WVPURP",55,0)
 S:$D(DIRUT) WVPOP=1
"RTN","WVPURP",56,0)
 I Y D ADDLET
"RTN","WVPURP",57,0)
 Q
"RTN","WVPURP",58,0)
 ;
"RTN","WVPURP",59,0)
HELP1 ;EP
"RTN","WVPURP",60,0)
 ;;Enter YES to delete the old letter for this Purpose of Notification
"RTN","WVPURP",61,0)
 ;;and to begin with a fresh copy of the generic sample letter.
"RTN","WVPURP",62,0)
 S WVTAB=5,WVLINL="HELP1" D HELPTX
"RTN","WVPURP",63,0)
 Q
"RTN","WVPURP",64,0)
 ;
"RTN","WVPURP",65,0)
HELPTX ;EP
"RTN","WVPURP",66,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVPURP",67,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","WVPURP",68,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","WVPURP",69,0)
 Q
"RTN","WVPURP",70,0)
 ;
"RTN","WVPURP",71,0)
TYPE ;EP
"RTN","WVPURP",72,0)
 ;---> EDIT SYNONYMS FOR NOTIFICATION TYPES.
"RTN","WVPURP",73,0)
 D SETVARS^WVUTL5
"RTN","WVPURP",74,0)
 F  D  Q:$G(Y)<0
"RTN","WVPURP",75,0)
 .D TITLE^WVUTL5("EDIT SYNONYMS FOR NOTIFICATION TYPES") D TEXT1
"RTN","WVPURP",76,0)
 .N A S A="   Select NOTIFICATION TYPE: "
"RTN","WVPURP",77,0)
 .D DIC^WVFMAN(790.403,"QEMA",.Y,A)
"RTN","WVPURP",78,0)
 .Q:Y<0
"RTN","WVPURP",79,0)
 .D DIE^WVFMAN(790.403,.03,+Y,.WVPOP)
"RTN","WVPURP",80,0)
 W @IOF
"RTN","WVPURP",81,0)
 D KILLALL^WVUTL8
"RTN","WVPURP",82,0)
 Q
"RTN","WVPURP",83,0)
 ;
"RTN","WVPURP",84,0)
OUTCOME ;EP
"RTN","WVPURP",85,0)
 ;---> ADD/EDIT NOTIFICATION OUTCOME FILE.
"RTN","WVPURP",86,0)
 D SETVARS^WVUTL5
"RTN","WVPURP",87,0)
 F  D  Q:$G(Y)<0
"RTN","WVPURP",88,0)
 .D TITLE^WVUTL5("ADD/EDIT NOTIFICATION OUTCOME FILE")
"RTN","WVPURP",89,0)
 .D DIC^WVFMAN(790.405,"QEMAL",.Y,"   Select OUTCOME: ")
"RTN","WVPURP",90,0)
 .Q:Y<0
"RTN","WVPURP",91,0)
 .D DIE^WVFMAN(790.405,.02,+Y,.WVPOP)
"RTN","WVPURP",92,0)
 W @IOF
"RTN","WVPURP",93,0)
 D KILLALL^WVUTL8
"RTN","WVPURP",94,0)
 Q
"RTN","WVPURP",95,0)
 ;
"RTN","WVPURP",96,0)
TEXT1 ;EP
"RTN","WVPURP",97,0)
 ;;You may enter a synonym for each Notification Type.  The synonym will
"RTN","WVPURP",98,0)
 ;;allow the Notification Type to be called up by typing only a few
"RTN","WVPURP",99,0)
 ;;characters.  Synonyms should be unique and less than 4 characters.
"RTN","WVPURP",100,0)
 ;;
"RTN","WVPURP",101,0)
 ;;For example, "L1" might be used for LETTER,FIRST; "L2" for
"RTN","WVPURP",102,0)
 ;;LETTER,SECOND; "L3" for LETTER,THIRD, and so on.
"RTN","WVPURP",103,0)
 ;;
"RTN","WVPURP",104,0)
 ;;
"RTN","WVPURP",105,0)
 S WVTAB=5,WVLINL="TEXT1" D PRINTX
"RTN","WVPURP",106,0)
 Q
"RTN","WVPURP",107,0)
 ;
"RTN","WVPURP",108,0)
PRINTX ;EP
"RTN","WVPURP",109,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVPURP",110,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","WVPURP",111,0)
 Q
"RTN","WVPURP",112,0)
 ;
"RTN","WVPURP",113,0)
GENSTUFF ;EP
"RTN","WVPURP",114,0)
 ;---> STUFF THE GENERIC SAMPLE LETTER INTO ALL PURPOSES OF NOTIF.
"RTN","WVPURP",115,0)
 N DA
"RTN","WVPURP",116,0)
 S DA=0
"RTN","WVPURP",117,0)
 F  S DA=$O(^WV(790.404,DA)) Q:'DA  W !,DA  D ADDLET^WVPURP
"RTN","WVPURP",118,0)
 Q
"RTN","WVPURP",119,0)
SL ; Called from [WV PRINT NOTIF PURPOSE&LETTER] print template.
"RTN","WVPURP",120,0)
 ; If output is on terminal screen, do line feeds to reach
"RTN","WVPURP",121,0)
 ; screen length value (IOSL) after each entry is displayed.
"RTN","WVPURP",122,0)
 N WVLOOP
"RTN","WVPURP",123,0)
 F WVLOOP=1:1 Q:($Y+2)>IOSL  W !
"RTN","WVPURP",124,0)
 Q
"RTN","WVRADWP")
0^1^B23541889
"RTN","WVRADWP",1,0)
WVRADWP ;HCIOFO/FT-Display Report Data from Related Packages  ;12/30/98  14:38
"RTN","WVRADWP",2,0)
 ;;1.0;WOMEN'S HEALTH;**4**;Sep 30, 1998
"RTN","WVRADWP",3,0)
 ;
"RTN","WVRADWP",4,0)
EN ; Determine which report to show (i.e., radiology/nuclear medicine)
"RTN","WVRADWP",5,0)
 ; Called from Edit a Procedure option screen form.
"RTN","WVRADWP",6,0)
 D EX
"RTN","WVRADWP",7,0)
 Q:'$G(DA)
"RTN","WVRADWP",8,0)
 Q:'$D(^WV(790.1,+DA,0))
"RTN","WVRADWP",9,0)
 N WV7901
"RTN","WVRADWP",10,0)
 S WV7901=$E(^WV(790.1,+DA,0),1,2) ;first 2 characters of accession code
"RTN","WVRADWP",11,0)
 Q:WV7901=""
"RTN","WVRADWP",12,0)
 I "^BU^MB^MU^MS^"[WV7901 D EN1 Q  ;show rad/nm report data
"RTN","WVRADWP",13,0)
 Q
"RTN","WVRADWP",14,0)
EN1 ; Set up radiology report data and call FM Browser
"RTN","WVRADWP",15,0)
 N LOOP,WVLCNT,WVRADCSE,WVRADDFN,WVRADDTE,WVRADIEN,WVRPTIEN
"RTN","WVRADWP",16,0)
 S WVRADIEN=$P(^WV(790.1,DA,0),U,15)
"RTN","WVRADWP",17,0)
 Q:WVRADIEN=""  ;no 'radiology mam case #'
"RTN","WVRADWP",18,0)
 S WVRADDFN=$P(^WV(790.1,DA,0),U,2)
"RTN","WVRADWP",19,0)
 Q:'WVRADDFN  ;no dfn
"RTN","WVRADWP",20,0)
 S WVRADDTE=$O(^RADPT("ADC",WVRADIEN,WVRADDFN,0))
"RTN","WVRADWP",21,0)
 Q:'WVRADDTE  ;no inverse exam date
"RTN","WVRADWP",22,0)
 S WVRADCSE=$O(^RADPT("ADC",WVRADIEN,WVRADDFN,WVRADDTE,0))
"RTN","WVRADWP",23,0)
 Q:'WVRADCSE  ;no case number
"RTN","WVRADWP",24,0)
 S WVRPTIEN=+$P(^RADPT(WVRADDFN,"DT",WVRADDTE,"P",WVRADCSE,0),U,17)
"RTN","WVRADWP",25,0)
 Q:'WVRPTIEN  ;no report in File 74
"RTN","WVRADWP",26,0)
 K ^TMP($J,"WV RADRPT"),^TMP("WV RADRPT",$J)
"RTN","WVRADWP",27,0)
 D GETS^DIQ(74,WVRPTIEN_",","*","EI","^TMP($J,""WV RADRPT"")")
"RTN","WVRADWP",28,0)
 S ^TMP("WV RADRPT",$J,1,0)="                   DAY-CASE #: "_$G(^TMP($J,"WV RADRPT",74,WVRPTIEN_",",.01,"E"))
"RTN","WVRADWP",29,0)
 S ^TMP("WV RADRPT",$J,2,0)="               EXAM DATE/TIME: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",3,"E")
"RTN","WVRADWP",30,0)
 S ^TMP("WV RADRPT",$J,3,0)="          VERIFYING PHYSICIAN: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",9,"E")
"RTN","WVRADWP",31,0)
 S ^TMP("WV RADRPT",$J,4,0)="                    PROCEDURE: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",102,"E")
"RTN","WVRADWP",32,0)
 S ^TMP("WV RADRPT",$J,5,0)="             CATEGORY OF EXAM: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",104,"E")
"RTN","WVRADWP",33,0)
 S ^TMP("WV RADRPT",$J,6,0)="                         WARD: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",106,"E")
"RTN","WVRADWP",34,0)
 S ^TMP("WV RADRPT",$J,7,0)=" TREATING SERVICE (INPATIENT): "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",107,"E")
"RTN","WVRADWP",35,0)
 S ^TMP("WV RADRPT",$J,8,0)="             PRINCIPAL CLINIC: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",108,"E")
"RTN","WVRADWP",36,0)
 S ^TMP("WV RADRPT",$J,9,0)="      CONTRACT SHARING SOURCE: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",109,"E")
"RTN","WVRADWP",37,0)
 S ^TMP("WV RADRPT",$J,10,0)="PRIMARY INTERPRETING RESIDENT: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",112,"E")
"RTN","WVRADWP",38,0)
 S ^TMP("WV RADRPT",$J,11,0)="   PRIMARY INTERPRETING STAFF: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",115,"E")
"RTN","WVRADWP",39,0)
 S ^TMP("WV RADRPT",$J,12,0)="            PRIMARY DIAGNOSIS: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",113,"E")
"RTN","WVRADWP",40,0)
 S ^TMP("WV RADRPT",$J,13,0)="         REQUESTING PHYSICIAN: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",114,"E")
"RTN","WVRADWP",41,0)
 S ^TMP("WV RADRPT",$J,14,0)="                 COMPLICATION: "_^TMP($J,"WV RADRPT",74,WVRPTIEN_",",116,"E")
"RTN","WVRADWP",42,0)
 S ^TMP("WV RADRPT",$J,15,0)=" "
"RTN","WVRADWP",43,0)
 S ^TMP("WV RADRPT",$J,16,0)="CLINICAL HISTORY:"
"RTN","WVRADWP",44,0)
 S LOOP=0,WVLCNT=16
"RTN","WVRADWP",45,0)
 F  S LOOP=$O(^TMP($J,"WV RADRPT",74,WVRPTIEN_",",400,LOOP)) Q:'LOOP  D
"RTN","WVRADWP",46,0)
 .S WVLCNT=WVLCNT+1
"RTN","WVRADWP",47,0)
 .S ^TMP("WV RADRPT",$J,WVLCNT,0)=^TMP($J,"WV RADRPT",74,WVRPTIEN_",",400,LOOP)
"RTN","WVRADWP",48,0)
 .Q
"RTN","WVRADWP",49,0)
 S WVLCNT=WVLCNT+1
"RTN","WVRADWP",50,0)
 S ^TMP("WV RADRPT",$J,WVLCNT,0)=" "
"RTN","WVRADWP",51,0)
 S WVLCNT=WVLCNT+1
"RTN","WVRADWP",52,0)
 S ^TMP("WV RADRPT",$J,WVLCNT,0)="IMPRESSION TEXT:"
"RTN","WVRADWP",53,0)
 S LOOP=0
"RTN","WVRADWP",54,0)
 F  S LOOP=$O(^TMP($J,"WV RADRPT",74,WVRPTIEN_",",300,LOOP)) Q:'LOOP  D
"RTN","WVRADWP",55,0)
 .S WVLCNT=WVLCNT+1
"RTN","WVRADWP",56,0)
 .S ^TMP("WV RADRPT",$J,WVLCNT,0)=^TMP($J,"WV RADRPT",74,WVRPTIEN_",",300,LOOP)
"RTN","WVRADWP",57,0)
 .Q
"RTN","WVRADWP",58,0)
 S WVLCNT=WVLCNT+1
"RTN","WVRADWP",59,0)
 S ^TMP("WV RADRPT",$J,WVLCNT,0)=" "
"RTN","WVRADWP",60,0)
 S WVLCNT=WVLCNT+1
"RTN","WVRADWP",61,0)
 S ^TMP("WV RADRPT",$J,WVLCNT,0)="REPORT TEXT:"
"RTN","WVRADWP",62,0)
 S LOOP=0
"RTN","WVRADWP",63,0)
 F  S LOOP=$O(^TMP($J,"WV RADRPT",74,WVRPTIEN_",",200,LOOP)) Q:'LOOP  D
"RTN","WVRADWP",64,0)
 .S WVLCNT=WVLCNT+1
"RTN","WVRADWP",65,0)
 .S ^TMP("WV RADRPT",$J,WVLCNT,0)=^TMP($J,"WV RADRPT",74,WVRPTIEN_",",200,LOOP)
"RTN","WVRADWP",66,0)
 .Q
"RTN","WVRADWP",67,0)
 K ^TMP($J,"WV RADRPT"),WVLCNT,^WV(790.1,DA,9)
"RTN","WVRADWP",68,0)
 S WVJCN=0 F  S WVJCN=$O(^TMP("WV RADRPT",$J,WVJCN)) Q:WVJCN'>0  D
"RTN","WVRADWP",69,0)
 .S ^WV(790.1,DA,9,WVJCN,0)=$G(^TMP("WV RADRPT",$J,WVJCN,0)) S WVJCN1=WVJCN
"RTN","WVRADWP",70,0)
 S ^WV(790.1,DA,9,0)="^^WVJCN1^WVJCN1"
"RTN","WVRADWP",71,0)
 K ^TMP("WV RADRPT",$J)
"RTN","WVRADWP",72,0)
 Q
"RTN","WVRADWP",73,0)
EX ; delete existing radiology report text stored in WH
"RTN","WVRADWP",74,0)
 K ^WV(790.1,DA,9)
"RTN","WVRADWP",75,0)
 Q
"RTN","WVRADWP",76,0)
MAIL(DFN,WVACCESS,WVPROC,WVPROV) ; Send mail message to case manager when
"RTN","WVRADWP",77,0)
 ; Radiology procedure is added to WH Procedure file (#790.1).
"RTN","WVRADWP",78,0)
 ; Called from WVRALINK
"RTN","WVRADWP",79,0)
 ;      DFN -> Patient ien
"RTN","WVRADWP",80,0)
 ; WVACCESS -> File 790.1 ien (procedure entry)
"RTN","WVRADWP",81,0)
 ;   WVPROC -> File 790.2 ien (procedure type)
"RTN","WVRADWP",82,0)
 ;   WVPROV -> File 200   IEN (provider/requestor)
"RTN","WVRADWP",83,0)
 Q:'$G(DFN)!('$G(WVACCESS))!('$G(WVPROC))
"RTN","WVRADWP",84,0)
 N WVCMGR,WVLOOP,WVMSG,XMDUZ,XMSUB,XMTEXT
"RTN","WVRADWP",85,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVRADWP",86,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRADWP",87,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVRADWP",88,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVRADWP",89,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVRADWP",90,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRADWP",91,0)
 .Q
"RTN","WVRADWP",92,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVRADWP",93,0)
 S:WVPROV XMY(WVPROV)=""
"RTN","WVRADWP",94,0)
 S XMDUZ=.5 ;message sender
"RTN","WVRADWP",95,0)
 S XMSUB="RAD/NM added a procedure for a WH patient"
"RTN","WVRADWP",96,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVRADWP",97,0)
 S WVMSG(2)=" WH Accession #: "_$P($G(^WV(790.1,+WVACCESS,0)),U,1)
"RTN","WVRADWP",98,0)
 S WVMSG(3)="      Procedure: "_$P($G(^WV(790.2,+WVPROC,0)),U,1)
"RTN","WVRADWP",99,0)
 S WVMSG(4)=" "
"RTN","WVRADWP",100,0)
 S WVMSG(5)="Please use the 'Edit a Procedure' option in the WOMEN'S"
"RTN","WVRADWP",101,0)
 S WVMSG(6)="HEALTH package to complete/close this procedure."
"RTN","WVRADWP",102,0)
 S XMTEXT="WVMSG("
"RTN","WVRADWP",103,0)
 D ^XMD
"RTN","WVRADWP",104,0)
 Q
"RTN","WVRPPCD1")
0^3^B29658112
"RTN","WVRPPCD1",1,0)
WVRPPCD1 ;HCIOFO/FT,JR IHS/ANMC/MWR - REPORT: PROCEDURE STATISTICS; ;12/24/98  10:38
"RTN","WVRPPCD1",2,0)
 ;;1.0;WOMEN'S HEALTH;**4**;Sep 30, 1998
"RTN","WVRPPCD1",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRPPCD1",4,0)
 ;;  DISPLAY CODE FOR PROCEDURE STATISTICS REPORT.  CALLED BY WVRPPCD.
"RTN","WVRPPCD1",5,0)
 ;
"RTN","WVRPPCD1",6,0)
DISPLAY ;EP
"RTN","WVRPPCD1",7,0)
 ;---> WVTITLE=TITLE AT TOP OF DISPLAY HEADER.
"RTN","WVRPPCD1",8,0)
 ;---> WVSUBH=CODE TO EXECUTE FOR SUBHEADER (COLUMN TITLES).
"RTN","WVRPPCD1",9,0)
 ;---> WVCRT=1 IF OUTPUT IS TO SCREEN (ALLOWS SELECTIONS TO EDIT).
"RTN","WVRPPCD1",10,0)
 ;
"RTN","WVRPPCD1",11,0)
 U IO
"RTN","WVRPPCD1",12,0)
 S WVTITLE="* * *  WOMEN'S HEALTH: PROCEDURE STATISTICS REPORT  * * *"
"RTN","WVRPPCD1",13,0)
 D CENTERT^WVUTL5(.WVTITLE)
"RTN","WVRPPCD1",14,0)
 S WVSUBH="SUBHEAD^WVRPPCD1"
"RTN","WVRPPCD1",15,0)
 D TOPHEAD^WVUTL7
"RTN","WVRPPCD1",16,0)
 S (WVPOP,N)=0
"RTN","WVRPPCD1",17,0)
 ;
"RTN","WVRPPCD1",18,0)
DISPLAY1 ;EP
"RTN","WVRPPCD1",19,0)
 D HEADER3^WVUTL7
"RTN","WVRPPCD1",20,0)
 I '$D(^TMP("WVAR",$J)) D  Q
"RTN","WVRPPCD1",21,0)
 .W !!?5,"No records match the selected criteria.",!
"RTN","WVRPPCD1",22,0)
 .D ENDREP^WVUTL7()
"RTN","WVRPPCD1",23,0)
 F  S N=$O(^TMP("WVAR",$J,N)) Q:N=""!(WVPOP)  D
"RTN","WVRPPCD1",24,0)
 .I $Y+12>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  D
"RTN","WVRPPCD1",25,0)
 ..S WVPAGE=WVPAGE+1
"RTN","WVRPPCD1",26,0)
 ..D HEADER3^WVUTL7
"RTN","WVRPPCD1",27,0)
 .S Y=^TMP("WVAR",$J,N)
"RTN","WVRPPCD1",28,0)
 .S WVARJ=$S($P(Y,U)["MAMMOGRAM":1,$P(Y,U)["ULTRASOUND":1,1:0)
"RTN","WVRPPCD1",29,0)
 .S WVAGRP=$$WVAGRP($P(Y,U,16))
"RTN","WVRPPCD1",30,0)
 .;---> QUIT IF DISPLAYING "ALL AGES" ONLY (NOT GROUPED BY AGE).
"RTN","WVRPPCD1",31,0)
 .Q:WVAGRP=1
"RTN","WVRPPCD1",32,0)
 .S WVPCD="< "_$P(Y,U)_": "_WVAGRP_" >",WVPCDL=$L(WVPCD)
"RTN","WVRPPCD1",33,0)
 .S X=$E(WVLINE,1,31-(WVPCDL/2))
"RTN","WVRPPCD1",34,0)
 .W !!?2,X,WVPCD,X
"RTN","WVRPPCD1",35,0)
 .I WVARJ W !?68," CREDIT"
"RTN","WVRPPCD1",36,0)
 .W !?28,"COUNT",?43,"VETS",?56,"NON-VETS"
"RTN","WVRPPCD1",37,0)
 .I WVARJ W ?66," REG.   NO CR"
"RTN","WVRPPCD1",38,0)
 .W !?26,"----------",?40,"----------",?55,"----------"
"RTN","WVRPPCD1",39,0)
 .I WVARJ W ?67,"-----  -----"
"RTN","WVRPPCD1",40,0)
 .D VERTICAL
"RTN","WVRPPCD1",41,0)
 D ENDREP^WVUTL7()
"RTN","WVRPPCD1",42,0)
 Q
"RTN","WVRPPCD1",43,0)
 ;
"RTN","WVRPPCD1",44,0)
 ;
"RTN","WVRPPCD1",45,0)
VERTICAL ;EP
"RTN","WVRPPCD1",46,0)
 ;---> DISPLAY IN VERTICAL FORMAT.
"RTN","WVRPPCD1",47,0)
 F X=1:1:24 S:$P(Y,U,X)="" $P(Y,U,X)=0
"RTN","WVRPPCD1",48,0)
 F X=25:1:40 S:$P(Y,U,X)'>0 $P(Y,U,X)=""
"RTN","WVRPPCD1",49,0)
 D PG
"RTN","WVRPPCD1",50,0)
 W !?14,$S($P(Y,U)="PREGNANCY TEST":"NOT PREG",1:"NORMAL:")
"RTN","WVRPPCD1",51,0)
 W ?24,$J($P(Y,U,4),5),?30,"(",$J($P(Y,U,5),3),"%)"
"RTN","WVRPPCD1",52,0)
 W ?38,$J($P(Y,U,17),5),?44,PG(1),?47,$J($P(Y,U,4)-$P(Y,U,17),8)
"RTN","WVRPPCD1",53,0)
 W ?59,PG(2)
"RTN","WVRPPCD1",54,0)
 I WVARJ W ?64,$J($P(Y,U,25),5),?72,$J($P(Y,U,33),5)
"RTN","WVRPPCD1",55,0)
 W !?2,"PROCEDURES"
"RTN","WVRPPCD1",56,0)
 W ?14,$S($P(Y,U)="PREGNANCY TEST":"PREGNANT:",1:"ABNORMAL:")
"RTN","WVRPPCD1",57,0)
 W ?24,$J($P(Y,U,8),5),?30,"(",$J($P(Y,U,9),3),"%)"
"RTN","WVRPPCD1",58,0)
 W ?38,$J($P(Y,U,19),5),?44,PG(3),?47,$J($P(Y,U,8)-$P(Y,U,19),8)
"RTN","WVRPPCD1",59,0)
 W ?59,PG(4)
"RTN","WVRPPCD1",60,0)
 I WVARJ W ?64,$J($P(Y,U,27),5),?72,$J($P(Y,U,35),5)
"RTN","WVRPPCD1",61,0)
 W !?14,"NO RESULT:",?24,$J($P(Y,U,12),5),?30,"(",$J($P(Y,U,13),3),"%)"
"RTN","WVRPPCD1",62,0)
 W ?38,$J($P(Y,U,21),5),?44,PG(5),?47,$J($P(Y,U,12)-$P(Y,U,21),8)
"RTN","WVRPPCD1",63,0)
 W ?59,PG(6)
"RTN","WVRPPCD1",64,0)
 I WVARJ W ?64,$J($P(Y,U,29),5),?72,$J($P(Y,U,37),5)
"RTN","WVRPPCD1",65,0)
 W !?14,"TOTAL:",?24,$J($P(Y,U,15),5),?38,$J($P(Y,U,23),5)
"RTN","WVRPPCD1",66,0)
 W ?44,PG(7),?47,$J($P(Y,U,15)-$P(Y,U,23),8)
"RTN","WVRPPCD1",67,0)
 W ?59,PG(8)
"RTN","WVRPPCD1",68,0)
 I WVARJ W ?64,$J($P(Y,U,31),5),?72,$J($P(Y,U,39),5)
"RTN","WVRPPCD1",69,0)
 W !!?14,$S($P(Y,U)="PREGNANCY TEST":"NOT PREG:",1:"NORMAL:")
"RTN","WVRPPCD1",70,0)
 W ?24,$J($P(Y,U,2),5),?30,"(",$J($P(Y,U,3),3),"%)"
"RTN","WVRPPCD1",71,0)
 W ?38,$J($P(Y,U,18),5),?44,PG(9),?47,$J($P(Y,U,2)-$P(Y,U,18),8)
"RTN","WVRPPCD1",72,0)
 W ?59,PG(10)
"RTN","WVRPPCD1",73,0)
 I WVARJ W ?64,$J($P(Y,U,26),5),?72,$J($P(Y,U,34),5)
"RTN","WVRPPCD1",74,0)
 W !?2,"PATIENTS"
"RTN","WVRPPCD1",75,0)
 W ?14,$S($P(Y,U)="PREGNANCY TEST":"PREGNANT:",1:"ABNORMAL:")
"RTN","WVRPPCD1",76,0)
 W ?24,$J($P(Y,U,6),5),?30,"(",$J($P(Y,U,7),3),"%)"
"RTN","WVRPPCD1",77,0)
 W ?38,$J($P(Y,U,20),5),?44,PG(11),?47,$J($P(Y,U,6)-$P(Y,U,20),8)
"RTN","WVRPPCD1",78,0)
 W ?59,PG(12)
"RTN","WVRPPCD1",79,0)
 I WVARJ W ?64,$J($P(Y,U,28),5),?72,$J($P(Y,U,36),5)
"RTN","WVRPPCD1",80,0)
 W !?14,"NO RESULT:",?24,$J($P(Y,U,10),5),?30,"(",$J($P(Y,U,11),3),"%)"
"RTN","WVRPPCD1",81,0)
 W ?38,$J($P(Y,U,22),5),?44,PG(13),?47,$J($P(Y,U,10)-$P(Y,U,22),8)
"RTN","WVRPPCD1",82,0)
 W ?59,PG(14)
"RTN","WVRPPCD1",83,0)
 I WVARJ W ?64,$J($P(Y,U,30),5),?72,$J($P(Y,U,38),5)
"RTN","WVRPPCD1",84,0)
 W !?14,"TOTAL:",?24,$J($P(Y,U,14),5),?38,$J($P(Y,U,24),5)
"RTN","WVRPPCD1",85,0)
 W ?44,PG(15),?47,$J($P(Y,U,14)-$P(Y,U,24),8)
"RTN","WVRPPCD1",86,0)
 W ?59,PG(16)
"RTN","WVRPPCD1",87,0)
 I WVARJ W ?64,$J($P(Y,U,32),5),?72,$J($P(Y,U,40),5)
"RTN","WVRPPCD1",88,0)
 Q
"RTN","WVRPPCD1",89,0)
PG ;FIGURES %'S FOR VETS & NON VETS
"RTN","WVRPPCD1",90,0)
 F JC=1:1:25 S PG(JC)=0
"RTN","WVRPPCD1",91,0)
 I $P(Y,U,4)'=0 S PG(1)=100*$P(Y,U,17)/$P(Y,U,4)
"RTN","WVRPPCD1",92,0)
 I $P(Y,U,8)'=0 S PG(3)=100*$P(Y,U,19)/$P(Y,U,8)
"RTN","WVRPPCD1",93,0)
 I $P(Y,U,12)'=0 S PG(5)=100*$P(Y,U,21)/$P(Y,U,12)
"RTN","WVRPPCD1",94,0)
 I $P(Y,U,15)'=0 S PG(7)=100*$P(Y,U,23)/$P(Y,U,15)
"RTN","WVRPPCD1",95,0)
 I $P(Y,U,2)'=0 S PG(9)=100*$P(Y,U,18)/$P(Y,U,2)
"RTN","WVRPPCD1",96,0)
 I $P(Y,U,6)'=0 S PG(11)=100*$P(Y,U,20)/$P(Y,U,6)
"RTN","WVRPPCD1",97,0)
 I $P(Y,U,10)'=0 S PG(13)=100*$P(Y,U,22)/$P(Y,U,10)
"RTN","WVRPPCD1",98,0)
 I $P(Y,U,14)'=0 S PG(15)=100*$P(Y,U,24)/$P(Y,U,14) D T
"RTN","WVRPPCD1",99,0)
 S PG(2)=$S($P(Y,U,4)'=0:100-PG(1),1:0)
"RTN","WVRPPCD1",100,0)
 S PG(4)=$S($P(Y,U,8)'=0:100-PG(3),1:0)
"RTN","WVRPPCD1",101,0)
 S PG(6)=$S($P(Y,U,12)'=0:100-PG(5),1:0)
"RTN","WVRPPCD1",102,0)
 S PG(8)=$S($P(Y,U,15)'=0:100-PG(7),1:0)
"RTN","WVRPPCD1",103,0)
 S PG(10)=$S($P(Y,U,2)'=0:100-PG(9),1:0)
"RTN","WVRPPCD1",104,0)
 S PG(12)=$S($P(Y,U,6)'=0:100-PG(11),1:0)
"RTN","WVRPPCD1",105,0)
 S PG(14)=$S($P(Y,U,10)'=0:100-PG(13),1:0)
"RTN","WVRPPCD1",106,0)
 S PG(16)=$S($P(Y,U,14)'=0:100-PG(15),1:0)
"RTN","WVRPPCD1",107,0)
 ;PAD %'S WITH BLANKS
"RTN","WVRPPCD1",108,0)
 F JC=1:1:16 S PG(JC)="  "_PG(JC) D
"RTN","WVRPPCD1",109,0)
 .S PG(JC)=$E(PG(JC),$L(PG(JC))-2,$L(PG(JC)))
"RTN","WVRPPCD1",110,0)
 .S PG(JC)="("_PG(JC)_"%)"
"RTN","WVRPPCD1",111,0)
 Q
"RTN","WVRPPCD1",112,0)
T ;ELIMINTE DECIMAL POINT IN %
"RTN","WVRPPCD1",113,0)
 N S F S=1,3,5,7,9,11,13,15 D
"RTN","WVRPPCD1",114,0)
 .S:$E($P(PG(S),".",2))'<.5 PG(S)=PG(S)+1 S PG(S)=$P(PG(S),".")
"RTN","WVRPPCD1",115,0)
 Q
"RTN","WVRPPCD1",116,0)
 ;
"RTN","WVRPPCD1",117,0)
HORIZ ;EP
"RTN","WVRPPCD1",118,0)
 ;---> NOT USED CURRENTLY: DISPLAY IN HORIZONTAL FORMAT.
"RTN","WVRPPCD1",119,0)
 W !!?2,"NORMAL",?15,"NORMAL",?28,"ABNORMAL",?41,"ABNORMAL"
"RTN","WVRPPCD1",120,0)
 W ?54,"NO RESULT",?67,"NO RESULT"
"RTN","WVRPPCD1",121,0)
 W !?2,"patients",?15,"procedures",?28,"patients",?41,"procedures"
"RTN","WVRPPCD1",122,0)
 W ?54,"patients",?67,"procedures"
"RTN","WVRPPCD1",123,0)
 S X=$E(WVLINE,1,11) W !,?2,X,?15,X,?28,X,?41,X,?54,X,?67,X
"RTN","WVRPPCD1",124,0)
 W !?2,$J($P(Y,U,2),5),"(",$P(Y,U,3),"%)"
"RTN","WVRPPCD1",125,0)
 W ?15,$J($P(Y,U,4),5),"(",$P(Y,U,5),"%)"
"RTN","WVRPPCD1",126,0)
 W ?28,$J($P(Y,U,6),5),"(",$P(Y,U,7),"%)"
"RTN","WVRPPCD1",127,0)
 W ?41,$J($P(Y,U,8),5),"(",$P(Y,U,9),"%)"
"RTN","WVRPPCD1",128,0)
 W ?54,$J($P(Y,U,10),5),"(",$P(Y,U,11),"%)"
"RTN","WVRPPCD1",129,0)
 W ?67,$J($P(Y,U,12),5),"(",$P(Y,U,13),"%)"
"RTN","WVRPPCD1",130,0)
 W !!?10,"Total Patients Receiving ",$P(Y,U),": ",$P(Y,U,14)
"RTN","WVRPPCD1",131,0)
 W !?13,"Total ",$P(Y,U)," Procedures Done: ",$P(Y,U,15),!!
"RTN","WVRPPCD1",132,0)
 Q
"RTN","WVRPPCD1",133,0)
 ;
"RTN","WVRPPCD1",134,0)
 ;
"RTN","WVRPPCD1",135,0)
WVAGRP(AGE) ;EP
"RTN","WVRPPCD1",136,0)
 ;Q:AGE="ALL" "All ages"
"RTN","WVRPPCD1",137,0)
 Q:AGE="ALL" $S(WVAGRP'=1:"Total for selected ages",1:"All ages")
"RTN","WVRPPCD1",138,0)
 Q:AGE=1 1
"RTN","WVRPPCD1",139,0)
 N I,X,Y,Z S X=WVAGRG
"RTN","WVRPPCD1",140,0)
 F I=1:1:$L(X,",")  S Y=$P($P(X,",",I),"-",2)  Q:AGE'>Y
"RTN","WVRPPCD1",141,0)
 S Z=$P($P(X,",",I),"-")
"RTN","WVRPPCD1",142,0)
 Q:AGE<Z "Under "_Y_" yrs"
"RTN","WVRPPCD1",143,0)
 Q:AGE>Y "Over "_Y_" yrs"
"RTN","WVRPPCD1",144,0)
 Q $P(X,",",I)_" yrs"
"RTN","WVRPPCD1",145,0)
 ;---> PUT A FINAL CHECK IN HERE??  *COMEBACK
"RTN","WVRPPCD1",146,0)
 Q "Unknown age"
"RTN","WVRPPCD1",147,0)
 ;
"RTN","WVRPPCD1",148,0)
 ;
"RTN","WVRPPCD1",149,0)
SUBHEAD ;EP
"RTN","WVRPPCD1",150,0)
 ;---> SUB HEADER FOR PROCEDURE BROWSE OUTPUT.
"RTN","WVRPPCD1",151,0)
 W !?5,"NOTE: Patient numbers are not intended to total.  "
"RTN","WVRPPCD1",152,0)
 W "Patients may be"
"RTN","WVRPPCD1",153,0)
 W !,"           included in more than one category.",!
"RTN","WVRPPCD1",154,0)
 W $$REPEAT^XLFSTR("=",80)
"RTN","WVRPPCD1",155,0)
 Q
"RTN","WVUTL1A")
0^2^B31155454
"RTN","WVUTL1A",1,0)
WVUTL1A ;HCIOFO/JR - Continuation of ^WVUTL1 (Utilities) ;12/24/98  10:08
"RTN","WVUTL1A",2,0)
 ;;1.0;WOMEN'S HEALTH;**4**;Sep 30, 1998
"RTN","WVUTL1A",3,0)
 ;;
"RTN","WVUTL1A",4,0)
PRIOR() ;EP
"RTN","WVUTL1A",5,0)
 ;---> CALLED FROM WV NOTIF-EDITBLK-1 TO GET VALUE AND TEXT OF
"RTN","WVUTL1A",6,0)
 ;---> NOTIFICATION PRIORITY AND RESULT/REMINDER, FROM PURPOSE OF
"RTN","WVUTL1A",7,0)
 ;---> NOTIFICATION WHEN FIRST DISPLAYING SCREEN.
"RTN","WVUTL1A",8,0)
 ;---> REQUIRED VARIABLE: DA=IEN OF NOTIFICATION.
"RTN","WVUTL1A",9,0)
 N X
"RTN","WVUTL1A",10,0)
 Q:'$D(DA) "UNKNOWN"
"RTN","WVUTL1A",11,0)
 Q:'$D(^WV(790.4,DA,0)) "UNKNOWN"
"RTN","WVUTL1A",12,0)
 S X=$P(^WV(790.4,DA,0),U,4)
"RTN","WVUTL1A",13,0)
 Q:'X "UNKNOWN"
"RTN","WVUTL1A",14,0)
 Q $$PRIOR1
"RTN","WVUTL1A",15,0)
 ;
"RTN","WVUTL1A",16,0)
PRIOR1() ;EP
"RTN","WVUTL1A",17,0)
 ;---> CALLED FROM WV NOTIF-EDITBLK-1 TO GET VALUE AND TEXT OF
"RTN","WVUTL1A",18,0)
 ;---> NOTIFICATION PRIORITY FROM PURPOSE OF NOTIFICATION AS AN
"RTN","WVUTL1A",19,0)
 ;---> ACTION WHEN EDITING PURPOSE OF NOTIFICATION.  ALSO DISPLAY
"RTN","WVUTL1A",20,0)
 ;---> WHETHER PURPOSE IS A RESULT OR A REMINDER.
"RTN","WVUTL1A",21,0)
 ;---> REQUIRED VARIABLE: X=IEN IN NOTIFICATION PURPOSE FILE.
"RTN","WVUTL1A",22,0)
 N R,Y,Z
"RTN","WVUTL1A",23,0)
 Q:'$D(X) "UNDEFINED"
"RTN","WVUTL1A",24,0)
 Q:'X "UNKNOWN"
"RTN","WVUTL1A",25,0)
 Q:'$D(^WV(790.404,X,0)) "UNKNOWN"
"RTN","WVUTL1A",26,0)
 S Y=$P(^WV(790.404,X,0),U,2) D
"RTN","WVUTL1A",27,0)
 .I 'Y S R="UNKNOWN" Q
"RTN","WVUTL1A",28,0)
 .I '$D(^DD(790.404,.02,0)) S R="^DD MISSING"
"RTN","WVUTL1A",29,0)
 .S R=$P($P(^DD(790.404,.02,0),Y_":",2),";")
"RTN","WVUTL1A",30,0)
 S Z=$P(^WV(790.404,X,0),U,6)
"RTN","WVUTL1A",31,0)
 Q:Z="" R
"RTN","WVUTL1A",32,0)
 Q:Z R_", RESULT"
"RTN","WVUTL1A",33,0)
 Q R_", REMINDER"
"RTN","WVUTL1A",34,0)
 ;
"RTN","WVUTL1A",35,0)
 ;
"RTN","WVUTL1A",36,0)
NTPROC() ;EP
"RTN","WVUTL1A",37,0)
 ;---> CALLED FROM WV NOTIF-EDITBLK-1(?) BLOCK TO DISPLAY PROCEDURE
"RTN","WVUTL1A",38,0)
 ;---> NAME, BASED ON ACCESSION# PTR, WHEN FIRST DISPLAYING SCREEN.
"RTN","WVUTL1A",39,0)
 ;---> REQUIRED VARIABLE: X=ACCESSION# OF PROCEDURE
"RTN","WVUTL1A",40,0)
 N X
"RTN","WVUTL1A",41,0)
 S X=$P(^WV(790.4,DA,0),U,6)
"RTN","WVUTL1A",42,0)
 Q $$PROC
"RTN","WVUTL1A",43,0)
 ;
"RTN","WVUTL1A",44,0)
PROC() ;EP
"RTN","WVUTL1A",45,0)
 ;---> DISPLAY PROCEDURE TYPE OF THIS PROCEDURE.
"RTN","WVUTL1A",46,0)
 ;---> REQUIRED VARIABLE: X=IEN OF PROCEDURE IN PROC FILE #790.1.
"RTN","WVUTL1A",47,0)
 N WVY,WVYY,Y,Z S WVYY="INVALID ACC# OR PTR"
"RTN","WVUTL1A",48,0)
 Q:X']"" ""
"RTN","WVUTL1A",49,0)
 Q:'$D(^WV(790.1,X,0)) WVYY
"RTN","WVUTL1A",50,0)
 S WVY=$P(^WV(790.1,X,0),U,4)
"RTN","WVUTL1A",51,0)
 Q:'WVY WVYY
"RTN","WVUTL1A",52,0)
 Q:'$D(^WV(790.2,WVY,0)) WVYY
"RTN","WVUTL1A",53,0)
 S Z=$P(^WV(790.2,WVY,0),U)
"RTN","WVUTL1A",54,0)
 ;---> IF UNILATERAL AND LEFT/RIGHT HAS A VALUE, REPLACE "UNILATERAL"
"RTN","WVUTL1A",55,0)
 ;---> WITH LEFT OR RIGHT.
"RTN","WVUTL1A",56,0)
 S Y=$P(^WV(790.1,X,0),U,9)
"RTN","WVUTL1A",57,0)
 S Y=$S(Y="l":"LEFT",Y="r":"RIGHT",1:"")
"RTN","WVUTL1A",58,0)
 Q:Y="" Z
"RTN","WVUTL1A",59,0)
 Q $P(Z," ")_" "_Y
"RTN","WVUTL1A",60,0)
 ;
"RTN","WVUTL1A",61,0)
PROC1() ;EP
"RTN","WVUTL1A",62,0)
 ;---> DISPLAY PROCEDURE TYPE OF THIS PROCEDURE, USING DA.
"RTN","WVUTL1A",63,0)
 ;---> CALLED BY WV PROC-HEADER-1, WHICH CANNOT USE X.
"RTN","WVUTL1A",64,0)
 ;---> REQUIRED VARIABLE: DA=IEN OF PROCEDURE IN PROC FILE #790.1.
"RTN","WVUTL1A",65,0)
 N X S X=DA
"RTN","WVUTL1A",66,0)
 Q $$PROC
"RTN","WVUTL1A",67,0)
PROVI(DFN) ;
"RTN","WVUTL1A",68,0)
 ;---> RETURNS THE PRIMARY CARE PROVIDER
"RTN","WVUTL1A",69,0)
 ;---> REQUIRED VARIABLE: DFN
"RTN","WVUTL1A",70,0)
 Q:$G(DFN)'>0 "UNKNOWN"
"RTN","WVUTL1A",71,0)
 N X S X=$P($G(^DPT(DFN,.104)),U)
"RTN","WVUTL1A",72,0)
 S X=$S(X>0:$P($G(^VA(200,X,0)),U),1:"")
"RTN","WVUTL1A",73,0)
 I X="" S X=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","WVUTL1A",74,0)
 S:X="" X="UNKNOWN"
"RTN","WVUTL1A",75,0)
 Q X
"RTN","WVUTL1A",76,0)
SCR(X) ;
"RTN","WVUTL1A",77,0)
 Q:$G(X)'>0 0
"RTN","WVUTL1A",78,0)
 S WVJX=$S(X>0:$P($G(^WV(790.07,X,0)),U,2),1:0)
"RTN","WVUTL1A",79,0)
 Q WVJX
"RTN","WVUTL1A",80,0)
QUAD(X) ;
"RTN","WVUTL1A",81,0)
 Q:$TR(X,"ULR,")'="" 0
"RTN","WVUTL1A",82,0)
 N TEST,CN,CNT,WVJX S WVJX=X,CN=""
"RTN","WVUTL1A",83,0)
 S (CN("LL"),CN("UL"),CN("UR"),CN("LR"))="",TEST=1
"RTN","WVUTL1A",84,0)
 F  S CN=$O(CN(CN)) Q:CN=""  I $P(WVJX,CN,2,5)[CN S WVJX=$P(WVJX,CN,1,2)_$P(WVJX,CN,3)
"RTN","WVUTL1A",85,0)
 F CN=1:1:11 I $E(WVJX,CN)=","&($E(WVJX,CN+1)=",") S WVJX=$E(WVJX,1,CN)_$E(WVJX,CN+2,11) S CN=CN-1
"RTN","WVUTL1A",86,0)
 F CN=1:1:4 S CNT=$P(X,",",CN) I CNT'="" I '$D(CN(CNT)) S TEST=0 Q
"RTN","WVUTL1A",87,0)
 S:$E(WVJX,$L(WVJX))="," WVJX=$E(WVJX,1,$L(WVJX)-1)
"RTN","WVUTL1A",88,0)
 S:$E(WVJX,1)="," WVJX=$E(WVJX,2,11)
"RTN","WVUTL1A",89,0)
 S:TEST>0 TEST=TEST_"^"_WVJX
"RTN","WVUTL1A",90,0)
 Q TEST
"RTN","WVUTL1A",91,0)
REF ;
"RTN","WVUTL1A",92,0)
 N X,Y,B,L
"RTN","WVUTL1A",93,0)
 Q:$G(DA)=""  S X=DA
"RTN","WVUTL1A",94,0)
 S Y=X,X=$P($G(^WV(790.07,X,0)),U)
"RTN","WVUTL1A",95,0)
 S L="abcdefghijklmnopqrstuvwxyz"
"RTN","WVUTL1A",96,0)
 S B="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","WVUTL1A",97,0)
 S X=$TR($E(X,1,$L(X)),L,B)
"RTN","WVUTL1A",98,0)
 I WVACT="SET" S ^WV(790.07,"C",X,Y)=""
"RTN","WVUTL1A",99,0)
 I WVACT="KIL" K ^WV(790.07,"C",X,Y)
"RTN","WVUTL1A",100,0)
 K WVACT Q
"RTN","WVUTL1A",101,0)
FAC N X,Y
"RTN","WVUTL1A",102,0)
 S WVJBFAC="",WVJCFAC="",WVJPCP=""
"RTN","WVUTL1A",103,0)
 Q:$G(WVDFN)'>0
"RTN","WVUTL1A",104,0)
 S X=$G(^WV(790,WVDFN,0))
"RTN","WVUTL1A",105,0)
 S WVJBFAC=$P(X,U,25),WVJCFAC=$P(X,U,26),WVJPCP=$$PROVI(WVDFN)
"RTN","WVUTL1A",106,0)
 S:WVJBFAC>0 WVJBFAC=$E($P($G(^DIC(4,WVJBFAC,0)),U),1,18)
"RTN","WVUTL1A",107,0)
 S:WVJCFAC>0 WVJCFAC=$E($P($G(^DIC(4,WVJCFAC,0)),U),1,18)
"RTN","WVUTL1A",108,0)
 Q
"RTN","WVUTL1A",109,0)
RAXS(DA) ; 
"RTN","WVUTL1A",110,0)
 I $G(DA)'>0 Q 0
"RTN","WVUTL1A",111,0)
 S WVJJ0=$G(^WV(790.1,DA,0))
"RTN","WVUTL1A",112,0)
 I '$D(WVJJ0) Q 0
"RTN","WVUTL1A",113,0)
 I "^BU^MB^MU^MS^"'[$E(WVJJ0,1,2) Q 0
"RTN","WVUTL1A",114,0)
 I $P(WVJJ0,U,15)="" Q 0
"RTN","WVUTL1A",115,0)
 Q 1
"RTN","WVUTL1A",116,0)
FACIL(DFN,TYP) ;Gets Treatment Facility, if typ="C" for Cervix, "B" for Breast
"RTN","WVUTL1A",117,0)
 N X,Y
"RTN","WVUTL1A",118,0)
 S Y=""
"RTN","WVUTL1A",119,0)
 I $G(DFN)'>0 Q Y
"RTN","WVUTL1A",120,0)
 S X=$G(^WV(790,DFN,0))
"RTN","WVUTL1A",121,0)
 S:TYP="B" Y=$P(X,U,25) S:TYP="C" Y=$P(X,U,26)
"RTN","WVUTL1A",122,0)
 S:Y>0 Y=$E($P($G(^DIC(4,Y,0)),U),1,18)
"RTN","WVUTL1A",123,0)
 Q Y
"RTN","WVUTL1A",124,0)
MST(WVDFN) ;Gets Military Sexual Trauma
"RTN","WVUTL1A",125,0)
 I $G(WVDFN)'>0 Q ""
"RTN","WVUTL1A",126,0)
 N J S J=$P($G(^WV(790,WVDFN,0)),U,27)
"RTN","WVUTL1A",127,0)
 S J=$S(J="M":"Military",J="C":"Civilian",J="B":"Both",1:"")
"RTN","WVUTL1A",128,0)
 Q J
"RTN","WVUTL1A",129,0)
SC(WVJ) ;Screen called from File 790.02 to elim. inactive from selectable
"RTN","WVUTL1A",130,0)
 I $G(XQY0)["WV ADD/EDIT CASE MANAGERS" Q 1
"RTN","WVUTL1A",131,0)
 I $G(WVJOPEN)>0 Q 1
"RTN","WVUTL1A",132,0)
 I $P($G(^WV(790.01,+WVJ,0)),U,2)>0 Q 0
"RTN","WVUTL1A",133,0)
 Q 1
"RTN","WVUTL1A",134,0)
LOOK(WVJ) ;Display select fields with lookup on 790, not file#2 Identif.
"RTN","WVUTL1A",135,0)
 Q:WVJ'>0
"RTN","WVUTL1A",136,0)
 N DIC,DA,DR,DIQ,Y
"RTN","WVUTL1A",137,0)
 S DIC="^WV(790,",DA=WVJ,DIQ="WVJAR(",DIQ(0)="E"
"RTN","WVUTL1A",138,0)
 S DR=".06;.1;.16" D EN^DIQ1
"RTN","WVUTL1A",139,0)
 S WVJ=WVJAR(790,WVJ,.06,"E")_"    "_WVJAR(790,WVJ,.1,"E")
"RTN","WVUTL1A",140,0)
 K WVJAR
"RTN","WVUTL1A",141,0)
 Q WVJ
"RTN","WVUTL1A",142,0)
LOOKL(WVJ) ;
"RTN","WVUTL1A",143,0)
 N Y,WVX,WVP,WVY,WVDT,WVP,X,WVDTS,WVMARK
"RTN","WVUTL1A",144,0)
 S X1=DT,X2=-30 D C^%DTC S WVDTS=X
"RTN","WVUTL1A",145,0)
 S WVX="" F  S WVX=$O(^WV(790.3,"C",+WVJ,WVX)) Q:WVX'>0  D
"RTN","WVUTL1A",146,0)
 .S WVY=$G(^WV(790.3,WVX,0)),WVDT=+WVY,WVP=$P(WVY,U,3)
"RTN","WVUTL1A",147,0)
 .Q:WVDT'>WVDTS  S WVMARK=1
"RTN","WVUTL1A",148,0)
 .S Y=WVDT D DD^%DT S WVDT=Y
"RTN","WVUTL1A",149,0)
 .;S WVP=$S(WVP'>0:"",1:$P($G(^WV(790.1,WVP,0)),U,4))
"RTN","WVUTL1A",150,0)
 .S:WVP'="" WVP=$P($G(^WV(790.2,WVP,0)),U)
"RTN","WVUTL1A",151,0)
 .W !?32,WVDT,?47,WVP
"RTN","WVUTL1A",152,0)
 W:$G(WVMARK)=1 !
"RTN","WVUTL1A",153,0)
 Q
"RTN","WVUTL1A",154,0)
RUNDT(WVY) ;Get and format run date for various reports 
"RTN","WVUTL1A",155,0)
 ; Center when WVY="C"
"RTN","WVUTL1A",156,0)
 N Y,WVJ
"RTN","WVUTL1A",157,0)
 I $D(WVJRNOW) Q WVJRNOW
"RTN","WVUTL1A",158,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","WVUTL1A",159,0)
 S Y=$E(Y,1,12)_"  "_$E(Y,14,18)
"RTN","WVUTL1A",160,0)
 S:$L(Y)'>10 Y=""
"RTN","WVUTL1A",161,0)
 S (WVJRNOW,WVJ)="Run Date: "_Y
"RTN","WVUTL1A",162,0)
 I $G(WVY)="C" Q "                         "_WVJ
"RTN","WVUTL1A",163,0)
 Q WVJ
"RTN","WVUTL1A",164,0)
MSTAL(WVDFN) ; get Military Sexual Trauma (MST) code from File 2
"RTN","WVUTL1A",165,0)
 ; if MST="Y" return "M" (for military, only)
"RTN","WVUTL1A",166,0)
 N WVMST
"RTN","WVUTL1A",167,0)
 S WVMST=$$GET1^DIQ(2,WVDFN,29.01,"I")
"RTN","WVUTL1A",168,0)
 Q:WVMST="Y" "M"
"RTN","WVUTL1A",169,0)
 Q ""
"RTN","WVUTL1A",170,0)
MSTDEF(WVDFN) ;Makes MST default for ScreenMan Patient edits
"RTN","WVUTL1A",171,0)
 N WVMST
"RTN","WVUTL1A",172,0)
 S WVMST=$$GET1^DIQ(790,WVDFN,.27,"E")
"RTN","WVUTL1A",173,0)
 Q:WVMST'="" WVMST
"RTN","WVUTL1A",174,0)
 S WVMST=$$GET1^DIQ(2,WVDFN,29.01,"E")
"RTN","WVUTL1A",175,0)
 Q WVMST
"RTN","WVUTL1A",176,0)
MSTUPD ;Entry point to update Sexual Trauma from Patient file
"RTN","WVUTL1A",177,0)
 ;when the Sexual Trauma field is released for the Patient file.
"RTN","WVUTL1A",178,0)
 S WVDFN=0
"RTN","WVUTL1A",179,0)
 F  S WVDFN=$O(^WV(790,WVDFN)) Q:WVDFN'>0  S WV0=$G(^(WVDFN,0)) D
"RTN","WVUTL1A",180,0)
 .Q:$P(WV0,U,27)'=""
"RTN","WVUTL1A",181,0)
 .Q:$$MSTAL(WVDFN)=""
"RTN","WVUTL1A",182,0)
 .S $P(^WV(790,WVDFN,0),U,27)=$$MSTAL(WVDFN)
"RTN","WVUTL1A",183,0)
 Q
"RTN","WVUTL1A",184,0)
MSTU ;Update procedure header Sexual Trauma when File 2 field is populated
"RTN","WVUTL1A",185,0)
 Q:$G(WVDFN)'>0
"RTN","WVUTL1A",186,0)
 Q:$P($G(^WV(790,WVDFN,0)),U,27)'=""
"RTN","WVUTL1A",187,0)
 Q:$$MSTDEF(WVDFN)=""
"RTN","WVUTL1A",188,0)
 N DR,DA,DIE,DIC
"RTN","WVUTL1A",189,0)
 S DR=".27////"_$E($$MSTDEF(WVDFN))
"RTN","WVUTL1A",190,0)
 S DA=WVDFN
"RTN","WVUTL1A",191,0)
 S DIE=790
"RTN","WVUTL1A",192,0)
 D ^DIE
"RTN","WVUTL1A",193,0)
 Q
"RTN","WVUTL1A",194,0)
LINE ; Called from the WV LINE FOR MENUS option. That option is merely a
"RTN","WVUTL1A",195,0)
 ; place holder in the menu and used for visual purposes. This is 
"RTN","WVUTL1A",196,0)
 ; entry point does nothing.
"RTN","WVUTL1A",197,0)
 Q
"RTN","WVUTL1A",198,0)
VET(DFN) ; Check if patient is a veteran.
"RTN","WVUTL1A",199,0)
 N WVETERAN
"RTN","WVUTL1A",200,0)
 S WVETERAN=$$GET1^DIQ(2,DFN,1901,"I")
"RTN","WVUTL1A",201,0)
 Q $S(WVETERAN="Y":"Yes",WVETERAN="N":"No",1:"Unknown")
"RTN","WVUTL1A",202,0)
 ;
"VER")
8.0^21.0
**END**
**END**
