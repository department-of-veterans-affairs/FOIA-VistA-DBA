Released DG*5.3*744 SEQ #666
Extracted from mail message
**KIDS**:DG*5.3*744^

**INSTALL NAME**
DG*5.3*744
"BLD",7148,0)
DG*5.3*744^REGISTRATION^0^3070626^y
"BLD",7148,1,0)
^^4^4^3070228^
"BLD",7148,1,1,0)
This patch corrects DRG reports, PTF record search reports, the PTF close 
"BLD",7148,1,2,0)
out edit for surgical codes, replaces a system error with an 
"BLD",7148,1,3,0)
an error bulletin, and determines the proper variable to use
"BLD",7148,1,4,0)
when doing certain ICD9 code lookups. 
"BLD",7148,4,0)
^9.64PA^^
"BLD",7148,6)
1^
"BLD",7148,6.3)
5
"BLD",7148,"KRN",0)
^9.67PA^8989.52^19
"BLD",7148,"KRN",.4,0)
.4
"BLD",7148,"KRN",.401,0)
.401
"BLD",7148,"KRN",.402,0)
.402
"BLD",7148,"KRN",.403,0)
.403
"BLD",7148,"KRN",.5,0)
.5
"BLD",7148,"KRN",.84,0)
.84
"BLD",7148,"KRN",3.6,0)
3.6
"BLD",7148,"KRN",3.8,0)
3.8
"BLD",7148,"KRN",9.2,0)
9.2
"BLD",7148,"KRN",9.8,0)
9.8
"BLD",7148,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",7148,"KRN",9.8,"NM",1,0)
DGPTOD1^^0^B9627005
"BLD",7148,"KRN",9.8,"NM",2,0)
DGPTOD2^^0^B20941670
"BLD",7148,"KRN",9.8,"NM",3,0)
DGPTODI3^^0^B21808131
"BLD",7148,"KRN",9.8,"NM",4,0)
DGPTFIC^^0^B23609839
"BLD",7148,"KRN",9.8,"NM",5,0)
DGPTAE04^^0^B9304291
"BLD",7148,"KRN",9.8,"NM",6,0)
DGPTF5^^0^B3360965
"BLD",7148,"KRN",9.8,"NM",7,0)
VAFCCCAP^^0^B23484935
"BLD",7148,"KRN",9.8,"NM","B","DGPTAE04",5)

"BLD",7148,"KRN",9.8,"NM","B","DGPTF5",6)

"BLD",7148,"KRN",9.8,"NM","B","DGPTFIC",4)

"BLD",7148,"KRN",9.8,"NM","B","DGPTOD1",1)

"BLD",7148,"KRN",9.8,"NM","B","DGPTOD2",2)

"BLD",7148,"KRN",9.8,"NM","B","DGPTODI3",3)

"BLD",7148,"KRN",9.8,"NM","B","VAFCCCAP",7)

"BLD",7148,"KRN",19,0)
19
"BLD",7148,"KRN",19,"NM",0)
^9.68A^^
"BLD",7148,"KRN",19.1,0)
19.1
"BLD",7148,"KRN",101,0)
101
"BLD",7148,"KRN",409.61,0)
409.61
"BLD",7148,"KRN",771,0)
771
"BLD",7148,"KRN",870,0)
870
"BLD",7148,"KRN",8989.51,0)
8989.51
"BLD",7148,"KRN",8989.52,0)
8989.52
"BLD",7148,"KRN",8994,0)
8994
"BLD",7148,"KRN","B",.4,.4)

"BLD",7148,"KRN","B",.401,.401)

"BLD",7148,"KRN","B",.402,.402)

"BLD",7148,"KRN","B",.403,.403)

"BLD",7148,"KRN","B",.5,.5)

"BLD",7148,"KRN","B",.84,.84)

"BLD",7148,"KRN","B",3.6,3.6)

"BLD",7148,"KRN","B",3.8,3.8)

"BLD",7148,"KRN","B",9.2,9.2)

"BLD",7148,"KRN","B",9.8,9.8)

"BLD",7148,"KRN","B",19,19)

"BLD",7148,"KRN","B",19.1,19.1)

"BLD",7148,"KRN","B",101,101)

"BLD",7148,"KRN","B",409.61,409.61)

"BLD",7148,"KRN","B",771,771)

"BLD",7148,"KRN","B",870,870)

"BLD",7148,"KRN","B",8989.51,8989.51)

"BLD",7148,"KRN","B",8989.52,8989.52)

"BLD",7148,"KRN","B",8994,8994)

"BLD",7148,"QUES",0)
^9.62^^
"BLD",7148,"REQB",0)
^9.611^6^6
"BLD",7148,"REQB",1,0)
DG*5.3*375^1
"BLD",7148,"REQB",2,0)
DG*5.3*510^1
"BLD",7148,"REQB",3,0)
DG*5.3*606^1
"BLD",7148,"REQB",4,0)
DG*5.3*701^1
"BLD",7148,"REQB",5,0)
DG*5.3*704^1
"BLD",7148,"REQB",6,0)
DG*5.3*725^1
"BLD",7148,"REQB","B","DG*5.3*375",1)

"BLD",7148,"REQB","B","DG*5.3*510",2)

"BLD",7148,"REQB","B","DG*5.3*606",3)

"BLD",7148,"REQB","B","DG*5.3*701",4)

"BLD",7148,"REQB","B","DG*5.3*704",5)

"BLD",7148,"REQB","B","DG*5.3*725",6)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
744^3070626^100850
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3070626
"PKG",5,22,1,"PAH",1,1,1,0)
This patch corrects DRG reports, PTF record search reports, the PTF close 
"PKG",5,22,1,"PAH",1,1,2,0)
out edit for surgical codes, replaces a system error with an 
"PKG",5,22,1,"PAH",1,1,3,0)
an error bulletin, and determines the proper variable to use
"PKG",5,22,1,"PAH",1,1,4,0)
when doing certain ICD9 code lookups. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","DGPTAE04")
0^5^B9304291^B7860126
"RTN","DGPTAE04",1,0)
DGPTAE04 ;ALB/MTC/ADL - 401 Edit Checks Cont ; 13 NOV 92
"RTN","DGPTAE04",2,0)
 ;;5.3;Registration;**510,744**;Aug 13, 1993;Build 5
"RTN","DGPTAE04",3,0)
 ;;ADL;Updated for CSV Project;;Mar 24, 2003
"RTN","DGPTAE04",4,0)
 ;
"RTN","DGPTAE04",5,0)
TRAN ;-- verify transplant status
"RTN","DGPTAE04",6,0)
 I " 12"'[DGPT40PT S DGPTERC=417
"RTN","DGPTAE04",7,0)
 Q
"RTN","DGPTAE04",8,0)
 ;
"RTN","DGPTAE04",9,0)
CHIEF ;
"RTN","DGPTAE04",10,0)
 N FLAG,I
"RTN","DGPTAE04",11,0)
 Q:"VMN"[DGPTSCS
"RTN","DGPTAE04",12,0)
 I "1234567"'[DGPTSCS S DGPTERC=407 Q
"RTN","DGPTAE04",13,0)
 S FLAG=1 F I=10,11,30,40,42 I DGPTSTTY["^"_I_"^" S FLAG=0 Q
"RTN","DGPTAE04",14,0)
 S:FLAG DGPTERC=407
"RTN","DGPTAE04",15,0)
 Q
"RTN","DGPTAE04",16,0)
FAST ;
"RTN","DGPTAE04",17,0)
 N FLAG,I
"RTN","DGPTAE04",18,0)
 Q:DGPTSFA=" "
"RTN","DGPTAE04",19,0)
 S FLAG=0 F I=20:1:26 I DGPTSTTY["^"_I_"^" S FLAG=1,DGPTSFA=" " Q
"RTN","DGPTAE04",20,0)
 I FLAG Q
"RTN","DGPTAE04",21,0)
 I "12345678"'[DGPTSFA S DGPTERC=408 Q
"RTN","DGPTAE04",22,0)
 Q
"RTN","DGPTAE04",23,0)
ANES ;
"RTN","DGPTAE04",24,0)
 N FLAG,I
"RTN","DGPTAE04",25,0)
 Q:DGPTSAT=" "
"RTN","DGPTAE04",26,0)
 S FLAG=0 F I=20:1:26 I DGPTSTTY["^"_I_"^" S FLAG=1,DGPTSAT=" " Q
"RTN","DGPTAE04",27,0)
 I FLAG Q
"RTN","DGPTAE04",28,0)
 I "0123456789RX"'[DGPTSAT S DGPTERC=409 Q
"RTN","DGPTAE04",29,0)
 S DGPTERC=409 F I=10,11,30,40,42 I DGPTSTTY["^"_I_"^" S DGPTERC=0 Q
"RTN","DGPTAE04",30,0)
 Q
"RTN","DGPTAE04",31,0)
 ;
"RTN","DGPTAE04",32,0)
FIRST ;-- Edit surgeries - present in ICD0 OPERATIONS, current, gender ok
"RTN","DGPTAE04",33,0)
 ;
"RTN","DGPTAE04",34,0)
 I (+DGPTSO1=1371)!(+DGPTSO1=39610)!(+DGPTSO1=39611)!(+DGPTSO1=39612) S DGPTERC=450 D ERR G:DGPTEDFL EXIT
"RTN","DGPTAE04",35,0)
LOOP ;
"RTN","DGPTAE04",36,0)
 F DGPTL3=1:1:5 S DGPTERC=0 D CHKOPC I DGPTERC D ERR G:DGPTEDFL EXIT
"RTN","DGPTAE04",37,0)
 Q
"RTN","DGPTAE04",38,0)
CHKOPC ;
"RTN","DGPTAE04",39,0)
 S DGPTOC=(@("DGPTSO"_DGPTL3)),DGPTOC=$P(DGPTOC," ",1) Q:DGPTOC=""
"RTN","DGPTAE04",40,0)
 S DGPTERC=410+DGPTL3
"RTN","DGPTAE04",41,0)
 S DGPTOC=$E(DGPTOC_"       ",1,2)_"."_$E(DGPTOC,3,7)
"RTN","DGPTAE04",42,0)
 I $D(^ICD0("AB",DGPTOC)) S DGPTERC=0 D GEN Q
"RTN","DGPTAE04",43,0)
 Q
"RTN","DGPTAE04",44,0)
GEN ;
"RTN","DGPTAE04",45,0)
 S DGPTOPP=$O(^ICD0("AB",DGPTOC,0)) I DGPTOPP="" S DGPTERC=451 Q
"RTN","DGPTAE04",46,0)
 S DGPTTMP=$$ICDOP^ICDCODE(DGPTOPP,$S($G(DGPTSDD)'="":DGPTSDD,1:DT))  ;use date of surgery from rec if it exists, else today
"RTN","DGPTAE04",47,0)
 ; DG*744 - check against discharge date
"RTN","DGPTAE04",48,0)
 ;I DGPTTMP=-1!('$P(DGPTTMP,U,10)) S DGPTERC=451 Q
"RTN","DGPTAE04",49,0)
 I DGPTTMP=-1!('$P(DGPTTMP,U,10)) S DGPTERC=451 N DGPTDAT S DGPTDAT=+$G(^DGPT(PTF,70)) I DGPTDAT S DGPTTMP=$$ICDOP^ICDCODE(DGPTOPP,DGPTDAT) I $P(DGPTTMP,U,10)=1 S DGPTERC=0
"RTN","DGPTAE04",50,0)
 I DGPTERC=451 Q
"RTN","DGPTAE04",51,0)
 I $P(DGPTTMP,U,11)]""&(DGPTGEN'=$P(DGPTTMP,U,11)) S DGPTERC=451 Q
"RTN","DGPTAE04",52,0)
CURR ;
"RTN","DGPTAE04",53,0)
 S DGPTTMP=$$ICDOP^ICDCODE(DGPTOPP,$S($G(DGPTSDD)'="":DGPTSDD,1:DT))  ;use date of surgery from rec if it exists, else today
"RTN","DGPTAE04",54,0)
 I ($P(DGPTTMP,U,10)=0)&($P(DGPTSDD,1,7)>$P(DGPTTMP,U,12)) S DGPTERC=474+DGPTL3 Q
"RTN","DGPTAE04",55,0)
SAVE ;
"RTN","DGPTAE04",56,0)
 S @("DGPTSO"_DGPTL3)=DGPTOC
"RTN","DGPTAE04",57,0)
ARRAY ;
"RTN","DGPTAE04",58,0)
 S DGPTOPAR(DGPTSDD)=$S($D(DGPTOPAR(DGPTSDD)):DGPTOPAR(DGPTSDD)_U_DGPTOPP,1:DGPTOPP_U)
"RTN","DGPTAE04",59,0)
 Q
"RTN","DGPTAE04",60,0)
EXIT ;
"RTN","DGPTAE04",61,0)
 K DGPTL3,DGPTOC,DGPTOC1,DGPTOPP
"RTN","DGPTAE04",62,0)
 Q
"RTN","DGPTAE04",63,0)
ERR ;
"RTN","DGPTAE04",64,0)
 D WRTERR^DGPTAE(DGPTERC,NODE,SEQ)
"RTN","DGPTAE04",65,0)
 Q
"RTN","DGPTF5")
0^6^B3360965^B2939565
"RTN","DGPTF5",1,0)
DGPTF5 ;ALB/MTC - PTF ENTRY/EDIT-4 ; 07 JUN 91 
"RTN","DGPTF5",2,0)
 ;;5.3;Registration;**669,701,744**;Aug 13, 1993;Build 5
"RTN","DGPTF5",3,0)
 ;
"RTN","DGPTF5",4,0)
Z I 'DGN S Z=$S(IOST="C-QUME"&($L(DGVI)'=2):Z,1:"["_Z_"]") W @DGVI,Z,@DGVO
"RTN","DGPTF5",5,0)
 E  W "   "
"RTN","DGPTF5",6,0)
 Q
"RTN","DGPTF5",7,0)
 ;
"RTN","DGPTF5",8,0)
Z1 F I=1:1:(Z1-$L(Z)) S Z=Z_" "
"RTN","DGPTF5",9,0)
 W Z
"RTN","DGPTF5",10,0)
 Q
"RTN","DGPTF5",11,0)
 ;
"RTN","DGPTF5",12,0)
CEN ;
"RTN","DGPTF5",13,0)
 W !!,*7,"Record #",PTF," MUST be closed for CENSUS first.",!
"RTN","DGPTF5",14,0)
ASK W !,"Would you like to close this record for CENSUS" S %=2 D YN^DICN
"RTN","DGPTF5",15,0)
 I '% W !?5,"Answer 'YES' to close record for CENSUS also",!?5,"  or   'NO'  to not close this record at all." G ASK
"RTN","DGPTF5",16,0)
 I %=1 S Y=2 D RTY^DGPTUTL D CLS^DGPTC1
"RTN","DGPTF5",17,0)
 K DGRTY,DGRTY0 Q
"RTN","DGPTF5",18,0)
ICDEN ;enter icd codes
"RTN","DGPTF5",19,0)
 I $G(X)["?" Q
"RTN","DGPTF5",20,0)
 N DIC,Y I $G(X)="?BAD" S X="" Q
"RTN","DGPTF5",21,0)
 ; DG*5.3*701 (movement)
"RTN","DGPTF5",22,0)
 I DA'=$G(DGPTF),DA<25,$G(DA(1))>0 D CONFIG^LEXSET("ICD",,$$GETDATE^ICDGTDRG(DA(1)))
"RTN","DGPTF5",23,0)
 ; DG*5.3*744 (801 screen)
"RTN","DGPTF5",24,0)
 E  I DA'=$G(PTF),$D(^DGPT(PTF)) D CONFIG^LEXSET("ICD",,$$GETDATE^ICDGTDRG($G(PTF)))
"RTN","DGPTF5",25,0)
 E  D CONFIG^LEXSET("ICD",,$$GETDATE^ICDGTDRG(DA))
"RTN","DGPTF5",26,0)
 S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"",1:"")_"EQM"
"RTN","DGPTF5",27,0)
 S DIC("A")="Enter ICD: "
"RTN","DGPTF5",28,0)
 D ^DIC
"RTN","DGPTF5",29,0)
 I Y=-1 S X="" Q
"RTN","DGPTF5",30,0)
 S X=$G(Y(1))
"RTN","DGPTF5",31,0)
 Q
"RTN","DGPTF5",32,0)
ICDEN1 ;enter icd codes for DRG
"RTN","DGPTF5",33,0)
 N DIC K X,Y
"RTN","DGPTF5",34,0)
 D CONFIG^LEXSET("ICD",,$G(DGDAT))
"RTN","DGPTF5",35,0)
 S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"",1:"")_"EQM"
"RTN","DGPTF5",36,0)
 S DIC("A")=PROMPT
"RTN","DGPTF5",37,0)
 D ^DIC
"RTN","DGPTF5",38,0)
 I Y=-1 S X="" Q
"RTN","DGPTF5",39,0)
 S X=$G(Y(1))
"RTN","DGPTF5",40,0)
 S Y=$$ICDDX^ICDCODE(X,$G(DGDAT))
"RTN","DGPTF5",41,0)
 Q
"RTN","DGPTFIC")
0^4^B23609839^B27579936
"RTN","DGPTFIC",1,0)
DGPTFIC ;ALB/JDS/ADL - PTF CODE SEARCH ; 26 JAN 87 @0800 [7/12/04 2:53pm]
"RTN","DGPTFIC",2,0)
 ;;5.3;Registration;**510,559,599,669,704,744**; Aug 13, 1993;Build 5
"RTN","DGPTFIC",3,0)
 ;;ADL;;Update for CSV Project;;Mar 25, 2003
"RTN","DGPTFIC",4,0)
EN K DG1 S DIC="^ICD9("   ;;S DIC("S")="I $$ISVALID^ICDGTDRG(+Y,DGDAT,9)" G RANGE
"RTN","DGPTFIC",5,0)
   G RANGE
"RTN","DGPTFIC",6,0)
E9 K DIC S DHD=DHD_"  Diagnostic Code Search"
"RTN","DGPTFIC",7,0)
F9 S DIS(0)="I $D(^DGPT(D0,0)),$P(^(0),U,11)=1 S DG2=0,L=1,D1=+$O(^DGPT(D0,""M"",0)) X DIS(""0AAA""),DIS(""0A"") I DG2 S ^UTILITY($J,""DG"",0)=""D""",DIS("0A")="F E=0:0 X DIS(""0AA"") S D1=$O(^DGPT(D0,""M"",D1)) Q:D1'>0"
"RTN","DGPTFIC",8,0)
 S DG9=$S('DGR:"I DG1[(U_$P(DG3,U,DGZD)_U)",1:"S DG=$$ICDDX^ICDCODE(+$P(DG3,U,DGZD),$$GETDATE^ICDGTDRG(D0)) S DG4=$S(+DG>0&($P(DG,U,10)):$P(DG,U,2),1:"""")_""!"" I DG4]DG1&(DG6]DG4)")
"RTN","DGPTFIC",9,0)
 S XAA="S DG2=DG2+1,^UTILITY($J,""DG"",D0,DG2)=$S(DGZD<11:DGZD-4,1:DGZD-5)_U_$P(DG3,U,10)_U_$P(DG3,U,DGZD)"
"RTN","DGPTFIC",10,0)
 S DIS("0AA")="I $D(^DGPT(D0,""M"",D1,0)) S DG3=^(0) F DGZD=5:1:15 "_DG9_" X XAA"
"RTN","DGPTFIC",11,0)
 S XAAA="S DG2=DG2+1,$P(^UTILITY($J,""DG"",D0,""A""),U,DGZD)=$P($$ICDDX^ICDCODE(+$P(DG3,U,DGZD),$$GETDATE^ICDGTDRG(D0)),U,2)"
"RTN","DGPTFIC",12,0)
 S DIS("0AAA")="I $D(^DGPT(D0,70)) S DG3=^(70) F DGZD=10,16:1:24 "_DG9_" X XAAA"
"RTN","DGPTFIC",13,0)
 S L=0
"RTN","DGPTFIC",14,0)
GO K DG9 W !,"Searching the PTF file  Select fields to sort by",! S DIC="^DGPT(",FLDS="[DGICD]",L=0 D EN1^DIP
"RTN","DGPTFIC",15,0)
Q K DIS,DGZD,DGZJ,DINS,DXS,DTOUT,DG4,DGR,DIP,DP,%,DGZJJ,DGZT,DG1,DHD,I,J,DG2,DG3,DG5,DG6,DG7,DG8,DG9,D0,DJ,DTOT,FLDS,L,PROMPT,Z,X,DIC,X1,Y,XAA,XAAA,XAAAA Q
"RTN","DGPTFIC",16,0)
EN1 ;
"RTN","DGPTFIC",17,0)
 S DIC="^ICD0("   ;;S DIC("S")="I $$ISVALID^ICDGTDRG(+Y,DGDAT,0)" G RANGE
"RTN","DGPTFIC",18,0)
 G RANGE
"RTN","DGPTFIC",19,0)
E0 K DIC S DHD=DHD_" Surgical Code Search"
"RTN","DGPTFIC",20,0)
F0 S DIS(0)="I $D(^DGPT(D0,0)),$P(^(0),U,11)=1 S DG2=0,L=1 X:$D(^DGPT(D0,""P"")) DIS(""0AAAA"") S D1=+$O(^DGPT(D0,""S"",0)) X DIS(""0AAA"") X DIS(""0A"") I DG2 S ^UTILITY($J,""DG"",0)=""P"""
"RTN","DGPTFIC",21,0)
 S DIS("0A")="F E=0:0 X DIS(""0AA"") S D1=$O(^DGPT(D0,""S"",D1)) Q:D1'>0"
"RTN","DGPTFIC",22,0)
 S DG9=$S('DGR:"I DG1[(U_$P(DG3,U,DGZD)_U)",1:"S DG=$$ICDOP^ICDCODE(+$P(DG3,U,DGZD),$$GETDATE^ICDGTDRG(D0)) S DG4=$S(+DG>0&($P(DG,U,10)):$P(DG,U,2),1:"""")_""!"" I DG4]DG1&(DG6]DG4)")
"RTN","DGPTFIC",23,0)
 S XAA="S DG2=DG2+1,^UTILITY($J,""DG"",D0,DG2)=(DGZD-7)_U_$P(DG3,U,1)_U_$P(DG3,U,DGZD)"
"RTN","DGPTFIC",24,0)
 S DIS("0AA")="I $D(^DGPT(D0,""S"",D1,0)) S DG3=^(0) F DGZD=8:1:12 "_DG9_" X XAA"
"RTN","DGPTFIC",25,0)
 S XAAA="S DG2=DG2+1,^UTILITY($J,""DG"",D0,DG2)=DGZD_U_U_$P(DG3,U,DGZD)"
"RTN","DGPTFIC",26,0)
 S DIS("0AAA")="I $D(^DGPT(D0,""401P"")) S DG3=^(""401P"") F DGZD=1:1:5 "_DG9_" X XAAA"
"RTN","DGPTFIC",27,0)
 S XAAAA="S DG2=DG2+1,^UTILITY($J,""DG"",D0,DG2)=(DGZD-4)_U_$P(DG3,U,1)_U_$P(DG3,U,DGZD)"
"RTN","DGPTFIC",28,0)
 S DIS("0AAAA")="F D1=0:0 S D1=$O(^DGPT(D0,""P"",D1)) Q:D1'>0  I $D(^DGPT(D0,""P"",D1,0)) S DG3=^(0) F DGZD=5:1:9 "_DG9_" X XAAAA"
"RTN","DGPTFIC",29,0)
 S L=0
"RTN","DGPTFIC",30,0)
 G GO
"RTN","DGPTFIC",31,0)
 Q
"RTN","DGPTFIC",32,0)
OUT S DGZJ=$X,DG2=$S(DGZT["ICD":"^ICD9(",1:"^ICD0("),DIO=1
"RTN","DGPTFIC",33,0)
 F I=0:0 S I=$O(^UTILITY($J,"DG",D0,I)) Q:I'>0  S J=^(I),Y=$P($P(J,U,2),".",1) X ^DD("DD") W:I>1 !?DGZJ W DGZT_$P(J,U,1)_"  "_Y W ?DGZJ+23,$P(@(DG2_"$P(J,U,3)"_",0)"),U,1) I DG5 S DJ=$S($D(DJ):DJ,1:0)+1,DTOT=1
"RTN","DGPTFIC",34,0)
 Q:'$D(^UTILITY($J,"DG",D0,"A"))  S J=^("A") F I=10,16:1:24 S K=$P(J,U,I) I K]"" W !?DGZJ,$S(I=10:"PRINCIPAL DIAGNOSIS",1:"ICD "_(I-14)),?DGZJ+23,K I DG5 S DJ=$S($D(DJ):DJ,1:0)+1,DTOT=1
"RTN","DGPTFIC",35,0)
 Q
"RTN","DGPTFIC",36,0)
DHD S PROMPT="Then search for: ",DIC("S")=$S($G(DIC("S"))="":"I DG1'[(U_+Y_U)",1:DIC("S")_"&(DG1'[(U_+Y_U))")
"RTN","DGPTFIC",37,0)
 I DG7="Diagnosis" F I=0:0 D ICDEN1^DGPTF5 Q:X=""  S X="`"_+Y D ^DIC Q:Y'>0  S DG1=DG1_+Y_U Q:$L(DG1)>235
"RTN","DGPTFIC",38,0)
 E  F I=0:0 D ^DIC Q:Y'>0  S DG1=DG1_+Y_U Q:$L(DG1)>235
"RTN","DGPTFIC",39,0)
 S DHD="" F I=2:1 S DHD=DHD_$S(I'=2:",  ",1:"")_$P(@(DIC_"$P(DG1,U,I)"_",0)"),U,1) Q:'$P(DG1,U,I+1)  I $L(DHD)>200 S DHD=DHD_"....." Q
"RTN","DGPTFIC",40,0)
C W !,"Total by PTF record or ICD count: P// " S Z="^PTF record^ICD count" R X:DTIME G Q:X=U!'$T X:X="" "S X=""P"" W X" D IN^DGHELP G H:%=-1 S DG5=$S(X="I":1,1:0) Q
"RTN","DGPTFIC",41,0)
H W !!,"The search may have more than 1 match per PTF record",!,"Type 'P' to total only PTF records",!,"Type 'I' to total all matches",! G C
"RTN","DGPTFIC",42,0)
H1 W !!,"Type 'R' to specify a range of codes",!,"     'E' to specify a series of codes to match exactly",!
"RTN","DGPTFIC",43,0)
RANGE S DIC(0)="AMEQZ" W !,"Search by Range or Exact match: E// " S Z="^RANGE^EXACT MATCH" R X:DTIME G Q:X=U!'$T X:X="" "S X=""E"" W X" D IN^DGHELP G H1:%=-1 S DGR=$S(X="R":1,1:0)
"RTN","DGPTFIC",44,0)
 S DG7=$S(DIC[9:"Diagnosis",1:"Surgical") G E:'DGR
"RTN","DGPTFIC",45,0)
 S DIC("A")="Start with "_DG7_" code: "
"RTN","DGPTFIC",46,0)
 ;I DG7="Diagnosis" S DIC(0)="XMQZ",PROMPT="Start with "_DG7_" code: " D ICDEN1^DGPTF5 Q:X=""  S X="`"_+Y D ^DIC G Q:Y'>0 S DG1=$P(Y(0),U,1)_" "
"RTN","DGPTFIC",47,0)
 ;E  S DIC("A")="Start with "_DG7_" code: " D ^DIC G Q:Y'>0 S DG1=$P(Y(0),U,1)_" "
"RTN","DGPTFIC",48,0)
 D ^DIC G Q:Y'>0 S DG1=$P(Y(0),U,1)_" "
"RTN","DGPTFIC",49,0)
F ;I DG7="Diagnosis" S PROMPT="Go to "_DG7_" code: " D ICDEN1^DGPTF5 Q:X=""  S X="`"_+Y D ^DIC G Q:Y'>0 S DG6=$P(Y(0),U,1)_"! " I DG6']DG1 W !,"Must be after start code",! G F
"RTN","DGPTFIC",50,0)
 ;E  S DIC("A")="Go to "_DG7_" code: " D ^DIC G Q:Y'>0 S DG6=$P(Y(0),U,1)_"! " I DG6']DG1 W !,"Must be after start code",! G F
"RTN","DGPTFIC",51,0)
 S DIC("A")="Go to "_DG7_" code: " D ^DIC G Q:Y'>0 S DG6=$P(Y(0),U,1)_"! " I DG6']DG1 W !,"Must be after start code",! G F
"RTN","DGPTFIC",52,0)
 S DHD=DG1_" to "_$P(DG6,"!",1)_" "_DG7_" Code Search" D C G Q:'$D(X),@("F"_$E(DIC,5))
"RTN","DGPTFIC",53,0)
 Q
"RTN","DGPTFIC",54,0)
E ;I DG7="Diagnosis" S DIC(0)="XMQZ",PROMPT="Enter "_DG7_" Code to search for: " D ICDEN1^DGPTF5 Q:X=""  S X="`"_+Y D ^DIC G Q:Y'>0 S DG1=U_+Y_U D DHD G Q:'$D(X),@("E"_$E(DIC,5))
"RTN","DGPTFIC",55,0)
 ;E  S PROMPT="Enter "_DG7_" Code to search for: " D ^DIC G Q:Y'>0 S DG1=U_+Y_U D DHD G Q:'$D(X),@("E"_$E(DIC,5))
"RTN","DGPTFIC",56,0)
 D ^DIC G Q:Y'>0 S DG1=U_+Y_U D DHD G Q:'$D(X),@("E"_$E(DIC,5))
"RTN","DGPTOD1")
0^1^B9627005^B8491742
"RTN","DGPTOD1",1,0)
DGPTOD1 ;ALB/AS/BOK - PTF DRG REPORTS, BUILD UTILITY ; 9/5/01 2:23pm
"RTN","DGPTOD1",2,0)
 ;;5.3;Registration;**158,238,375,744**;Aug 13, 1993;Build 5
"RTN","DGPTOD1",3,0)
 K ^UTILITY($J),A
"RTN","DGPTOD1",4,0)
 S DGFY=$$FY^DGPTOD0(DGED),DGFY2K=$$DGY2K^DGPTOD0(DGFY)
"RTN","DGPTOD1",5,0)
 S DGFYQ=$$FMTE^XLFDT(DGFY2K)_$$QTR(DGED)
"RTN","DGPTOD1",6,0)
 ;S DGWWCST=$P(DGCST,"^",2),DG1DAWW=$P(DGCST,"^",3)/DGWWCST,DG1DAWW=$J(DG1DAWW,0,5),DGHIWW=$P(DGCST,"^",5)/DGWWCST,DGHIWW=$J(DGHIWW,0,5)
"RTN","DGPTOD1",7,0)
 S (DGWWCST,DG1DAWW,DGHIWW)=0
"RTN","DGPTOD1",8,0)
 D DT^DICRW S DGTPT=0
"RTN","DGPTOD1",9,0)
 F DGDRGDT=DGSD:0 S DGDRGDT=$O(^DGPT(DGCR,DGDRGDT)) Q:DGDRGDT'>0!(DGDRGDT>DGED)  F DGPTF=0:0 S DGPTF=$O(^DGPT(DGCR,DGDRGDT,DGPTF)) Q:DGPTF'>0  I $D(^DGPT(DGPTF,0)),'$P(^(0),U,4),$P(^(0),U,11)=1 S DGTPT=DGTPT+1,DGTLOS=0,DFN=+^(0) D ^DGPTOD2
"RTN","DGPTOD1",10,0)
 S H3="               National              "
"RTN","DGPTOD1",11,0)
 ;S DGFT(1)="The dollar figures shown are based on the formulas used in the FY 19"_$S($E(DGFY2K,1,3)>288:"89",1:"88")_" Target Allowance, as explained in the corresponding"
"RTN","DGPTOD1",12,0)
 ;S DGFT(2)="user documentation.  They are provided as a management tool for monitoring purposes and should not be used to predict"
"RTN","DGPTOD1",13,0)
 ;S DGFT(3)="RAM outcome.  They do not include RAM adjustments (salary, psychiatry, census, etc).  It will never be possible to duplicate"
"RTN","DGPTOD1",14,0)
 ;S DGFT(4)="RAM accurately on a current basis as the final RAM formulas are not determined until after the conclusion of the",DGFT(5)="fiscal year."
"RTN","DGPTOD1",15,0)
 S DGFT(4)="(*)Total Weight=Weight x Total # Discharges"
"RTN","DGPTOD1",16,0)
 S H="                Average              ",H1="DRG  Low  High    LOS  Weight         " K A F DGPGM=2:1:5 S R=$P(DGPTFR,"*",DGPGM) Q:R']""  D @R
"RTN","DGPTOD1",17,0)
 K DFN,DG1D,DGALOS,DGBE,DGDRG,DGDRGDT,DGDRGI,DGFYQ,DGHI,DGLBS,DGO,DGMBE,DGMV,DGOUT,DGPM,DGPR,DGPTF,DGPTFR,DGSNM,DGSV1,DGSVC,DGTLOS,DGTPT,DGWWU,H,H1,H3,K,R,W,DGLO,DGCNT,DGPROV,DGWGT
"RTN","DGPTOD1",18,0)
 G Q^DGPTOD0
"RTN","DGPTOD1",19,0)
1 D ^DGPTODT1 Q
"RTN","DGPTOD1",20,0)
2 D ^DGPTODF1 Q
"RTN","DGPTOD1",21,0)
3 D ^DGPTODA1 Q
"RTN","DGPTOD1",22,0)
4 D ^DGPTODCM Q  ;D ^DGPTODB1 Q
"RTN","DGPTOD1",23,0)
5 Q
"RTN","DGPTOD1",24,0)
 Q
"RTN","DGPTOD1",25,0)
WWU S (DGLO,DGHI,DGALOS,DGWWU,DGBE,DGMBE)="",%=$S($D(^ICD(+DGDRG,"FY",DGFY2K,0)):(^(0)),1:"") I %="",DGFY2K="3070000" N DGFY2KSV,DGFY2KYR S DGFY2KSV=DGFY2K,DGFY2KYR=$E(DGFY2K,1,3)-1,DGFY2K=DGFY2KYR_"0000" G WWU
"RTN","DGPTOD1",26,0)
 I $G(DGFY2KSV) S DGFY2K=DGFY2KSV
"RTN","DGPTOD1",27,0)
 S DGHI=$P(%,U,4),DGLO=$P(%,U,3),DGALOS=$P(%,U,9),DGWWU=$P(%,U,2)
"RTN","DGPTOD1",28,0)
 I DGSVC]"" S DGSV1=$S(DGSVC="M":1,DGSVC="NE":2,DGSVC="P":3,DGSVC="R":4,1:5),DGBE=$S($D(^ICD(+DGDRG,"BE",+DGFYQ,"S",+DGSV1,0)):$P(^(0),"^",2),1:""),DGMBE=$S($D(^ICD(+DGDRG,"BE",+DGFYQ,0)):$P(^(0),U,2),1:"")
"RTN","DGPTOD1",29,0)
 S ^UTILITY($J,"DRG",DGDRG)=DGLO_"^"_DGHI_"^"_DGALOS_"^"_DGWWU_"^"_DGBE_"^"_DGMBE Q
"RTN","DGPTOD1",30,0)
BE W !,"If local breakeven days have not been defined, values on this report will not be correct!",!
"RTN","DGPTOD1",31,0)
DIS W !,?10,DGFT(4)  ;F %=1:1:5 W !,DGFT(%)
"RTN","DGPTOD1",32,0)
 Q
"RTN","DGPTOD1",33,0)
 ;
"RTN","DGPTOD1",34,0)
QTR(X) ;Return FY quarter
"RTN","DGPTOD1",35,0)
 ;Input: X=date
"RTN","DGPTOD1",36,0)
 S X=$E(X,4,5)
"RTN","DGPTOD1",37,0)
 Q $S(X<4:2,X<7:3,X<10:4,1:1)
"RTN","DGPTOD2")
0^2^B20941670^B19633748
"RTN","DGPTOD2",1,0)
DGPTOD2 ;ALB/BOK - PTF DRG REPORTS, BUILD UTILITY, CONT. ; 9/14/01 5:57pm
"RTN","DGPTOD2",2,0)
 ;;5.3;Registration;**375,744**;Aug 13, 1993;Build 5
"RTN","DGPTOD2",3,0)
 S DGCNT=0 D SET:DGB,DRG:'DGB Q
"RTN","DGPTOD2",4,0)
SET F DGMV=0:0 S DGMV=$O(^DGPT(DGPTF,"M",DGMV)) Q:DGMV'>0  I $D(^DGPT(DGPTF,"M",DGMV,"P")) S DGPM=^("P"),DGTLOS=$P(DGPM,U,4),DGDRG=+DGPM,DGLBS=$P(^DGPT(DGPTF,"M",DGMV,0),U,2),DGSVC=$P(DGPM,U,2),DGPROV=$P(DGPM,U,5) I DGDRG D UTIL,COMP,CASEMIX
"RTN","DGPTOD2",5,0)
 Q
"RTN","DGPTOD2",6,0)
UTIL Q:'DGDRG  D:'$D(^UTILITY($J,"DRG",DGDRG)) WWU^DGPTOD1 S DGDRGI=^(DGDRG)
"RTN","DGPTOD2",7,0)
 I "DB"[DGS S $P(^(DGDRG),U)=$S($D(^UTILITY($J,"DGPTFR","D",DGDRG)):$P(^(DGDRG),U),1:0)+DGTLOS,$P(^(DGDRG),U,2)=$P(^(DGDRG),U,2)+1 I $P(^(DGDRG),U,2)=1 S ^(DGDRG)=^(DGDRG)_U_DGDRGI,$P(^(DGDRG),U,7)=$P(^(DGDRG),U,8)
"RTN","DGPTOD2",8,0)
 I "SB"[DGS,DGSVC]"" D SET1 S $P(^(DGDRG),U,1)=$S($D(^UTILITY($J,"DGPTFR","SB",DGSVC,DGLBS,DGDRG)):$P(^(DGDRG),U,1),1:0)+DGTLOS,$P(^(DGDRG),U,2)=$P(^(DGDRG),U,2)+1 I $P(^(DGDRG),U,2)=1 S ^(DGDRG)=^(DGDRG)_U_DGDRGI
"RTN","DGPTOD2",9,0)
 Q
"RTN","DGPTOD2",10,0)
DRG Q:'$D(^DGPT(DGPTF,"M",1))
"RTN","DGPTOD2",11,0)
 S DGLBS=$P(^DGPT(DGPTF,"M",1,0),U,2),DGSVC=$S(DGLBS:$P(^DIC(42.4,+DGLBS,0),U,3),1:"") Q:DGSVC']""
"RTN","DGPTOD2",12,0)
 S DGLOS=$S($D(^DGPT(DGPTF,"M",1,"P")):$P(^("P"),U,6),1:""),PTF=DGPTF,DGTLOS=$S($D(^DGPT(DGPTF,"M",1,"P")):$P(^("P"),U,4),1:0),DGCPT="",DGPROV=$P($G(^DGPT(DGPTF,"M",1,"P")),U,5) D EN1^DGPTFD
"RTN","DGPTOD2",13,0)
 I $D(DRG) S DGDRG=DRG D LOS:'DGLOS,UTIL,COMP,CASEMIX K DRG Q
"RTN","DGPTOD2",14,0)
 Q
"RTN","DGPTOD2",15,0)
COMP I DGTLOS,"DB"[DGS,DGDRG S Z=^UTILITY($J,"DGPTFR","D",DGDRG) D SETSUB,SETD
"RTN","DGPTOD2",16,0)
 I DGTLOS,DGSVC]"","SB"[DGS,DGDRG,DGLBS S Z=^UTILITY($J,"DGPTFR","SB",DGSVC,DGLBS,DGDRG) D SETSUB,SETSB  ;DG*5.3*375 changed the check on DGSVC
"RTN","DGPTOD2",17,0)
 Q
"RTN","DGPTOD2",18,0)
SETSUB S A=$S(DGTLOS>$P(Z,U,5):"AA",1:"BA"),T=$S(DGTLOS<$P(Z,U,3)!(DGTLOS=1):"BT",DGTLOS>$P(Z,U,4):"AT",1:"WT"),DGOUT=$S(T="AT"&($P(DGDRGI,U,2)):($S(DGTLOS<366:DGTLOS,1:365)-$P(DGDRGI,U,2)),1:0),DG1D=$S(T="BT"&(DGTLOS=1):1,1:0)
"RTN","DGPTOD2",19,0)
 S B=$S($P(Z,U,7)']"":"",DGTLOS<$P(Z,U,7):"BBE",1:"ABE"),DGPR=$S(T="BT"&(DGTLOS>1):DGTLOS,1:0)
"RTN","DGPTOD2",20,0)
 Q
"RTN","DGPTOD2",21,0)
SETD F W=A,T,B I W]"" S $P(^(W),U,1)=$S($D(^UTILITY($J,"DGPTFR","D",DGDRG,W)):$P(^(W),U,1),1:0)+DGTLOS,$P(^(W),U,2)=$P(^(W),U,2)+1,$P(^(W),U,3)=$P(^(W),U,3)+DGOUT,$P(^(W),U,4)=$P(^(W),U,4)+DG1D,$P(^(W),U,5)=$P(^(W),U,5)+DGPR D:DGPR LOW
"RTN","DGPTOD2",22,0)
 Q
"RTN","DGPTOD2",23,0)
LOW S $P(^(W),U,6)=$P(^UTILITY($J,"DGPTFR","D",DGDRG,W),U,6)+1 Q
"RTN","DGPTOD2",24,0)
SETSB F W=A,T,B I W]"" D SETSB1
"RTN","DGPTOD2",25,0)
 Q
"RTN","DGPTOD2",26,0)
SETSB1 S $P(^(W),U)=$S($D(^UTILITY($J,"DGPTFR","SB",DGSVC,DGLBS,DGDRG,W)):$P(^(W),U),1:0)+DGTLOS,$P(^(W),U,2)=$P(^(W),U,2)+1,$P(^(W),U,3)=$P(^(W),U,3)+DGOUT,$P(^(W),U,4)=$P(^(W),U,4)+DG1D,$P(^(W),U,5)=$P(^(W),U,5)+DGPR D:DGPR LOW1
"RTN","DGPTOD2",27,0)
 Q
"RTN","DGPTOD2",28,0)
LOW1 S $P(^(W),U,6)=$P(^UTILITY($J,"DGPTFR","SB",DGSVC,DGLBS,DGDRG,W),U,6)+1 Q
"RTN","DGPTOD2",29,0)
SET1 S K=DGSVC,DGSNM=$S(K="M":"MEDICINE",K="S":"SURGERY",K="P":"PSYCHIATRY",K="NE":"NEUROLOGY",K="R":"REHAB MEDICINE",K="NH":"NHCU",K="I":"INTERMEDIATE MED",K="SCI":"SPINAL CORD INJURY",K="D":"DOMICILIARY",K="B":"BLIND REHAB",1:"RESPITE CARE")
"RTN","DGPTOD2",30,0)
 I '$G(DGLBS) S DGLBS=83   ; use Respite Care
"RTN","DGPTOD2",31,0)
 S ^UTILITY($J,"DGPTFR","SB",DGSVC)=DGSNM,^UTILITY($J,"DGPTFR","SB",DGSVC,DGLBS)=$P(^DIC(42.4,DGLBS,0),U,1) Q
"RTN","DGPTOD2",32,0)
LOS S X2=$S('DGTLOS:$P(^DGPT(DGPTF,0),U,2),1:X2),X1=$S($P(^DGPT(DGPTF,"M",1,0),U,10)]"":$P(^(0),U,10),1:DT) D ^%DTC S DGTLOS=$S(X<1:1,1:X) Q
"RTN","DGPTOD2",33,0)
 Q
"RTN","DGPTOD2",34,0)
CASEMIX ;
"RTN","DGPTOD2",35,0)
 S DGWGT=$P($G(^ICD(DGDRG,"FY",DGFY2K,0)),U,2)
"RTN","DGPTOD2",36,0)
 I DGWGT="",DGFY2K="3070000" S DGWGT=$S($D(^ICD(DGDRG,"FY",DGFY2K,0)):(^(0)),1:"")
"RTN","DGPTOD2",37,0)
 I DGWGT="",DGFY2K="3070000" N DGFY2KSV,DGFY2KYR S DGFY2KSV=DGFY2K,DGFY2KYR=$E(DGFY2K,1,3)-1,DGFY2K=DGFY2KYR_"0000" G CASEMIX
"RTN","DGPTOD2",38,0)
 I $G(DGFY2KSV) S DGFY2K=DGFY2KSV
"RTN","DGPTOD2",39,0)
 S DGCNT=DGCNT+1
"RTN","DGPTOD2",40,0)
 ; next line is to avoid adding duplicates when the 
"RTN","DGPTOD2",41,0)
 ; "Batch Multiple DRG Reports" option is used
"RTN","DGPTOD2",42,0)
 Q:$D(^UTILITY("DGPTOD1","CASEMIX",DGPTF,DGCNT))
"RTN","DGPTOD2",43,0)
 S ^UTILITY("DGPTOD1","CASEMIX",DGPTF,DGCNT)=DGDRG_U_DGWGT_U_DGSVC_U_DGLBS_U_DGPROV
"RTN","DGPTOD2",44,0)
 Q
"RTN","DGPTODI3")
0^3^B21808131^B21618176
"RTN","DGPTODI3",1,0)
DGPTODI3 ;ALB/MTC - DRG INDEX(CONT),PRINT FROM ^UTILITY GLOBAL ; 8/29/01 11:08am
"RTN","DGPTODI3",2,0)
 ;;5.3;Registration;**51,158,164,375,606,744**;Aug 13, 1993;Build 5
"RTN","DGPTODI3",3,0)
 S (DGPAG,DGAT,DGBT,DGAAL,DGTP,DG1DAY,DGTDRG,DGTP(1),DGUNIQ,SSN(1))=0,$P(DGLN,"=",132)="",$P(DGLN2,"-",132)=""
"RTN","DGPTODI3",4,0)
 F DRG=0:0 D:DRG>0 TOT S DRG=$O(^UTILITY($J,"DGDRGI",DRG)) Q:DRG'>0  D HDR S J1=0 F J=0:0 S J1=$O(^UTILITY($J,"DGDRGI",DRG,J1)) Q:J1']""  S:DGP DGPT=J1 S:'DGP DGTD=J1 D L2
"RTN","DGPTODI3",5,0)
 W @IOF,!?61,"Summary Page",!!!,"Total combined hits for Medical Center of all DRGs: ",DGTP(1),!,"The following list gives the total hits by DRG:"
"RTN","DGPTODI3",6,0)
 S DRG="" F J=0:0 Q:DRG<0  W ! F %=1:1:8 S DRG=$O(DRG(DRG)) S:DRG'>0 DRG=-1 Q:DRG'>0  W "    DRG ",$J(DRG,3),":",$J(DRG(DRG),4)
"RTN","DGPTODI3",7,0)
 D:$D(^UTILITY($J,"DGDRGI","DGNOCODE")) NC K DGAT,DGBT,DGAAL,DG1DAY,DGTDRG,DGUNIQ,DGLN,DGLN2,DGPT,DGAL,DGTD,DGDT,DGHI,DGLO,DGPAG,DGNC,DGTP,I,J,J1,K,L Q
"RTN","DGPTODI3",8,0)
L2 F K=0:0 S K=$O(^UTILITY($J,"DGDRGI",DRG,J1,K)) Q:K'>0  F L=0:0 S L=$O(^UTILITY($J,"DGDRGI",DRG,J1,K,L)) Q:L']""  S DGDT=L,X=^(L) D LN
"RTN","DGPTODI3",9,0)
 Q
"RTN","DGPTODI3",10,0)
LN I $Y>$S('$D(IOSL):60,1:(IOSL-6)) D HDR
"RTN","DGPTODI3",11,0)
 S DGTP=DGTP+1,DGTDRG=DGTDRG+1 W !! W:DGP DGPT I 'DGP S DFN=$P(X,"^",2) W $P(^DPT(DFN,0),"^",1)
"RTN","DGPTODI3",12,0)
 S SSN(2)=$P(X,"^") W ?33,SSN(2),?44 S:SSN(2)'=SSN(1) DGUNIQ=DGUNIQ+1,SSN(1)=SSN(2) S Y=$P(X,"^",6) D DT W:DGD=0 ?55,"----------" I DGD S Y=$P(X,"^",7) I Y W ?55 D DT
"RTN","DGPTODI3",13,0)
 W ?66 W:DGDT=1!(DGDT=$P(X,"^",7)) "----------" I DGDT>1&(DGDT'=$P(X,"^",7)) S Y=DGDT D DT
"RTN","DGPTODI3",14,0)
 W ?76 S DGLOS=$P(X,"^",3),DGBE=$P(X,"^",9) W $J(DGLOS,4),?83,$J(DGBE,5) I DGLOS>0 W ?91 D FLG
"RTN","DGPTODI3",15,0)
 W ?99 S DGSTAT=$P(X,"^",8) W $S(DGSTAT=0:"O",DGSTAT=1:"C",DGSTAT=2:"R",1:"T")
"RTN","DGPTODI3",16,0)
 S DGPRO=$P(X,"^",4),DGBS=$P(X,"^",5) W ?103 W:DGPRO'>0 "not specified/" I DGPRO>0 W $S($D(^VA(200,DGPRO,0)):$E($P(^VA(200,DGPRO,0),"^",1),1,29),1:"not specified"),"/"
"RTN","DGPTODI3",17,0)
 I DGBS>0 W !,?103,$E($P(^DIC(42.4,DGBS,0),"^",1),1,29)
"RTN","DGPTODI3",18,0)
 Q
"RTN","DGPTODI3",19,0)
FLG I DGLOS=1 S DG1DAY=DG1DAY+1 W "   *" Q
"RTN","DGPTODI3",20,0)
 S %="" S:DGBE]""&(DGLOS>DGBE) DGBT=DGBT+1,%="B" S:DGHI]""&(DGLOS>DGHI) DGAT=DGAT+1,%=%_"H" S:DGAL]""&(DGLOS>DGAL) DGAAL=DGAAL+1,%=%_"A" W:%]"" $J(%,4) Q
"RTN","DGPTODI3",21,0)
TOT W !,DGLN,!?3,"Total: ",DGTP,!,?3,"Total Unique Patients: ",DGUNIQ S %=$S('$D(IOSL):56,1:(IOSL-10)) F I=$Y:1:% W !
"RTN","DGPTODI3",22,0)
 W !!,"FLAGS:  H - Total Above High Trim: ",DGAT,"   * - Total 1 Day LOS: ",DG1DAY,"   A - Total Above ALOS: ",DGAAL
"RTN","DGPTODI3",23,0)
 S DRG(DRG)=DGTP,DGTP(1)=DGTP(1)+DGTP,(DGTP,DGBT,DGAT,DG1DAY,DGAAL,DGUNIQ,SSN(1))=0 W !!?64,"-",DGPAG,"-" Q
"RTN","DGPTODI3",24,0)
DT W $TR($$FMTE^XLFDT(Y,"5DF")," ","0") S Y="" Q
"RTN","DGPTODI3",25,0)
HDR W @IOF,!,"DRG INDEX FOR DRG ",DRG,?30,"Weight: "
"RTN","DGPTODI3",26,0)
HD1 S %=$S($D(^ICD(DRG,"FY",DGFY2K,0)):(^(0)),1:"")
"RTN","DGPTODI3",27,0)
 I %="",DGFY2K="3070000" N DGFY2KSV,DGFY2KYR S DGFY2KSV=DGFY2K,DGFY2KYR=$E(DGFY2K,1,3)-1,DGFY2K=DGFY2KYR_"0000" G HD1
"RTN","DGPTODI3",28,0)
 I $G(DGFY2KSV) S DGFY2K=DGFY2KSV
"RTN","DGPTODI3",29,0)
 W $P(%,"^",2),?46,"Low Trim: " S DGLO=$P(%,"^",3),DGHI=$P(%,"^",4),DGAL=$P(%,"^",9) W DGLO,?60,"High Trim: ",DGHI,?76,"Avg LOS: ",DGAL
"RTN","DGPTODI3",30,0)
 W ?105,"PRINTED: " S Y=DT X ^DD("DD") W Y,!?3,"For ",$S(DGD:"Discharge Dates from: ",1:"Active Admissions") I DGD S Y=DGSD+.1 X ^DD("DD") W $P(Y,"@")," to " S Y=DGED X ^DD("DD") W $P(Y,"@") I DGB W " including TRANSFER DRGs"
"RTN","DGPTODI3",31,0)
 ;W !!,?5,"Description:" F %=0:0 S %=$O(^ICD(DRG,1,%)) Q:%'>0  W ?18,^ICD(DRG,1,%,0),!
"RTN","DGPTODI3",32,0)
 N DXD,DGDX S DXD=$$DRGD^ICDGTDRG(DRG,"DGDX",,DT)
"RTN","DGPTODI3",33,0)
 W !!,?5,"Description:" F %=0:0 S %=$O(DGDX(%)) Q:'+%  Q:DGDX(%)=" "  W ?18,DGDX(%),!
"RTN","DGPTODI3",34,0)
 W !!,?44,"ADMISSION",?55,"DISCHARGE",?66,"TRANSFER",?97,"PTF",?103,"TRANSFERRING PROVIDER/"
"RTN","DGPTODI3",35,0)
 W !,"PATIENT NAME",?33,"SSN",?44,"DATE",?55,"DATE",?66,"DATE",?77,"LOS",?91,"FLGS",?97,"STAT",?103,"LOSING SPECIALTY"
"RTN","DGPTODI3",36,0)
 W !,DGLN S DGPAG=DGPAG+1 S:'$D(^UTILITY($J,"DGTC",DRG)) ^UTILITY($J,"DGTC",DRG,DGPAG)="" Q
"RTN","DGPTODI3",37,0)
PNC W !,DGNC,?9,$P(^DPT(DFN,0),"^"),?45,$P(^(0),"^",9),?63 S Y=DGDT D DT Q
"RTN","DGPTODI3",38,0)
HD2 W:DGPAG>0 !,?64,"-",DGPAG,"-",@IOF S DGPAG=DGPAG+1 W !,"PTF #",?9,"PATIENT NAME",?45,"SSN",?60,"ADMISSION DATE",!,DGLN Q
"RTN","DGPTODI3",39,0)
NC S (DGPAG,DGTP)=0
"RTN","DGPTODI3",40,0)
 W @IOF,"A ",$S(DGB:"transfer ",1:""),"DRG can not be computed for 1 or more movement(s) associated with the following PTF records because ",$S(DGB:"transfer ",1:""),"ICD code(s) "
"RTN","DGPTODI3",41,0)
 W:DGB ! W "are missing:"
"RTN","DGPTODI3",42,0)
 D HD2
"RTN","DGPTODI3",43,0)
 F DGNC=0:0 S DGNC=$O(^UTILITY($J,"DGDRGI","DGNOCODE",DGNC)) Q:DGNC'>0  S DGTP=DGTP+1,DFN=+^UTILITY($J,"DGDRGI","DGNOCODE",DGNC),DGDT=$P(^(DGNC),"^",2) D PNC D:$Y>$S('$D(IOSL):58,1:(IOSL-8)) HD2
"RTN","DGPTODI3",44,0)
 S:DGPAG=0 DGPAG=1 W !,DGLN,!,"Total PTF Records: ",DGTP S %=$S('$D(IOSL):60,1:IOSL-6) F I=$Y:1:% W !
"RTN","DGPTODI3",45,0)
 W !?64,"-",DGPAG,"-",! Q
"RTN","VAFCCCAP")
0^7^B23484935^B23061055
"RTN","VAFCCCAP",1,0)
VAFCCCAP ;ALB/CMM/PKE/PHH/EG/GAH OUTPATIENT CAPTURE TEST ; 5/5/05 9:04am
"RTN","VAFCCCAP",2,0)
 ;;5.3;Registration;**91,179,553,582,568,585,662,725,744**;Jun 06, 1996;Build 5
"RTN","VAFCCCAP",3,0)
 ;
"RTN","VAFCCCAP",4,0)
 ;
"RTN","VAFCCCAP",5,0)
CAP ;Only fire if check-in,check-out, add/edit add, add/edit change
"RTN","VAFCCCAP",6,0)
 I ($G(SDAMEVT)<4)!($G(SDAMEVT)>7) Q
"RTN","VAFCCCAP",7,0)
 ;quit if no change
"RTN","VAFCCCAP",8,0)
 I +$G(SDATA("BEFORE","STATUS"))=3,+$G(SDATA("AFTER","STATUS"))=3
"RTN","VAFCCCAP",9,0)
 IF  I $P($G(SDATA("AFTER","STATUS")),"^",3)'="ACTION REQ/CHECKED IN"
"RTN","VAFCCCAP",10,0)
 IF  I $P($G(SDATA("BEFORE","STATUS")),"^",3)'="NO ACTION TAKEN/TODAY" Q
"RTN","VAFCCCAP",11,0)
 ;check to see if sending is on or off
"RTN","VAFCCCAP",12,0)
 I '$P($$SEND^VAFHUTL(),"^",2) Q
"RTN","VAFCCCAP",13,0)
 ;check if protocol disabled or no clients
"RTN","VAFCCCAP",14,0)
 I $$PROTOCHK("VAFC ADT-A08-SDAM SERVER") Q
"RTN","VAFCCCAP",15,0)
 ;Queue to run NOW, returns control back to outpatient event driver
"RTN","VAFCCCAP",16,0)
 S ZTRTN="EN^VAFCCCAP",ZTDESC="PIMS Outpatient HL7 v2.3 Capture"
"RTN","VAFCCCAP",17,0)
 S ZTSAVE("SDHDL")="",ZTSAVE("SDAMEVT")="",ZTSAVE("SDATA")="",ZTSAVE("^TMP(""SDEVT"",$J,")="",ZTIO="",ZTDTH=$H
"RTN","VAFCCCAP",18,0)
 D ^%ZTLOAD
"RTN","VAFCCCAP",19,0)
 ;W !?3,$G(ZTSK)
"RTN","VAFCCCAP",20,0)
 Q
"RTN","VAFCCCAP",21,0)
 ;
"RTN","VAFCCCAP",22,0)
EN ;
"RTN","VAFCCCAP",23,0)
 N DFN,HLD,EVDT,CHK,ERR,SEND,NEW,EVENT,HOSP,THLD,PTR,REM,HPTR
"RTN","VAFCCCAP",24,0)
 ;
"RTN","VAFCCCAP",25,0)
 ;Appointments
"RTN","VAFCCCAP",26,0)
 ;
"RTN","VAFCCCAP",27,0)
 I SDAMEVT=4!(SDAMEVT=5) D
"RTN","VAFCCCAP",28,0)
 .S DFN=$P(SDATA,"^",2),EVDT=$P(SDATA,"^",3),PTR=$$GETPTR^VAFHCUTL(1),PTR=PTR_";SCE(",(CHK,UP,REM)=""
"RTN","VAFCCCAP",29,0)
 .I SDAMEVT=4 S PTR=DFN_";DPT(" ;check-in or unscheduled visit check-in
"RTN","VAFCCCAP",30,0)
 .;Need to check if deleting check-out
"RTN","VAFCCCAP",31,0)
 .;if deleting check-out and no pivot file entry exists don't send
"RTN","VAFCCCAP",32,0)
 .I +$G(SDATA("AFTER","STATUS"))=3&(+$G(SDATA("BEFORE","STATUS"))=2) S CHK=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR),PTR=$$UPPTR(DFN,EVDT) S:PTR="@" REM=1 S:+CHK>0 UP=$$UPDATE^VAFHUTL(+CHK,EVDT,PTR,REM) S:+CHK<0!(+UP<0) SEND="N"
"RTN","VAFCCCAP",33,0)
 .;set send to N if deleting and not in pivot file
"RTN","VAFCCCAP",34,0)
 .I '$D(SEND) D
"RTN","VAFCCCAP",35,0)
 ..S HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",36,0)
 ..I +HLD=-1 S HPTR=DFN_";DPT(",HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,HPTR) I +HLD'=-1 S UP=$$UPDATE^VAFHUTL(+HLD,EVDT,PTR,"")
"RTN","VAFCCCAP",37,0)
 ..I +HLD=-1 S HLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",38,0)
 ..;S EVENT=$P(HLD,":"),ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",39,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",40,0)
 ..I +HLD=-1 S ERR=HLD
"RTN","VAFCCCAP",41,0)
 ..S EVENT=$P(HLD,":")
"RTN","VAFCCCAP",42,0)
 ..I EVENT>0 D SETUP
"RTN","VAFCCCAP",43,0)
 ;
"RTN","VAFCCCAP",44,0)
 ;Stop codes, Add/Edits
"RTN","VAFCCCAP",45,0)
 I SDAMEVT=6!(SDAMEVT=7) D
"RTN","VAFCCCAP",46,0)
 .N HLD,STOP,THLD,REMOVE,UP
"RTN","VAFCCCAP",47,0)
 .S HLD="",STOP="N",ERR=""
"RTN","VAFCCCAP",48,0)
 .F  K EVENT S REMOVE="N",HLD=$O(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD)) Q:HLD=""!(STOP="Y")  D
"RTN","VAFCCCAP",49,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'=""&($P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",6)'="") S STOP="Y" Q
"RTN","VAFCCCAP",50,0)
 ..;If STOP="Y" stop code was not stand alone
"RTN","VAFCCCAP",51,0)
 ..;If STOP="N" stop code is stand alone
"RTN","VAFCCCAP",52,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")="" D
"RTN","VAFCCCAP",53,0)
 ...S REMOVE="Y",DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",54,0)
 ...S EVENT=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",55,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'="" D
"RTN","VAFCCCAP",56,0)
 ...S DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",57,0)
 ..I '$D(EVENT) S THLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR),EVENT=$P(THLD,":")
"RTN","VAFCCCAP",58,0)
 ..I +$G(THLD)=-1 S ERR=THLD
"RTN","VAFCCCAP",59,0)
 ..I REMOVE="Y" S PTR="@",UP=$$UPDATE^VAFHUTL(+EVENT,EVDT,PTR,1)
"RTN","VAFCCCAP",60,0)
 ..;I +EVENT>0 S ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",61,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",62,0)
 ..I +EVENT>0 D SETUP
"RTN","VAFCCCAP",63,0)
 ;
"RTN","VAFCCCAP",64,0)
EXIT ;
"RTN","VAFCCCAP",65,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","VAFCCCAP",66,0)
 I +ERR<0 D ERROR(ERR,DFN)
"RTN","VAFCCCAP",67,0)
 D KILL^HLTRANS
"RTN","VAFCCCAP",68,0)
 Q
"RTN","VAFCCCAP",69,0)
 ;
"RTN","VAFCCCAP",70,0)
ERROR(PNUM,DFN) ;
"RTN","VAFCCCAP",71,0)
 ;Error message unable to generate A08 Message
"RTN","VAFCCCAP",72,0)
 N GBL S GBL="^TMP($J,""ERR"")"
"RTN","VAFCCCAP",73,0)
 I +PNUM<0 S @GBL@(0)="ERROR",@GBL@(1)=$P(PNUM,"^",2)_", unable to generate A08 Message" D EBULL^VAFHUTL2(DFN,EVDT,"",$P(GBL,")")_",")
"RTN","VAFCCCAP",74,0)
 Q
"RTN","VAFCCCAP",75,0)
 ;
"RTN","VAFCCCAP",76,0)
UPPTR(DFN,ADATE) ;
"RTN","VAFCCCAP",77,0)
 ;Have deleted checkout, update variable pointer
"RTN","VAFCCCAP",78,0)
 N PTR S PTR="@"
"RTN","VAFCCCAP",79,0)
 N DGARRAY,DGCOUNT,SDDATE
"RTN","VAFCCCAP",80,0)
 S DGARRAY(4)=DFN,DGARRAY(1)=ADATE_";"_ADATE,DGARRAY("FLDS")=3,DGARRAY("SORT")="P"
"RTN","VAFCCCAP",81,0)
 S DGCOUNT=$$SDAPI^SDAMA301(.DGARRAY)
"RTN","VAFCCCAP",82,0)
 ;
"RTN","VAFCCCAP",83,0)
 I DGCOUNT>0 D
"RTN","VAFCCCAP",84,0)
 .S SDDATE=0
"RTN","VAFCCCAP",85,0)
 .F  S SDDATE=$O(^TMP($J,"SDAMA301",DFN,SDDATE)) Q:'SDDATE  D
"RTN","VAFCCCAP",86,0)
 ..I SDDATE=ADATE S PTR=DFN_";DPT("
"RTN","VAFCCCAP",87,0)
 I DGCOUNT'=0 K ^TMP($J,"SDAMA301")
"RTN","VAFCCCAP",88,0)
 Q PTR
"RTN","VAFCCCAP",89,0)
 ;
"RTN","VAFCCCAP",90,0)
SETUP ;
"RTN","VAFCCCAP",91,0)
 N PIVOTPTR
"RTN","VAFCCCAP",92,0)
 ;S EVENT=$P(HLD,":")
"RTN","VAFCCCAP",93,0)
 S EVNTINFO="^TMP(""VAFCMSG"",""EVNTINFO"","_$J_")"
"RTN","VAFCCCAP",94,0)
 K @EVNTINFO
"RTN","VAFCCCAP",95,0)
 S PIVOTPTR=+$O(^VAT(391.71,"D",+EVENT,0))
"RTN","VAFCCCAP",96,0)
 I ('PIVOTPTR) S ERR="-1^Unable to create entry in ADT/HL7 PIVOT FILE" Q
"RTN","VAFCCCAP",97,0)
 S @EVNTINFO@("PIVOT")=PIVOTPTR
"RTN","VAFCCCAP",98,0)
 S @EVNTINFO@("SERVER PROTOCOL")="VAFC ADT-A08-SDAM SERVER"
"RTN","VAFCCCAP",99,0)
 S @EVNTINFO@("VAR-PTR")=PTR
"RTN","VAFCCCAP",100,0)
 S @EVNTINFO@("EVENT-NUM")=EVENT
"RTN","VAFCCCAP",101,0)
 S ERR=$$BCSTADT^VAFCMSG0(DFN,"A08",EVDT,EVNTINFO)
"RTN","VAFCCCAP",102,0)
 K @EVNTINFO
"RTN","VAFCCCAP",103,0)
 Q
"RTN","VAFCCCAP",104,0)
PROTOCHK(SPROTO) ;
"RTN","VAFCCCAP",105,0)
 ; input   server protocol
"RTN","VAFCCCAP",106,0)
 ;output   1 if disabled or has no clients
"RTN","VAFCCCAP",107,0)
 N HL
"RTN","VAFCCCAP",108,0)
 D INIT^HLFNC2(SPROTO,.HL,1)
"RTN","VAFCCCAP",109,0)
 K HLQ,HLECH,HLFS
"RTN","VAFCCCAP",110,0)
 Q $D(HL)#2
"VER")
8.0^22.0
"BLD",7148,6)
^666
**END**
**END**
