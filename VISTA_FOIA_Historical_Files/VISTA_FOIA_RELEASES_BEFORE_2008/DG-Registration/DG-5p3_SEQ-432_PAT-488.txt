$TXT Created by NAPOLIELLO,GREG at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Tuesday, 02/04/03 at 14:11
=============================================================================
Run Date: FEB 26, 2003                     Designation: DG*5.3*488
Package : DG - REGISTRATION                    Priority: Mandatory
Version : 5.3       SEQ #432                     Status: Released
                  Compliance Date: MAR 29, 2003
=============================================================================


Subject: Cleanup partially stubbed MT files

Category: 
  - Routine

Description: 
============

 Developed in MNT,VBB
 Addresses NOIS: NIN-0802-40682,FNC-0802-31111
  
 This patch will cleanup the partially stubbed files that were a result of
 a errored Means Test Upload process.  The three files involved in the 
 errored process are the PATIENT RELATION (#408.12), INCOME RELATION 
 (#408.22), and the INDIVIDUAL ANNUAL INCOME (#408.21) files.
  
 When the process errored, it either left a 408.12 or 408.22 record
 partially stubbed in, and the process ended at that point.  Depending on
 whether it ended with a partially stubbed "BAD" 408.12 or 408.22 record,
 there could be a related 408.21 record pointing to a 408.12 record.
  
 When a "BAD" 408.12 record is found, it will be deleted. If there is a
 408.21 record pointing to this "BAD" 408.12 record, then it will also be
 deleted.  If there is a 408.22 record pointing to the 408.21 just deleted,
 then it will also be deleted.  If there is only a "BAD" 408.22 record,
 then it will be deleted only, for there are no other files pointing to
 this file.
  
 The cleanup, will also, be looking for "BAD" 408.21 records not associated
 with the two error conditions above.  In this case, the 408.21 record is
 "BAD" by virtue of no 408.22 record pointing to it.  This 408.21 record
 will be deleted and then the pointed to 408.12 record will be looked at to
 see if no other 408.21 record is currently pointing to it.  In that case,
 the 408.12 record can be deleted as well.
  
 Any bad cross references to the three files found, while searching for
 the "BAD" records above, will be deleted.
  
 When the process has completed you should get a mail message similar to 
 the one below.  The word ** TESTING ** will only be there, if you ran the 
 testing option.  The Live option will omit this and the records will 
 actually be deleted.
  
  
  New Menu with Option Summary:
  =============================
  
   DG488 * CLEANUP MAIN MENU *       408 Files Cleanup
  
       This New Menu contains 3 New options for testing, running, and
       and monitoring the cleanup process.  See these below.  The Test and 
       Run options may be stopped by accessing the Taskman User menu 
       and stopping the taskid assigned when the job is started.  The jobs
       may be re-started simply by executing the options again and they
       will resume at the point they were stopped.
  
  
    TST    Test of Cleanup Patient Relation/Income files
                   [DG488 TEST CLEANUP 408 FILES]
  
            This option will prompt you to task the job NOW or you may key
            in a later time and date to begin the job.  This option will
            run the job in the same way as the RUN option, however, no
            records will actually be set to query Austin.  The XTMP global
            will be created however.  If you wish to run this option first
            and look at the XTMP global prior to the live RUN option, then
            you may do so with no ill effects. Just remember when you
            execute the RUN menu option, it will say it has been
            completed.  You should elect to re-run this option as seen
            below in the COMPLETED EXAMPLE.
  
    RUN    Cleanup Patient Relation/Income files (Live)
                   [DG488 CLEANUP 408 FILES]
  
            This option will prompt you to task the job NOW or you may key
            in a later time and date to begin the job.  It will also inform
            you if the job is "Already Running" or has been "Completed" and
            prompt whether to re-run again or not.
  
    MON    Monitor the Cleanup of the 408 files
                   [DG488 MONITOR 408 CLEANUP]
  
            This option will monitor the process while it is running.  See
            the MONITOR EXAMPLE below.
  
  
  Examples
  ========
  
     ********* COMPLETED PROMPT EXAMPLE *********
  
 Cleanup Patient Relation & Income Files
  was COMPLETED on Dec 17, 2002@15:07:03 in TEST mode
   Do you want to Re-Run in LIVE mode?
 Enter Yes or No: YES
   ARE YOU SURE?
 Enter Yes or No: YES
  
  
   Note: you can re-run this job, after answering Yes twice.  This will
   delete the saved XTMP global and begin a new one.
  
     ********* COMPLETED PROMPT EXAMPLE END *********
  
  
     ********* MAIL MESSAGE EXAMPLE *********
  
 Subj: Cleanup Patient Relation & Income Files COMPLETED on Feb 04, 
 2003
 [#399155] 02/04/03@11:34  16 lines
 From: POSTMASTER  In 'IN' basket.   Page 1
 --------------------------------------------------------------------------
 Cleanup Patient Relation & Income Files COMPLETED on Feb 04, 2003@11:34:55
 Elapsed time:  0:00:09
  
 ** TESTING **
  
      Total 408.12 Records Processed:       3,249
           408.12 bad records purged:           8
         408.12 bad 'B' xrefs purged:           0
  
      Total 408.21 Records Processed:       6,450
           408.21 bad records purged:          85
         408.21 bad 'B' xrefs purged:           1
  
      Total 408.22 Records Processed:       6,473
           408.22 bad records purged:           1
         408.22 bad 'B' xrefs purged:           0
  
 Enter message action (in IN basket): Ignore//
  
  
     ********* MAIL MESSAGE EXAMPLE END *********
  
  
 Note: this message has "** TESTING **" printed.  This means the test
   option was used and the records were not actually purged, but will be
   for the live RUN option.
  
  
  
    ********* MONITOR EXAMPLE *********
  
 2/4/03 2:13:16 pm               ** TEST MODE **            Task ID: 618565
  
                     Cleanup Patient Relation & Income Files
  
  
    Status                    Last ien                  Completed Time
    COMPLETED             408.22/9999955556             2/4/03@13:27:33
  
     Tot 408.12 recs         408.12 recs purged       408.12 bad xrefs
            3,249                      8                        0
  
     Tot 408.21 recs         408.21 recs purged       408.21 bad xrefs
            6,450                     85                        1
  
     Tot 408.22 recs         408.22 recs purged       408.22 bad xrefs
            6,473                      1                        0
  
  
              screen refreshes automatically every 5 seconds
  
 Press <Enter> to Stop Monitor...
  
    ********* MONITOR EXAMPLE END *********
  
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
      <tab>;;5.3;REGISTRATION;**[patch list]**;5-1-2001
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  DG488                      N/A             12993402             488
  DG488M                     N/A              6615957             488
  
  
   INSTALLATION INSTRUCTIONS:
   ==========================
  
      This patch can be installed with users on the system. Installation
      will take less than 2 minutes.
  
       1. Review your mapped set.  If any of the routines listed in the
          ROUTINE SUMMARY section are mapped, they should be removed from
          the mapped set at this time.
  
       2. Use the INSTALL/CHECK MESSAGE option on the PackMan menu. [Note:
          TEXT PRINT/DISPLAY option in the PackMan menu will display the
          patch text only].
  
       3. From this menu, you may elect to use the below options, which are
          recommended, prior to selecting option "6   Install Package(s)".
          (whenever prompted for INSTALL NAME, enter DG*5.3*488)
  
          a.  Compare Transport Global to Current System  - this option 
              will allow you to view all changes that will be made when the
              patch is installed.  It compares all components of the patch,
              (routines, DDs, templates, etc.).
          b.  Verify Checksums in Transport Global - this option will allow
              you to ensure the integrity of the routines that are in the
              transport global.
          c.  Print Transport Global - this option will allow you to view
              the components of the KIDS build.
  
       4. Select option "6   Install Package(s)", to begin the install.
  
       5. When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
          Install? YES//', respond NO.
  
       6. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
          YES//', respond NO.
  
       7. When prompted 'Want to DISABLE Scheduled Options, Menu Options,
          and Protocols? YES//', respond NO.
  
       8. If routines were unmapped as part of step 2, they should be
          returned to the mapped set once the installation has run to
          completion.
  
 Post Installation Instructions:
 ===============================
  
   1. IRM staff, please assign the new menu and menu options to the
      appropriate staff.
  
   2. Please note, the cleanup contained in this patch, is not
      automatically run upon installation.  It needs to be executed
      manually, by the new menu and options.

Routine Information:
====================

Routine Name:
  - DG488


Routine Checksum:

Routine Name:
  - DG488M


Routine Checksum:

=============================================================================
User Information:                               
Entered By  : NAPOLIELLO,GREG                Date Entered : NOV 26, 2002
Completed By: MULLER,RICHARD                Date Completed: FEB 24, 2003
Released By : NELSON,VICKI M               Date Released : FEB 26, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
