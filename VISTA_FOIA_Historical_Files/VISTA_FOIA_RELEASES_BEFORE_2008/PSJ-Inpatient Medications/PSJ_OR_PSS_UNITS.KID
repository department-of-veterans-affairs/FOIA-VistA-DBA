KIDS Distribution saved on Oct 26, 2005@13:36:02
PSJ, OR, PSS ROUTINES FOR ADDED UNITS
**KIDS**:OR*3.0*237^PSJ*5.0*152^PSS*1.0*100^

**INSTALL NAME**
OR*3.0*237
"BLD",6317,0)
OR*3.0*237^ORDER ENTRY/RESULTS REPORTING^0^3051026^y
"BLD",6317,1,0)
^^2^2^3050719^
"BLD",6317,1,1,0)
This the OR part of a multi package patch to add Additional IV Drug Units
"BLD",6317,1,2,0)
- MG-PE & NANOGRAM the primary patch will be in PSJ*5.0*152.
"BLD",6317,4,0)
^9.64PA^^0
"BLD",6317,"INID")
^y
"BLD",6317,"INIT")
ORY237
"BLD",6317,"KRN",0)
^9.67PA^8989.52^19
"BLD",6317,"KRN",.4,0)
.4
"BLD",6317,"KRN",.401,0)
.401
"BLD",6317,"KRN",.402,0)
.402
"BLD",6317,"KRN",.403,0)
.403
"BLD",6317,"KRN",.5,0)
.5
"BLD",6317,"KRN",.84,0)
.84
"BLD",6317,"KRN",3.6,0)
3.6
"BLD",6317,"KRN",3.8,0)
3.8
"BLD",6317,"KRN",9.2,0)
9.2
"BLD",6317,"KRN",9.8,0)
9.8
"BLD",6317,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6317,"KRN",9.8,"NM",1,0)
ORBCMA32^^0^72900318
"BLD",6317,"KRN",9.8,"NM",2,0)
ORMBLDPS^^0^64023711
"BLD",6317,"KRN",9.8,"NM",3,0)
ORWDPS32^^0^80350069
"BLD",6317,"KRN",9.8,"NM","B","ORBCMA32",1)

"BLD",6317,"KRN",9.8,"NM","B","ORMBLDPS",2)

"BLD",6317,"KRN",9.8,"NM","B","ORWDPS32",3)

"BLD",6317,"KRN",19,0)
19
"BLD",6317,"KRN",19,"NM",0)
^9.68A^^
"BLD",6317,"KRN",19.1,0)
19.1
"BLD",6317,"KRN",101,0)
101
"BLD",6317,"KRN",409.61,0)
409.61
"BLD",6317,"KRN",771,0)
771
"BLD",6317,"KRN",870,0)
870
"BLD",6317,"KRN",8989.51,0)
8989.51
"BLD",6317,"KRN",8989.52,0)
8989.52
"BLD",6317,"KRN",8994,0)
8994
"BLD",6317,"KRN","B",.4,.4)

"BLD",6317,"KRN","B",.401,.401)

"BLD",6317,"KRN","B",.402,.402)

"BLD",6317,"KRN","B",.403,.403)

"BLD",6317,"KRN","B",.5,.5)

"BLD",6317,"KRN","B",.84,.84)

"BLD",6317,"KRN","B",3.6,3.6)

"BLD",6317,"KRN","B",3.8,3.8)

"BLD",6317,"KRN","B",9.2,9.2)

"BLD",6317,"KRN","B",9.8,9.8)

"BLD",6317,"KRN","B",19,19)

"BLD",6317,"KRN","B",19.1,19.1)

"BLD",6317,"KRN","B",101,101)

"BLD",6317,"KRN","B",409.61,409.61)

"BLD",6317,"KRN","B",771,771)

"BLD",6317,"KRN","B",870,870)

"BLD",6317,"KRN","B",8989.51,8989.51)

"BLD",6317,"KRN","B",8989.52,8989.52)

"BLD",6317,"KRN","B",8994,8994)

"BLD",6317,"PRET")

"BLD",6317,"QUES",0)
^9.62^^
"BLD",6317,"REQB",0)
^9.611^2^2
"BLD",6317,"REQB",1,0)
OR*3.0*133^2
"BLD",6317,"REQB",2,0)
OR*3.0*195^2
"BLD",6317,"REQB","B","OR*3.0*133",1)

"BLD",6317,"REQB","B","OR*3.0*195",2)

"INIT")
ORY237
"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
237^3051026^33234
"PKG",167,22,1,"PAH",1,1,0)
^^2^2^3051026
"PKG",167,22,1,"PAH",1,1,1,0)
This the OR part of a multi package patch to add Additional IV Drug Units
"PKG",167,22,1,"PAH",1,1,2,0)
- MG-PE & NANOGRAM the primary patch will be in PSJ*5.0*152.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORBCMA32")
0^1^B72900318
"RTN","ORBCMA32",1,0)
ORBCMA32 ; SLC/JLI - Pharmacy Calls for GUI Dialog ;01/17/02
"RTN","ORBCMA32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133,237**;Dec 17, 1997
"RTN","ORBCMA32",3,0)
 ;;BCMA ORDER V1.0 ;**133,237**;Jan 17, 2002
"RTN","ORBCMA32",4,0)
 ;
"RTN","ORBCMA32",5,0)
NXT() ; -- returns next available index in return data array
"RTN","ORBCMA32",6,0)
 S ILST=ILST+1
"RTN","ORBCMA32",7,0)
 Q ILST
"RTN","ORBCMA32",8,0)
 ;
"RTN","ORBCMA32",9,0)
DLGSLCT(LST,PSTYPE) ; return default lists for dialog
"RTN","ORBCMA32",10,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORBCMA32",11,0)
 N ILST S ILST=0
"RTN","ORBCMA32",12,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORBCMA32",13,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORBCMA32",14,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",15,0)
 ;
"RTN","ORBCMA32",16,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpatient
"RTN","ORBCMA32",17,0)
 S LST($$NXT)="~Schedules"  D SCHED
"RTN","ORBCMA32",18,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",19,0)
 I PSTYPE="O" D                          ; Outpatient
"RTN","ORBCMA32",20,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORBCMA32",21,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORBCMA32",22,0)
 Q
"RTN","ORBCMA32",23,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORBCMA32",24,0)
 ; !!! change this so that it uses the ORWDXQ call!!!
"RTN","ORBCMA32",25,0)
 N I,X,TMP
"RTN","ORBCMA32",26,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORBCMA32",27,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORBCMA32",28,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORBCMA32",29,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORBCMA32",30,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORBCMA32",31,0)
 Q
"RTN","ORBCMA32",32,0)
SCHED ; from DLGSLCT, get all pharmacy administration schedules
"RTN","ORBCMA32",33,0)
 N X
"RTN","ORBCMA32",34,0)
 S X="" F  S X=$O(^PS(51.1,"APPSJ",X)) Q:X=""  S LST($$NXT)="i"_X
"RTN","ORBCMA32",35,0)
 Q
"RTN","ORBCMA32",36,0)
SCHEDA ; (similar to SCHED, but also returns administration times)
"RTN","ORBCMA32",37,0)
 N X,IEN,SCH
"RTN","ORBCMA32",38,0)
 S SCH="" F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORBCMA32",39,0)
 . S IEN=0 F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORBCMA32",40,0)
 . . S X=^PS(51.1,IEN,0) S X=$S($L($P(X,U,2)):"  ("_$P(X,U,2)_")",1:"")
"RTN","ORBCMA32",41,0)
 . . S LST($$NXT)="i"_IEN_U_SCH_X
"RTN","ORBCMA32",42,0)
 Q
"RTN","ORBCMA32",43,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORBCMA32",44,0)
 N X,XREF
"RTN","ORBCMA32",45,0)
 S X=0
"RTN","ORBCMA32",46,0)
 S X=$O(^ORD(101.42,"B","DONE",X))
"RTN","ORBCMA32",47,0)
 S LST($$NXT)="i"_X_U_$P(^ORD(101.42,X,0),U,2)
"RTN","ORBCMA32",48,0)
 Q
"RTN","ORBCMA32",49,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORBCMA32",50,0)
 N X,EDITONLY
"RTN","ORBCMA32",51,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORBCMA32",52,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORBCMA32",53,0)
 Q
"RTN","ORBCMA32",54,0)
DEFPICK()       ; return default routing
"RTN","ORBCMA32",55,0)
 N X,DLG,PRMT
"RTN","ORBCMA32",56,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORBCMA32",57,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORBCMA32",58,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORBCMA32",59,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORBCMA32",60,0)
 ;
"RTN","ORBCMA32",61,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORBCMA32",62,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORBCMA32",63,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORBCMA32",64,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORBCMA32",65,0)
 I X="N" S X=""             G XPICK
"RTN","ORBCMA32",66,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORBCMA32",67,0)
XPICK Q X
"RTN","ORBCMA32",68,0)
 ;
"RTN","ORBCMA32",69,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORBCMA32",70,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORBCMA32",71,0)
 Q
"RTN","ORBCMA32",72,0)
 ;
"RTN","ORBCMA32",73,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; return for defaults for pharmacy orderable item
"RTN","ORBCMA32",74,0)
 N ILST S ILST=0
"RTN","ORBCMA32",75,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",76,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORBCMA32",77,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORBCMA32",78,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORBCMA32",79,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORBCMA32",80,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORBCMA32",81,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",82,0)
 Q
"RTN","ORBCMA32",83,0)
 ;
"RTN","ORBCMA32",84,0)
DISPDRUG(LST,OI) ; list dispense drugs for an orderable item
"RTN","ORBCMA32",85,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORBCMA32",86,0)
 Q
"RTN","ORBCMA32",87,0)
 ;
"RTN","ORBCMA32",88,0)
DISPDRG ; from OISLCT, get dispense drugs for this pharmacy orderable item
"RTN","ORBCMA32",89,0)
 N I,ORTMP,ORX
"RTN","ORBCMA32",90,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORBCMA32",91,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORBCMA32",92,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",93,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORBCMA32",94,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORBCMA32",95,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORBCMA32",96,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORBCMA32",97,0)
 Q
"RTN","ORBCMA32",98,0)
INSTRCT ; from OISLCT, get list of potential instructions (based on drug form)
"RTN","ORBCMA32",99,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORBCMA32",100,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORBCMA32",101,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORBCMA32",102,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORBCMA32",103,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORBCMA32",104,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORBCMA32",105,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORBCMA32",106,0)
 S LST($$NXT)="~Nouns"
"RTN","ORBCMA32",107,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORBCMA32",108,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORBCMA32",109,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORBCMA32",110,0)
 ;
"RTN","ORBCMA32",111,0)
 Q
"RTN","ORBCMA32",112,0)
MIXED(X)   ; Return mixed case
"RTN","ORBCMA32",113,0)
 Q X  ;$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ORBCMA32",114,0)
 ;
"RTN","ORBCMA32",115,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORBCMA32",116,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORBCMA32",117,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORBCMA32",118,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",119,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",120,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORBCMA32",121,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORBCMA32",122,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",123,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",124,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORBCMA32",125,0)
 Q
"RTN","ORBCMA32",126,0)
MESSAGE ; message
"RTN","ORBCMA32",127,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORBCMA32",128,0)
 Q
"RTN","ORBCMA32",129,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORBCMA32",130,0)
 N I,X,ILST S ILST=0
"RTN","ORBCMA32",131,0)
 S I=0 F  S I=$O(^PS(51.2,I)) Q:'I  S X=^(I,0) D
"RTN","ORBCMA32",132,0)
 . I $P(X,U,4) S LST($$NXT)=I_U_$P(X,U)_U_$P(X,U,3)
"RTN","ORBCMA32",133,0)
 Q
"RTN","ORBCMA32",134,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORBCMA32",135,0)
 N ORLST,ABBR
"RTN","ORBCMA32",136,0)
 D FIND^DIC(51.2,"",1,"MO",X,1,,"I $P(^(0),U,4)=1",,"ORLST")
"RTN","ORBCMA32",137,0)
 I 'ORLST("DILIST",0) S REC=0 Q
"RTN","ORBCMA32",138,0)
 S X=$$UPPER(X),ABBR=ORLST("DILIST","ID",1,1)
"RTN","ORBCMA32",139,0)
 I '$L(ABBR) S ABBR=ORLST("DILIST",1,1)
"RTN","ORBCMA32",140,0)
 I ($$UPPER(ORLST("DILIST",1,1))'=X),($$UPPER(ABBR)'=X) S REC=0 Q
"RTN","ORBCMA32",141,0)
 S REC=ORLST("DILIST",2,1)_U_ABBR
"RTN","ORBCMA32",142,0)
 Q
"RTN","ORBCMA32",143,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORBCMA32",144,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORBCMA32",145,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORBCMA32",146,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORBCMA32",147,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORBCMA32",148,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORBCMA32",149,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORBCMA32",150,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORBCMA32",151,0)
 Q
"RTN","ORBCMA32",152,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORBCMA32",153,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORBCMA32",154,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORBCMA32",155,0)
 Q
"RTN","ORBCMA32",156,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORBCMA32",157,0)
 S VAL=0
"RTN","ORBCMA32",158,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORBCMA32",159,0)
 Q
"RTN","ORBCMA32",160,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORBCMA32",161,0)
 S VAL=0
"RTN","ORBCMA32",162,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORBCMA32",163,0)
 Q
"RTN","ORBCMA32",164,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORBCMA32",165,0)
 N I,PSOI,ORWY,AMT,IVFLAG
"RTN","ORBCMA32",166,0)
 S IVFLAG=$P(OI,U,2)
"RTN","ORBCMA32",167,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORBCMA32",168,0)
 I IVFLAG="NF" D ENVOL2^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",169,0)
 I IVFLAG="" D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",170,0)
 I ORWTYP="B" D
"RTN","ORBCMA32",171,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))=""
"RTN","ORBCMA32",172,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORBCMA32",173,0)
 I ORWTYP="A" D
"RTN","ORBCMA32",174,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORBCMA32",175,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM"
"RTN","ORBCMA32",176,0)
 Q
"RTN","ORBCMA32",177,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORBCMA32",178,0)
 I $E($RE($$UPPER(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORBCMA32",179,0)
 S X=$$TRIM(X)
"RTN","ORBCMA32",180,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",181,0)
 Q
"RTN","ORBCMA32",182,0)
UPPER(X) ; return uppercase
"RTN","ORBCMA32",183,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORBCMA32",184,0)
 ;
"RTN","ORBCMA32",185,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORBCMA32",186,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORBCMA32",187,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORBCMA32",188,0)
 Q X
"RTN","ORBCMA32",189,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORBCMA32",190,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORBCMA32",191,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORBCMA32",192,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORBCMA32",193,0)
 S VAL=1
"RTN","ORBCMA32",194,0)
XSCSTS Q
"RTN","ORBCMA32",195,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORBCMA32",196,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORBCMA32",197,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORBCMA32",198,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORBCMA32",199,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA32",200,0)
 Q
"RTN","ORBCMA32",201,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORBCMA32",202,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORBCMA32",203,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORBCMA32",204,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORBCMA32",205,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORBCMA32",206,0)
 E  D
"RTN","ORBCMA32",207,0)
 . D EN^PSSGSGUI
"RTN","ORBCMA32",208,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",209,0)
 Q
"RTN","ORBCMA32",210,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORBCMA32",211,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORBCMA32",212,0)
 ; this is based on the input transform from 52,7
"RTN","ORBCMA32",213,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORBCMA32",214,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",215,0)
 Q
"RTN","ORBCMA32",216,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORBCMA32",217,0)
 N ORTMP,ORI,ORJ,ILST,NDF,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORBCMA32",218,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",219,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORBCMA32",220,0)
 . S NDF=$G(^PSDRUG(+ORWDRG,"ND")),VAPN=$P(NDF,U,3),NDF=+NDF
"RTN","ORBCMA32",221,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORBCMA32",222,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORBCMA32",223,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORBCMA32",224,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORBCMA32",225,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORBCMA32",226,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORBCMA32",227,0)
 Q
"RTN","ORMBLDPS")
0^2^B64023711
"RTN","ORMBLDPS",1,0)
ORMBLDPS ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;11:26 AM  2 Apr 2001
"RTN","ORMBLDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,38,54,86,97,94,116,129,141,190,195,237**;Dec 17, 1997
"RTN","ORMBLDPS",3,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDPS",4,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDPS",5,0)
 ;
"RTN","ORMBLDPS",6,0)
NVA ; -- new Non-VA Meds order
"RTN","ORMBLDPS",7,0)
 N NVA S NVA=1
"RTN","ORMBLDPS",8,0)
OUT ; -- new Outpt Meds order
"RTN","ORMBLDPS",9,0)
 ;    fall through to UD: same msg, +3 fields
"RTN","ORMBLDPS",10,0)
UD ; -- new Inpt (Unit Dose) Meds order
"RTN","ORMBLDPS",11,0)
 N OI,DRUG,INSTR,DOSE,ROUTE,SCHED,DUR,URG,PROVCOMM,PI,DISPENSE,X,Y,I,J,K,L,QT1,QT2,QT3,QT4,QT6,QT9,CONJ,ORC,SC,OUTPT
"RTN","ORMBLDPS",12,0)
 S OUTPT=$S($P(OR0,U,12)="O":1,1:0) ;outpt flag
"RTN","ORMBLDPS",13,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",14,0)
 S OI=$$PTR("ORDERABLE ITEM"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMBLDPS",15,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE")
"RTN","ORMBLDPS",16,0)
 S DUR=$$PTR("DURATION"),URG=$$PTR("URGENCY"),DOSE=$$PTR("DOSE")
"RTN","ORMBLDPS",17,0)
 S ROUTE=$$PTR("ROUTE"),PROVCOMM=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDPS",18,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMBLDPS",19,0)
 S J=1,ORC(J)=$P(ORMSG(4),"|",1,7)_"|"
"RTN","ORMBLDPS",20,0)
 I +$G(NVA)=1 G NVA1
"RTN","ORMBLDPS",21,0)
UD1 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D
"RTN","ORMBLDPS",22,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",23,0)
 . ;S QT1=$S($L(X):$P(X,"&",1,4)_"&"_$P(X,"&",6),1:"")
"RTN","ORMBLDPS",24,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",25,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",26,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",27,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",28,0)
 ;
"RTN","ORMBLDPS",29,0)
NVA1 I +$G(NVA)=1 D
"RTN","ORMBLDPS",30,0)
 . S I=1 ;only one dosage possible for non-va meds
"RTN","ORMBLDPS",31,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",32,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",33,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",34,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",35,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",36,0)
 ;
"RTN","ORMBLDPS",37,0)
 I $L($P(OR0,U,8)) S $P(ORC(2),U,4)=$$FMTHL7^XLFDT($P(OR0,U,8)) S:J<2 J=2
"RTN","ORMBLDPS",38,0)
 S J=J+1,ORC(J)="|"_$P(ORMSG(4),"|",9,999),ORC=J,X="ORMSG(4)",ORMSG(4)="",I=0
"RTN","ORMBLDPS",39,0)
 F J=1:1:ORC S Y=ORC(J) D  ;add to ORMSG(4)
"RTN","ORMBLDPS",40,0)
 . I $L(@X)+$L(Y)'>245 S @X=@X_Y
"RTN","ORMBLDPS",41,0)
 . E  S L=245-$L(@X),@X=@X_$E(Y,1,L),I=I+1,X="ORMSG(4,"_I_")",@X=$E(Y,L+1,$L(Y))
"RTN","ORMBLDPS",42,0)
 I $G(ORDIALOG(DRUG,1)) S X=$$ENDCM^PSJORUTL(ORDIALOG(DRUG,1)),DISPENSE=$P(X,U,3)_"^^99NDF^"_ORDIALOG(DRUG,1)_"^^99PSD"
"RTN","ORMBLDPS",43,0)
 S ORMSG(5)="RXO|"_$$USID^ORMBLD($G(ORDIALOG(OI,1)))_"|||||||||"_$G(DISPENSE)
"RTN","ORMBLDPS",44,0)
UD2 I $G(OUTPT) D
"RTN","ORMBLDPS",45,0)
 . N QTY,REFS,DSPY
"RTN","ORMBLDPS",46,0)
 . S QTY=$$PTR("QUANTITY"),REFS=$$PTR("REFILLS"),DSPY=$$PTR("DAYS SUPPLY")
"RTN","ORMBLDPS",47,0)
 . S ORMSG(5)=ORMSG(5)_"|"_$G(ORDIALOG(QTY,1))_"||"_$G(ORDIALOG(REFS,1))_"||||D"_$G(ORDIALOG(DSPY,1))
"RTN","ORMBLDPS",48,0)
 S I=5 I $L($G(ORDIALOG(PROVCOMM,1))) D
"RTN","ORMBLDPS",49,0)
 . S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,0)) Q:'J
"RTN","ORMBLDPS",50,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,PROVCOMM,1,J,0))
"RTN","ORMBLDPS",51,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=$G(^(J,0))
"RTN","ORMBLDPS",52,0)
 I $G(OUTPT),$L($G(ORDIALOG(PI,1))) D
"RTN","ORMBLDPS",53,0)
 . S J=$O(^TMP("ORWORD",$J,PI,1,0)) Q:'J
"RTN","ORMBLDPS",54,0)
 . S I=I+1,ORMSG(I)="NTE|7|P|"_$G(^TMP("ORWORD",$J,PI,1,J,0))
"RTN","ORMBLDPS",55,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PI,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=$G(^(J,0))
"RTN","ORMBLDPS",56,0)
UD3 S J=0 F  S J=$O(ORDIALOG(ROUTE,J)) Q:J'>0  S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,J)))
"RTN","ORMBLDPS",57,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",58,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",59,0)
 I $G(OUTPT) D  ;add SC data
"RTN","ORMBLDPS",60,0)
 . N OR5 S OR5=$G(^OR(100,IFN,5))
"RTN","ORMBLDPS",61,0)
 . I $L(OR5),OR5'?5"^" S I=I+1,ORMSG(I)="ZSC|"_$TR(OR5,"^","|") Q
"RTN","ORMBLDPS",62,0)
 . S SC=$$PTR("SERVICE CONNECTED") S:$D(ORDIALOG(SC,1)) I=I+1,ORMSG(I)="ZSC|"_$S(ORDIALOG(SC,1):"SC",1:"NSC")
"RTN","ORMBLDPS",63,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",64,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",65,0)
 I $P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORMBLDPS",66,0)
 . S I=I+1 D ZRN(IFN,.ORMSG,I)
"RTN","ORMBLDPS",67,0)
 Q
"RTN","ORMBLDPS",68,0)
 ;
"RTN","ORMBLDPS",69,0)
INSTR()  ; -- Return text instructions for QT-8, instance I
"RTN","ORMBLDPS",70,0)
 N Y S Y=$P($G(ORDIALOG(DOSE,I)),"&",5)
"RTN","ORMBLDPS",71,0)
 I $G(ORDIALOG(DRUG,1)),$L(Y) Q Y
"RTN","ORMBLDPS",72,0)
 S Y=$G(ORDIALOG(INSTR,I)) I $G(OUTPT) D
"RTN","ORMBLDPS",73,0)
 . N UNITS,UNT S UNITS=$$PTR("FREE TEXT"),UNT=$G(ORDIALOG(UNITS,I))
"RTN","ORMBLDPS",74,0)
 . S:$L(UNT) Y=Y_" "_UNT ;old format
"RTN","ORMBLDPS",75,0)
 Q Y
"RTN","ORMBLDPS",76,0)
 ;
"RTN","ORMBLDPS",77,0)
HL7DUR()  ; -- Returns HL7 form of duration X
"RTN","ORMBLDPS",78,0)
 N X,X1,X2,Y S X=$G(ORDIALOG(DUR,I))
"RTN","ORMBLDPS",79,0)
 S X1=+$G(X),Y="" G:X1'>0 HDQ
"RTN","ORMBLDPS",80,0)
 S X2=$$UP^XLFSTR($P(X,X1,2)) S:$E(X2)=" " X2=$E(X2,2,99)
"RTN","ORMBLDPS",81,0)
 S Y=$S($E(X2,1,2)="MO":"L",'$L(X2):"D",1:$E(X2))_X1
"RTN","ORMBLDPS",82,0)
HDQ Q Y
"RTN","ORMBLDPS",83,0)
 ;
"RTN","ORMBLDPS",84,0)
IV ; -- new IV Meds order
"RTN","ORMBLDPS",85,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,WP,QT,I,X1,X2,INST
"RTN","ORMBLDPS",86,0)
 N IVLIMIT ; duratioin or total volume for IV order
"RTN","ORMBLDPS",87,0)
 S IVLIMIT=$$PTR("DURATION")
"RTN","ORMBLDPS",88,0)
 S RATE=$$PTR("INFUSION RATE"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMBLDPS",89,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMBLDPS",90,0)
 S WP=$$PTR("WORD PROCESSING 1"),VOL=$$PTR("VOLUME")
"RTN","ORMBLDPS",91,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDPS",92,0)
 S QT=U_$G(ORDIALOG(+$$PTR("SCHEDULE"),1))_"^^^^"
"RTN","ORMBLDPS",93,0)
 S:URG QT=QT_$P($G(^ORD(101.42,URG,0)),U,2) S $P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDPS",94,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",95,0)
 S RATE=$G(ORDIALOG(RATE,1)) S:$E(RATE,$L(RATE))=" " RATE=$E(RATE,1,($L(RATE)-1)) S ORMSG(5)="RXO|^^^PS-1^IV^99OTH|"_RATE ;strip any trailing spaces
"RTN","ORMBLDPS",96,0)
 S IVLIMIT=$G(ORDIALOG(IVLIMIT,1))
"RTN","ORMBLDPS",97,0)
 I $L(IVLIMIT) S IVLIMIT=$$HL7IVLMT(IVLIMIT),ORMSG(5)="RXO|^^"_IVLIMIT_"^PS-1^IV^99OTH|"_RATE
"RTN","ORMBLDPS",98,0)
 S I=5 I $L($G(ORDIALOG(WP,1))) D
"RTN","ORMBLDPS",99,0)
 . N J,K S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J
"RTN","ORMBLDPS",100,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,WP,1,J,0))
"RTN","ORMBLDPS",101,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=^(J,0)
"RTN","ORMBLDPS",102,0)
IV1 S INST=0 F  S INST=$O(ORDIALOG(SOLN,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",103,0)
 . S X1="B",X2=+$G(ORDIALOG(SOLN,INST))
"RTN","ORMBLDPS",104,0)
 . I $P($G(^ORD(101.43,X2,"PS")),U,4) S X1=X1_"A" ;pre-mix
"RTN","ORMBLDPS",105,0)
 . S I=I+1,ORMSG(I)="RXC|"_X1_"|"_$$USID^ORMBLD(X2)_"|"_$G(ORDIALOG(VOL,INST))_"|"_$$HL7UNIT("ML")
"RTN","ORMBLDPS",106,0)
 I $O(ORDIALOG(ADDS,0)) D
"RTN","ORMBLDPS",107,0)
 . S INST=0 F  S INST=$O(ORDIALOG(ADDS,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",108,0)
 . . S X1=$G(ORDIALOG(ADDS,INST)),X2=$G(ORDIALOG(UNITS,INST))
"RTN","ORMBLDPS",109,0)
 . . S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)
"RTN","ORMBLDPS",110,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",111,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",112,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",113,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",114,0)
 Q
"RTN","ORMBLDPS",115,0)
 ;
"RTN","ORMBLDPS",116,0)
RXR(ROUTE) ; -- Returns RXR segment
"RTN","ORMBLDPS",117,0)
 N NAME S NAME=$$GET1^DIQ(51.2,+ROUTE_",",.01)
"RTN","ORMBLDPS",118,0)
 Q "RXR|^^^"_+ROUTE_U_NAME_"^99PSR"
"RTN","ORMBLDPS",119,0)
 ;
"RTN","ORMBLDPS",120,0)
ZRX(IFN) ; -- Returns ZRX segment
"RTN","ORMBLDPS",121,0)
 N NATURE,TYPE,ORIG,PSORIG,ZRX
"RTN","ORMBLDPS",122,0)
 S TYPE=$P($G(^OR(100,IFN,3)),U,11),NATURE=$P($G(^(8,1,0)),U,12)
"RTN","ORMBLDPS",123,0)
 S:NATURE NATURE=$P($G(^ORD(100.02,+NATURE,0)),U,2) ;code
"RTN","ORMBLDPS",124,0)
 S PSORIG="" I (TYPE=1)!(TYPE=2) D
"RTN","ORMBLDPS",125,0)
 . S ORIG=$P($G(^OR(100,IFN,3)),U,5),PSORIG=$G(^OR(100,+ORIG,4))
"RTN","ORMBLDPS",126,0)
 . I PSORIG'>0 S PSORIG="",TYPE=0 ;edit of unreleased order
"RTN","ORMBLDPS",127,0)
 S ZRX="ZRX|"_PSORIG_"|"_NATURE_"|"_$S(TYPE=1:"E",TYPE=2:"R",1:"N")
"RTN","ORMBLDPS",128,0)
 I $G(OUTPT) S ZRX=ZRX_"|"_$G(ORDIALOG($$PTR("ROUTING"),1))_$S($L($P($G(^OR(100,ORIFN,8,1,2)),"^",3)):"|||1",1:"")
"RTN","ORMBLDPS",129,0)
 Q ZRX
"RTN","ORMBLDPS",130,0)
 ;
"RTN","ORMBLDPS",131,0)
ZRN(IFN,ORMSG,I) ; -- Set ZRN segment
"RTN","ORMBLDPS",132,0)
 N ST,ZRN,J,K,TXT
"RTN","ORMBLDPS",133,0)
 S ORMSG(I)="ZRN|N|"
"RTN","ORMBLDPS",134,0)
 S ST=$$PTR("STATEMENTS")
"RTN","ORMBLDPS",135,0)
 I $L($G(ORDIALOG(ST,1))) D
"RTN","ORMBLDPS",136,0)
 . S J=$O(^TMP("ORWORD",$J,ST,1,0)) Q:'J
"RTN","ORMBLDPS",137,0)
 . S K=0,TXT=$G(^TMP("ORWORD",$J,ST,1,J,0))
"RTN","ORMBLDPS",138,0)
 . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",139,0)
 . F  S J=$O(^TMP("ORWORD",$J,ST,1,J)) Q:J'>0  S TXT=$G(^(J,0)) D
"RTN","ORMBLDPS",140,0)
 . . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",141,0)
 Q
"RTN","ORMBLDPS",142,0)
 ;
"RTN","ORMBLDPS",143,0)
ORDCHKS ; -- Include order checks in OBX segments
"RTN","ORMBLDPS",144,0)
 N OC,X,X1 S OC=0
"RTN","ORMBLDPS",145,0)
 F  S OC=$O(^OR(100,IFN,9,OC)) Q:OC'>0  S X=$G(^(OC,0)),X1=$G(^(1)) D
"RTN","ORMBLDPS",146,0)
 . S I=I+1,ORMSG(I)="OBX|"_OC_"|TX|^^^"_+X_"^^99OCX||"_$S($L(X1):X1,1:$P(X,U,3))_"|||||||||"_$$FMTHL7^XLFDT($P(X,U,6))_"||"_$P(X,U,5)
"RTN","ORMBLDPS",147,0)
 . I $L($P(X,U,4)) S I=I+1,ORMSG(I)="NTE|"_OC_"|P|"_$P(X,U,4)
"RTN","ORMBLDPS",148,0)
 Q
"RTN","ORMBLDPS",149,0)
 ;
"RTN","ORMBLDPS",150,0)
HL7UNIT(X) ; -- Return coded element for volume/strength units
"RTN","ORMBLDPS",151,0)
 N I,UNIT,Y
"RTN","ORMBLDPS",152,0)
 F I=1:1:$L(X) I $E(X,I)?1A Q  ; first letter
"RTN","ORMBLDPS",153,0)
 S UNIT=$$UP^XLFSTR($E(X,I,$L(X))),Y=""
"RTN","ORMBLDPS",154,0)
 F I=1:1:13 S X=$P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM","^",I) I UNIT=X S Y="^^^PSIV-"_I_U_UNIT_"^99OTH" Q
"RTN","ORMBLDPS",155,0)
 Q Y
"RTN","ORMBLDPS",156,0)
 ;
"RTN","ORMBLDPS",157,0)
HL7TIME(X) ; -- Return HL7 formatted duration
"RTN","ORMBLDPS",158,0)
 N I,Y S Y=""
"RTN","ORMBLDPS",159,0)
 F I=1:1:$L(X) I $E(X,I)?1A S Y=$$UP^XLFSTR($E(X,I)) Q  ; first letter
"RTN","ORMBLDPS",160,0)
 S Y=Y_+X
"RTN","ORMBLDPS",161,0)
 Q Y
"RTN","ORMBLDPS",162,0)
 ;
"RTN","ORMBLDPS",163,0)
VER(IFN) ; -- Send msg for nurse-verified orders
"RTN","ORMBLDPS",164,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="I"  ;Inpt only
"RTN","ORMBLDPS",165,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",166,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDPS",167,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",168,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",169,0)
 Q
"RTN","ORMBLDPS",170,0)
 ;
"RTN","ORMBLDPS",171,0)
REF(IFN,ROUTING,CLINIC) ; -- Send msg for refill request
"RTN","ORMBLDPS",172,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="O"
"RTN","ORMBLDPS",173,0)
 S:'$G(CLINIC) CLINIC=$S($G(ORL):+ORL,1:+$P(OR0,U,10))
"RTN","ORMBLDPS",174,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",175,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),"O",CLINIC)
"RTN","ORMBLDPS",176,0)
 S ORMSG(4)="ORC|ZF|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS|||||||"_DUZ_"||"_$G(ORNP)_"|||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",177,0)
 S ORMSG(5)="ZRX||||"_ROUTING
"RTN","ORMBLDPS",178,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",179,0)
 Q
"RTN","ORMBLDPS",180,0)
HL7IVLMT(STR) ;
"RTN","ORMBLDPS",181,0)
 N VAL,UNIT,IVLMT
"RTN","ORMBLDPS",182,0)
 S (UNIT,IVLMT)="",VAL=0
"RTN","ORMBLDPS",183,0)
 I $E($$LOW^XLFSTR(STR))="f" D
"RTN","ORMBLDPS",184,0)
 . S VAL=$P(STR," ",2)
"RTN","ORMBLDPS",185,0)
 . S UNIT=$E($P(STR," ",3))
"RTN","ORMBLDPS",186,0)
 I $E($$LOW^XLFSTR(STR))="w" D
"RTN","ORMBLDPS",187,0)
 . S VAL=+$P(STR," ",4)
"RTN","ORMBLDPS",188,0)
 . S UNIT=$E($P(STR," ",4),$L(VAL)+1)
"RTN","ORMBLDPS",189,0)
 I $L(UNIT),$L(VAL) S IVLMT=$$LOW^XLFSTR(UNIT)_VAL
"RTN","ORMBLDPS",190,0)
 Q IVLMT
"RTN","ORWDPS32")
0^3^B80350069
"RTN","ORWDPS32",1,0)
ORWDPS32 ; SLC/KCM - Pharmacy Calls for GUI Dialog ;08/04/96
"RTN","ORWDPS32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,94,190,195,237**;Dec 17, 1997
"RTN","ORWDPS32",3,0)
 ;
"RTN","ORWDPS32",4,0)
NXT() ; -- ret next available index in data array
"RTN","ORWDPS32",5,0)
 S ILST=ILST+1
"RTN","ORWDPS32",6,0)
 Q ILST
"RTN","ORWDPS32",7,0)
 ;
"RTN","ORWDPS32",8,0)
DLGSLCT(LST,PSTYPE) ; return def lists for dialog
"RTN","ORWDPS32",9,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpt)
"RTN","ORWDPS32",10,0)
 N ILST S ILST=0
"RTN","ORWDPS32",11,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORWDPS32",12,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORWDPS32",13,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",14,0)
 ;
"RTN","ORWDPS32",15,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpt
"RTN","ORWDPS32",16,0)
 S LST($$NXT)="~Schedules"  D SCHED
"RTN","ORWDPS32",17,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",18,0)
 I PSTYPE="O" D                          ; Outpt
"RTN","ORWDPS32",19,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORWDPS32",20,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORWDPS32",21,0)
 Q
"RTN","ORWDPS32",22,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORWDPS32",23,0)
 ; !!! change this so that it uses the ORWDXQ call!!!
"RTN","ORWDPS32",24,0)
 N I,X,TMP
"RTN","ORWDPS32",25,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORWDPS32",26,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORWDPS32",27,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORWDPS32",28,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORWDPS32",29,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORWDPS32",30,0)
 Q
"RTN","ORWDPS32",31,0)
SCHED ; from DLGSLCT, get all pharm admin scheds
"RTN","ORWDPS32",32,0)
 N X
"RTN","ORWDPS32",33,0)
 S X="" F  S X=$O(^PS(51.1,"APPSJ",X)) Q:X=""  S LST($$NXT)="i"_X
"RTN","ORWDPS32",34,0)
 Q
"RTN","ORWDPS32",35,0)
SCHEDA ; (similar to SCHED, but also rtns admin times)
"RTN","ORWDPS32",36,0)
 N X,IEN,SCH
"RTN","ORWDPS32",37,0)
 S SCH="" F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORWDPS32",38,0)
 . S IEN=0 F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORWDPS32",39,0)
 . . S X=^PS(51.1,IEN,0) S X=$S($L($P(X,U,2)):"  ("_$P(X,U,2)_")",1:"")
"RTN","ORWDPS32",40,0)
 . . S LST($$NXT)="i"_IEN_U_SCH_X
"RTN","ORWDPS32",41,0)
 Q
"RTN","ORWDPS32",42,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS32",43,0)
 N X,XREF
"RTN","ORWDPS32",44,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS32",45,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS32",46,0)
 . S LST($$NXT)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS32",47,0)
 S LST($$NXT)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS32",48,0)
 Q
"RTN","ORWDPS32",49,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORWDPS32",50,0)
 N X,EDITONLY
"RTN","ORWDPS32",51,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORWDPS32",52,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORWDPS32",53,0)
 Q
"RTN","ORWDPS32",54,0)
DEFPICK()       ; ret def routing
"RTN","ORWDPS32",55,0)
 N X,DLG,PRMT
"RTN","ORWDPS32",56,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS32",57,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS32",58,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS32",59,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by def action
"RTN","ORWDPS32",60,0)
 ;
"RTN","ORWDPS32",61,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS32",62,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS32",63,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS32",64,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS32",65,0)
 I X="N" S X=""             G XPICK
"RTN","ORWDPS32",66,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS32",67,0)
XPICK Q X
"RTN","ORWDPS32",68,0)
 ;
"RTN","ORWDPS32",69,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORWDPS32",70,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORWDPS32",71,0)
 Q
"RTN","ORWDPS32",72,0)
 ;
"RTN","ORWDPS32",73,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; rtn for defaults for pharm OI
"RTN","ORWDPS32",74,0)
 N ILST S ILST=0
"RTN","ORWDPS32",75,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",76,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORWDPS32",77,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORWDPS32",78,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORWDPS32",79,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORWDPS32",80,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORWDPS32",81,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",82,0)
 Q
"RTN","ORWDPS32",83,0)
 ;
"RTN","ORWDPS32",84,0)
DISPDRUG(LST,OI) ; list dispense drugs for an OI
"RTN","ORWDPS32",85,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORWDPS32",86,0)
 Q
"RTN","ORWDPS32",87,0)
 ;
"RTN","ORWDPS32",88,0)
DISPDRG ; from OISLCT, get disp drugs for this pharm OI
"RTN","ORWDPS32",89,0)
 N I,ORTMP,ORX
"RTN","ORWDPS32",90,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORWDPS32",91,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORWDPS32",92,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS32",93,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORWDPS32",94,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORWDPS32",95,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORWDPS32",96,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORWDPS32",97,0)
 Q
"RTN","ORWDPS32",98,0)
INSTRCT ; from OISLCT, get list of potential instructs (based on drug form)
"RTN","ORWDPS32",99,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORWDPS32",100,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORWDPS32",101,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORWDPS32",102,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORWDPS32",103,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORWDPS32",104,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORWDPS32",105,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORWDPS32",106,0)
 S LST($$NXT)="~Nouns"
"RTN","ORWDPS32",107,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORWDPS32",108,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORWDPS32",109,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORWDPS32",110,0)
 ;
"RTN","ORWDPS32",111,0)
 Q
"RTN","ORWDPS32",112,0)
MIXED(X)   ; Return mixed case
"RTN","ORWDPS32",113,0)
 Q X  ;$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ORWDPS32",114,0)
 ;
"RTN","ORWDPS32",115,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS32",116,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS32",117,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORWDPS32",118,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",119,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",120,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORWDPS32",121,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS32",122,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",123,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",124,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORWDPS32",125,0)
 Q
"RTN","ORWDPS32",126,0)
MESSAGE ; message
"RTN","ORWDPS32",127,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDPS32",128,0)
 Q
"RTN","ORWDPS32",129,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORWDPS32",130,0)
 N I,X,ILST S ILST=0
"RTN","ORWDPS32",131,0)
 S I=0 F  S I=$O(^PS(51.2,I)) Q:'I  S X=^(I,0) D
"RTN","ORWDPS32",132,0)
 . I $P(X,U,4) S LST($$NXT)=I_U_$P(X,U)_U_$P(X,U,3)
"RTN","ORWDPS32",133,0)
 Q
"RTN","ORWDPS32",134,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORWDPS32",135,0)
 N ORLST,ABBR
"RTN","ORWDPS32",136,0)
 D FIND^DIC(51.2,"",1,"MO",X,1,,"I $P(^(0),U,4)=1",,"ORLST")
"RTN","ORWDPS32",137,0)
 I 'ORLST("DILIST",0) S REC=0 Q
"RTN","ORWDPS32",138,0)
 S X=$$UPPER(X),ABBR=ORLST("DILIST","ID",1,1)
"RTN","ORWDPS32",139,0)
 I '$L(ABBR) S ABBR=ORLST("DILIST",1,1)
"RTN","ORWDPS32",140,0)
 I ($$UPPER(ORLST("DILIST",1,1))'=X),($$UPPER(ABBR)'=X) S REC=0 Q
"RTN","ORWDPS32",141,0)
 S REC=ORLST("DILIST",2,1)_U_ABBR
"RTN","ORWDPS32",142,0)
 Q
"RTN","ORWDPS32",143,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORWDPS32",144,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",145,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",146,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",147,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",148,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",149,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORWDPS32",150,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORWDPS32",151,0)
 Q
"RTN","ORWDPS32",152,0)
AUTHNVA(VAL,PRV) ; For Non-VA meds, check restrictions
"RTN","ORWDPS32",153,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",154,0)
 I $D(^XUSEC("OREMAS",DUZ)),$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS")=2 Q
"RTN","ORWDPS32",155,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS") D  Q
"RTN","ORWDPS32",156,0)
 . S VAL="1^OREMAS key holders may not enter non-VA medication orders."
"RTN","ORWDPS32",157,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",158,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",159,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",160,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",161,0)
 Q
"RTN","ORWDPS32",162,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORWDPS32",163,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORWDPS32",164,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORWDPS32",165,0)
 Q
"RTN","ORWDPS32",166,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORWDPS32",167,0)
 S VAL=0
"RTN","ORWDPS32",168,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORWDPS32",169,0)
 Q
"RTN","ORWDPS32",170,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORWDPS32",171,0)
 S VAL=0
"RTN","ORWDPS32",172,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORWDPS32",173,0)
 Q
"RTN","ORWDPS32",174,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORWDPS32",175,0)
 N I,PSOI,ORWY,AMT
"RTN","ORWDPS32",176,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORWDPS32",177,0)
 D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORWDPS32",178,0)
 I ORWTYP="B" D
"RTN","ORWDPS32",179,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))=""
"RTN","ORWDPS32",180,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORWDPS32",181,0)
 I ORWTYP="A" D
"RTN","ORWDPS32",182,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORWDPS32",183,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM"
"RTN","ORWDPS32",184,0)
 Q
"RTN","ORWDPS32",185,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORWDPS32",186,0)
 I $E($RE($$UPPER(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORWDPS32",187,0)
 S X=$$TRIM(X)
"RTN","ORWDPS32",188,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",189,0)
 Q
"RTN","ORWDPS32",190,0)
UPPER(X)        ; return uppercase
"RTN","ORWDPS32",191,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORWDPS32",192,0)
 ;
"RTN","ORWDPS32",193,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORWDPS32",194,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORWDPS32",195,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORWDPS32",196,0)
 Q X
"RTN","ORWDPS32",197,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORWDPS32",198,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDPS32",199,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORWDPS32",200,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORWDPS32",201,0)
 S VAL=1
"RTN","ORWDPS32",202,0)
XSCSTS Q
"RTN","ORWDPS32",203,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS32",204,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORWDPS32",205,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDPS32",206,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS32",207,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS32",208,0)
 Q
"RTN","ORWDPS32",209,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORWDPS32",210,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORWDPS32",211,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORWDPS32",212,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORWDPS32",213,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORWDPS32",214,0)
 E  D
"RTN","ORWDPS32",215,0)
 . D EN^PSSGSGUI
"RTN","ORWDPS32",216,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",217,0)
 Q
"RTN","ORWDPS32",218,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORWDPS32",219,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORWDPS32",220,0)
 ; this is based on the input transform from 52,7
"RTN","ORWDPS32",221,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORWDPS32",222,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",223,0)
 Q
"RTN","ORWDPS32",224,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORWDPS32",225,0)
 N ORTMP,ORI,ORJ,ILST,NDF,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORWDPS32",226,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS32",227,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORWDPS32",228,0)
 . S NDF=$G(^PSDRUG(+ORWDRG,"ND")),VAPN=$P(NDF,U,3),NDF=+NDF
"RTN","ORWDPS32",229,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORWDPS32",230,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORWDPS32",231,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORWDPS32",232,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORWDPS32",233,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORWDPS32",234,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORWDPS32",235,0)
 Q
"RTN","ORY237")
0^^B581091
"RTN","ORY237",1,0)
ORY237 ;SLC/MKB -- post-install for OR*3*237 ;07/14/2005
"RTN","ORY237",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**237**;Dec 17, 1997
"RTN","ORY237",3,0)
 ;
"RTN","ORY237",4,0)
POST ; -- Posinit addes 2 new drug units to the OR GTX UNITS / ORDER DIALOG
"RTN","ORY237",5,0)
 N ORDIALOG,ORDOMAIN,X
"RTN","ORY237",6,0)
 S ORDIALOG=+$$PTR("UNITS")
"RTN","ORY237",7,0)
 S ORDOMAIN=""
"RTN","ORY237",8,0)
 S ORDOMAIN=$P(^ORD(101.41,ORDIALOG,1),"^",2)
"RTN","ORY237",9,0)
 Q:$P(ORDOMAIN,";",13)="NANOGRAM:NANOGRAM"
"RTN","ORY237",10,0)
 S $P(^ORD(101.41,ORDIALOG,1),"^",2)=ORDOMAIN_"MG-PE:MG-PE;NANOGRAM:NANOGRAM;"
"RTN","ORY237",11,0)
 Q
"RTN","ORY237",12,0)
 ;
"RTN","ORY237",13,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORY237",14,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORY237",15,0)
 ;
"RTN","ORY237",16,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
PSJ*5.0*152
"BLD",6356,0)
PSJ*5.0*152^INPATIENT MEDICATIONS^0^3051026^y
"BLD",6356,1,0)
^9.61A^3^3^3050630^^
"BLD",6356,1,1,0)
1. The addition of two new DRUG UNITS to the Inpatient Medication IV
"BLD",6356,1,2,0)
    package has been requested.  The two requested units are MG-PE and 
"BLD",6356,1,3,0)
    NANOGRAM.
"BLD",6356,4,0)
^9.64PA^50.8^1
"BLD",6356,4,50.8,0)
50.8
"BLD",6356,4,50.8,2,0)
^9.641^50.805^1
"BLD",6356,4,50.8,2,50.805,0)
IV DRUG  (sub-file)
"BLD",6356,4,50.8,2,50.805,1,0)
^9.6411^5^1
"BLD",6356,4,50.8,2,50.805,1,5,0)
DRUG UNIT
"BLD",6356,4,50.8,222)
y^y^p^^^^n^^n
"BLD",6356,4,50.8,224)

"BLD",6356,4,"APDD",50.8,50.805)

"BLD",6356,4,"APDD",50.8,50.805,5)

"BLD",6356,4,"B",50.8,50.8)

"BLD",6356,6)
2^
"BLD",6356,"KRN",0)
^9.67PA^8989.52^19
"BLD",6356,"KRN",.4,0)
.4
"BLD",6356,"KRN",.401,0)
.401
"BLD",6356,"KRN",.402,0)
.402
"BLD",6356,"KRN",.403,0)
.403
"BLD",6356,"KRN",.5,0)
.5
"BLD",6356,"KRN",.84,0)
.84
"BLD",6356,"KRN",3.6,0)
3.6
"BLD",6356,"KRN",3.8,0)
3.8
"BLD",6356,"KRN",9.2,0)
9.2
"BLD",6356,"KRN",9.8,0)
9.8
"BLD",6356,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6356,"KRN",9.8,"NM",1,0)
PSJHL3^^0^62290777
"BLD",6356,"KRN",9.8,"NM",2,0)
PSJORUT2^^0^46889798
"BLD",6356,"KRN",9.8,"NM","B","PSJHL3",1)

"BLD",6356,"KRN",9.8,"NM","B","PSJORUT2",2)

"BLD",6356,"KRN",19,0)
19
"BLD",6356,"KRN",19.1,0)
19.1
"BLD",6356,"KRN",101,0)
101
"BLD",6356,"KRN",409.61,0)
409.61
"BLD",6356,"KRN",771,0)
771
"BLD",6356,"KRN",870,0)
870
"BLD",6356,"KRN",8989.51,0)
8989.51
"BLD",6356,"KRN",8989.52,0)
8989.52
"BLD",6356,"KRN",8994,0)
8994
"BLD",6356,"KRN","B",.4,.4)

"BLD",6356,"KRN","B",.401,.401)

"BLD",6356,"KRN","B",.402,.402)

"BLD",6356,"KRN","B",.403,.403)

"BLD",6356,"KRN","B",.5,.5)

"BLD",6356,"KRN","B",.84,.84)

"BLD",6356,"KRN","B",3.6,3.6)

"BLD",6356,"KRN","B",3.8,3.8)

"BLD",6356,"KRN","B",9.2,9.2)

"BLD",6356,"KRN","B",9.8,9.8)

"BLD",6356,"KRN","B",19,19)

"BLD",6356,"KRN","B",19.1,19.1)

"BLD",6356,"KRN","B",101,101)

"BLD",6356,"KRN","B",409.61,409.61)

"BLD",6356,"KRN","B",771,771)

"BLD",6356,"KRN","B",870,870)

"BLD",6356,"KRN","B",8989.51,8989.51)

"BLD",6356,"KRN","B",8989.52,8989.52)

"BLD",6356,"KRN","B",8994,8994)

"BLD",6356,"QUES",0)
^9.62^^
"BLD",6356,"REQB",0)
^9.611^1^1
"BLD",6356,"REQB",1,0)
PSJ*5.0*111^2
"BLD",6356,"REQB","B","PSJ*5.0*111",1)

"FIA",50.8)
IV STATS
"FIA",50.8,0)
^PS(50.8,
"FIA",50.8,0,0)
50.8P
"FIA",50.8,0,1)
y^y^p^^^^n^^n
"FIA",50.8,0,10)

"FIA",50.8,0,11)

"FIA",50.8,0,"RLRO")

"FIA",50.8,0,"VR")
5.0^PSJ
"FIA",50.8,50.8)
1
"FIA",50.8,50.805)
1
"FIA",50.8,50.805,5)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
152^3051026^33234
"PKG",203,22,1,"PAH",1,1,0)
^^3^3^3051026
"PKG",203,22,1,"PAH",1,1,1,0)
1. The addition of two new DRUG UNITS to the Inpatient Medication IV
"PKG",203,22,1,"PAH",1,1,2,0)
    package has been requested.  The two requested units are MG-PE and 
"PKG",203,22,1,"PAH",1,1,3,0)
    NANOGRAM.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSJHL3")
0^1^B62290777
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;04 Aug 98 / 10:10 AM
"RTN","PSJHL3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111,152**;16 DEC 97
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ;
"RTN","PSJHL3",18,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",19,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",20,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",21,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",22,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",23,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE
"RTN","PSJHL3",24,0)
 D INIT
"RTN","PSJHL3",25,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",26,0)
 D RXO,RXE D:(IVTYPE'="F")!($G(PSJBCBU)) RXR D ZRX
"RTN","PSJHL3",27,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",28,0)
 Q
"RTN","PSJHL3",29,0)
 ;
"RTN","PSJHL3",30,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",31,0)
 D INIT^PSJHLU
"RTN","PSJHL3",32,0)
 Q
"RTN","PSJHL3",33,0)
 ;
"RTN","PSJHL3",34,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",35,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",36,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",37,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",38,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$P(OINODE,"^",2),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6)
"RTN","PSJHL3",39,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",40,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^"),FIELD(1)=FIELD(1)_$P($G(^PS(50.7,SPDIEN,0)),"^")_" "_NAME
"RTN","PSJHL3",41,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",42,0)
 N DURNOD S DURNOD=$G(@(PSJORDER_"2.5)")) I $P(DURNOD,"^",4)]"" S $P(FIELD(1),"^",3)=$P(DURNOD,"^",4)
"RTN","PSJHL3",43,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",44,0)
 Q
"RTN","PSJHL3",45,0)
 ;
"RTN","PSJHL3",46,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",47,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",48,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",49,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL3",50,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",51,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",52,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",53,0)
 ;S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4),X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION="D"_X
"RTN","PSJHL3",54,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",55,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",56,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",57,0)
 ;S FIELD(1)="^"_$P(NODE2,"^")_$S($G(PSJBCBU):"&"_$P(NODE2,"^",5),1:"")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",58,0)
 S FIELD(1)="^"_$P(NODE2,"^")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",59,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",60,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",61,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",62,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",63,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",64,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$G(@(PSJORDER_".3)"))
"RTN","PSJHL3",65,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",66,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",67,0)
 ..;S PRODNAME=$S($G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",68,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",69,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",70,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$P($G(^PSDRUG(DDIEN,0)),"^")_"^"_"99PSD"
"RTN","PSJHL3",71,0)
 ..;S UNITS=$S(PRODNAME="N/A":"N/A",1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^"))
"RTN","PSJHL3",72,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",73,0)
 ..S FIELD(5)="^^^"_UNITS_"^"_$P($G(^PS(50.607,UNITS,0)),"^")_"^99PSU"
"RTN","PSJHL3",74,0)
 ..S FIELD(6)="^^^"_$G(DOSEFORM)_"^"_$P($G(^PS(50.606,+$G(DOSEFORM),0)),"^")_"^99PSF"
"RTN","PSJHL3",75,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",76,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",77,0)
 E  S $P(FIELD(1),"^",8)=DOSEOR
"RTN","PSJHL3",78,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^"),FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",79,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",80,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",81,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",82,0)
 I $P($G(@(PSJORDER_"6)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"6)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",83,0)
 I PSJORDER["P",$P($G(@(PSJORDER_"9)")),"^",2)]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),"^",2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",84,0)
 Q
"RTN","PSJHL3",85,0)
 ;
"RTN","PSJHL3",86,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",87,0)
 ; if it's an Inpatient Med IV order, send the RXE with dispense drug
"RTN","PSJHL3",88,0)
 ; information.  If it's an IV FLUID order, send just the start/stop
"RTN","PSJHL3",89,0)
 ; date, duration in the RXE and send an RXC for each additive and
"RTN","PSJHL3",90,0)
 ; solution.
"RTN","PSJHL3",91,0)
 N ADSNODE
"RTN","PSJHL3",92,0)
 I RXORDER["V" S PSGPLS=$P(NODE1,"^",2),PSGPLF=$P(NODE1,"^",3)
"RTN","PSJHL3",93,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",94,0)
 ;S X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION=$S(X]"":"D"_X,1:"")
"RTN","PSJHL3",95,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":$P(NODE1,"^",9),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",96,0)
 ;S:$G(PSJBCBU) $P(FIELD(1),"^",2)=$P(FIELD(1),"^",2)_"&"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))
"RTN","PSJHL3",97,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",98,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",99,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",100,0)
 N X,Y
"RTN","PSJHL3",101,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",102,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",103,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",104,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",105,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",106,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"5,"_JJ_",0)"))
"RTN","PSJHL3",107,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",108,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",109,0)
 I RXORDER["V",$P($G(@(PSJORDER_"3)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"3)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",110,0)
 I RXORDER["P",$P($G(@(PSJORDER_"9)")),U,2)]"" S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),U,2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",111,0)
 ;
"RTN","PSJHL3",112,0)
RXC ;component segments
"RTN","PSJHL3",113,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM,UTMP,XTMP
"RTN","PSJHL3",114,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",115,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",116,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",117,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",118,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",119,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",120,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",121,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",122,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",123,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",124,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",125,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",126,0)
 .F XTMP=1:1:13 S UTMP($P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM","^",XTMP))="PSIV-"_XTMP
"RTN","PSJHL3",127,0)
 .S NUM="" S:FIELD(4)'="" NUM=$G(UTMP(FIELD(4)))
"RTN","PSJHL3",128,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",129,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",130,0)
 Q
"RTN","PSJHL3",131,0)
 ;
"RTN","PSJHL3",132,0)
RXR ; med route segment
"RTN","PSJHL3",133,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",134,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",135,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",136,0)
 .S FIELD(1)=FIELD(1)_"^"_$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")_"^99PSR"
"RTN","PSJHL3",137,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",138,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")_"^99PSR"
"RTN","PSJHL3",139,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",140,0)
 Q
"RTN","PSJHL3",141,0)
 ;
"RTN","PSJHL3",142,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",143,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHL3",144,0)
 S FIELD(0)="ZRX"
"RTN","PSJHL3",145,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHL3",146,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHL3",147,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHL3",148,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHL3",149,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHL3",150,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHL3",151,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHL3",152,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",153,0)
 S FIELD(5)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",154,0)
 S FIELD(6)=$S($G(IVTYPE)="F":"IV",$P($G(@(PSJORDER_"0)")),U,4)="H":"TPN",1:"")
"RTN","PSJHL3",155,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",156,0)
 Q
"RTN","PSJHL3",157,0)
 ;
"RTN","PSJHL3",158,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",159,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",160,0)
 Q
"RTN","PSJORUT2")
0^2^B46889798
"RTN","PSJORUT2",1,0)
PSJORUT2 ;BIR/MLM-MISC. PROCEDURE CALLS FOR OE/RR 3.0 (CONT.) ;03 Aug 98 / 8:42 AM
"RTN","PSJORUT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**14,29,50,56,58,107,152**;16 DEC 97
"RTN","PSJORUT2",3,0)
 ;
"RTN","PSJORUT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJORUT2",5,0)
 ; Reference to ^PS(50.605 is supported by DBIA 2138
"RTN","PSJORUT2",6,0)
 ; References to ^PS(52.6 supported by DBIA 1231
"RTN","PSJORUT2",7,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSJORUT2",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORUT2",9,0)
 ; Reference to ^PSNDF( is supported by DBIA 2195
"RTN","PSJORUT2",10,0)
 ; Reference to ^PSRX( is supported by DBIA 824
"RTN","PSJORUT2",11,0)
 ; Reference to ^PSNAPIS is supported by DBIA 2531
"RTN","PSJORUT2",12,0)
 ;
"RTN","PSJORUT2",13,0)
ENVAC(PN) ; Find VA CLASS of VA Product Name
"RTN","PSJORUT2",14,0)
 ;Input: PN - See above
"RTN","PSJORUT2",15,0)
 ;Output: VA Drug Class^Classification
"RTN","PSJORUT2",16,0)
 ;
"RTN","PSJORUT2",17,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",18,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N PSJC,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),PSJC=$$DCLASS^PSNAPIS(X1,X2) Q PSJC
"RTN","PSJORUT2",19,0)
 ;
"RTN","PSJORUT2",20,0)
 N GDP,PNP S GDP=$P(PN,"."),PNP=$P(PN,".",2)
"RTN","PSJORUT2",21,0)
 S X=+$P($G(^PSNDF(+GDP,5,+PNP,0)),U,2),X=+$P($G(^PSNDF(GDP,2,X,0)),U,3),PSJC=$P($G(^PS(50.605,X,0)),U,2)
"RTN","PSJORUT2",22,0)
 Q $S('X:0,PSJC="":0,1:X_U_PSJC)
"RTN","PSJORUT2",23,0)
 ;
"RTN","PSJORUT2",24,0)
ENVAGN(PN) ; Return VA Generic Name for specified VA Product Name.
"RTN","PSJORUT2",25,0)
 ;Input:  PN - VA Product Name IEN
"RTN","PSJORUT2",26,0)
 ;Output: VA Generic Name IEN^VA Generic Name
"RTN","PSJORUT2",27,0)
 ;
"RTN","PSJORUT2",28,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",29,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N GDP,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),GDP=$$VAGN^PSNAPIS(X1) Q $S(GDP=0:0,1:X1_U_GDP)
"RTN","PSJORUT2",30,0)
 ;
"RTN","PSJORUT2",31,0)
 N GDP,PNP S GDP=+$P(PN,"."),PNP=+$P(PN,".",2)
"RTN","PSJORUT2",32,0)
 S X=$P($G(^PSNDF(GDP,0)),U)
"RTN","PSJORUT2",33,0)
 Q $S('GDP:0,X="":0,1:GDP_U_X)
"RTN","PSJORUT2",34,0)
ENVOL(PN,ARRAY) ;
"RTN","PSJORUT2",35,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",36,0)
 N X,XX,F,INACT,IVFL S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM"
"RTN","PSJORUT2",37,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",38,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",39,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",40,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",41,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",42,0)
 Q
"RTN","PSJORUT2",43,0)
 ;
"RTN","PSJORUT2",44,0)
ENVOL2(PN,ARRAY) ;Only for Med Button IV orders.
"RTN","PSJORUT2",45,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",46,0)
 N X,XX,F,INACT S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM"
"RTN","PSJORUT2",47,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",48,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",49,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",50,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",51,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",52,0)
 Q
"RTN","PSJORUT2",53,0)
 ;
"RTN","PSJORUT2",54,0)
 ;
"RTN","PSJORUT2",55,0)
SENVOL(PN,PSJ) ;Return array listing volume (base only) and volume units for the specified additive or solution.
"RTN","PSJORUT2",56,0)
 ;Input:  PN - IEN_B (Base) or A (Additive)
"RTN","PSJORUT2",57,0)
 ;Output: ARRAY(IEN,A:additive or B:Base)=volume^volume units
"RTN","PSJORUT2",58,0)
 ;        If no volume or units found PSJ=0; If found PSJ=1.
"RTN","PSJORUT2",59,0)
 ;
"RTN","PSJORUT2",60,0)
 N X S PSJ=1,X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM"
"RTN","PSJORUT2",61,0)
 I PN'["A",PN'["B" S PSJ=0 Q
"RTN","PSJORUT2",62,0)
 S PSJ=PSJ+1
"RTN","PSJORUT2",63,0)
 I PN["A" S PSJ(+PN,"A")=U_X(+$P($G(^PS(52.6,+PN,0)),U,3)) Q
"RTN","PSJORUT2",64,0)
 I PN["B" S PSJ(+PN,"B")=+$P($G(^PS(52.7,+PN,0)),U,3)_U_X(1) Q
"RTN","PSJORUT2",65,0)
 Q
"RTN","PSJORUT2",66,0)
 ;
"RTN","PSJORUT2",67,0)
ENREF(PRX) ; Return number of refills remaining.
"RTN","PSJORUT2",68,0)
 ;Input: PRX - Internal prescription number from File #52.
"RTN","PSJORUT2",69,0)
 ;Output: Number of refills remaining.
"RTN","PSJORUT2",70,0)
 ;
"RTN","PSJORUT2",71,0)
 N X,COUNT,CNT S PRX=$P(PRX,"^"),COUNT=0,X=$P(^PSRX(PRX,0),"^",9)
"RTN","PSJORUT2",72,0)
 D:$O(^PSRX(PRX,1,0))
"RTN","PSJORUT2",73,0)
 .F CNT=0:0 S CNT=$O(^PSRX(PRX,1,CNT)) Q:'CNT  S COUNT=COUNT+1
"RTN","PSJORUT2",74,0)
 S:$G(COUNT) X=X-COUNT
"RTN","PSJORUT2",75,0)
 Q X
"RTN","PSJORUT2",76,0)
 ;
"RTN","PSJORUT2",77,0)
ENCHK(DFN,PSJINX)     ; Return dispense drug check array.
"RTN","PSJORUT2",78,0)
 ;Input: DFN      - Patient internal entry number
"RTN","PSJORUT2",79,0)
 ;       PSJINX   - Index number so duplicate drugs will be returned.
"RTN","PSJORUT2",80,0)
 ;       PSGOCHK  - Check should include dispense drugs in 53.45
"RTN","PSJORUT2",81,0)
 ;       PSIVOCHK - Check should include entries in DRG array
"RTN","PSJORUT2",82,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJORUT2",83,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJORUT2",84,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJORUT2",85,0)
 ;
"RTN","PSJORUT2",86,0)
 NEW BDT,DDRUG,DDRUG0,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN
"RTN","PSJORUT2",87,0)
 ;* S BDT=DT,WBDT=BDT_".000001",EDT=9999999
"RTN","PSJORUT2",88,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999
"RTN","PSJORUT2",89,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UD
"RTN","PSJORUT2",90,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJORUT2",91,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) D PIV Q
"RTN","PSJORUT2",92,0)
 . D UD
"RTN","PSJORUT2",93,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IV
"RTN","PSJORUT2",94,0)
 I '$G(PSIVOCON) D NEWIV ; Don't do this when Finishing orders (FN)
"RTN","PSJORUT2",95,0)
 Q
"RTN","PSJORUT2",96,0)
UD ;*** Get the dispense drugs for the Unit Dose orders.
"RTN","PSJORUT2",97,0)
 S PSJORIEN=$P(@(F_ON_",0)"),U,21),DDRUG=0
"RTN","PSJORUT2",98,0)
 I F="^PS(53.1,",($P(@(F_ON_",0)"),U,4)="I") D  Q
"RTN","PSJORUT2",99,0)
 . NEW PSJPD S COD=ON_"P"
"RTN","PSJORUT2",100,0)
 . S PSJPD=+$G(^PS(53.1,ON,.2)) D:$D(^PS(52.6,"AOI",PSJPD)) ENDDIV^PSJORUTL(PSJPD,"A","",.DDRUG) S DDRUG=+DDRUG D:DDRUG DDRUG
"RTN","PSJORUT2",101,0)
 S ON1=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S DDRUG=@(F_ON_",1,"_ON1_",0)") I $P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",102,0)
 I $D(PSGOCHK) F ON1=0:0 S ON1=$O(^PS(53.45,+PSJSYSP,1,ON1)) Q:'ON1  S DDRUG=$G(^PS(53.45,+PSJSYSP,1,ON1,0)) I $P(DDRUG,U,3)=""!@($P(DDRUG,U,3)>BDT) S (COD,PSJORIEN)="" D DDRUG
"RTN","PSJORUT2",103,0)
 I '$O(@(F_ON_",1,"_0_")")) N OI S OI=+$G(@(F_ON_",.2)")) I OI D
"RTN","PSJORUT2",104,0)
 .S DDRUG="" F  S DDRUG=$O(^PSDRUG("ASP",OI,DDRUG)) Q:'DDRUG  D
"RTN","PSJORUT2",105,0)
 ..I ($P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT)) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",106,0)
 Q
"RTN","PSJORUT2",107,0)
PIV ;*** Get the dispense drugs for the Pending IV orders.
"RTN","PSJORUT2",108,0)
 S X=^PS(53.1,+ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,27)="R"
"RTN","PSJORUT2",109,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",110,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",111,0)
 Q
"RTN","PSJORUT2",112,0)
IV ;*** Get the dispense drugs for the IV orders.
"RTN","PSJORUT2",113,0)
 NEW X S X=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,17)="R"
"RTN","PSJORUT2",114,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",115,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",116,0)
 ;*D:$G(PSIVNEW) NEWIV
"RTN","PSJORUT2",117,0)
 Q
"RTN","PSJORUT2",118,0)
NEWIV ;*** Get the dispense drugs for the newly entered IV order.
"RTN","PSJORUT2",119,0)
 NEW PSIVX,ON
"RTN","PSJORUT2",120,0)
 S ON=$O(DRGOC(0)),PSJORIEN="" Q:'+ON
"RTN","PSJORUT2",121,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"AD",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.6,+DRGOC(ON,"AD",PSIVX),0),U,2),COD=ON55 D DDRUG
"RTN","PSJORUT2",122,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"SOL",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.7,+DRGOC(ON,"SOL",PSIVX),0),U,2),COD=ON D DDRUG
"RTN","PSJORUT2",123,0)
 Q
"RTN","PSJORUT2",124,0)
DDRUG ;*** Set PSJ(DDRUG NAME) arrays.
"RTN","PSJORUT2",125,0)
 Q:'DDRUG  S DDRUG0=$G(^PSDRUG(+DDRUG,0)),DDRUGND=$G(^PSDRUG(+DDRUG,"ND"))
"RTN","PSJORUT2",126,0)
 S PSJINX=+$G(PSJINX)+1 ;* ^PSOORDRG calls this entry point.
"RTN","PSJORUT2",127,0)
 I $D(DDRUG)=11,DDRUG[";" D  Q   ; if called from ^PSOORDRG
"RTN","PSJORUT2",128,0)
 .N IPOROP S IPOROP=$P(DDRUG,";",2)
"RTN","PSJORUT2",129,0)
 .S IPOROP=$S(IPOROP="PSO":";O",IPOROP="PSH":"N;O",1:";I")
"RTN","PSJORUT2",130,0)
 .S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$S($G(DDRUG(DDRUG)):DDRUG(DDRUG),1:$G(PSJORIEN))_U_$G(COD)_IPOROP
"RTN","PSJORUT2",131,0)
 S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$G(PSJORIEN)_U_$G(COD)_";I"
"RTN","PSJORUT2",132,0)
 Q
"RTN","PSJORUT2",133,0)
 ;
"RTN","PSJORUT2",134,0)
PRCHK(PSJ) ; Check if authorized to write med orders.
"RTN","PSJORUT2",135,0)
 N %,X
"RTN","PSJORUT2",136,0)
 D NOW^%DTC S X=$G(^VA(200,PSJ,"PS")) I $S('X:1,'$P(%,"^",4):0,1:$P(X,"^",4)'>%) Q 0
"RTN","PSJORUT2",137,0)
 Q PSJ
"RTN","PSJORUT2",138,0)
 ;
"RTN","PSJORUT2",139,0)
ENNG(PSJDPT,PSJNUM)          ; returns 1 if order marked "Not To Be Given"
"RTN","PSJORUT2",140,0)
 ;                                  0 if not marked
"RTN","PSJORUT2",141,0)
 I '$D(^PS(55,PSJDPT,5,+PSJNUM,0)) Q 0
"RTN","PSJORUT2",142,0)
 I $P($G(^PS(55,PSJDPT,5,+PSJNUM,0)),"^",22)=1 Q 1
"RTN","PSJORUT2",143,0)
 Q 0
"UP",50.8,50.805,-2)
50.8^2
"UP",50.8,50.805,-1)
50.803^2
"UP",50.8,50.805,0)
50.805
"VER")
8.0^22.0
"^DD",50.8,50.805,5,0)
DRUG UNIT^RS^1:ML;2:LITER;3:MCG;4:MG;5:GM;6:UNITS;7:IU;8:MEQ;9:MM;10:MU;11:THOUU;12:MG-PE;13:NANOGRAM;^0;6^Q
"^DD",50.8,50.805,5,20,0)
^.3LA^1^1
"^DD",50.8,50.805,5,20,1,0)
PSJI
"^DD",50.8,50.805,5,21,0)
^.001^1^1^3050718^^^^
"^DD",50.8,50.805,5,21,1,0)
  Unit of measure. This is used in calculating cost of drug.  
"^DD",50.8,50.805,5,"DT")
3050630
**INSTALL NAME**
PSS*1.0*100
"BLD",6330,0)
PSS*1.0*100^PHARMACY DATA MANAGEMENT^0^3051026^y
"BLD",6330,1,0)
^^2^2^3050718^
"BLD",6330,1,1,0)
This patch will add MG-PE & NANOGRAM to the DRUG UNIT field #2 of
"BLD",6330,1,2,0)
IV ADDITIVES file #52.6
"BLD",6330,4,0)
^9.64PA^52.6^1
"BLD",6330,4,52.6,0)
52.6
"BLD",6330,4,52.6,2,0)
^9.641^52.6^1
"BLD",6330,4,52.6,2,52.6,0)
IV ADDITIVES  (File-top level)
"BLD",6330,4,52.6,2,52.6,1,0)
^9.6411^2^1
"BLD",6330,4,52.6,2,52.6,1,2,0)
DRUG UNIT
"BLD",6330,4,52.6,222)
y^y^p^^^^n^^n
"BLD",6330,4,52.6,224)

"BLD",6330,4,"APDD",52.6,52.6)

"BLD",6330,4,"APDD",52.6,52.6,2)

"BLD",6330,4,"B",52.6,52.6)

"BLD",6330,"KRN",0)
^9.67PA^8989.52^19
"BLD",6330,"KRN",.4,0)
.4
"BLD",6330,"KRN",.401,0)
.401
"BLD",6330,"KRN",.402,0)
.402
"BLD",6330,"KRN",.403,0)
.403
"BLD",6330,"KRN",.5,0)
.5
"BLD",6330,"KRN",.84,0)
.84
"BLD",6330,"KRN",3.6,0)
3.6
"BLD",6330,"KRN",3.8,0)
3.8
"BLD",6330,"KRN",9.2,0)
9.2
"BLD",6330,"KRN",9.8,0)
9.8
"BLD",6330,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6330,"KRN",9.8,"NM",1,0)
PSSQOC^^0^9691622
"BLD",6330,"KRN",9.8,"NM","B","PSSQOC",1)

"BLD",6330,"KRN",19,0)
19
"BLD",6330,"KRN",19.1,0)
19.1
"BLD",6330,"KRN",101,0)
101
"BLD",6330,"KRN",409.61,0)
409.61
"BLD",6330,"KRN",771,0)
771
"BLD",6330,"KRN",870,0)
870
"BLD",6330,"KRN",8989.51,0)
8989.51
"BLD",6330,"KRN",8989.52,0)
8989.52
"BLD",6330,"KRN",8994,0)
8994
"BLD",6330,"KRN","B",.4,.4)

"BLD",6330,"KRN","B",.401,.401)

"BLD",6330,"KRN","B",.402,.402)

"BLD",6330,"KRN","B",.403,.403)

"BLD",6330,"KRN","B",.5,.5)

"BLD",6330,"KRN","B",.84,.84)

"BLD",6330,"KRN","B",3.6,3.6)

"BLD",6330,"KRN","B",3.8,3.8)

"BLD",6330,"KRN","B",9.2,9.2)

"BLD",6330,"KRN","B",9.8,9.8)

"BLD",6330,"KRN","B",19,19)

"BLD",6330,"KRN","B",19.1,19.1)

"BLD",6330,"KRN","B",101,101)

"BLD",6330,"KRN","B",409.61,409.61)

"BLD",6330,"KRN","B",771,771)

"BLD",6330,"KRN","B",870,870)

"BLD",6330,"KRN","B",8989.51,8989.51)

"BLD",6330,"KRN","B",8989.52,8989.52)

"BLD",6330,"KRN","B",8994,8994)

"BLD",6330,"QUES",0)
^9.62^^
"FIA",52.6)
IV ADDITIVES
"FIA",52.6,0)
^PS(52.6,
"FIA",52.6,0,0)
52.6I
"FIA",52.6,0,1)
y^y^p^^^^n^^n
"FIA",52.6,0,10)

"FIA",52.6,0,11)

"FIA",52.6,0,"RLRO")

"FIA",52.6,0,"VR")
1.0^PSS
"FIA",52.6,52.6)
1
"FIA",52.6,52.6,2)

"MBREQ")
0
"PKG",507,-1)
1^1
"PKG",507,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",507,20,0)
^9.402P^^
"PKG",507,22,0)
^9.49I^1^1
"PKG",507,22,1,0)
1.0^2970930^2980516^3585
"PKG",507,22,1,"PAH",1,0)
100^3051026^33249
"PKG",507,22,1,"PAH",1,1,0)
^^2^2^3051026
"PKG",507,22,1,"PAH",1,1,1,0)
This patch will add MG-PE & NANOGRAM to the DRUG UNIT field #2 of
"PKG",507,22,1,"PAH",1,1,2,0)
IV ADDITIVES file #52.6
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSSQOC")
0^1^B9691622
"RTN","PSSQOC",1,0)
PSSQOC ;BIR/MLM-CONVERT PSJ 4.5 QUICK ORDERS FOR USE IN OE/RR 3.0 ;09/09/97
"RTN","PSSQOC",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;*100*;9/30/97
"RTN","PSSQOC",3,0)
 ;External reference to ^ORD(101 supported by DBIA 872
"RTN","PSSQOC",4,0)
 ;External reference to ^PS(57.1 supported by DBIA 2139
"RTN","PSSQOC",5,0)
 ;
"RTN","PSSQOC",6,0)
EN(PROTIEN)        ;
"RTN","PSSQOC",7,0)
 N DD,OI,ND0,ND1,PSJBAD,TVOLUME,X S (PSJBAD,TVOLUME)=0 K ^TMP("PSJQO",$J)
"RTN","PSSQOC",8,0)
 S PSJQOPTR=+$E($P($P($G(^ORD(101,+PROTIEN,0)),U)," "),5,99)
"RTN","PSSQOC",9,0)
 S ND0=$G(^PS(57.1,PSJQOPTR,0)),ND1=$G(^(1)) I ND0=""!(ND1="") Q
"RTN","PSSQOC",10,0)
 I $P(ND0,U,3)'=1,$P(ND0,U,3)'=2 Q
"RTN","PSSQOC",11,0)
 D @$P(ND0,U,3) Q:'OI
"RTN","PSSQOC",12,0)
 S ^TMP("PSJQO",$J,1)=$P(ND0,U)_U_$P(ND0,U,3)_U_OI_U_$P(ND1,U,2,6)
"RTN","PSSQOC",13,0)
 S:$G(DD) ^TMP("PSJQO",$J,"DD")=DD
"RTN","PSSQOC",14,0)
 D GTPC
"RTN","PSSQOC",15,0)
 ;  check infusion rate
"RTN","PSSQOC",16,0)
 S X=$P(ND1,"^",5) I $G(X) D
"RTN","PSSQOC",17,0)
 .D ENI K FREQ I '$D(X) S PSJBAD=1
"RTN","PSSQOC",18,0)
 .E  S $P(^TMP("PSJQO",$J,1),"^",7)=X
"RTN","PSSQOC",19,0)
 K:PSJBAD=1 ^TMP("PSJQO",$J)
"RTN","PSSQOC",20,0)
 Q
"RTN","PSSQOC",21,0)
 ;
"RTN","PSSQOC",22,0)
1 ; Convert IV Fluid Quick Order
"RTN","PSSQOC",23,0)
 S CNT=0 F X=0:0 S X=$O(^PS(57.1,PSJQOPTR,3,X)) Q:'X  D
"RTN","PSSQOC",24,0)
 .S Y=$G(^PS(52.6,+$G(^PS(57.1,PSJQOPTR,3,X,0)),0)),OI=$P(Y,U,11)
"RTN","PSSQOC",25,0)
 .S UNITS=$P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM",U,+$P(Y,U,3))
"RTN","PSSQOC",26,0)
 .I OI]"" S CNT=CNT+1
"RTN","PSSQOC",27,0)
 .I  S ^TMP("PSJQO",$J,"AD",CNT,0)=OI_U_+$P($G(^PS(57.1,PSJQOPTR,3,X,0)),"^",2)_U_UNITS
"RTN","PSSQOC",28,0)
 I CNT S ^TMP("PSJQO",$J,"AD",0)=CNT_U_CNT
"RTN","PSSQOC",29,0)
 S CNT=0 F X=0:0 S X=$O(^PS(57.1,PSJQOPTR,4,X)) Q:'X  D
"RTN","PSSQOC",30,0)
 .S Y=$G(^PS(52.7,+$G(^PS(57.1,PSJQOPTR,4,X,0)),0)),OI=$P(Y,U,11)
"RTN","PSSQOC",31,0)
 .N VOL S VOL=$P($G(^PS(57.1,PSJQOPTR,4,X,0)),"^",2)
"RTN","PSSQOC",32,0)
 .S TVOLUME=TVOLUME++VOL
"RTN","PSSQOC",33,0)
 .I (VOL'=+VOL)&(VOL'?1.6N1" "1"ML") S PSJBAD=1
"RTN","PSSQOC",34,0)
 .I OI]"" S CNT=CNT+1
"RTN","PSSQOC",35,0)
 .I  S ^TMP("PSJQO",$J,"SOL",CNT,0)=OI_U_VOL
"RTN","PSSQOC",36,0)
 I CNT S ^TMP("PSJQO",$J,"SOL",0)=CNT_U_CNT
"RTN","PSSQOC",37,0)
 Q
"RTN","PSSQOC",38,0)
2 ;
"RTN","PSSQOC",39,0)
 S OI="",PD=+ND1
"RTN","PSSQOC",40,0)
 F DD=0:0 S DD=$O(^PSDRUG("AP",PD,DD)) Q:'DD  I $G(^PSDRUG(DD,"I"))=""!($G(^PSDRUG(DD,"I"))>DT) S OI=+$G(^PSDRUG(DD,2))
"RTN","PSSQOC",41,0)
 I '$O(^PSDRUG("AP",PD,DD)) S ^TMP("PSJQO",$J,"DD")=DD Q
"RTN","PSSQOC",42,0)
 S MATCH=1 F  S DD=$O(^PSDRUG("AP",PD,DD)) Q:'DD!'MATCH  D
"RTN","PSSQOC",43,0)
 .I ($G(^PSDRUG(DD,"I"))=""!($G(^PSDRUG(DD,"I"))>DT))&(+$G(^PSDRUG(DD,2))'=OI) S MATCH=0 Q
"RTN","PSSQOC",44,0)
 S:'MATCH OI=""
"RTN","PSSQOC",45,0)
 Q
"RTN","PSSQOC",46,0)
 ;
"RTN","PSSQOC",47,0)
 ;
"RTN","PSSQOC",48,0)
GTPC ; Set up TMP for provider comments    
"RTN","PSSQOC",49,0)
 I $O(^PS(57.1,+PSJQOPTR,2,0))  D
"RTN","PSSQOC",50,0)
 .S CNT=0 F X=0:0 S X=$O(^PS(57.1,+PSJQOPTR,2,X)) Q:'X  D
"RTN","PSSQOC",51,0)
 ..S Y=$G(^PS(57.1,PSJQOPTR,2,X,0)) S:Y]"" CNT=CNT+1,^TMP("PSJQO",$J,"PC",CNT,0)=Y
"RTN","PSSQOC",52,0)
 .S:$O(^TMP("PSJQO",$J,"PC",0)) ^TMP("PSJQO",$J,"PC",0)=CNT_U_CNT
"RTN","PSSQOC",53,0)
 Q
"RTN","PSSQOC",54,0)
ENI ;Calculate Frequency for IV orders
"RTN","PSSQOC",55,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSSQOC",56,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)),($P(X," ml/hr")'=+$P(X," ml/hr")!(+$P(X," ml/hr")<0)) K X Q
"RTN","PSSQOC",57,0)
 I X=+X S X=X_" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSSQOC",58,0)
 I X[" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSSQOC",59,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" S FREQ=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSSQOC",60,0)
 Q
"RTN","PSSQOC",61,0)
SPSOL S SPSOL=+TVOLUME Q
"VER")
8.0^22.0
"^DD",52.6,52.6,2,0)
DRUG UNIT^RS^1:ML;2:LITER;3:MCG;4:MG;5:GM;6:UNITS;7:IU;8:MEQ;9:MM;10:MU;11:THOUU;12:MG-PE;13:NANOGRAM;^0;3^Q
"^DD",52.6,52.6,2,1,0)
^.1^^0
"^DD",52.6,52.6,2,20,0)
^.3LA^1^1
"^DD",52.6,52.6,2,20,1,0)
PSJI
"^DD",52.6,52.6,2,21,0)
^.001^3^3^3050718^^^^
"^DD",52.6,52.6,2,21,1,0)
  You MUST enter a unit that this drug will be dispensed in most
"^DD",52.6,52.6,2,21,2,0)
frequently.  When entering or editing an additive, the user will be
"^DD",52.6,52.6,2,21,3,0)
forced to enter the strength using this unit.
"^DD",52.6,52.6,2,"DT")
3050718
**END**
**END**
