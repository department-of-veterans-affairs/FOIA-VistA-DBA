EMERGENCY Released PSO*7*134 SEQ #120
Extracted from mail message
**KIDS**:PSO*7.0*134^

**INSTALL NAME**
PSO*7.0*134
"BLD",4022,0)
PSO*7.0*134^OUTPATIENT PHARMACY^0^3030211^y
"BLD",4022,1,0)
^^6^6^3030211^
"BLD",4022,1,1,0)
1. When Pharmacy orders are entered through Computerized Patient Record 
"BLD",4022,1,2,0)
System (CPRS), certain order checks are performed by Pharmacy during 
"BLD",4022,1,3,0)
this process. One of the order checks is the duplicate drug class order
"BLD",4022,1,4,0)
check. The software is currently looking for an exact match of the 5
"BLD",4022,1,5,0)
characters that make up the drug class. It should only look for a match of
"BLD",4022,1,6,0)
the first 4 characters. This patch corrects the problem.
"BLD",4022,4,0)
^9.64PA^^
"BLD",4022,"KRN",0)
^9.67PA^8989.52^19
"BLD",4022,"KRN",.4,0)
.4
"BLD",4022,"KRN",.401,0)
.401
"BLD",4022,"KRN",.402,0)
.402
"BLD",4022,"KRN",.403,0)
.403
"BLD",4022,"KRN",.5,0)
.5
"BLD",4022,"KRN",.84,0)
.84
"BLD",4022,"KRN",3.6,0)
3.6
"BLD",4022,"KRN",3.8,0)
3.8
"BLD",4022,"KRN",9.2,0)
9.2
"BLD",4022,"KRN",9.8,0)
9.8
"BLD",4022,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4022,"KRN",9.8,"NM",1,0)
PSOORDRG^^0^B30101481
"BLD",4022,"KRN",9.8,"NM","B","PSOORDRG",1)

"BLD",4022,"KRN",19,0)
19
"BLD",4022,"KRN",19.1,0)
19.1
"BLD",4022,"KRN",101,0)
101
"BLD",4022,"KRN",409.61,0)
409.61
"BLD",4022,"KRN",771,0)
771
"BLD",4022,"KRN",870,0)
870
"BLD",4022,"KRN",8989.51,0)
8989.51
"BLD",4022,"KRN",8989.52,0)
8989.52
"BLD",4022,"KRN",8994,0)
8994
"BLD",4022,"KRN","B",.4,.4)

"BLD",4022,"KRN","B",.401,.401)

"BLD",4022,"KRN","B",.402,.402)

"BLD",4022,"KRN","B",.403,.403)

"BLD",4022,"KRN","B",.5,.5)

"BLD",4022,"KRN","B",.84,.84)

"BLD",4022,"KRN","B",3.6,3.6)

"BLD",4022,"KRN","B",3.8,3.8)

"BLD",4022,"KRN","B",9.2,9.2)

"BLD",4022,"KRN","B",9.8,9.8)

"BLD",4022,"KRN","B",19,19)

"BLD",4022,"KRN","B",19.1,19.1)

"BLD",4022,"KRN","B",101,101)

"BLD",4022,"KRN","B",409.61,409.61)

"BLD",4022,"KRN","B",771,771)

"BLD",4022,"KRN","B",870,870)

"BLD",4022,"KRN","B",8989.51,8989.51)

"BLD",4022,"KRN","B",8989.52,8989.52)

"BLD",4022,"KRN","B",8994,8994)

"BLD",4022,"QUES",0)
^9.62^^
"BLD",4022,"REQB",0)
^9.611^1^1
"BLD",4022,"REQB",1,0)
PSO*7.0*105^2
"BLD",4022,"REQB","B","PSO*7.0*105",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
134^3030211
"PKG",141,22,1,"PAH",1,1,0)
^^6^6^3030211
"PKG",141,22,1,"PAH",1,1,1,0)
1. When Pharmacy orders are entered through Computerized Patient Record 
"PKG",141,22,1,"PAH",1,1,2,0)
System (CPRS), certain order checks are performed by Pharmacy during 
"PKG",141,22,1,"PAH",1,1,3,0)
this process. One of the order checks is the duplicate drug class order
"PKG",141,22,1,"PAH",1,1,4,0)
check. The software is currently looking for an exact match of the 5
"PKG",141,22,1,"PAH",1,1,5,0)
characters that make up the drug class. It should only look for a match of
"PKG",141,22,1,"PAH",1,1,6,0)
the first 4 characters. This patch corrects the problem.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOORDRG")
0^1^B30101481
"RTN","PSOORDRG",1,0)
PSOORDRG ;BIR/SAB-order entry drug selection ;11/13/97
"RTN","PSOORDRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,29,49,46,81,105,134**;DEC 1997
"RTN","PSOORDRG",3,0)
 ;External references to ^PSJORUT2 supported by DBIA 2376
"RTN","PSOORDRG",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORDRG",5,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORDRG",6,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORDRG",7,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORDRG",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORDRG",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORDRG",10,0)
EN(PSODFN,DREN) ;
"RTN","PSOORDRG",11,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),PSOPHI S INDX=0
"RTN","PSOORDRG",12,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,INDX) ;build patient's drug profile inpat/outpat
"RTN","PSOORDRG",13,0)
 ;collect drug info
"RTN","PSOORDRG",14,0)
DRG ;S X=DREN,DIC="^PSDRUG(",DIC(0)="MQNZO" D ^DIC K DIC,PSOY Q:Y<1  S PSOY=Y,PSOY(0)=Y(0) K X,Y
"RTN","PSOORDRG",15,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0)) K X,Y
"RTN","PSOORDRG",16,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORDRG",17,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSOORDRG",18,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",19,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORDRG",20,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$P($G(^PSDRUG(+PSOY,2)),"^",4)
"RTN","PSOORDRG",21,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORDRG",22,0)
 K PSOX1,PSOY Q:$G(POERR)
"RTN","PSOORDRG",23,0)
 ;dup drug/class check
"RTN","PSOORDRG",24,0)
 S DNM=0 F  S DNM=$O(^TMP($J,"ORDERS",DNM)) Q:'DNM  D
"RTN","PSOORDRG",25,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DNM),"^",3)
"RTN","PSOORDRG",26,0)
 .I PSODRUG("NAME")=DRNM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5) Q:'$G(PSOPHI)
"RTN","PSOORDRG",27,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(^TMP($J,"ORDERS",DNM),"^"),1,4),DRNM'=PSODRUG("NAME") D
"RTN","PSOORDRG",28,0)
 ..S PSODC=$O(^PS(50.605,"B",PSODRUG("VA CLASS"),0)) Q:'PSODC
"RTN","PSOORDRG",29,0)
 ..S DC=$G(DC)+1,^TMP($J,"DC",DC,0)=PSODRUG("VA CLASS")
"RTN","PSOORDRG",30,0)
 ..S PSODC=$P(^PS(50.605,PSODC,0),"^",2),^TMP($J,"DC",DC,0)=^TMP($J,"DC",DC,0)_"^"_PSODC_"^"_$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5)
"RTN","PSOORDRG",31,0)
 ;drug interaction check
"RTN","PSOORDRG",32,0)
 S DRG=0 F  S DRG=$O(^TMP($J,"ORDERS",DRG)) Q:'DRG  S NDF=$P(^TMP($J,"ORDERS",DRG),"^",2),IT=$O(^PS(56,"APD",NDF,PSODRUG("NDF"),0)) I IT D
"RTN","PSOORDRG",33,0)
 .Q:$P(^PS(56,IT,0),"^",7)&($P(^PS(56,IT,0),"^",7)<DT)
"RTN","PSOORDRG",34,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DRG),"^",3),ORN=$P(^(DRG),"^",4),RXN=$P(^(DRG),"^",5)
"RTN","PSOORDRG",35,0)
 .S DI=$G(DI)+1,^TMP($J,"DI",DI,0)=$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_IT_"^"_$S($P(^PS(56,IT,0),"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"^"
"RTN","PSOORDRG",36,0)
 .S ^TMP($J,"DI",DI,0)=^TMP($J,"DI",DI,0)_$P(^PS(50.416,$P(^PS(56,IT,0),"^",2),0),"^")_"^"_$P(^PS(50.416,$P(^PS(56,IT,0),"^",3),0),"^")_"^"_ORN_"^"_RXN
"RTN","PSOORDRG",37,0)
 Q:$G(PSOPHI)
"RTN","PSOORDRG",38,0)
EXIT K ^TMP($J,"ORDERS"),DFN,DA,DNM,DUPRX0,RX,Y,ZZ,PSOCLOZ,PSOY,DRG,DNM,DD,DI,DC,IT,PSODRUG,PSOY,ORN,DRNM
"RTN","PSOORDRG",39,0)
 K PSOX,EXPDT,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,RXN
"RTN","PSOORDRG",40,0)
 Q
"RTN","PSOORDRG",41,0)
BLD K ^TMP($J,"ORDERS") I '$D(PSODFN)!('$D(DT)) G EXIT
"RTN","PSOORDRG",42,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X D BUILD G GETX
"RTN","PSOORDRG",43,0)
 Q
"RTN","PSOORDRG",44,0)
BUILD ;build profiles
"RTN","PSOORDRG",45,0)
 S EXPDT=PSODTCUT-1,RX=0
"RTN","PSOORDRG",46,0)
 F  S EXPDT=$O(^PS(55,PSODFN,"P","A",EXPDT)) Q:'EXPDT  F  S RX=$O(^PS(55,PSODFN,"P","A",EXPDT,RX)) Q:'RX  I $D(^PSRX(RX,0)) D GET
"RTN","PSOORDRG",47,0)
 S EN=0
"RTN","PSOORDRG",48,0)
 F PSOEN=0:0 S PSOEN=$O(^PS(52.41,"AOR",PSODFN,PSOEN)) Q:'PSOEN  D
"RTN","PSOORDRG",49,0)
 .F  S EN=$O(^PS(52.41,"AOR",PSODFN,PSOEN,EN)) Q:'EN  D
"RTN","PSOORDRG",50,0)
 ..S PSOOI=^PS(52.41,EN,0) I $P(PSOOI,"^",3)'="DC"&($P(PSOOI,"^",3)'="DE") D:'$P(^PS(52.41,EN,0),"^",9) BLDOI I $P(^PS(52.41,EN,0),"^",9) S PSODD=+$P(PSOOI,"^",9) D SETTMP
"RTN","PSOORDRG",51,0)
 D BUILDX
"RTN","PSOORDRG",52,0)
 Q
"RTN","PSOORDRG",53,0)
 ;
"RTN","PSOORDRG",54,0)
BLDOI ;If no DD/non-standard dose, get all drugs for OI
"RTN","PSOORDRG",55,0)
 N PSOI S PSOI=$P(PSOOI,"^",8) Q:'PSOOI
"RTN","PSOORDRG",56,0)
 S PSODD="" F  S PSODD=$O(^PSDRUG("ASP",PSOI,PSODD)) Q:'PSODD  D SETTMP
"RTN","PSOORDRG",57,0)
 Q
"RTN","PSOORDRG",58,0)
 ;
"RTN","PSOORDRG",59,0)
SETTMP ;Create ^TMP($J,"ORDERS"
"RTN","PSOORDRG",60,0)
 Q:$P(PSOOI,"^",3)="RF"
"RTN","PSOORDRG",61,0)
 S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:"") Q:DRG']""
"RTN","PSOORDRG",62,0)
 S INDX=INDX+1,^TMP($J,"ORDERS",INDX)=$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_DRG_"^"_$P(^PS(52.41,EN,0),"^")_"^"_EN_"P;O"
"RTN","PSOORDRG",63,0)
 Q
"RTN","PSOORDRG",64,0)
 ;
"RTN","PSOORDRG",65,0)
BUILDX K EN,PSOOI,PSODD,PSOEN Q
"RTN","PSOORDRG",66,0)
 ;
"RTN","PSOORDRG",67,0)
GET ;data for profiles
"RTN","PSOORDRG",68,0)
 S PSORX0=^PSRX(RX,0),PSOST0=+^("STA") Q:PSOST0>5&(PSOST0'=16)
"RTN","PSOORDRG",69,0)
 S PSORX2=$G(^PSRX(RX,2)),PSORX3=$G(^(3)),ORN=$P($G(^("OR1")),"^",2) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOORDRG",70,0)
 S PSODRUG=+$P(PSORX0,"^",6) Q:'$D(^PSDRUG(PSODRUG,0))
"RTN","PSOORDRG",71,0)
 S PSODRUG0=^PSDRUG(PSODRUG,0),PSOVACL=$P(PSODRUG0,"^",2)
"RTN","PSOORDRG",72,0)
 ;
"RTN","PSOORDRG",73,0)
 I EXPDT<DT D
"RTN","PSOORDRG",74,0)
 .N DIE,DIC,DR,DA S STAT="SC",DIE=52,DA=RX,DR="100////11" D ^DIE K DIE,DIC,DR,DA
"RTN","PSOORDRG",75,0)
 .D ECAN^PSOUTL(RX) S DA=RX
"RTN","PSOORDRG",76,0)
 .S COMM="Prescription Expired",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM)
"RTN","PSOORDRG",77,0)
 S INDX=INDX+1
"RTN","PSOORDRG",78,0)
 S ^TMP($J,"ORDERS",INDX)=PSOVACL_"^"_$S($G(^PSDRUG(PSODRUG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_$P(^PSDRUG(PSODRUG,0),"^")_"^"_ORN_"^"_RX_"R;O"
"RTN","PSOORDRG",79,0)
 Q
"RTN","PSOORDRG",80,0)
GETX ;
"RTN","PSOORDRG",81,0)
 K PSOX,EXPDT,PSODRUG,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,ORN
"RTN","PSOORDRG",82,0)
 Q
"RTN","PSOORDRG",83,0)
CLOZ ;
"RTN","PSOORDRG",84,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0,P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSOORDRG",85,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSOORDRG",86,0)
 K P(5),ANQRTN,ANQX,X
"RTN","PSOORDRG",87,0)
 Q
"RTN","PSOORDRG",88,0)
DRGCHK(PSODFN,DREN,DDRUG)    ;Only check DREN against drug in DDRG()
"RTN","PSOORDRG",89,0)
 ;* PSODFN = Patient's DFN
"RTN","PSOORDRG",90,0)
 ;* DREN   = Dispendse drug to be checked against the drug in the array
"RTN","PSOORDRG",91,0)
 ;* DDRUG  = The array of dispendse drug in the buffer.
"RTN","PSOORDRG",92,0)
 ;*
"RTN","PSOORDRG",93,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","PSOORDRG",94,0)
 NEW DDRUG0,DDRUGND,COD,PSJINX S COD="",PSJINX=0
"RTN","PSOORDRG",95,0)
 S DDRUG=0 F  S DDRUG=$O(DDRUG(DDRUG)) Q:'DDRUG  D DDRUG^PSJORUT2
"RTN","PSOORDRG",96,0)
 D DRG
"RTN","PSOORDRG",97,0)
 Q
"RTN","PSOORDRG",98,0)
OIDRG(PSODFN,PSOI) ;checks every drug tied to orderable item passed by package use
"RTN","PSOORDRG",99,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),DD,DC,DI N DREN S INDX=0,PSOPHI=1
"RTN","PSOORDRG",100,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,INDX) ;build patient's drug profile inpat/outpat
"RTN","PSOORDRG",101,0)
 F DREN=0:0 S DREN=$O(^PSDRUG("ASP",PSOI,DREN)) Q:'DREN  I $D(^PSDRUG(DREN,O)) D DRG
"RTN","PSOORDRG",102,0)
 K PSOPHI D EXIT
"RTN","PSOORDRG",103,0)
 Q
"VER")
8.0^22.0
**END**
**END**
