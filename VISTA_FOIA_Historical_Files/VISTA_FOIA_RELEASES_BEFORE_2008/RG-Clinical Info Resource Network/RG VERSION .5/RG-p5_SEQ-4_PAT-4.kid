Released RG*.5*4 SEQ #4
Extracted from mail message
**KIDS**:RG*0.5*4^

**INSTALL NAME**
RG*0.5*4
"BLD",701,0)
RG*0.5*4^CLINICAL INFO RESOURCE NETWORK^0^2991004^y
"BLD",701,1,0)
^^3^3^2991004^
"BLD",701,1,1,0)
 CMOR SCORE CALCULATION STATUS OPTION 
"BLD",701,1,2,0)
 Refer to patch RG*.5*4 in the FORUM Patch Module for a complete
"BLD",701,1,3,0)
 description.
"BLD",701,4,0)
^9.64PA^^
"BLD",701,"ABNS",0)
^9.66A^^
"BLD",701,"ABPKG")
^^
"BLD",701,"KRN",0)
^9.67PA^19^18
"BLD",701,"KRN",.4,0)
.4
"BLD",701,"KRN",.401,0)
.401
"BLD",701,"KRN",.402,0)
.402
"BLD",701,"KRN",.403,0)
.403
"BLD",701,"KRN",.5,0)
.5
"BLD",701,"KRN",.84,0)
.84
"BLD",701,"KRN",3.6,0)
3.6
"BLD",701,"KRN",3.8,0)
3.8
"BLD",701,"KRN",9.2,0)
9.2
"BLD",701,"KRN",9.8,0)
9.8
"BLD",701,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",701,"KRN",9.8,"NM",1,0)
RGVCCMR1^^0^B44379351
"BLD",701,"KRN",9.8,"NM","B","RGVCCMR1",1)

"BLD",701,"KRN",19,0)
19
"BLD",701,"KRN",19.1,0)
19.1
"BLD",701,"KRN",101,0)
101
"BLD",701,"KRN",409.61,0)
409.61
"BLD",701,"KRN",771,0)
771
"BLD",701,"KRN",869.2,0)
869.2
"BLD",701,"KRN",870,0)
870
"BLD",701,"KRN",8994,0)
8994
"BLD",701,"KRN","B",.4,.4)

"BLD",701,"KRN","B",.401,.401)

"BLD",701,"KRN","B",.402,.402)

"BLD",701,"KRN","B",.403,.403)

"BLD",701,"KRN","B",.5,.5)

"BLD",701,"KRN","B",.84,.84)

"BLD",701,"KRN","B",3.6,3.6)

"BLD",701,"KRN","B",3.8,3.8)

"BLD",701,"KRN","B",9.2,9.2)

"BLD",701,"KRN","B",9.8,9.8)

"BLD",701,"KRN","B",19,19)

"BLD",701,"KRN","B",19.1,19.1)

"BLD",701,"KRN","B",101,101)

"BLD",701,"KRN","B",409.61,409.61)

"BLD",701,"KRN","B",771,771)

"BLD",701,"KRN","B",869.2,869.2)

"BLD",701,"KRN","B",870,870)

"BLD",701,"KRN","B",8994,8994)

"BLD",701,"QUES",0)
^9.62^^
"BLD",701,"REQB",0)
^9.611^1^1
"BLD",701,"REQB",1,0)
RG*0.5*3^2
"BLD",701,"REQB","B","RG*0.5*3",1)

"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
0.5^2980930
"PKG",272,22,1,"PAH",1,0)
4^2991004
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^2991004
"PKG",272,22,1,"PAH",1,1,1,0)
 CMOR SCORE CALCULATION STATUS OPTION 
"PKG",272,22,1,"PAH",1,1,2,0)
 Refer to patch RG*.5*4 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
 description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RGVCCMR1")
0^1^B44379351
"RTN","RGVCCMR1",1,0)
RGVCCMR1 ;GAI/TMG-CIRN CMOR ACTIVITY SCORE GENERATOR (PART 1) ;01/15/98
"RTN","RGVCCMR1",2,0)
 ;;0.5; CLINICAL INFO RESOURCE NETWORK ;**1,2,3,4**;30 Sep 98
"RTN","RGVCCMR1",3,0)
EN ;  this routine contains entry points to start/restart the batch cmor
"RTN","RGVCCMR1",4,0)
 ;  score initialization, flag a running
"RTN","RGVCCMR1",5,0)
 ;  initialization to stop, calculate and file an activity score for an
"RTN","RGVCCMR1",6,0)
 ;  individual patient, and display the status of the cmor initialization 
"RTN","RGVCCMR1",7,0)
START ; entry point to start or restart the cmor activity score initialization
"RTN","RGVCCMR1",8,0)
 N RGY
"RTN","RGVCCMR1",9,0)
 S U="^"
"RTN","RGVCCMR1",10,0)
 S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",11,0)
 I '(+$P(NODE,U)) D  G QUIT
"RTN","RGVCCMR1",12,0)
 .W !!,"This is the initial run of the CIRN CMOR patient activity score generator."
"RTN","RGVCCMR1",13,0)
 .S RUNTYPE="I",RGDFN=0 D TASK
"RTN","RGVCCMR1",14,0)
 S STATUS=$P(NODE,U,7)
"RTN","RGVCCMR1",15,0)
 I STATUS="R" D  I RUN G QUIT
"RTN","RGVCCMR1",16,0)
 .S RUN=0
"RTN","RGVCCMR1",17,0)
 .S ZTSK=+$P(NODE,U,9)
"RTN","RGVCCMR1",18,0)
 .I 'ZTSK D INT Q
"RTN","RGVCCMR1",19,0)
 .D STAT^%ZTLOAD
"RTN","RGVCCMR1",20,0)
 .I ZTSK(1)=0!(ZTSK(1)=3)!(ZTSK(1)=4) D INT Q
"RTN","RGVCCMR1",21,0)
 .I ZTSK(1)=1 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"is waiting to run.  Do not start another job at this time." S RUN=1 Q
"RTN","RGVCCMR1",22,0)
 .I ZTSK(1)=2 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"is currently running.  Do not start another job at this time." S RUN=1 Q
"RTN","RGVCCMR1",23,0)
 .I ZTSK(1)=5 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"was interrupted abnormally, possibly from a system error." D INT
"RTN","RGVCCMR1",24,0)
 I STATUS="SN" D
"RTN","RGVCCMR1",25,0)
 .S STOPDT=$P(NODE,U,3) I +STOPDT D
"RTN","RGVCCMR1",26,0)
 ..S STOPDT=$$FMTE^XLFDT(STOPDT,"1P")
"RTN","RGVCCMR1",27,0)
 ..W !!,"The CIRN CMOR patient activity score generator",!,"completed successfully on ",STOPDT,"."
"RTN","RGVCCMR1",28,0)
 .W !
"RTN","RGVCCMR1",29,0)
 .S DIR(0)="Y",DIR("A")="Would you like to reset all patient activity scores",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",30,0)
 .I RGY=1 S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",31,0)
 .I RGY=1 S RUNTYPE="R",RGDFN=0 D TASK
"RTN","RGVCCMR1",32,0)
 I STATUS="SM"!(STATUS="INT") D 
"RTN","RGVCCMR1",33,0)
 .S STOPDT=$P(NODE,U,3) D
"RTN","RGVCCMR1",34,0)
 ..I +STOPDT S STOPDT=$$FMTE^XLFDT(STOPDT,"1P")
"RTN","RGVCCMR1",35,0)
 ..W !!,"The CIRN CMOR patient activity score generator was "
"RTN","RGVCCMR1",36,0)
 ..W:STATUS="SM" ! W $S(STATUS="SM":"STOPPED MANUALLY",1:"INTERRUPTED ABNORMALLY.") I STATUS="SM" W " on ",STOPDT,"."
"RTN","RGVCCMR1",37,0)
 .I +$P(NODE,U) D
"RTN","RGVCCMR1",38,0)
 ..S LASTDFN=$P(NODE,U),LASTPT=$P($G(^DPT(+LASTDFN,0)),U),LASTSSN=$P(^(0),U,9)
"RTN","RGVCCMR1",39,0)
 ..W !,"The last patient processed was ",LASTPT,"   SSN: ",LASTSSN,!?31,"[RECORD# ",LASTDFN,"]"
"RTN","RGVCCMR1",40,0)
 .W ! S DIR(0)="Y",DIR("A")="Would you like to start with this patient and continue",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",41,0)
 .W ! I RGY=1 D
"RTN","RGVCCMR1",42,0)
 ..S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure"
"RTN","RGVCCMR1",43,0)
 ..S DIR("B")="N" D ^DIR I Y=1 S RUNTYPE="RS",RGDFN=LASTDFN D TASK
"RTN","RGVCCMR1",44,0)
 .W ! I RGY=0 D
"RTN","RGVCCMR1",45,0)
 ..S DIR(0)="Y",DIR("A")="Would you like to rerun the CMOR calculation for all patients"
"RTN","RGVCCMR1",46,0)
 ..S DIR("B")="N" D ^DIR I Y=1 D
"RTN","RGVCCMR1",47,0)
 ...W ! S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure",DIR("B")="N" D ^DIR I Y=1 S RUNTYPE="RS",RGDFN=0 D TASK
"RTN","RGVCCMR1",48,0)
 G QUIT
"RTN","RGVCCMR1",49,0)
STOP ;  entry point to flag a running cmor score initialization to stop
"RTN","RGVCCMR1",50,0)
 S U="^"
"RTN","RGVCCMR1",51,0)
 S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",52,0)
 I $P(NODE,U,7)'="R" W !,"The CIRN CMOR activity score generation is NOT running." G QUIT
"RTN","RGVCCMR1",53,0)
 W !,"This option will stop the CIRN CMOR patient activity score generation"
"RTN","RGVCCMR1",54,0)
 W !,"after it has completed calculating and filing the score for the current"
"RTN","RGVCCMR1",55,0)
 W !,"patient."
"RTN","RGVCCMR1",56,0)
 W ! S DIR("A")="Are you sure you want to do this",DIR("B")="N",DIR(0)="Y" D ^DIR K DIR S RGY=Y
"RTN","RGVCCMR1",57,0)
 W ! S DIR("A")="Stop patient activity score generation after the current patient",DIR("B")="N",DIR(0)="Y" D ^DIR S RGY=Y
"RTN","RGVCCMR1",58,0)
 ;I RGY=1 S DA=1,DIE="^RGSITE(991.8,",DR="21////Y;24////SM" D ^DIE
"RTN","RGVCCMR1",59,0)
 I RGY=1 D
"RTN","RGVCCMR1",60,0)
 .S $P(^RGSITE(991.8,1,"CMOR"),U,4)="Y"
"RTN","RGVCCMR1",61,0)
 .W !!,"CIRN CMOR patient activity generation is flagged to stop after"
"RTN","RGVCCMR1",62,0)
 .W !,"it has completed the current patient.  This may take a short time."
"RTN","RGVCCMR1",63,0)
 .W !,"Please check the status later."
"RTN","RGVCCMR1",64,0)
 G QUIT
"RTN","RGVCCMR1",65,0)
INDIV ;  entry point to allow a cmor score for an individual patient to be
"RTN","RGVCCMR1",66,0)
 ;  calculated and filed
"RTN","RGVCCMR1",67,0)
 N MNODE
"RTN","RGVCCMR1",68,0)
 S U="^"
"RTN","RGVCCMR1",69,0)
 S DIC="^DPT(",DIC(0)="AEQMNZ" D ^DIC K DIC Q:+Y<0  S RGDFN=+Y
"RTN","RGVCCMR1",70,0)
 S PTNAM=$P(Y(0),"^"),SSN=$P(Y(0),"^",9),FILE=1
"RTN","RGVCCMR1",71,0)
 S MNODE=$$MPINODE^MPIFAPI(RGDFN)
"RTN","RGVCCMR1",72,0)
 I $P($G(MNODE),U,7)'="" D
"RTN","RGVCCMR1",73,0)
 .S FILE=0
"RTN","RGVCCMR1",74,0)
 .S SCOREDT=$$FMTE^XLFDT($P(MNODE,U,7),"1P")
"RTN","RGVCCMR1",75,0)
 .S CURSCORE=$P(MNODE,U,6) W !!,"This patient has an existing CMOR score of ",+CURSCORE," calculated on ",SCOREDT,".",!
"RTN","RGVCCMR1",76,0)
 .S DIR(0)="Y",DIR("A")="Do you want to calculate and file a new score for this patient",DIR("B")="NO" D ^DIR I Y=1 S FILE=1
"RTN","RGVCCMR1",77,0)
 I FILE=1 D
"RTN","RGVCCMR1",78,0)
 .W !!,"Working.  Please standby..." S FILEFLG=0 D CALC^RGVCCMR2
"RTN","RGVCCMR1",79,0)
 .I 'FILEFLG W !!,"No Patient Activity in the Past Three Years - No Score Filed!" Q
"RTN","RGVCCMR1",80,0)
 .W !!,"CMOR Activity Score: ",SCORE," filed for ",PTNAM,"  SSN: ",SSN,"."
"RTN","RGVCCMR1",81,0)
 G QUIT
"RTN","RGVCCMR1",82,0)
DISPLAY ;  displays the status of the background cmor score initialization
"RTN","RGVCCMR1",83,0)
 W !,"The CIRN CMOR Activity Score Generator",!
"RTN","RGVCCMR1",84,0)
 ;count number of CMOR scores"
"RTN","RGVCCMR1",85,0)
 W !,"..one moment please...",!
"RTN","RGVCCMR1",86,0)
 S (SCORE,CNT)=0
"RTN","RGVCCMR1",87,0)
 F  S SCORE=$O(^DPT("ACMORS",SCORE)) Q:'SCORE  D
"RTN","RGVCCMR1",88,0)
 .S RGDFN=0 F  S RGDFN=$O(^DPT("ACMORS",SCORE,RGDFN)) Q:'RGDFN  D
"RTN","RGVCCMR1",89,0)
 ..S CNT=CNT+1
"RTN","RGVCCMR1",90,0)
 W !,"There are ",$P(^DPT(0),U,4)," records in your PATIENT file."
"RTN","RGVCCMR1",91,0)
 W !,"The last record number is ",$P(^DPT(0),U,3),"."
"RTN","RGVCCMR1",92,0)
 I $P($G(^RGSITE(991.8,1,"CMOR")),U)'="" D CHKSTAT
"RTN","RGVCCMR1",93,0)
 I $P($G(^RGSITE(991.8,1,"CMOR")),U)="" D
"RTN","RGVCCMR1",94,0)
 . W !,"The CMOR Calculation has NEVER been run on your system."
"RTN","RGVCCMR1",95,0)
 G QUIT
"RTN","RGVCCMR1",96,0)
CHKSTAT S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",97,0)
 S PTNAM="-Unknown-",SSN="---"
"RTN","RGVCCMR1",98,0)
 S RGDFN=+NODE I RGDFN,$D(^DPT(RGDFN,0)) D
"RTN","RGVCCMR1",99,0)
 .S PTNAM=$P(^(0),U),SSN=$P(^(0),U,9)
"RTN","RGVCCMR1",100,0)
 S OSTARTED="UNSPECIFIED" I $P(NODE,U,2)'="" D
"RTN","RGVCCMR1",101,0)
 .S OSTARTED=$$FMTE^XLFDT($P(NODE,U,2),"1P")
"RTN","RGVCCMR1",102,0)
 S OSTOPPED="UNSPECIFIED" I $P(NODE,U,3)'="" D
"RTN","RGVCCMR1",103,0)
 .S OSTOPPED=$$FMTE^XLFDT($P(NODE,U,3),"1P")
"RTN","RGVCCMR1",104,0)
 S ORESTART=$G(^XTMP("RGVCCMR","@@@@","RESTARTED"))
"RTN","RGVCCMR1",105,0)
 I +ORESTART S ORESTART=$$FMTE^XLFDT(ORESTART,"1P")
"RTN","RGVCCMR1",106,0)
 S ODFNCT=""
"RTN","RGVCCMR1",107,0)
 I $D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) S ODFNCT=^XTMP("RGVCCMR","@@@@","DFNCOUNT")
"RTN","RGVCCMR1",108,0)
STATUS S ST=$P(NODE,U,7)
"RTN","RGVCCMR1",109,0)
 ;if status is RUNNING, check to see if task errored out
"RTN","RGVCCMR1",110,0)
 I ST="R" D
"RTN","RGVCCMR1",111,0)
 .S ZTSK=$P(NODE,U,9) I $D(ZTSK) D
"RTN","RGVCCMR1",112,0)
 ..D STAT^%ZTLOAD
"RTN","RGVCCMR1",113,0)
 ..I ZTSK(1)=5 D INT S ST="INT"
"RTN","RGVCCMR1",114,0)
 S STATUS=$S(ST="R":"RUNNING.",ST="SM":"STOPPED MANUALLY",ST="SN":"SUCCESSFULLY COMPLETED",ST="INT":"INTERRUPTED ABNORMALLY.",1:"- NO STATUS LISTED -")
"RTN","RGVCCMR1",115,0)
 ;S PERCOMP=((ODFNCT/$P(^DPT(0),U,4))*100),PERCOMP=$P(PERCOMP,".")_"."_$E($P(PERCOMP,".",2),1,2)
"RTN","RGVCCMR1",116,0)
 W !,"Last Patient Processed: ",PTNAM,"   SSN: ",SSN,"   [RECORD# ",RGDFN,"]"
"RTN","RGVCCMR1",117,0)
 W !!,"The CMOR score initialization last started on ",OSTARTED,"."
"RTN","RGVCCMR1",118,0)
 I ORESTART]"" W !,"Job was restarted on ",ORESTART,"."
"RTN","RGVCCMR1",119,0)
 I +ODFNCT W !,ODFNCT," patient records have been processed."
"RTN","RGVCCMR1",120,0)
 W !,"Status: ",STATUS I ST'="R"&(ST'="INT") W " on ",OSTOPPED,"."
"RTN","RGVCCMR1",121,0)
 W !,"CMOR Score Count: ",CNT
"RTN","RGVCCMR1",122,0)
 ;
"RTN","RGVCCMR1",123,0)
 G QUIT
"RTN","RGVCCMR1",124,0)
 ;
"RTN","RGVCCMR1",125,0)
INT ;Set status to INTERRUPTED for abnormally stopped jobs
"RTN","RGVCCMR1",126,0)
 S $P(^RGSITE(991.8,1,"CMOR"),"^",7)="INT"
"RTN","RGVCCMR1",127,0)
 S STATUS="INT"
"RTN","RGVCCMR1",128,0)
 Q
"RTN","RGVCCMR1",129,0)
TASK S ZTIO="",ZTRTN="^RGVCCMR2",ZTDESC="BACKGROUND CMOR SCORE CALCULATOR"
"RTN","RGVCCMR1",130,0)
 S (ZTSAVE("RUNTYPE"),ZTSAVE("RGDFN"))=""
"RTN","RGVCCMR1",131,0)
 ; change ztsave("*")="" to specific variables when done
"RTN","RGVCCMR1",132,0)
 D ^%ZTLOAD
"RTN","RGVCCMR1",133,0)
 I $D(ZTSK) W "   Task#, ",ZTSK," queued" S $P(^RGSITE(991.8,1,"CMOR"),U,9)=ZTSK
"RTN","RGVCCMR1",134,0)
 D ^%ZISC
"RTN","RGVCCMR1",135,0)
 Q
"RTN","RGVCCMR1",136,0)
QUIT K RGDFN,DIC,DIR,FILE,LASTDFN,LASTPT,LASTSSN,ODFNCT,ORESTART,OSTARTED
"RTN","RGVCCMR1",137,0)
 K OSTOPPED,PTNAM,RUNTYPE,SCORE,SSN,ST,STATUS,X,Y,%DT,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","RGVCCMR1",138,0)
 K CURSCORE,SCOREDT,NODE,STOPDT,FILEFLG,SCORE,CNT,RGDFN,RUN
"RTN","RGVCCMR1",139,0)
 Q
"VER")
8.0^21.0
**END**
**END**
