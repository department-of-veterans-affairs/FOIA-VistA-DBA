Released LBR*2.5*6 SEQ #5
Extracted from mail message
**KIDS**:LBR*2.5*6^

**INSTALL NAME**
LBR*2.5*6
"BLD",925,0)
LBR*2.5*6^LIBRARY - 2.5^0^^y
"BLD",925,1,0)
^^2^2^2980903^
"BLD",925,1,1,0)
This patch makes the VistA portion of the Library Package Year 2000
"BLD",925,1,2,0)
compliant.
"BLD",925,4,0)
^9.64PA^^
"BLD",925,"ABPKG")
n
"BLD",925,"KRN",0)
^9.67PA^19^18
"BLD",925,"KRN",.4,0)
.4
"BLD",925,"KRN",.401,0)
.401
"BLD",925,"KRN",.402,0)
.402
"BLD",925,"KRN",.403,0)
.403
"BLD",925,"KRN",.5,0)
.5
"BLD",925,"KRN",.84,0)
.84
"BLD",925,"KRN",3.6,0)
3.6
"BLD",925,"KRN",3.8,0)
3.8
"BLD",925,"KRN",9.2,0)
9.2
"BLD",925,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",925,"KRN",9.8,0)
9.8
"BLD",925,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",925,"KRN",9.8,"NM",1,0)
LBRYUTL^^0^B8862657
"BLD",925,"KRN",9.8,"NM",2,0)
LBRYPPR^^0^B15392736
"BLD",925,"KRN",9.8,"NM","B","LBRYPPR",2)

"BLD",925,"KRN",9.8,"NM","B","LBRYUTL",1)

"BLD",925,"KRN",19,0)
19
"BLD",925,"KRN",19.1,0)
19.1
"BLD",925,"KRN",101,0)
101
"BLD",925,"KRN",409.61,0)
409.61
"BLD",925,"KRN",771,0)
771
"BLD",925,"KRN",869.2,0)
869.2
"BLD",925,"KRN",870,0)
870
"BLD",925,"KRN",8994,0)
8994
"BLD",925,"KRN","B",.4,.4)

"BLD",925,"KRN","B",.401,.401)

"BLD",925,"KRN","B",.402,.402)

"BLD",925,"KRN","B",.403,.403)

"BLD",925,"KRN","B",.5,.5)

"BLD",925,"KRN","B",.84,.84)

"BLD",925,"KRN","B",3.6,3.6)

"BLD",925,"KRN","B",3.8,3.8)

"BLD",925,"KRN","B",9.2,9.2)

"BLD",925,"KRN","B",9.8,9.8)

"BLD",925,"KRN","B",19,19)

"BLD",925,"KRN","B",19.1,19.1)

"BLD",925,"KRN","B",101,101)

"BLD",925,"KRN","B",409.61,409.61)

"BLD",925,"KRN","B",771,771)

"BLD",925,"KRN","B",869.2,869.2)

"BLD",925,"KRN","B",870,870)

"BLD",925,"KRN","B",8994,8994)

"BLD",925,"PRE")
LBR256EN
"BLD",925,"QUES",0)
^9.62^^
"BLD",925,"REQB",0)
^9.611^1^1
"BLD",925,"REQB",1,0)
LBR*2.5*2^2
"BLD",925,"REQB","B","LBR*2.5*2",1)

"PKG",121,-1)
1^1
"PKG",121,0)
LIBRARY - 2.5^LBR^LIBRARY SERIALS PACKAGE^LBRY MANAGEMENT
"PKG",121,22,0)
^9.49I^1^1
"PKG",121,22,1,0)
2.5^2951219^2960823
"PKG",121,22,1,"PAH",1,0)
6^2980903^3
"PKG",121,22,1,"PAH",1,1,0)
^^2^2^2980908
"PKG",121,22,1,"PAH",1,1,1,0)
This patch makes the VistA portion of the Library Package Year 2000
"PKG",121,22,1,"PAH",1,1,2,0)
compliant.
"PRE")
LBR256EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LBR256EN")
0^^B3689422
"RTN","LBR256EN",1,0)
LBR256EN ;SSI/KMB-ENVIRONMENT CHECK FOR LBR*2.5*6 ;[ 09/08/98  4:03 PM ]
"RTN","LBR256EN",2,0)
 ;;2.5;Library;**6**;Mar 11, 1996
"RTN","LBR256EN",3,0)
 ;;
"RTN","LBR256EN",4,0)
 ;; This is the environment check routine for LBR*2.5*6.
"RTN","LBR256EN",5,0)
 ;; It checks for the Library version 2.5 installation.
"RTN","LBR256EN",6,0)
 ;;
"RTN","LBR256EN",7,0)
 ;; 
"RTN","LBR256EN",8,0)
ST ; confirm DUZ(0) is set to '@'
"RTN","LBR256EN",9,0)
 I '$G(DUZ)!($G(DUZ(0))'["@") D  Q
"RTN","LBR256EN",10,0)
 . D BMES^XPDUTL("USER 'DUZ' VARIABLES **NOT** CORRECTLY DEFINED.")
"RTN","LBR256EN",11,0)
 . D MES^XPDUTL("CONFIRM THAT DUZ(0)='@'.  THEN D ^XUP.")
"RTN","LBR256EN",12,0)
 . D MES^XPDUTL("  ")
"RTN","LBR256EN",13,0)
 . S XPDQUIT=2
"RTN","LBR256EN",14,0)
 ;
"RTN","LBR256EN",15,0)
PFILE ; get IENs for all LBR* Package File entries
"RTN","LBR256EN",16,0)
 N LBRPACK
"RTN","LBR256EN",17,0)
 D FIND^DIC(9.4,"","1","","LBR","*","C","","","LBRPACK")
"RTN","LBR256EN",18,0)
 ;
"RTN","LBR256EN",19,0)
LBRS ; loop through FIND global LBRPACK
"RTN","LBR256EN",20,0)
 ; get Package File IEN's for all LBR* entries
"RTN","LBR256EN",21,0)
 N LBRND,LBR25OK,LBRPDA,LBRVER
"RTN","LBR256EN",22,0)
 S (LBRND,LBR25OK)=0
"RTN","LBR256EN",23,0)
 F  Q:LBR25OK  S LBRND=$O(LBRPACK("DILIST",2,LBRND)) Q:LBRND=""  D
"RTN","LBR256EN",24,0)
 . ; get IEN for package file entry
"RTN","LBR256EN",25,0)
 . S LBRPDA=LBRPACK("DILIST",2,LBRND)
"RTN","LBR256EN",26,0)
 . ; create list of VERSION entries for each package file entry
"RTN","LBR256EN",27,0)
 . D FIND^DIC(9.49,","_LBRPDA_",","","Q","2.5V1","","B","","","LBRVER")
"RTN","LBR256EN",28,0)
 . ; check if 2.5V1 entry in version multiple if not go to next one
"RTN","LBR256EN",29,0)
 . I $P($G(LBRVER("DILIST",0)),U)'>0 Q
"RTN","LBR256EN",30,0)
 . ; if 2.5V1 multiple found, set OK flag
"RTN","LBR256EN",31,0)
 . S LBR25OK=1
"RTN","LBR256EN",32,0)
 ;
"RTN","LBR256EN",33,0)
 ; version 2.5 install check
"RTN","LBR256EN",34,0)
 I 'LBR25OK D  Q
"RTN","LBR256EN",35,0)
 . D BMES^XPDUTL("Version 2.5 is required for patch LBR*2.5*6 installation.")
"RTN","LBR256EN",36,0)
 . S XPDQUIT=2
"RTN","LBR256EN",37,0)
 ;
"RTN","LBR256EN",38,0)
EXIT ; environment successfull
"RTN","LBR256EN",39,0)
 D BMES^XPDUTL("     >> Environment check complete and okay.")
"RTN","LBR256EN",40,0)
 D MES^XPDUTL(" ")
"RTN","LBR256EN",41,0)
 Q
"RTN","LBRYPPR")
0^2^B15392736
"RTN","LBRYPPR",1,0)
LBRYPPR ;ISC2/DJM-PREDICTION PATTERN ROUTINE ;[ 09/03/98  3:03 PM ]
"RTN","LBRYPPR",2,0)
 ;;2.5;Library;**2,6**;Mar 11, 1996
"RTN","LBRYPPR",3,0)
 ;
"RTN","LBRYPPR",4,0)
START K LBRYEF1 S LBRYPP=$P(^LBRY(680.5,LBRYCLS,0),U,3) Q:LBRYPP=""  S LBNM=""
"RTN","LBRYPPR",5,0)
 I +LBRYPP'=LBRYPP!(LBRYPP<1) Q  ;COULD NOT RESOLVE PREDICTION PATTERN, PLEASE INSERT
"RTN","LBRYPPR",6,0)
 S LBA1=""
"RTN","LBRYPPR",7,0)
LDT S LBA1=$O(^LBRY(682,"A1",LBRYLOC,LBA1)) Q:LBA1'>0
"RTN","LBRYPPR",8,0)
 S LBJD=""
"RTN","LBRYPPR",9,0)
LBJ S LBJD=$O(^LBRY(682,"A1",LBRYLOC,LBA1,LBJD)) G LDT:LBJD=""
"RTN","LBRYPPR",10,0)
 S LBJD=$G(^LBRY(682,LBJD,1)) I $P(LBJD,U,8)="P" S LBJDT=$P(LBJD,U)
"RTN","LBRYPPR",11,0)
 I $G(LBJDT)="" G LBJ
"RTN","LBRYPPR",12,0)
GET S LBNM="",LBRYPP0=^LBRY(680.9,LBRYPP,0),LBRYPP3=$G(^LBRY(680.9,LBRYPP,3))
"RTN","LBRYPPR",13,0)
 S LBRYPP2=$G(^LBRY(680.9,LBRYPP,2))
"RTN","LBRYPPR",14,0)
BEGIN S X1=DT,X2=LBJDT
"RTN","LBRYPPR",15,0)
 S PUD=$S($P(^LBRY(680,LBRYLOC,0),U,3)'="":$P(^(0),U,3),1:5)
"RTN","LBRYPPR",16,0)
 D ^%DTC Q:X+PUD<0
"RTN","LBRYPPR",17,0)
 S LBJDY=+$E(LBJDT,1,3),LBJDM=+$E(LBJDT,4,5),LBJDD=+$E(LBJDT,6,7)
"RTN","LBRYPPR",18,0)
 S LBX=+LBJDM,LBY=$P(LBRYPP0,U,3) I LBX="" G ERROR1
"RTN","LBRYPPR",19,0)
 D FIND G:LBZ>0 TYPE
"RTN","LBRYPPR",20,0)
 S LBRYEF1=1
"RTN","LBRYPPR",21,0)
 Q
"RTN","LBRYPPR",22,0)
TYPE S LBMOZ=LBZ G:$P(LBRYPP0,U,5)]"" DOM
"RTN","LBRYPPR",23,0)
 G:$P(LBRYPP3,U)]"" DOW G:$P(LBRYPP0,U,4)]"" ADDED
"RTN","LBRYPPR",24,0)
 D NEXT S LBNM=1 I $P(LBN,U,2)]"" S LBJDY=LBJDY+1
"RTN","LBRYPPR",25,0)
 S LBN=+LBN S:$L(LBN)=1 LBN="0"_LBN S LBJDT=LBJDY_LBN_"00"
"RTN","LBRYPPR",26,0)
 G ^LBRYPPR0
"RTN","LBRYPPR",27,0)
DOM S EM=LBJDM D EOM G:LBJDD=LBEM NXT S LBX=+LBJDD,LBY=$P(LBRYPP0,U,5)
"RTN","LBRYPPR",28,0)
 I LBX="" G ERROR2
"RTN","LBRYPPR",29,0)
 D FIND G:LBZ<1 DOM1 D NEXT G:$P(LBN,U,2)]"" NXT0 S LBJDD=LBN
"RTN","LBRYPPR",30,0)
DOMA I LBEM<LBJDD S LBJDD=LBEM G TYPE1
"RTN","LBRYPPR",31,0)
 S LBJDD=LBN G TYPE1
"RTN","LBRYPPR",32,0)
TYPE1 S:$L(LBJDD)=1 LBJDD="0"_LBJDD S:$L(LBJDM)=1 LBJDM="0"_LBJDM
"RTN","LBRYPPR",33,0)
 S LBJDT=LBJDY_LBJDM_LBJDD
"RTN","LBRYPPR",34,0)
 G ^LBRYPPR0
"RTN","LBRYPPR",35,0)
NXT0 S LBY=$P(LBRYPP0,U,3),LBZ=LBMOZ
"RTN","LBRYPPR",36,0)
NXT D NEXT S:$P(LBN,U,2)]"" LBJDY=LBJDY+1 S (LBJDM,EM)=+LBN,LBNM=1
"RTN","LBRYPPR",37,0)
 S LBJDD=$P($P(LBRYPP0,U,5),",",2) D EOM G:LBJDD'>LBEM TYPE1
"RTN","LBRYPPR",38,0)
 S LBJDD=LBEM
"RTN","LBRYPPR",39,0)
 G TYPE1
"RTN","LBRYPPR",40,0)
DOM1 S LBDOM=$P(LBRYPP0,U,5)
"RTN","LBRYPPR",41,0)
 F I=2:1 S LBN=$P(LBDOM,",",I) G:LBN="" NXT0 G:LBN>LBJDD DOMA
"RTN","LBRYPPR",42,0)
DOW G:LBJDD=0 ERROR3 S X=LBJDT D DW^%DTC
"RTN","LBRYPPR",43,0)
 S YY=LBJDD\7,YY=$S(LBJDD#7=0:YY,1:YY+1),LBX=YY_"/"_Y
"RTN","LBRYPPR",44,0)
 S LBY=$P(LBRYPP3,U),EM=LBJDM D EOM,FIND S LBWKZ=LBZ G:LBZ<1 DOWA
"RTN","LBRYPPR",45,0)
DOW1 D NEXT D:$P(LBN,U,2)]"" NEWWK D CONV G:LBJDD'>LBEM TYPE1
"RTN","LBRYPPR",46,0)
 G:$P($P(LBRYPP3,U),",",3)]"" NEWM S LBJDD=LBJDD-7 G TYPE1
"RTN","LBRYPPR",47,0)
 Q
"RTN","LBRYPPR",48,0)
FIND F I=2:1 S LBY1=$P(LBY,",",I) G:LBY1="" EXIT I LBX=LBY1 S LBZ=I K I,LBY1 Q
"RTN","LBRYPPR",49,0)
 Q
"RTN","LBRYPPR",50,0)
EXIT S LBZ="-1" K I,LBY1 Q
"RTN","LBRYPPR",51,0)
NEXT K LBN S LBN=$P(LBY,",",LBZ+1),LBZ=LBZ+1 Q:LBN]""  S LBZ=2,LBN=$P(LBY,",",LBZ),$P(LBN,U,2)=1 Q
"RTN","LBRYPPR",52,0)
EOM ; sets LBEM equal to number of days in the month
"RTN","LBRYPPR",53,0)
 ; requires EM=month and LBJDY=FMan 3 digit year
"RTN","LBRYPPR",54,0)
 ;
"RTN","LBRYPPR",55,0)
 N LBRTEMP
"RTN","LBRYPPR",56,0)
 ; LBRTEMP used to store the days of the month
"RTN","LBRYPPR",57,0)
 S LBRTEMP="31^28^31^30^31^30^31^31^30^31^30^31"
"RTN","LBRYPPR",58,0)
 ; extract months' total number of days
"RTN","LBRYPPR",59,0)
 S LBEM=$P(LBRTEMP,U,EM)
"RTN","LBRYPPR",60,0)
EM2 ; if the month is February, check for leap years and centuries 
"RTN","LBRYPPR",61,0)
 I EM=2 D
"RTN","LBRYPPR",62,0)
 . N YR
"RTN","LBRYPPR",63,0)
 . S YR=LBJDY+1700
"RTN","LBRYPPR",64,0)
 . I (((YR#4=0)&(YR#100'=0))!((YR#100=0)&(YR#400=0))) S LBEM=29
"RTN","LBRYPPR",65,0)
 K EM
"RTN","LBRYPPR",66,0)
 Q
"RTN","LBRYPPR",67,0)
NEWWK S NXTWK=LBN,LBY=$P(LBRYPP0,U,3),LBZ=LBMOZ D NEXT S:$P(LBN,U,2)]"" LBJDY=LBJDY+1 S (LBJDM,EM)=+LBN,LBNM=1,LBN=NXTWK D EOM Q
"RTN","LBRYPPR",68,0)
CONV S:$L(LBJDM)=1 LBJDM="0"_LBJDM
"RTN","LBRYPPR",69,0)
 S LBN=$P(LBN,U),X=LBJDY_LBJDM_"01" D DW^%DTC
"RTN","LBRYPPR",70,0)
 S FM=Y,LBRDOW=$P(LBN,"/",2)
"RTN","LBRYPPR",71,0)
 I FM=LBRDOW S LBJDD=1 G ADD
"RTN","LBRYPPR",72,0)
 I LBRDOW>FM S LBJDD=LBRDOW-FM+1 G ADD
"RTN","LBRYPPR",73,0)
 S LBJDD=8+LBRDOW-FM
"RTN","LBRYPPR",74,0)
ADD S WOM=$P(LBN,"/",1),LBJDD=LBJDD+(WOM-1*7) Q
"RTN","LBRYPPR",75,0)
NEWM D NEWWK S LBY=$P(LBRYPP3,U),LBZ=1 D NEXT,CONV G TYPE1
"RTN","LBRYPPR",76,0)
DOWA S LBXA=$P(LBX,"/",1),LBXB=$P(LBX,"/",2) K LBZ
"RTN","LBRYPPR",77,0)
 F I=2:1 S LBY1=$P(LBY,",",I) G:LBY1="" ERROR4
"RTN","LBRYPPR",78,0)
 S LBYA=$P(LBY1,"/",1),LBYB=$P(LBY1,"/",2) D DOWX G:$D(LBZ) DOW1
"RTN","LBRYPPR",79,0)
DOWX I LBYA=LBXA,LBYB=LBXB S LBZ=I Q
"RTN","LBRYPPR",80,0)
 I LBYA>LBXA S LBZ=I Q
"RTN","LBRYPPR",81,0)
 Q
"RTN","LBRYPPR",82,0)
EF1 S Y=LBJDT X ^DD("DD")
"RTN","LBRYPPR",83,0)
 W !!,"The last Journal Date, ",Y,", is not found in the PREDICTION PATTERN"
"RTN","LBRYPPR",84,0)
 W !,"for this title.  "
"RTN","LBRYPPR",85,0)
 W "Use (E)dit to change the JOURNAL DATE to a valid month"
"RTN","LBRYPPR",86,0)
 W !,"or change the ENTRY TYPE to INSERT." S XZ="CONTINUE//" D PAUSE^LBRYUTL
"RTN","LBRYPPR",87,0)
 Q
"RTN","LBRYPPR",88,0)
ADDED S X1=LBJDT,X2=$P(LBRYPP0,U,4) D C^%DTC
"RTN","LBRYPPR",89,0)
 S:$E(LBJDT,4,5)'=$E(X,4,5) LBNM=1 S LBJDT=X
"RTN","LBRYPPR",90,0)
 G ^LBRYPPR0
"RTN","LBRYPPR",91,0)
ERROR1 Q
"RTN","LBRYPPR",92,0)
ERROR2 Q
"RTN","LBRYPPR",93,0)
ERROR3 Q
"RTN","LBRYPPR",94,0)
ERROR4 Q
"RTN","LBRYUTL")
0^1^B8862657
"RTN","LBRYUTL",1,0)
LBRYUTL ;SSI/ALA-UTILITY PROGRAM FOR LIBRARY PKG ;[ 09/08/98  2:45 PM ]
"RTN","LBRYUTL",2,0)
 ;;2.5;Library;**2,6**;Mar 11, 1996
"RTN","LBRYUTL",3,0)
JDN(LBRFDATE) ;  Create 7 digit Julian date from FileMan internal date
"RTN","LBRYUTL",4,0)
 ;  Requires LBRFDATE=FileMan internal date.  Returns LBRJDATE as Julian day number
"RTN","LBRYUTL",5,0)
 N LBRLDAY,LBRMDAYS,LBRMO,LBRYR,I,LBRDAYS,LBRJDATE
"RTN","LBRYUTL",6,0)
 ; set default total # of days per month in ^-pieced string
"RTN","LBRYUTL",7,0)
 S LBRMDAYS="31^28^31^30^31^30^31^31^30^31^30^31"
"RTN","LBRYUTL",8,0)
 ; extract FMan 3 digit year and convert to Julian 4 digit year
"RTN","LBRYUTL",9,0)
 S LBRYR=$E(LBRFDATE,1,3)+1700
"RTN","LBRYUTL",10,0)
 ; extract month and day from FMan date
"RTN","LBRYUTL",11,0)
 S LBRMO=$E(LBRFDATE,4,5)
"RTN","LBRYUTL",12,0)
 S LBRLDAY=$E(LBRFDATE,6,7)
"RTN","LBRYUTL",13,0)
 ; check for leap years & centuries and change days per month string
"RTN","LBRYUTL",14,0)
 I (((LBRYR#4=0)&(LBRYR#100'=0))!((LBRYR#100=0)&(LBRYR#400=0))) S $P(LBRMDAYS,U,2)=29
"RTN","LBRYUTL",15,0)
 S LBRDAYS=0
"RTN","LBRYUTL",16,0)
 ; sum up the days since Jan 1 to the current month
"RTN","LBRYUTL",17,0)
 I LBRMO'=1 S LBRDAYS=0 F I=1:1:LBRMO-1 S LBRDAYS=LBRDAYS+$P(LBRMDAYS,U,I)
"RTN","LBRYUTL",18,0)
 ; add the sum to the date of the current month
"RTN","LBRYUTL",19,0)
 ; to obtain the total number of days since Jan 1
"RTN","LBRYUTL",20,0)
 ; then create a Julian date year+days since Jan 1
"RTN","LBRYUTL",21,0)
 ;Insert placeholder 0's as nessecary
"RTN","LBRYUTL",22,0)
 I ((LBRDAYS+LBRLDAY)<10) Q (LBRYR_"00"_(LBRDAYS+LBRLDAY))
"RTN","LBRYUTL",23,0)
 I ((LBRDAYS+LBRLDAY)<100) Q (LBRYR_"0"_(LBRDAYS+LBRLDAY))
"RTN","LBRYUTL",24,0)
 Q (LBRYR_(LBRDAYS+LBRLDAY))
"RTN","LBRYUTL",25,0)
RJD(LBRJDATE) ;  Create FileMan internal date from 7 digit Julian date
"RTN","LBRYUTL",26,0)
 ;  Requires LBRJDATE=Year_Number of days from begin of year
"RTN","LBRYUTL",27,0)
 N LBRMDAYS,LDY,I,LBRNLDY,LBRFDATE,LBRYR
"RTN","LBRYUTL",28,0)
 ; extract 4 digit Julian year
"RTN","LBRYUTL",29,0)
 S LBRYR=$E(LBRJDATE,1,4)
"RTN","LBRYUTL",30,0)
 ; set default total # of days per month in ^-pieced string
"RTN","LBRYUTL",31,0)
 S LBRMDAYS="31^28^31^30^31^30^31^31^30^31^30^31"
"RTN","LBRYUTL",32,0)
 ; check for leap years & centuries and change days per month string
"RTN","LBRYUTL",33,0)
 I (((LBRYR#4=0)&(LBRYR#100'=0))!((LBRYR#100=0)&(LBRYR#400=0))) S $P(LBRMDAYS,U,2)=29
"RTN","LBRYUTL",34,0)
 ; convert 4 digit Julian year to 3 digit FMan year
"RTN","LBRYUTL",35,0)
 S LBRYR=LBRYR-1700
"RTN","LBRYUTL",36,0)
 ; calculate the month from total number of days
"RTN","LBRYUTL",37,0)
 ; keep subtracting until <0
"RTN","LBRYUTL",38,0)
 S LBRNLDY=$E(LBRJDATE,5,7) F I=1:1:12 S LBRNLDY=(LBRNLDY-$P(LBRMDAYS,U,I)) Q:LBRNLDY<0
"RTN","LBRYUTL",39,0)
 ; to obtain the day of month, add back last months day total
"RTN","LBRYUTL",40,0)
 S LBRNLDY=LBRNLDY+$P(LBRMDAYS,U,I)
"RTN","LBRYUTL",41,0)
 S LBRMO=I
"RTN","LBRYUTL",42,0)
 ; calculate if '0' placeholders are necessary 29811 -> 2980101
"RTN","LBRYUTL",43,0)
 I LBRNLDY=0 S LBRNLDY=$P(LBRMDAYS,U,LBRMO-1),LBRMO=LBRMO-1
"RTN","LBRYUTL",44,0)
 I LBRMO<10 S LBRFDATE=LBRYR_"0"_LBRMO
"RTN","LBRYUTL",45,0)
 I (LBRMO'<10) S LBRFDATE=LBRYR_LBRMO
"RTN","LBRYUTL",46,0)
 I LBRNLDY<10 S LBRFDATE=LBRFDATE_"0"_LBRNLDY
"RTN","LBRYUTL",47,0)
 I (LBRNLDY'<10) S LBRFDATE=LBRFDATE_LBRNLDY
"RTN","LBRYUTL",48,0)
 Q LBRFDATE
"RTN","LBRYUTL",49,0)
TRN ;  Get next transaction number for transaction file local site
"RTN","LBRYUTL",50,0)
 S DIC(0)="L",DLAYGO=682.1,DIC="^LBRY(682.1,"
"RTN","LBRYUTL",51,0)
 L ^LBRY(682.1,0):5 I '$T G TRN
"RTN","LBRYUTL",52,0)
 S DINUM=+$P(^LBRY(682.1,0),U,3) F I=1:1 S DINUM=DINUM+I Q:'$D(^LBRY(682.1,DINUM,0))
"RTN","LBRYUTL",53,0)
 L
"RTN","LBRYUTL",54,0)
 S X=DINUM D FILE^DICN S LBRYDA=+Y K X,Y,DLAYGO
"RTN","LBRYUTL",55,0)
 S DA=LBRYDA,DIC="^LBRY(682.1,",DIE=DIC
"RTN","LBRYUTL",56,0)
 S DR=$S($G(SRVFLG)=1:"[LBRYLTF]",1:"[LBRYREC]") D ^DIE
"RTN","LBRYUTL",57,0)
 I $G(SRVFLG)=1 S $P(^LBRY(682.1,LBRYDA,1),U,2)=LBRYCLS
"RTN","LBRYUTL",58,0)
 K DINUM,DA,SRVFLG Q
"RTN","LBRYUTL",59,0)
FTRN ;  Get next transaction number for transaction file in FORUM
"RTN","LBRYUTL",60,0)
 S DIC(0)="L",DLAYGO=682.1,DIC="^LBRY(682.1,"
"RTN","LBRYUTL",61,0)
 L ^LBRY(682.1,0):5 I '$T G FTRN
"RTN","LBRYUTL",62,0)
 S DINUM=+$P(^LBRY(682.1,0),U,3) F I=1:1 S DINUM=DINUM+I Q:'$D(^LBRY(682.1,DINUM,0))
"RTN","LBRYUTL",63,0)
 L
"RTN","LBRYUTL",64,0)
 S X=DINUM D FILE^DICN S LBRYDA=+Y K X,Y,DLAYGO
"RTN","LBRYUTL",65,0)
 S DA=LBRYDA,DIC="^LBRY(682.1,",DIE=DIC
"RTN","LBRYUTL",66,0)
 S DR=$S($G(SRVFLG)=1:"[LBRYRECV]",1:"[LBRYSND]") D ^DIE
"RTN","LBRYUTL",67,0)
 S $P(^LBRY(682.1,LBRYDA,1),U,2)=$G(LBRYCLS)
"RTN","LBRYUTL",68,0)
 S $P(^LBRY(682.1,LBRYDA,0),U,7)=$G(STN)
"RTN","LBRYUTL",69,0)
 K DINUM,SRVFLG,DA
"RTN","LBRYUTL",70,0)
 Q
"RTN","LBRYUTL",71,0)
PAUSE W !,XZ S DTOUT=0 R X:DTIME E  W $C(7) S DTOUT=1 Q
"RTN","LBRYUTL",72,0)
 Q:X=""  Q:X="^"  W !,"Enter carriage return to ",XZ
"RTN","LBRYUTL",73,0)
 G PAUSE
"VER")
8.0^21.0
**END**
**END**
