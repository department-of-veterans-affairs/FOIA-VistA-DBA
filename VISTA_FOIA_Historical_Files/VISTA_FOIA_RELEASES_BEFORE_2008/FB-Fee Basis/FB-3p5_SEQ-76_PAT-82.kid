Released FB*3.5*82 SEQ #76
Extracted from mail message
**KIDS**:FB*3.5*82^

**INSTALL NAME**
FB*3.5*82
"BLD",5696,0)
FB*3.5*82^FEE BASIS^0^3040819^y
"BLD",5696,1,0)
^^4^4^3040810^
"BLD",5696,1,1,0)
This patch makes the following changes:
"BLD",5696,1,2,0)
 o Use new PTF APIs to create or delete a PTF record.
"BLD",5696,1,3,0)
 o Correct a fault that prevents deletion of a PTF record for community 
"BLD",5696,1,4,0)
   nursing home.
"BLD",5696,4,0)
^9.64PA^^
"BLD",5696,"KRN",0)
^9.67PA^8989.52^19
"BLD",5696,"KRN",.4,0)
.4
"BLD",5696,"KRN",.401,0)
.401
"BLD",5696,"KRN",.402,0)
.402
"BLD",5696,"KRN",.403,0)
.403
"BLD",5696,"KRN",.5,0)
.5
"BLD",5696,"KRN",.84,0)
.84
"BLD",5696,"KRN",3.6,0)
3.6
"BLD",5696,"KRN",3.8,0)
3.8
"BLD",5696,"KRN",9.2,0)
9.2
"BLD",5696,"KRN",9.8,0)
9.8
"BLD",5696,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",5696,"KRN",9.8,"NM",1,0)
FBUTL6^^0^B1597224
"BLD",5696,"KRN",9.8,"NM",2,0)
FBCHC78^^0^B16420420
"BLD",5696,"KRN",9.8,"NM",3,0)
FBNHDLAD^^0^B6656610
"BLD",5696,"KRN",9.8,"NM",4,0)
FBCH780^^0^B4473613
"BLD",5696,"KRN",9.8,"NM",5,0)
FBCHEP^^0^B30100976
"BLD",5696,"KRN",9.8,"NM",6,0)
FBNHEA^^0^B9786847
"BLD",5696,"KRN",9.8,"NM","B","FBCH780",4)

"BLD",5696,"KRN",9.8,"NM","B","FBCHC78",2)

"BLD",5696,"KRN",9.8,"NM","B","FBCHEP",5)

"BLD",5696,"KRN",9.8,"NM","B","FBNHDLAD",3)

"BLD",5696,"KRN",9.8,"NM","B","FBNHEA",6)

"BLD",5696,"KRN",9.8,"NM","B","FBUTL6",1)

"BLD",5696,"KRN",19,0)
19
"BLD",5696,"KRN",19,"NM",0)
^9.68A^11^11
"BLD",5696,"KRN",19,"NM",1,0)
FBCH LEGAL ENTITLEMENT^^5^
"BLD",5696,"KRN",19,"NM",2,0)
FBCH MEDICAL ENTITLEMENT^^5^
"BLD",5696,"KRN",19,"NM",3,0)
FBCH 7078 SETUP^^5^
"BLD",5696,"KRN",19,"NM",4,0)
FBCNH ENTER AUTHORIZATION^^5^
"BLD",5696,"KRN",19,"NM",5,0)
FBCNH ADMIT^^5^
"BLD",5696,"KRN",19,"NM",6,0)
FBUC PAYMENTS^^5^
"BLD",5696,"KRN",19,"NM",7,0)
FBCH ENTER PAYMENT^^5^
"BLD",5696,"KRN",19,"NM",8,0)
FBCH REIMBURSEMENT INVOICE^^5^
"BLD",5696,"KRN",19,"NM",9,0)
FBCH CANCEL 7078^^5^
"BLD",5696,"KRN",19,"NM",10,0)
FBCNH CANCEL 7078^^5^
"BLD",5696,"KRN",19,"NM",11,0)
FBCNH DELETE ADMISSION^^5^
"BLD",5696,"KRN",19,"NM","B","FBCH 7078 SETUP",3)

"BLD",5696,"KRN",19,"NM","B","FBCH CANCEL 7078",9)

"BLD",5696,"KRN",19,"NM","B","FBCH ENTER PAYMENT",7)

"BLD",5696,"KRN",19,"NM","B","FBCH LEGAL ENTITLEMENT",1)

"BLD",5696,"KRN",19,"NM","B","FBCH MEDICAL ENTITLEMENT",2)

"BLD",5696,"KRN",19,"NM","B","FBCH REIMBURSEMENT INVOICE",8)

"BLD",5696,"KRN",19,"NM","B","FBCNH ADMIT",5)

"BLD",5696,"KRN",19,"NM","B","FBCNH CANCEL 7078",10)

"BLD",5696,"KRN",19,"NM","B","FBCNH DELETE ADMISSION",11)

"BLD",5696,"KRN",19,"NM","B","FBCNH ENTER AUTHORIZATION",4)

"BLD",5696,"KRN",19,"NM","B","FBUC PAYMENTS",6)

"BLD",5696,"KRN",19.1,0)
19.1
"BLD",5696,"KRN",101,0)
101
"BLD",5696,"KRN",409.61,0)
409.61
"BLD",5696,"KRN",771,0)
771
"BLD",5696,"KRN",870,0)
870
"BLD",5696,"KRN",8989.51,0)
8989.51
"BLD",5696,"KRN",8989.52,0)
8989.52
"BLD",5696,"KRN",8994,0)
8994
"BLD",5696,"KRN","B",.4,.4)

"BLD",5696,"KRN","B",.401,.401)

"BLD",5696,"KRN","B",.402,.402)

"BLD",5696,"KRN","B",.403,.403)

"BLD",5696,"KRN","B",.5,.5)

"BLD",5696,"KRN","B",.84,.84)

"BLD",5696,"KRN","B",3.6,3.6)

"BLD",5696,"KRN","B",3.8,3.8)

"BLD",5696,"KRN","B",9.2,9.2)

"BLD",5696,"KRN","B",9.8,9.8)

"BLD",5696,"KRN","B",19,19)

"BLD",5696,"KRN","B",19.1,19.1)

"BLD",5696,"KRN","B",101,101)

"BLD",5696,"KRN","B",409.61,409.61)

"BLD",5696,"KRN","B",771,771)

"BLD",5696,"KRN","B",870,870)

"BLD",5696,"KRN","B",8989.51,8989.51)

"BLD",5696,"KRN","B",8989.52,8989.52)

"BLD",5696,"KRN","B",8994,8994)

"BLD",5696,"QUES",0)
^9.62^^
"BLD",5696,"REQB",0)
^9.611^2^2
"BLD",5696,"REQB",1,0)
DG*5.3*605^2
"BLD",5696,"REQB",2,0)
FB*3.5*77^2
"BLD",5696,"REQB","B","DG*5.3*605",1)

"BLD",5696,"REQB","B","FB*3.5*77",2)

"KRN",19,1288,-1)
5^1
"KRN",19,1288,0)
FBCH LEGAL ENTITLEMENT
"KRN",19,1289,-1)
5^2
"KRN",19,1289,0)
FBCH MEDICAL ENTITLEMENT
"KRN",19,1294,-1)
5^7
"KRN",19,1294,0)
FBCH ENTER PAYMENT
"KRN",19,2253,-1)
5^5
"KRN",19,2253,0)
FBCNH ADMIT
"KRN",19,2256,-1)
5^4
"KRN",19,2256,0)
FBCNH ENTER AUTHORIZATION
"KRN",19,2285,-1)
5^3
"KRN",19,2285,0)
FBCH 7078 SETUP
"KRN",19,2296,-1)
5^11
"KRN",19,2296,0)
FBCNH DELETE ADMISSION
"KRN",19,3606,-1)
5^9
"KRN",19,3606,0)
FBCH CANCEL 7078
"KRN",19,3621,-1)
5^8
"KRN",19,3621,0)
FBCH REIMBURSEMENT INVOICE
"KRN",19,4022,-1)
5^10
"KRN",19,4022,0)
FBCNH CANCEL 7078
"KRN",19,4070,-1)
5^6
"KRN",19,4070,0)
FBUC PAYMENTS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
82^3040819
"PKG",60,22,1,"PAH",1,1,0)
^^4^4^3040819
"PKG",60,22,1,"PAH",1,1,1,0)
This patch makes the following changes:
"PKG",60,22,1,"PAH",1,1,2,0)
 o Use new PTF APIs to create or delete a PTF record.
"PKG",60,22,1,"PAH",1,1,3,0)
 o Correct a fault that prevents deletion of a PTF record for community 
"PKG",60,22,1,"PAH",1,1,4,0)
   nursing home.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","FBCH780")
0^4^B4473613
"RTN","FBCH780",1,0)
FBCH780 ;AISC/DMK-7078/AUTHORIZATION CON'T ;8/18/2004
"RTN","FBCH780",2,0)
 ;;3.5;FEE BASIS;**82**;JAN 30, 1995
"RTN","FBCH780",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCH780",4,0)
DISP D HOME^%ZIS W @IOF
"RTN","FBCH780",5,0)
 W !! S DA=FBAA78,DR="0;1",DIC="^FB7078(" D EN^DIQ
"RTN","FBCH780",6,0)
ASK S DIR(0)="Y",DIR("A")="Is this Correct",DIR("B")="NO" D ^DIR K DIR S:$D(DIRUT) FBOUT=1 Q:$G(FBOUT)  G EDIT:'Y
"RTN","FBCH780",7,0)
 S DFN=+$P($G(^FB7078(+FBAA78,0)),"^",3)
"RTN","FBCH780",8,0)
 W !,?2,"....Posting to 1358",! D WAIT^DICD,POST Q
"RTN","FBCH780",9,0)
END W ! Q
"RTN","FBCH780",10,0)
EDIT W ! S (DIC,DIE)="^FB7078(",DA=FBAA78,DR="[FBCH EDIT 7078]" D ^DIE
"RTN","FBCH780",11,0)
 G DISP
"RTN","FBCH780",12,0)
HELP W !!,"Select one of the following: ",!,?18,"'00' FOR SURGICAL",!,?18,"'10' FOR MEDICAL",!,?18,"'86' FOR PSYCHIATRY",! Q
"RTN","FBCH780",13,0)
POST S PRCS("X")=FBCHOB,PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !!,*7,"1358 not available for posting!",! Q
"RTN","FBCH780",14,0)
 S FBCOMM=$S($D(FBNAME):FBNAME_" - "_FBSSN,1:"Estimated amount")
"RTN","FBCH780",15,0)
 D NOW^%DTC S X=FBCHOB_"^"_%_"^"_FBEST_"^"_""_"^"_FBSEQ_"^"_FBCOMM_"^"_DFN_";"_+FBAA78_";"_$P(FBCHOB,"-",2),PRCS("TYPE")="FB"
"RTN","FBCH780",16,0)
 D EN2^PRCS58 Q
"RTN","FBCH780",17,0)
NULL W !,*7,"Enter the reason for pending disposition or an '^' to exit",! G FBPDIS^FBCH78
"RTN","FBCH780",18,0)
NULL1 W !,*7,"This is a required response. Enter an '^' to exit.",! Q
"RTN","FBCH780",19,0)
 ;
"RTN","FBCH780",20,0)
DISCH(X) ;X = Pointer for 7078
"RTN","FBCH780",21,0)
 ;output = patient's Type of Discharge
"RTN","FBCH780",22,0)
 N Y
"RTN","FBCH780",23,0)
 S Y=$O(^FBAAI("E",X_";FB7078(",0))
"RTN","FBCH780",24,0)
 I 'Y Q Y
"RTN","FBCH780",25,0)
 S Y=+$P($G(^FBAAI(Y,0)),U,21)
"RTN","FBCH780",26,0)
 Q $S($P($G(^FBAA(162.6,Y,0)),U)]"":$P(^(0),U),1:"")
"RTN","FBCH780",27,0)
 ;
"RTN","FBCH780",28,0)
PTF ;called to create a non-va ptf record at admission time for an
"RTN","FBCH780",29,0)
 ;authorized claim.  Called from FBCH78.
"RTN","FBCH780",30,0)
 ;
"RTN","FBCH780",31,0)
 ; input
"RTN","FBCH780",32,0)
 ;   DFN    - ien of patient in file #2
"RTN","FBCH780",33,0)
 ;   FBAA78 - ien of 7078 authorization in file #162.4
"RTN","FBCH780",34,0)
 ;
"RTN","FBCH780",35,0)
 N FBDT
"RTN","FBCH780",36,0)
 ;
"RTN","FBCH780",37,0)
 ; obtain Authorization From Date from 7078 authorization to use
"RTN","FBCH780",38,0)
 ; as the admission date on the PTF record
"RTN","FBCH780",39,0)
 S:$G(FBAA78) FBDT=$P($G(^FB7078(+FBAA78,0)),U,4)
"RTN","FBCH780",40,0)
 ;
"RTN","FBCH780",41,0)
 ; call utility to attempt creation of a Non-VA PTF record
"RTN","FBCH780",42,0)
 D PTFC^FBUTL6($G(DFN),$G(FBDT))
"RTN","FBCH780",43,0)
 Q
"RTN","FBCHC78")
0^2^B16420420
"RTN","FBCHC78",1,0)
FBCHC78 ;AISC/DMK-CANCEL A 7078 ;8/18/2004
"RTN","FBCHC78",2,0)
 ;;3.5;FEE BASIS;**82**;JAN 30, 1995
"RTN","FBCHC78",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHC78",4,0)
 ;check if user holds 'FBAASUPERVISOR' security key
"RTN","FBCHC78",5,0)
 Q:'$G(DUZ)
"RTN","FBCHC78",6,0)
 I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) W !,"You must be a holder of the 'FBAASUPERVISOR' key to cancel a 7078.",! Q
"RTN","FBCHC78",7,0)
 ;
"RTN","FBCHC78",8,0)
 ;get station number from site parameter file
"RTN","FBCHC78",9,0)
 D SITEP^FBAAUTL G END:FBPOP
"RTN","FBCHC78",10,0)
 S FBPSA=$E($P($G(^DIC(4,+$P($G(FBSITE(1)),"^",3),99)),"^"),1,3)
"RTN","FBCHC78",11,0)
 ;
"RTN","FBCHC78",12,0)
ASK ;get 7078 entry to cancel
"RTN","FBCHC78",13,0)
 W ! S DIC(0)="AEQMZ",DIC="^FB7078(",D="D",DIC("A")="Select Patient: ",DIC("S")="I $P(^(0),U,9)'=""DC""&($P(^(0),U,11)=$S($D(FBNH):7,1:6))" D IX^DIC K DIC,D G END:X=""!(X="^"),ASK:Y<0
"RTN","FBCHC78",14,0)
 S FB7078=+Y_";FB7078(",FBAAOB=FBPSA_"-"_$P(Y(0,0),".")_"-"_$P(Y(0,0),".",2),DFN=+$P(Y(0),"^",3),FB(161)=+$O(^FBAAA("AG",FB7078,DFN,0)),FBMM=$E($P(Y(0),U,4),4,5)
"RTN","FBCHC78",15,0)
 S FBADDT=$P(Y(0),U,4),FBVEN=$P(Y(0),U,2)
"RTN","FBCHC78",16,0)
 I $D(FBNH) S DIC="^FBAACNH(",DIC(0)="MZ",DIC("S")="I $P(^(0),U,2)=DFN&($P(^(0),U,10)=FB(161))",X=$P(Y(0),U,4) D ^DIC K DIC I +Y>0 W !,*7,"Must delete all movements associated with this authorization before canceling.",! G END
"RTN","FBCHC78",17,0)
 ;
"RTN","FBCHC78",18,0)
 ;check if payments made against the 7078
"RTN","FBCHC78",19,0)
 ;if so do not allow a user to cancel
"RTN","FBCHC78",20,0)
 I $D(^FBAAI("E",FB7078)) W !!,*7,"There is already an invoice entered for this hospitalization.  Cannot delete!",!! G END
"RTN","FBCHC78",21,0)
 I $D(^FBAAC("AM",FB7078)) W !!,*7,"There already are ancillary services entered against this authorization.  Cannot delete!",!! G END
"RTN","FBCHC78",22,0)
 ;
"RTN","FBCHC78",23,0)
 ;display 7078 and ask if ok to cancel
"RTN","FBCHC78",24,0)
 S DA=+FB7078,DIC="^FB7078(",DR="0;1" D EN^DIQ
"RTN","FBCHC78",25,0)
 W ! S DIR(0)="Y",DIR("A")="Are you sure you want to cancel",DIR("B")="No" D ^DIR K DIR G FBCHC78:'Y,END:$D(DIRUT)
"RTN","FBCHC78",26,0)
 ;
"RTN","FBCHC78",27,0)
 ;cancelling 7078 and associated athorization in file 161
"RTN","FBCHC78",28,0)
 ;deleting associated 7078 from the notification file in civil hospital
"RTN","FBCHC78",29,0)
 ;remove entries assoiciated with CNH in 161.23
"RTN","FBCHC78",30,0)
 ;removing estimated amount from 1358
"RTN","FBCHC78",31,0)
 I '$D(FBNH) S DA=$O(^FBAA(162.2,"AM",+FB7078,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE K DIC,DIE W " ."
"RTN","FBCHC78",32,0)
 S DA(1)=DFN,DA=$O(^FBAAA("AG",FB7078,DFN,0)) I DA S DIK="^FBAAA("_DFN_",1," D ^DIK K DIK,DA W "."
"RTN","FBCHC78",33,0)
 S DA=+FB7078,DIE="^FB7078(",DR=".013////^S X=DUZ;.014////^S X=DT;9////^S X=""DC""" D ^DIE K DIE,DIC W "."
"RTN","FBCHC78",34,0)
 I $D(FBNH) S FBI=0 F  S FBI=$O(^FBAA(161.23,"AC",+FB7078,FBI)) Q:'FBI  I $D(^FBAA(161.23,FBI,0)) D
"RTN","FBCHC78",35,0)
 . S DA=FBI,DIK="^FBAA(161.23," D ^DIK K DIK W "."
"RTN","FBCHC78",36,0)
 ; if cancelled civil hospital 7078 then delete associated PTF record
"RTN","FBCHC78",37,0)
 I '$G(FBNH) D PTFD^FBUTL6(DFN,FBADDT)
"RTN","FBCHC78",38,0)
 W !!,"Authorization cancelled.  Now updating 1358.",!
"RTN","FBCHC78",39,0)
 D 1358 I $D(FBERR) W !,"Unable to affect 1358 adjustment.  Use appropriate IFCAP options.",!
"RTN","FBCHC78",40,0)
 W "...  Finished",!
"RTN","FBCHC78",41,0)
 ;
"RTN","FBCHC78",42,0)
END K DA,DR,DIE,DIC,DFN,FB,FBI,FB7078,FBAAOB,FBERR,PRC,PRCS,PRCSX,FBPSA,FBZZ,FBSITE,X,Y,FBPOP,FBNH,FBMM,FBADDT,FBVEN
"RTN","FBCHC78",43,0)
 Q
"RTN","FBCHC78",44,0)
1358 ;subtract estimated dollar amount from 1358
"RTN","FBCHC78",45,0)
 ;FBAAOB=FULL OBLIGATION NUMBER (STATION #-OBLIGATION #-REF #)
"RTN","FBCHC78",46,0)
 ;FBERR returned if IFCAP call fails
"RTN","FBCHC78",47,0)
 ;internal entry # in 424 = $O(^PRC(424,"B",FBAAOB,0))
"RTN","FBCHC78",48,0)
 ;
"RTN","FBCHC78",49,0)
 ;check if 1358 available for posting
"RTN","FBCHC78",50,0)
 I '$$INTER() W !,*7,"Unable to locate reference number on 1358.",! S FBERR=1 Q
"RTN","FBCHC78",51,0)
 S PRCS("X")=$P(FBAAOB,"-",1,2),PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !,*7,"1358 Not available for posting.",! S FBERR=1 Q
"RTN","FBCHC78",52,0)
 D NOW^%DTC
"RTN","FBCHC78",53,0)
 S PRCSX=$$INTER()_"^"_%_"^"_0_"^"_"Authorization has been cancelled"_"^"_1_"^"
"RTN","FBCHC78",54,0)
 S PRCS("TYPE")="FB" D ^PRCS58CC I Y'=1 W !,*7,$P(Y,"^",2),! S FBERR=1 Q
"RTN","FBCHC78",55,0)
 Q
"RTN","FBCHC78",56,0)
 ;
"RTN","FBCHC78",57,0)
INTER() ;get internal entry number from file 424
"RTN","FBCHC78",58,0)
 ;first check interface id x-ref
"RTN","FBCHC78",59,0)
 ;second check is to "B" x-ref to stay backward compatible with IFCAP3.6
"RTN","FBCHC78",60,0)
 ;
"RTN","FBCHC78",61,0)
 I '$G(FBNH),$D(^PRC(424,"E",DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2))) Q $O(^(DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2),0))
"RTN","FBCHC78",62,0)
 I $G(FBNH),$D(^PRC(424,"E",DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2)_";"_FBMM)) Q $O(^(DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2)_";"_FBMM,0))
"RTN","FBCHC78",63,0)
 I $D(^PRC(424,"B",FBAAOB)) Q $O(^(FBAAOB,0))
"RTN","FBCHC78",64,0)
 Q 0
"RTN","FBCHC78",65,0)
 ;
"RTN","FBCHC78",66,0)
CNH ;entry point to cancel an authorization associated with the
"RTN","FBCHC78",67,0)
 ;community nursing home program.
"RTN","FBCHC78",68,0)
 S FBNH=1 G FBCHC78
"RTN","FBCHC78",69,0)
 Q
"RTN","FBCHEP")
0^5^B30100976
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK-ENTER PAYMENT FOR CONTRACT HOSPITAL ;8/18/2004
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77,82**;JAN 30, 1995
"RTN","FBCHEP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",12,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",13,0)
 ;
"RTN","FBCHEP",14,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",15,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",16,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",17,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",18,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",19,0)
 ;
"RTN","FBCHEP",20,0)
RDV S FBVE="" S:$D(^FBAAV(DA,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",21,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",22,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",23,0)
 ;
"RTN","FBCHEP",24,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")" W ! D ^DIC K DIC
"RTN","FBCHEP",25,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",26,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",27,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",28,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",29,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",30,0)
RIN D GETINDT^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBCHEP",31,0)
 ; ask patient control number
"RTN","FBCHEP",32,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",33,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",34,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",35,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",36,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",37,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",38,0)
 ; compute default Covered Days
"RTN","FBCHEP",39,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",40,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",41,0)
 S FBAAMM=$S(FBAAPTC="R":"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",42,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",43,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",44,0)
 D
"RTN","FBCHEP",45,0)
 . N ICDVDT S ICDVDT=$G(FBAABDT) D ^DIE
"RTN","FBCHEP",46,0)
 ; file adjustment reasons
"RTN","FBCHEP",47,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",48,0)
 ; file remittance remarks
"RTN","FBCHEP",49,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",50,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",51,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",52,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",53,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",54,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",55,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",56,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",57,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583
"RTN","FBCHEP",58,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK
"RTN","FBCHEP",59,0)
 Q
"RTN","FBCHEP",60,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET D PTFC^FBUTL6(DFN,$P(FBZ(0),"^",4))
"RTN","FBCHEP",61,0)
 Q
"RTN","FBCHEP",62,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",63,0)
 ;
"RTN","FBCHEP",64,0)
 S FBAAPTC="R"
"RTN","FBCHEP",65,0)
 G RD
"RTN","FBCHEP",66,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",67,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",68,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",69,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",70,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",71,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",72,0)
 Q
"RTN","FBCHEP",73,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",74,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",75,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",76,0)
 Q
"RTN","FBNHDLAD")
0^3^B6656610
"RTN","FBNHDLAD",1,0)
FBNHDLAD ;AISC/GRR-DELETE ADMISSION FOR NURSING HOME ;8/18/2004
"RTN","FBNHDLAD",2,0)
 ;;3.5;FEE BASIS;**82**;JAN 30, 1995
"RTN","FBNHDLAD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBNHDLAD",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q W !
"RTN","FBNHDLAD",5,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""A""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Admission Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y
"RTN","FBNHDLAD",6,0)
 S FB("ADDT")=$P(Y(0),"^") ; admission date/time
"RTN","FBNHDLAD",7,0)
 S FB(161)=$P(Y(0),"^",10)
"RTN","FBNHDLAD",8,0)
 I $O(^FBAACNH("AC",DA,DA))>0 W !!,*7,"Other movements associated with this admission are still on file.",!,"You cannot delete the admission when other movements exist!" G CKVEIW
"RTN","FBNHDLAD",9,0)
 S DIR("A")="Are you sure you want to delete this admission",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G H^XUS:$D(DTOUT),Q:$D(DUOUT),RD1:Y=0
"RTN","FBNHDLAD",10,0)
 I FB(161),$D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=$P($P(^(0),"^",9),";")
"RTN","FBNHDLAD",11,0)
 I $G(FB(78)) S FB(1625)=+$O(^FBAAI("E",FB(78)_";FB7078(",0))
"RTN","FBNHDLAD",12,0)
 I $G(FB(1625)),$D(^FBAAI(FB(1625),0)) W *7,!,"Unable to delete. Payments already made against this admission!",!! G RD1
"RTN","FBNHDLAD",13,0)
 S DIK=DIE D ^DIK K DIK W !?5,"...deleted",!
"RTN","FBNHDLAD",14,0)
 D PTFD^FBUTL6(DFN,FB("ADDT")) ; delete associated PTF record
"RTN","FBNHDLAD",15,0)
 K FB
"RTN","FBNHDLAD",16,0)
 G RD1
"RTN","FBNHDLAD",17,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FB,FBZZ,ZZZ
"RTN","FBNHDLAD",18,0)
 Q
"RTN","FBNHDLAD",19,0)
CKVEIW S DIR("A")="Want data related to this admission displayed",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G H^XUS:$D(DTOUT),RD1:$D(DUOUT)!(Y=0) S IFN=DA D ^FBNHDEC
"RTN","FBNHDLAD",20,0)
 G RD1
"RTN","FBNHEA")
0^6^B9786847
"RTN","FBNHEA",1,0)
FBNHEA ;AISC/GRR-ENTER ADMISSION TO NURSING HOME ;8/18/2004
"RTN","FBNHEA",2,0)
 ;;3.5;FEE BASIS;**82**;JAN 30, 1995
"RTN","FBNHEA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBNHEA",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEA",5,0)
 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),H^XUS:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHEA",7,0)
RD2 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",8,0)
 S FBLTD=$O(^FBAACNH("AF",DFN,0)) K:FBLTD<1 FBLTD S FBTRT="A",DIR(0)="DA^"_FBAABDT_".000001:"_FBAABDT_".999999:EXR",DIR("A")="Enter Admission Date/Time:  ",DIR("?")="Enter date pt. admitted to CNH facility (time is required)"
"RTN","FBNHEA",9,0)
 D ^DIR K DIR G:$D(DIRUT)!'Y Q S FBY=+Y D DATCK2^FBAAUTL1 G:'$D(X) RD2
"RTN","FBNHEA",10,0)
 S DIR(0)="S^1:AFTER RE-HOSPITALIZATION >15 DAYS;2:TRANSFER FROM OTHER CNH;3:FROM ASIH <15 DAYS;4:ALL OTHER",DIR("A")="Enter Admission Type" D ^DIR K DIR G:$D(DIRUT) Q S FBZ=+Y
"RTN","FBNHEA",11,0)
 K DD,DO S X=FBY,DIC="^FBAACNH(",DIE=DIC,DIC(0)="LM",DLAYGO=162.3 D FILE^DICN G RD1:$D(DUOUT)!($D(DTOUT)),RD2:Y<0 S DA=+Y K DIC,DLAYGO
"RTN","FBNHEA",12,0)
 S DR="8////^S X=FBVEN;Q;9////^S X=FTP;1////^S X=DFN;2////^S X=""A"";3////^S X=""Y"";4////^S X=DA;5////^S X=FBZ" L +FBAACNH(DA) D ^DIE L -FBAACNH(DA) I '$D(DTOUT) D PTFC^FBUTL6(DFN,FBY) I '$G(FBRCHK) G RD1
"RTN","FBNHEA",13,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBVEN,CNT,DAT,F,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBDX,FBI,FBLOC,FBPOV,FBPSA,FBPT,I,FBRR,FBTT,PI,PTYPE,T,TA,Z,ZZ,CNT,FBAUT,TA,DIRUT,DUOUT,DTOUT,FBY,FBLTD,FBTRT
"RTN","FBNHEA",14,0)
 K FBZ,FBRCHK
"RTN","FBNHEA",15,0)
 Q
"RTN","FBNHEA",16,0)
CKVEIW W !!,*7,"Veteran already has an active admission, you may use the edit option to edit it.",!
"RTN","FBNHEA",17,0)
 S DIR(0)="Y",DIR("A")="Want data related to active admission displayed",DIR("B")="NO" D ^DIR K DIR I Y S IFN=$O(^FBAACNH("AD",DFN,0)) D ^FBNHDEC
"RTN","FBNHEA",18,0)
 I '$G(FBRCHK) G RD1
"RTN","FBNHEA",19,0)
 Q
"RTN","FBUTL6")
0^1^B1597224
"RTN","FBUTL6",1,0)
FBUTL6 ;WIOFO/SAB-FEE BASIS UTILITY ;8/10/2004
"RTN","FBUTL6",2,0)
 ;;3.5;FEE BASIS;**82**;JAN 30, 1995
"RTN","FBUTL6",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBUTL6",4,0)
 ; IA #4436 allows calls to $$CREATE^DGPTFEE and $$DELETE^DGPTFEE
"RTN","FBUTL6",5,0)
 Q
"RTN","FBUTL6",6,0)
 ;
"RTN","FBUTL6",7,0)
PTFC(DFN,FBDT) ; Create Non-VA PTF Record
"RTN","FBUTL6",8,0)
 ; Input
"RTN","FBUTL6",9,0)
 ;   DFN  - IEN of entry in PATIENT (#2) file
"RTN","FBUTL6",10,0)
 ;   FBDT - Admission Date/Time, FileMan internal format, time optional
"RTN","FBUTL6",11,0)
 N FBX
"RTN","FBUTL6",12,0)
 I $G(DFN),$G(FBDT) D WAIT^DICD S FBX=$$CREATE^DGPTFEE(DFN,FBDT,1)
"RTN","FBUTL6",13,0)
 W $C(7),!?5,$S($G(FBX)>0:"Non-VA PTF Record Created.",1:"Unable to create Non-VA PTF Record."),!
"RTN","FBUTL6",14,0)
 Q
"RTN","FBUTL6",15,0)
 ;
"RTN","FBUTL6",16,0)
PTFD(DFN,FBDT) ; Delete Non-VA PTF Record
"RTN","FBUTL6",17,0)
 ; Input
"RTN","FBUTL6",18,0)
 ;   DFN  - IEN of entry in PATIENT (#2) file
"RTN","FBUTL6",19,0)
 ;   FBDT - Admission Date/Time, FileMan internal format, time optional
"RTN","FBUTL6",20,0)
 N FBX
"RTN","FBUTL6",21,0)
 I $G(DFN),$G(FBDT) S FBX=$$DELETE^DGPTFEE(DFN,FBDT)
"RTN","FBUTL6",22,0)
 W $C(7),!?5,$S($G(FBX)=1:"Non-VA PTF Record Deleted.",1:"Unable to delete Non-VA PTF Record."),!
"RTN","FBUTL6",23,0)
 Q
"RTN","FBUTL6",24,0)
 ;
"RTN","FBUTL6",25,0)
 ;FBUTL6
"VER")
8.0^22
**END**
**END**
