Released RG*1*6 SEQ #8
Extracted from mail message
**KIDS**:RG*1.0*6^

**INSTALL NAME**
RG*1.0*6
"BLD",885,0)
RG*1.0*6^CLINICAL INFO RESOURCE NETWORK^0^3001013^y
"BLD",885,1,0)
^^3^3^3001011^
"BLD",885,1,1,0)
CIRN AWARE DUPLICATE RECORD MERGE
"BLD",885,1,2,0)
Refer to patch RG*1*6 in the FORUM Patch Module for a complete
"BLD",885,1,3,0)
description.
"BLD",885,4,0)
^9.64PA^991.11^1
"BLD",885,4,991.11,0)
991.11
"BLD",885,4,991.11,222)
y^y^f^^y^^y^m^n
"BLD",885,4,991.11,224)
N X S X=+^(0) I X=233
"BLD",885,4,"B",991.11,991.11)

"BLD",885,"ABNS",0)
^9.66A^^0
"BLD",885,"ABPKG")
n^^
"BLD",885,"KRN",0)
^9.67PA^19^17
"BLD",885,"KRN",.4,0)
.4
"BLD",885,"KRN",.4,"NM",0)
^9.68A^^
"BLD",885,"KRN",.401,0)
.401
"BLD",885,"KRN",.401,"NM",0)
^9.68A^^
"BLD",885,"KRN",.402,0)
.402
"BLD",885,"KRN",.402,"NM",0)
^9.68A^^
"BLD",885,"KRN",.403,0)
.403
"BLD",885,"KRN",.403,"NM",0)
^9.68A^^
"BLD",885,"KRN",.5,0)
.5
"BLD",885,"KRN",.5,"NM",0)
^9.68A^^
"BLD",885,"KRN",.84,0)
.84
"BLD",885,"KRN",.84,"NM",0)
^9.68A^^
"BLD",885,"KRN",3.6,0)
3.6
"BLD",885,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",885,"KRN",3.8,0)
3.8
"BLD",885,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",885,"KRN",9.2,0)
9.2
"BLD",885,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",885,"KRN",9.8,0)
9.8
"BLD",885,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",885,"KRN",9.8,"NM",1,0)
RGDRM01^^0^B6367899
"BLD",885,"KRN",9.8,"NM",2,0)
RGDRM02^^0^B6812090
"BLD",885,"KRN",9.8,"NM",3,0)
RGDRM03^^0^B7470737
"BLD",885,"KRN",9.8,"NM","B","RGDRM01",1)

"BLD",885,"KRN",9.8,"NM","B","RGDRM02",2)

"BLD",885,"KRN",9.8,"NM","B","RGDRM03",3)

"BLD",885,"KRN",19,0)
19
"BLD",885,"KRN",19,"NM",0)
^9.68A^^
"BLD",885,"KRN",19.1,0)
19.1
"BLD",885,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",885,"KRN",101,0)
101
"BLD",885,"KRN",101,"NM",0)
^9.68A^^
"BLD",885,"KRN",409.61,0)
409.61
"BLD",885,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",885,"KRN",771,0)
771
"BLD",885,"KRN",771,"NM",0)
^9.68A^^
"BLD",885,"KRN",870,0)
870
"BLD",885,"KRN",870,"NM",0)
^9.68A^^
"BLD",885,"KRN",8994,0)
8994
"BLD",885,"KRN","B",.4,.4)

"BLD",885,"KRN","B",.401,.401)

"BLD",885,"KRN","B",.402,.402)

"BLD",885,"KRN","B",.403,.403)

"BLD",885,"KRN","B",.5,.5)

"BLD",885,"KRN","B",.84,.84)

"BLD",885,"KRN","B",3.6,3.6)

"BLD",885,"KRN","B",3.8,3.8)

"BLD",885,"KRN","B",9.2,9.2)

"BLD",885,"KRN","B",9.8,9.8)

"BLD",885,"KRN","B",19,19)

"BLD",885,"KRN","B",19.1,19.1)

"BLD",885,"KRN","B",101,101)

"BLD",885,"KRN","B",409.61,409.61)

"BLD",885,"KRN","B",771,771)

"BLD",885,"KRN","B",870,870)

"BLD",885,"KRN","B",8994,8994)

"BLD",885,"QUES",0)
^9.62^^
"BLD",885,"REQB",0)
^9.611^2^2
"BLD",885,"REQB",1,0)
MPIF*1.0*3^2
"BLD",885,"REQB",2,0)
XT*7.3*49^2
"BLD",885,"REQB","B","MPIF*1.0*3",1)

"BLD",885,"REQB","B","XT*7.3*49",2)

"DATA",991.11,233,0)
233^2^1^104
"DATA",991.11,233,10)
Cannot Merge Duplicate Pair
"DATA",991.11,233,99,0)
^^2^2^3000405^
"DATA",991.11,233,99,1,0)
Record pair rejected during merge due to a conflict in ICN or CMOR data.
"DATA",991.11,233,99,2,0)
Check the pair.
"FIA",991.11)
CIRN HL7 EXCEPTION TYPE
"FIA",991.11,0)
^RGHL7(991.11,
"FIA",991.11,0,0)
991.11I
"FIA",991.11,0,1)
y^y^f^^y^^y^m^n
"FIA",991.11,0,10)

"FIA",991.11,0,11)
N X S X=+^(0) I X=233
"FIA",991.11,0,"RLRO")

"FIA",991.11,0,"VR")
1.0^RG
"FIA",991.11,991.11)
0
"FIA",991.11,991.112)
0
"FIA",991.11,991.1199)
0
"FRV1",991.11,"233,0",4)
RG CIRN DEMOGRAPHIC ISSUES
"FRV1",991.11,"233,0",4,"F")
;XMB(3.8,
"MBREQ")
0
"PGL",991.11,0,4,6)
MAIL GROUP^P3.8'^XMB(3.8,^0;4^Q
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^2^1
"PKG",272,20,2,0)
2^^RGDRM03
"PKG",272,20,"B",2,2)

"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
6^3001013
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3001013
"PKG",272,22,1,"PAH",1,1,1,0)
CIRN AWARE DUPLICATE RECORD MERGE
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*6 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RGDRM01")
0^1^B6367899
"RTN","RGDRM01",1,0)
RGDRM01 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;02/22/00
"RTN","RGDRM01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6**;30 Apr 99
"RTN","RGDRM01",3,0)
 ;
"RTN","RGDRM01",4,0)
CKICNS(DFNFRM,DFNTO) ;Check ICN's of FROM and TO records of
"RTN","RGDRM01",5,0)
 ; duplicate record pair
"RTN","RGDRM01",6,0)
 N RETURN,ICNFRM,ICNTO,LOCFRM,LOCTO,HOME
"RTN","RGDRM01",7,0)
 S RETURN="1^OK to merge"
"RTN","RGDRM01",8,0)
 I ($G(DFNFRM)'>0)!($G(DFNTO)'>0) S RETURN="0^MISSING DFN" G EXIT
"RTN","RGDRM01",9,0)
 S ICNFRM=$$GETICN^MPIF001(DFNFRM)
"RTN","RGDRM01",10,0)
 ; If FROM record has no ICN quit
"RTN","RGDRM01",11,0)
 I ICNFRM<0 G EXIT
"RTN","RGDRM01",12,0)
 S ICNTO=$$GETICN^MPIF001(DFNTO)
"RTN","RGDRM01",13,0)
 S LOCFRM=$$IFLOCAL^MPIF001(DFNFRM)
"RTN","RGDRM01",14,0)
 S LOCTO=$$IFLOCAL^MPIF001(DFNTO)
"RTN","RGDRM01",15,0)
 ; If both records have local ICNs, delete FROM data, keep TO data 
"RTN","RGDRM01",16,0)
 I (LOCFRM=1)&(LOCTO=1) D DEL  G EXIT
"RTN","RGDRM01",17,0)
 S HOME=$$SITE^VASITE()
"RTN","RGDRM01",18,0)
 ; If both records have National ICNs, log an exception
"RTN","RGDRM01",19,0)
 I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&($E(ICNTO,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNTO>0)) D  G EXIT
"RTN","RGDRM01",20,0)
 . S RETURN="0^CANNOT MERGE RECORDS "_DFNFRM_" AND "_DFNTO_", both records have national ICNs assigned and must be resolved before merging."
"RTN","RGDRM01",21,0)
 . ; exception is logged when RETURN is passed back to RGDRM03
"RTN","RGDRM01",22,0)
 . ; Q RETURN
"RTN","RGDRM01",23,0)
 ; If FROM record is local and TO record is null, merge
"RTN","RGDRM01",24,0)
 I (LOCFRM=1)&(ICNTO<0) D MRGICN
"RTN","RGDRM01",25,0)
 ; If FROM record is National and TO record is local, merge
"RTN","RGDRM01",26,0)
 E  I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&(LOCTO=1) D MRGICN
"RTN","RGDRM01",27,0)
 ; If FROM record is National and TO record is null, merge
"RTN","RGDRM01",28,0)
 E  I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&(ICNTO<1) D MRGICN
"RTN","RGDRM01",29,0)
 ; If FROM record is local and TO record is National, delete FROM data, keep TO data
"RTN","RGDRM01",30,0)
 E  I (LOCFRM=1)&(LOCTO=0)&(ICNTO>0) D DEL  G EXIT
"RTN","RGDRM01",31,0)
 ;
"RTN","RGDRM01",32,0)
EXIT ;
"RTN","RGDRM01",33,0)
 Q RETURN
"RTN","RGDRM01",34,0)
MRGICN ;Set ICN and ICN Checksum in TO record to values in FROM record
"RTN","RGDRM01",35,0)
 N ICN,CKSUM,DIQUIET,RGRSICN
"RTN","RGDRM01",36,0)
 S DIQUIET=1,RGRSICN=1
"RTN","RGDRM01",37,0)
 S ICN=$P(ICNFRM,"V",1),CKSUM=$P(ICNFRM,"V",2)
"RTN","RGDRM01",38,0)
 L +^DPT(DFNTO):10
"RTN","RGDRM01",39,0)
 S DIE="^DPT(",DA=DFNTO,DR="991.01///^S X=ICN;991.02///^S X=CKSUM"
"RTN","RGDRM01",40,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM01",41,0)
 L -^DPT(DFNTO)
"RTN","RGDRM01",42,0)
 S ICNTO="" S ICNTO=$$GETICN^MPIF001(DFNTO)
"RTN","RGDRM01",43,0)
 ;Make sure local icn flag is not set if national just got assigned
"RTN","RGDRM01",44,0)
 I ($E(ICNTO,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNTO>0)) D
"RTN","RGDRM01",45,0)
 . L +^DPT(DFNTO):10
"RTN","RGDRM01",46,0)
 . S DIE="^DPT(",DA=DFNTO,DR="991.04///@"
"RTN","RGDRM01",47,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGDRM01",48,0)
 . L -^DPT(DFNTO)
"RTN","RGDRM01",49,0)
 ; set local icn flag to Y if local just got assigned
"RTN","RGDRM01",50,0)
 I $E(ICNTO,1,3)=$E($P(HOME,"^",3),1,3) D
"RTN","RGDRM01",51,0)
 . L +^DPT(DFNTO):10
"RTN","RGDRM01",52,0)
 . S DIE="^DPT(",DA=DFNTO,DR="991.04///^S X=1"
"RTN","RGDRM01",53,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGDRM01",54,0)
 . L -^DPT(DFNTO)
"RTN","RGDRM01",55,0)
 ;Delete ICN, ICN Checksum and Locally Assigned ICN fields in FROM record
"RTN","RGDRM01",56,0)
DEL S DIQUIET=1,RGRSICN=1
"RTN","RGDRM01",57,0)
 L +^DPT(DFNFRM):10
"RTN","RGDRM01",58,0)
 S DIE="^DPT(",DA=DFNFRM,DR="991.01///@;991.02///@;991.04///@"
"RTN","RGDRM01",59,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM01",60,0)
 K ^DPT("AICN",ICN,DFNFRM)
"RTN","RGDRM01",61,0)
 L -^DPT(DFNFRM)
"RTN","RGDRM01",62,0)
 Q
"RTN","RGDRM02")
0^2^B6812090
"RTN","RGDRM02",1,0)
RGDRM02 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;03/10/00
"RTN","RGDRM02",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6**;30 Apr 99
"RTN","RGDRM02",3,0)
MRGTF(DFNFRM,DFNTO) ; Merge Treating Facility entries 
"RTN","RGDRM02",4,0)
 I '$D(DFNFRM)!'$D(DFNTO) Q
"RTN","RGDRM02",5,0)
 Q:'$D(^DGCN(391.91,"APAT",DFNFRM))
"RTN","RGDRM02",6,0)
 ; Add Treating Facilities in FROM record to Treating 
"RTN","RGDRM02",7,0)
 ; Facility List for TO record
"RTN","RGDRM02",8,0)
 S INST=0
"RTN","RGDRM02",9,0)
 F  S INST=$O(^DGCN(391.91,"APAT",DFNFRM,INST)) Q:'INST  D
"RTN","RGDRM02",10,0)
 . I '$D(^DGCN(391.91,"APAT",DFNTO,INST)) DO
"RTN","RGDRM02",11,0)
 .. ;S STANUM=0
"RTN","RGDRM02",12,0)
 .. ;S STANUM=$P($$NS^XUAF4(INST),"^",2)
"RTN","RGDRM02",13,0)
 .. D FILE^VAFCTFU(DFNTO,INST)
"RTN","RGDRM02",14,0)
 .. I '$D(^DGCN(391.91,"APAT",DFNTO,INST)) D
"RTN","RGDRM02",15,0)
 ... D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(212,"Treating Facility Add failed for DFN: "_DFNTO_", Treating Facility: "_INST,DFNTO),STOP^RGHLLOG(0) Q
"RTN","RGDRM02",16,0)
 . ;Delete FROM record Treating Facility data
"RTN","RGDRM02",17,0)
 . S IEN=0
"RTN","RGDRM02",18,0)
 . F  S IEN=$O(^DGCN(391.91,"APAT",DFNFRM,INST,IEN)) Q:'IEN  D
"RTN","RGDRM02",19,0)
 .. S DA=IEN,DIK="^DGCN(391.91,"
"RTN","RGDRM02",20,0)
 .. D ^DIK K DIK,DA
"RTN","RGDRM02",21,0)
 K INST,STANUM,IEN
"RTN","RGDRM02",22,0)
 Q
"RTN","RGDRM02",23,0)
MRGSUB(DFNFRM,DFNTO) ; Merge Subscription entries.
"RTN","RGDRM02",24,0)
 I '$D(DFNFRM)!'$D(DFNTO) Q
"RTN","RGDRM02",25,0)
 N SUBFRM,SUBTO
"RTN","RGDRM02",26,0)
 S SUBFRM=$$SUBNUM^MPIFAPI(DFNFRM)
"RTN","RGDRM02",27,0)
 Q:SUBFRM<0  ;No subscriptions in FRM record, quit
"RTN","RGDRM02",28,0)
 S SUBTO=$$SUBNUM^MPIFAPI(DFNTO)
"RTN","RGDRM02",29,0)
 I SUBTO<0 S SUBTO=$$GETSCN^RGJCREC(DFNTO)
"RTN","RGDRM02",30,0)
 S ENTRYF=0,ENTRYT=0
"RTN","RGDRM02",31,0)
 D GET^HLSUB(SUBFRM,0,"",.FROM)
"RTN","RGDRM02",32,0)
 D GET^HLSUB(SUBTO,0,"",.TO)
"RTN","RGDRM02",33,0)
 F  S ENTRYF=$O(FROM("LINKS",ENTRYF)) Q:'ENTRYF  D
"RTN","RGDRM02",34,0)
 . S LINKF=$P(FROM("LINKS",ENTRYF),"^",2)
"RTN","RGDRM02",35,0)
 . S MATCH=0
"RTN","RGDRM02",36,0)
 . F  S ENTRYT=$O(TO("LINKS",ENTRYT)) Q:'ENTRYT  D
"RTN","RGDRM02",37,0)
 .. S LINKT=$P(TO("LINKS",ENTRYT),"^",2)
"RTN","RGDRM02",38,0)
 .. I LINKF=LINKT S MATCH=1 Q
"RTN","RGDRM02",39,0)
 . I MATCH=0 D
"RTN","RGDRM02",40,0)
 .. S TYPE=0
"RTN","RGDRM02",41,0)
 .. D UPD^HLSUB(SUBTO,LINKF,TYPE,"","","",.ER)
"RTN","RGDRM02",42,0)
 .. K TO
"RTN","RGDRM02",43,0)
 .. D GET^HLSUB(SUBTO,0,"",.TO)  ; get new list
"RTN","RGDRM02",44,0)
 .. S L=0,LINK="",ADD=0
"RTN","RGDRM02",45,0)
 .. F  S L=$O(TO("LINKS",L)) Q:'L  D
"RTN","RGDRM02",46,0)
 ... S LINK=$P(TO("LINKS",L),"^",2) I LINK=LINKF S ADD=1
"RTN","RGDRM02",47,0)
 .. I ADD=0 D
"RTN","RGDRM02",48,0)
 ... D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(224,"Subscription Add Failed for DFN: "_DFNTO_", Subscriber: "_LINKF,DFNTO),STOP^RGHLLOG(0) Q
"RTN","RGDRM02",49,0)
 ; Delete FROM record subscription data and pointer to subscription file
"RTN","RGDRM02",50,0)
 N RGARR,RGERR
"RTN","RGDRM02",51,0)
 S RGARR(991.05)="@"
"RTN","RGDRM02",52,0)
 S RGERR=$$UPDATE^MPIFAPI(DFNFRM,"RGARR")
"RTN","RGDRM02",53,0)
 K ENTRYF,ENTRYT,LINKF,LINKT,TO,MATCH,FROM,LNAME,LIEN,TYPE,ER,ADD,L,LINK
"RTN","RGDRM02",54,0)
 Q
"RTN","RGDRM03")
0^3^B7470737
"RTN","RGDRM03",1,0)
RGDRM03 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;03/17/00
"RTN","RGDRM03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6**;30 Apr 99
"RTN","RGDRM03",3,0)
EN(ARRAY) ; Entry point
"RTN","RGDRM03",4,0)
 F DFNFRM=0:0 S DFNFRM=$O(@ARRAY@(DFNFRM)) Q:DFNFRM'>0  D
"RTN","RGDRM03",5,0)
 . S DFNTO=$O(@ARRAY@(DFNFRM,""))
"RTN","RGDRM03",6,0)
 . S IENFRM=$O(@ARRAY@(DFNFRM,DFNTO,""))
"RTN","RGDRM03",7,0)
 . S IENTO=$O(@ARRAY@(DFNFRM,DFNTO,IENFRM,""))
"RTN","RGDRM03",8,0)
 . S RETURN=$$CKCMORS(DFNFRM,DFNTO)
"RTN","RGDRM03",9,0)
 . I $P(RETURN,"^",1)<1 D
"RTN","RGDRM03",10,0)
 .. D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(233,$P(RETURN,"^",2),DFNTO),STOP^RGHLLOG(0)
"RTN","RGDRM03",11,0)
 ..; remove pair from merge
"RTN","RGDRM03",12,0)
 .. S IEN=""
"RTN","RGDRM03",13,0)
 .. S IEN=+$G(@ARRAY@(DFNFRM,DFNTO,IENFRM,IENTO))
"RTN","RGDRM03",14,0)
 .. D RMOVPAIR^XDRDVAL1(DFNFRM,DFNTO,IEN,ARRAY)
"RTN","RGDRM03",15,0)
 ; Check to see if there are any pairs left to merge
"RTN","RGDRM03",16,0)
 K IEN,IENTO,IENFRM
"RTN","RGDRM03",17,0)
 Q
"RTN","RGDRM03",18,0)
CKCMORS(DFNFRM,DFNTO) ;Check for conflicting CMORs
"RTN","RGDRM03",19,0)
 N CMORFRM,CMORTO,RETURN,HOME
"RTN","RGDRM03",20,0)
 S RETURN="1^OK to merge"
"RTN","RGDRM03",21,0)
 I ($G(DFNFRM)'>0)!($G(DFNTO)'>0) S RETURN="0^DFN NOT PASSED" G EXIT
"RTN","RGDRM03",22,0)
 S CMORFRM=$$GETVCCI^MPIF001(DFNFRM)
"RTN","RGDRM03",23,0)
 S CMORTO=$$GETVCCI^MPIF001(DFNTO)
"RTN","RGDRM03",24,0)
 S HOME=$$SITE^VASITE()
"RTN","RGDRM03",25,0)
 I CMORTO'=$E($P(HOME,"^",3),1,3)&(CMORTO>0) S RETURN="0^CANNOT MERGE, your site is not the CMOR site for record "_DFNTO G EXIT
"RTN","RGDRM03",26,0)
 I CMORFRM<1 G SKPCMOR
"RTN","RGDRM03",27,0)
 I CMORFRM'=$E($P(HOME,"^",3),1,3)&(CMORFRM>0) S RETURN="0^CANNOT MERGE, your site is not the CMOR site for record "_DFNFRM G EXIT
"RTN","RGDRM03",28,0)
 ; If the 'FROM' record has a CMOR and the 'TO' record does not, set the
"RTN","RGDRM03",29,0)
 ; field in the 'TO' record and delete the field in the 'FROM' record.
"RTN","RGDRM03",30,0)
 ; The CMOR score will be recalculated for the TO record when 
"RTN","RGDRM03",31,0)
 ; merge completes.
"RTN","RGDRM03",32,0)
 I (CMORFRM>0)&(CMORTO<0) D
"RTN","RGDRM03",33,0)
 . L +^DPT(DFNTO):10
"RTN","RGDRM03",34,0)
 . S DIE="^DPT(",DA=DFNTO,DR="991.03///^S X=CMORFRM"
"RTN","RGDRM03",35,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGDRM03",36,0)
 . L -^DPT(DFNTO)
"RTN","RGDRM03",37,0)
 ; Delete field in 'FROM' record if both records do not have National ICN
"RTN","RGDRM03",38,0)
 N ICNFRM,ICNTO
"RTN","RGDRM03",39,0)
 S ICNFRM=$$GETICN^MPIF001(DFNFRM)
"RTN","RGDRM03",40,0)
 S ICNTO=$$GETICN^MPIF001(DFNTO)
"RTN","RGDRM03",41,0)
 I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&($E(ICNTO,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNTO>0)) G SKPCMOR
"RTN","RGDRM03",42,0)
 L +^DPT(DFNFRM):10
"RTN","RGDRM03",43,0)
 S DIE="^DPT(",DA=DFNFRM,DR="991.03///@;991.06///@;991.07///@"
"RTN","RGDRM03",44,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM03",45,0)
 L -^DPT(DFNFRM)
"RTN","RGDRM03",46,0)
 ; Check ICNs of FROM and TO record and merge data where appropriate
"RTN","RGDRM03",47,0)
SKPCMOR S RETURN=$$CKICNS^RGDRM01(DFNFRM,DFNTO)
"RTN","RGDRM03",48,0)
 I $P(RETURN,"^",1)=1 D
"RTN","RGDRM03",49,0)
 . D MRGTF^RGDRM02(DFNFRM,DFNTO)
"RTN","RGDRM03",50,0)
 . D MRGSUB^RGDRM02(DFNFRM,DFNTO)
"RTN","RGDRM03",51,0)
EXIT ;
"RTN","RGDRM03",52,0)
 Q RETURN
"RTN","RGDRM03",53,0)
GETSCR(DFN) ; Get CMOR score and calculation date given IEN (DFN) of patient file (#2)
"RTN","RGDRM03",54,0)
 Q:'DFN
"RTN","RGDRM03",55,0)
 N SCORE,SCOREDT,RETURN,SCR
"RTN","RGDRM03",56,0)
 I '$D(^DPT(DFN,"MPI")) S RETURN="-1^No MPI Node" G EXIT2
"RTN","RGDRM03",57,0)
 S DIC="^DPT(",DR="991.06;991.07",DA=DFN,DIQ="SCR",DIQ(0)="I"
"RTN","RGDRM03",58,0)
 D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","RGDRM03",59,0)
 S SCORE=$G(SCR(2,DFN,991.06,"I"))
"RTN","RGDRM03",60,0)
 S SCOREDT=$G(SCR(2,DFN,991.07,"I"))
"RTN","RGDRM03",61,0)
 S RETURN=SCORE_"^"_SCOREDT
"RTN","RGDRM03",62,0)
EXIT2 ;
"RTN","RGDRM03",63,0)
 Q RETURN
"SEC","^DIC",991.11,991.11,0,"AUDIT")
@
"SEC","^DIC",991.11,991.11,0,"DD")
@
"SEC","^DIC",991.11,991.11,0,"DEL")
@
"SEC","^DIC",991.11,991.11,0,"LAYGO")
@
"SEC","^DIC",991.11,991.11,0,"RD")
@
"SEC","^DIC",991.11,991.11,0,"WR")
@
"VER")
8.0^22.0
"^DD",991.11,991.11,0)
FIELD^^99^8
"^DD",991.11,991.11,0,"DDA")
N
"^DD",991.11,991.11,0,"DT")
2980721
"^DD",991.11,991.11,0,"ID",10)
W:$D(^(10)) "   ",$E(^(10),1,100)
"^DD",991.11,991.11,0,"IX","B",991.11,.01)

"^DD",991.11,991.11,0,"IX","C",991.11,10)

"^DD",991.11,991.11,0,"NM","CIRN HL7 EXCEPTION TYPE")

"^DD",991.11,991.11,0,"PT",991.12,2)

"^DD",991.11,991.11,0,"VRPK")
RG
"^DD",991.11,991.11,.01,0)
NUMBER^RNJ12,0X^^0;1^K:X'=X\1!(X<1) X S:$D(X) DINUM=X
"^DD",991.11,991.11,.01,1,0)
^.1
"^DD",991.11,991.11,.01,1,1,0)
991.11^B
"^DD",991.11,991.11,.01,1,1,1)
S ^RGHL7(991.11,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.11,.01,1,1,2)
K ^RGHL7(991.11,"B",$E(X,1,30),DA)
"^DD",991.11,991.11,.01,3)
Index of this exception.
"^DD",991.11,991.11,.01,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,.01,21,1,0)
This is the index number of this exception.
"^DD",991.11,991.11,.01,"DT")
2970201
"^DD",991.11,991.11,1,0)
SEVERITY^S^0:INFORMATIONAL;1:MINOR;2:SEVERE;^0;2^Q
"^DD",991.11,991.11,1,3)
Severity level of this exception.
"^DD",991.11,991.11,1,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,1,21,1,0)
This is the severity level of this exception, '0' for Informational,
"^DD",991.11,991.11,1,21,2,0)
'1' for Minor or '2' for Severe.
"^DD",991.11,991.11,1,"DT")
2970201
"^DD",991.11,991.11,2,0)
ACTION^S^0:NONE;1:MAIL;2:ALERT;^0;3^Q
"^DD",991.11,991.11,2,3)
Action to be taken upon logging this exception.
"^DD",991.11,991.11,2,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,2,21,1,0)
This is the action to be taken upon logging this exception,
"^DD",991.11,991.11,2,21,2,0)
'0' for None, '1' for Mail, or '2' for Alert.
"^DD",991.11,991.11,2,"DT")
2970201
"^DD",991.11,991.11,3,0)
COUNT^NJ12,0X^^0;5^K:X\1'=X!(X<0) X
"^DD",991.11,991.11,3,3)
Total number of exceptions logged with this type.
"^DD",991.11,991.11,3,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,3,21,1,0)
This is a count of all exceptions logged of this type.
"^DD",991.11,991.11,3,"DT")
2970317
"^DD",991.11,991.11,6,0)
MAIL GROUP^P3.8'^XMB(3.8,^0;4^Q
"^DD",991.11,991.11,6,3)
Mail group to which notification will be sent for alert and mail action types.
"^DD",991.11,991.11,6,21,0)
^^3^3^2990308^^
"^DD",991.11,991.11,6,21,1,0)
This is a pointer to the MAIL GROUP file (#3.8), indicating
"^DD",991.11,991.11,6,21,2,0)
which mail group a notification will be sent to for alert
"^DD",991.11,991.11,6,21,3,0)
and mail action types.
"^DD",991.11,991.11,6,"DT")
2970201
"^DD",991.11,991.11,10,0)
TEXT^F^^10;E1,100^K:$L(X)>100!($L(X)<1) X
"^DD",991.11,991.11,10,1,0)
^.1
"^DD",991.11,991.11,10,1,1,0)
991.11^C
"^DD",991.11,991.11,10,1,1,1)
S ^RGHL7(991.11,"C",$E(X,1,30),DA)=""
"^DD",991.11,991.11,10,1,1,2)
K ^RGHL7(991.11,"C",$E(X,1,30),DA)
"^DD",991.11,991.11,10,1,1,"DT")
2970201
"^DD",991.11,991.11,10,3)
Text message for this exception.
"^DD",991.11,991.11,10,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,10,21,1,0)
This is a free text field (up to 100 characters) which holds the
"^DD",991.11,991.11,10,21,2,0)
message for this exception.
"^DD",991.11,991.11,10,"DT")
2970201
"^DD",991.11,991.11,20,0)
SECURITY KEY^991.112P^^20;0
"^DD",991.11,991.11,20,21,0)
^^4^4^2990308^^^
"^DD",991.11,991.11,20,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.11,20,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.11,20,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.11,20,21,4,0)
access is unrestricted.
"^DD",991.11,991.11,99,0)
DESCRIPTION^991.1199^^99;0
"^DD",991.11,991.11,99,21,0)
^^2^2^2990308^^^
"^DD",991.11,991.11,99,21,1,0)
This is a word-processing field used for storing
"^DD",991.11,991.11,99,21,2,0)
the detailed explanation of this exception type.
"^DD",991.11,991.112,0)
SECURITY KEY SUB-FIELD^^.01^1
"^DD",991.11,991.112,0,"DT")
2980721
"^DD",991.11,991.112,0,"IX","B",991.112,.01)

"^DD",991.11,991.112,0,"NM","SECURITY KEY")

"^DD",991.11,991.112,0,"UP")
991.11
"^DD",991.11,991.112,.01,0)
SECURITY KEY^MP19.1'X^DIC(19.1,^0;1^S DINUM=X
"^DD",991.11,991.112,.01,1,0)
^.1
"^DD",991.11,991.112,.01,1,1,0)
991.112^B
"^DD",991.11,991.112,.01,1,1,1)
S ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.112,.01,1,1,2)
K ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)
"^DD",991.11,991.112,.01,3)
Enter a security key to control access to this exception.
"^DD",991.11,991.112,.01,21,0)
^^4^4^2990308^^
"^DD",991.11,991.112,.01,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.112,.01,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.112,.01,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.112,.01,21,4,0)
access is unrestricted.
"^DD",991.11,991.112,.01,"DT")
2980721
"^DD",991.11,991.1199,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",991.11,991.1199,0,"DT")
2970201
"^DD",991.11,991.1199,0,"NM","DESCRIPTION")

"^DD",991.11,991.1199,0,"UP")
991.11
"^DD",991.11,991.1199,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",991.11,991.1199,.01,3)
Detailed explanation of this exception.
"^DD",991.11,991.1199,.01,21,0)
^^1^1^2990308^^^
"^DD",991.11,991.1199,.01,21,1,0)
This field holds the detailed explanation of this exception.
"^DD",991.11,991.1199,.01,"DT")
2970201
"^DIC",991.11,991.11,0)
CIRN HL7 EXCEPTION TYPE^991.11
"^DIC",991.11,991.11,0,"GL")
^RGHL7(991.11,
"^DIC",991.11,991.11,"%D",0)
^^3^3^2990308^^
"^DIC",991.11,991.11,"%D",1,0)
This file holds the CIRN HL7 exception types.  It is pointed to by
"^DIC",991.11,991.11,"%D",2,0)
the TYPE field (#2) for the EXCEPTION subfield (#991.12) of the CIRN
"^DIC",991.11,991.11,"%D",3,0)
HL7 EXCEPTION LOG file (#991.1).
"^DIC",991.11,"B","CIRN HL7 EXCEPTION TYPE",991.11)

**END**
**END**
