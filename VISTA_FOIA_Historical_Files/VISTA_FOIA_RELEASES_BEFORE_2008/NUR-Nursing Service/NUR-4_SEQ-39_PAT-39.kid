Released NUR*4*39 SEQ #39
Extracted from mail message
**KIDS**:NUR*4.0*39^

**INSTALL NAME**
NUR*4.0*39
"BLD",3525,0)
NUR*4.0*39^NURSING SERVICE^0^3030516^y
"BLD",3525,1,0)
^^2^2^3030430^
"BLD",3525,1,1,0)
This patches modifies the Employee Activation/Separation 
"BLD",3525,1,2,0)
Report to show start/vacancy dates entered in the past.
"BLD",3525,4,0)
^9.64PA^^
"BLD",3525,"KRN",0)
^9.67PA^8989.52^19
"BLD",3525,"KRN",.4,0)
.4
"BLD",3525,"KRN",.401,0)
.401
"BLD",3525,"KRN",.402,0)
.402
"BLD",3525,"KRN",.403,0)
.403
"BLD",3525,"KRN",.5,0)
.5
"BLD",3525,"KRN",.84,0)
.84
"BLD",3525,"KRN",3.6,0)
3.6
"BLD",3525,"KRN",3.8,0)
3.8
"BLD",3525,"KRN",9.2,0)
9.2
"BLD",3525,"KRN",9.8,0)
9.8
"BLD",3525,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3525,"KRN",9.8,"NM",1,0)
NURSUT1^^0^B22797773
"BLD",3525,"KRN",9.8,"NM",2,0)
NURAMU3^^0^B9318112
"BLD",3525,"KRN",9.8,"NM","B","NURAMU3",2)

"BLD",3525,"KRN",9.8,"NM","B","NURSUT1",1)

"BLD",3525,"KRN",19,0)
19
"BLD",3525,"KRN",19.1,0)
19.1
"BLD",3525,"KRN",101,0)
101
"BLD",3525,"KRN",409.61,0)
409.61
"BLD",3525,"KRN",771,0)
771
"BLD",3525,"KRN",870,0)
870
"BLD",3525,"KRN",8989.51,0)
8989.51
"BLD",3525,"KRN",8989.52,0)
8989.52
"BLD",3525,"KRN",8994,0)
8994
"BLD",3525,"KRN","B",.4,.4)

"BLD",3525,"KRN","B",.401,.401)

"BLD",3525,"KRN","B",.402,.402)

"BLD",3525,"KRN","B",.403,.403)

"BLD",3525,"KRN","B",.5,.5)

"BLD",3525,"KRN","B",.84,.84)

"BLD",3525,"KRN","B",3.6,3.6)

"BLD",3525,"KRN","B",3.8,3.8)

"BLD",3525,"KRN","B",9.2,9.2)

"BLD",3525,"KRN","B",9.8,9.8)

"BLD",3525,"KRN","B",19,19)

"BLD",3525,"KRN","B",19.1,19.1)

"BLD",3525,"KRN","B",101,101)

"BLD",3525,"KRN","B",409.61,409.61)

"BLD",3525,"KRN","B",771,771)

"BLD",3525,"KRN","B",870,870)

"BLD",3525,"KRN","B",8989.51,8989.51)

"BLD",3525,"KRN","B",8989.52,8989.52)

"BLD",3525,"KRN","B",8994,8994)

"BLD",3525,"QUES",0)
^9.62^^
"BLD",3525,"REQB",0)
^9.611^2^2
"BLD",3525,"REQB",1,0)
NUR*4.0*9^2
"BLD",3525,"REQB",2,0)
NUR*4.0*13^2
"BLD",3525,"REQB","B","NUR*4.0*13",2)

"BLD",3525,"REQB","B","NUR*4.0*9",1)

"MBREQ")
0
"PKG",28,-1)
1^1
"PKG",28,0)
NURSING SERVICE^NUR^Nursing Service General Module
"PKG",28,22,0)
^9.49I^1^1
"PKG",28,22,1,0)
4.0^2970509^2970619^11713
"PKG",28,22,1,"PAH",1,0)
39^3030516
"PKG",28,22,1,"PAH",1,1,0)
^^2^2^3030516
"PKG",28,22,1,"PAH",1,1,1,0)
This patches modifies the Employee Activation/Separation 
"PKG",28,22,1,"PAH",1,1,2,0)
Report to show start/vacancy dates entered in the past.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","NURAMU3")
0^2^B9318112
"RTN","NURAMU3",1,0)
NURAMU3 ;HIRMFO/MD-EMPLOYEE ACT/SEP BATCH JOB 9/20/96 ; 4/29/03 11:23am
"RTN","NURAMU3",2,0)
 ;;4.0;NURSING SERVICE;**9,39**;Apr 25, 1997
"RTN","NURAMU3",3,0)
EN1 ;BATCH RUN TO UPDATE STAFF SEP/ACT DATA IN 213.5 FILE AND STATUS IF APPROPRIATE
"RTN","NURAMU3",4,0)
 S NURSDATE=RPTDATE,U="^" S:'$D(^DIC(213.9,1,"DATE")) ^DIC(213.9,1,"DATE")="" S $P(^DIC(213.9,1,"DATE"),U,9)=0
"RTN","NURAMU3",5,0)
 F NUX=0:0 S NUX=$O(^NURSF(211.8,"ASD",NUX)) Q:NUX'>0  F NOD=0:0 S NOD=$O(^NURSF(211.8,"ASD",NUX,NOD)) Q:NOD'>0  F NDA=0:0 S NDA=$O(^NURSF(211.8,"ASD",NUX,NOD,NDA)) Q:NDA'>0  I $D(^NURSF(211.8,NOD,1,NDA,0)) S NURSEMP=+$P(^(0),U,2) D NURSCK
"RTN","NURAMU3",6,0)
 S:'$D(^DIC(213.9,1,"DATE")) ^("DATE")="" S $P(^("DATE"),U,9)=1
"RTN","NURAMU3",7,0)
QUIT ;
"RTN","NURAMU3",8,0)
 K NEXCDA,NURSDATE,NUR,NURSPO,NURLOC,NURSEMP,NUX,DA,NOD,NDA,NURSDATE,%DT,NURSEL,I,X,Y Q
"RTN","NURAMU3",9,0)
NURSCK ;
"RTN","NURAMU3",10,0)
 W:'$D(ZTQUEUED) "." S DA(1)=NOD,DA=NDA
"RTN","NURAMU3",11,0)
 I +NUX=2,+$P(^NURSF(211.8,DA(1),1,DA,0),U)'>NURSDATE D NURSBYP S DA(1)=NOD,DA=NDA,X=+$P(^NURSF(211.8,DA(1),1,DA,0),U),NUR=".01^1" D EN1B^NURSUT1
"RTN","NURAMU3",12,0)
 I +NUX=1,+$P(^NURSF(211.8,DA(1),1,DA,0),U,6)'>NURSDATE D NURSBYP S DA(1)=NOD,DA=NDA,X=+$P(^NURSF(211.8,DA(1),1,DA,0),U,6),NUR="3^1" D EN1B^NURSUT1
"RTN","NURAMU3",13,0)
 Q
"RTN","NURAMU3",14,0)
NURSBYP ;
"RTN","NURAMU3",15,0)
 I '$D(^NURSA(213.5,NEXCDA,2,0)) S ^(0)="^213.52P^^"
"RTN","NURAMU3",16,0)
 S NURSPO=$G(^NURSF(211.8,NOD,0)),NURSPO(0)=$G(^NURSF(211.8,NOD,1,NDA,0)),NURLOC=$O(^NURSF(211.4,"B",+NURSPO,0))
"RTN","NURAMU3",17,0)
 S NURSPO(1)=$S($D(^VA(200,+NURSEMP,0)):+NURSEMP,1:""),NURSPO(2)=$S(NUX=1:"S",NUX=2:"A",1:"")
"RTN","NURAMU3",18,0)
 S NURSPO(3)=$S(NUX=1:$P(NURSPO(0),U,6),1:$P(NURSPO(0),U)),NURSPO(4)=$S($D(^NURSF(211.9,+$P(NURSPO(0),U,8),0)):+$P(NURSPO(0),U,8),1:""),NURSPO(5)=$S($D(^NURSF(211.3,+$P(NURSPO(0),U,3),0)):+$P(NURSPO(0),U,3),1:""),NURSPO(6)=+$P(NURSPO(0),U,4)
"RTN","NURAMU3",19,0)
 S DA(1)=NEXCDA,Z=$P(^NURSA(213.5,DA(1),2,0),U,3,4)
"RTN","NURAMU3",20,0)
 S DA=(+$P(Z,U)+1),^NURSA(213.5,DA(1),2,DA,0)=NURSPO(1)_U_NURSPO(2)_U_NURSPO(3)_U_$S(NUX=2:"",1:NURSPO(4))_U_NURLOC_U_NURSPO(5)_U_NURSPO(6),Z=DA_U_(+$P(Z,U,2)+1),$P(^NURSA(213.5,DA(1),2,0),U,3,4)=Z,DIK="^NURSA(213.5,DA(1),2," D IX1^DIK
"RTN","NURAMU3",21,0)
 Q
"RTN","NURSUT1")
0^1^B22797773
"RTN","NURSUT1",1,0)
NURSUT1 ;HIRMFO/RM,MD-NURS POSITION CONTROL FILE EDIT UTILITY (CONT) ; 5/16/03 5:10pm
"RTN","NURSUT1",2,0)
 ;;4.0;NURSING SERVICE;**2,7,13,39**;Apr 25, 1997
"RTN","NURSUT1",3,0)
EN1 ; ENTRY FROM ASD1 FROM 211.82,.01, ASD2 FROM 211.82,3 AND ASD3 FROM
"RTN","NURSUT1",4,0)
 ; 211.82,5 CROSSREFERENCES.  THE VARIABLE NUR WILL BE SET TO THE
"RTN","NURSUT1",5,0)
 ; FOLLOWING:  FIELD NUMBER CALLING XREF^$S(0:KILL LOGIC,1:SET LOGIC)
"RTN","NURSUT1",6,0)
 N DIK
"RTN","NURSUT1",7,0)
 S NUR(211.82)=$S($D(^NURSF(211.8,DA(1),1,DA,0)):^(0),1:""),NUR("SDT")=$S(+NUR=.01:X,1:+NUR(211.82)),NUR("VDT")=$S(+NUR=3:X,1:$P(NUR(211.82),"^",6))
"RTN","NURSUT1",8,0)
 I +NUR=.01 S:$P(NUR,"^",2) ^NURSF(211.8,"ASD",2,DA(1),DA)="" K:'$P(NUR,"^",2) ^NURSF(211.8,"ASD",2,DA(1),DA)
"RTN","NURSUT1",9,0)
 I +NUR=3 S:$P(NUR,"^",2) ^NURSF(211.8,"ASD",1,DA(1),DA)="" K:'$P(NUR,"^",2) ^NURSF(211.8,"ASD",1,DA(1),DA)
"RTN","NURSUT1",10,0)
 D EMP Q
"RTN","NURSUT1",11,0)
EN1B ; ENTRY POINT TO KILL "ASD" X-REF AFTER ADDED TO 213.5 DURING ACT/SEP BATCH JOB
"RTN","NURSUT1",12,0)
 N DIK
"RTN","NURSUT1",13,0)
 S NUR(211.82)=$S($D(^NURSF(211.8,DA(1),1,DA,0)):^(0),1:""),NUR("SDT")=$S(+NUR=.01:X,1:+NUR(211.82)),NUR("VDT")=$S(+NUR=3:X,1:$P(NUR(211.82),"^",6))
"RTN","NURSUT1",14,0)
 I NUR("SDT")'>DT,+NUR=.01 K ^NURSF(211.8,"ASD",2,DA(1),DA)
"RTN","NURSUT1",15,0)
 I NUR("VDT")'>DT,+NUR=3 K ^NURSF(211.8,"ASD",1,DA(1),DA)
"RTN","NURSUT1",16,0)
EMP D STTUPD I +NUR=.01!(+NUR=3) S NUR("PE")=NUR D EN1^NURSAPE0
"RTN","NURSUT1",17,0)
 K NUR
"RTN","NURSUT1",18,0)
 Q
"RTN","NURSUT1",19,0)
STTUPD ; CHECK IF UPDATE OF STATUS FIELD IN FILE 210 IS NECESSARY
"RTN","NURSUT1",20,0)
 S NUR(0)=X D NOW^%DTC S X=NUR(0),NURSDT=%,(NURSEMP,NUR(200))=$P(NUR(211.82),"^",2) G:NUR(200)'>0 QSU  S NUR(200)=$P(NUR(211.82),"^",2)
"RTN","NURSUT1",21,0)
 S NUR(210)=$O(^NURSF(210,"B",NUR(200),0)) G QSU:NUR(210)'>0 S NUR("OST")=$S($D(^NURSF(210,NUR(210),0)):$P(^(0),"^",2),1:"")
"RTN","NURSUT1",22,0)
 I NUR("OST")'="A",NUR("OST")'="I",+$$EN1^NURSUT0($G(NURSEMP),$G(NURSDT)) S NUR("NST")="A" D SETST
"RTN","NURSUT1",23,0)
 I '+$$EN1^NURSUT0($G(NURSEMP),$G(NURSDT)) S NUR(211.9)=$S(+NUR=5:X,1:$P(NUR(211.82),"^",8)),NUR("NST")=$S(NURSTAT:"A",$D(^NURSF(211.9,+NUR(211.9),0)):$P(^(0),"^",3),1:"R") I NUR("NST")'="",NUR("NST")'=NUR("OST") D SETST
"RTN","NURSUT1",24,0)
QSU Q
"RTN","NURSUT1",25,0)
SETST ; CHANGE STATUS FIELD OF FILE 210
"RTN","NURSUT1",26,0)
 N DA,X S DA=$O(^NURSF(210,"B",NUR(200),0)) Q:DA'>0
"RTN","NURSUT1",27,0)
 I NUR("OST")'="" S X=NUR("OST") K ^NURSF(210,"AC",X,DA)
"RTN","NURSUT1",28,0)
 I NUR("NST")'="" S X=NUR("NST"),$P(^NURSF(210,DA,0),"^",2)=X,DIK="^NURSF(210," D IX1^DIK
"RTN","NURSUT1",29,0)
 Q
"RTN","NURSUT1",30,0)
EN4(NACT,NASK) ; ENTRY POINT FOR BEDSIDE TERMINAL PATIENT LOOK-UP
"RTN","NURSUT1",31,0)
 I '$D(^NURSC(214.8,0)) S NURBEDSW=0 Q
"RTN","NURSUT1",32,0)
 S IEN=0,IEN=$O(^NURSC(214.8,"B",ION,IEN)),ROOMBED=$S(+IEN>0:$P(^NURSC(214.8,IEN,0),U,2),1:""),PATIENT=""
"RTN","NURSUT1",33,0)
 I ROOMBED'="" S IEN=0,IEN=$O(^DPT("RM",ROOMBED,IEN)),PATIENT=$S(+IEN>0:$P(^DPT(IEN,0),U,1),1:"") W !!,?5,"Room-Bed: ",ROOMBED,!,?6,"Patient: ",PATIENT
"RTN","NURSUT1",34,0)
 S:'(DIC(0)["A") DIC(0)="A"_DIC(0) S:'(PATIENT="") DIC("B")=PATIENT
"RTN","NURSUT1",35,0)
 S DIC("A")="Select PATIENT NAME: "
"RTN","NURSUT1",36,0)
 W ! S DFN="",DIC="^DPT(" D ^DIC K DIC S:$L($P(Y,"^",2)) X=$P(Y,"^",2) I $D(DTOUT)!$D(DUOUT) S DFN="" G QUIT
"RTN","NURSUT1",37,0)
 I +Y>0,NACT,'$D(^NURSF(214,"C","A",+Y)) S Y=-2
"RTN","NURSUT1",38,0)
 I +Y>0 S DFN=+Y K DIC W ! G QUIT
"RTN","NURSUT1",39,0)
 I X'["?",(X?1U.UP1","1U.UP) W !!,$C(7),$S('NACT!(NACT&(Y=-1)):"PATIENT not admitted with MAS -- notify MAS",1:"PATIENT is not active in the Nursing system -- notify Nursing ADP coordinator")
"RTN","NURSUT1",40,0)
QUIT K DTOUT,DUOUT,IEN,LOOP,PATIENT,ROOMBED
"RTN","NURSUT1",41,0)
 Q
"RTN","NURSUT1",42,0)
DBL ;CHECK FOR ROOM-BED DUPLICATE ENTRIES
"RTN","NURSUT1",43,0)
 I X="" K X Q
"RTN","NURSUT1",44,0)
 S IEN=0,IEN=$O(^NURSC(214.8,"C",X,IEN))
"RTN","NURSUT1",45,0)
 I +IEN>0 W *7,!!,?5,"That ROOM-BED is already associated with ION VALUE "_$P(^NURSC(214.8,IEN,0),U,1)_"  " K X
"RTN","NURSUT1",46,0)
 K IEN Q
"RTN","NURSUT1",47,0)
CLOSE ; CLOSE DEVICE
"RTN","NURSUT1",48,0)
 W !
"RTN","NURSUT1",49,0)
 I '+$G(NUROUT) D ENDPG
"RTN","NURSUT1",50,0)
 D ^%ZISC
"RTN","NURSUT1",51,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","NURSUT1",52,0)
 Q
"RTN","NURSUT1",53,0)
ENDPG ; HANDLE EOP
"RTN","NURSUT1",54,0)
 I $E($G(IOST))'="C" Q
"RTN","NURSUT1",55,0)
 K DIR S DIR(0)="E" D ^DIR K DIR S NUROUT=$S(+Y'>0:1,1:0)
"RTN","NURSUT1",56,0)
 Q
"RTN","NURSUT1",57,0)
LOCSTAT(NURLOC) ; CHECK FOR ACTIVE EMPLOYEES ON NURS LOCATION
"RTN","NURSUT1",58,0)
 N NURPOS,NPOSDA S NURACTV=0
"RTN","NURSUT1",59,0)
 S NURPOS="" F  S NURPOS=$O(^NURSF(211.8,"B",+NURLOC,NURPOS)) Q:NURPOS'>0  S NPOSDA=0 F  S NPOSDA=$O(^NURSF(211.8,NURPOS,1,NPOSDA)) Q:NPOSDA'>0  I $G(^NURSF(211.8,NURPOS,1,NPOSDA,0))'="" D
"RTN","NURSUT1",60,0)
 .  I $P($G(^NURSF(211.8,NURPOS,1,NPOSDA,0)),U,6)=""!($P($G(^(0)),U,6)'<DT) S NURACTV=1 Q
"RTN","NURSUT1",61,0)
 .  Q
"RTN","NURSUT1",62,0)
 Q NURACTV
"RTN","NURSUT1",63,0)
CHKSTAT ; INPUT TRANSFORM FOR STATUS FIELD OF NURS LOCATION FILE
"RTN","NURSUT1",64,0)
 N NURLOC S NURLOC=+$G(^NURSF(211.4,+DA,0)),NURLOC(1)=$P(^SC(+$G(^NURSF(211.4,DA,0)),0),"^"),NURLOC(1)=$P(NURLOC(1),"NUR ",2),NURSTAT=0,NURSTAT=$S($G(X)="I":+$$LOCSTAT^NURSUT1(NURLOC),1:0)
"RTN","NURSUT1",65,0)
 I $G(X)="I",$G(NURSTAT)>0 D
"RTN","NURSUT1",66,0)
 . W $C(7),!!,NURLOC(1)," HAS ACTIVE STAFF ASSIGNED AND CANNOT BE DEACTIVATED: ",!!,"Generate an FTEE report for this location to identify active staff members",!,"who should be transferred prior to deactivation!" D ENDPG^NURSUT1
"RTN","NURSUT1",67,0)
 . Q
"RTN","NURSUT1",68,0)
 Q
"RTN","NURSUT1",69,0)
BUDCAT(D0) ; COMPUTE BUDGET CATEGORY FTEE FOR A LOCATION
"RTN","NURSUT1",70,0)
 N D1 S X=0
"RTN","NURSUT1",71,0)
 S D1=0 F  S D1=$O(^NURSF(211.8,D0,2,D1)) Q:D1'>0  I $D(^NURSF(211.8,D0,2,D1,0)) S X=(X+$P(^(0),U,2))
"RTN","NURSUT1",72,0)
 Q X
"RTN","NURSUT1",73,0)
NODATA ; NO DATA ROUTINE FOR LOCATION REPORTS
"RTN","NURSUT1",74,0)
 W !!,"THERE IS NO DATA FOR ",NL1
"RTN","NURSUT1",75,0)
 Q
"VER")
8.0^22.0
**END**
**END**
