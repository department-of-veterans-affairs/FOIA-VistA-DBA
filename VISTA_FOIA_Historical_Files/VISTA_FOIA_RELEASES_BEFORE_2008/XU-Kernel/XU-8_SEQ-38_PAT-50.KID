Released XU*8*50 SEQ #38
Extracted from mail message
**KIDS**:XU*8.0*50^

**INSTALL NAME**
XU*8.0*50
"BLD",130,0)
XU*8.0*50^^0^^n
"BLD",130,1,0)
^^46^46^2961015^
"BLD",130,1,1,0)
      This patch contains a routine, and input template, and a change to
"BLD",130,1,2,0)
the data dictionary of the Option File [^DIC(19)].  It corrects 3 problems
"BLD",130,1,3,0)
with servers:
"BLD",130,1,4,0)
  
"BLD",130,1,5,0)
1.  [CML-0296-N1840 and LIT-0496-71332 ]  Server tasks were retained for
"BLD",130,1,6,0)
30 days in ^ZTSK, and several sites complained that this was too long and
"BLD",130,1,7,0)
therefore a waste of disk space.  The default task retention time was
"BLD",130,1,8,0)
lowered to 14 days, and a field was added to the Option File (ZTSK
"BLD",130,1,9,0)
RETENTION DAYS) to allow the site to set the retention time for each
"BLD",130,1,10,0)
server on the system from 1 to 365 days.
"BLD",130,1,11,0)
  
"BLD",130,1,12,0)
2.  [MCM-1096-51188]  A site complained that the edit template XUEDITOPT
"BLD",130,1,13,0)
did not allow them to edit the field SERVER DEVICE when working with a
"BLD",130,1,14,0)
server-type option.  This was corrected when the new field was added to
"BLD",130,1,15,0)
the template.
"BLD",130,1,16,0)
 
"BLD",130,1,17,0)
3.  [SLC-1096-50407]  Under certain circumstances, servers that were
"BLD",130,1,18,0)
designated as in the SERVER ACTION field were not running at all but being
"BLD",130,1,19,0)
queued because of a logic error.
"BLD",130,1,20,0)
 
"BLD",130,1,21,0)
=========================================================================
"BLD",130,1,22,0)
INSTALLATION: 
"BLD",130,1,23,0)
   1.  These routines are not usually mapped on systems that allow
"BLD",130,1,24,0)
       it so you will probably not have to disable mapping.
"BLD",130,1,25,0)
   2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
"BLD",130,1,26,0)
       option will load the KIDS package onto your system.  
"BLD",130,1,27,0)
   3.  The patch has now been loaded into a Transport global on your 
"BLD",130,1,28,0)
       system. You now need to use KIDS to install the Transport global.  
"BLD",130,1,29,0)
   4.  On the KIDS menu, under the 'Installation' menu, use the following 
"BLD",130,1,30,0)
       options: 
"BLD",130,1,31,0)
          Print Transport Global 
"BLD",130,1,32,0)
          Compare Transport Global to Current System 
"BLD",130,1,33,0)
          Verify Checksums in Transport Global 
"BLD",130,1,34,0)
          Backup a Transport Global
"BLD",130,1,35,0)
          Install Package(s) 
"BLD",130,1,36,0)
   5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to 
"BLD",130,1,37,0)
       other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",130,1,38,0)
   6.  Rebuild your mapped set if necessary.
"BLD",130,1,39,0)
========================================================================
"BLD",130,1,40,0)
 
"BLD",130,1,41,0)
 
"BLD",130,1,42,0)
                        CHECKSUMS WITH PATCH LISTS
"BLD",130,1,43,0)
 
"BLD",130,1,44,0)
Program                Before              After
"BLD",130,1,45,0)
 
"BLD",130,1,46,0)
XQSRV1               8538091 No patches    8877273 **50**38091
"BLD",130,4,0)
^9.64PA^19^1
"BLD",130,4,19,0)
19
"BLD",130,4,19,2,0)
^9.641^19^1
"BLD",130,4,19,2,19,0)
OPTION  (File-top level)
"BLD",130,4,19,2,19,1,0)
^9.6411^228^1
"BLD",130,4,19,2,19,1,228,0)
ZTSK RETENTION DAYS
"BLD",130,4,19,222)
y^y^p^^^^n
"BLD",130,4,"APDD",19,19)
 
"BLD",130,4,"APDD",19,19,228)
 
"BLD",130,4,"B",19,19)
 
"BLD",130,"KRN",0)
^9.67PA^19^18
"BLD",130,"KRN",.4,0)
.4
"BLD",130,"KRN",.4,"NM",0)
^9.68A^^
"BLD",130,"KRN",.401,0)
.401
"BLD",130,"KRN",.402,0)
.402
"BLD",130,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",130,"KRN",.402,"NM",1,0)
XUEDITOPT    FILE #19^19^0
"BLD",130,"KRN",.402,"NM","B","XUEDITOPT    FILE #19",1)
 
"BLD",130,"KRN",.403,0)
.403
"BLD",130,"KRN",.5,0)
.5
"BLD",130,"KRN",.84,0)
.84
"BLD",130,"KRN",3.6,0)
3.6
"BLD",130,"KRN",3.8,0)
3.8
"BLD",130,"KRN",9.2,0)
9.2
"BLD",130,"KRN",9.8,0)
9.8
"BLD",130,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",130,"KRN",9.8,"NM",1,0)
XQSRV1^^0^B14130518
"BLD",130,"KRN",9.8,"NM","B","XQSRV1",1)
 
"BLD",130,"KRN",19,0)
19
"BLD",130,"KRN",19.1,0)
19.1
"BLD",130,"KRN",101,0)
101
"BLD",130,"KRN",409.61,0)
409.61
"BLD",130,"KRN",771,0)
771
"BLD",130,"KRN",869.2,0)
869.2
"BLD",130,"KRN",870,0)
870
"BLD",130,"KRN",8994,0)
8994
"BLD",130,"KRN","B",.4,.4)
 
"BLD",130,"KRN","B",.401,.401)
 
"BLD",130,"KRN","B",.402,.402)
 
"BLD",130,"KRN","B",.403,.403)
 
"BLD",130,"KRN","B",.5,.5)
 
"BLD",130,"KRN","B",.84,.84)
 
"BLD",130,"KRN","B",3.6,3.6)
 
"BLD",130,"KRN","B",3.8,3.8)
 
"BLD",130,"KRN","B",9.2,9.2)
 
"BLD",130,"KRN","B",9.8,9.8)
 
"BLD",130,"KRN","B",19,19)
 
"BLD",130,"KRN","B",19.1,19.1)
 
"BLD",130,"KRN","B",101,101)
 
"BLD",130,"KRN","B",409.61,409.61)
 
"BLD",130,"KRN","B",771,771)
 
"BLD",130,"KRN","B",869.2,869.2)
 
"BLD",130,"KRN","B",870,870)
 
"BLD",130,"KRN","B",8994,8994)
 
"BLD",130,"QUES",0)
^9.62^^
"BLD",130,"REQB",0)
^9.611^^
"FIA",19)
OPTION
"FIA",19,0)
^DIC(19,
"FIA",19,0,0)
19I
"FIA",19,0,1)
y^y^p^^^^n
"FIA",19,0,10)
 
"FIA",19,0,11)
 
"FIA",19,0,"RLRO")
 
"FIA",19,19)
1
"FIA",19,19,228)
 
"KRN",.402,90,-1)
0^1
"KRN",.402,90,0)
XUEDITOPT^2951122.11^#^19^^#^2961015
"KRN",.402,90,"DIAB",1,1,19.01,0)
ALL
"KRN",.402,90,"DIAB",1,1,19.391,0)
ALL
"KRN",.402,90,"DR",1,19)
.01;Q;1;12//^S X=$S($D(XQPK):XQPK,1:"");K XQPK;2:3.5;4;S XQTYP=X;D CLEAR^XQ5;S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@5";26;20;15;@5;S Y=$S($D(XQTYP):"@"_$A(XQTYP),1:"@3");@77;10;S Y="@3";@69;D DIE^XQ5;
"KRN",.402,90,"DR",1,19,1)
S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";30;36;31;50;51;53;32;33;34;35;S Y="@3";@80;D DIP^XQ5;S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";60;62;63;64;65;66;69;71;67;61;68;72;73;77;78;S Y="@3";@73;D DIQ^XQ5;
"KRN",.402,90,"DR",1,19,2)
S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";30;36;31;80;63;82;32;33;34;35;S Y="@3";@76;@79;@81;@88;10;S Y="@3";@82;25;S Y="@3";@83;R !,"Do you want help with servers? [Y/N] N// ",XQUR S:XQUR="" XQUR="N";
"KRN",.402,90,"DR",1,19,3)
I "Yy"[XQUR S XQH="XUDOC SERVERS" D EN^XQH K Y;25;220:228;3.6:3.8;3.91;S Y="@999";@67;30;36;31;40:44;32;33;34;35;S Y="@3";@87;24;25;300;301;S Y="@3";@90;24;25;300;301;10;@65;@3;3.6;3.7;3.8;3.91;3.92;3.95;3.96;@999;
"KRN",.402,90,"DR",1,19,4)
K XQH,XQPK,XQTYP,XQUR;
"KRN",.402,90,"DR",2,19.01)
.01:3
"KRN",.402,90,"DR",2,19.06)
.01
"KRN",.402,90,"DR",2,19.391)
.01:.02
"KRN",.402,90,"DR",2,19.392)
.01:.02;
"KRN",.402,90,"DR",2,19.396)
.01;
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQSRV1")
0^1^B14130518
"RTN","XQSRV1",1,0)
XQSRV1 ;SEA/MJM - Server option utilities ;10/15/96  13:14
"RTN","XQSRV1",2,0)
 ;;8.0;KERNEL;**50**;Jul 10, 1995
"RTN","XQSRV1",3,0)
 ;
"RTN","XQSRV1",4,0)
 ;File the message in POSTMASTER'S mailbox of option's name
"RTN","XQSRV1",5,0)
 S XQSRV=$P(XQ220,U,7) S:XQSRV="" XQSRV=1
"RTN","XQSRV1",6,0)
 I XQSRV S XMXX="S."_XQSOP,XMZ=XQMSG D SETSB^XMA1C
"RTN","XQSRV1",7,0)
 ;
"RTN","XQSRV1",8,0)
 ;Check for a resource
"RTN","XQSRV1",9,0)
 S XQRES=$P(XQ220,U,8) I XQRES'="",($D(^%ZIS(1,XQRES,0))) S XQRES=$P(^(0),U)
"RTN","XQSRV1",10,0)
 E  S XQRES=""
"RTN","XQSRV1",11,0)
 ;
"RTN","XQSRV1",12,0)
 I $D(XMFROM),XMFROM=+XMFROM,$D(^VA(200,+XMFROM,0)) S XMFROM=$P(^(0),U)
"RTN","XQSRV1",13,0)
 I XQSUB["~U~" F XQI=0:0 Q:XQSUB'["~U~"  S XQSUB=$P(XQSUB,"~U~")_"^"_$P(XQSUB,"~U~",2,99)
"RTN","XQSRV1",14,0)
 ;
"RTN","XQSRV1",15,0)
TASK ;Set up task parameters and call Taskman
"RTN","XQSRV1",16,0)
 S XQRTN="" S:$D(^DIC(19,+XQY,25)) XQRTN=^(25) S:XQRTN'["^" XQRTN="^"_XQRTN
"RTN","XQSRV1",17,0)
 ;I XQMD="R"&'($D(^DIC(19,XQY,3.91,0))&($P(^(0),U,4)>0)) S X=$P(XQY0,U,8) X:$L(X) ^%ZOSF("PRIORITY") G ZTSK^XQSRV2 ;Just go do it!
"RTN","XQSRV1",18,0)
 I XQMD="R"&'($P($G(^DIC(19,XQY,3.91,0)),U,4)>0) S X=$P(XQY0,U,8) X:$L(X) ^%ZOSF("PRIORITY") G ZTSK^XQSRV2
"RTN","XQSRV1",19,0)
 I XQMD="R" S XQMD="Q" ;Must be queued if days/times are restricted
"RTN","XQSRV1",20,0)
 ;
"RTN","XQSRV1",21,0)
 S ZTPRI=$P(XQY0,U,8),ZTRTN="ZTSK^XQSRV2",ZTDESC="Server Request: "_$P(XQY0,U,2)_" Message #: "_XQMSG,ZTIO=XQRES
"RTN","XQSRV1",22,0)
 S XQDAYS=$P(XQ220,U,9) S:(XQDAYS'>0) XQDAYS=14 S ZTKIL=$P($H,",")+XQDAYS_",00000" ;Retention time to save task in ZTSK
"RTN","XQSRV1",23,0)
 S ZTSAVE("XQY")="",ZTSAVE("XQY0")="",ZTSAVE("XQ220")="",ZTSAVE("XQLTL")="",ZTSAVE("XQAUDIT")="",ZTSAVE("XQREPLY")="",ZTSAVE("XQSUP")="",ZTSAVE("XQNOUSR")=""
"RTN","XQSRV1",24,0)
 S ZTSAVE("XQMSG")="",ZTSAVE("XQSUB")="",ZTSAVE("XQSND")="",ZTSAVE("XQRTN")="",ZTSAVE("XQSOP")="",ZTSAVE("XQMD")="",ZTSAVE("XQDATE")="",ZTSAVE("XQMB6")="",ZTSAVE("XQMB")=""
"RTN","XQSRV1",25,0)
 S ZTSAVE("XMREC")="",ZTSAVE("XMFROM")="",ZTSAVE("XMCHAN")="",ZTSAVE("XMXX")="",ZTSAVE("XMZ")=""
"RTN","XQSRV1",26,0)
 ;
"RTN","XQSRV1",27,0)
 I XQMD="N" S ZTDTH=$H+2_",0" D ^%ZTLOAD,XQ^XUTMT S XQMB6="Server request for "_XQSOP_".  Task # "_ZTSK_" needs to be scheduled." G OUT
"RTN","XQSRV1",28,0)
 I XQMD="Q" S X=XQLTL D
"RTN","XQSRV1",29,0)
 .N Y S Y=+XQY D NEXT^XQ92 S XQX=X
"RTN","XQSRV1",30,0)
 .I XQX="" S XQER="Scheduling Error: All days and times for the option "_XQSOP_" are prohibited."
"RTN","XQSRV1",31,0)
 .I XQX'="" S (ZTDTH,XQDTH)=X D ^%ZTLOAD S XQMB6="Server request queued for "_XQDTH_" task # "_ZTSK
"RTN","XQSRV1",32,0)
 G:(XQX'="") KILL^XQSRV2
"RTN","XQSRV1",33,0)
 ;
"RTN","XQSRV1",34,0)
OUT ;Trigger the bulletin, do the audit, and split.
"RTN","XQSRV1",35,0)
 D:XQAUDIT AUDIT,AUDIT^XQSRV2
"RTN","XQSRV1",36,0)
 G OUT^XQSRV2
"RTN","XQSRV1",37,0)
 Q
"RTN","XQSRV1",38,0)
 ;
"RTN","XQSRV1",39,0)
AUDIT ;Enter the option audit data in Audit Log for Option File
"RTN","XQSRV1",40,0)
 D GETENV^%ZOSV S XQVOL=$P(Y,U,2)
"RTN","XQSRV1",41,0)
 F XQI=0:0 S XQLTL=XQLTL+.0000001 I '$D(^XUSEC(19,XQLTL,0))#2 L +^XUSEC(19,0) S $P(^(0),U,3,4)=XQLTL_"^"_($P(^XUSEC(19,0),U,4)+1) L -^XUSEC(19,0)  Q
"RTN","XQSRV1",42,0)
 S ^XUSEC(19,XQLTL,0)=XQY_U_DUZ_U_$I_U_$J_U_U_XQVOL
"RTN","XQSRV1",43,0)
 S ^XUSEC(19,XQLTL,1)=XQMSG_U_XMFROM
"RTN","XQSRV1",44,0)
 S ^XUSEC(19,XQLTL,2)=XQSUB
"RTN","XQSRV1",45,0)
 Q
"RTN","XQSRV1",46,0)
 ;
"RTN","XQSRV1",47,0)
REQUE ; Requeue a server option not previously queued due to some problem
"RTN","XQSRV1",48,0)
 R !,"Message Number of Server message: ",XQMSG:DTIME Q:'$T!(XQMSG="")!(XQMSG[U)!(XQMSG'>0)
"RTN","XQSRV1",49,0)
 I '$D(^XMB(3.9,XQMSG)) W !,$C(7),"Invalid MESSAGE NUMBER",! G REQUE
"RTN","XQSRV1",50,0)
 F I=0:0 S I=$O(^XMB(3.9,XQMSG,1,I)) Q:I'>0  S XQ=^(I,0) I "S.s."[$E(XQ,1,2) S XQ=$P(XQ,U,1) Q
"RTN","XQSRV1",51,0)
 I "S.s."'[$E(XQ,1,2) W !,$C(7),"MESSAGE is NOT a SERVER MESSAGE",! G REQUE
"RTN","XQSRV1",52,0)
 S %DT="AET",%DT("A")="Date/time to run server program: ",%DT("B")="NOW" D ^%DT I Y>0 S ZTDTH=Y
"RTN","XQSRV1",53,0)
 S X=$E(XQ,3,$L(XQ))_U_XQMSG S I=$P(^XMB(3.9,XQMSG,0),U,2),X=X_U_$S(I'>0:I,'$D(^VA(200,+I,0)):"UNKNOWN",1:$P(^(0),U,1))_U_$P(^XMB(3.9,XQMSG,0),U,1)
"RTN","XQSRV1",54,0)
 G ^XQSRV
"VER")
8.0^21.0
"^DD",19,19,228,0)
ZTSK RETENTION DAYS^NJ3,0^^220;9^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",19,19,228,3)
Number of days (1 to 365) task will be retained in ^ZTSK (default = 14 days).
"^DD",19,19,228,21,0)
^^5^5^2961015^^^
"^DD",19,19,228,21,1,0)
This is a number between 1 and 365 to incicate the number of days that a 
"^DD",19,19,228,21,2,0)
server task should be retained by Task Manager in ^ZTSK.  The default
"^DD",19,19,228,21,3,0)
is 14 days if nothing is entered in this field.  For long-term retention
"^DD",19,19,228,21,4,0)
see field 226 which allows you to save the server message in a Postmaster
"^DD",19,19,228,21,5,0)
mailbox.
"^DD",19,19,228,"DT")
2961015
**END**
**END**
