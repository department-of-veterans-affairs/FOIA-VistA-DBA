Released PSO*7*265 SEQ #234
Extracted from mail message
**KIDS**:PSO*7.0*265^

**INSTALL NAME**
PSO*7.0*265
"BLD",7236,0)
PSO*7.0*265^OUTPATIENT PHARMACY^0^3070222^y
"BLD",7236,1,0)
^^5^5^3070222^
"BLD",7236,1,1,0)
PSI-07-029 patch fix
"BLD",7236,1,2,0)
 
"BLD",7236,1,3,0)
Corrects undefined filing errors for NON-VA Meds when an embedded
"BLD",7236,1,4,0)
semi-colon is entered in either the Dosag field or the Schedule field in
"BLD",7236,1,5,0)
CPRS as free form text.
"BLD",7236,4,0)
^9.64PA^^
"BLD",7236,6.3)
1
"BLD",7236,"KRN",0)
^9.67PA^8989.52^19
"BLD",7236,"KRN",.4,0)
.4
"BLD",7236,"KRN",.401,0)
.401
"BLD",7236,"KRN",.402,0)
.402
"BLD",7236,"KRN",.403,0)
.403
"BLD",7236,"KRN",.5,0)
.5
"BLD",7236,"KRN",.84,0)
.84
"BLD",7236,"KRN",3.6,0)
3.6
"BLD",7236,"KRN",3.8,0)
3.8
"BLD",7236,"KRN",9.2,0)
9.2
"BLD",7236,"KRN",9.8,0)
9.8
"BLD",7236,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7236,"KRN",9.8,"NM",1,0)
PSONVNEW^^0^B27192017
"BLD",7236,"KRN",9.8,"NM","B","PSONVNEW",1)

"BLD",7236,"KRN",19,0)
19
"BLD",7236,"KRN",19.1,0)
19.1
"BLD",7236,"KRN",101,0)
101
"BLD",7236,"KRN",409.61,0)
409.61
"BLD",7236,"KRN",771,0)
771
"BLD",7236,"KRN",870,0)
870
"BLD",7236,"KRN",8989.51,0)
8989.51
"BLD",7236,"KRN",8989.52,0)
8989.52
"BLD",7236,"KRN",8994,0)
8994
"BLD",7236,"KRN","B",.4,.4)

"BLD",7236,"KRN","B",.401,.401)

"BLD",7236,"KRN","B",.402,.402)

"BLD",7236,"KRN","B",.403,.403)

"BLD",7236,"KRN","B",.5,.5)

"BLD",7236,"KRN","B",.84,.84)

"BLD",7236,"KRN","B",3.6,3.6)

"BLD",7236,"KRN","B",3.8,3.8)

"BLD",7236,"KRN","B",9.2,9.2)

"BLD",7236,"KRN","B",9.8,9.8)

"BLD",7236,"KRN","B",19,19)

"BLD",7236,"KRN","B",19.1,19.1)

"BLD",7236,"KRN","B",101,101)

"BLD",7236,"KRN","B",409.61,409.61)

"BLD",7236,"KRN","B",771,771)

"BLD",7236,"KRN","B",870,870)

"BLD",7236,"KRN","B",8989.51,8989.51)

"BLD",7236,"KRN","B",8989.52,8989.52)

"BLD",7236,"KRN","B",8994,8994)

"BLD",7236,"QUES",0)
^9.62^^
"BLD",7236,"REQB",0)
^9.611^1^1
"BLD",7236,"REQB",1,0)
PSO*7.0*203^2
"BLD",7236,"REQB","B","PSO*7.0*203",1)

"MBREQ")
0
"PKG",134,-1)
1^1
"PKG",134,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",134,20,0)
^9.402P^^
"PKG",134,22,0)
^9.49I^1^1
"PKG",134,22,1,0)
7.0^2971216^2980417^1271
"PKG",134,22,1,"PAH",1,0)
265^3070222
"PKG",134,22,1,"PAH",1,1,0)
^^5^5^3070222
"PKG",134,22,1,"PAH",1,1,1,0)
PSI-07-029 patch fix
"PKG",134,22,1,"PAH",1,1,2,0)
 
"PKG",134,22,1,"PAH",1,1,3,0)
Corrects undefined filing errors for NON-VA Meds when an embedded
"PKG",134,22,1,"PAH",1,1,4,0)
semi-colon is entered in either the Dosag field or the Schedule field in
"PKG",134,22,1,"PAH",1,1,5,0)
CPRS as free form text.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSONVNEW")
0^1^B27192017^B26278040
"RTN","PSONVNEW",1,0)
PSONVNEW ;BIR/SAB - Add Non-VA Med orders ;2/13/07 11:35am
"RTN","PSONVNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132,118,203,265**;DEC 1997;Build 1
"RTN","PSONVNEW",3,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSONVNEW",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSONVNEW",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSONVNEW",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSONVNEW",7,0)
 ;adds new non-va med to #55
"RTN","PSONVNEW",8,0)
 ;
"RTN","PSONVNEW",9,0)
 ;*203 change 3 fields from "///" to "////" they can be larger than
"RTN","PSONVNEW",10,0)
 ;      defined and need to be put in as is to prevent hard crash.
"RTN","PSONVNEW",11,0)
 ;*265 change update of Dosage & Sched fields DR strings, can contain ;      free form char ";"
"RTN","PSONVNEW",12,0)
 ;
"RTN","PSONVNEW",13,0)
 I '$D(^PS(55,DFN,0)) D
"RTN","PSONVNEW",14,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=DFN,DIC("DR")="52.1////2" D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSONVNEW",15,0)
 ..S $P(^PS(55,DFN,0),"^")=DFN,$P(^(0),"^",6)=2
"RTN","PSONVNEW",16,0)
 ..K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSONVNEW",17,0)
 ;
"RTN","PSONVNEW",18,0)
 N PSONVA,DSC K PCOM
"RTN","PSONVNEW",19,0)
 F I=0:0 S I=$O(MSG(I)) Q:'I  D
"RTN","PSONVNEW",20,0)
 .I $P(MSG(I),"|")="NTE",$P(MSG(I),"|",2)=6 S DSC=$G(DSC)+1 S PCOM(DSC)=$P(MSG(I),"|",4) F T=0:0 S T=$O(MSG(I,T)) Q:'T  S DSC=DSC+1,PCOM(DSC)=MSG(I,T)
"RTN","PSONVNEW",21,0)
 .I $P(MSG(I),"|")="ORC" S STDT=$P(MSG(I),"|",8),STRDT=$$HL7TFM^XLFDT($P(STDT,"^",4))
"RTN","PSONVNEW",22,0)
 ;
"RTN","PSONVNEW",23,0)
 ; - Files the Non-VA Med order into the "NVA" multiple in File #55
"RTN","PSONVNEW",24,0)
 K DR,DIC,DD,DA,DO,DINUM S DA(1)=DFN,X=PSORDITE
"RTN","PSONVNEW",25,0)
 ;*203,*265 fix DR & dose & sched fields
"RTN","PSONVNEW",26,0)
 S PSODOS=$G(PSOLQ1I(1)),PSOSCH=$$SCHED($P($G(QTARRAY(1)),"^"))
"RTN","PSONVNEW",27,0)
 S DR="1////"_PSODDRUG_";2////^S X=PSODOS;3////"_$$ROUTE($G(ROUTE(1)))
"RTN","PSONVNEW",28,0)
 S DR=DR_";4////^S X=PSOSCH;7////"_$G(PLACER)_";8///"_$G(STRDT)
"RTN","PSONVNEW",29,0)
 S DR=DR_";11///"_$G(PSOLOG)_";12////"_$G(ENTERED)_";13////"_$G(LOCATION)
"RTN","PSONVNEW",30,0)
 S DIC("DR")=DR,DIC(0)="L",DIC="^PS(55,"_DFN_",""NVA"",",DLAYGO=55.05
"RTN","PSONVNEW",31,0)
 D FILE^DICN S PSONVA=+Y K DR,DIC,DD,DA,DO,DINUM
"RTN","PSONVNEW",32,0)
 K PSODOS,PSOSCH
"RTN","PSONVNEW",33,0)
 ;
"RTN","PSONVNEW",34,0)
 K DSC,STDT
"RTN","PSONVNEW",35,0)
 I $P(PSODSC,"^",2)]"" D
"RTN","PSONVNEW",36,0)
 .S DSC=1,^PS(55,DFN,"NVA",PSONVA,"DSC",1,0)=$P(PSODSC,"^",2)
"RTN","PSONVNEW",37,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^1^1^"_DT_"^^^^"
"RTN","PSONVNEW",38,0)
 I $O(PSODSC(0)) D
"RTN","PSONVNEW",39,0)
 .F T=0:0 S T=$O(PSODSC(T)) Q:'T  S DSC=$G(DSC)+1,^PS(55,DFN,"NVA",PSONVA,"DSC",DSC,0)=PSODSC(T)
"RTN","PSONVNEW",40,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^"_DSC_"^"_DSC_"^"_DT_"^^^^"
"RTN","PSONVNEW",41,0)
 I $O(PCOM(0)) F T=0:0 S T=$O(PCOM(T)) Q:'T  D
"RTN","PSONVNEW",42,0)
 .S DSC=$G(DSC)+1,^PS(55,DFN,"NVA",PSONVA,"DSC",DSC,0)=PCOM(T)
"RTN","PSONVNEW",43,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^"_DSC_"^"_DSC_"^"_DT_"^^^^"
"RTN","PSONVNEW",44,0)
 .S ^PS(55,DFN,"NVA",PSONVA,1,T,0)=PCOM(T)
"RTN","PSONVNEW",45,0)
 .S ^PS(55,DFN,"NVA",PSONVA,1,0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSONVNEW",46,0)
 I $G(OCOUNT) S ^PS(55,DFN,"NVA",PSONVA,"OCK",0)="^55.051^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSONVNEW",47,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"OCK",OCOUNT,0)=$G(OBXAR(OCOUNT,1))_"^"_PROV
"RTN","PSONVNEW",48,0)
 .I $G(OBXAR(OCOUNT,1))]"" S ^PS(55,DFN,"NVA",PSONVA,"OCK","B",$E(OBXAR(OCOUNT,1),1,30),OCOUNT)=""
"RTN","PSONVNEW",49,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(55,DFN,"NVA",PSONVA,"OCK",OCOUNT,"OVR",1,0)=OBXAR(OCOUNT,LLL)
"RTN","PSONVNEW",50,0)
 K HOLD,SCH,SCHED,SDL,SGL,A,W,WW,CHR,STRDT
"RTN","PSONVNEW",51,0)
 ;
"RTN","PSONVNEW",52,0)
 M PMSG=MSG
"RTN","PSONVNEW",53,0)
REIN K MSG S NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSONVNEW",54,0)
 K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^")
"RTN","PSONVNEW",55,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSONVNEW",56,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||ORR"
"RTN","PSONVNEW",57,0)
 ;
"RTN","PSONVNEW",58,0)
 S COUNT=1,LIMIT=5 X NULLFLDS D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSONVNEW",59,0)
 S FIELD(0)="PID",FIELD(3)=DFN,FIELD(5)=NAME
"RTN","PSONVNEW",60,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",61,0)
 ;
"RTN","PSONVNEW",62,0)
 ;
"RTN","PSONVNEW",63,0)
 S LIMIT=19 X NULLFLDS
"RTN","PSONVNEW",64,0)
 S FIELD(0)="PV1",FIELD(2)="O",FIELD(3)=LOCATION
"RTN","PSONVNEW",65,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",66,0)
 ;
"RTN","PSONVNEW",67,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSONVNEW",68,0)
 S FIELD(0)="ORC",FIELD(1)=$S($G(REIN):"SC",1:"OK"),FIELD(2)=PLACER_"^OR",FIELD(3)=PSONVA_"N^PS",FIELD(5)="CM"
"RTN","PSONVNEW",69,0)
 S FIELD(10)=$P(^PS(55,DFN,"NVA",PSONVA,0),"^",11)_"^"_$P(^VA(200,$P(^PS(55,DFN,"NVA",PSONVA,0),"^",11),0),"^")
"RTN","PSONVNEW",70,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",71,0)
 I $G(REIN) S MSG(COUNT)=MSG(COUNT)_"|^^^^DATE OF DEATH DELETED BY MAS.^"
"RTN","PSONVNEW",72,0)
 ;
"RTN","PSONVNEW",73,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSONVNEW",74,0)
 S FIELD(0)="RXO",OI=$P(^PS(55,DFN,"NVA",PSONVA,0),"^")
"RTN","PSONVNEW",75,0)
 S FIELD(1)="^^^"_OI_"^"_$P($G(^PS(50.7,OI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP"
"RTN","PSONVNEW",76,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",77,0)
 ;
"RTN","PSONVNEW",78,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSONVNEW",79,0)
 S FIELD(0)="RXE"
"RTN","PSONVNEW",80,0)
 S PSOPSTRT="",X=$P(^PS(55,DFN,"NVA",PSONVA,0),"^",9) I X S PSOPSTRT=$$FMTHL7^XLFDT(X)
"RTN","PSONVNEW",81,0)
 K X S FIELD(1)="^^^"_$G(PSOPSTRT)_"^"
"RTN","PSONVNEW",82,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",83,0)
 ;
"RTN","PSONVNEW",84,0)
 D SEND^PSOHLSN1 K FIELDS,LIMIT,PSODSC,PSONVA,OI Q:$G(REIN)
"RTN","PSONVNEW",85,0)
 ;dc change order
"RTN","PSONVNEW",86,0)
DC F OO=0:0 S OO=$O(PMSG(OO)) Q:'OO  I $P(PMSG(OO),"|")="ORC",$P(PMSG(OO),"|",2)="XO" D  Q
"RTN","PSONVNEW",87,0)
 .F XO=0:0 S XO=$O(PMSG(XO)) Q:'XO  I $P(PMSG(XO),"|")="ZRX" S POERR("PSOFILNM")=$P(PMSG(XO),"|",2) Q
"RTN","PSONVNEW",88,0)
 I +$G(POERR("PSOFILNM")),$G(^PS(55,DFN,"NVA",+$G(POERR("PSOFILNM")),0)) S PDFN=DFN D XO^PSOORUTL
"RTN","PSONVNEW",89,0)
 K XO,OO,PMSG
"RTN","PSONVNEW",90,0)
 Q
"RTN","PSONVNEW",91,0)
SCHED(SCH) ; Returns the SCHEDULE description
"RTN","PSONVNEW",92,0)
 N SCHED,CNT,FND,A,I,K,HOLD
"RTN","PSONVNEW",93,0)
 S SCHED="" Q:$G(SCH)="" SCHED
"RTN","PSONVNEW",94,0)
 ;
"RTN","PSONVNEW",95,0)
 F A=0:0 S A=$O(^PS(51.1,"B",SCH,A)) Q:'A  D  I SCHED'="" Q
"RTN","PSONVNEW",96,0)
 . S:$P($G(^PS(51.1,A,0)),"^",8)'="" SCHED=$P($G(^(0)),"^",8)
"RTN","PSONVNEW",97,0)
 I SCHED'="" G QSCH
"RTN","PSONVNEW",98,0)
 ;
"RTN","PSONVNEW",99,0)
 I $G(^PS(51,"A",SCH))'="" S SCHED=$P(^PS(51,"A",SCH),"^") G QSCH
"RTN","PSONVNEW",100,0)
 ;
"RTN","PSONVNEW",101,0)
 S CNT=$L(SCH," "),FND=0
"RTN","PSONVNEW",102,0)
 F I=1:1:CNT S (WORD,HOLD(I))=$P(SCH," ",I) D
"RTN","PSONVNEW",103,0)
 . I WORD="" Q
"RTN","PSONVNEW",104,0)
 . F K=0:0 S K=$O(^PS(51.1,"B",WORD,K)) Q:'K  D  I FND Q
"RTN","PSONVNEW",105,0)
 . . I $P($G(^PS(51.1,K,0)),"^",8)'="" D
"RTN","PSONVNEW",106,0)
 . . . S HOLD(I)=$P($G(^PS(51.1,K,0)),"^",8),FND=1
"RTN","PSONVNEW",107,0)
 . I $G(^PS(51,"A",WORD))]"" S HOLD(I)=$P(^(WORD),"^")
"RTN","PSONVNEW",108,0)
 S FND=0 F K=1:1:CNT S SCHED=SCHED_$S($G(FND):" ",1:"")_$G(HOLD(K)),FND=1
"RTN","PSONVNEW",109,0)
 ;
"RTN","PSONVNEW",110,0)
QSCH Q SCHED
"RTN","PSONVNEW",111,0)
 ;
"RTN","PSONVNEW",112,0)
ROUTE(RTIEN) ; Returns the ROUTE description
"RTN","PSONVNEW",113,0)
 N X
"RTN","PSONVNEW",114,0)
 Q:'$G(RTIEN) "" S X=$G(^PS(51.2,RTIEN,0))
"RTN","PSONVNEW",115,0)
 Q $S($P(X,"^",2)'="":$P(X,"^",2),1:$P(X,"^"))
"RTN","PSONVNEW",116,0)
 ;
"RTN","PSONVNEW",117,0)
APSOD ;dc non-va meds because of date of death entry called from psocan3
"RTN","PSONVNEW",118,0)
 N PDA,PDFN ;,POERR("PSOFILNM")
"RTN","PSONVNEW",119,0)
 F PDA=0:0 S PDA=$O(^PS(55,PSODFN,"NVA",PDA)) Q:'PDA  I '$P(^PS(55,PSODFN,"NVA",PDA,0),"^",6),'$P(^(0),"^",7) D
"RTN","PSONVNEW",120,0)
 .S POERR("PSOFILNM")=PDA,PDFN=PSODFN D XO^PSOORUTL
"RTN","PSONVNEW",121,0)
 Q
"VER")
8.0^22.0
"BLD",7236,6)
^234
**END**
**END**
