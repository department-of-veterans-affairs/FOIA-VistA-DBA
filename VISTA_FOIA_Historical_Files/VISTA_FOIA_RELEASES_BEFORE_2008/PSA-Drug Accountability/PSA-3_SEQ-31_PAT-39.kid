Released PSA*3*39 SEQ #31
Extracted from mail message
**KIDS**:PSA*3.0*39^

**INSTALL NAME**
PSA*3.0*39
"BLD",5356,0)
PSA*3.0*39^DRUG ACCOUNTABILITY^0^3040211^y
"BLD",5356,1,0)
^^4^4^3040211^
"BLD",5356,1,1,0)
This patch will modify PSA PROCESS PRIME VENDOR DATA  Process Uploaded 
"BLD",5356,1,2,0)
Prime Vendor Invoice Data to always prompt the user when there is a change
"BLD",5356,1,3,0)
in the Vendor Stock Number's NDC.  This is currently happening only if the
"BLD",5356,1,4,0)
current NDC is numeric.
"BLD",5356,4,0)
^9.64PA^^
"BLD",5356,"KRN",0)
^9.67PA^8989.52^19
"BLD",5356,"KRN",.4,0)
.4
"BLD",5356,"KRN",.401,0)
.401
"BLD",5356,"KRN",.402,0)
.402
"BLD",5356,"KRN",.403,0)
.403
"BLD",5356,"KRN",.5,0)
.5
"BLD",5356,"KRN",.84,0)
.84
"BLD",5356,"KRN",3.6,0)
3.6
"BLD",5356,"KRN",3.8,0)
3.8
"BLD",5356,"KRN",9.2,0)
9.2
"BLD",5356,"KRN",9.8,0)
9.8
"BLD",5356,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5356,"KRN",9.8,"NM",1,0)
PSAPROC9^^0^B64178109
"BLD",5356,"KRN",9.8,"NM","B","PSAPROC9",1)

"BLD",5356,"KRN",19,0)
19
"BLD",5356,"KRN",19.1,0)
19.1
"BLD",5356,"KRN",101,0)
101
"BLD",5356,"KRN",409.61,0)
409.61
"BLD",5356,"KRN",771,0)
771
"BLD",5356,"KRN",870,0)
870
"BLD",5356,"KRN",8989.51,0)
8989.51
"BLD",5356,"KRN",8989.52,0)
8989.52
"BLD",5356,"KRN",8994,0)
8994
"BLD",5356,"KRN","B",.4,.4)

"BLD",5356,"KRN","B",.401,.401)

"BLD",5356,"KRN","B",.402,.402)

"BLD",5356,"KRN","B",.403,.403)

"BLD",5356,"KRN","B",.5,.5)

"BLD",5356,"KRN","B",.84,.84)

"BLD",5356,"KRN","B",3.6,3.6)

"BLD",5356,"KRN","B",3.8,3.8)

"BLD",5356,"KRN","B",9.2,9.2)

"BLD",5356,"KRN","B",9.8,9.8)

"BLD",5356,"KRN","B",19,19)

"BLD",5356,"KRN","B",19.1,19.1)

"BLD",5356,"KRN","B",101,101)

"BLD",5356,"KRN","B",409.61,409.61)

"BLD",5356,"KRN","B",771,771)

"BLD",5356,"KRN","B",870,870)

"BLD",5356,"KRN","B",8989.51,8989.51)

"BLD",5356,"KRN","B",8989.52,8989.52)

"BLD",5356,"KRN","B",8994,8994)

"BLD",5356,"QUES",0)
^9.62^^
"BLD",5356,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",487,-1)
1^1
"PKG",487,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",487,20,0)
^9.402P^^
"PKG",487,22,0)
^9.49I^1^1
"PKG",487,22,1,0)
3.0^2971024^2981028^66481
"PKG",487,22,1,"PAH",1,0)
39^3040211
"PKG",487,22,1,"PAH",1,1,0)
^^4^4^3040211
"PKG",487,22,1,"PAH",1,1,1,0)
This patch will modify PSA PROCESS PRIME VENDOR DATA  Process Uploaded 
"PKG",487,22,1,"PAH",1,1,2,0)
Prime Vendor Invoice Data to always prompt the user when there is a change
"PKG",487,22,1,"PAH",1,1,3,0)
in the Vendor Stock Number's NDC.  This is currently happening only if the
"PKG",487,22,1,"PAH",1,1,4,0)
current NDC is numeric.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSAPROC9")
0^1^B64178109
"RTN","PSAPROC9",1,0)
PSAPROC9 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;8/19/97
"RTN","PSAPROC9",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**39**; 10/24/97
"RTN","PSAPROC9",3,0)
 ;This routine processes the line item when the user selects automatic
"RTN","PSAPROC9",4,0)
 ;processing.
"RTN","PSAPROC9",5,0)
 ;
"RTN","PSAPROC9",6,0)
 S (PSACONT,PSADU,PSANEXT)=0
"RTN","PSAPROC9",7,0)
 I '+$P(PSADATA,"^",6),PSANDC="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",8,0)
 .I +$P($P(PSADATA,"^",5),"~",2) D MANYVSNS^PSAPROC4 D:PSAOUT CONT Q
"RTN","PSAPROC9",9,0)
 .I PSAVSN="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",10,0)
 ..I +$P($P(PSADATA,"^",26),"~",2) D ^PSAPROC5 D:PSAOUT CONT Q
"RTN","PSAPROC9",11,0)
 ..I +$P($P(PSADATA,"^",26),"~",3) D SUPDIFF^PSAPROC5 D:PSAOUT CONT
"RTN","PSAPROC9",12,0)
 I '+$P(PSADATA,"^",6),'+$P(PSADATA,"^",15),PSANDC'="" D ^PSANDF D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",13,0)
 I PSANDC'="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",14,0)
 .I +$P($P(PSADATA,"^",4),"~",2) D MANYNDCS^PSAPROC4 D:PSAOUT CONT Q
"RTN","PSAPROC9",15,0)
 .I $P($P(PSADATA,"^",4),"~",3)'="" D VSNDIFF^PSAPROC5 D:PSAOUT CONT
"RTN","PSAPROC9",16,0)
 I +$P($P(PSADATA,"^",5),"~",2) D MANYVSNS^PSAPROC4 D:PSAOUT CONT Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",17,0)
 ;VMP OIFO BAY PINES;VGF;PSA*3.0*39
"RTN","PSAPROC9",18,0)
 I $P($P(PSADATA,"^",5),"~",3)]"" D NDCDIFF^PSAPROC5 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",19,0)
NEXT Q:PSACONT
"RTN","PSAPROC9",20,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",21,0)
 I '+$P(PSADATA,"^",6),'+$P(PSADATA,"^",15),'$D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")) D:'$G(PSAPASS) ASKDRUG^PSANDF D:PSAOUT CONT Q:PSAOUT  S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",22,0)
 Q:$G(PSAPASS)
"RTN","PSAPROC9",23,0)
 I $G(PSASUPP) S PSALINES=PSALINES+1 Q
"RTN","PSAPROC9",24,0)
 S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),1:+$P(PSADATA,"^",6))
"RTN","PSAPROC9",25,0)
 I PSAIEN S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)=$S($P($G(^PSDRUG(PSAIEN,2)),"^",3)["N":"CS",1:"")
"RTN","PSAPROC9",26,0)
 I PSAIEN,PSANDC'="" S PSASUB=0 F  S PSASUB=$O(^PSDRUG("C",PSANDC,PSAIEN,PSASUB)) Q:'PSASUB  I $P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^")=PSANDC Q
"RTN","PSAPROC9",27,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)=$S(+$G(PSASUB):PSASUB,1:"0~1")
"RTN","PSAPROC9",28,0)
QTY I '+PSADATA,$P(PSADATA,"^",8)="" D QTY^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",29,0)
OU I '+$P($P(PSADATA,"^",2),"~",2),'+$P(PSADATA,"^",12) D  D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",30,0)
 .I PSAIEN,PSASUB,'$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5) D GETOU^PSAPROC3 Q
"RTN","PSAPROC9",31,0)
 .I PSAIEN,'PSASUB D GETOU^PSAPROC3
"RTN","PSAPROC9",32,0)
DU I PSAIEN,$P($G(^PSDRUG(PSAIEN,660)),"^",8)="" D DU^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",33,0)
DUOU ;If drug has synonym & no conv factor set conv factor in 50.
"RTN","PSAPROC9",34,0)
 I PSAIEN,PSASUB,$D(^PSDRUG(PSAIEN,1,PSASUB,0)),'+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",7),'+$P(PSADATA,"^",20) D DUOU^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",35,0)
 ;If drug doesn't have synonym & disp units/order unit, store disp units/order unit in XTMP.
"RTN","PSAPROC9",36,0)
 I PSAIEN,'PSASUB,'+$P(PSADATA,"^",20) D DUOU^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",37,0)
PRICE I '+$P(PSADATA,"^",3) D PRICE^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",38,0)
NOTCS ;If drug is not a CS & no stock level/reorder level, store in XTMP.
"RTN","PSAPROC9",39,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",40,0)
 I $P(PSADATA,"^",19)'="CS" D  Q:PSAOUT
"RTN","PSAPROC9",41,0)
 .I '+$P(PSAIN,"^",7) D GETLOC D EDITDISP^PSAUTL1,END^PSAPROC D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",42,0)
 .I $P(PSADATA,"^",19)'="CS",+$P(PSAIN,"^",7),+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),0)),"^",14) D  Q:PSAOUT
"RTN","PSAPROC9",43,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",7) D STOCK^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",44,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",7) D REORDER^PSAPROC8 D:PSAOUT CONT
"RTN","PSAPROC9",45,0)
CS ;If drug is a CS & no stock level/reorder level, store in XTMP.
"RTN","PSAPROC9",46,0)
 I $P(PSADATA,"^",19)="CS" D  Q:PSAOUT
"RTN","PSAPROC9",47,0)
 .S PSACS=PSACS+1
"RTN","PSAPROC9",48,0)
 .I '+$P(PSAIN,"^",12) D MASTER D EDITDISP^PSAUTL1,END^PSAPROC D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",49,0)
 .I +$P(PSAIN,"^",12),+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),0)),"^",14) D  Q:PSAOUT
"RTN","PSAPROC9",50,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",12) D STOCK^PSAPROC8 S PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12) D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",51,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",12) D REORDER^PSAPROC8 S PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12) D:PSAOUT CONT
"RTN","PSAPROC9",52,0)
 D CHECK^PSANDF D:PSAOUT CONT Q:PSAOUT  D SETLINE^PSAPROC3 W !
"RTN","PSAPROC9",53,0)
 Q
"RTN","PSAPROC9",54,0)
 ;
"RTN","PSAPROC9",55,0)
CONT ;Asks if user wants to continue processing invoice.
"RTN","PSAPROC9",56,0)
 S PSAINV=$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",2)
"RTN","PSAPROC9",57,0)
 W ! S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to continue processing invoice# "_PSAINV,DIR("?")="Enter YES to process the next line item.",DIR("?")="Enter NO to stop processing the invoice.",DIR("??")="^D CONTYN^PSAPROC9"
"RTN","PSAPROC9",58,0)
 D ^DIR K DIR S PSACONT=Y Q:$G(DIRUT)!('Y)
"RTN","PSAPROC9",59,0)
 S PSAOUT=0
"RTN","PSAPROC9",60,0)
 Q
"RTN","PSAPROC9",61,0)
MASTER ;Assigns invoice to Master Vault
"RTN","PSAPROC9",62,0)
 S PSAINV=$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",2)
"RTN","PSAPROC9",63,0)
 S (PSAMVN,PSAMV)=0 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSAPROC9",64,0)
 .Q:'$D(^PSD(58.8,PSAMV,0))!($P($G(^PSD(58.8,PSAMV,0)),"^")="")
"RTN","PSAPROC9",65,0)
 .I +$G(^PSD(58.8,PSAMV,"I")),+^PSD(58.8,PSAMV,"I")'>DT Q
"RTN","PSAPROC9",66,0)
 .S PSAMVN=PSAMVN+1,PSAONEMV=PSAMV,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSAPROC9",67,0)
 I 'PSAMVN W !!,"No master vaults are set up. You must set up a master vault then",!,"select the Process Uploaded Prime Vendor Invoices Data option." S PSAOUT=1 Q
"RTN","PSAPROC9",68,0)
 I PSAMVN=1 D  Q
"RTN","PSAPROC9",69,0)
 .S PSAMV=PSAONEMV
"RTN","PSAPROC9",70,0)
 .W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>"
"RTN","PSAPROC9",71,0)
 .W !!,"Controlled substances on the invoice has been",!,"automatically assigned to the Master Vault."
"RTN","PSAPROC9",72,0)
 .W !!,$P(^PSD(58.8,PSAMV,0),"^"),!,PSASLN
"RTN","PSAPROC9",73,0)
 .W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC9",74,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAMV,PSAIN=^("IN")
"RTN","PSAPROC9",75,0)
 .D END^PSAPROC
"RTN","PSAPROC9",76,0)
 I PSAMVN>1 D DISPMV W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELMV
"RTN","PSAPROC9",77,0)
 Q
"RTN","PSAPROC9",78,0)
 ;
"RTN","PSAPROC9",79,0)
DISPMV ;Displays active master vaults
"RTN","PSAPROC9",80,0)
 W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>",!,PSASLN
"RTN","PSAPROC9",81,0)
 S PSA=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSAPROC9",82,0)
 .S PSAMVIEN=0 F  S PSAMVIEN=$O(PSAMV(PSAMVA,PSAMVIEN)) Q:'PSAMVIEN  D
"RTN","PSAPROC9",83,0)
 ..S PSA=PSA+1,PSAVAULT(PSA,PSAMVA,PSAMVIEN)=""
"RTN","PSAPROC9",84,0)
 ..W !,$J(PSA,2)_".",?4,PSAMVA
"RTN","PSAPROC9",85,0)
 W !
"RTN","PSAPROC9",86,0)
 Q
"RTN","PSAPROC9",87,0)
 ;
"RTN","PSAPROC9",88,0)
SELMV ;Select displayed master vaults
"RTN","PSAPROC9",89,0)
 W ! S DIR(0)="NO^1:"_PSA,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault that received the invoice's drugs"
"RTN","PSAPROC9",90,0)
 S DIR("??")="^D MV^PSAPROC" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC9",91,0)
 S PSASEL1=Y
"RTN","PSAPROC9",92,0)
 S PSAMVA=$O(PSAVAULT(PSASEL1,"")) Q:PSAMVA=""  S PSAMVIEN=+$O(PSAVAULT(PSASEL1,PSAMVA,0)) Q:'PSAMVIEN  S PSAMV=PSAMVIEN,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAMV,PSAIN=^("IN")
"RTN","PSAPROC9",93,0)
 Q
"RTN","PSAPROC9",94,0)
 ;
"RTN","PSAPROC9",95,0)
GETLOC ;Gets pharmacy locations
"RTN","PSAPROC9",96,0)
 S PSAINV=$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",2)
"RTN","PSAPROC9",97,0)
 S (PSALOC,PSANUM)=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC9",98,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAPROC9",99,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAPROC9",100,0)
 .S PSANUM=PSANUM+1,PSAONE=PSALOC,PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSAPROC9",101,0)
 .D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT
"RTN","PSAPROC9",102,0)
 G:'PSANUM NONE G:PSANUM=1 ONE G:PSANUM>1 MANY
"RTN","PSAPROC9",103,0)
 ;
"RTN","PSAPROC9",104,0)
NONE ;No DA pharmacy locations
"RTN","PSAPROC9",105,0)
 W !!,"There are no Drug Accountability pharmacy locations.",!!,"Use the Set Up/Edit a Pharmacy Location option on Pharmacy Location menu"
"RTN","PSAPROC9",106,0)
 W !,"to setup one or more pharmacy locations. Then select the Process Uploaded",!,"Prime Vendor Invoice Data option to process the invoices."
"RTN","PSAPROC9",107,0)
 Q
"RTN","PSAPROC9",108,0)
 ;
"RTN","PSAPROC9",109,0)
ONE ;Only one location
"RTN","PSAPROC9",110,0)
 S PSACNT=0,PSALOC=PSAONE,PSALOCN=$O(PSALOCA(""))
"RTN","PSAPROC9",111,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>"
"RTN","PSAPROC9",112,0)
 W !!,"The non-controlled substance items on the invoice have",!,"been automatically assigned to the Pharmacy Location.",!
"RTN","PSAPROC9",113,0)
 W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 PSALOCN W !,PSASLN
"RTN","PSAPROC9",114,0)
 W !!,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC9",115,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC,PSAIN=^("IN")
"RTN","PSAPROC9",116,0)
 Q
"RTN","PSAPROC9",117,0)
 ;
"RTN","PSAPROC9",118,0)
MANY ;If more than one pharmacy location, display invoices.
"RTN","PSAPROC9",119,0)
 D DISPLOC W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELLOC
"RTN","PSAPROC9",120,0)
 Q
"RTN","PSAPROC9",121,0)
 ;
"RTN","PSAPROC9",122,0)
DISPLOC ;Displays the active pharmacy locations.
"RTN","PSAPROC9",123,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>",!,PSASLN,!
"RTN","PSAPROC9",124,0)
 S PSACNT=0,PSALOCN="" F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAPROC9",125,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC9",126,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=PSALOC
"RTN","PSAPROC9",127,0)
 ..W !,$J(PSACNT,2)_"." W:$L(PSALOCN)>72 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<73 ?4,PSALOCN
"RTN","PSAPROC9",128,0)
 W !
"RTN","PSAPROC9",129,0)
 Q
"RTN","PSAPROC9",130,0)
 ;
"RTN","PSAPROC9",131,0)
SELLOC ;Select the Pharmacy Location to be assigned to the order.
"RTN","PSAPROC9",132,0)
 W ! K DIR S DIR(0)="NO^1:"_PSACNT,DIR("A")="Pharmacy Location",DIR("?")="Select the pharmacy location that received the invoice's drugs"
"RTN","PSAPROC9",133,0)
 S DIR("??")="^D LOCHELP^PSAVER5" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC9",134,0)
 S PSASEL1=Y
"RTN","PSAPROC9",135,0)
 S PSALOCN=$O(PSAMENU(PSASEL1,"")) Q:PSALOCN=""  S PSALOC=$O(PSAMENU(PSASEL1,PSALOCN,0)) Q:'PSALOC  S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC,PSAIN=^("IN")
"RTN","PSAPROC9",136,0)
 Q
"RTN","PSAPROC9",137,0)
 ;
"RTN","PSAPROC9",138,0)
CONTYN ;Extended help for 'Do you want to continue processing invoice# 99'
"RTN","PSAPROC9",139,0)
 W !?5,"Enter YES to continue processing the current invoice and line item.",!?5,"Enter NO to discontinue processing the current invoice and exit the option."
"RTN","PSAPROC9",140,0)
 Q
"VER")
8.0^22
**END**
**END**
