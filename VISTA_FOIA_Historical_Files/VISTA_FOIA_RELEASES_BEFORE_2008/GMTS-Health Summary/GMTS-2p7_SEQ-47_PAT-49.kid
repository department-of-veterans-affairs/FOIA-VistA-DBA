Released GMTS*2.7*49 SEQ #47
Extracted from mail message
**KIDS**:GMTS*2.7*49^

**INSTALL NAME**
GMTS*2.7*49
"BLD",3464,0)
GMTS*2.7*49^HEALTH SUMMARY^0^3020227^y
"BLD",3464,1,0)
^^2^2^3011015^^
"BLD",3464,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",3464,1,2,0)
patch GMTS*2.7*49.
"BLD",3464,4,0)
^9.64PA^^
"BLD",3464,"INI")
PRE^GMTSP49
"BLD",3464,"INID")
^y
"BLD",3464,"INIT")
POST^GMTSP49
"BLD",3464,"KRN",0)
^9.67PA^19^17
"BLD",3464,"KRN",.4,0)
.4
"BLD",3464,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",3464,"KRN",.4,"NM",1,0)
GMTS TYPE INQ    FILE #142^142^0
"BLD",3464,"KRN",.4,"NM","B","GMTS TYPE INQ    FILE #142",1)

"BLD",3464,"KRN",.401,0)
.401
"BLD",3464,"KRN",.402,0)
.402
"BLD",3464,"KRN",.403,0)
.403
"BLD",3464,"KRN",.5,0)
.5
"BLD",3464,"KRN",.84,0)
.84
"BLD",3464,"KRN",3.6,0)
3.6
"BLD",3464,"KRN",3.8,0)
3.8
"BLD",3464,"KRN",9.2,0)
9.2
"BLD",3464,"KRN",9.8,0)
9.8
"BLD",3464,"KRN",9.8,"NM",0)
^9.68A^64^54
"BLD",3464,"KRN",9.8,"NM",1,0)
GMTSDEM^^0^B14932792
"BLD",3464,"KRN",9.8,"NM",2,0)
GMTSDEMB^^0^B28762316
"BLD",3464,"KRN",9.8,"NM",5,0)
GMTS^^0^B30689956
"BLD",3464,"KRN",9.8,"NM",6,0)
GMTS1^^0^B20725641
"BLD",3464,"KRN",9.8,"NM",7,0)
GMTSADH2^^0^B23798147
"BLD",3464,"KRN",9.8,"NM",8,0)
GMTSADH5^^0^B36259734
"BLD",3464,"KRN",9.8,"NM",9,0)
GMTSDGA1^^0^B13500564
"BLD",3464,"KRN",9.8,"NM",11,0)
GMTSADH3^^0^B7895441
"BLD",3464,"KRN",9.8,"NM",12,0)
GMTSALGB^^0^B2168882
"BLD",3464,"KRN",9.8,"NM",13,0)
GMTSALG^^0^B27110366
"BLD",3464,"KRN",9.8,"NM",14,0)
GMTSAMIE^^0^B4262183
"BLD",3464,"KRN",9.8,"NM",15,0)
GMTSCM^^0^B13180749
"BLD",3464,"KRN",9.8,"NM",16,0)
GMTSXAC^^0^B30933341
"BLD",3464,"KRN",9.8,"NM",17,0)
GMTSXAL^^0^B49411879
"BLD",3464,"KRN",9.8,"NM",18,0)
GMTSXAW^^0^B27802945
"BLD",3464,"KRN",9.8,"NM",19,0)
GMTSXAW3^^0^B36297091
"BLD",3464,"KRN",9.8,"NM",20,0)
GMTSXA^^0^B19194947
"BLD",3464,"KRN",9.8,"NM",21,0)
GMTSXAB^^0^B8402043
"BLD",3464,"KRN",9.8,"NM",22,0)
GMTSXAD^^0^B31100757
"BLD",3464,"KRN",9.8,"NM",23,0)
GMTSXAO^^0^B11645035
"BLD",3464,"KRN",9.8,"NM",24,0)
GMTSXAP^^0^B58787039
"BLD",3464,"KRN",9.8,"NM",25,0)
GMTSXAP2^^0^B27973256
"BLD",3464,"KRN",9.8,"NM",26,0)
GMTSXAW2^^0^B21588396
"BLD",3464,"KRN",9.8,"NM",27,0)
GMTSRAE^^0^B54932099
"BLD",3464,"KRN",9.8,"NM",28,0)
GMTSPXOP^^0^B47884689
"BLD",3464,"KRN",9.8,"NM",29,0)
GMTSGAF^^0^B39330972
"BLD",3464,"KRN",9.8,"NM",30,0)
GMTSVS^^0^B32837615
"BLD",3464,"KRN",9.8,"NM",31,0)
GMTSVSD^^0^B54054453
"BLD",3464,"KRN",9.8,"NM",32,0)
GMTSVSS^^0^B40551410
"BLD",3464,"KRN",9.8,"NM",33,0)
GMTSDA^^0^B6844814
"BLD",3464,"KRN",9.8,"NM",34,0)
GMTSFH^^0^B21777901
"BLD",3464,"KRN",9.8,"NM",35,0)
GMTSMHPE^^0^B20887960
"BLD",3464,"KRN",9.8,"NM",36,0)
GMTSPN^^0^B63793556
"BLD",3464,"KRN",9.8,"NM",37,0)
GMTSPNB^^0^B7835224
"BLD",3464,"KRN",9.8,"NM",38,0)
GMTSPD^^0^B26570597
"BLD",3464,"KRN",9.8,"NM",39,0)
GMTSPD2^^0^B2627984
"BLD",3464,"KRN",9.8,"NM",40,0)
GMTSPL^^0^B36810974
"BLD",3464,"KRN",9.8,"NM",41,0)
GMTSCI^^0^B1113715
"BLD",3464,"KRN",9.8,"NM",43,0)
GMTSDCB^^0^B5775216
"BLD",3464,"KRN",9.8,"NM",44,0)
GMTSDD^^0^B9949347
"BLD",3464,"KRN",9.8,"NM",45,0)
GMTSDGA^^0^B8572795
"BLD",3464,"KRN",9.8,"NM",46,0)
GMTSDGA2^^0^B9843839
"BLD",3464,"KRN",9.8,"NM",47,0)
GMTSDGC2^^0^B5304616
"BLD",3464,"KRN",9.8,"NM",48,0)
GMTSDGD^^0^B2749087
"BLD",3464,"KRN",9.8,"NM",49,0)
GMTSDGH^^0^B7727684
"BLD",3464,"KRN",9.8,"NM",50,0)
GMTSDGP^^0^B10104539
"BLD",3464,"KRN",9.8,"NM",51,0)
GMTSDVR^^0^B37066955
"BLD",3464,"KRN",9.8,"NM",55,0)
GMTSLREM^^0^B9996519
"BLD",3464,"KRN",9.8,"NM",56,0)
GMTSLRMX^^0^B20705484
"BLD",3464,"KRN",9.8,"NM",60,0)
GMTSLOAD^^0^B15017440
"BLD",3464,"KRN",9.8,"NM",61,0)
GMTSMCMA^^0^B26971145
"BLD",3464,"KRN",9.8,"NM",62,0)
GMTSXAR^^0^B77442722
"BLD",3464,"KRN",9.8,"NM",63,0)
GMTSPN1^^0^B29052150
"BLD",3464,"KRN",9.8,"NM",64,0)
GMTSPN2^^0^B46788667
"BLD",3464,"KRN",9.8,"NM","B","GMTS",5)

"BLD",3464,"KRN",9.8,"NM","B","GMTS1",6)

"BLD",3464,"KRN",9.8,"NM","B","GMTSADH2",7)

"BLD",3464,"KRN",9.8,"NM","B","GMTSADH3",11)

"BLD",3464,"KRN",9.8,"NM","B","GMTSADH5",8)

"BLD",3464,"KRN",9.8,"NM","B","GMTSALG",13)

"BLD",3464,"KRN",9.8,"NM","B","GMTSALGB",12)

"BLD",3464,"KRN",9.8,"NM","B","GMTSAMIE",14)

"BLD",3464,"KRN",9.8,"NM","B","GMTSCI",41)

"BLD",3464,"KRN",9.8,"NM","B","GMTSCM",15)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDA",33)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDCB",43)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDD",44)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDEM",1)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDEMB",2)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGA",45)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGA1",9)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGA2",46)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGC2",47)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGD",48)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGH",49)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDGP",50)

"BLD",3464,"KRN",9.8,"NM","B","GMTSDVR",51)

"BLD",3464,"KRN",9.8,"NM","B","GMTSFH",34)

"BLD",3464,"KRN",9.8,"NM","B","GMTSGAF",29)

"BLD",3464,"KRN",9.8,"NM","B","GMTSLOAD",60)

"BLD",3464,"KRN",9.8,"NM","B","GMTSLREM",55)

"BLD",3464,"KRN",9.8,"NM","B","GMTSLRMX",56)

"BLD",3464,"KRN",9.8,"NM","B","GMTSMCMA",61)

"BLD",3464,"KRN",9.8,"NM","B","GMTSMHPE",35)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPD",38)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPD2",39)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPL",40)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPN",36)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPN1",63)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPN2",64)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPNB",37)

"BLD",3464,"KRN",9.8,"NM","B","GMTSPXOP",28)

"BLD",3464,"KRN",9.8,"NM","B","GMTSRAE",27)

"BLD",3464,"KRN",9.8,"NM","B","GMTSVS",30)

"BLD",3464,"KRN",9.8,"NM","B","GMTSVSD",31)

"BLD",3464,"KRN",9.8,"NM","B","GMTSVSS",32)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXA",20)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAB",21)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAC",16)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAD",22)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAL",17)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAO",23)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAP",24)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAP2",25)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAR",62)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAW",18)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAW2",26)

"BLD",3464,"KRN",9.8,"NM","B","GMTSXAW3",19)

"BLD",3464,"KRN",19,0)
19
"BLD",3464,"KRN",19,"NM",0)
^9.68A^7^7
"BLD",3464,"KRN",19,"NM",1,0)
GMTS IRM/ADPAC MAINT MENU^^2
"BLD",3464,"KRN",19,"NM",2,0)
GMTS GUI SITE DEFAULTS^^0
"BLD",3464,"KRN",19,"NM",3,0)
GMTS GUI SITE DISPLAY DEFAULTS^^0
"BLD",3464,"KRN",19,"NM",4,0)
GMTS GUI SITE ADD/EDIT LIST^^0
"BLD",3464,"KRN",19,"NM",5,0)
GMTS GUI SITE COMPILE METHOD^^0
"BLD",3464,"KRN",19,"NM",6,0)
GMTS GUI SITE PRECEDENCE^^0
"BLD",3464,"KRN",19,"NM",7,0)
GMTS GUI SITE RESEQUENCE^^0
"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE ADD/EDIT LIST",4)

"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE COMPILE METHOD",5)

"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE DEFAULTS",2)

"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE DISPLAY DEFAULTS",3)

"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE PRECEDENCE",6)

"BLD",3464,"KRN",19,"NM","B","GMTS GUI SITE RESEQUENCE",7)

"BLD",3464,"KRN",19,"NM","B","GMTS IRM/ADPAC MAINT MENU",1)

"BLD",3464,"KRN",19.1,0)
19.1
"BLD",3464,"KRN",101,0)
101
"BLD",3464,"KRN",409.61,0)
409.61
"BLD",3464,"KRN",771,0)
771
"BLD",3464,"KRN",870,0)
870
"BLD",3464,"KRN",8994,0)
8994
"BLD",3464,"KRN","B",.4,.4)

"BLD",3464,"KRN","B",.401,.401)

"BLD",3464,"KRN","B",.402,.402)

"BLD",3464,"KRN","B",.403,.403)

"BLD",3464,"KRN","B",.5,.5)

"BLD",3464,"KRN","B",.84,.84)

"BLD",3464,"KRN","B",3.6,3.6)

"BLD",3464,"KRN","B",3.8,3.8)

"BLD",3464,"KRN","B",9.2,9.2)

"BLD",3464,"KRN","B",9.8,9.8)

"BLD",3464,"KRN","B",19,19)

"BLD",3464,"KRN","B",19.1,19.1)

"BLD",3464,"KRN","B",101,101)

"BLD",3464,"KRN","B",409.61,409.61)

"BLD",3464,"KRN","B",771,771)

"BLD",3464,"KRN","B",870,870)

"BLD",3464,"KRN","B",8994,8994)

"BLD",3464,"QUES",0)
^9.62^^
"BLD",3464,"REQB",0)
^9.611^3^2
"BLD",3464,"REQB",2,0)
GMTS*2.7*44^2
"BLD",3464,"REQB",3,0)
GMTS*2.7*47^2
"BLD",3464,"REQB","B","GMTS*2.7*44",2)

"BLD",3464,"REQB","B","GMTS*2.7*47",3)

"INI")
PRE^GMTSP49
"INIT")
POST^GMTSP49
"KRN",.4,207,-1)
0^1
"KRN",.4,207,0)
GMTS TYPE INQ^3000821.1057^^142^^^3011221^
"KRN",.4,207,"DXS")
3
"KRN",.4,207,"DXS",1,9.2)
S I(1,0)=$S($D(D1):D1,1:""),I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^GMT(142,D0,1,D1,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'$D(^GMT(142.1,+D0,0)) D0=-1
"KRN",.4,207,"DXS",2,9)
W $S($L($P(X,U,5)):$E($P(X,U,5),1,20),$P(^GMT(142.1,$P(X,U,2),0),U,9)]"":$E($P(^(0),U,9),1,20),1:$E($P(^GMT(142.1,$P(X,U,2),0),U),1,20))
"KRN",.4,207,"F",1)
1,X DXS(1,9.2) S DIP(101)=$S($D(^GMT(142.1,D0,0)):^(0),1:"") S X=$P(DIP(101),U,4) S D0=I(0,0) S D1=I(1,0) W X K DIP;C1;L4;Z;"COMPONENT:ABBREV"~
"KRN",.4,207,"F",2)
1,.01;C7;L4~1,"";C10~1,I $P(X,U,2),$P(^GMT(142.1,$P(X,U,2),0),U,6)'="" W "*";Z;"I $P(X,U,2),$P(^GMT(142.1,$P(X,U,2),0),U,6)'="" W "*""~1,"";C13~
"KRN",.4,207,"F",3)
1,X DXS(2,9);Z;"W $S($L($P(X,U,5)):$E($P(X,U,5),1,20),$P(^GMT(142.1,$P(X,U,2),0),U,9)]"":$E($P(^(0),U,9),1,20),1:$E($P(^GMT(142.1,$P(X,U,2),0),U),1,20))"~
"KRN",.4,207,"F",4)
1,2;C36;L3~1,3;C41;L4~1,6;C47;L3~1,7;C52;L5~1,8;C58;L3~1,9;C63;L3~1,4,.01;C68;L(IOM-68)~
"KRN",.4,207,"H")
[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]
"KRN",19,4157,-1)
2^1
"KRN",19,4157,0)
GMTS IRM/ADPAC MAINT MENU^Health Summary Maintenance Menu^^M^.5^^^^^^y^126
"KRN",19,4157,10,0)
^19.01IP^9^9
"KRN",19,4157,10,9,0)
8800^9^9
"KRN",19,4157,10,9,"^")
GMTS GUI SITE DEFAULTS
"KRN",19,4157,"U")
HEALTH SUMMARY MAINTENANCE MEN
"KRN",19,8799,-1)
0^3
"KRN",19,8799,0)
GMTS GUI SITE DISPLAY DEFAULTS^Display Site Health Summary List Defaults^^R^^^^^^^^
"KRN",19,8799,25)
DS^GMTSXA
"KRN",19,8799,"U")
DISPLAY SITE HEALTH SUMMARY LI
"KRN",19,8800,-1)
0^2
"KRN",19,8800,0)
GMTS GUI SITE DEFAULTS^CPRS Health Summary Display/Edit Site Defaults^^M^^^^^^^^
"KRN",19,8800,10,0)
^19.01IP^5^5
"KRN",19,8800,10,1,0)
8799^1^1
"KRN",19,8800,10,1,"^")
GMTS GUI SITE DISPLAY DEFAULTS
"KRN",19,8800,10,2,0)
8801^3^3
"KRN",19,8800,10,2,"^")
GMTS GUI SITE COMPILE METHOD
"KRN",19,8800,10,3,0)
8802^4^4
"KRN",19,8800,10,3,"^")
GMTS GUI SITE PRECEDENCE
"KRN",19,8800,10,4,0)
8803^5^5
"KRN",19,8800,10,4,"^")
GMTS GUI SITE RESEQUENCE
"KRN",19,8800,10,5,0)
8804^2^2
"KRN",19,8800,10,5,"^")
GMTS GUI SITE ADD/EDIT LIST
"KRN",19,8800,99)
58819,39055
"KRN",19,8800,"U")
CPRS HEALTH SUMMARY DISPLAY/ED
"KRN",19,8801,-1)
0^5
"KRN",19,8801,0)
GMTS GUI SITE COMPILE METHOD^Edit Default HS Type List Compile Method^^R^^^^^^^^
"KRN",19,8801,25)
MS^GMTSXA
"KRN",19,8801,"U")
EDIT DEFAULT HS TYPE LIST COMP
"KRN",19,8802,-1)
0^6
"KRN",19,8802,0)
GMTS GUI SITE PRECEDENCE^Add/Edit Allowable Entities for HS List^^R^^^^^^^^
"KRN",19,8802,25)
PS^GMTSXA
"KRN",19,8802,"U")
ADD/EDIT ALLOWABLE ENTITIES FO
"KRN",19,8803,-1)
0^7
"KRN",19,8803,0)
GMTS GUI SITE RESEQUENCE^Resequence Allowable Entities for HS List^^R^^^^^^^^
"KRN",19,8803,25)
RS^GMTSXA
"KRN",19,8803,"U")
RESEQUENCE ALLOWABLE ENTITIES 
"KRN",19,8804,-1)
0^4
"KRN",19,8804,0)
GMTS GUI SITE ADD/EDIT LIST^Edit 'Health Summary Types List' Parameters^^R^^^^^^^^
"KRN",19,8804,25)
EM^GMTSXA
"KRN",19,8804,"U")
EDIT 'HEALTH SUMMARY TYPES LIS
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
49^3020227^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3020227
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*49.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
55
"RTN","GMTS")
0^5^B30689956
"RTN","GMTS",1,0)
GMTS ; SLC/KER - Health Summary Main Routine ; 02/27/2002
"RTN","GMTS",2,0)
 ;;2.7;Health Summary;**16,24,28,30,31,35,49**;Oct 20, 1995
"RTN","GMTS",3,0)
 ;            
"RTN","GMTS",4,0)
 ; External References
"RTN","GMTS",5,0)
 ;   DBIA   510  ^DISV(
"RTN","GMTS",6,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTS",7,0)
 ;   DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTS",8,0)
 ;   DBIA  2160  ^XUTL("OR"
"RTN","GMTS",9,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTS",10,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTS",11,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTS",12,0)
 ;   DBIA   148  PATIENT^ORU1
"RTN","GMTS",13,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTS",14,0)
 ;            
"RTN","GMTS",15,0)
MAIN ; Controls branching
"RTN","GMTS",16,0)
 ;            
"RTN","GMTS",17,0)
 ;   GMTSPXGO & GMRANGE are set in 2 calling 
"RTN","GMTS",18,0)
 ;   options, They aren't meant to be used together.
"RTN","GMTS",19,0)
 ;            
"RTN","GMTS",20,0)
 I +$G(GMTSPXGO)'>0,$L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSDVR Q
"RTN","GMTS",21,0)
 N DIROUT,DUOUT,ZTRTN,GMTSPX1,GMTSPX2,GMNAME,GMPSAP
"RTN","GMTS",22,0)
 S GMTSTYP=0 K DIC,DIROUT,DUOUT
"RTN","GMTS",23,0)
 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(+$G(DUZ),"^GMT(142,")),0)),U)
"RTN","GMTS",24,0)
 F  Q:$D(DIROUT)!$D(DUOUT)  D SELTYP Q:GMTSTYP'>0!$D(DIROUT)!$D(DUOUT)  D
"RTN","GMTS",25,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTS",26,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DIROUT)!$D(DUOUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTS",27,0)
 . . K GMPAT,DFN
"RTN","GMTS",28,0)
 . . I +$G(ORVP) D
"RTN","GMTS",29,0)
 . . . S (DFN,GMPAT(1))=+ORVP,GMNAME=$P($G(^DPT(+DFN,0)),U) Q:GMNAME=""  S GMPATT(GMNAME,DFN)="",(GMTSPX1,GMTSPX2)=""
"RTN","GMTS",30,0)
 . . . W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",31,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTS",32,0)
 . . . I $G(GMTSPX1)']""!($G(GMTSPX2)']"") S DIROUT=1 K GMPAT,GMPATT Q
"RTN","GMTS",33,0)
 . . . Q:$D(DIROUT)  S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",34,0)
 . . I '(+($G(ORVP))) F  Q:$D(DIROUT)  K GMPATT D SELPT Q:$D(DIROUT)!('$D(GMPATT))  S GMNAME="" F  S GMNAME=$O(GMPATT(GMNAME)) Q:GMNAME=""!$D(DIROUT)  F DFN=0:0 S DFN=$O(GMPATT(GMNAME,DFN)) Q:DFN=""  D  Q:$D(DIROUT)
"RTN","GMTS",35,0)
 . . . S (GMTSPX1,GMTSPX2)="" W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",36,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) I $G(GMTSPX1)']""!($G(GMTSPX2)']"") Q
"RTN","GMTS",37,0)
 . . . Q:$D(DIROUT)
"RTN","GMTS",38,0)
 . . . S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",39,0)
 . . Q:$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",40,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX1,.GMTSPX2) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTS",41,0)
 . . Q:$D(DIROUT)
"RTN","GMTS",42,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTS",43,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DTOUT)
"RTN","GMTS",44,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTS",45,0)
 . . D HSOUT^GMTSDVR,END W !
"RTN","GMTS",46,0)
 K GMTSTYP,GMTSTITL,GMTSEG,GMTSEGI,GMTSEGC,GMX,DFN,X,Y,I,GMP,GMPATT
"RTN","GMTS",47,0)
 Q
"RTN","GMTS",48,0)
SELTYP ; Select a Health Summary Type for printing
"RTN","GMTS",49,0)
 Q:GMTSTYP=-1  S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTS",50,0)
 S Y=$$TYPE^GMTSULT K DIC S GMTSTYP=+Y,GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:"") S:GMTSTITL="" GMTSTITL=$P(Y,"^",2)
"RTN","GMTS",51,0)
 I GMTSTYP>0,$S($D(^GMT(142,GMTSTYP,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"This Summary Type includes no components...Please choose another." G SELTYP
"RTN","GMTS",52,0)
SELTYP1 ; Get each component record
"RTN","GMTS",53,0)
 K GMTSEG,GMTSEGI S (GMI,S1)=0 F  S S1=$O(^GMT(142,GMTSTYP,1,S1)) Q:'S1  S GMX=^(S1,0) D LOADSEG
"RTN","GMTS",54,0)
 S GMTSEGC=GMI K S1,S2,GMI
"RTN","GMTS",55,0)
 Q
"RTN","GMTS",56,0)
LOADSEG ; Load enabled components into GMTSEG array
"RTN","GMTS",57,0)
 S GMTS0=^GMT(142.1,$P(GMX,"^",2),0)
"RTN","GMTS",58,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMX,GMTSEGI($P(GMX,U,2))=GMI D SELFILE
"RTN","GMTS",59,0)
 Q
"RTN","GMTS",60,0)
SELPT ; Select a patient
"RTN","GMTS",61,0)
 N DUOUT,GMTSPRO,GMTSVER K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP
"RTN","GMTS",62,0)
 S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTS",63,0)
 D:+GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTS",64,0)
 D:+GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP)
"RTN","GMTS",65,0)
 D PATCOPY^GMTSDVR(.GMP,.GMPATT)
"RTN","GMTS",66,0)
 Q
"RTN","GMTS",67,0)
SELFILE ; Load Selection Items in GMTSEG( array
"RTN","GMTS",68,0)
 N SF,SR,S2 S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,S1,1,S2)) Q:'S2  D
"RTN","GMTS",69,0)
 . S ENTRY=^(S2,0),SR=U_$P(ENTRY,";",2) Q:SR="^"
"RTN","GMTS",70,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTS",71,0)
 . S GMTSEG(GMI,SF,S2)=$P(ENTRY,";"),GMTSEG(GMI,SF,0)=SR
"RTN","GMTS",72,0)
 Q
"RTN","GMTS",73,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTS",74,0)
 N DFN,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTS",75,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTS",76,0)
 N TRFAC,VAERR,VAIN
"RTN","GMTS",77,0)
 S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTS",78,0)
 . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTS",79,0)
 . I +$G(GMTSPXGO)>0 S GMTSPX1=$P($G(GMPAT(GMTJ)),U,2) D
"RTN","GMTS",80,0)
 . . S GMTSPX2=$P($G(GMPAT(GMTJ)),U,3)
"RTN","GMTS",81,0)
 . . I +GMTSPX1'>0!+GMTSPX2'>0 K GMTSPX1,GMTSPX2
"RTN","GMTS",82,0)
 . N GMDUOUT
"RTN","GMTS",83,0)
 . D EN^GMTS1
"RTN","GMTS",84,0)
 . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTS",85,0)
 . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTS",86,0)
 Q
"RTN","GMTS",87,0)
HSOUT ; Output Summary, with DEVICE handling
"RTN","GMTS",88,0)
 K ZTSK
"RTN","GMTS",89,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D EN^GMTS1 Q
"RTN","GMTS",90,0)
 K IOP S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTS",91,0)
 G:$D(IO("Q")) QUE
"RTN","GMTS",92,0)
NOQUE ; Print non-queued output to selected device
"RTN","GMTS",93,0)
 D EN^GMTS1
"RTN","GMTS",94,0)
 D ^%ZISC
"RTN","GMTS",95,0)
 Q
"RTN","GMTS",96,0)
QUE ; Call TaskMan to Queue output
"RTN","GMTS",97,0)
 K IO("Q"),ZTSAVE F %="DFN","GMTS*","ENTRY" S ZTSAVE(%)=""
"RTN","GMTS",98,0)
 S ZTRTN="EN^GMTS1",ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTS",99,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTS",100,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTS",101,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTS",102,0)
 Q
"RTN","GMTS",103,0)
END ; Clean up environmental variables and EXIT Health Summary
"RTN","GMTS",104,0)
 K %T,DIC,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMTSSN,GMTS0,GMTS1,GMTS2
"RTN","GMTS",105,0)
 K GMTSAGE,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,GMTSNPG,GMTSPG,GMTSQIT,GMTSX,ENTRY,Z1,GMTSDTM,GMTSLOCK,GMTSLPG,SEX,POP,C,GMTSTOF
"RTN","GMTS",106,0)
 Q
"RTN","GMTS",107,0)
ENCWA ; Entry point printing components
"RTN","GMTS",108,0)
 ;            
"RTN","GMTS",109,0)
 ;   GMTSPRM can be set to any component abbreviations 
"RTN","GMTS",110,0)
 ;   except ones that require selection items. Needs 
"RTN","GMTS",111,0)
 ;   to be valid component abbreviation from the "C"
"RTN","GMTS",112,0)
 ;   x-ref of File 142.1.
"RTN","GMTS",113,0)
 ;            
"RTN","GMTS",114,0)
 ;   Call with DFN, GMTSPRM="CD,CN,CW,ADR", GMTSTITL="TITLE"
"RTN","GMTS",115,0)
 ;            
"RTN","GMTS",116,0)
 ;     GMTSPX1=Optional FM date for ending date
"RTN","GMTS",117,0)
 ;     GMTSPX2=Optional FM date for beginning date
"RTN","GMTS",118,0)
 ;            
"RTN","GMTS",119,0)
 ;   NOTE: Optional date range variables are both 
"RTN","GMTS",120,0)
 ;         required if a date range is desired.
"RTN","GMTS",121,0)
 ;            
"RTN","GMTS",122,0)
 N GMI,GMJ,GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTS",123,0)
 S GMTS1="9999999",GMTS2="6666666",GMI=0,GMTSPNF=1
"RTN","GMTS",124,0)
 I '$D(GMTSPRM) W !,"The parameter GMTSPRM is undefined.",! Q
"RTN","GMTS",125,0)
 I '$D(GMTSTITL) W !,"The parameter GMTSTITL is undefined.",! Q
"RTN","GMTS",126,0)
 I '+$G(DFN) W !,"The parameter DFN is undefined.",! Q
"RTN","GMTS",127,0)
 F GMJ=1:1:$L(GMTSPRM,",") S ABB=$P(GMTSPRM,",",GMJ) D LOAD Q:GMJ=-1
"RTN","GMTS",128,0)
 S GMTSEGC=GMI K ABB,IFN
"RTN","GMTS",129,0)
 D EN^GMTS1
"RTN","GMTS",130,0)
 D END K GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL,GMTSPRM,GMTSPNF
"RTN","GMTS",131,0)
 Q
"RTN","GMTS",132,0)
LOAD ; Load GMTSEG() using GMTSPRM abbreviations
"RTN","GMTS",133,0)
 S IFN=$O(^GMT(142.1,"C",ABB,"")) Q:IFN=""
"RTN","GMTS",134,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMI_"^"_IFN,GMTSEGI(IFN)=GMI
"RTN","GMTS",135,0)
 Q
"RTN","GMTS1")
0^6^B20725641
"RTN","GMTS1",1,0)
GMTS1 ; SLC/JER,KER - Health Summary Driver ; 02/27/2002
"RTN","GMTS1",2,0)
 ;;2.7;Health Summary;**7,16,24,28,37,49**;Oct 20, 1995
"RTN","GMTS1",3,0)
 ;                    
"RTN","GMTS1",4,0)
 ; External References
"RTN","GMTS1",5,0)
 ;   DBIA 10076  ^XUSEC(
"RTN","GMTS1",6,0)
 ;   DBIA 10000  C^%DTC
"RTN","GMTS1",7,0)
 ;   DBIA 10000  NOW^%DTC
"RTN","GMTS1",8,0)
 ;               
"RTN","GMTS1",9,0)
EN ; Entry Point to Generate a Summary
"RTN","GMTS1",10,0)
 ;               
"RTN","GMTS1",11,0)
 ;   Requires:  DFN, GMTSTITL, GMTSEG()
"RTN","GMTS1",12,0)
 ;              GMTSEGI(), GMTSEGC, DUZ(2)
"RTN","GMTS1",13,0)
 ;               
"RTN","GMTS1",14,0)
 ;   $I & IO MUST BE VALID, CALLER MUST CLOSE OUTPUT DEVICE
"RTN","GMTS1",15,0)
 ;               
"RTN","GMTS1",16,0)
START ; Health Summary
"RTN","GMTS1",17,0)
 N GMSUPRES,GMTSICF,GMTSPXD1,GMTSPXD2,GMTSBEG,GMTSEND
"RTN","GMTS1",18,0)
 S GMSUPRES=$P($G(^GMT(142,+$G(GMTSTYP),0)),U,5)
"RTN","GMTS1",19,0)
 U IO S GMTSLO=3,GMTSLPG=0
"RTN","GMTS1",20,0)
 D DEM^GMTSU
"RTN","GMTS1",21,0)
 W:$E(IOST)="C" @IOF D OUTPUT
"RTN","GMTS1",22,0)
 K GMTSCVD,GMTSCKP,GMTSNPG,GMTSPG,GMTSQIT,GMTSHDR,GMTSHD2,GMTSBRK,GMTSLCMP,GMTSDTC
"RTN","GMTS1",23,0)
 K GMTSEGN,GMTSE,GMTSEGR,GMTSEQ,GMTSEGH,GMTSEGL,GMTSDLM,GMTSDLS,GMTSNDM,GMTSN,GMTSQ
"RTN","GMTS1",24,0)
 Q
"RTN","GMTS1",25,0)
 ;
"RTN","GMTS1",26,0)
OUTPUT ; Loop through GMTSEG()
"RTN","GMTS1",27,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X
"RTN","GMTS1",28,0)
 I +$G(GMTSPX1)&+$G(GMTSPX2) D  ;   Allows date range for data
"RTN","GMTS1",29,0)
 . S GMTS2=9999999-$P(GMTSPX2,"."),GMTS1=9999999-$P(GMTSPX1,".")-.24
"RTN","GMTS1",30,0)
 . ;   For GMTS1 want to get everything till Midnight
"RTN","GMTS1",31,0)
 . S X=GMTSPX1 D REGDT4^GMTSU S GMTSPXD1=X
"RTN","GMTS1",32,0)
 . S X=GMTSPX2 D REGDT4^GMTSU S GMTSPXD2=X
"RTN","GMTS1",33,0)
 D HEADER^GMTSUP
"RTN","GMTS1",34,0)
 K GMTSQIT S GMTSEGN=""
"RTN","GMTS1",35,0)
 F  S GMTSEGN=$O(GMTSEG(GMTSEGN)) Q:GMTSEGN=""  K GMTSQIT S GMTSEQ=$P(GMTSEG(GMTSEGN),U,1),GMTSE=$P(GMTSEG(GMTSEGN),U,2) D SEGMNT D:GMTSEGN=GMTSEGC LASTPG I $D(GMTSQIT),(GMTSQIT="") Q
"RTN","GMTS1",36,0)
 S GMTSHDR=$E(GMTSHDR,1,3)_" END "_$E(GMTSHDR,9,79)
"RTN","GMTS1",37,0)
 W:$E(IOST)'="C" !,GMTSHDR,!
"RTN","GMTS1",38,0)
 H:$E(IOST)="C" 1
"RTN","GMTS1",39,0)
 W:'+$G(GMPSAP) @IOF
"RTN","GMTS1",40,0)
 I $D(GMTSQIT) D EXIT
"RTN","GMTS1",41,0)
 Q
"RTN","GMTS1",42,0)
 ;
"RTN","GMTS1",43,0)
LASTPG ; Allows User to branch to an earlier component (last page)
"RTN","GMTS1",44,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!$D(GMTSQIT)
"RTN","GMTS1",45,0)
 I +$G(GMPSAP),IOSL>998,$G(GMPAT(+$O(GMPAT(0),-1)))'=DFN Q
"RTN","GMTS1",46,0)
 ;   No footer when IOSL > 998 and action profile is printed.
"RTN","GMTS1",47,0)
 I IOSL>998,+$G(GMPSAP) Q
"RTN","GMTS1",48,0)
 ;   No footer when IOSL > 998 and this isn't the last patient.
"RTN","GMTS1",49,0)
 I IOSL>998,$G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN) Q
"RTN","GMTS1",50,0)
 F I=$Y:1:$S((IOSL-GMTSLO)'>64:(IOSL-GMTSLO),1:(24-GMTSLO)) W !
"RTN","GMTS1",51,0)
 I $D(GMTSQIT),(GMTSQIT>0) K GMTSQIT
"RTN","GMTS1",52,0)
 S GMTSLPG=1 D CKP^GMTSUP
"RTN","GMTS1",53,0)
 Q
"RTN","GMTS1",54,0)
EXIT ; Clean up and quit
"RTN","GMTS1",55,0)
 K ZTSK
"RTN","GMTS1",56,0)
 Q
"RTN","GMTS1",57,0)
SEGMNT ; Output a Component Type
"RTN","GMTS1",58,0)
 N GMTSLOCK,GMTSDBL,GMOOTXT,GMPXICDF,GMPXHLOC,GMPXNARR,GMPXCMOD,GMPXCM,GMTSWRIT,GMSEL
"RTN","GMTS1",59,0)
 I $D(GMTSQIT),(GMTSQIT]"") K GMTSQIT
"RTN","GMTS1",60,0)
 S X=^GMT(142.1,GMTSE,0),GMTSEGH=$S($P(X,U,4)]"":$P(X,U,4)_" - ",1:"")_$S($P(GMTSEG(GMTSEGN),U,5)]"":$P(GMTSEG(GMTSEGN),U,5),$P(X,U,9)]"":$P(X,U,9),1:" "_$P(X,U,1)),GMTSEGR=$P(X,"^",2) Q:GMTSEGR=""
"RTN","GMTS1",61,0)
 S GMTSLOCK=$P(X,U,7),GMTSDBL=$P(X,U,6),GMOOTXT=$P(X,U,8),GMPXCM=$P(X,U,14)
"RTN","GMTS1",62,0)
 S GMPXHLOC=$P(GMTSEG(GMTSEGN),U,6),GMPXNARR=$P(GMTSEG(GMTSEGN),U,8)
"RTN","GMTS1",63,0)
 S GMPXCMOD=$P(GMTSEG(GMTSEGN),U,9) S:GMPXCM'="Y" GMPXCMOD="N"
"RTN","GMTS1",64,0)
 S GMPXICDF=$P(GMTSEG(GMTSEGN),U,7)
"RTN","GMTS1",65,0)
 S GMTSNDM=$P(GMTSEG(GMTSEGN),U,3),GMTSDLM=$P(GMTSEG(GMTSEGN),U,4) S:GMTSNDM="" GMTSNDM=-1
"RTN","GMTS1",66,0)
 ;   Allow for date range for data
"RTN","GMTS1",67,0)
 S:+$G(GMTSPX1)&+$G(GMTSPX2) GMTSDLM=""
"RTN","GMTS1",68,0)
 S GMTSDLS=""
"RTN","GMTS1",69,0)
 I GMTSDLM?1N.N!(GMTSDLM?1N.N1"D") S GMTSDLS=+GMTSDLM_" day"
"RTN","GMTS1",70,0)
 S:GMTSDLM?1N.N1"W" GMTSDLS=+GMTSDLM_" week",GMTSDLM=+GMTSDLM*7
"RTN","GMTS1",71,0)
 S:GMTSDLM?1N.N1"M" GMTSDLS=+GMTSDLM_" month",GMTSDLM=+GMTSDLM*30.4
"RTN","GMTS1",72,0)
 S:GMTSDLM?1N.N1"Y" GMTSDLS=+GMTSDLM_" year",GMTSDLM=+GMTSDLM*365.25
"RTN","GMTS1",73,0)
 S GMTSDLM=+GMTSDLM
"RTN","GMTS1",74,0)
 S:+GMTSDLS>1 GMTSDLS=GMTSDLS_"s"
"RTN","GMTS1",75,0)
 S GMTSEGL="" I GMTSNDM>0!(GMTSDLM>0) S GMTSEGL=" (max "_$S(GMTSNDM>0:GMTSNDM_$S(GMTSNDM=1:" occurrence",1:" occurrences")_$S(GMTSDLM>0:" or ",1:""),1:"")_$S(GMTSDLM>0:GMTSDLS,1:"")_")"
"RTN","GMTS1",76,0)
 K GMTSDLS,GMTSN
"RTN","GMTS1",77,0)
 D NOW^%DTC S GMTSDTC=%,DT=$P(%,".") K %,%H,%I
"RTN","GMTS1",78,0)
 ;   Use date range unless variables empty
"RTN","GMTS1",79,0)
 ;     GMTS1=Most recent inverted date
"RTN","GMTS1",80,0)
 ;     GMTS2=To date in the past in an inverted date format
"RTN","GMTS1",81,0)
 I +$G(GMTSPX1)'>0!(+$G(GMTSPX2)'>0) D
"RTN","GMTS1",82,0)
 . I GMTSDLM'>0 S (GMTS2,GMTSDLM)=9999999,GMTS1=6666666
"RTN","GMTS1",83,0)
 . E  S X1=GMTSDTC,X2=-GMTSDLM D C^%DTC S GMTSDLM=9999999-X,GMTS2=GMTSDLM,GMTS1=9999999-(GMTSDTC+.0001) K X1,X2
"RTN","GMTS1",84,0)
 ;   Set GMTSBEG to be GMTS2 uninverted
"RTN","GMTS1",85,0)
 S GMTSBEG=$S(GMTS2=9999999:1,1:9999999-GMTS2)
"RTN","GMTS1",86,0)
 ;   Set GMTSEND to be GMTS1 uninverted
"RTN","GMTS1",87,0)
 S GMTSEND=$S(GMTS1=6666666:9999999,1:$P(9999999-GMTS1,".")_".235959")
"RTN","GMTS1",88,0)
 ; GMTSWRIT is used to print component heading on 1st write
"RTN","GMTS1",89,0)
 S GMTSWRIT=1
"RTN","GMTS1",90,0)
 I GMTSDBL]"",("PT"[GMTSDBL) D  Q
"RTN","GMTS1",91,0)
 . D:GMTSDBL="T" TDISBLD^GMTS2
"RTN","GMTS1",92,0)
 . D:GMTSDBL="P"&$D(GMTSPRM) PDISBLD^GMTS2
"RTN","GMTS1",93,0)
 I GMTSLOCK]"",('$D(^XUSEC(GMTSLOCK,DUZ))) D NOMATCH^GMTS2 Q
"RTN","GMTS1",94,0)
 S GMSEL=$P($G(^GMT(142.1,GMTSE,1,1,0)),U)
"RTN","GMTS1",95,0)
 I GMSEL]"",$O(GMTSEG(GMTSEGN,GMSEL,0))'>0 D NOSELECT^GMTS2 Q
"RTN","GMTS1",96,0)
 S GMTSNPG=0
"RTN","GMTS1",97,0)
 D @($P(GMTSEGR,";",1)_U_$P(GMTSEGR,";",2))
"RTN","GMTS1",98,0)
 D NODATA^GMTS2
"RTN","GMTS1",99,0)
 K GMTSDLM
"RTN","GMTS1",100,0)
 Q
"RTN","GMTSADH2")
0^7^B23798147
"RTN","GMTSADH2",1,0)
GMTSADH2 ; SLC/JER,KER - Ad Hoc Summary Driver ; 02/27/2002
"RTN","GMTSADH2",2,0)
 ;;2.7;Health Summary;**12,37,49**;Oct 20, 1995
"RTN","GMTSADH2",3,0)
 ;                
"RTN","GMTSADH2",4,0)
 ; External Reference
"RTN","GMTSADH2",5,0)
 ;   DBIA    67  ^LAB(60,
"RTN","GMTSADH2",6,0)
 ;   DBIA  2160  ^XUTL("OR"
"RTN","GMTSADH2",7,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSADH2",8,0)
 ;   DBIA  3137  EN^ORUS
"RTN","GMTSADH2",9,0)
 ;   DBIA    67  ^LAB(60,
"RTN","GMTSADH2",10,0)
 ;   DBIA   502  ^RAMIS(71,
"RTN","GMTSADH2",11,0)
 ;   DBIA  2815  ^ICPT(
"RTN","GMTSADH2",12,0)
 ;   DBIA  3450  ^GMRD(120.51,
"RTN","GMTSADH2",13,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSADH2",14,0)
 ;   DBIA  3148  ^PXD(811.9,
"RTN","GMTSADH2",15,0)
 ;   DBIA  3451  ^TIU(8925.1,
"RTN","GMTSADH2",16,0)
 ;   DBIA  1268  ^AUTTHF(
"RTN","GMTSADH2",17,0)
 ;                
"RTN","GMTSADH2",18,0)
CMPLIM ; Get Limits and Selection Items
"RTN","GMTSADH2",19,0)
 N GMTSFUNC
"RTN","GMTSADH2",20,0)
 I $P(CREC,U,5)="Y" D GETOCC^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",21,0)
 I $P(CREC,U,3)="Y" D GETIME^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",22,0)
 I $P(CREC,U,10)="Y" D GETHOSP^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",23,0)
 I $P(CREC,U,11)="Y" D GETICD^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",24,0)
 I $P(CREC,U,12)="Y" D GETPROV^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",25,0)
 I $P(CREC,U,14)="Y" D GETCPTM^GMTSADH4 I $D(DIROUT)!($D(DUOUT)) Q
"RTN","GMTSADH2",26,0)
 D GETNAME^GMTSADH4 I $D(DIROUT)!$D(DUOUT) Q
"RTN","GMTSADH2",27,0)
 N SEL I $D(^GMT(142.1,$P(GMTSEG(SBS),U,2),1,1,0)) S SEL=$P(^(0),U,1) I SEL D SELECT
"RTN","GMTSADH2",28,0)
 Q
"RTN","GMTSADH2",29,0)
SELECT ; Get Selection Items
"RTN","GMTSADH2",30,0)
 N GMTSF,GMTSJ,GETSLQIT,GMI,DIC,X,Y,TEMP,SELCNT
"RTN","GMTSADH2",31,0)
 S GMTSJ=$O(GMTSEG(SBS,0)),GMTSF=1
"RTN","GMTSADH2",32,0)
 I GMTSJ W !,"Default selection items are   " D SHOWDEF
"RTN","GMTSADH2",33,0)
 S SELCNT=$P(^GMT(142.1,$P(GMTSEG(SBS),U,2),1,1,0),U,2)
"RTN","GMTSADH2",34,0)
 W ! W:GMTSJ "Push Return at the first prompt to select default items.",!
"RTN","GMTSADH2",35,0)
 W "Select new "_$$FNAM^GMTSU(+SEL)_" items one at a time in the sequence",!,"you want them displayed. "
"RTN","GMTSADH2",36,0)
 W "You may select " I SELCNT="" W "any number of items.",!
"RTN","GMTSADH2",37,0)
 E  W "up to ",SELCNT," items.",!
"RTN","GMTSADH2",38,0)
 F GMI=1:1 D GETSEL Q:$D(DIROUT)!(Y=-1)!$S(+SELCNT:(GMI'<+SELCNT),1:0)
"RTN","GMTSADH2",39,0)
 I +SELCNT,(GMI'<+SELCNT) W !?2,$C(7),"MAXIMUM # OF ITEMS SELECTED.",!
"RTN","GMTSADH2",40,0)
 Q
"RTN","GMTSADH2",41,0)
GETSEL ; Updates GMTSEG array with Selections
"RTN","GMTSADH2",42,0)
 ;
"RTN","GMTSADH2",43,0)
 ; Using read for special processing when entering a "?".
"RTN","GMTSADH2",44,0)
 ;
"RTN","GMTSADH2",45,0)
 ; Get items from Selection Files #60, 71, 81, 120.51,
"RTN","GMTSADH2",46,0)
 ; 200, 811.9, 8925.1 and 9999999.6,
"RTN","GMTSADH2",47,0)
 ;
"RTN","GMTSADH2",48,0)
 I SEL=8925.1 W !,"Select TITLE: "
"RTN","GMTSADH2",49,0)
 E  W !,"Select "_$$FNAM^GMTSU(+SEL)_" Selection Item: "
"RTN","GMTSADH2",50,0)
 R X:DTIME
"RTN","GMTSADH2",51,0)
 I X="^^" S Y=0,DIROUT=1 Q
"RTN","GMTSADH2",52,0)
 I X="^" S Y=-1,(GETSLQIT,ASKCPQIT)="" Q
"RTN","GMTSADH2",53,0)
 I X["?" W:$O(GMTSEG(SBS,0)) !!,"Current Selection items are   " D SHOWDEF
"RTN","GMTSADH2",54,0)
 S DIC(0)="EMQ",DIC=$$FLOC^GMTSU(+SEL)
"RTN","GMTSADH2",55,0)
 I SEL=60 S DIC("S")="I $P(^(0),U,4)=""CH"",""BO""[$P(^(0),U,3)"
"RTN","GMTSADH2",56,0)
 I SEL=9999999.64 S DIC("S")="I $P(^(0),U,10)=""C"",+$P(^(0),U,11)'=1"
"RTN","GMTSADH2",57,0)
 I SEL=811.9 S DIC("S")="I +$P(^(0),U,6)'=1"
"RTN","GMTSADH2",58,0)
 I SEL=8925.1 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,3)"
"RTN","GMTSADH2",59,0)
 D ^DIC
"RTN","GMTSADH2",60,0)
 I $D(DTOUT) S DIROUT=1
"RTN","GMTSADH2",61,0)
 I $D(DIROUT) Q
"RTN","GMTSADH2",62,0)
 I $D(DUOUT) S (GETSLQIT,ASKCPQIT)="" Q
"RTN","GMTSADH2",63,0)
 I X["?" S Y="",GMI=GMI-1 Q
"RTN","GMTSADH2",64,0)
 I X]"",Y=-1 S Y=0,GMI=GMI-1 Q  ;Continue selecting items when incorrect item entered
"RTN","GMTSADH2",65,0)
 Q:Y=-1
"RTN","GMTSADH2",66,0)
 I GMTSF&(X'="") K GMTSEG(SBS,SEL) S GMTSF=0,GMTSEG(SBS,SEL,0)=DIC
"RTN","GMTSADH2",67,0)
 I DIC="^LAB(60,",'$L($P(^LAB(60,+Y,0),U,5)) D RESOLVE(+Y,.GMTSEG,.GMI) Q
"RTN","GMTSADH2",68,0)
 S GMTSEG(SBS,SEL,GMI)=+Y
"RTN","GMTSADH2",69,0)
 Q
"RTN","GMTSADH2",70,0)
SHOWDEF ; Writes out loaded (default) selection items
"RTN","GMTSADH2",71,0)
 N GMTSN,GMTSWHL
"RTN","GMTSADH2",72,0)
 I $G(GMTSJ)']"" S GMTSJ=$O(GMTSEG(SBS,0)) I GMTSJ']"" W !!,"No SELECTION ITEMS chosen.",! Q
"RTN","GMTSADH2",73,0)
 S GMTSN=0 F GMTSWHL=1:1 S GMTSN=$O(GMTSEG(SBS,+GMTSJ,GMTSN)) Q:GMTSN=""  W:GMTSWHL>1 ! W ?30,$P(@(GMTSEG(SBS,GMTSJ,0)_GMTSEG(SBS,GMTSJ,GMTSN)_",0)"),U)
"RTN","GMTSADH2",74,0)
 Q
"RTN","GMTSADH2",75,0)
RESOLVE(GMREF,GMTSEG,GMI) ; Call ORUS to resolve compound items
"RTN","GMTSADH2",76,0)
 N SELCT,GMJ,GMHEAD,X,Y
"RTN","GMTSADH2",77,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW")
"RTN","GMTSADH2",78,0)
 ;   This subroutine will increment the variable GMI
"RTN","GMTSADH2",79,0)
 ;   if any item are picked.  Need to decrement GMI 
"RTN","GMTSADH2",80,0)
 ;   by one (1) so it works right
"RTN","GMTSADH2",81,0)
 S GMI=GMI-1
"RTN","GMTSADH2",82,0)
 ;   Don't exceed allowed # of selection
"RTN","GMTSADH2",83,0)
 I +$G(SELCNT) S SELCT=SELCNT-GMI
"RTN","GMTSADH2",84,0)
 S GMHEAD="-- "_$P($G(^LAB(60,+GMREF,.1)),U)_" --"
"RTN","GMTSADH2",85,0)
 S ^XUTL("OR",$J,"GMTS",0)="LAB TEST^1^^0" D COMPILE(+GMREF)
"RTN","GMTSADH2",86,0)
 I $P(^XUTL("OR",$J,"GMTS",0),U,4)'>0 D  Q
"RTN","GMTSADH2",87,0)
 . K ^XUTL("OR",$J,"GMTS") W $C(7),"  INVALID TEST...Please choose another."
"RTN","GMTSADH2",88,0)
 S ORUS="^XUTL(""OR"","_$J_",""GMTS"",",ORUS(0)="40MN"_$S(+$G(SELCT):U_$S($P(^XUTL("OR",$J,"GMTS",0),U,4)'<SELCT:SELCT,1:$P(^XUTL("OR",$J,"GMTS",0),U,4)),1:""),ORUS("T")="D HEADER^GMTSADH2"
"RTN","GMTSADH2",89,0)
 S ORUS("A")="Select"_$S(+$P(ORUS(0),U,2):" 1 - "_+$P(ORUS(0),U,2),1:"")_" LAB TEST(s): "
"RTN","GMTSADH2",90,0)
 S ORUS("B")=$S(+$P(ORUS(0),U,2):"1-"_+$P(ORUS(0),U,2),1:"ALL")
"RTN","GMTSADH2",91,0)
 D EN^ORUS K ^XUTL("OR",$J,"GMTS"),^("ORU"),^("ORV"),^("ORW")
"RTN","GMTSADH2",92,0)
 Q:+Y'>0  S GMJ=0 F  S GMJ=$O(Y(GMJ)) Q:GMJ'>0  D
"RTN","GMTSADH2",93,0)
 . S GMI=GMI+1,GMTSEG(SBS,SEL,GMI)=+Y(GMJ)
"RTN","GMTSADH2",94,0)
 Q
"RTN","GMTSADH2",95,0)
COMPILE(GMTEST) ; Compile menu for ORUS call
"RTN","GMTSADH2",96,0)
 N GMC,GMI,GMJ,GMROOT
"RTN","GMTSADH2",97,0)
 S GMI=0 F  S GMI=$O(^LAB(60,GMTEST,2,GMI)) Q:GMI'>0  D
"RTN","GMTSADH2",98,0)
 . S GMJ=+$G(^LAB(60,GMTEST,2,+GMI,0))
"RTN","GMTSADH2",99,0)
 . S GMROOT=$G(^LAB(60,+GMJ,0))
"RTN","GMTSADH2",100,0)
 . I $L($P(GMROOT,U,5)),("BO"[$P(GMROOT,U,3)) D
"RTN","GMTSADH2",101,0)
 . . S GMC=+$P($G(^XUTL("OR",$J,"GMTS",0)),U,4)+1
"RTN","GMTSADH2",102,0)
 . . S ^XUTL("OR",$J,"GMTS",GMJ,0)=$P(GMROOT,U),$P(^XUTL("OR",$J,"GMTS",0),U,4)=GMC
"RTN","GMTSADH2",103,0)
 . E  D
"RTN","GMTSADH2",104,0)
 . . D COMPILE(+$G(^LAB(60,GMTEST,2,GMI,0)))
"RTN","GMTSADH2",105,0)
 Q
"RTN","GMTSADH2",106,0)
HEADER ; Write Header
"RTN","GMTSADH2",107,0)
 W !!?15,"Select the tests which you wish to include, in the",!?19,"sequence in which you wish them to appear."
"RTN","GMTSADH2",108,0)
 W !!?((80-$L(GMHEAD))\2),GMHEAD,!
"RTN","GMTSADH2",109,0)
 Q
"RTN","GMTSADH3")
0^11^B7895441
"RTN","GMTSADH3",1,0)
GMTSADH3 ; SLC/JER,KER - Ad Hoc Summary Driver - Help ; 02/27/2002
"RTN","GMTSADH3",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSADH3",3,0)
 ;                
"RTN","GMTSADH3",4,0)
 ; External References
"RTN","GMTSADH3",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSADH3",6,0)
 ;   DBIA 10102  DISP^XQORM1
"RTN","GMTSADH3",7,0)
 ;                    
"RTN","GMTSADH3",8,0)
HELP ; Help at Select Additional or Existing COMPONENT(S): prompt
"RTN","GMTSADH3",9,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADH3",10,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADH3",11,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADH3",12,0)
 D REDISP
"RTN","GMTSADH3",13,0)
 Q
"RTN","GMTSADH3",14,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADH3",15,0)
 N I,DIR,X,Y S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADH3",16,0)
 W @IOF D DISP^XQORM1 W !
"RTN","GMTSADH3",17,0)
 Q
"RTN","GMTSADH3",18,0)
HTX1 ;;Help Text for "?"
"RTN","GMTSADH3",19,0)
 ;;NOTE: At this point, any selections made are added to the list of
"RTN","GMTSADH3",20,0)
 ;;      previous selections.  Any exceptions (-THIS, -THAT) DO NOT REMOVE
"RTN","GMTSADH3",21,0)
 ;;      components from previous selections.  Exceptions only apply to the
"RTN","GMTSADH3",22,0)
 ;;      selections you are about to make.
"RTN","GMTSADH3",23,0)
 ;;
"RTN","GMTSADH3",24,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH3",25,0)
 ;;
"RTN","GMTSADH3",26,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADH3",27,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADH3",28,0)
 ;;
"RTN","GMTSADH3",29,0)
 ;;ZZZZ
"RTN","GMTSADH3",30,0)
HTX2 ;;Help Text for "??"
"RTN","GMTSADH3",31,0)
 ;;NOTE: At this point, any selections made are added to the list of
"RTN","GMTSADH3",32,0)
 ;;      previous selections.  Any exceptions (-THIS, -THAT) DO NOT REMOVE
"RTN","GMTSADH3",33,0)
 ;;      components from previous selections.  Exceptions only apply to the
"RTN","GMTSADH3",34,0)
 ;;      selections you are about to make.
"RTN","GMTSADH3",35,0)
 ;;
"RTN","GMTSADH3",36,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH3",37,0)
 ;;
"RTN","GMTSADH3",38,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADH3",39,0)
 ;;
"RTN","GMTSADH3",40,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADH3",41,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADH3",42,0)
 ;;
"RTN","GMTSADH3",43,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADH3",44,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADH3",45,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADH3",46,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADH3",47,0)
 ;;
"RTN","GMTSADH3",48,0)
 ;;ZZZZ
"RTN","GMTSADH5")
0^8^B36259734
"RTN","GMTSADH5",1,0)
GMTSADH5 ; SLC/DCM,KER - Health Summary Ad Hoc RPC's ; 02/27/2002
"RTN","GMTSADH5",2,0)
 ;;2.7;Health Summary;**36,35,37,49**;Oct 20, 1995
"RTN","GMTSADH5",3,0)
 ;                     
"RTN","GMTSADH5",4,0)
 ; External References
"RTN","GMTSADH5",5,0)
 ;   DBIA  1268  ^AUTTHF(
"RTN","GMTSADH5",6,0)
 ;   DBIA  1268  ^AUTTHF("B"
"RTN","GMTSADH5",7,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSADH5",8,0)
 ;   DBIA  1256  ^PXD(811.9
"RTN","GMTSADH5",9,0)
 ;   DBIA  3059  ^TIU(8925.1
"RTN","GMTSADH5",10,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSADH5",11,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSADH5",12,0)
 ;   DBIA  3058  $$ISA^TIULX
"RTN","GMTSADH5",13,0)
 ;                   
"RTN","GMTSADH5",14,0)
COMP(Y) ; Get ADHOC sub components (FILE 142.1)
"RTN","GMTSADH5",15,0)
 ;
"RTN","GMTSADH5",16,0)
 ;  Y(i)=(1)I;IFN^(2)Component Name [Abb]^(3)Occ Limit^
"RTN","GMTSADH5",17,0)
 ;       (4)Time Limit^(5)Header Name^(6)Hosp Loc Disp^
"RTN","GMTSADH5",18,0)
 ;       (7)ICD Text Disp^(8)Prov Narr Disp^
"RTN","GMTSADH5",19,0)
 ;       (9)CPT Modifier Disp^(10)Summary Order
"RTN","GMTSADH5",20,0)
 ;
"RTN","GMTSADH5",21,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",22,0)
 S Y(1)=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",23,0)
 I 'Y(1) S Y(1)=-1 Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",24,0)
 S (GMTSC,GMTSI)=0,GMTSII=Y(1)
"RTN","GMTSADH5",25,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",26,0)
 . S GMTSIFN=$P(X,"^",2),X1=$G(^GMT(142.1,+GMTSIFN,0))
"RTN","GMTSADH5",27,0)
 . Q:'$L(X1)  Q:$P(X1,"^",6)="P"  S GMTSC=GMTSC+1
"RTN","GMTSADH5",28,0)
 . S Y(GMTSC)=GMTSI_";"_GMTSIFN
"RTN","GMTSADH5",29,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$P(X1,"^")_" ["_$P(X1,"^",4)_"]"
"RTN","GMTSADH5",30,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",5)="Y":$P(X,"^",3),1:"")
"RTN","GMTSADH5",31,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",3)="Y":$P(X,"^",4),1:"")
"RTN","GMTSADH5",32,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($L($P(X1,"^",9)):$P(X1,"^",9),1:$P(X,"^",5))
"RTN","GMTSADH5",33,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",10)="Y":$P(X,"^",6),1:"")
"RTN","GMTSADH5",34,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",11)="Y":$P(X,"^",7),1:"")
"RTN","GMTSADH5",35,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",12)="Y":$P(X,"^",8),1:"")
"RTN","GMTSADH5",36,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$P(X,"^")
"RTN","GMTSADH5",37,0)
 Q
"RTN","GMTSADH5",38,0)
 ;
"RTN","GMTSADH5",39,0)
COMPSUB(Y,GMTSUB) ; Get subcomponents from a predefined ADHOC component
"RTN","GMTSADH5",40,0)
 ; GMTSUB=desired Adhoc subcomponent
"RTN","GMTSADH5",41,0)
 ; Y(i)=ifn of pointed to file entry^name
"RTN","GMTSADH5",42,0)
 Q:'$G(GMTSUB)
"RTN","GMTSADH5",43,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",44,0)
 S X=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",45,0)
 I 'X Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",46,0)
 S (GMTSC,GMTSI)=0,GMTSII=X
"RTN","GMTSADH5",47,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSUB,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",48,0)
 . S GMTSIFN=+X,X1=$P(X,";",2)
"RTN","GMTSADH5",49,0)
 . I '$D(@("^"_X1_+X_",0)")) Q
"RTN","GMTSADH5",50,0)
 . S X=@("^"_X1_+X_",0)"),GMTSC=GMTSC+1,Y(GMTSC)=GMTSIFN_"^"_$P(X,"^")
"RTN","GMTSADH5",51,0)
 Q
"RTN","GMTSADH5",52,0)
 ;                 
"RTN","GMTSADH5",53,0)
FILES(Y,GMTSCP)   ; Get Files to select from for a component
"RTN","GMTSADH5",54,0)
 Q:'$G(GMTSCP)  Q:'$D(^GMT(142.1,GMTSCP,1))  N GMTSI,GMTSC,X S (GMTSI,GMTSC)=0
"RTN","GMTSADH5",55,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSCP,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0),GMTSC=GMTSC+1,Y(GMTSC)=GMTSI_"^"_$$FNAM^GMTSU(+X)_"^"_X
"RTN","GMTSADH5",56,0)
 Q
"RTN","GMTSADH5",57,0)
 ;                     
"RTN","GMTSADH5",58,0)
FILESEL(GMTSRT,GMTSFI,GMTSFM,DIR) ; Get file entries
"RTN","GMTSADH5",59,0)
 Q:'$G(GMTSFI)
"RTN","GMTSADH5",60,0)
 K ^TMP("ORDATA",$J)
"RTN","GMTSADH5",61,0)
 N GMTSI,GMTSJ,GMTSC,X,GMTSGL,GMTSGLB,GMTSCNT
"RTN","GMTSADH5",62,0)
 S GMTSI=$G(GMTSFM),GMTSCNT=44,GMTSC=0,GMTSRT=$NA(^TMP("ORDATA",$J,1))
"RTN","GMTSADH5",63,0)
 S:'$D(DIR) DIR=1
"RTN","GMTSADH5",64,0)
 I GMTSFI=60 D  Q
"RTN","GMTSADH5",65,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^LAB(60,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^LAB(60,"B",GMTSI,GMTSJ)) Q:'GMTSJ  D
"RTN","GMTSADH5",66,0)
 . . I $D(^LAB(60,GMTSJ,0)) S X=^(0) I $P(X,"^",4)="CH","BO"[$P(X,"^",3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",67,0)
 I GMTSFI=9999999.64 D  Q
"RTN","GMTSADH5",68,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^AUTTHF("B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^AUTTHF("B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^AUTTHF(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",69,0)
 . . I $P(X,"^",10)="C",+$P(X,"^",11)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",70,0)
 I GMTSFI=811.9 D  Q
"RTN","GMTSADH5",71,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^PXD(811.9,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^PXD(811.9,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^PXD(811.9,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",72,0)
 . . I $P(X,"^",6)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",73,0)
 I GMTSFI=8925.1 D  Q
"RTN","GMTSADH5",74,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^TIU(8925.1,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^TIU(8925.1,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^TIU(8925.1,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",75,0)
 . . I $P(X,"^",4)="DOC",$$ISA^TIULX(GMTSJ,3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",76,0)
 ;I GMTSFI=81 D  Q
"RTN","GMTSADH5",77,0)
 ;. F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^ICPT("C",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^ICPT("C",GMTSI,GMTSJ)) Q:'GMTSJ   I $D(^ICPT(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",78,0)
 ;. . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_$P(X,"^",2)_" ["_$P(X,"^")_"]"
"RTN","GMTSADH5",79,0)
 S GMTSGL=$$FCLR^GMTSU(+GMTSFI) I $L(GMTSGL) S GMTSGLB=$$FLOC^GMTSU(+GMTSFI)_"""B"")" D
"RTN","GMTSADH5",80,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(@GMTSGLB@(GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(@GMTSGLB@(GMTSI,GMTSJ)) Q:'GMTSJ  I $D(@GMTSGL@(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",81,0)
 . . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",82,0)
 Q
"RTN","GMTSADH5",83,0)
 ;                     
"RTN","GMTSADH5",84,0)
REPORT(GMTSEG,GMTSEGC,GMTSEGI,GMTSCPS,DFN) ; Build Report
"RTN","GMTSADH5",85,0)
 ; Uses array of Components passed in GMTSCPS()
"RTN","GMTSADH5",86,0)
 ;   GMTSCPS(i)=array of subcomponents chosen,
"RTN","GMTSADH5",87,0)
 ;   value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","GMTSADH5",88,0)
 Q:'$G(DFN)
"RTN","GMTSADH5",89,0)
 N GMTSCNT,DIC,DIZ,DIW,DIWI,DIWT,DIWTC,X,GMTSI,GMTSJ,GMTSK,GMTSTYP,GMTSTITL
"RTN","GMTSADH5",90,0)
 S X="GMTS HS ADHOC",DIC=142,DIZ(0)="ZF"
"RTN","GMTSADH5",91,0)
 D ^DIC Q:'Y
"RTN","GMTSADH5",92,0)
 S GMTSTYP=+Y,GMTSTITL="AD HOC",(GMTSJ,GMTSI)=0,GMTSEGC=$O(GMTSCPS(99999999),-1)
"RTN","GMTSADH5",93,0)
 F  S GMTSI=$O(GMTSCPS(GMTSI)) Q:'GMTSI  D
"RTN","GMTSADH5",94,0)
 . N GMTSREC,GMTSS2,GMTSSJ,GMTSEL
"RTN","GMTSADH5",95,0)
 . S GMTSREC=^GMT(142,GMTSTYP,1,+GMTSCPS(GMTSI),0),GMTSJ=GMTSJ+1
"RTN","GMTSADH5",96,0)
 . S GMTSEG(GMTSJ)=GMTSREC,GMTSEGI($P(GMTSREC,U,2))=GMTSJ,GMTSS2=0,GMTSSJ=GMTSJ
"RTN","GMTSADH5",97,0)
 . S $P(GMTSEG(GMTSJ),"^",3)=$P(GMTSCPS(GMTSI),"^",2)
"RTN","GMTSADH5",98,0)
 . S $P(GMTSEG(GMTSJ),"^",4)=$P(GMTSCPS(GMTSI),"^",3)
"RTN","GMTSADH5",99,0)
 . I $L($P(GMTSCPS(GMTSI),"^",4)) S $P(GMTSEG(GMTSJ),"^",5)=$P(GMTSCPS(GMTSI),"^",4)
"RTN","GMTSADH5",100,0)
 . I $L($P(GMTSCPS(GMTSI),"^",5)) S $P(GMTSEG(GMTSJ),"^",6)=$P(GMTSCPS(GMTSI),"^",5)
"RTN","GMTSADH5",101,0)
 . S $P(GMTSEG(GMTSJ),"^",7)=$P(GMTSCPS(GMTSI),"^",6)
"RTN","GMTSADH5",102,0)
 . I $L($P(GMTSCPS(GMTSI),"^",7)) S $P(GMTSEG(GMTSJ),"^",8)=$P(GMTSCPS(GMTSI),"^",7)
"RTN","GMTSADH5",103,0)
 . S (GMTSCNT,GMTSK)=0
"RTN","GMTSADH5",104,0)
 . F  S GMTSK=$O(GMTSCPS(GMTSK)) Q:'GMTSK  I +GMTSCPS(GMTSI)=+GMTSCPS(GMTSK),$P(GMTSCPS(GMTSK),"^",9),$P(GMTSCPS(GMTSK),"^",10) D
"RTN","GMTSADH5",105,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",106,0)
 . . S:'$D(GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)) GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)=$$GET1^DID($P(GMTSCPS(GMTSK),"^",9),,,"GLOBAL NAME")
"RTN","GMTSADH5",107,0)
 . . S GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),GMTSCNT)=$P(GMTSCPS(GMTSK),"^",10)
"RTN","GMTSADH5",108,0)
 . . K GMTSCPS(GMTSK)
"RTN","GMTSADH5",109,0)
 Q
"RTN","GMTSADH5",110,0)
 ;                     
"RTN","GMTSADH5",111,0)
SUBITEM(Y,GMTSTEST) ; Get Subitems for a Test Panel
"RTN","GMTSADH5",112,0)
 Q:'$G(GMTSTEST)  N GMTSCNT S GMTSCNT=0
"RTN","GMTSADH5",113,0)
 I '$L($P(^LAB(60,GMTSTEST,0),"^",5)),$O(^LAB(60,GMTSTEST,2,0)) D COMPILE(GMTSTEST,GMTSCNT)
"RTN","GMTSADH5",114,0)
 Q
"RTN","GMTSADH5",115,0)
 ;                     
"RTN","GMTSADH5",116,0)
COMPILE(GMTSTEST,GMTSCNT) ; Expand lab panels
"RTN","GMTSADH5",117,0)
 N GMTSI,GMTSJ,GMTSRT S GMTSI=0
"RTN","GMTSADH5",118,0)
 F  S GMTSI=$O(^LAB(60,GMTSTEST,2,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSADH5",119,0)
 . S GMTSJ=+$G(^LAB(60,GMTSTEST,2,+GMTSI,0))
"RTN","GMTSADH5",120,0)
 . S GMTSRT=$G(^LAB(60,+GMTSJ,0))
"RTN","GMTSADH5",121,0)
 . I $L($P(GMTSRT,U,5)),("BO"[$P(GMTSRT,U,3)) D
"RTN","GMTSADH5",122,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",123,0)
 . . S Y(GMTSCNT)=+GMTSJ_"^"_GMTSRT
"RTN","GMTSADH5",124,0)
 . E  D
"RTN","GMTSADH5",125,0)
 . . D COMPILE(+$G(^LAB(60,GMTSTEST,2,GMTSI,0)),GMTSCNT)
"RTN","GMTSADH5",126,0)
 Q
"RTN","GMTSALG")
0^13^B27110366
"RTN","GMTSALG",1,0)
GMTSALG ; SLC/DLT,KER - Allergies ; 02/27/2002
"RTN","GMTSALG",2,0)
 ;;2.7;Health Summary;**9,28,49**;Oct 20, 1995
"RTN","GMTSALG",3,0)
 ;                 
"RTN","GMTSALG",4,0)
 ; External References
"RTN","GMTSALG",5,0)
 ;   DBIA 10096  ^%ZOSF("TEST"
"RTN","GMTSALG",6,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSALG",7,0)
 ;   DBIA   905  ^GMR(120.8
"RTN","GMTSALG",8,0)
 ;   DBIA  2056  $$GET1^DIQ (file #120.86 and #200)
"RTN","GMTSALG",9,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSALG",10,0)
 ;   DBIA 10099  EN1^GMRADPT 
"RTN","GMTSALG",11,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSALG",12,0)
 ;   DBIA  3449  ^GMR(120.86,
"RTN","GMTSALG",13,0)
 ;                   
"RTN","GMTSALG",14,0)
ALLRG ; Allergies
"RTN","GMTSALG",15,0)
 N X,GMTSALAS,GMTSALAD,GMTSALAW,GMTSAV,GMTSAFN,GMRAL,GMTSAL,GMTSALNM
"RTN","GMTSALG",16,0)
 N GMTSCNT,GMTSEACT,GMTSLN,GMTSMECH,GMTSPRT,GMTSTY,CC,C,KK,ALLRG
"RTN","GMTSALG",17,0)
 N TITLE,JJ K GMTSA S (SEQ,ALLRG)=0,TITLE="ALLERGY/ADVERSE REACTION (AR)"
"RTN","GMTSALG",18,0)
 S X="GMRADPT" X ^%ZOSF("TEST")
"RTN","GMTSALG",19,0)
 I $T D  Q:$D(GMTSQIT)
"RTN","GMTSALG",20,0)
 . D GETALLRG D:ALLRG TITLE,ALLRGP D:'ALLRG&($L($G(GMTSALAS))) TITLE,NKA
"RTN","GMTSALG",21,0)
 I 'ALLRG,'$L($G(GMTSALAS)) D
"RTN","GMTSALG",22,0)
 . I $D(GMTSPNF)&('ALLRG) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Unknown, please evaluate",!
"RTN","GMTSALG",23,0)
 K ALL,CC,CCC,CD,DIWF,DIWL,DIWR,GMTSALF,GMTSALNM,GMTSNODE,GMTSPRT,I,II,JJ,KK,L,M,MX,N,Z,X,SEQ,GMTSA,ALLRG,TITLE,GMRA,GMRAL,GMTSEACT,GMTSMECH,GMTSTY,GMTSPFN,GMTSAL,GMTSCNT,GMTSLN,ODT
"RTN","GMTSALG",24,0)
 Q
"RTN","GMTSALG",25,0)
ALLRGP ; Allergy Print
"RTN","GMTSALG",26,0)
 S II="" F  S II=$O(GMTSAL(II)) Q:II']""  I $O(GMTSAL(II,""))]"" D
"RTN","GMTSALG",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?2,$S(II="D":"Drug:",II="DF":"Drug/Food:",II="DFO":"Drug/Food/Other:",II="DO":"Drug/Other:",II="F":"Food:",II="FO":"Food/Other:",II="O":"Other:",1:II_":")
"RTN","GMTSALG",28,0)
 . S JJ="" F  S JJ=$O(GMTSAL(II,JJ)) Q:JJ=""  D
"RTN","GMTSALG",29,0)
 .. N WKK S KK=""  F  S KK=$O(GMTSAL(II,JJ,KK)) Q:KK=""  D
"RTN","GMTSALG",30,0)
 ... S L=0 F  S L=$O(GMTSAL(II,JJ,KK,L)) Q:'L  D CKP^GMTSUP Q:$D(GMTSQIT)  D AUTOV W !?5,JJ_": " S:$L(KK)>30 WKK=KK,WKK=$$WRAP^GMTSORC(WKK,30) W ?24,$S($L(KK)>30:$P(WKK,"|"),1:KK) D
"RTN","GMTSALG",31,0)
 .... I GMTSAV=1 W " (AV"
"RTN","GMTSALG",32,0)
 .... E  W $S($P(GMTSAL(II,JJ,KK,L),U,5)=1:" (V",$P(GMTSAL(II,JJ,KK,L),U,5)=0:" (NV",1:"")
"RTN","GMTSALG",33,0)
 .... W $S($P($G(^GMR(120.8,GMTSALNM,0)),U,6)="h":"/Historical)",$P($G(^(0)),U,6)="o":"/Observed)",1:")")
"RTN","GMTSALG",34,0)
 .... I $L($P($G(WKK),"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,$P(WKK,"|",2)
"RTN","GMTSALG",35,0)
 .... S (M,MX,ALL)=0 F  S M=$O(GMTSAL(II,JJ,KK,L,"S",M)) Q:M=""  D  Q:$D(GMTSQIT)
"RTN","GMTSALG",36,0)
 ..... I ALL=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27
"RTN","GMTSALG",37,0)
 ..... S MX=MX+1
"RTN","GMTSALG",38,0)
 ..... W:MX>1 ", "
"RTN","GMTSALG",39,0)
 ..... S N=$P(GMTSAL(II,JJ,KK,L,"S",M),";")
"RTN","GMTSALG",40,0)
 ..... S ALL=1 I (74)'>($X+$L(N)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,N Q
"RTN","GMTSALG",41,0)
 ..... S ALL=1 W N
"RTN","GMTSALG",42,0)
 .... D SIGBLK($P(GMTSAFN,U,5))
"RTN","GMTSALG",43,0)
 .... D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,"Date/Time:  " S ODT=$P(GMTSAFN,U,4) S X=ODT D REGDTM4^GMTSU W X,!
"RTN","GMTSALG",44,0)
 ....S CC="" F  S CC=$O(^GMR(120.8,GMTSALNM,26,"B",CC)) Q:CC=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,"Comments at: " S X=CC D REGDTM4^GMTSU S CD=X S CCC=0 F  S CCC=$O(^GMR(120.8,GMTSALNM,26,"B",CC,CCC)) Q:'CCC  D TEXT
"RTN","GMTSALG",45,0)
 Q
"RTN","GMTSALG",46,0)
NKA ; No known allergies
"RTN","GMTSALG",47,0)
 W:$L($G(GMTSALAS))!($L($G(GMTSALAD))) ! W:$L($G(GMTSALAS)) ?24,$G(GMTSALAS),!
"RTN","GMTSALG",48,0)
 W:$L($G(GMTSALAS))!($L($G(GMTSALAD)))!($L($G(GMTSALAW))) ?24,"Assessment date:   ",$G(GMTSALAD),! W:$L($G(GMTSALAW)) ?24,"Assessed by:       ",GMTSALAW,!
"RTN","GMTSALG",49,0)
 Q
"RTN","GMTSALG",50,0)
GETALLRG ; Get Allergies
"RTN","GMTSALG",51,0)
 S GMRA="0^0^111" D EN1^GMRADPT I GMRAL="" S ALLRG=0 Q
"RTN","GMTSALG",52,0)
 I +($G(DFN))>0,+($G(GMRAL))=0 D ALLAS S ALLRG=0 Q
"RTN","GMTSALG",53,0)
 I $D(GMRAL)>9 D
"RTN","GMTSALG",54,0)
 . S I=0 F GMTSCNT=1:1 S I=$O(GMRAL(I)) Q:'I  D
"RTN","GMTSALG",55,0)
 .. S GMTSTY=$P(GMRAL(I),U,7) Q:GMTSTY']""
"RTN","GMTSALG",56,0)
 .. S GMTSEACT=$P(GMRAL(I),U,2) Q:GMTSEACT']""
"RTN","GMTSALG",57,0)
 .. S GMTSMECH=$P($P(GMRAL(I),U,8),";")
"RTN","GMTSALG",58,0)
 .. S:GMTSMECH']"" GMTSMECH="UNKNOWN"
"RTN","GMTSALG",59,0)
 .. S GMTSAL(GMTSTY,GMTSMECH,GMTSEACT,GMTSCNT)=I_"^"_GMRAL(I)
"RTN","GMTSALG",60,0)
 .. S JJ=0 F  S JJ=$O(GMRAL(I,"S",JJ)) Q:'JJ  S GMTSAL(GMTSTY,GMTSMECH,GMTSEACT,GMTSCNT,"S",JJ)=GMRAL(I,"S",JJ)
"RTN","GMTSALG",61,0)
 .. S ALLRG=1
"RTN","GMTSALG",62,0)
 Q
"RTN","GMTSALG",63,0)
ALLAS ; Allergy Assessment
"RTN","GMTSALG",64,0)
 N X,GMTSALG1,GMTSALG2,GMTSALG3 S (GMTSALAS,GMTSALAD,GMTSALAW)="" S GMTSALAS="No known allergies"
"RTN","GMTSALG",65,0)
 S GMTSALAD=$$GET1^DIQ(120.86,+($G(DFN)),3,"I",,"GMTSALG2") S:$D(GMTSALG2) GMTSALAD="" S:+GMTSALAD=0 GMTSALAD=""
"RTN","GMTSALG",66,0)
 I +GMTSALAD>0 S X=GMTSALAD D REGDT4^GMTSU S GMTSALAD=X
"RTN","GMTSALG",67,0)
 S GMTSALAW=$$GET1^DIQ(120.86,+($G(DFN)),2,"E",,"GMTSALG3") S:$D(GMTSALG3) GMTSALAW=""
"RTN","GMTSALG",68,0)
 Q
"RTN","GMTSALG",69,0)
AUTOV ; Autoverify
"RTN","GMTSALG",70,0)
 S GMTSAV=0,GMTSALNM=$P(GMTSAL(II,JJ,KK,L),U),GMTSAFN=$G(^GMR(120.8,GMTSALNM,0))
"RTN","GMTSALG",71,0)
 I $P(GMTSAFN,U,18)="",$P(GMTSAFN,U,16)=1 S GMTSAV=1
"RTN","GMTSALG",72,0)
 Q
"RTN","GMTSALG",73,0)
TITLE ; Print title
"RTN","GMTSALG",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSALG",75,0)
 I $D(GMTSPNF) W ?21,TITLE,!
"RTN","GMTSALG",76,0)
 E  W ?21,"Title: ",TITLE,!
"RTN","GMTSALG",77,0)
 Q
"RTN","GMTSALG",78,0)
TEXT ; Setup for print of allergy comments
"RTN","GMTSALG",79,0)
 W ?31,CD D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSALG",80,0)
 K ^UTILITY($J,"W") S GMTSLN=0 F  S GMTSLN=$O(^GMR(120.8,GMTSALNM,26,CCC,2,GMTSLN)) Q:'GMTSLN  S GMTSPRT=^GMR(120.8,GMTSALNM,26,CCC,2,GMTSLN,0) D FORMAT
"RTN","GMTSALG",81,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSALG",82,0)
 K ^UTILITY($J,"W")
"RTN","GMTSALG",83,0)
 Q:'GMTSLN
"RTN","GMTSALG",84,0)
 W ! Q
"RTN","GMTSALG",85,0)
FORMAT ; Formats each line
"RTN","GMTSALG",86,0)
 S DIWL=3,DIWR=80,DIWF="C58",X=GMTSPRT D ^DIWP
"RTN","GMTSALG",87,0)
 Q
"RTN","GMTSALG",88,0)
LINE ; Writes formatted lines of text
"RTN","GMTSALG",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,^UTILITY($J,"W",DIWL,GMTSLN,0)
"RTN","GMTSALG",90,0)
 Q
"RTN","GMTSALG",91,0)
SIGBLK(GMTSALF) ; Signature block
"RTN","GMTSALG",92,0)
 Q:+GMTSALF'>0  N GMTSSB,GMTSST,GMTSSN S GMTSSB=$$GET1^DIQ(200,(+GMTSALF_","),20.2),GMTSST=$$GET1^DIQ(200,(+GMTSALF_","),20.3),GMTSSN=$$GET1^DIQ(200,(+GMTSALF_","),.01)
"RTN","GMTSALG",93,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!,?24,"Originator: ",$S(GMTSSB'="":GMTSSB,1:GMTSSN)
"RTN","GMTSALG",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$L(GMTSST) !,?24,"Title:      ",GMTSST
"RTN","GMTSALG",95,0)
 Q
"RTN","GMTSALGB")
0^12^B2168882
"RTN","GMTSALGB",1,0)
GMTSALGB ; SLC/DLT,KER - Brief Adverse Reaction/Allergy ; 02/27/2002
"RTN","GMTSALGB",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSALGB",3,0)
 ;                 
"RTN","GMTSALGB",4,0)
 ; External References
"RTN","GMTSALGB",5,0)
 ;   DBIA 10096  ^%ZOSF("TEST"
"RTN","GMTSALGB",6,0)
 ;   DBIA 10099  EN1^GMRADPT 
"RTN","GMTSALGB",7,0)
 ;                   
"RTN","GMTSALGB",8,0)
ALLRG ; Allergies
"RTN","GMTSALGB",9,0)
 N I,Z,X,SEQ,GMTSA,ALLRG K GMTSA S (SEQ,ALLRG)=0 S X="GMRADPT" X ^%ZOSF("TEST")
"RTN","GMTSALGB",10,0)
 I $T D  Q:$D(GMTSQIT)
"RTN","GMTSALGB",11,0)
 . D GETALLRG I ALLRG D
"RTN","GMTSALGB",12,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Allergy/Reaction: " D ALLRGP
"RTN","GMTSALGB",13,0)
 Q
"RTN","GMTSALGB",14,0)
ALLRGP ; Allergy Print
"RTN","GMTSALGB",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21 S X=0
"RTN","GMTSALGB",16,0)
 F I=0:0 S I=$O(GMTSA(I)) Q:I=""  D  Q:$D(GMTSQIT)
"RTN","GMTSALGB",17,0)
 . S X=X+1 W:X>1 ", " W:(77)'>($X+$L(GMTSA(I))) !
"RTN","GMTSALGB",18,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W GMTSA(I)
"RTN","GMTSALGB",19,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSALGB",20,0)
GETALLRG ; Get Allergies
"RTN","GMTSALGB",21,0)
 N GMI,GMJ,GMRAL D EN1^GMRADPT I GMRAL="" S ALLRG=0 Q
"RTN","GMTSALGB",22,0)
 I GMRAL="0" S ALLRG=1,GMTSA(1)="No Known Allergies" Q
"RTN","GMTSALGB",23,0)
 S ALLRG=1,GMI=0 F  S GMI=$O(GMRAL(GMI)) Q:GMI'>0  D
"RTN","GMTSALGB",24,0)
 . S GMTSA(GMI)=$P(GMRAL(GMI),U,2)
"RTN","GMTSALGB",25,0)
 . S GMJ=0 F  S GMJ=$O(GMTSA(GMJ)) Q:GMJ'>0  I GMI'=GMJ,(GMTSA(GMI)=$G(GMTSA(GMJ))) K GMTSA(GMI) Q
"RTN","GMTSALGB",26,0)
 Q
"RTN","GMTSAMIE")
0^14^B4262183
"RTN","GMTSAMIE",1,0)
GMTSAMIE ; SLC/KER - Comp and Pension Exams ; 02/27/2002
"RTN","GMTSAMIE",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSAMIE",3,0)
 ;                   
"RTN","GMTSAMIE",4,0)
 ; External References
"RTN","GMTSAMIE",5,0)
 ;   DBIA  1138  HSCP^DVBCHS0
"RTN","GMTSAMIE",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSAMIE",7,0)
 ;   DBIA 10029  ^DIWW
"RTN","GMTSAMIE",8,0)
 ;                   
"RTN","GMTSAMIE",9,0)
MAIN ; Control branching
"RTN","GMTSAMIE",10,0)
 N GMDATE,GMEXAM,GMCNT,GMTSREC,DIWL,DIWR,DIWF,NODE,LINE,MAX
"RTN","GMTSAMIE",11,0)
 S DIWL=1,DIWR=80,DIWF="W" K ^TMP("DVBC",$J)
"RTN","GMTSAMIE",12,0)
 D HSCP^DVBCHS0(DFN,GMTS2,GMTS1,2) Q:'$D(^TMP("DVBC",$J))
"RTN","GMTSAMIE",13,0)
 S (GMDATE,GMCNT)=0,MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999)
"RTN","GMTSAMIE",14,0)
 F  S GMDATE=$O(^TMP("DVBC",$J,GMDATE)) Q:+GMDATE'>0!(GMCNT'<MAX)  D
"RTN","GMTSAMIE",15,0)
 . S GMEXAM=""
"RTN","GMTSAMIE",16,0)
 . F  S GMEXAM=$O(^TMP("DVBC",$J,GMDATE,GMEXAM)) Q:GMEXAM']""!(GMCNT'<MAX)  D WRT
"RTN","GMTSAMIE",17,0)
 K ^TMP("DVBC",$J)
"RTN","GMTSAMIE",18,0)
 Q
"RTN","GMTSAMIE",19,0)
WRT ; Writes exam data
"RTN","GMTSAMIE",20,0)
 S GMCNT=GMCNT+1
"RTN","GMTSAMIE",21,0)
 N EXAM,PRI,PHY,EXAMDATE,X
"RTN","GMTSAMIE",22,0)
 S NODE=$G(^TMP("DVBC",$J,GMDATE,GMEXAM,0))
"RTN","GMTSAMIE",23,0)
 S X=$P(NODE,U,2) D REGDT4^GMTSU S EXAMDATE=X
"RTN","GMTSAMIE",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W EXAMDATE,?15,$P(NODE,U,3),!
"RTN","GMTSAMIE",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Priority of Exam: ",$E($P(NODE,U,5),1,20),!
"RTN","GMTSAMIE",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Examining provider: ",$P(NODE,U,4),!
"RTN","GMTSAMIE",27,0)
 S NODE=$G(^TMP("DVBC",$J,GMDATE,GMEXAM,2))
"RTN","GMTSAMIE",28,0)
 S X=$P(NODE,U,3) D REGDT4^GMTSU
"RTN","GMTSAMIE",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSAMIE",30,0)
 W ?8,"Approved By: ",$P(NODE,U,2)," on ",X,!
"RTN","GMTSAMIE",31,0)
 K ^UTILITY($J,"W")
"RTN","GMTSAMIE",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Examination results: ",!
"RTN","GMTSAMIE",33,0)
 S LINE=0
"RTN","GMTSAMIE",34,0)
 F  S LINE=$O(^TMP("DVBC",$J,GMDATE,GMEXAM,"RES",LINE)) Q:'LINE  S X=^(LINE) D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWP
"RTN","GMTSAMIE",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWW
"RTN","GMTSAMIE",36,0)
 I +$O(^TMP("DVBC",$J,GMDATE,GMEXAM))!+$O(^TMP("DVBC",$J,GMDATE)) D
"RTN","GMTSAMIE",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSAMIE",38,0)
 Q
"RTN","GMTSCI")
0^41^B1113715
"RTN","GMTSCI",1,0)
GMTSCI ; SLC/MKB,KER - Health Summary Component Inquiry ; 02/27/2002
"RTN","GMTSCI",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSCI",3,0)
 ;
"RTN","GMTSCI",4,0)
 ; External References
"RTN","GMTSCI",5,0)
 ;   DBIA 10010  EN1^DIP
"RTN","GMTSCI",6,0)
 ;                 
"RTN","GMTSCI",7,0)
EN ; Display a Health Summary Component
"RTN","GMTSCI",8,0)
 S U="^",DIC="^GMT(142.1,",DIC(0)="AEMQ",DIC("A")="Select Health Summary Component Name: " D ^DIC K DIC("A") G:Y=-1 END S (FR,TO)=$P(Y,U,2),GMTSY=+Y
"RTN","GMTSCI",9,0)
 S BY=".01",DHD="[GMTS COMP INQ HEADER]",FLDS="[GMTS COMP INQ]",L=0 D EN1^DIP K GMTSY
"RTN","GMTSCI",10,0)
END ; Quit
"RTN","GMTSCI",11,0)
 Q
"RTN","GMTSCM")
0^15^B13180749
"RTN","GMTSCM",1,0)
GMTSCM ; SLC/JER,KER - Create/Modify Health Summary Comp ; 02/27/2002
"RTN","GMTSCM",2,0)
 ;;2.7;Health Summary;**7,30,49**;Oct 20, 1995
"RTN","GMTSCM",3,0)
 ;
"RTN","GMTSCM",4,0)
 ; External References
"RTN","GMTSCM",5,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSCM",6,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSCM",7,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSCM",8,0)
 ;   DBIA 10018  ^DIE
"RTN","GMTSCM",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSCM",10,0)
 ;   DBIA    82  EN^XQORM
"RTN","GMTSCM",11,0)
 ;                 
"RTN","GMTSCM",12,0)
MAIN ; Controls branching
"RTN","GMTSCM",13,0)
 N %,C,D,D0,GMCMP,GMTSQIT,X,Y,DIRUT
"RTN","GMTSCM",14,0)
 I +$G(DUZ(2))'>0 W !,"DUZ(2) must be set to your division.",! Q
"RTN","GMTSCM",15,0)
 F  D  Q:$D(GMTSQIT)
"RTN","GMTSCM",16,0)
 . N DA,DIC,DIE,DR,GMCMP,X,Y,GMDA,DLAYGO,DIDEL,GMSITE
"RTN","GMTSCM",17,0)
 . S GMSITE=$P($$SITE^VASITE(),U,3)
"RTN","GMTSCM",18,0)
 . S:GMSITE'>0 GMSITE=DUZ(2)
"RTN","GMTSCM",19,0)
 . S:+$P($G(^GMT(142.1,0)),U,3)'>100000 $P(^GMT(142.1,0),U,3)=GMSITE_"000"
"RTN","GMTSCM",20,0)
 . S DIC=142.1,DIC(0)="AEMQLZ",DIC("A")="Select COMPONENT: "
"RTN","GMTSCM",21,0)
 . S DIC("S")="I $S(DUZ(2)=5000:1,(+$G(Y)'<100001)&(+$G(Y)'>9999999):1,1:0)"
"RTN","GMTSCM",22,0)
 . S DLAYGO=142.1
"RTN","GMTSCM",23,0)
 . D ^DIC I +Y'>0 S GMTSQIT="" Q
"RTN","GMTSCM",24,0)
 . S GMDA=+Y
"RTN","GMTSCM",25,0)
 . I +$P(Y,U,3) S GMCMP(0)=$P(Y,U,2) D COPY(.GMCMP)
"RTN","GMTSCM",26,0)
 . S DIDEL=142.1
"RTN","GMTSCM",27,0)
 . I $D(GMCMP)=11 S GMCMP=+GMDA D  Q
"RTN","GMTSCM",28,0)
 . . I $D(GMCMP(3.5))>9 D
"RTN","GMTSCM",29,0)
 . . . N %X,%Y
"RTN","GMTSCM",30,0)
 . . . S %X="GMCMP(3.5,",%Y="^GMT(142.1,"_+GMDA_",3.5," D %XY^%RCR
"RTN","GMTSCM",31,0)
 . . S DIE="^GMT(142.1,",DA=+GMDA
"RTN","GMTSCM",32,0)
 . . S DR=".01;1///^S X=$P(GMCMP(0),U,2);2///"_$P(GMCMP(0),U,3)_";4///"_$P(GMCMP(0),U,5)_";6///"_$P(GMCMP(0),U,7)_";10///"_$P(GMCMP(0),U,10)_";11///"_$P(GMCMP(0),U,11)_";12///"_$P(GMCMP(0),U,12)
"RTN","GMTSCM",33,0)
 . . S DR=DR_";3;3.5;I X=""^""!(X=""^^"") S DIRUT=1,Y=""@1"";1;2;4;10;11;12;6;9;@1"
"RTN","GMTSCM",34,0)
 . . D ^DIE I $D(Y)>9!($D(DIRUT))!'$D(DA) S GMTSQIT="" Q
"RTN","GMTSCM",35,0)
 . . I $D(GMCMP("SEL")) D
"RTN","GMTSCM",36,0)
 . . . S DIE="^GMT(142.1,"_+DA_",1,",DA(1)=DA,DA=1,DR=".01///"_$P(GMCMP("SEL"),U)_";1///"_$P(GMCMP("SEL"),U,2) S:'$D(@(DIE_"0)")) ^(0)="^142.17P^^" D ^DIE  I $D(Y)>9 S GMTSQIT="" Q
"RTN","GMTSCM",37,0)
 . . S DIE="^GMT(142.1,",(GMCMP,DA)=+GMDA,DR=7
"RTN","GMTSCM",38,0)
 . . D ^DIE I $D(Y)>9!($D(DIRUT)) S GMTSQIT="" Q
"RTN","GMTSCM",39,0)
 . . I $D(DA) D  Q
"RTN","GMTSCM",40,0)
 . . . W ! I $$ADHOC D ENADHOC^GMTSRM W !!,">>> Returning to Create/Modify Health Summary Component Option.",!
"RTN","GMTSCM",41,0)
 . S DIE="^GMT(142.1,",(GMCMP,DA)=+GMDA,DR=".01;1;3;3.5;I X=""^""!(X=""^^"") S DIRUT=1,Y=""@1"";2;4;10;11;12;6;9;7;@1"
"RTN","GMTSCM",42,0)
 . D ^DIE I $D(Y)>9!($D(DIRUT)) S GMTSQIT="" Q
"RTN","GMTSCM",43,0)
 . I $D(DA) D  Q
"RTN","GMTSCM",44,0)
 . . W ! I $$ADHOC,'$D(DIRUT) D ENADHOC^GMTSRM W !!,">>> Returning to Create/Modify Health Summary Component Option.",!
"RTN","GMTSCM",45,0)
 . . I $D(DIRUT) S GMTSQIT="" Q
"RTN","GMTSCM",46,0)
 . D CLEANUP^GMTSDD
"RTN","GMTSCM",47,0)
 Q
"RTN","GMTSCM",48,0)
COPY(GMCMP) ; Duplicate existing Health Summary Component
"RTN","GMTSCM",49,0)
 N %,DIC,DIR,GMI,I,X,XQORM,XQORSPEW,Y
"RTN","GMTSCM",50,0)
 S DIR(0)="Y",DIR("A")="Do you wish to duplicate an existing COMPONENT"
"RTN","GMTSCM",51,0)
 S DIR("B")="YES" D ^DIR Q:+Y'>0
"RTN","GMTSCM",52,0)
 S DIC=142,DIC(0)="XF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT Q:+Y'>0
"RTN","GMTSCM",53,0)
 S XQORM=+Y_";GMT(142,",XQORM(0)="1AD",XQORM("A")="Enter COMPONENT to Duplicate: "
"RTN","GMTSCM",54,0)
 W ! D EN^XQORM Q:+Y'>0
"RTN","GMTSCM",55,0)
 S GMCMP=+$P($G(^GMT(142,+XQORM,1,+Y(1),0)),U,2)
"RTN","GMTSCM",56,0)
 S GMCMP(0)=GMCMP(0)_U_$P($G(^GMT(142.1,+GMCMP,0)),U,2,12)
"RTN","GMTSCM",57,0)
 I $O(^GMT(142.1,+GMCMP,3.5,0)) D
"RTN","GMTSCM",58,0)
 . S GMCMP(3.5,0)=$G(^GMT(142.1,+GMCMP,3.5,0))
"RTN","GMTSCM",59,0)
 . S GMI=0 F  S GMI=$O(^GMT(142.1,+GMCMP,3.5,GMI)) Q:+GMI'>0  D
"RTN","GMTSCM",60,0)
 . . S GMCMP(3.5,GMI,0)=$G(^(GMI,0))
"RTN","GMTSCM",61,0)
 I $O(^GMT(142.1,+GMCMP,1,0)) S GMCMP("SEL")=$G(^GMT(142.1,+GMCMP,1,$O(^(0)),0))
"RTN","GMTSCM",62,0)
 Q
"RTN","GMTSCM",63,0)
ADHOC() ; Ask user whether or not to ADD new component to AD HOC
"RTN","GMTSCM",64,0)
 N %,DIR,X,Y
"RTN","GMTSCM",65,0)
 S DIR(0)="Y",DIR("A")="ADD new Component to the AD HOC Health Summary"
"RTN","GMTSCM",66,0)
 S DIR("B")="NO" D ^DIR
"RTN","GMTSCM",67,0)
 Q Y
"RTN","GMTSDA")
0^33^B6844814
"RTN","GMTSDA",1,0)
GMTSDA ; SLC/DLT,KER/NDBI - Appointments ; 02/27/2002
"RTN","GMTSDA",2,0)
 ;;2.7;Health Summary;**5,19,28,49**;Oct 20, 1995
"RTN","GMTSDA",3,0)
 ;               
"RTN","GMTSDA",4,0)
 ; External Reference
"RTN","GMTSDA",5,0)
 ;   DBIA  1024  ^DIC(40.7
"RTN","GMTSDA",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSDA",7,0)
 ;   DBIA  2065  ^SCE(
"RTN","GMTSDA",8,0)
 ;   DBIA  2065  ^SCE("ADFN"
"RTN","GMTSDA",9,0)
 ;   DBIA  2929  CVP^A7RHSM
"RTN","GMTSDA",10,0)
 ;   DBIA 10061  SDA^VADPT
"RTN","GMTSDA",11,0)
 ;                   
"RTN","GMTSDA",12,0)
PAST ; Gets Patient's Past Appointments for date range
"RTN","GMTSDA",13,0)
 N GMDT,GMIDT,MAX S X=1
"RTN","GMTSDA",14,0)
 S VASD("F")=$S(GMTSBEG=1:2560101,1:GMTSBEG),VASD("T")=$S(GMTS1=6666666:DT,1:9999999-GMTS1)
"RTN","GMTSDA",15,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",16,0)
 S VASD("W")=123456789 D SDA^VADPT
"RTN","GMTSDA",17,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),^UTILITY("GMTSVASD",$J,9999999-ADATE)=ADATE_U_$P(^UTILITY("VASD",$J,Y,"E"),U,2,99)
"RTN","GMTSDA",18,0)
 S GMDT=VASD("F")
"RTN","GMTSDA",19,0)
 F  S GMDT=$O(^SCE("ADFN",DFN,GMDT)) Q:GMDT'>0!(GMDT>VASD("T"))  D
"RTN","GMTSDA",20,0)
 . S GMI=0 F  S GMI=$O(^SCE("ADFN",DFN,GMDT,GMI)) Q:GMI'>0  D
"RTN","GMTSDA",21,0)
 . . S GMIDT=9999999-GMDT
"RTN","GMTSDA",22,0)
 . . I '$D(^UTILITY("GMTSVASD",$J,GMIDT)) D
"RTN","GMTSDA",23,0)
 . . . Q:$P($G(^SCE(GMI,0)),U,6)'=""
"RTN","GMTSDA",24,0)
 . . . I $P($G(^SCE(GMI,0)),U,4) Q:$P($G(^SC($P(^SCE(GMI,0),U,4),"OOS")),U)
"RTN","GMTSDA",25,0)
 . . . S ^UTILITY("GMTSVASD",$J,GMIDT)=GMDT_U_$S(+$P(^SCE(GMI,0),U,4):$P($G(^SC(+$P(^(0),U,4),0)),U),1:$P($G(^DIC(40.7,$P(^SCE(GMI,0),U,3),0)),U))_U_"UNSCHEDULED"
"RTN","GMTSDA",26,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CVP^A7RHSM
"RTN","GMTSDA",27,0)
 I '$D(^UTILITY("GMTSVASD",$J)) D END Q
"RTN","GMTSDA",28,0)
 S IDATE="",YCNT=0
"RTN","GMTSDA",29,0)
 F  S IDATE=$O(^UTILITY("GMTSVASD",$J,IDATE)) Q:+IDATE'>0!(YCNT=MAX)  D
"RTN","GMTSDA",30,0)
 . S ADATE=+^(IDATE),ADATE(0)=^(IDATE) D PRINT S YCNT=YCNT+1
"RTN","GMTSDA",31,0)
 D END Q
"RTN","GMTSDA",32,0)
FUTURE ; Gets Patient's Future Appointments 
"RTN","GMTSDA",33,0)
 D SDA^VADPT N MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",34,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),ADATE(0)=^UTILITY("VASD",$J,Y,"E") D PRINT Q:YCNT=MAX
"RTN","GMTSDA",35,0)
 D END Q
"RTN","GMTSDA",36,0)
PRINT ; Output
"RTN","GMTSDA",37,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S X=ADATE D REGDTM4^GMTSU,CKP^GMTSUP
"RTN","GMTSDA",38,0)
 W X,?18,$E($P(ADATE(0),"^",2),1,25),?58,$E($P(ADATE(0),"^",3),1,21)
"RTN","GMTSDA",39,0)
 W ! Q
"RTN","GMTSDA",40,0)
END ; Clean-up and Quit
"RTN","GMTSDA",41,0)
 K %I,IDATE,IDATES,ADATE,VASD,X,Y,YCNT,Z,^UTILITY("VASD",$J),^UTILITY("GMTSVASD",$J) Q
"RTN","GMTSDCB")
0^43^B5775216
"RTN","GMTSDCB",1,0)
GMTSDCB ; SLC/TRS,KER - Brief Discharge ; 02/27/2002
"RTN","GMTSDCB",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDCB",3,0)
 ;                
"RTN","GMTSDCB",4,0)
 ; External References
"RTN","GMTSDCB",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSDCB",6,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDCB",7,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMTSDCB",8,0)
 ;   DBIA 10015  EN^DIQ1 (file #80 and #45)
"RTN","GMTSDCB",9,0)
 ;   DBIA  3145 ^DIC(42.4,
"RTN","GMTSDCB",10,0)
 ;   DBIA  3146 ^DIC(45.6,
"RTN","GMTSDCB",11,0)
 ;                     
"RTN","GMTSDCB",12,0)
ENDC ; Brief Discharge (no captions)
"RTN","GMTSDCB",13,0)
 S N="",ADM=GMTS1,GMC=0,LF=0
"RTN","GMTSDCB",14,0)
 I $D(GMTSNDM),(GMTSNDM>0) S CNTR=GMTSNDM
"RTN","GMTSDCB",15,0)
 E  S CNTR=100
"RTN","GMTSDCB",16,0)
 S T1=GMTSEND,T2=GMTSBEG
"RTN","GMTSDCB",17,0)
 F  S ADM=$O(^DPT(DFN,"DA","AA",ADM)) Q:'ADM!(ADM>GMTS2)  F  S N=$O(^DPT(DFN,"DA","AA",ADM,N)) Q:'N  D PROC I CNTR=0 Q
"RTN","GMTSDCB",18,0)
 D KILLADM Q
"RTN","GMTSDCB",19,0)
PROC ; Process Admissions
"RTN","GMTSDCB",20,0)
 S AD0=^DPT(DFN,"DA",N,0),PTF=$P(AD0,U,12)
"RTN","GMTSDCB",21,0)
 S CNTR=CNTR-1 I CNTR=0 Q
"RTN","GMTSDCB",22,0)
 I $S('PTF:1,1:'$D(^DGPT(PTF,70))) S GMC=-1 Q
"RTN","GMTSDCB",23,0)
 S:$D(^DGPT(PTF,70)) ICD=^DGPT(PTF,70)
"RTN","GMTSDCB",24,0)
 I $P(ICD,"^",1)="" S GMC=-1 Q
"RTN","GMTSDCB",25,0)
 S DATE=$P((ICD),"^",1) I (DATE'<T1)!(DATE'>T2) Q:GMC  S GMC=-1 Q
"RTN","GMTSDCB",26,0)
 S GMC=2 S X=DATE D REGDT4^GMTSU S XD=X
"RTN","GMTSDCB",27,0)
 I $P(ICD,U,10)'="" D
"RTN","GMTSDCB",28,0)
 . N DIC,DIQ,DR,DA,REC
"RTN","GMTSDCB",29,0)
 . S DIC=80,DA=$P(ICD,U,10),DIQ="REC(",DIQ(0)="IE",DR=".01;3"
"RTN","GMTSDCB",30,0)
 . D EN^DIQ1
"RTN","GMTSDCB",31,0)
 . Q:'$D(REC)
"RTN","GMTSDCB",32,0)
 . S DXL=REC(80,DA,3,"E")
"RTN","GMTSDCB",33,0)
 I $P((ICD),"^",2)'="" S BS=$P((ICD),"^",2),BS=$S($D(^DIC(42.4,BS,0)):^DIC(42.4,BS,0),1:"") S BDS=$S($P((BS),"^",2)'="":$P(BS,U,2),$P(BS,U,1)'="":$P(BS,U,1),1:"UNKNOWN")
"RTN","GMTSDCB",34,0)
 I $P(ICD,"^",3)'="" S DIC="^DGPT(",DR=72,DA=PTF,DIQ="ARRAY",DIQ(0)="E" D EN^DIQ1 S SDS=ARRAY(45,DA,72,"E")
"RTN","GMTSDCB",35,0)
 S DP=$S($P((ICD),"^",6)'="":$P(ICD,U,6),1:""),DP=$S(DP'="":^DIC(45.6,DP,0),1:"")
"RTN","GMTSDCB",36,0)
 S OT=$P(ICD,"^",4),OP=$S(OT=3:"NO",OT="":"UNKNOWN",1:"YES")
"RTN","GMTSDCB",37,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,XD,?21,SDS,!
"RTN","GMTSDCB",38,0)
 I $D(DXL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?15,"DXLS: ",DXL,!
"RTN","GMTSDCB",39,0)
 K DXL,BS,BDS,ICD,DATE
"RTN","GMTSDCB",40,0)
 Q
"RTN","GMTSDCB",41,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDCB",42,0)
 K END,TDT,HH,MM,TN,LF,DATE,AT,ITR,TRT,TI,TO,N,CNTR,BDS,SDS,GMC,ARRAY,DXL,TOM,TR,T1,T2,DATE,I,A,AD0,ADM,BS,D,DA,DP,DR,ICD,OP,OT,PTF,X,XD,DIQ,DIC
"RTN","GMTSDCB",43,0)
 Q
"RTN","GMTSDD")
0^44^B9949347
"RTN","GMTSDD",1,0)
GMTSDD ; SLC/KCM,KER - Health Summary DD calls ; 02/27/2002
"RTN","GMTSDD",2,0)
 ;;2.7;Health Summary;**7,49**;Oct 20, 1995
"RTN","GMTSDD",3,0)
 ;               
"RTN","GMTSDD",4,0)
 ; External References
"RTN","GMTSDD",5,0)
 ;   DBIA  2430  ^XUTL("XQORM")
"RTN","GMTSDD",6,0)
 ;   DBIA 10018  ^DIE (file #142)
"RTN","GMTSDD",7,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSDD",8,0)
 ;                     
"RTN","GMTSDD",9,0)
SET ; From: x-ref in 142,99      Entry: DA  Exit: DA
"RTN","GMTSDD",10,0)
 ;                     
"RTN","GMTSDD",11,0)
 ;   NOTE:  Lock ^XUTL("XQORM",XQORM) and 
"RTN","GMTSDD",12,0)
 ;          ^GMT(142,DA) before calling
"RTN","GMTSDD",13,0)
 ;                     
"RTN","GMTSDD",14,0)
 N I,J,X,X0,X1,COL,CCOL,IEN,ORD,ROW,TOT,GMNAME
"RTN","GMTSDD",15,0)
 I $D(^XUTL("XQORM",DA_";GMT(142,",0)),$D(^GMT(142,DA,99)),($P(^GMT(142,DA,99),"^",1)=$P(^XUTL("XQORM",DA_";GMT(142,",0),"^",1)) Q
"RTN","GMTSDD",16,0)
 K ^TMP("XQORM",$J) D KILL S TOT=0
"RTN","GMTSDD",17,0)
 S IEN=0 F  S IEN=$O(^GMT(142,DA,1,IEN)) Q:IEN'>0  I $D(^GMT(142,DA,1,IEN,0)) S X=^(0) I $D(^GMT(142.1,+$P(X,"^",2),0)),($P(^(0),"^",6)'="P"),($P(^(0),U,6)'="T") S TOT=TOT+1,GMNAME=$P($G(^(0)),U) D ORD
"RTN","GMTSDD",18,0)
 S COL=$S(TOT\2>20:3,1:2),X=TOT\COL S:TOT#COL X=X+1 S ROW=X,CCOL=.1,^XUTL("XQORM",DA_";GMT(142,","COL")=COL
"RTN","GMTSDD",19,0)
 S ORD="" F  S ORD=$O(^TMP("XQORM",$J,ORD)) Q:ORD=""  D
"RTN","GMTSDD",20,0)
 . S IEN=0 F  S IEN=$O(^TMP("XQORM",$J,ORD,IEN)) Q:+IEN'>0  S CCOL=$S((CCOL\1)'<ROW:1+($P(CCOL,".",2)/10)+.1,1:CCOL+1) D BILD
"RTN","GMTSDD",21,0)
 S X=$H,(^XUTL("XQORM",DA_";GMT(142,",0),^GMT(142,DA,99))=X
"RTN","GMTSDD",22,0)
 K ^TMP("XQORM",$J) Q
"RTN","GMTSDD",23,0)
ORD ; Summary Order
"RTN","GMTSDD",24,0)
 S ^TMP("XQORM",$J,GMNAME,IEN)=""
"RTN","GMTSDD",25,0)
 Q
"RTN","GMTSDD",26,0)
BILD ; Build XQORM array
"RTN","GMTSDD",27,0)
 S X0=^GMT(142,DA,1,IEN,0) Q:'$P(X0,"^",2)
"RTN","GMTSDD",28,0)
 S X1=^GMT(142.1,$P(X0,"^",2),0),X=$S($L($P(X0,U,5)):$P(X0,U,5),$L($P(X1,"^",9)):$P(X1,"^",9),1:$E($P(X1,"^",1),1,19))
"RTN","GMTSDD",29,0)
 F %=1:1:$L(X) I ",=;-"[$E(X,%) S X=$E(X,1,%-1)_" "_$E(X,%+1,999)
"RTN","GMTSDD",30,0)
 S ^XUTL("XQORM",DA_";GMT(142,",CCOL,0)=IEN_"^"_$P(X0,"^",1)_"^"_X_"^"_$P(X1,"^",4)
"RTN","GMTSDD",31,0)
 I $L(X) S X=$$UP^XLFSTR(X),^XUTL("XQORM",DA_";GMT(142,","B",X,CCOL)=""
"RTN","GMTSDD",32,0)
 S X=$P(X1,"^") I $L(X) S X=$$UP^XLFSTR(X),^XUTL("XQORM",DA_";GMT(142,","B",X,CCOL)=1
"RTN","GMTSDD",33,0)
 S X=$P(X1,"^",4) I $L(X) S X=$$UP^XLFSTR(X),^XUTL("XQORM",DA_";GMT(142,","B",X,CCOL)=1
"RTN","GMTSDD",34,0)
 Q
"RTN","GMTSDD",35,0)
KILL ; From: x-ref in 142,99       Entry: none   Exit: none
"RTN","GMTSDD",36,0)
 K ^XUTL("XQORM",DA_";GMT(142,")
"RTN","GMTSDD",37,0)
 Q
"RTN","GMTSDD",38,0)
REDO ; From: 142.1,.01 142.1,3     Entry: DA     Exit: DA
"RTN","GMTSDD",39,0)
 N I,X S X=$H S I=0
"RTN","GMTSDD",40,0)
 F  S I=$O(^GMT(142,"AE",DA,I)) Q:I'>0  D
"RTN","GMTSDD",41,0)
 . I $D(^GMT(142,I,99)) S $P(^(99),"^",1)=X
"RTN","GMTSDD",42,0)
 Q
"RTN","GMTSDD",43,0)
REDOX ; From: 142.01,.01 142.01,1   Entry: DA(1)  Exit: DA(1)
"RTN","GMTSDD",44,0)
 I $D(^GMT(142,DA(1),0)) S ^(99)=$H
"RTN","GMTSDD",45,0)
 Q
"RTN","GMTSDD",46,0)
CLEANUP ; Delete broken pointers from 142.01 to 142.1
"RTN","GMTSDD",47,0)
 N %,%Y,D0,DI,DIC,DIJ,DIKS,DISYS,DR,DIE,GMDA,GMI,GMJ,X,Y
"RTN","GMTSDD",48,0)
 S GMDA=+GMCMP,GMI=0 F  S GMI=$O(^GMT(142,"AE",GMDA,GMI)) Q:+GMI'>0  D
"RTN","GMTSDD",49,0)
 . W !,"Deleting pointers from the "_$P(^GMT(142,+GMI,0),U)_" Health Summary Type"
"RTN","GMTSDD",50,0)
 . S GMJ=0 F  S GMJ=$O(^GMT(142,"AE",GMDA,GMI,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSDD",51,0)
 . . S DIE="^GMT(142,"_GMI_",1,",DR=".01///@",DA=GMJ,DA(1)=GMI D ^DIE W "."
"RTN","GMTSDD",52,0)
 Q
"RTN","GMTSDD",53,0)
CHKNAME ; Called by input transform on ^DD(142.1,.01,0)
"RTN","GMTSDD",54,0)
 I $D(^GMT(142.1,"B",X)),($G(Y)=-1) D
"RTN","GMTSDD",55,0)
 . W "   Duplicate NAMES not allowed." K X
"RTN","GMTSDD",56,0)
 Q
"RTN","GMTSDD",57,0)
CHKRTN ; Called by input transform on ^DD(142.1,1,0)
"RTN","GMTSDD",58,0)
 I @("$L($T("_$P(X,";")_U_$P(X,";",2)_"))'>0") D
"RTN","GMTSDD",59,0)
 . W "   Nonexistent ENTRY POINT" K X
"RTN","GMTSDD",60,0)
 Q
"RTN","GMTSDD",61,0)
CHKNUM ; Called by input transform of ^DD(142.1,.001,0)
"RTN","GMTSDD",62,0)
 I $S('$D(DUZ(2)):0,$G(DUZ(2))'=5000:1,1:0) D
"RTN","GMTSDD",63,0)
 . I $S(X<100001:1,X>9999999:1,1:0) W "  # Out of Range" K X
"RTN","GMTSDD",64,0)
 Q
"RTN","GMTSDEM")
0^1^B14932792
"RTN","GMTSDEM",1,0)
GMTSDEM ; SLC/DLT,KER - Demographics ; 02/27/2002
"RTN","GMTSDEM",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDEM",3,0)
 ;                 
"RTN","GMTSDEM",4,0)
 ; External References
"RTN","GMTSDEM",5,0)
 ;   DBIA 10061  6^VADPT
"RTN","GMTSDEM",6,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM",7,0)
 ;   DBIA 10061  OPD^VADPT
"RTN","GMTSDEM",8,0)
 ;   DBIA 10061  SVC^VADPT
"RTN","GMTSDEM",9,0)
 ;   DBIA  2967  ^DIC(31,
"RTN","GMTSDEM",10,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEM",11,0)
 ;                     
"RTN","GMTSDEM",12,0)
DEMOG ; Demographic (VADPT)
"RTN","GMTSDEM",13,0)
 D 6^VADPT,SVC^VADPT,OAD^VADPT,OPD^VADPT
"RTN","GMTSDEM",14,0)
 D PRT,CD^GMTSDEMB(+($G(DFN))),END Q
"RTN","GMTSDEM",15,0)
PRT ; Print Demographic Data
"RTN","GMTSDEM",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEM",17,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEM",18,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEM",19,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", " W:VAPA(5)'="" $P(VAPA(5),"^",2),"  " W:VAPA(6)'="" VAPA(6) W:VAPA(7)'="" ?52," County:",?61,$P(VAPA(7),"^",2) W !
"RTN","GMTSDEM",20,0)
 I VADM(10)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Marital Status: ",?21,$P(VADM(10),"^",2)
"RTN","GMTSDEM",21,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEM",22,0)
 I VADM(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Religion: ",$P(VADM(9),"^",2)
"RTN","GMTSDEM",23,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEM",24,0)
 I VAPD(6)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Occupation: ",$P(VAPD(6),"^",1),!
"RTN","GMTSDEM",25,0)
 I $P(VAEL(2),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Period of Service: ",?21,$P(VAEL(2),"^",2),!
"RTN","GMTSDEM",26,0)
 I VASV(6) S GMI=6 D BOS
"RTN","GMTSDEM",27,0)
 I VASV(7) S GMI=7 D BOS
"RTN","GMTSDEM",28,0)
 I VASV(8) S GMI=8 D BOS
"RTN","GMTSDEM",29,0)
 D MORE Q
"RTN","GMTSDEM",30,0)
BOS ; Branch of Service
"RTN","GMTSDEM",31,0)
 S X=$P(VASV(GMI,4),U,1) D REGDT4^GMTSU S FROM=X
"RTN","GMTSDEM",32,0)
 S X=$P(VASV(GMI,5),U,1) D REGDT4^GMTSU S TO=X
"RTN","GMTSDEM",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI=6 ?2,"Branch of Service: " W ?21,$P(VASV(GMI,1),U,2)," ",FROM," TO ",TO,!
"RTN","GMTSDEM",34,0)
 Q
"RTN","GMTSDEM",35,0)
MORE ; Service Connected Disabilities
"RTN","GMTSDEM",36,0)
 I $P(VAEL(2),U) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,"Combat: ",$S(VASV(5):"Y",1:"N"),?56,"POW: ",$S(VASV(4):"Y",1:"N"),!
"RTN","GMTSDEM",37,0)
ELIG ; Eligibility
"RTN","GMTSDEM",38,0)
 I $P(VAEL(1),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2) W:VAEL(8)'="" ?52," Status: ",$P(VAEL(8),"^",2) W !
"RTN","GMTSDEM",39,0)
 I $O(VAEL(1,0)) S I=0 F Z=0:0 S I=$O(VAEL(1,I)) Q:I=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(VAEL(1,I),"^",2),!
"RTN","GMTSDEM",40,0)
SC ; Service Connected Percent
"RTN","GMTSDEM",41,0)
 I VAEL(3) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"S/C %: ",?21,$P(VAEL(3),"^",2),!
"RTN","GMTSDEM",42,0)
MT ; Means Test
"RTN","GMTSDEM",43,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2),!
"RTN","GMTSDEM",44,0)
ADR ; Address
"RTN","GMTSDEM",45,0)
 Q:VAOA(9)=""
"RTN","GMTSDEM",46,0)
 I VAOA(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"NOK: ",VAOA(9) W:VAOA(10)'="" ?51,"Relation: ",VAOA(10) W !
"RTN","GMTSDEM",47,0)
 I VAOA(1)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAOA(1)]"" ?21,VAOA(1) W:VAOA(8)'="" ?54,"Phone: ",VAOA(8) W !
"RTN","GMTSDEM",48,0)
 I VAOA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(2),!
"RTN","GMTSDEM",49,0)
 I VAOA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(3),!
"RTN","GMTSDEM",50,0)
 I VAOA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(4) W:VAOA(5) ", ",$P(VAOA(5),U,2) W:VAOA(6) "  ",VAOA(6) W !
"RTN","GMTSDEM",51,0)
 Q
"RTN","GMTSDEM",52,0)
IEN ; Ineligible for Care Data
"RTN","GMTSDEM",53,0)
 S X=$P(VAEL(5,1),U,1) D REGDT4^GMTSU
"RTN","GMTSDEM",54,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Ineligible date: ",X
"RTN","GMTSDEM",55,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Ineligible TWX source: ",$P(VAEL(5,2),U,2),"  ",VAEL(5,3),", ",$P(VAEL(5,4),U,2),!
"RTN","GMTSDEM",56,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAEL(5,5) VAEL(5,5) W:VAEL(5,6) " Reason: ",VAEL(5,6),!
"RTN","GMTSDEM",57,0)
 Q
"RTN","GMTSDEM",58,0)
SCDP ; Service Connected Diagnosis
"RTN","GMTSDEM",59,0)
 S SCD=^DPT(DFN,.372,IX,0)
"RTN","GMTSDEM",60,0)
 S SCDS=$S($P(SCD,"^",1):$P(^DIC(31,$P(SCD,"^",1),0),"^",1),1:"") S SCDP=$P(SCD,"^",2)_"% "_$S($P(SCD,"^",3):"SC",1:"")
"RTN","GMTSDEM",61,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"S/C Disabilities: ",SCDS,?61,SCDP,!
"RTN","GMTSDEM",62,0)
 Q
"RTN","GMTSDEM",63,0)
END ; Clean-up and quit
"RTN","GMTSDEM",64,0)
 K I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z Q
"RTN","GMTSDEMB")
0^2^B28762316
"RTN","GMTSDEMB",1,0)
GMTSDEMB ; SLC/DLT,KER - Brief Demographic Component  ; 02/27/2002
"RTN","GMTSDEMB",2,0)
 ;;2.7;Health Summary;**29,49**;Oct 20, 1995
"RTN","GMTSDEMB",3,0)
 ;                    
"RTN","GMTSDEMB",4,0)
 ; External References
"RTN","GMTSDEMB",5,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEMB",6,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEMB",7,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEMB",8,0)
 ;   DBIA  1252  $$OUTPTTM^SDUTL3
"RTN","GMTSDEMB",9,0)
 ;   DBIA  1252  $$OUTPTPR^SDUTL3
"RTN","GMTSDEMB",10,0)
 ;   DBIA  1252  $$OUTPTAP^SDUTL3
"RTN","GMTSDEMB",11,0)
 ;   DBIA  2990  TFL^VAFCTFU1
"RTN","GMTSDEMB",12,0)
 ;   DBIA  2171  $$LKUP^XUAF4
"RTN","GMTSDEMB",13,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSDEMB",14,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","GMTSDEMB",15,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4, #200 and #404.51)
"RTN","GMTSDEMB",16,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEMB",17,0)
 ;   DBIA 10090  ^DIC(4,
"RTN","GMTSDEMB",18,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSDEMB",19,0)
 ;   DBIA  2936  ^SCTM(404.51,
"RTN","GMTSDEMB",20,0)
 ;                  
"RTN","GMTSDEMB",21,0)
DEMOG ; Brief Demographics (VADPT)
"RTN","GMTSDEMB",22,0)
 N I,IX,VA,VAEL,VAPA,GMTSS,GMTSR D ELIG^VADPT,ADD^VADPT,DEM^VADPT
"RTN","GMTSDEMB",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEMB",24,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEMB",25,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEMB",26,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", ",$P(VAPA(5),"^",2),"  ",VAPA(6),!
"RTN","GMTSDEMB",27,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2)
"RTN","GMTSDEMB",28,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEMB",29,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2)
"RTN","GMTSDEMB",30,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEMB",31,0)
 D CD(DFN),SRC K I,IX,VA,VAEL,VAPA
"RTN","GMTSDEMB",32,0)
 Q
"RTN","GMTSDEMB",33,0)
CD(DFN) ; Clinical Demographics (PCMM)
"RTN","GMTSDEMB",34,0)
 N TF,PAT,TEAM,PROV,PHON,ATTN,TMPH,PRPH,PPGA,PPGD,ASPA,ASSP,ASPD,ASPH,ATPH,APGA,APGD S:+($G(DT))=0 DT=$$DT^XLFDT
"RTN","GMTSDEMB",35,0)
 S (TMPH,PRPH,PPGA,PPGD,ASPA,ASPD,ASPH,ATPH,APGA,APGD)=""
"RTN","GMTSDEMB",36,0)
 S TMPH="" S TEAM=$$OUTPTTM^SDUTL3(+($G(DFN))) S:+TEAM>0 TMPH=$$GET1^DIQ(404.51,(+($G(TEAM))_","),.02)
"RTN","GMTSDEMB",37,0)
 S PROV=$$OUTPTPR^SDUTL3(+($G(DFN))) I +PROV>0 D
"RTN","GMTSDEMB",38,0)
 . S PRPH=$$GET1^DIQ(200,(+($G(PROV))_","),.132),PPGA=$$GET1^DIQ(200,(+($G(PROV))_","),.137),PPGD=$$GET1^DIQ(200,(+($G(PROV))_","),.138)
"RTN","GMTSDEMB",39,0)
 S ASSP=$$OUTPTAP^SDUTL3(+($G(DFN))) I +ASSP>0&(+ASSP'=+PROV) D
"RTN","GMTSDEMB",40,0)
 . S ASSP=+ASSP_"^"_$$GET1^DIQ(200,(+($G(ASSP))_","),.01)
"RTN","GMTSDEMB",41,0)
 . S ASPH=$$GET1^DIQ(200,(+($G(ASSP))_","),.132),ASPA=$$GET1^DIQ(200,(+($G(ASSP))_","),.137),ASPD=$$GET1^DIQ(200,(+($G(ASSP))_","),.138)
"RTN","GMTSDEMB",42,0)
 S:(+ASSP=+PROV) (ASSP,ASPH,ASPA,ASPD)=""
"RTN","GMTSDEMB",43,0)
 S ATTN=$G(^DPT(+($G(DFN)),.1041)) I +ATTN>0 D
"RTN","GMTSDEMB",44,0)
 . S ATTN=+ATTN_"^"_$$GET1^DIQ(200,(+($G(ATTN))_","),.01)
"RTN","GMTSDEMB",45,0)
 . S ATPH=$$GET1^DIQ(200,(+($G(ATTN))_","),.132),APGA=$$GET1^DIQ(200,(+($G(ATTN))_","),.137),APGD=$$GET1^DIQ(200,(+($G(ATTN))_","),.138)
"RTN","GMTSDEMB",46,0)
 Q:(+($G(PROV))+($G(TEAM))+($G(ATTN))+($G(ASSP)))=0
"RTN","GMTSDEMB",47,0)
 I +($G(TEAM))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",48,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?10,"PCMM Team: ",$E($P($G(TEAM),"^",2),1,31)
"RTN","GMTSDEMB",49,0)
 . W ?53," Phone: ",?61,$G(TMPH)
"RTN","GMTSDEMB",50,0)
 I +($G(PROV))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?6,"PCMM Provider: ",$E($P($G(PROV),"^",2),1,31)
"RTN","GMTSDEMB",52,0)
 . W ?53," Phone: ",?61,$G(PRPH) I $L(PPGA)!($L(PPGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMB",53,0)
 . W:$L($G(PPGA)) !,?7,"Analog Pager: ",PPGA
"RTN","GMTSDEMB",54,0)
 . W:$L($G(PPGD))&($L($G(PPGA))) ?45," Digital Pager: ",PPGD W:$L($G(PPGD))&('$L($G(PPGA))) !,?6,"Digital Pager: ",PPGD
"RTN","GMTSDEMB",55,0)
 I +($G(ASSP))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",56,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?3,"PCMM Assoc. Prov: ",$E($P($G(ASSP),"^",2),1,31)
"RTN","GMTSDEMB",57,0)
 . W ?53," Phone: ",?61,$G(ASPH) I $L(ASPA)!($L(ASPD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMB",58,0)
 . W:$L($G(ASPA)) !,?7,"Analog Pager: ",ASPA
"RTN","GMTSDEMB",59,0)
 . W:$L($G(ASPD))&($L($G(ASPA))) ?45," Digital Pager: ",ASPD W:$L($G(ASPD))&('$L($G(ASPA))) !,?6,"Digital Pager: ",ASPD
"RTN","GMTSDEMB",60,0)
 I +($G(ATTN))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",61,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?10,"Attending: ",$E($P($G(ATTN),"^",2),1,31)
"RTN","GMTSDEMB",62,0)
 . W ?53," Phone: ",?61,$G(ATPH) I $L(APGA)!($L(APGD)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEMB",63,0)
 . W:$L($G(APGA)) !,?7,"Analog Pager: ",APGA
"RTN","GMTSDEMB",64,0)
 . W:$L($G(APGD))&($L($G(APGA))) ?45," Digital Pager: ",APGD W:$L($G(APGD))&('$L($G(APGA))) !,?6,"Digital Pager: ",APGD
"RTN","GMTSDEMB",65,0)
 D TF(DFN)
"RTN","GMTSDEMB",66,0)
 I +PROV>0!(+ASSP>0)!(+TEAM>0)!(+ATTN>0) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDEMB",67,0)
 Q
"RTN","GMTSDEMB",68,0)
TF(X) ; Treating Facilities
"RTN","GMTSDEMB",69,0)
 N DFN,GMTSC,GMTSDS,GMTSI,GMTSIEN,GMTSIT,GMTSS,GMTSTA,GMTSTF,GMTSTF2
"RTN","GMTSDEMB",70,0)
 N GMTSTFC,GMTSTY S GMTSTFC=0,DFN=+($G(X)),U="^" D TFL^VAFCTFU1(.GMTSTF,+($G(DFN))) S (GMTSC,GMTSI,GMTSS)=0
"RTN","GMTSDEMB",71,0)
 F  S GMTSI=$O(GMTSTF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEMB",72,0)
 . S GMTSTF2((99999999-(+($P($P($G(GMTSTF(GMTSI)),"^",3),".",1)))),+($$LKUP^XUAF4($P($G(GMTSTF(GMTSI)),"^",2))))=$G(GMTSTF(GMTSI))
"RTN","GMTSDEMB",73,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSTF2(GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",74,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(GMTSTF2(GMTSI,GMTSIEN)) Q:+GMTSIEN=0  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",75,0)
 . . S GMTSTA=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",1),GMTSIT=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",2) Q:'$L(GMTSIT)
"RTN","GMTSDEMB",76,0)
 . . S GMTSDS=$P($P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",3),".",1)
"RTN","GMTSDEMB",77,0)
 . . S:+GMTSDS'>0 GMTSDS="" S:+GMTSDS>0 GMTSDS=$TR($$FMTE^XLFDT(GMTSDS,"5DZ"),"@"," ") S:GMTSDS="" GMTSDS="--/--/----" S GMTSC=GMTSC+1
"RTN","GMTSDEMB",78,0)
 . . I GMTSC=1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",79,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?2,"Treating Facility:",?36,"Type",?49,"Station",?61,"Last Seen"
"RTN","GMTSDEMB",80,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?2,"------------------------------",?36,"-----------",?49,"-------",?61,"----------"
"RTN","GMTSDEMB",81,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSTY=$$GET1^DIQ(4,(+GMTSIEN_","),13,"E") W !,?2,$G(GMTSIT),?36,$G(GMTSTY),?49,$J($G(GMTSTA),6),?61,$G(GMTSDS) S GMTSTFC=GMTSTFC+1
"RTN","GMTSDEMB",82,0)
 Q
"RTN","GMTSDEMB",83,0)
SRC ; Source of Info
"RTN","GMTSDEMB",84,0)
 N GMTSS,GMTSR S GMTSR=0 S:$G(^GMT(142,+($G(GMTSTYP)),"VA"))>0&($P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)["REMOTE") GMTSR=1
"RTN","GMTSDEMB",85,0)
 S GMTSS=$$SITE^GMTSU2 I GMTSR>0,$L(GMTSS) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",86,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Source of Info: ",GMTSS,!
"RTN","GMTSDEMB",87,0)
 Q
"RTN","GMTSDGA")
0^45^B8572795
"RTN","GMTSDGA",1,0)
GMTSDGA ; SLC/MKB,KER/NDBI - Admissions for HS ; 02/27/2002
"RTN","GMTSDGA",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGA",3,0)
 ;                   
"RTN","GMTSDGA",4,0)
 ; External Reference
"RTN","GMTSDGA",5,0)
 ;   DBIA    17  ^DGPM("ATID"
"RTN","GMTSDGA",6,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGA",7,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMTSDGA",8,0)
 ;   DBIA  2929  DSP^A7RHSM
"RTN","GMTSDGA",9,0)
 ;   DBIA  2929  LST^A7RHSM
"RTN","GMTSDGA",10,0)
 ;   DBIA   512  ^DGPMLOS
"RTN","GMTSDGA",11,0)
 ;   DBIA 10015  EN^DIQ1 (file #80)
"RTN","GMTSDGA",12,0)
 ;   DBIA 10061  IN5^VADPT
"RTN","GMTSDGA",13,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","GMTSDGA",14,0)
 ;                    
"RTN","GMTSDGA",15,0)
ENAD ; Gets Admission Information 
"RTN","GMTSDGA",16,0)
 S TT=1,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",17,0)
 D PATINFO Q
"RTN","GMTSDGA",18,0)
ENDC ; Discharge Information
"RTN","GMTSDGA",19,0)
 S TT=3,FLGDC=1,FLGDX=0
"RTN","GMTSDGA",20,0)
 D PATINFO Q
"RTN","GMTSDGA",21,0)
ENDX ; PTF Discharge Diagnosis
"RTN","GMTSDGA",22,0)
 S TT=3,FLGDX=1,FLGDC=0
"RTN","GMTSDGA",23,0)
 D PATINFO Q
"RTN","GMTSDGA",24,0)
ENTS ; Treating Speciality Information
"RTN","GMTSDGA",25,0)
 S TT=6,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",26,0)
 D PATINFO Q
"RTN","GMTSDGA",27,0)
ENTR ; Transfers
"RTN","GMTSDGA",28,0)
 S TT=2,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",29,0)
 D PATINFO Q
"RTN","GMTSDGA",30,0)
PATINFO ; Patient Information
"RTN","GMTSDGA",31,0)
 S VA200=1 K DIQ
"RTN","GMTSDGA",32,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGA",33,0)
 E  S CNTR=100
"RTN","GMTSDGA",34,0)
 S GMC=-1,GMN="",ADM=GMTS1,FLAG=0
"RTN","GMTSDGA",35,0)
 I TT=1 D FADM^GMTSDGA2
"RTN","GMTSDGA",36,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGA",37,0)
 F  S ADM=$O(^DGPM("ATID"_TT,DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM!(ADM>GMTS2)!($D(GMTSQIT)))  D GET Q:$D(GMTSQIT)!($G(CNTR)<0)
"RTN","GMTSDGA",38,0)
 D KILLADM K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGA",39,0)
 Q
"RTN","GMTSDGA",40,0)
GET ; Admission Data
"RTN","GMTSDGA",41,0)
 N VAHOW
"RTN","GMTSDGA",42,0)
 S ADA=$O(^DGPM("ATID"_TT,DFN,ADM,0)) Q:'ADA
"RTN","GMTSDGA",43,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSDGA",44,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGA",45,0)
 S (X,ADATE)=+VAIP(3) D REGDT4^GMTSU S ADT=X
"RTN","GMTSDGA",46,0)
 K DGPMIFN S:TT=1 DGPMIFN=ADA S:TT'=1 DGPMIFN=VAIP(13)
"RTN","GMTSDGA",47,0)
 S GMC=2
"RTN","GMTSDGA",48,0)
 D CONTGET
"RTN","GMTSDGA",49,0)
 S LIN=$S(TT=2:"TROUT^GMTSDGA1",FLGDX:"DXOUT^GMTSDGA1",FLGDC:"DCOUT^GMTSDGA1",TT=6:"TSOUT^GMTSDGA2",TT=1:"ADOUT^GMTSDGA1") D @LIN
"RTN","GMTSDGA",50,0)
 K ICD(ADM)
"RTN","GMTSDGA",51,0)
 Q
"RTN","GMTSDGA",52,0)
CONTGET ; ICD and LOS info only needed for certain MAS components
"RTN","GMTSDGA",53,0)
 Q:TT=2  Q:TT=6
"RTN","GMTSDGA",54,0)
 N DIC,DR,DA,DIQ
"RTN","GMTSDGA",55,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGA",56,0)
 S PTF=$S($D(VAIP(12)):VAIP(12),1:"")
"RTN","GMTSDGA",57,0)
 I '$D(^ICD9) Q
"RTN","GMTSDGA",58,0)
 I PTF="" Q
"RTN","GMTSDGA",59,0)
 I '$D(^DGPT(PTF,70)) Q
"RTN","GMTSDGA",60,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGA",61,0)
 I $P(ICD,U,11)'="" S DA=$P(ICD,U,11),DIQ="ICD(ADM,1," D EN^DIQ1
"RTN","GMTSDGA",62,0)
 I $P(ICD,U,10)'="" S DA=$P(ICD,U,10),DIQ="ICD(ADM,2," D EN^DIQ1
"RTN","GMTSDGA",63,0)
 F GMTSI=16:1:24 I $P(ICD,U,GMTSI)'="" S DA=$P(ICD,U,GMTSI),DIQ="ICD(ADM,(GMTSI-13)," D EN^DIQ1
"RTN","GMTSDGA",64,0)
 Q
"RTN","GMTSDGA",65,0)
KILLADM ; Kill Admission variables
"RTN","GMTSDGA",66,0)
 D KVAR^VADPT
"RTN","GMTSDGA",67,0)
 K ADA,ADATE,ADT,BD,BDSC,DA,DIC,DDT,DP,DSPL,GMJ,GMJ1,OP,OPTR,FLAG,FLGDX,FLGDC,X,DR,GMI,GMTO,GMTNO,GMTSI,GMX,ADM,CNTR,GMC,GMZ,GMN,ICD,PTF,PTF70,PTFLG,LOS,II,DGPMIFN,IN,LIN,TI,TT,TS,SPEC
"RTN","GMTSDGA",68,0)
 Q
"RTN","GMTSDGA1")
0^9^B13500564
"RTN","GMTSDGA1",1,0)
GMTSDGA1 ; SLC/MKB,KER - Admissions (cont) ; 02/27/2002
"RTN","GMTSDGA1",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGA1",3,0)
 ;                    
"RTN","GMTSDGA1",4,0)
 ; External References
"RTN","GMTSDGA1",5,0)
 ;   DBIA    17  ^DGPM(
"RTN","GMTSDGA1",6,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGA1",7,0)
 ;   DBIA 10015  EN^DIQ1 (file 45)
"RTN","GMTSDGA1",8,0)
 ;   DBIA  3145  ^DIC(42.4,
"RTN","GMTSDGA1",9,0)
 ;   DBIA  3147  ^DIC(45.7,
"RTN","GMTSDGA1",10,0)
 ;                    
"RTN","GMTSDGA1",11,0)
TROUT ; Transfers Output
"RTN","GMTSDGA1",12,0)
 S X=ADATE D MTIM^GMTSU S TI=X,ADT=ADT_" "_TI
"RTN","GMTSDGA1",13,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADT,?21,$P(VAIP(4),U,2),$S($P(VAIP(4),U,2)'["TO":" TO ",1:" "),$P(VAIP(5),U,2),!
"RTN","GMTSDGA1",14,0)
 S TRFAC=$P(^DGPM(ADA,0),U,5) I $L(TRFAC) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?24,TRFAC,! K TRFAC
"RTN","GMTSDGA1",15,0)
 Q
"RTN","GMTSDGA1",16,0)
DCOUT ; Discharges Output
"RTN","GMTSDGA1",17,0)
 N BDSC,OPTR,DSPL D CKP^GMTSUP Q:$D(GMTSQIT)  I VAIP(17)="" S GMC=-1 Q
"RTN","GMTSDGA1",18,0)
 I VAIP(17,1)'="" S X=+VAIP(17,1) D REGDT4^GMTSU W "   Date of Discharge: ",X,!
"RTN","GMTSDGA1",19,0)
 I (+$P($G(ICD),U,10)>0),($G(ICD(ADM,2,80,+$P(ICD,U,10),3))]"") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"DXLS: ",ICD(ADM,2,80,+$P(ICD,U,10),3),!
"RTN","GMTSDGA1",20,0)
 S PTFLG=$S(PTF="":0,'$D(^DGPT(+PTF,70)):0,1:1),PTF70=$S(PTFLG:^DGPT(+PTF,70),1:"") D BDO
"RTN","GMTSDGA1",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Bedsection: ",BDSC,!
"RTN","GMTSDGA1",22,0)
 I $G(VAIP(17,3))'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W "    Disposition Type: ",$P(VAIP(17,3),U,2),!
"RTN","GMTSDGA1",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "   Disposition Place: ",DSPL,!
"RTN","GMTSDGA1",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient Treatment: ",OPTR,!
"RTN","GMTSDGA1",25,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",26,0)
 Q
"RTN","GMTSDGA1",27,0)
BDO ; Bedsection/Disposition/Outpatient Treatment
"RTN","GMTSDGA1",28,0)
 N DIC,DA,DR,DIQ,PTFA S PTF=+($G(PTF)),DIC=45,DA=+PTF,DR="71;73;75;",DIQ="PTFA(" D EN^DIQ1
"RTN","GMTSDGA1",29,0)
 S BDSC=$S($G(PTFA(45,+DA,71))]"":$G(PTFA(45,+DA,71)),1:"UNKNOWN")
"RTN","GMTSDGA1",30,0)
 S OPTR=$S($G(PTFA(45,+DA,73))]"":$G(PTFA(45,+DA,73)),1:"UNKNOWN")
"RTN","GMTSDGA1",31,0)
 S DSPL=$S($G(PTFA(45,+DA,75))]"":$G(PTFA(45,+DA,75)),1:"UNKNOWN")
"RTN","GMTSDGA1",32,0)
 Q
"RTN","GMTSDGA1",33,0)
DXOUT ; PTF Discharge Diagnosis Output
"RTN","GMTSDGA1",34,0)
 I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA1",36,0)
 S FLAG=2
"RTN","GMTSDGA1",37,0)
 S X=+$G(VAIP(13,1)) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA1",38,0)
 W DDT," - ",ADT,?57,"LOS: ",LOS,!
"RTN","GMTSDGA1",39,0)
 S NODIAG=1,GMI=0
"RTN","GMTSDGA1",40,0)
 F  S GMI=$O(ICD(ADM,GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(ADM,GMI,80,GMX)) Q:'GMX  D NXT
"RTN","GMTSDGA1",41,0)
 I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  W "No discharge diagnosis available for this admission.",! K NODIAG
"RTN","GMTSDGA1",42,0)
 Q
"RTN","GMTSDGA1",43,0)
ADOUT ; Admissions Output
"RTN","GMTSDGA1",44,0)
 I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA1",46,0)
 S FLAG=2
"RTN","GMTSDGA1",47,0)
 I $G(VAIP(17,1))="" S DDT="Present"
"RTN","GMTSDGA1",48,0)
 E  S X=$P(VAIP(17,1),U,1) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA1",49,0)
 W ADT," - ",DDT I VAIP(17,1)="" W ?25,GMTSWARD," ",GMTSRB
"RTN","GMTSDGA1",50,0)
 W ?56,"LOS: ",LOS,!
"RTN","GMTSDGA1",51,0)
 S TS=$P($G(^DIC(45.7,+$P($G(VAIP(14,6)),U),0)),U,2) S SPEC=$P($G(^DIC(42.4,+TS,0)),U)
"RTN","GMTSDGA1",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  Last Tr Specialty: ",$E(SPEC,1,25),?50,"Last Prov: ",$E($P($G(VAIP(14,5)),U,2),1,15),!
"RTN","GMTSDGA1",53,0)
 I $G(VAIP(17,1))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W "Admitting Diagnosis: ",$G(VAIP(13,7)),!
"RTN","GMTSDGA1",54,0)
 I PTF'="",$D(^DGPT(+PTF,70)) D CKP^GMTSUP Q:$D(GMTSQIT)  W "         Bedsection: ",$S(+($P(^DGPT(PTF,70),U,2))>0:$P($G(^DIC(42.4,+$P(^DGPT(PTF,70),U,2),0)),U),1:""),!
"RTN","GMTSDGA1",55,0)
 Q:'$D(ICD)  S GMI=0 F  S GMI=$O(ICD(ADM,GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(ADM,GMI,80,GMX)) Q:'GMX  D NXT
"RTN","GMTSDGA1",56,0)
 Q
"RTN","GMTSDGA1",57,0)
NXT ; Next Diagnosis
"RTN","GMTSDGA1",58,0)
 S (GMTO,GMTNO)="" S GMTO=$G(ICD(ADM,GMI,80,GMX,3)),GMTNO=$G(ICD(ADM,GMI,80,GMX,.01))
"RTN","GMTSDGA1",59,0)
 W:GMI=1 "Principal Diagnosis: " W:GMI=2 ?15,"DXLS: "
"RTN","GMTSDGA1",60,0)
 W:GMI=3 ?13,"ICD DX: " W ?21,GMTO,?62,GMTNO,!
"RTN","GMTSDGA1",61,0)
 S NODIAG=0
"RTN","GMTSDGA1",62,0)
 Q
"RTN","GMTSDGA2")
0^46^B9843839
"RTN","GMTSDGA2",1,0)
GMTSDGA2 ; SLC/MKB,KER - Treating Spec for HS ; 02/27/2002
"RTN","GMTSDGA2",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGA2",3,0)
 ;                    
"RTN","GMTSDGA2",4,0)
 ; External References
"RTN","GMTSDGA2",5,0)
 ;   DBIA    17  ^DGPM(
"RTN","GMTSDGA2",6,0)
 ;   DBIA  1003  ^DGS(41.1
"RTN","GMTSDGA2",7,0)
 ;   DBIA  3145  ^DIC(42.4
"RTN","GMTSDGA2",8,0)
 ;   DBIA  3147  ^DIC(45.7
"RTN","GMTSDGA2",9,0)
 ;   DBIA 10015  EN^DIQ1 (file 41.1)
"RTN","GMTSDGA2",10,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSDGA2",11,0)
 ;                    
"RTN","GMTSDGA2",12,0)
TSOUT ; Treating Speciality Output
"RTN","GMTSDGA2",13,0)
 S X=+VAIP(13,1) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA2",14,0)
 S X=ADATE D MTIM^GMTSU S ADT=ADT_" "_X
"RTN","GMTSDGA2",15,0)
 S TS=$P($G(^DIC(45.7,+VAIP(8),0)),U,2) S SPEC=$S($D(^DIC(42.4,+TS,0)):$P(^(0),U),1:"UNKNOWN")
"RTN","GMTSDGA2",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADT,?21,$E(SPEC,1,25),?48,"(",DDT,")",?63,$E($P(VAIP(7),U,2),1,15),!
"RTN","GMTSDGA2",17,0)
 K ^UTILITY($J,"W") I $D(^DGPM(ADA,"DX")) F GMJ=1:1:$P(^DGPM(ADA,"DX",0),"^",4) S X=^DGPM(ADA,"DX",GMJ,0),DIWL=27,DIWR=71,DIWF="C46R" D ^DIWP
"RTN","GMTSDGA2",18,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,"Diag: " S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ  S GMJ1=0 F GMZ=0:0 S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?27,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGA2",19,0)
 K DIWL,DIWF,DIWR,^UTILITY($J,"W")
"RTN","GMTSDGA2",20,0)
 Q
"RTN","GMTSDGA2",21,0)
FADM ; Future Scheduled admission output
"RTN","GMTSDGA2",22,0)
 N GMDT,NODE,X
"RTN","GMTSDGA2",23,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",24,0)
 D GETFADM
"RTN","GMTSDGA2",25,0)
 Q:'$D(^TMP("GMFADM",$J))
"RTN","GMTSDGA2",26,0)
 S GMC=1
"RTN","GMTSDGA2",27,0)
 S GMDT=0
"RTN","GMTSDGA2",28,0)
 F  S GMDT=$O(^TMP("GMFADM",$J,GMDT)) Q:GMDT'>0  D
"RTN","GMTSDGA2",29,0)
 . I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA2",30,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA2",31,0)
 . S FLAG=2
"RTN","GMTSDGA2",32,0)
 . S NODE=$G(^TMP("GMFADM",$J,GMDT))
"RTN","GMTSDGA2",33,0)
 . S X=$P(NODE,U) D REGDT4^GMTSU
"RTN","GMTSDGA2",34,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W X," (Future)",?23,$E($P(NODE,U,5),1,24)
"RTN","GMTSDGA2",35,0)
 . I $P(NODE,U,6)>0 W ?49,"Expected LOS: ",$P(NODE,U,6),!
"RTN","GMTSDGA2",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGA2",37,0)
 . . I $P(NODE,U,2)]"" W "Admitting Diagnosis: ",$P(NODE,U,2)
"RTN","GMTSDGA2",38,0)
 . . W ?51,"Provider: ",$E($P(NODE,U,3),1,15),!
"RTN","GMTSDGA2",39,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",40,0)
 Q
"RTN","GMTSDGA2",41,0)
GETFADM ; Get future scheduled admission data
"RTN","GMTSDGA2",42,0)
 N DA,DIQ,DIC,DR
"RTN","GMTSDGA2",43,0)
 Q:'$D(^DGS(41.1,"B",DFN))
"RTN","GMTSDGA2",44,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",45,0)
 S DA=0,DIC=41.1,DR="2;3;4;5;6;8;9;10;13;17"
"RTN","GMTSDGA2",46,0)
 F  S DA=$O(^DGS(41.1,"B",DFN,DA)) Q:DA'>0  D
"RTN","GMTSDGA2",47,0)
 . N GMFADM,DIQ,RESDT,ADDX,PROV,SUR,LOC,LOS
"RTN","GMTSDGA2",48,0)
 . S DIQ="GMFADM",DIQ(0)="IE"
"RTN","GMTSDGA2",49,0)
 . D EN^DIQ1
"RTN","GMTSDGA2",50,0)
 . ;   Quit if reservation day is past, 
"RTN","GMTSDGA2",51,0)
 . ;   admission cancel or patient admitted
"RTN","GMTSDGA2",52,0)
 . Q:GMFADM(41.1,DA,13,"I")]""!(GMFADM(41.1,DA,17,"I")]"")!(GMFADM(41.1,DA,2,"I")<DT)
"RTN","GMTSDGA2",53,0)
 . S RESDT=GMFADM(41.1,DA,2,"I"),ADDX=GMFADM(41.1,DA,4,"I")
"RTN","GMTSDGA2",54,0)
 . S PROV=GMFADM(41.1,DA,5,"E"),SUR=GMFADM(41.1,DA,6,"E")
"RTN","GMTSDGA2",55,0)
 . ;   LOC will contain either ward or treating specialty
"RTN","GMTSDGA2",56,0)
 . S LOC=$S(GMFADM(41.1,DA,10,"I")="W":GMFADM(41.1,DA,8,"E"),GMFADM(41.1,DA,10,"I")="T":GMFADM(41.1,DA,9,"E"),1:"")
"RTN","GMTSDGA2",57,0)
 . S LOS=GMFADM(41.1,DA,3,"I")
"RTN","GMTSDGA2",58,0)
 . S ^TMP("GMFADM",$J,9999999-RESDT)=RESDT_U_ADDX_U_PROV_U_SUR_U_LOC_U_LOS
"RTN","GMTSDGA2",59,0)
 Q
"RTN","GMTSDGC2")
0^47^B5304616
"RTN","GMTSDGC2",1,0)
GMTSDGC2 ; SLC/SBW,KER - Extended ADT Hist (cont) ; 02/27/2002
"RTN","GMTSDGC2",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGC2",3,0)
 ;                   
"RTN","GMTSDGC2",4,0)
 ; External References
"RTN","GMTSDGC2",5,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGC2",6,0)
 ;   DBIA 10083  ^ICD0(
"RTN","GMTSDGC2",7,0)
 ;   DBIA 10015  EN^DIQ1 (file 80.1)
"RTN","GMTSDGC2",8,0)
 ;                   
"RTN","GMTSDGC2",9,0)
ICDP(DFN,PTF) ; Module For History of PTF Procedures
"RTN","GMTSDGC2",10,0)
 Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGC2",11,0)
 N II,PRX,X,IX,GMP,GTA,O,O1,LN1
"RTN","GMTSDGC2",12,0)
 S II=0
"RTN","GMTSDGC2",13,0)
 F  S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",14,0)
 . S GMP(IX)="Procedure "_X F GTA=5:1:9 D
"RTN","GMTSDGC2",15,0)
 . . N DIQ,DA,DIQ,ICDP
"RTN","GMTSDGC2",16,0)
 . . Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGC2",17,0)
 . . S DIC=80.1,DR="4;.01",DA=$P(PRX,U,GTA),DIQ="ICDP(" D EN^DIQ1
"RTN","GMTSDGC2",18,0)
 . . I $D(ICDP(80.1,DA)) S GMP(IX,GTA)=$E(ICDP(80.1,DA,4),1,45)_U_ICDP(80.1,DA,.01)
"RTN","GMTSDGC2",19,0)
 I $D(GMP) S O=0 F  S O=$O(GMP(O)) Q:O=""  D
"RTN","GMTSDGC2",20,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",21,0)
 . F  S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMP(O) W ?22,$P(GMP(O,O1),U),?69,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",22,0)
 Q
"RTN","GMTSDGC2",23,0)
ICDS(DFN,PTF) ; Module for history of PTF surgery episodes
"RTN","GMTSDGC2",24,0)
 Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGC2",25,0)
 N II,SURG,X,IX,GMS,GMA,O,O1,LN1
"RTN","GMTSDGC2",26,0)
 S II=0
"RTN","GMTSDGC2",27,0)
 F  S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",28,0)
 . ;   Load Surgery entries into GMS array in inverted sequence
"RTN","GMTSDGC2",29,0)
 . S GMS(IX)="  Surgery "_X F GMA=8:1:12 D
"RTN","GMTSDGC2",30,0)
 . . ;   Surgery Line
"RTN","GMTSDGC2",31,0)
 . . N DIQ,DA,DIQ,ICDS
"RTN","GMTSDGC2",32,0)
 . . Q:$P(SURG,U,GMA)=""
"RTN","GMTSDGC2",33,0)
 . . S DIC=80.1,DR="4;.01",DA=$P(SURG,U,GMA),DIQ="ICDS(" D EN^DIQ1
"RTN","GMTSDGC2",34,0)
 . . I $D(ICDS(80.1,DA)) S GMS(IX,GMA)=$E(ICDS(80.1,DA,4),1,45)_U_ICDS(80.1,DA,.01)
"RTN","GMTSDGC2",35,0)
 I $D(GMS) S O=0 F  S O=$O(GMS(O)) Q:O=""  D
"RTN","GMTSDGC2",36,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",37,0)
 . F  S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMS(O) W ?22,$P(GMS(O,O1),U),?69,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",38,0)
 Q
"RTN","GMTSDGD")
0^48^B2749087
"RTN","GMTSDGD",1,0)
GMTSDGD ; SLC/JER,KER - Rated Disabilities Component ; 02/27/2002
"RTN","GMTSDGD",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSDGD",3,0)
 ;                    
"RTN","GMTSDGD",4,0)
 ; External References
"RTN","GMTSDGD",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSDGD",6,0)
 ;   DBIA 10015  EN^DIQ1 (file #2)
"RTN","GMTSDGD",7,0)
 ;   DBIA 10061  6^VADPT
"RTN","GMTSDGD",8,0)
 ;                    
"RTN","GMTSDGD",9,0)
MAIN ; Initializes Variables and Controls Looping
"RTN","GMTSDGD",10,0)
 N GMW,GMTSI,VA,VADM,VAEL,VAERR,VAPA
"RTN","GMTSDGD",11,0)
 D 6^VADPT I +VAEL(1) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Eligibility: ",$E($P(VAEL(1),U,2),1,40) W:VAEL(8)]"" ?55,$P(VAEL(8),U,2) W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W:+VAEL(3) "Total S/C %: ",$P(VAEL(3),U,2),! W !
"RTN","GMTSDGD",12,0)
 I '$D(^DPT(DFN,.372)) Q
"RTN","GMTSDGD",13,0)
 S GMTSI=0 F  S GMTSI=$O(^DPT(DFN,.372,GMTSI)) Q:GMTSI'>0  D WRT
"RTN","GMTSDGD",14,0)
 Q
"RTN","GMTSDGD",15,0)
WRT ; Resolves pointers and prints disability record
"RTN","GMTSDGD",16,0)
 N DA,DIQ,DR,DIC,GMTSDIS
"RTN","GMTSDGD",17,0)
 S DIC="^DPT("_DFN_",.372,",DA=GMTSI,DR=".01;2;3",DIQ="GMTSDIS",DIQ(0)="E"
"RTN","GMTSDGD",18,0)
 D EN^DIQ1
"RTN","GMTSDGD",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMTSDIS(2.04,DA,.01,"E"),?55,$J(GMTSDIS(2.04,DA,2,"E"),3),"%",?75,$S(GMTSDIS(2.04,DA,3,"E")="YES":"S/C",1:"NSC"),!
"RTN","GMTSDGD",20,0)
 Q
"RTN","GMTSDGH")
0^49^B7727684
"RTN","GMTSDGH",1,0)
GMTSDGH ; SLC/MKB,KER/NDBI - Patient Hist by admissions ; 02/27/2002
"RTN","GMTSDGH",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGH",3,0)
 ;                    
"RTN","GMTSDGH",4,0)
 ; External References
"RTN","GMTSDGH",5,0)
 ;   DBIA    17  ^DGPM("APCA"
"RTN","GMTSDGH",6,0)
 ;   DBIA    17  ^DGPM("ATID1"
"RTN","GMTSDGH",7,0)
 ;   DBIA    17  ^DGPM("ATS"
"RTN","GMTSDGH",8,0)
 ;   DBIA  2929  DSP^A7RHSM
"RTN","GMTSDGH",9,0)
 ;   DBIA  2929  LST^A7RHSM
"RTN","GMTSDGH",10,0)
 ;   DBIA 10061  IN5^VADPT
"RTN","GMTSDGH",11,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","GMTSDGH",12,0)
 ;                    
"RTN","GMTSDGH",13,0)
MAIN ; Loop through admissions starting from most recent
"RTN","GMTSDGH",14,0)
 N VAHOW
"RTN","GMTSDGH",15,0)
 K VAIP
"RTN","GMTSDGH",16,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGH",17,0)
 E  S CNTR=100
"RTN","GMTSDGH",18,0)
 S VA200=1,VAHOW=1,FLAG=-1,ADM=GMTS1
"RTN","GMTSDGH",19,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGH",20,0)
 F  S ADM=$O(^DGPM("ATID1",DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM)!(ADM>GMTS2)!(CNTR=0)!('DFN)  D MVTS
"RTN","GMTSDGH",21,0)
 D KILVAR K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGH",22,0)
 Q
"RTN","GMTSDGH",23,0)
MVTS ; Loop through mvts chronologically, per admission
"RTN","GMTSDGH",24,0)
 S ADA=0,ADA=$O(^DGPM("ATID1",DFN,ADM,ADA)) Q:'ADA
"RTN","GMTSDGH",25,0)
 K VAIP,PREVDR,PREVSP,^UTILITY($J)
"RTN","GMTSDGH",26,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGH",27,0)
 I $D(VAIP) D CKP^GMTSUP Q:$D(GMTSQIT)  W:FLAG>0 ! D PRNT
"RTN","GMTSDGH",28,0)
 D SETUTL
"RTN","GMTSDGH",29,0)
 S MDM="" F  S MDM=$O(^UTILITY($J,"GMTSMVTS",MDM)) Q:'MDM  D GET
"RTN","GMTSDGH",30,0)
 S CNTR=CNTR-1
"RTN","GMTSDGH",31,0)
 Q
"RTN","GMTSDGH",32,0)
GET ; Get Inpatient Data [v5.0 and above]
"RTN","GMTSDGH",33,0)
 I ^UTILITY($J,"GMTSMVTS",MDM)=ADA Q
"RTN","GMTSDGH",34,0)
 K VAIP S VAIP("E")=^UTILITY($J,"GMTSMVTS",MDM) D IN5^VADPT
"RTN","GMTSDGH",35,0)
 I $D(VAIP) D PRNT
"RTN","GMTSDGH",36,0)
 Q
"RTN","GMTSDGH",37,0)
PRNT ; Output Data
"RTN","GMTSDGH",38,0)
 S X=+$P(VAIP("MD"),U) D REGDT4^GMTSU
"RTN","GMTSDGH",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGH",40,0)
 S DOC=$E($P(VAIP("DR"),U,2),1,10),TYPE=$P(VAIP("MT"),U,2),CODE=+$P(VAIP("TT"),U),SPEC=$E($P(VAIP("TS"),U,2),1,12)
"RTN","GMTSDGH",41,0)
 S TT=$S(CODE=0:"NON",CODE=1:"ADM",CODE=2:"TR ",CODE=3:"DC ",CODE=4:"CIL",CODE=5:"COL",CODE=6:"TS ",1:"   ")
"RTN","GMTSDGH",42,0)
 I 'GMTSNPG,$D(PREVDR),PREVDR=$P(VAIP("DR"),U) S DOC="  "" "
"RTN","GMTSDGH",43,0)
 I 'GMTSNPG,$D(PREVSP),PREVSP=$P(VAIP("TS"),U) S SPEC="    "" "
"RTN","GMTSDGH",44,0)
 W X,?12,TT,"  ",$E(TYPE,1,34),?55,SPEC,?69,DOC,!
"RTN","GMTSDGH",45,0)
 S FLAG=2,PREVDR=$P(VAIP("DR"),U),PREVSP=$P(VAIP("TS"),U)
"RTN","GMTSDGH",46,0)
 Q
"RTN","GMTSDGH",47,0)
SETUTL ; Get Treating Specialty and Corresponding Admission
"RTN","GMTSDGH",48,0)
 S (TSDM,MDM)=0
"RTN","GMTSDGH",49,0)
 F  S TSDM=$O(^DGPM("ATS",DFN,ADA,TSDM)) Q:'TSDM  D NEXT1
"RTN","GMTSDGH",50,0)
 F  S MDM=$O(^DGPM("APCA",DFN,ADA,MDM)) Q:'MDM  D NEXT2
"RTN","GMTSDGH",51,0)
 Q
"RTN","GMTSDGH",52,0)
NEXT1 ;   Treating Specialty (ATS)
"RTN","GMTSDGH",53,0)
 S TS="",TS=$O(^DGPM("ATS",DFN,ADA,TSDM,TS)) Q:'TS
"RTN","GMTSDGH",54,0)
 S TSDA=0,TSDA=$O(^DGPM("ATS",DFN,ADA,TSDM,TS,TSDA)) Q:'TSDA
"RTN","GMTSDGH",55,0)
 S ^UTILITY($J,"GMTSMVTS",9999999-TSDM)=TSDA
"RTN","GMTSDGH",56,0)
 Q
"RTN","GMTSDGH",57,0)
NEXT2 ;   Corresponding Admission (APCA)
"RTN","GMTSDGH",58,0)
 S MDA=0,MDA=$O(^DGPM("APCA",DFN,ADA,MDM,MDA)) Q:'MDA
"RTN","GMTSDGH",59,0)
 I MDA'=ADA S ^UTILITY($J,"GMTSMVTS",MDM)=MDA
"RTN","GMTSDGH",60,0)
 Q
"RTN","GMTSDGH",61,0)
KILVAR ; Clean-up, exit
"RTN","GMTSDGH",62,0)
 D KVAR^VADPT
"RTN","GMTSDGH",63,0)
 K FLAG,IN,IM,ADA,ADM,MDA,MDM,X,DOC,CNTR,CODE,TYPE,TT,PREVSP,PREVDR,SPEC
"RTN","GMTSDGH",64,0)
 K ITS,TS,TSDM,TSDA,^UTILITY($J)
"RTN","GMTSDGH",65,0)
 Q
"RTN","GMTSDGP")
0^50^B10104539
"RTN","GMTSDGP",1,0)
GMTSDGP ; SLC/TRS,KER/NDBI - PTF Surgeries/Procedures ; 02/27/2002
"RTN","GMTSDGP",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSDGP",3,0)
 ;                    
"RTN","GMTSDGP",4,0)
 ; External References
"RTN","GMTSDGP",5,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGP",6,0)
 ;   DBIA  1372  ^DGPT("B"
"RTN","GMTSDGP",7,0)
 ;   DBIA  2929  OPC^A7RHSM
"RTN","GMTSDGP",8,0)
 ;   DBIA  2929  PRC^A7RHSM
"RTN","GMTSDGP",9,0)
 ;   DBIA 10083  ^ICD0( 
"RTN","GMTSDGP",10,0)
 ;   DBIA 10015  EN^DIQ1 (file 80.1)
"RTN","GMTSDGP",11,0)
 ;                    
"RTN","GMTSDGP",12,0)
ENS ; Module For History of PTF Surgery Episodes
"RTN","GMTSDGP",13,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",14,0)
 E  S CNTR=100
"RTN","GMTSDGP",15,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",16,0)
 S PTF=0
"RTN","GMTSDGP",17,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDS
"RTN","GMTSDGP",18,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) OPC^A7RHSM
"RTN","GMTSDGP",19,0)
 I $D(GMS) S O=0 F I=1:1 S O=$O(GMS(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMS(O) W ?21,$P(GMS(O,O1),U),?68,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",20,0)
 D KILLADM Q
"RTN","GMTSDGP",21,0)
ICDS ;   ICD Surgery
"RTN","GMTSDGP",22,0)
 Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGP",23,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDS1
"RTN","GMTSDGP",24,0)
 Q
"RTN","GMTSDGP",25,0)
ICDS1 ;   Load Surgery entries into GMS array (inverted)
"RTN","GMTSDGP",26,0)
 S GMCZ=2 S GMS(IX)="  Surgery  "_X F GMA=8:1:12 D SGY
"RTN","GMTSDGP",27,0)
 Q
"RTN","GMTSDGP",28,0)
SGY ;   Surgery Line
"RTN","GMTSDGP",29,0)
 K DIQ Q:$P(SURG,U,GMA)=""
"RTN","GMTSDGP",30,0)
 S DIC=80.1,DR="4;.01",DA=$P(SURG,U,GMA),DIQ="ICDS(" D EN^DIQ1
"RTN","GMTSDGP",31,0)
 I $D(ICDS(80.1,DA)) S GMS(IX,GMA)=$E(ICDS(80.1,DA,4),1,45)_U_ICDS(80.1,DA,.01)
"RTN","GMTSDGP",32,0)
 Q
"RTN","GMTSDGP",33,0)
 ;                    
"RTN","GMTSDGP",34,0)
ENP ; Module For History of PTF Procedures
"RTN","GMTSDGP",35,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",36,0)
 E  S CNTR=100
"RTN","GMTSDGP",37,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",38,0)
 S PTF=0
"RTN","GMTSDGP",39,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDP
"RTN","GMTSDGP",40,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) PRC^A7RHSM
"RTN","GMTSDGP",41,0)
 I $D(GMP) S O=0 F I=1:1 S O=$O(GMP(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMP(O) W ?21,$P(GMP(O,O1),U),?68,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",42,0)
 D KILLADM Q
"RTN","GMTSDGP",43,0)
 Q
"RTN","GMTSDGP",44,0)
ICDP ;   ICD Procedures
"RTN","GMTSDGP",45,0)
 Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGP",46,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDP1
"RTN","GMTSDGP",47,0)
 Q
"RTN","GMTSDGP",48,0)
ICDP1 ;   Load Procedure entries into GMP array (inverted)
"RTN","GMTSDGP",49,0)
 S GMCZ=2 S GMP(IX)="Procedure  "_X F GTA=5:1:9 D PXGY
"RTN","GMTSDGP",50,0)
 Q
"RTN","GMTSDGP",51,0)
PXGY ;   Procedure Line
"RTN","GMTSDGP",52,0)
 K DIQ
"RTN","GMTSDGP",53,0)
 Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGP",54,0)
 S DIC=80.1,DR="4;.01",DA=$P(PRX,U,GTA),DIQ="ICDP(" D EN^DIQ1
"RTN","GMTSDGP",55,0)
 I $D(ICDP(80.1,DA)) S GMP(IX,GTA)=$E(ICDP(80.1,DA,4),1,45)_U_ICDP(80.1,DA,.01)
"RTN","GMTSDGP",56,0)
 Q
"RTN","GMTSDGP",57,0)
 ;                    
"RTN","GMTSDGP",58,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDGP",59,0)
 K CNTR,GMCZ,LN1,IX,X,ZA,N,ICD,ICD0,PTF,GMC,O,O1,GMS,T1,T2,SURG,SURGY,PRX,PRXY,DATE,D1,I,IMT,GMA,GTA,II,ZI,GMP
"RTN","GMTSDGP",60,0)
 K ICDP,ICDS
"RTN","GMTSDGP",61,0)
 Q
"RTN","GMTSDVR")
0^51^B37066955
"RTN","GMTSDVR",1,0)
GMTSDVR ; SLC/JER,KER - Health Summary Driver ; 02/27/2002
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27,28,30,31,35,49**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
 ;                    
"RTN","GMTSDVR",4,0)
 ; External References
"RTN","GMTSDVR",5,0)
 ;   DBIA 10090  ^DIC(4
"RTN","GMTSDVR",6,0)
 ;   DBIA   510  ^DISV(
"RTN","GMTSDVR",7,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSDVR",8,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSDVR",9,0)
 ;   DBIA 10091  ^XMB(1
"RTN","GMTSDVR",10,0)
 ;   DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSDVR",11,0)
 ;   DBIA  2160  ^XUTL("OR"
"RTN","GMTSDVR",12,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSDVR",13,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSDVR",14,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSDVR",15,0)
 ;   DBIA   148  PATIENT^ORU1
"RTN","GMTSDVR",16,0)
 ;   DBIA   183  DFN^PSOSD1
"RTN","GMTSDVR",17,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSDVR",18,0)
 ;                    
"RTN","GMTSDVR",19,0)
MAIN ; Control branching
"RTN","GMTSDVR",20,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",21,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",22,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",23,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",24,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",25,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!(+($G(ORVP))>0)
"RTN","GMTSDVR",26,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",27,0)
 . . I +($G(ORVP)) S GMPAT(1)=+($G(ORVP))
"RTN","GMTSDVR",28,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSDVR",29,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",30,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",31,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",32,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",33,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",34,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",35,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",36,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",37,0)
 . . D HSOUT
"RTN","GMTSDVR",38,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",39,0)
 Q
"RTN","GMTSDVR",40,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSDVR",41,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSDVR",42,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSDVR",43,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSDVR",44,0)
 Q
"RTN","GMTSDVR",45,0)
PATCOPY(GMP,GMPAT) ; Copies patients from GMP to GMPAT array
"RTN","GMTSDVR",46,0)
 N IFN,GMDFN
"RTN","GMTSDVR",47,0)
 S IFN=0
"RTN","GMTSDVR",48,0)
 ;   GMPAT(NAME,GMDFN) - alphabetic order by patient
"RTN","GMTSDVR",49,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",50,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",51,0)
 . ;   Get name from ^DPT to prevent duplicates
"RTN","GMTSDVR",52,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",53,0)
 Q
"RTN","GMTSDVR",54,0)
RESUB(GMP) ; Resubscript GMP Array
"RTN","GMTSDVR",55,0)
 ;   Subscripts in GMP array are converted to numeric
"RTN","GMTSDVR",56,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",57,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",58,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",59,0)
 . S GMDFN=0
"RTN","GMTSDVR",60,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",61,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",62,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",63,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",64,0)
 Q
"RTN","GMTSDVR",65,0)
 ;                   
"RTN","GMTSDVR",66,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",67,0)
 ;                   
"RTN","GMTSDVR",68,0)
 ;   Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",69,0)
 ;              DFN=Record # of patient in file 2
"RTN","GMTSDVR",70,0)
 ;          GMTSPX1=Optional internal FM ending date
"RTN","GMTSDVR",71,0)
 ;          GMTSPX2=Optional internal FM beginning date
"RTN","GMTSDVR",72,0)
 ;                   
"RTN","GMTSDVR",73,0)
 ;   NOTE:  Optional date range variables are both 
"RTN","GMTSDVR",74,0)
 ;          required if a date range is desired.
"RTN","GMTSDVR",75,0)
 ;                   
"RTN","GMTSDVR",76,0)
 ;   To call from TaskMan:
"RTN","GMTSDVR",77,0)
 ;          S ZTRTN="ENXQ^GMTSDVR"
"RTN","GMTSDVR",78,0)
 ;          S ZTSAVE("GMTSTYP")=""
"RTN","GMTSDVR",79,0)
 ;          S ZTSAVE("DFN")=""
"RTN","GMTSDVR",80,0)
 ;          D ^%ZTLOAD
"RTN","GMTSDVR",81,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",82,0)
 Q
"RTN","GMTSDVR",83,0)
 ;                   
"RTN","GMTSDVR",84,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",85,0)
 ;                   
"RTN","GMTSDVR",86,0)
 ;   Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",87,0)
 ;              DFN=Record # of patient in file 2
"RTN","GMTSDVR",88,0)
 ;          GMTSPX1=Optional internal FM ending date
"RTN","GMTSDVR",89,0)
 ;          GMTSPX2=Optional internal FM beginning date
"RTN","GMTSDVR",90,0)
 ;                   
"RTN","GMTSDVR",91,0)
 ;   NOTE:  Optional date range variables are both 
"RTN","GMTSDVR",92,0)
 ;          required if a date range is desired.
"RTN","GMTSDVR",93,0)
 ;                   
"RTN","GMTSDVR",94,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",95,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",96,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",97,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",98,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",99,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",100,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",101,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",102,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",103,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",104,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",105,0)
 D PQ
"RTN","GMTSDVR",106,0)
 Q
"RTN","GMTSDVR",107,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",108,0)
 N DIC,X,Y
"RTN","GMTSDVR",109,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",110,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",111,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",112,0)
 K GMTYP S Y=$$TYPE^GMTSULT Q:+Y'>0
"RTN","GMTSDVR",113,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",114,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",115,0)
 Q
"RTN","GMTSDVR",116,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",117,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",118,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",119,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",120,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",121,0)
 . N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",122,0)
 . S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",123,0)
 . S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",124,0)
 . D LOADSEG
"RTN","GMTSDVR",125,0)
 . S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",126,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",127,0)
 . . N GMDUOUT
"RTN","GMTSDVR",128,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",129,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",130,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",131,0)
 Q
"RTN","GMTSDVR",132,0)
LOADSEG ; Load Enabled Components into GMTSEG Array
"RTN","GMTSDVR",133,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",134,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",135,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",136,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",137,0)
 Q
"RTN","GMTSDVR",138,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",139,0)
 N GMTK S GMTK=0 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  D
"RTN","GMTSDVR",140,0)
 . N GMTSE,GMTSR,GMTSF S GMTSE=^(GMTK,0),GMTSR=U_$P(GMTSE,";",2) Q:GMTSR="^"
"RTN","GMTSDVR",141,0)
 . S GMTSF=+$P(@(GMTSR_"0)"),U,2) Q:+GMTSF=0
"RTN","GMTSDVR",142,0)
 . S GMTSEG(GMTI,GMTSF,GMTK)=$P(GMTSE,";"),GMTSEG(GMTI,GMTSF,0)=GMTSR
"RTN","GMTSDVR",143,0)
 Q
"RTN","GMTSDVR",144,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",145,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",146,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",147,0)
 N %ZIS,IOP
"RTN","GMTSDVR",148,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",149,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",150,0)
NOQUE ; Do Not Queue Output
"RTN","GMTSDVR",151,0)
 D @ZTRTN D ^%ZISC
"RTN","GMTSDVR",152,0)
 Q
"RTN","GMTSDVR",153,0)
QUE ; Queue output
"RTN","GMTSDVR",154,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",155,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",156,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",157,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",158,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",159,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",160,0)
 Q
"RTN","GMTSDVR",161,0)
ACTPROF(GMDFN) ; Print Action Profile for Patient
"RTN","GMTSDVR",162,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",163,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",164,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",165,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",166,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",167,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",168,0)
 . S DFN=GMDFN
"RTN","GMTSDVR",169,0)
 . ;   Reset DFN because ^PSOSD1 call kills it
"RTN","GMTSDVR",170,0)
 . D PAGE^GMTSPL
"RTN","GMTSFH")
0^34^B21777901
"RTN","GMTSFH",1,0)
GMTSFH ; SLC/JER,MKB,KER - Dietetics Component ; 02/27/2002
"RTN","GMTSFH",2,0)
 ;;2.7;Health Summary;**25,28,49**;Oct 20, 1995
"RTN","GMTSFH",3,0)
 ;                    
"RTN","GMTSFH",4,0)
 ; External References
"RTN","GMTSFH",5,0)
 ;   DBIA  1407  ^FHWHEA
"RTN","GMTSFH",6,0)
 ;                    
"RTN","GMTSFH",7,0)
MAIN ; Controls branching and execution
"RTN","GMTSFH",8,0)
 N GMI,MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSFH",9,0)
 D ^FHWHEA Q:'$D(^UTILITY($J))  F GMI="DI","NS","SF","TF","EN" D @GMI
"RTN","GMTSFH",10,0)
 K ^UTILITY($J),STR,COL,TX,STRT,STP,CNTR
"RTN","GMTSFH",11,0)
 Q
"RTN","GMTSFH",12,0)
DI ; Diet Orders
"RTN","GMTSFH",13,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSFH",14,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "DIETS:",!
"RTN","GMTSFH",15,0)
 I '$D(^UTILITY($J,"DI")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "No diet orders available.",! Q
"RTN","GMTSFH",16,0)
 N GMW,GMIDT S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"DI",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D DIWRT
"RTN","GMTSFH",17,0)
 Q
"RTN","GMTSFH",18,0)
DIWRT ; Writes Diet Orders
"RTN","GMTSFH",19,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",20,0)
 N GMZ S GMZ=^UTILITY($J,"DI",GMIDT,0)
"RTN","GMTSFH",21,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",22,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",23,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,?25
"RTN","GMTSFH",25,0)
 S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No diet orders on file.")
"RTN","GMTSFH",26,0)
 I $L(STR)<40 W STR
"RTN","GMTSFH",27,0)
 E  S COL=27 D WRAP
"RTN","GMTSFH",28,0)
 W:$P(GMZ,U,5)'="" ?61,"("_$P(GMZ,U,5)_")" W !
"RTN","GMTSFH",29,0)
 I $P(GMZ,U,4)'="" D DICOM
"RTN","GMTSFH",30,0)
 Q
"RTN","GMTSFH",31,0)
DICOM ; Writes comments for DI
"RTN","GMTSFH",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "           Comments: "
"RTN","GMTSFH",33,0)
 I $L($P(GMZ,U,4))<55 W $P(GMZ,U,4),!
"RTN","GMTSFH",34,0)
 E  S STR=$P(GMZ,U,4),COL=45 D WRAP W !
"RTN","GMTSFH",35,0)
 Q
"RTN","GMTSFH",36,0)
NS ; Nutritional status
"RTN","GMTSFH",37,0)
 I '$D(^UTILITY($J,"NS")) Q
"RTN","GMTSFH",38,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSFH",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"NUTRITIONAL STATUS:",!
"RTN","GMTSFH",40,0)
 N GMW,GMIDT
"RTN","GMTSFH",41,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"NS",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D NSWRT
"RTN","GMTSFH",42,0)
 Q
"RTN","GMTSFH",43,0)
NSWRT ; Writes Nutritional Status
"RTN","GMTSFH",44,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",45,0)
 N GMZ S GMZ=^UTILITY($J,"NS",GMIDT,0)
"RTN","GMTSFH",46,0)
 S X=+$P(GMZ,U) D REGDTM4^GMTSU S STRT=X
"RTN","GMTSFH",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSFH",48,0)
 W STRT,?21,$S($P(GMZ,U,2)'="":$P(GMZ,U,2),1:"No status on file."),!
"RTN","GMTSFH",49,0)
 Q
"RTN","GMTSFH",50,0)
SF ; Supplemental feeding
"RTN","GMTSFH",51,0)
 I '$D(^UTILITY($J,"SF")) Q
"RTN","GMTSFH",52,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSFH",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"SUPPLEMENTAL FEEDINGS:",!
"RTN","GMTSFH",54,0)
 N GMW,GMIDT
"RTN","GMTSFH",55,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"SF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D SFWRT
"RTN","GMTSFH",56,0)
 Q
"RTN","GMTSFH",57,0)
SFWRT ; Writes Supplemental Feedings
"RTN","GMTSFH",58,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",59,0)
 N GMZ S GMZ=^UTILITY($J,"SF",GMIDT,0)
"RTN","GMTSFH",60,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",61,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",62,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"10 Am  " S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No order")
"RTN","GMTSFH",65,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",66,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 2 Pm  " S STR=$S($P(GMZ,U,4)'="":$P(GMZ,U,4),1:"No order")
"RTN","GMTSFH",68,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",69,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 8 Pm  " S STR=$S($P(GMZ,U,5)'="":$P(GMZ,U,5),1:"No order")
"RTN","GMTSFH",71,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",72,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",73,0)
 Q
"RTN","GMTSFH",74,0)
TF ; Tubefeeding
"RTN","GMTSFH",75,0)
 I '$D(^UTILITY($J,"TF")) Q
"RTN","GMTSFH",76,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSFH",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"TUBE FEEDINGS:",!
"RTN","GMTSFH",78,0)
 N GMW,GMIDT
"RTN","GMTSFH",79,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"TF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D TFWRT
"RTN","GMTSFH",80,0)
 Q
"RTN","GMTSFH",81,0)
TFWRT ; Writes tubefeeding
"RTN","GMTSFH",82,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",83,0)
 N GMZ S GMZ=^UTILITY($J,"TF",GMIDT,0)
"RTN","GMTSFH",84,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",85,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",86,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",87,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",88,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Product: ",$P(GMZ,U,3),!
"RTN","GMTSFH",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Strength: ",$P(GMZ,U,4),?51,"Quantity: ",$P(GMZ,U,5),!
"RTN","GMTSFH",90,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Daily CC's: ",$P(GMZ,U,6),?47,"Daily KCal's: ",$P(GMZ,U,7),!
"RTN","GMTSFH",91,0)
 I $P(GMZ,U,8)'="" D TFCOM
"RTN","GMTSFH",92,0)
 Q
"RTN","GMTSFH",93,0)
TFCOM ; Writes comments for TF
"RTN","GMTSFH",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Comments: "
"RTN","GMTSFH",95,0)
 I $L($P(GMZ,U,8))<55 W $P(GMZ,U,8),!
"RTN","GMTSFH",96,0)
 E  S STR=$P(GMZ,U,8),COL=45 D WRAP W !
"RTN","GMTSFH",97,0)
 Q
"RTN","GMTSFH",98,0)
WRAP ; Controls wrap-around feature for comments, etc.
"RTN","GMTSFH",99,0)
 S TX=$F(STR," ",COL) W $E(STR,1,TX-1),!
"RTN","GMTSFH",100,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$E(STR,TX,$L(STR))
"RTN","GMTSFH",101,0)
 Q
"RTN","GMTSFH",102,0)
EN ; Dietetic Encounters
"RTN","GMTSFH",103,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999) Q:'$D(^UTILITY($J,"EN"))
"RTN","GMTSFH",104,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"DIETETIC ENCOUNTERS:",! N GMW,GMIDT S GMIDT=GMTS1
"RTN","GMTSFH",105,0)
 F  S GMIDT=$O(^UTILITY($J,"EN",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D
"RTN","GMTSFH",106,0)
 . S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",107,0)
 . N GMZ S GMZ=^UTILITY($J,"EN",GMIDT,0)
"RTN","GMTSFH",108,0)
 . S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",109,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT,?12,$P(GMZ,U,2),!
"RTN","GMTSFH",110,0)
 . I $P(GMZ,U,3)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,3),!
"RTN","GMTSFH",111,0)
 . I $P(GMZ,U,4)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,4),!
"RTN","GMTSFH",112,0)
 Q
"RTN","GMTSGAF")
0^29^B39330972
"RTN","GMTSGAF",1,0)
GMTSGAF ; SLC/KER - MH Gbl Assessment Funct (GAF)    ; 02/27/2002
"RTN","GMTSGAF",2,0)
 ;;2.7;Health Summary;**35,44,49**;Oct 20, 1995
"RTN","GMTSGAF",3,0)
 ;                  
"RTN","GMTSGAF",4,0)
 ; External References
"RTN","GMTSGAF",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSGAF",6,0)
 ;   DBIA 10003  ^%DT
"RTN","GMTSGAF",7,0)
 ;   DBIA 10088  DEM^VADPT
"RTN","GMTSGAF",8,0)
 ;   DBIA 10103  $$FMADD^XLFDT
"RTN","GMTSGAF",9,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSGAF",10,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSGAF",11,0)
 ;   DBIA  2896  GAFHX^YSGAFAPI
"RTN","GMTSGAF",12,0)
 ;                     
"RTN","GMTSGAF",13,0)
 Q
"RTN","GMTSGAF",14,0)
EN ; Global Assessment Functioning Score
"RTN","GMTSGAF",15,0)
 N MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:9999999)
"RTN","GMTSGAF",16,0)
 S:+($G(GMTSBEG))'>2700101 GMTSBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1095,0,0,1),GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS2=9999999-GMTSBEG,GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",17,0)
 S:'$L($P(GMTSBEG,".",2)) GMTSBEG=$$FMADD^XLFDT(GMTSBEG,0,0,0,1)
"RTN","GMTSGAF",18,0)
 S:+($G(GMTSEND))'>2700101!(+($G(GMTSEND))>+($$FMADD^XLFDT($P($$NOW^XLFDT,".",1),+1,0,0,2))) GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",19,0)
 S:'$L($P(GMTSEND,".",2)) GMTSEND=$$FMADD^XLFDT(GMTSEND,0,0,0,1)
"RTN","GMTSGAF",20,0)
 S:+($G(GMTSEND))>0&(+($G(GMTS1))=0) GMTS1=9999999-GMTSEND S:+($G(GMTSBEG))>0&(+($G(GMTS2))=0) GMTS2=9999999-GMTSBEG
"RTN","GMTSGAF",21,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSGAF",22,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="GLOBAL ASSESSMENT FUNCTIONING"
"RTN","GMTSGAF",23,0)
 S DFN=+($G(DFN)) Q:'$L($P($G(^DPT(DFN,0)),"^",1))
"RTN","GMTSGAF",24,0)
 N %,%DT,%H,%I,%T,%X,I,N,VA,VADM,VAERR,X,Y,YS,YSGAF
"RTN","GMTSGAF",25,0)
 N GMTSBAR,GMTSCNT,GMTSCOM,GMTSCORE,GMTSCS,GMTSCW,GMTSDATE,GMTSDT,GMTSGAF,GMTSGAF1,GMTSGAF2,GMTSGAF3,GMTSGAFN,GMTSI,GMTSJ,GMTSLEN,GMTSPROV,GMTSRV
"RTN","GMTSGAF",26,0)
 S GMTSGAF1=$$ITM(+($G(GMTS1))),GMTSGAF2=$$ITM(+($G(GMTS2))),GMTSGAF3=$$TOM,GMTSGAFN=+($G(MAX)) S:GMTSGAFN=0 GMTSGAFN=10
"RTN","GMTSGAF",27,0)
 S GMTSCW(0)=+($G(IOM)) S:GMTSCW(0)=0 GMTSCW(0)=80
"RTN","GMTSGAF",28,0)
 S GMTSCW(1)=5,GMTSCW(2)=10,GMTSCW(3)=20,GMTSCW(4)=GMTSCW(0)-(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+8)
"RTN","GMTSGAF",29,0)
 S GMTSCW("L")=(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+GMTSCW(4)+6)
"RTN","GMTSGAF",30,0)
 S GMTSCS(1)=1,GMTSCS(2)=GMTSCS(1)+GMTSCW(1)+2,GMTSCS(3)=GMTSCS(2)+GMTSCW(2)+2,GMTSCS(4)=GMTSCS(3)+GMTSCW(3)+2
"RTN","GMTSGAF",31,0)
 S YS("DFN")=DFN,YS("BEGIN")=$S($L(GMTSGAF2):GMTSGAF2,1:GMTSGAF3),YS("END")=$S($L(GMTSGAF1):GMTSGAF1,1:"01/01/1970"),YS("LIMIT")=GMTSGAFN
"RTN","GMTSGAF",32,0)
 D GET Q:'$D(^TMP($J,"GMTSGAF",DFN))  D OUT Q
"RTN","GMTSGAF",33,0)
OUT ; Output
"RTN","GMTSGAF",34,0)
 N GMTSI,GMTSJ,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)) Q:DFN=0  D HDR S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSGAF",DFN,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",35,0)
 . S GMTSJ=$G(^TMP($J,"GMTSGAF",DFN,GMTSI))
"RTN","GMTSGAF",36,0)
 . S GMTSCORE=$P(GMTSJ,"^",1),GMTSDATE=$P(GMTSJ,"^",2),GMTSPROV=$P(GMTSJ,"^",3),GMTSCOM=$P(GMTSJ,"^",4) S:GMTSCORE=""&(GMTSDATE["----")&($L(GMTSCOM)) GMTSCORE=">>" D LINE
"RTN","GMTSGAF",37,0)
 K ^TMP($J,"GMTSGAF",DFN) Q
"RTN","GMTSGAF",38,0)
LINE ; Output One Line
"RTN","GMTSGAF",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCS(1),$J($E(GMTSCORE,1,3),3),?GMTSCS(2),GMTSDATE,?GMTSCS(3),$E(GMTSPROV,1,GMTSCW(3)),?GMTSCS(4),GMTSCOM,! Q
"RTN","GMTSGAF",40,0)
HDR ; Header
"RTN","GMTSGAF",41,0)
 N GMTSI S GMTSI="",$P(GMTSI,"-",+($G(GMTSCW("L"))))="-"
"RTN","GMTSGAF",42,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1)," GAF ",?GMTSCS(2),"Date",!
"RTN","GMTSGAF",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),"Score",?GMTSCS(2),"Determined",?GMTSCS(3),"Determined by",?GMTSCS(4),"Graph/Comment",!
"RTN","GMTSGAF",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),GMTSI,!
"RTN","GMTSGAF",45,0)
 Q
"RTN","GMTSGAF",46,0)
GET ; Get and Format Data
"RTN","GMTSGAF",47,0)
 N %DT,X,Y,GMTSGPH,GMTSCORE,GMTSDT,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)),GMTSGPH=0 K ^TMP($J,"GMTSGAF",DFN),YSGAF D GAFHX^YSGAFAPI(.YSGAF,.YS),SPC
"RTN","GMTSGAF",48,0)
 I +($P($G(YSGAF("DEC")),".",1))>0 D
"RTN","GMTSGAF",49,0)
 . S GMTSDT=+($P($G(YSGAF("DEC")),".",1)),GMTSCOM="Deceased ("_$$FMTE^XLFDT(GMTSDT,"5ZD")_")" D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",50,0)
 I +($P($G(YSGAF("DUE")),".",1))>0 D
"RTN","GMTSGAF",51,0)
 . S GMTSDT=+($P($G(YSGAF("DUE")),".",1)) Q:GMTSDT>$$TOD  S GMTSCOM="Due since "_$$FMTE^XLFDT(GMTSDT,"5ZD") D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",52,0)
 N I S I=1 F  S I=$O(YSGAF(I)) Q:+I=0  D
"RTN","GMTSGAF",53,0)
 . S GMTSDT=$P(YSGAF(I),"^",1),GMTSDATE=$P(GMTSDT,".",1),GMTSDATE=$$FMTE^XLFDT(GMTSDATE,"5ZD")
"RTN","GMTSGAF",54,0)
 . Q:+($G(YSGAF("DEC")))>0&(+GMTSDATE>+($G(YSGAF("DEC"))))
"RTN","GMTSGAF",55,0)
 . S GMTSCORE=$P(YSGAF(I),"^",5),GMTSPROV=$P(YSGAF(I),"^",7)
"RTN","GMTSGAF",56,0)
 . S GMTSCOM=+($P($G(YSGAF("ERR",I)),".",1)) S:+GMTSCOM=0 GMTSCOM=""
"RTN","GMTSGAF",57,0)
 . S:+GMTSCOM>0 GMTSCOM="Entered in error ("_$$FMTE^XLFDT(GMTSCOM,"5ZD")_")"
"RTN","GMTSGAF",58,0)
 . S:GMTSCOM="" GMTSCOM=$$B(GMTSCORE,31)
"RTN","GMTSGAF",59,0)
 . D:'$D(YSGAF("ERR",I)) SD(GMTSDT,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM)
"RTN","GMTSGAF",60,0)
 Q
"RTN","GMTSGAF",61,0)
SPC ; Get Special Case (Deceased, Due, Entered-in-Error)
"RTN","GMTSGAF",62,0)
 N GMTSI S YSGAF("P")=$P($G(^DPT(+($G(DFN)),0)),"^",1)
"RTN","GMTSGAF",63,0)
 S GMTSI=$$DEC(+($G(DFN))) S:+GMTSI>0 YSGAF("DEC")=GMTSI I +GMTSI=0 S GMTSI=$$DUE S:+GMTSI>0 YSGAF("DUE")=GMTSI
"RTN","GMTSGAF",64,0)
 K:+($G(YSGAF("DEC")))>0 YSGAF("DUE") S GMTSI=$$ERR S:+GMTSI>0 YSGAF("ERR")=GMTSI
"RTN","GMTSGAF",65,0)
 Q
"RTN","GMTSGAF",66,0)
SD(GMTSI,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM) ; Save Data
"RTN","GMTSGAF",67,0)
 N GMTSIG S (GMTSCORE,GMTSIG)=$G(GMTSCORE),GMTSCORE=$$GAF(GMTSCORE),DFN=+($G(DFN))
"RTN","GMTSGAF",68,0)
 S GMTSIG=100-(+($G(GMTSIG)))
"RTN","GMTSGAF",69,0)
 S GMTSI=+($G(GMTSI)),GMTSI=9999999.999999-GMTSI
"RTN","GMTSGAF",70,0)
 S GMTSPROV=$G(GMTSPROV),GMTSDATE=$G(GMTSDATE)
"RTN","GMTSGAF",71,0)
 S GMTSIG=GMTSI_GMTSIG_GMTSPROV_GMTSDATE
"RTN","GMTSGAF",72,0)
 S:GMTSDATE="" GMTSDATE="--/--/----"
"RTN","GMTSGAF",73,0)
 S ^TMP($J,"GMTSGAF",DFN,GMTSIG)=GMTSCORE_"^"_GMTSDATE_"^"_GMTSPROV_"^"_$G(GMTSCOM)
"RTN","GMTSGAF",74,0)
 Q
"RTN","GMTSGAF",75,0)
ERR(X) ; Entered in Error
"RTN","GMTSGAF",76,0)
 N GMTSCNT,GMTSI,GMTSGAF,GMTSJ,GMTSDATE S (GMTSCNT,GMTSI)=0,GMTSDATE="" F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",77,0)
 . S GMTSGAF=$P(YSGAF(GMTSI),"^",8) Q:GMTSGAF'["entered in error"
"RTN","GMTSGAF",78,0)
 . S YSGAF("ERR")="" F GMTSJ=1:1:$L(GMTSGAF," ") S:$P(GMTSGAF," ",GMTSJ)["@"&(GMTSJ>2) GMTSDATE=$P(GMTSGAF," ",GMTSJ-1,GMTSJ) S:$L(GMTSDATE) GMTSDATE=$$ETF(GMTSDATE)
"RTN","GMTSGAF",79,0)
 . S:$L(GMTSDATE) YSGAF("ERR",GMTSI)=GMTSDATE,GMTSCNT=GMTSCNT+1
"RTN","GMTSGAF",80,0)
 S X=GMTSCNT Q X
"RTN","GMTSGAF",81,0)
DUE(X) ; GAF Score Due Date
"RTN","GMTSGAF",82,0)
 S:'$D(YSGAF(2)) YSGAF(1)="[NO DATA]" N GMTSI,GMTSJ,GMTSDATE S (GMTSI,GMTSJ,GMTSDATE)=0
"RTN","GMTSGAF",83,0)
 F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  S GMTSJ=$P(YSGAF(GMTSI),"^",1) S:GMTSJ>GMTSDATE GMTSDATE=GMTSJ
"RTN","GMTSGAF",84,0)
 S GMTSDATE=$S(GMTSDATE>0:$$FMADD^XLFDT(GMTSDATE,90,0,0,0),1:"") S X=GMTSDATE Q X
"RTN","GMTSGAF",85,0)
ITM(X) ; Inverse date to Mental Health formats
"RTN","GMTSGAF",86,0)
 S X=+($G(X)) Q:X=0 "" S X=9999999.999999-X,X=$$FMTE^XLFDT(X,"5ZD") Q X
"RTN","GMTSGAF",87,0)
ETF(X) ; External to Fileman format
"RTN","GMTSGAF",88,0)
 N %DT,Y S X=$G(X),%DT="PST" D ^%DT S X=Y S:+X'>0 X="" Q X
"RTN","GMTSGAF",89,0)
TOM(X) ; Tomorrow
"RTN","GMTSGAF",90,0)
 S X=$$FMTE^XLFDT($$FMADD^XLFDT($$NOW^XLFDT,1,0,0,0),"5ZD") Q X
"RTN","GMTSGAF",91,0)
TOD(X) ; Today
"RTN","GMTSGAF",92,0)
 S X=$$NOW^XLFDT Q X
"RTN","GMTSGAF",93,0)
DEC(X) ; Deceased Date
"RTN","GMTSGAF",94,0)
 N %,%H,%I,%X,%T,VA,VADM,VAERR,DFN S DFN=+($G(X)) Q:DFN=0 "" Q:'$D(^DPT(+DFN,0)) ""
"RTN","GMTSGAF",95,0)
 D DEM^VADPT S X=+$G(VADM(6)) S:X=0 X="" Q X
"RTN","GMTSGAF",96,0)
B(X,Y) ; Graph Bar
"RTN","GMTSGAF",97,0)
 N GMTSGAF,GMTSCHAR,GMTSCW,GMTSLEN,GMTSI,GMTSBAR S GMTSGAF=$G(X),GMTSCW=+($G(Y)) Q:GMTSCW=0 ""
"RTN","GMTSGAF",98,0)
 S GMTSCHAR="#" F  Q:$E(GMTSGAF,1)'="0"  S GMTSGAF=$E(GMTSGAF,2,$L(GMTSGAF))
"RTN","GMTSGAF",99,0)
 S GMTSGAF=+GMTSGAF Q:GMTSGAF=0 ""
"RTN","GMTSGAF",100,0)
 I GMTSGAF>99 S GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSCW)=GMTSCHAR
"RTN","GMTSGAF",101,0)
 I GMTSGAF'>99 S GMTSI=GMTSCW/100,GMTSLEN=GMTSI*GMTSGAF,GMTSLEN=$FN(GMTSLEN,"",0),GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSLEN)=GMTSCHAR
"RTN","GMTSGAF",102,0)
 S X=GMTSBAR Q X
"RTN","GMTSGAF",103,0)
GAF(X) ; 2 Digit GAF Score
"RTN","GMTSGAF",104,0)
 S X=$E($G(X),1,3) Q:X=""!(X="---") "" S X=+X Q:X=0 "  0" S:$L(X)=1 X="  "_X S:$L(X)=2 X=" "_X Q X
"RTN","GMTSGAF",105,0)
DTM(X) ; Current Date and Time (External)
"RTN","GMTSGAF",106,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSLOAD")
0^60^B15017440
"RTN","GMTSLOAD",1,0)
GMTSLOAD ;SLC/JER - Loads Ad Hoc Summary Type ; 02/27/2002
"RTN","GMTSLOAD",2,0)
 ;;2.7;Health Summary;**23,30,36,37,49**;Oct 20, 1995
"RTN","GMTSLOAD",3,0)
 ;                  
"RTN","GMTSLOAD",4,0)
 ; External References
"RTN","GMTSLOAD",5,0)
 ; DBIA 10026  ^DIR
"RTN","GMTSLOAD",6,0)
 ; DBIA 10141  BMES^XPDUTL
"RTN","GMTSLOAD",7,0)
 ; DBIA 10141  MES^XPDUTL
"RTN","GMTSLOAD",8,0)
 ;                    
"RTN","GMTSLOAD",9,0)
MAIN ; Controls branching and execution
"RTN","GMTSLOAD",10,0)
 N DIC,DIROUT,DIRUT,DIR,GMI,GMW,GMTJ,GMTNM,GMTSEG,GMTSFUNC,GMTSI,GMTSIFN,GMTSWHL,INCLUDE,S2,X,Y
"RTN","GMTSLOAD",11,0)
 W !!,"This option rebuilds the Ad Hoc Health Summary to include ALL components",!
"RTN","GMTSLOAD",12,0)
 W "alphabetized by name.  If you wish, you may exclude DISABLED components.",!
"RTN","GMTSLOAD",13,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("?")="Answer ""Y"" or ""N"", ""NO"" to exit this option."
"RTN","GMTSLOAD",14,0)
 D ^DIR Q:Y=0  W !
"RTN","GMTSLOAD",15,0)
 I $S($D(DIRUT):1,$D(DIROUT):1,1:0) Q
"RTN","GMTSLOAD",16,0)
 S DIR("?")="Answer ""Y"" or ""N"", ""YES"" to include DISABLED components."
"RTN","GMTSLOAD",17,0)
 S DIR("A")="Should DISABLED components be included",DIR("B")="YES"
"RTN","GMTSLOAD",18,0)
 D ^DIR
"RTN","GMTSLOAD",19,0)
 I $S($D(DIRUT):1,$D(DIROUT):1,1:0) Q
"RTN","GMTSLOAD",20,0)
 S INCLUDE=Y
"RTN","GMTSLOAD",21,0)
ENPOST ; Entry point from Post-init
"RTN","GMTSLOAD",22,0)
 ;   Call with INCLUDE=0 to exclude DISABLED components
"RTN","GMTSLOAD",23,0)
 ;   Call with INCLUDE=1 to include DISABLED components
"RTN","GMTSLOAD",24,0)
 N NEWREC,GMTSTYP,DLAYGO
"RTN","GMTSLOAD",25,0)
 S DLAYGO=142
"RTN","GMTSLOAD",26,0)
 S DIC=142,DIC(0)="LXF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSLOAD",27,0)
 I +Y'>0 D NOFILE Q
"RTN","GMTSLOAD",28,0)
 S (GMTSIFN,GMTSTYP)=+Y,NEWREC=+$P(Y,U,3)
"RTN","GMTSLOAD",29,0)
 S:'$D(^GMT(142,GMTSIFN,1,0)) ^(0)="^142.01IA^0^0"
"RTN","GMTSLOAD",30,0)
 S GMTNM="" F GMI=1:1 S GMTNM=$O(^GMT(142.1,"B",GMTNM)) Q:GMTNM']""  S GMTJ=$O(^(GMTNM,0)) Q:GMTJ'>0  D LOAD
"RTN","GMTSLOAD",31,0)
 S GMTSI=0 I 'NEWREC F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  D PURGE^GMTSRN
"RTN","GMTSLOAD",32,0)
 D BMES^XPDUTL(" Rebuilding Ad Hoc Summary")
"RTN","GMTSLOAD",33,0)
 D RNMBR^GMTSRN
"RTN","GMTSLOAD",34,0)
 D MES^XPDUTL(" Done")
"RTN","GMTSLOAD",35,0)
 Q
"RTN","GMTSLOAD",36,0)
NOFILE ; GMTS HS ADHOC OPTION Summary Type is missing
"RTN","GMTSLOAD",37,0)
 D MES^XPDUTL(" ")
"RTN","GMTSLOAD",38,0)
 D BMES^XPDUTL("** GMTS AD HOC OPTION Summary Type is missing **")
"RTN","GMTSLOAD",39,0)
 Q
"RTN","GMTSLOAD",40,0)
 ;                  
"RTN","GMTSLOAD",41,0)
LOAD ; Loads GMTSEG(GMI)=Sequence ^ Component ^ Occurrence Limit ^
"RTN","GMTSLOAD",42,0)
 ;   Time Limit ^^ Hospital Location ^ ICD Text Displayed ^
"RTN","GMTSLOAD",43,0)
 ;   Provider Narratived Displayed ^ CPT Modifier Displayed
"RTN","GMTSLOAD",44,0)
 ;                   
"RTN","GMTSLOAD",45,0)
 ; Needs GMTJ     Pointer to Component  142.1
"RTN","GMTSLOAD",46,0)
 ;       GMTSTYP  Pointer to Type       142
"RTN","GMTSLOAD",47,0)
 ;       GMI      Pointer to Structure  142.01 in GMTSEG(GMI)
"RTN","GMTSLOAD",48,0)
 ;
"RTN","GMTSLOAD",49,0)
 N COMP,TYPE,OCC,TIME,GMSEQ,HOSPLOC,ICDTEXT,PROVNARR,CPTMOD
"RTN","GMTSLOAD",50,0)
 Q:'$D(^GMT(142.1,GMTJ,0))
"RTN","GMTSLOAD",51,0)
 S GMSEQ=$O(^GMT(142,"AE",GMTJ,GMTSTYP,0))
"RTN","GMTSLOAD",52,0)
 I GMSEQ>0 D
"RTN","GMTSLOAD",53,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,5),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,3)
"RTN","GMTSLOAD",54,0)
 . S OCC=$S(COMP="Y":TYPE,1:"")
"RTN","GMTSLOAD",55,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,3),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,4)
"RTN","GMTSLOAD",56,0)
 . S TIME=$S(COMP="Y":TYPE,1:"")
"RTN","GMTSLOAD",57,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,10),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,6)
"RTN","GMTSLOAD",58,0)
 . S HOSPLOC=$S(COMP="Y":TYPE,1:"")
"RTN","GMTSLOAD",59,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,11),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,7)
"RTN","GMTSLOAD",60,0)
 . S ICDTEXT=$S(COMP="Y":TYPE,1:"")
"RTN","GMTSLOAD",61,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,12),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,8)
"RTN","GMTSLOAD",62,0)
 . S PROVNARR=$S(COMP="Y":TYPE,1:"")
"RTN","GMTSLOAD",63,0)
 . S COMP=$P($G(^GMT(142.1,GMTJ,0)),U,14),TYPE=$P($G(^GMT(142,GMTSTYP,1,GMSEQ,0)),U,9)
"RTN","GMTSLOAD",64,0)
 . S CPTMOD=$S((COMP="Y"&(TYPE'="N")):"Y",(COMP="Y"&(TYPE="N")):"N",1:"")
"RTN","GMTSLOAD",65,0)
 E  D
"RTN","GMTSLOAD",66,0)
 . S OCC=$S($P(^GMT(142.1,GMTJ,0),U,5)="Y":10,1:"")
"RTN","GMTSLOAD",67,0)
 . S TIME=$S($P(^GMT(142.1,GMTJ,0),U,3)="Y":"1Y",1:"")
"RTN","GMTSLOAD",68,0)
 . S HOSPLOC=$S($P(^GMT(142.1,GMTJ,0),U,10)="Y":"Y",1:"")
"RTN","GMTSLOAD",69,0)
 . S ICDTEXT=$S($P(^GMT(142.1,GMTJ,0),U,11)="Y":"L",1:"")
"RTN","GMTSLOAD",70,0)
 . S PROVNARR=$S($P(^GMT(142.1,GMTJ,0),U,12)="Y":"Y",1:"")
"RTN","GMTSLOAD",71,0)
 . S CPTMOD=$S($P(^GMT(142.1,GMTJ,0),U,14)="Y":"Y",1:"")
"RTN","GMTSLOAD",72,0)
 D SETSEG
"RTN","GMTSLOAD",73,0)
 Q
"RTN","GMTSLOAD",74,0)
 ;                  
"RTN","GMTSLOAD",75,0)
SETSEG ; Set Segment
"RTN","GMTSLOAD",76,0)
 ;  GMTSEG(GMI)
"RTN","GMTSLOAD",77,0)
 S GMI=+($G(GMI)) Q:GMI=0  N OFF S OFF=$S($P(^GMT(142.1,GMTJ,0),U,6)="P":1,$P(^(0),U,6)="T":1,1:0)
"RTN","GMTSLOAD",78,0)
 I (+($G(INCLUDE))=0),(OFF=1) Q
"RTN","GMTSLOAD",79,0)
 S GMTSEG(GMI)=(5*GMI)_U_GMTJ_U_OCC_U_TIME_U_U_HOSPLOC_U_ICDTEXT_U_PROVNARR_U_CPTMOD
"RTN","GMTSLOAD",80,0)
 I GMSEQ>0 D SETSEL
"RTN","GMTSLOAD",81,0)
 Q
"RTN","GMTSLOAD",82,0)
SETSEL ; Sets up selection items
"RTN","GMTSLOAD",83,0)
 ;  GMTSEG(GMI,GMSEL)=Selection item
"RTN","GMTSLOAD",84,0)
 N GMSEL,GMITEM,GMW,S2
"RTN","GMTSLOAD",85,0)
 S GMSEL=0 F  S GMSEL=$O(^GMT(142,GMTSTYP,1,+GMSEQ,1,GMSEL)) Q:GMSEL'>0  S GMITEM=^(GMSEL,0) S GMTSEG(GMI,GMSEL)=GMITEM
"RTN","GMTSLOAD",86,0)
 Q
"RTN","GMTSLREM")
0^55^B9996519
"RTN","GMTSLREM",1,0)
GMTSLREM ; SLC/JER,KER - Electron Microscopy Comp Dvr ; 02/27/2002
"RTN","GMTSLREM",2,0)
 ;;2.7;Health Summary;**28,49**;Oct 20, 1995
"RTN","GMTSLREM",3,0)
 ;                      
"RTN","GMTSLREM",4,0)
 ; External Reference
"RTN","GMTSLREM",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSLREM",6,0)
 ;                    
"RTN","GMTSLREM",7,0)
MAIN ; Main Entry Point
"RTN","GMTSLREM",8,0)
 N GMI,MAX,LRDFN,IX,X,IX0 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLREM",9,0)
 S LRDFN=+($G(^DPT(DFN,"LR")))
"RTN","GMTSLREM",10,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSLREM",11,0)
 D ^GMTSLREE Q:'$D(^TMP("LREM",$J))  S IX=0
"RTN","GMTSLREM",12,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LREM",$J,IX)) Q:IX'>0  D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&('GMTSNPG) ! D
"RTN","GMTSLREM",13,0)
 . S IX0=""
"RTN","GMTSLREM",14,0)
 . F  S IX0=$O(^TMP("LREM",$J,IX,IX0)) Q:IX0=""!(IX0?1A)  D
"RTN","GMTSLREM",15,0)
 . . S X=^TMP("LREM",$J,IX,IX0) D WRT
"RTN","GMTSLREM",16,0)
 . I $D(^TMP("LREM",$J,IX,1.2)) D SUPPR
"RTN","GMTSLREM",17,0)
 K ^TMP("LREM",$J)
"RTN","GMTSLREM",18,0)
 Q
"RTN","GMTSLREM",19,0)
WRT ; Writes Electron Microscopy Record
"RTN","GMTSLREM",20,0)
 N IX1,GMJ I IX0=0 D  Q
"RTN","GMTSLREM",21,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLREM",22,0)
 . W ?8,"Collected:",?19,$P(X,U),?31,"Acc:",?36,$P(X,U,2),!
"RTN","GMTSLREM",23,0)
 I IX0=.1 D WRTSPC Q
"RTN","GMTSLREM",24,0)
 I $S(IX0=.2:1,IX0=1:1,IX0=1.1:1,IX0=1.3:1,IX0=1.4:1,1:0) D TEXT Q
"RTN","GMTSLREM",25,0)
 I IX0=2 S IX1=0 F  S IX1=$O(^TMP("LREM",$J,IX,IX0,IX1)) Q:IX1'>0  S X=^(IX1) D WRTP
"RTN","GMTSLREM",26,0)
 Q
"RTN","GMTSLREM",27,0)
WRTSPC ; Writes Specimen field entries
"RTN","GMTSLREM",28,0)
 N GMS D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:"  S GMS=0
"RTN","GMTSLREM",29,0)
 F  S GMS=$O(^TMP("LREM",$J,IX,.1,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LREM",$J,IX,.1,GMS),!
"RTN","GMTSLREM",30,0)
 Q
"RTN","GMTSLREM",31,0)
TEXT ; Handles GROSS DESCRIPTION & MICROSCOPIC EXAM/DX Print
"RTN","GMTSLREM",32,0)
 N LN,GMTSLN,GMTSLNI D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(17-$L(X)),X_":",!
"RTN","GMTSLREM",33,0)
 S LN=0 F  S LN=$O(^TMP("LREM",$J,IX,IX0,LN)) Q:LN'>0  S GMTSLN=^(LN) D
"RTN","GMTSLREM",34,0)
 . I $L(GMTSLN)>78 S GMTSLN=$$WRAP^GMTSORC(GMTSLN,78)
"RTN","GMTSLREM",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLN,"|"),! D
"RTN","GMTSLREM",36,0)
 . . F GMTSLNI=2:1:$L(GMTSLN,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSLN,"|",GMTSLNI)]"" $P(GMTSLN,"|",GMTSLNI),!
"RTN","GMTSLREM",37,0)
 Q
"RTN","GMTSLREM",38,0)
SUPPR ; Writes Supplementary Report
"RTN","GMTSLREM",39,0)
 N GMTSR,SRDATE,GMTSRL,GMTSRLI,X S IX1=0
"RTN","GMTSLREM",40,0)
 F  S IX1=$O(^TMP("LREM",$J,IX,1.2,IX1)) Q:IX1'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LREM",$J,IX,1.2,IX1,0) S X=SRDATE D REGDTM4^GMTSU W "Supplementary Rpt: ",X,! D
"RTN","GMTSLREM",41,0)
 . S GMTSR=0
"RTN","GMTSLREM",42,0)
 . F  S GMTSR=$O(^TMP("LREM",$J,IX,1.2,IX1,GMTSR)) Q:GMTSR'>0  S GMTSRL=^(GMTSR) D
"RTN","GMTSLREM",43,0)
 . . I $L(GMTSRL)>78 S GMTSRL=$$WRAP^GMTSORC(GMTSRL,78)
"RTN","GMTSLREM",44,0)
 . . W $P(GMTSRL,"|"),! D
"RTN","GMTSLREM",45,0)
 . . . F GMTSRLI=2:1:$L(GMTSRL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSRL,"|",GMTSRLI)]"" $P(GMTSRL,"|",GMTSRLI),!
"RTN","GMTSLREM",46,0)
 Q
"RTN","GMTSLREM",47,0)
WRTP ; Writes Procedure field
"RTN","GMTSLREM",48,0)
 N GMQ,GMK
"RTN","GMTSLREM",49,0)
 I $O(^TMP("LREM",$J,IX,IX0,IX1,4,0)) D  Q:$D(GMTSQIT)
"RTN","GMTSLREM",50,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Procedures:"
"RTN","GMTSLREM",51,0)
 S GMT=0
"RTN","GMTSLREM",52,0)
 F  S GMT=$O(^TMP("LREM",$J,IX,IX0,IX1,4,GMT)) Q:GMT'>0  D
"RTN","GMTSLREM",53,0)
 . S GMQ=$P(^TMP("LREM",$J,IX,IX0,IX1,4,GMT),U)
"RTN","GMTSLREM",54,0)
 . I $L(GMQ)>56 S GMQ=$$WRAP^GMTSORC(GMQ,56)
"RTN","GMTSLREM",55,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMQ,"|"),! D
"RTN","GMTSLREM",56,0)
 . . F GMK=2:1:$L(GMQ,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMQ,"|",GMK)]"" ?23,$P(GMQ,"|",GMK),!
"RTN","GMTSLREM",57,0)
 Q
"RTN","GMTSLRMX")
0^56^B20705484
"RTN","GMTSLRMX",1,0)
GMTSLRMX ; SLC/JER,KER - Extended Microbiology Extract ; 02/27/2002
"RTN","GMTSLRMX",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSLRMX",3,0)
 ;                    
"RTN","GMTSLRMX",4,0)
 ; External References
"RTN","GMTSLRMX",5,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSLRMX",6,0)
 ;   DBIA   526  ^LAB(61.2
"RTN","GMTSLRMX",7,0)
 ;   DBIA    63  ^LR(
"RTN","GMTSLRMX",8,0)
 ;   DBIA  2056  $$GET1^DID
"RTN","GMTSLRMX",9,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSLRMX",10,0)
 ;                    
"RTN","GMTSLRMX",11,0)
PARA ; Get Parasitology Work-up
"RTN","GMTSLRMX",12,0)
 N DA,DIC,DIQ,DR,STATUS,PN,SN,RMK,SMEAR,COM
"RTN","GMTSLRMX",13,0)
 I $D(^LR(LRDFN,"MI",IX,5)) D
"RTN","GMTSLRMX",14,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=15,DIQ="STATUS"
"RTN","GMTSLRMX",15,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRMX",16,0)
 . S ^TMP("LRM",$J,"PARA",0)=$E($P(STATUS(63.05,IX,15,"E")," ",1),1,6)
"RTN","GMTSLRMX",17,0)
 S PN=0
"RTN","GMTSLRMX",18,0)
 F  S PN=$O(^LR(LRDFN,"MI",IX,6,PN)) Q:+PN'>0  D
"RTN","GMTSLRMX",19,0)
 . S SN=0
"RTN","GMTSLRMX",20,0)
 . D IDPARA
"RTN","GMTSLRMX",21,0)
 . F  S SN=$O(^LR(LRDFN,"MI",IX,6,PN,1,SN)) Q:+SN'>0  D IDPARA
"RTN","GMTSLRMX",22,0)
 ;   Parasitology smear/prep
"RTN","GMTSLRMX",23,0)
 S SMEAR=0
"RTN","GMTSLRMX",24,0)
 F  S SMEAR=$O(^LR(LRDFN,"MI",IX,24,SMEAR)) Q:SMEAR'>0  S ^TMP("LRM",$J,"PARA","SMEAR",SMEAR)=^(SMEAR,0)
"RTN","GMTSLRMX",25,0)
 ;   Remark
"RTN","GMTSLRMX",26,0)
 S RMK=0
"RTN","GMTSLRMX",27,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,7,RMK)) Q:+RMK'>0  S ^TMP("LRM",$J,"PARA","R",RMK)=^(RMK,0)
"RTN","GMTSLRMX",28,0)
 Q
"RTN","GMTSLRMX",29,0)
IDPARA ; Get parasite stage, quantity, and comment
"RTN","GMTSLRMX",30,0)
 N DA,DIC,DIQ,DR,PARA,STAGE
"RTN","GMTSLRMX",31,0)
 I 'SN S PARA=+^LR(LRDFN,"MI",IX,6,PN,0),PARA=$S($D(EXPAND):PN_";"_$P(^LAB(61.2,PARA,0),U),1:$P(^LAB(61.2,PARA,0),U)),^TMP("LRM",$J,"PARA",PN)=PARA Q
"RTN","GMTSLRMX",32,0)
 S DA=LRDFN,DA(63.05)=IX,DA(63.34)=PN,DA(63.35)=SN,DIC=63,DIQ="STAGE",DIQ(0)="E",DR=5,DR(63.05)=16,DR(63.34)=1,DR(63.35)=".01;1" D EN^DIQ1
"RTN","GMTSLRMX",33,0)
 S ^TMP("LRM",$J,"PARA",PN,SN)=STAGE(63.35,SN,.01,"E")_U_STAGE(63.35,SN,1,"E")
"RTN","GMTSLRMX",34,0)
 ;   Comment
"RTN","GMTSLRMX",35,0)
 S COM=0
"RTN","GMTSLRMX",36,0)
 F  S COM=$O(^LR(LRDFN,"MI",IX,6,PN,1,SN,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"PARA",PN,SN,"COM",COM)=^(COM,0)
"RTN","GMTSLRMX",37,0)
 Q
"RTN","GMTSLRMX",38,0)
MYCO ; Get Mycology Work-up
"RTN","GMTSLRMX",39,0)
 N DA,DIC,DIQ,DR,DA,STATUS,GMW,ISO,FUN,RMK,COM,SMEAR
"RTN","GMTSLRMX",40,0)
 ;   Work-up
"RTN","GMTSLRMX",41,0)
 I $D(^LR(LRDFN,"MI",IX,8)) D
"RTN","GMTSLRMX",42,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=19,DIQ="STATUS"
"RTN","GMTSLRMX",43,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRMX",44,0)
 . S ^TMP("LRM",$J,"MYCO",0)=$E($P(STATUS(63.05,IX,19,"E")," ",1),1,6)
"RTN","GMTSLRMX",45,0)
 S ISO=0
"RTN","GMTSLRMX",46,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,9,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRMX",47,0)
 . D FNGS S ^TMP("LRM",$J,"MYCO",ISO)=$S($D(EXPAND):ISO_";"_FUN,1:FUN)
"RTN","GMTSLRMX",48,0)
 . ;   Comment
"RTN","GMTSLRMX",49,0)
 . S COM=0
"RTN","GMTSLRMX",50,0)
 . F  S COM=$O(^LR(LRDFN,"MI",IX,9,ISO,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"MYCO",ISO,"COM",COM)=^(COM,0)
"RTN","GMTSLRMX",51,0)
 ;   Mycology smear/prep
"RTN","GMTSLRMX",52,0)
 S SMEAR=0
"RTN","GMTSLRMX",53,0)
 F  S SMEAR=$O(^LR(LRDFN,"MI",IX,15,SMEAR)) Q:SMEAR'>0  S ^TMP("LRM",$J,"MYCO","SMEAR",SMEAR)=^(SMEAR,0)
"RTN","GMTSLRMX",54,0)
 ;   Remark
"RTN","GMTSLRMX",55,0)
 S RMK=0
"RTN","GMTSLRMX",56,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,10,RMK)) Q:+RMK'>0  S ^TMP("LRM",$J,"MYCO","R",RMK)=^(RMK,0)
"RTN","GMTSLRMX",57,0)
 Q
"RTN","GMTSLRMX",58,0)
FNGS ; Fungus/Yeast
"RTN","GMTSLRMX",59,0)
 N QTY S FUN=+^LR(LRDFN,"MI",IX,9,ISO,0),QTY=$P(^(0),U,2)
"RTN","GMTSLRMX",60,0)
 S FUN=$P(^LAB(61.2,FUN,0),U),FUN=FUN_U_QTY
"RTN","GMTSLRMX",61,0)
 Q
"RTN","GMTSLRMX",62,0)
TB ; Gets Mycobacteriology Work-up
"RTN","GMTSLRMX",63,0)
 N DA,DIC,DIQ,DR,STATUS,GMW,ISO,MB,RMK,X,%X,Y,%Y,COM,MY,GMTB,GMTBA,GMTBF,GMTBL
"RTN","GMTSLRMX",64,0)
 I $D(^LR(LRDFN,"MI",IX,11)) D
"RTN","GMTSLRMX",65,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)="23;24;25",DIQ="STATUS"
"RTN","GMTSLRMX",66,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRMX",67,0)
 . ;   Status, Acid Fast Stain, Quantity
"RTN","GMTSLRMX",68,0)
 . S ^TMP("LRM",$J,"TB",0)=$E($P(STATUS(63.05,IX,23,"E")," ",1),1,6)_U_STATUS(63.05,IX,24,"E")_U_STATUS(63.05,IX,25,"E")
"RTN","GMTSLRMX",69,0)
 S ISO=0
"RTN","GMTSLRMX",70,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,12,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRMX",71,0)
 . D MYCB S ^TMP("LRM",$J,"TB",ISO)=$S($D(EXPAND):ISO_";"_MB,1:MB)
"RTN","GMTSLRMX",72,0)
 . ;   Comment
"RTN","GMTSLRMX",73,0)
 . S COM=0
"RTN","GMTSLRMX",74,0)
 . F  S COM=$O(^LR(LRDFN,"MI",IX,12,ISO,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"TB",ISO,"COM",COM)=^(COM,0)
"RTN","GMTSLRMX",75,0)
 . ;   Susceptiblities
"RTN","GMTSLRMX",76,0)
 . S GMTB=2
"RTN","GMTSLRMX",77,0)
 . F  S GMTB=$O(^LR(LRDFN,"MI",IX,12,ISO,GMTB)) Q:GMTB'["2."!(GMTB="")  D
"RTN","GMTSLRMX",78,0)
 . . K GMTBL S %X="^DD(63.39,""GL"","_+($G(GMTB))_",1",%Y="GMTBL(" D %XY^%RCR
"RTN","GMTSLRMX",79,0)
 . . S GMTBF=+($O(GMTBL(1,0))),GMTBA=$$GET1^DID(63.39,GMTBF,"","LABEL")
"RTN","GMTSLRMX",80,0)
 . . S ^TMP("LRM",$J,"TB",ISO,"SUSC",GMTB)=GMTBA_U_$P(^LR(LRDFN,"MI",IX,12,ISO,GMTB),U)
"RTN","GMTSLRMX",81,0)
 ;   Remark
"RTN","GMTSLRMX",82,0)
 S RMK=0
"RTN","GMTSLRMX",83,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,13,RMK)) Q:RMK=""  S ^TMP("LRM",$J,"TB","R",RMK)=^(RMK,0)
"RTN","GMTSLRMX",84,0)
 Q
"RTN","GMTSLRMX",85,0)
MYCB ; Mycobacterium
"RTN","GMTSLRMX",86,0)
 N QTY S MB=+^LR(LRDFN,"MI",IX,12,ISO,0),QTY=$P(^(0),U,2)
"RTN","GMTSLRMX",87,0)
 S MB=$P(^LAB(61.2,MB,0),U),MB=MB_U_QTY
"RTN","GMTSLRMX",88,0)
 Q
"RTN","GMTSLRMX",89,0)
VIRO ; Gets Virology Work-up
"RTN","GMTSLRMX",90,0)
 N BUG,DA,DIC,DIQ,DR,GMW,ISO,RMK,STATUS
"RTN","GMTSLRMX",91,0)
 I $D(^LR(LRDFN,"MI",IX,16)) D
"RTN","GMTSLRMX",92,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=34,DIQ="STATUS"
"RTN","GMTSLRMX",93,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRMX",94,0)
 . S ^TMP("LRM",$J,"VIRO",0)=$E($P(STATUS(63.05,IX,34,"E")," ",1),1,6)
"RTN","GMTSLRMX",95,0)
 S ISO=0
"RTN","GMTSLRMX",96,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,17,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRMX",97,0)
 . D PHAGE S ^TMP("LRM",$J,"VIRO",ISO)=$S($D(EXPAND):ISO_";"_BUG,1:BUG)
"RTN","GMTSLRMX",98,0)
 S RMK=0
"RTN","GMTSLRMX",99,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,18,RMK)) Q:RMK=""  S ^TMP("LRM",$J,"VIRO","R",RMK)=^(RMK,0)
"RTN","GMTSLRMX",100,0)
 Q
"RTN","GMTSLRMX",101,0)
PHAGE ; Virus
"RTN","GMTSLRMX",102,0)
 S BUG=+^LR(LRDFN,"MI",IX,17,ISO,0),BUG=$P(^LAB(61.2,BUG,0),U)
"RTN","GMTSLRMX",103,0)
 Q
"RTN","GMTSMCMA")
0^61^B26971145
"RTN","GMTSMCMA",1,0)
GMTSMCMA ; WISC/DCB,KER - Medicine 2.2 interface routine ; 02/27/2002
"RTN","GMTSMCMA",2,0)
 ;;2.7;Health Summary;**4,47,49**;Oct 20, 1995
"RTN","GMTSMCMA",3,0)
 ;                   
"RTN","GMTSMCMA",4,0)
 ; External Refernces
"RTN","GMTSMCMA",5,0)
 ;    DBIA 10064  KILL^XM
"RTN","GMTSMCMA",6,0)
 ;    DBIA 10070  ^XMD
"RTN","GMTSMCMA",7,0)
 ;    DBIA  1236  $$HL7^MCORMN
"RTN","GMTSMCMA",8,0)
 ;    DBIA 10090  ^DIC(4,
"RTN","GMTSMCMA",9,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSMCMA",10,0)
 ;    DBIA 10106  $$HLDATE^HLFNC
"RTN","GMTSMCMA",11,0)
 ;    DBIA 10106  $$HLNAME^HLFNC
"RTN","GMTSMCMA",12,0)
 ;    DBIA 10017  ^DD("DD")
"RTN","GMTSMCMA",13,0)
 ;    DBIA 10106  $$FMDATE^HLFNC
"RTN","GMTSMCMA",14,0)
 ;    DBIA 10106  $$FMNAME^HLFNC
"RTN","GMTSMCMA",15,0)
 ;    DBIA 10072  REMSBMSG^XMA1C
"RTN","GMTSMCMA",16,0)
 ;                  
"RTN","GMTSMCMA",17,0)
HSUM(PATID,BDATE,EDATE,OCC,WH,ATYPE) ; Health Summary API
"RTN","GMTSMCMA",18,0)
 N ARRAY,MESSAGE,MSH,HLECH,ST,ORD,MSTR,LOOP,MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID
"RTN","GMTSMCMA",19,0)
 N REC,LOC,QID,XDEST,WSF,MWDDC,WDC,QRL,BUILDER,LOOP,MESS1,MESS2,TMP,SUB
"RTN","GMTSMCMA",20,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN
"RTN","GMTSMCMA",21,0)
 S ARRAY="TMP(""HS"",$J)"
"RTN","GMTSMCMA",22,0)
 S XMTEXT="TMP(""HS"",$J,"
"RTN","GMTSMCMA",23,0)
 S MSTR="|^~\&",HLECH=$E(MSTR,2,4)
"RTN","GMTSMCMA",24,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",25,0)
 S MESSAGE="TMP",SAP="HEALTH SUMMARY",RAP="MEDICINE",VID=2.1
"RTN","GMTSMCMA",26,0)
 S REC=+$O(^DIC(4,"D",DUZ(2),"")),LOC=$P($G(^DIC(4,REC,0)),U,1)
"RTN","GMTSMCMA",27,0)
 S (RNF,SNF)=LOC,RAP="Medicine",SAP="Health Summary",MST="HS",PCI="P"
"RTN","GMTSMCMA",28,0)
 S @ARRAY@(1,0)=$$MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID)
"RTN","GMTSMCMA",29,0)
 S ATYPE=$S(ATYPE="F":"RD",ATYPE="C":"RD",1:"PG")
"RTN","GMTSMCMA",30,0)
 S QRL=$$CONVERT("D",BDATE)_ST(2)_$$CONVERT("D",EDATE)
"RTN","GMTSMCMA",31,0)
 S QFC="R",QLR=ATYPE_ST(2)_OCC,WSF=PATID,WDDC=WH
"RTN","GMTSMCMA",32,0)
 S @ARRAY@(2,0)=$$QRD(WSF,WDDC,QFC,QLR,QRL)
"RTN","GMTSMCMA",33,0)
 S XMSUB="Health Summary Request",XMDUN="HEALTH SUMMARY"
"RTN","GMTSMCMA",34,0)
 S XMY("G.MC MESSAGING SERVER")=""
"RTN","GMTSMCMA",35,0)
 S XMDUZ=".5" ;Needs to be set so dots aren't displayed
"RTN","GMTSMCMA",36,0)
 D ^XMD I +($G(XMZ))=0 D KILL^XM Q
"RTN","GMTSMCMA",37,0)
 S MESS1=XMZ
"RTN","GMTSMCMA",38,0)
 D KILL^XM
"RTN","GMTSMCMA",39,0)
 S ARRY=$$HL7^MCORMN(MESS1) D:+ARRY=0 REMOVE(MESS1,+ARRY) Q:+ARRY=0
"RTN","GMTSMCMA",40,0)
 K ^TMP("MCAR",$J)
"RTN","GMTSMCMA",41,0)
 D SLIT(ARRY)
"RTN","GMTSMCMA",42,0)
 D REMOVE(MESS1,ARRY)
"RTN","GMTSMCMA",43,0)
 Q
"RTN","GMTSMCMA",44,0)
SLIT(ARRY) ; Reformat Array
"RTN","GMTSMCMA",45,0)
 N LOOP,COUNT,BASE,MCOUNT,BUILDER
"RTN","GMTSMCMA",46,0)
 S BUILDER="^XMB(3.9,"_ARRY_",2)"
"RTN","GMTSMCMA",47,0)
 S LOOP=0,(MCOUNT,COUNT)=0,SUB=1,BASE="^TMP(""MCAR"",$J)"
"RTN","GMTSMCMA",48,0)
 F  S LOOP=$O(@BUILDER@(LOOP)) Q:LOOP=""  D SLITTER
"RTN","GMTSMCMA",49,0)
 Q
"RTN","GMTSMCMA",50,0)
SLITTER ; This will slit the message in a usable form
"RTN","GMTSMCMA",51,0)
 N VALUE,ROY,ROUT,LINE
"RTN","GMTSMCMA",52,0)
 S VALUE=@BUILDER@(LOOP,0),ROY=$E(VALUE,1,3)
"RTN","GMTSMCMA",53,0)
 S ROUT=$S(ROY="MSH":"SMSH",ROY="PID":"SPID",ROY="OBR":"SOBR",ROY="OBX":"SOBX",ROY="MSH":"SMSH",1:"OTHER")
"RTN","GMTSMCMA",54,0)
 ;S LINE="D "_ROUT_"("""_VALUE_""")"
"RTN","GMTSMCMA",55,0)
 S LINE="D "_ROUT_"(VALUE)"
"RTN","GMTSMCMA",56,0)
 X LINE
"RTN","GMTSMCMA",57,0)
 Q
"RTN","GMTSMCMA",58,0)
SMSH(VALUE) ; Slit the message header
"RTN","GMTSMCMA",59,0)
 N PROC,LOOP
"RTN","GMTSMCMA",60,0)
 S MSTR=$E(VALUE,4,8),SUB=1
"RTN","GMTSMCMA",61,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",62,0)
 S MCOUNT=MCOUNT+1,COUNT=1
"RTN","GMTSMCMA",63,0)
 S PROC=$P($P(VALUE,ST(1),3),U,1)
"RTN","GMTSMCMA",64,0)
 S @BASE@(MCOUNT,COUNT,1)="PROCEDURE"_U_U_PROC
"RTN","GMTSMCMA",65,0)
 D SETREF(MCOUNT,COUNT,"PROCEDURE")
"RTN","GMTSMCMA",66,0)
 Q
"RTN","GMTSMCMA",67,0)
SPID(VALUE) ; Slit the PID
"RTN","GMTSMCMA",68,0)
 S SUB=1
"RTN","GMTSMCMA",69,0)
 Q
"RTN","GMTSMCMA",70,0)
SOBR(VALUE) ; Slit the OBR
"RTN","GMTSMCMA",71,0)
 N TEMP,XDATE
"RTN","GMTSMCMA",72,0)
 S TEMP=$$CONVERTA("D",$P(VALUE,ST(1),8))
"RTN","GMTSMCMA",73,0)
 S XDATE=TEMP,COUNT=COUNT+1,SUB=1
"RTN","GMTSMCMA",74,0)
 S @BASE@(MCOUNT,COUNT,1)="DATE/TIME"_U_U_TEMP
"RTN","GMTSMCMA",75,0)
 D SETREF(MCOUNT,COUNT,"DATE/TIME")
"RTN","GMTSMCMA",76,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),33))
"RTN","GMTSMCMA",77,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="PRINCIPAL RESUILT INTERPRETER"_U_U_TEMP D SETREF(MCOUNT,COUNT,"PRINCIPAL RESULT INTERPRETER") S COUNT=COUNT+1
"RTN","GMTSMCMA",78,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),34))
"RTN","GMTSMCMA",79,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="ASSISTANT RESUILT INTERPRETER"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"ASSISTANT RESULT") S COUNT=COUNT+1
"RTN","GMTSMCMA",80,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),35))
"RTN","GMTSMCMA",81,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="TECHNICIAN"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"TECHNICIAN") S COUNT=COUNT+1
"RTN","GMTSMCMA",82,0)
 Q
"RTN","GMTSMCMA",83,0)
SOBX(VALUE) ; Slit the OBX
"RTN","GMTSMCMA",84,0)
 N XDES,TEMP,FLDTYPE,UNITS,VAL
"RTN","GMTSMCMA",85,0)
 S COUNT=COUNT+1
"RTN","GMTSMCMA",86,0)
 S SUB=1,TEMP=$P(VALUE,ST(1),4),XDES=$P(TEMP,ST(2),2)
"RTN","GMTSMCMA",87,0)
 S TEMP=$P(TEMP,ST(2),1),FLDTYPE=$P(TEMP,ST(3),3)
"RTN","GMTSMCMA",88,0)
 S:FLDTYPE=+FLDTYPE XDES=XDES_";W"
"RTN","GMTSMCMA",89,0)
 S VAL=$$CONVERTA(FLDTYPE,$P(VALUE,ST(1),6))
"RTN","GMTSMCMA",90,0)
 S UNITS=$P(TEMP,ST(1),7)
"RTN","GMTSMCMA",91,0)
 S @BASE@(MCOUNT,COUNT,1)=XDES_U_UNITS_U_VAL
"RTN","GMTSMCMA",92,0)
 D SETREF(MCOUNT,COUNT,XDES)
"RTN","GMTSMCMA",93,0)
 Q
"RTN","GMTSMCMA",94,0)
OTHER(VALUE) ; Set the next sub node if the lines continue
"RTN","GMTSMCMA",95,0)
 N TEMP,UNITS
"RTN","GMTSMCMA",96,0)
 S TEMP=$P(VALUE,ST(1),1),UNITS=$P(VALUE,ST(1),2),SUB=SUB+1
"RTN","GMTSMCMA",97,0)
 S @BASE@(MCOUNT,COUNT,SUB)=U_U_TEMP
"RTN","GMTSMCMA",98,0)
 S:UNITS'="" $P(@BASE@(MCOUNT,COUNT,1),U,2)=UNITS
"RTN","GMTSMCMA",99,0)
 Q
"RTN","GMTSMCMA",100,0)
MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID) ; MSH Messaging Line
"RTN","GMTSMCMA",101,0)
 N MSH,Y,%,%I
"RTN","GMTSMCMA",102,0)
 S MSH="MSH"_MSTR,$P(MSH,ST(1),3)=SAP,$P(MSH,ST(1),4)=SNF
"RTN","GMTSMCMA",103,0)
 D NOW^%DTC S $P(MSH,ST(1),8)=$$CONVERT("D",%)
"RTN","GMTSMCMA",104,0)
 S $P(MSH,ST(1),5)=RAP,$P(MSH,ST(1),6)=RNF,$P(MSH,ST(1),9)=MST
"RTN","GMTSMCMA",105,0)
 S $P(MSH,ST(1),10)=PCI,$P(MSH,ST(1),11)=VID
"RTN","GMTSMCMA",106,0)
 Q MSH
"RTN","GMTSMCMA",107,0)
QRD(WSF,WDDC,QFC,QLR,QRL) ; QRD Messaging Line
"RTN","GMTSMCMA",108,0)
 N QRD,Y,%,%I
"RTN","GMTSMCMA",109,0)
 S QRD="QRD"
"RTN","GMTSMCMA",110,0)
 D NOW^%DTC S $P(ORD,ST(1),2)=$$CONVERT("D",%)
"RTN","GMTSMCMA",111,0)
 S $P(QRD,ST(1),3)=QFC,$P(QRD,ST(1),4)="I"
"RTN","GMTSMCMA",112,0)
 S $P(QRD,ST(1),6)=$J,$P(QRD,ST(1),8)=QLR
"RTN","GMTSMCMA",113,0)
 S $P(QRD,ST(1),9)=WSF,$P(QRD,ST(1),11)=WDDC,$P(QRD,ST(1),12)=QRL
"RTN","GMTSMCMA",114,0)
 Q QRD
"RTN","GMTSMCMA",115,0)
CONVERT(FILETYPE,RST) ; Convert FileMan to HL7
"RTN","GMTSMCMA",116,0)
 N TEMP
"RTN","GMTSMCMA",117,0)
 S TEMP=RST
"RTN","GMTSMCMA",118,0)
 S:FILETYPE="D" TEMP=$$HLDATE^HLFNC(RST,"TS")
"RTN","GMTSMCMA",119,0)
 S:FILETYPE="P" TEMP=$$HLNAME^HLFNC(RST)
"RTN","GMTSMCMA",120,0)
 Q TEMP
"RTN","GMTSMCMA",121,0)
CONVERTA(FILETYPE,RST) ; Convert HL7 to FileMan
"RTN","GMTSMCMA",122,0)
 N TEMP,Y
"RTN","GMTSMCMA",123,0)
 S TEMP=RST
"RTN","GMTSMCMA",124,0)
 I FILETYPE["D" S Y=$$FMDATE^HLFNC(RST) X ^DD("DD") S TEMP=Y
"RTN","GMTSMCMA",125,0)
 S:(FILETYPE["P200")!(FILETYPE["P690") TEMP=$$FMNAME^HLFNC(RST)
"RTN","GMTSMCMA",126,0)
 Q TEMP
"RTN","GMTSMCMA",127,0)
REMOVE(MESS1,MESS2) ; Remove messages from the server basket
"RTN","GMTSMCMA",128,0)
 N LOOP,XMSER S MESS1=+($G(MESS1)),MESS2=+($G(MESS2))
"RTN","GMTSMCMA",129,0)
 F LOOP=MESS1,MESS2 S XMSER="S.MCHL7SERVER" S XMZ=LOOP D:LOOP'=0 REMSBMSG^XMA1C
"RTN","GMTSMCMA",130,0)
 D KILL^XM
"RTN","GMTSMCMA",131,0)
 Q
"RTN","GMTSMCMA",132,0)
SETREF(MCOUNT,COUNT,XDES) ; Set Count
"RTN","GMTSMCMA",133,0)
 S:XDES'="" @BASE@(MCOUNT,"B",XDES,COUNT)=""
"RTN","GMTSMCMA",134,0)
 Q
"RTN","GMTSMHPE")
0^35^B20887960
"RTN","GMTSMHPE",1,0)
GMTSMHPE ; SLC/JER,KER - Mental Health Physical Exam Component ; 02/27/2002
"RTN","GMTSMHPE",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSMHPE",3,0)
 ;                     
"RTN","GMTSMHPE",4,0)
 ; External References
"RTN","GMTSMHPE",5,0)
 ;   DBIA  1280  ^MR(    (file #90)
"RTN","GMTSMHPE",6,0)
 ;   DBIA 10015  EN^DIQ1 (file #90)
"RTN","GMTSMHPE",7,0)
 ;                    
"RTN","GMTSMHPE",8,0)
MAIN ; Main control
"RTN","GMTSMHPE",9,0)
 N GMCKC,GMDATA,GMDATE,GMEND,GMTSE,GMTSB,GMFLD,GMI,GMIL,GMTIMES,GMX,MAX Q:'$G(DFN)  Q:'$D(^MR(+DFN,"PE"))
"RTN","GMTSMHPE",10,0)
 S GMTSB=$G(GMTS1) S:GMTSB'?7N GMTSB=6666666 S GMTSE=$G(GMTS2) S:GMTSE'?7N GMTSE=9999999
"RTN","GMTSMHPE",11,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSMHPE",12,0)
 S GMTIMES=0
"RTN","GMTSMHPE",13,0)
PHYEXAM ; Check for existence of PHYSICAL EXAM data
"RTN","GMTSMHPE",14,0)
 S GMEND=GMTSE S GMDATE=GMTSB-.1
"RTN","GMTSMHPE",15,0)
 F  S GMDATE=$O(^MR(+DFN,"PE",GMDATE)) Q:GMDATE']""!(GMDATE>GMEND)  D  Q:$D(GMTSQIT)!(MAX'>GMTIMES)
"RTN","GMTSMHPE",16,0)
 . N DIC,DIQ,DA,DR
"RTN","GMTSMHPE",17,0)
 . K ^UTILITY("DIQ1",$J)
"RTN","GMTSMHPE",18,0)
 . S DIC="^MR(",DA=+DFN,DR=100,DIQ(0)="EN"
"RTN","GMTSMHPE",19,0)
 . S DR(90.01)=".01:34",DA(90.01)=+GMDATE,DR(90.02)=.01,DA(90.02)=0
"RTN","GMTSMHPE",20,0)
 . S DR(90.03)=.01,DA(90.03)=0
"RTN","GMTSMHPE",21,0)
 . D EN^DIQ1
"RTN","GMTSMHPE",22,0)
 . Q:'$D(^UTILITY("DIQ1",$J))
"RTN","GMTSMHPE",23,0)
 . S GMTIMES=GMTIMES+1
"RTN","GMTSMHPE",24,0)
 . D VS(+DFN,+GMDATE) Q:$D(GMTSQIT)
"RTN","GMTSMHPE",25,0)
 . D OMITABN
"RTN","GMTSMHPE",26,0)
 . D SHOWOMIT Q:$D(GMTSQIT)
"RTN","GMTSMHPE",27,0)
 . D SHOWABN Q:$D(GMTSQIT)
"RTN","GMTSMHPE",28,0)
 . W !
"RTN","GMTSMHPE",29,0)
 K ^UTILITY("DIQ1",$J)
"RTN","GMTSMHPE",30,0)
 Q
"RTN","GMTSMHPE",31,0)
 ;
"RTN","GMTSMHPE",32,0)
VS(DFN,GMDATE) ; Show vital signs
"RTN","GMTSMHPE",33,0)
 N GMI,GMTXT D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSMHPE",34,0)
 W "VITAL SIGNS DATE: ",$S($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.01,"E"))]"":^("E"),1:"Unknown")
"RTN","GMTSMHPE",35,0)
 W ?40,"Examiner: ",$S($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,29,"E"))]"":^("E"),1:"Unknown")
"RTN","GMTSMHPE",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSMHPE",37,0)
 W !,"Temp: ",$S($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.04,"E")):^("E")_"F",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,34,"E")):^("E")_"C",1:"")
"RTN","GMTSMHPE",38,0)
 W ?14,"Pulse: ",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.05,"E"))
"RTN","GMTSMHPE",39,0)
 W ?28,"Resp: ",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.07,"E"))
"RTN","GMTSMHPE",40,0)
 W ?42,"BP: ",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.06,"E"))
"RTN","GMTSMHPE",41,0)
 W ?56,"Ht: ",$S($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.02,"E")):^("E")_"in",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,32,"E")):^("E")_"cm",1:"")
"RTN","GMTSMHPE",42,0)
 W ?70,"Wt: ",$S($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.03,"E")):^("E")_"lb",$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,33,"E")):^("E")_"kg",1:""),!!
"RTN","GMTSMHPE",43,0)
 I +$O(^MR(+DFN,"PE",+GMDATE,19,0)) D  Q:$D(GMTSQIT)  W !
"RTN","GMTSMHPE",44,0)
 . W "Comments:",!
"RTN","GMTSMHPE",45,0)
 . S GMI=0 F  S GMI=$O(^MR(+DFN,"PE",+GMDATE,19,GMI)) Q:GMI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSMHPE",46,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,$G(^MR(+DFN,"PE",+GMDATE,19,GMI,0)),!
"RTN","GMTSMHPE",47,0)
 I +$O(^MR(+DFN,"PE",+GMDATE,20,0)) D  Q:$D(GMTSQIT)  W !
"RTN","GMTSMHPE",48,0)
 . W "Initial Impression:",!  S GMI=0
"RTN","GMTSMHPE",49,0)
 . F  S GMI=$O(^MR(+DFN,"PE",+GMDATE,20,GMI)) Q:GMI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSMHPE",50,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,$G(^MR(+DFN,"PE",+GMDATE,20,GMI,0)),!
"RTN","GMTSMHPE",51,0)
 S GMTXT=$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,.9,"E")) Q:GMTXT']""
"RTN","GMTSMHPE",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "General Appearance: "
"RTN","GMTSMHPE",53,0)
 I $L(GMTXT)>59 S GMTXT=$$WRAP^GMTSORC(GMTXT,60)
"RTN","GMTSMHPE",54,0)
 F GMI=1:1:$L(GMTXT,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTXT,"|",GMI)]"" ?20,$P(GMTXT,"|",GMI),!
"RTN","GMTSMHPE",55,0)
 W !
"RTN","GMTSMHPE",56,0)
 Q
"RTN","GMTSMHPE",57,0)
OMITABN ; Get PHYSICAL EXAM 'Omits' and 'Abnormals'
"RTN","GMTSMHPE",58,0)
 N GMFLD,GMX K GMDATA F GMFLD=2:1:19 D
"RTN","GMTSMHPE",59,0)
 . S GMX=$E($G(^UTILITY("DIQ1",$J,90.01,+GMDATE,+GMFLD,"E")))
"RTN","GMTSMHPE",60,0)
 . Q:GMX'?1U  I GMX="O" S GMDATA("OM",+GMFLD)=$$SYS(+GMFLD)
"RTN","GMTSMHPE",61,0)
 . I GMX="A" S GMDATA("AB",+GMFLD)=$$SYS(+GMFLD)_"^"_$G(^UTILITY("DIQ1",$J,90.01,+GMDATE,+GMFLD_.9,"E"))
"RTN","GMTSMHPE",62,0)
 Q
"RTN","GMTSMHPE",63,0)
 ;
"RTN","GMTSMHPE",64,0)
SHOWOMIT ;   Show 'Omits'
"RTN","GMTSMHPE",65,0)
 N GMYST,GMPHY D CKP^GMTSUP Q:$D(GMTSQIT)  W "Omissions: "
"RTN","GMTSMHPE",66,0)
 I '$D(GMDATA("OM")) W " None",!! Q
"RTN","GMTSMHPE",67,0)
 S GMYST=0 F  S GMYST=$O(GMDATA("OM",GMYST)) Q:GMYST'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSMHPE",68,0)
 . S GMPHY=GMDATA("OM",GMYST) I (($L(GMPHY)+$X)>(IOM-2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?11
"RTN","GMTSMHPE",69,0)
 . W GMPHY W:+$O(GMDATA("OM",GMYST)) ", "
"RTN","GMTSMHPE",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSMHPE",71,0)
 Q
"RTN","GMTSMHPE",72,0)
 ;
"RTN","GMTSMHPE",73,0)
SHOWABN ;   Show 'Abnormals'
"RTN","GMTSMHPE",74,0)
 N GMI,GMTXT,GMYST,GMPHY D CKP^GMTSUP Q:$D(GMTSQIT)  W "Abnormal Findings: "
"RTN","GMTSMHPE",75,0)
 I '$D(GMDATA("AB")) W " None",!! Q
"RTN","GMTSMHPE",76,0)
 W ! S GMYST=0 F  S GMYST=$O(GMDATA("AB",GMYST)) Q:GMYST'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSMHPE",77,0)
 . S GMPHY=$P(GMDATA("AB",GMYST),"^",1) Q:GMPHY']""
"RTN","GMTSMHPE",78,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMTSNPG " Abnormal Findings (cont'd):",! W ?(17-$L(GMPHY)),GMPHY,":"
"RTN","GMTSMHPE",79,0)
 . S GMTXT=$P(GMDATA("AB",GMYST),"^",2) Q:GMTXT']""
"RTN","GMTSMHPE",80,0)
 . I $L(GMTXT)>60 S GMTXT=$$WRAP^GMTSORC(GMTXT,60)
"RTN","GMTSMHPE",81,0)
 . F GMI=1:1:$L(GMTXT,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTXT,"|",GMI)]"" ?19,$P(GMTXT,"|",GMI),!
"RTN","GMTSMHPE",82,0)
 W !
"RTN","GMTSMHPE",83,0)
 Q
"RTN","GMTSMHPE",84,0)
 ;
"RTN","GMTSMHPE",85,0)
SYS(GMHSYST) ; Physical System
"RTN","GMTSMHPE",86,0)
 S GMHSYST=$P("^Head^Eyes^Ears^Nose^Mouth^Neck^Chest&Breasts^Lungs^Heart^Abdomen^Genitalia^Pelvic^Rectum^Back^Extremities^Neurological^Skin^Lymph",U,GMHSYST)
"RTN","GMTSMHPE",87,0)
 Q GMHSYST
"RTN","GMTSP49")
0^^B8556085
"RTN","GMTSP49",1,0)
GMTSP49 ; SLC/KER - GMTS*2.7*49 Post-Install    ; 02/27/2002
"RTN","GMTSP49",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSP49",3,0)
 Q
"RTN","GMTSP49",4,0)
 ; External References
"RTN","GMTSP49",5,0)
 ;   DBIA 10013  ^DIK
"RTN","GMTSP49",6,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSP49",7,0)
 ;   DBIA 10018  ^DIE
"RTN","GMTSP49",8,0)
 ;   DBIA  1023  $$FIRSTUP^VAQUTL50
"RTN","GMTSP49",9,0)
 ;   DBIA 10075  ^DIC(19
"RTN","GMTSP49",10,0)
 ;   DBIA   820  ^VAT(394.71
"RTN","GMTSP49",11,0)
 ;                           
"RTN","GMTSP49",12,0)
PRE ; Pre-Install
"RTN","GMTSP49",13,0)
 N GMTSEX,GMTSOPT,GMTSC,GMTSL,DA,DIK,DIC,X,Y,DTOUT,DUOUT S GMTSC=0,GMTSOPT=""
"RTN","GMTSP49",14,0)
 F GMTSL=1:1 D RM(GMTSL) Q:'$L(GMTSOPT)
"RTN","GMTSP49",15,0)
 F GMTSL=1:1 D RO(GMTSL) Q:'$L(GMTSOPT)
"RTN","GMTSP49",16,0)
 Q
"RTN","GMTSP49",17,0)
RM(X) ;   Remove Option from Menu
"RTN","GMTSP49",18,0)
 N GMTSL,GMTSO,GMTSM,GMTSI,DA,DIK S GMTSL=+($G(X)),GMTSOPT="" S GMTSEX="S GMTSOPT=$T(OPTS+"_GMTSL_")"
"RTN","GMTSP49",19,0)
 X GMTSEX S GMTSOPT=$$NM(GMTSOPT),X=GMTSOPT Q:'$L(X)  S Y=$$OPT(X) Q:Y'>0  S GMTSO=+($G(Y)),GMTSM=0 Q:GMTSO=0
"RTN","GMTSP49",20,0)
 F  S GMTSM=$O(^DIC(19,"AD",GMTSO,GMTSM)) Q:+GMTSM=0  D
"RTN","GMTSP49",21,0)
 . S GMTSI=0 F  S GMTSI=$O(^DIC(19,"AD",GMTSO,GMTSM,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSP49",22,0)
 . . Q:'$D(^DIC(19,GMTSM,10,GMTSI))  S DA(1)=GMTSM,DA=GMTSI,DIK="^DIC(19,"_DA(1)_",10," D ^DIK
"RTN","GMTSP49",23,0)
 Q
"RTN","GMTSP49",24,0)
RO(X) ;   Remove Option
"RTN","GMTSP49",25,0)
 N GMTSL,GMTSO,GMTSM,GMTSI,DA,DIK S GMTSL=+($G(X)),GMTSOPT="" S GMTSEX="S GMTSOPT=$T(OPTS+"_GMTSL_")"
"RTN","GMTSP49",26,0)
 X GMTSEX S GMTSOPT=$$NM(GMTSOPT),X=GMTSOPT Q:'$L(X)  S Y=$$OPT(X) Q:Y'>0
"RTN","GMTSP49",27,0)
 S GMTSO=+($G(Y)),GMTSM=0 Q:GMTSO=0  Q:'$D(^DIC(19,GMTSO))  S DA=GMTSO,DIK="^DIC(19," D ^DIK
"RTN","GMTSP49",28,0)
 Q
"RTN","GMTSP49",29,0)
NM(X) ;   Option Name
"RTN","GMTSP49",30,0)
 S X=$G(X) S:X[";" X=$P(X,";",2) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSP49",31,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSP49",32,0)
 Q X
"RTN","GMTSP49",33,0)
OPT(X) ;   Lookup Option
"RTN","GMTSP49",34,0)
 N Y,DIC,DTOUT,DUOUT S DIC="^DIC(19,",DIC(0)="MXO",X=$G(X) Q:'$L(X) -1  D ^DIC S X=+Y Q X
"RTN","GMTSP49",35,0)
 ;                    
"RTN","GMTSP49",36,0)
POST ; HS Segment Names/Abbreviations in ^VAT(394.71)
"RTN","GMTSP49",37,0)
 N GMTSI,GMTSN,GMTSC,GMTSCN,GMTSCA,GMTSVN,GMTSVA,GMTSNN,GMTSNA S GMTSI=0  F  S GMTSI=$O(^VAT(394.71,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSP49",38,0)
 . S GMTSN=$G(^VAT(394.71,GMTSI,0)),GMTSC=$P(GMTSN,"^",4)
"RTN","GMTSP49",39,0)
 . S GMTSVN=$P(GMTSN,"^",1),GMTSVA=$P(GMTSN,"^",2)
"RTN","GMTSP49",40,0)
 . Q:+GMTSC=0  S GMTSN=$G(^GMT(142.1,+GMTSC,0))
"RTN","GMTSP49",41,0)
 . S GMTSCN=$P(GMTSN,"^",1),GMTSCA=$P(GMTSN,"^",4)
"RTN","GMTSP49",42,0)
 . Q:'$L(GMTSCN)  Q:'$L(GMTSCA)
"RTN","GMTSP49",43,0)
 . I $L($T(FIRSTUP^VAQUTL50)) D  Q
"RTN","GMTSP49",44,0)
 . . S GMTSNN=$$FIRSTUP^VAQUTL50(GMTSCN),GMTSNA=GMTSCA D EDIT
"RTN","GMTSP49",45,0)
 . I $L($T(EN2^GMTSUMX)) D  Q
"RTN","GMTSP49",46,0)
 . . S GMTSNN=$$EN2^GMTSUMX(GMTSCN),GMTSNA=GMTSCA D EDIT
"RTN","GMTSP49",47,0)
 Q
"RTN","GMTSP49",48,0)
EDIT ;   Edit Record
"RTN","GMTSP49",49,0)
 Q:+($G(GMTSI))=0  Q:'$L(GMTSNN)  Q:'$L(GMTSNA)  Q:GMTSNN=GMTSVN&(GMTSNA=GMTSCA)
"RTN","GMTSP49",50,0)
 N DIE,DR,DA,GMTSC,GMTST S GMTSC=0,DA=+($G(GMTSI))
"RTN","GMTSP49",51,0)
 S DIE="^VAT(394.71,",DR=".01///^S X=$G(GMTSNN);.02///^S X=$G(GMTSNA)"
"RTN","GMTSP49",52,0)
LOCK ;     Lock Record for Edit
"RTN","GMTSP49",53,0)
 L +^VAT(394.71,+($G(DA))):0 S GMTSC=GMTSC+1,GMTST=$T
"RTN","GMTSP49",54,0)
 I 'GMTST,GMTSC'>10 H 5 G LOCK
"RTN","GMTSP49",55,0)
 I 'GMTST,GMTSC>10 Q
"RTN","GMTSP49",56,0)
 D ^DIE L -^VAT(394.71,+($G(DA)))
"RTN","GMTSP49",57,0)
 Q
"RTN","GMTSP49",58,0)
 ;                    
"RTN","GMTSP49",59,0)
OPTS ; Option List
"RTN","GMTSP49",60,0)
 ;GMTS GUI SITE ADD/EDIT LIST
"RTN","GMTSP49",61,0)
 ;GMTS GUI SITE COMPILE METHOD
"RTN","GMTSP49",62,0)
 ;GMTS GUI SITE DISPLAY DEFAULTS
"RTN","GMTSP49",63,0)
 ;GMTS GUI SITE PRECEDENCE
"RTN","GMTSP49",64,0)
 ;GMTS GUI SITE RESEQUENCE
"RTN","GMTSP49",65,0)
 ;GMTS GUI DISPLAY SITE DEFAULTS
"RTN","GMTSP49",66,0)
 ;GMTS GUI SITE DEFAULTS
"RTN","GMTSPD")
0^38^B26570597
"RTN","GMTSPD",1,0)
GMTSPD ; SLC/JER,KER - Interactive Print-by-Location ; 02/27/2002
"RTN","GMTSPD",2,0)
 ;;2.7;Health Summary;**28,30,47,49**;Oct 20, 1995
"RTN","GMTSPD",3,0)
 ;
"RTN","GMTSPD",4,0)
 ; External
"RTN","GMTSPD",5,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPD",6,0)
 ;    DBIA 10040  ^SC("B"
"RTN","GMTSPD",7,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPD",8,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPD",9,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPD",10,0)
 ;    DBIA   510  ^DISV(
"RTN","GMTSPD",11,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPD",12,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPD",13,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPD",14,0)
 ;    DBIA 10006  ^DIC (file #42 and #44)
"RTN","GMTSPD",15,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPD",16,0)
 ;    DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSPD",17,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPD",18,0)
 ;                           
"RTN","GMTSPD",19,0)
MAIN ; Interactive Print by Location
"RTN","GMTSPD",20,0)
 N GMPSAP,GMTSCDT,GMTSTYP,GMLOC,GMTSTN,GMTSSC
"RTN","GMTSPD",21,0)
 S GMTSTYP=0 K DIROUT
"RTN","GMTSPD",22,0)
 F  D  Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",23,0)
 . S GMTSTYP=+($$SELTYP) Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",24,0)
 . F  D  Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)!($D(GMTSSC("ALL")))
"RTN","GMTSPD",25,0)
 . . K GMTSSC,DUOUT D SELLOC(.GMTSSC) Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",26,0)
 . . D CHKLOC(.GMTSSC) Q:$O(GMTSSC(0))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",27,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSPD",28,0)
 . . N DIROUT D HSOUT^GMTSPD2 W ! S DUOUT=1
"RTN","GMTSPD",29,0)
 Q
"RTN","GMTSPD",30,0)
SELTYP() ; Select Health Summary type
"RTN","GMTSPD",31,0)
 N DIC,X,Y
"RTN","GMTSPD",32,0)
 I $D(^DISV(DUZ,"^GMT(142,")),+$G(GMTSTYP)=0 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U)
"RTN","GMTSPD",33,0)
 S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSPD",34,0)
 S DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSPD",35,0)
 S Y=$$TYPE^GMTSULT I +Y'>0,X="^^" S DIROUT=1
"RTN","GMTSPD",36,0)
 I +Y>0,$S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) D
"RTN","GMTSPD",37,0)
 . W !,"This Summary Type includes no components...Please choose another."
"RTN","GMTSPD",38,0)
 Q Y
"RTN","GMTSPD",39,0)
SELLOC(GMX) ; Select multiple Hospital Location
"RTN","GMTSPD",40,0)
 N DIC,LOC,Y,X,DIR,GMTSLC
"RTN","GMTSPD",41,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: ",GMTSLC=0
"RTN","GMTSPD",42,0)
 I $D(^XUSEC("GMTS VIEW ONLY",+($G(DUZ)))) S GMTSLC=1
"RTN","GMTSPD",43,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",44,0)
 F  D  Q:+$G(GMX(+$G(Y)))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)  Q:GMTSLC<0
"RTN","GMTSPD",45,0)
 . D:GMTSLC'>0 ASK Q:$D(GMX("ALL"))
"RTN","GMTSPD",46,0)
 . D:GMTSLC>0 ^DIC S GMTSLC=GMTSLC+1 Q:$G(DIROUT)=1
"RTN","GMTSPD",47,0)
 . I +Y'>0 S:X="^^" DIROUT=1 Q
"RTN","GMTSPD",48,0)
 . S GMX(+Y)=$P(Y,U,1,2)_U_$P(Y(0),U,3)
"RTN","GMTSPD",49,0)
 . S $P(GMX,U)=+Y
"RTN","GMTSPD",50,0)
 . I "COR"[$P(Y(0),U,3) S $P(GMX,U,3)="COR"
"RTN","GMTSPD",51,0)
 . S DIC("A")="Select Next Hospital Location: "
"RTN","GMTSPD",52,0)
 Q
"RTN","GMTSPD",53,0)
ASK ; Prompt for One or ALL
"RTN","GMTSPD",54,0)
 N DIR,LAST S DIR("A")="Select Hospital Location: "
"RTN","GMTSPD",55,0)
 S LAST=$G(^DISV(+($G(DUZ)),"^SC(")),LAST=$S(+LAST>0:$P($G(^SC(+LAST,0)),"^",1),1:"") S:$L(LAST) DIR("B")=LAST
"RTN","GMTSPD",56,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D A1^GMTSPD",DIR("??")="^D A2^GMTSPD"
"RTN","GMTSPD",57,0)
 D ^DIR I $$UP^XLFSTR(Y)="ALL" D  Q
"RTN","GMTSPD",58,0)
 . K GMX S GMX="1^ALL^COR",GMX("ALL")="",GMX(1)="1^ALL^C",GMTSLC=-1
"RTN","GMTSPD",59,0)
 N DIC S DIC=44,DIC(0)="MZ"
"RTN","GMTSPD",60,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",61,0)
 D ^DIC I +Y'>0 S:X["^^" DIROUT=1,GMTSEXIT="^^" Q
"RTN","GMTSPD",62,0)
 Q
"RTN","GMTSPD",63,0)
A1 ; Single ? Help
"RTN","GMTSPD",64,0)
 W !,"  Answer with HOSPITAL LOCATION NAME, or ABBREVIATION, TEAM or 'ALL'"
"RTN","GMTSPD",65,0)
 W !,"  for all hospital locations.  Enter '^' to return to Health Summary"
"RTN","GMTSPD",66,0)
 W !,"  Type Selection or '^^' to exit."
"RTN","GMTSPD",67,0)
 Q
"RTN","GMTSPD",68,0)
A2 ; Double ?? Help
"RTN","GMTSPD",69,0)
 N GMTSN,GMTSI,GMTSL,GMTSC,GMTSE,GMTSP,GMTSA S GMTSP=+($G(IOSL))-9 S:GMTSP'>0 GMTSP=15
"RTN","GMTSPD",70,0)
 S (GMTSA,GMTSC,GMTSE)=0,GMTSN="" D A1 W !
"RTN","GMTSPD",71,0)
 F  S GMTSN=$O(^SC("B",GMTSN)) Q:GMTSN=""  D  Q:GMTSE
"RTN","GMTSPD",72,0)
 . S GMTSI=0 F  S GMTSI=$O(^SC("B",GMTSN,GMTSI)) Q:GMTSI=""  D  Q:GMTSE
"RTN","GMTSPD",73,0)
 . . S GMTSL=$P($G(^SC(GMTSI,0)),"^",1) Q:'$L(GMTSL)  S GMTSC=GMTSC+1,GMTSA=GMTSA+1
"RTN","GMTSPD",74,0)
 . . W:GMTSC=1 !,?3,"Choose from:" W !,?3,GMTSL
"RTN","GMTSPD",75,0)
 . . I GMTSA'<GMTSP D CONT
"RTN","GMTSPD",76,0)
 Q
"RTN","GMTSPD",77,0)
CONT ; Continue Displaying List
"RTN","GMTSPD",78,0)
 S GMTSP=+($G(IOSL))-1 S:GMTSP'>0 GMTSP=23 S GMTSA=0
"RTN","GMTSPD",79,0)
 N DIR,DA,X,Y,DTOUT,DUOUT,DIRUT,DIROUT S DIR(0)="E",DIR("A")="   '^' TO STOP",(DIR("?"),DIR("??"))="^D C1^GMTSPD"
"RTN","GMTSPD",80,0)
 D ^DIR S:+($G(Y))=0 GMTSE=1
"RTN","GMTSPD",81,0)
 Q
"RTN","GMTSPD",82,0)
C1 ; Continue Help
"RTN","GMTSPD",83,0)
 W !,"     Enter ether RETURN or '^'" Q
"RTN","GMTSPD",84,0)
CHKLOC(LOC) ; Get date range for Clinics/ORs
"RTN","GMTSPD",85,0)
 I $P($G(LOC),U,3)="COR" D  Q:$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",86,0)
 . S $P(LOC,U,4)=$$SELDATE
"RTN","GMTSPD",87,0)
 W ! S GMLOC=0 F  S GMLOC=$O(LOC(GMLOC)) Q:+GMLOC'>0  D
"RTN","GMTSPD",88,0)
 . I "COR"[$P(LOC(+GMLOC),U,3) S $P(LOC(+GMLOC),U,4)=$P(LOC,U,4,5)
"RTN","GMTSPD",89,0)
 Q
"RTN","GMTSPD",90,0)
SELDATE() ; Visit/Surgery date range for Print-by-Clinic
"RTN","GMTSPD",91,0)
 N %,%H,%I,DIR,DEFDT,X,Y,GMBEG,GMEND
"RTN","GMTSPD",92,0)
 S (GMBEG,GMEND)=0
"RTN","GMTSPD",93,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",94,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",95,0)
 S DIR("A")="Please enter the beginning Visit or Surgery date"
"RTN","GMTSPD",96,0)
 D ^DIR
"RTN","GMTSPD",97,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPD",98,0)
 S GMBEG=Y
"RTN","GMTSPD",99,0)
 I +GMBEG>0 D
"RTN","GMTSPD",100,0)
 . S X=$P(GMBEG,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",101,0)
 . S DIR(0)="DO^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",102,0)
 . S DIR("A")="Please enter the ending Visit or Surgery date"
"RTN","GMTSPD",103,0)
 . D ^DIR
"RTN","GMTSPD",104,0)
 . I Y="^^" S DIROUT=1
"RTN","GMTSPD",105,0)
 . S GMEND=Y
"RTN","GMTSPD",106,0)
 Q $S(+GMEND>0&(GMEND>GMBEG):GMBEG_U_GMEND,+GMEND>0&(GMEND<GMBEG):GMEND_U_GMBEG,+GMEND>0&(GMEND=GMBEG):GMBEG,1:0)
"RTN","GMTSPD",107,0)
CKPAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPD",108,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG
"RTN","GMTSPD",109,0)
 S LTYPE=$P(LOC,U,3)
"RTN","GMTSPD",110,0)
 I LTYPE="W" D
"RTN","GMTSPD",111,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPD",112,0)
 . S GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPD",113,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPD",114,0)
 . S GMY=0
"RTN","GMTSPD",115,0)
 . I +$P(LOC,U,5) S X1=$P(LOC,U,5),X2=1 D C^%DTC
"RTN","GMTSPD",116,0)
 . I +$P(LOC,U,5)'>0 S X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPD",117,0)
 . I LTYPE="C",+$O(^SC(+LOC,"S",$P(LOC,U,4))),(+$O(^($P(LOC,U,4)))'>X) S GMY=1
"RTN","GMTSPD",118,0)
 . I LTYPE="OR" D
"RTN","GMTSPD",119,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPD",120,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPD",121,0)
 . . I +OLOC,+$P(LOC,U,5) D
"RTN","GMTSPD",122,0)
 . . . S GMBEG=$P(LOC,U,4)
"RTN","GMTSPD",123,0)
 . . . F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPD",124,0)
 . . . . I $O(^SRF("AOR",+OLOC,+GMBEG,0)) S GMY=1
"RTN","GMTSPD",125,0)
 . . . . E  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPD",126,0)
 Q $G(GMY)
"RTN","GMTSPD2")
0^39^B2627984
"RTN","GMTSPD2",1,0)
GMTSPD2 ; SLC/JER,SBW - Interactive Print-by-Loc (cont)     ; 02/27/2002
"RTN","GMTSPD2",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSPD2",3,0)
 ;                     
"RTN","GMTSPD2",4,0)
 ; External References
"RTN","GMTSPD2",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSPD2",6,0)
 ;   DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSPD2",7,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSPD2",8,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSPD2",9,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSPD2",10,0)
 ;                     
"RTN","GMTSPD2",11,0)
RXAP() ; Ask about inclusion of OP Rx Action Profile
"RTN","GMTSPD2",12,0)
 N %,DIR,X,Y
"RTN","GMTSPD2",13,0)
 I $P($G(^GMT(142.99,1,0)),U,2)'="Y" S Y=0 G RXAPX
"RTN","GMTSPD2",14,0)
 S DIR(0)="YO",DIR("A")="Include Outpatient Pharmacy Action Profile (Y/N)"
"RTN","GMTSPD2",15,0)
 S DIR("B")="NO" D ^DIR
"RTN","GMTSPD2",16,0)
RXAPX ; Rx Action Profile Exit
"RTN","GMTSPD2",17,0)
 Q Y
"RTN","GMTSPD2",18,0)
HSOUT ; Device Handling/Output control
"RTN","GMTSPD2",19,0)
 N IOP,%ZIS
"RTN","GMTSPD2",20,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D NOQUE Q
"RTN","GMTSPD2",21,0)
 S %ZIS="Q",%ZIS("B")="HOME" D ^%ZIS Q:POP
"RTN","GMTSPD2",22,0)
 D @$S(+$G(GMPSAP)&(IO'=IO(0)):"QUE",$D(IO("Q")):"QUE",1:"NOQUE")
"RTN","GMTSPD2",23,0)
 Q
"RTN","GMTSPD2",24,0)
QUE ; Set ZT parameters and tasks ^GMTSPL
"RTN","GMTSPD2",25,0)
 N ZTSAVE,ZTDESC,ZTDTH,ZTIO,ZTRTN,% K IO("Q")
"RTN","GMTSPD2",26,0)
 F %="U","GMTSTYP","GMTSCDT","GMTSSC(","GMPSAP" S ZTSAVE(%)=""
"RTN","GMTSPD2",27,0)
 S ZTRTN="^GMTSPL",ZTDESC="HEALTH SUMMARY (BY LOCATION)",ZTIO=ION
"RTN","GMTSPD2",28,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSPD2",29,0)
 D ^%ZISC
"RTN","GMTSPD2",30,0)
 Q
"RTN","GMTSPD2",31,0)
NOQUE ; Calls ^GMTSPL in interactive mode
"RTN","GMTSPD2",32,0)
 U:IO'=IO(0) IO D ^GMTSPL,^%ZISC
"RTN","GMTSPD2",33,0)
 Q
"RTN","GMTSPD2",34,0)
LOCTXT(LOC) ; Change hospital location code to text name
"RTN","GMTSPD2",35,0)
 Q $S(LOC="W":"Ward",LOC="OR":"Operating Room",LOC="C":"Clinic",1:"Hospital Location")
"RTN","GMTSPL")
0^40^B36810974
"RTN","GMTSPL",1,0)
GMTSPL ; SLC/JER,KER - Print/Queue HS for Patient Lists ; 02/27/2002
"RTN","GMTSPL",2,0)
 ;;2.7;Health Summary;**7,27,28,30,47,49**;Oct 20, 1995
"RTN","GMTSPL",3,0)
 ;
"RTN","GMTSPL",4,0)
 ; External References
"RTN","GMTSPL",5,0)
 ;    DBIA 10090  ^DIC(4
"RTN","GMTSPL",6,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPL",7,0)
 ;    DBIA 10035  ^DPT(
"RTN","GMTSPL",8,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPL",9,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPL",10,0)
 ;    DBIA    16  ^SRF(
"RTN","GMTSPL",11,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPL",12,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPL",13,0)
 ;    DBIA 10091  ^XMB(1
"RTN","GMTSPL",14,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPL",15,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPL",16,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPL",17,0)
 ;    DBIA   183  DFN^PSOSD1
"RTN","GMTSPL",18,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPL",19,0)
 ;    DBIA  2056  $$GET1^DIQ (file #44)
"RTN","GMTSPL",20,0)
 ;                          
"RTN","GMTSPL",21,0)
MAIN ; Print/Queue for Patient Lists
"RTN","GMTSPL",22,0)
 ;                          
"RTN","GMTSPL",23,0)
 ; Call with:  
"RTN","GMTSPL",24,0)
 ;                   
"RTN","GMTSPL",25,0)
 ;   GMTSTYP  = Pointer to file 142
"RTN","GMTSPL",26,0)
 ;   GMTSSC   = Pointer to file 44^Hosp Loc Name^
"RTN","GMTSPL",27,0)
 ;              Hosp Loc Type^Begin Visit/Surg Date^
"RTN","GMTSPL",28,0)
 ;              Opt end Visit/Surgery Date
"RTN","GMTSPL",29,0)
 ;   GMTSSC() = GMTSSC - Array of multiple locations
"RTN","GMTSPL",30,0)
 ;   [GMPSAP] = Optional flag set to 1 if OP Rx 
"RTN","GMTSPL",31,0)
 ;              Action Profile is to print
"RTN","GMTSPL",32,0)
 ;                        
"RTN","GMTSPL",33,0)
 N MULTLOC,GMTSEXIT S GMTSEXIT=0
"RTN","GMTSPL",34,0)
 I $D(GMTSSC("ALL")) D  Q
"RTN","GMTSPL",35,0)
 . N IEN,BEG,END,COR,PRM,RAN,PAT
"RTN","GMTSPL",36,0)
 . S PRM=$G(GMTSSC),BEG=$P(PRM,"^",4),END=$P(PRM,"^",5)
"RTN","GMTSPL",37,0)
 . S RAN=BEG S:$L(END)&($L(RAN)) RAN=RAN_"^"_END S:$L(END)&('$L(RAN)) RAN=END
"RTN","GMTSPL",38,0)
 . S IEN=0 F  S IEN=$O(^SC(IEN)) Q:+IEN=0  D  Q:$G(GMTSEXIT)["^^"
"RTN","GMTSPL",39,0)
 . . N GMTSSC,NAM S NAM=$$GET1^DIQ(44,(+IEN_","),.01) Q:'$L(NAM)
"RTN","GMTSPL",40,0)
 . . S COR=$$GET1^DIQ(44,(+IEN_","),2,"I") Q:COR=""  Q:"WCOR"'[COR
"RTN","GMTSPL",41,0)
 . . S GMTSSC=IEN_"^"_NAM_"^"_COR
"RTN","GMTSPL",42,0)
 . . S:"COR"[COR&($L($G(RAN))) GMTSSC=GMTSSC_"^"_RAN
"RTN","GMTSPL",43,0)
 . . S PAT=$$PAT(GMTSSC) Q:+PAT=0
"RTN","GMTSPL",44,0)
 . . D CTRL
"RTN","GMTSPL",45,0)
 I +$O(GMTSSC(0))'>0 D CTRL
"RTN","GMTSPL",46,0)
 I +$O(GMTSSC(0)) D
"RTN","GMTSPL",47,0)
 . S MULTLOC=0 F  S MULTLOC=$O(GMTSSC(MULTLOC)) Q:+MULTLOC'>0!$D(DIROUT)  D
"RTN","GMTSPL",48,0)
 . . S GMTSSC=GMTSSC(+MULTLOC) D CTRL
"RTN","GMTSPL",49,0)
 Q
"RTN","GMTSPL",50,0)
CTRL ; Controls Branching
"RTN","GMTSPL",51,0)
 N DFN,GMTDFN,GMLTYPE,GMTSLTR,GMPNM,PSOPAR,PSONOPG,PSOINST,PSTYPE K ^TMP("GMTSPL",$J) U IO
"RTN","GMTSPL",52,0)
 S GMLTYPE=$P(GMTSSC,U,3) D:GMLTYPE="C" CLINIC(GMTSSC) D:GMLTYPE="W" WARD(GMTSSC) D:GMLTYPE="OR" OR(GMTSSC)
"RTN","GMTSPL",53,0)
 I $L($P(GMTSSC,U,2)),($E(IOST,1)'="C") S GMTSLTR=$E($P(GMTSSC,U,2),1,10) D ^GMTSLTR
"RTN","GMTSPL",54,0)
 I $O(^TMP("GMTSPL",$J,0))="",$D(GMTSSC("ALL")) W !,"ALL" Q
"RTN","GMTSPL",55,0)
 I $O(^TMP("GMTSPL",$J,0))="" D NOPAT($P(GMTSSC,U,2)) Q
"RTN","GMTSPL",56,0)
 S GMPNM="" F  S GMPNM=$O(^TMP("GMTSPL",$J,GMPNM)) Q:(GMPNM="")!($D(DIROUT))  D
"RTN","GMTSPL",57,0)
 . S GMTDFN=0 F  S GMTDFN=$O(^TMP("GMTSPL",$J,GMPNM,GMTDFN)) Q:(GMTDFN'>0)!($D(DIROUT))  D
"RTN","GMTSPL",58,0)
 . . N GMDUOUT
"RTN","GMTSPL",59,0)
 . . S DFN=GMTDFN D DRIVER Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSPL",60,0)
 . . I +$G(GMPSAP) D
"RTN","GMTSPL",61,0)
 . . . S (PSTYPE,PSONOPG)=1
"RTN","GMTSPL",62,0)
 . . . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSPL",63,0)
 . . . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSPL",64,0)
 . . . D DFN^PSOSD1,PAGE
"RTN","GMTSPL",65,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",66,0)
 Q
"RTN","GMTSPL",67,0)
PAGE ; Pause at BOP for interactive users
"RTN","GMTSPL",68,0)
 N DIR,X,Y
"RTN","GMTSPL",69,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!((IOSL>998)&($G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN)))
"RTN","GMTSPL",70,0)
 I IOSL>($Y+5) F  W ! Q:IOSL<($Y+6)!($Y'<22)
"RTN","GMTSPL",71,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","GMTSPL",72,0)
 S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","GMTSPL",73,0)
 D ^DIR S:X["^^" DIROUT=1
"RTN","GMTSPL",74,0)
 Q
"RTN","GMTSPL",75,0)
NOPAT(LOC) ; Handles unpopulated Hospital location
"RTN","GMTSPL",76,0)
 N %,%H,%I,%T,%Y,GMTS,GMTSDTM,GMTSTN,GMTSHDR,GMTSPG,GMTSTITL,GMTSDTM,GMTSLFG,X,Y
"RTN","GMTSPL",77,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X,GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",78,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",79,0)
 S GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:$P(Y,U,2)),GMTSLFG=1
"RTN","GMTSPL",80,0)
 W @IOF D HEADER^GMTSUP W !!,"No Patients found at ",LOC," location.",!
"RTN","GMTSPL",81,0)
 Q
"RTN","GMTSPL",82,0)
CLINIC(LOC) ; Gets list of next-day appointments for clinic
"RTN","GMTSPL",83,0)
 N %,%H,%I,%T,%Y,DFN,GMI,GMJ,X,X1,X2,VDT,Y,GMPNM,GMDT,GMBDT,GMEDT
"RTN","GMTSPL",84,0)
 S VDT=+$P(LOC,U,4)
"RTN","GMTSPL",85,0)
 I 'VDT D NOW^%DTC S VDT=X
"RTN","GMTSPL",86,0)
 S X=+VDT D REGDT4^GMTSU S GMBDT=X
"RTN","GMTSPL",87,0)
 S X=+$P(LOC,U,5) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSPL",88,0)
 S X1=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:VDT),X2=1 D C^%DTC
"RTN","GMTSPL",89,0)
 S GMI=VDT F  S GMI=$O(^SC(+LOC,"S",GMI)) Q:+GMI'>0!(GMI>X)  D
"RTN","GMTSPL",90,0)
 . S GMJ=0 F  S GMJ=$O(^SC(+LOC,"S",GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",91,0)
 . . I '$L($P($G(^SC(+LOC,"S",GMI,1,GMJ,0)),U,9)) D
"RTN","GMTSPL",92,0)
 . . . S DFN=+$G(^SC(+LOC,"S",GMI,1,GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",93,0)
 . . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",94,0)
 . . . N X
"RTN","GMTSPL",95,0)
 . . . S X=+GMI D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",96,0)
 . . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):GMBDT_" TO "_GMEDT,1:GMDT)
"RTN","GMTSPL",97,0)
 Q
"RTN","GMTSPL",98,0)
WARD(LOC) ; Gets list of patients for a ward
"RTN","GMTSPL",99,0)
 N DFN,GMLOC,X,Y,GMDT
"RTN","GMTSPL",100,0)
 S GMLOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPL",101,0)
 I $S('$L(GMLOC):1,'$O(^DPT("CN",GMLOC,0)):1,1:0) Q
"RTN","GMTSPL",102,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",GMLOC,DFN)) Q:+DFN'>0  D
"RTN","GMTSPL",103,0)
 . N X
"RTN","GMTSPL",104,0)
 . S X=+$G(DT) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",105,0)
 . S ^TMP("GMTSPL",$J,$P($G(^DPT(+DFN,0)),U),+DFN)=GMDT
"RTN","GMTSPL",106,0)
 Q
"RTN","GMTSPL",107,0)
OR(LOC) ; Gets list of patients scheduled for surgery
"RTN","GMTSPL",108,0)
 N GMBEG,GMEND,DFN,GMI,GMJ,GMPNM,GMDT,%,%H,%I,%T,%Y,X,X1,X2,Y
"RTN","GMTSPL",109,0)
 S GMI=+$O(^SRS("B",+LOC,0)) I +GMI'>0 G ORX
"RTN","GMTSPL",110,0)
 S GMBEG=$P(LOC,U,4)-.0001,GMEND=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:$P(LOC,U,4))
"RTN","GMTSPL",111,0)
 F  S GMBEG=$O(^SRF("AOR",+GMI,+GMBEG)) Q:+GMBEG'>0!(+GMBEG>+GMEND)  D
"RTN","GMTSPL",112,0)
 . S GMJ=0 F  S GMJ=$O(^SRF("AOR",+GMI,+GMBEG,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",113,0)
 . . S DFN=+$G(^SRF(+GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",114,0)
 . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",115,0)
 . . N X
"RTN","GMTSPL",116,0)
 . . S X=+GMBEG D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",117,0)
 . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):^(+DFN)_", "_GMDT,1:GMDT)
"RTN","GMTSPL",118,0)
ORX ; Exit Surgery
"RTN","GMTSPL",119,0)
 Q
"RTN","GMTSPL",120,0)
PAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPL",121,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG S LTYPE=$P(LOC,U,3),GMY=0
"RTN","GMTSPL",122,0)
 I LTYPE="W" D
"RTN","GMTSPL",123,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U),GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPL",124,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPL",125,0)
 . S GMY=0 S:+$P(LOC,U,5) X1=$P(LOC,U,5),X2=1 S:+$P(LOC,U,5)'>0 X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPL",126,0)
 . I LTYPE="C",+$O(^SC(+LOC,"S",$P(LOC,U,4))),(+$O(^($P(LOC,U,4)))'>X) S GMY=1
"RTN","GMTSPL",127,0)
 . I LTYPE="OR" D
"RTN","GMTSPL",128,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPL",129,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPL",130,0)
 . . I +OLOC,+$P(LOC,U,5) S GMBEG=$P(LOC,U,4) F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPL",131,0)
 . . . S:$O(^SRF("AOR",+OLOC,+GMBEG,0)) GMY=1 Q:+GMY>0  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPL",132,0)
 Q $G(GMY)
"RTN","GMTSPL",133,0)
DRIVER ; Sets variables for GMTS1 and calls ^%ZTLOAD
"RTN","GMTSPL",134,0)
 N %T,C,D0,GMTS,GMTS0,GMTS1,GMTS2,GMTSDOB,GMTSDTM,GMTSLO,GMTSLOCK
"RTN","GMTSPL",135,0)
 N GMTSLPG,GMTSEG,GMTSEGC,GMTSTN,GMTSEGI,GMTSPNM,GMTSRB
"RTN","GMTSPL",136,0)
 N GMTSSN,GMTSTITL,GMTSWARD,GMTSX,GMTSPHDR,GMTSAGE,GMTSTOF,GMTSCDT
"RTN","GMTSPL",137,0)
 N GMW,I,SEX,VA,VADM,VAIN,VAINDT,VAROOT,X,Y
"RTN","GMTSPL",138,0)
 S GMTSCDT(0)=^TMP("GMTSPL",$J,GMPNM,+DFN),GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",139,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",140,0)
 S GMTSTITL=$$UP^XLFSTR($S($G(^GMT(142,+Y,"T"))]"":^("T"),1:$P(Y,U,2)))
"RTN","GMTSPL",141,0)
 D:$D(GMTSEG)'>9 SELTYP1^GMTS D EN^GMTS1
"RTN","GMTSPL",142,0)
 Q
"RTN","GMTSPN")
0^36^B63793556
"RTN","GMTSPN",1,0)
GMTSPN ; SLC/KER - Progress Note                     ; 02/27/2002
"RTN","GMTSPN",2,0)
 ;;2.7;Health Summary;**12,28,33,35,45,47,49**;Oct 20, 1995
"RTN","GMTSPN",3,0)
 ;                          
"RTN","GMTSPN",4,0)
 ; External References
"RTN","GMTSPN",5,0)
 ;    DBIA  2902  VISIT^TIULAPIC
"RTN","GMTSPN",6,0)
 ;    DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSPN",7,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSPN",8,0)
 ;                        
"RTN","GMTSPN",9,0)
PN ; Progress Note Health Summary Component
"RTN","GMTSPN",10,0)
 N TIUSTAT,TIUTYPE,TIUNAM,DIC,TIUFPRIV,TIUXREF,GMTSTIUC,X,Y,GMTSREF
"RTN","GMTSPN",11,0)
 S TIUFPRIV=1,TIUSTAT="ALL",TIUXREF="""APT""",GMTSTIUC="P",(TIUNAM,X)="PROGRESS NOTES"
"RTN","GMTSPN",12,0)
 S DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL"""
"RTN","GMTSPN",13,0)
 D ^DIC K DIC("S") S:Y>0 TIUTYPE=+Y S GMTSREF="" D MAIN K GMTSREF
"RTN","GMTSPN",14,0)
 Q
"RTN","GMTSPN",15,0)
MAIN ; Control branching
"RTN","GMTSPN",16,0)
 N ADATE,ADMIT,ASUB,ATDATE,ATTNDNG,ATTYPE,ATYPE,AUTHOR,CHILD,CONEED
"RTN","GMTSPN",17,0)
 N COSAME,COSGEDBY,COSIG,CURIEN,DISCHG,GMTSA,GMTSAI,GMTSAII,GMTSCNT
"RTN","GMTSPN",18,0)
 N GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSID,GMTSIDC,GMTSII,GMTSIQ
"RTN","GMTSPN",19,0)
 N GMTSJ,GMTSK,GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX
"RTN","GMTSPN",20,0)
 N GMTSXTRA,I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,STATUS,TSPEC
"RTN","GMTSPN",21,0)
 N TYPE,X,Y
"RTN","GMTSPN",22,0)
 K ^TMP("TIU",$J) S GMTSX=1 D EXTIU Q:'$D(^TMP("TIU",$J))  D PNOTE
"RTN","GMTSPN",23,0)
 K ^TMP("TIU",$J),PN Q
"RTN","GMTSPN",24,0)
 ;                      
"RTN","GMTSPN",25,0)
 ; Progress Notes
"RTN","GMTSPN",26,0)
 ; 
"RTN","GMTSPN",27,0)
 ; ^TMP("TIU",$J,IDT,0)
"RTN","GMTSPN",28,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"E")
"RTN","GMTSPN",29,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"I")
"RTN","GMTSPN",30,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",0)
"RTN","GMTSPN",31,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",#,0)
"RTN","GMTSPN",32,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",33,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",34,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",35,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",36,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZAD",0)
"RTN","GMTSPN",37,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",38,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",39,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",40,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",41,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",42,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",43,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",44,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",45,0)
 ; 
"RTN","GMTSPN",46,0)
 ; Selected Progress Notes
"RTN","GMTSPN",47,0)
 ; 
"RTN","GMTSPN",48,0)
 ; ^TMP("TIU",$J,IDT,#,0)
"RTN","GMTSPN",49,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"E")
"RTN","GMTSPN",50,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"I")
"RTN","GMTSPN",51,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",0)
"RTN","GMTSPN",52,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",#,0)
"RTN","GMTSPN",53,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",54,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",55,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",56,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",57,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",0)
"RTN","GMTSPN",58,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",59,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",60,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",61,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",62,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",63,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",64,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",65,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",66,0)
 ;                           
"RTN","GMTSPN",67,0)
PNOTE ; Progress Notes
"RTN","GMTSPN",68,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",69,0)
 . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_"," D NOTE
"RTN","GMTSPN",70,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",71,0)
SNOTE ; Selected Progress Notes
"RTN","GMTSPN",72,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",73,0)
 . N GMTSS S GMTSS=0 F  S GMTSS=$O(^TMP("TIU",$J,GMTSD,GMTSS)) Q:+GMTSS=0  D
"RTN","GMTSPN",74,0)
 . . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_","_GMTSS_"," D NOTE
"RTN","GMTSPN",75,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",76,0)
 ;                
"RTN","GMTSPN",77,0)
NOTE ;   Primary Note
"RTN","GMTSPN",78,0)
 N GMTSTDIC,GMTSI,GMTSXTRA S GMTSI=0
"RTN","GMTSPN",79,0)
 F  S GMTSI=$O(@(GMTSODIC_GMTSI_")")) Q:+GMTSI=0  D
"RTN","GMTSPN",80,0)
 . S (GMTSTDIC,GMTSPDIC,GMTSDIC)=GMTSODIC,(PARIEN,CURIEN)=GMTSI
"RTN","GMTSPN",81,0)
 . S CHILD=+($G(@(GMTSDIC_CURIEN_",""ZZID"",0)"))),TYPE="",GMTSID=0
"RTN","GMTSPN",82,0)
 . S:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) TYPE="Parent Interdisciplinary Note",GMTSID=1
"RTN","GMTSPN",83,0)
 . K PN S PN("#")=CURIEN,PN("#",0)="NOTE"
"RTN","GMTSPN",84,0)
 . D FLDS(GMTSDIC,CURIEN) D:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) ST^GMTSPN1("Begin Interdisciplinary Note")
"RTN","GMTSPN",85,0)
 . D WARN1^GMTSPN2 D:$E($G(GMTSTIUC),1)'["D" WH^GMTSPN1
"RTN","GMTSPN",86,0)
 . D:$G(GMTSTIUC)="DCS" WDH^GMTSPN1
"RTN","GMTSPN",87,0)
 . D:GMTSCNT=1&($G(GMTSTIUC)="DSB") WDBH^GMTSPN1
"RTN","GMTSPN",88,0)
 . I $G(GMTSTIUC)="DSB" D WDB^GMTSPN1(GMTSDIC,CURIEN) Q
"RTN","GMTSPN",89,0)
 . D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",90,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2
"RTN","GMTSPN",91,0)
 . D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",92,0)
 . D BL^GMTSPN2 N GMTSODIC S GMTSODIC=GMTSTDIC_CURIEN_"," D ANOTE,INOTE
"RTN","GMTSPN",93,0)
 . I GMTSID D ST^GMTSPN1("End Interdisciplinary Note") S GMTSID=0
"RTN","GMTSPN",94,0)
 Q
"RTN","GMTSPN",95,0)
ANOTE ;   Addendum to a Progress Note
"RTN","GMTSPN",96,0)
 N GMTSAI,GMTSXTRA S GMTSAI=0
"RTN","GMTSPN",97,0)
 F  S GMTSAI=$O(@(GMTSODIC_"""ZADD"","_GMTSAI_")")) Q:+GMTSAI=0  D
"RTN","GMTSPN",98,0)
 . S (GMTSTDIC,GMTSDIC)=GMTSODIC_"""ZADD"",",CURIEN=GMTSAI
"RTN","GMTSPN",99,0)
 . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="ADDENDUM TO A NOTE",TYPE=""
"RTN","GMTSPN",100,0)
 . S:$D(@(GMTSPDIC_PARIEN_",""ZZID"")")) TYPE="Addendum to a Parent Interdisciplinary Note"
"RTN","GMTSPN",101,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAH^GMTSPN1
"RTN","GMTSPN",102,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",103,0)
 Q
"RTN","GMTSPN",104,0)
INOTE ;   Interdisciplinary Progress Note
"RTN","GMTSPN",105,0)
 Q:+($G(@(GMTSODIC_"""ZZID"",0)")))'>0
"RTN","GMTSPN",106,0)
 N GMTSIQ,GMTSII,GMTSXTRA S GMTSIQ=0
"RTN","GMTSPN",107,0)
 F  S GMTSIQ=$O(@(GMTSODIC_"""ZZID"","_GMTSIQ_")")) Q:+GMTSIQ=0  D
"RTN","GMTSPN",108,0)
 . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_"""ZZID"","_GMTSIQ_","
"RTN","GMTSPN",109,0)
 . S GMTSII=0 F  S GMTSII=$O(@(GMTSODIC_GMTSII_")")) Q:+GMTSII=0  D
"RTN","GMTSPN",110,0)
 . . S GMTSDIC=GMTSODIC,CURIEN=GMTSII
"RTN","GMTSPN",111,0)
 . . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",112,0)
 . . S TYPE="Child Interdisciplinary Note"
"RTN","GMTSPN",113,0)
 . . D FLDS(GMTSDIC,CURIEN),ST^GMTSPN1("Interdisciplinary Note Cont.")
"RTN","GMTSPN",114,0)
 . . D WARN1^GMTSPN2,WIH^GMTSPN1 D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",115,0)
 . . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN)
"RTN","GMTSPN",116,0)
 . . D WARN2^GMTSPN2 D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN) D BL^GMTSPN2
"RTN","GMTSPN",117,0)
 . . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_GMTSII_",""ZADD"","
"RTN","GMTSPN",118,0)
 . . D AINOTE
"RTN","GMTSPN",119,0)
 Q
"RTN","GMTSPN",120,0)
AINOTE ;   Addendum to an Interdisciplinary Progress Note
"RTN","GMTSPN",121,0)
 N GMTSAII,GMTSXTRA S GMTSAII=0
"RTN","GMTSPN",122,0)
 F  S GMTSAII=$O(@(GMTSODIC_GMTSAII_")")) Q:+GMTSAII=0  D
"RTN","GMTSPN",123,0)
 . S GMTSDIC=GMTSODIC,CURIEN=GMTSAII
"RTN","GMTSPN",124,0)
 . K PN S PN("#")=GMTSI_"^"_GMTSII_"^"_CURIEN
"RTN","GMTSPN",125,0)
 . S PN("#",0)="ADDENDUM TO AN INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",126,0)
 . S TYPE="Addendum to a Child Interdisciplinary Note"
"RTN","GMTSPN",127,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAIH^GMTSPN1,WT^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",128,0)
 . D WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",129,0)
 Q
"RTN","GMTSPN",130,0)
 ;                           
"RTN","GMTSPN",131,0)
 ; Get Data
"RTN","GMTSPN",132,0)
EXTIU ;   Extract Patient/Visit VIA TIU
"RTN","GMTSPN",133,0)
 N MAX S DFN=+($G(DFN)) Q:DFN=0  S TIUTYPE=+($G(TIUTYPE)) Q:TIUTYPE=0
"RTN","GMTSPN",134,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:10)
"RTN","GMTSPN",135,0)
 S GMTS1=+($G(GMTS1)) Q:GMTS1=0  S GMTS2=+($G(GMTS2)) Q:GMTS2=0  S GMTSX=+($G(GMTSX))
"RTN","GMTSPN",136,0)
 I +($G(GMTSPXGO))>0,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,MAX,+($G(GMTSX))) Q
"RTN","GMTSPN",137,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,MAX,+($G(GMTSX)))
"RTN","GMTSPN",138,0)
 Q
"RTN","GMTSPN",139,0)
FLDS(X,I) ; Get Fields
"RTN","GMTSPN",140,0)
 N GMTSDIC,GMTSIEN
"RTN","GMTSPN",141,0)
 S GMTSDIC=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)
"RTN","GMTSPN",142,0)
 Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN",143,0)
 Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN",144,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))
"RTN","GMTSPN",145,0)
 S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN",146,0)
 N GMTSXTRA S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN",147,0)
 S X=$G(@(GMTSDIC_".07,""I"")")) D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSPN",148,0)
 S X=$G(@(GMTSDIC_".08,""I"")")) D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSPN",149,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSPN",150,0)
 S:+ADMIT'>0 ADMIT="Unknown"
"RTN","GMTSPN",151,0)
 S AUTHOR=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",152,0)
 S ATTNDNG=$G(@(GMTSDIC_"1209,""E"")"))
"RTN","GMTSPN",153,0)
 S TSPEC=$G(@(GMTSDIC_"1402,""E"")"))
"RTN","GMTSPN",154,0)
 S STATUS=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",155,0)
 S PN("DATE")=$G(@(GMTSDIC_"1301,""I"")"))
"RTN","GMTSPN",156,0)
 I PN("DATE")]"" S PN("DATE")=$$EDT^GMTSU(PN("DATE"))
"RTN","GMTSPN",157,0)
 S REASON="",PN("DOCTYPE")=$G(@(GMTSDIC_".01,""E"")"))
"RTN","GMTSPN",158,0)
 S PN("STATUS")=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",159,0)
 S PN("AUTHOR")=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",160,0)
 S PN("EXPSIGNR")=$G(@(GMTSDIC_"1204,""E"")"))
"RTN","GMTSPN",161,0)
 S PN("LOC")=$G(@(GMTSDIC_"1205,""E"")"))
"RTN","GMTSPN",162,0)
 S PN("EXPCOSNR")=$G(@(GMTSDIC_"1208,""E"")"))
"RTN","GMTSPN",163,0)
 S:$G(@(GMTSDIC_"1307,""I"")"))'="" PN("DDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1307,""I"")")))
"RTN","GMTSPN",164,0)
 S:$G(@(GMTSDIC_"1501,""I"")"))'="" PN("SIGNDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1501,""I"")")))
"RTN","GMTSPN",165,0)
 S PN("SIGDT")=$G(@(GMTSDIC_"1501,""I"")"))
"RTN","GMTSPN",166,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPN",167,0)
 S SIGNEDBY=$G(@(GMTSDIC_"1502,""I"")"))
"RTN","GMTSPN",168,0)
 S PN("SIGBLK")=$G(@(GMTSDIC_"1503,""E"")"))
"RTN","GMTSPN",169,0)
 S PN("STITLE")=$G(@(GMTSDIC_"1504,""E"")"))
"RTN","GMTSPN",170,0)
 S PN("COSDT")=$G(@(GMTSDIC_"1507,""I"")"))
"RTN","GMTSPN",171,0)
 I PN("COSDT")]"" S (COSIG,PN("COSDT"))=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPN",172,0)
 S COSGEDBY=$G(@(GMTSDIC_"1508,""I"")"))
"RTN","GMTSPN",173,0)
 S CONEED=0 S:+($G(COSGEDBY))>0 CONEED=1
"RTN","GMTSPN",174,0)
 S PN("COBLK")=$G(@(GMTSDIC_"1509,""E"")"))
"RTN","GMTSPN",175,0)
 S PN("COTITLE")=$G(@(GMTSDIC_"1510,""E"")"))
"RTN","GMTSPN",176,0)
 S COSAME=$S(+($G(SIGNEDBY))>0&(+($G(SIGNEDBY))=+($G(COSGEDBY))):1,1:0)
"RTN","GMTSPN",177,0)
 S:CONEED>0 CONEED=$S(COSAME=1:0,1:CONEED)
"RTN","GMTSPN",178,0)
 S PN("SUBJ")=$G(@(GMTSDIC_"1701,""E"")"))
"RTN","GMTSPN",179,0)
 I $G(@(GMTSDIC_"1505,""I"")"))="C" D
"RTN","GMTSPN",180,0)
 . S PN("SCHART")="Signed on Chart by:",PN("SCHARTBY")="."
"RTN","GMTSPN",181,0)
 . S:$G(@(GMTSDIC_"1512,""E"")"))'="" PN("SCHARTBY")=$G(@(GMTSDIC_"1512,""E"")"))
"RTN","GMTSPN",182,0)
 I $E($G(GMTSTIUC),1)'["D",$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",183,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",184,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",185,0)
 I $E($G(GMTSTIUC),1)["D",CONEED,$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",186,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",187,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",188,0)
 S:$G(@(GMTSDIC_"1202,""I"")"))'=$G(@(GMTSDIC_"1502,""I"")")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN",189,0)
 S PN("AMENDMNT")=+($G(@(GMTSDIC_"1601,""I"")")))
"RTN","GMTSPN",190,0)
 Q
"RTN","GMTSPN1")
0^63^B29052150
"RTN","GMTSPN1",1,0)
GMTSPN1 ; SLC/KER - Progress Note Header/Sig/Text/Prob ; 02/27/2002
"RTN","GMTSPN1",2,0)
 ;;2.7;Health Summary;**12,35,45,49**;Oct 20, 1995
"RTN","GMTSPN1",3,0)
 Q
"RTN","GMTSPN1",4,0)
 ;                          
"RTN","GMTSPN1",5,0)
 ; External References
"RTN","GMTSPN1",6,0)
 ;    DBIA 10104 call $$UP^XLFSTR
"RTN","GMTSPN1",7,0)
 ;                     
"RTN","GMTSPN1",8,0)
 ; Write Headers
"RTN","GMTSPN1",9,0)
WH ;   Note Header
"RTN","GMTSPN1",10,0)
 Q:$D(GMTSQIT)  I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",11,0)
 W $G(PN("DATE")),?21,"Title:  ",$$UP^XLFSTR($G(PN("DOCTYPE")))
"RTN","GMTSPN1",12,0)
 S (ADATE,PDATE)=$G(PN("DATE")),(ATYPE,PTYPE)=$G(PN("DOCTYPE")),(ASUB,PSUB)=$G(PN("SUBJ"))
"RTN","GMTSPN1",13,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?20,PN("AUTH")
"RTN","GMTSPN1",14,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN1",15,0)
 Q
"RTN","GMTSPN1",16,0)
WDH ;   Discharge Summary Header
"RTN","GMTSPN1",17,0)
 Q:$D(GMTSQIT)  I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADMIT,?12,"-",?14,DISCHG,?56,"Status: ",STATUS,!
"RTN","GMTSPN1",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Last Tr Specialty: ",TSPEC,?49,"Dict'd By: ",AUTHOR,!
"RTN","GMTSPN1",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?47,"Approved By: ",ATTNDNG,!
"RTN","GMTSPN1",21,0)
 Q
"RTN","GMTSPN1",22,0)
WDBH ;   Brief Discharge Summary Header
"RTN","GMTSPN1",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Admitted",?11,"Disch'd",?23,"Dictated By",?38,"Approved By",?53,"Cosigned",?64,"Status",!! Q
"RTN","GMTSPN1",24,0)
WAH ;   Addendum Header
"RTN","GMTSPN1",25,0)
 Q:$D(GMTSQIT)  I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",26,0)
 W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN1",27,0)
 I $L($G(ADATE)),$L($G(ATYPE)) D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",28,0)
 . I $D(GMTSREF) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?23,"Ref:  ",$E(ATYPE,1,25),?55,"Dated:  ",ADATE
"RTN","GMTSPN1",29,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?20,PN("AUTH")
"RTN","GMTSPN1",30,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN1",31,0)
 I '$L($G(PN("SUBJ"))),$L($G(ASUB)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",$G(ASUB)
"RTN","GMTSPN1",32,0)
 Q
"RTN","GMTSPN1",33,0)
ST(X) ;   Sub-Titles
"RTN","GMTSPN1",34,0)
 N GMTS,GMTS1,GMTS2,GMTST,GMTSB S GMTST=$G(X) Q:'$L(GMTST)
"RTN","GMTSPN1",35,0)
 S GMTST="<< "_GMTST_" >>",GMTS="",$P(GMTS,"-",((((79-$L(GMTST))\2)\2)-6))="-"
"RTN","GMTSPN1",36,0)
 S $P(GMTS1," ",((((79-$L(GMTST))\2)\2)+6))=" "
"RTN","GMTSPN1",37,0)
 S GMTS2=GMTS_GMTS1,GMTS1=GMTS1_GMTS,GMTSB=GMTS1_GMTST_GMTS2
"RTN","GMTSPN1",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",39,0)
 Q
"RTN","GMTSPN1",40,0)
WIH ;   Interdisciplinary Note Header
"RTN","GMTSPN1",41,0)
 Q:$D(GMTSQIT)  I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",42,0)
 W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN1",43,0)
 S ADATE=$G(PN("DATE")),ATYPE=$G(PN("DOCTYPE")),ASUB=$G(PN("SUBJ"))
"RTN","GMTSPN1",44,0)
 I $L($G(PDATE)),$L($G(PTYPE)) D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",45,0)
 . I $D(GMTSREF) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?23,"Ref:  ",$E(PTYPE,1,25),?55,"Dated:  ",PDATE
"RTN","GMTSPN1",46,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?20,PN("AUTH")
"RTN","GMTSPN1",47,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN1",48,0)
 I '$L($G(PN("SUBJ"))),$L($G(PSUB)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",$G(PSUB)
"RTN","GMTSPN1",49,0)
 Q
"RTN","GMTSPN1",50,0)
WAIH ;   Addendum to Interdisciplinary Note Header
"RTN","GMTSPN1",51,0)
 Q:$D(GMTSQIT)  I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",52,0)
 W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN1",53,0)
 I $L($G(ADATE)),$L($G(ATYPE)) D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",54,0)
 . I $D(GMTSREF) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?23,"Ref:  ",$E(ATYPE,1,25),?55,"Dated:  ",ADATE
"RTN","GMTSPN1",55,0)
 I $L($G(PDATE)),$L($G(PTYPE)) D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",56,0)
 . I $D(GMTSREF) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?23,"Ref:  ",$E(PTYPE,1,29),?55,"Dated:  ",PDATE
"RTN","GMTSPN1",57,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?20,PN("AUTH")
"RTN","GMTSPN1",58,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN1",59,0)
 I '$L($G(PN("SUBJ"))),$L($G(ASUB)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",$G(ASUB)
"RTN","GMTSPN1",60,0)
 I '$L($G(PN("SUBJ"))),'$L($G(ASUB)),$L(PSUB) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",$G(PSUB)
"RTN","GMTSPN1",61,0)
 Q
"RTN","GMTSPN1",62,0)
 ; Write Note
"RTN","GMTSPN1",63,0)
WT(X,I) ;   Write Progress Note Text
"RTN","GMTSPN1",64,0)
 N GMTSD,GMTSIEN S GMTSD=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)  Q:$E($P(GMTSD,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN1",65,0)
 Q:'$D(@($P(GMTSD,",",1,($L(GMTSD,",")-1))_")"))  Q:'$D(@(GMTSD_GMTSIEN_")"))  S GMTSD=GMTSD_GMTSIEN_",""TEXT"","
"RTN","GMTSPN1",66,0)
 N GMTSK S GMTSK=0 F  S GMTSK=$O(@(GMTSD_GMTSK_")")) Q:+GMTSK'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(@(GMTSD_GMTSK_",0)"))
"RTN","GMTSPN1",68,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",69,0)
 Q
"RTN","GMTSPN1",70,0)
WP(X,I) ;   Writes Problems associated with Note
"RTN","GMTSPN1",71,0)
 Q:$G(TIUNAM)["DISCHARGE"
"RTN","GMTSPN1",72,0)
 N GMTSD,GMTSIEN S GMTSD=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)  Q:$E($P(GMTSD,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN1",73,0)
 Q:'$D(@($P(GMTSD,",",1,($L(GMTSD,",")-1))_")"))  Q:'$D(@(GMTSD_GMTSIEN_")"))  S GMTSD=GMTSD_GMTSIEN_",""PROBLEM"","
"RTN","GMTSPN1",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"PROBLEM(S):  "
"RTN","GMTSPN1",75,0)
 N GMTSPR S GMTSPR=0 F  S GMTSPR=$O(@(GMTSD_GMTSPR_")")) Q:+GMTSPR'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",76,0)
 . D:GMTSPR>1 CKP^GMTSUP Q:$D(GMTSQIT)  W !?15,$G(@(GMTSD_GMTSPR_",0)"))
"RTN","GMTSPN1",77,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",78,0)
 Q
"RTN","GMTSPN1",79,0)
AM(X,I) ;   Write Amendment
"RTN","GMTSPN1",80,0)
 Q:$D(GMTSQIT)  N GMTSD,GMTSIEN,GMTSA,GMTSI S GMTSD=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)  Q:$E($P(GMTSD,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN1",81,0)
 Q:'$D(@($P(GMTSD,",",1,($L(GMTSD,",")-1))_")"))  Q:'$D(@(GMTSD_GMTSIEN_")"))
"RTN","GMTSPN1",82,0)
 S GMTSD=GMTSD_GMTSIEN_"," D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",83,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(@(GMTSD_"1601,""E"")")),"  AMENDMENT FILED:"
"RTN","GMTSPN1",84,0)
 I $G(@(GMTSD_"1603,""E"")"))'="" D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",86,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?10 F GMTSI=1:1:$L($G(@(GMTSD_"1602,""E"")"))) W "_"
"RTN","GMTSPN1",87,0)
 I $G(@(GMTSD_"1604,""E"")"))'="" D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",88,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28,"  /es/ ",$G(@(GMTSD_"1604,""E"")"))
"RTN","GMTSPN1",89,0)
 I $G(@(GMTSD_"1605,""E"")"))'="" D  Q:$D(GMTSQIT)
"RTN","GMTSPN1",90,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,$G(@(GMTSD_"1605,""E"")"))
"RTN","GMTSPN1",91,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",92,0)
 Q
"RTN","GMTSPN1",93,0)
WDB(X,I) ;   Writes Brief Discharge Summary
"RTN","GMTSPN1",94,0)
 Q:$D(GMTSQIT)  N GMTSD,GMTSIEN,GMTSA,GMTSI S GMTSD=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)  Q:$E($P(GMTSD,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN1",95,0)
 Q:'$D(@($P(GMTSD,",",1,($L(GMTSD,",")-1))_")"))  Q:'$D(@(GMTSD_GMTSIEN_")"))
"RTN","GMTSPN1",96,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WDBH
"RTN","GMTSPN1",97,0)
 W $E($G(ADMIT),1,12),?11,$E($G(DISCHG),1,12),?23,$E($G(AUTHOR),1,14),?38,$E($G(ATTNDNG),1,14),?53,$E($G(COSIG),1,10),?64,$G(STATUS),!
"RTN","GMTSPN1",98,0)
 Q
"RTN","GMTSPN2")
0^64^B46788667
"RTN","GMTSPN2",1,0)
GMTSPN2 ; SLC/KER - Progress Note Signatures           ; 02/27/2002
"RTN","GMTSPN2",2,0)
 ;;2.7;Health Summary;**45,47,49**;Oct 20, 1995
"RTN","GMTSPN2",3,0)
 Q
"RTN","GMTSPN2",4,0)
 ;                          
"RTN","GMTSPN2",5,0)
 ; External References
"RTN","GMTSPN2",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPN2",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSPN2",8,0)
 ;   DBIA 10060  ^VA(200, .137
"RTN","GMTSPN2",9,0)
 ;   DBIA 10060  ^VA(200, .138
"RTN","GMTSPN2",10,0)
 ;                     
"RTN","GMTSPN2",11,0)
WS(X,I) ; Write Signatures 
"RTN","GMTSPN2",12,0)
 Q:$D(GMTSQIT)  N GMTSDIC,GMTSIEN,GMTSA,GMTSG S GMTSDIC=$G(X),GMTSIEN=$G(I)
"RTN","GMTSPN2",13,0)
 Q:'$L(GMTSIEN)  Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","  Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN2",14,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))  S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN2",15,0)
 D UNS,SOC,SIG,UNC,COC,COS,EXT
"RTN","GMTSPN2",16,0)
 Q
"RTN","GMTSPN2",17,0)
UNS ;   Unsigned/Draft Copy
"RTN","GMTSPN2",18,0)
 Q:$D(GMTSQIT)  N GMTST S GMTST=$G(@(GMTSDIC_"1501,""I"")")) D:GMTST="" UNSIG
"RTN","GMTSPN2",19,0)
 Q
"RTN","GMTSPN2",20,0)
SOC ;   Signed on Chart
"RTN","GMTSPN2",21,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB S GMTSP=$G(PN("SCHART"))
"RTN","GMTSPN2",22,0)
 S GMTSB=$G(PN("SCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",23,0)
 D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",24,0)
 Q
"RTN","GMTSPN2",25,0)
SIG ;   Signature Block, Name, Title and Date
"RTN","GMTSPN2",26,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",27,0)
 S GMTSP="Signed by:",GMTSE=$G(@(GMTSDIC_"1505,""I"")"))
"RTN","GMTSPN2",28,0)
 S GMTSB=$G(PN("SIGBLK")) Q:'$L(GMTSB)  S GMTST=$G(PN("STITLE"))
"RTN","GMTSPN2",29,0)
 S GMTSD=$G(PN("SIGDT")),GMTSA=$$GET1^DIQ(200,+($G(SIGNEDBY)),.137)
"RTN","GMTSPN2",30,0)
 S GMTSG=$$GET1^DIQ(200,+($G(SIGNEDBY)),.138) D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",31,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",32,0)
 D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",33,0)
 Q
"RTN","GMTSPN2",34,0)
UNC ;   Uncosigned - Requires Cosignature
"RTN","GMTSPN2",35,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",36,0)
 S GMTSP=$G(@(GMTSDIC_".05,""E"")")) Q:GMTSP'="UNCOSIGNED"
"RTN","GMTSPN2",37,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN2",39,0)
 Q
"RTN","GMTSPN2",40,0)
COC ;   Cosigned on Chart
"RTN","GMTSPN2",41,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",42,0)
 S GMTSP=$G(PN("COCHART")),GMTSB=$G(PN("COCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",43,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB)
"RTN","GMTSPN2",44,0)
 Q
"RTN","GMTSPN2",45,0)
COS ;   Co-Signature Block, Name, Title and Date
"RTN","GMTSPN2",46,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",47,0)
 S GMTSP="Cosigned by:",GMTSE=$G(@(GMTSDIC_"1511,""I"")")),GMTSB=$G(PN("COBLK")) Q:'$L(GMTSB)
"RTN","GMTSPN2",48,0)
 S GMTST=$G(PN("COTITLE")),GMTSD=$G(PN("COSDT"))
"RTN","GMTSPN2",49,0)
 S GMTSA=$$GET1^DIQ(200,+($G(COSGEDBY)),.137),GMTSG=$$GET1^DIQ(200,+($G(COSGEDBY)),.138)
"RTN","GMTSPN2",50,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",51,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",52,0)
 D PG(GMTSA,GMTSG)
"RTN","GMTSPN2",53,0)
 Q
"RTN","GMTSPN2",54,0)
EXT ;   Extra Signatures
"RTN","GMTSPN2",55,0)
 ;     Receipt Acknowledged by:
"RTN","GMTSPN2",56,0)
 Q:$D(GMTSQIT)  I +$O(@(GMTSDIC_"""EXTRASGNR"",0)")) D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",57,0)
 . D BL Q:$D(GMTSQIT)  D BY("Receipt Acknowledged by:","","")
"RTN","GMTSPN2",58,0)
 ;     Extra Signature Block, Name, Title and Date
"RTN","GMTSPN2",59,0)
 N GMTSXTRA S GMTSXTRA=0
"RTN","GMTSPN2",60,0)
 F  S GMTSXTRA=+$O(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_")")) Q:+GMTSXTRA'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",61,0)
 . N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB,GMTSI,GMTSC
"RTN","GMTSPN2",62,0)
 . S GMTSC=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""DATE"")")))
"RTN","GMTSPN2",63,0)
 . I GMTSC'>0 W ?27,"* AWAITING SIGNATURE *" D BL Q
"RTN","GMTSPN2",64,0)
 . S GMTSP="",GMTSE="/es/",GMTSB=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""NAME"")")) Q:'$L(GMTSB)
"RTN","GMTSPN2",65,0)
 . S GMTST=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""TITLE"")"))
"RTN","GMTSPN2",66,0)
 . S GMTSD=$$EDT^GMTSU(GMTSC),GMTSI=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""EXTRA"")")))
"RTN","GMTSPN2",67,0)
 . S GMTSA=$$GET1^DIQ(200,+($G(GMTSI)),.137),GMTSG=$$GET1^DIQ(200,+($G(GMTSI)),.138)
"RTN","GMTSPN2",68,0)
 . I +($G(GMTSXTRA))>1 D BL Q:$D(GMTSQIT)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",69,0)
 . D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",70,0)
 . D SB(GMTST,GMTSD) Q:$D(GMTSQIT)  D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",71,0)
 Q
"RTN","GMTSPN2",72,0)
 ;                      
"RTN","GMTSPN2",73,0)
UNSIG ; Unsigned Note
"RTN","GMTSPN2",74,0)
 N GMTS,GMTS1,GMTS2,GMTST,GMTSB S GMTST="<  THE ABOVE NOTE IS UNSIGNED  >",GMTS=""
"RTN","GMTSPN2",75,0)
 S $P(GMTS," ",((79-$L(GMTST))\2)\2)=" ",$P(GMTS1," ",((79-$L(GMTST))\2)\2)=" "
"RTN","GMTSPN2",76,0)
 S GMTS2=GMTS_GMTS1,GMTS1=GMTS1_GMTS,GMTSB=GMTS1_GMTST_GMTS2
"RTN","GMTSPN2",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",78,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"- DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY -"
"RTN","GMTSPN2",79,0)
 Q
"RTN","GMTSPN2",80,0)
 ;                        
"RTN","GMTSPN2",81,0)
 ; Warnings
"RTN","GMTSPN2",82,0)
WARN1 ;   Beginning of Note
"RTN","GMTSPN2",83,0)
 N GMTSD,GMTSW S GMTSW=1,GMTSD=0 D DEL1,RETR1 D:GMTSD BL Q
"RTN","GMTSPN2",84,0)
WARN2 ;   End of Note
"RTN","GMTSPN2",85,0)
 N GMTSD,GMTSW S GMTSW=2,GMTSD=0 D DEL2,RETR2 Q
"RTN","GMTSPN2",86,0)
DEL1 ;     Deleted Note (begin)
"RTN","GMTSPN2",87,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",88,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",89,0)
DEL2 ;     Deleted Note (end)
"RTN","GMTSPN2",90,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",91,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",92,0)
RETR1 ;     Retracted Note (begin)
"RTN","GMTSPN2",93,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",94,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",95,0)
RETR2 ;     Retracted Note (end)
"RTN","GMTSPN2",96,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",97,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",98,0)
WARN3 ;   Warning Display (display)
"RTN","GMTSPN2",99,0)
 N GMTS,GMTS1,GMTS2,GMTSB S GMTS="",GMTST=$G(GMTST),GMTST2=$G(GMTST2) Q:'$L(GMTST)  Q:'$L(GMTST2)
"RTN","GMTSPN2",100,0)
 S $P(GMTS,"<",((79-$L(GMTST))\2)\2)="<"
"RTN","GMTSPN2",101,0)
 S $P(GMTS1,"<",((79-$L(GMTST))\2)\2)="<",GMTS1=GMTS_GMTS1,GMTS=""
"RTN","GMTSPN2",102,0)
 S $P(GMTS,">",((79-$L(GMTST))\2)\2)=">"
"RTN","GMTSPN2",103,0)
 S $P(GMTS2,">",((79-$L(GMTST))\2)\2)=">",GMTS2=GMTS2_GMTS,GMTS=""
"RTN","GMTSPN2",104,0)
 S GMTSB=GMTS1_GMTST_GMTS2 F  Q:$L(GMTSB)'<$L(GMTST2)  S GMTSB=GMTSB_">"
"RTN","GMTSPN2",105,0)
 I +($G(GMTSW))=2 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",106,0)
 I +($G(GMTSW))=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",107,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTST2 S:$D(GMTSD) GMTSD=1
"RTN","GMTSPN2",108,0)
 I +($G(GMTSW))=2 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",109,0)
 Q
"RTN","GMTSPN2",110,0)
 ;                   
"RTN","GMTSPN2",111,0)
 ; Miscelaneous
"RTN","GMTSPN2",112,0)
BY(GMTSH,GMTSE,GMTSN) ; Signed by
"RTN","GMTSPN2",113,0)
 S GMTSH=$$TRIM($G(GMTSH)),GMTSE=$G(GMTSE),GMTSN=$G(GMTSN) Q:'$L((GMTSH_GMTSN))
"RTN","GMTSPN2",114,0)
 S:$L(GMTSH) GMTSH=GMTSH_"  " S GMTSE=$S(GMTSE="E":"/es/  ",GMTSE["/es/":"/es/  ",1:"") S:GMTSN="."&(GMTSH[" by:") GMTSH=$P(GMTSH," by:",1)_".",GMTSN="" S:GMTSN="." GMTSN=""
"RTN","GMTSPN2",115,0)
 I $L($$TRIM(GMTSH)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("",(27-$L(GMTSH))),GMTSH
"RTN","GMTSPN2",116,0)
 W ?27,GMTSE,GMTSN
"RTN","GMTSPN2",117,0)
 Q
"RTN","GMTSPN2",118,0)
SB(GMTSB,GMTSD) ; Signature Block
"RTN","GMTSPN2",119,0)
 K ^UTILITY($J,"W") N X,DIWT,DIWL,DIWR,DIWF,GMTSI
"RTN","GMTSPN2",120,0)
 S (X,GMTSB)=$G(GMTSB),GMTSD=$G(GMTSD) Q:'$L((GMTSB_GMTSD))
"RTN","GMTSPN2",121,0)
 S GMTSI=1,DIWL=0,DIWF="C35" D ^DIWP S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,1,0))) K:'$L(GMTSB) ^UTILITY($J,"W")
"RTN","GMTSPN2",122,0)
 I $L(GMTSD),'$L(GMTSB) K ^UTILITY($J,"W") D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,GMTSD Q
"RTN","GMTSPN2",123,0)
 Q:'$L(GMTSB)  D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,"  ",GMTSD
"RTN","GMTSPN2",124,0)
 F  S GMTSI=$O(^UTILITY($J,"W",0,GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",125,0)
 . S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,GMTSI,0))) Q:'$L(GMTSB)
"RTN","GMTSPN2",126,0)
 . D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,"  "
"RTN","GMTSPN2",127,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPN2",128,0)
 Q
"RTN","GMTSPN2",129,0)
PG(GMTSA,GMTSD) ; Pagers
"RTN","GMTSPN2",130,0)
 N GMTS S GMTS=0,GMTSA=$G(GMTSA),GMTSD=$G(GMTSD) Q:'$L((GMTSA_GMTSD))  Q:(+GMTSA+GMTSD)'>0
"RTN","GMTSPN2",131,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I $L(GMTSA),+GMTSA>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",132,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",GMTSA S GMTS=1
"RTN","GMTSPN2",133,0)
 I $L(GMTSD),+GMTSD>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",134,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",GMTSD S GMTS=1
"RTN","GMTSPN2",135,0)
 Q
"RTN","GMTSPN2",136,0)
BL ;   Blank Line
"RTN","GMTSPN2",137,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN2",138,0)
TRIM(X) ;   Trim Spaces from String
"RTN","GMTSPN2",139,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPN2",140,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPN2",141,0)
 Q X
"RTN","GMTSPNB")
0^37^B7835224
"RTN","GMTSPNB",1,0)
GMTSPNB ; SLC/JER/KER - TIU Brief Progress Notes           ; 02/27/2002
"RTN","GMTSPNB",2,0)
 ;;2.7;Health Summary;**12,28,33,49**;Oct 20, 1995
"RTN","GMTSPNB",3,0)
 ;                   
"RTN","GMTSPNB",4,0)
 ; External References
"RTN","GMTSPNB",5,0)
 ;   DBIA 10006  ^DIC  (file #8925.1)
"RTN","GMTSPNB",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPNB",7,0)
 ;   DBIA  2902  VISIT^TIULAPIC
"RTN","GMTSPNB",8,0)
 ;   DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSPNB",9,0)
 ;                    
"RTN","GMTSPNB",10,0)
MAIN ; Controls branching and execution
"RTN","GMTSPNB",11,0)
 N PN,GMTSI,GMTSJ,TIUFPRIV,TIUSTAT,TIUTYPE,X,DIWF,DIWL,DIWR,MAX
"RTN","GMTSPNB",12,0)
 K ^TMP("TIU",$J) S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:10)
"RTN","GMTSPNB",13,0)
 S TIUSTAT="COMPLETED",TIUFPRIV=1
"RTN","GMTSPNB",14,0)
 N X,Y S X="PROGRESS NOTES",DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL""" D ^DIC S:Y>0 TIUTYPE=+Y
"RTN","GMTSPNB",15,0)
 D EXTIU(DFN,TIUTYPE,GMTS1,GMTS2,MAX,0) Q:'$D(^TMP("TIU",$J))
"RTN","GMTSPNB",16,0)
 D HEADER S GMTSI=0 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",17,0)
 . S GMTSJ=0 F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",18,0)
 . . D VARI(GMTSI,GMTSJ)
"RTN","GMTSPNB",19,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND(GMTSI,GMTSJ)
"RTN","GMTSPNB",20,0)
 . . D WRT
"RTN","GMTSPNB",21,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNB",22,0)
 Q
"RTN","GMTSPNB",23,0)
 ;
"RTN","GMTSPNB",24,0)
HEADER ; Prints header
"RTN","GMTSPNB",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Prog Note DT",?16,"Title",?48,"Author",?64,"Last Corr DT",!!
"RTN","GMTSPNB",26,0)
 Q
"RTN","GMTSPNB",27,0)
 ;
"RTN","GMTSPNB",28,0)
VARI(GMTSI,GMTSJ) ;Sets variables for display
"RTN","GMTSPNB",29,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPNB",30,0)
 S X=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")) D REGDT4^GMTSU S PN("DATE")=X
"RTN","GMTSPNB",31,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSPNB",32,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSPNB",33,0)
 I $L(PN("DOCTYPE"))>30 D FORMAT S PN("DOCTYPE")=^UTILITY($J,"W",1,1,0)
"RTN","GMTSPNB",34,0)
 S PN("CORRDT")=""
"RTN","GMTSPNB",35,0)
 Q
"RTN","GMTSPNB",36,0)
 ;
"RTN","GMTSPNB",37,0)
ADDEND(GMTSI,GMTSJ) ;Addenda date display
"RTN","GMTSPNB",38,0)
 N GMTSAD
"RTN","GMTSPNB",39,0)
 S GMTSAD=0
"RTN","GMTSPNB",40,0)
 S GMTSAD=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD)) Q:+GMTSAD'>0 
"RTN","GMTSPNB",41,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD,1301,"I")
"RTN","GMTSPNB",42,0)
 D REGDT4^GMTSU S PN("CORRDT")=X
"RTN","GMTSPNB",43,0)
 Q
"RTN","GMTSPNB",44,0)
 ;
"RTN","GMTSPNB",45,0)
WRT ; Writes the component data
"RTN","GMTSPNB",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPNB",47,0)
 D:GMTSNPG HEADER W PN("DATE"),?16,PN("DOCTYPE"),?48,PN("AUTHOR"),?64,PN("CORRDT"),!
"RTN","GMTSPNB",48,0)
 I $D(^UTILITY($J,"W",1,2,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,^UTILITY($J,"W",1,2,0),!
"RTN","GMTSPNB",49,0)
 K PN,^UTILITY($J)
"RTN","GMTSPNB",50,0)
 Q
"RTN","GMTSPNB",51,0)
 ;
"RTN","GMTSPNB",52,0)
FORMAT ; Calls ^DIWP to format Title
"RTN","GMTSPNB",53,0)
 N DIWF,DIWL,DIWR,X
"RTN","GMTSPNB",54,0)
 S DIWF="C30",DIWL=1,DIWR=30,X=PN("DOCTYPE") D ^DIWP
"RTN","GMTSPNB",55,0)
 Q
"RTN","GMTSPNB",56,0)
EXTIU(DFN,GMTST,GMTS1,GMTS2,GMTSN,GMTSX) ; Extract Patient/Visit VIA TIU
"RTN","GMTSPNB",57,0)
 N GMTSPV S GMTSPV=+($G(GMTSPXGO)) I GMTSPV,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX)) Q
"RTN","GMTSPNB",58,0)
 D MAIN^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX))
"RTN","GMTSPNB",59,0)
 Q
"RTN","GMTSPXOP")
0^28^B47884689
"RTN","GMTSPXOP",1,0)
GMTSPXOP ; SLC/SBW,KER - PCE Outpatient Encounter comp ; 02/27/2002
"RTN","GMTSPXOP",2,0)
 ;;2.7;Health Summary;**8,10,28,37,47,49**;Oct 20, 1995
"RTN","GMTSPXOP",3,0)
 ;
"RTN","GMTSPXOP",4,0)
 ; External References
"RTN","GMTSPXOP",5,0)
 ;    DBIA  1238  VISIT^PXRHS01
"RTN","GMTSPXOP",6,0)
 ;    DBIA  1996  $$MOD^ICPTMOD
"RTN","GMTSPXOP",7,0)
 ;    DBIA 10103  $$DT^XLFDT
"RTN","GMTSPXOP",8,0)
 ;    DBIA 10011  ^DIWP
"RTN","GMTSPXOP",9,0)
 ;                      
"RTN","GMTSPXOP",10,0)
PURPOSE ; Encounters with ICD9 and providers
"RTN","GMTSPXOP",11,0)
 N DTYPE S DTYPE="DP" D MAIN Q
"RTN","GMTSPXOP",12,0)
OUTPT ; Encounters with ICD9, CPT, and providers
"RTN","GMTSPXOP",13,0)
 N DTYPE S DTYPE="CDP" D MAIN Q
"RTN","GMTSPXOP",14,0)
MAIN ; Entry for Purpose of Visit and Outpatient Encounters
"RTN","GMTSPXOP",15,0)
 N GMTSIVD,GMTSDAT,GMTSDTU,GMTSOVT,GMTSLOC,DIWL,GMTAB,GMTSN,GMCKP,GMTSX
"RTN","GMTSPXOP",16,0)
 N GMTSITE,GMTSINS,GMTSEVT,GMTSHIS,GMTSICL,GMTSLOC,GMTSELIG,X,GMTSVDF
"RTN","GMTSPXOP",17,0)
 N GMTSCPTM,GMICL
"RTN","GMTSPXOP",18,0)
 ;                     
"RTN","GMTSPXOP",19,0)
 ; GMTSCPTM    Component uses CPT Modifiers 1 yes 0 no
"RTN","GMTSPXOP",20,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSPXOP",21,0)
 ; GMTSICL     # of blank left columns for support data of a visit
"RTN","GMTSPXOP",22,0)
 S GMTSICL=14
"RTN","GMTSPXOP",23,0)
 ; DIWL        Used in TXTFMT call & to print returned data
"RTN","GMTSPXOP",24,0)
 S DIWL=0
"RTN","GMTSPXOP",25,0)
 ; GMTAB       Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPXOP",26,0)
 S GMTAB=2
"RTN","GMTSPXOP",27,0)
 ; GMTSOVT     This is the set of Service Categories for AICTSORE
"RTN","GMTSPXOP",28,0)
 ;                     
"RTN","GMTSPXOP",29,0)
 ;                A  Ambulatory
"RTN","GMTSPXOP",30,0)
 ;                I  Inpatient
"RTN","GMTSPXOP",31,0)
 ;                C  Chart Review
"RTN","GMTSPXOP",32,0)
 ;                T  Telecommunications
"RTN","GMTSPXOP",33,0)
 ;                S  Day Surgery
"RTN","GMTSPXOP",34,0)
 ;                O  Observation
"RTN","GMTSPXOP",35,0)
 ;                R  Nursing Home Encounters
"RTN","GMTSPXOP",36,0)
 ;                E  Event (Historical)
"RTN","GMTSPXOP",37,0)
 ;                  
"RTN","GMTSPXOP",38,0)
 ;            Note:  Hospitalization and Ancillary 
"RTN","GMTSPXOP",39,0)
 ;                   encounters are not included
"RTN","GMTSPXOP",40,0)
 S GMTSOVT="AICTSORE"
"RTN","GMTSPXOP",41,0)
 ;
"RTN","GMTSPXOP",42,0)
 D VISIT^PXRHS01(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT,DTYPE,1)
"RTN","GMTSPXOP",43,0)
 Q:'$D(^TMP("PXHSV",$J))
"RTN","GMTSPXOP",44,0)
 S GMTSIVD=0
"RTN","GMTSPXOP",45,0)
 F  S GMTSIVD=$O(^TMP("PXHSV",$J,GMTSIVD)) Q:GMTSIVD']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",46,0)
 . S GMTSVDF=0
"RTN","GMTSPXOP",47,0)
 . F  S GMTSVDF=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF)) Q:GMTSVDF'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",48,0)
 . . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0))
"RTN","GMTSPXOP",49,0)
 . . S GMTSEVT=$P(GMTSN,U,4),GMTSHIS=$S(GMTSEVT["HISTORICAL":1,1:0)
"RTN","GMTSPXOP",50,0)
 . . S X=$P(GMTSN,U,1) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXOP",51,0)
 . . S GMTSDTU=0,(GMTSITE,GMTSLOC)=""
"RTN","GMTSPXOP",52,0)
 . . S GMTSINS=$S($P(GMTSN,U,3)]"":$E($P(GMTSN,U,3),1,10),$P(GMTSN,U,8)]"":$E($P(GMTSN,U,8),1,10),1:""),GMTSITE=GMTSINS
"RTN","GMTSPXOP",53,0)
 . . I $G(GMPXHLOC)'="N" S GMTSLOC=$E($P(GMTSN,U,6),1,30)
"RTN","GMTSPXOP",54,0)
 . . I '$L(GMTSLOC) S GMTSLOC=$P(GMTSN,U,9)
"RTN","GMTSPXOP",55,0)
 . . S GMTSELIG=$E($P(GMTSN,U,12),1,17)
"RTN","GMTSPXOP",56,0)
 . . S:GMTSITE=""&('GMTSHIS) GMTSLOC=""
"RTN","GMTSPXOP",57,0)
 . . I GMTSHIS D
"RTN","GMTSPXOP",58,0)
 . . . S:GMTSLOC'=""&(GMTSITE'="") GMTSLOC=GMTSLOC_" (Historical Event)"
"RTN","GMTSPXOP",59,0)
 . . . S:GMTSLOC=""&(GMTSITE'="") GMTSITE=GMTSITE_" (Historical Event)"
"RTN","GMTSPXOP",60,0)
 . . . S:GMTSLOC'=""&(GMTSITE="") GMTSITE=GMTSLOC_" (Historical Event)",GMTSLOC=""
"RTN","GMTSPXOP",61,0)
 . . . S:GMTSLOC=""&(GMTSITE="") GMTSITE="Historical Event"
"RTN","GMTSPXOP",62,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS,DSPPROV Q:$D(GMTSQIT)
"RTN","GMTSPXOP",63,0)
 . . D DSPPOV Q:$D(GMTSQIT)  D DSPCPT W !
"RTN","GMTSPXOP",64,0)
 K ^TMP("PXHSV",$J)
"RTN","GMTSPXOP",65,0)
 Q
"RTN","GMTSPXOP",66,0)
 ;                     
"RTN","GMTSPXOP",67,0)
DSPPOV ; Display Purpose of visit
"RTN","GMTSPXOP",68,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",""))=""
"RTN","GMTSPXOP",69,0)
 Q:$G(GMPXICDF)="N"&($G(GMPXNARR)="N")
"RTN","GMTSPXOP",70,0)
 N GMTSN,GMTSMOD,GMTSICD,GMTSNARR,GMTSPDN,GMTS,GMTSQTY,GMTSPRI,COMMENT
"RTN","GMTSPXOP",71,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Diagnosis:"
"RTN","GMTSPXOP",72,0)
 S GMCKP=0,GMTSPDN="",GMTSQTY=""
"RTN","GMTSPXOP",73,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",74,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN))
"RTN","GMTSPXOP",75,0)
 . S GMTSMOD=$P(GMTSN,U,2)
"RTN","GMTSPXOP",76,0)
 . S GMTSICD=$P(GMTSN,U) D GETICDDX^GMTSPXU1(.GMTSICD,$G(GMPXICDF),GMTSMOD)
"RTN","GMTSPXOP",77,0)
 . S GMTSNARR=""
"RTN","GMTSPXOP",78,0)
 . S:$G(GMPXNARR)'="N" GMTSNARR=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"N"))
"RTN","GMTSPXOP",79,0)
 . I $P(GMTSICD,"-",2,10)=$G(GMTSNARR) S GMTSNARR=""
"RTN","GMTSPXOP",80,0)
 . S GMTSPRI="" I $P(GMTSN,U,5)]"",$E($P(GMTSN,U,5),1)="P" S GMTSPRI=" (P)"
"RTN","GMTSPXOP",81,0)
 . D TXTFMT^GMTSPXU1(GMTSICD,$G(GMTSNARR),GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",82,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXOP",83,0)
 . S GMTSX=0
"RTN","GMTSPXOP",84,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXOP",85,0)
 . . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",86,0)
 . . S GMCKP=1
"RTN","GMTSPXOP",87,0)
 . . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXOP",88,0)
 . S COMMENT="",COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",89,0)
 . I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",90,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",91,0)
 Q
"RTN","GMTSPXOP",92,0)
DSPCPT ; Display Procedures performed during the visit
"RTN","GMTSPXOP",93,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",""))=""
"RTN","GMTSPXOP",94,0)
 N GMTSNARR,GMTSPDN,GMTSN,GMTSICD,GMTSNARR,GMTSCPT,GMTSQTY,GMTSPRIM,GMTSPRI
"RTN","GMTSPXOP",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Procedure:"
"RTN","GMTSPXOP",96,0)
 S GMCKP=0,GMTSPDN="",GMTSPRI=""
"RTN","GMTSPXOP",97,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",98,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN))
"RTN","GMTSPXOP",99,0)
 . S GMTSNARR=$P(GMTSN,U,2),GMTSQTY=$P(GMTSN,U,3),GMTSPRIM=$P(GMTSN,U,4)
"RTN","GMTSPXOP",100,0)
 . S GMTSCPT=$$GETCPT^GMTSPXU1($P(GMTSN,U)) I $P(GMTSCPT,"-",2,10)=GMTSNARR S GMTSNARR=""
"RTN","GMTSPXOP",101,0)
 . S GMTSPRI="" S:$G(GMTSQTY)]"" GMTSQTY=" ("_GMTSQTY_")" S:$G(GMTSPRIM)="Y" GMTSPRI="(P)"
"RTN","GMTSPXOP",102,0)
 . D TXTFMT^GMTSPXU1(GMTSCPT,GMTSNARR,GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",103,0)
 . Q:'$D(^UTILITY($J,"W"))  D DCPT
"RTN","GMTSPXOP",104,0)
 Q
"RTN","GMTSPXOP",105,0)
DCPT ; Display CPT Comments
"RTN","GMTSPXOP",106,0)
 N GMTSLN,GMTSMOK,GMTSX S (GMTSMOK,GMTSX)=0
"RTN","GMTSPXOP",107,0)
 F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",108,0)
 . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS Q:$D(GMTSQIT)
"RTN","GMTSPXOP",109,0)
 . S (GMTSMOK,GMCKP)=1 W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0)
"RTN","GMTSPXOP",110,0)
 . W $G(^UTILITY($J,"W",DIWL,GMTSX,0))
"RTN","GMTSPXOP",111,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",112,0)
 Q:DTYPE="DP"
"RTN","GMTSPXOP",113,0)
 S COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",114,0)
 I COMMENT]"" W !,COMMENT,! S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",115,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",116,0)
 S:+($G(GMTSCPTM))=0 GMTSMOK=0 D:GMTSMOK DMOD
"RTN","GMTSPXOP",117,0)
 Q
"RTN","GMTSPXOP",118,0)
DMOD ; Display CPT Modifier Comments
"RTN","GMTSPXOP",119,0)
 N GMTSM S GMTSM=0
"RTN","GMTSPXOP",120,0)
 F  S GMTSM=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,GMTSM)) Q:+GMTSM=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",121,0)
 . N COMMENT S COMMENT=$$FCM(+GMTSM) Q:'$L(COMMENT)
"RTN","GMTSPXOP",122,0)
 . S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",123,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE2 Q:$D(GMTSQIT)
"RTN","GMTSPXOP",124,0)
 Q
"RTN","GMTSPXOP",125,0)
DSPPROV ; Display Providers for visit
"RTN","GMTSPXOP",126,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",""))=""
"RTN","GMTSPXOP",127,0)
 N GMCNT,GMPROV
"RTN","GMTSPXOP",128,0)
 D ORDERPRO^GMTSPXU1(.GMPROV,20)
"RTN","GMTSPXOP",129,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3," Provider:"
"RTN","GMTSPXOP",130,0)
 S GMCNT=0
"RTN","GMTSPXOP",131,0)
 F  S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0  D  Q:GMCNT'>0!$D(GMTSQIT)
"RTN","GMTSPXOP",132,0)
 . I GMCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",133,0)
 . W ?GMTSICL,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",134,0)
 . W ?37,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",135,0)
 . W ?60,GMPROV(GMCNT)
"RTN","GMTSPXOP",136,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:$O(GMPROV(GMCNT)) !
"RTN","GMTSPXOP",137,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",138,0)
 Q
"RTN","GMTSPXOP",139,0)
DSPVIS ; Display outpatient visit data
"RTN","GMTSPXOP",140,0)
 Q:GMTSNPG'>0&(GMTSDTU>0)  D:GMTSNPG HDR I GMTSNPG!(+GMTSDTU'>0) D
"RTN","GMTSPXOP",141,0)
 . W GMTSDAT,?14,GMTSITE,?29,GMTSLOC,?61,GMTSELIG
"RTN","GMTSPXOP",142,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",143,0)
 . S GMTSDTU=1
"RTN","GMTSPXOP",144,0)
 Q
"RTN","GMTSPXOP",145,0)
HDR ; Display header
"RTN","GMTSPXOP",146,0)
 W ?3,"Date",?14,"Facility",?29,"Hospital Location",?61,"Encounter Elig.",!!
"RTN","GMTSPXOP",147,0)
 Q
"RTN","GMTSPXOP",148,0)
FORMAT ; Formats Diagnosis/Procedure line of text
"RTN","GMTSPXOP",149,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W") S X=COMMENT D ^DIWP
"RTN","GMTSPXOP",150,0)
 Q
"RTN","GMTSPXOP",151,0)
FCM(X) ; Format CPT Modifier comment
"RTN","GMTSPXOP",152,0)
 N Y,%,%H,GMTSIEN,GMTSC,GMTSS,GMTST S GMTSIEN=+($G(X)) Q:GMTSIEN=0 ""
"RTN","GMTSPXOP",153,0)
 S:'$D(DT)!(+($G(DT))=0) DT=$$DT^XLFDT
"RTN","GMTSPXOP",154,0)
 S X=$$MOD^ICPTMOD(GMTSIEN,"E",)
"RTN","GMTSPXOP",155,0)
 S GMTSC=$P(X,"^",2),GMTSS=$P(X,"^",3)
"RTN","GMTSPXOP",156,0)
 S GMTST=$$EN2^GMTSUMX(GMTSS) S Y=""
"RTN","GMTSPXOP",157,0)
 S:$L(GMTST)&($L(GMTSC)) Y=GMTSC_"-"_GMTST
"RTN","GMTSPXOP",158,0)
 S:'$L(GMTST)&($L(GMTSS))&($L(GMTSC)) Y=GMTSC_"-"_GMTSS
"RTN","GMTSPXOP",159,0)
 S:'$L(GMTST)&('$L(GMTSS))&($L(GMTSC)) Y=GMTSC
"RTN","GMTSPXOP",160,0)
 S:Y["-" Y="Modifier "_Y S X=Y
"RTN","GMTSPXOP",161,0)
 Q X
"RTN","GMTSPXOP",162,0)
LINE ; Writes formatted lines
"RTN","GMTSPXOP",163,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSPXOP",164,0)
LINE2 ; Writes indented formatted lines
"RTN","GMTSPXOP",165,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  N GMTST S GMTST=20 S:+($G(GMTSLN))>1 GMTST=31 W ?GMTST,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSRAE")
0^27^B54932099
"RTN","GMTSRAE",1,0)
GMTSRAE ; SLC/KER HIN/GJC Selected Radiology Extract ; 02/27/2002
"RTN","GMTSRAE",2,0)
 ;;2.7;Health Summary;**14,25,30,37,40,47,49**;Oct 20, 1995
"RTN","GMTSRAE",3,0)
 ;
"RTN","GMTSRAE",4,0)
 ; External References
"RTN","GMTSRAE",5,0)
 ;   DBIA  3125  ^RADPT( file 70
"RTN","GMTSRAE",6,0)
 ;   DBIA   501  ^RARPT( file 74, fields 5, 200, 300 and 400
"RTN","GMTSRAE",7,0)
 ;   DBIA  3417  ^RA(72, file 72, field 3 pending
"RTN","GMTSRAE",8,0)
 ;   DBIA   502  ^RAMIS(71, file 71, field 9
"RTN","GMTSRAE",9,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSRAE",10,0)
 ;   DBIA  2056  $$GET1^DIQ (files 71, 72, and 74)
"RTN","GMTSRAE",11,0)
 ;   DBIA  2056  GETS^DIQ (file 70, subfile 70.03)
"RTN","GMTSRAE",12,0)
 ;   DBIA  1995  $$CPT^ICPTCOD
"RTN","GMTSRAE",13,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSRAE",14,0)
 ;   DBIA  1996  $$MOD^ICPTMOD
"RTN","GMTSRAE",15,0)
 ;   DBIA 10005  DT^DICRW
"RTN","GMTSRAE",16,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSRAE",17,0)
 ;                        
"RTN","GMTSRAE",18,0)
MAINSEL(MODE,TEST) ; Entry for Selection Items
"RTN","GMTSRAE",19,0)
 N GMTSIDT,GMTSIDT2,GMTSCNT,GMTSPN,GMTSMAX K ^TMP("RAE",$J) S GMTSCNT=0,GMTSMAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAE",20,0)
 S GMTSIDT=+GMTS1,GMTSIDT2=+($P(+GMTS2,".",1))_".999999"
"RTN","GMTSRAE",21,0)
 S:+($G(GMTSPXGO))=0 GMTSIDT=$P(GMTS1,".",1),GMTSIDT2=$P(GMTS2,".",1)_".999999"
"RTN","GMTSRAE",22,0)
 F  S GMTSIDT=$O(^RADPT(DFN,"DT","AP",TEST,GMTSIDT)) Q:GMTSIDT'>0!(GMTSIDT>GMTSIDT2)!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",23,0)
 . Q:'$D(^RADPT(DFN,"DT",GMTSIDT,0))  N GMTS7002,GMTSPSET,GMTSXSET
"RTN","GMTSRAE",24,0)
 . S GMTS7002=$G(^RADPT(DFN,"DT",GMTSIDT,0))
"RTN","GMTSRAE",25,0)
 . S GMTSXSET=+$P(GMTS7002,"^",5)
"RTN","GMTSRAE",26,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^RADPT(DFN,"DT","AP",TEST,GMTSIDT,GMTSPN)) Q:GMTSPN'>0!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",27,0)
 . . S GMTSCNT=GMTSCNT+1 D GET
"RTN","GMTSRAE",28,0)
 Q
"RTN","GMTSRAE",29,0)
MAIN(MODE) ; Main Entry
"RTN","GMTSRAE",30,0)
 N GMTSIDT,GMTSCNT,GMTSPN,GMTSMAX
"RTN","GMTSRAE",31,0)
 K ^TMP("RAE",$J) S GMTSCNT=0,GMTSMAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAE",32,0)
 S GMTSIDT=+GMTS1,GMTSIDT2=+($P(+GMTS2,".",1))_".999999"
"RTN","GMTSRAE",33,0)
 S:+($G(GMTSPXGO))=0 GMTSIDT=$P(GMTS1,".",1),GMTSIDT2=$P(GMTS2,".",1)_".999999"
"RTN","GMTSRAE",34,0)
 F  S GMTSIDT=$O(^RADPT(DFN,"DT",GMTSIDT)) Q:GMTSIDT'>0!(GMTSIDT>GMTSIDT2)!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",35,0)
 . Q:'$D(^RADPT(DFN,"DT",GMTSIDT,0))  N GMTS7002,GMTSPSET,GMTSXSET
"RTN","GMTSRAE",36,0)
 . S GMTS7002=$G(^RADPT(DFN,"DT",GMTSIDT,0))
"RTN","GMTSRAE",37,0)
 . S GMTSXSET=+$P(GMTS7002,"^",5)
"RTN","GMTSRAE",38,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^RADPT(DFN,"DT",GMTSIDT,"P",GMTSPN)) Q:GMTSPN'>0!(+GMTSCNT'<GMTSMAX)  D
"RTN","GMTSRAE",39,0)
 . . S GMTSCNT=GMTSCNT+1 D GET
"RTN","GMTSRAE",40,0)
 Q
"RTN","GMTSRAE",41,0)
 ;                   
"RTN","GMTSRAE",42,0)
GET ; Gets data associated with study and sets global array
"RTN","GMTSRAE",43,0)
 ; ^TMP("RAE",$J, where:
"RTN","GMTSRAE",44,0)
 ;           
"RTN","GMTSRAE",45,0)
 ;    GMTSIDT = inverse exam date/time
"RTN","GMTSRAE",46,0)
 ;    GMTSPN  = Case IEN
"RTN","GMTSRAE",47,0)
 ;           
"RTN","GMTSRAE",48,0)
 ; ^TMP("RAE",$J,GMTSIDT,GMTSPN,0)= <exam date> ^ 
"RTN","GMTSRAE",49,0)
 ; <procedure> ^ <exam status> ^ <report status> ^ 
"RTN","GMTSRAE",50,0)
 ; <prim interpret resident> ^ <prim interpret staff> ^
"RTN","GMTSRAE",51,0)
 ; <CPT code> ^ <technologist> ^ <case number> ^
"RTN","GMTSRAE",52,0)
 ; < exam status order >
"RTN","GMTSRAE",53,0)
 ;           
"RTN","GMTSRAE",54,0)
 ; ^TMP("RAE",$J,GMTSIDT,"EXAMSET") Indicates if all 
"RTN","GMTSRAE",55,0)
 ; exams for this date/time are part of an exam set
"RTN","GMTSRAE",56,0)
 ;           
"RTN","GMTSRAE",57,0)
 ; ^TMP("RAE",$J,GMTSIDT,"PRINTSET") Indicates if all 
"RTN","GMTSRAE",58,0)
 ; exams for this exam set share the same report
"RTN","GMTSRAE",59,0)
 ;           
"RTN","GMTSRAE",60,0)
 ; Only if the report is verified -OR- released will 
"RTN","GMTSRAE",61,0)
 ; these nodes be set
"RTN","GMTSRAE",62,0)
 ;                  
"RTN","GMTSRAE",63,0)
 ; ^TMP("RAE",$J,IDT,PN,"D",seq #) = Dx codes
"RTN","GMTSRAE",64,0)
 ;     Sequence # = 1   Primary Dx
"RTN","GMTSRAE",65,0)
 ;     Sequence # > 1   Secondary Dx
"RTN","GMTSRAE",66,0)
 ; ^TMP("RAE",$J,IDT,PN,"H",line #)= Clinical History line #
"RTN","GMTSRAE",67,0)
 ; ^TMP("RAE",$J,IDT,PN,"I",line #)= Impression Text line #
"RTN","GMTSRAE",68,0)
 ; ^TMP("RAE",$J,IDT,PN,"R",line #)= Report Text line #
"RTN","GMTSRAE",69,0)
 ;           
"RTN","GMTSRAE",70,0)
 N DA,DIC,DIQ,%,D0,DIW,DIWI,DIWT,DIWTC,DIWX,DIWF,DIWL,DIWR,DN,DR
"RTN","GMTSRAE",71,0)
 N I,J,Y,Z,GMTSCPT,GMTSED,GMTSCN,GMTSRP,GMTSRPI,GMTSST,GMTSPTR
"RTN","GMTSRAE",72,0)
 N GMTSTA,GMTSTAI,GMTSI,GMTSRAD,GMTSRRAD,GMTSSRAD,GMTSTC,GMTSSTO
"RTN","GMTSRAE",73,0)
 S GMTSED=+$P(GMTS7002,"^")
"RTN","GMTSRAE",74,0)
 S:GMTSXSET&('$D(^TMP("RAE",$J,GMTSIDT,"EXAMSET"))) ^TMP("RAE",$J,GMTSIDT,"EXAMSET")=""
"RTN","GMTSRAE",75,0)
 ;   Get
"RTN","GMTSRAE",76,0)
 ;     Exam Date    $P($G(^RADPT(DFN,"DT",GMTSIDT,0)),"^",1)
"RTN","GMTSRAE",77,0)
 ;     Exam Set     $P($G(^RADPT(DFN,"DT",GMTSIDT,0)),"^",5)
"RTN","GMTSRAE",78,0)
 ;     Case Number             70.03   .01   GMTSCN
"RTN","GMTSRAE",79,0)
 ;     Procedure               70.03    2    GMTSRP/GMTSRPI
"RTN","GMTSRAE",80,0)
 ;     Exam Status             70.03    3    GMTSST
"RTN","GMTSRAE",81,0)
 ;     Prim Interpret Resident 70.03   12    GMTSRRAD
"RTN","GMTSRAE",82,0)
 ;     Prim Diagnostic Code    70.03   13    GMTSDX
"RTN","GMTSRAE",83,0)
 ;     Prim Interpreting Staff 70.03   15    GMTSSRAD
"RTN","GMTSRAE",84,0)
 ;     Report Text             70.03   17    
"RTN","GMTSRAE",85,0)
 ;     Member of Set           70.03   25
"RTN","GMTSRAE",86,0)
 ;     Exam Status Order       72       3    GMTSSTO
"RTN","GMTSRAE",87,0)
 ;           
"RTN","GMTSRAE",88,0)
 S DIC="^RADPT("_DFN_",""DT"","_GMTSIDT_",""P"",",DA=GMTSPN,DIQ="GMTSRAD("
"RTN","GMTSRAE",89,0)
 S DIQ(0)="IE",DR=".01;2;3;12;13;15;17;25" D TECH
"RTN","GMTSRAE",90,0)
 D EN^DIQ1
"RTN","GMTSRAE",91,0)
 S GMTSCN=$G(GMTSRAD(70.03,GMTSPN,.01,"E"))
"RTN","GMTSRAE",92,0)
 S GMTSRP=$G(GMTSRAD(70.03,GMTSPN,2,"E"))
"RTN","GMTSRAE",93,0)
 S GMTSRPI=$G(GMTSRAD(70.03,GMTSPN,2,"I"))
"RTN","GMTSRAE",94,0)
 S GMTSST=$G(GMTSRAD(70.03,GMTSPN,3,"E"))
"RTN","GMTSRAE",95,0)
 S GMTSSTO=$G(GMTSRAD(70.03,GMTSPN,3,"I"))
"RTN","GMTSRAE",96,0)
 S GMTSSTO=$$GET1^DIQ(72,+GMTSSTO,3,"I")
"RTN","GMTSRAE",97,0)
 I GMTSTC S GMTSTC(0)=$E($G(GMTSRAD(70.12,GMTSTC,.01,"E")),1,18)
"RTN","GMTSRAE",98,0)
 S GMTSRRAD=$E($G(GMTSRAD(70.03,GMTSPN,12,"E")),1,18)
"RTN","GMTSRAE",99,0)
 S GMTSSRAD=$E($G(GMTSRAD(70.03,GMTSPN,15,"E")),1,18)
"RTN","GMTSRAE",100,0)
 S GMTSPTR=$G(GMTSRAD(70.03,GMTSPN,17,"I"))
"RTN","GMTSRAE",101,0)
 ; Exam Set/Report
"RTN","GMTSRAE",102,0)
 ;           
"RTN","GMTSRAE",103,0)
 ;     If GMTSPSET = ""   single exam
"RTN","GMTSRAE",104,0)
 ;     If GMTSPSET = 1    exam set, single report
"RTN","GMTSRAE",105,0)
 ;     If GMTSPSET = 2    exam set, combined report
"RTN","GMTSRAE",106,0)
 ;           
"RTN","GMTSRAE",107,0)
 S GMTSPSET=$G(GMTSRAD(70.03,GMTSPN,25,"I"))
"RTN","GMTSRAE",108,0)
 D PMOD,CMOD I +GMTSPTR>0 S DIC="^RARPT(",DA=GMTSPTR,DIQ="GMTSRAD(",DIQ(0)="IE",DR="5" D EN^DIQ1
"RTN","GMTSRAE",109,0)
 S GMTSTA=$G(GMTSRAD(74,+GMTSPTR,5,"E"))
"RTN","GMTSRAE",110,0)
 S GMTSTAI=$G(GMTSRAD(74,+GMTSPTR,5,"I"))
"RTN","GMTSRAE",111,0)
 I $L(GMTSTAI),("VR"[$E(GMTSTAI)) D GETDX(GMTSPN_","_GMTSIDT_","_DFN_",")
"RTN","GMTSRAE",112,0)
 S GMTSCPT=$$GET1^DIQ(71,+GMTSRPI,9,"I")
"RTN","GMTSRAE",113,0)
 S GMTSCPT=$S(+GMTSCPT>0:$P($$CPT^ICPTCOD(+GMTSCPT),"^",2),1:"")
"RTN","GMTSRAE",114,0)
 S ^TMP("RAE",$J,GMTSIDT,GMTSPN,0)=GMTSED_U_GMTSRP_U_GMTSST_U_GMTSTA_U_GMTSRRAD_U_GMTSSRAD_U_GMTSCPT_U_$G(GMTSTC(0))_U_GMTSCN_U_$G(GMTSSTO)
"RTN","GMTSRAE",115,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",116,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMTSI)=$G(GMTSRAD(70.1,GMTSI,.01,"E"))
"RTN","GMTSRAE",117,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",118,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMTSI)=$G(GMTSRAD(70.1,GMTSI,.01,"E"))
"RTN","GMTSRAE",119,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.3135,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",120,0)
 . Q:'$L($G(GMTSRAD(70.3135,GMTSI,.01,"M")))  Q:'$L($G(GMTSRAD(70.3135,GMTSI,.01,"N")))  N I S I=+($G(^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",0)))+1
"RTN","GMTSRAE",121,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",I)=$G(GMTSRAD(70.3135,GMTSI,.01,"M"))_"^"_$$UP^XLFSTR($G(GMTSRAD(70.3135,GMTSI,.01,"N")))_"^"_$G(GMTSRAD(70.3135,GMTSI,.01,"N")),^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",0)=I
"RTN","GMTSRAE",122,0)
 ;   Only verified reports can be printed
"RTN","GMTSRAE",123,0)
 I GMTSTAI'="V",($E(IOST)="P") D  Q
"RTN","GMTSRAE",124,0)
 . S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",125,0)
 ;   Only verified & Released/Unverified can viewed
"RTN","GMTSRAE",126,0)
 I $S(GMTSTAI="V":0,GMTSTAI="R":0,1:1) D  Q
"RTN","GMTSRAE",127,0)
 . S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",128,0)
 Q:$D(^TMP("RAE",$J,GMTSIDT,"PRINTSET"))
"RTN","GMTSRAE",129,0)
 D GETIMP D:$G(MODE)=2 GETHIS,GETREP
"RTN","GMTSRAE",130,0)
 S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",131,0)
 Q
"RTN","GMTSRAE",132,0)
 ;           
"RTN","GMTSRAE",133,0)
GETIMP ; Gets Radiologist's Impression
"RTN","GMTSRAE",134,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,300,,"GMTST")
"RTN","GMTSRAE",135,0)
 K ^UTILITY($J,"W") N X,GMTSI S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",136,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"I",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",137,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",138,0)
GETHIS ; Gets Clinical History
"RTN","GMTSRAE",139,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,400,,"GMTST")
"RTN","GMTSRAE",140,0)
 K ^UTILITY($J,"W") N X,GMTSI S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",141,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"H",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",142,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",143,0)
GETREP ; Gets Radiologist's Report
"RTN","GMTSRAE",144,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,200,,"GMTST")
"RTN","GMTSRAE",145,0)
 K ^UTILITY($J,"W") N X,I S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",146,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"R",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",147,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",148,0)
PMOD ; Procedure Modifiers
"RTN","GMTSRAE",149,0)
 N GMTS,GMTSI S GMTS=$G(DIC) Q:'$L(DIC)  S GMTSI=+($G(DA)) Q:+GMTSI=0
"RTN","GMTSRAE",150,0)
 N DIC,DA,DR S DIC=GMTS_GMTSI_",""M"","
"RTN","GMTSRAE",151,0)
 S DA=0 F  S DA=$O(@(DIC_DA_")")) Q:+DA'>0  S DR=".01" D
"RTN","GMTSRAE",152,0)
 . D EN^DIQ1
"RTN","GMTSRAE",153,0)
 Q
"RTN","GMTSRAE",154,0)
CMOD ; CPT Modifiers
"RTN","GMTSRAE",155,0)
 N GMTS,GMTSI,GMTSC,GMTSCM,GMTSCN S GMTS=$G(DIC) Q:'$L(DIC)  S GMTSI=+($G(DA)) Q:+GMTSI=0
"RTN","GMTSRAE",156,0)
 D DT^DICRW N DIC,DA,DR S DIC=GMTS_GMTSI_",""CMOD"","
"RTN","GMTSRAE",157,0)
 S DA=0 F  S DA=$O(@(DIC_DA_")")) Q:+DA'>0  S DR=".01" D EN^DIQ1
"RTN","GMTSRAE",158,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.3135,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRAE",159,0)
 . S GMTSC=$G(GMTSRAD(70.3135,GMTSI,.01,"I")) Q:+GMTSC=0
"RTN","GMTSRAE",160,0)
 . S GMTSCM=$$MOD^ICPTMOD(GMTSC,"I",)
"RTN","GMTSRAE",161,0)
 . S GMTSCN=$P(GMTSCM,"^",3),GMTSCM=$P(GMTSCM,"^",2)
"RTN","GMTSRAE",162,0)
 . S GMTSRAD(70.3135,GMTSI,.01,"M")=GMTSCM
"RTN","GMTSRAE",163,0)
 . S GMTSRAD(70.3135,GMTSI,.01,"N")=$$EN2^GMTSUMX(GMTSCN)
"RTN","GMTSRAE",164,0)
 Q
"RTN","GMTSRAE",165,0)
TECH ; Technician
"RTN","GMTSRAE",166,0)
 S GMTSTC=+$O(^RADPT(DFN,"DT",GMTSIDT,"P",GMTSPN,"TC",0))
"RTN","GMTSRAE",167,0)
 I GMTSTC S DR=$G(DR)_";175",DR(70.12)=.01,DA(70.12)=GMTSTC F  Q:$E(DR,1)'=";"  S DR=$E(DR,2,$L(DR))
"RTN","GMTSRAE",168,0)
 Q
"RTN","GMTSRAE",169,0)
FORMAT ; Calls ^DIWP to format each line of text
"RTN","GMTSRAE",170,0)
 N DIWL,DIWR,DIWF S DIWL=3,DIWR=($S(MODE=1:76,1:80))
"RTN","GMTSRAE",171,0)
 D ^DIWP Q
"RTN","GMTSRAE",172,0)
 ;               
"RTN","GMTSRAE",173,0)
GETDX(GMTSIEN) ; Set the data node with diagnostic code info.
"RTN","GMTSRAE",174,0)
 ;              
"RTN","GMTSRAE",175,0)
 ; Input:  GMTSIEN = Case IEN_","_exam date_","_DFN_","
"RTN","GMTSRAE",176,0)
 ; Output: ^TMP("RAE",$J,GMTSIDT,GMTSPN,"D",seq #) = Dx codes
"RTN","GMTSRAE",177,0)
 ;           
"RTN","GMTSRAE",178,0)
 ; Sequence # = 1   Primary Dx
"RTN","GMTSRAE",179,0)
 ; Sequence # > 1   Secondary Dx
"RTN","GMTSRAE",180,0)
 S ^TMP("RAE",$J,$P(GMTSIEN,",",2),$P(GMTSIEN,","),"D",1)=$G(GMTSRAD(70.03,$P(GMTSIEN,","),13,"E"))
"RTN","GMTSRAE",181,0)
 N GMTSI,GMTSII,GMTSDX S GMTSI=1 D GETS^DIQ(70.03,GMTSIEN,"13.1*","E","GMTSDX")
"RTN","GMTSRAE",182,0)
 S GMTSII="" F  S GMTSII=$O(GMTSDX(70.14,GMTSII)) Q:GMTSII=""  D
"RTN","GMTSRAE",183,0)
 . S GMTSI=GMTSI+1 S ^TMP("RAE",$J,$P(GMTSIEN,",",2),$P(GMTSIEN,","),"D",GMTSI)=$G(GMTSDX(70.14,GMTSII,.01,"E"))
"RTN","GMTSRAE",184,0)
 Q
"RTN","GMTSVS")
0^30^B32837615
"RTN","GMTSVS",1,0)
GMTSVS ; SLC/KER - Vital Signs Component          ; 02/27/2002
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49**;Oct 20, 1995
"RTN","GMTSVS",3,0)
 ;                          
"RTN","GMTSVS",4,0)
 ; External References
"RTN","GMTSVS",5,0)
 ;   DBIA  1446  EN1^GMRVUT0
"RTN","GMTSVS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVS",7,0)
 ;                    
"RTN","GMTSVS",8,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVS",9,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVS",10,0)
 ;                          
"RTN","GMTSVS",11,0)
OUTPAT ; Outpatient Vital Signs Main Control
"RTN","GMTSVS",12,0)
 N GMRVSTR
"RTN","GMTSVS",13,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",14,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",15,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",16,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",17,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",18,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",19,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",20,0)
 ; If no data, display message and get
"RTN","GMTSVS",21,0)
 ; most recent inpatient measurements
"RTN","GMTSVS",22,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",23,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVS",24,0)
 . S CNTR=1 D ENVS
"RTN","GMTSVS",25,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",26,0)
 ;                          
"RTN","GMTSVS",27,0)
ENVS ; Set up for Vitals Extraction Routine
"RTN","GMTSVS",28,0)
 S CNTR=$S(+($G(CNTR))>0:+($G(CNTR)),+($G(CNTR))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",29,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",30,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",31,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",32,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",33,0)
 D EN1^GMRVUT0 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",34,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",35,0)
 ;                          
"RTN","GMTSVS",36,0)
FIRST ; First Set of Vitals
"RTN","GMTSVS",37,0)
 ;  1     2      3     4   5     6       7         8
"RTN","GMTSVS",38,0)
 ; Date^Temp()^Pulse^Respt^BP^Height()^Weight()^Control
"RTN","GMTSVS",39,0)
 N GMW,GMTSCCNT,GMTSCTL S CNTR("HOLDER")=CNTR S GMTSVMVR=$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVS",40,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",41,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",42,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",44,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?18,"TEMP",?30,"PULSE",?37,"RESP",?42,"BP",?51,"HT",?62,"WT",!
"RTN","GMTSVS",46,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"F(C)",?51,"IN(CM)",?62,"LB(KG)[BMI]",!
"RTN","GMTSVS",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"----",?30,"-----",?37,"----",?42,"--",?51,"------",?62,"-----------",!!
"RTN","GMTSVS",48,0)
 S GMTSCCNT=0,GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D FLOOP,FWRT
"RTN","GMTSVS",49,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",50,0)
 Q
"RTN","GMTSVS",51,0)
FLOOP ;   Loop through first set of vitals by date
"RTN","GMTSVS",52,0)
 S (GMTSCTL,GMTSVT)=""
"RTN","GMTSVS",53,0)
 F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D FFMT
"RTN","GMTSVS",54,0)
 Q
"RTN","GMTSVS",55,0)
FFMT ;   Extract and format first set of vitals
"RTN","GMTSVS",56,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN),X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",57,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",58,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",59,0)
 I GMTAB="2" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",60,0)
 I GMTAB="6" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),0)_")"
"RTN","GMTSVS",61,0)
 I GMTAB="7" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),0)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",62,0)
 I "^2^6^7^"'[GMTAB S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",63,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",64,0)
 S:GMTAB>1 GMTSCTL=GMTSCTL_$P(ARRAY,U,GMTAB),$P(ARRAY,U,8)=GMTSCTL
"RTN","GMTSVS",65,0)
 Q
"RTN","GMTSVS",66,0)
FWRT ;   Write first set of vitals by date
"RTN","GMTSVS",67,0)
 Q:$P($G(ARRAY),U,8)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",68,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",69,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",70,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?51,$P(ARRAY,U,6),?62,$P(ARRAY,U,7),!
"RTN","GMTSVS",71,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",72,0)
 K ARRAY
"RTN","GMTSVS",73,0)
 Q
"RTN","GMTSVS",74,0)
 ;                          
"RTN","GMTSVS",75,0)
SECOND ; Second Set of Vitals
"RTN","GMTSVS",76,0)
 ;  1    2   3     4     5      6
"RTN","GMTSVS",77,0)
 ; Date^CVP^PO2^Cir/Gir^Pain^Control
"RTN","GMTSVS",78,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",79,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",80,0)
 W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",81,0)
 W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",?61,"Pain",!,?18,"-----------",?30,"----------",?42,"------",?61,"----",!!
"RTN","GMTSVS",82,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D SLOOP,SWRT
"RTN","GMTSVS",83,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",84,0)
 Q
"RTN","GMTSVS",85,0)
SLOOP ;   Loop through second set of vitals by date
"RTN","GMTSVS",86,0)
 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D SFMT
"RTN","GMTSVS",87,0)
 Q
"RTN","GMTSVS",88,0)
SFMT ;   Extract and format second set of vitals
"RTN","GMTSVS",89,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",90,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",91,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,GMTSVT="PN":5,1:0)
"RTN","GMTSVS",92,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",93,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",94,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")"
"RTN","GMTSVS",95,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$$FN($P(GMTSVS,U,13),0)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:"")
"RTN","GMTSVS",96,0)
 I GMTAB=5 S $P(ARRAY,U,GMTAB)=$S($L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))'=99):$$FN($P(ARRAY,U,GMTAB),0),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=99):"No Response",1:"")
"RTN","GMTSVS",97,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,6)=GMTSCTL
"RTN","GMTSVS",98,0)
 Q
"RTN","GMTSVS",99,0)
SWRT ;   Write second set of vitals by date
"RTN","GMTSVS",100,0)
 Q:$P($G(ARRAY),U,6)=""
"RTN","GMTSVS",101,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",102,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",103,0)
 . W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",104,0)
 . W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",?61,"Pain",!,?18,"-----------",?30,"----------",?42,"------",?61,"----",!!
"RTN","GMTSVS",105,0)
 S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",106,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?42,$P(ARRAY,U,4),?61,$P(ARRAY,U,5),!
"RTN","GMTSVS",107,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",108,0)
 K ARRAY
"RTN","GMTSVS",109,0)
 Q
"RTN","GMTSVS",110,0)
 ;                          
"RTN","GMTSVS",111,0)
KILLVS ; Kill Variables
"RTN","GMTSVS",112,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",113,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",114,0)
 Q
"RTN","GMTSVS",115,0)
FN(X,Y) ; Format Number 
"RTN","GMTSVS",116,0)
 N VAL S VAL=+($G(X)),Y=$G(Y) Q:+Y'=Y X
"RTN","GMTSVS",117,0)
 S X=$FN(VAL,"",Y) Q X
"RTN","GMTSVSD")
0^31^B54054453
"RTN","GMTSVSD",1,0)
GMTSVSD ; SLC/KER - Vital Signs (Detailed)           ; 02/27/2002
"RTN","GMTSVSD",2,0)
 ;;2.7;Health Summary;**35,49**;Oct 20, 1995
"RTN","GMTSVSD",3,0)
 ;                          
"RTN","GMTSVSD",4,0)
 ; External References
"RTN","GMTSVSD",5,0)
 ;   DBIA  1446  EN1^GMRVUT0
"RTN","GMTSVSD",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSD",7,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSVSD",8,0)
 ;                    
"RTN","GMTSVSD",9,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSD",10,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSD",11,0)
 ;                     
"RTN","GMTSVSD",12,0)
 Q
"RTN","GMTSVSD",13,0)
EN ; Detailed Vital Signs main control
"RTN","GMTSVSD",14,0)
 N GMRVSTR,GMTSC1,GMTSC2,GMTSC3,GMTSC4,GMTSCNT,GMTSCD,GMTSCHR,GMTSCI
"RTN","GMTSVSD",15,0)
 N GMTSCW1,GMTSCW2,GMTSCW3,GMTSCW4,GMTSCW5,GMTSLN,GMTSMEAS,GMTSMAX
"RTN","GMTSVSD",16,0)
 N GMTSN,GMTSOK,GMTSP,GMTSPSN,GMTSQ,GMTSREM,GMTSROV,GMTST,GMTSTO,GMTSV
"RTN","GMTSVSD",17,0)
 N GMTSVCT,GMTSVD,GMTSVI,GMTSVSD,GMTSVSDT,GMTSVT,X,Y,GMTSLM,GMTSLML
"RTN","GMTSVSD",18,0)
 S GMTSLM=0 S:$D(VALM("BM"))&($G(VALM("LINES"))>0) GMTSLM=1
"RTN","GMTSVSD",19,0)
 S GMTSLML=9999999009 S:GMTSLM GMTSLML=+($G(VALM("LINES")))
"RTN","GMTSVSD",20,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSVSD",21,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="VITALS DETAILED DISPLAY" K ^TMP("GMTSVSD",$J),^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",22,0)
 S (GMTSVCT,GMTSMAX)=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",23,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSD",24,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K GMRVSTR("LT")
"RTN","GMTSVSD",25,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",26,0)
 S GMTSCW1=0,GMTSCW2=18,GMTSCW3=36,GMTSCW4=53,GMTSCW5=+($G(IOM))-2
"RTN","GMTSVSD",27,0)
 S:GMTSCW5'>49 GMTSCW5=78 I '$D(^TMP("GMTSVSD",$J)) D NOD Q
"RTN","GMTSVSD",28,0)
 D REM,OUT
"RTN","GMTSVSD",29,0)
 Q
"RTN","GMTSVSD",30,0)
 ;                
"RTN","GMTSVSD",31,0)
GET ; Get Data
"RTN","GMTSVSD",32,0)
 K ^UTILITY($J,"GMRVD") N GMTSMAX
"RTN","GMTSVSD",33,0)
 S GMTSMAX=$S(+($G(GMTSVCT))>0:+($G(GMTSVCT)),1:1) S GMTSMAX=GMTSMAX*100
"RTN","GMTSVSD",34,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVSD",35,0)
 S GMRVSTR(0)=$G(GMTSBEG)_"^"_$G(GMTSEND)_"^"_$G(GMTSMAX)_"^"_1
"RTN","GMTSVSD",36,0)
 D EN1^GMRVUT0 S GMTSMAX=+($G(GMTSVCT))
"RTN","GMTSVSD",37,0)
 Q
"RTN","GMTSVSD",38,0)
NOD ;   No Data Found
"RTN","GMTSVSD",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR
"RTN","GMTSVSD",40,0)
 W "*** No vital measurements ***",! S GMTSMAX=1 Q
"RTN","GMTSVSD",41,0)
REM ;   Remove Excess Data
"RTN","GMTSVSD",42,0)
 N GMTSMAX S GMTSMAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",43,0)
 N GMTSVD,GMTSVT,GMTSVI,GMTST
"RTN","GMTSVSD",44,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:+GMTSVD=0  D
"RTN","GMTSVSD",45,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",46,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",47,0)
 . . . I +($G(GMTST(GMTSVT)))>(GMTSMAX-1) K ^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI) Q
"RTN","GMTSVSD",48,0)
 . . . S GMTST(GMTSVT)=+($G(GMTST(GMTSVT)))+1
"RTN","GMTSVSD",49,0)
 Q
"RTN","GMTSVSD",50,0)
 ;                
"RTN","GMTSVSD",51,0)
OUT ; Output Data
"RTN","GMTSVSD",52,0)
 D HDR Q:$D(GMTSQIT)  N GMTSVD,GMTSVT,GMTSVSDT,GMTSVSD,GMTSVI,GMTSCNT S GMTSCNT=0
"RTN","GMTSVSD",53,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:GMTSVD<1!(GMTSVD="")  D
"RTN","GMTSVSD",54,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",55,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",56,0)
 . . . S GMTSVSD=$G(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:'$L(GMTSVSD)  S GMTSVSDT=$P(GMTSVSD,"^",1) Q:'$L(GMTSVSDT)  Q:+GMTSVSDT'>0  D ADD
"RTN","GMTSVSD",57,0)
 . I +($O(^TMP("GMTSVSD",$J,GMTSVD)))'=GMTSVD D WRL
"RTN","GMTSVSD",58,0)
 I GMTSCNT=0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W "No data",!
"RTN","GMTSVSD",59,0)
 Q
"RTN","GMTSVSD",60,0)
ADD ;   Add to Output Array
"RTN","GMTSVSD",61,0)
 N GMTST,GMTSTO,GMTSV,GMTSQ S GMTST=$G(GMTSVT) Q:'$L(GMTST)
"RTN","GMTSVSD",62,0)
 S GMTSTO=$$VO(GMTST) Q:GMTSTO'>0  S GMTST=$$VT(GMTST) Q:'$L(GMTST)
"RTN","GMTSVSD",63,0)
 S GMTSV=$$VM(GMTSVT,GMTSVSD)
"RTN","GMTSVSD",64,0)
 S GMTSQ=$$VQ(GMTSVSD),GMTSROV(GMTSTO)=GMTST_"^"_GMTSV_"^"_GMTSQ,GMTSCNT=+($G(GMTSCNT))+1,GMTSROV("DT")=$$EDT^GMTSU(GMTSVSDT)
"RTN","GMTSVSD",65,0)
 Q
"RTN","GMTSVSD",66,0)
WRL ;   Write Line from Array
"RTN","GMTSVSD",67,0)
 N GMTSCI,GMTSCD,GMTSC1,GMTSC2,GMTSC3,GMTSC4
"RTN","GMTSVSD",68,0)
 S (GMTSCD,GMTSC1)=$G(GMTSROV("DT")) I '$L(GMTSC1) K GMTSROV Q
"RTN","GMTSVSD",69,0)
 S GMTSCI=0 F  S GMTSCI=$O(GMTSROV(GMTSCI)) Q:+GMTSCI=0  Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",70,0)
 . S GMTSC2=$G(GMTSROV(GMTSCI)),GMTSC3=$P(GMTSC2,"^",2),GMTSC4=$P(GMTSC2,"^",3),GMTSC2=$P(GMTSC2,"^",1)
"RTN","GMTSVSD",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVSD",72,0)
 . I +($G(GMTSLM))>0 S:+($$LMP)>0 GMTSC1=GMTSCD
"RTN","GMTSVSD",73,0)
 . I GMTSNPG'=1 W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",74,0)
 . I GMTSNPG=1 S GMTSC1=GMTSCD D HDR W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",75,0)
 . S GMTSC1="   ""        ""  "
"RTN","GMTSVSD",76,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSVSD",77,0)
 K GMTSROV
"RTN","GMTSVSD",78,0)
 Q
"RTN","GMTSVSD",79,0)
LMP(X) ;
"RTN","GMTSVSD",80,0)
 Q:+($G(GMTSLML))'>0 0
"RTN","GMTSVSD",81,0)
 N GMTSP,GMTSD S GMTSP=$Y,GMTSD=0 S:GMTSP#GMTSLML=0 GMTSD=1 S X=GMTSD Q X
"RTN","GMTSVSD",82,0)
QUAL ;   Write Vital Qualifiers
"RTN","GMTSVSD",83,0)
 N GMTSOK,GMTSLN,GMTSTO,GMTSREM,GMTSPSN,GMTSCHR S GMTSLN=GMTSCW5-GMTSCW4
"RTN","GMTSVSD",84,0)
 I $L(GMTSC4)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSC4,! Q
"RTN","GMTSVSD",85,0)
 S GMTSREM=GMTSC4 F  Q:$D(GMTSQIT)  D QPARSE Q:$D(GMTSQIT)  Q:'$L(GMTSREM)
"RTN","GMTSVSD",86,0)
 Q
"RTN","GMTSVSD",87,0)
QPARSE ;     Parse Qualifier (wrap)
"RTN","GMTSVSD",88,0)
 I $L(GMTSREM)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSREM,! S GMTSREM="" Q
"RTN","GMTSVSD",89,0)
 S GMTSOK=0 F GMTSPSN=GMTSLN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSVSD",90,0)
 . I $E(GMTSREM,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSVSD",91,0)
 . I $E(GMTSREM,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSVSD",92,0)
 . I $E(GMTSREM,GMTSPSN)="/"!($E(GMTSREM,GMTSPSN)="-")!($E(GMTSREM,GMTSPSN)=")") S GMTSCHR=$E(GMTSREM,GMTSPSN),GMTSOK=1 Q
"RTN","GMTSVSD",93,0)
 I GMTSCHR=" " D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",94,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN-1)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",95,0)
 I GMTSCHR="/"!(GMTSCHR=",")!(GMTSCHR="-")!(GMTSCHR=")") D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",96,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",97,0)
 Q
"RTN","GMTSVSD",98,0)
 ;                
"RTN","GMTSVSD",99,0)
 ; Miscellaneous
"RTN","GMTSVSD",100,0)
FM(X) ;   Format Vitals Measurement
"RTN","GMTSVSD",101,0)
 S X=$$TRIM($G(X)) Q:+X'=X X
"RTN","GMTSVSD",102,0)
 S:X["." X=$FN(X,"",2) Q X
"RTN","GMTSVSD",103,0)
TRIM(X) ;   Trim Blank Spaces
"RTN","GMTSVSD",104,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSVSD",105,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSVSD",106,0)
 Q X
"RTN","GMTSVSD",107,0)
VO(X) ;   Vital Array Order
"RTN","GMTSVSD",108,0)
 S X=$G(X) Q:X="T" 1 Q:X="P" 2 Q:X="R" 3 Q:X="BP" 4 Q:X="HT" 5 Q:X="WT" 6 Q:X="CG" 7 Q:X="PN" 8 Q:X="CVP" 9 Q:X="PO2" 10 Q ""
"RTN","GMTSVSD",109,0)
VT(X) ;   Vital Type
"RTN","GMTSVSD",110,0)
 S X=$G(X) Q:X="BP" "BP" Q:X="T" "Temp F (C)" Q:X="R" "Respir" Q:X="P" "Pulse" Q:X="HT" "Ht in (cm)"
"RTN","GMTSVSD",111,0)
 Q:X="WT" "Wt lbs (kg)[BMI]" Q:X="CVP" "CVP cm H2O(mm HG)" Q:X="PO2" "PO2 (L/Min)(%)" Q:X="CG" "C/G in (cm)" Q:X="PN" "Pain" Q ""
"RTN","GMTSVSD",112,0)
VM(X,Y) ;   Vital Type Measurement
"RTN","GMTSVSD",113,0)
 N GMTSMEAS,GMTSID S GMTSMEAS="",(GMTSID,X)=$G(X) Q:"^BP^T^R^P^HT^WT^CVP^PO2^CG^PN^"'[("^"_X_"^") ""
"RTN","GMTSVSD",114,0)
 S Y=$G(Y) Q:'$L(Y) ""
"RTN","GMTSVSD",115,0)
 ;     If data for T, Ht or Wt piece 8 and 13 else  piece 8
"RTN","GMTSVSD",116,0)
 I X="T"!(X="HT")!(X="WT") S GMTSMEAS=$P(Y,"^",8)_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",117,0)
 E  S GMTSMEAS=$P(Y,"^",8)
"RTN","GMTSVSD",118,0)
 ;     WT - Weight and BMI (piece 14)
"RTN","GMTSVSD",119,0)
 I X="WT",$L($P(Y,"^",14)) S GMTSMEAS=GMTSMEAS_"["_$P(Y,"^",14)_"]"
"RTN","GMTSVSD",120,0)
 ;     CVP - Central Venous Pressure/CG - Circum/Girth
"RTN","GMTSVSD",121,0)
 I X="CVP"!(X="CG") S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",13)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",122,0)
 ;     PO2 - Pulse Oximetry
"RTN","GMTSVSD",123,0)
 I X="PO2" S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",15)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",15)_")"
"RTN","GMTSVSD",124,0)
 ;     PN - Pain
"RTN","GMTSVSD",125,0)
 S:X="PN" GMTSMEAS=$P(Y,"^",8) S:X="PN"&(GMTSMEAS=99) GMTSMEAS="No Response"
"RTN","GMTSVSD",126,0)
 S X=GMTSMEAS Q X
"RTN","GMTSVSD",127,0)
VQ(X) ;   Vital Qualifiers
"RTN","GMTSVSD",128,0)
 S X=$G(X),X=$P(X,"^",17) S:$L(X) X=$$AQ(X) Q X
"RTN","GMTSVSD",129,0)
HDR ;   Header
"RTN","GMTSVSD",130,0)
 N GMTSLN D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",131,0)
 W "Date",?GMTSCW2,"Vital",?GMTSCW3,"Measurement",?GMTSCW4,"Qualifiers",!
"RTN","GMTSVSD",132,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W $$LN((GMTSCW2-2)),?GMTSCW2,$$LN((GMTSCW3-(GMTSCW2+2))),?GMTSCW3,$$LN((GMTSCW4-(GMTSCW3+2))),?GMTSCW4,$$LN((GMTSCW5-(GMTSCW4+2)))
"RTN","GMTSVSD",133,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W !
"RTN","GMTSVSD",134,0)
 ;
"RTN","GMTSVSD",135,0)
 S GMTSNPG=0 Q
"RTN","GMTSVSD",136,0)
ST ;   Save in ^TMP Global
"RTN","GMTSVSD",137,0)
 Q:'$D(^UTILITY($J,"GMRVD"))  M ^TMP("GMTSVSD",$J)=^UTILITY($J,"GMRVD") Q
"RTN","GMTSVSD",138,0)
AQ(X) ;   All Qualifiers Field
"RTN","GMTSVSD",139,0)
 S X=$G(X) F  Q:X'[";"  S X=$P(X,";",1)_", "_$P(X,";",2,299)
"RTN","GMTSVSD",140,0)
 S X=$$MC(X) Q X
"RTN","GMTSVSD",141,0)
MC(X) ;   Mix Case for Qualifiers
"RTN","GMTSVSD",142,0)
 N GMTSP S X=$TR($G(X),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz") F GMTSP=1:1:$L(X) D
"RTN","GMTSVSD",143,0)
 . S:GMTSP=1 X=$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X)) Q:GMTSP=1
"RTN","GMTSVSD",144,0)
 . S:" /-,"[$E(X,(GMTSP-1)) X=$E(X,1,(GMTSP-1))_$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X))
"RTN","GMTSVSD",145,0)
 Q X
"RTN","GMTSVSD",146,0)
DTM(X) ;   Current Date and Time
"RTN","GMTSVSD",147,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSVSD",148,0)
FN(X,Y) ;   Format Number 
"RTN","GMTSVSD",149,0)
 N GMTSV S X=$G(X),GMTSV=+($G(X)),Y=$G(Y) S:+Y=Y X=$FN(GMTSV,"",+Y) Q X
"RTN","GMTSVSD",150,0)
LN(X) ;   Dashed Line
"RTN","GMTSVSD",151,0)
 S X=+($G(X)) Q:X=0 "" N GMTSLN S GMTSLN="",$P(GMTSLN,"-",X)="-" S X=GMTSLN Q X
"RTN","GMTSVSD",152,0)
EDT(X) ; External Date and Time
"RTN","GMTSVSD",153,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSVSD",154,0)
 D REGDTM4^GMTSU Q X
"RTN","GMTSVSS")
0^32^B40551410
"RTN","GMTSVSS",1,0)
GMTSVSS ; SLC/KER - Selected Vital Signs           ; 02/27/2002
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49**;Oct 20, 1995
"RTN","GMTSVSS",3,0)
 ;                          
"RTN","GMTSVSS",4,0)
 ; External References
"RTN","GMTSVSS",5,0)
 ;   DBIA  1446  EN1^GMRVUT0
"RTN","GMTSVSS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSS",7,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSVSS",8,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSVSS",9,0)
 ;                    
"RTN","GMTSVSS",10,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSS",11,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSS",12,0)
 ;                          
"RTN","GMTSVSS",13,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",14,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",15,0)
 K ^UTILITY($J,"GMRVD") S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",16,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",17,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",18,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",19,0)
 ;   Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",20,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSS",21,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",22,0)
 ;   If no data, display most recent inpatient measurements
"RTN","GMTSVSS",23,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVSS",25,0)
 . S MAX=1 D ENVS
"RTN","GMTSVSS",26,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",27,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",28,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",29,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",30,0)
 . D NXTROW
"RTN","GMTSVSS",31,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",32,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",33,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",34,0)
 Q
"RTN","GMTSVSS",35,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",36,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,ROW,WIDTH
"RTN","GMTSVSS",37,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",38,0)
 S MAX=$S(+($G(MAX))>0:MAX,+($G(MAX))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",39,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",40,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",41,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",42,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",43,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",44,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",45,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",46,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",47,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",48,0)
 . D NXTROW
"RTN","GMTSVSS",49,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",50,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",51,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",52,0)
 Q
"RTN","GMTSVSS",53,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",54,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",55,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVSS",56,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",57,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",58,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",59,0)
 Q
"RTN","GMTSVSS",60,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",61,0)
 N ABB,GMTSI S COL=18
"RTN","GMTSVSS",62,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",63,0)
 . S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",64,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",65,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="PN":"PAIN",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",1:ABB)
"RTN","GMTSVSS",66,0)
 . S WIDTH=$S($P(HDR(GMTSI-1),U)="T":13,$P(HDR(GMTSI-1),U)="P":7,$P(HDR(GMTSI-1),U)="R":6,$P(HDR(GMTSI-1),U)="WT":20,$P(HDR(GMTSI-1),U)="CG":20,1:12)
"RTN","GMTSVSS",67,0)
 . S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",68,0)
 . S COL=COL_U
"RTN","GMTSVSS",69,0)
 . S COL=COL_COLL
"RTN","GMTSVSS",70,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",71,0)
 S ROW=1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",72,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",73,0)
 . I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",74,0)
 . . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",75,0)
 . . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",76,0)
 . . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",77,0)
 . . S CNT=CNT+1
"RTN","GMTSVSS",78,0)
 . . K HDR(LOOP)
"RTN","GMTSVSS",79,0)
 . S ROW=ROW+1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",80,0)
 . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",81,0)
 . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",82,0)
 . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",83,0)
 . S CNT=CNT+1
"RTN","GMTSVSS",84,0)
 . K HDR(LOOP)
"RTN","GMTSVSS",85,0)
 Q
"RTN","GMTSVSS",86,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",87,0)
 N GMI
"RTN","GMTSVSS",88,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",89,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",90,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",91,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",92,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",93,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",94,0)
 Q
"RTN","GMTSVSS",95,0)
WRTHDR1 ; Writes 2nd line of header
"RTN","GMTSVSS",96,0)
 N GMI
"RTN","GMTSVSS",97,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",98,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",99,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",100,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",101,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",102,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",103,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",104,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",105,0)
 . I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",106,0)
 . I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",107,0)
 . I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",108,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",109,0)
 Q
"RTN","GMTSVSS",110,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",111,0)
 N GMLEN,GMTSBMI,GMTSI,GMTSVAL,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,GMTSQUAL,IEN,X
"RTN","GMTSVSS",112,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM4^GMTSU S GMTDT=X
"RTN","GMTSVSS",113,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",114,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",115,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",116,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",117,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",118,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",119,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",120,0)
 . . Q
"RTN","GMTSVSS",121,0)
 . Q
"RTN","GMTSVSS",122,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",123,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",124,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",125,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",126,0)
 . . S:GMTSVT="PN"&(GMTSVAL=99) GMTSVAL="No Response"
"RTN","GMTSVSS",127,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",128,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",129,0)
 . . S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",130,0)
 . . S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,5)
"RTN","GMTSVSS",131,0)
 . . S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",132,0)
 . . I GMTSMET'="" W "("_GMTSMET_")" ;   centigrade/kilos/centimeters
"RTN","GMTSVSS",133,0)
 . . I GMTSBMI'="" W "["_GMTSBMI_"]" ;   body mass index
"RTN","GMTSVSS",134,0)
 . . I GMTSLMIN'="" W "["_GMTSLMIN_"]" ;   liters/min supplemental O2
"RTN","GMTSVSS",135,0)
 . . I GMTSPERC'="" W "["_GMTSPERC_"]" ;   % supplemental O2
"RTN","GMTSVSS",136,0)
 . . I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;   qualifiers
"RTN","GMTSVSS",137,0)
 . . Q
"RTN","GMTSVSS",138,0)
 . Q
"RTN","GMTSVSS",139,0)
 Q
"RTN","GMTSVSS",140,0)
NXTROW ; Get the Next Row of Vital Signs
"RTN","GMTSVSS",141,0)
 Q:$G(ROW)'>0  K HDR S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",142,0)
 S COL=COL(ROW) K %X,%Y
"RTN","GMTSVSS",143,0)
 Q
"RTN","GMTSXA")
0^20^B19194947
"RTN","GMTSXA",1,0)
GMTSXA ; SLC/KER - List Parameters                       ; 02/27/2002
"RTN","GMTSXA",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXA",3,0)
 Q
"RTN","GMTSXA",4,0)
 ;                                
"RTN","GMTSXA",5,0)
 ; External References in GMTSXA
"RTN","GMTSXA",6,0)
 ;                                  
"RTN","GMTSXA",7,0)
 ;   DBIA  2336  EDITPAR^XPAREDIT
"RTN","GMTSXA",8,0)
 ;   DBIA  2336  EDIT^XPAREDIT
"RTN","GMTSXA",9,0)
 ;   DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXA",10,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXA",11,0)
 ;                        
"RTN","GMTSXA",12,0)
DISP ; Display User Defaults
"RTN","GMTSXA",13,0)
 G:+($G(DUZ))=.5 DS N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",14,0)
 S GMTSMGR=$$MGR^GMTSXAW3
"RTN","GMTSXA",15,0)
 D:+GMTSMGR>0&(+($G(DUZ))>.9) DM D:+GMTSMGR'>0&(+($G(DUZ))>.9) DU Q
"RTN","GMTSXA",16,0)
DU ;   Display - User Entry Point
"RTN","GMTSXA",17,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAD Q
"RTN","GMTSXA",18,0)
DM ;   Display - Manager Entry Point
"RTN","GMTSXA",19,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",20,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",21,0)
 S GMTSUSR=$$USR^GMTSXAW3("Display defaults for user:  ")
"RTN","GMTSXA",22,0)
 W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAD(GMTSUSR) Q
"RTN","GMTSXA",23,0)
DS ;   Display - Manager Entry Point
"RTN","GMTSXA",24,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSUSR=.5 W !
"RTN","GMTSXA",25,0)
 D EN3^GMTSXAD Q
"RTN","GMTSXA",26,0)
 ;            
"RTN","GMTSXA",27,0)
PREC ; Set Precedence
"RTN","GMTSXA",28,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",29,0)
 S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 PM D:+GMTSMGR'>0 PU Q
"RTN","GMTSXA",30,0)
PU ;   Precedence - User Entry Point
"RTN","GMTSXA",31,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAP Q
"RTN","GMTSXA",32,0)
PM ;   Precedence - Manager Entry Point
"RTN","GMTSXA",33,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",34,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",35,0)
 S GMTSUSR=$$USR^GMTSXAW3("Set Health Summary Precedence for user:  ")
"RTN","GMTSXA",36,0)
 W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAP(GMTSUSR) Q
"RTN","GMTSXA",37,0)
PS ;   Precedence - Site
"RTN","GMTSXA",38,0)
 D ADED^GMTSXAR Q
"RTN","GMTSXA",39,0)
RS ;   Resequence Site Precedence
"RTN","GMTSXA",40,0)
 D EN^GMTSXAR Q
"RTN","GMTSXA",41,0)
 ;            
"RTN","GMTSXA",42,0)
METH ; Set Method of Building List
"RTN","GMTSXA",43,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",44,0)
 S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 MM D:+GMTSMGR'>0 MU Q
"RTN","GMTSXA",45,0)
MU ;   Method - User Entry Point
"RTN","GMTSXA",46,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAO Q
"RTN","GMTSXA",47,0)
MM ;   Method - Manager Entry Point
"RTN","GMTSXA",48,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",49,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",50,0)
 S GMTSUSR=$$USR^GMTSXAW3("Set Method of Building list for user:  ")
"RTN","GMTSXA",51,0)
 W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAO(GMTSUSR) Q
"RTN","GMTSXA",52,0)
MS ;   Method - Default for Site Wide
"RTN","GMTSXA",53,0)
 N GMTSUSR S GMTSUSR=.5 D EN3^GMTSXAO Q
"RTN","GMTSXA",54,0)
 ;                        
"RTN","GMTSXA",55,0)
EDIT ; Edit Type List
"RTN","GMTSXA",56,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",57,0)
 S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 EM D:+GMTSMGR'>0 EU Q
"RTN","GMTSXA",58,0)
EU ;   Edit List - User Entry Point
"RTN","GMTSXA",59,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EL(+($G(DUZ))) Q
"RTN","GMTSXA",60,0)
EM ;   Edit List - Manager Entry Point
"RTN","GMTSXA",61,0)
 N GMTSENV,GMTSMGR,GMTSLST S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",62,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",63,0)
 W ! D EDITPAR^XPAREDIT("ORWRP HEALTH SUMMARY TYPE LIST")
"RTN","GMTSXA",64,0)
 Q
"RTN","GMTSXA",65,0)
EL(X) ;   Edit List
"RTN","GMTSXA",66,0)
 N GMTSENT,GMTSVEN,GMTSPAR,GMTSUSR,GMTSACT S GMTSUSR=+($G(X))
"RTN","GMTSXA",67,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXA",68,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR)
"RTN","GMTSXA",69,0)
 D:+GMTSACT'>0 DP^GMTSXAP2(+GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXA",70,0)
 S GMTSPAR=$$PDI^GMTSXAW3("ORWRP HEALTH SUMMARY TYPE LIST")
"RTN","GMTSXA",71,0)
 Q:+GMTSPAR'>0  S GMTSENT=$$ETI^GMTSXAW3("USR") Q:+GMTSENT'>0
"RTN","GMTSXA",72,0)
 S GMTSVEN=$$UVP^GMTSXAW3(+($G(GMTSUSR)))
"RTN","GMTSXA",73,0)
 W !!,"Edit the CPRS Health Summary Types list on the reports tab"
"RTN","GMTSXA",74,0)
 D EDIT^XPAREDIT(GMTSVEN,(+GMTSPAR_"^GUI Health Summary Type List")) W !
"RTN","GMTSXA",75,0)
 Q
"RTN","GMTSXA",76,0)
 ;                                 
"RTN","GMTSXA",77,0)
 ; Miscellaneous
"RTN","GMTSXA",78,0)
ENV(X) ;   Environment check
"RTN","GMTSXA",79,0)
 D HOME^%ZIS S U="^" Q:'$L($$UNM^GMTSXAW3(+($G(DUZ)))) 0
"RTN","GMTSXA",80,0)
 Q 1
"RTN","GMTSXA",81,0)
LP ;   List Preferences
"RTN","GMTSXA",82,0)
 N GMTSN,GMTSS,GMTSI,GMTSM,GMTSP,GMTSC,GMTSNUM S GMTSN="",GMTSC=0
"RTN","GMTSXA",83,0)
 F  S GMTSN=$O(^GMT(142.98,"AB",GMTSN)) Q:GMTSN=""  D
"RTN","GMTSXA",84,0)
 . S GMTSI=0  F  S GMTSI=$O(^GMT(142.98,"AB",GMTSN,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXA",85,0)
 . . S GMTSM=$G(^GMT(142.98,+GMTSI,1)),GMTSP=$P(GMTSM,"^",2)
"RTN","GMTSXA",86,0)
 . . S GMTSM=$S(+GMTSM=1:"Append   ",1:"Overwrite")
"RTN","GMTSXA",87,0)
 . . S GMTSNUM=$$NUM^GMTSXAL(+GMTSI) S GMTSC=GMTSC+1 I GMTSC=1 D
"RTN","GMTSXA",88,0)
 . . . W !!,"Health Summary Preferences",!!,"  Name ",?24," Method"
"RTN","GMTSXA",89,0)
 . . . W ?36," Precedence",?59,"  Types"
"RTN","GMTSXA",90,0)
 . . . W !,"  --------------------",?24," ---------"
"RTN","GMTSXA",91,0)
 . . . W ?36," -------------------",?59,"  -----"
"RTN","GMTSXA",92,0)
 . . . S GMTSD=$$DEF^GMTSXAW
"RTN","GMTSXA",93,0)
 . . . I $L(GMTSD) D
"RTN","GMTSXA",94,0)
 . . . . W !,"  <default>",?24," Append",?36," ",GMTSD,?59,"  <all>"
"RTN","GMTSXA",95,0)
 . . W !,?2,$E(GMTSN,1,20),?24," ",GMTSM,?36," ",GMTSP
"RTN","GMTSXA",96,0)
 . . W ?59,"   ",$J(+GMTSNUM,2)
"RTN","GMTSXA",97,0)
 W !
"RTN","GMTSXA",98,0)
 Q
"RTN","GMTSXA",99,0)
TRIM(X,Y,I) ;   Trim Character
"RTN","GMTSXA",100,0)
 S X=$G(X),Y=$G(Y),I=+($G(I)) Q:'$L(X) X
"RTN","GMTSXA",101,0)
 S:'$L(Y) Y=" " S:I=0 I=3 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","GMTSXA",102,0)
 I +I>1 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","GMTSXA",103,0)
 I I>2 F  Q:X'[(Y_Y)  S X=$P(X,(Y_Y),1)_Y_$P(X,(Y_Y),2,229)
"RTN","GMTSXA",104,0)
 Q X
"RTN","GMTSXA",105,0)
UP(X) ;   Uppercase
"RTN","GMTSXA",106,0)
 Q $TR($G(X),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXAB")
0^21^B8402043
"RTN","GMTSXAB",1,0)
GMTSXAB ; SLC/KER - List Parameters/Build List            ; 02/27/2002
"RTN","GMTSXAB",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAB",3,0)
 Q
"RTN","GMTSXAB",4,0)
 ;                                 
"RTN","GMTSXAB",5,0)
 ; External References
"RTN","GMTSXAB",6,0)
 ;                                 
"RTN","GMTSXAB",7,0)
 ;   None
"RTN","GMTSXAB",8,0)
 ;                                    
"RTN","GMTSXAB",9,0)
 ; This routine expects:
"RTN","GMTSXAB",10,0)
 ;                                 
"RTN","GMTSXAB",11,0)
 ;   GMTSCPL    Compile Method   1 = Append  0 = Overwrite
"RTN","GMTSXAB",12,0)
 ;   GMTSPRE    Precedence       i.e., USR;SYS;NAT
"RTN","GMTSXAB",13,0)
 ;   GMTSTYP(   List             Input Array
"RTN","GMTSXAB",14,0)
 ;   GMTSL(     List             Output Array
"RTN","GMTSXAB",15,0)
 ;                            
"RTN","GMTSXAB",16,0)
BUILD ; Build list of User/System Parameters and National Types
"RTN","GMTSXAB",17,0)
 N GMTSC,GMTSOK,GMTSI,GMTSID,GMTSE,GMTSEI,GMTSV,GMTSVI,GMTSVN,GMTSAT,GMTSOVR
"RTN","GMTSXAB",18,0)
 S GMTSOVR=$S(+($G(GMTSCPL))'>0:1,1:0),GMTSOK=0
"RTN","GMTSXAB",19,0)
 S GMTSC=+($O(GMTSL(" "),-1))
"RTN","GMTSXAB",20,0)
 F GMTSEI=1:1 Q:$P($G(GMTSPRE),";",GMTSEI)=""  S GMTSE=$P($G(GMTSPRE),";",GMTSEI) D
"RTN","GMTSXAB",21,0)
 . Q:'$L(GMTSE)  I GMTSE="NAT" D NAT Q
"RTN","GMTSXAB",22,0)
 . Q:+GMTSOK>0  S GMTSID="" D ADH,ENT
"RTN","GMTSXAB",23,0)
 Q
"RTN","GMTSXAB",24,0)
NAT ;   Add National Health Summary Types to the List
"RTN","GMTSXAB",25,0)
 Q:+($G(GMTSCPL))>1  N GMTSC,GMTSI,GMTSID,GMTSVI,GMTSVN,GMTSV
"RTN","GMTSXAB",26,0)
 S GMTSI=0,GMTSID=""
"RTN","GMTSXAB",27,0)
 S GMTSC=+($O(GMTSL(" "),-1))
"RTN","GMTSXAB",28,0)
 F  S GMTSID=$O(GMTSTYP("NAT","B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",29,0)
 . S GMTSI=0 F  S GMTSI=$O(GMTSTYP("NAT","B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",30,0)
 . . S GMTSV=$G(GMTSTYP("NAT",GMTSI))
"RTN","GMTSXAB",31,0)
 . . Q:'$L(GMTSV)  Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",32,0)
 . . Q:$D(GMTSL("B",GMTSV))
"RTN","GMTSXAB",33,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSXAB",34,0)
 . . S GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)=""
"RTN","GMTSXAB",35,0)
 . . S GMTSL("C",GMTSC)="NAT"
"RTN","GMTSXAB",36,0)
 K GMTSTYP("NAT")
"RTN","GMTSXAB",37,0)
 Q
"RTN","GMTSXAB",38,0)
ADH ;   Add Adhoc Health Summary Types to the List
"RTN","GMTSXAB",39,0)
 N GMTSC S GMTSC=+($O(GMTSL(" "),-1)) F GMTSAT="ADH","RAD" S GMTSI=0 D
"RTN","GMTSXAB",40,0)
 . F  S GMTSI=$O(GMTSTYP(GMTSE,GMTSAT,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",41,0)
 . . S GMTSV=$G(GMTSTYP(GMTSE,GMTSAT,GMTSI)) Q:'$L(GMTSV)
"RTN","GMTSXAB",42,0)
 . . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",43,0)
 . . Q:$D(GMTSL("B",GMTSV))  S GMTSC=GMTSC+1,GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)="",GMTSL("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",44,0)
 Q
"RTN","GMTSXAB",45,0)
ENT ;   Add Entity Parameters (System/User) to the List
"RTN","GMTSXAB",46,0)
 N GMTSC S GMTSC=+($O(GMTSL(" "),-1)) F  S GMTSID=$O(GMTSTYP(GMTSE,"B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",47,0)
 . Q:'$L(GMTSID)  S GMTSI=0 F  S GMTSI=$O(GMTSTYP(GMTSE,"B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",48,0)
 . . S GMTSV=$G(GMTSTYP(GMTSE,GMTSI)) Q:'$L(GMTSV)  Q:+GMTSV=0
"RTN","GMTSXAB",49,0)
 . . Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))  K:$D(GMTSL("B",GMTSV)) GMTSTYP(GMTSE,GMTSI)
"RTN","GMTSXAB",50,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSTYP(GMTSE,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",51,0)
 . S GMTSV=$G(GMTSTYP(GMTSE,GMTSI)) Q:'$L(GMTSV)
"RTN","GMTSXAB",52,0)
 . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",53,0)
 . Q:$D(GMTSL("B",GMTSV))
"RTN","GMTSXAB",54,0)
 . S GMTSC=GMTSC+1,GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)="",GMTSL("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",55,0)
 . S:+($G(GMTSOVR))>0 GMTSOK=1
"RTN","GMTSXAB",56,0)
 S:+($G(GMTSOVR))>0&($D(GMTSL("B"))) GMTSOK=1
"RTN","GMTSXAB",57,0)
 K GMTSTYP(GMTSE)
"RTN","GMTSXAB",58,0)
 Q
"RTN","GMTSXAC")
0^16^B30933341
"RTN","GMTSXAC",1,0)
GMTSXAC ; SLC/KER - List Parameters/Compile Method        ; 02/27/2002
"RTN","GMTSXAC",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAC",3,0)
 Q
"RTN","GMTSXAC",4,0)
 ;                        
"RTN","GMTSXAC",5,0)
 ; External References
"RTN","GMTSXAC",6,0)
 ;                        
"RTN","GMTSXAC",7,0)
 ;   None
"RTN","GMTSXAC",8,0)
 ;                        
"RTN","GMTSXAC",9,0)
 ; This routine expects:
"RTN","GMTSXAC",10,0)
 ;                                 
"RTN","GMTSXAC",11,0)
 ;   GMTSUSR    Pointer to User
"RTN","GMTSXAC",12,0)
 ;                        
"RTN","GMTSXAC",13,0)
EN ; Main Entry
"RTN","GMTSXAC",14,0)
 N GMTSG D CPL,SH Q
"RTN","GMTSXAC",15,0)
EN1 ; Display Compile Method - Single ? Help
"RTN","GMTSXAC",16,0)
 N GMTSG S GMTSG=1 D CPLH Q
"RTN","GMTSXAC",17,0)
EN2 ; Display Compile Method - Double ?? Help
"RTN","GMTSXAC",18,0)
 N GMTSG S GMTSG=1 D CPL Q
"RTN","GMTSXAC",19,0)
EN3 ; Display Preferred Compile Method
"RTN","GMTSXAC",20,0)
 N GMTSG D CPL Q
"RTN","GMTSXAC",21,0)
 ;                                      
"RTN","GMTSXAC",22,0)
CPL ; Compile Method
"RTN","GMTSXAC",23,0)
 N GMTSPRE,GMTSCPL,GMTSCPA,GMTSCPI,GMTSM,GMTSALW,GMTSU,GMTSO D EN^GMTSXAW
"RTN","GMTSXAC",24,0)
 S (GMTSO,GMTSU)=+($G(GMTSUSR)) S:+GMTSU=0 GMTSU=+($G(DUZ)) N GMTSUSR S GMTSUSR=GMTSU
"RTN","GMTSXAC",25,0)
 S GMTSPRE=$$PRE^GMTSXAL(+($G(GMTSUSR))),GMTSM=$L(GMTSPRE,";") Q:'$L(GMTSPRE)
"RTN","GMTSXAC",26,0)
 S GMTSCPL=$$CPL^GMTSXAL(+($G(GMTSUSR)))
"RTN","GMTSXAC",27,0)
 S:(+($G(GMTSO))=.5)&('$L(GMTSCPL)) GMTSCPL=1
"RTN","GMTSXAC",28,0)
 I +($G(GMTSG))'>0 D:+GMTSCPL>0 CPLA D:+GMTSCPL'>0 CPLO D BL
"RTN","GMTSXAC",29,0)
 I +($G(GMTSG))>0 D CPLH,BL,CPLA,BL,TL("   OR ---"),BL,CPLO
"RTN","GMTSXAC",30,0)
 Q
"RTN","GMTSXAC",31,0)
CPLH ;   Compile Help - Header
"RTN","GMTSXAC",32,0)
 D TL("   Health Summary Types may be added to CPRS reports tab by either appending")
"RTN","GMTSXAC",33,0)
 D TL("   them to the list or by overwriting existing Health Summaries on the list.") Q
"RTN","GMTSXAC",34,0)
CPLA ;   Compile = Append
"RTN","GMTSXAC",35,0)
 N GMTSI,GMTSC,GMTSH,GMTSN,GMTSE,GMTSA,GMTST,GMTSP,GMTSL,GMTSM
"RTN","GMTSXAC",36,0)
 S GMTSP=$G(GMTSPRE) Q:$L(GMTSP,";")'>1  S (GMTSC,GMTSL)=0,GMTSM="A"
"RTN","GMTSXAC",37,0)
 S:+($G(GMTSO))=.5 GMTSP=$$DEF^GMTSXAW
"RTN","GMTSXAC",38,0)
 F GMTSI=1:1 S GMTST=$P($G(GMTSP),";",GMTSI) Q:'$L(GMTST)  D
"RTN","GMTSXAC",39,0)
 . S:$P($G(GMTSP),";",(GMTSI+1))="" GMTSL=1
"RTN","GMTSXAC",40,0)
 . I GMTST="NAT" S GMTSC=GMTSC+1,GMTSN="National",GMTSA=GMTST D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP Q
"RTN","GMTSXAC",41,0)
 . S GMTSE=+($O(GMTSALW("B",GMTST,0))) Q:+GMTSE=0  S GMTSE=$G(GMTSALW(+GMTSE))
"RTN","GMTSXAC",42,0)
 . S GMTSA=$P(GMTSE,"^",1) Q:'$L(GMTSA)  S GMTSN=$P(GMTSE,"^",4) Q:'$L(GMTSN)  S GMTSC=GMTSC+1 D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",43,0)
 Q
"RTN","GMTSXAC",44,0)
CPLO ;   Compile = Overwrite
"RTN","GMTSXAC",45,0)
 N GMTSI,GMTSC,GMTSH,GMTSN,GMTSE,GMTSA,GMTST,GMTSP,GMTSL,GMTSM,GMTSNAT S GMTSP=$G(GMTSPRE) Q:$L(GMTSP,";")'>1  S (GMTSNAT,GMTSL,GMTSC)=0,GMTSM="O"
"RTN","GMTSXAC",46,0)
 S:+($G(GMTSO))=.5 GMTSP=$$DEF^GMTSXAW
"RTN","GMTSXAC",47,0)
 F GMTSI=$L(GMTSP,";"):-1 S GMTST=$P($G(GMTSP),";",GMTSI) Q:'$L(GMTST)  Q:GMTSI=0  D
"RTN","GMTSXAC",48,0)
 . S:$P($G(GMTSP),";",(GMTSI-1))="" GMTSL=1 S:GMTSI-1=0 GMTSL=1 I GMTST="NAT" S GMTSNAT=1 Q
"RTN","GMTSXAC",49,0)
 . S GMTSE=+($O(GMTSALW("B",GMTST,0))) Q:+GMTSE=0  S GMTSE=$G(GMTSALW(+GMTSE))
"RTN","GMTSXAC",50,0)
 . S GMTSA=$P(GMTSE,"^",1) Q:'$L(GMTSA)  S GMTSN=$P(GMTSE,"^",4) Q:'$L(GMTSN)
"RTN","GMTSXAC",51,0)
 . S GMTSC=GMTSC+1 D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",52,0)
 I +GMTSNAT>0 S GMTSC=+($G(GMTSC))+1,GMTSN="National",(GMTSA,GMTST)="NAT" D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",53,0)
 D:$G(GMTSP)["NAT" INDP
"RTN","GMTSXAC",54,0)
 Q
"RTN","GMTSXAC",55,0)
CPLP ;   Compile Parameter
"RTN","GMTSXAC",56,0)
 Q:'$L($G(GMTST))  Q:'$L($G(GMTSN))  Q:'$L($G(GMTSA))  Q:'$L(GMTSM)
"RTN","GMTSXAC",57,0)
 N GMTSP S:GMTSM="A" GMTSH=$S(+($G(GMTSC))=1:"Add",1:"Append with") S:GMTSM="O" GMTSH=$S(+($G(GMTSC))=1:"Add",1:"Overwrite with")
"RTN","GMTSXAC",58,0)
 S GMTSL=+($G(GMTSL)) S:GMTST="NAT"&(GMTSC>1) GMTSH="Add" S:GMTST'="NAT" GMTSP="     "_GMTSH_" "_GMTSN_" Defined Summary Types" S:GMTST="NAT" GMTSP="     "_GMTSH_" National Defined Summary Types"
"RTN","GMTSXAC",59,0)
 S:+($G(GMTSC))>1 GMTSP=GMTSP_" (if found)" S:+($G(GMTSC))=1 GMTSP=GMTSP_" to the list" S:+GMTSL'>0 GMTSP=GMTSP_", then" D TL(GMTSP)
"RTN","GMTSXAC",60,0)
 Q
"RTN","GMTSXAC",61,0)
CPLT ;   Compile Title
"RTN","GMTSXAC",62,0)
 D BL,TL(" Method for building the List:    "),AL(($S(+($G(GMTSCPL))'>0:"Overwrite",1:"Append"))),BL Q
"RTN","GMTSXAC",63,0)
INDP ;   Independent Types
"RTN","GMTSXAC",64,0)
 N GMTSI,GMTSPA,GMTSPT,GMTSPI,GMTSPE,GMTSMSG,GMTSX,GMTST,GMTSL,GMTSR,GMTSS,GMTSN
"RTN","GMTSXAC",65,0)
 S GMTSN="       ",GMTSPT=$$DEF^GMTSXAW
"RTN","GMTSXAC",66,0)
 F GMTSI=1:1 S GMTSPA=$P(GMTSPT,";",GMTSI) Q:'$L(GMTSPA)  D
"RTN","GMTSXAC",67,0)
 . S GMTSPI=$$ETI^GMTSXAW3(GMTSPA),GMTSPE=$$EMC^GMTSXAW3(+($G(GMTSPI))),GMTSX=$G(GMTSX)_", "_GMTSPE
"RTN","GMTSXAC",68,0)
 S:$E(GMTSX,1,2)=", " GMTSX=$E(GMTSX,3,$L(GMTSX)) S:$L(GMTSX,", ")>1 GMTSX=$P(GMTSX,", ",1,($L(GMTSX,", ")-1))_" and "_$P(GMTSX,", ",$L(GMTSX,", "))
"RTN","GMTSXAC",69,0)
 S GMTST="National Health Summary Types are added to the list",GMTSL=$L(GMTST),GMTST="Note:  "_GMTST,GMTST=GMTSN_GMTST D BL,TL(GMTST)
"RTN","GMTSXAC",70,0)
 S GMTSN=GMTSN_"       ",GMTST="independently of "_$S($L(GMTSX):GMTSX,1:"other")_" defined types, and placed on the list in the order specified by the precedence."
"RTN","GMTSXAC",71,0)
 D INDPT
"RTN","GMTSXAC",72,0)
 Q
"RTN","GMTSXAC",73,0)
INDPT ;   Independent Types (text)
"RTN","GMTSXAC",74,0)
 I $L(GMTST)'>GMTSL S GMTST=GMTSN_GMTST D TL(GMTST) Q
"RTN","GMTSXAC",75,0)
 F  Q:'$L(GMTST)  D INDPL
"RTN","GMTSXAC",76,0)
 Q
"RTN","GMTSXAC",77,0)
INDPL ;   Independent Types (long text)
"RTN","GMTSXAC",78,0)
 I $L(GMTST)'>GMTSL D TL((GMTSN_GMTST)) S GMTST="" Q
"RTN","GMTSXAC",79,0)
 N GMTSREM,GMTSSTO,GMTSI F GMTSI=1:1 Q:$L($P(GMTST," ",1,GMTSI))>GMTSL  Q:'$L($P(GMTST," ",GMTSI))
"RTN","GMTSXAC",80,0)
 S GMTSSTO=$$TRIM^GMTSXA($P(GMTST," ",1,(GMTSI-1))," "),GMTSREM=$$TRIM^GMTSXA($P(GMTST," ",GMTSI,299)," ")
"RTN","GMTSXAC",81,0)
 D:$L(GMTSSTO) TL((GMTSN_GMTSSTO)) S GMTST=GMTSREM
"RTN","GMTSXAC",82,0)
 Q
"RTN","GMTSXAC",83,0)
 ;                               
"RTN","GMTSXAC",84,0)
 ; Miscellaneous
"RTN","GMTSXAC",85,0)
SH ;   Show ^TMP Global
"RTN","GMTSXAC",86,0)
 N GMTSN,GMTSC,GMTSW S GMTSN="^TMP(""GMTSXAD"","_$J_",0)",GMTSC="^TMP(""GMTSXAD"","_$J_",",GMTSW="^TMP(""GMTSXAD"","_$J_",0)"
"RTN","GMTSXAC",87,0)
 F  S GMTSN=$Q(@GMTSN) Q:GMTSN=""!(GMTSN'[GMTSC)  W:GMTSN'[GMTSW !,@GMTSN
"RTN","GMTSXAC",88,0)
 K ^TMP("GMTSXAD",$J)
"RTN","GMTSXAC",89,0)
 Q
"RTN","GMTSXAC",90,0)
BL ;   Blank Line
"RTN","GMTSXAC",91,0)
 D TL("") Q
"RTN","GMTSXAC",92,0)
TL(X) ;   Text Line
"RTN","GMTSXAC",93,0)
 I +($G(GMTSG))>0 W !,$G(X) Q
"RTN","GMTSXAC",94,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),GMTSC=GMTSC+1,^TMP("GMTSXAD",$J,GMTSC,0)=X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAC",95,0)
AL(X) ;   Append Line
"RTN","GMTSXAC",96,0)
 I +($G(GMTSG))>0 W $G(X) Q
"RTN","GMTSXAC",97,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),^TMP("GMTSXAD",$J,GMTSC,0)=$G(^TMP("GMTSXAD",$J,GMTSC,0))_X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAD")
0^22^B31100757
"RTN","GMTSXAD",1,0)
GMTSXAD ; SLC/KER - List Parameters/Display               ; 02/27/2002
"RTN","GMTSXAD",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAD",3,0)
 Q
"RTN","GMTSXAD",4,0)
 ;                                  
"RTN","GMTSXAD",5,0)
 ; External References in GMTSXAD
"RTN","GMTSXAD",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSXAD",7,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSXAD",8,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSXAD",9,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXAD",10,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSXAD",11,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSXAD",12,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSXAD",13,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSXAD",14,0)
 ;                           
"RTN","GMTSXAD",15,0)
EN ; Main Entry Point
"RTN","GMTSXAD",16,0)
 D EN2(+($G(DUZ))) Q
"RTN","GMTSXAD",17,0)
EN2(X) ; Entry for User
"RTN","GMTSXAD",18,0)
 K ^TMP("GMTSXAD",$J) N GMTSENV,ZTRTN,GMTSNM S ZTRTN="RPT^GMTSXAD",GMTSENV=$$ENV Q:+GMTSENV=0
"RTN","GMTSXAD",19,0)
 N GMTSUSR S GMTSUSR=+($G(X)) S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAD",20,0)
 W !!,"Display user default Health Summary Type list for ",GMTSNM
"RTN","GMTSXAD",21,0)
 D PRE,CPL,LIST,DISP
"RTN","GMTSXAD",22,0)
 Q
"RTN","GMTSXAD",23,0)
EN3 ; Entry for Site Parameters
"RTN","GMTSXAD",24,0)
 K ^TMP("GMTSXAD",$J) N GMTSENV,ZTRTN,GMTSNM S ZTRTN="RPT^GMTSXAD",GMTSENV=$$ENV Q:+GMTSENV=0
"RTN","GMTSXAD",25,0)
 N GMTSUSR S GMTSUSR=.5 S GMTSNM=$P($$SITE^VASITE,"^",2) Q:'$L(GMTSNM)
"RTN","GMTSXAD",26,0)
 W !!,"Display default Health Summary Type list for ",GMTSNM
"RTN","GMTSXAD",27,0)
 D PRE,CPL,DISP
"RTN","GMTSXAD",28,0)
 Q
"RTN","GMTSXAD",29,0)
 ;                          
"RTN","GMTSXAD",30,0)
 ; Report
"RTN","GMTSXAD",31,0)
PRE ;   Precedence
"RTN","GMTSXAD",32,0)
 N GMTSPRE,GMTSM S GMTSPRE=$$PRE^GMTSXAL(GMTSUSR)
"RTN","GMTSXAD",33,0)
 S:+($G(GMTSUSR))=.5 GMTSPRE=$$DEF^GMTSXAW
"RTN","GMTSXAD",34,0)
 S:(+($G(GMTSUSR))=.5)&('$L(GMTSPRE)) GMTSPRE=$$PRE^GMTSXAL(.5)
"RTN","GMTSXAD",35,0)
 S GMTSM=$L(GMTSPRE,";")
"RTN","GMTSXAD",36,0)
 Q:'$L(GMTSPRE)  N GMTSI,GMTSE,GMTST,GMTSA,GMTSN,GMTSP,GMTSH,GMTSC,GMTSALW D EN^GMTSXAW
"RTN","GMTSXAD",37,0)
 S (GMTSC,GMTSI)=0 F GMTSI=1:1 Q:$P(GMTSPRE,";",GMTSI)=""  D
"RTN","GMTSXAD",38,0)
 . S GMTSA=$P(GMTSPRE,";",GMTSI) Q:'$L(GMTSA)  S GMTSE=$O(GMTSALW("B",GMTSA,0))
"RTN","GMTSXAD",39,0)
 . S GMTST=$P($G(GMTSALW("B",GMTSA,+GMTSE)),"^",4) Q:GMTSA'="NAT"&('$L(GMTST))
"RTN","GMTSXAD",40,0)
 . S GMTST=$S(GMTSA="USR":(GMTST_" preferences"),GMTSA="NAT":"National Health Summary Types",1:(GMTST_" defined"))
"RTN","GMTSXAD",41,0)
 . S GMTSC=GMTSC+1 D:GMTSC=1 PRE2 D TL(("     "_GMTSC_"  "_GMTST))
"RTN","GMTSXAD",42,0)
 Q
"RTN","GMTSXAD",43,0)
PRE2 ;     Precedence Title
"RTN","GMTSXAD",44,0)
 D TL(" Precedence of Parameters:        "),AL($G(GMTSPRE)),BL Q
"RTN","GMTSXAD",45,0)
CPL ;   Compile Method
"RTN","GMTSXAD",46,0)
 D EN3^GMTSXAC Q
"RTN","GMTSXAD",47,0)
LIST ;   Health Summary Types List 
"RTN","GMTSXAD",48,0)
 N GMTS,GMTSALW D GETILIST^GMTSXAL(.GMTS,GMTSUSR),EN^GMTSXAW
"RTN","GMTSXAD",49,0)
 N GMTS1,GMTS2,GMTST,GMTSA,GMTSI,GMTSN,GMTSEN,GMTSC,GMTSS S GMTSC=0 F  Q:$L($G(GMTSS))>29  S GMTSS=$G(GMTSS)_" "
"RTN","GMTSXAD",50,0)
 S GMTS1=0 F  S GMTS1=$O(GMTS("AB",GMTS1)) Q:+GMTS1=0  D
"RTN","GMTSXAD",51,0)
 . S GMTS2=0 F  S GMTS2=$O(GMTS("AB",GMTS1,GMTS2)) Q:+GMTS2=0  D
"RTN","GMTSXAD",52,0)
 . . S GMTSA=$P($G(GMTS("AB",GMTS1,GMTS2)),"^",1) Q:'$L(GMTSA)
"RTN","GMTSXAD",53,0)
 . . S GMTSI=+($P($G(GMTS("AB",GMTS1,GMTS2)),"^",2)) Q:+GMTSI'>0
"RTN","GMTSXAD",54,0)
 . . S GMTSN=$$UP^GMTSXA($P($G(GMTS("AB",GMTS1,GMTS2)),"^",3)) Q:'$L(GMTSN)
"RTN","GMTSXAD",55,0)
 . . S GMTSEN=+($O(GMTSALW("B",GMTSA,0))) Q:+GMTSEN'>0&(GMTSA'="NAT")
"RTN","GMTSXAD",56,0)
 . . S GMTSEN=$P($G(GMTSALW("B",GMTSA,GMTSEN)),"^",4) Q:'$L(GMTSEN)&(GMTSA'="NAT")
"RTN","GMTSXAD",57,0)
 . . S GMTSEN=GMTSEN_" defined types" S:GMTSA="NAT" GMTSEN="National types" S GMTSC=GMTSC+1 S GMTSEN="     "_GMTSEN F  Q:$L(GMTSEN)>29  S GMTSEN=GMTSEN_" "
"RTN","GMTSXAD",58,0)
 . . D:GMTSC=1 LIST2
"RTN","GMTSXAD",59,0)
 . . D TL($S(+GMTS2=1:GMTSEN,1:GMTSS))
"RTN","GMTSXAD",60,0)
 . . D AL(($J(GMTSC,2)_"  "_GMTSN))
"RTN","GMTSXAD",61,0)
 Q
"RTN","GMTSXAD",62,0)
LIST2 ;     List Title
"RTN","GMTSXAD",63,0)
 D TL(" The CPRS Reports Tab will list the following Health Summary Types:"),BL Q
"RTN","GMTSXAD",64,0)
 ;                             
"RTN","GMTSXAD",65,0)
DISP ; Display Report
"RTN","GMTSXAD",66,0)
 I '$L($G(ZTRTN)) K ^TMP("GMTSXAD",$J) Q
"RTN","GMTSXAD",67,0)
 N POP D DEV,HOME^%ZIS Q
"RTN","GMTSXAD",68,0)
DEV ;   Device for Display
"RTN","GMTSXAD",69,0)
 W ! N %ZIS,IOP S %ZIS="PQ" D ^%ZIS Q:POP  I $D(IO("Q")) D QUE Q
"RTN","GMTSXAD",70,0)
NOQUE ;   Do not Queue Report
"RTN","GMTSXAD",71,0)
 W:IOST["C-" @IOF D @ZTRTN,^%ZISC Q
"RTN","GMTSXAD",72,0)
QUE ;   Queue Report
"RTN","GMTSXAD",73,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK I '$D(ZTRTN) K ^TMP("GMTSXAD",$J) Q
"RTN","GMTSXAD",74,0)
 K IO("Q"),ZTSAVE S ZTSAVE("^TMP(""GMTSXAD"",$J,")=""
"RTN","GMTSXAD",75,0)
 S ZTDESC="Health Summary Types List User Defaults",ZTIO=$G(ION),ZTDTH=$H
"RTN","GMTSXAD",76,0)
 D ^%ZTLOAD I $D(ZTSK) W !!,"Request queued",! H 3 W @IOF
"RTN","GMTSXAD",77,0)
 I '$D(ZTSK) W !!,"Request not queued",! H 3 W @IOF
"RTN","GMTSXAD",78,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC Q
"RTN","GMTSXAD",79,0)
 ;                     
"RTN","GMTSXAD",80,0)
RPT ; Report
"RTN","GMTSXAD",81,0)
 W ! Q:'$D(^TMP("GMTSXAD",$J))
"RTN","GMTSXAD",82,0)
 N GMTSHDR,GMTSLC,GMTSI,GMTST,GMTSEXIT S (GMTSI,GMTSLC)=0 D HDRP
"RTN","GMTSXAD",83,0)
 F  S GMTSI=$O(^TMP("GMTSXAD",$J,GMTSI)) Q:+($G(GMTSEXIT))>0  Q:+GMTSI=0  D  Q:+($G(GMTSEXIT))>0
"RTN","GMTSXAD",84,0)
 . S GMTST=$G(^TMP("GMTSXAD",$J,GMTSI,0)),GMTSLC=GMTSLC+1 W !,GMTST
"RTN","GMTSXAD",85,0)
 . D:$G(IOST)["C-"&(GMTSLC>(+($G(IOSL))-4)) CONT
"RTN","GMTSXAD",86,0)
 . K:+($G(GMTSEXIT))>0 ^TMP("GMTSXAD",$J)
"RTN","GMTSXAD",87,0)
 W:$G(IOST)["P-"&($L($G(IOF))) @IOF
"RTN","GMTSXAD",88,0)
 K ^TMP("GMTSXAD",$J)
"RTN","GMTSXAD",89,0)
 Q
"RTN","GMTSXAD",90,0)
CONT ;   Page Break/Continue Report
"RTN","GMTSXAD",91,0)
 I $G(IOST)["P-" W:$L($G(IOF)) @IOF S GMTSLC=0 D HDRP Q
"RTN","GMTSXAD",92,0)
 N GMTSCONT S GMTSCONT="" I $G(IOST)["C-" S GMTSCONT=$$PG W:$L($G(IOF)) @IOF W:'$L($G(IOF)) !! S GMTSLC=0 D HDRP
"RTN","GMTSXAD",93,0)
 S:GMTSCONT["^" GMTSEXIT=1
"RTN","GMTSXAD",94,0)
 Q
"RTN","GMTSXAD",95,0)
PG(X) ;   Page Break
"RTN","GMTSXAD",96,0)
 N DIR,DTOUT,DIRUT,DIROUT,DUOUT S DIR(0)="EA",DIR("A")="    Press <Return> to continue  ",(DIR("?"),DIR("??"))="^W !,""        Enter either <Return> or '^'"""
"RTN","GMTSXAD",97,0)
 W ! D ^DIR S X=$S((+($G(DTOUT))+($G(DUOUT))+($G(DIRUT)))>0:"^",1:"") Q X
"RTN","GMTSXAD",98,0)
HDRP ;   Page/Report Header
"RTN","GMTSXAD",99,0)
 N GMTSS,GMTS1,GMTS2,GMTS3,GMTSL
"RTN","GMTSXAD",100,0)
 S GMTSS=$P($$SITE^VASITE,"^",2)
"RTN","GMTSXAD",101,0)
 S GMTS1=" Health Summary Types list for CPRS Reports Tab"
"RTN","GMTSXAD",102,0)
 S:(+($G(GMTSUSR))=.5)&($L(GMTSS)) GMTS1=" "_GMTSS_" Defaults for CPRS Reports Tab"
"RTN","GMTSXAD",103,0)
 S:+($G(GMTSHDR))>0 GMTS1=GMTS1_"    <continued> "
"RTN","GMTSXAD",104,0)
 S GMTS2=$$UP^GMTSXA($P($$FMTE^XLFDT($$NOW^XLFDT,"ZM"),"@",1)) F  Q:$L(GMTS1)'<(78-$L(GMTS2))  S GMTS1=GMTS1_" "
"RTN","GMTSXAD",105,0)
 S GMTS1=GMTS1_GMTS2 S GMTSL=" -" F  Q:$L(GMTSL)'<$L(GMTS1)  S GMTSL=GMTSL_"-"
"RTN","GMTSXAD",106,0)
 W !,GMTS1,!,GMTSL,! S GMTSLC=+($G(GMTSLC))+3
"RTN","GMTSXAD",107,0)
 Q
"RTN","GMTSXAD",108,0)
 ;                                 
"RTN","GMTSXAD",109,0)
 ; Miscellaneous
"RTN","GMTSXAD",110,0)
ENV(X) ;   Environment check
"RTN","GMTSXAD",111,0)
 D HOME^%ZIS Q:'$L($$UNM^GMTSXAW3(+($G(DUZ)))) 0
"RTN","GMTSXAD",112,0)
 Q 1
"RTN","GMTSXAD",113,0)
 ;   Add Report Lines
"RTN","GMTSXAD",114,0)
BL ;     Blank Line
"RTN","GMTSXAD",115,0)
 D TL("") Q
"RTN","GMTSXAD",116,0)
TL(X) ;     Text Line
"RTN","GMTSXAD",117,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),GMTSC=GMTSC+1,^TMP("GMTSXAD",$J,GMTSC,0)=X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAD",118,0)
AL(X) ;     Append Line
"RTN","GMTSXAD",119,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),^TMP("GMTSXAD",$J,GMTSC,0)=$G(^TMP("GMTSXAD",$J,GMTSC,0))_X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAL")
0^17^B49411879
"RTN","GMTSXAL",1,0)
GMTSXAL ; SLC/KER - List Parameters/Get List              ; 02/27/2002
"RTN","GMTSXAL",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAL",3,0)
 Q
"RTN","GMTSXAL",4,0)
 ;                          
"RTN","GMTSXAL",5,0)
 ; External References in GMTSXAL
"RTN","GMTSXAL",6,0)
 ;   DBIA  2992  ^XTV(8989.5,
"RTN","GMTSXAL",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAL",8,0)
 ;   DBIA  2263  GETLST^XPAR
"RTN","GMTSXAL",9,0)
 ;                
"RTN","GMTSXAL",10,0)
GETLIST(GMTSL,GMTSUSR) ; Get Health Summary Type Parameter List
"RTN","GMTSXAL",11,0)
 N GMTSCP,GMTSCPL,GMTSPRE,GMTSDEF
"RTN","GMTSXAL",12,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:+GMTSUSR'>0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",13,0)
 S GMTSCPL=$$CPL(GMTSUSR),GMTSPRE=$$PRE(GMTSUSR)
"RTN","GMTSXAL",14,0)
 D GETLST(.GMTSL,GMTSUSR,GMTSCPL,GMTSPRE)
"RTN","GMTSXAL",15,0)
 I $D(GMTSIDX) D
"RTN","GMTSXAL",16,0)
 . S GMTSL("AC","PRE")=GMTSPRE,GMTSL("AC","CPL")=GMTSCPL_"^"_$S(+($G(GMTSCPL))'>0:"Overwrite",1:"Append")
"RTN","GMTSXAL",17,0)
 . N GMTSI,GMTST,GMTSTO,GMTSTC,GMTSTCT,GMTSV,GMTSC S GMTSTO="",(GMTSC,GMTSTC,GMTSTCT,GMTSI)=0 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",18,0)
 . . S GMTSV=$G(GMTSL(GMTSI)),GMTST=$G(GMTSL("C",GMTSI)) Q:'$L(GMTST)
"RTN","GMTSXAL",19,0)
 . . S GMTSC=GMTSC+1,GMTSL("A",GMTST,0)=GMTSC,GMTSL("A",GMTST,GMTSC)=GMTSV S:GMTST'=GMTSTO GMTSTC=GMTSTC+1,GMTSTCT=0 S GMTSTCT=GMTSTCT+1
"RTN","GMTSXAL",20,0)
 . . S GMTSL("AB",0)=GMTSTC,GMTSL("AB",+GMTSTC,0)=GMTSTCT,GMTSL("AB",+GMTSTC,GMTSTCT)=GMTST_"^"_GMTSV,GMTSTO=GMTST
"RTN","GMTSXAL",21,0)
 . K GMTSL("B"),GMTSL("C") S GMTST="" F  S GMTST=$O(GMTSL("A",GMTST)) Q:GMTST=""  D
"RTN","GMTSXAL",22,0)
 . . S GMTSI=0 F  S GMTSI=$O(GMTSL("A",GMTST,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",23,0)
 . . . S GMTSC=+($G(GMTSL("A",GMTST,GMTSI)))
"RTN","GMTSXAL",24,0)
 . . . S GMTSV=$P($G(GMTSL("A",GMTST,GMTSI)),"^",2)
"RTN","GMTSXAL",25,0)
 . . . S:+GMTSC>0 GMTSL("B",+GMTSC,GMTSI)=""
"RTN","GMTSXAL",26,0)
 . . . S:$L(GMTSV)>0 GMTSL("BA",GMTSV,GMTSI)=""
"RTN","GMTSXAL",27,0)
 Q
"RTN","GMTSXAL",28,0)
 ;                            
"RTN","GMTSXAL",29,0)
GETILIST(GMTSL,GMTSUSR) ; Get Indexed Health Summary Types Parameter List
"RTN","GMTSXAL",30,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",31,0)
 N GMTSIDX S GMTSIDX=1 D GETLIST(.GMTSL,GMTSUSR)
"RTN","GMTSXAL",32,0)
 Q
"RTN","GMTSXAL",33,0)
 ;                            
"RTN","GMTSXAL",34,0)
GETLST(GMTSL,GMTSUSR,GMTSCPL,GMTSPRE) ; Get List
"RTN","GMTSXAL",35,0)
 ;                            
"RTN","GMTSXAL",36,0)
 ; Health Summary Version of call in GETHS^ORWRP:
"RTN","GMTSXAL",37,0)
 ;                         
"RTN","GMTSXAL",38,0)
 ;   D GETLST^XPAR(.ORHSPARM,"ALL",
"RTN","GMTSXAL",39,0)
 ;                   "ORWRP HEALTH SUMMARY TYPE LIST","N")
"RTN","GMTSXAL",40,0)
 ;                            
"RTN","GMTSXAL",41,0)
 ; Merges Health Summary Parameters for display in the
"RTN","GMTSXAL",42,0)
 ; Health Summary Types on the Reports Tab.  National
"RTN","GMTSXAL",43,0)
 ; Health Summary Types (remote data views) are grouped 
"RTN","GMTSXAL",44,0)
 ; together and added to the list separately.  For a 
"RTN","GMTSXAL",45,0)
 ; National Health Summary Type to be included on the list,
"RTN","GMTSXAL",46,0)
 ; it must first be defined in the parameters file.
"RTN","GMTSXAL",47,0)
 ; The merge of parameters is accomplished by either 
"RTN","GMTSXAL",48,0)
 ; appending or over-writing the parameters to the list.
"RTN","GMTSXAL",49,0)
 ;                            
"RTN","GMTSXAL",50,0)
 ; Input Variables
"RTN","GMTSXAL",51,0)
 ;                    
"RTN","GMTSXAL",52,0)
 ;   GMTSL    Local Array of Health Summary Parameters 
"RTN","GMTSXAL",53,0)
 ;                            
"RTN","GMTSXAL",54,0)
 ;   GMTSCPL  Compile Method
"RTN","GMTSXAL",55,0)
 ;                            
"RTN","GMTSXAL",56,0)
 ;     GMTSCPL=1   <DEFAULT>  Append Parameters to List
"RTN","GMTSXAL",57,0)
 ;     GMTSCPL=0   Overwrite Parameters (by entity)
"RTN","GMTSXAL",58,0)
 ;                            
"RTN","GMTSXAL",59,0)
 ;   GMTSPRE  Precedence of Entities
"RTN","GMTSXAL",60,0)
 ;                            
"RTN","GMTSXAL",61,0)
 ;     Having defined how the list is to be created using
"RTN","GMTSXAL",62,0)
 ;     GMTSCPL (Append or Overwrite), this variable 
"RTN","GMTSXAL",63,0)
 ;     defines the order that each entity will be 
"RTN","GMTSXAL",64,0)
 ;     referenced (first, second, etc.)
"RTN","GMTSXAL",65,0)
 ;                            
"RTN","GMTSXAL",66,0)
 ;       FORMAT   Series of 3 Characters, Uppercase taken
"RTN","GMTSXAL",67,0)
 ;                from the PARAMETER ENTITY file delimited
"RTN","GMTSXAL",68,0)
 ;                by semi-colons
"RTN","GMTSXAL",69,0)
 ;                            
"RTN","GMTSXAL",70,0)
 ;                Default value:  $$DEF^GMTSXAW
"RTN","GMTSXAL",71,0)
 ;                            
"RTN","GMTSXAL",72,0)
LST ; Create List
"RTN","GMTSXAL",73,0)
 ;
"RTN","GMTSXAL",74,0)
 N DIC,DTOUT,DUOUT,GMTSE,GMTSENT,GMTSER,GMTSI,GMTSLI,GMTSLL,GMTSLN
"RTN","GMTSXAL",75,0)
 N GMTSPAR,GMTSYS,GMTSAD,GMTSAR,GMTST,GMTSTYP,GMTSV,GMTSVAL,GMTSII
"RTN","GMTSXAL",76,0)
 N GMTSUP,GMTSEI,GMTSIV,GMTSEV,GMTSN,GMTSCHK,X,Y
"RTN","GMTSXAL",77,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",78,0)
 S GMTSCPL=$G(GMTSCPL),GMTSPRE=$G(GMTSPRE)
"RTN","GMTSXAL",79,0)
 S:'$L(GMTSCPL) GMTSCPL=0 S:'$L(GMTSPRE) GMTSPRE=$$DEF^GMTSXAW
"RTN","GMTSXAL",80,0)
 S (GMTSPAR,X)="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAL",81,0)
 S GMTSAD="GMTS HS ADHOC OPTION",GMTSAR="GMTS HS REMOTE ADHOC OPTION"
"RTN","GMTSXAL",82,0)
 S GMTSYS=$$SYSV^GMTSXAW3,GMTSUP=$$UVP^GMTSXAW3(+GMTSUSR),GMTSPAR=+($$PDI^GMTSXAW3(GMTSPAR)) Q:GMTSPAR'>0  S GMTSENT="",U="^"
"RTN","GMTSXAL",83,0)
 D CHK^GMTSXAW(.GMTSCHK,GMTSUSR,"GMTS")
"RTN","GMTSXAL",84,0)
 F  S GMTSENT=$O(^XTV(8989.5,"AC",GMTSPAR,GMTSENT)) Q:GMTSENT=""  D BYE
"RTN","GMTSXAL",85,0)
 K GMTSL D BUILD^GMTSXAB
"RTN","GMTSXAL",86,0)
 K:'$D(GMTSIDX) GMTSL("B"),GMTSL("C") S (GMTSI,GMTSN)=0
"RTN","GMTSXAL",87,0)
 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",88,0)
 S:+GMTSN>0 GMTSL=GMTSN
"RTN","GMTSXAL",89,0)
 Q
"RTN","GMTSXAL",90,0)
BYE ;   By Entity
"RTN","GMTSXAL",91,0)
 Q:'$L(GMTSENT)  Q:GMTSENT'[";"  Q:+GMTSENT=0  Q:'$L($P(GMTSENT,";",2))  Q:'$D(GMTSCHK("CHK",GMTSENT))
"RTN","GMTSXAL",92,0)
 S GMTSVAL=$P($G(@(U_$P(GMTSENT,";",2)_+($P(GMTSENT,";",1))_",0)")),U,1)
"RTN","GMTSXAL",93,0)
 Q:'$L(GMTSVAL)  K GMTSL,GMTSER Q:'$L($G(GMTSPAR))  Q:'$L($G(GMTSENT))
"RTN","GMTSXAL",94,0)
 D GETLST^XPAR(.GMTSL,GMTSENT,GMTSPAR,"B",.GMTSER) Q:+($G(GMTSER))>0
"RTN","GMTSXAL",95,0)
 S GMTSLI=0 F  S GMTSLI=$O(GMTSL(GMTSLI)) Q:+GMTSLI=0  D BYP
"RTN","GMTSXAL",96,0)
 Q
"RTN","GMTSXAL",97,0)
BYP ;   By Parameter
"RTN","GMTSXAL",98,0)
 S GMTST=$$ABR^GMTSXAW3(GMTSENT) N GMTSII,GMTSEI,GMTSIV,GMTSEV,GMTSIEN,GMTSVAL,GMTSND,GMTSNM,GMTSHT
"RTN","GMTSXAL",99,0)
 S GMTSII=$P($G(GMTSL(GMTSLI,"N")),"^",1) Q:'$L(GMTSII)
"RTN","GMTSXAL",100,0)
 S GMTSEI=$P($G(GMTSL(GMTSLI,"N")),"^",2) Q:'$L(GMTSEI)
"RTN","GMTSXAL",101,0)
 S GMTSIV=$P($G(GMTSL(GMTSLI,"V")),"^",1) Q:'$L(GMTSIV)
"RTN","GMTSXAL",102,0)
 S GMTSEV=$P($G(GMTSL(GMTSLI,"V")),"^",2) Q:'$L(GMTSEV)
"RTN","GMTSXAL",103,0)
 S GMTST=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"NAT",1:$G(GMTST))
"RTN","GMTSXAL",104,0)
 S GMTSND=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"GMTSLN",1:"GMTSLL")
"RTN","GMTSXAL",105,0)
 D SAV
"RTN","GMTSXAL",106,0)
 Q
"RTN","GMTSXAL",107,0)
SAV ;   Save Parameters
"RTN","GMTSXAL",108,0)
 N GMTSI Q:'$L($G(GMTSL(GMTSLI,"V")))  S GMTSVAL=GMTSL(GMTSLI,"V"),GMTSHT=+GMTSVAL,GMTSNM=$P(GMTSVAL,"^",2)
"RTN","GMTSXAL",109,0)
 S GMTSI=(+($O(@(GMTSND_"("" "")"),-1)+1))
"RTN","GMTSXAL",110,0)
 I GMTSNM=GMTSAD!(GMTSNM=GMTSAR) D SAVD Q
"RTN","GMTSXAL",111,0)
 S @(GMTSND_"("_GMTSI_",""N"")")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",112,0)
 S @(GMTSND_"("_GMTSI_",""V"")")=$G(GMTSVAL)
"RTN","GMTSXAL",113,0)
 S @(GMTSND_"("_GMTSI_",""E"")")=$G(GMTSENT)
"RTN","GMTSXAL",114,0)
 S GMTSTYP(GMTST,GMTSI)=$G(GMTSVAL)
"RTN","GMTSXAL",115,0)
 S:$L(GMTSNM) GMTSTYP(GMTST,"B",GMTSNM,GMTSI)=""
"RTN","GMTSXAL",116,0)
 S:GMTSHT>0 GMTSTYP(GMTST,"C",GMTSHT,GMTSI)=""
"RTN","GMTSXAL",117,0)
 Q
"RTN","GMTSXAL",118,0)
SAVD ;   Save Adhoc and Remote Adhoc Parameters
"RTN","GMTSXAL",119,0)
 N GMTSAT,GMTSC,GMTSI S GMTSND=$G(GMTSND) Q:'$L(GMTSND)  Q:GMTSND="GMTSLN"
"RTN","GMTSXAL",120,0)
 I GMTSNM=GMTSAD S GMTSI=(+($O(@(GMTSND_"(""ADH"","" "")"),-1)+1)),GMTSAT="ADH"
"RTN","GMTSXAL",121,0)
 I GMTSNM=GMTSAR S GMTSI=(+($O(@(GMTSND_"(""RAD"","" "")"),-1)+1)),GMTSAT="RAD"
"RTN","GMTSXAL",122,0)
 Q:'$L($G(GMTST))  Q:'$L($G(GMTSAT))  Q:'$L($G(GMTSNM))  Q:'$L($G(GMTSVAL))  Q:'$L($G(GMTSHT))  Q:$D(GMTSTYP(GMTST,GMTSAT,"B",GMTSNM))
"RTN","GMTSXAL",123,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""N"")")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",124,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""V"")")=$G(GMTSL(GMTSLI,"V"))
"RTN","GMTSXAL",125,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""E"")")=$G(GMTSENT)
"RTN","GMTSXAL",126,0)
 S @(GMTSND_"("""_GMTSAT_""",""B"","""_GMTSVAL_""","_GMTSI_")")=""
"RTN","GMTSXAL",127,0)
 S @(GMTSND_"("""_GMTSAT_""",""C"","""_GMTSEI_"^"_GMTSVAL_""","_GMTSI_")")=""
"RTN","GMTSXAL",128,0)
 S GMTSC=+($O(@(GMTSND_"("""_GMTST_""","""_GMTSAT_""","" "")"),-1))+1
"RTN","GMTSXAL",129,0)
 S GMTSTYP(GMTST,GMTSAT,GMTSC)=$G(GMTSVAL)
"RTN","GMTSXAL",130,0)
 S:$L(GMTSNM) GMTSTYP(GMTST,GMTSAT,"B",GMTSNM,GMTSC)=""
"RTN","GMTSXAL",131,0)
 S:GMTSHT>0 GMTSTYP(GMTST,GMTSAT,"C",GMTSHT,GMTSC)=""
"RTN","GMTSXAL",132,0)
 Q
"RTN","GMTSXAL",133,0)
 ;                            
"RTN","GMTSXAL",134,0)
 ; Miscellaneous
"RTN","GMTSXAL",135,0)
NUM(X) ;   Number of Types for User X
"RTN","GMTSXAL",136,0)
 N GMTSUSR,GMTSL,GMTSI,GMTSN S GMTSUSR=+($G(X)),(GMTSI,GMTSN)=0 Q:GMTSUSR=0 0 Q:'$L($$UNM^GMTSXAW3(GMTSUSR)) 0
"RTN","GMTSXAL",137,0)
 D GETLIST(.GMTSL,GMTSUSR) Q:+($G(GMTSL))>0 +($G(GMTSL))
"RTN","GMTSXAL",138,0)
 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",139,0)
 S X=GMTSN Q X
"RTN","GMTSXAL",140,0)
DEF(X) ; Defaults    <compile> ^ <precedence> 
"RTN","GMTSXAL",141,0)
 N DIERR,GMTSUSR,GMTSSIC,GMTSSIP,GMTSSCPL,GMTSPRE
"RTN","GMTSXAL",142,0)
 S GMTSSIC=1,GMTSSIP=$$DEF^GMTSXAW
"RTN","GMTSXAL",143,0)
 S GMTSUSR=+($G(X)),X=""
"RTN","GMTSXAL",144,0)
 Q:+GMTSUSR=0 (GMTSSIC_"^"_GMTSSIP)
"RTN","GMTSXAL",145,0)
 Q:'$L($$UNM^GMTSXAW3(+GMTSUSR)) (GMTSSIC_"^"_GMTSSIP)
"RTN","GMTSXAL",146,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I")
"RTN","GMTSXAL",147,0)
 S:GMTSCPL="" GMTSCPL=GMTSSIC
"RTN","GMTSXAL",148,0)
 S GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11)
"RTN","GMTSXAL",149,0)
 S:GMTSPRE="" GMTSPRE=GMTSSIP
"RTN","GMTSXAL",150,0)
 S X=GMTSCPL_"^"_GMTSPRE
"RTN","GMTSXAL",151,0)
 Q X
"RTN","GMTSXAL",152,0)
CPL(X) ;   Compile Method
"RTN","GMTSXAL",153,0)
 N DIERR,GMTSITE,GMTSUSR,GMTSCPL S GMTSUSR=+($G(X))
"RTN","GMTSXAL",154,0)
 S GMTSITE=$P($G(^GMT(142.98,"ASITE")),"^",1)
"RTN","GMTSXAL",155,0)
 S GMTSITE=$S($L(GMTSITE):+GMTSITE,1:1) I GMTSUSR=.5 S X=GMTSITE Q X
"RTN","GMTSXAL",156,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I")
"RTN","GMTSXAL",157,0)
 S:'$L(GMTSCPL) GMTSCPL=GMTSITE
"RTN","GMTSXAL",158,0)
 S X=GMTSCPL
"RTN","GMTSXAL",159,0)
 Q X
"RTN","GMTSXAL",160,0)
PRE(X) ;   Precedence
"RTN","GMTSXAL",161,0)
 N GMTSUSR,GMTSPRE,GMTSDEF,GMTSC,GMTSI,GMTSA,GMTS S GMTSUSR=+($G(X))
"RTN","GMTSXAL",162,0)
 S (GMTSDEF,X)=$$DEF^GMTSXAW Q:+GMTSUSR=0 X  S GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11),GMTSC="^"_$TR($$DEF^GMTSXAW,";","^")_"^"
"RTN","GMTSXAL",163,0)
 S GMTS="" F GMTSI=1:1 Q:GMTSI>$L(GMTSPRE,";")  D
"RTN","GMTSXAL",164,0)
 . S GMTSA=$P($G(GMTSPRE),";",GMTSI) Q:$L(GMTSA)'=3  Q:GMTSA'="NAT"&(GMTSC'[("^"_GMTSA_"^"))  Q:GMTS[(";"_GMTSA)  S GMTS=GMTS_";"_GMTSA
"RTN","GMTSXAL",165,0)
 S GMTSPRE=$$TRIM^GMTSXA(GMTS,";") S:'$L(GMTSPRE) GMTSPRE=GMTSDEF
"RTN","GMTSXAL",166,0)
 S X=GMTSPRE
"RTN","GMTSXAL",167,0)
 Q X
"RTN","GMTSXAO")
0^23^B11645035
"RTN","GMTSXAO",1,0)
GMTSXAO ; SLC/KER - List Parameters/Overwrite             ; 02/27/2002
"RTN","GMTSXAO",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAO",3,0)
 Q
"RTN","GMTSXAO",4,0)
 ;                        
"RTN","GMTSXAO",5,0)
 ; External References
"RTN","GMTSXAO",6,0)
 ;    DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAO",7,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSXAO",8,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSXAO",9,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSXAO",10,0)
 ;    DBIA 10013  ^DIK
"RTN","GMTSXAO",11,0)
 ;                        
"RTN","GMTSXAO",12,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAO",13,0)
 N GMTSUSR,GMTSACT S GMTSUSR=+($G(DUZ)) D PREF Q
"RTN","GMTSXAO",14,0)
 ;
"RTN","GMTSXAO",15,0)
EN2(X) ; Entry Point for User
"RTN","GMTSXAO",16,0)
 N GMTSUSR,GMTSACT S GMTSUSR=+($G(X)) D PREF Q
"RTN","GMTSXAO",17,0)
 ;                                   
"RTN","GMTSXAO",18,0)
EN3 ; Entry Point for Site
"RTN","GMTSXAO",19,0)
 N X,GMTSALW,GMTSPRE,GMTSCPL,GMTSUSR,GMTSACT,GMTSEL S GMTSUSR=.5
"RTN","GMTSXAO",20,0)
 D EN2^GMTSXAW(+($G(GMTSUSR))) S:$L($G(GMTSALW("ALLOWABLE")))>2 GMTSEL=$G(GMTSALW("ALLOWABLE"))
"RTN","GMTSXAO",21,0)
 Q:'$L($G(GMTSEL))  S X=$$CPL(GMTSEL),X=$S(X="O":0,X="A":1,1:"")
"RTN","GMTSXAO",22,0)
 S:$L(X) ^GMT(142.98,"ASITE")=X
"RTN","GMTSXAO",23,0)
 Q
"RTN","GMTSXAO",24,0)
PREF ; Get Preference - Append/Overwrite
"RTN","GMTSXAO",25,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))  S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 
"RTN","GMTSXAO",26,0)
 N GMTSEL,GMTSALW,GMTSPRE,GMTSCPL S GMTSEL=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAO",27,0)
 D EN2^GMTSXAW(+($G(GMTSUSR))) S:'$L(GMTSEL)&($L($G(GMTSALW("ALLOWABLE")))>2) GMTSEL=$G(GMTSALW("ALLOWABLE"))_";NAT"
"RTN","GMTSXAO",28,0)
 S X=$$CPL(GMTSEL),X=$S(X="O":0,X="A":1,1:"") D:$L(X) EDIT(GMTSUSR,X)
"RTN","GMTSXAO",29,0)
 Q
"RTN","GMTSXAO",30,0)
 ;            
"RTN","GMTSXAO",31,0)
CPL(X) ; Compile List (Append or Overwrite)
"RTN","GMTSXAO",32,0)
 Q:'$L($G(X)) 0  Q:$L($G(X),";")<2 0
"RTN","GMTSXAO",33,0)
 N Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSPRE,GMTSI,GMTST,GMTSA,GMTSO S GMTSPRE=$G(X)
"RTN","GMTSXAO",34,0)
 I +($G(GMTSUSR))'=.5 D
"RTN","GMTSXAO",35,0)
 . W !!,"Default Method for building 'Health Summary Types'"
"RTN","GMTSXAO",36,0)
 . W !,"List on the CPRS Reports Tab",!
"RTN","GMTSXAO",37,0)
 I +($G(GMTSUSR))=.5 D
"RTN","GMTSXAO",38,0)
 . W !!,"Site Default Method for building 'Health Summary Types'"
"RTN","GMTSXAO",39,0)
 . W !,"List on the CPRS Reports Tab",!
"RTN","GMTSXAO",40,0)
 W !,?3,"Append selected Health Summary Types to the list",!,?3,"Overwrite selected Health Summary Types to the list",!
"RTN","GMTSXAO",41,0)
 S DIR(0)="SAO^A:Append;O:Overwrite",DIR("A")="Select Append/Overwrite (A/O):  "
"RTN","GMTSXAO",42,0)
 S DIR("B")="A",DIR("?")="^D EN1^GMTSXAC",DIR("??")="^D EN2^GMTSXAC"
"RTN","GMTSXAO",43,0)
 D ^DIR S X=Y
"RTN","GMTSXAO",44,0)
 Q X
"RTN","GMTSXAO",45,0)
 ;                                 
"RTN","GMTSXAO",46,0)
EDIT(GMTSUXR,X) ; Edit "Append/Overwrite"
"RTN","GMTSXAO",47,0)
 N DIC,DIE,DTOUT,DUOUT,Y,DR,DA,GMTSACT,GMTSDAT,GMTSPREF,GMTSA
"RTN","GMTSXAO",48,0)
 S GMTSDAT=+($G(X)),GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0
"RTN","GMTSXAO",49,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXAO",50,0)
 S GMTSPREF=$$PENT(GMTSUSR) Q:+GMTSPREF'>0
"RTN","GMTSXAO",51,0)
 S DIE="^GMT(142.98,",DA=+($G(GMTSUSR)),DR="10///^S X=+GMTSDAT"
"RTN","GMTSXAO",52,0)
ED ;   Lock Record, Edit Entry
"RTN","GMTSXAO",53,0)
 L +^GMT(142.98,+GMTSPREF):0 I $T D ^DIE L -^GMT(142.98,+GMTSPREF) Q
"RTN","GMTSXAO",54,0)
 S GMTSA=+($G(GMTSA))+1 Q:GMTSA>3  H 1 G ED
"RTN","GMTSXAO",55,0)
 Q
"RTN","GMTSXAO",56,0)
 ;                           
"RTN","GMTSXAO",57,0)
 ; Miscellaneous
"RTN","GMTSXAO",58,0)
PENT(GMTSUSR) ;   Get User Preferred Entry
"RTN","GMTSXAO",59,0)
 N DIC,DTOUT,DUOUT,GMTSACT,DLAYGO S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0 -1
"RTN","GMTSXAO",60,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 -1
"RTN","GMTSXAO",61,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X) -1
"RTN","GMTSXAO",62,0)
 S DIC="^GMT(142.98,",DIC(0)="LM",DLAYGO=142.98 D ^DIC
"RTN","GMTSXAO",63,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAO",64,0)
DP(X) ;   Delete User Preferece of Inactive User
"RTN","GMTSXAO",65,0)
 N DA,DIK,DIC,DTOUT,DUOUT,GMTSUSR S GMTSUSR=+($G(X)),X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAO",66,0)
 S DIC="^GMT(142.98,",DIC(0)="M" D ^DIC I +Y>0 S DIK=DIC,DA=+Y D ^DIK
"RTN","GMTSXAO",67,0)
 Q
"RTN","GMTSXAP")
0^24^B58787039
"RTN","GMTSXAP",1,0)
GMTSXAP ; SLC/KER - List Parameters/Precedence            ; 02/27/2002
"RTN","GMTSXAP",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAP",3,0)
 Q
"RTN","GMTSXAP",4,0)
 ;                          
"RTN","GMTSXAP",5,0)
 ; External References in GMTSXAP
"RTN","GMTSXAP",6,0)
 ;   DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAP",7,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSXAP",8,0)
 ;                          
"RTN","GMTSXAP",9,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAP",10,0)
 N GMTSUSR S GMTSUSR=+($G(DUZ)) D PREF Q
"RTN","GMTSXAP",11,0)
EN2(X) ; Entry Point for User
"RTN","GMTSXAP",12,0)
 N GMTSUSR S GMTSUSR=+($G(X)) D PREF Q
"RTN","GMTSXAP",13,0)
 ;                          
"RTN","GMTSXAP",14,0)
PREF ; Get Preference - Precedence
"RTN","GMTSXAP",15,0)
 N GMTSACT Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAP",16,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP^GMTSXAP2(GMTSUSR)
"RTN","GMTSXAP",17,0)
 Q:+GMTSACT'>0  S X=$$PRE(GMTSUSR) D:$L(X) EDIT^GMTSXAP2(GMTSUSR,X) Q
"RTN","GMTSXAP",18,0)
 ;                                  
"RTN","GMTSXAP",19,0)
PRE(GMTSUSR) ; Precedence of Parameter Entities
"RTN","GMTSXAP",20,0)
 ;                          
"RTN","GMTSXAP",21,0)
 ;   Input    User, pointer to NEW PERSON file
"RTN","GMTSXAP",22,0)
 ;
"RTN","GMTSXAP",23,0)
 ;   Output   String of Selected Entity Abbreviations,
"RTN","GMTSXAP",24,0)
 ;            delimited by a semi-colon, and arranged in
"RTN","GMTSXAP",25,0)
 ;            the order they should be used.
"RTN","GMTSXAP",26,0)
 ;                          
"RTN","GMTSXAP",27,0)
 ;               Example:  USR;SYS;NAT
"RTN","GMTSXAP",28,0)
 ;                          
"RTN","GMTSXAP",29,0)
 ;             Use "User" defined Health Summary Types, 
"RTN","GMTSXAP",30,0)
 ;             "System" defined Health Summary Types and
"RTN","GMTSXAP",31,0)
 ;             "National" Health Summary Types in that order.
"RTN","GMTSXAP",32,0)
 ;                          
"RTN","GMTSXAP",33,0)
 N GMTSEL,GMTSORD,GMTS,GMTSDEF,GMTSEXIT,GMTSINC,GMTSIN,GMTSCPL,GMTSPRE
"RTN","GMTSXAP",34,0)
 S GMTSUSR=+($G(GMTSUSR)),GMTSEXIT=0 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR)))) ""
"RTN","GMTSXAP",35,0)
 W:+($G(GMTSUSR))'=.5 !,"CPRS Reports Tab, Health Summary Type List (Contents)",!
"RTN","GMTSXAP",36,0)
 W:+($G(GMTSUSR))=.5 !,"Site Default CPRS Reports Tab, Health Summary Type List (Contents)",!
"RTN","GMTSXAP",37,0)
 D INA S GMTSIN=0 F  S GMTSIN=$O(GMTSINC(GMTSIN)) Q:+GMTSIN=0  Q:+($G(GMTSEXIT))>0  D INC(GMTSINC(GMTSIN)) Q:+($G(GMTSEXIT))>0
"RTN","GMTSXAP",38,0)
 I +GMTSEXIT>0,$D(GMTSEL("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",39,0)
 Q:+($G(GMTSEXIT))>0 "" S X="" I '$D(GMTSEL)!($O(GMTSEL(0))'>0) Q X
"RTN","GMTSXAP",40,0)
 I $D(GMTSEL),$O(GMTSEL(0))>0 D ORD
"RTN","GMTSXAP",41,0)
 I +GMTSEXIT>0,$D(GMTSORD("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",42,0)
 S:+($G(GMTSEXIT))=0 X=$$CPL
"RTN","GMTSXAP",43,0)
 I +GMTSEXIT>0,$D(GMTSCPL("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",44,0)
 Q X
"RTN","GMTSXAP",45,0)
 ; Include Health Summary Types
"RTN","GMTSXAP",46,0)
INA ;   Input Array (from Parameter File)
"RTN","GMTSXAP",47,0)
 N GMTSI,GMTST,GMTSA,GMTSN,GMTSP,GMTSH,GMTSC,GMTSALW D EN^GMTSXAW
"RTN","GMTSXAP",48,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSALW(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",49,0)
 . S GMTST=$G(GMTSALW(GMTSI)) Q:'$L(GMTST)  S GMTSA=$P(GMTST,"^",1) Q:$L(GMTSA)'=3  S GMTSN=$P(GMTST,"^",4) Q:'$L(GMTSN)
"RTN","GMTSXAP",50,0)
 . ; Include User Preferred Health Summary Types:  (Y/N)
"RTN","GMTSXAP",51,0)
 . ; Include System Defined Health Summary Types:  (Y/N)
"RTN","GMTSXAP",52,0)
 . ; Group National Types together (Remote Data Views): (Y/N)
"RTN","GMTSXAP",53,0)
 . S GMTSP="Include "_GMTSN_" Defined Health Summary Types"
"RTN","GMTSXAP",54,0)
 . S GMTSH=GMTSN_" Level Health Summary Types"
"RTN","GMTSXAP",55,0)
 . S:GMTSA="USR" GMTSP="Include "_GMTSN_" Preferred Health Summary Types",GMTSH=GMTSN_" Preferred Health Summary Types"
"RTN","GMTSXAP",56,0)
 . S GMTSC=GMTSC+1,GMTSINC(GMTSC)=GMTSA_"^"_GMTSP_"^"_GMTSH
"RTN","GMTSXAP",57,0)
 S GMTSC=GMTSC+1,GMTSA="NAT",GMTSN="National"
"RTN","GMTSXAP",58,0)
 S GMTSP="Group "_GMTSN_" Types together (Remote Data View)"
"RTN","GMTSXAP",59,0)
 S GMTSH="Nationally Exported Health Summary Types"
"RTN","GMTSXAP",60,0)
 S GMTSINC(GMTSC)=GMTSA_"^"_GMTSP_"^"_GMTSH
"RTN","GMTSXAP",61,0)
 Q
"RTN","GMTSXAP",62,0)
INC(X) ;   Select Health Summary Types to Include
"RTN","GMTSXAP",63,0)
 Q:+($G(GMTSEXIT))>0  N Y,DIR,%,%P,DTOUT,DUOUT,DIRUT,DIROUT,GMTSI,GMTST,GMTSA,GMTSO S GMTST=$G(X)
"RTN","GMTSXAP",64,0)
 S GMTSA=$P(GMTST,"^",1),GMTSO=$P(GMTST,"^",3),GMTST=$P(GMTST,"^",2) Q:'$L(GMTST)  Q:GMTSA'?3U
"RTN","GMTSXAP",65,0)
 S GMTSI=+($O(GMTSDEF(" "),-1))+1,GMTSDEF(GMTSI)=GMTSA_"^"_GMTST_"^"_GMTSO
"RTN","GMTSXAP",66,0)
 S DIR(0)="YAO",DIR("A")="  "_GMTST_":" F  Q:$L(DIR("A"))>51  S DIR("A")=DIR("A")_" "
"RTN","GMTSXAP",67,0)
 S DIR("A")=DIR("A")_" (Y/N)  " S:$L(GMTSO) DIR("A")="  "_DIR("A")
"RTN","GMTSXAP",68,0)
 S DIR("B")="Y",DIR("?")="^D INH1^GMTSXAP",DIR("??")="^D INH2^GMTSXAP"
"RTN","GMTSXAP",69,0)
 S:DIR("A")["Group Nat" DIR("B")="N"
"RTN","GMTSXAP",70,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAP",71,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAP",72,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAP",73,0)
 . S Y="@" K GMTSEL S GMTSEL("@")=""
"RTN","GMTSXAP",74,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting"
"RTN","GMTSXAP",75,0)
 S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAP",76,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAP",77,0)
 I +Y>0 S GMTSI=+($O(GMTSEL(" "),-1))+1,GMTSEL(GMTSI)=GMTSA_"^"_GMTST_"^"_GMTSO
"RTN","GMTSXAP",78,0)
 Q
"RTN","GMTSXAP",79,0)
INH1 ;     Include Help - Single ?
"RTN","GMTSXAP",80,0)
 W !,"        Enter either 'Y' or 'N'" D INH3 Q
"RTN","GMTSXAP",81,0)
INH2 ;     Include Help - Double ??
"RTN","GMTSXAP",82,0)
 W !,"        Select specified groups of Health Summary Types to include in the"
"RTN","GMTSXAP",83,0)
 W !,"        Health Summary Types list on the CPRS Reports Tab.  Groups include:",!
"RTN","GMTSXAP",84,0)
 W !,"            USR   User Preferred Health Summary Types in the Parameters file"
"RTN","GMTSXAP",85,0)
 W !,"            SYS   System Defined Summary Types in the parameters file"
"RTN","GMTSXAP",86,0)
 W !,"            NAT   National Health Summary Types (Remote Data Views)" D INH3 Q
"RTN","GMTSXAP",87,0)
INH3 ;     Include Help - Prompt
"RTN","GMTSXAP",88,0)
 I $L($G(DIR("A"))),$G(DIR("A"))'["Include",$G(DIR("A"))=$G(%P) D
"RTN","GMTSXAP",89,0)
 . N GMTSL S GMTSL="            ",GMTSL=$S($G(DIR("A"))[GMTSL:"  ",1:"")
"RTN","GMTSXAP",90,0)
 . S (%P,DIR("A"))=GMTSL_"  Include "_$$TRIM^GMTSXA(DIR("A")," ",1)
"RTN","GMTSXAP",91,0)
 Q
"RTN","GMTSXAP",92,0)
 ;                              
"RTN","GMTSXAP",93,0)
ORD ; Order of Health Summaries in List
"RTN","GMTSXAP",94,0)
 N GMTSI,GMTST,GMTSC,GMTSCNT,GMTSTOT,GMTSREM,GMTSSO,GMTSNXT,GMTSNXC
"RTN","GMTSXAP",95,0)
 S (GMTSSO,GMTSCNT,GMTSI)=0,(GMTSTOT,GMTST)=$$SLT^GMTSXAP2
"RTN","GMTSXAP",96,0)
 ;   One Selected
"RTN","GMTSXAP",97,0)
 I GMTST=1 D  Q
"RTN","GMTSXAP",98,0)
 . S (GMTSI,GMTSC)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",99,0)
 . . S GMTST=$P($G(GMTSEL(GMTSI)),"^",1)
"RTN","GMTSXAP",100,0)
 . . S:GMTST?3U GMTSC=GMTSC+1,GMTSORD(GMTSC)=GMTSEL(GMTSI)
"RTN","GMTSXAP",101,0)
 ;   Multiple Selected
"RTN","GMTSXAP",102,0)
 W !!!," You have selected multiple Health Summary types to be listed on the CPRS",!," reports tab.  Now you must select the order in which you want these to",!," be displayed."
"RTN","GMTSXAP",103,0)
 F  Q:+($G(GMTSEXIT))>0  D SO Q:+($G(GMTSEXIT))>0  Q:'$D(GMTSEL)
"RTN","GMTSXAP",104,0)
 Q
"RTN","GMTSXAP",105,0)
SO ;   Select Order
"RTN","GMTSXAP",106,0)
 N GMTSI,GMTSC,GMTSMAX,GMTSREO S GMTSI=0,GMTSREM=$$SLT^GMTSXAP2
"RTN","GMTSXAP",107,0)
 S GMTSCNT=GMTSTOT-GMTSREM,GMTSNXT=GMTSCNT+1,GMTSSO=+($G(GMTSSO))+1
"RTN","GMTSXAP",108,0)
 S GMTSNXC=$S(GMTSNXT=1:(GMTSNXT_"st"),GMTSNXT=2:(GMTSNXT_"nd"),GMTSNXT=3:(GMTSNXT_"rd"),1:(GMTSNXT_"th"))
"RTN","GMTSXAP",109,0)
 I +GMTSREM=1 D  Q
"RTN","GMTSXAP",110,0)
 . S Y=+GMTSREM D SET
"RTN","GMTSXAP",111,0)
 W ! D:+($G(GMTSSO))=1 SOHD D SOL,REO S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",112,0)
 S GMTSMAX=GMTSREM
"RTN","GMTSXAP",113,0)
 W ! N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMTSXAP",114,0)
 S DIR(0)="NAO^1:"_GMTSMAX_":0"
"RTN","GMTSXAP",115,0)
 S DIR("?")="^D SOH1^GMTSXAP"
"RTN","GMTSXAP",116,0)
 S DIR("??")="^D SOH2^GMTSXAP"
"RTN","GMTSXAP",117,0)
 S DIR("A")="         Select the "_GMTSNXC_" to be listed:  "
"RTN","GMTSXAP",118,0)
 K DIR("B") S:+($O(GMTSREO(0)))>0 DIR("B")=+($O(GMTSREO(0)))
"RTN","GMTSXAP",119,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAP",120,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAP",121,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAP",122,0)
 . S Y="@" K GMTSORD S GMTSORD("@")=""
"RTN","GMTSXAP",123,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting" S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAP",124,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAP",125,0)
 I +Y>0,+Y'>GMTSREM D SET
"RTN","GMTSXAP",126,0)
 Q
"RTN","GMTSXAP",127,0)
SOL ;     List - Included Health Summaries
"RTN","GMTSXAP",128,0)
 N GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",129,0)
 . S GMTSC=GMTSC+1 W !,?9,$J(GMTSC,4),"  ",$P(GMTSEL(GMTSI),"^",3)
"RTN","GMTSXAP",130,0)
 Q
"RTN","GMTSXAP",131,0)
SOHD ;     Help Text
"RTN","GMTSXAP",132,0)
 W !,"    Order to Display Included Health Summary Types",! Q
"RTN","GMTSXAP",133,0)
SOH1 ;     Help - Single ?
"RTN","GMTSXAP",134,0)
 N GMTSC,GMTSI,GMTSN,GMTSCT S (GMTSC,GMTSI)=0,GMTSCT=+($G(GMTSNXT)) F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSXAP",135,0)
 S GMTSN=$S(GMTSCT=1:"first",GMTSCT=2:"second",GMTSCT=3:"third",GMTSCT=4:"fourth",GMTSCT=5:"fifty",GMTSCT=6:"sixth",GMTSCT=7:"seventh",GMTSCT=8:"eighth",GMTSCT=9:"nineth",1:"")
"RTN","GMTSXAP",136,0)
 I '$L(GMTSN),+GMTSC>1 W !,?9,"Select a group of Health Summary Types to list (1-",GMTSC,")",!
"RTN","GMTSXAP",137,0)
 I $L(GMTSN),+GMTSC>1 W !,?9,"Select a group of Health Summary Types to list ",GMTSN," (1-",GMTSC,")",!
"RTN","GMTSXAP",138,0)
 D SOL
"RTN","GMTSXAP",139,0)
 Q
"RTN","GMTSXAP",140,0)
SOH2 ;     Help - Double ??
"RTN","GMTSXAP",141,0)
 W !,"         You have included multiple Health Summary types to be"
"RTN","GMTSXAP",142,0)
 W !,"         listed on the CPRS reports tab, Health Summary Types box."
"RTN","GMTSXAP",143,0)
 W !,"         Now you must select the order in which you want these"
"RTN","GMTSXAP",144,0)
 W !,"         to be listed.",!
"RTN","GMTSXAP",145,0)
 D SOL
"RTN","GMTSXAP",146,0)
 Q
"RTN","GMTSXAP",147,0)
 ;                                 
"RTN","GMTSXAP",148,0)
 ; Arrange
"RTN","GMTSXAP",149,0)
SET ;   Set Order
"RTN","GMTSXAP",150,0)
 D REO N GMTSO S GMTSO=+($O(GMTSORD(" "),-1))+1
"RTN","GMTSXAP",151,0)
 S:$L($G(GMTSREO(+$G(Y)))) GMTSORD(GMTSO)=$G(GMTSREO(+Y))
"RTN","GMTSXAP",152,0)
 S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",153,0)
 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",154,0)
 . S GMTSC=GMTSC+1 I GMTSC=+Y K GMTSEL(GMTSI),GMTSREO(GMTSC)
"RTN","GMTSXAP",155,0)
 Q
"RTN","GMTSXAP",156,0)
REO ;   Re-order
"RTN","GMTSXAP",157,0)
 K GMTSREO N GMTSC,GMTSI S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",158,0)
 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",159,0)
 . S GMTSC=GMTSC+1 S GMTSREO(GMTSC)=$G(GMTSEL(GMTSI))
"RTN","GMTSXAP",160,0)
 Q
"RTN","GMTSXAP",161,0)
CPL(X) ;   Compile Order
"RTN","GMTSXAP",162,0)
 Q:+($G(GMTSEXIT))>0 ""
"RTN","GMTSXAP",163,0)
 N GMTSI,GMTSA,GMTSOK,GMTSNEW S X="",GMTSI=0
"RTN","GMTSXAP",164,0)
 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",165,0)
 . S GMTSA=$$UP^GMTSXA($P($G(GMTSORD(GMTSI)),"^",1))
"RTN","GMTSXAP",166,0)
 . S:GMTSA?3U X=$G(X)_";"_GMTSA
"RTN","GMTSXAP",167,0)
 S (GMTSNEW,X)=$$TRIM^GMTSXA(X,";",3)
"RTN","GMTSXAP",168,0)
 S GMTSOK=$$OK^GMTSXAP2 Q:GMTSOK'>0 ""
"RTN","GMTSXAP",169,0)
 Q X
"RTN","GMTSXAP2")
0^25^B27973256
"RTN","GMTSXAP2",1,0)
GMTSXAP2 ; SLC/KER - List Parameters/Precedence 2         ; 02/27/2002
"RTN","GMTSXAP2",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAP2",3,0)
 Q
"RTN","GMTSXAP2",4,0)
 ;                          
"RTN","GMTSXAP2",5,0)
 ; External References in GMTSXAP2
"RTN","GMTSXAP2",6,0)
 ;    DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAP2",7,0)
 ;    DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAP2",8,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSXAP2",9,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSXAP2",10,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSXAP2",11,0)
 ;    DBIA 10013  ^DIK
"RTN","GMTSXAP2",12,0)
 ;                        
"RTN","GMTSXAP2",13,0)
 ; Check to see if Compiled Order is correct
"RTN","GMTSXAP2",14,0)
OK(X) ;   Ask if Ok
"RTN","GMTSXAP2",15,0)
 N Y,DIR,GMTSTOT,GMTSOLD S GMTSNEW=$G(GMTSNEW),GMTSOLD=$$OLD
"RTN","GMTSXAP2",16,0)
 S GMTSTOT=$$ORT S:GMTSTOT=1 X=$$OKO S:GMTSTOT>1 X=$$OKM S:GMTSTOT'>0 X=0
"RTN","GMTSXAP2",17,0)
 Q X
"RTN","GMTSXAP2",18,0)
OKM(X) ;     Multiple entities selected     i.e. USR;SYS
"RTN","GMTSXAP2",19,0)
 N DIR,Y,DIROUT,DUOUT,DTOUT S X=1 D OKA Q:'$D(DIR) 0
"RTN","GMTSXAP2",20,0)
 D YND
"RTN","GMTSXAP2",21,0)
 Q X
"RTN","GMTSXAP2",22,0)
OKO(X) ;     Only one entity selected       i.e. USR
"RTN","GMTSXAP2",23,0)
 I '$L($G(GMTSORD(1)))!($L($P(GMTSORD(1),"^",1))'=3)!($L($P(GMTSORD(1),"^",3))'>0) Q 0
"RTN","GMTSXAP2",24,0)
 N DIR,Y,DIROUT,DUOUT,DTOUT D OKA Q:'$D(DIR) 0
"RTN","GMTSXAP2",25,0)
 D YND
"RTN","GMTSXAP2",26,0)
 Q X
"RTN","GMTSXAP2",27,0)
OKA ;   Set up Prompts - DIR("A")
"RTN","GMTSXAP2",28,0)
 N GMTSC,GMTSI,GMTST S (GMTSC,GMTSI)=0 S GMTST=$$ORT
"RTN","GMTSXAP2",29,0)
MUL ;     Multiple Entities
"RTN","GMTSXAP2",30,0)
 I GMTST>1 D  Q
"RTN","GMTSXAP2",31,0)
 . K DIR N GMTSTC,GMTSA,GMTSC S GMTSC=0,GMTSA=GMTST+4 S GMTSTC=$S(GMTST=2:"two",GMTST=3:"three",1:"several")
"RTN","GMTSXAP2",32,0)
 . S DIR("A",1)="",DIR("A",2)=" You have selected "_GMTSTC_" Health Summary Types, arranged "
"RTN","GMTSXAP2",33,0)
 . S DIR("A",3)=" in the following order:",DIR("A",4)=""
"RTN","GMTSXAP2",34,0)
 . F GMTSA=1:1:GMTST S DIR("A",(4+GMTSA))="  "_$J(GMTSA,2)_"    "_$P($G(GMTSORD(+GMTSA)),"^",3)
"RTN","GMTSXAP2",35,0)
 . S GMTSA=+($O(DIR("A"," "),-1))+1,DIR("A",GMTSA)="",DIR("A")=" Is this precedence correct?  (Y/N)  ",DIR(0)="YAO",DIR("B")="Y"
"RTN","GMTSXAP2",36,0)
ONE ;     One Entity
"RTN","GMTSXAP2",37,0)
 I GMTST=1 D  Q
"RTN","GMTSXAP2",38,0)
 . I $L($G(GMTSORD(1))),$L($P(GMTSORD(1),"^",1))=3,$L($P(GMTSORD(1),"^",3))>0 D  Q
"RTN","GMTSXAP2",39,0)
 . . K DIR S DIR("A",1)=""
"RTN","GMTSXAP2",40,0)
 . . S DIR("A",2)=" You have selected one Health Summary Type"
"RTN","GMTSXAP2",41,0)
 . . S DIR("A",3)=""
"RTN","GMTSXAP2",42,0)
 . . S DIR("A",4)="    "_$P($G(GMTSORD(1)),"^",3)
"RTN","GMTSXAP2",43,0)
 . . S DIR("A",5)=""
"RTN","GMTSXAP2",44,0)
 . . S DIR("A")=" Is this correct?  (Y/N)  "
"RTN","GMTSXAP2",45,0)
 . . S DIR(0)="YAO",DIR("B")="Y"
"RTN","GMTSXAP2",46,0)
 . K DIR
"RTN","GMTSXAP2",47,0)
 K DIR
"RTN","GMTSXAP2",48,0)
 Q
"RTN","GMTSXAP2",49,0)
 ;            
"RTN","GMTSXAP2",50,0)
YND ; Yes/No/Delete
"RTN","GMTSXAP2",51,0)
 W ! S X=$G(X) S:$L($G(DIR("A"))) DIR("A")=" Is this correct?  (Y/N)  "
"RTN","GMTSXAP2",52,0)
 S (DIR("?"),DIR("??"))="^D YNDH^GMTSXAP2"
"RTN","GMTSXAP2",53,0)
 S DIR(0)="FAO^1;3^K:$$YNDI^GMTSXAP2(X)'>0 X",DIR("B")="Y"
"RTN","GMTSXAP2",54,0)
 D ^DIR S X=$$YNDO(X) S:X["^" GMTSEXIT=1 S:X="@" GMTSEXIT=1,GMTSCPL("@")=""
"RTN","GMTSXAP2",55,0)
 S:X="N"&($L(GMTSNEW))&(GMTSNEW=GMTSOLD) GMTSEXIT=1,GMTSCPL("@")=""
"RTN","GMTSXAP2",56,0)
 S X=$S(X="Y":1,X="N":0,1:-1)
"RTN","GMTSXAP2",57,0)
 Q
"RTN","GMTSXAP2",58,0)
YNDI(X) ;   Input Transform
"RTN","GMTSXAP2",59,0)
 N GMTS S GMTS=$$UP^GMTSXA($G(X)) Q:$L(GMTS)&("^Y^YE^YES^N^NO^@^^^^^"'[("^"_GMTS_"^")) 0 Q 1
"RTN","GMTSXAP2",60,0)
YNDO(X) ;   Output Transform
"RTN","GMTSXAP2",61,0)
 N GMTS S GMTS=$$UP^GMTSXA($G(X)) S X=$S($E(GMTS,1)="Y":"Y",$E(GMTS,1)="N":"N",$E(GMTS,1)="@":"@",GMTS["^^":"^^",1:"^")
"RTN","GMTSXAP2",62,0)
 S X=$S($D(DUOUT):"^",1:X),X=$S($D(DTOUT):"^^",$D(DIROUT):"^^",1:X) Q X
"RTN","GMTSXAP2",63,0)
YNDH ;   Help
"RTN","GMTSXAP2",64,0)
 W !,"    Enter either 'Y'es, 'N'o, or '^' to exit" Q
"RTN","GMTSXAP2",65,0)
 Q
"RTN","GMTSXAP2",66,0)
 ;            
"RTN","GMTSXAP2",67,0)
EDIT(GMTSUXR,X) ; Edit "Append/Overwrite"
"RTN","GMTSXAP2",68,0)
 N DIC,DIE,DTOUT,DUOUT,Y,DR,DA,GMTSACT,GMTSDAT,GMTSPREF,GMTSA
"RTN","GMTSXAP2",69,0)
 S GMTSDAT=$G(X),GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXAP2",70,0)
 S GMTSPREF=$$PENT(GMTSUSR) Q:+GMTSPREF'>0
"RTN","GMTSXAP2",71,0)
 S DIE="^GMT(142.98,",DA=+($G(GMTSUSR)),DR="11///^S X=GMTSDAT"
"RTN","GMTSXAP2",72,0)
ED ;   Lock Record, Edit Entry
"RTN","GMTSXAP2",73,0)
 L +^GMT(142.98,+GMTSPREF):0 I $T D ^DIE L -^GMT(142.98,+GMTSPREF) Q
"RTN","GMTSXAP2",74,0)
 S GMTSA=+($G(GMTSA))+1 Q:GMTSA>3  H 1 G ED
"RTN","GMTSXAP2",75,0)
 Q
"RTN","GMTSXAP2",76,0)
 ;            
"RTN","GMTSXAP2",77,0)
 ; Deletions
"RTN","GMTSXAP2",78,0)
ADEL ;   Ask for Deletion of Precedence
"RTN","GMTSXAP2",79,0)
 N X,Y,GMTSU,GMTSACT,GMTSDEF S GMTSU=$G(GMTSUSR),GMTSACT=$$ACTIVE^XUSER(+GMTSU) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0  S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAP2",80,0)
 Q:'$D(^GMT(142.98,+GMTSUSR,1))  S GMTSDEF=$P($G(^GMT(142.98,+GMTSUSR,1)),"^",2) Q:'$L(GMTSDEF)
"RTN","GMTSXAP2",81,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTSA S DIR("B")="N",(GMTSA,DIR("A"))="Delete '"_GMTSDEF_"'?  (Y/N)  " S:$D(GMTSEL("@")) DIR("A")="    "_GMTSA S:$D(GMTSORD("@")) DIR("A")="         "_GMTSA
"RTN","GMTSXAP2",82,0)
 S:$D(GMTSCPL("@")) DIR("A")=" "_GMTSA K GMTSEL("@"),GMTSORD("@"),GMTSCPL("@")
"RTN","GMTSXAP2",83,0)
 S DIR(0)="YAO" W ! D ^DIR S:+Y>0 $P(^GMT(142.98,+GMTSUSR,1),"^",2)=""
"RTN","GMTSXAP2",84,0)
 Q
"RTN","GMTSXAP2",85,0)
DP(X) ;   Delete Record of Inactive User
"RTN","GMTSXAP2",86,0)
 N DA,DIK,DIC,DTOUT,DUOUT,GMTSUSR S GMTSUSR=+($G(X))
"RTN","GMTSXAP2",87,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAP2",88,0)
 S DIC="^GMT(142.98,",DIC(0)="M" D ^DIC I +Y>0 S DIK=DIC,DA=+Y D ^DIK
"RTN","GMTSXAP2",89,0)
 Q
"RTN","GMTSXAP2",90,0)
 ;            
"RTN","GMTSXAP2",91,0)
 ; Miscellaneous
"RTN","GMTSXAP2",92,0)
OLD(X) ;   Old Entry
"RTN","GMTSXAP2",93,0)
 Q $$GET1^DIQ(142.98,+($G(GMTSUSR)),11)
"RTN","GMTSXAP2",94,0)
ORT(X) ;   Total Entities Ordered
"RTN","GMTSXAP2",95,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAP2",96,0)
 Q X
"RTN","GMTSXAP2",97,0)
SLT(X) ;   Total Selected
"RTN","GMTSXAP2",98,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAP2",99,0)
 Q X
"RTN","GMTSXAP2",100,0)
PENT(GMTSUSR) ;   Get User Preference Entry
"RTN","GMTSXAP2",101,0)
 N DIC,DTOUT,DUOUT,GMTSACT,DLAYGO S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0 -1
"RTN","GMTSXAP2",102,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 -1
"RTN","GMTSXAP2",103,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X) -1
"RTN","GMTSXAP2",104,0)
 S DIC="^GMT(142.98,",DIC(0)="LM",DLAYGO=142.98 D ^DIC
"RTN","GMTSXAP2",105,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAP2",106,0)
PIT(X) ;   Precedence Input Transform
"RTN","GMTSXAP2",107,0)
 N GMTSIN S GMTSIN=$$UP^GMTSXA($G(X)) Q:GMTSIN="" 1 N GMTSC,GMTSI,GMTSA,GMTS S GMTSC="^NAT^SYS^USR^",GMTS="" F GMTSI=1:1 Q:GMTSI>$L(GMTSIN,";")  D
"RTN","GMTSXAP2",108,0)
 . S GMTSA=$P($G(GMTSIN),";",GMTSI) Q:$L(GMTSA)'=3  Q:GMTSC'[("^"_GMTSA_"^")  Q:GMTS[(";"_GMTSA)  S GMTS=GMTS_";"_GMTSA
"RTN","GMTSXAP2",109,0)
 S GMTS=$$TRIM^GMTSXA(GMTS,";",3),X=$S(GMTS=GMTSIN:1,1:0) Q X
"RTN","GMTSXAP2",110,0)
USRD(X) ;   User Precedence/Default
"RTN","GMTSXAP2",111,0)
 N GMTSUSR S GMTSUSR=$G(X),X=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAP2",112,0)
 S:X="" X=$$DEF^GMTSXAW(GMTSUSR) Q X
"RTN","GMTSXAR")
0^62^B77442722
"RTN","GMTSXAR",1,0)
GMTSXAR ; SLC/KER - List Parameters/Resequence            ; 02/27/2002
"RTN","GMTSXAR",2,0)
 ;;2.7;Health Summary;**49**;Oct 20, 1995
"RTN","GMTSXAR",3,0)
 ;                    
"RTN","GMTSXAR",4,0)
 ; External References
"RTN","GMTSXAR",5,0)
 ;  DBIA 10022  %XY^%RCR
"RTN","GMTSXAR",6,0)
 ;  DBIA 10018  ^DIE (file #8989.51)
"RTN","GMTSXAR",7,0)
 ;  DBIA 10006  ^DIC (file #8989.51, 8989.518)
"RTN","GMTSXAR",8,0)
 ;  DBIA 10026  ^DIR
"RTN","GMTSXAR",9,0)
 ;  DBIA  2056  $$GET1^DIQ (file #8989.513)
"RTN","GMTSXAR",10,0)
 ;  DBIA  2052  FIELD^DID (file #8989.51)
"RTN","GMTSXAR",11,0)
 ;  DBIA  2992  ^XTV(8989.51,
"RTN","GMTSXAR",12,0)
 ;           
"RTN","GMTSXAR",13,0)
 Q
"RTN","GMTSXAR",14,0)
EN ; Main Entry
"RTN","GMTSXAR",15,0)
 N X,%X,Y,%Y,DA,DIC,DIDEL,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,GMTSA,GMTSC,GMTSCHG,GMTSCNT,GMTSCONT,GMTSCT,GMTSCUR,GMTSD,GMTSEQ,GMTSEXIT
"RTN","GMTSXAR",16,0)
 N GMTSF,GMTSFI,GMTSI,GMTSIE,GMTSM,GMTSMAX,GMTSN,GMTSNEW,GMTSNXC,GMTSNXT,GMTSO,GMTSOK,GMTSOLD,GMTSON,GMTSORD,GMTSPARM,GMTSPI,GMTSREM
"RTN","GMTSXAR",17,0)
 N GMTSREO,GMTSSSO,GMTST,GMTSTOT,GMTSUSR,GMTSMGR
"RTN","GMTSXAR",18,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXAR",19,0)
 S GMTSCHG=0,GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",20,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0
"RTN","GMTSXAR",21,0)
 S %X="^XTV(8989.51,"_GMTSPI_",30,",%Y="GMTSO(""AL""," D %XY^%RCR S %X="^XTV(8989.518,",%Y="GMTSO(""ET""," D %XY^%RCR K GMTSO("ET","B"),GMTSO("ET","C")
"RTN","GMTSXAR",22,0)
 S (GMTSI,GMTSC)=0 F  S GMTSI=$O(GMTSO("AL","B",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",23,0)
 . N GMTSIE S GMTSEQ(GMTSI)="",GMTSIE=0
"RTN","GMTSXAR",24,0)
 . F  S GMTSIE=$O(GMTSO("AL","B",GMTSI,GMTSIE)) Q:+GMTSIE=0  D
"RTN","GMTSXAR",25,0)
 . . N GMTSF S GMTSF=$P($G(GMTSO("AL",GMTSIE,0)),"^",2) Q:+GMTSF=0  Q:'$D(GMTSO("ET",GMTSF,0))
"RTN","GMTSXAR",26,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSXAR",27,0)
 . . S (GMTSCUR(GMTSC),GMTSOLD(GMTSC))=GMTSI_"^"_GMTSF_"^"_$G(GMTSO("ET",GMTSF,0))
"RTN","GMTSXAR",28,0)
 . . S GMTSOLD("B",GMTSI,GMTSC)=""
"RTN","GMTSXAR",29,0)
 D ORD D:+($G(GMTSEXIT))=0 CHK
"RTN","GMTSXAR",30,0)
 W:+($G(GMTSCHG))'>0 !!,?2,"No Changes Made"
"RTN","GMTSXAR",31,0)
 Q
"RTN","GMTSXAR",32,0)
ORD ; Order of Entities
"RTN","GMTSXAR",33,0)
 N GMTSI,GMTST,GMTSC,GMTSCNT,GMTSTOT,GMTSREM,GMTSSO,GMTSNXT,GMTSNXC,GMTSON
"RTN","GMTSXAR",34,0)
 S (GMTSSO,GMTSCNT,GMTSI,GMTSON)=0,(GMTSTOT,GMTST)=$$TOT Q:+GMTSTOT'>1
"RTN","GMTSXAR",35,0)
 S GMTSEXIT=0,GMTSCONT=$$CONT I +GMTSCONT>0 S GMTSEXIT=1 Q
"RTN","GMTSXAR",36,0)
 W !!,"     Please select the order in which you want these to be entities"
"RTN","GMTSXAR",37,0)
 W !,"     to be used." F  Q:+($G(GMTSEXIT))>0  D SO Q:+($G(GMTSEXIT))>0  Q:'$D(GMTSOLD)
"RTN","GMTSXAR",38,0)
 S GMTSEXIT=0
"RTN","GMTSXAR",39,0)
 Q
"RTN","GMTSXAR",40,0)
 ;           
"RTN","GMTSXAR",41,0)
SO ; Select Order
"RTN","GMTSXAR",42,0)
 K GMTSOLD("B") N GMTSI,GMTSC,GMTSMAX,GMTSREO S GMTSI=0,GMTSREM=$$TOT
"RTN","GMTSXAR",43,0)
 S GMTSCNT=GMTSTOT-GMTSREM,GMTSNXT=GMTSCNT+1,GMTSSO=+($G(GMTSSO))+1
"RTN","GMTSXAR",44,0)
 S GMTSNXC=$S(GMTSNXT=1:(GMTSNXT_"st"),GMTSNXT=2:(GMTSNXT_"nd"),GMTSNXT=3:(GMTSNXT_"rd"),1:(GMTSNXT_"th"))
"RTN","GMTSXAR",45,0)
 I +GMTSREM=1 S Y=+GMTSREM D SET Q
"RTN","GMTSXAR",46,0)
 W ! D SOL,REO S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",47,0)
 S GMTSMAX=GMTSREM W ! N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMTSXAR",48,0)
 S DIR(0)="NAO^1:"_GMTSMAX_":0",DIR("?")="^D SOH1^ZZKREP",DIR("??")="^D SOH2^ZZKREP"
"RTN","GMTSXAR",49,0)
 S DIR("A")="        Select the "_GMTSNXC_" entity to be used:  "
"RTN","GMTSXAR",50,0)
 K DIR("B") S:+($O(GMTSREO(0)))>0 DIR("B")=+($O(GMTSREO(0)))
"RTN","GMTSXAR",51,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAR",52,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAR",53,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAR",54,0)
 . S Y="@" K GMTSORD S GMTSORD("@")=""
"RTN","GMTSXAR",55,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting" S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAR",56,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAR",57,0)
 I +Y>0,+Y'>GMTSREM D SET
"RTN","GMTSXAR",58,0)
 Q
"RTN","GMTSXAR",59,0)
SOL ;   List 
"RTN","GMTSXAR",60,0)
 N GMTSN,GMTSA,GMTST,GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",61,0)
 . S GMTSC=GMTSC+1,GMTSA=$P(GMTSOLD(GMTSI),"^",4),GMTSN=$P(GMTSOLD(GMTSI),"^",5)
"RTN","GMTSXAR",62,0)
 . S GMTST=GMTSN_$S(GMTSA="DEV"!(GMTSA="DIV")!(GMTSA="SYS")!(GMTSA="PKG")!(GMTSA="LOC")!(GMTSA="BED"):" level ",1:" ")_"defined Health Summary Types"
"RTN","GMTSXAR",63,0)
 . W !,?5,$J(GMTSC,4),"  ",GMTST
"RTN","GMTSXAR",64,0)
 Q
"RTN","GMTSXAR",65,0)
SOH1 ;   Help - Single ?
"RTN","GMTSXAR",66,0)
 N GMTSC,GMTSI,GMTSN,GMTSCT S (GMTSC,GMTSI)=0,GMTSCT=+($G(GMTSNXT)) F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSXAR",67,0)
 S GMTSN=$S(GMTSCT=1:"first",GMTSCT=2:"second",GMTSCT=3:"third",GMTSCT=4:"fourth",GMTSCT=5:"fifty",GMTSCT=6:"sixth",GMTSCT=7:"seventh",GMTSCT=8:"eighth",GMTSCT=9:"nineth",GMTSCT=10:"tenth",GMTSCT=11:"eleventh",1:"")
"RTN","GMTSXAR",68,0)
 I '$L(GMTSN),+GMTSC>1 W !,?11,"Select a Health Summary Type entity to list" W:$L($G(GMTSNXC)) " ",GMTSNXC W " (1-",GMTSC,")",!
"RTN","GMTSXAR",69,0)
 I $L(GMTSN),+GMTSC>1 W !,?11,"Select a Health Summary Type entity to list ",GMTSN," (1-",GMTSC,")",!
"RTN","GMTSXAR",70,0)
 D SOL
"RTN","GMTSXAR",71,0)
 Q
"RTN","GMTSXAR",72,0)
SOH2 ;   Help - Double ??
"RTN","GMTSXAR",73,0)
 I '$L($G(GMTSPARM)) D SOH1 Q
"RTN","GMTSXAR",74,0)
 W !,?11,"Parameter """,GMTSPARM,""" has multiple "
"RTN","GMTSXAR",75,0)
 W !,?11,"allowable entities for which Health Summary Types may"
"RTN","GMTSXAR",76,0)
 W !,?11,"be assigned and displayed on the CPRS reports tab.  Now"
"RTN","GMTSXAR",77,0)
 W !,?11,"you must select the order in which you want these entites"
"RTN","GMTSXAR",78,0)
 W !,?11,"to be used by the site.",!
"RTN","GMTSXAR",79,0)
 D SOL
"RTN","GMTSXAR",80,0)
 Q
"RTN","GMTSXAR",81,0)
 ;          
"RTN","GMTSXAR",82,0)
 ; Arrange
"RTN","GMTSXAR",83,0)
SET ;   Set Order
"RTN","GMTSXAR",84,0)
 D REO N GMTSO S GMTSO=+($O(GMTSORD(" "),-1))+1
"RTN","GMTSXAR",85,0)
 I $L($P($G(GMTSREO(+($G(Y)))),"^",2,299)) D
"RTN","GMTSXAR",86,0)
 . S GMTSON=$O(GMTSEQ(GMTSON))
"RTN","GMTSXAR",87,0)
 . S GMTSORD(GMTSO)=GMTSON_"^"_$P($G(GMTSREO(+Y)),"^",2,299)
"RTN","GMTSXAR",88,0)
 S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",89,0)
 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",90,0)
 . S GMTSC=GMTSC+1 I GMTSC=+Y K GMTSOLD(GMTSI),GMTSREO(GMTSC)
"RTN","GMTSXAR",91,0)
 Q
"RTN","GMTSXAR",92,0)
REO ;   Re-order
"RTN","GMTSXAR",93,0)
 K GMTSREO N GMTSC,GMTSI S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",94,0)
 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",95,0)
 . S GMTSC=GMTSC+1 S GMTSREO(GMTSC)=$G(GMTSOLD(GMTSI))
"RTN","GMTSXAR",96,0)
 Q
"RTN","GMTSXAR",97,0)
TOT(X) ;   Total Allowable Entities
"RTN","GMTSXAR",98,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAR",99,0)
 Q X
"RTN","GMTSXAR",100,0)
CONT(X) ; Ask to Continue
"RTN","GMTSXAR",101,0)
 S:$O(GMTSCUR(0))=0!('$L($G(GMTSPARM)))!(+($G(GMTSTOT))'>1) GMTSEXIT=1
"RTN","GMTSXAR",102,0)
 Q:$O(GMTSCUR(0))=0!('$L($G(GMTSPARM)))!(+($G(GMTSTOT))'>1) 0
"RTN","GMTSXAR",103,0)
 W !!!," Parameter """,GMTSPARM,""" has ",GMTSTOT," allowable entities"
"RTN","GMTSXAR",104,0)
 W !," which may have the Health Summary Types on the CPRS reports tab "
"RTN","GMTSXAR",105,0)
 W !," and are used in the following order:"
"RTN","GMTSXAR",106,0)
 N DIR,DIROUT,DUOUT,DTOUT,GMTSA,GMTSN,GMTST,GMTSC,GMTSI D CONTM
"RTN","GMTSXAR",107,0)
 S DIR("A")=" Are these in the correct order for your site?  "
"RTN","GMTSXAR",108,0)
 S (DIR("?"),DIR("??"))="^D CONTH^ZZKREP",DIR("B")="Y",DIR(0)="YAO" W ! D ^DIR
"RTN","GMTSXAR",109,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAR",110,0)
 Q 1
"RTN","GMTSXAR",111,0)
CONTH ;   Continue Help
"RTN","GMTSXAR",112,0)
 W !,"   Enter either 'Y' or 'N'"
"RTN","GMTSXAR",113,0)
 D CONTM Q
"RTN","GMTSXAR",114,0)
CONTM ;   Continue Menu
"RTN","GMTSXAR",115,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",116,0)
 . S GMTSA=$P(GMTSCUR(GMTSI),"^",4),GMTSN=$P(GMTSCUR(GMTSI),"^",5)
"RTN","GMTSXAR",117,0)
 . S GMTST=GMTSN_$S(GMTSA="DEV"!(GMTSA="DIV")!(GMTSA="SYS")!(GMTSA="PKG")!(GMTSA="LOC")!(GMTSA="BED"):" level ",1:" ")_"defined Health Summary Types"
"RTN","GMTSXAR",118,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! W !,$J(GMTSC,6),"  ",GMTST
"RTN","GMTSXAR",119,0)
 Q
"RTN","GMTSXAR",120,0)
CHK ; Check if OK
"RTN","GMTSXAR",121,0)
 N GMTSC,GMTSI,GMTSA S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  S:GMTSCUR(GMTSI)'[$G(GMTSORD(GMTSI)) GMTSC=1
"RTN","GMTSXAR",122,0)
 I 'GMTSC S GMTSCHG=0 Q
"RTN","GMTSXAR",123,0)
 W !!,?8,"You have selected to resequenced the Health Summary Type"
"RTN","GMTSXAR",124,0)
 W !,?8,"entities in the following order:",!
"RTN","GMTSXAR",125,0)
 D CHKM S GMTSA=$$OK D:+($G(GMTSA))>0 ED
"RTN","GMTSXAR",126,0)
 Q
"RTN","GMTSXAR",127,0)
CHKM ;   Check (Menu)
"RTN","GMTSXAR",128,0)
 N GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  S:GMTSCUR(GMTSI)'[$G(GMTSORD(GMTSI)) GMTSC=1
"RTN","GMTSXAR",129,0)
 Q:'GMTSC  S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",130,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 !,?13,"FROM (Current)",?33,"TO (Resequenced)",!,?13,"----------------",?33,"----------------"
"RTN","GMTSXAR",131,0)
 . W !,?7,$J(GMTSC,4),?13,$P($G(GMTSCUR(GMTSI)),"^",5),?33,$P($G(GMTSORD(GMTSI)),"^",5)
"RTN","GMTSXAR",132,0)
 Q
"RTN","GMTSXAR",133,0)
OK(X) ; Ask if OK
"RTN","GMTSXAR",134,0)
 W ! N DIR,DIROUT,DUOUT,DTOUT S (DIR("?"),DIR("??"))="^D OKH^ZZKREP"
"RTN","GMTSXAR",135,0)
 S DIR("A")="         Is this OK?  ",DIR("B")="Y",DIR(0)="YAO" D ^DIR S X=+($G(Y)) Q X
"RTN","GMTSXAR",136,0)
OKH ;   OK Help
"RTN","GMTSXAR",137,0)
 W !,"           Enter either 'Y' or 'N'",!,!,"         Resequence entities:",! D CHKM Q
"RTN","GMTSXAR",138,0)
 ;           
"RTN","GMTSXAR",139,0)
ED ; Edit Record
"RTN","GMTSXAR",140,0)
 N DIC,DA,DIE,DR,DIDEL,DTOUT,GMTSFI,GMTSI,GMTSEQ,GMTSCNT,GMTST
"RTN","GMTSXAR",141,0)
 S GMTSPI=+($G(GMTSPI)),GMTSCNT=0
"RTN","GMTSXAR",142,0)
 I GMTSPI'>0!(+($O(GMTSORD(0)))'>0)!('$L($G(GMTSPARM)))!($$PDN^GMTSXAW3(+GMTSPI)'=$G(GMTSPARM)) D  Q
"RTN","GMTSXAR",143,0)
 . W !,?5," Unable to resequence at this time."
"RTN","GMTSXAR",144,0)
 S DA(1)=+($G(GMTSPI)) Q:DA(1)'>0  S (DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,",DR=".02///^S X=$G(GMTSFI)"
"RTN","GMTSXAR",145,0)
L ;   Lock Record
"RTN","GMTSXAR",146,0)
 L +^XTV(8989.51,+($G(GMTSPI))) S GMTSCNT=GMTSCNT+1,GMTST=$T
"RTN","GMTSXAR",147,0)
 I 'GMTST,GMTSCNT'>3 H 2 G L
"RTN","GMTSXAR",148,0)
 I 'GMTST,GMTSCNT>3 W !," Another user is editing this entry.",!," Unable to resequence at this time." Q
"RTN","GMTSXAR",149,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",150,0)
 . S GMTSFI=$P(GMTSORD(GMTSI),"^",2),GMTSEQ=$P(GMTSORD(GMTSI),"^",1)
"RTN","GMTSXAR",151,0)
 . S DA=$$DA(DA(1),GMTSEQ),X=GMTSEQ D ^DIE S GMTSCHG=1
"RTN","GMTSXAR",152,0)
 L -^XTV(8989.51,+($G(GMTSPI)))
"RTN","GMTSXAR",153,0)
 Q
"RTN","GMTSXAR",154,0)
DA(GMTSI,X) ;   Get DA
"RTN","GMTSXAR",155,0)
 N DA,DIC,DTOUT,DUOUT,Y,GMTSM S DA(1)=+($G(GMTSI)),X=+($G(X))
"RTN","GMTSXAR",156,0)
 S DIC="^XTV(8989.51,"_DA(1)_",30,",DIC(0)="M" D ^DIC S X=+($G(Y)) Q X
"RTN","GMTSXAR",157,0)
 Q
"RTN","GMTSXAR",158,0)
 ;                
"RTN","GMTSXAR",159,0)
ADED ; Add/Edit
"RTN","GMTSXAR",160,0)
 N X,Y,DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,GMTSCNT,GMTSDEF,GMTSENT
"RTN","GMTSXAR",161,0)
 N GMTSM,GMTSMGR,GMTSNEW,GMTSPARM,GMTSPI,GMTST
"RTN","GMTSXAR",162,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXAR",163,0)
 S GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",164,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0
"RTN","GMTSXAR",165,0)
 W !! W:$L(GMTSPARM) "'" W GMTSPARM W:$L(GMTSPARM) "' " W "ALLOWABLE ENTITIES",!
"RTN","GMTSXAR",166,0)
 S DA(1)=+($G(GMTSPI)),GMTSCNT=0
"RTN","GMTSXAR",167,0)
 S (DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,",DIC(0)="AEQMLZ"
"RTN","GMTSXAR",168,0)
 S DIC("DR")=".02///^S X=$$AE^GMTSXAR(+($G(Y)))"
"RTN","GMTSXAR",169,0)
 S DLAYGO="" D FIELD^DID(8989.51,30,"","SPECIFIER","GMTST(""DID"")","GMTSM(""ERR"")")
"RTN","GMTSXAR",170,0)
 S:$L($G(GMTST("DID","SPECIFIER"))) DIC("P")=$G(GMTST("DID","SPECIFIER"))
"RTN","GMTSXAR",171,0)
L2 ;   Lock Record
"RTN","GMTSXAR",172,0)
 L +^XTV(8989.51,+($G(GMTSPI))) S GMTSCNT=GMTSCNT+1,GMTST=$T
"RTN","GMTSXAR",173,0)
 I 'GMTST,GMTSCNT'>3 H 2 G L2
"RTN","GMTSXAR",174,0)
 I 'GMTST,GMTSCNT>3 W !," Another user is editing this entry.",!," Unable to resequence at this time." Q
"RTN","GMTSXAR",175,0)
 D ^DIC S GMTSNEW=+($P($G(Y),"^",3)) Q:GMTSNEW>0  Q:+Y'>0
"RTN","GMTSXAR",176,0)
 N DIC,DIE S DA(1)=GMTSPI,DA=+($G(Y)),(DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,"
"RTN","GMTSXAR",177,0)
 S DA=+($G(Y)),DR=".01;.02///^S X=$$AE^GMTSXAR("_DA_")"
"RTN","GMTSXAR",178,0)
 D ^DIE L -^XTV(8989.51,+($G(GMTSPI)))
"RTN","GMTSXAR",179,0)
 Q
"RTN","GMTSXAR",180,0)
AE(X) ;   Allowable Entity
"RTN","GMTSXAR",181,0)
 N DA,DIC,DTOUT,DUOUT,Y,GMTSPARM,GMTSPI,GMTSENT,GMTSDEF
"RTN","GMTSXAR",182,0)
 S GMTSDEF="",GMTSENT=+($G(X)),GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",183,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0 ""
"RTN","GMTSXAR",184,0)
 S:+GMTSENT>0 GMTSDEF=$$GET1^DIQ(8989.513,(GMTSENT_","_GMTSPI_","),.02)
"RTN","GMTSXAR",185,0)
 N DA,DIC,DTOUT,DUOUT,Y S DIC="^XTV(8989.518,",DIC(0)="AEMQ"
"RTN","GMTSXAR",186,0)
 S DIC("S")="I Y'=3.5&(Y'=9.4)&(Y'=44)&(Y'=404.51)&(Y'=405.4)"
"RTN","GMTSXAR",187,0)
 S:$L($G(GMTSDEF)) DIC("B")=GMTSDEF D ^DIC S X=+($G(Y))
"RTN","GMTSXAR",188,0)
 Q X
"RTN","GMTSXAW")
0^18^B27802945
"RTN","GMTSXAW",1,0)
GMTSXAW ; SLC/KER - List Parameters/Allowable             ; 02/27/2002
"RTN","GMTSXAW",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAW",3,0)
 Q
"RTN","GMTSXAW",4,0)
 ;                                
"RTN","GMTSXAW",5,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAW",6,0)
 K GMTSALW Q:'$L($$UNM^GMTSXAW3(+($G(DUZ))))
"RTN","GMTSXAW",7,0)
 D ALW("ORWRP HEALTH SUMMARY TYPE LIST",.GMTSALW,+($G(DUZ)),"GMTS") Q
"RTN","GMTSXAW",8,0)
EN2(X) ; Entry for User X
"RTN","GMTSXAW",9,0)
 K GMTSALW N GMTSUSR S GMTSUSR=+($G(X)) Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",10,0)
 D ALW("ORWRP HEALTH SUMMARY TYPE LIST",.GMTSALW,GMTSUSR,"GMTS") Q
"RTN","GMTSXAW",11,0)
DEF(X) ; Default Entities for HS Typye List
"RTN","GMTSXAW",12,0)
 ;                    
"RTN","GMTSXAW",13,0)
 ;   Use
"RTN","GMTSXAW",14,0)
 ;      DIV  Division          If exist
"RTN","GMTSXAW",15,0)
 ;      SYS  System            Exported Entity
"RTN","GMTSXAW",16,0)
 ;      SRV  Service           If exist
"RTN","GMTSXAW",17,0)
 ;      OTL  OERR Team List    If exist
"RTN","GMTSXAW",18,0)
 ;      USR  User              Exported Entity
"RTN","GMTSXAW",19,0)
 ;      CLS  User Class        If exist
"RTN","GMTSXAW",20,0)
 ;                    
"RTN","GMTSXAW",21,0)
 ;   Exclude
"RTN","GMTSXAW",22,0)
 ;      DEV  Device
"RTN","GMTSXAW",23,0)
 ;      PKG  Package
"RTN","GMTSXAW",24,0)
 ;      LOC  Location
"RTN","GMTSXAW",25,0)
 ;      TEA  PCMM Team
"RTN","GMTSXAW",26,0)
 ;      BED  Room/Bed
"RTN","GMTSXAW",27,0)
 ;                    
"RTN","GMTSXAW",28,0)
 N GMTSI,GMTSEP,GMTSES,GMTSEA,GMTSC,GMTSPAR,GMTSMSG,GMTSX,GMTSALW
"RTN","GMTSXAW",29,0)
 S (GMTSI,GMTSC)=0,GMTSX="",GMTSPAR=$$HSD^GMTSXAW3 Q:+GMTSPAR=0 ""
"RTN","GMTSXAW",30,0)
 D LST^GMTSXAW3(GMTSPAR,.GMTSALW)
"RTN","GMTSXAW",31,0)
 F  S GMTSI=$O(^TMP("DILIST",$J,"ID",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAW",32,0)
 . S GMTSES=+($G(^TMP("DILIST",$J,"ID",GMTSI,.01))) Q:+GMTSES'>0
"RTN","GMTSXAW",33,0)
 . S GMTSEP=+($G(^TMP("DILIST",$J,"ID",GMTSI,.02))) Q:+GMTSEP'>0
"RTN","GMTSXAW",34,0)
 . S GMTSEA=$$EAB^GMTSXAW3(+($G(GMTSEP)))
"RTN","GMTSXAW",35,0)
 . Q:$L(GMTSEA)'=3  S GMTSX(+GMTSES)=GMTSEA
"RTN","GMTSXAW",36,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSX(GMTSI)) Q:+GMTSI=0  S:$G(GMTSX(GMTSI))?3U X=$G(X)_";"_GMTSX(GMTSI)
"RTN","GMTSXAW",37,0)
 S X=$$UP^GMTSXA($$TRIM^GMTSXA(X,";"))
"RTN","GMTSXAW",38,0)
 K ^TMP("DILIST",$J)
"RTN","GMTSXAW",39,0)
 Q X
"RTN","GMTSXAW",40,0)
 ;            
"RTN","GMTSXAW",41,0)
ALW(GMTSPAR,GMTSALW,GMTSUSR,GMTSPKG) ; Allowable Entities
"RTN","GMTSXAW",42,0)
 ;            
"RTN","GMTSXAW",43,0)
 ;   GMTSPAR     Parameter Name                     Required
"RTN","GMTSXAW",44,0)
 ;  .GMTSALW     Output Ary for Allowable Entities  Required
"RTN","GMTSXAW",45,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",46,0)
 ;   GMTSPKG     Package Prefix (text)              Optional
"RTN","GMTSXAW",47,0)
 ;            
"RTN","GMTSXAW",48,0)
 N GMTSPDEF,GMTSI,GMTSEC,GMTSPV,GMTSLL,GMTSUN,GMTSCALL
"RTN","GMTSXAW",49,0)
 S GMTSPKG=$G(GMTSPKG),GMTSPAR=$G(GMTSPAR),GMTSUSR=$G(GMTSUSR)
"RTN","GMTSXAW",50,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",51,0)
 S GMTSPDEF=$$PDI^GMTSXAW3(GMTSPAR) Q:+GMTSPDEF=0  D ALWD(GMTSPDEF,.GMTSALW) S GMTSI=""
"RTN","GMTSXAW",52,0)
 F  S GMTSI=$O(GMTSALW("B",GMTSI)) Q:GMTSI=""  D
"RTN","GMTSXAW",53,0)
 . S GMTSEC=+($O(GMTSALW("B",GMTSI,0))) Q:GMTSEC=0  D
"RTN","GMTSXAW",54,0)
 . . S GMTSLL=GMTSI,GMTSCALL=GMTSLL_"^GMTSXAW2" D GET
"RTN","GMTSXAW",55,0)
 Q
"RTN","GMTSXAW",56,0)
CHK(GMTSALW,GMTSUSR,GMTSPKG) ; Check values Only
"RTN","GMTSXAW",57,0)
 ;            
"RTN","GMTSXAW",58,0)
 ;  .GMTSALW     Output Array for values            Required
"RTN","GMTSXAW",59,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",60,0)
 ;   GMTSPKG     Package Prefix (namespace)         Optional
"RTN","GMTSXAW",61,0)
 ;            
"RTN","GMTSXAW",62,0)
 N GMTSCHK S GMTSCHK=1 D V2
"RTN","GMTSXAW",63,0)
 Q
"RTN","GMTSXAW",64,0)
VAL(GMTSALW,GMTSUSR,GMTSPKG) ; All Values and Pointers
"RTN","GMTSXAW",65,0)
 ;            
"RTN","GMTSXAW",66,0)
 ;  .GMTSALW     Output Array for values            Required
"RTN","GMTSXAW",67,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",68,0)
 ;   GMTSPKG     Package Prefix (namespace)         Optional
"RTN","GMTSXAW",69,0)
 ;            
"RTN","GMTSXAW",70,0)
V2 ; Get Values and Pointers
"RTN","GMTSXAW",71,0)
 N GMTSU,GMTSPV S GMTSU=+($G(GMTSUSR)) S:+($G(GMTSUSR))=0 GMTSU=+($G(DUZ))
"RTN","GMTSXAW",72,0)
 N GMTSUSR S GMTSUSR=GMTSU Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",73,0)
 N GMTST,GMTSI,GMTSEC,GMTSLL,GMTSCALL,GMTSVAL S GMTSPKG=$G(GMTSPKG),GMTSVAL=1
"RTN","GMTSXAW",74,0)
 S GMTSEC=0,GMTST="DEV;DIV;SYS;PKG;LOC;SRV;OTL;USR;CLS"
"RTN","GMTSXAW",75,0)
 F GMTSI=1:1 Q:'$L($P(GMTST,";",GMTSI))  S GMTSLL=$P(GMTST,";",GMTSI),GMTSCALL=GMTSLL_"^GMTSXAW2" D GET
"RTN","GMTSXAW",76,0)
 Q
"RTN","GMTSXAW",77,0)
 ;            
"RTN","GMTSXAW",78,0)
ALWD(X,Y) ; Get Allowed Entities for Parameter 
"RTN","GMTSXAW",79,0)
 ;            
"RTN","GMTSXAW",80,0)
 ;   X       Parameter (pointer)                    Required
"RTN","GMTSXAW",81,0)
 ;  .Y       Output Array for Allowed Entities      Required
"RTN","GMTSXAW",82,0)
 ;            
"RTN","GMTSXAW",83,0)
 N GMTSPIEN,GMTSNAM,GMTSMSG,GMTSALW,GMTSLST,GMTSENT,GMTSPRE,GMTSCT,GMTSAL
"RTN","GMTSXAW",84,0)
 S GMTSAL="",GMTSCT=0,GMTSPIEN=+($G(X)) Q:X=0  K ^TMP("DILIST",$J)
"RTN","GMTSXAW",85,0)
 S GMTSNAM=$$PDN^GMTSXAW3(+GMTSPIEN) Q:'$L(GMTSNAM)
"RTN","GMTSXAW",86,0)
 D LST^GMTSXAW3(GMTSPIEN,.GMTSALW)
"RTN","GMTSXAW",87,0)
 S GMTSLST=0 F  S GMTSLST=$O(^TMP("DILIST",$J,"ID",GMTSLST)) Q:+GMTSLST=0  D
"RTN","GMTSXAW",88,0)
 . S GMTSENT=+($G(^TMP("DILIST",$J,"ID",GMTSLST,.02)))
"RTN","GMTSXAW",89,0)
 . S GMTSPRE=$$EAB^GMTSXAW3(+($G(GMTSENT))) Q:'$L(GMTSPRE)  S GMTSCT=GMTSCT+1
"RTN","GMTSXAW",90,0)
 . S Y(GMTSCT)=GMTSPRE_"^"_$$EFN^GMTSXAW3(+($G(GMTSENT)))_"^"_$$ENM^GMTSXAW3(+($G(GMTSENT)))_"^"_$$EMC^GMTSXAW3(+($G(GMTSENT)))
"RTN","GMTSXAW",91,0)
 . S Y("B",GMTSPRE,GMTSCT)=$G(Y(GMTSCT)),GMTSAL=GMTSAL_";"_$$UP^GMTSXA(GMTSPRE)
"RTN","GMTSXAW",92,0)
 K ^TMP("DILIST",$J) S Y("ALLOWABLE")=$$TRIM^GMTSXA(GMTSAL,";"),Y(0)=GMTSCT
"RTN","GMTSXAW",93,0)
 Q
"RTN","GMTSXAW",94,0)
 ; Parameter Entites
"RTN","GMTSXAW",95,0)
GET ;   Get Entities
"RTN","GMTSXAW",96,0)
 S GMTSLL=$G(GMTSLL),GMTSCALL=$G(GMTSCALL) Q:'$L($T(@GMTSCALL))  K GMTSPV D @GMTSCALL
"RTN","GMTSXAW",97,0)
 N GMTS,GMTSA,GMTSP,GMTSN,GMTSC,GMTSV S GMTS=0
"RTN","GMTSXAW",98,0)
 F  S GMTS=$O(GMTSPV(GMTS)) Q:+GMTS=0  D
"RTN","GMTSXAW",99,0)
 . S GMTSA=$G(GMTSPV(GMTS)),GMTSP=$P(GMTSA,"^",2)
"RTN","GMTSXAW",100,0)
 . Q:GMTSP'[";"  S GMTSN=$P(GMTSA,"^",3) Q:'$L(GMTSN)
"RTN","GMTSXAW",101,0)
 . S GMTSC=+($G(GMTSEC)),GMTSV=+($G(GMTSVAL))+($G(GMTSCHK))
"RTN","GMTSXAW",102,0)
 . S GMTSA=$P(GMTSA,"^",1) Q:$L(GMTSA)'=3
"RTN","GMTSXAW",103,0)
 . D SET^GMTSXAW3(GMTSA,GMTSP,GMTSN,.GMTSALW,GMTSC,GMTSV)
"RTN","GMTSXAW",104,0)
 Q
"RTN","GMTSXAW",105,0)
TST ;   Test entry
"RTN","GMTSXAW",106,0)
 N GMTSEC,GMTSI,GMTSLL,GMTSCALL,GMTSU,GMTSPV,GMTSPKG,GMTSN,GMTSC,GMTSA,GMTSP,GMTST,GMTSV
"RTN","GMTSXAW",107,0)
 S GMTSEC=0,GMTSPKG="GMTS" S:'$L($G(GMTST)) GMTST="DEV;DIV;SYS;PKG;LOC;SRV;OTL;USR;CLS",GMTSPKG="GMTS"
"RTN","GMTSXAW",108,0)
 S GMTSU=+($G(GMTSUSR)) S:GMTSU'>0 GMTSU=+($G(DUZ)) Q:GMTSU'>0  N GMTSUSR S GMTSUSR=GMTSU
"RTN","GMTSXAW",109,0)
 F GMTSI=1:1 Q:'$L($P(GMTST,";",GMTSI))  D
"RTN","GMTSXAW",110,0)
 . S GMTSLL=$P(GMTST,";",GMTSI),GMTSCALL=GMTSLL_"^GMTSXAW2"
"RTN","GMTSXAW",111,0)
 . W !!,GMTSLL,?8,$$EMC^GMTSXAW3($$ETI^GMTSXAW3(GMTSLL))
"RTN","GMTSXAW",112,0)
 . Q:'$L($T(@GMTSCALL))  K GMTSPV D @GMTSCALL Q:'$D(GMTSPV)
"RTN","GMTSXAW",113,0)
 . S GMTSEC=0 S:$L(GMTSLL) GMTSEC=+($O(GMTSALW("B",GMTSLL,0)))
"RTN","GMTSXAW",114,0)
 . S GMTSN="GMTSPV(0)",GMTSC="GMTSPV("
"RTN","GMTSXAW",115,0)
 . F  S GMTSN=$Q(@GMTSN) Q:GMTSN=""!(GMTSN'[GMTSC)  W !,GMTSN,"=",@GMTSN
"RTN","GMTSXAW",116,0)
 . N GMTS S GMTS=0 F  S GMTS=$O(GMTSPV(GMTS)) Q:+GMTS=0  D
"RTN","GMTSXAW",117,0)
 . . S GMTSA=$G(GMTSPV(GMTS)),GMTSP=$P(GMTSA,"^",2)
"RTN","GMTSXAW",118,0)
 . . Q:GMTSP'[";"  S GMTSN=$P(GMTSA,"^",3) Q:'$L(GMTSN)
"RTN","GMTSXAW",119,0)
 . . S GMTSC=+($G(GMTSEC)),GMTSV=+($G(GMTSVAL))+($G(GMTSCHK))
"RTN","GMTSXAW",120,0)
 . . S GMTSA=$P(GMTSA,"^",1) Q:$L(GMTSA)'=3
"RTN","GMTSXAW",121,0)
 . . D SET^GMTSXAW3(GMTSA,GMTSP,GMTSN,.GMTSALW,GMTSC,GMTSV)
"RTN","GMTSXAW",122,0)
 Q
"RTN","GMTSXAW2")
0^26^B21588396
"RTN","GMTSXAW2",1,0)
GMTSXAW2 ; SLC/KER - List Parameters/Entities              ; 02/27/2002
"RTN","GMTSXAW2",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAW2",3,0)
 Q
"RTN","GMTSXAW2",4,0)
 ;                                
"RTN","GMTSXAW2",5,0)
 ; External References
"RTN","GMTSXAW2",6,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSXAW2",7,0)
 ;                             
"RTN","GMTSXAW2",8,0)
DEV ; Device
"RTN","GMTSXAW2",9,0)
 K GMTSPV N GMTSE,GMTSA,GMTSEN,GMTSIE,GMTSVP,GMTSNM
"RTN","GMTSXAW2",10,0)
 S GMTSE=+($$ETI^GMTSXAW3("DEV")) Q:+GMTSE=0
"RTN","GMTSXAW2",11,0)
 S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",12,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",13,0)
 S GMTSIE=+($G(IO("HOME"))) Q:+GMTSIE'>0  S GMTSVP=+GMTSIE_";%ZIS(1,"
"RTN","GMTSXAW2",14,0)
 S GMTSNM=$$DEV^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",15,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",16,0)
 Q
"RTN","GMTSXAW2",17,0)
DIV ; Division              Needs GMTSUSR
"RTN","GMTSXAW2",18,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",19,0)
 S GMTSE=+($$ETI^GMTSXAW3("DIV")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",20,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",21,0)
 S GMTSVP=$$UD^GMTSXAW3(+($G(GMTSUSR))),GMTSNM=$$DIV^GMTSXAW3(+($G(GMTSVP)))
"RTN","GMTSXAW2",22,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",23,0)
SYS ; System 
"RTN","GMTSXAW2",24,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",25,0)
 ; Entity Lookup
"RTN","GMTSXAW2",26,0)
 S GMTSE=+($$ETI^GMTSXAW3("SYS")) Q:+GMTSE=0
"RTN","GMTSXAW2",27,0)
 ; Entity Abbrv
"RTN","GMTSXAW2",28,0)
 S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",29,0)
 ; Entity Mixed Case
"RTN","GMTSXAW2",30,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",31,0)
 ; System IEN
"RTN","GMTSXAW2",32,0)
 S GMTSIE=$$SI^GMTSXAW3 Q:+GMTSIE'>0
"RTN","GMTSXAW2",33,0)
 ; System Variable Pointer/Domain Name
"RTN","GMTSXAW2",34,0)
 S GMTSVP=+GMTSIE_";DIC(4.2,",GMTSNM=$$SYS^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",35,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",36,0)
PKG ; Package               Needs GMTSPKG
"RTN","GMTSXAW2",37,0)
 K GMTSPV Q:'$L($G(GMTSPKG))
"RTN","GMTSXAW2",38,0)
 N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",39,0)
 S GMTSE=+($$ETI^GMTSXAW3("PKG")) Q:+GMTSE=0
"RTN","GMTSXAW2",40,0)
 S GMTSA=$$EAB^GMTSXAW3(GMTSE),GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",41,0)
 S GMTSIE=$$PK^GMTSXAW3(GMTSPKG) Q:+GMTSIE'>0  S GMTSVP=+GMTSIE_";DIC(9.4,"
"RTN","GMTSXAW2",42,0)
 S GMTSNM=$$PKG^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",43,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",44,0)
LOC ; Hospital Location     <none>
"RTN","GMTSXAW2",45,0)
 K GMTSPV Q
"RTN","GMTSXAW2",46,0)
SRV ; Service               Needs GMTSUSR
"RTN","GMTSXAW2",47,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",48,0)
 S GMTSE=+($$ETI^GMTSXAW3("SRV")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",49,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",50,0)
 S GMTSIE=$$SRI^GMTSXAW3(+($G(GMTSUSR))) Q:+GMTSIE'>0
"RTN","GMTSXAW2",51,0)
 S GMTSVP=+GMTSIE_";DIC(49,",GMTSNM=$$SRV^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",52,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",53,0)
OTL ; OERR Team List        Needs GMTSUSR
"RTN","GMTSXAW2",54,0)
 K GMTSPV N GMTSE,GMTSA,GMTSEN,GMTSNM,GMTSPVC,GMTSI,GMTSIE,GMTSVP,GMTSOTL
"RTN","GMTSXAW2",55,0)
 S GMTSE=+($$ETI^GMTSXAW3("OTL")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",56,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",57,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAW2",58,0)
 D OTL^GMTSXAW3(GMTSNM,.GMTSOTL) S (GMTSPVC,GMTSI)=0
"RTN","GMTSXAW2",59,0)
 F  S GMTSI=$O(GMTSOTL("DILIST",2,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAW2",60,0)
 . S GMTSIE=$G(GMTSOTL("DILIST",2,GMTSI)) Q:+GMTSIE=0
"RTN","GMTSXAW2",61,0)
 . S GMTSVP=+GMTSIE_";OR(100.21,",GMTSNM=$G(GMTSOTL("DILIST",1,GMTSI))
"RTN","GMTSXAW2",62,0)
 . Q:'$L(GMTSNM)  S GMTSPVC=+($G(GMTSPVC))+1
"RTN","GMTSXAW2",63,0)
 . S GMTSPV(GMTSPVC)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH
"RTN","GMTSXAW2",64,0)
 Q
"RTN","GMTSXAW2",65,0)
USR ; User                  Needs GMTSUSR
"RTN","GMTSXAW2",66,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",67,0)
 S GMTSE=+($$ETI^GMTSXAW3("USR")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",68,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",69,0)
 S GMTSIE=+($G(GMTSUSR)) Q:+GMTSIE'>0  S GMTSVP=$$UVP^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",70,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAW2",71,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",72,0)
TEA ; Team                  <none>
"RTN","GMTSXAW2",73,0)
 K GMTSPV Q
"RTN","GMTSXAW2",74,0)
BED ; Room/Bed              <none>
"RTN","GMTSXAW2",75,0)
 K GMTSPV Q
"RTN","GMTSXAW2",76,0)
CLS ; User Class            Needs GMTSUSR
"RTN","GMTSXAW2",77,0)
 K GMTSPV N GMTSIE,GMTSNM,GMTSE,GMTSA,GMTSEN,GMTSPVC,GMTSCD,GMTSED,GMTSCLS,GMTSMEM,GMTSMSG,GMTSI,GMTSU,GMTSIE
"RTN","GMTSXAW2",78,0)
 S GMTSE=+($$ETI^GMTSXAW3("CLS")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE),GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",79,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)  S GMTSCD=DT,GMTSU=0 D UCL^GMTSXAW3(GMTSUSR,.GMTSMEM)
"RTN","GMTSXAW2",80,0)
 F  S GMTSU=$O(GMTSMEM("ID",GMTSU)) Q:+GMTSU=0  D
"RTN","GMTSXAW2",81,0)
 . S GMTSED=+($G(GMTSMEM("ID",GMTSU,.03))),GMTSED=+($P(GMTSED,".",1)) Q:+GMTSED=0  Q:+GMTSED>+GMTSCD
"RTN","GMTSXAW2",82,0)
 . S GMTSED=+($G(GMTSMEM("ID",GMTSU,.04))) Q:+GMTSED>0&(+GMTSCD>+GMTSED)
"RTN","GMTSXAW2",83,0)
 . I +($G(GMTSMEM("ID",GMTSU,.02)))>0 D
"RTN","GMTSXAW2",84,0)
 . . S GMTSIE=+($G(GMTSMEM("ID",GMTSU,.02))),GMTSVP=GMTSIE_";USR(8930,",GMTSNM=$$CLS^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",85,0)
 . . Q:'$L(GMTSNM)  S GMTSPVC=+($G(GMTSPVC))+1,GMTSPV(GMTSPVC)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH
"RTN","GMTSXAW2",86,0)
 Q
"RTN","GMTSXAW2",87,0)
OTH ; Other Elements
"RTN","GMTSXAW2",88,0)
 S:$L($G(GMTSVP)) GMTSPV("VP",$G(GMTSVP))=""
"RTN","GMTSXAW2",89,0)
 S:$L($P($G(GMTSVP),";",2)) GMTSPV("GL",$P($G(GMTSVP),";",2))=""
"RTN","GMTSXAW2",90,0)
 S:$L($G(GMTSA)) GMTSPV("AB",$G(GMTSA))=""
"RTN","GMTSXAW2",91,0)
 Q
"RTN","GMTSXAW3")
0^19^B36297091
"RTN","GMTSXAW3",1,0)
GMTSXAW3 ; SLC/KER - List Parameters/Allowable 2           ; 02/27/2002
"RTN","GMTSXAW3",2,0)
 ;;2.7;Health Summary;**47,49**;Oct 20, 1995
"RTN","GMTSXAW3",3,0)
 ;
"RTN","GMTSXAW3",4,0)
 ; External References in GMTSXAW2
"RTN","GMTSXAW3",5,0)
 ;   DBIA  2051  FIND^DIC
"RTN","GMTSXAW3",6,0)
 ;   DBIA  2051  $$FIND1^DIC
"RTN","GMTSXAW3",7,0)
 ;   DBIA  2051  LIST^DIC
"RTN","GMTSXAW3",8,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAW3",9,0)
 ;   DBIA  2541  $$KSP^XUPARAM
"RTN","GMTSXAW3",10,0)
 ;   DBIA  2324  $$CLNAME^USRLM
"RTN","GMTSXAW3",11,0)
 ;   DBIA  2324  WHATIS^USRLM
"RTN","GMTSXAW3",12,0)
 ;   DBIA 10112  $$PRIM^VASITE
"RTN","GMTSXAW3",13,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSXAW3",14,0)
 ;   DBIA  2054  $$CREF^DILF
"RTN","GMTSXAW3",15,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR")
"RTN","GMTSXAW3",16,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSXAW3",17,0)
 ;   DBIA 10114  ^%ZIS(1,
"RTN","GMTSXAW3",18,0)
 ;   DBIA 10048  ^DIC(9.4,
"RTN","GMTSXAW3",19,0)
 ;   DBIA 10090  ^DIC(4,
"RTN","GMTSXAW3",20,0)
 ;   DBIA 10093  ^DIC(49,
"RTN","GMTSXAW3",21,0)
 ;   DBIA  3005  ^OR(100.21
"RTN","GMTSXAW3",22,0)
 ;   DBIA  1996  ^DIC(4.2,
"RTN","GMTSXAW3",23,0)
 ;   DBIA  2324  ^USR(8930.3,
"RTN","GMTSXAW3",24,0)
 ;   DBIA  2324  ^USR(8930,
"RTN","GMTSXAW3",25,0)
 ;   DBIA  3407  ^XTV(8989.51,     Pending
"RTN","GMTSXAW3",26,0)
 ;   DBIA  3408  ^XTV(8989.518,    Pending
"RTN","GMTSXAW3",27,0)
 ;            
"RTN","GMTSXAW3",28,0)
 Q
"RTN","GMTSXAW3",29,0)
SET(GMTSA,GMTSP,GMTSN,GMTSALW,GMTSI,GMTSF) ; Create Array Entry
"RTN","GMTSXAW3",30,0)
 ;            
"RTN","GMTSXAW3",31,0)
 ;   GMTSA    Identifier    SYS          USR           Req
"RTN","GMTSXAW3",32,0)
 ;   GMTSP    Variable Ptr  97;DIC(4.2,  1118;VA(200,  Req
"RTN","GMTSXAW3",33,0)
 ;   GMTSN    Name          System       User          Req
"RTN","GMTSXAW3",34,0)
 ;  .GMTSALW  Array Root    GMTSALW(                   Req
"RTN","GMTSXAW3",35,0)
 ;   GMTSI    Array IEN     GMTSALW(GMTSI)             Req
"RTN","GMTSXAW3",36,0)
 ;   GMTSF    Value Flag    Include only values        Opt
"RTN","GMTSXAW3",37,0)
 ;            
"RTN","GMTSXAW3",38,0)
 Q:'$L(GMTSA)  Q:'$L(GMTSP)  Q:'$L(GMTSN)  I +($G(GMTSF))>0 D  Q
"RTN","GMTSXAW3",39,0)
 . N GMTSD S GMTSD=";"_$P(GMTSP,";",2)
"RTN","GMTSXAW3",40,0)
 . S GMTSALW("CHK",GMTSP,GMTSD)="" Q:+($G(GMTSF))>1
"RTN","GMTSXAW3",41,0)
 . S GMTSALW("ENT",GMTSA,GMTSP)=""
"RTN","GMTSXAW3",42,0)
 . S GMTSALW("VAL",GMTSP,GMTSA)=""
"RTN","GMTSXAW3",43,0)
 N GMTS2 S GMTSI=+($G(GMTSI)) Q:GMTSI=0
"RTN","GMTSXAW3",44,0)
 S GMTS2=$O(GMTSALW(GMTSI,GMTSA," "),-1)+1
"RTN","GMTSXAW3",45,0)
 S GMTSALW(GMTSI,GMTSA,GMTS2)=GMTSP_"^"_GMTSN
"RTN","GMTSXAW3",46,0)
 S GMTSALW(GMTSI,GMTSA,"VAL",GMTSP,GMTS2)=""
"RTN","GMTSXAW3",47,0)
 S GMTSALW("ENT",GMTSA,GMTSP,GMTSI,GMTS2)=""
"RTN","GMTSXAW3",48,0)
 S GMTSALW("VAL",GMTSP,GMTSI,GMTS2)=GMTSA
"RTN","GMTSXAW3",49,0)
 Q
"RTN","GMTSXAW3",50,0)
 ; Lookups
"RTN","GMTSXAW3",51,0)
LST(X,Y) ;   Default Entities    8989.513  Lookup    .01, .02
"RTN","GMTSXAW3",52,0)
 Q:+($G(X))'>0  N GMTSM,GMTSP S GMTSP=+($G(X)) Q:+($G(GMTSP))'>0
"RTN","GMTSXAW3",53,0)
 D LIST^DIC(8989.513,(","_+GMTSP_","),".01;.02","I","*",,,,,.Y,.GMTSM)
"RTN","GMTSXAW3",54,0)
 Q
"RTN","GMTSXAW3",55,0)
OTL(X,GMTSOTL) ;   OR Team List        100.21    Lookup    .01
"RTN","GMTSXAW3",56,0)
 N GMTSNM S GMTSNM=$G(X) Q:'$L($G(GMTSNM))  N GMTSM
"RTN","GMTSXAW3",57,0)
 D FIND^DIC(100.21,,".01",,GMTSNM,"*","C",,,"GMTSOTL","GMTSM")
"RTN","GMTSXAW3",58,0)
 Q
"RTN","GMTSXAW3",59,0)
UCL(X,GMTS) ;   User Classes        8930.3    Lookup    .01, .02, .03, .04
"RTN","GMTSXAW3",60,0)
 N USRT S X=+($G(X)) Q:X=0  D WHATIS^USRLM(X,"USRT")
"RTN","GMTSXAW3",61,0)
 N GMTSNM,GMTSCT,GMTSI,GMTSIEN,GMTSC,GMTSCLS,GMTSEFF,GMTSEXP,GMTSCLN,GMTSU,GMTSUN
"RTN","GMTSXAW3",62,0)
 S GMTSU=+($G(USRT(0))),GMTSUN=$P($G(USRT(0)),"^",2),GMTSC=$P($G(USRT(0)),"^",3)
"RTN","GMTSXAW3",63,0)
 S GMTSC=0,GMTSI="" F  S GMTSI=$O(USRT(GMTSI)) Q:GMTSI=""  D
"RTN","GMTSXAW3",64,0)
 . S GMTSIEN=$P($G(USRT(GMTSI)),"^",2) Q:+GMTSIEN=0  S GMTSCLS=$P($G(USRT(GMTSI)),"^",1),GMTSEFF=$P($G(USRT(GMTSI)),"^",4),GMTSEXP=$P($G(USRT(GMTSI)),"^",5),GMTSCLN=$P($G(USRT(GMTSI)),"^",3)
"RTN","GMTSXAW3",65,0)
 . S GMTSC=GMTSC+1,GMTS("ID",GMTSC,.01)=GMTSUN,GMTS("ID",GMTSC,.01,"E")=GMTSU,GMTS("ID",GMTSC,.02)=GMTSCLS,GMTS("ID",GMTSC,.03)=GMTSEFF,GMTS("ID",GMTSC,.04)=GMTSEXP,GMTS("ID",GMTSC,"IEN")=GMTSIEN
"RTN","GMTSXAW3",66,0)
 Q
"RTN","GMTSXAW3",67,0)
HSD(X) ;   HS Definition
"RTN","GMTSXAW3",68,0)
 S X=$$PDI("ORWRP HEALTH SUMMARY TYPE LIST") Q X
"RTN","GMTSXAW3",69,0)
SI(X) ;   System Infor        4.2       Lookup
"RTN","GMTSXAW3",70,0)
 Q $$FIND1^DIC(4.2,"","QX",$$KSP^XUPARAM("WHERE"))
"RTN","GMTSXAW3",71,0)
ABR(X) ;   Abbreviation        8989.518  .02
"RTN","GMTSXAW3",72,0)
 N GMTS S X=$G(X) Q:'$L(X) "XXX"
"RTN","GMTSXAW3",73,0)
 S:X[";" X=$P(X,";",2) S:X'["^" X="^"_X
"RTN","GMTSXAW3",74,0)
 S:$E(X,$L(X))'="("&(X["(")&(X'[",") X=X_"," S X=X_"0"
"RTN","GMTSXAW3",75,0)
 S GMTS=$$CREF^DILF(X) I X'=GMTS,GMTS["0" D  Q X
"RTN","GMTSXAW3",76,0)
 . S X=+($P($G(@GMTS),"^",2)) I +X'>0 S X="XXX" Q
"RTN","GMTSXAW3",77,0)
 . S X=$$UP^GMTSXA($$GET1^DIQ(8989.518,(X_","),.02))
"RTN","GMTSXAW3",78,0)
 . S:$L(X)'=3 X="XXX"
"RTN","GMTSXAW3",79,0)
 Q "XXX"
"RTN","GMTSXAW3",80,0)
ETI(X) ;   Entity IEN          8989.518  Lookup
"RTN","GMTSXAW3",81,0)
 Q:$L($G(X))'=3 0 N GMTSM
"RTN","GMTSXAW3",82,0)
 Q $$FIND1^DIC(8989.518,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",83,0)
EFN(X) ;   Entity File #       8989.518  .001
"RTN","GMTSXAW3",84,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.001)
"RTN","GMTSXAW3",85,0)
ENM(X) ;   Entity Name         8989.518  .01
"RTN","GMTSXAW3",86,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.01)
"RTN","GMTSXAW3",87,0)
EAB(X) ;   Entity Abbrv        8989.518  .02
"RTN","GMTSXAW3",88,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.02)
"RTN","GMTSXAW3",89,0)
EMC(X) ;   Entity Mix Case     8989.518  .03
"RTN","GMTSXAW3",90,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.03)
"RTN","GMTSXAW3",91,0)
PDI(X) ;   Param Def IEN       8989.51    Lookup
"RTN","GMTSXAW3",92,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",93,0)
 Q $$FIND1^DIC(8989.51,,"CO",$G(X),.GMTSM)
"RTN","GMTSXAW3",94,0)
PDN(X) ;   Param Def Name      8989.51   .01
"RTN","GMTSXAW3",95,0)
 Q $$GET1^DIQ(8989.51,(+($G(X))_","),.01)
"RTN","GMTSXAW3",96,0)
UVP(X) ;   User Var Ptr        200
"RTN","GMTSXAW3",97,0)
 N GMTS S GMTS=+($G(X)) Q:'$L($$UNM(GMTS)) ""
"RTN","GMTSXAW3",98,0)
 S X=GMTS_";VA(200," Q X
"RTN","GMTSXAW3",99,0)
USR(X) ;   Get User            200       Lookup
"RTN","GMTSXAW3",100,0)
 N DIC,Y,DTOUT,DUOUT,GMTSN,GMTSP S GMTSN=$$UNM(+($G(DUZ))),GMTSP=$G(X),DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Select User:  "
"RTN","GMTSXAW3",101,0)
 S:$L(GMTSP) DIC("A")=GMTSP S DIC("S")="I $$ACTIVE^XUSER(+($G(Y)))>0" S:$L(GMTSN) DIC("B")=GMTSN D ^DIC S X=+Y
"RTN","GMTSXAW3",102,0)
 Q X
"RTN","GMTSXAW3",103,0)
UNM(X) ;   User Name           200       .01
"RTN","GMTSXAW3",104,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),.01)
"RTN","GMTSXAW3",105,0)
MGR(X) ;   HS Manager
"RTN","GMTSXAW3",106,0)
 Q $S(((+($G(DUZ))>0)&($D(^XUSEC("GMTSMGR",+($G(DUZ)))))):1,1:0)
"RTN","GMTSXAW3",107,0)
PK(X) ;   Package             9.4       Lookup
"RTN","GMTSXAW3",108,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",109,0)
 Q $$FIND1^DIC(9.4,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",110,0)
DEV(X) ;   Device Name         3.5       .01
"RTN","GMTSXAW3",111,0)
 Q $$GET1^DIQ(3.5,(+($G(X))_","),.01)
"RTN","GMTSXAW3",112,0)
DIV(X) ;   Division Name       4         .01
"RTN","GMTSXAW3",113,0)
 Q $$GET1^DIQ(4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",114,0)
UD(X) ;   User's Division     200.02    .01
"RTN","GMTSXAW3",115,0)
 N GMTSINST,GMTSDIV,GMTSUSR S GMTSUSR=+($G(X)),(GMTSDIV,GMTSINST)=$$KSP^XUPARAM("INST")
"RTN","GMTSXAW3",116,0)
 ;     Not a Multi-Divisional Institution
"RTN","GMTSXAW3",117,0)
 I $$GET1^DIQ(4,GMTSDIV_",",5,"I")'="Y" Q GMTSDIV_";DIC(4,"
"RTN","GMTSXAW3",118,0)
 ;     User's Default Division
"RTN","GMTSXAW3",119,0)
 S GMTSDIV=$O(^VA(200,GMTSUSR,2,"AX1",1,0))
"RTN","GMTSXAW3",120,0)
 ;     User Default Division not found
"RTN","GMTSXAW3",121,0)
 S:+GMTSDIV=0 GMTSDIV=$O(^VA(200,GMTSUSR,2,0))
"RTN","GMTSXAW3",122,0)
 S GMTSDIV=$$GET1^DIQ(200.02,(+GMTSDIV_","_+GMTSUSR_","),.01,"I")
"RTN","GMTSXAW3",123,0)
 ;     Undefined Default Division
"RTN","GMTSXAW3",124,0)
 Q:+GMTSDIV=0&(+GMTSINST>0) +GMTSINST_";DIV(4,"
"RTN","GMTSXAW3",125,0)
 ;     Undefined Institution
"RTN","GMTSXAW3",126,0)
 Q:+GMTSDIV=0&(+GMTSINST'>0) ""
"RTN","GMTSXAW3",127,0)
 ;     User's Division
"RTN","GMTSXAW3",128,0)
 Q +GMTSDIV_";DIC(4,"
"RTN","GMTSXAW3",129,0)
DD(X) ;   Division (Default)  200.02    .01
"RTN","GMTSXAW3",130,0)
 Q:+($G(X))'>0 ""  K ^TMP("DILIST",$J) D DS(+($G(X)),.Y)
"RTN","GMTSXAW3",131,0)
 N GMTSDD,GMTSI S GMTSDD=""
"RTN","GMTSXAW3",132,0)
 S GMTSI=0 F  S GMTSI=$O(^TMP("DILIST",$J,"ID",GMTSI)) Q:+GMTSI=0!($L(GMTSDD))  D
"RTN","GMTSXAW3",133,0)
 . I $G(^TMP("DILIST",$J,"ID",GMTSI,1))=1 S GMTSDD=$G(^TMP("DILIST",$J,"ID",GMTSI,.01))
"RTN","GMTSXAW3",134,0)
 K ^TMP("DILIST",$J) S X=$G(GMTSDD) Q X
"RTN","GMTSXAW3",135,0)
DS(X,Y) ;   Divisions           200.02    Lookup    .01, 1
"RTN","GMTSXAW3",136,0)
 Q:+($G(X))'>0  N GMTSM,GMTSP S GMTSP=+($G(X)) Q:+($G(GMTSP))'>0
"RTN","GMTSXAW3",137,0)
 D LIST^DIC(200.02,(","_+GMTSP_","),".01;1","I","*",,,,,.Y,.GMTSM)
"RTN","GMTSXAW3",138,0)
 Q
"RTN","GMTSXAW3",139,0)
DE(X) ;   Division (Primary)  40.8      Lookup    .07
"RTN","GMTSXAW3",140,0)
 N PRIM S PRIM=$$PRIM^VASITE S X=$$GET1^DIQ(40.8,(PRIM_","),.07,"I")
"RTN","GMTSXAW3",141,0)
 Q X
"RTN","GMTSXAW3",142,0)
SYS(X) ;   System Name         4.2       .01
"RTN","GMTSXAW3",143,0)
 Q $$GET1^DIQ(4.2,(+($G(X))_","),.01)
"RTN","GMTSXAW3",144,0)
PKG(X) ;   Package Name        9.4       .01
"RTN","GMTSXAW3",145,0)
 Q $$GET1^DIQ(9.4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",146,0)
SRI(X) ;   Service (I)         200        29
"RTN","GMTSXAW3",147,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),29,"I")
"RTN","GMTSXAW3",148,0)
SRV(X) ;   Service Name        49        .01
"RTN","GMTSXAW3",149,0)
 Q $$GET1^DIQ(49,(+($G(X))_","),.01)
"RTN","GMTSXAW3",150,0)
CLS(X) ;   User Class Name     8930      .01
"RTN","GMTSXAW3",151,0)
 Q $$UP^GMTSXA($$CLNAME^USRLM(+($G(X))))
"RTN","GMTSXAW3",152,0)
SYSV(X) ;   System Var Ptr
"RTN","GMTSXAW3",153,0)
 N GMTSYS S GMTSYS=$$KSP^XUPARAM("WHERE") I $L(GMTSYS) D  Q:'$L(GMTSYS)
"RTN","GMTSXAW3",154,0)
 . N DIC,DTOUT,DUOUT,X,Y S DIC="^DIC(4.2,",X=GMTSYS,DIC(0)="MXO"
"RTN","GMTSXAW3",155,0)
 . D ^DIC S GMTSYS=+Y S:GMTSYS'>0 GMTSYS="" S GMTSYS=$S(+GMTSYS>0:(GMTSYS_";"_$P(DIC,"^",2)),1:"")
"RTN","GMTSXAW3",156,0)
 S X=GMTSYS Q X
"RTN","GMTSXAW3",157,0)
USRV(X) ;   User Var Ptr
"RTN","GMTSXAW3",158,0)
 N GMTSU,GMTSUV S GMTSU=$G(X) I $L($$UNM(+($G(X)))) S X=+($G(X))_";VA(200," Q X
"RTN","GMTSXAW3",159,0)
 N DIC,DTOUT,DUOUT,X,Y S DIC="^VA(200,",X=GMTSU,DIC(0)="MXO" D ^DIC S GMTSU=+Y,GMTSUV=""
"RTN","GMTSXAW3",160,0)
 S:GMTSU'>0 GMTSUV="" S:GMTSU>0 GMTSUV=GMTSU_";"_$P(DIC,"^",2) S X=GMTSUV Q X
"VER")
8.0^22.0
**END**
**END**
